function a0_0x57fa(_0x32a003,_0x1ccdfb){var _0x43ce77=a0_0x43ce();return a0_0x57fa=function(_0x57fa1e,_0xccb927){_0x57fa1e=_0x57fa1e-0x85;var _0x3f7e11=_0x43ce77[_0x57fa1e];return _0x3f7e11;},a0_0x57fa(_0x32a003,_0x1ccdfb);}var a0_0x2463d6=a0_0x57fa;(function(_0x155bc5,_0x3373bb){var _0x50af99=a0_0x57fa,_0x14c0d1=_0x155bc5();while(!![]){try{var _0xd57b0a=parseInt(_0x50af99(0xc6))/0x1+parseInt(_0x50af99(0xc5))/0x2*(parseInt(_0x50af99(0x8b))/0x3)+-parseInt(_0x50af99(0xae))/0x4*(-parseInt(_0x50af99(0xf8))/0x5)+-parseInt(_0x50af99(0xc9))/0x6+parseInt(_0x50af99(0xe1))/0x7+-parseInt(_0x50af99(0xaa))/0x8+parseInt(_0x50af99(0xc2))/0x9;if(_0xd57b0a===_0x3373bb)break;else _0x14c0d1['push'](_0x14c0d1['shift']());}catch(_0x433617){_0x14c0d1['push'](_0x14c0d1['shift']());}}}(a0_0x43ce,0x3dafa));function a0_0x43ce(){var _0x815934=['$sale_product.bay','role','<div>','True','max_per_unit','Logo.png','\x20Order\x20Date\x20:\x20','batch_code','Enabled','room_name','</td>','$customers_docs','email','/../public','Portuguese\x20(BR)','<!DOCTYPE\x20html>','Chinese','$product_details.secondary_unit','</div>','$product_details.product_code','$product_details.type','staff','floor','json','return_sale','actual_uom','rack','barcode\x20Product\x20master','Sales\x20Mail','warehouse_name','expiry_date','push','/upload/','params','</head><body>','$product_details.bay','prod_cat','product_code','<strong>\x20Regards\x20</strong>','RoomAssigned','level','<h5>','/barcode_scanner','OUT-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','\x20Order\x20Number\x20:\x20','$product_details.unit','error','$product_details.invoice','/view/add_sales/:id','errors','due_amount','getDate','floorlevel','back','get','product_details','delivery_date','currency','language','product_name','maxperunit','name','$product_details._id','$warehouse_name','$isAllowEdit','find','findById','$sale_product.quantity','$product_details.pallet','customer','prod_code','$finalize','received_amount','catch','log','random','/view','$product_details.bin','message','Email\x20sent\x20successfully','storage','$product_details.product_name','save','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Router','<tbody\x20style=\x22text-align:\x20center;\x22>','../public/language/languages.json','redirect','21aaxuym','customer_data','</thead>','post','user','string','note','Shelves','product_stock','<html><head><title></title>','English\x20(US)','purchases_data','warehouse','master','/view/add_sales','date','$product_details.isle','$product_details.actual_uom','Sale\x20Return\x20Mail','quantity','return_data','type','$product_details.secondary_code','sendMail','$room','$product_details.expiry_date','carton','False','max','</tbody>','Sale\x20Return','3161872WyqLrj','\x20</h2>','flash','sale_product','7684eRyVRj','Receiving\x20Area','nodemailer','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<hr\x20class=\x22my-3\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$note','Raw\x20Materials','Spanish','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','English','Enclosed','secondary_code','Arabic\x20(ae)','$product_details.production_date','gmail','Return\x20Goods','customers_docs','requested_qty','sales_quantity','3582iLWUiz','body','$product_details.actual_qty','68362MVGQem','140771JBjJCN','aggregate','<span\x20style=\x22float:\x20right;\x22>','468996VzLqIN','/barcode/:id','concat','split','$product','types','getFullYear','bay','French','$sale_product.type','all','then','map','render','findOne','production_date','room','customers','unit','Sales\x20Add\x20successfully','</span>','sale_qty','sales_invoice','Return\x20Rooms','2069788igLbhf','stock','image','$sale_product.floorlevel','$_id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Floor','bin','</h5>','Ambient','Portuguese','/all_sales/view','Arabic','return_qty','German','length','forEach','/view/add_sale/product','/invoice/:id','final','$product_details.primary_code','express','130MHyiDw','/view/:id','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_invoice','logo','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<tr>','filter','/view/return_sales/:id','stock_data','success','isAllowEdit','product_data','host','$product_details.level','sales\x20item\x20return\x20successfull','status','$return_data','quantity_notConverted','primary_code','<h2>\x20','add\x20post','$product_details.rack','foreach\x20newproduct','$product_details.product_cat','$product_details.floorlevel','$product.product_name','/preview/:id','../models/all_models','secondary_unit','site_title','toString','$name','</tr>','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$customer','abs','finalize','$product_details.product_stock','delivery_code','/all_sales/preview/','primary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','product_list','$sale_product','createTransport','$sale_product.bin','invoice','$product_details','$product_details.batch_code','slice','</body></html>','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$invoice','Sales\x20Update\x20successfully'];a0_0x43ce=function(){return _0x815934;};return a0_0x43ce();}const express=require(a0_0x2463d6(0xf7)),app=express(),router=express[a0_0x2463d6(0x87)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2463d6(0x115)),auth=require('../middleware/auth'),nodemailer=require(a0_0x2463d6(0xb0)),users=require(a0_0x2463d6(0x89));router[a0_0x2463d6(0x169)](a0_0x2463d6(0x17f),auth,async(_0x5d7752,_0x3a6e1d)=>{var _0x51c5c8=a0_0x2463d6;try{const {username:_0x149ea8,email:_0x43763f,role:_0x221c27}=_0x5d7752[_0x51c5c8(0x8f)],_0x4c4528=_0x5d7752[_0x51c5c8(0x8f)],_0x39c3d3=await profile[_0x51c5c8(0xd7)]({'email':_0x4c4528['email']}),_0x5d8811=await master_shop['find']();let _0x6bb1bd;if(_0x4c4528['role']=='staff'){const _0x3ffca1=await staff[_0x51c5c8(0xd7)]({'email':_0x4c4528[_0x51c5c8(0x13e)]});_0x6bb1bd=await sales['aggregate']([{'$lookup':{'from':_0x51c5c8(0xda),'localField':_0x51c5c8(0x178),'foreignField':_0x51c5c8(0x170),'as':_0x51c5c8(0xbf)}},{'$unwind':_0x51c5c8(0x13d)},{'$unwind':_0x51c5c8(0x126)},{'$group':{'_id':_0x51c5c8(0xe5),'invoice':{'$first':_0x51c5c8(0x130)},'customers':{'$first':_0x51c5c8(0x11d)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x51c5c8(0x126)},'note':{'$first':_0x51c5c8(0xb4)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x51c5c8(0x13d)},'total_saleproduct_quantity':{'$sum':_0x51c5c8(0x176)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x51c5c8(0x128)},'type':{'$addToSet':_0x51c5c8(0xd2)},'pallet':{'$addToSet':_0x51c5c8(0xe4)},'finalize':{'$first':_0x51c5c8(0x17a)},'isAllowEdit':{'$first':_0x51c5c8(0x173)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x6bb1bd=await sales[_0x51c5c8(0xc7)]([{'$lookup':{'from':_0x51c5c8(0xda),'localField':_0x51c5c8(0x178),'foreignField':_0x51c5c8(0x170),'as':'customers_docs'}},{'$unwind':_0x51c5c8(0x13d)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x51c5c8(0x130)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x51c5c8(0x172)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x51c5c8(0xb4)},'return_data':{'$first':_0x51c5c8(0x10a)},'customers_docs':{'$first':_0x51c5c8(0x13d)},'total_saleproduct_quantity':{'$sum':_0x51c5c8(0x176)},'level':{'$addToSet':_0x51c5c8(0x132)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x51c5c8(0xd2)},'pallet':{'$addToSet':_0x51c5c8(0xe4)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x51c5c8(0x17d)]('sales\x20all_data',_0x6bb1bd);if(_0x5d8811[0x0][_0x51c5c8(0x16d)]==_0x51c5c8(0x95)){var _0x2e1a57=users[_0x51c5c8(0xb8)];console[_0x51c5c8(0x17d)](_0x2e1a57);}else{if(_0x5d8811[0x0][_0x51c5c8(0x16d)]==_0x51c5c8(0x12e))var _0x2e1a57=users[_0x51c5c8(0x12e)];else{if(_0x5d8811[0x0][_0x51c5c8(0x16d)]==_0x51c5c8(0xf0))var _0x2e1a57=users[_0x51c5c8(0xf0)];else{if(_0x5d8811[0x0][_0x51c5c8(0x16d)]==_0x51c5c8(0xb6))var _0x2e1a57=users[_0x51c5c8(0xb6)];else{if(_0x5d8811[0x0][_0x51c5c8(0x16d)]==_0x51c5c8(0xd1))var _0x2e1a57=users[_0x51c5c8(0xd1)];else{if(_0x5d8811[0x0]['language']==_0x51c5c8(0x140))var _0x2e1a57=users[_0x51c5c8(0xec)];else{if(_0x5d8811[0x0][_0x51c5c8(0x16d)]==_0x51c5c8(0x142))var _0x2e1a57=users[_0x51c5c8(0x142)];else{if(_0x5d8811[0x0]['language']==_0x51c5c8(0xbb))var _0x2e1a57=users[_0x51c5c8(0xee)];}}}}}}}_0x3a6e1d[_0x51c5c8(0xd6)]('all_sales',{'success':_0x5d7752[_0x51c5c8(0xac)](_0x51c5c8(0x103)),'errors':_0x5d7752['flash'](_0x51c5c8(0x164)),'sales':_0x6bb1bd,'profile':_0x39c3d3,'role':_0x4c4528,'master_shop':_0x5d8811,'language':_0x2e1a57});}catch(_0x424957){console['log'](_0x424957);}});async function getRandom8DigitNumber(){var _0x2d628a=a0_0x2463d6;const _0xe891cd=0x989680,_0x3274b4=0x5f5e0ff,_0xa062af=Math[_0x2d628a(0x148)](Math[_0x2d628a(0x17e)]()*(_0x3274b4-_0xe891cd+0x1))+_0xe891cd;var _0x19969b;const _0x46b4bf=await sales[_0x2d628a(0xd7)]({'invoice':_0x2d628a(0x15d)+_0xa062af});return _0x46b4bf&&_0x46b4bf[_0x2d628a(0xf1)]>0x0?_0x19969b=_0x2d628a(0x15d)+_0xa062af:_0x19969b=_0x2d628a(0x15d)+_0xa062af,_0x19969b;}router[a0_0x2463d6(0x169)](a0_0x2463d6(0x99),auth,async(_0x36d56c,_0x586841)=>{var _0x5cf4c0=a0_0x2463d6;try{const {username:_0x2d9efe,email:_0x38b28b,role:_0x37d72b}=_0x36d56c[_0x5cf4c0(0x8f)],_0x6b5bda=_0x36d56c[_0x5cf4c0(0x8f)],_0x34301e=await profile[_0x5cf4c0(0xd7)]({'email':_0x6b5bda[_0x5cf4c0(0x13e)]}),_0x36bde3=await master_shop[_0x5cf4c0(0x174)](),_0x36582f=await customer[_0x5cf4c0(0x174)]({});let _0x2ba42a;if(_0x6b5bda['role']=='staff'){const _0x19165d=await staff[_0x5cf4c0(0xd7)]({'email':_0x6b5bda[_0x5cf4c0(0x13e)]});_0x2ba42a=await warehouse[_0x5cf4c0(0xc7)]([{'$match':{'status':'Enabled','name':_0x19165d[_0x5cf4c0(0x97)],'warehouse_category':_0x5cf4c0(0xb5),'name':{'$ne':_0x5cf4c0(0xbe)}}},{'$group':{'_id':_0x5cf4c0(0x119),'name':{'$first':_0x5cf4c0(0x119)}}},{'$sort':{'name':0x1}}]);}else _0x2ba42a=await warehouse['aggregate']([{'$match':{'status':_0x5cf4c0(0x13a),'warehouse_category':_0x5cf4c0(0xb5),'name':{'$ne':_0x5cf4c0(0xbe)}}},{'$group':{'_id':_0x5cf4c0(0x119),'name':{'$first':_0x5cf4c0(0x119)}}},{'$sort':{'name':0x1}}]);const _0x524c06=await product[_0x5cf4c0(0x174)]({});var _0x49fb68=[_0x5cf4c0(0xeb),_0x5cf4c0(0xb9)];const _0x4b322e=await sales[_0x5cf4c0(0x174)]({}),_0x3fcf1d=_0x4b322e[_0x5cf4c0(0xf1)]+0x1,_0x284c24=_0x5cf4c0(0x15d)+_0x3fcf1d[_0x5cf4c0(0x118)]()['padStart'](0x5,'0');if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]==_0x5cf4c0(0x95)){var _0x13e80d=users[_0x5cf4c0(0xb8)];console[_0x5cf4c0(0x17d)](_0x13e80d);}else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]==_0x5cf4c0(0x12e))var _0x13e80d=users[_0x5cf4c0(0x12e)];else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]==_0x5cf4c0(0xf0))var _0x13e80d=users[_0x5cf4c0(0xf0)];else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]=='Spanish')var _0x13e80d=users[_0x5cf4c0(0xb6)];else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]==_0x5cf4c0(0xd1))var _0x13e80d=users[_0x5cf4c0(0xd1)];else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]=='Portuguese\x20(BR)')var _0x13e80d=users[_0x5cf4c0(0xec)];else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]==_0x5cf4c0(0x142))var _0x13e80d=users[_0x5cf4c0(0x142)];else{if(_0x36bde3[0x0][_0x5cf4c0(0x16d)]==_0x5cf4c0(0xbb))var _0x13e80d=users[_0x5cf4c0(0xee)];}}}}}}}const _0x1cb3ac=getRandom8DigitNumber();_0x1cb3ac[_0x5cf4c0(0xd4)](_0x1e02a6=>{var _0x47c462=_0x5cf4c0;_0x586841[_0x47c462(0xd6)]('add_sales',{'success':_0x36d56c['flash']('success'),'errors':_0x36d56c['flash'](_0x47c462(0x164)),'role':_0x6b5bda,'profile':_0x34301e,'customer':_0x36582f,'warehouse':_0x2ba42a,'product':_0x524c06,'invoice':_0x1e02a6,'master_shop':_0x36bde3,'language':_0x13e80d,'rooms_data':_0x49fb68});})['catch'](_0xea0d3c=>{var _0xf464d3=_0x5cf4c0;_0x36d56c[_0xf464d3(0xac)]('errors',_0xf464d3(0xe7)),_0x586841[_0xf464d3(0x8a)](_0xf464d3(0xed));});}catch(_0x4cbea9){console[_0x5cf4c0(0x17d)](_0x4cbea9);}}),router[a0_0x2463d6(0x169)](a0_0x2463d6(0x163),auth,async(_0xd1512,_0x27e537)=>{var _0x448879=a0_0x2463d6;try{const _0x2988e3=_0xd1512[_0x448879(0x153)]['id'];console[_0x448879(0x17d)](_0x2988e3);const _0x3f4125=await product['find'](),_0x5ba647=await purchases[_0x448879(0xc7)]([{'$match':{'warehouse_name':_0x2988e3}},{'$unwind':_0x448879(0xcd)},{'$group':{'_id':_0x448879(0x113)}}]);console[_0x448879(0x17d)](_0x448879(0x96),_0x5ba647),_0x27e537['status'](0xc8)[_0x448879(0x149)]({'purchases_data':_0x5ba647,'product_data':_0x3f4125});}catch(_0x418851){console['log'](_0x418851);}}),router[a0_0x2463d6(0x8e)](a0_0x2463d6(0xf3),auth,async(_0xdb19ad,_0x1d7956)=>{var _0x158fc7=a0_0x2463d6;try{const {warehouse_data:_0x745c14,product_data:_0x4d0bf7}=_0xdb19ad[_0x158fc7(0xc3)];console['log'](_0xdb19ad['body'][_0x158fc7(0x105)]);;const _0x47e591=await master_shop[_0x158fc7(0x174)]();console[_0x158fc7(0x17d)](_0x158fc7(0x98),_0x47e591);const _0x4de017=await product[_0x158fc7(0xd7)]({'name':_0x4d0bf7});console['log']('product',_0x4de017);const _0x133a35=await warehouse[_0x158fc7(0xc7)]([{'$match':{'name':_0x745c14}},{'$unwind':_0x158fc7(0x12a)},{'$match':{'product_details.product_name':_0x4d0bf7}},{'$group':{'_id':_0x158fc7(0x184),'product_stock':{'$first':_0x158fc7(0x120)}}}]);console[_0x158fc7(0x17d)](_0x158fc7(0x102),_0x133a35),_0x1d7956[_0x158fc7(0x109)](0xc8)[_0x158fc7(0x149)]({'master':_0x47e591,'new_product':_0x4de017,'stock_data':_0x133a35});}catch(_0xfafdf4){console[_0x158fc7(0x17d)](_0xfafdf4);}}),router[a0_0x2463d6(0x8e)](a0_0x2463d6(0x99),auth,async(_0x178d76,_0xce2211)=>{var _0x364044=a0_0x2463d6;try{const {invoice:_0x4a01dc,date:_0x3a33cb,warehouse_name:_0x4dd43d,product_name:_0x3cb726,stock:_0x241b6d,quantity:_0x14eb86,note:_0x4e0345,room:_0x2d6b3b,primary_code:_0x27a6cf,secondary_code:_0x666ebd,prod_code:_0x483764,level:_0x467d4f,isle:_0x59b13d,pallet:_0x200301,batch_code:_0x513262,SCRN:_0x3f0ccd,expiry_date:_0x277ba6}=_0x178d76[_0x364044(0xc3)];if(typeof _0x3cb726==_0x364044(0x90))var _0x4fedc6=[_0x178d76['body'][_0x364044(0x16e)]],_0x2d5309=[_0x178d76[_0x364044(0xc3)][_0x364044(0xe2)]],_0x1f9b3b=[_0x178d76[_0x364044(0xc3)]['carton']],_0x27f2b0=[_0x178d76[_0x364044(0xc3)][_0x364044(0x10c)]],_0x1fe589=[_0x178d76[_0x364044(0xc3)][_0x364044(0xba)]],_0x3c2776=[_0x178d76[_0x364044(0xc3)][_0x364044(0x179)]],_0xb3e96f=[_0x178d76['body'][_0x364044(0x15a)]],_0x4c60cf=[_0x178d76[_0x364044(0xc3)][_0x364044(0x123)]],_0x3f1d6d=[_0x178d76[_0x364044(0xc3)][_0x364044(0x116)]],_0x31ec08=[_0x178d76['body']['batch_code']],_0x5e0a3d=[_0x178d76[_0x364044(0xc3)]['expiry_date']],_0x38b269=[_0x178d76[_0x364044(0xc3)][_0x364044(0x136)]],_0x33d6a5=[_0x178d76[_0x364044(0xc3)][_0x364044(0xd8)]],_0x179e3e=[_0x178d76[_0x364044(0xc3)][_0x364044(0xc0)]],_0x2267a9=[_0x178d76[_0x364044(0xc3)][_0x364044(0x16b)]],_0x29d68d=[_0x178d76[_0x364044(0xc3)][_0x364044(0x121)]],_0x492e5f=[_0x178d76[_0x364044(0xc3)][_0x364044(0x156)]],_0x21af38=[_0x178d76[_0x364044(0xc3)]['quantity']],_0x1cc857=[_0x178d76[_0x364044(0xc3)]['RoomAssigned']],_0x4e5f9c=[_0x178d76[_0x364044(0xc3)][_0x364044(0xfc)]],_0x458801=[_0x178d76['body']['actual_qty']],_0x3275bd=[_0x178d76['body'][_0x364044(0x14b)]];else var _0x4fedc6=[..._0x178d76[_0x364044(0xc3)]['product_name']],_0x2d5309=[..._0x178d76['body'][_0x364044(0xe2)]],_0x1f9b3b=[..._0x178d76[_0x364044(0xc3)][_0x364044(0xa5)]],_0x27f2b0=[..._0x178d76['body']['primary_code']],_0x1fe589=[..._0x178d76[_0x364044(0xc3)][_0x364044(0xba)]],_0x3c2776=[..._0x178d76[_0x364044(0xc3)]['prod_code']],_0xb3e96f=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x15a)]],_0x4c60cf=[..._0x178d76['body'][_0x364044(0x123)]],_0x3f1d6d=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x116)]],_0x31ec08=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x139)]],_0x5e0a3d=[..._0x178d76['body'][_0x364044(0x150)]],_0x38b269=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x136)]],_0x33d6a5=[..._0x178d76[_0x364044(0xc3)]['production_date']],_0x179e3e=[..._0x178d76[_0x364044(0xc3)][_0x364044(0xc0)]],_0x2267a9=[..._0x178d76['body']['delivery_date']],_0x29d68d=[..._0x178d76['body'][_0x364044(0x121)]],_0x492e5f=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x156)]],_0x21af38=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x9e)]],_0x1cc857=[..._0x178d76[_0x364044(0xc3)]['RoomAssigned']],_0x4e5f9c=[..._0x178d76[_0x364044(0xc3)]['prod_invoice']],_0x458801=[..._0x178d76[_0x364044(0xc3)]['actual_qty']],_0x3275bd=[..._0x178d76[_0x364044(0xc3)][_0x364044(0x14b)]];const _0x1091a4=_0x4fedc6[_0x364044(0xd5)](_0x15d379=>{return _0x15d379={'product_name':_0x15d379};});_0x2d5309[_0x364044(0xf2)]((_0x20ac9d,_0x2a1149)=>{var _0x3f7b2c=_0x364044;_0x1091a4[_0x2a1149][_0x3f7b2c(0xe2)]=Math[_0x3f7b2c(0x11e)](_0x20ac9d);}),_0x458801[_0x364044(0xf2)]((_0x172e41,_0x2eff4e)=>{var _0x44b325=_0x364044;_0x1091a4[_0x2eff4e]['actual_qty']=Math[_0x44b325(0x11e)](_0x172e41);}),_0x3275bd[_0x364044(0xf2)]((_0x1423df,_0x27ee28)=>{var _0x4cd9fd=_0x364044;_0x1091a4[_0x27ee28][_0x4cd9fd(0x14b)]=_0x1423df;}),_0x1f9b3b[_0x364044(0xf2)]((_0x1465c1,_0x5dc02f)=>{_0x1091a4[_0x5dc02f]['quantity']=_0x1465c1;}),_0x27f2b0[_0x364044(0xf2)]((_0x27d8b1,_0x238925)=>{var _0x5f0b05=_0x364044;_0x1091a4[_0x238925][_0x5f0b05(0x10c)]=_0x27d8b1;}),_0x1fe589[_0x364044(0xf2)]((_0x281a13,_0x54f014)=>{var _0xfef1f2=_0x364044;_0x1091a4[_0x54f014][_0xfef1f2(0xba)]=_0x281a13;}),_0x3c2776[_0x364044(0xf2)]((_0x21e939,_0x37c0c0)=>{var _0x26253e=_0x364044;_0x1091a4[_0x37c0c0][_0x26253e(0x157)]=_0x21e939;}),_0xb3e96f[_0x364044(0xf2)]((_0x1527f3,_0x5382fb)=>{var _0x7e42a3=_0x364044;_0x1cc857[_0x7e42a3(0xf2)]((_0x23e471,_0x48c698)=>{var _0x35238d=_0x7e42a3;if(_0x23e471==_0x35238d(0xaf)&&_0x5382fb==_0x48c698){var _0x76b1a6=_0x1527f3[_0x35238d(0x12c)](0x3);_0x1091a4[_0x5382fb][_0x35238d(0x183)]=_0x1527f3[0x0],_0x1091a4[_0x5382fb][_0x35238d(0x14c)]=_0x1527f3[0x1],_0x1091a4[_0x5382fb][_0x35238d(0xd0)]=0x0,_0x1091a4[_0x5382fb]['bin']=0x0,_0x1091a4[_0x5382fb][_0x35238d(0xa0)]='Floor',_0x1091a4[_0x5382fb][_0x35238d(0x167)]=_0x76b1a6;}else{if(_0x23e471==_0x35238d(0x92)&&_0x5382fb==_0x48c698){var _0x76b1a6=_0x1527f3[_0x35238d(0x12c)](0x3);_0x1091a4[_0x5382fb]['storage']=_0x1527f3[0x0],_0x1091a4[_0x5382fb]['rack']=_0x1527f3[0x1],_0x1091a4[_0x5382fb]['bay']=0x0,_0x1091a4[_0x5382fb][_0x35238d(0xe9)]=0x0,_0x1091a4[_0x5382fb][_0x35238d(0xa0)]=_0x35238d(0xe8),_0x1091a4[_0x5382fb][_0x35238d(0x167)]=_0x1527f3[0x5];}else{if(_0x5382fb==_0x48c698){var _0x3f6cc0;if(_0x1527f3[0x4]=='L')_0x3f6cc0='Level';else _0x1527f3[0x4]=='F'&&(_0x3f6cc0=_0x35238d(0xe8));_0x1091a4[_0x5382fb][_0x35238d(0x183)]=_0x1527f3[0x0],_0x1091a4[_0x5382fb][_0x35238d(0x14c)]=_0x1527f3[0x1],_0x1091a4[_0x5382fb][_0x35238d(0xd0)]=_0x1527f3[0x2],_0x1091a4[_0x5382fb][_0x35238d(0xe9)]=_0x1527f3[0x3],_0x1091a4[_0x5382fb]['type']=_0x3f6cc0,_0x1091a4[_0x5382fb][_0x35238d(0x167)]=_0x1527f3[0x5];}}}});}),_0x4c60cf['forEach']((_0x1d50db,_0x5ca549)=>{var _0x1af616=_0x364044;_0x1091a4[_0x5ca549][_0x1af616(0xdb)]=_0x1d50db;}),_0x3f1d6d[_0x364044(0xf2)]((_0x2cbc5e,_0x3e64c7)=>{var _0x525bac=_0x364044;_0x1091a4[_0x3e64c7][_0x525bac(0x116)]=_0x2cbc5e;}),_0x31ec08[_0x364044(0xf2)]((_0x43b27e,_0x4c345c)=>{var _0x443188=_0x364044;_0x1091a4[_0x4c345c][_0x443188(0x139)]=_0x43b27e;}),_0x5e0a3d[_0x364044(0xf2)]((_0x9f8c74,_0x11c130)=>{var _0x570ced=_0x364044;_0x1091a4[_0x11c130][_0x570ced(0x150)]=_0x9f8c74;}),_0x38b269[_0x364044(0xf2)]((_0xb00821,_0x2d376f)=>{var _0x537e33=_0x364044;_0x1091a4[_0x2d376f][_0x537e33(0x16f)]=_0xb00821;}),_0x33d6a5[_0x364044(0xf2)]((_0x2b0d9e,_0x475e06)=>{var _0x5bff5b=_0x364044;_0x1091a4[_0x475e06][_0x5bff5b(0xd8)]=_0x2b0d9e;}),_0x179e3e[_0x364044(0xf2)]((_0x4d3736,_0x4ab616)=>{var _0xc08da3=_0x364044;_0x1091a4[_0x4ab616][_0xc08da3(0xc0)]=_0x4d3736;}),_0x2267a9[_0x364044(0xf2)]((_0x4a20a8,_0x23ddc6)=>{_0x1091a4[_0x23ddc6]['delivery_date']=_0x4a20a8;}),_0x29d68d[_0x364044(0xf2)]((_0x2f3f34,_0x1871f0)=>{var _0x579382=_0x364044;_0x1091a4[_0x1871f0][_0x579382(0x121)]=_0x2f3f34;}),_0x492e5f[_0x364044(0xf2)]((_0x271eed,_0x548aa5)=>{var _0x7bce80=_0x364044;_0x1091a4[_0x548aa5][_0x7bce80(0x156)]=_0x271eed;}),_0x21af38[_0x364044(0xf2)]((_0x16caa8,_0x335bee)=>{var _0x11e6a7=_0x364044;_0x1091a4[_0x335bee][_0x11e6a7(0x10b)]=_0x16caa8;}),_0x1cc857[_0x364044(0xf2)]((_0x197a58,_0x179145)=>{_0x1091a4[_0x179145]['room_name']=_0x197a58;}),_0x4e5f9c[_0x364044(0xf2)]((_0x91de7,_0x3e4c95)=>{_0x1091a4[_0x3e4c95]['invoice']=_0x91de7;});var _0xede8ed=0x0;_0x1091a4[_0x364044(0xf2)](_0x3da258=>{var _0x215c00=_0x364044;(_0x3da258['stock']<_0x3da258[_0x215c00(0x10b)]||_0x3da258[_0x215c00(0x10b)]==0x0)&&(console['log']('foreach\x20newproduct',_0x3da258),_0xede8ed++);});const _0x47a878=_0x1091a4['filter'](_0x1043aa=>_0x1043aa[_0x364044(0x9e)]!=='0'&&_0x1043aa[_0x364044(0x9e)]!==''),_0x572fa7=new sales({'invoice':_0x4a01dc,'customer':_0x178d76[_0x364044(0xc3)][_0x364044(0x178)],'date':_0x3a33cb,'warehouse_name':_0x4dd43d,'sale_product':_0x47a878,'note':_0x4e0345,'room':_0x2d6b3b,'primary_code':_0x27a6cf,'secondary_code':_0x666ebd,'prod_code':_0x483764,'SCRN':_0x3f0ccd}),_0x3825e5=await _0x572fa7[_0x364044(0x85)]();_0x178d76[_0x364044(0xac)]('success',_0x364044(0xdc)),_0xce2211['redirect']('/all_sales/preview/'+_0x3825e5['_id']);}catch(_0x54c1a5){console[_0x364044(0x17d)](_0x54c1a5);}}),router[a0_0x2463d6(0x169)](a0_0x2463d6(0x114),auth,async(_0x258697,_0x2cac40)=>{var _0x284079=a0_0x2463d6;try{const {username:_0x2175ea,email:_0xcac895,role:_0x13f3be}=_0x258697[_0x284079(0x8f)],_0x59d362=_0x258697[_0x284079(0x8f)],_0x446b57=await profile[_0x284079(0xd7)]({'email':_0x59d362[_0x284079(0x13e)]}),_0x4a1234=await master_shop[_0x284079(0x174)](),_0x3a1ac5=_0x258697['params']['id'],_0x5539f4=await sales['findById'](_0x3a1ac5),_0x208cc1=await warehouse[_0x284079(0xc7)]([{'$match':{'name':_0x5539f4[_0x284079(0x14f)]}},{'$unwind':_0x284079(0x12a)},{'$group':{'_id':_0x284079(0x171),'name':{'$first':_0x284079(0x184)},'product_stock':{'$first':_0x284079(0x120)},'bay':{'$first':_0x284079(0x155)},'bin':{'$first':_0x284079(0x180)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x284079(0x112)},'primary_code':{'$first':_0x284079(0xf6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x284079(0x11b)},'rack':{'$first':_0x284079(0x10f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x284079(0xbc)},'invoice':{'$first':_0x284079(0x162)}}}]),_0x524710=await customer[_0x284079(0x174)]({});let _0x5e2850;if(_0x59d362[_0x284079(0x133)]==_0x284079(0x147)){const _0xe4418b=await staff[_0x284079(0xd7)]({'email':_0x59d362['email']});_0x5e2850=await warehouse[_0x284079(0xc7)]([{'$match':{'status':'Enabled','name':_0xe4418b['warehouse']}},{'$group':{'_id':_0x284079(0x119),'name':{'$first':'$name'}}}]);}else _0x5e2850=await warehouse[_0x284079(0xc7)]([{'$match':{'status':_0x284079(0x13a)}},{'$group':{'_id':_0x284079(0x119),'name':{'$first':_0x284079(0x119)}}}]);const _0x38fce1=await product[_0x284079(0x174)]({}),_0x5d5f31=await suppliers[_0x284079(0x174)]({});if(_0x4a1234[0x0][_0x284079(0x16d)]==_0x284079(0x95)){var _0x55c844=users[_0x284079(0xb8)];console[_0x284079(0x17d)](_0x55c844);}else{if(_0x4a1234[0x0][_0x284079(0x16d)]==_0x284079(0x12e))var _0x55c844=users['Hindi'];else{if(_0x4a1234[0x0]['language']==_0x284079(0xf0))var _0x55c844=users[_0x284079(0xf0)];else{if(_0x4a1234[0x0]['language']==_0x284079(0xb6))var _0x55c844=users['Spanish'];else{if(_0x4a1234[0x0][_0x284079(0x16d)]=='French')var _0x55c844=users['French'];else{if(_0x4a1234[0x0][_0x284079(0x16d)]=='Portuguese\x20(BR)')var _0x55c844=users[_0x284079(0xec)];else{if(_0x4a1234[0x0][_0x284079(0x16d)]==_0x284079(0x142))var _0x55c844=users[_0x284079(0x142)];else{if(_0x4a1234[0x0][_0x284079(0x16d)]=='Arabic\x20(ae)')var _0x55c844=users['Arabic'];}}}}}}}_0x2cac40[_0x284079(0xd6)]('edit_sales_view',{'success':_0x258697[_0x284079(0xac)](_0x284079(0x103)),'errors':_0x258697[_0x284079(0xac)]('errors'),'role':_0x59d362,'profile':_0x446b57,'customer':_0x524710,'warehouse':_0x5e2850,'product':_0x208cc1,'user':_0x5539f4,'master_shop':_0x4a1234,'unit':_0x38fce1,'language':_0x55c844,'suppliers':_0x5d5f31});}catch(_0x48fd03){console[_0x284079(0x17d)](_0x48fd03);}}),router[a0_0x2463d6(0x8e)](a0_0x2463d6(0x114),auth,async(_0x7e0a1e,_0x5997cd)=>{var _0x24a069=a0_0x2463d6;try{const _0x158aa9=_0x7e0a1e[_0x24a069(0x153)]['id'],{invoice:_0x435c32,warehouse_name:_0x5eca28,room:_0xb7dadd}=_0x7e0a1e['body'],_0x3d8ad8=await sales[_0x24a069(0xd7)]({'invoice':_0x435c32}),_0x34f740=_0x3d8ad8[_0x24a069(0xad)]['map'](async _0x341d2f=>{var _0x3e5e4d=_0x24a069,_0x73e153=await warehouse['findOne']({'name':_0x5eca28,'room':_0x341d2f[_0x3e5e4d(0x13b)],'warehouse_category':'Raw\x20Materials'});const _0x3b59ba=_0x73e153[_0x3e5e4d(0x16a)][_0x3e5e4d(0xd5)](_0x127088=>{var _0x283d53=_0x3e5e4d;_0x127088[_0x283d53(0x16e)]==_0x341d2f[_0x283d53(0x16e)]&&_0x127088[_0x283d53(0x167)]==_0x341d2f[_0x283d53(0x167)]&&_0x127088[_0x283d53(0xa0)]==_0x341d2f[_0x283d53(0xa0)]&&_0x127088[_0x283d53(0xe9)]==_0x341d2f[_0x283d53(0xe9)]&&_0x127088[_0x283d53(0xd0)]==_0x341d2f[_0x283d53(0xd0)]&&_0x127088[_0x283d53(0x14c)]==_0x341d2f['rack']&&_0x127088[_0x283d53(0x183)]==_0x341d2f[_0x283d53(0x183)]&&_0x127088[_0x283d53(0x150)]==_0x341d2f[_0x283d53(0x150)]&&_0x127088[_0x283d53(0x139)]==_0x341d2f['batch_code']&&_0x127088[_0x283d53(0x129)]==_0x341d2f[_0x283d53(0x129)]&&(_0x127088[_0x283d53(0x93)]=Math[_0x283d53(0xa7)](0x0,Math[_0x283d53(0x11e)](_0x127088[_0x283d53(0x93)])-Math[_0x283d53(0x11e)](_0x341d2f[_0x283d53(0x9e)])));});return _0x73e153;});Promise[_0x24a069(0xd3)](_0x34f740)[_0x24a069(0xd4)](async _0x3a03d3=>{var _0x302b2d=_0x24a069;try{for(const _0x486601 of _0x3a03d3){await _0x486601[_0x302b2d(0x85)]();}_0x3d8ad8[_0x302b2d(0x11f)]=_0x302b2d(0x135);const _0x5d0162=await _0x3d8ad8['save'](),_0x98ebf1=await master_shop[_0x302b2d(0x174)](),_0x4e9fdf=await email_settings['findOne'](),_0x3647b9=await supervisor_settings['find']();var _0x24cf95=_0x3d8ad8[_0x302b2d(0xad)],_0xb1f617='',_0x4b4107;for(_0x4b4107 in _0x24cf95){_0xb1f617+=_0x302b2d(0xff)+_0x302b2d(0x86)+_0x24cf95[_0x4b4107][_0x302b2d(0x16e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24cf95[_0x4b4107]['product_code']+_0x302b2d(0x13c)+_0x302b2d(0x86)+_0x24cf95[_0x4b4107]['quantity']+'</td>'+_0x302b2d(0x86)+_0x24cf95[_0x4b4107][_0x302b2d(0xdb)]+_0x302b2d(0x13c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24cf95[_0x4b4107][_0x302b2d(0x116)]+_0x302b2d(0x13c)+_0x302b2d(0x86)+_0x3d8ad8['warehouse_name']+_0x302b2d(0x13c)+_0x302b2d(0x86)+_0x24cf95[_0x4b4107][_0x302b2d(0x13b)]+_0x302b2d(0x13c)+_0x302b2d(0x86)+_0x24cf95[_0x4b4107]['storage']+_0x24cf95[_0x4b4107]['rack']+_0x24cf95[_0x4b4107]['bay']+_0x24cf95[_0x4b4107]['bin']+_0x24cf95[_0x4b4107]['type'][0x0]+_0x24cf95[_0x4b4107][_0x302b2d(0x167)]+'</td>','</tr>';}let _0x449b89=nodemailer[_0x302b2d(0x127)]({'host':_0x4e9fdf[_0x302b2d(0x106)],'port':Number(_0x4e9fdf['port']),'secure':![],'auth':{'user':_0x4e9fdf[_0x302b2d(0x13e)],'pass':_0x4e9fdf['password']}}),_0x18ab96={'from':_0x4e9fdf[_0x302b2d(0x13e)],'to':_0x3647b9[0x0]['RMSEmail'],'subject':_0x302b2d(0x14e),'attachments':[{'filename':_0x302b2d(0x137),'path':__dirname+_0x302b2d(0x13f)+_0x302b2d(0x152)+_0x98ebf1[0x0][_0x302b2d(0xe3)],'cid':_0x302b2d(0xfd)}],'html':_0x302b2d(0x141)+_0x302b2d(0x94)+_0x302b2d(0x154)+'<div>'+_0x302b2d(0xe6)+_0x302b2d(0x134)+_0x302b2d(0xb3)+_0x302b2d(0x144)+_0x302b2d(0x134)+_0x302b2d(0x10d)+_0x98ebf1[0x0][_0x302b2d(0x117)]+_0x302b2d(0xab)+_0x302b2d(0x144)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x302b2d(0x15f)+_0x3d8ad8[_0x302b2d(0x129)]+'\x20'+_0x302b2d(0xc8)+_0x302b2d(0x138)+_0x3d8ad8['date']+'\x20'+_0x302b2d(0xdd)+'</h5>'+_0x302b2d(0x144)+_0x302b2d(0xb1)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x302b2d(0xff)+_0x302b2d(0x15e)+_0x302b2d(0x11c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x302b2d(0x12f)+_0x302b2d(0xfb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x302b2d(0x124)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x302b2d(0x8d)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xb1f617+'\x20'+_0x302b2d(0xa8)+_0x302b2d(0xfa)+'<div>'+_0x302b2d(0x158)+_0x302b2d(0x15b)+_0x98ebf1[0x0][_0x302b2d(0x117)]+_0x302b2d(0xea)+_0x302b2d(0x144)+'</div>'+_0x302b2d(0x12d)};_0x449b89[_0x302b2d(0xa2)](_0x18ab96,function(_0x4d7f07,_0xc8a9d2){var _0x542baa=_0x302b2d;_0x4d7f07?(console[_0x542baa(0x17d)](_0x4d7f07),console['log']('Error\x20Occurs')):console[_0x542baa(0x17d)](_0x542baa(0x182));}),_0x7e0a1e[_0x302b2d(0xac)]('success','Sales\x20Update\x20successfully'),_0x5997cd[_0x302b2d(0x8a)](_0x302b2d(0x122)+_0x158aa9);}catch(_0x46477e){console[_0x302b2d(0x161)](_0x46477e),_0x5997cd[_0x302b2d(0x109)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x24a069(0x17c)](_0x35aa20=>{var _0x281105=_0x24a069;console[_0x281105(0x161)](_0x35aa20),_0x5997cd['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0xf99434){console[_0x24a069(0x17d)](_0xf99434);}}),router[a0_0x2463d6(0x169)](a0_0x2463d6(0xf9),auth,async(_0x2d4302,_0xa5a674)=>{var _0x502968=a0_0x2463d6;try{const {username:_0x5108ca,email:_0x2439cb,role:_0xf69f25}=_0x2d4302['user'],_0x315d1d=_0x2d4302[_0x502968(0x8f)],_0x5484d6=await profile[_0x502968(0xd7)]({'email':_0x315d1d[_0x502968(0x13e)]}),_0x2cc786=await master_shop[_0x502968(0x174)](),_0x5392d0=_0x2d4302[_0x502968(0x153)]['id'],_0x5e9214=await sales[_0x502968(0x175)](_0x5392d0);var _0x4ddec2=['Ambient','Enclosed'];const _0x37e2bb=await warehouse[_0x502968(0xc7)]([{'$match':{'name':_0x5e9214[_0x502968(0x14f)],'warehouse_category':_0x502968(0xb5)}},{'$unwind':_0x502968(0x12a)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x502968(0x184)},'product_stock':{'$first':_0x502968(0x120)},'bay':{'$first':_0x502968(0x155)},'bin':{'$first':_0x502968(0x180)},'type':{'$first':_0x502968(0x146)},'floorlevel':{'$first':_0x502968(0x112)},'primary_code':{'$first':_0x502968(0xf6)},'secondary_code':{'$first':_0x502968(0xa1)},'product_code':{'$first':_0x502968(0x145)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x502968(0x10f)}}}]),_0x49fc45=await customer[_0x502968(0x174)]({});let _0x5390a2;if(_0x315d1d['role']=='staff'){const _0x538bda=await staff['findOne']({'email':_0x315d1d[_0x502968(0x13e)]});_0x5390a2=await warehouse['aggregate']([{'$match':{'status':_0x502968(0x13a),'name':_0x538bda[_0x502968(0x97)],'warehouse_category':_0x502968(0xb5)}},{'$group':{'_id':_0x502968(0x119),'name':{'$first':'$name'}}}]);}else _0x5390a2=await warehouse[_0x502968(0xc7)]([{'$match':{'status':_0x502968(0x13a),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x502968(0x119),'name':{'$first':'$name'}}}]);const _0x42761e=await product['find']({});if(_0x2cc786[0x0][_0x502968(0x16d)]==_0x502968(0x95)){var _0x311203=users['English'];console['log'](_0x311203);}else{if(_0x2cc786[0x0]['language']==_0x502968(0x12e))var _0x311203=users['Hindi'];else{if(_0x2cc786[0x0][_0x502968(0x16d)]==_0x502968(0xf0))var _0x311203=users[_0x502968(0xf0)];else{if(_0x2cc786[0x0][_0x502968(0x16d)]==_0x502968(0xb6))var _0x311203=users[_0x502968(0xb6)];else{if(_0x2cc786[0x0]['language']==_0x502968(0xd1))var _0x311203=users['French'];else{if(_0x2cc786[0x0][_0x502968(0x16d)]=='Portuguese\x20(BR)')var _0x311203=users['Portuguese'];else{if(_0x2cc786[0x0][_0x502968(0x16d)]=='Chinese')var _0x311203=users[_0x502968(0x142)];else{if(_0x2cc786[0x0][_0x502968(0x16d)]==_0x502968(0xbb))var _0x311203=users[_0x502968(0xee)];}}}}}}}_0xa5a674[_0x502968(0xd6)]('edit_sales',{'success':_0x2d4302[_0x502968(0xac)](_0x502968(0x103)),'errors':_0x2d4302['flash'](_0x502968(0x164)),'role':_0x315d1d,'profile':_0x5484d6,'customer':_0x49fc45,'warehouse':_0x5390a2,'product':_0x37e2bb,'user':_0x5e9214,'master_shop':_0x2cc786,'unit':_0x42761e,'language':_0x311203});}catch(_0x3fb068){console[_0x502968(0x17d)](_0x3fb068);}}),router[a0_0x2463d6(0x8e)](a0_0x2463d6(0xf9),auth,async(_0xc59373,_0x32bdda)=>{var _0x4a28f1=a0_0x2463d6;try{const _0x86df28=_0xc59373[_0x4a28f1(0x153)]['id'],_0x5231bf=await sales[_0x4a28f1(0xd7)]({'_id':_0xc59373[_0x4a28f1(0x153)]['id']}),_0x39565c=await warehouse['findOne']({'name':_0x5231bf[_0x4a28f1(0x14f)],'room':_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xd9)]}),{invoice:_0x19626e,date:_0x1f739e,warehouse_name:_0x407f10,product_name:_0x3a9592,stock:_0x318463,quantity:_0x260427,note:_0xab5dba,room:_0x138855,customer:_0x2ea9c8,SCRN:_0x5ea2c6}=_0xc59373['body'];if(typeof _0x3a9592==_0x4a28f1(0x90))var _0x14a9d4=[_0xc59373[_0x4a28f1(0xc3)]['product_name']],_0x511ff6=[_0xc59373['body'][_0x4a28f1(0xe2)]],_0x54dff6=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xa5)]],_0x2f0c1f=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x10c)]],_0x3ffd95=[_0xc59373[_0x4a28f1(0xc3)]['secondary_code']],_0xe14329=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x179)]],_0x3acb88=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x15a)]],_0x3ebaf4=[_0xc59373['body'][_0x4a28f1(0x123)]],_0x3d6670=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x116)]],_0x4e6904=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x139)]],_0x163d0a=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x150)]],_0x101ef7=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x136)]],_0x24f691=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xd8)]],_0x4a0dd1=[_0xc59373['body'][_0x4a28f1(0xc0)]],_0x2f75d6=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x16b)]],_0x5baa96=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x121)]],_0x35ea21=[_0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x156)]],_0x4c7a70=[_0xc59373[_0x4a28f1(0xc3)]['quantity']],_0x4fdc03=[_0xc59373['body'][_0x4a28f1(0x159)]];else var _0x14a9d4=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x16e)]],_0x511ff6=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xe2)]],_0x54dff6=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xa5)]],_0x2f0c1f=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x10c)]],_0x3ffd95=[..._0xc59373['body'][_0x4a28f1(0xba)]],_0xe14329=[..._0xc59373['body']['prod_code']],_0x3acb88=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x15a)]],_0x3ebaf4=[..._0xc59373[_0x4a28f1(0xc3)]['primary_unit']],_0x3d6670=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x116)]],_0x4e6904=[..._0xc59373['body'][_0x4a28f1(0x139)]],_0x163d0a=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x150)]],_0x101ef7=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x136)]],_0x24f691=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xd8)]],_0x4a0dd1=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0xc0)]],_0x2f75d6=[..._0xc59373[_0x4a28f1(0xc3)]['delivery_date']],_0x5baa96=[..._0xc59373[_0x4a28f1(0xc3)]['delivery_code']],_0x35ea21=[..._0xc59373[_0x4a28f1(0xc3)]['prod_cat']],_0x4c7a70=[..._0xc59373[_0x4a28f1(0xc3)][_0x4a28f1(0x9e)]],_0x4fdc03=[..._0xc59373['body'][_0x4a28f1(0x159)]];const _0x42d431=_0x14a9d4['map'](_0x4c4db6=>{return _0x4c4db6={'product_name':_0x4c4db6};});_0x511ff6[_0x4a28f1(0xf2)]((_0x5192dc,_0x46580f)=>{_0x42d431[_0x46580f]['stock']=Math['abs'](_0x5192dc);}),_0x54dff6[_0x4a28f1(0xf2)]((_0x450da3,_0xd0ada9)=>{var _0x31a9db=_0x4a28f1;_0x42d431[_0xd0ada9][_0x31a9db(0x9e)]=_0x450da3;}),_0x2f0c1f['forEach']((_0x579ffc,_0x3afe11)=>{var _0x4b3cd9=_0x4a28f1;_0x42d431[_0x3afe11][_0x4b3cd9(0x10c)]=_0x579ffc;}),_0x3ffd95['forEach']((_0x3f43ac,_0x1eb293)=>{var _0x43fb91=_0x4a28f1;_0x42d431[_0x1eb293][_0x43fb91(0xba)]=_0x3f43ac;}),_0xe14329[_0x4a28f1(0xf2)]((_0x13b439,_0x1c81db)=>{var _0x22bf65=_0x4a28f1;_0x42d431[_0x1c81db][_0x22bf65(0x157)]=_0x13b439;}),_0x3acb88[_0x4a28f1(0xf2)]((_0xfe582e,_0x56f524)=>{_0x4fdc03['forEach']((_0x56fc4c,_0x472d9d)=>{var _0x4d8bfb=a0_0x57fa;if(_0x56fc4c==_0x4d8bfb(0xaf)&&_0x56f524==_0x472d9d){var _0x22e140=_0xfe582e[_0x4d8bfb(0x12c)](0x3);_0x42d431[_0x56f524][_0x4d8bfb(0x183)]=_0xfe582e[0x0],_0x42d431[_0x56f524][_0x4d8bfb(0x14c)]=_0xfe582e[0x1],_0x42d431[_0x56f524][_0x4d8bfb(0xd0)]=0x0,_0x42d431[_0x56f524]['bin']=0x0,_0x42d431[_0x56f524][_0x4d8bfb(0xa0)]=_0x4d8bfb(0xe8),_0x42d431[_0x56f524]['floorlevel']=_0x22e140;}else{if(_0x56fc4c==_0x4d8bfb(0x92)&&_0x56f524==_0x472d9d){var _0x22e140=_0xfe582e[_0x4d8bfb(0x12c)](0x3);_0x42d431[_0x56f524][_0x4d8bfb(0x183)]=_0xfe582e[0x0],_0x42d431[_0x56f524][_0x4d8bfb(0x14c)]=_0xfe582e[0x1],_0x42d431[_0x56f524]['bay']=0x0,_0x42d431[_0x56f524][_0x4d8bfb(0xe9)]=0x0,_0x42d431[_0x56f524][_0x4d8bfb(0xa0)]=_0x4d8bfb(0xe8),_0x42d431[_0x56f524][_0x4d8bfb(0x167)]=_0xfe582e[0x5];}else{if(_0x56f524==_0x472d9d){var _0x39b1e6;if(_0xfe582e[0x4]=='L')_0x39b1e6='Level';else _0xfe582e[0x4]=='F'&&(_0x39b1e6='Floor');_0x42d431[_0x56f524][_0x4d8bfb(0x183)]=_0xfe582e[0x0],_0x42d431[_0x56f524][_0x4d8bfb(0x14c)]=_0xfe582e[0x1],_0x42d431[_0x56f524]['bay']=_0xfe582e[0x2],_0x42d431[_0x56f524][_0x4d8bfb(0xe9)]=_0xfe582e[0x3],_0x42d431[_0x56f524][_0x4d8bfb(0xa0)]=_0x39b1e6,_0x42d431[_0x56f524][_0x4d8bfb(0x167)]=_0xfe582e[0x5];}}}});}),_0x3ebaf4[_0x4a28f1(0xf2)]((_0x494ee4,_0x8e224f)=>{var _0x515ec4=_0x4a28f1;_0x42d431[_0x8e224f][_0x515ec4(0xdb)]=_0x494ee4;}),_0x3d6670[_0x4a28f1(0xf2)]((_0x1ee4ad,_0x89313d)=>{var _0x2e83d4=_0x4a28f1;_0x42d431[_0x89313d][_0x2e83d4(0x116)]=_0x1ee4ad;}),_0x4e6904[_0x4a28f1(0xf2)]((_0x4f152d,_0x48af6f)=>{var _0x4b4a18=_0x4a28f1;_0x42d431[_0x48af6f][_0x4b4a18(0x139)]=_0x4f152d;}),_0x163d0a[_0x4a28f1(0xf2)]((_0x5ab868,_0x486a08)=>{var _0x8678e1=_0x4a28f1;_0x42d431[_0x486a08][_0x8678e1(0x150)]=_0x5ab868;}),_0x101ef7['forEach']((_0x514259,_0xeb6b04)=>{var _0x5e763f=_0x4a28f1;_0x42d431[_0xeb6b04][_0x5e763f(0x16f)]=_0x514259;}),_0x24f691[_0x4a28f1(0xf2)]((_0xfcaeb,_0x45c16a)=>{_0x42d431[_0x45c16a]['production_date']=_0xfcaeb;}),_0x4a0dd1[_0x4a28f1(0xf2)]((_0x271949,_0x3af481)=>{var _0x12453d=_0x4a28f1;_0x42d431[_0x3af481][_0x12453d(0xc0)]=Math[_0x12453d(0x11e)](_0x271949);}),_0x2f75d6[_0x4a28f1(0xf2)]((_0x39f058,_0x4af1d9)=>{var _0x253e96=_0x4a28f1;_0x42d431[_0x4af1d9][_0x253e96(0x16b)]=_0x39f058;}),_0x5baa96['forEach']((_0x2dfcbe,_0x5d3509)=>{var _0x42f7ad=_0x4a28f1;_0x42d431[_0x5d3509][_0x42f7ad(0x121)]=_0x2dfcbe;}),_0x35ea21[_0x4a28f1(0xf2)]((_0x5bb364,_0x2006f3)=>{var _0x237c3e=_0x4a28f1;_0x42d431[_0x2006f3][_0x237c3e(0x156)]=_0x5bb364;}),_0x4c7a70[_0x4a28f1(0xf2)]((_0x3471f7,_0x128432)=>{var _0x28cbc1=_0x4a28f1;_0x42d431[_0x128432][_0x28cbc1(0x10b)]=_0x3471f7;}),_0x4fdc03[_0x4a28f1(0xf2)]((_0x2e40da,_0x3f6012)=>{_0x42d431[_0x3f6012]['room_name']=_0x2e40da;});var _0xbfe789=0x0;_0x42d431[_0x4a28f1(0xf2)](_0x12ba04=>{var _0x14db51=_0x4a28f1;console[_0x14db51(0x17d)](_0x14db51(0x110),_0x12ba04),(parseInt(_0x12ba04[_0x14db51(0xe2)])<parseInt(_0x12ba04[_0x14db51(0x9e)])||parseInt(_0x12ba04['quantity'])==0x0)&&_0xbfe789++;});if(_0xbfe789!=0x0)return _0xc59373['flash'](_0x4a28f1(0x164),_0x4a28f1(0xfe)),_0x32bdda[_0x4a28f1(0x8a)](_0x4a28f1(0x168));const _0x2438ec=_0x42d431[_0x4a28f1(0x100)](_0x2e4665=>_0x2e4665[_0x4a28f1(0x9e)]!=='0'&&_0x2e4665[_0x4a28f1(0x9e)]!=='');_0x5231bf[_0x4a28f1(0x129)]=_0x19626e,_0x5231bf[_0x4a28f1(0x178)]=_0x2ea9c8,_0x5231bf[_0x4a28f1(0x9a)]=_0x1f739e,_0x5231bf['warehouse_name']=_0x407f10,_0x5231bf[_0x4a28f1(0xad)]=_0x2438ec,_0x5231bf[_0x4a28f1(0x91)]=_0xab5dba,_0x5231bf['SCRN']=_0x5ea2c6,_0x5231bf['finalize']=_0x4a28f1(0xa6),_0x5231bf[_0x4a28f1(0x104)]='False';const _0x14a9a8=await _0x5231bf[_0x4a28f1(0x85)]();_0xc59373[_0x4a28f1(0xac)](_0x4a28f1(0x103),_0x4a28f1(0x131)),_0x32bdda['redirect']('/all_sales/view');}catch(_0x185192){console[_0x4a28f1(0x17d)](_0x185192);}}),router[a0_0x2463d6(0x8e)]('/give_payment/:id',auth,async(_0x2cc374,_0x3fce59)=>{var _0x3ee609=a0_0x2463d6;try{const _0x3b21b4=_0x2cc374[_0x3ee609(0x153)]['id'],{invoice:_0x341c20,customer:_0x25492d,receivable_amount:_0x49f1ef,received_amount:_0x211868}=_0x2cc374[_0x3ee609(0xc3)],_0x5c3e73=await sales['findById'](_0x3b21b4);console[_0x3ee609(0x17d)](_0x5c3e73);var _0x4f16c4=_0x49f1ef-_0x211868;console[_0x3ee609(0x17d)](_0x211868),_0x5c3e73[_0x3ee609(0x17b)]=parseFloat(_0x211868)+parseFloat(_0x5c3e73[_0x3ee609(0x17b)]),_0x5c3e73[_0x3ee609(0x165)]=_0x4f16c4,console[_0x3ee609(0x17d)](_0x5c3e73);const _0x2fcdce=await _0x5c3e73[_0x3ee609(0x85)](),_0x5328e1=await c_payment_data[_0x3ee609(0xd7)]({'invoice':_0x341c20});_0x5328e1['amount']=_0x4f16c4,await _0x5328e1[_0x3ee609(0x85)]();let _0x504a0e=new Date(),_0x2c40a5=('0'+_0x504a0e[_0x3ee609(0x166)]())['slice'](-0x2),_0x260eae=('0'+(_0x504a0e['getMonth']()+0x1))[_0x3ee609(0x12c)](-0x2),_0x5bb152=_0x504a0e[_0x3ee609(0xcf)](),_0x170c33=_0x5bb152+'-'+_0x260eae+'-'+_0x2c40a5;const _0x2ba962=new customer_payment({'invoice':_0x341c20,'date':_0x5bb152+'-'+_0x260eae+'-'+_0x2c40a5,'customer':_0x25492d,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x211868}),_0x5f0f2c=await _0x2ba962[_0x3ee609(0x85)]();_0x2cc374[_0x3ee609(0xac)](_0x3ee609(0x103),'payment\x20successfull'),_0x3fce59['redirect'](_0x3ee609(0xed));}catch(_0x31c82b){console[_0x3ee609(0x17d)](_0x31c82b);}}),router[a0_0x2463d6(0x169)](a0_0x2463d6(0xf4),auth,async(_0x1d7cde,_0x14cd4a)=>{var _0x460b12=a0_0x2463d6;try{const {username:_0x50e790,email:_0x1c5a2a,role:_0x5944ec}=_0x1d7cde['user'],_0x301d8b=_0x1d7cde['user'],_0x37d064=await profile[_0x460b12(0xd7)]({'email':_0x301d8b[_0x460b12(0x13e)]}),_0x16bcea=await master_shop[_0x460b12(0x174)]();console['log'](_0x460b12(0x98),_0x16bcea);const _0x526b2d=_0x1d7cde[_0x460b12(0x153)]['id'],_0x5b3ccc=await sales['findById'](_0x526b2d);console[_0x460b12(0x17d)](_0x5b3ccc);const _0x202b5e=await customer[_0x460b12(0xd7)]({'name':_0x5b3ccc[_0x460b12(0x178)]});console[_0x460b12(0x17d)](_0x202b5e);if(_0x16bcea[0x0][_0x460b12(0x16d)]=='English\x20(US)'){var _0x5c863f=users[_0x460b12(0xb8)];console[_0x460b12(0x17d)](_0x5c863f);}else{if(_0x16bcea[0x0]['language']==_0x460b12(0x12e))var _0x5c863f=users[_0x460b12(0x12e)];else{if(_0x16bcea[0x0][_0x460b12(0x16d)]=='German')var _0x5c863f=users['German'];else{if(_0x16bcea[0x0][_0x460b12(0x16d)]=='Spanish')var _0x5c863f=users[_0x460b12(0xb6)];else{if(_0x16bcea[0x0][_0x460b12(0x16d)]=='French')var _0x5c863f=users[_0x460b12(0xd1)];else{if(_0x16bcea[0x0][_0x460b12(0x16d)]==_0x460b12(0x140))var _0x5c863f=users[_0x460b12(0xec)];else{if(_0x16bcea[0x0][_0x460b12(0x16d)]==_0x460b12(0x142))var _0x5c863f=users[_0x460b12(0x142)];else{if(_0x16bcea[0x0][_0x460b12(0x16d)]==_0x460b12(0xbb))var _0x5c863f=users[_0x460b12(0xee)];}}}}}}}_0x14cd4a[_0x460b12(0xd6)](_0x460b12(0xdf),{'success':_0x1d7cde['flash']('success'),'errors':_0x1d7cde[_0x460b12(0xac)](_0x460b12(0x164)),'role':_0x301d8b,'profile':_0x37d064,'master_shop':_0x16bcea,'customers':_0x202b5e,'sales':_0x5b3ccc,'language':_0x5c863f});}catch(_0x572ab4){console[_0x460b12(0x17d)](_0x572ab4);}}),router[a0_0x2463d6(0x169)]('/view/return_sales/:id',auth,async(_0x1a12c6,_0x2a6805)=>{var _0x452f80=a0_0x2463d6;try{const {username:_0x41b3c7,email:_0x2d40cd,role:_0x4d7b67}=_0x1a12c6[_0x452f80(0x8f)],_0xb5e241=_0x1a12c6[_0x452f80(0x8f)],_0x1c2994=await profile[_0x452f80(0xd7)]({'email':_0xb5e241['email']}),_0x43a191=await master_shop[_0x452f80(0x174)]();console[_0x452f80(0x17d)](_0x452f80(0x98),_0x43a191);const _0x9c6dbc=_0x1a12c6[_0x452f80(0x153)]['id'];console[_0x452f80(0x17d)](_0x9c6dbc);const _0x53091b=await sales[_0x452f80(0x175)](_0x9c6dbc);console[_0x452f80(0x17d)]('user_id',_0x53091b);const _0x36c938=await warehouse[_0x452f80(0xc7)]([{'$match':{'name':_0x452f80(0xbe),'room':_0x452f80(0xe0)}},{'$unwind':_0x452f80(0x12a)},{'$group':{'_id':_0x452f80(0x171),'name':{'$first':_0x452f80(0x184)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x452f80(0x107)},'isle':{'$first':_0x452f80(0x9b)},'pallet':{'$first':_0x452f80(0x177)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x452f80(0xa1)},'product_code':{'$first':_0x452f80(0x145)}}}]);console[_0x452f80(0x17d)](_0x452f80(0x102),_0x36c938);const _0x40132e=await product[_0x452f80(0x174)]({});warehouse_data=await warehouse[_0x452f80(0xc7)]([{'$match':{'status':_0x452f80(0x13a),'name':_0x452f80(0xbe),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x452f80(0x119)}}},{'$sort':{'name':0x1}}]);var _0x3c4b1e=[_0x452f80(0xe0)];if(_0x43a191[0x0][_0x452f80(0x16d)]==_0x452f80(0x95)){var _0x14d3fa=users['English'];console[_0x452f80(0x17d)](_0x14d3fa);}else{if(_0x43a191[0x0][_0x452f80(0x16d)]==_0x452f80(0x12e))var _0x14d3fa=users[_0x452f80(0x12e)];else{if(_0x43a191[0x0]['language']==_0x452f80(0xf0))var _0x14d3fa=users[_0x452f80(0xf0)];else{if(_0x43a191[0x0][_0x452f80(0x16d)]==_0x452f80(0xb6))var _0x14d3fa=users[_0x452f80(0xb6)];else{if(_0x43a191[0x0][_0x452f80(0x16d)]==_0x452f80(0xd1))var _0x14d3fa=users['French'];else{if(_0x43a191[0x0][_0x452f80(0x16d)]==_0x452f80(0x140))var _0x14d3fa=users[_0x452f80(0xec)];else{if(_0x43a191[0x0][_0x452f80(0x16d)]=='Chinese')var _0x14d3fa=users[_0x452f80(0x142)];else{if(_0x43a191[0x0][_0x452f80(0x16d)]=='Arabic\x20(ae)')var _0x14d3fa=users['Arabic'];}}}}}}}_0x2a6805[_0x452f80(0xd6)](_0x452f80(0x14a),{'success':_0x1a12c6[_0x452f80(0xac)](_0x452f80(0x103)),'errors':_0x1a12c6[_0x452f80(0xac)](_0x452f80(0x164)),'role':_0xb5e241,'profile':_0x1c2994,'user':_0x53091b,'stock':_0x36c938,'master_shop':_0x43a191,'unit':_0x40132e,'language':_0x14d3fa,'warehouses':warehouse_data,'rooms':_0x3c4b1e});}catch(_0x1268eb){console[_0x452f80(0x17d)](_0x1268eb),_0x2a6805['status'](0xc8)[_0x452f80(0x149)]({'message':_0x1268eb[_0x452f80(0x181)]});}}),router['post'](a0_0x2463d6(0x101),auth,async(_0x42d675,_0x5db842)=>{var _0xbdc993=a0_0x2463d6;try{const {invoice:_0x42a8b3,date:_0x503dd2,warehouse_name:_0x4ffeeb,product_name:_0x2cd3f3,primary_code:_0x22fd7b,secondary_code:_0x12f99d,product_code:_0x1dafcb,sales_quantity:_0x1b1203,stocks:_0x5abdd6,return_qty:_0x2495d3,Room_name:_0x695815,to_warehouse_name:_0x3828c4,to_Roomname:_0x89b9ef,to_Room_name:_0x1e4cd5,note:_0x2e0c99,level:_0x31fb8a,isle:_0x1c9eb2,pallet:_0x303902}=_0x42d675['body'];if(typeof _0x2cd3f3==_0xbdc993(0x90))var _0x1e0106=[_0x42d675[_0xbdc993(0xc3)]['product_name']],_0x33afa2=[_0x42d675['body'][_0xbdc993(0x10c)]],_0x3f0da3=[_0x42d675['body'][_0xbdc993(0xba)]],_0x46d44d=[_0x42d675['body']['product_code']],_0x28e709=[_0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xc1)]],_0x2664f6=[_0x42d675[_0xbdc993(0xc3)]['stocks']],_0x42296a=[_0x42d675['body']['return_qty']],_0x113f63=[_0x42d675['body']['bay']],_0x5c3a19=[_0x42d675[_0xbdc993(0xc3)]['bin']],_0x277d44=[_0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xce)]],_0x3e4cc6=[_0x42d675[_0xbdc993(0xc3)][_0xbdc993(0x167)]];else var _0x1e0106=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0x16e)]],_0x33afa2=[..._0x42d675[_0xbdc993(0xc3)]['primary_code']],_0x3f0da3=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xba)]],_0x46d44d=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0x157)]],_0x28e709=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xc1)]],_0x2664f6=[..._0x42d675[_0xbdc993(0xc3)]['stocks']],_0x42296a=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xef)]],_0x113f63=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xd0)]],_0x5c3a19=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xe9)]],_0x277d44=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0xce)]],_0x3e4cc6=[..._0x42d675[_0xbdc993(0xc3)][_0xbdc993(0x167)]];const _0x38a836=_0x1e0106[_0xbdc993(0xd5)](_0x5f7c23=>{return _0x5f7c23={'product_name':_0x5f7c23};});_0x33afa2[_0xbdc993(0xf2)]((_0x11c455,_0x187a73)=>{var _0x50c272=_0xbdc993;_0x38a836[_0x187a73][_0x50c272(0x10c)]=_0x11c455;}),_0x3f0da3['forEach']((_0x317ff5,_0x43ce3d)=>{_0x38a836[_0x43ce3d]['secondary_code']=_0x317ff5;}),_0x46d44d[_0xbdc993(0xf2)]((_0x1d065d,_0x391af3)=>{_0x38a836[_0x391af3]['product_code']=_0x1d065d;}),_0x28e709[_0xbdc993(0xf2)]((_0x5db847,_0x47357c)=>{_0x38a836[_0x47357c]['sale_qty']=_0x5db847;}),_0x2664f6['forEach']((_0x44f0b3,_0x21c031)=>{_0x38a836[_0x21c031]['stock']=_0x44f0b3;}),_0x42296a[_0xbdc993(0xf2)]((_0x5de8ec,_0x3687c1)=>{var _0x4f362d=_0xbdc993;_0x38a836[_0x3687c1][_0x4f362d(0xef)]=_0x5de8ec;}),_0x113f63[_0xbdc993(0xf2)]((_0xef7202,_0xe0bebe)=>{var _0x575691=_0xbdc993;_0x38a836[_0xe0bebe][_0x575691(0xd0)]=_0xef7202;}),_0x5c3a19[_0xbdc993(0xf2)]((_0x14c5ac,_0x428980)=>{_0x38a836[_0x428980]['bin']=_0x14c5ac;}),_0x277d44['forEach']((_0x5e4e4d,_0x20dcbd)=>{var _0x201403=_0xbdc993;_0x38a836[_0x20dcbd][_0x201403(0xa0)]=_0x5e4e4d;}),_0x3e4cc6[_0xbdc993(0xf2)]((_0x227b2f,_0x531ad7)=>{_0x38a836[_0x531ad7]['floorlevel']=_0x227b2f;});var _0x518d05=0x0;_0x38a836[_0xbdc993(0xf2)](_0x53a84e=>{var _0x2394f0=_0xbdc993;console[_0x2394f0(0x17d)]('foreach\x20newproduct',_0x53a84e),(parseInt(_0x53a84e[_0x2394f0(0xde)])<parseInt(_0x53a84e[_0x2394f0(0xef)])||parseInt(_0x53a84e[_0x2394f0(0xe2)])<parseInt(_0x53a84e['return_qty'])&&parseInt(_0x53a84e[_0x2394f0(0xde)])>parseInt(_0x53a84e[_0x2394f0(0xef)])||parseInt(_0x53a84e['return_qty'])==0x0)&&_0x518d05++;});if(_0x518d05!=0x0)return _0x42d675[_0xbdc993(0xac)](_0xbdc993(0x164),_0xbdc993(0xb7)),_0x5db842[_0xbdc993(0x8a)](_0xbdc993(0x168));const _0x596ed8=await sales['findOne']({'invoice':_0x42a8b3});console[_0xbdc993(0x17d)](_0x596ed8),_0x596ed8[_0xbdc993(0x9f)]=_0xbdc993(0x135);const _0x3ba3ec=await _0x596ed8[_0xbdc993(0x85)](),_0x47e7e2=new sales_return({'invoice':_0x42a8b3,'customer':_0x42d675[_0xbdc993(0xc3)]['customer'],'date':_0x503dd2,'warehouse_name':_0x4ffeeb,'room':_0x695815,'ToWarehouse':_0x3828c4,'ToRoom':_0x1e4cd5,'return_sale':_0x38a836,'note':_0x2e0c99}),_0x224adf=await _0x47e7e2[_0xbdc993(0x85)]();console[_0xbdc993(0x17d)](_0x47e7e2);const _0x230984=await sales_return[_0xbdc993(0xd7)]({'invoice':_0x42a8b3}),_0x276ea2=await warehouse[_0xbdc993(0xd7)]({'name':_0x3828c4,'room':_0x1e4cd5});_0x230984[_0xbdc993(0x14a)]['forEach'](_0x487413=>{var _0x3de626=_0xbdc993,_0x16d501=0x0;const _0x3f115d=_0x276ea2['product_details'][_0x3de626(0xd5)](_0x400509=>{var _0x2cbe9a=_0x3de626;_0x400509[_0x2cbe9a(0x16e)]==_0x487413['product_name']&&_0x400509[_0x2cbe9a(0x167)]==_0x487413[_0x2cbe9a(0x167)]&&_0x400509[_0x2cbe9a(0xa0)]==_0x487413['type']&&_0x400509[_0x2cbe9a(0xe9)]==_0x487413[_0x2cbe9a(0xe9)]&&_0x400509[_0x2cbe9a(0xd0)]==_0x487413[_0x2cbe9a(0xd0)]&&(_0x400509[_0x2cbe9a(0x93)]=parseInt(_0x400509[_0x2cbe9a(0x93)])+parseInt(_0x487413[_0x2cbe9a(0xef)]),_0x16d501++);});_0x16d501=='0'&&(_0x276ea2[_0x3de626(0x16a)]=_0x276ea2[_0x3de626(0x16a)][_0x3de626(0xcb)]({'product_name':_0x487413[_0x3de626(0x16e)],'product_stock':_0x487413['return_qty'],'primary_code':_0x487413[_0x3de626(0x10c)],'secondary_code':_0x487413[_0x3de626(0xba)],'product_code':_0x487413[_0x3de626(0x157)],'bay':_0x487413[_0x3de626(0xd0)],'bin':_0x487413[_0x3de626(0xe9)],'type':_0x487413[_0x3de626(0xa0)],'floorlevel':_0x487413[_0x3de626(0x167)]})),console['log'](_0x3de626(0xf5),_0x276ea2);}),await _0x276ea2['save'](),console[_0xbdc993(0x17d)](_0x42d675[_0xbdc993(0xc3)]);const _0x10f40a=new c_payment_data({'invoice':_0x42a8b3,'customer':_0x42d675['body'][_0xbdc993(0x178)],'reason':_0xbdc993(0xa9)});await _0x10f40a[_0xbdc993(0x85)]();const _0x37312b=await master_shop['find']();console[_0xbdc993(0x17d)](_0xbdc993(0x10e),_0x37312b[0x0]['image']);const _0x4e292f=await email_settings[_0xbdc993(0xd7)](),_0x467af3=await customer['findOne']({'name':_0x42d675[_0xbdc993(0xc3)][_0xbdc993(0x178)]});console[_0xbdc993(0x17d)](_0xbdc993(0x8c),_0x467af3);_0x37312b[0x0]['currency_placement']==0x1?(right_currency=_0x37312b[0x0][_0xbdc993(0x16c)],left_currency=''):(right_currency='',left_currency=_0x37312b[0x0]['currency']);var _0x551a32=_0x1e0106,_0x10f727=_0x42296a,_0x3dfb2a='',_0x176fcf;for(_0x176fcf in _0x551a32){_0x3dfb2a+=_0xbdc993(0xff)+_0xbdc993(0x86)+_0x551a32[_0x176fcf]+_0xbdc993(0x13c)+_0xbdc993(0x86)+_0x10f727[_0x176fcf]+'</td>'+'</tr>';}console[_0xbdc993(0x17d)](_0xbdc993(0x125),_0x3dfb2a);let _0x1d7514=nodemailer['createTransport']({'service':_0xbdc993(0xbd),'auth':{'user':_0x4e292f[_0xbdc993(0x13e)],'pass':_0x4e292f['password']}}),_0x14559d={'from':_0x4e292f[_0xbdc993(0x13e)],'to':_0x467af3[_0xbdc993(0x13e)],'subject':_0xbdc993(0x9d),'attachments':[{'filename':_0xbdc993(0x137),'path':__dirname+'/../public'+_0xbdc993(0x152)+_0x37312b[0x0][_0xbdc993(0xe3)],'cid':_0xbdc993(0xfd)}],'html':_0xbdc993(0x141)+_0xbdc993(0x94)+_0xbdc993(0x154)+_0xbdc993(0x134)+_0xbdc993(0xe6)+_0xbdc993(0x134)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0xbdc993(0x134)+_0xbdc993(0x10d)+_0x37312b[0x0][_0xbdc993(0x117)]+_0xbdc993(0xab)+_0xbdc993(0x144)+'</div>'+_0xbdc993(0xb2)+_0xbdc993(0x134)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xbdc993(0x15f)+_0x42a8b3+'\x20'+_0xbdc993(0xc8)+'\x20Order\x20Date\x20:\x20'+_0x503dd2+'\x20'+_0xbdc993(0xdd)+_0xbdc993(0xea)+'</div>'+_0xbdc993(0xb1)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xbdc993(0xff)+_0xbdc993(0x15e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0xbdc993(0x11a)+_0xbdc993(0x8d)+_0xbdc993(0x88)+'\x20'+_0x3dfb2a+'\x20'+_0xbdc993(0xa8)+_0xbdc993(0xfa)+_0xbdc993(0x134)+_0xbdc993(0x158)+'<h5>'+_0x37312b[0x0]['site_title']+_0xbdc993(0xea)+_0xbdc993(0x144)+_0xbdc993(0x144)+_0xbdc993(0x12d)};_0x1d7514[_0xbdc993(0xa2)](_0x14559d,function(_0x566b17,_0xe93678){var _0x23698e=_0xbdc993;_0x566b17?(console['log'](_0x566b17),console[_0x23698e(0x17d)]('Error\x20Occurs')):console[_0x23698e(0x17d)](_0x23698e(0x182));}),_0x42d675[_0xbdc993(0xac)](_0xbdc993(0x103),_0xbdc993(0x108)),_0x5db842['redirect'](_0xbdc993(0xed));}catch(_0x269107){console[_0xbdc993(0x17d)](_0x269107),_0x5db842['status'](0xc8)['json']({'message1':_0x269107['message']});}}),router[a0_0x2463d6(0x169)](a0_0x2463d6(0xca),auth,async(_0x4d83c4,_0x11974c)=>{var _0x32fe27=a0_0x2463d6;try{const {username:_0x4eafb5,email:_0x2690d3,role:_0x518d8c}=_0x4d83c4[_0x32fe27(0x8f)],_0xc75798=_0x4d83c4[_0x32fe27(0x8f)],_0x15b6c9=await profile[_0x32fe27(0xd7)]({'email':_0xc75798[_0x32fe27(0x13e)]}),_0x38b186=await master_shop[_0x32fe27(0x174)]();console[_0x32fe27(0x17d)](_0x32fe27(0x14d),_0x38b186);const _0x255801=_0x4d83c4[_0x32fe27(0x153)]['id'],_0x43f314=await sales[_0x32fe27(0x175)](_0x255801);console[_0x32fe27(0x17d)]('barcode\x20user_id',_0x43f314);if(_0x38b186[0x0][_0x32fe27(0x16d)]==_0x32fe27(0x95))var _0x2f7e64=users[_0x32fe27(0xb8)];else{if(_0x38b186[0x0][_0x32fe27(0x16d)]==_0x32fe27(0x12e))var _0x2f7e64=users[_0x32fe27(0x12e)];else{if(_0x38b186[0x0]['language']==_0x32fe27(0xf0))var _0x2f7e64=users['German'];else{if(_0x38b186[0x0][_0x32fe27(0x16d)]==_0x32fe27(0xb6))var _0x2f7e64=users[_0x32fe27(0xb6)];else{if(_0x38b186[0x0][_0x32fe27(0x16d)]=='French')var _0x2f7e64=users[_0x32fe27(0xd1)];else{if(_0x38b186[0x0][_0x32fe27(0x16d)]=='Portuguese\x20(BR)')var _0x2f7e64=users[_0x32fe27(0xec)];else{if(_0x38b186[0x0][_0x32fe27(0x16d)]==_0x32fe27(0x142))var _0x2f7e64=users[_0x32fe27(0x142)];else{if(_0x38b186[0x0][_0x32fe27(0x16d)]==_0x32fe27(0xbb))var _0x2f7e64=users[_0x32fe27(0xee)];}}}}}}}_0x11974c[_0x32fe27(0xd6)]('all_sales_barcode',{'success':_0x4d83c4[_0x32fe27(0xac)]('success'),'errors':_0x4d83c4[_0x32fe27(0xac)](_0x32fe27(0x164)),'role':_0xc75798,'profile':_0x15b6c9,'alldata':_0x43f314,'master_shop':_0x38b186,'language':_0x2f7e64});}catch(_0x3155b3){console[_0x32fe27(0x17d)](_0x3155b3);}}),router[a0_0x2463d6(0x8e)](a0_0x2463d6(0x15c),async(_0x146061,_0x9617d9)=>{var _0x41970a=a0_0x2463d6;const {product_code:_0x58c3f2,warehouse_name:_0x29ec81,rooms_data:_0x50d7be,Roomslist:_0x3051a2}=_0x146061[_0x41970a(0xc3)],_0x2d966c=_0x3051a2[_0x41970a(0xcc)](','),_0x3c9a5f=[];async function _0x4d61f1(_0x2eb62e){var _0xbc5475=_0x41970a;const _0x3c3b23=await warehouse['aggregate']([{'$match':{'name':_0x29ec81,'room':_0x2eb62e}},{'$unwind':_0xbc5475(0x12a)},{'$match':{'product_details.primary_code':_0x58c3f2}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xbc5475(0x120)},'primary_code':{'$first':_0xbc5475(0xf6)},'secondary_code':{'$first':_0xbc5475(0xa1)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xbc5475(0x155)},'isle':{'$first':_0xbc5475(0x180)},'type':{'$first':_0xbc5475(0x146)},'pallet':{'$first':_0xbc5475(0x112)},'unit':{'$first':_0xbc5475(0x160)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0xbc5475(0x11b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xbc5475(0xa4)},'production_date':{'$first':_0xbc5475(0xbc)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0xbc5475(0x12b)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0xbc5475(0x162)},'actual_qty':{'$first':_0xbc5475(0xc4)},'actual_uom':{'$first':_0xbc5475(0x9c)}}}]),_0x3d2f72=await warehouse[_0xbc5475(0xc7)]([{'$match':{'name':_0x29ec81,'room':_0x2eb62e}},{'$unwind':_0xbc5475(0x12a)},{'$match':{'product_details.secondary_code':_0x58c3f2}},{'$group':{'_id':_0xbc5475(0x171),'name':{'$first':_0xbc5475(0x184)},'product_stock':{'$first':_0xbc5475(0x120)},'primary_code':{'$first':_0xbc5475(0xf6)},'secondary_code':{'$first':_0xbc5475(0xa1)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xbc5475(0x155)},'isle':{'$first':_0xbc5475(0x180)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xbc5475(0x112)},'unit':{'$first':_0xbc5475(0x160)},'secondary_unit':{'$first':_0xbc5475(0x143)},'storage':{'$first':_0xbc5475(0x11b)},'rack':{'$first':_0xbc5475(0x10f)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xbc5475(0xbc)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0xbc5475(0x111)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xbc5475(0xa3)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x3c3b23['length']>0x0)_0x3c9a5f[_0xbc5475(0x151)](_0x3c3b23);else _0x3d2f72['length']>0x0&&_0x3c9a5f['push'](_0x3d2f72);}const _0x44a73d=_0x2d966c[_0x41970a(0xd5)](_0x57bd25=>_0x4d61f1(_0x57bd25));await Promise['all'](_0x44a73d),_0x9617d9['json'](_0x3c9a5f);}),module['exports']=router;