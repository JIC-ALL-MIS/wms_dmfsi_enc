var a0_0x415a07=a0_0x3e2b;(function(_0x5a524c,_0x5dbbdf){var _0x4a23f5=a0_0x3e2b,_0x1ab88c=_0x5a524c();while(!![]){try{var _0x2b7682=-parseInt(_0x4a23f5(0x10f))/0x1+-parseInt(_0x4a23f5(0x156))/0x2*(parseInt(_0x4a23f5(0x181))/0x3)+-parseInt(_0x4a23f5(0x190))/0x4+parseInt(_0x4a23f5(0x149))/0x5+-parseInt(_0x4a23f5(0x103))/0x6*(parseInt(_0x4a23f5(0x13a))/0x7)+-parseInt(_0x4a23f5(0xf4))/0x8+parseInt(_0x4a23f5(0x9f))/0x9*(parseInt(_0x4a23f5(0xc5))/0xa);if(_0x2b7682===_0x5dbbdf)break;else _0x1ab88c['push'](_0x1ab88c['shift']());}catch(_0x178183){_0x1ab88c['push'](_0x1ab88c['shift']());}}}(a0_0x5434,0x83a45));function a0_0x5434(){var _0x4ea3a7=['batch_code','success','$name','barcode\x20Product\x20master','bin','errors','<table\x20style=\x22width:\x20100%\x20!important;\x22>','room_name','False','requested_qty','edit_sales','user_id','product_data','<h2>\x20','user','$product_details.rack','port','product','11541yAefOK','$product_details.product_cat','$product_details','back','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Ambient','name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getMonth','$sale_product.type','maxperunit','status','redirect','currency_placement','$product_details.isle','3997892ClAStF','customers','stock','Portuguese','$product_details.actual_qty','$product_details.floorlevel','$product_details.maxPerUnit','createTransport','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','message','expiry_date','prod_cat','/give_payment/:id','master','$product_details.secondary_code','product_code','error','foreach\x20newproduct','Level','secondary_unit','Arabic','$sale_product.quantity','$product_details.primary_code','filter','carton','/view/add_sale/product','purchases_data','all_sales_barcode','$warehouse_name','</div>','level','$product_details.expiry_date','warehouse_name','type','$customer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.product_name','forEach','225kLgosS','</span>','staff','nodemailer','SCRN','$product_details.actual_uom','actual_uom','actual_qty','$product_details.pallet','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$sale_product.bin','quantity','log','Chinese','delivery_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','length','$finalize','/barcode_scanner','/all_sales/preview/','Return\x20Rooms','$_id','$customers_docs','prod_invoice','RoomAssigned','note','findOne','<strong>\x20Regards\x20</strong>','../middleware/auth','invoice','exports','$product_details.batch_code','$sale_product.bay','<tbody\x20style=\x22text-align:\x20center;\x22>','Shelves','site_title','OUT-','1122650SzjyPJ','delivery_date','<span\x20style=\x22float:\x20right;\x22>','$invoice','sales_quantity','<hr\x20class=\x22my-3\x22>','date','English\x20(US)','product_details','Logo.png','floor','Email\x20sent\x20successfully','$product_details.secondary_unit','</body></html>','bay','$sale_product','$isAllowEdit','rack','then','Enclosed','string','all_sales','payment\x20successfull','English','sales\x20all_data','True','$product_details.production_date','render','email','Arabic\x20(ae)','slice','$product_details.level','post','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.type','_id','$product_details.bin','currency','flash','There\x27s\x20a\x20error\x20in\x20this\x20transaction','customer_data','storage','Error\x20Occurs','warehouse','amount','secondary_code','1987712ApuSFa','customer','quantity_notConverted','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','isAllowEdit','$product','production_date','map','padStart','$product_details.storage','$return_data','password','language','$room','1478934VfIUlR','findById','</head><body>','</table>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sale_product','/upload/','$product_details.unit','$date','RMSEmail','return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','764520sbJigd','French','Enabled','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','due_amount','customers_docs','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Sales\x20Add\x20successfully','</tr>','concat','floorlevel','received_amount','edit_sales_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','save','abs','primary_unit','Hindi','Sales\x20Mail','Router','Return\x20Goods','json','</td>','sales\x20item\x20return\x20successfull','types','$product_details.bay','$product_details.product_code','Received\x20Payment\x20For\x20Sale','sendMail','final','/preview/:id','<html><head><title></title>','body','push','return_qty','<h5\x20style=\x22text-align:\x20left;\x22>','toString','$sale_product.floorlevel','role','max_per_unit','stock_data','7TNwXoM','</tbody>','<div>','German','stocks','id_transact','sale_qty','Sales\x20Update\x20successfully','\x20Order\x20Date\x20:\x20','<tr>','$product_details.product_stock','Sale\x20Return\x20Mail','Floor','/view/add_sales','return_sale','3900805IULFdr','add_sales','An\x20error\x20occurred.','$product_details._id','get','/view/:id','random','find','$product_details.invoice','unit','finalize','primary_code','\x20</h2>','410yHWusM','/../public','sales_invoice','aggregate','/invoice/:id','image','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$note','/all_sales/view','catch','Spanish','Receiving\x20Area','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room','/view','product_name','</h5>','<!DOCTYPE\x20html>','id_transaction_from','express','product_stock','prod_code','<h5>','params','max'];a0_0x5434=function(){return _0x4ea3a7;};return a0_0x5434();}const express=require(a0_0x415a07(0x169)),app=express(),router=express[a0_0x415a07(0x124)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x415a07(0xbc)),nodemailer=require(a0_0x415a07(0xa2)),users=require('../public/language/languages.json');function a0_0x3e2b(_0x32cea7,_0x17bcf9){var _0x54345=a0_0x5434();return a0_0x3e2b=function(_0x3e2b66,_0x102e98){_0x3e2b66=_0x3e2b66-0x8c;var _0x401db2=_0x54345[_0x3e2b66];return _0x401db2;},a0_0x3e2b(_0x32cea7,_0x17bcf9);}router[a0_0x415a07(0x14d)](a0_0x415a07(0x164),auth,async(_0x15f69c,_0x14042a)=>{var _0x5eea68=a0_0x415a07;try{const {username:_0x41e57b,email:_0x301b18,role:_0xa990f2}=_0x15f69c[_0x5eea68(0x17d)],_0x56c3a1=_0x15f69c['user'],_0xbc0309=await profile['findOne']({'email':_0x56c3a1['email']}),_0x5166fa=await master_shop[_0x5eea68(0x150)]();let _0x30b531;if(_0x56c3a1[_0x5eea68(0x137)]==_0x5eea68(0xa1)){const _0x5310a2=await staff['findOne']({'email':_0x56c3a1[_0x5eea68(0xe1)]});_0x30b531=await sales[_0x5eea68(0x159)]([{'$lookup':{'from':'customers','localField':_0x5eea68(0xf5),'foreignField':_0x5eea68(0x187),'as':_0x5eea68(0x115)}},{'$unwind':_0x5eea68(0xb6)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5eea68(0xb5),'invoice':{'$first':_0x5eea68(0xc8)},'customers':{'$first':_0x5eea68(0x9b)},'date':{'$first':_0x5eea68(0x10b)},'warehouse_name':{'$first':_0x5eea68(0x95)},'sale_product':{'$push':_0x5eea68(0xd4)},'note':{'$first':_0x5eea68(0x15d)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5eea68(0xb6)},'total_saleproduct_quantity':{'$sum':_0x5eea68(0x8e)},'level':{'$addToSet':_0x5eea68(0xc0)},'isle':{'$addToSet':_0x5eea68(0xaa)},'type':{'$addToSet':_0x5eea68(0x18a)},'pallet':{'$addToSet':_0x5eea68(0x136)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x30b531=await sales[_0x5eea68(0x159)]([{'$lookup':{'from':_0x5eea68(0x191),'localField':_0x5eea68(0xf5),'foreignField':'name','as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x5eea68(0xd4)},{'$group':{'_id':_0x5eea68(0xb5),'invoice':{'$first':_0x5eea68(0xc8)},'customers':{'$first':_0x5eea68(0x9b)},'date':{'$first':_0x5eea68(0x10b)},'warehouse_name':{'$first':_0x5eea68(0x95)},'sale_product':{'$push':_0x5eea68(0xd4)},'note':{'$first':_0x5eea68(0x15d)},'return_data':{'$first':_0x5eea68(0xff)},'customers_docs':{'$first':_0x5eea68(0xb6)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5eea68(0xc0)},'isle':{'$addToSet':_0x5eea68(0xaa)},'type':{'$addToSet':_0x5eea68(0x18a)},'pallet':{'$addToSet':_0x5eea68(0x136)},'finalize':{'$first':_0x5eea68(0xb1)},'isAllowEdit':{'$first':_0x5eea68(0xd5)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5eea68(0xac)](_0x5eea68(0xdd),_0x30b531);if(_0x5166fa[0x0][_0x5eea68(0x101)]==_0x5eea68(0xcc)){var _0x11512e=users[_0x5eea68(0xdc)];console[_0x5eea68(0xac)](_0x11512e);}else{if(_0x5166fa[0x0]['language']==_0x5eea68(0x122))var _0x11512e=users['Hindi'];else{if(_0x5166fa[0x0][_0x5eea68(0x101)]==_0x5eea68(0x13d))var _0x11512e=users[_0x5eea68(0x13d)];else{if(_0x5166fa[0x0][_0x5eea68(0x101)]==_0x5eea68(0x160))var _0x11512e=users[_0x5eea68(0x160)];else{if(_0x5166fa[0x0][_0x5eea68(0x101)]==_0x5eea68(0x110))var _0x11512e=users[_0x5eea68(0x110)];else{if(_0x5166fa[0x0][_0x5eea68(0x101)]==_0x5eea68(0xf7))var _0x11512e=users['Portuguese'];else{if(_0x5166fa[0x0][_0x5eea68(0x101)]==_0x5eea68(0xad))var _0x11512e=users['Chinese'];else{if(_0x5166fa[0x0]['language']==_0x5eea68(0xe2))var _0x11512e=users[_0x5eea68(0x8d)];}}}}}}}_0x14042a[_0x5eea68(0xe0)](_0x5eea68(0xda),{'success':_0x15f69c[_0x5eea68(0xec)](_0x5eea68(0x170)),'errors':_0x15f69c[_0x5eea68(0xec)](_0x5eea68(0x174)),'sales':_0x30b531,'profile':_0xbc0309,'role':_0x56c3a1,'master_shop':_0x5166fa,'language':_0x11512e});}catch(_0x28194b){console[_0x5eea68(0xac)](_0x28194b);}});async function getRandom8DigitNumber(){var _0x25e110=a0_0x415a07;const _0x8c54b4=0x989680,_0x250e20=0x5f5e0ff,_0xe139aa=Math[_0x25e110(0xcf)](Math[_0x25e110(0x14f)]()*(_0x250e20-_0x8c54b4+0x1))+_0x8c54b4;var _0x1f40af;const _0xf9a74e=await sales[_0x25e110(0xba)]({'invoice':_0x25e110(0xc4)+_0xe139aa});return _0xf9a74e&&_0xf9a74e['length']>0x0?_0x1f40af=_0x25e110(0xc4)+_0xe139aa:_0x1f40af=_0x25e110(0xc4)+_0xe139aa,_0x1f40af;}router[a0_0x415a07(0x14d)](a0_0x415a07(0x147),auth,async(_0x56b2bd,_0xcf09b1)=>{var _0x45ce88=a0_0x415a07;try{const {username:_0xe3a9bc,email:_0x3d6cd7,role:_0x58d976}=_0x56b2bd[_0x45ce88(0x17d)],_0x4e67bf=_0x56b2bd[_0x45ce88(0x17d)],_0x54f82f=await profile[_0x45ce88(0xba)]({'email':_0x4e67bf[_0x45ce88(0xe1)]}),_0x5c6124=await master_shop['find'](),_0x1afaa5=await customer[_0x45ce88(0x150)]({});let _0x355cac;if(_0x4e67bf[_0x45ce88(0x137)]=='staff'){const _0x2e2bff=await staff[_0x45ce88(0xba)]({'email':_0x4e67bf['email']});_0x355cac=await warehouse[_0x45ce88(0x159)]([{'$match':{'status':_0x45ce88(0x111),'name':_0x2e2bff[_0x45ce88(0xf1)],'warehouse_category':_0x45ce88(0xa8),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x45ce88(0x171),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x355cac=await warehouse[_0x45ce88(0x159)]([{'$match':{'status':_0x45ce88(0x111),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x45ce88(0x125)}}},{'$group':{'_id':'$name','name':{'$first':_0x45ce88(0x171)}}},{'$sort':{'name':0x1}}]);const _0x236bf5=await product[_0x45ce88(0x150)]({});var _0x4949aa=[_0x45ce88(0x186),_0x45ce88(0xd8)];const _0x5cf3c5=await sales[_0x45ce88(0x150)]({}),_0x3ebfe8=_0x5cf3c5[_0x45ce88(0xb0)]+0x1,_0x1cc048=_0x45ce88(0xc4)+_0x3ebfe8[_0x45ce88(0x135)]()[_0x45ce88(0xfd)](0x5,'0');if(_0x5c6124[0x0][_0x45ce88(0x101)]==_0x45ce88(0xcc)){var _0x4081fa=users[_0x45ce88(0xdc)];console[_0x45ce88(0xac)](_0x4081fa);}else{if(_0x5c6124[0x0]['language']==_0x45ce88(0x122))var _0x4081fa=users[_0x45ce88(0x122)];else{if(_0x5c6124[0x0]['language']==_0x45ce88(0x13d))var _0x4081fa=users[_0x45ce88(0x13d)];else{if(_0x5c6124[0x0]['language']==_0x45ce88(0x160))var _0x4081fa=users[_0x45ce88(0x160)];else{if(_0x5c6124[0x0][_0x45ce88(0x101)]=='French')var _0x4081fa=users[_0x45ce88(0x110)];else{if(_0x5c6124[0x0][_0x45ce88(0x101)]==_0x45ce88(0xf7))var _0x4081fa=users['Portuguese'];else{if(_0x5c6124[0x0][_0x45ce88(0x101)]==_0x45ce88(0xad))var _0x4081fa=users[_0x45ce88(0xad)];else{if(_0x5c6124[0x0][_0x45ce88(0x101)]==_0x45ce88(0xe2))var _0x4081fa=users[_0x45ce88(0x8d)];}}}}}}}const _0x2b1849=getRandom8DigitNumber();_0x2b1849[_0x45ce88(0xd7)](_0x1e99b3=>{var _0x57aaf2=_0x45ce88;_0xcf09b1[_0x57aaf2(0xe0)](_0x57aaf2(0x14a),{'success':_0x56b2bd[_0x57aaf2(0xec)](_0x57aaf2(0x170)),'errors':_0x56b2bd[_0x57aaf2(0xec)](_0x57aaf2(0x174)),'role':_0x4e67bf,'profile':_0x54f82f,'customer':_0x1afaa5,'warehouse':_0x355cac,'product':_0x236bf5,'invoice':_0x1e99b3,'master_shop':_0x5c6124,'language':_0x4081fa,'rooms_data':_0x4949aa});})[_0x45ce88(0x15f)](_0x1be71f=>{var _0x5c9489=_0x45ce88;_0x56b2bd[_0x5c9489(0xec)](_0x5c9489(0x174),_0x5c9489(0xed)),_0xcf09b1[_0x5c9489(0x18d)](_0x5c9489(0x15e));});}catch(_0x157670){console['log'](_0x157670);}}),router['get']('/view/add_sales/:id',auth,async(_0xc99869,_0x25147b)=>{var _0x3a32df=a0_0x415a07;try{const _0x4b748c=_0xc99869['params']['id'];console['log'](_0x4b748c);const _0x524f79=await product[_0x3a32df(0x150)](),_0x5a624b=await purchases[_0x3a32df(0x159)]([{'$match':{'warehouse_name':_0x4b748c}},{'$unwind':_0x3a32df(0xfa)},{'$group':{'_id':'$product.product_name'}}]);console[_0x3a32df(0xac)](_0x3a32df(0x93),_0x5a624b),_0x25147b[_0x3a32df(0x18c)](0xc8)['json']({'purchases_data':_0x5a624b,'product_data':_0x524f79});}catch(_0x41055b){console[_0x3a32df(0xac)](_0x41055b);}}),router[a0_0x415a07(0xe5)](a0_0x415a07(0x92),auth,async(_0x3a2825,_0x107b40)=>{var _0x29ff24=a0_0x415a07;try{const {warehouse_data:_0x699fd6,product_data:_0x2766b1}=_0x3a2825['body'];console[_0x29ff24(0xac)](_0x3a2825['body'][_0x29ff24(0x17b)]);;const _0x5805cc=await master_shop[_0x29ff24(0x150)]();console[_0x29ff24(0xac)](_0x29ff24(0x19d),_0x5805cc);const _0x38539c=await product[_0x29ff24(0xba)]({'name':_0x2766b1});console[_0x29ff24(0xac)](_0x29ff24(0x180),_0x38539c);const _0x4fb64b=await warehouse[_0x29ff24(0x159)]([{'$match':{'name':_0x699fd6}},{'$unwind':_0x29ff24(0x183)},{'$match':{'product_details.product_name':_0x2766b1}},{'$group':{'_id':_0x29ff24(0x9d),'product_stock':{'$first':_0x29ff24(0x144)}}}]);console['log'](_0x29ff24(0x139),_0x4fb64b),_0x107b40[_0x29ff24(0x18c)](0xc8)[_0x29ff24(0x126)]({'master':_0x5805cc,'new_product':_0x38539c,'stock_data':_0x4fb64b});}catch(_0x1f8364){console[_0x29ff24(0xac)](_0x1f8364);}}),router[a0_0x415a07(0xe5)]('/view/add_sales',auth,async(_0x9da625,_0x5e319c)=>{var _0x21990d=a0_0x415a07;try{const {invoice:_0x59ce54,date:_0x22c3ca,warehouse_name:_0x438702,product_name:_0x16e7a9,stock:_0x32bb51,quantity:_0x23dffd,note:_0x4b28a4,room:_0x1a959a,primary_code:_0x2553d2,secondary_code:_0x526352,prod_code:_0x317c66,level:_0x4ae674,isle:_0x22cd36,pallet:_0x5ecc04,batch_code:_0x4e5f1a,SCRN:_0x4ef00e,expiry_date:_0x3b5304}=_0x9da625['body'];if(typeof _0x16e7a9==_0x21990d(0xd9))var _0x301c73=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x165)]],_0x2cd350=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x192)]],_0x2dd60c=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x91)]],_0x87ab28=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x154)]],_0x231351=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xf3)]],_0x1e6886=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x16b)]],_0x22683c=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x97)]],_0x16c30b=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x121)]],_0x280637=[_0x9da625['body'][_0x21990d(0x8c)]],_0x20ff64=[_0x9da625['body']['batch_code']],_0x3de15c=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x19a)]],_0x40962d=[_0x9da625['body'][_0x21990d(0x138)]],_0x4f7782=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xfb)]],_0x22faec=[_0x9da625['body'][_0x21990d(0x178)]],_0xcd733=[_0x9da625[_0x21990d(0x131)]['delivery_date']],_0x43a69e=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xae)]],_0x262937=[_0x9da625[_0x21990d(0x131)][_0x21990d(0x19b)]],_0x474c22=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xab)]],_0x1788f9=[_0x9da625['body'][_0x21990d(0xb8)]],_0x290cfa=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xb7)]],_0x433ecf=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xa6)]],_0x20a2c7=[_0x9da625[_0x21990d(0x131)][_0x21990d(0xa5)]],_0x1e78bc=[_0x9da625['body'][_0x21990d(0x13f)]];else var _0x301c73=[..._0x9da625['body']['product_name']],_0x2cd350=[..._0x9da625['body']['stock']],_0x2dd60c=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x91)]],_0x87ab28=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x154)]],_0x231351=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xf3)]],_0x1e6886=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x16b)]],_0x22683c=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x97)]],_0x16c30b=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x121)]],_0x280637=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x8c)]],_0x20ff64=[..._0x9da625['body'][_0x21990d(0x16f)]],_0x3de15c=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x19a)]],_0x40962d=[..._0x9da625['body']['max_per_unit']],_0x4f7782=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xfb)]],_0x22faec=[..._0x9da625[_0x21990d(0x131)]['requested_qty']],_0xcd733=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xc6)]],_0x43a69e=[..._0x9da625['body']['delivery_code']],_0x262937=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x19b)]],_0x474c22=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xab)]],_0x1788f9=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xb8)]],_0x290cfa=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xb7)]],_0x433ecf=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xa6)]],_0x20a2c7=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0xa5)]],_0x1e78bc=[..._0x9da625[_0x21990d(0x131)][_0x21990d(0x13f)]];const _0x27473d=_0x301c73['map'](_0x3552b2=>{return _0x3552b2={'product_name':_0x3552b2};});_0x2cd350['forEach']((_0x3063ec,_0x273068)=>{var _0x4e97b6=_0x21990d;_0x27473d[_0x273068][_0x4e97b6(0x192)]=Math[_0x4e97b6(0x120)](_0x3063ec);}),_0x433ecf[_0x21990d(0x9e)]((_0xf3eb0e,_0xec436d)=>{var _0x38b6c5=_0x21990d;_0x27473d[_0xec436d][_0x38b6c5(0xa6)]=Math[_0x38b6c5(0x120)](_0xf3eb0e);}),_0x20a2c7[_0x21990d(0x9e)]((_0x39ee44,_0x4543a8)=>{var _0x2566f9=_0x21990d;_0x27473d[_0x4543a8][_0x2566f9(0xa5)]=_0x39ee44;}),_0x1e78bc['forEach']((_0x5c3c3d,_0x290ea6)=>{var _0x70730e=_0x21990d;_0x27473d[_0x290ea6][_0x70730e(0x168)]=_0x5c3c3d;}),_0x2dd60c[_0x21990d(0x9e)]((_0x53b09b,_0x1adb5e)=>{var _0x3725ee=_0x21990d;_0x27473d[_0x1adb5e][_0x3725ee(0xab)]=_0x53b09b;}),_0x87ab28[_0x21990d(0x9e)]((_0x148f91,_0xb4fc4f)=>{var _0x53409c=_0x21990d;_0x27473d[_0xb4fc4f][_0x53409c(0x154)]=_0x148f91;}),_0x231351[_0x21990d(0x9e)]((_0x49e6d9,_0x322fd6)=>{var _0x3c3937=_0x21990d;_0x27473d[_0x322fd6][_0x3c3937(0xf3)]=_0x49e6d9;}),_0x1e6886[_0x21990d(0x9e)]((_0x58af0d,_0x463deb)=>{var _0x1a077d=_0x21990d;_0x27473d[_0x463deb][_0x1a077d(0x19f)]=_0x58af0d;}),_0x22683c['forEach']((_0x1da173,_0x4bf8cc)=>{_0x1788f9['forEach']((_0x50ddc6,_0x23c888)=>{var _0x2815c1=a0_0x3e2b;if(_0x50ddc6==_0x2815c1(0x161)&&_0x4bf8cc==_0x23c888){var _0x4ff5df=_0x1da173['slice'](0x3);_0x27473d[_0x4bf8cc][_0x2815c1(0xef)]=_0x1da173[0x0],_0x27473d[_0x4bf8cc][_0x2815c1(0xd6)]=_0x1da173[0x1],_0x27473d[_0x4bf8cc][_0x2815c1(0xd3)]=0x0,_0x27473d[_0x4bf8cc][_0x2815c1(0x173)]=0x0,_0x27473d[_0x4bf8cc][_0x2815c1(0x9a)]=_0x2815c1(0x146),_0x27473d[_0x4bf8cc][_0x2815c1(0x11b)]=_0x4ff5df;}else{if(_0x50ddc6=='Shelves'&&_0x4bf8cc==_0x23c888){var _0x4ff5df=_0x1da173[_0x2815c1(0xe3)](0x3);_0x27473d[_0x4bf8cc][_0x2815c1(0xef)]=_0x1da173[0x0],_0x27473d[_0x4bf8cc]['rack']=_0x1da173[0x1],_0x27473d[_0x4bf8cc][_0x2815c1(0xd3)]=0x0,_0x27473d[_0x4bf8cc]['bin']=0x0,_0x27473d[_0x4bf8cc]['type']=_0x2815c1(0x146),_0x27473d[_0x4bf8cc][_0x2815c1(0x11b)]=_0x1da173[0x5];}else{if(_0x4bf8cc==_0x23c888){var _0x6fced4;if(_0x1da173[0x4]=='L')_0x6fced4=_0x2815c1(0x1a2);else _0x1da173[0x4]=='F'&&(_0x6fced4=_0x2815c1(0x146));_0x27473d[_0x4bf8cc][_0x2815c1(0xef)]=_0x1da173[0x0],_0x27473d[_0x4bf8cc][_0x2815c1(0xd6)]=_0x1da173[0x1],_0x27473d[_0x4bf8cc][_0x2815c1(0xd3)]=_0x1da173[0x2],_0x27473d[_0x4bf8cc][_0x2815c1(0x173)]=_0x1da173[0x3],_0x27473d[_0x4bf8cc][_0x2815c1(0x9a)]=_0x6fced4,_0x27473d[_0x4bf8cc][_0x2815c1(0x11b)]=_0x1da173[0x5];}}}});}),_0x16c30b['forEach']((_0x129425,_0x2083d9)=>{_0x27473d[_0x2083d9]['unit']=_0x129425;}),_0x280637[_0x21990d(0x9e)]((_0x337813,_0x4ea8e8)=>{var _0x5a58ef=_0x21990d;_0x27473d[_0x4ea8e8][_0x5a58ef(0x8c)]=_0x337813;}),_0x20ff64[_0x21990d(0x9e)]((_0x386402,_0x166ff1)=>{var _0x3aac7d=_0x21990d;_0x27473d[_0x166ff1][_0x3aac7d(0x16f)]=_0x386402;}),_0x3de15c['forEach']((_0x244a69,_0x42bc5b)=>{_0x27473d[_0x42bc5b]['expiry_date']=_0x244a69;}),_0x40962d[_0x21990d(0x9e)]((_0x15392d,_0x3502dd)=>{var _0x401fc3=_0x21990d;_0x27473d[_0x3502dd][_0x401fc3(0x18b)]=_0x15392d;}),_0x4f7782['forEach']((_0x554ee7,_0x37bbfc)=>{var _0x1445b2=_0x21990d;_0x27473d[_0x37bbfc][_0x1445b2(0xfb)]=_0x554ee7;}),_0x22faec[_0x21990d(0x9e)]((_0x148834,_0x412edb)=>{_0x27473d[_0x412edb]['requested_qty']=_0x148834;}),_0xcd733[_0x21990d(0x9e)]((_0x54fabe,_0x4e36eb)=>{_0x27473d[_0x4e36eb]['delivery_date']=_0x54fabe;}),_0x43a69e[_0x21990d(0x9e)]((_0x550cc2,_0xf4eda8)=>{var _0x4901de=_0x21990d;_0x27473d[_0xf4eda8][_0x4901de(0xae)]=_0x550cc2;}),_0x262937[_0x21990d(0x9e)]((_0x16b6c9,_0x85a0a3)=>{var _0x8019d4=_0x21990d;_0x27473d[_0x85a0a3][_0x8019d4(0x19b)]=_0x16b6c9;}),_0x474c22[_0x21990d(0x9e)]((_0x512203,_0x596698)=>{var _0x3bdf79=_0x21990d;_0x27473d[_0x596698][_0x3bdf79(0xf6)]=_0x512203;}),_0x1788f9[_0x21990d(0x9e)]((_0x3c54e1,_0x5c554b)=>{var _0x1d65b4=_0x21990d;_0x27473d[_0x5c554b][_0x1d65b4(0x176)]=_0x3c54e1;}),_0x290cfa[_0x21990d(0x9e)]((_0x34897f,_0x47e3ce)=>{var _0x3bf9cb=_0x21990d;_0x27473d[_0x47e3ce][_0x3bf9cb(0xbd)]=_0x34897f;});var _0x3dc2d4=0x0;_0x27473d[_0x21990d(0x9e)](_0x3b99b1=>{var _0x5c20e0=_0x21990d;(_0x3b99b1[_0x5c20e0(0x192)]<_0x3b99b1['quantity_notConverted']||_0x3b99b1[_0x5c20e0(0xf6)]==0x0)&&(console[_0x5c20e0(0xac)](_0x5c20e0(0x1a1),_0x3b99b1),_0x3dc2d4++);});const _0x2353e6=_0x27473d[_0x21990d(0x90)](_0x3536e0=>_0x3536e0[_0x21990d(0xab)]!=='0'&&_0x3536e0[_0x21990d(0xab)]!==''),_0x22ec9b=new sales({'invoice':_0x59ce54,'customer':_0x9da625[_0x21990d(0x131)][_0x21990d(0xf5)],'date':_0x22c3ca,'warehouse_name':_0x438702,'sale_product':_0x2353e6,'note':_0x4b28a4,'room':_0x1a959a,'primary_code':_0x2553d2,'secondary_code':_0x526352,'prod_code':_0x317c66,'SCRN':_0x4ef00e}),_0x1d72da=await _0x22ec9b[_0x21990d(0x11f)]();_0x9da625['flash'](_0x21990d(0x170),_0x21990d(0x118)),_0x5e319c[_0x21990d(0x18d)](_0x21990d(0xb3)+_0x1d72da[_0x21990d(0xe9)]);}catch(_0x24cd38){console[_0x21990d(0xac)](_0x24cd38);}}),router[a0_0x415a07(0x14d)](a0_0x415a07(0x12f),auth,async(_0x4e8b0a,_0x3708c5)=>{var _0x5e29fd=a0_0x415a07;try{const {username:_0x55f18a,email:_0x199e03,role:_0x15f845}=_0x4e8b0a[_0x5e29fd(0x17d)],_0x532644=_0x4e8b0a[_0x5e29fd(0x17d)],_0x4c032f=await profile['findOne']({'email':_0x532644['email']}),_0x122e4f=await master_shop[_0x5e29fd(0x150)](),_0x30ccad=_0x4e8b0a[_0x5e29fd(0x16d)]['id'],_0x454549=await sales[_0x5e29fd(0x104)](_0x30ccad),_0x5e1f1d=await warehouse[_0x5e29fd(0x159)]([{'$match':{'name':_0x454549[_0x5e29fd(0x99)]}},{'$unwind':_0x5e29fd(0x183)},{'$group':{'_id':_0x5e29fd(0x14c),'name':{'$first':_0x5e29fd(0x9d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5e29fd(0x12a)},'bin':{'$first':_0x5e29fd(0xea)},'type':{'$first':_0x5e29fd(0xe8)},'floorlevel':{'$first':_0x5e29fd(0x195)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5e29fd(0x19e)},'product_code':{'$first':_0x5e29fd(0x12b)},'storage':{'$first':_0x5e29fd(0xfe)},'rack':{'$first':_0x5e29fd(0x17e)},'expiry_date':{'$first':_0x5e29fd(0x98)},'production_date':{'$first':_0x5e29fd(0xdf)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x3545bc=await customer[_0x5e29fd(0x150)]({});let _0xa71a8f;if(_0x532644['role']=='staff'){const _0x180b46=await staff[_0x5e29fd(0xba)]({'email':_0x532644[_0x5e29fd(0xe1)]});_0xa71a8f=await warehouse[_0x5e29fd(0x159)]([{'$match':{'status':'Enabled','name':_0x180b46[_0x5e29fd(0xf1)]}},{'$group':{'_id':_0x5e29fd(0x171),'name':{'$first':_0x5e29fd(0x171)}}}]);}else _0xa71a8f=await warehouse['aggregate']([{'$match':{'status':_0x5e29fd(0x111)}},{'$group':{'_id':_0x5e29fd(0x171),'name':{'$first':_0x5e29fd(0x171)}}}]);const _0x33b620=await product[_0x5e29fd(0x150)]({}),_0x349f93=await suppliers[_0x5e29fd(0x150)]({});if(_0x122e4f[0x0][_0x5e29fd(0x101)]=='English\x20(US)'){var _0x32ca95=users[_0x5e29fd(0xdc)];console[_0x5e29fd(0xac)](_0x32ca95);}else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]==_0x5e29fd(0x122))var _0x32ca95=users[_0x5e29fd(0x122)];else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]==_0x5e29fd(0x13d))var _0x32ca95=users['German'];else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]==_0x5e29fd(0x160))var _0x32ca95=users['Spanish'];else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]=='French')var _0x32ca95=users['French'];else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]==_0x5e29fd(0xf7))var _0x32ca95=users[_0x5e29fd(0x193)];else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]=='Chinese')var _0x32ca95=users[_0x5e29fd(0xad)];else{if(_0x122e4f[0x0][_0x5e29fd(0x101)]==_0x5e29fd(0xe2))var _0x32ca95=users[_0x5e29fd(0x8d)];}}}}}}}_0x3708c5[_0x5e29fd(0xe0)](_0x5e29fd(0x11d),{'success':_0x4e8b0a[_0x5e29fd(0xec)](_0x5e29fd(0x170)),'errors':_0x4e8b0a['flash'](_0x5e29fd(0x174)),'role':_0x532644,'profile':_0x4c032f,'customer':_0x3545bc,'warehouse':_0xa71a8f,'product':_0x5e1f1d,'user':_0x454549,'master_shop':_0x122e4f,'unit':_0x33b620,'language':_0x32ca95,'suppliers':_0x349f93});}catch(_0x3ca526){console[_0x5e29fd(0xac)](_0x3ca526);}}),router[a0_0x415a07(0xe5)](a0_0x415a07(0x12f),auth,async(_0x374629,_0x48df49)=>{var _0x2154f4=a0_0x415a07;try{const _0x1c4204=_0x374629[_0x2154f4(0x16d)]['id'],{invoice:_0x4b49e3,warehouse_name:_0x432698,room:_0x1a2ad2}=_0x374629['body'],_0x128bb3=await sales[_0x2154f4(0xba)]({'invoice':_0x4b49e3}),_0x25f04a=_0x128bb3['sale_product'][_0x2154f4(0xfc)](async _0x5e5871=>{var _0x27502d=_0x2154f4,_0x4a93cb=await warehouse[_0x27502d(0xba)]({'name':_0x432698,'room':_0x5e5871[_0x27502d(0x176)],'warehouse_category':'Raw\x20Materials'});const _0x5151fe=_0x4a93cb[_0x27502d(0xcd)][_0x27502d(0xfc)](_0x3adf2b=>{var _0x674234=_0x27502d;_0x3adf2b[_0x674234(0x165)]==_0x5e5871[_0x674234(0x165)]&&_0x3adf2b['floorlevel']==_0x5e5871['floorlevel']&&_0x3adf2b['type']==_0x5e5871['type']&&_0x3adf2b[_0x674234(0x173)]==_0x5e5871['bin']&&_0x3adf2b['bay']==_0x5e5871[_0x674234(0xd3)]&&_0x3adf2b[_0x674234(0xd6)]==_0x5e5871[_0x674234(0xd6)]&&_0x3adf2b[_0x674234(0xef)]==_0x5e5871[_0x674234(0xef)]&&_0x3adf2b[_0x674234(0x19a)]==_0x5e5871[_0x674234(0x19a)]&&_0x3adf2b[_0x674234(0x16f)]==_0x5e5871[_0x674234(0x16f)]&&_0x3adf2b[_0x674234(0xbd)]==_0x5e5871['invoice']&&_0x3adf2b[_0x674234(0xe9)]==_0x5e5871[_0x674234(0x168)]&&(_0x3adf2b['product_stock']=Math[_0x674234(0x16e)](0x0,Math[_0x674234(0x120)](_0x3adf2b['product_stock'])-Math[_0x674234(0x120)](_0x5e5871['quantity'])));});return _0x4a93cb;});Promise[_0x2154f4(0xe6)](_0x25f04a)[_0x2154f4(0xd7)](async _0x34edac=>{var _0x197a4a=_0x2154f4;try{for(const _0x1a62d0 of _0x34edac){await _0x1a62d0['save']();}_0x128bb3[_0x197a4a(0x153)]=_0x197a4a(0xde);const _0x5a3fac=await _0x128bb3[_0x197a4a(0x11f)](),_0x35aa2=await master_shop[_0x197a4a(0x150)](),_0x39623c=await email_settings[_0x197a4a(0xba)](),_0x547b97=await supervisor_settings[_0x197a4a(0x150)]();var _0x4df730=_0x128bb3['sale_product'],_0x2f1817='',_0x4be7b7;for(_0x4be7b7 in _0x4df730){_0x2f1817+=_0x197a4a(0x143)+_0x197a4a(0x185)+_0x4df730[_0x4be7b7][_0x197a4a(0x165)]+_0x197a4a(0x127)+_0x197a4a(0x185)+_0x4df730[_0x4be7b7][_0x197a4a(0x19f)]+_0x197a4a(0x127)+_0x197a4a(0x185)+_0x4df730[_0x4be7b7]['quantity']+_0x197a4a(0x127)+_0x197a4a(0x185)+_0x4df730[_0x4be7b7][_0x197a4a(0x152)]+_0x197a4a(0x127)+_0x197a4a(0x185)+_0x4df730[_0x4be7b7][_0x197a4a(0x8c)]+'</td>'+_0x197a4a(0x185)+_0x128bb3['warehouse_name']+'</td>'+_0x197a4a(0x185)+_0x4df730[_0x4be7b7][_0x197a4a(0x176)]+_0x197a4a(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4df730[_0x4be7b7][_0x197a4a(0xef)]+_0x4df730[_0x4be7b7][_0x197a4a(0xd6)]+_0x4df730[_0x4be7b7][_0x197a4a(0xd3)]+_0x4df730[_0x4be7b7][_0x197a4a(0x173)]+_0x4df730[_0x4be7b7][_0x197a4a(0x9a)][0x0]+_0x4df730[_0x4be7b7][_0x197a4a(0x11b)]+_0x197a4a(0x127),'</tr>';}let _0x340dbc=nodemailer['createTransport']({'host':_0x39623c['host'],'port':Number(_0x39623c[_0x197a4a(0x17f)]),'secure':![],'auth':{'user':_0x39623c['email'],'pass':_0x39623c[_0x197a4a(0x100)]}}),_0x9f7f5f={'from':_0x39623c[_0x197a4a(0xe1)],'to':_0x547b97[0x0][_0x197a4a(0x10c)],'subject':_0x197a4a(0x123),'attachments':[{'filename':_0x197a4a(0xce),'path':__dirname+_0x197a4a(0x157)+'/upload/'+_0x35aa2[0x0]['image'],'cid':'logo'}],'html':_0x197a4a(0x167)+_0x197a4a(0x130)+'</head><body>'+_0x197a4a(0x13c)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x197a4a(0x13c)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x197a4a(0x96)+_0x197a4a(0x13c)+_0x197a4a(0x17c)+_0x35aa2[0x0]['site_title']+_0x197a4a(0x155)+_0x197a4a(0x96)+_0x197a4a(0x96)+_0x197a4a(0xca)+_0x197a4a(0x13c)+_0x197a4a(0x134)+'\x20Order\x20Number\x20:\x20'+_0x128bb3[_0x197a4a(0xbd)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x197a4a(0x142)+_0x128bb3[_0x197a4a(0xcb)]+'\x20'+'</span>'+'</h5>'+_0x197a4a(0x96)+_0x197a4a(0x175)+_0x197a4a(0x198)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x197a4a(0x117)+_0x197a4a(0x10e)+_0x197a4a(0xf8)+_0x197a4a(0x162)+_0x197a4a(0x11e)+_0x197a4a(0x113)+_0x197a4a(0xaf)+'</tr>'+_0x197a4a(0x112)+_0x197a4a(0xc1)+'\x20'+_0x2f1817+'\x20'+_0x197a4a(0x13b)+_0x197a4a(0x106)+'<div>'+_0x197a4a(0xbb)+_0x197a4a(0x16c)+_0x35aa2[0x0][_0x197a4a(0xc3)]+_0x197a4a(0x166)+_0x197a4a(0x96)+_0x197a4a(0x96)+_0x197a4a(0xd2)};_0x340dbc[_0x197a4a(0x12d)](_0x9f7f5f,function(_0xfadae4,_0x871da4){var _0x2a6f61=_0x197a4a;_0xfadae4?(console[_0x2a6f61(0xac)](_0xfadae4),console['log'](_0x2a6f61(0xf0))):console[_0x2a6f61(0xac)]('Email\x20sent\x20successfully');}),_0x374629[_0x197a4a(0xec)](_0x197a4a(0x170),'Sales\x20Update\x20successfully'),_0x48df49[_0x197a4a(0x18d)](_0x197a4a(0xb3)+_0x1c4204);}catch(_0x23f583){console[_0x197a4a(0x1a0)](_0x23f583),_0x48df49[_0x197a4a(0x18c)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x2f0c9e=>{var _0x11e828=_0x2154f4;console[_0x11e828(0x1a0)](_0x2f0c9e),_0x48df49[_0x11e828(0x18c)](0x1f4)[_0x11e828(0x126)]({'error':_0x11e828(0x14b)});});}catch(_0x183f1b){console[_0x2154f4(0xac)](_0x183f1b);}}),router[a0_0x415a07(0x14d)](a0_0x415a07(0x14e),auth,async(_0x1b9c25,_0x5a88c7)=>{var _0x3aa9b3=a0_0x415a07;try{const {username:_0x5bc865,email:_0x61fdde,role:_0xd7af7d}=_0x1b9c25[_0x3aa9b3(0x17d)],_0x14fb2a=_0x1b9c25['user'],_0x3a8622=await profile[_0x3aa9b3(0xba)]({'email':_0x14fb2a[_0x3aa9b3(0xe1)]}),_0x1f0a4e=await master_shop[_0x3aa9b3(0x150)](),_0xb369bb=_0x1b9c25[_0x3aa9b3(0x16d)]['id'],_0x4b01a8=await sales[_0x3aa9b3(0x104)](_0xb369bb);var _0x26c787=[_0x3aa9b3(0x186),_0x3aa9b3(0xd8)];const _0x151807=await warehouse[_0x3aa9b3(0x159)]([{'$match':{'name':_0x4b01a8['warehouse_name'],'warehouse_category':_0x3aa9b3(0xa8)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3aa9b3(0x14c),'name':{'$first':_0x3aa9b3(0x9d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3aa9b3(0x12a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3aa9b3(0xe8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3aa9b3(0x8f)},'secondary_code':{'$first':_0x3aa9b3(0x19e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3aa9b3(0x17e)}}}]),_0x1cd4f2=await customer[_0x3aa9b3(0x150)]({});let _0x33f2b8;if(_0x14fb2a['role']==_0x3aa9b3(0xa1)){const _0x5c0e42=await staff[_0x3aa9b3(0xba)]({'email':_0x14fb2a[_0x3aa9b3(0xe1)]});_0x33f2b8=await warehouse[_0x3aa9b3(0x159)]([{'$match':{'status':'Enabled','name':_0x5c0e42[_0x3aa9b3(0xf1)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3aa9b3(0x171),'name':{'$first':_0x3aa9b3(0x171)}}}]);}else _0x33f2b8=await warehouse[_0x3aa9b3(0x159)]([{'$match':{'status':'Enabled','warehouse_category':_0x3aa9b3(0xa8)}},{'$group':{'_id':_0x3aa9b3(0x171),'name':{'$first':'$name'}}}]);const _0x3d6c8f=await product[_0x3aa9b3(0x150)]({});if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]=='English\x20(US)'){var _0x46fd72=users[_0x3aa9b3(0xdc)];console[_0x3aa9b3(0xac)](_0x46fd72);}else{if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]=='Hindi')var _0x46fd72=users[_0x3aa9b3(0x122)];else{if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]==_0x3aa9b3(0x13d))var _0x46fd72=users[_0x3aa9b3(0x13d)];else{if(_0x1f0a4e[0x0]['language']=='Spanish')var _0x46fd72=users['Spanish'];else{if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]=='French')var _0x46fd72=users['French'];else{if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]==_0x3aa9b3(0xf7))var _0x46fd72=users[_0x3aa9b3(0x193)];else{if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]=='Chinese')var _0x46fd72=users[_0x3aa9b3(0xad)];else{if(_0x1f0a4e[0x0][_0x3aa9b3(0x101)]==_0x3aa9b3(0xe2))var _0x46fd72=users[_0x3aa9b3(0x8d)];}}}}}}}_0x5a88c7[_0x3aa9b3(0xe0)](_0x3aa9b3(0x179),{'success':_0x1b9c25['flash'](_0x3aa9b3(0x170)),'errors':_0x1b9c25[_0x3aa9b3(0xec)](_0x3aa9b3(0x174)),'role':_0x14fb2a,'profile':_0x3a8622,'customer':_0x1cd4f2,'warehouse':_0x33f2b8,'product':_0x151807,'user':_0x4b01a8,'master_shop':_0x1f0a4e,'unit':_0x3d6c8f,'language':_0x46fd72});}catch(_0x10cfff){console[_0x3aa9b3(0xac)](_0x10cfff);}}),router[a0_0x415a07(0xe5)](a0_0x415a07(0x14e),auth,async(_0x4b0771,_0x391647)=>{var _0x49c238=a0_0x415a07;try{const _0x3c6855=_0x4b0771[_0x49c238(0x16d)]['id'],_0x189f83=await sales[_0x49c238(0xba)]({'_id':_0x4b0771[_0x49c238(0x16d)]['id']}),_0x59c905=await warehouse[_0x49c238(0xba)]({'name':_0x189f83[_0x49c238(0x99)],'room':_0x4b0771[_0x49c238(0x131)][_0x49c238(0x163)]}),{invoice:_0x56b635,date:_0x34a5eb,warehouse_name:_0x43f0d0,product_name:_0xe85cce,stock:_0x2db77b,quantity:_0x47e07a,note:_0x452a5c,room:_0x46fcfa,customer:_0x2e20a8,SCRN:_0x356fd4}=_0x4b0771[_0x49c238(0x131)];if(typeof _0xe85cce==_0x49c238(0xd9))var _0x33d081=[_0x4b0771['body']['product_name']],_0x10e923=[_0x4b0771[_0x49c238(0x131)][_0x49c238(0x192)]],_0x1e0988=[_0x4b0771['body'][_0x49c238(0x91)]],_0x47075c=[_0x4b0771[_0x49c238(0x131)][_0x49c238(0x154)]],_0x5cb75a=[_0x4b0771['body'][_0x49c238(0xf3)]],_0x4f72da=[_0x4b0771[_0x49c238(0x131)]['prod_code']],_0x5e8305=[_0x4b0771['body'][_0x49c238(0x97)]],_0x59a178=[_0x4b0771[_0x49c238(0x131)]['primary_unit']],_0x4f68bf=[_0x4b0771['body'][_0x49c238(0x8c)]],_0x1614fa=[_0x4b0771['body'][_0x49c238(0x16f)]],_0x4a5c54=[_0x4b0771[_0x49c238(0x131)]['expiry_date']],_0x3a87bc=[_0x4b0771['body']['max_per_unit']],_0x585338=[_0x4b0771['body'][_0x49c238(0xfb)]],_0x27fa8c=[_0x4b0771[_0x49c238(0x131)][_0x49c238(0x178)]],_0x8bf476=[_0x4b0771[_0x49c238(0x131)][_0x49c238(0xc6)]],_0x9ec1b2=[_0x4b0771['body']['delivery_code']],_0x531007=[_0x4b0771[_0x49c238(0x131)][_0x49c238(0x19b)]],_0x3d54c4=[_0x4b0771['body'][_0x49c238(0xab)]],_0x318840=[_0x4b0771[_0x49c238(0x131)]['RoomAssigned']];else var _0x33d081=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x165)]],_0x10e923=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x192)]],_0x1e0988=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x91)]],_0x47075c=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x154)]],_0x5cb75a=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0xf3)]],_0x4f72da=[..._0x4b0771[_0x49c238(0x131)]['prod_code']],_0x5e8305=[..._0x4b0771['body'][_0x49c238(0x97)]],_0x59a178=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x121)]],_0x4f68bf=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x8c)]],_0x1614fa=[..._0x4b0771['body'][_0x49c238(0x16f)]],_0x4a5c54=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x19a)]],_0x3a87bc=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x138)]],_0x585338=[..._0x4b0771[_0x49c238(0x131)]['production_date']],_0x27fa8c=[..._0x4b0771[_0x49c238(0x131)]['requested_qty']],_0x8bf476=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0xc6)]],_0x9ec1b2=[..._0x4b0771[_0x49c238(0x131)]['delivery_code']],_0x531007=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0x19b)]],_0x3d54c4=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0xab)]],_0x318840=[..._0x4b0771[_0x49c238(0x131)][_0x49c238(0xb8)]];const _0xf61a90=_0x33d081[_0x49c238(0xfc)](_0x4dc2e4=>{return _0x4dc2e4={'product_name':_0x4dc2e4};});_0x10e923['forEach']((_0x2fa6a0,_0x5cd6a1)=>{var _0xf4d039=_0x49c238;_0xf61a90[_0x5cd6a1][_0xf4d039(0x192)]=Math[_0xf4d039(0x120)](_0x2fa6a0);}),_0x1e0988[_0x49c238(0x9e)]((_0x3dcf17,_0x650cd3)=>{var _0x3187ec=_0x49c238;_0xf61a90[_0x650cd3][_0x3187ec(0xab)]=_0x3dcf17;}),_0x47075c[_0x49c238(0x9e)]((_0x8f3a73,_0x59f524)=>{var _0x48c6a5=_0x49c238;_0xf61a90[_0x59f524][_0x48c6a5(0x154)]=_0x8f3a73;}),_0x5cb75a[_0x49c238(0x9e)]((_0x582954,_0x5295b6)=>{var _0x45663a=_0x49c238;_0xf61a90[_0x5295b6][_0x45663a(0xf3)]=_0x582954;}),_0x4f72da[_0x49c238(0x9e)]((_0xd982e3,_0xf6d29e)=>{var _0x3f860c=_0x49c238;_0xf61a90[_0xf6d29e][_0x3f860c(0x19f)]=_0xd982e3;}),_0x5e8305['forEach']((_0x9ba679,_0xb98bc9)=>{var _0x106b7e=_0x49c238;_0x318840[_0x106b7e(0x9e)]((_0x4ee844,_0x1f1c48)=>{var _0x288419=_0x106b7e;if(_0x4ee844==_0x288419(0x161)&&_0xb98bc9==_0x1f1c48){var _0x12e06b=_0x9ba679[_0x288419(0xe3)](0x3);_0xf61a90[_0xb98bc9][_0x288419(0xef)]=_0x9ba679[0x0],_0xf61a90[_0xb98bc9][_0x288419(0xd6)]=_0x9ba679[0x1],_0xf61a90[_0xb98bc9]['bay']=0x0,_0xf61a90[_0xb98bc9][_0x288419(0x173)]=0x0,_0xf61a90[_0xb98bc9][_0x288419(0x9a)]=_0x288419(0x146),_0xf61a90[_0xb98bc9][_0x288419(0x11b)]=_0x12e06b;}else{if(_0x4ee844==_0x288419(0xc2)&&_0xb98bc9==_0x1f1c48){var _0x12e06b=_0x9ba679[_0x288419(0xe3)](0x3);_0xf61a90[_0xb98bc9][_0x288419(0xef)]=_0x9ba679[0x0],_0xf61a90[_0xb98bc9][_0x288419(0xd6)]=_0x9ba679[0x1],_0xf61a90[_0xb98bc9][_0x288419(0xd3)]=0x0,_0xf61a90[_0xb98bc9][_0x288419(0x173)]=0x0,_0xf61a90[_0xb98bc9][_0x288419(0x9a)]=_0x288419(0x146),_0xf61a90[_0xb98bc9]['floorlevel']=_0x9ba679[0x5];}else{if(_0xb98bc9==_0x1f1c48){var _0x369dd3;if(_0x9ba679[0x4]=='L')_0x369dd3='Level';else _0x9ba679[0x4]=='F'&&(_0x369dd3=_0x288419(0x146));_0xf61a90[_0xb98bc9][_0x288419(0xef)]=_0x9ba679[0x0],_0xf61a90[_0xb98bc9][_0x288419(0xd6)]=_0x9ba679[0x1],_0xf61a90[_0xb98bc9]['bay']=_0x9ba679[0x2],_0xf61a90[_0xb98bc9][_0x288419(0x173)]=_0x9ba679[0x3],_0xf61a90[_0xb98bc9][_0x288419(0x9a)]=_0x369dd3,_0xf61a90[_0xb98bc9][_0x288419(0x11b)]=_0x9ba679[0x5];}}}});}),_0x59a178[_0x49c238(0x9e)]((_0x2c1793,_0x4cdf22)=>{var _0x4033c3=_0x49c238;_0xf61a90[_0x4cdf22][_0x4033c3(0x152)]=_0x2c1793;}),_0x4f68bf['forEach']((_0x33c03d,_0xcdd336)=>{_0xf61a90[_0xcdd336]['secondary_unit']=_0x33c03d;}),_0x1614fa[_0x49c238(0x9e)]((_0x33d290,_0x321729)=>{var _0x3c3b9b=_0x49c238;_0xf61a90[_0x321729][_0x3c3b9b(0x16f)]=_0x33d290;}),_0x4a5c54[_0x49c238(0x9e)]((_0x4d2959,_0x3009a5)=>{_0xf61a90[_0x3009a5]['expiry_date']=_0x4d2959;}),_0x3a87bc[_0x49c238(0x9e)]((_0x88c531,_0x4e5718)=>{var _0x541979=_0x49c238;_0xf61a90[_0x4e5718][_0x541979(0x18b)]=_0x88c531;}),_0x585338['forEach']((_0x3c5b69,_0x55924a)=>{var _0x1f04ad=_0x49c238;_0xf61a90[_0x55924a][_0x1f04ad(0xfb)]=_0x3c5b69;}),_0x27fa8c[_0x49c238(0x9e)]((_0xba9152,_0x5b502e)=>{var _0x5808a9=_0x49c238;_0xf61a90[_0x5b502e][_0x5808a9(0x178)]=Math[_0x5808a9(0x120)](_0xba9152);}),_0x8bf476[_0x49c238(0x9e)]((_0x1896b7,_0xcee1ba)=>{var _0x49717c=_0x49c238;_0xf61a90[_0xcee1ba][_0x49717c(0xc6)]=_0x1896b7;}),_0x9ec1b2[_0x49c238(0x9e)]((_0x56567e,_0x182652)=>{var _0x29de88=_0x49c238;_0xf61a90[_0x182652][_0x29de88(0xae)]=_0x56567e;}),_0x531007['forEach']((_0xe6b97b,_0x23b3ea)=>{_0xf61a90[_0x23b3ea]['prod_cat']=_0xe6b97b;}),_0x3d54c4['forEach']((_0x30f793,_0x58db5c)=>{_0xf61a90[_0x58db5c]['quantity_notConverted']=_0x30f793;}),_0x318840[_0x49c238(0x9e)]((_0x5eaf07,_0x3eb55c)=>{_0xf61a90[_0x3eb55c]['room_name']=_0x5eaf07;});var _0x12ae2e=0x0;_0xf61a90[_0x49c238(0x9e)](_0x406ea7=>{var _0x2351b6=_0x49c238;console[_0x2351b6(0xac)](_0x2351b6(0x1a1),_0x406ea7),(parseInt(_0x406ea7['stock'])<parseInt(_0x406ea7[_0x2351b6(0xab)])||parseInt(_0x406ea7[_0x2351b6(0xab)])==0x0)&&_0x12ae2e++;});if(_0x12ae2e!=0x0)return _0x4b0771['flash']('errors',_0x49c238(0x15c)),_0x391647[_0x49c238(0x18d)](_0x49c238(0x184));const _0x18b8ca=_0xf61a90['filter'](_0x49c378=>_0x49c378[_0x49c238(0xab)]!=='0'&&_0x49c378[_0x49c238(0xab)]!=='');_0x189f83[_0x49c238(0xbd)]=_0x56b635,_0x189f83[_0x49c238(0xf5)]=_0x2e20a8,_0x189f83['date']=_0x34a5eb,_0x189f83['warehouse_name']=_0x43f0d0,_0x189f83[_0x49c238(0x108)]=_0x18b8ca,_0x189f83[_0x49c238(0xb9)]=_0x452a5c,_0x189f83[_0x49c238(0xa3)]=_0x356fd4,_0x189f83[_0x49c238(0x153)]=_0x49c238(0x177),_0x189f83[_0x49c238(0xf9)]=_0x49c238(0x177);const _0x117850=await _0x189f83[_0x49c238(0x11f)]();_0x4b0771[_0x49c238(0xec)](_0x49c238(0x170),_0x49c238(0x141)),_0x391647[_0x49c238(0x18d)]('/all_sales/view');}catch(_0x12562){console[_0x49c238(0xac)](_0x12562);}}),router[a0_0x415a07(0xe5)](a0_0x415a07(0x19c),auth,async(_0x5bdbf1,_0x416bff)=>{var _0x5633d5=a0_0x415a07;try{const _0x2db928=_0x5bdbf1[_0x5633d5(0x16d)]['id'],{invoice:_0xfae02b,customer:_0x5903a9,receivable_amount:_0x52810e,received_amount:_0x2ea53a}=_0x5bdbf1[_0x5633d5(0x131)],_0x1e8e85=await sales[_0x5633d5(0x104)](_0x2db928);console[_0x5633d5(0xac)](_0x1e8e85);var _0x41f3ba=_0x52810e-_0x2ea53a;console[_0x5633d5(0xac)](_0x2ea53a),_0x1e8e85['received_amount']=parseFloat(_0x2ea53a)+parseFloat(_0x1e8e85[_0x5633d5(0x11c)]),_0x1e8e85[_0x5633d5(0x114)]=_0x41f3ba,console[_0x5633d5(0xac)](_0x1e8e85);const _0x55b2ad=await _0x1e8e85[_0x5633d5(0x11f)](),_0x2a6112=await c_payment_data[_0x5633d5(0xba)]({'invoice':_0xfae02b});_0x2a6112[_0x5633d5(0xf2)]=_0x41f3ba,await _0x2a6112[_0x5633d5(0x11f)]();let _0x347645=new Date(),_0x21cfff=('0'+_0x347645['getDate']())[_0x5633d5(0xe3)](-0x2),_0x4d2098=('0'+(_0x347645[_0x5633d5(0x189)]()+0x1))['slice'](-0x2),_0x1b7b61=_0x347645['getFullYear'](),_0x1f330c=_0x1b7b61+'-'+_0x4d2098+'-'+_0x21cfff;const _0x172beb=new customer_payment({'invoice':_0xfae02b,'date':_0x1b7b61+'-'+_0x4d2098+'-'+_0x21cfff,'customer':_0x5903a9,'reason':_0x5633d5(0x12c),'amount':_0x2ea53a}),_0x2db5b6=await _0x172beb[_0x5633d5(0x11f)]();_0x5bdbf1[_0x5633d5(0xec)](_0x5633d5(0x170),_0x5633d5(0xdb)),_0x416bff[_0x5633d5(0x18d)](_0x5633d5(0x15e));}catch(_0x1194c5){console[_0x5633d5(0xac)](_0x1194c5);}}),router[a0_0x415a07(0x14d)](a0_0x415a07(0x15a),auth,async(_0x1bfdbe,_0x1be45e)=>{var _0x41cb2d=a0_0x415a07;try{const {username:_0x41a42c,email:_0x469773,role:_0x1d3c00}=_0x1bfdbe['user'],_0x3d0fc5=_0x1bfdbe[_0x41cb2d(0x17d)],_0x2ca1b5=await profile[_0x41cb2d(0xba)]({'email':_0x3d0fc5[_0x41cb2d(0xe1)]}),_0x78380a=await master_shop[_0x41cb2d(0x150)]();console['log'](_0x41cb2d(0x19d),_0x78380a);const _0x489f51=_0x1bfdbe[_0x41cb2d(0x16d)]['id'],_0x2e3cf0=await sales[_0x41cb2d(0x104)](_0x489f51);console['log'](_0x2e3cf0);const _0x246a51=await customer['findOne']({'name':_0x2e3cf0[_0x41cb2d(0xf5)]});console[_0x41cb2d(0xac)](_0x246a51);if(_0x78380a[0x0][_0x41cb2d(0x101)]==_0x41cb2d(0xcc)){var _0x3dbe8f=users[_0x41cb2d(0xdc)];console[_0x41cb2d(0xac)](_0x3dbe8f);}else{if(_0x78380a[0x0][_0x41cb2d(0x101)]==_0x41cb2d(0x122))var _0x3dbe8f=users['Hindi'];else{if(_0x78380a[0x0][_0x41cb2d(0x101)]==_0x41cb2d(0x13d))var _0x3dbe8f=users['German'];else{if(_0x78380a[0x0][_0x41cb2d(0x101)]==_0x41cb2d(0x160))var _0x3dbe8f=users['Spanish'];else{if(_0x78380a[0x0][_0x41cb2d(0x101)]=='French')var _0x3dbe8f=users[_0x41cb2d(0x110)];else{if(_0x78380a[0x0]['language']==_0x41cb2d(0xf7))var _0x3dbe8f=users[_0x41cb2d(0x193)];else{if(_0x78380a[0x0][_0x41cb2d(0x101)]==_0x41cb2d(0xad))var _0x3dbe8f=users['Chinese'];else{if(_0x78380a[0x0][_0x41cb2d(0x101)]==_0x41cb2d(0xe2))var _0x3dbe8f=users[_0x41cb2d(0x8d)];}}}}}}}_0x1be45e[_0x41cb2d(0xe0)](_0x41cb2d(0x158),{'success':_0x1bfdbe['flash'](_0x41cb2d(0x170)),'errors':_0x1bfdbe[_0x41cb2d(0xec)](_0x41cb2d(0x174)),'role':_0x3d0fc5,'profile':_0x2ca1b5,'master_shop':_0x78380a,'customers':_0x246a51,'sales':_0x2e3cf0,'language':_0x3dbe8f});}catch(_0x5db1dc){console[_0x41cb2d(0xac)](_0x5db1dc);}}),router['get']('/view/return_sales/:id',auth,async(_0x1856d9,_0x59d5cc)=>{var _0x5767e2=a0_0x415a07;try{const {username:_0x11e428,email:_0x3c98f4,role:_0xc2167e}=_0x1856d9[_0x5767e2(0x17d)],_0x5e6239=_0x1856d9['user'],_0xdb2e2=await profile[_0x5767e2(0xba)]({'email':_0x5e6239[_0x5767e2(0xe1)]}),_0x5c76f7=await master_shop[_0x5767e2(0x150)]();console['log'](_0x5767e2(0x19d),_0x5c76f7);const _0x55b120=_0x1856d9[_0x5767e2(0x16d)]['id'];console['log'](_0x55b120);const _0x4d1a46=await sales['findById'](_0x55b120);console[_0x5767e2(0xac)](_0x5767e2(0x17a),_0x4d1a46);const _0x458544=await warehouse['aggregate']([{'$match':{'name':_0x5767e2(0x125),'room':_0x5767e2(0xb4)}},{'$unwind':_0x5767e2(0x183)},{'$group':{'_id':_0x5767e2(0x14c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5767e2(0x144)},'level':{'$first':_0x5767e2(0xe4)},'isle':{'$first':_0x5767e2(0x18f)},'pallet':{'$first':_0x5767e2(0xa7)},'primary_code':{'$first':_0x5767e2(0x8f)},'secondary_code':{'$first':_0x5767e2(0x19e)},'product_code':{'$first':_0x5767e2(0x12b)}}}]);console['log'](_0x5767e2(0x139),_0x458544);const _0xbe8171=await product[_0x5767e2(0x150)]({});warehouse_data=await warehouse[_0x5767e2(0x159)]([{'$match':{'status':_0x5767e2(0x111),'name':_0x5767e2(0x125),'warehouse_category':_0x5767e2(0xa8)}},{'$group':{'_id':_0x5767e2(0x171),'name':{'$first':_0x5767e2(0x171)}}},{'$sort':{'name':0x1}}]);var _0x40755d=[_0x5767e2(0xb4)];if(_0x5c76f7[0x0][_0x5767e2(0x101)]==_0x5767e2(0xcc)){var _0x48a66b=users[_0x5767e2(0xdc)];console[_0x5767e2(0xac)](_0x48a66b);}else{if(_0x5c76f7[0x0][_0x5767e2(0x101)]==_0x5767e2(0x122))var _0x48a66b=users['Hindi'];else{if(_0x5c76f7[0x0][_0x5767e2(0x101)]=='German')var _0x48a66b=users[_0x5767e2(0x13d)];else{if(_0x5c76f7[0x0]['language']==_0x5767e2(0x160))var _0x48a66b=users[_0x5767e2(0x160)];else{if(_0x5c76f7[0x0]['language']=='French')var _0x48a66b=users['French'];else{if(_0x5c76f7[0x0][_0x5767e2(0x101)]==_0x5767e2(0xf7))var _0x48a66b=users[_0x5767e2(0x193)];else{if(_0x5c76f7[0x0][_0x5767e2(0x101)]==_0x5767e2(0xad))var _0x48a66b=users[_0x5767e2(0xad)];else{if(_0x5c76f7[0x0][_0x5767e2(0x101)]==_0x5767e2(0xe2))var _0x48a66b=users[_0x5767e2(0x8d)];}}}}}}}_0x59d5cc[_0x5767e2(0xe0)](_0x5767e2(0x148),{'success':_0x1856d9[_0x5767e2(0xec)]('success'),'errors':_0x1856d9[_0x5767e2(0xec)](_0x5767e2(0x174)),'role':_0x5e6239,'profile':_0xdb2e2,'user':_0x4d1a46,'stock':_0x458544,'master_shop':_0x5c76f7,'unit':_0xbe8171,'language':_0x48a66b,'warehouses':warehouse_data,'rooms':_0x40755d});}catch(_0x6cd941){console[_0x5767e2(0xac)](_0x6cd941),_0x59d5cc[_0x5767e2(0x18c)](0xc8)[_0x5767e2(0x126)]({'message':_0x6cd941['message']});}}),router['post']('/view/return_sales/:id',auth,async(_0x1115ce,_0xb2f252)=>{var _0x2269b5=a0_0x415a07;try{const {invoice:_0x95bb35,date:_0x1ebc23,warehouse_name:_0x2b51dd,product_name:_0x468168,primary_code:_0x360fb3,secondary_code:_0x350a93,product_code:_0x18b5b1,sales_quantity:_0x5dd808,stocks:_0x589ada,return_qty:_0x21397a,Room_name:_0x208ab0,to_warehouse_name:_0x53167d,to_Roomname:_0x5b79fb,to_Room_name:_0x149eb3,note:_0x2bbb20,level:_0x41aa50,isle:_0x11a277,pallet:_0x519130}=_0x1115ce['body'];if(typeof _0x468168==_0x2269b5(0xd9))var _0x3b6745=[_0x1115ce['body']['product_name']],_0x1105e1=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x154)]],_0x6a2446=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0xf3)]],_0x556249=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x19f)]],_0x210a05=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0xc9)]],_0xe37685=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x13e)]],_0x342552=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x133)]],_0x279ff5=[_0x1115ce[_0x2269b5(0x131)]['bay']],_0x120ea1=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x173)]],_0x1d8ede=[_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x129)]],_0x2a746f=[_0x1115ce[_0x2269b5(0x131)]['floorlevel']];else var _0x3b6745=[..._0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x165)]],_0x1105e1=[..._0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x154)]],_0x6a2446=[..._0x1115ce['body'][_0x2269b5(0xf3)]],_0x556249=[..._0x1115ce['body'][_0x2269b5(0x19f)]],_0x210a05=[..._0x1115ce[_0x2269b5(0x131)][_0x2269b5(0xc9)]],_0xe37685=[..._0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x13e)]],_0x342552=[..._0x1115ce[_0x2269b5(0x131)]['return_qty']],_0x279ff5=[..._0x1115ce[_0x2269b5(0x131)][_0x2269b5(0xd3)]],_0x120ea1=[..._0x1115ce[_0x2269b5(0x131)][_0x2269b5(0x173)]],_0x1d8ede=[..._0x1115ce['body'][_0x2269b5(0x129)]],_0x2a746f=[..._0x1115ce['body'][_0x2269b5(0x11b)]];const _0x14246a=_0x3b6745['map'](_0x399252=>{return _0x399252={'product_name':_0x399252};});_0x1105e1[_0x2269b5(0x9e)]((_0xdb095a,_0x56fd45)=>{var _0xe8da3a=_0x2269b5;_0x14246a[_0x56fd45][_0xe8da3a(0x154)]=_0xdb095a;}),_0x6a2446[_0x2269b5(0x9e)]((_0xb300c1,_0x19cebe)=>{var _0x4e88c7=_0x2269b5;_0x14246a[_0x19cebe][_0x4e88c7(0xf3)]=_0xb300c1;}),_0x556249[_0x2269b5(0x9e)]((_0x10bdd7,_0x8b69ab)=>{var _0x30ef91=_0x2269b5;_0x14246a[_0x8b69ab][_0x30ef91(0x19f)]=_0x10bdd7;}),_0x210a05[_0x2269b5(0x9e)]((_0x81d76f,_0x54974d)=>{var _0x2c9dec=_0x2269b5;_0x14246a[_0x54974d][_0x2c9dec(0x140)]=_0x81d76f;}),_0xe37685[_0x2269b5(0x9e)]((_0x8c35ee,_0x56c6fe)=>{var _0x2905f0=_0x2269b5;_0x14246a[_0x56c6fe][_0x2905f0(0x192)]=_0x8c35ee;}),_0x342552[_0x2269b5(0x9e)]((_0x3e948b,_0x1863bc)=>{_0x14246a[_0x1863bc]['return_qty']=_0x3e948b;}),_0x279ff5[_0x2269b5(0x9e)]((_0x395931,_0x31b193)=>{var _0x2425ed=_0x2269b5;_0x14246a[_0x31b193][_0x2425ed(0xd3)]=_0x395931;}),_0x120ea1[_0x2269b5(0x9e)]((_0x18ea9c,_0x44fa85)=>{var _0x17156c=_0x2269b5;_0x14246a[_0x44fa85][_0x17156c(0x173)]=_0x18ea9c;}),_0x1d8ede[_0x2269b5(0x9e)]((_0x7f82cd,_0x37c10b)=>{var _0x1567ad=_0x2269b5;_0x14246a[_0x37c10b][_0x1567ad(0x9a)]=_0x7f82cd;}),_0x2a746f[_0x2269b5(0x9e)]((_0x87b27e,_0x53c103)=>{_0x14246a[_0x53c103]['floorlevel']=_0x87b27e;});var _0x526d43=0x0;_0x14246a[_0x2269b5(0x9e)](_0x1a3d0b=>{var _0x4c8a9d=_0x2269b5;console['log'](_0x4c8a9d(0x1a1),_0x1a3d0b),(parseInt(_0x1a3d0b['sale_qty'])<parseInt(_0x1a3d0b[_0x4c8a9d(0x133)])||parseInt(_0x1a3d0b['stock'])<parseInt(_0x1a3d0b[_0x4c8a9d(0x133)])&&parseInt(_0x1a3d0b['sale_qty'])>parseInt(_0x1a3d0b['return_qty'])||parseInt(_0x1a3d0b[_0x4c8a9d(0x133)])==0x0)&&_0x526d43++;});if(_0x526d43!=0x0)return _0x1115ce[_0x2269b5(0xec)](_0x2269b5(0x174),_0x2269b5(0x107)),_0xb2f252[_0x2269b5(0x18d)](_0x2269b5(0x184));const _0x1df968=await sales['findOne']({'invoice':_0x95bb35});console[_0x2269b5(0xac)](_0x1df968),_0x1df968[_0x2269b5(0x10d)]=_0x2269b5(0xde);const _0x1c7ad1=await _0x1df968['save'](),_0x3cf826=new sales_return({'invoice':_0x95bb35,'customer':_0x1115ce[_0x2269b5(0x131)]['customer'],'date':_0x1ebc23,'warehouse_name':_0x2b51dd,'room':_0x208ab0,'ToWarehouse':_0x53167d,'ToRoom':_0x149eb3,'return_sale':_0x14246a,'note':_0x2bbb20}),_0x521976=await _0x3cf826[_0x2269b5(0x11f)]();console[_0x2269b5(0xac)](_0x3cf826);const _0x29bc37=await sales_return[_0x2269b5(0xba)]({'invoice':_0x95bb35}),_0x535a15=await warehouse[_0x2269b5(0xba)]({'name':_0x53167d,'room':_0x149eb3});_0x29bc37[_0x2269b5(0x148)][_0x2269b5(0x9e)](_0x30c04e=>{var _0x3402fa=_0x2269b5,_0x6d6cac=0x0;const _0x330514=_0x535a15[_0x3402fa(0xcd)][_0x3402fa(0xfc)](_0x1b52d6=>{var _0x59866d=_0x3402fa;_0x1b52d6['product_name']==_0x30c04e[_0x59866d(0x165)]&&_0x1b52d6[_0x59866d(0x11b)]==_0x30c04e[_0x59866d(0x11b)]&&_0x1b52d6['type']==_0x30c04e['type']&&_0x1b52d6[_0x59866d(0x173)]==_0x30c04e[_0x59866d(0x173)]&&_0x1b52d6[_0x59866d(0xd3)]==_0x30c04e[_0x59866d(0xd3)]&&(_0x1b52d6[_0x59866d(0x16a)]=parseInt(_0x1b52d6[_0x59866d(0x16a)])+parseInt(_0x30c04e['return_qty']),_0x6d6cac++);});_0x6d6cac=='0'&&(_0x535a15[_0x3402fa(0xcd)]=_0x535a15[_0x3402fa(0xcd)][_0x3402fa(0x11a)]({'product_name':_0x30c04e[_0x3402fa(0x165)],'product_stock':_0x30c04e[_0x3402fa(0x133)],'primary_code':_0x30c04e[_0x3402fa(0x154)],'secondary_code':_0x30c04e[_0x3402fa(0xf3)],'product_code':_0x30c04e['product_code'],'bay':_0x30c04e[_0x3402fa(0xd3)],'bin':_0x30c04e['bin'],'type':_0x30c04e[_0x3402fa(0x9a)],'floorlevel':_0x30c04e[_0x3402fa(0x11b)]})),console[_0x3402fa(0xac)](_0x3402fa(0x12e),_0x535a15);}),await _0x535a15[_0x2269b5(0x11f)](),console[_0x2269b5(0xac)](_0x1115ce[_0x2269b5(0x131)]);const _0x39ea16=new c_payment_data({'invoice':_0x95bb35,'customer':_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0xf5)],'reason':'Sale\x20Return'});await _0x39ea16[_0x2269b5(0x11f)]();const _0x19e776=await master_shop[_0x2269b5(0x150)]();console[_0x2269b5(0xac)]('add\x20post',_0x19e776[0x0][_0x2269b5(0x15b)]);const _0x54683f=await email_settings[_0x2269b5(0xba)](),_0x2fe42a=await customer[_0x2269b5(0xba)]({'name':_0x1115ce[_0x2269b5(0x131)][_0x2269b5(0xf5)]});console[_0x2269b5(0xac)](_0x2269b5(0xee),_0x2fe42a);_0x19e776[0x0][_0x2269b5(0x18e)]==0x1?(right_currency=_0x19e776[0x0][_0x2269b5(0xeb)],left_currency=''):(right_currency='',left_currency=_0x19e776[0x0][_0x2269b5(0xeb)]);var _0x533603=_0x3b6745,_0x1dca89=_0x342552,_0x5a0773='',_0x2fe013;for(_0x2fe013 in _0x533603){_0x5a0773+=_0x2269b5(0x143)+_0x2269b5(0x185)+_0x533603[_0x2fe013]+_0x2269b5(0x127)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1dca89[_0x2fe013]+_0x2269b5(0x127)+'</tr>';}console[_0x2269b5(0xac)]('product_list',_0x5a0773);let _0x3ac947=nodemailer[_0x2269b5(0x197)]({'service':'gmail','auth':{'user':_0x54683f[_0x2269b5(0xe1)],'pass':_0x54683f[_0x2269b5(0x100)]}}),_0x24aa5a={'from':_0x54683f[_0x2269b5(0xe1)],'to':_0x2fe42a['email'],'subject':_0x2269b5(0x145),'attachments':[{'filename':_0x2269b5(0xce),'path':__dirname+'/../public'+_0x2269b5(0x109)+_0x19e776[0x0][_0x2269b5(0x15b)],'cid':'logo'}],'html':_0x2269b5(0x167)+_0x2269b5(0x130)+_0x2269b5(0x105)+_0x2269b5(0x13c)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2269b5(0x13c)+_0x2269b5(0x188)+'</div>'+_0x2269b5(0x13c)+_0x2269b5(0x17c)+_0x19e776[0x0][_0x2269b5(0xc3)]+_0x2269b5(0x155)+'</div>'+'</div>'+_0x2269b5(0xca)+_0x2269b5(0x13c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x95bb35+'\x20'+_0x2269b5(0xc7)+_0x2269b5(0x142)+_0x1ebc23+'\x20'+_0x2269b5(0xa0)+_0x2269b5(0x166)+_0x2269b5(0x96)+_0x2269b5(0x175)+_0x2269b5(0x198)+_0x2269b5(0x143)+_0x2269b5(0x9c)+_0x2269b5(0xe7)+_0x2269b5(0xa9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x2269b5(0x119)+_0x2269b5(0x112)+_0x2269b5(0xc1)+'\x20'+_0x5a0773+'\x20'+_0x2269b5(0x13b)+_0x2269b5(0x106)+_0x2269b5(0x13c)+_0x2269b5(0xbb)+_0x2269b5(0x16c)+_0x19e776[0x0][_0x2269b5(0xc3)]+_0x2269b5(0x166)+'</div>'+_0x2269b5(0x96)+_0x2269b5(0xd2)};_0x3ac947[_0x2269b5(0x12d)](_0x24aa5a,function(_0x1b11e4,_0x4a7f3d){var _0x38e199=_0x2269b5;_0x1b11e4?(console[_0x38e199(0xac)](_0x1b11e4),console[_0x38e199(0xac)](_0x38e199(0xf0))):console[_0x38e199(0xac)](_0x38e199(0xd0));}),_0x1115ce[_0x2269b5(0xec)](_0x2269b5(0x170),_0x2269b5(0x128)),_0xb2f252['redirect'](_0x2269b5(0x15e));}catch(_0x41b207){console[_0x2269b5(0xac)](_0x41b207),_0xb2f252['status'](0xc8)['json']({'message1':_0x41b207[_0x2269b5(0x199)]});}}),router[a0_0x415a07(0x14d)](a0_0x415a07(0x116),auth,async(_0x48a476,_0x3fd74d)=>{var _0x47b393=a0_0x415a07;try{const {username:_0x56fbf9,email:_0x4df436,role:_0x581755}=_0x48a476[_0x47b393(0x17d)],_0x43c888=_0x48a476[_0x47b393(0x17d)],_0x2fed5a=await profile['findOne']({'email':_0x43c888[_0x47b393(0xe1)]}),_0x26ba86=await master_shop[_0x47b393(0x150)]();console[_0x47b393(0xac)](_0x47b393(0x172),_0x26ba86);const _0x3eb8f4=_0x48a476[_0x47b393(0x16d)]['id'],_0x266d94=await sales[_0x47b393(0x104)](_0x3eb8f4);console[_0x47b393(0xac)]('barcode\x20user_id',_0x266d94);if(_0x26ba86[0x0][_0x47b393(0x101)]==_0x47b393(0xcc))var _0x359daa=users[_0x47b393(0xdc)];else{if(_0x26ba86[0x0][_0x47b393(0x101)]=='Hindi')var _0x359daa=users['Hindi'];else{if(_0x26ba86[0x0][_0x47b393(0x101)]==_0x47b393(0x13d))var _0x359daa=users[_0x47b393(0x13d)];else{if(_0x26ba86[0x0]['language']==_0x47b393(0x160))var _0x359daa=users[_0x47b393(0x160)];else{if(_0x26ba86[0x0]['language']==_0x47b393(0x110))var _0x359daa=users['French'];else{if(_0x26ba86[0x0]['language']==_0x47b393(0xf7))var _0x359daa=users[_0x47b393(0x193)];else{if(_0x26ba86[0x0][_0x47b393(0x101)]=='Chinese')var _0x359daa=users[_0x47b393(0xad)];else{if(_0x26ba86[0x0][_0x47b393(0x101)]==_0x47b393(0xe2))var _0x359daa=users['Arabic'];}}}}}}}_0x3fd74d['render'](_0x47b393(0x94),{'success':_0x48a476['flash'](_0x47b393(0x170)),'errors':_0x48a476[_0x47b393(0xec)](_0x47b393(0x174)),'role':_0x43c888,'profile':_0x2fed5a,'alldata':_0x266d94,'master_shop':_0x26ba86,'language':_0x359daa});}catch(_0x530dbe){console['log'](_0x530dbe);}}),router[a0_0x415a07(0xe5)](a0_0x415a07(0xb2),async(_0x455c29,_0x5f3d1f)=>{var _0x3e3f50=a0_0x415a07;const {product_code:_0x164797,warehouse_name:_0x516d4e,rooms_data:_0xb8a732,Roomslist:_0x23650d}=_0x455c29[_0x3e3f50(0x131)],_0x327a6b=_0x23650d['split'](','),_0xf37166=[];async function _0x2add6b(_0x24b963){var _0x54e106=_0x3e3f50;const _0x416eae=await warehouse['aggregate']([{'$match':{'name':_0x516d4e,'room':_0x24b963}},{'$unwind':_0x54e106(0x183)},{'$match':{'product_details.primary_code':_0x164797}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x54e106(0x144)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x54e106(0x12b)},'level':{'$first':_0x54e106(0x12a)},'isle':{'$first':_0x54e106(0xea)},'type':{'$first':_0x54e106(0xe8)},'pallet':{'$first':_0x54e106(0x195)},'unit':{'$first':_0x54e106(0x10a)},'secondary_unit':{'$first':_0x54e106(0xd1)},'storage':{'$first':_0x54e106(0xfe)},'rack':{'$first':_0x54e106(0x17e)},'expiry_date':{'$first':_0x54e106(0x98)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x54e106(0x196)},'batch_code':{'$first':_0x54e106(0xbf)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x54e106(0x151)},'actual_qty':{'$first':_0x54e106(0x194)},'actual_uom':{'$first':_0x54e106(0xa4)}}}]),_0x242aeb=await warehouse['aggregate']([{'$match':{'name':_0x516d4e,'room':_0x24b963}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x164797}},{'$group':{'_id':_0x54e106(0x14c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x54e106(0x144)},'primary_code':{'$first':_0x54e106(0x8f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x54e106(0x12b)},'level':{'$first':_0x54e106(0x12a)},'isle':{'$first':_0x54e106(0xea)},'type':{'$first':_0x54e106(0xe8)},'pallet':{'$first':_0x54e106(0x195)},'unit':{'$first':_0x54e106(0x10a)},'secondary_unit':{'$first':_0x54e106(0xd1)},'storage':{'$first':_0x54e106(0xfe)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x54e106(0x98)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x54e106(0x196)},'batch_code':{'$first':_0x54e106(0xbf)},'product_cat':{'$first':_0x54e106(0x182)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x54e106(0x102)},'invoice':{'$first':_0x54e106(0x151)}}}]);if(_0x416eae[_0x54e106(0xb0)]>0x0)_0xf37166[_0x54e106(0x132)](_0x416eae);else _0x242aeb[_0x54e106(0xb0)]>0x0&&_0xf37166[_0x54e106(0x132)](_0x242aeb);}const _0x190c93=_0x327a6b[_0x3e3f50(0xfc)](_0x24b7ec=>_0x2add6b(_0x24b7ec));await Promise[_0x3e3f50(0xe6)](_0x190c93),_0x5f3d1f[_0x3e3f50(0x126)](_0xf37166);}),module[a0_0x415a07(0xbe)]=router;