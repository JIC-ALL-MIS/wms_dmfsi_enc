function a0_0x53c0(_0x5ae25d,_0x4d8aed){var _0x360f65=a0_0x360f();return a0_0x53c0=function(_0x53c0d5,_0x192fd8){_0x53c0d5=_0x53c0d5-0x19e;var _0x51d074=_0x360f65[_0x53c0d5];return _0x51d074;},a0_0x53c0(_0x5ae25d,_0x4d8aed);}var a0_0x127ba=a0_0x53c0;(function(_0x2b8d21,_0x3d8085){var _0x2bfe69=a0_0x53c0,_0x3e9fbc=_0x2b8d21();while(!![]){try{var _0x46ceac=-parseInt(_0x2bfe69(0x239))/0x1+-parseInt(_0x2bfe69(0x222))/0x2+-parseInt(_0x2bfe69(0x1d5))/0x3*(-parseInt(_0x2bfe69(0x1da))/0x4)+parseInt(_0x2bfe69(0x1b6))/0x5*(-parseInt(_0x2bfe69(0x298))/0x6)+parseInt(_0x2bfe69(0x20b))/0x7*(-parseInt(_0x2bfe69(0x1c1))/0x8)+parseInt(_0x2bfe69(0x29c))/0x9*(parseInt(_0x2bfe69(0x286))/0xa)+-parseInt(_0x2bfe69(0x1b1))/0xb*(-parseInt(_0x2bfe69(0x27a))/0xc);if(_0x46ceac===_0x3d8085)break;else _0x3e9fbc['push'](_0x3e9fbc['shift']());}catch(_0x2f7fe0){_0x3e9fbc['push'](_0x3e9fbc['shift']());}}}(a0_0x360f,0x8463a));const express=require(a0_0x127ba(0x21c)),app=express(),router=express[a0_0x127ba(0x1e7)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x127ba(0x29b)),auth=require(a0_0x127ba(0x24b)),nodemailer=require(a0_0x127ba(0x223)),users=require(a0_0x127ba(0x203));function a0_0x360f(){var _0xe33e94=['product_code','secondary_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','padStart','An\x20error\x20occurred.','$room','status','German','$product_details.maxPerUnit','$invoice','render','$sale_product.floorlevel','master','$customers_docs','4579850NpQJnJ','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details','$product_details.secondary_unit','5XLkJOA','Return\x20Goods','product_list','Sales\x20Update\x20successfully','quantity_notConverted','json','Ambient','host','sendMail','return_sale','catch','6150568oGsSAi','final','<h2>\x20','$product_details.product_name','received_amount','isAllowEdit','unit','user','/view/add_sales','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','getMonth','getFullYear','add\x20post','Portuguese\x20(BR)','errors','delivery_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</thead>','English','126393gXiggm','$product_details.primary_code','/view','requested_qty','note','52xoNMWO','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','prod_invoice','warehouse_name','delivery_code','$return_data','SCRN','$product_details.bay','abs','</body></html>','Sale\x20Return','</div>','Router','edit_sales_view','payment\x20successfull','due_amount','$product_details.rack','barcode\x20Product\x20master','Hindi','body','$product.product_name','type','invoice','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Arabic','length','language','customers_docs','$product_details.secondary_code','actual_uom','redirect','aggregate','$product_details.product_code','/all_sales/view','English\x20(US)','actual_qty','RMSEmail','exports','../public/language/languages.json','$_id','storage','$date','primary_code','foreach\x20newproduct','Level','</tr>','7vzDrnl','image','batch_code','level','Portuguese','/view/return_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','get','True','Shelves','<!DOCTYPE\x20html>','string','$product_details.production_date','toString','params','product_stock','_id','express','customer','$product_details.unit','email','$product_details.actual_qty','secondary_unit','1652530ggshuW','nodemailer','push','customers','product_details','Return\x20Rooms','Enabled','split','carton','Floor','</span>','</td>','room_name','/barcode_scanner','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Email\x20sent\x20successfully','findOne','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','forEach','currency_placement','$product_details.floorlevel','837736UbcttG','site_title','/../public','sale_qty','$product_details.invoice','<hr\x20class=\x22my-3\x22>','all','post','$sale_product','$product_details.type','Enclosed','</tbody>','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','French','$sale_product.quantity','max','role','../middleware/auth','\x20Order\x20Number\x20:\x20','log','createTransport','prod_code','/all_sales/preview/','success','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$finalize','Error\x20Occurs','stocks','save','$product_details.expiry_date','error','$product_details.level','$sale_product.bay','room','$product_details._id','</head><body>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<html><head><title></title>','primary_unit','currency','$product_details.product_stock','$warehouse_name','port','Logo.png','quantity','random','$isAllowEdit','/upload/','$product_details.batch_code','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','slice','floorlevel','</h5>','<div>','$product_details.storage','gmail','maxperunit','RoomAssigned','</table>','product','product_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Raw\x20Materials','stock','48heEmly','stock_data','/view/add_sale/product','$note','False','OUT-','production_date','$name','return_qty','warehouse','\x20</h2>','sales\x20all_data','21170RpOjJU','staff','sales\x20item\x20return\x20successfull','types','$sale_product.bin','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','sale_product','add_sales','max_per_unit','edit_sales','expiry_date','find','concat','Received\x20Payment\x20For\x20Sale','$product_details.isle','$product_details.bin','<strong>\x20Regards\x20</strong>','89724IyfmAk','<span\x20style=\x22float:\x20right;\x22>','$customer','../models/all_models','3303osuARj','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','all_sales_barcode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$sale_product.type','finalize','<h5\x20style=\x22text-align:\x20left;\x22>','<h5>','password','logo','bin','map','name','amount','bay','/preview/:id'];a0_0x360f=function(){return _0xe33e94;};return a0_0x360f();}router['get'](a0_0x127ba(0x1d7),auth,async(_0x2adb31,_0x2ffe2f)=>{var _0x1e4ddf=a0_0x127ba;try{const {username:_0x5893ef,email:_0x4f2bbb,role:_0x277810}=_0x2adb31['user'],_0x7808b=_0x2adb31['user'],_0x3b41da=await profile[_0x1e4ddf(0x233)]({'email':_0x7808b[_0x1e4ddf(0x21f)]}),_0x3db541=await master_shop[_0x1e4ddf(0x292)]();let _0x21e406;if(_0x7808b['role']=='staff'){const _0x593bb6=await staff[_0x1e4ddf(0x233)]({'email':_0x7808b[_0x1e4ddf(0x21f)]});_0x21e406=await sales[_0x1e4ddf(0x1fc)]([{'$lookup':{'from':'customers','localField':_0x1e4ddf(0x21d),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x1e4ddf(0x1b0)},{'$unwind':_0x1e4ddf(0x241)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1e4ddf(0x1ac)},'customers':{'$first':'$customer'},'date':{'$first':_0x1e4ddf(0x206)},'warehouse_name':{'$first':_0x1e4ddf(0x263)},'sale_product':{'$push':_0x1e4ddf(0x241)},'note':{'$first':_0x1e4ddf(0x27d)},'return_data':{'$first':_0x1e4ddf(0x1e0)},'customers_docs':{'$first':_0x1e4ddf(0x1b0)},'total_saleproduct_quantity':{'$sum':_0x1e4ddf(0x248)},'level':{'$addToSet':_0x1e4ddf(0x25a)},'isle':{'$addToSet':_0x1e4ddf(0x28a)},'type':{'$addToSet':_0x1e4ddf(0x2a0)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x21e406=await sales[_0x1e4ddf(0x1fc)]([{'$lookup':{'from':_0x1e4ddf(0x225),'localField':'customer','foreignField':_0x1e4ddf(0x19e),'as':_0x1e4ddf(0x1f8)}},{'$unwind':_0x1e4ddf(0x1b0)},{'$unwind':_0x1e4ddf(0x241)},{'$group':{'_id':_0x1e4ddf(0x204),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x1e4ddf(0x29a)},'date':{'$first':_0x1e4ddf(0x206)},'warehouse_name':{'$first':_0x1e4ddf(0x263)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x1e4ddf(0x1e0)},'customers_docs':{'$first':_0x1e4ddf(0x1b0)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x1e4ddf(0x25a)},'isle':{'$addToSet':_0x1e4ddf(0x28a)},'type':{'$addToSet':_0x1e4ddf(0x2a0)},'pallet':{'$addToSet':_0x1e4ddf(0x1ae)},'finalize':{'$first':_0x1e4ddf(0x253)},'isAllowEdit':{'$first':_0x1e4ddf(0x268)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x1e4ddf(0x24d)](_0x1e4ddf(0x285),_0x21e406);if(_0x3db541[0x0][_0x1e4ddf(0x1f7)]==_0x1e4ddf(0x1ff)){var _0x4c0777=users['English'];console['log'](_0x4c0777);}else{if(_0x3db541[0x0][_0x1e4ddf(0x1f7)]==_0x1e4ddf(0x1ed))var _0x4c0777=users['Hindi'];else{if(_0x3db541[0x0][_0x1e4ddf(0x1f7)]=='German')var _0x4c0777=users['German'];else{if(_0x3db541[0x0]['language']==_0x1e4ddf(0x1ca))var _0x4c0777=users['Spanish'];else{if(_0x3db541[0x0][_0x1e4ddf(0x1f7)]==_0x1e4ddf(0x247))var _0x4c0777=users['French'];else{if(_0x3db541[0x0][_0x1e4ddf(0x1f7)]=='Portuguese\x20(BR)')var _0x4c0777=users[_0x1e4ddf(0x20f)];else{if(_0x3db541[0x0]['language']=='Chinese')var _0x4c0777=users[_0x1e4ddf(0x230)];else{if(_0x3db541[0x0][_0x1e4ddf(0x1f7)]=='Arabic\x20(ae)')var _0x4c0777=users['Arabic'];}}}}}}}_0x2ffe2f[_0x1e4ddf(0x1ad)]('all_sales',{'success':_0x2adb31[_0x1e4ddf(0x245)]('success'),'errors':_0x2adb31[_0x1e4ddf(0x245)](_0x1e4ddf(0x1d0)),'sales':_0x21e406,'profile':_0x3b41da,'role':_0x7808b,'master_shop':_0x3db541,'language':_0x4c0777});}catch(_0x7ae1d4){console['log'](_0x7ae1d4);}});async function getRandom8DigitNumber(){var _0x1bd45f=a0_0x127ba;const _0x53777c=0x989680,_0xa268df=0x5f5e0ff,_0x50271d=Math['floor'](Math[_0x1bd45f(0x267)]()*(_0xa268df-_0x53777c+0x1))+_0x53777c;var _0x336f95;const _0x5b5196=await sales[_0x1bd45f(0x233)]({'invoice':_0x1bd45f(0x27f)+_0x50271d});return _0x5b5196&&_0x5b5196[_0x1bd45f(0x1f6)]>0x0?_0x336f95='OUT-'+_0x50271d:_0x336f95='OUT-'+_0x50271d,_0x336f95;}router['get'](a0_0x127ba(0x1c9),auth,async(_0x376008,_0x5cbdd6)=>{var _0x1bebb9=a0_0x127ba;try{const {username:_0x54fba1,email:_0x108ff4,role:_0x4db920}=_0x376008[_0x1bebb9(0x1c8)],_0x2f8b8f=_0x376008[_0x1bebb9(0x1c8)],_0x1d785d=await profile[_0x1bebb9(0x233)]({'email':_0x2f8b8f['email']}),_0x5fcc83=await master_shop[_0x1bebb9(0x292)](),_0x371b64=await customer[_0x1bebb9(0x292)]({});let _0x37633d;if(_0x2f8b8f[_0x1bebb9(0x24a)]==_0x1bebb9(0x287)){const _0x308dec=await staff[_0x1bebb9(0x233)]({'email':_0x2f8b8f[_0x1bebb9(0x21f)]});_0x37633d=await warehouse[_0x1bebb9(0x1fc)]([{'$match':{'status':_0x1bebb9(0x228),'name':_0x308dec[_0x1bebb9(0x283)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x1bebb9(0x281),'name':{'$first':_0x1bebb9(0x281)}}},{'$sort':{'name':0x1}}]);}else _0x37633d=await warehouse[_0x1bebb9(0x1fc)]([{'$match':{'status':_0x1bebb9(0x228),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1bebb9(0x1b7)}}},{'$group':{'_id':_0x1bebb9(0x281),'name':{'$first':_0x1bebb9(0x281)}}},{'$sort':{'name':0x1}}]);const _0x21a7b5=await product[_0x1bebb9(0x292)]({});var _0x53753e=[_0x1bebb9(0x1bc),_0x1bebb9(0x243)];const _0xae4f42=await sales['find']({}),_0x14e503=_0xae4f42['length']+0x1,_0x39e3a5=_0x1bebb9(0x27f)+_0x14e503[_0x1bebb9(0x218)]()[_0x1bebb9(0x1a6)](0x5,'0');if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]==_0x1bebb9(0x1ff)){var _0x33ee05=users[_0x1bebb9(0x1d4)];console[_0x1bebb9(0x24d)](_0x33ee05);}else{if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]==_0x1bebb9(0x1ed))var _0x33ee05=users[_0x1bebb9(0x1ed)];else{if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]==_0x1bebb9(0x1aa))var _0x33ee05=users['German'];else{if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]==_0x1bebb9(0x1ca))var _0x33ee05=users['Spanish'];else{if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]=='French')var _0x33ee05=users[_0x1bebb9(0x247)];else{if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]==_0x1bebb9(0x1cf))var _0x33ee05=users[_0x1bebb9(0x20f)];else{if(_0x5fcc83[0x0][_0x1bebb9(0x1f7)]==_0x1bebb9(0x230))var _0x33ee05=users[_0x1bebb9(0x230)];else{if(_0x5fcc83[0x0]['language']==_0x1bebb9(0x1f2))var _0x33ee05=users[_0x1bebb9(0x1f5)];}}}}}}}const _0x40134f=getRandom8DigitNumber();_0x40134f['then'](_0x3f8c3d=>{var _0x5f12d3=_0x1bebb9;_0x5cbdd6[_0x5f12d3(0x1ad)](_0x5f12d3(0x28e),{'success':_0x376008[_0x5f12d3(0x245)](_0x5f12d3(0x251)),'errors':_0x376008[_0x5f12d3(0x245)](_0x5f12d3(0x1d0)),'role':_0x2f8b8f,'profile':_0x1d785d,'customer':_0x371b64,'warehouse':_0x37633d,'product':_0x21a7b5,'invoice':_0x3f8c3d,'master_shop':_0x5fcc83,'language':_0x33ee05,'rooms_data':_0x53753e});})[_0x1bebb9(0x1c0)](_0x4d25bb=>{var _0x5bcaa0=_0x1bebb9;_0x376008['flash'](_0x5bcaa0(0x1d0),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5cbdd6[_0x5bcaa0(0x1fb)](_0x5bcaa0(0x1fe));});}catch(_0x1f2d3e){console[_0x1bebb9(0x24d)](_0x1f2d3e);}}),router['get']('/view/add_sales/:id',auth,async(_0x164db3,_0x48a621)=>{var _0x5e325f=a0_0x127ba;try{const _0x3ff18c=_0x164db3['params']['id'];console[_0x5e325f(0x24d)](_0x3ff18c);const _0x4bd7d6=await product[_0x5e325f(0x292)](),_0x2267ab=await purchases[_0x5e325f(0x1fc)]([{'$match':{'warehouse_name':_0x3ff18c}},{'$unwind':'$product'},{'$group':{'_id':_0x5e325f(0x1ef)}}]);console['log']('purchases_data',_0x2267ab),_0x48a621[_0x5e325f(0x1a9)](0xc8)[_0x5e325f(0x1bb)]({'purchases_data':_0x2267ab,'product_data':_0x4bd7d6});}catch(_0x2a8471){console['log'](_0x2a8471);}}),router[a0_0x127ba(0x240)](a0_0x127ba(0x27c),auth,async(_0x47f905,_0x32258a)=>{var _0x39f1d9=a0_0x127ba;try{const {warehouse_data:_0x4d837d,product_data:_0x509d12}=_0x47f905[_0x39f1d9(0x1ee)];console[_0x39f1d9(0x24d)](_0x47f905[_0x39f1d9(0x1ee)][_0x39f1d9(0x276)]);;const _0x4d0507=await master_shop[_0x39f1d9(0x292)]();console[_0x39f1d9(0x24d)](_0x39f1d9(0x1af),_0x4d0507);const _0x4d68de=await product[_0x39f1d9(0x233)]({'name':_0x509d12});console[_0x39f1d9(0x24d)](_0x39f1d9(0x275),_0x4d68de);const _0x4fad14=await warehouse['aggregate']([{'$match':{'name':_0x4d837d}},{'$unwind':_0x39f1d9(0x1b4)},{'$match':{'product_details.product_name':_0x509d12}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x39f1d9(0x24d)]('stock_data',_0x4fad14),_0x32258a['status'](0xc8)[_0x39f1d9(0x1bb)]({'master':_0x4d0507,'new_product':_0x4d68de,'stock_data':_0x4fad14});}catch(_0x131ce1){console[_0x39f1d9(0x24d)](_0x131ce1);}}),router[a0_0x127ba(0x240)](a0_0x127ba(0x1c9),auth,async(_0x2d0103,_0x5d97c1)=>{var _0x16e982=a0_0x127ba;try{const {invoice:_0x876954,date:_0x22d29b,warehouse_name:_0xf34ffc,product_name:_0x218a1b,stock:_0x4a7401,quantity:_0x55bb41,note:_0x1b1d64,room:_0x36f888,primary_code:_0x31d855,secondary_code:_0x245c80,prod_code:_0x43c44a,level:_0x5cebab,isle:_0x182c9b,pallet:_0x5705a3,batch_code:_0x328f5c,SCRN:_0x16ed92,expiry_date:_0x457c30}=_0x2d0103[_0x16e982(0x1ee)];if(typeof _0x218a1b==_0x16e982(0x216))var _0x31462f=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1a5)]],_0x52533e=[_0x2d0103['body'][_0x16e982(0x279)]],_0x13b268=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x22a)]],_0x21db97=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x207)]],_0x475481=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1a3)]],_0x1abdaa=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x24f)]],_0x2bdd65=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x20e)]],_0x1775d0=[_0x2d0103[_0x16e982(0x1ee)]['primary_unit']],_0x367db5=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x221)]],_0x323866=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x20d)]],_0x1e59f3=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x291)]],_0x24cab5=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x28f)]],_0x5b30ab=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x280)]],_0x1c2c57=[_0x2d0103['body']['requested_qty']],_0x43c21e=[_0x2d0103[_0x16e982(0x1ee)]['delivery_date']],_0x2cda39=[_0x2d0103['body'][_0x16e982(0x1df)]],_0x4ac821=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1dc)]],_0x59a6e5=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x266)]],_0x22d7c5=[_0x2d0103['body'][_0x16e982(0x273)]],_0x32ac05=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1dd)]],_0x4baaa0=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x200)]],_0x11faca=[_0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1fa)]];else var _0x31462f=[..._0x2d0103[_0x16e982(0x1ee)]['product_name']],_0x52533e=[..._0x2d0103['body']['stock']],_0x13b268=[..._0x2d0103[_0x16e982(0x1ee)]['carton']],_0x21db97=[..._0x2d0103[_0x16e982(0x1ee)]['primary_code']],_0x475481=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1a3)]],_0x1abdaa=[..._0x2d0103['body'][_0x16e982(0x24f)]],_0x2bdd65=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x20e)]],_0x1775d0=[..._0x2d0103['body'][_0x16e982(0x260)]],_0x367db5=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x221)]],_0x323866=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x20d)]],_0x1e59f3=[..._0x2d0103['body']['expiry_date']],_0x24cab5=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x28f)]],_0x5b30ab=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x280)]],_0x1c2c57=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1d8)]],_0x43c21e=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1d1)]],_0x2cda39=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1df)]],_0x4ac821=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1dc)]],_0x59a6e5=[..._0x2d0103[_0x16e982(0x1ee)]['quantity']],_0x22d7c5=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x273)]],_0x32ac05=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x1dd)]],_0x4baaa0=[..._0x2d0103[_0x16e982(0x1ee)][_0x16e982(0x200)]],_0x11faca=[..._0x2d0103['body'][_0x16e982(0x1fa)]];const _0x34d306=_0x31462f['map'](_0x3408ca=>{return _0x3408ca={'product_name':_0x3408ca};});_0x52533e[_0x16e982(0x236)]((_0x53c0b8,_0x58a5f3)=>{var _0x1d62ad=_0x16e982;_0x34d306[_0x58a5f3][_0x1d62ad(0x279)]=Math[_0x1d62ad(0x1e3)](_0x53c0b8);}),_0x4baaa0[_0x16e982(0x236)]((_0x52bdbd,_0x37329a)=>{var _0x1145c6=_0x16e982;_0x34d306[_0x37329a][_0x1145c6(0x200)]=Math[_0x1145c6(0x1e3)](_0x52bdbd);}),_0x11faca[_0x16e982(0x236)]((_0x14ea9e,_0x3a129d)=>{var _0x1d73b8=_0x16e982;_0x34d306[_0x3a129d][_0x1d73b8(0x1fa)]=_0x14ea9e;}),_0x13b268[_0x16e982(0x236)]((_0x497d63,_0x52c389)=>{var _0xb75cf3=_0x16e982;_0x34d306[_0x52c389][_0xb75cf3(0x266)]=_0x497d63;}),_0x21db97[_0x16e982(0x236)]((_0x5a3143,_0x19f671)=>{var _0x4dc07b=_0x16e982;_0x34d306[_0x19f671][_0x4dc07b(0x207)]=_0x5a3143;}),_0x475481[_0x16e982(0x236)]((_0x3a32f9,_0x52edb8)=>{var _0x276dae=_0x16e982;_0x34d306[_0x52edb8][_0x276dae(0x1a3)]=_0x3a32f9;}),_0x1abdaa['forEach']((_0x3a1d13,_0x1e5219)=>{_0x34d306[_0x1e5219]['product_code']=_0x3a1d13;}),_0x2bdd65[_0x16e982(0x236)]((_0x5c523f,_0x2acc89)=>{var _0x5b924e=_0x16e982;_0x22d7c5[_0x5b924e(0x236)]((_0xfda53,_0xcb7f53)=>{var _0x1bb6a6=_0x5b924e;if(_0xfda53=='Receiving\x20Area'&&_0x2acc89==_0xcb7f53){var _0x376b46=_0x5c523f['slice'](0x3);_0x34d306[_0x2acc89]['storage']=_0x5c523f[0x0],_0x34d306[_0x2acc89]['rack']=_0x5c523f[0x1],_0x34d306[_0x2acc89][_0x1bb6a6(0x1a0)]=0x0,_0x34d306[_0x2acc89][_0x1bb6a6(0x2a6)]=0x0,_0x34d306[_0x2acc89][_0x1bb6a6(0x1f0)]='Floor',_0x34d306[_0x2acc89]['floorlevel']=_0x376b46;}else{if(_0xfda53==_0x1bb6a6(0x214)&&_0x2acc89==_0xcb7f53){var _0x376b46=_0x5c523f['slice'](0x3);_0x34d306[_0x2acc89][_0x1bb6a6(0x205)]=_0x5c523f[0x0],_0x34d306[_0x2acc89][_0x1bb6a6(0x28b)]=_0x5c523f[0x1],_0x34d306[_0x2acc89][_0x1bb6a6(0x1a0)]=0x0,_0x34d306[_0x2acc89]['bin']=0x0,_0x34d306[_0x2acc89][_0x1bb6a6(0x1f0)]='Floor',_0x34d306[_0x2acc89][_0x1bb6a6(0x26d)]=_0x5c523f[0x5];}else{if(_0x2acc89==_0xcb7f53){var _0xaf4e7b;if(_0x5c523f[0x4]=='L')_0xaf4e7b=_0x1bb6a6(0x209);else _0x5c523f[0x4]=='F'&&(_0xaf4e7b=_0x1bb6a6(0x22b));_0x34d306[_0x2acc89][_0x1bb6a6(0x205)]=_0x5c523f[0x0],_0x34d306[_0x2acc89][_0x1bb6a6(0x28b)]=_0x5c523f[0x1],_0x34d306[_0x2acc89][_0x1bb6a6(0x1a0)]=_0x5c523f[0x2],_0x34d306[_0x2acc89][_0x1bb6a6(0x2a6)]=_0x5c523f[0x3],_0x34d306[_0x2acc89][_0x1bb6a6(0x1f0)]=_0xaf4e7b,_0x34d306[_0x2acc89][_0x1bb6a6(0x26d)]=_0x5c523f[0x5];}}}});}),_0x1775d0['forEach']((_0x56708c,_0x78586f)=>{var _0x2c487b=_0x16e982;_0x34d306[_0x78586f][_0x2c487b(0x1c7)]=_0x56708c;}),_0x367db5[_0x16e982(0x236)]((_0x10340e,_0x3c2b64)=>{var _0x5e35d9=_0x16e982;_0x34d306[_0x3c2b64][_0x5e35d9(0x221)]=_0x10340e;}),_0x323866[_0x16e982(0x236)]((_0x43ba92,_0x93fc4d)=>{var _0x4f358d=_0x16e982;_0x34d306[_0x93fc4d][_0x4f358d(0x20d)]=_0x43ba92;}),_0x1e59f3[_0x16e982(0x236)]((_0x4de8d0,_0x618dbb)=>{_0x34d306[_0x618dbb]['expiry_date']=_0x4de8d0;}),_0x24cab5['forEach']((_0x377a58,_0x460f05)=>{var _0x2d26d2=_0x16e982;_0x34d306[_0x460f05][_0x2d26d2(0x272)]=_0x377a58;}),_0x5b30ab['forEach']((_0x5bdad6,_0x3bd801)=>{_0x34d306[_0x3bd801]['production_date']=_0x5bdad6;}),_0x1c2c57[_0x16e982(0x236)]((_0x4dc415,_0x11a371)=>{_0x34d306[_0x11a371]['requested_qty']=_0x4dc415;}),_0x43c21e[_0x16e982(0x236)]((_0x971576,_0x53d93f)=>{_0x34d306[_0x53d93f]['delivery_date']=_0x971576;}),_0x2cda39[_0x16e982(0x236)]((_0x5a82bd,_0x1baa2d)=>{var _0x220777=_0x16e982;_0x34d306[_0x1baa2d][_0x220777(0x1df)]=_0x5a82bd;}),_0x4ac821['forEach']((_0x5cd027,_0x3686f9)=>{_0x34d306[_0x3686f9]['prod_cat']=_0x5cd027;}),_0x59a6e5[_0x16e982(0x236)]((_0x36b667,_0x26833e)=>{var _0x408cf9=_0x16e982;_0x34d306[_0x26833e][_0x408cf9(0x1ba)]=_0x36b667;}),_0x22d7c5['forEach']((_0x42df4d,_0x4961c4)=>{var _0x3f0bcc=_0x16e982;_0x34d306[_0x4961c4][_0x3f0bcc(0x22e)]=_0x42df4d;}),_0x32ac05['forEach']((_0xdd5a49,_0x2263b1)=>{var _0x25a244=_0x16e982;_0x34d306[_0x2263b1][_0x25a244(0x1f1)]=_0xdd5a49;});var _0x22cddc=0x0;_0x34d306[_0x16e982(0x236)](_0x55b194=>{var _0x4c43c8=_0x16e982;(_0x55b194[_0x4c43c8(0x279)]<_0x55b194['quantity_notConverted']||_0x55b194[_0x4c43c8(0x1ba)]==0x0)&&(console[_0x4c43c8(0x24d)](_0x4c43c8(0x208),_0x55b194),_0x22cddc++);});const _0x6f7e03=_0x34d306['filter'](_0x410bf5=>_0x410bf5[_0x16e982(0x266)]!=='0'&&_0x410bf5[_0x16e982(0x266)]!==''),_0x3124f1=new sales({'invoice':_0x876954,'customer':_0x2d0103['body'][_0x16e982(0x21d)],'date':_0x22d29b,'warehouse_name':_0xf34ffc,'sale_product':_0x6f7e03,'note':_0x1b1d64,'room':_0x36f888,'primary_code':_0x31d855,'secondary_code':_0x245c80,'prod_code':_0x43c44a,'SCRN':_0x16ed92}),_0x9ce55d=await _0x3124f1[_0x16e982(0x256)]();_0x2d0103[_0x16e982(0x245)](_0x16e982(0x251),'Sales\x20Add\x20successfully'),_0x5d97c1[_0x16e982(0x1fb)](_0x16e982(0x250)+_0x9ce55d[_0x16e982(0x21b)]);}catch(_0x579bcd){console[_0x16e982(0x24d)](_0x579bcd);}}),router['get'](a0_0x127ba(0x1a1),auth,async(_0x3c8ad5,_0x112c3f)=>{var _0x3c282b=a0_0x127ba;try{const {username:_0x3a1389,email:_0x2b0c08,role:_0x16fef9}=_0x3c8ad5[_0x3c282b(0x1c8)],_0x1e17e3=_0x3c8ad5[_0x3c282b(0x1c8)],_0x53f070=await profile[_0x3c282b(0x233)]({'email':_0x1e17e3[_0x3c282b(0x21f)]}),_0x2e0730=await master_shop['find'](),_0x2bcf21=_0x3c8ad5[_0x3c282b(0x219)]['id'],_0x467e47=await sales[_0x3c282b(0x234)](_0x2bcf21),_0x184bad=await warehouse[_0x3c282b(0x1fc)]([{'$match':{'name':_0x467e47[_0x3c282b(0x1de)]}},{'$unwind':_0x3c282b(0x1b4)},{'$group':{'_id':_0x3c282b(0x25c),'name':{'$first':_0x3c282b(0x1c4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3c282b(0x1e2)},'bin':{'$first':_0x3c282b(0x296)},'type':{'$first':_0x3c282b(0x242)},'floorlevel':{'$first':_0x3c282b(0x238)},'primary_code':{'$first':_0x3c282b(0x1d6)},'secondary_code':{'$first':_0x3c282b(0x1f9)},'product_code':{'$first':_0x3c282b(0x1fd)},'storage':{'$first':_0x3c282b(0x270)},'rack':{'$first':_0x3c282b(0x1eb)},'expiry_date':{'$first':_0x3c282b(0x257)},'production_date':{'$first':_0x3c282b(0x217)},'invoice':{'$first':_0x3c282b(0x23d)}}}]),_0x4c9d3d=await customer[_0x3c282b(0x292)]({});let _0xc221c2;if(_0x1e17e3[_0x3c282b(0x24a)]==_0x3c282b(0x287)){const _0x452c60=await staff[_0x3c282b(0x233)]({'email':_0x1e17e3[_0x3c282b(0x21f)]});_0xc221c2=await warehouse[_0x3c282b(0x1fc)]([{'$match':{'status':'Enabled','name':_0x452c60[_0x3c282b(0x283)]}},{'$group':{'_id':_0x3c282b(0x281),'name':{'$first':'$name'}}}]);}else _0xc221c2=await warehouse['aggregate']([{'$match':{'status':_0x3c282b(0x228)}},{'$group':{'_id':_0x3c282b(0x281),'name':{'$first':_0x3c282b(0x281)}}}]);const _0x496c59=await product[_0x3c282b(0x292)]({}),_0x4f742a=await suppliers[_0x3c282b(0x292)]({});if(_0x2e0730[0x0]['language']=='English\x20(US)'){var _0x279232=users[_0x3c282b(0x1d4)];console[_0x3c282b(0x24d)](_0x279232);}else{if(_0x2e0730[0x0][_0x3c282b(0x1f7)]=='Hindi')var _0x279232=users[_0x3c282b(0x1ed)];else{if(_0x2e0730[0x0]['language']==_0x3c282b(0x1aa))var _0x279232=users[_0x3c282b(0x1aa)];else{if(_0x2e0730[0x0][_0x3c282b(0x1f7)]==_0x3c282b(0x1ca))var _0x279232=users[_0x3c282b(0x1ca)];else{if(_0x2e0730[0x0][_0x3c282b(0x1f7)]==_0x3c282b(0x247))var _0x279232=users[_0x3c282b(0x247)];else{if(_0x2e0730[0x0][_0x3c282b(0x1f7)]==_0x3c282b(0x1cf))var _0x279232=users[_0x3c282b(0x20f)];else{if(_0x2e0730[0x0][_0x3c282b(0x1f7)]=='Chinese')var _0x279232=users[_0x3c282b(0x230)];else{if(_0x2e0730[0x0][_0x3c282b(0x1f7)]==_0x3c282b(0x1f2))var _0x279232=users[_0x3c282b(0x1f5)];}}}}}}}_0x112c3f['render'](_0x3c282b(0x1e8),{'success':_0x3c8ad5[_0x3c282b(0x245)](_0x3c282b(0x251)),'errors':_0x3c8ad5[_0x3c282b(0x245)]('errors'),'role':_0x1e17e3,'profile':_0x53f070,'customer':_0x4c9d3d,'warehouse':_0xc221c2,'product':_0x184bad,'user':_0x467e47,'master_shop':_0x2e0730,'unit':_0x496c59,'language':_0x279232,'suppliers':_0x4f742a});}catch(_0x24d906){console[_0x3c282b(0x24d)](_0x24d906);}}),router[a0_0x127ba(0x240)](a0_0x127ba(0x1a1),auth,async(_0x38ff64,_0x44d1f4)=>{var _0x2ed42d=a0_0x127ba;try{const _0x5f9a6a=_0x38ff64['params']['id'],{invoice:_0x421314,warehouse_name:_0x1fdef9,room:_0x1a2498}=_0x38ff64[_0x2ed42d(0x1ee)],_0x1db7b0=await sales['findOne']({'invoice':_0x421314}),_0x3f6c47=_0x1db7b0[_0x2ed42d(0x28d)][_0x2ed42d(0x2a7)](async _0x374855=>{var _0x323f7a=_0x2ed42d,_0x2a45b6=await warehouse['findOne']({'name':_0x1fdef9,'room':_0x374855['room_name'],'warehouse_category':_0x323f7a(0x278)});const _0x1051fb=_0x2a45b6['product_details']['map'](_0x40d304=>{var _0x16a13a=_0x323f7a;_0x40d304[_0x16a13a(0x1a5)]==_0x374855['product_name']&&_0x40d304[_0x16a13a(0x26d)]==_0x374855['floorlevel']&&_0x40d304['type']==_0x374855[_0x16a13a(0x1f0)]&&_0x40d304[_0x16a13a(0x2a6)]==_0x374855[_0x16a13a(0x2a6)]&&_0x40d304[_0x16a13a(0x1a0)]==_0x374855[_0x16a13a(0x1a0)]&&_0x40d304[_0x16a13a(0x28b)]==_0x374855[_0x16a13a(0x28b)]&&_0x40d304[_0x16a13a(0x205)]==_0x374855[_0x16a13a(0x205)]&&_0x40d304[_0x16a13a(0x291)]==_0x374855[_0x16a13a(0x291)]&&_0x40d304[_0x16a13a(0x20d)]==_0x374855[_0x16a13a(0x20d)]&&_0x40d304[_0x16a13a(0x1f1)]==_0x374855[_0x16a13a(0x1f1)]&&(_0x40d304[_0x16a13a(0x21a)]=Math[_0x16a13a(0x249)](0x0,Math['abs'](_0x40d304[_0x16a13a(0x21a)])-Math[_0x16a13a(0x1e3)](_0x374855[_0x16a13a(0x266)])));});return _0x2a45b6;});Promise[_0x2ed42d(0x23f)](_0x3f6c47)['then'](async _0x17d50e=>{var _0x5cc68a=_0x2ed42d;try{for(const _0x3fe075 of _0x17d50e){await _0x3fe075[_0x5cc68a(0x256)]();}_0x1db7b0[_0x5cc68a(0x2a1)]=_0x5cc68a(0x213);const _0x5f3db1=await _0x1db7b0[_0x5cc68a(0x256)](),_0x48bc8f=await master_shop[_0x5cc68a(0x292)](),_0x16e259=await email_settings[_0x5cc68a(0x233)](),_0x4fa7f7=await supervisor_settings[_0x5cc68a(0x292)]();var _0x12caef=_0x1db7b0[_0x5cc68a(0x28d)],_0x1d0ab1='',_0x1642fc;for(_0x1642fc in _0x12caef){_0x1d0ab1+='<tr>'+_0x5cc68a(0x25e)+_0x12caef[_0x1642fc]['product_name']+_0x5cc68a(0x22d)+_0x5cc68a(0x25e)+_0x12caef[_0x1642fc][_0x5cc68a(0x1a2)]+_0x5cc68a(0x22d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12caef[_0x1642fc][_0x5cc68a(0x266)]+_0x5cc68a(0x22d)+_0x5cc68a(0x25e)+_0x12caef[_0x1642fc][_0x5cc68a(0x1c7)]+_0x5cc68a(0x22d)+_0x5cc68a(0x25e)+_0x12caef[_0x1642fc][_0x5cc68a(0x221)]+_0x5cc68a(0x22d)+_0x5cc68a(0x25e)+_0x1db7b0[_0x5cc68a(0x1de)]+_0x5cc68a(0x22d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12caef[_0x1642fc]['room_name']+_0x5cc68a(0x22d)+_0x5cc68a(0x25e)+_0x12caef[_0x1642fc][_0x5cc68a(0x205)]+_0x12caef[_0x1642fc][_0x5cc68a(0x28b)]+_0x12caef[_0x1642fc][_0x5cc68a(0x1a0)]+_0x12caef[_0x1642fc][_0x5cc68a(0x2a6)]+_0x12caef[_0x1642fc][_0x5cc68a(0x1f0)][0x0]+_0x12caef[_0x1642fc][_0x5cc68a(0x26d)]+_0x5cc68a(0x22d),_0x5cc68a(0x20a);}let _0x129dab=nodemailer[_0x5cc68a(0x24e)]({'host':_0x16e259[_0x5cc68a(0x1bd)],'port':Number(_0x16e259[_0x5cc68a(0x264)]),'secure':![],'auth':{'user':_0x16e259[_0x5cc68a(0x21f)],'pass':_0x16e259['password']}}),_0x161f8e={'from':_0x16e259['email'],'to':_0x4fa7f7[0x0][_0x5cc68a(0x201)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x5cc68a(0x265),'path':__dirname+'/../public'+_0x5cc68a(0x269)+_0x48bc8f[0x0][_0x5cc68a(0x20c)],'cid':_0x5cc68a(0x2a5)}],'html':'<!DOCTYPE\x20html>'+_0x5cc68a(0x25f)+_0x5cc68a(0x25d)+_0x5cc68a(0x26f)+_0x5cc68a(0x1a4)+_0x5cc68a(0x26f)+_0x5cc68a(0x1d2)+_0x5cc68a(0x1e6)+_0x5cc68a(0x26f)+_0x5cc68a(0x1c3)+_0x48bc8f[0x0][_0x5cc68a(0x23a)]+_0x5cc68a(0x284)+'</div>'+_0x5cc68a(0x1e6)+_0x5cc68a(0x23e)+_0x5cc68a(0x26f)+_0x5cc68a(0x2a2)+_0x5cc68a(0x24c)+_0x1db7b0[_0x5cc68a(0x1f1)]+'\x20'+_0x5cc68a(0x299)+'\x20Order\x20Date\x20:\x20'+_0x1db7b0[_0x5cc68a(0x1b2)]+'\x20'+_0x5cc68a(0x22c)+_0x5cc68a(0x26e)+_0x5cc68a(0x1e6)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5cc68a(0x29d)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5cc68a(0x1cb)+_0x5cc68a(0x1f3)+_0x5cc68a(0x29f)+_0x5cc68a(0x277)+_0x5cc68a(0x28c)+_0x5cc68a(0x211)+_0x5cc68a(0x1b3)+_0x5cc68a(0x20a)+_0x5cc68a(0x1d3)+_0x5cc68a(0x1db)+'\x20'+_0x1d0ab1+'\x20'+'</tbody>'+_0x5cc68a(0x274)+_0x5cc68a(0x26f)+_0x5cc68a(0x297)+_0x5cc68a(0x2a3)+_0x48bc8f[0x0][_0x5cc68a(0x23a)]+_0x5cc68a(0x26e)+_0x5cc68a(0x1e6)+_0x5cc68a(0x1e6)+'</body></html>'};_0x129dab[_0x5cc68a(0x1be)](_0x161f8e,function(_0x1890c4,_0x31767d){var _0x2a1d86=_0x5cc68a;_0x1890c4?(console[_0x2a1d86(0x24d)](_0x1890c4),console[_0x2a1d86(0x24d)](_0x2a1d86(0x254))):console['log'](_0x2a1d86(0x232));}),_0x38ff64[_0x5cc68a(0x245)]('success',_0x5cc68a(0x1b9)),_0x44d1f4[_0x5cc68a(0x1fb)](_0x5cc68a(0x250)+_0x5f9a6a);}catch(_0x57f25f){console['error'](_0x57f25f),_0x44d1f4[_0x5cc68a(0x1a9)](0x1f4)[_0x5cc68a(0x1bb)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x2ed42d(0x1c0)](_0x551d84=>{var _0x220272=_0x2ed42d;console[_0x220272(0x258)](_0x551d84),_0x44d1f4[_0x220272(0x1a9)](0x1f4)[_0x220272(0x1bb)]({'error':_0x220272(0x1a7)});});}catch(_0x3c8822){console[_0x2ed42d(0x24d)](_0x3c8822);}}),router['get']('/view/:id',auth,async(_0x3742ef,_0x12d8e0)=>{var _0xcffcec=a0_0x127ba;try{const {username:_0x496d8d,email:_0x1b9c7e,role:_0x390127}=_0x3742ef[_0xcffcec(0x1c8)],_0x59b1d0=_0x3742ef['user'],_0x446189=await profile['findOne']({'email':_0x59b1d0[_0xcffcec(0x21f)]}),_0x3d7113=await master_shop[_0xcffcec(0x292)](),_0x1924d0=_0x3742ef[_0xcffcec(0x219)]['id'],_0x36e83b=await sales[_0xcffcec(0x234)](_0x1924d0);var _0x1d263b=['Ambient','Enclosed'];const _0x3e5133=await warehouse[_0xcffcec(0x1fc)]([{'$match':{'name':_0x36e83b[_0xcffcec(0x1de)],'warehouse_category':_0xcffcec(0x278)}},{'$unwind':'$product_details'},{'$group':{'_id':_0xcffcec(0x25c),'name':{'$first':_0xcffcec(0x1c4)},'product_stock':{'$first':_0xcffcec(0x262)},'bay':{'$first':_0xcffcec(0x1e2)},'bin':{'$first':_0xcffcec(0x296)},'type':{'$first':_0xcffcec(0x242)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xcffcec(0x1d6)},'secondary_code':{'$first':_0xcffcec(0x1f9)},'product_code':{'$first':_0xcffcec(0x1fd)},'storage':{'$first':_0xcffcec(0x270)},'rack':{'$first':_0xcffcec(0x1eb)}}}]),_0xd876a9=await customer[_0xcffcec(0x292)]({});let _0x538064;if(_0x59b1d0[_0xcffcec(0x24a)]=='staff'){const _0x19b8bf=await staff[_0xcffcec(0x233)]({'email':_0x59b1d0[_0xcffcec(0x21f)]});_0x538064=await warehouse[_0xcffcec(0x1fc)]([{'$match':{'status':_0xcffcec(0x228),'name':_0x19b8bf[_0xcffcec(0x283)],'warehouse_category':_0xcffcec(0x278)}},{'$group':{'_id':'$name','name':{'$first':_0xcffcec(0x281)}}}]);}else _0x538064=await warehouse['aggregate']([{'$match':{'status':_0xcffcec(0x228),'warehouse_category':_0xcffcec(0x278)}},{'$group':{'_id':'$name','name':{'$first':_0xcffcec(0x281)}}}]);const _0x54c153=await product[_0xcffcec(0x292)]({});if(_0x3d7113[0x0][_0xcffcec(0x1f7)]==_0xcffcec(0x1ff)){var _0x180942=users['English'];console[_0xcffcec(0x24d)](_0x180942);}else{if(_0x3d7113[0x0][_0xcffcec(0x1f7)]==_0xcffcec(0x1ed))var _0x180942=users[_0xcffcec(0x1ed)];else{if(_0x3d7113[0x0][_0xcffcec(0x1f7)]=='German')var _0x180942=users[_0xcffcec(0x1aa)];else{if(_0x3d7113[0x0][_0xcffcec(0x1f7)]==_0xcffcec(0x1ca))var _0x180942=users['Spanish'];else{if(_0x3d7113[0x0][_0xcffcec(0x1f7)]==_0xcffcec(0x247))var _0x180942=users['French'];else{if(_0x3d7113[0x0][_0xcffcec(0x1f7)]==_0xcffcec(0x1cf))var _0x180942=users[_0xcffcec(0x20f)];else{if(_0x3d7113[0x0][_0xcffcec(0x1f7)]==_0xcffcec(0x230))var _0x180942=users[_0xcffcec(0x230)];else{if(_0x3d7113[0x0]['language']=='Arabic\x20(ae)')var _0x180942=users[_0xcffcec(0x1f5)];}}}}}}}_0x12d8e0['render'](_0xcffcec(0x290),{'success':_0x3742ef[_0xcffcec(0x245)]('success'),'errors':_0x3742ef['flash'](_0xcffcec(0x1d0)),'role':_0x59b1d0,'profile':_0x446189,'customer':_0xd876a9,'warehouse':_0x538064,'product':_0x3e5133,'user':_0x36e83b,'master_shop':_0x3d7113,'unit':_0x54c153,'language':_0x180942});}catch(_0x30ba1f){console['log'](_0x30ba1f);}}),router[a0_0x127ba(0x240)]('/view/:id',auth,async(_0x4929df,_0x5e7fc7)=>{var _0x4051ce=a0_0x127ba;try{const _0xe87d39=_0x4929df[_0x4051ce(0x219)]['id'],_0x267a67=await sales[_0x4051ce(0x233)]({'_id':_0x4929df[_0x4051ce(0x219)]['id']}),_0x2ebe76=await warehouse[_0x4051ce(0x233)]({'name':_0x267a67['warehouse_name'],'room':_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x25b)]}),{invoice:_0x51c2d2,date:_0x28d011,warehouse_name:_0x4e4271,product_name:_0x316e15,stock:_0xa41e86,quantity:_0xa8c30c,note:_0x196ca9,room:_0x1a3263,customer:_0x3a7a9f,SCRN:_0x3438d0}=_0x4929df[_0x4051ce(0x1ee)];if(typeof _0x316e15==_0x4051ce(0x216))var _0xef9abc=[_0x4929df['body'][_0x4051ce(0x1a5)]],_0x579cb7=[_0x4929df['body'][_0x4051ce(0x279)]],_0x59b445=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x22a)]],_0x4d01d3=[_0x4929df[_0x4051ce(0x1ee)]['primary_code']],_0x2b3aa2=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x1a3)]],_0x42c2fa=[_0x4929df[_0x4051ce(0x1ee)]['prod_code']],_0x47c108=[_0x4929df['body']['level']],_0x5c3c0c=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x260)]],_0xd9a4b5=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x221)]],_0x192f7a=[_0x4929df['body']['batch_code']],_0x24ad9b=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x291)]],_0x1d8370=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x28f)]],_0x5a839b=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x280)]],_0x1e1fc0=[_0x4929df['body'][_0x4051ce(0x1d8)]],_0x52ac99=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x1d1)]],_0x307523=[_0x4929df[_0x4051ce(0x1ee)]['delivery_code']],_0x19edc5=[_0x4929df['body'][_0x4051ce(0x1dc)]],_0x57d1e6=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x266)]],_0x4510e6=[_0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x273)]];else var _0xef9abc=[..._0x4929df['body'][_0x4051ce(0x1a5)]],_0x579cb7=[..._0x4929df[_0x4051ce(0x1ee)]['stock']],_0x59b445=[..._0x4929df[_0x4051ce(0x1ee)]['carton']],_0x4d01d3=[..._0x4929df['body']['primary_code']],_0x2b3aa2=[..._0x4929df['body']['secondary_code']],_0x42c2fa=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x24f)]],_0x47c108=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x20e)]],_0x5c3c0c=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x260)]],_0xd9a4b5=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x221)]],_0x192f7a=[..._0x4929df['body'][_0x4051ce(0x20d)]],_0x24ad9b=[..._0x4929df[_0x4051ce(0x1ee)]['expiry_date']],_0x1d8370=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x28f)]],_0x5a839b=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x280)]],_0x1e1fc0=[..._0x4929df[_0x4051ce(0x1ee)]['requested_qty']],_0x52ac99=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x1d1)]],_0x307523=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x1df)]],_0x19edc5=[..._0x4929df[_0x4051ce(0x1ee)]['prod_cat']],_0x57d1e6=[..._0x4929df[_0x4051ce(0x1ee)][_0x4051ce(0x266)]],_0x4510e6=[..._0x4929df['body'][_0x4051ce(0x273)]];const _0x19a37f=_0xef9abc[_0x4051ce(0x2a7)](_0x1abbdb=>{return _0x1abbdb={'product_name':_0x1abbdb};});_0x579cb7[_0x4051ce(0x236)]((_0x1c938e,_0x2b23a6)=>{var _0x6a3897=_0x4051ce;_0x19a37f[_0x2b23a6][_0x6a3897(0x279)]=Math[_0x6a3897(0x1e3)](_0x1c938e);}),_0x59b445[_0x4051ce(0x236)]((_0x53679c,_0xc7186d)=>{_0x19a37f[_0xc7186d]['quantity']=_0x53679c;}),_0x4d01d3[_0x4051ce(0x236)]((_0x39e33c,_0x55077d)=>{var _0x5ab1bb=_0x4051ce;_0x19a37f[_0x55077d][_0x5ab1bb(0x207)]=_0x39e33c;}),_0x2b3aa2['forEach']((_0xdbee7c,_0x38a3d2)=>{var _0x10278e=_0x4051ce;_0x19a37f[_0x38a3d2][_0x10278e(0x1a3)]=_0xdbee7c;}),_0x42c2fa[_0x4051ce(0x236)]((_0x554425,_0x420bfe)=>{var _0x36210a=_0x4051ce;_0x19a37f[_0x420bfe][_0x36210a(0x1a2)]=_0x554425;}),_0x47c108[_0x4051ce(0x236)]((_0x45bcb8,_0x522c5b)=>{var _0x11a74a=_0x4051ce;_0x4510e6[_0x11a74a(0x236)]((_0x45c046,_0x8793fe)=>{var _0x5a1722=_0x11a74a;if(_0x45c046=='Receiving\x20Area'&&_0x522c5b==_0x8793fe){var _0x2ced3b=_0x45bcb8[_0x5a1722(0x26c)](0x3);_0x19a37f[_0x522c5b][_0x5a1722(0x205)]=_0x45bcb8[0x0],_0x19a37f[_0x522c5b]['rack']=_0x45bcb8[0x1],_0x19a37f[_0x522c5b][_0x5a1722(0x1a0)]=0x0,_0x19a37f[_0x522c5b][_0x5a1722(0x2a6)]=0x0,_0x19a37f[_0x522c5b]['type']='Floor',_0x19a37f[_0x522c5b]['floorlevel']=_0x2ced3b;}else{if(_0x45c046==_0x5a1722(0x214)&&_0x522c5b==_0x8793fe){var _0x2ced3b=_0x45bcb8[_0x5a1722(0x26c)](0x3);_0x19a37f[_0x522c5b]['storage']=_0x45bcb8[0x0],_0x19a37f[_0x522c5b][_0x5a1722(0x28b)]=_0x45bcb8[0x1],_0x19a37f[_0x522c5b]['bay']=0x0,_0x19a37f[_0x522c5b]['bin']=0x0,_0x19a37f[_0x522c5b][_0x5a1722(0x1f0)]=_0x5a1722(0x22b),_0x19a37f[_0x522c5b][_0x5a1722(0x26d)]=_0x45bcb8[0x5];}else{if(_0x522c5b==_0x8793fe){var _0x385f21;if(_0x45bcb8[0x4]=='L')_0x385f21='Level';else _0x45bcb8[0x4]=='F'&&(_0x385f21='Floor');_0x19a37f[_0x522c5b][_0x5a1722(0x205)]=_0x45bcb8[0x0],_0x19a37f[_0x522c5b][_0x5a1722(0x28b)]=_0x45bcb8[0x1],_0x19a37f[_0x522c5b][_0x5a1722(0x1a0)]=_0x45bcb8[0x2],_0x19a37f[_0x522c5b][_0x5a1722(0x2a6)]=_0x45bcb8[0x3],_0x19a37f[_0x522c5b][_0x5a1722(0x1f0)]=_0x385f21,_0x19a37f[_0x522c5b][_0x5a1722(0x26d)]=_0x45bcb8[0x5];}}}});}),_0x5c3c0c[_0x4051ce(0x236)]((_0x3894fd,_0x428c6c)=>{_0x19a37f[_0x428c6c]['unit']=_0x3894fd;}),_0xd9a4b5[_0x4051ce(0x236)]((_0x2c445e,_0x1b9be5)=>{var _0x1c2759=_0x4051ce;_0x19a37f[_0x1b9be5][_0x1c2759(0x221)]=_0x2c445e;}),_0x192f7a[_0x4051ce(0x236)]((_0x56c62a,_0x19af1d)=>{var _0x806671=_0x4051ce;_0x19a37f[_0x19af1d][_0x806671(0x20d)]=_0x56c62a;}),_0x24ad9b[_0x4051ce(0x236)]((_0x4cdce5,_0x516599)=>{var _0x35f58b=_0x4051ce;_0x19a37f[_0x516599][_0x35f58b(0x291)]=_0x4cdce5;}),_0x1d8370['forEach']((_0x4dae93,_0x1cbc9a)=>{_0x19a37f[_0x1cbc9a]['maxperunit']=_0x4dae93;}),_0x5a839b[_0x4051ce(0x236)]((_0x5a9814,_0x388056)=>{var _0xbb8c36=_0x4051ce;_0x19a37f[_0x388056][_0xbb8c36(0x280)]=_0x5a9814;}),_0x1e1fc0[_0x4051ce(0x236)]((_0x100c61,_0x26c3a6)=>{var _0x48b8b2=_0x4051ce;_0x19a37f[_0x26c3a6][_0x48b8b2(0x1d8)]=Math[_0x48b8b2(0x1e3)](_0x100c61);}),_0x52ac99[_0x4051ce(0x236)]((_0x3b1d6c,_0x553108)=>{var _0x3065f3=_0x4051ce;_0x19a37f[_0x553108][_0x3065f3(0x1d1)]=_0x3b1d6c;}),_0x307523[_0x4051ce(0x236)]((_0x32c97c,_0x956e58)=>{var _0x185c1c=_0x4051ce;_0x19a37f[_0x956e58][_0x185c1c(0x1df)]=_0x32c97c;}),_0x19edc5[_0x4051ce(0x236)]((_0x283258,_0x67769d)=>{var _0x1c3452=_0x4051ce;_0x19a37f[_0x67769d][_0x1c3452(0x1dc)]=_0x283258;}),_0x57d1e6[_0x4051ce(0x236)]((_0x5844df,_0x897113)=>{var _0x4ea8e4=_0x4051ce;_0x19a37f[_0x897113][_0x4ea8e4(0x1ba)]=_0x5844df;}),_0x4510e6[_0x4051ce(0x236)]((_0x2c0644,_0xfc814)=>{var _0x272c24=_0x4051ce;_0x19a37f[_0xfc814][_0x272c24(0x22e)]=_0x2c0644;});var _0x1d363a=0x0;_0x19a37f['forEach'](_0x290b86=>{var _0x41905b=_0x4051ce;console[_0x41905b(0x24d)](_0x41905b(0x208),_0x290b86),(parseInt(_0x290b86[_0x41905b(0x279)])<parseInt(_0x290b86['quantity'])||parseInt(_0x290b86[_0x41905b(0x266)])==0x0)&&_0x1d363a++;});if(_0x1d363a!=0x0)return _0x4929df[_0x4051ce(0x245)](_0x4051ce(0x1d0),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x5e7fc7['redirect']('back');const _0x2bfcdc=_0x19a37f['filter'](_0xbcbbde=>_0xbcbbde['quantity']!=='0'&&_0xbcbbde[_0x4051ce(0x266)]!=='');_0x267a67[_0x4051ce(0x1f1)]=_0x51c2d2,_0x267a67[_0x4051ce(0x21d)]=_0x3a7a9f,_0x267a67['date']=_0x28d011,_0x267a67[_0x4051ce(0x1de)]=_0x4e4271,_0x267a67[_0x4051ce(0x28d)]=_0x2bfcdc,_0x267a67[_0x4051ce(0x1d9)]=_0x196ca9,_0x267a67[_0x4051ce(0x1e1)]=_0x3438d0,_0x267a67['finalize']=_0x4051ce(0x27e),_0x267a67[_0x4051ce(0x1c6)]=_0x4051ce(0x27e);const _0x45d9f5=await _0x267a67[_0x4051ce(0x256)]();_0x4929df[_0x4051ce(0x245)]('success',_0x4051ce(0x1b9)),_0x5e7fc7[_0x4051ce(0x1fb)](_0x4051ce(0x1fe));}catch(_0x589f21){console['log'](_0x589f21);}}),router[a0_0x127ba(0x240)]('/give_payment/:id',auth,async(_0x4fa7de,_0x4d1297)=>{var _0x71b555=a0_0x127ba;try{const _0x47124d=_0x4fa7de[_0x71b555(0x219)]['id'],{invoice:_0x4f9942,customer:_0x4894cf,receivable_amount:_0x3bd12a,received_amount:_0x4c1ea4}=_0x4fa7de['body'],_0x736fce=await sales['findById'](_0x47124d);console['log'](_0x736fce);var _0x453f8a=_0x3bd12a-_0x4c1ea4;console[_0x71b555(0x24d)](_0x4c1ea4),_0x736fce[_0x71b555(0x1c5)]=parseFloat(_0x4c1ea4)+parseFloat(_0x736fce[_0x71b555(0x1c5)]),_0x736fce[_0x71b555(0x1ea)]=_0x453f8a,console[_0x71b555(0x24d)](_0x736fce);const _0x537839=await _0x736fce[_0x71b555(0x256)](),_0x2bc3bd=await c_payment_data[_0x71b555(0x233)]({'invoice':_0x4f9942});_0x2bc3bd[_0x71b555(0x19f)]=_0x453f8a,await _0x2bc3bd[_0x71b555(0x256)]();let _0x4cb01a=new Date(),_0x5950f7=('0'+_0x4cb01a['getDate']())[_0x71b555(0x26c)](-0x2),_0x26024c=('0'+(_0x4cb01a[_0x71b555(0x1cc)]()+0x1))[_0x71b555(0x26c)](-0x2),_0x10e07a=_0x4cb01a[_0x71b555(0x1cd)](),_0x19877d=_0x10e07a+'-'+_0x26024c+'-'+_0x5950f7;const _0x2750f7=new customer_payment({'invoice':_0x4f9942,'date':_0x10e07a+'-'+_0x26024c+'-'+_0x5950f7,'customer':_0x4894cf,'reason':_0x71b555(0x294),'amount':_0x4c1ea4}),_0x392c1b=await _0x2750f7['save']();_0x4fa7de[_0x71b555(0x245)](_0x71b555(0x251),_0x71b555(0x1e9)),_0x4d1297[_0x71b555(0x1fb)](_0x71b555(0x1fe));}catch(_0x2c913c){console[_0x71b555(0x24d)](_0x2c913c);}}),router[a0_0x127ba(0x212)]('/invoice/:id',auth,async(_0x5b1e8c,_0x9999b2)=>{var _0x2b3f87=a0_0x127ba;try{const {username:_0x4c6a32,email:_0x301c53,role:_0x1beeae}=_0x5b1e8c[_0x2b3f87(0x1c8)],_0x4c138e=_0x5b1e8c[_0x2b3f87(0x1c8)],_0xa9169c=await profile['findOne']({'email':_0x4c138e[_0x2b3f87(0x21f)]}),_0x1558e9=await master_shop['find']();console[_0x2b3f87(0x24d)]('master',_0x1558e9);const _0x11ee35=_0x5b1e8c['params']['id'],_0x2fa2c9=await sales[_0x2b3f87(0x234)](_0x11ee35);console[_0x2b3f87(0x24d)](_0x2fa2c9);const _0x2a8398=await customer[_0x2b3f87(0x233)]({'name':_0x2fa2c9[_0x2b3f87(0x21d)]});console['log'](_0x2a8398);if(_0x1558e9[0x0]['language']==_0x2b3f87(0x1ff)){var _0x4da3b9=users[_0x2b3f87(0x1d4)];console[_0x2b3f87(0x24d)](_0x4da3b9);}else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]==_0x2b3f87(0x1ed))var _0x4da3b9=users['Hindi'];else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]==_0x2b3f87(0x1aa))var _0x4da3b9=users[_0x2b3f87(0x1aa)];else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]==_0x2b3f87(0x1ca))var _0x4da3b9=users[_0x2b3f87(0x1ca)];else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]=='French')var _0x4da3b9=users[_0x2b3f87(0x247)];else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]==_0x2b3f87(0x1cf))var _0x4da3b9=users[_0x2b3f87(0x20f)];else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]==_0x2b3f87(0x230))var _0x4da3b9=users[_0x2b3f87(0x230)];else{if(_0x1558e9[0x0][_0x2b3f87(0x1f7)]==_0x2b3f87(0x1f2))var _0x4da3b9=users['Arabic'];}}}}}}}_0x9999b2[_0x2b3f87(0x1ad)]('sales_invoice',{'success':_0x5b1e8c[_0x2b3f87(0x245)](_0x2b3f87(0x251)),'errors':_0x5b1e8c[_0x2b3f87(0x245)]('errors'),'role':_0x4c138e,'profile':_0xa9169c,'master_shop':_0x1558e9,'customers':_0x2a8398,'sales':_0x2fa2c9,'language':_0x4da3b9});}catch(_0x116dec){console[_0x2b3f87(0x24d)](_0x116dec);}}),router[a0_0x127ba(0x212)](a0_0x127ba(0x210),auth,async(_0x3f05f8,_0x18853c)=>{var _0x1a2762=a0_0x127ba;try{const {username:_0x543dff,email:_0x2e4463,role:_0x3e284d}=_0x3f05f8['user'],_0xdaf8f5=_0x3f05f8['user'],_0xbf0e53=await profile['findOne']({'email':_0xdaf8f5['email']}),_0x2efa26=await master_shop['find']();console[_0x1a2762(0x24d)](_0x1a2762(0x1af),_0x2efa26);const _0x543d08=_0x3f05f8[_0x1a2762(0x219)]['id'];console[_0x1a2762(0x24d)](_0x543d08);const _0x5b010d=await sales[_0x1a2762(0x234)](_0x543d08);console[_0x1a2762(0x24d)]('user_id',_0x5b010d);const _0x38e929=await warehouse[_0x1a2762(0x1fc)]([{'$match':{'name':_0x1a2762(0x1b7),'room':_0x1a2762(0x227)}},{'$unwind':_0x1a2762(0x1b4)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1a2762(0x1c4)},'product_stock':{'$first':_0x1a2762(0x262)},'level':{'$first':_0x1a2762(0x259)},'isle':{'$first':_0x1a2762(0x295)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x1a2762(0x1d6)},'secondary_code':{'$first':_0x1a2762(0x1f9)},'product_code':{'$first':_0x1a2762(0x1fd)}}}]);console['log'](_0x1a2762(0x27b),_0x38e929);const _0x1b3c46=await product[_0x1a2762(0x292)]({});warehouse_data=await warehouse[_0x1a2762(0x1fc)]([{'$match':{'status':_0x1a2762(0x228),'name':_0x1a2762(0x1b7),'warehouse_category':_0x1a2762(0x278)}},{'$group':{'_id':'$name','name':{'$first':_0x1a2762(0x281)}}},{'$sort':{'name':0x1}}]);var _0x3ee54c=[_0x1a2762(0x227)];if(_0x2efa26[0x0][_0x1a2762(0x1f7)]==_0x1a2762(0x1ff)){var _0x25b6c2=users[_0x1a2762(0x1d4)];console[_0x1a2762(0x24d)](_0x25b6c2);}else{if(_0x2efa26[0x0][_0x1a2762(0x1f7)]==_0x1a2762(0x1ed))var _0x25b6c2=users['Hindi'];else{if(_0x2efa26[0x0][_0x1a2762(0x1f7)]==_0x1a2762(0x1aa))var _0x25b6c2=users[_0x1a2762(0x1aa)];else{if(_0x2efa26[0x0][_0x1a2762(0x1f7)]==_0x1a2762(0x1ca))var _0x25b6c2=users[_0x1a2762(0x1ca)];else{if(_0x2efa26[0x0][_0x1a2762(0x1f7)]=='French')var _0x25b6c2=users[_0x1a2762(0x247)];else{if(_0x2efa26[0x0]['language']==_0x1a2762(0x1cf))var _0x25b6c2=users[_0x1a2762(0x20f)];else{if(_0x2efa26[0x0][_0x1a2762(0x1f7)]=='Chinese')var _0x25b6c2=users['Chinese'];else{if(_0x2efa26[0x0][_0x1a2762(0x1f7)]=='Arabic\x20(ae)')var _0x25b6c2=users[_0x1a2762(0x1f5)];}}}}}}}_0x18853c['render'](_0x1a2762(0x1bf),{'success':_0x3f05f8[_0x1a2762(0x245)](_0x1a2762(0x251)),'errors':_0x3f05f8[_0x1a2762(0x245)](_0x1a2762(0x1d0)),'role':_0xdaf8f5,'profile':_0xbf0e53,'user':_0x5b010d,'stock':_0x38e929,'master_shop':_0x2efa26,'unit':_0x1b3c46,'language':_0x25b6c2,'warehouses':warehouse_data,'rooms':_0x3ee54c});}catch(_0xea6ad0){console[_0x1a2762(0x24d)](_0xea6ad0),_0x18853c[_0x1a2762(0x1a9)](0xc8)['json']({'message':_0xea6ad0['message']});}}),router[a0_0x127ba(0x240)](a0_0x127ba(0x210),auth,async(_0x3cedee,_0x470314)=>{var _0x497e46=a0_0x127ba;try{const {invoice:_0x125820,date:_0x1126fa,warehouse_name:_0x38efc9,product_name:_0x56aab4,primary_code:_0x4c4de8,secondary_code:_0x5cf292,product_code:_0xb1af36,sales_quantity:_0x35d666,stocks:_0x4bd5b0,return_qty:_0x35818d,Room_name:_0x5edbfe,to_warehouse_name:_0x55b83c,to_Roomname:_0x4b279b,to_Room_name:_0x17e87a,note:_0x423494,level:_0x19bd81,isle:_0x3c3c40,pallet:_0x57b738}=_0x3cedee[_0x497e46(0x1ee)];if(typeof _0x56aab4==_0x497e46(0x216))var _0x3f6aa8=[_0x3cedee['body'][_0x497e46(0x1a5)]],_0x32a5f5=[_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x207)]],_0x47d8c8=[_0x3cedee[_0x497e46(0x1ee)]['secondary_code']],_0x2d1f31=[_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x1a2)]],_0x4a2171=[_0x3cedee[_0x497e46(0x1ee)]['sales_quantity']],_0x3887c8=[_0x3cedee['body'][_0x497e46(0x255)]],_0x25aacf=[_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x282)]],_0x53493a=[_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x1a0)]],_0x152732=[_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x2a6)]],_0x5cd024=[_0x3cedee['body'][_0x497e46(0x289)]],_0x1298c2=[_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x26d)]];else var _0x3f6aa8=[..._0x3cedee[_0x497e46(0x1ee)]['product_name']],_0x32a5f5=[..._0x3cedee['body']['primary_code']],_0x47d8c8=[..._0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x1a3)]],_0x2d1f31=[..._0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x1a2)]],_0x4a2171=[..._0x3cedee['body']['sales_quantity']],_0x3887c8=[..._0x3cedee['body'][_0x497e46(0x255)]],_0x25aacf=[..._0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x282)]],_0x53493a=[..._0x3cedee['body'][_0x497e46(0x1a0)]],_0x152732=[..._0x3cedee[_0x497e46(0x1ee)]['bin']],_0x5cd024=[..._0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x289)]],_0x1298c2=[..._0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x26d)]];const _0x3f4b88=_0x3f6aa8['map'](_0x2a4d4d=>{return _0x2a4d4d={'product_name':_0x2a4d4d};});_0x32a5f5[_0x497e46(0x236)]((_0x34f913,_0x2c7a57)=>{var _0x2b1025=_0x497e46;_0x3f4b88[_0x2c7a57][_0x2b1025(0x207)]=_0x34f913;}),_0x47d8c8[_0x497e46(0x236)]((_0x4a36fd,_0x248976)=>{var _0x387f00=_0x497e46;_0x3f4b88[_0x248976][_0x387f00(0x1a3)]=_0x4a36fd;}),_0x2d1f31['forEach']((_0x47f588,_0x46fac7)=>{var _0x2ec616=_0x497e46;_0x3f4b88[_0x46fac7][_0x2ec616(0x1a2)]=_0x47f588;}),_0x4a2171[_0x497e46(0x236)]((_0x4de0d7,_0x27a202)=>{var _0x4dcc30=_0x497e46;_0x3f4b88[_0x27a202][_0x4dcc30(0x23c)]=_0x4de0d7;}),_0x3887c8[_0x497e46(0x236)]((_0x50a838,_0x3387c9)=>{var _0xc5eec7=_0x497e46;_0x3f4b88[_0x3387c9][_0xc5eec7(0x279)]=_0x50a838;}),_0x25aacf[_0x497e46(0x236)]((_0x27924e,_0x2465d8)=>{var _0x4eed88=_0x497e46;_0x3f4b88[_0x2465d8][_0x4eed88(0x282)]=_0x27924e;}),_0x53493a[_0x497e46(0x236)]((_0x90df47,_0x125ca3)=>{var _0x435144=_0x497e46;_0x3f4b88[_0x125ca3][_0x435144(0x1a0)]=_0x90df47;}),_0x152732[_0x497e46(0x236)]((_0x3bd5ac,_0x2d891d)=>{var _0x2d0d65=_0x497e46;_0x3f4b88[_0x2d891d][_0x2d0d65(0x2a6)]=_0x3bd5ac;}),_0x5cd024['forEach']((_0x5bb894,_0x48ea9d)=>{var _0xa2f4ad=_0x497e46;_0x3f4b88[_0x48ea9d][_0xa2f4ad(0x1f0)]=_0x5bb894;}),_0x1298c2[_0x497e46(0x236)]((_0x4c8485,_0x2f909e)=>{var _0x47d0bb=_0x497e46;_0x3f4b88[_0x2f909e][_0x47d0bb(0x26d)]=_0x4c8485;});var _0x531007=0x0;_0x3f4b88['forEach'](_0x3c6108=>{var _0x277449=_0x497e46;console[_0x277449(0x24d)]('foreach\x20newproduct',_0x3c6108),(parseInt(_0x3c6108[_0x277449(0x23c)])<parseInt(_0x3c6108[_0x277449(0x282)])||parseInt(_0x3c6108[_0x277449(0x279)])<parseInt(_0x3c6108['return_qty'])&&parseInt(_0x3c6108[_0x277449(0x23c)])>parseInt(_0x3c6108[_0x277449(0x282)])||parseInt(_0x3c6108[_0x277449(0x282)])==0x0)&&_0x531007++;});if(_0x531007!=0x0)return _0x3cedee[_0x497e46(0x245)](_0x497e46(0x1d0),_0x497e46(0x26b)),_0x470314[_0x497e46(0x1fb)]('back');const _0x585e18=await sales[_0x497e46(0x233)]({'invoice':_0x125820});console['log'](_0x585e18),_0x585e18['return_data']=_0x497e46(0x213);const _0x4452f1=await _0x585e18['save'](),_0xd727c2=new sales_return({'invoice':_0x125820,'customer':_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x21d)],'date':_0x1126fa,'warehouse_name':_0x38efc9,'room':_0x5edbfe,'ToWarehouse':_0x55b83c,'ToRoom':_0x17e87a,'return_sale':_0x3f4b88,'note':_0x423494}),_0x433c55=await _0xd727c2[_0x497e46(0x256)]();console[_0x497e46(0x24d)](_0xd727c2);const _0x4c529e=await sales_return[_0x497e46(0x233)]({'invoice':_0x125820}),_0x4c0271=await warehouse[_0x497e46(0x233)]({'name':_0x55b83c,'room':_0x17e87a});_0x4c529e[_0x497e46(0x1bf)][_0x497e46(0x236)](_0x5f0e56=>{var _0x52f620=_0x497e46,_0x5b75ba=0x0;const _0x4a18d7=_0x4c0271[_0x52f620(0x226)][_0x52f620(0x2a7)](_0x5a0e25=>{var _0x4cd5e2=_0x52f620;_0x5a0e25[_0x4cd5e2(0x1a5)]==_0x5f0e56[_0x4cd5e2(0x1a5)]&&_0x5a0e25['floorlevel']==_0x5f0e56['floorlevel']&&_0x5a0e25[_0x4cd5e2(0x1f0)]==_0x5f0e56[_0x4cd5e2(0x1f0)]&&_0x5a0e25[_0x4cd5e2(0x2a6)]==_0x5f0e56[_0x4cd5e2(0x2a6)]&&_0x5a0e25[_0x4cd5e2(0x1a0)]==_0x5f0e56[_0x4cd5e2(0x1a0)]&&(_0x5a0e25['product_stock']=parseInt(_0x5a0e25[_0x4cd5e2(0x21a)])+parseInt(_0x5f0e56[_0x4cd5e2(0x282)]),_0x5b75ba++);});_0x5b75ba=='0'&&(_0x4c0271[_0x52f620(0x226)]=_0x4c0271[_0x52f620(0x226)][_0x52f620(0x293)]({'product_name':_0x5f0e56['product_name'],'product_stock':_0x5f0e56[_0x52f620(0x282)],'primary_code':_0x5f0e56[_0x52f620(0x207)],'secondary_code':_0x5f0e56['secondary_code'],'product_code':_0x5f0e56[_0x52f620(0x1a2)],'bay':_0x5f0e56[_0x52f620(0x1a0)],'bin':_0x5f0e56['bin'],'type':_0x5f0e56['type'],'floorlevel':_0x5f0e56[_0x52f620(0x26d)]})),console[_0x52f620(0x24d)](_0x52f620(0x1c2),_0x4c0271);}),await _0x4c0271[_0x497e46(0x256)](),console[_0x497e46(0x24d)](_0x3cedee[_0x497e46(0x1ee)]);const _0x4765b2=new c_payment_data({'invoice':_0x125820,'customer':_0x3cedee[_0x497e46(0x1ee)][_0x497e46(0x21d)],'reason':_0x497e46(0x1e5)});await _0x4765b2[_0x497e46(0x256)]();const _0x5cd185=await master_shop['find']();console[_0x497e46(0x24d)](_0x497e46(0x1ce),_0x5cd185[0x0][_0x497e46(0x20c)]);const _0x356465=await email_settings['findOne'](),_0x1af864=await customer[_0x497e46(0x233)]({'name':_0x3cedee['body'][_0x497e46(0x21d)]});console[_0x497e46(0x24d)]('customer_data',_0x1af864);_0x5cd185[0x0][_0x497e46(0x237)]==0x1?(right_currency=_0x5cd185[0x0][_0x497e46(0x261)],left_currency=''):(right_currency='',left_currency=_0x5cd185[0x0][_0x497e46(0x261)]);var _0x4fc754=_0x3f6aa8,_0x236ab8=_0x25aacf,_0x5086ae='',_0x3e582f;for(_0x3e582f in _0x4fc754){_0x5086ae+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fc754[_0x3e582f]+_0x497e46(0x22d)+_0x497e46(0x25e)+_0x236ab8[_0x3e582f]+'</td>'+_0x497e46(0x20a);}console['log'](_0x497e46(0x1b8),_0x5086ae);let _0x23b880=nodemailer[_0x497e46(0x24e)]({'service':_0x497e46(0x271),'auth':{'user':_0x356465[_0x497e46(0x21f)],'pass':_0x356465[_0x497e46(0x2a4)]}}),_0x1bf551={'from':_0x356465[_0x497e46(0x21f)],'to':_0x1af864['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x497e46(0x23b)+_0x497e46(0x269)+_0x5cd185[0x0]['image'],'cid':_0x497e46(0x2a5)}],'html':_0x497e46(0x215)+_0x497e46(0x25f)+_0x497e46(0x25d)+_0x497e46(0x26f)+_0x497e46(0x1a4)+'<div>'+_0x497e46(0x1d2)+'</div>'+_0x497e46(0x26f)+_0x497e46(0x1c3)+_0x5cd185[0x0][_0x497e46(0x23a)]+_0x497e46(0x284)+_0x497e46(0x1e6)+_0x497e46(0x1e6)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x497e46(0x2a2)+_0x497e46(0x24c)+_0x125820+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x1126fa+'\x20'+_0x497e46(0x22c)+'</h5>'+_0x497e46(0x1e6)+_0x497e46(0x252)+_0x497e46(0x29d)+'<tr>'+_0x497e46(0x1f4)+_0x497e46(0x246)+_0x497e46(0x235)+_0x497e46(0x231)+'</tr>'+_0x497e46(0x1d3)+_0x497e46(0x1db)+'\x20'+_0x5086ae+'\x20'+_0x497e46(0x244)+'</table>'+_0x497e46(0x26f)+_0x497e46(0x297)+_0x497e46(0x2a3)+_0x5cd185[0x0][_0x497e46(0x23a)]+_0x497e46(0x26e)+_0x497e46(0x1e6)+_0x497e46(0x1e6)+_0x497e46(0x1e4)};_0x23b880[_0x497e46(0x1be)](_0x1bf551,function(_0x435996,_0x1ac560){var _0x34edeb=_0x497e46;_0x435996?(console[_0x34edeb(0x24d)](_0x435996),console[_0x34edeb(0x24d)](_0x34edeb(0x254))):console[_0x34edeb(0x24d)](_0x34edeb(0x232));}),_0x3cedee[_0x497e46(0x245)](_0x497e46(0x251),_0x497e46(0x288)),_0x470314[_0x497e46(0x1fb)](_0x497e46(0x1fe));}catch(_0x4a3a0e){console[_0x497e46(0x24d)](_0x4a3a0e),_0x470314[_0x497e46(0x1a9)](0xc8)[_0x497e46(0x1bb)]({'message1':_0x4a3a0e['message']});}}),router[a0_0x127ba(0x212)]('/barcode/:id',auth,async(_0x31f3e2,_0x580286)=>{var _0x3cf231=a0_0x127ba;try{const {username:_0xc96cf0,email:_0x441ae9,role:_0x1aac80}=_0x31f3e2[_0x3cf231(0x1c8)],_0x677d09=_0x31f3e2[_0x3cf231(0x1c8)],_0x259c5d=await profile[_0x3cf231(0x233)]({'email':_0x677d09[_0x3cf231(0x21f)]}),_0x180451=await master_shop[_0x3cf231(0x292)]();console['log'](_0x3cf231(0x1ec),_0x180451);const _0x224c1d=_0x31f3e2[_0x3cf231(0x219)]['id'],_0x588136=await sales[_0x3cf231(0x234)](_0x224c1d);console[_0x3cf231(0x24d)]('barcode\x20user_id',_0x588136);if(_0x180451[0x0][_0x3cf231(0x1f7)]==_0x3cf231(0x1ff))var _0x277fe0=users[_0x3cf231(0x1d4)];else{if(_0x180451[0x0]['language']==_0x3cf231(0x1ed))var _0x277fe0=users[_0x3cf231(0x1ed)];else{if(_0x180451[0x0][_0x3cf231(0x1f7)]=='German')var _0x277fe0=users[_0x3cf231(0x1aa)];else{if(_0x180451[0x0][_0x3cf231(0x1f7)]==_0x3cf231(0x1ca))var _0x277fe0=users[_0x3cf231(0x1ca)];else{if(_0x180451[0x0][_0x3cf231(0x1f7)]==_0x3cf231(0x247))var _0x277fe0=users[_0x3cf231(0x247)];else{if(_0x180451[0x0][_0x3cf231(0x1f7)]=='Portuguese\x20(BR)')var _0x277fe0=users[_0x3cf231(0x20f)];else{if(_0x180451[0x0]['language']==_0x3cf231(0x230))var _0x277fe0=users[_0x3cf231(0x230)];else{if(_0x180451[0x0][_0x3cf231(0x1f7)]=='Arabic\x20(ae)')var _0x277fe0=users[_0x3cf231(0x1f5)];}}}}}}}_0x580286[_0x3cf231(0x1ad)](_0x3cf231(0x29e),{'success':_0x31f3e2[_0x3cf231(0x245)]('success'),'errors':_0x31f3e2[_0x3cf231(0x245)](_0x3cf231(0x1d0)),'role':_0x677d09,'profile':_0x259c5d,'alldata':_0x588136,'master_shop':_0x180451,'language':_0x277fe0});}catch(_0x2f29ff){console[_0x3cf231(0x24d)](_0x2f29ff);}}),router[a0_0x127ba(0x240)](a0_0x127ba(0x22f),async(_0x3d2790,_0x4f5f90)=>{var _0x594153=a0_0x127ba;const {product_code:_0x4b5dce,warehouse_name:_0x5bade9,rooms_data:_0x4894b7,Roomslist:_0x41a2d3}=_0x3d2790['body'],_0x4d1eec=_0x41a2d3[_0x594153(0x229)](','),_0x5e3ac7=[];async function _0x1495e6(_0x60c250){var _0x1028c8=_0x594153;const _0x21d9fe=await warehouse[_0x1028c8(0x1fc)]([{'$match':{'name':_0x5bade9,'room':_0x60c250}},{'$unwind':_0x1028c8(0x1b4)},{'$match':{'product_details.primary_code':_0x4b5dce}},{'$group':{'_id':_0x1028c8(0x25c),'name':{'$first':_0x1028c8(0x1c4)},'product_stock':{'$first':_0x1028c8(0x262)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1028c8(0x1f9)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1028c8(0x1e2)},'isle':{'$first':_0x1028c8(0x296)},'type':{'$first':_0x1028c8(0x242)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1028c8(0x21e)},'secondary_unit':{'$first':_0x1028c8(0x1b5)},'storage':{'$first':_0x1028c8(0x270)},'rack':{'$first':_0x1028c8(0x1eb)},'expiry_date':{'$first':_0x1028c8(0x257)},'production_date':{'$first':_0x1028c8(0x217)},'maxPerUnit':{'$first':_0x1028c8(0x1ab)},'batch_code':{'$first':_0x1028c8(0x26a)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1028c8(0x23d)},'actual_qty':{'$first':_0x1028c8(0x220)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x33901c=await warehouse[_0x1028c8(0x1fc)]([{'$match':{'name':_0x5bade9,'room':_0x60c250}},{'$unwind':_0x1028c8(0x1b4)},{'$match':{'product_details.secondary_code':_0x4b5dce}},{'$group':{'_id':_0x1028c8(0x25c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1028c8(0x1d6)},'secondary_code':{'$first':_0x1028c8(0x1f9)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1028c8(0x1e2)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1028c8(0x242)},'pallet':{'$first':_0x1028c8(0x238)},'unit':{'$first':_0x1028c8(0x21e)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1028c8(0x270)},'rack':{'$first':_0x1028c8(0x1eb)},'expiry_date':{'$first':_0x1028c8(0x257)},'production_date':{'$first':_0x1028c8(0x217)},'maxPerUnit':{'$first':_0x1028c8(0x1ab)},'batch_code':{'$first':_0x1028c8(0x26a)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1028c8(0x1a8)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x21d9fe[_0x1028c8(0x1f6)]>0x0)_0x5e3ac7[_0x1028c8(0x224)](_0x21d9fe);else _0x33901c['length']>0x0&&_0x5e3ac7[_0x1028c8(0x224)](_0x33901c);}const _0x5f2324=_0x4d1eec[_0x594153(0x2a7)](_0x4a32b4=>_0x1495e6(_0x4a32b4));await Promise[_0x594153(0x23f)](_0x5f2324),_0x4f5f90[_0x594153(0x1bb)](_0x5e3ac7);}),module[a0_0x127ba(0x202)]=router;