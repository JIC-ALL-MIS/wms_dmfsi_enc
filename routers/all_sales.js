function a0_0x3226(_0x57de67,_0x3a1e2f){var _0x1afa64=a0_0x1afa();return a0_0x3226=function(_0x32265c,_0x15efd9){_0x32265c=_0x32265c-0x1d9;var _0x4193b4=_0x1afa64[_0x32265c];return _0x4193b4;},a0_0x3226(_0x57de67,_0x3a1e2f);}function a0_0x1afa(){var _0x1d6c70=['forEach','email','/view/add_sale/product','$sale_product.bin','$product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','redirect','$note','3678OZSKEE','exports','name','delivery_code','$product.product_name','getFullYear','\x20Order\x20Date\x20:\x20','errors','get','$sale_product.type','status','invoice','$customers_docs','quantity_notConverted','<h5>','</span>','error','aggregate','\x20</h2>','product_list','language','post','success','$return_data','Received\x20Payment\x20For\x20Sale','logo','$sale_product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Hindi','warehouse_name','then','$product_details.expiry_date','$date','/preview/:id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.product_stock','product_name','prod_code','Ambient','233VDWLYC','4391910rJsztp','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','message','received_amount','</tbody>','$product_details.invoice','product_details','params','False','$product_details.batch_code','primary_unit','currency_placement','bay','6GhELsa','Sale\x20Return','final','maxperunit','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Enclosed','currency','max_per_unit','$product_details.isle','site_title','Email\x20sent\x20successfully','save','/all_sales/view','Chinese','$product_details.bay','prod_invoice','$isAllowEdit','push','Sales\x20Add\x20successfully','return_data','$product_details.storage','<table\x20style=\x22width:\x20100%\x20!important;\x22>','147808roisoz','sendMail','filter','isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','True','An\x20error\x20occurred\x20while\x20saving\x20data.','add_sales','getDate','user','7324530WyroaI','Raw\x20Materials','gmail','Shelves','date','603fqcJCk','string','type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','all_sales_barcode','finalize','</thead>','stock','/view/:id','</td>','sales\x20all_data','$product_details.secondary_unit','Floor','$product_details.pallet','<!DOCTYPE\x20html>','types','../public/language/languages.json','English\x20(US)','SCRN','/invoice/:id','floorlevel','batch_code','findOne','$product_details.actual_uom','$product_details.bin','Portuguese','/../public','all','password','log','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<hr\x20class=\x22my-3\x22>','$name','$room','$finalize','catch','host','actual_uom','OUT-','delivery_date','$product_details.floorlevel','$sale_product','2114236jTqdPA','render','sale_qty','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','edit_sales','stock_data','<div>','$sale_product.quantity','production_date','Arabic\x20(ae)','$product_details.product_cat','</body></html>','Logo.png','Level','Arabic','concat','Return\x20Goods','RoomAssigned','sales_quantity','storage','user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Return\x20Rooms','split','7038269UVTfjq','$product_details.product_code','/all_sales/preview/','express','max','return_qty','room','quantity','$invoice','$warehouse_name','bin','secondary_unit','French','$_id','rack','expiry_date','/view/add_sales/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20Order\x20Number\x20:\x20','</head><body>','Sale\x20Return\x20Mail','<tr>','Spanish','slice','/view/add_sales','6ovMeWz','sale_product','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Portuguese\x20(BR)','stocks','product_data','warehouse','Receiving\x20Area','createTransport','English','toString','level','findById','/view/return_sales/:id','<span\x20style=\x22float:\x20right;\x22>','flash','staff','product_stock','prod_cat','edit_sales_view','random','An\x20error\x20occurred.','foreach\x20newproduct','requested_qty','$product','/barcode_scanner','German','purchases_data','master','/upload/','product_code','find','/view','sales\x20item\x20return\x20successfull','customers_docs','$product_details.primary_code','$product_details.rack','sales_invoice','back','secondary_code','$product_details._id','floor','$product_details.product_name','Error\x20Occurs','padStart','Enabled','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.type','$customer','room_name','carton','</div>','Sales\x20Update\x20successfully','$product_details.production_date','payment\x20successfull','length','product','<strong>\x20Regards\x20</strong>','</tr>','port','map','amount','image','$product_details.unit','420QMCopC','customer','599951bgIMpX','<tbody\x20style=\x22text-align:\x20center;\x22>','body','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','actual_qty','primary_code','$product_details.secondary_code','due_amount','return_sale','unit','json','all_sales','../models/all_models','Sales\x20Mail','barcode\x20Product\x20master'];a0_0x1afa=function(){return _0x1d6c70;};return a0_0x1afa();}var a0_0x3b7305=a0_0x3226;(function(_0x1b6c83,_0x52e4da){var _0x25e08b=a0_0x3226,_0x2229b4=_0x1b6c83();while(!![]){try{var _0x6ed3f2=parseInt(_0x25e08b(0x29b))/0x1*(-parseInt(_0x25e08b(0x274))/0x2)+-parseInt(_0x25e08b(0x21b))/0x3*(-parseInt(_0x25e08b(0x1ea))/0x4)+-parseInt(_0x25e08b(0x29c))/0x5+-parseInt(_0x25e08b(0x2aa))/0x6*(-parseInt(_0x25e08b(0x202))/0x7)+parseInt(_0x25e08b(0x2c2))/0x8*(-parseInt(_0x25e08b(0x2d1))/0x9)+-parseInt(_0x25e08b(0x2cc))/0xa+parseInt(_0x25e08b(0x25d))/0xb*(parseInt(_0x25e08b(0x25b))/0xc);if(_0x6ed3f2===_0x52e4da)break;else _0x2229b4['push'](_0x2229b4['shift']());}catch(_0x43ba45){_0x2229b4['push'](_0x2229b4['shift']());}}}(a0_0x1afa,0xa9822));const express=require(a0_0x3b7305(0x205)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x3b7305(0x269)),auth=require('../middleware/auth'),nodemailer=require('nodemailer'),users=require(a0_0x3b7305(0x2e1));router[a0_0x3b7305(0x27c)](a0_0x3b7305(0x23b),auth,async(_0x3e1320,_0xa1afeb)=>{var _0x378b3f=a0_0x3b7305;try{const {username:_0x2d5326,email:_0x4975bc,role:_0x2d25d4}=_0x3e1320[_0x378b3f(0x2cb)],_0x3e0b9f=_0x3e1320[_0x378b3f(0x2cb)],_0x288b48=await profile[_0x378b3f(0x2e7)]({'email':_0x3e0b9f[_0x378b3f(0x26d)]}),_0x5f0e75=await master_shop[_0x378b3f(0x23a)]();let _0x246ecb;if(_0x3e0b9f['role']==_0x378b3f(0x22b)){const _0x2b0c9d=await staff[_0x378b3f(0x2e7)]({'email':_0x3e0b9f['email']});_0x246ecb=await sales[_0x378b3f(0x285)]([{'$lookup':{'from':'customers','localField':_0x378b3f(0x25c),'foreignField':_0x378b3f(0x276),'as':_0x378b3f(0x23d)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x378b3f(0x20a)},'customers':{'$first':'$customer'},'date':{'$first':_0x378b3f(0x294)},'warehouse_name':{'$first':_0x378b3f(0x20b)},'sale_product':{'$push':_0x378b3f(0x1e9)},'note':{'$first':_0x378b3f(0x273)},'return_data':{'$first':_0x378b3f(0x28b)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x378b3f(0x1f1)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x378b3f(0x26f)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x378b3f(0x28e)},'finalize':{'$first':_0x378b3f(0x1e2)},'isAllowEdit':{'$first':_0x378b3f(0x2bc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x246ecb=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x378b3f(0x25c),'foreignField':_0x378b3f(0x276),'as':_0x378b3f(0x23d)}},{'$unwind':_0x378b3f(0x280)},{'$unwind':_0x378b3f(0x1e9)},{'$group':{'_id':_0x378b3f(0x20f),'invoice':{'$first':_0x378b3f(0x20a)},'customers':{'$first':_0x378b3f(0x24b)},'date':{'$first':_0x378b3f(0x294)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x378b3f(0x1e9)},'note':{'$first':_0x378b3f(0x273)},'return_data':{'$first':_0x378b3f(0x28b)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x378b3f(0x1f1)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x378b3f(0x26f)},'type':{'$addToSet':_0x378b3f(0x27d)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x378b3f(0x1e2)},'isAllowEdit':{'$first':_0x378b3f(0x2bc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x378b3f(0x1dc)](_0x378b3f(0x2db),_0x246ecb);if(_0x5f0e75[0x0][_0x378b3f(0x288)]==_0x378b3f(0x2e2)){var _0x242e0f=users['English'];console[_0x378b3f(0x1dc)](_0x242e0f);}else{if(_0x5f0e75[0x0][_0x378b3f(0x288)]==_0x378b3f(0x290))var _0x242e0f=users[_0x378b3f(0x290)];else{if(_0x5f0e75[0x0]['language']==_0x378b3f(0x235))var _0x242e0f=users[_0x378b3f(0x235)];else{if(_0x5f0e75[0x0][_0x378b3f(0x288)]==_0x378b3f(0x218))var _0x242e0f=users[_0x378b3f(0x218)];else{if(_0x5f0e75[0x0][_0x378b3f(0x288)]==_0x378b3f(0x20e))var _0x242e0f=users['French'];else{if(_0x5f0e75[0x0][_0x378b3f(0x288)]==_0x378b3f(0x21e))var _0x242e0f=users[_0x378b3f(0x2ea)];else{if(_0x5f0e75[0x0]['language']==_0x378b3f(0x2b9))var _0x242e0f=users['Chinese'];else{if(_0x5f0e75[0x0][_0x378b3f(0x288)]==_0x378b3f(0x1f3))var _0x242e0f=users[_0x378b3f(0x1f8)];}}}}}}}_0xa1afeb['render'](_0x378b3f(0x268),{'success':_0x3e1320['flash'](_0x378b3f(0x28a)),'errors':_0x3e1320['flash'](_0x378b3f(0x27b)),'sales':_0x246ecb,'profile':_0x288b48,'role':_0x3e0b9f,'master_shop':_0x5f0e75,'language':_0x242e0f});}catch(_0x1dd278){console['log'](_0x1dd278);}});async function getRandom8DigitNumber(){var _0x5077ad=a0_0x3b7305;const _0x26af64=0x989680,_0x34c110=0x5f5e0ff,_0x3f1863=Math[_0x5077ad(0x244)](Math[_0x5077ad(0x22f)]()*(_0x34c110-_0x26af64+0x1))+_0x26af64;var _0x5c1d39;const _0x265110=await sales[_0x5077ad(0x2e7)]({'invoice':'OUT-'+_0x3f1863});return _0x265110&&_0x265110[_0x5077ad(0x252)]>0x0?_0x5c1d39=_0x5077ad(0x1e6)+_0x3f1863:_0x5c1d39=_0x5077ad(0x1e6)+_0x3f1863,_0x5c1d39;}router[a0_0x3b7305(0x27c)]('/view/add_sales',auth,async(_0x254636,_0x10969c)=>{var _0x514ebb=a0_0x3b7305;try{const {username:_0x4e6ddc,email:_0x375212,role:_0x3c92ea}=_0x254636[_0x514ebb(0x2cb)],_0x2759d5=_0x254636[_0x514ebb(0x2cb)],_0x196da6=await profile[_0x514ebb(0x2e7)]({'email':_0x2759d5['email']}),_0x39b61c=await master_shop[_0x514ebb(0x23a)](),_0x3bbe60=await customer[_0x514ebb(0x23a)]({});let _0x589da4;if(_0x2759d5['role']==_0x514ebb(0x22b)){const _0x2f3f6e=await staff[_0x514ebb(0x2e7)]({'email':_0x2759d5['email']});_0x589da4=await warehouse[_0x514ebb(0x285)]([{'$match':{'status':'Enabled','name':_0x2f3f6e[_0x514ebb(0x221)],'warehouse_category':_0x514ebb(0x2cd),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x514ebb(0x1e0),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x589da4=await warehouse[_0x514ebb(0x285)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x514ebb(0x1fa)}}},{'$group':{'_id':'$name','name':{'$first':_0x514ebb(0x1e0)}}},{'$sort':{'name':0x1}}]);const _0x24ca45=await product[_0x514ebb(0x23a)]({});var _0x2b49e6=[_0x514ebb(0x29a),_0x514ebb(0x2b1)];const _0x20947b=await sales[_0x514ebb(0x23a)]({}),_0x432554=_0x20947b[_0x514ebb(0x252)]+0x1,_0x3166b7=_0x514ebb(0x1e6)+_0x432554[_0x514ebb(0x225)]()[_0x514ebb(0x247)](0x5,'0');if(_0x39b61c[0x0][_0x514ebb(0x288)]==_0x514ebb(0x2e2)){var _0x400fc5=users['English'];console[_0x514ebb(0x1dc)](_0x400fc5);}else{if(_0x39b61c[0x0][_0x514ebb(0x288)]=='Hindi')var _0x400fc5=users[_0x514ebb(0x290)];else{if(_0x39b61c[0x0][_0x514ebb(0x288)]==_0x514ebb(0x235))var _0x400fc5=users['German'];else{if(_0x39b61c[0x0][_0x514ebb(0x288)]==_0x514ebb(0x218))var _0x400fc5=users[_0x514ebb(0x218)];else{if(_0x39b61c[0x0][_0x514ebb(0x288)]==_0x514ebb(0x20e))var _0x400fc5=users[_0x514ebb(0x20e)];else{if(_0x39b61c[0x0][_0x514ebb(0x288)]=='Portuguese\x20(BR)')var _0x400fc5=users['Portuguese'];else{if(_0x39b61c[0x0]['language']==_0x514ebb(0x2b9))var _0x400fc5=users[_0x514ebb(0x2b9)];else{if(_0x39b61c[0x0][_0x514ebb(0x288)]==_0x514ebb(0x1f3))var _0x400fc5=users['Arabic'];}}}}}}}const _0x32a4ec=getRandom8DigitNumber();_0x32a4ec[_0x514ebb(0x292)](_0x479455=>{var _0x34a433=_0x514ebb;_0x10969c[_0x34a433(0x1eb)](_0x34a433(0x2c9),{'success':_0x254636[_0x34a433(0x22a)]('success'),'errors':_0x254636[_0x34a433(0x22a)]('errors'),'role':_0x2759d5,'profile':_0x196da6,'customer':_0x3bbe60,'warehouse':_0x589da4,'product':_0x24ca45,'invoice':_0x479455,'master_shop':_0x39b61c,'language':_0x400fc5,'rooms_data':_0x2b49e6});})[_0x514ebb(0x1e3)](_0x7ea299=>{var _0x129845=_0x514ebb;_0x254636[_0x129845(0x22a)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x10969c[_0x129845(0x272)](_0x129845(0x2b8));});}catch(_0x162f56){console[_0x514ebb(0x1dc)](_0x162f56);}}),router[a0_0x3b7305(0x27c)](a0_0x3b7305(0x212),auth,async(_0x10e324,_0x346f4d)=>{var _0x33bf3f=a0_0x3b7305;try{const _0x497f44=_0x10e324[_0x33bf3f(0x2a4)]['id'];console[_0x33bf3f(0x1dc)](_0x497f44);const _0x37adfa=await product[_0x33bf3f(0x23a)](),_0x3e59a9=await purchases[_0x33bf3f(0x285)]([{'$match':{'warehouse_name':_0x497f44}},{'$unwind':_0x33bf3f(0x233)},{'$group':{'_id':_0x33bf3f(0x278)}}]);console['log'](_0x33bf3f(0x236),_0x3e59a9),_0x346f4d[_0x33bf3f(0x27e)](0xc8)[_0x33bf3f(0x267)]({'purchases_data':_0x3e59a9,'product_data':_0x37adfa});}catch(_0x1f9b13){console[_0x33bf3f(0x1dc)](_0x1f9b13);}}),router[a0_0x3b7305(0x289)](a0_0x3b7305(0x26e),auth,async(_0x482441,_0x11f521)=>{var _0xb417dc=a0_0x3b7305;try{const {warehouse_data:_0x13d764,product_data:_0x5f1ac7}=_0x482441[_0xb417dc(0x25f)];console['log'](_0x482441['body'][_0xb417dc(0x220)]);;const _0x3524da=await master_shop[_0xb417dc(0x23a)]();console[_0xb417dc(0x1dc)](_0xb417dc(0x237),_0x3524da);const _0x2f47f4=await product[_0xb417dc(0x2e7)]({'name':_0x5f1ac7});console[_0xb417dc(0x1dc)](_0xb417dc(0x253),_0x2f47f4);const _0x3a9045=await warehouse['aggregate']([{'$match':{'name':_0x13d764}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5f1ac7}},{'$group':{'_id':_0xb417dc(0x245),'product_stock':{'$first':_0xb417dc(0x297)}}}]);console[_0xb417dc(0x1dc)](_0xb417dc(0x1ef),_0x3a9045),_0x11f521[_0xb417dc(0x27e)](0xc8)[_0xb417dc(0x267)]({'master':_0x3524da,'new_product':_0x2f47f4,'stock_data':_0x3a9045});}catch(_0x2ff91e){console[_0xb417dc(0x1dc)](_0x2ff91e);}}),router['post'](a0_0x3b7305(0x21a),auth,async(_0x1d137b,_0x440038)=>{var _0x59e93f=a0_0x3b7305;try{const {invoice:_0x21ae79,date:_0x169da9,warehouse_name:_0x3178f0,product_name:_0x286398,stock:_0x41dee8,quantity:_0x3fdb92,note:_0x113534,room:_0x16fbb9,primary_code:_0xe33ca5,secondary_code:_0x38b18a,prod_code:_0x234d60,level:_0x4ac185,isle:_0x4478ee,pallet:_0x556f7f,batch_code:_0x4145b1,SCRN:_0x5c241e,expiry_date:_0x46aac4}=_0x1d137b[_0x59e93f(0x25f)];if(typeof _0x286398==_0x59e93f(0x2d2))var _0x29e714=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x298)]],_0x37ea41=[_0x1d137b[_0x59e93f(0x25f)]['stock']],_0x489b36=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x24d)]],_0x4652aa=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x262)]],_0x16c387=[_0x1d137b['body'][_0x59e93f(0x242)]],_0x203810=[_0x1d137b['body'][_0x59e93f(0x299)]],_0x280bdc=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x226)]],_0x1690cb=[_0x1d137b[_0x59e93f(0x25f)]['primary_unit']],_0x2966ef=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x20d)]],_0x49dcda=[_0x1d137b[_0x59e93f(0x25f)]['batch_code']],_0x1b55b6=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x211)]],_0x40313d=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x2b3)]],_0x3bd24e=[_0x1d137b['body'][_0x59e93f(0x1f2)]],_0x1dd8a4=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x232)]],_0x31dd64=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x1e7)]],_0xfa9391=[_0x1d137b['body'][_0x59e93f(0x277)]],_0x46e2e6=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x22d)]],_0x215b93=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x209)]],_0x161661=[_0x1d137b['body']['RoomAssigned']],_0x521e21=[_0x1d137b['body'][_0x59e93f(0x2bb)]],_0x29d2b3=[_0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x261)]],_0x397f94=[_0x1d137b['body']['actual_uom']];else var _0x29e714=[..._0x1d137b[_0x59e93f(0x25f)]['product_name']],_0x37ea41=[..._0x1d137b[_0x59e93f(0x25f)]['stock']],_0x489b36=[..._0x1d137b['body'][_0x59e93f(0x24d)]],_0x4652aa=[..._0x1d137b['body'][_0x59e93f(0x262)]],_0x16c387=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x242)]],_0x203810=[..._0x1d137b[_0x59e93f(0x25f)]['prod_code']],_0x280bdc=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x226)]],_0x1690cb=[..._0x1d137b['body']['primary_unit']],_0x2966ef=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x20d)]],_0x49dcda=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x2e6)]],_0x1b55b6=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x211)]],_0x40313d=[..._0x1d137b['body']['max_per_unit']],_0x3bd24e=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x1f2)]],_0x1dd8a4=[..._0x1d137b['body'][_0x59e93f(0x232)]],_0x31dd64=[..._0x1d137b['body'][_0x59e93f(0x1e7)]],_0xfa9391=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x277)]],_0x46e2e6=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x22d)]],_0x215b93=[..._0x1d137b[_0x59e93f(0x25f)]['quantity']],_0x161661=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x1fb)]],_0x521e21=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x2bb)]],_0x29d2b3=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x261)]],_0x397f94=[..._0x1d137b[_0x59e93f(0x25f)][_0x59e93f(0x1e5)]];const _0x5ff867=_0x29e714[_0x59e93f(0x257)](_0x47f78c=>{return _0x47f78c={'product_name':_0x47f78c};});_0x37ea41[_0x59e93f(0x26c)]((_0x54a4c7,_0x313f71)=>{var _0x14f658=_0x59e93f;_0x5ff867[_0x313f71][_0x14f658(0x2d8)]=Math[_0x14f658(0x1dd)](_0x54a4c7);}),_0x29d2b3['forEach']((_0x487541,_0xd33ce2)=>{var _0xdbd25b=_0x59e93f;_0x5ff867[_0xd33ce2][_0xdbd25b(0x261)]=Math[_0xdbd25b(0x1dd)](_0x487541);}),_0x397f94[_0x59e93f(0x26c)]((_0x517884,_0x408bd9)=>{var _0x5df791=_0x59e93f;_0x5ff867[_0x408bd9][_0x5df791(0x1e5)]=_0x517884;}),_0x489b36[_0x59e93f(0x26c)]((_0x59ea00,_0x25f1f7)=>{_0x5ff867[_0x25f1f7]['quantity']=_0x59ea00;}),_0x4652aa['forEach']((_0x4872c9,_0x32f26c)=>{var _0x3afe3c=_0x59e93f;_0x5ff867[_0x32f26c][_0x3afe3c(0x262)]=_0x4872c9;}),_0x16c387['forEach']((_0x30dfc2,_0x53626a)=>{_0x5ff867[_0x53626a]['secondary_code']=_0x30dfc2;}),_0x203810[_0x59e93f(0x26c)]((_0x56c35d,_0x5af495)=>{_0x5ff867[_0x5af495]['product_code']=_0x56c35d;}),_0x280bdc[_0x59e93f(0x26c)]((_0x1ac08,_0x2782fd)=>{_0x161661['forEach']((_0x56e0ee,_0x2b5471)=>{var _0x297fbb=a0_0x3226;if(_0x56e0ee=='Receiving\x20Area'&&_0x2782fd==_0x2b5471){var _0x1329e8=_0x1ac08['slice'](0x3);_0x5ff867[_0x2782fd]['storage']=_0x1ac08[0x0],_0x5ff867[_0x2782fd]['rack']=_0x1ac08[0x1],_0x5ff867[_0x2782fd][_0x297fbb(0x2a9)]=0x0,_0x5ff867[_0x2782fd][_0x297fbb(0x20c)]=0x0,_0x5ff867[_0x2782fd]['type']='Floor',_0x5ff867[_0x2782fd][_0x297fbb(0x2e5)]=_0x1329e8;}else{if(_0x56e0ee==_0x297fbb(0x2cf)&&_0x2782fd==_0x2b5471){var _0x1329e8=_0x1ac08[_0x297fbb(0x219)](0x3);_0x5ff867[_0x2782fd]['storage']=_0x1ac08[0x0],_0x5ff867[_0x2782fd][_0x297fbb(0x210)]=_0x1ac08[0x1],_0x5ff867[_0x2782fd]['bay']=0x0,_0x5ff867[_0x2782fd][_0x297fbb(0x20c)]=0x0,_0x5ff867[_0x2782fd][_0x297fbb(0x2d3)]=_0x297fbb(0x2dd),_0x5ff867[_0x2782fd][_0x297fbb(0x2e5)]=_0x1ac08[0x5];}else{if(_0x2782fd==_0x2b5471){var _0x2510cb;if(_0x1ac08[0x4]=='L')_0x2510cb=_0x297fbb(0x1f7);else _0x1ac08[0x4]=='F'&&(_0x2510cb=_0x297fbb(0x2dd));_0x5ff867[_0x2782fd][_0x297fbb(0x1fd)]=_0x1ac08[0x0],_0x5ff867[_0x2782fd][_0x297fbb(0x210)]=_0x1ac08[0x1],_0x5ff867[_0x2782fd][_0x297fbb(0x2a9)]=_0x1ac08[0x2],_0x5ff867[_0x2782fd]['bin']=_0x1ac08[0x3],_0x5ff867[_0x2782fd]['type']=_0x2510cb,_0x5ff867[_0x2782fd]['floorlevel']=_0x1ac08[0x5];}}}});}),_0x1690cb['forEach']((_0x2524c3,_0x2a3a6a)=>{var _0x2eac70=_0x59e93f;_0x5ff867[_0x2a3a6a][_0x2eac70(0x266)]=_0x2524c3;}),_0x2966ef['forEach']((_0x5c0b99,_0x44a98c)=>{_0x5ff867[_0x44a98c]['secondary_unit']=_0x5c0b99;}),_0x49dcda['forEach']((_0x36c84b,_0x7d9a2b)=>{var _0x14bc6c=_0x59e93f;_0x5ff867[_0x7d9a2b][_0x14bc6c(0x2e6)]=_0x36c84b;}),_0x1b55b6['forEach']((_0x1ea140,_0x36549a)=>{var _0x20a66e=_0x59e93f;_0x5ff867[_0x36549a][_0x20a66e(0x211)]=_0x1ea140;}),_0x40313d['forEach']((_0x25396c,_0x3720bd)=>{var _0x27528a=_0x59e93f;_0x5ff867[_0x3720bd][_0x27528a(0x2ad)]=_0x25396c;}),_0x3bd24e[_0x59e93f(0x26c)]((_0x1eb534,_0x5e7f5f)=>{var _0x437524=_0x59e93f;_0x5ff867[_0x5e7f5f][_0x437524(0x1f2)]=_0x1eb534;}),_0x1dd8a4[_0x59e93f(0x26c)]((_0x49bf4f,_0x59141d)=>{var _0x36e905=_0x59e93f;_0x5ff867[_0x59141d][_0x36e905(0x232)]=_0x49bf4f;}),_0x31dd64[_0x59e93f(0x26c)]((_0x5d5ac3,_0x440330)=>{var _0x1442bb=_0x59e93f;_0x5ff867[_0x440330][_0x1442bb(0x1e7)]=_0x5d5ac3;}),_0xfa9391[_0x59e93f(0x26c)]((_0x50253b,_0x4f14e1)=>{_0x5ff867[_0x4f14e1]['delivery_code']=_0x50253b;}),_0x46e2e6[_0x59e93f(0x26c)]((_0xe2dc8c,_0x420c92)=>{var _0x1cee88=_0x59e93f;_0x5ff867[_0x420c92][_0x1cee88(0x22d)]=_0xe2dc8c;}),_0x215b93[_0x59e93f(0x26c)]((_0x51c79e,_0x3e9286)=>{var _0x445af8=_0x59e93f;_0x5ff867[_0x3e9286][_0x445af8(0x281)]=_0x51c79e;}),_0x161661[_0x59e93f(0x26c)]((_0x1e4741,_0x379ee2)=>{var _0x28faef=_0x59e93f;_0x5ff867[_0x379ee2][_0x28faef(0x24c)]=_0x1e4741;}),_0x521e21['forEach']((_0x2e7b7d,_0x17e832)=>{var _0x3b3cb5=_0x59e93f;_0x5ff867[_0x17e832][_0x3b3cb5(0x27f)]=_0x2e7b7d;});var _0x294234=0x0;_0x5ff867[_0x59e93f(0x26c)](_0x396ba1=>{var _0x5c75ee=_0x59e93f;(_0x396ba1[_0x5c75ee(0x2d8)]<_0x396ba1['quantity_notConverted']||_0x396ba1[_0x5c75ee(0x281)]==0x0)&&(console[_0x5c75ee(0x1dc)](_0x5c75ee(0x231),_0x396ba1),_0x294234++);});const _0x105d0c=_0x5ff867['filter'](_0x4a40d7=>_0x4a40d7['quantity']!=='0'&&_0x4a40d7['quantity']!==''),_0x2311bb=new sales({'invoice':_0x21ae79,'customer':_0x1d137b[_0x59e93f(0x25f)]['customer'],'date':_0x169da9,'warehouse_name':_0x3178f0,'sale_product':_0x105d0c,'note':_0x113534,'room':_0x16fbb9,'primary_code':_0xe33ca5,'secondary_code':_0x38b18a,'prod_code':_0x234d60,'SCRN':_0x5c241e}),_0x2bf235=await _0x2311bb[_0x59e93f(0x2b7)]();_0x1d137b['flash'](_0x59e93f(0x28a),_0x59e93f(0x2be)),_0x440038[_0x59e93f(0x272)](_0x59e93f(0x204)+_0x2bf235['_id']);}catch(_0x575d0c){console[_0x59e93f(0x1dc)](_0x575d0c);}}),router[a0_0x3b7305(0x27c)](a0_0x3b7305(0x295),auth,async(_0x1967b7,_0x48299e)=>{var _0x4f11ae=a0_0x3b7305;try{const {username:_0x3e141f,email:_0x3a6bec,role:_0x51f528}=_0x1967b7[_0x4f11ae(0x2cb)],_0x210208=_0x1967b7[_0x4f11ae(0x2cb)],_0xf11f86=await profile['findOne']({'email':_0x210208[_0x4f11ae(0x26d)]}),_0x2fba0d=await master_shop[_0x4f11ae(0x23a)](),_0x44973a=_0x1967b7[_0x4f11ae(0x2a4)]['id'],_0x52f83a=await sales[_0x4f11ae(0x227)](_0x44973a),_0xf7c7d8=await warehouse['aggregate']([{'$match':{'name':_0x52f83a['warehouse_name']}},{'$unwind':_0x4f11ae(0x270)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4f11ae(0x245)},'product_stock':{'$first':_0x4f11ae(0x297)},'bay':{'$first':_0x4f11ae(0x2ba)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4f11ae(0x24a)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4f11ae(0x23e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4f11ae(0x203)},'storage':{'$first':_0x4f11ae(0x2c0)},'rack':{'$first':_0x4f11ae(0x23f)},'expiry_date':{'$first':_0x4f11ae(0x293)},'production_date':{'$first':_0x4f11ae(0x250)},'invoice':{'$first':_0x4f11ae(0x2a2)}}}]),_0x23a987=await customer['find']({});let _0x59a99d;if(_0x210208['role']==_0x4f11ae(0x22b)){const _0x193a2d=await staff[_0x4f11ae(0x2e7)]({'email':_0x210208[_0x4f11ae(0x26d)]});_0x59a99d=await warehouse[_0x4f11ae(0x285)]([{'$match':{'status':_0x4f11ae(0x248),'name':_0x193a2d[_0x4f11ae(0x221)]}},{'$group':{'_id':'$name','name':{'$first':_0x4f11ae(0x1e0)}}}]);}else _0x59a99d=await warehouse[_0x4f11ae(0x285)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x4f11ae(0x1e0),'name':{'$first':_0x4f11ae(0x1e0)}}}]);const _0x5e505a=await product[_0x4f11ae(0x23a)]({}),_0x39db46=await suppliers['find']({});if(_0x2fba0d[0x0]['language']==_0x4f11ae(0x2e2)){var _0x1175e0=users[_0x4f11ae(0x224)];console[_0x4f11ae(0x1dc)](_0x1175e0);}else{if(_0x2fba0d[0x0][_0x4f11ae(0x288)]==_0x4f11ae(0x290))var _0x1175e0=users[_0x4f11ae(0x290)];else{if(_0x2fba0d[0x0][_0x4f11ae(0x288)]=='German')var _0x1175e0=users['German'];else{if(_0x2fba0d[0x0][_0x4f11ae(0x288)]==_0x4f11ae(0x218))var _0x1175e0=users[_0x4f11ae(0x218)];else{if(_0x2fba0d[0x0][_0x4f11ae(0x288)]==_0x4f11ae(0x20e))var _0x1175e0=users[_0x4f11ae(0x20e)];else{if(_0x2fba0d[0x0]['language']==_0x4f11ae(0x21e))var _0x1175e0=users[_0x4f11ae(0x2ea)];else{if(_0x2fba0d[0x0][_0x4f11ae(0x288)]==_0x4f11ae(0x2b9))var _0x1175e0=users['Chinese'];else{if(_0x2fba0d[0x0][_0x4f11ae(0x288)]==_0x4f11ae(0x1f3))var _0x1175e0=users[_0x4f11ae(0x1f8)];}}}}}}}_0x48299e[_0x4f11ae(0x1eb)](_0x4f11ae(0x22e),{'success':_0x1967b7[_0x4f11ae(0x22a)]('success'),'errors':_0x1967b7[_0x4f11ae(0x22a)]('errors'),'role':_0x210208,'profile':_0xf11f86,'customer':_0x23a987,'warehouse':_0x59a99d,'product':_0xf7c7d8,'user':_0x52f83a,'master_shop':_0x2fba0d,'unit':_0x5e505a,'language':_0x1175e0,'suppliers':_0x39db46});}catch(_0x380421){console[_0x4f11ae(0x1dc)](_0x380421);}}),router[a0_0x3b7305(0x289)](a0_0x3b7305(0x295),auth,async(_0x23c26d,_0x2b14ec)=>{var _0x1f8f58=a0_0x3b7305;try{const _0x328976=_0x23c26d[_0x1f8f58(0x2a4)]['id'],{invoice:_0x442319,warehouse_name:_0x5ef3c9,room:_0x3e1bea}=_0x23c26d[_0x1f8f58(0x25f)],_0x212939=await sales['findOne']({'invoice':_0x442319}),_0x5dc1de=_0x212939[_0x1f8f58(0x21c)][_0x1f8f58(0x257)](async _0x43ef0f=>{var _0x498166=_0x1f8f58,_0x4cb405=await warehouse['findOne']({'name':_0x5ef3c9,'room':_0x43ef0f[_0x498166(0x24c)],'warehouse_category':'Raw\x20Materials'});const _0x531597=_0x4cb405['product_details'][_0x498166(0x257)](_0x4d2498=>{var _0x3150e2=_0x498166;_0x4d2498[_0x3150e2(0x298)]==_0x43ef0f[_0x3150e2(0x298)]&&_0x4d2498['floorlevel']==_0x43ef0f['floorlevel']&&_0x4d2498[_0x3150e2(0x2d3)]==_0x43ef0f[_0x3150e2(0x2d3)]&&_0x4d2498[_0x3150e2(0x20c)]==_0x43ef0f['bin']&&_0x4d2498[_0x3150e2(0x2a9)]==_0x43ef0f[_0x3150e2(0x2a9)]&&_0x4d2498[_0x3150e2(0x210)]==_0x43ef0f[_0x3150e2(0x210)]&&_0x4d2498['storage']==_0x43ef0f[_0x3150e2(0x1fd)]&&_0x4d2498[_0x3150e2(0x211)]==_0x43ef0f[_0x3150e2(0x211)]&&_0x4d2498[_0x3150e2(0x2e6)]==_0x43ef0f['batch_code']&&_0x4d2498[_0x3150e2(0x27f)]==_0x43ef0f[_0x3150e2(0x27f)]&&(_0x4d2498[_0x3150e2(0x22c)]=Math[_0x3150e2(0x206)](0x0,Math[_0x3150e2(0x1dd)](_0x4d2498[_0x3150e2(0x22c)])-Math[_0x3150e2(0x1dd)](_0x43ef0f['quantity'])));});return _0x4cb405;});Promise[_0x1f8f58(0x1da)](_0x5dc1de)[_0x1f8f58(0x292)](async _0x5823b7=>{var _0x385925=_0x1f8f58;try{for(const _0x3a512c of _0x5823b7){await _0x3a512c[_0x385925(0x2b7)]();}_0x212939[_0x385925(0x2d6)]=_0x385925(0x2c7);const _0x5bfc08=await _0x212939['save'](),_0x320dec=await master_shop[_0x385925(0x23a)](),_0x49b92c=await email_settings[_0x385925(0x2e7)](),_0x596ad6=await supervisor_settings['find']();var _0xad6b4f=_0x212939['sale_product'],_0x2a1413='',_0x48ce15;for(_0x48ce15 in _0xad6b4f){_0x2a1413+='<tr>'+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15][_0x385925(0x298)]+'</td>'+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15][_0x385925(0x239)]+_0x385925(0x2da)+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15]['quantity']+'</td>'+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15][_0x385925(0x266)]+_0x385925(0x2da)+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15][_0x385925(0x20d)]+_0x385925(0x2da)+_0x385925(0x1ed)+_0x212939[_0x385925(0x291)]+_0x385925(0x2da)+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15][_0x385925(0x24c)]+'</td>'+_0x385925(0x1ed)+_0xad6b4f[_0x48ce15][_0x385925(0x1fd)]+_0xad6b4f[_0x48ce15][_0x385925(0x210)]+_0xad6b4f[_0x48ce15][_0x385925(0x2a9)]+_0xad6b4f[_0x48ce15][_0x385925(0x20c)]+_0xad6b4f[_0x48ce15][_0x385925(0x2d3)][0x0]+_0xad6b4f[_0x48ce15][_0x385925(0x2e5)]+_0x385925(0x2da),'</tr>';}let _0x42abf1=nodemailer[_0x385925(0x223)]({'host':_0x49b92c[_0x385925(0x1e4)],'port':Number(_0x49b92c[_0x385925(0x256)]),'secure':![],'auth':{'user':_0x49b92c[_0x385925(0x26d)],'pass':_0x49b92c['password']}}),_0x3f1d6d={'from':_0x49b92c[_0x385925(0x26d)],'to':_0x596ad6[0x0]['RMSEmail'],'subject':_0x385925(0x26a),'attachments':[{'filename':'Logo.png','path':__dirname+_0x385925(0x1d9)+'/upload/'+_0x320dec[0x0]['image'],'cid':'logo'}],'html':_0x385925(0x2df)+_0x385925(0x2ae)+_0x385925(0x215)+_0x385925(0x1f0)+_0x385925(0x260)+_0x385925(0x1f0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x385925(0x24e)+_0x385925(0x1f0)+'<h2>\x20'+_0x320dec[0x0][_0x385925(0x2b5)]+_0x385925(0x286)+_0x385925(0x24e)+_0x385925(0x24e)+_0x385925(0x1df)+_0x385925(0x1f0)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x385925(0x214)+_0x212939[_0x385925(0x27f)]+'\x20'+_0x385925(0x229)+_0x385925(0x27a)+_0x212939[_0x385925(0x2d0)]+'\x20'+_0x385925(0x283)+_0x385925(0x29d)+'</div>'+_0x385925(0x2c1)+_0x385925(0x271)+_0x385925(0x217)+_0x385925(0x1ff)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x385925(0x213)+_0x385925(0x2b0)+_0x385925(0x2c6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x385925(0x2d4)+_0x385925(0x2af)+_0x385925(0x255)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2a1413+'\x20'+_0x385925(0x2a1)+'</table>'+_0x385925(0x1f0)+'<strong>\x20Regards\x20</strong>'+_0x385925(0x282)+_0x320dec[0x0]['site_title']+_0x385925(0x29d)+_0x385925(0x24e)+_0x385925(0x24e)+_0x385925(0x1f5)};_0x42abf1[_0x385925(0x2c3)](_0x3f1d6d,function(_0x1c6998,_0x4b30bb){var _0x2fb5c3=_0x385925;_0x1c6998?(console[_0x2fb5c3(0x1dc)](_0x1c6998),console['log'](_0x2fb5c3(0x246))):console[_0x2fb5c3(0x1dc)](_0x2fb5c3(0x2b6));}),_0x23c26d['flash'](_0x385925(0x28a),_0x385925(0x24f)),_0x2b14ec['redirect'](_0x385925(0x204)+_0x328976);}catch(_0x6b93f6){console[_0x385925(0x284)](_0x6b93f6),_0x2b14ec[_0x385925(0x27e)](0x1f4)[_0x385925(0x267)]({'error':_0x385925(0x2c8)});}})[_0x1f8f58(0x1e3)](_0x21f7b3=>{var _0x302057=_0x1f8f58;console[_0x302057(0x284)](_0x21f7b3),_0x2b14ec['status'](0x1f4)[_0x302057(0x267)]({'error':_0x302057(0x230)});});}catch(_0x3074f1){console[_0x1f8f58(0x1dc)](_0x3074f1);}}),router[a0_0x3b7305(0x27c)](a0_0x3b7305(0x2d9),auth,async(_0x360b49,_0x3fe2d1)=>{var _0x526809=a0_0x3b7305;try{const {username:_0x319a3f,email:_0x7186e2,role:_0x2795fc}=_0x360b49[_0x526809(0x2cb)],_0x15fa68=_0x360b49[_0x526809(0x2cb)],_0x3d0e68=await profile['findOne']({'email':_0x15fa68[_0x526809(0x26d)]}),_0x4b6cef=await master_shop['find'](),_0x3befa8=_0x360b49[_0x526809(0x2a4)]['id'],_0x323e35=await sales[_0x526809(0x227)](_0x3befa8);var _0x27a4ed=[_0x526809(0x29a),'Enclosed'];const _0x4be4f4=await warehouse[_0x526809(0x285)]([{'$match':{'name':_0x323e35[_0x526809(0x291)],'warehouse_category':_0x526809(0x2cd)}},{'$unwind':_0x526809(0x270)},{'$group':{'_id':_0x526809(0x243),'name':{'$first':_0x526809(0x245)},'product_stock':{'$first':_0x526809(0x297)},'bay':{'$first':_0x526809(0x2ba)},'bin':{'$first':_0x526809(0x2e9)},'type':{'$first':_0x526809(0x24a)},'floorlevel':{'$first':_0x526809(0x1e8)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x526809(0x203)},'storage':{'$first':_0x526809(0x2c0)},'rack':{'$first':_0x526809(0x23f)}}}]),_0x48f022=await customer[_0x526809(0x23a)]({});let _0x3873f7;if(_0x15fa68['role']==_0x526809(0x22b)){const _0x5ed76d=await staff[_0x526809(0x2e7)]({'email':_0x15fa68[_0x526809(0x26d)]});_0x3873f7=await warehouse[_0x526809(0x285)]([{'$match':{'status':_0x526809(0x248),'name':_0x5ed76d['warehouse'],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x526809(0x1e0),'name':{'$first':_0x526809(0x1e0)}}}]);}else _0x3873f7=await warehouse['aggregate']([{'$match':{'status':_0x526809(0x248),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x526809(0x1e0),'name':{'$first':'$name'}}}]);const _0x11ab82=await product[_0x526809(0x23a)]({});if(_0x4b6cef[0x0][_0x526809(0x288)]=='English\x20(US)'){var _0x3e8ec0=users[_0x526809(0x224)];console['log'](_0x3e8ec0);}else{if(_0x4b6cef[0x0][_0x526809(0x288)]==_0x526809(0x290))var _0x3e8ec0=users[_0x526809(0x290)];else{if(_0x4b6cef[0x0]['language']==_0x526809(0x235))var _0x3e8ec0=users[_0x526809(0x235)];else{if(_0x4b6cef[0x0][_0x526809(0x288)]==_0x526809(0x218))var _0x3e8ec0=users[_0x526809(0x218)];else{if(_0x4b6cef[0x0]['language']==_0x526809(0x20e))var _0x3e8ec0=users[_0x526809(0x20e)];else{if(_0x4b6cef[0x0]['language']==_0x526809(0x21e))var _0x3e8ec0=users['Portuguese'];else{if(_0x4b6cef[0x0]['language']==_0x526809(0x2b9))var _0x3e8ec0=users[_0x526809(0x2b9)];else{if(_0x4b6cef[0x0][_0x526809(0x288)]==_0x526809(0x1f3))var _0x3e8ec0=users[_0x526809(0x1f8)];}}}}}}}_0x3fe2d1[_0x526809(0x1eb)](_0x526809(0x1ee),{'success':_0x360b49[_0x526809(0x22a)](_0x526809(0x28a)),'errors':_0x360b49[_0x526809(0x22a)](_0x526809(0x27b)),'role':_0x15fa68,'profile':_0x3d0e68,'customer':_0x48f022,'warehouse':_0x3873f7,'product':_0x4be4f4,'user':_0x323e35,'master_shop':_0x4b6cef,'unit':_0x11ab82,'language':_0x3e8ec0});}catch(_0xce94c4){console[_0x526809(0x1dc)](_0xce94c4);}}),router[a0_0x3b7305(0x289)](a0_0x3b7305(0x2d9),auth,async(_0x5313ed,_0x58ab6e)=>{var _0x3d8c8a=a0_0x3b7305;try{const _0x1b249e=_0x5313ed['params']['id'],_0xf788ea=await sales[_0x3d8c8a(0x2e7)]({'_id':_0x5313ed[_0x3d8c8a(0x2a4)]['id']}),_0x2432a6=await warehouse[_0x3d8c8a(0x2e7)]({'name':_0xf788ea[_0x3d8c8a(0x291)],'room':_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x208)]}),{invoice:_0x52a86b,date:_0x5a9393,warehouse_name:_0x2637e8,product_name:_0x1a4708,stock:_0x525bba,quantity:_0x3b9f4a,note:_0x5f591f,room:_0x31eef2,customer:_0x598943,SCRN:_0xa06876}=_0x5313ed[_0x3d8c8a(0x25f)];if(typeof _0x1a4708==_0x3d8c8a(0x2d2))var _0xfcc479=[_0x5313ed[_0x3d8c8a(0x25f)]['product_name']],_0x4ad9e5=[_0x5313ed[_0x3d8c8a(0x25f)]['stock']],_0x475d05=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x24d)]],_0x14ecad=[_0x5313ed[_0x3d8c8a(0x25f)]['primary_code']],_0x52989d=[_0x5313ed[_0x3d8c8a(0x25f)]['secondary_code']],_0x406286=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x299)]],_0x217a6d=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x226)]],_0xb60db=[_0x5313ed['body']['primary_unit']],_0x26c5da=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x20d)]],_0x58403d=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x2e6)]],_0x3f2c2a=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x211)]],_0x58d6e0=[_0x5313ed['body'][_0x3d8c8a(0x2b3)]],_0x9216aa=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x1f2)]],_0x42244d=[_0x5313ed[_0x3d8c8a(0x25f)]['requested_qty']],_0x1d68fa=[_0x5313ed['body'][_0x3d8c8a(0x1e7)]],_0x436f46=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x277)]],_0x7d5f10=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x22d)]],_0x11638b=[_0x5313ed['body'][_0x3d8c8a(0x209)]],_0x41a651=[_0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x1fb)]];else var _0xfcc479=[..._0x5313ed[_0x3d8c8a(0x25f)]['product_name']],_0x4ad9e5=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x2d8)]],_0x475d05=[..._0x5313ed[_0x3d8c8a(0x25f)]['carton']],_0x14ecad=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x262)]],_0x52989d=[..._0x5313ed['body'][_0x3d8c8a(0x242)]],_0x406286=[..._0x5313ed[_0x3d8c8a(0x25f)]['prod_code']],_0x217a6d=[..._0x5313ed[_0x3d8c8a(0x25f)]['level']],_0xb60db=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x2a7)]],_0x26c5da=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x20d)]],_0x58403d=[..._0x5313ed[_0x3d8c8a(0x25f)]['batch_code']],_0x3f2c2a=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x211)]],_0x58d6e0=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x2b3)]],_0x9216aa=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x1f2)]],_0x42244d=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x232)]],_0x1d68fa=[..._0x5313ed['body'][_0x3d8c8a(0x1e7)]],_0x436f46=[..._0x5313ed['body'][_0x3d8c8a(0x277)]],_0x7d5f10=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x22d)]],_0x11638b=[..._0x5313ed[_0x3d8c8a(0x25f)][_0x3d8c8a(0x209)]],_0x41a651=[..._0x5313ed[_0x3d8c8a(0x25f)]['RoomAssigned']];const _0x1c6a38=_0xfcc479[_0x3d8c8a(0x257)](_0x415411=>{return _0x415411={'product_name':_0x415411};});_0x4ad9e5[_0x3d8c8a(0x26c)]((_0x25ab1b,_0x595c9c)=>{var _0x16d130=_0x3d8c8a;_0x1c6a38[_0x595c9c]['stock']=Math[_0x16d130(0x1dd)](_0x25ab1b);}),_0x475d05[_0x3d8c8a(0x26c)]((_0x296df1,_0x3e6e91)=>{var _0x444f73=_0x3d8c8a;_0x1c6a38[_0x3e6e91][_0x444f73(0x209)]=_0x296df1;}),_0x14ecad['forEach']((_0x2fbc5a,_0x2d636c)=>{var _0x5fc9c9=_0x3d8c8a;_0x1c6a38[_0x2d636c][_0x5fc9c9(0x262)]=_0x2fbc5a;}),_0x52989d['forEach']((_0x4538c0,_0x476e40)=>{var _0x286956=_0x3d8c8a;_0x1c6a38[_0x476e40][_0x286956(0x242)]=_0x4538c0;}),_0x406286[_0x3d8c8a(0x26c)]((_0x2ca46b,_0x2d2b2f)=>{_0x1c6a38[_0x2d2b2f]['product_code']=_0x2ca46b;}),_0x217a6d[_0x3d8c8a(0x26c)]((_0x3f03f6,_0x2f09fd)=>{_0x41a651['forEach']((_0x3768e9,_0x34004a)=>{var _0x41a4de=a0_0x3226;if(_0x3768e9==_0x41a4de(0x222)&&_0x2f09fd==_0x34004a){var _0x1d2ae6=_0x3f03f6[_0x41a4de(0x219)](0x3);_0x1c6a38[_0x2f09fd][_0x41a4de(0x1fd)]=_0x3f03f6[0x0],_0x1c6a38[_0x2f09fd][_0x41a4de(0x210)]=_0x3f03f6[0x1],_0x1c6a38[_0x2f09fd][_0x41a4de(0x2a9)]=0x0,_0x1c6a38[_0x2f09fd]['bin']=0x0,_0x1c6a38[_0x2f09fd][_0x41a4de(0x2d3)]='Floor',_0x1c6a38[_0x2f09fd]['floorlevel']=_0x1d2ae6;}else{if(_0x3768e9=='Shelves'&&_0x2f09fd==_0x34004a){var _0x1d2ae6=_0x3f03f6[_0x41a4de(0x219)](0x3);_0x1c6a38[_0x2f09fd]['storage']=_0x3f03f6[0x0],_0x1c6a38[_0x2f09fd][_0x41a4de(0x210)]=_0x3f03f6[0x1],_0x1c6a38[_0x2f09fd][_0x41a4de(0x2a9)]=0x0,_0x1c6a38[_0x2f09fd][_0x41a4de(0x20c)]=0x0,_0x1c6a38[_0x2f09fd][_0x41a4de(0x2d3)]=_0x41a4de(0x2dd),_0x1c6a38[_0x2f09fd]['floorlevel']=_0x3f03f6[0x5];}else{if(_0x2f09fd==_0x34004a){var _0x1009ab;if(_0x3f03f6[0x4]=='L')_0x1009ab=_0x41a4de(0x1f7);else _0x3f03f6[0x4]=='F'&&(_0x1009ab=_0x41a4de(0x2dd));_0x1c6a38[_0x2f09fd]['storage']=_0x3f03f6[0x0],_0x1c6a38[_0x2f09fd][_0x41a4de(0x210)]=_0x3f03f6[0x1],_0x1c6a38[_0x2f09fd]['bay']=_0x3f03f6[0x2],_0x1c6a38[_0x2f09fd][_0x41a4de(0x20c)]=_0x3f03f6[0x3],_0x1c6a38[_0x2f09fd][_0x41a4de(0x2d3)]=_0x1009ab,_0x1c6a38[_0x2f09fd]['floorlevel']=_0x3f03f6[0x5];}}}});}),_0xb60db[_0x3d8c8a(0x26c)]((_0x22f629,_0x209a48)=>{var _0xcb24ca=_0x3d8c8a;_0x1c6a38[_0x209a48][_0xcb24ca(0x266)]=_0x22f629;}),_0x26c5da[_0x3d8c8a(0x26c)]((_0xb799f0,_0x272c35)=>{_0x1c6a38[_0x272c35]['secondary_unit']=_0xb799f0;}),_0x58403d[_0x3d8c8a(0x26c)]((_0x4d867e,_0x1c00de)=>{var _0x5b724e=_0x3d8c8a;_0x1c6a38[_0x1c00de][_0x5b724e(0x2e6)]=_0x4d867e;}),_0x3f2c2a[_0x3d8c8a(0x26c)]((_0x58511f,_0x383f31)=>{var _0x5c8db4=_0x3d8c8a;_0x1c6a38[_0x383f31][_0x5c8db4(0x211)]=_0x58511f;}),_0x58d6e0[_0x3d8c8a(0x26c)]((_0xccef04,_0x2c801d)=>{var _0x1be49e=_0x3d8c8a;_0x1c6a38[_0x2c801d][_0x1be49e(0x2ad)]=_0xccef04;}),_0x9216aa['forEach']((_0x1864ad,_0x516cbf)=>{var _0x4bf769=_0x3d8c8a;_0x1c6a38[_0x516cbf][_0x4bf769(0x1f2)]=_0x1864ad;}),_0x42244d['forEach']((_0x5942bb,_0x148f08)=>{var _0x59396e=_0x3d8c8a;_0x1c6a38[_0x148f08]['requested_qty']=Math[_0x59396e(0x1dd)](_0x5942bb);}),_0x1d68fa[_0x3d8c8a(0x26c)]((_0x33ad69,_0x55bd5c)=>{var _0xbcc9e4=_0x3d8c8a;_0x1c6a38[_0x55bd5c][_0xbcc9e4(0x1e7)]=_0x33ad69;}),_0x436f46[_0x3d8c8a(0x26c)]((_0x580708,_0x56b13a)=>{var _0x4bbcdf=_0x3d8c8a;_0x1c6a38[_0x56b13a][_0x4bbcdf(0x277)]=_0x580708;}),_0x7d5f10['forEach']((_0x1b5897,_0x59b4ef)=>{var _0x5654ee=_0x3d8c8a;_0x1c6a38[_0x59b4ef][_0x5654ee(0x22d)]=_0x1b5897;}),_0x11638b[_0x3d8c8a(0x26c)]((_0x4fb6b6,_0x3b075d)=>{var _0x395134=_0x3d8c8a;_0x1c6a38[_0x3b075d][_0x395134(0x281)]=_0x4fb6b6;}),_0x41a651[_0x3d8c8a(0x26c)]((_0x122859,_0x1d9e6a)=>{var _0x406342=_0x3d8c8a;_0x1c6a38[_0x1d9e6a][_0x406342(0x24c)]=_0x122859;});var _0x35bb9b=0x0;_0x1c6a38[_0x3d8c8a(0x26c)](_0x473baf=>{var _0x51480f=_0x3d8c8a;console['log']('foreach\x20newproduct',_0x473baf),(parseInt(_0x473baf[_0x51480f(0x2d8)])<parseInt(_0x473baf[_0x51480f(0x209)])||parseInt(_0x473baf[_0x51480f(0x209)])==0x0)&&_0x35bb9b++;});if(_0x35bb9b!=0x0)return _0x5313ed[_0x3d8c8a(0x22a)](_0x3d8c8a(0x27b),_0x3d8c8a(0x249)),_0x58ab6e[_0x3d8c8a(0x272)](_0x3d8c8a(0x241));const _0x444927=_0x1c6a38[_0x3d8c8a(0x2c4)](_0x105973=>_0x105973[_0x3d8c8a(0x209)]!=='0'&&_0x105973[_0x3d8c8a(0x209)]!=='');_0xf788ea[_0x3d8c8a(0x27f)]=_0x52a86b,_0xf788ea['customer']=_0x598943,_0xf788ea['date']=_0x5a9393,_0xf788ea[_0x3d8c8a(0x291)]=_0x2637e8,_0xf788ea[_0x3d8c8a(0x21c)]=_0x444927,_0xf788ea['note']=_0x5f591f,_0xf788ea[_0x3d8c8a(0x2e3)]=_0xa06876,_0xf788ea[_0x3d8c8a(0x2d6)]=_0x3d8c8a(0x2a5),_0xf788ea[_0x3d8c8a(0x2c5)]='False';const _0x3532c6=await _0xf788ea[_0x3d8c8a(0x2b7)]();_0x5313ed[_0x3d8c8a(0x22a)](_0x3d8c8a(0x28a),'Sales\x20Update\x20successfully'),_0x58ab6e[_0x3d8c8a(0x272)](_0x3d8c8a(0x2b8));}catch(_0x5495d2){console[_0x3d8c8a(0x1dc)](_0x5495d2);}}),router[a0_0x3b7305(0x289)]('/give_payment/:id',auth,async(_0x2016eb,_0x5b4fa6)=>{var _0x3dc0b4=a0_0x3b7305;try{const _0x3d82d3=_0x2016eb['params']['id'],{invoice:_0x28fba7,customer:_0x3318a9,receivable_amount:_0x4af780,received_amount:_0x3f9ea6}=_0x2016eb['body'],_0x316cf8=await sales[_0x3dc0b4(0x227)](_0x3d82d3);console[_0x3dc0b4(0x1dc)](_0x316cf8);var _0x120caf=_0x4af780-_0x3f9ea6;console['log'](_0x3f9ea6),_0x316cf8[_0x3dc0b4(0x2a0)]=parseFloat(_0x3f9ea6)+parseFloat(_0x316cf8[_0x3dc0b4(0x2a0)]),_0x316cf8[_0x3dc0b4(0x264)]=_0x120caf,console[_0x3dc0b4(0x1dc)](_0x316cf8);const _0x50f1b8=await _0x316cf8[_0x3dc0b4(0x2b7)](),_0x131406=await c_payment_data[_0x3dc0b4(0x2e7)]({'invoice':_0x28fba7});_0x131406[_0x3dc0b4(0x258)]=_0x120caf,await _0x131406['save']();let _0x3d279f=new Date(),_0x374fef=('0'+_0x3d279f[_0x3dc0b4(0x2ca)]())[_0x3dc0b4(0x219)](-0x2),_0x3b5abc=('0'+(_0x3d279f['getMonth']()+0x1))['slice'](-0x2),_0x233303=_0x3d279f[_0x3dc0b4(0x279)](),_0x5350c5=_0x233303+'-'+_0x3b5abc+'-'+_0x374fef;const _0x2910dd=new customer_payment({'invoice':_0x28fba7,'date':_0x233303+'-'+_0x3b5abc+'-'+_0x374fef,'customer':_0x3318a9,'reason':_0x3dc0b4(0x28c),'amount':_0x3f9ea6}),_0x21dd46=await _0x2910dd[_0x3dc0b4(0x2b7)]();_0x2016eb[_0x3dc0b4(0x22a)]('success',_0x3dc0b4(0x251)),_0x5b4fa6[_0x3dc0b4(0x272)](_0x3dc0b4(0x2b8));}catch(_0x2a8da5){console[_0x3dc0b4(0x1dc)](_0x2a8da5);}}),router[a0_0x3b7305(0x27c)](a0_0x3b7305(0x2e4),auth,async(_0x2e5882,_0x400a7e)=>{var _0x5630f4=a0_0x3b7305;try{const {username:_0x56b123,email:_0x15805c,role:_0x35c5a2}=_0x2e5882[_0x5630f4(0x2cb)],_0x340233=_0x2e5882[_0x5630f4(0x2cb)],_0x961631=await profile[_0x5630f4(0x2e7)]({'email':_0x340233[_0x5630f4(0x26d)]}),_0x3cc506=await master_shop[_0x5630f4(0x23a)]();console[_0x5630f4(0x1dc)](_0x5630f4(0x237),_0x3cc506);const _0x39978a=_0x2e5882[_0x5630f4(0x2a4)]['id'],_0x37c9b6=await sales[_0x5630f4(0x227)](_0x39978a);console[_0x5630f4(0x1dc)](_0x37c9b6);const _0x13cc0d=await customer['findOne']({'name':_0x37c9b6[_0x5630f4(0x25c)]});console[_0x5630f4(0x1dc)](_0x13cc0d);if(_0x3cc506[0x0]['language']=='English\x20(US)'){var _0x36ef85=users[_0x5630f4(0x224)];console[_0x5630f4(0x1dc)](_0x36ef85);}else{if(_0x3cc506[0x0][_0x5630f4(0x288)]==_0x5630f4(0x290))var _0x36ef85=users['Hindi'];else{if(_0x3cc506[0x0][_0x5630f4(0x288)]==_0x5630f4(0x235))var _0x36ef85=users[_0x5630f4(0x235)];else{if(_0x3cc506[0x0][_0x5630f4(0x288)]=='Spanish')var _0x36ef85=users[_0x5630f4(0x218)];else{if(_0x3cc506[0x0][_0x5630f4(0x288)]=='French')var _0x36ef85=users[_0x5630f4(0x20e)];else{if(_0x3cc506[0x0][_0x5630f4(0x288)]==_0x5630f4(0x21e))var _0x36ef85=users[_0x5630f4(0x2ea)];else{if(_0x3cc506[0x0][_0x5630f4(0x288)]=='Chinese')var _0x36ef85=users[_0x5630f4(0x2b9)];else{if(_0x3cc506[0x0][_0x5630f4(0x288)]==_0x5630f4(0x1f3))var _0x36ef85=users[_0x5630f4(0x1f8)];}}}}}}}_0x400a7e[_0x5630f4(0x1eb)](_0x5630f4(0x240),{'success':_0x2e5882[_0x5630f4(0x22a)]('success'),'errors':_0x2e5882['flash'](_0x5630f4(0x27b)),'role':_0x340233,'profile':_0x961631,'master_shop':_0x3cc506,'customers':_0x13cc0d,'sales':_0x37c9b6,'language':_0x36ef85});}catch(_0x4ca92c){console['log'](_0x4ca92c);}}),router['get'](a0_0x3b7305(0x228),auth,async(_0x50dd6a,_0x1e8e2f)=>{var _0xe414d6=a0_0x3b7305;try{const {username:_0x47192a,email:_0xf4a42c,role:_0x40e1a9}=_0x50dd6a[_0xe414d6(0x2cb)],_0x310c08=_0x50dd6a[_0xe414d6(0x2cb)],_0x5ceb3d=await profile[_0xe414d6(0x2e7)]({'email':_0x310c08['email']}),_0x7563ba=await master_shop[_0xe414d6(0x23a)]();console[_0xe414d6(0x1dc)](_0xe414d6(0x237),_0x7563ba);const _0x50f93e=_0x50dd6a[_0xe414d6(0x2a4)]['id'];console[_0xe414d6(0x1dc)](_0x50f93e);const _0x397cc9=await sales[_0xe414d6(0x227)](_0x50f93e);console['log'](_0xe414d6(0x1fe),_0x397cc9);const _0x52bad0=await warehouse['aggregate']([{'$match':{'name':_0xe414d6(0x1fa),'room':_0xe414d6(0x200)}},{'$unwind':_0xe414d6(0x270)},{'$group':{'_id':_0xe414d6(0x243),'name':{'$first':_0xe414d6(0x245)},'product_stock':{'$first':_0xe414d6(0x297)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0xe414d6(0x2b4)},'pallet':{'$first':_0xe414d6(0x2de)},'primary_code':{'$first':_0xe414d6(0x23e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xe414d6(0x203)}}}]);console[_0xe414d6(0x1dc)](_0xe414d6(0x1ef),_0x52bad0);const _0x4f0555=await product[_0xe414d6(0x23a)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0xe414d6(0x248),'name':'Return\x20Goods','warehouse_category':_0xe414d6(0x2cd)}},{'$group':{'_id':_0xe414d6(0x1e0),'name':{'$first':_0xe414d6(0x1e0)}}},{'$sort':{'name':0x1}}]);var _0x1c3e84=[_0xe414d6(0x200)];if(_0x7563ba[0x0][_0xe414d6(0x288)]==_0xe414d6(0x2e2)){var _0x1607e6=users[_0xe414d6(0x224)];console[_0xe414d6(0x1dc)](_0x1607e6);}else{if(_0x7563ba[0x0][_0xe414d6(0x288)]=='Hindi')var _0x1607e6=users[_0xe414d6(0x290)];else{if(_0x7563ba[0x0]['language']=='German')var _0x1607e6=users[_0xe414d6(0x235)];else{if(_0x7563ba[0x0][_0xe414d6(0x288)]==_0xe414d6(0x218))var _0x1607e6=users[_0xe414d6(0x218)];else{if(_0x7563ba[0x0]['language']==_0xe414d6(0x20e))var _0x1607e6=users['French'];else{if(_0x7563ba[0x0][_0xe414d6(0x288)]==_0xe414d6(0x21e))var _0x1607e6=users['Portuguese'];else{if(_0x7563ba[0x0]['language']==_0xe414d6(0x2b9))var _0x1607e6=users['Chinese'];else{if(_0x7563ba[0x0][_0xe414d6(0x288)]==_0xe414d6(0x1f3))var _0x1607e6=users['Arabic'];}}}}}}}_0x1e8e2f[_0xe414d6(0x1eb)](_0xe414d6(0x265),{'success':_0x50dd6a[_0xe414d6(0x22a)]('success'),'errors':_0x50dd6a['flash'](_0xe414d6(0x27b)),'role':_0x310c08,'profile':_0x5ceb3d,'user':_0x397cc9,'stock':_0x52bad0,'master_shop':_0x7563ba,'unit':_0x4f0555,'language':_0x1607e6,'warehouses':warehouse_data,'rooms':_0x1c3e84});}catch(_0x1fd78b){console['log'](_0x1fd78b),_0x1e8e2f[_0xe414d6(0x27e)](0xc8)[_0xe414d6(0x267)]({'message':_0x1fd78b[_0xe414d6(0x29f)]});}}),router[a0_0x3b7305(0x289)](a0_0x3b7305(0x228),auth,async(_0x2b057c,_0x1a792e)=>{var _0x752023=a0_0x3b7305;try{const {invoice:_0x2fca04,date:_0x11b7c8,warehouse_name:_0x582708,product_name:_0x455a0a,primary_code:_0x5b63cf,secondary_code:_0x231dcb,product_code:_0xa13129,sales_quantity:_0x5cd4de,stocks:_0x5de323,return_qty:_0x54b683,Room_name:_0x5b402d,to_warehouse_name:_0x32acc8,to_Roomname:_0x1deaf3,to_Room_name:_0x556cbd,note:_0x38da5e,level:_0x3ff9c8,isle:_0x2f68b5,pallet:_0xa3f237}=_0x2b057c[_0x752023(0x25f)];if(typeof _0x455a0a=='string')var _0x4a6161=[_0x2b057c[_0x752023(0x25f)][_0x752023(0x298)]],_0x55be88=[_0x2b057c[_0x752023(0x25f)]['primary_code']],_0x19e661=[_0x2b057c[_0x752023(0x25f)][_0x752023(0x242)]],_0x1960be=[_0x2b057c[_0x752023(0x25f)]['product_code']],_0x5339e1=[_0x2b057c['body']['sales_quantity']],_0x569f11=[_0x2b057c[_0x752023(0x25f)][_0x752023(0x21f)]],_0x50b8a4=[_0x2b057c['body']['return_qty']],_0x7d789d=[_0x2b057c[_0x752023(0x25f)][_0x752023(0x2a9)]],_0x39bf14=[_0x2b057c[_0x752023(0x25f)]['bin']],_0x558325=[_0x2b057c[_0x752023(0x25f)][_0x752023(0x2e0)]],_0x39d830=[_0x2b057c['body'][_0x752023(0x2e5)]];else var _0x4a6161=[..._0x2b057c['body'][_0x752023(0x298)]],_0x55be88=[..._0x2b057c['body'][_0x752023(0x262)]],_0x19e661=[..._0x2b057c[_0x752023(0x25f)][_0x752023(0x242)]],_0x1960be=[..._0x2b057c['body'][_0x752023(0x239)]],_0x5339e1=[..._0x2b057c['body'][_0x752023(0x1fc)]],_0x569f11=[..._0x2b057c[_0x752023(0x25f)][_0x752023(0x21f)]],_0x50b8a4=[..._0x2b057c[_0x752023(0x25f)][_0x752023(0x207)]],_0x7d789d=[..._0x2b057c[_0x752023(0x25f)][_0x752023(0x2a9)]],_0x39bf14=[..._0x2b057c[_0x752023(0x25f)]['bin']],_0x558325=[..._0x2b057c[_0x752023(0x25f)]['types']],_0x39d830=[..._0x2b057c[_0x752023(0x25f)][_0x752023(0x2e5)]];const _0x291b78=_0x4a6161[_0x752023(0x257)](_0xff1745=>{return _0xff1745={'product_name':_0xff1745};});_0x55be88[_0x752023(0x26c)]((_0x3f8470,_0x31169a)=>{var _0x1ed0f8=_0x752023;_0x291b78[_0x31169a][_0x1ed0f8(0x262)]=_0x3f8470;}),_0x19e661[_0x752023(0x26c)]((_0x205859,_0x6e0cd8)=>{var _0xce1376=_0x752023;_0x291b78[_0x6e0cd8][_0xce1376(0x242)]=_0x205859;}),_0x1960be['forEach']((_0x28713b,_0x2018a6)=>{var _0x53fbaf=_0x752023;_0x291b78[_0x2018a6][_0x53fbaf(0x239)]=_0x28713b;}),_0x5339e1['forEach']((_0x23a229,_0x30161a)=>{var _0x45565f=_0x752023;_0x291b78[_0x30161a][_0x45565f(0x1ec)]=_0x23a229;}),_0x569f11[_0x752023(0x26c)]((_0x30c134,_0x18b5d9)=>{var _0x108e33=_0x752023;_0x291b78[_0x18b5d9][_0x108e33(0x2d8)]=_0x30c134;}),_0x50b8a4['forEach']((_0x5122c6,_0x44661e)=>{var _0x3edc46=_0x752023;_0x291b78[_0x44661e][_0x3edc46(0x207)]=_0x5122c6;}),_0x7d789d[_0x752023(0x26c)]((_0x2ec27b,_0x342b54)=>{_0x291b78[_0x342b54]['bay']=_0x2ec27b;}),_0x39bf14[_0x752023(0x26c)]((_0x2bb573,_0x42d99b)=>{var _0x38bdc6=_0x752023;_0x291b78[_0x42d99b][_0x38bdc6(0x20c)]=_0x2bb573;}),_0x558325['forEach']((_0x23aa29,_0x491fc4)=>{var _0x4feada=_0x752023;_0x291b78[_0x491fc4][_0x4feada(0x2d3)]=_0x23aa29;}),_0x39d830[_0x752023(0x26c)]((_0x13d154,_0x3ebeae)=>{_0x291b78[_0x3ebeae]['floorlevel']=_0x13d154;});var _0x40231c=0x0;_0x291b78[_0x752023(0x26c)](_0x5cd099=>{var _0x2cccd5=_0x752023;console[_0x2cccd5(0x1dc)](_0x2cccd5(0x231),_0x5cd099),(parseInt(_0x5cd099[_0x2cccd5(0x1ec)])<parseInt(_0x5cd099[_0x2cccd5(0x207)])||parseInt(_0x5cd099[_0x2cccd5(0x2d8)])<parseInt(_0x5cd099[_0x2cccd5(0x207)])&&parseInt(_0x5cd099[_0x2cccd5(0x1ec)])>parseInt(_0x5cd099[_0x2cccd5(0x207)])||parseInt(_0x5cd099[_0x2cccd5(0x207)])==0x0)&&_0x40231c++;});if(_0x40231c!=0x0)return _0x2b057c['flash'](_0x752023(0x27b),_0x752023(0x21d)),_0x1a792e[_0x752023(0x272)]('back');const _0x53cdde=await sales[_0x752023(0x2e7)]({'invoice':_0x2fca04});console[_0x752023(0x1dc)](_0x53cdde),_0x53cdde[_0x752023(0x2bf)]=_0x752023(0x2c7);const _0x25afcf=await _0x53cdde[_0x752023(0x2b7)](),_0x4640da=new sales_return({'invoice':_0x2fca04,'customer':_0x2b057c[_0x752023(0x25f)]['customer'],'date':_0x11b7c8,'warehouse_name':_0x582708,'room':_0x5b402d,'ToWarehouse':_0x32acc8,'ToRoom':_0x556cbd,'return_sale':_0x291b78,'note':_0x38da5e}),_0x4a88a2=await _0x4640da[_0x752023(0x2b7)]();console[_0x752023(0x1dc)](_0x4640da);const _0x24c955=await sales_return[_0x752023(0x2e7)]({'invoice':_0x2fca04}),_0x494f80=await warehouse[_0x752023(0x2e7)]({'name':_0x32acc8,'room':_0x556cbd});_0x24c955[_0x752023(0x265)]['forEach'](_0x414aef=>{var _0x52c748=_0x752023,_0x40fe5c=0x0;const _0xed571d=_0x494f80[_0x52c748(0x2a3)][_0x52c748(0x257)](_0x34c4b5=>{var _0x112bd3=_0x52c748;_0x34c4b5[_0x112bd3(0x298)]==_0x414aef[_0x112bd3(0x298)]&&_0x34c4b5[_0x112bd3(0x2e5)]==_0x414aef['floorlevel']&&_0x34c4b5[_0x112bd3(0x2d3)]==_0x414aef[_0x112bd3(0x2d3)]&&_0x34c4b5[_0x112bd3(0x20c)]==_0x414aef[_0x112bd3(0x20c)]&&_0x34c4b5[_0x112bd3(0x2a9)]==_0x414aef[_0x112bd3(0x2a9)]&&(_0x34c4b5[_0x112bd3(0x22c)]=parseInt(_0x34c4b5['product_stock'])+parseInt(_0x414aef[_0x112bd3(0x207)]),_0x40fe5c++);});_0x40fe5c=='0'&&(_0x494f80[_0x52c748(0x2a3)]=_0x494f80[_0x52c748(0x2a3)][_0x52c748(0x1f9)]({'product_name':_0x414aef[_0x52c748(0x298)],'product_stock':_0x414aef[_0x52c748(0x207)],'primary_code':_0x414aef[_0x52c748(0x262)],'secondary_code':_0x414aef['secondary_code'],'product_code':_0x414aef[_0x52c748(0x239)],'bay':_0x414aef[_0x52c748(0x2a9)],'bin':_0x414aef[_0x52c748(0x20c)],'type':_0x414aef[_0x52c748(0x2d3)],'floorlevel':_0x414aef[_0x52c748(0x2e5)]})),console['log'](_0x52c748(0x2ac),_0x494f80);}),await _0x494f80[_0x752023(0x2b7)](),console[_0x752023(0x1dc)](_0x2b057c[_0x752023(0x25f)]);const _0x2eca41=new c_payment_data({'invoice':_0x2fca04,'customer':_0x2b057c['body'][_0x752023(0x25c)],'reason':_0x752023(0x2ab)});await _0x2eca41['save']();const _0x3f8305=await master_shop['find']();console[_0x752023(0x1dc)]('add\x20post',_0x3f8305[0x0]['image']);const _0x5a05fc=await email_settings['findOne'](),_0x849141=await customer['findOne']({'name':_0x2b057c[_0x752023(0x25f)][_0x752023(0x25c)]});console['log']('customer_data',_0x849141);_0x3f8305[0x0][_0x752023(0x2a8)]==0x1?(right_currency=_0x3f8305[0x0][_0x752023(0x2b2)],left_currency=''):(right_currency='',left_currency=_0x3f8305[0x0][_0x752023(0x2b2)]);var _0xc0f08a=_0x4a6161,_0x42dba4=_0x50b8a4,_0x2d959f='',_0x3e4c18;for(_0x3e4c18 in _0xc0f08a){_0x2d959f+=_0x752023(0x217)+_0x752023(0x1ed)+_0xc0f08a[_0x3e4c18]+_0x752023(0x2da)+_0x752023(0x1ed)+_0x42dba4[_0x3e4c18]+_0x752023(0x2da)+_0x752023(0x255);}console[_0x752023(0x1dc)](_0x752023(0x287),_0x2d959f);let _0x28f929=nodemailer['createTransport']({'service':_0x752023(0x2ce),'auth':{'user':_0x5a05fc[_0x752023(0x26d)],'pass':_0x5a05fc[_0x752023(0x1db)]}}),_0x19e0d8={'from':_0x5a05fc[_0x752023(0x26d)],'to':_0x849141[_0x752023(0x26d)],'subject':_0x752023(0x216),'attachments':[{'filename':_0x752023(0x1f6),'path':__dirname+_0x752023(0x1d9)+_0x752023(0x238)+_0x3f8305[0x0][_0x752023(0x259)],'cid':_0x752023(0x28d)}],'html':'<!DOCTYPE\x20html>'+_0x752023(0x2ae)+'</head><body>'+'<div>'+_0x752023(0x260)+_0x752023(0x1f0)+_0x752023(0x296)+_0x752023(0x24e)+_0x752023(0x1f0)+'<h2>\x20'+_0x3f8305[0x0][_0x752023(0x2b5)]+_0x752023(0x286)+_0x752023(0x24e)+_0x752023(0x24e)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x752023(0x214)+_0x2fca04+'\x20'+_0x752023(0x229)+'\x20Order\x20Date\x20:\x20'+_0x11b7c8+'\x20'+'</span>'+'</h5>'+_0x752023(0x24e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x752023(0x271)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x752023(0x1de)+_0x752023(0x29e)+_0x752023(0x28f)+'</tr>'+_0x752023(0x2d7)+_0x752023(0x25e)+'\x20'+_0x2d959f+'\x20'+_0x752023(0x2a1)+'</table>'+_0x752023(0x1f0)+_0x752023(0x254)+_0x752023(0x282)+_0x3f8305[0x0][_0x752023(0x2b5)]+_0x752023(0x29d)+_0x752023(0x24e)+_0x752023(0x24e)+_0x752023(0x1f5)};_0x28f929[_0x752023(0x2c3)](_0x19e0d8,function(_0x5c0ca6,_0x11eac4){var _0x44ba54=_0x752023;_0x5c0ca6?(console['log'](_0x5c0ca6),console[_0x44ba54(0x1dc)](_0x44ba54(0x246))):console[_0x44ba54(0x1dc)](_0x44ba54(0x2b6));}),_0x2b057c['flash'](_0x752023(0x28a),_0x752023(0x23c)),_0x1a792e[_0x752023(0x272)](_0x752023(0x2b8));}catch(_0x1c82d0){console[_0x752023(0x1dc)](_0x1c82d0),_0x1a792e[_0x752023(0x27e)](0xc8)[_0x752023(0x267)]({'message1':_0x1c82d0[_0x752023(0x29f)]});}}),router[a0_0x3b7305(0x27c)]('/barcode/:id',auth,async(_0x13251e,_0x3238a1)=>{var _0x267379=a0_0x3b7305;try{const {username:_0x43ca65,email:_0x559f91,role:_0x57ca19}=_0x13251e[_0x267379(0x2cb)],_0x82729c=_0x13251e[_0x267379(0x2cb)],_0x83eac5=await profile[_0x267379(0x2e7)]({'email':_0x82729c[_0x267379(0x26d)]}),_0x22825f=await master_shop['find']();console[_0x267379(0x1dc)](_0x267379(0x26b),_0x22825f);const _0x15fa3=_0x13251e['params']['id'],_0x11fe13=await sales[_0x267379(0x227)](_0x15fa3);console[_0x267379(0x1dc)]('barcode\x20user_id',_0x11fe13);if(_0x22825f[0x0][_0x267379(0x288)]=='English\x20(US)')var _0x381ab4=users[_0x267379(0x224)];else{if(_0x22825f[0x0][_0x267379(0x288)]==_0x267379(0x290))var _0x381ab4=users['Hindi'];else{if(_0x22825f[0x0][_0x267379(0x288)]=='German')var _0x381ab4=users[_0x267379(0x235)];else{if(_0x22825f[0x0][_0x267379(0x288)]==_0x267379(0x218))var _0x381ab4=users['Spanish'];else{if(_0x22825f[0x0][_0x267379(0x288)]==_0x267379(0x20e))var _0x381ab4=users[_0x267379(0x20e)];else{if(_0x22825f[0x0][_0x267379(0x288)]==_0x267379(0x21e))var _0x381ab4=users[_0x267379(0x2ea)];else{if(_0x22825f[0x0][_0x267379(0x288)]==_0x267379(0x2b9))var _0x381ab4=users[_0x267379(0x2b9)];else{if(_0x22825f[0x0][_0x267379(0x288)]==_0x267379(0x1f3))var _0x381ab4=users[_0x267379(0x1f8)];}}}}}}}_0x3238a1[_0x267379(0x1eb)](_0x267379(0x2d5),{'success':_0x13251e[_0x267379(0x22a)](_0x267379(0x28a)),'errors':_0x13251e[_0x267379(0x22a)]('errors'),'role':_0x82729c,'profile':_0x83eac5,'alldata':_0x11fe13,'master_shop':_0x22825f,'language':_0x381ab4});}catch(_0x439002){console['log'](_0x439002);}}),router[a0_0x3b7305(0x289)](a0_0x3b7305(0x234),async(_0x55f628,_0x27e7b0)=>{var _0x482249=a0_0x3b7305;const {product_code:_0x441bee,warehouse_name:_0x3622c0,rooms_data:_0x49321d,Roomslist:_0x4ba73d}=_0x55f628['body'],_0x5757dc=_0x4ba73d[_0x482249(0x201)](','),_0x364213=[];async function _0x42f43e(_0xcf515b){var _0x40ca70=_0x482249;const _0x2749cf=await warehouse[_0x40ca70(0x285)]([{'$match':{'name':_0x3622c0,'room':_0xcf515b}},{'$unwind':_0x40ca70(0x270)},{'$match':{'product_details.primary_code':_0x441bee}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x40ca70(0x245)},'product_stock':{'$first':_0x40ca70(0x297)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x40ca70(0x263)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x40ca70(0x2ba)},'isle':{'$first':_0x40ca70(0x2e9)},'type':{'$first':_0x40ca70(0x24a)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x40ca70(0x25a)},'secondary_unit':{'$first':_0x40ca70(0x2dc)},'storage':{'$first':_0x40ca70(0x2c0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x40ca70(0x293)},'production_date':{'$first':_0x40ca70(0x250)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x40ca70(0x2a6)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x40ca70(0x1e1)},'invoice':{'$first':_0x40ca70(0x2a2)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x40ca70(0x2e8)}}}]),_0x551657=await warehouse[_0x40ca70(0x285)]([{'$match':{'name':_0x3622c0,'room':_0xcf515b}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x441bee}},{'$group':{'_id':_0x40ca70(0x243),'name':{'$first':_0x40ca70(0x245)},'product_stock':{'$first':_0x40ca70(0x297)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x40ca70(0x263)},'product_code':{'$first':_0x40ca70(0x203)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x40ca70(0x2e9)},'type':{'$first':_0x40ca70(0x24a)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x40ca70(0x25a)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x40ca70(0x23f)},'expiry_date':{'$first':_0x40ca70(0x293)},'production_date':{'$first':_0x40ca70(0x250)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x40ca70(0x2a6)},'product_cat':{'$first':_0x40ca70(0x1f4)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x40ca70(0x2a2)}}}]);if(_0x2749cf[_0x40ca70(0x252)]>0x0)_0x364213[_0x40ca70(0x2bd)](_0x2749cf);else _0x551657['length']>0x0&&_0x364213[_0x40ca70(0x2bd)](_0x551657);}const _0x766d06=_0x5757dc['map'](_0x310c95=>_0x42f43e(_0x310c95));await Promise[_0x482249(0x1da)](_0x766d06),_0x27e7b0[_0x482249(0x267)](_0x364213);}),module[a0_0x3b7305(0x275)]=router;