var a0_0x3d25f2=a0_0x2779;function a0_0x2779(_0xd515b8,_0x328a39){var _0x418fe1=a0_0x418f();return a0_0x2779=function(_0x277978,_0x498c98){_0x277978=_0x277978-0x1ea;var _0x35c353=_0x418fe1[_0x277978];return _0x35c353;},a0_0x2779(_0xd515b8,_0x328a39);}function a0_0x418f(){var _0x453a14=['Portuguese\x20(BR)','$product','product','Receiving\x20Area','name','$customer','<html><head><title></title>','barcode\x20Product\x20master','currency_placement','role','save','An\x20error\x20occurred\x20while\x20saving\x20data.','<tbody\x20style=\x22text-align:\x20center;\x22>','Return\x20Rooms','invoice','sales_quantity','then','False','stocks','$product_details.expiry_date','Enclosed','forEach','types','getDate','$product_details.isle','$date','Spanish','site_title','sales_invoice','366EciZiq','render','/all_sales/preview/','_id','back','payment\x20successfull','$sale_product.bay','requested_qty','$product_details.product_name','$sale_product.type','id_transact','\x20Order\x20Date\x20:\x20','add\x20post','image','$product_details.maxPerUnit','10VeMNRv','message','Arabic\x20(ae)','Hindi','Email\x20sent\x20successfully','\x20</h2>','product_name','RoomAssigned','True','customer','$product_details.production_date','string','$product_details._id','$product_details.batch_code','primary_code','5067729KgTeiK','/barcode_scanner','Portuguese','slice','</tr>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Raw\x20Materials','body','stock_data','</span>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Sales\x20Update\x20successfully','room_name','$room','purchases_data','foreach\x20newproduct','$product_details.rack','language','actual_uom','<!DOCTYPE\x20html>','push','sendMail','$product.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','bay','Shelves','$product_details','all','params','<tr>','Ambient','received_amount','An\x20error\x20occurred.','success','status','customers_docs','redirect','floorlevel','Floor','customers','getMonth','aggregate','$product_details.type','$_id','/all_sales/view','English\x20(US)','error','nodemailer','prod_cat','/view/add_sales/:id','$product_details.bay','note','logo','Sales\x20Mail','/give_payment/:id','English','\x20Order\x20Number\x20:\x20','add_sales','$return_data','Level','</div>','281vJvmFI','$product_details.invoice','filter','port','quantity_notConverted','get','Return\x20Goods','$product_details.bin','38110pqNmts','sales\x20item\x20return\x20successfull','Router','$product_details.actual_qty','$product_details.actual_uom','edit_sales','max_per_unit','product_stock','findOne','toString','$product_details.pallet','$sale_product','German','703746dastSi','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_invoice','rack','abs','findById','</tbody>','staff','/view','host','$finalize','/../public','length','$note','$customers_docs','post','level','flash','barcode\x20user_id','delivery_date','Arabic','<hr\x20class=\x22my-3\x22>','Sale\x20Return\x20Mail','/invoice/:id','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<h5\x20style=\x22text-align:\x20left;\x22>','<h5>','id_transaction_from','</thead>','product_details','express','sale_product','/upload/','return_sale','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$name','French','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_data','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','../middleware/auth','$product_details.storage','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','password','customer_data','type','<strong>\x20Regards\x20</strong>','$isAllowEdit','</body></html>','quantity','map','</h5>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','padStart','/view/:id','$product_details.product_code','Sale\x20Return','all_sales','master','batch_code','stock','</table>','storage','1799300YzpPvB','$product_details.level','exports','due_amount','finalize','$product_details.secondary_code','$product_details.primary_code','/view/add_sales','production_date','<div>','/view/return_sales/:id','bin','currency','Enabled','prod_code','expiry_date','gmail','log','delivery_code','$sale_product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','room','primary_unit','SCRN','date','$sale_product.quantity','max','<h2>\x20','../models/all_models','$product_details.unit','sales\x20all_data','<span\x20style=\x22float:\x20right;\x22>','warehouse_name','split','Sales\x20Add\x20successfully','$product_details.product_cat','find','carton','json','catch','secondary_unit','email','actual_qty','Error\x20Occurs','unit','2350432CeqCtw','createTransport','return_qty','There\x27s\x20a\x20error\x20in\x20this\x20transaction','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Chinese','errors','edit_sales_view','final','$product_details.product_stock','OUT-','user_id','product_code','905824eVMNQM','$product_details.secondary_unit','$product_details.floorlevel','secondary_code','/preview/:id','getFullYear','</td>','floor','834jIKBAo','sale_qty','Logo.png'];a0_0x418f=function(){return _0x453a14;};return a0_0x418f();}(function(_0x1fcd6c,_0x4842ce){var _0x5c8357=a0_0x2779,_0x3e52ee=_0x1fcd6c();while(!![]){try{var _0x1991fa=parseInt(_0x5c8357(0x2da))/0x1*(-parseInt(_0x5c8357(0x25f))/0x2)+parseInt(_0x5c8357(0x2ef))/0x3+-parseInt(_0x5c8357(0x21c))/0x4+parseInt(_0x5c8357(0x2e2))/0x5*(parseInt(_0x5c8357(0x27f))/0x6)+-parseInt(_0x5c8357(0x249))/0x7+-parseInt(_0x5c8357(0x257))/0x8+-parseInt(_0x5c8357(0x29d))/0x9*(-parseInt(_0x5c8357(0x28e))/0xa);if(_0x1991fa===_0x4842ce)break;else _0x3e52ee['push'](_0x3e52ee['shift']());}catch(_0x2c9947){_0x3e52ee['push'](_0x3e52ee['shift']());}}}(a0_0x418f,0x3c347));const express=require(a0_0x3d25f2(0x1f8)),app=express(),router=express[a0_0x3d25f2(0x2e4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x3d25f2(0x238)),auth=require(a0_0x3d25f2(0x204)),nodemailer=require(a0_0x3d25f2(0x2cc)),users=require('../public/language/languages.json');router[a0_0x3d25f2(0x2df)](a0_0x3d25f2(0x2f8),auth,async(_0x232334,_0x2ac69d)=>{var _0x3dcfee=a0_0x3d25f2;try{const {username:_0x50c886,email:_0x171af0,role:_0xb44692}=_0x232334[_0x3dcfee(0x202)],_0x5bf0ca=_0x232334[_0x3dcfee(0x202)],_0x4b2415=await profile[_0x3dcfee(0x2ea)]({'email':_0x5bf0ca[_0x3dcfee(0x245)]}),_0x29cb1a=await master_shop[_0x3dcfee(0x240)]();let _0x4ddda8;if(_0x5bf0ca['role']=='staff'){const _0x410a65=await staff[_0x3dcfee(0x2ea)]({'email':_0x5bf0ca[_0x3dcfee(0x245)]});_0x4ddda8=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x3dcfee(0x297),'foreignField':_0x3dcfee(0x266),'as':'customers_docs'}},{'$unwind':_0x3dcfee(0x2fe)},{'$unwind':_0x3dcfee(0x2ed)},{'$group':{'_id':_0x3dcfee(0x2c8),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3dcfee(0x267)},'date':{'$first':_0x3dcfee(0x27b)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3dcfee(0x2ed)},'note':{'$first':_0x3dcfee(0x2fd)},'return_data':{'$first':_0x3dcfee(0x2d7)},'customers_docs':{'$first':_0x3dcfee(0x2fe)},'total_saleproduct_quantity':{'$sum':_0x3dcfee(0x235)},'level':{'$addToSet':_0x3dcfee(0x285)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3dcfee(0x288)},'pallet':{'$addToSet':_0x3dcfee(0x22f)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x3dcfee(0x20c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4ddda8=await sales[_0x3dcfee(0x2c6)]([{'$lookup':{'from':_0x3dcfee(0x2c4),'localField':_0x3dcfee(0x297),'foreignField':'name','as':_0x3dcfee(0x2c0)}},{'$unwind':_0x3dcfee(0x2fe)},{'$unwind':_0x3dcfee(0x2ed)},{'$group':{'_id':_0x3dcfee(0x2c8),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3dcfee(0x267)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3dcfee(0x2ed)},'note':{'$first':'$note'},'return_data':{'$first':_0x3dcfee(0x2d7)},'customers_docs':{'$first':_0x3dcfee(0x2fe)},'total_saleproduct_quantity':{'$sum':_0x3dcfee(0x235)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3dcfee(0x288)},'pallet':{'$addToSet':_0x3dcfee(0x22f)},'finalize':{'$first':_0x3dcfee(0x2fa)},'isAllowEdit':{'$first':_0x3dcfee(0x20c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3dcfee(0x22d)](_0x3dcfee(0x23a),_0x4ddda8);if(_0x29cb1a[0x0][_0x3dcfee(0x2ae)]==_0x3dcfee(0x2ca)){var _0x59d444=users[_0x3dcfee(0x2d4)];console['log'](_0x59d444);}else{if(_0x29cb1a[0x0][_0x3dcfee(0x2ae)]==_0x3dcfee(0x291))var _0x59d444=users['Hindi'];else{if(_0x29cb1a[0x0]['language']==_0x3dcfee(0x2ee))var _0x59d444=users['German'];else{if(_0x29cb1a[0x0][_0x3dcfee(0x2ae)]=='Spanish')var _0x59d444=users[_0x3dcfee(0x27c)];else{if(_0x29cb1a[0x0][_0x3dcfee(0x2ae)]=='French')var _0x59d444=users[_0x3dcfee(0x1fe)];else{if(_0x29cb1a[0x0][_0x3dcfee(0x2ae)]==_0x3dcfee(0x262))var _0x59d444=users[_0x3dcfee(0x29f)];else{if(_0x29cb1a[0x0]['language']==_0x3dcfee(0x24f))var _0x59d444=users[_0x3dcfee(0x24f)];else{if(_0x29cb1a[0x0]['language']=='Arabic\x20(ae)')var _0x59d444=users[_0x3dcfee(0x1ee)];}}}}}}}_0x2ac69d[_0x3dcfee(0x280)](_0x3dcfee(0x216),{'success':_0x232334[_0x3dcfee(0x1eb)](_0x3dcfee(0x2be)),'errors':_0x232334[_0x3dcfee(0x1eb)](_0x3dcfee(0x250)),'sales':_0x4ddda8,'profile':_0x4b2415,'role':_0x5bf0ca,'master_shop':_0x29cb1a,'language':_0x59d444});}catch(_0x19db1f){console[_0x3dcfee(0x22d)](_0x19db1f);}});async function getRandom8DigitNumber(){var _0x37e4d5=a0_0x3d25f2;const _0x5601f2=0x989680,_0x32811c=0x5f5e0ff,_0x4f4d9f=Math[_0x37e4d5(0x25e)](Math['random']()*(_0x32811c-_0x5601f2+0x1))+_0x5601f2;var _0x5b86cd;const _0x3b4b50=await sales[_0x37e4d5(0x2ea)]({'invoice':_0x37e4d5(0x254)+_0x4f4d9f});return _0x3b4b50&&_0x3b4b50[_0x37e4d5(0x2fc)]>0x0?_0x5b86cd=_0x37e4d5(0x254)+_0x4f4d9f:_0x5b86cd=_0x37e4d5(0x254)+_0x4f4d9f,_0x5b86cd;}router['get']('/view/add_sales',auth,async(_0x69d05a,_0x13ad0d)=>{var _0x5a4528=a0_0x3d25f2;try{const {username:_0x242ca6,email:_0xcbc445,role:_0x3b7c48}=_0x69d05a[_0x5a4528(0x202)],_0x219d95=_0x69d05a['user'],_0x49de18=await profile[_0x5a4528(0x2ea)]({'email':_0x219d95[_0x5a4528(0x245)]}),_0x37a5fd=await master_shop[_0x5a4528(0x240)](),_0x2f6fcf=await customer[_0x5a4528(0x240)]({});let _0x19c879;if(_0x219d95[_0x5a4528(0x26b)]==_0x5a4528(0x2f7)){const _0x36f885=await staff[_0x5a4528(0x2ea)]({'email':_0x219d95['email']});_0x19c879=await warehouse[_0x5a4528(0x2c6)]([{'$match':{'status':_0x5a4528(0x229),'name':_0x36f885[_0x5a4528(0x1ff)],'warehouse_category':_0x5a4528(0x2a3),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x5a4528(0x1fd),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x19c879=await warehouse[_0x5a4528(0x2c6)]([{'$match':{'status':_0x5a4528(0x229),'warehouse_category':_0x5a4528(0x2a3),'name':{'$ne':_0x5a4528(0x2e0)}}},{'$group':{'_id':_0x5a4528(0x1fd),'name':{'$first':_0x5a4528(0x1fd)}}},{'$sort':{'name':0x1}}]);const _0x3548c1=await product[_0x5a4528(0x240)]({});var _0x3b6fbb=['Ambient',_0x5a4528(0x276)];const _0xf78ef1=await sales[_0x5a4528(0x240)]({}),_0x48297a=_0xf78ef1[_0x5a4528(0x2fc)]+0x1,_0x217333=_0x5a4528(0x254)+_0x48297a[_0x5a4528(0x2eb)]()[_0x5a4528(0x212)](0x5,'0');if(_0x37a5fd[0x0][_0x5a4528(0x2ae)]==_0x5a4528(0x2ca)){var _0x225b8a=users[_0x5a4528(0x2d4)];console[_0x5a4528(0x22d)](_0x225b8a);}else{if(_0x37a5fd[0x0][_0x5a4528(0x2ae)]=='Hindi')var _0x225b8a=users[_0x5a4528(0x291)];else{if(_0x37a5fd[0x0][_0x5a4528(0x2ae)]==_0x5a4528(0x2ee))var _0x225b8a=users[_0x5a4528(0x2ee)];else{if(_0x37a5fd[0x0][_0x5a4528(0x2ae)]==_0x5a4528(0x27c))var _0x225b8a=users['Spanish'];else{if(_0x37a5fd[0x0][_0x5a4528(0x2ae)]==_0x5a4528(0x1fe))var _0x225b8a=users['French'];else{if(_0x37a5fd[0x0]['language']=='Portuguese\x20(BR)')var _0x225b8a=users['Portuguese'];else{if(_0x37a5fd[0x0][_0x5a4528(0x2ae)]==_0x5a4528(0x24f))var _0x225b8a=users[_0x5a4528(0x24f)];else{if(_0x37a5fd[0x0]['language']==_0x5a4528(0x290))var _0x225b8a=users[_0x5a4528(0x1ee)];}}}}}}}const _0x597b11=getRandom8DigitNumber();_0x597b11[_0x5a4528(0x272)](_0x5ebcec=>{var _0x39b7e2=_0x5a4528;_0x13ad0d[_0x39b7e2(0x280)](_0x39b7e2(0x2d6),{'success':_0x69d05a[_0x39b7e2(0x1eb)](_0x39b7e2(0x2be)),'errors':_0x69d05a['flash'](_0x39b7e2(0x250)),'role':_0x219d95,'profile':_0x49de18,'customer':_0x2f6fcf,'warehouse':_0x19c879,'product':_0x3548c1,'invoice':_0x5ebcec,'master_shop':_0x37a5fd,'language':_0x225b8a,'rooms_data':_0x3b6fbb});})['catch'](_0x527e74=>{var _0x5acc64=_0x5a4528;_0x69d05a[_0x5acc64(0x1eb)](_0x5acc64(0x250),_0x5acc64(0x24c)),_0x13ad0d['redirect'](_0x5acc64(0x2c9));});}catch(_0x572cb1){console[_0x5a4528(0x22d)](_0x572cb1);}}),router[a0_0x3d25f2(0x2df)](a0_0x3d25f2(0x2ce),auth,async(_0x126b87,_0x472457)=>{var _0x187bc7=a0_0x3d25f2;try{const _0x52bccc=_0x126b87[_0x187bc7(0x2b9)]['id'];console['log'](_0x52bccc);const _0x4e7c9e=await product['find'](),_0x271419=await purchases['aggregate']([{'$match':{'warehouse_name':_0x52bccc}},{'$unwind':_0x187bc7(0x263)},{'$group':{'_id':_0x187bc7(0x2b3)}}]);console[_0x187bc7(0x22d)](_0x187bc7(0x2ab),_0x271419),_0x472457[_0x187bc7(0x2bf)](0xc8)[_0x187bc7(0x242)]({'purchases_data':_0x271419,'product_data':_0x4e7c9e});}catch(_0xf73b27){console[_0x187bc7(0x22d)](_0xf73b27);}}),router[a0_0x3d25f2(0x2ff)]('/view/add_sale/product',auth,async(_0x36e775,_0x31617b)=>{var _0x28b3dc=a0_0x3d25f2;try{const {warehouse_data:_0x5b8f13,product_data:_0x56880f}=_0x36e775[_0x28b3dc(0x2a4)];console['log'](_0x36e775[_0x28b3dc(0x2a4)][_0x28b3dc(0x201)]);;const _0x239e34=await master_shop[_0x28b3dc(0x240)]();console[_0x28b3dc(0x22d)](_0x28b3dc(0x217),_0x239e34);const _0x2ed2aa=await product[_0x28b3dc(0x2ea)]({'name':_0x56880f});console[_0x28b3dc(0x22d)](_0x28b3dc(0x264),_0x2ed2aa);const _0x4dbd1c=await warehouse[_0x28b3dc(0x2c6)]([{'$match':{'name':_0x5b8f13}},{'$unwind':_0x28b3dc(0x2b7)},{'$match':{'product_details.product_name':_0x56880f}},{'$group':{'_id':_0x28b3dc(0x287),'product_stock':{'$first':_0x28b3dc(0x253)}}}]);console[_0x28b3dc(0x22d)](_0x28b3dc(0x2a5),_0x4dbd1c),_0x31617b[_0x28b3dc(0x2bf)](0xc8)[_0x28b3dc(0x242)]({'master':_0x239e34,'new_product':_0x2ed2aa,'stock_data':_0x4dbd1c});}catch(_0x22dacf){console[_0x28b3dc(0x22d)](_0x22dacf);}}),router[a0_0x3d25f2(0x2ff)](a0_0x3d25f2(0x223),auth,async(_0x145c30,_0x13af67)=>{var _0x471761=a0_0x3d25f2;try{const {invoice:_0x2425d4,date:_0x3d076c,warehouse_name:_0xd0bf62,product_name:_0xa61c35,stock:_0x3a4b70,quantity:_0x3f4408,note:_0x5074bb,room:_0x528213,primary_code:_0x47f810,secondary_code:_0x596b7c,prod_code:_0x56555a,level:_0x124dbe,isle:_0xa97bbc,pallet:_0x6cb429,batch_code:_0x130a35,SCRN:_0x416f66,expiry_date:_0x4a349c}=_0x145c30[_0x471761(0x2a4)];if(typeof _0xa61c35==_0x471761(0x299))var _0x12ab1e=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x294)]],_0x2664cb=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x219)]],_0x2df464=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x241)]],_0x2f8f0e=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x29c)]],_0x3b7a3b=[_0x145c30['body'][_0x471761(0x25a)]],_0x3c188d=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x22a)]],_0x2199bc=[_0x145c30[_0x471761(0x2a4)]['level']],_0x457da7=[_0x145c30['body']['primary_unit']],_0x44d546=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x244)]],_0x8316dc=[_0x145c30['body'][_0x471761(0x218)]],_0x143d7a=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x22b)]],_0x410eed=[_0x145c30[_0x471761(0x2a4)]['max_per_unit']],_0x2ea64f=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x224)]],_0x1e0957=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x286)]],_0x4826b0=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x1ed)]],_0x585254=[_0x145c30['body'][_0x471761(0x22e)]],_0x2aad23=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x2cd)]],_0x363979=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x20e)]],_0x26f85b=[_0x145c30['body']['RoomAssigned']],_0x1e53fc=[_0x145c30['body'][_0x471761(0x2f2)]],_0x299163=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x246)]],_0x4e828e=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x2af)]],_0x4e7a69=[_0x145c30[_0x471761(0x2a4)][_0x471761(0x289)]];else var _0x12ab1e=[..._0x145c30['body'][_0x471761(0x294)]],_0x2664cb=[..._0x145c30[_0x471761(0x2a4)]['stock']],_0x2df464=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x241)]],_0x2f8f0e=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x29c)]],_0x3b7a3b=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x25a)]],_0x3c188d=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x22a)]],_0x2199bc=[..._0x145c30['body'][_0x471761(0x1ea)]],_0x457da7=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x232)]],_0x44d546=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x244)]],_0x8316dc=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x218)]],_0x143d7a=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x22b)]],_0x410eed=[..._0x145c30['body'][_0x471761(0x2e8)]],_0x2ea64f=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x224)]],_0x1e0957=[..._0x145c30['body']['requested_qty']],_0x4826b0=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x1ed)]],_0x585254=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x22e)]],_0x2aad23=[..._0x145c30['body'][_0x471761(0x2cd)]],_0x363979=[..._0x145c30['body'][_0x471761(0x20e)]],_0x26f85b=[..._0x145c30['body'][_0x471761(0x295)]],_0x1e53fc=[..._0x145c30[_0x471761(0x2a4)]['prod_invoice']],_0x299163=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x246)]],_0x4e828e=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x2af)]],_0x4e7a69=[..._0x145c30[_0x471761(0x2a4)][_0x471761(0x289)]];const _0x38b09c=_0x12ab1e['map'](_0x5ad46a=>{return _0x5ad46a={'product_name':_0x5ad46a};});_0x2664cb[_0x471761(0x277)]((_0x527857,_0xb6b58e)=>{var _0x941522=_0x471761;_0x38b09c[_0xb6b58e][_0x941522(0x219)]=Math[_0x941522(0x2f4)](_0x527857);}),_0x299163['forEach']((_0x5786f3,_0x21d18a)=>{var _0x4937bf=_0x471761;_0x38b09c[_0x21d18a][_0x4937bf(0x246)]=Math[_0x4937bf(0x2f4)](_0x5786f3);}),_0x4e828e['forEach']((_0x123e03,_0x2ddec5)=>{var _0x321911=_0x471761;_0x38b09c[_0x2ddec5][_0x321911(0x2af)]=_0x123e03;}),_0x4e7a69[_0x471761(0x277)]((_0x46e37a,_0x350820)=>{var _0x1d7267=_0x471761;_0x38b09c[_0x350820][_0x1d7267(0x1f5)]=_0x46e37a;}),_0x2df464['forEach']((_0x2184dc,_0x4914aa)=>{var _0x15ecca=_0x471761;_0x38b09c[_0x4914aa][_0x15ecca(0x20e)]=_0x2184dc;}),_0x2f8f0e[_0x471761(0x277)]((_0x32ea23,_0x168cd1)=>{_0x38b09c[_0x168cd1]['primary_code']=_0x32ea23;}),_0x3b7a3b[_0x471761(0x277)]((_0x26ca7a,_0x412080)=>{var _0xb7e8c2=_0x471761;_0x38b09c[_0x412080][_0xb7e8c2(0x25a)]=_0x26ca7a;}),_0x3c188d[_0x471761(0x277)]((_0x14a0ef,_0x536a49)=>{var _0x4384b5=_0x471761;_0x38b09c[_0x536a49][_0x4384b5(0x256)]=_0x14a0ef;}),_0x2199bc[_0x471761(0x277)]((_0x9456b2,_0x771cd5)=>{_0x26f85b['forEach']((_0x42ec4b,_0x3e4e22)=>{var _0x31076a=a0_0x2779;if(_0x42ec4b=='Receiving\x20Area'&&_0x771cd5==_0x3e4e22){var _0xd7a60e=_0x9456b2['slice'](0x3);_0x38b09c[_0x771cd5][_0x31076a(0x21b)]=_0x9456b2[0x0],_0x38b09c[_0x771cd5]['rack']=_0x9456b2[0x1],_0x38b09c[_0x771cd5][_0x31076a(0x2b5)]=0x0,_0x38b09c[_0x771cd5][_0x31076a(0x227)]=0x0,_0x38b09c[_0x771cd5][_0x31076a(0x20a)]='Floor',_0x38b09c[_0x771cd5][_0x31076a(0x2c2)]=_0xd7a60e;}else{if(_0x42ec4b==_0x31076a(0x2b6)&&_0x771cd5==_0x3e4e22){var _0xd7a60e=_0x9456b2[_0x31076a(0x2a0)](0x3);_0x38b09c[_0x771cd5][_0x31076a(0x21b)]=_0x9456b2[0x0],_0x38b09c[_0x771cd5][_0x31076a(0x2f3)]=_0x9456b2[0x1],_0x38b09c[_0x771cd5][_0x31076a(0x2b5)]=0x0,_0x38b09c[_0x771cd5][_0x31076a(0x227)]=0x0,_0x38b09c[_0x771cd5][_0x31076a(0x20a)]='Floor',_0x38b09c[_0x771cd5]['floorlevel']=_0x9456b2[0x5];}else{if(_0x771cd5==_0x3e4e22){var _0x4c5ae6;if(_0x9456b2[0x4]=='L')_0x4c5ae6='Level';else _0x9456b2[0x4]=='F'&&(_0x4c5ae6=_0x31076a(0x2c3));_0x38b09c[_0x771cd5][_0x31076a(0x21b)]=_0x9456b2[0x0],_0x38b09c[_0x771cd5][_0x31076a(0x2f3)]=_0x9456b2[0x1],_0x38b09c[_0x771cd5][_0x31076a(0x2b5)]=_0x9456b2[0x2],_0x38b09c[_0x771cd5][_0x31076a(0x227)]=_0x9456b2[0x3],_0x38b09c[_0x771cd5][_0x31076a(0x20a)]=_0x4c5ae6,_0x38b09c[_0x771cd5][_0x31076a(0x2c2)]=_0x9456b2[0x5];}}}});}),_0x457da7[_0x471761(0x277)]((_0x2a20c0,_0x72e0cd)=>{_0x38b09c[_0x72e0cd]['unit']=_0x2a20c0;}),_0x44d546[_0x471761(0x277)]((_0x2afa22,_0x1857ec)=>{var _0x11c759=_0x471761;_0x38b09c[_0x1857ec][_0x11c759(0x244)]=_0x2afa22;}),_0x8316dc[_0x471761(0x277)]((_0x29f212,_0x29a56a)=>{var _0x2f36c5=_0x471761;_0x38b09c[_0x29a56a][_0x2f36c5(0x218)]=_0x29f212;}),_0x143d7a['forEach']((_0x385812,_0x1e6e8b)=>{var _0x14e497=_0x471761;_0x38b09c[_0x1e6e8b][_0x14e497(0x22b)]=_0x385812;}),_0x410eed['forEach']((_0x469ee4,_0x3590a0)=>{_0x38b09c[_0x3590a0]['maxperunit']=_0x469ee4;}),_0x2ea64f[_0x471761(0x277)]((_0x3578a0,_0x3e3f15)=>{var _0x3b4dc6=_0x471761;_0x38b09c[_0x3e3f15][_0x3b4dc6(0x224)]=_0x3578a0;}),_0x1e0957[_0x471761(0x277)]((_0x3c2ff1,_0x4a242c)=>{var _0x4c5f55=_0x471761;_0x38b09c[_0x4a242c][_0x4c5f55(0x286)]=_0x3c2ff1;}),_0x4826b0[_0x471761(0x277)]((_0x56d7fc,_0x58c6c8)=>{var _0x8263b6=_0x471761;_0x38b09c[_0x58c6c8][_0x8263b6(0x1ed)]=_0x56d7fc;}),_0x585254[_0x471761(0x277)]((_0x25fab2,_0x4cc3a0)=>{_0x38b09c[_0x4cc3a0]['delivery_code']=_0x25fab2;}),_0x2aad23['forEach']((_0x481bd8,_0x4352a1)=>{var _0x7216d2=_0x471761;_0x38b09c[_0x4352a1][_0x7216d2(0x2cd)]=_0x481bd8;}),_0x363979['forEach']((_0x1092f7,_0x2fce2e)=>{var _0x3b61cb=_0x471761;_0x38b09c[_0x2fce2e][_0x3b61cb(0x2de)]=_0x1092f7;}),_0x26f85b[_0x471761(0x277)]((_0xd6723f,_0xa3e9)=>{var _0x1d4909=_0x471761;_0x38b09c[_0xa3e9][_0x1d4909(0x2a9)]=_0xd6723f;}),_0x1e53fc[_0x471761(0x277)]((_0x52143e,_0x511d17)=>{var _0x2c2434=_0x471761;_0x38b09c[_0x511d17][_0x2c2434(0x270)]=_0x52143e;});var _0x27bdff=0x0;_0x38b09c['forEach'](_0x31fda5=>{var _0x3fff22=_0x471761;(_0x31fda5['stock']<_0x31fda5[_0x3fff22(0x2de)]||_0x31fda5[_0x3fff22(0x2de)]==0x0)&&(console[_0x3fff22(0x22d)]('foreach\x20newproduct',_0x31fda5),_0x27bdff++);});const _0x1cd680=_0x38b09c[_0x471761(0x2dc)](_0x40772f=>_0x40772f[_0x471761(0x20e)]!=='0'&&_0x40772f[_0x471761(0x20e)]!==''),_0x5d79aa=new sales({'invoice':_0x2425d4,'customer':_0x145c30[_0x471761(0x2a4)][_0x471761(0x297)],'date':_0x3d076c,'warehouse_name':_0xd0bf62,'sale_product':_0x1cd680,'note':_0x5074bb,'room':_0x528213,'primary_code':_0x47f810,'secondary_code':_0x596b7c,'prod_code':_0x56555a,'SCRN':_0x416f66}),_0x5e87e4=await _0x5d79aa[_0x471761(0x26c)]();_0x145c30[_0x471761(0x1eb)](_0x471761(0x2be),_0x471761(0x23e)),_0x13af67[_0x471761(0x2c1)](_0x471761(0x281)+_0x5e87e4['_id']);}catch(_0x4c0328){console[_0x471761(0x22d)](_0x4c0328);}}),router['get'](a0_0x3d25f2(0x25b),auth,async(_0x5c2152,_0x9b917f)=>{var _0x1e8b66=a0_0x3d25f2;try{const {username:_0x1a411d,email:_0x52874c,role:_0x395d1d}=_0x5c2152[_0x1e8b66(0x202)],_0xa4e20b=_0x5c2152['user'],_0x28905b=await profile['findOne']({'email':_0xa4e20b['email']}),_0x1fa59b=await master_shop[_0x1e8b66(0x240)](),_0x233b0e=_0x5c2152['params']['id'],_0x5ea146=await sales[_0x1e8b66(0x2f5)](_0x233b0e),_0x16b56c=await warehouse[_0x1e8b66(0x2c6)]([{'$match':{'name':_0x5ea146[_0x1e8b66(0x23c)]}},{'$unwind':_0x1e8b66(0x2b7)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1e8b66(0x253)},'bay':{'$first':_0x1e8b66(0x2cf)},'bin':{'$first':_0x1e8b66(0x2e1)},'type':{'$first':_0x1e8b66(0x2c7)},'floorlevel':{'$first':_0x1e8b66(0x259)},'primary_code':{'$first':_0x1e8b66(0x222)},'secondary_code':{'$first':_0x1e8b66(0x221)},'product_code':{'$first':_0x1e8b66(0x214)},'storage':{'$first':_0x1e8b66(0x205)},'rack':{'$first':_0x1e8b66(0x2ad)},'expiry_date':{'$first':_0x1e8b66(0x275)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x1e8b66(0x2db)}}}]),_0x441e3f=await customer[_0x1e8b66(0x240)]({});let _0x1548d4;if(_0xa4e20b[_0x1e8b66(0x26b)]==_0x1e8b66(0x2f7)){const _0x369d95=await staff['findOne']({'email':_0xa4e20b[_0x1e8b66(0x245)]});_0x1548d4=await warehouse[_0x1e8b66(0x2c6)]([{'$match':{'status':_0x1e8b66(0x229),'name':_0x369d95['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x1e8b66(0x1fd)}}}]);}else _0x1548d4=await warehouse['aggregate']([{'$match':{'status':_0x1e8b66(0x229)}},{'$group':{'_id':_0x1e8b66(0x1fd),'name':{'$first':_0x1e8b66(0x1fd)}}}]);const _0x55afe9=await product['find']({}),_0x3ad0f6=await suppliers['find']({});if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]=='English\x20(US)'){var _0x4da19e=users['English'];console['log'](_0x4da19e);}else{if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]=='Hindi')var _0x4da19e=users[_0x1e8b66(0x291)];else{if(_0x1fa59b[0x0]['language']==_0x1e8b66(0x2ee))var _0x4da19e=users['German'];else{if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]==_0x1e8b66(0x27c))var _0x4da19e=users[_0x1e8b66(0x27c)];else{if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]==_0x1e8b66(0x1fe))var _0x4da19e=users[_0x1e8b66(0x1fe)];else{if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]==_0x1e8b66(0x262))var _0x4da19e=users[_0x1e8b66(0x29f)];else{if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]==_0x1e8b66(0x24f))var _0x4da19e=users[_0x1e8b66(0x24f)];else{if(_0x1fa59b[0x0][_0x1e8b66(0x2ae)]==_0x1e8b66(0x290))var _0x4da19e=users['Arabic'];}}}}}}}_0x9b917f[_0x1e8b66(0x280)](_0x1e8b66(0x251),{'success':_0x5c2152['flash']('success'),'errors':_0x5c2152['flash'](_0x1e8b66(0x250)),'role':_0xa4e20b,'profile':_0x28905b,'customer':_0x441e3f,'warehouse':_0x1548d4,'product':_0x16b56c,'user':_0x5ea146,'master_shop':_0x1fa59b,'unit':_0x55afe9,'language':_0x4da19e,'suppliers':_0x3ad0f6});}catch(_0x24a1da){console[_0x1e8b66(0x22d)](_0x24a1da);}}),router[a0_0x3d25f2(0x2ff)](a0_0x3d25f2(0x25b),auth,async(_0x350e5c,_0x80dd14)=>{var _0xd95d25=a0_0x3d25f2;try{const _0x200661=_0x350e5c[_0xd95d25(0x2b9)]['id'],{invoice:_0x1328cd,warehouse_name:_0x297d62,room:_0x1aff8f}=_0x350e5c['body'],_0x1883cb=await sales[_0xd95d25(0x2ea)]({'invoice':_0x1328cd}),_0x2bd92b=_0x1883cb[_0xd95d25(0x1f9)][_0xd95d25(0x20f)](async _0x553fec=>{var _0x4e5798=_0xd95d25,_0x21d999=await warehouse[_0x4e5798(0x2ea)]({'name':_0x297d62,'room':_0x553fec[_0x4e5798(0x2a9)],'warehouse_category':_0x4e5798(0x2a3)});const _0x37d1dd=_0x21d999[_0x4e5798(0x1f7)][_0x4e5798(0x20f)](_0x4d6c70=>{var _0x439860=_0x4e5798;_0x4d6c70[_0x439860(0x294)]==_0x553fec[_0x439860(0x294)]&&_0x4d6c70[_0x439860(0x2c2)]==_0x553fec[_0x439860(0x2c2)]&&_0x4d6c70[_0x439860(0x20a)]==_0x553fec[_0x439860(0x20a)]&&_0x4d6c70['bin']==_0x553fec[_0x439860(0x227)]&&_0x4d6c70['bay']==_0x553fec[_0x439860(0x2b5)]&&_0x4d6c70[_0x439860(0x2f3)]==_0x553fec[_0x439860(0x2f3)]&&_0x4d6c70[_0x439860(0x21b)]==_0x553fec[_0x439860(0x21b)]&&_0x4d6c70[_0x439860(0x22b)]==_0x553fec[_0x439860(0x22b)]&&_0x4d6c70[_0x439860(0x218)]==_0x553fec['batch_code']&&_0x4d6c70['invoice']==_0x553fec['invoice']&&_0x4d6c70[_0x439860(0x282)]==_0x553fec[_0x439860(0x1f5)]&&(_0x4d6c70[_0x439860(0x2e9)]=Math[_0x439860(0x236)](0x0,Math[_0x439860(0x2f4)](_0x4d6c70[_0x439860(0x2e9)])-Math['abs'](_0x553fec['quantity'])));});return _0x21d999;});Promise[_0xd95d25(0x2b8)](_0x2bd92b)[_0xd95d25(0x272)](async _0x4aaa16=>{var _0x69cacc=_0xd95d25;try{for(const _0x204755 of _0x4aaa16){await _0x204755[_0x69cacc(0x26c)]();}_0x1883cb[_0x69cacc(0x220)]=_0x69cacc(0x296);const _0x5ade9b=await _0x1883cb[_0x69cacc(0x26c)](),_0x2f3a65=await master_shop[_0x69cacc(0x240)](),_0xec7f8=await email_settings[_0x69cacc(0x2ea)](),_0x5e9cae=await supervisor_settings['find']();var _0x3b0573=_0x1883cb[_0x69cacc(0x1f9)],_0x181f28='',_0x5420a8;for(_0x5420a8 in _0x3b0573){_0x181f28+=_0x69cacc(0x2ba)+_0x69cacc(0x211)+_0x3b0573[_0x5420a8][_0x69cacc(0x294)]+'</td>'+_0x69cacc(0x211)+_0x3b0573[_0x5420a8]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b0573[_0x5420a8][_0x69cacc(0x20e)]+_0x69cacc(0x25d)+_0x69cacc(0x211)+_0x3b0573[_0x5420a8][_0x69cacc(0x248)]+'</td>'+_0x69cacc(0x211)+_0x3b0573[_0x5420a8][_0x69cacc(0x244)]+_0x69cacc(0x25d)+_0x69cacc(0x211)+_0x1883cb[_0x69cacc(0x23c)]+_0x69cacc(0x25d)+_0x69cacc(0x211)+_0x3b0573[_0x5420a8][_0x69cacc(0x2a9)]+'</td>'+_0x69cacc(0x211)+_0x3b0573[_0x5420a8]['storage']+_0x3b0573[_0x5420a8][_0x69cacc(0x2f3)]+_0x3b0573[_0x5420a8][_0x69cacc(0x2b5)]+_0x3b0573[_0x5420a8]['bin']+_0x3b0573[_0x5420a8][_0x69cacc(0x20a)][0x0]+_0x3b0573[_0x5420a8][_0x69cacc(0x2c2)]+_0x69cacc(0x25d),_0x69cacc(0x2a1);}let _0xc501b9=nodemailer[_0x69cacc(0x24a)]({'host':_0xec7f8[_0x69cacc(0x2f9)],'port':Number(_0xec7f8[_0x69cacc(0x2dd)]),'secure':![],'auth':{'user':_0xec7f8[_0x69cacc(0x245)],'pass':_0xec7f8[_0x69cacc(0x208)]}}),_0x39f471={'from':_0xec7f8['email'],'to':_0x5e9cae[0x0][_0x69cacc(0x24d)],'subject':_0x69cacc(0x2d2),'attachments':[{'filename':_0x69cacc(0x261),'path':__dirname+_0x69cacc(0x2fb)+_0x69cacc(0x1fa)+_0x2f3a65[0x0][_0x69cacc(0x28c)],'cid':_0x69cacc(0x2d1)}],'html':_0x69cacc(0x2b0)+_0x69cacc(0x268)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x69cacc(0x225)+_0x69cacc(0x2a2)+_0x69cacc(0x2d9)+_0x69cacc(0x225)+_0x69cacc(0x237)+_0x2f3a65[0x0][_0x69cacc(0x27d)]+_0x69cacc(0x293)+_0x69cacc(0x2d9)+_0x69cacc(0x2d9)+_0x69cacc(0x1ef)+_0x69cacc(0x225)+_0x69cacc(0x1f3)+_0x69cacc(0x2d5)+_0x1883cb[_0x69cacc(0x270)]+'\x20'+_0x69cacc(0x23b)+'\x20Order\x20Date\x20:\x20'+_0x1883cb[_0x69cacc(0x234)]+'\x20'+_0x69cacc(0x2a6)+_0x69cacc(0x210)+_0x69cacc(0x2d9)+_0x69cacc(0x206)+_0x69cacc(0x1fc)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x69cacc(0x207)+_0x69cacc(0x2b4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x69cacc(0x203)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x69cacc(0x230)+_0x69cacc(0x2a1)+_0x69cacc(0x1f6)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x181f28+'\x20'+_0x69cacc(0x2f6)+_0x69cacc(0x21a)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x69cacc(0x1f4)+_0x2f3a65[0x0][_0x69cacc(0x27d)]+_0x69cacc(0x210)+'</div>'+_0x69cacc(0x2d9)+_0x69cacc(0x20d)};_0xc501b9['sendMail'](_0x39f471,function(_0x208c12,_0x810955){var _0x33aa9c=_0x69cacc;_0x208c12?(console['log'](_0x208c12),console[_0x33aa9c(0x22d)](_0x33aa9c(0x247))):console[_0x33aa9c(0x22d)](_0x33aa9c(0x292));}),_0x350e5c['flash'](_0x69cacc(0x2be),_0x69cacc(0x2a8)),_0x80dd14[_0x69cacc(0x2c1)](_0x69cacc(0x281)+_0x200661);}catch(_0x47fe75){console[_0x69cacc(0x2cb)](_0x47fe75),_0x80dd14['status'](0x1f4)[_0x69cacc(0x242)]({'error':_0x69cacc(0x26d)});}})[_0xd95d25(0x243)](_0x324918=>{var _0x466d20=_0xd95d25;console[_0x466d20(0x2cb)](_0x324918),_0x80dd14[_0x466d20(0x2bf)](0x1f4)['json']({'error':_0x466d20(0x2bd)});});}catch(_0x3cdfaf){console[_0xd95d25(0x22d)](_0x3cdfaf);}}),router[a0_0x3d25f2(0x2df)]('/view/:id',auth,async(_0x55495d,_0xe2c216)=>{var _0x3e64e8=a0_0x3d25f2;try{const {username:_0x262c00,email:_0x1ea258,role:_0x1049a7}=_0x55495d[_0x3e64e8(0x202)],_0x1666d0=_0x55495d['user'],_0x25b7d5=await profile[_0x3e64e8(0x2ea)]({'email':_0x1666d0[_0x3e64e8(0x245)]}),_0x5c2a33=await master_shop[_0x3e64e8(0x240)](),_0x12bb92=_0x55495d['params']['id'],_0x271037=await sales[_0x3e64e8(0x2f5)](_0x12bb92);var _0x336d26=[_0x3e64e8(0x2bb),'Enclosed'];const _0x26d54c=await warehouse['aggregate']([{'$match':{'name':_0x271037['warehouse_name'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3e64e8(0x29a),'name':{'$first':_0x3e64e8(0x287)},'product_stock':{'$first':_0x3e64e8(0x253)},'bay':{'$first':_0x3e64e8(0x2cf)},'bin':{'$first':_0x3e64e8(0x2e1)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3e64e8(0x221)},'product_code':{'$first':_0x3e64e8(0x214)},'storage':{'$first':_0x3e64e8(0x205)},'rack':{'$first':_0x3e64e8(0x2ad)}}}]),_0x1c2366=await customer['find']({});let _0x22300d;if(_0x1666d0[_0x3e64e8(0x26b)]==_0x3e64e8(0x2f7)){const _0x248fc0=await staff[_0x3e64e8(0x2ea)]({'email':_0x1666d0[_0x3e64e8(0x245)]});_0x22300d=await warehouse['aggregate']([{'$match':{'status':_0x3e64e8(0x229),'name':_0x248fc0[_0x3e64e8(0x1ff)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3e64e8(0x1fd),'name':{'$first':_0x3e64e8(0x1fd)}}}]);}else _0x22300d=await warehouse[_0x3e64e8(0x2c6)]([{'$match':{'status':_0x3e64e8(0x229),'warehouse_category':_0x3e64e8(0x2a3)}},{'$group':{'_id':_0x3e64e8(0x1fd),'name':{'$first':'$name'}}}]);const _0x431590=await product[_0x3e64e8(0x240)]({});if(_0x5c2a33[0x0]['language']==_0x3e64e8(0x2ca)){var _0x16580e=users[_0x3e64e8(0x2d4)];console[_0x3e64e8(0x22d)](_0x16580e);}else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]=='Hindi')var _0x16580e=users['Hindi'];else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]==_0x3e64e8(0x2ee))var _0x16580e=users[_0x3e64e8(0x2ee)];else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]==_0x3e64e8(0x27c))var _0x16580e=users['Spanish'];else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]==_0x3e64e8(0x1fe))var _0x16580e=users[_0x3e64e8(0x1fe)];else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]==_0x3e64e8(0x262))var _0x16580e=users['Portuguese'];else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]==_0x3e64e8(0x24f))var _0x16580e=users[_0x3e64e8(0x24f)];else{if(_0x5c2a33[0x0][_0x3e64e8(0x2ae)]==_0x3e64e8(0x290))var _0x16580e=users['Arabic'];}}}}}}}_0xe2c216[_0x3e64e8(0x280)](_0x3e64e8(0x2e7),{'success':_0x55495d['flash'](_0x3e64e8(0x2be)),'errors':_0x55495d[_0x3e64e8(0x1eb)](_0x3e64e8(0x250)),'role':_0x1666d0,'profile':_0x25b7d5,'customer':_0x1c2366,'warehouse':_0x22300d,'product':_0x26d54c,'user':_0x271037,'master_shop':_0x5c2a33,'unit':_0x431590,'language':_0x16580e});}catch(_0x5a9f9c){console[_0x3e64e8(0x22d)](_0x5a9f9c);}}),router['post'](a0_0x3d25f2(0x213),auth,async(_0x236686,_0x4cebf3)=>{var _0x2079fd=a0_0x3d25f2;try{const _0x1b28d0=_0x236686[_0x2079fd(0x2b9)]['id'],_0x2d5da8=await sales[_0x2079fd(0x2ea)]({'_id':_0x236686[_0x2079fd(0x2b9)]['id']}),_0x4a1d2a=await warehouse[_0x2079fd(0x2ea)]({'name':_0x2d5da8['warehouse_name'],'room':_0x236686['body'][_0x2079fd(0x231)]}),{invoice:_0x5ede02,date:_0x42d9d7,warehouse_name:_0x4aef2c,product_name:_0x135050,stock:_0x47d9a5,quantity:_0x111ba6,note:_0x347efe,room:_0x4e57b4,customer:_0x593e05,SCRN:_0x3d825e}=_0x236686['body'];if(typeof _0x135050==_0x2079fd(0x299))var _0x475864=[_0x236686[_0x2079fd(0x2a4)]['product_name']],_0x4e0e97=[_0x236686['body'][_0x2079fd(0x219)]],_0x88e0ce=[_0x236686['body'][_0x2079fd(0x241)]],_0x25ac85=[_0x236686['body'][_0x2079fd(0x29c)]],_0x317e21=[_0x236686['body']['secondary_code']],_0x50dc0b=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x22a)]],_0x3f2f08=[_0x236686['body'][_0x2079fd(0x1ea)]],_0xfef4a7=[_0x236686['body'][_0x2079fd(0x232)]],_0x32b434=[_0x236686[_0x2079fd(0x2a4)]['secondary_unit']],_0x498aae=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x218)]],_0x4abfe3=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x22b)]],_0x4b267b=[_0x236686[_0x2079fd(0x2a4)]['max_per_unit']],_0x1e4da3=[_0x236686['body'][_0x2079fd(0x224)]],_0x929f32=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x286)]],_0x4ff52c=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x1ed)]],_0x4b977a=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x22e)]],_0x13b693=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x2cd)]],_0x3eea56=[_0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x20e)]],_0x18800f=[_0x236686[_0x2079fd(0x2a4)]['RoomAssigned']];else var _0x475864=[..._0x236686['body'][_0x2079fd(0x294)]],_0x4e0e97=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x219)]],_0x88e0ce=[..._0x236686['body']['carton']],_0x25ac85=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x29c)]],_0x317e21=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x25a)]],_0x50dc0b=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x22a)]],_0x3f2f08=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x1ea)]],_0xfef4a7=[..._0x236686[_0x2079fd(0x2a4)]['primary_unit']],_0x32b434=[..._0x236686['body'][_0x2079fd(0x244)]],_0x498aae=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x218)]],_0x4abfe3=[..._0x236686[_0x2079fd(0x2a4)]['expiry_date']],_0x4b267b=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x2e8)]],_0x1e4da3=[..._0x236686['body'][_0x2079fd(0x224)]],_0x929f32=[..._0x236686['body'][_0x2079fd(0x286)]],_0x4ff52c=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x1ed)]],_0x4b977a=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x22e)]],_0x13b693=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x2cd)]],_0x3eea56=[..._0x236686['body']['quantity']],_0x18800f=[..._0x236686[_0x2079fd(0x2a4)][_0x2079fd(0x295)]];const _0x34fff9=_0x475864['map'](_0x3d8949=>{return _0x3d8949={'product_name':_0x3d8949};});_0x4e0e97[_0x2079fd(0x277)]((_0x4cb0eb,_0x489e20)=>{var _0x5be0d0=_0x2079fd;_0x34fff9[_0x489e20]['stock']=Math[_0x5be0d0(0x2f4)](_0x4cb0eb);}),_0x88e0ce['forEach']((_0x195c1c,_0xdb5eaa)=>{_0x34fff9[_0xdb5eaa]['quantity']=_0x195c1c;}),_0x25ac85[_0x2079fd(0x277)]((_0x1f833e,_0x2b3c03)=>{var _0x229177=_0x2079fd;_0x34fff9[_0x2b3c03][_0x229177(0x29c)]=_0x1f833e;}),_0x317e21['forEach']((_0x26784a,_0x13c0a0)=>{var _0x363323=_0x2079fd;_0x34fff9[_0x13c0a0][_0x363323(0x25a)]=_0x26784a;}),_0x50dc0b[_0x2079fd(0x277)]((_0x14ca4a,_0xcee969)=>{var _0x3fe160=_0x2079fd;_0x34fff9[_0xcee969][_0x3fe160(0x256)]=_0x14ca4a;}),_0x3f2f08[_0x2079fd(0x277)]((_0x2d667b,_0x103f31)=>{_0x18800f['forEach']((_0x351336,_0xf7c8bc)=>{var _0x99d770=a0_0x2779;if(_0x351336==_0x99d770(0x265)&&_0x103f31==_0xf7c8bc){var _0x1af368=_0x2d667b[_0x99d770(0x2a0)](0x3);_0x34fff9[_0x103f31][_0x99d770(0x21b)]=_0x2d667b[0x0],_0x34fff9[_0x103f31]['rack']=_0x2d667b[0x1],_0x34fff9[_0x103f31][_0x99d770(0x2b5)]=0x0,_0x34fff9[_0x103f31][_0x99d770(0x227)]=0x0,_0x34fff9[_0x103f31][_0x99d770(0x20a)]=_0x99d770(0x2c3),_0x34fff9[_0x103f31][_0x99d770(0x2c2)]=_0x1af368;}else{if(_0x351336==_0x99d770(0x2b6)&&_0x103f31==_0xf7c8bc){var _0x1af368=_0x2d667b['slice'](0x3);_0x34fff9[_0x103f31][_0x99d770(0x21b)]=_0x2d667b[0x0],_0x34fff9[_0x103f31][_0x99d770(0x2f3)]=_0x2d667b[0x1],_0x34fff9[_0x103f31][_0x99d770(0x2b5)]=0x0,_0x34fff9[_0x103f31][_0x99d770(0x227)]=0x0,_0x34fff9[_0x103f31]['type']=_0x99d770(0x2c3),_0x34fff9[_0x103f31][_0x99d770(0x2c2)]=_0x2d667b[0x5];}else{if(_0x103f31==_0xf7c8bc){var _0x4bf93c;if(_0x2d667b[0x4]=='L')_0x4bf93c=_0x99d770(0x2d8);else _0x2d667b[0x4]=='F'&&(_0x4bf93c=_0x99d770(0x2c3));_0x34fff9[_0x103f31][_0x99d770(0x21b)]=_0x2d667b[0x0],_0x34fff9[_0x103f31][_0x99d770(0x2f3)]=_0x2d667b[0x1],_0x34fff9[_0x103f31][_0x99d770(0x2b5)]=_0x2d667b[0x2],_0x34fff9[_0x103f31][_0x99d770(0x227)]=_0x2d667b[0x3],_0x34fff9[_0x103f31][_0x99d770(0x20a)]=_0x4bf93c,_0x34fff9[_0x103f31][_0x99d770(0x2c2)]=_0x2d667b[0x5];}}}});}),_0xfef4a7[_0x2079fd(0x277)]((_0x308d9a,_0x15e25b)=>{_0x34fff9[_0x15e25b]['unit']=_0x308d9a;}),_0x32b434['forEach']((_0x1a1f04,_0x3729a8)=>{var _0x1a0aee=_0x2079fd;_0x34fff9[_0x3729a8][_0x1a0aee(0x244)]=_0x1a1f04;}),_0x498aae[_0x2079fd(0x277)]((_0x4e0a1e,_0x1cb83b)=>{_0x34fff9[_0x1cb83b]['batch_code']=_0x4e0a1e;}),_0x4abfe3['forEach']((_0x2f89f3,_0x295867)=>{var _0x5728b8=_0x2079fd;_0x34fff9[_0x295867][_0x5728b8(0x22b)]=_0x2f89f3;}),_0x4b267b[_0x2079fd(0x277)]((_0x2c2d4e,_0x596c94)=>{_0x34fff9[_0x596c94]['maxperunit']=_0x2c2d4e;}),_0x1e4da3['forEach']((_0x74975a,_0x1b2ff1)=>{_0x34fff9[_0x1b2ff1]['production_date']=_0x74975a;}),_0x929f32[_0x2079fd(0x277)]((_0x1b7ce1,_0xa68211)=>{var _0x41385a=_0x2079fd;_0x34fff9[_0xa68211]['requested_qty']=Math[_0x41385a(0x2f4)](_0x1b7ce1);}),_0x4ff52c[_0x2079fd(0x277)]((_0xa6701,_0xee5f2)=>{var _0x56231d=_0x2079fd;_0x34fff9[_0xee5f2][_0x56231d(0x1ed)]=_0xa6701;}),_0x4b977a[_0x2079fd(0x277)]((_0x5dae36,_0x384dca)=>{var _0x19f236=_0x2079fd;_0x34fff9[_0x384dca][_0x19f236(0x22e)]=_0x5dae36;}),_0x13b693[_0x2079fd(0x277)]((_0x56587f,_0x11683d)=>{var _0x5c4f9c=_0x2079fd;_0x34fff9[_0x11683d][_0x5c4f9c(0x2cd)]=_0x56587f;}),_0x3eea56[_0x2079fd(0x277)]((_0x192180,_0x26a13d)=>{var _0x1cc7ec=_0x2079fd;_0x34fff9[_0x26a13d][_0x1cc7ec(0x2de)]=_0x192180;}),_0x18800f[_0x2079fd(0x277)]((_0x1f05dd,_0x4145a8)=>{var _0x66eff9=_0x2079fd;_0x34fff9[_0x4145a8][_0x66eff9(0x2a9)]=_0x1f05dd;});var _0x14fc45=0x0;_0x34fff9[_0x2079fd(0x277)](_0x89b741=>{var _0x272a6a=_0x2079fd;console[_0x272a6a(0x22d)](_0x272a6a(0x2ac),_0x89b741),(parseInt(_0x89b741['stock'])<parseInt(_0x89b741[_0x272a6a(0x20e)])||parseInt(_0x89b741['quantity'])==0x0)&&_0x14fc45++;});if(_0x14fc45!=0x0)return _0x236686['flash'](_0x2079fd(0x250),_0x2079fd(0x1f2)),_0x4cebf3[_0x2079fd(0x2c1)](_0x2079fd(0x283));const _0x424833=_0x34fff9['filter'](_0x4f475b=>_0x4f475b[_0x2079fd(0x20e)]!=='0'&&_0x4f475b['quantity']!=='');_0x2d5da8[_0x2079fd(0x270)]=_0x5ede02,_0x2d5da8['customer']=_0x593e05,_0x2d5da8[_0x2079fd(0x234)]=_0x42d9d7,_0x2d5da8[_0x2079fd(0x23c)]=_0x4aef2c,_0x2d5da8['sale_product']=_0x424833,_0x2d5da8[_0x2079fd(0x2d0)]=_0x347efe,_0x2d5da8[_0x2079fd(0x233)]=_0x3d825e,_0x2d5da8['finalize']=_0x2079fd(0x273),_0x2d5da8['isAllowEdit']='False';const _0x2cbece=await _0x2d5da8[_0x2079fd(0x26c)]();_0x236686[_0x2079fd(0x1eb)](_0x2079fd(0x2be),_0x2079fd(0x2a8)),_0x4cebf3[_0x2079fd(0x2c1)](_0x2079fd(0x2c9));}catch(_0x5f09c2){console[_0x2079fd(0x22d)](_0x5f09c2);}}),router['post'](a0_0x3d25f2(0x2d3),auth,async(_0x538f1a,_0x232a44)=>{var _0x46a8e0=a0_0x3d25f2;try{const _0x2de5c4=_0x538f1a[_0x46a8e0(0x2b9)]['id'],{invoice:_0x241c70,customer:_0x539164,receivable_amount:_0x56133e,received_amount:_0x3f411e}=_0x538f1a[_0x46a8e0(0x2a4)],_0x42f228=await sales[_0x46a8e0(0x2f5)](_0x2de5c4);console[_0x46a8e0(0x22d)](_0x42f228);var _0x229896=_0x56133e-_0x3f411e;console['log'](_0x3f411e),_0x42f228[_0x46a8e0(0x2bc)]=parseFloat(_0x3f411e)+parseFloat(_0x42f228[_0x46a8e0(0x2bc)]),_0x42f228[_0x46a8e0(0x21f)]=_0x229896,console[_0x46a8e0(0x22d)](_0x42f228);const _0x4a9d46=await _0x42f228['save'](),_0x5357c2=await c_payment_data[_0x46a8e0(0x2ea)]({'invoice':_0x241c70});_0x5357c2['amount']=_0x229896,await _0x5357c2[_0x46a8e0(0x26c)]();let _0x31b0a1=new Date(),_0x3582f5=('0'+_0x31b0a1[_0x46a8e0(0x279)]())[_0x46a8e0(0x2a0)](-0x2),_0xa57a32=('0'+(_0x31b0a1[_0x46a8e0(0x2c5)]()+0x1))[_0x46a8e0(0x2a0)](-0x2),_0x56bb9d=_0x31b0a1[_0x46a8e0(0x25c)](),_0x3805bc=_0x56bb9d+'-'+_0xa57a32+'-'+_0x3582f5;const _0x49afc6=new customer_payment({'invoice':_0x241c70,'date':_0x56bb9d+'-'+_0xa57a32+'-'+_0x3582f5,'customer':_0x539164,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3f411e}),_0x33a872=await _0x49afc6[_0x46a8e0(0x26c)]();_0x538f1a[_0x46a8e0(0x1eb)](_0x46a8e0(0x2be),_0x46a8e0(0x284)),_0x232a44[_0x46a8e0(0x2c1)]('/all_sales/view');}catch(_0x106b02){console[_0x46a8e0(0x22d)](_0x106b02);}}),router[a0_0x3d25f2(0x2df)](a0_0x3d25f2(0x1f1),auth,async(_0x523256,_0x5bf6ee)=>{var _0xda75cc=a0_0x3d25f2;try{const {username:_0x180b18,email:_0x87d0a0,role:_0x1ef0fd}=_0x523256[_0xda75cc(0x202)],_0x392830=_0x523256[_0xda75cc(0x202)],_0x3b7633=await profile['findOne']({'email':_0x392830[_0xda75cc(0x245)]}),_0x1b21aa=await master_shop['find']();console['log'](_0xda75cc(0x217),_0x1b21aa);const _0x1c1500=_0x523256[_0xda75cc(0x2b9)]['id'],_0x46fb4d=await sales[_0xda75cc(0x2f5)](_0x1c1500);console[_0xda75cc(0x22d)](_0x46fb4d);const _0x1c65bc=await customer[_0xda75cc(0x2ea)]({'name':_0x46fb4d[_0xda75cc(0x297)]});console[_0xda75cc(0x22d)](_0x1c65bc);if(_0x1b21aa[0x0][_0xda75cc(0x2ae)]==_0xda75cc(0x2ca)){var _0x14a613=users['English'];console['log'](_0x14a613);}else{if(_0x1b21aa[0x0]['language']==_0xda75cc(0x291))var _0x14a613=users['Hindi'];else{if(_0x1b21aa[0x0][_0xda75cc(0x2ae)]=='German')var _0x14a613=users[_0xda75cc(0x2ee)];else{if(_0x1b21aa[0x0]['language']==_0xda75cc(0x27c))var _0x14a613=users['Spanish'];else{if(_0x1b21aa[0x0][_0xda75cc(0x2ae)]==_0xda75cc(0x1fe))var _0x14a613=users['French'];else{if(_0x1b21aa[0x0][_0xda75cc(0x2ae)]==_0xda75cc(0x262))var _0x14a613=users[_0xda75cc(0x29f)];else{if(_0x1b21aa[0x0][_0xda75cc(0x2ae)]==_0xda75cc(0x24f))var _0x14a613=users[_0xda75cc(0x24f)];else{if(_0x1b21aa[0x0]['language']==_0xda75cc(0x290))var _0x14a613=users['Arabic'];}}}}}}}_0x5bf6ee['render'](_0xda75cc(0x27e),{'success':_0x523256['flash'](_0xda75cc(0x2be)),'errors':_0x523256[_0xda75cc(0x1eb)](_0xda75cc(0x250)),'role':_0x392830,'profile':_0x3b7633,'master_shop':_0x1b21aa,'customers':_0x1c65bc,'sales':_0x46fb4d,'language':_0x14a613});}catch(_0x5d7572){console[_0xda75cc(0x22d)](_0x5d7572);}}),router['get'](a0_0x3d25f2(0x226),auth,async(_0x37e636,_0x125503)=>{var _0x55ee7e=a0_0x3d25f2;try{const {username:_0x3516c0,email:_0x5c4f5b,role:_0xfc8505}=_0x37e636['user'],_0xa21ae7=_0x37e636['user'],_0x2bbad2=await profile['findOne']({'email':_0xa21ae7['email']}),_0x1fd0e2=await master_shop[_0x55ee7e(0x240)]();console[_0x55ee7e(0x22d)](_0x55ee7e(0x217),_0x1fd0e2);const _0x346265=_0x37e636['params']['id'];console[_0x55ee7e(0x22d)](_0x346265);const _0x1e5713=await sales['findById'](_0x346265);console[_0x55ee7e(0x22d)](_0x55ee7e(0x255),_0x1e5713);const _0x215965=await warehouse[_0x55ee7e(0x2c6)]([{'$match':{'name':_0x55ee7e(0x2e0),'room':_0x55ee7e(0x26f)}},{'$unwind':_0x55ee7e(0x2b7)},{'$group':{'_id':_0x55ee7e(0x29a),'name':{'$first':_0x55ee7e(0x287)},'product_stock':{'$first':_0x55ee7e(0x253)},'level':{'$first':_0x55ee7e(0x21d)},'isle':{'$first':_0x55ee7e(0x27a)},'pallet':{'$first':_0x55ee7e(0x2ec)},'primary_code':{'$first':_0x55ee7e(0x222)},'secondary_code':{'$first':_0x55ee7e(0x221)},'product_code':{'$first':_0x55ee7e(0x214)}}}]);console[_0x55ee7e(0x22d)](_0x55ee7e(0x2a5),_0x215965);const _0x2fdc17=await product[_0x55ee7e(0x240)]({});warehouse_data=await warehouse[_0x55ee7e(0x2c6)]([{'$match':{'status':_0x55ee7e(0x229),'name':_0x55ee7e(0x2e0),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x55ee7e(0x1fd),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x3af9fd=['Return\x20Rooms'];if(_0x1fd0e2[0x0]['language']==_0x55ee7e(0x2ca)){var _0x2e1fed=users[_0x55ee7e(0x2d4)];console[_0x55ee7e(0x22d)](_0x2e1fed);}else{if(_0x1fd0e2[0x0]['language']==_0x55ee7e(0x291))var _0x2e1fed=users['Hindi'];else{if(_0x1fd0e2[0x0][_0x55ee7e(0x2ae)]==_0x55ee7e(0x2ee))var _0x2e1fed=users[_0x55ee7e(0x2ee)];else{if(_0x1fd0e2[0x0]['language']==_0x55ee7e(0x27c))var _0x2e1fed=users[_0x55ee7e(0x27c)];else{if(_0x1fd0e2[0x0][_0x55ee7e(0x2ae)]=='French')var _0x2e1fed=users[_0x55ee7e(0x1fe)];else{if(_0x1fd0e2[0x0][_0x55ee7e(0x2ae)]=='Portuguese\x20(BR)')var _0x2e1fed=users[_0x55ee7e(0x29f)];else{if(_0x1fd0e2[0x0][_0x55ee7e(0x2ae)]=='Chinese')var _0x2e1fed=users['Chinese'];else{if(_0x1fd0e2[0x0][_0x55ee7e(0x2ae)]==_0x55ee7e(0x290))var _0x2e1fed=users[_0x55ee7e(0x1ee)];}}}}}}}_0x125503[_0x55ee7e(0x280)](_0x55ee7e(0x1fb),{'success':_0x37e636['flash']('success'),'errors':_0x37e636[_0x55ee7e(0x1eb)](_0x55ee7e(0x250)),'role':_0xa21ae7,'profile':_0x2bbad2,'user':_0x1e5713,'stock':_0x215965,'master_shop':_0x1fd0e2,'unit':_0x2fdc17,'language':_0x2e1fed,'warehouses':warehouse_data,'rooms':_0x3af9fd});}catch(_0x48dbf9){console[_0x55ee7e(0x22d)](_0x48dbf9),_0x125503['status'](0xc8)[_0x55ee7e(0x242)]({'message':_0x48dbf9[_0x55ee7e(0x28f)]});}}),router['post'](a0_0x3d25f2(0x226),auth,async(_0x4aff1,_0x1fe7a8)=>{var _0x1ce1b2=a0_0x3d25f2;try{const {invoice:_0x39bac8,date:_0x4efa71,warehouse_name:_0x25768c,product_name:_0x1bb419,primary_code:_0x2d6f60,secondary_code:_0x5430f7,product_code:_0x50ff8f,sales_quantity:_0x4b90c9,stocks:_0x5f4e27,return_qty:_0x5c12b0,Room_name:_0x340836,to_warehouse_name:_0x586911,to_Roomname:_0x10c861,to_Room_name:_0x591549,note:_0x20452e,level:_0x23cb1a,isle:_0xbf82c1,pallet:_0x61b02e}=_0x4aff1[_0x1ce1b2(0x2a4)];if(typeof _0x1bb419=='string')var _0x362f71=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x294)]],_0x2e027f=[_0x4aff1['body']['primary_code']],_0x200751=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x25a)]],_0x4b4e3b=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x256)]],_0x575e1e=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x271)]],_0x10f579=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x274)]],_0x4f1faa=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x24b)]],_0x44f2cc=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x2b5)]],_0x177ce2=[_0x4aff1['body'][_0x1ce1b2(0x227)]],_0x57b2f7=[_0x4aff1[_0x1ce1b2(0x2a4)]['types']],_0x3b1626=[_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x2c2)]];else var _0x362f71=[..._0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x294)]],_0x2e027f=[..._0x4aff1['body'][_0x1ce1b2(0x29c)]],_0x200751=[..._0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x25a)]],_0x4b4e3b=[..._0x4aff1[_0x1ce1b2(0x2a4)]['product_code']],_0x575e1e=[..._0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x271)]],_0x10f579=[..._0x4aff1['body']['stocks']],_0x4f1faa=[..._0x4aff1['body']['return_qty']],_0x44f2cc=[..._0x4aff1['body']['bay']],_0x177ce2=[..._0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x227)]],_0x57b2f7=[..._0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x278)]],_0x3b1626=[..._0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x2c2)]];const _0x20db5e=_0x362f71['map'](_0x35b219=>{return _0x35b219={'product_name':_0x35b219};});_0x2e027f[_0x1ce1b2(0x277)]((_0x2c87b8,_0x979b7c)=>{var _0x2386b4=_0x1ce1b2;_0x20db5e[_0x979b7c][_0x2386b4(0x29c)]=_0x2c87b8;}),_0x200751[_0x1ce1b2(0x277)]((_0x481e2c,_0x198ce4)=>{_0x20db5e[_0x198ce4]['secondary_code']=_0x481e2c;}),_0x4b4e3b[_0x1ce1b2(0x277)]((_0x380f66,_0x3df026)=>{var _0x35f7fb=_0x1ce1b2;_0x20db5e[_0x3df026][_0x35f7fb(0x256)]=_0x380f66;}),_0x575e1e[_0x1ce1b2(0x277)]((_0x27e3ee,_0x1f871e)=>{var _0x52e1d8=_0x1ce1b2;_0x20db5e[_0x1f871e][_0x52e1d8(0x260)]=_0x27e3ee;}),_0x10f579[_0x1ce1b2(0x277)]((_0x135b64,_0x129f21)=>{_0x20db5e[_0x129f21]['stock']=_0x135b64;}),_0x4f1faa[_0x1ce1b2(0x277)]((_0x4f09ae,_0x595f0a)=>{var _0x3e43d5=_0x1ce1b2;_0x20db5e[_0x595f0a][_0x3e43d5(0x24b)]=_0x4f09ae;}),_0x44f2cc[_0x1ce1b2(0x277)]((_0x1e2c76,_0x442246)=>{var _0x998de3=_0x1ce1b2;_0x20db5e[_0x442246][_0x998de3(0x2b5)]=_0x1e2c76;}),_0x177ce2['forEach']((_0x39c05c,_0x3d82b2)=>{var _0x19ddc8=_0x1ce1b2;_0x20db5e[_0x3d82b2][_0x19ddc8(0x227)]=_0x39c05c;}),_0x57b2f7[_0x1ce1b2(0x277)]((_0x73099a,_0x1bfe74)=>{_0x20db5e[_0x1bfe74]['type']=_0x73099a;}),_0x3b1626[_0x1ce1b2(0x277)]((_0x201d9f,_0x2c151c)=>{var _0x47d80a=_0x1ce1b2;_0x20db5e[_0x2c151c][_0x47d80a(0x2c2)]=_0x201d9f;});var _0x123aaf=0x0;_0x20db5e['forEach'](_0x1c7d76=>{var _0x1531b8=_0x1ce1b2;console[_0x1531b8(0x22d)](_0x1531b8(0x2ac),_0x1c7d76),(parseInt(_0x1c7d76['sale_qty'])<parseInt(_0x1c7d76[_0x1531b8(0x24b)])||parseInt(_0x1c7d76['stock'])<parseInt(_0x1c7d76[_0x1531b8(0x24b)])&&parseInt(_0x1c7d76['sale_qty'])>parseInt(_0x1c7d76[_0x1531b8(0x24b)])||parseInt(_0x1c7d76[_0x1531b8(0x24b)])==0x0)&&_0x123aaf++;});if(_0x123aaf!=0x0)return _0x4aff1['flash'](_0x1ce1b2(0x250),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x1fe7a8[_0x1ce1b2(0x2c1)](_0x1ce1b2(0x283));const _0x423437=await sales[_0x1ce1b2(0x2ea)]({'invoice':_0x39bac8});console[_0x1ce1b2(0x22d)](_0x423437),_0x423437['return_data']=_0x1ce1b2(0x296);const _0x12f85a=await _0x423437[_0x1ce1b2(0x26c)](),_0xb6015a=new sales_return({'invoice':_0x39bac8,'customer':_0x4aff1['body'][_0x1ce1b2(0x297)],'date':_0x4efa71,'warehouse_name':_0x25768c,'room':_0x340836,'ToWarehouse':_0x586911,'ToRoom':_0x591549,'return_sale':_0x20db5e,'note':_0x20452e}),_0x13812b=await _0xb6015a['save']();console[_0x1ce1b2(0x22d)](_0xb6015a);const _0x2c6963=await sales_return[_0x1ce1b2(0x2ea)]({'invoice':_0x39bac8}),_0x4cf4dd=await warehouse['findOne']({'name':_0x586911,'room':_0x591549});_0x2c6963[_0x1ce1b2(0x1fb)][_0x1ce1b2(0x277)](_0x101805=>{var _0xe6ca81=_0x1ce1b2,_0xe8ce65=0x0;const _0x1ae036=_0x4cf4dd[_0xe6ca81(0x1f7)][_0xe6ca81(0x20f)](_0x33f7b8=>{var _0x57bfcf=_0xe6ca81;_0x33f7b8[_0x57bfcf(0x294)]==_0x101805[_0x57bfcf(0x294)]&&_0x33f7b8[_0x57bfcf(0x2c2)]==_0x101805['floorlevel']&&_0x33f7b8[_0x57bfcf(0x20a)]==_0x101805[_0x57bfcf(0x20a)]&&_0x33f7b8[_0x57bfcf(0x227)]==_0x101805[_0x57bfcf(0x227)]&&_0x33f7b8['bay']==_0x101805['bay']&&(_0x33f7b8['product_stock']=parseInt(_0x33f7b8[_0x57bfcf(0x2e9)])+parseInt(_0x101805['return_qty']),_0xe8ce65++);});_0xe8ce65=='0'&&(_0x4cf4dd[_0xe6ca81(0x1f7)]=_0x4cf4dd[_0xe6ca81(0x1f7)]['concat']({'product_name':_0x101805[_0xe6ca81(0x294)],'product_stock':_0x101805[_0xe6ca81(0x24b)],'primary_code':_0x101805[_0xe6ca81(0x29c)],'secondary_code':_0x101805[_0xe6ca81(0x25a)],'product_code':_0x101805['product_code'],'bay':_0x101805['bay'],'bin':_0x101805[_0xe6ca81(0x227)],'type':_0x101805['type'],'floorlevel':_0x101805['floorlevel']})),console[_0xe6ca81(0x22d)](_0xe6ca81(0x252),_0x4cf4dd);}),await _0x4cf4dd[_0x1ce1b2(0x26c)](),console[_0x1ce1b2(0x22d)](_0x4aff1[_0x1ce1b2(0x2a4)]);const _0x4e9894=new c_payment_data({'invoice':_0x39bac8,'customer':_0x4aff1[_0x1ce1b2(0x2a4)][_0x1ce1b2(0x297)],'reason':_0x1ce1b2(0x215)});await _0x4e9894[_0x1ce1b2(0x26c)]();const _0x59e725=await master_shop[_0x1ce1b2(0x240)]();console[_0x1ce1b2(0x22d)](_0x1ce1b2(0x28b),_0x59e725[0x0][_0x1ce1b2(0x28c)]);const _0x14f666=await email_settings[_0x1ce1b2(0x2ea)](),_0x3ad840=await customer[_0x1ce1b2(0x2ea)]({'name':_0x4aff1['body'][_0x1ce1b2(0x297)]});console[_0x1ce1b2(0x22d)](_0x1ce1b2(0x209),_0x3ad840);_0x59e725[0x0][_0x1ce1b2(0x26a)]==0x1?(right_currency=_0x59e725[0x0][_0x1ce1b2(0x228)],left_currency=''):(right_currency='',left_currency=_0x59e725[0x0][_0x1ce1b2(0x228)]);var _0x4def44=_0x362f71,_0x3cbcde=_0x4f1faa,_0x46f430='',_0x522371;for(_0x522371 in _0x4def44){_0x46f430+=_0x1ce1b2(0x2ba)+_0x1ce1b2(0x211)+_0x4def44[_0x522371]+_0x1ce1b2(0x25d)+_0x1ce1b2(0x211)+_0x3cbcde[_0x522371]+_0x1ce1b2(0x25d)+'</tr>';}console[_0x1ce1b2(0x22d)]('product_list',_0x46f430);let _0x30d23e=nodemailer[_0x1ce1b2(0x24a)]({'service':_0x1ce1b2(0x22c),'auth':{'user':_0x14f666[_0x1ce1b2(0x245)],'pass':_0x14f666[_0x1ce1b2(0x208)]}}),_0x4f4e86={'from':_0x14f666[_0x1ce1b2(0x245)],'to':_0x3ad840[_0x1ce1b2(0x245)],'subject':_0x1ce1b2(0x1f0),'attachments':[{'filename':_0x1ce1b2(0x261),'path':__dirname+'/../public'+'/upload/'+_0x59e725[0x0][_0x1ce1b2(0x28c)],'cid':_0x1ce1b2(0x2d1)}],'html':_0x1ce1b2(0x2b0)+'<html><head><title></title>'+_0x1ce1b2(0x2f0)+_0x1ce1b2(0x225)+_0x1ce1b2(0x2a7)+'<div>'+_0x1ce1b2(0x2a2)+_0x1ce1b2(0x2d9)+'<div>'+_0x1ce1b2(0x237)+_0x59e725[0x0][_0x1ce1b2(0x27d)]+_0x1ce1b2(0x293)+'</div>'+'</div>'+_0x1ce1b2(0x1ef)+_0x1ce1b2(0x225)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1ce1b2(0x2d5)+_0x39bac8+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1ce1b2(0x28a)+_0x4efa71+'\x20'+_0x1ce1b2(0x2a6)+_0x1ce1b2(0x210)+_0x1ce1b2(0x2d9)+_0x1ce1b2(0x206)+_0x1ce1b2(0x1fc)+_0x1ce1b2(0x2ba)+_0x1ce1b2(0x200)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1ce1b2(0x24e)+_0x1ce1b2(0x2f1)+_0x1ce1b2(0x2a1)+'</thead>'+_0x1ce1b2(0x26e)+'\x20'+_0x46f430+'\x20'+'</tbody>'+_0x1ce1b2(0x21a)+_0x1ce1b2(0x225)+_0x1ce1b2(0x20b)+'<h5>'+_0x59e725[0x0][_0x1ce1b2(0x27d)]+_0x1ce1b2(0x210)+_0x1ce1b2(0x2d9)+'</div>'+_0x1ce1b2(0x20d)};_0x30d23e[_0x1ce1b2(0x2b2)](_0x4f4e86,function(_0x5027b0,_0x43f1b3){var _0x16a30c=_0x1ce1b2;_0x5027b0?(console[_0x16a30c(0x22d)](_0x5027b0),console[_0x16a30c(0x22d)]('Error\x20Occurs')):console[_0x16a30c(0x22d)]('Email\x20sent\x20successfully');}),_0x4aff1[_0x1ce1b2(0x1eb)](_0x1ce1b2(0x2be),_0x1ce1b2(0x2e3)),_0x1fe7a8[_0x1ce1b2(0x2c1)](_0x1ce1b2(0x2c9));}catch(_0x15a866){console['log'](_0x15a866),_0x1fe7a8['status'](0xc8)[_0x1ce1b2(0x242)]({'message1':_0x15a866[_0x1ce1b2(0x28f)]});}}),router['get']('/barcode/:id',auth,async(_0x2c840b,_0x3518d2)=>{var _0x42e03a=a0_0x3d25f2;try{const {username:_0x5beaa8,email:_0x3eff2f,role:_0x339407}=_0x2c840b[_0x42e03a(0x202)],_0x3ed038=_0x2c840b[_0x42e03a(0x202)],_0x58e694=await profile[_0x42e03a(0x2ea)]({'email':_0x3ed038[_0x42e03a(0x245)]}),_0x191ac5=await master_shop[_0x42e03a(0x240)]();console[_0x42e03a(0x22d)](_0x42e03a(0x269),_0x191ac5);const _0x534de1=_0x2c840b[_0x42e03a(0x2b9)]['id'],_0x5a2496=await sales[_0x42e03a(0x2f5)](_0x534de1);console[_0x42e03a(0x22d)](_0x42e03a(0x1ec),_0x5a2496);if(_0x191ac5[0x0]['language']==_0x42e03a(0x2ca))var _0x384583=users['English'];else{if(_0x191ac5[0x0]['language']==_0x42e03a(0x291))var _0x384583=users['Hindi'];else{if(_0x191ac5[0x0][_0x42e03a(0x2ae)]==_0x42e03a(0x2ee))var _0x384583=users['German'];else{if(_0x191ac5[0x0]['language']==_0x42e03a(0x27c))var _0x384583=users[_0x42e03a(0x27c)];else{if(_0x191ac5[0x0]['language']==_0x42e03a(0x1fe))var _0x384583=users[_0x42e03a(0x1fe)];else{if(_0x191ac5[0x0]['language']==_0x42e03a(0x262))var _0x384583=users[_0x42e03a(0x29f)];else{if(_0x191ac5[0x0][_0x42e03a(0x2ae)]==_0x42e03a(0x24f))var _0x384583=users[_0x42e03a(0x24f)];else{if(_0x191ac5[0x0]['language']==_0x42e03a(0x290))var _0x384583=users[_0x42e03a(0x1ee)];}}}}}}}_0x3518d2[_0x42e03a(0x280)]('all_sales_barcode',{'success':_0x2c840b[_0x42e03a(0x1eb)](_0x42e03a(0x2be)),'errors':_0x2c840b['flash'](_0x42e03a(0x250)),'role':_0x3ed038,'profile':_0x58e694,'alldata':_0x5a2496,'master_shop':_0x191ac5,'language':_0x384583});}catch(_0xfdfc1b){console[_0x42e03a(0x22d)](_0xfdfc1b);}}),router[a0_0x3d25f2(0x2ff)](a0_0x3d25f2(0x29e),async(_0x40d225,_0x23a26d)=>{var _0x1dec69=a0_0x3d25f2;const {product_code:_0x175e65,warehouse_name:_0x477155,rooms_data:_0x12b8b6,Roomslist:_0x5cd7a6}=_0x40d225[_0x1dec69(0x2a4)],_0x97ce6c=_0x5cd7a6[_0x1dec69(0x23d)](','),_0x24f0b8=[];async function _0x2eafee(_0x1aeda9){var _0x7de62c=_0x1dec69;const _0x244dce=await warehouse[_0x7de62c(0x2c6)]([{'$match':{'name':_0x477155,'room':_0x1aeda9}},{'$unwind':_0x7de62c(0x2b7)},{'$match':{'product_details.primary_code':_0x175e65}},{'$group':{'_id':_0x7de62c(0x29a),'name':{'$first':_0x7de62c(0x287)},'product_stock':{'$first':_0x7de62c(0x253)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x7de62c(0x221)},'product_code':{'$first':_0x7de62c(0x214)},'level':{'$first':_0x7de62c(0x2cf)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x7de62c(0x2c7)},'pallet':{'$first':_0x7de62c(0x259)},'unit':{'$first':_0x7de62c(0x239)},'secondary_unit':{'$first':_0x7de62c(0x258)},'storage':{'$first':_0x7de62c(0x205)},'rack':{'$first':_0x7de62c(0x2ad)},'expiry_date':{'$first':_0x7de62c(0x275)},'production_date':{'$first':_0x7de62c(0x298)},'maxPerUnit':{'$first':_0x7de62c(0x28d)},'batch_code':{'$first':_0x7de62c(0x29b)},'product_cat':{'$first':_0x7de62c(0x23f)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x7de62c(0x2e5)},'actual_uom':{'$first':_0x7de62c(0x2e6)}}}]),_0x13e39=await warehouse[_0x7de62c(0x2c6)]([{'$match':{'name':_0x477155,'room':_0x1aeda9}},{'$unwind':_0x7de62c(0x2b7)},{'$match':{'product_details.secondary_code':_0x175e65}},{'$group':{'_id':_0x7de62c(0x29a),'name':{'$first':_0x7de62c(0x287)},'product_stock':{'$first':_0x7de62c(0x253)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x7de62c(0x221)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x7de62c(0x2cf)},'isle':{'$first':_0x7de62c(0x2e1)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x7de62c(0x259)},'unit':{'$first':_0x7de62c(0x239)},'secondary_unit':{'$first':_0x7de62c(0x258)},'storage':{'$first':_0x7de62c(0x205)},'rack':{'$first':_0x7de62c(0x2ad)},'expiry_date':{'$first':_0x7de62c(0x275)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x7de62c(0x28d)},'batch_code':{'$first':_0x7de62c(0x29b)},'product_cat':{'$first':_0x7de62c(0x23f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x7de62c(0x2aa)},'invoice':{'$first':_0x7de62c(0x2db)}}}]);if(_0x244dce['length']>0x0)_0x24f0b8[_0x7de62c(0x2b1)](_0x244dce);else _0x13e39[_0x7de62c(0x2fc)]>0x0&&_0x24f0b8[_0x7de62c(0x2b1)](_0x13e39);}const _0x8bc90a=_0x97ce6c[_0x1dec69(0x20f)](_0x2e172b=>_0x2eafee(_0x2e172b));await Promise[_0x1dec69(0x2b8)](_0x8bc90a),_0x23a26d[_0x1dec69(0x242)](_0x24f0b8);}),module[a0_0x3d25f2(0x21e)]=router;