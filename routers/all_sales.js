var a0_0x351afa=a0_0x4ac5;(function(_0x14dc01,_0x58177a){var _0x3e1662=a0_0x4ac5,_0x450a8f=_0x14dc01();while(!![]){try{var _0x59bedb=-parseInt(_0x3e1662(0x19c))/0x1+-parseInt(_0x3e1662(0x171))/0x2*(parseInt(_0x3e1662(0x1ba))/0x3)+-parseInt(_0x3e1662(0x1a4))/0x4+parseInt(_0x3e1662(0x191))/0x5+-parseInt(_0x3e1662(0x14b))/0x6+-parseInt(_0x3e1662(0x1cc))/0x7*(-parseInt(_0x3e1662(0xdc))/0x8)+-parseInt(_0x3e1662(0x186))/0x9*(-parseInt(_0x3e1662(0x183))/0xa);if(_0x59bedb===_0x58177a)break;else _0x450a8f['push'](_0x450a8f['shift']());}catch(_0x3f9b86){_0x450a8f['push'](_0x450a8f['shift']());}}}(a0_0x32d1,0x7291f));const express=require(a0_0x351afa(0xc6)),app=express(),router=express[a0_0x351afa(0x1ce)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x351afa(0x184)),auth=require(a0_0x351afa(0x165)),nodemailer=require('nodemailer'),users=require(a0_0x351afa(0xea));function a0_0x4ac5(_0x466b1a,_0x250415){var _0x32d162=a0_0x32d1();return a0_0x4ac5=function(_0x4ac5bf,_0x405996){_0x4ac5bf=_0x4ac5bf-0xc0;var _0xf9671c=_0x32d162[_0x4ac5bf];return _0xf9671c;},a0_0x4ac5(_0x466b1a,_0x250415);}router[a0_0x351afa(0x18a)]('/view',auth,async(_0x19dbcb,_0x4dc715)=>{var _0x1eaee6=a0_0x351afa;try{const {username:_0x373669,email:_0x7e416f,role:_0x1e84e2}=_0x19dbcb['user'],_0x1e3c5b=_0x19dbcb[_0x1eaee6(0x18e)],_0x2399ea=await profile[_0x1eaee6(0x1c3)]({'email':_0x1e3c5b[_0x1eaee6(0xd6)]}),_0x416fc6=await master_shop[_0x1eaee6(0x143)]();let _0x3744fa;if(_0x1e3c5b[_0x1eaee6(0x1bc)]==_0x1eaee6(0xd7)){const _0xbae82d=await staff['findOne']({'email':_0x1e3c5b[_0x1eaee6(0xd6)]});_0x3744fa=await sales['aggregate']([{'$lookup':{'from':_0x1eaee6(0xc5),'localField':'customer','foreignField':'name','as':_0x1eaee6(0x19b)}},{'$unwind':_0x1eaee6(0x1a7)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x1eaee6(0xc2),'invoice':{'$first':_0x1eaee6(0x17e)},'customers':{'$first':_0x1eaee6(0x151)},'date':{'$first':_0x1eaee6(0x190)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x1eaee6(0xf8)},'note':{'$first':_0x1eaee6(0x1ab)},'return_data':{'$first':_0x1eaee6(0x177)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x1eaee6(0x196)},'type':{'$addToSet':_0x1eaee6(0x1ad)},'pallet':{'$addToSet':_0x1eaee6(0xf6)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x1eaee6(0x1bf)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3744fa=await sales[_0x1eaee6(0x10b)]([{'$lookup':{'from':'customers','localField':_0x1eaee6(0x1be),'foreignField':_0x1eaee6(0x1c7),'as':_0x1eaee6(0x19b)}},{'$unwind':_0x1eaee6(0x1a7)},{'$unwind':_0x1eaee6(0xf8)},{'$group':{'_id':_0x1eaee6(0xc2),'invoice':{'$first':_0x1eaee6(0x17e)},'customers':{'$first':'$customer'},'date':{'$first':_0x1eaee6(0x190)},'warehouse_name':{'$first':_0x1eaee6(0xcc)},'sale_product':{'$push':_0x1eaee6(0xf8)},'note':{'$first':'$note'},'return_data':{'$first':_0x1eaee6(0x177)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x1eaee6(0x16f)},'level':{'$addToSet':_0x1eaee6(0x169)},'isle':{'$addToSet':_0x1eaee6(0x196)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x1eaee6(0xf6)},'finalize':{'$first':_0x1eaee6(0x108)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x1eaee6(0x125),_0x3744fa);if(_0x416fc6[0x0][_0x1eaee6(0xe6)]==_0x1eaee6(0x13d)){var _0x40d3bb=users[_0x1eaee6(0x11e)];console[_0x1eaee6(0x12d)](_0x40d3bb);}else{if(_0x416fc6[0x0][_0x1eaee6(0xe6)]==_0x1eaee6(0x11a))var _0x40d3bb=users['Hindi'];else{if(_0x416fc6[0x0][_0x1eaee6(0xe6)]=='German')var _0x40d3bb=users[_0x1eaee6(0x12e)];else{if(_0x416fc6[0x0][_0x1eaee6(0xe6)]=='Spanish')var _0x40d3bb=users[_0x1eaee6(0xf9)];else{if(_0x416fc6[0x0][_0x1eaee6(0xe6)]==_0x1eaee6(0x182))var _0x40d3bb=users[_0x1eaee6(0x182)];else{if(_0x416fc6[0x0]['language']==_0x1eaee6(0x1a6))var _0x40d3bb=users['Portuguese'];else{if(_0x416fc6[0x0][_0x1eaee6(0xe6)]==_0x1eaee6(0x106))var _0x40d3bb=users[_0x1eaee6(0x106)];else{if(_0x416fc6[0x0]['language']==_0x1eaee6(0x154))var _0x40d3bb=users[_0x1eaee6(0xf5)];}}}}}}}_0x4dc715[_0x1eaee6(0x1bd)](_0x1eaee6(0x156),{'success':_0x19dbcb[_0x1eaee6(0x137)](_0x1eaee6(0xd8)),'errors':_0x19dbcb[_0x1eaee6(0x137)](_0x1eaee6(0x1a8)),'sales':_0x3744fa,'profile':_0x2399ea,'role':_0x1e3c5b,'master_shop':_0x416fc6,'language':_0x40d3bb});}catch(_0x381a0e){console[_0x1eaee6(0x12d)](_0x381a0e);}});async function getRandom8DigitNumber(){var _0x43d62e=a0_0x351afa;const _0x3ba06e=0x989680,_0x2ab041=0x5f5e0ff,_0x3a75a6=Math['floor'](Math[_0x43d62e(0x159)]()*(_0x2ab041-_0x3ba06e+0x1))+_0x3ba06e;var _0x2f95cd;const _0x2c90f8=await sales['findOne']({'invoice':_0x43d62e(0x180)+_0x3a75a6});return _0x2c90f8&&_0x2c90f8['length']>0x0?_0x2f95cd=_0x43d62e(0x180)+_0x3a75a6:_0x2f95cd=_0x43d62e(0x180)+_0x3a75a6,_0x2f95cd;}router[a0_0x351afa(0x18a)](a0_0x351afa(0xf4),auth,async(_0x3084db,_0x513621)=>{var _0x4bebbc=a0_0x351afa;try{const {username:_0x3e2d51,email:_0x18a190,role:_0xf4a264}=_0x3084db['user'],_0x1c15a9=_0x3084db[_0x4bebbc(0x18e)],_0xc7efad=await profile[_0x4bebbc(0x1c3)]({'email':_0x1c15a9[_0x4bebbc(0xd6)]}),_0x3a1216=await master_shop[_0x4bebbc(0x143)](),_0x4983d5=await customer[_0x4bebbc(0x143)]({});let _0x5bb6c9;if(_0x1c15a9[_0x4bebbc(0x1bc)]=='staff'){const _0x3f700e=await staff[_0x4bebbc(0x1c3)]({'email':_0x1c15a9[_0x4bebbc(0xd6)]});_0x5bb6c9=await warehouse['aggregate']([{'$match':{'status':_0x4bebbc(0x10d),'name':_0x3f700e[_0x4bebbc(0x102)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x4bebbc(0xce),'name':{'$first':_0x4bebbc(0xce)}}},{'$sort':{'name':0x1}}]);}else _0x5bb6c9=await warehouse[_0x4bebbc(0x10b)]([{'$match':{'status':_0x4bebbc(0x10d),'warehouse_category':_0x4bebbc(0x13f),'name':{'$ne':_0x4bebbc(0x13c)}}},{'$group':{'_id':_0x4bebbc(0xce),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x5d7b29=await product['find']({});var _0x4c1ae0=[_0x4bebbc(0x1c1),_0x4bebbc(0x1c0)];const _0x5b866d=await sales[_0x4bebbc(0x143)]({}),_0x506fa2=_0x5b866d[_0x4bebbc(0xd9)]+0x1,_0x3f1a06=_0x4bebbc(0x180)+_0x506fa2[_0x4bebbc(0x158)]()[_0x4bebbc(0x120)](0x5,'0');if(_0x3a1216[0x0]['language']==_0x4bebbc(0x13d)){var _0x309586=users[_0x4bebbc(0x11e)];console[_0x4bebbc(0x12d)](_0x309586);}else{if(_0x3a1216[0x0][_0x4bebbc(0xe6)]==_0x4bebbc(0x11a))var _0x309586=users['Hindi'];else{if(_0x3a1216[0x0]['language']=='German')var _0x309586=users[_0x4bebbc(0x12e)];else{if(_0x3a1216[0x0][_0x4bebbc(0xe6)]=='Spanish')var _0x309586=users[_0x4bebbc(0xf9)];else{if(_0x3a1216[0x0][_0x4bebbc(0xe6)]==_0x4bebbc(0x182))var _0x309586=users[_0x4bebbc(0x182)];else{if(_0x3a1216[0x0][_0x4bebbc(0xe6)]=='Portuguese\x20(BR)')var _0x309586=users[_0x4bebbc(0x199)];else{if(_0x3a1216[0x0]['language']==_0x4bebbc(0x106))var _0x309586=users[_0x4bebbc(0x106)];else{if(_0x3a1216[0x0]['language']==_0x4bebbc(0x154))var _0x309586=users[_0x4bebbc(0xf5)];}}}}}}}const _0x3d4888=getRandom8DigitNumber();_0x3d4888[_0x4bebbc(0x107)](_0x526883=>{var _0xc5eb5e=_0x4bebbc;_0x513621[_0xc5eb5e(0x1bd)](_0xc5eb5e(0xd4),{'success':_0x3084db[_0xc5eb5e(0x137)](_0xc5eb5e(0xd8)),'errors':_0x3084db['flash'](_0xc5eb5e(0x1a8)),'role':_0x1c15a9,'profile':_0xc7efad,'customer':_0x4983d5,'warehouse':_0x5bb6c9,'product':_0x5d7b29,'invoice':_0x526883,'master_shop':_0x3a1216,'language':_0x309586,'rooms_data':_0x4c1ae0});})[_0x4bebbc(0xf3)](_0x110045=>{var _0xb7a9ac=_0x4bebbc;_0x3084db['flash'](_0xb7a9ac(0x1a8),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x513621[_0xb7a9ac(0x145)](_0xb7a9ac(0x19e));});}catch(_0x1d802a){console[_0x4bebbc(0x12d)](_0x1d802a);}}),router[a0_0x351afa(0x18a)](a0_0x351afa(0x141),auth,async(_0x19ccbd,_0xb44c1c)=>{var _0x9d36ca=a0_0x351afa;try{const _0x58d895=_0x19ccbd[_0x9d36ca(0x144)]['id'];console['log'](_0x58d895);const _0x1d49a8=await product['find'](),_0x8e6860=await purchases['aggregate']([{'$match':{'warehouse_name':_0x58d895}},{'$unwind':_0x9d36ca(0xe2)},{'$group':{'_id':_0x9d36ca(0x157)}}]);console['log']('purchases_data',_0x8e6860),_0xb44c1c['status'](0xc8)[_0x9d36ca(0xec)]({'purchases_data':_0x8e6860,'product_data':_0x1d49a8});}catch(_0x4a7059){console[_0x9d36ca(0x12d)](_0x4a7059);}}),router['post'](a0_0x351afa(0xc4),auth,async(_0x5aee49,_0x1b9b24)=>{var _0x1841d9=a0_0x351afa;try{const {warehouse_data:_0x13fecf,product_data:_0x5ade5c}=_0x5aee49[_0x1841d9(0xca)];console['log'](_0x5aee49[_0x1841d9(0xca)][_0x1841d9(0xc1)]);;const _0x1f48a2=await master_shop['find']();console[_0x1841d9(0x12d)](_0x1841d9(0x1ca),_0x1f48a2);const _0x15a3d4=await product[_0x1841d9(0x1c3)]({'name':_0x5ade5c});console[_0x1841d9(0x12d)](_0x1841d9(0x15a),_0x15a3d4);const _0x535c5f=await warehouse[_0x1841d9(0x10b)]([{'$match':{'name':_0x13fecf}},{'$unwind':_0x1841d9(0xf2)},{'$match':{'product_details.product_name':_0x5ade5c}},{'$group':{'_id':_0x1841d9(0x17d),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x1841d9(0x12d)](_0x1841d9(0x155),_0x535c5f),_0x1b9b24[_0x1841d9(0x189)](0xc8)[_0x1841d9(0xec)]({'master':_0x1f48a2,'new_product':_0x15a3d4,'stock_data':_0x535c5f});}catch(_0x293216){console[_0x1841d9(0x12d)](_0x293216);}}),router['post'](a0_0x351afa(0xf4),auth,async(_0x4f17b0,_0x5442a6)=>{var _0x49c98d=a0_0x351afa;try{const {invoice:_0x531250,date:_0x3f54e2,warehouse_name:_0x31b1a8,product_name:_0x1a60f7,stock:_0x2d821f,quantity:_0x2e78d7,note:_0x2c43e4,room:_0xc33737,primary_code:_0x249738,secondary_code:_0x3b086,prod_code:_0x17c938,level:_0x3b65ea,isle:_0x1d70b1,pallet:_0x2f7101,batch_code:_0x27625d,SCRN:_0x1949a5,expiry_date:_0xe8d3c1}=_0x4f17b0[_0x49c98d(0xca)];if(typeof _0x1a60f7=='string')var _0xf509d5=[_0x4f17b0['body'][_0x49c98d(0xe8)]],_0x32ebef=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1a3)]],_0x17b892=[_0x4f17b0['body'][_0x49c98d(0x1c9)]],_0x24411d=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x115)]],_0x3fd113=[_0x4f17b0[_0x49c98d(0xca)]['secondary_code']],_0x3ed2d6=[_0x4f17b0['body'][_0x49c98d(0x12f)]],_0x7d6719=[_0x4f17b0['body']['level']],_0x4d8636=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1d1)]],_0x5960df=[_0x4f17b0['body']['secondary_unit']],_0x49c129=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x194)]],_0x2c0505=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x104)]],_0xfc8dc1=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0xe3)]],_0x232ff8=[_0x4f17b0['body'][_0x49c98d(0x121)]],_0x17d45e=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0xff)]],_0x8ed628=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1a2)]],_0x49d257=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0xd2)]],_0x55e38c=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x138)]],_0x4646af=[_0x4f17b0['body'][_0x49c98d(0xc8)]],_0x510627=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1af)]],_0x113d3d=[_0x4f17b0['body']['prod_invoice']],_0x799700=[_0x4f17b0[_0x49c98d(0xca)]['actual_qty']],_0x1ec41a=[_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x161)]];else var _0xf509d5=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0xe8)]],_0x32ebef=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1a3)]],_0x17b892=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1c9)]],_0x24411d=[..._0x4f17b0['body']['primary_code']],_0x3fd113=[..._0x4f17b0[_0x49c98d(0xca)]['secondary_code']],_0x3ed2d6=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x12f)]],_0x7d6719=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x167)]],_0x4d8636=[..._0x4f17b0['body'][_0x49c98d(0x1d1)]],_0x5960df=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x148)]],_0x49c129=[..._0x4f17b0['body'][_0x49c98d(0x194)]],_0x2c0505=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x104)]],_0xfc8dc1=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0xe3)]],_0x232ff8=[..._0x4f17b0['body'][_0x49c98d(0x121)]],_0x17d45e=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0xff)]],_0x8ed628=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1a2)]],_0x49d257=[..._0x4f17b0['body'][_0x49c98d(0xd2)]],_0x55e38c=[..._0x4f17b0['body'][_0x49c98d(0x138)]],_0x4646af=[..._0x4f17b0['body'][_0x49c98d(0xc8)]],_0x510627=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1af)]],_0x113d3d=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1a5)]],_0x799700=[..._0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x19f)]],_0x1ec41a=[..._0x4f17b0['body'][_0x49c98d(0x161)]];const _0x240d86=_0xf509d5[_0x49c98d(0x122)](_0x950608=>{return _0x950608={'product_name':_0x950608};});_0x32ebef[_0x49c98d(0xf0)]((_0x5a050e,_0x5c22dd)=>{var _0x1b8d7f=_0x49c98d;_0x240d86[_0x5c22dd][_0x1b8d7f(0x1a3)]=Math[_0x1b8d7f(0x14a)](_0x5a050e);}),_0x799700['forEach']((_0x471fcb,_0x2ef821)=>{var _0x5a2f05=_0x49c98d;_0x240d86[_0x2ef821][_0x5a2f05(0x19f)]=Math['abs'](_0x471fcb);}),_0x1ec41a[_0x49c98d(0xf0)]((_0x5db399,_0x4a158f)=>{var _0xb306fc=_0x49c98d;_0x240d86[_0x4a158f][_0xb306fc(0x161)]=_0x5db399;}),_0x17b892[_0x49c98d(0xf0)]((_0x4113ac,_0x41f86c)=>{var _0x181f8b=_0x49c98d;_0x240d86[_0x41f86c][_0x181f8b(0xc8)]=_0x4113ac;}),_0x24411d[_0x49c98d(0xf0)]((_0x5304bb,_0x258753)=>{var _0x3f9382=_0x49c98d;_0x240d86[_0x258753][_0x3f9382(0x115)]=_0x5304bb;}),_0x3fd113[_0x49c98d(0xf0)]((_0x2901e4,_0x5e3a4c)=>{var _0x2fccb0=_0x49c98d;_0x240d86[_0x5e3a4c][_0x2fccb0(0x15e)]=_0x2901e4;}),_0x3ed2d6[_0x49c98d(0xf0)]((_0x402ff7,_0x252936)=>{var _0x3bd317=_0x49c98d;_0x240d86[_0x252936][_0x3bd317(0x134)]=_0x402ff7;}),_0x7d6719[_0x49c98d(0xf0)]((_0x925c9b,_0x37bae6)=>{var _0x56aa52=_0x49c98d;_0x510627[_0x56aa52(0xf0)]((_0x3bdabf,_0x1e8cca)=>{var _0x22a485=_0x56aa52;if(_0x3bdabf=='Receiving\x20Area'&&_0x37bae6==_0x1e8cca){var _0x1e0b83=_0x925c9b[_0x22a485(0x1aa)](0x3);_0x240d86[_0x37bae6][_0x22a485(0x12c)]=_0x925c9b[0x0],_0x240d86[_0x37bae6]['rack']=_0x925c9b[0x1],_0x240d86[_0x37bae6][_0x22a485(0xeb)]=0x0,_0x240d86[_0x37bae6]['bin']=0x0,_0x240d86[_0x37bae6]['type']=_0x22a485(0x170),_0x240d86[_0x37bae6][_0x22a485(0x1b2)]=_0x1e0b83;}else{if(_0x3bdabf==_0x22a485(0xf7)&&_0x37bae6==_0x1e8cca){var _0x1e0b83=_0x925c9b[_0x22a485(0x1aa)](0x3);_0x240d86[_0x37bae6][_0x22a485(0x12c)]=_0x925c9b[0x0],_0x240d86[_0x37bae6][_0x22a485(0x168)]=_0x925c9b[0x1],_0x240d86[_0x37bae6][_0x22a485(0xeb)]=0x0,_0x240d86[_0x37bae6][_0x22a485(0x109)]=0x0,_0x240d86[_0x37bae6][_0x22a485(0x149)]=_0x22a485(0x170),_0x240d86[_0x37bae6]['floorlevel']=_0x925c9b[0x5];}else{if(_0x37bae6==_0x1e8cca){var _0x35cffe;if(_0x925c9b[0x4]=='L')_0x35cffe=_0x22a485(0x18b);else _0x925c9b[0x4]=='F'&&(_0x35cffe=_0x22a485(0x170));_0x240d86[_0x37bae6][_0x22a485(0x12c)]=_0x925c9b[0x0],_0x240d86[_0x37bae6][_0x22a485(0x168)]=_0x925c9b[0x1],_0x240d86[_0x37bae6][_0x22a485(0xeb)]=_0x925c9b[0x2],_0x240d86[_0x37bae6]['bin']=_0x925c9b[0x3],_0x240d86[_0x37bae6][_0x22a485(0x149)]=_0x35cffe,_0x240d86[_0x37bae6][_0x22a485(0x1b2)]=_0x925c9b[0x5];}}}});}),_0x4d8636['forEach']((_0x24e39e,_0xf64e11)=>{var _0x44f894=_0x49c98d;_0x240d86[_0xf64e11][_0x44f894(0x113)]=_0x24e39e;}),_0x5960df[_0x49c98d(0xf0)]((_0x1247d5,_0x99caac)=>{var _0x2d61a4=_0x49c98d;_0x240d86[_0x99caac][_0x2d61a4(0x148)]=_0x1247d5;}),_0x49c129[_0x49c98d(0xf0)]((_0x19ef72,_0x536b1f)=>{var _0x1171b5=_0x49c98d;_0x240d86[_0x536b1f][_0x1171b5(0x194)]=_0x19ef72;}),_0x2c0505[_0x49c98d(0xf0)]((_0x483300,_0x5123e0)=>{_0x240d86[_0x5123e0]['expiry_date']=_0x483300;}),_0xfc8dc1[_0x49c98d(0xf0)]((_0x16a0ca,_0x549375)=>{var _0x5345e1=_0x49c98d;_0x240d86[_0x549375][_0x5345e1(0x101)]=_0x16a0ca;}),_0x232ff8['forEach']((_0x531cf0,_0xfa19a7)=>{var _0x40a99d=_0x49c98d;_0x240d86[_0xfa19a7][_0x40a99d(0x121)]=_0x531cf0;}),_0x17d45e['forEach']((_0x1ef12c,_0x122152)=>{var _0x33abed=_0x49c98d;_0x240d86[_0x122152][_0x33abed(0xff)]=_0x1ef12c;}),_0x8ed628[_0x49c98d(0xf0)]((_0x55a98a,_0x430cbf)=>{_0x240d86[_0x430cbf]['delivery_date']=_0x55a98a;}),_0x49d257['forEach']((_0x5f05a6,_0x238841)=>{var _0x31147d=_0x49c98d;_0x240d86[_0x238841][_0x31147d(0xd2)]=_0x5f05a6;}),_0x55e38c['forEach']((_0x177a3f,_0x41bf2f)=>{var _0x225a4a=_0x49c98d;_0x240d86[_0x41bf2f][_0x225a4a(0x138)]=_0x177a3f;}),_0x4646af[_0x49c98d(0xf0)]((_0xe0c4a3,_0x4a5e17)=>{_0x240d86[_0x4a5e17]['quantity_notConverted']=_0xe0c4a3;}),_0x510627['forEach']((_0x230465,_0x34e502)=>{var _0x2517f6=_0x49c98d;_0x240d86[_0x34e502][_0x2517f6(0x163)]=_0x230465;}),_0x113d3d[_0x49c98d(0xf0)]((_0x3bab66,_0x4f0f1a)=>{var _0x4664a1=_0x49c98d;_0x240d86[_0x4f0f1a][_0x4664a1(0x1c4)]=_0x3bab66;});var _0x380ddc=0x0;_0x240d86['forEach'](_0x3aacf1=>{var _0x5e7535=_0x49c98d;(_0x3aacf1['stock']<_0x3aacf1[_0x5e7535(0x119)]||_0x3aacf1[_0x5e7535(0x119)]==0x0)&&(console[_0x5e7535(0x12d)]('foreach\x20newproduct',_0x3aacf1),_0x380ddc++);});const _0x567774=_0x240d86[_0x49c98d(0x12a)](_0x3875b8=>_0x3875b8['quantity']!=='0'&&_0x3875b8['quantity']!==''),_0x2c3441=new sales({'invoice':_0x531250,'customer':_0x4f17b0[_0x49c98d(0xca)][_0x49c98d(0x1be)],'date':_0x3f54e2,'warehouse_name':_0x31b1a8,'sale_product':_0x567774,'note':_0x2c43e4,'room':_0xc33737,'primary_code':_0x249738,'secondary_code':_0x3b086,'prod_code':_0x17c938,'SCRN':_0x1949a5}),_0x2ccd1d=await _0x2c3441[_0x49c98d(0x135)]();_0x4f17b0[_0x49c98d(0x137)](_0x49c98d(0xd8),_0x49c98d(0x181)),_0x5442a6[_0x49c98d(0x145)](_0x49c98d(0xcb)+_0x2ccd1d['_id']);}catch(_0x57b59e){console[_0x49c98d(0x12d)](_0x57b59e);}}),router['get']('/preview/:id',auth,async(_0x45479f,_0x2bafb0)=>{var _0x1bd97e=a0_0x351afa;try{const {username:_0x4e8cca,email:_0x4896db,role:_0x463167}=_0x45479f[_0x1bd97e(0x18e)],_0x343013=_0x45479f[_0x1bd97e(0x18e)],_0xcf3dcd=await profile[_0x1bd97e(0x1c3)]({'email':_0x343013[_0x1bd97e(0xd6)]}),_0x4dc5ee=await master_shop[_0x1bd97e(0x143)](),_0x167879=_0x45479f['params']['id'],_0x2f46bb=await sales['findById'](_0x167879),_0x54fa76=await warehouse[_0x1bd97e(0x10b)]([{'$match':{'name':_0x2f46bb['warehouse_name']}},{'$unwind':_0x1bd97e(0xf2)},{'$group':{'_id':_0x1bd97e(0x1a1),'name':{'$first':_0x1bd97e(0x17d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1bd97e(0xcd)},'type':{'$first':_0x1bd97e(0x15c)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1bd97e(0x114)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1bd97e(0x1cf)},'storage':{'$first':_0x1bd97e(0x11f)},'rack':{'$first':_0x1bd97e(0x11b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1bd97e(0xe0)}}}]),_0x413a32=await customer[_0x1bd97e(0x143)]({});let _0x183ffa;if(_0x343013[_0x1bd97e(0x1bc)]=='staff'){const _0x18e05d=await staff[_0x1bd97e(0x1c3)]({'email':_0x343013['email']});_0x183ffa=await warehouse[_0x1bd97e(0x10b)]([{'$match':{'status':_0x1bd97e(0x10d),'name':_0x18e05d[_0x1bd97e(0x102)]}},{'$group':{'_id':_0x1bd97e(0xce),'name':{'$first':_0x1bd97e(0xce)}}}]);}else _0x183ffa=await warehouse[_0x1bd97e(0x10b)]([{'$match':{'status':_0x1bd97e(0x10d)}},{'$group':{'_id':_0x1bd97e(0xce),'name':{'$first':_0x1bd97e(0xce)}}}]);const _0x1b2434=await product[_0x1bd97e(0x143)]({}),_0x585240=await suppliers[_0x1bd97e(0x143)]({});if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]==_0x1bd97e(0x13d)){var _0x4beb7c=users[_0x1bd97e(0x11e)];console[_0x1bd97e(0x12d)](_0x4beb7c);}else{if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]=='Hindi')var _0x4beb7c=users['Hindi'];else{if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]==_0x1bd97e(0x12e))var _0x4beb7c=users[_0x1bd97e(0x12e)];else{if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]==_0x1bd97e(0xf9))var _0x4beb7c=users[_0x1bd97e(0xf9)];else{if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]==_0x1bd97e(0x182))var _0x4beb7c=users[_0x1bd97e(0x182)];else{if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]==_0x1bd97e(0x1a6))var _0x4beb7c=users['Portuguese'];else{if(_0x4dc5ee[0x0][_0x1bd97e(0xe6)]==_0x1bd97e(0x106))var _0x4beb7c=users['Chinese'];else{if(_0x4dc5ee[0x0]['language']==_0x1bd97e(0x154))var _0x4beb7c=users[_0x1bd97e(0xf5)];}}}}}}}_0x2bafb0['render'](_0x1bd97e(0x13e),{'success':_0x45479f['flash'](_0x1bd97e(0xd8)),'errors':_0x45479f[_0x1bd97e(0x137)](_0x1bd97e(0x1a8)),'role':_0x343013,'profile':_0xcf3dcd,'customer':_0x413a32,'warehouse':_0x183ffa,'product':_0x54fa76,'user':_0x2f46bb,'master_shop':_0x4dc5ee,'unit':_0x1b2434,'language':_0x4beb7c,'suppliers':_0x585240});}catch(_0x1eec64){console[_0x1bd97e(0x12d)](_0x1eec64);}}),router[a0_0x351afa(0x13a)](a0_0x351afa(0xcf),auth,async(_0x2a0fd6,_0x2a5e88)=>{var _0x2e3e5c=a0_0x351afa;try{const _0xc7bf3e=_0x2a0fd6['params']['id'],{invoice:_0x5d5b50,warehouse_name:_0x47c5ec,room:_0x179669}=_0x2a0fd6[_0x2e3e5c(0xca)],_0x11e855=await sales[_0x2e3e5c(0x1c3)]({'invoice':_0x5d5b50}),_0x51f75e=_0x11e855[_0x2e3e5c(0x10a)]['map'](async _0x531347=>{var _0x1c1d93=_0x2e3e5c,_0x3bf2bc=await warehouse[_0x1c1d93(0x1c3)]({'name':_0x47c5ec,'room':_0x531347['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x507746=_0x3bf2bc['product_details'][_0x1c1d93(0x122)](_0x5aee5f=>{var _0x28c85e=_0x1c1d93;_0x5aee5f['product_name']==_0x531347[_0x28c85e(0xe8)]&&_0x5aee5f['floorlevel']==_0x531347[_0x28c85e(0x1b2)]&&_0x5aee5f['type']==_0x531347[_0x28c85e(0x149)]&&_0x5aee5f[_0x28c85e(0x109)]==_0x531347[_0x28c85e(0x109)]&&_0x5aee5f['bay']==_0x531347[_0x28c85e(0xeb)]&&_0x5aee5f[_0x28c85e(0x168)]==_0x531347['rack']&&_0x5aee5f[_0x28c85e(0x12c)]==_0x531347['storage']&&_0x5aee5f[_0x28c85e(0x104)]==_0x531347['expiry_date']&&_0x5aee5f[_0x28c85e(0x194)]==_0x531347[_0x28c85e(0x194)]&&_0x5aee5f[_0x28c85e(0x1c4)]==_0x531347[_0x28c85e(0x1c4)]&&(_0x5aee5f[_0x28c85e(0xe5)]=Math[_0x28c85e(0x14a)](_0x5aee5f[_0x28c85e(0xe5)])-Math[_0x28c85e(0x14a)](_0x531347[_0x28c85e(0xc8)]));});return _0x3bf2bc;});Promise[_0x2e3e5c(0x15f)](_0x51f75e)[_0x2e3e5c(0x107)](async _0xb88fe0=>{var _0x28844e=_0x2e3e5c;try{for(const _0x3a3a88 of _0xb88fe0){await _0x3a3a88[_0x28844e(0x135)]();}_0x11e855[_0x28844e(0x18c)]='True';const _0x10d7dc=await _0x11e855['save'](),_0x5573a6=await master_shop[_0x28844e(0x143)](),_0x20313f=await email_settings['findOne'](),_0x403c23=await supervisor_settings[_0x28844e(0x143)]();var _0x5b629c=_0x11e855[_0x28844e(0x10a)],_0x917bdd='',_0xcc81ce;for(_0xcc81ce in _0x5b629c){_0x917bdd+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b629c[_0xcc81ce][_0x28844e(0xe8)]+_0x28844e(0x16a)+_0x28844e(0xe9)+_0x5b629c[_0xcc81ce][_0x28844e(0x134)]+_0x28844e(0x16a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b629c[_0xcc81ce][_0x28844e(0xc8)]+_0x28844e(0x16a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b629c[_0xcc81ce][_0x28844e(0x113)]+_0x28844e(0x16a)+_0x28844e(0xe9)+_0x5b629c[_0xcc81ce][_0x28844e(0x148)]+_0x28844e(0x16a)+_0x28844e(0xe9)+_0x11e855[_0x28844e(0x160)]+_0x28844e(0x16a)+_0x28844e(0xe9)+_0x5b629c[_0xcc81ce][_0x28844e(0x163)]+'</td>'+_0x28844e(0xe9)+_0x5b629c[_0xcc81ce][_0x28844e(0x12c)]+_0x5b629c[_0xcc81ce][_0x28844e(0x168)]+_0x5b629c[_0xcc81ce][_0x28844e(0xeb)]+_0x5b629c[_0xcc81ce][_0x28844e(0x109)]+_0x5b629c[_0xcc81ce]['type'][0x0]+_0x5b629c[_0xcc81ce][_0x28844e(0x1b2)]+_0x28844e(0x16a),'</tr>';}let _0x488525=nodemailer[_0x28844e(0x1d0)]({'host':_0x20313f[_0x28844e(0xc7)],'port':Number(_0x20313f['port']),'secure':![],'auth':{'user':_0x20313f['email'],'pass':_0x20313f['password']}}),_0x19cd24={'from':_0x20313f[_0x28844e(0xd6)],'to':_0x403c23[0x0][_0x28844e(0x17a)],'subject':_0x28844e(0x16e),'attachments':[{'filename':'Logo.png','path':__dirname+_0x28844e(0x146)+_0x28844e(0x1b7)+_0x5573a6[0x0]['image'],'cid':_0x28844e(0x198)}],'html':_0x28844e(0x136)+_0x28844e(0x176)+'</head><body>'+_0x28844e(0x1b1)+_0x28844e(0xde)+_0x28844e(0x1b1)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x28844e(0x13b)+_0x5573a6[0x0]['site_title']+'\x20</h2>'+_0x28844e(0xfe)+_0x28844e(0xfe)+_0x28844e(0x140)+_0x28844e(0x1b1)+_0x28844e(0x19a)+_0x28844e(0xc3)+_0x11e855[_0x28844e(0x1c4)]+'\x20'+_0x28844e(0x162)+_0x28844e(0x17f)+_0x11e855[_0x28844e(0x179)]+'\x20'+_0x28844e(0x178)+_0x28844e(0x112)+_0x28844e(0xfe)+_0x28844e(0x193)+_0x28844e(0xfc)+_0x28844e(0x1cd)+_0x28844e(0x17c)+_0x28844e(0x1c6)+_0x28844e(0x1c2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x28844e(0xdb)+_0x28844e(0x187)+_0x28844e(0x127)+_0x28844e(0x1b5)+_0x28844e(0x131)+_0x28844e(0x185)+_0x28844e(0xee)+'\x20'+_0x917bdd+'\x20'+_0x28844e(0xda)+_0x28844e(0x10f)+'<div>'+_0x28844e(0x1b4)+_0x28844e(0xfd)+_0x5573a6[0x0]['site_title']+_0x28844e(0x112)+_0x28844e(0xfe)+_0x28844e(0xfe)+_0x28844e(0x16b)};_0x488525['sendMail'](_0x19cd24,function(_0xe3f270,_0xe52cb){var _0xb994f3=_0x28844e;_0xe3f270?(console['log'](_0xe3f270),console[_0xb994f3(0x12d)]('Error\x20Occurs')):console[_0xb994f3(0x12d)](_0xb994f3(0x11c));}),_0x2a0fd6[_0x28844e(0x137)](_0x28844e(0xd8),_0x28844e(0x1b9)),_0x2a5e88[_0x28844e(0x145)]('/all_sales/preview/'+_0xc7bf3e);}catch(_0x4bdd87){console[_0x28844e(0x197)](_0x4bdd87),_0x2a5e88[_0x28844e(0x189)](0x1f4)[_0x28844e(0xec)]({'error':_0x28844e(0x150)});}})['catch'](_0x2c4145=>{var _0x59c387=_0x2e3e5c;console[_0x59c387(0x197)](_0x2c4145),_0x2a5e88[_0x59c387(0x189)](0x1f4)[_0x59c387(0xec)]({'error':_0x59c387(0x16c)});});}catch(_0xa58de6){console[_0x2e3e5c(0x12d)](_0xa58de6);}}),router[a0_0x351afa(0x18a)](a0_0x351afa(0x14f),auth,async(_0x337023,_0x3140d9)=>{var _0x3ac867=a0_0x351afa;try{const {username:_0x4cf7c5,email:_0x4a7b17,role:_0x59616d}=_0x337023['user'],_0x49fae0=_0x337023['user'],_0x38f1cf=await profile['findOne']({'email':_0x49fae0['email']}),_0x53f37c=await master_shop['find'](),_0x583460=_0x337023[_0x3ac867(0x144)]['id'],_0x3a87f9=await sales[_0x3ac867(0x1c8)](_0x583460);var _0x239e2b=['Ambient',_0x3ac867(0x1c0)];const _0x288736=await warehouse[_0x3ac867(0x10b)]([{'$match':{'name':_0x3a87f9['warehouse_name'],'warehouse_category':_0x3ac867(0x13f)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3ac867(0x1a1),'name':{'$first':_0x3ac867(0x17d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3ac867(0x116)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3ac867(0x15c)},'floorlevel':{'$first':_0x3ac867(0x15d)},'primary_code':{'$first':_0x3ac867(0x114)},'secondary_code':{'$first':_0x3ac867(0xf1)},'product_code':{'$first':_0x3ac867(0x1cf)},'storage':{'$first':_0x3ac867(0x11f)},'rack':{'$first':'$product_details.rack'}}}]),_0x298bde=await customer[_0x3ac867(0x143)]({});let _0x12e555;if(_0x49fae0[_0x3ac867(0x1bc)]==_0x3ac867(0xd7)){const _0x2f348c=await staff[_0x3ac867(0x1c3)]({'email':_0x49fae0[_0x3ac867(0xd6)]});_0x12e555=await warehouse[_0x3ac867(0x10b)]([{'$match':{'status':'Enabled','name':_0x2f348c[_0x3ac867(0x102)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x3ac867(0xce)}}}]);}else _0x12e555=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3ac867(0x13f)}},{'$group':{'_id':'$name','name':{'$first':_0x3ac867(0xce)}}}]);const _0x1347ba=await product[_0x3ac867(0x143)]({});if(_0x53f37c[0x0][_0x3ac867(0xe6)]==_0x3ac867(0x13d)){var _0x7e89f0=users[_0x3ac867(0x11e)];console['log'](_0x7e89f0);}else{if(_0x53f37c[0x0][_0x3ac867(0xe6)]==_0x3ac867(0x11a))var _0x7e89f0=users[_0x3ac867(0x11a)];else{if(_0x53f37c[0x0]['language']==_0x3ac867(0x12e))var _0x7e89f0=users[_0x3ac867(0x12e)];else{if(_0x53f37c[0x0][_0x3ac867(0xe6)]==_0x3ac867(0xf9))var _0x7e89f0=users[_0x3ac867(0xf9)];else{if(_0x53f37c[0x0][_0x3ac867(0xe6)]==_0x3ac867(0x182))var _0x7e89f0=users[_0x3ac867(0x182)];else{if(_0x53f37c[0x0][_0x3ac867(0xe6)]==_0x3ac867(0x1a6))var _0x7e89f0=users[_0x3ac867(0x199)];else{if(_0x53f37c[0x0][_0x3ac867(0xe6)]=='Chinese')var _0x7e89f0=users[_0x3ac867(0x106)];else{if(_0x53f37c[0x0]['language']=='Arabic\x20(ae)')var _0x7e89f0=users[_0x3ac867(0xf5)];}}}}}}}_0x3140d9[_0x3ac867(0x1bd)]('edit_sales',{'success':_0x337023[_0x3ac867(0x137)](_0x3ac867(0xd8)),'errors':_0x337023[_0x3ac867(0x137)](_0x3ac867(0x1a8)),'role':_0x49fae0,'profile':_0x38f1cf,'customer':_0x298bde,'warehouse':_0x12e555,'product':_0x288736,'user':_0x3a87f9,'master_shop':_0x53f37c,'unit':_0x1347ba,'language':_0x7e89f0});}catch(_0x13f7fe){console[_0x3ac867(0x12d)](_0x13f7fe);}}),router[a0_0x351afa(0x13a)](a0_0x351afa(0x14f),auth,async(_0xf91904,_0x1801a0)=>{var _0x30198e=a0_0x351afa;try{const _0x431ce2=_0xf91904[_0x30198e(0x144)]['id'],_0x56add1=await sales['findOne']({'_id':_0xf91904['params']['id']}),_0xb948a2=await warehouse[_0x30198e(0x1c3)]({'name':_0x56add1[_0x30198e(0x160)],'room':_0xf91904[_0x30198e(0xca)]['room']}),{invoice:_0x4867a5,date:_0x979ade,warehouse_name:_0x19c93b,product_name:_0x24b968,stock:_0x4f45ce,quantity:_0x259870,note:_0x2fe2bb,room:_0x4a5900,customer:_0x1fe7fd,SCRN:_0x41a0e0}=_0xf91904[_0x30198e(0xca)];if(typeof _0x24b968=='string')var _0x2e9984=[_0xf91904['body']['product_name']],_0x3718ee=[_0xf91904['body'][_0x30198e(0x1a3)]],_0x38bbb2=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x1c9)]],_0x34c992=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x115)]],_0x2772f0=[_0xf91904['body']['secondary_code']],_0x4ce079=[_0xf91904[_0x30198e(0xca)]['prod_code']],_0x3c3c45=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x167)]],_0x55c985=[_0xf91904['body'][_0x30198e(0x1d1)]],_0x371e58=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x148)]],_0x1e8965=[_0xf91904[_0x30198e(0xca)]['batch_code']],_0x3a85b0=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x104)]],_0x2b0e0d=[_0xf91904[_0x30198e(0xca)]['max_per_unit']],_0x38d91f=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x121)]],_0x1b395c=[_0xf91904[_0x30198e(0xca)][_0x30198e(0xff)]],_0x2188bb=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x1a2)]],_0x560585=[_0xf91904[_0x30198e(0xca)][_0x30198e(0xd2)]],_0x32f1ee=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x138)]],_0x375853=[_0xf91904[_0x30198e(0xca)]['quantity']],_0x404238=[_0xf91904[_0x30198e(0xca)][_0x30198e(0x1af)]];else var _0x2e9984=[..._0xf91904['body']['product_name']],_0x3718ee=[..._0xf91904['body']['stock']],_0x38bbb2=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0x1c9)]],_0x34c992=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0x115)]],_0x2772f0=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0x15e)]],_0x4ce079=[..._0xf91904['body'][_0x30198e(0x12f)]],_0x3c3c45=[..._0xf91904['body'][_0x30198e(0x167)]],_0x55c985=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0x1d1)]],_0x371e58=[..._0xf91904[_0x30198e(0xca)]['secondary_unit']],_0x1e8965=[..._0xf91904[_0x30198e(0xca)]['batch_code']],_0x3a85b0=[..._0xf91904['body']['expiry_date']],_0x2b0e0d=[..._0xf91904['body'][_0x30198e(0xe3)]],_0x38d91f=[..._0xf91904['body']['production_date']],_0x1b395c=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0xff)]],_0x2188bb=[..._0xf91904[_0x30198e(0xca)]['delivery_date']],_0x560585=[..._0xf91904['body'][_0x30198e(0xd2)]],_0x32f1ee=[..._0xf91904[_0x30198e(0xca)]['prod_cat']],_0x375853=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0xc8)]],_0x404238=[..._0xf91904[_0x30198e(0xca)][_0x30198e(0x1af)]];const _0x5bacfd=_0x2e9984['map'](_0x2be878=>{return _0x2be878={'product_name':_0x2be878};});_0x3718ee['forEach']((_0x4c02fc,_0x4348c1)=>{var _0x1bd1b7=_0x30198e;_0x5bacfd[_0x4348c1][_0x1bd1b7(0x1a3)]=Math[_0x1bd1b7(0x14a)](_0x4c02fc);}),_0x38bbb2[_0x30198e(0xf0)]((_0x337968,_0x25bece)=>{var _0x351b76=_0x30198e;_0x5bacfd[_0x25bece][_0x351b76(0xc8)]=_0x337968;}),_0x34c992[_0x30198e(0xf0)]((_0x88b038,_0x15cb63)=>{_0x5bacfd[_0x15cb63]['primary_code']=_0x88b038;}),_0x2772f0[_0x30198e(0xf0)]((_0x248f55,_0x4de1f3)=>{var _0xb95bcd=_0x30198e;_0x5bacfd[_0x4de1f3][_0xb95bcd(0x15e)]=_0x248f55;}),_0x4ce079[_0x30198e(0xf0)]((_0x49a3f0,_0x51a015)=>{var _0x555c8e=_0x30198e;_0x5bacfd[_0x51a015][_0x555c8e(0x134)]=_0x49a3f0;}),_0x3c3c45[_0x30198e(0xf0)]((_0x5a1aa5,_0x229f9a)=>{var _0xe3f180=_0x30198e;_0x404238[_0xe3f180(0xf0)]((_0x29abf0,_0x5e9c5c)=>{var _0x591ac4=_0xe3f180;if(_0x29abf0==_0x591ac4(0x1b8)&&_0x229f9a==_0x5e9c5c){var _0x547eeb=_0x5a1aa5['slice'](0x3);_0x5bacfd[_0x229f9a][_0x591ac4(0x12c)]=_0x5a1aa5[0x0],_0x5bacfd[_0x229f9a][_0x591ac4(0x168)]=_0x5a1aa5[0x1],_0x5bacfd[_0x229f9a][_0x591ac4(0xeb)]=0x0,_0x5bacfd[_0x229f9a][_0x591ac4(0x109)]=0x0,_0x5bacfd[_0x229f9a][_0x591ac4(0x149)]=_0x591ac4(0x170),_0x5bacfd[_0x229f9a][_0x591ac4(0x1b2)]=_0x547eeb;}else{if(_0x29abf0=='Shelves'&&_0x229f9a==_0x5e9c5c){var _0x547eeb=_0x5a1aa5['slice'](0x3);_0x5bacfd[_0x229f9a][_0x591ac4(0x12c)]=_0x5a1aa5[0x0],_0x5bacfd[_0x229f9a]['rack']=_0x5a1aa5[0x1],_0x5bacfd[_0x229f9a][_0x591ac4(0xeb)]=0x0,_0x5bacfd[_0x229f9a]['bin']=0x0,_0x5bacfd[_0x229f9a][_0x591ac4(0x149)]=_0x591ac4(0x170),_0x5bacfd[_0x229f9a][_0x591ac4(0x1b2)]=_0x5a1aa5[0x5];}else{if(_0x229f9a==_0x5e9c5c){var _0x412aa0;if(_0x5a1aa5[0x4]=='L')_0x412aa0=_0x591ac4(0x18b);else _0x5a1aa5[0x4]=='F'&&(_0x412aa0='Floor');_0x5bacfd[_0x229f9a][_0x591ac4(0x12c)]=_0x5a1aa5[0x0],_0x5bacfd[_0x229f9a][_0x591ac4(0x168)]=_0x5a1aa5[0x1],_0x5bacfd[_0x229f9a]['bay']=_0x5a1aa5[0x2],_0x5bacfd[_0x229f9a][_0x591ac4(0x109)]=_0x5a1aa5[0x3],_0x5bacfd[_0x229f9a][_0x591ac4(0x149)]=_0x412aa0,_0x5bacfd[_0x229f9a][_0x591ac4(0x1b2)]=_0x5a1aa5[0x5];}}}});}),_0x55c985[_0x30198e(0xf0)]((_0x451ab5,_0x528c0f)=>{var _0x26ad97=_0x30198e;_0x5bacfd[_0x528c0f][_0x26ad97(0x113)]=_0x451ab5;}),_0x371e58[_0x30198e(0xf0)]((_0x24c1f5,_0x2ae4f2)=>{var _0x4db424=_0x30198e;_0x5bacfd[_0x2ae4f2][_0x4db424(0x148)]=_0x24c1f5;}),_0x1e8965['forEach']((_0x545afc,_0x1370c8)=>{var _0x6574a0=_0x30198e;_0x5bacfd[_0x1370c8][_0x6574a0(0x194)]=_0x545afc;}),_0x3a85b0[_0x30198e(0xf0)]((_0x1b4626,_0x530fc4)=>{var _0x1ab0eb=_0x30198e;_0x5bacfd[_0x530fc4][_0x1ab0eb(0x104)]=_0x1b4626;}),_0x2b0e0d[_0x30198e(0xf0)]((_0x17c312,_0x2b6e75)=>{_0x5bacfd[_0x2b6e75]['maxperunit']=_0x17c312;}),_0x38d91f[_0x30198e(0xf0)]((_0xc5e6,_0x4fed65)=>{var _0x3f78bd=_0x30198e;_0x5bacfd[_0x4fed65][_0x3f78bd(0x121)]=_0xc5e6;}),_0x1b395c['forEach']((_0x1fbed2,_0x2c2956)=>{var _0x95f261=_0x30198e;_0x5bacfd[_0x2c2956][_0x95f261(0xff)]=Math[_0x95f261(0x14a)](_0x1fbed2);}),_0x2188bb[_0x30198e(0xf0)]((_0x2c2883,_0x264c57)=>{_0x5bacfd[_0x264c57]['delivery_date']=_0x2c2883;}),_0x560585[_0x30198e(0xf0)]((_0x306d04,_0x3f47c4)=>{var _0x2b2c07=_0x30198e;_0x5bacfd[_0x3f47c4][_0x2b2c07(0xd2)]=_0x306d04;}),_0x32f1ee[_0x30198e(0xf0)]((_0x276047,_0x1b8d09)=>{var _0x3e614c=_0x30198e;_0x5bacfd[_0x1b8d09][_0x3e614c(0x138)]=_0x276047;}),_0x375853[_0x30198e(0xf0)]((_0x1d3ed9,_0x4bed35)=>{var _0x4b957a=_0x30198e;_0x5bacfd[_0x4bed35][_0x4b957a(0x119)]=_0x1d3ed9;}),_0x404238[_0x30198e(0xf0)]((_0x1e9188,_0x40d16c)=>{var _0x20db78=_0x30198e;_0x5bacfd[_0x40d16c][_0x20db78(0x163)]=_0x1e9188;});var _0x111538=0x0;_0x5bacfd[_0x30198e(0xf0)](_0x20ff8f=>{var _0x1abc20=_0x30198e;console[_0x1abc20(0x12d)]('foreach\x20newproduct',_0x20ff8f),(parseInt(_0x20ff8f[_0x1abc20(0x1a3)])<parseInt(_0x20ff8f[_0x1abc20(0xc8)])||parseInt(_0x20ff8f[_0x1abc20(0xc8)])==0x0)&&_0x111538++;});if(_0x111538!=0x0)return _0xf91904[_0x30198e(0x137)](_0x30198e(0x1a8),_0x30198e(0x1b3)),_0x1801a0[_0x30198e(0x145)]('back');const _0x224f4f=_0x5bacfd[_0x30198e(0x12a)](_0x54ab55=>_0x54ab55['quantity']!=='0'&&_0x54ab55[_0x30198e(0xc8)]!=='');_0x56add1[_0x30198e(0x1c4)]=_0x4867a5,_0x56add1[_0x30198e(0x1be)]=_0x1fe7fd,_0x56add1[_0x30198e(0x179)]=_0x979ade,_0x56add1[_0x30198e(0x160)]=_0x19c93b,_0x56add1['sale_product']=_0x224f4f,_0x56add1[_0x30198e(0x1a0)]=_0x2fe2bb,_0x56add1[_0x30198e(0x1a9)]=_0x41a0e0,_0x56add1['finalize']='False',_0x56add1['isAllowEdit']='False';const _0x2fea58=await _0x56add1[_0x30198e(0x135)]();_0xf91904[_0x30198e(0x137)](_0x30198e(0xd8),_0x30198e(0x1b9)),_0x1801a0['redirect'](_0x30198e(0x19e));}catch(_0x571d6){console[_0x30198e(0x12d)](_0x571d6);}}),router[a0_0x351afa(0x13a)](a0_0x351afa(0x11d),auth,async(_0x6b0228,_0x269a38)=>{var _0x53e1dd=a0_0x351afa;try{const _0x4585e1=_0x6b0228[_0x53e1dd(0x144)]['id'],{invoice:_0x330652,customer:_0x1a0818,receivable_amount:_0x250e0e,received_amount:_0xb35881}=_0x6b0228['body'],_0x473d5e=await sales['findById'](_0x4585e1);console['log'](_0x473d5e);var _0x107274=_0x250e0e-_0xb35881;console['log'](_0xb35881),_0x473d5e[_0x53e1dd(0x100)]=parseFloat(_0xb35881)+parseFloat(_0x473d5e[_0x53e1dd(0x100)]),_0x473d5e['due_amount']=_0x107274,console[_0x53e1dd(0x12d)](_0x473d5e);const _0x5a761e=await _0x473d5e[_0x53e1dd(0x135)](),_0x453d35=await c_payment_data['findOne']({'invoice':_0x330652});_0x453d35[_0x53e1dd(0xd1)]=_0x107274,await _0x453d35['save']();let _0x3ff5fb=new Date(),_0x49a35f=('0'+_0x3ff5fb[_0x53e1dd(0x1bb)]())[_0x53e1dd(0x1aa)](-0x2),_0x265ceb=('0'+(_0x3ff5fb[_0x53e1dd(0xd0)]()+0x1))[_0x53e1dd(0x1aa)](-0x2),_0x337a66=_0x3ff5fb[_0x53e1dd(0x10c)](),_0x565403=_0x337a66+'-'+_0x265ceb+'-'+_0x49a35f;const _0x352521=new customer_payment({'invoice':_0x330652,'date':_0x337a66+'-'+_0x265ceb+'-'+_0x49a35f,'customer':_0x1a0818,'reason':_0x53e1dd(0x175),'amount':_0xb35881}),_0x2165f6=await _0x352521[_0x53e1dd(0x135)]();_0x6b0228[_0x53e1dd(0x137)](_0x53e1dd(0xd8),_0x53e1dd(0x195)),_0x269a38[_0x53e1dd(0x145)]('/all_sales/view');}catch(_0x2c74ea){console[_0x53e1dd(0x12d)](_0x2c74ea);}}),router[a0_0x351afa(0x18a)](a0_0x351afa(0xdd),auth,async(_0x1652cf,_0x20e804)=>{var _0x1b2fa2=a0_0x351afa;try{const {username:_0x555901,email:_0xd3c814,role:_0x46fa0c}=_0x1652cf[_0x1b2fa2(0x18e)],_0x357fa3=_0x1652cf[_0x1b2fa2(0x18e)],_0x3ba6ec=await profile[_0x1b2fa2(0x1c3)]({'email':_0x357fa3[_0x1b2fa2(0xd6)]}),_0x12cf6e=await master_shop[_0x1b2fa2(0x143)]();console[_0x1b2fa2(0x12d)](_0x1b2fa2(0x1ca),_0x12cf6e);const _0x17b55b=_0x1652cf[_0x1b2fa2(0x144)]['id'],_0x34f50c=await sales[_0x1b2fa2(0x1c8)](_0x17b55b);console[_0x1b2fa2(0x12d)](_0x34f50c);const _0xbd8f71=await customer[_0x1b2fa2(0x1c3)]({'name':_0x34f50c[_0x1b2fa2(0x1be)]});console['log'](_0xbd8f71);if(_0x12cf6e[0x0][_0x1b2fa2(0xe6)]=='English\x20(US)'){var _0x5cfb4a=users[_0x1b2fa2(0x11e)];console[_0x1b2fa2(0x12d)](_0x5cfb4a);}else{if(_0x12cf6e[0x0]['language']==_0x1b2fa2(0x11a))var _0x5cfb4a=users['Hindi'];else{if(_0x12cf6e[0x0][_0x1b2fa2(0xe6)]==_0x1b2fa2(0x12e))var _0x5cfb4a=users[_0x1b2fa2(0x12e)];else{if(_0x12cf6e[0x0][_0x1b2fa2(0xe6)]==_0x1b2fa2(0xf9))var _0x5cfb4a=users[_0x1b2fa2(0xf9)];else{if(_0x12cf6e[0x0][_0x1b2fa2(0xe6)]==_0x1b2fa2(0x182))var _0x5cfb4a=users['French'];else{if(_0x12cf6e[0x0]['language']==_0x1b2fa2(0x1a6))var _0x5cfb4a=users[_0x1b2fa2(0x199)];else{if(_0x12cf6e[0x0][_0x1b2fa2(0xe6)]=='Chinese')var _0x5cfb4a=users[_0x1b2fa2(0x106)];else{if(_0x12cf6e[0x0][_0x1b2fa2(0xe6)]=='Arabic\x20(ae)')var _0x5cfb4a=users[_0x1b2fa2(0xf5)];}}}}}}}_0x20e804[_0x1b2fa2(0x1bd)](_0x1b2fa2(0x18f),{'success':_0x1652cf[_0x1b2fa2(0x137)](_0x1b2fa2(0xd8)),'errors':_0x1652cf[_0x1b2fa2(0x137)](_0x1b2fa2(0x1a8)),'role':_0x357fa3,'profile':_0x3ba6ec,'master_shop':_0x12cf6e,'customers':_0xbd8f71,'sales':_0x34f50c,'language':_0x5cfb4a});}catch(_0x2ec193){console['log'](_0x2ec193);}}),router[a0_0x351afa(0x18a)](a0_0x351afa(0x111),auth,async(_0xad0949,_0xb06802)=>{var _0x3551b9=a0_0x351afa;try{const {username:_0x218b31,email:_0xdfec01,role:_0x5dcac9}=_0xad0949[_0x3551b9(0x18e)],_0x114699=_0xad0949['user'],_0x2fcea0=await profile[_0x3551b9(0x1c3)]({'email':_0x114699[_0x3551b9(0xd6)]}),_0x241f0e=await master_shop[_0x3551b9(0x143)]();console[_0x3551b9(0x12d)](_0x3551b9(0x1ca),_0x241f0e);const _0x494f9a=_0xad0949[_0x3551b9(0x144)]['id'];console['log'](_0x494f9a);const _0x599e8a=await sales[_0x3551b9(0x1c8)](_0x494f9a);console[_0x3551b9(0x12d)](_0x3551b9(0x14e),_0x599e8a);const _0x23d3ab=await warehouse[_0x3551b9(0x10b)]([{'$match':{'name':_0x3551b9(0x13c),'room':_0x3551b9(0xed)}},{'$unwind':_0x3551b9(0xf2)},{'$group':{'_id':_0x3551b9(0x1a1),'name':{'$first':_0x3551b9(0x17d)},'product_stock':{'$first':_0x3551b9(0x1ac)},'level':{'$first':_0x3551b9(0x128)},'isle':{'$first':_0x3551b9(0x132)},'pallet':{'$first':_0x3551b9(0xe4)},'primary_code':{'$first':_0x3551b9(0x114)},'secondary_code':{'$first':_0x3551b9(0xf1)},'product_code':{'$first':_0x3551b9(0x1cf)}}}]);console[_0x3551b9(0x12d)]('stock_data',_0x23d3ab);const _0x2aebe0=await product['find']({});warehouse_data=await warehouse[_0x3551b9(0x10b)]([{'$match':{'status':_0x3551b9(0x10d),'name':_0x3551b9(0x13c),'warehouse_category':_0x3551b9(0x13f)}},{'$group':{'_id':_0x3551b9(0xce),'name':{'$first':_0x3551b9(0xce)}}},{'$sort':{'name':0x1}}]);var _0x59d648=[_0x3551b9(0xed)];if(_0x241f0e[0x0][_0x3551b9(0xe6)]==_0x3551b9(0x13d)){var _0x365359=users[_0x3551b9(0x11e)];console[_0x3551b9(0x12d)](_0x365359);}else{if(_0x241f0e[0x0][_0x3551b9(0xe6)]==_0x3551b9(0x11a))var _0x365359=users[_0x3551b9(0x11a)];else{if(_0x241f0e[0x0][_0x3551b9(0xe6)]==_0x3551b9(0x12e))var _0x365359=users[_0x3551b9(0x12e)];else{if(_0x241f0e[0x0][_0x3551b9(0xe6)]=='Spanish')var _0x365359=users[_0x3551b9(0xf9)];else{if(_0x241f0e[0x0]['language']==_0x3551b9(0x182))var _0x365359=users[_0x3551b9(0x182)];else{if(_0x241f0e[0x0][_0x3551b9(0xe6)]==_0x3551b9(0x1a6))var _0x365359=users[_0x3551b9(0x199)];else{if(_0x241f0e[0x0][_0x3551b9(0xe6)]==_0x3551b9(0x106))var _0x365359=users[_0x3551b9(0x106)];else{if(_0x241f0e[0x0][_0x3551b9(0xe6)]==_0x3551b9(0x154))var _0x365359=users[_0x3551b9(0xf5)];}}}}}}}_0xb06802[_0x3551b9(0x1bd)](_0x3551b9(0x188),{'success':_0xad0949[_0x3551b9(0x137)](_0x3551b9(0xd8)),'errors':_0xad0949[_0x3551b9(0x137)](_0x3551b9(0x1a8)),'role':_0x114699,'profile':_0x2fcea0,'user':_0x599e8a,'stock':_0x23d3ab,'master_shop':_0x241f0e,'unit':_0x2aebe0,'language':_0x365359,'warehouses':warehouse_data,'rooms':_0x59d648});}catch(_0x59be5c){console[_0x3551b9(0x12d)](_0x59be5c),_0xb06802[_0x3551b9(0x189)](0xc8)[_0x3551b9(0xec)]({'message':_0x59be5c[_0x3551b9(0xc9)]});}}),router[a0_0x351afa(0x13a)](a0_0x351afa(0x111),auth,async(_0x46a0c2,_0xd916a3)=>{var _0x3d7d84=a0_0x351afa;try{const {invoice:_0x24af0b,date:_0x3b99ff,warehouse_name:_0x46ee1a,product_name:_0x442b1e,primary_code:_0x1aac21,secondary_code:_0x41c294,product_code:_0x2a38af,sales_quantity:_0x231ed8,stocks:_0x4b9fd2,return_qty:_0x1959c4,Room_name:_0x17fca5,to_warehouse_name:_0x27280c,to_Roomname:_0x19ef96,to_Room_name:_0x4cdf9c,note:_0x2f7923,level:_0x536a42,isle:_0x2034cd,pallet:_0xaabf88}=_0x46a0c2[_0x3d7d84(0xca)];if(typeof _0x442b1e=='string')var _0x13c828=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0xe8)]],_0xed586a=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x115)]],_0x2b7c12=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x15e)]],_0x2288ca=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x134)]],_0x22f4bc=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0xfa)]],_0x4f193c=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x110)]],_0x4828eb=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x130)]],_0x4f35f3=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0xeb)]],_0x421f10=[_0x46a0c2['body']['bin']],_0x402220=[_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x164)]],_0xd3e9a7=[_0x46a0c2[_0x3d7d84(0xca)]['floorlevel']];else var _0x13c828=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0xe8)]],_0xed586a=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x115)]],_0x2b7c12=[..._0x46a0c2['body']['secondary_code']],_0x2288ca=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x134)]],_0x22f4bc=[..._0x46a0c2[_0x3d7d84(0xca)]['sales_quantity']],_0x4f193c=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x110)]],_0x4828eb=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x130)]],_0x4f35f3=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0xeb)]],_0x421f10=[..._0x46a0c2[_0x3d7d84(0xca)]['bin']],_0x402220=[..._0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x164)]],_0xd3e9a7=[..._0x46a0c2['body']['floorlevel']];const _0x348e63=_0x13c828['map'](_0x57afd2=>{return _0x57afd2={'product_name':_0x57afd2};});_0xed586a[_0x3d7d84(0xf0)]((_0x3bcd2f,_0x29f713)=>{var _0x191670=_0x3d7d84;_0x348e63[_0x29f713][_0x191670(0x115)]=_0x3bcd2f;}),_0x2b7c12[_0x3d7d84(0xf0)]((_0x4866e9,_0x40e62b)=>{_0x348e63[_0x40e62b]['secondary_code']=_0x4866e9;}),_0x2288ca[_0x3d7d84(0xf0)]((_0x1e2cf5,_0x1b6e3c)=>{_0x348e63[_0x1b6e3c]['product_code']=_0x1e2cf5;}),_0x22f4bc[_0x3d7d84(0xf0)]((_0xfbcba4,_0x532111)=>{var _0x132964=_0x3d7d84;_0x348e63[_0x532111][_0x132964(0xfb)]=_0xfbcba4;}),_0x4f193c['forEach']((_0x134cae,_0x5d12b6)=>{var _0x2064f7=_0x3d7d84;_0x348e63[_0x5d12b6][_0x2064f7(0x1a3)]=_0x134cae;}),_0x4828eb[_0x3d7d84(0xf0)]((_0xf9e37a,_0x4a3830)=>{var _0x3d9503=_0x3d7d84;_0x348e63[_0x4a3830][_0x3d9503(0x130)]=_0xf9e37a;}),_0x4f35f3['forEach']((_0x1027e0,_0x151646)=>{var _0x3035bb=_0x3d7d84;_0x348e63[_0x151646][_0x3035bb(0xeb)]=_0x1027e0;}),_0x421f10[_0x3d7d84(0xf0)]((_0x24fac7,_0x5e78e3)=>{_0x348e63[_0x5e78e3]['bin']=_0x24fac7;}),_0x402220[_0x3d7d84(0xf0)]((_0xbead69,_0x48b115)=>{var _0xaf59d5=_0x3d7d84;_0x348e63[_0x48b115][_0xaf59d5(0x149)]=_0xbead69;}),_0xd3e9a7[_0x3d7d84(0xf0)]((_0x5ccff3,_0x2c66a7)=>{_0x348e63[_0x2c66a7]['floorlevel']=_0x5ccff3;});var _0x714e85=0x0;_0x348e63[_0x3d7d84(0xf0)](_0x4d29d4=>{var _0x59cadf=_0x3d7d84;console['log'](_0x59cadf(0x123),_0x4d29d4),(parseInt(_0x4d29d4[_0x59cadf(0xfb)])<parseInt(_0x4d29d4['return_qty'])||parseInt(_0x4d29d4['stock'])<parseInt(_0x4d29d4[_0x59cadf(0x130)])&&parseInt(_0x4d29d4[_0x59cadf(0xfb)])>parseInt(_0x4d29d4[_0x59cadf(0x130)])||parseInt(_0x4d29d4[_0x59cadf(0x130)])==0x0)&&_0x714e85++;});if(_0x714e85!=0x0)return _0x46a0c2[_0x3d7d84(0x137)](_0x3d7d84(0x1a8),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0xd916a3[_0x3d7d84(0x145)]('back');const _0x12c539=await sales[_0x3d7d84(0x1c3)]({'invoice':_0x24af0b});console[_0x3d7d84(0x12d)](_0x12c539),_0x12c539[_0x3d7d84(0x166)]=_0x3d7d84(0x139);const _0x2a59e0=await _0x12c539[_0x3d7d84(0x135)](),_0x57ec41=new sales_return({'invoice':_0x24af0b,'customer':_0x46a0c2['body'][_0x3d7d84(0x1be)],'date':_0x3b99ff,'warehouse_name':_0x46ee1a,'room':_0x17fca5,'ToWarehouse':_0x27280c,'ToRoom':_0x4cdf9c,'return_sale':_0x348e63,'note':_0x2f7923}),_0x10a2f3=await _0x57ec41[_0x3d7d84(0x135)]();console[_0x3d7d84(0x12d)](_0x57ec41);const _0x25c8b3=await sales_return[_0x3d7d84(0x1c3)]({'invoice':_0x24af0b}),_0x350a70=await warehouse[_0x3d7d84(0x1c3)]({'name':_0x27280c,'room':_0x4cdf9c});_0x25c8b3['return_sale'][_0x3d7d84(0xf0)](_0x4e0381=>{var _0x295bac=_0x3d7d84,_0x119c35=0x0;const _0xf565d7=_0x350a70['product_details']['map'](_0x203068=>{var _0xbe689f=a0_0x4ac5;_0x203068['product_name']==_0x4e0381[_0xbe689f(0xe8)]&&_0x203068[_0xbe689f(0x1b2)]==_0x4e0381[_0xbe689f(0x1b2)]&&_0x203068[_0xbe689f(0x149)]==_0x4e0381['type']&&_0x203068['bin']==_0x4e0381[_0xbe689f(0x109)]&&_0x203068['bay']==_0x4e0381['bay']&&(_0x203068[_0xbe689f(0xe5)]=parseInt(_0x203068[_0xbe689f(0xe5)])+parseInt(_0x4e0381[_0xbe689f(0x130)]),_0x119c35++);});_0x119c35=='0'&&(_0x350a70['product_details']=_0x350a70[_0x295bac(0xc0)][_0x295bac(0x117)]({'product_name':_0x4e0381[_0x295bac(0xe8)],'product_stock':_0x4e0381[_0x295bac(0x130)],'primary_code':_0x4e0381[_0x295bac(0x115)],'secondary_code':_0x4e0381['secondary_code'],'product_code':_0x4e0381[_0x295bac(0x134)],'bay':_0x4e0381['bay'],'bin':_0x4e0381[_0x295bac(0x109)],'type':_0x4e0381['type'],'floorlevel':_0x4e0381['floorlevel']})),console[_0x295bac(0x12d)](_0x295bac(0x153),_0x350a70);}),await _0x350a70[_0x3d7d84(0x135)](),console[_0x3d7d84(0x12d)](_0x46a0c2['body']);const _0xad5c36=new c_payment_data({'invoice':_0x24af0b,'customer':_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x1be)],'reason':_0x3d7d84(0x118)});await _0xad5c36[_0x3d7d84(0x135)]();const _0x6a94da=await master_shop[_0x3d7d84(0x143)]();console['log'](_0x3d7d84(0x10e),_0x6a94da[0x0]['image']);const _0x3bd26a=await email_settings[_0x3d7d84(0x1c3)](),_0x3edd18=await customer['findOne']({'name':_0x46a0c2[_0x3d7d84(0xca)][_0x3d7d84(0x1be)]});console[_0x3d7d84(0x12d)]('customer_data',_0x3edd18);_0x6a94da[0x0][_0x3d7d84(0x14c)]==0x1?(right_currency=_0x6a94da[0x0][_0x3d7d84(0x172)],left_currency=''):(right_currency='',left_currency=_0x6a94da[0x0][_0x3d7d84(0x172)]);var _0x3173db=_0x13c828,_0x1eb2bc=_0x4828eb,_0x42d4c9='',_0x27c861;for(_0x27c861 in _0x3173db){_0x42d4c9+='<tr>'+_0x3d7d84(0xe9)+_0x3173db[_0x27c861]+_0x3d7d84(0x16a)+_0x3d7d84(0xe9)+_0x1eb2bc[_0x27c861]+'</td>'+_0x3d7d84(0x131);}console[_0x3d7d84(0x12d)]('product_list',_0x42d4c9);let _0x607a9c=nodemailer[_0x3d7d84(0x1d0)]({'service':_0x3d7d84(0x152),'auth':{'user':_0x3bd26a['email'],'pass':_0x3bd26a['password']}}),_0x308272={'from':_0x3bd26a[_0x3d7d84(0xd6)],'to':_0x3edd18['email'],'subject':_0x3d7d84(0x1cb),'attachments':[{'filename':_0x3d7d84(0x1c5),'path':__dirname+'/../public'+_0x3d7d84(0x1b7)+_0x6a94da[0x0][_0x3d7d84(0x16d)],'cid':'logo'}],'html':_0x3d7d84(0x136)+_0x3d7d84(0x176)+_0x3d7d84(0x174)+'<div>'+_0x3d7d84(0xde)+_0x3d7d84(0x1b1)+_0x3d7d84(0xd3)+'</div>'+_0x3d7d84(0x1b1)+_0x3d7d84(0x13b)+_0x6a94da[0x0][_0x3d7d84(0xe7)]+_0x3d7d84(0x17b)+_0x3d7d84(0xfe)+'</div>'+_0x3d7d84(0x140)+_0x3d7d84(0x1b1)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x24af0b+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3d7d84(0x17f)+_0x3b99ff+'\x20'+_0x3d7d84(0x178)+_0x3d7d84(0x112)+_0x3d7d84(0xfe)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3d7d84(0xfc)+_0x3d7d84(0x1cd)+_0x3d7d84(0x17c)+_0x3d7d84(0x15b)+_0x3d7d84(0xd5)+_0x3d7d84(0x12b)+_0x3d7d84(0x131)+_0x3d7d84(0x185)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x42d4c9+'\x20'+_0x3d7d84(0xda)+_0x3d7d84(0x10f)+_0x3d7d84(0x1b1)+_0x3d7d84(0x1b4)+_0x3d7d84(0xfd)+_0x6a94da[0x0]['site_title']+'</h5>'+_0x3d7d84(0xfe)+_0x3d7d84(0xfe)+'</body></html>'};_0x607a9c['sendMail'](_0x308272,function(_0x590dc3,_0x25e36c){var _0x69b5f6=_0x3d7d84;_0x590dc3?(console[_0x69b5f6(0x12d)](_0x590dc3),console[_0x69b5f6(0x12d)](_0x69b5f6(0x18d))):console[_0x69b5f6(0x12d)]('Email\x20sent\x20successfully');}),_0x46a0c2[_0x3d7d84(0x137)](_0x3d7d84(0xd8),_0x3d7d84(0xdf)),_0xd916a3[_0x3d7d84(0x145)](_0x3d7d84(0x19e));}catch(_0x5658f8){console[_0x3d7d84(0x12d)](_0x5658f8),_0xd916a3['status'](0xc8)[_0x3d7d84(0xec)]({'message1':_0x5658f8[_0x3d7d84(0xc9)]});}}),router['get'](a0_0x351afa(0x19d),auth,async(_0x5ce899,_0x29fe0c)=>{var _0x3afc33=a0_0x351afa;try{const {username:_0x20eb75,email:_0x102e37,role:_0x22e22c}=_0x5ce899['user'],_0x23f0a6=_0x5ce899[_0x3afc33(0x18e)],_0x5212fe=await profile[_0x3afc33(0x1c3)]({'email':_0x23f0a6[_0x3afc33(0xd6)]}),_0x1db31a=await master_shop[_0x3afc33(0x143)]();console[_0x3afc33(0x12d)](_0x3afc33(0x133),_0x1db31a);const _0x475d52=_0x5ce899[_0x3afc33(0x144)]['id'],_0x17879e=await sales['findById'](_0x475d52);console[_0x3afc33(0x12d)](_0x3afc33(0x129),_0x17879e);if(_0x1db31a[0x0]['language']==_0x3afc33(0x13d))var _0x42789c=users[_0x3afc33(0x11e)];else{if(_0x1db31a[0x0]['language']==_0x3afc33(0x11a))var _0x42789c=users['Hindi'];else{if(_0x1db31a[0x0][_0x3afc33(0xe6)]==_0x3afc33(0x12e))var _0x42789c=users[_0x3afc33(0x12e)];else{if(_0x1db31a[0x0]['language']==_0x3afc33(0xf9))var _0x42789c=users['Spanish'];else{if(_0x1db31a[0x0][_0x3afc33(0xe6)]==_0x3afc33(0x182))var _0x42789c=users[_0x3afc33(0x182)];else{if(_0x1db31a[0x0]['language']==_0x3afc33(0x1a6))var _0x42789c=users['Portuguese'];else{if(_0x1db31a[0x0][_0x3afc33(0xe6)]=='Chinese')var _0x42789c=users[_0x3afc33(0x106)];else{if(_0x1db31a[0x0]['language']=='Arabic\x20(ae)')var _0x42789c=users['Arabic'];}}}}}}}_0x29fe0c[_0x3afc33(0x1bd)](_0x3afc33(0x1b6),{'success':_0x5ce899[_0x3afc33(0x137)](_0x3afc33(0xd8)),'errors':_0x5ce899[_0x3afc33(0x137)](_0x3afc33(0x1a8)),'role':_0x23f0a6,'profile':_0x5212fe,'alldata':_0x17879e,'master_shop':_0x1db31a,'language':_0x42789c});}catch(_0x23c415){console[_0x3afc33(0x12d)](_0x23c415);}}),router[a0_0x351afa(0x13a)](a0_0x351afa(0x126),async(_0x2f9571,_0x156168)=>{var _0xa47068=a0_0x351afa;const {product_code:_0x3a75b3,warehouse_name:_0x37392f,rooms_data:_0x300b1c,Roomslist:_0x3ffcdc}=_0x2f9571[_0xa47068(0xca)],_0x4fd57b=_0x3ffcdc[_0xa47068(0x147)](','),_0x553efc=[];async function _0x1a6a77(_0x33bb66){var _0x400336=_0xa47068;const _0x2dfab1=await warehouse['aggregate']([{'$match':{'name':_0x37392f,'room':_0x33bb66}},{'$unwind':_0x400336(0xf2)},{'$match':{'product_details.primary_code':_0x3a75b3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x400336(0x17d)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x400336(0x114)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x400336(0x1cf)},'level':{'$first':_0x400336(0x116)},'isle':{'$first':_0x400336(0xcd)},'type':{'$first':_0x400336(0x15c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x400336(0x1ae)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x400336(0x11f)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x400336(0x103)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x400336(0x105)},'batch_code':{'$first':_0x400336(0x142)},'product_cat':{'$first':_0x400336(0x124)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x400336(0x173)}}}]),_0xb998c4=await warehouse[_0x400336(0x10b)]([{'$match':{'name':_0x37392f,'room':_0x33bb66}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3a75b3}},{'$group':{'_id':_0x400336(0x1a1),'name':{'$first':_0x400336(0x17d)},'product_stock':{'$first':_0x400336(0x1ac)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x400336(0xf1)},'product_code':{'$first':_0x400336(0x1cf)},'level':{'$first':_0x400336(0x116)},'isle':{'$first':_0x400336(0xcd)},'type':{'$first':_0x400336(0x15c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x400336(0x1ae)},'secondary_unit':{'$first':_0x400336(0xef)},'storage':{'$first':_0x400336(0x11f)},'rack':{'$first':_0x400336(0x11b)},'expiry_date':{'$first':_0x400336(0x103)},'production_date':{'$first':_0x400336(0xe0)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x400336(0x142)},'product_cat':{'$first':_0x400336(0x124)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x400336(0xe1)},'invoice':{'$first':_0x400336(0x1b0)}}}]);if(_0x2dfab1[_0x400336(0xd9)]>0x0)_0x553efc[_0x400336(0x14d)](_0x2dfab1);else _0xb998c4['length']>0x0&&_0x553efc[_0x400336(0x14d)](_0xb998c4);}const _0x2ca737=_0x4fd57b[_0xa47068(0x122)](_0x20f6ec=>_0x1a6a77(_0x20f6ec));await Promise['all'](_0x2ca737),_0x156168['json'](_0x553efc);}),module[a0_0x351afa(0x192)]=router;function a0_0x32d1(){var _0x44b9a0=['Return\x20Rooms','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.secondary_unit','forEach','$product_details.secondary_code','$product_details','catch','/view/add_sales','Arabic','$sale_product.floorlevel','Shelves','$sale_product','Spanish','sales_quantity','sale_qty','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<h5>','</div>','requested_qty','received_amount','maxperunit','warehouse','$product_details.expiry_date','expiry_date','$product_details.maxPerUnit','Chinese','then','$finalize','bin','sale_product','aggregate','getFullYear','Enabled','add\x20post','</table>','stocks','/view/return_sales/:id','</h5>','unit','$product_details.primary_code','primary_code','$product_details.bay','concat','Sale\x20Return','quantity_notConverted','Hindi','$product_details.rack','Email\x20sent\x20successfully','/give_payment/:id','English','$product_details.storage','padStart','production_date','map','foreach\x20newproduct','$product_details.product_cat','sales\x20all_data','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.level','barcode\x20user_id','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','storage','log','German','prod_code','return_qty','</tr>','$product_details.isle','barcode\x20Product\x20master','product_code','save','<!DOCTYPE\x20html>','flash','prod_cat','True','post','<h2>\x20','Return\x20Goods','English\x20(US)','edit_sales_view','Raw\x20Materials','<hr\x20class=\x22my-3\x22>','/view/add_sales/:id','$product_details.batch_code','find','params','redirect','/../public','split','secondary_unit','type','abs','794682oXYyTI','currency_placement','push','user_id','/view/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','$customer','gmail','final','Arabic\x20(ae)','stock_data','all_sales','$product.product_name','toString','random','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.type','$product_details.floorlevel','secondary_code','all','warehouse_name','actual_uom','<span\x20style=\x22float:\x20right;\x22>','room_name','types','../middleware/auth','return_data','level','rack','$sale_product.bay','</td>','</body></html>','An\x20error\x20occurred.','image','Sales\x20Mail','$sale_product.quantity','Floor','254kwZIpA','currency','$product_details.actual_uom','</head><body>','Received\x20Payment\x20For\x20Sale','<html><head><title></title>','$return_data','</span>','date','RMSEmail','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.product_name','$invoice','\x20Order\x20Date\x20:\x20','OUT-','Sales\x20Add\x20successfully','French','179200lVkqyx','../models/all_models','</thead>','270ayXoJf','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','return_sale','status','get','Level','finalize','Error\x20Occurs','user','sales_invoice','$date','2460995PotzYY','exports','<table\x20style=\x22width:\x20100%\x20!important;\x22>','batch_code','payment\x20successfull','$sale_product.bin','error','logo','Portuguese','<h5\x20style=\x22text-align:\x20left;\x22>','customers_docs','368064WrRZaF','/barcode/:id','/all_sales/view','actual_qty','note','$product_details._id','delivery_date','stock','2981204dDGYiX','prod_invoice','Portuguese\x20(BR)','$customers_docs','errors','SCRN','slice','$note','$product_details.product_stock','$sale_product.type','$product_details.unit','RoomAssigned','$product_details.invoice','<div>','floorlevel','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','all_sales_barcode','/upload/','Receiving\x20Area','Sales\x20Update\x20successfully','2127KuToND','getDate','role','render','customer','$isAllowEdit','Enclosed','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','findOne','invoice','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','name','findById','carton','master','Sale\x20Return\x20Mail','1085469OsdhWi','<tr>','Router','$product_details.product_code','createTransport','primary_unit','product_details','product_data','$_id','\x20Order\x20Number\x20:\x20','/view/add_sale/product','customers','express','host','quantity','message','body','/all_sales/preview/','$warehouse_name','$product_details.bin','$name','/preview/:id','getMonth','amount','delivery_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','add_sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','email','staff','success','length','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','40uEJHwM','/invoice/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','sales\x20item\x20return\x20successfull','$product_details.production_date','$room','$product','max_per_unit','$product_details.pallet','product_stock','language','site_title','product_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../public/language/languages.json','bay','json'];a0_0x32d1=function(){return _0x44b9a0;};return a0_0x32d1();}