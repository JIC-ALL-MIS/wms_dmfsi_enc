function a0_0x20e2(_0x301d1c,_0x346079){var _0x5092ee=a0_0x5092();return a0_0x20e2=function(_0x20e2e5,_0x1756ca){_0x20e2e5=_0x20e2e5-0x186;var _0x37d2b5=_0x5092ee[_0x20e2e5];return _0x37d2b5;},a0_0x20e2(_0x301d1c,_0x346079);}var a0_0x3f8043=a0_0x20e2;(function(_0xc3d43b,_0x8dfa94){var _0x310d03=a0_0x20e2,_0x339ced=_0xc3d43b();while(!![]){try{var _0x329315=parseInt(_0x310d03(0x1f9))/0x1*(parseInt(_0x310d03(0x220))/0x2)+-parseInt(_0x310d03(0x1f7))/0x3*(parseInt(_0x310d03(0x200))/0x4)+-parseInt(_0x310d03(0x1ef))/0x5*(parseInt(_0x310d03(0x285))/0x6)+-parseInt(_0x310d03(0x198))/0x7+-parseInt(_0x310d03(0x1fd))/0x8+parseInt(_0x310d03(0x1e7))/0x9+parseInt(_0x310d03(0x25e))/0xa;if(_0x329315===_0x8dfa94)break;else _0x339ced['push'](_0x339ced['shift']());}catch(_0xa13907){_0x339ced['push'](_0x339ced['shift']());}}}(a0_0x5092,0xcbc0b));const express=require(a0_0x3f8043(0x1c9)),app=express(),router=express[a0_0x3f8043(0x210)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x3f8043(0x1fb)),auth=require(a0_0x3f8043(0x20f)),nodemailer=require(a0_0x3f8043(0x28d)),users=require(a0_0x3f8043(0x1d5));router['get']('/view',auth,async(_0x283fb5,_0x5651af)=>{var _0x27827b=a0_0x3f8043;try{const {username:_0x3da26a,email:_0x295a73,role:_0x386506}=_0x283fb5[_0x27827b(0x1db)],_0x57d0c0=_0x283fb5[_0x27827b(0x1db)],_0x1f25d9=await profile['findOne']({'email':_0x57d0c0[_0x27827b(0x193)]}),_0x5487b8=await master_shop['find']();let _0x200652;if(_0x57d0c0[_0x27827b(0x25b)]==_0x27827b(0x216)){const _0x4e218c=await staff[_0x27827b(0x1fa)]({'email':_0x57d0c0[_0x27827b(0x193)]});_0x200652=await sales['aggregate']([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':_0x27827b(0x278)}},{'$unwind':_0x27827b(0x1b2)},{'$unwind':_0x27827b(0x18a)},{'$group':{'_id':_0x27827b(0x18c),'invoice':{'$first':_0x27827b(0x254)},'customers':{'$first':_0x27827b(0x26d)},'date':{'$first':_0x27827b(0x227)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x27827b(0x18a)},'note':{'$first':_0x27827b(0x1e6)},'return_data':{'$first':_0x27827b(0x28b)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x27827b(0x1b6)},'level':{'$addToSet':_0x27827b(0x276)},'isle':{'$addToSet':_0x27827b(0x280)},'type':{'$addToSet':_0x27827b(0x232)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x27827b(0x23b)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x200652=await sales[_0x27827b(0x1cf)]([{'$lookup':{'from':_0x27827b(0x1e8),'localField':_0x27827b(0x25a),'foreignField':_0x27827b(0x265),'as':_0x27827b(0x278)}},{'$unwind':'$customers_docs'},{'$unwind':_0x27827b(0x18a)},{'$group':{'_id':_0x27827b(0x18c),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x27827b(0x26d)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x27827b(0x272)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x27827b(0x1b2)},'total_saleproduct_quantity':{'$sum':_0x27827b(0x1b6)},'level':{'$addToSet':_0x27827b(0x276)},'isle':{'$addToSet':_0x27827b(0x280)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x27827b(0x1c4)},'finalize':{'$first':_0x27827b(0x23b)},'isAllowEdit':{'$first':_0x27827b(0x1cc)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x27827b(0x26b)](_0x27827b(0x1dc),_0x200652);if(_0x5487b8[0x0][_0x27827b(0x256)]==_0x27827b(0x1a4)){var _0x29343e=users[_0x27827b(0x284)];console[_0x27827b(0x26b)](_0x29343e);}else{if(_0x5487b8[0x0][_0x27827b(0x256)]==_0x27827b(0x279))var _0x29343e=users[_0x27827b(0x279)];else{if(_0x5487b8[0x0][_0x27827b(0x256)]==_0x27827b(0x238))var _0x29343e=users[_0x27827b(0x238)];else{if(_0x5487b8[0x0][_0x27827b(0x256)]=='Spanish')var _0x29343e=users[_0x27827b(0x230)];else{if(_0x5487b8[0x0]['language']=='French')var _0x29343e=users['French'];else{if(_0x5487b8[0x0][_0x27827b(0x256)]==_0x27827b(0x1c5))var _0x29343e=users[_0x27827b(0x1f3)];else{if(_0x5487b8[0x0][_0x27827b(0x256)]==_0x27827b(0x22b))var _0x29343e=users[_0x27827b(0x22b)];else{if(_0x5487b8[0x0][_0x27827b(0x256)]=='Arabic\x20(ae)')var _0x29343e=users[_0x27827b(0x28a)];}}}}}}}_0x5651af['render'](_0x27827b(0x1d3),{'success':_0x283fb5[_0x27827b(0x1d1)]('success'),'errors':_0x283fb5[_0x27827b(0x1d1)](_0x27827b(0x288)),'sales':_0x200652,'profile':_0x1f25d9,'role':_0x57d0c0,'master_shop':_0x5487b8,'language':_0x29343e});}catch(_0x1af7b9){console[_0x27827b(0x26b)](_0x1af7b9);}});async function getRandom8DigitNumber(){var _0x509ce0=a0_0x3f8043;const _0xa0bfac=0x989680,_0x39536d=0x5f5e0ff,_0x5ea811=Math[_0x509ce0(0x229)](Math[_0x509ce0(0x26c)]()*(_0x39536d-_0xa0bfac+0x1))+_0xa0bfac;var _0x2195af;const _0x2c6aad=await sales[_0x509ce0(0x1fa)]({'invoice':_0x509ce0(0x243)+_0x5ea811});return _0x2c6aad&&_0x2c6aad[_0x509ce0(0x264)]>0x0?_0x2195af=_0x509ce0(0x243)+_0x5ea811:_0x2195af='OUT-'+_0x5ea811,_0x2195af;}function a0_0x5092(){var _0x298763=['storage','site_title','type','/../public','sale_qty','<h2>\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','maxperunit','Sales\x20Update\x20successfully','English\x20(US)','\x20</h2>','</body></html>','Error\x20Occurs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','invoice','findById','Ambient','edit_sales_view','/view/add_sales','/give_payment/:id','$product_details._id','add\x20post','room','$customers_docs','</span>','An\x20error\x20occurred\x20while\x20saving\x20data.','<hr\x20class=\x22my-3\x22>','$sale_product.quantity','sales\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','save','RMSEmail','/view/:id','Receiving\x20Area','body','logo','filter','sales_invoice','French','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.production_date','$sale_product.floorlevel','Portuguese\x20(BR)','product_name','Shelves','concat','express','_id','$product_details.delivery_code','$isAllowEdit','$product_details','</head><body>','aggregate','Logo.png','flash','Return\x20Goods','all_sales','$product_details.pallet','../public/language/languages.json','actual_uom','customer_data','batch_code','due_amount','room_name','user','sales\x20all_data','/view/return_sales/:id','$product_details.level','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Enclosed','date','forEach','<!DOCTYPE\x20html>','floorlevel','$note','603027CXxoXz','customers','$product_details.primary_code','quantity','sale_product','bay','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','25PNplbN','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','split','prod_invoice','Portuguese','/all_sales/preview/','return_data','delivery_date','8187bVPpIE','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','8vgLIQL','findOne','../models/all_models','render','5964352JQnUqi','<html><head><title></title>','getFullYear','2224iKqpJu','False','$product_details.maxPerUnit','stock','expiry_date','$product_details.expiry_date','params','error','product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_list','host','max','An\x20error\x20occurred.','note','../middleware/auth','Router','product','</table>','/barcode/:id','max_per_unit','/view/add_sale/product','staff','\x20Order\x20Number\x20:\x20','post','secondary_code','unit','<tr>','quantity_notConverted','$product_details.product_cat','product_data','$product_details.unit','71242EBxLMn','purchases_data','RoomAssigned','actual_qty','string','catch','$product.product_name','$date','production_date','floor','$product_details.delivery_date','Chinese','json','secondary_unit','carton','get','Spanish','<div>','$sale_product.type','prod_code','$product_details.bin','/upload/','$product_details.product_stock','bin','German','master','$product_details.rack','$finalize','Level','all','$product_details.floorlevel','prod_cat','<tbody\x20style=\x22text-align:\x20center;\x22>','getDate','then','OUT-','Floor','$product_details.invoice','True','$product_details.batch_code','</div>','Arabic\x20(ae)','stocks','$product_details.product_name','primary_unit','rack','$product','slice','</tbody>','$room','$product_details.storage','push','$invoice','<strong>\x20Regards\x20</strong>','language','</td>','requested_qty','product_code','customer','role','password','$name','44428110IDrnnZ','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.secondary_code','return_sale','createTransport','length','name','padStart','warehouse','SCRN','Sales\x20Mail','barcode\x20Product\x20master','log','random','$customer','Return\x20Rooms','currency','edit_sales','<span\x20style=\x22float:\x20right;\x22>','$warehouse_name','types','image','redirect','$sale_product.bay','exports','customers_docs','Hindi','</tr>','getMonth','id_transact','Raw\x20Materials','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','barcode\x20user_id','$sale_product.bin','level','delivery_code','back','English','450750gkcTXm','id_transaction_from','</h5>','errors','map','Arabic','$return_data','\x20Order\x20Date\x20:\x20','nodemailer','/view/add_sales/:id','sendMail','port','status','finalize','$product_details.type','<h5>','/invoice/:id','/all_sales/view','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','primary_code','</thead>','$product_details.secondary_unit','warehouse_name','add_sales','$sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$_id','$product_details.bay','success','product_stock','Sales\x20Add\x20successfully','$product_details.actual_qty','foreach\x20newproduct','email','$product_details.product_code','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','9252026vfEyip','received_amount','/preview/:id'];a0_0x5092=function(){return _0x298763;};return a0_0x5092();}router[a0_0x3f8043(0x22f)](a0_0x3f8043(0x1ad),auth,async(_0x1a3c35,_0xae8f05)=>{var _0x59d515=a0_0x3f8043;try{const {username:_0x1bab3e,email:_0x14353b,role:_0xc80bf1}=_0x1a3c35[_0x59d515(0x1db)],_0xcb3838=_0x1a3c35[_0x59d515(0x1db)],_0x548eab=await profile['findOne']({'email':_0xcb3838[_0x59d515(0x193)]}),_0xae8302=await master_shop[_0x59d515(0x1df)](),_0x4a4507=await customer[_0x59d515(0x1df)]({});let _0x366556;if(_0xcb3838['role']=='staff'){const _0x444540=await staff[_0x59d515(0x1fa)]({'email':_0xcb3838[_0x59d515(0x193)]});_0x366556=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x444540[_0x59d515(0x267)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x59d515(0x1d2)}}},{'$group':{'_id':_0x59d515(0x25d),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x366556=await warehouse['aggregate']([{'$match':{'status':_0x59d515(0x1ed),'warehouse_category':_0x59d515(0x27d),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x59d515(0x25d),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x13720e=await product[_0x59d515(0x1df)]({});var _0x45a46a=['Ambient',_0x59d515(0x1e1)];const _0x426fdf=await sales[_0x59d515(0x1df)]({}),_0x38a488=_0x426fdf[_0x59d515(0x264)]+0x1,_0x4c6de7='OUT-'+_0x38a488[_0x59d515(0x195)]()[_0x59d515(0x266)](0x5,'0');if(_0xae8302[0x0][_0x59d515(0x256)]==_0x59d515(0x1a4)){var _0xd1c0c4=users[_0x59d515(0x284)];console[_0x59d515(0x26b)](_0xd1c0c4);}else{if(_0xae8302[0x0][_0x59d515(0x256)]==_0x59d515(0x279))var _0xd1c0c4=users[_0x59d515(0x279)];else{if(_0xae8302[0x0]['language']==_0x59d515(0x238))var _0xd1c0c4=users['German'];else{if(_0xae8302[0x0][_0x59d515(0x256)]==_0x59d515(0x230))var _0xd1c0c4=users[_0x59d515(0x230)];else{if(_0xae8302[0x0]['language']==_0x59d515(0x1c1))var _0xd1c0c4=users[_0x59d515(0x1c1)];else{if(_0xae8302[0x0][_0x59d515(0x256)]==_0x59d515(0x1c5))var _0xd1c0c4=users['Portuguese'];else{if(_0xae8302[0x0][_0x59d515(0x256)]==_0x59d515(0x22b))var _0xd1c0c4=users['Chinese'];else{if(_0xae8302[0x0][_0x59d515(0x256)]==_0x59d515(0x249))var _0xd1c0c4=users[_0x59d515(0x28a)];}}}}}}}const _0x45593a=getRandom8DigitNumber();_0x45593a['then'](_0x56e08b=>{var _0x340f34=_0x59d515;_0xae8f05[_0x340f34(0x1fc)](_0x340f34(0x189),{'success':_0x1a3c35[_0x340f34(0x1d1)](_0x340f34(0x18e)),'errors':_0x1a3c35[_0x340f34(0x1d1)](_0x340f34(0x288)),'role':_0xcb3838,'profile':_0x548eab,'customer':_0x4a4507,'warehouse':_0x366556,'product':_0x13720e,'invoice':_0x56e08b,'master_shop':_0xae8302,'language':_0xd1c0c4,'rooms_data':_0x45a46a});})[_0x59d515(0x225)](_0x5213f9=>{var _0x3faf1c=_0x59d515;_0x1a3c35[_0x3faf1c(0x1d1)](_0x3faf1c(0x288),_0x3faf1c(0x1a8)),_0xae8f05[_0x3faf1c(0x275)]('/all_sales/view');});}catch(_0x542703){console[_0x59d515(0x26b)](_0x542703);}}),router['get'](a0_0x3f8043(0x28e),auth,async(_0x32493d,_0x508dd9)=>{var _0x1bac0a=a0_0x3f8043;try{const _0x27c319=_0x32493d[_0x1bac0a(0x206)]['id'];console[_0x1bac0a(0x26b)](_0x27c319);const _0x3d648b=await product[_0x1bac0a(0x1df)](),_0x50626c=await purchases['aggregate']([{'$match':{'warehouse_name':_0x27c319}},{'$unwind':_0x1bac0a(0x24e)},{'$group':{'_id':_0x1bac0a(0x226)}}]);console[_0x1bac0a(0x26b)](_0x1bac0a(0x221),_0x50626c),_0x508dd9[_0x1bac0a(0x291)](0xc8)[_0x1bac0a(0x22c)]({'purchases_data':_0x50626c,'product_data':_0x3d648b});}catch(_0x168c6b){console[_0x1bac0a(0x26b)](_0x168c6b);}}),router['post'](a0_0x3f8043(0x215),auth,async(_0x9c61b7,_0x545595)=>{var _0x58dcb1=a0_0x3f8043;try{const {warehouse_data:_0x3c4e6a,product_data:_0xaffdb3}=_0x9c61b7[_0x58dcb1(0x1bd)];console[_0x58dcb1(0x26b)](_0x9c61b7[_0x58dcb1(0x1bd)][_0x58dcb1(0x21e)]);;const _0x4b91b7=await master_shop[_0x58dcb1(0x1df)]();console[_0x58dcb1(0x26b)]('master',_0x4b91b7);const _0x19ac90=await product[_0x58dcb1(0x1fa)]({'name':_0xaffdb3});console['log'](_0x58dcb1(0x211),_0x19ac90);const _0x527458=await warehouse[_0x58dcb1(0x1cf)]([{'$match':{'name':_0x3c4e6a}},{'$unwind':_0x58dcb1(0x1cd)},{'$match':{'product_details.product_name':_0xaffdb3}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x58dcb1(0x236)}}}]);console[_0x58dcb1(0x26b)]('stock_data',_0x527458),_0x545595[_0x58dcb1(0x291)](0xc8)[_0x58dcb1(0x22c)]({'master':_0x4b91b7,'new_product':_0x19ac90,'stock_data':_0x527458});}catch(_0x58bd11){console[_0x58dcb1(0x26b)](_0x58bd11);}}),router['post'](a0_0x3f8043(0x1ad),auth,async(_0xfc8f3f,_0x17d40e)=>{var _0x5b72bd=a0_0x3f8043;try{const {invoice:_0x4e8dd9,date:_0x515430,warehouse_name:_0x3f0119,product_name:_0x3e1a39,stock:_0x212a90,quantity:_0x634995,note:_0x4d7ff0,room:_0x4b5df2,primary_code:_0x538fe1,secondary_code:_0x46727a,prod_code:_0xac0f03,level:_0x372e6f,isle:_0x4d90b8,pallet:_0x452ba0,batch_code:_0x2c37c8,SCRN:_0x203e4a,expiry_date:_0x9119c5}=_0xfc8f3f[_0x5b72bd(0x1bd)];if(typeof _0x3e1a39==_0x5b72bd(0x224))var _0x2054c6=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1c6)]],_0x1ca52e=[_0xfc8f3f[_0x5b72bd(0x1bd)]['stock']],_0x49be8f=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x22e)]],_0x106746=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x299)]],_0x4b448f=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x219)]],_0xb3c0a9=[_0xfc8f3f['body'][_0x5b72bd(0x233)]],_0x2d41af=[_0xfc8f3f[_0x5b72bd(0x1bd)]['level']],_0x3e8ebc=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x24c)]],_0x2be86d=[_0xfc8f3f['body'][_0x5b72bd(0x22d)]],_0x4a4688=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1d8)]],_0x63bf97=[_0xfc8f3f['body'][_0x5b72bd(0x204)]],_0x51cd8f=[_0xfc8f3f['body'][_0x5b72bd(0x214)]],_0x40477d=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x228)]],_0x2df0ca=[_0xfc8f3f[_0x5b72bd(0x1bd)]['requested_qty']],_0xc71451=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1f6)]],_0x4979bf=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x282)]],_0xf80477=[_0xfc8f3f['body'][_0x5b72bd(0x23f)]],_0x2f0c36=[_0xfc8f3f['body'][_0x5b72bd(0x1ea)]],_0x26a8aa=[_0xfc8f3f['body'][_0x5b72bd(0x222)]],_0x12c032=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1f2)]],_0x2c7fe2=[_0xfc8f3f[_0x5b72bd(0x1bd)]['actual_qty']],_0x118a49=[_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1d6)]],_0x2fe0ce=[_0xfc8f3f['body'][_0x5b72bd(0x27c)]];else var _0x2054c6=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1c6)]],_0x1ca52e=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x203)]],_0x49be8f=[..._0xfc8f3f['body']['carton']],_0x106746=[..._0xfc8f3f[_0x5b72bd(0x1bd)]['primary_code']],_0x4b448f=[..._0xfc8f3f[_0x5b72bd(0x1bd)]['secondary_code']],_0xb3c0a9=[..._0xfc8f3f['body'][_0x5b72bd(0x233)]],_0x2d41af=[..._0xfc8f3f['body'][_0x5b72bd(0x281)]],_0x3e8ebc=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x24c)]],_0x2be86d=[..._0xfc8f3f['body'][_0x5b72bd(0x22d)]],_0x4a4688=[..._0xfc8f3f['body'][_0x5b72bd(0x1d8)]],_0x63bf97=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x204)]],_0x51cd8f=[..._0xfc8f3f[_0x5b72bd(0x1bd)]['max_per_unit']],_0x40477d=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x228)]],_0x2df0ca=[..._0xfc8f3f[_0x5b72bd(0x1bd)]['requested_qty']],_0xc71451=[..._0xfc8f3f['body'][_0x5b72bd(0x1f6)]],_0x4979bf=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x282)]],_0xf80477=[..._0xfc8f3f['body'][_0x5b72bd(0x23f)]],_0x2f0c36=[..._0xfc8f3f['body'][_0x5b72bd(0x1ea)]],_0x26a8aa=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x222)]],_0x12c032=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1f2)]],_0x2c7fe2=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x223)]],_0x118a49=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x1d6)]],_0x2fe0ce=[..._0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x27c)]];const _0x4ad081=_0x2054c6[_0x5b72bd(0x289)](_0x1cb44d=>{return _0x1cb44d={'product_name':_0x1cb44d};});_0x1ca52e[_0x5b72bd(0x1e3)]((_0x23dc29,_0x26ae2b)=>{var _0x375b02=_0x5b72bd;_0x4ad081[_0x26ae2b]['stock']=Math[_0x375b02(0x25f)](_0x23dc29);}),_0x2c7fe2[_0x5b72bd(0x1e3)]((_0x4d261b,_0x450e6d)=>{var _0xbb5f31=_0x5b72bd;_0x4ad081[_0x450e6d][_0xbb5f31(0x223)]=Math['abs'](_0x4d261b);}),_0x118a49[_0x5b72bd(0x1e3)]((_0x34d67c,_0x4f2063)=>{var _0x3ee45e=_0x5b72bd;_0x4ad081[_0x4f2063][_0x3ee45e(0x1d6)]=_0x34d67c;}),_0x2fe0ce['forEach']((_0x3402fa,_0x1dd1ea)=>{var _0x39d781=_0x5b72bd;_0x4ad081[_0x1dd1ea][_0x39d781(0x286)]=_0x3402fa;}),_0x49be8f[_0x5b72bd(0x1e3)]((_0x44b585,_0x1360f8)=>{var _0x21c229=_0x5b72bd;_0x4ad081[_0x1360f8][_0x21c229(0x1ea)]=_0x44b585;}),_0x106746[_0x5b72bd(0x1e3)]((_0x1c5581,_0x357f85)=>{var _0x2b8878=_0x5b72bd;_0x4ad081[_0x357f85][_0x2b8878(0x299)]=_0x1c5581;}),_0x4b448f[_0x5b72bd(0x1e3)]((_0x528df4,_0x18b56b)=>{var _0x3c1255=_0x5b72bd;_0x4ad081[_0x18b56b][_0x3c1255(0x219)]=_0x528df4;}),_0xb3c0a9[_0x5b72bd(0x1e3)]((_0x93ddce,_0x29bf57)=>{var _0xfbea67=_0x5b72bd;_0x4ad081[_0x29bf57][_0xfbea67(0x259)]=_0x93ddce;}),_0x2d41af['forEach']((_0x3dec35,_0x226d8e)=>{var _0x598c88=_0x5b72bd;_0x26a8aa[_0x598c88(0x1e3)]((_0x4cfbfc,_0x28eef2)=>{var _0x16e6e4=_0x598c88;if(_0x4cfbfc==_0x16e6e4(0x1bc)&&_0x226d8e==_0x28eef2){var _0x1333e5=_0x3dec35[_0x16e6e4(0x24f)](0x3);_0x4ad081[_0x226d8e][_0x16e6e4(0x19b)]=_0x3dec35[0x0],_0x4ad081[_0x226d8e][_0x16e6e4(0x24d)]=_0x3dec35[0x1],_0x4ad081[_0x226d8e]['bay']=0x0,_0x4ad081[_0x226d8e][_0x16e6e4(0x237)]=0x0,_0x4ad081[_0x226d8e][_0x16e6e4(0x19d)]='Floor',_0x4ad081[_0x226d8e][_0x16e6e4(0x1e5)]=_0x1333e5;}else{if(_0x4cfbfc=='Shelves'&&_0x226d8e==_0x28eef2){var _0x1333e5=_0x3dec35[_0x16e6e4(0x24f)](0x3);_0x4ad081[_0x226d8e][_0x16e6e4(0x19b)]=_0x3dec35[0x0],_0x4ad081[_0x226d8e][_0x16e6e4(0x24d)]=_0x3dec35[0x1],_0x4ad081[_0x226d8e][_0x16e6e4(0x1ec)]=0x0,_0x4ad081[_0x226d8e][_0x16e6e4(0x237)]=0x0,_0x4ad081[_0x226d8e][_0x16e6e4(0x19d)]='Floor',_0x4ad081[_0x226d8e][_0x16e6e4(0x1e5)]=_0x3dec35[0x5];}else{if(_0x226d8e==_0x28eef2){var _0x24653e;if(_0x3dec35[0x4]=='L')_0x24653e='Level';else _0x3dec35[0x4]=='F'&&(_0x24653e=_0x16e6e4(0x244));_0x4ad081[_0x226d8e][_0x16e6e4(0x19b)]=_0x3dec35[0x0],_0x4ad081[_0x226d8e][_0x16e6e4(0x24d)]=_0x3dec35[0x1],_0x4ad081[_0x226d8e][_0x16e6e4(0x1ec)]=_0x3dec35[0x2],_0x4ad081[_0x226d8e]['bin']=_0x3dec35[0x3],_0x4ad081[_0x226d8e][_0x16e6e4(0x19d)]=_0x24653e,_0x4ad081[_0x226d8e][_0x16e6e4(0x1e5)]=_0x3dec35[0x5];}}}});}),_0x3e8ebc['forEach']((_0x20b514,_0xa634d9)=>{var _0x1c9e7e=_0x5b72bd;_0x4ad081[_0xa634d9][_0x1c9e7e(0x21a)]=_0x20b514;}),_0x2be86d[_0x5b72bd(0x1e3)]((_0x457ba1,_0x1afe60)=>{var _0x302d00=_0x5b72bd;_0x4ad081[_0x1afe60][_0x302d00(0x22d)]=_0x457ba1;}),_0x4a4688[_0x5b72bd(0x1e3)]((_0x444bef,_0x11ea53)=>{_0x4ad081[_0x11ea53]['batch_code']=_0x444bef;}),_0x63bf97['forEach']((_0x51fac4,_0x53c761)=>{_0x4ad081[_0x53c761]['expiry_date']=_0x51fac4;}),_0x51cd8f[_0x5b72bd(0x1e3)]((_0x1609f4,_0x1fd8a8)=>{var _0x5a50de=_0x5b72bd;_0x4ad081[_0x1fd8a8][_0x5a50de(0x1a2)]=_0x1609f4;}),_0x40477d[_0x5b72bd(0x1e3)]((_0x3d12da,_0x7238f7)=>{var _0x3b071c=_0x5b72bd;_0x4ad081[_0x7238f7][_0x3b071c(0x228)]=_0x3d12da;}),_0x2df0ca['forEach']((_0x49d677,_0x35bc2a)=>{_0x4ad081[_0x35bc2a]['requested_qty']=_0x49d677;}),_0xc71451[_0x5b72bd(0x1e3)]((_0x3d8d9b,_0x2d368)=>{var _0x40f31b=_0x5b72bd;_0x4ad081[_0x2d368][_0x40f31b(0x1f6)]=_0x3d8d9b;}),_0x4979bf['forEach']((_0x5536a9,_0x1034ee)=>{var _0x497e14=_0x5b72bd;_0x4ad081[_0x1034ee][_0x497e14(0x282)]=_0x5536a9;}),_0xf80477['forEach']((_0x2e42f6,_0x45fc12)=>{_0x4ad081[_0x45fc12]['prod_cat']=_0x2e42f6;}),_0x2f0c36['forEach']((_0x50e9c2,_0x5c5056)=>{var _0x1fe448=_0x5b72bd;_0x4ad081[_0x5c5056][_0x1fe448(0x21c)]=_0x50e9c2;}),_0x26a8aa[_0x5b72bd(0x1e3)]((_0x5414cc,_0x5d8644)=>{var _0x3d9ce4=_0x5b72bd;_0x4ad081[_0x5d8644][_0x3d9ce4(0x1da)]=_0x5414cc;}),_0x12c032[_0x5b72bd(0x1e3)]((_0x23c81d,_0x45774c)=>{var _0xb9a16e=_0x5b72bd;_0x4ad081[_0x45774c][_0xb9a16e(0x1a9)]=_0x23c81d;});var _0x4f574f=0x0;_0x4ad081['forEach'](_0x37d570=>{var _0x51cc0a=_0x5b72bd;(_0x37d570[_0x51cc0a(0x203)]<_0x37d570[_0x51cc0a(0x21c)]||_0x37d570['quantity_notConverted']==0x0)&&(console[_0x51cc0a(0x26b)](_0x51cc0a(0x192),_0x37d570),_0x4f574f++);});const _0x12f491=_0x4ad081['filter'](_0x33a548=>_0x33a548[_0x5b72bd(0x1ea)]!=='0'&&_0x33a548[_0x5b72bd(0x1ea)]!==''),_0x466eac=new sales({'invoice':_0x4e8dd9,'customer':_0xfc8f3f[_0x5b72bd(0x1bd)][_0x5b72bd(0x25a)],'date':_0x515430,'warehouse_name':_0x3f0119,'sale_product':_0x12f491,'note':_0x4d7ff0,'room':_0x4b5df2,'primary_code':_0x538fe1,'secondary_code':_0x46727a,'prod_code':_0xac0f03,'SCRN':_0x203e4a}),_0x299dfb=await _0x466eac[_0x5b72bd(0x1b9)]();_0xfc8f3f[_0x5b72bd(0x1d1)](_0x5b72bd(0x18e),_0x5b72bd(0x190)),_0x17d40e['redirect'](_0x5b72bd(0x1f4)+_0x299dfb[_0x5b72bd(0x1ca)]);}catch(_0xcf4f35){console[_0x5b72bd(0x26b)](_0xcf4f35);}}),router[a0_0x3f8043(0x22f)]('/preview/:id',auth,async(_0x4f811f,_0x29a3eb)=>{var _0x43833d=a0_0x3f8043;try{const {username:_0x5f8510,email:_0x3a3656,role:_0xc08bbf}=_0x4f811f[_0x43833d(0x1db)],_0x110266=_0x4f811f['user'],_0x312443=await profile[_0x43833d(0x1fa)]({'email':_0x110266[_0x43833d(0x193)]}),_0xda69fe=await master_shop['find'](),_0x2f68fa=_0x4f811f[_0x43833d(0x206)]['id'],_0x46011a=await sales[_0x43833d(0x1aa)](_0x2f68fa),_0x128dd5=await warehouse[_0x43833d(0x1cf)]([{'$match':{'name':_0x46011a[_0x43833d(0x188)]}},{'$unwind':_0x43833d(0x1cd)},{'$group':{'_id':_0x43833d(0x1af),'name':{'$first':_0x43833d(0x24b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x43833d(0x234)},'type':{'$first':_0x43833d(0x293)},'floorlevel':{'$first':_0x43833d(0x23e)},'primary_code':{'$first':_0x43833d(0x1e9)},'secondary_code':{'$first':_0x43833d(0x261)},'product_code':{'$first':_0x43833d(0x194)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x43833d(0x23a)},'expiry_date':{'$first':_0x43833d(0x205)},'production_date':{'$first':_0x43833d(0x1c3)},'invoice':{'$first':_0x43833d(0x245)}}}]),_0x3ff750=await customer['find']({});let _0x1f42ac;if(_0x110266[_0x43833d(0x25b)]==_0x43833d(0x216)){const _0x4f156=await staff[_0x43833d(0x1fa)]({'email':_0x110266[_0x43833d(0x193)]});_0x1f42ac=await warehouse[_0x43833d(0x1cf)]([{'$match':{'status':_0x43833d(0x1ed),'name':_0x4f156['warehouse']}},{'$group':{'_id':_0x43833d(0x25d),'name':{'$first':_0x43833d(0x25d)}}}]);}else _0x1f42ac=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x43833d(0x25d)}}}]);const _0x3396bd=await product['find']({}),_0x5031f3=await suppliers[_0x43833d(0x1df)]({});if(_0xda69fe[0x0][_0x43833d(0x256)]==_0x43833d(0x1a4)){var _0x47f5b7=users[_0x43833d(0x284)];console[_0x43833d(0x26b)](_0x47f5b7);}else{if(_0xda69fe[0x0]['language']==_0x43833d(0x279))var _0x47f5b7=users[_0x43833d(0x279)];else{if(_0xda69fe[0x0][_0x43833d(0x256)]=='German')var _0x47f5b7=users['German'];else{if(_0xda69fe[0x0]['language']==_0x43833d(0x230))var _0x47f5b7=users['Spanish'];else{if(_0xda69fe[0x0][_0x43833d(0x256)]=='French')var _0x47f5b7=users[_0x43833d(0x1c1)];else{if(_0xda69fe[0x0][_0x43833d(0x256)]=='Portuguese\x20(BR)')var _0x47f5b7=users[_0x43833d(0x1f3)];else{if(_0xda69fe[0x0][_0x43833d(0x256)]==_0x43833d(0x22b))var _0x47f5b7=users['Chinese'];else{if(_0xda69fe[0x0][_0x43833d(0x256)]==_0x43833d(0x249))var _0x47f5b7=users['Arabic'];}}}}}}}_0x29a3eb['render'](_0x43833d(0x1ac),{'success':_0x4f811f[_0x43833d(0x1d1)](_0x43833d(0x18e)),'errors':_0x4f811f['flash']('errors'),'role':_0x110266,'profile':_0x312443,'customer':_0x3ff750,'warehouse':_0x1f42ac,'product':_0x128dd5,'user':_0x46011a,'master_shop':_0xda69fe,'unit':_0x3396bd,'language':_0x47f5b7,'suppliers':_0x5031f3});}catch(_0x1bfbf5){console['log'](_0x1bfbf5);}}),router['post'](a0_0x3f8043(0x19a),auth,async(_0x441cce,_0x5731a7)=>{var _0x1dfdfc=a0_0x3f8043;try{const _0x118b4a=_0x441cce[_0x1dfdfc(0x206)]['id'],{invoice:_0x574ea3,warehouse_name:_0x5aa543,room:_0xe1b92e}=_0x441cce[_0x1dfdfc(0x1bd)],_0x3740ce=await sales['findOne']({'invoice':_0x574ea3}),_0x3a6372=_0x3740ce[_0x1dfdfc(0x1eb)][_0x1dfdfc(0x289)](async _0x5aa973=>{var _0x42547d=_0x1dfdfc,_0x5a8fce=await warehouse['findOne']({'name':_0x5aa543,'room':_0x5aa973[_0x42547d(0x1da)],'warehouse_category':_0x42547d(0x27d)});const _0x2e5087=_0x5a8fce['product_details'][_0x42547d(0x289)](_0x7c7428=>{var _0x3c101e=_0x42547d;_0x7c7428[_0x3c101e(0x1c6)]==_0x5aa973[_0x3c101e(0x1c6)]&&_0x7c7428['floorlevel']==_0x5aa973['floorlevel']&&_0x7c7428[_0x3c101e(0x19d)]==_0x5aa973[_0x3c101e(0x19d)]&&_0x7c7428[_0x3c101e(0x237)]==_0x5aa973['bin']&&_0x7c7428[_0x3c101e(0x1ec)]==_0x5aa973['bay']&&_0x7c7428[_0x3c101e(0x24d)]==_0x5aa973[_0x3c101e(0x24d)]&&_0x7c7428[_0x3c101e(0x19b)]==_0x5aa973[_0x3c101e(0x19b)]&&_0x7c7428[_0x3c101e(0x204)]==_0x5aa973[_0x3c101e(0x204)]&&_0x7c7428[_0x3c101e(0x1d8)]==_0x5aa973[_0x3c101e(0x1d8)]&&_0x7c7428[_0x3c101e(0x1ca)]==_0x5aa973[_0x3c101e(0x286)]&&(_0x7c7428['product_stock']=Math[_0x3c101e(0x20c)](0x0,Math[_0x3c101e(0x25f)](_0x7c7428[_0x3c101e(0x18f)])-Math[_0x3c101e(0x25f)](_0x5aa973[_0x3c101e(0x1ea)])));});return _0x5a8fce;});Promise[_0x1dfdfc(0x23d)](_0x3a6372)[_0x1dfdfc(0x242)](async _0xd19363=>{var _0x4c901f=_0x1dfdfc;try{for(const _0x432ab6 of _0xd19363){await _0x432ab6[_0x4c901f(0x1b9)]();}_0x3740ce[_0x4c901f(0x292)]=_0x4c901f(0x246);const _0x2b1ae8=await _0x3740ce[_0x4c901f(0x1b9)](),_0x4ea018=await master_shop[_0x4c901f(0x1df)](),_0x351937=await email_settings[_0x4c901f(0x1fa)](),_0xb2a15c=await supervisor_settings['find']();var _0x3d338d=_0x3740ce[_0x4c901f(0x1eb)],_0x4454c6='',_0x3e57ed;for(_0x3e57ed in _0x3d338d){_0x4454c6+=_0x4c901f(0x21b)+_0x4c901f(0x1f8)+_0x3d338d[_0x3e57ed][_0x4c901f(0x1c6)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d338d[_0x3e57ed][_0x4c901f(0x259)]+_0x4c901f(0x257)+_0x4c901f(0x1f8)+_0x3d338d[_0x3e57ed][_0x4c901f(0x1ea)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d338d[_0x3e57ed][_0x4c901f(0x21a)]+_0x4c901f(0x257)+_0x4c901f(0x1f8)+_0x3d338d[_0x3e57ed][_0x4c901f(0x22d)]+_0x4c901f(0x257)+_0x4c901f(0x1f8)+_0x3740ce[_0x4c901f(0x188)]+'</td>'+_0x4c901f(0x1f8)+_0x3d338d[_0x3e57ed][_0x4c901f(0x1da)]+_0x4c901f(0x257)+_0x4c901f(0x1f8)+_0x3d338d[_0x3e57ed][_0x4c901f(0x19b)]+_0x3d338d[_0x3e57ed][_0x4c901f(0x24d)]+_0x3d338d[_0x3e57ed][_0x4c901f(0x1ec)]+_0x3d338d[_0x3e57ed]['bin']+_0x3d338d[_0x3e57ed]['type'][0x0]+_0x3d338d[_0x3e57ed]['floorlevel']+_0x4c901f(0x257),_0x4c901f(0x27a);}let _0x4dc474=nodemailer[_0x4c901f(0x263)]({'host':_0x351937[_0x4c901f(0x20b)],'port':Number(_0x351937[_0x4c901f(0x290)]),'secure':![],'auth':{'user':_0x351937[_0x4c901f(0x193)],'pass':_0x351937['password']}}),_0x15e39f={'from':_0x351937[_0x4c901f(0x193)],'to':_0xb2a15c[0x0][_0x4c901f(0x1ba)],'subject':_0x4c901f(0x269),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x4ea018[0x0][_0x4c901f(0x274)],'cid':_0x4c901f(0x1be)}],'html':_0x4c901f(0x1e4)+'<html><head><title></title>'+_0x4c901f(0x1ce)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4c901f(0x231)+_0x4c901f(0x1a1)+_0x4c901f(0x248)+_0x4c901f(0x231)+_0x4c901f(0x1a0)+_0x4ea018[0x0][_0x4c901f(0x19c)]+'\x20</h2>'+_0x4c901f(0x248)+_0x4c901f(0x248)+'<hr\x20class=\x22my-3\x22>'+_0x4c901f(0x231)+_0x4c901f(0x197)+_0x4c901f(0x217)+_0x3740ce['invoice']+'\x20'+_0x4c901f(0x271)+'\x20Order\x20Date\x20:\x20'+_0x3740ce[_0x4c901f(0x1e2)]+'\x20'+'</span>'+'</h5>'+_0x4c901f(0x248)+_0x4c901f(0x1c2)+_0x4c901f(0x209)+_0x4c901f(0x21b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4c901f(0x1f0)+_0x4c901f(0x298)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4c901f(0x196)+_0x4c901f(0x1e0)+_0x4c901f(0x1b8)+_0x4c901f(0x1ee)+'</tr>'+'</thead>'+_0x4c901f(0x240)+'\x20'+_0x4454c6+'\x20'+_0x4c901f(0x250)+_0x4c901f(0x212)+_0x4c901f(0x231)+_0x4c901f(0x255)+_0x4c901f(0x294)+_0x4ea018[0x0]['site_title']+_0x4c901f(0x287)+_0x4c901f(0x248)+'</div>'+_0x4c901f(0x1a6)};_0x4dc474['sendMail'](_0x15e39f,function(_0x1e2082,_0x1b8464){var _0xd89a3a=_0x4c901f;_0x1e2082?(console[_0xd89a3a(0x26b)](_0x1e2082),console[_0xd89a3a(0x26b)]('Error\x20Occurs')):console[_0xd89a3a(0x26b)]('Email\x20sent\x20successfully');}),_0x441cce['flash'](_0x4c901f(0x18e),_0x4c901f(0x1a3)),_0x5731a7[_0x4c901f(0x275)](_0x4c901f(0x1f4)+_0x118b4a);}catch(_0x4989c0){console[_0x4c901f(0x207)](_0x4989c0),_0x5731a7[_0x4c901f(0x291)](0x1f4)[_0x4c901f(0x22c)]({'error':_0x4c901f(0x1b4)});}})[_0x1dfdfc(0x225)](_0x1c1f32=>{var _0x36e307=_0x1dfdfc;console['error'](_0x1c1f32),_0x5731a7[_0x36e307(0x291)](0x1f4)['json']({'error':_0x36e307(0x20d)});});}catch(_0x3eb732){console['log'](_0x3eb732);}}),router[a0_0x3f8043(0x22f)](a0_0x3f8043(0x1bb),auth,async(_0x3e553c,_0x38d4ea)=>{var _0x5d455=a0_0x3f8043;try{const {username:_0x20af95,email:_0x589e86,role:_0x4338f8}=_0x3e553c[_0x5d455(0x1db)],_0xbe92de=_0x3e553c[_0x5d455(0x1db)],_0x26df3a=await profile[_0x5d455(0x1fa)]({'email':_0xbe92de[_0x5d455(0x193)]}),_0x1a6716=await master_shop[_0x5d455(0x1df)](),_0x4fdc16=_0x3e553c[_0x5d455(0x206)]['id'],_0x213b6c=await sales[_0x5d455(0x1aa)](_0x4fdc16);var _0x4bfa07=[_0x5d455(0x1ab),'Enclosed'];const _0x23fa95=await warehouse[_0x5d455(0x1cf)]([{'$match':{'name':_0x213b6c[_0x5d455(0x188)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x5d455(0x1cd)},{'$group':{'_id':_0x5d455(0x1af),'name':{'$first':_0x5d455(0x24b)},'product_stock':{'$first':_0x5d455(0x236)},'bay':{'$first':_0x5d455(0x18d)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5d455(0x293)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d455(0x261)},'product_code':{'$first':_0x5d455(0x194)},'storage':{'$first':_0x5d455(0x252)},'rack':{'$first':_0x5d455(0x23a)}}}]),_0x194e2e=await customer[_0x5d455(0x1df)]({});let _0x24045a;if(_0xbe92de[_0x5d455(0x25b)]==_0x5d455(0x216)){const _0x30fc48=await staff[_0x5d455(0x1fa)]({'email':_0xbe92de['email']});_0x24045a=await warehouse['aggregate']([{'$match':{'status':_0x5d455(0x1ed),'name':_0x30fc48['warehouse'],'warehouse_category':_0x5d455(0x27d)}},{'$group':{'_id':_0x5d455(0x25d),'name':{'$first':_0x5d455(0x25d)}}}]);}else _0x24045a=await warehouse[_0x5d455(0x1cf)]([{'$match':{'status':_0x5d455(0x1ed),'warehouse_category':_0x5d455(0x27d)}},{'$group':{'_id':_0x5d455(0x25d),'name':{'$first':_0x5d455(0x25d)}}}]);const _0x2c184d=await product[_0x5d455(0x1df)]({});if(_0x1a6716[0x0][_0x5d455(0x256)]==_0x5d455(0x1a4)){var _0x3d791d=users['English'];console[_0x5d455(0x26b)](_0x3d791d);}else{if(_0x1a6716[0x0][_0x5d455(0x256)]=='Hindi')var _0x3d791d=users[_0x5d455(0x279)];else{if(_0x1a6716[0x0][_0x5d455(0x256)]==_0x5d455(0x238))var _0x3d791d=users[_0x5d455(0x238)];else{if(_0x1a6716[0x0]['language']=='Spanish')var _0x3d791d=users[_0x5d455(0x230)];else{if(_0x1a6716[0x0]['language']==_0x5d455(0x1c1))var _0x3d791d=users['French'];else{if(_0x1a6716[0x0][_0x5d455(0x256)]=='Portuguese\x20(BR)')var _0x3d791d=users[_0x5d455(0x1f3)];else{if(_0x1a6716[0x0]['language']==_0x5d455(0x22b))var _0x3d791d=users['Chinese'];else{if(_0x1a6716[0x0]['language']==_0x5d455(0x249))var _0x3d791d=users[_0x5d455(0x28a)];}}}}}}}_0x38d4ea[_0x5d455(0x1fc)](_0x5d455(0x270),{'success':_0x3e553c[_0x5d455(0x1d1)](_0x5d455(0x18e)),'errors':_0x3e553c[_0x5d455(0x1d1)](_0x5d455(0x288)),'role':_0xbe92de,'profile':_0x26df3a,'customer':_0x194e2e,'warehouse':_0x24045a,'product':_0x23fa95,'user':_0x213b6c,'master_shop':_0x1a6716,'unit':_0x2c184d,'language':_0x3d791d});}catch(_0x5cf00d){console[_0x5d455(0x26b)](_0x5cf00d);}}),router[a0_0x3f8043(0x218)](a0_0x3f8043(0x1bb),auth,async(_0x268ace,_0x4df5ad)=>{var _0x2f403e=a0_0x3f8043;try{const _0x5e6a16=_0x268ace['params']['id'],_0x1184df=await sales['findOne']({'_id':_0x268ace[_0x2f403e(0x206)]['id']}),_0xc21cfd=await warehouse[_0x2f403e(0x1fa)]({'name':_0x1184df[_0x2f403e(0x188)],'room':_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x1b1)]}),{invoice:_0x219945,date:_0x58ae1e,warehouse_name:_0x85efdc,product_name:_0x3634db,stock:_0xce9b29,quantity:_0x5dc82c,note:_0x4a64bc,room:_0x446a6f,customer:_0x43ae0d,SCRN:_0xb7dab0}=_0x268ace[_0x2f403e(0x1bd)];if(typeof _0x3634db==_0x2f403e(0x224))var _0x219928=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x1c6)]],_0x24981e=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x203)]],_0x3d2582=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x22e)]],_0x42df1f=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x299)]],_0x53248e=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x219)]],_0x408a42=[_0x268ace['body'][_0x2f403e(0x233)]],_0x21658c=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x281)]],_0x2db4b4=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x24c)]],_0x24252f=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x22d)]],_0x598bc5=[_0x268ace[_0x2f403e(0x1bd)]['batch_code']],_0x11412a=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x204)]],_0x275205=[_0x268ace[_0x2f403e(0x1bd)]['max_per_unit']],_0x1dd477=[_0x268ace['body'][_0x2f403e(0x228)]],_0x295d92=[_0x268ace['body'][_0x2f403e(0x258)]],_0x3a14f1=[_0x268ace['body'][_0x2f403e(0x1f6)]],_0x4c0b13=[_0x268ace[_0x2f403e(0x1bd)]['delivery_code']],_0x351e42=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x23f)]],_0x4480ec=[_0x268ace[_0x2f403e(0x1bd)]['quantity']],_0x11122e=[_0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x222)]];else var _0x219928=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x1c6)]],_0x24981e=[..._0x268ace['body'][_0x2f403e(0x203)]],_0x3d2582=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x22e)]],_0x42df1f=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x299)]],_0x53248e=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x219)]],_0x408a42=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x233)]],_0x21658c=[..._0x268ace['body']['level']],_0x2db4b4=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x24c)]],_0x24252f=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x22d)]],_0x598bc5=[..._0x268ace['body'][_0x2f403e(0x1d8)]],_0x11412a=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x204)]],_0x275205=[..._0x268ace['body'][_0x2f403e(0x214)]],_0x1dd477=[..._0x268ace[_0x2f403e(0x1bd)]['production_date']],_0x295d92=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x258)]],_0x3a14f1=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x1f6)]],_0x4c0b13=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x282)]],_0x351e42=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x23f)]],_0x4480ec=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x1ea)]],_0x11122e=[..._0x268ace[_0x2f403e(0x1bd)][_0x2f403e(0x222)]];const _0x340f13=_0x219928['map'](_0x1d3457=>{return _0x1d3457={'product_name':_0x1d3457};});_0x24981e[_0x2f403e(0x1e3)]((_0x734368,_0xae5786)=>{var _0x15f57e=_0x2f403e;_0x340f13[_0xae5786][_0x15f57e(0x203)]=Math['abs'](_0x734368);}),_0x3d2582[_0x2f403e(0x1e3)]((_0xadcebc,_0x244b9c)=>{var _0x32dc13=_0x2f403e;_0x340f13[_0x244b9c][_0x32dc13(0x1ea)]=_0xadcebc;}),_0x42df1f[_0x2f403e(0x1e3)]((_0x1b19ae,_0x9fcc41)=>{_0x340f13[_0x9fcc41]['primary_code']=_0x1b19ae;}),_0x53248e[_0x2f403e(0x1e3)]((_0x37f1fe,_0x2a6325)=>{_0x340f13[_0x2a6325]['secondary_code']=_0x37f1fe;}),_0x408a42[_0x2f403e(0x1e3)]((_0x1e2b03,_0x1a54a4)=>{var _0x238aa8=_0x2f403e;_0x340f13[_0x1a54a4][_0x238aa8(0x259)]=_0x1e2b03;}),_0x21658c[_0x2f403e(0x1e3)]((_0xf7c94f,_0x509bf1)=>{var _0x478f4b=_0x2f403e;_0x11122e[_0x478f4b(0x1e3)]((_0x202351,_0x5e756d)=>{var _0x1235e4=_0x478f4b;if(_0x202351==_0x1235e4(0x1bc)&&_0x509bf1==_0x5e756d){var _0x98665=_0xf7c94f['slice'](0x3);_0x340f13[_0x509bf1]['storage']=_0xf7c94f[0x0],_0x340f13[_0x509bf1][_0x1235e4(0x24d)]=_0xf7c94f[0x1],_0x340f13[_0x509bf1]['bay']=0x0,_0x340f13[_0x509bf1]['bin']=0x0,_0x340f13[_0x509bf1][_0x1235e4(0x19d)]=_0x1235e4(0x244),_0x340f13[_0x509bf1]['floorlevel']=_0x98665;}else{if(_0x202351==_0x1235e4(0x1c7)&&_0x509bf1==_0x5e756d){var _0x98665=_0xf7c94f['slice'](0x3);_0x340f13[_0x509bf1]['storage']=_0xf7c94f[0x0],_0x340f13[_0x509bf1][_0x1235e4(0x24d)]=_0xf7c94f[0x1],_0x340f13[_0x509bf1][_0x1235e4(0x1ec)]=0x0,_0x340f13[_0x509bf1][_0x1235e4(0x237)]=0x0,_0x340f13[_0x509bf1][_0x1235e4(0x19d)]=_0x1235e4(0x244),_0x340f13[_0x509bf1][_0x1235e4(0x1e5)]=_0xf7c94f[0x5];}else{if(_0x509bf1==_0x5e756d){var _0x352f73;if(_0xf7c94f[0x4]=='L')_0x352f73=_0x1235e4(0x23c);else _0xf7c94f[0x4]=='F'&&(_0x352f73='Floor');_0x340f13[_0x509bf1][_0x1235e4(0x19b)]=_0xf7c94f[0x0],_0x340f13[_0x509bf1][_0x1235e4(0x24d)]=_0xf7c94f[0x1],_0x340f13[_0x509bf1][_0x1235e4(0x1ec)]=_0xf7c94f[0x2],_0x340f13[_0x509bf1][_0x1235e4(0x237)]=_0xf7c94f[0x3],_0x340f13[_0x509bf1][_0x1235e4(0x19d)]=_0x352f73,_0x340f13[_0x509bf1][_0x1235e4(0x1e5)]=_0xf7c94f[0x5];}}}});}),_0x2db4b4[_0x2f403e(0x1e3)]((_0x550559,_0x1244a7)=>{var _0x30676=_0x2f403e;_0x340f13[_0x1244a7][_0x30676(0x21a)]=_0x550559;}),_0x24252f[_0x2f403e(0x1e3)]((_0x4b23eb,_0x5701b8)=>{var _0x2b8f00=_0x2f403e;_0x340f13[_0x5701b8][_0x2b8f00(0x22d)]=_0x4b23eb;}),_0x598bc5['forEach']((_0x243bd5,_0x242d9d)=>{_0x340f13[_0x242d9d]['batch_code']=_0x243bd5;}),_0x11412a[_0x2f403e(0x1e3)]((_0x4b50db,_0x493a1c)=>{var _0xaef515=_0x2f403e;_0x340f13[_0x493a1c][_0xaef515(0x204)]=_0x4b50db;}),_0x275205[_0x2f403e(0x1e3)]((_0x35a510,_0x12758d)=>{var _0x3845d1=_0x2f403e;_0x340f13[_0x12758d][_0x3845d1(0x1a2)]=_0x35a510;}),_0x1dd477['forEach']((_0x1c49b5,_0x204bb4)=>{var _0x30674c=_0x2f403e;_0x340f13[_0x204bb4][_0x30674c(0x228)]=_0x1c49b5;}),_0x295d92['forEach']((_0x59049d,_0x247119)=>{var _0x2bd033=_0x2f403e;_0x340f13[_0x247119][_0x2bd033(0x258)]=Math['abs'](_0x59049d);}),_0x3a14f1[_0x2f403e(0x1e3)]((_0x8ec93,_0x262483)=>{var _0x4367cf=_0x2f403e;_0x340f13[_0x262483][_0x4367cf(0x1f6)]=_0x8ec93;}),_0x4c0b13[_0x2f403e(0x1e3)]((_0xea427a,_0xfe934b)=>{var _0x46a5ce=_0x2f403e;_0x340f13[_0xfe934b][_0x46a5ce(0x282)]=_0xea427a;}),_0x351e42[_0x2f403e(0x1e3)]((_0x571fff,_0x6bce4f)=>{var _0xcfab26=_0x2f403e;_0x340f13[_0x6bce4f][_0xcfab26(0x23f)]=_0x571fff;}),_0x4480ec[_0x2f403e(0x1e3)]((_0xe54f98,_0x561a1d)=>{var _0x3b3e0b=_0x2f403e;_0x340f13[_0x561a1d][_0x3b3e0b(0x21c)]=_0xe54f98;}),_0x11122e[_0x2f403e(0x1e3)]((_0x2e2fc9,_0x33a9f8)=>{var _0x89fc0=_0x2f403e;_0x340f13[_0x33a9f8][_0x89fc0(0x1da)]=_0x2e2fc9;});var _0x574e80=0x0;_0x340f13['forEach'](_0x1480d7=>{var _0x4697b4=_0x2f403e;console[_0x4697b4(0x26b)](_0x4697b4(0x192),_0x1480d7),(parseInt(_0x1480d7[_0x4697b4(0x203)])<parseInt(_0x1480d7['quantity'])||parseInt(_0x1480d7['quantity'])==0x0)&&_0x574e80++;});if(_0x574e80!=0x0)return _0x268ace[_0x2f403e(0x1d1)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x4df5ad[_0x2f403e(0x275)]('back');const _0x401556=_0x340f13[_0x2f403e(0x1bf)](_0x438f77=>_0x438f77[_0x2f403e(0x1ea)]!=='0'&&_0x438f77[_0x2f403e(0x1ea)]!=='');_0x1184df[_0x2f403e(0x1a9)]=_0x219945,_0x1184df[_0x2f403e(0x25a)]=_0x43ae0d,_0x1184df[_0x2f403e(0x1e2)]=_0x58ae1e,_0x1184df[_0x2f403e(0x188)]=_0x85efdc,_0x1184df['sale_product']=_0x401556,_0x1184df[_0x2f403e(0x20e)]=_0x4a64bc,_0x1184df[_0x2f403e(0x268)]=_0xb7dab0,_0x1184df[_0x2f403e(0x292)]=_0x2f403e(0x201),_0x1184df['isAllowEdit']='False';const _0x1972e3=await _0x1184df[_0x2f403e(0x1b9)]();_0x268ace[_0x2f403e(0x1d1)](_0x2f403e(0x18e),_0x2f403e(0x1a3)),_0x4df5ad[_0x2f403e(0x275)]('/all_sales/view');}catch(_0x454fea){console[_0x2f403e(0x26b)](_0x454fea);}}),router['post'](a0_0x3f8043(0x1ae),auth,async(_0x348427,_0x1fa004)=>{var _0x1a1bc1=a0_0x3f8043;try{const _0x570c33=_0x348427[_0x1a1bc1(0x206)]['id'],{invoice:_0x1e5a89,customer:_0x304d11,receivable_amount:_0x36640c,received_amount:_0xda637d}=_0x348427[_0x1a1bc1(0x1bd)],_0x4da2d3=await sales[_0x1a1bc1(0x1aa)](_0x570c33);console[_0x1a1bc1(0x26b)](_0x4da2d3);var _0xaad9f5=_0x36640c-_0xda637d;console[_0x1a1bc1(0x26b)](_0xda637d),_0x4da2d3[_0x1a1bc1(0x199)]=parseFloat(_0xda637d)+parseFloat(_0x4da2d3[_0x1a1bc1(0x199)]),_0x4da2d3[_0x1a1bc1(0x1d9)]=_0xaad9f5,console[_0x1a1bc1(0x26b)](_0x4da2d3);const _0x4540dc=await _0x4da2d3[_0x1a1bc1(0x1b9)](),_0x42e32f=await c_payment_data[_0x1a1bc1(0x1fa)]({'invoice':_0x1e5a89});_0x42e32f['amount']=_0xaad9f5,await _0x42e32f['save']();let _0xb55fad=new Date(),_0x3c0a39=('0'+_0xb55fad[_0x1a1bc1(0x241)]())[_0x1a1bc1(0x24f)](-0x2),_0x5d1ce8=('0'+(_0xb55fad[_0x1a1bc1(0x27b)]()+0x1))[_0x1a1bc1(0x24f)](-0x2),_0x52c9d7=_0xb55fad[_0x1a1bc1(0x1ff)](),_0x3f0839=_0x52c9d7+'-'+_0x5d1ce8+'-'+_0x3c0a39;const _0x5c86a9=new customer_payment({'invoice':_0x1e5a89,'date':_0x52c9d7+'-'+_0x5d1ce8+'-'+_0x3c0a39,'customer':_0x304d11,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0xda637d}),_0xad3b3a=await _0x5c86a9[_0x1a1bc1(0x1b9)]();_0x348427[_0x1a1bc1(0x1d1)](_0x1a1bc1(0x18e),'payment\x20successfull'),_0x1fa004[_0x1a1bc1(0x275)]('/all_sales/view');}catch(_0x3de37a){console[_0x1a1bc1(0x26b)](_0x3de37a);}}),router[a0_0x3f8043(0x22f)](a0_0x3f8043(0x295),auth,async(_0x2462a6,_0x762504)=>{var _0x3cfde1=a0_0x3f8043;try{const {username:_0x37fcaf,email:_0x1dff7,role:_0x213104}=_0x2462a6[_0x3cfde1(0x1db)],_0x4db6ff=_0x2462a6[_0x3cfde1(0x1db)],_0x3eb5cb=await profile[_0x3cfde1(0x1fa)]({'email':_0x4db6ff[_0x3cfde1(0x193)]}),_0x452427=await master_shop[_0x3cfde1(0x1df)]();console[_0x3cfde1(0x26b)](_0x3cfde1(0x239),_0x452427);const _0x5c3c2b=_0x2462a6[_0x3cfde1(0x206)]['id'],_0x5f20b2=await sales[_0x3cfde1(0x1aa)](_0x5c3c2b);console[_0x3cfde1(0x26b)](_0x5f20b2);const _0x4a6e25=await customer[_0x3cfde1(0x1fa)]({'name':_0x5f20b2[_0x3cfde1(0x25a)]});console[_0x3cfde1(0x26b)](_0x4a6e25);if(_0x452427[0x0]['language']==_0x3cfde1(0x1a4)){var _0x7119ec=users[_0x3cfde1(0x284)];console[_0x3cfde1(0x26b)](_0x7119ec);}else{if(_0x452427[0x0][_0x3cfde1(0x256)]==_0x3cfde1(0x279))var _0x7119ec=users['Hindi'];else{if(_0x452427[0x0][_0x3cfde1(0x256)]==_0x3cfde1(0x238))var _0x7119ec=users[_0x3cfde1(0x238)];else{if(_0x452427[0x0][_0x3cfde1(0x256)]==_0x3cfde1(0x230))var _0x7119ec=users['Spanish'];else{if(_0x452427[0x0]['language']==_0x3cfde1(0x1c1))var _0x7119ec=users[_0x3cfde1(0x1c1)];else{if(_0x452427[0x0][_0x3cfde1(0x256)]==_0x3cfde1(0x1c5))var _0x7119ec=users[_0x3cfde1(0x1f3)];else{if(_0x452427[0x0][_0x3cfde1(0x256)]==_0x3cfde1(0x22b))var _0x7119ec=users['Chinese'];else{if(_0x452427[0x0]['language']==_0x3cfde1(0x249))var _0x7119ec=users[_0x3cfde1(0x28a)];}}}}}}}_0x762504[_0x3cfde1(0x1fc)](_0x3cfde1(0x1c0),{'success':_0x2462a6[_0x3cfde1(0x1d1)](_0x3cfde1(0x18e)),'errors':_0x2462a6[_0x3cfde1(0x1d1)](_0x3cfde1(0x288)),'role':_0x4db6ff,'profile':_0x3eb5cb,'master_shop':_0x452427,'customers':_0x4a6e25,'sales':_0x5f20b2,'language':_0x7119ec});}catch(_0x136936){console[_0x3cfde1(0x26b)](_0x136936);}}),router[a0_0x3f8043(0x22f)]('/view/return_sales/:id',auth,async(_0xcc70ad,_0x212f2c)=>{var _0x8c3b1c=a0_0x3f8043;try{const {username:_0x353b2e,email:_0x57a091,role:_0x16ed21}=_0xcc70ad[_0x8c3b1c(0x1db)],_0x4086b4=_0xcc70ad[_0x8c3b1c(0x1db)],_0x1eda89=await profile[_0x8c3b1c(0x1fa)]({'email':_0x4086b4[_0x8c3b1c(0x193)]}),_0x4bd775=await master_shop[_0x8c3b1c(0x1df)]();console[_0x8c3b1c(0x26b)](_0x8c3b1c(0x239),_0x4bd775);const _0x3827cd=_0xcc70ad[_0x8c3b1c(0x206)]['id'];console[_0x8c3b1c(0x26b)](_0x3827cd);const _0x3aa8c3=await sales[_0x8c3b1c(0x1aa)](_0x3827cd);console[_0x8c3b1c(0x26b)]('user_id',_0x3aa8c3);const _0x4373b3=await warehouse[_0x8c3b1c(0x1cf)]([{'$match':{'name':_0x8c3b1c(0x1d2),'room':_0x8c3b1c(0x26e)}},{'$unwind':_0x8c3b1c(0x1cd)},{'$group':{'_id':_0x8c3b1c(0x1af),'name':{'$first':_0x8c3b1c(0x24b)},'product_stock':{'$first':_0x8c3b1c(0x236)},'level':{'$first':_0x8c3b1c(0x1de)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x8c3b1c(0x1d4)},'primary_code':{'$first':_0x8c3b1c(0x1e9)},'secondary_code':{'$first':_0x8c3b1c(0x261)},'product_code':{'$first':_0x8c3b1c(0x194)}}}]);console[_0x8c3b1c(0x26b)]('stock_data',_0x4373b3);const _0x31dde7=await product['find']({});warehouse_data=await warehouse[_0x8c3b1c(0x1cf)]([{'$match':{'status':_0x8c3b1c(0x1ed),'name':_0x8c3b1c(0x1d2),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x8c3b1c(0x25d),'name':{'$first':_0x8c3b1c(0x25d)}}},{'$sort':{'name':0x1}}]);var _0x44cc34=[_0x8c3b1c(0x26e)];if(_0x4bd775[0x0][_0x8c3b1c(0x256)]==_0x8c3b1c(0x1a4)){var _0x139621=users[_0x8c3b1c(0x284)];console['log'](_0x139621);}else{if(_0x4bd775[0x0]['language']==_0x8c3b1c(0x279))var _0x139621=users[_0x8c3b1c(0x279)];else{if(_0x4bd775[0x0][_0x8c3b1c(0x256)]=='German')var _0x139621=users[_0x8c3b1c(0x238)];else{if(_0x4bd775[0x0]['language']==_0x8c3b1c(0x230))var _0x139621=users[_0x8c3b1c(0x230)];else{if(_0x4bd775[0x0][_0x8c3b1c(0x256)]==_0x8c3b1c(0x1c1))var _0x139621=users[_0x8c3b1c(0x1c1)];else{if(_0x4bd775[0x0][_0x8c3b1c(0x256)]==_0x8c3b1c(0x1c5))var _0x139621=users['Portuguese'];else{if(_0x4bd775[0x0][_0x8c3b1c(0x256)]==_0x8c3b1c(0x22b))var _0x139621=users[_0x8c3b1c(0x22b)];else{if(_0x4bd775[0x0][_0x8c3b1c(0x256)]==_0x8c3b1c(0x249))var _0x139621=users[_0x8c3b1c(0x28a)];}}}}}}}_0x212f2c[_0x8c3b1c(0x1fc)](_0x8c3b1c(0x262),{'success':_0xcc70ad['flash'](_0x8c3b1c(0x18e)),'errors':_0xcc70ad[_0x8c3b1c(0x1d1)]('errors'),'role':_0x4086b4,'profile':_0x1eda89,'user':_0x3aa8c3,'stock':_0x4373b3,'master_shop':_0x4bd775,'unit':_0x31dde7,'language':_0x139621,'warehouses':warehouse_data,'rooms':_0x44cc34});}catch(_0x3f7f4e){console[_0x8c3b1c(0x26b)](_0x3f7f4e),_0x212f2c[_0x8c3b1c(0x291)](0xc8)['json']({'message':_0x3f7f4e['message']});}}),router[a0_0x3f8043(0x218)](a0_0x3f8043(0x1dd),auth,async(_0x3b60a4,_0x57bf41)=>{var _0x319d6a=a0_0x3f8043;try{const {invoice:_0x26dcbe,date:_0xefc008,warehouse_name:_0x7b6b35,product_name:_0x42b10d,primary_code:_0x42b6bd,secondary_code:_0x2829f1,product_code:_0x280717,sales_quantity:_0x54530b,stocks:_0x43f06a,return_qty:_0x1fc2cf,Room_name:_0x347445,to_warehouse_name:_0x533dee,to_Roomname:_0x20e2f5,to_Room_name:_0x560734,note:_0xfb4777,level:_0x5a200e,isle:_0x1fc476,pallet:_0x52bdf3}=_0x3b60a4[_0x319d6a(0x1bd)];if(typeof _0x42b10d==_0x319d6a(0x224))var _0x3e1c14=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x1c6)]],_0x22be4e=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x299)]],_0x433f3f=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x219)]],_0x5331f5=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x259)]],_0x32d0dd=[_0x3b60a4[_0x319d6a(0x1bd)]['sales_quantity']],_0x560c4b=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x24a)]],_0x59221c=[_0x3b60a4[_0x319d6a(0x1bd)]['return_qty']],_0x1e13f1=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x1ec)]],_0x1c08ea=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x237)]],_0x257ace=[_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x273)]],_0x5d614a=[_0x3b60a4['body'][_0x319d6a(0x1e5)]];else var _0x3e1c14=[..._0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x1c6)]],_0x22be4e=[..._0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x299)]],_0x433f3f=[..._0x3b60a4[_0x319d6a(0x1bd)]['secondary_code']],_0x5331f5=[..._0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x259)]],_0x32d0dd=[..._0x3b60a4[_0x319d6a(0x1bd)]['sales_quantity']],_0x560c4b=[..._0x3b60a4['body'][_0x319d6a(0x24a)]],_0x59221c=[..._0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x297)]],_0x1e13f1=[..._0x3b60a4[_0x319d6a(0x1bd)]['bay']],_0x1c08ea=[..._0x3b60a4[_0x319d6a(0x1bd)]['bin']],_0x257ace=[..._0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x273)]],_0x5d614a=[..._0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x1e5)]];const _0x4e36d9=_0x3e1c14['map'](_0x46d049=>{return _0x46d049={'product_name':_0x46d049};});_0x22be4e[_0x319d6a(0x1e3)]((_0x52cdf9,_0x5bd33e)=>{var _0x22793a=_0x319d6a;_0x4e36d9[_0x5bd33e][_0x22793a(0x299)]=_0x52cdf9;}),_0x433f3f[_0x319d6a(0x1e3)]((_0x5d7359,_0x55fb9d)=>{var _0x3223fd=_0x319d6a;_0x4e36d9[_0x55fb9d][_0x3223fd(0x219)]=_0x5d7359;}),_0x5331f5[_0x319d6a(0x1e3)]((_0x404ef8,_0x921854)=>{var _0x7a0266=_0x319d6a;_0x4e36d9[_0x921854][_0x7a0266(0x259)]=_0x404ef8;}),_0x32d0dd[_0x319d6a(0x1e3)]((_0x42cc75,_0x379411)=>{var _0x4a53b7=_0x319d6a;_0x4e36d9[_0x379411][_0x4a53b7(0x19f)]=_0x42cc75;}),_0x560c4b[_0x319d6a(0x1e3)]((_0x371bb5,_0x3af83e)=>{var _0xfb7bd1=_0x319d6a;_0x4e36d9[_0x3af83e][_0xfb7bd1(0x203)]=_0x371bb5;}),_0x59221c[_0x319d6a(0x1e3)]((_0x15db7c,_0x944d21)=>{var _0x1fe9a3=_0x319d6a;_0x4e36d9[_0x944d21][_0x1fe9a3(0x297)]=_0x15db7c;}),_0x1e13f1[_0x319d6a(0x1e3)]((_0x55e36a,_0x59ee6f)=>{var _0x54529b=_0x319d6a;_0x4e36d9[_0x59ee6f][_0x54529b(0x1ec)]=_0x55e36a;}),_0x1c08ea['forEach']((_0x9cd744,_0x482970)=>{var _0x848921=_0x319d6a;_0x4e36d9[_0x482970][_0x848921(0x237)]=_0x9cd744;}),_0x257ace[_0x319d6a(0x1e3)]((_0x53ba25,_0x78205b)=>{var _0x18fccf=_0x319d6a;_0x4e36d9[_0x78205b][_0x18fccf(0x19d)]=_0x53ba25;}),_0x5d614a[_0x319d6a(0x1e3)]((_0x30f3aa,_0x134907)=>{var _0x38b7b2=_0x319d6a;_0x4e36d9[_0x134907][_0x38b7b2(0x1e5)]=_0x30f3aa;});var _0x35927d=0x0;_0x4e36d9['forEach'](_0x14675e=>{var _0x150ae3=_0x319d6a;console[_0x150ae3(0x26b)](_0x150ae3(0x192),_0x14675e),(parseInt(_0x14675e[_0x150ae3(0x19f)])<parseInt(_0x14675e['return_qty'])||parseInt(_0x14675e[_0x150ae3(0x203)])<parseInt(_0x14675e[_0x150ae3(0x297)])&&parseInt(_0x14675e[_0x150ae3(0x19f)])>parseInt(_0x14675e[_0x150ae3(0x297)])||parseInt(_0x14675e[_0x150ae3(0x297)])==0x0)&&_0x35927d++;});if(_0x35927d!=0x0)return _0x3b60a4[_0x319d6a(0x1d1)]('errors',_0x319d6a(0x27e)),_0x57bf41['redirect'](_0x319d6a(0x283));const _0x4a03b5=await sales[_0x319d6a(0x1fa)]({'invoice':_0x26dcbe});console[_0x319d6a(0x26b)](_0x4a03b5),_0x4a03b5[_0x319d6a(0x1f5)]=_0x319d6a(0x246);const _0x5e55fb=await _0x4a03b5['save'](),_0x1c021f=new sales_return({'invoice':_0x26dcbe,'customer':_0x3b60a4[_0x319d6a(0x1bd)][_0x319d6a(0x25a)],'date':_0xefc008,'warehouse_name':_0x7b6b35,'room':_0x347445,'ToWarehouse':_0x533dee,'ToRoom':_0x560734,'return_sale':_0x4e36d9,'note':_0xfb4777}),_0x257318=await _0x1c021f[_0x319d6a(0x1b9)]();console[_0x319d6a(0x26b)](_0x1c021f);const _0x5f4859=await sales_return[_0x319d6a(0x1fa)]({'invoice':_0x26dcbe}),_0x5d43c2=await warehouse[_0x319d6a(0x1fa)]({'name':_0x533dee,'room':_0x560734});_0x5f4859[_0x319d6a(0x262)][_0x319d6a(0x1e3)](_0x3a52f2=>{var _0x4038a2=_0x319d6a,_0x25c139=0x0;const _0x55417a=_0x5d43c2[_0x4038a2(0x208)][_0x4038a2(0x289)](_0x5566ba=>{var _0x38bc22=_0x4038a2;_0x5566ba[_0x38bc22(0x1c6)]==_0x3a52f2[_0x38bc22(0x1c6)]&&_0x5566ba['floorlevel']==_0x3a52f2[_0x38bc22(0x1e5)]&&_0x5566ba[_0x38bc22(0x19d)]==_0x3a52f2[_0x38bc22(0x19d)]&&_0x5566ba[_0x38bc22(0x237)]==_0x3a52f2[_0x38bc22(0x237)]&&_0x5566ba['bay']==_0x3a52f2[_0x38bc22(0x1ec)]&&(_0x5566ba[_0x38bc22(0x18f)]=parseInt(_0x5566ba[_0x38bc22(0x18f)])+parseInt(_0x3a52f2['return_qty']),_0x25c139++);});_0x25c139=='0'&&(_0x5d43c2[_0x4038a2(0x208)]=_0x5d43c2[_0x4038a2(0x208)][_0x4038a2(0x1c8)]({'product_name':_0x3a52f2[_0x4038a2(0x1c6)],'product_stock':_0x3a52f2['return_qty'],'primary_code':_0x3a52f2[_0x4038a2(0x299)],'secondary_code':_0x3a52f2[_0x4038a2(0x219)],'product_code':_0x3a52f2['product_code'],'bay':_0x3a52f2[_0x4038a2(0x1ec)],'bin':_0x3a52f2[_0x4038a2(0x237)],'type':_0x3a52f2['type'],'floorlevel':_0x3a52f2[_0x4038a2(0x1e5)]})),console[_0x4038a2(0x26b)]('final',_0x5d43c2);}),await _0x5d43c2['save'](),console[_0x319d6a(0x26b)](_0x3b60a4[_0x319d6a(0x1bd)]);const _0x4f09b6=new c_payment_data({'invoice':_0x26dcbe,'customer':_0x3b60a4['body'][_0x319d6a(0x25a)],'reason':'Sale\x20Return'});await _0x4f09b6[_0x319d6a(0x1b9)]();const _0x399d1e=await master_shop[_0x319d6a(0x1df)]();console[_0x319d6a(0x26b)](_0x319d6a(0x1b0),_0x399d1e[0x0][_0x319d6a(0x274)]);const _0x44a1ec=await email_settings[_0x319d6a(0x1fa)](),_0x5bc18c=await customer[_0x319d6a(0x1fa)]({'name':_0x3b60a4[_0x319d6a(0x1bd)]['customer']});console[_0x319d6a(0x26b)](_0x319d6a(0x1d7),_0x5bc18c);_0x399d1e[0x0]['currency_placement']==0x1?(right_currency=_0x399d1e[0x0][_0x319d6a(0x26f)],left_currency=''):(right_currency='',left_currency=_0x399d1e[0x0][_0x319d6a(0x26f)]);var _0x3a2b87=_0x3e1c14,_0x514f4d=_0x59221c,_0x907e2f='',_0x4880d5;for(_0x4880d5 in _0x3a2b87){_0x907e2f+=_0x319d6a(0x21b)+_0x319d6a(0x1f8)+_0x3a2b87[_0x4880d5]+_0x319d6a(0x257)+_0x319d6a(0x1f8)+_0x514f4d[_0x4880d5]+_0x319d6a(0x257)+_0x319d6a(0x27a);}console[_0x319d6a(0x26b)](_0x319d6a(0x20a),_0x907e2f);let _0x1a9d9a=nodemailer[_0x319d6a(0x263)]({'service':'gmail','auth':{'user':_0x44a1ec[_0x319d6a(0x193)],'pass':_0x44a1ec[_0x319d6a(0x25c)]}}),_0x11744c={'from':_0x44a1ec[_0x319d6a(0x193)],'to':_0x5bc18c[_0x319d6a(0x193)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x319d6a(0x1d0),'path':__dirname+_0x319d6a(0x19e)+_0x319d6a(0x235)+_0x399d1e[0x0][_0x319d6a(0x274)],'cid':_0x319d6a(0x1be)}],'html':_0x319d6a(0x1e4)+_0x319d6a(0x1fe)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x319d6a(0x231)+_0x319d6a(0x1a1)+'</div>'+'<div>'+_0x319d6a(0x1a0)+_0x399d1e[0x0][_0x319d6a(0x19c)]+_0x319d6a(0x1a5)+_0x319d6a(0x248)+_0x319d6a(0x248)+_0x319d6a(0x1b5)+'<div>'+_0x319d6a(0x197)+_0x319d6a(0x217)+_0x26dcbe+'\x20'+_0x319d6a(0x271)+_0x319d6a(0x28c)+_0xefc008+'\x20'+_0x319d6a(0x1b3)+_0x319d6a(0x287)+_0x319d6a(0x248)+_0x319d6a(0x1c2)+_0x319d6a(0x209)+_0x319d6a(0x21b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x319d6a(0x18b)+_0x319d6a(0x260)+_0x319d6a(0x27a)+_0x319d6a(0x186)+_0x319d6a(0x240)+'\x20'+_0x907e2f+'\x20'+_0x319d6a(0x250)+_0x319d6a(0x212)+_0x319d6a(0x231)+_0x319d6a(0x255)+_0x319d6a(0x294)+_0x399d1e[0x0]['site_title']+_0x319d6a(0x287)+_0x319d6a(0x248)+_0x319d6a(0x248)+'</body></html>'};_0x1a9d9a[_0x319d6a(0x28f)](_0x11744c,function(_0x40d24d,_0x57f4e2){var _0x340d4d=_0x319d6a;_0x40d24d?(console[_0x340d4d(0x26b)](_0x40d24d),console[_0x340d4d(0x26b)](_0x340d4d(0x1a7))):console[_0x340d4d(0x26b)]('Email\x20sent\x20successfully');}),_0x3b60a4[_0x319d6a(0x1d1)](_0x319d6a(0x18e),_0x319d6a(0x1b7)),_0x57bf41[_0x319d6a(0x275)](_0x319d6a(0x296));}catch(_0x276aeb){console[_0x319d6a(0x26b)](_0x276aeb),_0x57bf41['status'](0xc8)[_0x319d6a(0x22c)]({'message1':_0x276aeb['message']});}}),router[a0_0x3f8043(0x22f)](a0_0x3f8043(0x213),auth,async(_0xd4ca68,_0x15c594)=>{var _0x4dbcfa=a0_0x3f8043;try{const {username:_0x5dcbd1,email:_0xadb574,role:_0x455cd8}=_0xd4ca68[_0x4dbcfa(0x1db)],_0x5c2fa0=_0xd4ca68[_0x4dbcfa(0x1db)],_0x585e5d=await profile[_0x4dbcfa(0x1fa)]({'email':_0x5c2fa0[_0x4dbcfa(0x193)]}),_0x50434e=await master_shop[_0x4dbcfa(0x1df)]();console['log'](_0x4dbcfa(0x26a),_0x50434e);const _0x1cc63c=_0xd4ca68[_0x4dbcfa(0x206)]['id'],_0x47400c=await sales[_0x4dbcfa(0x1aa)](_0x1cc63c);console[_0x4dbcfa(0x26b)](_0x4dbcfa(0x27f),_0x47400c);if(_0x50434e[0x0][_0x4dbcfa(0x256)]==_0x4dbcfa(0x1a4))var _0x599441=users['English'];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]==_0x4dbcfa(0x279))var _0x599441=users[_0x4dbcfa(0x279)];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]=='German')var _0x599441=users[_0x4dbcfa(0x238)];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]=='Spanish')var _0x599441=users[_0x4dbcfa(0x230)];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]=='French')var _0x599441=users[_0x4dbcfa(0x1c1)];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]=='Portuguese\x20(BR)')var _0x599441=users['Portuguese'];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]==_0x4dbcfa(0x22b))var _0x599441=users['Chinese'];else{if(_0x50434e[0x0][_0x4dbcfa(0x256)]=='Arabic\x20(ae)')var _0x599441=users[_0x4dbcfa(0x28a)];}}}}}}}_0x15c594['render']('all_sales_barcode',{'success':_0xd4ca68[_0x4dbcfa(0x1d1)]('success'),'errors':_0xd4ca68[_0x4dbcfa(0x1d1)](_0x4dbcfa(0x288)),'role':_0x5c2fa0,'profile':_0x585e5d,'alldata':_0x47400c,'master_shop':_0x50434e,'language':_0x599441});}catch(_0x3b3c36){console[_0x4dbcfa(0x26b)](_0x3b3c36);}}),router[a0_0x3f8043(0x218)]('/barcode_scanner',async(_0x4385a6,_0xdb9633)=>{var _0x14b3ae=a0_0x3f8043;const {product_code:_0x3edfae,warehouse_name:_0x480f54,rooms_data:_0x161915,Roomslist:_0x559253}=_0x4385a6[_0x14b3ae(0x1bd)],_0x513685=_0x559253[_0x14b3ae(0x1f1)](','),_0x102b73=[];async function _0xd6e071(_0x542d78){var _0x290e24=_0x14b3ae;const _0x3f2757=await warehouse['aggregate']([{'$match':{'name':_0x480f54,'room':_0x542d78}},{'$unwind':_0x290e24(0x1cd)},{'$match':{'product_details.primary_code':_0x3edfae}},{'$group':{'_id':_0x290e24(0x1af),'name':{'$first':_0x290e24(0x24b)},'product_stock':{'$first':_0x290e24(0x236)},'primary_code':{'$first':_0x290e24(0x1e9)},'secondary_code':{'$first':_0x290e24(0x261)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x290e24(0x18d)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x290e24(0x23e)},'unit':{'$first':_0x290e24(0x21f)},'secondary_unit':{'$first':_0x290e24(0x187)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x290e24(0x205)},'production_date':{'$first':_0x290e24(0x1c3)},'maxPerUnit':{'$first':_0x290e24(0x202)},'batch_code':{'$first':_0x290e24(0x247)},'product_cat':{'$first':_0x290e24(0x21d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x290e24(0x251)},'invoice':{'$first':_0x290e24(0x245)},'actual_qty':{'$first':_0x290e24(0x191)},'actual_uom':{'$first':'$product_details.actual_uom'},'delivery_date':{'$first':_0x290e24(0x22a)},'delivery_code':{'$first':_0x290e24(0x1cb)}}}]),_0x50bf9e=await warehouse[_0x290e24(0x1cf)]([{'$match':{'name':_0x480f54,'room':_0x542d78}},{'$unwind':_0x290e24(0x1cd)},{'$match':{'product_details.secondary_code':_0x3edfae}},{'$group':{'_id':_0x290e24(0x1af),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x290e24(0x236)},'primary_code':{'$first':_0x290e24(0x1e9)},'secondary_code':{'$first':_0x290e24(0x261)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x290e24(0x234)},'type':{'$first':_0x290e24(0x293)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x290e24(0x21f)},'secondary_unit':{'$first':_0x290e24(0x187)},'storage':{'$first':_0x290e24(0x252)},'rack':{'$first':_0x290e24(0x23a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x290e24(0x1c3)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x290e24(0x247)},'product_cat':{'$first':_0x290e24(0x21d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x290e24(0x245)},'delivery_date':{'$first':_0x290e24(0x22a)},'delivery_code':{'$first':_0x290e24(0x1cb)}}}]);if(_0x3f2757[_0x290e24(0x264)]>0x0)_0x102b73[_0x290e24(0x253)](_0x3f2757);else _0x50bf9e[_0x290e24(0x264)]>0x0&&_0x102b73[_0x290e24(0x253)](_0x50bf9e);}const _0x3984b1=_0x513685[_0x14b3ae(0x289)](_0x27fe4a=>_0xd6e071(_0x27fe4a));await Promise['all'](_0x3984b1),_0xdb9633[_0x14b3ae(0x22c)](_0x102b73);}),module[a0_0x3f8043(0x277)]=router;