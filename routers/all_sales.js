var a0_0x2664f1=a0_0x5e73;(function(_0x230254,_0x4f2025){var _0xed81e3=a0_0x5e73,_0x9b81d2=_0x230254();while(!![]){try{var _0x3d8849=-parseInt(_0xed81e3(0x173))/0x1+parseInt(_0xed81e3(0x122))/0x2+parseInt(_0xed81e3(0x1dd))/0x3*(parseInt(_0xed81e3(0x175))/0x4)+parseInt(_0xed81e3(0x195))/0x5*(parseInt(_0xed81e3(0x113))/0x6)+-parseInt(_0xed81e3(0x1bc))/0x7+parseInt(_0xed81e3(0x1af))/0x8*(parseInt(_0xed81e3(0x15f))/0x9)+-parseInt(_0xed81e3(0x151))/0xa;if(_0x3d8849===_0x4f2025)break;else _0x9b81d2['push'](_0x9b81d2['shift']());}catch(_0x34a2dc){_0x9b81d2['push'](_0x9b81d2['shift']());}}}(a0_0x4d45,0xda146));function a0_0x5e73(_0x13d4bd,_0x467a6b){var _0x4d4579=a0_0x4d45();return a0_0x5e73=function(_0x5e7304,_0x53a38c){_0x5e7304=_0x5e7304-0x113;var _0x19a684=_0x4d4579[_0x5e7304];return _0x19a684;},a0_0x5e73(_0x13d4bd,_0x467a6b);}const express=require(a0_0x2664f1(0x1ac)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2664f1(0x222)),auth=require('../middleware/auth'),nodemailer=require(a0_0x2664f1(0x1b9)),users=require(a0_0x2664f1(0x1ce));router[a0_0x2664f1(0x203)](a0_0x2664f1(0x141),auth,async(_0x43c096,_0xe21774)=>{var _0x10c929=a0_0x2664f1;try{const {username:_0x1ff1ed,email:_0x4bff1c,role:_0xf1efc6}=_0x43c096[_0x10c929(0x18e)],_0x59ef6f=_0x43c096['user'],_0x48082f=await profile['findOne']({'email':_0x59ef6f['email']}),_0x216c40=await master_shop[_0x10c929(0x1fc)]();let _0x59d571;if(_0x59ef6f[_0x10c929(0x139)]==_0x10c929(0x1d9)){const _0x760cb1=await staff[_0x10c929(0x146)]({'email':_0x59ef6f[_0x10c929(0x1e3)]});_0x59d571=await sales[_0x10c929(0x127)]([{'$lookup':{'from':'customers','localField':_0x10c929(0x1ca),'foreignField':'name','as':_0x10c929(0x17f)}},{'$unwind':_0x10c929(0x21d)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x10c929(0x1e9),'invoice':{'$first':_0x10c929(0x161)},'customers':{'$first':_0x10c929(0x219)},'date':{'$first':_0x10c929(0x1f6)},'warehouse_name':{'$first':_0x10c929(0x1de)},'sale_product':{'$push':_0x10c929(0x11f)},'note':{'$first':_0x10c929(0x1a7)},'return_data':{'$first':_0x10c929(0x1ec)},'customers_docs':{'$first':_0x10c929(0x21d)},'total_saleproduct_quantity':{'$sum':_0x10c929(0x19f)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x10c929(0x16d)},'type':{'$addToSet':_0x10c929(0x168)},'pallet':{'$addToSet':_0x10c929(0x12e)},'finalize':{'$first':_0x10c929(0x16b)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x59d571=await sales[_0x10c929(0x127)]([{'$lookup':{'from':_0x10c929(0x135),'localField':_0x10c929(0x1ca),'foreignField':_0x10c929(0x118),'as':_0x10c929(0x17f)}},{'$unwind':_0x10c929(0x21d)},{'$unwind':_0x10c929(0x11f)},{'$group':{'_id':_0x10c929(0x1e9),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x10c929(0x1de)},'sale_product':{'$push':_0x10c929(0x11f)},'note':{'$first':_0x10c929(0x1a7)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x10c929(0x21d)},'total_saleproduct_quantity':{'$sum':_0x10c929(0x19f)},'level':{'$addToSet':_0x10c929(0x1c2)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x10c929(0x168)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x10c929(0x16b)},'isAllowEdit':{'$first':_0x10c929(0x18a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x10c929(0x12d),_0x59d571);if(_0x216c40[0x0][_0x10c929(0x1b8)]==_0x10c929(0x1ef)){var _0x254183=users['English'];console['log'](_0x254183);}else{if(_0x216c40[0x0]['language']==_0x10c929(0x1e0))var _0x254183=users[_0x10c929(0x1e0)];else{if(_0x216c40[0x0][_0x10c929(0x1b8)]==_0x10c929(0x1bd))var _0x254183=users[_0x10c929(0x1bd)];else{if(_0x216c40[0x0][_0x10c929(0x1b8)]==_0x10c929(0x202))var _0x254183=users[_0x10c929(0x202)];else{if(_0x216c40[0x0][_0x10c929(0x1b8)]=='French')var _0x254183=users[_0x10c929(0x189)];else{if(_0x216c40[0x0]['language']==_0x10c929(0x218))var _0x254183=users[_0x10c929(0x13d)];else{if(_0x216c40[0x0][_0x10c929(0x1b8)]==_0x10c929(0x185))var _0x254183=users[_0x10c929(0x185)];else{if(_0x216c40[0x0][_0x10c929(0x1b8)]==_0x10c929(0x152))var _0x254183=users['Arabic'];}}}}}}}_0xe21774[_0x10c929(0x147)]('all_sales',{'success':_0x43c096[_0x10c929(0x1ab)]('success'),'errors':_0x43c096[_0x10c929(0x1ab)](_0x10c929(0x17e)),'sales':_0x59d571,'profile':_0x48082f,'role':_0x59ef6f,'master_shop':_0x216c40,'language':_0x254183});}catch(_0x4dd961){console['log'](_0x4dd961);}});function a0_0x4d45(){var _0x26ceb0=['customers_docs','production_date','storage','<strong>\x20Regards\x20</strong>','RMSEmail','$product_details.pallet','Chinese','$product_details.secondary_code','Sale\x20Return\x20Mail','<span\x20style=\x22float:\x20right;\x22>','French','$isAllowEdit','findById','note','length','user','expiry_date','error','currency_placement','then','English','createTransport','615nfzEdW','$product_details.product_code','return_sale','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','sale_qty','floorlevel','actual_qty','/view/add_sale/product','product_stock','$sale_product.quantity','back','$product_details.bin','Email\x20sent\x20successfully','status','Floor','isAllowEdit','currency','$note','<!DOCTYPE\x20html>','room','$product_details.rack','flash','express','Sales\x20Mail','$product_details.type','3819256DXbcYh','product','SCRN','exports','string','/all_sales/preview/','RoomAssigned','$product_details.secondary_unit','rack','language','nodemailer','$room','primary_code','1285844IEUGCO','German','<tr>','/all_sales/view','redirect','/view/add_sales','$sale_product.bay','types','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','master','/view/return_sales/:id','invoice','product_data','body','customer','<div>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','stock_data','../public/language/languages.json','sales\x20item\x20return\x20successfull','/../public','port','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','customer_data','sales_quantity','</tr>','Raw\x20Materials','params','actual_uom','staff','due_amount','user_id','delivery_date','699vrSUVs','$warehouse_name','$product','Hindi','secondary_unit','Enclosed','email','slice','site_title','carton','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$name','$_id','$product_details.bay','$product_details.invoice','$return_data','Sales\x20Update\x20successfully','log','English\x20(US)','<h5>','</div>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_details','Arabic','finalize','$date','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','requested_qty','toString','find','add_sales','Enabled','</head><body>','/view/add_sales/:id','$product_details.expiry_date','Spanish','get','</table>','bin','push','getFullYear','$product_details.actual_qty','bay','$product_details.unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','map','True','primary_unit','\x20Order\x20Number\x20:\x20','edit_sales','sales_invoice','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</body></html>','message','\x20Order\x20Date\x20:\x20','delivery_code','Portuguese\x20(BR)','$customer','$product_details.product_cat','quantity_notConverted','secondary_code','$customers_docs','return_qty','/preview/:id','Ambient','return_data','../models/all_models','17718jEXnfN','filter','An\x20error\x20occurred\x20while\x20saving\x20data.','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','name','type','$product_details.floorlevel','</tbody>','<h2>\x20','</td>','getMonth','$sale_product','warehouse','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','439938deBEUT','$product_details.product_stock','stock','success','concat','aggregate','all','<html><head><title></title>','Return\x20Goods','$product_details.storage','$product_details.actual_uom','sales\x20all_data','$sale_product.floorlevel','date','forEach','\x20</h2>','Level','$product_details.maxPerUnit','/barcode/:id','customers','maxperunit','final','all_sales_barcode','role','image','product_code','logo','Portuguese','/invoice/:id','abs','/upload/','/view','prod_invoice','gmail','$product_details.production_date','Receiving\x20Area','findOne','render','OUT-','product_name','random','barcode\x20Product\x20master','level','barcode\x20user_id','Return\x20Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</span>','14356830OqYVJv','Arabic\x20(ae)','Logo.png','</h5>','$product_details.primary_code','$product_details.batch_code','unit','Sale\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','warehouse_name','Shelves','room_name','floor','18kOozWk','post','$invoice','catch','quantity','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.level','/view/:id','stocks','$sale_product.type','max_per_unit','$product_details.product_name','$finalize','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.bin','json','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','sale_product','$product_details._id','password','620957uTAwSF','save','27392tRUInY','</thead>','sendMail','prod_code','_id','received_amount','foreach\x20newproduct','prod_cat','/barcode_scanner','errors'];a0_0x4d45=function(){return _0x26ceb0;};return a0_0x4d45();}async function getRandom8DigitNumber(){var _0x576066=a0_0x2664f1;const _0x53cb8a=0x989680,_0x2ae574=0x5f5e0ff,_0x1d7b6f=Math[_0x576066(0x15e)](Math[_0x576066(0x14a)]()*(_0x2ae574-_0x53cb8a+0x1))+_0x53cb8a;var _0x4307d6;const _0x343e5d=await sales[_0x576066(0x146)]({'invoice':_0x576066(0x148)+_0x1d7b6f});return _0x343e5d&&_0x343e5d[_0x576066(0x18d)]>0x0?_0x4307d6=_0x576066(0x148)+_0x1d7b6f:_0x4307d6=_0x576066(0x148)+_0x1d7b6f,_0x4307d6;}router[a0_0x2664f1(0x203)](a0_0x2664f1(0x1c1),auth,async(_0x204599,_0x15dec0)=>{var _0x1b4164=a0_0x2664f1;try{const {username:_0x2bb140,email:_0x295aa7,role:_0x351fbf}=_0x204599[_0x1b4164(0x18e)],_0x5365f9=_0x204599[_0x1b4164(0x18e)],_0x231075=await profile[_0x1b4164(0x146)]({'email':_0x5365f9['email']}),_0x388819=await master_shop[_0x1b4164(0x1fc)](),_0x189165=await customer[_0x1b4164(0x1fc)]({});let _0x1c8729;if(_0x5365f9[_0x1b4164(0x139)]=='staff'){const _0x172ee9=await staff[_0x1b4164(0x146)]({'email':_0x5365f9[_0x1b4164(0x1e3)]});_0x1c8729=await warehouse[_0x1b4164(0x127)]([{'$match':{'status':'Enabled','name':_0x172ee9[_0x1b4164(0x120)],'warehouse_category':_0x1b4164(0x1d6),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x1b4164(0x1e8),'name':{'$first':_0x1b4164(0x1e8)}}},{'$sort':{'name':0x1}}]);}else _0x1c8729=await warehouse[_0x1b4164(0x127)]([{'$match':{'status':_0x1b4164(0x1fe),'warehouse_category':_0x1b4164(0x1d6),'name':{'$ne':_0x1b4164(0x12a)}}},{'$group':{'_id':'$name','name':{'$first':_0x1b4164(0x1e8)}}},{'$sort':{'name':0x1}}]);const _0x366b41=await product[_0x1b4164(0x1fc)]({});var _0x389bf4=[_0x1b4164(0x220),_0x1b4164(0x1e2)];const _0xc5353a=await sales[_0x1b4164(0x1fc)]({}),_0x39cdef=_0xc5353a[_0x1b4164(0x18d)]+0x1,_0x19ace0=_0x1b4164(0x148)+_0x39cdef[_0x1b4164(0x1fb)]()['padStart'](0x5,'0');if(_0x388819[0x0][_0x1b4164(0x1b8)]==_0x1b4164(0x1ef)){var _0x4119bd=users[_0x1b4164(0x193)];console[_0x1b4164(0x1ee)](_0x4119bd);}else{if(_0x388819[0x0][_0x1b4164(0x1b8)]==_0x1b4164(0x1e0))var _0x4119bd=users[_0x1b4164(0x1e0)];else{if(_0x388819[0x0][_0x1b4164(0x1b8)]==_0x1b4164(0x1bd))var _0x4119bd=users[_0x1b4164(0x1bd)];else{if(_0x388819[0x0]['language']==_0x1b4164(0x202))var _0x4119bd=users[_0x1b4164(0x202)];else{if(_0x388819[0x0][_0x1b4164(0x1b8)]==_0x1b4164(0x189))var _0x4119bd=users[_0x1b4164(0x189)];else{if(_0x388819[0x0][_0x1b4164(0x1b8)]==_0x1b4164(0x218))var _0x4119bd=users[_0x1b4164(0x13d)];else{if(_0x388819[0x0][_0x1b4164(0x1b8)]==_0x1b4164(0x185))var _0x4119bd=users[_0x1b4164(0x185)];else{if(_0x388819[0x0]['language']==_0x1b4164(0x152))var _0x4119bd=users[_0x1b4164(0x1f4)];}}}}}}}const _0x3cc3a3=getRandom8DigitNumber();_0x3cc3a3[_0x1b4164(0x192)](_0x3f6eb4=>{var _0x16fc95=_0x1b4164;_0x15dec0[_0x16fc95(0x147)](_0x16fc95(0x1fd),{'success':_0x204599[_0x16fc95(0x1ab)](_0x16fc95(0x125)),'errors':_0x204599['flash'](_0x16fc95(0x17e)),'role':_0x5365f9,'profile':_0x231075,'customer':_0x189165,'warehouse':_0x1c8729,'product':_0x366b41,'invoice':_0x3f6eb4,'master_shop':_0x388819,'language':_0x4119bd,'rooms_data':_0x389bf4});})[_0x1b4164(0x162)](_0x49bce1=>{var _0x27ed2f=_0x1b4164;_0x204599[_0x27ed2f(0x1ab)](_0x27ed2f(0x17e),_0x27ed2f(0x15a)),_0x15dec0[_0x27ed2f(0x1c0)](_0x27ed2f(0x1bf));});}catch(_0x35d096){console['log'](_0x35d096);}}),router['get'](a0_0x2664f1(0x200),auth,async(_0xba0a81,_0xe804c7)=>{var _0x174cb3=a0_0x2664f1;try{const _0x21d3a7=_0xba0a81[_0x174cb3(0x1d7)]['id'];console[_0x174cb3(0x1ee)](_0x21d3a7);const _0x544a5e=await product[_0x174cb3(0x1fc)](),_0x3ba5f3=await purchases['aggregate']([{'$match':{'warehouse_name':_0x21d3a7}},{'$unwind':_0x174cb3(0x1df)},{'$group':{'_id':'$product.product_name'}}]);console[_0x174cb3(0x1ee)]('purchases_data',_0x3ba5f3),_0xe804c7['status'](0xc8)[_0x174cb3(0x16e)]({'purchases_data':_0x3ba5f3,'product_data':_0x544a5e});}catch(_0x21379d){console[_0x174cb3(0x1ee)](_0x21379d);}}),router[a0_0x2664f1(0x160)](a0_0x2664f1(0x19d),auth,async(_0x47be10,_0x77b6ea)=>{var _0x95a738=a0_0x2664f1;try{const {warehouse_data:_0x31db7d,product_data:_0x4ea004}=_0x47be10[_0x95a738(0x1c9)];console[_0x95a738(0x1ee)](_0x47be10[_0x95a738(0x1c9)][_0x95a738(0x1c8)]);;const _0x108bff=await master_shop[_0x95a738(0x1fc)]();console[_0x95a738(0x1ee)](_0x95a738(0x1c5),_0x108bff);const _0x48f0ef=await product[_0x95a738(0x146)]({'name':_0x4ea004});console[_0x95a738(0x1ee)](_0x95a738(0x1b0),_0x48f0ef);const _0x7cbde9=await warehouse[_0x95a738(0x127)]([{'$match':{'name':_0x31db7d}},{'$unwind':_0x95a738(0x198)},{'$match':{'product_details.product_name':_0x4ea004}},{'$group':{'_id':_0x95a738(0x16a),'product_stock':{'$first':_0x95a738(0x123)}}}]);console['log'](_0x95a738(0x1cd),_0x7cbde9),_0x77b6ea[_0x95a738(0x1a3)](0xc8)[_0x95a738(0x16e)]({'master':_0x108bff,'new_product':_0x48f0ef,'stock_data':_0x7cbde9});}catch(_0x571852){console['log'](_0x571852);}}),router[a0_0x2664f1(0x160)](a0_0x2664f1(0x1c1),auth,async(_0x5085fa,_0x470145)=>{var _0x12b8d0=a0_0x2664f1;try{const {invoice:_0x5bbc4a,date:_0x290eb8,warehouse_name:_0x4edb6f,product_name:_0x3fd261,stock:_0x472dd9,quantity:_0x519e88,note:_0x2614f2,room:_0x39e9a1,primary_code:_0x25a2d5,secondary_code:_0x7c2a12,prod_code:_0x20b485,level:_0x24d731,isle:_0x10c9ed,pallet:_0x2da323,batch_code:_0x566a4e,SCRN:_0x391014,expiry_date:_0x169a33}=_0x5085fa[_0x12b8d0(0x1c9)];if(typeof _0x3fd261==_0x12b8d0(0x1b3))var _0x5429cb=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x149)]],_0x6582d9=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x124)]],_0x4e8b5b=[_0x5085fa[_0x12b8d0(0x1c9)]['carton']],_0x140258=[_0x5085fa['body']['primary_code']],_0xa4f964=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x21c)]],_0x60b488=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x178)]],_0x367711=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x14c)]],_0x1c9a8e=[_0x5085fa[_0x12b8d0(0x1c9)]['primary_unit']],_0x59bb17=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1e1)]],_0x34cb99=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1f7)]],_0x3dab63=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x18f)]],_0x1b7f42=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x169)]],_0x40347c=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x180)]],_0xa8cba5=[_0x5085fa['body']['requested_qty']],_0x1358ec=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1dc)]],_0x28e964=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x217)]],_0x527aec=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x17c)]],_0x3270fa=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x163)]],_0x2b0b6c=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1b5)]],_0x453e85=[_0x5085fa[_0x12b8d0(0x1c9)]['prod_invoice']],_0x570ca9=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x19c)]],_0x189211=[_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1d8)]];else var _0x5429cb=[..._0x5085fa['body']['product_name']],_0x6582d9=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x124)]],_0x4e8b5b=[..._0x5085fa[_0x12b8d0(0x1c9)]['carton']],_0x140258=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1bb)]],_0xa4f964=[..._0x5085fa['body'][_0x12b8d0(0x21c)]],_0x60b488=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x178)]],_0x367711=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x14c)]],_0x1c9a8e=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x20e)]],_0x59bb17=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1e1)]],_0x34cb99=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1f7)]],_0x3dab63=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x18f)]],_0x1b7f42=[..._0x5085fa[_0x12b8d0(0x1c9)]['max_per_unit']],_0x40347c=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x180)]],_0xa8cba5=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1fa)]],_0x1358ec=[..._0x5085fa['body'][_0x12b8d0(0x1dc)]],_0x28e964=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x217)]],_0x527aec=[..._0x5085fa['body'][_0x12b8d0(0x17c)]],_0x3270fa=[..._0x5085fa[_0x12b8d0(0x1c9)]['quantity']],_0x2b0b6c=[..._0x5085fa['body'][_0x12b8d0(0x1b5)]],_0x453e85=[..._0x5085fa['body'][_0x12b8d0(0x142)]],_0x570ca9=[..._0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x19c)]],_0x189211=[..._0x5085fa[_0x12b8d0(0x1c9)]['actual_uom']];const _0x47afa7=_0x5429cb[_0x12b8d0(0x20c)](_0x23246a=>{return _0x23246a={'product_name':_0x23246a};});_0x6582d9['forEach']((_0x25cf9c,_0x47d54e)=>{var _0x3c84bc=_0x12b8d0;_0x47afa7[_0x47d54e][_0x3c84bc(0x124)]=Math['abs'](_0x25cf9c);}),_0x570ca9[_0x12b8d0(0x130)]((_0x433fa1,_0x2317b5)=>{var _0x34e7fd=_0x12b8d0;_0x47afa7[_0x2317b5][_0x34e7fd(0x19c)]=Math[_0x34e7fd(0x13f)](_0x433fa1);}),_0x189211['forEach']((_0x369be8,_0x4655da)=>{var _0x6e6597=_0x12b8d0;_0x47afa7[_0x4655da][_0x6e6597(0x1d8)]=_0x369be8;}),_0x4e8b5b[_0x12b8d0(0x130)]((_0x3a0447,_0x3bbb12)=>{_0x47afa7[_0x3bbb12]['quantity']=_0x3a0447;}),_0x140258['forEach']((_0x22026d,_0x60e2a4)=>{_0x47afa7[_0x60e2a4]['primary_code']=_0x22026d;}),_0xa4f964[_0x12b8d0(0x130)]((_0x4dc211,_0x2e50b3)=>{var _0x49c678=_0x12b8d0;_0x47afa7[_0x2e50b3][_0x49c678(0x21c)]=_0x4dc211;}),_0x60b488[_0x12b8d0(0x130)]((_0x4c3ca4,_0x37a92e)=>{var _0x33c7db=_0x12b8d0;_0x47afa7[_0x37a92e][_0x33c7db(0x13b)]=_0x4c3ca4;}),_0x367711['forEach']((_0x1da18c,_0x4b0bf0)=>{var _0xfb9f5b=_0x12b8d0;_0x2b0b6c[_0xfb9f5b(0x130)]((_0x53b190,_0x2f629c)=>{var _0x54d5ae=_0xfb9f5b;if(_0x53b190==_0x54d5ae(0x145)&&_0x4b0bf0==_0x2f629c){var _0x30d58f=_0x1da18c['slice'](0x3);_0x47afa7[_0x4b0bf0][_0x54d5ae(0x181)]=_0x1da18c[0x0],_0x47afa7[_0x4b0bf0]['rack']=_0x1da18c[0x1],_0x47afa7[_0x4b0bf0][_0x54d5ae(0x209)]=0x0,_0x47afa7[_0x4b0bf0][_0x54d5ae(0x205)]=0x0,_0x47afa7[_0x4b0bf0][_0x54d5ae(0x119)]=_0x54d5ae(0x1a4),_0x47afa7[_0x4b0bf0][_0x54d5ae(0x19b)]=_0x30d58f;}else{if(_0x53b190==_0x54d5ae(0x15c)&&_0x4b0bf0==_0x2f629c){var _0x30d58f=_0x1da18c['slice'](0x3);_0x47afa7[_0x4b0bf0][_0x54d5ae(0x181)]=_0x1da18c[0x0],_0x47afa7[_0x4b0bf0][_0x54d5ae(0x1b7)]=_0x1da18c[0x1],_0x47afa7[_0x4b0bf0][_0x54d5ae(0x209)]=0x0,_0x47afa7[_0x4b0bf0]['bin']=0x0,_0x47afa7[_0x4b0bf0][_0x54d5ae(0x119)]=_0x54d5ae(0x1a4),_0x47afa7[_0x4b0bf0]['floorlevel']=_0x1da18c[0x5];}else{if(_0x4b0bf0==_0x2f629c){var _0x468888;if(_0x1da18c[0x4]=='L')_0x468888=_0x54d5ae(0x132);else _0x1da18c[0x4]=='F'&&(_0x468888=_0x54d5ae(0x1a4));_0x47afa7[_0x4b0bf0]['storage']=_0x1da18c[0x0],_0x47afa7[_0x4b0bf0]['rack']=_0x1da18c[0x1],_0x47afa7[_0x4b0bf0][_0x54d5ae(0x209)]=_0x1da18c[0x2],_0x47afa7[_0x4b0bf0][_0x54d5ae(0x205)]=_0x1da18c[0x3],_0x47afa7[_0x4b0bf0][_0x54d5ae(0x119)]=_0x468888,_0x47afa7[_0x4b0bf0][_0x54d5ae(0x19b)]=_0x1da18c[0x5];}}}});}),_0x1c9a8e[_0x12b8d0(0x130)]((_0xf1e038,_0x41ad44)=>{_0x47afa7[_0x41ad44]['unit']=_0xf1e038;}),_0x59bb17[_0x12b8d0(0x130)]((_0x3ee1d3,_0x161d7d)=>{_0x47afa7[_0x161d7d]['secondary_unit']=_0x3ee1d3;}),_0x34cb99[_0x12b8d0(0x130)]((_0xab9d82,_0x3718c1)=>{var _0x4efb32=_0x12b8d0;_0x47afa7[_0x3718c1][_0x4efb32(0x1f7)]=_0xab9d82;}),_0x3dab63[_0x12b8d0(0x130)]((_0x460279,_0x19c760)=>{var _0x31b7b3=_0x12b8d0;_0x47afa7[_0x19c760][_0x31b7b3(0x18f)]=_0x460279;}),_0x1b7f42['forEach']((_0xb4feef,_0x3d63e9)=>{var _0x3da440=_0x12b8d0;_0x47afa7[_0x3d63e9][_0x3da440(0x136)]=_0xb4feef;}),_0x40347c['forEach']((_0x4a42fd,_0x2d06ad)=>{var _0x43bd10=_0x12b8d0;_0x47afa7[_0x2d06ad][_0x43bd10(0x180)]=_0x4a42fd;}),_0xa8cba5[_0x12b8d0(0x130)]((_0x177369,_0x569f7e)=>{var _0x502b8a=_0x12b8d0;_0x47afa7[_0x569f7e][_0x502b8a(0x1fa)]=_0x177369;}),_0x1358ec[_0x12b8d0(0x130)]((_0x39ed98,_0x49ef29)=>{var _0x46bc33=_0x12b8d0;_0x47afa7[_0x49ef29][_0x46bc33(0x1dc)]=_0x39ed98;}),_0x28e964['forEach']((_0x476c8f,_0x571be5)=>{var _0x19593b=_0x12b8d0;_0x47afa7[_0x571be5][_0x19593b(0x217)]=_0x476c8f;}),_0x527aec['forEach']((_0x12cc8f,_0x27d26b)=>{var _0x228932=_0x12b8d0;_0x47afa7[_0x27d26b][_0x228932(0x17c)]=_0x12cc8f;}),_0x3270fa[_0x12b8d0(0x130)]((_0x3f1718,_0x323e05)=>{var _0x2eac9a=_0x12b8d0;_0x47afa7[_0x323e05][_0x2eac9a(0x21b)]=_0x3f1718;}),_0x2b0b6c[_0x12b8d0(0x130)]((_0x3fca1f,_0x1d491b)=>{var _0x33c648=_0x12b8d0;_0x47afa7[_0x1d491b][_0x33c648(0x15d)]=_0x3fca1f;}),_0x453e85[_0x12b8d0(0x130)]((_0x4f4b73,_0x22d689)=>{var _0x21a132=_0x12b8d0;_0x47afa7[_0x22d689][_0x21a132(0x1c7)]=_0x4f4b73;});var _0x47b34e=0x0;_0x47afa7[_0x12b8d0(0x130)](_0x10f269=>{var _0x40e094=_0x12b8d0;(_0x10f269[_0x40e094(0x124)]<_0x10f269['quantity_notConverted']||_0x10f269[_0x40e094(0x21b)]==0x0)&&(console['log'](_0x40e094(0x17b),_0x10f269),_0x47b34e++);});const _0x1e38ca=_0x47afa7[_0x12b8d0(0x114)](_0x11451d=>_0x11451d[_0x12b8d0(0x163)]!=='0'&&_0x11451d[_0x12b8d0(0x163)]!==''),_0x3b4c5d=new sales({'invoice':_0x5bbc4a,'customer':_0x5085fa[_0x12b8d0(0x1c9)][_0x12b8d0(0x1ca)],'date':_0x290eb8,'warehouse_name':_0x4edb6f,'sale_product':_0x1e38ca,'note':_0x2614f2,'room':_0x39e9a1,'primary_code':_0x25a2d5,'secondary_code':_0x7c2a12,'prod_code':_0x20b485,'SCRN':_0x391014}),_0x14e4c1=await _0x3b4c5d[_0x12b8d0(0x174)]();_0x5085fa[_0x12b8d0(0x1ab)](_0x12b8d0(0x125),'Sales\x20Add\x20successfully'),_0x470145[_0x12b8d0(0x1c0)](_0x12b8d0(0x1b4)+_0x14e4c1[_0x12b8d0(0x179)]);}catch(_0x432ade){console[_0x12b8d0(0x1ee)](_0x432ade);}}),router[a0_0x2664f1(0x203)]('/preview/:id',auth,async(_0x55d644,_0x40d2b5)=>{var _0x289418=a0_0x2664f1;try{const {username:_0x294d68,email:_0x348dfa,role:_0x2b348a}=_0x55d644[_0x289418(0x18e)],_0x1b4a3d=_0x55d644[_0x289418(0x18e)],_0x43484a=await profile[_0x289418(0x146)]({'email':_0x1b4a3d[_0x289418(0x1e3)]}),_0x110c20=await master_shop[_0x289418(0x1fc)](),_0x38bb58=_0x55d644['params']['id'],_0xd96dae=await sales[_0x289418(0x18b)](_0x38bb58),_0x1ddd3e=await warehouse[_0x289418(0x127)]([{'$match':{'name':_0xd96dae['warehouse_name']}},{'$unwind':_0x289418(0x198)},{'$group':{'_id':_0x289418(0x171),'name':{'$first':_0x289418(0x16a)},'product_stock':{'$first':_0x289418(0x123)},'bay':{'$first':_0x289418(0x1ea)},'bin':{'$first':_0x289418(0x1a1)},'type':{'$first':_0x289418(0x1ae)},'floorlevel':{'$first':_0x289418(0x11a)},'primary_code':{'$first':_0x289418(0x155)},'secondary_code':{'$first':_0x289418(0x186)},'product_code':{'$first':_0x289418(0x196)},'storage':{'$first':_0x289418(0x12b)},'rack':{'$first':_0x289418(0x1aa)},'expiry_date':{'$first':_0x289418(0x201)},'production_date':{'$first':'$product_details.production_date'}}}]),_0x108ed5=await customer['find']({});let _0x24d883;if(_0x1b4a3d[_0x289418(0x139)]==_0x289418(0x1d9)){const _0x4dc6a6=await staff['findOne']({'email':_0x1b4a3d[_0x289418(0x1e3)]});_0x24d883=await warehouse[_0x289418(0x127)]([{'$match':{'status':_0x289418(0x1fe),'name':_0x4dc6a6[_0x289418(0x120)]}},{'$group':{'_id':_0x289418(0x1e8),'name':{'$first':'$name'}}}]);}else _0x24d883=await warehouse['aggregate']([{'$match':{'status':_0x289418(0x1fe)}},{'$group':{'_id':'$name','name':{'$first':_0x289418(0x1e8)}}}]);const _0xfc2480=await product[_0x289418(0x1fc)]({}),_0x37eda9=await suppliers[_0x289418(0x1fc)]({});if(_0x110c20[0x0]['language']=='English\x20(US)'){var _0xbea609=users[_0x289418(0x193)];console[_0x289418(0x1ee)](_0xbea609);}else{if(_0x110c20[0x0][_0x289418(0x1b8)]==_0x289418(0x1e0))var _0xbea609=users[_0x289418(0x1e0)];else{if(_0x110c20[0x0][_0x289418(0x1b8)]=='German')var _0xbea609=users['German'];else{if(_0x110c20[0x0][_0x289418(0x1b8)]==_0x289418(0x202))var _0xbea609=users['Spanish'];else{if(_0x110c20[0x0][_0x289418(0x1b8)]==_0x289418(0x189))var _0xbea609=users[_0x289418(0x189)];else{if(_0x110c20[0x0][_0x289418(0x1b8)]==_0x289418(0x218))var _0xbea609=users[_0x289418(0x13d)];else{if(_0x110c20[0x0][_0x289418(0x1b8)]==_0x289418(0x185))var _0xbea609=users[_0x289418(0x185)];else{if(_0x110c20[0x0]['language']==_0x289418(0x152))var _0xbea609=users[_0x289418(0x1f4)];}}}}}}}_0x40d2b5[_0x289418(0x147)]('edit_sales_view',{'success':_0x55d644[_0x289418(0x1ab)]('success'),'errors':_0x55d644['flash']('errors'),'role':_0x1b4a3d,'profile':_0x43484a,'customer':_0x108ed5,'warehouse':_0x24d883,'product':_0x1ddd3e,'user':_0xd96dae,'master_shop':_0x110c20,'unit':_0xfc2480,'language':_0xbea609,'suppliers':_0x37eda9});}catch(_0x54ca8d){console[_0x289418(0x1ee)](_0x54ca8d);}}),router['post'](a0_0x2664f1(0x21f),auth,async(_0x7da9bb,_0x5861da)=>{var _0x5d8008=a0_0x2664f1;try{const _0x355118=_0x7da9bb[_0x5d8008(0x1d7)]['id'],{invoice:_0x6b5e2b,warehouse_name:_0x45655f,room:_0x2c0d4d}=_0x7da9bb[_0x5d8008(0x1c9)],_0xb8cf35=await sales[_0x5d8008(0x146)]({'invoice':_0x6b5e2b}),_0x52c4f4=_0xb8cf35['sale_product'][_0x5d8008(0x20c)](async _0x58b2d1=>{var _0x42e23d=_0x5d8008,_0x5284aa=await warehouse[_0x42e23d(0x146)]({'name':_0x45655f,'room':_0x58b2d1[_0x42e23d(0x15d)],'warehouse_category':_0x42e23d(0x1d6)});const _0x2a18a3=_0x5284aa[_0x42e23d(0x1f3)][_0x42e23d(0x20c)](_0x32f095=>{var _0xec78b5=_0x42e23d;_0x32f095[_0xec78b5(0x149)]==_0x58b2d1[_0xec78b5(0x149)]&&_0x32f095[_0xec78b5(0x19b)]==_0x58b2d1['floorlevel']&&_0x32f095[_0xec78b5(0x119)]==_0x58b2d1[_0xec78b5(0x119)]&&_0x32f095['bin']==_0x58b2d1[_0xec78b5(0x205)]&&_0x32f095[_0xec78b5(0x209)]==_0x58b2d1[_0xec78b5(0x209)]&&_0x32f095[_0xec78b5(0x1b7)]==_0x58b2d1[_0xec78b5(0x1b7)]&&_0x32f095['storage']==_0x58b2d1[_0xec78b5(0x181)]&&_0x32f095['expiry_date']==_0x58b2d1[_0xec78b5(0x18f)]&&_0x32f095[_0xec78b5(0x1f7)]==_0x58b2d1['batch_code']&&_0x32f095['invoice']==_0x58b2d1[_0xec78b5(0x1c7)]&&(_0x32f095['product_stock']=Math[_0xec78b5(0x13f)](_0x32f095[_0xec78b5(0x19e)])-Math[_0xec78b5(0x13f)](_0x58b2d1[_0xec78b5(0x163)]));});return _0x5284aa;});Promise[_0x5d8008(0x128)](_0x52c4f4)['then'](async _0x387738=>{var _0x158d21=_0x5d8008;try{for(const _0x47d4d6 of _0x387738){await _0x47d4d6[_0x158d21(0x174)]();}_0xb8cf35[_0x158d21(0x1f5)]=_0x158d21(0x20d);const _0x195fd8=await _0xb8cf35['save'](),_0x3db340=await master_shop['find'](),_0x322af0=await email_settings[_0x158d21(0x146)](),_0x34a3a6=await supervisor_settings[_0x158d21(0x1fc)]();var _0x2e9339=_0xb8cf35[_0x158d21(0x170)],_0x1ba900='',_0x1e9264;for(_0x1e9264 in _0x2e9339){_0x1ba900+=_0x158d21(0x1be)+_0x158d21(0x1cc)+_0x2e9339[_0x1e9264][_0x158d21(0x149)]+_0x158d21(0x11d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e9339[_0x1e9264][_0x158d21(0x13b)]+_0x158d21(0x11d)+_0x158d21(0x1cc)+_0x2e9339[_0x1e9264][_0x158d21(0x163)]+_0x158d21(0x11d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e9339[_0x1e9264][_0x158d21(0x157)]+'</td>'+_0x158d21(0x1cc)+_0x2e9339[_0x1e9264][_0x158d21(0x1e1)]+_0x158d21(0x11d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xb8cf35[_0x158d21(0x15b)]+'</td>'+_0x158d21(0x1cc)+_0x2e9339[_0x1e9264][_0x158d21(0x15d)]+_0x158d21(0x11d)+_0x158d21(0x1cc)+_0x2e9339[_0x1e9264]['storage']+_0x2e9339[_0x1e9264][_0x158d21(0x1b7)]+_0x2e9339[_0x1e9264][_0x158d21(0x209)]+_0x2e9339[_0x1e9264][_0x158d21(0x205)]+_0x2e9339[_0x1e9264][_0x158d21(0x119)][0x0]+_0x2e9339[_0x1e9264][_0x158d21(0x19b)]+_0x158d21(0x11d),_0x158d21(0x1d5);}let _0x1a0507=nodemailer[_0x158d21(0x194)]({'host':_0x322af0['host'],'port':Number(_0x322af0[_0x158d21(0x1d1)]),'secure':![],'auth':{'user':_0x322af0[_0x158d21(0x1e3)],'pass':_0x322af0[_0x158d21(0x172)]}}),_0x58fb47={'from':_0x322af0[_0x158d21(0x1e3)],'to':_0x34a3a6[0x0][_0x158d21(0x183)],'subject':_0x158d21(0x1ad),'attachments':[{'filename':_0x158d21(0x153),'path':__dirname+_0x158d21(0x1d0)+'/upload/'+_0x3db340[0x0][_0x158d21(0x13a)],'cid':_0x158d21(0x13c)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x158d21(0x1ff)+'<div>'+_0x158d21(0x1e7)+'<div>'+_0x158d21(0x1f2)+_0x158d21(0x1f1)+'<div>'+_0x158d21(0x11c)+_0x3db340[0x0][_0x158d21(0x1e5)]+_0x158d21(0x131)+'</div>'+_0x158d21(0x1f1)+_0x158d21(0x212)+_0x158d21(0x1cb)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0xb8cf35[_0x158d21(0x1c7)]+'\x20'+_0x158d21(0x188)+'\x20Order\x20Date\x20:\x20'+_0xb8cf35['date']+'\x20'+_0x158d21(0x150)+'</h5>'+_0x158d21(0x1f1)+_0x158d21(0x16c)+_0x158d21(0x16f)+_0x158d21(0x1be)+_0x158d21(0x20b)+_0x158d21(0x159)+_0x158d21(0x14f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x158d21(0x199)+_0x158d21(0x117)+_0x158d21(0x1f9)+_0x158d21(0x1f8)+'</tr>'+_0x158d21(0x176)+_0x158d21(0x164)+'\x20'+_0x1ba900+'\x20'+_0x158d21(0x11b)+_0x158d21(0x204)+_0x158d21(0x1cb)+_0x158d21(0x182)+_0x158d21(0x1f0)+_0x3db340[0x0][_0x158d21(0x1e5)]+'</h5>'+_0x158d21(0x1f1)+'</div>'+'</body></html>'};_0x1a0507['sendMail'](_0x58fb47,function(_0x1541e3,_0x1ed399){var _0x2e539a=_0x158d21;_0x1541e3?(console[_0x2e539a(0x1ee)](_0x1541e3),console['log'](_0x2e539a(0x116))):console[_0x2e539a(0x1ee)](_0x2e539a(0x1a2));}),_0x7da9bb[_0x158d21(0x1ab)](_0x158d21(0x125),'Sales\x20Update\x20successfully'),_0x5861da['redirect'](_0x158d21(0x1b4)+_0x355118);}catch(_0x34cd1b){console[_0x158d21(0x190)](_0x34cd1b),_0x5861da[_0x158d21(0x1a3)](0x1f4)[_0x158d21(0x16e)]({'error':_0x158d21(0x115)});}})[_0x5d8008(0x162)](_0x1a2369=>{var _0x1ee77d=_0x5d8008;console[_0x1ee77d(0x190)](_0x1a2369),_0x5861da[_0x1ee77d(0x1a3)](0x1f4)[_0x1ee77d(0x16e)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3adcce){console[_0x5d8008(0x1ee)](_0x3adcce);}}),router['get'](a0_0x2664f1(0x166),auth,async(_0x4a6b4c,_0x25344a)=>{var _0x4c596b=a0_0x2664f1;try{const {username:_0x50aa24,email:_0xdadf03,role:_0x10b638}=_0x4a6b4c[_0x4c596b(0x18e)],_0x1e29b2=_0x4a6b4c[_0x4c596b(0x18e)],_0x4f13c8=await profile[_0x4c596b(0x146)]({'email':_0x1e29b2['email']}),_0x149e9a=await master_shop[_0x4c596b(0x1fc)](),_0xc4e645=_0x4a6b4c[_0x4c596b(0x1d7)]['id'],_0x5dcde0=await sales[_0x4c596b(0x18b)](_0xc4e645);var _0x5ea973=['Ambient',_0x4c596b(0x1e2)];const _0x3c5731=await warehouse[_0x4c596b(0x127)]([{'$match':{'name':_0x5dcde0['warehouse_name'],'warehouse_category':_0x4c596b(0x1d6)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4c596b(0x171),'name':{'$first':_0x4c596b(0x16a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4c596b(0x1ea)},'bin':{'$first':_0x4c596b(0x1a1)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4c596b(0x155)},'secondary_code':{'$first':_0x4c596b(0x186)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4c596b(0x1aa)}}}]),_0x50725=await customer[_0x4c596b(0x1fc)]({});let _0xda0df4;if(_0x1e29b2['role']==_0x4c596b(0x1d9)){const _0xdf00be=await staff[_0x4c596b(0x146)]({'email':_0x1e29b2[_0x4c596b(0x1e3)]});_0xda0df4=await warehouse[_0x4c596b(0x127)]([{'$match':{'status':_0x4c596b(0x1fe),'name':_0xdf00be[_0x4c596b(0x120)],'warehouse_category':_0x4c596b(0x1d6)}},{'$group':{'_id':_0x4c596b(0x1e8),'name':{'$first':_0x4c596b(0x1e8)}}}]);}else _0xda0df4=await warehouse['aggregate']([{'$match':{'status':_0x4c596b(0x1fe),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x2aa582=await product['find']({});if(_0x149e9a[0x0][_0x4c596b(0x1b8)]==_0x4c596b(0x1ef)){var _0x16b885=users[_0x4c596b(0x193)];console[_0x4c596b(0x1ee)](_0x16b885);}else{if(_0x149e9a[0x0]['language']==_0x4c596b(0x1e0))var _0x16b885=users[_0x4c596b(0x1e0)];else{if(_0x149e9a[0x0][_0x4c596b(0x1b8)]==_0x4c596b(0x1bd))var _0x16b885=users[_0x4c596b(0x1bd)];else{if(_0x149e9a[0x0][_0x4c596b(0x1b8)]=='Spanish')var _0x16b885=users[_0x4c596b(0x202)];else{if(_0x149e9a[0x0]['language']=='French')var _0x16b885=users[_0x4c596b(0x189)];else{if(_0x149e9a[0x0][_0x4c596b(0x1b8)]=='Portuguese\x20(BR)')var _0x16b885=users[_0x4c596b(0x13d)];else{if(_0x149e9a[0x0]['language']==_0x4c596b(0x185))var _0x16b885=users[_0x4c596b(0x185)];else{if(_0x149e9a[0x0][_0x4c596b(0x1b8)]==_0x4c596b(0x152))var _0x16b885=users['Arabic'];}}}}}}}_0x25344a['render'](_0x4c596b(0x210),{'success':_0x4a6b4c[_0x4c596b(0x1ab)](_0x4c596b(0x125)),'errors':_0x4a6b4c[_0x4c596b(0x1ab)]('errors'),'role':_0x1e29b2,'profile':_0x4f13c8,'customer':_0x50725,'warehouse':_0xda0df4,'product':_0x3c5731,'user':_0x5dcde0,'master_shop':_0x149e9a,'unit':_0x2aa582,'language':_0x16b885});}catch(_0xa1fff8){console[_0x4c596b(0x1ee)](_0xa1fff8);}}),router[a0_0x2664f1(0x160)]('/view/:id',auth,async(_0xbd9b02,_0x11cc98)=>{var _0x4c1ba7=a0_0x2664f1;try{const _0x1c199b=_0xbd9b02[_0x4c1ba7(0x1d7)]['id'],_0x5d300b=await sales[_0x4c1ba7(0x146)]({'_id':_0xbd9b02['params']['id']}),_0x1ee88d=await warehouse[_0x4c1ba7(0x146)]({'name':_0x5d300b[_0x4c1ba7(0x15b)],'room':_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x1a9)]}),{invoice:_0x49610e,date:_0x38eecc,warehouse_name:_0x551cd2,product_name:_0x422cc9,stock:_0x28b313,quantity:_0xa317ff,note:_0x5aaee6,room:_0x2ef540,customer:_0x5973fc,SCRN:_0x2c925d}=_0xbd9b02[_0x4c1ba7(0x1c9)];if(typeof _0x422cc9==_0x4c1ba7(0x1b3))var _0x318c58=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x149)]],_0x4ef80e=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x124)]],_0x302839=[_0xbd9b02[_0x4c1ba7(0x1c9)]['carton']],_0x6a1e7a=[_0xbd9b02['body']['primary_code']],_0x105e2e=[_0xbd9b02['body'][_0x4c1ba7(0x21c)]],_0x5ebec9=[_0xbd9b02['body'][_0x4c1ba7(0x178)]],_0x18ea45=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x14c)]],_0x719e2b=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x20e)]],_0x6caaa0=[_0xbd9b02['body'][_0x4c1ba7(0x1e1)]],_0x4ff495=[_0xbd9b02['body'][_0x4c1ba7(0x1f7)]],_0x596460=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x18f)]],_0x39e465=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x169)]],_0x37822b=[_0xbd9b02['body']['production_date']],_0x35a7a7=[_0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x1fa)]],_0x1e7cc9=[_0xbd9b02[_0x4c1ba7(0x1c9)]['delivery_date']],_0x3b8a6c=[_0xbd9b02['body']['delivery_code']],_0x414d2a=[_0xbd9b02['body'][_0x4c1ba7(0x17c)]],_0xc9f691=[_0xbd9b02[_0x4c1ba7(0x1c9)]['quantity']],_0x11daf6=[_0xbd9b02[_0x4c1ba7(0x1c9)]['RoomAssigned']];else var _0x318c58=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x149)]],_0x4ef80e=[..._0xbd9b02[_0x4c1ba7(0x1c9)]['stock']],_0x302839=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x1e6)]],_0x6a1e7a=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x1bb)]],_0x105e2e=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x21c)]],_0x5ebec9=[..._0xbd9b02['body'][_0x4c1ba7(0x178)]],_0x18ea45=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x14c)]],_0x719e2b=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x20e)]],_0x6caaa0=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x1e1)]],_0x4ff495=[..._0xbd9b02['body'][_0x4c1ba7(0x1f7)]],_0x596460=[..._0xbd9b02['body'][_0x4c1ba7(0x18f)]],_0x39e465=[..._0xbd9b02['body'][_0x4c1ba7(0x169)]],_0x37822b=[..._0xbd9b02[_0x4c1ba7(0x1c9)][_0x4c1ba7(0x180)]],_0x35a7a7=[..._0xbd9b02[_0x4c1ba7(0x1c9)]['requested_qty']],_0x1e7cc9=[..._0xbd9b02[_0x4c1ba7(0x1c9)]['delivery_date']],_0x3b8a6c=[..._0xbd9b02[_0x4c1ba7(0x1c9)]['delivery_code']],_0x414d2a=[..._0xbd9b02[_0x4c1ba7(0x1c9)]['prod_cat']],_0xc9f691=[..._0xbd9b02['body']['quantity']],_0x11daf6=[..._0xbd9b02['body'][_0x4c1ba7(0x1b5)]];const _0x2eeeac=_0x318c58[_0x4c1ba7(0x20c)](_0x314747=>{return _0x314747={'product_name':_0x314747};});_0x4ef80e['forEach']((_0x23e964,_0x123f83)=>{var _0x435560=_0x4c1ba7;_0x2eeeac[_0x123f83][_0x435560(0x124)]=Math[_0x435560(0x13f)](_0x23e964);}),_0x302839[_0x4c1ba7(0x130)]((_0x5f1281,_0x4c1b74)=>{var _0x156be5=_0x4c1ba7;_0x2eeeac[_0x4c1b74][_0x156be5(0x163)]=_0x5f1281;}),_0x6a1e7a[_0x4c1ba7(0x130)]((_0x2f80a3,_0x29a401)=>{_0x2eeeac[_0x29a401]['primary_code']=_0x2f80a3;}),_0x105e2e[_0x4c1ba7(0x130)]((_0x182e2b,_0x5ee47b)=>{var _0x2f931f=_0x4c1ba7;_0x2eeeac[_0x5ee47b][_0x2f931f(0x21c)]=_0x182e2b;}),_0x5ebec9[_0x4c1ba7(0x130)]((_0xfb7832,_0x1cb11d)=>{var _0x1639ef=_0x4c1ba7;_0x2eeeac[_0x1cb11d][_0x1639ef(0x13b)]=_0xfb7832;}),_0x18ea45[_0x4c1ba7(0x130)]((_0x126996,_0x17b446)=>{_0x11daf6['forEach']((_0xe9b91f,_0x36896c)=>{var _0x2d65c1=a0_0x5e73;if(_0xe9b91f==_0x2d65c1(0x145)&&_0x17b446==_0x36896c){var _0x552e5f=_0x126996[_0x2d65c1(0x1e4)](0x3);_0x2eeeac[_0x17b446][_0x2d65c1(0x181)]=_0x126996[0x0],_0x2eeeac[_0x17b446][_0x2d65c1(0x1b7)]=_0x126996[0x1],_0x2eeeac[_0x17b446]['bay']=0x0,_0x2eeeac[_0x17b446][_0x2d65c1(0x205)]=0x0,_0x2eeeac[_0x17b446]['type']='Floor',_0x2eeeac[_0x17b446][_0x2d65c1(0x19b)]=_0x552e5f;}else{if(_0xe9b91f==_0x2d65c1(0x15c)&&_0x17b446==_0x36896c){var _0x552e5f=_0x126996[_0x2d65c1(0x1e4)](0x3);_0x2eeeac[_0x17b446][_0x2d65c1(0x181)]=_0x126996[0x0],_0x2eeeac[_0x17b446][_0x2d65c1(0x1b7)]=_0x126996[0x1],_0x2eeeac[_0x17b446]['bay']=0x0,_0x2eeeac[_0x17b446]['bin']=0x0,_0x2eeeac[_0x17b446][_0x2d65c1(0x119)]=_0x2d65c1(0x1a4),_0x2eeeac[_0x17b446]['floorlevel']=_0x126996[0x5];}else{if(_0x17b446==_0x36896c){var _0x189e2c;if(_0x126996[0x4]=='L')_0x189e2c=_0x2d65c1(0x132);else _0x126996[0x4]=='F'&&(_0x189e2c=_0x2d65c1(0x1a4));_0x2eeeac[_0x17b446]['storage']=_0x126996[0x0],_0x2eeeac[_0x17b446][_0x2d65c1(0x1b7)]=_0x126996[0x1],_0x2eeeac[_0x17b446][_0x2d65c1(0x209)]=_0x126996[0x2],_0x2eeeac[_0x17b446][_0x2d65c1(0x205)]=_0x126996[0x3],_0x2eeeac[_0x17b446][_0x2d65c1(0x119)]=_0x189e2c,_0x2eeeac[_0x17b446][_0x2d65c1(0x19b)]=_0x126996[0x5];}}}});}),_0x719e2b[_0x4c1ba7(0x130)]((_0x28fa98,_0x63c990)=>{var _0x4ce5f5=_0x4c1ba7;_0x2eeeac[_0x63c990][_0x4ce5f5(0x157)]=_0x28fa98;}),_0x6caaa0[_0x4c1ba7(0x130)]((_0x37242c,_0xacb5f3)=>{var _0xc7b541=_0x4c1ba7;_0x2eeeac[_0xacb5f3][_0xc7b541(0x1e1)]=_0x37242c;}),_0x4ff495[_0x4c1ba7(0x130)]((_0x5c9489,_0x102a6a)=>{var _0x5f5dfc=_0x4c1ba7;_0x2eeeac[_0x102a6a][_0x5f5dfc(0x1f7)]=_0x5c9489;}),_0x596460[_0x4c1ba7(0x130)]((_0x4c964e,_0x10552e)=>{_0x2eeeac[_0x10552e]['expiry_date']=_0x4c964e;}),_0x39e465['forEach']((_0x432c73,_0xcec19d)=>{var _0x3d587d=_0x4c1ba7;_0x2eeeac[_0xcec19d][_0x3d587d(0x136)]=_0x432c73;}),_0x37822b[_0x4c1ba7(0x130)]((_0x32b80f,_0xf384d5)=>{var _0x5e0952=_0x4c1ba7;_0x2eeeac[_0xf384d5][_0x5e0952(0x180)]=_0x32b80f;}),_0x35a7a7[_0x4c1ba7(0x130)]((_0x55f201,_0x2e39ff)=>{var _0x55dd01=_0x4c1ba7;_0x2eeeac[_0x2e39ff][_0x55dd01(0x1fa)]=Math[_0x55dd01(0x13f)](_0x55f201);}),_0x1e7cc9['forEach']((_0x31f9c1,_0x108465)=>{var _0x10b896=_0x4c1ba7;_0x2eeeac[_0x108465][_0x10b896(0x1dc)]=_0x31f9c1;}),_0x3b8a6c[_0x4c1ba7(0x130)]((_0x24fedc,_0x3804ed)=>{_0x2eeeac[_0x3804ed]['delivery_code']=_0x24fedc;}),_0x414d2a['forEach']((_0x55107c,_0x5d1246)=>{var _0x47c701=_0x4c1ba7;_0x2eeeac[_0x5d1246][_0x47c701(0x17c)]=_0x55107c;}),_0xc9f691['forEach']((_0x3cfc3a,_0x33a007)=>{var _0x36fd1e=_0x4c1ba7;_0x2eeeac[_0x33a007][_0x36fd1e(0x21b)]=_0x3cfc3a;}),_0x11daf6[_0x4c1ba7(0x130)]((_0x20c23f,_0x7e77b4)=>{_0x2eeeac[_0x7e77b4]['room_name']=_0x20c23f;});var _0x31c7d5=0x0;_0x2eeeac[_0x4c1ba7(0x130)](_0x10ea8c=>{var _0xbaee3e=_0x4c1ba7;console[_0xbaee3e(0x1ee)](_0xbaee3e(0x17b),_0x10ea8c),(parseInt(_0x10ea8c[_0xbaee3e(0x124)])<parseInt(_0x10ea8c[_0xbaee3e(0x163)])||parseInt(_0x10ea8c[_0xbaee3e(0x163)])==0x0)&&_0x31c7d5++;});if(_0x31c7d5!=0x0)return _0xbd9b02[_0x4c1ba7(0x1ab)](_0x4c1ba7(0x17e),_0x4c1ba7(0x121)),_0x11cc98[_0x4c1ba7(0x1c0)](_0x4c1ba7(0x1a0));const _0x336c77=_0x2eeeac[_0x4c1ba7(0x114)](_0xfaa1d0=>_0xfaa1d0['quantity']!=='0'&&_0xfaa1d0['quantity']!=='');_0x5d300b[_0x4c1ba7(0x1c7)]=_0x49610e,_0x5d300b['customer']=_0x5973fc,_0x5d300b[_0x4c1ba7(0x12f)]=_0x38eecc,_0x5d300b['warehouse_name']=_0x551cd2,_0x5d300b[_0x4c1ba7(0x170)]=_0x336c77,_0x5d300b[_0x4c1ba7(0x18c)]=_0x5aaee6,_0x5d300b[_0x4c1ba7(0x1b1)]=_0x2c925d,_0x5d300b[_0x4c1ba7(0x1f5)]='False',_0x5d300b[_0x4c1ba7(0x1a5)]='False';const _0x51a998=await _0x5d300b['save']();_0xbd9b02[_0x4c1ba7(0x1ab)](_0x4c1ba7(0x125),_0x4c1ba7(0x1ed)),_0x11cc98[_0x4c1ba7(0x1c0)](_0x4c1ba7(0x1bf));}catch(_0x24b763){console[_0x4c1ba7(0x1ee)](_0x24b763);}}),router[a0_0x2664f1(0x160)]('/give_payment/:id',auth,async(_0x29f2b3,_0x15f4ba)=>{var _0x5d0a5c=a0_0x2664f1;try{const _0x5a794a=_0x29f2b3[_0x5d0a5c(0x1d7)]['id'],{invoice:_0x199cc9,customer:_0x5d4289,receivable_amount:_0x168700,received_amount:_0x3b79ea}=_0x29f2b3[_0x5d0a5c(0x1c9)],_0x211e56=await sales['findById'](_0x5a794a);console[_0x5d0a5c(0x1ee)](_0x211e56);var _0x358dde=_0x168700-_0x3b79ea;console[_0x5d0a5c(0x1ee)](_0x3b79ea),_0x211e56[_0x5d0a5c(0x17a)]=parseFloat(_0x3b79ea)+parseFloat(_0x211e56[_0x5d0a5c(0x17a)]),_0x211e56[_0x5d0a5c(0x1da)]=_0x358dde,console[_0x5d0a5c(0x1ee)](_0x211e56);const _0x332207=await _0x211e56[_0x5d0a5c(0x174)](),_0x3b0c96=await c_payment_data['findOne']({'invoice':_0x199cc9});_0x3b0c96['amount']=_0x358dde,await _0x3b0c96[_0x5d0a5c(0x174)]();let _0x217cf6=new Date(),_0x259e79=('0'+_0x217cf6['getDate']())[_0x5d0a5c(0x1e4)](-0x2),_0x3d3279=('0'+(_0x217cf6[_0x5d0a5c(0x11e)]()+0x1))[_0x5d0a5c(0x1e4)](-0x2),_0x131bd8=_0x217cf6[_0x5d0a5c(0x207)](),_0x1d550e=_0x131bd8+'-'+_0x3d3279+'-'+_0x259e79;const _0x566bc1=new customer_payment({'invoice':_0x199cc9,'date':_0x131bd8+'-'+_0x3d3279+'-'+_0x259e79,'customer':_0x5d4289,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x3b79ea}),_0x2a5a3d=await _0x566bc1[_0x5d0a5c(0x174)]();_0x29f2b3['flash'](_0x5d0a5c(0x125),'payment\x20successfull'),_0x15f4ba[_0x5d0a5c(0x1c0)](_0x5d0a5c(0x1bf));}catch(_0x1c9967){console['log'](_0x1c9967);}}),router['get'](a0_0x2664f1(0x13e),auth,async(_0x202561,_0xa4fa91)=>{var _0xd7208d=a0_0x2664f1;try{const {username:_0x28dc54,email:_0x5492af,role:_0x5525a5}=_0x202561[_0xd7208d(0x18e)],_0x43f9b6=_0x202561['user'],_0xafabda=await profile[_0xd7208d(0x146)]({'email':_0x43f9b6[_0xd7208d(0x1e3)]}),_0x460062=await master_shop[_0xd7208d(0x1fc)]();console[_0xd7208d(0x1ee)](_0xd7208d(0x1c5),_0x460062);const _0x2efb3f=_0x202561[_0xd7208d(0x1d7)]['id'],_0x52bd8b=await sales[_0xd7208d(0x18b)](_0x2efb3f);console[_0xd7208d(0x1ee)](_0x52bd8b);const _0x175efe=await customer['findOne']({'name':_0x52bd8b['customer']});console[_0xd7208d(0x1ee)](_0x175efe);if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x1ef)){var _0x79ffd4=users['English'];console['log'](_0x79ffd4);}else{if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x1e0))var _0x79ffd4=users['Hindi'];else{if(_0x460062[0x0][_0xd7208d(0x1b8)]=='German')var _0x79ffd4=users[_0xd7208d(0x1bd)];else{if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x202))var _0x79ffd4=users[_0xd7208d(0x202)];else{if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x189))var _0x79ffd4=users[_0xd7208d(0x189)];else{if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x218))var _0x79ffd4=users['Portuguese'];else{if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x185))var _0x79ffd4=users[_0xd7208d(0x185)];else{if(_0x460062[0x0][_0xd7208d(0x1b8)]==_0xd7208d(0x152))var _0x79ffd4=users[_0xd7208d(0x1f4)];}}}}}}}_0xa4fa91[_0xd7208d(0x147)](_0xd7208d(0x211),{'success':_0x202561[_0xd7208d(0x1ab)](_0xd7208d(0x125)),'errors':_0x202561['flash'](_0xd7208d(0x17e)),'role':_0x43f9b6,'profile':_0xafabda,'master_shop':_0x460062,'customers':_0x175efe,'sales':_0x52bd8b,'language':_0x79ffd4});}catch(_0x795157){console[_0xd7208d(0x1ee)](_0x795157);}}),router['get'](a0_0x2664f1(0x1c6),auth,async(_0x5ef13b,_0x3c327c)=>{var _0x4ed42e=a0_0x2664f1;try{const {username:_0x430a1a,email:_0x31f7bf,role:_0x19813a}=_0x5ef13b['user'],_0x1bb925=_0x5ef13b[_0x4ed42e(0x18e)],_0x564b0b=await profile[_0x4ed42e(0x146)]({'email':_0x1bb925[_0x4ed42e(0x1e3)]}),_0x31ef3=await master_shop[_0x4ed42e(0x1fc)]();console[_0x4ed42e(0x1ee)](_0x4ed42e(0x1c5),_0x31ef3);const _0x120b26=_0x5ef13b[_0x4ed42e(0x1d7)]['id'];console[_0x4ed42e(0x1ee)](_0x120b26);const _0x18ce17=await sales['findById'](_0x120b26);console[_0x4ed42e(0x1ee)](_0x4ed42e(0x1db),_0x18ce17);const _0xa26201=await warehouse[_0x4ed42e(0x127)]([{'$match':{'name':_0x4ed42e(0x12a),'room':_0x4ed42e(0x14e)}},{'$unwind':_0x4ed42e(0x198)},{'$group':{'_id':_0x4ed42e(0x171),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4ed42e(0x123)},'level':{'$first':_0x4ed42e(0x165)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4ed42e(0x184)},'primary_code':{'$first':_0x4ed42e(0x155)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4ed42e(0x196)}}}]);console[_0x4ed42e(0x1ee)]('stock_data',_0xa26201);const _0xc6661=await product[_0x4ed42e(0x1fc)]({});warehouse_data=await warehouse[_0x4ed42e(0x127)]([{'$match':{'status':_0x4ed42e(0x1fe),'name':'Return\x20Goods','warehouse_category':_0x4ed42e(0x1d6)}},{'$group':{'_id':_0x4ed42e(0x1e8),'name':{'$first':_0x4ed42e(0x1e8)}}},{'$sort':{'name':0x1}}]);var _0x6e3c3d=['Return\x20Rooms'];if(_0x31ef3[0x0][_0x4ed42e(0x1b8)]==_0x4ed42e(0x1ef)){var _0x1a1314=users[_0x4ed42e(0x193)];console[_0x4ed42e(0x1ee)](_0x1a1314);}else{if(_0x31ef3[0x0][_0x4ed42e(0x1b8)]==_0x4ed42e(0x1e0))var _0x1a1314=users[_0x4ed42e(0x1e0)];else{if(_0x31ef3[0x0][_0x4ed42e(0x1b8)]==_0x4ed42e(0x1bd))var _0x1a1314=users[_0x4ed42e(0x1bd)];else{if(_0x31ef3[0x0][_0x4ed42e(0x1b8)]==_0x4ed42e(0x202))var _0x1a1314=users[_0x4ed42e(0x202)];else{if(_0x31ef3[0x0][_0x4ed42e(0x1b8)]==_0x4ed42e(0x189))var _0x1a1314=users['French'];else{if(_0x31ef3[0x0][_0x4ed42e(0x1b8)]=='Portuguese\x20(BR)')var _0x1a1314=users[_0x4ed42e(0x13d)];else{if(_0x31ef3[0x0]['language']==_0x4ed42e(0x185))var _0x1a1314=users[_0x4ed42e(0x185)];else{if(_0x31ef3[0x0]['language']==_0x4ed42e(0x152))var _0x1a1314=users['Arabic'];}}}}}}}_0x3c327c['render'](_0x4ed42e(0x197),{'success':_0x5ef13b['flash'](_0x4ed42e(0x125)),'errors':_0x5ef13b['flash'](_0x4ed42e(0x17e)),'role':_0x1bb925,'profile':_0x564b0b,'user':_0x18ce17,'stock':_0xa26201,'master_shop':_0x31ef3,'unit':_0xc6661,'language':_0x1a1314,'warehouses':warehouse_data,'rooms':_0x6e3c3d});}catch(_0x2cfd63){console[_0x4ed42e(0x1ee)](_0x2cfd63),_0x3c327c[_0x4ed42e(0x1a3)](0xc8)[_0x4ed42e(0x16e)]({'message':_0x2cfd63[_0x4ed42e(0x215)]});}}),router[a0_0x2664f1(0x160)]('/view/return_sales/:id',auth,async(_0x3c1441,_0x503199)=>{var _0x4d66fa=a0_0x2664f1;try{const {invoice:_0x4cc206,date:_0x2dc863,warehouse_name:_0x1f4217,product_name:_0x2a4ec4,primary_code:_0x27b378,secondary_code:_0x4506e0,product_code:_0x5a4cf0,sales_quantity:_0x3f9b11,stocks:_0x48227f,return_qty:_0x1078da,Room_name:_0x4dc4fb,to_warehouse_name:_0x28d107,to_Roomname:_0x218068,to_Room_name:_0x3a60c5,note:_0x8f1600,level:_0x548a8d,isle:_0x281eea,pallet:_0x1358b0}=_0x3c1441[_0x4d66fa(0x1c9)];if(typeof _0x2a4ec4==_0x4d66fa(0x1b3))var _0x281224=[_0x3c1441['body'][_0x4d66fa(0x149)]],_0x463796=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x1bb)]],_0x185e1f=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x21c)]],_0x2c41f3=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x13b)]],_0x206186=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x1d4)]],_0x4092bd=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x167)]],_0x2645b2=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x21e)]],_0x2dc3ab=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x209)]],_0x40ffc4=[_0x3c1441[_0x4d66fa(0x1c9)]['bin']],_0x4d24fa=[_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x1c3)]],_0x47eb59=[_0x3c1441['body'][_0x4d66fa(0x19b)]];else var _0x281224=[..._0x3c1441[_0x4d66fa(0x1c9)]['product_name']],_0x463796=[..._0x3c1441[_0x4d66fa(0x1c9)]['primary_code']],_0x185e1f=[..._0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x21c)]],_0x2c41f3=[..._0x3c1441['body'][_0x4d66fa(0x13b)]],_0x206186=[..._0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x1d4)]],_0x4092bd=[..._0x3c1441['body'][_0x4d66fa(0x167)]],_0x2645b2=[..._0x3c1441['body'][_0x4d66fa(0x21e)]],_0x2dc3ab=[..._0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x209)]],_0x40ffc4=[..._0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x205)]],_0x4d24fa=[..._0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x1c3)]],_0x47eb59=[..._0x3c1441['body'][_0x4d66fa(0x19b)]];const _0x30b03d=_0x281224[_0x4d66fa(0x20c)](_0x39f31e=>{return _0x39f31e={'product_name':_0x39f31e};});_0x463796['forEach']((_0xf3c9d3,_0x4fc1a2)=>{var _0x5cf1f6=_0x4d66fa;_0x30b03d[_0x4fc1a2][_0x5cf1f6(0x1bb)]=_0xf3c9d3;}),_0x185e1f[_0x4d66fa(0x130)]((_0x2dd915,_0x9af8b7)=>{var _0x5dd9b7=_0x4d66fa;_0x30b03d[_0x9af8b7][_0x5dd9b7(0x21c)]=_0x2dd915;}),_0x2c41f3[_0x4d66fa(0x130)]((_0x49cab3,_0x5121b6)=>{var _0x1bd889=_0x4d66fa;_0x30b03d[_0x5121b6][_0x1bd889(0x13b)]=_0x49cab3;}),_0x206186[_0x4d66fa(0x130)]((_0x1f7c5c,_0x105ca9)=>{var _0x4dfa2b=_0x4d66fa;_0x30b03d[_0x105ca9][_0x4dfa2b(0x19a)]=_0x1f7c5c;}),_0x4092bd['forEach']((_0x4d5132,_0x10e678)=>{var _0x2705fb=_0x4d66fa;_0x30b03d[_0x10e678][_0x2705fb(0x124)]=_0x4d5132;}),_0x2645b2[_0x4d66fa(0x130)]((_0x3cd36b,_0xc11fe2)=>{_0x30b03d[_0xc11fe2]['return_qty']=_0x3cd36b;}),_0x2dc3ab['forEach']((_0x22b06f,_0x3e039e)=>{var _0x5b4027=_0x4d66fa;_0x30b03d[_0x3e039e][_0x5b4027(0x209)]=_0x22b06f;}),_0x40ffc4[_0x4d66fa(0x130)]((_0x5a55cf,_0xc163da)=>{var _0x15ff9f=_0x4d66fa;_0x30b03d[_0xc163da][_0x15ff9f(0x205)]=_0x5a55cf;}),_0x4d24fa[_0x4d66fa(0x130)]((_0x1696ab,_0x48c648)=>{_0x30b03d[_0x48c648]['type']=_0x1696ab;}),_0x47eb59[_0x4d66fa(0x130)]((_0x396e42,_0x51e603)=>{var _0x5d87e3=_0x4d66fa;_0x30b03d[_0x51e603][_0x5d87e3(0x19b)]=_0x396e42;});var _0x4ed13e=0x0;_0x30b03d[_0x4d66fa(0x130)](_0x29bfb7=>{var _0x2390a8=_0x4d66fa;console[_0x2390a8(0x1ee)](_0x2390a8(0x17b),_0x29bfb7),(parseInt(_0x29bfb7[_0x2390a8(0x19a)])<parseInt(_0x29bfb7[_0x2390a8(0x21e)])||parseInt(_0x29bfb7[_0x2390a8(0x124)])<parseInt(_0x29bfb7[_0x2390a8(0x21e)])&&parseInt(_0x29bfb7[_0x2390a8(0x19a)])>parseInt(_0x29bfb7['return_qty'])||parseInt(_0x29bfb7[_0x2390a8(0x21e)])==0x0)&&_0x4ed13e++;});if(_0x4ed13e!=0x0)return _0x3c1441[_0x4d66fa(0x1ab)](_0x4d66fa(0x17e),_0x4d66fa(0x1c4)),_0x503199[_0x4d66fa(0x1c0)](_0x4d66fa(0x1a0));const _0xc24332=await sales['findOne']({'invoice':_0x4cc206});console[_0x4d66fa(0x1ee)](_0xc24332),_0xc24332[_0x4d66fa(0x221)]=_0x4d66fa(0x20d);const _0x1dd487=await _0xc24332[_0x4d66fa(0x174)](),_0x427653=new sales_return({'invoice':_0x4cc206,'customer':_0x3c1441[_0x4d66fa(0x1c9)][_0x4d66fa(0x1ca)],'date':_0x2dc863,'warehouse_name':_0x1f4217,'room':_0x4dc4fb,'ToWarehouse':_0x28d107,'ToRoom':_0x3a60c5,'return_sale':_0x30b03d,'note':_0x8f1600}),_0xb493fb=await _0x427653['save']();console['log'](_0x427653);const _0x42f17f=await sales_return['findOne']({'invoice':_0x4cc206}),_0x1de6e0=await warehouse[_0x4d66fa(0x146)]({'name':_0x28d107,'room':_0x3a60c5});_0x42f17f[_0x4d66fa(0x197)]['forEach'](_0x57b659=>{var _0x419901=_0x4d66fa,_0x51d3d9=0x0;const _0x3cdcd8=_0x1de6e0['product_details'][_0x419901(0x20c)](_0x1a5388=>{var _0x4ccffc=_0x419901;_0x1a5388[_0x4ccffc(0x149)]==_0x57b659['product_name']&&_0x1a5388['floorlevel']==_0x57b659[_0x4ccffc(0x19b)]&&_0x1a5388[_0x4ccffc(0x119)]==_0x57b659[_0x4ccffc(0x119)]&&_0x1a5388[_0x4ccffc(0x205)]==_0x57b659[_0x4ccffc(0x205)]&&_0x1a5388[_0x4ccffc(0x209)]==_0x57b659[_0x4ccffc(0x209)]&&(_0x1a5388['product_stock']=parseInt(_0x1a5388['product_stock'])+parseInt(_0x57b659[_0x4ccffc(0x21e)]),_0x51d3d9++);});_0x51d3d9=='0'&&(_0x1de6e0[_0x419901(0x1f3)]=_0x1de6e0[_0x419901(0x1f3)][_0x419901(0x126)]({'product_name':_0x57b659[_0x419901(0x149)],'product_stock':_0x57b659[_0x419901(0x21e)],'primary_code':_0x57b659[_0x419901(0x1bb)],'secondary_code':_0x57b659[_0x419901(0x21c)],'product_code':_0x57b659[_0x419901(0x13b)],'bay':_0x57b659['bay'],'bin':_0x57b659[_0x419901(0x205)],'type':_0x57b659[_0x419901(0x119)],'floorlevel':_0x57b659['floorlevel']})),console['log'](_0x419901(0x137),_0x1de6e0);}),await _0x1de6e0[_0x4d66fa(0x174)](),console[_0x4d66fa(0x1ee)](_0x3c1441['body']);const _0x31e009=new c_payment_data({'invoice':_0x4cc206,'customer':_0x3c1441[_0x4d66fa(0x1c9)]['customer'],'reason':_0x4d66fa(0x158)});await _0x31e009[_0x4d66fa(0x174)]();const _0x163fea=await master_shop['find']();console[_0x4d66fa(0x1ee)]('add\x20post',_0x163fea[0x0][_0x4d66fa(0x13a)]);const _0x320c1e=await email_settings[_0x4d66fa(0x146)](),_0x40a5a4=await customer['findOne']({'name':_0x3c1441['body']['customer']});console['log'](_0x4d66fa(0x1d3),_0x40a5a4);_0x163fea[0x0][_0x4d66fa(0x191)]==0x1?(right_currency=_0x163fea[0x0][_0x4d66fa(0x1a6)],left_currency=''):(right_currency='',left_currency=_0x163fea[0x0][_0x4d66fa(0x1a6)]);var _0x47f3d8=_0x281224,_0x5cfd2f=_0x2645b2,_0x24bbef='',_0x4531b9;for(_0x4531b9 in _0x47f3d8){_0x24bbef+=_0x4d66fa(0x1be)+_0x4d66fa(0x1cc)+_0x47f3d8[_0x4531b9]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5cfd2f[_0x4531b9]+'</td>'+_0x4d66fa(0x1d5);}console['log']('product_list',_0x24bbef);let _0x2277e0=nodemailer[_0x4d66fa(0x194)]({'service':_0x4d66fa(0x143),'auth':{'user':_0x320c1e[_0x4d66fa(0x1e3)],'pass':_0x320c1e[_0x4d66fa(0x172)]}}),_0x132965={'from':_0x320c1e[_0x4d66fa(0x1e3)],'to':_0x40a5a4[_0x4d66fa(0x1e3)],'subject':_0x4d66fa(0x187),'attachments':[{'filename':_0x4d66fa(0x153),'path':__dirname+'/../public'+_0x4d66fa(0x140)+_0x163fea[0x0]['image'],'cid':_0x4d66fa(0x13c)}],'html':_0x4d66fa(0x1a8)+_0x4d66fa(0x129)+_0x4d66fa(0x1ff)+_0x4d66fa(0x1cb)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4d66fa(0x1cb)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4d66fa(0x1f1)+'<div>'+_0x4d66fa(0x11c)+_0x163fea[0x0]['site_title']+_0x4d66fa(0x131)+_0x4d66fa(0x1f1)+_0x4d66fa(0x1f1)+'<hr\x20class=\x22my-3\x22>'+_0x4d66fa(0x1cb)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4d66fa(0x20f)+_0x4cc206+'\x20'+_0x4d66fa(0x188)+_0x4d66fa(0x216)+_0x2dc863+'\x20'+_0x4d66fa(0x150)+_0x4d66fa(0x154)+_0x4d66fa(0x1f1)+_0x4d66fa(0x16c)+_0x4d66fa(0x16f)+_0x4d66fa(0x1be)+_0x4d66fa(0x20b)+_0x4d66fa(0x1d2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4d66fa(0x213)+'</tr>'+'</thead>'+_0x4d66fa(0x164)+'\x20'+_0x24bbef+'\x20'+_0x4d66fa(0x11b)+_0x4d66fa(0x204)+_0x4d66fa(0x1cb)+_0x4d66fa(0x182)+_0x4d66fa(0x1f0)+_0x163fea[0x0][_0x4d66fa(0x1e5)]+_0x4d66fa(0x154)+_0x4d66fa(0x1f1)+_0x4d66fa(0x1f1)+_0x4d66fa(0x214)};_0x2277e0[_0x4d66fa(0x177)](_0x132965,function(_0x3434a5,_0x5258b0){var _0x284d82=_0x4d66fa;_0x3434a5?(console[_0x284d82(0x1ee)](_0x3434a5),console[_0x284d82(0x1ee)]('Error\x20Occurs')):console[_0x284d82(0x1ee)](_0x284d82(0x1a2));}),_0x3c1441['flash'](_0x4d66fa(0x125),_0x4d66fa(0x1cf)),_0x503199[_0x4d66fa(0x1c0)]('/all_sales/view');}catch(_0xf75f35){console[_0x4d66fa(0x1ee)](_0xf75f35),_0x503199[_0x4d66fa(0x1a3)](0xc8)[_0x4d66fa(0x16e)]({'message1':_0xf75f35[_0x4d66fa(0x215)]});}}),router['get'](a0_0x2664f1(0x134),auth,async(_0x1a30ec,_0x583983)=>{var _0x64ffa8=a0_0x2664f1;try{const {username:_0x9dac45,email:_0xf8e9b0,role:_0x436695}=_0x1a30ec[_0x64ffa8(0x18e)],_0xd75aeb=_0x1a30ec[_0x64ffa8(0x18e)],_0x2625d0=await profile['findOne']({'email':_0xd75aeb['email']}),_0x44a673=await master_shop[_0x64ffa8(0x1fc)]();console['log'](_0x64ffa8(0x14b),_0x44a673);const _0x2cce9d=_0x1a30ec[_0x64ffa8(0x1d7)]['id'],_0x12a21a=await sales[_0x64ffa8(0x18b)](_0x2cce9d);console[_0x64ffa8(0x1ee)](_0x64ffa8(0x14d),_0x12a21a);if(_0x44a673[0x0][_0x64ffa8(0x1b8)]==_0x64ffa8(0x1ef))var _0x371b6c=users['English'];else{if(_0x44a673[0x0][_0x64ffa8(0x1b8)]==_0x64ffa8(0x1e0))var _0x371b6c=users['Hindi'];else{if(_0x44a673[0x0][_0x64ffa8(0x1b8)]==_0x64ffa8(0x1bd))var _0x371b6c=users[_0x64ffa8(0x1bd)];else{if(_0x44a673[0x0]['language']=='Spanish')var _0x371b6c=users[_0x64ffa8(0x202)];else{if(_0x44a673[0x0][_0x64ffa8(0x1b8)]==_0x64ffa8(0x189))var _0x371b6c=users[_0x64ffa8(0x189)];else{if(_0x44a673[0x0]['language']==_0x64ffa8(0x218))var _0x371b6c=users[_0x64ffa8(0x13d)];else{if(_0x44a673[0x0]['language']==_0x64ffa8(0x185))var _0x371b6c=users[_0x64ffa8(0x185)];else{if(_0x44a673[0x0][_0x64ffa8(0x1b8)]=='Arabic\x20(ae)')var _0x371b6c=users['Arabic'];}}}}}}}_0x583983['render'](_0x64ffa8(0x138),{'success':_0x1a30ec[_0x64ffa8(0x1ab)](_0x64ffa8(0x125)),'errors':_0x1a30ec[_0x64ffa8(0x1ab)](_0x64ffa8(0x17e)),'role':_0xd75aeb,'profile':_0x2625d0,'alldata':_0x12a21a,'master_shop':_0x44a673,'language':_0x371b6c});}catch(_0x106b79){console['log'](_0x106b79);}}),router[a0_0x2664f1(0x160)](a0_0x2664f1(0x17d),async(_0x1136f9,_0x385ffd)=>{var _0x440d1a=a0_0x2664f1;const {product_code:_0x16384b,warehouse_name:_0xf33218,rooms_data:_0x422702,Roomslist:_0x396769}=_0x1136f9[_0x440d1a(0x1c9)],_0x2f7f1b=_0x396769['split'](','),_0x5cffec=[];async function _0x146f92(_0x358cac){var _0x49c450=_0x440d1a;const _0x564829=await warehouse[_0x49c450(0x127)]([{'$match':{'name':_0xf33218,'room':_0x358cac}},{'$unwind':_0x49c450(0x198)},{'$match':{'product_details.primary_code':_0x16384b}},{'$group':{'_id':_0x49c450(0x171),'name':{'$first':_0x49c450(0x16a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x49c450(0x1a1)},'type':{'$first':_0x49c450(0x1ae)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x49c450(0x1b6)},'storage':{'$first':_0x49c450(0x12b)},'rack':{'$first':_0x49c450(0x1aa)},'expiry_date':{'$first':_0x49c450(0x201)},'production_date':{'$first':_0x49c450(0x144)},'maxPerUnit':{'$first':_0x49c450(0x133)},'batch_code':{'$first':_0x49c450(0x156)},'product_cat':{'$first':_0x49c450(0x21a)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x49c450(0x1eb)},'actual_qty':{'$first':_0x49c450(0x208)},'actual_uom':{'$first':_0x49c450(0x12c)}}}]),_0x2ab911=await warehouse[_0x49c450(0x127)]([{'$match':{'name':_0xf33218,'room':_0x358cac}},{'$unwind':_0x49c450(0x198)},{'$match':{'product_details.secondary_code':_0x16384b}},{'$group':{'_id':_0x49c450(0x171),'name':{'$first':_0x49c450(0x16a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x49c450(0x155)},'secondary_code':{'$first':_0x49c450(0x186)},'product_code':{'$first':_0x49c450(0x196)},'level':{'$first':_0x49c450(0x1ea)},'isle':{'$first':_0x49c450(0x1a1)},'type':{'$first':_0x49c450(0x1ae)},'pallet':{'$first':_0x49c450(0x11a)},'unit':{'$first':_0x49c450(0x20a)},'secondary_unit':{'$first':_0x49c450(0x1b6)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x49c450(0x144)},'maxPerUnit':{'$first':_0x49c450(0x133)},'batch_code':{'$first':_0x49c450(0x156)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x49c450(0x1ba)},'invoice':{'$first':_0x49c450(0x1eb)}}}]);if(_0x564829[_0x49c450(0x18d)]>0x0)_0x5cffec[_0x49c450(0x206)](_0x564829);else _0x2ab911[_0x49c450(0x18d)]>0x0&&_0x5cffec[_0x49c450(0x206)](_0x2ab911);}const _0x50c3ba=_0x2f7f1b['map'](_0x962d43=>_0x146f92(_0x962d43));await Promise[_0x440d1a(0x128)](_0x50c3ba),_0x385ffd[_0x440d1a(0x16e)](_0x5cffec);}),module[a0_0x2664f1(0x1b2)]=router;