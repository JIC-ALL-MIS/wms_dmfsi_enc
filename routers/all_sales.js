var a0_0x33f517=a0_0xf855;(function(_0x392f41,_0x33418e){var _0x1f0586=a0_0xf855,_0x5a5309=_0x392f41();while(!![]){try{var _0x414c62=-parseInt(_0x1f0586(0x136))/0x1+-parseInt(_0x1f0586(0x185))/0x2*(parseInt(_0x1f0586(0x1d1))/0x3)+-parseInt(_0x1f0586(0x1d5))/0x4+-parseInt(_0x1f0586(0x219))/0x5*(-parseInt(_0x1f0586(0x11d))/0x6)+-parseInt(_0x1f0586(0x1bf))/0x7*(-parseInt(_0x1f0586(0x155))/0x8)+-parseInt(_0x1f0586(0x14f))/0x9+parseInt(_0x1f0586(0x16c))/0xa*(parseInt(_0x1f0586(0x1ea))/0xb);if(_0x414c62===_0x33418e)break;else _0x5a5309['push'](_0x5a5309['shift']());}catch(_0x2815ae){_0x5a5309['push'](_0x5a5309['shift']());}}}(a0_0x731e,0x49308));const express=require(a0_0x33f517(0x19e)),app=express(),router=express[a0_0x33f517(0x12a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x33f517(0x1c6)),auth=require('../middleware/auth'),nodemailer=require(a0_0x33f517(0x158)),users=require(a0_0x33f517(0x1c4));router[a0_0x33f517(0x1b2)](a0_0x33f517(0x1cd),auth,async(_0x6570e7,_0x2511e0)=>{var _0x1e7429=a0_0x33f517;try{const {username:_0x2bbb3e,email:_0x36c44c,role:_0x5a161f}=_0x6570e7['user'],_0x10bb29=_0x6570e7['user'],_0x1d73aa=await profile['findOne']({'email':_0x10bb29['email']}),_0x31667e=await master_shop[_0x1e7429(0x1b8)]();let _0x5e957f;if(_0x10bb29[_0x1e7429(0x12b)]=='staff'){const _0x337426=await staff[_0x1e7429(0x18c)]({'email':_0x10bb29[_0x1e7429(0x18b)]});_0x5e957f=await sales[_0x1e7429(0x12f)]([{'$lookup':{'from':'customers','localField':_0x1e7429(0x189),'foreignField':_0x1e7429(0x14c),'as':_0x1e7429(0x1f6)}},{'$unwind':_0x1e7429(0x18e)},{'$unwind':_0x1e7429(0x160)},{'$group':{'_id':_0x1e7429(0x178),'invoice':{'$first':_0x1e7429(0x1bd)},'customers':{'$first':_0x1e7429(0x195)},'date':{'$first':_0x1e7429(0x12c)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x1e7429(0x160)},'note':{'$first':_0x1e7429(0x1c9)},'return_data':{'$first':_0x1e7429(0x1f5)},'customers_docs':{'$first':_0x1e7429(0x18e)},'total_saleproduct_quantity':{'$sum':_0x1e7429(0x1ed)},'level':{'$addToSet':_0x1e7429(0x172)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x1e7429(0x145)},'pallet':{'$addToSet':_0x1e7429(0x1c7)},'finalize':{'$first':_0x1e7429(0x13d)},'isAllowEdit':{'$first':_0x1e7429(0x129)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x5e957f=await sales['aggregate']([{'$lookup':{'from':_0x1e7429(0x21f),'localField':_0x1e7429(0x189),'foreignField':'name','as':_0x1e7429(0x1f6)}},{'$unwind':_0x1e7429(0x18e)},{'$unwind':_0x1e7429(0x160)},{'$group':{'_id':_0x1e7429(0x178),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x1e7429(0x195)},'date':{'$first':_0x1e7429(0x12c)},'warehouse_name':{'$first':_0x1e7429(0x20d)},'sale_product':{'$push':_0x1e7429(0x160)},'note':{'$first':_0x1e7429(0x1c9)},'return_data':{'$first':_0x1e7429(0x1f5)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x1e7429(0x20e)},'type':{'$addToSet':_0x1e7429(0x145)},'pallet':{'$addToSet':_0x1e7429(0x1c7)},'finalize':{'$first':_0x1e7429(0x13d)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x1e7429(0x1e4)](_0x1e7429(0x154),_0x5e957f);if(_0x31667e[0x0]['language']==_0x1e7429(0x119)){var _0x2c86cf=users[_0x1e7429(0x212)];console[_0x1e7429(0x1e4)](_0x2c86cf);}else{if(_0x31667e[0x0]['language']=='Hindi')var _0x2c86cf=users[_0x1e7429(0x1a3)];else{if(_0x31667e[0x0][_0x1e7429(0x1b9)]==_0x1e7429(0x11c))var _0x2c86cf=users[_0x1e7429(0x11c)];else{if(_0x31667e[0x0][_0x1e7429(0x1b9)]==_0x1e7429(0x1a5))var _0x2c86cf=users['Spanish'];else{if(_0x31667e[0x0][_0x1e7429(0x1b9)]==_0x1e7429(0x20f))var _0x2c86cf=users[_0x1e7429(0x20f)];else{if(_0x31667e[0x0][_0x1e7429(0x1b9)]==_0x1e7429(0x146))var _0x2c86cf=users[_0x1e7429(0x1d7)];else{if(_0x31667e[0x0]['language']==_0x1e7429(0x1b7))var _0x2c86cf=users['Chinese'];else{if(_0x31667e[0x0][_0x1e7429(0x1b9)]=='Arabic\x20(ae)')var _0x2c86cf=users['Arabic'];}}}}}}}_0x2511e0[_0x1e7429(0x1f8)](_0x1e7429(0x120),{'success':_0x6570e7[_0x1e7429(0x1e6)](_0x1e7429(0x214)),'errors':_0x6570e7[_0x1e7429(0x1e6)]('errors'),'sales':_0x5e957f,'profile':_0x1d73aa,'role':_0x10bb29,'master_shop':_0x31667e,'language':_0x2c86cf});}catch(_0x18da1e){console[_0x1e7429(0x1e4)](_0x18da1e);}});function a0_0xf855(_0x15a0d2,_0x3ebd8e){var _0x731e5f=a0_0x731e();return a0_0xf855=function(_0xf8555a,_0x1de8a2){_0xf8555a=_0xf8555a-0x117;var _0x5216c7=_0x731e5f[_0xf8555a];return _0x5216c7;},a0_0xf855(_0x15a0d2,_0x3ebd8e);}async function getRandom8DigitNumber(){var _0x10b072=a0_0x33f517;const _0x4d57c4=0x989680,_0x1ab8b5=0x5f5e0ff,_0x273b72=Math[_0x10b072(0x20b)](Math['random']()*(_0x1ab8b5-_0x4d57c4+0x1))+_0x4d57c4;var _0x528abb;const _0x23326f=await sales['findOne']({'invoice':_0x10b072(0x164)+_0x273b72});return _0x23326f&&_0x23326f['length']>0x0?_0x528abb=_0x10b072(0x164)+_0x273b72:_0x528abb=_0x10b072(0x164)+_0x273b72,_0x528abb;}function a0_0x731e(){var _0x56bac8=['$product_details.secondary_code','return_data','master','$product_details.expiry_date','Return\x20Goods','purchases_data','$finalize','sales\x20item\x20return\x20successfull','\x20</h2>','image','staff','$product_details.floorlevel','map','storage','$sale_product.type','Portuguese\x20(BR)','</thead>','slice','/barcode_scanner','stock_data','forEach','name','$product_details.storage','Ambient','220500WEFhUG','final','catch','site_title','types','sales\x20all_data','32ZpJNLu','/view/return_sales/:id','add\x20post','nodemailer','<tbody\x20style=\x22text-align:\x20center;\x22>','quantity_notConverted','$room','Raw\x20Materials','sendMail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','room_name','$sale_product','currency','$product_details.type','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','OUT-','split','$product_details.invoice','Receiving\x20Area','$product_details.unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','stock','floorlevel','448390Nmxkpk','Sale\x20Return','user_id','rack','actual_uom','gmail','$sale_product.bay','then','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','logo','$product_details.product_cat','edit_sales_view','$_id','$product.product_name','save','product_data','primary_unit','RoomAssigned','Enabled','$product','Sales\x20Mail','/view/add_sales','Sales\x20Add\x20successfully','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','createTransport','92JpZQGl','</table>','<!DOCTYPE\x20html>','barcode\x20user_id','customer','finalize','email','findOne','status','$customers_docs','</tr>','findById','errors','/all_sales/view','_id','\x20Order\x20Number\x20:\x20','$customer','$product_details.secondary_unit','$product_details.product_stock','quantity','message','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','expiry_date','push','express','$product_details.maxPerUnit','prod_invoice','Enclosed','back','Hindi','received_amount','Spanish','Email\x20sent\x20successfully','Arabic\x20(ae)','/barcode/:id','return_sale','abs','</td>','unit','<h5>','/invoice/:id','/view/:id','level','$product_details.product_name','get','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','json','customer_data','Chinese','find','language','<html><head><title></title>','type','Shelves','$invoice','</h5>','33600AAhrVE','delivery_code','password','/view/add_sale/product','user','../public/language/languages.json','Floor','../models/all_models','$sale_product.floorlevel','Sales\x20Update\x20successfully','$note','product_stock','post','RMSEmail','/view','getFullYear','bin','prod_cat','11199xApiuv','SCRN','$product_details.batch_code','/preview/:id','1665744KLJmoP','sale_product','Portuguese','Received\x20Payment\x20For\x20Sale','$product_details.bay','error','all_sales_barcode','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','all','requested_qty','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','string','</span>','sale_qty','log','padStart','flash','stocks','</div>','return_qty','253bNtGaf','</body></html>','$product_details.product_code','$sale_product.quantity','actual_qty','$product_details.bin','Level','payment\x20successfull','warehouse_name','</tbody>','<div>','$return_data','customers_docs','$product_details.primary_code','render','<span\x20style=\x22float:\x20right;\x22>','$product_details.pallet','sales_invoice','edit_sales','date','carton','secondary_code','Arabic','maxperunit','add_sales','product_details','production_date','exports','id_transact','Return\x20Rooms','/upload/','bay','<h2>\x20','floor','secondary_unit','$warehouse_name','$sale_product.bin','French','product_code','currency_placement','English','delivery_date','success','Logo.png','$product_details.rack','$product_details','warehouse','3865BcJJpB','body','prod_code','$product_details.production_date','<h5\x20style=\x22text-align:\x20left;\x22>','An\x20error\x20occurred.','customers','<tr>','length','invoice','Sale\x20Return\x20Mail','$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','English\x20(US)','filter','primary_code','German','222NqxHZp','id_transaction_from','product_name','all_sales','batch_code','/../public','max_per_unit','$product_details._id','\x20Order\x20Date\x20:\x20','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.actual_uom','$name','$isAllowEdit','Router','role','$date','host','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','redirect','max','params','foreach\x20newproduct','False','166660vOGJEp'];a0_0x731e=function(){return _0x56bac8;};return a0_0x731e();}router['get'](a0_0x33f517(0x181),auth,async(_0x5df1cf,_0x4ed2a9)=>{var _0x16cca6=a0_0x33f517;try{const {username:_0x5a0c4d,email:_0x1aacca,role:_0xbb7325}=_0x5df1cf[_0x16cca6(0x1c3)],_0x2a764a=_0x5df1cf[_0x16cca6(0x1c3)],_0x344af5=await profile['findOne']({'email':_0x2a764a[_0x16cca6(0x18b)]}),_0x46897e=await master_shop[_0x16cca6(0x1b8)](),_0x4c2c73=await customer[_0x16cca6(0x1b8)]({});let _0x2f33be;if(_0x2a764a[_0x16cca6(0x12b)]==_0x16cca6(0x141)){const _0x129601=await staff[_0x16cca6(0x18c)]({'email':_0x2a764a[_0x16cca6(0x18b)]});_0x2f33be=await warehouse[_0x16cca6(0x12f)]([{'$match':{'status':_0x16cca6(0x17e),'name':_0x129601[_0x16cca6(0x218)],'warehouse_category':_0x16cca6(0x15c),'name':{'$ne':_0x16cca6(0x13b)}}},{'$group':{'_id':_0x16cca6(0x128),'name':{'$first':_0x16cca6(0x128)}}},{'$sort':{'name':0x1}}]);}else _0x2f33be=await warehouse['aggregate']([{'$match':{'status':_0x16cca6(0x17e),'warehouse_category':_0x16cca6(0x15c),'name':{'$ne':_0x16cca6(0x13b)}}},{'$group':{'_id':_0x16cca6(0x128),'name':{'$first':_0x16cca6(0x128)}}},{'$sort':{'name':0x1}}]);const _0x22cf93=await product['find']({});var _0x4f9fd2=[_0x16cca6(0x14e),'Enclosed'];const _0xa578bf=await sales['find']({}),_0x21ad31=_0xa578bf['length']+0x1,_0x535810=_0x16cca6(0x164)+_0x21ad31[_0x16cca6(0x19a)]()[_0x16cca6(0x1e5)](0x5,'0');if(_0x46897e[0x0][_0x16cca6(0x1b9)]==_0x16cca6(0x119)){var _0xdfbdb9=users['English'];console[_0x16cca6(0x1e4)](_0xdfbdb9);}else{if(_0x46897e[0x0]['language']==_0x16cca6(0x1a3))var _0xdfbdb9=users[_0x16cca6(0x1a3)];else{if(_0x46897e[0x0][_0x16cca6(0x1b9)]==_0x16cca6(0x11c))var _0xdfbdb9=users[_0x16cca6(0x11c)];else{if(_0x46897e[0x0][_0x16cca6(0x1b9)]==_0x16cca6(0x1a5))var _0xdfbdb9=users[_0x16cca6(0x1a5)];else{if(_0x46897e[0x0][_0x16cca6(0x1b9)]==_0x16cca6(0x20f))var _0xdfbdb9=users[_0x16cca6(0x20f)];else{if(_0x46897e[0x0][_0x16cca6(0x1b9)]==_0x16cca6(0x146))var _0xdfbdb9=users[_0x16cca6(0x1d7)];else{if(_0x46897e[0x0][_0x16cca6(0x1b9)]=='Chinese')var _0xdfbdb9=users[_0x16cca6(0x1b7)];else{if(_0x46897e[0x0]['language']==_0x16cca6(0x1a7))var _0xdfbdb9=users[_0x16cca6(0x200)];}}}}}}}const _0x439506=getRandom8DigitNumber();_0x439506[_0x16cca6(0x173)](_0x662722=>{var _0x1303e2=_0x16cca6;_0x4ed2a9[_0x1303e2(0x1f8)](_0x1303e2(0x202),{'success':_0x5df1cf[_0x1303e2(0x1e6)](_0x1303e2(0x214)),'errors':_0x5df1cf[_0x1303e2(0x1e6)](_0x1303e2(0x191)),'role':_0x2a764a,'profile':_0x344af5,'customer':_0x4c2c73,'warehouse':_0x2f33be,'product':_0x22cf93,'invoice':_0x662722,'master_shop':_0x46897e,'language':_0xdfbdb9,'rooms_data':_0x4f9fd2});})['catch'](_0x283fb8=>{var _0x18f425=_0x16cca6;_0x5df1cf[_0x18f425(0x1e6)]('errors',_0x18f425(0x126)),_0x4ed2a9[_0x18f425(0x131)](_0x18f425(0x192));});}catch(_0x1aa8ce){console[_0x16cca6(0x1e4)](_0x1aa8ce);}}),router['get']('/view/add_sales/:id',auth,async(_0x574c74,_0x116186)=>{var _0x18f0fa=a0_0x33f517;try{const _0x448c65=_0x574c74[_0x18f0fa(0x133)]['id'];console[_0x18f0fa(0x1e4)](_0x448c65);const _0x450b11=await product['find'](),_0x154522=await purchases['aggregate']([{'$match':{'warehouse_name':_0x448c65}},{'$unwind':_0x18f0fa(0x17f)},{'$group':{'_id':_0x18f0fa(0x179)}}]);console[_0x18f0fa(0x1e4)](_0x18f0fa(0x13c),_0x154522),_0x116186[_0x18f0fa(0x18d)](0xc8)[_0x18f0fa(0x1b5)]({'purchases_data':_0x154522,'product_data':_0x450b11});}catch(_0x26ec5b){console[_0x18f0fa(0x1e4)](_0x26ec5b);}}),router[a0_0x33f517(0x1cb)](a0_0x33f517(0x1c2),auth,async(_0xad28f7,_0x3aacba)=>{var _0x5862e9=a0_0x33f517;try{const {warehouse_data:_0x2c338b,product_data:_0x5d410a}=_0xad28f7[_0x5862e9(0x21a)];console[_0x5862e9(0x1e4)](_0xad28f7['body'][_0x5862e9(0x17b)]);;const _0xcdfc0f=await master_shop[_0x5862e9(0x1b8)]();console[_0x5862e9(0x1e4)](_0x5862e9(0x139),_0xcdfc0f);const _0x5080cf=await product[_0x5862e9(0x18c)]({'name':_0x5d410a});console[_0x5862e9(0x1e4)]('product',_0x5080cf);const _0x38c8d0=await warehouse[_0x5862e9(0x12f)]([{'$match':{'name':_0x2c338b}},{'$unwind':_0x5862e9(0x217)},{'$match':{'product_details.product_name':_0x5d410a}},{'$group':{'_id':_0x5862e9(0x1b1),'product_stock':{'$first':_0x5862e9(0x197)}}}]);console[_0x5862e9(0x1e4)](_0x5862e9(0x14a),_0x38c8d0),_0x3aacba[_0x5862e9(0x18d)](0xc8)['json']({'master':_0xcdfc0f,'new_product':_0x5080cf,'stock_data':_0x38c8d0});}catch(_0x28e3dc){console['log'](_0x28e3dc);}}),router[a0_0x33f517(0x1cb)]('/view/add_sales',auth,async(_0x4b497a,_0x17b610)=>{var _0x21cc06=a0_0x33f517;try{const {invoice:_0x2c1f64,date:_0x2013a2,warehouse_name:_0x4b4ed3,product_name:_0x26cf48,stock:_0x285a71,quantity:_0x25471a,note:_0x176260,room:_0x3ac660,primary_code:_0xbd4123,secondary_code:_0x118be1,prod_code:_0x169c3a,level:_0x69d5a7,isle:_0x2ba59e,pallet:_0x4928f9,batch_code:_0x145ff3,SCRN:_0x2c7764,expiry_date:_0x2c07e0}=_0x4b497a[_0x21cc06(0x21a)];if(typeof _0x26cf48=='string')var _0x4d063f=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x11f)]],_0x108da1=[_0x4b497a['body'][_0x21cc06(0x16a)]],_0x46039e=[_0x4b497a['body'][_0x21cc06(0x1fe)]],_0x4d01b9=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x11b)]],_0x5c360f=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1ff)]],_0x40c478=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x21b)]],_0x43ed94=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1b0)]],_0x3795db=[_0x4b497a['body'][_0x21cc06(0x17c)]],_0x2d6387=[_0x4b497a[_0x21cc06(0x21a)]['secondary_unit']],_0x19fbce=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x121)]],_0x2b289d=[_0x4b497a['body'][_0x21cc06(0x19c)]],_0x48ceb1=[_0x4b497a[_0x21cc06(0x21a)]['max_per_unit']],_0x2e5f9a=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x204)]],_0x348b01=[_0x4b497a[_0x21cc06(0x21a)]['requested_qty']],_0x1c8cfa=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x213)]],_0x27e5a3=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1c0)]],_0x32dc64=[_0x4b497a[_0x21cc06(0x21a)]['prod_cat']],_0x6a3fe0=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x198)]],_0x20b990=[_0x4b497a[_0x21cc06(0x21a)]['RoomAssigned']],_0x127338=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1a0)]],_0x36e75a=[_0x4b497a['body'][_0x21cc06(0x1ee)]],_0x3ccdf7=[_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x170)]],_0x308f2a=[_0x4b497a[_0x21cc06(0x21a)]['id_transact']];else var _0x4d063f=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x11f)]],_0x108da1=[..._0x4b497a[_0x21cc06(0x21a)]['stock']],_0x46039e=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1fe)]],_0x4d01b9=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x11b)]],_0x5c360f=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1ff)]],_0x40c478=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x21b)]],_0x43ed94=[..._0x4b497a[_0x21cc06(0x21a)]['level']],_0x3795db=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x17c)]],_0x2d6387=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x20c)]],_0x19fbce=[..._0x4b497a['body'][_0x21cc06(0x121)]],_0x2b289d=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x19c)]],_0x48ceb1=[..._0x4b497a[_0x21cc06(0x21a)]['max_per_unit']],_0x2e5f9a=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x204)]],_0x348b01=[..._0x4b497a[_0x21cc06(0x21a)]['requested_qty']],_0x1c8cfa=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x213)]],_0x27e5a3=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1c0)]],_0x32dc64=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1d0)]],_0x6a3fe0=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x198)]],_0x20b990=[..._0x4b497a[_0x21cc06(0x21a)]['RoomAssigned']],_0x127338=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1a0)]],_0x36e75a=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x1ee)]],_0x3ccdf7=[..._0x4b497a['body']['actual_uom']],_0x308f2a=[..._0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x206)]];const _0x4ff9ec=_0x4d063f[_0x21cc06(0x143)](_0x5eb5b1=>{return _0x5eb5b1={'product_name':_0x5eb5b1};});_0x108da1[_0x21cc06(0x14b)]((_0x451221,_0x329306)=>{var _0x3d2779=_0x21cc06;_0x4ff9ec[_0x329306][_0x3d2779(0x16a)]=Math['abs'](_0x451221);}),_0x36e75a['forEach']((_0x3a3cd1,_0x40fc14)=>{var _0x553af0=_0x21cc06;_0x4ff9ec[_0x40fc14][_0x553af0(0x1ee)]=Math[_0x553af0(0x1aa)](_0x3a3cd1);}),_0x3ccdf7[_0x21cc06(0x14b)]((_0x4f0f34,_0xf1f3ce)=>{_0x4ff9ec[_0xf1f3ce]['actual_uom']=_0x4f0f34;}),_0x308f2a['forEach']((_0x17f38f,_0x399267)=>{var _0x27ff21=_0x21cc06;_0x4ff9ec[_0x399267][_0x27ff21(0x11e)]=_0x17f38f;}),_0x46039e[_0x21cc06(0x14b)]((_0x2a2fc4,_0x1f2a9e)=>{var _0x7af44=_0x21cc06;_0x4ff9ec[_0x1f2a9e][_0x7af44(0x198)]=_0x2a2fc4;}),_0x4d01b9['forEach']((_0x113366,_0x1a9797)=>{_0x4ff9ec[_0x1a9797]['primary_code']=_0x113366;}),_0x5c360f['forEach']((_0x48bc3c,_0x5a6c4f)=>{var _0x5ca892=_0x21cc06;_0x4ff9ec[_0x5a6c4f][_0x5ca892(0x1ff)]=_0x48bc3c;}),_0x40c478[_0x21cc06(0x14b)]((_0x1b6286,_0x4afea2)=>{var _0x23993c=_0x21cc06;_0x4ff9ec[_0x4afea2][_0x23993c(0x210)]=_0x1b6286;}),_0x43ed94[_0x21cc06(0x14b)]((_0x15078b,_0x39a74c)=>{var _0x1fcedc=_0x21cc06;_0x20b990[_0x1fcedc(0x14b)]((_0x156d41,_0x133c73)=>{var _0x527fc4=_0x1fcedc;if(_0x156d41=='Receiving\x20Area'&&_0x39a74c==_0x133c73){var _0x42d4d8=_0x15078b[_0x527fc4(0x148)](0x3);_0x4ff9ec[_0x39a74c][_0x527fc4(0x144)]=_0x15078b[0x0],_0x4ff9ec[_0x39a74c][_0x527fc4(0x16f)]=_0x15078b[0x1],_0x4ff9ec[_0x39a74c][_0x527fc4(0x209)]=0x0,_0x4ff9ec[_0x39a74c][_0x527fc4(0x1cf)]=0x0,_0x4ff9ec[_0x39a74c][_0x527fc4(0x1bb)]=_0x527fc4(0x1c5),_0x4ff9ec[_0x39a74c][_0x527fc4(0x16b)]=_0x42d4d8;}else{if(_0x156d41=='Shelves'&&_0x39a74c==_0x133c73){var _0x42d4d8=_0x15078b[_0x527fc4(0x148)](0x3);_0x4ff9ec[_0x39a74c][_0x527fc4(0x144)]=_0x15078b[0x0],_0x4ff9ec[_0x39a74c]['rack']=_0x15078b[0x1],_0x4ff9ec[_0x39a74c]['bay']=0x0,_0x4ff9ec[_0x39a74c][_0x527fc4(0x1cf)]=0x0,_0x4ff9ec[_0x39a74c][_0x527fc4(0x1bb)]=_0x527fc4(0x1c5),_0x4ff9ec[_0x39a74c][_0x527fc4(0x16b)]=_0x15078b[0x5];}else{if(_0x39a74c==_0x133c73){var _0x247068;if(_0x15078b[0x4]=='L')_0x247068=_0x527fc4(0x1f0);else _0x15078b[0x4]=='F'&&(_0x247068='Floor');_0x4ff9ec[_0x39a74c]['storage']=_0x15078b[0x0],_0x4ff9ec[_0x39a74c][_0x527fc4(0x16f)]=_0x15078b[0x1],_0x4ff9ec[_0x39a74c][_0x527fc4(0x209)]=_0x15078b[0x2],_0x4ff9ec[_0x39a74c]['bin']=_0x15078b[0x3],_0x4ff9ec[_0x39a74c][_0x527fc4(0x1bb)]=_0x247068,_0x4ff9ec[_0x39a74c][_0x527fc4(0x16b)]=_0x15078b[0x5];}}}});}),_0x3795db[_0x21cc06(0x14b)]((_0x58724f,_0x5a6647)=>{var _0xe3bee0=_0x21cc06;_0x4ff9ec[_0x5a6647][_0xe3bee0(0x1ac)]=_0x58724f;}),_0x2d6387[_0x21cc06(0x14b)]((_0x15d70d,_0x571578)=>{_0x4ff9ec[_0x571578]['secondary_unit']=_0x15d70d;}),_0x19fbce[_0x21cc06(0x14b)]((_0x2af084,_0x282256)=>{var _0x4316ae=_0x21cc06;_0x4ff9ec[_0x282256][_0x4316ae(0x121)]=_0x2af084;}),_0x2b289d['forEach']((_0x4f0952,_0x3f5b71)=>{var _0x25616a=_0x21cc06;_0x4ff9ec[_0x3f5b71][_0x25616a(0x19c)]=_0x4f0952;}),_0x48ceb1['forEach']((_0x556e9e,_0x2dfdcc)=>{var _0x3c6e76=_0x21cc06;_0x4ff9ec[_0x2dfdcc][_0x3c6e76(0x201)]=_0x556e9e;}),_0x2e5f9a[_0x21cc06(0x14b)]((_0x362ed7,_0x5c2238)=>{var _0x5cfa88=_0x21cc06;_0x4ff9ec[_0x5c2238][_0x5cfa88(0x204)]=_0x362ed7;}),_0x348b01[_0x21cc06(0x14b)]((_0xb411b9,_0x5b2405)=>{var _0x19fdd1=_0x21cc06;_0x4ff9ec[_0x5b2405][_0x19fdd1(0x1de)]=_0xb411b9;}),_0x1c8cfa['forEach']((_0x175fa5,_0x518fbd)=>{var _0x3eeb02=_0x21cc06;_0x4ff9ec[_0x518fbd][_0x3eeb02(0x213)]=_0x175fa5;}),_0x27e5a3[_0x21cc06(0x14b)]((_0x20721d,_0x52b033)=>{_0x4ff9ec[_0x52b033]['delivery_code']=_0x20721d;}),_0x32dc64['forEach']((_0x40e342,_0x209a6a)=>{var _0x266483=_0x21cc06;_0x4ff9ec[_0x209a6a][_0x266483(0x1d0)]=_0x40e342;}),_0x6a3fe0[_0x21cc06(0x14b)]((_0x221c20,_0x4fa943)=>{var _0x15159d=_0x21cc06;_0x4ff9ec[_0x4fa943][_0x15159d(0x15a)]=_0x221c20;}),_0x20b990[_0x21cc06(0x14b)]((_0x374647,_0x45ee32)=>{var _0x524c4e=_0x21cc06;_0x4ff9ec[_0x45ee32][_0x524c4e(0x15f)]=_0x374647;}),_0x127338[_0x21cc06(0x14b)]((_0x5854b9,_0xe84da9)=>{var _0x139b86=_0x21cc06;_0x4ff9ec[_0xe84da9][_0x139b86(0x222)]=_0x5854b9;});var _0x286986=0x0;_0x4ff9ec[_0x21cc06(0x14b)](_0x5c5e53=>{var _0x121972=_0x21cc06;(_0x5c5e53[_0x121972(0x16a)]<_0x5c5e53[_0x121972(0x15a)]||_0x5c5e53[_0x121972(0x15a)]==0x0)&&(console['log'](_0x121972(0x134),_0x5c5e53),_0x286986++);});const _0x263481=_0x4ff9ec[_0x21cc06(0x11a)](_0x1a88e1=>_0x1a88e1['quantity']!=='0'&&_0x1a88e1[_0x21cc06(0x198)]!==''),_0x5919ee=new sales({'invoice':_0x2c1f64,'customer':_0x4b497a[_0x21cc06(0x21a)][_0x21cc06(0x189)],'date':_0x2013a2,'warehouse_name':_0x4b4ed3,'sale_product':_0x263481,'note':_0x176260,'room':_0x3ac660,'primary_code':_0xbd4123,'secondary_code':_0x118be1,'prod_code':_0x169c3a,'SCRN':_0x2c7764}),_0xea8e27=await _0x5919ee[_0x21cc06(0x17a)]();_0x4b497a[_0x21cc06(0x1e6)](_0x21cc06(0x214),_0x21cc06(0x182)),_0x17b610[_0x21cc06(0x131)]('/all_sales/preview/'+_0xea8e27[_0x21cc06(0x193)]);}catch(_0xe69b4f){console[_0x21cc06(0x1e4)](_0xe69b4f);}}),router[a0_0x33f517(0x1b2)]('/preview/:id',auth,async(_0x2b2576,_0x51fe4e)=>{var _0x27227c=a0_0x33f517;try{const {username:_0x3984b4,email:_0x5a635a,role:_0x4ecdbf}=_0x2b2576[_0x27227c(0x1c3)],_0x7f3d58=_0x2b2576['user'],_0x177101=await profile[_0x27227c(0x18c)]({'email':_0x7f3d58[_0x27227c(0x18b)]}),_0x375fe4=await master_shop[_0x27227c(0x1b8)](),_0x4c4f09=_0x2b2576[_0x27227c(0x133)]['id'],_0x1e6b3a=await sales[_0x27227c(0x190)](_0x4c4f09),_0xb181ec=await warehouse[_0x27227c(0x12f)]([{'$match':{'name':_0x1e6b3a[_0x27227c(0x1f2)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x27227c(0x124),'name':{'$first':_0x27227c(0x1b1)},'product_stock':{'$first':_0x27227c(0x197)},'bay':{'$first':_0x27227c(0x1d9)},'bin':{'$first':_0x27227c(0x1ef)},'type':{'$first':_0x27227c(0x162)},'floorlevel':{'$first':_0x27227c(0x142)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x27227c(0x137)},'product_code':{'$first':_0x27227c(0x1ec)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x27227c(0x13a)},'production_date':{'$first':_0x27227c(0x21c)},'invoice':{'$first':_0x27227c(0x166)}}}]),_0x9297b=await customer[_0x27227c(0x1b8)]({});let _0x4f8727;if(_0x7f3d58[_0x27227c(0x12b)]==_0x27227c(0x141)){const _0x248524=await staff[_0x27227c(0x18c)]({'email':_0x7f3d58[_0x27227c(0x18b)]});_0x4f8727=await warehouse[_0x27227c(0x12f)]([{'$match':{'status':_0x27227c(0x17e),'name':_0x248524[_0x27227c(0x218)]}},{'$group':{'_id':'$name','name':{'$first':_0x27227c(0x128)}}}]);}else _0x4f8727=await warehouse[_0x27227c(0x12f)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x49cd7d=await product[_0x27227c(0x1b8)]({}),_0x358838=await suppliers[_0x27227c(0x1b8)]({});if(_0x375fe4[0x0]['language']==_0x27227c(0x119)){var _0x29fb4f=users[_0x27227c(0x212)];console['log'](_0x29fb4f);}else{if(_0x375fe4[0x0][_0x27227c(0x1b9)]==_0x27227c(0x1a3))var _0x29fb4f=users[_0x27227c(0x1a3)];else{if(_0x375fe4[0x0][_0x27227c(0x1b9)]==_0x27227c(0x11c))var _0x29fb4f=users[_0x27227c(0x11c)];else{if(_0x375fe4[0x0]['language']==_0x27227c(0x1a5))var _0x29fb4f=users[_0x27227c(0x1a5)];else{if(_0x375fe4[0x0]['language']==_0x27227c(0x20f))var _0x29fb4f=users[_0x27227c(0x20f)];else{if(_0x375fe4[0x0][_0x27227c(0x1b9)]==_0x27227c(0x146))var _0x29fb4f=users[_0x27227c(0x1d7)];else{if(_0x375fe4[0x0][_0x27227c(0x1b9)]==_0x27227c(0x1b7))var _0x29fb4f=users['Chinese'];else{if(_0x375fe4[0x0][_0x27227c(0x1b9)]==_0x27227c(0x1a7))var _0x29fb4f=users[_0x27227c(0x200)];}}}}}}}_0x51fe4e[_0x27227c(0x1f8)](_0x27227c(0x177),{'success':_0x2b2576[_0x27227c(0x1e6)]('success'),'errors':_0x2b2576[_0x27227c(0x1e6)](_0x27227c(0x191)),'role':_0x7f3d58,'profile':_0x177101,'customer':_0x9297b,'warehouse':_0x4f8727,'product':_0xb181ec,'user':_0x1e6b3a,'master_shop':_0x375fe4,'unit':_0x49cd7d,'language':_0x29fb4f,'suppliers':_0x358838});}catch(_0x41b4a7){console['log'](_0x41b4a7);}}),router[a0_0x33f517(0x1cb)](a0_0x33f517(0x1d4),auth,async(_0x276bad,_0x5c2eaf)=>{var _0x3202a0=a0_0x33f517;try{const _0x42aa2f=_0x276bad['params']['id'],{invoice:_0x579f54,warehouse_name:_0x19b393,room:_0x211fa4}=_0x276bad['body'],_0x1e5248=await sales[_0x3202a0(0x18c)]({'invoice':_0x579f54}),_0x1e5fcb=_0x1e5248['sale_product'][_0x3202a0(0x143)](async _0x538119=>{var _0x3bc6cf=_0x3202a0,_0x2091bb=await warehouse['findOne']({'name':_0x19b393,'room':_0x538119[_0x3bc6cf(0x15f)],'warehouse_category':'Raw\x20Materials'});const _0x5e4801=_0x2091bb[_0x3bc6cf(0x203)][_0x3bc6cf(0x143)](_0x3189ae=>{var _0x585f80=_0x3bc6cf;_0x3189ae[_0x585f80(0x11f)]==_0x538119[_0x585f80(0x11f)]&&_0x3189ae[_0x585f80(0x16b)]==_0x538119[_0x585f80(0x16b)]&&_0x3189ae['type']==_0x538119[_0x585f80(0x1bb)]&&_0x3189ae['bin']==_0x538119[_0x585f80(0x1cf)]&&_0x3189ae[_0x585f80(0x209)]==_0x538119[_0x585f80(0x209)]&&_0x3189ae[_0x585f80(0x16f)]==_0x538119['rack']&&_0x3189ae[_0x585f80(0x144)]==_0x538119[_0x585f80(0x144)]&&_0x3189ae['expiry_date']==_0x538119[_0x585f80(0x19c)]&&_0x3189ae['batch_code']==_0x538119['batch_code']&&_0x3189ae[_0x585f80(0x222)]==_0x538119[_0x585f80(0x222)]&&_0x3189ae[_0x585f80(0x193)]==_0x538119[_0x585f80(0x11e)]&&(_0x3189ae[_0x585f80(0x1ca)]=Math[_0x585f80(0x132)](0x0,Math[_0x585f80(0x1aa)](_0x3189ae[_0x585f80(0x1ca)])-Math[_0x585f80(0x1aa)](_0x538119[_0x585f80(0x198)])));});return _0x2091bb;});Promise[_0x3202a0(0x1dd)](_0x1e5fcb)[_0x3202a0(0x173)](async _0x54785b=>{var _0x3e8ed8=_0x3202a0;try{for(const _0x169f16 of _0x54785b){await _0x169f16[_0x3e8ed8(0x17a)]();}_0x1e5248[_0x3e8ed8(0x18a)]='True';const _0x1397fc=await _0x1e5248[_0x3e8ed8(0x17a)](),_0x460dcd=await master_shop[_0x3e8ed8(0x1b8)](),_0x1cce80=await email_settings[_0x3e8ed8(0x18c)](),_0x3e6f92=await supervisor_settings[_0x3e8ed8(0x1b8)]();var _0x412a59=_0x1e5248[_0x3e8ed8(0x1d6)],_0x413b47='',_0xe9e935;for(_0xe9e935 in _0x412a59){_0x413b47+=_0x3e8ed8(0x220)+_0x3e8ed8(0x174)+_0x412a59[_0xe9e935]['product_name']+_0x3e8ed8(0x1ab)+_0x3e8ed8(0x174)+_0x412a59[_0xe9e935][_0x3e8ed8(0x210)]+_0x3e8ed8(0x1ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x412a59[_0xe9e935][_0x3e8ed8(0x198)]+_0x3e8ed8(0x1ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x412a59[_0xe9e935][_0x3e8ed8(0x1ac)]+'</td>'+_0x3e8ed8(0x174)+_0x412a59[_0xe9e935][_0x3e8ed8(0x20c)]+'</td>'+_0x3e8ed8(0x174)+_0x1e5248[_0x3e8ed8(0x1f2)]+_0x3e8ed8(0x1ab)+_0x3e8ed8(0x174)+_0x412a59[_0xe9e935]['room_name']+_0x3e8ed8(0x1ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x412a59[_0xe9e935]['storage']+_0x412a59[_0xe9e935][_0x3e8ed8(0x16f)]+_0x412a59[_0xe9e935]['bay']+_0x412a59[_0xe9e935]['bin']+_0x412a59[_0xe9e935][_0x3e8ed8(0x1bb)][0x0]+_0x412a59[_0xe9e935]['floorlevel']+'</td>',_0x3e8ed8(0x18f);}let _0x2aa6ab=nodemailer[_0x3e8ed8(0x184)]({'host':_0x1cce80[_0x3e8ed8(0x12d)],'port':Number(_0x1cce80['port']),'secure':![],'auth':{'user':_0x1cce80[_0x3e8ed8(0x18b)],'pass':_0x1cce80[_0x3e8ed8(0x1c1)]}}),_0x2708fb={'from':_0x1cce80[_0x3e8ed8(0x18b)],'to':_0x3e6f92[0x0][_0x3e8ed8(0x1cc)],'subject':_0x3e8ed8(0x180),'attachments':[{'filename':_0x3e8ed8(0x215),'path':__dirname+'/../public'+_0x3e8ed8(0x208)+_0x460dcd[0x0][_0x3e8ed8(0x140)],'cid':_0x3e8ed8(0x175)}],'html':_0x3e8ed8(0x187)+_0x3e8ed8(0x1ba)+'</head><body>'+_0x3e8ed8(0x1f4)+_0x3e8ed8(0x163)+_0x3e8ed8(0x1f4)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x3e8ed8(0x1f4)+_0x3e8ed8(0x20a)+_0x460dcd[0x0][_0x3e8ed8(0x152)]+'\x20</h2>'+_0x3e8ed8(0x1e8)+_0x3e8ed8(0x1e8)+'<hr\x20class=\x22my-3\x22>'+_0x3e8ed8(0x1f4)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3e8ed8(0x194)+_0x1e5248[_0x3e8ed8(0x222)]+'\x20'+_0x3e8ed8(0x1f9)+_0x3e8ed8(0x125)+_0x1e5248['date']+'\x20'+_0x3e8ed8(0x1e2)+_0x3e8ed8(0x1be)+_0x3e8ed8(0x1e8)+_0x3e8ed8(0x15e)+_0x3e8ed8(0x12e)+_0x3e8ed8(0x220)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x3e8ed8(0x169)+_0x3e8ed8(0x1e0)+_0x3e8ed8(0x19b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x3e8ed8(0x130)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3e8ed8(0x18f)+'</thead>'+_0x3e8ed8(0x159)+'\x20'+_0x413b47+'\x20'+'</tbody>'+_0x3e8ed8(0x186)+_0x3e8ed8(0x1f4)+'<strong>\x20Regards\x20</strong>'+_0x3e8ed8(0x1ad)+_0x460dcd[0x0][_0x3e8ed8(0x152)]+_0x3e8ed8(0x1be)+'</div>'+_0x3e8ed8(0x1e8)+_0x3e8ed8(0x1eb)};_0x2aa6ab[_0x3e8ed8(0x15d)](_0x2708fb,function(_0x3fe01a,_0x54409c){var _0x4610ab=_0x3e8ed8;_0x3fe01a?(console[_0x4610ab(0x1e4)](_0x3fe01a),console['log']('Error\x20Occurs')):console[_0x4610ab(0x1e4)](_0x4610ab(0x1a6));}),_0x276bad[_0x3e8ed8(0x1e6)](_0x3e8ed8(0x214),_0x3e8ed8(0x1c8)),_0x5c2eaf[_0x3e8ed8(0x131)]('/all_sales/preview/'+_0x42aa2f);}catch(_0x4546c2){console['error'](_0x4546c2),_0x5c2eaf[_0x3e8ed8(0x18d)](0x1f4)[_0x3e8ed8(0x1b5)]({'error':_0x3e8ed8(0x1df)});}})[_0x3202a0(0x151)](_0x1513e1=>{var _0x9fd325=_0x3202a0;console[_0x9fd325(0x1da)](_0x1513e1),_0x5c2eaf['status'](0x1f4)[_0x9fd325(0x1b5)]({'error':_0x9fd325(0x21e)});});}catch(_0x4a1750){console[_0x3202a0(0x1e4)](_0x4a1750);}}),router[a0_0x33f517(0x1b2)](a0_0x33f517(0x1af),auth,async(_0x1bd848,_0x2f199a)=>{var _0x596351=a0_0x33f517;try{const {username:_0x489b8d,email:_0x311988,role:_0x1a7ffc}=_0x1bd848[_0x596351(0x1c3)],_0x38f6a6=_0x1bd848['user'],_0x54b988=await profile[_0x596351(0x18c)]({'email':_0x38f6a6[_0x596351(0x18b)]}),_0x3bd333=await master_shop['find'](),_0x1a7623=_0x1bd848[_0x596351(0x133)]['id'],_0x4f3c6c=await sales[_0x596351(0x190)](_0x1a7623);var _0x49a365=[_0x596351(0x14e),_0x596351(0x1a1)];const _0x19ae31=await warehouse[_0x596351(0x12f)]([{'$match':{'name':_0x4f3c6c[_0x596351(0x1f2)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x596351(0x217)},{'$group':{'_id':_0x596351(0x124),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x596351(0x197)},'bay':{'$first':_0x596351(0x1d9)},'bin':{'$first':_0x596351(0x1ef)},'type':{'$first':_0x596351(0x162)},'floorlevel':{'$first':_0x596351(0x142)},'primary_code':{'$first':_0x596351(0x1f7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x596351(0x14d)},'rack':{'$first':_0x596351(0x216)}}}]),_0x1250a1=await customer[_0x596351(0x1b8)]({});let _0x581cea;if(_0x38f6a6[_0x596351(0x12b)]==_0x596351(0x141)){const _0x61646d=await staff[_0x596351(0x18c)]({'email':_0x38f6a6['email']});_0x581cea=await warehouse[_0x596351(0x12f)]([{'$match':{'status':_0x596351(0x17e),'name':_0x61646d[_0x596351(0x218)],'warehouse_category':_0x596351(0x15c)}},{'$group':{'_id':_0x596351(0x128),'name':{'$first':'$name'}}}]);}else _0x581cea=await warehouse[_0x596351(0x12f)]([{'$match':{'status':_0x596351(0x17e),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x596351(0x128),'name':{'$first':_0x596351(0x128)}}}]);const _0x81d2f3=await product[_0x596351(0x1b8)]({});if(_0x3bd333[0x0][_0x596351(0x1b9)]==_0x596351(0x119)){var _0x382098=users[_0x596351(0x212)];console[_0x596351(0x1e4)](_0x382098);}else{if(_0x3bd333[0x0][_0x596351(0x1b9)]=='Hindi')var _0x382098=users[_0x596351(0x1a3)];else{if(_0x3bd333[0x0]['language']==_0x596351(0x11c))var _0x382098=users['German'];else{if(_0x3bd333[0x0][_0x596351(0x1b9)]==_0x596351(0x1a5))var _0x382098=users['Spanish'];else{if(_0x3bd333[0x0]['language']==_0x596351(0x20f))var _0x382098=users[_0x596351(0x20f)];else{if(_0x3bd333[0x0]['language']==_0x596351(0x146))var _0x382098=users[_0x596351(0x1d7)];else{if(_0x3bd333[0x0][_0x596351(0x1b9)]=='Chinese')var _0x382098=users[_0x596351(0x1b7)];else{if(_0x3bd333[0x0][_0x596351(0x1b9)]==_0x596351(0x1a7))var _0x382098=users['Arabic'];}}}}}}}_0x2f199a['render'](_0x596351(0x1fc),{'success':_0x1bd848[_0x596351(0x1e6)](_0x596351(0x214)),'errors':_0x1bd848['flash']('errors'),'role':_0x38f6a6,'profile':_0x54b988,'customer':_0x1250a1,'warehouse':_0x581cea,'product':_0x19ae31,'user':_0x4f3c6c,'master_shop':_0x3bd333,'unit':_0x81d2f3,'language':_0x382098});}catch(_0x115db8){console['log'](_0x115db8);}}),router[a0_0x33f517(0x1cb)]('/view/:id',auth,async(_0x376294,_0xee296a)=>{var _0x346f6e=a0_0x33f517;try{const _0x5ce800=_0x376294[_0x346f6e(0x133)]['id'],_0x55f944=await sales[_0x346f6e(0x18c)]({'_id':_0x376294[_0x346f6e(0x133)]['id']}),_0x4c1f4a=await warehouse['findOne']({'name':_0x55f944['warehouse_name'],'room':_0x376294['body']['room']}),{invoice:_0x2c8d2f,date:_0x5ba24d,warehouse_name:_0x42f654,product_name:_0x25f3c7,stock:_0xe6c15e,quantity:_0x3fb939,note:_0x25d848,room:_0x578d35,customer:_0x20111e,SCRN:_0x206913}=_0x376294[_0x346f6e(0x21a)];if(typeof _0x25f3c7==_0x346f6e(0x1e1))var _0xf5ca0a=[_0x376294['body'][_0x346f6e(0x11f)]],_0xc86958=[_0x376294[_0x346f6e(0x21a)]['stock']],_0x23d5b9=[_0x376294['body'][_0x346f6e(0x1fe)]],_0x4088f7=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x11b)]],_0x546922=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1ff)]],_0x52c382=[_0x376294[_0x346f6e(0x21a)]['prod_code']],_0x2937d6=[_0x376294['body'][_0x346f6e(0x1b0)]],_0x295029=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x17c)]],_0x26c0e5=[_0x376294['body']['secondary_unit']],_0x39b0a4=[_0x376294['body'][_0x346f6e(0x121)]],_0x58dce2=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x19c)]],_0x199566=[_0x376294[_0x346f6e(0x21a)]['max_per_unit']],_0x457444=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x204)]],_0x11dab2=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1de)]],_0x9f38e0=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x213)]],_0xda81f8=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1c0)]],_0x7d28be=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1d0)]],_0xc0bac9=[_0x376294[_0x346f6e(0x21a)]['quantity']],_0x4c58a2=[_0x376294[_0x346f6e(0x21a)][_0x346f6e(0x17d)]];else var _0xf5ca0a=[..._0x376294['body'][_0x346f6e(0x11f)]],_0xc86958=[..._0x376294['body']['stock']],_0x23d5b9=[..._0x376294['body'][_0x346f6e(0x1fe)]],_0x4088f7=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x11b)]],_0x546922=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1ff)]],_0x52c382=[..._0x376294['body'][_0x346f6e(0x21b)]],_0x2937d6=[..._0x376294['body']['level']],_0x295029=[..._0x376294['body'][_0x346f6e(0x17c)]],_0x26c0e5=[..._0x376294[_0x346f6e(0x21a)]['secondary_unit']],_0x39b0a4=[..._0x376294[_0x346f6e(0x21a)]['batch_code']],_0x58dce2=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x19c)]],_0x199566=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x123)]],_0x457444=[..._0x376294[_0x346f6e(0x21a)]['production_date']],_0x11dab2=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1de)]],_0x9f38e0=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x213)]],_0xda81f8=[..._0x376294['body']['delivery_code']],_0x7d28be=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x1d0)]],_0xc0bac9=[..._0x376294[_0x346f6e(0x21a)][_0x346f6e(0x198)]],_0x4c58a2=[..._0x376294[_0x346f6e(0x21a)]['RoomAssigned']];const _0x24d84c=_0xf5ca0a[_0x346f6e(0x143)](_0x3ae32b=>{return _0x3ae32b={'product_name':_0x3ae32b};});_0xc86958['forEach']((_0x254ec4,_0x5c8be5)=>{var _0x2a61df=_0x346f6e;_0x24d84c[_0x5c8be5][_0x2a61df(0x16a)]=Math[_0x2a61df(0x1aa)](_0x254ec4);}),_0x23d5b9['forEach']((_0xcee350,_0x188367)=>{var _0x379b4b=_0x346f6e;_0x24d84c[_0x188367][_0x379b4b(0x198)]=_0xcee350;}),_0x4088f7['forEach']((_0x18c2ef,_0x34d2d4)=>{_0x24d84c[_0x34d2d4]['primary_code']=_0x18c2ef;}),_0x546922['forEach']((_0x557397,_0x351769)=>{var _0x6d8fc2=_0x346f6e;_0x24d84c[_0x351769][_0x6d8fc2(0x1ff)]=_0x557397;}),_0x52c382[_0x346f6e(0x14b)]((_0x58a9b3,_0x46eee5)=>{var _0x79ae84=_0x346f6e;_0x24d84c[_0x46eee5][_0x79ae84(0x210)]=_0x58a9b3;}),_0x2937d6[_0x346f6e(0x14b)]((_0x2973b1,_0x38330a)=>{var _0x18222a=_0x346f6e;_0x4c58a2[_0x18222a(0x14b)]((_0x342be5,_0x22f346)=>{var _0x18ef9a=_0x18222a;if(_0x342be5==_0x18ef9a(0x167)&&_0x38330a==_0x22f346){var _0x302aa4=_0x2973b1[_0x18ef9a(0x148)](0x3);_0x24d84c[_0x38330a][_0x18ef9a(0x144)]=_0x2973b1[0x0],_0x24d84c[_0x38330a][_0x18ef9a(0x16f)]=_0x2973b1[0x1],_0x24d84c[_0x38330a]['bay']=0x0,_0x24d84c[_0x38330a]['bin']=0x0,_0x24d84c[_0x38330a][_0x18ef9a(0x1bb)]='Floor',_0x24d84c[_0x38330a]['floorlevel']=_0x302aa4;}else{if(_0x342be5==_0x18ef9a(0x1bc)&&_0x38330a==_0x22f346){var _0x302aa4=_0x2973b1[_0x18ef9a(0x148)](0x3);_0x24d84c[_0x38330a][_0x18ef9a(0x144)]=_0x2973b1[0x0],_0x24d84c[_0x38330a]['rack']=_0x2973b1[0x1],_0x24d84c[_0x38330a][_0x18ef9a(0x209)]=0x0,_0x24d84c[_0x38330a][_0x18ef9a(0x1cf)]=0x0,_0x24d84c[_0x38330a]['type']='Floor',_0x24d84c[_0x38330a][_0x18ef9a(0x16b)]=_0x2973b1[0x5];}else{if(_0x38330a==_0x22f346){var _0x54c6fe;if(_0x2973b1[0x4]=='L')_0x54c6fe=_0x18ef9a(0x1f0);else _0x2973b1[0x4]=='F'&&(_0x54c6fe='Floor');_0x24d84c[_0x38330a][_0x18ef9a(0x144)]=_0x2973b1[0x0],_0x24d84c[_0x38330a][_0x18ef9a(0x16f)]=_0x2973b1[0x1],_0x24d84c[_0x38330a][_0x18ef9a(0x209)]=_0x2973b1[0x2],_0x24d84c[_0x38330a][_0x18ef9a(0x1cf)]=_0x2973b1[0x3],_0x24d84c[_0x38330a]['type']=_0x54c6fe,_0x24d84c[_0x38330a]['floorlevel']=_0x2973b1[0x5];}}}});}),_0x295029[_0x346f6e(0x14b)]((_0x4856eb,_0x4d9c07)=>{var _0x54d286=_0x346f6e;_0x24d84c[_0x4d9c07][_0x54d286(0x1ac)]=_0x4856eb;}),_0x26c0e5[_0x346f6e(0x14b)]((_0x421feb,_0x49c588)=>{_0x24d84c[_0x49c588]['secondary_unit']=_0x421feb;}),_0x39b0a4['forEach']((_0x353487,_0x404fe3)=>{var _0x31a1f6=_0x346f6e;_0x24d84c[_0x404fe3][_0x31a1f6(0x121)]=_0x353487;}),_0x58dce2[_0x346f6e(0x14b)]((_0x4ea6de,_0xcc97d1)=>{var _0x1acfd6=_0x346f6e;_0x24d84c[_0xcc97d1][_0x1acfd6(0x19c)]=_0x4ea6de;}),_0x199566[_0x346f6e(0x14b)]((_0x23e5b5,_0x32960f)=>{_0x24d84c[_0x32960f]['maxperunit']=_0x23e5b5;}),_0x457444[_0x346f6e(0x14b)]((_0x53b47b,_0x3b33b6)=>{var _0x286a69=_0x346f6e;_0x24d84c[_0x3b33b6][_0x286a69(0x204)]=_0x53b47b;}),_0x11dab2['forEach']((_0x3a6edb,_0xc0ef9b)=>{var _0x281fd3=_0x346f6e;_0x24d84c[_0xc0ef9b][_0x281fd3(0x1de)]=Math[_0x281fd3(0x1aa)](_0x3a6edb);}),_0x9f38e0[_0x346f6e(0x14b)]((_0x2e6a50,_0xd42fd)=>{var _0x583894=_0x346f6e;_0x24d84c[_0xd42fd][_0x583894(0x213)]=_0x2e6a50;}),_0xda81f8[_0x346f6e(0x14b)]((_0x3c537b,_0x36d2fc)=>{var _0x6fbcb5=_0x346f6e;_0x24d84c[_0x36d2fc][_0x6fbcb5(0x1c0)]=_0x3c537b;}),_0x7d28be[_0x346f6e(0x14b)]((_0x3f78a2,_0x30ed4e)=>{_0x24d84c[_0x30ed4e]['prod_cat']=_0x3f78a2;}),_0xc0bac9[_0x346f6e(0x14b)]((_0x573d65,_0x5d4ae5)=>{_0x24d84c[_0x5d4ae5]['quantity_notConverted']=_0x573d65;}),_0x4c58a2['forEach']((_0x100c74,_0x409a30)=>{_0x24d84c[_0x409a30]['room_name']=_0x100c74;});var _0x3fe2db=0x0;_0x24d84c['forEach'](_0x5b6924=>{var _0x44502b=_0x346f6e;console[_0x44502b(0x1e4)]('foreach\x20newproduct',_0x5b6924),(parseInt(_0x5b6924[_0x44502b(0x16a)])<parseInt(_0x5b6924[_0x44502b(0x198)])||parseInt(_0x5b6924[_0x44502b(0x198)])==0x0)&&_0x3fe2db++;});if(_0x3fe2db!=0x0)return _0x376294[_0x346f6e(0x1e6)]('errors',_0x346f6e(0x1dc)),_0xee296a['redirect'](_0x346f6e(0x1a2));const _0x4bdbfd=_0x24d84c[_0x346f6e(0x11a)](_0x130256=>_0x130256[_0x346f6e(0x198)]!=='0'&&_0x130256[_0x346f6e(0x198)]!=='');_0x55f944[_0x346f6e(0x222)]=_0x2c8d2f,_0x55f944[_0x346f6e(0x189)]=_0x20111e,_0x55f944[_0x346f6e(0x1fd)]=_0x5ba24d,_0x55f944[_0x346f6e(0x1f2)]=_0x42f654,_0x55f944[_0x346f6e(0x1d6)]=_0x4bdbfd,_0x55f944['note']=_0x25d848,_0x55f944[_0x346f6e(0x1d2)]=_0x206913,_0x55f944[_0x346f6e(0x18a)]=_0x346f6e(0x135),_0x55f944['isAllowEdit']=_0x346f6e(0x135);const _0x352d73=await _0x55f944[_0x346f6e(0x17a)]();_0x376294[_0x346f6e(0x1e6)]('success',_0x346f6e(0x1c8)),_0xee296a[_0x346f6e(0x131)](_0x346f6e(0x192));}catch(_0x3cc359){console[_0x346f6e(0x1e4)](_0x3cc359);}}),router[a0_0x33f517(0x1cb)]('/give_payment/:id',auth,async(_0x404277,_0x3b335f)=>{var _0x46aea1=a0_0x33f517;try{const _0x40da43=_0x404277['params']['id'],{invoice:_0x155efc,customer:_0x201501,receivable_amount:_0x575434,received_amount:_0x1bac67}=_0x404277[_0x46aea1(0x21a)],_0x3c958b=await sales[_0x46aea1(0x190)](_0x40da43);console[_0x46aea1(0x1e4)](_0x3c958b);var _0x4b76f1=_0x575434-_0x1bac67;console['log'](_0x1bac67),_0x3c958b['received_amount']=parseFloat(_0x1bac67)+parseFloat(_0x3c958b[_0x46aea1(0x1a4)]),_0x3c958b['due_amount']=_0x4b76f1,console[_0x46aea1(0x1e4)](_0x3c958b);const _0x2f9274=await _0x3c958b[_0x46aea1(0x17a)](),_0x297e5b=await c_payment_data[_0x46aea1(0x18c)]({'invoice':_0x155efc});_0x297e5b['amount']=_0x4b76f1,await _0x297e5b[_0x46aea1(0x17a)]();let _0xa8b091=new Date(),_0x25a457=('0'+_0xa8b091['getDate']())[_0x46aea1(0x148)](-0x2),_0x391fc6=('0'+(_0xa8b091['getMonth']()+0x1))[_0x46aea1(0x148)](-0x2),_0x10babf=_0xa8b091[_0x46aea1(0x1ce)](),_0x2dbda3=_0x10babf+'-'+_0x391fc6+'-'+_0x25a457;const _0x12af19=new customer_payment({'invoice':_0x155efc,'date':_0x10babf+'-'+_0x391fc6+'-'+_0x25a457,'customer':_0x201501,'reason':_0x46aea1(0x1d8),'amount':_0x1bac67}),_0x3f3352=await _0x12af19['save']();_0x404277[_0x46aea1(0x1e6)](_0x46aea1(0x214),_0x46aea1(0x1f1)),_0x3b335f[_0x46aea1(0x131)]('/all_sales/view');}catch(_0x58ec7f){console[_0x46aea1(0x1e4)](_0x58ec7f);}}),router[a0_0x33f517(0x1b2)](a0_0x33f517(0x1ae),auth,async(_0x4e5d56,_0xc17143)=>{var _0x11a9ff=a0_0x33f517;try{const {username:_0xb3880,email:_0x2fb1e2,role:_0x58a43a}=_0x4e5d56[_0x11a9ff(0x1c3)],_0x3cf50e=_0x4e5d56[_0x11a9ff(0x1c3)],_0x32e2cc=await profile[_0x11a9ff(0x18c)]({'email':_0x3cf50e[_0x11a9ff(0x18b)]}),_0x567a05=await master_shop[_0x11a9ff(0x1b8)]();console[_0x11a9ff(0x1e4)](_0x11a9ff(0x139),_0x567a05);const _0x44820c=_0x4e5d56[_0x11a9ff(0x133)]['id'],_0x1fdf8f=await sales[_0x11a9ff(0x190)](_0x44820c);console[_0x11a9ff(0x1e4)](_0x1fdf8f);const _0x106252=await customer['findOne']({'name':_0x1fdf8f['customer']});console[_0x11a9ff(0x1e4)](_0x106252);if(_0x567a05[0x0][_0x11a9ff(0x1b9)]=='English\x20(US)'){var _0xef35c8=users[_0x11a9ff(0x212)];console[_0x11a9ff(0x1e4)](_0xef35c8);}else{if(_0x567a05[0x0][_0x11a9ff(0x1b9)]=='Hindi')var _0xef35c8=users[_0x11a9ff(0x1a3)];else{if(_0x567a05[0x0][_0x11a9ff(0x1b9)]=='German')var _0xef35c8=users[_0x11a9ff(0x11c)];else{if(_0x567a05[0x0]['language']==_0x11a9ff(0x1a5))var _0xef35c8=users[_0x11a9ff(0x1a5)];else{if(_0x567a05[0x0][_0x11a9ff(0x1b9)]==_0x11a9ff(0x20f))var _0xef35c8=users[_0x11a9ff(0x20f)];else{if(_0x567a05[0x0][_0x11a9ff(0x1b9)]==_0x11a9ff(0x146))var _0xef35c8=users[_0x11a9ff(0x1d7)];else{if(_0x567a05[0x0][_0x11a9ff(0x1b9)]==_0x11a9ff(0x1b7))var _0xef35c8=users['Chinese'];else{if(_0x567a05[0x0][_0x11a9ff(0x1b9)]=='Arabic\x20(ae)')var _0xef35c8=users[_0x11a9ff(0x200)];}}}}}}}_0xc17143[_0x11a9ff(0x1f8)](_0x11a9ff(0x1fb),{'success':_0x4e5d56[_0x11a9ff(0x1e6)](_0x11a9ff(0x214)),'errors':_0x4e5d56['flash']('errors'),'role':_0x3cf50e,'profile':_0x32e2cc,'master_shop':_0x567a05,'customers':_0x106252,'sales':_0x1fdf8f,'language':_0xef35c8});}catch(_0x6b9c3c){console[_0x11a9ff(0x1e4)](_0x6b9c3c);}}),router[a0_0x33f517(0x1b2)](a0_0x33f517(0x156),auth,async(_0xc9b919,_0x1114e6)=>{var _0x1d9349=a0_0x33f517;try{const {username:_0x333439,email:_0x52e8d2,role:_0x399e1e}=_0xc9b919[_0x1d9349(0x1c3)],_0x4fe497=_0xc9b919[_0x1d9349(0x1c3)],_0x2ffce3=await profile['findOne']({'email':_0x4fe497[_0x1d9349(0x18b)]}),_0x555da2=await master_shop[_0x1d9349(0x1b8)]();console[_0x1d9349(0x1e4)](_0x1d9349(0x139),_0x555da2);const _0x2e6ba3=_0xc9b919[_0x1d9349(0x133)]['id'];console[_0x1d9349(0x1e4)](_0x2e6ba3);const _0x4f5198=await sales[_0x1d9349(0x190)](_0x2e6ba3);console['log'](_0x1d9349(0x16e),_0x4f5198);const _0x5c7608=await warehouse[_0x1d9349(0x12f)]([{'$match':{'name':_0x1d9349(0x13b),'room':_0x1d9349(0x207)}},{'$unwind':_0x1d9349(0x217)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1d9349(0x1b1)},'product_stock':{'$first':_0x1d9349(0x197)},'level':{'$first':_0x1d9349(0x117)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x1d9349(0x1fa)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1d9349(0x137)},'product_code':{'$first':_0x1d9349(0x1ec)}}}]);console[_0x1d9349(0x1e4)](_0x1d9349(0x14a),_0x5c7608);const _0x7f58a7=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x1d9349(0x17e),'name':'Return\x20Goods','warehouse_category':_0x1d9349(0x15c)}},{'$group':{'_id':_0x1d9349(0x128),'name':{'$first':_0x1d9349(0x128)}}},{'$sort':{'name':0x1}}]);var _0x5d5db0=[_0x1d9349(0x207)];if(_0x555da2[0x0][_0x1d9349(0x1b9)]==_0x1d9349(0x119)){var _0x358cfb=users[_0x1d9349(0x212)];console[_0x1d9349(0x1e4)](_0x358cfb);}else{if(_0x555da2[0x0][_0x1d9349(0x1b9)]=='Hindi')var _0x358cfb=users[_0x1d9349(0x1a3)];else{if(_0x555da2[0x0]['language']==_0x1d9349(0x11c))var _0x358cfb=users['German'];else{if(_0x555da2[0x0][_0x1d9349(0x1b9)]==_0x1d9349(0x1a5))var _0x358cfb=users[_0x1d9349(0x1a5)];else{if(_0x555da2[0x0]['language']==_0x1d9349(0x20f))var _0x358cfb=users['French'];else{if(_0x555da2[0x0][_0x1d9349(0x1b9)]==_0x1d9349(0x146))var _0x358cfb=users[_0x1d9349(0x1d7)];else{if(_0x555da2[0x0]['language']==_0x1d9349(0x1b7))var _0x358cfb=users['Chinese'];else{if(_0x555da2[0x0][_0x1d9349(0x1b9)]==_0x1d9349(0x1a7))var _0x358cfb=users[_0x1d9349(0x200)];}}}}}}}_0x1114e6[_0x1d9349(0x1f8)]('return_sale',{'success':_0xc9b919['flash'](_0x1d9349(0x214)),'errors':_0xc9b919['flash'](_0x1d9349(0x191)),'role':_0x4fe497,'profile':_0x2ffce3,'user':_0x4f5198,'stock':_0x5c7608,'master_shop':_0x555da2,'unit':_0x7f58a7,'language':_0x358cfb,'warehouses':warehouse_data,'rooms':_0x5d5db0});}catch(_0x4046ce){console[_0x1d9349(0x1e4)](_0x4046ce),_0x1114e6['status'](0xc8)['json']({'message':_0x4046ce[_0x1d9349(0x199)]});}}),router[a0_0x33f517(0x1cb)](a0_0x33f517(0x156),auth,async(_0x38e6f9,_0x5768ad)=>{var _0x22693a=a0_0x33f517;try{const {invoice:_0x468e6a,date:_0x1645ca,warehouse_name:_0x2f26f7,product_name:_0x5c1fa7,primary_code:_0x1af45a,secondary_code:_0x27b706,product_code:_0xcb39c,sales_quantity:_0x39dbb0,stocks:_0x3cedf4,return_qty:_0x375479,Room_name:_0x4b3ac0,to_warehouse_name:_0x29f46a,to_Roomname:_0x21fe07,to_Room_name:_0x3331dc,note:_0x288f01,level:_0x13d552,isle:_0x373f7c,pallet:_0xf25b6c}=_0x38e6f9[_0x22693a(0x21a)];if(typeof _0x5c1fa7==_0x22693a(0x1e1))var _0x531ebd=[_0x38e6f9['body'][_0x22693a(0x11f)]],_0x210a1d=[_0x38e6f9[_0x22693a(0x21a)]['primary_code']],_0x41b808=[_0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x1ff)]],_0x43d6fd=[_0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x210)]],_0x58197c=[_0x38e6f9[_0x22693a(0x21a)]['sales_quantity']],_0x7d46d9=[_0x38e6f9['body'][_0x22693a(0x1e7)]],_0x31dac2=[_0x38e6f9[_0x22693a(0x21a)]['return_qty']],_0x4c9211=[_0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x209)]],_0xacae73=[_0x38e6f9['body']['bin']],_0x2acf0e=[_0x38e6f9['body']['types']],_0x3486b2=[_0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x16b)]];else var _0x531ebd=[..._0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x11f)]],_0x210a1d=[..._0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x11b)]],_0x41b808=[..._0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x1ff)]],_0x43d6fd=[..._0x38e6f9['body'][_0x22693a(0x210)]],_0x58197c=[..._0x38e6f9[_0x22693a(0x21a)]['sales_quantity']],_0x7d46d9=[..._0x38e6f9['body'][_0x22693a(0x1e7)]],_0x31dac2=[..._0x38e6f9['body'][_0x22693a(0x1e9)]],_0x4c9211=[..._0x38e6f9['body'][_0x22693a(0x209)]],_0xacae73=[..._0x38e6f9[_0x22693a(0x21a)]['bin']],_0x2acf0e=[..._0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x153)]],_0x3486b2=[..._0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x16b)]];const _0x221b0=_0x531ebd[_0x22693a(0x143)](_0x23ec20=>{return _0x23ec20={'product_name':_0x23ec20};});_0x210a1d[_0x22693a(0x14b)]((_0xa2a453,_0x384ca4)=>{_0x221b0[_0x384ca4]['primary_code']=_0xa2a453;}),_0x41b808[_0x22693a(0x14b)]((_0x2d0ed7,_0x36eced)=>{var _0x29dc55=_0x22693a;_0x221b0[_0x36eced][_0x29dc55(0x1ff)]=_0x2d0ed7;}),_0x43d6fd[_0x22693a(0x14b)]((_0x4e80f7,_0x4ab3f0)=>{var _0x5301c5=_0x22693a;_0x221b0[_0x4ab3f0][_0x5301c5(0x210)]=_0x4e80f7;}),_0x58197c['forEach']((_0x2132df,_0x26b536)=>{var _0x13e252=_0x22693a;_0x221b0[_0x26b536][_0x13e252(0x1e3)]=_0x2132df;}),_0x7d46d9[_0x22693a(0x14b)]((_0xd9b253,_0x545492)=>{var _0x119193=_0x22693a;_0x221b0[_0x545492][_0x119193(0x16a)]=_0xd9b253;}),_0x31dac2[_0x22693a(0x14b)]((_0x16bb05,_0x371c3a)=>{_0x221b0[_0x371c3a]['return_qty']=_0x16bb05;}),_0x4c9211['forEach']((_0x55350d,_0x410536)=>{var _0x3dd6da=_0x22693a;_0x221b0[_0x410536][_0x3dd6da(0x209)]=_0x55350d;}),_0xacae73[_0x22693a(0x14b)]((_0x5972f1,_0x49bf03)=>{var _0x27967f=_0x22693a;_0x221b0[_0x49bf03][_0x27967f(0x1cf)]=_0x5972f1;}),_0x2acf0e['forEach']((_0x420a3b,_0x2d3db8)=>{var _0x453e70=_0x22693a;_0x221b0[_0x2d3db8][_0x453e70(0x1bb)]=_0x420a3b;}),_0x3486b2[_0x22693a(0x14b)]((_0x58196d,_0x56abfd)=>{var _0x179fc9=_0x22693a;_0x221b0[_0x56abfd][_0x179fc9(0x16b)]=_0x58196d;});var _0x52e235=0x0;_0x221b0[_0x22693a(0x14b)](_0x1e889b=>{var _0x360cc5=_0x22693a;console['log']('foreach\x20newproduct',_0x1e889b),(parseInt(_0x1e889b[_0x360cc5(0x1e3)])<parseInt(_0x1e889b['return_qty'])||parseInt(_0x1e889b[_0x360cc5(0x16a)])<parseInt(_0x1e889b[_0x360cc5(0x1e9)])&&parseInt(_0x1e889b[_0x360cc5(0x1e3)])>parseInt(_0x1e889b[_0x360cc5(0x1e9)])||parseInt(_0x1e889b['return_qty'])==0x0)&&_0x52e235++;});if(_0x52e235!=0x0)return _0x38e6f9[_0x22693a(0x1e6)](_0x22693a(0x191),_0x22693a(0x1b3)),_0x5768ad[_0x22693a(0x131)](_0x22693a(0x1a2));const _0x3dd0b7=await sales[_0x22693a(0x18c)]({'invoice':_0x468e6a});console[_0x22693a(0x1e4)](_0x3dd0b7),_0x3dd0b7[_0x22693a(0x138)]='True';const _0x501f9f=await _0x3dd0b7[_0x22693a(0x17a)](),_0xdccf6b=new sales_return({'invoice':_0x468e6a,'customer':_0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x189)],'date':_0x1645ca,'warehouse_name':_0x2f26f7,'room':_0x4b3ac0,'ToWarehouse':_0x29f46a,'ToRoom':_0x3331dc,'return_sale':_0x221b0,'note':_0x288f01}),_0x1281ac=await _0xdccf6b[_0x22693a(0x17a)]();console[_0x22693a(0x1e4)](_0xdccf6b);const _0x19a65f=await sales_return[_0x22693a(0x18c)]({'invoice':_0x468e6a}),_0x372774=await warehouse[_0x22693a(0x18c)]({'name':_0x29f46a,'room':_0x3331dc});_0x19a65f[_0x22693a(0x1a9)][_0x22693a(0x14b)](_0x2a7d73=>{var _0x3c8582=_0x22693a,_0x30459a=0x0;const _0x533686=_0x372774[_0x3c8582(0x203)]['map'](_0x719ce4=>{var _0x4c184d=_0x3c8582;_0x719ce4[_0x4c184d(0x11f)]==_0x2a7d73['product_name']&&_0x719ce4[_0x4c184d(0x16b)]==_0x2a7d73[_0x4c184d(0x16b)]&&_0x719ce4[_0x4c184d(0x1bb)]==_0x2a7d73[_0x4c184d(0x1bb)]&&_0x719ce4[_0x4c184d(0x1cf)]==_0x2a7d73['bin']&&_0x719ce4[_0x4c184d(0x209)]==_0x2a7d73[_0x4c184d(0x209)]&&(_0x719ce4[_0x4c184d(0x1ca)]=parseInt(_0x719ce4[_0x4c184d(0x1ca)])+parseInt(_0x2a7d73['return_qty']),_0x30459a++);});_0x30459a=='0'&&(_0x372774[_0x3c8582(0x203)]=_0x372774[_0x3c8582(0x203)]['concat']({'product_name':_0x2a7d73[_0x3c8582(0x11f)],'product_stock':_0x2a7d73[_0x3c8582(0x1e9)],'primary_code':_0x2a7d73[_0x3c8582(0x11b)],'secondary_code':_0x2a7d73[_0x3c8582(0x1ff)],'product_code':_0x2a7d73['product_code'],'bay':_0x2a7d73['bay'],'bin':_0x2a7d73[_0x3c8582(0x1cf)],'type':_0x2a7d73['type'],'floorlevel':_0x2a7d73[_0x3c8582(0x16b)]})),console[_0x3c8582(0x1e4)](_0x3c8582(0x150),_0x372774);}),await _0x372774[_0x22693a(0x17a)](),console['log'](_0x38e6f9[_0x22693a(0x21a)]);const _0x1a26a1=new c_payment_data({'invoice':_0x468e6a,'customer':_0x38e6f9['body'][_0x22693a(0x189)],'reason':_0x22693a(0x16d)});await _0x1a26a1[_0x22693a(0x17a)]();const _0x2e8ecd=await master_shop[_0x22693a(0x1b8)]();console[_0x22693a(0x1e4)](_0x22693a(0x157),_0x2e8ecd[0x0]['image']);const _0xfd3d2c=await email_settings[_0x22693a(0x18c)](),_0x400f6e=await customer[_0x22693a(0x18c)]({'name':_0x38e6f9[_0x22693a(0x21a)][_0x22693a(0x189)]});console[_0x22693a(0x1e4)](_0x22693a(0x1b6),_0x400f6e);_0x2e8ecd[0x0][_0x22693a(0x211)]==0x1?(right_currency=_0x2e8ecd[0x0][_0x22693a(0x161)],left_currency=''):(right_currency='',left_currency=_0x2e8ecd[0x0]['currency']);var _0x4d4abb=_0x531ebd,_0x424e61=_0x31dac2,_0xb5aaef='',_0xad2ef4;for(_0xad2ef4 in _0x4d4abb){_0xb5aaef+=_0x22693a(0x220)+_0x22693a(0x174)+_0x4d4abb[_0xad2ef4]+_0x22693a(0x1ab)+_0x22693a(0x174)+_0x424e61[_0xad2ef4]+_0x22693a(0x1ab)+_0x22693a(0x18f);}console[_0x22693a(0x1e4)]('product_list',_0xb5aaef);let _0x364ac2=nodemailer['createTransport']({'service':_0x22693a(0x171),'auth':{'user':_0xfd3d2c[_0x22693a(0x18b)],'pass':_0xfd3d2c[_0x22693a(0x1c1)]}}),_0x283e68={'from':_0xfd3d2c[_0x22693a(0x18b)],'to':_0x400f6e['email'],'subject':_0x22693a(0x223),'attachments':[{'filename':'Logo.png','path':__dirname+_0x22693a(0x122)+'/upload/'+_0x2e8ecd[0x0]['image'],'cid':'logo'}],'html':_0x22693a(0x187)+_0x22693a(0x1ba)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x22693a(0x1f4)+_0x22693a(0x183)+_0x22693a(0x1e8)+'<div>'+_0x22693a(0x20a)+_0x2e8ecd[0x0][_0x22693a(0x152)]+_0x22693a(0x13f)+'</div>'+_0x22693a(0x1e8)+'<hr\x20class=\x22my-3\x22>'+_0x22693a(0x1f4)+_0x22693a(0x21d)+'\x20Order\x20Number\x20:\x20'+_0x468e6a+'\x20'+_0x22693a(0x1f9)+_0x22693a(0x125)+_0x1645ca+'\x20'+_0x22693a(0x1e2)+_0x22693a(0x1be)+'</div>'+_0x22693a(0x15e)+_0x22693a(0x12e)+_0x22693a(0x220)+_0x22693a(0x118)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x22693a(0x1b4)+_0x22693a(0x18f)+_0x22693a(0x147)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xb5aaef+'\x20'+_0x22693a(0x1f3)+'</table>'+_0x22693a(0x1f4)+'<strong>\x20Regards\x20</strong>'+_0x22693a(0x1ad)+_0x2e8ecd[0x0][_0x22693a(0x152)]+_0x22693a(0x1be)+_0x22693a(0x1e8)+_0x22693a(0x1e8)+_0x22693a(0x1eb)};_0x364ac2[_0x22693a(0x15d)](_0x283e68,function(_0x5c3534,_0x48d19a){var _0x318885=_0x22693a;_0x5c3534?(console['log'](_0x5c3534),console[_0x318885(0x1e4)]('Error\x20Occurs')):console[_0x318885(0x1e4)](_0x318885(0x1a6));}),_0x38e6f9[_0x22693a(0x1e6)](_0x22693a(0x214),_0x22693a(0x13e)),_0x5768ad[_0x22693a(0x131)](_0x22693a(0x192));}catch(_0x12db78){console[_0x22693a(0x1e4)](_0x12db78),_0x5768ad[_0x22693a(0x18d)](0xc8)[_0x22693a(0x1b5)]({'message1':_0x12db78[_0x22693a(0x199)]});}}),router['get'](a0_0x33f517(0x1a8),auth,async(_0xe4c510,_0x5a9172)=>{var _0x53dcaf=a0_0x33f517;try{const {username:_0x38d4c3,email:_0x2b1d96,role:_0x3115e7}=_0xe4c510['user'],_0x1faf41=_0xe4c510[_0x53dcaf(0x1c3)],_0x180f6a=await profile[_0x53dcaf(0x18c)]({'email':_0x1faf41[_0x53dcaf(0x18b)]}),_0x512557=await master_shop['find']();console[_0x53dcaf(0x1e4)]('barcode\x20Product\x20master',_0x512557);const _0x328490=_0xe4c510[_0x53dcaf(0x133)]['id'],_0x52660f=await sales[_0x53dcaf(0x190)](_0x328490);console[_0x53dcaf(0x1e4)](_0x53dcaf(0x188),_0x52660f);if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x119))var _0x1ea0f7=users['English'];else{if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x1a3))var _0x1ea0f7=users[_0x53dcaf(0x1a3)];else{if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x11c))var _0x1ea0f7=users[_0x53dcaf(0x11c)];else{if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x1a5))var _0x1ea0f7=users[_0x53dcaf(0x1a5)];else{if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x20f))var _0x1ea0f7=users['French'];else{if(_0x512557[0x0]['language']==_0x53dcaf(0x146))var _0x1ea0f7=users[_0x53dcaf(0x1d7)];else{if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x1b7))var _0x1ea0f7=users[_0x53dcaf(0x1b7)];else{if(_0x512557[0x0][_0x53dcaf(0x1b9)]==_0x53dcaf(0x1a7))var _0x1ea0f7=users[_0x53dcaf(0x200)];}}}}}}}_0x5a9172[_0x53dcaf(0x1f8)](_0x53dcaf(0x1db),{'success':_0xe4c510[_0x53dcaf(0x1e6)](_0x53dcaf(0x214)),'errors':_0xe4c510[_0x53dcaf(0x1e6)](_0x53dcaf(0x191)),'role':_0x1faf41,'profile':_0x180f6a,'alldata':_0x52660f,'master_shop':_0x512557,'language':_0x1ea0f7});}catch(_0x553191){console[_0x53dcaf(0x1e4)](_0x553191);}}),router['post'](a0_0x33f517(0x149),async(_0x35f31b,_0x3a48ec)=>{var _0x4563aa=a0_0x33f517;const {product_code:_0x3c4b69,warehouse_name:_0x1faa99,rooms_data:_0x1c9d37,Roomslist:_0x381910}=_0x35f31b[_0x4563aa(0x21a)],_0x598672=_0x381910[_0x4563aa(0x165)](','),_0x4db7cb=[];async function _0x201d71(_0xd297cf){var _0xbca46a=_0x4563aa;const _0x4e826e=await warehouse[_0xbca46a(0x12f)]([{'$match':{'name':_0x1faa99,'room':_0xd297cf}},{'$unwind':_0xbca46a(0x217)},{'$match':{'product_details.primary_code':_0x3c4b69}},{'$group':{'_id':_0xbca46a(0x124),'name':{'$first':_0xbca46a(0x1b1)},'product_stock':{'$first':_0xbca46a(0x197)},'primary_code':{'$first':_0xbca46a(0x1f7)},'secondary_code':{'$first':_0xbca46a(0x137)},'product_code':{'$first':_0xbca46a(0x1ec)},'level':{'$first':_0xbca46a(0x1d9)},'isle':{'$first':_0xbca46a(0x1ef)},'type':{'$first':_0xbca46a(0x162)},'pallet':{'$first':_0xbca46a(0x142)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0xbca46a(0x14d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xbca46a(0x13a)},'production_date':{'$first':_0xbca46a(0x21c)},'maxPerUnit':{'$first':_0xbca46a(0x19f)},'batch_code':{'$first':_0xbca46a(0x1d3)},'product_cat':{'$first':_0xbca46a(0x176)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0xbca46a(0x15b)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0xbca46a(0x127)}}}]),_0x42b15a=await warehouse[_0xbca46a(0x12f)]([{'$match':{'name':_0x1faa99,'room':_0xd297cf}},{'$unwind':_0xbca46a(0x217)},{'$match':{'product_details.secondary_code':_0x3c4b69}},{'$group':{'_id':_0xbca46a(0x124),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0xbca46a(0x1f7)},'secondary_code':{'$first':_0xbca46a(0x137)},'product_code':{'$first':_0xbca46a(0x1ec)},'level':{'$first':_0xbca46a(0x1d9)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xbca46a(0x142)},'unit':{'$first':_0xbca46a(0x168)},'secondary_unit':{'$first':_0xbca46a(0x196)},'storage':{'$first':_0xbca46a(0x14d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xbca46a(0x13a)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0xbca46a(0x19f)},'batch_code':{'$first':_0xbca46a(0x1d3)},'product_cat':{'$first':_0xbca46a(0x176)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0xbca46a(0x15b)},'invoice':{'$first':_0xbca46a(0x166)}}}]);if(_0x4e826e['length']>0x0)_0x4db7cb['push'](_0x4e826e);else _0x42b15a[_0xbca46a(0x221)]>0x0&&_0x4db7cb[_0xbca46a(0x19d)](_0x42b15a);}const _0x369b6b=_0x598672[_0x4563aa(0x143)](_0x4730ef=>_0x201d71(_0x4730ef));await Promise[_0x4563aa(0x1dd)](_0x369b6b),_0x3a48ec[_0x4563aa(0x1b5)](_0x4db7cb);}),module[a0_0x33f517(0x205)]=router;