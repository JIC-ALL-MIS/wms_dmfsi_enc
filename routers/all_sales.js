var a0_0x1628f6=a0_0x48e6;(function(_0x4de91c,_0x220acf){var _0x518303=a0_0x48e6,_0x58023f=_0x4de91c();while(!![]){try{var _0x41920e=parseInt(_0x518303(0x2b1))/0x1+-parseInt(_0x518303(0x238))/0x2+-parseInt(_0x518303(0x20a))/0x3*(-parseInt(_0x518303(0x21e))/0x4)+-parseInt(_0x518303(0x294))/0x5*(-parseInt(_0x518303(0x2b2))/0x6)+parseInt(_0x518303(0x2ca))/0x7+-parseInt(_0x518303(0x230))/0x8+parseInt(_0x518303(0x2b0))/0x9*(-parseInt(_0x518303(0x1f4))/0xa);if(_0x41920e===_0x220acf)break;else _0x58023f['push'](_0x58023f['shift']());}catch(_0x218898){_0x58023f['push'](_0x58023f['shift']());}}}(a0_0x3b31,0x433d4));const express=require(a0_0x1628f6(0x233)),app=express(),router=express[a0_0x1628f6(0x23e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1628f6(0x24c)),auth=require('../middleware/auth'),nodemailer=require(a0_0x1628f6(0x2d2)),users=require('../public/language/languages.json');router[a0_0x1628f6(0x28b)](a0_0x1628f6(0x29c),auth,async(_0x292292,_0x47e72d)=>{var _0x3f4db3=a0_0x1628f6;try{const {username:_0xebf484,email:_0x4fc64e,role:_0x4e020b}=_0x292292[_0x3f4db3(0x264)],_0x25a1ca=_0x292292['user'],_0x96f5c6=await profile['findOne']({'email':_0x25a1ca['email']}),_0x43f00e=await master_shop[_0x3f4db3(0x20c)]();let _0x27fb1d;if(_0x25a1ca[_0x3f4db3(0x2ee)]==_0x3f4db3(0x254)){const _0x2c621c=await staff[_0x3f4db3(0x22c)]({'email':_0x25a1ca[_0x3f4db3(0x2f1)]});_0x27fb1d=await sales['aggregate']([{'$lookup':{'from':'customers','localField':_0x3f4db3(0x200),'foreignField':_0x3f4db3(0x2ab),'as':_0x3f4db3(0x275)}},{'$unwind':'$customers_docs'},{'$unwind':_0x3f4db3(0x26e)},{'$group':{'_id':_0x3f4db3(0x2e4),'invoice':{'$first':_0x3f4db3(0x232)},'customers':{'$first':_0x3f4db3(0x21d)},'date':{'$first':_0x3f4db3(0x2d3)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x3f4db3(0x26e)},'note':{'$first':_0x3f4db3(0x2ba)},'return_data':{'$first':_0x3f4db3(0x1e8)},'customers_docs':{'$first':_0x3f4db3(0x1fe)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3f4db3(0x29d)},'isle':{'$addToSet':_0x3f4db3(0x2d0)},'type':{'$addToSet':_0x3f4db3(0x2b3)},'pallet':{'$addToSet':_0x3f4db3(0x1ea)},'finalize':{'$first':_0x3f4db3(0x2b7)},'isAllowEdit':{'$first':_0x3f4db3(0x2d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x27fb1d=await sales[_0x3f4db3(0x215)]([{'$lookup':{'from':_0x3f4db3(0x261),'localField':_0x3f4db3(0x200),'foreignField':_0x3f4db3(0x2ab),'as':_0x3f4db3(0x275)}},{'$unwind':_0x3f4db3(0x1fe)},{'$unwind':_0x3f4db3(0x26e)},{'$group':{'_id':_0x3f4db3(0x2e4),'invoice':{'$first':_0x3f4db3(0x232)},'customers':{'$first':_0x3f4db3(0x21d)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3f4db3(0x287)},'sale_product':{'$push':_0x3f4db3(0x26e)},'note':{'$first':_0x3f4db3(0x2ba)},'return_data':{'$first':_0x3f4db3(0x1e8)},'customers_docs':{'$first':_0x3f4db3(0x1fe)},'total_saleproduct_quantity':{'$sum':_0x3f4db3(0x25e)},'level':{'$addToSet':_0x3f4db3(0x29d)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x3f4db3(0x2b3)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3f4db3(0x2b7)},'isAllowEdit':{'$first':_0x3f4db3(0x2d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3f4db3(0x284)](_0x3f4db3(0x20b),_0x27fb1d);if(_0x43f00e[0x0][_0x3f4db3(0x23f)]==_0x3f4db3(0x224)){var _0x3c0588=users['English'];console['log'](_0x3c0588);}else{if(_0x43f00e[0x0]['language']==_0x3f4db3(0x2a0))var _0x3c0588=users[_0x3f4db3(0x2a0)];else{if(_0x43f00e[0x0][_0x3f4db3(0x23f)]=='German')var _0x3c0588=users['German'];else{if(_0x43f00e[0x0][_0x3f4db3(0x23f)]=='Spanish')var _0x3c0588=users[_0x3f4db3(0x285)];else{if(_0x43f00e[0x0][_0x3f4db3(0x23f)]=='French')var _0x3c0588=users['French'];else{if(_0x43f00e[0x0]['language']==_0x3f4db3(0x27a))var _0x3c0588=users[_0x3f4db3(0x24f)];else{if(_0x43f00e[0x0][_0x3f4db3(0x23f)]==_0x3f4db3(0x1e6))var _0x3c0588=users[_0x3f4db3(0x1e6)];else{if(_0x43f00e[0x0][_0x3f4db3(0x23f)]=='Arabic\x20(ae)')var _0x3c0588=users[_0x3f4db3(0x237)];}}}}}}}_0x47e72d[_0x3f4db3(0x278)](_0x3f4db3(0x225),{'success':_0x292292[_0x3f4db3(0x248)](_0x3f4db3(0x25f)),'errors':_0x292292[_0x3f4db3(0x248)](_0x3f4db3(0x2c9)),'sales':_0x27fb1d,'profile':_0x96f5c6,'role':_0x25a1ca,'master_shop':_0x43f00e,'language':_0x3c0588});}catch(_0x374a73){console[_0x3f4db3(0x284)](_0x374a73);}});function a0_0x48e6(_0xde21ae,_0x137652){var _0x3b31b4=a0_0x3b31();return a0_0x48e6=function(_0x48e60f,_0x2c21ef){_0x48e60f=_0x48e60f-0x1e1;var _0xb8b444=_0x3b31b4[_0x48e60f];return _0xb8b444;},a0_0x48e6(_0xde21ae,_0x137652);}function a0_0x3b31(){var _0x55c760=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$warehouse_name','map','Sale\x20Return\x20Mail','toString','get','</head><body>','<h5>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_list','prod_cat','level','filter','edit_sales','70EielkW','all','/all_sales/view','\x20</h2>','$product_details.invoice','Enclosed','product_stock','slice','/view','$sale_product.bay','</td>','$product_details.isle','Hindi','storage','$product_details.secondary_code','prod_invoice','customer_data','SCRN','concat','$name','sale_qty','/all_sales/preview/','split','name','length','back','secondary_unit','Receiving\x20Area','2718nTQzBE','375775MvOunr','93162tgueYE','$sale_product.type','Logo.png','$product_details.primary_code','add\x20post','$finalize','Floor','bin','$note','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','return_qty','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/upload/','<div>','getFullYear','carton','$product_details','$product_details.type','type','/preview/:id','add_sales','final','errors','1290422jOrcIT','json','site_title','$product_details.bay','finalize','findById','$sale_product.bin','unit','nodemailer','$date','</table>','$product_details.level','error','$isAllowEdit','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','room','Received\x20Payment\x20For\x20Sale','delivery_date','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','host','image','note','body','string','$_id','received_amount','</body></html>','False','actual_qty','<tbody\x20style=\x22text-align:\x20center;\x22>','product_name','catch','Level','An\x20error\x20occurred.','role','max_per_unit','amount','email','product_data','Shelves','$product_details.unit','requested_qty','room_name','Chinese','logo','$return_data','Sales\x20Add\x20successfully','$sale_product.floorlevel','OUT-','</span>','floorlevel','currency_placement','Sales\x20Mail','$product_details.bin','French','Ambient','message','10720pbdgpC','due_amount','$product_details.maxPerUnit','Sales\x20Update\x20successfully','floor','types','$product_details.pallet','stock_data','$product_details.rack','product','$customers_docs','prod_code','customer','isAllowEdit','/barcode/:id','/view/return_sales/:id','</tr>','Return\x20Goods','/invoice/:id','date','batch_code','post','3jrtGGQ','sales\x20all_data','find','payment\x20successfull','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','padStart','rack','password','save','warehouse','</thead>','aggregate','foreach\x20newproduct','/view/add_sale/product','stock','gmail','barcode\x20Product\x20master','primary_code','Sale\x20Return','$customer','295404bLVfyw','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','random','</tbody>','True','sale_product','English\x20(US)','all_sales','$product_details.floorlevel','Email\x20sent\x20successfully','primary_unit','forEach','quantity_notConverted','<h5\x20style=\x22text-align:\x20left;\x22>','findOne','Error\x20Occurs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/view/add_sales','1680480PCSWHA','$product_details.production_date','$invoice','express','$product_details.actual_qty','createTransport','$product_details.expiry_date','Arabic','84268YYwvzG','$product_details.batch_code','product_code','<span\x20style=\x22float:\x20right;\x22>','return_sale','$product_details.product_stock','Router','language','<!DOCTYPE\x20html>','$product_details.secondary_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_details','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','expiry_date','<strong>\x20Regards\x20</strong>','flash','getDate','English','<hr\x20class=\x22my-3\x22>','../models/all_models','production_date','</div>','Portuguese','RMSEmail','/view/:id','quantity','</h5>','staff','German','params','<h2>\x20','$product_details.product_name','bay','getMonth','stocks','$product_details.product_code','push','$sale_product.quantity','success','maxperunit','customers','sales\x20item\x20return\x20successfull','/../public','user','$product_details.storage','$product','invoice','master','RoomAssigned','Return\x20Rooms','secondary_code','\x20Order\x20Number\x20:\x20','redirect','$sale_product','status','warehouse_name','currency','user_id','sendMail','return_data','customers_docs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','\x20Order\x20Date\x20:\x20','render','/give_payment/:id','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<tr>','/barcode_scanner','delivery_code','sales_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.product_cat','$product_details._id','log','Spanish'];a0_0x3b31=function(){return _0x55c760;};return a0_0x3b31();}async function getRandom8DigitNumber(){var _0x89f40f=a0_0x1628f6;const _0x4cf998=0x989680,_0x4be91b=0x5f5e0ff,_0x218295=Math[_0x89f40f(0x1f8)](Math[_0x89f40f(0x220)]()*(_0x4be91b-_0x4cf998+0x1))+_0x4cf998;var _0x173a69;const _0x15c3ec=await sales[_0x89f40f(0x22c)]({'invoice':'OUT-'+_0x218295});return _0x15c3ec&&_0x15c3ec[_0x89f40f(0x2ac)]>0x0?_0x173a69=_0x89f40f(0x1eb)+_0x218295:_0x173a69=_0x89f40f(0x1eb)+_0x218295,_0x173a69;}router[a0_0x1628f6(0x28b)](a0_0x1628f6(0x22f),auth,async(_0x112428,_0x239d38)=>{var _0x9f9bda=a0_0x1628f6;try{const {username:_0x77d0df,email:_0x3e2af5,role:_0x36ea31}=_0x112428[_0x9f9bda(0x264)],_0x59c2c6=_0x112428[_0x9f9bda(0x264)],_0x1a4955=await profile['findOne']({'email':_0x59c2c6[_0x9f9bda(0x2f1)]}),_0x5862bf=await master_shop[_0x9f9bda(0x20c)](),_0xd95c62=await customer['find']({});let _0x4a35e5;if(_0x59c2c6['role']==_0x9f9bda(0x254)){const _0xdd4074=await staff[_0x9f9bda(0x22c)]({'email':_0x59c2c6[_0x9f9bda(0x2f1)]});_0x4a35e5=await warehouse[_0x9f9bda(0x215)]([{'$match':{'status':_0x9f9bda(0x244),'name':_0xdd4074[_0x9f9bda(0x213)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x9f9bda(0x205)}}},{'$group':{'_id':_0x9f9bda(0x2a7),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x4a35e5=await warehouse[_0x9f9bda(0x215)]([{'$match':{'status':_0x9f9bda(0x244),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x9f9bda(0x2a7),'name':{'$first':_0x9f9bda(0x2a7)}}},{'$sort':{'name':0x1}}]);const _0x1b84ce=await product[_0x9f9bda(0x20c)]({});var _0x584fea=[_0x9f9bda(0x1f2),_0x9f9bda(0x299)];const _0x4b8749=await sales[_0x9f9bda(0x20c)]({}),_0x5d62a7=_0x4b8749['length']+0x1,_0x59eb45=_0x9f9bda(0x1eb)+_0x5d62a7[_0x9f9bda(0x28a)]()[_0x9f9bda(0x20f)](0x5,'0');if(_0x5862bf[0x0]['language']=='English\x20(US)'){var _0xfe653d=users['English'];console['log'](_0xfe653d);}else{if(_0x5862bf[0x0][_0x9f9bda(0x23f)]==_0x9f9bda(0x2a0))var _0xfe653d=users[_0x9f9bda(0x2a0)];else{if(_0x5862bf[0x0][_0x9f9bda(0x23f)]==_0x9f9bda(0x255))var _0xfe653d=users[_0x9f9bda(0x255)];else{if(_0x5862bf[0x0]['language']=='Spanish')var _0xfe653d=users[_0x9f9bda(0x285)];else{if(_0x5862bf[0x0]['language']=='French')var _0xfe653d=users[_0x9f9bda(0x1f1)];else{if(_0x5862bf[0x0][_0x9f9bda(0x23f)]=='Portuguese\x20(BR)')var _0xfe653d=users['Portuguese'];else{if(_0x5862bf[0x0][_0x9f9bda(0x23f)]==_0x9f9bda(0x1e6))var _0xfe653d=users[_0x9f9bda(0x1e6)];else{if(_0x5862bf[0x0][_0x9f9bda(0x23f)]==_0x9f9bda(0x2bd))var _0xfe653d=users[_0x9f9bda(0x237)];}}}}}}}const _0x5ae537=getRandom8DigitNumber();_0x5ae537['then'](_0x44f71e=>{var _0x3c7f5c=_0x9f9bda;_0x239d38['render'](_0x3c7f5c(0x2c7),{'success':_0x112428['flash'](_0x3c7f5c(0x25f)),'errors':_0x112428['flash']('errors'),'role':_0x59c2c6,'profile':_0x1a4955,'customer':_0xd95c62,'warehouse':_0x4a35e5,'product':_0x1b84ce,'invoice':_0x44f71e,'master_shop':_0x5862bf,'language':_0xfe653d,'rooms_data':_0x584fea});})[_0x9f9bda(0x2eb)](_0x2d6922=>{var _0x3fdff4=_0x9f9bda;_0x112428[_0x3fdff4(0x248)](_0x3fdff4(0x2c9),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x239d38[_0x3fdff4(0x26d)](_0x3fdff4(0x296));});}catch(_0x2485a4){console[_0x9f9bda(0x284)](_0x2485a4);}}),router[a0_0x1628f6(0x28b)]('/view/add_sales/:id',auth,async(_0x54ddf8,_0x5727d4)=>{var _0x24d936=a0_0x1628f6;try{const _0x4fdb67=_0x54ddf8[_0x24d936(0x256)]['id'];console[_0x24d936(0x284)](_0x4fdb67);const _0x1fefd0=await product[_0x24d936(0x20c)](),_0x2c176f=await purchases[_0x24d936(0x215)]([{'$match':{'warehouse_name':_0x4fdb67}},{'$unwind':_0x24d936(0x266)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x2c176f),_0x5727d4[_0x24d936(0x26f)](0xc8)[_0x24d936(0x2cb)]({'purchases_data':_0x2c176f,'product_data':_0x1fefd0});}catch(_0x23ab62){console[_0x24d936(0x284)](_0x23ab62);}}),router[a0_0x1628f6(0x209)](a0_0x1628f6(0x217),auth,async(_0x3a7022,_0x472987)=>{var _0x75e3df=a0_0x1628f6;try{const {warehouse_data:_0x971a8d,product_data:_0x3afe5b}=_0x3a7022[_0x75e3df(0x2e2)];console[_0x75e3df(0x284)](_0x3a7022[_0x75e3df(0x2e2)][_0x75e3df(0x1e1)]);;const _0x498d0b=await master_shop[_0x75e3df(0x20c)]();console['log'](_0x75e3df(0x268),_0x498d0b);const _0x330b3b=await product[_0x75e3df(0x22c)]({'name':_0x3afe5b});console['log'](_0x75e3df(0x1fd),_0x330b3b);const _0x30cb7d=await warehouse[_0x75e3df(0x215)]([{'$match':{'name':_0x971a8d}},{'$unwind':_0x75e3df(0x2c3)},{'$match':{'product_details.product_name':_0x3afe5b}},{'$group':{'_id':_0x75e3df(0x258),'product_stock':{'$first':_0x75e3df(0x23d)}}}]);console['log'](_0x75e3df(0x1fb),_0x30cb7d),_0x472987[_0x75e3df(0x26f)](0xc8)[_0x75e3df(0x2cb)]({'master':_0x498d0b,'new_product':_0x330b3b,'stock_data':_0x30cb7d});}catch(_0xb5cbaf){console['log'](_0xb5cbaf);}}),router[a0_0x1628f6(0x209)](a0_0x1628f6(0x22f),auth,async(_0x2c2ddd,_0x460cb5)=>{var _0x2fa68f=a0_0x1628f6;try{const {invoice:_0x247d84,date:_0x1b6bb3,warehouse_name:_0x218f6e,product_name:_0x2abaca,stock:_0x368ffb,quantity:_0x434cba,note:_0x4be403,room:_0x4d3196,primary_code:_0x121a22,secondary_code:_0x3a58b8,prod_code:_0x425ad4,level:_0x1aec8c,isle:_0x45e2ac,pallet:_0x3f2878,batch_code:_0x5a1e72,SCRN:_0x14b8ed,expiry_date:_0x2b7eac}=_0x2c2ddd[_0x2fa68f(0x2e2)];if(typeof _0x2abaca=='string')var _0x31c6af=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x2ea)]],_0x4b65a0=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x218)]],_0xa29283=[_0x2c2ddd['body']['carton']],_0x3997c6=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x21b)]],_0x374cb1=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x26b)]],_0x1356c9=[_0x2c2ddd[_0x2fa68f(0x2e2)]['prod_code']],_0x16cb31=[_0x2c2ddd[_0x2fa68f(0x2e2)]['level']],_0x43b63e=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x228)]],_0x139429=[_0x2c2ddd['body'][_0x2fa68f(0x2ae)]],_0x2f72fb=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x208)]],_0x508937=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x246)]],_0x3f94ec=[_0x2c2ddd['body'][_0x2fa68f(0x2ef)]],_0x21c503=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x24d)]],_0x2aa7d4=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x1e4)]],_0x5254cb=[_0x2c2ddd['body'][_0x2fa68f(0x2dc)]],_0x1e3276=[_0x2c2ddd['body']['delivery_code']],_0x4e1195=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x290)]],_0x56dc35=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x252)]],_0x17f651=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x269)]],_0x11a816=[_0x2c2ddd['body']['prod_invoice']],_0x6bc124=[_0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x2e8)]],_0x4fa19c=[_0x2c2ddd[_0x2fa68f(0x2e2)]['actual_uom']];else var _0x31c6af=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x2ea)]],_0x4b65a0=[..._0x2c2ddd[_0x2fa68f(0x2e2)]['stock']],_0xa29283=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x2c2)]],_0x3997c6=[..._0x2c2ddd[_0x2fa68f(0x2e2)]['primary_code']],_0x374cb1=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x26b)]],_0x1356c9=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x1ff)]],_0x16cb31=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x291)]],_0x43b63e=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x228)]],_0x139429=[..._0x2c2ddd[_0x2fa68f(0x2e2)]['secondary_unit']],_0x2f72fb=[..._0x2c2ddd[_0x2fa68f(0x2e2)]['batch_code']],_0x508937=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x246)]],_0x3f94ec=[..._0x2c2ddd[_0x2fa68f(0x2e2)]['max_per_unit']],_0x21c503=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x24d)]],_0x2aa7d4=[..._0x2c2ddd['body'][_0x2fa68f(0x1e4)]],_0x5254cb=[..._0x2c2ddd['body']['delivery_date']],_0x1e3276=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x27f)]],_0x4e1195=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x290)]],_0x56dc35=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x252)]],_0x17f651=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x269)]],_0x11a816=[..._0x2c2ddd[_0x2fa68f(0x2e2)][_0x2fa68f(0x2a3)]],_0x6bc124=[..._0x2c2ddd['body'][_0x2fa68f(0x2e8)]],_0x4fa19c=[..._0x2c2ddd['body']['actual_uom']];const _0x1e9322=_0x31c6af['map'](_0x24c155=>{return _0x24c155={'product_name':_0x24c155};});_0x4b65a0[_0x2fa68f(0x229)]((_0x815a4f,_0x49fe98)=>{var _0x1c07e0=_0x2fa68f;_0x1e9322[_0x49fe98][_0x1c07e0(0x218)]=_0x815a4f;}),_0x6bc124[_0x2fa68f(0x229)]((_0x3145d7,_0x59cd3e)=>{_0x1e9322[_0x59cd3e]['actual_qty']=_0x3145d7;}),_0x4fa19c[_0x2fa68f(0x229)]((_0x5e162c,_0x3a5dd0)=>{_0x1e9322[_0x3a5dd0]['actual_uom']=_0x5e162c;}),_0xa29283['forEach']((_0x4b2ff7,_0x57c282)=>{var _0x2b9c57=_0x2fa68f;_0x1e9322[_0x57c282][_0x2b9c57(0x252)]=_0x4b2ff7;}),_0x3997c6['forEach']((_0x3b0c33,_0x328137)=>{_0x1e9322[_0x328137]['primary_code']=_0x3b0c33;}),_0x374cb1[_0x2fa68f(0x229)]((_0x73b242,_0x5df3be)=>{var _0x44eea5=_0x2fa68f;_0x1e9322[_0x5df3be][_0x44eea5(0x26b)]=_0x73b242;}),_0x1356c9[_0x2fa68f(0x229)]((_0x462424,_0x5530e9)=>{var _0x5c09bd=_0x2fa68f;_0x1e9322[_0x5530e9][_0x5c09bd(0x23a)]=_0x462424;}),_0x16cb31['forEach']((_0x42e4f7,_0x3c1e2d)=>{var _0x330bcf=_0x2fa68f;_0x17f651[_0x330bcf(0x229)]((_0x24ac93,_0x21121d)=>{var _0xdef276=_0x330bcf;if(_0x24ac93==_0xdef276(0x2af)&&_0x3c1e2d==_0x21121d){var _0x1253de=_0x42e4f7['slice'](0x3);_0x1e9322[_0x3c1e2d][_0xdef276(0x2a1)]=_0x42e4f7[0x0],_0x1e9322[_0x3c1e2d]['rack']=_0x42e4f7[0x1],_0x1e9322[_0x3c1e2d][_0xdef276(0x259)]=0x0,_0x1e9322[_0x3c1e2d][_0xdef276(0x2b9)]=0x0,_0x1e9322[_0x3c1e2d][_0xdef276(0x2c5)]='Floor',_0x1e9322[_0x3c1e2d][_0xdef276(0x1ed)]=_0x1253de;}else{if(_0x24ac93==_0xdef276(0x1e2)&&_0x3c1e2d==_0x21121d){var _0x1253de=_0x42e4f7[_0xdef276(0x29b)](0x3);_0x1e9322[_0x3c1e2d][_0xdef276(0x2a1)]=_0x42e4f7[0x0],_0x1e9322[_0x3c1e2d][_0xdef276(0x210)]=_0x42e4f7[0x1],_0x1e9322[_0x3c1e2d][_0xdef276(0x259)]=0x0,_0x1e9322[_0x3c1e2d][_0xdef276(0x2b9)]=0x0,_0x1e9322[_0x3c1e2d][_0xdef276(0x2c5)]='Floor',_0x1e9322[_0x3c1e2d][_0xdef276(0x1ed)]=_0x42e4f7[0x5];}else{if(_0x3c1e2d==_0x21121d){var _0x299b6b;if(_0x42e4f7[0x4]=='L')_0x299b6b=_0xdef276(0x2ec);else _0x42e4f7[0x4]=='F'&&(_0x299b6b=_0xdef276(0x2b8));_0x1e9322[_0x3c1e2d]['storage']=_0x42e4f7[0x0],_0x1e9322[_0x3c1e2d]['rack']=_0x42e4f7[0x1],_0x1e9322[_0x3c1e2d][_0xdef276(0x259)]=_0x42e4f7[0x2],_0x1e9322[_0x3c1e2d][_0xdef276(0x2b9)]=_0x42e4f7[0x3],_0x1e9322[_0x3c1e2d][_0xdef276(0x2c5)]=_0x299b6b,_0x1e9322[_0x3c1e2d][_0xdef276(0x1ed)]=_0x42e4f7[0x5];}}}});}),_0x43b63e['forEach']((_0x14f980,_0x484b9b)=>{var _0x444983=_0x2fa68f;_0x1e9322[_0x484b9b][_0x444983(0x2d1)]=_0x14f980;}),_0x139429[_0x2fa68f(0x229)]((_0x2d0787,_0x1656a7)=>{var _0x153343=_0x2fa68f;_0x1e9322[_0x1656a7][_0x153343(0x2ae)]=_0x2d0787;}),_0x2f72fb[_0x2fa68f(0x229)]((_0x242b22,_0x33ab4f)=>{var _0xc1f2fb=_0x2fa68f;_0x1e9322[_0x33ab4f][_0xc1f2fb(0x208)]=_0x242b22;}),_0x508937[_0x2fa68f(0x229)]((_0x29b06c,_0xdd2f45)=>{var _0x420d81=_0x2fa68f;_0x1e9322[_0xdd2f45][_0x420d81(0x246)]=_0x29b06c;}),_0x3f94ec[_0x2fa68f(0x229)]((_0x580963,_0x3332ba)=>{_0x1e9322[_0x3332ba]['maxperunit']=_0x580963;}),_0x21c503[_0x2fa68f(0x229)]((_0x4729b4,_0x397a8d)=>{var _0xe3b0dc=_0x2fa68f;_0x1e9322[_0x397a8d][_0xe3b0dc(0x24d)]=_0x4729b4;}),_0x2aa7d4[_0x2fa68f(0x229)]((_0x24a248,_0x11028f)=>{_0x1e9322[_0x11028f]['requested_qty']=_0x24a248;}),_0x5254cb[_0x2fa68f(0x229)]((_0xdfd700,_0x1af746)=>{var _0x5696d0=_0x2fa68f;_0x1e9322[_0x1af746][_0x5696d0(0x2dc)]=_0xdfd700;}),_0x1e3276[_0x2fa68f(0x229)]((_0x45fc48,_0x15a48a)=>{var _0xb13dda=_0x2fa68f;_0x1e9322[_0x15a48a][_0xb13dda(0x27f)]=_0x45fc48;}),_0x4e1195[_0x2fa68f(0x229)]((_0x2a1229,_0x517754)=>{_0x1e9322[_0x517754]['prod_cat']=_0x2a1229;}),_0x56dc35['forEach']((_0x1a6e03,_0x1c3fdf)=>{var _0x4f28f3=_0x2fa68f;_0x1e9322[_0x1c3fdf][_0x4f28f3(0x22a)]=_0x1a6e03;}),_0x17f651['forEach']((_0x5f2a9d,_0xd3b0f6)=>{_0x1e9322[_0xd3b0f6]['room_name']=_0x5f2a9d;}),_0x11a816[_0x2fa68f(0x229)]((_0x492122,_0x231531)=>{var _0x4a24b7=_0x2fa68f;_0x1e9322[_0x231531][_0x4a24b7(0x267)]=_0x492122;});var _0xc7e5b7=0x0;_0x1e9322[_0x2fa68f(0x229)](_0x3414b2=>{var _0x340a21=_0x2fa68f;(_0x3414b2[_0x340a21(0x218)]<_0x3414b2[_0x340a21(0x22a)]||_0x3414b2[_0x340a21(0x22a)]==0x0)&&(console[_0x340a21(0x284)](_0x340a21(0x216),_0x3414b2),_0xc7e5b7++);});const _0x18f107=_0x1e9322[_0x2fa68f(0x292)](_0x560f2a=>_0x560f2a[_0x2fa68f(0x252)]!=='0'&&_0x560f2a[_0x2fa68f(0x252)]!==''),_0x1b7099=new sales({'invoice':_0x247d84,'customer':_0x2c2ddd[_0x2fa68f(0x2e2)]['customer'],'date':_0x1b6bb3,'warehouse_name':_0x218f6e,'sale_product':_0x18f107,'note':_0x4be403,'room':_0x4d3196,'primary_code':_0x121a22,'secondary_code':_0x3a58b8,'prod_code':_0x425ad4,'SCRN':_0x14b8ed}),_0x3bb2b3=await _0x1b7099[_0x2fa68f(0x212)]();_0x2c2ddd[_0x2fa68f(0x248)](_0x2fa68f(0x25f),_0x2fa68f(0x1e9)),_0x460cb5[_0x2fa68f(0x26d)](_0x2fa68f(0x2a9)+_0x3bb2b3[_0x2fa68f(0x2d8)]);}catch(_0x426277){console[_0x2fa68f(0x284)](_0x426277);}}),router[a0_0x1628f6(0x28b)](a0_0x1628f6(0x2c6),auth,async(_0xfe20fa,_0x563fd1)=>{var _0x389212=a0_0x1628f6;try{const {username:_0x2a3033,email:_0x393a57,role:_0x23488b}=_0xfe20fa[_0x389212(0x264)],_0x4fff63=_0xfe20fa[_0x389212(0x264)],_0xc550b7=await profile[_0x389212(0x22c)]({'email':_0x4fff63[_0x389212(0x2f1)]}),_0x43c943=await master_shop[_0x389212(0x20c)](),_0x580901=_0xfe20fa['params']['id'],_0x55a96b=await sales[_0x389212(0x2cf)](_0x580901),_0x423da3=await warehouse['aggregate']([{'$match':{'name':_0x55a96b[_0x389212(0x270)]}},{'$unwind':_0x389212(0x2c3)},{'$group':{'_id':_0x389212(0x283),'name':{'$first':_0x389212(0x258)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x389212(0x1f0)},'type':{'$first':_0x389212(0x2c4)},'floorlevel':{'$first':_0x389212(0x226)},'primary_code':{'$first':_0x389212(0x2b5)},'secondary_code':{'$first':_0x389212(0x2a2)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x389212(0x1fc)},'expiry_date':{'$first':_0x389212(0x236)},'production_date':{'$first':_0x389212(0x231)}}}]),_0x163df1=await customer['find']({});let _0x2569ab;if(_0x4fff63['role']==_0x389212(0x254)){const _0x468c05=await staff[_0x389212(0x22c)]({'email':_0x4fff63[_0x389212(0x2f1)]});_0x2569ab=await warehouse['aggregate']([{'$match':{'status':_0x389212(0x244),'name':_0x468c05[_0x389212(0x213)]}},{'$group':{'_id':_0x389212(0x2a7),'name':{'$first':'$name'}}}]);}else _0x2569ab=await warehouse[_0x389212(0x215)]([{'$match':{'status':_0x389212(0x244)}},{'$group':{'_id':'$name','name':{'$first':_0x389212(0x2a7)}}}]);const _0x132aef=await product[_0x389212(0x20c)]({}),_0x333e2c=await suppliers[_0x389212(0x20c)]({});if(_0x43c943[0x0][_0x389212(0x23f)]==_0x389212(0x224)){var _0x33fa22=users['English'];console[_0x389212(0x284)](_0x33fa22);}else{if(_0x43c943[0x0]['language']==_0x389212(0x2a0))var _0x33fa22=users[_0x389212(0x2a0)];else{if(_0x43c943[0x0]['language']==_0x389212(0x255))var _0x33fa22=users[_0x389212(0x255)];else{if(_0x43c943[0x0][_0x389212(0x23f)]=='Spanish')var _0x33fa22=users[_0x389212(0x285)];else{if(_0x43c943[0x0]['language']==_0x389212(0x1f1))var _0x33fa22=users[_0x389212(0x1f1)];else{if(_0x43c943[0x0][_0x389212(0x23f)]=='Portuguese\x20(BR)')var _0x33fa22=users[_0x389212(0x24f)];else{if(_0x43c943[0x0][_0x389212(0x23f)]==_0x389212(0x1e6))var _0x33fa22=users[_0x389212(0x1e6)];else{if(_0x43c943[0x0][_0x389212(0x23f)]==_0x389212(0x2bd))var _0x33fa22=users[_0x389212(0x237)];}}}}}}}_0x563fd1[_0x389212(0x278)]('edit_sales_view',{'success':_0xfe20fa['flash'](_0x389212(0x25f)),'errors':_0xfe20fa['flash']('errors'),'role':_0x4fff63,'profile':_0xc550b7,'customer':_0x163df1,'warehouse':_0x2569ab,'product':_0x423da3,'user':_0x55a96b,'master_shop':_0x43c943,'unit':_0x132aef,'language':_0x33fa22,'suppliers':_0x333e2c});}catch(_0x22e762){console[_0x389212(0x284)](_0x22e762);}}),router[a0_0x1628f6(0x209)](a0_0x1628f6(0x2c6),auth,async(_0x4a75e6,_0x154588)=>{var _0x1aeead=a0_0x1628f6;try{const _0xf9c981=_0x4a75e6[_0x1aeead(0x256)]['id'],{invoice:_0x2b1951,warehouse_name:_0x5bd1a9,room:_0x2c07a3}=_0x4a75e6[_0x1aeead(0x2e2)],_0x107784=await sales['findOne']({'invoice':_0x2b1951}),_0x28c883=_0x107784[_0x1aeead(0x223)][_0x1aeead(0x288)](async _0x5cb198=>{var _0x562910=_0x1aeead,_0x77824=await warehouse[_0x562910(0x22c)]({'name':_0x5bd1a9,'room':_0x5cb198[_0x562910(0x1e5)],'warehouse_category':_0x562910(0x2dd)});const _0xbe082e=_0x77824['product_details'][_0x562910(0x288)](_0x58757c=>{var _0x284a72=_0x562910;_0x58757c[_0x284a72(0x2ea)]==_0x5cb198[_0x284a72(0x2ea)]&&_0x58757c[_0x284a72(0x1ed)]==_0x5cb198[_0x284a72(0x1ed)]&&_0x58757c['type']==_0x5cb198['type']&&_0x58757c[_0x284a72(0x2b9)]==_0x5cb198[_0x284a72(0x2b9)]&&_0x58757c[_0x284a72(0x259)]==_0x5cb198[_0x284a72(0x259)]&&_0x58757c[_0x284a72(0x210)]==_0x5cb198[_0x284a72(0x210)]&&_0x58757c['storage']==_0x5cb198[_0x284a72(0x2a1)]&&_0x58757c[_0x284a72(0x246)]==_0x5cb198[_0x284a72(0x246)]&&_0x58757c[_0x284a72(0x208)]==_0x5cb198[_0x284a72(0x208)]&&_0x58757c[_0x284a72(0x267)]==_0x5cb198[_0x284a72(0x267)]&&(_0x58757c[_0x284a72(0x29a)]=_0x58757c[_0x284a72(0x29a)]-_0x5cb198[_0x284a72(0x252)]);});return _0x77824;});Promise[_0x1aeead(0x295)](_0x28c883)['then'](async _0x2888d4=>{var _0x15d8d8=_0x1aeead;try{for(const _0x49239e of _0x2888d4){await _0x49239e[_0x15d8d8(0x212)]();}_0x107784[_0x15d8d8(0x2ce)]=_0x15d8d8(0x222);const _0x27a8ad=await _0x107784[_0x15d8d8(0x212)](),_0xbb0034=await master_shop[_0x15d8d8(0x20c)](),_0x90871d=await email_settings[_0x15d8d8(0x22c)](),_0x4f3f16=await supervisor_settings[_0x15d8d8(0x20c)]();var _0x21933d=_0x107784[_0x15d8d8(0x223)],_0xdebba='',_0x1b7b0e;for(_0x1b7b0e in _0x21933d){_0xdebba+=_0x15d8d8(0x27d)+_0x15d8d8(0x2bb)+_0x21933d[_0x1b7b0e][_0x15d8d8(0x2ea)]+'</td>'+_0x15d8d8(0x2bb)+_0x21933d[_0x1b7b0e][_0x15d8d8(0x23a)]+_0x15d8d8(0x29e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x21933d[_0x1b7b0e]['quantity']+_0x15d8d8(0x29e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x21933d[_0x1b7b0e][_0x15d8d8(0x2d1)]+_0x15d8d8(0x29e)+_0x15d8d8(0x2bb)+_0x21933d[_0x1b7b0e][_0x15d8d8(0x2ae)]+'</td>'+_0x15d8d8(0x2bb)+_0x107784[_0x15d8d8(0x270)]+_0x15d8d8(0x29e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x21933d[_0x1b7b0e][_0x15d8d8(0x1e5)]+_0x15d8d8(0x29e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x21933d[_0x1b7b0e]['storage']+_0x21933d[_0x1b7b0e]['rack']+_0x21933d[_0x1b7b0e][_0x15d8d8(0x259)]+_0x21933d[_0x1b7b0e][_0x15d8d8(0x2b9)]+_0x21933d[_0x1b7b0e][_0x15d8d8(0x2c5)][0x0]+_0x21933d[_0x1b7b0e][_0x15d8d8(0x1ed)]+_0x15d8d8(0x29e),_0x15d8d8(0x204);}let _0x490f75=nodemailer[_0x15d8d8(0x235)]({'host':_0x90871d[_0x15d8d8(0x2df)],'port':Number(_0x90871d['port']),'secure':![],'auth':{'user':_0x90871d[_0x15d8d8(0x2f1)],'pass':_0x90871d[_0x15d8d8(0x211)]}}),_0xed6f44={'from':_0x90871d['email'],'to':_0x4f3f16[0x0][_0x15d8d8(0x250)],'subject':_0x15d8d8(0x1ef),'attachments':[{'filename':_0x15d8d8(0x2b4),'path':__dirname+_0x15d8d8(0x263)+_0x15d8d8(0x2bf)+_0xbb0034[0x0][_0x15d8d8(0x2e0)],'cid':_0x15d8d8(0x1e7)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x15d8d8(0x28c)+'<div>'+_0x15d8d8(0x22e)+'<div>'+_0x15d8d8(0x242)+_0x15d8d8(0x24e)+_0x15d8d8(0x2c0)+_0x15d8d8(0x257)+_0xbb0034[0x0][_0x15d8d8(0x2cc)]+'\x20</h2>'+_0x15d8d8(0x24e)+_0x15d8d8(0x24e)+_0x15d8d8(0x24b)+_0x15d8d8(0x2c0)+_0x15d8d8(0x22b)+'\x20Order\x20Number\x20:\x20'+_0x107784[_0x15d8d8(0x267)]+'\x20'+_0x15d8d8(0x23b)+'\x20Order\x20Date\x20:\x20'+_0x107784[_0x15d8d8(0x207)]+'\x20'+_0x15d8d8(0x1ec)+_0x15d8d8(0x253)+_0x15d8d8(0x24e)+_0x15d8d8(0x28e)+_0x15d8d8(0x276)+_0x15d8d8(0x27d)+_0x15d8d8(0x2de)+_0x15d8d8(0x281)+_0x15d8d8(0x2d9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x15d8d8(0x21f)+_0x15d8d8(0x27b)+_0x15d8d8(0x27c)+_0x15d8d8(0x204)+'</thead>'+_0x15d8d8(0x2e9)+'\x20'+_0xdebba+'\x20'+_0x15d8d8(0x221)+'</table>'+_0x15d8d8(0x2c0)+_0x15d8d8(0x247)+_0x15d8d8(0x28d)+_0xbb0034[0x0]['site_title']+_0x15d8d8(0x253)+_0x15d8d8(0x24e)+'</div>'+_0x15d8d8(0x2e6)};_0x490f75[_0x15d8d8(0x273)](_0xed6f44,function(_0x3537ca,_0x5032b3){var _0x26349e=_0x15d8d8;_0x3537ca?(console[_0x26349e(0x284)](_0x3537ca),console['log'](_0x26349e(0x22d))):console[_0x26349e(0x284)](_0x26349e(0x227));}),_0x4a75e6['flash'](_0x15d8d8(0x25f),_0x15d8d8(0x1f7)),_0x154588[_0x15d8d8(0x26d)]('/all_sales/preview/'+_0xf9c981);}catch(_0x1c5382){console[_0x15d8d8(0x2d6)](_0x1c5382),_0x154588[_0x15d8d8(0x26f)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x272348=>{var _0x473f67=_0x1aeead;console[_0x473f67(0x2d6)](_0x272348),_0x154588[_0x473f67(0x26f)](0x1f4)['json']({'error':_0x473f67(0x2ed)});});}catch(_0x1617f2){console['log'](_0x1617f2);}}),router['get'](a0_0x1628f6(0x251),auth,async(_0x38fc20,_0x12c2c0)=>{var _0x4abdb6=a0_0x1628f6;try{const {username:_0x575ef4,email:_0x4a00ec,role:_0x337bf9}=_0x38fc20[_0x4abdb6(0x264)],_0x5298ad=_0x38fc20[_0x4abdb6(0x264)],_0x51b5dc=await profile[_0x4abdb6(0x22c)]({'email':_0x5298ad['email']}),_0x16984f=await master_shop['find'](),_0x30aa1e=_0x38fc20[_0x4abdb6(0x256)]['id'],_0x350c65=await sales[_0x4abdb6(0x2cf)](_0x30aa1e);var _0x130321=['Ambient',_0x4abdb6(0x299)];const _0x1eac0d=await warehouse['aggregate']([{'$match':{'name':_0x350c65[_0x4abdb6(0x270)],'warehouse_category':_0x4abdb6(0x2dd)}},{'$unwind':_0x4abdb6(0x2c3)},{'$group':{'_id':_0x4abdb6(0x283),'name':{'$first':_0x4abdb6(0x258)},'product_stock':{'$first':_0x4abdb6(0x23d)},'bay':{'$first':_0x4abdb6(0x2cd)},'bin':{'$first':_0x4abdb6(0x1f0)},'type':{'$first':_0x4abdb6(0x2c4)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4abdb6(0x2b5)},'secondary_code':{'$first':_0x4abdb6(0x2a2)},'product_code':{'$first':_0x4abdb6(0x25c)},'storage':{'$first':_0x4abdb6(0x265)},'rack':{'$first':'$product_details.rack'}}}]),_0x30833a=await customer['find']({});let _0x22e377;if(_0x5298ad[_0x4abdb6(0x2ee)]==_0x4abdb6(0x254)){const _0x438826=await staff['findOne']({'email':_0x5298ad[_0x4abdb6(0x2f1)]});_0x22e377=await warehouse[_0x4abdb6(0x215)]([{'$match':{'status':'Enabled','name':_0x438826['warehouse'],'warehouse_category':_0x4abdb6(0x2dd)}},{'$group':{'_id':_0x4abdb6(0x2a7),'name':{'$first':'$name'}}}]);}else _0x22e377=await warehouse['aggregate']([{'$match':{'status':_0x4abdb6(0x244),'warehouse_category':_0x4abdb6(0x2dd)}},{'$group':{'_id':_0x4abdb6(0x2a7),'name':{'$first':_0x4abdb6(0x2a7)}}}]);const _0xcfbd5d=await product[_0x4abdb6(0x20c)]({});if(_0x16984f[0x0]['language']==_0x4abdb6(0x224)){var _0x471e78=users[_0x4abdb6(0x24a)];console[_0x4abdb6(0x284)](_0x471e78);}else{if(_0x16984f[0x0][_0x4abdb6(0x23f)]==_0x4abdb6(0x2a0))var _0x471e78=users[_0x4abdb6(0x2a0)];else{if(_0x16984f[0x0][_0x4abdb6(0x23f)]==_0x4abdb6(0x255))var _0x471e78=users[_0x4abdb6(0x255)];else{if(_0x16984f[0x0][_0x4abdb6(0x23f)]==_0x4abdb6(0x285))var _0x471e78=users[_0x4abdb6(0x285)];else{if(_0x16984f[0x0][_0x4abdb6(0x23f)]==_0x4abdb6(0x1f1))var _0x471e78=users[_0x4abdb6(0x1f1)];else{if(_0x16984f[0x0][_0x4abdb6(0x23f)]==_0x4abdb6(0x27a))var _0x471e78=users['Portuguese'];else{if(_0x16984f[0x0]['language']==_0x4abdb6(0x1e6))var _0x471e78=users[_0x4abdb6(0x1e6)];else{if(_0x16984f[0x0][_0x4abdb6(0x23f)]==_0x4abdb6(0x2bd))var _0x471e78=users[_0x4abdb6(0x237)];}}}}}}}_0x12c2c0[_0x4abdb6(0x278)](_0x4abdb6(0x293),{'success':_0x38fc20[_0x4abdb6(0x248)]('success'),'errors':_0x38fc20[_0x4abdb6(0x248)](_0x4abdb6(0x2c9)),'role':_0x5298ad,'profile':_0x51b5dc,'customer':_0x30833a,'warehouse':_0x22e377,'product':_0x1eac0d,'user':_0x350c65,'master_shop':_0x16984f,'unit':_0xcfbd5d,'language':_0x471e78});}catch(_0x1873fe){console[_0x4abdb6(0x284)](_0x1873fe);}}),router[a0_0x1628f6(0x209)](a0_0x1628f6(0x251),auth,async(_0x333426,_0x118d09)=>{var _0x4be58a=a0_0x1628f6;try{const _0x897731=_0x333426[_0x4be58a(0x256)]['id'],_0x4ae06c=await sales[_0x4be58a(0x22c)]({'_id':_0x333426[_0x4be58a(0x256)]['id']}),_0x470ee3=await warehouse[_0x4be58a(0x22c)]({'name':_0x4ae06c[_0x4be58a(0x270)],'room':_0x333426['body'][_0x4be58a(0x2da)]}),{invoice:_0x55065c,date:_0x4b2e66,warehouse_name:_0x482e19,product_name:_0x335137,stock:_0x1283c6,quantity:_0x2be923,note:_0x51fb1a,room:_0x3451ff,customer:_0xa2a8ee,SCRN:_0x20a03b}=_0x333426[_0x4be58a(0x2e2)];if(typeof _0x335137==_0x4be58a(0x2e3))var _0x3854d2=[_0x333426['body']['product_name']],_0x487914=[_0x333426['body'][_0x4be58a(0x218)]],_0x2660e8=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x2c2)]],_0x53c90e=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x21b)]],_0x384cf8=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x26b)]],_0x577caa=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x1ff)]],_0x2a125a=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x291)]],_0x3391f0=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x228)]],_0x3e990e=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x2ae)]],_0x2a9bc4=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x208)]],_0x3d5d82=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x246)]],_0x47173=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x2ef)]],_0x38e023=[_0x333426['body'][_0x4be58a(0x24d)]],_0x2de2b2=[_0x333426['body'][_0x4be58a(0x1e4)]],_0x2ec179=[_0x333426[_0x4be58a(0x2e2)]['delivery_date']],_0x3172f4=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x27f)]],_0x43f742=[_0x333426[_0x4be58a(0x2e2)]['prod_cat']],_0x3bccfa=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x252)]],_0x4edeaa=[_0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x269)]];else var _0x3854d2=[..._0x333426[_0x4be58a(0x2e2)]['product_name']],_0x487914=[..._0x333426[_0x4be58a(0x2e2)]['stock']],_0x2660e8=[..._0x333426[_0x4be58a(0x2e2)]['carton']],_0x53c90e=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x21b)]],_0x384cf8=[..._0x333426[_0x4be58a(0x2e2)]['secondary_code']],_0x577caa=[..._0x333426['body'][_0x4be58a(0x1ff)]],_0x2a125a=[..._0x333426['body'][_0x4be58a(0x291)]],_0x3391f0=[..._0x333426['body'][_0x4be58a(0x228)]],_0x3e990e=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x2ae)]],_0x2a9bc4=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x208)]],_0x3d5d82=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x246)]],_0x47173=[..._0x333426['body'][_0x4be58a(0x2ef)]],_0x38e023=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x24d)]],_0x2de2b2=[..._0x333426['body'][_0x4be58a(0x1e4)]],_0x2ec179=[..._0x333426['body'][_0x4be58a(0x2dc)]],_0x3172f4=[..._0x333426['body'][_0x4be58a(0x27f)]],_0x43f742=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x290)]],_0x3bccfa=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x252)]],_0x4edeaa=[..._0x333426[_0x4be58a(0x2e2)][_0x4be58a(0x269)]];const _0x10d702=_0x3854d2[_0x4be58a(0x288)](_0x2c6734=>{return _0x2c6734={'product_name':_0x2c6734};});_0x487914[_0x4be58a(0x229)]((_0x5b35eb,_0x3219c9)=>{var _0x42d9fe=_0x4be58a;_0x10d702[_0x3219c9][_0x42d9fe(0x218)]=_0x5b35eb;}),_0x2660e8[_0x4be58a(0x229)]((_0x4b8984,_0x32edf4)=>{_0x10d702[_0x32edf4]['quantity']=_0x4b8984;}),_0x53c90e[_0x4be58a(0x229)]((_0x4bcf93,_0x400159)=>{_0x10d702[_0x400159]['primary_code']=_0x4bcf93;}),_0x384cf8[_0x4be58a(0x229)]((_0x152781,_0x437a1a)=>{var _0x39796e=_0x4be58a;_0x10d702[_0x437a1a][_0x39796e(0x26b)]=_0x152781;}),_0x577caa[_0x4be58a(0x229)]((_0x21267f,_0x2762c8)=>{_0x10d702[_0x2762c8]['product_code']=_0x21267f;}),_0x2a125a[_0x4be58a(0x229)]((_0xf7c99f,_0x5d3528)=>{var _0x23c345=_0x4be58a;_0x4edeaa[_0x23c345(0x229)]((_0x334de5,_0x31991e)=>{var _0x30f4c2=_0x23c345;if(_0x334de5==_0x30f4c2(0x2af)&&_0x5d3528==_0x31991e){var _0x4227cb=_0xf7c99f[_0x30f4c2(0x29b)](0x3);_0x10d702[_0x5d3528]['storage']=_0xf7c99f[0x0],_0x10d702[_0x5d3528][_0x30f4c2(0x210)]=_0xf7c99f[0x1],_0x10d702[_0x5d3528][_0x30f4c2(0x259)]=0x0,_0x10d702[_0x5d3528][_0x30f4c2(0x2b9)]=0x0,_0x10d702[_0x5d3528]['type']=_0x30f4c2(0x2b8),_0x10d702[_0x5d3528][_0x30f4c2(0x1ed)]=_0x4227cb;}else{if(_0x334de5=='Shelves'&&_0x5d3528==_0x31991e){var _0x4227cb=_0xf7c99f[_0x30f4c2(0x29b)](0x3);_0x10d702[_0x5d3528]['storage']=_0xf7c99f[0x0],_0x10d702[_0x5d3528][_0x30f4c2(0x210)]=_0xf7c99f[0x1],_0x10d702[_0x5d3528]['bay']=0x0,_0x10d702[_0x5d3528][_0x30f4c2(0x2b9)]=0x0,_0x10d702[_0x5d3528][_0x30f4c2(0x2c5)]=_0x30f4c2(0x2b8),_0x10d702[_0x5d3528][_0x30f4c2(0x1ed)]=_0xf7c99f[0x5];}else{if(_0x5d3528==_0x31991e){var _0x3a15e1;if(_0xf7c99f[0x4]=='L')_0x3a15e1=_0x30f4c2(0x2ec);else _0xf7c99f[0x4]=='F'&&(_0x3a15e1='Floor');_0x10d702[_0x5d3528]['storage']=_0xf7c99f[0x0],_0x10d702[_0x5d3528][_0x30f4c2(0x210)]=_0xf7c99f[0x1],_0x10d702[_0x5d3528][_0x30f4c2(0x259)]=_0xf7c99f[0x2],_0x10d702[_0x5d3528]['bin']=_0xf7c99f[0x3],_0x10d702[_0x5d3528][_0x30f4c2(0x2c5)]=_0x3a15e1,_0x10d702[_0x5d3528][_0x30f4c2(0x1ed)]=_0xf7c99f[0x5];}}}});}),_0x3391f0[_0x4be58a(0x229)]((_0x2b8121,_0x1d17ca)=>{var _0x11df5a=_0x4be58a;_0x10d702[_0x1d17ca][_0x11df5a(0x2d1)]=_0x2b8121;}),_0x3e990e['forEach']((_0x532979,_0x52bf23)=>{_0x10d702[_0x52bf23]['secondary_unit']=_0x532979;}),_0x2a9bc4[_0x4be58a(0x229)]((_0x393330,_0x2811c1)=>{var _0x12a8aa=_0x4be58a;_0x10d702[_0x2811c1][_0x12a8aa(0x208)]=_0x393330;}),_0x3d5d82[_0x4be58a(0x229)]((_0x5a3ae0,_0x327b8c)=>{var _0xa4edee=_0x4be58a;_0x10d702[_0x327b8c][_0xa4edee(0x246)]=_0x5a3ae0;}),_0x47173[_0x4be58a(0x229)]((_0x491521,_0x524ff2)=>{var _0x10b9a5=_0x4be58a;_0x10d702[_0x524ff2][_0x10b9a5(0x260)]=_0x491521;}),_0x38e023[_0x4be58a(0x229)]((_0x591f9e,_0x52041e)=>{var _0x5cd4c0=_0x4be58a;_0x10d702[_0x52041e][_0x5cd4c0(0x24d)]=_0x591f9e;}),_0x2de2b2[_0x4be58a(0x229)]((_0x48a719,_0x31b0b4)=>{var _0x4abd9b=_0x4be58a;_0x10d702[_0x31b0b4][_0x4abd9b(0x1e4)]=_0x48a719;}),_0x2ec179[_0x4be58a(0x229)]((_0x5c69ee,_0x1942ed)=>{var _0x46469d=_0x4be58a;_0x10d702[_0x1942ed][_0x46469d(0x2dc)]=_0x5c69ee;}),_0x3172f4[_0x4be58a(0x229)]((_0x4f47b0,_0xfb04e)=>{_0x10d702[_0xfb04e]['delivery_code']=_0x4f47b0;}),_0x43f742[_0x4be58a(0x229)]((_0x35264a,_0x3a8c7e)=>{var _0x39b12a=_0x4be58a;_0x10d702[_0x3a8c7e][_0x39b12a(0x290)]=_0x35264a;}),_0x3bccfa['forEach']((_0x5db5ce,_0x28aa68)=>{var _0x32b1bb=_0x4be58a;_0x10d702[_0x28aa68][_0x32b1bb(0x22a)]=_0x5db5ce;}),_0x4edeaa['forEach']((_0x2922fe,_0x35a65b)=>{var _0x541751=_0x4be58a;_0x10d702[_0x35a65b][_0x541751(0x1e5)]=_0x2922fe;});var _0x50707a=0x0;_0x10d702['forEach'](_0x55ebd5=>{var _0x22101d=_0x4be58a;console['log'](_0x22101d(0x216),_0x55ebd5),(parseInt(_0x55ebd5[_0x22101d(0x218)])<parseInt(_0x55ebd5[_0x22101d(0x252)])||parseInt(_0x55ebd5['quantity'])==0x0)&&_0x50707a++;});if(_0x50707a!=0x0)return _0x333426[_0x4be58a(0x248)](_0x4be58a(0x2c9),_0x4be58a(0x20e)),_0x118d09['redirect'](_0x4be58a(0x2ad));const _0x440d06=_0x10d702['filter'](_0x454dfb=>_0x454dfb[_0x4be58a(0x252)]!=='0'&&_0x454dfb['quantity']!=='');_0x4ae06c[_0x4be58a(0x267)]=_0x55065c,_0x4ae06c['customer']=_0xa2a8ee,_0x4ae06c[_0x4be58a(0x207)]=_0x4b2e66,_0x4ae06c[_0x4be58a(0x270)]=_0x482e19,_0x4ae06c[_0x4be58a(0x223)]=_0x440d06,_0x4ae06c[_0x4be58a(0x2e1)]=_0x51fb1a,_0x4ae06c[_0x4be58a(0x2a5)]=_0x20a03b,_0x4ae06c[_0x4be58a(0x2ce)]=_0x4be58a(0x2e7),_0x4ae06c[_0x4be58a(0x201)]='False';const _0x569f9d=await _0x4ae06c['save']();_0x333426['flash'](_0x4be58a(0x25f),_0x4be58a(0x1f7)),_0x118d09[_0x4be58a(0x26d)](_0x4be58a(0x296));}catch(_0x15c8e5){console[_0x4be58a(0x284)](_0x15c8e5);}}),router[a0_0x1628f6(0x209)](a0_0x1628f6(0x279),auth,async(_0x72c6,_0x5a5125)=>{var _0x52633f=a0_0x1628f6;try{const _0x4a69bc=_0x72c6[_0x52633f(0x256)]['id'],{invoice:_0x332c88,customer:_0x2e6d6e,receivable_amount:_0x2bea1a,received_amount:_0x4911cb}=_0x72c6[_0x52633f(0x2e2)],_0x16d1dd=await sales[_0x52633f(0x2cf)](_0x4a69bc);console[_0x52633f(0x284)](_0x16d1dd);var _0x10445b=_0x2bea1a-_0x4911cb;console[_0x52633f(0x284)](_0x4911cb),_0x16d1dd[_0x52633f(0x2e5)]=parseFloat(_0x4911cb)+parseFloat(_0x16d1dd[_0x52633f(0x2e5)]),_0x16d1dd[_0x52633f(0x1f5)]=_0x10445b,console[_0x52633f(0x284)](_0x16d1dd);const _0x5f4ec9=await _0x16d1dd[_0x52633f(0x212)](),_0x1f8c33=await c_payment_data[_0x52633f(0x22c)]({'invoice':_0x332c88});_0x1f8c33[_0x52633f(0x2f0)]=_0x10445b,await _0x1f8c33['save']();let _0x1e451c=new Date(),_0x54146e=('0'+_0x1e451c[_0x52633f(0x249)]())[_0x52633f(0x29b)](-0x2),_0x19b087=('0'+(_0x1e451c[_0x52633f(0x25a)]()+0x1))[_0x52633f(0x29b)](-0x2),_0x274070=_0x1e451c[_0x52633f(0x2c1)](),_0x8a9912=_0x274070+'-'+_0x19b087+'-'+_0x54146e;const _0x206ef1=new customer_payment({'invoice':_0x332c88,'date':_0x274070+'-'+_0x19b087+'-'+_0x54146e,'customer':_0x2e6d6e,'reason':_0x52633f(0x2db),'amount':_0x4911cb}),_0x4a842a=await _0x206ef1[_0x52633f(0x212)]();_0x72c6['flash'](_0x52633f(0x25f),_0x52633f(0x20d)),_0x5a5125[_0x52633f(0x26d)]('/all_sales/view');}catch(_0x35935e){console[_0x52633f(0x284)](_0x35935e);}}),router[a0_0x1628f6(0x28b)](a0_0x1628f6(0x206),auth,async(_0x32962a,_0x25737e)=>{var _0x1bc712=a0_0x1628f6;try{const {username:_0x44e6dd,email:_0x75e982,role:_0x46cf42}=_0x32962a['user'],_0x13a145=_0x32962a[_0x1bc712(0x264)],_0x18d2f0=await profile[_0x1bc712(0x22c)]({'email':_0x13a145[_0x1bc712(0x2f1)]}),_0x2af93e=await master_shop[_0x1bc712(0x20c)]();console[_0x1bc712(0x284)]('master',_0x2af93e);const _0x2a8878=_0x32962a['params']['id'],_0x2d791c=await sales[_0x1bc712(0x2cf)](_0x2a8878);console[_0x1bc712(0x284)](_0x2d791c);const _0xc38ed=await customer[_0x1bc712(0x22c)]({'name':_0x2d791c[_0x1bc712(0x200)]});console[_0x1bc712(0x284)](_0xc38ed);if(_0x2af93e[0x0][_0x1bc712(0x23f)]=='English\x20(US)'){var _0x3af67c=users[_0x1bc712(0x24a)];console[_0x1bc712(0x284)](_0x3af67c);}else{if(_0x2af93e[0x0]['language']==_0x1bc712(0x2a0))var _0x3af67c=users['Hindi'];else{if(_0x2af93e[0x0][_0x1bc712(0x23f)]==_0x1bc712(0x255))var _0x3af67c=users['German'];else{if(_0x2af93e[0x0][_0x1bc712(0x23f)]==_0x1bc712(0x285))var _0x3af67c=users[_0x1bc712(0x285)];else{if(_0x2af93e[0x0][_0x1bc712(0x23f)]==_0x1bc712(0x1f1))var _0x3af67c=users[_0x1bc712(0x1f1)];else{if(_0x2af93e[0x0][_0x1bc712(0x23f)]=='Portuguese\x20(BR)')var _0x3af67c=users[_0x1bc712(0x24f)];else{if(_0x2af93e[0x0][_0x1bc712(0x23f)]==_0x1bc712(0x1e6))var _0x3af67c=users[_0x1bc712(0x1e6)];else{if(_0x2af93e[0x0][_0x1bc712(0x23f)]==_0x1bc712(0x2bd))var _0x3af67c=users[_0x1bc712(0x237)];}}}}}}}_0x25737e[_0x1bc712(0x278)]('sales_invoice',{'success':_0x32962a[_0x1bc712(0x248)](_0x1bc712(0x25f)),'errors':_0x32962a[_0x1bc712(0x248)](_0x1bc712(0x2c9)),'role':_0x13a145,'profile':_0x18d2f0,'master_shop':_0x2af93e,'customers':_0xc38ed,'sales':_0x2d791c,'language':_0x3af67c});}catch(_0x287769){console[_0x1bc712(0x284)](_0x287769);}}),router[a0_0x1628f6(0x28b)](a0_0x1628f6(0x203),auth,async(_0x41f1dd,_0x28ce1c)=>{var _0x1042b6=a0_0x1628f6;try{const {username:_0xf1a73b,email:_0x4abd68,role:_0x10490e}=_0x41f1dd[_0x1042b6(0x264)],_0x4ebca6=_0x41f1dd[_0x1042b6(0x264)],_0x18c72c=await profile[_0x1042b6(0x22c)]({'email':_0x4ebca6['email']}),_0x3c3a87=await master_shop[_0x1042b6(0x20c)]();console[_0x1042b6(0x284)](_0x1042b6(0x268),_0x3c3a87);const _0x13fb3a=_0x41f1dd[_0x1042b6(0x256)]['id'];console[_0x1042b6(0x284)](_0x13fb3a);const _0x2692b1=await sales['findById'](_0x13fb3a);console[_0x1042b6(0x284)](_0x1042b6(0x272),_0x2692b1);const _0x3a394d=await warehouse['aggregate']([{'$match':{'name':_0x1042b6(0x205),'room':_0x1042b6(0x26a)}},{'$unwind':_0x1042b6(0x2c3)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1042b6(0x258)},'product_stock':{'$first':_0x1042b6(0x23d)},'level':{'$first':_0x1042b6(0x2d5)},'isle':{'$first':_0x1042b6(0x29f)},'pallet':{'$first':_0x1042b6(0x1fa)},'primary_code':{'$first':_0x1042b6(0x2b5)},'secondary_code':{'$first':_0x1042b6(0x2a2)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x1042b6(0x284)](_0x1042b6(0x1fb),_0x3a394d);const _0x2200ce=await product[_0x1042b6(0x20c)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x1042b6(0x244),'name':_0x1042b6(0x205),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1042b6(0x2a7),'name':{'$first':_0x1042b6(0x2a7)}}},{'$sort':{'name':0x1}}]);var _0x4bdadd=[_0x1042b6(0x26a)];if(_0x3c3a87[0x0][_0x1042b6(0x23f)]==_0x1042b6(0x224)){var _0x22c960=users[_0x1042b6(0x24a)];console['log'](_0x22c960);}else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]==_0x1042b6(0x2a0))var _0x22c960=users[_0x1042b6(0x2a0)];else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]==_0x1042b6(0x255))var _0x22c960=users[_0x1042b6(0x255)];else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]==_0x1042b6(0x285))var _0x22c960=users[_0x1042b6(0x285)];else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]==_0x1042b6(0x1f1))var _0x22c960=users['French'];else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]==_0x1042b6(0x27a))var _0x22c960=users[_0x1042b6(0x24f)];else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]=='Chinese')var _0x22c960=users[_0x1042b6(0x1e6)];else{if(_0x3c3a87[0x0][_0x1042b6(0x23f)]=='Arabic\x20(ae)')var _0x22c960=users[_0x1042b6(0x237)];}}}}}}}_0x28ce1c[_0x1042b6(0x278)](_0x1042b6(0x23c),{'success':_0x41f1dd[_0x1042b6(0x248)](_0x1042b6(0x25f)),'errors':_0x41f1dd[_0x1042b6(0x248)]('errors'),'role':_0x4ebca6,'profile':_0x18c72c,'user':_0x2692b1,'stock':_0x3a394d,'master_shop':_0x3c3a87,'unit':_0x2200ce,'language':_0x22c960,'warehouses':warehouse_data,'rooms':_0x4bdadd});}catch(_0xef5727){console[_0x1042b6(0x284)](_0xef5727),_0x28ce1c[_0x1042b6(0x26f)](0xc8)[_0x1042b6(0x2cb)]({'message':_0xef5727[_0x1042b6(0x1f3)]});}}),router[a0_0x1628f6(0x209)]('/view/return_sales/:id',auth,async(_0x3dd816,_0x3938f3)=>{var _0x1c894b=a0_0x1628f6;try{const {invoice:_0x27a382,date:_0x5b3489,warehouse_name:_0x830045,product_name:_0x4f5574,primary_code:_0x32e7b7,secondary_code:_0x3083c9,product_code:_0x3f7872,sales_quantity:_0x2799ec,stocks:_0x3c99ef,return_qty:_0x5019f8,Room_name:_0x3ec979,to_warehouse_name:_0x2ec98a,to_Roomname:_0x2baa4a,to_Room_name:_0x2c2b8f,note:_0x141de9,level:_0x289f5e,isle:_0x4d4d2d,pallet:_0x25a981}=_0x3dd816[_0x1c894b(0x2e2)];if(typeof _0x4f5574==_0x1c894b(0x2e3))var _0x157ed5=[_0x3dd816['body'][_0x1c894b(0x2ea)]],_0x3bcfa3=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x21b)]],_0x394ee2=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x26b)]],_0x3e7a6b=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x23a)]],_0x1a79a3=[_0x3dd816['body'][_0x1c894b(0x280)]],_0x4047f9=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x25b)]],_0x122a9f=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x2bc)]],_0x3bd989=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x259)]],_0x113708=[_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x2b9)]],_0xe3f410=[_0x3dd816[_0x1c894b(0x2e2)]['types']],_0x4c102c=[_0x3dd816['body']['floorlevel']];else var _0x157ed5=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x2ea)]],_0x3bcfa3=[..._0x3dd816['body'][_0x1c894b(0x21b)]],_0x394ee2=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x26b)]],_0x3e7a6b=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x23a)]],_0x1a79a3=[..._0x3dd816['body'][_0x1c894b(0x280)]],_0x4047f9=[..._0x3dd816['body'][_0x1c894b(0x25b)]],_0x122a9f=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x2bc)]],_0x3bd989=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x259)]],_0x113708=[..._0x3dd816['body'][_0x1c894b(0x2b9)]],_0xe3f410=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x1f9)]],_0x4c102c=[..._0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x1ed)]];const _0x1ef41e=_0x157ed5[_0x1c894b(0x288)](_0x51453e=>{return _0x51453e={'product_name':_0x51453e};});_0x3bcfa3['forEach']((_0x1a2807,_0x3d3769)=>{var _0x583eaf=_0x1c894b;_0x1ef41e[_0x3d3769][_0x583eaf(0x21b)]=_0x1a2807;}),_0x394ee2[_0x1c894b(0x229)]((_0x308ce8,_0xe92869)=>{var _0xfa61dc=_0x1c894b;_0x1ef41e[_0xe92869][_0xfa61dc(0x26b)]=_0x308ce8;}),_0x3e7a6b['forEach']((_0x16a48d,_0x53277d)=>{_0x1ef41e[_0x53277d]['product_code']=_0x16a48d;}),_0x1a79a3['forEach']((_0x5f3fc4,_0x7ec2de)=>{var _0xf3891a=_0x1c894b;_0x1ef41e[_0x7ec2de][_0xf3891a(0x2a8)]=_0x5f3fc4;}),_0x4047f9[_0x1c894b(0x229)]((_0x536306,_0x5ac3bb)=>{var _0x1c74d3=_0x1c894b;_0x1ef41e[_0x5ac3bb][_0x1c74d3(0x218)]=_0x536306;}),_0x122a9f['forEach']((_0x143007,_0x1e722e)=>{var _0x561205=_0x1c894b;_0x1ef41e[_0x1e722e][_0x561205(0x2bc)]=_0x143007;}),_0x3bd989[_0x1c894b(0x229)]((_0x320136,_0x206f69)=>{var _0x20e956=_0x1c894b;_0x1ef41e[_0x206f69][_0x20e956(0x259)]=_0x320136;}),_0x113708[_0x1c894b(0x229)]((_0x4d0aeb,_0x4595de)=>{var _0x2807e6=_0x1c894b;_0x1ef41e[_0x4595de][_0x2807e6(0x2b9)]=_0x4d0aeb;}),_0xe3f410[_0x1c894b(0x229)]((_0x39b8fd,_0xf9cd3c)=>{_0x1ef41e[_0xf9cd3c]['type']=_0x39b8fd;}),_0x4c102c[_0x1c894b(0x229)]((_0x32e4d5,_0x48c742)=>{_0x1ef41e[_0x48c742]['floorlevel']=_0x32e4d5;});var _0x4f3ecf=0x0;_0x1ef41e[_0x1c894b(0x229)](_0x262d08=>{var _0x4850d7=_0x1c894b;console[_0x4850d7(0x284)](_0x4850d7(0x216),_0x262d08),(parseInt(_0x262d08[_0x4850d7(0x2a8)])<parseInt(_0x262d08['return_qty'])||parseInt(_0x262d08[_0x4850d7(0x218)])<parseInt(_0x262d08[_0x4850d7(0x2bc)])&&parseInt(_0x262d08['sale_qty'])>parseInt(_0x262d08[_0x4850d7(0x2bc)])||parseInt(_0x262d08[_0x4850d7(0x2bc)])==0x0)&&_0x4f3ecf++;});if(_0x4f3ecf!=0x0)return _0x3dd816[_0x1c894b(0x248)](_0x1c894b(0x2c9),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x3938f3[_0x1c894b(0x26d)](_0x1c894b(0x2ad));const _0x459b2a=await sales[_0x1c894b(0x22c)]({'invoice':_0x27a382});console[_0x1c894b(0x284)](_0x459b2a),_0x459b2a[_0x1c894b(0x274)]=_0x1c894b(0x222);const _0x4b9afa=await _0x459b2a[_0x1c894b(0x212)](),_0x5c6d9e=new sales_return({'invoice':_0x27a382,'customer':_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x200)],'date':_0x5b3489,'warehouse_name':_0x830045,'room':_0x3ec979,'ToWarehouse':_0x2ec98a,'ToRoom':_0x2c2b8f,'return_sale':_0x1ef41e,'note':_0x141de9}),_0x1f8320=await _0x5c6d9e[_0x1c894b(0x212)]();console[_0x1c894b(0x284)](_0x5c6d9e);const _0x427bf4=await sales_return[_0x1c894b(0x22c)]({'invoice':_0x27a382}),_0x4df2d2=await warehouse['findOne']({'name':_0x2ec98a,'room':_0x2c2b8f});_0x427bf4['return_sale'][_0x1c894b(0x229)](_0x4c8dd8=>{var _0x565a51=_0x1c894b,_0x4700f9=0x0;const _0x281760=_0x4df2d2[_0x565a51(0x243)][_0x565a51(0x288)](_0x11390d=>{var _0x36b1cb=_0x565a51;_0x11390d[_0x36b1cb(0x2ea)]==_0x4c8dd8[_0x36b1cb(0x2ea)]&&_0x11390d[_0x36b1cb(0x1ed)]==_0x4c8dd8[_0x36b1cb(0x1ed)]&&_0x11390d[_0x36b1cb(0x2c5)]==_0x4c8dd8['type']&&_0x11390d[_0x36b1cb(0x2b9)]==_0x4c8dd8[_0x36b1cb(0x2b9)]&&_0x11390d[_0x36b1cb(0x259)]==_0x4c8dd8['bay']&&(_0x11390d['product_stock']=parseInt(_0x11390d[_0x36b1cb(0x29a)])+parseInt(_0x4c8dd8[_0x36b1cb(0x2bc)]),_0x4700f9++);});_0x4700f9=='0'&&(_0x4df2d2[_0x565a51(0x243)]=_0x4df2d2[_0x565a51(0x243)][_0x565a51(0x2a6)]({'product_name':_0x4c8dd8[_0x565a51(0x2ea)],'product_stock':_0x4c8dd8[_0x565a51(0x2bc)],'primary_code':_0x4c8dd8['primary_code'],'secondary_code':_0x4c8dd8[_0x565a51(0x26b)],'product_code':_0x4c8dd8['product_code'],'bay':_0x4c8dd8['bay'],'bin':_0x4c8dd8['bin'],'type':_0x4c8dd8[_0x565a51(0x2c5)],'floorlevel':_0x4c8dd8[_0x565a51(0x1ed)]})),console[_0x565a51(0x284)](_0x565a51(0x2c8),_0x4df2d2);}),await _0x4df2d2[_0x1c894b(0x212)](),console[_0x1c894b(0x284)](_0x3dd816[_0x1c894b(0x2e2)]);const _0xfbbc58=new c_payment_data({'invoice':_0x27a382,'customer':_0x3dd816[_0x1c894b(0x2e2)]['customer'],'reason':_0x1c894b(0x21c)});await _0xfbbc58[_0x1c894b(0x212)]();const _0x599237=await master_shop[_0x1c894b(0x20c)]();console[_0x1c894b(0x284)](_0x1c894b(0x2b6),_0x599237[0x0][_0x1c894b(0x2e0)]);const _0x16219b=await email_settings[_0x1c894b(0x22c)](),_0x4193bd=await customer[_0x1c894b(0x22c)]({'name':_0x3dd816[_0x1c894b(0x2e2)][_0x1c894b(0x200)]});console['log'](_0x1c894b(0x2a4),_0x4193bd);_0x599237[0x0][_0x1c894b(0x1ee)]==0x1?(right_currency=_0x599237[0x0][_0x1c894b(0x271)],left_currency=''):(right_currency='',left_currency=_0x599237[0x0][_0x1c894b(0x271)]);var _0x46687a=_0x157ed5,_0x22b5bd=_0x122a9f,_0x26506c='',_0x358707;for(_0x358707 in _0x46687a){_0x26506c+=_0x1c894b(0x27d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x46687a[_0x358707]+'</td>'+_0x1c894b(0x2bb)+_0x22b5bd[_0x358707]+_0x1c894b(0x29e)+_0x1c894b(0x204);}console['log'](_0x1c894b(0x28f),_0x26506c);let _0x5cccf1=nodemailer[_0x1c894b(0x235)]({'service':_0x1c894b(0x219),'auth':{'user':_0x16219b[_0x1c894b(0x2f1)],'pass':_0x16219b[_0x1c894b(0x211)]}}),_0xb9242a={'from':_0x16219b[_0x1c894b(0x2f1)],'to':_0x4193bd[_0x1c894b(0x2f1)],'subject':_0x1c894b(0x289),'attachments':[{'filename':_0x1c894b(0x2b4),'path':__dirname+'/../public'+'/upload/'+_0x599237[0x0]['image'],'cid':_0x1c894b(0x1e7)}],'html':_0x1c894b(0x240)+'<html><head><title></title>'+'</head><body>'+_0x1c894b(0x2c0)+_0x1c894b(0x22e)+'<div>'+_0x1c894b(0x242)+_0x1c894b(0x24e)+'<div>'+_0x1c894b(0x257)+_0x599237[0x0][_0x1c894b(0x2cc)]+_0x1c894b(0x297)+'</div>'+'</div>'+_0x1c894b(0x24b)+_0x1c894b(0x2c0)+_0x1c894b(0x22b)+_0x1c894b(0x26c)+_0x27a382+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1c894b(0x277)+_0x5b3489+'\x20'+_0x1c894b(0x1ec)+'</h5>'+_0x1c894b(0x24e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1c894b(0x276)+'<tr>'+_0x1c894b(0x2de)+_0x1c894b(0x286)+_0x1c894b(0x2be)+_0x1c894b(0x245)+'</tr>'+_0x1c894b(0x214)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x26506c+'\x20'+_0x1c894b(0x221)+_0x1c894b(0x2d4)+_0x1c894b(0x2c0)+_0x1c894b(0x247)+'<h5>'+_0x599237[0x0][_0x1c894b(0x2cc)]+_0x1c894b(0x253)+_0x1c894b(0x24e)+'</div>'+_0x1c894b(0x2e6)};_0x5cccf1['sendMail'](_0xb9242a,function(_0x2dc3e9,_0x571203){var _0x117dee=_0x1c894b;_0x2dc3e9?(console[_0x117dee(0x284)](_0x2dc3e9),console[_0x117dee(0x284)](_0x117dee(0x22d))):console[_0x117dee(0x284)]('Email\x20sent\x20successfully');}),_0x3dd816['flash'](_0x1c894b(0x25f),_0x1c894b(0x262)),_0x3938f3[_0x1c894b(0x26d)]('/all_sales/view');}catch(_0x2c18f9){console['log'](_0x2c18f9),_0x3938f3[_0x1c894b(0x26f)](0xc8)['json']({'message1':_0x2c18f9[_0x1c894b(0x1f3)]});}}),router[a0_0x1628f6(0x28b)](a0_0x1628f6(0x202),auth,async(_0x2852c0,_0x26acd5)=>{var _0x110d01=a0_0x1628f6;try{const {username:_0x23f5b9,email:_0x59530e,role:_0x27a520}=_0x2852c0['user'],_0x5748e2=_0x2852c0['user'],_0x25e676=await profile['findOne']({'email':_0x5748e2['email']}),_0x2ca229=await master_shop[_0x110d01(0x20c)]();console[_0x110d01(0x284)](_0x110d01(0x21a),_0x2ca229);const _0x59c418=_0x2852c0[_0x110d01(0x256)]['id'],_0x47c8e3=await sales[_0x110d01(0x2cf)](_0x59c418);console['log']('barcode\x20user_id',_0x47c8e3);if(_0x2ca229[0x0][_0x110d01(0x23f)]=='English\x20(US)')var _0x1ac737=users[_0x110d01(0x24a)];else{if(_0x2ca229[0x0][_0x110d01(0x23f)]==_0x110d01(0x2a0))var _0x1ac737=users[_0x110d01(0x2a0)];else{if(_0x2ca229[0x0][_0x110d01(0x23f)]=='German')var _0x1ac737=users[_0x110d01(0x255)];else{if(_0x2ca229[0x0]['language']==_0x110d01(0x285))var _0x1ac737=users[_0x110d01(0x285)];else{if(_0x2ca229[0x0]['language']==_0x110d01(0x1f1))var _0x1ac737=users[_0x110d01(0x1f1)];else{if(_0x2ca229[0x0][_0x110d01(0x23f)]==_0x110d01(0x27a))var _0x1ac737=users[_0x110d01(0x24f)];else{if(_0x2ca229[0x0][_0x110d01(0x23f)]==_0x110d01(0x1e6))var _0x1ac737=users['Chinese'];else{if(_0x2ca229[0x0][_0x110d01(0x23f)]==_0x110d01(0x2bd))var _0x1ac737=users['Arabic'];}}}}}}}_0x26acd5[_0x110d01(0x278)]('all_sales_barcode',{'success':_0x2852c0['flash'](_0x110d01(0x25f)),'errors':_0x2852c0['flash'](_0x110d01(0x2c9)),'role':_0x5748e2,'profile':_0x25e676,'alldata':_0x47c8e3,'master_shop':_0x2ca229,'language':_0x1ac737});}catch(_0x36efae){console['log'](_0x36efae);}}),router[a0_0x1628f6(0x209)](a0_0x1628f6(0x27e),async(_0x358343,_0x455bbf)=>{var _0x18e40d=a0_0x1628f6;const {product_code:_0x2b1528,warehouse_name:_0x3c1361,rooms_data:_0x181785,Roomslist:_0x38c1fe}=_0x358343[_0x18e40d(0x2e2)],_0x1d1e84=_0x38c1fe[_0x18e40d(0x2aa)](','),_0x3f92e8=[];async function _0x12aa34(_0x3bbc2d){var _0x1e1c30=_0x18e40d;const _0x105bf3=await warehouse[_0x1e1c30(0x215)]([{'$match':{'name':_0x3c1361,'room':_0x3bbc2d}},{'$unwind':_0x1e1c30(0x2c3)},{'$match':{'product_details.primary_code':_0x2b1528}},{'$group':{'_id':_0x1e1c30(0x283),'name':{'$first':_0x1e1c30(0x258)},'product_stock':{'$first':_0x1e1c30(0x23d)},'primary_code':{'$first':_0x1e1c30(0x2b5)},'secondary_code':{'$first':_0x1e1c30(0x2a2)},'product_code':{'$first':_0x1e1c30(0x25c)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1e1c30(0x1f0)},'type':{'$first':_0x1e1c30(0x2c4)},'pallet':{'$first':_0x1e1c30(0x226)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1e1c30(0x241)},'storage':{'$first':_0x1e1c30(0x265)},'rack':{'$first':_0x1e1c30(0x1fc)},'expiry_date':{'$first':_0x1e1c30(0x236)},'production_date':{'$first':_0x1e1c30(0x231)},'maxPerUnit':{'$first':_0x1e1c30(0x1f6)},'batch_code':{'$first':_0x1e1c30(0x239)},'product_cat':{'$first':_0x1e1c30(0x282)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1e1c30(0x298)},'actual_qty':{'$first':_0x1e1c30(0x234)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x233058=await warehouse['aggregate']([{'$match':{'name':_0x3c1361,'room':_0x3bbc2d}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x2b1528}},{'$group':{'_id':_0x1e1c30(0x283),'name':{'$first':_0x1e1c30(0x258)},'product_stock':{'$first':_0x1e1c30(0x23d)},'primary_code':{'$first':_0x1e1c30(0x2b5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1e1c30(0x25c)},'level':{'$first':_0x1e1c30(0x2cd)},'isle':{'$first':_0x1e1c30(0x1f0)},'type':{'$first':_0x1e1c30(0x2c4)},'pallet':{'$first':_0x1e1c30(0x226)},'unit':{'$first':_0x1e1c30(0x1e3)},'secondary_unit':{'$first':_0x1e1c30(0x241)},'storage':{'$first':_0x1e1c30(0x265)},'rack':{'$first':_0x1e1c30(0x1fc)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1e1c30(0x231)},'maxPerUnit':{'$first':_0x1e1c30(0x1f6)},'batch_code':{'$first':_0x1e1c30(0x239)},'product_cat':{'$first':_0x1e1c30(0x282)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1e1c30(0x298)}}}]);if(_0x105bf3['length']>0x0)_0x3f92e8[_0x1e1c30(0x25d)](_0x105bf3);else _0x233058[_0x1e1c30(0x2ac)]>0x0&&_0x3f92e8[_0x1e1c30(0x25d)](_0x233058);}const _0x510741=_0x1d1e84[_0x18e40d(0x288)](_0xabf874=>_0x12aa34(_0xabf874));await Promise[_0x18e40d(0x295)](_0x510741),_0x455bbf[_0x18e40d(0x2cb)](_0x3f92e8);}),module['exports']=router;