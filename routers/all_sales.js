var a0_0x4734cd=a0_0x2fc0;(function(_0x482dce,_0x1c7699){var _0x4072df=a0_0x2fc0,_0x31ca19=_0x482dce();while(!![]){try{var _0x30544b=parseInt(_0x4072df(0x2cb))/0x1*(-parseInt(_0x4072df(0x277))/0x2)+-parseInt(_0x4072df(0x230))/0x3*(parseInt(_0x4072df(0x225))/0x4)+parseInt(_0x4072df(0x2d8))/0x5*(-parseInt(_0x4072df(0x1e1))/0x6)+-parseInt(_0x4072df(0x1fc))/0x7*(parseInt(_0x4072df(0x2b4))/0x8)+-parseInt(_0x4072df(0x1ea))/0x9*(parseInt(_0x4072df(0x2a7))/0xa)+parseInt(_0x4072df(0x21f))/0xb*(-parseInt(_0x4072df(0x286))/0xc)+parseInt(_0x4072df(0x1f0))/0xd*(parseInt(_0x4072df(0x23c))/0xe);if(_0x30544b===_0x1c7699)break;else _0x31ca19['push'](_0x31ca19['shift']());}catch(_0x3223fd){_0x31ca19['push'](_0x31ca19['shift']());}}}(a0_0xe314,0xdd84b));const express=require(a0_0x4734cd(0x23d)),app=express(),router=express[a0_0x4734cd(0x273)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4734cd(0x215)),auth=require(a0_0x4734cd(0x233)),nodemailer=require(a0_0x4734cd(0x2a1)),users=require(a0_0x4734cd(0x1d1));router[a0_0x4734cd(0x200)]('/view',auth,async(_0x2092fa,_0x23fb83)=>{var _0x5e7c2d=a0_0x4734cd;try{const {username:_0x1751c6,email:_0x3a5f52,role:_0x299c01}=_0x2092fa['user'],_0x61d355=_0x2092fa['user'],_0x58454d=await profile[_0x5e7c2d(0x266)]({'email':_0x61d355[_0x5e7c2d(0x2b1)]}),_0x150653=await master_shop[_0x5e7c2d(0x226)]();let _0x4edc4b;if(_0x61d355[_0x5e7c2d(0x2bf)]=='staff'){const _0xdae170=await staff[_0x5e7c2d(0x266)]({'email':_0x61d355['email']});_0x4edc4b=await sales['aggregate']([{'$lookup':{'from':_0x5e7c2d(0x2a0),'localField':_0x5e7c2d(0x25a),'foreignField':_0x5e7c2d(0x26f),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5e7c2d(0x1fb),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x5e7c2d(0x28f)},'warehouse_name':{'$first':_0x5e7c2d(0x1d7)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5e7c2d(0x1e6)},'return_data':{'$first':_0x5e7c2d(0x1cd)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x5e7c2d(0x2b8)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5e7c2d(0x25c)},'isAllowEdit':{'$first':_0x5e7c2d(0x20a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x4edc4b=await sales[_0x5e7c2d(0x20d)]([{'$lookup':{'from':'customers','localField':_0x5e7c2d(0x25a),'foreignField':_0x5e7c2d(0x26f),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x5e7c2d(0x2b2)},{'$group':{'_id':_0x5e7c2d(0x1fb),'invoice':{'$first':_0x5e7c2d(0x28a)},'customers':{'$first':'$customer'},'date':{'$first':_0x5e7c2d(0x28f)},'warehouse_name':{'$first':_0x5e7c2d(0x1d7)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5e7c2d(0x1e6)},'return_data':{'$first':_0x5e7c2d(0x1cd)},'customers_docs':{'$first':_0x5e7c2d(0x239)},'total_saleproduct_quantity':{'$sum':_0x5e7c2d(0x2b8)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x5e7c2d(0x2a2)},'type':{'$addToSet':_0x5e7c2d(0x1dd)},'pallet':{'$addToSet':_0x5e7c2d(0x1e3)},'finalize':{'$first':_0x5e7c2d(0x25c)},'isAllowEdit':{'$first':_0x5e7c2d(0x20a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5e7c2d(0x1e9)](_0x5e7c2d(0x1f1),_0x4edc4b);if(_0x150653[0x0][_0x5e7c2d(0x29a)]==_0x5e7c2d(0x27e)){var _0x12b12a=users[_0x5e7c2d(0x263)];console['log'](_0x12b12a);}else{if(_0x150653[0x0]['language']=='Hindi')var _0x12b12a=users[_0x5e7c2d(0x27a)];else{if(_0x150653[0x0][_0x5e7c2d(0x29a)]==_0x5e7c2d(0x1fd))var _0x12b12a=users[_0x5e7c2d(0x1fd)];else{if(_0x150653[0x0][_0x5e7c2d(0x29a)]==_0x5e7c2d(0x234))var _0x12b12a=users[_0x5e7c2d(0x234)];else{if(_0x150653[0x0]['language']==_0x5e7c2d(0x1cb))var _0x12b12a=users[_0x5e7c2d(0x1cb)];else{if(_0x150653[0x0][_0x5e7c2d(0x29a)]==_0x5e7c2d(0x2dd))var _0x12b12a=users[_0x5e7c2d(0x2d7)];else{if(_0x150653[0x0][_0x5e7c2d(0x29a)]=='Chinese')var _0x12b12a=users[_0x5e7c2d(0x271)];else{if(_0x150653[0x0][_0x5e7c2d(0x29a)]=='Arabic\x20(ae)')var _0x12b12a=users[_0x5e7c2d(0x1f8)];}}}}}}}_0x23fb83['render'](_0x5e7c2d(0x294),{'success':_0x2092fa[_0x5e7c2d(0x1e0)]('success'),'errors':_0x2092fa[_0x5e7c2d(0x1e0)](_0x5e7c2d(0x2e2)),'sales':_0x4edc4b,'profile':_0x58454d,'role':_0x61d355,'master_shop':_0x150653,'language':_0x12b12a});}catch(_0x2bb696){console[_0x5e7c2d(0x1e9)](_0x2bb696);}});function a0_0xe314(){var _0x15f14f=['isAllowEdit','/barcode/:id','$product_details.isle','$product_details.bin','Enclosed','11RhfmsE','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Return\x20Rooms','True','/upload/','prod_code','4FacPjh','find','getMonth','Receiving\x20Area','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','OUT-','Sale\x20Return\x20Mail','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.secondary_unit','gmail','5034756lsTnRN','params','RoomAssigned','../middleware/auth','Spanish','add_sales','return_qty','$product_details.product_name','/view/add_sale/product','$customers_docs','stock','invoice','4699492COBCYR','express','Sale\x20Return','/view/:id','actual_qty','_id','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','maxperunit','string','logo','staff','findById','Sales\x20Update\x20successfully','/barcode_scanner','final','received_amount','product_details','edit_sales','There\x27s\x20a\x20error\x20in\x20this\x20transaction','An\x20error\x20occurred.','$product_details.primary_code','<div>','$product_details.storage','$product_details.secondary_code','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','status','max','map','customer','$product_details.expiry_date','$finalize','stocks','Enabled','storage','bin','type','</div>','English','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','findOne','port','unit','<tbody\x20style=\x22text-align:\x20center;\x22>','<h5>','json','<!DOCTYPE\x20html>','Return\x20Goods','$product.product_name','name','/view/add_sales','Chinese','$name','Router','image','Raw\x20Materials','expiry_date','4ogXxVK','</tr>','sales\x20item\x20return\x20successfull','Hindi','Shelves','secondary_code','barcode\x20user_id','English\x20(US)','then','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product','Received\x20Payment\x20For\x20Sale','</head><body>','sales_invoice','761952ZBrQVz','level','post','sendMail','$invoice','$product_details.rack','product_list','product_stock','Email\x20sent\x20successfully','$date','edit_sales_view','body','currency_placement','/give_payment/:id','all_sales','$product_details.product_code','</tbody>','delivery_date','$product_details.maxPerUnit','room','language','quantity','note','Floor','Sales\x20Mail','/../public','customers','nodemailer','$sale_product.bin','bay','/view/add_sales/:id','user_id','primary_code','3217240aoXAKf','finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</td>','Arabic\x20(ae)','rack','$product_details.bay','all','actual_uom','email','$sale_product','push','8YPIght','secondary_unit','/view/return_sales/:id','$product_details._id','$sale_product.quantity','primary_unit','\x20</h2>','Level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','floor','sales_quantity','role','back','$product_details.pallet','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','exports','render','password','warehouse_name','$product_details.level','requested_qty','delivery_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','479855auDpMu','padStart','error','return_sale','$product_details.actual_uom','$product_details.batch_code','room_name','/invoice/:id','toString','getDate','product_data','floorlevel','Portuguese','10pfNhmr','False','product_name','site_title','redirect','Portuguese\x20(BR)','warehouse','Sales\x20Add\x20successfully','batch_code','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','errors','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<strong>\x20Regards\x20</strong>','French','abs','$return_data','createTransport','$product_details.product_cat','$room','../public/language/languages.json','<h2>\x20','\x20Order\x20Date\x20:\x20','</h5>','</thead>','sale_qty','$warehouse_name','purchases_data','quantity_notConverted','currency','</body></html>','/preview/:id','$sale_product.type','$product_details.actual_qty','user','flash','3417222mJMFhS','/all_sales/view','$sale_product.floorlevel','barcode\x20Product\x20master','types','$note','$product_details.invoice','prod_cat','log','36xtsqBg','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.type','host','/all_sales/preview/','date','260gGQVPJ','sales\x20all_data','max_per_unit','random','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details','$product_details.unit','success','Arabic','forEach','concat','$_id','4751551EBNbWY','German','prod_invoice','save','get','Logo.png','foreach\x20newproduct','<hr\x20class=\x22my-3\x22>','$product_details.production_date','message','Ambient','<span\x20style=\x22float:\x20right;\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<tr>','$isAllowEdit','filter','catch','aggregate','customer_data','return_data','stock_data','slice','add\x20post','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','../models/all_models','production_date','$product_details.product_stock','Error\x20Occurs','$product_details.floorlevel'];a0_0xe314=function(){return _0x15f14f;};return a0_0xe314();}async function getRandom8DigitNumber(){var _0x22db1e=a0_0x4734cd;const _0xa32359=0x989680,_0x5ad7de=0x5f5e0ff,_0x5ea65e=Math[_0x22db1e(0x2bd)](Math[_0x22db1e(0x1f3)]()*(_0x5ad7de-_0xa32359+0x1))+_0xa32359;var _0x59874b;const _0x154ca3=await sales[_0x22db1e(0x266)]({'invoice':_0x22db1e(0x22a)+_0x5ea65e});return _0x154ca3&&_0x154ca3[_0x22db1e(0x264)]>0x0?_0x59874b=_0x22db1e(0x22a)+_0x5ea65e:_0x59874b=_0x22db1e(0x22a)+_0x5ea65e,_0x59874b;}function a0_0x2fc0(_0x4c6f46,_0x6b410a){var _0xe314c4=a0_0xe314();return a0_0x2fc0=function(_0x2fc06e,_0x3525df){_0x2fc06e=_0x2fc06e-0x1c9;var _0x377e89=_0xe314c4[_0x2fc06e];return _0x377e89;},a0_0x2fc0(_0x4c6f46,_0x6b410a);}router[a0_0x4734cd(0x200)]('/view/add_sales',auth,async(_0x4393cb,_0x403c84)=>{var _0x1237bf=a0_0x4734cd;try{const {username:_0x5295f6,email:_0x9fcac0,role:_0x5e9df9}=_0x4393cb['user'],_0x24f802=_0x4393cb['user'],_0x238d3c=await profile[_0x1237bf(0x266)]({'email':_0x24f802[_0x1237bf(0x2b1)]}),_0x4e02af=await master_shop[_0x1237bf(0x226)](),_0x215caf=await customer[_0x1237bf(0x226)]({});let _0x4c1244;if(_0x24f802[_0x1237bf(0x2bf)]=='staff'){const _0x5bcf3b=await staff[_0x1237bf(0x266)]({'email':_0x24f802[_0x1237bf(0x2b1)]});_0x4c1244=await warehouse[_0x1237bf(0x20d)]([{'$match':{'status':_0x1237bf(0x25e),'name':_0x5bcf3b[_0x1237bf(0x2de)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1237bf(0x26d)}}},{'$group':{'_id':_0x1237bf(0x272),'name':{'$first':_0x1237bf(0x272)}}},{'$sort':{'name':0x1}}]);}else _0x4c1244=await warehouse['aggregate']([{'$match':{'status':_0x1237bf(0x25e),'warehouse_category':_0x1237bf(0x275),'name':{'$ne':_0x1237bf(0x26d)}}},{'$group':{'_id':'$name','name':{'$first':_0x1237bf(0x272)}}},{'$sort':{'name':0x1}}]);const _0x2fbe94=await product[_0x1237bf(0x226)]({});var _0x19bebf=[_0x1237bf(0x206),_0x1237bf(0x21e)];const _0x4d9b9b=await sales[_0x1237bf(0x226)]({}),_0x2b2809=_0x4d9b9b[_0x1237bf(0x264)]+0x1,_0x5e98b7=_0x1237bf(0x22a)+_0x2b2809[_0x1237bf(0x2d3)]()[_0x1237bf(0x2cc)](0x5,'0');if(_0x4e02af[0x0][_0x1237bf(0x29a)]==_0x1237bf(0x27e)){var _0x2d38d9=users[_0x1237bf(0x263)];console[_0x1237bf(0x1e9)](_0x2d38d9);}else{if(_0x4e02af[0x0]['language']==_0x1237bf(0x27a))var _0x2d38d9=users[_0x1237bf(0x27a)];else{if(_0x4e02af[0x0][_0x1237bf(0x29a)]==_0x1237bf(0x1fd))var _0x2d38d9=users[_0x1237bf(0x1fd)];else{if(_0x4e02af[0x0]['language']==_0x1237bf(0x234))var _0x2d38d9=users[_0x1237bf(0x234)];else{if(_0x4e02af[0x0]['language']=='French')var _0x2d38d9=users['French'];else{if(_0x4e02af[0x0][_0x1237bf(0x29a)]==_0x1237bf(0x2dd))var _0x2d38d9=users[_0x1237bf(0x2d7)];else{if(_0x4e02af[0x0][_0x1237bf(0x29a)]==_0x1237bf(0x271))var _0x2d38d9=users['Chinese'];else{if(_0x4e02af[0x0][_0x1237bf(0x29a)]=='Arabic\x20(ae)')var _0x2d38d9=users[_0x1237bf(0x1f8)];}}}}}}}const _0x356de5=getRandom8DigitNumber();_0x356de5['then'](_0x34fc76=>{var _0x48a89f=_0x1237bf;_0x403c84[_0x48a89f(0x2c4)](_0x48a89f(0x235),{'success':_0x4393cb[_0x48a89f(0x1e0)](_0x48a89f(0x1f7)),'errors':_0x4393cb['flash'](_0x48a89f(0x2e2)),'role':_0x24f802,'profile':_0x238d3c,'customer':_0x215caf,'warehouse':_0x4c1244,'product':_0x2fbe94,'invoice':_0x34fc76,'master_shop':_0x4e02af,'language':_0x2d38d9,'rooms_data':_0x19bebf});})['catch'](_0x3aa98b=>{var _0x491a9b=_0x1237bf;_0x4393cb[_0x491a9b(0x1e0)](_0x491a9b(0x2e2),_0x491a9b(0x24f)),_0x403c84[_0x491a9b(0x2dc)](_0x491a9b(0x1e2));});}catch(_0x44ebdd){console[_0x1237bf(0x1e9)](_0x44ebdd);}}),router[a0_0x4734cd(0x200)](a0_0x4734cd(0x2a4),auth,async(_0x215e8b,_0x5ba025)=>{var _0x1746bc=a0_0x4734cd;try{const _0x506785=_0x215e8b[_0x1746bc(0x231)]['id'];console[_0x1746bc(0x1e9)](_0x506785);const _0x2e6800=await product[_0x1746bc(0x226)](),_0x349b4a=await purchases[_0x1746bc(0x20d)]([{'$match':{'warehouse_name':_0x506785}},{'$unwind':_0x1746bc(0x282)},{'$group':{'_id':_0x1746bc(0x26e)}}]);console[_0x1746bc(0x1e9)](_0x1746bc(0x1d8),_0x349b4a),_0x5ba025[_0x1746bc(0x257)](0xc8)[_0x1746bc(0x26b)]({'purchases_data':_0x349b4a,'product_data':_0x2e6800});}catch(_0x5e740a){console['log'](_0x5e740a);}}),router[a0_0x4734cd(0x288)](a0_0x4734cd(0x238),auth,async(_0x578460,_0x588abd)=>{var _0x53ec45=a0_0x4734cd;try{const {warehouse_data:_0x313a21,product_data:_0x5037e6}=_0x578460['body'];console[_0x53ec45(0x1e9)](_0x578460['body'][_0x53ec45(0x2d5)]);;const _0x4381a7=await master_shop[_0x53ec45(0x226)]();console[_0x53ec45(0x1e9)](_0x53ec45(0x280),_0x4381a7);const _0x57f948=await product[_0x53ec45(0x266)]({'name':_0x5037e6});console[_0x53ec45(0x1e9)]('product',_0x57f948);const _0x35c058=await warehouse[_0x53ec45(0x20d)]([{'$match':{'name':_0x313a21}},{'$unwind':_0x53ec45(0x1f5)},{'$match':{'product_details.product_name':_0x5037e6}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x53ec45(0x1e9)](_0x53ec45(0x210),_0x35c058),_0x588abd[_0x53ec45(0x257)](0xc8)[_0x53ec45(0x26b)]({'master':_0x4381a7,'new_product':_0x57f948,'stock_data':_0x35c058});}catch(_0x5564d0){console[_0x53ec45(0x1e9)](_0x5564d0);}}),router['post'](a0_0x4734cd(0x270),auth,async(_0x40b3e0,_0x5af276)=>{var _0x2ed009=a0_0x4734cd;try{const {invoice:_0xb56111,date:_0x3951dd,warehouse_name:_0x15d8d1,product_name:_0x568530,stock:_0x116dde,quantity:_0x40af25,note:_0x387d91,room:_0x20fcb0,primary_code:_0x250592,secondary_code:_0x70d301,prod_code:_0x227cb3,level:_0x69a38,isle:_0x407df3,pallet:_0x1d950f,batch_code:_0x172a75,SCRN:_0x154965,expiry_date:_0x38567b}=_0x40b3e0['body'];if(typeof _0x568530==_0x2ed009(0x245))var _0x5e9e35=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2da)]],_0x39654e=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x23a)]],_0x41c9f0=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x213)]],_0x10d3db=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2a6)]],_0x19bfd0=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x27c)]],_0x4f49da=[_0x40b3e0['body']['prod_code']],_0x2cd2d6=[_0x40b3e0['body'][_0x2ed009(0x287)]],_0x1f0f6c=[_0x40b3e0['body']['primary_unit']],_0x459e40=[_0x40b3e0['body'][_0x2ed009(0x2b5)]],_0x23855f=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2e0)]],_0x5ad296=[_0x40b3e0[_0x2ed009(0x291)]['expiry_date']],_0xb0c59a=[_0x40b3e0['body'][_0x2ed009(0x1f2)]],_0xcdb46e=[_0x40b3e0['body'][_0x2ed009(0x216)]],_0x22aeff=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2c8)]],_0x3b75eb=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x297)]],_0x30ea6f=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2c9)]],_0x31ce83=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x1e8)]],_0x5196f2=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x29b)]],_0x3b22c9=[_0x40b3e0['body'][_0x2ed009(0x232)]],_0x12c2ac=[_0x40b3e0[_0x2ed009(0x291)]['prod_invoice']],_0x192053=[_0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x240)]],_0x46f179=[_0x40b3e0[_0x2ed009(0x291)]['actual_uom']];else var _0x5e9e35=[..._0x40b3e0[_0x2ed009(0x291)]['product_name']],_0x39654e=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x23a)]],_0x41c9f0=[..._0x40b3e0[_0x2ed009(0x291)]['carton']],_0x10d3db=[..._0x40b3e0[_0x2ed009(0x291)]['primary_code']],_0x19bfd0=[..._0x40b3e0[_0x2ed009(0x291)]['secondary_code']],_0x4f49da=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x224)]],_0x2cd2d6=[..._0x40b3e0[_0x2ed009(0x291)]['level']],_0x1f0f6c=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2b9)]],_0x459e40=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2b5)]],_0x23855f=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2e0)]],_0x5ad296=[..._0x40b3e0[_0x2ed009(0x291)]['expiry_date']],_0xb0c59a=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x1f2)]],_0xcdb46e=[..._0x40b3e0[_0x2ed009(0x291)]['production_date']],_0x22aeff=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2c8)]],_0x3b75eb=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x297)]],_0x30ea6f=[..._0x40b3e0['body'][_0x2ed009(0x2c9)]],_0x31ce83=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x1e8)]],_0x5196f2=[..._0x40b3e0['body'][_0x2ed009(0x29b)]],_0x3b22c9=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x232)]],_0x12c2ac=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x1fe)]],_0x192053=[..._0x40b3e0['body']['actual_qty']],_0x46f179=[..._0x40b3e0[_0x2ed009(0x291)][_0x2ed009(0x2b0)]];const _0x255b6e=_0x5e9e35[_0x2ed009(0x259)](_0x2574e1=>{return _0x2574e1={'product_name':_0x2574e1};});_0x39654e[_0x2ed009(0x1f9)]((_0x1e45ae,_0x592609)=>{var _0x27ee73=_0x2ed009;_0x255b6e[_0x592609][_0x27ee73(0x23a)]=Math[_0x27ee73(0x1cc)](_0x1e45ae);}),_0x192053[_0x2ed009(0x1f9)]((_0x5ad356,_0x372259)=>{var _0x8ba3ae=_0x2ed009;_0x255b6e[_0x372259]['actual_qty']=Math[_0x8ba3ae(0x1cc)](_0x5ad356);}),_0x46f179[_0x2ed009(0x1f9)]((_0x591950,_0xbc70d9)=>{var _0x4152f9=_0x2ed009;_0x255b6e[_0xbc70d9][_0x4152f9(0x2b0)]=_0x591950;}),_0x41c9f0[_0x2ed009(0x1f9)]((_0x2e9ba7,_0x3095af)=>{_0x255b6e[_0x3095af]['quantity']=_0x2e9ba7;}),_0x10d3db[_0x2ed009(0x1f9)]((_0x56ec64,_0x49e191)=>{var _0x5b3745=_0x2ed009;_0x255b6e[_0x49e191][_0x5b3745(0x2a6)]=_0x56ec64;}),_0x19bfd0['forEach']((_0xa61816,_0x482df8)=>{_0x255b6e[_0x482df8]['secondary_code']=_0xa61816;}),_0x4f49da[_0x2ed009(0x1f9)]((_0x37c2dc,_0x302db2)=>{var _0x285cd7=_0x2ed009;_0x255b6e[_0x302db2][_0x285cd7(0x255)]=_0x37c2dc;}),_0x2cd2d6[_0x2ed009(0x1f9)]((_0x576068,_0x5b1e48)=>{var _0x2b27cf=_0x2ed009;_0x3b22c9[_0x2b27cf(0x1f9)]((_0x5ba28d,_0x472a06)=>{var _0x2bf4a4=_0x2b27cf;if(_0x5ba28d=='Receiving\x20Area'&&_0x5b1e48==_0x472a06){var _0x1a9256=_0x576068[_0x2bf4a4(0x211)](0x3);_0x255b6e[_0x5b1e48]['storage']=_0x576068[0x0],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2ad)]=_0x576068[0x1],_0x255b6e[_0x5b1e48]['bay']=0x0,_0x255b6e[_0x5b1e48][_0x2bf4a4(0x260)]=0x0,_0x255b6e[_0x5b1e48]['type']=_0x2bf4a4(0x29d),_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2d6)]=_0x1a9256;}else{if(_0x5ba28d==_0x2bf4a4(0x27b)&&_0x5b1e48==_0x472a06){var _0x1a9256=_0x576068[_0x2bf4a4(0x211)](0x3);_0x255b6e[_0x5b1e48][_0x2bf4a4(0x25f)]=_0x576068[0x0],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2ad)]=_0x576068[0x1],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2a3)]=0x0,_0x255b6e[_0x5b1e48][_0x2bf4a4(0x260)]=0x0,_0x255b6e[_0x5b1e48][_0x2bf4a4(0x261)]=_0x2bf4a4(0x29d),_0x255b6e[_0x5b1e48]['floorlevel']=_0x576068[0x5];}else{if(_0x5b1e48==_0x472a06){var _0x8b49c4;if(_0x576068[0x4]=='L')_0x8b49c4=_0x2bf4a4(0x2bb);else _0x576068[0x4]=='F'&&(_0x8b49c4='Floor');_0x255b6e[_0x5b1e48]['storage']=_0x576068[0x0],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2ad)]=_0x576068[0x1],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2a3)]=_0x576068[0x2],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x260)]=_0x576068[0x3],_0x255b6e[_0x5b1e48][_0x2bf4a4(0x261)]=_0x8b49c4,_0x255b6e[_0x5b1e48][_0x2bf4a4(0x2d6)]=_0x576068[0x5];}}}});}),_0x1f0f6c[_0x2ed009(0x1f9)]((_0x1f7577,_0x325eed)=>{var _0xd7fe48=_0x2ed009;_0x255b6e[_0x325eed][_0xd7fe48(0x268)]=_0x1f7577;}),_0x459e40['forEach']((_0x116e2e,_0x1cf734)=>{var _0xa9349b=_0x2ed009;_0x255b6e[_0x1cf734][_0xa9349b(0x2b5)]=_0x116e2e;}),_0x23855f[_0x2ed009(0x1f9)]((_0x257fee,_0x260656)=>{var _0x513ab8=_0x2ed009;_0x255b6e[_0x260656][_0x513ab8(0x2e0)]=_0x257fee;}),_0x5ad296['forEach']((_0x372c21,_0x18291)=>{var _0x7b6cbb=_0x2ed009;_0x255b6e[_0x18291][_0x7b6cbb(0x276)]=_0x372c21;}),_0xb0c59a[_0x2ed009(0x1f9)]((_0x4e1f55,_0x1241c7)=>{var _0x248efe=_0x2ed009;_0x255b6e[_0x1241c7][_0x248efe(0x244)]=_0x4e1f55;}),_0xcdb46e['forEach']((_0x5c6607,_0x23cd9b)=>{var _0x38bc29=_0x2ed009;_0x255b6e[_0x23cd9b][_0x38bc29(0x216)]=_0x5c6607;}),_0x22aeff['forEach']((_0x5c8ebf,_0xaf4be1)=>{var _0x2da6a0=_0x2ed009;_0x255b6e[_0xaf4be1][_0x2da6a0(0x2c8)]=_0x5c8ebf;}),_0x3b75eb[_0x2ed009(0x1f9)]((_0x30478a,_0xce4555)=>{var _0x5da115=_0x2ed009;_0x255b6e[_0xce4555][_0x5da115(0x297)]=_0x30478a;}),_0x30ea6f[_0x2ed009(0x1f9)]((_0x2b9da0,_0x20b5a5)=>{var _0x4c8eae=_0x2ed009;_0x255b6e[_0x20b5a5][_0x4c8eae(0x2c9)]=_0x2b9da0;}),_0x31ce83['forEach']((_0x3ed371,_0x34de5e)=>{_0x255b6e[_0x34de5e]['prod_cat']=_0x3ed371;}),_0x5196f2[_0x2ed009(0x1f9)]((_0x1300b0,_0x5175ef)=>{var _0x5d6113=_0x2ed009;_0x255b6e[_0x5175ef][_0x5d6113(0x1d9)]=_0x1300b0;}),_0x3b22c9[_0x2ed009(0x1f9)]((_0x46977f,_0x184cc8)=>{_0x255b6e[_0x184cc8]['room_name']=_0x46977f;}),_0x12c2ac[_0x2ed009(0x1f9)]((_0x38559d,_0x5a77ec)=>{var _0x81ccbc=_0x2ed009;_0x255b6e[_0x5a77ec][_0x81ccbc(0x23b)]=_0x38559d;});var _0x50963c=0x0;_0x255b6e['forEach'](_0x4f1aab=>{var _0x4d95c6=_0x2ed009;(_0x4f1aab[_0x4d95c6(0x23a)]<_0x4f1aab[_0x4d95c6(0x1d9)]||_0x4f1aab[_0x4d95c6(0x1d9)]==0x0)&&(console['log'](_0x4d95c6(0x202),_0x4f1aab),_0x50963c++);});const _0x1f2afc=_0x255b6e[_0x2ed009(0x20b)](_0x48e5af=>_0x48e5af[_0x2ed009(0x29b)]!=='0'&&_0x48e5af['quantity']!==''),_0x5bed4b=new sales({'invoice':_0xb56111,'customer':_0x40b3e0['body']['customer'],'date':_0x3951dd,'warehouse_name':_0x15d8d1,'sale_product':_0x1f2afc,'note':_0x387d91,'room':_0x20fcb0,'primary_code':_0x250592,'secondary_code':_0x70d301,'prod_code':_0x227cb3,'SCRN':_0x154965}),_0x480f55=await _0x5bed4b[_0x2ed009(0x1ff)]();_0x40b3e0[_0x2ed009(0x1e0)](_0x2ed009(0x1f7),_0x2ed009(0x2df)),_0x5af276[_0x2ed009(0x2dc)](_0x2ed009(0x1ee)+_0x480f55[_0x2ed009(0x241)]);}catch(_0x5976ad){console[_0x2ed009(0x1e9)](_0x5976ad);}}),router['get'](a0_0x4734cd(0x1dc),auth,async(_0x3b133f,_0xc06d5)=>{var _0x17e4ab=a0_0x4734cd;try{const {username:_0x47985a,email:_0x3bf795,role:_0x40b3e9}=_0x3b133f[_0x17e4ab(0x1df)],_0x418f22=_0x3b133f[_0x17e4ab(0x1df)],_0x30d11e=await profile[_0x17e4ab(0x266)]({'email':_0x418f22[_0x17e4ab(0x2b1)]}),_0x3e6b41=await master_shop[_0x17e4ab(0x226)](),_0xf8f743=_0x3b133f[_0x17e4ab(0x231)]['id'],_0x316fbd=await sales[_0x17e4ab(0x248)](_0xf8f743),_0x499739=await warehouse['aggregate']([{'$match':{'name':_0x316fbd[_0x17e4ab(0x2c6)]}},{'$unwind':_0x17e4ab(0x1f5)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x17e4ab(0x237)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x17e4ab(0x2ae)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x17e4ab(0x1ec)},'floorlevel':{'$first':_0x17e4ab(0x219)},'primary_code':{'$first':_0x17e4ab(0x251)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x17e4ab(0x253)},'rack':{'$first':_0x17e4ab(0x28b)},'expiry_date':{'$first':_0x17e4ab(0x25b)},'production_date':{'$first':_0x17e4ab(0x204)},'invoice':{'$first':_0x17e4ab(0x1e7)}}}]),_0x558623=await customer[_0x17e4ab(0x226)]({});let _0x3f9e47;if(_0x418f22[_0x17e4ab(0x2bf)]==_0x17e4ab(0x247)){const _0x40364f=await staff[_0x17e4ab(0x266)]({'email':_0x418f22[_0x17e4ab(0x2b1)]});_0x3f9e47=await warehouse[_0x17e4ab(0x20d)]([{'$match':{'status':'Enabled','name':_0x40364f[_0x17e4ab(0x2de)]}},{'$group':{'_id':_0x17e4ab(0x272),'name':{'$first':_0x17e4ab(0x272)}}}]);}else _0x3f9e47=await warehouse[_0x17e4ab(0x20d)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x17e4ab(0x272),'name':{'$first':_0x17e4ab(0x272)}}}]);const _0x487db8=await product['find']({}),_0x3f4948=await suppliers['find']({});if(_0x3e6b41[0x0]['language']==_0x17e4ab(0x27e)){var _0x30bf51=users[_0x17e4ab(0x263)];console['log'](_0x30bf51);}else{if(_0x3e6b41[0x0][_0x17e4ab(0x29a)]==_0x17e4ab(0x27a))var _0x30bf51=users[_0x17e4ab(0x27a)];else{if(_0x3e6b41[0x0][_0x17e4ab(0x29a)]=='German')var _0x30bf51=users['German'];else{if(_0x3e6b41[0x0]['language']==_0x17e4ab(0x234))var _0x30bf51=users[_0x17e4ab(0x234)];else{if(_0x3e6b41[0x0]['language']==_0x17e4ab(0x1cb))var _0x30bf51=users['French'];else{if(_0x3e6b41[0x0]['language']=='Portuguese\x20(BR)')var _0x30bf51=users[_0x17e4ab(0x2d7)];else{if(_0x3e6b41[0x0]['language']==_0x17e4ab(0x271))var _0x30bf51=users[_0x17e4ab(0x271)];else{if(_0x3e6b41[0x0][_0x17e4ab(0x29a)]==_0x17e4ab(0x2ac))var _0x30bf51=users[_0x17e4ab(0x1f8)];}}}}}}}_0xc06d5['render'](_0x17e4ab(0x290),{'success':_0x3b133f['flash']('success'),'errors':_0x3b133f[_0x17e4ab(0x1e0)](_0x17e4ab(0x2e2)),'role':_0x418f22,'profile':_0x30d11e,'customer':_0x558623,'warehouse':_0x3f9e47,'product':_0x499739,'user':_0x316fbd,'master_shop':_0x3e6b41,'unit':_0x487db8,'language':_0x30bf51,'suppliers':_0x3f4948});}catch(_0x4c48c1){console['log'](_0x4c48c1);}}),router[a0_0x4734cd(0x288)](a0_0x4734cd(0x1dc),auth,async(_0x4002d6,_0x47873d)=>{var _0x2f52af=a0_0x4734cd;try{const _0x11860e=_0x4002d6[_0x2f52af(0x231)]['id'],{invoice:_0x353a77,warehouse_name:_0x3e8e65,room:_0x301f39}=_0x4002d6[_0x2f52af(0x291)],_0x5d7952=await sales['findOne']({'invoice':_0x353a77}),_0x2df493=_0x5d7952['sale_product'][_0x2f52af(0x259)](async _0x59d084=>{var _0x37cf3f=_0x2f52af,_0x184965=await warehouse[_0x37cf3f(0x266)]({'name':_0x3e8e65,'room':_0x59d084['room_name'],'warehouse_category':_0x37cf3f(0x275)});const _0x357aaf=_0x184965[_0x37cf3f(0x24d)]['map'](_0x435ea4=>{var _0x4158bd=_0x37cf3f;_0x435ea4[_0x4158bd(0x2da)]==_0x59d084[_0x4158bd(0x2da)]&&_0x435ea4[_0x4158bd(0x2d6)]==_0x59d084['floorlevel']&&_0x435ea4[_0x4158bd(0x261)]==_0x59d084['type']&&_0x435ea4[_0x4158bd(0x260)]==_0x59d084[_0x4158bd(0x260)]&&_0x435ea4[_0x4158bd(0x2a3)]==_0x59d084[_0x4158bd(0x2a3)]&&_0x435ea4[_0x4158bd(0x2ad)]==_0x59d084[_0x4158bd(0x2ad)]&&_0x435ea4[_0x4158bd(0x25f)]==_0x59d084[_0x4158bd(0x25f)]&&_0x435ea4[_0x4158bd(0x276)]==_0x59d084[_0x4158bd(0x276)]&&_0x435ea4[_0x4158bd(0x2e0)]==_0x59d084[_0x4158bd(0x2e0)]&&_0x435ea4['invoice']==_0x59d084[_0x4158bd(0x23b)]&&(_0x435ea4[_0x4158bd(0x28d)]=Math[_0x4158bd(0x258)](0x0,Math[_0x4158bd(0x1cc)](_0x435ea4['product_stock'])-Math['abs'](_0x59d084[_0x4158bd(0x29b)])));});return _0x184965;});Promise[_0x2f52af(0x2af)](_0x2df493)[_0x2f52af(0x27f)](async _0x3931ed=>{var _0x32ab5a=_0x2f52af;try{for(const _0x26bd54 of _0x3931ed){await _0x26bd54[_0x32ab5a(0x1ff)]();}_0x5d7952[_0x32ab5a(0x2a8)]=_0x32ab5a(0x222);const _0x14e265=await _0x5d7952[_0x32ab5a(0x1ff)](),_0x3df7b2=await master_shop['find'](),_0x3e831e=await email_settings[_0x32ab5a(0x266)](),_0x43f7bb=await supervisor_settings[_0x32ab5a(0x226)]();var _0x14bd7e=_0x5d7952['sale_product'],_0x4ab697='',_0x16bd81;for(_0x16bd81 in _0x14bd7e){_0x4ab697+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14bd7e[_0x16bd81][_0x32ab5a(0x2da)]+_0x32ab5a(0x2ab)+_0x32ab5a(0x1c9)+_0x14bd7e[_0x16bd81][_0x32ab5a(0x255)]+_0x32ab5a(0x2ab)+_0x32ab5a(0x1c9)+_0x14bd7e[_0x16bd81][_0x32ab5a(0x29b)]+_0x32ab5a(0x2ab)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14bd7e[_0x16bd81][_0x32ab5a(0x268)]+_0x32ab5a(0x2ab)+_0x32ab5a(0x1c9)+_0x14bd7e[_0x16bd81][_0x32ab5a(0x2b5)]+_0x32ab5a(0x2ab)+_0x32ab5a(0x1c9)+_0x5d7952[_0x32ab5a(0x2c6)]+_0x32ab5a(0x2ab)+_0x32ab5a(0x1c9)+_0x14bd7e[_0x16bd81][_0x32ab5a(0x2d1)]+_0x32ab5a(0x2ab)+_0x32ab5a(0x1c9)+_0x14bd7e[_0x16bd81]['storage']+_0x14bd7e[_0x16bd81][_0x32ab5a(0x2ad)]+_0x14bd7e[_0x16bd81][_0x32ab5a(0x2a3)]+_0x14bd7e[_0x16bd81]['bin']+_0x14bd7e[_0x16bd81]['type'][0x0]+_0x14bd7e[_0x16bd81][_0x32ab5a(0x2d6)]+_0x32ab5a(0x2ab),_0x32ab5a(0x278);}let _0x3a2488=nodemailer[_0x32ab5a(0x1ce)]({'host':_0x3e831e[_0x32ab5a(0x1ed)],'port':Number(_0x3e831e[_0x32ab5a(0x267)]),'secure':![],'auth':{'user':_0x3e831e[_0x32ab5a(0x2b1)],'pass':_0x3e831e[_0x32ab5a(0x2c5)]}}),_0x58c51a={'from':_0x3e831e[_0x32ab5a(0x2b1)],'to':_0x43f7bb[0x0]['RMSEmail'],'subject':_0x32ab5a(0x29e),'attachments':[{'filename':_0x32ab5a(0x201),'path':__dirname+_0x32ab5a(0x29f)+_0x32ab5a(0x223)+_0x3df7b2[0x0][_0x32ab5a(0x274)],'cid':_0x32ab5a(0x246)}],'html':_0x32ab5a(0x26c)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x32ab5a(0x1f4)+_0x32ab5a(0x252)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x32ab5a(0x1d2)+_0x3df7b2[0x0][_0x32ab5a(0x2db)]+_0x32ab5a(0x2ba)+_0x32ab5a(0x262)+_0x32ab5a(0x262)+_0x32ab5a(0x203)+_0x32ab5a(0x252)+_0x32ab5a(0x1eb)+'\x20Order\x20Number\x20:\x20'+_0x5d7952[_0x32ab5a(0x23b)]+'\x20'+_0x32ab5a(0x207)+_0x32ab5a(0x1d3)+_0x5d7952['date']+'\x20'+_0x32ab5a(0x242)+_0x32ab5a(0x1d4)+_0x32ab5a(0x262)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x32ab5a(0x2a9)+'<tr>'+_0x32ab5a(0x281)+_0x32ab5a(0x2ca)+_0x32ab5a(0x2bc)+_0x32ab5a(0x265)+_0x32ab5a(0x22d)+_0x32ab5a(0x214)+_0x32ab5a(0x220)+_0x32ab5a(0x2aa)+_0x32ab5a(0x278)+_0x32ab5a(0x1d5)+_0x32ab5a(0x269)+'\x20'+_0x4ab697+'\x20'+_0x32ab5a(0x296)+'</table>'+_0x32ab5a(0x252)+'<strong>\x20Regards\x20</strong>'+_0x32ab5a(0x26a)+_0x3df7b2[0x0]['site_title']+'</h5>'+_0x32ab5a(0x262)+'</div>'+_0x32ab5a(0x1db)};_0x3a2488[_0x32ab5a(0x289)](_0x58c51a,function(_0x5d9e96,_0x1e9e4d){var _0x27209e=_0x32ab5a;_0x5d9e96?(console[_0x27209e(0x1e9)](_0x5d9e96),console['log']('Error\x20Occurs')):console[_0x27209e(0x1e9)](_0x27209e(0x28e));}),_0x4002d6[_0x32ab5a(0x1e0)]('success',_0x32ab5a(0x249)),_0x47873d[_0x32ab5a(0x2dc)]('/all_sales/preview/'+_0x11860e);}catch(_0x5bb570){console[_0x32ab5a(0x2cd)](_0x5bb570),_0x47873d['status'](0x1f4)[_0x32ab5a(0x26b)]({'error':_0x32ab5a(0x22c)});}})[_0x2f52af(0x20c)](_0x1a8f56=>{var _0x1c70a5=_0x2f52af;console[_0x1c70a5(0x2cd)](_0x1a8f56),_0x47873d[_0x1c70a5(0x257)](0x1f4)[_0x1c70a5(0x26b)]({'error':_0x1c70a5(0x250)});});}catch(_0xe03ccb){console[_0x2f52af(0x1e9)](_0xe03ccb);}}),router[a0_0x4734cd(0x200)](a0_0x4734cd(0x23f),auth,async(_0x55ffec,_0x2c6922)=>{var _0x31175d=a0_0x4734cd;try{const {username:_0x49375a,email:_0x1c33b6,role:_0x2b4b57}=_0x55ffec[_0x31175d(0x1df)],_0x35f74c=_0x55ffec[_0x31175d(0x1df)],_0x32217d=await profile[_0x31175d(0x266)]({'email':_0x35f74c[_0x31175d(0x2b1)]}),_0x107f5e=await master_shop[_0x31175d(0x226)](),_0x5c6d51=_0x55ffec['params']['id'],_0x5f4af9=await sales['findById'](_0x5c6d51);var _0x18ba32=['Ambient',_0x31175d(0x21e)];const _0x5b63ba=await warehouse[_0x31175d(0x20d)]([{'$match':{'name':_0x5f4af9[_0x31175d(0x2c6)],'warehouse_category':_0x31175d(0x275)}},{'$unwind':_0x31175d(0x1f5)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x31175d(0x237)},'product_stock':{'$first':_0x31175d(0x217)},'bay':{'$first':_0x31175d(0x2ae)},'bin':{'$first':_0x31175d(0x21d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x31175d(0x251)},'secondary_code':{'$first':_0x31175d(0x254)},'product_code':{'$first':_0x31175d(0x295)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x31175d(0x28b)}}}]),_0x1c4da1=await customer[_0x31175d(0x226)]({});let _0x2ee021;if(_0x35f74c[_0x31175d(0x2bf)]==_0x31175d(0x247)){const _0xb4c946=await staff[_0x31175d(0x266)]({'email':_0x35f74c['email']});_0x2ee021=await warehouse[_0x31175d(0x20d)]([{'$match':{'status':_0x31175d(0x25e),'name':_0xb4c946[_0x31175d(0x2de)],'warehouse_category':_0x31175d(0x275)}},{'$group':{'_id':'$name','name':{'$first':_0x31175d(0x272)}}}]);}else _0x2ee021=await warehouse[_0x31175d(0x20d)]([{'$match':{'status':_0x31175d(0x25e),'warehouse_category':_0x31175d(0x275)}},{'$group':{'_id':_0x31175d(0x272),'name':{'$first':_0x31175d(0x272)}}}]);const _0x50758f=await product[_0x31175d(0x226)]({});if(_0x107f5e[0x0]['language']=='English\x20(US)'){var _0x140abc=users[_0x31175d(0x263)];console[_0x31175d(0x1e9)](_0x140abc);}else{if(_0x107f5e[0x0][_0x31175d(0x29a)]=='Hindi')var _0x140abc=users[_0x31175d(0x27a)];else{if(_0x107f5e[0x0][_0x31175d(0x29a)]==_0x31175d(0x1fd))var _0x140abc=users[_0x31175d(0x1fd)];else{if(_0x107f5e[0x0]['language']==_0x31175d(0x234))var _0x140abc=users[_0x31175d(0x234)];else{if(_0x107f5e[0x0][_0x31175d(0x29a)]=='French')var _0x140abc=users['French'];else{if(_0x107f5e[0x0][_0x31175d(0x29a)]==_0x31175d(0x2dd))var _0x140abc=users[_0x31175d(0x2d7)];else{if(_0x107f5e[0x0]['language']=='Chinese')var _0x140abc=users[_0x31175d(0x271)];else{if(_0x107f5e[0x0]['language']=='Arabic\x20(ae)')var _0x140abc=users[_0x31175d(0x1f8)];}}}}}}}_0x2c6922[_0x31175d(0x2c4)](_0x31175d(0x24e),{'success':_0x55ffec['flash'](_0x31175d(0x1f7)),'errors':_0x55ffec[_0x31175d(0x1e0)](_0x31175d(0x2e2)),'role':_0x35f74c,'profile':_0x32217d,'customer':_0x1c4da1,'warehouse':_0x2ee021,'product':_0x5b63ba,'user':_0x5f4af9,'master_shop':_0x107f5e,'unit':_0x50758f,'language':_0x140abc});}catch(_0x1957b6){console[_0x31175d(0x1e9)](_0x1957b6);}}),router['post']('/view/:id',auth,async(_0x183de3,_0x49a968)=>{var _0x29680e=a0_0x4734cd;try{const _0x5ccac7=_0x183de3[_0x29680e(0x231)]['id'],_0x5ca07d=await sales[_0x29680e(0x266)]({'_id':_0x183de3[_0x29680e(0x231)]['id']}),_0x2829bf=await warehouse[_0x29680e(0x266)]({'name':_0x5ca07d['warehouse_name'],'room':_0x183de3[_0x29680e(0x291)][_0x29680e(0x299)]}),{invoice:_0x272c3b,date:_0x415ebc,warehouse_name:_0x1e6d1f,product_name:_0x4aff12,stock:_0x3b0d87,quantity:_0x3e2462,note:_0x1a85b9,room:_0x3f427e,customer:_0xe0654d,SCRN:_0x12d05a}=_0x183de3[_0x29680e(0x291)];if(typeof _0x4aff12==_0x29680e(0x245))var _0x3296c2=[_0x183de3[_0x29680e(0x291)]['product_name']],_0x2b1073=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x23a)]],_0x10e09c=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x213)]],_0x5401a2=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x2a6)]],_0x2d0c50=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x27c)]],_0x5be2f5=[_0x183de3[_0x29680e(0x291)]['prod_code']],_0x2b0874=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x287)]],_0x4c74eb=[_0x183de3['body'][_0x29680e(0x2b9)]],_0x5c836a=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x2b5)]],_0x2b8237=[_0x183de3['body'][_0x29680e(0x2e0)]],_0x2dab63=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x276)]],_0x1547de=[_0x183de3['body']['max_per_unit']],_0x2a70d5=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x216)]],_0x18bf7a=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x2c8)]],_0x521657=[_0x183de3['body'][_0x29680e(0x297)]],_0x1b6050=[_0x183de3[_0x29680e(0x291)]['delivery_code']],_0x5772e2=[_0x183de3['body'][_0x29680e(0x1e8)]],_0x2e4475=[_0x183de3[_0x29680e(0x291)]['quantity']],_0x524ea3=[_0x183de3[_0x29680e(0x291)][_0x29680e(0x232)]];else var _0x3296c2=[..._0x183de3['body'][_0x29680e(0x2da)]],_0x2b1073=[..._0x183de3[_0x29680e(0x291)]['stock']],_0x10e09c=[..._0x183de3[_0x29680e(0x291)]['carton']],_0x5401a2=[..._0x183de3['body'][_0x29680e(0x2a6)]],_0x2d0c50=[..._0x183de3[_0x29680e(0x291)]['secondary_code']],_0x5be2f5=[..._0x183de3[_0x29680e(0x291)]['prod_code']],_0x2b0874=[..._0x183de3[_0x29680e(0x291)][_0x29680e(0x287)]],_0x4c74eb=[..._0x183de3['body'][_0x29680e(0x2b9)]],_0x5c836a=[..._0x183de3[_0x29680e(0x291)][_0x29680e(0x2b5)]],_0x2b8237=[..._0x183de3['body'][_0x29680e(0x2e0)]],_0x2dab63=[..._0x183de3[_0x29680e(0x291)]['expiry_date']],_0x1547de=[..._0x183de3[_0x29680e(0x291)][_0x29680e(0x1f2)]],_0x2a70d5=[..._0x183de3[_0x29680e(0x291)]['production_date']],_0x18bf7a=[..._0x183de3[_0x29680e(0x291)]['requested_qty']],_0x521657=[..._0x183de3[_0x29680e(0x291)][_0x29680e(0x297)]],_0x1b6050=[..._0x183de3[_0x29680e(0x291)][_0x29680e(0x2c9)]],_0x5772e2=[..._0x183de3[_0x29680e(0x291)][_0x29680e(0x1e8)]],_0x2e4475=[..._0x183de3['body'][_0x29680e(0x29b)]],_0x524ea3=[..._0x183de3[_0x29680e(0x291)]['RoomAssigned']];const _0x1e34bd=_0x3296c2[_0x29680e(0x259)](_0x4b422b=>{return _0x4b422b={'product_name':_0x4b422b};});_0x2b1073[_0x29680e(0x1f9)]((_0x5ef18c,_0x16fd5a)=>{var _0x5c7bd1=_0x29680e;_0x1e34bd[_0x16fd5a][_0x5c7bd1(0x23a)]=Math[_0x5c7bd1(0x1cc)](_0x5ef18c);}),_0x10e09c['forEach']((_0x4da2d0,_0x5ec7d6)=>{var _0x1aea2d=_0x29680e;_0x1e34bd[_0x5ec7d6][_0x1aea2d(0x29b)]=_0x4da2d0;}),_0x5401a2[_0x29680e(0x1f9)]((_0x3a0eed,_0x457b53)=>{var _0x1e319d=_0x29680e;_0x1e34bd[_0x457b53][_0x1e319d(0x2a6)]=_0x3a0eed;}),_0x2d0c50[_0x29680e(0x1f9)]((_0x1a9bb0,_0x4b0c05)=>{var _0x1cd7ba=_0x29680e;_0x1e34bd[_0x4b0c05][_0x1cd7ba(0x27c)]=_0x1a9bb0;}),_0x5be2f5[_0x29680e(0x1f9)]((_0x540e06,_0x260375)=>{var _0x50d484=_0x29680e;_0x1e34bd[_0x260375][_0x50d484(0x255)]=_0x540e06;}),_0x2b0874['forEach']((_0x19d53f,_0xa657bd)=>{var _0x5bdc9d=_0x29680e;_0x524ea3[_0x5bdc9d(0x1f9)]((_0x57fb5a,_0x18923f)=>{var _0x3de87c=_0x5bdc9d;if(_0x57fb5a==_0x3de87c(0x228)&&_0xa657bd==_0x18923f){var _0x27b27a=_0x19d53f[_0x3de87c(0x211)](0x3);_0x1e34bd[_0xa657bd]['storage']=_0x19d53f[0x0],_0x1e34bd[_0xa657bd][_0x3de87c(0x2ad)]=_0x19d53f[0x1],_0x1e34bd[_0xa657bd][_0x3de87c(0x2a3)]=0x0,_0x1e34bd[_0xa657bd][_0x3de87c(0x260)]=0x0,_0x1e34bd[_0xa657bd][_0x3de87c(0x261)]=_0x3de87c(0x29d),_0x1e34bd[_0xa657bd]['floorlevel']=_0x27b27a;}else{if(_0x57fb5a=='Shelves'&&_0xa657bd==_0x18923f){var _0x27b27a=_0x19d53f[_0x3de87c(0x211)](0x3);_0x1e34bd[_0xa657bd][_0x3de87c(0x25f)]=_0x19d53f[0x0],_0x1e34bd[_0xa657bd][_0x3de87c(0x2ad)]=_0x19d53f[0x1],_0x1e34bd[_0xa657bd][_0x3de87c(0x2a3)]=0x0,_0x1e34bd[_0xa657bd][_0x3de87c(0x260)]=0x0,_0x1e34bd[_0xa657bd]['type']='Floor',_0x1e34bd[_0xa657bd][_0x3de87c(0x2d6)]=_0x19d53f[0x5];}else{if(_0xa657bd==_0x18923f){var _0x3a6dfc;if(_0x19d53f[0x4]=='L')_0x3a6dfc=_0x3de87c(0x2bb);else _0x19d53f[0x4]=='F'&&(_0x3a6dfc=_0x3de87c(0x29d));_0x1e34bd[_0xa657bd][_0x3de87c(0x25f)]=_0x19d53f[0x0],_0x1e34bd[_0xa657bd][_0x3de87c(0x2ad)]=_0x19d53f[0x1],_0x1e34bd[_0xa657bd][_0x3de87c(0x2a3)]=_0x19d53f[0x2],_0x1e34bd[_0xa657bd][_0x3de87c(0x260)]=_0x19d53f[0x3],_0x1e34bd[_0xa657bd][_0x3de87c(0x261)]=_0x3a6dfc,_0x1e34bd[_0xa657bd][_0x3de87c(0x2d6)]=_0x19d53f[0x5];}}}});}),_0x4c74eb[_0x29680e(0x1f9)]((_0x3317ba,_0x45610e)=>{_0x1e34bd[_0x45610e]['unit']=_0x3317ba;}),_0x5c836a['forEach']((_0x411fbe,_0x4e5291)=>{var _0x11f04d=_0x29680e;_0x1e34bd[_0x4e5291][_0x11f04d(0x2b5)]=_0x411fbe;}),_0x2b8237[_0x29680e(0x1f9)]((_0x524cf5,_0x38c352)=>{var _0x16735b=_0x29680e;_0x1e34bd[_0x38c352][_0x16735b(0x2e0)]=_0x524cf5;}),_0x2dab63[_0x29680e(0x1f9)]((_0x398d50,_0x5e0b20)=>{var _0x8299ac=_0x29680e;_0x1e34bd[_0x5e0b20][_0x8299ac(0x276)]=_0x398d50;}),_0x1547de['forEach']((_0x1eab36,_0x264e7a)=>{var _0x4d037f=_0x29680e;_0x1e34bd[_0x264e7a][_0x4d037f(0x244)]=_0x1eab36;}),_0x2a70d5[_0x29680e(0x1f9)]((_0x22c1e4,_0x16ae6f)=>{var _0x48a809=_0x29680e;_0x1e34bd[_0x16ae6f][_0x48a809(0x216)]=_0x22c1e4;}),_0x18bf7a[_0x29680e(0x1f9)]((_0x32af0c,_0x5eeb27)=>{var _0x17d5bc=_0x29680e;_0x1e34bd[_0x5eeb27][_0x17d5bc(0x2c8)]=Math[_0x17d5bc(0x1cc)](_0x32af0c);}),_0x521657[_0x29680e(0x1f9)]((_0x4d0e84,_0x33ba64)=>{var _0x4fe595=_0x29680e;_0x1e34bd[_0x33ba64][_0x4fe595(0x297)]=_0x4d0e84;}),_0x1b6050[_0x29680e(0x1f9)]((_0x35d203,_0x6c0fbf)=>{var _0x38f18f=_0x29680e;_0x1e34bd[_0x6c0fbf][_0x38f18f(0x2c9)]=_0x35d203;}),_0x5772e2[_0x29680e(0x1f9)]((_0x205ca3,_0x7318de)=>{var _0xfe88f1=_0x29680e;_0x1e34bd[_0x7318de][_0xfe88f1(0x1e8)]=_0x205ca3;}),_0x2e4475[_0x29680e(0x1f9)]((_0x36a6e1,_0x4f60b3)=>{var _0x5b8ac4=_0x29680e;_0x1e34bd[_0x4f60b3][_0x5b8ac4(0x1d9)]=_0x36a6e1;}),_0x524ea3[_0x29680e(0x1f9)]((_0x55bb0e,_0x33484a)=>{var _0x271a23=_0x29680e;_0x1e34bd[_0x33484a][_0x271a23(0x2d1)]=_0x55bb0e;});var _0x1d5029=0x0;_0x1e34bd[_0x29680e(0x1f9)](_0x42d85a=>{var _0xc1d272=_0x29680e;console[_0xc1d272(0x1e9)](_0xc1d272(0x202),_0x42d85a),(parseInt(_0x42d85a[_0xc1d272(0x23a)])<parseInt(_0x42d85a[_0xc1d272(0x29b)])||parseInt(_0x42d85a[_0xc1d272(0x29b)])==0x0)&&_0x1d5029++;});if(_0x1d5029!=0x0)return _0x183de3['flash']('errors',_0x29680e(0x229)),_0x49a968[_0x29680e(0x2dc)](_0x29680e(0x2c0));const _0x5c664e=_0x1e34bd[_0x29680e(0x20b)](_0x55422c=>_0x55422c[_0x29680e(0x29b)]!=='0'&&_0x55422c[_0x29680e(0x29b)]!=='');_0x5ca07d[_0x29680e(0x23b)]=_0x272c3b,_0x5ca07d[_0x29680e(0x25a)]=_0xe0654d,_0x5ca07d[_0x29680e(0x1ef)]=_0x415ebc,_0x5ca07d[_0x29680e(0x2c6)]=_0x1e6d1f,_0x5ca07d['sale_product']=_0x5c664e,_0x5ca07d[_0x29680e(0x29c)]=_0x1a85b9,_0x5ca07d['SCRN']=_0x12d05a,_0x5ca07d[_0x29680e(0x2a8)]=_0x29680e(0x2d9),_0x5ca07d[_0x29680e(0x21a)]=_0x29680e(0x2d9);const _0x52ec8e=await _0x5ca07d['save']();_0x183de3[_0x29680e(0x1e0)](_0x29680e(0x1f7),_0x29680e(0x249)),_0x49a968[_0x29680e(0x2dc)]('/all_sales/view');}catch(_0x96ee7){console[_0x29680e(0x1e9)](_0x96ee7);}}),router[a0_0x4734cd(0x288)](a0_0x4734cd(0x293),auth,async(_0x4a46f0,_0x28e1e2)=>{var _0x252fa7=a0_0x4734cd;try{const _0x316c44=_0x4a46f0[_0x252fa7(0x231)]['id'],{invoice:_0x483ae6,customer:_0xfbe4b3,receivable_amount:_0x2c7cf4,received_amount:_0x3ad0e6}=_0x4a46f0['body'],_0xfcb4cf=await sales[_0x252fa7(0x248)](_0x316c44);console['log'](_0xfcb4cf);var _0x4797ec=_0x2c7cf4-_0x3ad0e6;console[_0x252fa7(0x1e9)](_0x3ad0e6),_0xfcb4cf[_0x252fa7(0x24c)]=parseFloat(_0x3ad0e6)+parseFloat(_0xfcb4cf['received_amount']),_0xfcb4cf['due_amount']=_0x4797ec,console['log'](_0xfcb4cf);const _0x53ed9b=await _0xfcb4cf[_0x252fa7(0x1ff)](),_0x477e83=await c_payment_data[_0x252fa7(0x266)]({'invoice':_0x483ae6});_0x477e83['amount']=_0x4797ec,await _0x477e83['save']();let _0x1545bb=new Date(),_0x13d8b2=('0'+_0x1545bb[_0x252fa7(0x2d4)]())[_0x252fa7(0x211)](-0x2),_0x39bb88=('0'+(_0x1545bb[_0x252fa7(0x227)]()+0x1))['slice'](-0x2),_0x1e9296=_0x1545bb['getFullYear'](),_0x414e3a=_0x1e9296+'-'+_0x39bb88+'-'+_0x13d8b2;const _0x1011bd=new customer_payment({'invoice':_0x483ae6,'date':_0x1e9296+'-'+_0x39bb88+'-'+_0x13d8b2,'customer':_0xfbe4b3,'reason':_0x252fa7(0x283),'amount':_0x3ad0e6}),_0x4e2335=await _0x1011bd[_0x252fa7(0x1ff)]();_0x4a46f0[_0x252fa7(0x1e0)](_0x252fa7(0x1f7),'payment\x20successfull'),_0x28e1e2[_0x252fa7(0x2dc)](_0x252fa7(0x1e2));}catch(_0x1f062d){console['log'](_0x1f062d);}}),router['get'](a0_0x4734cd(0x2d2),auth,async(_0x544780,_0x143b79)=>{var _0x5d5a5e=a0_0x4734cd;try{const {username:_0xb3cf5,email:_0x6ebff3,role:_0x57b494}=_0x544780['user'],_0x4b8145=_0x544780['user'],_0x41696b=await profile[_0x5d5a5e(0x266)]({'email':_0x4b8145[_0x5d5a5e(0x2b1)]}),_0x5a7fb3=await master_shop[_0x5d5a5e(0x226)]();console['log'](_0x5d5a5e(0x280),_0x5a7fb3);const _0x4ce52e=_0x544780['params']['id'],_0x237551=await sales[_0x5d5a5e(0x248)](_0x4ce52e);console[_0x5d5a5e(0x1e9)](_0x237551);const _0x3419a4=await customer[_0x5d5a5e(0x266)]({'name':_0x237551['customer']});console[_0x5d5a5e(0x1e9)](_0x3419a4);if(_0x5a7fb3[0x0]['language']==_0x5d5a5e(0x27e)){var _0x387e4a=users[_0x5d5a5e(0x263)];console[_0x5d5a5e(0x1e9)](_0x387e4a);}else{if(_0x5a7fb3[0x0]['language']=='Hindi')var _0x387e4a=users[_0x5d5a5e(0x27a)];else{if(_0x5a7fb3[0x0]['language']==_0x5d5a5e(0x1fd))var _0x387e4a=users['German'];else{if(_0x5a7fb3[0x0][_0x5d5a5e(0x29a)]==_0x5d5a5e(0x234))var _0x387e4a=users[_0x5d5a5e(0x234)];else{if(_0x5a7fb3[0x0][_0x5d5a5e(0x29a)]==_0x5d5a5e(0x1cb))var _0x387e4a=users[_0x5d5a5e(0x1cb)];else{if(_0x5a7fb3[0x0][_0x5d5a5e(0x29a)]==_0x5d5a5e(0x2dd))var _0x387e4a=users[_0x5d5a5e(0x2d7)];else{if(_0x5a7fb3[0x0][_0x5d5a5e(0x29a)]==_0x5d5a5e(0x271))var _0x387e4a=users['Chinese'];else{if(_0x5a7fb3[0x0][_0x5d5a5e(0x29a)]==_0x5d5a5e(0x2ac))var _0x387e4a=users[_0x5d5a5e(0x1f8)];}}}}}}}_0x143b79[_0x5d5a5e(0x2c4)](_0x5d5a5e(0x285),{'success':_0x544780[_0x5d5a5e(0x1e0)](_0x5d5a5e(0x1f7)),'errors':_0x544780[_0x5d5a5e(0x1e0)](_0x5d5a5e(0x2e2)),'role':_0x4b8145,'profile':_0x41696b,'master_shop':_0x5a7fb3,'customers':_0x3419a4,'sales':_0x237551,'language':_0x387e4a});}catch(_0x2fbb82){console[_0x5d5a5e(0x1e9)](_0x2fbb82);}}),router[a0_0x4734cd(0x200)](a0_0x4734cd(0x2b6),auth,async(_0x376b2f,_0x570f19)=>{var _0x1f0a4f=a0_0x4734cd;try{const {username:_0x21a2d4,email:_0x1642c3,role:_0x54b89d}=_0x376b2f[_0x1f0a4f(0x1df)],_0x121564=_0x376b2f['user'],_0x183eb3=await profile[_0x1f0a4f(0x266)]({'email':_0x121564[_0x1f0a4f(0x2b1)]}),_0x5a413f=await master_shop[_0x1f0a4f(0x226)]();console[_0x1f0a4f(0x1e9)](_0x1f0a4f(0x280),_0x5a413f);const _0x4ee4c7=_0x376b2f[_0x1f0a4f(0x231)]['id'];console[_0x1f0a4f(0x1e9)](_0x4ee4c7);const _0x4ef7cd=await sales[_0x1f0a4f(0x248)](_0x4ee4c7);console[_0x1f0a4f(0x1e9)](_0x1f0a4f(0x2a5),_0x4ef7cd);const _0x29fb59=await warehouse[_0x1f0a4f(0x20d)]([{'$match':{'name':'Return\x20Goods','room':_0x1f0a4f(0x221)}},{'$unwind':_0x1f0a4f(0x1f5)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1f0a4f(0x237)},'product_stock':{'$first':_0x1f0a4f(0x217)},'level':{'$first':_0x1f0a4f(0x2c7)},'isle':{'$first':_0x1f0a4f(0x21c)},'pallet':{'$first':_0x1f0a4f(0x2c1)},'primary_code':{'$first':_0x1f0a4f(0x251)},'secondary_code':{'$first':_0x1f0a4f(0x254)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x1f0a4f(0x1e9)](_0x1f0a4f(0x210),_0x29fb59);const _0x428d81=await product[_0x1f0a4f(0x226)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x1f0a4f(0x25e),'name':_0x1f0a4f(0x26d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1f0a4f(0x272),'name':{'$first':_0x1f0a4f(0x272)}}},{'$sort':{'name':0x1}}]);var _0x2d8be1=[_0x1f0a4f(0x221)];if(_0x5a413f[0x0][_0x1f0a4f(0x29a)]==_0x1f0a4f(0x27e)){var _0x1055e0=users[_0x1f0a4f(0x263)];console[_0x1f0a4f(0x1e9)](_0x1055e0);}else{if(_0x5a413f[0x0][_0x1f0a4f(0x29a)]==_0x1f0a4f(0x27a))var _0x1055e0=users[_0x1f0a4f(0x27a)];else{if(_0x5a413f[0x0]['language']=='German')var _0x1055e0=users[_0x1f0a4f(0x1fd)];else{if(_0x5a413f[0x0]['language']==_0x1f0a4f(0x234))var _0x1055e0=users[_0x1f0a4f(0x234)];else{if(_0x5a413f[0x0][_0x1f0a4f(0x29a)]==_0x1f0a4f(0x1cb))var _0x1055e0=users[_0x1f0a4f(0x1cb)];else{if(_0x5a413f[0x0][_0x1f0a4f(0x29a)]==_0x1f0a4f(0x2dd))var _0x1055e0=users[_0x1f0a4f(0x2d7)];else{if(_0x5a413f[0x0][_0x1f0a4f(0x29a)]==_0x1f0a4f(0x271))var _0x1055e0=users[_0x1f0a4f(0x271)];else{if(_0x5a413f[0x0]['language']==_0x1f0a4f(0x2ac))var _0x1055e0=users[_0x1f0a4f(0x1f8)];}}}}}}}_0x570f19[_0x1f0a4f(0x2c4)](_0x1f0a4f(0x2ce),{'success':_0x376b2f['flash'](_0x1f0a4f(0x1f7)),'errors':_0x376b2f[_0x1f0a4f(0x1e0)](_0x1f0a4f(0x2e2)),'role':_0x121564,'profile':_0x183eb3,'user':_0x4ef7cd,'stock':_0x29fb59,'master_shop':_0x5a413f,'unit':_0x428d81,'language':_0x1055e0,'warehouses':warehouse_data,'rooms':_0x2d8be1});}catch(_0x27fea9){console['log'](_0x27fea9),_0x570f19['status'](0xc8)[_0x1f0a4f(0x26b)]({'message':_0x27fea9[_0x1f0a4f(0x205)]});}}),router[a0_0x4734cd(0x288)]('/view/return_sales/:id',auth,async(_0x554734,_0x58134d)=>{var _0x1d5ce7=a0_0x4734cd;try{const {invoice:_0x33b12d,date:_0x5501a9,warehouse_name:_0x1e87f0,product_name:_0x4cfe9b,primary_code:_0x330d50,secondary_code:_0x199018,product_code:_0x4c881f,sales_quantity:_0x1f9cc2,stocks:_0x29747c,return_qty:_0x4c4862,Room_name:_0x4aa52e,to_warehouse_name:_0x330741,to_Roomname:_0x3ea36d,to_Room_name:_0x14db7c,note:_0x5299bf,level:_0x11b521,isle:_0x7a76d1,pallet:_0x49eb01}=_0x554734[_0x1d5ce7(0x291)];if(typeof _0x4cfe9b==_0x1d5ce7(0x245))var _0x19f0bd=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x2da)]],_0x1d0635=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x2a6)]],_0x54d76a=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x27c)]],_0x5e4e33=[_0x554734[_0x1d5ce7(0x291)]['product_code']],_0x3eaa81=[_0x554734['body'][_0x1d5ce7(0x2be)]],_0x638114=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x25d)]],_0x7ae4dd=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x236)]],_0x5f5d49=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x2a3)]],_0x56c829=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x260)]],_0x3a21e5=[_0x554734[_0x1d5ce7(0x291)]['types']],_0x44b742=[_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x2d6)]];else var _0x19f0bd=[..._0x554734['body']['product_name']],_0x1d0635=[..._0x554734['body'][_0x1d5ce7(0x2a6)]],_0x54d76a=[..._0x554734[_0x1d5ce7(0x291)]['secondary_code']],_0x5e4e33=[..._0x554734['body'][_0x1d5ce7(0x255)]],_0x3eaa81=[..._0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x2be)]],_0x638114=[..._0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x25d)]],_0x7ae4dd=[..._0x554734['body'][_0x1d5ce7(0x236)]],_0x5f5d49=[..._0x554734[_0x1d5ce7(0x291)]['bay']],_0x56c829=[..._0x554734[_0x1d5ce7(0x291)]['bin']],_0x3a21e5=[..._0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x1e5)]],_0x44b742=[..._0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x2d6)]];const _0x23ff73=_0x19f0bd[_0x1d5ce7(0x259)](_0x1bc1db=>{return _0x1bc1db={'product_name':_0x1bc1db};});_0x1d0635[_0x1d5ce7(0x1f9)]((_0x502681,_0x265703)=>{var _0x3bcc02=_0x1d5ce7;_0x23ff73[_0x265703][_0x3bcc02(0x2a6)]=_0x502681;}),_0x54d76a[_0x1d5ce7(0x1f9)]((_0x466d77,_0x6da8b1)=>{var _0x29f240=_0x1d5ce7;_0x23ff73[_0x6da8b1][_0x29f240(0x27c)]=_0x466d77;}),_0x5e4e33['forEach']((_0x142400,_0x2b1bdf)=>{var _0x3987e9=_0x1d5ce7;_0x23ff73[_0x2b1bdf][_0x3987e9(0x255)]=_0x142400;}),_0x3eaa81[_0x1d5ce7(0x1f9)]((_0x4f9e96,_0xdf8a9c)=>{_0x23ff73[_0xdf8a9c]['sale_qty']=_0x4f9e96;}),_0x638114[_0x1d5ce7(0x1f9)]((_0x1b6581,_0x3bc7c7)=>{var _0x290349=_0x1d5ce7;_0x23ff73[_0x3bc7c7][_0x290349(0x23a)]=_0x1b6581;}),_0x7ae4dd[_0x1d5ce7(0x1f9)]((_0xfbd8,_0x2b34f4)=>{var _0x817258=_0x1d5ce7;_0x23ff73[_0x2b34f4][_0x817258(0x236)]=_0xfbd8;}),_0x5f5d49['forEach']((_0x5f57f7,_0x2ef1ef)=>{var _0x5646a0=_0x1d5ce7;_0x23ff73[_0x2ef1ef][_0x5646a0(0x2a3)]=_0x5f57f7;}),_0x56c829[_0x1d5ce7(0x1f9)]((_0x328fd3,_0x12f4e9)=>{var _0x87a25=_0x1d5ce7;_0x23ff73[_0x12f4e9][_0x87a25(0x260)]=_0x328fd3;}),_0x3a21e5[_0x1d5ce7(0x1f9)]((_0x584a40,_0x39d465)=>{var _0x58ecb9=_0x1d5ce7;_0x23ff73[_0x39d465][_0x58ecb9(0x261)]=_0x584a40;}),_0x44b742[_0x1d5ce7(0x1f9)]((_0x3b45ef,_0x4b3d9b)=>{var _0x3ef293=_0x1d5ce7;_0x23ff73[_0x4b3d9b][_0x3ef293(0x2d6)]=_0x3b45ef;});var _0x281874=0x0;_0x23ff73['forEach'](_0x1e9860=>{var _0x140fa4=_0x1d5ce7;console[_0x140fa4(0x1e9)](_0x140fa4(0x202),_0x1e9860),(parseInt(_0x1e9860[_0x140fa4(0x1d6)])<parseInt(_0x1e9860[_0x140fa4(0x236)])||parseInt(_0x1e9860['stock'])<parseInt(_0x1e9860[_0x140fa4(0x236)])&&parseInt(_0x1e9860[_0x140fa4(0x1d6)])>parseInt(_0x1e9860[_0x140fa4(0x236)])||parseInt(_0x1e9860[_0x140fa4(0x236)])==0x0)&&_0x281874++;});if(_0x281874!=0x0)return _0x554734[_0x1d5ce7(0x1e0)](_0x1d5ce7(0x2e2),_0x1d5ce7(0x2e1)),_0x58134d['redirect'](_0x1d5ce7(0x2c0));const _0x4c6f54=await sales[_0x1d5ce7(0x266)]({'invoice':_0x33b12d});console[_0x1d5ce7(0x1e9)](_0x4c6f54),_0x4c6f54[_0x1d5ce7(0x20f)]=_0x1d5ce7(0x222);const _0x3c1370=await _0x4c6f54[_0x1d5ce7(0x1ff)](),_0x10691c=new sales_return({'invoice':_0x33b12d,'customer':_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x25a)],'date':_0x5501a9,'warehouse_name':_0x1e87f0,'room':_0x4aa52e,'ToWarehouse':_0x330741,'ToRoom':_0x14db7c,'return_sale':_0x23ff73,'note':_0x5299bf}),_0x380d26=await _0x10691c['save']();console[_0x1d5ce7(0x1e9)](_0x10691c);const _0x52a98a=await sales_return[_0x1d5ce7(0x266)]({'invoice':_0x33b12d}),_0x45ff10=await warehouse[_0x1d5ce7(0x266)]({'name':_0x330741,'room':_0x14db7c});_0x52a98a[_0x1d5ce7(0x2ce)][_0x1d5ce7(0x1f9)](_0x11e5d6=>{var _0x56c0d2=_0x1d5ce7,_0x50709a=0x0;const _0xd303e0=_0x45ff10[_0x56c0d2(0x24d)][_0x56c0d2(0x259)](_0xad8eb5=>{var _0x4af23c=_0x56c0d2;_0xad8eb5[_0x4af23c(0x2da)]==_0x11e5d6[_0x4af23c(0x2da)]&&_0xad8eb5[_0x4af23c(0x2d6)]==_0x11e5d6['floorlevel']&&_0xad8eb5[_0x4af23c(0x261)]==_0x11e5d6[_0x4af23c(0x261)]&&_0xad8eb5[_0x4af23c(0x260)]==_0x11e5d6['bin']&&_0xad8eb5['bay']==_0x11e5d6['bay']&&(_0xad8eb5[_0x4af23c(0x28d)]=parseInt(_0xad8eb5[_0x4af23c(0x28d)])+parseInt(_0x11e5d6[_0x4af23c(0x236)]),_0x50709a++);});_0x50709a=='0'&&(_0x45ff10[_0x56c0d2(0x24d)]=_0x45ff10[_0x56c0d2(0x24d)][_0x56c0d2(0x1fa)]({'product_name':_0x11e5d6[_0x56c0d2(0x2da)],'product_stock':_0x11e5d6[_0x56c0d2(0x236)],'primary_code':_0x11e5d6[_0x56c0d2(0x2a6)],'secondary_code':_0x11e5d6['secondary_code'],'product_code':_0x11e5d6[_0x56c0d2(0x255)],'bay':_0x11e5d6[_0x56c0d2(0x2a3)],'bin':_0x11e5d6['bin'],'type':_0x11e5d6[_0x56c0d2(0x261)],'floorlevel':_0x11e5d6[_0x56c0d2(0x2d6)]})),console['log'](_0x56c0d2(0x24b),_0x45ff10);}),await _0x45ff10[_0x1d5ce7(0x1ff)](),console['log'](_0x554734[_0x1d5ce7(0x291)]);const _0x197ed2=new c_payment_data({'invoice':_0x33b12d,'customer':_0x554734[_0x1d5ce7(0x291)]['customer'],'reason':_0x1d5ce7(0x23e)});await _0x197ed2[_0x1d5ce7(0x1ff)]();const _0x4adada=await master_shop[_0x1d5ce7(0x226)]();console[_0x1d5ce7(0x1e9)](_0x1d5ce7(0x212),_0x4adada[0x0][_0x1d5ce7(0x274)]);const _0x2adc30=await email_settings['findOne'](),_0x20c5d1=await customer[_0x1d5ce7(0x266)]({'name':_0x554734[_0x1d5ce7(0x291)][_0x1d5ce7(0x25a)]});console[_0x1d5ce7(0x1e9)](_0x1d5ce7(0x20e),_0x20c5d1);_0x4adada[0x0][_0x1d5ce7(0x292)]==0x1?(right_currency=_0x4adada[0x0][_0x1d5ce7(0x1da)],left_currency=''):(right_currency='',left_currency=_0x4adada[0x0][_0x1d5ce7(0x1da)]);var _0x1ab4e1=_0x19f0bd,_0x57ca78=_0x7ae4dd,_0x3bdbed='',_0x398da5;for(_0x398da5 in _0x1ab4e1){_0x3bdbed+=_0x1d5ce7(0x209)+_0x1d5ce7(0x1c9)+_0x1ab4e1[_0x398da5]+'</td>'+_0x1d5ce7(0x1c9)+_0x57ca78[_0x398da5]+_0x1d5ce7(0x2ab)+'</tr>';}console[_0x1d5ce7(0x1e9)](_0x1d5ce7(0x28c),_0x3bdbed);let _0x570204=nodemailer['createTransport']({'service':_0x1d5ce7(0x22f),'auth':{'user':_0x2adc30[_0x1d5ce7(0x2b1)],'pass':_0x2adc30[_0x1d5ce7(0x2c5)]}}),_0x20efc0={'from':_0x2adc30[_0x1d5ce7(0x2b1)],'to':_0x20c5d1['email'],'subject':_0x1d5ce7(0x22b),'attachments':[{'filename':_0x1d5ce7(0x201),'path':__dirname+_0x1d5ce7(0x29f)+_0x1d5ce7(0x223)+_0x4adada[0x0]['image'],'cid':'logo'}],'html':_0x1d5ce7(0x26c)+'<html><head><title></title>'+_0x1d5ce7(0x284)+_0x1d5ce7(0x252)+_0x1d5ce7(0x1f4)+_0x1d5ce7(0x252)+_0x1d5ce7(0x2c2)+_0x1d5ce7(0x262)+_0x1d5ce7(0x252)+'<h2>\x20'+_0x4adada[0x0]['site_title']+_0x1d5ce7(0x2ba)+_0x1d5ce7(0x262)+_0x1d5ce7(0x262)+_0x1d5ce7(0x203)+_0x1d5ce7(0x252)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x33b12d+'\x20'+_0x1d5ce7(0x207)+_0x1d5ce7(0x1d3)+_0x5501a9+'\x20'+'</span>'+'</h5>'+_0x1d5ce7(0x262)+_0x1d5ce7(0x208)+_0x1d5ce7(0x2a9)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1d5ce7(0x256)+_0x1d5ce7(0x243)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1d5ce7(0x278)+_0x1d5ce7(0x1d5)+_0x1d5ce7(0x269)+'\x20'+_0x3bdbed+'\x20'+_0x1d5ce7(0x296)+'</table>'+'<div>'+_0x1d5ce7(0x1ca)+_0x1d5ce7(0x26a)+_0x4adada[0x0][_0x1d5ce7(0x2db)]+'</h5>'+_0x1d5ce7(0x262)+_0x1d5ce7(0x262)+'</body></html>'};_0x570204['sendMail'](_0x20efc0,function(_0x3ae6d7,_0x59d469){var _0x7be5bc=_0x1d5ce7;_0x3ae6d7?(console[_0x7be5bc(0x1e9)](_0x3ae6d7),console[_0x7be5bc(0x1e9)](_0x7be5bc(0x218))):console[_0x7be5bc(0x1e9)](_0x7be5bc(0x28e));}),_0x554734[_0x1d5ce7(0x1e0)](_0x1d5ce7(0x1f7),_0x1d5ce7(0x279)),_0x58134d[_0x1d5ce7(0x2dc)](_0x1d5ce7(0x1e2));}catch(_0x33d40f){console['log'](_0x33d40f),_0x58134d['status'](0xc8)[_0x1d5ce7(0x26b)]({'message1':_0x33d40f['message']});}}),router['get'](a0_0x4734cd(0x21b),auth,async(_0x2487ab,_0x2816fa)=>{var _0x24a2cd=a0_0x4734cd;try{const {username:_0x2d47db,email:_0x118bfe,role:_0x855371}=_0x2487ab[_0x24a2cd(0x1df)],_0x52c34f=_0x2487ab[_0x24a2cd(0x1df)],_0x10c444=await profile[_0x24a2cd(0x266)]({'email':_0x52c34f[_0x24a2cd(0x2b1)]}),_0xd8dc66=await master_shop[_0x24a2cd(0x226)]();console[_0x24a2cd(0x1e9)](_0x24a2cd(0x1e4),_0xd8dc66);const _0x34720a=_0x2487ab[_0x24a2cd(0x231)]['id'],_0x3ff54e=await sales[_0x24a2cd(0x248)](_0x34720a);console[_0x24a2cd(0x1e9)](_0x24a2cd(0x27d),_0x3ff54e);if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]==_0x24a2cd(0x27e))var _0x553c26=users[_0x24a2cd(0x263)];else{if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]==_0x24a2cd(0x27a))var _0x553c26=users[_0x24a2cd(0x27a)];else{if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]==_0x24a2cd(0x1fd))var _0x553c26=users['German'];else{if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]=='Spanish')var _0x553c26=users[_0x24a2cd(0x234)];else{if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]==_0x24a2cd(0x1cb))var _0x553c26=users['French'];else{if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]==_0x24a2cd(0x2dd))var _0x553c26=users[_0x24a2cd(0x2d7)];else{if(_0xd8dc66[0x0]['language']==_0x24a2cd(0x271))var _0x553c26=users[_0x24a2cd(0x271)];else{if(_0xd8dc66[0x0][_0x24a2cd(0x29a)]==_0x24a2cd(0x2ac))var _0x553c26=users['Arabic'];}}}}}}}_0x2816fa[_0x24a2cd(0x2c4)]('all_sales_barcode',{'success':_0x2487ab[_0x24a2cd(0x1e0)](_0x24a2cd(0x1f7)),'errors':_0x2487ab['flash'](_0x24a2cd(0x2e2)),'role':_0x52c34f,'profile':_0x10c444,'alldata':_0x3ff54e,'master_shop':_0xd8dc66,'language':_0x553c26});}catch(_0x3230d6){console[_0x24a2cd(0x1e9)](_0x3230d6);}}),router['post'](a0_0x4734cd(0x24a),async(_0x3c2206,_0x4b4456)=>{var _0x5b36a8=a0_0x4734cd;const {product_code:_0x191376,warehouse_name:_0x45a388,rooms_data:_0x10474c,Roomslist:_0x2fc193}=_0x3c2206['body'],_0x3b9a03=_0x2fc193['split'](','),_0x46b253=[];async function _0x5bdbec(_0x420a39){var _0x405660=a0_0x2fc0;const _0x1aa97e=await warehouse[_0x405660(0x20d)]([{'$match':{'name':_0x45a388,'room':_0x420a39}},{'$unwind':_0x405660(0x1f5)},{'$match':{'product_details.primary_code':_0x191376}},{'$group':{'_id':_0x405660(0x2b7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x405660(0x217)},'primary_code':{'$first':_0x405660(0x251)},'secondary_code':{'$first':_0x405660(0x254)},'product_code':{'$first':_0x405660(0x295)},'level':{'$first':_0x405660(0x2ae)},'isle':{'$first':_0x405660(0x21d)},'type':{'$first':_0x405660(0x1ec)},'pallet':{'$first':_0x405660(0x219)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x405660(0x253)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x405660(0x25b)},'production_date':{'$first':_0x405660(0x204)},'maxPerUnit':{'$first':_0x405660(0x298)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x405660(0x1cf)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x405660(0x1d0)},'invoice':{'$first':_0x405660(0x1e7)},'actual_qty':{'$first':_0x405660(0x1de)},'actual_uom':{'$first':_0x405660(0x2cf)}}}]),_0x19a907=await warehouse[_0x405660(0x20d)]([{'$match':{'name':_0x45a388,'room':_0x420a39}},{'$unwind':_0x405660(0x1f5)},{'$match':{'product_details.secondary_code':_0x191376}},{'$group':{'_id':_0x405660(0x2b7),'name':{'$first':_0x405660(0x237)},'product_stock':{'$first':_0x405660(0x217)},'primary_code':{'$first':_0x405660(0x251)},'secondary_code':{'$first':_0x405660(0x254)},'product_code':{'$first':_0x405660(0x295)},'level':{'$first':_0x405660(0x2ae)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x405660(0x219)},'unit':{'$first':_0x405660(0x1f6)},'secondary_unit':{'$first':_0x405660(0x22e)},'storage':{'$first':_0x405660(0x253)},'rack':{'$first':_0x405660(0x28b)},'expiry_date':{'$first':_0x405660(0x25b)},'production_date':{'$first':_0x405660(0x204)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x405660(0x2d0)},'product_cat':{'$first':_0x405660(0x1cf)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x405660(0x1d0)},'invoice':{'$first':_0x405660(0x1e7)}}}]);if(_0x1aa97e[_0x405660(0x264)]>0x0)_0x46b253[_0x405660(0x2b3)](_0x1aa97e);else _0x19a907[_0x405660(0x264)]>0x0&&_0x46b253[_0x405660(0x2b3)](_0x19a907);}const _0x22bf48=_0x3b9a03['map'](_0x1917dd=>_0x5bdbec(_0x1917dd));await Promise[_0x5b36a8(0x2af)](_0x22bf48),_0x4b4456[_0x5b36a8(0x26b)](_0x46b253);}),module[a0_0x4734cd(0x2c3)]=router;