var a0_0x2527ae=a0_0x347e;(function(_0x5ad01d,_0xf84c23){var _0x4d4995=a0_0x347e,_0x1d0753=_0x5ad01d();while(!![]){try{var _0x43d914=-parseInt(_0x4d4995(0x1fc))/0x1+parseInt(_0x4d4995(0x258))/0x2+parseInt(_0x4d4995(0x1bf))/0x3*(-parseInt(_0x4d4995(0x292))/0x4)+parseInt(_0x4d4995(0x24e))/0x5+parseInt(_0x4d4995(0x20f))/0x6*(-parseInt(_0x4d4995(0x1d9))/0x7)+-parseInt(_0x4d4995(0x245))/0x8*(-parseInt(_0x4d4995(0x1fe))/0x9)+parseInt(_0x4d4995(0x1e2))/0xa*(-parseInt(_0x4d4995(0x2ca))/0xb);if(_0x43d914===_0xf84c23)break;else _0x1d0753['push'](_0x1d0753['shift']());}catch(_0x4e6d7c){_0x1d0753['push'](_0x1d0753['shift']());}}}(a0_0x4efb,0xe350c));function a0_0x347e(_0x26cdb3,_0x115401){var _0x4efbe8=a0_0x4efb();return a0_0x347e=function(_0x347ec4,_0x3293b3){_0x347ec4=_0x347ec4-0x1be;var _0x3ff0fa=_0x4efbe8[_0x347ec4];return _0x3ff0fa;},a0_0x347e(_0x26cdb3,_0x115401);}const express=require(a0_0x2527ae(0x290)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2527ae(0x1fd)),auth=require(a0_0x2527ae(0x23f)),nodemailer=require('nodemailer'),users=require(a0_0x2527ae(0x221));router['get']('/view',auth,async(_0x4ffd74,_0x1977e5)=>{var _0x193d3e=a0_0x2527ae;try{const {username:_0x53375a,email:_0x2571a5,role:_0x1b602b}=_0x4ffd74[_0x193d3e(0x2ba)],_0x1a2a3d=_0x4ffd74['user'],_0x4ab72f=await profile[_0x193d3e(0x234)]({'email':_0x1a2a3d[_0x193d3e(0x296)]}),_0x4ee64b=await master_shop[_0x193d3e(0x294)]();let _0x3a5089;if(_0x1a2a3d[_0x193d3e(0x262)]=='staff'){const _0x5d790b=await staff[_0x193d3e(0x234)]({'email':_0x1a2a3d[_0x193d3e(0x296)]});_0x3a5089=await sales[_0x193d3e(0x28b)]([{'$lookup':{'from':_0x193d3e(0x282),'localField':_0x193d3e(0x2a6),'foreignField':_0x193d3e(0x1cf),'as':_0x193d3e(0x1c6)}},{'$unwind':_0x193d3e(0x1f4)},{'$unwind':_0x193d3e(0x1d8)},{'$group':{'_id':_0x193d3e(0x20e),'invoice':{'$first':_0x193d3e(0x24a)},'customers':{'$first':_0x193d3e(0x1d6)},'date':{'$first':_0x193d3e(0x201)},'warehouse_name':{'$first':_0x193d3e(0x2a0)},'sale_product':{'$push':_0x193d3e(0x1d8)},'note':{'$first':_0x193d3e(0x233)},'return_data':{'$first':_0x193d3e(0x257)},'customers_docs':{'$first':_0x193d3e(0x1f4)},'total_saleproduct_quantity':{'$sum':_0x193d3e(0x279)},'level':{'$addToSet':_0x193d3e(0x1dd)},'isle':{'$addToSet':_0x193d3e(0x23e)},'type':{'$addToSet':_0x193d3e(0x2b2)},'pallet':{'$addToSet':_0x193d3e(0x1f7)},'finalize':{'$first':_0x193d3e(0x214)},'isAllowEdit':{'$first':_0x193d3e(0x1ca)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3a5089=await sales[_0x193d3e(0x28b)]([{'$lookup':{'from':_0x193d3e(0x282),'localField':_0x193d3e(0x2a6),'foreignField':_0x193d3e(0x1cf),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x193d3e(0x1d8)},{'$group':{'_id':_0x193d3e(0x20e),'invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x193d3e(0x201)},'warehouse_name':{'$first':_0x193d3e(0x2a0)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x193d3e(0x233)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x193d3e(0x1dd)},'isle':{'$addToSet':_0x193d3e(0x23e)},'type':{'$addToSet':_0x193d3e(0x2b2)},'pallet':{'$addToSet':_0x193d3e(0x1f7)},'finalize':{'$first':_0x193d3e(0x214)},'isAllowEdit':{'$first':_0x193d3e(0x1ca)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x193d3e(0x211)]('sales\x20all_data',_0x3a5089);if(_0x4ee64b[0x0][_0x193d3e(0x275)]==_0x193d3e(0x263)){var _0x52dd=users[_0x193d3e(0x1ea)];console['log'](_0x52dd);}else{if(_0x4ee64b[0x0][_0x193d3e(0x275)]=='Hindi')var _0x52dd=users[_0x193d3e(0x299)];else{if(_0x4ee64b[0x0][_0x193d3e(0x275)]==_0x193d3e(0x2b1))var _0x52dd=users[_0x193d3e(0x2b1)];else{if(_0x4ee64b[0x0][_0x193d3e(0x275)]==_0x193d3e(0x1dc))var _0x52dd=users[_0x193d3e(0x1dc)];else{if(_0x4ee64b[0x0][_0x193d3e(0x275)]==_0x193d3e(0x286))var _0x52dd=users[_0x193d3e(0x286)];else{if(_0x4ee64b[0x0]['language']==_0x193d3e(0x1f5))var _0x52dd=users[_0x193d3e(0x23a)];else{if(_0x4ee64b[0x0][_0x193d3e(0x275)]=='Chinese')var _0x52dd=users['Chinese'];else{if(_0x4ee64b[0x0][_0x193d3e(0x275)]==_0x193d3e(0x1e9))var _0x52dd=users[_0x193d3e(0x1cc)];}}}}}}}_0x1977e5[_0x193d3e(0x2a9)](_0x193d3e(0x25f),{'success':_0x4ffd74[_0x193d3e(0x2b7)]('success'),'errors':_0x4ffd74[_0x193d3e(0x2b7)]('errors'),'sales':_0x3a5089,'profile':_0x4ab72f,'role':_0x1a2a3d,'master_shop':_0x4ee64b,'language':_0x52dd});}catch(_0x167474){console[_0x193d3e(0x211)](_0x167474);}});function a0_0x4efb(){var _0x5c1853=['../public/language/languages.json','Sales\x20Mail','$product_details.product_cat','Return\x20Rooms','sale_qty','bay','requested_qty','$product','user_id','</h5>','$product_details.secondary_unit','exports','$room','get','Sales\x20Add\x20successfully','$product_details.actual_uom','<!DOCTYPE\x20html>','$product_details.unit','$note','findOne','/view/add_sale/product','Sales\x20Update\x20successfully','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','storage','Portuguese','/view/add_sales','/barcode_scanner','<strong>\x20Regards\x20</strong>','$sale_product.bin','../middleware/auth','\x20Order\x20Date\x20:\x20','stock_data','type','quantity','Enabled','360NQPFNd','RoomAssigned','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.actual_qty','room','$invoice','foreach\x20newproduct','floorlevel','$product_details.storage','8907580LqrFMV','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$product_details.product_code','master','/view/add_sales/:id','primary_unit','Floor','prod_code','$return_data','2997366aMngdU','$product_details.production_date','prod_invoice','SCRN','</head><body>','product_stock','$product_details.rack','all_sales','product','product_code','role','English\x20(US)','/all_sales/view','/preview/:id','/view/:id','sales_invoice','level','warehouse_name','staff','</table>','</span>','bin','$product_details.isle','Error\x20Occurs','$product_details.invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','secondary_unit','<h5>','Logo.png','language','expiry_date','Sale\x20Return','filter','$sale_product.quantity','$product_details.pallet','maxperunit','<hr\x20class=\x22my-3\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','back','unit','room_name','</td>','customers','add\x20post','secondary_code','Email\x20sent\x20successfully','French','received_amount','Sale\x20Return\x20Mail','/barcode/:id','sendMail','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','return_qty','product_data','body','express','password','273388CIUCsC','prod_cat','find','return_sale','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','False','Hindi','due_amount','types','actual_qty','host','Ambient','rack','$warehouse_name','Return\x20Goods','json','RMSEmail','post','<html><head><title></title>','customer','save','<h5\x20style=\x22text-align:\x20left;\x22>','render','$product_details','random','all','delivery_code','invoice','site_title','floor','German','$sale_product.type','edit_sales_view','True','stocks','</tbody>','flash','map','Level','user','sales_quantity','customer_data','createTransport','product_name','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','abs','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','redirect','sales\x20item\x20return\x20successfull','getMonth','status','$product_details.bay','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','454509dGUezT','push','image','9RaXJEW','$product_details.secondary_code','sale_product','catch','message','string','There\x27s\x20a\x20error\x20in\x20this\x20transaction','customers_docs','</tr>','return_data','</thead>','$isAllowEdit','batch_code','Arabic','\x20Order\x20Number\x20:\x20','/all_sales/preview/','name','port','error','getFullYear','</div>','$product_details.product_name','Shelves','$customer','production_date','$sale_product','7JLxoLo','success','note','Spanish','$sale_product.bay','/give_payment/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','Enclosed','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','80klvACL','$product_details._id','$product_details.level','quantity_notConverted','slice','add_sales','barcode\x20user_id','Arabic\x20(ae)','English','Raw\x20Materials','$product_details.primary_code','final','padStart','$product_details.type','max_per_unit','$product.product_name','actual_uom','product_details','$customers_docs','Portuguese\x20(BR)','gmail','$sale_product.floorlevel','barcode\x20Product\x20master','edit_sales','warehouse','_id','1046608tZxNAk','../models/all_models','99927BtfhFd','<span\x20style=\x22float:\x20right;\x22>','$name','$date','forEach','OUT-','primary_code','$product_details.bin','<tr>','$product_details.batch_code','findById','params','An\x20error\x20occurred\x20while\x20saving\x20data.','<div>','$product_details.product_stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$_id','7599294FWlwng','split','log','Chinese','Received\x20Payment\x20For\x20Sale','$finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','stock','$product_details.maxPerUnit','errors','$product_details.expiry_date','isAllowEdit','/../public','$product_details.floorlevel','/upload/','then','delivery_date','payment\x20successfull'];a0_0x4efb=function(){return _0x5c1853;};return a0_0x4efb();}async function getRandom8DigitNumber(){var _0x4461b7=a0_0x2527ae;const _0x3fa847=0x989680,_0x5a01d9=0x5f5e0ff,_0x58972f=Math[_0x4461b7(0x2b0)](Math[_0x4461b7(0x2ab)]()*(_0x5a01d9-_0x3fa847+0x1))+_0x3fa847;var _0x367837;const _0x37839b=await sales[_0x4461b7(0x234)]({'invoice':_0x4461b7(0x203)+_0x58972f});return _0x37839b&&_0x37839b[_0x4461b7(0x24f)]>0x0?_0x367837=_0x4461b7(0x203)+_0x58972f:_0x367837=_0x4461b7(0x203)+_0x58972f,_0x367837;}router[a0_0x2527ae(0x22e)](a0_0x2527ae(0x23b),auth,async(_0x2e584d,_0x334e9a)=>{var _0x2f1581=a0_0x2527ae;try{const {username:_0x3b2911,email:_0x3ab3f5,role:_0x59deb0}=_0x2e584d[_0x2f1581(0x2ba)],_0x18ded7=_0x2e584d['user'],_0x1d5768=await profile[_0x2f1581(0x234)]({'email':_0x18ded7[_0x2f1581(0x296)]}),_0x2bafa4=await master_shop[_0x2f1581(0x294)](),_0x34daa8=await customer[_0x2f1581(0x294)]({});let _0x2cc90b;if(_0x18ded7[_0x2f1581(0x262)]=='staff'){const _0x3e42aa=await staff[_0x2f1581(0x234)]({'email':_0x18ded7[_0x2f1581(0x296)]});_0x2cc90b=await warehouse['aggregate']([{'$match':{'status':_0x2f1581(0x244),'name':_0x3e42aa[_0x2f1581(0x1fa)],'warehouse_category':_0x2f1581(0x1eb),'name':{'$ne':_0x2f1581(0x2a1)}}},{'$group':{'_id':_0x2f1581(0x200),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2cc90b=await warehouse[_0x2f1581(0x28b)]([{'$match':{'status':_0x2f1581(0x244),'warehouse_category':_0x2f1581(0x1eb),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2f1581(0x200),'name':{'$first':_0x2f1581(0x200)}}},{'$sort':{'name':0x1}}]);const _0x34e6a8=await product[_0x2f1581(0x294)]({});var _0x54d350=[_0x2f1581(0x29e),_0x2f1581(0x1e0)];const _0x11cd09=await sales[_0x2f1581(0x294)]({}),_0x16a7c0=_0x11cd09[_0x2f1581(0x24f)]+0x1,_0x21291b='OUT-'+_0x16a7c0['toString']()[_0x2f1581(0x1ee)](0x5,'0');if(_0x2bafa4[0x0][_0x2f1581(0x275)]==_0x2f1581(0x263)){var _0x43bfe2=users[_0x2f1581(0x1ea)];console[_0x2f1581(0x211)](_0x43bfe2);}else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]==_0x2f1581(0x299))var _0x43bfe2=users[_0x2f1581(0x299)];else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]=='German')var _0x43bfe2=users['German'];else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]==_0x2f1581(0x1dc))var _0x43bfe2=users[_0x2f1581(0x1dc)];else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]==_0x2f1581(0x286))var _0x43bfe2=users[_0x2f1581(0x286)];else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]=='Portuguese\x20(BR)')var _0x43bfe2=users['Portuguese'];else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]==_0x2f1581(0x212))var _0x43bfe2=users[_0x2f1581(0x212)];else{if(_0x2bafa4[0x0][_0x2f1581(0x275)]=='Arabic\x20(ae)')var _0x43bfe2=users[_0x2f1581(0x1cc)];}}}}}}}const _0x296625=getRandom8DigitNumber();_0x296625[_0x2f1581(0x21e)](_0x841ff7=>{var _0x3eed10=_0x2f1581;_0x334e9a[_0x3eed10(0x2a9)](_0x3eed10(0x1e7),{'success':_0x2e584d[_0x3eed10(0x2b7)](_0x3eed10(0x1da)),'errors':_0x2e584d[_0x3eed10(0x2b7)](_0x3eed10(0x218)),'role':_0x18ded7,'profile':_0x1d5768,'customer':_0x34daa8,'warehouse':_0x2cc90b,'product':_0x34e6a8,'invoice':_0x841ff7,'master_shop':_0x2bafa4,'language':_0x43bfe2,'rooms_data':_0x54d350});})[_0x2f1581(0x1c2)](_0x2300b6=>{var _0x5145a3=_0x2f1581;_0x2e584d[_0x5145a3(0x2b7)]('errors',_0x5145a3(0x1c5)),_0x334e9a[_0x5145a3(0x2c3)](_0x5145a3(0x264));});}catch(_0x3b6ae4){console['log'](_0x3b6ae4);}}),router[a0_0x2527ae(0x22e)](a0_0x2527ae(0x253),auth,async(_0x240756,_0x49af44)=>{var _0x2877ee=a0_0x2527ae;try{const _0x5e203b=_0x240756[_0x2877ee(0x209)]['id'];console[_0x2877ee(0x211)](_0x5e203b);const _0x4f7528=await product[_0x2877ee(0x294)](),_0x2c4cd7=await purchases[_0x2877ee(0x28b)]([{'$match':{'warehouse_name':_0x5e203b}},{'$unwind':_0x2877ee(0x228)},{'$group':{'_id':_0x2877ee(0x1f1)}}]);console[_0x2877ee(0x211)](_0x2877ee(0x2bf),_0x2c4cd7),_0x49af44[_0x2877ee(0x2c6)](0xc8)['json']({'purchases_data':_0x2c4cd7,'product_data':_0x4f7528});}catch(_0x1bcc9f){console['log'](_0x1bcc9f);}}),router['post'](a0_0x2527ae(0x235),auth,async(_0x5a5c71,_0xf9da89)=>{var _0x46c7f5=a0_0x2527ae;try{const {warehouse_data:_0x15b243,product_data:_0x1734fb}=_0x5a5c71['body'];console[_0x46c7f5(0x211)](_0x5a5c71[_0x46c7f5(0x28f)][_0x46c7f5(0x28e)]);;const _0x1fecdc=await master_shop[_0x46c7f5(0x294)]();console[_0x46c7f5(0x211)](_0x46c7f5(0x252),_0x1fecdc);const _0x4288ab=await product[_0x46c7f5(0x234)]({'name':_0x1734fb});console[_0x46c7f5(0x211)](_0x46c7f5(0x260),_0x4288ab);const _0x4e6cc2=await warehouse[_0x46c7f5(0x28b)]([{'$match':{'name':_0x15b243}},{'$unwind':_0x46c7f5(0x2aa)},{'$match':{'product_details.product_name':_0x1734fb}},{'$group':{'_id':_0x46c7f5(0x1d4),'product_stock':{'$first':_0x46c7f5(0x20c)}}}]);console['log'](_0x46c7f5(0x241),_0x4e6cc2),_0xf9da89[_0x46c7f5(0x2c6)](0xc8)[_0x46c7f5(0x2a2)]({'master':_0x1fecdc,'new_product':_0x4288ab,'stock_data':_0x4e6cc2});}catch(_0xd4d6a3){console[_0x46c7f5(0x211)](_0xd4d6a3);}}),router[a0_0x2527ae(0x2a4)](a0_0x2527ae(0x23b),auth,async(_0x3ff59d,_0x4bb8df)=>{var _0x2e9207=a0_0x2527ae;try{const {invoice:_0x279a4f,date:_0x271345,warehouse_name:_0x26d39a,product_name:_0x37d3c1,stock:_0x101d57,quantity:_0x40819b,note:_0x4bf41c,room:_0xe73104,primary_code:_0x82a0be,secondary_code:_0xf7d31c,prod_code:_0x4bc020,level:_0x139647,isle:_0xb905c6,pallet:_0x5bd5c4,batch_code:_0x3ec14e,SCRN:_0x5972c7,expiry_date:_0x258dc9}=_0x3ff59d[_0x2e9207(0x28f)];if(typeof _0x37d3c1==_0x2e9207(0x1c4))var _0x39fadc=[_0x3ff59d[_0x2e9207(0x28f)]['product_name']],_0x3b8d13=[_0x3ff59d[_0x2e9207(0x28f)]['stock']],_0x1fd5b6=[_0x3ff59d[_0x2e9207(0x28f)]['carton']],_0x3a677c=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x204)]],_0x4d8d21=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x284)]],_0x53b0ca=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x256)]],_0x366e51=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x268)]],_0x4f3190=[_0x3ff59d['body'][_0x2e9207(0x254)]],_0x4e7acf=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x272)]],_0x59fbdb=[_0x3ff59d['body']['batch_code']],_0x37beb5=[_0x3ff59d['body']['expiry_date']],_0x3e0128=[_0x3ff59d['body'][_0x2e9207(0x1f0)]],_0x5c9ab2=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x1d7)]],_0x394092=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x227)]],_0xa05219=[_0x3ff59d['body'][_0x2e9207(0x21f)]],_0xc75ca9=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x2ad)]],_0x3e6891=[_0x3ff59d['body'][_0x2e9207(0x293)]],_0x5a16c6=[_0x3ff59d[_0x2e9207(0x28f)]['quantity']],_0x573838=[_0x3ff59d['body'][_0x2e9207(0x246)]],_0x532103=[_0x3ff59d['body']['prod_invoice']],_0x2442a7=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x29c)]],_0x4ffea6=[_0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x1f2)]];else var _0x39fadc=[..._0x3ff59d[_0x2e9207(0x28f)]['product_name']],_0x3b8d13=[..._0x3ff59d['body'][_0x2e9207(0x216)]],_0x1fd5b6=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x237)]],_0x3a677c=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x204)]],_0x4d8d21=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x284)]],_0x53b0ca=[..._0x3ff59d['body'][_0x2e9207(0x256)]],_0x366e51=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x268)]],_0x4f3190=[..._0x3ff59d[_0x2e9207(0x28f)]['primary_unit']],_0x4e7acf=[..._0x3ff59d[_0x2e9207(0x28f)]['secondary_unit']],_0x59fbdb=[..._0x3ff59d[_0x2e9207(0x28f)]['batch_code']],_0x37beb5=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x276)]],_0x3e0128=[..._0x3ff59d['body']['max_per_unit']],_0x5c9ab2=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x1d7)]],_0x394092=[..._0x3ff59d['body'][_0x2e9207(0x227)]],_0xa05219=[..._0x3ff59d['body'][_0x2e9207(0x21f)]],_0xc75ca9=[..._0x3ff59d['body'][_0x2e9207(0x2ad)]],_0x3e6891=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x293)]],_0x5a16c6=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x243)]],_0x573838=[..._0x3ff59d['body']['RoomAssigned']],_0x532103=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x25a)]],_0x2442a7=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x29c)]],_0x4ffea6=[..._0x3ff59d[_0x2e9207(0x28f)][_0x2e9207(0x1f2)]];const _0x472802=_0x39fadc[_0x2e9207(0x2b8)](_0x1b9610=>{return _0x1b9610={'product_name':_0x1b9610};});_0x3b8d13['forEach']((_0x59875c,_0x291bde)=>{_0x472802[_0x291bde]['stock']=Math['abs'](_0x59875c);}),_0x2442a7[_0x2e9207(0x202)]((_0x323c97,_0x2cfcdf)=>{var _0x401945=_0x2e9207;_0x472802[_0x2cfcdf][_0x401945(0x29c)]=Math[_0x401945(0x2c1)](_0x323c97);}),_0x4ffea6[_0x2e9207(0x202)]((_0x518a28,_0x22232a)=>{var _0x42f2e5=_0x2e9207;_0x472802[_0x22232a][_0x42f2e5(0x1f2)]=_0x518a28;}),_0x1fd5b6['forEach']((_0x14d0ff,_0x5a2fbd)=>{_0x472802[_0x5a2fbd]['quantity']=_0x14d0ff;}),_0x3a677c['forEach']((_0xaec81,_0x4e2d4d)=>{var _0xc7982f=_0x2e9207;_0x472802[_0x4e2d4d][_0xc7982f(0x204)]=_0xaec81;}),_0x4d8d21['forEach']((_0x1a9dd7,_0xd96bee)=>{var _0x3ae927=_0x2e9207;_0x472802[_0xd96bee][_0x3ae927(0x284)]=_0x1a9dd7;}),_0x53b0ca[_0x2e9207(0x202)]((_0x434ec4,_0x1bc587)=>{var _0x4d7114=_0x2e9207;_0x472802[_0x1bc587][_0x4d7114(0x261)]=_0x434ec4;}),_0x366e51['forEach']((_0x331aa8,_0x17e5b6)=>{var _0x30e0eb=_0x2e9207;_0x573838[_0x30e0eb(0x202)]((_0x2f1ca8,_0x4034fd)=>{var _0x41fbfa=_0x30e0eb;if(_0x2f1ca8=='Receiving\x20Area'&&_0x17e5b6==_0x4034fd){var _0x3af3b1=_0x331aa8['slice'](0x3);_0x472802[_0x17e5b6][_0x41fbfa(0x239)]=_0x331aa8[0x0],_0x472802[_0x17e5b6]['rack']=_0x331aa8[0x1],_0x472802[_0x17e5b6][_0x41fbfa(0x226)]=0x0,_0x472802[_0x17e5b6]['bin']=0x0,_0x472802[_0x17e5b6]['type']=_0x41fbfa(0x255),_0x472802[_0x17e5b6]['floorlevel']=_0x3af3b1;}else{if(_0x2f1ca8==_0x41fbfa(0x1d5)&&_0x17e5b6==_0x4034fd){var _0x3af3b1=_0x331aa8[_0x41fbfa(0x1e6)](0x3);_0x472802[_0x17e5b6][_0x41fbfa(0x239)]=_0x331aa8[0x0],_0x472802[_0x17e5b6][_0x41fbfa(0x29f)]=_0x331aa8[0x1],_0x472802[_0x17e5b6]['bay']=0x0,_0x472802[_0x17e5b6][_0x41fbfa(0x26d)]=0x0,_0x472802[_0x17e5b6][_0x41fbfa(0x242)]=_0x41fbfa(0x255),_0x472802[_0x17e5b6][_0x41fbfa(0x24c)]=_0x331aa8[0x5];}else{if(_0x17e5b6==_0x4034fd){var _0x5355f2;if(_0x331aa8[0x4]=='L')_0x5355f2=_0x41fbfa(0x2b9);else _0x331aa8[0x4]=='F'&&(_0x5355f2='Floor');_0x472802[_0x17e5b6][_0x41fbfa(0x239)]=_0x331aa8[0x0],_0x472802[_0x17e5b6][_0x41fbfa(0x29f)]=_0x331aa8[0x1],_0x472802[_0x17e5b6]['bay']=_0x331aa8[0x2],_0x472802[_0x17e5b6][_0x41fbfa(0x26d)]=_0x331aa8[0x3],_0x472802[_0x17e5b6][_0x41fbfa(0x242)]=_0x5355f2,_0x472802[_0x17e5b6]['floorlevel']=_0x331aa8[0x5];}}}});}),_0x4f3190[_0x2e9207(0x202)]((_0x407aaf,_0x1e9bdb)=>{var _0x4f0339=_0x2e9207;_0x472802[_0x1e9bdb][_0x4f0339(0x27f)]=_0x407aaf;}),_0x4e7acf[_0x2e9207(0x202)]((_0xf0dcaa,_0x7774ac)=>{var _0x5ee741=_0x2e9207;_0x472802[_0x7774ac][_0x5ee741(0x272)]=_0xf0dcaa;}),_0x59fbdb[_0x2e9207(0x202)]((_0x33c730,_0x4845d6)=>{var _0x5112e3=_0x2e9207;_0x472802[_0x4845d6][_0x5112e3(0x1cb)]=_0x33c730;}),_0x37beb5['forEach']((_0x34ffe1,_0x5e7268)=>{var _0x5d82c6=_0x2e9207;_0x472802[_0x5e7268][_0x5d82c6(0x276)]=_0x34ffe1;}),_0x3e0128[_0x2e9207(0x202)]((_0x2e834d,_0x5b146e)=>{_0x472802[_0x5b146e]['maxperunit']=_0x2e834d;}),_0x5c9ab2[_0x2e9207(0x202)]((_0x5de7cd,_0x5d607b)=>{_0x472802[_0x5d607b]['production_date']=_0x5de7cd;}),_0x394092[_0x2e9207(0x202)]((_0x30e0b0,_0x19e656)=>{var _0x54c5f0=_0x2e9207;_0x472802[_0x19e656][_0x54c5f0(0x227)]=_0x30e0b0;}),_0xa05219[_0x2e9207(0x202)]((_0x55134f,_0x1a4717)=>{var _0x390c3c=_0x2e9207;_0x472802[_0x1a4717][_0x390c3c(0x21f)]=_0x55134f;}),_0xc75ca9[_0x2e9207(0x202)]((_0x528c62,_0x16fb91)=>{var _0x1785d2=_0x2e9207;_0x472802[_0x16fb91][_0x1785d2(0x2ad)]=_0x528c62;}),_0x3e6891[_0x2e9207(0x202)]((_0x360aa1,_0x2012c3)=>{var _0x2eed65=_0x2e9207;_0x472802[_0x2012c3][_0x2eed65(0x293)]=_0x360aa1;}),_0x5a16c6[_0x2e9207(0x202)]((_0x17dd1f,_0x28692e)=>{var _0xed896=_0x2e9207;_0x472802[_0x28692e][_0xed896(0x1e5)]=_0x17dd1f;}),_0x573838['forEach']((_0x28dd36,_0x4321a9)=>{var _0x24cbf8=_0x2e9207;_0x472802[_0x4321a9][_0x24cbf8(0x280)]=_0x28dd36;}),_0x532103[_0x2e9207(0x202)]((_0x2b645b,_0x2693e5)=>{var _0x50961e=_0x2e9207;_0x472802[_0x2693e5][_0x50961e(0x2ae)]=_0x2b645b;});var _0x363afc=0x0;_0x472802[_0x2e9207(0x202)](_0x3bbe56=>{var _0x24977c=_0x2e9207;(_0x3bbe56['stock']<_0x3bbe56[_0x24977c(0x1e5)]||_0x3bbe56[_0x24977c(0x1e5)]==0x0)&&(console[_0x24977c(0x211)](_0x24977c(0x24b),_0x3bbe56),_0x363afc++);});const _0x23fe12=_0x472802['filter'](_0x96697a=>_0x96697a['quantity']!=='0'&&_0x96697a[_0x2e9207(0x243)]!==''),_0x2a0946=new sales({'invoice':_0x279a4f,'customer':_0x3ff59d['body'][_0x2e9207(0x2a6)],'date':_0x271345,'warehouse_name':_0x26d39a,'sale_product':_0x23fe12,'note':_0x4bf41c,'room':_0xe73104,'primary_code':_0x82a0be,'secondary_code':_0xf7d31c,'prod_code':_0x4bc020,'SCRN':_0x5972c7}),_0x302ac9=await _0x2a0946[_0x2e9207(0x2a7)]();_0x3ff59d[_0x2e9207(0x2b7)](_0x2e9207(0x1da),_0x2e9207(0x22f)),_0x4bb8df[_0x2e9207(0x2c3)](_0x2e9207(0x1ce)+_0x302ac9[_0x2e9207(0x1fb)]);}catch(_0x2b6189){console[_0x2e9207(0x211)](_0x2b6189);}}),router[a0_0x2527ae(0x22e)](a0_0x2527ae(0x265),auth,async(_0x131f43,_0x3e1d3f)=>{var _0x3a978b=a0_0x2527ae;try{const {username:_0x4c99f9,email:_0x5f48fa,role:_0x3c877a}=_0x131f43[_0x3a978b(0x2ba)],_0x481bab=_0x131f43[_0x3a978b(0x2ba)],_0x6f07d2=await profile[_0x3a978b(0x234)]({'email':_0x481bab[_0x3a978b(0x296)]}),_0x490b3d=await master_shop[_0x3a978b(0x294)](),_0xb11bfe=_0x131f43[_0x3a978b(0x209)]['id'],_0x10e8b9=await sales[_0x3a978b(0x208)](_0xb11bfe),_0x37c98c=await warehouse[_0x3a978b(0x28b)]([{'$match':{'name':_0x10e8b9[_0x3a978b(0x269)]}},{'$unwind':_0x3a978b(0x2aa)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3a978b(0x1d4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3a978b(0x2c7)},'bin':{'$first':_0x3a978b(0x205)},'type':{'$first':_0x3a978b(0x1ef)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3a978b(0x1ec)},'secondary_code':{'$first':_0x3a978b(0x1c0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3a978b(0x24d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3a978b(0x259)},'invoice':{'$first':_0x3a978b(0x270)}}}]),_0x2f1000=await customer[_0x3a978b(0x294)]({});let _0x483554;if(_0x481bab[_0x3a978b(0x262)]==_0x3a978b(0x26a)){const _0x14d115=await staff[_0x3a978b(0x234)]({'email':_0x481bab[_0x3a978b(0x296)]});_0x483554=await warehouse['aggregate']([{'$match':{'status':_0x3a978b(0x244),'name':_0x14d115[_0x3a978b(0x1fa)]}},{'$group':{'_id':_0x3a978b(0x200),'name':{'$first':_0x3a978b(0x200)}}}]);}else _0x483554=await warehouse[_0x3a978b(0x28b)]([{'$match':{'status':_0x3a978b(0x244)}},{'$group':{'_id':_0x3a978b(0x200),'name':{'$first':_0x3a978b(0x200)}}}]);const _0x403200=await product[_0x3a978b(0x294)]({}),_0x4188c7=await suppliers['find']({});if(_0x490b3d[0x0][_0x3a978b(0x275)]==_0x3a978b(0x263)){var _0xf0c926=users['English'];console[_0x3a978b(0x211)](_0xf0c926);}else{if(_0x490b3d[0x0]['language']=='Hindi')var _0xf0c926=users[_0x3a978b(0x299)];else{if(_0x490b3d[0x0][_0x3a978b(0x275)]==_0x3a978b(0x2b1))var _0xf0c926=users[_0x3a978b(0x2b1)];else{if(_0x490b3d[0x0]['language']=='Spanish')var _0xf0c926=users[_0x3a978b(0x1dc)];else{if(_0x490b3d[0x0][_0x3a978b(0x275)]==_0x3a978b(0x286))var _0xf0c926=users[_0x3a978b(0x286)];else{if(_0x490b3d[0x0]['language']=='Portuguese\x20(BR)')var _0xf0c926=users['Portuguese'];else{if(_0x490b3d[0x0][_0x3a978b(0x275)]=='Chinese')var _0xf0c926=users[_0x3a978b(0x212)];else{if(_0x490b3d[0x0]['language']==_0x3a978b(0x1e9))var _0xf0c926=users['Arabic'];}}}}}}}_0x3e1d3f['render'](_0x3a978b(0x2b3),{'success':_0x131f43[_0x3a978b(0x2b7)](_0x3a978b(0x1da)),'errors':_0x131f43[_0x3a978b(0x2b7)](_0x3a978b(0x218)),'role':_0x481bab,'profile':_0x6f07d2,'customer':_0x2f1000,'warehouse':_0x483554,'product':_0x37c98c,'user':_0x10e8b9,'master_shop':_0x490b3d,'unit':_0x403200,'language':_0xf0c926,'suppliers':_0x4188c7});}catch(_0x565609){console[_0x3a978b(0x211)](_0x565609);}}),router['post'](a0_0x2527ae(0x265),auth,async(_0x26ca5d,_0x1053d6)=>{var _0x41a71f=a0_0x2527ae;try{const _0x28b044=_0x26ca5d[_0x41a71f(0x209)]['id'],{invoice:_0x1e8c1c,warehouse_name:_0x5ba645,room:_0x40dbd6}=_0x26ca5d[_0x41a71f(0x28f)],_0xf3ae7b=await sales[_0x41a71f(0x234)]({'invoice':_0x1e8c1c}),_0xee4f16=_0xf3ae7b[_0x41a71f(0x1c1)][_0x41a71f(0x2b8)](async _0x5c15fb=>{var _0x47fce2=_0x41a71f,_0x131fa1=await warehouse['findOne']({'name':_0x5ba645,'room':_0x5c15fb[_0x47fce2(0x280)],'warehouse_category':_0x47fce2(0x1eb)});const _0x36a53e=_0x131fa1['product_details'][_0x47fce2(0x2b8)](_0x37e448=>{var _0x3a1d93=_0x47fce2;_0x37e448[_0x3a1d93(0x2be)]==_0x5c15fb[_0x3a1d93(0x2be)]&&_0x37e448[_0x3a1d93(0x24c)]==_0x5c15fb[_0x3a1d93(0x24c)]&&_0x37e448[_0x3a1d93(0x242)]==_0x5c15fb[_0x3a1d93(0x242)]&&_0x37e448['bin']==_0x5c15fb['bin']&&_0x37e448[_0x3a1d93(0x226)]==_0x5c15fb[_0x3a1d93(0x226)]&&_0x37e448[_0x3a1d93(0x29f)]==_0x5c15fb[_0x3a1d93(0x29f)]&&_0x37e448[_0x3a1d93(0x239)]==_0x5c15fb['storage']&&_0x37e448[_0x3a1d93(0x276)]==_0x5c15fb['expiry_date']&&_0x37e448['batch_code']==_0x5c15fb[_0x3a1d93(0x1cb)]&&_0x37e448[_0x3a1d93(0x2ae)]==_0x5c15fb['invoice']&&(_0x37e448['product_stock']=Math[_0x3a1d93(0x2c1)](_0x37e448[_0x3a1d93(0x25d)])-Math['abs'](_0x5c15fb[_0x3a1d93(0x243)]));});return _0x131fa1;});Promise[_0x41a71f(0x2ac)](_0xee4f16)[_0x41a71f(0x21e)](async _0x5b7e09=>{var _0x379b78=_0x41a71f;try{for(const _0x278a85 of _0x5b7e09){await _0x278a85[_0x379b78(0x2a7)]();}_0xf3ae7b['finalize']=_0x379b78(0x2b4);const _0x241cf0=await _0xf3ae7b[_0x379b78(0x2a7)](),_0x10d176=await master_shop['find'](),_0x23d67e=await email_settings[_0x379b78(0x234)](),_0x146036=await supervisor_settings[_0x379b78(0x294)]();var _0x2e4eec=_0xf3ae7b[_0x379b78(0x1c1)],_0x4484b9='',_0x33ebfd;for(_0x33ebfd in _0x2e4eec){_0x4484b9+=_0x379b78(0x206)+_0x379b78(0x20d)+_0x2e4eec[_0x33ebfd][_0x379b78(0x2be)]+_0x379b78(0x281)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e4eec[_0x33ebfd]['product_code']+_0x379b78(0x281)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e4eec[_0x33ebfd][_0x379b78(0x243)]+_0x379b78(0x281)+_0x379b78(0x20d)+_0x2e4eec[_0x33ebfd][_0x379b78(0x27f)]+_0x379b78(0x281)+_0x379b78(0x20d)+_0x2e4eec[_0x33ebfd][_0x379b78(0x272)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf3ae7b['warehouse_name']+_0x379b78(0x281)+_0x379b78(0x20d)+_0x2e4eec[_0x33ebfd][_0x379b78(0x280)]+_0x379b78(0x281)+_0x379b78(0x20d)+_0x2e4eec[_0x33ebfd]['storage']+_0x2e4eec[_0x33ebfd]['rack']+_0x2e4eec[_0x33ebfd]['bay']+_0x2e4eec[_0x33ebfd][_0x379b78(0x26d)]+_0x2e4eec[_0x33ebfd][_0x379b78(0x242)][0x0]+_0x2e4eec[_0x33ebfd][_0x379b78(0x24c)]+_0x379b78(0x281),_0x379b78(0x1c7);}let _0x34d12f=nodemailer[_0x379b78(0x2bd)]({'host':_0x23d67e[_0x379b78(0x29d)],'port':Number(_0x23d67e[_0x379b78(0x1d0)]),'secure':![],'auth':{'user':_0x23d67e[_0x379b78(0x296)],'pass':_0x23d67e[_0x379b78(0x291)]}}),_0x3b95fd={'from':_0x23d67e[_0x379b78(0x296)],'to':_0x146036[0x0][_0x379b78(0x2a3)],'subject':_0x379b78(0x222),'attachments':[{'filename':_0x379b78(0x274),'path':__dirname+'/../public'+_0x379b78(0x21d)+_0x10d176[0x0][_0x379b78(0x1be)],'cid':'logo'}],'html':_0x379b78(0x231)+_0x379b78(0x2a5)+_0x379b78(0x25c)+_0x379b78(0x20b)+_0x379b78(0x247)+_0x379b78(0x20b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x379b78(0x20b)+'<h2>\x20'+_0x10d176[0x0][_0x379b78(0x2af)]+_0x379b78(0x2c8)+_0x379b78(0x1d3)+_0x379b78(0x1d3)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x379b78(0x1cd)+_0xf3ae7b[_0x379b78(0x2ae)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x379b78(0x240)+_0xf3ae7b['date']+'\x20'+_0x379b78(0x26c)+_0x379b78(0x22a)+_0x379b78(0x1d3)+_0x379b78(0x27d)+_0x379b78(0x215)+_0x379b78(0x206)+_0x379b78(0x28c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x379b78(0x238)+_0x379b78(0x297)+_0x379b78(0x2c9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x379b78(0x2c0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x379b78(0x1c7)+_0x379b78(0x1c9)+_0x379b78(0x1df)+'\x20'+_0x4484b9+'\x20'+'</tbody>'+_0x379b78(0x26b)+'<div>'+_0x379b78(0x23d)+'<h5>'+_0x10d176[0x0][_0x379b78(0x2af)]+_0x379b78(0x22a)+_0x379b78(0x1d3)+_0x379b78(0x1d3)+'</body></html>'};_0x34d12f[_0x379b78(0x28a)](_0x3b95fd,function(_0x50a9f8,_0x15a007){var _0x12ce76=_0x379b78;_0x50a9f8?(console[_0x12ce76(0x211)](_0x50a9f8),console[_0x12ce76(0x211)](_0x12ce76(0x26f))):console[_0x12ce76(0x211)]('Email\x20sent\x20successfully');}),_0x26ca5d[_0x379b78(0x2b7)](_0x379b78(0x1da),_0x379b78(0x236)),_0x1053d6[_0x379b78(0x2c3)](_0x379b78(0x1ce)+_0x28b044);}catch(_0x227997){console['error'](_0x227997),_0x1053d6[_0x379b78(0x2c6)](0x1f4)[_0x379b78(0x2a2)]({'error':_0x379b78(0x20a)});}})[_0x41a71f(0x1c2)](_0x5aec8f=>{var _0x494135=_0x41a71f;console[_0x494135(0x1d1)](_0x5aec8f),_0x1053d6[_0x494135(0x2c6)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x4806cf){console[_0x41a71f(0x211)](_0x4806cf);}}),router[a0_0x2527ae(0x22e)](a0_0x2527ae(0x266),auth,async(_0x2c127f,_0x4eb875)=>{var _0x240101=a0_0x2527ae;try{const {username:_0x3204fc,email:_0x40cb0a,role:_0x1e2528}=_0x2c127f[_0x240101(0x2ba)],_0x376678=_0x2c127f[_0x240101(0x2ba)],_0x3f2130=await profile['findOne']({'email':_0x376678['email']}),_0x1a1d98=await master_shop['find'](),_0x143132=_0x2c127f['params']['id'],_0x32fe46=await sales['findById'](_0x143132);var _0x575b90=['Ambient',_0x240101(0x1e0)];const _0x3edccf=await warehouse['aggregate']([{'$match':{'name':_0x32fe46[_0x240101(0x269)],'warehouse_category':_0x240101(0x1eb)}},{'$unwind':_0x240101(0x2aa)},{'$group':{'_id':_0x240101(0x1e3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x240101(0x2c7)},'bin':{'$first':_0x240101(0x205)},'type':{'$first':_0x240101(0x1ef)},'floorlevel':{'$first':_0x240101(0x21c)},'primary_code':{'$first':_0x240101(0x1ec)},'secondary_code':{'$first':_0x240101(0x1c0)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x240101(0x24d)},'rack':{'$first':_0x240101(0x25e)}}}]),_0x54abc2=await customer[_0x240101(0x294)]({});let _0x1eda0b;if(_0x376678[_0x240101(0x262)]=='staff'){const _0x5d2e66=await staff[_0x240101(0x234)]({'email':_0x376678[_0x240101(0x296)]});_0x1eda0b=await warehouse['aggregate']([{'$match':{'status':_0x240101(0x244),'name':_0x5d2e66[_0x240101(0x1fa)],'warehouse_category':_0x240101(0x1eb)}},{'$group':{'_id':_0x240101(0x200),'name':{'$first':_0x240101(0x200)}}}]);}else _0x1eda0b=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x240101(0x1eb)}},{'$group':{'_id':_0x240101(0x200),'name':{'$first':'$name'}}}]);const _0x14c575=await product[_0x240101(0x294)]({});if(_0x1a1d98[0x0][_0x240101(0x275)]==_0x240101(0x263)){var _0x3ecce5=users[_0x240101(0x1ea)];console[_0x240101(0x211)](_0x3ecce5);}else{if(_0x1a1d98[0x0]['language']==_0x240101(0x299))var _0x3ecce5=users[_0x240101(0x299)];else{if(_0x1a1d98[0x0][_0x240101(0x275)]==_0x240101(0x2b1))var _0x3ecce5=users['German'];else{if(_0x1a1d98[0x0][_0x240101(0x275)]==_0x240101(0x1dc))var _0x3ecce5=users[_0x240101(0x1dc)];else{if(_0x1a1d98[0x0]['language']=='French')var _0x3ecce5=users['French'];else{if(_0x1a1d98[0x0]['language']=='Portuguese\x20(BR)')var _0x3ecce5=users[_0x240101(0x23a)];else{if(_0x1a1d98[0x0][_0x240101(0x275)]=='Chinese')var _0x3ecce5=users[_0x240101(0x212)];else{if(_0x1a1d98[0x0][_0x240101(0x275)]==_0x240101(0x1e9))var _0x3ecce5=users[_0x240101(0x1cc)];}}}}}}}_0x4eb875['render'](_0x240101(0x1f9),{'success':_0x2c127f[_0x240101(0x2b7)]('success'),'errors':_0x2c127f[_0x240101(0x2b7)](_0x240101(0x218)),'role':_0x376678,'profile':_0x3f2130,'customer':_0x54abc2,'warehouse':_0x1eda0b,'product':_0x3edccf,'user':_0x32fe46,'master_shop':_0x1a1d98,'unit':_0x14c575,'language':_0x3ecce5});}catch(_0x19d3f1){console[_0x240101(0x211)](_0x19d3f1);}}),router[a0_0x2527ae(0x2a4)]('/view/:id',auth,async(_0x31cbda,_0x33f26f)=>{var _0x19e746=a0_0x2527ae;try{const _0x19da9c=_0x31cbda['params']['id'],_0x2e526c=await sales[_0x19e746(0x234)]({'_id':_0x31cbda[_0x19e746(0x209)]['id']}),_0x1d49d5=await warehouse['findOne']({'name':_0x2e526c[_0x19e746(0x269)],'room':_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x249)]}),{invoice:_0x109bb0,date:_0x327a86,warehouse_name:_0x1fba28,product_name:_0x4f10f3,stock:_0x5435bf,quantity:_0x2cfbbc,note:_0x543ad1,room:_0xa0749a,customer:_0x597950,SCRN:_0x263781}=_0x31cbda[_0x19e746(0x28f)];if(typeof _0x4f10f3=='string')var _0x47b860=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x2be)]],_0x50535a=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x216)]],_0x38c212=[_0x31cbda['body'][_0x19e746(0x237)]],_0xef6d92=[_0x31cbda[_0x19e746(0x28f)]['primary_code']],_0x2d1a8b=[_0x31cbda['body'][_0x19e746(0x284)]],_0x2190c9=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x256)]],_0xaecba2=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x268)]],_0x41b56c=[_0x31cbda['body'][_0x19e746(0x254)]],_0x48a217=[_0x31cbda[_0x19e746(0x28f)]['secondary_unit']],_0x4eb42e=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x1cb)]],_0x1efecd=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x276)]],_0x31438e=[_0x31cbda['body'][_0x19e746(0x1f0)]],_0x57c96a=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x1d7)]],_0x57fadf=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x227)]],_0x4a01fd=[_0x31cbda['body'][_0x19e746(0x21f)]],_0x50cb9d=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x2ad)]],_0x1eff24=[_0x31cbda[_0x19e746(0x28f)]['prod_cat']],_0x59dd55=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x243)]],_0x4373e5=[_0x31cbda[_0x19e746(0x28f)][_0x19e746(0x246)]];else var _0x47b860=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x2be)]],_0x50535a=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x216)]],_0x38c212=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x237)]],_0xef6d92=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x204)]],_0x2d1a8b=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x284)]],_0x2190c9=[..._0x31cbda[_0x19e746(0x28f)]['prod_code']],_0xaecba2=[..._0x31cbda['body'][_0x19e746(0x268)]],_0x41b56c=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x254)]],_0x48a217=[..._0x31cbda[_0x19e746(0x28f)]['secondary_unit']],_0x4eb42e=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x1cb)]],_0x1efecd=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x276)]],_0x31438e=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x1f0)]],_0x57c96a=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x1d7)]],_0x57fadf=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x227)]],_0x4a01fd=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x21f)]],_0x50cb9d=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x2ad)]],_0x1eff24=[..._0x31cbda[_0x19e746(0x28f)]['prod_cat']],_0x59dd55=[..._0x31cbda['body'][_0x19e746(0x243)]],_0x4373e5=[..._0x31cbda[_0x19e746(0x28f)][_0x19e746(0x246)]];const _0xed2bc9=_0x47b860[_0x19e746(0x2b8)](_0x422779=>{return _0x422779={'product_name':_0x422779};});_0x50535a[_0x19e746(0x202)]((_0xf0fef2,_0x4cf9ff)=>{var _0x54f937=_0x19e746;_0xed2bc9[_0x4cf9ff][_0x54f937(0x216)]=Math[_0x54f937(0x2c1)](_0xf0fef2);}),_0x38c212['forEach']((_0x17a5a0,_0x45a6fb)=>{var _0x216e33=_0x19e746;_0xed2bc9[_0x45a6fb][_0x216e33(0x243)]=_0x17a5a0;}),_0xef6d92[_0x19e746(0x202)]((_0x5e077b,_0x33a887)=>{var _0x365153=_0x19e746;_0xed2bc9[_0x33a887][_0x365153(0x204)]=_0x5e077b;}),_0x2d1a8b[_0x19e746(0x202)]((_0x24678a,_0x47be29)=>{_0xed2bc9[_0x47be29]['secondary_code']=_0x24678a;}),_0x2190c9[_0x19e746(0x202)]((_0x33c8c3,_0x20c7f3)=>{var _0x1b4cef=_0x19e746;_0xed2bc9[_0x20c7f3][_0x1b4cef(0x261)]=_0x33c8c3;}),_0xaecba2[_0x19e746(0x202)]((_0x56d3b7,_0x4746f4)=>{_0x4373e5['forEach']((_0x2b8d67,_0xb13bd5)=>{var _0x4b24d1=a0_0x347e;if(_0x2b8d67=='Receiving\x20Area'&&_0x4746f4==_0xb13bd5){var _0x215d55=_0x56d3b7['slice'](0x3);_0xed2bc9[_0x4746f4][_0x4b24d1(0x239)]=_0x56d3b7[0x0],_0xed2bc9[_0x4746f4][_0x4b24d1(0x29f)]=_0x56d3b7[0x1],_0xed2bc9[_0x4746f4][_0x4b24d1(0x226)]=0x0,_0xed2bc9[_0x4746f4]['bin']=0x0,_0xed2bc9[_0x4746f4][_0x4b24d1(0x242)]='Floor',_0xed2bc9[_0x4746f4][_0x4b24d1(0x24c)]=_0x215d55;}else{if(_0x2b8d67==_0x4b24d1(0x1d5)&&_0x4746f4==_0xb13bd5){var _0x215d55=_0x56d3b7['slice'](0x3);_0xed2bc9[_0x4746f4][_0x4b24d1(0x239)]=_0x56d3b7[0x0],_0xed2bc9[_0x4746f4][_0x4b24d1(0x29f)]=_0x56d3b7[0x1],_0xed2bc9[_0x4746f4]['bay']=0x0,_0xed2bc9[_0x4746f4][_0x4b24d1(0x26d)]=0x0,_0xed2bc9[_0x4746f4][_0x4b24d1(0x242)]=_0x4b24d1(0x255),_0xed2bc9[_0x4746f4][_0x4b24d1(0x24c)]=_0x56d3b7[0x5];}else{if(_0x4746f4==_0xb13bd5){var _0x110020;if(_0x56d3b7[0x4]=='L')_0x110020=_0x4b24d1(0x2b9);else _0x56d3b7[0x4]=='F'&&(_0x110020='Floor');_0xed2bc9[_0x4746f4][_0x4b24d1(0x239)]=_0x56d3b7[0x0],_0xed2bc9[_0x4746f4][_0x4b24d1(0x29f)]=_0x56d3b7[0x1],_0xed2bc9[_0x4746f4][_0x4b24d1(0x226)]=_0x56d3b7[0x2],_0xed2bc9[_0x4746f4][_0x4b24d1(0x26d)]=_0x56d3b7[0x3],_0xed2bc9[_0x4746f4][_0x4b24d1(0x242)]=_0x110020,_0xed2bc9[_0x4746f4][_0x4b24d1(0x24c)]=_0x56d3b7[0x5];}}}});}),_0x41b56c[_0x19e746(0x202)]((_0x204296,_0x5cca50)=>{var _0x12c1cb=_0x19e746;_0xed2bc9[_0x5cca50][_0x12c1cb(0x27f)]=_0x204296;}),_0x48a217['forEach']((_0x35d320,_0x51b5d8)=>{var _0x3a37cb=_0x19e746;_0xed2bc9[_0x51b5d8][_0x3a37cb(0x272)]=_0x35d320;}),_0x4eb42e[_0x19e746(0x202)]((_0x308107,_0xf5c05d)=>{var _0x2185a9=_0x19e746;_0xed2bc9[_0xf5c05d][_0x2185a9(0x1cb)]=_0x308107;}),_0x1efecd['forEach']((_0xe9670c,_0x36a4b4)=>{var _0x33e4bc=_0x19e746;_0xed2bc9[_0x36a4b4][_0x33e4bc(0x276)]=_0xe9670c;}),_0x31438e['forEach']((_0x13866e,_0x360174)=>{var _0x345e86=_0x19e746;_0xed2bc9[_0x360174][_0x345e86(0x27b)]=_0x13866e;}),_0x57c96a[_0x19e746(0x202)]((_0x35eb66,_0x4df7f2)=>{var _0x55dde0=_0x19e746;_0xed2bc9[_0x4df7f2][_0x55dde0(0x1d7)]=_0x35eb66;}),_0x57fadf['forEach']((_0x5344f2,_0x1768a5)=>{var _0x215c08=_0x19e746;_0xed2bc9[_0x1768a5]['requested_qty']=Math[_0x215c08(0x2c1)](_0x5344f2);}),_0x4a01fd[_0x19e746(0x202)]((_0x2afd7e,_0x351f8d)=>{var _0x415761=_0x19e746;_0xed2bc9[_0x351f8d][_0x415761(0x21f)]=_0x2afd7e;}),_0x50cb9d[_0x19e746(0x202)]((_0x545ba6,_0x4a4c27)=>{var _0x5ee6d9=_0x19e746;_0xed2bc9[_0x4a4c27][_0x5ee6d9(0x2ad)]=_0x545ba6;}),_0x1eff24[_0x19e746(0x202)]((_0xb60f3b,_0x3e03ef)=>{var _0x17b919=_0x19e746;_0xed2bc9[_0x3e03ef][_0x17b919(0x293)]=_0xb60f3b;}),_0x59dd55[_0x19e746(0x202)]((_0x81190c,_0x3e1d88)=>{_0xed2bc9[_0x3e1d88]['quantity_notConverted']=_0x81190c;}),_0x4373e5['forEach']((_0xb0bbff,_0x1e39f7)=>{var _0x2dc9ec=_0x19e746;_0xed2bc9[_0x1e39f7][_0x2dc9ec(0x280)]=_0xb0bbff;});var _0x1e4a2d=0x0;_0xed2bc9[_0x19e746(0x202)](_0x3e2221=>{var _0x3663cd=_0x19e746;console[_0x3663cd(0x211)](_0x3663cd(0x24b),_0x3e2221),(parseInt(_0x3e2221[_0x3663cd(0x216)])<parseInt(_0x3e2221['quantity'])||parseInt(_0x3e2221[_0x3663cd(0x243)])==0x0)&&_0x1e4a2d++;});if(_0x1e4a2d!=0x0)return _0x31cbda[_0x19e746(0x2b7)](_0x19e746(0x218),_0x19e746(0x1e1)),_0x33f26f['redirect'](_0x19e746(0x27e));const _0x2e6b1a=_0xed2bc9[_0x19e746(0x278)](_0x57c058=>_0x57c058[_0x19e746(0x243)]!=='0'&&_0x57c058[_0x19e746(0x243)]!=='');_0x2e526c['invoice']=_0x109bb0,_0x2e526c[_0x19e746(0x2a6)]=_0x597950,_0x2e526c['date']=_0x327a86,_0x2e526c[_0x19e746(0x269)]=_0x1fba28,_0x2e526c['sale_product']=_0x2e6b1a,_0x2e526c[_0x19e746(0x1db)]=_0x543ad1,_0x2e526c[_0x19e746(0x25b)]=_0x263781,_0x2e526c['finalize']=_0x19e746(0x298),_0x2e526c[_0x19e746(0x21a)]='False';const _0x3ef9f=await _0x2e526c[_0x19e746(0x2a7)]();_0x31cbda[_0x19e746(0x2b7)](_0x19e746(0x1da),_0x19e746(0x236)),_0x33f26f[_0x19e746(0x2c3)](_0x19e746(0x264));}catch(_0x270adf){console[_0x19e746(0x211)](_0x270adf);}}),router[a0_0x2527ae(0x2a4)](a0_0x2527ae(0x1de),auth,async(_0x5b9164,_0x2e745c)=>{var _0x2832a5=a0_0x2527ae;try{const _0x4bdc12=_0x5b9164[_0x2832a5(0x209)]['id'],{invoice:_0x2e3c34,customer:_0x2aa8a8,receivable_amount:_0x3f4145,received_amount:_0x38f463}=_0x5b9164[_0x2832a5(0x28f)],_0x5b42bb=await sales['findById'](_0x4bdc12);console[_0x2832a5(0x211)](_0x5b42bb);var _0x25b704=_0x3f4145-_0x38f463;console['log'](_0x38f463),_0x5b42bb[_0x2832a5(0x287)]=parseFloat(_0x38f463)+parseFloat(_0x5b42bb[_0x2832a5(0x287)]),_0x5b42bb[_0x2832a5(0x29a)]=_0x25b704,console[_0x2832a5(0x211)](_0x5b42bb);const _0x300fda=await _0x5b42bb[_0x2832a5(0x2a7)](),_0x16377f=await c_payment_data[_0x2832a5(0x234)]({'invoice':_0x2e3c34});_0x16377f['amount']=_0x25b704,await _0x16377f['save']();let _0x1b84a8=new Date(),_0x5d9deb=('0'+_0x1b84a8['getDate']())[_0x2832a5(0x1e6)](-0x2),_0x3d3f1c=('0'+(_0x1b84a8[_0x2832a5(0x2c5)]()+0x1))[_0x2832a5(0x1e6)](-0x2),_0x330b34=_0x1b84a8[_0x2832a5(0x1d2)](),_0xfe48dd=_0x330b34+'-'+_0x3d3f1c+'-'+_0x5d9deb;const _0x3f4677=new customer_payment({'invoice':_0x2e3c34,'date':_0x330b34+'-'+_0x3d3f1c+'-'+_0x5d9deb,'customer':_0x2aa8a8,'reason':_0x2832a5(0x213),'amount':_0x38f463}),_0x2f4e36=await _0x3f4677[_0x2832a5(0x2a7)]();_0x5b9164[_0x2832a5(0x2b7)]('success',_0x2832a5(0x220)),_0x2e745c[_0x2832a5(0x2c3)](_0x2832a5(0x264));}catch(_0xa30c80){console[_0x2832a5(0x211)](_0xa30c80);}}),router['get']('/invoice/:id',auth,async(_0x3678b9,_0x404735)=>{var _0x586ccb=a0_0x2527ae;try{const {username:_0xff1f49,email:_0x5802c8,role:_0x336b6e}=_0x3678b9[_0x586ccb(0x2ba)],_0xc8d232=_0x3678b9['user'],_0x5e155e=await profile['findOne']({'email':_0xc8d232[_0x586ccb(0x296)]}),_0xb62f96=await master_shop[_0x586ccb(0x294)]();console[_0x586ccb(0x211)](_0x586ccb(0x252),_0xb62f96);const _0xa26030=_0x3678b9['params']['id'],_0x1fdeda=await sales[_0x586ccb(0x208)](_0xa26030);console['log'](_0x1fdeda);const _0x187452=await customer['findOne']({'name':_0x1fdeda[_0x586ccb(0x2a6)]});console[_0x586ccb(0x211)](_0x187452);if(_0xb62f96[0x0][_0x586ccb(0x275)]=='English\x20(US)'){var _0x36eeb6=users[_0x586ccb(0x1ea)];console[_0x586ccb(0x211)](_0x36eeb6);}else{if(_0xb62f96[0x0][_0x586ccb(0x275)]==_0x586ccb(0x299))var _0x36eeb6=users['Hindi'];else{if(_0xb62f96[0x0][_0x586ccb(0x275)]=='German')var _0x36eeb6=users['German'];else{if(_0xb62f96[0x0]['language']==_0x586ccb(0x1dc))var _0x36eeb6=users[_0x586ccb(0x1dc)];else{if(_0xb62f96[0x0][_0x586ccb(0x275)]==_0x586ccb(0x286))var _0x36eeb6=users[_0x586ccb(0x286)];else{if(_0xb62f96[0x0]['language']==_0x586ccb(0x1f5))var _0x36eeb6=users[_0x586ccb(0x23a)];else{if(_0xb62f96[0x0][_0x586ccb(0x275)]==_0x586ccb(0x212))var _0x36eeb6=users['Chinese'];else{if(_0xb62f96[0x0][_0x586ccb(0x275)]=='Arabic\x20(ae)')var _0x36eeb6=users[_0x586ccb(0x1cc)];}}}}}}}_0x404735['render'](_0x586ccb(0x267),{'success':_0x3678b9[_0x586ccb(0x2b7)]('success'),'errors':_0x3678b9[_0x586ccb(0x2b7)](_0x586ccb(0x218)),'role':_0xc8d232,'profile':_0x5e155e,'master_shop':_0xb62f96,'customers':_0x187452,'sales':_0x1fdeda,'language':_0x36eeb6});}catch(_0x192583){console[_0x586ccb(0x211)](_0x192583);}}),router[a0_0x2527ae(0x22e)]('/view/return_sales/:id',auth,async(_0x3d46fb,_0x41d5b5)=>{var _0x1d25f1=a0_0x2527ae;try{const {username:_0x3aee71,email:_0xecd37,role:_0x5aba62}=_0x3d46fb['user'],_0x1d0df4=_0x3d46fb[_0x1d25f1(0x2ba)],_0xe3698d=await profile[_0x1d25f1(0x234)]({'email':_0x1d0df4[_0x1d25f1(0x296)]}),_0x44a178=await master_shop[_0x1d25f1(0x294)]();console[_0x1d25f1(0x211)](_0x1d25f1(0x252),_0x44a178);const _0x433b73=_0x3d46fb['params']['id'];console[_0x1d25f1(0x211)](_0x433b73);const _0x1f32af=await sales['findById'](_0x433b73);console['log'](_0x1d25f1(0x229),_0x1f32af);const _0x286c1a=await warehouse[_0x1d25f1(0x28b)]([{'$match':{'name':_0x1d25f1(0x2a1),'room':_0x1d25f1(0x224)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1d25f1(0x20c)},'level':{'$first':_0x1d25f1(0x1e4)},'isle':{'$first':_0x1d25f1(0x26e)},'pallet':{'$first':_0x1d25f1(0x27a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1d25f1(0x1c0)},'product_code':{'$first':_0x1d25f1(0x251)}}}]);console['log'](_0x1d25f1(0x241),_0x286c1a);const _0x139d68=await product[_0x1d25f1(0x294)]({});warehouse_data=await warehouse[_0x1d25f1(0x28b)]([{'$match':{'status':_0x1d25f1(0x244),'name':_0x1d25f1(0x2a1),'warehouse_category':_0x1d25f1(0x1eb)}},{'$group':{'_id':_0x1d25f1(0x200),'name':{'$first':_0x1d25f1(0x200)}}},{'$sort':{'name':0x1}}]);var _0x5254f0=['Return\x20Rooms'];if(_0x44a178[0x0]['language']=='English\x20(US)'){var _0x876433=users[_0x1d25f1(0x1ea)];console[_0x1d25f1(0x211)](_0x876433);}else{if(_0x44a178[0x0]['language']==_0x1d25f1(0x299))var _0x876433=users[_0x1d25f1(0x299)];else{if(_0x44a178[0x0][_0x1d25f1(0x275)]==_0x1d25f1(0x2b1))var _0x876433=users['German'];else{if(_0x44a178[0x0][_0x1d25f1(0x275)]==_0x1d25f1(0x1dc))var _0x876433=users['Spanish'];else{if(_0x44a178[0x0]['language']==_0x1d25f1(0x286))var _0x876433=users[_0x1d25f1(0x286)];else{if(_0x44a178[0x0]['language']==_0x1d25f1(0x1f5))var _0x876433=users[_0x1d25f1(0x23a)];else{if(_0x44a178[0x0][_0x1d25f1(0x275)]==_0x1d25f1(0x212))var _0x876433=users[_0x1d25f1(0x212)];else{if(_0x44a178[0x0][_0x1d25f1(0x275)]==_0x1d25f1(0x1e9))var _0x876433=users['Arabic'];}}}}}}}_0x41d5b5[_0x1d25f1(0x2a9)](_0x1d25f1(0x295),{'success':_0x3d46fb['flash'](_0x1d25f1(0x1da)),'errors':_0x3d46fb['flash']('errors'),'role':_0x1d0df4,'profile':_0xe3698d,'user':_0x1f32af,'stock':_0x286c1a,'master_shop':_0x44a178,'unit':_0x139d68,'language':_0x876433,'warehouses':warehouse_data,'rooms':_0x5254f0});}catch(_0x3fb4b1){console['log'](_0x3fb4b1),_0x41d5b5[_0x1d25f1(0x2c6)](0xc8)[_0x1d25f1(0x2a2)]({'message':_0x3fb4b1[_0x1d25f1(0x1c3)]});}}),router[a0_0x2527ae(0x2a4)]('/view/return_sales/:id',auth,async(_0x25f12d,_0x4074a7)=>{var _0x5516ed=a0_0x2527ae;try{const {invoice:_0x4d2608,date:_0x53efa7,warehouse_name:_0x5cbf74,product_name:_0x1e198b,primary_code:_0x4d11f5,secondary_code:_0x25d421,product_code:_0x53087f,sales_quantity:_0x296eb5,stocks:_0x2fc967,return_qty:_0x4bc5ec,Room_name:_0x4bfa5f,to_warehouse_name:_0x5d670f,to_Roomname:_0x43d835,to_Room_name:_0x45d3e6,note:_0x55db5c,level:_0x30c8d1,isle:_0x4d0369,pallet:_0x172c57}=_0x25f12d[_0x5516ed(0x28f)];if(typeof _0x1e198b==_0x5516ed(0x1c4))var _0x51c9f5=[_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2be)]],_0x3b4d8e=[_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x204)]],_0x199e68=[_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x284)]],_0x4df56c=[_0x25f12d['body'][_0x5516ed(0x261)]],_0x58527c=[_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2bb)]],_0x30b8f8=[_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2b5)]],_0x3e3c23=[_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x28d)]],_0x175311=[_0x25f12d['body'][_0x5516ed(0x226)]],_0xc6a030=[_0x25f12d[_0x5516ed(0x28f)]['bin']],_0x1c7465=[_0x25f12d['body'][_0x5516ed(0x29b)]],_0xd2ed17=[_0x25f12d['body'][_0x5516ed(0x24c)]];else var _0x51c9f5=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2be)]],_0x3b4d8e=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x204)]],_0x199e68=[..._0x25f12d['body']['secondary_code']],_0x4df56c=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x261)]],_0x58527c=[..._0x25f12d[_0x5516ed(0x28f)]['sales_quantity']],_0x30b8f8=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2b5)]],_0x3e3c23=[..._0x25f12d['body'][_0x5516ed(0x28d)]],_0x175311=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x226)]],_0xc6a030=[..._0x25f12d[_0x5516ed(0x28f)]['bin']],_0x1c7465=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x29b)]],_0xd2ed17=[..._0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x24c)]];const _0x48b460=_0x51c9f5[_0x5516ed(0x2b8)](_0x530bea=>{return _0x530bea={'product_name':_0x530bea};});_0x3b4d8e[_0x5516ed(0x202)]((_0x2d77b0,_0x13441c)=>{var _0x368ed8=_0x5516ed;_0x48b460[_0x13441c][_0x368ed8(0x204)]=_0x2d77b0;}),_0x199e68[_0x5516ed(0x202)]((_0x40141b,_0x238dbe)=>{var _0x42b5da=_0x5516ed;_0x48b460[_0x238dbe][_0x42b5da(0x284)]=_0x40141b;}),_0x4df56c[_0x5516ed(0x202)]((_0xb5ce65,_0x31961a)=>{var _0x27cee8=_0x5516ed;_0x48b460[_0x31961a][_0x27cee8(0x261)]=_0xb5ce65;}),_0x58527c['forEach']((_0x2e0f3c,_0x1e06aa)=>{_0x48b460[_0x1e06aa]['sale_qty']=_0x2e0f3c;}),_0x30b8f8[_0x5516ed(0x202)]((_0x2bf00c,_0x3a603b)=>{var _0x3a8fc3=_0x5516ed;_0x48b460[_0x3a603b][_0x3a8fc3(0x216)]=_0x2bf00c;}),_0x3e3c23['forEach']((_0x242d24,_0x47f258)=>{var _0x13855d=_0x5516ed;_0x48b460[_0x47f258][_0x13855d(0x28d)]=_0x242d24;}),_0x175311[_0x5516ed(0x202)]((_0x48dd1d,_0x5d5efc)=>{var _0x4e55cd=_0x5516ed;_0x48b460[_0x5d5efc][_0x4e55cd(0x226)]=_0x48dd1d;}),_0xc6a030[_0x5516ed(0x202)]((_0x5bc2ab,_0x5d3349)=>{var _0x4c7436=_0x5516ed;_0x48b460[_0x5d3349][_0x4c7436(0x26d)]=_0x5bc2ab;}),_0x1c7465['forEach']((_0x3fb81e,_0x268a94)=>{_0x48b460[_0x268a94]['type']=_0x3fb81e;}),_0xd2ed17[_0x5516ed(0x202)]((_0x4163dd,_0x1d9659)=>{var _0x308dea=_0x5516ed;_0x48b460[_0x1d9659][_0x308dea(0x24c)]=_0x4163dd;});var _0x386827=0x0;_0x48b460[_0x5516ed(0x202)](_0x34b369=>{var _0x23702b=_0x5516ed;console[_0x23702b(0x211)](_0x23702b(0x24b),_0x34b369),(parseInt(_0x34b369[_0x23702b(0x225)])<parseInt(_0x34b369['return_qty'])||parseInt(_0x34b369['stock'])<parseInt(_0x34b369['return_qty'])&&parseInt(_0x34b369[_0x23702b(0x225)])>parseInt(_0x34b369[_0x23702b(0x28d)])||parseInt(_0x34b369[_0x23702b(0x28d)])==0x0)&&_0x386827++;});if(_0x386827!=0x0)return _0x25f12d[_0x5516ed(0x2b7)]('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x4074a7[_0x5516ed(0x2c3)](_0x5516ed(0x27e));const _0x41a26f=await sales['findOne']({'invoice':_0x4d2608});console[_0x5516ed(0x211)](_0x41a26f),_0x41a26f[_0x5516ed(0x1c8)]=_0x5516ed(0x2b4);const _0x5fdca6=await _0x41a26f[_0x5516ed(0x2a7)](),_0x12ef93=new sales_return({'invoice':_0x4d2608,'customer':_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2a6)],'date':_0x53efa7,'warehouse_name':_0x5cbf74,'room':_0x4bfa5f,'ToWarehouse':_0x5d670f,'ToRoom':_0x45d3e6,'return_sale':_0x48b460,'note':_0x55db5c}),_0x4edf75=await _0x12ef93[_0x5516ed(0x2a7)]();console[_0x5516ed(0x211)](_0x12ef93);const _0x12ad00=await sales_return[_0x5516ed(0x234)]({'invoice':_0x4d2608}),_0x34e49f=await warehouse[_0x5516ed(0x234)]({'name':_0x5d670f,'room':_0x45d3e6});_0x12ad00[_0x5516ed(0x295)]['forEach'](_0x1b814f=>{var _0x2c742e=_0x5516ed,_0x199593=0x0;const _0x183727=_0x34e49f[_0x2c742e(0x1f3)][_0x2c742e(0x2b8)](_0x230d9e=>{var _0x5a2167=_0x2c742e;_0x230d9e[_0x5a2167(0x2be)]==_0x1b814f[_0x5a2167(0x2be)]&&_0x230d9e[_0x5a2167(0x24c)]==_0x1b814f[_0x5a2167(0x24c)]&&_0x230d9e[_0x5a2167(0x242)]==_0x1b814f[_0x5a2167(0x242)]&&_0x230d9e[_0x5a2167(0x26d)]==_0x1b814f[_0x5a2167(0x26d)]&&_0x230d9e[_0x5a2167(0x226)]==_0x1b814f[_0x5a2167(0x226)]&&(_0x230d9e[_0x5a2167(0x25d)]=parseInt(_0x230d9e['product_stock'])+parseInt(_0x1b814f[_0x5a2167(0x28d)]),_0x199593++);});_0x199593=='0'&&(_0x34e49f[_0x2c742e(0x1f3)]=_0x34e49f[_0x2c742e(0x1f3)]['concat']({'product_name':_0x1b814f['product_name'],'product_stock':_0x1b814f[_0x2c742e(0x28d)],'primary_code':_0x1b814f[_0x2c742e(0x204)],'secondary_code':_0x1b814f['secondary_code'],'product_code':_0x1b814f[_0x2c742e(0x261)],'bay':_0x1b814f[_0x2c742e(0x226)],'bin':_0x1b814f[_0x2c742e(0x26d)],'type':_0x1b814f[_0x2c742e(0x242)],'floorlevel':_0x1b814f[_0x2c742e(0x24c)]})),console['log'](_0x2c742e(0x1ed),_0x34e49f);}),await _0x34e49f[_0x5516ed(0x2a7)](),console[_0x5516ed(0x211)](_0x25f12d[_0x5516ed(0x28f)]);const _0x1c1451=new c_payment_data({'invoice':_0x4d2608,'customer':_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2a6)],'reason':_0x5516ed(0x277)});await _0x1c1451[_0x5516ed(0x2a7)]();const _0x1901fb=await master_shop[_0x5516ed(0x294)]();console['log'](_0x5516ed(0x283),_0x1901fb[0x0]['image']);const _0x17da23=await email_settings[_0x5516ed(0x234)](),_0x4ca254=await customer['findOne']({'name':_0x25f12d[_0x5516ed(0x28f)][_0x5516ed(0x2a6)]});console['log'](_0x5516ed(0x2bc),_0x4ca254);_0x1901fb[0x0]['currency_placement']==0x1?(right_currency=_0x1901fb[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1901fb[0x0]['currency']);var _0x49a9e5=_0x51c9f5,_0x126fd2=_0x3e3c23,_0x88393b='',_0x3596b5;for(_0x3596b5 in _0x49a9e5){_0x88393b+=_0x5516ed(0x206)+_0x5516ed(0x20d)+_0x49a9e5[_0x3596b5]+_0x5516ed(0x281)+_0x5516ed(0x20d)+_0x126fd2[_0x3596b5]+_0x5516ed(0x281)+_0x5516ed(0x1c7);}console[_0x5516ed(0x211)]('product_list',_0x88393b);let _0x992a83=nodemailer[_0x5516ed(0x2bd)]({'service':_0x5516ed(0x1f6),'auth':{'user':_0x17da23['email'],'pass':_0x17da23['password']}}),_0x13fdd1={'from':_0x17da23['email'],'to':_0x4ca254[_0x5516ed(0x296)],'subject':_0x5516ed(0x288),'attachments':[{'filename':_0x5516ed(0x274),'path':__dirname+_0x5516ed(0x21b)+_0x5516ed(0x21d)+_0x1901fb[0x0][_0x5516ed(0x1be)],'cid':'logo'}],'html':_0x5516ed(0x231)+_0x5516ed(0x2a5)+'</head><body>'+_0x5516ed(0x20b)+_0x5516ed(0x247)+_0x5516ed(0x20b)+_0x5516ed(0x2c2)+_0x5516ed(0x1d3)+_0x5516ed(0x20b)+'<h2>\x20'+_0x1901fb[0x0]['site_title']+_0x5516ed(0x2c8)+'</div>'+_0x5516ed(0x1d3)+_0x5516ed(0x27c)+_0x5516ed(0x20b)+_0x5516ed(0x2a8)+'\x20Order\x20Number\x20:\x20'+_0x4d2608+'\x20'+_0x5516ed(0x1ff)+_0x5516ed(0x240)+_0x53efa7+'\x20'+'</span>'+_0x5516ed(0x22a)+_0x5516ed(0x1d3)+_0x5516ed(0x27d)+_0x5516ed(0x215)+_0x5516ed(0x206)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5516ed(0x250)+_0x5516ed(0x271)+'</tr>'+_0x5516ed(0x1c9)+_0x5516ed(0x1df)+'\x20'+_0x88393b+'\x20'+_0x5516ed(0x2b6)+'</table>'+_0x5516ed(0x20b)+_0x5516ed(0x23d)+_0x5516ed(0x273)+_0x1901fb[0x0][_0x5516ed(0x2af)]+_0x5516ed(0x22a)+'</div>'+_0x5516ed(0x1d3)+'</body></html>'};_0x992a83[_0x5516ed(0x28a)](_0x13fdd1,function(_0x6aaf6e,_0x33be44){var _0x46e4af=_0x5516ed;_0x6aaf6e?(console['log'](_0x6aaf6e),console[_0x46e4af(0x211)](_0x46e4af(0x26f))):console[_0x46e4af(0x211)](_0x46e4af(0x285));}),_0x25f12d[_0x5516ed(0x2b7)](_0x5516ed(0x1da),_0x5516ed(0x2c4)),_0x4074a7['redirect'](_0x5516ed(0x264));}catch(_0x6523ba){console[_0x5516ed(0x211)](_0x6523ba),_0x4074a7[_0x5516ed(0x2c6)](0xc8)['json']({'message1':_0x6523ba[_0x5516ed(0x1c3)]});}}),router[a0_0x2527ae(0x22e)](a0_0x2527ae(0x289),auth,async(_0x2fc7ab,_0x54b02)=>{var _0x19def6=a0_0x2527ae;try{const {username:_0x21a986,email:_0x3f28cc,role:_0x2fadbc}=_0x2fc7ab[_0x19def6(0x2ba)],_0x4da8e1=_0x2fc7ab[_0x19def6(0x2ba)],_0x15f84c=await profile[_0x19def6(0x234)]({'email':_0x4da8e1[_0x19def6(0x296)]}),_0xf6b7f1=await master_shop[_0x19def6(0x294)]();console[_0x19def6(0x211)](_0x19def6(0x1f8),_0xf6b7f1);const _0x31cd23=_0x2fc7ab['params']['id'],_0x51e61f=await sales[_0x19def6(0x208)](_0x31cd23);console['log'](_0x19def6(0x1e8),_0x51e61f);if(_0xf6b7f1[0x0][_0x19def6(0x275)]==_0x19def6(0x263))var _0xb1a2eb=users[_0x19def6(0x1ea)];else{if(_0xf6b7f1[0x0][_0x19def6(0x275)]==_0x19def6(0x299))var _0xb1a2eb=users[_0x19def6(0x299)];else{if(_0xf6b7f1[0x0][_0x19def6(0x275)]=='German')var _0xb1a2eb=users[_0x19def6(0x2b1)];else{if(_0xf6b7f1[0x0][_0x19def6(0x275)]==_0x19def6(0x1dc))var _0xb1a2eb=users[_0x19def6(0x1dc)];else{if(_0xf6b7f1[0x0][_0x19def6(0x275)]==_0x19def6(0x286))var _0xb1a2eb=users[_0x19def6(0x286)];else{if(_0xf6b7f1[0x0]['language']==_0x19def6(0x1f5))var _0xb1a2eb=users[_0x19def6(0x23a)];else{if(_0xf6b7f1[0x0][_0x19def6(0x275)]==_0x19def6(0x212))var _0xb1a2eb=users[_0x19def6(0x212)];else{if(_0xf6b7f1[0x0][_0x19def6(0x275)]=='Arabic\x20(ae)')var _0xb1a2eb=users[_0x19def6(0x1cc)];}}}}}}}_0x54b02['render']('all_sales_barcode',{'success':_0x2fc7ab[_0x19def6(0x2b7)](_0x19def6(0x1da)),'errors':_0x2fc7ab[_0x19def6(0x2b7)](_0x19def6(0x218)),'role':_0x4da8e1,'profile':_0x15f84c,'alldata':_0x51e61f,'master_shop':_0xf6b7f1,'language':_0xb1a2eb});}catch(_0x41b062){console[_0x19def6(0x211)](_0x41b062);}}),router[a0_0x2527ae(0x2a4)](a0_0x2527ae(0x23c),async(_0x1c3265,_0x587b37)=>{var _0x1ad348=a0_0x2527ae;const {product_code:_0x1ce7f9,warehouse_name:_0x11942d,rooms_data:_0x4460bd,Roomslist:_0xb0fbfd}=_0x1c3265[_0x1ad348(0x28f)],_0x487c97=_0xb0fbfd[_0x1ad348(0x210)](','),_0x5036de=[];async function _0x265821(_0x20fa6f){var _0x52ac67=_0x1ad348;const _0x1f69b2=await warehouse[_0x52ac67(0x28b)]([{'$match':{'name':_0x11942d,'room':_0x20fa6f}},{'$unwind':_0x52ac67(0x2aa)},{'$match':{'product_details.primary_code':_0x1ce7f9}},{'$group':{'_id':_0x52ac67(0x1e3),'name':{'$first':_0x52ac67(0x1d4)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x52ac67(0x1ec)},'secondary_code':{'$first':_0x52ac67(0x1c0)},'product_code':{'$first':_0x52ac67(0x251)},'level':{'$first':_0x52ac67(0x2c7)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x52ac67(0x21c)},'unit':{'$first':_0x52ac67(0x232)},'secondary_unit':{'$first':_0x52ac67(0x22b)},'storage':{'$first':_0x52ac67(0x24d)},'rack':{'$first':_0x52ac67(0x25e)},'expiry_date':{'$first':_0x52ac67(0x219)},'production_date':{'$first':_0x52ac67(0x259)},'maxPerUnit':{'$first':_0x52ac67(0x217)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x52ac67(0x223)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x52ac67(0x22d)},'invoice':{'$first':_0x52ac67(0x270)},'actual_qty':{'$first':_0x52ac67(0x248)},'actual_uom':{'$first':_0x52ac67(0x230)}}}]),_0x5ce1d6=await warehouse[_0x52ac67(0x28b)]([{'$match':{'name':_0x11942d,'room':_0x20fa6f}},{'$unwind':_0x52ac67(0x2aa)},{'$match':{'product_details.secondary_code':_0x1ce7f9}},{'$group':{'_id':_0x52ac67(0x1e3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x52ac67(0x20c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x52ac67(0x1c0)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x52ac67(0x205)},'type':{'$first':_0x52ac67(0x1ef)},'pallet':{'$first':_0x52ac67(0x21c)},'unit':{'$first':_0x52ac67(0x232)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x52ac67(0x24d)},'rack':{'$first':_0x52ac67(0x25e)},'expiry_date':{'$first':_0x52ac67(0x219)},'production_date':{'$first':_0x52ac67(0x259)},'maxPerUnit':{'$first':_0x52ac67(0x217)},'batch_code':{'$first':_0x52ac67(0x207)},'product_cat':{'$first':_0x52ac67(0x223)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x52ac67(0x22d)},'invoice':{'$first':_0x52ac67(0x270)}}}]);if(_0x1f69b2[_0x52ac67(0x24f)]>0x0)_0x5036de[_0x52ac67(0x2cb)](_0x1f69b2);else _0x5ce1d6[_0x52ac67(0x24f)]>0x0&&_0x5036de[_0x52ac67(0x2cb)](_0x5ce1d6);}const _0x4931f4=_0x487c97[_0x1ad348(0x2b8)](_0x988627=>_0x265821(_0x988627));await Promise[_0x1ad348(0x2ac)](_0x4931f4),_0x587b37[_0x1ad348(0x2a2)](_0x5036de);}),module[a0_0x2527ae(0x22c)]=router;