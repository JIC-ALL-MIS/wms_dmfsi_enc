var a0_0x139188=a0_0x4cfe;(function(_0x5cd0c2,_0x6192ee){var _0x49357a=a0_0x4cfe,_0x14a012=_0x5cd0c2();while(!![]){try{var _0x111736=parseInt(_0x49357a(0x160))/0x1+parseInt(_0x49357a(0x18b))/0x2*(-parseInt(_0x49357a(0x1b7))/0x3)+-parseInt(_0x49357a(0x18f))/0x4*(parseInt(_0x49357a(0x1c4))/0x5)+parseInt(_0x49357a(0xd4))/0x6*(-parseInt(_0x49357a(0x1d8))/0x7)+-parseInt(_0x49357a(0x162))/0x8+-parseInt(_0x49357a(0xf7))/0x9+parseInt(_0x49357a(0x14f))/0xa*(parseInt(_0x49357a(0x103))/0xb);if(_0x111736===_0x6192ee)break;else _0x14a012['push'](_0x14a012['shift']());}catch(_0x3db76a){_0x14a012['push'](_0x14a012['shift']());}}}(a0_0x1401,0x6f002));const express=require(a0_0x139188(0x1b3)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x139188(0x13a)),auth=require(a0_0x139188(0x15d)),nodemailer=require(a0_0x139188(0x18e)),users=require('../public/language/languages.json');function a0_0x1401(){var _0x520e96=['return_sale','finalize','language','English','Email\x20sent\x20successfully','warehouse_name','Shelves','batch_code','116855PrMUdT','getDate','</tbody>','get','concat','<!DOCTYPE\x20html>','quantity_notConverted','invoice','Hindi','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$_id','date','$product.product_name','logo','edit_sales_view','Arabic\x20(ae)','master','received_amount','log','1193969dvPhsY','sendMail','maxperunit','SCRN','rack','$product_details.bin','<h5\x20style=\x22text-align:\x20left;\x22>','</td>','$product_details.pallet','product_data','Portuguese','actual_qty','name','\x20</h2>','redirect','6zKILMP','Sales\x20Update\x20successfully','True','$invoice','$name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</body></html>','customers_docs','product_details','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<tr>','An\x20error\x20occurred.','/view/return_sales/:id','$warehouse_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','errors','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<span\x20style=\x22float:\x20right;\x22>','stock','Spanish','$product_details.primary_code','stock_data','room_name','/view','currency','/view/add_sales/:id','requested_qty','Sales\x20Mail','getMonth','save','Enabled','secondary_code','$note','741168iruTEZ','warehouse','host','back','$product_details','user_id','\x20Order\x20Date\x20:\x20','flash','/invoice/:id','$isAllowEdit','$product_details.delivery_date','$sale_product.quantity','11hyIZXk','level','</table>','email','bin','edit_sales','padStart','product_list','status','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sale_product','$product_details.unit','delivery_code','map','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$date','isAllowEdit','all_sales','catch','render','$product','$product_details.secondary_unit','/barcode/:id','$sale_product','$product_details.rack','exports','toString','slice','amount','getFullYear','Logo.png','An\x20error\x20occurred\x20while\x20saving\x20data.','RMSEmail','unit','</div>','type','add\x20post','secondary_unit','product_stock','$product_details.product_name','post','$product_details.product_stock','site_title','<strong>\x20Regards\x20</strong>','$customers_docs','push','json','</h5>','\x20Order\x20Number\x20:\x20','gmail','staff','stocks','message','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','id_transact','$product_details.production_date','quantity','False','max_per_unit','/upload/','filter','$product_details.delivery_code','$product_details.invoice','string','split','actual_uom','Error\x20Occurs','floorlevel','<hr\x20class=\x22my-3\x22>','password','production_date','port','$sale_product.bay','16662290ZUYKgi','$sale_product.floorlevel','$finalize','barcode\x20Product\x20master','/barcode_scanner','product','$product_details.floorlevel','all','$product_details.product_cat','$return_data','$customer','Sale\x20Return\x20Mail','/all_sales/view','expiry_date','../middleware/auth','find','OUT-','386022dNdggU','</thead>','719536cpZkoJ','storage','Received\x20Payment\x20For\x20Sale','forEach','Sale\x20Return','$sale_product.bin','/../public','customer','delivery_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Ambient','/all_sales/preview/','Portuguese\x20(BR)','all_sales_barcode','currency_placement','return_qty','foreach\x20newproduct','final','params','aggregate','<div>','max','sales\x20item\x20return\x20successfull','user','$product_details.storage','Enclosed','$product_details.product_code','$product_details.secondary_code','RoomAssigned','body','role','</tr>','/view/:id','prod_code','abs','then','$product_details.batch_code','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Arabic','Raw\x20Materials','4pepZQp','customers','English\x20(US)','nodemailer','136HNkCFO','findOne','image','<h2>\x20','findById','primary_code','$product_details.actual_qty','$product_details.level','$product_details.maxPerUnit','French','sales_quantity','Return\x20Rooms','/view/add_sale/product','bay','<h5>','primary_unit','error','sale_qty','Level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','types','$sale_product.type','product_code','Receiving\x20Area','product_name','$product_details.type','note','purchases_data','$room','$product_details._id','success','German','/view/add_sales','<html><head><title></title>','id_transaction_from','express','$product_details.expiry_date','prod_cat','Sales\x20Add\x20successfully','690177VUXvGN','Floor','prod_invoice','Chinese','_id'];a0_0x1401=function(){return _0x520e96;};return a0_0x1401();}function a0_0x4cfe(_0x55aa86,_0x4d0ffd){var _0x1401ba=a0_0x1401();return a0_0x4cfe=function(_0x4cfe23,_0x334975){_0x4cfe23=_0x4cfe23-0xcd;var _0x3b7e7e=_0x1401ba[_0x4cfe23];return _0x3b7e7e;},a0_0x4cfe(_0x55aa86,_0x4d0ffd);}router[a0_0x139188(0x1c7)](a0_0x139188(0xed),auth,async(_0x87e26f,_0x4ccc71)=>{var _0x36083d=a0_0x139188;try{const {username:_0x1b647d,email:_0x7ce1f1,role:_0x129c17}=_0x87e26f[_0x36083d(0x179)],_0x63c2fe=_0x87e26f[_0x36083d(0x179)],_0x99dfae=await profile[_0x36083d(0x190)]({'email':_0x63c2fe[_0x36083d(0x106)]}),_0x1fbb99=await master_shop[_0x36083d(0x15e)]();let _0x404b17;if(_0x63c2fe[_0x36083d(0x180)]==_0x36083d(0x137)){const _0x38a756=await staff[_0x36083d(0x190)]({'email':_0x63c2fe[_0x36083d(0x106)]});_0x404b17=await sales[_0x36083d(0x175)]([{'$lookup':{'from':_0x36083d(0x18c),'localField':'customer','foreignField':'name','as':_0x36083d(0xdc)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':_0x36083d(0x1cf),'invoice':{'$first':_0x36083d(0xd7)},'customers':{'$first':_0x36083d(0x159)},'date':{'$first':_0x36083d(0x114)},'warehouse_name':{'$first':_0x36083d(0xe2)},'sale_product':{'$push':_0x36083d(0x11c)},'note':{'$first':_0x36083d(0xf6)},'return_data':{'$first':_0x36083d(0x158)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':_0x36083d(0x102)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x36083d(0x167)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x36083d(0x150)},'finalize':{'$first':_0x36083d(0x151)},'isAllowEdit':{'$first':_0x36083d(0x100)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x404b17=await sales[_0x36083d(0x175)]([{'$lookup':{'from':_0x36083d(0x18c),'localField':_0x36083d(0x169),'foreignField':_0x36083d(0xd1),'as':_0x36083d(0xdc)}},{'$unwind':_0x36083d(0x131)},{'$unwind':_0x36083d(0x11c)},{'$group':{'_id':_0x36083d(0x1cf),'invoice':{'$first':_0x36083d(0xd7)},'customers':{'$first':_0x36083d(0x159)},'date':{'$first':_0x36083d(0x114)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x36083d(0x11c)},'note':{'$first':_0x36083d(0xf6)},'return_data':{'$first':_0x36083d(0x158)},'customers_docs':{'$first':_0x36083d(0x131)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x36083d(0x14e)},'isle':{'$addToSet':_0x36083d(0x167)},'type':{'$addToSet':_0x36083d(0x1a5)},'pallet':{'$addToSet':_0x36083d(0x150)},'finalize':{'$first':_0x36083d(0x151)},'isAllowEdit':{'$first':_0x36083d(0x100)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x36083d(0x1d7)]('sales\x20all_data',_0x404b17);if(_0x1fbb99[0x0]['language']==_0x36083d(0x18d)){var _0x820563=users[_0x36083d(0x1bf)];console[_0x36083d(0x1d7)](_0x820563);}else{if(_0x1fbb99[0x0][_0x36083d(0x1be)]=='Hindi')var _0x820563=users[_0x36083d(0x1cc)];else{if(_0x1fbb99[0x0]['language']==_0x36083d(0x1af))var _0x820563=users['German'];else{if(_0x1fbb99[0x0]['language']==_0x36083d(0xe9))var _0x820563=users['Spanish'];else{if(_0x1fbb99[0x0][_0x36083d(0x1be)]==_0x36083d(0x198))var _0x820563=users[_0x36083d(0x198)];else{if(_0x1fbb99[0x0][_0x36083d(0x1be)]==_0x36083d(0x16e))var _0x820563=users[_0x36083d(0xcf)];else{if(_0x1fbb99[0x0][_0x36083d(0x1be)]==_0x36083d(0x1ba))var _0x820563=users['Chinese'];else{if(_0x1fbb99[0x0][_0x36083d(0x1be)]=='Arabic\x20(ae)')var _0x820563=users['Arabic'];}}}}}}}_0x4ccc71[_0x36083d(0x118)](_0x36083d(0x116),{'success':_0x87e26f['flash'](_0x36083d(0x1ae)),'errors':_0x87e26f[_0x36083d(0xfe)](_0x36083d(0xe4)),'sales':_0x404b17,'profile':_0x99dfae,'role':_0x63c2fe,'master_shop':_0x1fbb99,'language':_0x820563});}catch(_0x359da5){console['log'](_0x359da5);}});async function getRandom8DigitNumber(){var _0x41b5fd=a0_0x139188;const _0x4b596e=0x989680,_0x430a28=0x5f5e0ff,_0x2cfd8e=Math['floor'](Math['random']()*(_0x430a28-_0x4b596e+0x1))+_0x4b596e;var _0x4cb919;const _0x4fc02b=await sales[_0x41b5fd(0x190)]({'invoice':_0x41b5fd(0x15f)+_0x2cfd8e});return _0x4fc02b&&_0x4fc02b[_0x41b5fd(0x112)]>0x0?_0x4cb919=_0x41b5fd(0x15f)+_0x2cfd8e:_0x4cb919='OUT-'+_0x2cfd8e,_0x4cb919;}router[a0_0x139188(0x1c7)](a0_0x139188(0x1b0),auth,async(_0x3d34cb,_0x15c315)=>{var _0x1d569f=a0_0x139188;try{const {username:_0x4d0309,email:_0x383570,role:_0xf3dbf6}=_0x3d34cb[_0x1d569f(0x179)],_0x3682bc=_0x3d34cb[_0x1d569f(0x179)],_0x135c92=await profile[_0x1d569f(0x190)]({'email':_0x3682bc['email']}),_0xaa97ec=await master_shop[_0x1d569f(0x15e)](),_0x485477=await customer[_0x1d569f(0x15e)]({});let _0x39390f;if(_0x3682bc['role']==_0x1d569f(0x137)){const _0xd3d3d3=await staff[_0x1d569f(0x190)]({'email':_0x3682bc[_0x1d569f(0x106)]});_0x39390f=await warehouse[_0x1d569f(0x175)]([{'$match':{'status':_0x1d569f(0xf4),'name':_0xd3d3d3[_0x1d569f(0xf8)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1d569f(0x187)}}},{'$group':{'_id':_0x1d569f(0xd8),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x39390f=await warehouse['aggregate']([{'$match':{'status':_0x1d569f(0xf4),'warehouse_category':_0x1d569f(0x18a),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x1d569f(0xd8),'name':{'$first':_0x1d569f(0xd8)}}},{'$sort':{'name':0x1}}]);const _0x52043f=await product[_0x1d569f(0x15e)]({});var _0x57ac39=[_0x1d569f(0x16c),_0x1d569f(0x17b)];const _0x2a1130=await sales['find']({}),_0x82227b=_0x2a1130['length']+0x1,_0x15b040=_0x1d569f(0x15f)+_0x82227b[_0x1d569f(0x11f)]()[_0x1d569f(0x109)](0x5,'0');if(_0xaa97ec[0x0][_0x1d569f(0x1be)]==_0x1d569f(0x18d)){var _0x5d5c4c=users['English'];console[_0x1d569f(0x1d7)](_0x5d5c4c);}else{if(_0xaa97ec[0x0][_0x1d569f(0x1be)]==_0x1d569f(0x1cc))var _0x5d5c4c=users['Hindi'];else{if(_0xaa97ec[0x0][_0x1d569f(0x1be)]==_0x1d569f(0x1af))var _0x5d5c4c=users[_0x1d569f(0x1af)];else{if(_0xaa97ec[0x0]['language']=='Spanish')var _0x5d5c4c=users[_0x1d569f(0xe9)];else{if(_0xaa97ec[0x0][_0x1d569f(0x1be)]==_0x1d569f(0x198))var _0x5d5c4c=users[_0x1d569f(0x198)];else{if(_0xaa97ec[0x0][_0x1d569f(0x1be)]=='Portuguese\x20(BR)')var _0x5d5c4c=users[_0x1d569f(0xcf)];else{if(_0xaa97ec[0x0][_0x1d569f(0x1be)]=='Chinese')var _0x5d5c4c=users[_0x1d569f(0x1ba)];else{if(_0xaa97ec[0x0][_0x1d569f(0x1be)]=='Arabic\x20(ae)')var _0x5d5c4c=users[_0x1d569f(0x189)];}}}}}}}const _0x3f043a=getRandom8DigitNumber();_0x3f043a[_0x1d569f(0x185)](_0x50988f=>{var _0x5da44d=_0x1d569f;_0x15c315[_0x5da44d(0x118)]('add_sales',{'success':_0x3d34cb['flash']('success'),'errors':_0x3d34cb[_0x5da44d(0xfe)]('errors'),'role':_0x3682bc,'profile':_0x135c92,'customer':_0x485477,'warehouse':_0x39390f,'product':_0x52043f,'invoice':_0x50988f,'master_shop':_0xaa97ec,'language':_0x5d5c4c,'rooms_data':_0x57ac39});})['catch'](_0x100099=>{var _0x216dea=_0x1d569f;_0x3d34cb[_0x216dea(0xfe)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x15c315['redirect'](_0x216dea(0x15b));});}catch(_0xabec59){console[_0x1d569f(0x1d7)](_0xabec59);}}),router[a0_0x139188(0x1c7)](a0_0x139188(0xef),auth,async(_0x447a59,_0x22e222)=>{var _0x42cb49=a0_0x139188;try{const _0x3e65af=_0x447a59[_0x42cb49(0x174)]['id'];console['log'](_0x3e65af);const _0x315a84=await product['find'](),_0x161f0b=await purchases[_0x42cb49(0x175)]([{'$match':{'warehouse_name':_0x3e65af}},{'$unwind':_0x42cb49(0x119)},{'$group':{'_id':_0x42cb49(0x1d1)}}]);console[_0x42cb49(0x1d7)](_0x42cb49(0x1ab),_0x161f0b),_0x22e222['status'](0xc8)[_0x42cb49(0x133)]({'purchases_data':_0x161f0b,'product_data':_0x315a84});}catch(_0x11df5b){console['log'](_0x11df5b);}}),router[a0_0x139188(0x12d)](a0_0x139188(0x19b),auth,async(_0x33d516,_0x385bed)=>{var _0x36e048=a0_0x139188;try{const {warehouse_data:_0x335ab9,product_data:_0xa737bc}=_0x33d516[_0x36e048(0x17f)];console[_0x36e048(0x1d7)](_0x33d516['body'][_0x36e048(0xce)]);;const _0x5a42c3=await master_shop[_0x36e048(0x15e)]();console[_0x36e048(0x1d7)](_0x36e048(0x1d5),_0x5a42c3);const _0x1c270e=await product[_0x36e048(0x190)]({'name':_0xa737bc});console[_0x36e048(0x1d7)](_0x36e048(0x154),_0x1c270e);const _0x1d31eb=await warehouse['aggregate']([{'$match':{'name':_0x335ab9}},{'$unwind':_0x36e048(0xfb)},{'$match':{'product_details.product_name':_0xa737bc}},{'$group':{'_id':_0x36e048(0x12c),'product_stock':{'$first':_0x36e048(0x12e)}}}]);console[_0x36e048(0x1d7)](_0x36e048(0xeb),_0x1d31eb),_0x385bed[_0x36e048(0x10b)](0xc8)['json']({'master':_0x5a42c3,'new_product':_0x1c270e,'stock_data':_0x1d31eb});}catch(_0x20e6ac){console[_0x36e048(0x1d7)](_0x20e6ac);}}),router['post'](a0_0x139188(0x1b0),auth,async(_0x262c62,_0x51612d)=>{var _0x311e38=a0_0x139188;try{const {invoice:_0x2437ed,date:_0xb275a7,warehouse_name:_0x514a1e,product_name:_0x37fc4e,stock:_0x55abc9,quantity:_0x349961,note:_0x54dc0a,room:_0x290d67,primary_code:_0x256824,secondary_code:_0x1042ca,prod_code:_0x1998e1,level:_0x1724c2,isle:_0x280bea,pallet:_0x25b80b,batch_code:_0x2c480b,SCRN:_0xd7d14d,expiry_date:_0x482407}=_0x262c62['body'];if(typeof _0x37fc4e==_0x311e38(0x145))var _0x548045=[_0x262c62['body'][_0x311e38(0x1a8)]],_0xcd9662=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0xe8)]],_0x3bcc9f=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x1cd)]],_0x5abbf0=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x194)]],_0x2821eb=[_0x262c62[_0x311e38(0x17f)]['secondary_code']],_0x11b340=[_0x262c62['body'][_0x311e38(0x183)]],_0x562e51=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x104)]],_0x374730=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x19e)]],_0x29e3ed=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x12a)]],_0xd38a56=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x1c3)]],_0x1261f0=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x15c)]],_0x1c538a=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x140)]],_0x34b031=[_0x262c62['body'][_0x311e38(0x14c)]],_0x8c392=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0xf0)]],_0x45d1c0=[_0x262c62[_0x311e38(0x17f)]['delivery_date']],_0x38b354=[_0x262c62['body']['delivery_code']],_0x2c5329=[_0x262c62['body'][_0x311e38(0x1b5)]],_0x31962f=[_0x262c62[_0x311e38(0x17f)]['quantity']],_0x305247=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x17e)]],_0x524a75=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x1b9)]],_0x5da936=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0xd0)]],_0x24d8b9=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x147)]],_0x9c42d9=[_0x262c62[_0x311e38(0x17f)][_0x311e38(0x13c)]];else var _0x548045=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x1a8)]],_0xcd9662=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0xe8)]],_0x3bcc9f=[..._0x262c62[_0x311e38(0x17f)]['carton']],_0x5abbf0=[..._0x262c62['body'][_0x311e38(0x194)]],_0x2821eb=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0xf5)]],_0x11b340=[..._0x262c62['body'][_0x311e38(0x183)]],_0x562e51=[..._0x262c62['body']['level']],_0x374730=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x19e)]],_0x29e3ed=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x12a)]],_0xd38a56=[..._0x262c62['body']['batch_code']],_0x1261f0=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x15c)]],_0x1c538a=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x140)]],_0x34b031=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x14c)]],_0x8c392=[..._0x262c62['body'][_0x311e38(0xf0)]],_0x45d1c0=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x16a)]],_0x38b354=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x110)]],_0x2c5329=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x1b5)]],_0x31962f=[..._0x262c62['body']['quantity']],_0x305247=[..._0x262c62[_0x311e38(0x17f)]['RoomAssigned']],_0x524a75=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0x1b9)]],_0x5da936=[..._0x262c62[_0x311e38(0x17f)][_0x311e38(0xd0)]],_0x24d8b9=[..._0x262c62[_0x311e38(0x17f)]['actual_uom']],_0x9c42d9=[..._0x262c62['body']['id_transact']];const _0x42320e=_0x548045[_0x311e38(0x111)](_0x566978=>{return _0x566978={'product_name':_0x566978};});_0xcd9662[_0x311e38(0x165)]((_0x2ff3ca,_0x394938)=>{var _0x2f8b5e=_0x311e38;_0x42320e[_0x394938]['stock']=Math[_0x2f8b5e(0x184)](_0x2ff3ca);}),_0x5da936['forEach']((_0x6132ca,_0x197549)=>{var _0x36b4c1=_0x311e38;_0x42320e[_0x197549][_0x36b4c1(0xd0)]=Math[_0x36b4c1(0x184)](_0x6132ca);}),_0x24d8b9['forEach']((_0x3a800d,_0xb9c44d)=>{var _0x41b448=_0x311e38;_0x42320e[_0xb9c44d][_0x41b448(0x147)]=_0x3a800d;}),_0x9c42d9[_0x311e38(0x165)]((_0x14e19f,_0xde2cf9)=>{_0x42320e[_0xde2cf9]['id_transaction_from']=_0x14e19f;}),_0x3bcc9f[_0x311e38(0x165)]((_0x3ccb88,_0x29af57)=>{var _0x20c902=_0x311e38;_0x42320e[_0x29af57][_0x20c902(0x13e)]=_0x3ccb88;}),_0x5abbf0[_0x311e38(0x165)]((_0x1b10fa,_0x20003a)=>{var _0x35c00d=_0x311e38;_0x42320e[_0x20003a][_0x35c00d(0x194)]=_0x1b10fa;}),_0x2821eb[_0x311e38(0x165)]((_0xd1efd2,_0x404ad7)=>{var _0x191e08=_0x311e38;_0x42320e[_0x404ad7][_0x191e08(0xf5)]=_0xd1efd2;}),_0x11b340[_0x311e38(0x165)]((_0x5513e7,_0x531725)=>{var _0x56d531=_0x311e38;_0x42320e[_0x531725][_0x56d531(0x1a6)]=_0x5513e7;}),_0x562e51[_0x311e38(0x165)]((_0x14563a,_0x181515)=>{var _0x5aa7e5=_0x311e38;_0x305247[_0x5aa7e5(0x165)]((_0x5d94da,_0x5a62d5)=>{var _0x331c44=_0x5aa7e5;if(_0x5d94da==_0x331c44(0x1a7)&&_0x181515==_0x5a62d5){var _0x2f87fb=_0x14563a[_0x331c44(0x120)](0x3);_0x42320e[_0x181515][_0x331c44(0x163)]=_0x14563a[0x0],_0x42320e[_0x181515]['rack']=_0x14563a[0x1],_0x42320e[_0x181515][_0x331c44(0x19c)]=0x0,_0x42320e[_0x181515][_0x331c44(0x107)]=0x0,_0x42320e[_0x181515]['type']=_0x331c44(0x1b8),_0x42320e[_0x181515]['floorlevel']=_0x2f87fb;}else{if(_0x5d94da==_0x331c44(0x1c2)&&_0x181515==_0x5a62d5){var _0x2f87fb=_0x14563a[_0x331c44(0x120)](0x3);_0x42320e[_0x181515][_0x331c44(0x163)]=_0x14563a[0x0],_0x42320e[_0x181515][_0x331c44(0x1dc)]=_0x14563a[0x1],_0x42320e[_0x181515][_0x331c44(0x19c)]=0x0,_0x42320e[_0x181515][_0x331c44(0x107)]=0x0,_0x42320e[_0x181515][_0x331c44(0x128)]=_0x331c44(0x1b8),_0x42320e[_0x181515]['floorlevel']=_0x14563a[0x5];}else{if(_0x181515==_0x5a62d5){var _0x2debd5;if(_0x14563a[0x4]=='L')_0x2debd5=_0x331c44(0x1a1);else _0x14563a[0x4]=='F'&&(_0x2debd5=_0x331c44(0x1b8));_0x42320e[_0x181515][_0x331c44(0x163)]=_0x14563a[0x0],_0x42320e[_0x181515][_0x331c44(0x1dc)]=_0x14563a[0x1],_0x42320e[_0x181515][_0x331c44(0x19c)]=_0x14563a[0x2],_0x42320e[_0x181515][_0x331c44(0x107)]=_0x14563a[0x3],_0x42320e[_0x181515][_0x331c44(0x128)]=_0x2debd5,_0x42320e[_0x181515][_0x331c44(0x149)]=_0x14563a[0x5];}}}});}),_0x374730[_0x311e38(0x165)]((_0x4bcf22,_0x4f57e9)=>{var _0x155615=_0x311e38;_0x42320e[_0x4f57e9][_0x155615(0x126)]=_0x4bcf22;}),_0x29e3ed['forEach']((_0xfe17d0,_0x2d59af)=>{var _0x11941e=_0x311e38;_0x42320e[_0x2d59af][_0x11941e(0x12a)]=_0xfe17d0;}),_0xd38a56['forEach']((_0x196e15,_0x6316e8)=>{var _0x292b17=_0x311e38;_0x42320e[_0x6316e8][_0x292b17(0x1c3)]=_0x196e15;}),_0x1261f0['forEach']((_0x278b85,_0xb8edbc)=>{var _0x578c49=_0x311e38;_0x42320e[_0xb8edbc][_0x578c49(0x15c)]=_0x278b85;}),_0x1c538a[_0x311e38(0x165)]((_0x49c33a,_0x39713a)=>{var _0x5b5358=_0x311e38;_0x42320e[_0x39713a][_0x5b5358(0x1da)]=_0x49c33a;}),_0x34b031[_0x311e38(0x165)]((_0x5cca96,_0x162e17)=>{var _0x3bd13b=_0x311e38;_0x42320e[_0x162e17][_0x3bd13b(0x14c)]=_0x5cca96;}),_0x8c392['forEach']((_0x1b665b,_0x55c71f)=>{var _0x21b92f=_0x311e38;_0x42320e[_0x55c71f][_0x21b92f(0xf0)]=_0x1b665b;}),_0x45d1c0[_0x311e38(0x165)]((_0x38995d,_0x39be54)=>{var _0x4a7a74=_0x311e38;_0x42320e[_0x39be54][_0x4a7a74(0x16a)]=_0x38995d;}),_0x38b354[_0x311e38(0x165)]((_0x343d9b,_0x8fe9a8)=>{var _0x1d1f94=_0x311e38;_0x42320e[_0x8fe9a8][_0x1d1f94(0x110)]=_0x343d9b;}),_0x2c5329[_0x311e38(0x165)]((_0x5ee70d,_0x22cbdd)=>{_0x42320e[_0x22cbdd]['prod_cat']=_0x5ee70d;}),_0x31962f[_0x311e38(0x165)]((_0x37f6eb,_0x5d08e0)=>{var _0x2005de=_0x311e38;_0x42320e[_0x5d08e0][_0x2005de(0x1ca)]=_0x37f6eb;}),_0x305247[_0x311e38(0x165)]((_0x54e918,_0x30f280)=>{var _0x426ae4=_0x311e38;_0x42320e[_0x30f280][_0x426ae4(0xec)]=_0x54e918;}),_0x524a75[_0x311e38(0x165)]((_0x36d97d,_0x306dc1)=>{_0x42320e[_0x306dc1]['invoice']=_0x36d97d;});var _0x1ce401=0x0;_0x42320e['forEach'](_0x3f1cc5=>{var _0x463677=_0x311e38;(_0x3f1cc5[_0x463677(0xe8)]<_0x3f1cc5[_0x463677(0x1ca)]||_0x3f1cc5[_0x463677(0x1ca)]==0x0)&&(console[_0x463677(0x1d7)]('foreach\x20newproduct',_0x3f1cc5),_0x1ce401++);});const _0x116a44=_0x42320e[_0x311e38(0x142)](_0x593594=>_0x593594[_0x311e38(0x13e)]!=='0'&&_0x593594[_0x311e38(0x13e)]!==''),_0x4eae65=new sales({'invoice':_0x2437ed,'customer':_0x262c62[_0x311e38(0x17f)][_0x311e38(0x169)],'date':_0xb275a7,'warehouse_name':_0x514a1e,'sale_product':_0x116a44,'note':_0x54dc0a,'room':_0x290d67,'primary_code':_0x256824,'secondary_code':_0x1042ca,'prod_code':_0x1998e1,'SCRN':_0xd7d14d}),_0x371a83=await _0x4eae65['save']();_0x262c62[_0x311e38(0xfe)](_0x311e38(0x1ae),_0x311e38(0x1b6)),_0x51612d['redirect'](_0x311e38(0x16d)+_0x371a83['_id']);}catch(_0x5f00a7){console[_0x311e38(0x1d7)](_0x5f00a7);}}),router[a0_0x139188(0x1c7)](a0_0x139188(0xe5),auth,async(_0x469235,_0x2286a3)=>{var _0x155a1d=a0_0x139188;try{const {username:_0x5422c4,email:_0x46df93,role:_0x4eb8ff}=_0x469235[_0x155a1d(0x179)],_0x3703bd=_0x469235['user'],_0x1d7d3a=await profile[_0x155a1d(0x190)]({'email':_0x3703bd[_0x155a1d(0x106)]}),_0x418c45=await master_shop[_0x155a1d(0x15e)](),_0x1af75a=_0x469235[_0x155a1d(0x174)]['id'],_0x213523=await sales[_0x155a1d(0x193)](_0x1af75a),_0x7e1855=await warehouse['aggregate']([{'$match':{'name':_0x213523['warehouse_name']}},{'$unwind':_0x155a1d(0xfb)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x155a1d(0x12c)},'product_stock':{'$first':_0x155a1d(0x12e)},'bay':{'$first':_0x155a1d(0x10c)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x155a1d(0x155)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x155a1d(0x17d)},'product_code':{'$first':_0x155a1d(0x17c)},'storage':{'$first':_0x155a1d(0x17a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x155a1d(0x1b4)},'production_date':{'$first':_0x155a1d(0x13d)},'invoice':{'$first':_0x155a1d(0x144)}}}]),_0x831a3a=await customer['find']({});let _0x4d3e8c;if(_0x3703bd[_0x155a1d(0x180)]==_0x155a1d(0x137)){const _0x3cff70=await staff['findOne']({'email':_0x3703bd[_0x155a1d(0x106)]});_0x4d3e8c=await warehouse[_0x155a1d(0x175)]([{'$match':{'status':_0x155a1d(0xf4),'name':_0x3cff70['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x155a1d(0xd8)}}}]);}else _0x4d3e8c=await warehouse[_0x155a1d(0x175)]([{'$match':{'status':_0x155a1d(0xf4)}},{'$group':{'_id':_0x155a1d(0xd8),'name':{'$first':_0x155a1d(0xd8)}}}]);const _0x39bbaf=await product[_0x155a1d(0x15e)]({}),_0x468ea6=await suppliers['find']({});if(_0x418c45[0x0]['language']==_0x155a1d(0x18d)){var _0x2511f9=users['English'];console['log'](_0x2511f9);}else{if(_0x418c45[0x0][_0x155a1d(0x1be)]==_0x155a1d(0x1cc))var _0x2511f9=users[_0x155a1d(0x1cc)];else{if(_0x418c45[0x0][_0x155a1d(0x1be)]==_0x155a1d(0x1af))var _0x2511f9=users[_0x155a1d(0x1af)];else{if(_0x418c45[0x0]['language']==_0x155a1d(0xe9))var _0x2511f9=users['Spanish'];else{if(_0x418c45[0x0][_0x155a1d(0x1be)]==_0x155a1d(0x198))var _0x2511f9=users[_0x155a1d(0x198)];else{if(_0x418c45[0x0]['language']==_0x155a1d(0x16e))var _0x2511f9=users[_0x155a1d(0xcf)];else{if(_0x418c45[0x0][_0x155a1d(0x1be)]==_0x155a1d(0x1ba))var _0x2511f9=users[_0x155a1d(0x1ba)];else{if(_0x418c45[0x0]['language']==_0x155a1d(0x1d4))var _0x2511f9=users[_0x155a1d(0x189)];}}}}}}}_0x2286a3[_0x155a1d(0x118)](_0x155a1d(0x1d3),{'success':_0x469235[_0x155a1d(0xfe)](_0x155a1d(0x1ae)),'errors':_0x469235[_0x155a1d(0xfe)](_0x155a1d(0xe4)),'role':_0x3703bd,'profile':_0x1d7d3a,'customer':_0x831a3a,'warehouse':_0x4d3e8c,'product':_0x7e1855,'user':_0x213523,'master_shop':_0x418c45,'unit':_0x39bbaf,'language':_0x2511f9,'suppliers':_0x468ea6});}catch(_0x51f86e){console['log'](_0x51f86e);}}),router[a0_0x139188(0x12d)](a0_0x139188(0xe5),auth,async(_0x4f3322,_0x2683e1)=>{var _0x353630=a0_0x139188;try{const _0xd411d0=_0x4f3322[_0x353630(0x174)]['id'],{invoice:_0x2e09eb,warehouse_name:_0x3728bd,room:_0xb1c8a2}=_0x4f3322[_0x353630(0x17f)],_0x4c7c5e=await sales['findOne']({'invoice':_0x2e09eb}),_0x34f008=_0x4c7c5e[_0x353630(0x10e)][_0x353630(0x111)](async _0x32c759=>{var _0x3fea0f=_0x353630,_0x483de4=await warehouse[_0x3fea0f(0x190)]({'name':_0x3728bd,'room':_0x32c759[_0x3fea0f(0xec)],'warehouse_category':_0x3fea0f(0x18a)});const _0x200c15=_0x483de4['product_details'][_0x3fea0f(0x111)](_0x3c3cd4=>{var _0x687977=_0x3fea0f;_0x3c3cd4['product_name']==_0x32c759[_0x687977(0x1a8)]&&_0x3c3cd4[_0x687977(0x149)]==_0x32c759['floorlevel']&&_0x3c3cd4[_0x687977(0x128)]==_0x32c759['type']&&_0x3c3cd4['bin']==_0x32c759['bin']&&_0x3c3cd4['bay']==_0x32c759[_0x687977(0x19c)]&&_0x3c3cd4[_0x687977(0x1dc)]==_0x32c759[_0x687977(0x1dc)]&&_0x3c3cd4['storage']==_0x32c759[_0x687977(0x163)]&&_0x3c3cd4[_0x687977(0x15c)]==_0x32c759[_0x687977(0x15c)]&&_0x3c3cd4['batch_code']==_0x32c759[_0x687977(0x1c3)]&&_0x3c3cd4[_0x687977(0x1bb)]==_0x32c759[_0x687977(0x1b2)]&&(_0x3c3cd4['product_stock']=Math[_0x687977(0x177)](0x0,Math[_0x687977(0x184)](_0x3c3cd4[_0x687977(0x12b)])-Math[_0x687977(0x184)](_0x32c759[_0x687977(0x13e)])));});return _0x483de4;});Promise[_0x353630(0x156)](_0x34f008)[_0x353630(0x185)](async _0x221dbc=>{var _0x54cb4e=_0x353630;try{for(const _0x3def45 of _0x221dbc){await _0x3def45['save']();}_0x4c7c5e[_0x54cb4e(0x1bd)]=_0x54cb4e(0xd6);const _0xb3b755=await _0x4c7c5e[_0x54cb4e(0xf3)](),_0x300367=await master_shop['find'](),_0x3563a7=await email_settings[_0x54cb4e(0x190)](),_0x237044=await supervisor_settings[_0x54cb4e(0x15e)]();var _0x2bf55c=_0x4c7c5e[_0x54cb4e(0x10e)],_0x109001='',_0x182327;for(_0x182327 in _0x2bf55c){_0x109001+=_0x54cb4e(0xdf)+_0x54cb4e(0x1a3)+_0x2bf55c[_0x182327]['product_name']+'</td>'+_0x54cb4e(0x1a3)+_0x2bf55c[_0x182327][_0x54cb4e(0x1a6)]+_0x54cb4e(0x1df)+_0x54cb4e(0x1a3)+_0x2bf55c[_0x182327]['quantity']+'</td>'+_0x54cb4e(0x1a3)+_0x2bf55c[_0x182327][_0x54cb4e(0x126)]+_0x54cb4e(0x1df)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bf55c[_0x182327][_0x54cb4e(0x12a)]+_0x54cb4e(0x1df)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c7c5e[_0x54cb4e(0x1c1)]+_0x54cb4e(0x1df)+_0x54cb4e(0x1a3)+_0x2bf55c[_0x182327][_0x54cb4e(0xec)]+_0x54cb4e(0x1df)+_0x54cb4e(0x1a3)+_0x2bf55c[_0x182327][_0x54cb4e(0x163)]+_0x2bf55c[_0x182327][_0x54cb4e(0x1dc)]+_0x2bf55c[_0x182327][_0x54cb4e(0x19c)]+_0x2bf55c[_0x182327]['bin']+_0x2bf55c[_0x182327]['type'][0x0]+_0x2bf55c[_0x182327][_0x54cb4e(0x149)]+_0x54cb4e(0x1df),_0x54cb4e(0x181);}let _0x224eb7=nodemailer['createTransport']({'host':_0x3563a7[_0x54cb4e(0xf9)],'port':Number(_0x3563a7[_0x54cb4e(0x14d)]),'secure':![],'auth':{'user':_0x3563a7['email'],'pass':_0x3563a7[_0x54cb4e(0x14b)]}}),_0x58e4a6={'from':_0x3563a7['email'],'to':_0x237044[0x0][_0x54cb4e(0x125)],'subject':_0x54cb4e(0xf1),'attachments':[{'filename':'Logo.png','path':__dirname+_0x54cb4e(0x168)+'/upload/'+_0x300367[0x0][_0x54cb4e(0x191)],'cid':_0x54cb4e(0x1d2)}],'html':_0x54cb4e(0x1c9)+_0x54cb4e(0x1b1)+'</head><body>'+'<div>'+_0x54cb4e(0xd9)+_0x54cb4e(0x176)+_0x54cb4e(0xda)+_0x54cb4e(0x127)+_0x54cb4e(0x176)+_0x54cb4e(0x192)+_0x300367[0x0][_0x54cb4e(0x12f)]+_0x54cb4e(0xd2)+_0x54cb4e(0x127)+_0x54cb4e(0x127)+_0x54cb4e(0x14a)+'<div>'+_0x54cb4e(0x1de)+_0x54cb4e(0x135)+_0x4c7c5e[_0x54cb4e(0x1cb)]+'\x20'+_0x54cb4e(0xe7)+'\x20Order\x20Date\x20:\x20'+_0x4c7c5e[_0x54cb4e(0x1d0)]+'\x20'+'</span>'+_0x54cb4e(0x134)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x54cb4e(0xe3)+_0x54cb4e(0xdf)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x54cb4e(0x1ce)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x54cb4e(0x188)+_0x54cb4e(0xe6)+_0x54cb4e(0x113)+_0x54cb4e(0x16b)+_0x54cb4e(0x181)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x109001+'\x20'+_0x54cb4e(0x1c6)+_0x54cb4e(0x105)+_0x54cb4e(0x176)+'<strong>\x20Regards\x20</strong>'+_0x54cb4e(0x19d)+_0x300367[0x0][_0x54cb4e(0x12f)]+_0x54cb4e(0x134)+'</div>'+_0x54cb4e(0x127)+_0x54cb4e(0xdb)};_0x224eb7[_0x54cb4e(0x1d9)](_0x58e4a6,function(_0xed4909,_0x3accf4){var _0x473b8f=_0x54cb4e;_0xed4909?(console['log'](_0xed4909),console[_0x473b8f(0x1d7)](_0x473b8f(0x148))):console[_0x473b8f(0x1d7)](_0x473b8f(0x1c0));}),_0x4f3322[_0x54cb4e(0xfe)](_0x54cb4e(0x1ae),_0x54cb4e(0xd5)),_0x2683e1[_0x54cb4e(0xd3)](_0x54cb4e(0x16d)+_0xd411d0);}catch(_0x2efdda){console['error'](_0x2efdda),_0x2683e1[_0x54cb4e(0x10b)](0x1f4)[_0x54cb4e(0x133)]({'error':_0x54cb4e(0x124)});}})[_0x353630(0x117)](_0x58c9c2=>{var _0x202904=_0x353630;console[_0x202904(0x19f)](_0x58c9c2),_0x2683e1[_0x202904(0x10b)](0x1f4)['json']({'error':_0x202904(0xe0)});});}catch(_0x1ba87c){console['log'](_0x1ba87c);}}),router[a0_0x139188(0x1c7)](a0_0x139188(0x182),auth,async(_0x586dc9,_0x353968)=>{var _0x4cb059=a0_0x139188;try{const {username:_0x5cb13f,email:_0x35a2d6,role:_0x34c435}=_0x586dc9[_0x4cb059(0x179)],_0x35dbcf=_0x586dc9[_0x4cb059(0x179)],_0x582fad=await profile[_0x4cb059(0x190)]({'email':_0x35dbcf[_0x4cb059(0x106)]}),_0x29489e=await master_shop[_0x4cb059(0x15e)](),_0x309461=_0x586dc9[_0x4cb059(0x174)]['id'],_0x5179ba=await sales[_0x4cb059(0x193)](_0x309461);var _0x4ba12c=[_0x4cb059(0x16c),'Enclosed'];const _0xb1f665=await warehouse[_0x4cb059(0x175)]([{'$match':{'name':_0x5179ba['warehouse_name'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x4cb059(0xfb)},{'$group':{'_id':_0x4cb059(0x1ad),'name':{'$first':_0x4cb059(0x12c)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4cb059(0x10c)},'bin':{'$first':_0x4cb059(0x1dd)},'type':{'$first':_0x4cb059(0x1a9)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4cb059(0x17c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x1cc8fe=await customer[_0x4cb059(0x15e)]({});let _0x351c85;if(_0x35dbcf[_0x4cb059(0x180)]==_0x4cb059(0x137)){const _0x1c7666=await staff['findOne']({'email':_0x35dbcf[_0x4cb059(0x106)]});_0x351c85=await warehouse[_0x4cb059(0x175)]([{'$match':{'status':_0x4cb059(0xf4),'name':_0x1c7666[_0x4cb059(0xf8)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x4cb059(0xd8)}}}]);}else _0x351c85=await warehouse[_0x4cb059(0x175)]([{'$match':{'status':_0x4cb059(0xf4),'warehouse_category':_0x4cb059(0x18a)}},{'$group':{'_id':_0x4cb059(0xd8),'name':{'$first':_0x4cb059(0xd8)}}}]);const _0xaf1da7=await product[_0x4cb059(0x15e)]({});if(_0x29489e[0x0][_0x4cb059(0x1be)]==_0x4cb059(0x18d)){var _0x3b4e56=users[_0x4cb059(0x1bf)];console[_0x4cb059(0x1d7)](_0x3b4e56);}else{if(_0x29489e[0x0]['language']=='Hindi')var _0x3b4e56=users[_0x4cb059(0x1cc)];else{if(_0x29489e[0x0][_0x4cb059(0x1be)]==_0x4cb059(0x1af))var _0x3b4e56=users[_0x4cb059(0x1af)];else{if(_0x29489e[0x0][_0x4cb059(0x1be)]=='Spanish')var _0x3b4e56=users['Spanish'];else{if(_0x29489e[0x0][_0x4cb059(0x1be)]==_0x4cb059(0x198))var _0x3b4e56=users[_0x4cb059(0x198)];else{if(_0x29489e[0x0][_0x4cb059(0x1be)]==_0x4cb059(0x16e))var _0x3b4e56=users[_0x4cb059(0xcf)];else{if(_0x29489e[0x0]['language']==_0x4cb059(0x1ba))var _0x3b4e56=users[_0x4cb059(0x1ba)];else{if(_0x29489e[0x0][_0x4cb059(0x1be)]==_0x4cb059(0x1d4))var _0x3b4e56=users['Arabic'];}}}}}}}_0x353968[_0x4cb059(0x118)](_0x4cb059(0x108),{'success':_0x586dc9['flash'](_0x4cb059(0x1ae)),'errors':_0x586dc9[_0x4cb059(0xfe)](_0x4cb059(0xe4)),'role':_0x35dbcf,'profile':_0x582fad,'customer':_0x1cc8fe,'warehouse':_0x351c85,'product':_0xb1f665,'user':_0x5179ba,'master_shop':_0x29489e,'unit':_0xaf1da7,'language':_0x3b4e56});}catch(_0x29c978){console['log'](_0x29c978);}}),router[a0_0x139188(0x12d)](a0_0x139188(0x182),auth,async(_0x1589f1,_0x6cc0ee)=>{var _0x6d3304=a0_0x139188;try{const _0x379d90=_0x1589f1[_0x6d3304(0x174)]['id'],_0x2c9ad6=await sales[_0x6d3304(0x190)]({'_id':_0x1589f1[_0x6d3304(0x174)]['id']}),_0x4a1cf1=await warehouse[_0x6d3304(0x190)]({'name':_0x2c9ad6[_0x6d3304(0x1c1)],'room':_0x1589f1[_0x6d3304(0x17f)]['room']}),{invoice:_0x5300d8,date:_0x53a298,warehouse_name:_0x5daa8d,product_name:_0x31e6fd,stock:_0x4b6035,quantity:_0x14eed2,note:_0x1eac5a,room:_0x1bf63e,customer:_0x41f372,SCRN:_0x31d310}=_0x1589f1[_0x6d3304(0x17f)];if(typeof _0x31e6fd==_0x6d3304(0x145))var _0x50451c=[_0x1589f1['body'][_0x6d3304(0x1a8)]],_0x295700=[_0x1589f1['body']['stock']],_0x2c54a5=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x1cd)]],_0x44f0bf=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x194)]],_0x30bfcd=[_0x1589f1['body'][_0x6d3304(0xf5)]],_0x5d0061=[_0x1589f1['body'][_0x6d3304(0x183)]],_0x44299=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x104)]],_0x4ec123=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x19e)]],_0x1f303c=[_0x1589f1['body']['secondary_unit']],_0x488a83=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x1c3)]],_0x1def4e=[_0x1589f1[_0x6d3304(0x17f)]['expiry_date']],_0x1a80f8=[_0x1589f1['body']['max_per_unit']],_0x4210e4=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x14c)]],_0xf8f13a=[_0x1589f1[_0x6d3304(0x17f)]['requested_qty']],_0x3113eb=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x16a)]],_0x5dd98d=[_0x1589f1['body'][_0x6d3304(0x110)]],_0xb80e33=[_0x1589f1[_0x6d3304(0x17f)]['prod_cat']],_0x22f803=[_0x1589f1[_0x6d3304(0x17f)]['quantity']],_0x8b2185=[_0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x17e)]];else var _0x50451c=[..._0x1589f1['body'][_0x6d3304(0x1a8)]],_0x295700=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0xe8)]],_0x2c54a5=[..._0x1589f1[_0x6d3304(0x17f)]['carton']],_0x44f0bf=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x194)]],_0x30bfcd=[..._0x1589f1[_0x6d3304(0x17f)]['secondary_code']],_0x5d0061=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x183)]],_0x44299=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x104)]],_0x4ec123=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x19e)]],_0x1f303c=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x12a)]],_0x488a83=[..._0x1589f1['body'][_0x6d3304(0x1c3)]],_0x1def4e=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x15c)]],_0x1a80f8=[..._0x1589f1[_0x6d3304(0x17f)]['max_per_unit']],_0x4210e4=[..._0x1589f1['body'][_0x6d3304(0x14c)]],_0xf8f13a=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0xf0)]],_0x3113eb=[..._0x1589f1['body']['delivery_date']],_0x5dd98d=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x110)]],_0xb80e33=[..._0x1589f1['body']['prod_cat']],_0x22f803=[..._0x1589f1[_0x6d3304(0x17f)][_0x6d3304(0x13e)]],_0x8b2185=[..._0x1589f1['body'][_0x6d3304(0x17e)]];const _0x47ec1b=_0x50451c[_0x6d3304(0x111)](_0x2d44b8=>{return _0x2d44b8={'product_name':_0x2d44b8};});_0x295700[_0x6d3304(0x165)]((_0x540a10,_0x6dad35)=>{var _0x340e74=_0x6d3304;_0x47ec1b[_0x6dad35][_0x340e74(0xe8)]=Math[_0x340e74(0x184)](_0x540a10);}),_0x2c54a5[_0x6d3304(0x165)]((_0x2ea38a,_0x111a3e)=>{var _0x1cc128=_0x6d3304;_0x47ec1b[_0x111a3e][_0x1cc128(0x13e)]=_0x2ea38a;}),_0x44f0bf['forEach']((_0x14c587,_0x5ae254)=>{var _0x1a816e=_0x6d3304;_0x47ec1b[_0x5ae254][_0x1a816e(0x194)]=_0x14c587;}),_0x30bfcd['forEach']((_0x123d5a,_0x153a02)=>{var _0x3a84a7=_0x6d3304;_0x47ec1b[_0x153a02][_0x3a84a7(0xf5)]=_0x123d5a;}),_0x5d0061[_0x6d3304(0x165)]((_0x1abae0,_0x57a08b)=>{_0x47ec1b[_0x57a08b]['product_code']=_0x1abae0;}),_0x44299[_0x6d3304(0x165)]((_0x1b2ce6,_0x542641)=>{var _0x22d9e0=_0x6d3304;_0x8b2185[_0x22d9e0(0x165)]((_0x406e2c,_0xc2c1f0)=>{var _0x459638=_0x22d9e0;if(_0x406e2c=='Receiving\x20Area'&&_0x542641==_0xc2c1f0){var _0x221870=_0x1b2ce6[_0x459638(0x120)](0x3);_0x47ec1b[_0x542641]['storage']=_0x1b2ce6[0x0],_0x47ec1b[_0x542641][_0x459638(0x1dc)]=_0x1b2ce6[0x1],_0x47ec1b[_0x542641][_0x459638(0x19c)]=0x0,_0x47ec1b[_0x542641][_0x459638(0x107)]=0x0,_0x47ec1b[_0x542641][_0x459638(0x128)]=_0x459638(0x1b8),_0x47ec1b[_0x542641][_0x459638(0x149)]=_0x221870;}else{if(_0x406e2c=='Shelves'&&_0x542641==_0xc2c1f0){var _0x221870=_0x1b2ce6['slice'](0x3);_0x47ec1b[_0x542641]['storage']=_0x1b2ce6[0x0],_0x47ec1b[_0x542641][_0x459638(0x1dc)]=_0x1b2ce6[0x1],_0x47ec1b[_0x542641][_0x459638(0x19c)]=0x0,_0x47ec1b[_0x542641]['bin']=0x0,_0x47ec1b[_0x542641][_0x459638(0x128)]='Floor',_0x47ec1b[_0x542641][_0x459638(0x149)]=_0x1b2ce6[0x5];}else{if(_0x542641==_0xc2c1f0){var _0x21de85;if(_0x1b2ce6[0x4]=='L')_0x21de85=_0x459638(0x1a1);else _0x1b2ce6[0x4]=='F'&&(_0x21de85='Floor');_0x47ec1b[_0x542641][_0x459638(0x163)]=_0x1b2ce6[0x0],_0x47ec1b[_0x542641][_0x459638(0x1dc)]=_0x1b2ce6[0x1],_0x47ec1b[_0x542641][_0x459638(0x19c)]=_0x1b2ce6[0x2],_0x47ec1b[_0x542641][_0x459638(0x107)]=_0x1b2ce6[0x3],_0x47ec1b[_0x542641][_0x459638(0x128)]=_0x21de85,_0x47ec1b[_0x542641][_0x459638(0x149)]=_0x1b2ce6[0x5];}}}});}),_0x4ec123[_0x6d3304(0x165)]((_0x405cb8,_0x3d5f8e)=>{var _0x2a69fb=_0x6d3304;_0x47ec1b[_0x3d5f8e][_0x2a69fb(0x126)]=_0x405cb8;}),_0x1f303c[_0x6d3304(0x165)]((_0x2f5812,_0x42f6cb)=>{var _0x24ac53=_0x6d3304;_0x47ec1b[_0x42f6cb][_0x24ac53(0x12a)]=_0x2f5812;}),_0x488a83[_0x6d3304(0x165)]((_0x3795b8,_0x2ce847)=>{_0x47ec1b[_0x2ce847]['batch_code']=_0x3795b8;}),_0x1def4e[_0x6d3304(0x165)]((_0x14316d,_0x239676)=>{_0x47ec1b[_0x239676]['expiry_date']=_0x14316d;}),_0x1a80f8[_0x6d3304(0x165)]((_0x51cc95,_0x1f677a)=>{_0x47ec1b[_0x1f677a]['maxperunit']=_0x51cc95;}),_0x4210e4[_0x6d3304(0x165)]((_0x6507e1,_0x52a803)=>{_0x47ec1b[_0x52a803]['production_date']=_0x6507e1;}),_0xf8f13a[_0x6d3304(0x165)]((_0x567724,_0x514d41)=>{var _0x35e4bd=_0x6d3304;_0x47ec1b[_0x514d41][_0x35e4bd(0xf0)]=Math[_0x35e4bd(0x184)](_0x567724);}),_0x3113eb['forEach']((_0x5cefba,_0x18d16b)=>{var _0x517f81=_0x6d3304;_0x47ec1b[_0x18d16b][_0x517f81(0x16a)]=_0x5cefba;}),_0x5dd98d[_0x6d3304(0x165)]((_0x38e939,_0x162bd6)=>{var _0x134909=_0x6d3304;_0x47ec1b[_0x162bd6][_0x134909(0x110)]=_0x38e939;}),_0xb80e33[_0x6d3304(0x165)]((_0x321ef2,_0x22d682)=>{var _0x2a7de6=_0x6d3304;_0x47ec1b[_0x22d682][_0x2a7de6(0x1b5)]=_0x321ef2;}),_0x22f803[_0x6d3304(0x165)]((_0x7655c8,_0x8c6e79)=>{_0x47ec1b[_0x8c6e79]['quantity_notConverted']=_0x7655c8;}),_0x8b2185['forEach']((_0x4389d3,_0x2b2c7f)=>{var _0x3de56a=_0x6d3304;_0x47ec1b[_0x2b2c7f][_0x3de56a(0xec)]=_0x4389d3;});var _0x2b4c79=0x0;_0x47ec1b['forEach'](_0x38ff33=>{var _0x3d9c02=_0x6d3304;console[_0x3d9c02(0x1d7)]('foreach\x20newproduct',_0x38ff33),(parseInt(_0x38ff33[_0x3d9c02(0xe8)])<parseInt(_0x38ff33[_0x3d9c02(0x13e)])||parseInt(_0x38ff33[_0x3d9c02(0x13e)])==0x0)&&_0x2b4c79++;});if(_0x2b4c79!=0x0)return _0x1589f1[_0x6d3304(0xfe)](_0x6d3304(0xe4),_0x6d3304(0xde)),_0x6cc0ee['redirect'](_0x6d3304(0xfa));const _0x218b25=_0x47ec1b['filter'](_0x55cf12=>_0x55cf12[_0x6d3304(0x13e)]!=='0'&&_0x55cf12['quantity']!=='');_0x2c9ad6[_0x6d3304(0x1cb)]=_0x5300d8,_0x2c9ad6[_0x6d3304(0x169)]=_0x41f372,_0x2c9ad6[_0x6d3304(0x1d0)]=_0x53a298,_0x2c9ad6[_0x6d3304(0x1c1)]=_0x5daa8d,_0x2c9ad6[_0x6d3304(0x10e)]=_0x218b25,_0x2c9ad6[_0x6d3304(0x1aa)]=_0x1eac5a,_0x2c9ad6[_0x6d3304(0x1db)]=_0x31d310,_0x2c9ad6[_0x6d3304(0x1bd)]='False',_0x2c9ad6[_0x6d3304(0x115)]=_0x6d3304(0x13f);const _0x4895d2=await _0x2c9ad6[_0x6d3304(0xf3)]();_0x1589f1[_0x6d3304(0xfe)](_0x6d3304(0x1ae),_0x6d3304(0xd5)),_0x6cc0ee[_0x6d3304(0xd3)]('/all_sales/view');}catch(_0x54374a){console[_0x6d3304(0x1d7)](_0x54374a);}}),router[a0_0x139188(0x12d)]('/give_payment/:id',auth,async(_0x5e5832,_0x35d693)=>{var _0x39ca38=a0_0x139188;try{const _0x11a1ce=_0x5e5832[_0x39ca38(0x174)]['id'],{invoice:_0x5e4c3a,customer:_0x3a7578,receivable_amount:_0xa9c1d7,received_amount:_0x1bb656}=_0x5e5832['body'],_0x5b9ce7=await sales[_0x39ca38(0x193)](_0x11a1ce);console['log'](_0x5b9ce7);var _0xb66286=_0xa9c1d7-_0x1bb656;console[_0x39ca38(0x1d7)](_0x1bb656),_0x5b9ce7['received_amount']=parseFloat(_0x1bb656)+parseFloat(_0x5b9ce7[_0x39ca38(0x1d6)]),_0x5b9ce7['due_amount']=_0xb66286,console[_0x39ca38(0x1d7)](_0x5b9ce7);const _0x3ddcf7=await _0x5b9ce7[_0x39ca38(0xf3)](),_0x1a9b93=await c_payment_data['findOne']({'invoice':_0x5e4c3a});_0x1a9b93[_0x39ca38(0x121)]=_0xb66286,await _0x1a9b93[_0x39ca38(0xf3)]();let _0x5d07e3=new Date(),_0x55cbfb=('0'+_0x5d07e3[_0x39ca38(0x1c5)]())[_0x39ca38(0x120)](-0x2),_0x2757e2=('0'+(_0x5d07e3[_0x39ca38(0xf2)]()+0x1))['slice'](-0x2),_0x5093ef=_0x5d07e3[_0x39ca38(0x122)](),_0x5f0ab0=_0x5093ef+'-'+_0x2757e2+'-'+_0x55cbfb;const _0xde4687=new customer_payment({'invoice':_0x5e4c3a,'date':_0x5093ef+'-'+_0x2757e2+'-'+_0x55cbfb,'customer':_0x3a7578,'reason':_0x39ca38(0x164),'amount':_0x1bb656}),_0x2cbd40=await _0xde4687[_0x39ca38(0xf3)]();_0x5e5832['flash'](_0x39ca38(0x1ae),'payment\x20successfull'),_0x35d693['redirect'](_0x39ca38(0x15b));}catch(_0x53313b){console[_0x39ca38(0x1d7)](_0x53313b);}}),router['get'](a0_0x139188(0xff),auth,async(_0x2ae9de,_0x231b0c)=>{var _0x5ee65f=a0_0x139188;try{const {username:_0x331845,email:_0x57970f,role:_0x331d5b}=_0x2ae9de[_0x5ee65f(0x179)],_0x46b4bc=_0x2ae9de[_0x5ee65f(0x179)],_0x421e29=await profile[_0x5ee65f(0x190)]({'email':_0x46b4bc['email']}),_0x2c722c=await master_shop[_0x5ee65f(0x15e)]();console['log'](_0x5ee65f(0x1d5),_0x2c722c);const _0x3c429b=_0x2ae9de[_0x5ee65f(0x174)]['id'],_0x1c2be3=await sales['findById'](_0x3c429b);console[_0x5ee65f(0x1d7)](_0x1c2be3);const _0x23f31c=await customer[_0x5ee65f(0x190)]({'name':_0x1c2be3[_0x5ee65f(0x169)]});console[_0x5ee65f(0x1d7)](_0x23f31c);if(_0x2c722c[0x0][_0x5ee65f(0x1be)]=='English\x20(US)'){var _0x59625c=users[_0x5ee65f(0x1bf)];console[_0x5ee65f(0x1d7)](_0x59625c);}else{if(_0x2c722c[0x0][_0x5ee65f(0x1be)]==_0x5ee65f(0x1cc))var _0x59625c=users[_0x5ee65f(0x1cc)];else{if(_0x2c722c[0x0][_0x5ee65f(0x1be)]=='German')var _0x59625c=users[_0x5ee65f(0x1af)];else{if(_0x2c722c[0x0]['language']==_0x5ee65f(0xe9))var _0x59625c=users[_0x5ee65f(0xe9)];else{if(_0x2c722c[0x0][_0x5ee65f(0x1be)]==_0x5ee65f(0x198))var _0x59625c=users[_0x5ee65f(0x198)];else{if(_0x2c722c[0x0][_0x5ee65f(0x1be)]==_0x5ee65f(0x16e))var _0x59625c=users[_0x5ee65f(0xcf)];else{if(_0x2c722c[0x0][_0x5ee65f(0x1be)]==_0x5ee65f(0x1ba))var _0x59625c=users[_0x5ee65f(0x1ba)];else{if(_0x2c722c[0x0][_0x5ee65f(0x1be)]==_0x5ee65f(0x1d4))var _0x59625c=users[_0x5ee65f(0x189)];}}}}}}}_0x231b0c['render']('sales_invoice',{'success':_0x2ae9de[_0x5ee65f(0xfe)](_0x5ee65f(0x1ae)),'errors':_0x2ae9de['flash']('errors'),'role':_0x46b4bc,'profile':_0x421e29,'master_shop':_0x2c722c,'customers':_0x23f31c,'sales':_0x1c2be3,'language':_0x59625c});}catch(_0x4d3e16){console[_0x5ee65f(0x1d7)](_0x4d3e16);}}),router['get'](a0_0x139188(0xe1),auth,async(_0x220ad7,_0x36a094)=>{var _0x1a1771=a0_0x139188;try{const {username:_0x30fcbd,email:_0x50b74c,role:_0x199b71}=_0x220ad7['user'],_0xeb455e=_0x220ad7[_0x1a1771(0x179)],_0x252e09=await profile[_0x1a1771(0x190)]({'email':_0xeb455e[_0x1a1771(0x106)]}),_0x289b6f=await master_shop[_0x1a1771(0x15e)]();console[_0x1a1771(0x1d7)](_0x1a1771(0x1d5),_0x289b6f);const _0x511ef5=_0x220ad7[_0x1a1771(0x174)]['id'];console[_0x1a1771(0x1d7)](_0x511ef5);const _0xd53575=await sales[_0x1a1771(0x193)](_0x511ef5);console['log'](_0x1a1771(0xfc),_0xd53575);const _0x534542=await warehouse[_0x1a1771(0x175)]([{'$match':{'name':'Return\x20Goods','room':_0x1a1771(0x19a)}},{'$unwind':_0x1a1771(0xfb)},{'$group':{'_id':_0x1a1771(0x1ad),'name':{'$first':_0x1a1771(0x12c)},'product_stock':{'$first':_0x1a1771(0x12e)},'level':{'$first':_0x1a1771(0x196)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x1a1771(0xcd)},'primary_code':{'$first':_0x1a1771(0xea)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1a1771(0x17c)}}}]);console[_0x1a1771(0x1d7)](_0x1a1771(0xeb),_0x534542);const _0x231730=await product[_0x1a1771(0x15e)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x1a1771(0x187),'warehouse_category':_0x1a1771(0x18a)}},{'$group':{'_id':_0x1a1771(0xd8),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x2e99a5=[_0x1a1771(0x19a)];if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0x18d)){var _0x30473b=users[_0x1a1771(0x1bf)];console['log'](_0x30473b);}else{if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0x1cc))var _0x30473b=users['Hindi'];else{if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0x1af))var _0x30473b=users['German'];else{if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0xe9))var _0x30473b=users[_0x1a1771(0xe9)];else{if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0x198))var _0x30473b=users[_0x1a1771(0x198)];else{if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0x16e))var _0x30473b=users['Portuguese'];else{if(_0x289b6f[0x0]['language']==_0x1a1771(0x1ba))var _0x30473b=users[_0x1a1771(0x1ba)];else{if(_0x289b6f[0x0][_0x1a1771(0x1be)]==_0x1a1771(0x1d4))var _0x30473b=users[_0x1a1771(0x189)];}}}}}}}_0x36a094['render']('return_sale',{'success':_0x220ad7[_0x1a1771(0xfe)](_0x1a1771(0x1ae)),'errors':_0x220ad7['flash'](_0x1a1771(0xe4)),'role':_0xeb455e,'profile':_0x252e09,'user':_0xd53575,'stock':_0x534542,'master_shop':_0x289b6f,'unit':_0x231730,'language':_0x30473b,'warehouses':warehouse_data,'rooms':_0x2e99a5});}catch(_0x16ea93){console[_0x1a1771(0x1d7)](_0x16ea93),_0x36a094[_0x1a1771(0x10b)](0xc8)[_0x1a1771(0x133)]({'message':_0x16ea93['message']});}}),router[a0_0x139188(0x12d)](a0_0x139188(0xe1),auth,async(_0x4670d9,_0x221074)=>{var _0xcadb22=a0_0x139188;try{const {invoice:_0x1e913d,date:_0x235539,warehouse_name:_0xa79739,product_name:_0x2deaed,primary_code:_0x3c45fb,secondary_code:_0x4ae01e,product_code:_0x585280,sales_quantity:_0x5d0ccf,stocks:_0x4860c4,return_qty:_0x1fc707,Room_name:_0x4b4786,to_warehouse_name:_0x1556a6,to_Roomname:_0x772f7b,to_Room_name:_0x5a3360,note:_0x49cdd9,level:_0x64cec,isle:_0x33c00a,pallet:_0x36308c}=_0x4670d9[_0xcadb22(0x17f)];if(typeof _0x2deaed==_0xcadb22(0x145))var _0x1b4579=[_0x4670d9['body']['product_name']],_0x2c1c13=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x194)]],_0x2a7431=[_0x4670d9['body']['secondary_code']],_0x40aa4a=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x1a6)]],_0x34f114=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x199)]],_0xaceb00=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x138)]],_0x4ff13b=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x171)]],_0x1943a1=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x19c)]],_0x786927=[_0x4670d9[_0xcadb22(0x17f)]['bin']],_0x2ee8b4=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x1a4)]],_0x488545=[_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x149)]];else var _0x1b4579=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x1a8)]],_0x2c1c13=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x194)]],_0x2a7431=[..._0x4670d9[_0xcadb22(0x17f)]['secondary_code']],_0x40aa4a=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x1a6)]],_0x34f114=[..._0x4670d9[_0xcadb22(0x17f)]['sales_quantity']],_0xaceb00=[..._0x4670d9[_0xcadb22(0x17f)]['stocks']],_0x4ff13b=[..._0x4670d9['body'][_0xcadb22(0x171)]],_0x1943a1=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x19c)]],_0x786927=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x107)]],_0x2ee8b4=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x1a4)]],_0x488545=[..._0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x149)]];const _0x503d5e=_0x1b4579[_0xcadb22(0x111)](_0x2d39ad=>{return _0x2d39ad={'product_name':_0x2d39ad};});_0x2c1c13[_0xcadb22(0x165)]((_0x38ba69,_0x35fc22)=>{_0x503d5e[_0x35fc22]['primary_code']=_0x38ba69;}),_0x2a7431[_0xcadb22(0x165)]((_0x910484,_0xb50651)=>{var _0x260c95=_0xcadb22;_0x503d5e[_0xb50651][_0x260c95(0xf5)]=_0x910484;}),_0x40aa4a['forEach']((_0x12dd43,_0x27dd6e)=>{var _0x16b150=_0xcadb22;_0x503d5e[_0x27dd6e][_0x16b150(0x1a6)]=_0x12dd43;}),_0x34f114[_0xcadb22(0x165)]((_0x5a45eb,_0x7c7fbd)=>{var _0x212c8a=_0xcadb22;_0x503d5e[_0x7c7fbd][_0x212c8a(0x1a0)]=_0x5a45eb;}),_0xaceb00[_0xcadb22(0x165)]((_0x373953,_0x4743c5)=>{var _0x3aebc9=_0xcadb22;_0x503d5e[_0x4743c5][_0x3aebc9(0xe8)]=_0x373953;}),_0x4ff13b['forEach']((_0x386516,_0xe4300f)=>{var _0x37a5f0=_0xcadb22;_0x503d5e[_0xe4300f][_0x37a5f0(0x171)]=_0x386516;}),_0x1943a1[_0xcadb22(0x165)]((_0x2e1090,_0x59505b)=>{_0x503d5e[_0x59505b]['bay']=_0x2e1090;}),_0x786927['forEach']((_0x1a2e83,_0xb555f2)=>{var _0xb4534a=_0xcadb22;_0x503d5e[_0xb555f2][_0xb4534a(0x107)]=_0x1a2e83;}),_0x2ee8b4[_0xcadb22(0x165)]((_0x1f02fe,_0x8e11)=>{_0x503d5e[_0x8e11]['type']=_0x1f02fe;}),_0x488545[_0xcadb22(0x165)]((_0x4484e0,_0x6f246e)=>{var _0x49d3b0=_0xcadb22;_0x503d5e[_0x6f246e][_0x49d3b0(0x149)]=_0x4484e0;});var _0x592da9=0x0;_0x503d5e[_0xcadb22(0x165)](_0x1e9942=>{var _0x1be725=_0xcadb22;console[_0x1be725(0x1d7)](_0x1be725(0x172),_0x1e9942),(parseInt(_0x1e9942[_0x1be725(0x1a0)])<parseInt(_0x1e9942[_0x1be725(0x171)])||parseInt(_0x1e9942[_0x1be725(0xe8)])<parseInt(_0x1e9942[_0x1be725(0x171)])&&parseInt(_0x1e9942[_0x1be725(0x1a0)])>parseInt(_0x1e9942[_0x1be725(0x171)])||parseInt(_0x1e9942[_0x1be725(0x171)])==0x0)&&_0x592da9++;});if(_0x592da9!=0x0)return _0x4670d9[_0xcadb22(0xfe)]('errors','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x221074['redirect'](_0xcadb22(0xfa));const _0x1a40a7=await sales['findOne']({'invoice':_0x1e913d});console[_0xcadb22(0x1d7)](_0x1a40a7),_0x1a40a7['return_data']=_0xcadb22(0xd6);const _0xcb30d5=await _0x1a40a7[_0xcadb22(0xf3)](),_0x20062c=new sales_return({'invoice':_0x1e913d,'customer':_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x169)],'date':_0x235539,'warehouse_name':_0xa79739,'room':_0x4b4786,'ToWarehouse':_0x1556a6,'ToRoom':_0x5a3360,'return_sale':_0x503d5e,'note':_0x49cdd9}),_0x46d114=await _0x20062c['save']();console['log'](_0x20062c);const _0x66c1d0=await sales_return[_0xcadb22(0x190)]({'invoice':_0x1e913d}),_0x572250=await warehouse['findOne']({'name':_0x1556a6,'room':_0x5a3360});_0x66c1d0[_0xcadb22(0x1bc)][_0xcadb22(0x165)](_0x116f59=>{var _0x20d15e=_0xcadb22,_0x44c9b0=0x0;const _0x2350c7=_0x572250['product_details'][_0x20d15e(0x111)](_0x315036=>{var _0x4b0da8=_0x20d15e;_0x315036[_0x4b0da8(0x1a8)]==_0x116f59['product_name']&&_0x315036[_0x4b0da8(0x149)]==_0x116f59[_0x4b0da8(0x149)]&&_0x315036[_0x4b0da8(0x128)]==_0x116f59[_0x4b0da8(0x128)]&&_0x315036[_0x4b0da8(0x107)]==_0x116f59['bin']&&_0x315036[_0x4b0da8(0x19c)]==_0x116f59['bay']&&(_0x315036['product_stock']=parseInt(_0x315036[_0x4b0da8(0x12b)])+parseInt(_0x116f59[_0x4b0da8(0x171)]),_0x44c9b0++);});_0x44c9b0=='0'&&(_0x572250[_0x20d15e(0xdd)]=_0x572250[_0x20d15e(0xdd)][_0x20d15e(0x1c8)]({'product_name':_0x116f59[_0x20d15e(0x1a8)],'product_stock':_0x116f59['return_qty'],'primary_code':_0x116f59['primary_code'],'secondary_code':_0x116f59[_0x20d15e(0xf5)],'product_code':_0x116f59[_0x20d15e(0x1a6)],'bay':_0x116f59[_0x20d15e(0x19c)],'bin':_0x116f59[_0x20d15e(0x107)],'type':_0x116f59[_0x20d15e(0x128)],'floorlevel':_0x116f59['floorlevel']})),console[_0x20d15e(0x1d7)](_0x20d15e(0x173),_0x572250);}),await _0x572250[_0xcadb22(0xf3)](),console[_0xcadb22(0x1d7)](_0x4670d9[_0xcadb22(0x17f)]);const _0x513776=new c_payment_data({'invoice':_0x1e913d,'customer':_0x4670d9[_0xcadb22(0x17f)][_0xcadb22(0x169)],'reason':_0xcadb22(0x166)});await _0x513776[_0xcadb22(0xf3)]();const _0xcf045b=await master_shop['find']();console[_0xcadb22(0x1d7)](_0xcadb22(0x129),_0xcf045b[0x0]['image']);const _0x59c5a4=await email_settings[_0xcadb22(0x190)](),_0x97da52=await customer[_0xcadb22(0x190)]({'name':_0x4670d9['body'][_0xcadb22(0x169)]});console[_0xcadb22(0x1d7)]('customer_data',_0x97da52);_0xcf045b[0x0][_0xcadb22(0x170)]==0x1?(right_currency=_0xcf045b[0x0][_0xcadb22(0xee)],left_currency=''):(right_currency='',left_currency=_0xcf045b[0x0][_0xcadb22(0xee)]);var _0x2dee39=_0x1b4579,_0x3a139c=_0x4ff13b,_0x54a9b2='',_0x2ee95a;for(_0x2ee95a in _0x2dee39){_0x54a9b2+='<tr>'+_0xcadb22(0x1a3)+_0x2dee39[_0x2ee95a]+_0xcadb22(0x1df)+_0xcadb22(0x1a3)+_0x3a139c[_0x2ee95a]+_0xcadb22(0x1df)+_0xcadb22(0x181);}console[_0xcadb22(0x1d7)](_0xcadb22(0x10a),_0x54a9b2);let _0x328424=nodemailer['createTransport']({'service':_0xcadb22(0x136),'auth':{'user':_0x59c5a4[_0xcadb22(0x106)],'pass':_0x59c5a4['password']}}),_0x2de067={'from':_0x59c5a4['email'],'to':_0x97da52[_0xcadb22(0x106)],'subject':_0xcadb22(0x15a),'attachments':[{'filename':_0xcadb22(0x123),'path':__dirname+'/../public'+_0xcadb22(0x141)+_0xcf045b[0x0][_0xcadb22(0x191)],'cid':_0xcadb22(0x1d2)}],'html':_0xcadb22(0x1c9)+_0xcadb22(0x1b1)+'</head><body>'+_0xcadb22(0x176)+_0xcadb22(0xd9)+_0xcadb22(0x176)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0xcadb22(0x192)+_0xcf045b[0x0]['site_title']+_0xcadb22(0xd2)+_0xcadb22(0x127)+_0xcadb22(0x127)+_0xcadb22(0x14a)+_0xcadb22(0x176)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xcadb22(0x135)+_0x1e913d+'\x20'+_0xcadb22(0xe7)+_0xcadb22(0xfd)+_0x235539+'\x20'+'</span>'+'</h5>'+_0xcadb22(0x127)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xcadb22(0xe3)+_0xcadb22(0xdf)+_0xcadb22(0x10d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0xcadb22(0x1a2)+_0xcadb22(0x13b)+'</tr>'+_0xcadb22(0x161)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x54a9b2+'\x20'+_0xcadb22(0x1c6)+'</table>'+_0xcadb22(0x176)+_0xcadb22(0x130)+_0xcadb22(0x19d)+_0xcf045b[0x0][_0xcadb22(0x12f)]+_0xcadb22(0x134)+'</div>'+_0xcadb22(0x127)+_0xcadb22(0xdb)};_0x328424[_0xcadb22(0x1d9)](_0x2de067,function(_0x4112b4,_0xc4d6fd){var _0x237e5b=_0xcadb22;_0x4112b4?(console[_0x237e5b(0x1d7)](_0x4112b4),console['log'](_0x237e5b(0x148))):console[_0x237e5b(0x1d7)]('Email\x20sent\x20successfully');}),_0x4670d9[_0xcadb22(0xfe)](_0xcadb22(0x1ae),_0xcadb22(0x178)),_0x221074[_0xcadb22(0xd3)](_0xcadb22(0x15b));}catch(_0x4edf39){console['log'](_0x4edf39),_0x221074[_0xcadb22(0x10b)](0xc8)[_0xcadb22(0x133)]({'message1':_0x4edf39[_0xcadb22(0x139)]});}}),router['get'](a0_0x139188(0x11b),auth,async(_0x1ced46,_0x48eeed)=>{var _0x140cc0=a0_0x139188;try{const {username:_0x4cf3af,email:_0x5c1519,role:_0x47b6a1}=_0x1ced46[_0x140cc0(0x179)],_0x1ef64e=_0x1ced46[_0x140cc0(0x179)],_0x4575bb=await profile[_0x140cc0(0x190)]({'email':_0x1ef64e['email']}),_0x2bb9b5=await master_shop[_0x140cc0(0x15e)]();console[_0x140cc0(0x1d7)](_0x140cc0(0x152),_0x2bb9b5);const _0x25df58=_0x1ced46['params']['id'],_0x275a11=await sales['findById'](_0x25df58);console[_0x140cc0(0x1d7)]('barcode\x20user_id',_0x275a11);if(_0x2bb9b5[0x0]['language']==_0x140cc0(0x18d))var _0x3b862d=users[_0x140cc0(0x1bf)];else{if(_0x2bb9b5[0x0][_0x140cc0(0x1be)]=='Hindi')var _0x3b862d=users['Hindi'];else{if(_0x2bb9b5[0x0][_0x140cc0(0x1be)]==_0x140cc0(0x1af))var _0x3b862d=users['German'];else{if(_0x2bb9b5[0x0]['language']==_0x140cc0(0xe9))var _0x3b862d=users['Spanish'];else{if(_0x2bb9b5[0x0]['language']==_0x140cc0(0x198))var _0x3b862d=users[_0x140cc0(0x198)];else{if(_0x2bb9b5[0x0][_0x140cc0(0x1be)]=='Portuguese\x20(BR)')var _0x3b862d=users['Portuguese'];else{if(_0x2bb9b5[0x0][_0x140cc0(0x1be)]==_0x140cc0(0x1ba))var _0x3b862d=users[_0x140cc0(0x1ba)];else{if(_0x2bb9b5[0x0]['language']==_0x140cc0(0x1d4))var _0x3b862d=users[_0x140cc0(0x189)];}}}}}}}_0x48eeed[_0x140cc0(0x118)](_0x140cc0(0x16f),{'success':_0x1ced46[_0x140cc0(0xfe)](_0x140cc0(0x1ae)),'errors':_0x1ced46[_0x140cc0(0xfe)]('errors'),'role':_0x1ef64e,'profile':_0x4575bb,'alldata':_0x275a11,'master_shop':_0x2bb9b5,'language':_0x3b862d});}catch(_0x17a074){console['log'](_0x17a074);}}),router['post'](a0_0x139188(0x153),async(_0x3cc8af,_0x5eec42)=>{var _0x4af173=a0_0x139188;const {product_code:_0x11c7ce,warehouse_name:_0x3526dd,rooms_data:_0x542698,Roomslist:_0x3f8a57}=_0x3cc8af[_0x4af173(0x17f)],_0x37a895=_0x3f8a57[_0x4af173(0x146)](','),_0x155b48=[];async function _0x209f00(_0x339cdb){var _0x1ab54f=_0x4af173;const _0x383290=await warehouse['aggregate']([{'$match':{'name':_0x3526dd,'room':_0x339cdb}},{'$unwind':_0x1ab54f(0xfb)},{'$match':{'product_details.primary_code':_0x11c7ce}},{'$group':{'_id':_0x1ab54f(0x1ad),'name':{'$first':_0x1ab54f(0x12c)},'product_stock':{'$first':_0x1ab54f(0x12e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1ab54f(0x17d)},'product_code':{'$first':_0x1ab54f(0x17c)},'level':{'$first':_0x1ab54f(0x10c)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1ab54f(0x1a9)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1ab54f(0x11a)},'storage':{'$first':_0x1ab54f(0x17a)},'rack':{'$first':_0x1ab54f(0x11d)},'expiry_date':{'$first':_0x1ab54f(0x1b4)},'production_date':{'$first':_0x1ab54f(0x13d)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x1ab54f(0x186)},'product_cat':{'$first':_0x1ab54f(0x157)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1ab54f(0x1ac)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x1ab54f(0x195)},'actual_uom':{'$first':'$product_details.actual_uom'},'delivery_date':{'$first':_0x1ab54f(0x101)},'delivery_code':{'$first':_0x1ab54f(0x143)}}}]),_0x3e67f9=await warehouse[_0x1ab54f(0x175)]([{'$match':{'name':_0x3526dd,'room':_0x339cdb}},{'$unwind':_0x1ab54f(0xfb)},{'$match':{'product_details.secondary_code':_0x11c7ce}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1ab54f(0x12c)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1ab54f(0xea)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1ab54f(0x10c)},'isle':{'$first':_0x1ab54f(0x1dd)},'type':{'$first':_0x1ab54f(0x1a9)},'pallet':{'$first':_0x1ab54f(0x155)},'unit':{'$first':_0x1ab54f(0x10f)},'secondary_unit':{'$first':_0x1ab54f(0x11a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1ab54f(0x11d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1ab54f(0x13d)},'maxPerUnit':{'$first':_0x1ab54f(0x197)},'batch_code':{'$first':_0x1ab54f(0x186)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1ab54f(0x1ac)},'invoice':{'$first':_0x1ab54f(0x144)},'delivery_date':{'$first':'$product_details.delivery_date'},'delivery_code':{'$first':_0x1ab54f(0x143)}}}]);if(_0x383290['length']>0x0)_0x155b48[_0x1ab54f(0x132)](_0x383290);else _0x3e67f9['length']>0x0&&_0x155b48['push'](_0x3e67f9);}const _0x57af6a=_0x37a895['map'](_0x5c547b=>_0x209f00(_0x5c547b));await Promise[_0x4af173(0x156)](_0x57af6a),_0x5eec42[_0x4af173(0x133)](_0x155b48);}),module[a0_0x139188(0x11e)]=router;