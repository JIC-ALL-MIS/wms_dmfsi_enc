var a0_0x3654d2=a0_0x58d2;(function(_0x2949f6,_0x7b60cb){var _0x415094=a0_0x58d2,_0xd276ae=_0x2949f6();while(!![]){try{var _0x1e419f=parseInt(_0x415094(0x175))/0x1*(-parseInt(_0x415094(0x1f8))/0x2)+-parseInt(_0x415094(0x1c6))/0x3*(parseInt(_0x415094(0x206))/0x4)+-parseInt(_0x415094(0x1ef))/0x5*(parseInt(_0x415094(0x1b3))/0x6)+-parseInt(_0x415094(0x218))/0x7*(-parseInt(_0x415094(0x214))/0x8)+-parseInt(_0x415094(0x229))/0x9+-parseInt(_0x415094(0x1d6))/0xa+parseInt(_0x415094(0x1c3))/0xb;if(_0x1e419f===_0x7b60cb)break;else _0xd276ae['push'](_0xd276ae['shift']());}catch(_0x41add6){_0xd276ae['push'](_0xd276ae['shift']());}}}(a0_0x425a,0xa6416));const express=require(a0_0x3654d2(0x1fa)),app=express(),router=express[a0_0x3654d2(0x1ab)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x3654d2(0x163)),auth=require(a0_0x3654d2(0x1ee)),nodemailer=require(a0_0x3654d2(0x21d)),users=require(a0_0x3654d2(0x1c7));function a0_0x58d2(_0x8d141f,_0x36df3e){var _0x425a41=a0_0x425a();return a0_0x58d2=function(_0x58d22b,_0x10c3cc){_0x58d22b=_0x58d22b-0x11e;var _0x138555=_0x425a41[_0x58d22b];return _0x138555;},a0_0x58d2(_0x8d141f,_0x36df3e);}router[a0_0x3654d2(0x133)](a0_0x3654d2(0x1b2),auth,async(_0x3c0e42,_0x693cc0)=>{var _0x5eb65f=a0_0x3654d2;try{const {username:_0x557451,email:_0x2dc870,role:_0x1dc2be}=_0x3c0e42[_0x5eb65f(0x17f)],_0x173d99=_0x3c0e42[_0x5eb65f(0x17f)],_0x157eff=await profile[_0x5eb65f(0x204)]({'email':_0x173d99['email']}),_0x4a7996=await master_shop[_0x5eb65f(0x143)]();let _0x51f546;if(_0x173d99['role']=='staff'){const _0x5928b2=await staff['findOne']({'email':_0x173d99[_0x5eb65f(0x209)]});_0x51f546=await sales[_0x5eb65f(0x1ed)]([{'$lookup':{'from':_0x5eb65f(0x1e4),'localField':_0x5eb65f(0x125),'foreignField':_0x5eb65f(0x120),'as':'customers_docs'}},{'$unwind':_0x5eb65f(0x129)},{'$unwind':_0x5eb65f(0x19f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5eb65f(0x16f)},'customers':{'$first':_0x5eb65f(0x1e6)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5eb65f(0x17b)},'sale_product':{'$push':_0x5eb65f(0x19f)},'note':{'$first':'$note'},'return_data':{'$first':_0x5eb65f(0x1a6)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x5eb65f(0x1fd)},'type':{'$addToSet':_0x5eb65f(0x1a2)},'pallet':{'$addToSet':_0x5eb65f(0x1f7)},'finalize':{'$first':_0x5eb65f(0x1cd)},'isAllowEdit':{'$first':_0x5eb65f(0x226)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x51f546=await sales[_0x5eb65f(0x1ed)]([{'$lookup':{'from':_0x5eb65f(0x1e4),'localField':_0x5eb65f(0x125),'foreignField':_0x5eb65f(0x120),'as':'customers_docs'}},{'$unwind':_0x5eb65f(0x129)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5eb65f(0x1cb),'invoice':{'$first':_0x5eb65f(0x16f)},'customers':{'$first':_0x5eb65f(0x1e6)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5eb65f(0x17b)},'sale_product':{'$push':_0x5eb65f(0x19f)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5eb65f(0x129)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5eb65f(0x1bb)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5eb65f(0x1a2)},'pallet':{'$addToSet':_0x5eb65f(0x1f7)},'finalize':{'$first':_0x5eb65f(0x1cd)},'isAllowEdit':{'$first':_0x5eb65f(0x226)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x5eb65f(0x1a8),_0x51f546);if(_0x4a7996[0x0][_0x5eb65f(0x18e)]==_0x5eb65f(0x21e)){var _0x180405=users[_0x5eb65f(0x16e)];console[_0x5eb65f(0x1b1)](_0x180405);}else{if(_0x4a7996[0x0][_0x5eb65f(0x18e)]=='Hindi')var _0x180405=users[_0x5eb65f(0x22a)];else{if(_0x4a7996[0x0][_0x5eb65f(0x18e)]=='German')var _0x180405=users[_0x5eb65f(0x227)];else{if(_0x4a7996[0x0][_0x5eb65f(0x18e)]=='Spanish')var _0x180405=users['Spanish'];else{if(_0x4a7996[0x0]['language']==_0x5eb65f(0x1a4))var _0x180405=users['French'];else{if(_0x4a7996[0x0][_0x5eb65f(0x18e)]==_0x5eb65f(0x162))var _0x180405=users['Portuguese'];else{if(_0x4a7996[0x0][_0x5eb65f(0x18e)]=='Chinese')var _0x180405=users[_0x5eb65f(0x1b0)];else{if(_0x4a7996[0x0][_0x5eb65f(0x18e)]==_0x5eb65f(0x219))var _0x180405=users[_0x5eb65f(0x179)];}}}}}}}_0x693cc0[_0x5eb65f(0x1c2)](_0x5eb65f(0x224),{'success':_0x3c0e42[_0x5eb65f(0x1dc)]('success'),'errors':_0x3c0e42[_0x5eb65f(0x1dc)](_0x5eb65f(0x1d3)),'sales':_0x51f546,'profile':_0x157eff,'role':_0x173d99,'master_shop':_0x4a7996,'language':_0x180405});}catch(_0x1892db){console['log'](_0x1892db);}});function a0_0x425a(){var _0x5ee176=['toString','secondary_code','$customers_docs','rack','sale_qty','/preview/:id','date','production_date','return_qty','RoomAssigned','forEach','</body></html>','get','<table\x20style=\x22width:\x20100%\x20!important;\x22>','sales\x20item\x20return\x20successfull','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','delivery_code','$product_details','$room','$name','staff','$product_details.product_stock','types','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','note','/barcode/:id','Return\x20Goods','find','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_code','product_data','$product_details.type','<h2>\x20','floor','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','amount','Sale\x20Return\x20Mail','prod_cat','sale_product','status','</div>','random','False','Sales\x20Update\x20successfully','json','/all_sales/view','getFullYear','maxperunit','product','quantity_notConverted','$product_details.bin','currency_placement','$product_details._id','requested_qty','Spanish','Portuguese\x20(BR)','../models/all_models','add\x20post','getDate','room','push','<html><head><title></title>','$product_details.floorlevel','sales_quantity','unit','secondary_unit','Shelves','English','$invoice','Email\x20sent\x20successfully','master','edit_sales','filter','findById','31397XxatVv','password','level','<div>','Arabic','image','$warehouse_name','actual_uom','split','back','user','length','foreach\x20newproduct','$product.product_name','<tr>','role','$product_details.level','batch_code','Raw\x20Materials','barcode\x20Product\x20master','customer_data','floorlevel','message','carton','invoice','language','Sale\x20Return','payment\x20successfull','site_title','abs','body','$product_details.product_code','Enclosed','catch','product_stock','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/barcode_scanner','</span>','return_sale','An\x20error\x20occurred\x20while\x20saving\x20data.','\x20Order\x20Number\x20:\x20','$sale_product','redirect','slice','$sale_product.type','getMonth','French','Error\x20Occurs','$return_data','Logo.png','sales\x20all_data','type','$product_details.actual_uom','Router','all','prod_invoice','</td>','post','Chinese','log','/view','9606BnwWeP','$product_details.secondary_unit','$product_details.expiry_date','exports','</h5>','$product_details.production_date','received_amount','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$sale_product.bay','purchases_data','/../public','stock','$product_details.product_name','product_details','primary_code','render','35325543VddPdX','OUT-','RMSEmail','66RmbGHR','../public/language/languages.json','bay','params','$product_details.actual_qty','$_id','bin','$finalize','Sales\x20Mail','$product_details.invoice','warehouse','$product_details.isle','\x20Order\x20Date\x20:\x20','errors','</tbody>','storage','9276880IolBHO','then','room_name','Floor','<!DOCTYPE\x20html>','<h5>','flash','Portuguese','finalize','edit_sales_view','/upload/','$product_details.rack','_id','$product_details.primary_code','customers','product_list','$customer','Received\x20Payment\x20For\x20Sale','$product_details.pallet','map','$product_details.secondary_code','/view/:id','</thead>','aggregate','../middleware/auth','845URsjqF','<hr\x20class=\x22my-3\x22>','</tr>','success','Ambient','currency','warehouse_name','max_per_unit','$sale_product.floorlevel','2eSaGFT','concat','express','<strong>\x20Regards\x20</strong>','$product_details.unit','$sale_product.bin','Enabled','$product','string','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','sendMail','findOne','<span\x20style=\x22float:\x20right;\x22>','29604McvNvj','$product_details.storage','padStart','email','delivery_date','user_id','primary_unit','/view/return_sales/:id','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sales_invoice','</head><body>','891752vvxpFJ','$product_details.batch_code','SCRN','stocks','14mismSM','Arabic\x20(ae)','expiry_date','save','</table>','nodemailer','English\x20(US)','Sales\x20Add\x20successfully','$product_details.bay','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','return_data','actual_qty','all_sales','quantity','$isAllowEdit','German','<tbody\x20style=\x22text-align:\x20center;\x22>','12248037xGLzaV','Hindi','createTransport','final','name','Receiving\x20Area','Level','/view/add_sales','error','customer','/invoice/:id'];a0_0x425a=function(){return _0x5ee176;};return a0_0x425a();}async function getRandom8DigitNumber(){var _0x54f2a6=a0_0x3654d2;const _0xb8b939=0x989680,_0x21cf93=0x5f5e0ff,_0x227221=Math[_0x54f2a6(0x14b)](Math[_0x54f2a6(0x154)]()*(_0x21cf93-_0xb8b939+0x1))+_0xb8b939;var _0x1ffc30;const _0x3465ab=await sales[_0x54f2a6(0x204)]({'invoice':_0x54f2a6(0x1c4)+_0x227221});return _0x3465ab&&_0x3465ab[_0x54f2a6(0x180)]>0x0?_0x1ffc30=_0x54f2a6(0x1c4)+_0x227221:_0x1ffc30=_0x54f2a6(0x1c4)+_0x227221,_0x1ffc30;}router[a0_0x3654d2(0x133)](a0_0x3654d2(0x123),auth,async(_0x31a88f,_0x4a0483)=>{var _0x5a9318=a0_0x3654d2;try{const {username:_0x10915f,email:_0x13548e,role:_0x4b9c77}=_0x31a88f[_0x5a9318(0x17f)],_0x1e943f=_0x31a88f['user'],_0x4a1617=await profile[_0x5a9318(0x204)]({'email':_0x1e943f[_0x5a9318(0x209)]}),_0x5d450e=await master_shop[_0x5a9318(0x143)](),_0x489111=await customer[_0x5a9318(0x143)]({});let _0x7dbbdd;if(_0x1e943f[_0x5a9318(0x184)]==_0x5a9318(0x13b)){const _0x224356=await staff[_0x5a9318(0x204)]({'email':_0x1e943f['email']});_0x7dbbdd=await warehouse[_0x5a9318(0x1ed)]([{'$match':{'status':'Enabled','name':_0x224356[_0x5a9318(0x1d0)],'warehouse_category':_0x5a9318(0x187),'name':{'$ne':_0x5a9318(0x142)}}},{'$group':{'_id':_0x5a9318(0x13a),'name':{'$first':_0x5a9318(0x13a)}}},{'$sort':{'name':0x1}}]);}else _0x7dbbdd=await warehouse[_0x5a9318(0x1ed)]([{'$match':{'status':_0x5a9318(0x1fe),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x5a9318(0x142)}}},{'$group':{'_id':_0x5a9318(0x13a),'name':{'$first':_0x5a9318(0x13a)}}},{'$sort':{'name':0x1}}]);const _0x2772c2=await product[_0x5a9318(0x143)]({});var _0x561120=[_0x5a9318(0x1f3),'Enclosed'];const _0x398a6c=await sales['find']({}),_0x1021f8=_0x398a6c[_0x5a9318(0x180)]+0x1,_0x44874e=_0x5a9318(0x1c4)+_0x1021f8[_0x5a9318(0x127)]()[_0x5a9318(0x208)](0x5,'0');if(_0x5d450e[0x0][_0x5a9318(0x18e)]=='English\x20(US)'){var _0x45bcb9=users[_0x5a9318(0x16e)];console[_0x5a9318(0x1b1)](_0x45bcb9);}else{if(_0x5d450e[0x0][_0x5a9318(0x18e)]=='Hindi')var _0x45bcb9=users[_0x5a9318(0x22a)];else{if(_0x5d450e[0x0]['language']==_0x5a9318(0x227))var _0x45bcb9=users[_0x5a9318(0x227)];else{if(_0x5d450e[0x0]['language']==_0x5a9318(0x161))var _0x45bcb9=users['Spanish'];else{if(_0x5d450e[0x0][_0x5a9318(0x18e)]==_0x5a9318(0x1a4))var _0x45bcb9=users[_0x5a9318(0x1a4)];else{if(_0x5d450e[0x0][_0x5a9318(0x18e)]==_0x5a9318(0x162))var _0x45bcb9=users['Portuguese'];else{if(_0x5d450e[0x0]['language']==_0x5a9318(0x1b0))var _0x45bcb9=users[_0x5a9318(0x1b0)];else{if(_0x5d450e[0x0][_0x5a9318(0x18e)]==_0x5a9318(0x219))var _0x45bcb9=users[_0x5a9318(0x179)];}}}}}}}const _0x35c861=getRandom8DigitNumber();_0x35c861['then'](_0x58ca70=>{var _0x5526a9=_0x5a9318;_0x4a0483[_0x5526a9(0x1c2)]('add_sales',{'success':_0x31a88f[_0x5526a9(0x1dc)](_0x5526a9(0x1f2)),'errors':_0x31a88f[_0x5526a9(0x1dc)](_0x5526a9(0x1d3)),'role':_0x1e943f,'profile':_0x4a1617,'customer':_0x489111,'warehouse':_0x7dbbdd,'product':_0x2772c2,'invoice':_0x58ca70,'master_shop':_0x5d450e,'language':_0x45bcb9,'rooms_data':_0x561120});})[_0x5a9318(0x196)](_0x221fc4=>{var _0xb78867=_0x5a9318;_0x31a88f[_0xb78867(0x1dc)](_0xb78867(0x1d3),_0xb78867(0x146)),_0x4a0483[_0xb78867(0x1a0)](_0xb78867(0x158));});}catch(_0x12b5a4){console[_0x5a9318(0x1b1)](_0x12b5a4);}}),router[a0_0x3654d2(0x133)]('/view/add_sales/:id',auth,async(_0x451515,_0xddf01a)=>{var _0x138274=a0_0x3654d2;try{const _0x244c9c=_0x451515[_0x138274(0x1c9)]['id'];console['log'](_0x244c9c);const _0x1ccf52=await product[_0x138274(0x143)](),_0x1e603e=await purchases[_0x138274(0x1ed)]([{'$match':{'warehouse_name':_0x244c9c}},{'$unwind':_0x138274(0x1ff)},{'$group':{'_id':_0x138274(0x182)}}]);console['log'](_0x138274(0x1bc),_0x1e603e),_0xddf01a['status'](0xc8)[_0x138274(0x157)]({'purchases_data':_0x1e603e,'product_data':_0x1ccf52});}catch(_0x55bf80){console[_0x138274(0x1b1)](_0x55bf80);}}),router[a0_0x3654d2(0x1af)]('/view/add_sale/product',auth,async(_0x5a391a,_0x558b0c)=>{var _0x3514d1=a0_0x3654d2;try{const {warehouse_data:_0x244cb2,product_data:_0x2c60ff}=_0x5a391a[_0x3514d1(0x193)];console['log'](_0x5a391a[_0x3514d1(0x193)][_0x3514d1(0x148)]);;const _0x188a96=await master_shop[_0x3514d1(0x143)]();console[_0x3514d1(0x1b1)](_0x3514d1(0x171),_0x188a96);const _0x42ea3f=await product[_0x3514d1(0x204)]({'name':_0x2c60ff});console[_0x3514d1(0x1b1)](_0x3514d1(0x15b),_0x42ea3f);const _0x2c7584=await warehouse['aggregate']([{'$match':{'name':_0x244cb2}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x2c60ff}},{'$group':{'_id':_0x3514d1(0x1bf),'product_stock':{'$first':_0x3514d1(0x13c)}}}]);console[_0x3514d1(0x1b1)]('stock_data',_0x2c7584),_0x558b0c[_0x3514d1(0x152)](0xc8)['json']({'master':_0x188a96,'new_product':_0x42ea3f,'stock_data':_0x2c7584});}catch(_0x536485){console['log'](_0x536485);}}),router[a0_0x3654d2(0x1af)](a0_0x3654d2(0x123),auth,async(_0xb77884,_0x293531)=>{var _0x681bb1=a0_0x3654d2;try{const {invoice:_0x5483ca,date:_0x3f87d8,warehouse_name:_0x546ebb,product_name:_0x464101,stock:_0x42a092,quantity:_0x1d77f,note:_0x52975d,room:_0x492ab5,primary_code:_0x54ea69,secondary_code:_0x139d6b,prod_code:_0x577aa6,level:_0x356e55,isle:_0x61a75f,pallet:_0x3556e2,batch_code:_0x5a7593,SCRN:_0x3d7c37,expiry_date:_0x2e1e58}=_0xb77884[_0x681bb1(0x193)];if(typeof _0x464101=='string')var _0x1023e1=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x145)]],_0x170189=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x1be)]],_0x2ab9e1=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x18c)]],_0x3300a7=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x1c1)]],_0x30c923=[_0xb77884['body'][_0x681bb1(0x128)]],_0x46406c=[_0xb77884['body'][_0x681bb1(0x20e)]],_0xc7016a=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x177)]],_0x585fc4=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x20c)]],_0x2f55fd=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x16c)]],_0x22a259=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x186)]],_0x662e5b=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x21a)]],_0x2bb414=[_0xb77884[_0x681bb1(0x193)]['max_per_unit']],_0x4298b6=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x12e)]],_0x299fdb=[_0xb77884['body'][_0x681bb1(0x160)]],_0x7fcbd1=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x20a)]],_0x6dfa63=[_0xb77884['body'][_0x681bb1(0x137)]],_0x42a4d7=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x150)]],_0x5c6bf7=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x225)]],_0x127c7f=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x130)]],_0x42d43a=[_0xb77884['body']['prod_invoice']],_0x450db9=[_0xb77884['body']['actual_qty']],_0x39be24=[_0xb77884[_0x681bb1(0x193)][_0x681bb1(0x17c)]];else var _0x1023e1=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x145)]],_0x170189=[..._0xb77884[_0x681bb1(0x193)]['stock']],_0x2ab9e1=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x18c)]],_0x3300a7=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x1c1)]],_0x30c923=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x128)]],_0x46406c=[..._0xb77884[_0x681bb1(0x193)]['prod_code']],_0xc7016a=[..._0xb77884['body'][_0x681bb1(0x177)]],_0x585fc4=[..._0xb77884[_0x681bb1(0x193)]['primary_unit']],_0x2f55fd=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x16c)]],_0x22a259=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x186)]],_0x662e5b=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x21a)]],_0x2bb414=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x1f6)]],_0x4298b6=[..._0xb77884[_0x681bb1(0x193)]['production_date']],_0x299fdb=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x160)]],_0x7fcbd1=[..._0xb77884['body'][_0x681bb1(0x20a)]],_0x6dfa63=[..._0xb77884[_0x681bb1(0x193)]['delivery_code']],_0x42a4d7=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x150)]],_0x5c6bf7=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x225)]],_0x127c7f=[..._0xb77884['body'][_0x681bb1(0x130)]],_0x42d43a=[..._0xb77884['body'][_0x681bb1(0x1ad)]],_0x450db9=[..._0xb77884['body'][_0x681bb1(0x223)]],_0x39be24=[..._0xb77884[_0x681bb1(0x193)][_0x681bb1(0x17c)]];const _0x2cc311=_0x1023e1[_0x681bb1(0x1e9)](_0x2c96bd=>{return _0x2c96bd={'product_name':_0x2c96bd};});_0x170189[_0x681bb1(0x131)]((_0xbb0e57,_0x54a92e)=>{var _0x5f1198=_0x681bb1;_0x2cc311[_0x54a92e][_0x5f1198(0x1be)]=Math[_0x5f1198(0x192)](_0xbb0e57);}),_0x450db9[_0x681bb1(0x131)]((_0x32474f,_0x32cb62)=>{var _0x15d74b=_0x681bb1;_0x2cc311[_0x32cb62][_0x15d74b(0x223)]=Math[_0x15d74b(0x192)](_0x32474f);}),_0x39be24[_0x681bb1(0x131)]((_0xcabbaa,_0x45d89c)=>{_0x2cc311[_0x45d89c]['actual_uom']=_0xcabbaa;}),_0x2ab9e1['forEach']((_0x4814e7,_0x4c07fd)=>{var _0x7eef58=_0x681bb1;_0x2cc311[_0x4c07fd][_0x7eef58(0x225)]=_0x4814e7;}),_0x3300a7[_0x681bb1(0x131)]((_0x256b66,_0x2a577a)=>{var _0x19344e=_0x681bb1;_0x2cc311[_0x2a577a][_0x19344e(0x1c1)]=_0x256b66;}),_0x30c923[_0x681bb1(0x131)]((_0x368487,_0x2b9aab)=>{_0x2cc311[_0x2b9aab]['secondary_code']=_0x368487;}),_0x46406c[_0x681bb1(0x131)]((_0x31e3f7,_0xd70ddd)=>{var _0x1ac159=_0x681bb1;_0x2cc311[_0xd70ddd][_0x1ac159(0x147)]=_0x31e3f7;}),_0xc7016a['forEach']((_0x56c220,_0xb2a6df)=>{var _0x52dcda=_0x681bb1;_0x127c7f[_0x52dcda(0x131)]((_0x2f0ca0,_0x5800ee)=>{var _0x374522=_0x52dcda;if(_0x2f0ca0==_0x374522(0x121)&&_0xb2a6df==_0x5800ee){var _0x5308af=_0x56c220[_0x374522(0x1a1)](0x3);_0x2cc311[_0xb2a6df]['storage']=_0x56c220[0x0],_0x2cc311[_0xb2a6df]['rack']=_0x56c220[0x1],_0x2cc311[_0xb2a6df][_0x374522(0x1c8)]=0x0,_0x2cc311[_0xb2a6df]['bin']=0x0,_0x2cc311[_0xb2a6df][_0x374522(0x1a9)]=_0x374522(0x1d9),_0x2cc311[_0xb2a6df][_0x374522(0x18a)]=_0x5308af;}else{if(_0x2f0ca0==_0x374522(0x16d)&&_0xb2a6df==_0x5800ee){var _0x5308af=_0x56c220['slice'](0x3);_0x2cc311[_0xb2a6df][_0x374522(0x1d5)]=_0x56c220[0x0],_0x2cc311[_0xb2a6df][_0x374522(0x12a)]=_0x56c220[0x1],_0x2cc311[_0xb2a6df][_0x374522(0x1c8)]=0x0,_0x2cc311[_0xb2a6df]['bin']=0x0,_0x2cc311[_0xb2a6df][_0x374522(0x1a9)]=_0x374522(0x1d9),_0x2cc311[_0xb2a6df][_0x374522(0x18a)]=_0x56c220[0x5];}else{if(_0xb2a6df==_0x5800ee){var _0x137d4d;if(_0x56c220[0x4]=='L')_0x137d4d=_0x374522(0x122);else _0x56c220[0x4]=='F'&&(_0x137d4d=_0x374522(0x1d9));_0x2cc311[_0xb2a6df]['storage']=_0x56c220[0x0],_0x2cc311[_0xb2a6df]['rack']=_0x56c220[0x1],_0x2cc311[_0xb2a6df]['bay']=_0x56c220[0x2],_0x2cc311[_0xb2a6df][_0x374522(0x1cc)]=_0x56c220[0x3],_0x2cc311[_0xb2a6df]['type']=_0x137d4d,_0x2cc311[_0xb2a6df][_0x374522(0x18a)]=_0x56c220[0x5];}}}});}),_0x585fc4[_0x681bb1(0x131)]((_0x921b91,_0x1a2baa)=>{_0x2cc311[_0x1a2baa]['unit']=_0x921b91;}),_0x2f55fd['forEach']((_0x20ee1f,_0x250c35)=>{var _0x42e39b=_0x681bb1;_0x2cc311[_0x250c35][_0x42e39b(0x16c)]=_0x20ee1f;}),_0x22a259[_0x681bb1(0x131)]((_0x29992a,_0x5ce364)=>{var _0x4b0751=_0x681bb1;_0x2cc311[_0x5ce364][_0x4b0751(0x186)]=_0x29992a;}),_0x662e5b[_0x681bb1(0x131)]((_0x308315,_0x5ec1e2)=>{var _0x1e8815=_0x681bb1;_0x2cc311[_0x5ec1e2][_0x1e8815(0x21a)]=_0x308315;}),_0x2bb414[_0x681bb1(0x131)]((_0x422c58,_0x21ec77)=>{_0x2cc311[_0x21ec77]['maxperunit']=_0x422c58;}),_0x4298b6[_0x681bb1(0x131)]((_0xd60e0,_0x43280a)=>{var _0x401d2e=_0x681bb1;_0x2cc311[_0x43280a][_0x401d2e(0x12e)]=_0xd60e0;}),_0x299fdb['forEach']((_0x2ddb06,_0x3665a5)=>{var _0x3b7f0a=_0x681bb1;_0x2cc311[_0x3665a5][_0x3b7f0a(0x160)]=_0x2ddb06;}),_0x7fcbd1['forEach']((_0x522192,_0xcf4831)=>{var _0x4b4718=_0x681bb1;_0x2cc311[_0xcf4831][_0x4b4718(0x20a)]=_0x522192;}),_0x6dfa63['forEach']((_0x30fa31,_0x43af95)=>{var _0x923bea=_0x681bb1;_0x2cc311[_0x43af95][_0x923bea(0x137)]=_0x30fa31;}),_0x42a4d7[_0x681bb1(0x131)]((_0x1b3922,_0x1b71f2)=>{var _0x3786ca=_0x681bb1;_0x2cc311[_0x1b71f2][_0x3786ca(0x150)]=_0x1b3922;}),_0x5c6bf7[_0x681bb1(0x131)]((_0x32c9ca,_0x5b6781)=>{_0x2cc311[_0x5b6781]['quantity_notConverted']=_0x32c9ca;}),_0x127c7f[_0x681bb1(0x131)]((_0x1c9fcc,_0x24df2f)=>{_0x2cc311[_0x24df2f]['room_name']=_0x1c9fcc;}),_0x42d43a[_0x681bb1(0x131)]((_0x358ef5,_0x1d2f91)=>{var _0x6c2958=_0x681bb1;_0x2cc311[_0x1d2f91][_0x6c2958(0x18d)]=_0x358ef5;});var _0x19f87c=0x0;_0x2cc311['forEach'](_0x11e7b4=>{var _0x1f5b82=_0x681bb1;(_0x11e7b4['stock']<_0x11e7b4[_0x1f5b82(0x15c)]||_0x11e7b4[_0x1f5b82(0x15c)]==0x0)&&(console[_0x1f5b82(0x1b1)](_0x1f5b82(0x181),_0x11e7b4),_0x19f87c++);});const _0xf2c970=_0x2cc311[_0x681bb1(0x173)](_0x58a043=>_0x58a043[_0x681bb1(0x225)]!=='0'&&_0x58a043[_0x681bb1(0x225)]!==''),_0x5af4d2=new sales({'invoice':_0x5483ca,'customer':_0xb77884[_0x681bb1(0x193)]['customer'],'date':_0x3f87d8,'warehouse_name':_0x546ebb,'sale_product':_0xf2c970,'note':_0x52975d,'room':_0x492ab5,'primary_code':_0x54ea69,'secondary_code':_0x139d6b,'prod_code':_0x577aa6,'SCRN':_0x3d7c37}),_0x10c7a9=await _0x5af4d2['save']();_0xb77884[_0x681bb1(0x1dc)](_0x681bb1(0x1f2),_0x681bb1(0x21f)),_0x293531[_0x681bb1(0x1a0)]('/all_sales/preview/'+_0x10c7a9[_0x681bb1(0x1e2)]);}catch(_0xce01d6){console[_0x681bb1(0x1b1)](_0xce01d6);}}),router[a0_0x3654d2(0x133)](a0_0x3654d2(0x12c),auth,async(_0x219175,_0x421b31)=>{var _0x138d3c=a0_0x3654d2;try{const {username:_0x1c9baa,email:_0x3ca323,role:_0x5ad251}=_0x219175['user'],_0x13ab90=_0x219175[_0x138d3c(0x17f)],_0x2cb07b=await profile[_0x138d3c(0x204)]({'email':_0x13ab90[_0x138d3c(0x209)]}),_0x489da0=await master_shop[_0x138d3c(0x143)](),_0x4a88d4=_0x219175['params']['id'],_0x397639=await sales[_0x138d3c(0x174)](_0x4a88d4),_0x1ddcab=await warehouse['aggregate']([{'$match':{'name':_0x397639[_0x138d3c(0x1f5)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x138d3c(0x15d)},'type':{'$first':_0x138d3c(0x149)},'floorlevel':{'$first':_0x138d3c(0x169)},'primary_code':{'$first':_0x138d3c(0x1e3)},'secondary_code':{'$first':_0x138d3c(0x1ea)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x138d3c(0x207)},'rack':{'$first':_0x138d3c(0x1e1)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x138d3c(0x1b8)}}}]),_0x51bc15=await customer['find']({});let _0x46eb12;if(_0x13ab90[_0x138d3c(0x184)]=='staff'){const _0x14c45d=await staff[_0x138d3c(0x204)]({'email':_0x13ab90[_0x138d3c(0x209)]});_0x46eb12=await warehouse[_0x138d3c(0x1ed)]([{'$match':{'status':_0x138d3c(0x1fe),'name':_0x14c45d[_0x138d3c(0x1d0)]}},{'$group':{'_id':_0x138d3c(0x13a),'name':{'$first':_0x138d3c(0x13a)}}}]);}else _0x46eb12=await warehouse[_0x138d3c(0x1ed)]([{'$match':{'status':_0x138d3c(0x1fe)}},{'$group':{'_id':_0x138d3c(0x13a),'name':{'$first':_0x138d3c(0x13a)}}}]);const _0x3acdb1=await product[_0x138d3c(0x143)]({}),_0x418e57=await suppliers[_0x138d3c(0x143)]({});if(_0x489da0[0x0][_0x138d3c(0x18e)]==_0x138d3c(0x21e)){var _0x1cb93b=users[_0x138d3c(0x16e)];console[_0x138d3c(0x1b1)](_0x1cb93b);}else{if(_0x489da0[0x0][_0x138d3c(0x18e)]=='Hindi')var _0x1cb93b=users[_0x138d3c(0x22a)];else{if(_0x489da0[0x0][_0x138d3c(0x18e)]==_0x138d3c(0x227))var _0x1cb93b=users[_0x138d3c(0x227)];else{if(_0x489da0[0x0]['language']=='Spanish')var _0x1cb93b=users[_0x138d3c(0x161)];else{if(_0x489da0[0x0][_0x138d3c(0x18e)]==_0x138d3c(0x1a4))var _0x1cb93b=users['French'];else{if(_0x489da0[0x0]['language']==_0x138d3c(0x162))var _0x1cb93b=users['Portuguese'];else{if(_0x489da0[0x0]['language']=='Chinese')var _0x1cb93b=users[_0x138d3c(0x1b0)];else{if(_0x489da0[0x0][_0x138d3c(0x18e)]=='Arabic\x20(ae)')var _0x1cb93b=users['Arabic'];}}}}}}}_0x421b31[_0x138d3c(0x1c2)](_0x138d3c(0x1df),{'success':_0x219175[_0x138d3c(0x1dc)](_0x138d3c(0x1f2)),'errors':_0x219175[_0x138d3c(0x1dc)](_0x138d3c(0x1d3)),'role':_0x13ab90,'profile':_0x2cb07b,'customer':_0x51bc15,'warehouse':_0x46eb12,'product':_0x1ddcab,'user':_0x397639,'master_shop':_0x489da0,'unit':_0x3acdb1,'language':_0x1cb93b,'suppliers':_0x418e57});}catch(_0x3607dd){console[_0x138d3c(0x1b1)](_0x3607dd);}}),router[a0_0x3654d2(0x1af)](a0_0x3654d2(0x12c),auth,async(_0x2e62af,_0xda7955)=>{var _0x513933=a0_0x3654d2;try{const _0x23eef5=_0x2e62af[_0x513933(0x1c9)]['id'],{invoice:_0x18a3cc,warehouse_name:_0x58a7ad,room:_0xb8f87a}=_0x2e62af[_0x513933(0x193)],_0x32960c=await sales[_0x513933(0x204)]({'invoice':_0x18a3cc}),_0x48edff=_0x32960c[_0x513933(0x151)][_0x513933(0x1e9)](async _0x320b3a=>{var _0xff040d=_0x513933,_0x58df75=await warehouse[_0xff040d(0x204)]({'name':_0x58a7ad,'room':_0x320b3a['room_name'],'warehouse_category':_0xff040d(0x187)});const _0x4e6ea3=_0x58df75[_0xff040d(0x1c0)]['map'](_0x5a38be=>{var _0x599357=_0xff040d;_0x5a38be[_0x599357(0x145)]==_0x320b3a[_0x599357(0x145)]&&_0x5a38be[_0x599357(0x18a)]==_0x320b3a[_0x599357(0x18a)]&&_0x5a38be['type']==_0x320b3a['type']&&_0x5a38be[_0x599357(0x1cc)]==_0x320b3a[_0x599357(0x1cc)]&&_0x5a38be[_0x599357(0x1c8)]==_0x320b3a[_0x599357(0x1c8)]&&_0x5a38be['rack']==_0x320b3a[_0x599357(0x12a)]&&_0x5a38be[_0x599357(0x1d5)]==_0x320b3a[_0x599357(0x1d5)]&&_0x5a38be[_0x599357(0x21a)]==_0x320b3a['expiry_date']&&_0x5a38be['batch_code']==_0x320b3a[_0x599357(0x186)]&&_0x5a38be[_0x599357(0x18d)]==_0x320b3a['invoice']&&(_0x5a38be[_0x599357(0x197)]=Math[_0x599357(0x192)](_0x5a38be[_0x599357(0x197)])-Math['abs'](_0x320b3a['quantity']));});return _0x58df75;});Promise[_0x513933(0x1ac)](_0x48edff)[_0x513933(0x1d7)](async _0x3682b8=>{var _0x652395=_0x513933;try{for(const _0x3299d7 of _0x3682b8){await _0x3299d7[_0x652395(0x21b)]();}_0x32960c[_0x652395(0x1de)]='True';const _0x5d3e09=await _0x32960c[_0x652395(0x21b)](),_0x3f0deb=await master_shop[_0x652395(0x143)](),_0x26405a=await email_settings[_0x652395(0x204)](),_0x13cc6f=await supervisor_settings[_0x652395(0x143)]();var _0x336273=_0x32960c[_0x652395(0x151)],_0x2f8603='',_0x31df72;for(_0x31df72 in _0x336273){_0x2f8603+=_0x652395(0x183)+_0x652395(0x13f)+_0x336273[_0x31df72][_0x652395(0x145)]+_0x652395(0x1ae)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x336273[_0x31df72]['product_code']+'</td>'+_0x652395(0x13f)+_0x336273[_0x31df72][_0x652395(0x225)]+_0x652395(0x1ae)+_0x652395(0x13f)+_0x336273[_0x31df72][_0x652395(0x16b)]+_0x652395(0x1ae)+_0x652395(0x13f)+_0x336273[_0x31df72][_0x652395(0x16c)]+_0x652395(0x1ae)+_0x652395(0x13f)+_0x32960c['warehouse_name']+'</td>'+_0x652395(0x13f)+_0x336273[_0x31df72][_0x652395(0x1d8)]+_0x652395(0x1ae)+_0x652395(0x13f)+_0x336273[_0x31df72][_0x652395(0x1d5)]+_0x336273[_0x31df72][_0x652395(0x12a)]+_0x336273[_0x31df72]['bay']+_0x336273[_0x31df72][_0x652395(0x1cc)]+_0x336273[_0x31df72]['type'][0x0]+_0x336273[_0x31df72][_0x652395(0x18a)]+_0x652395(0x1ae),_0x652395(0x1f1);}let _0x172765=nodemailer[_0x652395(0x11e)]({'host':_0x26405a['host'],'port':Number(_0x26405a['port']),'secure':![],'auth':{'user':_0x26405a[_0x652395(0x209)],'pass':_0x26405a[_0x652395(0x176)]}}),_0x27980f={'from':_0x26405a[_0x652395(0x209)],'to':_0x13cc6f[0x0][_0x652395(0x1c5)],'subject':_0x652395(0x1ce),'attachments':[{'filename':_0x652395(0x1a7),'path':__dirname+'/../public'+_0x652395(0x1e0)+_0x3f0deb[0x0][_0x652395(0x17a)],'cid':'logo'}],'html':_0x652395(0x1da)+'<html><head><title></title>'+'</head><body>'+_0x652395(0x178)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x652395(0x221)+_0x652395(0x153)+'<div>'+'<h2>\x20'+_0x3f0deb[0x0][_0x652395(0x191)]+_0x652395(0x14c)+_0x652395(0x153)+'</div>'+_0x652395(0x1f0)+_0x652395(0x178)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x652395(0x19e)+_0x32960c['invoice']+'\x20'+_0x652395(0x205)+_0x652395(0x1d2)+_0x32960c[_0x652395(0x12d)]+'\x20'+'</span>'+'</h5>'+_0x652395(0x153)+_0x652395(0x134)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x652395(0x183)+_0x652395(0x211)+_0x652395(0x20f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x652395(0x199)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x652395(0x13e)+_0x652395(0x14d)+'</tr>'+_0x652395(0x1ec)+_0x652395(0x228)+'\x20'+_0x2f8603+'\x20'+_0x652395(0x1d4)+'</table>'+_0x652395(0x178)+_0x652395(0x1fb)+_0x652395(0x1db)+_0x3f0deb[0x0][_0x652395(0x191)]+_0x652395(0x1b7)+_0x652395(0x153)+_0x652395(0x153)+_0x652395(0x132)};_0x172765[_0x652395(0x203)](_0x27980f,function(_0x4a1384,_0x52501b){var _0x44aca6=_0x652395;_0x4a1384?(console['log'](_0x4a1384),console[_0x44aca6(0x1b1)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x2e62af[_0x652395(0x1dc)](_0x652395(0x1f2),_0x652395(0x156)),_0xda7955['redirect']('/all_sales/preview/'+_0x23eef5);}catch(_0x5761dc){console[_0x652395(0x124)](_0x5761dc),_0xda7955[_0x652395(0x152)](0x1f4)[_0x652395(0x157)]({'error':_0x652395(0x19d)});}})[_0x513933(0x196)](_0x333784=>{var _0x166d9f=_0x513933;console[_0x166d9f(0x124)](_0x333784),_0xda7955[_0x166d9f(0x152)](0x1f4)[_0x166d9f(0x157)]({'error':'An\x20error\x20occurred.'});});}catch(_0x412ba3){console['log'](_0x412ba3);}}),router['get'](a0_0x3654d2(0x1eb),auth,async(_0x15ee2a,_0x4fcdbd)=>{var _0x4de1d3=a0_0x3654d2;try{const {username:_0x1118f4,email:_0x303b73,role:_0x517256}=_0x15ee2a[_0x4de1d3(0x17f)],_0x311336=_0x15ee2a[_0x4de1d3(0x17f)],_0x49b866=await profile[_0x4de1d3(0x204)]({'email':_0x311336[_0x4de1d3(0x209)]}),_0x3e70a6=await master_shop[_0x4de1d3(0x143)](),_0xb98ef3=_0x15ee2a['params']['id'],_0x311eae=await sales[_0x4de1d3(0x174)](_0xb98ef3);var _0x883175=[_0x4de1d3(0x1f3),_0x4de1d3(0x195)];const _0x216218=await warehouse[_0x4de1d3(0x1ed)]([{'$match':{'name':_0x311eae[_0x4de1d3(0x1f5)],'warehouse_category':_0x4de1d3(0x187)}},{'$unwind':_0x4de1d3(0x138)},{'$group':{'_id':_0x4de1d3(0x15f),'name':{'$first':_0x4de1d3(0x1bf)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4de1d3(0x15d)},'type':{'$first':_0x4de1d3(0x149)},'floorlevel':{'$first':_0x4de1d3(0x169)},'primary_code':{'$first':_0x4de1d3(0x1e3)},'secondary_code':{'$first':_0x4de1d3(0x1ea)},'product_code':{'$first':_0x4de1d3(0x194)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4de1d3(0x1e1)}}}]),_0x18bf20=await customer[_0x4de1d3(0x143)]({});let _0x37789a;if(_0x311336[_0x4de1d3(0x184)]==_0x4de1d3(0x13b)){const _0x22b762=await staff[_0x4de1d3(0x204)]({'email':_0x311336[_0x4de1d3(0x209)]});_0x37789a=await warehouse[_0x4de1d3(0x1ed)]([{'$match':{'status':_0x4de1d3(0x1fe),'name':_0x22b762['warehouse'],'warehouse_category':_0x4de1d3(0x187)}},{'$group':{'_id':_0x4de1d3(0x13a),'name':{'$first':_0x4de1d3(0x13a)}}}]);}else _0x37789a=await warehouse[_0x4de1d3(0x1ed)]([{'$match':{'status':'Enabled','warehouse_category':_0x4de1d3(0x187)}},{'$group':{'_id':'$name','name':{'$first':_0x4de1d3(0x13a)}}}]);const _0x40f2ff=await product[_0x4de1d3(0x143)]({});if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x21e)){var _0x4b62ab=users[_0x4de1d3(0x16e)];console['log'](_0x4b62ab);}else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x22a))var _0x4b62ab=users['Hindi'];else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x227))var _0x4b62ab=users['German'];else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x161))var _0x4b62ab=users[_0x4de1d3(0x161)];else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x1a4))var _0x4b62ab=users[_0x4de1d3(0x1a4)];else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x162))var _0x4b62ab=users['Portuguese'];else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x1b0))var _0x4b62ab=users['Chinese'];else{if(_0x3e70a6[0x0][_0x4de1d3(0x18e)]==_0x4de1d3(0x219))var _0x4b62ab=users[_0x4de1d3(0x179)];}}}}}}}_0x4fcdbd[_0x4de1d3(0x1c2)](_0x4de1d3(0x172),{'success':_0x15ee2a['flash'](_0x4de1d3(0x1f2)),'errors':_0x15ee2a[_0x4de1d3(0x1dc)](_0x4de1d3(0x1d3)),'role':_0x311336,'profile':_0x49b866,'customer':_0x18bf20,'warehouse':_0x37789a,'product':_0x216218,'user':_0x311eae,'master_shop':_0x3e70a6,'unit':_0x40f2ff,'language':_0x4b62ab});}catch(_0x390d3d){console[_0x4de1d3(0x1b1)](_0x390d3d);}}),router[a0_0x3654d2(0x1af)]('/view/:id',auth,async(_0x49c7be,_0x563bc9)=>{var _0x231d3d=a0_0x3654d2;try{const _0x2bd8ec=_0x49c7be[_0x231d3d(0x1c9)]['id'],_0x421aba=await sales['findOne']({'_id':_0x49c7be[_0x231d3d(0x1c9)]['id']}),_0x57604e=await warehouse['findOne']({'name':_0x421aba['warehouse_name'],'room':_0x49c7be['body'][_0x231d3d(0x166)]}),{invoice:_0x437ccf,date:_0xf15edd,warehouse_name:_0x670059,product_name:_0x39ebf5,stock:_0x268d3f,quantity:_0x40e99c,note:_0xc6ffff,room:_0x56cc1f,customer:_0xd1f1b2,SCRN:_0x915cba}=_0x49c7be[_0x231d3d(0x193)];if(typeof _0x39ebf5==_0x231d3d(0x200))var _0x5f2162=[_0x49c7be['body']['product_name']],_0x374293=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x1be)]],_0x3f62d5=[_0x49c7be[_0x231d3d(0x193)]['carton']],_0x59111f=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x1c1)]],_0x5f063d=[_0x49c7be['body'][_0x231d3d(0x128)]],_0xe89638=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x20e)]],_0x3a7b3c=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x177)]],_0x1bc652=[_0x49c7be['body'][_0x231d3d(0x20c)]],_0x108585=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x16c)]],_0x1f883a=[_0x49c7be['body'][_0x231d3d(0x186)]],_0x2b863a=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x21a)]],_0x3d0a3c=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x1f6)]],_0x2f0b09=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x12e)]],_0x4e94e6=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x160)]],_0x5369ed=[_0x49c7be['body'][_0x231d3d(0x20a)]],_0x1c4120=[_0x49c7be['body'][_0x231d3d(0x137)]],_0x2895eb=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x150)]],_0x14b1f8=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x225)]],_0x1a35bd=[_0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x130)]];else var _0x5f2162=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x145)]],_0x374293=[..._0x49c7be[_0x231d3d(0x193)]['stock']],_0x3f62d5=[..._0x49c7be[_0x231d3d(0x193)]['carton']],_0x59111f=[..._0x49c7be['body'][_0x231d3d(0x1c1)]],_0x5f063d=[..._0x49c7be[_0x231d3d(0x193)]['secondary_code']],_0xe89638=[..._0x49c7be['body'][_0x231d3d(0x20e)]],_0x3a7b3c=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x177)]],_0x1bc652=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x20c)]],_0x108585=[..._0x49c7be['body']['secondary_unit']],_0x1f883a=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x186)]],_0x2b863a=[..._0x49c7be[_0x231d3d(0x193)]['expiry_date']],_0x3d0a3c=[..._0x49c7be[_0x231d3d(0x193)]['max_per_unit']],_0x2f0b09=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x12e)]],_0x4e94e6=[..._0x49c7be[_0x231d3d(0x193)]['requested_qty']],_0x5369ed=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x20a)]],_0x1c4120=[..._0x49c7be[_0x231d3d(0x193)][_0x231d3d(0x137)]],_0x2895eb=[..._0x49c7be[_0x231d3d(0x193)]['prod_cat']],_0x14b1f8=[..._0x49c7be['body'][_0x231d3d(0x225)]],_0x1a35bd=[..._0x49c7be['body'][_0x231d3d(0x130)]];const _0x4e7b4c=_0x5f2162[_0x231d3d(0x1e9)](_0xcff1c6=>{return _0xcff1c6={'product_name':_0xcff1c6};});_0x374293[_0x231d3d(0x131)]((_0x1879cd,_0x36077f)=>{var _0x40430c=_0x231d3d;_0x4e7b4c[_0x36077f][_0x40430c(0x1be)]=Math[_0x40430c(0x192)](_0x1879cd);}),_0x3f62d5[_0x231d3d(0x131)]((_0x48da2c,_0x25c754)=>{var _0x4fa9b1=_0x231d3d;_0x4e7b4c[_0x25c754][_0x4fa9b1(0x225)]=_0x48da2c;}),_0x59111f[_0x231d3d(0x131)]((_0x459905,_0x438274)=>{var _0x3b6726=_0x231d3d;_0x4e7b4c[_0x438274][_0x3b6726(0x1c1)]=_0x459905;}),_0x5f063d[_0x231d3d(0x131)]((_0x4178b2,_0x36defc)=>{var _0x151367=_0x231d3d;_0x4e7b4c[_0x36defc][_0x151367(0x128)]=_0x4178b2;}),_0xe89638[_0x231d3d(0x131)]((_0x305a50,_0x5a538b)=>{var _0x58d732=_0x231d3d;_0x4e7b4c[_0x5a538b][_0x58d732(0x147)]=_0x305a50;}),_0x3a7b3c[_0x231d3d(0x131)]((_0x139026,_0x3bb0bb)=>{var _0x246b8f=_0x231d3d;_0x1a35bd[_0x246b8f(0x131)]((_0x368837,_0x2af646)=>{var _0x1a6dc3=_0x246b8f;if(_0x368837==_0x1a6dc3(0x121)&&_0x3bb0bb==_0x2af646){var _0xc958fc=_0x139026[_0x1a6dc3(0x1a1)](0x3);_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1d5)]=_0x139026[0x0],_0x4e7b4c[_0x3bb0bb]['rack']=_0x139026[0x1],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1c8)]=0x0,_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1cc)]=0x0,_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1a9)]=_0x1a6dc3(0x1d9),_0x4e7b4c[_0x3bb0bb]['floorlevel']=_0xc958fc;}else{if(_0x368837==_0x1a6dc3(0x16d)&&_0x3bb0bb==_0x2af646){var _0xc958fc=_0x139026[_0x1a6dc3(0x1a1)](0x3);_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1d5)]=_0x139026[0x0],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x12a)]=_0x139026[0x1],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1c8)]=0x0,_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1cc)]=0x0,_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1a9)]='Floor',_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x18a)]=_0x139026[0x5];}else{if(_0x3bb0bb==_0x2af646){var _0x2e8f57;if(_0x139026[0x4]=='L')_0x2e8f57=_0x1a6dc3(0x122);else _0x139026[0x4]=='F'&&(_0x2e8f57='Floor');_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1d5)]=_0x139026[0x0],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x12a)]=_0x139026[0x1],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1c8)]=_0x139026[0x2],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1cc)]=_0x139026[0x3],_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x1a9)]=_0x2e8f57,_0x4e7b4c[_0x3bb0bb][_0x1a6dc3(0x18a)]=_0x139026[0x5];}}}});}),_0x1bc652[_0x231d3d(0x131)]((_0xaf2b28,_0x551e49)=>{_0x4e7b4c[_0x551e49]['unit']=_0xaf2b28;}),_0x108585[_0x231d3d(0x131)]((_0x153f7a,_0x23dc7f)=>{var _0x5182be=_0x231d3d;_0x4e7b4c[_0x23dc7f][_0x5182be(0x16c)]=_0x153f7a;}),_0x1f883a[_0x231d3d(0x131)]((_0x8398ee,_0x828ff9)=>{var _0x4b6937=_0x231d3d;_0x4e7b4c[_0x828ff9][_0x4b6937(0x186)]=_0x8398ee;}),_0x2b863a[_0x231d3d(0x131)]((_0x58374d,_0x6a867d)=>{var _0x14aa7a=_0x231d3d;_0x4e7b4c[_0x6a867d][_0x14aa7a(0x21a)]=_0x58374d;}),_0x3d0a3c[_0x231d3d(0x131)]((_0x1c12e6,_0x3edb23)=>{var _0x4c5798=_0x231d3d;_0x4e7b4c[_0x3edb23][_0x4c5798(0x15a)]=_0x1c12e6;}),_0x2f0b09[_0x231d3d(0x131)]((_0x4118d2,_0x40b147)=>{var _0x126102=_0x231d3d;_0x4e7b4c[_0x40b147][_0x126102(0x12e)]=_0x4118d2;}),_0x4e94e6[_0x231d3d(0x131)]((_0x1e5d81,_0xa23c36)=>{var _0x4dfead=_0x231d3d;_0x4e7b4c[_0xa23c36][_0x4dfead(0x160)]=Math[_0x4dfead(0x192)](_0x1e5d81);}),_0x5369ed[_0x231d3d(0x131)]((_0x4df8ce,_0x4a59a0)=>{_0x4e7b4c[_0x4a59a0]['delivery_date']=_0x4df8ce;}),_0x1c4120['forEach']((_0x51fc6d,_0xbffe11)=>{_0x4e7b4c[_0xbffe11]['delivery_code']=_0x51fc6d;}),_0x2895eb[_0x231d3d(0x131)]((_0x3973b3,_0x427834)=>{var _0x56eb74=_0x231d3d;_0x4e7b4c[_0x427834][_0x56eb74(0x150)]=_0x3973b3;}),_0x14b1f8['forEach']((_0x315ec8,_0x1d6003)=>{var _0x459428=_0x231d3d;_0x4e7b4c[_0x1d6003][_0x459428(0x15c)]=_0x315ec8;}),_0x1a35bd[_0x231d3d(0x131)]((_0xbffa8e,_0x4701e0)=>{_0x4e7b4c[_0x4701e0]['room_name']=_0xbffa8e;});var _0x31bfca=0x0;_0x4e7b4c['forEach'](_0x19e4ff=>{var _0x5fec9b=_0x231d3d;console[_0x5fec9b(0x1b1)](_0x5fec9b(0x181),_0x19e4ff),(parseInt(_0x19e4ff[_0x5fec9b(0x1be)])<parseInt(_0x19e4ff[_0x5fec9b(0x225)])||parseInt(_0x19e4ff[_0x5fec9b(0x225)])==0x0)&&_0x31bfca++;});if(_0x31bfca!=0x0)return _0x49c7be['flash'](_0x231d3d(0x1d3),_0x231d3d(0x1ba)),_0x563bc9[_0x231d3d(0x1a0)](_0x231d3d(0x17e));const _0x27b3d5=_0x4e7b4c['filter'](_0x406bc5=>_0x406bc5[_0x231d3d(0x225)]!=='0'&&_0x406bc5[_0x231d3d(0x225)]!=='');_0x421aba[_0x231d3d(0x18d)]=_0x437ccf,_0x421aba['customer']=_0xd1f1b2,_0x421aba[_0x231d3d(0x12d)]=_0xf15edd,_0x421aba['warehouse_name']=_0x670059,_0x421aba[_0x231d3d(0x151)]=_0x27b3d5,_0x421aba[_0x231d3d(0x140)]=_0xc6ffff,_0x421aba[_0x231d3d(0x216)]=_0x915cba,_0x421aba[_0x231d3d(0x1de)]=_0x231d3d(0x155),_0x421aba['isAllowEdit']=_0x231d3d(0x155);const _0x39c015=await _0x421aba[_0x231d3d(0x21b)]();_0x49c7be[_0x231d3d(0x1dc)]('success','Sales\x20Update\x20successfully'),_0x563bc9['redirect']('/all_sales/view');}catch(_0x479538){console[_0x231d3d(0x1b1)](_0x479538);}}),router[a0_0x3654d2(0x1af)]('/give_payment/:id',auth,async(_0x1f5564,_0x10ea9a)=>{var _0x5303e9=a0_0x3654d2;try{const _0x313823=_0x1f5564[_0x5303e9(0x1c9)]['id'],{invoice:_0x2029b2,customer:_0xb51603,receivable_amount:_0x2ca807,received_amount:_0x5113f4}=_0x1f5564['body'],_0x29adc2=await sales[_0x5303e9(0x174)](_0x313823);console['log'](_0x29adc2);var _0x527c47=_0x2ca807-_0x5113f4;console[_0x5303e9(0x1b1)](_0x5113f4),_0x29adc2[_0x5303e9(0x1b9)]=parseFloat(_0x5113f4)+parseFloat(_0x29adc2[_0x5303e9(0x1b9)]),_0x29adc2[_0x5303e9(0x210)]=_0x527c47,console[_0x5303e9(0x1b1)](_0x29adc2);const _0x3e4bf2=await _0x29adc2[_0x5303e9(0x21b)](),_0x316e64=await c_payment_data['findOne']({'invoice':_0x2029b2});_0x316e64[_0x5303e9(0x14e)]=_0x527c47,await _0x316e64[_0x5303e9(0x21b)]();let _0x202b46=new Date(),_0x4ea7eb=('0'+_0x202b46[_0x5303e9(0x165)]())['slice'](-0x2),_0x23592a=('0'+(_0x202b46[_0x5303e9(0x1a3)]()+0x1))[_0x5303e9(0x1a1)](-0x2),_0x47fed6=_0x202b46[_0x5303e9(0x159)](),_0x5d8f3b=_0x47fed6+'-'+_0x23592a+'-'+_0x4ea7eb;const _0x44a7ba=new customer_payment({'invoice':_0x2029b2,'date':_0x47fed6+'-'+_0x23592a+'-'+_0x4ea7eb,'customer':_0xb51603,'reason':_0x5303e9(0x1e7),'amount':_0x5113f4}),_0x40bda7=await _0x44a7ba['save']();_0x1f5564[_0x5303e9(0x1dc)](_0x5303e9(0x1f2),_0x5303e9(0x190)),_0x10ea9a[_0x5303e9(0x1a0)](_0x5303e9(0x158));}catch(_0x70e2b8){console['log'](_0x70e2b8);}}),router[a0_0x3654d2(0x133)](a0_0x3654d2(0x126),auth,async(_0x1ad533,_0x500163)=>{var _0x22d4f9=a0_0x3654d2;try{const {username:_0x156a65,email:_0x400db4,role:_0x1f2df6}=_0x1ad533[_0x22d4f9(0x17f)],_0x25e1ce=_0x1ad533[_0x22d4f9(0x17f)],_0x46d5bf=await profile[_0x22d4f9(0x204)]({'email':_0x25e1ce[_0x22d4f9(0x209)]}),_0x274bbe=await master_shop['find']();console['log'](_0x22d4f9(0x171),_0x274bbe);const _0x1ebafa=_0x1ad533[_0x22d4f9(0x1c9)]['id'],_0x57e324=await sales[_0x22d4f9(0x174)](_0x1ebafa);console['log'](_0x57e324);const _0x402ac2=await customer[_0x22d4f9(0x204)]({'name':_0x57e324[_0x22d4f9(0x125)]});console[_0x22d4f9(0x1b1)](_0x402ac2);if(_0x274bbe[0x0][_0x22d4f9(0x18e)]==_0x22d4f9(0x21e)){var _0x183568=users['English'];console['log'](_0x183568);}else{if(_0x274bbe[0x0]['language']==_0x22d4f9(0x22a))var _0x183568=users[_0x22d4f9(0x22a)];else{if(_0x274bbe[0x0][_0x22d4f9(0x18e)]=='German')var _0x183568=users[_0x22d4f9(0x227)];else{if(_0x274bbe[0x0]['language']==_0x22d4f9(0x161))var _0x183568=users['Spanish'];else{if(_0x274bbe[0x0][_0x22d4f9(0x18e)]==_0x22d4f9(0x1a4))var _0x183568=users[_0x22d4f9(0x1a4)];else{if(_0x274bbe[0x0][_0x22d4f9(0x18e)]=='Portuguese\x20(BR)')var _0x183568=users[_0x22d4f9(0x1dd)];else{if(_0x274bbe[0x0][_0x22d4f9(0x18e)]==_0x22d4f9(0x1b0))var _0x183568=users['Chinese'];else{if(_0x274bbe[0x0][_0x22d4f9(0x18e)]==_0x22d4f9(0x219))var _0x183568=users['Arabic'];}}}}}}}_0x500163['render'](_0x22d4f9(0x212),{'success':_0x1ad533[_0x22d4f9(0x1dc)](_0x22d4f9(0x1f2)),'errors':_0x1ad533[_0x22d4f9(0x1dc)](_0x22d4f9(0x1d3)),'role':_0x25e1ce,'profile':_0x46d5bf,'master_shop':_0x274bbe,'customers':_0x402ac2,'sales':_0x57e324,'language':_0x183568});}catch(_0x194605){console[_0x22d4f9(0x1b1)](_0x194605);}}),router['get'](a0_0x3654d2(0x20d),auth,async(_0xcec163,_0x1a3775)=>{var _0x2b5f61=a0_0x3654d2;try{const {username:_0x19e704,email:_0x20d4ba,role:_0xe10680}=_0xcec163[_0x2b5f61(0x17f)],_0x29fb53=_0xcec163[_0x2b5f61(0x17f)],_0x393435=await profile[_0x2b5f61(0x204)]({'email':_0x29fb53[_0x2b5f61(0x209)]}),_0x39ef02=await master_shop[_0x2b5f61(0x143)]();console[_0x2b5f61(0x1b1)](_0x2b5f61(0x171),_0x39ef02);const _0x1a4989=_0xcec163[_0x2b5f61(0x1c9)]['id'];console[_0x2b5f61(0x1b1)](_0x1a4989);const _0xc3442e=await sales[_0x2b5f61(0x174)](_0x1a4989);console[_0x2b5f61(0x1b1)](_0x2b5f61(0x20b),_0xc3442e);const _0x43857f=await warehouse[_0x2b5f61(0x1ed)]([{'$match':{'name':_0x2b5f61(0x142),'room':'Return\x20Rooms'}},{'$unwind':_0x2b5f61(0x138)},{'$group':{'_id':_0x2b5f61(0x15f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2b5f61(0x13c)},'level':{'$first':_0x2b5f61(0x185)},'isle':{'$first':_0x2b5f61(0x1d1)},'pallet':{'$first':_0x2b5f61(0x1e8)},'primary_code':{'$first':_0x2b5f61(0x1e3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2b5f61(0x194)}}}]);console[_0x2b5f61(0x1b1)]('stock_data',_0x43857f);const _0x501cd7=await product[_0x2b5f61(0x143)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2b5f61(0x142),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2b5f61(0x13a),'name':{'$first':_0x2b5f61(0x13a)}}},{'$sort':{'name':0x1}}]);var _0x550922=['Return\x20Rooms'];if(_0x39ef02[0x0][_0x2b5f61(0x18e)]==_0x2b5f61(0x21e)){var _0x4c10b3=users[_0x2b5f61(0x16e)];console[_0x2b5f61(0x1b1)](_0x4c10b3);}else{if(_0x39ef02[0x0][_0x2b5f61(0x18e)]==_0x2b5f61(0x22a))var _0x4c10b3=users[_0x2b5f61(0x22a)];else{if(_0x39ef02[0x0]['language']=='German')var _0x4c10b3=users['German'];else{if(_0x39ef02[0x0]['language']=='Spanish')var _0x4c10b3=users[_0x2b5f61(0x161)];else{if(_0x39ef02[0x0][_0x2b5f61(0x18e)]=='French')var _0x4c10b3=users[_0x2b5f61(0x1a4)];else{if(_0x39ef02[0x0][_0x2b5f61(0x18e)]==_0x2b5f61(0x162))var _0x4c10b3=users[_0x2b5f61(0x1dd)];else{if(_0x39ef02[0x0][_0x2b5f61(0x18e)]==_0x2b5f61(0x1b0))var _0x4c10b3=users[_0x2b5f61(0x1b0)];else{if(_0x39ef02[0x0][_0x2b5f61(0x18e)]==_0x2b5f61(0x219))var _0x4c10b3=users[_0x2b5f61(0x179)];}}}}}}}_0x1a3775[_0x2b5f61(0x1c2)]('return_sale',{'success':_0xcec163['flash']('success'),'errors':_0xcec163['flash'](_0x2b5f61(0x1d3)),'role':_0x29fb53,'profile':_0x393435,'user':_0xc3442e,'stock':_0x43857f,'master_shop':_0x39ef02,'unit':_0x501cd7,'language':_0x4c10b3,'warehouses':warehouse_data,'rooms':_0x550922});}catch(_0x4d4fb0){console[_0x2b5f61(0x1b1)](_0x4d4fb0),_0x1a3775[_0x2b5f61(0x152)](0xc8)[_0x2b5f61(0x157)]({'message':_0x4d4fb0[_0x2b5f61(0x18b)]});}}),router[a0_0x3654d2(0x1af)](a0_0x3654d2(0x20d),auth,async(_0x2932c3,_0x37c2a5)=>{var _0x19e84f=a0_0x3654d2;try{const {invoice:_0x23359d,date:_0x1a361f,warehouse_name:_0x16e309,product_name:_0x58056a,primary_code:_0x3cd7c7,secondary_code:_0x1696ce,product_code:_0xe69e6d,sales_quantity:_0x5f40d6,stocks:_0x556cad,return_qty:_0x13f164,Room_name:_0x140a2f,to_warehouse_name:_0x4b7d52,to_Roomname:_0x5c4d07,to_Room_name:_0x37f6de,note:_0x56df2e,level:_0x46a335,isle:_0x40a917,pallet:_0x4e8c99}=_0x2932c3['body'];if(typeof _0x58056a==_0x19e84f(0x200))var _0x59e418=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x145)]],_0x553b48=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x1c1)]],_0x5815aa=[_0x2932c3['body']['secondary_code']],_0x326597=[_0x2932c3[_0x19e84f(0x193)]['product_code']],_0x3065fb=[_0x2932c3['body'][_0x19e84f(0x16a)]],_0x46b1e6=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x217)]],_0x235aff=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x12f)]],_0x37725b=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x1c8)]],_0x21c60b=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x1cc)]],_0x292890=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x13d)]],_0xd0492d=[_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x18a)]];else var _0x59e418=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x145)]],_0x553b48=[..._0x2932c3['body'][_0x19e84f(0x1c1)]],_0x5815aa=[..._0x2932c3[_0x19e84f(0x193)]['secondary_code']],_0x326597=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x147)]],_0x3065fb=[..._0x2932c3[_0x19e84f(0x193)]['sales_quantity']],_0x46b1e6=[..._0x2932c3['body'][_0x19e84f(0x217)]],_0x235aff=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x12f)]],_0x37725b=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x1c8)]],_0x21c60b=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x1cc)]],_0x292890=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x13d)]],_0xd0492d=[..._0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x18a)]];const _0x1bb5f6=_0x59e418[_0x19e84f(0x1e9)](_0x2bae91=>{return _0x2bae91={'product_name':_0x2bae91};});_0x553b48[_0x19e84f(0x131)]((_0x34881b,_0x30424e)=>{var _0x2b1b94=_0x19e84f;_0x1bb5f6[_0x30424e][_0x2b1b94(0x1c1)]=_0x34881b;}),_0x5815aa[_0x19e84f(0x131)]((_0x7ab43c,_0x260fc0)=>{_0x1bb5f6[_0x260fc0]['secondary_code']=_0x7ab43c;}),_0x326597['forEach']((_0xabd89e,_0x221bd3)=>{var _0xc96301=_0x19e84f;_0x1bb5f6[_0x221bd3][_0xc96301(0x147)]=_0xabd89e;}),_0x3065fb['forEach']((_0x424157,_0x30af60)=>{var _0x1446bf=_0x19e84f;_0x1bb5f6[_0x30af60][_0x1446bf(0x12b)]=_0x424157;}),_0x46b1e6[_0x19e84f(0x131)]((_0x22a031,_0x625fb2)=>{var _0x10027e=_0x19e84f;_0x1bb5f6[_0x625fb2][_0x10027e(0x1be)]=_0x22a031;}),_0x235aff[_0x19e84f(0x131)]((_0x537b64,_0x4667fc)=>{var _0x7b4f19=_0x19e84f;_0x1bb5f6[_0x4667fc][_0x7b4f19(0x12f)]=_0x537b64;}),_0x37725b[_0x19e84f(0x131)]((_0x5215a9,_0x1ffe52)=>{var _0x177b33=_0x19e84f;_0x1bb5f6[_0x1ffe52][_0x177b33(0x1c8)]=_0x5215a9;}),_0x21c60b['forEach']((_0x1ab97b,_0x55a849)=>{var _0x3d0a54=_0x19e84f;_0x1bb5f6[_0x55a849][_0x3d0a54(0x1cc)]=_0x1ab97b;}),_0x292890[_0x19e84f(0x131)]((_0x5846c7,_0x59d4ce)=>{var _0x4cb860=_0x19e84f;_0x1bb5f6[_0x59d4ce][_0x4cb860(0x1a9)]=_0x5846c7;}),_0xd0492d[_0x19e84f(0x131)]((_0x2b1079,_0x518f8c)=>{var _0x20de3a=_0x19e84f;_0x1bb5f6[_0x518f8c][_0x20de3a(0x18a)]=_0x2b1079;});var _0x16ad9f=0x0;_0x1bb5f6[_0x19e84f(0x131)](_0x53069b=>{var _0xcad33a=_0x19e84f;console[_0xcad33a(0x1b1)](_0xcad33a(0x181),_0x53069b),(parseInt(_0x53069b[_0xcad33a(0x12b)])<parseInt(_0x53069b['return_qty'])||parseInt(_0x53069b[_0xcad33a(0x1be)])<parseInt(_0x53069b[_0xcad33a(0x12f)])&&parseInt(_0x53069b[_0xcad33a(0x12b)])>parseInt(_0x53069b['return_qty'])||parseInt(_0x53069b['return_qty'])==0x0)&&_0x16ad9f++;});if(_0x16ad9f!=0x0)return _0x2932c3[_0x19e84f(0x1dc)](_0x19e84f(0x1d3),_0x19e84f(0x136)),_0x37c2a5[_0x19e84f(0x1a0)](_0x19e84f(0x17e));const _0x470152=await sales[_0x19e84f(0x204)]({'invoice':_0x23359d});console[_0x19e84f(0x1b1)](_0x470152),_0x470152[_0x19e84f(0x222)]=_0x19e84f(0x198);const _0x108bce=await _0x470152[_0x19e84f(0x21b)](),_0x1d1567=new sales_return({'invoice':_0x23359d,'customer':_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x125)],'date':_0x1a361f,'warehouse_name':_0x16e309,'room':_0x140a2f,'ToWarehouse':_0x4b7d52,'ToRoom':_0x37f6de,'return_sale':_0x1bb5f6,'note':_0x56df2e}),_0x363e5f=await _0x1d1567[_0x19e84f(0x21b)]();console[_0x19e84f(0x1b1)](_0x1d1567);const _0x47b17a=await sales_return[_0x19e84f(0x204)]({'invoice':_0x23359d}),_0x10a07a=await warehouse['findOne']({'name':_0x4b7d52,'room':_0x37f6de});_0x47b17a[_0x19e84f(0x19c)]['forEach'](_0x5e7711=>{var _0x563978=_0x19e84f,_0x495cf4=0x0;const _0x86b207=_0x10a07a['product_details'][_0x563978(0x1e9)](_0x54247f=>{var _0x4d85e4=_0x563978;_0x54247f[_0x4d85e4(0x145)]==_0x5e7711['product_name']&&_0x54247f[_0x4d85e4(0x18a)]==_0x5e7711[_0x4d85e4(0x18a)]&&_0x54247f[_0x4d85e4(0x1a9)]==_0x5e7711['type']&&_0x54247f[_0x4d85e4(0x1cc)]==_0x5e7711[_0x4d85e4(0x1cc)]&&_0x54247f[_0x4d85e4(0x1c8)]==_0x5e7711[_0x4d85e4(0x1c8)]&&(_0x54247f['product_stock']=parseInt(_0x54247f['product_stock'])+parseInt(_0x5e7711[_0x4d85e4(0x12f)]),_0x495cf4++);});_0x495cf4=='0'&&(_0x10a07a[_0x563978(0x1c0)]=_0x10a07a['product_details'][_0x563978(0x1f9)]({'product_name':_0x5e7711[_0x563978(0x145)],'product_stock':_0x5e7711[_0x563978(0x12f)],'primary_code':_0x5e7711['primary_code'],'secondary_code':_0x5e7711[_0x563978(0x128)],'product_code':_0x5e7711[_0x563978(0x147)],'bay':_0x5e7711[_0x563978(0x1c8)],'bin':_0x5e7711[_0x563978(0x1cc)],'type':_0x5e7711[_0x563978(0x1a9)],'floorlevel':_0x5e7711[_0x563978(0x18a)]})),console[_0x563978(0x1b1)](_0x563978(0x11f),_0x10a07a);}),await _0x10a07a[_0x19e84f(0x21b)](),console[_0x19e84f(0x1b1)](_0x2932c3[_0x19e84f(0x193)]);const _0x17c144=new c_payment_data({'invoice':_0x23359d,'customer':_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x125)],'reason':_0x19e84f(0x18f)});await _0x17c144[_0x19e84f(0x21b)]();const _0x14cbbd=await master_shop[_0x19e84f(0x143)]();console['log'](_0x19e84f(0x164),_0x14cbbd[0x0][_0x19e84f(0x17a)]);const _0x41226c=await email_settings[_0x19e84f(0x204)](),_0x1d2082=await customer['findOne']({'name':_0x2932c3[_0x19e84f(0x193)][_0x19e84f(0x125)]});console[_0x19e84f(0x1b1)](_0x19e84f(0x189),_0x1d2082);_0x14cbbd[0x0][_0x19e84f(0x15e)]==0x1?(right_currency=_0x14cbbd[0x0][_0x19e84f(0x1f4)],left_currency=''):(right_currency='',left_currency=_0x14cbbd[0x0]['currency']);var _0x5740aa=_0x59e418,_0x3b444d=_0x235aff,_0x2a151a='',_0x2be824;for(_0x2be824 in _0x5740aa){_0x2a151a+=_0x19e84f(0x183)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5740aa[_0x2be824]+_0x19e84f(0x1ae)+_0x19e84f(0x13f)+_0x3b444d[_0x2be824]+_0x19e84f(0x1ae)+'</tr>';}console[_0x19e84f(0x1b1)](_0x19e84f(0x1e5),_0x2a151a);let _0x485f08=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x41226c[_0x19e84f(0x209)],'pass':_0x41226c['password']}}),_0x193b02={'from':_0x41226c[_0x19e84f(0x209)],'to':_0x1d2082[_0x19e84f(0x209)],'subject':_0x19e84f(0x14f),'attachments':[{'filename':'Logo.png','path':__dirname+_0x19e84f(0x1bd)+'/upload/'+_0x14cbbd[0x0]['image'],'cid':_0x19e84f(0x201)}],'html':_0x19e84f(0x1da)+_0x19e84f(0x168)+_0x19e84f(0x213)+_0x19e84f(0x178)+_0x19e84f(0x144)+_0x19e84f(0x178)+_0x19e84f(0x221)+_0x19e84f(0x153)+_0x19e84f(0x178)+_0x19e84f(0x14a)+_0x14cbbd[0x0][_0x19e84f(0x191)]+_0x19e84f(0x14c)+_0x19e84f(0x153)+_0x19e84f(0x153)+_0x19e84f(0x1f0)+_0x19e84f(0x178)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x23359d+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x19e84f(0x1d2)+_0x1a361f+'\x20'+_0x19e84f(0x19b)+_0x19e84f(0x1b7)+_0x19e84f(0x153)+_0x19e84f(0x134)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x19e84f(0x211)+_0x19e84f(0x202)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x19e84f(0x1f1)+_0x19e84f(0x1ec)+_0x19e84f(0x228)+'\x20'+_0x2a151a+'\x20'+_0x19e84f(0x1d4)+_0x19e84f(0x21c)+_0x19e84f(0x178)+_0x19e84f(0x1fb)+_0x19e84f(0x1db)+_0x14cbbd[0x0][_0x19e84f(0x191)]+_0x19e84f(0x1b7)+_0x19e84f(0x153)+'</div>'+_0x19e84f(0x132)};_0x485f08[_0x19e84f(0x203)](_0x193b02,function(_0x178cdf,_0x24f577){var _0xaa4eeb=_0x19e84f;_0x178cdf?(console[_0xaa4eeb(0x1b1)](_0x178cdf),console[_0xaa4eeb(0x1b1)](_0xaa4eeb(0x1a5))):console[_0xaa4eeb(0x1b1)](_0xaa4eeb(0x170));}),_0x2932c3[_0x19e84f(0x1dc)](_0x19e84f(0x1f2),_0x19e84f(0x135)),_0x37c2a5['redirect'](_0x19e84f(0x158));}catch(_0x5aa81a){console['log'](_0x5aa81a),_0x37c2a5[_0x19e84f(0x152)](0xc8)[_0x19e84f(0x157)]({'message1':_0x5aa81a[_0x19e84f(0x18b)]});}}),router['get'](a0_0x3654d2(0x141),auth,async(_0x38ef05,_0x500d59)=>{var _0x18afb4=a0_0x3654d2;try{const {username:_0x22207f,email:_0x503136,role:_0x1b6661}=_0x38ef05[_0x18afb4(0x17f)],_0x38e623=_0x38ef05[_0x18afb4(0x17f)],_0x386fb7=await profile[_0x18afb4(0x204)]({'email':_0x38e623[_0x18afb4(0x209)]}),_0x162088=await master_shop[_0x18afb4(0x143)]();console['log'](_0x18afb4(0x188),_0x162088);const _0x2b1552=_0x38ef05[_0x18afb4(0x1c9)]['id'],_0x2bbb08=await sales['findById'](_0x2b1552);console['log']('barcode\x20user_id',_0x2bbb08);if(_0x162088[0x0][_0x18afb4(0x18e)]==_0x18afb4(0x21e))var _0x48adfd=users['English'];else{if(_0x162088[0x0][_0x18afb4(0x18e)]=='Hindi')var _0x48adfd=users[_0x18afb4(0x22a)];else{if(_0x162088[0x0][_0x18afb4(0x18e)]==_0x18afb4(0x227))var _0x48adfd=users[_0x18afb4(0x227)];else{if(_0x162088[0x0][_0x18afb4(0x18e)]=='Spanish')var _0x48adfd=users[_0x18afb4(0x161)];else{if(_0x162088[0x0]['language']==_0x18afb4(0x1a4))var _0x48adfd=users['French'];else{if(_0x162088[0x0][_0x18afb4(0x18e)]==_0x18afb4(0x162))var _0x48adfd=users[_0x18afb4(0x1dd)];else{if(_0x162088[0x0][_0x18afb4(0x18e)]==_0x18afb4(0x1b0))var _0x48adfd=users[_0x18afb4(0x1b0)];else{if(_0x162088[0x0]['language']==_0x18afb4(0x219))var _0x48adfd=users[_0x18afb4(0x179)];}}}}}}}_0x500d59[_0x18afb4(0x1c2)]('all_sales_barcode',{'success':_0x38ef05['flash'](_0x18afb4(0x1f2)),'errors':_0x38ef05[_0x18afb4(0x1dc)](_0x18afb4(0x1d3)),'role':_0x38e623,'profile':_0x386fb7,'alldata':_0x2bbb08,'master_shop':_0x162088,'language':_0x48adfd});}catch(_0x179307){console[_0x18afb4(0x1b1)](_0x179307);}}),router[a0_0x3654d2(0x1af)](a0_0x3654d2(0x19a),async(_0x4aa5a6,_0x538a07)=>{var _0xaeba5f=a0_0x3654d2;const {product_code:_0x148c76,warehouse_name:_0x2fe3c4,rooms_data:_0x4f4d5f,Roomslist:_0x3a0b58}=_0x4aa5a6[_0xaeba5f(0x193)],_0x3b430a=_0x3a0b58[_0xaeba5f(0x17d)](','),_0x940715=[];async function _0x3d7c68(_0x280312){var _0x46ba69=_0xaeba5f;const _0x35e41b=await warehouse[_0x46ba69(0x1ed)]([{'$match':{'name':_0x2fe3c4,'room':_0x280312}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x148c76}},{'$group':{'_id':_0x46ba69(0x15f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x46ba69(0x13c)},'primary_code':{'$first':_0x46ba69(0x1e3)},'secondary_code':{'$first':_0x46ba69(0x1ea)},'product_code':{'$first':_0x46ba69(0x194)},'level':{'$first':_0x46ba69(0x220)},'isle':{'$first':_0x46ba69(0x15d)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x46ba69(0x169)},'unit':{'$first':_0x46ba69(0x1fc)},'secondary_unit':{'$first':_0x46ba69(0x1b4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x46ba69(0x1e1)},'expiry_date':{'$first':_0x46ba69(0x1b5)},'production_date':{'$first':_0x46ba69(0x1b8)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x46ba69(0x215)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x46ba69(0x139)},'invoice':{'$first':_0x46ba69(0x1cf)},'actual_qty':{'$first':_0x46ba69(0x1ca)},'actual_uom':{'$first':_0x46ba69(0x1aa)}}}]),_0x4f8de8=await warehouse[_0x46ba69(0x1ed)]([{'$match':{'name':_0x2fe3c4,'room':_0x280312}},{'$unwind':_0x46ba69(0x138)},{'$match':{'product_details.secondary_code':_0x148c76}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x46ba69(0x1bf)},'product_stock':{'$first':_0x46ba69(0x13c)},'primary_code':{'$first':_0x46ba69(0x1e3)},'secondary_code':{'$first':_0x46ba69(0x1ea)},'product_code':{'$first':_0x46ba69(0x194)},'level':{'$first':_0x46ba69(0x220)},'isle':{'$first':_0x46ba69(0x15d)},'type':{'$first':_0x46ba69(0x149)},'pallet':{'$first':_0x46ba69(0x169)},'unit':{'$first':_0x46ba69(0x1fc)},'secondary_unit':{'$first':_0x46ba69(0x1b4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x46ba69(0x1b5)},'production_date':{'$first':_0x46ba69(0x1b8)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x46ba69(0x215)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x35e41b[_0x46ba69(0x180)]>0x0)_0x940715['push'](_0x35e41b);else _0x4f8de8[_0x46ba69(0x180)]>0x0&&_0x940715[_0x46ba69(0x167)](_0x4f8de8);}const _0x2f6e85=_0x3b430a[_0xaeba5f(0x1e9)](_0x2f9ce4=>_0x3d7c68(_0x2f9ce4));await Promise[_0xaeba5f(0x1ac)](_0x2f6e85),_0x538a07[_0xaeba5f(0x157)](_0x940715);}),module[a0_0x3654d2(0x1b6)]=router;