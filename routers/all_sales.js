var a0_0x5b7236=a0_0x2212;(function(_0x3a0f23,_0x57959d){var _0x461e49=a0_0x2212,_0x2ecea9=_0x3a0f23();while(!![]){try{var _0x32db75=parseInt(_0x461e49(0x225))/0x1+-parseInt(_0x461e49(0x1e5))/0x2+-parseInt(_0x461e49(0x18b))/0x3*(-parseInt(_0x461e49(0x18f))/0x4)+-parseInt(_0x461e49(0x15e))/0x5*(parseInt(_0x461e49(0x1f2))/0x6)+-parseInt(_0x461e49(0x15a))/0x7+parseInt(_0x461e49(0x139))/0x8+-parseInt(_0x461e49(0x201))/0x9;if(_0x32db75===_0x57959d)break;else _0x2ecea9['push'](_0x2ecea9['shift']());}catch(_0x240108){_0x2ecea9['push'](_0x2ecea9['shift']());}}}(a0_0xa048,0x91904));const express=require(a0_0x5b7236(0x166)),app=express(),router=express[a0_0x5b7236(0x1dc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x5b7236(0x16a)),auth=require(a0_0x5b7236(0x165)),nodemailer=require(a0_0x5b7236(0x1bd)),users=require(a0_0x5b7236(0x14f));function a0_0x2212(_0x109c35,_0x2b2b14){var _0xa04896=a0_0xa048();return a0_0x2212=function(_0x221235,_0x165e39){_0x221235=_0x221235-0x11a;var _0xfc00c9=_0xa04896[_0x221235];return _0xfc00c9;},a0_0x2212(_0x109c35,_0x2b2b14);}router['get'](a0_0x5b7236(0x13a),auth,async(_0x540f6b,_0x440068)=>{var _0x5051c8=a0_0x5b7236;try{const {username:_0x3efdbb,email:_0x1319ce,role:_0x26a1f9}=_0x540f6b[_0x5051c8(0x12d)],_0xc828b4=_0x540f6b['user'],_0x122fc8=await profile['findOne']({'email':_0xc828b4['email']}),_0x56fbab=await master_shop[_0x5051c8(0x1a7)]();let _0x411cb2;if(_0xc828b4[_0x5051c8(0x14e)]==_0x5051c8(0x13e)){const _0x5b3f6d=await staff[_0x5051c8(0x21a)]({'email':_0xc828b4['email']});_0x411cb2=await sales[_0x5051c8(0x18d)]([{'$lookup':{'from':_0x5051c8(0x1ad),'localField':'customer','foreignField':_0x5051c8(0x21f),'as':_0x5051c8(0x1c0)}},{'$unwind':_0x5051c8(0x1bc)},{'$unwind':_0x5051c8(0x219)},{'$group':{'_id':_0x5051c8(0x1c2),'invoice':{'$first':_0x5051c8(0x152)},'customers':{'$first':_0x5051c8(0x19f)},'date':{'$first':_0x5051c8(0x21c)},'warehouse_name':{'$first':_0x5051c8(0x1b0)},'sale_product':{'$push':_0x5051c8(0x219)},'note':{'$first':_0x5051c8(0x1c9)},'return_data':{'$first':_0x5051c8(0x220)},'customers_docs':{'$first':_0x5051c8(0x1bc)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5051c8(0x184)},'isle':{'$addToSet':_0x5051c8(0x1a6)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x411cb2=await sales[_0x5051c8(0x18d)]([{'$lookup':{'from':'customers','localField':_0x5051c8(0x1c6),'foreignField':_0x5051c8(0x21f),'as':_0x5051c8(0x1c0)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5051c8(0x219)},{'$group':{'_id':_0x5051c8(0x1c2),'invoice':{'$first':_0x5051c8(0x152)},'customers':{'$first':_0x5051c8(0x19f)},'date':{'$first':_0x5051c8(0x21c)},'warehouse_name':{'$first':_0x5051c8(0x1b0)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x5051c8(0x220)},'customers_docs':{'$first':_0x5051c8(0x1bc)},'total_saleproduct_quantity':{'$sum':_0x5051c8(0x190)},'level':{'$addToSet':_0x5051c8(0x184)},'isle':{'$addToSet':_0x5051c8(0x1a6)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x5051c8(0x218)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5051c8(0x11d)]('sales\x20all_data',_0x411cb2);if(_0x56fbab[0x0][_0x5051c8(0x157)]=='English\x20(US)'){var _0x13f08c=users[_0x5051c8(0x227)];console[_0x5051c8(0x11d)](_0x13f08c);}else{if(_0x56fbab[0x0][_0x5051c8(0x157)]==_0x5051c8(0x194))var _0x13f08c=users[_0x5051c8(0x194)];else{if(_0x56fbab[0x0][_0x5051c8(0x157)]==_0x5051c8(0x164))var _0x13f08c=users[_0x5051c8(0x164)];else{if(_0x56fbab[0x0][_0x5051c8(0x157)]==_0x5051c8(0x1a1))var _0x13f08c=users[_0x5051c8(0x1a1)];else{if(_0x56fbab[0x0][_0x5051c8(0x157)]==_0x5051c8(0x15d))var _0x13f08c=users[_0x5051c8(0x15d)];else{if(_0x56fbab[0x0][_0x5051c8(0x157)]=='Portuguese\x20(BR)')var _0x13f08c=users['Portuguese'];else{if(_0x56fbab[0x0][_0x5051c8(0x157)]=='Chinese')var _0x13f08c=users[_0x5051c8(0x1c4)];else{if(_0x56fbab[0x0]['language']==_0x5051c8(0x130))var _0x13f08c=users[_0x5051c8(0x177)];}}}}}}}_0x440068[_0x5051c8(0x1db)](_0x5051c8(0x207),{'success':_0x540f6b[_0x5051c8(0x20a)]('success'),'errors':_0x540f6b[_0x5051c8(0x20a)]('errors'),'sales':_0x411cb2,'profile':_0x122fc8,'role':_0xc828b4,'master_shop':_0x56fbab,'language':_0x13f08c});}catch(_0x442acc){console[_0x5051c8(0x11d)](_0x442acc);}});function a0_0xa048(){var _0x57be96=['add\x20post','product_details','$product','secondary_code','push','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Floor','received_amount','/../public','</td>','room','primary_code','then','role','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','amount','$invoice','</div>','Portuguese','OUT-','\x20Order\x20Date\x20:\x20','language','secondary_unit','Sale\x20Return','686126SLYEWZ','createTransport','all_sales_barcode','French','5MxQPCS','$product_details.production_date','$product_details','port','json','$product_details.batch_code','German','../middleware/auth','express','currency','password','string','../models/all_models','$product_details.product_name','Return\x20Rooms','product_code','/view/:id','expiry_date','$product_details.primary_code','/view/add_sale/product','note','<tbody\x20style=\x22text-align:\x20center;\x22>','email','</h5>','barcode\x20Product\x20master','Arabic','$product_details.unit','/upload/','</thead>','status','</body></html>','Ambient','requested_qty','$product_details.floorlevel','abs','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Return\x20Goods','\x20Order\x20Number\x20:\x20','$sale_product.bay','logo','$product_details.maxPerUnit','Email\x20sent\x20successfully','invoice','An\x20error\x20occurred\x20while\x20saving\x20data.','level','8007eXTEWY','bay','aggregate','sales\x20item\x20return\x20successfull','1352cFpcrB','$sale_product.quantity','<h5>','currency_placement','stocks','Hindi','carton','/view/return_sales/:id','stock_data','True','Logo.png','Raw\x20Materials','length','padStart','edit_sales','<tr>','$customer','slice','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','isAllowEdit','success','type','$sale_product.bin','find','stock','<hr\x20class=\x22my-3\x22>','master','filter','$product_details.delivery_code','customers','return_data','return_qty','$warehouse_name','$product_details.expiry_date','warehouse','Shelves','redirect','toString','False','id_transact','Sales\x20Update\x20successfully','bin','Receiving\x20Area','body','$customers_docs','nodemailer','prod_code','$product_details.level','customers_docs','$product_details.secondary_unit','$_id','Sale\x20Return\x20Mail','Chinese','delivery_date','customer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Sales\x20Add\x20successfully','$note','$product_details.product_code','product_name','post','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','getDate','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','maxperunit','floorlevel','actual_uom','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<div>','actual_qty','edit_sales_view','floor','errors','findById','render','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','concat','$product_details.rack','getMonth','<html><head><title></title>','$product_details.pallet','customer_data','/barcode_scanner','681480UFnuGX','error','split','$product_details.delivery_date','delivery_code','back','<h5\x20style=\x22text-align:\x20left;\x22>','sale_qty','/preview/:id','due_amount','sales_quantity','</tr>','unit','3300186jPUSge','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Received\x20Payment\x20For\x20Sale','save','primary_unit','payment\x20successfull','return_sale','$product_details.bin','getFullYear','\x20</h2>','$product_details.secondary_code','$product_details.storage','catch','$product_details.bay','batch_code','9296199BrDfkf','quantity','/all_sales/view','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','add_sales','Level','all_sales','types','English\x20(US)','flash','product_stock','<!DOCTYPE\x20html>','$product_details.product_cat','<h2>\x20','RoomAssigned','room_name','sale_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','date','$product_details.invoice','storage','product_data','/all_sales/preview/','$sale_product.floorlevel','$sale_product','findOne','rack','$date','$product_details.product_stock','$room','name','$return_data','prod_cat','warehouse_name','production_date','product','1050938UaUkGK','Portuguese\x20(BR)','English','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','params','foreach\x20newproduct','log','</head><body>','$product_details.type','sales_invoice','$product_details._id','message','</table>','</span>','quantity_notConverted','get','map','finalize','SCRN','barcode\x20user_id','RMSEmail','/view/add_sales/:id','user','Enabled','_id','Arabic\x20(ae)','/invoice/:id','forEach','$name','<span\x20style=\x22float:\x20right;\x22>','Enclosed','Error\x20Occurs','prod_invoice','<strong>\x20Regards\x20</strong>','5318944egWuWa','/view','image','id_transaction_from','max_per_unit','staff'];a0_0xa048=function(){return _0x57be96;};return a0_0xa048();}async function getRandom8DigitNumber(){var _0x2b5bf0=a0_0x5b7236;const _0x5e6332=0x989680,_0x53b75a=0x5f5e0ff,_0x148535=Math[_0x2b5bf0(0x1d8)](Math['random']()*(_0x53b75a-_0x5e6332+0x1))+_0x5e6332;var _0x5ae4be;const _0x2a1e01=await sales['findOne']({'invoice':_0x2b5bf0(0x155)+_0x148535});return _0x2a1e01&&_0x2a1e01[_0x2b5bf0(0x19b)]>0x0?_0x5ae4be=_0x2b5bf0(0x155)+_0x148535:_0x5ae4be='OUT-'+_0x148535,_0x5ae4be;}router['get']('/view/add_sales',auth,async(_0x2940cc,_0x218349)=>{var _0x4ba669=a0_0x5b7236;try{const {username:_0x37051d,email:_0x101963,role:_0x2b1473}=_0x2940cc[_0x4ba669(0x12d)],_0x41d51e=_0x2940cc[_0x4ba669(0x12d)],_0x53634c=await profile[_0x4ba669(0x21a)]({'email':_0x41d51e[_0x4ba669(0x174)]}),_0xa9b386=await master_shop[_0x4ba669(0x1a7)](),_0x53fb0d=await customer[_0x4ba669(0x1a7)]({});let _0x3d0841;if(_0x41d51e[_0x4ba669(0x14e)]==_0x4ba669(0x13e)){const _0x26ab4b=await staff['findOne']({'email':_0x41d51e[_0x4ba669(0x174)]});_0x3d0841=await warehouse[_0x4ba669(0x18d)]([{'$match':{'status':'Enabled','name':_0x26ab4b['warehouse'],'warehouse_category':_0x4ba669(0x19a),'name':{'$ne':_0x4ba669(0x182)}}},{'$group':{'_id':_0x4ba669(0x133),'name':{'$first':_0x4ba669(0x133)}}},{'$sort':{'name':0x1}}]);}else _0x3d0841=await warehouse['aggregate']([{'$match':{'status':_0x4ba669(0x12e),'warehouse_category':_0x4ba669(0x19a),'name':{'$ne':_0x4ba669(0x182)}}},{'$group':{'_id':_0x4ba669(0x133),'name':{'$first':_0x4ba669(0x133)}}},{'$sort':{'name':0x1}}]);const _0x1bd466=await product['find']({});var _0x27accb=[_0x4ba669(0x17d),_0x4ba669(0x135)];const _0x33951c=await sales['find']({}),_0x2f5724=_0x33951c[_0x4ba669(0x19b)]+0x1,_0x32e197=_0x4ba669(0x155)+_0x2f5724[_0x4ba669(0x1b5)]()[_0x4ba669(0x19c)](0x5,'0');if(_0xa9b386[0x0][_0x4ba669(0x157)]==_0x4ba669(0x209)){var _0x9175b8=users[_0x4ba669(0x227)];console[_0x4ba669(0x11d)](_0x9175b8);}else{if(_0xa9b386[0x0][_0x4ba669(0x157)]==_0x4ba669(0x194))var _0x9175b8=users['Hindi'];else{if(_0xa9b386[0x0][_0x4ba669(0x157)]==_0x4ba669(0x164))var _0x9175b8=users[_0x4ba669(0x164)];else{if(_0xa9b386[0x0]['language']==_0x4ba669(0x1a1))var _0x9175b8=users['Spanish'];else{if(_0xa9b386[0x0]['language']==_0x4ba669(0x15d))var _0x9175b8=users[_0x4ba669(0x15d)];else{if(_0xa9b386[0x0][_0x4ba669(0x157)]==_0x4ba669(0x226))var _0x9175b8=users[_0x4ba669(0x154)];else{if(_0xa9b386[0x0]['language']==_0x4ba669(0x1c4))var _0x9175b8=users[_0x4ba669(0x1c4)];else{if(_0xa9b386[0x0][_0x4ba669(0x157)]==_0x4ba669(0x130))var _0x9175b8=users[_0x4ba669(0x177)];}}}}}}}const _0x3e19f8=getRandom8DigitNumber();_0x3e19f8[_0x4ba669(0x14d)](_0xc624d2=>{var _0x59b80d=_0x4ba669;_0x218349[_0x59b80d(0x1db)](_0x59b80d(0x205),{'success':_0x2940cc[_0x59b80d(0x20a)](_0x59b80d(0x1a4)),'errors':_0x2940cc[_0x59b80d(0x20a)](_0x59b80d(0x1d9)),'role':_0x41d51e,'profile':_0x53634c,'customer':_0x53fb0d,'warehouse':_0x3d0841,'product':_0x1bd466,'invoice':_0xc624d2,'master_shop':_0xa9b386,'language':_0x9175b8,'rooms_data':_0x27accb});})[_0x4ba669(0x1fe)](_0x1a5708=>{var _0x417f41=_0x4ba669;_0x2940cc[_0x417f41(0x20a)](_0x417f41(0x1d9),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x218349[_0x417f41(0x1b4)]('/all_sales/view');});}catch(_0x2dd7e6){console[_0x4ba669(0x11d)](_0x2dd7e6);}}),router[a0_0x5b7236(0x126)](a0_0x5b7236(0x12c),auth,async(_0x637e6f,_0x30e875)=>{var _0x4ba0bc=a0_0x5b7236;try{const _0x20b085=_0x637e6f[_0x4ba0bc(0x11b)]['id'];console['log'](_0x20b085);const _0x234a0c=await product[_0x4ba0bc(0x1a7)](),_0x1913c4=await purchases[_0x4ba0bc(0x18d)]([{'$match':{'warehouse_name':_0x20b085}},{'$unwind':_0x4ba0bc(0x141)},{'$group':{'_id':'$product.product_name'}}]);console[_0x4ba0bc(0x11d)]('purchases_data',_0x1913c4),_0x30e875['status'](0xc8)[_0x4ba0bc(0x162)]({'purchases_data':_0x1913c4,'product_data':_0x234a0c});}catch(_0x22d70c){console[_0x4ba0bc(0x11d)](_0x22d70c);}}),router[a0_0x5b7236(0x1cc)](a0_0x5b7236(0x171),auth,async(_0x718929,_0x282881)=>{var _0xb6b91e=a0_0x5b7236;try{const {warehouse_data:_0x2c569b,product_data:_0x379c3b}=_0x718929[_0xb6b91e(0x1bb)];console['log'](_0x718929['body'][_0xb6b91e(0x216)]);;const _0x3c80ba=await master_shop[_0xb6b91e(0x1a7)]();console['log'](_0xb6b91e(0x1aa),_0x3c80ba);const _0x4cfcd9=await product[_0xb6b91e(0x21a)]({'name':_0x379c3b});console[_0xb6b91e(0x11d)](_0xb6b91e(0x224),_0x4cfcd9);const _0x4b4758=await warehouse[_0xb6b91e(0x18d)]([{'$match':{'name':_0x2c569b}},{'$unwind':_0xb6b91e(0x160)},{'$match':{'product_details.product_name':_0x379c3b}},{'$group':{'_id':_0xb6b91e(0x16b),'product_stock':{'$first':_0xb6b91e(0x21d)}}}]);console[_0xb6b91e(0x11d)](_0xb6b91e(0x197),_0x4b4758),_0x282881[_0xb6b91e(0x17b)](0xc8)[_0xb6b91e(0x162)]({'master':_0x3c80ba,'new_product':_0x4cfcd9,'stock_data':_0x4b4758});}catch(_0x4d5290){console[_0xb6b91e(0x11d)](_0x4d5290);}}),router[a0_0x5b7236(0x1cc)]('/view/add_sales',auth,async(_0x248b0a,_0x3b84dc)=>{var _0x31f2f9=a0_0x5b7236;try{const {invoice:_0x144ca9,date:_0x3f782b,warehouse_name:_0x33a1c1,product_name:_0xdc9c37,stock:_0x5ecf80,quantity:_0x5568df,note:_0x2ecd2f,room:_0x2a0479,primary_code:_0x23f12f,secondary_code:_0x2465c3,prod_code:_0x491475,level:_0x4c7f93,isle:_0xb2da7c,pallet:_0x50da54,batch_code:_0x1f6dc0,SCRN:_0x3b3779,expiry_date:_0x549d38}=_0x248b0a[_0x31f2f9(0x1bb)];if(typeof _0xdc9c37=='string')var _0x314948=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1cb)]],_0x250c7b=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1a8)]],_0xbe3fbe=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x195)]],_0x571ea6=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x14c)]],_0x2537ef=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x142)]],_0x373e9d=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1be)]],_0x22b434=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x18a)]],_0x3b4bfa=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1f6)]],_0x24d772=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x158)]],_0x2257ce=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x200)]],_0x213d55=[_0x248b0a['body'][_0x31f2f9(0x16f)]],_0x345c03=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x13d)]],_0x2e78e7=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x223)]],_0x3f1c24=[_0x248b0a[_0x31f2f9(0x1bb)]['requested_qty']],_0x1ba3d6=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1c5)]],_0x3f3b29=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1e9)]],_0x45b11d=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x221)]],_0x1b5d0d=[_0x248b0a[_0x31f2f9(0x1bb)]['quantity']],_0x45e899=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x20f)]],_0x434d33=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x137)]],_0x59a183=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1d6)]],_0x4c24c5=[_0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1d3)]],_0x48d088=[_0x248b0a[_0x31f2f9(0x1bb)]['id_transact']];else var _0x314948=[..._0x248b0a[_0x31f2f9(0x1bb)]['product_name']],_0x250c7b=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1a8)]],_0xbe3fbe=[..._0x248b0a[_0x31f2f9(0x1bb)]['carton']],_0x571ea6=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x14c)]],_0x2537ef=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x142)]],_0x373e9d=[..._0x248b0a['body']['prod_code']],_0x22b434=[..._0x248b0a['body'][_0x31f2f9(0x18a)]],_0x3b4bfa=[..._0x248b0a['body'][_0x31f2f9(0x1f6)]],_0x24d772=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x158)]],_0x2257ce=[..._0x248b0a['body'][_0x31f2f9(0x200)]],_0x213d55=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x16f)]],_0x345c03=[..._0x248b0a['body'][_0x31f2f9(0x13d)]],_0x2e78e7=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x223)]],_0x3f1c24=[..._0x248b0a['body'][_0x31f2f9(0x17e)]],_0x1ba3d6=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1c5)]],_0x3f3b29=[..._0x248b0a[_0x31f2f9(0x1bb)]['delivery_code']],_0x45b11d=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x221)]],_0x1b5d0d=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x202)]],_0x45e899=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x20f)]],_0x434d33=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x137)]],_0x59a183=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1d6)]],_0x4c24c5=[..._0x248b0a['body']['actual_uom']],_0x48d088=[..._0x248b0a[_0x31f2f9(0x1bb)][_0x31f2f9(0x1b7)]];const _0x1de299=_0x314948[_0x31f2f9(0x127)](_0x4a10f6=>{return _0x4a10f6={'product_name':_0x4a10f6};});_0x250c7b[_0x31f2f9(0x132)]((_0x11637b,_0x479f4f)=>{var _0xeb7f9b=_0x31f2f9;_0x1de299[_0x479f4f][_0xeb7f9b(0x1a8)]=Math[_0xeb7f9b(0x180)](_0x11637b);}),_0x59a183['forEach']((_0x2e1c02,_0x12251d)=>{var _0x453725=_0x31f2f9;_0x1de299[_0x12251d][_0x453725(0x1d6)]=Math[_0x453725(0x180)](_0x2e1c02);}),_0x4c24c5[_0x31f2f9(0x132)]((_0x59b965,_0x316cde)=>{var _0x1a97bc=_0x31f2f9;_0x1de299[_0x316cde][_0x1a97bc(0x1d3)]=_0x59b965;}),_0x48d088[_0x31f2f9(0x132)]((_0x138606,_0x133447)=>{var _0x510674=_0x31f2f9;_0x1de299[_0x133447][_0x510674(0x13c)]=_0x138606;}),_0xbe3fbe[_0x31f2f9(0x132)]((_0x2861c1,_0x243bdd)=>{var _0x3707e2=_0x31f2f9;_0x1de299[_0x243bdd][_0x3707e2(0x202)]=_0x2861c1;}),_0x571ea6[_0x31f2f9(0x132)]((_0x16f0c2,_0xc913b0)=>{var _0x51bb58=_0x31f2f9;_0x1de299[_0xc913b0][_0x51bb58(0x14c)]=_0x16f0c2;}),_0x2537ef[_0x31f2f9(0x132)]((_0x1a276f,_0x1a2ee8)=>{var _0x483bb9=_0x31f2f9;_0x1de299[_0x1a2ee8][_0x483bb9(0x142)]=_0x1a276f;}),_0x373e9d[_0x31f2f9(0x132)]((_0x5a500c,_0x2d6aae)=>{var _0x5e7819=_0x31f2f9;_0x1de299[_0x2d6aae][_0x5e7819(0x16d)]=_0x5a500c;}),_0x22b434[_0x31f2f9(0x132)]((_0x27da00,_0x17ad86)=>{var _0x3dd387=_0x31f2f9;_0x45e899[_0x3dd387(0x132)]((_0x5a2701,_0x153bfb)=>{var _0x2ad4a6=_0x3dd387;if(_0x5a2701==_0x2ad4a6(0x1ba)&&_0x17ad86==_0x153bfb){var _0x1ab765=_0x27da00[_0x2ad4a6(0x1a0)](0x3);_0x1de299[_0x17ad86][_0x2ad4a6(0x215)]=_0x27da00[0x0],_0x1de299[_0x17ad86][_0x2ad4a6(0x21b)]=_0x27da00[0x1],_0x1de299[_0x17ad86][_0x2ad4a6(0x18c)]=0x0,_0x1de299[_0x17ad86][_0x2ad4a6(0x1b9)]=0x0,_0x1de299[_0x17ad86][_0x2ad4a6(0x1a5)]=_0x2ad4a6(0x147),_0x1de299[_0x17ad86][_0x2ad4a6(0x1d2)]=_0x1ab765;}else{if(_0x5a2701==_0x2ad4a6(0x1b3)&&_0x17ad86==_0x153bfb){var _0x1ab765=_0x27da00[_0x2ad4a6(0x1a0)](0x3);_0x1de299[_0x17ad86][_0x2ad4a6(0x215)]=_0x27da00[0x0],_0x1de299[_0x17ad86][_0x2ad4a6(0x21b)]=_0x27da00[0x1],_0x1de299[_0x17ad86]['bay']=0x0,_0x1de299[_0x17ad86][_0x2ad4a6(0x1b9)]=0x0,_0x1de299[_0x17ad86]['type']=_0x2ad4a6(0x147),_0x1de299[_0x17ad86][_0x2ad4a6(0x1d2)]=_0x27da00[0x5];}else{if(_0x17ad86==_0x153bfb){var _0x899b66;if(_0x27da00[0x4]=='L')_0x899b66=_0x2ad4a6(0x206);else _0x27da00[0x4]=='F'&&(_0x899b66=_0x2ad4a6(0x147));_0x1de299[_0x17ad86][_0x2ad4a6(0x215)]=_0x27da00[0x0],_0x1de299[_0x17ad86][_0x2ad4a6(0x21b)]=_0x27da00[0x1],_0x1de299[_0x17ad86]['bay']=_0x27da00[0x2],_0x1de299[_0x17ad86]['bin']=_0x27da00[0x3],_0x1de299[_0x17ad86][_0x2ad4a6(0x1a5)]=_0x899b66,_0x1de299[_0x17ad86][_0x2ad4a6(0x1d2)]=_0x27da00[0x5];}}}});}),_0x3b4bfa['forEach']((_0x3fba71,_0xb98ae5)=>{var _0x33b291=_0x31f2f9;_0x1de299[_0xb98ae5][_0x33b291(0x1f1)]=_0x3fba71;}),_0x24d772['forEach']((_0x4b6072,_0x241ef7)=>{var _0x241668=_0x31f2f9;_0x1de299[_0x241ef7][_0x241668(0x158)]=_0x4b6072;}),_0x2257ce[_0x31f2f9(0x132)]((_0x2f847e,_0x6449dc)=>{var _0x4fb10f=_0x31f2f9;_0x1de299[_0x6449dc][_0x4fb10f(0x200)]=_0x2f847e;}),_0x213d55['forEach']((_0x32533d,_0x38364f)=>{_0x1de299[_0x38364f]['expiry_date']=_0x32533d;}),_0x345c03[_0x31f2f9(0x132)]((_0x1f6908,_0x2d6eaf)=>{var _0x19c538=_0x31f2f9;_0x1de299[_0x2d6eaf][_0x19c538(0x1d1)]=_0x1f6908;}),_0x2e78e7[_0x31f2f9(0x132)]((_0x14e05f,_0x58916b)=>{var _0x528083=_0x31f2f9;_0x1de299[_0x58916b][_0x528083(0x223)]=_0x14e05f;}),_0x3f1c24[_0x31f2f9(0x132)]((_0x1e569e,_0x2c7150)=>{var _0x5df01e=_0x31f2f9;_0x1de299[_0x2c7150][_0x5df01e(0x17e)]=_0x1e569e;}),_0x1ba3d6[_0x31f2f9(0x132)]((_0x57c864,_0x1d7ca8)=>{_0x1de299[_0x1d7ca8]['delivery_date']=_0x57c864;}),_0x3f3b29[_0x31f2f9(0x132)]((_0x2a2753,_0x17dff9)=>{var _0x46a8ca=_0x31f2f9;_0x1de299[_0x17dff9][_0x46a8ca(0x1e9)]=_0x2a2753;}),_0x45b11d[_0x31f2f9(0x132)]((_0x544f80,_0x77c9de)=>{var _0x1ab340=_0x31f2f9;_0x1de299[_0x77c9de][_0x1ab340(0x221)]=_0x544f80;}),_0x1b5d0d[_0x31f2f9(0x132)]((_0x4d7847,_0x41b314)=>{var _0x4a0cc2=_0x31f2f9;_0x1de299[_0x41b314][_0x4a0cc2(0x125)]=_0x4d7847;}),_0x45e899[_0x31f2f9(0x132)]((_0x4ec4ff,_0x226f0d)=>{var _0xa856fd=_0x31f2f9;_0x1de299[_0x226f0d][_0xa856fd(0x210)]=_0x4ec4ff;}),_0x434d33[_0x31f2f9(0x132)]((_0x261742,_0xf439fb)=>{var _0x22f07e=_0x31f2f9;_0x1de299[_0xf439fb][_0x22f07e(0x188)]=_0x261742;});var _0x172a2f=0x0;_0x1de299[_0x31f2f9(0x132)](_0x29ab1a=>{var _0xce5be2=_0x31f2f9;(_0x29ab1a[_0xce5be2(0x1a8)]<_0x29ab1a['quantity_notConverted']||_0x29ab1a[_0xce5be2(0x125)]==0x0)&&(console[_0xce5be2(0x11d)]('foreach\x20newproduct',_0x29ab1a),_0x172a2f++);});const _0x25b753=_0x1de299[_0x31f2f9(0x1ab)](_0x511a1b=>_0x511a1b[_0x31f2f9(0x202)]!=='0'&&_0x511a1b['quantity']!==''),_0x10d1c1=new sales({'invoice':_0x144ca9,'customer':_0x248b0a['body'][_0x31f2f9(0x1c6)],'date':_0x3f782b,'warehouse_name':_0x33a1c1,'sale_product':_0x25b753,'note':_0x2ecd2f,'room':_0x2a0479,'primary_code':_0x23f12f,'secondary_code':_0x2465c3,'prod_code':_0x491475,'SCRN':_0x3b3779}),_0xcb6033=await _0x10d1c1[_0x31f2f9(0x1f5)]();_0x248b0a[_0x31f2f9(0x20a)](_0x31f2f9(0x1a4),_0x31f2f9(0x1c8)),_0x3b84dc[_0x31f2f9(0x1b4)](_0x31f2f9(0x217)+_0xcb6033[_0x31f2f9(0x12f)]);}catch(_0x4f9439){console[_0x31f2f9(0x11d)](_0x4f9439);}}),router[a0_0x5b7236(0x126)](a0_0x5b7236(0x1ed),auth,async(_0x18b143,_0x1bb83c)=>{var _0x258011=a0_0x5b7236;try{const {username:_0x3ba637,email:_0x25dc27,role:_0x11a1d0}=_0x18b143[_0x258011(0x12d)],_0x2bc801=_0x18b143[_0x258011(0x12d)],_0x2490f1=await profile[_0x258011(0x21a)]({'email':_0x2bc801[_0x258011(0x174)]}),_0xffd2ec=await master_shop['find'](),_0x379ea7=_0x18b143[_0x258011(0x11b)]['id'],_0xe4cebd=await sales[_0x258011(0x1da)](_0x379ea7),_0x209139=await warehouse[_0x258011(0x18d)]([{'$match':{'name':_0xe4cebd[_0x258011(0x222)]}},{'$unwind':_0x258011(0x160)},{'$group':{'_id':_0x258011(0x121),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x258011(0x21d)},'bay':{'$first':_0x258011(0x1ff)},'bin':{'$first':_0x258011(0x1f9)},'type':{'$first':_0x258011(0x11f)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x258011(0x1fc)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x258011(0x1fd)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x258011(0x1b1)},'production_date':{'$first':_0x258011(0x15f)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2992c1=await customer[_0x258011(0x1a7)]({});let _0x5615de;if(_0x2bc801[_0x258011(0x14e)]==_0x258011(0x13e)){const _0x5286fc=await staff[_0x258011(0x21a)]({'email':_0x2bc801[_0x258011(0x174)]});_0x5615de=await warehouse['aggregate']([{'$match':{'status':_0x258011(0x12e),'name':_0x5286fc['warehouse']}},{'$group':{'_id':_0x258011(0x133),'name':{'$first':_0x258011(0x133)}}}]);}else _0x5615de=await warehouse[_0x258011(0x18d)]([{'$match':{'status':_0x258011(0x12e)}},{'$group':{'_id':'$name','name':{'$first':_0x258011(0x133)}}}]);const _0x352a9c=await product['find']({}),_0x3bbbf4=await suppliers['find']({});if(_0xffd2ec[0x0]['language']==_0x258011(0x209)){var _0x2e9e7d=users[_0x258011(0x227)];console[_0x258011(0x11d)](_0x2e9e7d);}else{if(_0xffd2ec[0x0]['language']==_0x258011(0x194))var _0x2e9e7d=users[_0x258011(0x194)];else{if(_0xffd2ec[0x0][_0x258011(0x157)]==_0x258011(0x164))var _0x2e9e7d=users[_0x258011(0x164)];else{if(_0xffd2ec[0x0][_0x258011(0x157)]==_0x258011(0x1a1))var _0x2e9e7d=users[_0x258011(0x1a1)];else{if(_0xffd2ec[0x0][_0x258011(0x157)]==_0x258011(0x15d))var _0x2e9e7d=users[_0x258011(0x15d)];else{if(_0xffd2ec[0x0][_0x258011(0x157)]==_0x258011(0x226))var _0x2e9e7d=users[_0x258011(0x154)];else{if(_0xffd2ec[0x0][_0x258011(0x157)]==_0x258011(0x1c4))var _0x2e9e7d=users['Chinese'];else{if(_0xffd2ec[0x0]['language']=='Arabic\x20(ae)')var _0x2e9e7d=users[_0x258011(0x177)];}}}}}}}_0x1bb83c[_0x258011(0x1db)](_0x258011(0x1d7),{'success':_0x18b143[_0x258011(0x20a)]('success'),'errors':_0x18b143['flash'](_0x258011(0x1d9)),'role':_0x2bc801,'profile':_0x2490f1,'customer':_0x2992c1,'warehouse':_0x5615de,'product':_0x209139,'user':_0xe4cebd,'master_shop':_0xffd2ec,'unit':_0x352a9c,'language':_0x2e9e7d,'suppliers':_0x3bbbf4});}catch(_0x19623d){console[_0x258011(0x11d)](_0x19623d);}}),router[a0_0x5b7236(0x1cc)](a0_0x5b7236(0x1ed),auth,async(_0x29008f,_0x4042b4)=>{var _0x385163=a0_0x5b7236;try{const _0x1cc446=_0x29008f[_0x385163(0x11b)]['id'],{invoice:_0xa15131,warehouse_name:_0x3ca27f,room:_0x3cc9b6}=_0x29008f[_0x385163(0x1bb)],_0x284933=await sales[_0x385163(0x21a)]({'invoice':_0xa15131}),_0x42d0e2=_0x284933['sale_product']['map'](async _0x1ac484=>{var _0x17f121=_0x385163,_0x27327=await warehouse[_0x17f121(0x21a)]({'name':_0x3ca27f,'room':_0x1ac484['room_name'],'warehouse_category':_0x17f121(0x19a)});const _0x10c272=_0x27327[_0x17f121(0x140)][_0x17f121(0x127)](_0xf821d7=>{var _0x4d3c24=_0x17f121;_0xf821d7[_0x4d3c24(0x1cb)]==_0x1ac484['product_name']&&_0xf821d7[_0x4d3c24(0x1d2)]==_0x1ac484['floorlevel']&&_0xf821d7[_0x4d3c24(0x1a5)]==_0x1ac484[_0x4d3c24(0x1a5)]&&_0xf821d7[_0x4d3c24(0x1b9)]==_0x1ac484[_0x4d3c24(0x1b9)]&&_0xf821d7[_0x4d3c24(0x18c)]==_0x1ac484[_0x4d3c24(0x18c)]&&_0xf821d7[_0x4d3c24(0x21b)]==_0x1ac484[_0x4d3c24(0x21b)]&&_0xf821d7['storage']==_0x1ac484[_0x4d3c24(0x215)]&&_0xf821d7[_0x4d3c24(0x16f)]==_0x1ac484[_0x4d3c24(0x16f)]&&_0xf821d7[_0x4d3c24(0x200)]==_0x1ac484[_0x4d3c24(0x200)]&&_0xf821d7[_0x4d3c24(0x12f)]==_0x1ac484[_0x4d3c24(0x13c)]&&(_0xf821d7[_0x4d3c24(0x20b)]=Math[_0x4d3c24(0x144)](0x0,Math[_0x4d3c24(0x180)](_0xf821d7[_0x4d3c24(0x20b)])-Math[_0x4d3c24(0x180)](_0x1ac484[_0x4d3c24(0x202)])));});return _0x27327;});Promise['all'](_0x42d0e2)[_0x385163(0x14d)](async _0x20dd0b=>{var _0x1f08a2=_0x385163;try{for(const _0x376828 of _0x20dd0b){await _0x376828[_0x1f08a2(0x1f5)]();}_0x284933[_0x1f08a2(0x128)]='True';const _0x39098d=await _0x284933['save'](),_0x2117d3=await master_shop[_0x1f08a2(0x1a7)](),_0x5e4641=await email_settings[_0x1f08a2(0x21a)](),_0x16c9fe=await supervisor_settings[_0x1f08a2(0x1a7)]();var _0x395a50=_0x284933[_0x1f08a2(0x211)],_0x4114c1='',_0xe5a8e3;for(_0xe5a8e3 in _0x395a50){_0x4114c1+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x395a50[_0xe5a8e3][_0x1f08a2(0x1cb)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x395a50[_0xe5a8e3][_0x1f08a2(0x16d)]+_0x1f08a2(0x14a)+_0x1f08a2(0x181)+_0x395a50[_0xe5a8e3][_0x1f08a2(0x202)]+_0x1f08a2(0x14a)+_0x1f08a2(0x181)+_0x395a50[_0xe5a8e3][_0x1f08a2(0x1f1)]+_0x1f08a2(0x14a)+_0x1f08a2(0x181)+_0x395a50[_0xe5a8e3][_0x1f08a2(0x158)]+_0x1f08a2(0x14a)+_0x1f08a2(0x181)+_0x284933[_0x1f08a2(0x222)]+_0x1f08a2(0x14a)+_0x1f08a2(0x181)+_0x395a50[_0xe5a8e3][_0x1f08a2(0x210)]+_0x1f08a2(0x14a)+_0x1f08a2(0x181)+_0x395a50[_0xe5a8e3][_0x1f08a2(0x215)]+_0x395a50[_0xe5a8e3][_0x1f08a2(0x21b)]+_0x395a50[_0xe5a8e3][_0x1f08a2(0x18c)]+_0x395a50[_0xe5a8e3]['bin']+_0x395a50[_0xe5a8e3]['type'][0x0]+_0x395a50[_0xe5a8e3][_0x1f08a2(0x1d2)]+_0x1f08a2(0x14a),_0x1f08a2(0x1f0);}let _0x2cf608=nodemailer[_0x1f08a2(0x15b)]({'host':_0x5e4641['host'],'port':Number(_0x5e4641[_0x1f08a2(0x161)]),'secure':![],'auth':{'user':_0x5e4641[_0x1f08a2(0x174)],'pass':_0x5e4641[_0x1f08a2(0x168)]}}),_0x429e97={'from':_0x5e4641['email'],'to':_0x16c9fe[0x0][_0x1f08a2(0x12b)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x1f08a2(0x199),'path':__dirname+_0x1f08a2(0x149)+_0x1f08a2(0x179)+_0x2117d3[0x0][_0x1f08a2(0x13b)],'cid':_0x1f08a2(0x185)}],'html':_0x1f08a2(0x20c)+_0x1f08a2(0x1e1)+_0x1f08a2(0x11e)+_0x1f08a2(0x1d5)+_0x1f08a2(0x146)+'<div>'+_0x1f08a2(0x1d0)+_0x1f08a2(0x153)+_0x1f08a2(0x1d5)+'<h2>\x20'+_0x2117d3[0x0][_0x1f08a2(0x1cd)]+_0x1f08a2(0x1fb)+_0x1f08a2(0x153)+_0x1f08a2(0x153)+_0x1f08a2(0x1a9)+'<div>'+_0x1f08a2(0x1eb)+_0x1f08a2(0x183)+_0x284933[_0x1f08a2(0x188)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1f08a2(0x156)+_0x284933[_0x1f08a2(0x213)]+'\x20'+'</span>'+_0x1f08a2(0x175)+_0x1f08a2(0x153)+_0x1f08a2(0x1f3)+_0x1f08a2(0x1d4)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1f08a2(0x1a2)+_0x1f08a2(0x212)+_0x1f08a2(0x1c7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1f08a2(0x145)+_0x1f08a2(0x150)+_0x1f08a2(0x1f0)+_0x1f08a2(0x17a)+_0x1f08a2(0x173)+'\x20'+_0x4114c1+'\x20'+'</tbody>'+_0x1f08a2(0x123)+_0x1f08a2(0x1d5)+_0x1f08a2(0x138)+_0x1f08a2(0x191)+_0x2117d3[0x0][_0x1f08a2(0x1cd)]+_0x1f08a2(0x175)+'</div>'+'</div>'+_0x1f08a2(0x17c)};_0x2cf608['sendMail'](_0x429e97,function(_0x43a992,_0x178372){var _0x1d5390=_0x1f08a2;_0x43a992?(console['log'](_0x43a992),console[_0x1d5390(0x11d)](_0x1d5390(0x136))):console[_0x1d5390(0x11d)](_0x1d5390(0x187));}),_0x29008f[_0x1f08a2(0x20a)](_0x1f08a2(0x1a4),_0x1f08a2(0x1b8)),_0x4042b4[_0x1f08a2(0x1b4)]('/all_sales/preview/'+_0x1cc446);}catch(_0x167fa0){console[_0x1f08a2(0x1e6)](_0x167fa0),_0x4042b4['status'](0x1f4)[_0x1f08a2(0x162)]({'error':_0x1f08a2(0x189)});}})[_0x385163(0x1fe)](_0x22e654=>{var _0x337730=_0x385163;console[_0x337730(0x1e6)](_0x22e654),_0x4042b4[_0x337730(0x17b)](0x1f4)[_0x337730(0x162)]({'error':'An\x20error\x20occurred.'});});}catch(_0x789872){console[_0x385163(0x11d)](_0x789872);}}),router[a0_0x5b7236(0x126)](a0_0x5b7236(0x16e),auth,async(_0x5b0b62,_0x1acb34)=>{var _0x22beb7=a0_0x5b7236;try{const {username:_0x3a7115,email:_0xaab533,role:_0x953619}=_0x5b0b62[_0x22beb7(0x12d)],_0x3aeeea=_0x5b0b62['user'],_0xf6bdfb=await profile[_0x22beb7(0x21a)]({'email':_0x3aeeea[_0x22beb7(0x174)]}),_0x29965c=await master_shop[_0x22beb7(0x1a7)](),_0x1f6163=_0x5b0b62[_0x22beb7(0x11b)]['id'],_0x4f0d72=await sales[_0x22beb7(0x1da)](_0x1f6163);var _0x4e33a7=['Ambient',_0x22beb7(0x135)];const _0x3222d9=await warehouse['aggregate']([{'$match':{'name':_0x4f0d72[_0x22beb7(0x222)],'warehouse_category':_0x22beb7(0x19a)}},{'$unwind':_0x22beb7(0x160)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x22beb7(0x16b)},'product_stock':{'$first':_0x22beb7(0x21d)},'bay':{'$first':_0x22beb7(0x1ff)},'bin':{'$first':_0x22beb7(0x1f9)},'type':{'$first':_0x22beb7(0x11f)},'floorlevel':{'$first':_0x22beb7(0x17f)},'primary_code':{'$first':_0x22beb7(0x170)},'secondary_code':{'$first':_0x22beb7(0x1fc)},'product_code':{'$first':_0x22beb7(0x1ca)},'storage':{'$first':_0x22beb7(0x1fd)},'rack':{'$first':_0x22beb7(0x1df)}}}]),_0x38e21d=await customer[_0x22beb7(0x1a7)]({});let _0x15378f;if(_0x3aeeea[_0x22beb7(0x14e)]==_0x22beb7(0x13e)){const _0x8c0fe4=await staff['findOne']({'email':_0x3aeeea[_0x22beb7(0x174)]});_0x15378f=await warehouse['aggregate']([{'$match':{'status':_0x22beb7(0x12e),'name':_0x8c0fe4[_0x22beb7(0x1b2)],'warehouse_category':_0x22beb7(0x19a)}},{'$group':{'_id':_0x22beb7(0x133),'name':{'$first':_0x22beb7(0x133)}}}]);}else _0x15378f=await warehouse[_0x22beb7(0x18d)]([{'$match':{'status':_0x22beb7(0x12e),'warehouse_category':_0x22beb7(0x19a)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x379ce1=await product[_0x22beb7(0x1a7)]({});if(_0x29965c[0x0][_0x22beb7(0x157)]==_0x22beb7(0x209)){var _0x38f874=users[_0x22beb7(0x227)];console['log'](_0x38f874);}else{if(_0x29965c[0x0][_0x22beb7(0x157)]==_0x22beb7(0x194))var _0x38f874=users['Hindi'];else{if(_0x29965c[0x0][_0x22beb7(0x157)]=='German')var _0x38f874=users[_0x22beb7(0x164)];else{if(_0x29965c[0x0]['language']==_0x22beb7(0x1a1))var _0x38f874=users[_0x22beb7(0x1a1)];else{if(_0x29965c[0x0][_0x22beb7(0x157)]==_0x22beb7(0x15d))var _0x38f874=users['French'];else{if(_0x29965c[0x0]['language']==_0x22beb7(0x226))var _0x38f874=users[_0x22beb7(0x154)];else{if(_0x29965c[0x0]['language']==_0x22beb7(0x1c4))var _0x38f874=users[_0x22beb7(0x1c4)];else{if(_0x29965c[0x0][_0x22beb7(0x157)]=='Arabic\x20(ae)')var _0x38f874=users[_0x22beb7(0x177)];}}}}}}}_0x1acb34[_0x22beb7(0x1db)](_0x22beb7(0x19d),{'success':_0x5b0b62[_0x22beb7(0x20a)](_0x22beb7(0x1a4)),'errors':_0x5b0b62[_0x22beb7(0x20a)](_0x22beb7(0x1d9)),'role':_0x3aeeea,'profile':_0xf6bdfb,'customer':_0x38e21d,'warehouse':_0x15378f,'product':_0x3222d9,'user':_0x4f0d72,'master_shop':_0x29965c,'unit':_0x379ce1,'language':_0x38f874});}catch(_0x51ab69){console[_0x22beb7(0x11d)](_0x51ab69);}}),router['post'](a0_0x5b7236(0x16e),auth,async(_0x2fef86,_0x187717)=>{var _0x589f7b=a0_0x5b7236;try{const _0x2a5ca0=_0x2fef86['params']['id'],_0x319553=await sales[_0x589f7b(0x21a)]({'_id':_0x2fef86[_0x589f7b(0x11b)]['id']}),_0x4e0a18=await warehouse[_0x589f7b(0x21a)]({'name':_0x319553[_0x589f7b(0x222)],'room':_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x14b)]}),{invoice:_0x1d5174,date:_0xc6980,warehouse_name:_0x42c582,product_name:_0x1569ee,stock:_0x475968,quantity:_0x353633,note:_0x5d424f,room:_0x3b2e97,customer:_0xff70bc,SCRN:_0x10b065}=_0x2fef86['body'];if(typeof _0x1569ee==_0x589f7b(0x169))var _0x3c0c7b=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1cb)]],_0x4ae25c=[_0x2fef86[_0x589f7b(0x1bb)]['stock']],_0x623497=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x195)]],_0x2fbc43=[_0x2fef86[_0x589f7b(0x1bb)]['primary_code']],_0x6966d8=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x142)]],_0x303006=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1be)]],_0x19be8d=[_0x2fef86[_0x589f7b(0x1bb)]['level']],_0x47328d=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1f6)]],_0x1a3149=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x158)]],_0x2e73b0=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x200)]],_0x4e33ba=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x16f)]],_0x40e9a6=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x13d)]],_0x441308=[_0x2fef86[_0x589f7b(0x1bb)]['production_date']],_0x25bb35=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x17e)]],_0x1781e0=[_0x2fef86[_0x589f7b(0x1bb)]['delivery_date']],_0x29a6c6=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1e9)]],_0x56e886=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x221)]],_0x56ba21=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x202)]],_0x5c6fd2=[_0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x20f)]];else var _0x3c0c7b=[..._0x2fef86[_0x589f7b(0x1bb)]['product_name']],_0x4ae25c=[..._0x2fef86['body'][_0x589f7b(0x1a8)]],_0x623497=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x195)]],_0x2fbc43=[..._0x2fef86['body']['primary_code']],_0x6966d8=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x142)]],_0x303006=[..._0x2fef86['body']['prod_code']],_0x19be8d=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x18a)]],_0x47328d=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1f6)]],_0x1a3149=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x158)]],_0x2e73b0=[..._0x2fef86[_0x589f7b(0x1bb)]['batch_code']],_0x4e33ba=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x16f)]],_0x40e9a6=[..._0x2fef86[_0x589f7b(0x1bb)]['max_per_unit']],_0x441308=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x223)]],_0x25bb35=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x17e)]],_0x1781e0=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1c5)]],_0x29a6c6=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x1e9)]],_0x56e886=[..._0x2fef86[_0x589f7b(0x1bb)][_0x589f7b(0x221)]],_0x56ba21=[..._0x2fef86['body'][_0x589f7b(0x202)]],_0x5c6fd2=[..._0x2fef86['body'][_0x589f7b(0x20f)]];const _0xd7641c=_0x3c0c7b[_0x589f7b(0x127)](_0xf21f4a=>{return _0xf21f4a={'product_name':_0xf21f4a};});_0x4ae25c[_0x589f7b(0x132)]((_0x41f735,_0x224cdc)=>{var _0x4cc2fa=_0x589f7b;_0xd7641c[_0x224cdc][_0x4cc2fa(0x1a8)]=Math[_0x4cc2fa(0x180)](_0x41f735);}),_0x623497[_0x589f7b(0x132)]((_0x3960f8,_0x19bb7d)=>{_0xd7641c[_0x19bb7d]['quantity']=_0x3960f8;}),_0x2fbc43['forEach']((_0x4c1aa3,_0x214993)=>{var _0x174a86=_0x589f7b;_0xd7641c[_0x214993][_0x174a86(0x14c)]=_0x4c1aa3;}),_0x6966d8[_0x589f7b(0x132)]((_0x160c8f,_0x25557c)=>{var _0x8a0a24=_0x589f7b;_0xd7641c[_0x25557c][_0x8a0a24(0x142)]=_0x160c8f;}),_0x303006[_0x589f7b(0x132)]((_0x53a684,_0x38bedb)=>{var _0xbeb26e=_0x589f7b;_0xd7641c[_0x38bedb][_0xbeb26e(0x16d)]=_0x53a684;}),_0x19be8d[_0x589f7b(0x132)]((_0x1bd40f,_0x2489c9)=>{var _0x32f8c9=_0x589f7b;_0x5c6fd2[_0x32f8c9(0x132)]((_0x28453c,_0x39bf76)=>{var _0xd1f583=_0x32f8c9;if(_0x28453c==_0xd1f583(0x1ba)&&_0x2489c9==_0x39bf76){var _0x3b55f8=_0x1bd40f[_0xd1f583(0x1a0)](0x3);_0xd7641c[_0x2489c9][_0xd1f583(0x215)]=_0x1bd40f[0x0],_0xd7641c[_0x2489c9][_0xd1f583(0x21b)]=_0x1bd40f[0x1],_0xd7641c[_0x2489c9]['bay']=0x0,_0xd7641c[_0x2489c9][_0xd1f583(0x1b9)]=0x0,_0xd7641c[_0x2489c9][_0xd1f583(0x1a5)]=_0xd1f583(0x147),_0xd7641c[_0x2489c9][_0xd1f583(0x1d2)]=_0x3b55f8;}else{if(_0x28453c=='Shelves'&&_0x2489c9==_0x39bf76){var _0x3b55f8=_0x1bd40f[_0xd1f583(0x1a0)](0x3);_0xd7641c[_0x2489c9]['storage']=_0x1bd40f[0x0],_0xd7641c[_0x2489c9][_0xd1f583(0x21b)]=_0x1bd40f[0x1],_0xd7641c[_0x2489c9][_0xd1f583(0x18c)]=0x0,_0xd7641c[_0x2489c9][_0xd1f583(0x1b9)]=0x0,_0xd7641c[_0x2489c9][_0xd1f583(0x1a5)]=_0xd1f583(0x147),_0xd7641c[_0x2489c9][_0xd1f583(0x1d2)]=_0x1bd40f[0x5];}else{if(_0x2489c9==_0x39bf76){var _0x342a2e;if(_0x1bd40f[0x4]=='L')_0x342a2e='Level';else _0x1bd40f[0x4]=='F'&&(_0x342a2e='Floor');_0xd7641c[_0x2489c9][_0xd1f583(0x215)]=_0x1bd40f[0x0],_0xd7641c[_0x2489c9][_0xd1f583(0x21b)]=_0x1bd40f[0x1],_0xd7641c[_0x2489c9]['bay']=_0x1bd40f[0x2],_0xd7641c[_0x2489c9][_0xd1f583(0x1b9)]=_0x1bd40f[0x3],_0xd7641c[_0x2489c9][_0xd1f583(0x1a5)]=_0x342a2e,_0xd7641c[_0x2489c9]['floorlevel']=_0x1bd40f[0x5];}}}});}),_0x47328d[_0x589f7b(0x132)]((_0x18cbfa,_0x1176af)=>{var _0x4e4943=_0x589f7b;_0xd7641c[_0x1176af][_0x4e4943(0x1f1)]=_0x18cbfa;}),_0x1a3149[_0x589f7b(0x132)]((_0x19cc3e,_0xc58997)=>{var _0xab567a=_0x589f7b;_0xd7641c[_0xc58997][_0xab567a(0x158)]=_0x19cc3e;}),_0x2e73b0[_0x589f7b(0x132)]((_0x5ca537,_0x2246bf)=>{var _0x1066f4=_0x589f7b;_0xd7641c[_0x2246bf][_0x1066f4(0x200)]=_0x5ca537;}),_0x4e33ba['forEach']((_0x6d1f30,_0x302c96)=>{var _0x2272fe=_0x589f7b;_0xd7641c[_0x302c96][_0x2272fe(0x16f)]=_0x6d1f30;}),_0x40e9a6[_0x589f7b(0x132)]((_0x1f920c,_0x273ebc)=>{var _0x2642dd=_0x589f7b;_0xd7641c[_0x273ebc][_0x2642dd(0x1d1)]=_0x1f920c;}),_0x441308['forEach']((_0x557e54,_0x1b5e03)=>{var _0x5a48d1=_0x589f7b;_0xd7641c[_0x1b5e03][_0x5a48d1(0x223)]=_0x557e54;}),_0x25bb35[_0x589f7b(0x132)]((_0x1d76b8,_0x3070fb)=>{var _0x2ba960=_0x589f7b;_0xd7641c[_0x3070fb]['requested_qty']=Math[_0x2ba960(0x180)](_0x1d76b8);}),_0x1781e0[_0x589f7b(0x132)]((_0x39c177,_0x328dc8)=>{var _0x1c9a4b=_0x589f7b;_0xd7641c[_0x328dc8][_0x1c9a4b(0x1c5)]=_0x39c177;}),_0x29a6c6[_0x589f7b(0x132)]((_0x50978d,_0x1da0cd)=>{var _0x4be2db=_0x589f7b;_0xd7641c[_0x1da0cd][_0x4be2db(0x1e9)]=_0x50978d;}),_0x56e886[_0x589f7b(0x132)]((_0x302a85,_0x329964)=>{_0xd7641c[_0x329964]['prod_cat']=_0x302a85;}),_0x56ba21[_0x589f7b(0x132)]((_0x940306,_0xa205d1)=>{var _0x58b82b=_0x589f7b;_0xd7641c[_0xa205d1][_0x58b82b(0x125)]=_0x940306;}),_0x5c6fd2[_0x589f7b(0x132)]((_0x1ba529,_0x366253)=>{var _0x2ab7cf=_0x589f7b;_0xd7641c[_0x366253][_0x2ab7cf(0x210)]=_0x1ba529;});var _0x246ce7=0x0;_0xd7641c[_0x589f7b(0x132)](_0xde3cff=>{var _0x19c720=_0x589f7b;console[_0x19c720(0x11d)](_0x19c720(0x11c),_0xde3cff),(parseInt(_0xde3cff[_0x19c720(0x1a8)])<parseInt(_0xde3cff[_0x19c720(0x202)])||parseInt(_0xde3cff[_0x19c720(0x202)])==0x0)&&_0x246ce7++;});if(_0x246ce7!=0x0)return _0x2fef86[_0x589f7b(0x20a)](_0x589f7b(0x1d9),_0x589f7b(0x11a)),_0x187717[_0x589f7b(0x1b4)](_0x589f7b(0x1ea));const _0xc56acf=_0xd7641c[_0x589f7b(0x1ab)](_0x3c9495=>_0x3c9495[_0x589f7b(0x202)]!=='0'&&_0x3c9495[_0x589f7b(0x202)]!=='');_0x319553[_0x589f7b(0x188)]=_0x1d5174,_0x319553[_0x589f7b(0x1c6)]=_0xff70bc,_0x319553[_0x589f7b(0x213)]=_0xc6980,_0x319553['warehouse_name']=_0x42c582,_0x319553[_0x589f7b(0x211)]=_0xc56acf,_0x319553[_0x589f7b(0x172)]=_0x5d424f,_0x319553[_0x589f7b(0x129)]=_0x10b065,_0x319553['finalize']=_0x589f7b(0x1b6),_0x319553[_0x589f7b(0x1a3)]=_0x589f7b(0x1b6);const _0x5e3994=await _0x319553['save']();_0x2fef86[_0x589f7b(0x20a)](_0x589f7b(0x1a4),_0x589f7b(0x1b8)),_0x187717[_0x589f7b(0x1b4)]('/all_sales/view');}catch(_0x5b4c97){console[_0x589f7b(0x11d)](_0x5b4c97);}}),router[a0_0x5b7236(0x1cc)]('/give_payment/:id',auth,async(_0x109a17,_0x9c1fad)=>{var _0x362941=a0_0x5b7236;try{const _0x43c6c1=_0x109a17['params']['id'],{invoice:_0x437ddc,customer:_0x48016e,receivable_amount:_0x5541ff,received_amount:_0x1d101e}=_0x109a17[_0x362941(0x1bb)],_0x15f695=await sales['findById'](_0x43c6c1);console[_0x362941(0x11d)](_0x15f695);var _0x2278e4=_0x5541ff-_0x1d101e;console[_0x362941(0x11d)](_0x1d101e),_0x15f695[_0x362941(0x148)]=parseFloat(_0x1d101e)+parseFloat(_0x15f695[_0x362941(0x148)]),_0x15f695[_0x362941(0x1ee)]=_0x2278e4,console[_0x362941(0x11d)](_0x15f695);const _0x945dfd=await _0x15f695[_0x362941(0x1f5)](),_0x83e469=await c_payment_data['findOne']({'invoice':_0x437ddc});_0x83e469[_0x362941(0x151)]=_0x2278e4,await _0x83e469[_0x362941(0x1f5)]();let _0xccfd0f=new Date(),_0x246bf4=('0'+_0xccfd0f[_0x362941(0x1cf)]())[_0x362941(0x1a0)](-0x2),_0x8e2935=('0'+(_0xccfd0f[_0x362941(0x1e0)]()+0x1))[_0x362941(0x1a0)](-0x2),_0x47b7cd=_0xccfd0f[_0x362941(0x1fa)](),_0x36c4cc=_0x47b7cd+'-'+_0x8e2935+'-'+_0x246bf4;const _0x410ddb=new customer_payment({'invoice':_0x437ddc,'date':_0x47b7cd+'-'+_0x8e2935+'-'+_0x246bf4,'customer':_0x48016e,'reason':_0x362941(0x1f4),'amount':_0x1d101e}),_0x2a0731=await _0x410ddb[_0x362941(0x1f5)]();_0x109a17['flash'](_0x362941(0x1a4),_0x362941(0x1f7)),_0x9c1fad['redirect'](_0x362941(0x203));}catch(_0xd5f826){console[_0x362941(0x11d)](_0xd5f826);}}),router['get'](a0_0x5b7236(0x131),auth,async(_0x5e4ab2,_0x1d1b65)=>{var _0x583b6f=a0_0x5b7236;try{const {username:_0xcbf19d,email:_0x143d8a,role:_0x59fd6c}=_0x5e4ab2[_0x583b6f(0x12d)],_0x4ccb66=_0x5e4ab2['user'],_0x13d633=await profile['findOne']({'email':_0x4ccb66[_0x583b6f(0x174)]}),_0x3e3f89=await master_shop[_0x583b6f(0x1a7)]();console[_0x583b6f(0x11d)]('master',_0x3e3f89);const _0x4113d3=_0x5e4ab2[_0x583b6f(0x11b)]['id'],_0x5de9ec=await sales[_0x583b6f(0x1da)](_0x4113d3);console['log'](_0x5de9ec);const _0x5adea6=await customer['findOne']({'name':_0x5de9ec[_0x583b6f(0x1c6)]});console[_0x583b6f(0x11d)](_0x5adea6);if(_0x3e3f89[0x0]['language']==_0x583b6f(0x209)){var _0xe1b48b=users[_0x583b6f(0x227)];console[_0x583b6f(0x11d)](_0xe1b48b);}else{if(_0x3e3f89[0x0]['language']==_0x583b6f(0x194))var _0xe1b48b=users[_0x583b6f(0x194)];else{if(_0x3e3f89[0x0][_0x583b6f(0x157)]=='German')var _0xe1b48b=users[_0x583b6f(0x164)];else{if(_0x3e3f89[0x0]['language']==_0x583b6f(0x1a1))var _0xe1b48b=users['Spanish'];else{if(_0x3e3f89[0x0]['language']==_0x583b6f(0x15d))var _0xe1b48b=users[_0x583b6f(0x15d)];else{if(_0x3e3f89[0x0][_0x583b6f(0x157)]==_0x583b6f(0x226))var _0xe1b48b=users[_0x583b6f(0x154)];else{if(_0x3e3f89[0x0][_0x583b6f(0x157)]==_0x583b6f(0x1c4))var _0xe1b48b=users[_0x583b6f(0x1c4)];else{if(_0x3e3f89[0x0][_0x583b6f(0x157)]==_0x583b6f(0x130))var _0xe1b48b=users[_0x583b6f(0x177)];}}}}}}}_0x1d1b65['render'](_0x583b6f(0x120),{'success':_0x5e4ab2['flash'](_0x583b6f(0x1a4)),'errors':_0x5e4ab2[_0x583b6f(0x20a)](_0x583b6f(0x1d9)),'role':_0x4ccb66,'profile':_0x13d633,'master_shop':_0x3e3f89,'customers':_0x5adea6,'sales':_0x5de9ec,'language':_0xe1b48b});}catch(_0x5002e7){console[_0x583b6f(0x11d)](_0x5002e7);}}),router[a0_0x5b7236(0x126)](a0_0x5b7236(0x196),auth,async(_0x187c87,_0x236c51)=>{var _0x6af111=a0_0x5b7236;try{const {username:_0x4346cf,email:_0x463e56,role:_0x441516}=_0x187c87['user'],_0x5bdad2=_0x187c87['user'],_0x1ffa54=await profile[_0x6af111(0x21a)]({'email':_0x5bdad2['email']}),_0x39631f=await master_shop[_0x6af111(0x1a7)]();console[_0x6af111(0x11d)](_0x6af111(0x1aa),_0x39631f);const _0xcf5a03=_0x187c87[_0x6af111(0x11b)]['id'];console['log'](_0xcf5a03);const _0x12474a=await sales[_0x6af111(0x1da)](_0xcf5a03);console['log']('user_id',_0x12474a);const _0x21d181=await warehouse[_0x6af111(0x18d)]([{'$match':{'name':_0x6af111(0x182),'room':'Return\x20Rooms'}},{'$unwind':_0x6af111(0x160)},{'$group':{'_id':_0x6af111(0x121),'name':{'$first':_0x6af111(0x16b)},'product_stock':{'$first':_0x6af111(0x21d)},'level':{'$first':_0x6af111(0x1bf)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x6af111(0x1e2)},'primary_code':{'$first':_0x6af111(0x170)},'secondary_code':{'$first':_0x6af111(0x1fc)},'product_code':{'$first':_0x6af111(0x1ca)}}}]);console[_0x6af111(0x11d)]('stock_data',_0x21d181);const _0x3b4fd8=await product[_0x6af111(0x1a7)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x6af111(0x12e),'name':_0x6af111(0x182),'warehouse_category':_0x6af111(0x19a)}},{'$group':{'_id':'$name','name':{'$first':_0x6af111(0x133)}}},{'$sort':{'name':0x1}}]);var _0x376556=[_0x6af111(0x16c)];if(_0x39631f[0x0][_0x6af111(0x157)]==_0x6af111(0x209)){var _0x5739a8=users[_0x6af111(0x227)];console[_0x6af111(0x11d)](_0x5739a8);}else{if(_0x39631f[0x0]['language']=='Hindi')var _0x5739a8=users[_0x6af111(0x194)];else{if(_0x39631f[0x0][_0x6af111(0x157)]==_0x6af111(0x164))var _0x5739a8=users[_0x6af111(0x164)];else{if(_0x39631f[0x0][_0x6af111(0x157)]==_0x6af111(0x1a1))var _0x5739a8=users[_0x6af111(0x1a1)];else{if(_0x39631f[0x0]['language']==_0x6af111(0x15d))var _0x5739a8=users[_0x6af111(0x15d)];else{if(_0x39631f[0x0][_0x6af111(0x157)]==_0x6af111(0x226))var _0x5739a8=users[_0x6af111(0x154)];else{if(_0x39631f[0x0][_0x6af111(0x157)]==_0x6af111(0x1c4))var _0x5739a8=users[_0x6af111(0x1c4)];else{if(_0x39631f[0x0][_0x6af111(0x157)]==_0x6af111(0x130))var _0x5739a8=users[_0x6af111(0x177)];}}}}}}}_0x236c51[_0x6af111(0x1db)](_0x6af111(0x1f8),{'success':_0x187c87[_0x6af111(0x20a)](_0x6af111(0x1a4)),'errors':_0x187c87[_0x6af111(0x20a)]('errors'),'role':_0x5bdad2,'profile':_0x1ffa54,'user':_0x12474a,'stock':_0x21d181,'master_shop':_0x39631f,'unit':_0x3b4fd8,'language':_0x5739a8,'warehouses':warehouse_data,'rooms':_0x376556});}catch(_0x4775a4){console[_0x6af111(0x11d)](_0x4775a4),_0x236c51[_0x6af111(0x17b)](0xc8)[_0x6af111(0x162)]({'message':_0x4775a4['message']});}}),router[a0_0x5b7236(0x1cc)](a0_0x5b7236(0x196),auth,async(_0x11ae90,_0x14aaa2)=>{var _0x462fb9=a0_0x5b7236;try{const {invoice:_0x4f68ad,date:_0x4a971e,warehouse_name:_0x13aa5c,product_name:_0x4ff40c,primary_code:_0x321a7c,secondary_code:_0x295a38,product_code:_0x1d832a,sales_quantity:_0x37edcf,stocks:_0x3e6e2f,return_qty:_0x4f0fcd,Room_name:_0x3a154c,to_warehouse_name:_0xaff6ec,to_Roomname:_0x57a5a7,to_Room_name:_0x1cf336,note:_0x4d62df,level:_0x1c3e36,isle:_0x3128cf,pallet:_0x199955}=_0x11ae90[_0x462fb9(0x1bb)];if(typeof _0x4ff40c=='string')var _0x412997=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1cb)]],_0x55288f=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x14c)]],_0x215401=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x142)]],_0x5241ad=[_0x11ae90[_0x462fb9(0x1bb)]['product_code']],_0x2c0899=[_0x11ae90[_0x462fb9(0x1bb)]['sales_quantity']],_0x32e380=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x193)]],_0x159a7c=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1af)]],_0x164a93=[_0x11ae90['body']['bay']],_0x5ba4ec=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1b9)]],_0x223676=[_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x208)]],_0x2aa4cc=[_0x11ae90[_0x462fb9(0x1bb)]['floorlevel']];else var _0x412997=[..._0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1cb)]],_0x55288f=[..._0x11ae90['body'][_0x462fb9(0x14c)]],_0x215401=[..._0x11ae90[_0x462fb9(0x1bb)]['secondary_code']],_0x5241ad=[..._0x11ae90[_0x462fb9(0x1bb)]['product_code']],_0x2c0899=[..._0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1ef)]],_0x32e380=[..._0x11ae90['body']['stocks']],_0x159a7c=[..._0x11ae90[_0x462fb9(0x1bb)]['return_qty']],_0x164a93=[..._0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x18c)]],_0x5ba4ec=[..._0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1b9)]],_0x223676=[..._0x11ae90[_0x462fb9(0x1bb)]['types']],_0x2aa4cc=[..._0x11ae90['body'][_0x462fb9(0x1d2)]];const _0x3d222a=_0x412997['map'](_0xa5c6ab=>{return _0xa5c6ab={'product_name':_0xa5c6ab};});_0x55288f[_0x462fb9(0x132)]((_0x1190f2,_0x100cce)=>{var _0x230329=_0x462fb9;_0x3d222a[_0x100cce][_0x230329(0x14c)]=_0x1190f2;}),_0x215401[_0x462fb9(0x132)]((_0xa0432d,_0x1121ab)=>{var _0x437b91=_0x462fb9;_0x3d222a[_0x1121ab][_0x437b91(0x142)]=_0xa0432d;}),_0x5241ad['forEach']((_0x276224,_0xd0116d)=>{var _0x517f6f=_0x462fb9;_0x3d222a[_0xd0116d][_0x517f6f(0x16d)]=_0x276224;}),_0x2c0899[_0x462fb9(0x132)]((_0x420a71,_0x1da361)=>{var _0x3b705f=_0x462fb9;_0x3d222a[_0x1da361][_0x3b705f(0x1ec)]=_0x420a71;}),_0x32e380[_0x462fb9(0x132)]((_0x459dc6,_0xcbe2a)=>{_0x3d222a[_0xcbe2a]['stock']=_0x459dc6;}),_0x159a7c[_0x462fb9(0x132)]((_0x4ab05f,_0x36abf6)=>{_0x3d222a[_0x36abf6]['return_qty']=_0x4ab05f;}),_0x164a93[_0x462fb9(0x132)]((_0x293c9b,_0x591223)=>{_0x3d222a[_0x591223]['bay']=_0x293c9b;}),_0x5ba4ec[_0x462fb9(0x132)]((_0x1af103,_0x111686)=>{_0x3d222a[_0x111686]['bin']=_0x1af103;}),_0x223676['forEach']((_0x4eea48,_0x4cc5b6)=>{_0x3d222a[_0x4cc5b6]['type']=_0x4eea48;}),_0x2aa4cc[_0x462fb9(0x132)]((_0x75d43b,_0x5c43ce)=>{_0x3d222a[_0x5c43ce]['floorlevel']=_0x75d43b;});var _0x1891aa=0x0;_0x3d222a['forEach'](_0x2ac1ad=>{var _0x371d62=_0x462fb9;console[_0x371d62(0x11d)](_0x371d62(0x11c),_0x2ac1ad),(parseInt(_0x2ac1ad[_0x371d62(0x1ec)])<parseInt(_0x2ac1ad[_0x371d62(0x1af)])||parseInt(_0x2ac1ad[_0x371d62(0x1a8)])<parseInt(_0x2ac1ad[_0x371d62(0x1af)])&&parseInt(_0x2ac1ad['sale_qty'])>parseInt(_0x2ac1ad[_0x371d62(0x1af)])||parseInt(_0x2ac1ad[_0x371d62(0x1af)])==0x0)&&_0x1891aa++;});if(_0x1891aa!=0x0)return _0x11ae90[_0x462fb9(0x20a)]('errors',_0x462fb9(0x204)),_0x14aaa2[_0x462fb9(0x1b4)](_0x462fb9(0x1ea));const _0x39fd86=await sales[_0x462fb9(0x21a)]({'invoice':_0x4f68ad});console['log'](_0x39fd86),_0x39fd86[_0x462fb9(0x1ae)]=_0x462fb9(0x198);const _0xfbcf0f=await _0x39fd86[_0x462fb9(0x1f5)](),_0xa79b80=new sales_return({'invoice':_0x4f68ad,'customer':_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1c6)],'date':_0x4a971e,'warehouse_name':_0x13aa5c,'room':_0x3a154c,'ToWarehouse':_0xaff6ec,'ToRoom':_0x1cf336,'return_sale':_0x3d222a,'note':_0x4d62df}),_0x33ffc5=await _0xa79b80[_0x462fb9(0x1f5)]();console[_0x462fb9(0x11d)](_0xa79b80);const _0x25fe80=await sales_return[_0x462fb9(0x21a)]({'invoice':_0x4f68ad}),_0x3708f8=await warehouse[_0x462fb9(0x21a)]({'name':_0xaff6ec,'room':_0x1cf336});_0x25fe80[_0x462fb9(0x1f8)][_0x462fb9(0x132)](_0x753ae0=>{var _0x32724f=_0x462fb9,_0x139be0=0x0;const _0x513b0c=_0x3708f8[_0x32724f(0x140)][_0x32724f(0x127)](_0x7b89cd=>{var _0x27d44d=_0x32724f;_0x7b89cd[_0x27d44d(0x1cb)]==_0x753ae0[_0x27d44d(0x1cb)]&&_0x7b89cd[_0x27d44d(0x1d2)]==_0x753ae0[_0x27d44d(0x1d2)]&&_0x7b89cd[_0x27d44d(0x1a5)]==_0x753ae0['type']&&_0x7b89cd['bin']==_0x753ae0[_0x27d44d(0x1b9)]&&_0x7b89cd['bay']==_0x753ae0[_0x27d44d(0x18c)]&&(_0x7b89cd[_0x27d44d(0x20b)]=parseInt(_0x7b89cd[_0x27d44d(0x20b)])+parseInt(_0x753ae0['return_qty']),_0x139be0++);});_0x139be0=='0'&&(_0x3708f8[_0x32724f(0x140)]=_0x3708f8[_0x32724f(0x140)][_0x32724f(0x1de)]({'product_name':_0x753ae0['product_name'],'product_stock':_0x753ae0[_0x32724f(0x1af)],'primary_code':_0x753ae0[_0x32724f(0x14c)],'secondary_code':_0x753ae0['secondary_code'],'product_code':_0x753ae0[_0x32724f(0x16d)],'bay':_0x753ae0[_0x32724f(0x18c)],'bin':_0x753ae0[_0x32724f(0x1b9)],'type':_0x753ae0[_0x32724f(0x1a5)],'floorlevel':_0x753ae0[_0x32724f(0x1d2)]})),console[_0x32724f(0x11d)]('final',_0x3708f8);}),await _0x3708f8[_0x462fb9(0x1f5)](),console[_0x462fb9(0x11d)](_0x11ae90[_0x462fb9(0x1bb)]);const _0x30d3c8=new c_payment_data({'invoice':_0x4f68ad,'customer':_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1c6)],'reason':_0x462fb9(0x159)});await _0x30d3c8[_0x462fb9(0x1f5)]();const _0x3fffeb=await master_shop[_0x462fb9(0x1a7)]();console[_0x462fb9(0x11d)](_0x462fb9(0x13f),_0x3fffeb[0x0]['image']);const _0x2ac2a6=await email_settings[_0x462fb9(0x21a)](),_0x130ccb=await customer[_0x462fb9(0x21a)]({'name':_0x11ae90[_0x462fb9(0x1bb)][_0x462fb9(0x1c6)]});console[_0x462fb9(0x11d)](_0x462fb9(0x1e3),_0x130ccb);_0x3fffeb[0x0][_0x462fb9(0x192)]==0x1?(right_currency=_0x3fffeb[0x0][_0x462fb9(0x167)],left_currency=''):(right_currency='',left_currency=_0x3fffeb[0x0][_0x462fb9(0x167)]);var _0x30fdbd=_0x412997,_0x1534f1=_0x159a7c,_0x3d9713='',_0x40afab;for(_0x40afab in _0x30fdbd){_0x3d9713+=_0x462fb9(0x19e)+_0x462fb9(0x181)+_0x30fdbd[_0x40afab]+_0x462fb9(0x14a)+_0x462fb9(0x181)+_0x1534f1[_0x40afab]+'</td>'+_0x462fb9(0x1f0);}console[_0x462fb9(0x11d)]('product_list',_0x3d9713);let _0x90f42c=nodemailer[_0x462fb9(0x15b)]({'service':'gmail','auth':{'user':_0x2ac2a6[_0x462fb9(0x174)],'pass':_0x2ac2a6['password']}}),_0x344961={'from':_0x2ac2a6['email'],'to':_0x130ccb[_0x462fb9(0x174)],'subject':_0x462fb9(0x1c3),'attachments':[{'filename':_0x462fb9(0x199),'path':__dirname+_0x462fb9(0x149)+_0x462fb9(0x179)+_0x3fffeb[0x0]['image'],'cid':_0x462fb9(0x185)}],'html':_0x462fb9(0x20c)+'<html><head><title></title>'+_0x462fb9(0x11e)+_0x462fb9(0x1d5)+_0x462fb9(0x146)+'<div>'+_0x462fb9(0x1d0)+'</div>'+'<div>'+_0x462fb9(0x20e)+_0x3fffeb[0x0][_0x462fb9(0x1cd)]+_0x462fb9(0x1fb)+_0x462fb9(0x153)+'</div>'+_0x462fb9(0x1a9)+_0x462fb9(0x1d5)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x462fb9(0x183)+_0x4f68ad+'\x20'+_0x462fb9(0x134)+_0x462fb9(0x156)+_0x4a971e+'\x20'+_0x462fb9(0x124)+_0x462fb9(0x175)+_0x462fb9(0x153)+_0x462fb9(0x1f3)+_0x462fb9(0x1d4)+'<tr>'+_0x462fb9(0x1ce)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x462fb9(0x1dd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+_0x462fb9(0x173)+'\x20'+_0x3d9713+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x462fb9(0x138)+_0x462fb9(0x191)+_0x3fffeb[0x0][_0x462fb9(0x1cd)]+_0x462fb9(0x175)+_0x462fb9(0x153)+_0x462fb9(0x153)+_0x462fb9(0x17c)};_0x90f42c['sendMail'](_0x344961,function(_0x88898b,_0x5b0b81){var _0x302878=_0x462fb9;_0x88898b?(console[_0x302878(0x11d)](_0x88898b),console[_0x302878(0x11d)](_0x302878(0x136))):console[_0x302878(0x11d)]('Email\x20sent\x20successfully');}),_0x11ae90['flash'](_0x462fb9(0x1a4),_0x462fb9(0x18e)),_0x14aaa2[_0x462fb9(0x1b4)](_0x462fb9(0x203));}catch(_0x1becbe){console[_0x462fb9(0x11d)](_0x1becbe),_0x14aaa2[_0x462fb9(0x17b)](0xc8)[_0x462fb9(0x162)]({'message1':_0x1becbe[_0x462fb9(0x122)]});}}),router[a0_0x5b7236(0x126)]('/barcode/:id',auth,async(_0x5e6f54,_0x10bccc)=>{var _0x318b48=a0_0x5b7236;try{const {username:_0x2a7e4b,email:_0x314b02,role:_0x5f375f}=_0x5e6f54[_0x318b48(0x12d)],_0x170bf5=_0x5e6f54[_0x318b48(0x12d)],_0x1fb646=await profile['findOne']({'email':_0x170bf5['email']}),_0x472fbc=await master_shop['find']();console[_0x318b48(0x11d)](_0x318b48(0x176),_0x472fbc);const _0x83e474=_0x5e6f54[_0x318b48(0x11b)]['id'],_0x5e5094=await sales[_0x318b48(0x1da)](_0x83e474);console[_0x318b48(0x11d)](_0x318b48(0x12a),_0x5e5094);if(_0x472fbc[0x0]['language']=='English\x20(US)')var _0x26f767=users['English'];else{if(_0x472fbc[0x0][_0x318b48(0x157)]==_0x318b48(0x194))var _0x26f767=users['Hindi'];else{if(_0x472fbc[0x0][_0x318b48(0x157)]==_0x318b48(0x164))var _0x26f767=users[_0x318b48(0x164)];else{if(_0x472fbc[0x0][_0x318b48(0x157)]==_0x318b48(0x1a1))var _0x26f767=users[_0x318b48(0x1a1)];else{if(_0x472fbc[0x0]['language']=='French')var _0x26f767=users[_0x318b48(0x15d)];else{if(_0x472fbc[0x0][_0x318b48(0x157)]=='Portuguese\x20(BR)')var _0x26f767=users[_0x318b48(0x154)];else{if(_0x472fbc[0x0]['language']==_0x318b48(0x1c4))var _0x26f767=users[_0x318b48(0x1c4)];else{if(_0x472fbc[0x0][_0x318b48(0x157)]==_0x318b48(0x130))var _0x26f767=users[_0x318b48(0x177)];}}}}}}}_0x10bccc[_0x318b48(0x1db)](_0x318b48(0x15c),{'success':_0x5e6f54[_0x318b48(0x20a)](_0x318b48(0x1a4)),'errors':_0x5e6f54[_0x318b48(0x20a)](_0x318b48(0x1d9)),'role':_0x170bf5,'profile':_0x1fb646,'alldata':_0x5e5094,'master_shop':_0x472fbc,'language':_0x26f767});}catch(_0x41b584){console['log'](_0x41b584);}}),router['post'](a0_0x5b7236(0x1e4),async(_0x2f8108,_0x48dc0a)=>{var _0x3b0a90=a0_0x5b7236;const {product_code:_0x46770c,warehouse_name:_0x4bcad3,rooms_data:_0x51a10b,Roomslist:_0x16ff24}=_0x2f8108[_0x3b0a90(0x1bb)],_0x3810c0=_0x16ff24[_0x3b0a90(0x1e7)](','),_0x58bb85=[];async function _0x452d1a(_0xf0e12d){var _0x165969=_0x3b0a90;const _0x4f0bd1=await warehouse['aggregate']([{'$match':{'name':_0x4bcad3,'room':_0xf0e12d}},{'$unwind':_0x165969(0x160)},{'$match':{'product_details.primary_code':_0x46770c}},{'$group':{'_id':_0x165969(0x121),'name':{'$first':_0x165969(0x16b)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x165969(0x170)},'secondary_code':{'$first':_0x165969(0x1fc)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x165969(0x1ff)},'isle':{'$first':_0x165969(0x1f9)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x165969(0x178)},'secondary_unit':{'$first':_0x165969(0x1c1)},'storage':{'$first':_0x165969(0x1fd)},'rack':{'$first':_0x165969(0x1df)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x165969(0x15f)},'maxPerUnit':{'$first':_0x165969(0x186)},'batch_code':{'$first':_0x165969(0x163)},'product_cat':{'$first':_0x165969(0x20d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x165969(0x21e)},'invoice':{'$first':_0x165969(0x214)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'},'delivery_date':{'$first':_0x165969(0x1e8)},'delivery_code':{'$first':_0x165969(0x1ac)}}}]),_0x49fb00=await warehouse[_0x165969(0x18d)]([{'$match':{'name':_0x4bcad3,'room':_0xf0e12d}},{'$unwind':_0x165969(0x160)},{'$match':{'product_details.secondary_code':_0x46770c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x165969(0x16b)},'product_stock':{'$first':_0x165969(0x21d)},'primary_code':{'$first':_0x165969(0x170)},'secondary_code':{'$first':_0x165969(0x1fc)},'product_code':{'$first':_0x165969(0x1ca)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x165969(0x11f)},'pallet':{'$first':_0x165969(0x17f)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x165969(0x1c1)},'storage':{'$first':_0x165969(0x1fd)},'rack':{'$first':_0x165969(0x1df)},'expiry_date':{'$first':_0x165969(0x1b1)},'production_date':{'$first':_0x165969(0x15f)},'maxPerUnit':{'$first':_0x165969(0x186)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x165969(0x20d)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x165969(0x21e)},'invoice':{'$first':_0x165969(0x214)},'delivery_date':{'$first':_0x165969(0x1e8)},'delivery_code':{'$first':_0x165969(0x1ac)}}}]);if(_0x4f0bd1[_0x165969(0x19b)]>0x0)_0x58bb85[_0x165969(0x143)](_0x4f0bd1);else _0x49fb00[_0x165969(0x19b)]>0x0&&_0x58bb85[_0x165969(0x143)](_0x49fb00);}const _0x8baf51=_0x3810c0[_0x3b0a90(0x127)](_0x81452c=>_0x452d1a(_0x81452c));await Promise['all'](_0x8baf51),_0x48dc0a[_0x3b0a90(0x162)](_0x58bb85);}),module['exports']=router;