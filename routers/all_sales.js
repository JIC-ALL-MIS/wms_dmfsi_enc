function a0_0x331e(){var _0xfbff21=['<strong>\x20Regards\x20</strong>','render','bin','password','Error\x20Occurs','save','delivery_date','/barcode/:id','product_stock','add\x20post','prod_cat','True','foreach\x20newproduct','id_transaction_from','error','$isAllowEdit','$product_details.invoice','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','edit_sales_view','stocks','$product_details.maxPerUnit','purchases_data','Return\x20Goods','date','Ambient','/../public','unit','$_id','storage','primary_unit','sales_invoice','OUT-','<h5\x20style=\x22text-align:\x20left;\x22>','sales\x20item\x20return\x20successfull','$sale_product.bay','</tr>','Logo.png','Portuguese','finalize','RoomAssigned','post','name','batch_code','/view','Receiving\x20Area','status','Level','concat','$product_details.bin','types','room_name','find','Shelves','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<div>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.secondary_code','all_sales','string','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Portuguese\x20(BR)','$product_details.product_cat','forEach','Raw\x20Materials','add_sales','get','Arabic','return_qty','warehouse','$product_details.isle','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</span>','/give_payment/:id','length','sales\x20all_data','staff','$room','findOne','return_data','currency_placement','product_details','</body></html>','</div>','$product_details.bay','/all_sales/view','$sale_product.bin','$product_details.storage','\x20Order\x20Date\x20:\x20','product_name','_id','body','$product_details.unit','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/all_sales/preview/','abs','$product','False','$warehouse_name','$sale_product.quantity','Email\x20sent\x20successfully','email','amount','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.product_name','filter','level','Arabic\x20(ae)','/invoice/:id','bay','product_code','prod_code','all_sales_barcode','Chinese','$product_details','<h2>\x20','$finalize','<h5>','customer','Sale\x20Return\x20Mail','$product_details.product_stock','quantity_notConverted','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Hindi','$note','German','An\x20error\x20occurred\x20while\x20saving\x20data.','createTransport','flash','push','max_per_unit','role','toString','$product_details.level','SCRN','customers','delivery_code','5173ecJeQN','getDate','/view/:id','message','sendMail','language','catch','</head><body>','</tbody>','Sales\x20Mail','$sale_product.type','errors','<tr>','production_date','</td>','warehouse_name','product_data','$product_details.floorlevel','secondary_code','English\x20(US)','all','$sale_product','Return\x20Rooms','product_list','$product_details.expiry_date','floorlevel','aggregate','random','$sale_product.floorlevel','$product_details.product_code','image','actual_qty','barcode\x20user_id','3ThPzks','/view/add_sales','564108VvJqyk','user','1208rQtSeJ','customers_docs','site_title','findById','log','Router','host','\x20Order\x20Number\x20:\x20','Floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Received\x20Payment\x20For\x20Sale','295160GjrhQF','logo','primary_code','json','master','$product_details._id','stock','There\x27s\x20a\x20error\x20in\x20this\x20transaction','quantity','received_amount','prod_invoice','/upload/','return_sale','stock_data','sale_product','Sales\x20Update\x20successfully','$product_details.primary_code','$product_details.actual_uom','1554710PJDcgv','sale_qty','<tbody\x20style=\x22text-align:\x20center;\x22>','maxperunit','Enclosed','$customers_docs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.rack','Enabled','carton','414YzROQc','invoice','payment\x20successfull','currency','French','requested_qty','395768lVGqgY','sales_quantity','padStart','actual_uom','id_transact','split','../public/language/languages.json','Sale\x20Return','getFullYear','<!DOCTYPE\x20html>','$name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view/add_sale/product','<hr\x20class=\x22my-3\x22>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20</h2>','/barcode_scanner','$product_details.batch_code','$product_details.secondary_unit','type','</table>','Sales\x20Add\x20successfully','302497KSOffH','expiry_date','Spanish','$customer','redirect','floor','<html><head><title></title>','params','then','</thead>','/view/return_sales/:id','RMSEmail','final','$product_details.type','$product_details.actual_qty','English','$invoice','slice','1593084sOaFZM','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','map','port','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product','<span\x20style=\x22float:\x20right;\x22>','../middleware/auth'];a0_0x331e=function(){return _0xfbff21;};return a0_0x331e();}var a0_0x3c7a7a=a0_0xf101;function a0_0xf101(_0x289b7f,_0x58db1c){var _0x331eba=a0_0x331e();return a0_0xf101=function(_0xf1011b,_0x48aefb){_0xf1011b=_0xf1011b-0x1dc;var _0x22a5d3=_0x331eba[_0xf1011b];return _0x22a5d3;},a0_0xf101(_0x289b7f,_0x58db1c);}(function(_0x2d471,_0x2e90f5){var _0x349714=a0_0xf101,_0x1b1bcd=_0x2d471();while(!![]){try{var _0x291d53=-parseInt(_0x349714(0x268))/0x1+parseInt(_0x349714(0x252))/0x2*(parseInt(_0x349714(0x221))/0x3)+-parseInt(_0x349714(0x223))/0x4+-parseInt(_0x349714(0x242))/0x5+-parseInt(_0x349714(0x27a))/0x6+-parseInt(_0x349714(0x200))/0x7*(parseInt(_0x349714(0x225))/0x8)+parseInt(_0x349714(0x24c))/0x9*(parseInt(_0x349714(0x230))/0xa);if(_0x291d53===_0x2e90f5)break;else _0x1b1bcd['push'](_0x1b1bcd['shift']());}catch(_0x6610b7){_0x1b1bcd['push'](_0x1b1bcd['shift']());}}}(a0_0x331e,0x67873));const express=require('express'),app=express(),router=express[a0_0x3c7a7a(0x22a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3c7a7a(0x282)),nodemailer=require(a0_0x3c7a7a(0x294)),users=require(a0_0x3c7a7a(0x258));router[a0_0x3c7a7a(0x2c6)](a0_0x3c7a7a(0x2af),auth,async(_0x35037e,_0x12d465)=>{var _0xd82d42=a0_0x3c7a7a;try{const {username:_0x35ec41,email:_0x52c919,role:_0x383923}=_0x35037e[_0xd82d42(0x224)],_0x36c08c=_0x35037e['user'],_0x4eca3=await profile[_0xd82d42(0x2d3)]({'email':_0x36c08c['email']}),_0x206fce=await master_shop[_0xd82d42(0x2b7)]();let _0x40f64e;if(_0x36c08c[_0xd82d42(0x1fa)]==_0xd82d42(0x2d1)){const _0x213f17=await staff['findOne']({'email':_0x36c08c['email']});_0x40f64e=await sales['aggregate']([{'$lookup':{'from':_0xd82d42(0x1fe),'localField':_0xd82d42(0x1ed),'foreignField':_0xd82d42(0x2ad),'as':_0xd82d42(0x226)}},{'$unwind':'$customers_docs'},{'$unwind':_0xd82d42(0x215)},{'$group':{'_id':_0xd82d42(0x29f),'invoice':{'$first':_0xd82d42(0x278)},'customers':{'$first':_0xd82d42(0x26b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xd82d42(0x2e8)},'sale_product':{'$push':_0xd82d42(0x215)},'note':{'$first':_0xd82d42(0x1f3)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0xd82d42(0x247)},'total_saleproduct_quantity':{'$sum':_0xd82d42(0x2e9)},'level':{'$addToSet':_0xd82d42(0x2a6)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0xd82d42(0x21c)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0xd82d42(0x292)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x40f64e=await sales[_0xd82d42(0x21a)]([{'$lookup':{'from':_0xd82d42(0x1fe),'localField':'customer','foreignField':_0xd82d42(0x2ad),'as':_0xd82d42(0x226)}},{'$unwind':'$customers_docs'},{'$unwind':_0xd82d42(0x215)},{'$group':{'_id':_0xd82d42(0x29f),'invoice':{'$first':_0xd82d42(0x278)},'customers':{'$first':_0xd82d42(0x26b)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0xd82d42(0x215)},'note':{'$first':_0xd82d42(0x1f3)},'return_data':{'$first':_0xd82d42(0x2cb)},'customers_docs':{'$first':_0xd82d42(0x247)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0xd82d42(0x2a6)},'isle':{'$addToSet':_0xd82d42(0x2db)},'type':{'$addToSet':_0xd82d42(0x20a)},'pallet':{'$addToSet':_0xd82d42(0x21c)},'finalize':{'$first':_0xd82d42(0x1eb)},'isAllowEdit':{'$first':_0xd82d42(0x292)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0xd82d42(0x229)](_0xd82d42(0x2d0),_0x40f64e);if(_0x206fce[0x0][_0xd82d42(0x205)]==_0xd82d42(0x213)){var _0x4741a2=users[_0xd82d42(0x277)];console[_0xd82d42(0x229)](_0x4741a2);}else{if(_0x206fce[0x0][_0xd82d42(0x205)]==_0xd82d42(0x1f2))var _0x4741a2=users['Hindi'];else{if(_0x206fce[0x0]['language']==_0xd82d42(0x1f4))var _0x4741a2=users[_0xd82d42(0x1f4)];else{if(_0x206fce[0x0]['language']=='Spanish')var _0x4741a2=users['Spanish'];else{if(_0x206fce[0x0][_0xd82d42(0x205)]==_0xd82d42(0x250))var _0x4741a2=users[_0xd82d42(0x250)];else{if(_0x206fce[0x0][_0xd82d42(0x205)]==_0xd82d42(0x2c1))var _0x4741a2=users[_0xd82d42(0x2a9)];else{if(_0x206fce[0x0][_0xd82d42(0x205)]==_0xd82d42(0x1e8))var _0x4741a2=users[_0xd82d42(0x1e8)];else{if(_0x206fce[0x0][_0xd82d42(0x205)]=='Arabic\x20(ae)')var _0x4741a2=users[_0xd82d42(0x2c7)];}}}}}}}_0x12d465[_0xd82d42(0x284)](_0xd82d42(0x2be),{'success':_0x35037e[_0xd82d42(0x1f7)](_0xd82d42(0x27b)),'errors':_0x35037e[_0xd82d42(0x1f7)]('errors'),'sales':_0x40f64e,'profile':_0x4eca3,'role':_0x36c08c,'master_shop':_0x206fce,'language':_0x4741a2});}catch(_0x40735d){console['log'](_0x40735d);}});async function getRandom8DigitNumber(){var _0x4f6199=a0_0x3c7a7a;const _0x5cbd3a=0x989680,_0xb36f63=0x5f5e0ff,_0x42bd0b=Math[_0x4f6199(0x26d)](Math[_0x4f6199(0x21b)]()*(_0xb36f63-_0x5cbd3a+0x1))+_0x5cbd3a;var _0x44b15e;const _0x27b766=await sales[_0x4f6199(0x2d3)]({'invoice':_0x4f6199(0x2a3)+_0x42bd0b});return _0x27b766&&_0x27b766[_0x4f6199(0x2cf)]>0x0?_0x44b15e=_0x4f6199(0x2a3)+_0x42bd0b:_0x44b15e=_0x4f6199(0x2a3)+_0x42bd0b,_0x44b15e;}router['get']('/view/add_sales',auth,async(_0x56ebb7,_0x3332ff)=>{var _0x31ac02=a0_0x3c7a7a;try{const {username:_0xeb9762,email:_0x531667,role:_0x1dc2c6}=_0x56ebb7[_0x31ac02(0x224)],_0x22d90f=_0x56ebb7[_0x31ac02(0x224)],_0x2027db=await profile[_0x31ac02(0x2d3)]({'email':_0x22d90f[_0x31ac02(0x2eb)]}),_0x3e3cf0=await master_shop[_0x31ac02(0x2b7)](),_0x3c9593=await customer[_0x31ac02(0x2b7)]({});let _0x5c4126;if(_0x22d90f[_0x31ac02(0x1fa)]==_0x31ac02(0x2d1)){const _0x5d5deb=await staff[_0x31ac02(0x2d3)]({'email':_0x22d90f[_0x31ac02(0x2eb)]});_0x5c4126=await warehouse['aggregate']([{'$match':{'status':_0x31ac02(0x24a),'name':_0x5d5deb['warehouse'],'warehouse_category':_0x31ac02(0x2c4),'name':{'$ne':_0x31ac02(0x29a)}}},{'$group':{'_id':'$name','name':{'$first':_0x31ac02(0x25c)}}},{'$sort':{'name':0x1}}]);}else _0x5c4126=await warehouse['aggregate']([{'$match':{'status':_0x31ac02(0x24a),'warehouse_category':_0x31ac02(0x2c4),'name':{'$ne':_0x31ac02(0x29a)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x5c68cd=await product[_0x31ac02(0x2b7)]({});var _0x5093e7=[_0x31ac02(0x29c),_0x31ac02(0x246)];const _0x925239=await sales[_0x31ac02(0x2b7)]({}),_0x1e8318=_0x925239['length']+0x1,_0x4ae154='OUT-'+_0x1e8318[_0x31ac02(0x1fb)]()[_0x31ac02(0x254)](0x5,'0');if(_0x3e3cf0[0x0][_0x31ac02(0x205)]==_0x31ac02(0x213)){var _0x4d4c7b=users[_0x31ac02(0x277)];console[_0x31ac02(0x229)](_0x4d4c7b);}else{if(_0x3e3cf0[0x0]['language']==_0x31ac02(0x1f2))var _0x4d4c7b=users[_0x31ac02(0x1f2)];else{if(_0x3e3cf0[0x0]['language']=='German')var _0x4d4c7b=users[_0x31ac02(0x1f4)];else{if(_0x3e3cf0[0x0][_0x31ac02(0x205)]==_0x31ac02(0x26a))var _0x4d4c7b=users[_0x31ac02(0x26a)];else{if(_0x3e3cf0[0x0][_0x31ac02(0x205)]==_0x31ac02(0x250))var _0x4d4c7b=users['French'];else{if(_0x3e3cf0[0x0]['language']==_0x31ac02(0x2c1))var _0x4d4c7b=users[_0x31ac02(0x2a9)];else{if(_0x3e3cf0[0x0][_0x31ac02(0x205)]==_0x31ac02(0x1e8))var _0x4d4c7b=users[_0x31ac02(0x1e8)];else{if(_0x3e3cf0[0x0][_0x31ac02(0x205)]==_0x31ac02(0x1e2))var _0x4d4c7b=users[_0x31ac02(0x2c7)];}}}}}}}const _0x16d9be=getRandom8DigitNumber();_0x16d9be[_0x31ac02(0x270)](_0x87e95=>{var _0x3f36dc=_0x31ac02;_0x3332ff[_0x3f36dc(0x284)](_0x3f36dc(0x2c5),{'success':_0x56ebb7[_0x3f36dc(0x1f7)](_0x3f36dc(0x27b)),'errors':_0x56ebb7[_0x3f36dc(0x1f7)]('errors'),'role':_0x22d90f,'profile':_0x2027db,'customer':_0x3c9593,'warehouse':_0x5c4126,'product':_0x5c68cd,'invoice':_0x87e95,'master_shop':_0x3e3cf0,'language':_0x4d4c7b,'rooms_data':_0x5093e7});})[_0x31ac02(0x206)](_0x481fd2=>{var _0x1a25e5=_0x31ac02;_0x56ebb7[_0x1a25e5(0x1f7)](_0x1a25e5(0x20b),_0x1a25e5(0x237)),_0x3332ff[_0x1a25e5(0x26c)](_0x1a25e5(0x2da));});}catch(_0x503f0e){console[_0x31ac02(0x229)](_0x503f0e);}}),router[a0_0x3c7a7a(0x2c6)]('/view/add_sales/:id',auth,async(_0x282e15,_0x186224)=>{var _0x347ca2=a0_0x3c7a7a;try{const _0x255095=_0x282e15[_0x347ca2(0x26f)]['id'];console[_0x347ca2(0x229)](_0x255095);const _0x344621=await product['find'](),_0x2e8663=await purchases[_0x347ca2(0x21a)]([{'$match':{'warehouse_name':_0x255095}},{'$unwind':_0x347ca2(0x2e6)},{'$group':{'_id':'$product.product_name'}}]);console[_0x347ca2(0x229)](_0x347ca2(0x299),_0x2e8663),_0x186224[_0x347ca2(0x2b1)](0xc8)[_0x347ca2(0x233)]({'purchases_data':_0x2e8663,'product_data':_0x344621});}catch(_0x5ece69){console[_0x347ca2(0x229)](_0x5ece69);}}),router[a0_0x3c7a7a(0x2ac)](a0_0x3c7a7a(0x25e),auth,async(_0x37ca58,_0x12ef7c)=>{var _0xdb1071=a0_0x3c7a7a;try{const {warehouse_data:_0xbba2cf,product_data:_0x36e7e5}=_0x37ca58[_0xdb1071(0x2e0)];console[_0xdb1071(0x229)](_0x37ca58[_0xdb1071(0x2e0)][_0xdb1071(0x210)]);;const _0x4e9185=await master_shop[_0xdb1071(0x2b7)]();console[_0xdb1071(0x229)](_0xdb1071(0x234),_0x4e9185);const _0x7c017e=await product['findOne']({'name':_0x36e7e5});console[_0xdb1071(0x229)](_0xdb1071(0x280),_0x7c017e);const _0x248542=await warehouse[_0xdb1071(0x21a)]([{'$match':{'name':_0xbba2cf}},{'$unwind':_0xdb1071(0x1e9)},{'$match':{'product_details.product_name':_0x36e7e5}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0xdb1071(0x229)](_0xdb1071(0x23d),_0x248542),_0x12ef7c[_0xdb1071(0x2b1)](0xc8)[_0xdb1071(0x233)]({'master':_0x4e9185,'new_product':_0x7c017e,'stock_data':_0x248542});}catch(_0x527d16){console[_0xdb1071(0x229)](_0x527d16);}}),router['post'](a0_0x3c7a7a(0x222),auth,async(_0x400e44,_0x2d510e)=>{var _0x367011=a0_0x3c7a7a;try{const {invoice:_0x442411,date:_0x16b4ff,warehouse_name:_0x3ac201,product_name:_0x20b0dc,stock:_0x1393e5,quantity:_0x1e2681,note:_0x11cac9,room:_0x2eeb41,primary_code:_0x3279b1,secondary_code:_0x111b34,prod_code:_0x13b6b2,level:_0x584510,isle:_0x4903c7,pallet:_0x5354f4,batch_code:_0x502ebb,SCRN:_0x5ceada,expiry_date:_0x258712}=_0x400e44[_0x367011(0x2e0)];if(typeof _0x20b0dc==_0x367011(0x2bf))var _0x4a6806=[_0x400e44['body'][_0x367011(0x2de)]],_0x3a1781=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x236)]],_0x536591=[_0x400e44[_0x367011(0x2e0)]['carton']],_0x43f354=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x232)]],_0x12404e=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x212)]],_0x4bd03e=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x1e6)]],_0x10d2c8=[_0x400e44['body'][_0x367011(0x1e1)]],_0x4e64f2=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x2a1)]],_0x49f415=[_0x400e44[_0x367011(0x2e0)]['secondary_unit']],_0x2002a5=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x2ae)]],_0x1c2fbf=[_0x400e44['body']['expiry_date']],_0x28c18a=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x1f9)]],_0x2d39b9=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x20d)]],_0x2ae0d6=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x251)]],_0x4edd2a=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x289)]],_0x1c7079=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x1ff)]],_0x29df6a=[_0x400e44['body'][_0x367011(0x28d)]],_0x59106b=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x238)]],_0x3214ed=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x2ab)]],_0x4f4b17=[_0x400e44['body'][_0x367011(0x23a)]],_0x46225e=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x21f)]],_0x3ea920=[_0x400e44[_0x367011(0x2e0)][_0x367011(0x255)]],_0x276dbb=[_0x400e44['body']['id_transact']];else var _0x4a6806=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x2de)]],_0x3a1781=[..._0x400e44[_0x367011(0x2e0)]['stock']],_0x536591=[..._0x400e44['body']['carton']],_0x43f354=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x232)]],_0x12404e=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x212)]],_0x4bd03e=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x1e6)]],_0x10d2c8=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x1e1)]],_0x4e64f2=[..._0x400e44['body'][_0x367011(0x2a1)]],_0x49f415=[..._0x400e44[_0x367011(0x2e0)]['secondary_unit']],_0x2002a5=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x2ae)]],_0x1c2fbf=[..._0x400e44[_0x367011(0x2e0)]['expiry_date']],_0x28c18a=[..._0x400e44[_0x367011(0x2e0)]['max_per_unit']],_0x2d39b9=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x20d)]],_0x2ae0d6=[..._0x400e44[_0x367011(0x2e0)]['requested_qty']],_0x4edd2a=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x289)]],_0x1c7079=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x1ff)]],_0x29df6a=[..._0x400e44[_0x367011(0x2e0)]['prod_cat']],_0x59106b=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x238)]],_0x3214ed=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x2ab)]],_0x4f4b17=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x23a)]],_0x46225e=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x21f)]],_0x3ea920=[..._0x400e44[_0x367011(0x2e0)][_0x367011(0x255)]],_0x276dbb=[..._0x400e44['body'][_0x367011(0x256)]];const _0x3bbd61=_0x4a6806[_0x367011(0x27d)](_0x50917b=>{return _0x50917b={'product_name':_0x50917b};});_0x3a1781['forEach']((_0x4247a4,_0x30a0db)=>{var _0xc1f99a=_0x367011;_0x3bbd61[_0x30a0db][_0xc1f99a(0x236)]=Math[_0xc1f99a(0x2e5)](_0x4247a4);}),_0x46225e[_0x367011(0x2c3)]((_0x189899,_0x3a8457)=>{var _0x4fc61d=_0x367011;_0x3bbd61[_0x3a8457][_0x4fc61d(0x21f)]=Math['abs'](_0x189899);}),_0x3ea920[_0x367011(0x2c3)]((_0x2f6a9f,_0x1879ec)=>{var _0x8dc38e=_0x367011;_0x3bbd61[_0x1879ec][_0x8dc38e(0x255)]=_0x2f6a9f;}),_0x276dbb[_0x367011(0x2c3)]((_0x5f5ce0,_0x4a40ab)=>{var _0x1e608a=_0x367011;_0x3bbd61[_0x4a40ab][_0x1e608a(0x290)]=_0x5f5ce0;}),_0x536591[_0x367011(0x2c3)]((_0x125884,_0x49409f)=>{var _0x203690=_0x367011;_0x3bbd61[_0x49409f][_0x203690(0x238)]=_0x125884;}),_0x43f354[_0x367011(0x2c3)]((_0x396422,_0x45a2be)=>{var _0x335aa9=_0x367011;_0x3bbd61[_0x45a2be][_0x335aa9(0x232)]=_0x396422;}),_0x12404e[_0x367011(0x2c3)]((_0x4a0844,_0x14fffa)=>{var _0x445f48=_0x367011;_0x3bbd61[_0x14fffa][_0x445f48(0x212)]=_0x4a0844;}),_0x4bd03e[_0x367011(0x2c3)]((_0x265068,_0x5f3f6b)=>{var _0x2032a3=_0x367011;_0x3bbd61[_0x5f3f6b][_0x2032a3(0x1e5)]=_0x265068;}),_0x10d2c8[_0x367011(0x2c3)]((_0x493d7f,_0x18512c)=>{var _0x14f3be=_0x367011;_0x3214ed[_0x14f3be(0x2c3)]((_0x5d1137,_0x1813a7)=>{var _0x4289c2=_0x14f3be;if(_0x5d1137==_0x4289c2(0x2b0)&&_0x18512c==_0x1813a7){var _0x18fefa=_0x493d7f[_0x4289c2(0x279)](0x3);_0x3bbd61[_0x18512c][_0x4289c2(0x2a0)]=_0x493d7f[0x0],_0x3bbd61[_0x18512c][_0x4289c2(0x2e2)]=_0x493d7f[0x1],_0x3bbd61[_0x18512c][_0x4289c2(0x1e4)]=0x0,_0x3bbd61[_0x18512c][_0x4289c2(0x285)]=0x0,_0x3bbd61[_0x18512c][_0x4289c2(0x265)]=_0x4289c2(0x22d),_0x3bbd61[_0x18512c][_0x4289c2(0x219)]=_0x18fefa;}else{if(_0x5d1137==_0x4289c2(0x2b8)&&_0x18512c==_0x1813a7){var _0x18fefa=_0x493d7f[_0x4289c2(0x279)](0x3);_0x3bbd61[_0x18512c]['storage']=_0x493d7f[0x0],_0x3bbd61[_0x18512c][_0x4289c2(0x2e2)]=_0x493d7f[0x1],_0x3bbd61[_0x18512c]['bay']=0x0,_0x3bbd61[_0x18512c][_0x4289c2(0x285)]=0x0,_0x3bbd61[_0x18512c]['type']=_0x4289c2(0x22d),_0x3bbd61[_0x18512c][_0x4289c2(0x219)]=_0x493d7f[0x5];}else{if(_0x18512c==_0x1813a7){var _0x37eb04;if(_0x493d7f[0x4]=='L')_0x37eb04=_0x4289c2(0x2b2);else _0x493d7f[0x4]=='F'&&(_0x37eb04='Floor');_0x3bbd61[_0x18512c][_0x4289c2(0x2a0)]=_0x493d7f[0x0],_0x3bbd61[_0x18512c]['rack']=_0x493d7f[0x1],_0x3bbd61[_0x18512c][_0x4289c2(0x1e4)]=_0x493d7f[0x2],_0x3bbd61[_0x18512c][_0x4289c2(0x285)]=_0x493d7f[0x3],_0x3bbd61[_0x18512c]['type']=_0x37eb04,_0x3bbd61[_0x18512c]['floorlevel']=_0x493d7f[0x5];}}}});}),_0x4e64f2[_0x367011(0x2c3)]((_0x440e8f,_0x8dec2f)=>{var _0x52b453=_0x367011;_0x3bbd61[_0x8dec2f][_0x52b453(0x29e)]=_0x440e8f;}),_0x49f415[_0x367011(0x2c3)]((_0x36f8fe,_0x23ba01)=>{_0x3bbd61[_0x23ba01]['secondary_unit']=_0x36f8fe;}),_0x2002a5[_0x367011(0x2c3)]((_0x309dfb,_0x261195)=>{_0x3bbd61[_0x261195]['batch_code']=_0x309dfb;}),_0x1c2fbf[_0x367011(0x2c3)]((_0x570f54,_0xd786d1)=>{var _0x409baa=_0x367011;_0x3bbd61[_0xd786d1][_0x409baa(0x269)]=_0x570f54;}),_0x28c18a['forEach']((_0x422599,_0x580fad)=>{var _0x2fe442=_0x367011;_0x3bbd61[_0x580fad][_0x2fe442(0x245)]=_0x422599;}),_0x2d39b9[_0x367011(0x2c3)]((_0x516ff4,_0x33c42a)=>{var _0x3a320c=_0x367011;_0x3bbd61[_0x33c42a][_0x3a320c(0x20d)]=_0x516ff4;}),_0x2ae0d6['forEach']((_0x4c00f2,_0x569009)=>{var _0x48959c=_0x367011;_0x3bbd61[_0x569009][_0x48959c(0x251)]=_0x4c00f2;}),_0x4edd2a[_0x367011(0x2c3)]((_0x589ee8,_0x331301)=>{_0x3bbd61[_0x331301]['delivery_date']=_0x589ee8;}),_0x1c7079[_0x367011(0x2c3)]((_0x1414ee,_0x1c3be5)=>{var _0xd5c466=_0x367011;_0x3bbd61[_0x1c3be5][_0xd5c466(0x1ff)]=_0x1414ee;}),_0x29df6a[_0x367011(0x2c3)]((_0x760897,_0x446ef6)=>{var _0x34f551=_0x367011;_0x3bbd61[_0x446ef6][_0x34f551(0x28d)]=_0x760897;}),_0x59106b[_0x367011(0x2c3)]((_0x415491,_0x3e559b)=>{var _0x2650af=_0x367011;_0x3bbd61[_0x3e559b][_0x2650af(0x1f0)]=_0x415491;}),_0x3214ed[_0x367011(0x2c3)]((_0x35a817,_0x3e5cc9)=>{var _0x21902b=_0x367011;_0x3bbd61[_0x3e5cc9][_0x21902b(0x2b6)]=_0x35a817;}),_0x4f4b17[_0x367011(0x2c3)]((_0x598bdb,_0x30148a)=>{var _0x894c0a=_0x367011;_0x3bbd61[_0x30148a][_0x894c0a(0x24d)]=_0x598bdb;});var _0x59999c=0x0;_0x3bbd61[_0x367011(0x2c3)](_0x40e819=>{var _0x51f0ec=_0x367011;(_0x40e819[_0x51f0ec(0x236)]<_0x40e819['quantity_notConverted']||_0x40e819[_0x51f0ec(0x1f0)]==0x0)&&(console[_0x51f0ec(0x229)](_0x51f0ec(0x28f),_0x40e819),_0x59999c++);});const _0x5a6aff=_0x3bbd61[_0x367011(0x1e0)](_0xfd434a=>_0xfd434a[_0x367011(0x238)]!=='0'&&_0xfd434a[_0x367011(0x238)]!==''),_0x34f496=new sales({'invoice':_0x442411,'customer':_0x400e44[_0x367011(0x2e0)]['customer'],'date':_0x16b4ff,'warehouse_name':_0x3ac201,'sale_product':_0x5a6aff,'note':_0x11cac9,'room':_0x2eeb41,'primary_code':_0x3279b1,'secondary_code':_0x111b34,'prod_code':_0x13b6b2,'SCRN':_0x5ceada}),_0x37181b=await _0x34f496[_0x367011(0x288)]();_0x400e44[_0x367011(0x1f7)](_0x367011(0x27b),_0x367011(0x267)),_0x2d510e[_0x367011(0x26c)](_0x367011(0x2e4)+_0x37181b['_id']);}catch(_0x2603c3){console[_0x367011(0x229)](_0x2603c3);}}),router[a0_0x3c7a7a(0x2c6)]('/preview/:id',auth,async(_0x2fe172,_0x2238ef)=>{var _0xb385bc=a0_0x3c7a7a;try{const {username:_0x1e3340,email:_0x134294,role:_0x391311}=_0x2fe172[_0xb385bc(0x224)],_0x4713f2=_0x2fe172[_0xb385bc(0x224)],_0x1fe573=await profile[_0xb385bc(0x2d3)]({'email':_0x4713f2[_0xb385bc(0x2eb)]}),_0x505aba=await master_shop[_0xb385bc(0x2b7)](),_0x14e32f=_0x2fe172['params']['id'],_0x1b1329=await sales[_0xb385bc(0x228)](_0x14e32f),_0x4db9b7=await warehouse[_0xb385bc(0x21a)]([{'$match':{'name':_0x1b1329['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0xb385bc(0x1df)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0xb385bc(0x2d9)},'bin':{'$first':_0xb385bc(0x2b4)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0xb385bc(0x211)},'primary_code':{'$first':_0xb385bc(0x240)},'secondary_code':{'$first':_0xb385bc(0x2bd)},'product_code':{'$first':_0xb385bc(0x21d)},'storage':{'$first':_0xb385bc(0x2dc)},'rack':{'$first':_0xb385bc(0x249)},'expiry_date':{'$first':_0xb385bc(0x218)},'production_date':{'$first':_0xb385bc(0x2b9)},'invoice':{'$first':_0xb385bc(0x293)}}}]),_0x56b44f=await customer['find']({});let _0xc9146e;if(_0x4713f2[_0xb385bc(0x1fa)]==_0xb385bc(0x2d1)){const _0x144c58=await staff[_0xb385bc(0x2d3)]({'email':_0x4713f2[_0xb385bc(0x2eb)]});_0xc9146e=await warehouse['aggregate']([{'$match':{'status':_0xb385bc(0x24a),'name':_0x144c58[_0xb385bc(0x2c9)]}},{'$group':{'_id':_0xb385bc(0x25c),'name':{'$first':_0xb385bc(0x25c)}}}]);}else _0xc9146e=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xb385bc(0x25c),'name':{'$first':'$name'}}}]);const _0x461456=await product[_0xb385bc(0x2b7)]({}),_0x2fb44a=await suppliers[_0xb385bc(0x2b7)]({});if(_0x505aba[0x0][_0xb385bc(0x205)]==_0xb385bc(0x213)){var _0x3478ac=users[_0xb385bc(0x277)];console[_0xb385bc(0x229)](_0x3478ac);}else{if(_0x505aba[0x0]['language']==_0xb385bc(0x1f2))var _0x3478ac=users[_0xb385bc(0x1f2)];else{if(_0x505aba[0x0][_0xb385bc(0x205)]=='German')var _0x3478ac=users[_0xb385bc(0x1f4)];else{if(_0x505aba[0x0][_0xb385bc(0x205)]==_0xb385bc(0x26a))var _0x3478ac=users['Spanish'];else{if(_0x505aba[0x0][_0xb385bc(0x205)]=='French')var _0x3478ac=users['French'];else{if(_0x505aba[0x0]['language']==_0xb385bc(0x2c1))var _0x3478ac=users[_0xb385bc(0x2a9)];else{if(_0x505aba[0x0][_0xb385bc(0x205)]==_0xb385bc(0x1e8))var _0x3478ac=users[_0xb385bc(0x1e8)];else{if(_0x505aba[0x0]['language']==_0xb385bc(0x1e2))var _0x3478ac=users['Arabic'];}}}}}}}_0x2238ef[_0xb385bc(0x284)](_0xb385bc(0x296),{'success':_0x2fe172[_0xb385bc(0x1f7)](_0xb385bc(0x27b)),'errors':_0x2fe172['flash'](_0xb385bc(0x20b)),'role':_0x4713f2,'profile':_0x1fe573,'customer':_0x56b44f,'warehouse':_0xc9146e,'product':_0x4db9b7,'user':_0x1b1329,'master_shop':_0x505aba,'unit':_0x461456,'language':_0x3478ac,'suppliers':_0x2fb44a});}catch(_0x4878a7){console['log'](_0x4878a7);}}),router[a0_0x3c7a7a(0x2ac)]('/preview/:id',auth,async(_0x3c8f56,_0x34fbf5)=>{var _0x1a8893=a0_0x3c7a7a;try{const _0x21edd6=_0x3c8f56[_0x1a8893(0x26f)]['id'],{invoice:_0x2c4be3,warehouse_name:_0x1128cd,room:_0x4df03f}=_0x3c8f56[_0x1a8893(0x2e0)],_0x537e2d=await sales['findOne']({'invoice':_0x2c4be3}),_0x561d86=_0x537e2d[_0x1a8893(0x23e)]['map'](async _0x22d792=>{var _0xcd4af=_0x1a8893,_0x51e93f=await warehouse[_0xcd4af(0x2d3)]({'name':_0x1128cd,'room':_0x22d792['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x1e6016=_0x51e93f[_0xcd4af(0x2d6)]['map'](_0x423d43=>{var _0x5c5b88=_0xcd4af;_0x423d43['product_name']==_0x22d792['product_name']&&_0x423d43['floorlevel']==_0x22d792[_0x5c5b88(0x219)]&&_0x423d43[_0x5c5b88(0x265)]==_0x22d792[_0x5c5b88(0x265)]&&_0x423d43[_0x5c5b88(0x285)]==_0x22d792[_0x5c5b88(0x285)]&&_0x423d43['bay']==_0x22d792[_0x5c5b88(0x1e4)]&&_0x423d43[_0x5c5b88(0x2e2)]==_0x22d792[_0x5c5b88(0x2e2)]&&_0x423d43['storage']==_0x22d792[_0x5c5b88(0x2a0)]&&_0x423d43['expiry_date']==_0x22d792[_0x5c5b88(0x269)]&&_0x423d43[_0x5c5b88(0x2ae)]==_0x22d792['batch_code']&&_0x423d43[_0x5c5b88(0x24d)]==_0x22d792[_0x5c5b88(0x24d)]&&_0x423d43[_0x5c5b88(0x2df)]==_0x22d792['id_transaction_from']&&(_0x423d43[_0x5c5b88(0x28b)]=Math['max'](0x0,Math['abs'](_0x423d43['product_stock'])-Math[_0x5c5b88(0x2e5)](_0x22d792[_0x5c5b88(0x238)])));});return _0x51e93f;});Promise[_0x1a8893(0x214)](_0x561d86)['then'](async _0x5c18cd=>{var _0x1d6181=_0x1a8893;try{for(const _0x25af25 of _0x5c18cd){await _0x25af25[_0x1d6181(0x288)]();}_0x537e2d['finalize']=_0x1d6181(0x28e);const _0x2bfcdd=await _0x537e2d['save'](),_0x6d2b37=await master_shop[_0x1d6181(0x2b7)](),_0x56b1d2=await email_settings['findOne'](),_0x472e2c=await supervisor_settings[_0x1d6181(0x2b7)]();var _0x5843a4=_0x537e2d['sale_product'],_0x7e9d45='',_0x21725b;for(_0x21725b in _0x5843a4){_0x7e9d45+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5843a4[_0x21725b][_0x1d6181(0x2de)]+_0x1d6181(0x20e)+_0x1d6181(0x260)+_0x5843a4[_0x21725b][_0x1d6181(0x1e5)]+_0x1d6181(0x20e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5843a4[_0x21725b][_0x1d6181(0x238)]+_0x1d6181(0x20e)+_0x1d6181(0x260)+_0x5843a4[_0x21725b][_0x1d6181(0x29e)]+_0x1d6181(0x20e)+_0x1d6181(0x260)+_0x5843a4[_0x21725b]['secondary_unit']+_0x1d6181(0x20e)+_0x1d6181(0x260)+_0x537e2d['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5843a4[_0x21725b]['room_name']+'</td>'+_0x1d6181(0x260)+_0x5843a4[_0x21725b][_0x1d6181(0x2a0)]+_0x5843a4[_0x21725b][_0x1d6181(0x2e2)]+_0x5843a4[_0x21725b][_0x1d6181(0x1e4)]+_0x5843a4[_0x21725b][_0x1d6181(0x285)]+_0x5843a4[_0x21725b][_0x1d6181(0x265)][0x0]+_0x5843a4[_0x21725b]['floorlevel']+_0x1d6181(0x20e),_0x1d6181(0x2a7);}let _0x3a087b=nodemailer[_0x1d6181(0x1f6)]({'host':_0x56b1d2[_0x1d6181(0x22b)],'port':Number(_0x56b1d2[_0x1d6181(0x27e)]),'secure':![],'auth':{'user':_0x56b1d2[_0x1d6181(0x2eb)],'pass':_0x56b1d2[_0x1d6181(0x286)]}}),_0x280f7c={'from':_0x56b1d2[_0x1d6181(0x2eb)],'to':_0x472e2c[0x0][_0x1d6181(0x273)],'subject':_0x1d6181(0x209),'attachments':[{'filename':_0x1d6181(0x2a8),'path':__dirname+_0x1d6181(0x29d)+_0x1d6181(0x23b)+_0x6d2b37[0x0][_0x1d6181(0x21e)],'cid':_0x1d6181(0x231)}],'html':_0x1d6181(0x25b)+_0x1d6181(0x26e)+_0x1d6181(0x207)+'<div>'+_0x1d6181(0x248)+'<div>'+_0x1d6181(0x27f)+_0x1d6181(0x2d8)+'<div>'+_0x1d6181(0x1ea)+_0x6d2b37[0x0][_0x1d6181(0x227)]+_0x1d6181(0x261)+_0x1d6181(0x2d8)+_0x1d6181(0x2d8)+_0x1d6181(0x25f)+_0x1d6181(0x2bb)+_0x1d6181(0x2a4)+_0x1d6181(0x22c)+_0x537e2d[_0x1d6181(0x24d)]+'\x20'+_0x1d6181(0x281)+_0x1d6181(0x2dd)+_0x537e2d[_0x1d6181(0x29b)]+'\x20'+_0x1d6181(0x2cd)+'</h5>'+'</div>'+_0x1d6181(0x25d)+_0x1d6181(0x1f1)+_0x1d6181(0x20c)+_0x1d6181(0x2ba)+_0x1d6181(0x295)+_0x1d6181(0x22e)+_0x1d6181(0x1de)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1d6181(0x2cc)+_0x1d6181(0x27c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1d6181(0x2a7)+_0x1d6181(0x271)+_0x1d6181(0x244)+'\x20'+_0x7e9d45+'\x20'+'</tbody>'+_0x1d6181(0x266)+'<div>'+_0x1d6181(0x283)+'<h5>'+_0x6d2b37[0x0]['site_title']+'</h5>'+'</div>'+_0x1d6181(0x2d8)+'</body></html>'};_0x3a087b[_0x1d6181(0x204)](_0x280f7c,function(_0x71fe9e,_0x1247b4){var _0x1c1446=_0x1d6181;_0x71fe9e?(console['log'](_0x71fe9e),console[_0x1c1446(0x229)]('Error\x20Occurs')):console['log'](_0x1c1446(0x2ea));}),_0x3c8f56[_0x1d6181(0x1f7)]('success',_0x1d6181(0x23f)),_0x34fbf5['redirect']('/all_sales/preview/'+_0x21edd6);}catch(_0x2cbd21){console['error'](_0x2cbd21),_0x34fbf5[_0x1d6181(0x2b1)](0x1f4)[_0x1d6181(0x233)]({'error':_0x1d6181(0x1f5)});}})[_0x1a8893(0x206)](_0x3321ae=>{var _0x32f65c=_0x1a8893;console[_0x32f65c(0x291)](_0x3321ae),_0x34fbf5[_0x32f65c(0x2b1)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x400c61){console['log'](_0x400c61);}}),router[a0_0x3c7a7a(0x2c6)](a0_0x3c7a7a(0x202),auth,async(_0xa7a3c,_0x5017f2)=>{var _0x267bc0=a0_0x3c7a7a;try{const {username:_0x5798a2,email:_0x30f9df,role:_0x407208}=_0xa7a3c[_0x267bc0(0x224)],_0x19115d=_0xa7a3c[_0x267bc0(0x224)],_0x181c63=await profile[_0x267bc0(0x2d3)]({'email':_0x19115d[_0x267bc0(0x2eb)]}),_0x5a6440=await master_shop[_0x267bc0(0x2b7)](),_0x23c52f=_0xa7a3c[_0x267bc0(0x26f)]['id'],_0x3046f0=await sales[_0x267bc0(0x228)](_0x23c52f);var _0x2903ce=[_0x267bc0(0x29c),'Enclosed'];const _0x38f46d=await warehouse['aggregate']([{'$match':{'name':_0x3046f0[_0x267bc0(0x20f)],'warehouse_category':_0x267bc0(0x2c4)}},{'$unwind':_0x267bc0(0x1e9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x267bc0(0x1df)},'product_stock':{'$first':_0x267bc0(0x1ef)},'bay':{'$first':_0x267bc0(0x2d9)},'bin':{'$first':_0x267bc0(0x2b4)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x267bc0(0x211)},'primary_code':{'$first':_0x267bc0(0x240)},'secondary_code':{'$first':_0x267bc0(0x2bd)},'product_code':{'$first':_0x267bc0(0x21d)},'storage':{'$first':_0x267bc0(0x2dc)},'rack':{'$first':_0x267bc0(0x249)}}}]),_0xbe5ab5=await customer['find']({});let _0x46da8e;if(_0x19115d[_0x267bc0(0x1fa)]==_0x267bc0(0x2d1)){const _0xe078d3=await staff[_0x267bc0(0x2d3)]({'email':_0x19115d[_0x267bc0(0x2eb)]});_0x46da8e=await warehouse['aggregate']([{'$match':{'status':_0x267bc0(0x24a),'name':_0xe078d3[_0x267bc0(0x2c9)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x267bc0(0x25c)}}}]);}else _0x46da8e=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x267bc0(0x2c4)}},{'$group':{'_id':_0x267bc0(0x25c),'name':{'$first':_0x267bc0(0x25c)}}}]);const _0x41b03b=await product[_0x267bc0(0x2b7)]({});if(_0x5a6440[0x0]['language']==_0x267bc0(0x213)){var _0x511b28=users[_0x267bc0(0x277)];console['log'](_0x511b28);}else{if(_0x5a6440[0x0]['language']=='Hindi')var _0x511b28=users[_0x267bc0(0x1f2)];else{if(_0x5a6440[0x0]['language']=='German')var _0x511b28=users['German'];else{if(_0x5a6440[0x0]['language']==_0x267bc0(0x26a))var _0x511b28=users['Spanish'];else{if(_0x5a6440[0x0][_0x267bc0(0x205)]=='French')var _0x511b28=users[_0x267bc0(0x250)];else{if(_0x5a6440[0x0][_0x267bc0(0x205)]==_0x267bc0(0x2c1))var _0x511b28=users['Portuguese'];else{if(_0x5a6440[0x0][_0x267bc0(0x205)]==_0x267bc0(0x1e8))var _0x511b28=users[_0x267bc0(0x1e8)];else{if(_0x5a6440[0x0]['language']==_0x267bc0(0x1e2))var _0x511b28=users[_0x267bc0(0x2c7)];}}}}}}}_0x5017f2[_0x267bc0(0x284)]('edit_sales',{'success':_0xa7a3c[_0x267bc0(0x1f7)]('success'),'errors':_0xa7a3c[_0x267bc0(0x1f7)]('errors'),'role':_0x19115d,'profile':_0x181c63,'customer':_0xbe5ab5,'warehouse':_0x46da8e,'product':_0x38f46d,'user':_0x3046f0,'master_shop':_0x5a6440,'unit':_0x41b03b,'language':_0x511b28});}catch(_0x44ced1){console[_0x267bc0(0x229)](_0x44ced1);}}),router[a0_0x3c7a7a(0x2ac)](a0_0x3c7a7a(0x202),auth,async(_0x387c2e,_0x5eb2e0)=>{var _0x11052b=a0_0x3c7a7a;try{const _0x46d0d6=_0x387c2e['params']['id'],_0xded4d4=await sales[_0x11052b(0x2d3)]({'_id':_0x387c2e[_0x11052b(0x26f)]['id']}),_0xf92648=await warehouse[_0x11052b(0x2d3)]({'name':_0xded4d4['warehouse_name'],'room':_0x387c2e[_0x11052b(0x2e0)]['room']}),{invoice:_0xd4e4ef,date:_0x1e7fd7,warehouse_name:_0x7d91d2,product_name:_0x20b49a,stock:_0x2e4446,quantity:_0x1ba0af,note:_0x18cf3c,room:_0x73b8bf,customer:_0x5588ca,SCRN:_0x2e0e29}=_0x387c2e[_0x11052b(0x2e0)];if(typeof _0x20b49a==_0x11052b(0x2bf))var _0x1139c4=[_0x387c2e[_0x11052b(0x2e0)]['product_name']],_0x1ea97d=[_0x387c2e['body'][_0x11052b(0x236)]],_0x45db5b=[_0x387c2e[_0x11052b(0x2e0)]['carton']],_0x6d3452=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x232)]],_0x1ff44f=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x212)]],_0x4dcd5b=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x1e6)]],_0x48b90d=[_0x387c2e[_0x11052b(0x2e0)]['level']],_0x3225e0=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x2a1)]],_0x266182=[_0x387c2e[_0x11052b(0x2e0)]['secondary_unit']],_0x1edb39=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x2ae)]],_0x40b585=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x269)]],_0x2876c6=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x1f9)]],_0x918d9d=[_0x387c2e['body'][_0x11052b(0x20d)]],_0x28c002=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x251)]],_0x1d2a81=[_0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x289)]],_0xf51fc9=[_0x387c2e['body'][_0x11052b(0x1ff)]],_0x355802=[_0x387c2e['body'][_0x11052b(0x28d)]],_0x5a14a8=[_0x387c2e['body'][_0x11052b(0x238)]],_0x5c05fe=[_0x387c2e['body'][_0x11052b(0x2ab)]];else var _0x1139c4=[..._0x387c2e['body'][_0x11052b(0x2de)]],_0x1ea97d=[..._0x387c2e['body'][_0x11052b(0x236)]],_0x45db5b=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x24b)]],_0x6d3452=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x232)]],_0x1ff44f=[..._0x387c2e[_0x11052b(0x2e0)]['secondary_code']],_0x4dcd5b=[..._0x387c2e[_0x11052b(0x2e0)]['prod_code']],_0x48b90d=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x1e1)]],_0x3225e0=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x2a1)]],_0x266182=[..._0x387c2e[_0x11052b(0x2e0)]['secondary_unit']],_0x1edb39=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x2ae)]],_0x40b585=[..._0x387c2e[_0x11052b(0x2e0)]['expiry_date']],_0x2876c6=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x1f9)]],_0x918d9d=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x20d)]],_0x28c002=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x251)]],_0x1d2a81=[..._0x387c2e['body']['delivery_date']],_0xf51fc9=[..._0x387c2e['body']['delivery_code']],_0x355802=[..._0x387c2e[_0x11052b(0x2e0)][_0x11052b(0x28d)]],_0x5a14a8=[..._0x387c2e[_0x11052b(0x2e0)]['quantity']],_0x5c05fe=[..._0x387c2e['body'][_0x11052b(0x2ab)]];const _0x5c5ea1=_0x1139c4[_0x11052b(0x27d)](_0x5383dd=>{return _0x5383dd={'product_name':_0x5383dd};});_0x1ea97d[_0x11052b(0x2c3)]((_0x41cde2,_0x4c051a)=>{_0x5c5ea1[_0x4c051a]['stock']=Math['abs'](_0x41cde2);}),_0x45db5b['forEach']((_0x17aca7,_0x529cdc)=>{var _0x4fa3f8=_0x11052b;_0x5c5ea1[_0x529cdc][_0x4fa3f8(0x238)]=_0x17aca7;}),_0x6d3452[_0x11052b(0x2c3)]((_0x586068,_0x1e0d9a)=>{var _0x980387=_0x11052b;_0x5c5ea1[_0x1e0d9a][_0x980387(0x232)]=_0x586068;}),_0x1ff44f['forEach']((_0x1a7428,_0x78c9d3)=>{var _0x363771=_0x11052b;_0x5c5ea1[_0x78c9d3][_0x363771(0x212)]=_0x1a7428;}),_0x4dcd5b[_0x11052b(0x2c3)]((_0x33e6d2,_0x4b0246)=>{var _0x576d40=_0x11052b;_0x5c5ea1[_0x4b0246][_0x576d40(0x1e5)]=_0x33e6d2;}),_0x48b90d[_0x11052b(0x2c3)]((_0x32be7f,_0x444c6f)=>{var _0x4f443e=_0x11052b;_0x5c05fe[_0x4f443e(0x2c3)]((_0xef9c7d,_0x4f744d)=>{var _0x2708ec=_0x4f443e;if(_0xef9c7d==_0x2708ec(0x2b0)&&_0x444c6f==_0x4f744d){var _0x169526=_0x32be7f['slice'](0x3);_0x5c5ea1[_0x444c6f][_0x2708ec(0x2a0)]=_0x32be7f[0x0],_0x5c5ea1[_0x444c6f][_0x2708ec(0x2e2)]=_0x32be7f[0x1],_0x5c5ea1[_0x444c6f][_0x2708ec(0x1e4)]=0x0,_0x5c5ea1[_0x444c6f][_0x2708ec(0x285)]=0x0,_0x5c5ea1[_0x444c6f][_0x2708ec(0x265)]=_0x2708ec(0x22d),_0x5c5ea1[_0x444c6f][_0x2708ec(0x219)]=_0x169526;}else{if(_0xef9c7d==_0x2708ec(0x2b8)&&_0x444c6f==_0x4f744d){var _0x169526=_0x32be7f['slice'](0x3);_0x5c5ea1[_0x444c6f][_0x2708ec(0x2a0)]=_0x32be7f[0x0],_0x5c5ea1[_0x444c6f][_0x2708ec(0x2e2)]=_0x32be7f[0x1],_0x5c5ea1[_0x444c6f][_0x2708ec(0x1e4)]=0x0,_0x5c5ea1[_0x444c6f]['bin']=0x0,_0x5c5ea1[_0x444c6f][_0x2708ec(0x265)]=_0x2708ec(0x22d),_0x5c5ea1[_0x444c6f][_0x2708ec(0x219)]=_0x32be7f[0x5];}else{if(_0x444c6f==_0x4f744d){var _0x569dcf;if(_0x32be7f[0x4]=='L')_0x569dcf='Level';else _0x32be7f[0x4]=='F'&&(_0x569dcf='Floor');_0x5c5ea1[_0x444c6f][_0x2708ec(0x2a0)]=_0x32be7f[0x0],_0x5c5ea1[_0x444c6f][_0x2708ec(0x2e2)]=_0x32be7f[0x1],_0x5c5ea1[_0x444c6f]['bay']=_0x32be7f[0x2],_0x5c5ea1[_0x444c6f][_0x2708ec(0x285)]=_0x32be7f[0x3],_0x5c5ea1[_0x444c6f]['type']=_0x569dcf,_0x5c5ea1[_0x444c6f][_0x2708ec(0x219)]=_0x32be7f[0x5];}}}});}),_0x3225e0[_0x11052b(0x2c3)]((_0x52ab10,_0x5f2514)=>{var _0x259dcd=_0x11052b;_0x5c5ea1[_0x5f2514][_0x259dcd(0x29e)]=_0x52ab10;}),_0x266182['forEach']((_0x52445a,_0x186fb7)=>{_0x5c5ea1[_0x186fb7]['secondary_unit']=_0x52445a;}),_0x1edb39['forEach']((_0x2cc5f8,_0x45229d)=>{var _0xde3ecc=_0x11052b;_0x5c5ea1[_0x45229d][_0xde3ecc(0x2ae)]=_0x2cc5f8;}),_0x40b585[_0x11052b(0x2c3)]((_0x28c821,_0x211570)=>{var _0x2820cc=_0x11052b;_0x5c5ea1[_0x211570][_0x2820cc(0x269)]=_0x28c821;}),_0x2876c6[_0x11052b(0x2c3)]((_0x3dd28c,_0x18ef2d)=>{var _0x5a13cf=_0x11052b;_0x5c5ea1[_0x18ef2d][_0x5a13cf(0x245)]=_0x3dd28c;}),_0x918d9d[_0x11052b(0x2c3)]((_0x9b55f0,_0x8c16f)=>{var _0x2346ca=_0x11052b;_0x5c5ea1[_0x8c16f][_0x2346ca(0x20d)]=_0x9b55f0;}),_0x28c002['forEach']((_0x69123f,_0x741750)=>{var _0x52dc65=_0x11052b;_0x5c5ea1[_0x741750][_0x52dc65(0x251)]=Math['abs'](_0x69123f);}),_0x1d2a81[_0x11052b(0x2c3)]((_0x324a5a,_0x22f0bd)=>{_0x5c5ea1[_0x22f0bd]['delivery_date']=_0x324a5a;}),_0xf51fc9['forEach']((_0x454847,_0x51e306)=>{_0x5c5ea1[_0x51e306]['delivery_code']=_0x454847;}),_0x355802[_0x11052b(0x2c3)]((_0x1f41c1,_0x1a2335)=>{var _0xe84e87=_0x11052b;_0x5c5ea1[_0x1a2335][_0xe84e87(0x28d)]=_0x1f41c1;}),_0x5a14a8[_0x11052b(0x2c3)]((_0x308db1,_0x17c134)=>{_0x5c5ea1[_0x17c134]['quantity_notConverted']=_0x308db1;}),_0x5c05fe[_0x11052b(0x2c3)]((_0x3890fc,_0x48fda3)=>{var _0x48736b=_0x11052b;_0x5c5ea1[_0x48fda3][_0x48736b(0x2b6)]=_0x3890fc;});var _0x34f1dd=0x0;_0x5c5ea1[_0x11052b(0x2c3)](_0x4da5fb=>{var _0x13a7cb=_0x11052b;console[_0x13a7cb(0x229)](_0x13a7cb(0x28f),_0x4da5fb),(parseInt(_0x4da5fb[_0x13a7cb(0x236)])<parseInt(_0x4da5fb[_0x13a7cb(0x238)])||parseInt(_0x4da5fb[_0x13a7cb(0x238)])==0x0)&&_0x34f1dd++;});if(_0x34f1dd!=0x0)return _0x387c2e[_0x11052b(0x1f7)]('errors',_0x11052b(0x2bc)),_0x5eb2e0['redirect'](_0x11052b(0x2ed));const _0x1b4a2e=_0x5c5ea1['filter'](_0x231d6a=>_0x231d6a['quantity']!=='0'&&_0x231d6a[_0x11052b(0x238)]!=='');_0xded4d4['invoice']=_0xd4e4ef,_0xded4d4['customer']=_0x5588ca,_0xded4d4['date']=_0x1e7fd7,_0xded4d4[_0x11052b(0x20f)]=_0x7d91d2,_0xded4d4['sale_product']=_0x1b4a2e,_0xded4d4['note']=_0x18cf3c,_0xded4d4[_0x11052b(0x1fd)]=_0x2e0e29,_0xded4d4[_0x11052b(0x2aa)]=_0x11052b(0x2e7),_0xded4d4['isAllowEdit']=_0x11052b(0x2e7);const _0x47b2d9=await _0xded4d4[_0x11052b(0x288)]();_0x387c2e[_0x11052b(0x1f7)]('success',_0x11052b(0x23f)),_0x5eb2e0[_0x11052b(0x26c)](_0x11052b(0x2da));}catch(_0x15ea4d){console[_0x11052b(0x229)](_0x15ea4d);}}),router['post'](a0_0x3c7a7a(0x2ce),auth,async(_0x4aeb0a,_0x566d61)=>{var _0x138e8a=a0_0x3c7a7a;try{const _0x3e39c9=_0x4aeb0a[_0x138e8a(0x26f)]['id'],{invoice:_0x3eacdb,customer:_0x1098f2,receivable_amount:_0x59057d,received_amount:_0x42db9f}=_0x4aeb0a[_0x138e8a(0x2e0)],_0x4a1b31=await sales['findById'](_0x3e39c9);console[_0x138e8a(0x229)](_0x4a1b31);var _0x48e3a6=_0x59057d-_0x42db9f;console[_0x138e8a(0x229)](_0x42db9f),_0x4a1b31[_0x138e8a(0x239)]=parseFloat(_0x42db9f)+parseFloat(_0x4a1b31['received_amount']),_0x4a1b31['due_amount']=_0x48e3a6,console[_0x138e8a(0x229)](_0x4a1b31);const _0x32de01=await _0x4a1b31['save'](),_0x333326=await c_payment_data[_0x138e8a(0x2d3)]({'invoice':_0x3eacdb});_0x333326[_0x138e8a(0x2ec)]=_0x48e3a6,await _0x333326[_0x138e8a(0x288)]();let _0x50a1a0=new Date(),_0xcb6840=('0'+_0x50a1a0[_0x138e8a(0x201)]())[_0x138e8a(0x279)](-0x2),_0x1e4d69=('0'+(_0x50a1a0['getMonth']()+0x1))[_0x138e8a(0x279)](-0x2),_0x132be=_0x50a1a0[_0x138e8a(0x25a)](),_0x5e2fa6=_0x132be+'-'+_0x1e4d69+'-'+_0xcb6840;const _0x174234=new customer_payment({'invoice':_0x3eacdb,'date':_0x132be+'-'+_0x1e4d69+'-'+_0xcb6840,'customer':_0x1098f2,'reason':_0x138e8a(0x22f),'amount':_0x42db9f}),_0x2322bf=await _0x174234[_0x138e8a(0x288)]();_0x4aeb0a[_0x138e8a(0x1f7)](_0x138e8a(0x27b),_0x138e8a(0x24e)),_0x566d61[_0x138e8a(0x26c)]('/all_sales/view');}catch(_0x50ce72){console['log'](_0x50ce72);}}),router[a0_0x3c7a7a(0x2c6)](a0_0x3c7a7a(0x1e3),auth,async(_0x55a3da,_0x3e20dd)=>{var _0x3fa0c0=a0_0x3c7a7a;try{const {username:_0x192a65,email:_0xefc26a,role:_0x224b81}=_0x55a3da[_0x3fa0c0(0x224)],_0x131993=_0x55a3da[_0x3fa0c0(0x224)],_0x5394bd=await profile['findOne']({'email':_0x131993[_0x3fa0c0(0x2eb)]}),_0x3689cb=await master_shop['find']();console[_0x3fa0c0(0x229)](_0x3fa0c0(0x234),_0x3689cb);const _0x58e95c=_0x55a3da[_0x3fa0c0(0x26f)]['id'],_0x1f6a35=await sales['findById'](_0x58e95c);console['log'](_0x1f6a35);const _0xba6aad=await customer['findOne']({'name':_0x1f6a35[_0x3fa0c0(0x1ed)]});console[_0x3fa0c0(0x229)](_0xba6aad);if(_0x3689cb[0x0][_0x3fa0c0(0x205)]==_0x3fa0c0(0x213)){var _0x1a64e9=users[_0x3fa0c0(0x277)];console['log'](_0x1a64e9);}else{if(_0x3689cb[0x0][_0x3fa0c0(0x205)]==_0x3fa0c0(0x1f2))var _0x1a64e9=users[_0x3fa0c0(0x1f2)];else{if(_0x3689cb[0x0][_0x3fa0c0(0x205)]=='German')var _0x1a64e9=users['German'];else{if(_0x3689cb[0x0][_0x3fa0c0(0x205)]==_0x3fa0c0(0x26a))var _0x1a64e9=users[_0x3fa0c0(0x26a)];else{if(_0x3689cb[0x0]['language']=='French')var _0x1a64e9=users[_0x3fa0c0(0x250)];else{if(_0x3689cb[0x0][_0x3fa0c0(0x205)]==_0x3fa0c0(0x2c1))var _0x1a64e9=users[_0x3fa0c0(0x2a9)];else{if(_0x3689cb[0x0][_0x3fa0c0(0x205)]==_0x3fa0c0(0x1e8))var _0x1a64e9=users[_0x3fa0c0(0x1e8)];else{if(_0x3689cb[0x0][_0x3fa0c0(0x205)]=='Arabic\x20(ae)')var _0x1a64e9=users[_0x3fa0c0(0x2c7)];}}}}}}}_0x3e20dd[_0x3fa0c0(0x284)](_0x3fa0c0(0x2a2),{'success':_0x55a3da['flash'](_0x3fa0c0(0x27b)),'errors':_0x55a3da[_0x3fa0c0(0x1f7)](_0x3fa0c0(0x20b)),'role':_0x131993,'profile':_0x5394bd,'master_shop':_0x3689cb,'customers':_0xba6aad,'sales':_0x1f6a35,'language':_0x1a64e9});}catch(_0x28f3ff){console['log'](_0x28f3ff);}}),router[a0_0x3c7a7a(0x2c6)](a0_0x3c7a7a(0x272),auth,async(_0x4a3f1c,_0x6e0c49)=>{var _0x7b36ae=a0_0x3c7a7a;try{const {username:_0x719dc8,email:_0xe2afd3,role:_0xfdf5cc}=_0x4a3f1c[_0x7b36ae(0x224)],_0x1a8852=_0x4a3f1c[_0x7b36ae(0x224)],_0x42ce40=await profile['findOne']({'email':_0x1a8852[_0x7b36ae(0x2eb)]}),_0x53ee48=await master_shop[_0x7b36ae(0x2b7)]();console[_0x7b36ae(0x229)]('master',_0x53ee48);const _0x5d0280=_0x4a3f1c[_0x7b36ae(0x26f)]['id'];console[_0x7b36ae(0x229)](_0x5d0280);const _0x475295=await sales[_0x7b36ae(0x228)](_0x5d0280);console['log']('user_id',_0x475295);const _0x22767d=await warehouse[_0x7b36ae(0x21a)]([{'$match':{'name':_0x7b36ae(0x29a),'room':'Return\x20Rooms'}},{'$unwind':_0x7b36ae(0x1e9)},{'$group':{'_id':_0x7b36ae(0x235),'name':{'$first':_0x7b36ae(0x1df)},'product_stock':{'$first':_0x7b36ae(0x1ef)},'level':{'$first':_0x7b36ae(0x1fc)},'isle':{'$first':_0x7b36ae(0x2ca)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x7b36ae(0x2bd)},'product_code':{'$first':_0x7b36ae(0x21d)}}}]);console[_0x7b36ae(0x229)](_0x7b36ae(0x23d),_0x22767d);const _0xb1d49a=await product[_0x7b36ae(0x2b7)]({});warehouse_data=await warehouse[_0x7b36ae(0x21a)]([{'$match':{'status':_0x7b36ae(0x24a),'name':'Return\x20Goods','warehouse_category':_0x7b36ae(0x2c4)}},{'$group':{'_id':_0x7b36ae(0x25c),'name':{'$first':_0x7b36ae(0x25c)}}},{'$sort':{'name':0x1}}]);var _0x344e18=[_0x7b36ae(0x216)];if(_0x53ee48[0x0][_0x7b36ae(0x205)]==_0x7b36ae(0x213)){var _0x30979c=users['English'];console[_0x7b36ae(0x229)](_0x30979c);}else{if(_0x53ee48[0x0][_0x7b36ae(0x205)]==_0x7b36ae(0x1f2))var _0x30979c=users[_0x7b36ae(0x1f2)];else{if(_0x53ee48[0x0][_0x7b36ae(0x205)]==_0x7b36ae(0x1f4))var _0x30979c=users[_0x7b36ae(0x1f4)];else{if(_0x53ee48[0x0]['language']==_0x7b36ae(0x26a))var _0x30979c=users[_0x7b36ae(0x26a)];else{if(_0x53ee48[0x0][_0x7b36ae(0x205)]=='French')var _0x30979c=users[_0x7b36ae(0x250)];else{if(_0x53ee48[0x0][_0x7b36ae(0x205)]==_0x7b36ae(0x2c1))var _0x30979c=users['Portuguese'];else{if(_0x53ee48[0x0][_0x7b36ae(0x205)]==_0x7b36ae(0x1e8))var _0x30979c=users[_0x7b36ae(0x1e8)];else{if(_0x53ee48[0x0][_0x7b36ae(0x205)]==_0x7b36ae(0x1e2))var _0x30979c=users[_0x7b36ae(0x2c7)];}}}}}}}_0x6e0c49[_0x7b36ae(0x284)](_0x7b36ae(0x23c),{'success':_0x4a3f1c[_0x7b36ae(0x1f7)](_0x7b36ae(0x27b)),'errors':_0x4a3f1c[_0x7b36ae(0x1f7)]('errors'),'role':_0x1a8852,'profile':_0x42ce40,'user':_0x475295,'stock':_0x22767d,'master_shop':_0x53ee48,'unit':_0xb1d49a,'language':_0x30979c,'warehouses':warehouse_data,'rooms':_0x344e18});}catch(_0x45a176){console[_0x7b36ae(0x229)](_0x45a176),_0x6e0c49[_0x7b36ae(0x2b1)](0xc8)[_0x7b36ae(0x233)]({'message':_0x45a176[_0x7b36ae(0x203)]});}}),router['post']('/view/return_sales/:id',auth,async(_0x31db85,_0x2516f8)=>{var _0x51744e=a0_0x3c7a7a;try{const {invoice:_0x3ac936,date:_0xb5823f,warehouse_name:_0x430485,product_name:_0x592058,primary_code:_0xb02ce6,secondary_code:_0x54dfca,product_code:_0x57c1bf,sales_quantity:_0x43bd30,stocks:_0x395013,return_qty:_0x38d778,Room_name:_0x5aaa27,to_warehouse_name:_0x3d8788,to_Roomname:_0x6d0dfb,to_Room_name:_0x3ec443,note:_0x343751,level:_0x3f608c,isle:_0xe7b80,pallet:_0x164737}=_0x31db85['body'];if(typeof _0x592058==_0x51744e(0x2bf))var _0x5c5b5d=[_0x31db85['body']['product_name']],_0x106f8e=[_0x31db85[_0x51744e(0x2e0)]['primary_code']],_0xbcd1de=[_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x212)]],_0x4edd2d=[_0x31db85[_0x51744e(0x2e0)]['product_code']],_0x4001b8=[_0x31db85[_0x51744e(0x2e0)]['sales_quantity']],_0x47b5ba=[_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x297)]],_0x2fe44a=[_0x31db85[_0x51744e(0x2e0)]['return_qty']],_0x5eaab3=[_0x31db85[_0x51744e(0x2e0)]['bay']],_0x2ccd9a=[_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x285)]],_0xab95bd=[_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x2b5)]],_0x100455=[_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x219)]];else var _0x5c5b5d=[..._0x31db85[_0x51744e(0x2e0)]['product_name']],_0x106f8e=[..._0x31db85[_0x51744e(0x2e0)]['primary_code']],_0xbcd1de=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x212)]],_0x4edd2d=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x1e5)]],_0x4001b8=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x253)]],_0x47b5ba=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x297)]],_0x2fe44a=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x2c8)]],_0x5eaab3=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x1e4)]],_0x2ccd9a=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x285)]],_0xab95bd=[..._0x31db85['body'][_0x51744e(0x2b5)]],_0x100455=[..._0x31db85[_0x51744e(0x2e0)][_0x51744e(0x219)]];const _0x115f9a=_0x5c5b5d[_0x51744e(0x27d)](_0x8d96d9=>{return _0x8d96d9={'product_name':_0x8d96d9};});_0x106f8e[_0x51744e(0x2c3)]((_0x93b3fc,_0x2af211)=>{_0x115f9a[_0x2af211]['primary_code']=_0x93b3fc;}),_0xbcd1de['forEach']((_0x34569c,_0x240887)=>{var _0x24df47=_0x51744e;_0x115f9a[_0x240887][_0x24df47(0x212)]=_0x34569c;}),_0x4edd2d['forEach']((_0x168b59,_0x5ec6af)=>{var _0x1407bd=_0x51744e;_0x115f9a[_0x5ec6af][_0x1407bd(0x1e5)]=_0x168b59;}),_0x4001b8[_0x51744e(0x2c3)]((_0xdb76a7,_0x5b69fa)=>{var _0x266bbb=_0x51744e;_0x115f9a[_0x5b69fa][_0x266bbb(0x243)]=_0xdb76a7;}),_0x47b5ba['forEach']((_0x2189f6,_0xba17f7)=>{var _0x4c1bc5=_0x51744e;_0x115f9a[_0xba17f7][_0x4c1bc5(0x236)]=_0x2189f6;}),_0x2fe44a['forEach']((_0x40345b,_0xc233d1)=>{var _0x2ca7c9=_0x51744e;_0x115f9a[_0xc233d1][_0x2ca7c9(0x2c8)]=_0x40345b;}),_0x5eaab3[_0x51744e(0x2c3)]((_0x2f3ddb,_0x41e7b1)=>{_0x115f9a[_0x41e7b1]['bay']=_0x2f3ddb;}),_0x2ccd9a[_0x51744e(0x2c3)]((_0x89c85a,_0x1b4684)=>{var _0xc7ac1d=_0x51744e;_0x115f9a[_0x1b4684][_0xc7ac1d(0x285)]=_0x89c85a;}),_0xab95bd[_0x51744e(0x2c3)]((_0x1e2a77,_0x1f26b0)=>{var _0x4f54d8=_0x51744e;_0x115f9a[_0x1f26b0][_0x4f54d8(0x265)]=_0x1e2a77;}),_0x100455[_0x51744e(0x2c3)]((_0xa74f1e,_0x1e0bbe)=>{var _0x1eea83=_0x51744e;_0x115f9a[_0x1e0bbe][_0x1eea83(0x219)]=_0xa74f1e;});var _0x5b88f1=0x0;_0x115f9a[_0x51744e(0x2c3)](_0x36f7c5=>{var _0x3d334a=_0x51744e;console[_0x3d334a(0x229)]('foreach\x20newproduct',_0x36f7c5),(parseInt(_0x36f7c5[_0x3d334a(0x243)])<parseInt(_0x36f7c5[_0x3d334a(0x2c8)])||parseInt(_0x36f7c5['stock'])<parseInt(_0x36f7c5[_0x3d334a(0x2c8)])&&parseInt(_0x36f7c5[_0x3d334a(0x243)])>parseInt(_0x36f7c5[_0x3d334a(0x2c8)])||parseInt(_0x36f7c5['return_qty'])==0x0)&&_0x5b88f1++;});if(_0x5b88f1!=0x0)return _0x31db85['flash']('errors',_0x51744e(0x2c0)),_0x2516f8[_0x51744e(0x26c)](_0x51744e(0x2ed));const _0x4f60f6=await sales[_0x51744e(0x2d3)]({'invoice':_0x3ac936});console[_0x51744e(0x229)](_0x4f60f6),_0x4f60f6[_0x51744e(0x2d4)]=_0x51744e(0x28e);const _0x4022f0=await _0x4f60f6['save'](),_0x1f19b1=new sales_return({'invoice':_0x3ac936,'customer':_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x1ed)],'date':_0xb5823f,'warehouse_name':_0x430485,'room':_0x5aaa27,'ToWarehouse':_0x3d8788,'ToRoom':_0x3ec443,'return_sale':_0x115f9a,'note':_0x343751}),_0x5cc107=await _0x1f19b1[_0x51744e(0x288)]();console[_0x51744e(0x229)](_0x1f19b1);const _0x295e26=await sales_return[_0x51744e(0x2d3)]({'invoice':_0x3ac936}),_0x5c8056=await warehouse['findOne']({'name':_0x3d8788,'room':_0x3ec443});_0x295e26['return_sale'][_0x51744e(0x2c3)](_0x1f69e2=>{var _0x23cb9b=_0x51744e,_0x5db731=0x0;const _0x102944=_0x5c8056[_0x23cb9b(0x2d6)][_0x23cb9b(0x27d)](_0x5db48f=>{var _0x1bd3f6=_0x23cb9b;_0x5db48f[_0x1bd3f6(0x2de)]==_0x1f69e2[_0x1bd3f6(0x2de)]&&_0x5db48f[_0x1bd3f6(0x219)]==_0x1f69e2[_0x1bd3f6(0x219)]&&_0x5db48f[_0x1bd3f6(0x265)]==_0x1f69e2[_0x1bd3f6(0x265)]&&_0x5db48f[_0x1bd3f6(0x285)]==_0x1f69e2['bin']&&_0x5db48f[_0x1bd3f6(0x1e4)]==_0x1f69e2['bay']&&(_0x5db48f[_0x1bd3f6(0x28b)]=parseInt(_0x5db48f[_0x1bd3f6(0x28b)])+parseInt(_0x1f69e2[_0x1bd3f6(0x2c8)]),_0x5db731++);});_0x5db731=='0'&&(_0x5c8056[_0x23cb9b(0x2d6)]=_0x5c8056[_0x23cb9b(0x2d6)][_0x23cb9b(0x2b3)]({'product_name':_0x1f69e2[_0x23cb9b(0x2de)],'product_stock':_0x1f69e2[_0x23cb9b(0x2c8)],'primary_code':_0x1f69e2[_0x23cb9b(0x232)],'secondary_code':_0x1f69e2[_0x23cb9b(0x212)],'product_code':_0x1f69e2[_0x23cb9b(0x1e5)],'bay':_0x1f69e2['bay'],'bin':_0x1f69e2['bin'],'type':_0x1f69e2[_0x23cb9b(0x265)],'floorlevel':_0x1f69e2[_0x23cb9b(0x219)]})),console[_0x23cb9b(0x229)](_0x23cb9b(0x274),_0x5c8056);}),await _0x5c8056[_0x51744e(0x288)](),console[_0x51744e(0x229)](_0x31db85[_0x51744e(0x2e0)]);const _0x1f2dfc=new c_payment_data({'invoice':_0x3ac936,'customer':_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x1ed)],'reason':_0x51744e(0x259)});await _0x1f2dfc['save']();const _0x2f0b32=await master_shop[_0x51744e(0x2b7)]();console['log'](_0x51744e(0x28c),_0x2f0b32[0x0][_0x51744e(0x21e)]);const _0x2e7597=await email_settings[_0x51744e(0x2d3)](),_0x1981f2=await customer[_0x51744e(0x2d3)]({'name':_0x31db85[_0x51744e(0x2e0)][_0x51744e(0x1ed)]});console['log']('customer_data',_0x1981f2);_0x2f0b32[0x0][_0x51744e(0x2d5)]==0x1?(right_currency=_0x2f0b32[0x0][_0x51744e(0x24f)],left_currency=''):(right_currency='',left_currency=_0x2f0b32[0x0][_0x51744e(0x24f)]);var _0x6c7276=_0x5c5b5d,_0x14e319=_0x2fe44a,_0xa7b891='',_0x288dfe;for(_0x288dfe in _0x6c7276){_0xa7b891+=_0x51744e(0x20c)+_0x51744e(0x260)+_0x6c7276[_0x288dfe]+_0x51744e(0x20e)+_0x51744e(0x260)+_0x14e319[_0x288dfe]+'</td>'+_0x51744e(0x2a7);}console[_0x51744e(0x229)](_0x51744e(0x217),_0xa7b891);let _0x53753e=nodemailer[_0x51744e(0x1f6)]({'service':'gmail','auth':{'user':_0x2e7597['email'],'pass':_0x2e7597[_0x51744e(0x286)]}}),_0x483296={'from':_0x2e7597['email'],'to':_0x1981f2['email'],'subject':_0x51744e(0x1ee),'attachments':[{'filename':_0x51744e(0x2a8),'path':__dirname+_0x51744e(0x29d)+_0x51744e(0x23b)+_0x2f0b32[0x0][_0x51744e(0x21e)],'cid':'logo'}],'html':_0x51744e(0x25b)+_0x51744e(0x26e)+_0x51744e(0x207)+_0x51744e(0x2bb)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x51744e(0x27f)+'</div>'+_0x51744e(0x2bb)+'<h2>\x20'+_0x2f0b32[0x0][_0x51744e(0x227)]+_0x51744e(0x261)+'</div>'+_0x51744e(0x2d8)+_0x51744e(0x25f)+_0x51744e(0x2bb)+_0x51744e(0x2a4)+_0x51744e(0x22c)+_0x3ac936+'\x20'+_0x51744e(0x281)+_0x51744e(0x2dd)+_0xb5823f+'\x20'+'</span>'+_0x51744e(0x1dd)+_0x51744e(0x2d8)+_0x51744e(0x25d)+_0x51744e(0x1f1)+_0x51744e(0x20c)+_0x51744e(0x2ba)+_0x51744e(0x2e3)+_0x51744e(0x1dc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x51744e(0x2a7)+_0x51744e(0x271)+_0x51744e(0x244)+'\x20'+_0xa7b891+'\x20'+_0x51744e(0x208)+'</table>'+_0x51744e(0x2bb)+_0x51744e(0x283)+_0x51744e(0x1ec)+_0x2f0b32[0x0][_0x51744e(0x227)]+_0x51744e(0x1dd)+'</div>'+_0x51744e(0x2d8)+_0x51744e(0x2d7)};_0x53753e[_0x51744e(0x204)](_0x483296,function(_0x3bab8a,_0x24a847){var _0x19b1f9=_0x51744e;_0x3bab8a?(console[_0x19b1f9(0x229)](_0x3bab8a),console[_0x19b1f9(0x229)](_0x19b1f9(0x287))):console[_0x19b1f9(0x229)](_0x19b1f9(0x2ea));}),_0x31db85[_0x51744e(0x1f7)](_0x51744e(0x27b),_0x51744e(0x2a5)),_0x2516f8[_0x51744e(0x26c)](_0x51744e(0x2da));}catch(_0xe3cdf0){console['log'](_0xe3cdf0),_0x2516f8[_0x51744e(0x2b1)](0xc8)[_0x51744e(0x233)]({'message1':_0xe3cdf0[_0x51744e(0x203)]});}}),router[a0_0x3c7a7a(0x2c6)](a0_0x3c7a7a(0x28a),auth,async(_0x7ebf1f,_0x4e5ad6)=>{var _0xccc6d3=a0_0x3c7a7a;try{const {username:_0x9377b3,email:_0x58f3dd,role:_0x51cbf3}=_0x7ebf1f[_0xccc6d3(0x224)],_0x37e363=_0x7ebf1f[_0xccc6d3(0x224)],_0x26f17e=await profile[_0xccc6d3(0x2d3)]({'email':_0x37e363[_0xccc6d3(0x2eb)]}),_0x1c285e=await master_shop[_0xccc6d3(0x2b7)]();console[_0xccc6d3(0x229)]('barcode\x20Product\x20master',_0x1c285e);const _0x25192a=_0x7ebf1f[_0xccc6d3(0x26f)]['id'],_0x3c8352=await sales[_0xccc6d3(0x228)](_0x25192a);console[_0xccc6d3(0x229)](_0xccc6d3(0x220),_0x3c8352);if(_0x1c285e[0x0][_0xccc6d3(0x205)]==_0xccc6d3(0x213))var _0x1be627=users[_0xccc6d3(0x277)];else{if(_0x1c285e[0x0][_0xccc6d3(0x205)]==_0xccc6d3(0x1f2))var _0x1be627=users[_0xccc6d3(0x1f2)];else{if(_0x1c285e[0x0][_0xccc6d3(0x205)]==_0xccc6d3(0x1f4))var _0x1be627=users[_0xccc6d3(0x1f4)];else{if(_0x1c285e[0x0][_0xccc6d3(0x205)]==_0xccc6d3(0x26a))var _0x1be627=users[_0xccc6d3(0x26a)];else{if(_0x1c285e[0x0][_0xccc6d3(0x205)]=='French')var _0x1be627=users[_0xccc6d3(0x250)];else{if(_0x1c285e[0x0]['language']==_0xccc6d3(0x2c1))var _0x1be627=users[_0xccc6d3(0x2a9)];else{if(_0x1c285e[0x0][_0xccc6d3(0x205)]==_0xccc6d3(0x1e8))var _0x1be627=users['Chinese'];else{if(_0x1c285e[0x0][_0xccc6d3(0x205)]=='Arabic\x20(ae)')var _0x1be627=users['Arabic'];}}}}}}}_0x4e5ad6[_0xccc6d3(0x284)](_0xccc6d3(0x1e7),{'success':_0x7ebf1f[_0xccc6d3(0x1f7)](_0xccc6d3(0x27b)),'errors':_0x7ebf1f[_0xccc6d3(0x1f7)]('errors'),'role':_0x37e363,'profile':_0x26f17e,'alldata':_0x3c8352,'master_shop':_0x1c285e,'language':_0x1be627});}catch(_0x4f6ea3){console[_0xccc6d3(0x229)](_0x4f6ea3);}}),router[a0_0x3c7a7a(0x2ac)](a0_0x3c7a7a(0x262),async(_0x1e8390,_0x483046)=>{var _0x4c4ad3=a0_0x3c7a7a;const {product_code:_0x58d3d3,warehouse_name:_0xd3bbcc,rooms_data:_0x31fd7a,Roomslist:_0x7d80c}=_0x1e8390['body'],_0x3b9710=_0x7d80c[_0x4c4ad3(0x257)](','),_0x5a3d22=[];async function _0x35946a(_0x3e7fc0){var _0x970c57=_0x4c4ad3;const _0x5bb094=await warehouse[_0x970c57(0x21a)]([{'$match':{'name':_0xd3bbcc,'room':_0x3e7fc0}},{'$unwind':_0x970c57(0x1e9)},{'$match':{'product_details.primary_code':_0x58d3d3}},{'$group':{'_id':_0x970c57(0x235),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x970c57(0x1ef)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x970c57(0x2bd)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x970c57(0x2d9)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x970c57(0x275)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x970c57(0x264)},'storage':{'$first':_0x970c57(0x2dc)},'rack':{'$first':_0x970c57(0x249)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x970c57(0x2b9)},'maxPerUnit':{'$first':_0x970c57(0x298)},'batch_code':{'$first':_0x970c57(0x263)},'product_cat':{'$first':_0x970c57(0x2c2)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x970c57(0x2d2)},'invoice':{'$first':_0x970c57(0x293)},'actual_qty':{'$first':_0x970c57(0x276)},'actual_uom':{'$first':_0x970c57(0x241)}}}]),_0x312733=await warehouse[_0x970c57(0x21a)]([{'$match':{'name':_0xd3bbcc,'room':_0x3e7fc0}},{'$unwind':_0x970c57(0x1e9)},{'$match':{'product_details.secondary_code':_0x58d3d3}},{'$group':{'_id':_0x970c57(0x235),'name':{'$first':_0x970c57(0x1df)},'product_stock':{'$first':_0x970c57(0x1ef)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x970c57(0x2bd)},'product_code':{'$first':_0x970c57(0x21d)},'level':{'$first':_0x970c57(0x2d9)},'isle':{'$first':_0x970c57(0x2b4)},'type':{'$first':_0x970c57(0x275)},'pallet':{'$first':_0x970c57(0x211)},'unit':{'$first':_0x970c57(0x2e1)},'secondary_unit':{'$first':_0x970c57(0x264)},'storage':{'$first':_0x970c57(0x2dc)},'rack':{'$first':_0x970c57(0x249)},'expiry_date':{'$first':_0x970c57(0x218)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x970c57(0x298)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x970c57(0x293)}}}]);if(_0x5bb094['length']>0x0)_0x5a3d22[_0x970c57(0x1f8)](_0x5bb094);else _0x312733[_0x970c57(0x2cf)]>0x0&&_0x5a3d22[_0x970c57(0x1f8)](_0x312733);}const _0x430ad7=_0x3b9710[_0x4c4ad3(0x27d)](_0x1b75e1=>_0x35946a(_0x1b75e1));await Promise[_0x4c4ad3(0x214)](_0x430ad7),_0x483046[_0x4c4ad3(0x233)](_0x5a3d22);}),module['exports']=router;