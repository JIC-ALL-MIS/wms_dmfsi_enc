var a0_0x49752f=a0_0x42b0;(function(_0x33d07c,_0x37f3d6){var _0xf48bab=a0_0x42b0,_0x5a154b=_0x33d07c();while(!![]){try{var _0x2b4fbc=parseInt(_0xf48bab(0xfe))/0x1*(-parseInt(_0xf48bab(0xe2))/0x2)+-parseInt(_0xf48bab(0x152))/0x3*(parseInt(_0xf48bab(0x177))/0x4)+parseInt(_0xf48bab(0x1db))/0x5*(-parseInt(_0xf48bab(0x1a6))/0x6)+-parseInt(_0xf48bab(0x11e))/0x7*(parseInt(_0xf48bab(0xf1))/0x8)+-parseInt(_0xf48bab(0x165))/0x9*(-parseInt(_0xf48bab(0x1de))/0xa)+-parseInt(_0xf48bab(0x13f))/0xb+-parseInt(_0xf48bab(0x145))/0xc*(-parseInt(_0xf48bab(0x185))/0xd);if(_0x2b4fbc===_0x37f3d6)break;else _0x5a154b['push'](_0x5a154b['shift']());}catch(_0x1257c6){_0x5a154b['push'](_0x5a154b['shift']());}}}(a0_0x3831,0xa4c47));const express=require(a0_0x49752f(0x15a)),app=express(),router=express[a0_0x49752f(0x128)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x49752f(0x1c4)),nodemailer=require('nodemailer'),users=require(a0_0x49752f(0x10c));function a0_0x3831(){var _0x100bd1=['id_transact','actual_uom','json','log','catch','180414wxuYWn','image','Return\x20Goods','foreach\x20newproduct','floorlevel','unit','edit_sales','get','save','Sale\x20Return\x20Mail','$product_details.product_stock','$room','customer_data','warehouse','$product_details.maxPerUnit','Level','invoice','/view','find','flash','<h2>\x20','False','$sale_product.type','sale_qty','body','/../public','/preview/:id','Arabic','$product_details.primary_code','$sale_product.bay','../middleware/auth','/give_payment/:id','$sale_product.floorlevel','add\x20post','$customer','$date','role','secondary_unit','</tr>','push','Email\x20sent\x20successfully','$product_details.batch_code','English\x20(US)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','password','secondary_code','Sale\x20Return','prod_code','abs','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','forEach','level','135xtmVin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/all_sales/preview/','260ytXdcp','gmail','$product.product_name','return_data','Sales\x20Add\x20successfully','$product','barcode\x20user_id','batch_code','all_sales','Portuguese\x20(BR)','carton','sales\x20item\x20return\x20successfull','<tr>','136RehSoB','add_sales','product_data','sales_quantity','$finalize','prod_cat','/view/return_sales/:id','requested_qty','due_amount','</tbody>','sales\x20all_data','bin','length','<tbody\x20style=\x22text-align:\x20center;\x22>','customer','1965464WIaDOI','finalize','filter','\x20Order\x20Number\x20:\x20','$product_details.invoice','all_sales_barcode','return_sale','<strong>\x20Regards\x20</strong>','Ambient','then','</td>','master','$product_details.secondary_code','10525xPKYYW','<div>','$_id','$product_details.rack','Sales\x20Update\x20successfully','/invoice/:id','$product_details','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','SCRN','$product_details.actual_uom','/view/add_sale/product','site_title','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','currency_placement','../public/language/languages.json','primary_code','aggregate','$product_details.bay','product_details','English','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','message','$product_details.product_cat','return_qty','<html><head><title></title>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','</div>','product_name','Received\x20Payment\x20For\x20Sale','createTransport','staff','14gWaSon','Hindi','$product_details.storage','Error\x20Occurs','user','amount','random','French','product_list','$product_details.unit','Router','/barcode_scanner','$sale_product.quantity','error','edit_sales_view','string','$product_details.expiry_date','OUT-','RoomAssigned','$product_details.type','type','_id','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','sendMail','final','render','<hr\x20class=\x22my-3\x22>','stocks','toString','stock','expiry_date','</span>','1355948zPOrUe','Raw\x20Materials','$product_details._id','max_per_unit','Floor','findById','47754108pTPQEq','/view/add_sales/:id','<span\x20style=\x22float:\x20right;\x22>','maxperunit','padStart','findOne','email','Logo.png','product_code','$invoice','storage','status','$customers_docs','1204155LPEXVA','delivery_code','port','getFullYear','Arabic\x20(ae)','params','Receiving\x20Area','</head><body>','express','room_name','$name','Enclosed','logo','An\x20error\x20occurred.','room','rack','actual_qty','map','currency','14445zfgCFm','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','\x20Order\x20Date\x20:\x20','Chinese','quantity_notConverted','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','$product_details.bin','<h5>','back','date','floor','types','Return\x20Rooms','$product_details.production_date','$product_details.actual_qty','$note','12xxNObW','post','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','True','$warehouse_name','sale_product','/all_sales/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','name','$product_details.product_name','language','all','$sale_product.bin','13VwvliF','warehouse_name','</h5>','German','Portuguese','$product_details.secondary_unit','success','</table>','<h5\x20style=\x22text-align:\x20left;\x22>','stock_data','primary_unit','product_stock','errors','$product_details.product_code','delivery_date','</body></html>','slice','/view/:id','Spanish','Shelves','/view/add_sales','$product_details.level','$product_details.floorlevel','/upload/','bay','product','</thead>','$sale_product'];a0_0x3831=function(){return _0x100bd1;};return a0_0x3831();}router[a0_0x49752f(0x1ad)](a0_0x49752f(0x1b7),auth,async(_0x4b4437,_0x5ad078)=>{var _0x362ac6=a0_0x49752f;try{const {username:_0x51b2bd,email:_0x554ea9,role:_0x3b7c2f}=_0x4b4437[_0x362ac6(0x122)],_0x51151f=_0x4b4437[_0x362ac6(0x122)],_0x2981e0=await profile[_0x362ac6(0x14a)]({'email':_0x51151f['email']}),_0x3f8235=await master_shop[_0x362ac6(0x1b8)]();let _0xf8fbb6;if(_0x51151f[_0x362ac6(0x1ca)]==_0x362ac6(0x11d)){const _0x419c20=await staff[_0x362ac6(0x14a)]({'email':_0x51151f[_0x362ac6(0x14b)]});_0xf8fbb6=await sales[_0x362ac6(0x10e)]([{'$lookup':{'from':'customers','localField':_0x362ac6(0xf0),'foreignField':_0x362ac6(0x180),'as':'customers_docs'}},{'$unwind':_0x362ac6(0x151)},{'$unwind':_0x362ac6(0x1a0)},{'$group':{'_id':_0x362ac6(0x100),'invoice':{'$first':_0x362ac6(0x14e)},'customers':{'$first':_0x362ac6(0x1c8)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x362ac6(0x1a0)},'note':{'$first':_0x362ac6(0x176)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x362ac6(0x151)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x362ac6(0x1c3)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x362ac6(0x1bc)},'pallet':{'$addToSet':_0x362ac6(0x1c6)},'finalize':{'$first':_0x362ac6(0xe6)},'isAllowEdit':{'$first':_0x362ac6(0x1d7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xf8fbb6=await sales[_0x362ac6(0x10e)]([{'$lookup':{'from':'customers','localField':_0x362ac6(0xf0),'foreignField':_0x362ac6(0x180),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':_0x362ac6(0x1a0)},{'$group':{'_id':_0x362ac6(0x100),'invoice':{'$first':_0x362ac6(0x14e)},'customers':{'$first':_0x362ac6(0x1c8)},'date':{'$first':_0x362ac6(0x1c9)},'warehouse_name':{'$first':_0x362ac6(0x17c)},'sale_product':{'$push':_0x362ac6(0x1a0)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x362ac6(0x151)},'total_saleproduct_quantity':{'$sum':_0x362ac6(0x12a)},'level':{'$addToSet':_0x362ac6(0x1c3)},'isle':{'$addToSet':_0x362ac6(0x184)},'type':{'$addToSet':_0x362ac6(0x1bc)},'pallet':{'$addToSet':_0x362ac6(0x1c6)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x362ac6(0x1a4)](_0x362ac6(0xec),_0xf8fbb6);if(_0x3f8235[0x0][_0x362ac6(0x182)]==_0x362ac6(0x1d0)){var _0x225e7d=users[_0x362ac6(0x111)];console['log'](_0x225e7d);}else{if(_0x3f8235[0x0][_0x362ac6(0x182)]==_0x362ac6(0x11f))var _0x225e7d=users[_0x362ac6(0x11f)];else{if(_0x3f8235[0x0][_0x362ac6(0x182)]==_0x362ac6(0x188))var _0x225e7d=users[_0x362ac6(0x188)];else{if(_0x3f8235[0x0]['language']=='Spanish')var _0x225e7d=users[_0x362ac6(0x197)];else{if(_0x3f8235[0x0]['language']==_0x362ac6(0x125))var _0x225e7d=users[_0x362ac6(0x125)];else{if(_0x3f8235[0x0][_0x362ac6(0x182)]==_0x362ac6(0xde))var _0x225e7d=users[_0x362ac6(0x189)];else{if(_0x3f8235[0x0]['language']==_0x362ac6(0x169))var _0x225e7d=users[_0x362ac6(0x169)];else{if(_0x3f8235[0x0]['language']==_0x362ac6(0x156))var _0x225e7d=users['Arabic'];}}}}}}}_0x5ad078[_0x362ac6(0x138)](_0x362ac6(0xdd),{'success':_0x4b4437['flash'](_0x362ac6(0x18b)),'errors':_0x4b4437[_0x362ac6(0x1b9)](_0x362ac6(0x191)),'sales':_0xf8fbb6,'profile':_0x2981e0,'role':_0x51151f,'master_shop':_0x3f8235,'language':_0x225e7d});}catch(_0x204a25){console['log'](_0x204a25);}});async function getRandom8DigitNumber(){var _0x1ba223=a0_0x49752f;const _0x2ccae=0x989680,_0x548e47=0x5f5e0ff,_0x40c612=Math[_0x1ba223(0x171)](Math[_0x1ba223(0x124)]()*(_0x548e47-_0x2ccae+0x1))+_0x2ccae;var _0x398399;const _0x3d0980=await sales[_0x1ba223(0x14a)]({'invoice':_0x1ba223(0x12f)+_0x40c612});return _0x3d0980&&_0x3d0980[_0x1ba223(0xee)]>0x0?_0x398399=_0x1ba223(0x12f)+_0x40c612:_0x398399=_0x1ba223(0x12f)+_0x40c612,_0x398399;}function a0_0x42b0(_0x2f8eb2,_0x50451c){var _0x383196=a0_0x3831();return a0_0x42b0=function(_0x42b00,_0x326264){_0x42b00=_0x42b00-0xdb;var _0x37a5de=_0x383196[_0x42b00];return _0x37a5de;},a0_0x42b0(_0x2f8eb2,_0x50451c);}router[a0_0x49752f(0x1ad)](a0_0x49752f(0x199),auth,async(_0xc8f8dd,_0x32e793)=>{var _0x151dd4=a0_0x49752f;try{const {username:_0x4e15b3,email:_0x5d661f,role:_0x49a80a}=_0xc8f8dd[_0x151dd4(0x122)],_0x17c378=_0xc8f8dd['user'],_0x325782=await profile[_0x151dd4(0x14a)]({'email':_0x17c378[_0x151dd4(0x14b)]}),_0x2aaebb=await master_shop[_0x151dd4(0x1b8)](),_0x32a4b3=await customer[_0x151dd4(0x1b8)]({});let _0x2c1d67;if(_0x17c378['role']=='staff'){const _0x1e44cd=await staff[_0x151dd4(0x14a)]({'email':_0x17c378[_0x151dd4(0x14b)]});_0x2c1d67=await warehouse['aggregate']([{'$match':{'status':_0x151dd4(0x112),'name':_0x1e44cd[_0x151dd4(0x1b3)],'warehouse_category':_0x151dd4(0x140),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x151dd4(0x15c),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);}else _0x2c1d67=await warehouse[_0x151dd4(0x10e)]([{'$match':{'status':_0x151dd4(0x112),'warehouse_category':_0x151dd4(0x140),'name':{'$ne':_0x151dd4(0x1a8)}}},{'$group':{'_id':_0x151dd4(0x15c),'name':{'$first':_0x151dd4(0x15c)}}},{'$sort':{'name':0x1}}]);const _0x52179a=await product[_0x151dd4(0x1b8)]({});var _0x5f01a4=[_0x151dd4(0xf9),_0x151dd4(0x15d)];const _0x3d8225=await sales[_0x151dd4(0x1b8)]({}),_0x5744ca=_0x3d8225[_0x151dd4(0xee)]+0x1,_0x31eba6=_0x151dd4(0x12f)+_0x5744ca[_0x151dd4(0x13b)]()[_0x151dd4(0x149)](0x5,'0');if(_0x2aaebb[0x0][_0x151dd4(0x182)]==_0x151dd4(0x1d0)){var _0x2507c6=users['English'];console[_0x151dd4(0x1a4)](_0x2507c6);}else{if(_0x2aaebb[0x0][_0x151dd4(0x182)]==_0x151dd4(0x11f))var _0x2507c6=users['Hindi'];else{if(_0x2aaebb[0x0][_0x151dd4(0x182)]==_0x151dd4(0x188))var _0x2507c6=users[_0x151dd4(0x188)];else{if(_0x2aaebb[0x0][_0x151dd4(0x182)]=='Spanish')var _0x2507c6=users['Spanish'];else{if(_0x2aaebb[0x0][_0x151dd4(0x182)]==_0x151dd4(0x125))var _0x2507c6=users['French'];else{if(_0x2aaebb[0x0]['language']=='Portuguese\x20(BR)')var _0x2507c6=users[_0x151dd4(0x189)];else{if(_0x2aaebb[0x0][_0x151dd4(0x182)]==_0x151dd4(0x169))var _0x2507c6=users[_0x151dd4(0x169)];else{if(_0x2aaebb[0x0][_0x151dd4(0x182)]==_0x151dd4(0x156))var _0x2507c6=users[_0x151dd4(0x1c1)];}}}}}}}const _0x58a9f3=getRandom8DigitNumber();_0x58a9f3[_0x151dd4(0xfa)](_0x19edc5=>{var _0x3d4d32=_0x151dd4;_0x32e793[_0x3d4d32(0x138)](_0x3d4d32(0xe3),{'success':_0xc8f8dd[_0x3d4d32(0x1b9)](_0x3d4d32(0x18b)),'errors':_0xc8f8dd[_0x3d4d32(0x1b9)](_0x3d4d32(0x191)),'role':_0x17c378,'profile':_0x325782,'customer':_0x32a4b3,'warehouse':_0x2c1d67,'product':_0x52179a,'invoice':_0x19edc5,'master_shop':_0x2aaebb,'language':_0x2507c6,'rooms_data':_0x5f01a4});})[_0x151dd4(0x1a5)](_0x434ca2=>{var _0x39323e=_0x151dd4;_0xc8f8dd[_0x39323e(0x1b9)](_0x39323e(0x191),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x32e793['redirect']('/all_sales/view');});}catch(_0x3274c8){console['log'](_0x3274c8);}}),router[a0_0x49752f(0x1ad)](a0_0x49752f(0x146),auth,async(_0x2ebc59,_0x4aaacf)=>{var _0x3b9392=a0_0x49752f;try{const _0x53a7a2=_0x2ebc59[_0x3b9392(0x157)]['id'];console[_0x3b9392(0x1a4)](_0x53a7a2);const _0x332b7d=await product[_0x3b9392(0x1b8)](),_0x389c53=await purchases[_0x3b9392(0x10e)]([{'$match':{'warehouse_name':_0x53a7a2}},{'$unwind':_0x3b9392(0x1e3)},{'$group':{'_id':_0x3b9392(0x1e0)}}]);console[_0x3b9392(0x1a4)]('purchases_data',_0x389c53),_0x4aaacf['status'](0xc8)['json']({'purchases_data':_0x389c53,'product_data':_0x332b7d});}catch(_0x44fe50){console[_0x3b9392(0x1a4)](_0x44fe50);}}),router[a0_0x49752f(0x178)](a0_0x49752f(0x108),auth,async(_0x10d07b,_0x28d02e)=>{var _0x1e5c54=a0_0x49752f;try{const {warehouse_data:_0x58aa51,product_data:_0x575f25}=_0x10d07b[_0x1e5c54(0x1be)];console['log'](_0x10d07b['body'][_0x1e5c54(0xe4)]);;const _0x530581=await master_shop['find']();console[_0x1e5c54(0x1a4)](_0x1e5c54(0xfc),_0x530581);const _0x385608=await product[_0x1e5c54(0x14a)]({'name':_0x575f25});console['log'](_0x1e5c54(0x19e),_0x385608);const _0x3465a7=await warehouse[_0x1e5c54(0x10e)]([{'$match':{'name':_0x58aa51}},{'$unwind':_0x1e5c54(0x104)},{'$match':{'product_details.product_name':_0x575f25}},{'$group':{'_id':_0x1e5c54(0x181),'product_stock':{'$first':'$product_details.product_stock'}}}]);console[_0x1e5c54(0x1a4)](_0x1e5c54(0x18e),_0x3465a7),_0x28d02e['status'](0xc8)[_0x1e5c54(0x1a3)]({'master':_0x530581,'new_product':_0x385608,'stock_data':_0x3465a7});}catch(_0x13bb23){console[_0x1e5c54(0x1a4)](_0x13bb23);}}),router[a0_0x49752f(0x178)]('/view/add_sales',auth,async(_0x5dcc18,_0x59f176)=>{var _0x4ea9c9=a0_0x49752f;try{const {invoice:_0x26da0c,date:_0x5e02fd,warehouse_name:_0x1045e1,product_name:_0x4d644a,stock:_0xf05352,quantity:_0xebdeec,note:_0x36cc14,room:_0x232fcf,primary_code:_0x2a3d9b,secondary_code:_0x5b9480,prod_code:_0x40a887,level:_0x4c2e4e,isle:_0x59de0a,pallet:_0x1d8c33,batch_code:_0x33ee8c,SCRN:_0x1db09a,expiry_date:_0x15042c}=_0x5dcc18[_0x4ea9c9(0x1be)];if(typeof _0x4d644a==_0x4ea9c9(0x12d))var _0x87eae=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x11a)]],_0x474871=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x13c)]],_0x227476=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xdf)]],_0x1a311a=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x10d)]],_0x27053c=[_0x5dcc18['body'][_0x4ea9c9(0x1d3)]],_0x253ce5=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1d5)]],_0x1faaff=[_0x5dcc18[_0x4ea9c9(0x1be)]['level']],_0x26f950=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x18f)]],_0x481ee5=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1cb)]],_0x4063cf=[_0x5dcc18['body']['batch_code']],_0x426d81=[_0x5dcc18[_0x4ea9c9(0x1be)]['expiry_date']],_0x2aabe1=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x142)]],_0x3b5c9b=[_0x5dcc18['body'][_0x4ea9c9(0x134)]],_0x2b4bc4=[_0x5dcc18['body'][_0x4ea9c9(0xe9)]],_0x29233f=[_0x5dcc18[_0x4ea9c9(0x1be)]['delivery_date']],_0x131057=[_0x5dcc18[_0x4ea9c9(0x1be)]['delivery_code']],_0x4ecfac=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xe7)]],_0xfd508=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x166)]],_0x29631a=[_0x5dcc18['body'][_0x4ea9c9(0x130)]],_0x1e704e=[_0x5dcc18[_0x4ea9c9(0x1be)]['prod_invoice']],_0x52d5af=[_0x5dcc18['body'][_0x4ea9c9(0x162)]],_0xd86617=[_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1a2)]],_0x4ec0d7=[_0x5dcc18['body']['id_transact']];else var _0x87eae=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x11a)]],_0x474871=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x13c)]],_0x227476=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xdf)]],_0x1a311a=[..._0x5dcc18[_0x4ea9c9(0x1be)]['primary_code']],_0x27053c=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1d3)]],_0x253ce5=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1d5)]],_0x1faaff=[..._0x5dcc18['body'][_0x4ea9c9(0x1da)]],_0x26f950=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x18f)]],_0x481ee5=[..._0x5dcc18['body'][_0x4ea9c9(0x1cb)]],_0x4063cf=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xdc)]],_0x426d81=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x13d)]],_0x2aabe1=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x142)]],_0x3b5c9b=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x134)]],_0x2b4bc4=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xe9)]],_0x29233f=[..._0x5dcc18['body'][_0x4ea9c9(0x193)]],_0x131057=[..._0x5dcc18['body'][_0x4ea9c9(0x153)]],_0x4ecfac=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xe7)]],_0xfd508=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x166)]],_0x29631a=[..._0x5dcc18['body']['RoomAssigned']],_0x1e704e=[..._0x5dcc18['body']['prod_invoice']],_0x52d5af=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x162)]],_0xd86617=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1a2)]],_0x4ec0d7=[..._0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0x1a1)]];const _0x280a78=_0x87eae[_0x4ea9c9(0x163)](_0x161790=>{return _0x161790={'product_name':_0x161790};});_0x474871[_0x4ea9c9(0x1d9)]((_0x46de54,_0x2528a6)=>{var _0x56c09a=_0x4ea9c9;_0x280a78[_0x2528a6]['stock']=Math[_0x56c09a(0x1d6)](_0x46de54);}),_0x52d5af[_0x4ea9c9(0x1d9)]((_0x542705,_0x42cbcd)=>{var _0x2b4d06=_0x4ea9c9;_0x280a78[_0x42cbcd][_0x2b4d06(0x162)]=Math[_0x2b4d06(0x1d6)](_0x542705);}),_0xd86617[_0x4ea9c9(0x1d9)]((_0xaf61ac,_0x1eca78)=>{var _0x8080a8=_0x4ea9c9;_0x280a78[_0x1eca78][_0x8080a8(0x1a2)]=_0xaf61ac;}),_0x4ec0d7[_0x4ea9c9(0x1d9)]((_0x211612,_0x1160be)=>{_0x280a78[_0x1160be]['id_transaction_from']=_0x211612;}),_0x227476[_0x4ea9c9(0x1d9)]((_0x5ce4e7,_0x3906ef)=>{var _0x1085ab=_0x4ea9c9;_0x280a78[_0x3906ef][_0x1085ab(0x166)]=_0x5ce4e7;}),_0x1a311a['forEach']((_0x182b8c,_0x1397a8)=>{var _0x548c22=_0x4ea9c9;_0x280a78[_0x1397a8][_0x548c22(0x10d)]=_0x182b8c;}),_0x27053c[_0x4ea9c9(0x1d9)]((_0x5da95a,_0x2ebd92)=>{var _0xed0943=_0x4ea9c9;_0x280a78[_0x2ebd92][_0xed0943(0x1d3)]=_0x5da95a;}),_0x253ce5[_0x4ea9c9(0x1d9)]((_0x4d8817,_0x903b1c)=>{var _0x3381b9=_0x4ea9c9;_0x280a78[_0x903b1c][_0x3381b9(0x14d)]=_0x4d8817;}),_0x1faaff[_0x4ea9c9(0x1d9)]((_0x1987b1,_0x73a1f1)=>{_0x29631a['forEach']((_0x13ffa2,_0x229cb2)=>{var _0x55f867=a0_0x42b0;if(_0x13ffa2==_0x55f867(0x158)&&_0x73a1f1==_0x229cb2){var _0xb8a27e=_0x1987b1[_0x55f867(0x195)](0x3);_0x280a78[_0x73a1f1][_0x55f867(0x14f)]=_0x1987b1[0x0],_0x280a78[_0x73a1f1][_0x55f867(0x161)]=_0x1987b1[0x1],_0x280a78[_0x73a1f1][_0x55f867(0x19d)]=0x0,_0x280a78[_0x73a1f1][_0x55f867(0xed)]=0x0,_0x280a78[_0x73a1f1][_0x55f867(0x132)]=_0x55f867(0x143),_0x280a78[_0x73a1f1][_0x55f867(0x1aa)]=_0xb8a27e;}else{if(_0x13ffa2==_0x55f867(0x198)&&_0x73a1f1==_0x229cb2){var _0xb8a27e=_0x1987b1[_0x55f867(0x195)](0x3);_0x280a78[_0x73a1f1][_0x55f867(0x14f)]=_0x1987b1[0x0],_0x280a78[_0x73a1f1][_0x55f867(0x161)]=_0x1987b1[0x1],_0x280a78[_0x73a1f1][_0x55f867(0x19d)]=0x0,_0x280a78[_0x73a1f1][_0x55f867(0xed)]=0x0,_0x280a78[_0x73a1f1][_0x55f867(0x132)]=_0x55f867(0x143),_0x280a78[_0x73a1f1][_0x55f867(0x1aa)]=_0x1987b1[0x5];}else{if(_0x73a1f1==_0x229cb2){var _0x407a91;if(_0x1987b1[0x4]=='L')_0x407a91=_0x55f867(0x1b5);else _0x1987b1[0x4]=='F'&&(_0x407a91=_0x55f867(0x143));_0x280a78[_0x73a1f1][_0x55f867(0x14f)]=_0x1987b1[0x0],_0x280a78[_0x73a1f1][_0x55f867(0x161)]=_0x1987b1[0x1],_0x280a78[_0x73a1f1][_0x55f867(0x19d)]=_0x1987b1[0x2],_0x280a78[_0x73a1f1][_0x55f867(0xed)]=_0x1987b1[0x3],_0x280a78[_0x73a1f1]['type']=_0x407a91,_0x280a78[_0x73a1f1][_0x55f867(0x1aa)]=_0x1987b1[0x5];}}}});}),_0x26f950[_0x4ea9c9(0x1d9)]((_0x37cfd5,_0x8710f)=>{var _0x4d4b69=_0x4ea9c9;_0x280a78[_0x8710f][_0x4d4b69(0x1ab)]=_0x37cfd5;}),_0x481ee5[_0x4ea9c9(0x1d9)]((_0x5b324e,_0x7b8245)=>{var _0x38298a=_0x4ea9c9;_0x280a78[_0x7b8245][_0x38298a(0x1cb)]=_0x5b324e;}),_0x4063cf[_0x4ea9c9(0x1d9)]((_0x428d4a,_0x27d55a)=>{var _0x215a68=_0x4ea9c9;_0x280a78[_0x27d55a][_0x215a68(0xdc)]=_0x428d4a;}),_0x426d81['forEach']((_0x3eae69,_0xa85d30)=>{var _0x4165b3=_0x4ea9c9;_0x280a78[_0xa85d30][_0x4165b3(0x13d)]=_0x3eae69;}),_0x2aabe1[_0x4ea9c9(0x1d9)]((_0x12f2e3,_0x3b0908)=>{_0x280a78[_0x3b0908]['maxperunit']=_0x12f2e3;}),_0x3b5c9b[_0x4ea9c9(0x1d9)]((_0x27356a,_0x4f39ba)=>{var _0x3ed0c9=_0x4ea9c9;_0x280a78[_0x4f39ba][_0x3ed0c9(0x134)]=_0x27356a;}),_0x2b4bc4[_0x4ea9c9(0x1d9)]((_0x5e019e,_0x491258)=>{var _0x2cfb20=_0x4ea9c9;_0x280a78[_0x491258][_0x2cfb20(0xe9)]=_0x5e019e;}),_0x29233f[_0x4ea9c9(0x1d9)]((_0x5158ad,_0x49c684)=>{var _0x2842db=_0x4ea9c9;_0x280a78[_0x49c684][_0x2842db(0x193)]=_0x5158ad;}),_0x131057[_0x4ea9c9(0x1d9)]((_0x276505,_0x35a727)=>{var _0x2469fe=_0x4ea9c9;_0x280a78[_0x35a727][_0x2469fe(0x153)]=_0x276505;}),_0x4ecfac[_0x4ea9c9(0x1d9)]((_0x2d4bd7,_0x5cc130)=>{var _0x84ab24=_0x4ea9c9;_0x280a78[_0x5cc130][_0x84ab24(0xe7)]=_0x2d4bd7;}),_0xfd508['forEach']((_0x5087de,_0x21d9d1)=>{_0x280a78[_0x21d9d1]['quantity_notConverted']=_0x5087de;}),_0x29631a[_0x4ea9c9(0x1d9)]((_0x2a2031,_0x4f22a5)=>{var _0x4321a8=_0x4ea9c9;_0x280a78[_0x4f22a5][_0x4321a8(0x15b)]=_0x2a2031;}),_0x1e704e[_0x4ea9c9(0x1d9)]((_0x812db,_0x425b33)=>{var _0x3978c1=_0x4ea9c9;_0x280a78[_0x425b33][_0x3978c1(0x1b6)]=_0x812db;});var _0x196468=0x0;_0x280a78[_0x4ea9c9(0x1d9)](_0x3b45b4=>{var _0x36ec09=_0x4ea9c9;(_0x3b45b4[_0x36ec09(0x13c)]<_0x3b45b4[_0x36ec09(0x16a)]||_0x3b45b4[_0x36ec09(0x16a)]==0x0)&&(console[_0x36ec09(0x1a4)]('foreach\x20newproduct',_0x3b45b4),_0x196468++);});const _0x484f84=_0x280a78[_0x4ea9c9(0xf3)](_0x4159ac=>_0x4159ac[_0x4ea9c9(0x166)]!=='0'&&_0x4159ac[_0x4ea9c9(0x166)]!==''),_0x115f04=new sales({'invoice':_0x26da0c,'customer':_0x5dcc18[_0x4ea9c9(0x1be)][_0x4ea9c9(0xf0)],'date':_0x5e02fd,'warehouse_name':_0x1045e1,'sale_product':_0x484f84,'note':_0x36cc14,'room':_0x232fcf,'primary_code':_0x2a3d9b,'secondary_code':_0x5b9480,'prod_code':_0x40a887,'SCRN':_0x1db09a}),_0x54fdf5=await _0x115f04[_0x4ea9c9(0x1ae)]();_0x5dcc18[_0x4ea9c9(0x1b9)](_0x4ea9c9(0x18b),_0x4ea9c9(0x1e2)),_0x59f176[_0x4ea9c9(0x16c)](_0x4ea9c9(0x1dd)+_0x54fdf5[_0x4ea9c9(0x133)]);}catch(_0x2158f3){console[_0x4ea9c9(0x1a4)](_0x2158f3);}}),router[a0_0x49752f(0x1ad)](a0_0x49752f(0x1c0),auth,async(_0xa7a25,_0x53f465)=>{var _0x4d3d17=a0_0x49752f;try{const {username:_0x5577bb,email:_0x48dd24,role:_0x3a2640}=_0xa7a25[_0x4d3d17(0x122)],_0x4e68e9=_0xa7a25[_0x4d3d17(0x122)],_0x5a21aa=await profile[_0x4d3d17(0x14a)]({'email':_0x4e68e9['email']}),_0x2c9636=await master_shop['find'](),_0x17e1f0=_0xa7a25[_0x4d3d17(0x157)]['id'],_0x184fb7=await sales[_0x4d3d17(0x144)](_0x17e1f0),_0x9af61f=await warehouse[_0x4d3d17(0x10e)]([{'$match':{'name':_0x184fb7[_0x4d3d17(0x186)]}},{'$unwind':_0x4d3d17(0x104)},{'$group':{'_id':_0x4d3d17(0x141),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4d3d17(0x1b0)},'bay':{'$first':_0x4d3d17(0x10f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4d3d17(0x131)},'floorlevel':{'$first':_0x4d3d17(0x19b)},'primary_code':{'$first':_0x4d3d17(0x1c2)},'secondary_code':{'$first':_0x4d3d17(0xfd)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4d3d17(0x120)},'rack':{'$first':_0x4d3d17(0x101)},'expiry_date':{'$first':_0x4d3d17(0x12e)},'production_date':{'$first':_0x4d3d17(0x174)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x1dc83a=await customer[_0x4d3d17(0x1b8)]({});let _0xe442f3;if(_0x4e68e9[_0x4d3d17(0x1ca)]==_0x4d3d17(0x11d)){const _0x3b5c36=await staff[_0x4d3d17(0x14a)]({'email':_0x4e68e9['email']});_0xe442f3=await warehouse[_0x4d3d17(0x10e)]([{'$match':{'status':_0x4d3d17(0x112),'name':_0x3b5c36[_0x4d3d17(0x1b3)]}},{'$group':{'_id':_0x4d3d17(0x15c),'name':{'$first':_0x4d3d17(0x15c)}}}]);}else _0xe442f3=await warehouse[_0x4d3d17(0x10e)]([{'$match':{'status':_0x4d3d17(0x112)}},{'$group':{'_id':_0x4d3d17(0x15c),'name':{'$first':_0x4d3d17(0x15c)}}}]);const _0x2842cd=await product['find']({}),_0x57caba=await suppliers[_0x4d3d17(0x1b8)]({});if(_0x2c9636[0x0][_0x4d3d17(0x182)]=='English\x20(US)'){var _0x5a1fd3=users[_0x4d3d17(0x111)];console[_0x4d3d17(0x1a4)](_0x5a1fd3);}else{if(_0x2c9636[0x0]['language']==_0x4d3d17(0x11f))var _0x5a1fd3=users[_0x4d3d17(0x11f)];else{if(_0x2c9636[0x0][_0x4d3d17(0x182)]=='German')var _0x5a1fd3=users[_0x4d3d17(0x188)];else{if(_0x2c9636[0x0][_0x4d3d17(0x182)]==_0x4d3d17(0x197))var _0x5a1fd3=users[_0x4d3d17(0x197)];else{if(_0x2c9636[0x0]['language']==_0x4d3d17(0x125))var _0x5a1fd3=users['French'];else{if(_0x2c9636[0x0]['language']=='Portuguese\x20(BR)')var _0x5a1fd3=users[_0x4d3d17(0x189)];else{if(_0x2c9636[0x0]['language']=='Chinese')var _0x5a1fd3=users['Chinese'];else{if(_0x2c9636[0x0][_0x4d3d17(0x182)]==_0x4d3d17(0x156))var _0x5a1fd3=users['Arabic'];}}}}}}}_0x53f465[_0x4d3d17(0x138)](_0x4d3d17(0x12c),{'success':_0xa7a25[_0x4d3d17(0x1b9)](_0x4d3d17(0x18b)),'errors':_0xa7a25[_0x4d3d17(0x1b9)]('errors'),'role':_0x4e68e9,'profile':_0x5a21aa,'customer':_0x1dc83a,'warehouse':_0xe442f3,'product':_0x9af61f,'user':_0x184fb7,'master_shop':_0x2c9636,'unit':_0x2842cd,'language':_0x5a1fd3,'suppliers':_0x57caba});}catch(_0x1fddb6){console[_0x4d3d17(0x1a4)](_0x1fddb6);}}),router['post'](a0_0x49752f(0x1c0),auth,async(_0x4f2997,_0x1686a8)=>{var _0x4cc545=a0_0x49752f;try{const _0x4c106b=_0x4f2997[_0x4cc545(0x157)]['id'],{invoice:_0x2a75f2,warehouse_name:_0x2bf05e,room:_0x116c34}=_0x4f2997[_0x4cc545(0x1be)],_0x53d70a=await sales['findOne']({'invoice':_0x2a75f2}),_0x5d4523=_0x53d70a['sale_product']['map'](async _0x316222=>{var _0x1665dc=_0x4cc545,_0x445906=await warehouse[_0x1665dc(0x14a)]({'name':_0x2bf05e,'room':_0x316222[_0x1665dc(0x15b)],'warehouse_category':_0x1665dc(0x140)});const _0x7525=_0x445906['product_details'][_0x1665dc(0x163)](_0x1d678a=>{var _0x5eb9bb=_0x1665dc;_0x1d678a[_0x5eb9bb(0x11a)]==_0x316222['product_name']&&_0x1d678a[_0x5eb9bb(0x1aa)]==_0x316222[_0x5eb9bb(0x1aa)]&&_0x1d678a[_0x5eb9bb(0x132)]==_0x316222[_0x5eb9bb(0x132)]&&_0x1d678a['bin']==_0x316222[_0x5eb9bb(0xed)]&&_0x1d678a[_0x5eb9bb(0x19d)]==_0x316222[_0x5eb9bb(0x19d)]&&_0x1d678a[_0x5eb9bb(0x161)]==_0x316222[_0x5eb9bb(0x161)]&&_0x1d678a[_0x5eb9bb(0x14f)]==_0x316222[_0x5eb9bb(0x14f)]&&_0x1d678a[_0x5eb9bb(0x13d)]==_0x316222[_0x5eb9bb(0x13d)]&&_0x1d678a[_0x5eb9bb(0xdc)]==_0x316222[_0x5eb9bb(0xdc)]&&_0x1d678a[_0x5eb9bb(0x1b6)]==_0x316222[_0x5eb9bb(0x1b6)]&&_0x1d678a[_0x5eb9bb(0x133)]==_0x316222['id_transaction_from']&&(_0x1d678a['product_stock']=Math[_0x5eb9bb(0x179)](0x0,Math['abs'](_0x1d678a[_0x5eb9bb(0x190)])-Math['abs'](_0x316222[_0x5eb9bb(0x166)])));});return _0x445906;});Promise[_0x4cc545(0x183)](_0x5d4523)[_0x4cc545(0xfa)](async _0x23f768=>{var _0x466251=_0x4cc545;try{for(const _0x2866ef of _0x23f768){await _0x2866ef[_0x466251(0x1ae)]();}_0x53d70a[_0x466251(0xf2)]=_0x466251(0x17b);const _0x286695=await _0x53d70a['save'](),_0x135d81=await master_shop['find'](),_0x8394c9=await email_settings[_0x466251(0x14a)](),_0xfe9039=await supervisor_settings[_0x466251(0x1b8)]();var _0x22b11e=_0x53d70a['sale_product'],_0x430549='',_0x163b1b;for(_0x163b1b in _0x22b11e){_0x430549+=_0x466251(0xe1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22b11e[_0x163b1b][_0x466251(0x11a)]+_0x466251(0xfb)+_0x466251(0x105)+_0x22b11e[_0x163b1b][_0x466251(0x14d)]+_0x466251(0xfb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22b11e[_0x163b1b][_0x466251(0x166)]+_0x466251(0xfb)+_0x466251(0x105)+_0x22b11e[_0x163b1b]['unit']+_0x466251(0xfb)+_0x466251(0x105)+_0x22b11e[_0x163b1b]['secondary_unit']+'</td>'+_0x466251(0x105)+_0x53d70a[_0x466251(0x186)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x22b11e[_0x163b1b][_0x466251(0x15b)]+_0x466251(0xfb)+_0x466251(0x105)+_0x22b11e[_0x163b1b][_0x466251(0x14f)]+_0x22b11e[_0x163b1b][_0x466251(0x161)]+_0x22b11e[_0x163b1b]['bay']+_0x22b11e[_0x163b1b][_0x466251(0xed)]+_0x22b11e[_0x163b1b][_0x466251(0x132)][0x0]+_0x22b11e[_0x163b1b]['floorlevel']+_0x466251(0xfb),_0x466251(0x1cc);}let _0x14982f=nodemailer[_0x466251(0x11c)]({'host':_0x8394c9['host'],'port':Number(_0x8394c9[_0x466251(0x154)]),'secure':![],'auth':{'user':_0x8394c9[_0x466251(0x14b)],'pass':_0x8394c9[_0x466251(0x1d2)]}}),_0x4d002c={'from':_0x8394c9[_0x466251(0x14b)],'to':_0xfe9039[0x0]['RMSEmail'],'subject':'Sales\x20Mail','attachments':[{'filename':_0x466251(0x14c),'path':__dirname+_0x466251(0x1bf)+_0x466251(0x19c)+_0x135d81[0x0][_0x466251(0x1a7)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x466251(0x117)+_0x466251(0x159)+_0x466251(0xff)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x466251(0xff)+_0x466251(0x1d1)+_0x466251(0x119)+_0x466251(0xff)+_0x466251(0x1ba)+_0x135d81[0x0][_0x466251(0x109)]+'\x20</h2>'+_0x466251(0x119)+_0x466251(0x119)+_0x466251(0x139)+'<div>'+_0x466251(0x18d)+_0x466251(0xf4)+_0x53d70a[_0x466251(0x1b6)]+'\x20'+_0x466251(0x147)+_0x466251(0x168)+_0x53d70a[_0x466251(0x170)]+'\x20'+_0x466251(0x13e)+'</h5>'+'</div>'+_0x466251(0x1dc)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x466251(0x167)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x466251(0x113)+_0x466251(0x17a)+_0x466251(0x16b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x466251(0x1cc)+_0x466251(0x19f)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x430549+'\x20'+_0x466251(0xeb)+_0x466251(0x18c)+_0x466251(0xff)+'<strong>\x20Regards\x20</strong>'+_0x466251(0x16e)+_0x135d81[0x0][_0x466251(0x109)]+_0x466251(0x187)+'</div>'+_0x466251(0x119)+_0x466251(0x194)};_0x14982f[_0x466251(0x136)](_0x4d002c,function(_0x5be2d4,_0x437fe3){var _0x2e32da=_0x466251;_0x5be2d4?(console[_0x2e32da(0x1a4)](_0x5be2d4),console[_0x2e32da(0x1a4)](_0x2e32da(0x121))):console[_0x2e32da(0x1a4)](_0x2e32da(0x1ce));}),_0x4f2997[_0x466251(0x1b9)]('success','Sales\x20Update\x20successfully'),_0x1686a8['redirect'](_0x466251(0x1dd)+_0x4c106b);}catch(_0x13637f){console[_0x466251(0x12b)](_0x13637f),_0x1686a8['status'](0x1f4)[_0x466251(0x1a3)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4cc545(0x1a5)](_0x39cd8b=>{var _0x2fd23f=_0x4cc545;console[_0x2fd23f(0x12b)](_0x39cd8b),_0x1686a8[_0x2fd23f(0x150)](0x1f4)[_0x2fd23f(0x1a3)]({'error':_0x2fd23f(0x15f)});});}catch(_0x24676e){console[_0x4cc545(0x1a4)](_0x24676e);}}),router['get'](a0_0x49752f(0x196),auth,async(_0xa3f0c,_0x3f9f5c)=>{var _0x27135=a0_0x49752f;try{const {username:_0x2d42d1,email:_0x23f782,role:_0x32a357}=_0xa3f0c[_0x27135(0x122)],_0x3ac359=_0xa3f0c[_0x27135(0x122)],_0x1069b1=await profile['findOne']({'email':_0x3ac359[_0x27135(0x14b)]}),_0x5a976b=await master_shop['find'](),_0xc6ff89=_0xa3f0c[_0x27135(0x157)]['id'],_0x10e367=await sales['findById'](_0xc6ff89);var _0x52b718=[_0x27135(0xf9),_0x27135(0x15d)];const _0x5180c3=await warehouse['aggregate']([{'$match':{'name':_0x10e367[_0x27135(0x186)],'warehouse_category':_0x27135(0x140)}},{'$unwind':_0x27135(0x104)},{'$group':{'_id':_0x27135(0x141),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x27135(0x10f)},'bin':{'$first':_0x27135(0x16d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x27135(0x19b)},'primary_code':{'$first':_0x27135(0x1c2)},'secondary_code':{'$first':_0x27135(0xfd)},'product_code':{'$first':_0x27135(0x192)},'storage':{'$first':_0x27135(0x120)},'rack':{'$first':'$product_details.rack'}}}]),_0x504b3e=await customer[_0x27135(0x1b8)]({});let _0x2aaf4d;if(_0x3ac359['role']==_0x27135(0x11d)){const _0x1c8863=await staff[_0x27135(0x14a)]({'email':_0x3ac359[_0x27135(0x14b)]});_0x2aaf4d=await warehouse[_0x27135(0x10e)]([{'$match':{'status':_0x27135(0x112),'name':_0x1c8863[_0x27135(0x1b3)],'warehouse_category':_0x27135(0x140)}},{'$group':{'_id':_0x27135(0x15c),'name':{'$first':_0x27135(0x15c)}}}]);}else _0x2aaf4d=await warehouse[_0x27135(0x10e)]([{'$match':{'status':_0x27135(0x112),'warehouse_category':_0x27135(0x140)}},{'$group':{'_id':_0x27135(0x15c),'name':{'$first':_0x27135(0x15c)}}}]);const _0x4b101f=await product[_0x27135(0x1b8)]({});if(_0x5a976b[0x0][_0x27135(0x182)]==_0x27135(0x1d0)){var _0x427b54=users['English'];console[_0x27135(0x1a4)](_0x427b54);}else{if(_0x5a976b[0x0]['language']=='Hindi')var _0x427b54=users[_0x27135(0x11f)];else{if(_0x5a976b[0x0][_0x27135(0x182)]=='German')var _0x427b54=users[_0x27135(0x188)];else{if(_0x5a976b[0x0]['language']==_0x27135(0x197))var _0x427b54=users[_0x27135(0x197)];else{if(_0x5a976b[0x0]['language']=='French')var _0x427b54=users[_0x27135(0x125)];else{if(_0x5a976b[0x0][_0x27135(0x182)]==_0x27135(0xde))var _0x427b54=users[_0x27135(0x189)];else{if(_0x5a976b[0x0]['language']=='Chinese')var _0x427b54=users[_0x27135(0x169)];else{if(_0x5a976b[0x0]['language']==_0x27135(0x156))var _0x427b54=users[_0x27135(0x1c1)];}}}}}}}_0x3f9f5c[_0x27135(0x138)](_0x27135(0x1ac),{'success':_0xa3f0c[_0x27135(0x1b9)](_0x27135(0x18b)),'errors':_0xa3f0c[_0x27135(0x1b9)]('errors'),'role':_0x3ac359,'profile':_0x1069b1,'customer':_0x504b3e,'warehouse':_0x2aaf4d,'product':_0x5180c3,'user':_0x10e367,'master_shop':_0x5a976b,'unit':_0x4b101f,'language':_0x427b54});}catch(_0x39af04){console[_0x27135(0x1a4)](_0x39af04);}}),router[a0_0x49752f(0x178)](a0_0x49752f(0x196),auth,async(_0x8cb079,_0x2bc1af)=>{var _0x9a5d3=a0_0x49752f;try{const _0x5efa9c=_0x8cb079[_0x9a5d3(0x157)]['id'],_0x495cde=await sales[_0x9a5d3(0x14a)]({'_id':_0x8cb079['params']['id']}),_0x4df746=await warehouse['findOne']({'name':_0x495cde[_0x9a5d3(0x186)],'room':_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x160)]}),{invoice:_0x2a6850,date:_0x150460,warehouse_name:_0x467f7f,product_name:_0x4a980f,stock:_0x143567,quantity:_0x3934da,note:_0x111291,room:_0x34b58c,customer:_0x48f7b4,SCRN:_0x1fcbeb}=_0x8cb079[_0x9a5d3(0x1be)];if(typeof _0x4a980f==_0x9a5d3(0x12d))var _0x21d492=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x11a)]],_0x53d421=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x13c)]],_0x411c9e=[_0x8cb079[_0x9a5d3(0x1be)]['carton']],_0x15e1fe=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x10d)]],_0x42feab=[_0x8cb079[_0x9a5d3(0x1be)]['secondary_code']],_0x4ea53e=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x1d5)]],_0x3012f5=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x1da)]],_0x203b35=[_0x8cb079['body'][_0x9a5d3(0x18f)]],_0x3eb808=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x1cb)]],_0x20d892=[_0x8cb079[_0x9a5d3(0x1be)]['batch_code']],_0x1747a3=[_0x8cb079[_0x9a5d3(0x1be)]['expiry_date']],_0x2b2dc5=[_0x8cb079['body'][_0x9a5d3(0x142)]],_0x397bae=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x134)]],_0xa8b963=[_0x8cb079['body'][_0x9a5d3(0xe9)]],_0x59c72b=[_0x8cb079['body']['delivery_date']],_0x46552b=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x153)]],_0x352edb=[_0x8cb079['body'][_0x9a5d3(0xe7)]],_0xa1bd37=[_0x8cb079[_0x9a5d3(0x1be)]['quantity']],_0x531edb=[_0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x130)]];else var _0x21d492=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x11a)]],_0x53d421=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x13c)]],_0x411c9e=[..._0x8cb079[_0x9a5d3(0x1be)]['carton']],_0x15e1fe=[..._0x8cb079[_0x9a5d3(0x1be)]['primary_code']],_0x42feab=[..._0x8cb079[_0x9a5d3(0x1be)]['secondary_code']],_0x4ea53e=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x1d5)]],_0x3012f5=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x1da)]],_0x203b35=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x18f)]],_0x3eb808=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x1cb)]],_0x20d892=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0xdc)]],_0x1747a3=[..._0x8cb079[_0x9a5d3(0x1be)]['expiry_date']],_0x2b2dc5=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x142)]],_0x397bae=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x134)]],_0xa8b963=[..._0x8cb079['body'][_0x9a5d3(0xe9)]],_0x59c72b=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x193)]],_0x46552b=[..._0x8cb079[_0x9a5d3(0x1be)]['delivery_code']],_0x352edb=[..._0x8cb079['body'][_0x9a5d3(0xe7)]],_0xa1bd37=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x166)]],_0x531edb=[..._0x8cb079[_0x9a5d3(0x1be)][_0x9a5d3(0x130)]];const _0x216842=_0x21d492[_0x9a5d3(0x163)](_0x3c08f3=>{return _0x3c08f3={'product_name':_0x3c08f3};});_0x53d421[_0x9a5d3(0x1d9)]((_0x1e0719,_0x288375)=>{var _0x591350=_0x9a5d3;_0x216842[_0x288375][_0x591350(0x13c)]=Math[_0x591350(0x1d6)](_0x1e0719);}),_0x411c9e[_0x9a5d3(0x1d9)]((_0x23eb5a,_0x403ef4)=>{var _0x3d73af=_0x9a5d3;_0x216842[_0x403ef4][_0x3d73af(0x166)]=_0x23eb5a;}),_0x15e1fe[_0x9a5d3(0x1d9)]((_0x3970c8,_0x865f7a)=>{_0x216842[_0x865f7a]['primary_code']=_0x3970c8;}),_0x42feab['forEach']((_0x537705,_0x1ba78b)=>{var _0x4774e9=_0x9a5d3;_0x216842[_0x1ba78b][_0x4774e9(0x1d3)]=_0x537705;}),_0x4ea53e['forEach']((_0x3373d0,_0x39d1f3)=>{_0x216842[_0x39d1f3]['product_code']=_0x3373d0;}),_0x3012f5[_0x9a5d3(0x1d9)]((_0x5abe41,_0x525b69)=>{_0x531edb['forEach']((_0x853741,_0x110b1e)=>{var _0x206c39=a0_0x42b0;if(_0x853741==_0x206c39(0x158)&&_0x525b69==_0x110b1e){var _0x5e83e9=_0x5abe41[_0x206c39(0x195)](0x3);_0x216842[_0x525b69][_0x206c39(0x14f)]=_0x5abe41[0x0],_0x216842[_0x525b69][_0x206c39(0x161)]=_0x5abe41[0x1],_0x216842[_0x525b69][_0x206c39(0x19d)]=0x0,_0x216842[_0x525b69][_0x206c39(0xed)]=0x0,_0x216842[_0x525b69][_0x206c39(0x132)]=_0x206c39(0x143),_0x216842[_0x525b69][_0x206c39(0x1aa)]=_0x5e83e9;}else{if(_0x853741==_0x206c39(0x198)&&_0x525b69==_0x110b1e){var _0x5e83e9=_0x5abe41[_0x206c39(0x195)](0x3);_0x216842[_0x525b69][_0x206c39(0x14f)]=_0x5abe41[0x0],_0x216842[_0x525b69][_0x206c39(0x161)]=_0x5abe41[0x1],_0x216842[_0x525b69][_0x206c39(0x19d)]=0x0,_0x216842[_0x525b69][_0x206c39(0xed)]=0x0,_0x216842[_0x525b69][_0x206c39(0x132)]=_0x206c39(0x143),_0x216842[_0x525b69][_0x206c39(0x1aa)]=_0x5abe41[0x5];}else{if(_0x525b69==_0x110b1e){var _0x57333c;if(_0x5abe41[0x4]=='L')_0x57333c=_0x206c39(0x1b5);else _0x5abe41[0x4]=='F'&&(_0x57333c='Floor');_0x216842[_0x525b69][_0x206c39(0x14f)]=_0x5abe41[0x0],_0x216842[_0x525b69][_0x206c39(0x161)]=_0x5abe41[0x1],_0x216842[_0x525b69]['bay']=_0x5abe41[0x2],_0x216842[_0x525b69][_0x206c39(0xed)]=_0x5abe41[0x3],_0x216842[_0x525b69][_0x206c39(0x132)]=_0x57333c,_0x216842[_0x525b69]['floorlevel']=_0x5abe41[0x5];}}}});}),_0x203b35[_0x9a5d3(0x1d9)]((_0x4f4daf,_0x27e23e)=>{var _0x13fc67=_0x9a5d3;_0x216842[_0x27e23e][_0x13fc67(0x1ab)]=_0x4f4daf;}),_0x3eb808[_0x9a5d3(0x1d9)]((_0x47675c,_0x46c007)=>{var _0x47804a=_0x9a5d3;_0x216842[_0x46c007][_0x47804a(0x1cb)]=_0x47675c;}),_0x20d892['forEach']((_0x29eefc,_0x230981)=>{var _0x49b148=_0x9a5d3;_0x216842[_0x230981][_0x49b148(0xdc)]=_0x29eefc;}),_0x1747a3[_0x9a5d3(0x1d9)]((_0x4e58e7,_0xc10891)=>{var _0x52783e=_0x9a5d3;_0x216842[_0xc10891][_0x52783e(0x13d)]=_0x4e58e7;}),_0x2b2dc5[_0x9a5d3(0x1d9)]((_0x13732c,_0x137bc6)=>{var _0x37a4ee=_0x9a5d3;_0x216842[_0x137bc6][_0x37a4ee(0x148)]=_0x13732c;}),_0x397bae[_0x9a5d3(0x1d9)]((_0x229416,_0x500038)=>{var _0x22ca51=_0x9a5d3;_0x216842[_0x500038][_0x22ca51(0x134)]=_0x229416;}),_0xa8b963[_0x9a5d3(0x1d9)]((_0x164e2e,_0x16bfc2)=>{_0x216842[_0x16bfc2]['requested_qty']=Math['abs'](_0x164e2e);}),_0x59c72b['forEach']((_0x1a4a30,_0x49a6b5)=>{_0x216842[_0x49a6b5]['delivery_date']=_0x1a4a30;}),_0x46552b['forEach']((_0x14f241,_0x3ca817)=>{var _0xf3cf6a=_0x9a5d3;_0x216842[_0x3ca817][_0xf3cf6a(0x153)]=_0x14f241;}),_0x352edb[_0x9a5d3(0x1d9)]((_0x44cfe9,_0x2c9e0a)=>{var _0x65c94c=_0x9a5d3;_0x216842[_0x2c9e0a][_0x65c94c(0xe7)]=_0x44cfe9;}),_0xa1bd37[_0x9a5d3(0x1d9)]((_0x402580,_0x313c7c)=>{_0x216842[_0x313c7c]['quantity_notConverted']=_0x402580;}),_0x531edb[_0x9a5d3(0x1d9)]((_0x3c593a,_0x242209)=>{_0x216842[_0x242209]['room_name']=_0x3c593a;});var _0x5d7f9b=0x0;_0x216842[_0x9a5d3(0x1d9)](_0x33df07=>{var _0x40ba49=_0x9a5d3;console[_0x40ba49(0x1a4)](_0x40ba49(0x1a9),_0x33df07),(parseInt(_0x33df07['stock'])<parseInt(_0x33df07[_0x40ba49(0x166)])||parseInt(_0x33df07[_0x40ba49(0x166)])==0x0)&&_0x5d7f9b++;});if(_0x5d7f9b!=0x0)return _0x8cb079[_0x9a5d3(0x1b9)](_0x9a5d3(0x191),_0x9a5d3(0x118)),_0x2bc1af['redirect'](_0x9a5d3(0x16f));const _0xb3e483=_0x216842[_0x9a5d3(0xf3)](_0x4aec85=>_0x4aec85[_0x9a5d3(0x166)]!=='0'&&_0x4aec85['quantity']!=='');_0x495cde[_0x9a5d3(0x1b6)]=_0x2a6850,_0x495cde['customer']=_0x48f7b4,_0x495cde['date']=_0x150460,_0x495cde['warehouse_name']=_0x467f7f,_0x495cde[_0x9a5d3(0x17d)]=_0xb3e483,_0x495cde['note']=_0x111291,_0x495cde[_0x9a5d3(0x106)]=_0x1fcbeb,_0x495cde['finalize']=_0x9a5d3(0x1bb),_0x495cde['isAllowEdit']=_0x9a5d3(0x1bb);const _0x48da18=await _0x495cde['save']();_0x8cb079[_0x9a5d3(0x1b9)](_0x9a5d3(0x18b),_0x9a5d3(0x102)),_0x2bc1af[_0x9a5d3(0x16c)](_0x9a5d3(0x17e));}catch(_0x32feb1){console[_0x9a5d3(0x1a4)](_0x32feb1);}}),router[a0_0x49752f(0x178)](a0_0x49752f(0x1c5),auth,async(_0x12ce3d,_0x2c0af9)=>{var _0x3fb619=a0_0x49752f;try{const _0x18e490=_0x12ce3d['params']['id'],{invoice:_0xbd5d39,customer:_0xa08f0f,receivable_amount:_0x13f948,received_amount:_0x286915}=_0x12ce3d[_0x3fb619(0x1be)],_0x5179ac=await sales[_0x3fb619(0x144)](_0x18e490);console[_0x3fb619(0x1a4)](_0x5179ac);var _0x43724c=_0x13f948-_0x286915;console['log'](_0x286915),_0x5179ac['received_amount']=parseFloat(_0x286915)+parseFloat(_0x5179ac['received_amount']),_0x5179ac[_0x3fb619(0xea)]=_0x43724c,console[_0x3fb619(0x1a4)](_0x5179ac);const _0x2031be=await _0x5179ac[_0x3fb619(0x1ae)](),_0x2d4ef9=await c_payment_data[_0x3fb619(0x14a)]({'invoice':_0xbd5d39});_0x2d4ef9[_0x3fb619(0x123)]=_0x43724c,await _0x2d4ef9[_0x3fb619(0x1ae)]();let _0x2d5e1a=new Date(),_0x51d5a5=('0'+_0x2d5e1a['getDate']())[_0x3fb619(0x195)](-0x2),_0x45d54b=('0'+(_0x2d5e1a['getMonth']()+0x1))[_0x3fb619(0x195)](-0x2),_0x430904=_0x2d5e1a[_0x3fb619(0x155)](),_0x8dd9d4=_0x430904+'-'+_0x45d54b+'-'+_0x51d5a5;const _0x3058a4=new customer_payment({'invoice':_0xbd5d39,'date':_0x430904+'-'+_0x45d54b+'-'+_0x51d5a5,'customer':_0xa08f0f,'reason':_0x3fb619(0x11b),'amount':_0x286915}),_0x3c8e86=await _0x3058a4[_0x3fb619(0x1ae)]();_0x12ce3d['flash'](_0x3fb619(0x18b),'payment\x20successfull'),_0x2c0af9[_0x3fb619(0x16c)]('/all_sales/view');}catch(_0xa617bc){console[_0x3fb619(0x1a4)](_0xa617bc);}}),router[a0_0x49752f(0x1ad)](a0_0x49752f(0x103),auth,async(_0x11a80c,_0x41d2dd)=>{var _0x30a8d8=a0_0x49752f;try{const {username:_0x54027b,email:_0x1245cc,role:_0x269968}=_0x11a80c[_0x30a8d8(0x122)],_0x58cf16=_0x11a80c[_0x30a8d8(0x122)],_0xc2e31c=await profile['findOne']({'email':_0x58cf16[_0x30a8d8(0x14b)]}),_0xba8b0a=await master_shop[_0x30a8d8(0x1b8)]();console[_0x30a8d8(0x1a4)](_0x30a8d8(0xfc),_0xba8b0a);const _0x330457=_0x11a80c[_0x30a8d8(0x157)]['id'],_0x25f85c=await sales[_0x30a8d8(0x144)](_0x330457);console[_0x30a8d8(0x1a4)](_0x25f85c);const _0x163e0a=await customer[_0x30a8d8(0x14a)]({'name':_0x25f85c[_0x30a8d8(0xf0)]});console[_0x30a8d8(0x1a4)](_0x163e0a);if(_0xba8b0a[0x0][_0x30a8d8(0x182)]==_0x30a8d8(0x1d0)){var _0x363db5=users[_0x30a8d8(0x111)];console['log'](_0x363db5);}else{if(_0xba8b0a[0x0][_0x30a8d8(0x182)]=='Hindi')var _0x363db5=users['Hindi'];else{if(_0xba8b0a[0x0][_0x30a8d8(0x182)]==_0x30a8d8(0x188))var _0x363db5=users[_0x30a8d8(0x188)];else{if(_0xba8b0a[0x0][_0x30a8d8(0x182)]=='Spanish')var _0x363db5=users[_0x30a8d8(0x197)];else{if(_0xba8b0a[0x0]['language']==_0x30a8d8(0x125))var _0x363db5=users[_0x30a8d8(0x125)];else{if(_0xba8b0a[0x0][_0x30a8d8(0x182)]==_0x30a8d8(0xde))var _0x363db5=users[_0x30a8d8(0x189)];else{if(_0xba8b0a[0x0][_0x30a8d8(0x182)]==_0x30a8d8(0x169))var _0x363db5=users[_0x30a8d8(0x169)];else{if(_0xba8b0a[0x0][_0x30a8d8(0x182)]==_0x30a8d8(0x156))var _0x363db5=users['Arabic'];}}}}}}}_0x41d2dd[_0x30a8d8(0x138)]('sales_invoice',{'success':_0x11a80c[_0x30a8d8(0x1b9)](_0x30a8d8(0x18b)),'errors':_0x11a80c['flash'](_0x30a8d8(0x191)),'role':_0x58cf16,'profile':_0xc2e31c,'master_shop':_0xba8b0a,'customers':_0x163e0a,'sales':_0x25f85c,'language':_0x363db5});}catch(_0x5e2a61){console['log'](_0x5e2a61);}}),router['get'](a0_0x49752f(0xe8),auth,async(_0x472810,_0x57d744)=>{var _0x4ca7e4=a0_0x49752f;try{const {username:_0x124af1,email:_0x57d7af,role:_0x1bf5eb}=_0x472810[_0x4ca7e4(0x122)],_0x9e5a68=_0x472810[_0x4ca7e4(0x122)],_0x1e2b65=await profile['findOne']({'email':_0x9e5a68[_0x4ca7e4(0x14b)]}),_0x2d3822=await master_shop[_0x4ca7e4(0x1b8)]();console['log'](_0x4ca7e4(0xfc),_0x2d3822);const _0x387042=_0x472810[_0x4ca7e4(0x157)]['id'];console[_0x4ca7e4(0x1a4)](_0x387042);const _0x5ae34a=await sales[_0x4ca7e4(0x144)](_0x387042);console[_0x4ca7e4(0x1a4)]('user_id',_0x5ae34a);const _0xd0eee6=await warehouse[_0x4ca7e4(0x10e)]([{'$match':{'name':_0x4ca7e4(0x1a8),'room':_0x4ca7e4(0x173)}},{'$unwind':_0x4ca7e4(0x104)},{'$group':{'_id':_0x4ca7e4(0x141),'name':{'$first':_0x4ca7e4(0x181)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x4ca7e4(0x19a)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4ca7e4(0xfd)},'product_code':{'$first':'$product_details.product_code'}}}]);console['log'](_0x4ca7e4(0x18e),_0xd0eee6);const _0x4ed61f=await product['find']({});warehouse_data=await warehouse[_0x4ca7e4(0x10e)]([{'$match':{'status':_0x4ca7e4(0x112),'name':_0x4ca7e4(0x1a8),'warehouse_category':_0x4ca7e4(0x140)}},{'$group':{'_id':_0x4ca7e4(0x15c),'name':{'$first':_0x4ca7e4(0x15c)}}},{'$sort':{'name':0x1}}]);var _0x4f52c7=[_0x4ca7e4(0x173)];if(_0x2d3822[0x0][_0x4ca7e4(0x182)]==_0x4ca7e4(0x1d0)){var _0x3b83c3=users[_0x4ca7e4(0x111)];console[_0x4ca7e4(0x1a4)](_0x3b83c3);}else{if(_0x2d3822[0x0]['language']==_0x4ca7e4(0x11f))var _0x3b83c3=users[_0x4ca7e4(0x11f)];else{if(_0x2d3822[0x0]['language']==_0x4ca7e4(0x188))var _0x3b83c3=users['German'];else{if(_0x2d3822[0x0][_0x4ca7e4(0x182)]==_0x4ca7e4(0x197))var _0x3b83c3=users[_0x4ca7e4(0x197)];else{if(_0x2d3822[0x0]['language']==_0x4ca7e4(0x125))var _0x3b83c3=users['French'];else{if(_0x2d3822[0x0][_0x4ca7e4(0x182)]==_0x4ca7e4(0xde))var _0x3b83c3=users[_0x4ca7e4(0x189)];else{if(_0x2d3822[0x0]['language']=='Chinese')var _0x3b83c3=users[_0x4ca7e4(0x169)];else{if(_0x2d3822[0x0][_0x4ca7e4(0x182)]==_0x4ca7e4(0x156))var _0x3b83c3=users[_0x4ca7e4(0x1c1)];}}}}}}}_0x57d744[_0x4ca7e4(0x138)]('return_sale',{'success':_0x472810[_0x4ca7e4(0x1b9)]('success'),'errors':_0x472810[_0x4ca7e4(0x1b9)](_0x4ca7e4(0x191)),'role':_0x9e5a68,'profile':_0x1e2b65,'user':_0x5ae34a,'stock':_0xd0eee6,'master_shop':_0x2d3822,'unit':_0x4ed61f,'language':_0x3b83c3,'warehouses':warehouse_data,'rooms':_0x4f52c7});}catch(_0xbd1f73){console['log'](_0xbd1f73),_0x57d744['status'](0xc8)[_0x4ca7e4(0x1a3)]({'message':_0xbd1f73['message']});}}),router[a0_0x49752f(0x178)](a0_0x49752f(0xe8),auth,async(_0x2fdd51,_0x16f504)=>{var _0x4f349a=a0_0x49752f;try{const {invoice:_0x24ac62,date:_0x4e8238,warehouse_name:_0x55e968,product_name:_0x5281c2,primary_code:_0x5a801a,secondary_code:_0x39481b,product_code:_0x1b7311,sales_quantity:_0x26323f,stocks:_0x3c79e1,return_qty:_0x3246bc,Room_name:_0x4d1dad,to_warehouse_name:_0x5f48f7,to_Roomname:_0x5e4755,to_Room_name:_0x143000,note:_0x3c8bf0,level:_0x228d1c,isle:_0x56383f,pallet:_0x4ee950}=_0x2fdd51[_0x4f349a(0x1be)];if(typeof _0x5281c2==_0x4f349a(0x12d))var _0x4d00ea=[_0x2fdd51['body']['product_name']],_0xa1ffb6=[_0x2fdd51['body']['primary_code']],_0x3c61e3=[_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x1d3)]],_0x4456f5=[_0x2fdd51['body']['product_code']],_0x33f262=[_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0xe5)]],_0x3c5bc1=[_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x13a)]],_0x463cda=[_0x2fdd51['body'][_0x4f349a(0x116)]],_0x16cbbc=[_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x19d)]],_0x126445=[_0x2fdd51['body'][_0x4f349a(0xed)]],_0x5ebc06=[_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x172)]],_0x3e16f3=[_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x1aa)]];else var _0x4d00ea=[..._0x2fdd51[_0x4f349a(0x1be)]['product_name']],_0xa1ffb6=[..._0x2fdd51['body'][_0x4f349a(0x10d)]],_0x3c61e3=[..._0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x1d3)]],_0x4456f5=[..._0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x14d)]],_0x33f262=[..._0x2fdd51['body'][_0x4f349a(0xe5)]],_0x3c5bc1=[..._0x2fdd51['body'][_0x4f349a(0x13a)]],_0x463cda=[..._0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0x116)]],_0x16cbbc=[..._0x2fdd51[_0x4f349a(0x1be)]['bay']],_0x126445=[..._0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0xed)]],_0x5ebc06=[..._0x2fdd51[_0x4f349a(0x1be)]['types']],_0x3e16f3=[..._0x2fdd51['body'][_0x4f349a(0x1aa)]];const _0x2bb957=_0x4d00ea[_0x4f349a(0x163)](_0x405916=>{return _0x405916={'product_name':_0x405916};});_0xa1ffb6[_0x4f349a(0x1d9)]((_0x431095,_0x24ff57)=>{_0x2bb957[_0x24ff57]['primary_code']=_0x431095;}),_0x3c61e3['forEach']((_0x4a8793,_0x9ae21a)=>{var _0x520df4=_0x4f349a;_0x2bb957[_0x9ae21a][_0x520df4(0x1d3)]=_0x4a8793;}),_0x4456f5[_0x4f349a(0x1d9)]((_0x1e8dbd,_0x4f6dc9)=>{_0x2bb957[_0x4f6dc9]['product_code']=_0x1e8dbd;}),_0x33f262[_0x4f349a(0x1d9)]((_0x3fcf5f,_0x3f736d)=>{var _0x4fa584=_0x4f349a;_0x2bb957[_0x3f736d][_0x4fa584(0x1bd)]=_0x3fcf5f;}),_0x3c5bc1[_0x4f349a(0x1d9)]((_0x2030ec,_0x45b449)=>{var _0x4550cd=_0x4f349a;_0x2bb957[_0x45b449][_0x4550cd(0x13c)]=_0x2030ec;}),_0x463cda[_0x4f349a(0x1d9)]((_0xc08e66,_0xba9b10)=>{var _0x49ba00=_0x4f349a;_0x2bb957[_0xba9b10][_0x49ba00(0x116)]=_0xc08e66;}),_0x16cbbc['forEach']((_0x1fb7b1,_0x3dcd7a)=>{var _0x7cf849=_0x4f349a;_0x2bb957[_0x3dcd7a][_0x7cf849(0x19d)]=_0x1fb7b1;}),_0x126445['forEach']((_0x5490dd,_0x1c4b74)=>{var _0x2460af=_0x4f349a;_0x2bb957[_0x1c4b74][_0x2460af(0xed)]=_0x5490dd;}),_0x5ebc06[_0x4f349a(0x1d9)]((_0x324fce,_0x34a3dc)=>{var _0x46b72a=_0x4f349a;_0x2bb957[_0x34a3dc][_0x46b72a(0x132)]=_0x324fce;}),_0x3e16f3[_0x4f349a(0x1d9)]((_0x144a60,_0x565e99)=>{var _0x386236=_0x4f349a;_0x2bb957[_0x565e99][_0x386236(0x1aa)]=_0x144a60;});var _0x1f8f38=0x0;_0x2bb957['forEach'](_0x38611a=>{var _0x1256d4=_0x4f349a;console[_0x1256d4(0x1a4)](_0x1256d4(0x1a9),_0x38611a),(parseInt(_0x38611a[_0x1256d4(0x1bd)])<parseInt(_0x38611a[_0x1256d4(0x116)])||parseInt(_0x38611a['stock'])<parseInt(_0x38611a['return_qty'])&&parseInt(_0x38611a[_0x1256d4(0x1bd)])>parseInt(_0x38611a[_0x1256d4(0x116)])||parseInt(_0x38611a['return_qty'])==0x0)&&_0x1f8f38++;});if(_0x1f8f38!=0x0)return _0x2fdd51[_0x4f349a(0x1b9)](_0x4f349a(0x191),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x16f504[_0x4f349a(0x16c)]('back');const _0x252de3=await sales[_0x4f349a(0x14a)]({'invoice':_0x24ac62});console[_0x4f349a(0x1a4)](_0x252de3),_0x252de3[_0x4f349a(0x1e1)]=_0x4f349a(0x17b);const _0x16e0e7=await _0x252de3['save'](),_0x5a1cbf=new sales_return({'invoice':_0x24ac62,'customer':_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0xf0)],'date':_0x4e8238,'warehouse_name':_0x55e968,'room':_0x4d1dad,'ToWarehouse':_0x5f48f7,'ToRoom':_0x143000,'return_sale':_0x2bb957,'note':_0x3c8bf0}),_0x1e946e=await _0x5a1cbf[_0x4f349a(0x1ae)]();console['log'](_0x5a1cbf);const _0x321a13=await sales_return[_0x4f349a(0x14a)]({'invoice':_0x24ac62}),_0x3bfea4=await warehouse[_0x4f349a(0x14a)]({'name':_0x5f48f7,'room':_0x143000});_0x321a13[_0x4f349a(0xf7)]['forEach'](_0x23811d=>{var _0xdd634e=_0x4f349a,_0x21d27b=0x0;const _0x3465a2=_0x3bfea4[_0xdd634e(0x110)][_0xdd634e(0x163)](_0xc4529f=>{var _0x10499b=_0xdd634e;_0xc4529f['product_name']==_0x23811d['product_name']&&_0xc4529f['floorlevel']==_0x23811d[_0x10499b(0x1aa)]&&_0xc4529f[_0x10499b(0x132)]==_0x23811d['type']&&_0xc4529f['bin']==_0x23811d[_0x10499b(0xed)]&&_0xc4529f[_0x10499b(0x19d)]==_0x23811d[_0x10499b(0x19d)]&&(_0xc4529f[_0x10499b(0x190)]=parseInt(_0xc4529f[_0x10499b(0x190)])+parseInt(_0x23811d[_0x10499b(0x116)]),_0x21d27b++);});_0x21d27b=='0'&&(_0x3bfea4[_0xdd634e(0x110)]=_0x3bfea4[_0xdd634e(0x110)]['concat']({'product_name':_0x23811d[_0xdd634e(0x11a)],'product_stock':_0x23811d[_0xdd634e(0x116)],'primary_code':_0x23811d[_0xdd634e(0x10d)],'secondary_code':_0x23811d[_0xdd634e(0x1d3)],'product_code':_0x23811d[_0xdd634e(0x14d)],'bay':_0x23811d[_0xdd634e(0x19d)],'bin':_0x23811d[_0xdd634e(0xed)],'type':_0x23811d['type'],'floorlevel':_0x23811d[_0xdd634e(0x1aa)]})),console[_0xdd634e(0x1a4)](_0xdd634e(0x137),_0x3bfea4);}),await _0x3bfea4[_0x4f349a(0x1ae)](),console[_0x4f349a(0x1a4)](_0x2fdd51[_0x4f349a(0x1be)]);const _0x4a9452=new c_payment_data({'invoice':_0x24ac62,'customer':_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0xf0)],'reason':_0x4f349a(0x1d4)});await _0x4a9452['save']();const _0x253f1d=await master_shop['find']();console[_0x4f349a(0x1a4)](_0x4f349a(0x1c7),_0x253f1d[0x0][_0x4f349a(0x1a7)]);const _0x449e28=await email_settings['findOne'](),_0x2103f6=await customer[_0x4f349a(0x14a)]({'name':_0x2fdd51[_0x4f349a(0x1be)][_0x4f349a(0xf0)]});console[_0x4f349a(0x1a4)](_0x4f349a(0x1b2),_0x2103f6);_0x253f1d[0x0][_0x4f349a(0x10b)]==0x1?(right_currency=_0x253f1d[0x0][_0x4f349a(0x164)],left_currency=''):(right_currency='',left_currency=_0x253f1d[0x0][_0x4f349a(0x164)]);var _0x2e8765=_0x4d00ea,_0x36b7e3=_0x463cda,_0x52c801='',_0x1e6d6e;for(_0x1e6d6e in _0x2e8765){_0x52c801+=_0x4f349a(0xe1)+_0x4f349a(0x105)+_0x2e8765[_0x1e6d6e]+_0x4f349a(0xfb)+_0x4f349a(0x105)+_0x36b7e3[_0x1e6d6e]+_0x4f349a(0xfb)+_0x4f349a(0x1cc);}console[_0x4f349a(0x1a4)](_0x4f349a(0x126),_0x52c801);let _0xb5b5d2=nodemailer[_0x4f349a(0x11c)]({'service':_0x4f349a(0x1df),'auth':{'user':_0x449e28[_0x4f349a(0x14b)],'pass':_0x449e28[_0x4f349a(0x1d2)]}}),_0x40bbec={'from':_0x449e28[_0x4f349a(0x14b)],'to':_0x2103f6[_0x4f349a(0x14b)],'subject':_0x4f349a(0x1af),'attachments':[{'filename':_0x4f349a(0x14c),'path':__dirname+_0x4f349a(0x1bf)+_0x4f349a(0x19c)+_0x253f1d[0x0][_0x4f349a(0x1a7)],'cid':_0x4f349a(0x15e)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x4f349a(0x159)+_0x4f349a(0xff)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4f349a(0xff)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x4f349a(0x119)+'<div>'+_0x4f349a(0x1ba)+_0x253f1d[0x0]['site_title']+'\x20</h2>'+_0x4f349a(0x119)+_0x4f349a(0x119)+_0x4f349a(0x139)+_0x4f349a(0xff)+_0x4f349a(0x18d)+_0x4f349a(0xf4)+_0x24ac62+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4f349a(0x168)+_0x4e8238+'\x20'+'</span>'+_0x4f349a(0x187)+'</div>'+_0x4f349a(0x1dc)+_0x4f349a(0x10a)+_0x4f349a(0xe1)+_0x4f349a(0x167)+_0x4f349a(0x17f)+_0x4f349a(0x135)+_0x4f349a(0x1d8)+_0x4f349a(0x1cc)+_0x4f349a(0x19f)+_0x4f349a(0xef)+'\x20'+_0x52c801+'\x20'+'</tbody>'+_0x4f349a(0x18c)+_0x4f349a(0xff)+_0x4f349a(0xf8)+_0x4f349a(0x16e)+_0x253f1d[0x0][_0x4f349a(0x109)]+_0x4f349a(0x187)+_0x4f349a(0x119)+'</div>'+_0x4f349a(0x194)};_0xb5b5d2[_0x4f349a(0x136)](_0x40bbec,function(_0x2cdff4,_0x3f54b8){var _0x3854ee=_0x4f349a;_0x2cdff4?(console[_0x3854ee(0x1a4)](_0x2cdff4),console[_0x3854ee(0x1a4)]('Error\x20Occurs')):console[_0x3854ee(0x1a4)]('Email\x20sent\x20successfully');}),_0x2fdd51['flash'](_0x4f349a(0x18b),_0x4f349a(0xe0)),_0x16f504[_0x4f349a(0x16c)](_0x4f349a(0x17e));}catch(_0x2058ad){console[_0x4f349a(0x1a4)](_0x2058ad),_0x16f504['status'](0xc8)[_0x4f349a(0x1a3)]({'message1':_0x2058ad[_0x4f349a(0x114)]});}}),router[a0_0x49752f(0x1ad)]('/barcode/:id',auth,async(_0x144083,_0x3cdbdd)=>{var _0x3480c2=a0_0x49752f;try{const {username:_0x5f27a9,email:_0x7d5921,role:_0x4fe47f}=_0x144083[_0x3480c2(0x122)],_0x2403b8=_0x144083[_0x3480c2(0x122)],_0x1b5f96=await profile[_0x3480c2(0x14a)]({'email':_0x2403b8['email']}),_0x43e807=await master_shop[_0x3480c2(0x1b8)]();console['log']('barcode\x20Product\x20master',_0x43e807);const _0x4ab264=_0x144083[_0x3480c2(0x157)]['id'],_0x151fef=await sales[_0x3480c2(0x144)](_0x4ab264);console[_0x3480c2(0x1a4)](_0x3480c2(0xdb),_0x151fef);if(_0x43e807[0x0][_0x3480c2(0x182)]=='English\x20(US)')var _0x14504b=users[_0x3480c2(0x111)];else{if(_0x43e807[0x0][_0x3480c2(0x182)]==_0x3480c2(0x11f))var _0x14504b=users[_0x3480c2(0x11f)];else{if(_0x43e807[0x0]['language']=='German')var _0x14504b=users['German'];else{if(_0x43e807[0x0][_0x3480c2(0x182)]=='Spanish')var _0x14504b=users[_0x3480c2(0x197)];else{if(_0x43e807[0x0][_0x3480c2(0x182)]=='French')var _0x14504b=users[_0x3480c2(0x125)];else{if(_0x43e807[0x0][_0x3480c2(0x182)]==_0x3480c2(0xde))var _0x14504b=users[_0x3480c2(0x189)];else{if(_0x43e807[0x0]['language']=='Chinese')var _0x14504b=users[_0x3480c2(0x169)];else{if(_0x43e807[0x0][_0x3480c2(0x182)]==_0x3480c2(0x156))var _0x14504b=users['Arabic'];}}}}}}}_0x3cdbdd['render'](_0x3480c2(0xf6),{'success':_0x144083[_0x3480c2(0x1b9)](_0x3480c2(0x18b)),'errors':_0x144083['flash'](_0x3480c2(0x191)),'role':_0x2403b8,'profile':_0x1b5f96,'alldata':_0x151fef,'master_shop':_0x43e807,'language':_0x14504b});}catch(_0x5321e4){console[_0x3480c2(0x1a4)](_0x5321e4);}}),router['post'](a0_0x49752f(0x129),async(_0x37e53a,_0xeb66ef)=>{var _0x4cdf83=a0_0x49752f;const {product_code:_0xd0919f,warehouse_name:_0x1c0365,rooms_data:_0x582789,Roomslist:_0xdb1497}=_0x37e53a[_0x4cdf83(0x1be)],_0x22e4ca=_0xdb1497['split'](','),_0x27cd56=[];async function _0xfddfd1(_0x577a5f){var _0x426300=_0x4cdf83;const _0x1ca893=await warehouse[_0x426300(0x10e)]([{'$match':{'name':_0x1c0365,'room':_0x577a5f}},{'$unwind':_0x426300(0x104)},{'$match':{'product_details.primary_code':_0xd0919f}},{'$group':{'_id':_0x426300(0x141),'name':{'$first':_0x426300(0x181)},'product_stock':{'$first':_0x426300(0x1b0)},'primary_code':{'$first':_0x426300(0x1c2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x426300(0x192)},'level':{'$first':_0x426300(0x10f)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x426300(0x131)},'pallet':{'$first':_0x426300(0x19b)},'unit':{'$first':_0x426300(0x127)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x426300(0x101)},'expiry_date':{'$first':_0x426300(0x12e)},'production_date':{'$first':_0x426300(0x174)},'maxPerUnit':{'$first':_0x426300(0x1b4)},'batch_code':{'$first':_0x426300(0x1cf)},'product_cat':{'$first':_0x426300(0x115)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x426300(0xf5)},'actual_qty':{'$first':_0x426300(0x175)},'actual_uom':{'$first':_0x426300(0x107)}}}]),_0x4d2b05=await warehouse[_0x426300(0x10e)]([{'$match':{'name':_0x1c0365,'room':_0x577a5f}},{'$unwind':_0x426300(0x104)},{'$match':{'product_details.secondary_code':_0xd0919f}},{'$group':{'_id':_0x426300(0x141),'name':{'$first':_0x426300(0x181)},'product_stock':{'$first':_0x426300(0x1b0)},'primary_code':{'$first':_0x426300(0x1c2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x426300(0x192)},'level':{'$first':_0x426300(0x10f)},'isle':{'$first':_0x426300(0x16d)},'type':{'$first':_0x426300(0x131)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x426300(0x127)},'secondary_unit':{'$first':_0x426300(0x18a)},'storage':{'$first':_0x426300(0x120)},'rack':{'$first':_0x426300(0x101)},'expiry_date':{'$first':_0x426300(0x12e)},'production_date':{'$first':_0x426300(0x174)},'maxPerUnit':{'$first':_0x426300(0x1b4)},'batch_code':{'$first':_0x426300(0x1cf)},'product_cat':{'$first':_0x426300(0x115)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x426300(0x1b1)},'invoice':{'$first':_0x426300(0xf5)}}}]);if(_0x1ca893[_0x426300(0xee)]>0x0)_0x27cd56[_0x426300(0x1cd)](_0x1ca893);else _0x4d2b05[_0x426300(0xee)]>0x0&&_0x27cd56[_0x426300(0x1cd)](_0x4d2b05);}const _0x3c5bff=_0x22e4ca['map'](_0x1f07be=>_0xfddfd1(_0x1f07be));await Promise['all'](_0x3c5bff),_0xeb66ef['json'](_0x27cd56);}),module['exports']=router;