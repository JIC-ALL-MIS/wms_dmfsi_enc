var a0_0x448efe=a0_0xac8e;(function(_0x20092c,_0x1e52cc){var _0x3005fb=a0_0xac8e,_0x3632a5=_0x20092c();while(!![]){try{var _0x3abc1f=parseInt(_0x3005fb(0x11a))/0x1+parseInt(_0x3005fb(0x12e))/0x2+parseInt(_0x3005fb(0x104))/0x3*(-parseInt(_0x3005fb(0x158))/0x4)+parseInt(_0x3005fb(0x7f))/0x5*(parseInt(_0x3005fb(0xf4))/0x6)+-parseInt(_0x3005fb(0xfe))/0x7+parseInt(_0x3005fb(0xe9))/0x8*(parseInt(_0x3005fb(0x87))/0x9)+parseInt(_0x3005fb(0x94))/0xa*(-parseInt(_0x3005fb(0x174))/0xb);if(_0x3abc1f===_0x1e52cc)break;else _0x3632a5['push'](_0x3632a5['shift']());}catch(_0x49d55b){_0x3632a5['push'](_0x3632a5['shift']());}}}(a0_0x8ea0,0x89458));const express=require(a0_0x448efe(0xa3)),app=express(),router=express[a0_0x448efe(0xcf)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x448efe(0x146)),auth=require('../middleware/auth'),nodemailer=require(a0_0x448efe(0xca)),users=require(a0_0x448efe(0xc0));router['get'](a0_0x448efe(0xd6),auth,async(_0xbba72,_0x438302)=>{var _0x2c3ace=a0_0x448efe;try{const {username:_0x1e0b6a,email:_0x540a91,role:_0x49c8f6}=_0xbba72[_0x2c3ace(0xb9)],_0x367161=_0xbba72[_0x2c3ace(0xb9)],_0x5f1a77=await profile[_0x2c3ace(0x119)]({'email':_0x367161[_0x2c3ace(0x163)]}),_0x40084a=await master_shop[_0x2c3ace(0xe8)]();let _0x32a43e;if(_0x367161[_0x2c3ace(0x9d)]==_0x2c3ace(0xc1)){const _0x3ee112=await staff['findOne']({'email':_0x367161[_0x2c3ace(0x163)]});_0x32a43e=await sales[_0x2c3ace(0xec)]([{'$lookup':{'from':_0x2c3ace(0xae),'localField':_0x2c3ace(0x110),'foreignField':_0x2c3ace(0x15f),'as':'customers_docs'}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2c3ace(0x127)},'customers':{'$first':_0x2c3ace(0x154)},'date':{'$first':_0x2c3ace(0x116)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x2c3ace(0x73)},'note':{'$first':_0x2c3ace(0x92)},'return_data':{'$first':_0x2c3ace(0x16b)},'customers_docs':{'$first':_0x2c3ace(0x137)},'total_saleproduct_quantity':{'$sum':_0x2c3ace(0x136)},'level':{'$addToSet':_0x2c3ace(0x17c)},'isle':{'$addToSet':_0x2c3ace(0x171)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x2c3ace(0x111)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x2c3ace(0x12d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x32a43e=await sales[_0x2c3ace(0xec)]([{'$lookup':{'from':_0x2c3ace(0xae),'localField':_0x2c3ace(0x110),'foreignField':_0x2c3ace(0x15f),'as':_0x2c3ace(0x16c)}},{'$unwind':_0x2c3ace(0x137)},{'$unwind':_0x2c3ace(0x73)},{'$group':{'_id':_0x2c3ace(0xb4),'invoice':{'$first':_0x2c3ace(0x127)},'customers':{'$first':_0x2c3ace(0x154)},'date':{'$first':_0x2c3ace(0x116)},'warehouse_name':{'$first':_0x2c3ace(0x164)},'sale_product':{'$push':_0x2c3ace(0x73)},'note':{'$first':'$note'},'return_data':{'$first':_0x2c3ace(0x16b)},'customers_docs':{'$first':_0x2c3ace(0x137)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x2c3ace(0x17c)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x2c3ace(0x89)},'pallet':{'$addToSet':_0x2c3ace(0x111)},'finalize':{'$first':_0x2c3ace(0x85)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x2c3ace(0x140)]('sales\x20all_data',_0x32a43e);if(_0x40084a[0x0]['language']==_0x2c3ace(0xc9)){var _0x1588e6=users['English'];console[_0x2c3ace(0x140)](_0x1588e6);}else{if(_0x40084a[0x0][_0x2c3ace(0xf6)]==_0x2c3ace(0x173))var _0x1588e6=users[_0x2c3ace(0x173)];else{if(_0x40084a[0x0]['language']=='German')var _0x1588e6=users[_0x2c3ace(0x145)];else{if(_0x40084a[0x0][_0x2c3ace(0xf6)]==_0x2c3ace(0xfd))var _0x1588e6=users[_0x2c3ace(0xfd)];else{if(_0x40084a[0x0][_0x2c3ace(0xf6)]==_0x2c3ace(0xf0))var _0x1588e6=users[_0x2c3ace(0xf0)];else{if(_0x40084a[0x0][_0x2c3ace(0xf6)]==_0x2c3ace(0xe6))var _0x1588e6=users['Portuguese'];else{if(_0x40084a[0x0][_0x2c3ace(0xf6)]=='Chinese')var _0x1588e6=users[_0x2c3ace(0x149)];else{if(_0x40084a[0x0][_0x2c3ace(0xf6)]==_0x2c3ace(0xd3))var _0x1588e6=users[_0x2c3ace(0x7c)];}}}}}}}_0x438302[_0x2c3ace(0xc8)](_0x2c3ace(0x114),{'success':_0xbba72[_0x2c3ace(0x16d)](_0x2c3ace(0xbb)),'errors':_0xbba72['flash'](_0x2c3ace(0x17d)),'sales':_0x32a43e,'profile':_0x5f1a77,'role':_0x367161,'master_shop':_0x40084a,'language':_0x1588e6});}catch(_0x258ffa){console['log'](_0x258ffa);}});async function getRandom8DigitNumber(){var _0x2b5fb2=a0_0x448efe;const _0x509c9b=0x989680,_0x4ae154=0x5f5e0ff,_0x439643=Math[_0x2b5fb2(0x11e)](Math['random']()*(_0x4ae154-_0x509c9b+0x1))+_0x509c9b;var _0x467391;const _0x5582cf=await sales[_0x2b5fb2(0x119)]({'invoice':_0x2b5fb2(0xd7)+_0x439643});return _0x5582cf&&_0x5582cf[_0x2b5fb2(0x13b)]>0x0?_0x467391=_0x2b5fb2(0xd7)+_0x439643:_0x467391=_0x2b5fb2(0xd7)+_0x439643,_0x467391;}router[a0_0x448efe(0x10f)](a0_0x448efe(0x88),auth,async(_0x24d06b,_0x273fe2)=>{var _0x1eb750=a0_0x448efe;try{const {username:_0x2586de,email:_0x6ef08f,role:_0x32dbf0}=_0x24d06b[_0x1eb750(0xb9)],_0x52b677=_0x24d06b[_0x1eb750(0xb9)],_0x5cc847=await profile[_0x1eb750(0x119)]({'email':_0x52b677[_0x1eb750(0x163)]}),_0xf4647f=await master_shop[_0x1eb750(0xe8)](),_0x31fa34=await customer['find']({});let _0x2f776e;if(_0x52b677[_0x1eb750(0x9d)]==_0x1eb750(0xc1)){const _0x514d1c=await staff[_0x1eb750(0x119)]({'email':_0x52b677[_0x1eb750(0x163)]});_0x2f776e=await warehouse[_0x1eb750(0xec)]([{'$match':{'status':_0x1eb750(0x76),'name':_0x514d1c[_0x1eb750(0x12b)],'warehouse_category':_0x1eb750(0x130),'name':{'$ne':_0x1eb750(0x8d)}}},{'$group':{'_id':_0x1eb750(0x153),'name':{'$first':_0x1eb750(0x153)}}},{'$sort':{'name':0x1}}]);}else _0x2f776e=await warehouse[_0x1eb750(0xec)]([{'$match':{'status':_0x1eb750(0x76),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x1eb750(0x153),'name':{'$first':_0x1eb750(0x153)}}},{'$sort':{'name':0x1}}]);const _0x21f74a=await product[_0x1eb750(0xe8)]({});var _0x4b4d50=['Ambient',_0x1eb750(0xcc)];const _0x50c37b=await sales[_0x1eb750(0xe8)]({}),_0x459d21=_0x50c37b[_0x1eb750(0x13b)]+0x1,_0x111d75=_0x1eb750(0xd7)+_0x459d21[_0x1eb750(0xf1)]()['padStart'](0x5,'0');if(_0xf4647f[0x0][_0x1eb750(0xf6)]==_0x1eb750(0xc9)){var _0x2bdb39=users[_0x1eb750(0x15a)];console[_0x1eb750(0x140)](_0x2bdb39);}else{if(_0xf4647f[0x0][_0x1eb750(0xf6)]=='Hindi')var _0x2bdb39=users[_0x1eb750(0x173)];else{if(_0xf4647f[0x0][_0x1eb750(0xf6)]==_0x1eb750(0x145))var _0x2bdb39=users[_0x1eb750(0x145)];else{if(_0xf4647f[0x0]['language']==_0x1eb750(0xfd))var _0x2bdb39=users[_0x1eb750(0xfd)];else{if(_0xf4647f[0x0][_0x1eb750(0xf6)]=='French')var _0x2bdb39=users[_0x1eb750(0xf0)];else{if(_0xf4647f[0x0][_0x1eb750(0xf6)]==_0x1eb750(0xe6))var _0x2bdb39=users[_0x1eb750(0xef)];else{if(_0xf4647f[0x0][_0x1eb750(0xf6)]==_0x1eb750(0x149))var _0x2bdb39=users[_0x1eb750(0x149)];else{if(_0xf4647f[0x0][_0x1eb750(0xf6)]==_0x1eb750(0xd3))var _0x2bdb39=users[_0x1eb750(0x7c)];}}}}}}}const _0x8772c5=getRandom8DigitNumber();_0x8772c5[_0x1eb750(0xbd)](_0x570725=>{var _0x419c56=_0x1eb750;_0x273fe2['render'](_0x419c56(0x15e),{'success':_0x24d06b[_0x419c56(0x16d)]('success'),'errors':_0x24d06b['flash'](_0x419c56(0x17d)),'role':_0x52b677,'profile':_0x5cc847,'customer':_0x31fa34,'warehouse':_0x2f776e,'product':_0x21f74a,'invoice':_0x570725,'master_shop':_0xf4647f,'language':_0x2bdb39,'rooms_data':_0x4b4d50});})[_0x1eb750(0x150)](_0x2aec3a=>{var _0x2b597e=_0x1eb750;_0x24d06b['flash'](_0x2b597e(0x17d),_0x2b597e(0xd5)),_0x273fe2['redirect'](_0x2b597e(0x14e));});}catch(_0x1654c1){console[_0x1eb750(0x140)](_0x1654c1);}}),router[a0_0x448efe(0x10f)](a0_0x448efe(0x179),auth,async(_0x42ff40,_0x5231ec)=>{var _0x14aa1f=a0_0x448efe;try{const _0x111b7c=_0x42ff40['params']['id'];console[_0x14aa1f(0x140)](_0x111b7c);const _0x4c4991=await product[_0x14aa1f(0xe8)](),_0x4d44aa=await purchases[_0x14aa1f(0xec)]([{'$match':{'warehouse_name':_0x111b7c}},{'$unwind':_0x14aa1f(0x121)},{'$group':{'_id':_0x14aa1f(0xbf)}}]);console[_0x14aa1f(0x140)](_0x14aa1f(0x7d),_0x4d44aa),_0x5231ec[_0x14aa1f(0x165)](0xc8)[_0x14aa1f(0xd8)]({'purchases_data':_0x4d44aa,'product_data':_0x4c4991});}catch(_0x8f0852){console['log'](_0x8f0852);}}),router[a0_0x448efe(0x11b)](a0_0x448efe(0x10a),auth,async(_0x564bad,_0x5b0f02)=>{var _0x4f0620=a0_0x448efe;try{const {warehouse_data:_0x4f14e8,product_data:_0x1dd03b}=_0x564bad['body'];console['log'](_0x564bad[_0x4f0620(0x96)][_0x4f0620(0xde)]);;const _0x4f9eaa=await master_shop[_0x4f0620(0xe8)]();console[_0x4f0620(0x140)](_0x4f0620(0x9f),_0x4f9eaa);const _0x5c0c33=await product[_0x4f0620(0x119)]({'name':_0x1dd03b});console[_0x4f0620(0x140)](_0x4f0620(0xa8),_0x5c0c33);const _0x4b823d=await warehouse[_0x4f0620(0xec)]([{'$match':{'name':_0x4f14e8}},{'$unwind':_0x4f0620(0x70)},{'$match':{'product_details.product_name':_0x1dd03b}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x4f0620(0x93)}}}]);console[_0x4f0620(0x140)](_0x4f0620(0x109),_0x4b823d),_0x5b0f02['status'](0xc8)[_0x4f0620(0xd8)]({'master':_0x4f9eaa,'new_product':_0x5c0c33,'stock_data':_0x4b823d});}catch(_0x32c602){console[_0x4f0620(0x140)](_0x32c602);}}),router['post'](a0_0x448efe(0x88),auth,async(_0x59173a,_0x1a58ff)=>{var _0x3da4e1=a0_0x448efe;try{const {invoice:_0x265672,date:_0x4e333b,warehouse_name:_0x3b13a5,product_name:_0x318e86,stock:_0x5b3279,quantity:_0x7225f6,note:_0x17363f,room:_0x544450,primary_code:_0x3445b4,secondary_code:_0x62ec48,prod_code:_0xa7ce20,level:_0x40e3a3,isle:_0x4d92cb,pallet:_0x47f167,batch_code:_0xf58c7d,SCRN:_0x21d12c,expiry_date:_0x7e078b}=_0x59173a[_0x3da4e1(0x96)];if(typeof _0x318e86==_0x3da4e1(0xa9))var _0x4ca5a3=[_0x59173a['body'][_0x3da4e1(0x15d)]],_0x571610=[_0x59173a['body'][_0x3da4e1(0x8b)]],_0x27ae11=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xd2)]],_0x46fbca=[_0x59173a[_0x3da4e1(0x96)]['primary_code']],_0xe3be28=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xdc)]],_0x9a18fc=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x10e)]],_0x1c239=[_0x59173a['body']['level']],_0x23b44d=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x13d)]],_0x2798a1=[_0x59173a[_0x3da4e1(0x96)]['secondary_unit']],_0x4dc15a=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x131)]],_0x620d27=[_0x59173a['body'][_0x3da4e1(0x14a)]],_0x125ca8=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xda)]],_0x12e096=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x122)]],_0x182254=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x91)]],_0x2db2b7=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xac)]],_0x2a866b=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xa7)]],_0x515dc0=[_0x59173a['body']['prod_cat']],_0x4a0932=[_0x59173a[_0x3da4e1(0x96)]['quantity']],_0x14f057=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x180)]],_0x10cd29=[_0x59173a[_0x3da4e1(0x96)]['prod_invoice']],_0xf86b7d=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x9e)]],_0x1d5ea4=[_0x59173a['body']['actual_uom']],_0x44f156=[_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x105)]];else var _0x4ca5a3=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x15d)]],_0x571610=[..._0x59173a['body'][_0x3da4e1(0x8b)]],_0x27ae11=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xd2)]],_0x46fbca=[..._0x59173a[_0x3da4e1(0x96)]['primary_code']],_0xe3be28=[..._0x59173a[_0x3da4e1(0x96)]['secondary_code']],_0x9a18fc=[..._0x59173a['body']['prod_code']],_0x1c239=[..._0x59173a[_0x3da4e1(0x96)]['level']],_0x23b44d=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x13d)]],_0x2798a1=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x181)]],_0x4dc15a=[..._0x59173a[_0x3da4e1(0x96)]['batch_code']],_0x620d27=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x14a)]],_0x125ca8=[..._0x59173a[_0x3da4e1(0x96)]['max_per_unit']],_0x12e096=[..._0x59173a['body']['production_date']],_0x182254=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x91)]],_0x2db2b7=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xac)]],_0x2a866b=[..._0x59173a['body'][_0x3da4e1(0xa7)]],_0x515dc0=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0xd9)]],_0x4a0932=[..._0x59173a['body'][_0x3da4e1(0x71)]],_0x14f057=[..._0x59173a[_0x3da4e1(0x96)]['RoomAssigned']],_0x10cd29=[..._0x59173a['body'][_0x3da4e1(0xf2)]],_0xf86b7d=[..._0x59173a['body']['actual_qty']],_0x1d5ea4=[..._0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x152)]],_0x44f156=[..._0x59173a[_0x3da4e1(0x96)]['id_transact']];const _0xe0cc69=_0x4ca5a3[_0x3da4e1(0xbe)](_0x1bcd3c=>{return _0x1bcd3c={'product_name':_0x1bcd3c};});_0x571610[_0x3da4e1(0x125)]((_0x542a86,_0x313fda)=>{var _0xf1209e=_0x3da4e1;_0xe0cc69[_0x313fda][_0xf1209e(0x8b)]=Math['abs'](_0x542a86);}),_0xf86b7d[_0x3da4e1(0x125)]((_0x8b1edb,_0x12ebb3)=>{var _0x1ff214=_0x3da4e1;_0xe0cc69[_0x12ebb3][_0x1ff214(0x9e)]=Math[_0x1ff214(0x14f)](_0x8b1edb);}),_0x1d5ea4['forEach']((_0x58a840,_0x77a92b)=>{var _0x1152b8=_0x3da4e1;_0xe0cc69[_0x77a92b][_0x1152b8(0x152)]=_0x58a840;}),_0x44f156[_0x3da4e1(0x125)]((_0x4a3ccc,_0x254c0d)=>{var _0x331265=_0x3da4e1;_0xe0cc69[_0x254c0d][_0x331265(0x142)]=_0x4a3ccc;}),_0x27ae11[_0x3da4e1(0x125)]((_0x50e260,_0x534774)=>{var _0x2ade63=_0x3da4e1;_0xe0cc69[_0x534774][_0x2ade63(0x71)]=_0x50e260;}),_0x46fbca[_0x3da4e1(0x125)]((_0x41b7c8,_0x3cbaab)=>{var _0x31c43d=_0x3da4e1;_0xe0cc69[_0x3cbaab][_0x31c43d(0x72)]=_0x41b7c8;}),_0xe3be28[_0x3da4e1(0x125)]((_0x20bc50,_0x13e6db)=>{var _0x40aa26=_0x3da4e1;_0xe0cc69[_0x13e6db][_0x40aa26(0xdc)]=_0x20bc50;}),_0x9a18fc[_0x3da4e1(0x125)]((_0x48b474,_0x23f4b5)=>{var _0x48a7c2=_0x3da4e1;_0xe0cc69[_0x23f4b5][_0x48a7c2(0xad)]=_0x48b474;}),_0x1c239[_0x3da4e1(0x125)]((_0x4d17c6,_0x2127ae)=>{var _0x1a0397=_0x3da4e1;_0x14f057[_0x1a0397(0x125)]((_0x39628c,_0x4a56c9)=>{var _0x173df1=_0x1a0397;if(_0x39628c==_0x173df1(0x176)&&_0x2127ae==_0x4a56c9){var _0x3b2e91=_0x4d17c6[_0x173df1(0x6e)](0x3);_0xe0cc69[_0x2127ae]['storage']=_0x4d17c6[0x0],_0xe0cc69[_0x2127ae][_0x173df1(0xc4)]=_0x4d17c6[0x1],_0xe0cc69[_0x2127ae]['bay']=0x0,_0xe0cc69[_0x2127ae][_0x173df1(0x80)]=0x0,_0xe0cc69[_0x2127ae][_0x173df1(0x9a)]=_0x173df1(0xb5),_0xe0cc69[_0x2127ae][_0x173df1(0x10d)]=_0x3b2e91;}else{if(_0x39628c==_0x173df1(0xf8)&&_0x2127ae==_0x4a56c9){var _0x3b2e91=_0x4d17c6[_0x173df1(0x6e)](0x3);_0xe0cc69[_0x2127ae][_0x173df1(0x128)]=_0x4d17c6[0x0],_0xe0cc69[_0x2127ae][_0x173df1(0xc4)]=_0x4d17c6[0x1],_0xe0cc69[_0x2127ae]['bay']=0x0,_0xe0cc69[_0x2127ae][_0x173df1(0x80)]=0x0,_0xe0cc69[_0x2127ae][_0x173df1(0x9a)]='Floor',_0xe0cc69[_0x2127ae][_0x173df1(0x10d)]=_0x4d17c6[0x5];}else{if(_0x2127ae==_0x4a56c9){var _0x22166a;if(_0x4d17c6[0x4]=='L')_0x22166a=_0x173df1(0x15c);else _0x4d17c6[0x4]=='F'&&(_0x22166a=_0x173df1(0xb5));_0xe0cc69[_0x2127ae][_0x173df1(0x128)]=_0x4d17c6[0x0],_0xe0cc69[_0x2127ae][_0x173df1(0xc4)]=_0x4d17c6[0x1],_0xe0cc69[_0x2127ae][_0x173df1(0xe2)]=_0x4d17c6[0x2],_0xe0cc69[_0x2127ae][_0x173df1(0x80)]=_0x4d17c6[0x3],_0xe0cc69[_0x2127ae][_0x173df1(0x9a)]=_0x22166a,_0xe0cc69[_0x2127ae][_0x173df1(0x10d)]=_0x4d17c6[0x5];}}}});}),_0x23b44d[_0x3da4e1(0x125)]((_0x874273,_0x5e3276)=>{_0xe0cc69[_0x5e3276]['unit']=_0x874273;}),_0x2798a1[_0x3da4e1(0x125)]((_0x24b9b8,_0x10cae5)=>{var _0x535d2c=_0x3da4e1;_0xe0cc69[_0x10cae5][_0x535d2c(0x181)]=_0x24b9b8;}),_0x4dc15a['forEach']((_0x529e03,_0x5c54b8)=>{_0xe0cc69[_0x5c54b8]['batch_code']=_0x529e03;}),_0x620d27['forEach']((_0x160971,_0x5c340f)=>{_0xe0cc69[_0x5c340f]['expiry_date']=_0x160971;}),_0x125ca8[_0x3da4e1(0x125)]((_0x4f55f3,_0x4ecccb)=>{var _0x7574b=_0x3da4e1;_0xe0cc69[_0x4ecccb][_0x7574b(0xcb)]=_0x4f55f3;}),_0x12e096[_0x3da4e1(0x125)]((_0x14e8eb,_0x15c009)=>{var _0x8920da=_0x3da4e1;_0xe0cc69[_0x15c009][_0x8920da(0x122)]=_0x14e8eb;}),_0x182254[_0x3da4e1(0x125)]((_0x29c983,_0x14da7e)=>{var _0x3127d6=_0x3da4e1;_0xe0cc69[_0x14da7e][_0x3127d6(0x91)]=_0x29c983;}),_0x2db2b7['forEach']((_0x647388,_0x53d212)=>{var _0x2d026a=_0x3da4e1;_0xe0cc69[_0x53d212][_0x2d026a(0xac)]=_0x647388;}),_0x2a866b[_0x3da4e1(0x125)]((_0x5c8033,_0x1031e7)=>{var _0x2afe2d=_0x3da4e1;_0xe0cc69[_0x1031e7][_0x2afe2d(0xa7)]=_0x5c8033;}),_0x515dc0[_0x3da4e1(0x125)]((_0xcece79,_0x55ff43)=>{var _0x15d2f4=_0x3da4e1;_0xe0cc69[_0x55ff43][_0x15d2f4(0xd9)]=_0xcece79;}),_0x4a0932[_0x3da4e1(0x125)]((_0x1b479c,_0x5507d3)=>{_0xe0cc69[_0x5507d3]['quantity_notConverted']=_0x1b479c;}),_0x14f057['forEach']((_0x2a9293,_0xc87196)=>{_0xe0cc69[_0xc87196]['room_name']=_0x2a9293;}),_0x10cd29[_0x3da4e1(0x125)]((_0x1f9546,_0x451593)=>{var _0x391d8a=_0x3da4e1;_0xe0cc69[_0x451593][_0x391d8a(0x17b)]=_0x1f9546;});var _0x31143a=0x0;_0xe0cc69[_0x3da4e1(0x125)](_0x346c6b=>{var _0x230343=_0x3da4e1;(_0x346c6b[_0x230343(0x8b)]<_0x346c6b[_0x230343(0xdf)]||_0x346c6b[_0x230343(0xdf)]==0x0)&&(console[_0x230343(0x140)]('foreach\x20newproduct',_0x346c6b),_0x31143a++);});const _0x1884b6=_0xe0cc69['filter'](_0xc324db=>_0xc324db[_0x3da4e1(0x71)]!=='0'&&_0xc324db[_0x3da4e1(0x71)]!==''),_0x1202a0=new sales({'invoice':_0x265672,'customer':_0x59173a[_0x3da4e1(0x96)][_0x3da4e1(0x110)],'date':_0x4e333b,'warehouse_name':_0x3b13a5,'sale_product':_0x1884b6,'note':_0x17363f,'room':_0x544450,'primary_code':_0x3445b4,'secondary_code':_0x62ec48,'prod_code':_0xa7ce20,'SCRN':_0x21d12c}),_0x312429=await _0x1202a0['save']();_0x59173a[_0x3da4e1(0x16d)]('success',_0x3da4e1(0x106)),_0x1a58ff['redirect']('/all_sales/preview/'+_0x312429[_0x3da4e1(0xdd)]);}catch(_0x3e7354){console[_0x3da4e1(0x140)](_0x3e7354);}}),router[a0_0x448efe(0x10f)](a0_0x448efe(0x12c),auth,async(_0x103e78,_0x523183)=>{var _0x30d3c3=a0_0x448efe;try{const {username:_0x3085fa,email:_0x42b2bd,role:_0xc0fa5f}=_0x103e78[_0x30d3c3(0xb9)],_0x20bc52=_0x103e78[_0x30d3c3(0xb9)],_0x575760=await profile[_0x30d3c3(0x119)]({'email':_0x20bc52[_0x30d3c3(0x163)]}),_0xbe7229=await master_shop[_0x30d3c3(0xe8)](),_0x2a405e=_0x103e78[_0x30d3c3(0x15b)]['id'],_0x24b567=await sales[_0x30d3c3(0x113)](_0x2a405e),_0x2d11a6=await warehouse[_0x30d3c3(0xec)]([{'$match':{'name':_0x24b567[_0x30d3c3(0x167)]}},{'$unwind':_0x30d3c3(0x70)},{'$group':{'_id':_0x30d3c3(0x123),'name':{'$first':_0x30d3c3(0x12f)},'product_stock':{'$first':_0x30d3c3(0x93)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x30d3c3(0x139)},'type':{'$first':_0x30d3c3(0x84)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x30d3c3(0x162)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x30d3c3(0xe5)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x30d3c3(0x138)}}}]),_0x2eb4b2=await customer['find']({});let _0x2e10d7;if(_0x20bc52[_0x30d3c3(0x9d)]==_0x30d3c3(0xc1)){const _0x360c87=await staff[_0x30d3c3(0x119)]({'email':_0x20bc52[_0x30d3c3(0x163)]});_0x2e10d7=await warehouse[_0x30d3c3(0xec)]([{'$match':{'status':_0x30d3c3(0x76),'name':_0x360c87[_0x30d3c3(0x12b)]}},{'$group':{'_id':_0x30d3c3(0x153),'name':{'$first':_0x30d3c3(0x153)}}}]);}else _0x2e10d7=await warehouse['aggregate']([{'$match':{'status':_0x30d3c3(0x76)}},{'$group':{'_id':_0x30d3c3(0x153),'name':{'$first':_0x30d3c3(0x153)}}}]);const _0xa970cd=await product[_0x30d3c3(0xe8)]({}),_0x3947c7=await suppliers[_0x30d3c3(0xe8)]({});if(_0xbe7229[0x0]['language']=='English\x20(US)'){var _0x2f4f6a=users[_0x30d3c3(0x15a)];console['log'](_0x2f4f6a);}else{if(_0xbe7229[0x0]['language']==_0x30d3c3(0x173))var _0x2f4f6a=users[_0x30d3c3(0x173)];else{if(_0xbe7229[0x0][_0x30d3c3(0xf6)]=='German')var _0x2f4f6a=users[_0x30d3c3(0x145)];else{if(_0xbe7229[0x0]['language']==_0x30d3c3(0xfd))var _0x2f4f6a=users[_0x30d3c3(0xfd)];else{if(_0xbe7229[0x0]['language']=='French')var _0x2f4f6a=users[_0x30d3c3(0xf0)];else{if(_0xbe7229[0x0][_0x30d3c3(0xf6)]==_0x30d3c3(0xe6))var _0x2f4f6a=users[_0x30d3c3(0xef)];else{if(_0xbe7229[0x0]['language']==_0x30d3c3(0x149))var _0x2f4f6a=users['Chinese'];else{if(_0xbe7229[0x0][_0x30d3c3(0xf6)]=='Arabic\x20(ae)')var _0x2f4f6a=users[_0x30d3c3(0x7c)];}}}}}}}_0x523183[_0x30d3c3(0xc8)]('edit_sales_view',{'success':_0x103e78[_0x30d3c3(0x16d)]('success'),'errors':_0x103e78[_0x30d3c3(0x16d)](_0x30d3c3(0x17d)),'role':_0x20bc52,'profile':_0x575760,'customer':_0x2eb4b2,'warehouse':_0x2e10d7,'product':_0x2d11a6,'user':_0x24b567,'master_shop':_0xbe7229,'unit':_0xa970cd,'language':_0x2f4f6a,'suppliers':_0x3947c7});}catch(_0x5ad527){console[_0x30d3c3(0x140)](_0x5ad527);}}),router[a0_0x448efe(0x11b)](a0_0x448efe(0x12c),auth,async(_0x176305,_0x1a4a4c)=>{var _0x23f1dd=a0_0x448efe;try{const _0x3b84fe=_0x176305[_0x23f1dd(0x15b)]['id'],{invoice:_0x148986,warehouse_name:_0x53ff72,room:_0x5666a7}=_0x176305[_0x23f1dd(0x96)],_0x241c2d=await sales[_0x23f1dd(0x119)]({'invoice':_0x148986}),_0x4df5c3=_0x241c2d[_0x23f1dd(0xd1)][_0x23f1dd(0xbe)](async _0x57e676=>{var _0x2b18e1=_0x23f1dd,_0x5294c1=await warehouse[_0x2b18e1(0x119)]({'name':_0x53ff72,'room':_0x57e676[_0x2b18e1(0x129)],'warehouse_category':_0x2b18e1(0x130)});const _0x3a2806=_0x5294c1['product_details'][_0x2b18e1(0xbe)](_0x1e28de=>{var _0x533bc1=_0x2b18e1;_0x1e28de[_0x533bc1(0x15d)]==_0x57e676[_0x533bc1(0x15d)]&&_0x1e28de[_0x533bc1(0x10d)]==_0x57e676[_0x533bc1(0x10d)]&&_0x1e28de[_0x533bc1(0x9a)]==_0x57e676[_0x533bc1(0x9a)]&&_0x1e28de[_0x533bc1(0x80)]==_0x57e676[_0x533bc1(0x80)]&&_0x1e28de['bay']==_0x57e676['bay']&&_0x1e28de[_0x533bc1(0xc4)]==_0x57e676[_0x533bc1(0xc4)]&&_0x1e28de[_0x533bc1(0x128)]==_0x57e676[_0x533bc1(0x128)]&&_0x1e28de[_0x533bc1(0x14a)]==_0x57e676['expiry_date']&&_0x1e28de[_0x533bc1(0x131)]==_0x57e676[_0x533bc1(0x131)]&&_0x1e28de[_0x533bc1(0xdd)]==_0x57e676[_0x533bc1(0x142)]&&(_0x1e28de[_0x533bc1(0x144)]=Math[_0x533bc1(0x134)](0x0,Math[_0x533bc1(0x14f)](_0x1e28de[_0x533bc1(0x144)])-Math['abs'](_0x57e676[_0x533bc1(0x71)])));});return _0x5294c1;});Promise[_0x23f1dd(0xd0)](_0x4df5c3)['then'](async _0xcb1f5c=>{var _0x25edf0=_0x23f1dd;try{for(const _0x56c57a of _0xcb1f5c){await _0x56c57a[_0x25edf0(0xfc)]();}_0x241c2d[_0x25edf0(0x97)]=_0x25edf0(0x99);const _0x189749=await _0x241c2d['save'](),_0x3688f2=await master_shop[_0x25edf0(0xe8)](),_0x24db88=await email_settings[_0x25edf0(0x119)](),_0x40198e=await supervisor_settings[_0x25edf0(0xe8)]();var _0x5f6195=_0x241c2d[_0x25edf0(0xd1)],_0x491fb0='',_0x40bf60;for(_0x40bf60 in _0x5f6195){_0x491fb0+=_0x25edf0(0x124)+_0x25edf0(0x83)+_0x5f6195[_0x40bf60][_0x25edf0(0x15d)]+_0x25edf0(0x178)+_0x25edf0(0x83)+_0x5f6195[_0x40bf60]['product_code']+'</td>'+_0x25edf0(0x83)+_0x5f6195[_0x40bf60][_0x25edf0(0x71)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f6195[_0x40bf60][_0x25edf0(0x155)]+_0x25edf0(0x178)+_0x25edf0(0x83)+_0x5f6195[_0x40bf60]['secondary_unit']+_0x25edf0(0x178)+_0x25edf0(0x83)+_0x241c2d[_0x25edf0(0x167)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f6195[_0x40bf60][_0x25edf0(0x129)]+_0x25edf0(0x178)+_0x25edf0(0x83)+_0x5f6195[_0x40bf60][_0x25edf0(0x128)]+_0x5f6195[_0x40bf60]['rack']+_0x5f6195[_0x40bf60][_0x25edf0(0xe2)]+_0x5f6195[_0x40bf60][_0x25edf0(0x80)]+_0x5f6195[_0x40bf60][_0x25edf0(0x9a)][0x0]+_0x5f6195[_0x40bf60][_0x25edf0(0x10d)]+_0x25edf0(0x178),'</tr>';}let _0x16c95c=nodemailer[_0x25edf0(0xaa)]({'host':_0x24db88[_0x25edf0(0x120)],'port':Number(_0x24db88[_0x25edf0(0xfa)]),'secure':![],'auth':{'user':_0x24db88['email'],'pass':_0x24db88[_0x25edf0(0x160)]}}),_0x378fb7={'from':_0x24db88[_0x25edf0(0x163)],'to':_0x40198e[0x0]['RMSEmail'],'subject':_0x25edf0(0xb0),'attachments':[{'filename':_0x25edf0(0xa1),'path':__dirname+_0x25edf0(0x177)+_0x25edf0(0xb7)+_0x3688f2[0x0][_0x25edf0(0x157)],'cid':_0x25edf0(0x82)}],'html':_0x25edf0(0x143)+_0x25edf0(0x11c)+_0x25edf0(0xce)+_0x25edf0(0xe7)+_0x25edf0(0x101)+_0x25edf0(0xe7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x25edf0(0x182)+_0x25edf0(0xe7)+'<h2>\x20'+_0x3688f2[0x0][_0x25edf0(0xc5)]+_0x25edf0(0x17f)+_0x25edf0(0x182)+'</div>'+_0x25edf0(0x13e)+_0x25edf0(0xe7)+_0x25edf0(0x108)+_0x25edf0(0x135)+_0x241c2d[_0x25edf0(0x17b)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x25edf0(0xb6)+_0x241c2d[_0x25edf0(0x13c)]+'\x20'+_0x25edf0(0xe4)+_0x25edf0(0xd4)+_0x25edf0(0x182)+_0x25edf0(0xb2)+_0x25edf0(0x11f)+_0x25edf0(0x124)+_0x25edf0(0xa5)+_0x25edf0(0x126)+_0x25edf0(0x175)+_0x25edf0(0x81)+_0x25edf0(0x90)+_0x25edf0(0x102)+_0x25edf0(0x95)+_0x25edf0(0x161)+_0x25edf0(0x9b)+_0x25edf0(0xb8)+_0x25edf0(0xf5)+'\x20'+_0x491fb0+'\x20'+_0x25edf0(0x156)+_0x25edf0(0xc6)+_0x25edf0(0xe7)+_0x25edf0(0x159)+_0x25edf0(0x14d)+_0x3688f2[0x0]['site_title']+_0x25edf0(0xd4)+_0x25edf0(0x182)+_0x25edf0(0x182)+'</body></html>'};_0x16c95c[_0x25edf0(0x166)](_0x378fb7,function(_0x488208,_0x29c4ed){var _0x4b91f8=_0x25edf0;_0x488208?(console[_0x4b91f8(0x140)](_0x488208),console[_0x4b91f8(0x140)]('Error\x20Occurs')):console[_0x4b91f8(0x140)](_0x4b91f8(0x100));}),_0x176305[_0x25edf0(0x16d)]('success','Sales\x20Update\x20successfully'),_0x1a4a4c[_0x25edf0(0xf7)](_0x25edf0(0x170)+_0x3b84fe);}catch(_0x4a1eb5){console[_0x25edf0(0x7b)](_0x4a1eb5),_0x1a4a4c['status'](0x1f4)['json']({'error':_0x25edf0(0x17a)});}})[_0x23f1dd(0x150)](_0x7fc743=>{var _0x34bce7=_0x23f1dd;console[_0x34bce7(0x7b)](_0x7fc743),_0x1a4a4c[_0x34bce7(0x165)](0x1f4)[_0x34bce7(0xd8)]({'error':'An\x20error\x20occurred.'});});}catch(_0x4d0dd5){console['log'](_0x4d0dd5);}}),router['get'](a0_0x448efe(0xc7),auth,async(_0x51c08b,_0x1a4e25)=>{var _0x475507=a0_0x448efe;try{const {username:_0x58bcc4,email:_0x1850a,role:_0x53e5fe}=_0x51c08b['user'],_0x431375=_0x51c08b[_0x475507(0xb9)],_0xabd468=await profile[_0x475507(0x119)]({'email':_0x431375[_0x475507(0x163)]}),_0x33547f=await master_shop[_0x475507(0xe8)](),_0x2a8b19=_0x51c08b['params']['id'],_0x46182f=await sales[_0x475507(0x113)](_0x2a8b19);var _0x544fbb=[_0x475507(0x10c),_0x475507(0xcc)];const _0x31b1f7=await warehouse[_0x475507(0xec)]([{'$match':{'name':_0x46182f[_0x475507(0x167)],'warehouse_category':_0x475507(0x130)}},{'$unwind':_0x475507(0x70)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x475507(0x12f)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x475507(0x6d)},'bin':{'$first':_0x475507(0x139)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x475507(0x148)},'primary_code':{'$first':_0x475507(0x162)},'secondary_code':{'$first':_0x475507(0x98)},'product_code':{'$first':_0x475507(0xaf)},'storage':{'$first':_0x475507(0xc2)},'rack':{'$first':_0x475507(0x14b)}}}]),_0x33d22b=await customer[_0x475507(0xe8)]({});let _0x264efd;if(_0x431375['role']==_0x475507(0xc1)){const _0x4d0d98=await staff['findOne']({'email':_0x431375[_0x475507(0x163)]});_0x264efd=await warehouse[_0x475507(0xec)]([{'$match':{'status':_0x475507(0x76),'name':_0x4d0d98[_0x475507(0x12b)],'warehouse_category':_0x475507(0x130)}},{'$group':{'_id':_0x475507(0x153),'name':{'$first':_0x475507(0x153)}}}]);}else _0x264efd=await warehouse[_0x475507(0xec)]([{'$match':{'status':_0x475507(0x76),'warehouse_category':_0x475507(0x130)}},{'$group':{'_id':_0x475507(0x153),'name':{'$first':_0x475507(0x153)}}}]);const _0x4e30da=await product[_0x475507(0xe8)]({});if(_0x33547f[0x0]['language']==_0x475507(0xc9)){var _0x35ee30=users[_0x475507(0x15a)];console[_0x475507(0x140)](_0x35ee30);}else{if(_0x33547f[0x0][_0x475507(0xf6)]==_0x475507(0x173))var _0x35ee30=users['Hindi'];else{if(_0x33547f[0x0][_0x475507(0xf6)]=='German')var _0x35ee30=users[_0x475507(0x145)];else{if(_0x33547f[0x0][_0x475507(0xf6)]==_0x475507(0xfd))var _0x35ee30=users[_0x475507(0xfd)];else{if(_0x33547f[0x0][_0x475507(0xf6)]==_0x475507(0xf0))var _0x35ee30=users[_0x475507(0xf0)];else{if(_0x33547f[0x0]['language']==_0x475507(0xe6))var _0x35ee30=users[_0x475507(0xef)];else{if(_0x33547f[0x0][_0x475507(0xf6)]==_0x475507(0x149))var _0x35ee30=users[_0x475507(0x149)];else{if(_0x33547f[0x0]['language']==_0x475507(0xd3))var _0x35ee30=users[_0x475507(0x7c)];}}}}}}}_0x1a4e25[_0x475507(0xc8)](_0x475507(0x8e),{'success':_0x51c08b[_0x475507(0x16d)](_0x475507(0xbb)),'errors':_0x51c08b[_0x475507(0x16d)](_0x475507(0x17d)),'role':_0x431375,'profile':_0xabd468,'customer':_0x33d22b,'warehouse':_0x264efd,'product':_0x31b1f7,'user':_0x46182f,'master_shop':_0x33547f,'unit':_0x4e30da,'language':_0x35ee30});}catch(_0x2756ba){console[_0x475507(0x140)](_0x2756ba);}}),router[a0_0x448efe(0x11b)]('/view/:id',auth,async(_0x50650c,_0x4c5882)=>{var _0x3e7968=a0_0x448efe;try{const _0x2b1229=_0x50650c[_0x3e7968(0x15b)]['id'],_0x2ca8cc=await sales[_0x3e7968(0x119)]({'_id':_0x50650c[_0x3e7968(0x15b)]['id']}),_0x507bea=await warehouse[_0x3e7968(0x119)]({'name':_0x2ca8cc[_0x3e7968(0x167)],'room':_0x50650c['body'][_0x3e7968(0xa0)]}),{invoice:_0xb9637f,date:_0x2235e4,warehouse_name:_0x6c8029,product_name:_0x484cfb,stock:_0x979943,quantity:_0x4d371d,note:_0x1aa196,room:_0x290b89,customer:_0x527fda,SCRN:_0x49ad30}=_0x50650c['body'];if(typeof _0x484cfb=='string')var _0x4397e3=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x15d)]],_0x16d6a8=[_0x50650c[_0x3e7968(0x96)]['stock']],_0x2ffc76=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0xd2)]],_0x204262=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x72)]],_0x3229ed=[_0x50650c['body']['secondary_code']],_0xc1e14c=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x10e)]],_0xb81d0=[_0x50650c['body'][_0x3e7968(0xba)]],_0x146187=[_0x50650c[_0x3e7968(0x96)]['primary_unit']],_0x443905=[_0x50650c['body']['secondary_unit']],_0xf0168a=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x131)]],_0x3dc251=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x14a)]],_0x1f9656=[_0x50650c['body'][_0x3e7968(0xda)]],_0x42717b=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x122)]],_0x4bde70=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x91)]],_0x17a560=[_0x50650c['body'][_0x3e7968(0xac)]],_0x1775c6=[_0x50650c[_0x3e7968(0x96)]['delivery_code']],_0xe3e965=[_0x50650c[_0x3e7968(0x96)]['prod_cat']],_0x525dcf=[_0x50650c[_0x3e7968(0x96)][_0x3e7968(0x71)]],_0x93a836=[_0x50650c['body']['RoomAssigned']];else var _0x4397e3=[..._0x50650c[_0x3e7968(0x96)][_0x3e7968(0x15d)]],_0x16d6a8=[..._0x50650c[_0x3e7968(0x96)]['stock']],_0x2ffc76=[..._0x50650c['body'][_0x3e7968(0xd2)]],_0x204262=[..._0x50650c[_0x3e7968(0x96)]['primary_code']],_0x3229ed=[..._0x50650c[_0x3e7968(0x96)][_0x3e7968(0xdc)]],_0xc1e14c=[..._0x50650c['body']['prod_code']],_0xb81d0=[..._0x50650c[_0x3e7968(0x96)]['level']],_0x146187=[..._0x50650c[_0x3e7968(0x96)]['primary_unit']],_0x443905=[..._0x50650c['body'][_0x3e7968(0x181)]],_0xf0168a=[..._0x50650c[_0x3e7968(0x96)]['batch_code']],_0x3dc251=[..._0x50650c[_0x3e7968(0x96)]['expiry_date']],_0x1f9656=[..._0x50650c[_0x3e7968(0x96)][_0x3e7968(0xda)]],_0x42717b=[..._0x50650c[_0x3e7968(0x96)]['production_date']],_0x4bde70=[..._0x50650c[_0x3e7968(0x96)]['requested_qty']],_0x17a560=[..._0x50650c[_0x3e7968(0x96)][_0x3e7968(0xac)]],_0x1775c6=[..._0x50650c[_0x3e7968(0x96)]['delivery_code']],_0xe3e965=[..._0x50650c[_0x3e7968(0x96)]['prod_cat']],_0x525dcf=[..._0x50650c[_0x3e7968(0x96)][_0x3e7968(0x71)]],_0x93a836=[..._0x50650c['body'][_0x3e7968(0x180)]];const _0x351698=_0x4397e3[_0x3e7968(0xbe)](_0x55cb74=>{return _0x55cb74={'product_name':_0x55cb74};});_0x16d6a8[_0x3e7968(0x125)]((_0x51104a,_0x54537b)=>{var _0x3b95d0=_0x3e7968;_0x351698[_0x54537b][_0x3b95d0(0x8b)]=Math[_0x3b95d0(0x14f)](_0x51104a);}),_0x2ffc76[_0x3e7968(0x125)]((_0x467aee,_0x4b4a0c)=>{var _0x38c3b1=_0x3e7968;_0x351698[_0x4b4a0c][_0x38c3b1(0x71)]=_0x467aee;}),_0x204262[_0x3e7968(0x125)]((_0x407224,_0x4e13aa)=>{var _0x12a311=_0x3e7968;_0x351698[_0x4e13aa][_0x12a311(0x72)]=_0x407224;}),_0x3229ed['forEach']((_0x3ffe8f,_0x515828)=>{_0x351698[_0x515828]['secondary_code']=_0x3ffe8f;}),_0xc1e14c[_0x3e7968(0x125)]((_0xdfe4a4,_0x4aecc2)=>{var _0x36bdb3=_0x3e7968;_0x351698[_0x4aecc2][_0x36bdb3(0xad)]=_0xdfe4a4;}),_0xb81d0[_0x3e7968(0x125)]((_0xcc88af,_0x39be34)=>{var _0x1b6b71=_0x3e7968;_0x93a836[_0x1b6b71(0x125)]((_0x5c5a81,_0x446bba)=>{var _0x5da4b2=_0x1b6b71;if(_0x5c5a81==_0x5da4b2(0x176)&&_0x39be34==_0x446bba){var _0x5dabb6=_0xcc88af['slice'](0x3);_0x351698[_0x39be34]['storage']=_0xcc88af[0x0],_0x351698[_0x39be34][_0x5da4b2(0xc4)]=_0xcc88af[0x1],_0x351698[_0x39be34][_0x5da4b2(0xe2)]=0x0,_0x351698[_0x39be34][_0x5da4b2(0x80)]=0x0,_0x351698[_0x39be34][_0x5da4b2(0x9a)]=_0x5da4b2(0xb5),_0x351698[_0x39be34]['floorlevel']=_0x5dabb6;}else{if(_0x5c5a81==_0x5da4b2(0xf8)&&_0x39be34==_0x446bba){var _0x5dabb6=_0xcc88af['slice'](0x3);_0x351698[_0x39be34]['storage']=_0xcc88af[0x0],_0x351698[_0x39be34][_0x5da4b2(0xc4)]=_0xcc88af[0x1],_0x351698[_0x39be34][_0x5da4b2(0xe2)]=0x0,_0x351698[_0x39be34][_0x5da4b2(0x80)]=0x0,_0x351698[_0x39be34][_0x5da4b2(0x9a)]=_0x5da4b2(0xb5),_0x351698[_0x39be34][_0x5da4b2(0x10d)]=_0xcc88af[0x5];}else{if(_0x39be34==_0x446bba){var _0x52e642;if(_0xcc88af[0x4]=='L')_0x52e642=_0x5da4b2(0x15c);else _0xcc88af[0x4]=='F'&&(_0x52e642=_0x5da4b2(0xb5));_0x351698[_0x39be34][_0x5da4b2(0x128)]=_0xcc88af[0x0],_0x351698[_0x39be34][_0x5da4b2(0xc4)]=_0xcc88af[0x1],_0x351698[_0x39be34][_0x5da4b2(0xe2)]=_0xcc88af[0x2],_0x351698[_0x39be34]['bin']=_0xcc88af[0x3],_0x351698[_0x39be34]['type']=_0x52e642,_0x351698[_0x39be34][_0x5da4b2(0x10d)]=_0xcc88af[0x5];}}}});}),_0x146187[_0x3e7968(0x125)]((_0x5c30fd,_0x5cef40)=>{var _0x53b699=_0x3e7968;_0x351698[_0x5cef40][_0x53b699(0x155)]=_0x5c30fd;}),_0x443905['forEach']((_0x5da81f,_0x5dcfda)=>{var _0x37b347=_0x3e7968;_0x351698[_0x5dcfda][_0x37b347(0x181)]=_0x5da81f;}),_0xf0168a[_0x3e7968(0x125)]((_0xc945a1,_0xdb3128)=>{var _0x4cfa95=_0x3e7968;_0x351698[_0xdb3128][_0x4cfa95(0x131)]=_0xc945a1;}),_0x3dc251[_0x3e7968(0x125)]((_0x56c26c,_0x57e406)=>{var _0x303197=_0x3e7968;_0x351698[_0x57e406][_0x303197(0x14a)]=_0x56c26c;}),_0x1f9656[_0x3e7968(0x125)]((_0x1a0b20,_0x1e3f39)=>{var _0x16f006=_0x3e7968;_0x351698[_0x1e3f39][_0x16f006(0xcb)]=_0x1a0b20;}),_0x42717b[_0x3e7968(0x125)]((_0x479beb,_0x241732)=>{var _0x242a32=_0x3e7968;_0x351698[_0x241732][_0x242a32(0x122)]=_0x479beb;}),_0x4bde70[_0x3e7968(0x125)]((_0x4c2989,_0x50b809)=>{var _0xc382d5=_0x3e7968;_0x351698[_0x50b809][_0xc382d5(0x91)]=Math[_0xc382d5(0x14f)](_0x4c2989);}),_0x17a560[_0x3e7968(0x125)]((_0x359845,_0xd5038d)=>{var _0x365305=_0x3e7968;_0x351698[_0xd5038d][_0x365305(0xac)]=_0x359845;}),_0x1775c6[_0x3e7968(0x125)]((_0x2e905a,_0x44dacc)=>{var _0x21992b=_0x3e7968;_0x351698[_0x44dacc][_0x21992b(0xa7)]=_0x2e905a;}),_0xe3e965['forEach']((_0x575f6a,_0x237cc5)=>{var _0x345551=_0x3e7968;_0x351698[_0x237cc5][_0x345551(0xd9)]=_0x575f6a;}),_0x525dcf[_0x3e7968(0x125)]((_0x1fffab,_0xa0ee9e)=>{var _0x59cf24=_0x3e7968;_0x351698[_0xa0ee9e][_0x59cf24(0xdf)]=_0x1fffab;}),_0x93a836[_0x3e7968(0x125)]((_0x29c1c3,_0x328b37)=>{var _0x1a7594=_0x3e7968;_0x351698[_0x328b37][_0x1a7594(0x129)]=_0x29c1c3;});var _0x291642=0x0;_0x351698[_0x3e7968(0x125)](_0x2e5c5f=>{var _0x26d670=_0x3e7968;console[_0x26d670(0x140)](_0x26d670(0x12a),_0x2e5c5f),(parseInt(_0x2e5c5f['stock'])<parseInt(_0x2e5c5f['quantity'])||parseInt(_0x2e5c5f[_0x26d670(0x71)])==0x0)&&_0x291642++;});if(_0x291642!=0x0)return _0x50650c['flash'](_0x3e7968(0x17d),_0x3e7968(0xf9)),_0x4c5882[_0x3e7968(0xf7)](_0x3e7968(0x151));const _0x5a73e9=_0x351698[_0x3e7968(0x172)](_0x26eb70=>_0x26eb70[_0x3e7968(0x71)]!=='0'&&_0x26eb70[_0x3e7968(0x71)]!=='');_0x2ca8cc[_0x3e7968(0x17b)]=_0xb9637f,_0x2ca8cc[_0x3e7968(0x110)]=_0x527fda,_0x2ca8cc[_0x3e7968(0x13c)]=_0x2235e4,_0x2ca8cc[_0x3e7968(0x167)]=_0x6c8029,_0x2ca8cc[_0x3e7968(0xd1)]=_0x5a73e9,_0x2ca8cc[_0x3e7968(0x8a)]=_0x1aa196,_0x2ca8cc['SCRN']=_0x49ad30,_0x2ca8cc[_0x3e7968(0x97)]=_0x3e7968(0xf3),_0x2ca8cc[_0x3e7968(0xff)]=_0x3e7968(0xf3);const _0x5334cc=await _0x2ca8cc['save']();_0x50650c['flash'](_0x3e7968(0xbb),_0x3e7968(0x9c)),_0x4c5882[_0x3e7968(0xf7)](_0x3e7968(0x14e));}catch(_0x27e93e){console[_0x3e7968(0x140)](_0x27e93e);}}),router['post'](a0_0x448efe(0xe0),auth,async(_0x44c177,_0x4882bc)=>{var _0xcfbfe0=a0_0x448efe;try{const _0x83028b=_0x44c177[_0xcfbfe0(0x15b)]['id'],{invoice:_0xeaf94f,customer:_0x3472a9,receivable_amount:_0x4405d5,received_amount:_0x57bcac}=_0x44c177[_0xcfbfe0(0x96)],_0x1974c5=await sales[_0xcfbfe0(0x113)](_0x83028b);console[_0xcfbfe0(0x140)](_0x1974c5);var _0x6f9f57=_0x4405d5-_0x57bcac;console[_0xcfbfe0(0x140)](_0x57bcac),_0x1974c5[_0xcfbfe0(0xdb)]=parseFloat(_0x57bcac)+parseFloat(_0x1974c5[_0xcfbfe0(0xdb)]),_0x1974c5[_0xcfbfe0(0x16e)]=_0x6f9f57,console[_0xcfbfe0(0x140)](_0x1974c5);const _0x247275=await _0x1974c5[_0xcfbfe0(0xfc)](),_0x34db25=await c_payment_data[_0xcfbfe0(0x119)]({'invoice':_0xeaf94f});_0x34db25[_0xcfbfe0(0x10b)]=_0x6f9f57,await _0x34db25[_0xcfbfe0(0xfc)]();let _0x25dba3=new Date(),_0x8baaa8=('0'+_0x25dba3['getDate']())[_0xcfbfe0(0x6e)](-0x2),_0x5f3295=('0'+(_0x25dba3[_0xcfbfe0(0x112)]()+0x1))[_0xcfbfe0(0x6e)](-0x2),_0x301dec=_0x25dba3['getFullYear'](),_0x26ddc6=_0x301dec+'-'+_0x5f3295+'-'+_0x8baaa8;const _0x3bfef0=new customer_payment({'invoice':_0xeaf94f,'date':_0x301dec+'-'+_0x5f3295+'-'+_0x8baaa8,'customer':_0x3472a9,'reason':_0xcfbfe0(0x168),'amount':_0x57bcac}),_0x4a712e=await _0x3bfef0[_0xcfbfe0(0xfc)]();_0x44c177[_0xcfbfe0(0x16d)](_0xcfbfe0(0xbb),'payment\x20successfull'),_0x4882bc['redirect'](_0xcfbfe0(0x14e));}catch(_0xbeaddb){console[_0xcfbfe0(0x140)](_0xbeaddb);}}),router[a0_0x448efe(0x10f)](a0_0x448efe(0xea),auth,async(_0x1b81f0,_0x3b3ec8)=>{var _0x58a6bf=a0_0x448efe;try{const {username:_0x53783b,email:_0x3ebdc1,role:_0x283be8}=_0x1b81f0[_0x58a6bf(0xb9)],_0x494f55=_0x1b81f0[_0x58a6bf(0xb9)],_0x1d54f7=await profile[_0x58a6bf(0x119)]({'email':_0x494f55['email']}),_0x82daec=await master_shop[_0x58a6bf(0xe8)]();console[_0x58a6bf(0x140)](_0x58a6bf(0x9f),_0x82daec);const _0x9f2ed2=_0x1b81f0[_0x58a6bf(0x15b)]['id'],_0x217838=await sales[_0x58a6bf(0x113)](_0x9f2ed2);console['log'](_0x217838);const _0x4fe6bc=await customer['findOne']({'name':_0x217838[_0x58a6bf(0x110)]});console[_0x58a6bf(0x140)](_0x4fe6bc);if(_0x82daec[0x0][_0x58a6bf(0xf6)]=='English\x20(US)'){var _0x326ed5=users['English'];console['log'](_0x326ed5);}else{if(_0x82daec[0x0][_0x58a6bf(0xf6)]=='Hindi')var _0x326ed5=users[_0x58a6bf(0x173)];else{if(_0x82daec[0x0][_0x58a6bf(0xf6)]==_0x58a6bf(0x145))var _0x326ed5=users[_0x58a6bf(0x145)];else{if(_0x82daec[0x0]['language']==_0x58a6bf(0xfd))var _0x326ed5=users[_0x58a6bf(0xfd)];else{if(_0x82daec[0x0]['language']==_0x58a6bf(0xf0))var _0x326ed5=users['French'];else{if(_0x82daec[0x0]['language']==_0x58a6bf(0xe6))var _0x326ed5=users['Portuguese'];else{if(_0x82daec[0x0][_0x58a6bf(0xf6)]==_0x58a6bf(0x149))var _0x326ed5=users[_0x58a6bf(0x149)];else{if(_0x82daec[0x0][_0x58a6bf(0xf6)]==_0x58a6bf(0xd3))var _0x326ed5=users[_0x58a6bf(0x7c)];}}}}}}}_0x3b3ec8[_0x58a6bf(0xc8)]('sales_invoice',{'success':_0x1b81f0[_0x58a6bf(0x16d)](_0x58a6bf(0xbb)),'errors':_0x1b81f0[_0x58a6bf(0x16d)](_0x58a6bf(0x17d)),'role':_0x494f55,'profile':_0x1d54f7,'master_shop':_0x82daec,'customers':_0x4fe6bc,'sales':_0x217838,'language':_0x326ed5});}catch(_0x118e18){console[_0x58a6bf(0x140)](_0x118e18);}}),router[a0_0x448efe(0x10f)]('/view/return_sales/:id',auth,async(_0x3becb3,_0x1b8194)=>{var _0x38f4a6=a0_0x448efe;try{const {username:_0x318345,email:_0x259e08,role:_0x3cd6bf}=_0x3becb3[_0x38f4a6(0xb9)],_0x53152e=_0x3becb3[_0x38f4a6(0xb9)],_0x5a6c57=await profile[_0x38f4a6(0x119)]({'email':_0x53152e['email']}),_0x54b210=await master_shop[_0x38f4a6(0xe8)]();console['log'](_0x38f4a6(0x9f),_0x54b210);const _0x272cd1=_0x3becb3[_0x38f4a6(0x15b)]['id'];console[_0x38f4a6(0x140)](_0x272cd1);const _0x2bae58=await sales[_0x38f4a6(0x113)](_0x272cd1);console[_0x38f4a6(0x140)](_0x38f4a6(0xab),_0x2bae58);const _0x2792ec=await warehouse[_0x38f4a6(0xec)]([{'$match':{'name':_0x38f4a6(0x8d),'room':_0x38f4a6(0xa4)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x38f4a6(0x123),'name':{'$first':_0x38f4a6(0x12f)},'product_stock':{'$first':_0x38f4a6(0x93)},'level':{'$first':_0x38f4a6(0xfb)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x38f4a6(0xed)},'primary_code':{'$first':_0x38f4a6(0x162)},'secondary_code':{'$first':_0x38f4a6(0x98)},'product_code':{'$first':_0x38f4a6(0xaf)}}}]);console[_0x38f4a6(0x140)](_0x38f4a6(0x109),_0x2792ec);const _0x3912a0=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x38f4a6(0x76),'name':_0x38f4a6(0x8d),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x38f4a6(0x153),'name':{'$first':_0x38f4a6(0x153)}}},{'$sort':{'name':0x1}}]);var _0x4c01c4=[_0x38f4a6(0xa4)];if(_0x54b210[0x0][_0x38f4a6(0xf6)]=='English\x20(US)'){var _0xcda59f=users[_0x38f4a6(0x15a)];console[_0x38f4a6(0x140)](_0xcda59f);}else{if(_0x54b210[0x0][_0x38f4a6(0xf6)]=='Hindi')var _0xcda59f=users[_0x38f4a6(0x173)];else{if(_0x54b210[0x0][_0x38f4a6(0xf6)]==_0x38f4a6(0x145))var _0xcda59f=users[_0x38f4a6(0x145)];else{if(_0x54b210[0x0][_0x38f4a6(0xf6)]=='Spanish')var _0xcda59f=users['Spanish'];else{if(_0x54b210[0x0]['language']==_0x38f4a6(0xf0))var _0xcda59f=users[_0x38f4a6(0xf0)];else{if(_0x54b210[0x0][_0x38f4a6(0xf6)]==_0x38f4a6(0xe6))var _0xcda59f=users[_0x38f4a6(0xef)];else{if(_0x54b210[0x0]['language']==_0x38f4a6(0x149))var _0xcda59f=users[_0x38f4a6(0x149)];else{if(_0x54b210[0x0][_0x38f4a6(0xf6)]=='Arabic\x20(ae)')var _0xcda59f=users[_0x38f4a6(0x7c)];}}}}}}}_0x1b8194[_0x38f4a6(0xc8)](_0x38f4a6(0x169),{'success':_0x3becb3[_0x38f4a6(0x16d)]('success'),'errors':_0x3becb3[_0x38f4a6(0x16d)](_0x38f4a6(0x17d)),'role':_0x53152e,'profile':_0x5a6c57,'user':_0x2bae58,'stock':_0x2792ec,'master_shop':_0x54b210,'unit':_0x3912a0,'language':_0xcda59f,'warehouses':warehouse_data,'rooms':_0x4c01c4});}catch(_0x22fccf){console[_0x38f4a6(0x140)](_0x22fccf),_0x1b8194[_0x38f4a6(0x165)](0xc8)['json']({'message':_0x22fccf[_0x38f4a6(0xc3)]});}}),router['post'](a0_0x448efe(0x147),auth,async(_0xef3a43,_0x34e008)=>{var _0x35b208=a0_0x448efe;try{const {invoice:_0x11e658,date:_0xb77e9a,warehouse_name:_0x5078e1,product_name:_0x446c67,primary_code:_0x3b11fc,secondary_code:_0x3e82f6,product_code:_0x962560,sales_quantity:_0xb2f089,stocks:_0x510dc6,return_qty:_0x85df38,Room_name:_0x45f25d,to_warehouse_name:_0x5dce64,to_Roomname:_0x42d96f,to_Room_name:_0x4612b5,note:_0x13fe6f,level:_0xde4324,isle:_0x27343c,pallet:_0x4bed9d}=_0xef3a43[_0x35b208(0x96)];if(typeof _0x446c67==_0x35b208(0xa9))var _0x3b673f=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0x15d)]],_0x15adea=[_0xef3a43[_0x35b208(0x96)]['primary_code']],_0x2b9a51=[_0xef3a43[_0x35b208(0x96)]['secondary_code']],_0x2a34d4=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0xad)]],_0x6ee8e5=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0x77)]],_0x165d87=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0x117)]],_0x5bbffb=[_0xef3a43['body'][_0x35b208(0xeb)]],_0xb9e06b=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0xe2)]],_0x42a64d=[_0xef3a43['body'][_0x35b208(0x80)]],_0x411d61=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0x17e)]],_0x31a185=[_0xef3a43[_0x35b208(0x96)][_0x35b208(0x10d)]];else var _0x3b673f=[..._0xef3a43['body'][_0x35b208(0x15d)]],_0x15adea=[..._0xef3a43['body']['primary_code']],_0x2b9a51=[..._0xef3a43['body'][_0x35b208(0xdc)]],_0x2a34d4=[..._0xef3a43['body'][_0x35b208(0xad)]],_0x6ee8e5=[..._0xef3a43['body'][_0x35b208(0x77)]],_0x165d87=[..._0xef3a43[_0x35b208(0x96)][_0x35b208(0x117)]],_0x5bbffb=[..._0xef3a43[_0x35b208(0x96)][_0x35b208(0xeb)]],_0xb9e06b=[..._0xef3a43['body'][_0x35b208(0xe2)]],_0x42a64d=[..._0xef3a43[_0x35b208(0x96)][_0x35b208(0x80)]],_0x411d61=[..._0xef3a43[_0x35b208(0x96)]['types']],_0x31a185=[..._0xef3a43[_0x35b208(0x96)][_0x35b208(0x10d)]];const _0x332d45=_0x3b673f[_0x35b208(0xbe)](_0x32c68d=>{return _0x32c68d={'product_name':_0x32c68d};});_0x15adea[_0x35b208(0x125)]((_0x28f21c,_0x1aab50)=>{_0x332d45[_0x1aab50]['primary_code']=_0x28f21c;}),_0x2b9a51[_0x35b208(0x125)]((_0x43ca8f,_0x42ccc9)=>{_0x332d45[_0x42ccc9]['secondary_code']=_0x43ca8f;}),_0x2a34d4[_0x35b208(0x125)]((_0x3c5d5f,_0x49bd34)=>{var _0x281d56=_0x35b208;_0x332d45[_0x49bd34][_0x281d56(0xad)]=_0x3c5d5f;}),_0x6ee8e5['forEach']((_0x512f04,_0x2fb9bc)=>{_0x332d45[_0x2fb9bc]['sale_qty']=_0x512f04;}),_0x165d87[_0x35b208(0x125)]((_0x5a2323,_0x4f0113)=>{var _0x2c3ccb=_0x35b208;_0x332d45[_0x4f0113][_0x2c3ccb(0x8b)]=_0x5a2323;}),_0x5bbffb[_0x35b208(0x125)]((_0x428ebf,_0x4a34d9)=>{var _0x5a0102=_0x35b208;_0x332d45[_0x4a34d9][_0x5a0102(0xeb)]=_0x428ebf;}),_0xb9e06b['forEach']((_0x386abe,_0x8c4f41)=>{var _0x5c5099=_0x35b208;_0x332d45[_0x8c4f41][_0x5c5099(0xe2)]=_0x386abe;}),_0x42a64d['forEach']((_0x36e756,_0x513396)=>{var _0x530df5=_0x35b208;_0x332d45[_0x513396][_0x530df5(0x80)]=_0x36e756;}),_0x411d61[_0x35b208(0x125)]((_0x414aad,_0x5436f7)=>{var _0x4b3589=_0x35b208;_0x332d45[_0x5436f7][_0x4b3589(0x9a)]=_0x414aad;}),_0x31a185['forEach']((_0x30c5ec,_0x6a54c1)=>{var _0x1550ad=_0x35b208;_0x332d45[_0x6a54c1][_0x1550ad(0x10d)]=_0x30c5ec;});var _0x325ca3=0x0;_0x332d45[_0x35b208(0x125)](_0x5d0136=>{var _0xdcdd74=_0x35b208;console['log']('foreach\x20newproduct',_0x5d0136),(parseInt(_0x5d0136[_0xdcdd74(0x107)])<parseInt(_0x5d0136[_0xdcdd74(0xeb)])||parseInt(_0x5d0136[_0xdcdd74(0x8b)])<parseInt(_0x5d0136['return_qty'])&&parseInt(_0x5d0136['sale_qty'])>parseInt(_0x5d0136[_0xdcdd74(0xeb)])||parseInt(_0x5d0136[_0xdcdd74(0xeb)])==0x0)&&_0x325ca3++;});if(_0x325ca3!=0x0)return _0xef3a43['flash'](_0x35b208(0x17d),_0x35b208(0x7a)),_0x34e008[_0x35b208(0xf7)](_0x35b208(0x151));const _0x2b1787=await sales[_0x35b208(0x119)]({'invoice':_0x11e658});console['log'](_0x2b1787),_0x2b1787[_0x35b208(0x86)]=_0x35b208(0x99);const _0x2e4c16=await _0x2b1787[_0x35b208(0xfc)](),_0x14156f=new sales_return({'invoice':_0x11e658,'customer':_0xef3a43[_0x35b208(0x96)]['customer'],'date':_0xb77e9a,'warehouse_name':_0x5078e1,'room':_0x45f25d,'ToWarehouse':_0x5dce64,'ToRoom':_0x4612b5,'return_sale':_0x332d45,'note':_0x13fe6f}),_0x5a6537=await _0x14156f[_0x35b208(0xfc)]();console[_0x35b208(0x140)](_0x14156f);const _0x57448b=await sales_return[_0x35b208(0x119)]({'invoice':_0x11e658}),_0x5ee4cd=await warehouse[_0x35b208(0x119)]({'name':_0x5dce64,'room':_0x4612b5});_0x57448b['return_sale'][_0x35b208(0x125)](_0x15e996=>{var _0xb767bb=_0x35b208,_0x43afc9=0x0;const _0x4abf24=_0x5ee4cd[_0xb767bb(0x13f)]['map'](_0x2941fc=>{var _0x29cc63=_0xb767bb;_0x2941fc[_0x29cc63(0x15d)]==_0x15e996[_0x29cc63(0x15d)]&&_0x2941fc['floorlevel']==_0x15e996[_0x29cc63(0x10d)]&&_0x2941fc[_0x29cc63(0x9a)]==_0x15e996[_0x29cc63(0x9a)]&&_0x2941fc[_0x29cc63(0x80)]==_0x15e996[_0x29cc63(0x80)]&&_0x2941fc[_0x29cc63(0xe2)]==_0x15e996[_0x29cc63(0xe2)]&&(_0x2941fc[_0x29cc63(0x144)]=parseInt(_0x2941fc[_0x29cc63(0x144)])+parseInt(_0x15e996[_0x29cc63(0xeb)]),_0x43afc9++);});_0x43afc9=='0'&&(_0x5ee4cd[_0xb767bb(0x13f)]=_0x5ee4cd[_0xb767bb(0x13f)][_0xb767bb(0xb1)]({'product_name':_0x15e996[_0xb767bb(0x15d)],'product_stock':_0x15e996[_0xb767bb(0xeb)],'primary_code':_0x15e996['primary_code'],'secondary_code':_0x15e996['secondary_code'],'product_code':_0x15e996[_0xb767bb(0xad)],'bay':_0x15e996['bay'],'bin':_0x15e996[_0xb767bb(0x80)],'type':_0x15e996[_0xb767bb(0x9a)],'floorlevel':_0x15e996['floorlevel']})),console[_0xb767bb(0x140)](_0xb767bb(0xa6),_0x5ee4cd);}),await _0x5ee4cd[_0x35b208(0xfc)](),console[_0x35b208(0x140)](_0xef3a43['body']);const _0x221273=new c_payment_data({'invoice':_0x11e658,'customer':_0xef3a43['body'][_0x35b208(0x110)],'reason':'Sale\x20Return'});await _0x221273[_0x35b208(0xfc)]();const _0x5425e5=await master_shop['find']();console[_0x35b208(0x140)](_0x35b208(0x8f),_0x5425e5[0x0][_0x35b208(0x157)]);const _0x2350b1=await email_settings['findOne'](),_0xd6826c=await customer[_0x35b208(0x119)]({'name':_0xef3a43['body'][_0x35b208(0x110)]});console[_0x35b208(0x140)]('customer_data',_0xd6826c);_0x5425e5[0x0][_0x35b208(0x13a)]==0x1?(right_currency=_0x5425e5[0x0][_0x35b208(0x14c)],left_currency=''):(right_currency='',left_currency=_0x5425e5[0x0][_0x35b208(0x14c)]);var _0x2ab097=_0x3b673f,_0x1d1035=_0x5bbffb,_0x56558b='',_0x1610f3;for(_0x1610f3 in _0x2ab097){_0x56558b+='<tr>'+_0x35b208(0x83)+_0x2ab097[_0x1610f3]+_0x35b208(0x178)+_0x35b208(0x83)+_0x1d1035[_0x1610f3]+_0x35b208(0x178)+_0x35b208(0x9b);}console[_0x35b208(0x140)]('product_list',_0x56558b);let _0x5082cd=nodemailer['createTransport']({'service':_0x35b208(0x79),'auth':{'user':_0x2350b1['email'],'pass':_0x2350b1[_0x35b208(0x160)]}}),_0x301e0e={'from':_0x2350b1[_0x35b208(0x163)],'to':_0xd6826c[_0x35b208(0x163)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x35b208(0xa1),'path':__dirname+'/../public'+'/upload/'+_0x5425e5[0x0][_0x35b208(0x157)],'cid':_0x35b208(0x82)}],'html':'<!DOCTYPE\x20html>'+_0x35b208(0x11c)+'</head><body>'+_0x35b208(0xe7)+_0x35b208(0x101)+_0x35b208(0xe7)+_0x35b208(0x78)+_0x35b208(0x182)+_0x35b208(0xe7)+'<h2>\x20'+_0x5425e5[0x0][_0x35b208(0xc5)]+_0x35b208(0x17f)+'</div>'+_0x35b208(0x182)+_0x35b208(0x13e)+_0x35b208(0xe7)+_0x35b208(0x108)+_0x35b208(0x135)+_0x11e658+'\x20'+_0x35b208(0x11d)+_0x35b208(0xb6)+_0xb77e9a+'\x20'+_0x35b208(0xe4)+_0x35b208(0xd4)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x35b208(0xa5)+_0x35b208(0xe1)+_0x35b208(0xa2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x35b208(0x9b)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x56558b+'\x20'+_0x35b208(0x156)+'</table>'+_0x35b208(0xe7)+_0x35b208(0x159)+_0x35b208(0x14d)+_0x5425e5[0x0][_0x35b208(0xc5)]+'</h5>'+_0x35b208(0x182)+_0x35b208(0x182)+'</body></html>'};_0x5082cd[_0x35b208(0x166)](_0x301e0e,function(_0x16b703,_0x5beb2a){var _0x55ec38=_0x35b208;_0x16b703?(console['log'](_0x16b703),console[_0x55ec38(0x140)](_0x55ec38(0xee))):console[_0x55ec38(0x140)](_0x55ec38(0x100));}),_0xef3a43[_0x35b208(0x16d)]('success',_0x35b208(0x75)),_0x34e008[_0x35b208(0xf7)]('/all_sales/view');}catch(_0x2638ce){console[_0x35b208(0x140)](_0x2638ce),_0x34e008[_0x35b208(0x165)](0xc8)[_0x35b208(0xd8)]({'message1':_0x2638ce[_0x35b208(0xc3)]});}}),router[a0_0x448efe(0x10f)](a0_0x448efe(0x7e),auth,async(_0x3c87cd,_0x51e443)=>{var _0x4f97ba=a0_0x448efe;try{const {username:_0x3d83e8,email:_0x303472,role:_0x5672e5}=_0x3c87cd[_0x4f97ba(0xb9)],_0x24193f=_0x3c87cd[_0x4f97ba(0xb9)],_0xcc1494=await profile[_0x4f97ba(0x119)]({'email':_0x24193f[_0x4f97ba(0x163)]}),_0x1a38f0=await master_shop[_0x4f97ba(0xe8)]();console[_0x4f97ba(0x140)](_0x4f97ba(0xb3),_0x1a38f0);const _0x429b2a=_0x3c87cd[_0x4f97ba(0x15b)]['id'],_0x214797=await sales[_0x4f97ba(0x113)](_0x429b2a);console[_0x4f97ba(0x140)](_0x4f97ba(0x8c),_0x214797);if(_0x1a38f0[0x0][_0x4f97ba(0xf6)]=='English\x20(US)')var _0x3acf86=users[_0x4f97ba(0x15a)];else{if(_0x1a38f0[0x0]['language']==_0x4f97ba(0x173))var _0x3acf86=users[_0x4f97ba(0x173)];else{if(_0x1a38f0[0x0][_0x4f97ba(0xf6)]==_0x4f97ba(0x145))var _0x3acf86=users[_0x4f97ba(0x145)];else{if(_0x1a38f0[0x0][_0x4f97ba(0xf6)]==_0x4f97ba(0xfd))var _0x3acf86=users[_0x4f97ba(0xfd)];else{if(_0x1a38f0[0x0][_0x4f97ba(0xf6)]=='French')var _0x3acf86=users[_0x4f97ba(0xf0)];else{if(_0x1a38f0[0x0]['language']=='Portuguese\x20(BR)')var _0x3acf86=users[_0x4f97ba(0xef)];else{if(_0x1a38f0[0x0][_0x4f97ba(0xf6)]==_0x4f97ba(0x149))var _0x3acf86=users[_0x4f97ba(0x149)];else{if(_0x1a38f0[0x0][_0x4f97ba(0xf6)]=='Arabic\x20(ae)')var _0x3acf86=users['Arabic'];}}}}}}}_0x51e443[_0x4f97ba(0xc8)](_0x4f97ba(0x133),{'success':_0x3c87cd['flash'](_0x4f97ba(0xbb)),'errors':_0x3c87cd[_0x4f97ba(0x16d)](_0x4f97ba(0x17d)),'role':_0x24193f,'profile':_0xcc1494,'alldata':_0x214797,'master_shop':_0x1a38f0,'language':_0x3acf86});}catch(_0x5ded51){console[_0x4f97ba(0x140)](_0x5ded51);}}),router[a0_0x448efe(0x11b)](a0_0x448efe(0xbc),async(_0x3cd21c,_0x4006f9)=>{var _0xf2e9ce=a0_0x448efe;const {product_code:_0xbc9f0,warehouse_name:_0x5cae43,rooms_data:_0x4e636a,Roomslist:_0x1d95f5}=_0x3cd21c[_0xf2e9ce(0x96)],_0x9f1838=_0x1d95f5[_0xf2e9ce(0x141)](','),_0x12f8ee=[];async function _0x313a3c(_0x59e445){var _0x2b58d6=_0xf2e9ce;const _0x1e86ab=await warehouse['aggregate']([{'$match':{'name':_0x5cae43,'room':_0x59e445}},{'$unwind':_0x2b58d6(0x70)},{'$match':{'product_details.primary_code':_0xbc9f0}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2b58d6(0x12f)},'product_stock':{'$first':_0x2b58d6(0x93)},'primary_code':{'$first':_0x2b58d6(0x162)},'secondary_code':{'$first':_0x2b58d6(0x98)},'product_code':{'$first':_0x2b58d6(0xaf)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2b58d6(0x139)},'type':{'$first':_0x2b58d6(0x84)},'pallet':{'$first':_0x2b58d6(0x148)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2b58d6(0x115)},'storage':{'$first':_0x2b58d6(0xc2)},'rack':{'$first':_0x2b58d6(0x14b)},'expiry_date':{'$first':_0x2b58d6(0xe5)},'production_date':{'$first':_0x2b58d6(0x74)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x2b58d6(0xcd)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2b58d6(0x132)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x2b58d6(0xe3)}}}]),_0x2cc375=await warehouse[_0x2b58d6(0xec)]([{'$match':{'name':_0x5cae43,'room':_0x59e445}},{'$unwind':_0x2b58d6(0x70)},{'$match':{'product_details.secondary_code':_0xbc9f0}},{'$group':{'_id':_0x2b58d6(0x123),'name':{'$first':_0x2b58d6(0x12f)},'product_stock':{'$first':_0x2b58d6(0x93)},'primary_code':{'$first':_0x2b58d6(0x162)},'secondary_code':{'$first':_0x2b58d6(0x98)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2b58d6(0x6d)},'isle':{'$first':_0x2b58d6(0x139)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2b58d6(0x118)},'secondary_unit':{'$first':_0x2b58d6(0x115)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2b58d6(0x74)},'maxPerUnit':{'$first':_0x2b58d6(0x6f)},'batch_code':{'$first':_0x2b58d6(0xcd)},'product_cat':{'$first':_0x2b58d6(0x16f)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2b58d6(0x132)},'invoice':{'$first':_0x2b58d6(0x138)}}}]);if(_0x1e86ab['length']>0x0)_0x12f8ee['push'](_0x1e86ab);else _0x2cc375[_0x2b58d6(0x13b)]>0x0&&_0x12f8ee[_0x2b58d6(0x16a)](_0x2cc375);}const _0x471751=_0x9f1838['map'](_0x471be3=>_0x313a3c(_0x471be3));await Promise[_0xf2e9ce(0xd0)](_0x471751),_0x4006f9['json'](_0x12f8ee);}),module[a0_0x448efe(0x103)]=router;function a0_0xac8e(_0x2b1313,_0x44b4b4){var _0x8ea0b5=a0_0x8ea0();return a0_0xac8e=function(_0xac8e92,_0x2906a5){_0xac8e92=_0xac8e92-0x6d;var _0x5e0b11=_0x8ea0b5[_0xac8e92];return _0x5e0b11;},a0_0xac8e(_0x2b1313,_0x44b4b4);}function a0_0x8ea0(){var _0x56a74d=['$product_details.actual_uom','</span>','$product_details.expiry_date','Portuguese\x20(BR)','<div>','find','64ivqbni','/invoice/:id','return_qty','aggregate','$product_details.pallet','Error\x20Occurs','Portuguese','French','toString','prod_invoice','False','606qojWYi','<tbody\x20style=\x22text-align:\x20center;\x22>','language','redirect','Shelves','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','port','$product_details.level','save','Spanish','5351689hNyitc','isAllowEdit','Email\x20sent\x20successfully','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','exports','1653NjaGRb','id_transact','Sales\x20Add\x20successfully','sale_qty','<h5\x20style=\x22text-align:\x20left;\x22>','stock_data','/view/add_sale/product','amount','Ambient','floorlevel','prod_code','get','customer','$sale_product.floorlevel','getMonth','findById','all_sales','$product_details.secondary_unit','$date','stocks','$product_details.unit','findOne','524869oEotFY','post','<html><head><title></title>','<span\x20style=\x22float:\x20right;\x22>','floor','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','host','$product','production_date','$product_details._id','<tr>','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$invoice','storage','room_name','foreach\x20newproduct','warehouse','/preview/:id','$isAllowEdit','1508922ZWydJN','$product_details.product_name','Raw\x20Materials','batch_code','$room','all_sales_barcode','max','\x20Order\x20Number\x20:\x20','$sale_product.quantity','$customers_docs','$product_details.invoice','$product_details.bin','currency_placement','length','date','primary_unit','<hr\x20class=\x22my-3\x22>','product_details','log','split','id_transaction_from','<!DOCTYPE\x20html>','product_stock','German','../models/all_models','/view/return_sales/:id','$product_details.floorlevel','Chinese','expiry_date','$product_details.rack','currency','<h5>','/all_sales/view','abs','catch','back','actual_uom','$name','$customer','unit','</tbody>','image','5072tCfJNx','<strong>\x20Regards\x20</strong>','English','params','Level','product_name','add_sales','name','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.primary_code','email','$warehouse_name','status','sendMail','warehouse_name','Received\x20Payment\x20For\x20Sale','return_sale','push','$return_data','customers_docs','flash','due_amount','$product_details.product_cat','/all_sales/preview/','$sale_product.bin','filter','Hindi','5493268nHKVcm','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Receiving\x20Area','/../public','</td>','/view/add_sales/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','invoice','$sale_product.bay','errors','types','\x20</h2>','RoomAssigned','secondary_unit','</div>','$product_details.bay','slice','$product_details.maxPerUnit','$product_details','quantity','primary_code','$sale_product','$product_details.production_date','sales\x20item\x20return\x20successfull','Enabled','sales_quantity','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','gmail','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','error','Arabic','purchases_data','/barcode/:id','52565zJYgaa','bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','logo','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.type','$finalize','return_data','206667HZbkqv','/view/add_sales','$sale_product.type','note','stock','barcode\x20user_id','Return\x20Goods','edit_sales','add\x20post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','requested_qty','$note','$product_details.product_stock','10IKOXiG','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','body','finalize','$product_details.secondary_code','True','type','</tr>','Sales\x20Update\x20successfully','role','actual_qty','master','room','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','express','Return\x20Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','final','delivery_code','product','string','createTransport','user_id','delivery_date','product_code','customers','$product_details.product_code','Sales\x20Mail','concat','<table\x20style=\x22width:\x20100%\x20!important;\x22>','barcode\x20Product\x20master','$_id','Floor','\x20Order\x20Date\x20:\x20','/upload/','</thead>','user','level','success','/barcode_scanner','then','map','$product.product_name','../public/language/languages.json','staff','$product_details.storage','message','rack','site_title','</table>','/view/:id','render','English\x20(US)','nodemailer','maxperunit','Enclosed','$product_details.batch_code','</head><body>','Router','all','sale_product','carton','Arabic\x20(ae)','</h5>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view','OUT-','json','prod_cat','max_per_unit','received_amount','secondary_code','_id','product_data','quantity_notConverted','/give_payment/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','bay'];a0_0x8ea0=function(){return _0x56a74d;};return a0_0x8ea0();}