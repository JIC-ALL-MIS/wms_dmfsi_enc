var a0_0x3cce07=a0_0x1d7e;(function(_0xe7859c,_0x3e7585){var _0x393bb6=a0_0x1d7e,_0x328371=_0xe7859c();while(!![]){try{var _0x3193d2=parseInt(_0x393bb6(0x1a0))/0x1+-parseInt(_0x393bb6(0x1b7))/0x2*(parseInt(_0x393bb6(0x255))/0x3)+parseInt(_0x393bb6(0x19f))/0x4+-parseInt(_0x393bb6(0x248))/0x5+parseInt(_0x393bb6(0x1ae))/0x6*(-parseInt(_0x393bb6(0x1a7))/0x7)+parseInt(_0x393bb6(0x1e7))/0x8+parseInt(_0x393bb6(0x1f8))/0x9*(parseInt(_0x393bb6(0x1ce))/0xa);if(_0x3193d2===_0x3e7585)break;else _0x328371['push'](_0x328371['shift']());}catch(_0x524275){_0x328371['push'](_0x328371['shift']());}}}(a0_0x4483,0xecd0f));function a0_0x1d7e(_0x66748d,_0x341c4d){var _0x44835a=a0_0x4483();return a0_0x1d7e=function(_0x1d7e98,_0x52a816){_0x1d7e98=_0x1d7e98-0x17b;var _0x194a7f=_0x44835a[_0x1d7e98];return _0x194a7f;},a0_0x1d7e(_0x66748d,_0x341c4d);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x3cce07(0x26c)),auth=require(a0_0x3cce07(0x228)),nodemailer=require(a0_0x3cce07(0x247)),users=require(a0_0x3cce07(0x1ad));router['get'](a0_0x3cce07(0x284),auth,async(_0x22956a,_0xe6fa3a)=>{var _0x4704e9=a0_0x3cce07;try{const {username:_0x26cfff,email:_0x3e936b,role:_0x2bad66}=_0x22956a[_0x4704e9(0x1dc)],_0xad7583=_0x22956a[_0x4704e9(0x1dc)],_0x47d689=await profile[_0x4704e9(0x283)]({'email':_0xad7583[_0x4704e9(0x27c)]}),_0x3dcdd5=await master_shop[_0x4704e9(0x1c6)]();let _0x43cb13;if(_0xad7583[_0x4704e9(0x17b)]=='staff'){const _0x3fe011=await staff[_0x4704e9(0x283)]({'email':_0xad7583['email']});_0x43cb13=await sales[_0x4704e9(0x1ec)]([{'$lookup':{'from':_0x4704e9(0x21c),'localField':_0x4704e9(0x268),'foreignField':_0x4704e9(0x1e9),'as':_0x4704e9(0x231)}},{'$unwind':_0x4704e9(0x1bc)},{'$unwind':_0x4704e9(0x208)},{'$group':{'_id':_0x4704e9(0x19e),'invoice':{'$first':_0x4704e9(0x185)},'customers':{'$first':_0x4704e9(0x22b)},'date':{'$first':_0x4704e9(0x267)},'warehouse_name':{'$first':_0x4704e9(0x204)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4704e9(0x1b9)},'return_data':{'$first':_0x4704e9(0x1fa)},'customers_docs':{'$first':_0x4704e9(0x1bc)},'total_saleproduct_quantity':{'$sum':_0x4704e9(0x26a)},'level':{'$addToSet':_0x4704e9(0x18e)},'isle':{'$addToSet':_0x4704e9(0x1e1)},'type':{'$addToSet':_0x4704e9(0x207)},'pallet':{'$addToSet':_0x4704e9(0x222)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x43cb13=await sales['aggregate']([{'$lookup':{'from':_0x4704e9(0x21c),'localField':'customer','foreignField':'name','as':_0x4704e9(0x231)}},{'$unwind':_0x4704e9(0x1bc)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4704e9(0x19e),'invoice':{'$first':_0x4704e9(0x185)},'customers':{'$first':_0x4704e9(0x22b)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x4704e9(0x1b9)},'return_data':{'$first':_0x4704e9(0x1fa)},'customers_docs':{'$first':_0x4704e9(0x1bc)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4704e9(0x18e)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x4704e9(0x207)},'pallet':{'$addToSet':_0x4704e9(0x222)},'finalize':{'$first':_0x4704e9(0x23d)},'isAllowEdit':{'$first':_0x4704e9(0x1d4)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4704e9(0x282)](_0x4704e9(0x269),_0x43cb13);if(_0x3dcdd5[0x0]['language']==_0x4704e9(0x19d)){var _0x5b0ead=users['English'];console[_0x4704e9(0x282)](_0x5b0ead);}else{if(_0x3dcdd5[0x0][_0x4704e9(0x24e)]=='Hindi')var _0x5b0ead=users[_0x4704e9(0x234)];else{if(_0x3dcdd5[0x0]['language']=='German')var _0x5b0ead=users['German'];else{if(_0x3dcdd5[0x0][_0x4704e9(0x24e)]==_0x4704e9(0x19b))var _0x5b0ead=users[_0x4704e9(0x19b)];else{if(_0x3dcdd5[0x0][_0x4704e9(0x24e)]=='French')var _0x5b0ead=users[_0x4704e9(0x1ee)];else{if(_0x3dcdd5[0x0][_0x4704e9(0x24e)]=='Portuguese\x20(BR)')var _0x5b0ead=users[_0x4704e9(0x1df)];else{if(_0x3dcdd5[0x0][_0x4704e9(0x24e)]==_0x4704e9(0x258))var _0x5b0ead=users[_0x4704e9(0x258)];else{if(_0x3dcdd5[0x0]['language']=='Arabic\x20(ae)')var _0x5b0ead=users['Arabic'];}}}}}}}_0xe6fa3a[_0x4704e9(0x25b)](_0x4704e9(0x212),{'success':_0x22956a[_0x4704e9(0x238)](_0x4704e9(0x23f)),'errors':_0x22956a[_0x4704e9(0x238)](_0x4704e9(0x243)),'sales':_0x43cb13,'profile':_0x47d689,'role':_0xad7583,'master_shop':_0x3dcdd5,'language':_0x5b0ead});}catch(_0x57dffb){console['log'](_0x57dffb);}});async function getRandom8DigitNumber(){var _0x4168ff=a0_0x3cce07;const _0x29ce85=0x989680,_0xb2ec3d=0x5f5e0ff,_0xc999e9=Math[_0x4168ff(0x1c4)](Math[_0x4168ff(0x235)]()*(_0xb2ec3d-_0x29ce85+0x1))+_0x29ce85;var _0x4e697f;const _0x2d6458=await sales['findOne']({'invoice':_0x4168ff(0x25c)+_0xc999e9});return _0x2d6458&&_0x2d6458[_0x4168ff(0x1a3)]>0x0?_0x4e697f='OUT-'+_0xc999e9:_0x4e697f='OUT-'+_0xc999e9,_0x4e697f;}function a0_0x4483(){var _0xe02480=['$isAllowEdit','/view/add_sale/product','carton','Floor','/../public','\x20Order\x20Number\x20:\x20','push','floorlevel','user','Email\x20sent\x20successfully','Sale\x20Return\x20Mail','Portuguese','sendMail','$sale_product.bin','Raw\x20Materials','$product_details.batch_code','Arabic','bin','RMSEmail','3558400EIsUkh','/view/:id','name','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','aggregate','$product_details.maxPerUnit','French','get','<html><head><title></title>','</div>','secondary_unit','</td>','types','quantity','customer_data','$product_details','7522299YBRmwj','$product_details.product_code','$return_data','/barcode_scanner','findById','add\x20post','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','save','back','/view/add_sales/:id','/upload/','$warehouse_name','<tr>','sales\x20item\x20return\x20successfull','$sale_product.type','$sale_product','Enabled','Logo.png','$product_details.rack','return_qty','<h2>\x20','\x20Order\x20Date\x20:\x20','body','Sales\x20Add\x20successfully','padStart','all_sales','German','barcode\x20user_id','$product_details.pallet','prod_code','master','expiry_date','<strong>\x20Regards\x20</strong>','slice','$product_details.product_name','customers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','add_sales','sale_product','Sales\x20Update\x20successfully','$sale_product.floorlevel','getDate','edit_sales_view','requested_qty','</h5>','rack','../middleware/auth','RoomAssigned','False','$customer','batch_code','Ambient','product_details','secondary_code','image','customers_docs','$product_details.unit','sales_quantity','Hindi','random','$product.product_name','/view/return_sales/:id','flash','post','$product_details.bay','actual_uom','primary_code','$finalize','$product_details.storage','success','message','Enclosed','maxperunit','errors','bay','split','type','nodemailer','6184375osIZHl','actual_qty','$product_details.floorlevel','Received\x20Payment\x20For\x20Sale','$name','product_stock','language','max','/all_sales/view','storage','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<!DOCTYPE\x20html>','port','87JufLyb','$product_details.type','Arabic\x20(ae)','Chinese','</tbody>','all_sales_barcode','render','OUT-','<div>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','staff','$product_details.secondary_code','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','max_per_unit','return_sale','received_amount','stock_data','$date','customer','sales\x20all_data','$sale_product.quantity','$product_details.invoice','../models/all_models','params','unit','$room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.production_date','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','_id','production_date','error','</head><body>','prod_cat','There\x27s\x20a\x20error\x20in\x20this\x20transaction','invoice','gmail','email','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</table>','/view/add_sales','$product_details.product_cat','quantity_notConverted','log','findOne','/view','role','map','forEach','</span>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Return\x20Goods','<tbody\x20style=\x22text-align:\x20center;\x22>','/preview/:id','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$invoice','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.expiry_date','warehouse','</tr>','status','$product_details.bin','$product_details.secondary_unit','$sale_product.bay','warehouse_name','<hr\x20class=\x22my-3\x22>','json','$product_details.product_stock','createTransport','return_data','Portuguese\x20(BR)','string','currency','product_name','primary_unit','redirect','Spanish','<span\x20style=\x22float:\x20right;\x22>','English\x20(US)','$_id','6254692xRJKVQ','170739BvBkTx','id_transaction_from','English','length','product_data','then','purchases_data','70bFGwsx','delivery_date','Error\x20Occurs','date','user_id','toString','../public/language/languages.json','468516huwzlU','Level','concat','$product_details._id','filter','product_code','</thead>','<h5\x20style=\x22text-align:\x20left;\x22>','room_name','1882cZBRWa','getFullYear','$note','abs','id_transact','$customers_docs','$product','delivery_code','Receiving\x20Area','An\x20error\x20occurred.','/barcode/:id','</body></html>','$product_details.primary_code','floor','\x20</h2>','find','/give_payment/:id','host','level','foreach\x20newproduct','catch','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','stocks','10MzJQqw','SCRN','/all_sales/preview/','<h5>','due_amount','sale_qty'];a0_0x4483=function(){return _0xe02480;};return a0_0x4483();}router[a0_0x3cce07(0x1ef)](a0_0x3cce07(0x27f),auth,async(_0x12756f,_0x11840a)=>{var _0x4a39fe=a0_0x3cce07;try{const {username:_0x7b0fe8,email:_0xbd82e3,role:_0x2ba321}=_0x12756f[_0x4a39fe(0x1dc)],_0x1e5f72=_0x12756f['user'],_0x246e69=await profile[_0x4a39fe(0x283)]({'email':_0x1e5f72['email']}),_0x49129d=await master_shop['find'](),_0x43a4ae=await customer[_0x4a39fe(0x1c6)]({});let _0x128108;if(_0x1e5f72[_0x4a39fe(0x17b)]=='staff'){const _0x2d806a=await staff[_0x4a39fe(0x283)]({'email':_0x1e5f72['email']});_0x128108=await warehouse[_0x4a39fe(0x1ec)]([{'$match':{'status':'Enabled','name':_0x2d806a[_0x4a39fe(0x189)],'warehouse_category':_0x4a39fe(0x1e2),'name':{'$ne':_0x4a39fe(0x180)}}},{'$group':{'_id':_0x4a39fe(0x24c),'name':{'$first':_0x4a39fe(0x24c)}}},{'$sort':{'name':0x1}}]);}else _0x128108=await warehouse[_0x4a39fe(0x1ec)]([{'$match':{'status':_0x4a39fe(0x209),'warehouse_category':_0x4a39fe(0x1e2),'name':{'$ne':_0x4a39fe(0x180)}}},{'$group':{'_id':'$name','name':{'$first':_0x4a39fe(0x24c)}}},{'$sort':{'name':0x1}}]);const _0x3c2616=await product[_0x4a39fe(0x1c6)]({});var _0x11b437=['Ambient',_0x4a39fe(0x241)];const _0x4d9842=await sales[_0x4a39fe(0x1c6)]({}),_0x5ca280=_0x4d9842[_0x4a39fe(0x1a3)]+0x1,_0x56ad9b='OUT-'+_0x5ca280[_0x4a39fe(0x1ac)]()[_0x4a39fe(0x211)](0x5,'0');if(_0x49129d[0x0][_0x4a39fe(0x24e)]=='English\x20(US)'){var _0x5d61ff=users[_0x4a39fe(0x1a2)];console[_0x4a39fe(0x282)](_0x5d61ff);}else{if(_0x49129d[0x0][_0x4a39fe(0x24e)]==_0x4a39fe(0x234))var _0x5d61ff=users[_0x4a39fe(0x234)];else{if(_0x49129d[0x0][_0x4a39fe(0x24e)]==_0x4a39fe(0x213))var _0x5d61ff=users[_0x4a39fe(0x213)];else{if(_0x49129d[0x0][_0x4a39fe(0x24e)]==_0x4a39fe(0x19b))var _0x5d61ff=users[_0x4a39fe(0x19b)];else{if(_0x49129d[0x0][_0x4a39fe(0x24e)]=='French')var _0x5d61ff=users['French'];else{if(_0x49129d[0x0]['language']=='Portuguese\x20(BR)')var _0x5d61ff=users[_0x4a39fe(0x1df)];else{if(_0x49129d[0x0]['language']==_0x4a39fe(0x258))var _0x5d61ff=users[_0x4a39fe(0x258)];else{if(_0x49129d[0x0]['language']==_0x4a39fe(0x257))var _0x5d61ff=users[_0x4a39fe(0x1e4)];}}}}}}}const _0x5df5df=getRandom8DigitNumber();_0x5df5df[_0x4a39fe(0x1a5)](_0x2238d9=>{var _0xfec0d7=_0x4a39fe;_0x11840a[_0xfec0d7(0x25b)](_0xfec0d7(0x21f),{'success':_0x12756f[_0xfec0d7(0x238)](_0xfec0d7(0x23f)),'errors':_0x12756f[_0xfec0d7(0x238)](_0xfec0d7(0x243)),'role':_0x1e5f72,'profile':_0x246e69,'customer':_0x43a4ae,'warehouse':_0x128108,'product':_0x3c2616,'invoice':_0x2238d9,'master_shop':_0x49129d,'language':_0x5d61ff,'rooms_data':_0x11b437});})[_0x4a39fe(0x1cb)](_0x512734=>{var _0x5b5a6d=_0x4a39fe;_0x12756f[_0x5b5a6d(0x238)](_0x5b5a6d(0x243),_0x5b5a6d(0x279)),_0x11840a['redirect']('/all_sales/view');});}catch(_0x17a290){console[_0x4a39fe(0x282)](_0x17a290);}}),router[a0_0x3cce07(0x1ef)](a0_0x3cce07(0x202),auth,async(_0x5aa82a,_0x126017)=>{var _0x13974f=a0_0x3cce07;try{const _0x1fcef7=_0x5aa82a[_0x13974f(0x26d)]['id'];console[_0x13974f(0x282)](_0x1fcef7);const _0x2c41b1=await product[_0x13974f(0x1c6)](),_0x2cfc90=await purchases[_0x13974f(0x1ec)]([{'$match':{'warehouse_name':_0x1fcef7}},{'$unwind':_0x13974f(0x1bd)},{'$group':{'_id':_0x13974f(0x236)}}]);console['log'](_0x13974f(0x1a6),_0x2cfc90),_0x126017['status'](0xc8)['json']({'purchases_data':_0x2cfc90,'product_data':_0x2c41b1});}catch(_0x1dee92){console[_0x13974f(0x282)](_0x1dee92);}}),router[a0_0x3cce07(0x239)](a0_0x3cce07(0x1d5),auth,async(_0x249a8d,_0x18fbb5)=>{var _0x15a2a4=a0_0x3cce07;try{const {warehouse_data:_0x25bc34,product_data:_0x33cf6d}=_0x249a8d[_0x15a2a4(0x20f)];console[_0x15a2a4(0x282)](_0x249a8d[_0x15a2a4(0x20f)][_0x15a2a4(0x1a4)]);;const _0x21244b=await master_shop['find']();console[_0x15a2a4(0x282)](_0x15a2a4(0x217),_0x21244b);const _0x200e53=await product[_0x15a2a4(0x283)]({'name':_0x33cf6d});console[_0x15a2a4(0x282)]('product',_0x200e53);const _0x49fe46=await warehouse[_0x15a2a4(0x1ec)]([{'$match':{'name':_0x25bc34}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x33cf6d}},{'$group':{'_id':_0x15a2a4(0x21b),'product_stock':{'$first':_0x15a2a4(0x192)}}}]);console[_0x15a2a4(0x282)](_0x15a2a4(0x266),_0x49fe46),_0x18fbb5[_0x15a2a4(0x18b)](0xc8)[_0x15a2a4(0x191)]({'master':_0x21244b,'new_product':_0x200e53,'stock_data':_0x49fe46});}catch(_0x1c65f9){console['log'](_0x1c65f9);}}),router[a0_0x3cce07(0x239)](a0_0x3cce07(0x27f),auth,async(_0x538b03,_0x558146)=>{var _0x3c0b6e=a0_0x3cce07;try{const {invoice:_0x206ac4,date:_0x5abf18,warehouse_name:_0x44ae22,product_name:_0x1bc847,stock:_0x507bc5,quantity:_0x3bb641,note:_0x371fb4,room:_0x2ff3e6,primary_code:_0x2fab48,secondary_code:_0x4504f2,prod_code:_0x132d80,level:_0x5c723b,isle:_0x1c01e6,pallet:_0x11d870,batch_code:_0x1045ba,SCRN:_0x306b9e,expiry_date:_0x3f2dc2}=_0x538b03[_0x3c0b6e(0x20f)];if(typeof _0x1bc847==_0x3c0b6e(0x196))var _0x36a952=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x198)]],_0x981e1a=[_0x538b03['body'][_0x3c0b6e(0x261)]],_0x577fd9=[_0x538b03['body'][_0x3c0b6e(0x1d6)]],_0x8c0a1c=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x23c)]],_0x3c8540=[_0x538b03['body']['secondary_code']],_0x52e767=[_0x538b03[_0x3c0b6e(0x20f)]['prod_code']],_0x566ebd=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x1c9)]],_0xdd0800=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x199)]],_0x1199b0=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x1f2)]],_0x458403=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x22c)]],_0x50b44a=[_0x538b03[_0x3c0b6e(0x20f)]['expiry_date']],_0x4874b6=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x263)]],_0x49362b=[_0x538b03[_0x3c0b6e(0x20f)]['production_date']],_0x355ba1=[_0x538b03[_0x3c0b6e(0x20f)]['requested_qty']],_0x4ff29c=[_0x538b03[_0x3c0b6e(0x20f)]['delivery_date']],_0x123669=[_0x538b03[_0x3c0b6e(0x20f)]['delivery_code']],_0x138c01=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x278)]],_0x182a0c=[_0x538b03['body'][_0x3c0b6e(0x1f5)]],_0x122c86=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x229)]],_0x20671c=[_0x538b03[_0x3c0b6e(0x20f)]['prod_invoice']],_0x4d84d9=[_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x249)]],_0x822961=[_0x538b03['body'][_0x3c0b6e(0x23b)]],_0x237af5=[_0x538b03[_0x3c0b6e(0x20f)]['id_transact']];else var _0x36a952=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x198)]],_0x981e1a=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x261)]],_0x577fd9=[..._0x538b03['body'][_0x3c0b6e(0x1d6)]],_0x8c0a1c=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x23c)]],_0x3c8540=[..._0x538b03['body'][_0x3c0b6e(0x22f)]],_0x52e767=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x216)]],_0x566ebd=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x1c9)]],_0xdd0800=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x199)]],_0x1199b0=[..._0x538b03[_0x3c0b6e(0x20f)]['secondary_unit']],_0x458403=[..._0x538b03['body'][_0x3c0b6e(0x22c)]],_0x50b44a=[..._0x538b03[_0x3c0b6e(0x20f)]['expiry_date']],_0x4874b6=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x263)]],_0x49362b=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x275)]],_0x355ba1=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x225)]],_0x4ff29c=[..._0x538b03['body'][_0x3c0b6e(0x1a8)]],_0x123669=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x1be)]],_0x138c01=[..._0x538b03['body'][_0x3c0b6e(0x278)]],_0x182a0c=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x1f5)]],_0x122c86=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x229)]],_0x20671c=[..._0x538b03['body']['prod_invoice']],_0x4d84d9=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x249)]],_0x822961=[..._0x538b03[_0x3c0b6e(0x20f)]['actual_uom']],_0x237af5=[..._0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x1bb)]];const _0x25e464=_0x36a952[_0x3c0b6e(0x17c)](_0x1ffcaa=>{return _0x1ffcaa={'product_name':_0x1ffcaa};});_0x981e1a[_0x3c0b6e(0x17d)]((_0x5e3b8e,_0xaa364c)=>{var _0xb01507=_0x3c0b6e;_0x25e464[_0xaa364c][_0xb01507(0x261)]=Math['abs'](_0x5e3b8e);}),_0x4d84d9[_0x3c0b6e(0x17d)]((_0x4bc4b2,_0x466900)=>{var _0xabb56f=_0x3c0b6e;_0x25e464[_0x466900][_0xabb56f(0x249)]=Math[_0xabb56f(0x1ba)](_0x4bc4b2);}),_0x822961[_0x3c0b6e(0x17d)]((_0x4988e4,_0x5efb96)=>{_0x25e464[_0x5efb96]['actual_uom']=_0x4988e4;}),_0x237af5[_0x3c0b6e(0x17d)]((_0x2ba887,_0x293751)=>{var _0x3b44f9=_0x3c0b6e;_0x25e464[_0x293751][_0x3b44f9(0x1a1)]=_0x2ba887;}),_0x577fd9[_0x3c0b6e(0x17d)]((_0x1c3140,_0x411003)=>{var _0x385eb5=_0x3c0b6e;_0x25e464[_0x411003][_0x385eb5(0x1f5)]=_0x1c3140;}),_0x8c0a1c[_0x3c0b6e(0x17d)]((_0x54f5ed,_0x494ac9)=>{var _0x2a5992=_0x3c0b6e;_0x25e464[_0x494ac9][_0x2a5992(0x23c)]=_0x54f5ed;}),_0x3c8540[_0x3c0b6e(0x17d)]((_0x262b26,_0x42bd04)=>{_0x25e464[_0x42bd04]['secondary_code']=_0x262b26;}),_0x52e767[_0x3c0b6e(0x17d)]((_0x4537fd,_0x148c7f)=>{var _0x8f3126=_0x3c0b6e;_0x25e464[_0x148c7f][_0x8f3126(0x1b3)]=_0x4537fd;}),_0x566ebd['forEach']((_0x40496b,_0x2b8624)=>{var _0x5f25b6=_0x3c0b6e;_0x122c86[_0x5f25b6(0x17d)]((_0x448e5d,_0x238b9a)=>{var _0xda819f=_0x5f25b6;if(_0x448e5d==_0xda819f(0x1bf)&&_0x2b8624==_0x238b9a){var _0xdf5c4b=_0x40496b[_0xda819f(0x21a)](0x3);_0x25e464[_0x2b8624][_0xda819f(0x251)]=_0x40496b[0x0],_0x25e464[_0x2b8624]['rack']=_0x40496b[0x1],_0x25e464[_0x2b8624][_0xda819f(0x244)]=0x0,_0x25e464[_0x2b8624][_0xda819f(0x1e5)]=0x0,_0x25e464[_0x2b8624][_0xda819f(0x246)]='Floor',_0x25e464[_0x2b8624]['floorlevel']=_0xdf5c4b;}else{if(_0x448e5d=='Shelves'&&_0x2b8624==_0x238b9a){var _0xdf5c4b=_0x40496b['slice'](0x3);_0x25e464[_0x2b8624][_0xda819f(0x251)]=_0x40496b[0x0],_0x25e464[_0x2b8624][_0xda819f(0x227)]=_0x40496b[0x1],_0x25e464[_0x2b8624]['bay']=0x0,_0x25e464[_0x2b8624][_0xda819f(0x1e5)]=0x0,_0x25e464[_0x2b8624][_0xda819f(0x246)]='Floor',_0x25e464[_0x2b8624][_0xda819f(0x1db)]=_0x40496b[0x5];}else{if(_0x2b8624==_0x238b9a){var _0x44c9bd;if(_0x40496b[0x4]=='L')_0x44c9bd='Level';else _0x40496b[0x4]=='F'&&(_0x44c9bd=_0xda819f(0x1d7));_0x25e464[_0x2b8624][_0xda819f(0x251)]=_0x40496b[0x0],_0x25e464[_0x2b8624][_0xda819f(0x227)]=_0x40496b[0x1],_0x25e464[_0x2b8624][_0xda819f(0x244)]=_0x40496b[0x2],_0x25e464[_0x2b8624][_0xda819f(0x1e5)]=_0x40496b[0x3],_0x25e464[_0x2b8624][_0xda819f(0x246)]=_0x44c9bd,_0x25e464[_0x2b8624][_0xda819f(0x1db)]=_0x40496b[0x5];}}}});}),_0xdd0800[_0x3c0b6e(0x17d)]((_0x255ced,_0x10c548)=>{var _0x554f89=_0x3c0b6e;_0x25e464[_0x10c548][_0x554f89(0x26e)]=_0x255ced;}),_0x1199b0['forEach']((_0x1ef68a,_0x18dc90)=>{var _0x1fb28d=_0x3c0b6e;_0x25e464[_0x18dc90][_0x1fb28d(0x1f2)]=_0x1ef68a;}),_0x458403[_0x3c0b6e(0x17d)]((_0x40e9a3,_0x34d953)=>{var _0xbabb53=_0x3c0b6e;_0x25e464[_0x34d953][_0xbabb53(0x22c)]=_0x40e9a3;}),_0x50b44a[_0x3c0b6e(0x17d)]((_0x2e92f1,_0x5818a6)=>{var _0x2330ac=_0x3c0b6e;_0x25e464[_0x5818a6][_0x2330ac(0x218)]=_0x2e92f1;}),_0x4874b6[_0x3c0b6e(0x17d)]((_0x579e31,_0x5ce728)=>{_0x25e464[_0x5ce728]['maxperunit']=_0x579e31;}),_0x49362b[_0x3c0b6e(0x17d)]((_0x435320,_0x1f492f)=>{var _0x3783c7=_0x3c0b6e;_0x25e464[_0x1f492f][_0x3783c7(0x275)]=_0x435320;}),_0x355ba1['forEach']((_0x42e636,_0x52684d)=>{var _0x20d0dc=_0x3c0b6e;_0x25e464[_0x52684d][_0x20d0dc(0x225)]=_0x42e636;}),_0x4ff29c[_0x3c0b6e(0x17d)]((_0x23265a,_0xb098af)=>{var _0x4500ad=_0x3c0b6e;_0x25e464[_0xb098af][_0x4500ad(0x1a8)]=_0x23265a;}),_0x123669[_0x3c0b6e(0x17d)]((_0x195ac2,_0x103d46)=>{var _0x27d862=_0x3c0b6e;_0x25e464[_0x103d46][_0x27d862(0x1be)]=_0x195ac2;}),_0x138c01[_0x3c0b6e(0x17d)]((_0x52fa3d,_0x30f09a)=>{var _0x5b4c24=_0x3c0b6e;_0x25e464[_0x30f09a][_0x5b4c24(0x278)]=_0x52fa3d;}),_0x182a0c[_0x3c0b6e(0x17d)]((_0x36150f,_0x1331be)=>{var _0x3ce107=_0x3c0b6e;_0x25e464[_0x1331be][_0x3ce107(0x281)]=_0x36150f;}),_0x122c86[_0x3c0b6e(0x17d)]((_0x1b4824,_0x1d0834)=>{_0x25e464[_0x1d0834]['room_name']=_0x1b4824;}),_0x20671c[_0x3c0b6e(0x17d)]((_0x30b2d1,_0x191e3d)=>{var _0x4f9abc=_0x3c0b6e;_0x25e464[_0x191e3d][_0x4f9abc(0x27a)]=_0x30b2d1;});var _0x4f2914=0x0;_0x25e464[_0x3c0b6e(0x17d)](_0x56c602=>{var _0x585e50=_0x3c0b6e;(_0x56c602[_0x585e50(0x261)]<_0x56c602[_0x585e50(0x281)]||_0x56c602[_0x585e50(0x281)]==0x0)&&(console['log']('foreach\x20newproduct',_0x56c602),_0x4f2914++);});const _0x5031cd=_0x25e464[_0x3c0b6e(0x1b2)](_0xe7fa55=>_0xe7fa55[_0x3c0b6e(0x1f5)]!=='0'&&_0xe7fa55[_0x3c0b6e(0x1f5)]!==''),_0x3c1473=new sales({'invoice':_0x206ac4,'customer':_0x538b03[_0x3c0b6e(0x20f)][_0x3c0b6e(0x268)],'date':_0x5abf18,'warehouse_name':_0x44ae22,'sale_product':_0x5031cd,'note':_0x371fb4,'room':_0x2ff3e6,'primary_code':_0x2fab48,'secondary_code':_0x4504f2,'prod_code':_0x132d80,'SCRN':_0x306b9e}),_0xc69d00=await _0x3c1473[_0x3c0b6e(0x200)]();_0x538b03[_0x3c0b6e(0x238)](_0x3c0b6e(0x23f),_0x3c0b6e(0x210)),_0x558146[_0x3c0b6e(0x19a)]('/all_sales/preview/'+_0xc69d00[_0x3c0b6e(0x274)]);}catch(_0x2d6b4b){console['log'](_0x2d6b4b);}}),router[a0_0x3cce07(0x1ef)]('/preview/:id',auth,async(_0x53c7b5,_0x1a7414)=>{var _0xa0df19=a0_0x3cce07;try{const {username:_0xaecd75,email:_0x18cd2d,role:_0x11f088}=_0x53c7b5[_0xa0df19(0x1dc)],_0x15f39d=_0x53c7b5[_0xa0df19(0x1dc)],_0x2dfd70=await profile[_0xa0df19(0x283)]({'email':_0x15f39d[_0xa0df19(0x27c)]}),_0x2b1e1c=await master_shop[_0xa0df19(0x1c6)](),_0x362d26=_0x53c7b5[_0xa0df19(0x26d)]['id'],_0x250ef7=await sales[_0xa0df19(0x1fc)](_0x362d26),_0x1c41c3=await warehouse[_0xa0df19(0x1ec)]([{'$match':{'name':_0x250ef7[_0xa0df19(0x18f)]}},{'$unwind':_0xa0df19(0x1f7)},{'$group':{'_id':_0xa0df19(0x1b1),'name':{'$first':_0xa0df19(0x21b)},'product_stock':{'$first':_0xa0df19(0x192)},'bay':{'$first':_0xa0df19(0x23a)},'bin':{'$first':_0xa0df19(0x18c)},'type':{'$first':_0xa0df19(0x256)},'floorlevel':{'$first':_0xa0df19(0x24a)},'primary_code':{'$first':_0xa0df19(0x1c3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xa0df19(0x1f9)},'storage':{'$first':_0xa0df19(0x23e)},'rack':{'$first':_0xa0df19(0x20b)},'expiry_date':{'$first':_0xa0df19(0x188)},'production_date':{'$first':_0xa0df19(0x271)},'invoice':{'$first':_0xa0df19(0x26b)}}}]),_0xc6967e=await customer[_0xa0df19(0x1c6)]({});let _0x5434fb;if(_0x15f39d['role']==_0xa0df19(0x25f)){const _0x11fc57=await staff['findOne']({'email':_0x15f39d['email']});_0x5434fb=await warehouse[_0xa0df19(0x1ec)]([{'$match':{'status':_0xa0df19(0x209),'name':_0x11fc57['warehouse']}},{'$group':{'_id':_0xa0df19(0x24c),'name':{'$first':_0xa0df19(0x24c)}}}]);}else _0x5434fb=await warehouse[_0xa0df19(0x1ec)]([{'$match':{'status':_0xa0df19(0x209)}},{'$group':{'_id':_0xa0df19(0x24c),'name':{'$first':_0xa0df19(0x24c)}}}]);const _0x1796cd=await product[_0xa0df19(0x1c6)]({}),_0x3dc6ae=await suppliers[_0xa0df19(0x1c6)]({});if(_0x2b1e1c[0x0][_0xa0df19(0x24e)]==_0xa0df19(0x19d)){var _0x3bf32c=users[_0xa0df19(0x1a2)];console[_0xa0df19(0x282)](_0x3bf32c);}else{if(_0x2b1e1c[0x0][_0xa0df19(0x24e)]=='Hindi')var _0x3bf32c=users['Hindi'];else{if(_0x2b1e1c[0x0]['language']==_0xa0df19(0x213))var _0x3bf32c=users[_0xa0df19(0x213)];else{if(_0x2b1e1c[0x0]['language']==_0xa0df19(0x19b))var _0x3bf32c=users[_0xa0df19(0x19b)];else{if(_0x2b1e1c[0x0][_0xa0df19(0x24e)]=='French')var _0x3bf32c=users[_0xa0df19(0x1ee)];else{if(_0x2b1e1c[0x0][_0xa0df19(0x24e)]=='Portuguese\x20(BR)')var _0x3bf32c=users[_0xa0df19(0x1df)];else{if(_0x2b1e1c[0x0][_0xa0df19(0x24e)]==_0xa0df19(0x258))var _0x3bf32c=users[_0xa0df19(0x258)];else{if(_0x2b1e1c[0x0][_0xa0df19(0x24e)]==_0xa0df19(0x257))var _0x3bf32c=users[_0xa0df19(0x1e4)];}}}}}}}_0x1a7414[_0xa0df19(0x25b)](_0xa0df19(0x224),{'success':_0x53c7b5[_0xa0df19(0x238)]('success'),'errors':_0x53c7b5['flash']('errors'),'role':_0x15f39d,'profile':_0x2dfd70,'customer':_0xc6967e,'warehouse':_0x5434fb,'product':_0x1c41c3,'user':_0x250ef7,'master_shop':_0x2b1e1c,'unit':_0x1796cd,'language':_0x3bf32c,'suppliers':_0x3dc6ae});}catch(_0x3287b2){console[_0xa0df19(0x282)](_0x3287b2);}}),router['post'](a0_0x3cce07(0x182),auth,async(_0x2133fe,_0x7a1ff5)=>{var _0xc34459=a0_0x3cce07;try{const _0x16d933=_0x2133fe['params']['id'],{invoice:_0x42a0cb,warehouse_name:_0x359b32,room:_0x5ef8c4}=_0x2133fe[_0xc34459(0x20f)],_0x4b5a70=await sales[_0xc34459(0x283)]({'invoice':_0x42a0cb}),_0x36d5eb=_0x4b5a70[_0xc34459(0x220)]['map'](async _0x10c581=>{var _0x2e21dd=_0xc34459,_0xe1b299=await warehouse[_0x2e21dd(0x283)]({'name':_0x359b32,'room':_0x10c581[_0x2e21dd(0x1b6)],'warehouse_category':_0x2e21dd(0x1e2)});const _0x25bc2e=_0xe1b299[_0x2e21dd(0x22e)][_0x2e21dd(0x17c)](_0x46abd3=>{var _0x9c3e78=_0x2e21dd;_0x46abd3['product_name']==_0x10c581[_0x9c3e78(0x198)]&&_0x46abd3[_0x9c3e78(0x1db)]==_0x10c581['floorlevel']&&_0x46abd3[_0x9c3e78(0x246)]==_0x10c581[_0x9c3e78(0x246)]&&_0x46abd3[_0x9c3e78(0x1e5)]==_0x10c581[_0x9c3e78(0x1e5)]&&_0x46abd3[_0x9c3e78(0x244)]==_0x10c581[_0x9c3e78(0x244)]&&_0x46abd3[_0x9c3e78(0x227)]==_0x10c581['rack']&&_0x46abd3[_0x9c3e78(0x251)]==_0x10c581['storage']&&_0x46abd3[_0x9c3e78(0x218)]==_0x10c581[_0x9c3e78(0x218)]&&_0x46abd3[_0x9c3e78(0x22c)]==_0x10c581[_0x9c3e78(0x22c)]&&_0x46abd3[_0x9c3e78(0x27a)]==_0x10c581['invoice']&&_0x46abd3[_0x9c3e78(0x274)]==_0x10c581[_0x9c3e78(0x1a1)]&&(_0x46abd3[_0x9c3e78(0x24d)]=Math[_0x9c3e78(0x24f)](0x0,Math[_0x9c3e78(0x1ba)](_0x46abd3[_0x9c3e78(0x24d)])-Math[_0x9c3e78(0x1ba)](_0x10c581[_0x9c3e78(0x1f5)])));});return _0xe1b299;});Promise[_0xc34459(0x272)](_0x36d5eb)[_0xc34459(0x1a5)](async _0x46c88d=>{var _0x3ce184=_0xc34459;try{for(const _0x59175f of _0x46c88d){await _0x59175f[_0x3ce184(0x200)]();}_0x4b5a70['finalize']='True';const _0x2c6eb5=await _0x4b5a70[_0x3ce184(0x200)](),_0x472f6b=await master_shop[_0x3ce184(0x1c6)](),_0x2fb6b4=await email_settings[_0x3ce184(0x283)](),_0x1e1e78=await supervisor_settings['find']();var _0x2016fa=_0x4b5a70['sale_product'],_0x446bfa='',_0x565e7c;for(_0x565e7c in _0x2016fa){_0x446bfa+=_0x3ce184(0x205)+_0x3ce184(0x27d)+_0x2016fa[_0x565e7c]['product_name']+_0x3ce184(0x1f3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2016fa[_0x565e7c][_0x3ce184(0x1b3)]+_0x3ce184(0x1f3)+_0x3ce184(0x27d)+_0x2016fa[_0x565e7c][_0x3ce184(0x1f5)]+_0x3ce184(0x1f3)+_0x3ce184(0x27d)+_0x2016fa[_0x565e7c]['unit']+_0x3ce184(0x1f3)+_0x3ce184(0x27d)+_0x2016fa[_0x565e7c][_0x3ce184(0x1f2)]+_0x3ce184(0x1f3)+_0x3ce184(0x27d)+_0x4b5a70[_0x3ce184(0x18f)]+_0x3ce184(0x1f3)+_0x3ce184(0x27d)+_0x2016fa[_0x565e7c][_0x3ce184(0x1b6)]+_0x3ce184(0x1f3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2016fa[_0x565e7c]['storage']+_0x2016fa[_0x565e7c][_0x3ce184(0x227)]+_0x2016fa[_0x565e7c][_0x3ce184(0x244)]+_0x2016fa[_0x565e7c][_0x3ce184(0x1e5)]+_0x2016fa[_0x565e7c][_0x3ce184(0x246)][0x0]+_0x2016fa[_0x565e7c]['floorlevel']+_0x3ce184(0x1f3),_0x3ce184(0x18a);}let _0x4f4e77=nodemailer[_0x3ce184(0x193)]({'host':_0x2fb6b4[_0x3ce184(0x1c8)],'port':Number(_0x2fb6b4[_0x3ce184(0x254)]),'secure':![],'auth':{'user':_0x2fb6b4['email'],'pass':_0x2fb6b4['password']}}),_0x50a893={'from':_0x2fb6b4[_0x3ce184(0x27c)],'to':_0x1e1e78[0x0][_0x3ce184(0x1e6)],'subject':'Sales\x20Mail','attachments':[{'filename':_0x3ce184(0x20a),'path':__dirname+_0x3ce184(0x1d8)+_0x3ce184(0x203)+_0x472f6b[0x0][_0x3ce184(0x230)],'cid':'logo'}],'html':_0x3ce184(0x253)+_0x3ce184(0x1f0)+'</head><body>'+'<div>'+_0x3ce184(0x252)+_0x3ce184(0x25d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3ce184(0x1f1)+_0x3ce184(0x25d)+'<h2>\x20'+_0x472f6b[0x0][_0x3ce184(0x183)]+_0x3ce184(0x1c5)+_0x3ce184(0x1f1)+_0x3ce184(0x1f1)+_0x3ce184(0x190)+_0x3ce184(0x25d)+_0x3ce184(0x1b5)+_0x3ce184(0x1d9)+_0x4b5a70[_0x3ce184(0x27a)]+'\x20'+_0x3ce184(0x19c)+'\x20Order\x20Date\x20:\x20'+_0x4b5a70['date']+'\x20'+_0x3ce184(0x17e)+'</h5>'+_0x3ce184(0x1f1)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3ce184(0x205)+_0x3ce184(0x1ff)+_0x3ce184(0x270)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x3ce184(0x184)+_0x3ce184(0x262)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x3ce184(0x187)+_0x3ce184(0x273)+_0x3ce184(0x18a)+_0x3ce184(0x1b4)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x446bfa+'\x20'+_0x3ce184(0x259)+_0x3ce184(0x27e)+_0x3ce184(0x25d)+'<strong>\x20Regards\x20</strong>'+_0x3ce184(0x1d1)+_0x472f6b[0x0][_0x3ce184(0x183)]+'</h5>'+'</div>'+_0x3ce184(0x1f1)+_0x3ce184(0x1c2)};_0x4f4e77[_0x3ce184(0x1e0)](_0x50a893,function(_0x47907b,_0x1406fa){var _0x2763da=_0x3ce184;_0x47907b?(console[_0x2763da(0x282)](_0x47907b),console[_0x2763da(0x282)]('Error\x20Occurs')):console[_0x2763da(0x282)](_0x2763da(0x1dd));}),_0x2133fe['flash'](_0x3ce184(0x23f),_0x3ce184(0x221)),_0x7a1ff5[_0x3ce184(0x19a)](_0x3ce184(0x1d0)+_0x16d933);}catch(_0x3e5b3c){console[_0x3ce184(0x276)](_0x3e5b3c),_0x7a1ff5['status'](0x1f4)[_0x3ce184(0x191)]({'error':_0x3ce184(0x21e)});}})['catch'](_0x1d9367=>{var _0x54741b=_0xc34459;console['error'](_0x1d9367),_0x7a1ff5[_0x54741b(0x18b)](0x1f4)[_0x54741b(0x191)]({'error':_0x54741b(0x1c0)});});}catch(_0x1d7753){console[_0xc34459(0x282)](_0x1d7753);}}),router[a0_0x3cce07(0x1ef)](a0_0x3cce07(0x1e8),auth,async(_0xcc8278,_0x16e37d)=>{var _0x18b675=a0_0x3cce07;try{const {username:_0x23ff7a,email:_0x307b98,role:_0x595298}=_0xcc8278['user'],_0x20abd4=_0xcc8278[_0x18b675(0x1dc)],_0x4f91dc=await profile[_0x18b675(0x283)]({'email':_0x20abd4[_0x18b675(0x27c)]}),_0x14d969=await master_shop[_0x18b675(0x1c6)](),_0x524602=_0xcc8278[_0x18b675(0x26d)]['id'],_0x23ac2e=await sales[_0x18b675(0x1fc)](_0x524602);var _0x5da8ab=[_0x18b675(0x22d),_0x18b675(0x241)];const _0x568e6e=await warehouse[_0x18b675(0x1ec)]([{'$match':{'name':_0x23ac2e[_0x18b675(0x18f)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x18b675(0x1f7)},{'$group':{'_id':_0x18b675(0x1b1),'name':{'$first':_0x18b675(0x21b)},'product_stock':{'$first':_0x18b675(0x192)},'bay':{'$first':_0x18b675(0x23a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x18b675(0x256)},'floorlevel':{'$first':_0x18b675(0x24a)},'primary_code':{'$first':_0x18b675(0x1c3)},'secondary_code':{'$first':_0x18b675(0x260)},'product_code':{'$first':_0x18b675(0x1f9)},'storage':{'$first':_0x18b675(0x23e)},'rack':{'$first':'$product_details.rack'}}}]),_0x48170f=await customer[_0x18b675(0x1c6)]({});let _0x4590ab;if(_0x20abd4[_0x18b675(0x17b)]==_0x18b675(0x25f)){const _0x23f89b=await staff[_0x18b675(0x283)]({'email':_0x20abd4[_0x18b675(0x27c)]});_0x4590ab=await warehouse[_0x18b675(0x1ec)]([{'$match':{'status':_0x18b675(0x209),'name':_0x23f89b['warehouse'],'warehouse_category':_0x18b675(0x1e2)}},{'$group':{'_id':_0x18b675(0x24c),'name':{'$first':_0x18b675(0x24c)}}}]);}else _0x4590ab=await warehouse[_0x18b675(0x1ec)]([{'$match':{'status':_0x18b675(0x209),'warehouse_category':_0x18b675(0x1e2)}},{'$group':{'_id':_0x18b675(0x24c),'name':{'$first':'$name'}}}]);const _0x4b5463=await product[_0x18b675(0x1c6)]({});if(_0x14d969[0x0][_0x18b675(0x24e)]==_0x18b675(0x19d)){var _0x308430=users['English'];console['log'](_0x308430);}else{if(_0x14d969[0x0][_0x18b675(0x24e)]=='Hindi')var _0x308430=users[_0x18b675(0x234)];else{if(_0x14d969[0x0][_0x18b675(0x24e)]==_0x18b675(0x213))var _0x308430=users[_0x18b675(0x213)];else{if(_0x14d969[0x0][_0x18b675(0x24e)]==_0x18b675(0x19b))var _0x308430=users['Spanish'];else{if(_0x14d969[0x0][_0x18b675(0x24e)]==_0x18b675(0x1ee))var _0x308430=users[_0x18b675(0x1ee)];else{if(_0x14d969[0x0][_0x18b675(0x24e)]=='Portuguese\x20(BR)')var _0x308430=users['Portuguese'];else{if(_0x14d969[0x0][_0x18b675(0x24e)]==_0x18b675(0x258))var _0x308430=users['Chinese'];else{if(_0x14d969[0x0][_0x18b675(0x24e)]=='Arabic\x20(ae)')var _0x308430=users[_0x18b675(0x1e4)];}}}}}}}_0x16e37d[_0x18b675(0x25b)]('edit_sales',{'success':_0xcc8278[_0x18b675(0x238)]('success'),'errors':_0xcc8278[_0x18b675(0x238)](_0x18b675(0x243)),'role':_0x20abd4,'profile':_0x4f91dc,'customer':_0x48170f,'warehouse':_0x4590ab,'product':_0x568e6e,'user':_0x23ac2e,'master_shop':_0x14d969,'unit':_0x4b5463,'language':_0x308430});}catch(_0xec8a5e){console['log'](_0xec8a5e);}}),router[a0_0x3cce07(0x239)](a0_0x3cce07(0x1e8),auth,async(_0x3b1355,_0x27c5f2)=>{var _0x2630b6=a0_0x3cce07;try{const _0x406da8=_0x3b1355[_0x2630b6(0x26d)]['id'],_0x13f220=await sales[_0x2630b6(0x283)]({'_id':_0x3b1355[_0x2630b6(0x26d)]['id']}),_0x237f85=await warehouse['findOne']({'name':_0x13f220[_0x2630b6(0x18f)],'room':_0x3b1355['body']['room']}),{invoice:_0x49d612,date:_0x397975,warehouse_name:_0x5deade,product_name:_0x29b4f7,stock:_0x425633,quantity:_0x305834,note:_0xdfd713,room:_0x1bdf7e,customer:_0x426307,SCRN:_0x47388a}=_0x3b1355[_0x2630b6(0x20f)];if(typeof _0x29b4f7==_0x2630b6(0x196))var _0x541175=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x198)]],_0x2bdde1=[_0x3b1355['body']['stock']],_0x49c979=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x1d6)]],_0x41f166=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x23c)]],_0x5ca2c3=[_0x3b1355['body'][_0x2630b6(0x22f)]],_0x269d6e=[_0x3b1355[_0x2630b6(0x20f)]['prod_code']],_0x42c7e6=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x1c9)]],_0x381a27=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x199)]],_0x51ae62=[_0x3b1355['body']['secondary_unit']],_0x45cd4b=[_0x3b1355[_0x2630b6(0x20f)]['batch_code']],_0x576e83=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x218)]],_0x2ead01=[_0x3b1355['body'][_0x2630b6(0x263)]],_0x4cd425=[_0x3b1355['body'][_0x2630b6(0x275)]],_0x3bac87=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x225)]],_0x5482b2=[_0x3b1355['body'][_0x2630b6(0x1a8)]],_0x67d6a1=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x1be)]],_0x2229b7=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x278)]],_0x110831=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x1f5)]],_0x19a665=[_0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x229)]];else var _0x541175=[..._0x3b1355[_0x2630b6(0x20f)]['product_name']],_0x2bdde1=[..._0x3b1355[_0x2630b6(0x20f)]['stock']],_0x49c979=[..._0x3b1355[_0x2630b6(0x20f)]['carton']],_0x41f166=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x23c)]],_0x5ca2c3=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x22f)]],_0x269d6e=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x216)]],_0x42c7e6=[..._0x3b1355['body']['level']],_0x381a27=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x199)]],_0x51ae62=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x1f2)]],_0x45cd4b=[..._0x3b1355['body'][_0x2630b6(0x22c)]],_0x576e83=[..._0x3b1355[_0x2630b6(0x20f)]['expiry_date']],_0x2ead01=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x263)]],_0x4cd425=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x275)]],_0x3bac87=[..._0x3b1355[_0x2630b6(0x20f)]['requested_qty']],_0x5482b2=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x1a8)]],_0x67d6a1=[..._0x3b1355[_0x2630b6(0x20f)]['delivery_code']],_0x2229b7=[..._0x3b1355[_0x2630b6(0x20f)]['prod_cat']],_0x110831=[..._0x3b1355[_0x2630b6(0x20f)]['quantity']],_0x19a665=[..._0x3b1355[_0x2630b6(0x20f)][_0x2630b6(0x229)]];const _0x564bda=_0x541175[_0x2630b6(0x17c)](_0x1886da=>{return _0x1886da={'product_name':_0x1886da};});_0x2bdde1['forEach']((_0x3be122,_0x32479d)=>{var _0x4bf54d=_0x2630b6;_0x564bda[_0x32479d][_0x4bf54d(0x261)]=Math[_0x4bf54d(0x1ba)](_0x3be122);}),_0x49c979[_0x2630b6(0x17d)]((_0x1bdf47,_0x50a0c8)=>{var _0x1e8917=_0x2630b6;_0x564bda[_0x50a0c8][_0x1e8917(0x1f5)]=_0x1bdf47;}),_0x41f166['forEach']((_0x261e93,_0x18cbdf)=>{var _0x3ecfd4=_0x2630b6;_0x564bda[_0x18cbdf][_0x3ecfd4(0x23c)]=_0x261e93;}),_0x5ca2c3['forEach']((_0x37d9ac,_0x5cc042)=>{var _0x2a2e8b=_0x2630b6;_0x564bda[_0x5cc042][_0x2a2e8b(0x22f)]=_0x37d9ac;}),_0x269d6e[_0x2630b6(0x17d)]((_0x3f377a,_0x106d63)=>{var _0x23bb83=_0x2630b6;_0x564bda[_0x106d63][_0x23bb83(0x1b3)]=_0x3f377a;}),_0x42c7e6['forEach']((_0xf0d5d9,_0x56f409)=>{var _0x4599cf=_0x2630b6;_0x19a665[_0x4599cf(0x17d)]((_0x418f48,_0x48ba15)=>{var _0x1c0c7f=_0x4599cf;if(_0x418f48=='Receiving\x20Area'&&_0x56f409==_0x48ba15){var _0x339a85=_0xf0d5d9['slice'](0x3);_0x564bda[_0x56f409][_0x1c0c7f(0x251)]=_0xf0d5d9[0x0],_0x564bda[_0x56f409][_0x1c0c7f(0x227)]=_0xf0d5d9[0x1],_0x564bda[_0x56f409][_0x1c0c7f(0x244)]=0x0,_0x564bda[_0x56f409][_0x1c0c7f(0x1e5)]=0x0,_0x564bda[_0x56f409][_0x1c0c7f(0x246)]='Floor',_0x564bda[_0x56f409][_0x1c0c7f(0x1db)]=_0x339a85;}else{if(_0x418f48=='Shelves'&&_0x56f409==_0x48ba15){var _0x339a85=_0xf0d5d9['slice'](0x3);_0x564bda[_0x56f409]['storage']=_0xf0d5d9[0x0],_0x564bda[_0x56f409][_0x1c0c7f(0x227)]=_0xf0d5d9[0x1],_0x564bda[_0x56f409][_0x1c0c7f(0x244)]=0x0,_0x564bda[_0x56f409][_0x1c0c7f(0x1e5)]=0x0,_0x564bda[_0x56f409]['type']=_0x1c0c7f(0x1d7),_0x564bda[_0x56f409]['floorlevel']=_0xf0d5d9[0x5];}else{if(_0x56f409==_0x48ba15){var _0xcde7bf;if(_0xf0d5d9[0x4]=='L')_0xcde7bf=_0x1c0c7f(0x1af);else _0xf0d5d9[0x4]=='F'&&(_0xcde7bf='Floor');_0x564bda[_0x56f409]['storage']=_0xf0d5d9[0x0],_0x564bda[_0x56f409][_0x1c0c7f(0x227)]=_0xf0d5d9[0x1],_0x564bda[_0x56f409][_0x1c0c7f(0x244)]=_0xf0d5d9[0x2],_0x564bda[_0x56f409][_0x1c0c7f(0x1e5)]=_0xf0d5d9[0x3],_0x564bda[_0x56f409]['type']=_0xcde7bf,_0x564bda[_0x56f409]['floorlevel']=_0xf0d5d9[0x5];}}}});}),_0x381a27[_0x2630b6(0x17d)]((_0x5ad727,_0x30530c)=>{var _0x564e14=_0x2630b6;_0x564bda[_0x30530c][_0x564e14(0x26e)]=_0x5ad727;}),_0x51ae62[_0x2630b6(0x17d)]((_0xb8c89b,_0x32c1ac)=>{var _0x8cb916=_0x2630b6;_0x564bda[_0x32c1ac][_0x8cb916(0x1f2)]=_0xb8c89b;}),_0x45cd4b[_0x2630b6(0x17d)]((_0x3a9a56,_0x4827e4)=>{var _0x4303ef=_0x2630b6;_0x564bda[_0x4827e4][_0x4303ef(0x22c)]=_0x3a9a56;}),_0x576e83[_0x2630b6(0x17d)]((_0x27b971,_0x3d79cb)=>{_0x564bda[_0x3d79cb]['expiry_date']=_0x27b971;}),_0x2ead01['forEach']((_0x4b6277,_0x209588)=>{var _0x17b025=_0x2630b6;_0x564bda[_0x209588][_0x17b025(0x242)]=_0x4b6277;}),_0x4cd425['forEach']((_0x7f7697,_0x3a682b)=>{var _0x232148=_0x2630b6;_0x564bda[_0x3a682b][_0x232148(0x275)]=_0x7f7697;}),_0x3bac87[_0x2630b6(0x17d)]((_0x28fd91,_0x584427)=>{var _0x209ea0=_0x2630b6;_0x564bda[_0x584427][_0x209ea0(0x225)]=Math[_0x209ea0(0x1ba)](_0x28fd91);}),_0x5482b2['forEach']((_0x202621,_0x46bc9e)=>{_0x564bda[_0x46bc9e]['delivery_date']=_0x202621;}),_0x67d6a1[_0x2630b6(0x17d)]((_0x453804,_0x78493b)=>{_0x564bda[_0x78493b]['delivery_code']=_0x453804;}),_0x2229b7[_0x2630b6(0x17d)]((_0x441651,_0x4414e5)=>{var _0x1ba048=_0x2630b6;_0x564bda[_0x4414e5][_0x1ba048(0x278)]=_0x441651;}),_0x110831[_0x2630b6(0x17d)]((_0x1da362,_0x246a33)=>{_0x564bda[_0x246a33]['quantity_notConverted']=_0x1da362;}),_0x19a665['forEach']((_0x5bd3bd,_0x4c87b0)=>{var _0x4ef7fb=_0x2630b6;_0x564bda[_0x4c87b0][_0x4ef7fb(0x1b6)]=_0x5bd3bd;});var _0x46dc7f=0x0;_0x564bda[_0x2630b6(0x17d)](_0x5d04ec=>{var _0x56bd2a=_0x2630b6;console['log'](_0x56bd2a(0x1ca),_0x5d04ec),(parseInt(_0x5d04ec[_0x56bd2a(0x261)])<parseInt(_0x5d04ec[_0x56bd2a(0x1f5)])||parseInt(_0x5d04ec['quantity'])==0x0)&&_0x46dc7f++;});if(_0x46dc7f!=0x0)return _0x3b1355['flash'](_0x2630b6(0x243),_0x2630b6(0x17f)),_0x27c5f2[_0x2630b6(0x19a)]('back');const _0x1b9b8c=_0x564bda[_0x2630b6(0x1b2)](_0x1fdba1=>_0x1fdba1[_0x2630b6(0x1f5)]!=='0'&&_0x1fdba1[_0x2630b6(0x1f5)]!=='');_0x13f220[_0x2630b6(0x27a)]=_0x49d612,_0x13f220[_0x2630b6(0x268)]=_0x426307,_0x13f220[_0x2630b6(0x1aa)]=_0x397975,_0x13f220[_0x2630b6(0x18f)]=_0x5deade,_0x13f220[_0x2630b6(0x220)]=_0x1b9b8c,_0x13f220['note']=_0xdfd713,_0x13f220[_0x2630b6(0x1cf)]=_0x47388a,_0x13f220['finalize']=_0x2630b6(0x22a),_0x13f220['isAllowEdit']=_0x2630b6(0x22a);const _0x49da42=await _0x13f220[_0x2630b6(0x200)]();_0x3b1355[_0x2630b6(0x238)](_0x2630b6(0x23f),_0x2630b6(0x221)),_0x27c5f2[_0x2630b6(0x19a)](_0x2630b6(0x250));}catch(_0x5dfd7a){console[_0x2630b6(0x282)](_0x5dfd7a);}}),router[a0_0x3cce07(0x239)](a0_0x3cce07(0x1c7),auth,async(_0x347217,_0x2e9e73)=>{var _0x5eb100=a0_0x3cce07;try{const _0x1f3cd4=_0x347217[_0x5eb100(0x26d)]['id'],{invoice:_0x17a441,customer:_0x4af086,receivable_amount:_0x21e671,received_amount:_0x3b5389}=_0x347217['body'],_0x34474e=await sales[_0x5eb100(0x1fc)](_0x1f3cd4);console[_0x5eb100(0x282)](_0x34474e);var _0x11a5d0=_0x21e671-_0x3b5389;console[_0x5eb100(0x282)](_0x3b5389),_0x34474e[_0x5eb100(0x265)]=parseFloat(_0x3b5389)+parseFloat(_0x34474e['received_amount']),_0x34474e[_0x5eb100(0x1d2)]=_0x11a5d0,console['log'](_0x34474e);const _0x4c680c=await _0x34474e['save'](),_0xce704e=await c_payment_data[_0x5eb100(0x283)]({'invoice':_0x17a441});_0xce704e[_0x5eb100(0x1ea)]=_0x11a5d0,await _0xce704e[_0x5eb100(0x200)]();let _0x9d3fd1=new Date(),_0x3fc86a=('0'+_0x9d3fd1[_0x5eb100(0x223)]())[_0x5eb100(0x21a)](-0x2),_0x9f243f=('0'+(_0x9d3fd1['getMonth']()+0x1))[_0x5eb100(0x21a)](-0x2),_0xb282b=_0x9d3fd1[_0x5eb100(0x1b8)](),_0x1f8e73=_0xb282b+'-'+_0x9f243f+'-'+_0x3fc86a;const _0x6ba061=new customer_payment({'invoice':_0x17a441,'date':_0xb282b+'-'+_0x9f243f+'-'+_0x3fc86a,'customer':_0x4af086,'reason':_0x5eb100(0x24b),'amount':_0x3b5389}),_0x1ca339=await _0x6ba061['save']();_0x347217[_0x5eb100(0x238)]('success','payment\x20successfull'),_0x2e9e73[_0x5eb100(0x19a)]('/all_sales/view');}catch(_0x3aa4ba){console['log'](_0x3aa4ba);}}),router[a0_0x3cce07(0x1ef)]('/invoice/:id',auth,async(_0x4d0f40,_0x5f23a4)=>{var _0xe2dc8d=a0_0x3cce07;try{const {username:_0x26ea6a,email:_0xf13d31,role:_0x1041f5}=_0x4d0f40[_0xe2dc8d(0x1dc)],_0x111b53=_0x4d0f40['user'],_0x4605f7=await profile[_0xe2dc8d(0x283)]({'email':_0x111b53[_0xe2dc8d(0x27c)]}),_0x50892d=await master_shop[_0xe2dc8d(0x1c6)]();console[_0xe2dc8d(0x282)](_0xe2dc8d(0x217),_0x50892d);const _0x508bca=_0x4d0f40['params']['id'],_0x3d3685=await sales[_0xe2dc8d(0x1fc)](_0x508bca);console[_0xe2dc8d(0x282)](_0x3d3685);const _0x4db31c=await customer[_0xe2dc8d(0x283)]({'name':_0x3d3685[_0xe2dc8d(0x268)]});console[_0xe2dc8d(0x282)](_0x4db31c);if(_0x50892d[0x0][_0xe2dc8d(0x24e)]=='English\x20(US)'){var _0x58c090=users['English'];console[_0xe2dc8d(0x282)](_0x58c090);}else{if(_0x50892d[0x0][_0xe2dc8d(0x24e)]==_0xe2dc8d(0x234))var _0x58c090=users[_0xe2dc8d(0x234)];else{if(_0x50892d[0x0][_0xe2dc8d(0x24e)]==_0xe2dc8d(0x213))var _0x58c090=users['German'];else{if(_0x50892d[0x0][_0xe2dc8d(0x24e)]==_0xe2dc8d(0x19b))var _0x58c090=users['Spanish'];else{if(_0x50892d[0x0][_0xe2dc8d(0x24e)]==_0xe2dc8d(0x1ee))var _0x58c090=users[_0xe2dc8d(0x1ee)];else{if(_0x50892d[0x0][_0xe2dc8d(0x24e)]==_0xe2dc8d(0x195))var _0x58c090=users['Portuguese'];else{if(_0x50892d[0x0]['language']=='Chinese')var _0x58c090=users[_0xe2dc8d(0x258)];else{if(_0x50892d[0x0]['language']==_0xe2dc8d(0x257))var _0x58c090=users[_0xe2dc8d(0x1e4)];}}}}}}}_0x5f23a4[_0xe2dc8d(0x25b)]('sales_invoice',{'success':_0x4d0f40[_0xe2dc8d(0x238)](_0xe2dc8d(0x23f)),'errors':_0x4d0f40['flash']('errors'),'role':_0x111b53,'profile':_0x4605f7,'master_shop':_0x50892d,'customers':_0x4db31c,'sales':_0x3d3685,'language':_0x58c090});}catch(_0x2996c5){console['log'](_0x2996c5);}}),router['get'](a0_0x3cce07(0x237),auth,async(_0x317840,_0x9d8d30)=>{var _0x7bf667=a0_0x3cce07;try{const {username:_0x5889a7,email:_0x495380,role:_0x44e70a}=_0x317840[_0x7bf667(0x1dc)],_0xdd8473=_0x317840[_0x7bf667(0x1dc)],_0x5ace0e=await profile[_0x7bf667(0x283)]({'email':_0xdd8473[_0x7bf667(0x27c)]}),_0x2721c1=await master_shop[_0x7bf667(0x1c6)]();console[_0x7bf667(0x282)]('master',_0x2721c1);const _0x1cb5c7=_0x317840[_0x7bf667(0x26d)]['id'];console['log'](_0x1cb5c7);const _0x3d1f24=await sales[_0x7bf667(0x1fc)](_0x1cb5c7);console[_0x7bf667(0x282)](_0x7bf667(0x1ab),_0x3d1f24);const _0x1ffd68=await warehouse['aggregate']([{'$match':{'name':_0x7bf667(0x180),'room':'Return\x20Rooms'}},{'$unwind':_0x7bf667(0x1f7)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x7bf667(0x21b)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x7bf667(0x215)},'primary_code':{'$first':_0x7bf667(0x1c3)},'secondary_code':{'$first':_0x7bf667(0x260)},'product_code':{'$first':_0x7bf667(0x1f9)}}}]);console['log'](_0x7bf667(0x266),_0x1ffd68);const _0x22c921=await product[_0x7bf667(0x1c6)]({});warehouse_data=await warehouse[_0x7bf667(0x1ec)]([{'$match':{'status':_0x7bf667(0x209),'name':'Return\x20Goods','warehouse_category':_0x7bf667(0x1e2)}},{'$group':{'_id':_0x7bf667(0x24c),'name':{'$first':_0x7bf667(0x24c)}}},{'$sort':{'name':0x1}}]);var _0x4809d6=['Return\x20Rooms'];if(_0x2721c1[0x0][_0x7bf667(0x24e)]==_0x7bf667(0x19d)){var _0x5c42c2=users['English'];console[_0x7bf667(0x282)](_0x5c42c2);}else{if(_0x2721c1[0x0]['language']==_0x7bf667(0x234))var _0x5c42c2=users[_0x7bf667(0x234)];else{if(_0x2721c1[0x0]['language']=='German')var _0x5c42c2=users['German'];else{if(_0x2721c1[0x0][_0x7bf667(0x24e)]==_0x7bf667(0x19b))var _0x5c42c2=users[_0x7bf667(0x19b)];else{if(_0x2721c1[0x0][_0x7bf667(0x24e)]=='French')var _0x5c42c2=users[_0x7bf667(0x1ee)];else{if(_0x2721c1[0x0][_0x7bf667(0x24e)]==_0x7bf667(0x195))var _0x5c42c2=users['Portuguese'];else{if(_0x2721c1[0x0][_0x7bf667(0x24e)]=='Chinese')var _0x5c42c2=users[_0x7bf667(0x258)];else{if(_0x2721c1[0x0][_0x7bf667(0x24e)]==_0x7bf667(0x257))var _0x5c42c2=users[_0x7bf667(0x1e4)];}}}}}}}_0x9d8d30[_0x7bf667(0x25b)](_0x7bf667(0x264),{'success':_0x317840[_0x7bf667(0x238)](_0x7bf667(0x23f)),'errors':_0x317840[_0x7bf667(0x238)](_0x7bf667(0x243)),'role':_0xdd8473,'profile':_0x5ace0e,'user':_0x3d1f24,'stock':_0x1ffd68,'master_shop':_0x2721c1,'unit':_0x22c921,'language':_0x5c42c2,'warehouses':warehouse_data,'rooms':_0x4809d6});}catch(_0x18f099){console[_0x7bf667(0x282)](_0x18f099),_0x9d8d30[_0x7bf667(0x18b)](0xc8)['json']({'message':_0x18f099[_0x7bf667(0x240)]});}}),router[a0_0x3cce07(0x239)](a0_0x3cce07(0x237),auth,async(_0x40cf0d,_0x272fb5)=>{var _0x3f70ee=a0_0x3cce07;try{const {invoice:_0x374e04,date:_0x44b225,warehouse_name:_0xe36636,product_name:_0x2fc53c,primary_code:_0x59c183,secondary_code:_0xf3653,product_code:_0x462468,sales_quantity:_0x5ef2a6,stocks:_0x283483,return_qty:_0x33ad59,Room_name:_0x2515d2,to_warehouse_name:_0x1e0e45,to_Roomname:_0x4b5e26,to_Room_name:_0x31ac5f,note:_0x1e3366,level:_0x4d7f54,isle:_0x4986c3,pallet:_0x2d9b8b}=_0x40cf0d['body'];if(typeof _0x2fc53c==_0x3f70ee(0x196))var _0x30eba0=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x198)]],_0x22ded3=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x23c)]],_0x5e0ff5=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x22f)]],_0x26c2fd=[_0x40cf0d['body']['product_code']],_0x5b980f=[_0x40cf0d['body'][_0x3f70ee(0x233)]],_0x124d38=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1cd)]],_0x21a056=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x20c)]],_0x2b65a7=[_0x40cf0d['body'][_0x3f70ee(0x244)]],_0x168f0d=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1e5)]],_0x2a693e=[_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1f4)]],_0xd6df5b=[_0x40cf0d['body'][_0x3f70ee(0x1db)]];else var _0x30eba0=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x198)]],_0x22ded3=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x23c)]],_0x5e0ff5=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x22f)]],_0x26c2fd=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1b3)]],_0x5b980f=[..._0x40cf0d['body'][_0x3f70ee(0x233)]],_0x124d38=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1cd)]],_0x21a056=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x20c)]],_0x2b65a7=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x244)]],_0x168f0d=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1e5)]],_0x2a693e=[..._0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x1f4)]],_0xd6df5b=[..._0x40cf0d[_0x3f70ee(0x20f)]['floorlevel']];const _0x34cd99=_0x30eba0['map'](_0x4fdbbb=>{return _0x4fdbbb={'product_name':_0x4fdbbb};});_0x22ded3['forEach']((_0x208d13,_0x2bfc7f)=>{var _0x1690e5=_0x3f70ee;_0x34cd99[_0x2bfc7f][_0x1690e5(0x23c)]=_0x208d13;}),_0x5e0ff5['forEach']((_0x3c5113,_0xaa449d)=>{var _0x433065=_0x3f70ee;_0x34cd99[_0xaa449d][_0x433065(0x22f)]=_0x3c5113;}),_0x26c2fd[_0x3f70ee(0x17d)]((_0x4468a4,_0x1b1b8f)=>{var _0x2a8505=_0x3f70ee;_0x34cd99[_0x1b1b8f][_0x2a8505(0x1b3)]=_0x4468a4;}),_0x5b980f[_0x3f70ee(0x17d)]((_0x1a0de8,_0x391eac)=>{var _0x461125=_0x3f70ee;_0x34cd99[_0x391eac][_0x461125(0x1d3)]=_0x1a0de8;}),_0x124d38[_0x3f70ee(0x17d)]((_0x5041e6,_0x2d1dce)=>{var _0x5ac200=_0x3f70ee;_0x34cd99[_0x2d1dce][_0x5ac200(0x261)]=_0x5041e6;}),_0x21a056[_0x3f70ee(0x17d)]((_0x58b4ed,_0x107db7)=>{var _0x4e4dff=_0x3f70ee;_0x34cd99[_0x107db7][_0x4e4dff(0x20c)]=_0x58b4ed;}),_0x2b65a7['forEach']((_0x397072,_0x4a7113)=>{_0x34cd99[_0x4a7113]['bay']=_0x397072;}),_0x168f0d[_0x3f70ee(0x17d)]((_0xaa5c53,_0x181195)=>{_0x34cd99[_0x181195]['bin']=_0xaa5c53;}),_0x2a693e['forEach']((_0x2c5a1e,_0x36b75f)=>{var _0x2cd381=_0x3f70ee;_0x34cd99[_0x36b75f][_0x2cd381(0x246)]=_0x2c5a1e;}),_0xd6df5b[_0x3f70ee(0x17d)]((_0x57c3dc,_0x130cf3)=>{_0x34cd99[_0x130cf3]['floorlevel']=_0x57c3dc;});var _0x25d377=0x0;_0x34cd99[_0x3f70ee(0x17d)](_0xc3841f=>{var _0x335d22=_0x3f70ee;console[_0x335d22(0x282)]('foreach\x20newproduct',_0xc3841f),(parseInt(_0xc3841f[_0x335d22(0x1d3)])<parseInt(_0xc3841f[_0x335d22(0x20c)])||parseInt(_0xc3841f[_0x335d22(0x261)])<parseInt(_0xc3841f[_0x335d22(0x20c)])&&parseInt(_0xc3841f[_0x335d22(0x1d3)])>parseInt(_0xc3841f[_0x335d22(0x20c)])||parseInt(_0xc3841f[_0x335d22(0x20c)])==0x0)&&_0x25d377++;});if(_0x25d377!=0x0)return _0x40cf0d[_0x3f70ee(0x238)](_0x3f70ee(0x243),_0x3f70ee(0x1cc)),_0x272fb5[_0x3f70ee(0x19a)](_0x3f70ee(0x201));const _0x3c5a80=await sales[_0x3f70ee(0x283)]({'invoice':_0x374e04});console[_0x3f70ee(0x282)](_0x3c5a80),_0x3c5a80[_0x3f70ee(0x194)]=_0x3f70ee(0x1fe);const _0x4ef031=await _0x3c5a80['save'](),_0x16e5e6=new sales_return({'invoice':_0x374e04,'customer':_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x268)],'date':_0x44b225,'warehouse_name':_0xe36636,'room':_0x2515d2,'ToWarehouse':_0x1e0e45,'ToRoom':_0x31ac5f,'return_sale':_0x34cd99,'note':_0x1e3366}),_0x415ca8=await _0x16e5e6['save']();console[_0x3f70ee(0x282)](_0x16e5e6);const _0x562c74=await sales_return['findOne']({'invoice':_0x374e04}),_0xfc5831=await warehouse[_0x3f70ee(0x283)]({'name':_0x1e0e45,'room':_0x31ac5f});_0x562c74[_0x3f70ee(0x264)][_0x3f70ee(0x17d)](_0x1e88c1=>{var _0x28cd04=_0x3f70ee,_0xd6d9a7=0x0;const _0x398144=_0xfc5831['product_details'][_0x28cd04(0x17c)](_0x310ead=>{var _0x30e1c8=_0x28cd04;_0x310ead[_0x30e1c8(0x198)]==_0x1e88c1['product_name']&&_0x310ead[_0x30e1c8(0x1db)]==_0x1e88c1[_0x30e1c8(0x1db)]&&_0x310ead[_0x30e1c8(0x246)]==_0x1e88c1['type']&&_0x310ead[_0x30e1c8(0x1e5)]==_0x1e88c1['bin']&&_0x310ead[_0x30e1c8(0x244)]==_0x1e88c1['bay']&&(_0x310ead['product_stock']=parseInt(_0x310ead[_0x30e1c8(0x24d)])+parseInt(_0x1e88c1[_0x30e1c8(0x20c)]),_0xd6d9a7++);});_0xd6d9a7=='0'&&(_0xfc5831[_0x28cd04(0x22e)]=_0xfc5831[_0x28cd04(0x22e)][_0x28cd04(0x1b0)]({'product_name':_0x1e88c1[_0x28cd04(0x198)],'product_stock':_0x1e88c1['return_qty'],'primary_code':_0x1e88c1[_0x28cd04(0x23c)],'secondary_code':_0x1e88c1[_0x28cd04(0x22f)],'product_code':_0x1e88c1[_0x28cd04(0x1b3)],'bay':_0x1e88c1['bay'],'bin':_0x1e88c1['bin'],'type':_0x1e88c1[_0x28cd04(0x246)],'floorlevel':_0x1e88c1[_0x28cd04(0x1db)]})),console[_0x28cd04(0x282)](_0x28cd04(0x186),_0xfc5831);}),await _0xfc5831[_0x3f70ee(0x200)](),console[_0x3f70ee(0x282)](_0x40cf0d[_0x3f70ee(0x20f)]);const _0x3f42fd=new c_payment_data({'invoice':_0x374e04,'customer':_0x40cf0d['body'][_0x3f70ee(0x268)],'reason':'Sale\x20Return'});await _0x3f42fd[_0x3f70ee(0x200)]();const _0x33d9ec=await master_shop['find']();console[_0x3f70ee(0x282)](_0x3f70ee(0x1fd),_0x33d9ec[0x0][_0x3f70ee(0x230)]);const _0x2cac7b=await email_settings[_0x3f70ee(0x283)](),_0x351844=await customer['findOne']({'name':_0x40cf0d[_0x3f70ee(0x20f)][_0x3f70ee(0x268)]});console[_0x3f70ee(0x282)](_0x3f70ee(0x1f6),_0x351844);_0x33d9ec[0x0]['currency_placement']==0x1?(right_currency=_0x33d9ec[0x0][_0x3f70ee(0x197)],left_currency=''):(right_currency='',left_currency=_0x33d9ec[0x0][_0x3f70ee(0x197)]);var _0x39d4de=_0x30eba0,_0x3bf959=_0x21a056,_0x4abdc0='',_0x511c29;for(_0x511c29 in _0x39d4de){_0x4abdc0+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x39d4de[_0x511c29]+_0x3f70ee(0x1f3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3bf959[_0x511c29]+'</td>'+_0x3f70ee(0x18a);}console[_0x3f70ee(0x282)]('product_list',_0x4abdc0);let _0x49da84=nodemailer[_0x3f70ee(0x193)]({'service':_0x3f70ee(0x27b),'auth':{'user':_0x2cac7b[_0x3f70ee(0x27c)],'pass':_0x2cac7b['password']}}),_0x59e2aa={'from':_0x2cac7b[_0x3f70ee(0x27c)],'to':_0x351844[_0x3f70ee(0x27c)],'subject':_0x3f70ee(0x1de),'attachments':[{'filename':_0x3f70ee(0x20a),'path':__dirname+'/../public'+_0x3f70ee(0x203)+_0x33d9ec[0x0][_0x3f70ee(0x230)],'cid':'logo'}],'html':_0x3f70ee(0x253)+'<html><head><title></title>'+_0x3f70ee(0x277)+_0x3f70ee(0x25d)+_0x3f70ee(0x252)+'<div>'+_0x3f70ee(0x25e)+_0x3f70ee(0x1f1)+_0x3f70ee(0x25d)+_0x3f70ee(0x20d)+_0x33d9ec[0x0][_0x3f70ee(0x183)]+_0x3f70ee(0x1c5)+_0x3f70ee(0x1f1)+_0x3f70ee(0x1f1)+_0x3f70ee(0x190)+'<div>'+_0x3f70ee(0x1b5)+_0x3f70ee(0x1d9)+_0x374e04+'\x20'+_0x3f70ee(0x19c)+_0x3f70ee(0x20e)+_0x44b225+'\x20'+_0x3f70ee(0x17e)+_0x3f70ee(0x226)+_0x3f70ee(0x1f1)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3f70ee(0x205)+_0x3f70ee(0x1ff)+_0x3f70ee(0x21d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x3f70ee(0x1eb)+_0x3f70ee(0x18a)+_0x3f70ee(0x1b4)+_0x3f70ee(0x181)+'\x20'+_0x4abdc0+'\x20'+'</tbody>'+_0x3f70ee(0x27e)+_0x3f70ee(0x25d)+_0x3f70ee(0x219)+_0x3f70ee(0x1d1)+_0x33d9ec[0x0][_0x3f70ee(0x183)]+_0x3f70ee(0x226)+_0x3f70ee(0x1f1)+_0x3f70ee(0x1f1)+_0x3f70ee(0x1c2)};_0x49da84[_0x3f70ee(0x1e0)](_0x59e2aa,function(_0x486d0a,_0x3044db){var _0x123c04=_0x3f70ee;_0x486d0a?(console[_0x123c04(0x282)](_0x486d0a),console[_0x123c04(0x282)](_0x123c04(0x1a9))):console[_0x123c04(0x282)](_0x123c04(0x1dd));}),_0x40cf0d[_0x3f70ee(0x238)](_0x3f70ee(0x23f),_0x3f70ee(0x206)),_0x272fb5[_0x3f70ee(0x19a)](_0x3f70ee(0x250));}catch(_0x1e676f){console['log'](_0x1e676f),_0x272fb5[_0x3f70ee(0x18b)](0xc8)[_0x3f70ee(0x191)]({'message1':_0x1e676f['message']});}}),router['get'](a0_0x3cce07(0x1c1),auth,async(_0x3762ef,_0x5b2eb1)=>{var _0x3dd1d5=a0_0x3cce07;try{const {username:_0x346e23,email:_0xa46003,role:_0x4177a4}=_0x3762ef[_0x3dd1d5(0x1dc)],_0x21a4a6=_0x3762ef['user'],_0x49d430=await profile[_0x3dd1d5(0x283)]({'email':_0x21a4a6[_0x3dd1d5(0x27c)]}),_0x3be482=await master_shop[_0x3dd1d5(0x1c6)]();console[_0x3dd1d5(0x282)]('barcode\x20Product\x20master',_0x3be482);const _0x494643=_0x3762ef[_0x3dd1d5(0x26d)]['id'],_0x1d5a61=await sales[_0x3dd1d5(0x1fc)](_0x494643);console[_0x3dd1d5(0x282)](_0x3dd1d5(0x214),_0x1d5a61);if(_0x3be482[0x0][_0x3dd1d5(0x24e)]==_0x3dd1d5(0x19d))var _0x37086e=users[_0x3dd1d5(0x1a2)];else{if(_0x3be482[0x0][_0x3dd1d5(0x24e)]==_0x3dd1d5(0x234))var _0x37086e=users[_0x3dd1d5(0x234)];else{if(_0x3be482[0x0]['language']==_0x3dd1d5(0x213))var _0x37086e=users[_0x3dd1d5(0x213)];else{if(_0x3be482[0x0][_0x3dd1d5(0x24e)]==_0x3dd1d5(0x19b))var _0x37086e=users[_0x3dd1d5(0x19b)];else{if(_0x3be482[0x0][_0x3dd1d5(0x24e)]==_0x3dd1d5(0x1ee))var _0x37086e=users[_0x3dd1d5(0x1ee)];else{if(_0x3be482[0x0][_0x3dd1d5(0x24e)]==_0x3dd1d5(0x195))var _0x37086e=users[_0x3dd1d5(0x1df)];else{if(_0x3be482[0x0]['language']=='Chinese')var _0x37086e=users[_0x3dd1d5(0x258)];else{if(_0x3be482[0x0][_0x3dd1d5(0x24e)]==_0x3dd1d5(0x257))var _0x37086e=users['Arabic'];}}}}}}}_0x5b2eb1['render'](_0x3dd1d5(0x25a),{'success':_0x3762ef[_0x3dd1d5(0x238)](_0x3dd1d5(0x23f)),'errors':_0x3762ef[_0x3dd1d5(0x238)](_0x3dd1d5(0x243)),'role':_0x21a4a6,'profile':_0x49d430,'alldata':_0x1d5a61,'master_shop':_0x3be482,'language':_0x37086e});}catch(_0x40c92b){console[_0x3dd1d5(0x282)](_0x40c92b);}}),router[a0_0x3cce07(0x239)](a0_0x3cce07(0x1fb),async(_0x4fe871,_0x15e084)=>{var _0x39e85a=a0_0x3cce07;const {product_code:_0x2353a5,warehouse_name:_0x522bac,rooms_data:_0x15ccd1,Roomslist:_0x42a993}=_0x4fe871[_0x39e85a(0x20f)],_0x3429c7=_0x42a993[_0x39e85a(0x245)](','),_0x983d0c=[];async function _0x2ec812(_0x1661ad){var _0x55a947=_0x39e85a;const _0x5f6beb=await warehouse[_0x55a947(0x1ec)]([{'$match':{'name':_0x522bac,'room':_0x1661ad}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x2353a5}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x55a947(0x21b)},'product_stock':{'$first':_0x55a947(0x192)},'primary_code':{'$first':_0x55a947(0x1c3)},'secondary_code':{'$first':_0x55a947(0x260)},'product_code':{'$first':_0x55a947(0x1f9)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x55a947(0x18c)},'type':{'$first':_0x55a947(0x256)},'pallet':{'$first':_0x55a947(0x24a)},'unit':{'$first':_0x55a947(0x232)},'secondary_unit':{'$first':_0x55a947(0x18d)},'storage':{'$first':_0x55a947(0x23e)},'rack':{'$first':_0x55a947(0x20b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x55a947(0x271)},'maxPerUnit':{'$first':_0x55a947(0x1ed)},'batch_code':{'$first':_0x55a947(0x1e3)},'product_cat':{'$first':_0x55a947(0x280)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x55a947(0x26b)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x3a512a=await warehouse[_0x55a947(0x1ec)]([{'$match':{'name':_0x522bac,'room':_0x1661ad}},{'$unwind':_0x55a947(0x1f7)},{'$match':{'product_details.secondary_code':_0x2353a5}},{'$group':{'_id':_0x55a947(0x1b1),'name':{'$first':_0x55a947(0x21b)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x55a947(0x1c3)},'secondary_code':{'$first':_0x55a947(0x260)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x55a947(0x23a)},'isle':{'$first':_0x55a947(0x18c)},'type':{'$first':_0x55a947(0x256)},'pallet':{'$first':_0x55a947(0x24a)},'unit':{'$first':_0x55a947(0x232)},'secondary_unit':{'$first':_0x55a947(0x18d)},'storage':{'$first':_0x55a947(0x23e)},'rack':{'$first':_0x55a947(0x20b)},'expiry_date':{'$first':_0x55a947(0x188)},'production_date':{'$first':_0x55a947(0x271)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x55a947(0x1e3)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x55a947(0x26f)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x5f6beb[_0x55a947(0x1a3)]>0x0)_0x983d0c['push'](_0x5f6beb);else _0x3a512a['length']>0x0&&_0x983d0c[_0x55a947(0x1da)](_0x3a512a);}const _0x241600=_0x3429c7[_0x39e85a(0x17c)](_0x1fba30=>_0x2ec812(_0x1fba30));await Promise[_0x39e85a(0x272)](_0x241600),_0x15e084[_0x39e85a(0x191)](_0x983d0c);}),module['exports']=router;