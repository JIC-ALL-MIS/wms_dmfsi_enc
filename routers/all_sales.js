var a0_0x547146=a0_0x46c5;(function(_0x3df409,_0x169c11){var _0x2a6a4c=a0_0x46c5,_0x2c728a=_0x3df409();while(!![]){try{var _0x1d5c0c=parseInt(_0x2a6a4c(0x129))/0x1+-parseInt(_0x2a6a4c(0xc9))/0x2*(-parseInt(_0x2a6a4c(0xdc))/0x3)+-parseInt(_0x2a6a4c(0x132))/0x4*(parseInt(_0x2a6a4c(0xe0))/0x5)+parseInt(_0x2a6a4c(0x148))/0x6+-parseInt(_0x2a6a4c(0x16e))/0x7*(parseInt(_0x2a6a4c(0xe9))/0x8)+-parseInt(_0x2a6a4c(0x163))/0x9+parseInt(_0x2a6a4c(0x11b))/0xa;if(_0x1d5c0c===_0x169c11)break;else _0x2c728a['push'](_0x2c728a['shift']());}catch(_0x29b5a7){_0x2c728a['push'](_0x2c728a['shift']());}}}(a0_0x3cba,0xbe86c));const express=require(a0_0x547146(0x13d)),app=express(),router=express[a0_0x547146(0x169)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x547146(0x165)),users=require(a0_0x547146(0xe1));router[a0_0x547146(0x121)](a0_0x547146(0x142),auth,async(_0x832451,_0xfd9b80)=>{var _0x4b3b6f=a0_0x547146;try{const {username:_0x2d5257,email:_0x26420c,role:_0x222d1f}=_0x832451[_0x4b3b6f(0x164)],_0x5dec72=_0x832451[_0x4b3b6f(0x164)],_0x318d4d=await profile['findOne']({'email':_0x5dec72['email']}),_0x41508b=await master_shop[_0x4b3b6f(0x14b)]();let _0xe898e0;if(_0x5dec72[_0x4b3b6f(0xfc)]==_0x4b3b6f(0xb9)){const _0x139465=await staff['findOne']({'email':_0x5dec72[_0x4b3b6f(0x166)]});_0xe898e0=await sales['aggregate']([{'$lookup':{'from':_0x4b3b6f(0x110),'localField':_0x4b3b6f(0xf3),'foreignField':_0x4b3b6f(0x135),'as':_0x4b3b6f(0x130)}},{'$unwind':_0x4b3b6f(0xce)},{'$unwind':_0x4b3b6f(0xac)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4b3b6f(0x139)},'customers':{'$first':_0x4b3b6f(0xd8)},'date':{'$first':_0x4b3b6f(0xf9)},'warehouse_name':{'$first':_0x4b3b6f(0xc5)},'sale_product':{'$push':_0x4b3b6f(0xac)},'note':{'$first':_0x4b3b6f(0xa8)},'return_data':{'$first':_0x4b3b6f(0x168)},'customers_docs':{'$first':_0x4b3b6f(0xce)},'total_saleproduct_quantity':{'$sum':_0x4b3b6f(0x153)},'level':{'$addToSet':_0x4b3b6f(0x109)},'isle':{'$addToSet':_0x4b3b6f(0x93)},'type':{'$addToSet':_0x4b3b6f(0x17b)},'pallet':{'$addToSet':_0x4b3b6f(0xaa)},'finalize':{'$first':_0x4b3b6f(0x14f)},'isAllowEdit':{'$first':_0x4b3b6f(0xee)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xe898e0=await sales[_0x4b3b6f(0xa6)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':_0x4b3b6f(0x130)}},{'$unwind':'$customers_docs'},{'$unwind':'$sale_product'},{'$group':{'_id':_0x4b3b6f(0x134),'invoice':{'$first':_0x4b3b6f(0x139)},'customers':{'$first':_0x4b3b6f(0xd8)},'date':{'$first':_0x4b3b6f(0xf9)},'warehouse_name':{'$first':_0x4b3b6f(0xc5)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':_0x4b3b6f(0x168)},'customers_docs':{'$first':_0x4b3b6f(0xce)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x4b3b6f(0x109)},'isle':{'$addToSet':_0x4b3b6f(0x93)},'type':{'$addToSet':_0x4b3b6f(0x17b)},'pallet':{'$addToSet':_0x4b3b6f(0xaa)},'finalize':{'$first':_0x4b3b6f(0x14f)},'isAllowEdit':{'$first':_0x4b3b6f(0xee)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4b3b6f(0x96)](_0x4b3b6f(0x18c),_0xe898e0);if(_0x41508b[0x0][_0x4b3b6f(0xdf)]=='English\x20(US)'){var _0x40b75=users[_0x4b3b6f(0xf1)];console['log'](_0x40b75);}else{if(_0x41508b[0x0][_0x4b3b6f(0xdf)]==_0x4b3b6f(0x122))var _0x40b75=users[_0x4b3b6f(0x122)];else{if(_0x41508b[0x0][_0x4b3b6f(0xdf)]==_0x4b3b6f(0xb0))var _0x40b75=users['German'];else{if(_0x41508b[0x0][_0x4b3b6f(0xdf)]==_0x4b3b6f(0xb5))var _0x40b75=users['Spanish'];else{if(_0x41508b[0x0][_0x4b3b6f(0xdf)]=='French')var _0x40b75=users[_0x4b3b6f(0x184)];else{if(_0x41508b[0x0][_0x4b3b6f(0xdf)]==_0x4b3b6f(0x145))var _0x40b75=users[_0x4b3b6f(0x9c)];else{if(_0x41508b[0x0]['language']==_0x4b3b6f(0x9b))var _0x40b75=users[_0x4b3b6f(0x9b)];else{if(_0x41508b[0x0][_0x4b3b6f(0xdf)]==_0x4b3b6f(0x178))var _0x40b75=users[_0x4b3b6f(0xd9)];}}}}}}}_0xfd9b80[_0x4b3b6f(0x99)](_0x4b3b6f(0xfe),{'success':_0x832451[_0x4b3b6f(0x13c)](_0x4b3b6f(0x156)),'errors':_0x832451[_0x4b3b6f(0x13c)](_0x4b3b6f(0x10c)),'sales':_0xe898e0,'profile':_0x318d4d,'role':_0x5dec72,'master_shop':_0x41508b,'language':_0x40b75});}catch(_0x9b0227){console[_0x4b3b6f(0x96)](_0x9b0227);}});function a0_0x46c5(_0x338fd0,_0x466d4c){var _0x3cbafa=a0_0x3cba();return a0_0x46c5=function(_0x46c59e,_0x128ed0){_0x46c59e=_0x46c59e-0x83;var _0x46b3ab=_0x3cbafa[_0x46c59e];return _0x46b3ab;},a0_0x46c5(_0x338fd0,_0x466d4c);}function a0_0x3cba(){var _0x2f5d7b=['prod_invoice','German','edit_sales','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','return_data','batch_code','Spanish','barcode\x20user_id','$product_details.product_cat','$room','staff','$product_details.maxPerUnit','push','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.actual_uom','primary_unit','delivery_date','/view/add_sales','gmail','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$warehouse_name','Level','<div>','/all_sales/preview/','626534hdGUjr','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','requested_qty','findOne','Email\x20sent\x20successfully','$customers_docs','back','product','error','prod_cat','English\x20(US)','date','forEach','Sales\x20Update\x20successfully','Floor','$customer','Arabic','Receiving\x20Area','$product_details.type','3hOuLof','production_date','Raw\x20Materials','language','5KERCzO','../public/language/languages.json','</span>','findById','/preview/:id','An\x20error\x20occurred.','catch','Return\x20Rooms','</thead>','3017800kdRLXU','payment\x20successfull','return_sale','barcode\x20Product\x20master','Error\x20Occurs','$isAllowEdit','$product_details.storage','floor','English','$product_details.product_stock','customer','$product_details._id','finalize','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_details','$product_details.level','$date','\x20Order\x20Date\x20:\x20','$product_details.product_code','role','/view/add_sale/product','all_sales','expiry_date','actual_qty','sales\x20item\x20return\x20successfull','product_name','currency','filter','$product','master','Sales\x20Add\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$sale_product.bay','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<span\x20style=\x22float:\x20right;\x22>','errors','storage','RoomAssigned','sales_invoice','customers','exports','edit_sales_view','$name','level','id_transact','logo','bin','$product_details.invoice','<html><head><title></title>','customer_data','16845080PQaWXH','_id','<!DOCTYPE\x20html>','$product_details','image','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','get','Hindi','product_data','secondary_code','$product_details.bay','/view/return_sales/:id','maxperunit','Received\x20Payment\x20For\x20Sale','849842LsxEKC','</tbody>','invoice','string','<h2>\x20','abs','Sales\x20Mail','customers_docs','<hr\x20class=\x22my-3\x22>','3647444ncGyGl','carton','$_id','name','add\x20post','redirect','quantity_notConverted','$invoice','<h5\x20style=\x22text-align:\x20left;\x22>','primary_code','flash','express','post','body','<strong>\x20Regards\x20</strong>','/barcode_scanner','/view','return_qty','/view/:id','Portuguese\x20(BR)','$product_details.secondary_unit','unit','5837232jeTWUp','max','$product_details.pallet','find','params','port','OUT-','$finalize','Ambient','</head><body>','toString','$sale_product.quantity','save','delivery_code','success','</h5>','getDate','</td>','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','length','status','</table>','quantity','</body></html>','$product_details.secondary_code','stocks','8969013uyYkWB','user','nodemailer','email','foreach\x20newproduct','$return_data','Router','padStart','stock','warehouse_name','/all_sales/view','21xShhVW','Shelves','$product_details.floorlevel','</div>','max_per_unit','received_amount','stock_data','isAllowEdit','sendMail','True','Arabic\x20(ae)','$product_details.production_date','$product_details.rack','$sale_product.type','\x20</h2>','Return\x20Goods','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','SCRN','password','/upload/','type','An\x20error\x20occurred\x20while\x20saving\x20data.','French','split','createTransport','slice','prod_code','$product_details.batch_code','Enclosed','$product_details.expiry_date','sales\x20all_data','message','sales_quantity','all_sales_barcode','map','actual_uom','\x20Order\x20Number\x20:\x20','</tr>','room_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','id_transaction_from','$product_details.unit','<tr>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','False','all','$product_details.primary_code','/barcode/:id','$product.product_name','$sale_product.bin','bay','types','log','secondary_unit','/../public','render','$product_details.product_name','Chinese','Portuguese','amount','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_list','site_title','floorlevel','json','Logo.png','aggregate','product_stock','$note','<h5>','$sale_product.floorlevel','$product_details.bin','$sale_product','note','sale_product'];a0_0x3cba=function(){return _0x2f5d7b;};return a0_0x3cba();}async function getRandom8DigitNumber(){var _0x15d41c=a0_0x547146;const _0x44b0ee=0x989680,_0x54ac85=0x5f5e0ff,_0x52cda3=Math[_0x15d41c(0xf0)](Math['random']()*(_0x54ac85-_0x44b0ee+0x1))+_0x44b0ee;var _0xac5a4a;const _0x16d78f=await sales[_0x15d41c(0xcc)]({'invoice':_0x15d41c(0x14e)+_0x52cda3});return _0x16d78f&&_0x16d78f[_0x15d41c(0x15c)]>0x0?_0xac5a4a=_0x15d41c(0x14e)+_0x52cda3:_0xac5a4a=_0x15d41c(0x14e)+_0x52cda3,_0xac5a4a;}router[a0_0x547146(0x121)](a0_0x547146(0xc1),auth,async(_0x1338a2,_0x2a5201)=>{var _0x185a2c=a0_0x547146;try{const {username:_0x36dca2,email:_0x3a4d78,role:_0x329e94}=_0x1338a2['user'],_0x42f65a=_0x1338a2[_0x185a2c(0x164)],_0x2207e4=await profile['findOne']({'email':_0x42f65a[_0x185a2c(0x166)]}),_0x261c07=await master_shop[_0x185a2c(0x14b)](),_0x5efe20=await customer[_0x185a2c(0x14b)]({});let _0x2480cf;if(_0x42f65a[_0x185a2c(0xfc)]==_0x185a2c(0xb9)){const _0x13a6ab=await staff[_0x185a2c(0xcc)]({'email':_0x42f65a[_0x185a2c(0x166)]});_0x2480cf=await warehouse[_0x185a2c(0xa6)]([{'$match':{'status':_0x185a2c(0x88),'name':_0x13a6ab['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x185a2c(0x17d)}}},{'$group':{'_id':_0x185a2c(0x113),'name':{'$first':_0x185a2c(0x113)}}},{'$sort':{'name':0x1}}]);}else _0x2480cf=await warehouse['aggregate']([{'$match':{'status':_0x185a2c(0x88),'warehouse_category':_0x185a2c(0xde),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x185a2c(0x113),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0xc4328f=await product['find']({});var _0x32e923=[_0x185a2c(0x150),'Enclosed'];const _0x177e2f=await sales[_0x185a2c(0x14b)]({}),_0x5d93bb=_0x177e2f[_0x185a2c(0x15c)]+0x1,_0x1369ad=_0x185a2c(0x14e)+_0x5d93bb[_0x185a2c(0x152)]()[_0x185a2c(0x16a)](0x5,'0');if(_0x261c07[0x0][_0x185a2c(0xdf)]==_0x185a2c(0xd3)){var _0x421276=users['English'];console['log'](_0x421276);}else{if(_0x261c07[0x0][_0x185a2c(0xdf)]==_0x185a2c(0x122))var _0x421276=users[_0x185a2c(0x122)];else{if(_0x261c07[0x0][_0x185a2c(0xdf)]==_0x185a2c(0xb0))var _0x421276=users[_0x185a2c(0xb0)];else{if(_0x261c07[0x0][_0x185a2c(0xdf)]==_0x185a2c(0xb5))var _0x421276=users[_0x185a2c(0xb5)];else{if(_0x261c07[0x0][_0x185a2c(0xdf)]==_0x185a2c(0x184))var _0x421276=users[_0x185a2c(0x184)];else{if(_0x261c07[0x0][_0x185a2c(0xdf)]=='Portuguese\x20(BR)')var _0x421276=users[_0x185a2c(0x9c)];else{if(_0x261c07[0x0]['language']=='Chinese')var _0x421276=users['Chinese'];else{if(_0x261c07[0x0]['language']=='Arabic\x20(ae)')var _0x421276=users[_0x185a2c(0xd9)];}}}}}}}const _0x9f9fb6=getRandom8DigitNumber();_0x9f9fb6[_0x185a2c(0xc3)](_0x114e82=>{var _0x920e36=_0x185a2c;_0x2a5201[_0x920e36(0x99)]('add_sales',{'success':_0x1338a2['flash'](_0x920e36(0x156)),'errors':_0x1338a2[_0x920e36(0x13c)](_0x920e36(0x10c)),'role':_0x42f65a,'profile':_0x2207e4,'customer':_0x5efe20,'warehouse':_0x2480cf,'product':_0xc4328f,'invoice':_0x114e82,'master_shop':_0x261c07,'language':_0x421276,'rooms_data':_0x32e923});})[_0x185a2c(0xe6)](_0xb2394=>{var _0x2d9c60=_0x185a2c;_0x1338a2[_0x2d9c60(0x13c)](_0x2d9c60(0x10c),_0x2d9c60(0x87)),_0x2a5201[_0x2d9c60(0x137)](_0x2d9c60(0x16d));});}catch(_0x217f88){console[_0x185a2c(0x96)](_0x217f88);}}),router[a0_0x547146(0x121)]('/view/add_sales/:id',auth,async(_0x5aeb89,_0x5bed45)=>{var _0x487446=a0_0x547146;try{const _0xd22d42=_0x5aeb89[_0x487446(0x14c)]['id'];console[_0x487446(0x96)](_0xd22d42);const _0x22245b=await product[_0x487446(0x14b)](),_0x36b58a=await purchases[_0x487446(0xa6)]([{'$match':{'warehouse_name':_0xd22d42}},{'$unwind':_0x487446(0x105)},{'$group':{'_id':_0x487446(0x92)}}]);console[_0x487446(0x96)]('purchases_data',_0x36b58a),_0x5bed45[_0x487446(0x15d)](0xc8)[_0x487446(0xa4)]({'purchases_data':_0x36b58a,'product_data':_0x22245b});}catch(_0x2ed54b){console[_0x487446(0x96)](_0x2ed54b);}}),router[a0_0x547146(0x13e)](a0_0x547146(0xfd),auth,async(_0x136a24,_0x288d58)=>{var _0x2e6313=a0_0x547146;try{const {warehouse_data:_0x3f1762,product_data:_0x2a3381}=_0x136a24[_0x2e6313(0x13f)];console['log'](_0x136a24[_0x2e6313(0x13f)][_0x2e6313(0x123)]);;const _0x20eb7a=await master_shop[_0x2e6313(0x14b)]();console[_0x2e6313(0x96)](_0x2e6313(0x106),_0x20eb7a);const _0x332ca3=await product[_0x2e6313(0xcc)]({'name':_0x2a3381});console[_0x2e6313(0x96)](_0x2e6313(0xd0),_0x332ca3);const _0x5b7266=await warehouse[_0x2e6313(0xa6)]([{'$match':{'name':_0x3f1762}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x2a3381}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x2e6313(0xf2)}}}]);console['log'](_0x2e6313(0x174),_0x5b7266),_0x288d58['status'](0xc8)[_0x2e6313(0xa4)]({'master':_0x20eb7a,'new_product':_0x332ca3,'stock_data':_0x5b7266});}catch(_0x17d57f){console[_0x2e6313(0x96)](_0x17d57f);}}),router[a0_0x547146(0x13e)](a0_0x547146(0xc1),auth,async(_0x4c67b6,_0x220466)=>{var _0x25fd27=a0_0x547146;try{const {invoice:_0x1995ce,date:_0x56418d,warehouse_name:_0xdb98c,product_name:_0x20fa05,stock:_0x1a2463,quantity:_0x32104b,note:_0x5ed049,room:_0x4929d6,primary_code:_0x34684b,secondary_code:_0x4f60c4,prod_code:_0x5311a3,level:_0x27af2a,isle:_0x56319f,pallet:_0x30d471,batch_code:_0x2b6d6d,SCRN:_0x3e79ee,expiry_date:_0x4ebd22}=_0x4c67b6[_0x25fd27(0x13f)];if(typeof _0x20fa05==_0x25fd27(0x12c))var _0x44cc62=[_0x4c67b6['body'][_0x25fd27(0x102)]],_0x3392c1=[_0x4c67b6['body'][_0x25fd27(0x16b)]],_0x209721=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x133)]],_0x58efc5=[_0x4c67b6[_0x25fd27(0x13f)]['primary_code']],_0x1f374d=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x124)]],_0x10898b=[_0x4c67b6['body'][_0x25fd27(0x188)]],_0x34fcb2=[_0x4c67b6[_0x25fd27(0x13f)]['level']],_0x37fe44=[_0x4c67b6[_0x25fd27(0x13f)]['primary_unit']],_0x5e1f09=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x97)]],_0x20d049=[_0x4c67b6[_0x25fd27(0x13f)]['batch_code']],_0x11c01f=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xff)]],_0x358209=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x172)]],_0x298dac=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xdd)]],_0x4f323d=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xcb)]],_0x50317b=[_0x4c67b6['body']['delivery_date']],_0x1bffbb=[_0x4c67b6['body'][_0x25fd27(0x155)]],_0x288d9a=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xd2)]],_0x3b80d6=[_0x4c67b6['body']['quantity']],_0x4af364=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x10e)]],_0x3897c1=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xaf)]],_0x394c05=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x100)]],_0x2c00d1=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x83)]],_0x45c781=[_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x115)]];else var _0x44cc62=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x102)]],_0x3392c1=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x16b)]],_0x209721=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x133)]],_0x58efc5=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x13b)]],_0x1f374d=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x124)]],_0x10898b=[..._0x4c67b6['body'][_0x25fd27(0x188)]],_0x34fcb2=[..._0x4c67b6[_0x25fd27(0x13f)]['level']],_0x37fe44=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xbf)]],_0x5e1f09=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x97)]],_0x20d049=[..._0x4c67b6['body']['batch_code']],_0x11c01f=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xff)]],_0x358209=[..._0x4c67b6['body']['max_per_unit']],_0x298dac=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xdd)]],_0x4f323d=[..._0x4c67b6[_0x25fd27(0x13f)]['requested_qty']],_0x50317b=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xc0)]],_0x1bffbb=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x155)]],_0x288d9a=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xd2)]],_0x3b80d6=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x15f)]],_0x4af364=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x10e)]],_0x3897c1=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xaf)]],_0x394c05=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x100)]],_0x2c00d1=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x83)]],_0x45c781=[..._0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0x115)]];const _0x2ec22b=_0x44cc62[_0x25fd27(0x190)](_0x46e403=>{return _0x46e403={'product_name':_0x46e403};});_0x3392c1[_0x25fd27(0xd5)]((_0x373265,_0xa108e1)=>{var _0x1d24f3=_0x25fd27;_0x2ec22b[_0xa108e1][_0x1d24f3(0x16b)]=Math[_0x1d24f3(0x12e)](_0x373265);}),_0x394c05['forEach']((_0x1993c3,_0x2948cd)=>{var _0x56e8a3=_0x25fd27;_0x2ec22b[_0x2948cd]['actual_qty']=Math[_0x56e8a3(0x12e)](_0x1993c3);}),_0x2c00d1['forEach']((_0x5d304a,_0x25b5b6)=>{var _0x736f9f=_0x25fd27;_0x2ec22b[_0x25b5b6][_0x736f9f(0x83)]=_0x5d304a;}),_0x45c781[_0x25fd27(0xd5)]((_0x4cb026,_0x41ab81)=>{_0x2ec22b[_0x41ab81]['id_transaction_from']=_0x4cb026;}),_0x209721['forEach']((_0x282241,_0x54a073)=>{_0x2ec22b[_0x54a073]['quantity']=_0x282241;}),_0x58efc5['forEach']((_0xdda035,_0x5cc8d2)=>{_0x2ec22b[_0x5cc8d2]['primary_code']=_0xdda035;}),_0x1f374d[_0x25fd27(0xd5)]((_0x4b2ecb,_0x172564)=>{var _0x2d5431=_0x25fd27;_0x2ec22b[_0x172564][_0x2d5431(0x124)]=_0x4b2ecb;}),_0x10898b[_0x25fd27(0xd5)]((_0x395c0d,_0x49b66a)=>{var _0x55bff8=_0x25fd27;_0x2ec22b[_0x49b66a][_0x55bff8(0x9e)]=_0x395c0d;}),_0x34fcb2['forEach']((_0x1d08c8,_0x2766f6)=>{var _0x8a17ff=_0x25fd27;_0x4af364[_0x8a17ff(0xd5)]((_0x20da7d,_0x2ddd50)=>{var _0x1f0b0e=_0x8a17ff;if(_0x20da7d==_0x1f0b0e(0xda)&&_0x2766f6==_0x2ddd50){var _0x2292c9=_0x1d08c8['slice'](0x3);_0x2ec22b[_0x2766f6]['storage']=_0x1d08c8[0x0],_0x2ec22b[_0x2766f6]['rack']=_0x1d08c8[0x1],_0x2ec22b[_0x2766f6][_0x1f0b0e(0x94)]=0x0,_0x2ec22b[_0x2766f6][_0x1f0b0e(0x117)]=0x0,_0x2ec22b[_0x2766f6][_0x1f0b0e(0x182)]=_0x1f0b0e(0xd7),_0x2ec22b[_0x2766f6][_0x1f0b0e(0xa3)]=_0x2292c9;}else{if(_0x20da7d=='Shelves'&&_0x2766f6==_0x2ddd50){var _0x2292c9=_0x1d08c8[_0x1f0b0e(0x187)](0x3);_0x2ec22b[_0x2766f6][_0x1f0b0e(0x10d)]=_0x1d08c8[0x0],_0x2ec22b[_0x2766f6][_0x1f0b0e(0xbc)]=_0x1d08c8[0x1],_0x2ec22b[_0x2766f6][_0x1f0b0e(0x94)]=0x0,_0x2ec22b[_0x2766f6][_0x1f0b0e(0x117)]=0x0,_0x2ec22b[_0x2766f6]['type']=_0x1f0b0e(0xd7),_0x2ec22b[_0x2766f6][_0x1f0b0e(0xa3)]=_0x1d08c8[0x5];}else{if(_0x2766f6==_0x2ddd50){var _0x33b304;if(_0x1d08c8[0x4]=='L')_0x33b304=_0x1f0b0e(0xc6);else _0x1d08c8[0x4]=='F'&&(_0x33b304=_0x1f0b0e(0xd7));_0x2ec22b[_0x2766f6][_0x1f0b0e(0x10d)]=_0x1d08c8[0x0],_0x2ec22b[_0x2766f6][_0x1f0b0e(0xbc)]=_0x1d08c8[0x1],_0x2ec22b[_0x2766f6]['bay']=_0x1d08c8[0x2],_0x2ec22b[_0x2766f6][_0x1f0b0e(0x117)]=_0x1d08c8[0x3],_0x2ec22b[_0x2766f6]['type']=_0x33b304,_0x2ec22b[_0x2766f6][_0x1f0b0e(0xa3)]=_0x1d08c8[0x5];}}}});}),_0x37fe44[_0x25fd27(0xd5)]((_0x438aff,_0x3bb3d4)=>{var _0x33133b=_0x25fd27;_0x2ec22b[_0x3bb3d4][_0x33133b(0x147)]=_0x438aff;}),_0x5e1f09[_0x25fd27(0xd5)]((_0x2cf610,_0x36c69c)=>{_0x2ec22b[_0x36c69c]['secondary_unit']=_0x2cf610;}),_0x20d049[_0x25fd27(0xd5)]((_0x4c9326,_0x2b9b67)=>{var _0x2498b2=_0x25fd27;_0x2ec22b[_0x2b9b67][_0x2498b2(0xb4)]=_0x4c9326;}),_0x11c01f['forEach']((_0x506d9c,_0x318cf3)=>{_0x2ec22b[_0x318cf3]['expiry_date']=_0x506d9c;}),_0x358209['forEach']((_0x428a94,_0x341861)=>{var _0x4006bd=_0x25fd27;_0x2ec22b[_0x341861][_0x4006bd(0x127)]=_0x428a94;}),_0x298dac[_0x25fd27(0xd5)]((_0x5f2cf7,_0x1aee4d)=>{var _0x196c1c=_0x25fd27;_0x2ec22b[_0x1aee4d][_0x196c1c(0xdd)]=_0x5f2cf7;}),_0x4f323d[_0x25fd27(0xd5)]((_0x41aac4,_0x1705ff)=>{var _0x47620c=_0x25fd27;_0x2ec22b[_0x1705ff][_0x47620c(0xcb)]=_0x41aac4;}),_0x50317b[_0x25fd27(0xd5)]((_0x150d3b,_0x39b7a5)=>{_0x2ec22b[_0x39b7a5]['delivery_date']=_0x150d3b;}),_0x1bffbb[_0x25fd27(0xd5)]((_0x38a086,_0x32f3f6)=>{var _0x4ac7d5=_0x25fd27;_0x2ec22b[_0x32f3f6][_0x4ac7d5(0x155)]=_0x38a086;}),_0x288d9a['forEach']((_0x3c1ac7,_0x199417)=>{_0x2ec22b[_0x199417]['prod_cat']=_0x3c1ac7;}),_0x3b80d6['forEach']((_0x28213e,_0x4a7dc0)=>{_0x2ec22b[_0x4a7dc0]['quantity_notConverted']=_0x28213e;}),_0x4af364[_0x25fd27(0xd5)]((_0x1df1b0,_0x298d68)=>{var _0x526365=_0x25fd27;_0x2ec22b[_0x298d68][_0x526365(0x86)]=_0x1df1b0;}),_0x3897c1[_0x25fd27(0xd5)]((_0x341fdf,_0x162ab1)=>{var _0x6034f0=_0x25fd27;_0x2ec22b[_0x162ab1][_0x6034f0(0x12b)]=_0x341fdf;});var _0x1adde5=0x0;_0x2ec22b[_0x25fd27(0xd5)](_0xb67dff=>{var _0x5686e6=_0x25fd27;(_0xb67dff[_0x5686e6(0x16b)]<_0xb67dff['quantity_notConverted']||_0xb67dff[_0x5686e6(0x138)]==0x0)&&(console['log'](_0x5686e6(0x167),_0xb67dff),_0x1adde5++);});const _0x251bf5=_0x2ec22b[_0x25fd27(0x104)](_0x589bd2=>_0x589bd2[_0x25fd27(0x15f)]!=='0'&&_0x589bd2['quantity']!==''),_0x989acf=new sales({'invoice':_0x1995ce,'customer':_0x4c67b6[_0x25fd27(0x13f)][_0x25fd27(0xf3)],'date':_0x56418d,'warehouse_name':_0xdb98c,'sale_product':_0x251bf5,'note':_0x5ed049,'room':_0x4929d6,'primary_code':_0x34684b,'secondary_code':_0x4f60c4,'prod_code':_0x5311a3,'SCRN':_0x3e79ee}),_0x53e516=await _0x989acf['save']();_0x4c67b6[_0x25fd27(0x13c)](_0x25fd27(0x156),_0x25fd27(0x107)),_0x220466[_0x25fd27(0x137)]('/all_sales/preview/'+_0x53e516[_0x25fd27(0x11c)]);}catch(_0x33b8ca){console[_0x25fd27(0x96)](_0x33b8ca);}}),router['get'](a0_0x547146(0xe4),auth,async(_0x4fbcce,_0x5abd64)=>{var _0x331bf9=a0_0x547146;try{const {username:_0x41317d,email:_0x8952f2,role:_0x2cdc4b}=_0x4fbcce[_0x331bf9(0x164)],_0x3ff367=_0x4fbcce[_0x331bf9(0x164)],_0x773ae7=await profile['findOne']({'email':_0x3ff367[_0x331bf9(0x166)]}),_0x4ce0d2=await master_shop[_0x331bf9(0x14b)](),_0x3c88ed=_0x4fbcce[_0x331bf9(0x14c)]['id'],_0x21e189=await sales[_0x331bf9(0xe3)](_0x3c88ed),_0x3e54f2=await warehouse[_0x331bf9(0xa6)]([{'$match':{'name':_0x21e189[_0x331bf9(0x16c)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x331bf9(0xf4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x331bf9(0xf2)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x331bf9(0xab)},'type':{'$first':_0x331bf9(0xdb)},'floorlevel':{'$first':_0x331bf9(0x170)},'primary_code':{'$first':_0x331bf9(0x90)},'secondary_code':{'$first':_0x331bf9(0x161)},'product_code':{'$first':_0x331bf9(0xfb)},'storage':{'$first':_0x331bf9(0xef)},'rack':{'$first':_0x331bf9(0x17a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x331bf9(0x179)},'invoice':{'$first':_0x331bf9(0x118)}}}]),_0x4f6525=await customer[_0x331bf9(0x14b)]({});let _0x2edf14;if(_0x3ff367[_0x331bf9(0xfc)]=='staff'){const _0x11328d=await staff[_0x331bf9(0xcc)]({'email':_0x3ff367[_0x331bf9(0x166)]});_0x2edf14=await warehouse[_0x331bf9(0xa6)]([{'$match':{'status':_0x331bf9(0x88),'name':_0x11328d['warehouse']}},{'$group':{'_id':_0x331bf9(0x113),'name':{'$first':_0x331bf9(0x113)}}}]);}else _0x2edf14=await warehouse[_0x331bf9(0xa6)]([{'$match':{'status':_0x331bf9(0x88)}},{'$group':{'_id':_0x331bf9(0x113),'name':{'$first':_0x331bf9(0x113)}}}]);const _0x1c2dc6=await product[_0x331bf9(0x14b)]({}),_0x4033c6=await suppliers['find']({});if(_0x4ce0d2[0x0]['language']==_0x331bf9(0xd3)){var _0x1a2856=users[_0x331bf9(0xf1)];console['log'](_0x1a2856);}else{if(_0x4ce0d2[0x0]['language']==_0x331bf9(0x122))var _0x1a2856=users['Hindi'];else{if(_0x4ce0d2[0x0]['language']=='German')var _0x1a2856=users[_0x331bf9(0xb0)];else{if(_0x4ce0d2[0x0][_0x331bf9(0xdf)]==_0x331bf9(0xb5))var _0x1a2856=users['Spanish'];else{if(_0x4ce0d2[0x0][_0x331bf9(0xdf)]==_0x331bf9(0x184))var _0x1a2856=users[_0x331bf9(0x184)];else{if(_0x4ce0d2[0x0][_0x331bf9(0xdf)]==_0x331bf9(0x145))var _0x1a2856=users[_0x331bf9(0x9c)];else{if(_0x4ce0d2[0x0]['language']==_0x331bf9(0x9b))var _0x1a2856=users[_0x331bf9(0x9b)];else{if(_0x4ce0d2[0x0][_0x331bf9(0xdf)]=='Arabic\x20(ae)')var _0x1a2856=users['Arabic'];}}}}}}}_0x5abd64[_0x331bf9(0x99)](_0x331bf9(0x112),{'success':_0x4fbcce[_0x331bf9(0x13c)]('success'),'errors':_0x4fbcce[_0x331bf9(0x13c)]('errors'),'role':_0x3ff367,'profile':_0x773ae7,'customer':_0x4f6525,'warehouse':_0x2edf14,'product':_0x3e54f2,'user':_0x21e189,'master_shop':_0x4ce0d2,'unit':_0x1c2dc6,'language':_0x1a2856,'suppliers':_0x4033c6});}catch(_0x353d79){console['log'](_0x353d79);}}),router[a0_0x547146(0x13e)]('/preview/:id',auth,async(_0x176025,_0x306bdc)=>{var _0x1f3cf1=a0_0x547146;try{const _0x47d3e7=_0x176025[_0x1f3cf1(0x14c)]['id'],{invoice:_0x4b0544,warehouse_name:_0x2df09f,room:_0x18586e}=_0x176025[_0x1f3cf1(0x13f)],_0xc01c24=await sales['findOne']({'invoice':_0x4b0544}),_0x205075=_0xc01c24[_0x1f3cf1(0xae)][_0x1f3cf1(0x190)](async _0x1c05fe=>{var _0x121ebe=_0x1f3cf1,_0x123d8a=await warehouse[_0x121ebe(0xcc)]({'name':_0x2df09f,'room':_0x1c05fe[_0x121ebe(0x86)],'warehouse_category':_0x121ebe(0xde)});const _0x1cacbd=_0x123d8a[_0x121ebe(0xf7)][_0x121ebe(0x190)](_0x459b24=>{var _0x4e9476=_0x121ebe;_0x459b24['product_name']==_0x1c05fe[_0x4e9476(0x102)]&&_0x459b24[_0x4e9476(0xa3)]==_0x1c05fe[_0x4e9476(0xa3)]&&_0x459b24[_0x4e9476(0x182)]==_0x1c05fe['type']&&_0x459b24[_0x4e9476(0x117)]==_0x1c05fe[_0x4e9476(0x117)]&&_0x459b24[_0x4e9476(0x94)]==_0x1c05fe[_0x4e9476(0x94)]&&_0x459b24[_0x4e9476(0xbc)]==_0x1c05fe['rack']&&_0x459b24[_0x4e9476(0x10d)]==_0x1c05fe['storage']&&_0x459b24[_0x4e9476(0xff)]==_0x1c05fe[_0x4e9476(0xff)]&&_0x459b24['batch_code']==_0x1c05fe[_0x4e9476(0xb4)]&&_0x459b24[_0x4e9476(0x11c)]==_0x1c05fe[_0x4e9476(0x8a)]&&(_0x459b24[_0x4e9476(0xa7)]=Math[_0x4e9476(0x149)](0x0,Math[_0x4e9476(0x12e)](_0x459b24['product_stock'])-Math[_0x4e9476(0x12e)](_0x1c05fe[_0x4e9476(0x15f)])));});return _0x123d8a;});Promise['all'](_0x205075)[_0x1f3cf1(0xc3)](async _0x5f046b=>{var _0x48947a=_0x1f3cf1;try{for(const _0xb6c5f4 of _0x5f046b){await _0xb6c5f4['save']();}_0xc01c24[_0x48947a(0xf5)]=_0x48947a(0x177);const _0x1c3eca=await _0xc01c24[_0x48947a(0x154)](),_0x1e0258=await master_shop[_0x48947a(0x14b)](),_0x3e9882=await email_settings[_0x48947a(0xcc)](),_0x377844=await supervisor_settings[_0x48947a(0x14b)]();var _0x2380ea=_0xc01c24['sale_product'],_0x9d6eb3='',_0x23aa40;for(_0x23aa40 in _0x2380ea){_0x9d6eb3+=_0x48947a(0x8c)+_0x48947a(0x8d)+_0x2380ea[_0x23aa40][_0x48947a(0x102)]+'</td>'+_0x48947a(0x8d)+_0x2380ea[_0x23aa40][_0x48947a(0x9e)]+_0x48947a(0x159)+_0x48947a(0x8d)+_0x2380ea[_0x23aa40][_0x48947a(0x15f)]+'</td>'+_0x48947a(0x8d)+_0x2380ea[_0x23aa40]['unit']+_0x48947a(0x159)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2380ea[_0x23aa40][_0x48947a(0x97)]+_0x48947a(0x159)+_0x48947a(0x8d)+_0xc01c24['warehouse_name']+_0x48947a(0x159)+_0x48947a(0x8d)+_0x2380ea[_0x23aa40][_0x48947a(0x86)]+_0x48947a(0x159)+_0x48947a(0x8d)+_0x2380ea[_0x23aa40]['storage']+_0x2380ea[_0x23aa40][_0x48947a(0xbc)]+_0x2380ea[_0x23aa40]['bay']+_0x2380ea[_0x23aa40][_0x48947a(0x117)]+_0x2380ea[_0x23aa40][_0x48947a(0x182)][0x0]+_0x2380ea[_0x23aa40][_0x48947a(0xa3)]+'</td>',_0x48947a(0x85);}let _0x5827a4=nodemailer[_0x48947a(0x186)]({'host':_0x3e9882['host'],'port':Number(_0x3e9882[_0x48947a(0x14d)]),'secure':![],'auth':{'user':_0x3e9882[_0x48947a(0x166)],'pass':_0x3e9882[_0x48947a(0x180)]}}),_0x4a5981={'from':_0x3e9882['email'],'to':_0x377844[0x0][_0x48947a(0x15a)],'subject':_0x48947a(0x12f),'attachments':[{'filename':_0x48947a(0xa5),'path':__dirname+_0x48947a(0x98)+_0x48947a(0x181)+_0x1e0258[0x0][_0x48947a(0x11f)],'cid':_0x48947a(0x116)}],'html':_0x48947a(0x11d)+_0x48947a(0x119)+'</head><body>'+'<div>'+_0x48947a(0x17e)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x48947a(0xc7)+_0x48947a(0x12d)+_0x1e0258[0x0][_0x48947a(0xa2)]+_0x48947a(0x17c)+_0x48947a(0x171)+_0x48947a(0x171)+_0x48947a(0x131)+_0x48947a(0xc7)+_0x48947a(0x13a)+_0x48947a(0x84)+_0xc01c24[_0x48947a(0x12b)]+'\x20'+_0x48947a(0x10b)+_0x48947a(0xfa)+_0xc01c24[_0x48947a(0xd4)]+'\x20'+'</span>'+_0x48947a(0x157)+_0x48947a(0x171)+_0x48947a(0x10a)+_0x48947a(0xf6)+_0x48947a(0x8c)+_0x48947a(0x9f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x48947a(0x108)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x48947a(0xbd)+_0x48947a(0xa0)+_0x48947a(0x89)+_0x48947a(0xc4)+_0x48947a(0x85)+_0x48947a(0xe8)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x9d6eb3+'\x20'+_0x48947a(0x12a)+_0x48947a(0x15e)+_0x48947a(0xc7)+_0x48947a(0x140)+_0x48947a(0xa9)+_0x1e0258[0x0]['site_title']+_0x48947a(0x157)+_0x48947a(0x171)+'</div>'+_0x48947a(0x160)};_0x5827a4['sendMail'](_0x4a5981,function(_0x50bcfe,_0x25cb26){var _0x32d3cb=_0x48947a;_0x50bcfe?(console[_0x32d3cb(0x96)](_0x50bcfe),console[_0x32d3cb(0x96)]('Error\x20Occurs')):console['log'](_0x32d3cb(0xcd));}),_0x176025[_0x48947a(0x13c)](_0x48947a(0x156),_0x48947a(0xd6)),_0x306bdc[_0x48947a(0x137)](_0x48947a(0xc8)+_0x47d3e7);}catch(_0x430f00){console[_0x48947a(0xd1)](_0x430f00),_0x306bdc[_0x48947a(0x15d)](0x1f4)[_0x48947a(0xa4)]({'error':_0x48947a(0x183)});}})[_0x1f3cf1(0xe6)](_0xdde037=>{var _0x416f09=_0x1f3cf1;console[_0x416f09(0xd1)](_0xdde037),_0x306bdc[_0x416f09(0x15d)](0x1f4)[_0x416f09(0xa4)]({'error':_0x416f09(0xe5)});});}catch(_0x55f214){console[_0x1f3cf1(0x96)](_0x55f214);}}),router[a0_0x547146(0x121)]('/view/:id',auth,async(_0x39b872,_0x30b098)=>{var _0xa6d39f=a0_0x547146;try{const {username:_0x5e6ff8,email:_0x1c88cd,role:_0x5ad31c}=_0x39b872['user'],_0x294472=_0x39b872[_0xa6d39f(0x164)],_0x52f589=await profile[_0xa6d39f(0xcc)]({'email':_0x294472[_0xa6d39f(0x166)]}),_0x51ffa5=await master_shop[_0xa6d39f(0x14b)](),_0x1f1971=_0x39b872['params']['id'],_0x4d5fea=await sales[_0xa6d39f(0xe3)](_0x1f1971);var _0xcf77e2=[_0xa6d39f(0x150),_0xa6d39f(0x18a)];const _0x35a049=await warehouse[_0xa6d39f(0xa6)]([{'$match':{'name':_0x4d5fea['warehouse_name'],'warehouse_category':_0xa6d39f(0xde)}},{'$unwind':_0xa6d39f(0x11e)},{'$group':{'_id':_0xa6d39f(0xf4),'name':{'$first':_0xa6d39f(0x9a)},'product_stock':{'$first':_0xa6d39f(0xf2)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xa6d39f(0xdb)},'floorlevel':{'$first':_0xa6d39f(0x170)},'primary_code':{'$first':_0xa6d39f(0x90)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xa6d39f(0xfb)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xa6d39f(0x17a)}}}]),_0xf32dbe=await customer[_0xa6d39f(0x14b)]({});let _0x2b6852;if(_0x294472['role']==_0xa6d39f(0xb9)){const _0x3ca678=await staff[_0xa6d39f(0xcc)]({'email':_0x294472['email']});_0x2b6852=await warehouse[_0xa6d39f(0xa6)]([{'$match':{'status':_0xa6d39f(0x88),'name':_0x3ca678['warehouse'],'warehouse_category':_0xa6d39f(0xde)}},{'$group':{'_id':_0xa6d39f(0x113),'name':{'$first':'$name'}}}]);}else _0x2b6852=await warehouse[_0xa6d39f(0xa6)]([{'$match':{'status':'Enabled','warehouse_category':_0xa6d39f(0xde)}},{'$group':{'_id':'$name','name':{'$first':_0xa6d39f(0x113)}}}]);const _0x5a8d76=await product[_0xa6d39f(0x14b)]({});if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]==_0xa6d39f(0xd3)){var _0x35a1de=users['English'];console['log'](_0x35a1de);}else{if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]==_0xa6d39f(0x122))var _0x35a1de=users[_0xa6d39f(0x122)];else{if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]==_0xa6d39f(0xb0))var _0x35a1de=users[_0xa6d39f(0xb0)];else{if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]==_0xa6d39f(0xb5))var _0x35a1de=users['Spanish'];else{if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]=='French')var _0x35a1de=users['French'];else{if(_0x51ffa5[0x0]['language']=='Portuguese\x20(BR)')var _0x35a1de=users[_0xa6d39f(0x9c)];else{if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]==_0xa6d39f(0x9b))var _0x35a1de=users['Chinese'];else{if(_0x51ffa5[0x0][_0xa6d39f(0xdf)]=='Arabic\x20(ae)')var _0x35a1de=users[_0xa6d39f(0xd9)];}}}}}}}_0x30b098['render'](_0xa6d39f(0xb1),{'success':_0x39b872[_0xa6d39f(0x13c)](_0xa6d39f(0x156)),'errors':_0x39b872[_0xa6d39f(0x13c)](_0xa6d39f(0x10c)),'role':_0x294472,'profile':_0x52f589,'customer':_0xf32dbe,'warehouse':_0x2b6852,'product':_0x35a049,'user':_0x4d5fea,'master_shop':_0x51ffa5,'unit':_0x5a8d76,'language':_0x35a1de});}catch(_0x43e8aa){console['log'](_0x43e8aa);}}),router[a0_0x547146(0x13e)](a0_0x547146(0x144),auth,async(_0x25101c,_0x45e6ee)=>{var _0x22913e=a0_0x547146;try{const _0x538bc5=_0x25101c['params']['id'],_0x28e81f=await sales[_0x22913e(0xcc)]({'_id':_0x25101c[_0x22913e(0x14c)]['id']}),_0x536515=await warehouse[_0x22913e(0xcc)]({'name':_0x28e81f[_0x22913e(0x16c)],'room':_0x25101c[_0x22913e(0x13f)]['room']}),{invoice:_0x39eebc,date:_0x177dc5,warehouse_name:_0x45e89f,product_name:_0x1b86f5,stock:_0x53be34,quantity:_0x2551cd,note:_0x6372d4,room:_0x134c68,customer:_0x12ddf5,SCRN:_0x1a0f79}=_0x25101c[_0x22913e(0x13f)];if(typeof _0x1b86f5==_0x22913e(0x12c))var _0x41f49f=[_0x25101c[_0x22913e(0x13f)]['product_name']],_0x41cf45=[_0x25101c[_0x22913e(0x13f)]['stock']],_0x1584c7=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x133)]],_0x217832=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x13b)]],_0x146c50=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x124)]],_0x23fcba=[_0x25101c[_0x22913e(0x13f)]['prod_code']],_0x2e5b42=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x114)]],_0x5ac55f=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0xbf)]],_0x2ada26=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x97)]],_0x4b868d=[_0x25101c['body'][_0x22913e(0xb4)]],_0x31ff5a=[_0x25101c['body']['expiry_date']],_0xdf0d21=[_0x25101c['body'][_0x22913e(0x172)]],_0x372b75=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0xdd)]],_0x35cb49=[_0x25101c[_0x22913e(0x13f)]['requested_qty']],_0x11f398=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0xc0)]],_0x1e94a0=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x155)]],_0x522ddc=[_0x25101c['body'][_0x22913e(0xd2)]],_0x4da9e0=[_0x25101c[_0x22913e(0x13f)][_0x22913e(0x15f)]],_0x581a34=[_0x25101c['body']['RoomAssigned']];else var _0x41f49f=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x102)]],_0x41cf45=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x16b)]],_0x1584c7=[..._0x25101c[_0x22913e(0x13f)]['carton']],_0x217832=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x13b)]],_0x146c50=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x124)]],_0x23fcba=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x188)]],_0x2e5b42=[..._0x25101c[_0x22913e(0x13f)]['level']],_0x5ac55f=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0xbf)]],_0x2ada26=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x97)]],_0x4b868d=[..._0x25101c['body'][_0x22913e(0xb4)]],_0x31ff5a=[..._0x25101c[_0x22913e(0x13f)]['expiry_date']],_0xdf0d21=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x172)]],_0x372b75=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0xdd)]],_0x35cb49=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0xcb)]],_0x11f398=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0xc0)]],_0x1e94a0=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x155)]],_0x522ddc=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0xd2)]],_0x4da9e0=[..._0x25101c[_0x22913e(0x13f)]['quantity']],_0x581a34=[..._0x25101c[_0x22913e(0x13f)][_0x22913e(0x10e)]];const _0x161f50=_0x41f49f[_0x22913e(0x190)](_0x185cd5=>{return _0x185cd5={'product_name':_0x185cd5};});_0x41cf45[_0x22913e(0xd5)]((_0x19963f,_0x4de5fb)=>{var _0x3d275b=_0x22913e;_0x161f50[_0x4de5fb][_0x3d275b(0x16b)]=Math[_0x3d275b(0x12e)](_0x19963f);}),_0x1584c7[_0x22913e(0xd5)]((_0x3f460a,_0x4df732)=>{var _0xa1a59=_0x22913e;_0x161f50[_0x4df732][_0xa1a59(0x15f)]=_0x3f460a;}),_0x217832[_0x22913e(0xd5)]((_0x458d53,_0xf6df0)=>{var _0x3adc78=_0x22913e;_0x161f50[_0xf6df0][_0x3adc78(0x13b)]=_0x458d53;}),_0x146c50[_0x22913e(0xd5)]((_0x43107c,_0x55eb8e)=>{var _0x40ce9a=_0x22913e;_0x161f50[_0x55eb8e][_0x40ce9a(0x124)]=_0x43107c;}),_0x23fcba[_0x22913e(0xd5)]((_0x274f66,_0x2762a1)=>{var _0x543ed5=_0x22913e;_0x161f50[_0x2762a1][_0x543ed5(0x9e)]=_0x274f66;}),_0x2e5b42[_0x22913e(0xd5)]((_0x9fad70,_0xc7f7f2)=>{var _0x2fddb7=_0x22913e;_0x581a34[_0x2fddb7(0xd5)]((_0x54ebea,_0x5cb779)=>{var _0x3a7275=_0x2fddb7;if(_0x54ebea=='Receiving\x20Area'&&_0xc7f7f2==_0x5cb779){var _0x35eaff=_0x9fad70[_0x3a7275(0x187)](0x3);_0x161f50[_0xc7f7f2][_0x3a7275(0x10d)]=_0x9fad70[0x0],_0x161f50[_0xc7f7f2][_0x3a7275(0xbc)]=_0x9fad70[0x1],_0x161f50[_0xc7f7f2][_0x3a7275(0x94)]=0x0,_0x161f50[_0xc7f7f2]['bin']=0x0,_0x161f50[_0xc7f7f2]['type']='Floor',_0x161f50[_0xc7f7f2][_0x3a7275(0xa3)]=_0x35eaff;}else{if(_0x54ebea==_0x3a7275(0x16f)&&_0xc7f7f2==_0x5cb779){var _0x35eaff=_0x9fad70['slice'](0x3);_0x161f50[_0xc7f7f2][_0x3a7275(0x10d)]=_0x9fad70[0x0],_0x161f50[_0xc7f7f2][_0x3a7275(0xbc)]=_0x9fad70[0x1],_0x161f50[_0xc7f7f2][_0x3a7275(0x94)]=0x0,_0x161f50[_0xc7f7f2]['bin']=0x0,_0x161f50[_0xc7f7f2][_0x3a7275(0x182)]='Floor',_0x161f50[_0xc7f7f2]['floorlevel']=_0x9fad70[0x5];}else{if(_0xc7f7f2==_0x5cb779){var _0x507144;if(_0x9fad70[0x4]=='L')_0x507144='Level';else _0x9fad70[0x4]=='F'&&(_0x507144=_0x3a7275(0xd7));_0x161f50[_0xc7f7f2]['storage']=_0x9fad70[0x0],_0x161f50[_0xc7f7f2]['rack']=_0x9fad70[0x1],_0x161f50[_0xc7f7f2][_0x3a7275(0x94)]=_0x9fad70[0x2],_0x161f50[_0xc7f7f2]['bin']=_0x9fad70[0x3],_0x161f50[_0xc7f7f2][_0x3a7275(0x182)]=_0x507144,_0x161f50[_0xc7f7f2]['floorlevel']=_0x9fad70[0x5];}}}});}),_0x5ac55f['forEach']((_0x549362,_0xbd0e4e)=>{_0x161f50[_0xbd0e4e]['unit']=_0x549362;}),_0x2ada26['forEach']((_0x999656,_0x3b1d13)=>{_0x161f50[_0x3b1d13]['secondary_unit']=_0x999656;}),_0x4b868d['forEach']((_0x1dcb3c,_0xe7725)=>{var _0x89662b=_0x22913e;_0x161f50[_0xe7725][_0x89662b(0xb4)]=_0x1dcb3c;}),_0x31ff5a[_0x22913e(0xd5)]((_0x4de545,_0x458c0d)=>{var _0x2def66=_0x22913e;_0x161f50[_0x458c0d][_0x2def66(0xff)]=_0x4de545;}),_0xdf0d21[_0x22913e(0xd5)]((_0x5af222,_0x4ece01)=>{var _0x4992f7=_0x22913e;_0x161f50[_0x4ece01][_0x4992f7(0x127)]=_0x5af222;}),_0x372b75[_0x22913e(0xd5)]((_0x25349b,_0x116227)=>{var _0x21f98c=_0x22913e;_0x161f50[_0x116227][_0x21f98c(0xdd)]=_0x25349b;}),_0x35cb49[_0x22913e(0xd5)]((_0x59b47b,_0x18cfd9)=>{var _0x303a4f=_0x22913e;_0x161f50[_0x18cfd9][_0x303a4f(0xcb)]=Math['abs'](_0x59b47b);}),_0x11f398[_0x22913e(0xd5)]((_0x3ee5e4,_0x260cf1)=>{var _0x56bed3=_0x22913e;_0x161f50[_0x260cf1][_0x56bed3(0xc0)]=_0x3ee5e4;}),_0x1e94a0[_0x22913e(0xd5)]((_0x125229,_0x426d4a)=>{_0x161f50[_0x426d4a]['delivery_code']=_0x125229;}),_0x522ddc[_0x22913e(0xd5)]((_0x3466e8,_0x17ed37)=>{var _0x174b6f=_0x22913e;_0x161f50[_0x17ed37][_0x174b6f(0xd2)]=_0x3466e8;}),_0x4da9e0['forEach']((_0x224761,_0x388493)=>{var _0x40a637=_0x22913e;_0x161f50[_0x388493][_0x40a637(0x138)]=_0x224761;}),_0x581a34[_0x22913e(0xd5)]((_0x650850,_0x5b8075)=>{_0x161f50[_0x5b8075]['room_name']=_0x650850;});var _0x5a26e1=0x0;_0x161f50[_0x22913e(0xd5)](_0x1c4478=>{var _0x41645d=_0x22913e;console['log'](_0x41645d(0x167),_0x1c4478),(parseInt(_0x1c4478[_0x41645d(0x16b)])<parseInt(_0x1c4478[_0x41645d(0x15f)])||parseInt(_0x1c4478[_0x41645d(0x15f)])==0x0)&&_0x5a26e1++;});if(_0x5a26e1!=0x0)return _0x25101c[_0x22913e(0x13c)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x45e6ee[_0x22913e(0x137)](_0x22913e(0xcf));const _0x2537e8=_0x161f50[_0x22913e(0x104)](_0x2db257=>_0x2db257[_0x22913e(0x15f)]!=='0'&&_0x2db257[_0x22913e(0x15f)]!=='');_0x28e81f[_0x22913e(0x12b)]=_0x39eebc,_0x28e81f['customer']=_0x12ddf5,_0x28e81f[_0x22913e(0xd4)]=_0x177dc5,_0x28e81f[_0x22913e(0x16c)]=_0x45e89f,_0x28e81f[_0x22913e(0xae)]=_0x2537e8,_0x28e81f[_0x22913e(0xad)]=_0x6372d4,_0x28e81f[_0x22913e(0x17f)]=_0x1a0f79,_0x28e81f[_0x22913e(0xf5)]=_0x22913e(0x8e),_0x28e81f[_0x22913e(0x175)]='False';const _0x25c9b8=await _0x28e81f[_0x22913e(0x154)]();_0x25101c[_0x22913e(0x13c)](_0x22913e(0x156),_0x22913e(0xd6)),_0x45e6ee[_0x22913e(0x137)]('/all_sales/view');}catch(_0x3db750){console['log'](_0x3db750);}}),router['post']('/give_payment/:id',auth,async(_0x19bf5e,_0x130fbf)=>{var _0x91bf3c=a0_0x547146;try{const _0x28459a=_0x19bf5e[_0x91bf3c(0x14c)]['id'],{invoice:_0x27060a,customer:_0x109502,receivable_amount:_0x56cedc,received_amount:_0x435736}=_0x19bf5e[_0x91bf3c(0x13f)],_0x1dd3e4=await sales[_0x91bf3c(0xe3)](_0x28459a);console[_0x91bf3c(0x96)](_0x1dd3e4);var _0xf4869e=_0x56cedc-_0x435736;console['log'](_0x435736),_0x1dd3e4[_0x91bf3c(0x173)]=parseFloat(_0x435736)+parseFloat(_0x1dd3e4['received_amount']),_0x1dd3e4['due_amount']=_0xf4869e,console['log'](_0x1dd3e4);const _0x4f7512=await _0x1dd3e4[_0x91bf3c(0x154)](),_0x2ec347=await c_payment_data[_0x91bf3c(0xcc)]({'invoice':_0x27060a});_0x2ec347[_0x91bf3c(0x9d)]=_0xf4869e,await _0x2ec347[_0x91bf3c(0x154)]();let _0x570f97=new Date(),_0x30e26c=('0'+_0x570f97[_0x91bf3c(0x158)]())['slice'](-0x2),_0x268091=('0'+(_0x570f97['getMonth']()+0x1))[_0x91bf3c(0x187)](-0x2),_0x846b02=_0x570f97['getFullYear'](),_0xfc1e4=_0x846b02+'-'+_0x268091+'-'+_0x30e26c;const _0x5a40cd=new customer_payment({'invoice':_0x27060a,'date':_0x846b02+'-'+_0x268091+'-'+_0x30e26c,'customer':_0x109502,'reason':_0x91bf3c(0x128),'amount':_0x435736}),_0x2be526=await _0x5a40cd['save']();_0x19bf5e[_0x91bf3c(0x13c)](_0x91bf3c(0x156),_0x91bf3c(0xea)),_0x130fbf[_0x91bf3c(0x137)]('/all_sales/view');}catch(_0x539c0b){console['log'](_0x539c0b);}}),router[a0_0x547146(0x121)]('/invoice/:id',auth,async(_0x2536f3,_0x29fe99)=>{var _0x52e2ee=a0_0x547146;try{const {username:_0x347173,email:_0x5d8dc2,role:_0x44027a}=_0x2536f3[_0x52e2ee(0x164)],_0xfb2c54=_0x2536f3[_0x52e2ee(0x164)],_0x340449=await profile[_0x52e2ee(0xcc)]({'email':_0xfb2c54[_0x52e2ee(0x166)]}),_0x44c3c6=await master_shop['find']();console[_0x52e2ee(0x96)](_0x52e2ee(0x106),_0x44c3c6);const _0x589473=_0x2536f3[_0x52e2ee(0x14c)]['id'],_0x359cf2=await sales['findById'](_0x589473);console[_0x52e2ee(0x96)](_0x359cf2);const _0x155cb6=await customer[_0x52e2ee(0xcc)]({'name':_0x359cf2[_0x52e2ee(0xf3)]});console[_0x52e2ee(0x96)](_0x155cb6);if(_0x44c3c6[0x0]['language']==_0x52e2ee(0xd3)){var _0x1583b9=users[_0x52e2ee(0xf1)];console['log'](_0x1583b9);}else{if(_0x44c3c6[0x0][_0x52e2ee(0xdf)]=='Hindi')var _0x1583b9=users[_0x52e2ee(0x122)];else{if(_0x44c3c6[0x0][_0x52e2ee(0xdf)]==_0x52e2ee(0xb0))var _0x1583b9=users[_0x52e2ee(0xb0)];else{if(_0x44c3c6[0x0][_0x52e2ee(0xdf)]==_0x52e2ee(0xb5))var _0x1583b9=users['Spanish'];else{if(_0x44c3c6[0x0][_0x52e2ee(0xdf)]==_0x52e2ee(0x184))var _0x1583b9=users['French'];else{if(_0x44c3c6[0x0][_0x52e2ee(0xdf)]==_0x52e2ee(0x145))var _0x1583b9=users[_0x52e2ee(0x9c)];else{if(_0x44c3c6[0x0][_0x52e2ee(0xdf)]==_0x52e2ee(0x9b))var _0x1583b9=users[_0x52e2ee(0x9b)];else{if(_0x44c3c6[0x0]['language']=='Arabic\x20(ae)')var _0x1583b9=users[_0x52e2ee(0xd9)];}}}}}}}_0x29fe99[_0x52e2ee(0x99)](_0x52e2ee(0x10f),{'success':_0x2536f3[_0x52e2ee(0x13c)](_0x52e2ee(0x156)),'errors':_0x2536f3[_0x52e2ee(0x13c)]('errors'),'role':_0xfb2c54,'profile':_0x340449,'master_shop':_0x44c3c6,'customers':_0x155cb6,'sales':_0x359cf2,'language':_0x1583b9});}catch(_0x45c6e6){console[_0x52e2ee(0x96)](_0x45c6e6);}}),router['get'](a0_0x547146(0x126),auth,async(_0x2a4fad,_0x71e970)=>{var _0x2e6945=a0_0x547146;try{const {username:_0x5b982e,email:_0x30c12e,role:_0x10d718}=_0x2a4fad['user'],_0x4e9764=_0x2a4fad[_0x2e6945(0x164)],_0x261140=await profile[_0x2e6945(0xcc)]({'email':_0x4e9764[_0x2e6945(0x166)]}),_0x360710=await master_shop[_0x2e6945(0x14b)]();console[_0x2e6945(0x96)](_0x2e6945(0x106),_0x360710);const _0x422a75=_0x2a4fad[_0x2e6945(0x14c)]['id'];console[_0x2e6945(0x96)](_0x422a75);const _0x3a1a0a=await sales[_0x2e6945(0xe3)](_0x422a75);console['log']('user_id',_0x3a1a0a);const _0x3cced9=await warehouse[_0x2e6945(0xa6)]([{'$match':{'name':'Return\x20Goods','room':_0x2e6945(0xe7)}},{'$unwind':_0x2e6945(0x11e)},{'$group':{'_id':_0x2e6945(0xf4),'name':{'$first':_0x2e6945(0x9a)},'product_stock':{'$first':_0x2e6945(0xf2)},'level':{'$first':_0x2e6945(0xf8)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x2e6945(0x14a)},'primary_code':{'$first':_0x2e6945(0x90)},'secondary_code':{'$first':_0x2e6945(0x161)},'product_code':{'$first':_0x2e6945(0xfb)}}}]);console[_0x2e6945(0x96)]('stock_data',_0x3cced9);const _0x46fcee=await product[_0x2e6945(0x14b)]({});warehouse_data=await warehouse[_0x2e6945(0xa6)]([{'$match':{'status':_0x2e6945(0x88),'name':_0x2e6945(0x17d),'warehouse_category':_0x2e6945(0xde)}},{'$group':{'_id':_0x2e6945(0x113),'name':{'$first':_0x2e6945(0x113)}}},{'$sort':{'name':0x1}}]);var _0xadb8b8=[_0x2e6945(0xe7)];if(_0x360710[0x0][_0x2e6945(0xdf)]=='English\x20(US)'){var _0x3d2ec3=users[_0x2e6945(0xf1)];console['log'](_0x3d2ec3);}else{if(_0x360710[0x0][_0x2e6945(0xdf)]==_0x2e6945(0x122))var _0x3d2ec3=users['Hindi'];else{if(_0x360710[0x0][_0x2e6945(0xdf)]==_0x2e6945(0xb0))var _0x3d2ec3=users['German'];else{if(_0x360710[0x0]['language']=='Spanish')var _0x3d2ec3=users[_0x2e6945(0xb5)];else{if(_0x360710[0x0][_0x2e6945(0xdf)]==_0x2e6945(0x184))var _0x3d2ec3=users['French'];else{if(_0x360710[0x0][_0x2e6945(0xdf)]=='Portuguese\x20(BR)')var _0x3d2ec3=users['Portuguese'];else{if(_0x360710[0x0][_0x2e6945(0xdf)]=='Chinese')var _0x3d2ec3=users[_0x2e6945(0x9b)];else{if(_0x360710[0x0][_0x2e6945(0xdf)]=='Arabic\x20(ae)')var _0x3d2ec3=users['Arabic'];}}}}}}}_0x71e970[_0x2e6945(0x99)](_0x2e6945(0xeb),{'success':_0x2a4fad[_0x2e6945(0x13c)](_0x2e6945(0x156)),'errors':_0x2a4fad[_0x2e6945(0x13c)](_0x2e6945(0x10c)),'role':_0x4e9764,'profile':_0x261140,'user':_0x3a1a0a,'stock':_0x3cced9,'master_shop':_0x360710,'unit':_0x46fcee,'language':_0x3d2ec3,'warehouses':warehouse_data,'rooms':_0xadb8b8});}catch(_0x91b116){console['log'](_0x91b116),_0x71e970[_0x2e6945(0x15d)](0xc8)[_0x2e6945(0xa4)]({'message':_0x91b116['message']});}}),router['post'](a0_0x547146(0x126),auth,async(_0x5b214e,_0x3fe177)=>{var _0x52deb4=a0_0x547146;try{const {invoice:_0x5193cc,date:_0x36bd10,warehouse_name:_0x53045b,product_name:_0x448d02,primary_code:_0x18e451,secondary_code:_0xa6c07a,product_code:_0x2d0fc7,sales_quantity:_0x2b172d,stocks:_0x1af8b5,return_qty:_0xe2dc30,Room_name:_0x475259,to_warehouse_name:_0x21ed8e,to_Roomname:_0x3a8d86,to_Room_name:_0x3abaae,note:_0x29a289,level:_0x5c7030,isle:_0x3a7619,pallet:_0x1aeb7b}=_0x5b214e[_0x52deb4(0x13f)];if(typeof _0x448d02==_0x52deb4(0x12c))var _0x4dcc53=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x102)]],_0x3a832a=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x13b)]],_0x3bcbed=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x124)]],_0x3ec67f=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x9e)]],_0x1e1c41=[_0x5b214e['body'][_0x52deb4(0x18e)]],_0x41626d=[_0x5b214e[_0x52deb4(0x13f)]['stocks']],_0x4576d8=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x143)]],_0x1af196=[_0x5b214e[_0x52deb4(0x13f)]['bay']],_0x17e031=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x117)]],_0x2fa165=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x95)]],_0x2aa3f2=[_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0xa3)]];else var _0x4dcc53=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x102)]],_0x3a832a=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x13b)]],_0x3bcbed=[..._0x5b214e['body'][_0x52deb4(0x124)]],_0x3ec67f=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x9e)]],_0x1e1c41=[..._0x5b214e['body'][_0x52deb4(0x18e)]],_0x41626d=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x162)]],_0x4576d8=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x143)]],_0x1af196=[..._0x5b214e['body'][_0x52deb4(0x94)]],_0x17e031=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x117)]],_0x2fa165=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0x95)]],_0x2aa3f2=[..._0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0xa3)]];const _0x1ea2e2=_0x4dcc53['map'](_0x18d498=>{return _0x18d498={'product_name':_0x18d498};});_0x3a832a['forEach']((_0x2aa905,_0x235315)=>{var _0x43682b=_0x52deb4;_0x1ea2e2[_0x235315][_0x43682b(0x13b)]=_0x2aa905;}),_0x3bcbed[_0x52deb4(0xd5)]((_0x20ce5d,_0x45bf2e)=>{_0x1ea2e2[_0x45bf2e]['secondary_code']=_0x20ce5d;}),_0x3ec67f['forEach']((_0x4e3748,_0x52c762)=>{var _0x4f68ee=_0x52deb4;_0x1ea2e2[_0x52c762][_0x4f68ee(0x9e)]=_0x4e3748;}),_0x1e1c41['forEach']((_0x288a86,_0x256658)=>{_0x1ea2e2[_0x256658]['sale_qty']=_0x288a86;}),_0x41626d[_0x52deb4(0xd5)]((_0x49c608,_0x24db93)=>{_0x1ea2e2[_0x24db93]['stock']=_0x49c608;}),_0x4576d8[_0x52deb4(0xd5)]((_0x312f2a,_0x470bde)=>{var _0x10a1be=_0x52deb4;_0x1ea2e2[_0x470bde][_0x10a1be(0x143)]=_0x312f2a;}),_0x1af196[_0x52deb4(0xd5)]((_0x4f4137,_0x2a62ef)=>{var _0x5896c7=_0x52deb4;_0x1ea2e2[_0x2a62ef][_0x5896c7(0x94)]=_0x4f4137;}),_0x17e031[_0x52deb4(0xd5)]((_0xf3603,_0x313710)=>{var _0x10f2f5=_0x52deb4;_0x1ea2e2[_0x313710][_0x10f2f5(0x117)]=_0xf3603;}),_0x2fa165[_0x52deb4(0xd5)]((_0x4fccfa,_0x424a62)=>{var _0x481382=_0x52deb4;_0x1ea2e2[_0x424a62][_0x481382(0x182)]=_0x4fccfa;}),_0x2aa3f2['forEach']((_0x8684d0,_0x3ea797)=>{_0x1ea2e2[_0x3ea797]['floorlevel']=_0x8684d0;});var _0x494073=0x0;_0x1ea2e2[_0x52deb4(0xd5)](_0x5228b4=>{var _0x51ce52=_0x52deb4;console['log'](_0x51ce52(0x167),_0x5228b4),(parseInt(_0x5228b4['sale_qty'])<parseInt(_0x5228b4['return_qty'])||parseInt(_0x5228b4[_0x51ce52(0x16b)])<parseInt(_0x5228b4['return_qty'])&&parseInt(_0x5228b4['sale_qty'])>parseInt(_0x5228b4['return_qty'])||parseInt(_0x5228b4[_0x51ce52(0x143)])==0x0)&&_0x494073++;});if(_0x494073!=0x0)return _0x5b214e[_0x52deb4(0x13c)](_0x52deb4(0x10c),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x3fe177[_0x52deb4(0x137)](_0x52deb4(0xcf));const _0x2789c6=await sales['findOne']({'invoice':_0x5193cc});console['log'](_0x2789c6),_0x2789c6[_0x52deb4(0xb3)]=_0x52deb4(0x177);const _0x537efd=await _0x2789c6['save'](),_0x1c77ad=new sales_return({'invoice':_0x5193cc,'customer':_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0xf3)],'date':_0x36bd10,'warehouse_name':_0x53045b,'room':_0x475259,'ToWarehouse':_0x21ed8e,'ToRoom':_0x3abaae,'return_sale':_0x1ea2e2,'note':_0x29a289}),_0x36869b=await _0x1c77ad[_0x52deb4(0x154)]();console['log'](_0x1c77ad);const _0x1c00a6=await sales_return[_0x52deb4(0xcc)]({'invoice':_0x5193cc}),_0x20a119=await warehouse[_0x52deb4(0xcc)]({'name':_0x21ed8e,'room':_0x3abaae});_0x1c00a6[_0x52deb4(0xeb)][_0x52deb4(0xd5)](_0x54963c=>{var _0x56259e=_0x52deb4,_0x1cad21=0x0;const _0x3b03d3=_0x20a119['product_details']['map'](_0x3b3c97=>{var _0x7a026=a0_0x46c5;_0x3b3c97['product_name']==_0x54963c[_0x7a026(0x102)]&&_0x3b3c97[_0x7a026(0xa3)]==_0x54963c['floorlevel']&&_0x3b3c97['type']==_0x54963c['type']&&_0x3b3c97[_0x7a026(0x117)]==_0x54963c[_0x7a026(0x117)]&&_0x3b3c97[_0x7a026(0x94)]==_0x54963c[_0x7a026(0x94)]&&(_0x3b3c97[_0x7a026(0xa7)]=parseInt(_0x3b3c97[_0x7a026(0xa7)])+parseInt(_0x54963c[_0x7a026(0x143)]),_0x1cad21++);});_0x1cad21=='0'&&(_0x20a119['product_details']=_0x20a119[_0x56259e(0xf7)]['concat']({'product_name':_0x54963c[_0x56259e(0x102)],'product_stock':_0x54963c[_0x56259e(0x143)],'primary_code':_0x54963c[_0x56259e(0x13b)],'secondary_code':_0x54963c[_0x56259e(0x124)],'product_code':_0x54963c[_0x56259e(0x9e)],'bay':_0x54963c[_0x56259e(0x94)],'bin':_0x54963c[_0x56259e(0x117)],'type':_0x54963c['type'],'floorlevel':_0x54963c[_0x56259e(0xa3)]})),console[_0x56259e(0x96)]('final',_0x20a119);}),await _0x20a119[_0x52deb4(0x154)](),console['log'](_0x5b214e['body']);const _0x44db1a=new c_payment_data({'invoice':_0x5193cc,'customer':_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0xf3)],'reason':'Sale\x20Return'});await _0x44db1a[_0x52deb4(0x154)]();const _0x4df3c3=await master_shop[_0x52deb4(0x14b)]();console[_0x52deb4(0x96)](_0x52deb4(0x136),_0x4df3c3[0x0][_0x52deb4(0x11f)]);const _0x49b408=await email_settings[_0x52deb4(0xcc)](),_0x1b30f7=await customer[_0x52deb4(0xcc)]({'name':_0x5b214e[_0x52deb4(0x13f)][_0x52deb4(0xf3)]});console[_0x52deb4(0x96)](_0x52deb4(0x11a),_0x1b30f7);_0x4df3c3[0x0]['currency_placement']==0x1?(right_currency=_0x4df3c3[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4df3c3[0x0][_0x52deb4(0x103)]);var _0x8fba66=_0x4dcc53,_0x144fe5=_0x4576d8,_0x1c0d7e='',_0x46c6d5;for(_0x46c6d5 in _0x8fba66){_0x1c0d7e+=_0x52deb4(0x8c)+_0x52deb4(0x8d)+_0x8fba66[_0x46c6d5]+_0x52deb4(0x159)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x144fe5[_0x46c6d5]+'</td>'+_0x52deb4(0x85);}console[_0x52deb4(0x96)](_0x52deb4(0xa1),_0x1c0d7e);let _0x16c701=nodemailer[_0x52deb4(0x186)]({'service':_0x52deb4(0xc2),'auth':{'user':_0x49b408[_0x52deb4(0x166)],'pass':_0x49b408[_0x52deb4(0x180)]}}),_0x370b88={'from':_0x49b408['email'],'to':_0x1b30f7['email'],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x52deb4(0xa5),'path':__dirname+_0x52deb4(0x98)+'/upload/'+_0x4df3c3[0x0][_0x52deb4(0x11f)],'cid':_0x52deb4(0x116)}],'html':_0x52deb4(0x11d)+'<html><head><title></title>'+_0x52deb4(0x151)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x52deb4(0xc7)+_0x52deb4(0x120)+'</div>'+_0x52deb4(0xc7)+_0x52deb4(0x12d)+_0x4df3c3[0x0]['site_title']+_0x52deb4(0x17c)+'</div>'+_0x52deb4(0x171)+_0x52deb4(0x131)+_0x52deb4(0xc7)+_0x52deb4(0x13a)+'\x20Order\x20Number\x20:\x20'+_0x5193cc+'\x20'+_0x52deb4(0x10b)+'\x20Order\x20Date\x20:\x20'+_0x36bd10+'\x20'+_0x52deb4(0xe2)+_0x52deb4(0x157)+_0x52deb4(0x171)+_0x52deb4(0x10a)+_0x52deb4(0xf6)+'<tr>'+_0x52deb4(0x9f)+_0x52deb4(0xca)+_0x52deb4(0xb2)+_0x52deb4(0x15b)+_0x52deb4(0x85)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1c0d7e+'\x20'+_0x52deb4(0x12a)+_0x52deb4(0x15e)+_0x52deb4(0xc7)+_0x52deb4(0x140)+'<h5>'+_0x4df3c3[0x0]['site_title']+'</h5>'+_0x52deb4(0x171)+_0x52deb4(0x171)+'</body></html>'};_0x16c701[_0x52deb4(0x176)](_0x370b88,function(_0x3f23c9,_0xd4e770){var _0x5793e1=_0x52deb4;_0x3f23c9?(console[_0x5793e1(0x96)](_0x3f23c9),console['log'](_0x5793e1(0xed))):console['log'](_0x5793e1(0xcd));}),_0x5b214e[_0x52deb4(0x13c)](_0x52deb4(0x156),_0x52deb4(0x101)),_0x3fe177['redirect'](_0x52deb4(0x16d));}catch(_0x4b55fa){console[_0x52deb4(0x96)](_0x4b55fa),_0x3fe177[_0x52deb4(0x15d)](0xc8)[_0x52deb4(0xa4)]({'message1':_0x4b55fa[_0x52deb4(0x18d)]});}}),router[a0_0x547146(0x121)](a0_0x547146(0x91),auth,async(_0x384bf2,_0x425715)=>{var _0x1a92e9=a0_0x547146;try{const {username:_0x165e5a,email:_0x54e3f4,role:_0x16b349}=_0x384bf2['user'],_0x47ea1a=_0x384bf2['user'],_0x4b05b5=await profile[_0x1a92e9(0xcc)]({'email':_0x47ea1a[_0x1a92e9(0x166)]}),_0x364aa7=await master_shop[_0x1a92e9(0x14b)]();console[_0x1a92e9(0x96)](_0x1a92e9(0xec),_0x364aa7);const _0x38e5ce=_0x384bf2[_0x1a92e9(0x14c)]['id'],_0x5bab7a=await sales[_0x1a92e9(0xe3)](_0x38e5ce);console[_0x1a92e9(0x96)](_0x1a92e9(0xb6),_0x5bab7a);if(_0x364aa7[0x0][_0x1a92e9(0xdf)]=='English\x20(US)')var _0x518e3f=users[_0x1a92e9(0xf1)];else{if(_0x364aa7[0x0][_0x1a92e9(0xdf)]=='Hindi')var _0x518e3f=users[_0x1a92e9(0x122)];else{if(_0x364aa7[0x0][_0x1a92e9(0xdf)]==_0x1a92e9(0xb0))var _0x518e3f=users[_0x1a92e9(0xb0)];else{if(_0x364aa7[0x0][_0x1a92e9(0xdf)]==_0x1a92e9(0xb5))var _0x518e3f=users[_0x1a92e9(0xb5)];else{if(_0x364aa7[0x0]['language']=='French')var _0x518e3f=users[_0x1a92e9(0x184)];else{if(_0x364aa7[0x0][_0x1a92e9(0xdf)]==_0x1a92e9(0x145))var _0x518e3f=users[_0x1a92e9(0x9c)];else{if(_0x364aa7[0x0][_0x1a92e9(0xdf)]==_0x1a92e9(0x9b))var _0x518e3f=users[_0x1a92e9(0x9b)];else{if(_0x364aa7[0x0][_0x1a92e9(0xdf)]==_0x1a92e9(0x178))var _0x518e3f=users[_0x1a92e9(0xd9)];}}}}}}}_0x425715[_0x1a92e9(0x99)](_0x1a92e9(0x18f),{'success':_0x384bf2['flash'](_0x1a92e9(0x156)),'errors':_0x384bf2[_0x1a92e9(0x13c)](_0x1a92e9(0x10c)),'role':_0x47ea1a,'profile':_0x4b05b5,'alldata':_0x5bab7a,'master_shop':_0x364aa7,'language':_0x518e3f});}catch(_0xb2491d){console[_0x1a92e9(0x96)](_0xb2491d);}}),router[a0_0x547146(0x13e)](a0_0x547146(0x141),async(_0x25f12d,_0x389338)=>{var _0x574238=a0_0x547146;const {product_code:_0x36f80c,warehouse_name:_0x5c210a,rooms_data:_0x25af48,Roomslist:_0x4240e8}=_0x25f12d[_0x574238(0x13f)],_0x5dd195=_0x4240e8[_0x574238(0x185)](','),_0x326fcb=[];async function _0x207167(_0x3d4c90){var _0x2c0417=_0x574238;const _0x5c7e82=await warehouse[_0x2c0417(0xa6)]([{'$match':{'name':_0x5c210a,'room':_0x3d4c90}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x36f80c}},{'$group':{'_id':_0x2c0417(0xf4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2c0417(0xf2)},'primary_code':{'$first':_0x2c0417(0x90)},'secondary_code':{'$first':_0x2c0417(0x161)},'product_code':{'$first':_0x2c0417(0xfb)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2c0417(0xab)},'type':{'$first':_0x2c0417(0xdb)},'pallet':{'$first':_0x2c0417(0x170)},'unit':{'$first':_0x2c0417(0x8b)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2c0417(0x17a)},'expiry_date':{'$first':_0x2c0417(0x18b)},'production_date':{'$first':_0x2c0417(0x179)},'maxPerUnit':{'$first':_0x2c0417(0xba)},'batch_code':{'$first':_0x2c0417(0x189)},'product_cat':{'$first':_0x2c0417(0xb7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2c0417(0xb8)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x2c0417(0xbe)}}}]),_0x311cfe=await warehouse['aggregate']([{'$match':{'name':_0x5c210a,'room':_0x3d4c90}},{'$unwind':_0x2c0417(0x11e)},{'$match':{'product_details.secondary_code':_0x36f80c}},{'$group':{'_id':_0x2c0417(0xf4),'name':{'$first':_0x2c0417(0x9a)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2c0417(0x90)},'secondary_code':{'$first':_0x2c0417(0x161)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2c0417(0x125)},'isle':{'$first':_0x2c0417(0xab)},'type':{'$first':_0x2c0417(0xdb)},'pallet':{'$first':_0x2c0417(0x170)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2c0417(0x146)},'storage':{'$first':_0x2c0417(0xef)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2c0417(0x179)},'maxPerUnit':{'$first':_0x2c0417(0xba)},'batch_code':{'$first':_0x2c0417(0x189)},'product_cat':{'$first':_0x2c0417(0xb7)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2c0417(0xb8)},'invoice':{'$first':_0x2c0417(0x118)}}}]);if(_0x5c7e82[_0x2c0417(0x15c)]>0x0)_0x326fcb[_0x2c0417(0xbb)](_0x5c7e82);else _0x311cfe[_0x2c0417(0x15c)]>0x0&&_0x326fcb[_0x2c0417(0xbb)](_0x311cfe);}const _0x8e5a=_0x5dd195[_0x574238(0x190)](_0x35cabf=>_0x207167(_0x35cabf));await Promise[_0x574238(0x8f)](_0x8e5a),_0x389338[_0x574238(0xa4)](_0x326fcb);}),module[a0_0x547146(0x111)]=router;