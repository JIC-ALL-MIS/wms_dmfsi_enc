var a0_0x1d08f1=a0_0x8aac;function a0_0x8aac(_0x187c90,_0x37ebf8){var _0x3aef7f=a0_0x3aef();return a0_0x8aac=function(_0x8aac1a,_0x56b22d){_0x8aac1a=_0x8aac1a-0x128;var _0x2941b4=_0x3aef7f[_0x8aac1a];return _0x2941b4;},a0_0x8aac(_0x187c90,_0x37ebf8);}(function(_0x17bfc5,_0x24191c){var _0x3053f2=a0_0x8aac,_0xa1e22d=_0x17bfc5();while(!![]){try{var _0x596a08=parseInt(_0x3053f2(0x220))/0x1*(-parseInt(_0x3053f2(0x191))/0x2)+parseInt(_0x3053f2(0x196))/0x3+-parseInt(_0x3053f2(0x1b6))/0x4*(parseInt(_0x3053f2(0x228))/0x5)+parseInt(_0x3053f2(0x161))/0x6*(-parseInt(_0x3053f2(0x1e7))/0x7)+-parseInt(_0x3053f2(0x1de))/0x8*(parseInt(_0x3053f2(0x15a))/0x9)+-parseInt(_0x3053f2(0x138))/0xa+parseInt(_0x3053f2(0x212))/0xb;if(_0x596a08===_0x24191c)break;else _0xa1e22d['push'](_0xa1e22d['shift']());}catch(_0x5639b5){_0xa1e22d['push'](_0xa1e22d['shift']());}}}(a0_0x3aef,0x76e54));function a0_0x3aef(){var _0x3d909c=['$sale_product.bin','Sales\x20Add\x20successfully','id_transaction_from','message','finalize','success','$sale_product.bay','flash','concat','</body></html>','findById','<strong>\x20Regards\x20</strong>','host','quantity_notConverted','date','/../public','$product_details.product_code','barcode\x20user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','body','</tbody>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','return_qty','sale_product','received_amount','log','\x20</h2>','warehouse_name','staff','Return\x20Rooms','$product_details.product_stock','isAllowEdit','password','master','sales\x20item\x20return\x20successfull','12LscWEI','logo','$product_details.product_cat','$date','Enabled','864012GfCpyx','/all_sales/view','RoomAssigned','Error\x20Occurs','$product_details.invoice','Floor','all_sales','filter','stock_data','OUT-','Raw\x20Materials','render','Arabic\x20(ae)','primary_code','site_title','$product_details.type','$warehouse_name','toString','storage','stock','getFullYear','foreach\x20newproduct','$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_code','slice','email','customer_data','primary_unit','$product_details.bin','$product_details.bay','express','36GOBQJU','customer','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','image','level','product_code','port','back','map','edit_sales_view','<h2>\x20','room_name','post','product_details','</tr>','../middleware/auth','all_sales_barcode','sendMail','English\x20(US)','$return_data','\x20Order\x20Date\x20:\x20','\x20Order\x20Number\x20:\x20','Spanish','due_amount','$product_details.rack','$product_details.isle','/view/add_sales/:id','$product_details.product_name','product_list','actual_uom','Receiving\x20Area','expiry_date','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','False','amount','/view/return_sales/:id','$_id','/view/add_sales','2838376BQGYnw','$product_details.secondary_unit','forEach','invoice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.quantity','types','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','112tfqjBq','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','user_id','Level','$product_details.primary_code','params','findOne','id_transact','$name','Return\x20Goods','getDate','$product_details.batch_code','sales_invoice','$sale_product.floorlevel','/preview/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','gmail','/invoice/:id','role','get','max_per_unit','<!DOCTYPE\x20html>','Sales\x20Update\x20successfully','Portuguese\x20(BR)','actual_qty','Received\x20Payment\x20For\x20Sale','abs','all','bay','An\x20error\x20occurred.','prod_cat','$product_details.maxPerUnit','product_data','<div>','Email\x20sent\x20successfully','product_name','$product.product_name','<span\x20style=\x22float:\x20right;\x22>','maxperunit','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','production_date','19900980UDXjma','$product_details.expiry_date','English','Router','sales\x20all_data','return_data','$product_details.secondary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','$finalize','customers_docs','redirect','final','True','</div>','71258lrLywX','aggregate','warehouse','find','../models/all_models','padStart','French','createTransport','100795ywAoTF','/barcode/:id','room','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','type','delivery_code','$customer','secondary_unit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','json','Arabic','currency','getMonth','Sales\x20Mail','carton','quantity','$product_details.pallet','$sale_product.type','$product_details.storage','German','</span>','floorlevel','$room','Hindi','Shelves','sale_qty','$product_details.actual_uom','split','<html><head><title></title>','save','Logo.png','product','$product_details.unit','language','3020760zCcEFq','edit_sales','exports','/upload/','/view/:id','status','</table>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$invoice','$customers_docs','delivery_date','Chinese','$sale_product','payment\x20successfull','sales_quantity','batch_code','$product_details.production_date','<tr>','then','return_sale','$product_details._id','customers','</h5>','user','$product','/all_sales/preview/','<h5\x20style=\x22text-align:\x20left;\x22>','name','</td>','bin','<tbody\x20style=\x22text-align:\x20center;\x22>','requested_qty','$product_details','<h5>','9moScqG','../public/language/languages.json','push','rack','_id','prod_invoice','Enclosed','129126KWdqpF','/view/add_sale/product','floor','Portuguese','catch','errors','length','product_stock','secondary_code','unit','<hr\x20class=\x22my-3\x22>','string'];a0_0x3aef=function(){return _0x3d909c;};return a0_0x3aef();}const express=require(a0_0x1d08f1(0x1b5)),app=express(),router=express[a0_0x1d08f1(0x215)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1d08f1(0x224)),auth=require(a0_0x1d08f1(0x1c6)),nodemailer=require('nodemailer'),users=require(a0_0x1d08f1(0x15b));router[a0_0x1d08f1(0x1fa)]('/view',auth,async(_0x3fe0e8,_0xfe17e6)=>{var _0x253df9=a0_0x1d08f1;try{const {username:_0xbad273,email:_0x380266,role:_0x2c8925}=_0x3fe0e8[_0x253df9(0x14f)],_0x4288cd=_0x3fe0e8[_0x253df9(0x14f)],_0x579bcb=await profile[_0x253df9(0x1ed)]({'email':_0x4288cd[_0x253df9(0x1b0)]}),_0x1a2bce=await master_shop[_0x253df9(0x223)]();let _0x485177;if(_0x4288cd[_0x253df9(0x1f9)]==_0x253df9(0x18a)){const _0x5c35a8=await staff['findOne']({'email':_0x4288cd[_0x253df9(0x1b0)]});_0x485177=await sales['aggregate']([{'$lookup':{'from':_0x253df9(0x14d),'localField':_0x253df9(0x1b7),'foreignField':_0x253df9(0x153),'as':_0x253df9(0x21b)}},{'$unwind':'$customers_docs'},{'$unwind':_0x253df9(0x144)},{'$group':{'_id':_0x253df9(0x1dc),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x253df9(0x22f)},'date':{'$first':_0x253df9(0x194)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x253df9(0x144)},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x253df9(0x141)},'total_saleproduct_quantity':{'$sum':_0x253df9(0x1e3)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x253df9(0x23a)},'pallet':{'$addToSet':_0x253df9(0x1f4)},'finalize':{'$first':_0x253df9(0x21a)},'isAllowEdit':{'$first':_0x253df9(0x1b8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x485177=await sales[_0x253df9(0x221)]([{'$lookup':{'from':'customers','localField':_0x253df9(0x1b7),'foreignField':'name','as':_0x253df9(0x21b)}},{'$unwind':_0x253df9(0x141)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x253df9(0x1dc),'invoice':{'$first':_0x253df9(0x140)},'customers':{'$first':_0x253df9(0x22f)},'date':{'$first':_0x253df9(0x194)},'warehouse_name':{'$first':_0x253df9(0x1a6)},'sale_product':{'$push':_0x253df9(0x144)},'note':{'$first':'$note'},'return_data':{'$first':_0x253df9(0x1ca)},'customers_docs':{'$first':_0x253df9(0x141)},'total_saleproduct_quantity':{'$sum':_0x253df9(0x1e3)},'level':{'$addToSet':_0x253df9(0x173)},'isle':{'$addToSet':_0x253df9(0x16d)},'type':{'$addToSet':_0x253df9(0x23a)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x253df9(0x21a)},'isAllowEdit':{'$first':_0x253df9(0x1b8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x253df9(0x187)](_0x253df9(0x216),_0x485177);if(_0x1a2bce[0x0][_0x253df9(0x137)]==_0x253df9(0x1c9)){var _0x27617f=users[_0x253df9(0x214)];console[_0x253df9(0x187)](_0x27617f);}else{if(_0x1a2bce[0x0][_0x253df9(0x137)]=='Hindi')var _0x27617f=users[_0x253df9(0x12d)];else{if(_0x1a2bce[0x0][_0x253df9(0x137)]==_0x253df9(0x129))var _0x27617f=users[_0x253df9(0x129)];else{if(_0x1a2bce[0x0][_0x253df9(0x137)]==_0x253df9(0x1cd))var _0x27617f=users['Spanish'];else{if(_0x1a2bce[0x0][_0x253df9(0x137)]==_0x253df9(0x226))var _0x27617f=users[_0x253df9(0x226)];else{if(_0x1a2bce[0x0]['language']=='Portuguese\x20(BR)')var _0x27617f=users[_0x253df9(0x164)];else{if(_0x1a2bce[0x0][_0x253df9(0x137)]=='Chinese')var _0x27617f=users[_0x253df9(0x143)];else{if(_0x1a2bce[0x0][_0x253df9(0x137)]==_0x253df9(0x1a2))var _0x27617f=users[_0x253df9(0x233)];}}}}}}}_0xfe17e6[_0x253df9(0x1a1)](_0x253df9(0x19c),{'success':_0x3fe0e8[_0x253df9(0x174)](_0x253df9(0x172)),'errors':_0x3fe0e8[_0x253df9(0x174)](_0x253df9(0x166)),'sales':_0x485177,'profile':_0x579bcb,'role':_0x4288cd,'master_shop':_0x1a2bce,'language':_0x27617f});}catch(_0x821824){console[_0x253df9(0x187)](_0x821824);}});async function getRandom8DigitNumber(){var _0x3023ba=a0_0x1d08f1;const _0x31be80=0x989680,_0x4103d9=0x5f5e0ff,_0x3e099f=Math[_0x3023ba(0x163)](Math['random']()*(_0x4103d9-_0x31be80+0x1))+_0x31be80;var _0x2e4030;const _0x460709=await sales[_0x3023ba(0x1ed)]({'invoice':_0x3023ba(0x19f)+_0x3e099f});return _0x460709&&_0x460709['length']>0x0?_0x2e4030='OUT-'+_0x3e099f:_0x2e4030=_0x3023ba(0x19f)+_0x3e099f,_0x2e4030;}router[a0_0x1d08f1(0x1fa)](a0_0x1d08f1(0x1dd),auth,async(_0x1c76b1,_0x12678a)=>{var _0x567c76=a0_0x1d08f1;try{const {username:_0x278b2e,email:_0x2e7c79,role:_0x140ca0}=_0x1c76b1[_0x567c76(0x14f)],_0x16ccae=_0x1c76b1['user'],_0x424fee=await profile[_0x567c76(0x1ed)]({'email':_0x16ccae[_0x567c76(0x1b0)]}),_0x30a2b0=await master_shop[_0x567c76(0x223)](),_0x53ee35=await customer[_0x567c76(0x223)]({});let _0x4a2140;if(_0x16ccae['role']==_0x567c76(0x18a)){const _0x2376f9=await staff[_0x567c76(0x1ed)]({'email':_0x16ccae[_0x567c76(0x1b0)]});_0x4a2140=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2376f9[_0x567c76(0x222)],'warehouse_category':_0x567c76(0x1a0),'name':{'$ne':_0x567c76(0x1f0)}}},{'$group':{'_id':_0x567c76(0x1ef),'name':{'$first':_0x567c76(0x1ef)}}},{'$sort':{'name':0x1}}]);}else _0x4a2140=await warehouse[_0x567c76(0x221)]([{'$match':{'status':'Enabled','warehouse_category':_0x567c76(0x1a0),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x51cfef=await product[_0x567c76(0x223)]({});var _0x8fc211=['Ambient',_0x567c76(0x160)];const _0xb5659c=await sales[_0x567c76(0x223)]({}),_0x151de6=_0xb5659c['length']+0x1,_0x47974e=_0x567c76(0x19f)+_0x151de6[_0x567c76(0x1a7)]()[_0x567c76(0x225)](0x5,'0');if(_0x30a2b0[0x0][_0x567c76(0x137)]==_0x567c76(0x1c9)){var _0xe7ef0a=users[_0x567c76(0x214)];console['log'](_0xe7ef0a);}else{if(_0x30a2b0[0x0][_0x567c76(0x137)]=='Hindi')var _0xe7ef0a=users['Hindi'];else{if(_0x30a2b0[0x0][_0x567c76(0x137)]==_0x567c76(0x129))var _0xe7ef0a=users[_0x567c76(0x129)];else{if(_0x30a2b0[0x0][_0x567c76(0x137)]==_0x567c76(0x1cd))var _0xe7ef0a=users[_0x567c76(0x1cd)];else{if(_0x30a2b0[0x0][_0x567c76(0x137)]==_0x567c76(0x226))var _0xe7ef0a=users[_0x567c76(0x226)];else{if(_0x30a2b0[0x0]['language']=='Portuguese\x20(BR)')var _0xe7ef0a=users['Portuguese'];else{if(_0x30a2b0[0x0][_0x567c76(0x137)]==_0x567c76(0x143))var _0xe7ef0a=users['Chinese'];else{if(_0x30a2b0[0x0]['language']==_0x567c76(0x1a2))var _0xe7ef0a=users[_0x567c76(0x233)];}}}}}}}const _0x4e4810=getRandom8DigitNumber();_0x4e4810[_0x567c76(0x14a)](_0x9fe5dd=>{var _0x404188=_0x567c76;_0x12678a[_0x404188(0x1a1)]('add_sales',{'success':_0x1c76b1['flash']('success'),'errors':_0x1c76b1[_0x404188(0x174)](_0x404188(0x166)),'role':_0x16ccae,'profile':_0x424fee,'customer':_0x53ee35,'warehouse':_0x4a2140,'product':_0x51cfef,'invoice':_0x9fe5dd,'master_shop':_0x30a2b0,'language':_0xe7ef0a,'rooms_data':_0x8fc211});})[_0x567c76(0x165)](_0x266d3a=>{var _0x2d301f=_0x567c76;_0x1c76b1['flash'](_0x2d301f(0x166),_0x2d301f(0x13f)),_0x12678a['redirect'](_0x2d301f(0x197));});}catch(_0xd59db0){console[_0x567c76(0x187)](_0xd59db0);}}),router['get'](a0_0x1d08f1(0x1d1),auth,async(_0x4b2db2,_0x4e2dee)=>{var _0x4c0e54=a0_0x1d08f1;try{const _0x570589=_0x4b2db2[_0x4c0e54(0x1ec)]['id'];console[_0x4c0e54(0x187)](_0x570589);const _0x27226c=await product[_0x4c0e54(0x223)](),_0x385171=await purchases['aggregate']([{'$match':{'warehouse_name':_0x570589}},{'$unwind':_0x4c0e54(0x150)},{'$group':{'_id':_0x4c0e54(0x20b)}}]);console[_0x4c0e54(0x187)](_0x4c0e54(0x22b),_0x385171),_0x4e2dee[_0x4c0e54(0x13d)](0xc8)[_0x4c0e54(0x232)]({'purchases_data':_0x385171,'product_data':_0x27226c});}catch(_0x43e027){console[_0x4c0e54(0x187)](_0x43e027);}}),router[a0_0x1d08f1(0x1c3)](a0_0x1d08f1(0x162),auth,async(_0x45b965,_0x504e61)=>{var _0x9595ca=a0_0x1d08f1;try{const {warehouse_data:_0x4ee40b,product_data:_0x552e48}=_0x45b965[_0x9595ca(0x180)];console[_0x9595ca(0x187)](_0x45b965[_0x9595ca(0x180)][_0x9595ca(0x207)]);;const _0x5594e6=await master_shop[_0x9595ca(0x223)]();console[_0x9595ca(0x187)](_0x9595ca(0x18f),_0x5594e6);const _0x40f981=await product[_0x9595ca(0x1ed)]({'name':_0x552e48});console[_0x9595ca(0x187)](_0x9595ca(0x135),_0x40f981);const _0x960658=await warehouse[_0x9595ca(0x221)]([{'$match':{'name':_0x4ee40b}},{'$unwind':_0x9595ca(0x158)},{'$match':{'product_details.product_name':_0x552e48}},{'$group':{'_id':_0x9595ca(0x1d2),'product_stock':{'$first':_0x9595ca(0x18c)}}}]);console[_0x9595ca(0x187)](_0x9595ca(0x19e),_0x960658),_0x504e61[_0x9595ca(0x13d)](0xc8)[_0x9595ca(0x232)]({'master':_0x5594e6,'new_product':_0x40f981,'stock_data':_0x960658});}catch(_0x5087d8){console[_0x9595ca(0x187)](_0x5087d8);}}),router[a0_0x1d08f1(0x1c3)](a0_0x1d08f1(0x1dd),auth,async(_0x4a9d85,_0x1e7bd1)=>{var _0x1a5329=a0_0x1d08f1;try{const {invoice:_0x41ccd4,date:_0x53848d,warehouse_name:_0xbcacb5,product_name:_0x18d58b,stock:_0x20ecb9,quantity:_0x413810,note:_0x2ae8d7,room:_0x155dd7,primary_code:_0x26d5dd,secondary_code:_0x3a69bf,prod_code:_0x39cef2,level:_0x2f6b1b,isle:_0x2c50a6,pallet:_0x4367e6,batch_code:_0x57201f,SCRN:_0x39c389,expiry_date:_0x68884f}=_0x4a9d85[_0x1a5329(0x180)];if(typeof _0x18d58b=='string')var _0x215975=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x20a)]],_0x5f4ac8=[_0x4a9d85[_0x1a5329(0x180)]['stock']],_0x2a8820=[_0x4a9d85[_0x1a5329(0x180)]['carton']],_0x2206cf=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1a3)]],_0x221345=[_0x4a9d85[_0x1a5329(0x180)]['secondary_code']],_0x3c8f07=[_0x4a9d85[_0x1a5329(0x180)]['prod_code']],_0x174328=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1bb)]],_0x2f0351=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1b2)]],_0x24707d=[_0x4a9d85[_0x1a5329(0x180)]['secondary_unit']],_0x5874e8=[_0x4a9d85['body'][_0x1a5329(0x147)]],_0x49bc8f=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1d6)]],_0xc60321=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1fb)]],_0x19ca4c=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x211)]],_0x9722b3=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x157)]],_0x5618b7=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x142)]],_0x1a7a93=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x22e)]],_0x4691df=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x205)]],_0x29d586=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x238)]],_0x55ef37=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x198)]],_0x46e178=[_0x4a9d85['body'][_0x1a5329(0x15f)]],_0x4a65f6=[_0x4a9d85[_0x1a5329(0x180)]['actual_qty']],_0x3b60b3=[_0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1d4)]],_0x154c64=[_0x4a9d85[_0x1a5329(0x180)]['id_transact']];else var _0x215975=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x20a)]],_0x5f4ac8=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1a9)]],_0x2a8820=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x237)]],_0x2206cf=[..._0x4a9d85[_0x1a5329(0x180)]['primary_code']],_0x221345=[..._0x4a9d85['body']['secondary_code']],_0x3c8f07=[..._0x4a9d85['body'][_0x1a5329(0x1ae)]],_0x174328=[..._0x4a9d85[_0x1a5329(0x180)]['level']],_0x2f0351=[..._0x4a9d85['body'][_0x1a5329(0x1b2)]],_0x24707d=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x230)]],_0x5874e8=[..._0x4a9d85['body']['batch_code']],_0x49bc8f=[..._0x4a9d85['body'][_0x1a5329(0x1d6)]],_0xc60321=[..._0x4a9d85['body'][_0x1a5329(0x1fb)]],_0x19ca4c=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x211)]],_0x9722b3=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x157)]],_0x5618b7=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x142)]],_0x1a7a93=[..._0x4a9d85['body']['delivery_code']],_0x4691df=[..._0x4a9d85['body']['prod_cat']],_0x29d586=[..._0x4a9d85['body'][_0x1a5329(0x238)]],_0x55ef37=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x198)]],_0x46e178=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x15f)]],_0x4a65f6=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1ff)]],_0x3b60b3=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1d4)]],_0x154c64=[..._0x4a9d85[_0x1a5329(0x180)][_0x1a5329(0x1ee)]];const _0x15bf4e=_0x215975[_0x1a5329(0x1bf)](_0x4d0374=>{return _0x4d0374={'product_name':_0x4d0374};});_0x5f4ac8[_0x1a5329(0x1e0)]((_0x46b212,_0x40a036)=>{var _0x7a2c9=_0x1a5329;_0x15bf4e[_0x40a036][_0x7a2c9(0x1a9)]=Math[_0x7a2c9(0x201)](_0x46b212);}),_0x4a65f6['forEach']((_0x2bb04b,_0xc5a45f)=>{var _0x4bf7aa=_0x1a5329;_0x15bf4e[_0xc5a45f][_0x4bf7aa(0x1ff)]=Math['abs'](_0x2bb04b);}),_0x3b60b3[_0x1a5329(0x1e0)]((_0x2063f4,_0x41c429)=>{var _0x19b283=_0x1a5329;_0x15bf4e[_0x41c429][_0x19b283(0x1d4)]=_0x2063f4;}),_0x154c64['forEach']((_0x34c368,_0x18507b)=>{var _0x8eb525=_0x1a5329;_0x15bf4e[_0x18507b][_0x8eb525(0x16f)]=_0x34c368;}),_0x2a8820[_0x1a5329(0x1e0)]((_0x5c7901,_0x20476f)=>{var _0x5e9dac=_0x1a5329;_0x15bf4e[_0x20476f][_0x5e9dac(0x238)]=_0x5c7901;}),_0x2206cf[_0x1a5329(0x1e0)]((_0x2f0f37,_0x313d4f)=>{_0x15bf4e[_0x313d4f]['primary_code']=_0x2f0f37;}),_0x221345['forEach']((_0x27d280,_0x2f5848)=>{var _0x12ead7=_0x1a5329;_0x15bf4e[_0x2f5848][_0x12ead7(0x169)]=_0x27d280;}),_0x3c8f07[_0x1a5329(0x1e0)]((_0x3609a8,_0x2d8517)=>{var _0x384f6a=_0x1a5329;_0x15bf4e[_0x2d8517][_0x384f6a(0x1bc)]=_0x3609a8;}),_0x174328['forEach']((_0x531a28,_0x45e2bf)=>{var _0x241f43=_0x1a5329;_0x55ef37[_0x241f43(0x1e0)]((_0x576904,_0x2030f0)=>{var _0x11fb1d=_0x241f43;if(_0x576904=='Receiving\x20Area'&&_0x45e2bf==_0x2030f0){var _0x12cf01=_0x531a28[_0x11fb1d(0x1af)](0x3);_0x15bf4e[_0x45e2bf][_0x11fb1d(0x1a8)]=_0x531a28[0x0],_0x15bf4e[_0x45e2bf][_0x11fb1d(0x15d)]=_0x531a28[0x1],_0x15bf4e[_0x45e2bf][_0x11fb1d(0x203)]=0x0,_0x15bf4e[_0x45e2bf]['bin']=0x0,_0x15bf4e[_0x45e2bf][_0x11fb1d(0x22d)]=_0x11fb1d(0x19b),_0x15bf4e[_0x45e2bf]['floorlevel']=_0x12cf01;}else{if(_0x576904=='Shelves'&&_0x45e2bf==_0x2030f0){var _0x12cf01=_0x531a28['slice'](0x3);_0x15bf4e[_0x45e2bf][_0x11fb1d(0x1a8)]=_0x531a28[0x0],_0x15bf4e[_0x45e2bf][_0x11fb1d(0x15d)]=_0x531a28[0x1],_0x15bf4e[_0x45e2bf]['bay']=0x0,_0x15bf4e[_0x45e2bf][_0x11fb1d(0x155)]=0x0,_0x15bf4e[_0x45e2bf]['type']=_0x11fb1d(0x19b),_0x15bf4e[_0x45e2bf][_0x11fb1d(0x12b)]=_0x531a28[0x5];}else{if(_0x45e2bf==_0x2030f0){var _0x341dca;if(_0x531a28[0x4]=='L')_0x341dca=_0x11fb1d(0x1ea);else _0x531a28[0x4]=='F'&&(_0x341dca=_0x11fb1d(0x19b));_0x15bf4e[_0x45e2bf][_0x11fb1d(0x1a8)]=_0x531a28[0x0],_0x15bf4e[_0x45e2bf][_0x11fb1d(0x15d)]=_0x531a28[0x1],_0x15bf4e[_0x45e2bf][_0x11fb1d(0x203)]=_0x531a28[0x2],_0x15bf4e[_0x45e2bf][_0x11fb1d(0x155)]=_0x531a28[0x3],_0x15bf4e[_0x45e2bf]['type']=_0x341dca,_0x15bf4e[_0x45e2bf][_0x11fb1d(0x12b)]=_0x531a28[0x5];}}}});}),_0x2f0351[_0x1a5329(0x1e0)]((_0x3bf807,_0x50badd)=>{_0x15bf4e[_0x50badd]['unit']=_0x3bf807;}),_0x24707d[_0x1a5329(0x1e0)]((_0x554d49,_0x246022)=>{var _0x5d4b3f=_0x1a5329;_0x15bf4e[_0x246022][_0x5d4b3f(0x230)]=_0x554d49;}),_0x5874e8[_0x1a5329(0x1e0)]((_0x59d684,_0x478aa9)=>{_0x15bf4e[_0x478aa9]['batch_code']=_0x59d684;}),_0x49bc8f[_0x1a5329(0x1e0)]((_0x15016e,_0x4d3bbc)=>{var _0x4d3781=_0x1a5329;_0x15bf4e[_0x4d3bbc][_0x4d3781(0x1d6)]=_0x15016e;}),_0xc60321['forEach']((_0xf5f3b6,_0x85d957)=>{var _0x10fc7d=_0x1a5329;_0x15bf4e[_0x85d957][_0x10fc7d(0x20d)]=_0xf5f3b6;}),_0x19ca4c[_0x1a5329(0x1e0)]((_0x5b0571,_0xaa94bb)=>{var _0x734e49=_0x1a5329;_0x15bf4e[_0xaa94bb][_0x734e49(0x211)]=_0x5b0571;}),_0x9722b3[_0x1a5329(0x1e0)]((_0x310efd,_0x515942)=>{_0x15bf4e[_0x515942]['requested_qty']=_0x310efd;}),_0x5618b7[_0x1a5329(0x1e0)]((_0x378859,_0x36dc1c)=>{var _0x299f7d=_0x1a5329;_0x15bf4e[_0x36dc1c][_0x299f7d(0x142)]=_0x378859;}),_0x1a7a93[_0x1a5329(0x1e0)]((_0x2d8e6f,_0x2ee80e)=>{var _0x1cfa16=_0x1a5329;_0x15bf4e[_0x2ee80e][_0x1cfa16(0x22e)]=_0x2d8e6f;}),_0x4691df[_0x1a5329(0x1e0)]((_0x3c8ac9,_0xdca3ed)=>{var _0x5078be=_0x1a5329;_0x15bf4e[_0xdca3ed][_0x5078be(0x205)]=_0x3c8ac9;}),_0x29d586[_0x1a5329(0x1e0)]((_0x563c2c,_0x2a36af)=>{var _0x10b9d5=_0x1a5329;_0x15bf4e[_0x2a36af][_0x10b9d5(0x17a)]=_0x563c2c;}),_0x55ef37[_0x1a5329(0x1e0)]((_0x3cf272,_0x106ad5)=>{var _0x48cdf8=_0x1a5329;_0x15bf4e[_0x106ad5][_0x48cdf8(0x1c2)]=_0x3cf272;}),_0x46e178['forEach']((_0x14e8f4,_0x41fe55)=>{_0x15bf4e[_0x41fe55]['invoice']=_0x14e8f4;});var _0x22b0cc=0x0;_0x15bf4e[_0x1a5329(0x1e0)](_0x2415fb=>{var _0x27f56b=_0x1a5329;(_0x2415fb[_0x27f56b(0x1a9)]<_0x2415fb[_0x27f56b(0x17a)]||_0x2415fb[_0x27f56b(0x17a)]==0x0)&&(console[_0x27f56b(0x187)](_0x27f56b(0x1ab),_0x2415fb),_0x22b0cc++);});const _0x54f180=_0x15bf4e[_0x1a5329(0x19d)](_0x16459c=>_0x16459c['quantity']!=='0'&&_0x16459c[_0x1a5329(0x238)]!==''),_0x56caf8=new sales({'invoice':_0x41ccd4,'customer':_0x4a9d85['body'][_0x1a5329(0x1b7)],'date':_0x53848d,'warehouse_name':_0xbcacb5,'sale_product':_0x54f180,'note':_0x2ae8d7,'room':_0x155dd7,'primary_code':_0x26d5dd,'secondary_code':_0x3a69bf,'prod_code':_0x39cef2,'SCRN':_0x39c389}),_0x4f4fbb=await _0x56caf8[_0x1a5329(0x133)]();_0x4a9d85[_0x1a5329(0x174)](_0x1a5329(0x172),_0x1a5329(0x16e)),_0x1e7bd1[_0x1a5329(0x21c)]('/all_sales/preview/'+_0x4f4fbb['_id']);}catch(_0x2f1782){console[_0x1a5329(0x187)](_0x2f1782);}}),router[a0_0x1d08f1(0x1fa)](a0_0x1d08f1(0x1f5),auth,async(_0x39b8b7,_0x1edfd2)=>{var _0x3b493c=a0_0x1d08f1;try{const {username:_0x32e99d,email:_0x4449eb,role:_0x5c9585}=_0x39b8b7['user'],_0x3bdf27=_0x39b8b7[_0x3b493c(0x14f)],_0x37a37e=await profile[_0x3b493c(0x1ed)]({'email':_0x3bdf27[_0x3b493c(0x1b0)]}),_0x5b192e=await master_shop[_0x3b493c(0x223)](),_0x6afdd1=_0x39b8b7[_0x3b493c(0x1ec)]['id'],_0x3c97ce=await sales[_0x3b493c(0x177)](_0x6afdd1),_0x3a0b21=await warehouse['aggregate']([{'$match':{'name':_0x3c97ce['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3b493c(0x14c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b493c(0x18c)},'bay':{'$first':_0x3b493c(0x1b4)},'bin':{'$first':_0x3b493c(0x1b3)},'type':{'$first':_0x3b493c(0x1a5)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3b493c(0x1eb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3b493c(0x17d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3b493c(0x213)},'production_date':{'$first':_0x3b493c(0x148)},'invoice':{'$first':_0x3b493c(0x19a)}}}]),_0x484c8a=await customer[_0x3b493c(0x223)]({});let _0x59b1ea;if(_0x3bdf27[_0x3b493c(0x1f9)]==_0x3b493c(0x18a)){const _0x4821ae=await staff[_0x3b493c(0x1ed)]({'email':_0x3bdf27['email']});_0x59b1ea=await warehouse[_0x3b493c(0x221)]([{'$match':{'status':_0x3b493c(0x195),'name':_0x4821ae[_0x3b493c(0x222)]}},{'$group':{'_id':'$name','name':{'$first':_0x3b493c(0x1ef)}}}]);}else _0x59b1ea=await warehouse[_0x3b493c(0x221)]([{'$match':{'status':_0x3b493c(0x195)}},{'$group':{'_id':'$name','name':{'$first':_0x3b493c(0x1ef)}}}]);const _0xe37c09=await product[_0x3b493c(0x223)]({}),_0x4a761e=await suppliers[_0x3b493c(0x223)]({});if(_0x5b192e[0x0]['language']=='English\x20(US)'){var _0x2df69d=users[_0x3b493c(0x214)];console['log'](_0x2df69d);}else{if(_0x5b192e[0x0][_0x3b493c(0x137)]==_0x3b493c(0x12d))var _0x2df69d=users['Hindi'];else{if(_0x5b192e[0x0]['language']==_0x3b493c(0x129))var _0x2df69d=users[_0x3b493c(0x129)];else{if(_0x5b192e[0x0][_0x3b493c(0x137)]=='Spanish')var _0x2df69d=users[_0x3b493c(0x1cd)];else{if(_0x5b192e[0x0][_0x3b493c(0x137)]==_0x3b493c(0x226))var _0x2df69d=users[_0x3b493c(0x226)];else{if(_0x5b192e[0x0]['language']==_0x3b493c(0x1fe))var _0x2df69d=users[_0x3b493c(0x164)];else{if(_0x5b192e[0x0][_0x3b493c(0x137)]=='Chinese')var _0x2df69d=users[_0x3b493c(0x143)];else{if(_0x5b192e[0x0][_0x3b493c(0x137)]==_0x3b493c(0x1a2))var _0x2df69d=users[_0x3b493c(0x233)];}}}}}}}_0x1edfd2[_0x3b493c(0x1a1)](_0x3b493c(0x1c0),{'success':_0x39b8b7[_0x3b493c(0x174)](_0x3b493c(0x172)),'errors':_0x39b8b7[_0x3b493c(0x174)]('errors'),'role':_0x3bdf27,'profile':_0x37a37e,'customer':_0x484c8a,'warehouse':_0x59b1ea,'product':_0x3a0b21,'user':_0x3c97ce,'master_shop':_0x5b192e,'unit':_0xe37c09,'language':_0x2df69d,'suppliers':_0x4a761e});}catch(_0x2e4993){console[_0x3b493c(0x187)](_0x2e4993);}}),router['post']('/preview/:id',auth,async(_0x3cef78,_0x32122b)=>{var _0x2bc19b=a0_0x1d08f1;try{const _0x3a80a9=_0x3cef78[_0x2bc19b(0x1ec)]['id'],{invoice:_0x49f897,warehouse_name:_0xedf93d,room:_0x3a4cd1}=_0x3cef78[_0x2bc19b(0x180)],_0x52c7dc=await sales['findOne']({'invoice':_0x49f897}),_0x56564c=_0x52c7dc[_0x2bc19b(0x185)]['map'](async _0x1aeff1=>{var _0x542f0c=_0x2bc19b,_0x4f3682=await warehouse[_0x542f0c(0x1ed)]({'name':_0xedf93d,'room':_0x1aeff1[_0x542f0c(0x1c2)],'warehouse_category':_0x542f0c(0x1a0)});const _0x590f02=_0x4f3682[_0x542f0c(0x1c4)]['map'](_0x580bf2=>{var _0x5067fc=_0x542f0c;_0x580bf2[_0x5067fc(0x20a)]==_0x1aeff1[_0x5067fc(0x20a)]&&_0x580bf2[_0x5067fc(0x12b)]==_0x1aeff1[_0x5067fc(0x12b)]&&_0x580bf2['type']==_0x1aeff1[_0x5067fc(0x22d)]&&_0x580bf2[_0x5067fc(0x155)]==_0x1aeff1[_0x5067fc(0x155)]&&_0x580bf2[_0x5067fc(0x203)]==_0x1aeff1[_0x5067fc(0x203)]&&_0x580bf2['rack']==_0x1aeff1[_0x5067fc(0x15d)]&&_0x580bf2[_0x5067fc(0x1a8)]==_0x1aeff1['storage']&&_0x580bf2['expiry_date']==_0x1aeff1[_0x5067fc(0x1d6)]&&_0x580bf2[_0x5067fc(0x147)]==_0x1aeff1[_0x5067fc(0x147)]&&_0x580bf2[_0x5067fc(0x1e1)]==_0x1aeff1['invoice']&&_0x580bf2[_0x5067fc(0x15e)]==_0x1aeff1[_0x5067fc(0x16f)]&&(_0x580bf2[_0x5067fc(0x168)]=Math['max'](0x0,Math[_0x5067fc(0x201)](_0x580bf2[_0x5067fc(0x168)])-Math[_0x5067fc(0x201)](_0x1aeff1[_0x5067fc(0x238)])));});return _0x4f3682;});Promise[_0x2bc19b(0x202)](_0x56564c)[_0x2bc19b(0x14a)](async _0x30993c=>{var _0x12b5e9=_0x2bc19b;try{for(const _0x598a81 of _0x30993c){await _0x598a81[_0x12b5e9(0x133)]();}_0x52c7dc[_0x12b5e9(0x171)]=_0x12b5e9(0x21e);const _0xb496c7=await _0x52c7dc[_0x12b5e9(0x133)](),_0x46d6de=await master_shop[_0x12b5e9(0x223)](),_0x42ec23=await email_settings[_0x12b5e9(0x1ed)](),_0x3917f4=await supervisor_settings[_0x12b5e9(0x223)]();var _0x168648=_0x52c7dc[_0x12b5e9(0x185)],_0x52781e='',_0x304aeb;for(_0x304aeb in _0x168648){_0x52781e+='<tr>'+_0x12b5e9(0x1e8)+_0x168648[_0x304aeb][_0x12b5e9(0x20a)]+_0x12b5e9(0x154)+_0x12b5e9(0x1e8)+_0x168648[_0x304aeb][_0x12b5e9(0x1bc)]+'</td>'+_0x12b5e9(0x1e8)+_0x168648[_0x304aeb][_0x12b5e9(0x238)]+_0x12b5e9(0x154)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x168648[_0x304aeb][_0x12b5e9(0x16a)]+_0x12b5e9(0x154)+_0x12b5e9(0x1e8)+_0x168648[_0x304aeb]['secondary_unit']+_0x12b5e9(0x154)+_0x12b5e9(0x1e8)+_0x52c7dc[_0x12b5e9(0x189)]+_0x12b5e9(0x154)+_0x12b5e9(0x1e8)+_0x168648[_0x304aeb][_0x12b5e9(0x1c2)]+_0x12b5e9(0x154)+_0x12b5e9(0x1e8)+_0x168648[_0x304aeb][_0x12b5e9(0x1a8)]+_0x168648[_0x304aeb]['rack']+_0x168648[_0x304aeb][_0x12b5e9(0x203)]+_0x168648[_0x304aeb]['bin']+_0x168648[_0x304aeb]['type'][0x0]+_0x168648[_0x304aeb][_0x12b5e9(0x12b)]+_0x12b5e9(0x154),_0x12b5e9(0x1c5);}let _0x829f13=nodemailer[_0x12b5e9(0x227)]({'host':_0x42ec23[_0x12b5e9(0x179)],'port':Number(_0x42ec23[_0x12b5e9(0x1bd)]),'secure':![],'auth':{'user':_0x42ec23[_0x12b5e9(0x1b0)],'pass':_0x42ec23[_0x12b5e9(0x18e)]}}),_0x35ea8b={'from':_0x42ec23[_0x12b5e9(0x1b0)],'to':_0x3917f4[0x0]['RMSEmail'],'subject':_0x12b5e9(0x236),'attachments':[{'filename':_0x12b5e9(0x134),'path':__dirname+'/../public'+_0x12b5e9(0x13b)+_0x46d6de[0x0]['image'],'cid':_0x12b5e9(0x192)}],'html':_0x12b5e9(0x1fc)+_0x12b5e9(0x132)+_0x12b5e9(0x20e)+_0x12b5e9(0x208)+_0x12b5e9(0x231)+_0x12b5e9(0x208)+_0x12b5e9(0x1e6)+_0x12b5e9(0x21f)+_0x12b5e9(0x208)+_0x12b5e9(0x1c1)+_0x46d6de[0x0]['site_title']+_0x12b5e9(0x188)+_0x12b5e9(0x21f)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x12b5e9(0x208)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x52c7dc['invoice']+'\x20'+_0x12b5e9(0x20c)+_0x12b5e9(0x1cb)+_0x52c7dc[_0x12b5e9(0x17b)]+'\x20'+_0x12b5e9(0x12a)+_0x12b5e9(0x14e)+_0x12b5e9(0x21f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x12b5e9(0x1e2)+_0x12b5e9(0x149)+_0x12b5e9(0x210)+_0x12b5e9(0x22c)+_0x12b5e9(0x17f)+_0x12b5e9(0x1e5)+_0x12b5e9(0x1b9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x12b5e9(0x20f)+_0x12b5e9(0x1ad)+'</tr>'+'</thead>'+_0x12b5e9(0x156)+'\x20'+_0x52781e+'\x20'+_0x12b5e9(0x181)+'</table>'+_0x12b5e9(0x208)+_0x12b5e9(0x178)+_0x12b5e9(0x159)+_0x46d6de[0x0][_0x12b5e9(0x1a4)]+_0x12b5e9(0x14e)+_0x12b5e9(0x21f)+_0x12b5e9(0x21f)+_0x12b5e9(0x176)};_0x829f13[_0x12b5e9(0x1c8)](_0x35ea8b,function(_0x1625fa,_0x1a054e){var _0x5cb896=_0x12b5e9;_0x1625fa?(console[_0x5cb896(0x187)](_0x1625fa),console['log'](_0x5cb896(0x199))):console[_0x5cb896(0x187)]('Email\x20sent\x20successfully');}),_0x3cef78[_0x12b5e9(0x174)](_0x12b5e9(0x172),_0x12b5e9(0x1fd)),_0x32122b[_0x12b5e9(0x21c)](_0x12b5e9(0x151)+_0x3a80a9);}catch(_0x1d9f96){console['error'](_0x1d9f96),_0x32122b[_0x12b5e9(0x13d)](0x1f4)[_0x12b5e9(0x232)]({'error':_0x12b5e9(0x219)});}})[_0x2bc19b(0x165)](_0x4687e1=>{var _0x4c94f4=_0x2bc19b;console['error'](_0x4687e1),_0x32122b[_0x4c94f4(0x13d)](0x1f4)[_0x4c94f4(0x232)]({'error':_0x4c94f4(0x204)});});}catch(_0x45aca9){console[_0x2bc19b(0x187)](_0x45aca9);}}),router['get']('/view/:id',auth,async(_0x2583bc,_0x499a3b)=>{var _0x2845f8=a0_0x1d08f1;try{const {username:_0x14627a,email:_0x4b8796,role:_0x378018}=_0x2583bc[_0x2845f8(0x14f)],_0x5856ba=_0x2583bc['user'],_0x1f0b6d=await profile['findOne']({'email':_0x5856ba[_0x2845f8(0x1b0)]}),_0x594bed=await master_shop[_0x2845f8(0x223)](),_0x2dd49c=_0x2583bc[_0x2845f8(0x1ec)]['id'],_0x28fba0=await sales[_0x2845f8(0x177)](_0x2dd49c);var _0x4aac4f=['Ambient',_0x2845f8(0x160)];const _0x250996=await warehouse[_0x2845f8(0x221)]([{'$match':{'name':_0x28fba0[_0x2845f8(0x189)],'warehouse_category':_0x2845f8(0x1a0)}},{'$unwind':_0x2845f8(0x158)},{'$group':{'_id':_0x2845f8(0x14c),'name':{'$first':_0x2845f8(0x1d2)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2845f8(0x1b3)},'type':{'$first':_0x2845f8(0x1a5)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2845f8(0x17d)},'storage':{'$first':_0x2845f8(0x128)},'rack':{'$first':_0x2845f8(0x1cf)}}}]),_0x164cb7=await customer['find']({});let _0xf6dec9;if(_0x5856ba[_0x2845f8(0x1f9)]==_0x2845f8(0x18a)){const _0x584a5a=await staff[_0x2845f8(0x1ed)]({'email':_0x5856ba['email']});_0xf6dec9=await warehouse[_0x2845f8(0x221)]([{'$match':{'status':_0x2845f8(0x195),'name':_0x584a5a[_0x2845f8(0x222)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2845f8(0x1ef),'name':{'$first':_0x2845f8(0x1ef)}}}]);}else _0xf6dec9=await warehouse[_0x2845f8(0x221)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2845f8(0x1ef),'name':{'$first':_0x2845f8(0x1ef)}}}]);const _0x398d8c=await product[_0x2845f8(0x223)]({});if(_0x594bed[0x0][_0x2845f8(0x137)]==_0x2845f8(0x1c9)){var _0x321ec0=users[_0x2845f8(0x214)];console[_0x2845f8(0x187)](_0x321ec0);}else{if(_0x594bed[0x0][_0x2845f8(0x137)]==_0x2845f8(0x12d))var _0x321ec0=users['Hindi'];else{if(_0x594bed[0x0][_0x2845f8(0x137)]==_0x2845f8(0x129))var _0x321ec0=users[_0x2845f8(0x129)];else{if(_0x594bed[0x0][_0x2845f8(0x137)]=='Spanish')var _0x321ec0=users['Spanish'];else{if(_0x594bed[0x0][_0x2845f8(0x137)]=='French')var _0x321ec0=users[_0x2845f8(0x226)];else{if(_0x594bed[0x0][_0x2845f8(0x137)]==_0x2845f8(0x1fe))var _0x321ec0=users[_0x2845f8(0x164)];else{if(_0x594bed[0x0][_0x2845f8(0x137)]=='Chinese')var _0x321ec0=users[_0x2845f8(0x143)];else{if(_0x594bed[0x0]['language']==_0x2845f8(0x1a2))var _0x321ec0=users[_0x2845f8(0x233)];}}}}}}}_0x499a3b[_0x2845f8(0x1a1)](_0x2845f8(0x139),{'success':_0x2583bc[_0x2845f8(0x174)](_0x2845f8(0x172)),'errors':_0x2583bc[_0x2845f8(0x174)](_0x2845f8(0x166)),'role':_0x5856ba,'profile':_0x1f0b6d,'customer':_0x164cb7,'warehouse':_0xf6dec9,'product':_0x250996,'user':_0x28fba0,'master_shop':_0x594bed,'unit':_0x398d8c,'language':_0x321ec0});}catch(_0x20b2f3){console['log'](_0x20b2f3);}}),router[a0_0x1d08f1(0x1c3)](a0_0x1d08f1(0x13c),auth,async(_0x5d3f67,_0x2dbce6)=>{var _0x21f496=a0_0x1d08f1;try{const _0x1280d2=_0x5d3f67[_0x21f496(0x1ec)]['id'],_0x3d0b80=await sales[_0x21f496(0x1ed)]({'_id':_0x5d3f67[_0x21f496(0x1ec)]['id']}),_0x43638e=await warehouse['findOne']({'name':_0x3d0b80[_0x21f496(0x189)],'room':_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x22a)]}),{invoice:_0x14dd99,date:_0x47166e,warehouse_name:_0x2c9c1d,product_name:_0x2aca1d,stock:_0x431c00,quantity:_0x22c221,note:_0x4f959e,room:_0x4234cb,customer:_0x27b56c,SCRN:_0x193edb}=_0x5d3f67[_0x21f496(0x180)];if(typeof _0x2aca1d==_0x21f496(0x16c))var _0x58472a=[_0x5d3f67['body'][_0x21f496(0x20a)]],_0xc86988=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1a9)]],_0x1ee991=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x237)]],_0x437e3b=[_0x5d3f67[_0x21f496(0x180)]['primary_code']],_0x3db5bd=[_0x5d3f67[_0x21f496(0x180)]['secondary_code']],_0x3c459e=[_0x5d3f67[_0x21f496(0x180)]['prod_code']],_0xf24f53=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1bb)]],_0x2501d4=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1b2)]],_0x562464=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x230)]],_0x51f68f=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x147)]],_0x3cbd51=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1d6)]],_0x24408f=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1fb)]],_0x30fcea=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x211)]],_0x4e170a=[_0x5d3f67['body'][_0x21f496(0x157)]],_0x479417=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x142)]],_0x1ae8c3=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x22e)]],_0x4a6484=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x205)]],_0x2a68c6=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x238)]],_0x5b7732=[_0x5d3f67[_0x21f496(0x180)][_0x21f496(0x198)]];else var _0x58472a=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x20a)]],_0xc86988=[..._0x5d3f67['body'][_0x21f496(0x1a9)]],_0x1ee991=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x237)]],_0x437e3b=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1a3)]],_0x3db5bd=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x169)]],_0x3c459e=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1ae)]],_0xf24f53=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1bb)]],_0x2501d4=[..._0x5d3f67['body'][_0x21f496(0x1b2)]],_0x562464=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x230)]],_0x51f68f=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x147)]],_0x3cbd51=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1d6)]],_0x24408f=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x1fb)]],_0x30fcea=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x211)]],_0x4e170a=[..._0x5d3f67[_0x21f496(0x180)]['requested_qty']],_0x479417=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x142)]],_0x1ae8c3=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x22e)]],_0x4a6484=[..._0x5d3f67['body']['prod_cat']],_0x2a68c6=[..._0x5d3f67[_0x21f496(0x180)][_0x21f496(0x238)]],_0x5b7732=[..._0x5d3f67[_0x21f496(0x180)]['RoomAssigned']];const _0x548f74=_0x58472a[_0x21f496(0x1bf)](_0x48627e=>{return _0x48627e={'product_name':_0x48627e};});_0xc86988['forEach']((_0x129969,_0x3ef8f6)=>{var _0x845e2a=_0x21f496;_0x548f74[_0x3ef8f6][_0x845e2a(0x1a9)]=Math['abs'](_0x129969);}),_0x1ee991[_0x21f496(0x1e0)]((_0xf5f35d,_0x4dc043)=>{_0x548f74[_0x4dc043]['quantity']=_0xf5f35d;}),_0x437e3b[_0x21f496(0x1e0)]((_0x3ef5c1,_0x5366fe)=>{_0x548f74[_0x5366fe]['primary_code']=_0x3ef5c1;}),_0x3db5bd['forEach']((_0x1f573e,_0x11e684)=>{var _0x320b62=_0x21f496;_0x548f74[_0x11e684][_0x320b62(0x169)]=_0x1f573e;}),_0x3c459e['forEach']((_0x2718a7,_0xe0d40b)=>{var _0x13adca=_0x21f496;_0x548f74[_0xe0d40b][_0x13adca(0x1bc)]=_0x2718a7;}),_0xf24f53['forEach']((_0x147fc1,_0x2094c4)=>{_0x5b7732['forEach']((_0xba1cbe,_0x2d759f)=>{var _0x181545=a0_0x8aac;if(_0xba1cbe==_0x181545(0x1d5)&&_0x2094c4==_0x2d759f){var _0x47cd04=_0x147fc1[_0x181545(0x1af)](0x3);_0x548f74[_0x2094c4][_0x181545(0x1a8)]=_0x147fc1[0x0],_0x548f74[_0x2094c4][_0x181545(0x15d)]=_0x147fc1[0x1],_0x548f74[_0x2094c4]['bay']=0x0,_0x548f74[_0x2094c4][_0x181545(0x155)]=0x0,_0x548f74[_0x2094c4][_0x181545(0x22d)]='Floor',_0x548f74[_0x2094c4][_0x181545(0x12b)]=_0x47cd04;}else{if(_0xba1cbe==_0x181545(0x12e)&&_0x2094c4==_0x2d759f){var _0x47cd04=_0x147fc1[_0x181545(0x1af)](0x3);_0x548f74[_0x2094c4][_0x181545(0x1a8)]=_0x147fc1[0x0],_0x548f74[_0x2094c4]['rack']=_0x147fc1[0x1],_0x548f74[_0x2094c4][_0x181545(0x203)]=0x0,_0x548f74[_0x2094c4][_0x181545(0x155)]=0x0,_0x548f74[_0x2094c4][_0x181545(0x22d)]=_0x181545(0x19b),_0x548f74[_0x2094c4][_0x181545(0x12b)]=_0x147fc1[0x5];}else{if(_0x2094c4==_0x2d759f){var _0xef6e6c;if(_0x147fc1[0x4]=='L')_0xef6e6c=_0x181545(0x1ea);else _0x147fc1[0x4]=='F'&&(_0xef6e6c=_0x181545(0x19b));_0x548f74[_0x2094c4][_0x181545(0x1a8)]=_0x147fc1[0x0],_0x548f74[_0x2094c4]['rack']=_0x147fc1[0x1],_0x548f74[_0x2094c4][_0x181545(0x203)]=_0x147fc1[0x2],_0x548f74[_0x2094c4]['bin']=_0x147fc1[0x3],_0x548f74[_0x2094c4][_0x181545(0x22d)]=_0xef6e6c,_0x548f74[_0x2094c4][_0x181545(0x12b)]=_0x147fc1[0x5];}}}});}),_0x2501d4[_0x21f496(0x1e0)]((_0x502527,_0x5474b9)=>{var _0x468d66=_0x21f496;_0x548f74[_0x5474b9][_0x468d66(0x16a)]=_0x502527;}),_0x562464[_0x21f496(0x1e0)]((_0x12c536,_0xd3840)=>{_0x548f74[_0xd3840]['secondary_unit']=_0x12c536;}),_0x51f68f[_0x21f496(0x1e0)]((_0x326c16,_0x14aa34)=>{_0x548f74[_0x14aa34]['batch_code']=_0x326c16;}),_0x3cbd51['forEach']((_0x13a03c,_0x31f3a8)=>{var _0x2d15fb=_0x21f496;_0x548f74[_0x31f3a8][_0x2d15fb(0x1d6)]=_0x13a03c;}),_0x24408f['forEach']((_0x14febc,_0x4a3ed4)=>{var _0x47ff52=_0x21f496;_0x548f74[_0x4a3ed4][_0x47ff52(0x20d)]=_0x14febc;}),_0x30fcea[_0x21f496(0x1e0)]((_0x539e92,_0x1e69d6)=>{var _0x3b3414=_0x21f496;_0x548f74[_0x1e69d6][_0x3b3414(0x211)]=_0x539e92;}),_0x4e170a[_0x21f496(0x1e0)]((_0x2d1be4,_0x28775e)=>{_0x548f74[_0x28775e]['requested_qty']=Math['abs'](_0x2d1be4);}),_0x479417[_0x21f496(0x1e0)]((_0x4a3dfc,_0x1605c5)=>{var _0x4c476e=_0x21f496;_0x548f74[_0x1605c5][_0x4c476e(0x142)]=_0x4a3dfc;}),_0x1ae8c3['forEach']((_0x53128d,_0x52d767)=>{var _0x10171d=_0x21f496;_0x548f74[_0x52d767][_0x10171d(0x22e)]=_0x53128d;}),_0x4a6484[_0x21f496(0x1e0)]((_0x37b6d5,_0x3d8d75)=>{_0x548f74[_0x3d8d75]['prod_cat']=_0x37b6d5;}),_0x2a68c6[_0x21f496(0x1e0)]((_0x4faf08,_0x3abe56)=>{_0x548f74[_0x3abe56]['quantity_notConverted']=_0x4faf08;}),_0x5b7732['forEach']((_0x2d3711,_0x155068)=>{var _0x36bf02=_0x21f496;_0x548f74[_0x155068][_0x36bf02(0x1c2)]=_0x2d3711;});var _0x306843=0x0;_0x548f74[_0x21f496(0x1e0)](_0x362a89=>{var _0x65b12a=_0x21f496;console[_0x65b12a(0x187)](_0x65b12a(0x1ab),_0x362a89),(parseInt(_0x362a89['stock'])<parseInt(_0x362a89['quantity'])||parseInt(_0x362a89[_0x65b12a(0x238)])==0x0)&&_0x306843++;});if(_0x306843!=0x0)return _0x5d3f67[_0x21f496(0x174)](_0x21f496(0x166),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x2dbce6[_0x21f496(0x21c)](_0x21f496(0x1be));const _0x4ff77d=_0x548f74[_0x21f496(0x19d)](_0xdb96a7=>_0xdb96a7[_0x21f496(0x238)]!=='0'&&_0xdb96a7[_0x21f496(0x238)]!=='');_0x3d0b80[_0x21f496(0x1e1)]=_0x14dd99,_0x3d0b80[_0x21f496(0x1b7)]=_0x27b56c,_0x3d0b80[_0x21f496(0x17b)]=_0x47166e,_0x3d0b80['warehouse_name']=_0x2c9c1d,_0x3d0b80[_0x21f496(0x185)]=_0x4ff77d,_0x3d0b80['note']=_0x4f959e,_0x3d0b80['SCRN']=_0x193edb,_0x3d0b80[_0x21f496(0x171)]=_0x21f496(0x1d9),_0x3d0b80[_0x21f496(0x18d)]=_0x21f496(0x1d9);const _0x3d6271=await _0x3d0b80[_0x21f496(0x133)]();_0x5d3f67[_0x21f496(0x174)](_0x21f496(0x172),_0x21f496(0x1fd)),_0x2dbce6[_0x21f496(0x21c)](_0x21f496(0x197));}catch(_0x1fb127){console[_0x21f496(0x187)](_0x1fb127);}}),router[a0_0x1d08f1(0x1c3)]('/give_payment/:id',auth,async(_0x442d08,_0x3d3bdb)=>{var _0x3e36c2=a0_0x1d08f1;try{const _0x11a0c1=_0x442d08[_0x3e36c2(0x1ec)]['id'],{invoice:_0x51ba2d,customer:_0x6adba7,receivable_amount:_0x28f5d7,received_amount:_0x2050df}=_0x442d08[_0x3e36c2(0x180)],_0x7ee512=await sales[_0x3e36c2(0x177)](_0x11a0c1);console[_0x3e36c2(0x187)](_0x7ee512);var _0x369f06=_0x28f5d7-_0x2050df;console[_0x3e36c2(0x187)](_0x2050df),_0x7ee512[_0x3e36c2(0x186)]=parseFloat(_0x2050df)+parseFloat(_0x7ee512[_0x3e36c2(0x186)]),_0x7ee512[_0x3e36c2(0x1ce)]=_0x369f06,console[_0x3e36c2(0x187)](_0x7ee512);const _0x5dd023=await _0x7ee512[_0x3e36c2(0x133)](),_0x4a3c13=await c_payment_data[_0x3e36c2(0x1ed)]({'invoice':_0x51ba2d});_0x4a3c13[_0x3e36c2(0x1da)]=_0x369f06,await _0x4a3c13[_0x3e36c2(0x133)]();let _0x3e790b=new Date(),_0x5b12ac=('0'+_0x3e790b[_0x3e36c2(0x1f1)]())['slice'](-0x2),_0x168031=('0'+(_0x3e790b[_0x3e36c2(0x235)]()+0x1))[_0x3e36c2(0x1af)](-0x2),_0x21360f=_0x3e790b[_0x3e36c2(0x1aa)](),_0x267cac=_0x21360f+'-'+_0x168031+'-'+_0x5b12ac;const _0x406d58=new customer_payment({'invoice':_0x51ba2d,'date':_0x21360f+'-'+_0x168031+'-'+_0x5b12ac,'customer':_0x6adba7,'reason':_0x3e36c2(0x200),'amount':_0x2050df}),_0x5acfec=await _0x406d58[_0x3e36c2(0x133)]();_0x442d08['flash'](_0x3e36c2(0x172),_0x3e36c2(0x145)),_0x3d3bdb[_0x3e36c2(0x21c)](_0x3e36c2(0x197));}catch(_0x5f4fc5){console[_0x3e36c2(0x187)](_0x5f4fc5);}}),router[a0_0x1d08f1(0x1fa)](a0_0x1d08f1(0x1f8),auth,async(_0x2e40dc,_0x4c3679)=>{var _0x323922=a0_0x1d08f1;try{const {username:_0x56da96,email:_0x5bf64c,role:_0x1d493c}=_0x2e40dc[_0x323922(0x14f)],_0x2abd10=_0x2e40dc[_0x323922(0x14f)],_0x2323f3=await profile[_0x323922(0x1ed)]({'email':_0x2abd10[_0x323922(0x1b0)]}),_0x134549=await master_shop[_0x323922(0x223)]();console[_0x323922(0x187)](_0x323922(0x18f),_0x134549);const _0x333158=_0x2e40dc[_0x323922(0x1ec)]['id'],_0x3caa13=await sales[_0x323922(0x177)](_0x333158);console[_0x323922(0x187)](_0x3caa13);const _0x4e1a10=await customer[_0x323922(0x1ed)]({'name':_0x3caa13[_0x323922(0x1b7)]});console['log'](_0x4e1a10);if(_0x134549[0x0][_0x323922(0x137)]=='English\x20(US)'){var _0x57c9e0=users[_0x323922(0x214)];console['log'](_0x57c9e0);}else{if(_0x134549[0x0]['language']==_0x323922(0x12d))var _0x57c9e0=users[_0x323922(0x12d)];else{if(_0x134549[0x0][_0x323922(0x137)]==_0x323922(0x129))var _0x57c9e0=users[_0x323922(0x129)];else{if(_0x134549[0x0][_0x323922(0x137)]==_0x323922(0x1cd))var _0x57c9e0=users[_0x323922(0x1cd)];else{if(_0x134549[0x0]['language']==_0x323922(0x226))var _0x57c9e0=users[_0x323922(0x226)];else{if(_0x134549[0x0][_0x323922(0x137)]==_0x323922(0x1fe))var _0x57c9e0=users[_0x323922(0x164)];else{if(_0x134549[0x0][_0x323922(0x137)]==_0x323922(0x143))var _0x57c9e0=users['Chinese'];else{if(_0x134549[0x0][_0x323922(0x137)]==_0x323922(0x1a2))var _0x57c9e0=users['Arabic'];}}}}}}}_0x4c3679[_0x323922(0x1a1)](_0x323922(0x1f3),{'success':_0x2e40dc[_0x323922(0x174)](_0x323922(0x172)),'errors':_0x2e40dc[_0x323922(0x174)](_0x323922(0x166)),'role':_0x2abd10,'profile':_0x2323f3,'master_shop':_0x134549,'customers':_0x4e1a10,'sales':_0x3caa13,'language':_0x57c9e0});}catch(_0x2e11c9){console[_0x323922(0x187)](_0x2e11c9);}}),router['get'](a0_0x1d08f1(0x1db),auth,async(_0x3cc560,_0x405d5d)=>{var _0x37336d=a0_0x1d08f1;try{const {username:_0x1320f5,email:_0x29ea68,role:_0x38d5c3}=_0x3cc560[_0x37336d(0x14f)],_0x3c7631=_0x3cc560[_0x37336d(0x14f)],_0x3bf887=await profile[_0x37336d(0x1ed)]({'email':_0x3c7631['email']}),_0x452ec9=await master_shop[_0x37336d(0x223)]();console['log'](_0x37336d(0x18f),_0x452ec9);const _0x329f74=_0x3cc560[_0x37336d(0x1ec)]['id'];console[_0x37336d(0x187)](_0x329f74);const _0xb9ed15=await sales[_0x37336d(0x177)](_0x329f74);console[_0x37336d(0x187)](_0x37336d(0x1e9),_0xb9ed15);const _0x59a79d=await warehouse['aggregate']([{'$match':{'name':'Return\x20Goods','room':'Return\x20Rooms'}},{'$unwind':_0x37336d(0x158)},{'$group':{'_id':_0x37336d(0x14c),'name':{'$first':_0x37336d(0x1d2)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x37336d(0x1ac)},'isle':{'$first':_0x37336d(0x1d0)},'pallet':{'$first':_0x37336d(0x239)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x37336d(0x218)},'product_code':{'$first':_0x37336d(0x17d)}}}]);console[_0x37336d(0x187)](_0x37336d(0x19e),_0x59a79d);const _0x55a645=await product[_0x37336d(0x223)]({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x37336d(0x1f0),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x37336d(0x1ef),'name':{'$first':_0x37336d(0x1ef)}}},{'$sort':{'name':0x1}}]);var _0x275985=[_0x37336d(0x18b)];if(_0x452ec9[0x0][_0x37336d(0x137)]==_0x37336d(0x1c9)){var _0x1f502e=users[_0x37336d(0x214)];console[_0x37336d(0x187)](_0x1f502e);}else{if(_0x452ec9[0x0][_0x37336d(0x137)]==_0x37336d(0x12d))var _0x1f502e=users['Hindi'];else{if(_0x452ec9[0x0][_0x37336d(0x137)]=='German')var _0x1f502e=users['German'];else{if(_0x452ec9[0x0][_0x37336d(0x137)]=='Spanish')var _0x1f502e=users[_0x37336d(0x1cd)];else{if(_0x452ec9[0x0][_0x37336d(0x137)]==_0x37336d(0x226))var _0x1f502e=users[_0x37336d(0x226)];else{if(_0x452ec9[0x0][_0x37336d(0x137)]==_0x37336d(0x1fe))var _0x1f502e=users['Portuguese'];else{if(_0x452ec9[0x0]['language']=='Chinese')var _0x1f502e=users['Chinese'];else{if(_0x452ec9[0x0][_0x37336d(0x137)]==_0x37336d(0x1a2))var _0x1f502e=users[_0x37336d(0x233)];}}}}}}}_0x405d5d[_0x37336d(0x1a1)](_0x37336d(0x14b),{'success':_0x3cc560[_0x37336d(0x174)](_0x37336d(0x172)),'errors':_0x3cc560['flash']('errors'),'role':_0x3c7631,'profile':_0x3bf887,'user':_0xb9ed15,'stock':_0x59a79d,'master_shop':_0x452ec9,'unit':_0x55a645,'language':_0x1f502e,'warehouses':warehouse_data,'rooms':_0x275985});}catch(_0x3f82f3){console[_0x37336d(0x187)](_0x3f82f3),_0x405d5d['status'](0xc8)['json']({'message':_0x3f82f3['message']});}}),router[a0_0x1d08f1(0x1c3)](a0_0x1d08f1(0x1db),auth,async(_0x3e82b9,_0x17ef5c)=>{var _0x40806e=a0_0x1d08f1;try{const {invoice:_0x2643f9,date:_0x1722c6,warehouse_name:_0x10550c,product_name:_0xb32ee7,primary_code:_0xd019ab,secondary_code:_0x21f663,product_code:_0xf92247,sales_quantity:_0x5666fb,stocks:_0x6b3bdc,return_qty:_0x1c6bcd,Room_name:_0x4f1750,to_warehouse_name:_0x2d219d,to_Roomname:_0x3d6b1b,to_Room_name:_0x31041e,note:_0x5830af,level:_0x31b3cc,isle:_0x33a433,pallet:_0x4fc2a7}=_0x3e82b9[_0x40806e(0x180)];if(typeof _0xb32ee7==_0x40806e(0x16c))var _0x542a80=[_0x3e82b9['body'][_0x40806e(0x20a)]],_0x2c9759=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x1a3)]],_0x5b3cdc=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x169)]],_0x217043=[_0x3e82b9['body'][_0x40806e(0x1bc)]],_0x3ff74f=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x146)]],_0x408466=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x1d7)]],_0x453298=[_0x3e82b9['body'][_0x40806e(0x184)]],_0x52a2be=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x203)]],_0x19c5ef=[_0x3e82b9[_0x40806e(0x180)]['bin']],_0x142d84=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x1e4)]],_0x989f82=[_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x12b)]];else var _0x542a80=[..._0x3e82b9[_0x40806e(0x180)][_0x40806e(0x20a)]],_0x2c9759=[..._0x3e82b9[_0x40806e(0x180)][_0x40806e(0x1a3)]],_0x5b3cdc=[..._0x3e82b9['body'][_0x40806e(0x169)]],_0x217043=[..._0x3e82b9['body']['product_code']],_0x3ff74f=[..._0x3e82b9[_0x40806e(0x180)][_0x40806e(0x146)]],_0x408466=[..._0x3e82b9['body'][_0x40806e(0x1d7)]],_0x453298=[..._0x3e82b9[_0x40806e(0x180)][_0x40806e(0x184)]],_0x52a2be=[..._0x3e82b9['body'][_0x40806e(0x203)]],_0x19c5ef=[..._0x3e82b9[_0x40806e(0x180)][_0x40806e(0x155)]],_0x142d84=[..._0x3e82b9[_0x40806e(0x180)]['types']],_0x989f82=[..._0x3e82b9[_0x40806e(0x180)]['floorlevel']];const _0x59b285=_0x542a80[_0x40806e(0x1bf)](_0xe0930e=>{return _0xe0930e={'product_name':_0xe0930e};});_0x2c9759['forEach']((_0x4b8367,_0x423130)=>{var _0x15b262=_0x40806e;_0x59b285[_0x423130][_0x15b262(0x1a3)]=_0x4b8367;}),_0x5b3cdc['forEach']((_0xefaa22,_0x14b540)=>{var _0x44255e=_0x40806e;_0x59b285[_0x14b540][_0x44255e(0x169)]=_0xefaa22;}),_0x217043[_0x40806e(0x1e0)]((_0x3be288,_0x3c925d)=>{var _0x1f2f8e=_0x40806e;_0x59b285[_0x3c925d][_0x1f2f8e(0x1bc)]=_0x3be288;}),_0x3ff74f['forEach']((_0x4d484e,_0x453a62)=>{var _0x2a3ee6=_0x40806e;_0x59b285[_0x453a62][_0x2a3ee6(0x12f)]=_0x4d484e;}),_0x408466[_0x40806e(0x1e0)]((_0x5be246,_0xa00a0d)=>{var _0x1aa011=_0x40806e;_0x59b285[_0xa00a0d][_0x1aa011(0x1a9)]=_0x5be246;}),_0x453298[_0x40806e(0x1e0)]((_0x81bce5,_0xc3b0f7)=>{var _0x3d11a0=_0x40806e;_0x59b285[_0xc3b0f7][_0x3d11a0(0x184)]=_0x81bce5;}),_0x52a2be[_0x40806e(0x1e0)]((_0x539f75,_0x51755a)=>{var _0x14f315=_0x40806e;_0x59b285[_0x51755a][_0x14f315(0x203)]=_0x539f75;}),_0x19c5ef[_0x40806e(0x1e0)]((_0x2858ce,_0x4f9f3b)=>{var _0x2afac1=_0x40806e;_0x59b285[_0x4f9f3b][_0x2afac1(0x155)]=_0x2858ce;}),_0x142d84[_0x40806e(0x1e0)]((_0x51e2aa,_0x29714b)=>{var _0x287052=_0x40806e;_0x59b285[_0x29714b][_0x287052(0x22d)]=_0x51e2aa;}),_0x989f82[_0x40806e(0x1e0)]((_0x4c2623,_0x7aa095)=>{var _0x49562a=_0x40806e;_0x59b285[_0x7aa095][_0x49562a(0x12b)]=_0x4c2623;});var _0x1edb01=0x0;_0x59b285[_0x40806e(0x1e0)](_0x1196cd=>{var _0x5923a7=_0x40806e;console['log'](_0x5923a7(0x1ab),_0x1196cd),(parseInt(_0x1196cd[_0x5923a7(0x12f)])<parseInt(_0x1196cd[_0x5923a7(0x184)])||parseInt(_0x1196cd['stock'])<parseInt(_0x1196cd[_0x5923a7(0x184)])&&parseInt(_0x1196cd['sale_qty'])>parseInt(_0x1196cd[_0x5923a7(0x184)])||parseInt(_0x1196cd[_0x5923a7(0x184)])==0x0)&&_0x1edb01++;});if(_0x1edb01!=0x0)return _0x3e82b9[_0x40806e(0x174)](_0x40806e(0x166),_0x40806e(0x182)),_0x17ef5c['redirect'](_0x40806e(0x1be));const _0x418dad=await sales[_0x40806e(0x1ed)]({'invoice':_0x2643f9});console[_0x40806e(0x187)](_0x418dad),_0x418dad[_0x40806e(0x217)]=_0x40806e(0x21e);const _0xf8c051=await _0x418dad[_0x40806e(0x133)](),_0x3166b7=new sales_return({'invoice':_0x2643f9,'customer':_0x3e82b9[_0x40806e(0x180)][_0x40806e(0x1b7)],'date':_0x1722c6,'warehouse_name':_0x10550c,'room':_0x4f1750,'ToWarehouse':_0x2d219d,'ToRoom':_0x31041e,'return_sale':_0x59b285,'note':_0x5830af}),_0x2d7f66=await _0x3166b7[_0x40806e(0x133)]();console[_0x40806e(0x187)](_0x3166b7);const _0x31315f=await sales_return['findOne']({'invoice':_0x2643f9}),_0x3f1c6d=await warehouse[_0x40806e(0x1ed)]({'name':_0x2d219d,'room':_0x31041e});_0x31315f['return_sale'][_0x40806e(0x1e0)](_0x27c187=>{var _0x57fe16=_0x40806e,_0x6b1997=0x0;const _0x3f5103=_0x3f1c6d[_0x57fe16(0x1c4)]['map'](_0x2ff838=>{var _0x3b7fe0=_0x57fe16;_0x2ff838[_0x3b7fe0(0x20a)]==_0x27c187[_0x3b7fe0(0x20a)]&&_0x2ff838[_0x3b7fe0(0x12b)]==_0x27c187[_0x3b7fe0(0x12b)]&&_0x2ff838[_0x3b7fe0(0x22d)]==_0x27c187[_0x3b7fe0(0x22d)]&&_0x2ff838['bin']==_0x27c187[_0x3b7fe0(0x155)]&&_0x2ff838['bay']==_0x27c187[_0x3b7fe0(0x203)]&&(_0x2ff838['product_stock']=parseInt(_0x2ff838[_0x3b7fe0(0x168)])+parseInt(_0x27c187[_0x3b7fe0(0x184)]),_0x6b1997++);});_0x6b1997=='0'&&(_0x3f1c6d[_0x57fe16(0x1c4)]=_0x3f1c6d[_0x57fe16(0x1c4)][_0x57fe16(0x175)]({'product_name':_0x27c187[_0x57fe16(0x20a)],'product_stock':_0x27c187[_0x57fe16(0x184)],'primary_code':_0x27c187['primary_code'],'secondary_code':_0x27c187['secondary_code'],'product_code':_0x27c187[_0x57fe16(0x1bc)],'bay':_0x27c187[_0x57fe16(0x203)],'bin':_0x27c187[_0x57fe16(0x155)],'type':_0x27c187[_0x57fe16(0x22d)],'floorlevel':_0x27c187[_0x57fe16(0x12b)]})),console[_0x57fe16(0x187)](_0x57fe16(0x21d),_0x3f1c6d);}),await _0x3f1c6d[_0x40806e(0x133)](),console['log'](_0x3e82b9[_0x40806e(0x180)]);const _0x25fa4f=new c_payment_data({'invoice':_0x2643f9,'customer':_0x3e82b9['body'][_0x40806e(0x1b7)],'reason':'Sale\x20Return'});await _0x25fa4f[_0x40806e(0x133)]();const _0x4490ad=await master_shop[_0x40806e(0x223)]();console[_0x40806e(0x187)]('add\x20post',_0x4490ad[0x0][_0x40806e(0x1ba)]);const _0x4e966a=await email_settings[_0x40806e(0x1ed)](),_0x31aa66=await customer[_0x40806e(0x1ed)]({'name':_0x3e82b9['body']['customer']});console[_0x40806e(0x187)](_0x40806e(0x1b1),_0x31aa66);_0x4490ad[0x0]['currency_placement']==0x1?(right_currency=_0x4490ad[0x0][_0x40806e(0x234)],left_currency=''):(right_currency='',left_currency=_0x4490ad[0x0][_0x40806e(0x234)]);var _0x11d838=_0x542a80,_0x188712=_0x453298,_0x7efe57='',_0x141807;for(_0x141807 in _0x11d838){_0x7efe57+=_0x40806e(0x149)+_0x40806e(0x1e8)+_0x11d838[_0x141807]+_0x40806e(0x154)+_0x40806e(0x1e8)+_0x188712[_0x141807]+'</td>'+_0x40806e(0x1c5);}console['log'](_0x40806e(0x1d3),_0x7efe57);let _0x5966b3=nodemailer['createTransport']({'service':_0x40806e(0x1f7),'auth':{'user':_0x4e966a['email'],'pass':_0x4e966a[_0x40806e(0x18e)]}}),_0xd119f={'from':_0x4e966a[_0x40806e(0x1b0)],'to':_0x31aa66[_0x40806e(0x1b0)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x40806e(0x134),'path':__dirname+_0x40806e(0x17c)+_0x40806e(0x13b)+_0x4490ad[0x0][_0x40806e(0x1ba)],'cid':'logo'}],'html':_0x40806e(0x1fc)+_0x40806e(0x132)+_0x40806e(0x20e)+_0x40806e(0x208)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x40806e(0x208)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x40806e(0x208)+_0x40806e(0x1c1)+_0x4490ad[0x0]['site_title']+_0x40806e(0x188)+_0x40806e(0x21f)+_0x40806e(0x21f)+_0x40806e(0x16b)+'<div>'+_0x40806e(0x152)+_0x40806e(0x1cc)+_0x2643f9+'\x20'+_0x40806e(0x20c)+'\x20Order\x20Date\x20:\x20'+_0x1722c6+'\x20'+_0x40806e(0x12a)+'</h5>'+_0x40806e(0x21f)+_0x40806e(0x1f6)+_0x40806e(0x1e2)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x40806e(0x183)+_0x40806e(0x1d8)+_0x40806e(0x1c5)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x7efe57+'\x20'+'</tbody>'+_0x40806e(0x13e)+'<div>'+_0x40806e(0x178)+_0x40806e(0x159)+_0x4490ad[0x0]['site_title']+_0x40806e(0x14e)+_0x40806e(0x21f)+_0x40806e(0x21f)+_0x40806e(0x176)};_0x5966b3[_0x40806e(0x1c8)](_0xd119f,function(_0x2836b,_0x5b859b){var _0x2da4bb=_0x40806e;_0x2836b?(console['log'](_0x2836b),console[_0x2da4bb(0x187)](_0x2da4bb(0x199))):console['log'](_0x2da4bb(0x209));}),_0x3e82b9[_0x40806e(0x174)](_0x40806e(0x172),_0x40806e(0x190)),_0x17ef5c[_0x40806e(0x21c)](_0x40806e(0x197));}catch(_0x462054){console[_0x40806e(0x187)](_0x462054),_0x17ef5c[_0x40806e(0x13d)](0xc8)[_0x40806e(0x232)]({'message1':_0x462054[_0x40806e(0x170)]});}}),router[a0_0x1d08f1(0x1fa)](a0_0x1d08f1(0x229),auth,async(_0x2ffa7f,_0x5be0ba)=>{var _0x2c8506=a0_0x1d08f1;try{const {username:_0x5c2bcb,email:_0x116ec4,role:_0x1cd6f1}=_0x2ffa7f[_0x2c8506(0x14f)],_0xb85e0b=_0x2ffa7f[_0x2c8506(0x14f)],_0x8fde96=await profile['findOne']({'email':_0xb85e0b['email']}),_0x2a293a=await master_shop[_0x2c8506(0x223)]();console['log']('barcode\x20Product\x20master',_0x2a293a);const _0x3614ba=_0x2ffa7f[_0x2c8506(0x1ec)]['id'],_0x3541be=await sales[_0x2c8506(0x177)](_0x3614ba);console[_0x2c8506(0x187)](_0x2c8506(0x17e),_0x3541be);if(_0x2a293a[0x0][_0x2c8506(0x137)]=='English\x20(US)')var _0x5f4c2e=users[_0x2c8506(0x214)];else{if(_0x2a293a[0x0][_0x2c8506(0x137)]==_0x2c8506(0x12d))var _0x5f4c2e=users[_0x2c8506(0x12d)];else{if(_0x2a293a[0x0]['language']==_0x2c8506(0x129))var _0x5f4c2e=users[_0x2c8506(0x129)];else{if(_0x2a293a[0x0]['language']==_0x2c8506(0x1cd))var _0x5f4c2e=users[_0x2c8506(0x1cd)];else{if(_0x2a293a[0x0][_0x2c8506(0x137)]==_0x2c8506(0x226))var _0x5f4c2e=users[_0x2c8506(0x226)];else{if(_0x2a293a[0x0][_0x2c8506(0x137)]==_0x2c8506(0x1fe))var _0x5f4c2e=users[_0x2c8506(0x164)];else{if(_0x2a293a[0x0]['language']=='Chinese')var _0x5f4c2e=users[_0x2c8506(0x143)];else{if(_0x2a293a[0x0][_0x2c8506(0x137)]=='Arabic\x20(ae)')var _0x5f4c2e=users[_0x2c8506(0x233)];}}}}}}}_0x5be0ba[_0x2c8506(0x1a1)](_0x2c8506(0x1c7),{'success':_0x2ffa7f[_0x2c8506(0x174)](_0x2c8506(0x172)),'errors':_0x2ffa7f[_0x2c8506(0x174)](_0x2c8506(0x166)),'role':_0xb85e0b,'profile':_0x8fde96,'alldata':_0x3541be,'master_shop':_0x2a293a,'language':_0x5f4c2e});}catch(_0x3952fd){console[_0x2c8506(0x187)](_0x3952fd);}}),router[a0_0x1d08f1(0x1c3)]('/barcode_scanner',async(_0x37e8ff,_0xf927ce)=>{var _0xdbb4b0=a0_0x1d08f1;const {product_code:_0x5b3a35,warehouse_name:_0x4aeb1f,rooms_data:_0x3eb33c,Roomslist:_0x5223ba}=_0x37e8ff['body'],_0x3eb29f=_0x5223ba[_0xdbb4b0(0x131)](','),_0x25d2b0=[];async function _0x2ecb5b(_0x1e2c61){var _0x392e2d=_0xdbb4b0;const _0x1b4d2c=await warehouse[_0x392e2d(0x221)]([{'$match':{'name':_0x4aeb1f,'room':_0x1e2c61}},{'$unwind':_0x392e2d(0x158)},{'$match':{'product_details.primary_code':_0x5b3a35}},{'$group':{'_id':_0x392e2d(0x14c),'name':{'$first':_0x392e2d(0x1d2)},'product_stock':{'$first':_0x392e2d(0x18c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x392e2d(0x17d)},'level':{'$first':_0x392e2d(0x1b4)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x392e2d(0x1a5)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x392e2d(0x128)},'rack':{'$first':_0x392e2d(0x1cf)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x392e2d(0x148)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x392e2d(0x1f2)},'product_cat':{'$first':_0x392e2d(0x193)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x392e2d(0x12c)},'invoice':{'$first':_0x392e2d(0x19a)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x392e2d(0x130)}}}]),_0x167a76=await warehouse['aggregate']([{'$match':{'name':_0x4aeb1f,'room':_0x1e2c61}},{'$unwind':_0x392e2d(0x158)},{'$match':{'product_details.secondary_code':_0x5b3a35}},{'$group':{'_id':_0x392e2d(0x14c),'name':{'$first':_0x392e2d(0x1d2)},'product_stock':{'$first':_0x392e2d(0x18c)},'primary_code':{'$first':_0x392e2d(0x1eb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x392e2d(0x1b3)},'type':{'$first':_0x392e2d(0x1a5)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x392e2d(0x136)},'secondary_unit':{'$first':_0x392e2d(0x1df)},'storage':{'$first':_0x392e2d(0x128)},'rack':{'$first':_0x392e2d(0x1cf)},'expiry_date':{'$first':_0x392e2d(0x213)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x392e2d(0x206)},'batch_code':{'$first':_0x392e2d(0x1f2)},'product_cat':{'$first':_0x392e2d(0x193)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x392e2d(0x12c)},'invoice':{'$first':_0x392e2d(0x19a)}}}]);if(_0x1b4d2c[_0x392e2d(0x167)]>0x0)_0x25d2b0[_0x392e2d(0x15c)](_0x1b4d2c);else _0x167a76['length']>0x0&&_0x25d2b0['push'](_0x167a76);}const _0x2e204f=_0x3eb29f['map'](_0x9de0ac=>_0x2ecb5b(_0x9de0ac));await Promise['all'](_0x2e204f),_0xf927ce[_0xdbb4b0(0x232)](_0x25d2b0);}),module[a0_0x1d08f1(0x13a)]=router;