var a0_0x310399=a0_0x5efb;function a0_0x1837(){var _0x4f4478=['currency_placement','7715675SzJGCq','length','log','post','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$_id','2613993HGIHwB','\x20</h2>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.batch_code','French','Level','nodemailer','$product_details.production_date','2WeeSDr','secondary_unit','customers','return_qty','Floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<!DOCTYPE\x20html>','<tr>','</head><body>','/give_payment/:id','$date','gmail','logo','primary_unit','13768696WcdBzP','$sale_product.bin','True','/barcode/:id','split','Hindi','due_amount','Receiving\x20Area','202987FKVxVC','$product_details.product_cat','createTransport','$product_details._id','</h5>','note','status','express','$product_details.level','$product_details.product_stock','<tbody\x20style=\x22text-align:\x20center;\x22>','padStart','requested_qty','get','primary_code','date','all','/all_sales/view','sale_product','batch_code','flash','all_sales_barcode','product','customers_docs','final','return_sale','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<html><head><title></title>','$sale_product.quantity','rack','product_code','floorlevel','payment\x20successfull','sales_invoice','unit','prod_invoice','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.invoice','aggregate','add\x20post','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','sales_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','staff','../public/language/languages.json','$sale_product.floorlevel','$customers_docs','max_per_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','add_sales','json','$room','sales\x20all_data','<hr\x20class=\x22my-3\x22>','Sale\x20Return\x20Mail','warehouse','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_details','bay','$product.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','types','email','host','back','carton','$sale_product','../models/all_models','Portuguese','$product_details.unit','sales\x20item\x20return\x20successfull','../middleware/auth','English\x20(US)','<h5>','maxperunit','render','stock','/view','/view/:id','$product_details.bin','storage','foreach\x20newproduct','prod_cat','edit_sales_view','Enabled','$return_data','role','</tr>','Router','Shelves','delivery_date','room','edit_sales','42tOdSbP','/view/add_sale/product','product_list','</td>','then','currency','findOne','Return\x20Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<span\x20style=\x22float:\x20right;\x22>','/view/add_sales/:id','$product','secondary_code','prod_code','An\x20error\x20occurred\x20while\x20saving\x20data.','master','1734278LVHyrM','Sale\x20Return','warehouse_name','German','RoomAssigned','redirect','$isAllowEdit','English','/all_sales/preview/','</body></html>','type','barcode\x20Product\x20master','Chinese','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.primary_code','$product_details.pallet','OUT-','Ambient','push','language','$sale_product.type','filter','sale_qty','An\x20error\x20occurred.','slice','Arabic','stocks','Spanish','$product_details.bay','\x20Order\x20Date\x20:\x20','Logo.png','map','$finalize','False','$warehouse_name','</tbody>','barcode\x20user_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<div>','28668933nxjftv','_id','errors','customer_data','$product_details','$product_details.secondary_code','Error\x20Occurs','amount','$product_details.expiry_date','</thead>','getFullYear','sendMail','quantity_notConverted','$product_details.rack','$product_details.type','error','save','Sales\x20Update\x20successfully','$product_details.product_name','<strong>\x20Regards\x20</strong>','abs','catch','$name','concat','received_amount','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','forEach','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.maxPerUnit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.storage','body','$sale_product.bay','actual_uom','Raw\x20Materials','$product_details.floorlevel','/view/add_sales','Received\x20Payment\x20For\x20Sale','site_title','$product_details.actual_uom','/barcode_scanner','Email\x20sent\x20successfully','Arabic\x20(ae)','level','bin','product_data','production_date','password','actual_qty','/upload/','<h2>\x20','product_name','string','success','max','/../public','customer','finalize','$product_details.product_code','5337284VQgyJC','quantity','$note','</span>','image','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Portuguese\x20(BR)','Sales\x20Mail','findById','expiry_date','port','$product_details.secondary_unit','</table>','Return\x20Goods','user_id','$customer','room_name','$product_details.actual_qty','delivery_code','isAllowEdit','RMSEmail','/view/return_sales/:id','find','product_stock','params'];a0_0x1837=function(){return _0x4f4478;};return a0_0x1837();}(function(_0x1ebd87,_0x10c11f){var _0x218441=a0_0x5efb,_0x469e6b=_0x1ebd87();while(!![]){try{var _0x2c69e7=-parseInt(_0x218441(0x24c))/0x1+parseInt(_0x218441(0x236))/0x2*(parseInt(_0x218441(0x22e))/0x3)+-parseInt(_0x218441(0x20c))/0x4+-parseInt(_0x218441(0x227))/0x5+-parseInt(_0x218441(0x2aa))/0x6*(parseInt(_0x218441(0x1aa))/0x7)+parseInt(_0x218441(0x244))/0x8+parseInt(_0x218441(0x1d1))/0x9;if(_0x2c69e7===_0x10c11f)break;else _0x469e6b['push'](_0x469e6b['shift']());}catch(_0x4edc84){_0x469e6b['push'](_0x469e6b['shift']());}}}(a0_0x1837,0xeb23e));const express=require(a0_0x310399(0x253)),app=express(),router=express[a0_0x310399(0x2a5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x310399(0x290)),auth=require(a0_0x310399(0x294)),nodemailer=require(a0_0x310399(0x234)),users=require(a0_0x310399(0x278));router['get'](a0_0x310399(0x29a),auth,async(_0x54eae2,_0x37f774)=>{var _0x5d153c=a0_0x310399;try{const {username:_0x543b59,email:_0x5ddf85,role:_0x30b291}=_0x54eae2['user'],_0x5aa507=_0x54eae2[_0x5d153c(0x22b)],_0x42fa9f=await profile['findOne']({'email':_0x5aa507[_0x5d153c(0x28b)]}),_0x41ef54=await master_shop['find']();let _0x432edb;if(_0x5aa507['role']==_0x5d153c(0x277)){const _0x40dd18=await staff[_0x5d153c(0x2b0)]({'email':_0x5aa507['email']});_0x432edb=await sales[_0x5d153c(0x272)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':'name','as':_0x5d153c(0x263)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5d153c(0x28f)},{'$group':{'_id':_0x5d153c(0x22d),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x5d153c(0x21c)},'date':{'$first':_0x5d153c(0x240)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x5d153c(0x20e)},'return_data':{'$first':_0x5d153c(0x2a2)},'customers_docs':{'$first':_0x5d153c(0x27a)},'total_saleproduct_quantity':{'$sum':_0x5d153c(0x268)},'level':{'$addToSet':_0x5d153c(0x1f1)},'isle':{'$addToSet':_0x5d153c(0x245)},'type':{'$addToSet':_0x5d153c(0x1be)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5d153c(0x1ca)},'isAllowEdit':{'$first':_0x5d153c(0x1b0)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x432edb=await sales[_0x5d153c(0x272)]([{'$lookup':{'from':_0x5d153c(0x238),'localField':_0x5d153c(0x209),'foreignField':'name','as':'customers_docs'}},{'$unwind':_0x5d153c(0x27a)},{'$unwind':_0x5d153c(0x28f)},{'$group':{'_id':_0x5d153c(0x22d),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x5d153c(0x21c)},'date':{'$first':_0x5d153c(0x240)},'warehouse_name':{'$first':_0x5d153c(0x1cc)},'sale_product':{'$push':_0x5d153c(0x28f)},'note':{'$first':_0x5d153c(0x20e)},'return_data':{'$first':_0x5d153c(0x2a2)},'customers_docs':{'$first':_0x5d153c(0x27a)},'total_saleproduct_quantity':{'$sum':_0x5d153c(0x268)},'level':{'$addToSet':_0x5d153c(0x1f1)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5d153c(0x1be)},'pallet':{'$addToSet':_0x5d153c(0x279)},'finalize':{'$first':_0x5d153c(0x1ca)},'isAllowEdit':{'$first':_0x5d153c(0x1b0)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5d153c(0x229)](_0x5d153c(0x280),_0x432edb);if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x295)){var _0x582b5a=users[_0x5d153c(0x1b1)];console[_0x5d153c(0x229)](_0x582b5a);}else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x249))var _0x582b5a=users[_0x5d153c(0x249)];else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x1ad))var _0x582b5a=users['German'];else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]=='Spanish')var _0x582b5a=users[_0x5d153c(0x1c5)];else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x232))var _0x582b5a=users[_0x5d153c(0x232)];else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x213))var _0x582b5a=users[_0x5d153c(0x291)];else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x1b6))var _0x582b5a=users[_0x5d153c(0x1b6)];else{if(_0x41ef54[0x0][_0x5d153c(0x1bd)]==_0x5d153c(0x1fb))var _0x582b5a=users['Arabic'];}}}}}}}_0x37f774[_0x5d153c(0x298)]('all_sales',{'success':_0x54eae2[_0x5d153c(0x260)](_0x5d153c(0x206)),'errors':_0x54eae2[_0x5d153c(0x260)](_0x5d153c(0x1d3)),'sales':_0x432edb,'profile':_0x42fa9f,'role':_0x5aa507,'master_shop':_0x41ef54,'language':_0x582b5a});}catch(_0x2921d8){console[_0x5d153c(0x229)](_0x2921d8);}});async function getRandom8DigitNumber(){var _0x3787c1=a0_0x310399;const _0x1b128b=0x989680,_0x89feda=0x5f5e0ff,_0x231bb2=Math['floor'](Math['random']()*(_0x89feda-_0x1b128b+0x1))+_0x1b128b;var _0x3bbfa6;const _0x3530c5=await sales['findOne']({'invoice':_0x3787c1(0x1ba)+_0x231bb2});return _0x3530c5&&_0x3530c5[_0x3787c1(0x228)]>0x0?_0x3bbfa6=_0x3787c1(0x1ba)+_0x231bb2:_0x3bbfa6=_0x3787c1(0x1ba)+_0x231bb2,_0x3bbfa6;}function a0_0x5efb(_0x5c2487,_0x254153){var _0x18377d=a0_0x1837();return a0_0x5efb=function(_0x5efbb0,_0x8648ac){_0x5efbb0=_0x5efbb0-0x1a2;var _0x161730=_0x18377d[_0x5efbb0];return _0x161730;},a0_0x5efb(_0x5c2487,_0x254153);}router[a0_0x310399(0x259)](a0_0x310399(0x1f5),auth,async(_0x47f900,_0x2127ac)=>{var _0x47c0f5=a0_0x310399;try{const {username:_0x352260,email:_0x2d4535,role:_0x20b8ed}=_0x47f900[_0x47c0f5(0x22b)],_0x3d8164=_0x47f900[_0x47c0f5(0x22b)],_0x1ffbb0=await profile['findOne']({'email':_0x3d8164[_0x47c0f5(0x28b)]}),_0x395ebb=await master_shop[_0x47c0f5(0x223)](),_0x2325f9=await customer[_0x47c0f5(0x223)]({});let _0x5272d9;if(_0x3d8164[_0x47c0f5(0x2a3)]==_0x47c0f5(0x277)){const _0x4625a2=await staff[_0x47c0f5(0x2b0)]({'email':_0x3d8164[_0x47c0f5(0x28b)]});_0x5272d9=await warehouse['aggregate']([{'$match':{'status':_0x47c0f5(0x2a1),'name':_0x4625a2['warehouse'],'warehouse_category':_0x47c0f5(0x1f3),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x47c0f5(0x1e7)}}},{'$sort':{'name':0x1}}]);}else _0x5272d9=await warehouse[_0x47c0f5(0x272)]([{'$match':{'status':_0x47c0f5(0x2a1),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x47c0f5(0x21a)}}},{'$group':{'_id':_0x47c0f5(0x1e7),'name':{'$first':_0x47c0f5(0x1e7)}}},{'$sort':{'name':0x1}}]);const _0x178a75=await product[_0x47c0f5(0x223)]({});var _0x3136d6=[_0x47c0f5(0x1bb),'Enclosed'];const _0x59a162=await sales['find']({}),_0x54915a=_0x59a162[_0x47c0f5(0x228)]+0x1,_0x5c5065='OUT-'+_0x54915a['toString']()[_0x47c0f5(0x257)](0x5,'0');if(_0x395ebb[0x0]['language']==_0x47c0f5(0x295)){var _0x3805d2=users[_0x47c0f5(0x1b1)];console['log'](_0x3805d2);}else{if(_0x395ebb[0x0][_0x47c0f5(0x1bd)]=='Hindi')var _0x3805d2=users[_0x47c0f5(0x249)];else{if(_0x395ebb[0x0][_0x47c0f5(0x1bd)]=='German')var _0x3805d2=users[_0x47c0f5(0x1ad)];else{if(_0x395ebb[0x0]['language']=='Spanish')var _0x3805d2=users[_0x47c0f5(0x1c5)];else{if(_0x395ebb[0x0]['language']==_0x47c0f5(0x232))var _0x3805d2=users[_0x47c0f5(0x232)];else{if(_0x395ebb[0x0][_0x47c0f5(0x1bd)]=='Portuguese\x20(BR)')var _0x3805d2=users[_0x47c0f5(0x291)];else{if(_0x395ebb[0x0][_0x47c0f5(0x1bd)]==_0x47c0f5(0x1b6))var _0x3805d2=users[_0x47c0f5(0x1b6)];else{if(_0x395ebb[0x0][_0x47c0f5(0x1bd)]==_0x47c0f5(0x1fb))var _0x3805d2=users[_0x47c0f5(0x1c3)];}}}}}}}const _0x4693be=getRandom8DigitNumber();_0x4693be['then'](_0x5b921f=>{var _0x37b520=_0x47c0f5;_0x2127ac[_0x37b520(0x298)](_0x37b520(0x27d),{'success':_0x47f900[_0x37b520(0x260)](_0x37b520(0x206)),'errors':_0x47f900['flash'](_0x37b520(0x1d3)),'role':_0x3d8164,'profile':_0x1ffbb0,'customer':_0x2325f9,'warehouse':_0x5272d9,'product':_0x178a75,'invoice':_0x5b921f,'master_shop':_0x395ebb,'language':_0x3805d2,'rooms_data':_0x3136d6});})[_0x47c0f5(0x1e6)](_0x2caf1e=>{var _0x3cc798=_0x47c0f5;_0x47f900[_0x3cc798(0x260)](_0x3cc798(0x1d3),_0x3cc798(0x1ec)),_0x2127ac['redirect'](_0x3cc798(0x25d));});}catch(_0x3b7151){console[_0x47c0f5(0x229)](_0x3b7151);}}),router['get'](a0_0x310399(0x1a4),auth,async(_0xa5f716,_0x98329e)=>{var _0x2e2f83=a0_0x310399;try{const _0x26bbd9=_0xa5f716[_0x2e2f83(0x225)]['id'];console['log'](_0x26bbd9);const _0x1cf5f6=await product[_0x2e2f83(0x223)](),_0x2447c1=await purchases[_0x2e2f83(0x272)]([{'$match':{'warehouse_name':_0x26bbd9}},{'$unwind':_0x2e2f83(0x1a5)},{'$group':{'_id':_0x2e2f83(0x288)}}]);console['log']('purchases_data',_0x2447c1),_0x98329e[_0x2e2f83(0x252)](0xc8)[_0x2e2f83(0x27e)]({'purchases_data':_0x2447c1,'product_data':_0x1cf5f6});}catch(_0x653215){console[_0x2e2f83(0x229)](_0x653215);}}),router['post'](a0_0x310399(0x2ab),auth,async(_0x9d1bd0,_0x58042f)=>{var _0x599e02=a0_0x310399;try{const {warehouse_data:_0x39ce5b,product_data:_0x536b80}=_0x9d1bd0[_0x599e02(0x1f0)];console[_0x599e02(0x229)](_0x9d1bd0[_0x599e02(0x1f0)][_0x599e02(0x1fe)]);;const _0x194d2c=await master_shop[_0x599e02(0x223)]();console[_0x599e02(0x229)]('master',_0x194d2c);const _0x5c3774=await product[_0x599e02(0x2b0)]({'name':_0x536b80});console[_0x599e02(0x229)](_0x599e02(0x262),_0x5c3774);const _0x3aec31=await warehouse['aggregate']([{'$match':{'name':_0x39ce5b}},{'$unwind':_0x599e02(0x1d5)},{'$match':{'product_details.product_name':_0x536b80}},{'$group':{'_id':_0x599e02(0x1e3),'product_stock':{'$first':_0x599e02(0x255)}}}]);console['log']('stock_data',_0x3aec31),_0x58042f[_0x599e02(0x252)](0xc8)[_0x599e02(0x27e)]({'master':_0x194d2c,'new_product':_0x5c3774,'stock_data':_0x3aec31});}catch(_0x608ef2){console['log'](_0x608ef2);}}),router[a0_0x310399(0x22a)]('/view/add_sales',auth,async(_0x131b38,_0x4643d0)=>{var _0x10cada=a0_0x310399;try{const {invoice:_0x15b17f,date:_0x75f0d7,warehouse_name:_0x46a2e7,product_name:_0x172652,stock:_0x4767c1,quantity:_0x4efa3a,note:_0x1ea8b7,room:_0x2e8a77,primary_code:_0x3ee171,secondary_code:_0x51ef7c,prod_code:_0xebb340,level:_0x1d7db8,isle:_0x13c8d4,pallet:_0xb8ab67,batch_code:_0x351094,SCRN:_0x3900ed,expiry_date:_0xd40d3c}=_0x131b38[_0x10cada(0x1f0)];if(typeof _0x172652==_0x10cada(0x205))var _0x15bdc1=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x204)]],_0x2effa7=[_0x131b38['body'][_0x10cada(0x299)]],_0x1ad764=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x28e)]],_0x64d623=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x25a)]],_0x6c17c3=[_0x131b38['body'][_0x10cada(0x1a6)]],_0x15f645=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1a7)]],_0x38a8e7=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1fc)]],_0x1a1ab7=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x243)]],_0x166b06=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x237)]],_0x5df9de=[_0x131b38['body'][_0x10cada(0x25f)]],_0x3c61d9=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x216)]],_0x212f54=[_0x131b38[_0x10cada(0x1f0)]['max_per_unit']],_0x45ffcb=[_0x131b38[_0x10cada(0x1f0)]['production_date']],_0x27858c=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x258)]],_0x568b4e=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x2a7)]],_0x17b03a=[_0x131b38[_0x10cada(0x1f0)]['delivery_code']],_0x45667b=[_0x131b38['body']['prod_cat']],_0x54d7b8=[_0x131b38['body'][_0x10cada(0x20d)]],_0x55e987=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1ae)]],_0x495010=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x26f)]],_0x374c99=[_0x131b38[_0x10cada(0x1f0)]['actual_qty']],_0xb53725=[_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1f2)]];else var _0x15bdc1=[..._0x131b38['body'][_0x10cada(0x204)]],_0x2effa7=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x299)]],_0x1ad764=[..._0x131b38['body'][_0x10cada(0x28e)]],_0x64d623=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x25a)]],_0x6c17c3=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1a6)]],_0x15f645=[..._0x131b38['body'][_0x10cada(0x1a7)]],_0x38a8e7=[..._0x131b38[_0x10cada(0x1f0)]['level']],_0x1a1ab7=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x243)]],_0x166b06=[..._0x131b38['body']['secondary_unit']],_0x5df9de=[..._0x131b38[_0x10cada(0x1f0)]['batch_code']],_0x3c61d9=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x216)]],_0x212f54=[..._0x131b38['body'][_0x10cada(0x27b)]],_0x45ffcb=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1ff)]],_0x27858c=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x258)]],_0x568b4e=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x2a7)]],_0x17b03a=[..._0x131b38['body']['delivery_code']],_0x45667b=[..._0x131b38['body'][_0x10cada(0x29f)]],_0x54d7b8=[..._0x131b38['body'][_0x10cada(0x20d)]],_0x55e987=[..._0x131b38[_0x10cada(0x1f0)]['RoomAssigned']],_0x495010=[..._0x131b38[_0x10cada(0x1f0)]['prod_invoice']],_0x374c99=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x201)]],_0xb53725=[..._0x131b38[_0x10cada(0x1f0)][_0x10cada(0x1f2)]];const _0x153b16=_0x15bdc1[_0x10cada(0x1c9)](_0x519f58=>{return _0x519f58={'product_name':_0x519f58};});_0x2effa7['forEach']((_0x4b6dcf,_0x40d41b)=>{var _0x545b52=_0x10cada;_0x153b16[_0x40d41b][_0x545b52(0x299)]=Math['abs'](_0x4b6dcf);}),_0x374c99[_0x10cada(0x1eb)]((_0x95c6d5,_0x5d75a6)=>{var _0x35563d=_0x10cada;_0x153b16[_0x5d75a6][_0x35563d(0x201)]=Math[_0x35563d(0x1e5)](_0x95c6d5);}),_0xb53725['forEach']((_0x3e981e,_0x4ce2a4)=>{var _0x2ea471=_0x10cada;_0x153b16[_0x4ce2a4][_0x2ea471(0x1f2)]=_0x3e981e;}),_0x1ad764[_0x10cada(0x1eb)]((_0x128fa7,_0x4646f5)=>{var _0x564dfb=_0x10cada;_0x153b16[_0x4646f5][_0x564dfb(0x20d)]=_0x128fa7;}),_0x64d623[_0x10cada(0x1eb)]((_0x2084aa,_0x309725)=>{var _0x5567f3=_0x10cada;_0x153b16[_0x309725][_0x5567f3(0x25a)]=_0x2084aa;}),_0x6c17c3[_0x10cada(0x1eb)]((_0x44eb14,_0x1def5f)=>{_0x153b16[_0x1def5f]['secondary_code']=_0x44eb14;}),_0x15f645[_0x10cada(0x1eb)]((_0x3e8203,_0x322cce)=>{_0x153b16[_0x322cce]['product_code']=_0x3e8203;}),_0x38a8e7[_0x10cada(0x1eb)]((_0x23e142,_0x59766a)=>{var _0x3c2908=_0x10cada;_0x55e987[_0x3c2908(0x1eb)]((_0x444e0c,_0x325b64)=>{var _0x28ad1b=_0x3c2908;if(_0x444e0c==_0x28ad1b(0x24b)&&_0x59766a==_0x325b64){var _0x44d553=_0x23e142[_0x28ad1b(0x1c2)](0x3);_0x153b16[_0x59766a][_0x28ad1b(0x29d)]=_0x23e142[0x0],_0x153b16[_0x59766a]['rack']=_0x23e142[0x1],_0x153b16[_0x59766a]['bay']=0x0,_0x153b16[_0x59766a][_0x28ad1b(0x1fd)]=0x0,_0x153b16[_0x59766a][_0x28ad1b(0x1b4)]='Floor',_0x153b16[_0x59766a][_0x28ad1b(0x26b)]=_0x44d553;}else{if(_0x444e0c==_0x28ad1b(0x2a6)&&_0x59766a==_0x325b64){var _0x44d553=_0x23e142['slice'](0x3);_0x153b16[_0x59766a][_0x28ad1b(0x29d)]=_0x23e142[0x0],_0x153b16[_0x59766a]['rack']=_0x23e142[0x1],_0x153b16[_0x59766a][_0x28ad1b(0x287)]=0x0,_0x153b16[_0x59766a][_0x28ad1b(0x1fd)]=0x0,_0x153b16[_0x59766a]['type']='Floor',_0x153b16[_0x59766a][_0x28ad1b(0x26b)]=_0x23e142[0x5];}else{if(_0x59766a==_0x325b64){var _0x273b6c;if(_0x23e142[0x4]=='L')_0x273b6c=_0x28ad1b(0x233);else _0x23e142[0x4]=='F'&&(_0x273b6c=_0x28ad1b(0x23a));_0x153b16[_0x59766a][_0x28ad1b(0x29d)]=_0x23e142[0x0],_0x153b16[_0x59766a][_0x28ad1b(0x269)]=_0x23e142[0x1],_0x153b16[_0x59766a][_0x28ad1b(0x287)]=_0x23e142[0x2],_0x153b16[_0x59766a]['bin']=_0x23e142[0x3],_0x153b16[_0x59766a][_0x28ad1b(0x1b4)]=_0x273b6c,_0x153b16[_0x59766a][_0x28ad1b(0x26b)]=_0x23e142[0x5];}}}});}),_0x1a1ab7[_0x10cada(0x1eb)]((_0x4d49a8,_0x15cd79)=>{var _0x21b1f9=_0x10cada;_0x153b16[_0x15cd79][_0x21b1f9(0x26e)]=_0x4d49a8;}),_0x166b06['forEach']((_0x4938d0,_0xa3acf7)=>{var _0x18bcd0=_0x10cada;_0x153b16[_0xa3acf7][_0x18bcd0(0x237)]=_0x4938d0;}),_0x5df9de[_0x10cada(0x1eb)]((_0x20b309,_0x1dbf15)=>{_0x153b16[_0x1dbf15]['batch_code']=_0x20b309;}),_0x3c61d9[_0x10cada(0x1eb)]((_0x128cf4,_0x31b6f5)=>{var _0x447ec7=_0x10cada;_0x153b16[_0x31b6f5][_0x447ec7(0x216)]=_0x128cf4;}),_0x212f54[_0x10cada(0x1eb)]((_0x45a961,_0xf54ff4)=>{_0x153b16[_0xf54ff4]['maxperunit']=_0x45a961;}),_0x45ffcb['forEach']((_0x24fa18,_0x1df6ee)=>{var _0x57a279=_0x10cada;_0x153b16[_0x1df6ee][_0x57a279(0x1ff)]=_0x24fa18;}),_0x27858c[_0x10cada(0x1eb)]((_0x5b157b,_0xd8acdb)=>{_0x153b16[_0xd8acdb]['requested_qty']=_0x5b157b;}),_0x568b4e[_0x10cada(0x1eb)]((_0x1ccbc3,_0xc016a6)=>{var _0x3476f7=_0x10cada;_0x153b16[_0xc016a6][_0x3476f7(0x2a7)]=_0x1ccbc3;}),_0x17b03a['forEach']((_0x4355c9,_0x52f005)=>{_0x153b16[_0x52f005]['delivery_code']=_0x4355c9;}),_0x45667b[_0x10cada(0x1eb)]((_0x507877,_0x105c35)=>{var _0x5339ec=_0x10cada;_0x153b16[_0x105c35][_0x5339ec(0x29f)]=_0x507877;}),_0x54d7b8[_0x10cada(0x1eb)]((_0x5f294f,_0x57a94f)=>{_0x153b16[_0x57a94f]['quantity_notConverted']=_0x5f294f;}),_0x55e987[_0x10cada(0x1eb)]((_0x172cb4,_0x43742a)=>{var _0x52ce28=_0x10cada;_0x153b16[_0x43742a][_0x52ce28(0x21d)]=_0x172cb4;}),_0x495010['forEach']((_0x5a757f,_0x4b1202)=>{var _0x4195c9=_0x10cada;_0x153b16[_0x4b1202][_0x4195c9(0x284)]=_0x5a757f;});var _0x5637d0=0x0;_0x153b16[_0x10cada(0x1eb)](_0x166508=>{var _0x37e53b=_0x10cada;(_0x166508[_0x37e53b(0x299)]<_0x166508[_0x37e53b(0x1dd)]||_0x166508[_0x37e53b(0x1dd)]==0x0)&&(console[_0x37e53b(0x229)](_0x37e53b(0x29e),_0x166508),_0x5637d0++);});const _0x8c533d=_0x153b16[_0x10cada(0x1bf)](_0x39afc6=>_0x39afc6['quantity']!=='0'&&_0x39afc6[_0x10cada(0x20d)]!==''),_0x15663c=new sales({'invoice':_0x15b17f,'customer':_0x131b38[_0x10cada(0x1f0)][_0x10cada(0x209)],'date':_0x75f0d7,'warehouse_name':_0x46a2e7,'sale_product':_0x8c533d,'note':_0x1ea8b7,'room':_0x2e8a77,'primary_code':_0x3ee171,'secondary_code':_0x51ef7c,'prod_code':_0xebb340,'SCRN':_0x3900ed}),_0x583016=await _0x15663c[_0x10cada(0x1e1)]();_0x131b38[_0x10cada(0x260)](_0x10cada(0x206),'Sales\x20Add\x20successfully'),_0x4643d0[_0x10cada(0x1af)](_0x10cada(0x1b2)+_0x583016[_0x10cada(0x1d2)]);}catch(_0x344038){console[_0x10cada(0x229)](_0x344038);}}),router[a0_0x310399(0x259)]('/preview/:id',auth,async(_0x4b8f46,_0x4fe4bd)=>{var _0x453f06=a0_0x310399;try{const {username:_0x28fdd2,email:_0x5d88ea,role:_0x45d43a}=_0x4b8f46[_0x453f06(0x22b)],_0x177bb1=_0x4b8f46[_0x453f06(0x22b)],_0x411dcc=await profile['findOne']({'email':_0x177bb1[_0x453f06(0x28b)]}),_0x12445f=await master_shop[_0x453f06(0x223)](),_0x488c77=_0x4b8f46[_0x453f06(0x225)]['id'],_0x6ad6=await sales[_0x453f06(0x215)](_0x488c77),_0x58ab58=await warehouse[_0x453f06(0x272)]([{'$match':{'name':_0x6ad6['warehouse_name']}},{'$unwind':_0x453f06(0x1d5)},{'$group':{'_id':_0x453f06(0x24f),'name':{'$first':_0x453f06(0x1e3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x453f06(0x1c6)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x453f06(0x1f4)},'primary_code':{'$first':_0x453f06(0x1b8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x453f06(0x20b)},'storage':{'$first':_0x453f06(0x1ef)},'rack':{'$first':_0x453f06(0x1de)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x453f06(0x235)},'invoice':{'$first':_0x453f06(0x271)}}}]),_0x392786=await customer[_0x453f06(0x223)]({});let _0x4800fa;if(_0x177bb1[_0x453f06(0x2a3)]==_0x453f06(0x277)){const _0x120f20=await staff[_0x453f06(0x2b0)]({'email':_0x177bb1[_0x453f06(0x28b)]});_0x4800fa=await warehouse[_0x453f06(0x272)]([{'$match':{'status':_0x453f06(0x2a1),'name':_0x120f20[_0x453f06(0x283)]}},{'$group':{'_id':'$name','name':{'$first':_0x453f06(0x1e7)}}}]);}else _0x4800fa=await warehouse['aggregate']([{'$match':{'status':_0x453f06(0x2a1)}},{'$group':{'_id':_0x453f06(0x1e7),'name':{'$first':'$name'}}}]);const _0x3c8428=await product[_0x453f06(0x223)]({}),_0x379dc9=await suppliers[_0x453f06(0x223)]({});if(_0x12445f[0x0][_0x453f06(0x1bd)]==_0x453f06(0x295)){var _0x829d74=users[_0x453f06(0x1b1)];console[_0x453f06(0x229)](_0x829d74);}else{if(_0x12445f[0x0]['language']==_0x453f06(0x249))var _0x829d74=users['Hindi'];else{if(_0x12445f[0x0][_0x453f06(0x1bd)]==_0x453f06(0x1ad))var _0x829d74=users[_0x453f06(0x1ad)];else{if(_0x12445f[0x0]['language']=='Spanish')var _0x829d74=users[_0x453f06(0x1c5)];else{if(_0x12445f[0x0][_0x453f06(0x1bd)]==_0x453f06(0x232))var _0x829d74=users[_0x453f06(0x232)];else{if(_0x12445f[0x0][_0x453f06(0x1bd)]==_0x453f06(0x213))var _0x829d74=users[_0x453f06(0x291)];else{if(_0x12445f[0x0]['language']==_0x453f06(0x1b6))var _0x829d74=users[_0x453f06(0x1b6)];else{if(_0x12445f[0x0][_0x453f06(0x1bd)]=='Arabic\x20(ae)')var _0x829d74=users[_0x453f06(0x1c3)];}}}}}}}_0x4fe4bd[_0x453f06(0x298)](_0x453f06(0x2a0),{'success':_0x4b8f46[_0x453f06(0x260)](_0x453f06(0x206)),'errors':_0x4b8f46[_0x453f06(0x260)](_0x453f06(0x1d3)),'role':_0x177bb1,'profile':_0x411dcc,'customer':_0x392786,'warehouse':_0x4800fa,'product':_0x58ab58,'user':_0x6ad6,'master_shop':_0x12445f,'unit':_0x3c8428,'language':_0x829d74,'suppliers':_0x379dc9});}catch(_0x17f010){console[_0x453f06(0x229)](_0x17f010);}}),router[a0_0x310399(0x22a)]('/preview/:id',auth,async(_0x28268f,_0x5ec733)=>{var _0x1dbc48=a0_0x310399;try{const _0x2b2676=_0x28268f[_0x1dbc48(0x225)]['id'],{invoice:_0x4d8c6a,warehouse_name:_0x16e2ce,room:_0x58ab2f}=_0x28268f[_0x1dbc48(0x1f0)],_0x4c0d2e=await sales[_0x1dbc48(0x2b0)]({'invoice':_0x4d8c6a}),_0x251c13=_0x4c0d2e[_0x1dbc48(0x25e)][_0x1dbc48(0x1c9)](async _0x5b3682=>{var _0x376a06=_0x1dbc48,_0xfba23=await warehouse['findOne']({'name':_0x16e2ce,'room':_0x5b3682[_0x376a06(0x21d)],'warehouse_category':_0x376a06(0x1f3)});const _0x3210da=_0xfba23['product_details']['map'](_0x12d3e0=>{var _0x10c227=_0x376a06;_0x12d3e0['product_name']==_0x5b3682['product_name']&&_0x12d3e0['floorlevel']==_0x5b3682[_0x10c227(0x26b)]&&_0x12d3e0[_0x10c227(0x1b4)]==_0x5b3682[_0x10c227(0x1b4)]&&_0x12d3e0[_0x10c227(0x1fd)]==_0x5b3682[_0x10c227(0x1fd)]&&_0x12d3e0[_0x10c227(0x287)]==_0x5b3682[_0x10c227(0x287)]&&_0x12d3e0['rack']==_0x5b3682[_0x10c227(0x269)]&&_0x12d3e0['storage']==_0x5b3682[_0x10c227(0x29d)]&&_0x12d3e0[_0x10c227(0x216)]==_0x5b3682[_0x10c227(0x216)]&&_0x12d3e0[_0x10c227(0x25f)]==_0x5b3682['batch_code']&&_0x12d3e0['invoice']==_0x5b3682[_0x10c227(0x284)]&&(_0x12d3e0['product_stock']=Math[_0x10c227(0x207)](0x0,Math[_0x10c227(0x1e5)](_0x12d3e0[_0x10c227(0x224)])-Math[_0x10c227(0x1e5)](_0x5b3682[_0x10c227(0x20d)])));});return _0xfba23;});Promise[_0x1dbc48(0x25c)](_0x251c13)[_0x1dbc48(0x2ae)](async _0x56f228=>{var _0x3275dd=_0x1dbc48;try{for(const _0x3d2994 of _0x56f228){await _0x3d2994[_0x3275dd(0x1e1)]();}_0x4c0d2e['finalize']='True';const _0x11b59c=await _0x4c0d2e[_0x3275dd(0x1e1)](),_0x9ac688=await master_shop[_0x3275dd(0x223)](),_0x4b3b66=await email_settings['findOne'](),_0x292bc0=await supervisor_settings['find']();var _0x4fcbde=_0x4c0d2e['sale_product'],_0x3dede3='',_0x5ec4ea;for(_0x5ec4ea in _0x4fcbde){_0x3dede3+=_0x3275dd(0x23d)+_0x3275dd(0x266)+_0x4fcbde[_0x5ec4ea]['product_name']+_0x3275dd(0x2ad)+_0x3275dd(0x266)+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x26a)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fcbde[_0x5ec4ea]['quantity']+'</td>'+_0x3275dd(0x266)+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x26e)]+'</td>'+_0x3275dd(0x266)+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x237)]+_0x3275dd(0x2ad)+_0x3275dd(0x266)+_0x4c0d2e[_0x3275dd(0x1ac)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x21d)]+'</td>'+_0x3275dd(0x266)+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x29d)]+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x269)]+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x287)]+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x1fd)]+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x1b4)][0x0]+_0x4fcbde[_0x5ec4ea][_0x3275dd(0x26b)]+_0x3275dd(0x2ad),'</tr>';}let _0x236ba5=nodemailer['createTransport']({'host':_0x4b3b66[_0x3275dd(0x28c)],'port':Number(_0x4b3b66[_0x3275dd(0x217)]),'secure':![],'auth':{'user':_0x4b3b66['email'],'pass':_0x4b3b66[_0x3275dd(0x200)]}}),_0x15f81c={'from':_0x4b3b66[_0x3275dd(0x28b)],'to':_0x292bc0[0x0][_0x3275dd(0x221)],'subject':_0x3275dd(0x214),'attachments':[{'filename':_0x3275dd(0x1c8),'path':__dirname+_0x3275dd(0x208)+_0x3275dd(0x202)+_0x9ac688[0x0][_0x3275dd(0x210)],'cid':_0x3275dd(0x242)}],'html':_0x3275dd(0x23c)+_0x3275dd(0x267)+_0x3275dd(0x23e)+_0x3275dd(0x1d0)+_0x3275dd(0x1b7)+_0x3275dd(0x1d0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x3275dd(0x1d0)+_0x3275dd(0x203)+_0x9ac688[0x0][_0x3275dd(0x1f7)]+_0x3275dd(0x22f)+_0x3275dd(0x211)+_0x3275dd(0x211)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x4c0d2e[_0x3275dd(0x284)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3275dd(0x1c7)+_0x4c0d2e['date']+'\x20'+_0x3275dd(0x20f)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3275dd(0x23d)+_0x3275dd(0x212)+_0x3275dd(0x1cf)+_0x3275dd(0x285)+_0x3275dd(0x23b)+_0x3275dd(0x22c)+_0x3275dd(0x27c)+_0x3275dd(0x276)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3275dd(0x2a4)+_0x3275dd(0x1da)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3dede3+'\x20'+_0x3275dd(0x1cd)+_0x3275dd(0x219)+_0x3275dd(0x1d0)+_0x3275dd(0x1e4)+'<h5>'+_0x9ac688[0x0][_0x3275dd(0x1f7)]+'</h5>'+'</div>'+_0x3275dd(0x211)+'</body></html>'};_0x236ba5[_0x3275dd(0x1dc)](_0x15f81c,function(_0x180a51,_0x351ccc){var _0x5cef0b=_0x3275dd;_0x180a51?(console[_0x5cef0b(0x229)](_0x180a51),console[_0x5cef0b(0x229)](_0x5cef0b(0x1d7))):console[_0x5cef0b(0x229)](_0x5cef0b(0x1fa));}),_0x28268f['flash'](_0x3275dd(0x206),_0x3275dd(0x1e2)),_0x5ec733['redirect']('/all_sales/preview/'+_0x2b2676);}catch(_0x25d768){console[_0x3275dd(0x1e0)](_0x25d768),_0x5ec733[_0x3275dd(0x252)](0x1f4)[_0x3275dd(0x27e)]({'error':_0x3275dd(0x1a8)});}})[_0x1dbc48(0x1e6)](_0x26b556=>{var _0xed36d5=_0x1dbc48;console['error'](_0x26b556),_0x5ec733['status'](0x1f4)['json']({'error':_0xed36d5(0x1c1)});});}catch(_0x1d90c8){console['log'](_0x1d90c8);}}),router[a0_0x310399(0x259)]('/view/:id',auth,async(_0x1c1f1e,_0x9e0e77)=>{var _0x2720d3=a0_0x310399;try{const {username:_0x1e9dd6,email:_0x9d4534,role:_0x4a8401}=_0x1c1f1e['user'],_0x3ee56a=_0x1c1f1e[_0x2720d3(0x22b)],_0x1d55d1=await profile[_0x2720d3(0x2b0)]({'email':_0x3ee56a[_0x2720d3(0x28b)]}),_0x5043ac=await master_shop[_0x2720d3(0x223)](),_0x5a5fff=_0x1c1f1e['params']['id'],_0x4c78a8=await sales[_0x2720d3(0x215)](_0x5a5fff);var _0x389ae7=[_0x2720d3(0x1bb),'Enclosed'];const _0x4f3870=await warehouse[_0x2720d3(0x272)]([{'$match':{'name':_0x4c78a8[_0x2720d3(0x1ac)],'warehouse_category':_0x2720d3(0x1f3)}},{'$unwind':_0x2720d3(0x1d5)},{'$group':{'_id':_0x2720d3(0x24f),'name':{'$first':_0x2720d3(0x1e3)},'product_stock':{'$first':_0x2720d3(0x255)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2720d3(0x29c)},'type':{'$first':_0x2720d3(0x1df)},'floorlevel':{'$first':_0x2720d3(0x1f4)},'primary_code':{'$first':_0x2720d3(0x1b8)},'secondary_code':{'$first':_0x2720d3(0x1d6)},'product_code':{'$first':_0x2720d3(0x20b)},'storage':{'$first':_0x2720d3(0x1ef)},'rack':{'$first':_0x2720d3(0x1de)}}}]),_0x5d30c5=await customer[_0x2720d3(0x223)]({});let _0x698b78;if(_0x3ee56a[_0x2720d3(0x2a3)]==_0x2720d3(0x277)){const _0x2f811b=await staff[_0x2720d3(0x2b0)]({'email':_0x3ee56a[_0x2720d3(0x28b)]});_0x698b78=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2f811b[_0x2720d3(0x283)],'warehouse_category':_0x2720d3(0x1f3)}},{'$group':{'_id':_0x2720d3(0x1e7),'name':{'$first':_0x2720d3(0x1e7)}}}]);}else _0x698b78=await warehouse['aggregate']([{'$match':{'status':_0x2720d3(0x2a1),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2720d3(0x1e7),'name':{'$first':_0x2720d3(0x1e7)}}}]);const _0x1cf38a=await product[_0x2720d3(0x223)]({});if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x295)){var _0x20b9a5=users[_0x2720d3(0x1b1)];console[_0x2720d3(0x229)](_0x20b9a5);}else{if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x249))var _0x20b9a5=users[_0x2720d3(0x249)];else{if(_0x5043ac[0x0]['language']=='German')var _0x20b9a5=users['German'];else{if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x1c5))var _0x20b9a5=users[_0x2720d3(0x1c5)];else{if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x232))var _0x20b9a5=users['French'];else{if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x213))var _0x20b9a5=users[_0x2720d3(0x291)];else{if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x1b6))var _0x20b9a5=users[_0x2720d3(0x1b6)];else{if(_0x5043ac[0x0][_0x2720d3(0x1bd)]==_0x2720d3(0x1fb))var _0x20b9a5=users[_0x2720d3(0x1c3)];}}}}}}}_0x9e0e77[_0x2720d3(0x298)](_0x2720d3(0x2a9),{'success':_0x1c1f1e[_0x2720d3(0x260)](_0x2720d3(0x206)),'errors':_0x1c1f1e[_0x2720d3(0x260)](_0x2720d3(0x1d3)),'role':_0x3ee56a,'profile':_0x1d55d1,'customer':_0x5d30c5,'warehouse':_0x698b78,'product':_0x4f3870,'user':_0x4c78a8,'master_shop':_0x5043ac,'unit':_0x1cf38a,'language':_0x20b9a5});}catch(_0x3bd379){console[_0x2720d3(0x229)](_0x3bd379);}}),router[a0_0x310399(0x22a)](a0_0x310399(0x29b),auth,async(_0x2c1f0e,_0x3c9863)=>{var _0x311653=a0_0x310399;try{const _0x38c811=_0x2c1f0e[_0x311653(0x225)]['id'],_0xa61198=await sales['findOne']({'_id':_0x2c1f0e[_0x311653(0x225)]['id']}),_0x2d538d=await warehouse['findOne']({'name':_0xa61198[_0x311653(0x1ac)],'room':_0x2c1f0e['body'][_0x311653(0x2a8)]}),{invoice:_0x48fb9d,date:_0x1d43f1,warehouse_name:_0x276fc1,product_name:_0x6ef2f1,stock:_0x5d2195,quantity:_0xa27029,note:_0xe7b86c,room:_0x4935a7,customer:_0x4329eb,SCRN:_0x3c456f}=_0x2c1f0e[_0x311653(0x1f0)];if(typeof _0x6ef2f1==_0x311653(0x205))var _0xec1017=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x204)]],_0x5cc773=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x299)]],_0xb2e9=[_0x2c1f0e[_0x311653(0x1f0)]['carton']],_0x3c6662=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x25a)]],_0x10ead6=[_0x2c1f0e['body'][_0x311653(0x1a6)]],_0x4d62a4=[_0x2c1f0e['body'][_0x311653(0x1a7)]],_0x331afd=[_0x2c1f0e[_0x311653(0x1f0)]['level']],_0x1c0656=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x243)]],_0x352c8d=[_0x2c1f0e['body'][_0x311653(0x237)]],_0x924c97=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x25f)]],_0x39faec=[_0x2c1f0e['body'][_0x311653(0x216)]],_0x40f7e6=[_0x2c1f0e['body'][_0x311653(0x27b)]],_0x3957e8=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x1ff)]],_0x1684ef=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x258)]],_0x464a77=[_0x2c1f0e[_0x311653(0x1f0)]['delivery_date']],_0x32f83b=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x21f)]],_0x6dfa6=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x29f)]],_0x12d047=[_0x2c1f0e['body'][_0x311653(0x20d)]],_0x5e8912=[_0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x1ae)]];else var _0xec1017=[..._0x2c1f0e[_0x311653(0x1f0)]['product_name']],_0x5cc773=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x299)]],_0xb2e9=[..._0x2c1f0e[_0x311653(0x1f0)]['carton']],_0x3c6662=[..._0x2c1f0e['body'][_0x311653(0x25a)]],_0x10ead6=[..._0x2c1f0e['body'][_0x311653(0x1a6)]],_0x4d62a4=[..._0x2c1f0e[_0x311653(0x1f0)]['prod_code']],_0x331afd=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x1fc)]],_0x1c0656=[..._0x2c1f0e[_0x311653(0x1f0)]['primary_unit']],_0x352c8d=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x237)]],_0x924c97=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x25f)]],_0x39faec=[..._0x2c1f0e[_0x311653(0x1f0)]['expiry_date']],_0x40f7e6=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x27b)]],_0x3957e8=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x1ff)]],_0x1684ef=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x258)]],_0x464a77=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x2a7)]],_0x32f83b=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x21f)]],_0x6dfa6=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x29f)]],_0x12d047=[..._0x2c1f0e[_0x311653(0x1f0)][_0x311653(0x20d)]],_0x5e8912=[..._0x2c1f0e[_0x311653(0x1f0)]['RoomAssigned']];const _0x20e227=_0xec1017[_0x311653(0x1c9)](_0x3bce6c=>{return _0x3bce6c={'product_name':_0x3bce6c};});_0x5cc773[_0x311653(0x1eb)]((_0x4bd06d,_0x6267ef)=>{var _0x177fa9=_0x311653;_0x20e227[_0x6267ef][_0x177fa9(0x299)]=Math[_0x177fa9(0x1e5)](_0x4bd06d);}),_0xb2e9[_0x311653(0x1eb)]((_0x157326,_0x59535c)=>{var _0xdcd572=_0x311653;_0x20e227[_0x59535c][_0xdcd572(0x20d)]=_0x157326;}),_0x3c6662['forEach']((_0x64be43,_0x2f7336)=>{var _0x1bc212=_0x311653;_0x20e227[_0x2f7336][_0x1bc212(0x25a)]=_0x64be43;}),_0x10ead6['forEach']((_0xb42e59,_0x18fefa)=>{var _0x2c240d=_0x311653;_0x20e227[_0x18fefa][_0x2c240d(0x1a6)]=_0xb42e59;}),_0x4d62a4['forEach']((_0x453623,_0x28fa01)=>{var _0x3a30c2=_0x311653;_0x20e227[_0x28fa01][_0x3a30c2(0x26a)]=_0x453623;}),_0x331afd[_0x311653(0x1eb)]((_0x48a9d3,_0x18b6ac)=>{var _0x2c18a7=_0x311653;_0x5e8912[_0x2c18a7(0x1eb)]((_0x3d10b5,_0x14045a)=>{var _0x412739=_0x2c18a7;if(_0x3d10b5==_0x412739(0x24b)&&_0x18b6ac==_0x14045a){var _0x39a7f8=_0x48a9d3[_0x412739(0x1c2)](0x3);_0x20e227[_0x18b6ac][_0x412739(0x29d)]=_0x48a9d3[0x0],_0x20e227[_0x18b6ac][_0x412739(0x269)]=_0x48a9d3[0x1],_0x20e227[_0x18b6ac][_0x412739(0x287)]=0x0,_0x20e227[_0x18b6ac][_0x412739(0x1fd)]=0x0,_0x20e227[_0x18b6ac][_0x412739(0x1b4)]='Floor',_0x20e227[_0x18b6ac][_0x412739(0x26b)]=_0x39a7f8;}else{if(_0x3d10b5==_0x412739(0x2a6)&&_0x18b6ac==_0x14045a){var _0x39a7f8=_0x48a9d3[_0x412739(0x1c2)](0x3);_0x20e227[_0x18b6ac][_0x412739(0x29d)]=_0x48a9d3[0x0],_0x20e227[_0x18b6ac][_0x412739(0x269)]=_0x48a9d3[0x1],_0x20e227[_0x18b6ac][_0x412739(0x287)]=0x0,_0x20e227[_0x18b6ac][_0x412739(0x1fd)]=0x0,_0x20e227[_0x18b6ac][_0x412739(0x1b4)]='Floor',_0x20e227[_0x18b6ac][_0x412739(0x26b)]=_0x48a9d3[0x5];}else{if(_0x18b6ac==_0x14045a){var _0x5434b3;if(_0x48a9d3[0x4]=='L')_0x5434b3=_0x412739(0x233);else _0x48a9d3[0x4]=='F'&&(_0x5434b3=_0x412739(0x23a));_0x20e227[_0x18b6ac][_0x412739(0x29d)]=_0x48a9d3[0x0],_0x20e227[_0x18b6ac][_0x412739(0x269)]=_0x48a9d3[0x1],_0x20e227[_0x18b6ac]['bay']=_0x48a9d3[0x2],_0x20e227[_0x18b6ac][_0x412739(0x1fd)]=_0x48a9d3[0x3],_0x20e227[_0x18b6ac]['type']=_0x5434b3,_0x20e227[_0x18b6ac][_0x412739(0x26b)]=_0x48a9d3[0x5];}}}});}),_0x1c0656['forEach']((_0x455163,_0x32c31)=>{_0x20e227[_0x32c31]['unit']=_0x455163;}),_0x352c8d[_0x311653(0x1eb)]((_0x5f58ee,_0x3ec9c6)=>{var _0x42539c=_0x311653;_0x20e227[_0x3ec9c6][_0x42539c(0x237)]=_0x5f58ee;}),_0x924c97[_0x311653(0x1eb)]((_0x138a43,_0x5e3042)=>{var _0x279373=_0x311653;_0x20e227[_0x5e3042][_0x279373(0x25f)]=_0x138a43;}),_0x39faec['forEach']((_0x4015f8,_0x4bbd99)=>{var _0x1f1a7b=_0x311653;_0x20e227[_0x4bbd99][_0x1f1a7b(0x216)]=_0x4015f8;}),_0x40f7e6[_0x311653(0x1eb)]((_0x2b1a0c,_0x17a1d4)=>{var _0x465bd2=_0x311653;_0x20e227[_0x17a1d4][_0x465bd2(0x297)]=_0x2b1a0c;}),_0x3957e8[_0x311653(0x1eb)]((_0x43befa,_0x3ab3a2)=>{var _0x4ea94d=_0x311653;_0x20e227[_0x3ab3a2][_0x4ea94d(0x1ff)]=_0x43befa;}),_0x1684ef[_0x311653(0x1eb)]((_0x1af195,_0x5eda1c)=>{var _0x5a9924=_0x311653;_0x20e227[_0x5eda1c][_0x5a9924(0x258)]=Math['abs'](_0x1af195);}),_0x464a77['forEach']((_0x3d86a0,_0x28ea1c)=>{_0x20e227[_0x28ea1c]['delivery_date']=_0x3d86a0;}),_0x32f83b[_0x311653(0x1eb)]((_0x384700,_0x19befe)=>{var _0x737fc2=_0x311653;_0x20e227[_0x19befe][_0x737fc2(0x21f)]=_0x384700;}),_0x6dfa6['forEach']((_0x3614b6,_0x1f3b89)=>{_0x20e227[_0x1f3b89]['prod_cat']=_0x3614b6;}),_0x12d047[_0x311653(0x1eb)]((_0x5f2396,_0x39da0)=>{var _0x3635b3=_0x311653;_0x20e227[_0x39da0][_0x3635b3(0x1dd)]=_0x5f2396;}),_0x5e8912[_0x311653(0x1eb)]((_0x120195,_0x4bfc0c)=>{_0x20e227[_0x4bfc0c]['room_name']=_0x120195;});var _0x370937=0x0;_0x20e227[_0x311653(0x1eb)](_0x3dafe6=>{var _0x5819d3=_0x311653;console['log'](_0x5819d3(0x29e),_0x3dafe6),(parseInt(_0x3dafe6[_0x5819d3(0x299)])<parseInt(_0x3dafe6[_0x5819d3(0x20d)])||parseInt(_0x3dafe6[_0x5819d3(0x20d)])==0x0)&&_0x370937++;});if(_0x370937!=0x0)return _0x2c1f0e['flash'](_0x311653(0x1d3),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3c9863[_0x311653(0x1af)]('back');const _0x24df58=_0x20e227['filter'](_0x1e1ef7=>_0x1e1ef7[_0x311653(0x20d)]!=='0'&&_0x1e1ef7[_0x311653(0x20d)]!=='');_0xa61198[_0x311653(0x284)]=_0x48fb9d,_0xa61198[_0x311653(0x209)]=_0x4329eb,_0xa61198[_0x311653(0x25b)]=_0x1d43f1,_0xa61198['warehouse_name']=_0x276fc1,_0xa61198[_0x311653(0x25e)]=_0x24df58,_0xa61198[_0x311653(0x251)]=_0xe7b86c,_0xa61198['SCRN']=_0x3c456f,_0xa61198[_0x311653(0x20a)]=_0x311653(0x1cb),_0xa61198[_0x311653(0x220)]='False';const _0x198dfe=await _0xa61198[_0x311653(0x1e1)]();_0x2c1f0e[_0x311653(0x260)]('success',_0x311653(0x1e2)),_0x3c9863[_0x311653(0x1af)](_0x311653(0x25d));}catch(_0x95af49){console[_0x311653(0x229)](_0x95af49);}}),router[a0_0x310399(0x22a)](a0_0x310399(0x23f),auth,async(_0x62de31,_0x3ddd81)=>{var _0xf90fa=a0_0x310399;try{const _0x36900a=_0x62de31['params']['id'],{invoice:_0x3e4d89,customer:_0x25b150,receivable_amount:_0x16b11,received_amount:_0x75074e}=_0x62de31[_0xf90fa(0x1f0)],_0x46f30d=await sales[_0xf90fa(0x215)](_0x36900a);console[_0xf90fa(0x229)](_0x46f30d);var _0x5328ef=_0x16b11-_0x75074e;console[_0xf90fa(0x229)](_0x75074e),_0x46f30d[_0xf90fa(0x1e9)]=parseFloat(_0x75074e)+parseFloat(_0x46f30d[_0xf90fa(0x1e9)]),_0x46f30d[_0xf90fa(0x24a)]=_0x5328ef,console[_0xf90fa(0x229)](_0x46f30d);const _0x172d27=await _0x46f30d[_0xf90fa(0x1e1)](),_0x282c72=await c_payment_data['findOne']({'invoice':_0x3e4d89});_0x282c72[_0xf90fa(0x1d8)]=_0x5328ef,await _0x282c72[_0xf90fa(0x1e1)]();let _0xfcc6f7=new Date(),_0x2d2ee1=('0'+_0xfcc6f7['getDate']())[_0xf90fa(0x1c2)](-0x2),_0x3b5b31=('0'+(_0xfcc6f7['getMonth']()+0x1))[_0xf90fa(0x1c2)](-0x2),_0x5219bc=_0xfcc6f7[_0xf90fa(0x1db)](),_0x2f69ef=_0x5219bc+'-'+_0x3b5b31+'-'+_0x2d2ee1;const _0x1da9d6=new customer_payment({'invoice':_0x3e4d89,'date':_0x5219bc+'-'+_0x3b5b31+'-'+_0x2d2ee1,'customer':_0x25b150,'reason':_0xf90fa(0x1f6),'amount':_0x75074e}),_0x3d3265=await _0x1da9d6[_0xf90fa(0x1e1)]();_0x62de31[_0xf90fa(0x260)](_0xf90fa(0x206),_0xf90fa(0x26c)),_0x3ddd81['redirect']('/all_sales/view');}catch(_0x3b0ef3){console[_0xf90fa(0x229)](_0x3b0ef3);}}),router[a0_0x310399(0x259)]('/invoice/:id',auth,async(_0x225acd,_0xfe3537)=>{var _0x1893ea=a0_0x310399;try{const {username:_0x42a6e6,email:_0x4c6ec4,role:_0x248b92}=_0x225acd[_0x1893ea(0x22b)],_0x2cf5a2=_0x225acd['user'],_0x58877c=await profile[_0x1893ea(0x2b0)]({'email':_0x2cf5a2['email']}),_0x395726=await master_shop['find']();console[_0x1893ea(0x229)]('master',_0x395726);const _0xdc7930=_0x225acd[_0x1893ea(0x225)]['id'],_0x6cb0f3=await sales[_0x1893ea(0x215)](_0xdc7930);console[_0x1893ea(0x229)](_0x6cb0f3);const _0x206b04=await customer[_0x1893ea(0x2b0)]({'name':_0x6cb0f3[_0x1893ea(0x209)]});console[_0x1893ea(0x229)](_0x206b04);if(_0x395726[0x0]['language']==_0x1893ea(0x295)){var _0x479330=users['English'];console[_0x1893ea(0x229)](_0x479330);}else{if(_0x395726[0x0][_0x1893ea(0x1bd)]==_0x1893ea(0x249))var _0x479330=users[_0x1893ea(0x249)];else{if(_0x395726[0x0]['language']==_0x1893ea(0x1ad))var _0x479330=users['German'];else{if(_0x395726[0x0][_0x1893ea(0x1bd)]=='Spanish')var _0x479330=users[_0x1893ea(0x1c5)];else{if(_0x395726[0x0][_0x1893ea(0x1bd)]==_0x1893ea(0x232))var _0x479330=users['French'];else{if(_0x395726[0x0]['language']=='Portuguese\x20(BR)')var _0x479330=users['Portuguese'];else{if(_0x395726[0x0][_0x1893ea(0x1bd)]==_0x1893ea(0x1b6))var _0x479330=users[_0x1893ea(0x1b6)];else{if(_0x395726[0x0][_0x1893ea(0x1bd)]==_0x1893ea(0x1fb))var _0x479330=users[_0x1893ea(0x1c3)];}}}}}}}_0xfe3537['render'](_0x1893ea(0x26d),{'success':_0x225acd[_0x1893ea(0x260)]('success'),'errors':_0x225acd[_0x1893ea(0x260)](_0x1893ea(0x1d3)),'role':_0x2cf5a2,'profile':_0x58877c,'master_shop':_0x395726,'customers':_0x206b04,'sales':_0x6cb0f3,'language':_0x479330});}catch(_0x189190){console[_0x1893ea(0x229)](_0x189190);}}),router[a0_0x310399(0x259)](a0_0x310399(0x222),auth,async(_0x123244,_0x2a7c64)=>{var _0xf5e32d=a0_0x310399;try{const {username:_0x555c7a,email:_0x45db79,role:_0x1687c4}=_0x123244[_0xf5e32d(0x22b)],_0x58defa=_0x123244[_0xf5e32d(0x22b)],_0x4c6189=await profile[_0xf5e32d(0x2b0)]({'email':_0x58defa[_0xf5e32d(0x28b)]}),_0xbb2f04=await master_shop[_0xf5e32d(0x223)]();console['log'](_0xf5e32d(0x1a9),_0xbb2f04);const _0x7e6e58=_0x123244[_0xf5e32d(0x225)]['id'];console['log'](_0x7e6e58);const _0x5ade8e=await sales['findById'](_0x7e6e58);console[_0xf5e32d(0x229)](_0xf5e32d(0x21b),_0x5ade8e);const _0x580712=await warehouse[_0xf5e32d(0x272)]([{'$match':{'name':_0xf5e32d(0x21a),'room':_0xf5e32d(0x2b1)}},{'$unwind':_0xf5e32d(0x1d5)},{'$group':{'_id':_0xf5e32d(0x24f),'name':{'$first':_0xf5e32d(0x1e3)},'product_stock':{'$first':_0xf5e32d(0x255)},'level':{'$first':_0xf5e32d(0x254)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xf5e32d(0x1b9)},'primary_code':{'$first':_0xf5e32d(0x1b8)},'secondary_code':{'$first':_0xf5e32d(0x1d6)},'product_code':{'$first':_0xf5e32d(0x20b)}}}]);console[_0xf5e32d(0x229)]('stock_data',_0x580712);const _0x2f487f=await product['find']({});warehouse_data=await warehouse[_0xf5e32d(0x272)]([{'$match':{'status':_0xf5e32d(0x2a1),'name':'Return\x20Goods','warehouse_category':_0xf5e32d(0x1f3)}},{'$group':{'_id':_0xf5e32d(0x1e7),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x1e6993=[_0xf5e32d(0x2b1)];if(_0xbb2f04[0x0]['language']==_0xf5e32d(0x295)){var _0x541b65=users[_0xf5e32d(0x1b1)];console[_0xf5e32d(0x229)](_0x541b65);}else{if(_0xbb2f04[0x0][_0xf5e32d(0x1bd)]==_0xf5e32d(0x249))var _0x541b65=users[_0xf5e32d(0x249)];else{if(_0xbb2f04[0x0][_0xf5e32d(0x1bd)]==_0xf5e32d(0x1ad))var _0x541b65=users[_0xf5e32d(0x1ad)];else{if(_0xbb2f04[0x0]['language']==_0xf5e32d(0x1c5))var _0x541b65=users[_0xf5e32d(0x1c5)];else{if(_0xbb2f04[0x0][_0xf5e32d(0x1bd)]=='French')var _0x541b65=users[_0xf5e32d(0x232)];else{if(_0xbb2f04[0x0][_0xf5e32d(0x1bd)]=='Portuguese\x20(BR)')var _0x541b65=users[_0xf5e32d(0x291)];else{if(_0xbb2f04[0x0][_0xf5e32d(0x1bd)]==_0xf5e32d(0x1b6))var _0x541b65=users[_0xf5e32d(0x1b6)];else{if(_0xbb2f04[0x0][_0xf5e32d(0x1bd)]==_0xf5e32d(0x1fb))var _0x541b65=users[_0xf5e32d(0x1c3)];}}}}}}}_0x2a7c64[_0xf5e32d(0x298)](_0xf5e32d(0x265),{'success':_0x123244[_0xf5e32d(0x260)](_0xf5e32d(0x206)),'errors':_0x123244[_0xf5e32d(0x260)](_0xf5e32d(0x1d3)),'role':_0x58defa,'profile':_0x4c6189,'user':_0x5ade8e,'stock':_0x580712,'master_shop':_0xbb2f04,'unit':_0x2f487f,'language':_0x541b65,'warehouses':warehouse_data,'rooms':_0x1e6993});}catch(_0xdeb67f){console[_0xf5e32d(0x229)](_0xdeb67f),_0x2a7c64[_0xf5e32d(0x252)](0xc8)[_0xf5e32d(0x27e)]({'message':_0xdeb67f['message']});}}),router[a0_0x310399(0x22a)](a0_0x310399(0x222),auth,async(_0x2fac9b,_0x53e7e2)=>{var _0x49c751=a0_0x310399;try{const {invoice:_0x85f7b3,date:_0x4cfdaa,warehouse_name:_0x377c87,product_name:_0x12d01f,primary_code:_0x5c336a,secondary_code:_0x400336,product_code:_0x45d64d,sales_quantity:_0x5b3909,stocks:_0x2316df,return_qty:_0x3f0a07,Room_name:_0x1ad357,to_warehouse_name:_0x3038c2,to_Roomname:_0x29668e,to_Room_name:_0x63fd4a,note:_0x122fe9,level:_0x1e904b,isle:_0x2e6dfe,pallet:_0x24dfba}=_0x2fac9b['body'];if(typeof _0x12d01f==_0x49c751(0x205))var _0x53d203=[_0x2fac9b['body'][_0x49c751(0x204)]],_0xf91fb0=[_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x25a)]],_0x360d28=[_0x2fac9b['body'][_0x49c751(0x1a6)]],_0x4554e7=[_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x26a)]],_0x1ce272=[_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x275)]],_0x5d54fc=[_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x1c4)]],_0x31cb92=[_0x2fac9b['body'][_0x49c751(0x239)]],_0x1dae86=[_0x2fac9b[_0x49c751(0x1f0)]['bay']],_0x51d74e=[_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x1fd)]],_0x4793e7=[_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x28a)]],_0x47c8a6=[_0x2fac9b['body'][_0x49c751(0x26b)]];else var _0x53d203=[..._0x2fac9b['body'][_0x49c751(0x204)]],_0xf91fb0=[..._0x2fac9b['body'][_0x49c751(0x25a)]],_0x360d28=[..._0x2fac9b['body'][_0x49c751(0x1a6)]],_0x4554e7=[..._0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x26a)]],_0x1ce272=[..._0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x275)]],_0x5d54fc=[..._0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x1c4)]],_0x31cb92=[..._0x2fac9b['body'][_0x49c751(0x239)]],_0x1dae86=[..._0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x287)]],_0x51d74e=[..._0x2fac9b['body'][_0x49c751(0x1fd)]],_0x4793e7=[..._0x2fac9b['body'][_0x49c751(0x28a)]],_0x47c8a6=[..._0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x26b)]];const _0x1223dd=_0x53d203['map'](_0x58ba9e=>{return _0x58ba9e={'product_name':_0x58ba9e};});_0xf91fb0[_0x49c751(0x1eb)]((_0x44da7a,_0x3f0b7e)=>{var _0x327f1b=_0x49c751;_0x1223dd[_0x3f0b7e][_0x327f1b(0x25a)]=_0x44da7a;}),_0x360d28[_0x49c751(0x1eb)]((_0x2a6e82,_0x127466)=>{var _0x24e06d=_0x49c751;_0x1223dd[_0x127466][_0x24e06d(0x1a6)]=_0x2a6e82;}),_0x4554e7['forEach']((_0xdb2f48,_0x18e698)=>{var _0x57ea00=_0x49c751;_0x1223dd[_0x18e698][_0x57ea00(0x26a)]=_0xdb2f48;}),_0x1ce272[_0x49c751(0x1eb)]((_0x1e032e,_0x4a6bc8)=>{_0x1223dd[_0x4a6bc8]['sale_qty']=_0x1e032e;}),_0x5d54fc['forEach']((_0x5ca03c,_0x438593)=>{var _0x10a754=_0x49c751;_0x1223dd[_0x438593][_0x10a754(0x299)]=_0x5ca03c;}),_0x31cb92['forEach']((_0x3a03b5,_0xe886a5)=>{var _0x16d255=_0x49c751;_0x1223dd[_0xe886a5][_0x16d255(0x239)]=_0x3a03b5;}),_0x1dae86[_0x49c751(0x1eb)]((_0x31bd33,_0x4f63d6)=>{_0x1223dd[_0x4f63d6]['bay']=_0x31bd33;}),_0x51d74e['forEach']((_0x3c00d3,_0x53d7dd)=>{var _0xf16cd4=_0x49c751;_0x1223dd[_0x53d7dd][_0xf16cd4(0x1fd)]=_0x3c00d3;}),_0x4793e7[_0x49c751(0x1eb)]((_0x1a8467,_0x279c95)=>{var _0x41e9fb=_0x49c751;_0x1223dd[_0x279c95][_0x41e9fb(0x1b4)]=_0x1a8467;}),_0x47c8a6[_0x49c751(0x1eb)]((_0x40db8b,_0x3826d1)=>{_0x1223dd[_0x3826d1]['floorlevel']=_0x40db8b;});var _0x422524=0x0;_0x1223dd[_0x49c751(0x1eb)](_0x433211=>{var _0x4386e8=_0x49c751;console[_0x4386e8(0x229)](_0x4386e8(0x29e),_0x433211),(parseInt(_0x433211[_0x4386e8(0x1c0)])<parseInt(_0x433211['return_qty'])||parseInt(_0x433211['stock'])<parseInt(_0x433211[_0x4386e8(0x239)])&&parseInt(_0x433211[_0x4386e8(0x1c0)])>parseInt(_0x433211[_0x4386e8(0x239)])||parseInt(_0x433211[_0x4386e8(0x239)])==0x0)&&_0x422524++;});if(_0x422524!=0x0)return _0x2fac9b[_0x49c751(0x260)](_0x49c751(0x1d3),_0x49c751(0x274)),_0x53e7e2['redirect'](_0x49c751(0x28d));const _0x297e58=await sales['findOne']({'invoice':_0x85f7b3});console[_0x49c751(0x229)](_0x297e58),_0x297e58['return_data']=_0x49c751(0x246);const _0x148545=await _0x297e58[_0x49c751(0x1e1)](),_0x4fbf37=new sales_return({'invoice':_0x85f7b3,'customer':_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x209)],'date':_0x4cfdaa,'warehouse_name':_0x377c87,'room':_0x1ad357,'ToWarehouse':_0x3038c2,'ToRoom':_0x63fd4a,'return_sale':_0x1223dd,'note':_0x122fe9}),_0x183a90=await _0x4fbf37[_0x49c751(0x1e1)]();console[_0x49c751(0x229)](_0x4fbf37);const _0x9806b6=await sales_return[_0x49c751(0x2b0)]({'invoice':_0x85f7b3}),_0x4dd024=await warehouse[_0x49c751(0x2b0)]({'name':_0x3038c2,'room':_0x63fd4a});_0x9806b6['return_sale']['forEach'](_0x1e2ba2=>{var _0x481686=_0x49c751,_0x306fbc=0x0;const _0x317173=_0x4dd024[_0x481686(0x286)][_0x481686(0x1c9)](_0x412810=>{var _0x397205=_0x481686;_0x412810[_0x397205(0x204)]==_0x1e2ba2[_0x397205(0x204)]&&_0x412810[_0x397205(0x26b)]==_0x1e2ba2[_0x397205(0x26b)]&&_0x412810[_0x397205(0x1b4)]==_0x1e2ba2[_0x397205(0x1b4)]&&_0x412810[_0x397205(0x1fd)]==_0x1e2ba2['bin']&&_0x412810['bay']==_0x1e2ba2[_0x397205(0x287)]&&(_0x412810[_0x397205(0x224)]=parseInt(_0x412810[_0x397205(0x224)])+parseInt(_0x1e2ba2[_0x397205(0x239)]),_0x306fbc++);});_0x306fbc=='0'&&(_0x4dd024[_0x481686(0x286)]=_0x4dd024[_0x481686(0x286)][_0x481686(0x1e8)]({'product_name':_0x1e2ba2[_0x481686(0x204)],'product_stock':_0x1e2ba2[_0x481686(0x239)],'primary_code':_0x1e2ba2[_0x481686(0x25a)],'secondary_code':_0x1e2ba2[_0x481686(0x1a6)],'product_code':_0x1e2ba2['product_code'],'bay':_0x1e2ba2[_0x481686(0x287)],'bin':_0x1e2ba2[_0x481686(0x1fd)],'type':_0x1e2ba2[_0x481686(0x1b4)],'floorlevel':_0x1e2ba2[_0x481686(0x26b)]})),console[_0x481686(0x229)](_0x481686(0x264),_0x4dd024);}),await _0x4dd024[_0x49c751(0x1e1)](),console['log'](_0x2fac9b[_0x49c751(0x1f0)]);const _0x4592a3=new c_payment_data({'invoice':_0x85f7b3,'customer':_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x209)],'reason':_0x49c751(0x1ab)});await _0x4592a3[_0x49c751(0x1e1)]();const _0x2cdc00=await master_shop[_0x49c751(0x223)]();console[_0x49c751(0x229)](_0x49c751(0x273),_0x2cdc00[0x0][_0x49c751(0x210)]);const _0x5030fc=await email_settings[_0x49c751(0x2b0)](),_0x42eb41=await customer[_0x49c751(0x2b0)]({'name':_0x2fac9b[_0x49c751(0x1f0)][_0x49c751(0x209)]});console['log'](_0x49c751(0x1d4),_0x42eb41);_0x2cdc00[0x0][_0x49c751(0x226)]==0x1?(right_currency=_0x2cdc00[0x0][_0x49c751(0x2af)],left_currency=''):(right_currency='',left_currency=_0x2cdc00[0x0]['currency']);var _0xfaeee2=_0x53d203,_0x103014=_0x31cb92,_0x52f921='',_0x20fe3f;for(_0x20fe3f in _0xfaeee2){_0x52f921+=_0x49c751(0x23d)+_0x49c751(0x266)+_0xfaeee2[_0x20fe3f]+_0x49c751(0x2ad)+_0x49c751(0x266)+_0x103014[_0x20fe3f]+_0x49c751(0x2ad)+_0x49c751(0x2a4);}console[_0x49c751(0x229)](_0x49c751(0x2ac),_0x52f921);let _0x5051ec=nodemailer[_0x49c751(0x24e)]({'service':_0x49c751(0x241),'auth':{'user':_0x5030fc[_0x49c751(0x28b)],'pass':_0x5030fc['password']}}),_0x3d80df={'from':_0x5030fc[_0x49c751(0x28b)],'to':_0x42eb41[_0x49c751(0x28b)],'subject':_0x49c751(0x282),'attachments':[{'filename':_0x49c751(0x1c8),'path':__dirname+'/../public'+'/upload/'+_0x2cdc00[0x0][_0x49c751(0x210)],'cid':_0x49c751(0x242)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x49c751(0x23e)+_0x49c751(0x1d0)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x49c751(0x1d0)+_0x49c751(0x230)+_0x49c751(0x211)+_0x49c751(0x1d0)+_0x49c751(0x203)+_0x2cdc00[0x0][_0x49c751(0x1f7)]+'\x20</h2>'+'</div>'+_0x49c751(0x211)+_0x49c751(0x281)+_0x49c751(0x1d0)+_0x49c751(0x270)+'\x20Order\x20Number\x20:\x20'+_0x85f7b3+'\x20'+_0x49c751(0x1a3)+_0x49c751(0x1c7)+_0x4cfdaa+'\x20'+_0x49c751(0x20f)+_0x49c751(0x250)+_0x49c751(0x211)+_0x49c751(0x1ee)+_0x49c751(0x1ea)+_0x49c751(0x23d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x49c751(0x1a2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x49c751(0x289)+_0x49c751(0x2a4)+_0x49c751(0x1da)+_0x49c751(0x256)+'\x20'+_0x52f921+'\x20'+_0x49c751(0x1cd)+_0x49c751(0x219)+_0x49c751(0x1d0)+'<strong>\x20Regards\x20</strong>'+_0x49c751(0x296)+_0x2cdc00[0x0]['site_title']+_0x49c751(0x250)+_0x49c751(0x211)+_0x49c751(0x211)+_0x49c751(0x1b3)};_0x5051ec['sendMail'](_0x3d80df,function(_0x149715,_0x484ed2){var _0x3b27bd=_0x49c751;_0x149715?(console[_0x3b27bd(0x229)](_0x149715),console[_0x3b27bd(0x229)](_0x3b27bd(0x1d7))):console[_0x3b27bd(0x229)](_0x3b27bd(0x1fa));}),_0x2fac9b[_0x49c751(0x260)]('success',_0x49c751(0x293)),_0x53e7e2['redirect'](_0x49c751(0x25d));}catch(_0x18bc4f){console[_0x49c751(0x229)](_0x18bc4f),_0x53e7e2['status'](0xc8)['json']({'message1':_0x18bc4f['message']});}}),router[a0_0x310399(0x259)](a0_0x310399(0x247),auth,async(_0x39d559,_0x21fc64)=>{var _0x5e3c46=a0_0x310399;try{const {username:_0x652a40,email:_0x3d8bae,role:_0x4c7b19}=_0x39d559[_0x5e3c46(0x22b)],_0x4a7bd9=_0x39d559['user'],_0x26ec27=await profile[_0x5e3c46(0x2b0)]({'email':_0x4a7bd9[_0x5e3c46(0x28b)]}),_0x493e71=await master_shop['find']();console[_0x5e3c46(0x229)](_0x5e3c46(0x1b5),_0x493e71);const _0x50f49b=_0x39d559['params']['id'],_0x2f2aa7=await sales[_0x5e3c46(0x215)](_0x50f49b);console[_0x5e3c46(0x229)](_0x5e3c46(0x1ce),_0x2f2aa7);if(_0x493e71[0x0]['language']==_0x5e3c46(0x295))var _0x461b71=users[_0x5e3c46(0x1b1)];else{if(_0x493e71[0x0]['language']==_0x5e3c46(0x249))var _0x461b71=users['Hindi'];else{if(_0x493e71[0x0][_0x5e3c46(0x1bd)]==_0x5e3c46(0x1ad))var _0x461b71=users[_0x5e3c46(0x1ad)];else{if(_0x493e71[0x0]['language']==_0x5e3c46(0x1c5))var _0x461b71=users[_0x5e3c46(0x1c5)];else{if(_0x493e71[0x0][_0x5e3c46(0x1bd)]==_0x5e3c46(0x232))var _0x461b71=users[_0x5e3c46(0x232)];else{if(_0x493e71[0x0][_0x5e3c46(0x1bd)]==_0x5e3c46(0x213))var _0x461b71=users['Portuguese'];else{if(_0x493e71[0x0][_0x5e3c46(0x1bd)]==_0x5e3c46(0x1b6))var _0x461b71=users['Chinese'];else{if(_0x493e71[0x0][_0x5e3c46(0x1bd)]==_0x5e3c46(0x1fb))var _0x461b71=users['Arabic'];}}}}}}}_0x21fc64[_0x5e3c46(0x298)](_0x5e3c46(0x261),{'success':_0x39d559[_0x5e3c46(0x260)](_0x5e3c46(0x206)),'errors':_0x39d559[_0x5e3c46(0x260)](_0x5e3c46(0x1d3)),'role':_0x4a7bd9,'profile':_0x26ec27,'alldata':_0x2f2aa7,'master_shop':_0x493e71,'language':_0x461b71});}catch(_0x27bc70){console[_0x5e3c46(0x229)](_0x27bc70);}}),router[a0_0x310399(0x22a)](a0_0x310399(0x1f9),async(_0x58cc1e,_0x40cb65)=>{var _0x1383fe=a0_0x310399;const {product_code:_0x460b72,warehouse_name:_0x5c2da7,rooms_data:_0x59b45a,Roomslist:_0x387d93}=_0x58cc1e[_0x1383fe(0x1f0)],_0x4550b8=_0x387d93[_0x1383fe(0x248)](','),_0x36e52e=[];async function _0x4b8319(_0x21a764){var _0x13697d=_0x1383fe;const _0x479795=await warehouse[_0x13697d(0x272)]([{'$match':{'name':_0x5c2da7,'room':_0x21a764}},{'$unwind':_0x13697d(0x1d5)},{'$match':{'product_details.primary_code':_0x460b72}},{'$group':{'_id':_0x13697d(0x24f),'name':{'$first':_0x13697d(0x1e3)},'product_stock':{'$first':_0x13697d(0x255)},'primary_code':{'$first':_0x13697d(0x1b8)},'secondary_code':{'$first':_0x13697d(0x1d6)},'product_code':{'$first':_0x13697d(0x20b)},'level':{'$first':_0x13697d(0x1c6)},'isle':{'$first':_0x13697d(0x29c)},'type':{'$first':_0x13697d(0x1df)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x13697d(0x292)},'secondary_unit':{'$first':_0x13697d(0x218)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x13697d(0x1de)},'expiry_date':{'$first':_0x13697d(0x1d9)},'production_date':{'$first':_0x13697d(0x235)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x13697d(0x231)},'product_cat':{'$first':_0x13697d(0x24d)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x13697d(0x27f)},'invoice':{'$first':_0x13697d(0x271)},'actual_qty':{'$first':_0x13697d(0x21e)},'actual_uom':{'$first':_0x13697d(0x1f8)}}}]),_0x309732=await warehouse[_0x13697d(0x272)]([{'$match':{'name':_0x5c2da7,'room':_0x21a764}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x460b72}},{'$group':{'_id':_0x13697d(0x24f),'name':{'$first':_0x13697d(0x1e3)},'product_stock':{'$first':_0x13697d(0x255)},'primary_code':{'$first':_0x13697d(0x1b8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x13697d(0x20b)},'level':{'$first':_0x13697d(0x1c6)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x13697d(0x1f4)},'unit':{'$first':_0x13697d(0x292)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x13697d(0x1ef)},'rack':{'$first':_0x13697d(0x1de)},'expiry_date':{'$first':_0x13697d(0x1d9)},'production_date':{'$first':_0x13697d(0x235)},'maxPerUnit':{'$first':_0x13697d(0x1ed)},'batch_code':{'$first':_0x13697d(0x231)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x479795[_0x13697d(0x228)]>0x0)_0x36e52e[_0x13697d(0x1bc)](_0x479795);else _0x309732['length']>0x0&&_0x36e52e['push'](_0x309732);}const _0x61cf4d=_0x4550b8[_0x1383fe(0x1c9)](_0x13d953=>_0x4b8319(_0x13d953));await Promise[_0x1383fe(0x25c)](_0x61cf4d),_0x40cb65['json'](_0x36e52e);}),module['exports']=router;