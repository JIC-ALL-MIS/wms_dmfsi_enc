var a0_0x1b49c0=a0_0x2815;(function(_0x4610b9,_0x22079d){var _0x29b984=a0_0x2815,_0x2b65d1=_0x4610b9();while(!![]){try{var _0x2f1cf2=parseInt(_0x29b984(0x1f1))/0x1+parseInt(_0x29b984(0x135))/0x2*(-parseInt(_0x29b984(0x137))/0x3)+-parseInt(_0x29b984(0x10d))/0x4+-parseInt(_0x29b984(0x193))/0x5*(parseInt(_0x29b984(0x113))/0x6)+parseInt(_0x29b984(0x171))/0x7+parseInt(_0x29b984(0x140))/0x8+parseInt(_0x29b984(0x1c0))/0x9*(parseInt(_0x29b984(0x185))/0xa);if(_0x2f1cf2===_0x22079d)break;else _0x2b65d1['push'](_0x2b65d1['shift']());}catch(_0x8630fe){_0x2b65d1['push'](_0x2b65d1['shift']());}}}(a0_0x52f1,0xdac04));const express=require(a0_0x1b49c0(0x157)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x1b49c0(0x15d)),auth=require('../middleware/auth'),nodemailer=require(a0_0x1b49c0(0x198)),users=require(a0_0x1b49c0(0x1b9));function a0_0x52f1(){var _0x4a35e4=['$product_details.invoice','language','all_sales_barcode','/../public','product_code','$return_data','84kvjrDX','English\x20(US)','10839MWuDCR','$customer','error','$room','sale_product','bay','getMonth','get','map','4460424YdkNyC','status','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','padStart','actual_uom','\x20</h2>','max','finalize','sales\x20all_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','warehouse','$customers_docs','Sales\x20Mail','unit','edit_sales_view','prod_code','back','/barcode/:id','/preview/:id','floorlevel','$product_details.maxPerUnit','Hindi','express','$product_details.secondary_code','Email\x20sent\x20successfully','Chinese','Spanish','json','../models/all_models','render','secondary_code','batch_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</span>','\x20Order\x20Number\x20:\x20','production_date','role','<tr>','isAllowEdit','foreach\x20newproduct','Enclosed','actual_qty','/all_sales/view','primary_unit','warehouse_name','catch','sendMail','save','2196488CnVgSv','id_transaction_from','$sale_product.bin','/view/return_sales/:id','$sale_product.bay','$isAllowEdit','redirect','type','staff','</thead>','quantity_notConverted','<!DOCTYPE\x20html>','German','\x20Order\x20Date\x20:\x20','currency_placement','$product_details.secondary_unit','errors','received_amount','/view/add_sales','English','5660rcWbQq','length','$product_details.rack','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','storage','sales_invoice','delivery_code','RMSEmail','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','stock_data','toString','forEach','params','OUT-','420VJGYyo','Raw\x20Materials','French','</head><body>','all_sales','nodemailer','password','$product_details.storage','$product_details.product_stock','$product_details.product_name','expiry_date','quantity','site_title','exports','Ambient','$product_details','_id','find','image','Sales\x20Update\x20successfully','body','$sale_product.floorlevel','<hr\x20class=\x22my-3\x22>','note','floor','</td>','types','$product_details.expiry_date','payment\x20successfull','/view/add_sales/:id','</h5>','RoomAssigned','date','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</table>','../public/language/languages.json','room','False','edit_sales','$product_details.floorlevel','flash','Portuguese\x20(BR)','5427pVWIyg','string','stocks','/all_sales/preview/','An\x20error\x20occurred.','product_name','secondary_unit','delivery_date','push','sale_qty','id_transact','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','getFullYear','Arabic\x20(ae)','Return\x20Goods','/view/:id','master','product_stock','$product_details.production_date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','findOne','max_per_unit','filter','$sale_product.quantity','/view/add_sale/product','Shelves','findById','primary_code','random','</tr>','$invoice','$finalize','<span\x20style=\x22float:\x20right;\x22>','Portuguese','customer_data','</body></html>','<div>','<html><head><title></title>','sales_quantity','all','$product.product_name','success','customer','$sale_product.type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Return\x20Rooms','Floor','1221497UOpuhe','product_details','message','requested_qty','$product_details.primary_code','Level','$product_details.batch_code','product_data','level','add\x20post','$product_details.actual_qty','return_data','$product_details.product_cat','return_qty','name','add_sales','<h5>','$name','</div>','Arabic','maxperunit','<tbody\x20style=\x22text-align:\x20center;\x22>','$warehouse_name','Logo.png','<strong>\x20Regards\x20</strong>','logo','user_id','carton','$product_details.delivery_date','then','$product_details.product_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','purchases_data','bin','return_sale','email','post','prod_cat','abs','prod_invoice','$sale_product','slice','/upload/','348280BdzbIs','/view','$product_details.delivery_code','$product_details.actual_uom','stock','customers','92808BocIlC','$product_details._id','SCRN','rack','$product_details.type','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','barcode\x20Product\x20master','port','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Error\x20Occurs','<h2>\x20','$product_details.unit','Receiving\x20Area','log','/invoice/:id','<h5\x20style=\x22text-align:\x20left;\x22>','customers_docs','gmail','$product_details.bin','room_name','aggregate','/give_payment/:id','final','$product_details.bay','/barcode_scanner','True'];a0_0x52f1=function(){return _0x4a35e4;};return a0_0x52f1();}function a0_0x2815(_0x73205a,_0x632a){var _0x52f1d7=a0_0x52f1();return a0_0x2815=function(_0x281504,_0x2fd6f6){_0x281504=_0x281504-0xf8;var _0x483316=_0x52f1d7[_0x281504];return _0x483316;},a0_0x2815(_0x73205a,_0x632a);}router['get'](a0_0x1b49c0(0x10e),auth,async(_0x5d9d29,_0x44abd3)=>{var _0x5ba146=a0_0x1b49c0;try{const {username:_0x4ac2fc,email:_0x4dc7de,role:_0x148570}=_0x5d9d29['user'],_0x3ebc0a=_0x5d9d29[_0x5ba146(0x118)],_0x75e655=await profile[_0x5ba146(0x1d5)]({'email':_0x3ebc0a[_0x5ba146(0x105)]}),_0x3fa554=await master_shop[_0x5ba146(0x1a4)]();let _0xcae504;if(_0x3ebc0a['role']=='staff'){const _0x1b1ef9=await staff[_0x5ba146(0x1d5)]({'email':_0x3ebc0a[_0x5ba146(0x105)]});_0xcae504=await sales[_0x5ba146(0x129)]([{'$lookup':{'from':_0x5ba146(0x112),'localField':_0x5ba146(0x1eb),'foreignField':_0x5ba146(0x1ff),'as':_0x5ba146(0x125)}},{'$unwind':_0x5ba146(0x14c)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x5ba146(0x142),'invoice':{'$first':_0x5ba146(0x1df)},'customers':{'$first':_0x5ba146(0x138)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5ba146(0x207)},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5ba146(0x14c)},'total_saleproduct_quantity':{'$sum':_0x5ba146(0x1d8)},'level':{'$addToSet':_0x5ba146(0x175)},'isle':{'$addToSet':_0x5ba146(0x173)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5ba146(0x1e0)},'isAllowEdit':{'$first':_0x5ba146(0x176)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xcae504=await sales['aggregate']([{'$lookup':{'from':_0x5ba146(0x112),'localField':'customer','foreignField':_0x5ba146(0x1ff),'as':_0x5ba146(0x125)}},{'$unwind':_0x5ba146(0x14c)},{'$unwind':_0x5ba146(0x10a)},{'$group':{'_id':_0x5ba146(0x142),'invoice':{'$first':_0x5ba146(0x1df)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5ba146(0x207)},'sale_product':{'$push':_0x5ba146(0x10a)},'note':{'$first':'$note'},'return_data':{'$first':_0x5ba146(0x134)},'customers_docs':{'$first':_0x5ba146(0x14c)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5ba146(0x175)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':_0x5ba146(0x1ec)},'pallet':{'$addToSet':_0x5ba146(0x1a8)},'finalize':{'$first':_0x5ba146(0x1e0)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5ba146(0x122)](_0x5ba146(0x149),_0xcae504);if(_0x3fa554[0x0]['language']=='English\x20(US)'){var _0x589494=users[_0x5ba146(0x184)];console['log'](_0x589494);}else{if(_0x3fa554[0x0][_0x5ba146(0x130)]=='Hindi')var _0x589494=users[_0x5ba146(0x156)];else{if(_0x3fa554[0x0][_0x5ba146(0x130)]==_0x5ba146(0x17d))var _0x589494=users[_0x5ba146(0x17d)];else{if(_0x3fa554[0x0][_0x5ba146(0x130)]=='Spanish')var _0x589494=users['Spanish'];else{if(_0x3fa554[0x0][_0x5ba146(0x130)]==_0x5ba146(0x195))var _0x589494=users[_0x5ba146(0x195)];else{if(_0x3fa554[0x0][_0x5ba146(0x130)]=='Portuguese\x20(BR)')var _0x589494=users[_0x5ba146(0x1e2)];else{if(_0x3fa554[0x0]['language']==_0x5ba146(0x15a))var _0x589494=users['Chinese'];else{if(_0x3fa554[0x0][_0x5ba146(0x130)]=='Arabic\x20(ae)')var _0x589494=users[_0x5ba146(0x204)];}}}}}}}_0x44abd3[_0x5ba146(0x15e)](_0x5ba146(0x197),{'success':_0x5d9d29[_0x5ba146(0x1be)](_0x5ba146(0x1ea)),'errors':_0x5d9d29[_0x5ba146(0x1be)](_0x5ba146(0x181)),'sales':_0xcae504,'profile':_0x75e655,'role':_0x3ebc0a,'master_shop':_0x3fa554,'language':_0x589494});}catch(_0x2f317d){console[_0x5ba146(0x122)](_0x2f317d);}});async function getRandom8DigitNumber(){var _0x3cf7d9=a0_0x1b49c0;const _0x84e784=0x989680,_0x13bb05=0x5f5e0ff,_0x69e42=Math[_0x3cf7d9(0x1ab)](Math[_0x3cf7d9(0x1dd)]()*(_0x13bb05-_0x84e784+0x1))+_0x84e784;var _0x1dd73c;const _0x14a302=await sales[_0x3cf7d9(0x1d5)]({'invoice':'OUT-'+_0x69e42});return _0x14a302&&_0x14a302[_0x3cf7d9(0x186)]>0x0?_0x1dd73c='OUT-'+_0x69e42:_0x1dd73c=_0x3cf7d9(0x192)+_0x69e42,_0x1dd73c;}router[a0_0x1b49c0(0x13e)](a0_0x1b49c0(0x183),auth,async(_0x28faaa,_0x3bee17)=>{var _0x1ac630=a0_0x1b49c0;try{const {username:_0x3d4dc9,email:_0x58b83a,role:_0x4738bc}=_0x28faaa[_0x1ac630(0x118)],_0xb18176=_0x28faaa[_0x1ac630(0x118)],_0x2ee003=await profile[_0x1ac630(0x1d5)]({'email':_0xb18176[_0x1ac630(0x105)]}),_0x1f4590=await master_shop[_0x1ac630(0x1a4)](),_0x417f4b=await customer[_0x1ac630(0x1a4)]({});let _0x4e3e62;if(_0xb18176[_0x1ac630(0x165)]==_0x1ac630(0x179)){const _0x88c8fd=await staff[_0x1ac630(0x1d5)]({'email':_0xb18176[_0x1ac630(0x105)]});_0x4e3e62=await warehouse['aggregate']([{'$match':{'status':_0x1ac630(0x11c),'name':_0x88c8fd['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1ac630(0x1cf)}}},{'$group':{'_id':'$name','name':{'$first':_0x1ac630(0x202)}}},{'$sort':{'name':0x1}}]);}else _0x4e3e62=await warehouse[_0x1ac630(0x129)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1ac630(0x1cf)}}},{'$group':{'_id':_0x1ac630(0x202),'name':{'$first':_0x1ac630(0x202)}}},{'$sort':{'name':0x1}}]);const _0x320e0d=await product[_0x1ac630(0x1a4)]({});var _0xe02eb9=[_0x1ac630(0x1a1),_0x1ac630(0x169)];const _0x5746da=await sales[_0x1ac630(0x1a4)]({}),_0x1e8da7=_0x5746da[_0x1ac630(0x186)]+0x1,_0x4e33a2='OUT-'+_0x1e8da7[_0x1ac630(0x18f)]()[_0x1ac630(0x144)](0x5,'0');if(_0x1f4590[0x0][_0x1ac630(0x130)]=='English\x20(US)'){var _0x20830b=users[_0x1ac630(0x184)];console[_0x1ac630(0x122)](_0x20830b);}else{if(_0x1f4590[0x0][_0x1ac630(0x130)]==_0x1ac630(0x156))var _0x20830b=users[_0x1ac630(0x156)];else{if(_0x1f4590[0x0]['language']=='German')var _0x20830b=users[_0x1ac630(0x17d)];else{if(_0x1f4590[0x0][_0x1ac630(0x130)]==_0x1ac630(0x15b))var _0x20830b=users[_0x1ac630(0x15b)];else{if(_0x1f4590[0x0][_0x1ac630(0x130)]==_0x1ac630(0x195))var _0x20830b=users['French'];else{if(_0x1f4590[0x0][_0x1ac630(0x130)]==_0x1ac630(0x1bf))var _0x20830b=users[_0x1ac630(0x1e2)];else{if(_0x1f4590[0x0]['language']==_0x1ac630(0x15a))var _0x20830b=users[_0x1ac630(0x15a)];else{if(_0x1f4590[0x0][_0x1ac630(0x130)]==_0x1ac630(0x1ce))var _0x20830b=users[_0x1ac630(0x204)];}}}}}}}const _0x1e62c5=getRandom8DigitNumber();_0x1e62c5[_0x1ac630(0xfc)](_0xf931dc=>{var _0xda65cd=_0x1ac630;_0x3bee17[_0xda65cd(0x15e)](_0xda65cd(0x200),{'success':_0x28faaa[_0xda65cd(0x1be)](_0xda65cd(0x1ea)),'errors':_0x28faaa[_0xda65cd(0x1be)](_0xda65cd(0x181)),'role':_0xb18176,'profile':_0x2ee003,'customer':_0x417f4b,'warehouse':_0x4e3e62,'product':_0x320e0d,'invoice':_0xf931dc,'master_shop':_0x1f4590,'language':_0x20830b,'rooms_data':_0xe02eb9});})[_0x1ac630(0x16e)](_0x2a0b46=>{var _0x2dd5e1=_0x1ac630;_0x28faaa[_0x2dd5e1(0x1be)]('errors',_0x2dd5e1(0x161)),_0x3bee17['redirect']('/all_sales/view');});}catch(_0xee4206){console[_0x1ac630(0x122)](_0xee4206);}}),router[a0_0x1b49c0(0x13e)](a0_0x1b49c0(0x1b0),auth,async(_0xa2daaf,_0x508ae7)=>{var _0x4857e0=a0_0x1b49c0;try{const _0x4cdbf2=_0xa2daaf[_0x4857e0(0x191)]['id'];console['log'](_0x4cdbf2);const _0x50d809=await product[_0x4857e0(0x1a4)](),_0x2f86df=await purchases[_0x4857e0(0x129)]([{'$match':{'warehouse_name':_0x4cdbf2}},{'$unwind':_0x4857e0(0x1b6)},{'$group':{'_id':_0x4857e0(0x1e9)}}]);console['log'](_0x4857e0(0x102),_0x2f86df),_0x508ae7[_0x4857e0(0x141)](0xc8)[_0x4857e0(0x15c)]({'purchases_data':_0x2f86df,'product_data':_0x50d809});}catch(_0xe1bbcc){console[_0x4857e0(0x122)](_0xe1bbcc);}}),router['post'](a0_0x1b49c0(0x1d9),auth,async(_0x259601,_0x2a3f60)=>{var _0x38ec85=a0_0x1b49c0;try{const {warehouse_data:_0x4622a7,product_data:_0x587ee6}=_0x259601[_0x38ec85(0x1a7)];console[_0x38ec85(0x122)](_0x259601[_0x38ec85(0x1a7)][_0x38ec85(0x1f8)]);;const _0x47b842=await master_shop[_0x38ec85(0x1a4)]();console[_0x38ec85(0x122)](_0x38ec85(0x1d1),_0x47b842);const _0x57bcb9=await product['findOne']({'name':_0x587ee6});console[_0x38ec85(0x122)]('product',_0x57bcb9);const _0x2bc104=await warehouse[_0x38ec85(0x129)]([{'$match':{'name':_0x4622a7}},{'$unwind':_0x38ec85(0x1a2)},{'$match':{'product_details.product_name':_0x587ee6}},{'$group':{'_id':_0x38ec85(0x19c),'product_stock':{'$first':_0x38ec85(0x19b)}}}]);console[_0x38ec85(0x122)](_0x38ec85(0x18e),_0x2bc104),_0x2a3f60[_0x38ec85(0x141)](0xc8)[_0x38ec85(0x15c)]({'master':_0x47b842,'new_product':_0x57bcb9,'stock_data':_0x2bc104});}catch(_0x21b47e){console['log'](_0x21b47e);}}),router['post'](a0_0x1b49c0(0x183),auth,async(_0x40e629,_0x43d1f2)=>{var _0x3eb501=a0_0x1b49c0;try{const {invoice:_0x4c2f14,date:_0x58cefa,warehouse_name:_0x5d4866,product_name:_0x22eb4a,stock:_0x490951,quantity:_0x32458e,note:_0x4770ef,room:_0xf72e2f,primary_code:_0x304c23,secondary_code:_0x1c2261,prod_code:_0x1311e3,level:_0x48b010,isle:_0x1ba4a1,pallet:_0x47c8e8,batch_code:_0x10ed59,SCRN:_0x5c2107,expiry_date:_0xecaf17}=_0x40e629['body'];if(typeof _0x22eb4a==_0x3eb501(0x1c1))var _0x12904d=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1c5)]],_0x3f6a5b=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x111)]],_0x12ad4f=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0xfa)]],_0x4cc3f0=[_0x40e629[_0x3eb501(0x1a7)]['primary_code']],_0x301077=[_0x40e629['body'][_0x3eb501(0x15f)]],_0x16e2f0=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x150)]],_0x3d2ec7=[_0x40e629['body'][_0x3eb501(0x1f9)]],_0x5097bc=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x16c)]],_0x2338e1=[_0x40e629['body'][_0x3eb501(0x1c6)]],_0x4e0dfb=[_0x40e629['body'][_0x3eb501(0x160)]],_0x4231d2=[_0x40e629['body'][_0x3eb501(0x19d)]],_0x23a974=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1d6)]],_0x2644d0=[_0x40e629[_0x3eb501(0x1a7)]['production_date']],_0x19f67d=[_0x40e629['body'][_0x3eb501(0x1f4)]],_0x366521=[_0x40e629[_0x3eb501(0x1a7)]['delivery_date']],_0x2169d9=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x18b)]],_0x2fc0e4=[_0x40e629['body'][_0x3eb501(0x107)]],_0x5384ab=[_0x40e629[_0x3eb501(0x1a7)]['quantity']],_0x2d8b87=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1b2)]],_0x518506=[_0x40e629['body']['prod_invoice']],_0x5df440=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x16a)]],_0x7032a3=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x145)]],_0x47b81c=[_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1ca)]];else var _0x12904d=[..._0x40e629['body']['product_name']],_0x3f6a5b=[..._0x40e629[_0x3eb501(0x1a7)]['stock']],_0x12ad4f=[..._0x40e629['body'][_0x3eb501(0xfa)]],_0x4cc3f0=[..._0x40e629[_0x3eb501(0x1a7)]['primary_code']],_0x301077=[..._0x40e629['body']['secondary_code']],_0x16e2f0=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x150)]],_0x3d2ec7=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1f9)]],_0x5097bc=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x16c)]],_0x2338e1=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1c6)]],_0x4e0dfb=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x160)]],_0x4231d2=[..._0x40e629['body'][_0x3eb501(0x19d)]],_0x23a974=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1d6)]],_0x2644d0=[..._0x40e629['body'][_0x3eb501(0x164)]],_0x19f67d=[..._0x40e629['body'][_0x3eb501(0x1f4)]],_0x366521=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1c7)]],_0x2169d9=[..._0x40e629[_0x3eb501(0x1a7)]['delivery_code']],_0x2fc0e4=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x107)]],_0x5384ab=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x19e)]],_0x2d8b87=[..._0x40e629[_0x3eb501(0x1a7)]['RoomAssigned']],_0x518506=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x109)]],_0x5df440=[..._0x40e629['body'][_0x3eb501(0x16a)]],_0x7032a3=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x145)]],_0x47b81c=[..._0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1ca)]];const _0x52390a=_0x12904d['map'](_0x117fde=>{return _0x117fde={'product_name':_0x117fde};});_0x3f6a5b['forEach']((_0x20d840,_0x691cda)=>{var _0x57628c=_0x3eb501;_0x52390a[_0x691cda][_0x57628c(0x111)]=Math['abs'](_0x20d840);}),_0x5df440[_0x3eb501(0x190)]((_0xae7397,_0x7cf665)=>{var _0x22777a=_0x3eb501;_0x52390a[_0x7cf665][_0x22777a(0x16a)]=Math[_0x22777a(0x108)](_0xae7397);}),_0x7032a3['forEach']((_0x12678e,_0xc3b9ee)=>{_0x52390a[_0xc3b9ee]['actual_uom']=_0x12678e;}),_0x47b81c['forEach']((_0x16c770,_0x16d620)=>{_0x52390a[_0x16d620]['id_transaction_from']=_0x16c770;}),_0x12ad4f[_0x3eb501(0x190)]((_0x26ece6,_0x10aeb9)=>{_0x52390a[_0x10aeb9]['quantity']=_0x26ece6;}),_0x4cc3f0[_0x3eb501(0x190)]((_0x4f1203,_0x3eb05a)=>{var _0x559383=_0x3eb501;_0x52390a[_0x3eb05a][_0x559383(0x1dc)]=_0x4f1203;}),_0x301077['forEach']((_0x22e478,_0x5a079e)=>{_0x52390a[_0x5a079e]['secondary_code']=_0x22e478;}),_0x16e2f0[_0x3eb501(0x190)]((_0x42bef4,_0x4a1dd8)=>{var _0x41efbd=_0x3eb501;_0x52390a[_0x4a1dd8][_0x41efbd(0x133)]=_0x42bef4;}),_0x3d2ec7[_0x3eb501(0x190)]((_0x2b00bb,_0x436feb)=>{var _0x26d617=_0x3eb501;_0x2d8b87[_0x26d617(0x190)]((_0x2b8ab4,_0x58e7dc)=>{var _0x399e3a=_0x26d617;if(_0x2b8ab4==_0x399e3a(0x121)&&_0x436feb==_0x58e7dc){var _0x44748c=_0x2b00bb[_0x399e3a(0x10b)](0x3);_0x52390a[_0x436feb][_0x399e3a(0x189)]=_0x2b00bb[0x0],_0x52390a[_0x436feb]['rack']=_0x2b00bb[0x1],_0x52390a[_0x436feb][_0x399e3a(0x13c)]=0x0,_0x52390a[_0x436feb][_0x399e3a(0x103)]=0x0,_0x52390a[_0x436feb][_0x399e3a(0x178)]=_0x399e3a(0x1f0),_0x52390a[_0x436feb][_0x399e3a(0x154)]=_0x44748c;}else{if(_0x2b8ab4==_0x399e3a(0x1da)&&_0x436feb==_0x58e7dc){var _0x44748c=_0x2b00bb[_0x399e3a(0x10b)](0x3);_0x52390a[_0x436feb][_0x399e3a(0x189)]=_0x2b00bb[0x0],_0x52390a[_0x436feb]['rack']=_0x2b00bb[0x1],_0x52390a[_0x436feb][_0x399e3a(0x13c)]=0x0,_0x52390a[_0x436feb][_0x399e3a(0x103)]=0x0,_0x52390a[_0x436feb][_0x399e3a(0x178)]=_0x399e3a(0x1f0),_0x52390a[_0x436feb][_0x399e3a(0x154)]=_0x2b00bb[0x5];}else{if(_0x436feb==_0x58e7dc){var _0x5b1c53;if(_0x2b00bb[0x4]=='L')_0x5b1c53=_0x399e3a(0x1f6);else _0x2b00bb[0x4]=='F'&&(_0x5b1c53='Floor');_0x52390a[_0x436feb]['storage']=_0x2b00bb[0x0],_0x52390a[_0x436feb][_0x399e3a(0x116)]=_0x2b00bb[0x1],_0x52390a[_0x436feb][_0x399e3a(0x13c)]=_0x2b00bb[0x2],_0x52390a[_0x436feb][_0x399e3a(0x103)]=_0x2b00bb[0x3],_0x52390a[_0x436feb][_0x399e3a(0x178)]=_0x5b1c53,_0x52390a[_0x436feb][_0x399e3a(0x154)]=_0x2b00bb[0x5];}}}});}),_0x5097bc[_0x3eb501(0x190)]((_0x582cdc,_0x28e4a2)=>{_0x52390a[_0x28e4a2]['unit']=_0x582cdc;}),_0x2338e1['forEach']((_0x20404c,_0x4dbdb1)=>{var _0x3d9391=_0x3eb501;_0x52390a[_0x4dbdb1][_0x3d9391(0x1c6)]=_0x20404c;}),_0x4e0dfb[_0x3eb501(0x190)]((_0x128390,_0x1c30e6)=>{var _0x193dad=_0x3eb501;_0x52390a[_0x1c30e6][_0x193dad(0x160)]=_0x128390;}),_0x4231d2[_0x3eb501(0x190)]((_0x1925fe,_0x1c273e)=>{_0x52390a[_0x1c273e]['expiry_date']=_0x1925fe;}),_0x23a974[_0x3eb501(0x190)]((_0x59fa61,_0x394178)=>{_0x52390a[_0x394178]['maxperunit']=_0x59fa61;}),_0x2644d0[_0x3eb501(0x190)]((_0x4f1347,_0x337a30)=>{var _0x4c72b7=_0x3eb501;_0x52390a[_0x337a30][_0x4c72b7(0x164)]=_0x4f1347;}),_0x19f67d[_0x3eb501(0x190)]((_0x460c84,_0x37191e)=>{var _0x18b320=_0x3eb501;_0x52390a[_0x37191e][_0x18b320(0x1f4)]=_0x460c84;}),_0x366521['forEach']((_0x2f4911,_0x55d6f6)=>{var _0x572fa0=_0x3eb501;_0x52390a[_0x55d6f6][_0x572fa0(0x1c7)]=_0x2f4911;}),_0x2169d9[_0x3eb501(0x190)]((_0x49865c,_0x18a678)=>{var _0x1d572c=_0x3eb501;_0x52390a[_0x18a678][_0x1d572c(0x18b)]=_0x49865c;}),_0x2fc0e4[_0x3eb501(0x190)]((_0x26284b,_0x3fb48e)=>{var _0x76d7b9=_0x3eb501;_0x52390a[_0x3fb48e][_0x76d7b9(0x107)]=_0x26284b;}),_0x5384ab[_0x3eb501(0x190)]((_0x3338a3,_0x144241)=>{_0x52390a[_0x144241]['quantity_notConverted']=_0x3338a3;}),_0x2d8b87[_0x3eb501(0x190)]((_0x35ad0a,_0x3d4495)=>{var _0x3db069=_0x3eb501;_0x52390a[_0x3d4495][_0x3db069(0x128)]=_0x35ad0a;}),_0x518506['forEach']((_0xc6d753,_0x349fb0)=>{_0x52390a[_0x349fb0]['invoice']=_0xc6d753;});var _0x2b9ff7=0x0;_0x52390a[_0x3eb501(0x190)](_0x3af317=>{var _0x476248=_0x3eb501;(_0x3af317['stock']<_0x3af317['quantity_notConverted']||_0x3af317[_0x476248(0x17b)]==0x0)&&(console[_0x476248(0x122)](_0x476248(0x168),_0x3af317),_0x2b9ff7++);});const _0x23a2c7=_0x52390a[_0x3eb501(0x1d7)](_0x40ae46=>_0x40ae46[_0x3eb501(0x19e)]!=='0'&&_0x40ae46[_0x3eb501(0x19e)]!==''),_0x198307=new sales({'invoice':_0x4c2f14,'customer':_0x40e629[_0x3eb501(0x1a7)][_0x3eb501(0x1eb)],'date':_0x58cefa,'warehouse_name':_0x5d4866,'sale_product':_0x23a2c7,'note':_0x4770ef,'room':_0xf72e2f,'primary_code':_0x304c23,'secondary_code':_0x1c2261,'prod_code':_0x1311e3,'SCRN':_0x5c2107}),_0x1b04c8=await _0x198307[_0x3eb501(0x170)]();_0x40e629[_0x3eb501(0x1be)]('success','Sales\x20Add\x20successfully'),_0x43d1f2['redirect'](_0x3eb501(0x1c3)+_0x1b04c8[_0x3eb501(0x1a3)]);}catch(_0x212e8f){console[_0x3eb501(0x122)](_0x212e8f);}}),router['get'](a0_0x1b49c0(0x153),auth,async(_0x252782,_0x2aa094)=>{var _0x544b2e=a0_0x1b49c0;try{const {username:_0x26ba82,email:_0x2742ef,role:_0x42d61d}=_0x252782['user'],_0x862d33=_0x252782[_0x544b2e(0x118)],_0x37ca56=await profile[_0x544b2e(0x1d5)]({'email':_0x862d33[_0x544b2e(0x105)]}),_0x15f666=await master_shop[_0x544b2e(0x1a4)](),_0x42455d=_0x252782[_0x544b2e(0x191)]['id'],_0xc438d6=await sales[_0x544b2e(0x1db)](_0x42455d),_0x20b036=await warehouse[_0x544b2e(0x129)]([{'$match':{'name':_0xc438d6[_0x544b2e(0x16d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x544b2e(0x114),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x544b2e(0x19b)},'bay':{'$first':_0x544b2e(0x12c)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x544b2e(0x1bd)},'primary_code':{'$first':_0x544b2e(0x1f5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x544b2e(0xfd)},'storage':{'$first':_0x544b2e(0x19a)},'rack':{'$first':_0x544b2e(0x187)},'expiry_date':{'$first':_0x544b2e(0x1ae)},'production_date':{'$first':_0x544b2e(0x1d3)},'invoice':{'$first':_0x544b2e(0x12f)}}}]),_0xa89092=await customer[_0x544b2e(0x1a4)]({});let _0x43b4c0;if(_0x862d33[_0x544b2e(0x165)]==_0x544b2e(0x179)){const _0x1f1945=await staff[_0x544b2e(0x1d5)]({'email':_0x862d33[_0x544b2e(0x105)]});_0x43b4c0=await warehouse['aggregate']([{'$match':{'status':_0x544b2e(0x11c),'name':_0x1f1945[_0x544b2e(0x14b)]}},{'$group':{'_id':_0x544b2e(0x202),'name':{'$first':_0x544b2e(0x202)}}}]);}else _0x43b4c0=await warehouse[_0x544b2e(0x129)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x544b2e(0x202)}}}]);const _0xd7e9f1=await product[_0x544b2e(0x1a4)]({}),_0x3d745c=await suppliers[_0x544b2e(0x1a4)]({});if(_0x15f666[0x0][_0x544b2e(0x130)]==_0x544b2e(0x136)){var _0x3d27f2=users['English'];console['log'](_0x3d27f2);}else{if(_0x15f666[0x0][_0x544b2e(0x130)]=='Hindi')var _0x3d27f2=users[_0x544b2e(0x156)];else{if(_0x15f666[0x0][_0x544b2e(0x130)]==_0x544b2e(0x17d))var _0x3d27f2=users[_0x544b2e(0x17d)];else{if(_0x15f666[0x0][_0x544b2e(0x130)]==_0x544b2e(0x15b))var _0x3d27f2=users[_0x544b2e(0x15b)];else{if(_0x15f666[0x0][_0x544b2e(0x130)]==_0x544b2e(0x195))var _0x3d27f2=users['French'];else{if(_0x15f666[0x0][_0x544b2e(0x130)]=='Portuguese\x20(BR)')var _0x3d27f2=users['Portuguese'];else{if(_0x15f666[0x0][_0x544b2e(0x130)]==_0x544b2e(0x15a))var _0x3d27f2=users[_0x544b2e(0x15a)];else{if(_0x15f666[0x0][_0x544b2e(0x130)]=='Arabic\x20(ae)')var _0x3d27f2=users[_0x544b2e(0x204)];}}}}}}}_0x2aa094[_0x544b2e(0x15e)](_0x544b2e(0x14f),{'success':_0x252782[_0x544b2e(0x1be)]('success'),'errors':_0x252782['flash'](_0x544b2e(0x181)),'role':_0x862d33,'profile':_0x37ca56,'customer':_0xa89092,'warehouse':_0x43b4c0,'product':_0x20b036,'user':_0xc438d6,'master_shop':_0x15f666,'unit':_0xd7e9f1,'language':_0x3d27f2,'suppliers':_0x3d745c});}catch(_0xdaf12f){console[_0x544b2e(0x122)](_0xdaf12f);}}),router['post'](a0_0x1b49c0(0x153),auth,async(_0x4d85b2,_0x6d087b)=>{var _0x50c0d7=a0_0x1b49c0;try{const _0xa0551f=_0x4d85b2[_0x50c0d7(0x191)]['id'],{invoice:_0xb19567,warehouse_name:_0x5be513,room:_0x43f2fb}=_0x4d85b2['body'],_0x377596=await sales[_0x50c0d7(0x1d5)]({'invoice':_0xb19567}),_0x482348=_0x377596[_0x50c0d7(0x13b)]['map'](async _0x712804=>{var _0xdfc12f=_0x50c0d7,_0x4e1312=await warehouse[_0xdfc12f(0x1d5)]({'name':_0x5be513,'room':_0x712804[_0xdfc12f(0x128)],'warehouse_category':'Raw\x20Materials'});const _0x2d471e=_0x4e1312['product_details'][_0xdfc12f(0x13f)](_0x4e7bae=>{var _0x4c6627=_0xdfc12f;_0x4e7bae['product_name']==_0x712804[_0x4c6627(0x1c5)]&&_0x4e7bae[_0x4c6627(0x154)]==_0x712804[_0x4c6627(0x154)]&&_0x4e7bae[_0x4c6627(0x178)]==_0x712804[_0x4c6627(0x178)]&&_0x4e7bae[_0x4c6627(0x103)]==_0x712804['bin']&&_0x4e7bae[_0x4c6627(0x13c)]==_0x712804[_0x4c6627(0x13c)]&&_0x4e7bae[_0x4c6627(0x116)]==_0x712804[_0x4c6627(0x116)]&&_0x4e7bae[_0x4c6627(0x189)]==_0x712804[_0x4c6627(0x189)]&&_0x4e7bae[_0x4c6627(0x19d)]==_0x712804[_0x4c6627(0x19d)]&&_0x4e7bae[_0x4c6627(0x160)]==_0x712804[_0x4c6627(0x160)]&&_0x4e7bae[_0x4c6627(0x1a3)]==_0x712804[_0x4c6627(0x172)]&&(_0x4e7bae['product_stock']=Math[_0x4c6627(0x147)](0x0,Math[_0x4c6627(0x108)](_0x4e7bae[_0x4c6627(0x1d2)])-Math[_0x4c6627(0x108)](_0x712804[_0x4c6627(0x19e)])));});return _0x4e1312;});Promise[_0x50c0d7(0x1e8)](_0x482348)[_0x50c0d7(0xfc)](async _0x691bb3=>{var _0x120658=_0x50c0d7;try{for(const _0x367362 of _0x691bb3){await _0x367362[_0x120658(0x170)]();}_0x377596[_0x120658(0x148)]='True';const _0x48b1a7=await _0x377596[_0x120658(0x170)](),_0x3064aa=await master_shop[_0x120658(0x1a4)](),_0x239751=await email_settings[_0x120658(0x1d5)](),_0x3e8697=await supervisor_settings[_0x120658(0x1a4)]();var _0x56df35=_0x377596[_0x120658(0x13b)],_0x23da64='',_0x4abacf;for(_0x4abacf in _0x56df35){_0x23da64+=_0x120658(0x166)+_0x120658(0x1b7)+_0x56df35[_0x4abacf][_0x120658(0x1c5)]+_0x120658(0x1ac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56df35[_0x4abacf]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56df35[_0x4abacf][_0x120658(0x19e)]+_0x120658(0x1ac)+_0x120658(0x1b7)+_0x56df35[_0x4abacf]['unit']+_0x120658(0x1ac)+_0x120658(0x1b7)+_0x56df35[_0x4abacf][_0x120658(0x1c6)]+_0x120658(0x1ac)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x377596['warehouse_name']+'</td>'+_0x120658(0x1b7)+_0x56df35[_0x4abacf][_0x120658(0x128)]+_0x120658(0x1ac)+_0x120658(0x1b7)+_0x56df35[_0x4abacf]['storage']+_0x56df35[_0x4abacf]['rack']+_0x56df35[_0x4abacf][_0x120658(0x13c)]+_0x56df35[_0x4abacf][_0x120658(0x103)]+_0x56df35[_0x4abacf][_0x120658(0x178)][0x0]+_0x56df35[_0x4abacf][_0x120658(0x154)]+_0x120658(0x1ac),'</tr>';}let _0x57593b=nodemailer['createTransport']({'host':_0x239751['host'],'port':Number(_0x239751[_0x120658(0x11b)]),'secure':![],'auth':{'user':_0x239751[_0x120658(0x105)],'pass':_0x239751[_0x120658(0x199)]}}),_0x569ff1={'from':_0x239751[_0x120658(0x105)],'to':_0x3e8697[0x0][_0x120658(0x18c)],'subject':_0x120658(0x14d),'attachments':[{'filename':_0x120658(0x208),'path':__dirname+_0x120658(0x132)+_0x120658(0x10c)+_0x3064aa[0x0][_0x120658(0x1a5)],'cid':'logo'}],'html':_0x120658(0x17c)+_0x120658(0x1e6)+_0x120658(0x196)+_0x120658(0x1e5)+_0x120658(0x188)+_0x120658(0x1e5)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x120658(0x203)+_0x120658(0x1e5)+_0x120658(0x11f)+_0x3064aa[0x0][_0x120658(0x19f)]+'\x20</h2>'+_0x120658(0x203)+_0x120658(0x203)+_0x120658(0x1a9)+_0x120658(0x1e5)+_0x120658(0x124)+_0x120658(0x163)+_0x377596[_0x120658(0xff)]+'\x20'+_0x120658(0x1e1)+_0x120658(0x17e)+_0x377596[_0x120658(0x1b3)]+'\x20'+_0x120658(0x162)+_0x120658(0x1b1)+_0x120658(0x203)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x120658(0x100)+_0x120658(0x119)+_0x120658(0x1ee)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x120658(0x14a)+_0x120658(0x1cc)+_0x120658(0x143)+_0x120658(0x1de)+'</thead>'+_0x120658(0x206)+'\x20'+_0x23da64+'\x20'+_0x120658(0x1cb)+_0x120658(0x1b8)+_0x120658(0x1e5)+_0x120658(0x209)+_0x120658(0x201)+_0x3064aa[0x0][_0x120658(0x19f)]+_0x120658(0x1b1)+_0x120658(0x203)+_0x120658(0x203)+'</body></html>'};_0x57593b[_0x120658(0x16f)](_0x569ff1,function(_0x112529,_0x132071){var _0x14eea8=_0x120658;_0x112529?(console['log'](_0x112529),console[_0x14eea8(0x122)](_0x14eea8(0x11e))):console[_0x14eea8(0x122)]('Email\x20sent\x20successfully');}),_0x4d85b2['flash'](_0x120658(0x1ea),_0x120658(0x1a6)),_0x6d087b[_0x120658(0x177)]('/all_sales/preview/'+_0xa0551f);}catch(_0x1fa208){console[_0x120658(0x139)](_0x1fa208),_0x6d087b[_0x120658(0x141)](0x1f4)[_0x120658(0x15c)]({'error':_0x120658(0x1b4)});}})[_0x50c0d7(0x16e)](_0x3d96f2=>{var _0x210d7f=_0x50c0d7;console[_0x210d7f(0x139)](_0x3d96f2),_0x6d087b[_0x210d7f(0x141)](0x1f4)[_0x210d7f(0x15c)]({'error':_0x210d7f(0x1c4)});});}catch(_0x8cc3a3){console[_0x50c0d7(0x122)](_0x8cc3a3);}}),router[a0_0x1b49c0(0x13e)]('/view/:id',auth,async(_0x13a642,_0x42700)=>{var _0x269324=a0_0x1b49c0;try{const {username:_0x463a47,email:_0x3166d9,role:_0x53542c}=_0x13a642['user'],_0x5b41dd=_0x13a642[_0x269324(0x118)],_0x236029=await profile[_0x269324(0x1d5)]({'email':_0x5b41dd[_0x269324(0x105)]}),_0x376577=await master_shop[_0x269324(0x1a4)](),_0x9753b2=_0x13a642[_0x269324(0x191)]['id'],_0xa407a8=await sales[_0x269324(0x1db)](_0x9753b2);var _0x1a097c=[_0x269324(0x1a1),_0x269324(0x169)];const _0x1761c5=await warehouse[_0x269324(0x129)]([{'$match':{'name':_0xa407a8[_0x269324(0x16d)],'warehouse_category':_0x269324(0x194)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x269324(0x114),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x269324(0x19b)},'bay':{'$first':_0x269324(0x12c)},'bin':{'$first':_0x269324(0x127)},'type':{'$first':_0x269324(0x117)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x269324(0x158)},'product_code':{'$first':_0x269324(0xfd)},'storage':{'$first':_0x269324(0x19a)},'rack':{'$first':_0x269324(0x187)}}}]),_0x5c37ab=await customer['find']({});let _0x4b92b5;if(_0x5b41dd[_0x269324(0x165)]==_0x269324(0x179)){const _0x402a08=await staff[_0x269324(0x1d5)]({'email':_0x5b41dd['email']});_0x4b92b5=await warehouse[_0x269324(0x129)]([{'$match':{'status':_0x269324(0x11c),'name':_0x402a08['warehouse'],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x269324(0x202),'name':{'$first':_0x269324(0x202)}}}]);}else _0x4b92b5=await warehouse[_0x269324(0x129)]([{'$match':{'status':_0x269324(0x11c),'warehouse_category':_0x269324(0x194)}},{'$group':{'_id':_0x269324(0x202),'name':{'$first':_0x269324(0x202)}}}]);const _0x5bec91=await product['find']({});if(_0x376577[0x0][_0x269324(0x130)]==_0x269324(0x136)){var _0x423d04=users[_0x269324(0x184)];console['log'](_0x423d04);}else{if(_0x376577[0x0]['language']==_0x269324(0x156))var _0x423d04=users[_0x269324(0x156)];else{if(_0x376577[0x0]['language']==_0x269324(0x17d))var _0x423d04=users[_0x269324(0x17d)];else{if(_0x376577[0x0]['language']==_0x269324(0x15b))var _0x423d04=users['Spanish'];else{if(_0x376577[0x0]['language']=='French')var _0x423d04=users[_0x269324(0x195)];else{if(_0x376577[0x0][_0x269324(0x130)]=='Portuguese\x20(BR)')var _0x423d04=users['Portuguese'];else{if(_0x376577[0x0][_0x269324(0x130)]==_0x269324(0x15a))var _0x423d04=users[_0x269324(0x15a)];else{if(_0x376577[0x0][_0x269324(0x130)]==_0x269324(0x1ce))var _0x423d04=users[_0x269324(0x204)];}}}}}}}_0x42700[_0x269324(0x15e)](_0x269324(0x1bc),{'success':_0x13a642[_0x269324(0x1be)](_0x269324(0x1ea)),'errors':_0x13a642[_0x269324(0x1be)](_0x269324(0x181)),'role':_0x5b41dd,'profile':_0x236029,'customer':_0x5c37ab,'warehouse':_0x4b92b5,'product':_0x1761c5,'user':_0xa407a8,'master_shop':_0x376577,'unit':_0x5bec91,'language':_0x423d04});}catch(_0x2b49ef){console[_0x269324(0x122)](_0x2b49ef);}}),router[a0_0x1b49c0(0x106)](a0_0x1b49c0(0x1d0),auth,async(_0xf9f74b,_0x176e1b)=>{var _0x59f77e=a0_0x1b49c0;try{const _0x3c79e9=_0xf9f74b['params']['id'],_0x5b247d=await sales[_0x59f77e(0x1d5)]({'_id':_0xf9f74b[_0x59f77e(0x191)]['id']}),_0x5c3662=await warehouse[_0x59f77e(0x1d5)]({'name':_0x5b247d[_0x59f77e(0x16d)],'room':_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1ba)]}),{invoice:_0x3d5d78,date:_0x44355e,warehouse_name:_0x441d62,product_name:_0x47b046,stock:_0x13106c,quantity:_0x147239,note:_0x28399f,room:_0x134d55,customer:_0x153db7,SCRN:_0x22fe58}=_0xf9f74b['body'];if(typeof _0x47b046==_0x59f77e(0x1c1))var _0x2e2e44=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1c5)]],_0xed0d17=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x111)]],_0x4c310a=[_0xf9f74b['body'][_0x59f77e(0xfa)]],_0x3b9fe9=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1dc)]],_0x421c15=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x15f)]],_0x23a2e7=[_0xf9f74b[_0x59f77e(0x1a7)]['prod_code']],_0x4bd671=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1f9)]],_0xbba4f3=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x16c)]],_0x4c8441=[_0xf9f74b['body'][_0x59f77e(0x1c6)]],_0x38f092=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x160)]],_0x8b2c15=[_0xf9f74b['body'][_0x59f77e(0x19d)]],_0x55c063=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1d6)]],_0x43b0c3=[_0xf9f74b[_0x59f77e(0x1a7)]['production_date']],_0x1de933=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1f4)]],_0x37e2ba=[_0xf9f74b[_0x59f77e(0x1a7)]['delivery_date']],_0x44d1df=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x18b)]],_0x264019=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x107)]],_0x1f2fa3=[_0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x19e)]],_0x477043=[_0xf9f74b['body'][_0x59f77e(0x1b2)]];else var _0x2e2e44=[..._0xf9f74b['body']['product_name']],_0xed0d17=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x111)]],_0x4c310a=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0xfa)]],_0x3b9fe9=[..._0xf9f74b['body']['primary_code']],_0x421c15=[..._0xf9f74b[_0x59f77e(0x1a7)]['secondary_code']],_0x23a2e7=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x150)]],_0x4bd671=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1f9)]],_0xbba4f3=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x16c)]],_0x4c8441=[..._0xf9f74b[_0x59f77e(0x1a7)]['secondary_unit']],_0x38f092=[..._0xf9f74b[_0x59f77e(0x1a7)]['batch_code']],_0x8b2c15=[..._0xf9f74b[_0x59f77e(0x1a7)]['expiry_date']],_0x55c063=[..._0xf9f74b['body'][_0x59f77e(0x1d6)]],_0x43b0c3=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x164)]],_0x1de933=[..._0xf9f74b['body'][_0x59f77e(0x1f4)]],_0x37e2ba=[..._0xf9f74b[_0x59f77e(0x1a7)]['delivery_date']],_0x44d1df=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x18b)]],_0x264019=[..._0xf9f74b['body'][_0x59f77e(0x107)]],_0x1f2fa3=[..._0xf9f74b['body']['quantity']],_0x477043=[..._0xf9f74b[_0x59f77e(0x1a7)][_0x59f77e(0x1b2)]];const _0xb3613e=_0x2e2e44[_0x59f77e(0x13f)](_0xd521de=>{return _0xd521de={'product_name':_0xd521de};});_0xed0d17[_0x59f77e(0x190)]((_0x37ac73,_0x506424)=>{var _0x5ca9a0=_0x59f77e;_0xb3613e[_0x506424][_0x5ca9a0(0x111)]=Math['abs'](_0x37ac73);}),_0x4c310a[_0x59f77e(0x190)]((_0x10b3e5,_0x509727)=>{var _0x13a095=_0x59f77e;_0xb3613e[_0x509727][_0x13a095(0x19e)]=_0x10b3e5;}),_0x3b9fe9['forEach']((_0x50263b,_0x52fd89)=>{var _0x19684c=_0x59f77e;_0xb3613e[_0x52fd89][_0x19684c(0x1dc)]=_0x50263b;}),_0x421c15['forEach']((_0x512e74,_0x3e5107)=>{var _0xa3c1dd=_0x59f77e;_0xb3613e[_0x3e5107][_0xa3c1dd(0x15f)]=_0x512e74;}),_0x23a2e7[_0x59f77e(0x190)]((_0x1a8912,_0x4650b6)=>{var _0x2d9412=_0x59f77e;_0xb3613e[_0x4650b6][_0x2d9412(0x133)]=_0x1a8912;}),_0x4bd671[_0x59f77e(0x190)]((_0x53720a,_0x57696b)=>{var _0x1a5a87=_0x59f77e;_0x477043[_0x1a5a87(0x190)]((_0x27ae7e,_0x2e6021)=>{var _0x75aba8=_0x1a5a87;if(_0x27ae7e==_0x75aba8(0x121)&&_0x57696b==_0x2e6021){var _0xff0630=_0x53720a[_0x75aba8(0x10b)](0x3);_0xb3613e[_0x57696b][_0x75aba8(0x189)]=_0x53720a[0x0],_0xb3613e[_0x57696b][_0x75aba8(0x116)]=_0x53720a[0x1],_0xb3613e[_0x57696b][_0x75aba8(0x13c)]=0x0,_0xb3613e[_0x57696b]['bin']=0x0,_0xb3613e[_0x57696b][_0x75aba8(0x178)]=_0x75aba8(0x1f0),_0xb3613e[_0x57696b][_0x75aba8(0x154)]=_0xff0630;}else{if(_0x27ae7e=='Shelves'&&_0x57696b==_0x2e6021){var _0xff0630=_0x53720a[_0x75aba8(0x10b)](0x3);_0xb3613e[_0x57696b][_0x75aba8(0x189)]=_0x53720a[0x0],_0xb3613e[_0x57696b][_0x75aba8(0x116)]=_0x53720a[0x1],_0xb3613e[_0x57696b]['bay']=0x0,_0xb3613e[_0x57696b]['bin']=0x0,_0xb3613e[_0x57696b]['type']=_0x75aba8(0x1f0),_0xb3613e[_0x57696b][_0x75aba8(0x154)]=_0x53720a[0x5];}else{if(_0x57696b==_0x2e6021){var _0x50a03a;if(_0x53720a[0x4]=='L')_0x50a03a='Level';else _0x53720a[0x4]=='F'&&(_0x50a03a=_0x75aba8(0x1f0));_0xb3613e[_0x57696b][_0x75aba8(0x189)]=_0x53720a[0x0],_0xb3613e[_0x57696b][_0x75aba8(0x116)]=_0x53720a[0x1],_0xb3613e[_0x57696b][_0x75aba8(0x13c)]=_0x53720a[0x2],_0xb3613e[_0x57696b][_0x75aba8(0x103)]=_0x53720a[0x3],_0xb3613e[_0x57696b]['type']=_0x50a03a,_0xb3613e[_0x57696b][_0x75aba8(0x154)]=_0x53720a[0x5];}}}});}),_0xbba4f3['forEach']((_0x3acc97,_0xae2c64)=>{var _0x5e5e6d=_0x59f77e;_0xb3613e[_0xae2c64][_0x5e5e6d(0x14e)]=_0x3acc97;}),_0x4c8441[_0x59f77e(0x190)]((_0x3573d0,_0x2825b5)=>{var _0xbe9a5d=_0x59f77e;_0xb3613e[_0x2825b5][_0xbe9a5d(0x1c6)]=_0x3573d0;}),_0x38f092[_0x59f77e(0x190)]((_0x74c1bd,_0x21d49c)=>{var _0x27dfc9=_0x59f77e;_0xb3613e[_0x21d49c][_0x27dfc9(0x160)]=_0x74c1bd;}),_0x8b2c15[_0x59f77e(0x190)]((_0x5cf7f8,_0x10e3bd)=>{var _0x4821a2=_0x59f77e;_0xb3613e[_0x10e3bd][_0x4821a2(0x19d)]=_0x5cf7f8;}),_0x55c063['forEach']((_0x7b2a26,_0x326395)=>{var _0x3105d4=_0x59f77e;_0xb3613e[_0x326395][_0x3105d4(0x205)]=_0x7b2a26;}),_0x43b0c3[_0x59f77e(0x190)]((_0x3547ac,_0x3e795c)=>{var _0x3c361a=_0x59f77e;_0xb3613e[_0x3e795c][_0x3c361a(0x164)]=_0x3547ac;}),_0x1de933[_0x59f77e(0x190)]((_0x49f94b,_0x212af1)=>{var _0xb49fa=_0x59f77e;_0xb3613e[_0x212af1][_0xb49fa(0x1f4)]=Math[_0xb49fa(0x108)](_0x49f94b);}),_0x37e2ba['forEach']((_0x5dc79d,_0x5851cc)=>{var _0x2c12b5=_0x59f77e;_0xb3613e[_0x5851cc][_0x2c12b5(0x1c7)]=_0x5dc79d;}),_0x44d1df[_0x59f77e(0x190)]((_0x1248ff,_0x22e845)=>{var _0x1c8d11=_0x59f77e;_0xb3613e[_0x22e845][_0x1c8d11(0x18b)]=_0x1248ff;}),_0x264019[_0x59f77e(0x190)]((_0x3eaeec,_0x18dc4a)=>{var _0x5d09c8=_0x59f77e;_0xb3613e[_0x18dc4a][_0x5d09c8(0x107)]=_0x3eaeec;}),_0x1f2fa3[_0x59f77e(0x190)]((_0x192b04,_0x1061c3)=>{_0xb3613e[_0x1061c3]['quantity_notConverted']=_0x192b04;}),_0x477043[_0x59f77e(0x190)]((_0x18a551,_0x2f4535)=>{var _0x12781b=_0x59f77e;_0xb3613e[_0x2f4535][_0x12781b(0x128)]=_0x18a551;});var _0x3c809e=0x0;_0xb3613e[_0x59f77e(0x190)](_0x56bf12=>{var _0x438ea4=_0x59f77e;console[_0x438ea4(0x122)](_0x438ea4(0x168),_0x56bf12),(parseInt(_0x56bf12[_0x438ea4(0x111)])<parseInt(_0x56bf12[_0x438ea4(0x19e)])||parseInt(_0x56bf12[_0x438ea4(0x19e)])==0x0)&&_0x3c809e++;});if(_0x3c809e!=0x0)return _0xf9f74b[_0x59f77e(0x1be)](_0x59f77e(0x181),_0x59f77e(0x18d)),_0x176e1b[_0x59f77e(0x177)](_0x59f77e(0x151));const _0x5bf49a=_0xb3613e['filter'](_0x4c9f5e=>_0x4c9f5e[_0x59f77e(0x19e)]!=='0'&&_0x4c9f5e['quantity']!=='');_0x5b247d['invoice']=_0x3d5d78,_0x5b247d[_0x59f77e(0x1eb)]=_0x153db7,_0x5b247d[_0x59f77e(0x1b3)]=_0x44355e,_0x5b247d[_0x59f77e(0x16d)]=_0x441d62,_0x5b247d[_0x59f77e(0x13b)]=_0x5bf49a,_0x5b247d[_0x59f77e(0x1aa)]=_0x28399f,_0x5b247d[_0x59f77e(0x115)]=_0x22fe58,_0x5b247d[_0x59f77e(0x148)]=_0x59f77e(0x1bb),_0x5b247d[_0x59f77e(0x167)]='False';const _0x5048fc=await _0x5b247d[_0x59f77e(0x170)]();_0xf9f74b['flash'](_0x59f77e(0x1ea),_0x59f77e(0x1a6)),_0x176e1b[_0x59f77e(0x177)](_0x59f77e(0x16b));}catch(_0x4f2916){console[_0x59f77e(0x122)](_0x4f2916);}}),router[a0_0x1b49c0(0x106)](a0_0x1b49c0(0x12a),auth,async(_0x57b68e,_0xa0b95b)=>{var _0x22dfa9=a0_0x1b49c0;try{const _0x1cee95=_0x57b68e[_0x22dfa9(0x191)]['id'],{invoice:_0x2e0a32,customer:_0xd9b307,receivable_amount:_0x2cafd1,received_amount:_0x185fb8}=_0x57b68e['body'],_0x3664f7=await sales[_0x22dfa9(0x1db)](_0x1cee95);console[_0x22dfa9(0x122)](_0x3664f7);var _0x4843c4=_0x2cafd1-_0x185fb8;console[_0x22dfa9(0x122)](_0x185fb8),_0x3664f7['received_amount']=parseFloat(_0x185fb8)+parseFloat(_0x3664f7[_0x22dfa9(0x182)]),_0x3664f7['due_amount']=_0x4843c4,console[_0x22dfa9(0x122)](_0x3664f7);const _0x21b86e=await _0x3664f7[_0x22dfa9(0x170)](),_0x4e995a=await c_payment_data[_0x22dfa9(0x1d5)]({'invoice':_0x2e0a32});_0x4e995a['amount']=_0x4843c4,await _0x4e995a[_0x22dfa9(0x170)]();let _0x46ac8e=new Date(),_0x102376=('0'+_0x46ac8e['getDate']())[_0x22dfa9(0x10b)](-0x2),_0x65efd1=('0'+(_0x46ac8e[_0x22dfa9(0x13d)]()+0x1))[_0x22dfa9(0x10b)](-0x2),_0x636280=_0x46ac8e[_0x22dfa9(0x1cd)](),_0x5bc487=_0x636280+'-'+_0x65efd1+'-'+_0x102376;const _0x4a269e=new customer_payment({'invoice':_0x2e0a32,'date':_0x636280+'-'+_0x65efd1+'-'+_0x102376,'customer':_0xd9b307,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x185fb8}),_0x5ea946=await _0x4a269e[_0x22dfa9(0x170)]();_0x57b68e[_0x22dfa9(0x1be)](_0x22dfa9(0x1ea),_0x22dfa9(0x1af)),_0xa0b95b[_0x22dfa9(0x177)](_0x22dfa9(0x16b));}catch(_0x2eda40){console[_0x22dfa9(0x122)](_0x2eda40);}}),router[a0_0x1b49c0(0x13e)](a0_0x1b49c0(0x123),auth,async(_0x3860fc,_0x222219)=>{var _0xa5f539=a0_0x1b49c0;try{const {username:_0x282336,email:_0x505c9c,role:_0x573e21}=_0x3860fc[_0xa5f539(0x118)],_0x45814a=_0x3860fc[_0xa5f539(0x118)],_0x254196=await profile[_0xa5f539(0x1d5)]({'email':_0x45814a[_0xa5f539(0x105)]}),_0x2cf3f3=await master_shop[_0xa5f539(0x1a4)]();console[_0xa5f539(0x122)](_0xa5f539(0x1d1),_0x2cf3f3);const _0x56b78e=_0x3860fc[_0xa5f539(0x191)]['id'],_0x43bcee=await sales[_0xa5f539(0x1db)](_0x56b78e);console[_0xa5f539(0x122)](_0x43bcee);const _0x14de5c=await customer[_0xa5f539(0x1d5)]({'name':_0x43bcee[_0xa5f539(0x1eb)]});console[_0xa5f539(0x122)](_0x14de5c);if(_0x2cf3f3[0x0][_0xa5f539(0x130)]==_0xa5f539(0x136)){var _0xb7e9=users[_0xa5f539(0x184)];console[_0xa5f539(0x122)](_0xb7e9);}else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]=='Hindi')var _0xb7e9=users[_0xa5f539(0x156)];else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]=='German')var _0xb7e9=users['German'];else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]==_0xa5f539(0x15b))var _0xb7e9=users['Spanish'];else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]==_0xa5f539(0x195))var _0xb7e9=users['French'];else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]==_0xa5f539(0x1bf))var _0xb7e9=users[_0xa5f539(0x1e2)];else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]==_0xa5f539(0x15a))var _0xb7e9=users[_0xa5f539(0x15a)];else{if(_0x2cf3f3[0x0][_0xa5f539(0x130)]==_0xa5f539(0x1ce))var _0xb7e9=users[_0xa5f539(0x204)];}}}}}}}_0x222219[_0xa5f539(0x15e)](_0xa5f539(0x18a),{'success':_0x3860fc[_0xa5f539(0x1be)](_0xa5f539(0x1ea)),'errors':_0x3860fc[_0xa5f539(0x1be)](_0xa5f539(0x181)),'role':_0x45814a,'profile':_0x254196,'master_shop':_0x2cf3f3,'customers':_0x14de5c,'sales':_0x43bcee,'language':_0xb7e9});}catch(_0x294ca8){console[_0xa5f539(0x122)](_0x294ca8);}}),router[a0_0x1b49c0(0x13e)](a0_0x1b49c0(0x174),auth,async(_0x20fafb,_0x375a84)=>{var _0x446667=a0_0x1b49c0;try{const {username:_0x5ac021,email:_0xdbc20a,role:_0x7669f4}=_0x20fafb[_0x446667(0x118)],_0x5dcc8d=_0x20fafb[_0x446667(0x118)],_0x2f6e2c=await profile[_0x446667(0x1d5)]({'email':_0x5dcc8d[_0x446667(0x105)]}),_0x31ff2e=await master_shop[_0x446667(0x1a4)]();console[_0x446667(0x122)]('master',_0x31ff2e);const _0x2d6ce7=_0x20fafb[_0x446667(0x191)]['id'];console[_0x446667(0x122)](_0x2d6ce7);const _0xfa9410=await sales[_0x446667(0x1db)](_0x2d6ce7);console[_0x446667(0x122)](_0x446667(0xf9),_0xfa9410);const _0x2c49c4=await warehouse[_0x446667(0x129)]([{'$match':{'name':_0x446667(0x1cf),'room':_0x446667(0x1ef)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x446667(0x114),'name':{'$first':_0x446667(0x19c)},'product_stock':{'$first':_0x446667(0x19b)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x446667(0x158)},'product_code':{'$first':_0x446667(0xfd)}}}]);console['log'](_0x446667(0x18e),_0x2c49c4);const _0x11b52c=await product[_0x446667(0x1a4)]({});warehouse_data=await warehouse[_0x446667(0x129)]([{'$match':{'status':_0x446667(0x11c),'name':_0x446667(0x1cf),'warehouse_category':_0x446667(0x194)}},{'$group':{'_id':_0x446667(0x202),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x40bd14=['Return\x20Rooms'];if(_0x31ff2e[0x0][_0x446667(0x130)]==_0x446667(0x136)){var _0x571160=users[_0x446667(0x184)];console['log'](_0x571160);}else{if(_0x31ff2e[0x0][_0x446667(0x130)]==_0x446667(0x156))var _0x571160=users[_0x446667(0x156)];else{if(_0x31ff2e[0x0][_0x446667(0x130)]==_0x446667(0x17d))var _0x571160=users[_0x446667(0x17d)];else{if(_0x31ff2e[0x0][_0x446667(0x130)]==_0x446667(0x15b))var _0x571160=users[_0x446667(0x15b)];else{if(_0x31ff2e[0x0]['language']=='French')var _0x571160=users['French'];else{if(_0x31ff2e[0x0][_0x446667(0x130)]=='Portuguese\x20(BR)')var _0x571160=users['Portuguese'];else{if(_0x31ff2e[0x0][_0x446667(0x130)]=='Chinese')var _0x571160=users[_0x446667(0x15a)];else{if(_0x31ff2e[0x0][_0x446667(0x130)]==_0x446667(0x1ce))var _0x571160=users[_0x446667(0x204)];}}}}}}}_0x375a84[_0x446667(0x15e)]('return_sale',{'success':_0x20fafb[_0x446667(0x1be)](_0x446667(0x1ea)),'errors':_0x20fafb[_0x446667(0x1be)](_0x446667(0x181)),'role':_0x5dcc8d,'profile':_0x2f6e2c,'user':_0xfa9410,'stock':_0x2c49c4,'master_shop':_0x31ff2e,'unit':_0x11b52c,'language':_0x571160,'warehouses':warehouse_data,'rooms':_0x40bd14});}catch(_0x290796){console['log'](_0x290796),_0x375a84['status'](0xc8)[_0x446667(0x15c)]({'message':_0x290796['message']});}}),router[a0_0x1b49c0(0x106)](a0_0x1b49c0(0x174),auth,async(_0x4c8860,_0x4249f6)=>{var _0x2d51bd=a0_0x1b49c0;try{const {invoice:_0xc28e46,date:_0x604597,warehouse_name:_0x4eefe1,product_name:_0x2a07f1,primary_code:_0x23912d,secondary_code:_0xb1e856,product_code:_0x4eaf51,sales_quantity:_0x507d2a,stocks:_0x502871,return_qty:_0xfab113,Room_name:_0x23666f,to_warehouse_name:_0x3b9900,to_Roomname:_0x2dfc80,to_Room_name:_0x549dc4,note:_0x4b06ae,level:_0x219d5e,isle:_0x5ef66f,pallet:_0x154bb4}=_0x4c8860[_0x2d51bd(0x1a7)];if(typeof _0x2a07f1=='string')var _0x2b2ceb=[_0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x1c5)]],_0x2a7018=[_0x4c8860['body'][_0x2d51bd(0x1dc)]],_0x2c1fac=[_0x4c8860[_0x2d51bd(0x1a7)]['secondary_code']],_0x54760c=[_0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x133)]],_0x5d59c3=[_0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x1e7)]],_0x240470=[_0x4c8860['body'][_0x2d51bd(0x1c2)]],_0x18ce8f=[_0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x1fe)]],_0x2107a0=[_0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x13c)]],_0x3bacc3=[_0x4c8860[_0x2d51bd(0x1a7)]['bin']],_0x3352a0=[_0x4c8860['body'][_0x2d51bd(0x1ad)]],_0xf1d851=[_0x4c8860[_0x2d51bd(0x1a7)]['floorlevel']];else var _0x2b2ceb=[..._0x4c8860[_0x2d51bd(0x1a7)]['product_name']],_0x2a7018=[..._0x4c8860[_0x2d51bd(0x1a7)]['primary_code']],_0x2c1fac=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x15f)]],_0x54760c=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x133)]],_0x5d59c3=[..._0x4c8860['body'][_0x2d51bd(0x1e7)]],_0x240470=[..._0x4c8860['body']['stocks']],_0x18ce8f=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x1fe)]],_0x2107a0=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x13c)]],_0x3bacc3=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x103)]],_0x3352a0=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x1ad)]],_0xf1d851=[..._0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x154)]];const _0x3c6db8=_0x2b2ceb[_0x2d51bd(0x13f)](_0x2eb124=>{return _0x2eb124={'product_name':_0x2eb124};});_0x2a7018[_0x2d51bd(0x190)]((_0x51b252,_0x57eb73)=>{var _0x38462c=_0x2d51bd;_0x3c6db8[_0x57eb73][_0x38462c(0x1dc)]=_0x51b252;}),_0x2c1fac[_0x2d51bd(0x190)]((_0x2081ec,_0x3fdd5a)=>{var _0x573de6=_0x2d51bd;_0x3c6db8[_0x3fdd5a][_0x573de6(0x15f)]=_0x2081ec;}),_0x54760c['forEach']((_0x26edde,_0x59da70)=>{var _0xe24dfd=_0x2d51bd;_0x3c6db8[_0x59da70][_0xe24dfd(0x133)]=_0x26edde;}),_0x5d59c3[_0x2d51bd(0x190)]((_0x72aec6,_0x4c7396)=>{var _0x1aecaa=_0x2d51bd;_0x3c6db8[_0x4c7396][_0x1aecaa(0x1c9)]=_0x72aec6;}),_0x240470['forEach']((_0x2e3854,_0x52072b)=>{var _0x57f1ff=_0x2d51bd;_0x3c6db8[_0x52072b][_0x57f1ff(0x111)]=_0x2e3854;}),_0x18ce8f[_0x2d51bd(0x190)]((_0x574286,_0x513016)=>{var _0x481dcd=_0x2d51bd;_0x3c6db8[_0x513016][_0x481dcd(0x1fe)]=_0x574286;}),_0x2107a0[_0x2d51bd(0x190)]((_0x147164,_0x30e17e)=>{var _0x51f108=_0x2d51bd;_0x3c6db8[_0x30e17e][_0x51f108(0x13c)]=_0x147164;}),_0x3bacc3[_0x2d51bd(0x190)]((_0xb0945d,_0x3a84de)=>{_0x3c6db8[_0x3a84de]['bin']=_0xb0945d;}),_0x3352a0[_0x2d51bd(0x190)]((_0x5a51dc,_0x2daf9a)=>{_0x3c6db8[_0x2daf9a]['type']=_0x5a51dc;}),_0xf1d851[_0x2d51bd(0x190)]((_0x143863,_0x58f291)=>{var _0xfe023=_0x2d51bd;_0x3c6db8[_0x58f291][_0xfe023(0x154)]=_0x143863;});var _0x3f4189=0x0;_0x3c6db8[_0x2d51bd(0x190)](_0x178fb2=>{var _0xaa8063=_0x2d51bd;console[_0xaa8063(0x122)]('foreach\x20newproduct',_0x178fb2),(parseInt(_0x178fb2['sale_qty'])<parseInt(_0x178fb2['return_qty'])||parseInt(_0x178fb2['stock'])<parseInt(_0x178fb2['return_qty'])&&parseInt(_0x178fb2[_0xaa8063(0x1c9)])>parseInt(_0x178fb2[_0xaa8063(0x1fe)])||parseInt(_0x178fb2[_0xaa8063(0x1fe)])==0x0)&&_0x3f4189++;});if(_0x3f4189!=0x0)return _0x4c8860[_0x2d51bd(0x1be)](_0x2d51bd(0x181),_0x2d51bd(0x101)),_0x4249f6[_0x2d51bd(0x177)]('back');const _0x5db65a=await sales['findOne']({'invoice':_0xc28e46});console[_0x2d51bd(0x122)](_0x5db65a),_0x5db65a[_0x2d51bd(0x1fc)]=_0x2d51bd(0x12e);const _0x4b1780=await _0x5db65a[_0x2d51bd(0x170)](),_0x33342b=new sales_return({'invoice':_0xc28e46,'customer':_0x4c8860['body']['customer'],'date':_0x604597,'warehouse_name':_0x4eefe1,'room':_0x23666f,'ToWarehouse':_0x3b9900,'ToRoom':_0x549dc4,'return_sale':_0x3c6db8,'note':_0x4b06ae}),_0xd6ca0b=await _0x33342b['save']();console[_0x2d51bd(0x122)](_0x33342b);const _0x4e4486=await sales_return['findOne']({'invoice':_0xc28e46}),_0x1f5fb1=await warehouse[_0x2d51bd(0x1d5)]({'name':_0x3b9900,'room':_0x549dc4});_0x4e4486[_0x2d51bd(0x104)][_0x2d51bd(0x190)](_0x45ea39=>{var _0x37244f=_0x2d51bd,_0x1cc142=0x0;const _0x103b15=_0x1f5fb1[_0x37244f(0x1f2)][_0x37244f(0x13f)](_0x53ba3d=>{var _0x17573a=_0x37244f;_0x53ba3d[_0x17573a(0x1c5)]==_0x45ea39['product_name']&&_0x53ba3d[_0x17573a(0x154)]==_0x45ea39[_0x17573a(0x154)]&&_0x53ba3d['type']==_0x45ea39[_0x17573a(0x178)]&&_0x53ba3d[_0x17573a(0x103)]==_0x45ea39[_0x17573a(0x103)]&&_0x53ba3d[_0x17573a(0x13c)]==_0x45ea39[_0x17573a(0x13c)]&&(_0x53ba3d[_0x17573a(0x1d2)]=parseInt(_0x53ba3d[_0x17573a(0x1d2)])+parseInt(_0x45ea39[_0x17573a(0x1fe)]),_0x1cc142++);});_0x1cc142=='0'&&(_0x1f5fb1[_0x37244f(0x1f2)]=_0x1f5fb1[_0x37244f(0x1f2)]['concat']({'product_name':_0x45ea39[_0x37244f(0x1c5)],'product_stock':_0x45ea39[_0x37244f(0x1fe)],'primary_code':_0x45ea39[_0x37244f(0x1dc)],'secondary_code':_0x45ea39[_0x37244f(0x15f)],'product_code':_0x45ea39[_0x37244f(0x133)],'bay':_0x45ea39[_0x37244f(0x13c)],'bin':_0x45ea39[_0x37244f(0x103)],'type':_0x45ea39[_0x37244f(0x178)],'floorlevel':_0x45ea39[_0x37244f(0x154)]})),console[_0x37244f(0x122)](_0x37244f(0x12b),_0x1f5fb1);}),await _0x1f5fb1[_0x2d51bd(0x170)](),console['log'](_0x4c8860['body']);const _0x115f61=new c_payment_data({'invoice':_0xc28e46,'customer':_0x4c8860[_0x2d51bd(0x1a7)][_0x2d51bd(0x1eb)],'reason':'Sale\x20Return'});await _0x115f61['save']();const _0x4193bf=await master_shop[_0x2d51bd(0x1a4)]();console[_0x2d51bd(0x122)](_0x2d51bd(0x1fa),_0x4193bf[0x0][_0x2d51bd(0x1a5)]);const _0x100654=await email_settings[_0x2d51bd(0x1d5)](),_0x4ca61f=await customer[_0x2d51bd(0x1d5)]({'name':_0x4c8860['body']['customer']});console['log'](_0x2d51bd(0x1e3),_0x4ca61f);_0x4193bf[0x0][_0x2d51bd(0x17f)]==0x1?(right_currency=_0x4193bf[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4193bf[0x0]['currency']);var _0x2eb492=_0x2b2ceb,_0x4dd7b3=_0x18ce8f,_0x71e64a='',_0x3c29e5;for(_0x3c29e5 in _0x2eb492){_0x71e64a+=_0x2d51bd(0x166)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2eb492[_0x3c29e5]+'</td>'+_0x2d51bd(0x1b7)+_0x4dd7b3[_0x3c29e5]+'</td>'+_0x2d51bd(0x1de);}console[_0x2d51bd(0x122)]('product_list',_0x71e64a);let _0x24fe64=nodemailer['createTransport']({'service':_0x2d51bd(0x126),'auth':{'user':_0x100654[_0x2d51bd(0x105)],'pass':_0x100654[_0x2d51bd(0x199)]}}),_0x554d86={'from':_0x100654[_0x2d51bd(0x105)],'to':_0x4ca61f[_0x2d51bd(0x105)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':_0x2d51bd(0x208),'path':__dirname+_0x2d51bd(0x132)+_0x2d51bd(0x10c)+_0x4193bf[0x0][_0x2d51bd(0x1a5)],'cid':_0x2d51bd(0xf8)}],'html':'<!DOCTYPE\x20html>'+_0x2d51bd(0x1e6)+'</head><body>'+_0x2d51bd(0x1e5)+_0x2d51bd(0x188)+'<div>'+_0x2d51bd(0x1ed)+_0x2d51bd(0x203)+_0x2d51bd(0x1e5)+_0x2d51bd(0x11f)+_0x4193bf[0x0][_0x2d51bd(0x19f)]+_0x2d51bd(0x146)+_0x2d51bd(0x203)+_0x2d51bd(0x203)+_0x2d51bd(0x1a9)+_0x2d51bd(0x1e5)+_0x2d51bd(0x124)+_0x2d51bd(0x163)+_0xc28e46+'\x20'+_0x2d51bd(0x1e1)+_0x2d51bd(0x17e)+_0x604597+'\x20'+_0x2d51bd(0x162)+_0x2d51bd(0x1b1)+_0x2d51bd(0x203)+_0x2d51bd(0x1d4)+_0x2d51bd(0xfe)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2d51bd(0x11d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x2d51bd(0x1b5)+_0x2d51bd(0x1de)+_0x2d51bd(0x17a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x71e64a+'\x20'+'</tbody>'+_0x2d51bd(0x1b8)+_0x2d51bd(0x1e5)+_0x2d51bd(0x209)+'<h5>'+_0x4193bf[0x0][_0x2d51bd(0x19f)]+'</h5>'+_0x2d51bd(0x203)+_0x2d51bd(0x203)+_0x2d51bd(0x1e4)};_0x24fe64[_0x2d51bd(0x16f)](_0x554d86,function(_0x4e9b52,_0x4cdfd7){var _0x32a350=_0x2d51bd;_0x4e9b52?(console[_0x32a350(0x122)](_0x4e9b52),console['log'](_0x32a350(0x11e))):console['log'](_0x32a350(0x159));}),_0x4c8860[_0x2d51bd(0x1be)](_0x2d51bd(0x1ea),'sales\x20item\x20return\x20successfull'),_0x4249f6['redirect']('/all_sales/view');}catch(_0x33d80b){console['log'](_0x33d80b),_0x4249f6[_0x2d51bd(0x141)](0xc8)[_0x2d51bd(0x15c)]({'message1':_0x33d80b[_0x2d51bd(0x1f3)]});}}),router['get'](a0_0x1b49c0(0x152),auth,async(_0x34a9d3,_0x2256ce)=>{var _0xe37b21=a0_0x1b49c0;try{const {username:_0x282f11,email:_0x4060d6,role:_0x47107f}=_0x34a9d3[_0xe37b21(0x118)],_0x5ef40e=_0x34a9d3['user'],_0x2d85e7=await profile[_0xe37b21(0x1d5)]({'email':_0x5ef40e['email']}),_0x7f6565=await master_shop[_0xe37b21(0x1a4)]();console[_0xe37b21(0x122)](_0xe37b21(0x11a),_0x7f6565);const _0x1f669a=_0x34a9d3[_0xe37b21(0x191)]['id'],_0x533c76=await sales['findById'](_0x1f669a);console['log']('barcode\x20user_id',_0x533c76);if(_0x7f6565[0x0][_0xe37b21(0x130)]=='English\x20(US)')var _0x454c1b=users['English'];else{if(_0x7f6565[0x0][_0xe37b21(0x130)]==_0xe37b21(0x156))var _0x454c1b=users['Hindi'];else{if(_0x7f6565[0x0][_0xe37b21(0x130)]==_0xe37b21(0x17d))var _0x454c1b=users[_0xe37b21(0x17d)];else{if(_0x7f6565[0x0]['language']==_0xe37b21(0x15b))var _0x454c1b=users[_0xe37b21(0x15b)];else{if(_0x7f6565[0x0][_0xe37b21(0x130)]==_0xe37b21(0x195))var _0x454c1b=users['French'];else{if(_0x7f6565[0x0][_0xe37b21(0x130)]==_0xe37b21(0x1bf))var _0x454c1b=users[_0xe37b21(0x1e2)];else{if(_0x7f6565[0x0][_0xe37b21(0x130)]==_0xe37b21(0x15a))var _0x454c1b=users[_0xe37b21(0x15a)];else{if(_0x7f6565[0x0]['language']==_0xe37b21(0x1ce))var _0x454c1b=users['Arabic'];}}}}}}}_0x2256ce[_0xe37b21(0x15e)](_0xe37b21(0x131),{'success':_0x34a9d3[_0xe37b21(0x1be)]('success'),'errors':_0x34a9d3['flash']('errors'),'role':_0x5ef40e,'profile':_0x2d85e7,'alldata':_0x533c76,'master_shop':_0x7f6565,'language':_0x454c1b});}catch(_0x4e7383){console[_0xe37b21(0x122)](_0x4e7383);}}),router[a0_0x1b49c0(0x106)](a0_0x1b49c0(0x12d),async(_0x421082,_0x385926)=>{var _0x538dc0=a0_0x1b49c0;const {product_code:_0x562386,warehouse_name:_0x3fd944,rooms_data:_0x3e2302,Roomslist:_0x559ade}=_0x421082[_0x538dc0(0x1a7)],_0x41cfcc=_0x559ade['split'](','),_0x385aa6=[];async function _0x146002(_0x285b3d){var _0x307030=_0x538dc0;const _0x184c4c=await warehouse[_0x307030(0x129)]([{'$match':{'name':_0x3fd944,'room':_0x285b3d}},{'$unwind':_0x307030(0x1a2)},{'$match':{'product_details.primary_code':_0x562386}},{'$group':{'_id':_0x307030(0x114),'name':{'$first':_0x307030(0x19c)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x307030(0x1f5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x307030(0xfd)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x307030(0x117)},'pallet':{'$first':_0x307030(0x1bd)},'unit':{'$first':_0x307030(0x120)},'secondary_unit':{'$first':_0x307030(0x180)},'storage':{'$first':_0x307030(0x19a)},'rack':{'$first':_0x307030(0x187)},'expiry_date':{'$first':_0x307030(0x1ae)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x307030(0x1f7)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x307030(0x12f)},'actual_qty':{'$first':_0x307030(0x1fb)},'actual_uom':{'$first':_0x307030(0x110)},'delivery_date':{'$first':_0x307030(0xfb)},'delivery_code':{'$first':_0x307030(0x10f)}}}]),_0x465a99=await warehouse[_0x307030(0x129)]([{'$match':{'name':_0x3fd944,'room':_0x285b3d}},{'$unwind':_0x307030(0x1a2)},{'$match':{'product_details.secondary_code':_0x562386}},{'$group':{'_id':_0x307030(0x114),'name':{'$first':_0x307030(0x19c)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x307030(0x158)},'product_code':{'$first':_0x307030(0xfd)},'level':{'$first':_0x307030(0x12c)},'isle':{'$first':_0x307030(0x127)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x307030(0x1bd)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x307030(0x180)},'storage':{'$first':_0x307030(0x19a)},'rack':{'$first':_0x307030(0x187)},'expiry_date':{'$first':_0x307030(0x1ae)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x307030(0x155)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x307030(0x1fd)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x307030(0x13a)},'invoice':{'$first':_0x307030(0x12f)},'delivery_date':{'$first':_0x307030(0xfb)},'delivery_code':{'$first':_0x307030(0x10f)}}}]);if(_0x184c4c[_0x307030(0x186)]>0x0)_0x385aa6[_0x307030(0x1c8)](_0x184c4c);else _0x465a99['length']>0x0&&_0x385aa6[_0x307030(0x1c8)](_0x465a99);}const _0x4f598a=_0x41cfcc[_0x538dc0(0x13f)](_0x2e2bf6=>_0x146002(_0x2e2bf6));await Promise[_0x538dc0(0x1e8)](_0x4f598a),_0x385926[_0x538dc0(0x15c)](_0x385aa6);}),module[a0_0x1b49c0(0x1a0)]=router;