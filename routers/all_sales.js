var a0_0x2b02c6=a0_0x1aac;function a0_0x5c3f(){var _0x1480b3=['English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<strong>\x20Regards\x20</strong>','$sale_product.bin','padStart','secondary_code','all_sales','OUT-','received_amount','$product_details.batch_code','storage','1200508zBJzyd','product_name','warehouse','/all_sales/preview/','product_stock','final','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','body','$product_details.expiry_date','barcode\x20user_id','$product_details.bay','product_data','$_id','/view/:id','catch','5IANNAt','/view','Return\x20Rooms','Error\x20Occurs','stock_data','return_data','json','<!DOCTYPE\x20html>','error','<tr>','Receiving\x20Area','type','room_name','staff','Arabic\x20(ae)','primary_unit','log','/invoice/:id','toString','currency_placement','actual_qty','\x20Order\x20Number\x20:\x20','There\x27s\x20a\x20error\x20in\x20this\x20transaction','findOne','success','return_sale','createTransport','../models/all_models','prod_code','$return_data','sale_product','prod_invoice','stocks','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.actual_uom','Spanish','$product_details.bin','$product_details._id','../public/language/languages.json','Return\x20Goods','/view/add_sales/:id','4302036LxubAx','customer','Sales\x20Mail','9337064eDstkF','types','$product_details.production_date','$product_details.level','Sales\x20Add\x20successfully','$product_details.product_cat','slice','$note','/give_payment/:id','$product_details.product_name','/view/add_sales','$product_details.type','German','product_details','RMSEmail','$product_details.actual_qty','language','Ambient','password','Router','floor','batch_code','max_per_unit','push','save','date','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','invoice','product_code','back','Logo.png','/preview/:id','Level','barcode\x20Product\x20master','user','amount','An\x20error\x20occurred\x20while\x20saving\x20data.','level','quantity_notConverted','$sale_product.type','$product','email','Portuguese\x20(BR)','aggregate','Sales\x20Update\x20successfully','<hr\x20class=\x22my-3\x22>','$product_details.storage','</tbody>','Received\x20Payment\x20For\x20Sale','flash','</head><body>','status','all_sales_barcode','then','182084otwhPa','expiry_date','carton','True','Hindi','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','add\x20post','Sale\x20Return\x20Mail','Sale\x20Return','all','secondary_unit','False','/upload/','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','payment\x20successfull','$product_details.floorlevel','French','<html><head><title></title>','Arabic','actual_uom','errors','port','bay','$product.product_name','Floor','random','</span>','$room','foreach\x20newproduct','maxperunit','length','\x20Order\x20Date\x20:\x20','production_date','bin','<span\x20style=\x22float:\x20right;\x22>','$product_details.product_code','floorlevel','logo','$customer','$product_details.isle','redirect','warehouse_name','$finalize','note','5218290dPRfbu','</h5>','$invoice','forEach','render','name','delivery_code','sales_invoice','sale_qty','map','Shelves','$product_details','$customers_docs','_id','string','findById','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','return_qty','<h5>','user_id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','master','isAllowEdit','delivery_date','$sale_product.bay','<h2>\x20','filter','customers','$product_details.maxPerUnit','$sale_product.quantity','Enclosed','$product_details.secondary_unit','quantity','$product_details.invoice','68980uUxtHK','$product_details.pallet','sales\x20item\x20return\x20successfull','/../public','$product_details.rack','params','nodemailer','Chinese','finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.secondary_code','stock','Enabled','Email\x20sent\x20successfully','sales\x20all_data','unit','<h5\x20style=\x22text-align:\x20left;\x22>','</div>','message','sales_quantity','</thead>','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','$name','sendMail','2jQdhOi','product_list','prod_cat','rack','image','Raw\x20Materials','purchases_data','post','English','customer_data','/view/return_sales/:id','primary_code','find','role','get','$sale_product','/barcode_scanner','customers_docs','host','$isAllowEdit','requested_qty','</body></html>','abs','Portuguese','<div>','126246vblOxR','1278hzuyWR','express','concat','RoomAssigned','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','</tr>','$product_details.primary_code','/all_sales/view'];a0_0x5c3f=function(){return _0x1480b3;};return a0_0x5c3f();}(function(_0x1dc77c,_0x30ee0b){var _0x33fbc5=a0_0x1aac,_0x45ae57=_0x1dc77c();while(!![]){try{var _0x36f7c7=parseInt(_0x33fbc5(0xaa))/0x1*(parseInt(_0x33fbc5(0x14b))/0x2)+parseInt(_0x33fbc5(0xc3))/0x3+parseInt(_0x33fbc5(0xd8))/0x4*(-parseInt(_0x33fbc5(0xe8))/0x5)+-parseInt(_0x33fbc5(0x111))/0x6+-parseInt(_0x33fbc5(0x177))/0x7+parseInt(_0x33fbc5(0x114))/0x8+-parseInt(_0x33fbc5(0xc4))/0x9*(-parseInt(_0x33fbc5(0x91))/0xa);if(_0x36f7c7===_0x30ee0b)break;else _0x45ae57['push'](_0x45ae57['shift']());}catch(_0x52f968){_0x45ae57['push'](_0x45ae57['shift']());}}}(a0_0x5c3f,0x947d4));const express=require(a0_0x2b02c6(0xc5)),app=express(),router=express[a0_0x2b02c6(0x127)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2b02c6(0x103)),auth=require('../middleware/auth'),nodemailer=require(a0_0x2b02c6(0x97)),users=require(a0_0x2b02c6(0x10e));router['get'](a0_0x2b02c6(0xe9),auth,async(_0x5c8657,_0x49305f)=>{var _0x5bd3a8=a0_0x2b02c6;try{const {username:_0x4cca93,email:_0x5a1b9a,role:_0x5e30a0}=_0x5c8657[_0x5bd3a8(0x137)],_0x4cbda6=_0x5c8657['user'],_0x3090a4=await profile[_0x5bd3a8(0xff)]({'email':_0x4cbda6[_0x5bd3a8(0x13e)]}),_0x43a689=await master_shop[_0x5bd3a8(0xb6)]();let _0x227628;if(_0x4cbda6['role']==_0x5bd3a8(0xf5)){const _0x1b2be3=await staff['findOne']({'email':_0x4cbda6[_0x5bd3a8(0x13e)]});_0x227628=await sales['aggregate']([{'$lookup':{'from':_0x5bd3a8(0x8a),'localField':_0x5bd3a8(0x112),'foreignField':_0x5bd3a8(0x73),'as':_0x5bd3a8(0xbb)}},{'$unwind':'$customers_docs'},{'$unwind':_0x5bd3a8(0xb9)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5bd3a8(0x179)},'customers':{'$first':_0x5bd3a8(0x171)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x5bd3a8(0xb9)},'note':{'$first':_0x5bd3a8(0x11b)},'return_data':{'$first':_0x5bd3a8(0x105)},'customers_docs':{'$first':_0x5bd3a8(0x7a)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x5bd3a8(0x87)},'isle':{'$addToSet':_0x5bd3a8(0xd0)},'type':{'$addToSet':_0x5bd3a8(0x13c)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x5bd3a8(0xbd)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x227628=await sales[_0x5bd3a8(0x140)]([{'$lookup':{'from':_0x5bd3a8(0x8a),'localField':_0x5bd3a8(0x112),'foreignField':_0x5bd3a8(0x73),'as':_0x5bd3a8(0xbb)}},{'$unwind':_0x5bd3a8(0x7a)},{'$unwind':_0x5bd3a8(0xb9)},{'$group':{'_id':_0x5bd3a8(0xe5),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x5bd3a8(0x171)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':'$sale_product'},'note':{'$first':'$note'},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x5bd3a8(0x7a)},'total_saleproduct_quantity':{'$sum':_0x5bd3a8(0x8c)},'level':{'$addToSet':_0x5bd3a8(0x87)},'isle':{'$addToSet':_0x5bd3a8(0xd0)},'type':{'$addToSet':_0x5bd3a8(0x13c)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5bd3a8(0x175)},'isAllowEdit':{'$first':_0x5bd3a8(0xbd)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5bd3a8(0xf8)](_0x5bd3a8(0x9f),_0x227628);if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0xcd)){var _0x50013d=users['English'];console['log'](_0x50013d);}else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0x14f))var _0x50013d=users[_0x5bd3a8(0x14f)];else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0x120))var _0x50013d=users['German'];else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0x10b))var _0x50013d=users[_0x5bd3a8(0x10b)];else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0x15b))var _0x50013d=users[_0x5bd3a8(0x15b)];else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0x13f))var _0x50013d=users[_0x5bd3a8(0xc1)];else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0x98))var _0x50013d=users['Chinese'];else{if(_0x43a689[0x0][_0x5bd3a8(0x124)]==_0x5bd3a8(0xf6))var _0x50013d=users[_0x5bd3a8(0x15d)];}}}}}}}_0x49305f[_0x5bd3a8(0x17b)](_0x5bd3a8(0xd3),{'success':_0x5c8657['flash'](_0x5bd3a8(0x100)),'errors':_0x5c8657['flash']('errors'),'sales':_0x227628,'profile':_0x3090a4,'role':_0x4cbda6,'master_shop':_0x43a689,'language':_0x50013d});}catch(_0x1e5f45){console['log'](_0x1e5f45);}});async function getRandom8DigitNumber(){var _0x2c3162=a0_0x2b02c6;const _0x1adfc2=0x989680,_0x43264a=0x5f5e0ff,_0x4283ad=Math[_0x2c3162(0x128)](Math[_0x2c3162(0x164)]()*(_0x43264a-_0x1adfc2+0x1))+_0x1adfc2;var _0x46b7c1;const _0x4d470d=await sales['findOne']({'invoice':'OUT-'+_0x4283ad});return _0x4d470d&&_0x4d470d['length']>0x0?_0x46b7c1='OUT-'+_0x4283ad:_0x46b7c1=_0x2c3162(0xd4)+_0x4283ad,_0x46b7c1;}function a0_0x1aac(_0x15125c,_0x2d8cf6){var _0x5c3f64=a0_0x5c3f();return a0_0x1aac=function(_0x1aacfb,_0x34efbe){_0x1aacfb=_0x1aacfb-0x73;var _0x1c1cd7=_0x5c3f64[_0x1aacfb];return _0x1c1cd7;},a0_0x1aac(_0x15125c,_0x2d8cf6);}router['get'](a0_0x2b02c6(0x11e),auth,async(_0x5d5a00,_0x3a85e8)=>{var _0x458a96=a0_0x2b02c6;try{const {username:_0x522d91,email:_0x2f3765,role:_0x5e302c}=_0x5d5a00[_0x458a96(0x137)],_0x1fc756=_0x5d5a00[_0x458a96(0x137)],_0x2383a4=await profile[_0x458a96(0xff)]({'email':_0x1fc756['email']}),_0x4e779a=await master_shop['find'](),_0x5b23ff=await customer[_0x458a96(0xb6)]({});let _0x111d63;if(_0x1fc756[_0x458a96(0xb7)]==_0x458a96(0xf5)){const _0x214d94=await staff[_0x458a96(0xff)]({'email':_0x1fc756[_0x458a96(0x13e)]});_0x111d63=await warehouse['aggregate']([{'$match':{'status':_0x458a96(0x9d),'name':_0x214d94[_0x458a96(0xda)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x458a96(0x10f)}}},{'$group':{'_id':_0x458a96(0xa8),'name':{'$first':_0x458a96(0xa8)}}},{'$sort':{'name':0x1}}]);}else _0x111d63=await warehouse[_0x458a96(0x140)]([{'$match':{'status':_0x458a96(0x9d),'warehouse_category':_0x458a96(0xaf),'name':{'$ne':_0x458a96(0x10f)}}},{'$group':{'_id':'$name','name':{'$first':_0x458a96(0xa8)}}},{'$sort':{'name':0x1}}]);const _0x53fd46=await product['find']({});var _0x1c8751=['Ambient',_0x458a96(0x8d)];const _0x15b43e=await sales[_0x458a96(0xb6)]({}),_0x24c4f6=_0x15b43e[_0x458a96(0x169)]+0x1,_0x28147=_0x458a96(0xd4)+_0x24c4f6[_0x458a96(0xfa)]()[_0x458a96(0xd1)](0x5,'0');if(_0x4e779a[0x0][_0x458a96(0x124)]==_0x458a96(0xcd)){var _0x5e7cc7=users[_0x458a96(0xb2)];console[_0x458a96(0xf8)](_0x5e7cc7);}else{if(_0x4e779a[0x0][_0x458a96(0x124)]=='Hindi')var _0x5e7cc7=users[_0x458a96(0x14f)];else{if(_0x4e779a[0x0][_0x458a96(0x124)]==_0x458a96(0x120))var _0x5e7cc7=users[_0x458a96(0x120)];else{if(_0x4e779a[0x0][_0x458a96(0x124)]==_0x458a96(0x10b))var _0x5e7cc7=users[_0x458a96(0x10b)];else{if(_0x4e779a[0x0][_0x458a96(0x124)]==_0x458a96(0x15b))var _0x5e7cc7=users[_0x458a96(0x15b)];else{if(_0x4e779a[0x0]['language']==_0x458a96(0x13f))var _0x5e7cc7=users[_0x458a96(0xc1)];else{if(_0x4e779a[0x0]['language']==_0x458a96(0x98))var _0x5e7cc7=users[_0x458a96(0x98)];else{if(_0x4e779a[0x0][_0x458a96(0x124)]=='Arabic\x20(ae)')var _0x5e7cc7=users[_0x458a96(0x15d)];}}}}}}}const _0x3c8709=getRandom8DigitNumber();_0x3c8709[_0x458a96(0x14a)](_0x2195db=>{var _0x407215=_0x458a96;_0x3a85e8['render']('add_sales',{'success':_0x5d5a00[_0x407215(0x146)](_0x407215(0x100)),'errors':_0x5d5a00[_0x407215(0x146)](_0x407215(0x15f)),'role':_0x1fc756,'profile':_0x2383a4,'customer':_0x5b23ff,'warehouse':_0x111d63,'product':_0x53fd46,'invoice':_0x2195db,'master_shop':_0x4e779a,'language':_0x5e7cc7,'rooms_data':_0x1c8751});})[_0x458a96(0xe7)](_0x2a8d9e=>{var _0x5f1156=_0x458a96;_0x5d5a00[_0x5f1156(0x146)](_0x5f1156(0x15f),_0x5f1156(0xfe)),_0x3a85e8[_0x5f1156(0x173)](_0x5f1156(0xcc));});}catch(_0x1887e4){console['log'](_0x1887e4);}}),router['get'](a0_0x2b02c6(0x110),auth,async(_0x31d7c4,_0xdc2727)=>{var _0x57fadc=a0_0x2b02c6;try{const _0x11d9fa=_0x31d7c4[_0x57fadc(0x96)]['id'];console[_0x57fadc(0xf8)](_0x11d9fa);const _0x21e938=await product[_0x57fadc(0xb6)](),_0x24bd8c=await purchases['aggregate']([{'$match':{'warehouse_name':_0x11d9fa}},{'$unwind':_0x57fadc(0x13d)},{'$group':{'_id':_0x57fadc(0x162)}}]);console[_0x57fadc(0xf8)](_0x57fadc(0xb0),_0x24bd8c),_0xdc2727[_0x57fadc(0x148)](0xc8)[_0x57fadc(0xee)]({'purchases_data':_0x24bd8c,'product_data':_0x21e938});}catch(_0x425457){console[_0x57fadc(0xf8)](_0x425457);}}),router[a0_0x2b02c6(0xb1)]('/view/add_sale/product',auth,async(_0x656d2e,_0x249ceb)=>{var _0x6fb4cd=a0_0x2b02c6;try{const {warehouse_data:_0x39a8d1,product_data:_0x4a247f}=_0x656d2e['body'];console[_0x6fb4cd(0xf8)](_0x656d2e[_0x6fb4cd(0xe0)][_0x6fb4cd(0xe4)]);;const _0x46aa66=await master_shop['find']();console[_0x6fb4cd(0xf8)](_0x6fb4cd(0x84),_0x46aa66);const _0x1ffcf8=await product[_0x6fb4cd(0xff)]({'name':_0x4a247f});console[_0x6fb4cd(0xf8)]('product',_0x1ffcf8);const _0x371b9f=await warehouse[_0x6fb4cd(0x140)]([{'$match':{'name':_0x39a8d1}},{'$unwind':_0x6fb4cd(0x79)},{'$match':{'product_details.product_name':_0x4a247f}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x6fb4cd(0xa6)}}}]);console[_0x6fb4cd(0xf8)](_0x6fb4cd(0xec),_0x371b9f),_0x249ceb['status'](0xc8)[_0x6fb4cd(0xee)]({'master':_0x46aa66,'new_product':_0x1ffcf8,'stock_data':_0x371b9f});}catch(_0x5e8df1){console[_0x6fb4cd(0xf8)](_0x5e8df1);}}),router[a0_0x2b02c6(0xb1)]('/view/add_sales',auth,async(_0x42efd8,_0x3a8135)=>{var _0x19af88=a0_0x2b02c6;try{const {invoice:_0x3191f0,date:_0x4d4847,warehouse_name:_0x4e84aa,product_name:_0x46aac1,stock:_0x425a44,quantity:_0x139a83,note:_0x5c844d,room:_0x40bcbc,primary_code:_0x2844f1,secondary_code:_0x2b94f7,prod_code:_0x1c159f,level:_0x293fc4,isle:_0x26e249,pallet:_0x4f4fbd,batch_code:_0x38c149,SCRN:_0x44dc52,expiry_date:_0x532f69}=_0x42efd8[_0x19af88(0xe0)];if(typeof _0x46aac1==_0x19af88(0x7c))var _0x4d9945=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0xd9)]],_0x48377d=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0x9c)]],_0xb487c1=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0x14d)]],_0x486a94=[_0x42efd8[_0x19af88(0xe0)]['primary_code']],_0xd9a254=[_0x42efd8['body']['secondary_code']],_0x45f57b=[_0x42efd8[_0x19af88(0xe0)]['prod_code']],_0x2606ca=[_0x42efd8['body'][_0x19af88(0x13a)]],_0x3157a2=[_0x42efd8['body'][_0x19af88(0xf7)]],_0x4aa50e=[_0x42efd8['body'][_0x19af88(0x155)]],_0x5e11b5=[_0x42efd8[_0x19af88(0xe0)]['batch_code']],_0x53460d=[_0x42efd8['body'][_0x19af88(0x14c)]],_0xd52c13=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0x12a)]],_0x485e3e=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0x16b)]],_0x3ebee6=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0xbe)]],_0x4908d=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0x86)]],_0x13e60e=[_0x42efd8[_0x19af88(0xe0)]['delivery_code']],_0x249593=[_0x42efd8['body']['prod_cat']],_0x461782=[_0x42efd8[_0x19af88(0xe0)]['quantity']],_0x5872c1=[_0x42efd8['body'][_0x19af88(0xc7)]],_0x16956e=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0x107)]],_0x28caf=[_0x42efd8[_0x19af88(0xe0)][_0x19af88(0xfc)]],_0x5707d8=[_0x42efd8[_0x19af88(0xe0)]['actual_uom']];else var _0x4d9945=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0xd9)]],_0x48377d=[..._0x42efd8[_0x19af88(0xe0)]['stock']],_0xb487c1=[..._0x42efd8['body'][_0x19af88(0x14d)]],_0x486a94=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0xb5)]],_0xd9a254=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0xd2)]],_0x45f57b=[..._0x42efd8[_0x19af88(0xe0)]['prod_code']],_0x2606ca=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0x13a)]],_0x3157a2=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0xf7)]],_0x4aa50e=[..._0x42efd8[_0x19af88(0xe0)]['secondary_unit']],_0x5e11b5=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0x129)]],_0x53460d=[..._0x42efd8['body']['expiry_date']],_0xd52c13=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0x12a)]],_0x485e3e=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0x16b)]],_0x3ebee6=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0xbe)]],_0x4908d=[..._0x42efd8[_0x19af88(0xe0)]['delivery_date']],_0x13e60e=[..._0x42efd8['body'][_0x19af88(0x74)]],_0x249593=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0xac)]],_0x461782=[..._0x42efd8[_0x19af88(0xe0)]['quantity']],_0x5872c1=[..._0x42efd8['body'][_0x19af88(0xc7)]],_0x16956e=[..._0x42efd8['body']['prod_invoice']],_0x28caf=[..._0x42efd8[_0x19af88(0xe0)]['actual_qty']],_0x5707d8=[..._0x42efd8[_0x19af88(0xe0)][_0x19af88(0x15e)]];const _0x558a3b=_0x4d9945[_0x19af88(0x77)](_0x363c53=>{return _0x363c53={'product_name':_0x363c53};});_0x48377d[_0x19af88(0x17a)]((_0x598f86,_0x46fdeb)=>{var _0x290989=_0x19af88;_0x558a3b[_0x46fdeb][_0x290989(0x9c)]=Math[_0x290989(0xc0)](_0x598f86);}),_0x28caf['forEach']((_0x7d263,_0x5218c9)=>{var _0x3dd225=_0x19af88;_0x558a3b[_0x5218c9]['actual_qty']=Math[_0x3dd225(0xc0)](_0x7d263);}),_0x5707d8[_0x19af88(0x17a)]((_0x33d1fe,_0x267902)=>{var _0x59c547=_0x19af88;_0x558a3b[_0x267902][_0x59c547(0x15e)]=_0x33d1fe;}),_0xb487c1[_0x19af88(0x17a)]((_0x501966,_0x13225b)=>{_0x558a3b[_0x13225b]['quantity']=_0x501966;}),_0x486a94[_0x19af88(0x17a)]((_0x519f5c,_0x8634c0)=>{_0x558a3b[_0x8634c0]['primary_code']=_0x519f5c;}),_0xd9a254['forEach']((_0x45ccc6,_0x57adb0)=>{var _0x48ac4a=_0x19af88;_0x558a3b[_0x57adb0][_0x48ac4a(0xd2)]=_0x45ccc6;}),_0x45f57b[_0x19af88(0x17a)]((_0x31ad06,_0x38fb94)=>{var _0x57c8e0=_0x19af88;_0x558a3b[_0x38fb94][_0x57c8e0(0x131)]=_0x31ad06;}),_0x2606ca[_0x19af88(0x17a)]((_0x48b523,_0x4bbbf6)=>{var _0x374a20=_0x19af88;_0x5872c1[_0x374a20(0x17a)]((_0x2d5f92,_0x3b68ab)=>{var _0x4e57c4=_0x374a20;if(_0x2d5f92==_0x4e57c4(0xf2)&&_0x4bbbf6==_0x3b68ab){var _0x3bdb28=_0x48b523['slice'](0x3);_0x558a3b[_0x4bbbf6][_0x4e57c4(0xd7)]=_0x48b523[0x0],_0x558a3b[_0x4bbbf6][_0x4e57c4(0xad)]=_0x48b523[0x1],_0x558a3b[_0x4bbbf6][_0x4e57c4(0x161)]=0x0,_0x558a3b[_0x4bbbf6][_0x4e57c4(0x16c)]=0x0,_0x558a3b[_0x4bbbf6][_0x4e57c4(0xf3)]=_0x4e57c4(0x163),_0x558a3b[_0x4bbbf6]['floorlevel']=_0x3bdb28;}else{if(_0x2d5f92==_0x4e57c4(0x78)&&_0x4bbbf6==_0x3b68ab){var _0x3bdb28=_0x48b523[_0x4e57c4(0x11a)](0x3);_0x558a3b[_0x4bbbf6]['storage']=_0x48b523[0x0],_0x558a3b[_0x4bbbf6][_0x4e57c4(0xad)]=_0x48b523[0x1],_0x558a3b[_0x4bbbf6][_0x4e57c4(0x161)]=0x0,_0x558a3b[_0x4bbbf6][_0x4e57c4(0x16c)]=0x0,_0x558a3b[_0x4bbbf6]['type']=_0x4e57c4(0x163),_0x558a3b[_0x4bbbf6][_0x4e57c4(0x16f)]=_0x48b523[0x5];}else{if(_0x4bbbf6==_0x3b68ab){var _0x7a9f57;if(_0x48b523[0x4]=='L')_0x7a9f57=_0x4e57c4(0x135);else _0x48b523[0x4]=='F'&&(_0x7a9f57=_0x4e57c4(0x163));_0x558a3b[_0x4bbbf6][_0x4e57c4(0xd7)]=_0x48b523[0x0],_0x558a3b[_0x4bbbf6][_0x4e57c4(0xad)]=_0x48b523[0x1],_0x558a3b[_0x4bbbf6][_0x4e57c4(0x161)]=_0x48b523[0x2],_0x558a3b[_0x4bbbf6][_0x4e57c4(0x16c)]=_0x48b523[0x3],_0x558a3b[_0x4bbbf6]['type']=_0x7a9f57,_0x558a3b[_0x4bbbf6][_0x4e57c4(0x16f)]=_0x48b523[0x5];}}}});}),_0x3157a2[_0x19af88(0x17a)]((_0x1aea78,_0x4801b5)=>{var _0x59bd0f=_0x19af88;_0x558a3b[_0x4801b5][_0x59bd0f(0xa0)]=_0x1aea78;}),_0x4aa50e['forEach']((_0x187b87,_0x4b24c7)=>{var _0x5190bf=_0x19af88;_0x558a3b[_0x4b24c7][_0x5190bf(0x155)]=_0x187b87;}),_0x5e11b5['forEach']((_0x7df904,_0x39efde)=>{var _0x5aac80=_0x19af88;_0x558a3b[_0x39efde][_0x5aac80(0x129)]=_0x7df904;}),_0x53460d[_0x19af88(0x17a)]((_0x12113f,_0x4909b9)=>{var _0xf51136=_0x19af88;_0x558a3b[_0x4909b9][_0xf51136(0x14c)]=_0x12113f;}),_0xd52c13[_0x19af88(0x17a)]((_0x264a62,_0x100d53)=>{var _0x4c8662=_0x19af88;_0x558a3b[_0x100d53][_0x4c8662(0x168)]=_0x264a62;}),_0x485e3e[_0x19af88(0x17a)]((_0x1443b2,_0x3d415f)=>{var _0x82e7d2=_0x19af88;_0x558a3b[_0x3d415f][_0x82e7d2(0x16b)]=_0x1443b2;}),_0x3ebee6[_0x19af88(0x17a)]((_0x327c7c,_0x3aa6dd)=>{var _0x4f4542=_0x19af88;_0x558a3b[_0x3aa6dd][_0x4f4542(0xbe)]=_0x327c7c;}),_0x4908d[_0x19af88(0x17a)]((_0x3e75a7,_0x154350)=>{var _0x3a2553=_0x19af88;_0x558a3b[_0x154350][_0x3a2553(0x86)]=_0x3e75a7;}),_0x13e60e[_0x19af88(0x17a)]((_0x2d8ce1,_0x20354a)=>{var _0x4ebaaa=_0x19af88;_0x558a3b[_0x20354a][_0x4ebaaa(0x74)]=_0x2d8ce1;}),_0x249593[_0x19af88(0x17a)]((_0x4eb6af,_0x5d7c21)=>{var _0x5a7b76=_0x19af88;_0x558a3b[_0x5d7c21][_0x5a7b76(0xac)]=_0x4eb6af;}),_0x461782[_0x19af88(0x17a)]((_0x11c13e,_0x14bf1a)=>{var _0x585aff=_0x19af88;_0x558a3b[_0x14bf1a][_0x585aff(0x13b)]=_0x11c13e;}),_0x5872c1[_0x19af88(0x17a)]((_0xc4dbd7,_0x120a0c)=>{var _0x3893da=_0x19af88;_0x558a3b[_0x120a0c][_0x3893da(0xf4)]=_0xc4dbd7;}),_0x16956e[_0x19af88(0x17a)]((_0x24bb25,_0x4a0f61)=>{var _0x1e4fe7=_0x19af88;_0x558a3b[_0x4a0f61][_0x1e4fe7(0x130)]=_0x24bb25;});var _0x127ed3=0x0;_0x558a3b[_0x19af88(0x17a)](_0x210a24=>{var _0x3d256a=_0x19af88;(_0x210a24[_0x3d256a(0x9c)]<_0x210a24[_0x3d256a(0x13b)]||_0x210a24[_0x3d256a(0x13b)]==0x0)&&(console['log']('foreach\x20newproduct',_0x210a24),_0x127ed3++);});const _0x22425c=_0x558a3b[_0x19af88(0x89)](_0x3c54b4=>_0x3c54b4[_0x19af88(0x8f)]!=='0'&&_0x3c54b4[_0x19af88(0x8f)]!==''),_0x4e7d46=new sales({'invoice':_0x3191f0,'customer':_0x42efd8[_0x19af88(0xe0)]['customer'],'date':_0x4d4847,'warehouse_name':_0x4e84aa,'sale_product':_0x22425c,'note':_0x5c844d,'room':_0x40bcbc,'primary_code':_0x2844f1,'secondary_code':_0x2b94f7,'prod_code':_0x1c159f,'SCRN':_0x44dc52}),_0x3358fa=await _0x4e7d46[_0x19af88(0x12c)]();_0x42efd8['flash']('success',_0x19af88(0x118)),_0x3a8135['redirect'](_0x19af88(0xdb)+_0x3358fa[_0x19af88(0x7b)]);}catch(_0x47c80b){console[_0x19af88(0xf8)](_0x47c80b);}}),router[a0_0x2b02c6(0xb8)](a0_0x2b02c6(0x134),auth,async(_0x4b7977,_0x4ed1c4)=>{var _0x477e7d=a0_0x2b02c6;try{const {username:_0x504fc1,email:_0x2c1118,role:_0x1a7e32}=_0x4b7977[_0x477e7d(0x137)],_0x1d3ac1=_0x4b7977['user'],_0x23f76d=await profile[_0x477e7d(0xff)]({'email':_0x1d3ac1['email']}),_0x4d146c=await master_shop[_0x477e7d(0xb6)](),_0x178a0b=_0x4b7977[_0x477e7d(0x96)]['id'],_0x6e6f28=await sales[_0x477e7d(0x7d)](_0x178a0b),_0x3e29c1=await warehouse[_0x477e7d(0x140)]([{'$match':{'name':_0x6e6f28['warehouse_name']}},{'$unwind':_0x477e7d(0x79)},{'$group':{'_id':_0x477e7d(0x10d),'name':{'$first':_0x477e7d(0x11d)},'product_stock':{'$first':_0x477e7d(0xa6)},'bay':{'$first':_0x477e7d(0xe3)},'bin':{'$first':_0x477e7d(0x10c)},'type':{'$first':_0x477e7d(0x11f)},'floorlevel':{'$first':_0x477e7d(0x15a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x477e7d(0x9b)},'product_code':{'$first':_0x477e7d(0x16e)},'storage':{'$first':_0x477e7d(0x143)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x1651b4=await customer[_0x477e7d(0xb6)]({});let _0x34ec1c;if(_0x1d3ac1[_0x477e7d(0xb7)]=='staff'){const _0xa0f409=await staff[_0x477e7d(0xff)]({'email':_0x1d3ac1[_0x477e7d(0x13e)]});_0x34ec1c=await warehouse[_0x477e7d(0x140)]([{'$match':{'status':_0x477e7d(0x9d),'name':_0xa0f409[_0x477e7d(0xda)]}},{'$group':{'_id':_0x477e7d(0xa8),'name':{'$first':'$name'}}}]);}else _0x34ec1c=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x477e7d(0xa8),'name':{'$first':_0x477e7d(0xa8)}}}]);const _0x53d760=await product[_0x477e7d(0xb6)]({}),_0x3863b3=await suppliers[_0x477e7d(0xb6)]({});if(_0x4d146c[0x0]['language']==_0x477e7d(0xcd)){var _0xbe1719=users['English'];console[_0x477e7d(0xf8)](_0xbe1719);}else{if(_0x4d146c[0x0][_0x477e7d(0x124)]==_0x477e7d(0x14f))var _0xbe1719=users[_0x477e7d(0x14f)];else{if(_0x4d146c[0x0][_0x477e7d(0x124)]==_0x477e7d(0x120))var _0xbe1719=users[_0x477e7d(0x120)];else{if(_0x4d146c[0x0]['language']==_0x477e7d(0x10b))var _0xbe1719=users[_0x477e7d(0x10b)];else{if(_0x4d146c[0x0][_0x477e7d(0x124)]==_0x477e7d(0x15b))var _0xbe1719=users['French'];else{if(_0x4d146c[0x0]['language']=='Portuguese\x20(BR)')var _0xbe1719=users['Portuguese'];else{if(_0x4d146c[0x0][_0x477e7d(0x124)]==_0x477e7d(0x98))var _0xbe1719=users[_0x477e7d(0x98)];else{if(_0x4d146c[0x0][_0x477e7d(0x124)]==_0x477e7d(0xf6))var _0xbe1719=users[_0x477e7d(0x15d)];}}}}}}}_0x4ed1c4['render']('edit_sales_view',{'success':_0x4b7977[_0x477e7d(0x146)](_0x477e7d(0x100)),'errors':_0x4b7977[_0x477e7d(0x146)]('errors'),'role':_0x1d3ac1,'profile':_0x23f76d,'customer':_0x1651b4,'warehouse':_0x34ec1c,'product':_0x3e29c1,'user':_0x6e6f28,'master_shop':_0x4d146c,'unit':_0x53d760,'language':_0xbe1719,'suppliers':_0x3863b3});}catch(_0x5b213c){console[_0x477e7d(0xf8)](_0x5b213c);}}),router['post'](a0_0x2b02c6(0x134),auth,async(_0x28cb33,_0x410536)=>{var _0x53f992=a0_0x2b02c6;try{const _0x414289=_0x28cb33['params']['id'],{invoice:_0x3dcdd9,warehouse_name:_0x5d906e,room:_0x50482e}=_0x28cb33['body'],_0xad3b1b=await sales[_0x53f992(0xff)]({'invoice':_0x3dcdd9}),_0x4c92ce=_0xad3b1b[_0x53f992(0x106)][_0x53f992(0x77)](async _0x341adc=>{var _0xca86f5=_0x53f992,_0x42a29a=await warehouse[_0xca86f5(0xff)]({'name':_0x5d906e,'room':_0x341adc[_0xca86f5(0xf4)],'warehouse_category':'Raw\x20Materials'});const _0x2ea9d5=_0x42a29a['product_details'][_0xca86f5(0x77)](_0x203c9d=>{var _0x1d5b2f=_0xca86f5;_0x203c9d['product_name']==_0x341adc['product_name']&&_0x203c9d[_0x1d5b2f(0x16f)]==_0x341adc[_0x1d5b2f(0x16f)]&&_0x203c9d[_0x1d5b2f(0xf3)]==_0x341adc['type']&&_0x203c9d[_0x1d5b2f(0x16c)]==_0x341adc[_0x1d5b2f(0x16c)]&&_0x203c9d[_0x1d5b2f(0x161)]==_0x341adc['bay']&&_0x203c9d['rack']==_0x341adc[_0x1d5b2f(0xad)]&&_0x203c9d['storage']==_0x341adc['storage']&&_0x203c9d['expiry_date']==_0x341adc[_0x1d5b2f(0x14c)]&&_0x203c9d[_0x1d5b2f(0x129)]==_0x341adc[_0x1d5b2f(0x129)]&&_0x203c9d[_0x1d5b2f(0x130)]==_0x341adc['invoice']&&(_0x203c9d['product_stock']=Math[_0x1d5b2f(0xc0)](_0x203c9d[_0x1d5b2f(0xdc)])-Math[_0x1d5b2f(0xc0)](_0x341adc[_0x1d5b2f(0x8f)]));});return _0x42a29a;});Promise[_0x53f992(0x154)](_0x4c92ce)[_0x53f992(0x14a)](async _0x1de392=>{var _0x1a99af=_0x53f992;try{for(const _0x194482 of _0x1de392){await _0x194482[_0x1a99af(0x12c)]();}_0xad3b1b[_0x1a99af(0x99)]=_0x1a99af(0x14e);const _0x40c36e=await _0xad3b1b[_0x1a99af(0x12c)](),_0x293820=await master_shop[_0x1a99af(0xb6)](),_0x27a561=await email_settings['findOne'](),_0x5dbda4=await supervisor_settings[_0x1a99af(0xb6)]();var _0x3d991f=_0xad3b1b['sale_product'],_0x256cc7='',_0xe40b1b;for(_0xe40b1b in _0x3d991f){_0x256cc7+=_0x1a99af(0xf1)+_0x1a99af(0x150)+_0x3d991f[_0xe40b1b]['product_name']+_0x1a99af(0x7e)+_0x1a99af(0x150)+_0x3d991f[_0xe40b1b][_0x1a99af(0x131)]+_0x1a99af(0x7e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d991f[_0xe40b1b][_0x1a99af(0x8f)]+_0x1a99af(0x7e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d991f[_0xe40b1b][_0x1a99af(0xa0)]+'</td>'+_0x1a99af(0x150)+_0x3d991f[_0xe40b1b][_0x1a99af(0x155)]+'</td>'+_0x1a99af(0x150)+_0xad3b1b['warehouse_name']+_0x1a99af(0x7e)+_0x1a99af(0x150)+_0x3d991f[_0xe40b1b]['room_name']+_0x1a99af(0x7e)+_0x1a99af(0x150)+_0x3d991f[_0xe40b1b]['storage']+_0x3d991f[_0xe40b1b][_0x1a99af(0xad)]+_0x3d991f[_0xe40b1b]['bay']+_0x3d991f[_0xe40b1b]['bin']+_0x3d991f[_0xe40b1b][_0x1a99af(0xf3)][0x0]+_0x3d991f[_0xe40b1b]['floorlevel']+'</td>',_0x1a99af(0xca);}let _0x595bf6=nodemailer[_0x1a99af(0x102)]({'host':_0x27a561[_0x1a99af(0xbc)],'port':Number(_0x27a561[_0x1a99af(0x160)]),'secure':![],'auth':{'user':_0x27a561[_0x1a99af(0x13e)],'pass':_0x27a561[_0x1a99af(0x126)]}}),_0x4a66b4={'from':_0x27a561[_0x1a99af(0x13e)],'to':_0x5dbda4[0x0][_0x1a99af(0x122)],'subject':_0x1a99af(0x113),'attachments':[{'filename':_0x1a99af(0x133),'path':__dirname+_0x1a99af(0x94)+_0x1a99af(0x157)+_0x293820[0x0][_0x1a99af(0xae)],'cid':'logo'}],'html':_0x1a99af(0xef)+'<html><head><title></title>'+_0x1a99af(0x147)+_0x1a99af(0xc2)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1a99af(0xc2)+_0x1a99af(0x83)+'</div>'+_0x1a99af(0xc2)+_0x1a99af(0x88)+_0x293820[0x0][_0x1a99af(0x12e)]+'\x20</h2>'+_0x1a99af(0xa2)+'</div>'+_0x1a99af(0x142)+'<div>'+_0x1a99af(0xa1)+_0x1a99af(0xfd)+_0xad3b1b['invoice']+'\x20'+_0x1a99af(0x16d)+_0x1a99af(0x16a)+_0xad3b1b[_0x1a99af(0x12d)]+'\x20'+_0x1a99af(0x165)+'</h5>'+_0x1a99af(0xa2)+_0x1a99af(0xdf)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1a99af(0xf1)+_0x1a99af(0xce)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1a99af(0x9a)+_0x1a99af(0x12f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1a99af(0x7f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1a99af(0xde)+_0x1a99af(0xca)+_0x1a99af(0xa5)+_0x1a99af(0x109)+'\x20'+_0x256cc7+'\x20'+_0x1a99af(0x144)+'</table>'+_0x1a99af(0xc2)+_0x1a99af(0xcf)+_0x1a99af(0x81)+_0x293820[0x0][_0x1a99af(0x12e)]+_0x1a99af(0x178)+_0x1a99af(0xa2)+_0x1a99af(0xa2)+_0x1a99af(0xbf)};_0x595bf6[_0x1a99af(0xa9)](_0x4a66b4,function(_0x4167be,_0x4590a3){var _0x65eff=_0x1a99af;_0x4167be?(console['log'](_0x4167be),console[_0x65eff(0xf8)]('Error\x20Occurs')):console[_0x65eff(0xf8)](_0x65eff(0x9e));}),_0x28cb33[_0x1a99af(0x146)](_0x1a99af(0x100),_0x1a99af(0x141)),_0x410536[_0x1a99af(0x173)]('/all_sales/preview/'+_0x414289);}catch(_0x13d00d){console[_0x1a99af(0xf0)](_0x13d00d),_0x410536[_0x1a99af(0x148)](0x1f4)['json']({'error':_0x1a99af(0x139)});}})['catch'](_0x3223e1=>{var _0x53b9f5=_0x53f992;console[_0x53b9f5(0xf0)](_0x3223e1),_0x410536[_0x53b9f5(0x148)](0x1f4)[_0x53b9f5(0xee)]({'error':'An\x20error\x20occurred.'});});}catch(_0x7d600){console[_0x53f992(0xf8)](_0x7d600);}}),router[a0_0x2b02c6(0xb8)]('/view/:id',auth,async(_0x31b42e,_0x3ab8a2)=>{var _0x3889ea=a0_0x2b02c6;try{const {username:_0x486a49,email:_0x130c35,role:_0x5876dc}=_0x31b42e[_0x3889ea(0x137)],_0x47a28f=_0x31b42e[_0x3889ea(0x137)],_0x2b47df=await profile[_0x3889ea(0xff)]({'email':_0x47a28f[_0x3889ea(0x13e)]}),_0x505ba9=await master_shop['find'](),_0x3b3e29=_0x31b42e[_0x3889ea(0x96)]['id'],_0x5cafac=await sales['findById'](_0x3b3e29);var _0x4a03ba=[_0x3889ea(0x125),_0x3889ea(0x8d)];const _0x26bc04=await warehouse[_0x3889ea(0x140)]([{'$match':{'name':_0x5cafac[_0x3889ea(0x174)],'warehouse_category':_0x3889ea(0xaf)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3889ea(0x10d),'name':{'$first':_0x3889ea(0x11d)},'product_stock':{'$first':_0x3889ea(0xa6)},'bay':{'$first':_0x3889ea(0xe3)},'bin':{'$first':_0x3889ea(0x10c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3889ea(0x15a)},'primary_code':{'$first':_0x3889ea(0xcb)},'secondary_code':{'$first':_0x3889ea(0x9b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3889ea(0x95)}}}]),_0x56f2d6=await customer[_0x3889ea(0xb6)]({});let _0x424a97;if(_0x47a28f[_0x3889ea(0xb7)]=='staff'){const _0x56dee7=await staff['findOne']({'email':_0x47a28f[_0x3889ea(0x13e)]});_0x424a97=await warehouse['aggregate']([{'$match':{'status':_0x3889ea(0x9d),'name':_0x56dee7[_0x3889ea(0xda)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3889ea(0xa8),'name':{'$first':_0x3889ea(0xa8)}}}]);}else _0x424a97=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x3889ea(0xaf)}},{'$group':{'_id':_0x3889ea(0xa8),'name':{'$first':_0x3889ea(0xa8)}}}]);const _0x43de70=await product['find']({});if(_0x505ba9[0x0]['language']=='English\x20(US)'){var _0x43fa64=users[_0x3889ea(0xb2)];console['log'](_0x43fa64);}else{if(_0x505ba9[0x0][_0x3889ea(0x124)]=='Hindi')var _0x43fa64=users['Hindi'];else{if(_0x505ba9[0x0]['language']==_0x3889ea(0x120))var _0x43fa64=users[_0x3889ea(0x120)];else{if(_0x505ba9[0x0][_0x3889ea(0x124)]=='Spanish')var _0x43fa64=users['Spanish'];else{if(_0x505ba9[0x0]['language']==_0x3889ea(0x15b))var _0x43fa64=users[_0x3889ea(0x15b)];else{if(_0x505ba9[0x0][_0x3889ea(0x124)]==_0x3889ea(0x13f))var _0x43fa64=users['Portuguese'];else{if(_0x505ba9[0x0]['language']=='Chinese')var _0x43fa64=users['Chinese'];else{if(_0x505ba9[0x0][_0x3889ea(0x124)]==_0x3889ea(0xf6))var _0x43fa64=users[_0x3889ea(0x15d)];}}}}}}}_0x3ab8a2['render']('edit_sales',{'success':_0x31b42e[_0x3889ea(0x146)](_0x3889ea(0x100)),'errors':_0x31b42e[_0x3889ea(0x146)]('errors'),'role':_0x47a28f,'profile':_0x2b47df,'customer':_0x56f2d6,'warehouse':_0x424a97,'product':_0x26bc04,'user':_0x5cafac,'master_shop':_0x505ba9,'unit':_0x43de70,'language':_0x43fa64});}catch(_0x51f6af){console['log'](_0x51f6af);}}),router['post'](a0_0x2b02c6(0xe6),auth,async(_0x2f5986,_0xd5a78)=>{var _0x4843ba=a0_0x2b02c6;try{const _0x27d041=_0x2f5986[_0x4843ba(0x96)]['id'],_0x61223=await sales[_0x4843ba(0xff)]({'_id':_0x2f5986[_0x4843ba(0x96)]['id']}),_0x56b26b=await warehouse[_0x4843ba(0xff)]({'name':_0x61223['warehouse_name'],'room':_0x2f5986[_0x4843ba(0xe0)]['room']}),{invoice:_0x417bb3,date:_0x69a85e,warehouse_name:_0x42fbad,product_name:_0x36e913,stock:_0x5f64d3,quantity:_0x144dd,note:_0x5e77ca,room:_0xe26f77,customer:_0x4feeb9,SCRN:_0x5984d1}=_0x2f5986[_0x4843ba(0xe0)];if(typeof _0x36e913==_0x4843ba(0x7c))var _0x377095=[_0x2f5986['body']['product_name']],_0x276557=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x9c)]],_0x5a92c6=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x14d)]],_0xc62a16=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xb5)]],_0x3498c7=[_0x2f5986[_0x4843ba(0xe0)]['secondary_code']],_0x3546a1=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x104)]],_0x58bfdb=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x13a)]],_0x550daf=[_0x2f5986['body']['primary_unit']],_0x341acd=[_0x2f5986['body'][_0x4843ba(0x155)]],_0x4dbcd0=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x129)]],_0x30da55=[_0x2f5986[_0x4843ba(0xe0)]['expiry_date']],_0x808593=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x12a)]],_0x1e1217=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x16b)]],_0x5f01ed=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xbe)]],_0x3a54be=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x86)]],_0x32796b=[_0x2f5986[_0x4843ba(0xe0)]['delivery_code']],_0x4338d0=[_0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xac)]],_0x245fa3=[_0x2f5986[_0x4843ba(0xe0)]['quantity']],_0x36cacc=[_0x2f5986[_0x4843ba(0xe0)]['RoomAssigned']];else var _0x377095=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xd9)]],_0x276557=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x9c)]],_0x5a92c6=[..._0x2f5986['body'][_0x4843ba(0x14d)]],_0xc62a16=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xb5)]],_0x3498c7=[..._0x2f5986['body'][_0x4843ba(0xd2)]],_0x3546a1=[..._0x2f5986['body'][_0x4843ba(0x104)]],_0x58bfdb=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x13a)]],_0x550daf=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xf7)]],_0x341acd=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x155)]],_0x4dbcd0=[..._0x2f5986[_0x4843ba(0xe0)]['batch_code']],_0x30da55=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x14c)]],_0x808593=[..._0x2f5986['body'][_0x4843ba(0x12a)]],_0x1e1217=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x16b)]],_0x5f01ed=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0xbe)]],_0x3a54be=[..._0x2f5986[_0x4843ba(0xe0)][_0x4843ba(0x86)]],_0x32796b=[..._0x2f5986['body']['delivery_code']],_0x4338d0=[..._0x2f5986['body'][_0x4843ba(0xac)]],_0x245fa3=[..._0x2f5986['body'][_0x4843ba(0x8f)]],_0x36cacc=[..._0x2f5986[_0x4843ba(0xe0)]['RoomAssigned']];const _0x109dac=_0x377095[_0x4843ba(0x77)](_0x461629=>{return _0x461629={'product_name':_0x461629};});_0x276557['forEach']((_0x224fdb,_0x4c893b)=>{var _0x556994=_0x4843ba;_0x109dac[_0x4c893b][_0x556994(0x9c)]=Math[_0x556994(0xc0)](_0x224fdb);}),_0x5a92c6[_0x4843ba(0x17a)]((_0x37e89e,_0x1772b6)=>{var _0x3e4e65=_0x4843ba;_0x109dac[_0x1772b6][_0x3e4e65(0x8f)]=_0x37e89e;}),_0xc62a16['forEach']((_0x1c5d90,_0x748039)=>{var _0x4c284d=_0x4843ba;_0x109dac[_0x748039][_0x4c284d(0xb5)]=_0x1c5d90;}),_0x3498c7['forEach']((_0x150df2,_0x233b24)=>{var _0x356bb4=_0x4843ba;_0x109dac[_0x233b24][_0x356bb4(0xd2)]=_0x150df2;}),_0x3546a1[_0x4843ba(0x17a)]((_0x5648c9,_0x25d8b6)=>{var _0x3799ae=_0x4843ba;_0x109dac[_0x25d8b6][_0x3799ae(0x131)]=_0x5648c9;}),_0x58bfdb[_0x4843ba(0x17a)]((_0x4c0a38,_0x338e9b)=>{_0x36cacc['forEach']((_0x5a4ae9,_0x1403b0)=>{var _0x3cc02e=a0_0x1aac;if(_0x5a4ae9==_0x3cc02e(0xf2)&&_0x338e9b==_0x1403b0){var _0x59c1d8=_0x4c0a38['slice'](0x3);_0x109dac[_0x338e9b]['storage']=_0x4c0a38[0x0],_0x109dac[_0x338e9b]['rack']=_0x4c0a38[0x1],_0x109dac[_0x338e9b]['bay']=0x0,_0x109dac[_0x338e9b]['bin']=0x0,_0x109dac[_0x338e9b][_0x3cc02e(0xf3)]=_0x3cc02e(0x163),_0x109dac[_0x338e9b][_0x3cc02e(0x16f)]=_0x59c1d8;}else{if(_0x5a4ae9==_0x3cc02e(0x78)&&_0x338e9b==_0x1403b0){var _0x59c1d8=_0x4c0a38[_0x3cc02e(0x11a)](0x3);_0x109dac[_0x338e9b][_0x3cc02e(0xd7)]=_0x4c0a38[0x0],_0x109dac[_0x338e9b][_0x3cc02e(0xad)]=_0x4c0a38[0x1],_0x109dac[_0x338e9b]['bay']=0x0,_0x109dac[_0x338e9b]['bin']=0x0,_0x109dac[_0x338e9b][_0x3cc02e(0xf3)]=_0x3cc02e(0x163),_0x109dac[_0x338e9b][_0x3cc02e(0x16f)]=_0x4c0a38[0x5];}else{if(_0x338e9b==_0x1403b0){var _0x424977;if(_0x4c0a38[0x4]=='L')_0x424977=_0x3cc02e(0x135);else _0x4c0a38[0x4]=='F'&&(_0x424977=_0x3cc02e(0x163));_0x109dac[_0x338e9b][_0x3cc02e(0xd7)]=_0x4c0a38[0x0],_0x109dac[_0x338e9b]['rack']=_0x4c0a38[0x1],_0x109dac[_0x338e9b][_0x3cc02e(0x161)]=_0x4c0a38[0x2],_0x109dac[_0x338e9b][_0x3cc02e(0x16c)]=_0x4c0a38[0x3],_0x109dac[_0x338e9b][_0x3cc02e(0xf3)]=_0x424977,_0x109dac[_0x338e9b][_0x3cc02e(0x16f)]=_0x4c0a38[0x5];}}}});}),_0x550daf[_0x4843ba(0x17a)]((_0x2c89d2,_0x59edfc)=>{var _0x2462b7=_0x4843ba;_0x109dac[_0x59edfc][_0x2462b7(0xa0)]=_0x2c89d2;}),_0x341acd[_0x4843ba(0x17a)]((_0x5c7496,_0x287084)=>{var _0x205164=_0x4843ba;_0x109dac[_0x287084][_0x205164(0x155)]=_0x5c7496;}),_0x4dbcd0[_0x4843ba(0x17a)]((_0x2dfef2,_0x54015d)=>{var _0x387435=_0x4843ba;_0x109dac[_0x54015d][_0x387435(0x129)]=_0x2dfef2;}),_0x30da55[_0x4843ba(0x17a)]((_0x5a65e,_0x28915a)=>{_0x109dac[_0x28915a]['expiry_date']=_0x5a65e;}),_0x808593['forEach']((_0x2b65b5,_0x20897f)=>{var _0x4b99ba=_0x4843ba;_0x109dac[_0x20897f][_0x4b99ba(0x168)]=_0x2b65b5;}),_0x1e1217['forEach']((_0x596594,_0x2aa96b)=>{var _0x553e81=_0x4843ba;_0x109dac[_0x2aa96b][_0x553e81(0x16b)]=_0x596594;}),_0x5f01ed[_0x4843ba(0x17a)]((_0x35dc03,_0x339691)=>{var _0x5111ee=_0x4843ba;_0x109dac[_0x339691][_0x5111ee(0xbe)]=Math[_0x5111ee(0xc0)](_0x35dc03);}),_0x3a54be[_0x4843ba(0x17a)]((_0x43b508,_0x5b1c51)=>{_0x109dac[_0x5b1c51]['delivery_date']=_0x43b508;}),_0x32796b[_0x4843ba(0x17a)]((_0x2614ee,_0x3aa821)=>{_0x109dac[_0x3aa821]['delivery_code']=_0x2614ee;}),_0x4338d0[_0x4843ba(0x17a)]((_0x57b3f9,_0x351b54)=>{var _0x3c5ab9=_0x4843ba;_0x109dac[_0x351b54][_0x3c5ab9(0xac)]=_0x57b3f9;}),_0x245fa3[_0x4843ba(0x17a)]((_0x3212f6,_0x466abc)=>{var _0x5f506c=_0x4843ba;_0x109dac[_0x466abc][_0x5f506c(0x13b)]=_0x3212f6;}),_0x36cacc[_0x4843ba(0x17a)]((_0x280ab7,_0x175773)=>{var _0x1ed02d=_0x4843ba;_0x109dac[_0x175773][_0x1ed02d(0xf4)]=_0x280ab7;});var _0x410bb5=0x0;_0x109dac[_0x4843ba(0x17a)](_0x4374f5=>{var _0x292da5=_0x4843ba;console['log'](_0x292da5(0x167),_0x4374f5),(parseInt(_0x4374f5['stock'])<parseInt(_0x4374f5[_0x292da5(0x8f)])||parseInt(_0x4374f5[_0x292da5(0x8f)])==0x0)&&_0x410bb5++;});if(_0x410bb5!=0x0)return _0x2f5986[_0x4843ba(0x146)](_0x4843ba(0x15f),_0x4843ba(0xc9)),_0xd5a78[_0x4843ba(0x173)]('back');const _0x24fd52=_0x109dac[_0x4843ba(0x89)](_0x2b9186=>_0x2b9186[_0x4843ba(0x8f)]!=='0'&&_0x2b9186[_0x4843ba(0x8f)]!=='');_0x61223[_0x4843ba(0x130)]=_0x417bb3,_0x61223[_0x4843ba(0x112)]=_0x4feeb9,_0x61223[_0x4843ba(0x12d)]=_0x69a85e,_0x61223[_0x4843ba(0x174)]=_0x42fbad,_0x61223[_0x4843ba(0x106)]=_0x24fd52,_0x61223[_0x4843ba(0x176)]=_0x5e77ca,_0x61223['SCRN']=_0x5984d1,_0x61223[_0x4843ba(0x99)]=_0x4843ba(0x156),_0x61223[_0x4843ba(0x85)]=_0x4843ba(0x156);const _0x4d83ac=await _0x61223['save']();_0x2f5986[_0x4843ba(0x146)](_0x4843ba(0x100),'Sales\x20Update\x20successfully'),_0xd5a78['redirect'](_0x4843ba(0xcc));}catch(_0x1380f6){console[_0x4843ba(0xf8)](_0x1380f6);}}),router[a0_0x2b02c6(0xb1)](a0_0x2b02c6(0x11c),auth,async(_0x43c837,_0x52c25a)=>{var _0x52f892=a0_0x2b02c6;try{const _0x1450e3=_0x43c837[_0x52f892(0x96)]['id'],{invoice:_0x9576ea,customer:_0x874aca,receivable_amount:_0x5b9856,received_amount:_0x5cb260}=_0x43c837['body'],_0x1db07d=await sales['findById'](_0x1450e3);console[_0x52f892(0xf8)](_0x1db07d);var _0x5bf3cd=_0x5b9856-_0x5cb260;console[_0x52f892(0xf8)](_0x5cb260),_0x1db07d[_0x52f892(0xd5)]=parseFloat(_0x5cb260)+parseFloat(_0x1db07d[_0x52f892(0xd5)]),_0x1db07d['due_amount']=_0x5bf3cd,console[_0x52f892(0xf8)](_0x1db07d);const _0x18f37f=await _0x1db07d['save'](),_0x42fe9d=await c_payment_data[_0x52f892(0xff)]({'invoice':_0x9576ea});_0x42fe9d[_0x52f892(0x138)]=_0x5bf3cd,await _0x42fe9d[_0x52f892(0x12c)]();let _0x30870f=new Date(),_0x1afd08=('0'+_0x30870f['getDate']())[_0x52f892(0x11a)](-0x2),_0x2cb11d=('0'+(_0x30870f['getMonth']()+0x1))[_0x52f892(0x11a)](-0x2),_0x51afde=_0x30870f['getFullYear'](),_0x2cb55d=_0x51afde+'-'+_0x2cb11d+'-'+_0x1afd08;const _0x5346a6=new customer_payment({'invoice':_0x9576ea,'date':_0x51afde+'-'+_0x2cb11d+'-'+_0x1afd08,'customer':_0x874aca,'reason':_0x52f892(0x145),'amount':_0x5cb260}),_0x5c05ec=await _0x5346a6[_0x52f892(0x12c)]();_0x43c837['flash']('success',_0x52f892(0x159)),_0x52c25a['redirect'](_0x52f892(0xcc));}catch(_0x3fbb02){console[_0x52f892(0xf8)](_0x3fbb02);}}),router[a0_0x2b02c6(0xb8)](a0_0x2b02c6(0xf9),auth,async(_0x59ad57,_0x2455f3)=>{var _0x482f89=a0_0x2b02c6;try{const {username:_0x8d7a1b,email:_0x356be9,role:_0x47a513}=_0x59ad57[_0x482f89(0x137)],_0x16dac7=_0x59ad57['user'],_0x31cb55=await profile['findOne']({'email':_0x16dac7[_0x482f89(0x13e)]}),_0x3cd6a1=await master_shop[_0x482f89(0xb6)]();console[_0x482f89(0xf8)]('master',_0x3cd6a1);const _0x5df77e=_0x59ad57[_0x482f89(0x96)]['id'],_0x33302e=await sales[_0x482f89(0x7d)](_0x5df77e);console['log'](_0x33302e);const _0x2c30a3=await customer['findOne']({'name':_0x33302e[_0x482f89(0x112)]});console['log'](_0x2c30a3);if(_0x3cd6a1[0x0][_0x482f89(0x124)]==_0x482f89(0xcd)){var _0x169a34=users[_0x482f89(0xb2)];console['log'](_0x169a34);}else{if(_0x3cd6a1[0x0][_0x482f89(0x124)]=='Hindi')var _0x169a34=users[_0x482f89(0x14f)];else{if(_0x3cd6a1[0x0][_0x482f89(0x124)]==_0x482f89(0x120))var _0x169a34=users[_0x482f89(0x120)];else{if(_0x3cd6a1[0x0][_0x482f89(0x124)]=='Spanish')var _0x169a34=users['Spanish'];else{if(_0x3cd6a1[0x0][_0x482f89(0x124)]==_0x482f89(0x15b))var _0x169a34=users[_0x482f89(0x15b)];else{if(_0x3cd6a1[0x0]['language']==_0x482f89(0x13f))var _0x169a34=users[_0x482f89(0xc1)];else{if(_0x3cd6a1[0x0][_0x482f89(0x124)]=='Chinese')var _0x169a34=users[_0x482f89(0x98)];else{if(_0x3cd6a1[0x0][_0x482f89(0x124)]==_0x482f89(0xf6))var _0x169a34=users[_0x482f89(0x15d)];}}}}}}}_0x2455f3[_0x482f89(0x17b)](_0x482f89(0x75),{'success':_0x59ad57[_0x482f89(0x146)](_0x482f89(0x100)),'errors':_0x59ad57[_0x482f89(0x146)](_0x482f89(0x15f)),'role':_0x16dac7,'profile':_0x31cb55,'master_shop':_0x3cd6a1,'customers':_0x2c30a3,'sales':_0x33302e,'language':_0x169a34});}catch(_0x3dcc69){console['log'](_0x3dcc69);}}),router[a0_0x2b02c6(0xb8)](a0_0x2b02c6(0xb4),auth,async(_0x414b1a,_0x2bf4f7)=>{var _0x52b0f2=a0_0x2b02c6;try{const {username:_0x5b7a16,email:_0x1dfa4d,role:_0x5d5b89}=_0x414b1a[_0x52b0f2(0x137)],_0x291df0=_0x414b1a[_0x52b0f2(0x137)],_0x4af849=await profile[_0x52b0f2(0xff)]({'email':_0x291df0[_0x52b0f2(0x13e)]}),_0x17ca01=await master_shop['find']();console[_0x52b0f2(0xf8)](_0x52b0f2(0x84),_0x17ca01);const _0x584cb1=_0x414b1a['params']['id'];console[_0x52b0f2(0xf8)](_0x584cb1);const _0x3ba12f=await sales[_0x52b0f2(0x7d)](_0x584cb1);console[_0x52b0f2(0xf8)](_0x52b0f2(0x82),_0x3ba12f);const _0x45c7ff=await warehouse[_0x52b0f2(0x140)]([{'$match':{'name':_0x52b0f2(0x10f),'room':_0x52b0f2(0xea)}},{'$unwind':_0x52b0f2(0x79)},{'$group':{'_id':_0x52b0f2(0x10d),'name':{'$first':_0x52b0f2(0x11d)},'product_stock':{'$first':_0x52b0f2(0xa6)},'level':{'$first':_0x52b0f2(0x117)},'isle':{'$first':_0x52b0f2(0x172)},'pallet':{'$first':_0x52b0f2(0x92)},'primary_code':{'$first':_0x52b0f2(0xcb)},'secondary_code':{'$first':_0x52b0f2(0x9b)},'product_code':{'$first':_0x52b0f2(0x16e)}}}]);console[_0x52b0f2(0xf8)](_0x52b0f2(0xec),_0x45c7ff);const _0x5b460b=await product['find']({});warehouse_data=await warehouse[_0x52b0f2(0x140)]([{'$match':{'status':'Enabled','name':_0x52b0f2(0x10f),'warehouse_category':_0x52b0f2(0xaf)}},{'$group':{'_id':'$name','name':{'$first':_0x52b0f2(0xa8)}}},{'$sort':{'name':0x1}}]);var _0xae4920=['Return\x20Rooms'];if(_0x17ca01[0x0]['language']==_0x52b0f2(0xcd)){var _0x3fc545=users[_0x52b0f2(0xb2)];console[_0x52b0f2(0xf8)](_0x3fc545);}else{if(_0x17ca01[0x0]['language']==_0x52b0f2(0x14f))var _0x3fc545=users['Hindi'];else{if(_0x17ca01[0x0][_0x52b0f2(0x124)]==_0x52b0f2(0x120))var _0x3fc545=users[_0x52b0f2(0x120)];else{if(_0x17ca01[0x0][_0x52b0f2(0x124)]==_0x52b0f2(0x10b))var _0x3fc545=users['Spanish'];else{if(_0x17ca01[0x0][_0x52b0f2(0x124)]==_0x52b0f2(0x15b))var _0x3fc545=users[_0x52b0f2(0x15b)];else{if(_0x17ca01[0x0]['language']==_0x52b0f2(0x13f))var _0x3fc545=users[_0x52b0f2(0xc1)];else{if(_0x17ca01[0x0][_0x52b0f2(0x124)]==_0x52b0f2(0x98))var _0x3fc545=users['Chinese'];else{if(_0x17ca01[0x0][_0x52b0f2(0x124)]==_0x52b0f2(0xf6))var _0x3fc545=users[_0x52b0f2(0x15d)];}}}}}}}_0x2bf4f7['render'](_0x52b0f2(0x101),{'success':_0x414b1a[_0x52b0f2(0x146)](_0x52b0f2(0x100)),'errors':_0x414b1a[_0x52b0f2(0x146)](_0x52b0f2(0x15f)),'role':_0x291df0,'profile':_0x4af849,'user':_0x3ba12f,'stock':_0x45c7ff,'master_shop':_0x17ca01,'unit':_0x5b460b,'language':_0x3fc545,'warehouses':warehouse_data,'rooms':_0xae4920});}catch(_0x117001){console[_0x52b0f2(0xf8)](_0x117001),_0x2bf4f7[_0x52b0f2(0x148)](0xc8)[_0x52b0f2(0xee)]({'message':_0x117001[_0x52b0f2(0xa3)]});}}),router['post'](a0_0x2b02c6(0xb4),auth,async(_0x4eab4e,_0x2c91b8)=>{var _0xfef370=a0_0x2b02c6;try{const {invoice:_0x3437ea,date:_0x3da82b,warehouse_name:_0x363f02,product_name:_0x2e762f,primary_code:_0x35e8c1,secondary_code:_0x1bd380,product_code:_0x25ad1e,sales_quantity:_0xaef03d,stocks:_0x56fb07,return_qty:_0x373c60,Room_name:_0x19991c,to_warehouse_name:_0x1b5849,to_Roomname:_0x439463,to_Room_name:_0x1c9bd7,note:_0x20c18b,level:_0x5a0166,isle:_0x16d725,pallet:_0x5e8ee5}=_0x4eab4e[_0xfef370(0xe0)];if(typeof _0x2e762f==_0xfef370(0x7c))var _0x416f13=[_0x4eab4e['body'][_0xfef370(0xd9)]],_0x477d57=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0xb5)]],_0x3dbce6=[_0x4eab4e[_0xfef370(0xe0)]['secondary_code']],_0x5ac7e1=[_0x4eab4e['body']['product_code']],_0x31e2bd=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0xa4)]],_0x1a4bbc=[_0x4eab4e['body'][_0xfef370(0x108)]],_0x2cbe98=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x80)]],_0x14e59e=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x161)]],_0x369c22=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x16c)]],_0x516478=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x115)]],_0x2b835c=[_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x16f)]];else var _0x416f13=[..._0x4eab4e[_0xfef370(0xe0)][_0xfef370(0xd9)]],_0x477d57=[..._0x4eab4e[_0xfef370(0xe0)][_0xfef370(0xb5)]],_0x3dbce6=[..._0x4eab4e[_0xfef370(0xe0)]['secondary_code']],_0x5ac7e1=[..._0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x131)]],_0x31e2bd=[..._0x4eab4e[_0xfef370(0xe0)][_0xfef370(0xa4)]],_0x1a4bbc=[..._0x4eab4e[_0xfef370(0xe0)]['stocks']],_0x2cbe98=[..._0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x80)]],_0x14e59e=[..._0x4eab4e['body'][_0xfef370(0x161)]],_0x369c22=[..._0x4eab4e[_0xfef370(0xe0)]['bin']],_0x516478=[..._0x4eab4e[_0xfef370(0xe0)]['types']],_0x2b835c=[..._0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x16f)]];const _0x14df27=_0x416f13[_0xfef370(0x77)](_0x18a46=>{return _0x18a46={'product_name':_0x18a46};});_0x477d57[_0xfef370(0x17a)]((_0x257452,_0x390f73)=>{var _0x63967c=_0xfef370;_0x14df27[_0x390f73][_0x63967c(0xb5)]=_0x257452;}),_0x3dbce6[_0xfef370(0x17a)]((_0x4f67d4,_0x2d919f)=>{_0x14df27[_0x2d919f]['secondary_code']=_0x4f67d4;}),_0x5ac7e1[_0xfef370(0x17a)]((_0x490179,_0x34a118)=>{var _0xa4b4f8=_0xfef370;_0x14df27[_0x34a118][_0xa4b4f8(0x131)]=_0x490179;}),_0x31e2bd[_0xfef370(0x17a)]((_0x4be101,_0x3461d0)=>{var _0x5ebfe6=_0xfef370;_0x14df27[_0x3461d0][_0x5ebfe6(0x76)]=_0x4be101;}),_0x1a4bbc[_0xfef370(0x17a)]((_0x2bc236,_0x51eae5)=>{var _0x3962ec=_0xfef370;_0x14df27[_0x51eae5][_0x3962ec(0x9c)]=_0x2bc236;}),_0x2cbe98[_0xfef370(0x17a)]((_0x23b362,_0x525265)=>{var _0x171f1f=_0xfef370;_0x14df27[_0x525265][_0x171f1f(0x80)]=_0x23b362;}),_0x14e59e[_0xfef370(0x17a)]((_0x54e6bf,_0x7d4d95)=>{var _0x2c3ee8=_0xfef370;_0x14df27[_0x7d4d95][_0x2c3ee8(0x161)]=_0x54e6bf;}),_0x369c22[_0xfef370(0x17a)]((_0x5410d9,_0x2e7e84)=>{var _0xd36e94=_0xfef370;_0x14df27[_0x2e7e84][_0xd36e94(0x16c)]=_0x5410d9;}),_0x516478[_0xfef370(0x17a)]((_0x395711,_0x18e898)=>{var _0x10b8ce=_0xfef370;_0x14df27[_0x18e898][_0x10b8ce(0xf3)]=_0x395711;}),_0x2b835c[_0xfef370(0x17a)]((_0x355abc,_0x13cc4e)=>{var _0x2324f9=_0xfef370;_0x14df27[_0x13cc4e][_0x2324f9(0x16f)]=_0x355abc;});var _0x452b93=0x0;_0x14df27[_0xfef370(0x17a)](_0x3fa752=>{var _0x3af83f=_0xfef370;console[_0x3af83f(0xf8)](_0x3af83f(0x167),_0x3fa752),(parseInt(_0x3fa752[_0x3af83f(0x76)])<parseInt(_0x3fa752['return_qty'])||parseInt(_0x3fa752[_0x3af83f(0x9c)])<parseInt(_0x3fa752['return_qty'])&&parseInt(_0x3fa752[_0x3af83f(0x76)])>parseInt(_0x3fa752[_0x3af83f(0x80)])||parseInt(_0x3fa752[_0x3af83f(0x80)])==0x0)&&_0x452b93++;});if(_0x452b93!=0x0)return _0x4eab4e['flash']('errors',_0xfef370(0xc8)),_0x2c91b8[_0xfef370(0x173)](_0xfef370(0x132));const _0x5d4245=await sales['findOne']({'invoice':_0x3437ea});console['log'](_0x5d4245),_0x5d4245[_0xfef370(0xed)]=_0xfef370(0x14e);const _0x200106=await _0x5d4245[_0xfef370(0x12c)](),_0x3d43f6=new sales_return({'invoice':_0x3437ea,'customer':_0x4eab4e['body'][_0xfef370(0x112)],'date':_0x3da82b,'warehouse_name':_0x363f02,'room':_0x19991c,'ToWarehouse':_0x1b5849,'ToRoom':_0x1c9bd7,'return_sale':_0x14df27,'note':_0x20c18b}),_0x151fbd=await _0x3d43f6[_0xfef370(0x12c)]();console[_0xfef370(0xf8)](_0x3d43f6);const _0x331534=await sales_return['findOne']({'invoice':_0x3437ea}),_0x49713d=await warehouse[_0xfef370(0xff)]({'name':_0x1b5849,'room':_0x1c9bd7});_0x331534[_0xfef370(0x101)]['forEach'](_0x2e7cab=>{var _0x5d1053=_0xfef370,_0x5e1a49=0x0;const _0x4a43f8=_0x49713d[_0x5d1053(0x121)][_0x5d1053(0x77)](_0x3056ff=>{var _0x5cb69f=_0x5d1053;_0x3056ff[_0x5cb69f(0xd9)]==_0x2e7cab[_0x5cb69f(0xd9)]&&_0x3056ff[_0x5cb69f(0x16f)]==_0x2e7cab['floorlevel']&&_0x3056ff[_0x5cb69f(0xf3)]==_0x2e7cab['type']&&_0x3056ff[_0x5cb69f(0x16c)]==_0x2e7cab[_0x5cb69f(0x16c)]&&_0x3056ff[_0x5cb69f(0x161)]==_0x2e7cab[_0x5cb69f(0x161)]&&(_0x3056ff[_0x5cb69f(0xdc)]=parseInt(_0x3056ff[_0x5cb69f(0xdc)])+parseInt(_0x2e7cab[_0x5cb69f(0x80)]),_0x5e1a49++);});_0x5e1a49=='0'&&(_0x49713d['product_details']=_0x49713d[_0x5d1053(0x121)][_0x5d1053(0xc6)]({'product_name':_0x2e7cab[_0x5d1053(0xd9)],'product_stock':_0x2e7cab['return_qty'],'primary_code':_0x2e7cab[_0x5d1053(0xb5)],'secondary_code':_0x2e7cab['secondary_code'],'product_code':_0x2e7cab[_0x5d1053(0x131)],'bay':_0x2e7cab['bay'],'bin':_0x2e7cab[_0x5d1053(0x16c)],'type':_0x2e7cab[_0x5d1053(0xf3)],'floorlevel':_0x2e7cab['floorlevel']})),console['log'](_0x5d1053(0xdd),_0x49713d);}),await _0x49713d[_0xfef370(0x12c)](),console['log'](_0x4eab4e[_0xfef370(0xe0)]);const _0x1e5a03=new c_payment_data({'invoice':_0x3437ea,'customer':_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x112)],'reason':_0xfef370(0x153)});await _0x1e5a03[_0xfef370(0x12c)]();const _0x510cce=await master_shop[_0xfef370(0xb6)]();console[_0xfef370(0xf8)](_0xfef370(0x151),_0x510cce[0x0][_0xfef370(0xae)]);const _0x3a5b47=await email_settings['findOne'](),_0x11ac0d=await customer[_0xfef370(0xff)]({'name':_0x4eab4e[_0xfef370(0xe0)][_0xfef370(0x112)]});console['log'](_0xfef370(0xb3),_0x11ac0d);_0x510cce[0x0][_0xfef370(0xfb)]==0x1?(right_currency=_0x510cce[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x510cce[0x0]['currency']);var _0x26c254=_0x416f13,_0x4c59f1=_0x2cbe98,_0x479965='',_0x2039ac;for(_0x2039ac in _0x26c254){_0x479965+=_0xfef370(0xf1)+_0xfef370(0x150)+_0x26c254[_0x2039ac]+_0xfef370(0x7e)+_0xfef370(0x150)+_0x4c59f1[_0x2039ac]+_0xfef370(0x7e)+'</tr>';}console['log'](_0xfef370(0xab),_0x479965);let _0x3adaa6=nodemailer[_0xfef370(0x102)]({'service':'gmail','auth':{'user':_0x3a5b47[_0xfef370(0x13e)],'pass':_0x3a5b47[_0xfef370(0x126)]}}),_0x8c9bdd={'from':_0x3a5b47[_0xfef370(0x13e)],'to':_0x11ac0d['email'],'subject':_0xfef370(0x152),'attachments':[{'filename':_0xfef370(0x133),'path':__dirname+_0xfef370(0x94)+_0xfef370(0x157)+_0x510cce[0x0]['image'],'cid':_0xfef370(0x170)}],'html':_0xfef370(0xef)+_0xfef370(0x15c)+_0xfef370(0x147)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xfef370(0xc2)+_0xfef370(0x83)+_0xfef370(0xa2)+_0xfef370(0xc2)+_0xfef370(0x88)+_0x510cce[0x0][_0xfef370(0x12e)]+'\x20</h2>'+'</div>'+_0xfef370(0xa2)+_0xfef370(0x142)+_0xfef370(0xc2)+_0xfef370(0xa1)+_0xfef370(0xfd)+_0x3437ea+'\x20'+_0xfef370(0x16d)+_0xfef370(0x16a)+_0x3da82b+'\x20'+_0xfef370(0x165)+_0xfef370(0x178)+_0xfef370(0xa2)+_0xfef370(0xdf)+_0xfef370(0x158)+'<tr>'+_0xfef370(0xce)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0xfef370(0xa7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0xfef370(0xa5)+_0xfef370(0x109)+'\x20'+_0x479965+'\x20'+'</tbody>'+'</table>'+_0xfef370(0xc2)+_0xfef370(0xcf)+'<h5>'+_0x510cce[0x0][_0xfef370(0x12e)]+_0xfef370(0x178)+_0xfef370(0xa2)+_0xfef370(0xa2)+_0xfef370(0xbf)};_0x3adaa6[_0xfef370(0xa9)](_0x8c9bdd,function(_0x2920a4,_0x3bd5a7){var _0xfca64d=_0xfef370;_0x2920a4?(console[_0xfca64d(0xf8)](_0x2920a4),console[_0xfca64d(0xf8)](_0xfca64d(0xeb))):console[_0xfca64d(0xf8)](_0xfca64d(0x9e));}),_0x4eab4e[_0xfef370(0x146)](_0xfef370(0x100),_0xfef370(0x93)),_0x2c91b8[_0xfef370(0x173)](_0xfef370(0xcc));}catch(_0x12bf7e){console[_0xfef370(0xf8)](_0x12bf7e),_0x2c91b8['status'](0xc8)[_0xfef370(0xee)]({'message1':_0x12bf7e['message']});}}),router['get']('/barcode/:id',auth,async(_0x1b7d5f,_0x47d5bd)=>{var _0x300986=a0_0x2b02c6;try{const {username:_0x36a283,email:_0x750cae,role:_0x3eb21f}=_0x1b7d5f[_0x300986(0x137)],_0x106f2a=_0x1b7d5f[_0x300986(0x137)],_0x86fa02=await profile[_0x300986(0xff)]({'email':_0x106f2a[_0x300986(0x13e)]}),_0x124ec1=await master_shop[_0x300986(0xb6)]();console['log'](_0x300986(0x136),_0x124ec1);const _0x2db9a2=_0x1b7d5f[_0x300986(0x96)]['id'],_0x2a5138=await sales[_0x300986(0x7d)](_0x2db9a2);console[_0x300986(0xf8)](_0x300986(0xe2),_0x2a5138);if(_0x124ec1[0x0]['language']==_0x300986(0xcd))var _0x472338=users[_0x300986(0xb2)];else{if(_0x124ec1[0x0][_0x300986(0x124)]=='Hindi')var _0x472338=users[_0x300986(0x14f)];else{if(_0x124ec1[0x0][_0x300986(0x124)]==_0x300986(0x120))var _0x472338=users[_0x300986(0x120)];else{if(_0x124ec1[0x0][_0x300986(0x124)]==_0x300986(0x10b))var _0x472338=users['Spanish'];else{if(_0x124ec1[0x0][_0x300986(0x124)]==_0x300986(0x15b))var _0x472338=users['French'];else{if(_0x124ec1[0x0]['language']==_0x300986(0x13f))var _0x472338=users[_0x300986(0xc1)];else{if(_0x124ec1[0x0][_0x300986(0x124)]=='Chinese')var _0x472338=users['Chinese'];else{if(_0x124ec1[0x0][_0x300986(0x124)]==_0x300986(0xf6))var _0x472338=users[_0x300986(0x15d)];}}}}}}}_0x47d5bd[_0x300986(0x17b)](_0x300986(0x149),{'success':_0x1b7d5f[_0x300986(0x146)]('success'),'errors':_0x1b7d5f[_0x300986(0x146)]('errors'),'role':_0x106f2a,'profile':_0x86fa02,'alldata':_0x2a5138,'master_shop':_0x124ec1,'language':_0x472338});}catch(_0x37ea02){console[_0x300986(0xf8)](_0x37ea02);}}),router['post'](a0_0x2b02c6(0xba),async(_0xb5f023,_0x2f7834)=>{var _0x159f61=a0_0x2b02c6;const {product_code:_0x311e72,warehouse_name:_0x11f2c8,rooms_data:_0x374aba,Roomslist:_0x179a34}=_0xb5f023[_0x159f61(0xe0)],_0x23ff35=_0x179a34['split'](','),_0x3352cb=[];async function _0x264cba(_0xba2546){var _0x118f90=_0x159f61;const _0x4e80a8=await warehouse[_0x118f90(0x140)]([{'$match':{'name':_0x11f2c8,'room':_0xba2546}},{'$unwind':_0x118f90(0x79)},{'$match':{'product_details.primary_code':_0x311e72}},{'$group':{'_id':_0x118f90(0x10d),'name':{'$first':_0x118f90(0x11d)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x118f90(0xcb)},'secondary_code':{'$first':_0x118f90(0x9b)},'product_code':{'$first':_0x118f90(0x16e)},'level':{'$first':_0x118f90(0xe3)},'isle':{'$first':_0x118f90(0x10c)},'type':{'$first':_0x118f90(0x11f)},'pallet':{'$first':_0x118f90(0x15a)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x118f90(0x8e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x118f90(0x95)},'expiry_date':{'$first':_0x118f90(0xe1)},'production_date':{'$first':_0x118f90(0x116)},'maxPerUnit':{'$first':_0x118f90(0x8b)},'batch_code':{'$first':_0x118f90(0xd6)},'product_cat':{'$first':_0x118f90(0x119)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x118f90(0x166)},'invoice':{'$first':_0x118f90(0x90)},'actual_qty':{'$first':_0x118f90(0x123)},'actual_uom':{'$first':_0x118f90(0x10a)}}}]),_0x5c61ce=await warehouse['aggregate']([{'$match':{'name':_0x11f2c8,'room':_0xba2546}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x311e72}},{'$group':{'_id':_0x118f90(0x10d),'name':{'$first':_0x118f90(0x11d)},'product_stock':{'$first':_0x118f90(0xa6)},'primary_code':{'$first':_0x118f90(0xcb)},'secondary_code':{'$first':_0x118f90(0x9b)},'product_code':{'$first':_0x118f90(0x16e)},'level':{'$first':_0x118f90(0xe3)},'isle':{'$first':_0x118f90(0x10c)},'type':{'$first':_0x118f90(0x11f)},'pallet':{'$first':_0x118f90(0x15a)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x118f90(0x8e)},'storage':{'$first':_0x118f90(0x143)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x118f90(0xe1)},'production_date':{'$first':_0x118f90(0x116)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x118f90(0xd6)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x118f90(0x90)}}}]);if(_0x4e80a8[_0x118f90(0x169)]>0x0)_0x3352cb[_0x118f90(0x12b)](_0x4e80a8);else _0x5c61ce[_0x118f90(0x169)]>0x0&&_0x3352cb[_0x118f90(0x12b)](_0x5c61ce);}const _0x2541fc=_0x23ff35[_0x159f61(0x77)](_0x130568=>_0x264cba(_0x130568));await Promise[_0x159f61(0x154)](_0x2541fc),_0x2f7834[_0x159f61(0xee)](_0x3352cb);}),module['exports']=router;