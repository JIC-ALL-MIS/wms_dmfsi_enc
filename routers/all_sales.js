var a0_0x39b0b7=a0_0xb0f9;(function(_0x22352e,_0xb6d594){var _0x227dfb=a0_0xb0f9,_0xb2e4f3=_0x22352e();while(!![]){try{var _0x299937=parseInt(_0x227dfb(0x160))/0x1+-parseInt(_0x227dfb(0x20a))/0x2*(-parseInt(_0x227dfb(0x20f))/0x3)+-parseInt(_0x227dfb(0x168))/0x4*(-parseInt(_0x227dfb(0x24d))/0x5)+parseInt(_0x227dfb(0x1f4))/0x6+-parseInt(_0x227dfb(0x1f6))/0x7*(-parseInt(_0x227dfb(0x214))/0x8)+parseInt(_0x227dfb(0x1af))/0x9*(-parseInt(_0x227dfb(0x20d))/0xa)+-parseInt(_0x227dfb(0x1ee))/0xb*(parseInt(_0x227dfb(0x1a9))/0xc);if(_0x299937===_0xb6d594)break;else _0xb2e4f3['push'](_0xb2e4f3['shift']());}catch(_0x581247){_0xb2e4f3['push'](_0xb2e4f3['shift']());}}}(a0_0x1200,0x37228));const express=require('express'),app=express(),router=express[a0_0x39b0b7(0x175)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x39b0b7(0x246)),auth=require('../middleware/auth'),nodemailer=require(a0_0x39b0b7(0x1c9)),users=require(a0_0x39b0b7(0x231));function a0_0x1200(){var _0x3dda59=['$warehouse_name','sales_quantity','carton','return_sale','<h2>\x20','$sale_product','$product_details','aggregate','$product_details.product_name','/view/add_sales','padStart','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','bay','Sales\x20Update\x20successfully','string','Error\x20Occurs','delivery_code','$product_details.primary_code','rack','<span\x20style=\x22float:\x20right;\x22>','back','$product_details.actual_qty','bin','image','delivery_date','$product_details.production_date','quantity','../public/language/languages.json','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','params','$product_details.secondary_unit','<h5>','$product_details.actual_uom','role','Receiving\x20Area','$product_details.storage','finalize','name','/view/:id','catch','add\x20post','Spanish','$sale_product.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Raw\x20Materials','English','Portuguese','../models/all_models','Hindi','unit','port','</thead>','German','Return\x20Goods','75410KcwSTW','There\x27s\x20a\x20error\x20in\x20this\x20transaction','invoice','email','purchases_data','findOne','status','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','expiry_date','</head><body>','RoomAssigned','success','quantity_notConverted','Shelves','currency_placement','<strong>\x20Regards\x20</strong>','$date','site_title','errors','product_name','Email\x20sent\x20successfully','$product_details.pallet','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_stock','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Sales\x20Mail','warehouse_name','product_code','types','product_list','177836AlbBKV','$product_details.secondary_code','customers','edit_sales','Arabic\x20(ae)','Floor','$isAllowEdit','customers_docs','108wFeZOk','$customer','concat','sales\x20all_data','/barcode_scanner','map','barcode\x20user_id','Received\x20Payment\x20For\x20Sale','$product_details.invoice','$product.product_name','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.level','Enclosed','Router','</span>','$product_details.expiry_date','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','random','OUT-','/all_sales/view','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Sale\x20Return\x20Mail','all_sales','maxperunit','requested_qty','$product_details.product_cat','customer','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','createTransport','secondary_code','exports','$invoice','$product_details.unit','product_details','$room','/view/add_sales/:id','</h5>','English\x20(US)','slice','<hr\x20class=\x22my-3\x22>','\x20Order\x20Date\x20:\x20','<tbody\x20style=\x22text-align:\x20center;\x22>','stocks','\x20Order\x20Number\x20:\x20','<div>','</body></html>','all_sales_barcode','message','abs','Ambient','push','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$customers_docs','</tr>','split','isAllowEdit','save','/preview/:id','getMonth','find','</tbody>','$finalize','24AlkuUy','primary_code','sale_product','get','Enabled','primary_unit','2179386kRGWlz','forEach','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','_id','French','$product_details._id','/view/return_sales/:id','currency','$product_details.bay','json','SCRN','True','redirect','sales\x20item\x20return\x20successfull','False','production_date','batch_code','$product_details.product_stock','filter','<tr>','$_id','date','return_qty','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','nodemailer','getFullYear','$product_details.floorlevel','warehouse','$product_details.product_code','user_id','Sales\x20Add\x20successfully','staff','secondary_unit','floor','all','Arabic','/upload/','$product_details.bin','RMSEmail','sale_qty','prod_code','customer_data','$sale_product.type','foreach\x20newproduct','product','Logo.png','/view/add_sale/product','$sale_product.bin','render','$product_details.isle','sendMail','</div>','$sale_product.floorlevel','toString','actual_qty','$product_details.rack','/invoice/:id','Portuguese\x20(BR)','logo','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Chinese','3672658iKTSNW','log','$product_details.maxPerUnit','body','length','master','2211120VpKUYd','received_amount','70CjAxYF','stock','room_name','$note','$name','$product_details.batch_code','$product_details.type','final','post','barcode\x20Product\x20master','</table>','actual_uom','Level','max_per_unit','prod_cat','payment\x20successfull','Return\x20Rooms','type','then','\x20</h2>','694VJASmJ','$return_data','language','10tjwKBb','floorlevel','678NkNZKE','flash','</td>','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','83000nJqwJw','user'];a0_0x1200=function(){return _0x3dda59;};return a0_0x1200();}router['get']('/view',auth,async(_0x2dcf66,_0x2a8e98)=>{var _0x3eab0a=a0_0x39b0b7;try{const {username:_0x442a71,email:_0x2cf31b,role:_0x3b7365}=_0x2dcf66[_0x3eab0a(0x215)],_0xc6859a=_0x2dcf66['user'],_0xd94b19=await profile[_0x3eab0a(0x252)]({'email':_0xc6859a[_0x3eab0a(0x250)]}),_0xeed43c=await master_shop[_0x3eab0a(0x1a6)]();let _0x52777e;if(_0xc6859a[_0x3eab0a(0x238)]=='staff'){const _0x217261=await staff['findOne']({'email':_0xc6859a[_0x3eab0a(0x250)]});_0x52777e=await sales[_0x3eab0a(0x21d)]([{'$lookup':{'from':_0x3eab0a(0x162),'localField':'customer','foreignField':_0x3eab0a(0x23c),'as':'customers_docs'}},{'$unwind':_0x3eab0a(0x19f)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3eab0a(0x1c4),'invoice':{'$first':_0x3eab0a(0x18a)},'customers':{'$first':_0x3eab0a(0x169)},'date':{'$first':_0x3eab0a(0x152)},'warehouse_name':{'$first':_0x3eab0a(0x216)},'sale_product':{'$push':_0x3eab0a(0x21b)},'note':{'$first':_0x3eab0a(0x1f9)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x3eab0a(0x19f)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3eab0a(0x241)},'isle':{'$addToSet':_0x3eab0a(0x1e0)},'type':{'$addToSet':_0x3eab0a(0x1db)},'pallet':{'$addToSet':_0x3eab0a(0x1e5)},'finalize':{'$first':_0x3eab0a(0x1a8)},'isAllowEdit':{'$first':_0x3eab0a(0x166)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x52777e=await sales[_0x3eab0a(0x21d)]([{'$lookup':{'from':_0x3eab0a(0x162),'localField':'customer','foreignField':_0x3eab0a(0x23c),'as':_0x3eab0a(0x167)}},{'$unwind':_0x3eab0a(0x19f)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x3eab0a(0x169)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3eab0a(0x216)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x3eab0a(0x1f9)},'return_data':{'$first':_0x3eab0a(0x20b)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x3eab0a(0x241)},'isle':{'$addToSet':_0x3eab0a(0x1e0)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x3eab0a(0x1e5)},'finalize':{'$first':_0x3eab0a(0x1a8)},'isAllowEdit':{'$first':_0x3eab0a(0x166)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3eab0a(0x1ef)](_0x3eab0a(0x16b),_0x52777e);if(_0xeed43c[0x0][_0x3eab0a(0x20c)]=='English\x20(US)'){var _0x3e372b=users[_0x3eab0a(0x244)];console[_0x3eab0a(0x1ef)](_0x3e372b);}else{if(_0xeed43c[0x0]['language']==_0x3eab0a(0x247))var _0x3e372b=users[_0x3eab0a(0x247)];else{if(_0xeed43c[0x0][_0x3eab0a(0x20c)]==_0x3eab0a(0x24b))var _0x3e372b=users['German'];else{if(_0xeed43c[0x0][_0x3eab0a(0x20c)]=='Spanish')var _0x3e372b=users['Spanish'];else{if(_0xeed43c[0x0][_0x3eab0a(0x20c)]==_0x3eab0a(0x1b4))var _0x3e372b=users['French'];else{if(_0xeed43c[0x0][_0x3eab0a(0x20c)]==_0x3eab0a(0x1ea))var _0x3e372b=users['Portuguese'];else{if(_0xeed43c[0x0][_0x3eab0a(0x20c)]==_0x3eab0a(0x1ed))var _0x3e372b=users[_0x3eab0a(0x1ed)];else{if(_0xeed43c[0x0][_0x3eab0a(0x20c)]==_0x3eab0a(0x164))var _0x3e372b=users[_0x3eab0a(0x1d4)];}}}}}}}_0x2a8e98[_0x3eab0a(0x1e1)](_0x3eab0a(0x180),{'success':_0x2dcf66[_0x3eab0a(0x210)](_0x3eab0a(0x259)),'errors':_0x2dcf66[_0x3eab0a(0x210)](_0x3eab0a(0x154)),'sales':_0x52777e,'profile':_0xd94b19,'role':_0xc6859a,'master_shop':_0xeed43c,'language':_0x3e372b});}catch(_0x304645){console[_0x3eab0a(0x1ef)](_0x304645);}});function a0_0xb0f9(_0x598162,_0x398f9b){var _0x120066=a0_0x1200();return a0_0xb0f9=function(_0xb0f98c,_0x2f7698){_0xb0f98c=_0xb0f98c-0x152;var _0x341257=_0x120066[_0xb0f98c];return _0x341257;},a0_0xb0f9(_0x598162,_0x398f9b);}async function getRandom8DigitNumber(){var _0x386b48=a0_0x39b0b7;const _0x25b562=0x989680,_0xcde446=0x5f5e0ff,_0x3bf61d=Math[_0x386b48(0x1d2)](Math[_0x386b48(0x17b)]()*(_0xcde446-_0x25b562+0x1))+_0x25b562;var _0x1789d6;const _0x3ad14d=await sales[_0x386b48(0x252)]({'invoice':_0x386b48(0x17c)+_0x3bf61d});return _0x3ad14d&&_0x3ad14d['length']>0x0?_0x1789d6=_0x386b48(0x17c)+_0x3bf61d:_0x1789d6=_0x386b48(0x17c)+_0x3bf61d,_0x1789d6;}router[a0_0x39b0b7(0x1ac)]('/view/add_sales',auth,async(_0x16e424,_0x5e214a)=>{var _0x201a25=a0_0x39b0b7;try{const {username:_0x55ab82,email:_0x1e8488,role:_0x37c0a5}=_0x16e424['user'],_0x2820d3=_0x16e424[_0x201a25(0x215)],_0x1c29be=await profile[_0x201a25(0x252)]({'email':_0x2820d3['email']}),_0x5339d1=await master_shop[_0x201a25(0x1a6)](),_0x194be7=await customer[_0x201a25(0x1a6)]({});let _0x3cfb43;if(_0x2820d3[_0x201a25(0x238)]=='staff'){const _0x108f0c=await staff[_0x201a25(0x252)]({'email':_0x2820d3['email']});_0x3cfb43=await warehouse[_0x201a25(0x21d)]([{'$match':{'status':_0x201a25(0x1ad),'name':_0x108f0c[_0x201a25(0x1cc)],'warehouse_category':_0x201a25(0x243),'name':{'$ne':_0x201a25(0x24c)}}},{'$group':{'_id':_0x201a25(0x1fa),'name':{'$first':_0x201a25(0x1fa)}}},{'$sort':{'name':0x1}}]);}else _0x3cfb43=await warehouse[_0x201a25(0x21d)]([{'$match':{'status':_0x201a25(0x1ad),'warehouse_category':_0x201a25(0x243),'name':{'$ne':_0x201a25(0x24c)}}},{'$group':{'_id':_0x201a25(0x1fa),'name':{'$first':_0x201a25(0x1fa)}}},{'$sort':{'name':0x1}}]);const _0x584e60=await product[_0x201a25(0x1a6)]({});var _0xcb4e0b=[_0x201a25(0x19c),_0x201a25(0x174)];const _0x28a427=await sales[_0x201a25(0x1a6)]({}),_0x3e7129=_0x28a427[_0x201a25(0x1f2)]+0x1,_0x36d10b=_0x201a25(0x17c)+_0x3e7129[_0x201a25(0x1e6)]()[_0x201a25(0x220)](0x5,'0');if(_0x5339d1[0x0][_0x201a25(0x20c)]==_0x201a25(0x190)){var _0x2c9bbe=users['English'];console[_0x201a25(0x1ef)](_0x2c9bbe);}else{if(_0x5339d1[0x0][_0x201a25(0x20c)]==_0x201a25(0x247))var _0x2c9bbe=users['Hindi'];else{if(_0x5339d1[0x0][_0x201a25(0x20c)]=='German')var _0x2c9bbe=users[_0x201a25(0x24b)];else{if(_0x5339d1[0x0][_0x201a25(0x20c)]==_0x201a25(0x240))var _0x2c9bbe=users[_0x201a25(0x240)];else{if(_0x5339d1[0x0][_0x201a25(0x20c)]==_0x201a25(0x1b4))var _0x2c9bbe=users[_0x201a25(0x1b4)];else{if(_0x5339d1[0x0][_0x201a25(0x20c)]=='Portuguese\x20(BR)')var _0x2c9bbe=users['Portuguese'];else{if(_0x5339d1[0x0][_0x201a25(0x20c)]==_0x201a25(0x1ed))var _0x2c9bbe=users[_0x201a25(0x1ed)];else{if(_0x5339d1[0x0]['language']==_0x201a25(0x164))var _0x2c9bbe=users[_0x201a25(0x1d4)];}}}}}}}const _0x3f42cb=getRandom8DigitNumber();_0x3f42cb[_0x201a25(0x208)](_0x5194b5=>{var _0x370f2c=_0x201a25;_0x5e214a[_0x370f2c(0x1e1)]('add_sales',{'success':_0x16e424[_0x370f2c(0x210)](_0x370f2c(0x259)),'errors':_0x16e424['flash'](_0x370f2c(0x154)),'role':_0x2820d3,'profile':_0x1c29be,'customer':_0x194be7,'warehouse':_0x3cfb43,'product':_0x584e60,'invoice':_0x5194b5,'master_shop':_0x5339d1,'language':_0x2c9bbe,'rooms_data':_0xcb4e0b});})['catch'](_0x28209f=>{var _0x44a2f3=_0x201a25;_0x16e424[_0x44a2f3(0x210)](_0x44a2f3(0x154),_0x44a2f3(0x24e)),_0x5e214a[_0x44a2f3(0x1bc)](_0x44a2f3(0x17d));});}catch(_0x1321e1){console[_0x201a25(0x1ef)](_0x1321e1);}}),router['get'](a0_0x39b0b7(0x18e),auth,async(_0x4e182e,_0x2fbed9)=>{var _0x5bedda=a0_0x39b0b7;try{const _0x55d60f=_0x4e182e['params']['id'];console[_0x5bedda(0x1ef)](_0x55d60f);const _0x1815e4=await product['find'](),_0x1c1942=await purchases[_0x5bedda(0x21d)]([{'$match':{'warehouse_name':_0x55d60f}},{'$unwind':'$product'},{'$group':{'_id':_0x5bedda(0x171)}}]);console[_0x5bedda(0x1ef)](_0x5bedda(0x251),_0x1c1942),_0x2fbed9['status'](0xc8)['json']({'purchases_data':_0x1c1942,'product_data':_0x1815e4});}catch(_0x1edb2b){console[_0x5bedda(0x1ef)](_0x1edb2b);}}),router[a0_0x39b0b7(0x1fe)](a0_0x39b0b7(0x1df),auth,async(_0x53e648,_0x567b6e)=>{var _0x51fc40=a0_0x39b0b7;try{const {warehouse_data:_0xa77b25,product_data:_0x1d6767}=_0x53e648[_0x51fc40(0x1f1)];console['log'](_0x53e648[_0x51fc40(0x1f1)]['product_data']);;const _0x4ea1ba=await master_shop[_0x51fc40(0x1a6)]();console[_0x51fc40(0x1ef)](_0x51fc40(0x1f3),_0x4ea1ba);const _0x34250d=await product[_0x51fc40(0x252)]({'name':_0x1d6767});console[_0x51fc40(0x1ef)](_0x51fc40(0x1dd),_0x34250d);const _0x50f272=await warehouse['aggregate']([{'$match':{'name':_0xa77b25}},{'$unwind':_0x51fc40(0x21c)},{'$match':{'product_details.product_name':_0x1d6767}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x51fc40(0x1c1)}}}]);console[_0x51fc40(0x1ef)]('stock_data',_0x50f272),_0x567b6e['status'](0xc8)[_0x51fc40(0x1b9)]({'master':_0x4ea1ba,'new_product':_0x34250d,'stock_data':_0x50f272});}catch(_0x7eaa86){console[_0x51fc40(0x1ef)](_0x7eaa86);}}),router[a0_0x39b0b7(0x1fe)](a0_0x39b0b7(0x21f),auth,async(_0x26051e,_0x3d249b)=>{var _0x44dad6=a0_0x39b0b7;try{const {invoice:_0x39a615,date:_0xd88416,warehouse_name:_0x1fc19c,product_name:_0x1233b2,stock:_0x439d5e,quantity:_0x5784bb,note:_0x4f7015,room:_0x497d07,primary_code:_0x5abd90,secondary_code:_0x262c10,prod_code:_0x5a659a,level:_0x173f6f,isle:_0x33eff3,pallet:_0x3eacd3,batch_code:_0x2a9e7c,SCRN:_0x30b2fa,expiry_date:_0x23e3be}=_0x26051e['body'];if(typeof _0x1233b2==_0x44dad6(0x224))var _0x16b486=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x155)]],_0x293d9d=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1f7)]],_0xa7c763=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x218)]],_0x4689b3=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1aa)]],_0x102d41=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x188)]],_0x5a406b=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1d9)]],_0x4f7329=[_0x26051e[_0x44dad6(0x1f1)]['level']],_0x2f3b74=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1ae)]],_0x46cf9a=[_0x26051e['body'][_0x44dad6(0x1d1)]],_0x45c5a5=[_0x26051e['body'][_0x44dad6(0x1c0)]],_0x2e0b15=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x256)]],_0x482802=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x203)]],_0x11eb4d=[_0x26051e['body']['production_date']],_0x3dd17f=[_0x26051e['body'][_0x44dad6(0x182)]],_0x58d937=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x22e)]],_0x293fe4=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x226)]],_0x16ddf0=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x204)]],_0x3e45fd=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x230)]],_0x211f29=[_0x26051e[_0x44dad6(0x1f1)]['RoomAssigned']],_0x2e8708=[_0x26051e[_0x44dad6(0x1f1)]['prod_invoice']],_0x4474cc=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1e7)]],_0x49f85c=[_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x201)]];else var _0x16b486=[..._0x26051e[_0x44dad6(0x1f1)]['product_name']],_0x293d9d=[..._0x26051e['body'][_0x44dad6(0x1f7)]],_0xa7c763=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x218)]],_0x4689b3=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1aa)]],_0x102d41=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x188)]],_0x5a406b=[..._0x26051e[_0x44dad6(0x1f1)]['prod_code']],_0x4f7329=[..._0x26051e[_0x44dad6(0x1f1)]['level']],_0x2f3b74=[..._0x26051e[_0x44dad6(0x1f1)]['primary_unit']],_0x46cf9a=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1d1)]],_0x45c5a5=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x1c0)]],_0x2e0b15=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x256)]],_0x482802=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x203)]],_0x11eb4d=[..._0x26051e[_0x44dad6(0x1f1)]['production_date']],_0x3dd17f=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x182)]],_0x58d937=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x22e)]],_0x293fe4=[..._0x26051e['body']['delivery_code']],_0x16ddf0=[..._0x26051e['body'][_0x44dad6(0x204)]],_0x3e45fd=[..._0x26051e['body'][_0x44dad6(0x230)]],_0x211f29=[..._0x26051e['body'][_0x44dad6(0x258)]],_0x2e8708=[..._0x26051e[_0x44dad6(0x1f1)]['prod_invoice']],_0x4474cc=[..._0x26051e['body'][_0x44dad6(0x1e7)]],_0x49f85c=[..._0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x201)]];const _0x3403ef=_0x16b486[_0x44dad6(0x16d)](_0x405786=>{return _0x405786={'product_name':_0x405786};});_0x293d9d['forEach']((_0x46ed0f,_0x49eda0)=>{var _0x1d759b=_0x44dad6;_0x3403ef[_0x49eda0][_0x1d759b(0x1f7)]=Math[_0x1d759b(0x19b)](_0x46ed0f);}),_0x4474cc[_0x44dad6(0x1b0)]((_0x367339,_0x16b011)=>{_0x3403ef[_0x16b011]['actual_qty']=Math['abs'](_0x367339);}),_0x49f85c[_0x44dad6(0x1b0)]((_0x5eab79,_0x161615)=>{var _0x3a2811=_0x44dad6;_0x3403ef[_0x161615][_0x3a2811(0x201)]=_0x5eab79;}),_0xa7c763[_0x44dad6(0x1b0)]((_0xeeebba,_0x3d77d8)=>{_0x3403ef[_0x3d77d8]['quantity']=_0xeeebba;}),_0x4689b3[_0x44dad6(0x1b0)]((_0x21ce1e,_0x4c27b4)=>{var _0x1433f7=_0x44dad6;_0x3403ef[_0x4c27b4][_0x1433f7(0x1aa)]=_0x21ce1e;}),_0x102d41[_0x44dad6(0x1b0)]((_0x2fd62c,_0x3d76e3)=>{var _0x383024=_0x44dad6;_0x3403ef[_0x3d76e3][_0x383024(0x188)]=_0x2fd62c;}),_0x5a406b[_0x44dad6(0x1b0)]((_0x48afca,_0x1d06dd)=>{_0x3403ef[_0x1d06dd]['product_code']=_0x48afca;}),_0x4f7329[_0x44dad6(0x1b0)]((_0x2fbd5c,_0x54eacd)=>{var _0x4849ea=_0x44dad6;_0x211f29[_0x4849ea(0x1b0)]((_0x25b3d9,_0x3978f4)=>{var _0x346d4c=_0x4849ea;if(_0x25b3d9==_0x346d4c(0x239)&&_0x54eacd==_0x3978f4){var _0x227d15=_0x2fbd5c[_0x346d4c(0x191)](0x3);_0x3403ef[_0x54eacd]['storage']=_0x2fbd5c[0x0],_0x3403ef[_0x54eacd][_0x346d4c(0x228)]=_0x2fbd5c[0x1],_0x3403ef[_0x54eacd][_0x346d4c(0x222)]=0x0,_0x3403ef[_0x54eacd][_0x346d4c(0x22c)]=0x0,_0x3403ef[_0x54eacd][_0x346d4c(0x207)]=_0x346d4c(0x165),_0x3403ef[_0x54eacd]['floorlevel']=_0x227d15;}else{if(_0x25b3d9=='Shelves'&&_0x54eacd==_0x3978f4){var _0x227d15=_0x2fbd5c[_0x346d4c(0x191)](0x3);_0x3403ef[_0x54eacd]['storage']=_0x2fbd5c[0x0],_0x3403ef[_0x54eacd]['rack']=_0x2fbd5c[0x1],_0x3403ef[_0x54eacd][_0x346d4c(0x222)]=0x0,_0x3403ef[_0x54eacd][_0x346d4c(0x22c)]=0x0,_0x3403ef[_0x54eacd][_0x346d4c(0x207)]=_0x346d4c(0x165),_0x3403ef[_0x54eacd]['floorlevel']=_0x2fbd5c[0x5];}else{if(_0x54eacd==_0x3978f4){var _0x556d8b;if(_0x2fbd5c[0x4]=='L')_0x556d8b='Level';else _0x2fbd5c[0x4]=='F'&&(_0x556d8b=_0x346d4c(0x165));_0x3403ef[_0x54eacd][_0x346d4c(0x232)]=_0x2fbd5c[0x0],_0x3403ef[_0x54eacd]['rack']=_0x2fbd5c[0x1],_0x3403ef[_0x54eacd][_0x346d4c(0x222)]=_0x2fbd5c[0x2],_0x3403ef[_0x54eacd][_0x346d4c(0x22c)]=_0x2fbd5c[0x3],_0x3403ef[_0x54eacd][_0x346d4c(0x207)]=_0x556d8b,_0x3403ef[_0x54eacd]['floorlevel']=_0x2fbd5c[0x5];}}}});}),_0x2f3b74['forEach']((_0x5456bf,_0x20ae1e)=>{var _0x12dff7=_0x44dad6;_0x3403ef[_0x20ae1e][_0x12dff7(0x248)]=_0x5456bf;}),_0x46cf9a[_0x44dad6(0x1b0)]((_0x377530,_0x1835cd)=>{var _0x713984=_0x44dad6;_0x3403ef[_0x1835cd][_0x713984(0x1d1)]=_0x377530;}),_0x45c5a5[_0x44dad6(0x1b0)]((_0x5563be,_0x2381a5)=>{var _0x4504a1=_0x44dad6;_0x3403ef[_0x2381a5][_0x4504a1(0x1c0)]=_0x5563be;}),_0x2e0b15[_0x44dad6(0x1b0)]((_0x1c0e85,_0x158f1a)=>{var _0x39ad9f=_0x44dad6;_0x3403ef[_0x158f1a][_0x39ad9f(0x256)]=_0x1c0e85;}),_0x482802[_0x44dad6(0x1b0)]((_0xb2a2e6,_0x436a17)=>{var _0x4a487d=_0x44dad6;_0x3403ef[_0x436a17][_0x4a487d(0x181)]=_0xb2a2e6;}),_0x11eb4d[_0x44dad6(0x1b0)]((_0x30d03b,_0x293401)=>{_0x3403ef[_0x293401]['production_date']=_0x30d03b;}),_0x3dd17f[_0x44dad6(0x1b0)]((_0x32796e,_0x417dca)=>{_0x3403ef[_0x417dca]['requested_qty']=_0x32796e;}),_0x58d937[_0x44dad6(0x1b0)]((_0x5d9094,_0x266dd8)=>{_0x3403ef[_0x266dd8]['delivery_date']=_0x5d9094;}),_0x293fe4[_0x44dad6(0x1b0)]((_0x30f456,_0x14e430)=>{_0x3403ef[_0x14e430]['delivery_code']=_0x30f456;}),_0x16ddf0[_0x44dad6(0x1b0)]((_0x2ec76d,_0x993c13)=>{var _0x1ba52a=_0x44dad6;_0x3403ef[_0x993c13][_0x1ba52a(0x204)]=_0x2ec76d;}),_0x3e45fd['forEach']((_0x4456ad,_0x5afb9d)=>{_0x3403ef[_0x5afb9d]['quantity_notConverted']=_0x4456ad;}),_0x211f29[_0x44dad6(0x1b0)]((_0x5b2b17,_0x3dfd91)=>{var _0x4fdab8=_0x44dad6;_0x3403ef[_0x3dfd91][_0x4fdab8(0x1f8)]=_0x5b2b17;}),_0x2e8708[_0x44dad6(0x1b0)]((_0x355e8a,_0x35467d)=>{var _0x59ce0b=_0x44dad6;_0x3403ef[_0x35467d][_0x59ce0b(0x24f)]=_0x355e8a;});var _0x20383c=0x0;_0x3403ef[_0x44dad6(0x1b0)](_0x2b580e=>{var _0xcb7350=_0x44dad6;(_0x2b580e['stock']<_0x2b580e[_0xcb7350(0x25a)]||_0x2b580e[_0xcb7350(0x25a)]==0x0)&&(console[_0xcb7350(0x1ef)]('foreach\x20newproduct',_0x2b580e),_0x20383c++);});const _0x361ccf=_0x3403ef[_0x44dad6(0x1c2)](_0x1157fe=>_0x1157fe[_0x44dad6(0x230)]!=='0'&&_0x1157fe[_0x44dad6(0x230)]!==''),_0x4242de=new sales({'invoice':_0x39a615,'customer':_0x26051e[_0x44dad6(0x1f1)][_0x44dad6(0x184)],'date':_0xd88416,'warehouse_name':_0x1fc19c,'sale_product':_0x361ccf,'note':_0x4f7015,'room':_0x497d07,'primary_code':_0x5abd90,'secondary_code':_0x262c10,'prod_code':_0x5a659a,'SCRN':_0x30b2fa}),_0xedef69=await _0x4242de['save']();_0x26051e[_0x44dad6(0x210)](_0x44dad6(0x259),_0x44dad6(0x1cf)),_0x3d249b[_0x44dad6(0x1bc)]('/all_sales/preview/'+_0xedef69[_0x44dad6(0x1b3)]);}catch(_0x21a5f4){console[_0x44dad6(0x1ef)](_0x21a5f4);}}),router[a0_0x39b0b7(0x1ac)](a0_0x39b0b7(0x1a4),auth,async(_0x40a73d,_0x4a8f43)=>{var _0x36de88=a0_0x39b0b7;try{const {username:_0x2b8384,email:_0x54c8f7,role:_0x3dc725}=_0x40a73d[_0x36de88(0x215)],_0x307610=_0x40a73d[_0x36de88(0x215)],_0x3648f9=await profile[_0x36de88(0x252)]({'email':_0x307610[_0x36de88(0x250)]}),_0x5b71b0=await master_shop['find'](),_0x45819c=_0x40a73d[_0x36de88(0x234)]['id'],_0x5e8d2c=await sales['findById'](_0x45819c),_0x3d6f68=await warehouse['aggregate']([{'$match':{'name':_0x5e8d2c[_0x36de88(0x15c)]}},{'$unwind':_0x36de88(0x21c)},{'$group':{'_id':_0x36de88(0x1b5),'name':{'$first':_0x36de88(0x21e)},'product_stock':{'$first':_0x36de88(0x1c1)},'bay':{'$first':_0x36de88(0x1b8)},'bin':{'$first':_0x36de88(0x1d6)},'type':{'$first':_0x36de88(0x1fc)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x36de88(0x161)},'product_code':{'$first':_0x36de88(0x1cd)},'storage':{'$first':_0x36de88(0x23a)},'rack':{'$first':_0x36de88(0x1e8)},'expiry_date':{'$first':_0x36de88(0x177)},'production_date':{'$first':_0x36de88(0x22f)},'invoice':{'$first':_0x36de88(0x170)}}}]),_0x2d9de7=await customer[_0x36de88(0x1a6)]({});let _0xcc1b5c;if(_0x307610['role']==_0x36de88(0x1d0)){const _0x331753=await staff[_0x36de88(0x252)]({'email':_0x307610[_0x36de88(0x250)]});_0xcc1b5c=await warehouse[_0x36de88(0x21d)]([{'$match':{'status':_0x36de88(0x1ad),'name':_0x331753['warehouse']}},{'$group':{'_id':_0x36de88(0x1fa),'name':{'$first':'$name'}}}]);}else _0xcc1b5c=await warehouse[_0x36de88(0x21d)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x36de88(0x1fa),'name':{'$first':_0x36de88(0x1fa)}}}]);const _0x23be20=await product[_0x36de88(0x1a6)]({}),_0x584c55=await suppliers[_0x36de88(0x1a6)]({});if(_0x5b71b0[0x0][_0x36de88(0x20c)]==_0x36de88(0x190)){var _0x510b19=users[_0x36de88(0x244)];console['log'](_0x510b19);}else{if(_0x5b71b0[0x0]['language']==_0x36de88(0x247))var _0x510b19=users[_0x36de88(0x247)];else{if(_0x5b71b0[0x0][_0x36de88(0x20c)]=='German')var _0x510b19=users[_0x36de88(0x24b)];else{if(_0x5b71b0[0x0][_0x36de88(0x20c)]=='Spanish')var _0x510b19=users['Spanish'];else{if(_0x5b71b0[0x0][_0x36de88(0x20c)]=='French')var _0x510b19=users[_0x36de88(0x1b4)];else{if(_0x5b71b0[0x0]['language']==_0x36de88(0x1ea))var _0x510b19=users[_0x36de88(0x245)];else{if(_0x5b71b0[0x0]['language']==_0x36de88(0x1ed))var _0x510b19=users[_0x36de88(0x1ed)];else{if(_0x5b71b0[0x0][_0x36de88(0x20c)]==_0x36de88(0x164))var _0x510b19=users[_0x36de88(0x1d4)];}}}}}}}_0x4a8f43['render']('edit_sales_view',{'success':_0x40a73d['flash'](_0x36de88(0x259)),'errors':_0x40a73d['flash']('errors'),'role':_0x307610,'profile':_0x3648f9,'customer':_0x2d9de7,'warehouse':_0xcc1b5c,'product':_0x3d6f68,'user':_0x5e8d2c,'master_shop':_0x5b71b0,'unit':_0x23be20,'language':_0x510b19,'suppliers':_0x584c55});}catch(_0x2ccc70){console[_0x36de88(0x1ef)](_0x2ccc70);}}),router['post'](a0_0x39b0b7(0x1a4),auth,async(_0x50584a,_0x38c977)=>{var _0x4f1da4=a0_0x39b0b7;try{const _0xc372d4=_0x50584a['params']['id'],{invoice:_0x2c1f74,warehouse_name:_0xb4693d,room:_0x216f3d}=_0x50584a[_0x4f1da4(0x1f1)],_0x220684=await sales[_0x4f1da4(0x252)]({'invoice':_0x2c1f74}),_0x28ef3a=_0x220684[_0x4f1da4(0x1ab)][_0x4f1da4(0x16d)](async _0x3ba09a=>{var _0x5384e2=_0x4f1da4,_0x44e607=await warehouse['findOne']({'name':_0xb4693d,'room':_0x3ba09a[_0x5384e2(0x1f8)],'warehouse_category':_0x5384e2(0x243)});const _0x384cfe=_0x44e607[_0x5384e2(0x18c)][_0x5384e2(0x16d)](_0x1ba398=>{var _0x5aa1c4=_0x5384e2;_0x1ba398[_0x5aa1c4(0x155)]==_0x3ba09a[_0x5aa1c4(0x155)]&&_0x1ba398['floorlevel']==_0x3ba09a['floorlevel']&&_0x1ba398['type']==_0x3ba09a[_0x5aa1c4(0x207)]&&_0x1ba398[_0x5aa1c4(0x22c)]==_0x3ba09a[_0x5aa1c4(0x22c)]&&_0x1ba398['bay']==_0x3ba09a[_0x5aa1c4(0x222)]&&_0x1ba398[_0x5aa1c4(0x228)]==_0x3ba09a[_0x5aa1c4(0x228)]&&_0x1ba398[_0x5aa1c4(0x232)]==_0x3ba09a[_0x5aa1c4(0x232)]&&_0x1ba398[_0x5aa1c4(0x256)]==_0x3ba09a['expiry_date']&&_0x1ba398[_0x5aa1c4(0x1c0)]==_0x3ba09a[_0x5aa1c4(0x1c0)]&&_0x1ba398[_0x5aa1c4(0x24f)]==_0x3ba09a[_0x5aa1c4(0x24f)]&&(_0x1ba398[_0x5aa1c4(0x159)]=Math[_0x5aa1c4(0x19b)](_0x1ba398[_0x5aa1c4(0x159)])-Math['abs'](_0x3ba09a[_0x5aa1c4(0x230)]));});return _0x44e607;});Promise[_0x4f1da4(0x1d3)](_0x28ef3a)['then'](async _0x2b0f79=>{var _0x15b240=_0x4f1da4;try{for(const _0x3b6024 of _0x2b0f79){await _0x3b6024[_0x15b240(0x1a3)]();}_0x220684[_0x15b240(0x23b)]=_0x15b240(0x1bb);const _0x25b424=await _0x220684[_0x15b240(0x1a3)](),_0x473b2d=await master_shop['find'](),_0x1d95d2=await email_settings[_0x15b240(0x252)](),_0x352157=await supervisor_settings[_0x15b240(0x1a6)]();var _0x3d5539=_0x220684[_0x15b240(0x1ab)],_0x3cc12c='',_0x24fc3b;for(_0x24fc3b in _0x3d5539){_0x3cc12c+=_0x15b240(0x1c3)+_0x15b240(0x158)+_0x3d5539[_0x24fc3b][_0x15b240(0x155)]+'</td>'+_0x15b240(0x158)+_0x3d5539[_0x24fc3b][_0x15b240(0x15d)]+_0x15b240(0x211)+_0x15b240(0x158)+_0x3d5539[_0x24fc3b][_0x15b240(0x230)]+_0x15b240(0x211)+_0x15b240(0x158)+_0x3d5539[_0x24fc3b][_0x15b240(0x248)]+_0x15b240(0x211)+_0x15b240(0x158)+_0x3d5539[_0x24fc3b]['secondary_unit']+'</td>'+_0x15b240(0x158)+_0x220684[_0x15b240(0x15c)]+'</td>'+_0x15b240(0x158)+_0x3d5539[_0x24fc3b][_0x15b240(0x1f8)]+_0x15b240(0x211)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d5539[_0x24fc3b][_0x15b240(0x232)]+_0x3d5539[_0x24fc3b][_0x15b240(0x228)]+_0x3d5539[_0x24fc3b]['bay']+_0x3d5539[_0x24fc3b][_0x15b240(0x22c)]+_0x3d5539[_0x24fc3b][_0x15b240(0x207)][0x0]+_0x3d5539[_0x24fc3b][_0x15b240(0x20e)]+_0x15b240(0x211),'</tr>';}let _0x5cef72=nodemailer['createTransport']({'host':_0x1d95d2['host'],'port':Number(_0x1d95d2[_0x15b240(0x249)]),'secure':![],'auth':{'user':_0x1d95d2[_0x15b240(0x250)],'pass':_0x1d95d2[_0x15b240(0x1c7)]}}),_0x41c6fb={'from':_0x1d95d2[_0x15b240(0x250)],'to':_0x352157[0x0][_0x15b240(0x1d7)],'subject':_0x15b240(0x15b),'attachments':[{'filename':'Logo.png','path':__dirname+_0x15b240(0x185)+'/upload/'+_0x473b2d[0x0][_0x15b240(0x22d)],'cid':_0x15b240(0x1eb)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x15b240(0x257)+_0x15b240(0x197)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x15b240(0x17e)+_0x15b240(0x1e4)+_0x15b240(0x197)+_0x15b240(0x21a)+_0x473b2d[0x0]['site_title']+_0x15b240(0x209)+_0x15b240(0x1e4)+_0x15b240(0x1e4)+_0x15b240(0x192)+_0x15b240(0x197)+_0x15b240(0x17a)+_0x15b240(0x196)+_0x220684[_0x15b240(0x24f)]+'\x20'+_0x15b240(0x229)+'\x20Order\x20Date\x20:\x20'+_0x220684[_0x15b240(0x1c5)]+'\x20'+_0x15b240(0x176)+_0x15b240(0x18f)+'</div>'+_0x15b240(0x15a)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x15b240(0x213)+_0x15b240(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x15b240(0x1c8)+_0x15b240(0x242)+_0x15b240(0x233)+_0x15b240(0x186)+_0x15b240(0x1b2)+'</tr>'+_0x15b240(0x24a)+_0x15b240(0x194)+'\x20'+_0x3cc12c+'\x20'+_0x15b240(0x1a7)+_0x15b240(0x200)+_0x15b240(0x197)+_0x15b240(0x25d)+_0x15b240(0x236)+_0x473b2d[0x0][_0x15b240(0x153)]+'</h5>'+_0x15b240(0x1e4)+_0x15b240(0x1e4)+_0x15b240(0x198)};_0x5cef72[_0x15b240(0x1e3)](_0x41c6fb,function(_0x11c6f0,_0x157353){var _0x3d2598=_0x15b240;_0x11c6f0?(console[_0x3d2598(0x1ef)](_0x11c6f0),console[_0x3d2598(0x1ef)]('Error\x20Occurs')):console[_0x3d2598(0x1ef)]('Email\x20sent\x20successfully');}),_0x50584a['flash'](_0x15b240(0x259),_0x15b240(0x223)),_0x38c977[_0x15b240(0x1bc)]('/all_sales/preview/'+_0xc372d4);}catch(_0x5c79e6){console['error'](_0x5c79e6),_0x38c977['status'](0x1f4)[_0x15b240(0x1b9)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4f1da4(0x23e)](_0x31c59c=>{var _0x40b8ca=_0x4f1da4;console[_0x40b8ca(0x212)](_0x31c59c),_0x38c977['status'](0x1f4)[_0x40b8ca(0x1b9)]({'error':'An\x20error\x20occurred.'});});}catch(_0x13130d){console[_0x4f1da4(0x1ef)](_0x13130d);}}),router[a0_0x39b0b7(0x1ac)](a0_0x39b0b7(0x23d),auth,async(_0x570ee2,_0x172356)=>{var _0xf25be4=a0_0x39b0b7;try{const {username:_0x47dbfe,email:_0x2278b9,role:_0x130849}=_0x570ee2['user'],_0x28d7bf=_0x570ee2[_0xf25be4(0x215)],_0x41b8c5=await profile[_0xf25be4(0x252)]({'email':_0x28d7bf['email']}),_0x4c6c55=await master_shop[_0xf25be4(0x1a6)](),_0xa93fd=_0x570ee2[_0xf25be4(0x234)]['id'],_0x42c5a1=await sales[_0xf25be4(0x254)](_0xa93fd);var _0x11e4b3=['Ambient',_0xf25be4(0x174)];const _0x25d785=await warehouse[_0xf25be4(0x21d)]([{'$match':{'name':_0x42c5a1[_0xf25be4(0x15c)],'warehouse_category':_0xf25be4(0x243)}},{'$unwind':_0xf25be4(0x21c)},{'$group':{'_id':_0xf25be4(0x1b5),'name':{'$first':_0xf25be4(0x21e)},'product_stock':{'$first':_0xf25be4(0x1c1)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xf25be4(0x1d6)},'type':{'$first':_0xf25be4(0x1fc)},'floorlevel':{'$first':_0xf25be4(0x1cb)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xf25be4(0x161)},'product_code':{'$first':_0xf25be4(0x1cd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]),_0x133157=await customer[_0xf25be4(0x1a6)]({});let _0x3f5664;if(_0x28d7bf[_0xf25be4(0x238)]==_0xf25be4(0x1d0)){const _0x2ebcb4=await staff['findOne']({'email':_0x28d7bf[_0xf25be4(0x250)]});_0x3f5664=await warehouse[_0xf25be4(0x21d)]([{'$match':{'status':_0xf25be4(0x1ad),'name':_0x2ebcb4['warehouse'],'warehouse_category':_0xf25be4(0x243)}},{'$group':{'_id':'$name','name':{'$first':_0xf25be4(0x1fa)}}}]);}else _0x3f5664=await warehouse[_0xf25be4(0x21d)]([{'$match':{'status':_0xf25be4(0x1ad),'warehouse_category':_0xf25be4(0x243)}},{'$group':{'_id':_0xf25be4(0x1fa),'name':{'$first':_0xf25be4(0x1fa)}}}]);const _0x270a03=await product[_0xf25be4(0x1a6)]({});if(_0x4c6c55[0x0][_0xf25be4(0x20c)]==_0xf25be4(0x190)){var _0x4b788a=users['English'];console[_0xf25be4(0x1ef)](_0x4b788a);}else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]=='Hindi')var _0x4b788a=users['Hindi'];else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]=='German')var _0x4b788a=users[_0xf25be4(0x24b)];else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]=='Spanish')var _0x4b788a=users[_0xf25be4(0x240)];else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]=='French')var _0x4b788a=users[_0xf25be4(0x1b4)];else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]==_0xf25be4(0x1ea))var _0x4b788a=users[_0xf25be4(0x245)];else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]==_0xf25be4(0x1ed))var _0x4b788a=users[_0xf25be4(0x1ed)];else{if(_0x4c6c55[0x0][_0xf25be4(0x20c)]==_0xf25be4(0x164))var _0x4b788a=users['Arabic'];}}}}}}}_0x172356[_0xf25be4(0x1e1)](_0xf25be4(0x163),{'success':_0x570ee2[_0xf25be4(0x210)]('success'),'errors':_0x570ee2[_0xf25be4(0x210)](_0xf25be4(0x154)),'role':_0x28d7bf,'profile':_0x41b8c5,'customer':_0x133157,'warehouse':_0x3f5664,'product':_0x25d785,'user':_0x42c5a1,'master_shop':_0x4c6c55,'unit':_0x270a03,'language':_0x4b788a});}catch(_0x3345eb){console['log'](_0x3345eb);}}),router[a0_0x39b0b7(0x1fe)](a0_0x39b0b7(0x23d),auth,async(_0x4f9473,_0x2f1239)=>{var _0x3c7d88=a0_0x39b0b7;try{const _0x5be2db=_0x4f9473[_0x3c7d88(0x234)]['id'],_0x2d7854=await sales[_0x3c7d88(0x252)]({'_id':_0x4f9473[_0x3c7d88(0x234)]['id']}),_0x2b38b3=await warehouse[_0x3c7d88(0x252)]({'name':_0x2d7854[_0x3c7d88(0x15c)],'room':_0x4f9473['body']['room']}),{invoice:_0x54c3d2,date:_0x50bb0e,warehouse_name:_0x4ff3f8,product_name:_0xae4e49,stock:_0x50425b,quantity:_0x2d4024,note:_0x2a04f8,room:_0x24f921,customer:_0x247f72,SCRN:_0x278c46}=_0x4f9473[_0x3c7d88(0x1f1)];if(typeof _0xae4e49==_0x3c7d88(0x224))var _0x4aaafc=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x155)]],_0x15fd42=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1f7)]],_0x38c0c4=[_0x4f9473[_0x3c7d88(0x1f1)]['carton']],_0x24ab5d=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1aa)]],_0x4246b4=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x188)]],_0x34e8ba=[_0x4f9473['body']['prod_code']],_0x53fe5f=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1b1)]],_0x4171f8=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1ae)]],_0x3702b0=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1d1)]],_0x49de51=[_0x4f9473['body'][_0x3c7d88(0x1c0)]],_0x1b8378=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x256)]],_0x3a03d5=[_0x4f9473['body'][_0x3c7d88(0x203)]],_0x59d464=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1bf)]],_0x581394=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x182)]],_0x1709bb=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x22e)]],_0xa25d46=[_0x4f9473[_0x3c7d88(0x1f1)]['delivery_code']],_0x889a06=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x204)]],_0x426d25=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x230)]],_0x8ff31f=[_0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x258)]];else var _0x4aaafc=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x155)]],_0x15fd42=[..._0x4f9473[_0x3c7d88(0x1f1)]['stock']],_0x38c0c4=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x218)]],_0x24ab5d=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1aa)]],_0x4246b4=[..._0x4f9473['body'][_0x3c7d88(0x188)]],_0x34e8ba=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1d9)]],_0x53fe5f=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1b1)]],_0x4171f8=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1ae)]],_0x3702b0=[..._0x4f9473['body']['secondary_unit']],_0x49de51=[..._0x4f9473['body'][_0x3c7d88(0x1c0)]],_0x1b8378=[..._0x4f9473[_0x3c7d88(0x1f1)]['expiry_date']],_0x3a03d5=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x203)]],_0x59d464=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x1bf)]],_0x581394=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x182)]],_0x1709bb=[..._0x4f9473[_0x3c7d88(0x1f1)]['delivery_date']],_0xa25d46=[..._0x4f9473['body'][_0x3c7d88(0x226)]],_0x889a06=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x204)]],_0x426d25=[..._0x4f9473[_0x3c7d88(0x1f1)][_0x3c7d88(0x230)]],_0x8ff31f=[..._0x4f9473[_0x3c7d88(0x1f1)]['RoomAssigned']];const _0x1b07ba=_0x4aaafc['map'](_0x3da27a=>{return _0x3da27a={'product_name':_0x3da27a};});_0x15fd42['forEach']((_0x1bb0a9,_0xdb763b)=>{var _0x1bcf71=_0x3c7d88;_0x1b07ba[_0xdb763b][_0x1bcf71(0x1f7)]=Math['abs'](_0x1bb0a9);}),_0x38c0c4[_0x3c7d88(0x1b0)]((_0x14d70d,_0x369c17)=>{var _0x859d85=_0x3c7d88;_0x1b07ba[_0x369c17][_0x859d85(0x230)]=_0x14d70d;}),_0x24ab5d[_0x3c7d88(0x1b0)]((_0x47a735,_0x3685b0)=>{var _0x163455=_0x3c7d88;_0x1b07ba[_0x3685b0][_0x163455(0x1aa)]=_0x47a735;}),_0x4246b4['forEach']((_0x5a8520,_0x329d0f)=>{_0x1b07ba[_0x329d0f]['secondary_code']=_0x5a8520;}),_0x34e8ba[_0x3c7d88(0x1b0)]((_0x108120,_0x3e4ec6)=>{_0x1b07ba[_0x3e4ec6]['product_code']=_0x108120;}),_0x53fe5f[_0x3c7d88(0x1b0)]((_0x4020cb,_0x2b4c6d)=>{_0x8ff31f['forEach']((_0x50f8b5,_0x5334b4)=>{var _0x51fed1=a0_0xb0f9;if(_0x50f8b5==_0x51fed1(0x239)&&_0x2b4c6d==_0x5334b4){var _0x52bf91=_0x4020cb[_0x51fed1(0x191)](0x3);_0x1b07ba[_0x2b4c6d][_0x51fed1(0x232)]=_0x4020cb[0x0],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x228)]=_0x4020cb[0x1],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x222)]=0x0,_0x1b07ba[_0x2b4c6d][_0x51fed1(0x22c)]=0x0,_0x1b07ba[_0x2b4c6d][_0x51fed1(0x207)]=_0x51fed1(0x165),_0x1b07ba[_0x2b4c6d][_0x51fed1(0x20e)]=_0x52bf91;}else{if(_0x50f8b5==_0x51fed1(0x25b)&&_0x2b4c6d==_0x5334b4){var _0x52bf91=_0x4020cb[_0x51fed1(0x191)](0x3);_0x1b07ba[_0x2b4c6d][_0x51fed1(0x232)]=_0x4020cb[0x0],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x228)]=_0x4020cb[0x1],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x222)]=0x0,_0x1b07ba[_0x2b4c6d][_0x51fed1(0x22c)]=0x0,_0x1b07ba[_0x2b4c6d][_0x51fed1(0x207)]=_0x51fed1(0x165),_0x1b07ba[_0x2b4c6d][_0x51fed1(0x20e)]=_0x4020cb[0x5];}else{if(_0x2b4c6d==_0x5334b4){var _0x5f58af;if(_0x4020cb[0x4]=='L')_0x5f58af=_0x51fed1(0x202);else _0x4020cb[0x4]=='F'&&(_0x5f58af=_0x51fed1(0x165));_0x1b07ba[_0x2b4c6d][_0x51fed1(0x232)]=_0x4020cb[0x0],_0x1b07ba[_0x2b4c6d]['rack']=_0x4020cb[0x1],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x222)]=_0x4020cb[0x2],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x22c)]=_0x4020cb[0x3],_0x1b07ba[_0x2b4c6d][_0x51fed1(0x207)]=_0x5f58af,_0x1b07ba[_0x2b4c6d][_0x51fed1(0x20e)]=_0x4020cb[0x5];}}}});}),_0x4171f8[_0x3c7d88(0x1b0)]((_0x2d1bf3,_0xd2669c)=>{var _0xd68abc=_0x3c7d88;_0x1b07ba[_0xd2669c][_0xd68abc(0x248)]=_0x2d1bf3;}),_0x3702b0[_0x3c7d88(0x1b0)]((_0x2caaa9,_0xf8b867)=>{_0x1b07ba[_0xf8b867]['secondary_unit']=_0x2caaa9;}),_0x49de51[_0x3c7d88(0x1b0)]((_0x3b3f2c,_0xfbdc92)=>{var _0x426700=_0x3c7d88;_0x1b07ba[_0xfbdc92][_0x426700(0x1c0)]=_0x3b3f2c;}),_0x1b8378['forEach']((_0x386bac,_0x1a5de0)=>{var _0x50316a=_0x3c7d88;_0x1b07ba[_0x1a5de0][_0x50316a(0x256)]=_0x386bac;}),_0x3a03d5[_0x3c7d88(0x1b0)]((_0xb42844,_0x18449d)=>{_0x1b07ba[_0x18449d]['maxperunit']=_0xb42844;}),_0x59d464[_0x3c7d88(0x1b0)]((_0x24d03a,_0x5588de)=>{_0x1b07ba[_0x5588de]['production_date']=_0x24d03a;}),_0x581394['forEach']((_0x57b9e9,_0x52c82a)=>{var _0x40a64a=_0x3c7d88;_0x1b07ba[_0x52c82a][_0x40a64a(0x182)]=Math[_0x40a64a(0x19b)](_0x57b9e9);}),_0x1709bb[_0x3c7d88(0x1b0)]((_0x51ab02,_0x352e2f)=>{var _0x5cc71f=_0x3c7d88;_0x1b07ba[_0x352e2f][_0x5cc71f(0x22e)]=_0x51ab02;}),_0xa25d46[_0x3c7d88(0x1b0)]((_0x5ada15,_0x922c00)=>{var _0x45a589=_0x3c7d88;_0x1b07ba[_0x922c00][_0x45a589(0x226)]=_0x5ada15;}),_0x889a06[_0x3c7d88(0x1b0)]((_0x4f4a6a,_0x20af58)=>{_0x1b07ba[_0x20af58]['prod_cat']=_0x4f4a6a;}),_0x426d25[_0x3c7d88(0x1b0)]((_0x1cee9f,_0xc8a851)=>{var _0xf2bba8=_0x3c7d88;_0x1b07ba[_0xc8a851][_0xf2bba8(0x25a)]=_0x1cee9f;}),_0x8ff31f[_0x3c7d88(0x1b0)]((_0x27b174,_0x5620ef)=>{var _0x4b8876=_0x3c7d88;_0x1b07ba[_0x5620ef][_0x4b8876(0x1f8)]=_0x27b174;});var _0x45de7f=0x0;_0x1b07ba[_0x3c7d88(0x1b0)](_0x503ff3=>{var _0x5781f9=_0x3c7d88;console[_0x5781f9(0x1ef)](_0x5781f9(0x1dc),_0x503ff3),(parseInt(_0x503ff3[_0x5781f9(0x1f7)])<parseInt(_0x503ff3['quantity'])||parseInt(_0x503ff3[_0x5781f9(0x230)])==0x0)&&_0x45de7f++;});if(_0x45de7f!=0x0)return _0x4f9473[_0x3c7d88(0x210)](_0x3c7d88(0x154),_0x3c7d88(0x221)),_0x2f1239[_0x3c7d88(0x1bc)](_0x3c7d88(0x22a));const _0x3d76fd=_0x1b07ba['filter'](_0x4efa8f=>_0x4efa8f[_0x3c7d88(0x230)]!=='0'&&_0x4efa8f['quantity']!=='');_0x2d7854[_0x3c7d88(0x24f)]=_0x54c3d2,_0x2d7854['customer']=_0x247f72,_0x2d7854[_0x3c7d88(0x1c5)]=_0x50bb0e,_0x2d7854[_0x3c7d88(0x15c)]=_0x4ff3f8,_0x2d7854[_0x3c7d88(0x1ab)]=_0x3d76fd,_0x2d7854['note']=_0x2a04f8,_0x2d7854[_0x3c7d88(0x1ba)]=_0x278c46,_0x2d7854[_0x3c7d88(0x23b)]='False',_0x2d7854[_0x3c7d88(0x1a2)]=_0x3c7d88(0x1be);const _0x18fdd8=await _0x2d7854[_0x3c7d88(0x1a3)]();_0x4f9473['flash']('success',_0x3c7d88(0x223)),_0x2f1239[_0x3c7d88(0x1bc)](_0x3c7d88(0x17d));}catch(_0x139a7c){console[_0x3c7d88(0x1ef)](_0x139a7c);}}),router[a0_0x39b0b7(0x1fe)]('/give_payment/:id',auth,async(_0x22d013,_0x7b13b4)=>{var _0x4f7100=a0_0x39b0b7;try{const _0x26bd90=_0x22d013[_0x4f7100(0x234)]['id'],{invoice:_0x5dd79a,customer:_0x418210,receivable_amount:_0x56fc0d,received_amount:_0x4b6fef}=_0x22d013[_0x4f7100(0x1f1)],_0x3a69b1=await sales['findById'](_0x26bd90);console['log'](_0x3a69b1);var _0xb26547=_0x56fc0d-_0x4b6fef;console[_0x4f7100(0x1ef)](_0x4b6fef),_0x3a69b1['received_amount']=parseFloat(_0x4b6fef)+parseFloat(_0x3a69b1[_0x4f7100(0x1f5)]),_0x3a69b1[_0x4f7100(0x178)]=_0xb26547,console[_0x4f7100(0x1ef)](_0x3a69b1);const _0x253d72=await _0x3a69b1[_0x4f7100(0x1a3)](),_0x1c94ab=await c_payment_data['findOne']({'invoice':_0x5dd79a});_0x1c94ab['amount']=_0xb26547,await _0x1c94ab[_0x4f7100(0x1a3)]();let _0x1323d3=new Date(),_0x8e08f8=('0'+_0x1323d3['getDate']())[_0x4f7100(0x191)](-0x2),_0x5c8aad=('0'+(_0x1323d3[_0x4f7100(0x1a5)]()+0x1))[_0x4f7100(0x191)](-0x2),_0x3cf154=_0x1323d3[_0x4f7100(0x1ca)](),_0x5fe1c9=_0x3cf154+'-'+_0x5c8aad+'-'+_0x8e08f8;const _0x46959e=new customer_payment({'invoice':_0x5dd79a,'date':_0x3cf154+'-'+_0x5c8aad+'-'+_0x8e08f8,'customer':_0x418210,'reason':_0x4f7100(0x16f),'amount':_0x4b6fef}),_0x17f34d=await _0x46959e[_0x4f7100(0x1a3)]();_0x22d013[_0x4f7100(0x210)](_0x4f7100(0x259),_0x4f7100(0x205)),_0x7b13b4[_0x4f7100(0x1bc)]('/all_sales/view');}catch(_0x189eab){console[_0x4f7100(0x1ef)](_0x189eab);}}),router['get'](a0_0x39b0b7(0x1e9),auth,async(_0x5dda1f,_0x5461b4)=>{var _0x262b39=a0_0x39b0b7;try{const {username:_0x3208e5,email:_0x56f320,role:_0x2eb74}=_0x5dda1f[_0x262b39(0x215)],_0x197b3f=_0x5dda1f[_0x262b39(0x215)],_0x5ac69a=await profile[_0x262b39(0x252)]({'email':_0x197b3f[_0x262b39(0x250)]}),_0x43cea2=await master_shop[_0x262b39(0x1a6)]();console[_0x262b39(0x1ef)](_0x262b39(0x1f3),_0x43cea2);const _0x13ddea=_0x5dda1f[_0x262b39(0x234)]['id'],_0x46f61e=await sales[_0x262b39(0x254)](_0x13ddea);console[_0x262b39(0x1ef)](_0x46f61e);const _0xdde552=await customer[_0x262b39(0x252)]({'name':_0x46f61e[_0x262b39(0x184)]});console[_0x262b39(0x1ef)](_0xdde552);if(_0x43cea2[0x0][_0x262b39(0x20c)]==_0x262b39(0x190)){var _0x37c4f1=users[_0x262b39(0x244)];console[_0x262b39(0x1ef)](_0x37c4f1);}else{if(_0x43cea2[0x0][_0x262b39(0x20c)]==_0x262b39(0x247))var _0x37c4f1=users[_0x262b39(0x247)];else{if(_0x43cea2[0x0]['language']==_0x262b39(0x24b))var _0x37c4f1=users[_0x262b39(0x24b)];else{if(_0x43cea2[0x0][_0x262b39(0x20c)]=='Spanish')var _0x37c4f1=users[_0x262b39(0x240)];else{if(_0x43cea2[0x0][_0x262b39(0x20c)]==_0x262b39(0x1b4))var _0x37c4f1=users[_0x262b39(0x1b4)];else{if(_0x43cea2[0x0][_0x262b39(0x20c)]=='Portuguese\x20(BR)')var _0x37c4f1=users[_0x262b39(0x245)];else{if(_0x43cea2[0x0][_0x262b39(0x20c)]==_0x262b39(0x1ed))var _0x37c4f1=users[_0x262b39(0x1ed)];else{if(_0x43cea2[0x0]['language']==_0x262b39(0x164))var _0x37c4f1=users['Arabic'];}}}}}}}_0x5461b4[_0x262b39(0x1e1)]('sales_invoice',{'success':_0x5dda1f[_0x262b39(0x210)](_0x262b39(0x259)),'errors':_0x5dda1f[_0x262b39(0x210)](_0x262b39(0x154)),'role':_0x197b3f,'profile':_0x5ac69a,'master_shop':_0x43cea2,'customers':_0xdde552,'sales':_0x46f61e,'language':_0x37c4f1});}catch(_0x1ff7ee){console[_0x262b39(0x1ef)](_0x1ff7ee);}}),router[a0_0x39b0b7(0x1ac)](a0_0x39b0b7(0x1b6),auth,async(_0x4736c5,_0x511c9b)=>{var _0x396482=a0_0x39b0b7;try{const {username:_0x1caab3,email:_0x3b61b6,role:_0x76b48d}=_0x4736c5[_0x396482(0x215)],_0x3f26a9=_0x4736c5[_0x396482(0x215)],_0x1ee268=await profile[_0x396482(0x252)]({'email':_0x3f26a9[_0x396482(0x250)]}),_0x581f87=await master_shop[_0x396482(0x1a6)]();console[_0x396482(0x1ef)](_0x396482(0x1f3),_0x581f87);const _0x45217c=_0x4736c5[_0x396482(0x234)]['id'];console['log'](_0x45217c);const _0x2f453d=await sales[_0x396482(0x254)](_0x45217c);console[_0x396482(0x1ef)](_0x396482(0x1ce),_0x2f453d);const _0x55ab7c=await warehouse['aggregate']([{'$match':{'name':_0x396482(0x24c),'room':_0x396482(0x206)}},{'$unwind':_0x396482(0x21c)},{'$group':{'_id':_0x396482(0x1b5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x396482(0x1c1)},'level':{'$first':_0x396482(0x173)},'isle':{'$first':_0x396482(0x1e2)},'pallet':{'$first':_0x396482(0x157)},'primary_code':{'$first':_0x396482(0x227)},'secondary_code':{'$first':_0x396482(0x161)},'product_code':{'$first':_0x396482(0x1cd)}}}]);console[_0x396482(0x1ef)]('stock_data',_0x55ab7c);const _0x1c968b=await product[_0x396482(0x1a6)]({});warehouse_data=await warehouse[_0x396482(0x21d)]([{'$match':{'status':_0x396482(0x1ad),'name':_0x396482(0x24c),'warehouse_category':_0x396482(0x243)}},{'$group':{'_id':'$name','name':{'$first':_0x396482(0x1fa)}}},{'$sort':{'name':0x1}}]);var _0x43fee1=['Return\x20Rooms'];if(_0x581f87[0x0][_0x396482(0x20c)]==_0x396482(0x190)){var _0x43febf=users[_0x396482(0x244)];console[_0x396482(0x1ef)](_0x43febf);}else{if(_0x581f87[0x0][_0x396482(0x20c)]==_0x396482(0x247))var _0x43febf=users[_0x396482(0x247)];else{if(_0x581f87[0x0][_0x396482(0x20c)]==_0x396482(0x24b))var _0x43febf=users[_0x396482(0x24b)];else{if(_0x581f87[0x0][_0x396482(0x20c)]==_0x396482(0x240))var _0x43febf=users[_0x396482(0x240)];else{if(_0x581f87[0x0][_0x396482(0x20c)]=='French')var _0x43febf=users[_0x396482(0x1b4)];else{if(_0x581f87[0x0][_0x396482(0x20c)]==_0x396482(0x1ea))var _0x43febf=users['Portuguese'];else{if(_0x581f87[0x0]['language']=='Chinese')var _0x43febf=users[_0x396482(0x1ed)];else{if(_0x581f87[0x0][_0x396482(0x20c)]==_0x396482(0x164))var _0x43febf=users[_0x396482(0x1d4)];}}}}}}}_0x511c9b['render'](_0x396482(0x219),{'success':_0x4736c5[_0x396482(0x210)](_0x396482(0x259)),'errors':_0x4736c5[_0x396482(0x210)]('errors'),'role':_0x3f26a9,'profile':_0x1ee268,'user':_0x2f453d,'stock':_0x55ab7c,'master_shop':_0x581f87,'unit':_0x1c968b,'language':_0x43febf,'warehouses':warehouse_data,'rooms':_0x43fee1});}catch(_0x1c44c9){console[_0x396482(0x1ef)](_0x1c44c9),_0x511c9b['status'](0xc8)[_0x396482(0x1b9)]({'message':_0x1c44c9[_0x396482(0x19a)]});}}),router[a0_0x39b0b7(0x1fe)](a0_0x39b0b7(0x1b6),auth,async(_0x4ab035,_0x25a815)=>{var _0x11912d=a0_0x39b0b7;try{const {invoice:_0xaef75c,date:_0x1bf7ab,warehouse_name:_0x2947e6,product_name:_0x4f5635,primary_code:_0xe1f518,secondary_code:_0x5556ac,product_code:_0x38ae11,sales_quantity:_0x1a11d9,stocks:_0x1ed696,return_qty:_0x27388f,Room_name:_0x2c588a,to_warehouse_name:_0x4a0d3e,to_Roomname:_0x40b956,to_Room_name:_0x54c661,note:_0x43fd44,level:_0x384a87,isle:_0x373cac,pallet:_0x1addc6}=_0x4ab035[_0x11912d(0x1f1)];if(typeof _0x4f5635==_0x11912d(0x224))var _0x574817=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x155)]],_0x4e1d4d=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x1aa)]],_0x20a2d0=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x188)]],_0x6d265c=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x15d)]],_0x3bb71b=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x217)]],_0x362821=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x195)]],_0xa473fd=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x1c6)]],_0x3f81f1=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x222)]],_0x1b575b=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x22c)]],_0x4bffc5=[_0x4ab035[_0x11912d(0x1f1)]['types']],_0x554642=[_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x20e)]];else var _0x574817=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x155)]],_0x4e1d4d=[..._0x4ab035['body']['primary_code']],_0x20a2d0=[..._0x4ab035['body'][_0x11912d(0x188)]],_0x6d265c=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x15d)]],_0x3bb71b=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x217)]],_0x362821=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x195)]],_0xa473fd=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x1c6)]],_0x3f81f1=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x222)]],_0x1b575b=[..._0x4ab035[_0x11912d(0x1f1)]['bin']],_0x4bffc5=[..._0x4ab035['body'][_0x11912d(0x15e)]],_0x554642=[..._0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x20e)]];const _0x38d4f6=_0x574817[_0x11912d(0x16d)](_0x14bf0b=>{return _0x14bf0b={'product_name':_0x14bf0b};});_0x4e1d4d[_0x11912d(0x1b0)]((_0x23ec3e,_0x1c1a55)=>{var _0x511458=_0x11912d;_0x38d4f6[_0x1c1a55][_0x511458(0x1aa)]=_0x23ec3e;}),_0x20a2d0[_0x11912d(0x1b0)]((_0x1b2794,_0x369d33)=>{var _0x4dc902=_0x11912d;_0x38d4f6[_0x369d33][_0x4dc902(0x188)]=_0x1b2794;}),_0x6d265c['forEach']((_0x3f0266,_0x1642b8)=>{var _0x42eb90=_0x11912d;_0x38d4f6[_0x1642b8][_0x42eb90(0x15d)]=_0x3f0266;}),_0x3bb71b['forEach']((_0x4faeaf,_0xd750c0)=>{var _0x199124=_0x11912d;_0x38d4f6[_0xd750c0][_0x199124(0x1d8)]=_0x4faeaf;}),_0x362821[_0x11912d(0x1b0)]((_0x2c6f4e,_0x1567dd)=>{var _0xd70024=_0x11912d;_0x38d4f6[_0x1567dd][_0xd70024(0x1f7)]=_0x2c6f4e;}),_0xa473fd[_0x11912d(0x1b0)]((_0x5257ce,_0x2c0e2a)=>{var _0x31249f=_0x11912d;_0x38d4f6[_0x2c0e2a][_0x31249f(0x1c6)]=_0x5257ce;}),_0x3f81f1['forEach']((_0xb35ce3,_0x55d72c)=>{var _0x2071a8=_0x11912d;_0x38d4f6[_0x55d72c][_0x2071a8(0x222)]=_0xb35ce3;}),_0x1b575b['forEach']((_0x18a65d,_0x12cfb0)=>{_0x38d4f6[_0x12cfb0]['bin']=_0x18a65d;}),_0x4bffc5['forEach']((_0x39a0f3,_0x3dff75)=>{var _0x5d7e70=_0x11912d;_0x38d4f6[_0x3dff75][_0x5d7e70(0x207)]=_0x39a0f3;}),_0x554642[_0x11912d(0x1b0)]((_0xf5eae7,_0x48ca2e)=>{_0x38d4f6[_0x48ca2e]['floorlevel']=_0xf5eae7;});var _0x44c7c2=0x0;_0x38d4f6[_0x11912d(0x1b0)](_0xeb5982=>{var _0x55ebad=_0x11912d;console['log'](_0x55ebad(0x1dc),_0xeb5982),(parseInt(_0xeb5982[_0x55ebad(0x1d8)])<parseInt(_0xeb5982[_0x55ebad(0x1c6)])||parseInt(_0xeb5982['stock'])<parseInt(_0xeb5982[_0x55ebad(0x1c6)])&&parseInt(_0xeb5982['sale_qty'])>parseInt(_0xeb5982[_0x55ebad(0x1c6)])||parseInt(_0xeb5982[_0x55ebad(0x1c6)])==0x0)&&_0x44c7c2++;});if(_0x44c7c2!=0x0)return _0x4ab035[_0x11912d(0x210)](_0x11912d(0x154),_0x11912d(0x172)),_0x25a815[_0x11912d(0x1bc)](_0x11912d(0x22a));const _0x1282b9=await sales['findOne']({'invoice':_0xaef75c});console['log'](_0x1282b9),_0x1282b9['return_data']=_0x11912d(0x1bb);const _0x4b2439=await _0x1282b9[_0x11912d(0x1a3)](),_0x5a751b=new sales_return({'invoice':_0xaef75c,'customer':_0x4ab035['body']['customer'],'date':_0x1bf7ab,'warehouse_name':_0x2947e6,'room':_0x2c588a,'ToWarehouse':_0x4a0d3e,'ToRoom':_0x54c661,'return_sale':_0x38d4f6,'note':_0x43fd44}),_0x10eb15=await _0x5a751b['save']();console[_0x11912d(0x1ef)](_0x5a751b);const _0x48095b=await sales_return[_0x11912d(0x252)]({'invoice':_0xaef75c}),_0x4c4d7d=await warehouse['findOne']({'name':_0x4a0d3e,'room':_0x54c661});_0x48095b[_0x11912d(0x219)][_0x11912d(0x1b0)](_0x3a5f3c=>{var _0x5cb409=_0x11912d,_0x4abef9=0x0;const _0x553998=_0x4c4d7d['product_details']['map'](_0x53329a=>{var _0x543a9c=a0_0xb0f9;_0x53329a['product_name']==_0x3a5f3c[_0x543a9c(0x155)]&&_0x53329a[_0x543a9c(0x20e)]==_0x3a5f3c[_0x543a9c(0x20e)]&&_0x53329a[_0x543a9c(0x207)]==_0x3a5f3c[_0x543a9c(0x207)]&&_0x53329a[_0x543a9c(0x22c)]==_0x3a5f3c[_0x543a9c(0x22c)]&&_0x53329a['bay']==_0x3a5f3c[_0x543a9c(0x222)]&&(_0x53329a['product_stock']=parseInt(_0x53329a['product_stock'])+parseInt(_0x3a5f3c[_0x543a9c(0x1c6)]),_0x4abef9++);});_0x4abef9=='0'&&(_0x4c4d7d[_0x5cb409(0x18c)]=_0x4c4d7d[_0x5cb409(0x18c)][_0x5cb409(0x16a)]({'product_name':_0x3a5f3c[_0x5cb409(0x155)],'product_stock':_0x3a5f3c[_0x5cb409(0x1c6)],'primary_code':_0x3a5f3c['primary_code'],'secondary_code':_0x3a5f3c['secondary_code'],'product_code':_0x3a5f3c['product_code'],'bay':_0x3a5f3c[_0x5cb409(0x222)],'bin':_0x3a5f3c[_0x5cb409(0x22c)],'type':_0x3a5f3c[_0x5cb409(0x207)],'floorlevel':_0x3a5f3c['floorlevel']})),console[_0x5cb409(0x1ef)](_0x5cb409(0x1fd),_0x4c4d7d);}),await _0x4c4d7d[_0x11912d(0x1a3)](),console[_0x11912d(0x1ef)](_0x4ab035[_0x11912d(0x1f1)]);const _0x154d7c=new c_payment_data({'invoice':_0xaef75c,'customer':_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x184)],'reason':'Sale\x20Return'});await _0x154d7c[_0x11912d(0x1a3)]();const _0x42950f=await master_shop[_0x11912d(0x1a6)]();console[_0x11912d(0x1ef)](_0x11912d(0x23f),_0x42950f[0x0][_0x11912d(0x22d)]);const _0x3bbaa9=await email_settings['findOne'](),_0x296c6a=await customer['findOne']({'name':_0x4ab035[_0x11912d(0x1f1)][_0x11912d(0x184)]});console[_0x11912d(0x1ef)](_0x11912d(0x1da),_0x296c6a);_0x42950f[0x0][_0x11912d(0x25c)]==0x1?(right_currency=_0x42950f[0x0][_0x11912d(0x1b7)],left_currency=''):(right_currency='',left_currency=_0x42950f[0x0]['currency']);var _0x355be0=_0x574817,_0x3b8fa7=_0xa473fd,_0xa5721c='',_0x8de7f8;for(_0x8de7f8 in _0x355be0){_0xa5721c+=_0x11912d(0x1c3)+_0x11912d(0x158)+_0x355be0[_0x8de7f8]+_0x11912d(0x211)+_0x11912d(0x158)+_0x3b8fa7[_0x8de7f8]+_0x11912d(0x211)+'</tr>';}console['log'](_0x11912d(0x15f),_0xa5721c);let _0x4a93e8=nodemailer[_0x11912d(0x187)]({'service':'gmail','auth':{'user':_0x3bbaa9[_0x11912d(0x250)],'pass':_0x3bbaa9[_0x11912d(0x1c7)]}}),_0x45dcb5={'from':_0x3bbaa9[_0x11912d(0x250)],'to':_0x296c6a[_0x11912d(0x250)],'subject':_0x11912d(0x17f),'attachments':[{'filename':_0x11912d(0x1de),'path':__dirname+_0x11912d(0x185)+_0x11912d(0x1d5)+_0x42950f[0x0][_0x11912d(0x22d)],'cid':_0x11912d(0x1eb)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x11912d(0x197)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x11912d(0x17e)+'</div>'+_0x11912d(0x197)+_0x11912d(0x21a)+_0x42950f[0x0][_0x11912d(0x153)]+_0x11912d(0x209)+_0x11912d(0x1e4)+_0x11912d(0x1e4)+'<hr\x20class=\x22my-3\x22>'+_0x11912d(0x197)+_0x11912d(0x17a)+'\x20Order\x20Number\x20:\x20'+_0xaef75c+'\x20'+_0x11912d(0x229)+_0x11912d(0x193)+_0x1bf7ab+'\x20'+_0x11912d(0x176)+_0x11912d(0x18f)+_0x11912d(0x1e4)+_0x11912d(0x15a)+_0x11912d(0x1ec)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x11912d(0x255)+_0x11912d(0x179)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x11912d(0x1a0)+_0x11912d(0x24a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xa5721c+'\x20'+_0x11912d(0x1a7)+_0x11912d(0x200)+_0x11912d(0x197)+_0x11912d(0x25d)+_0x11912d(0x236)+_0x42950f[0x0][_0x11912d(0x153)]+_0x11912d(0x18f)+_0x11912d(0x1e4)+'</div>'+_0x11912d(0x198)};_0x4a93e8['sendMail'](_0x45dcb5,function(_0x256db2,_0x3c65ea){var _0x22677d=_0x11912d;_0x256db2?(console[_0x22677d(0x1ef)](_0x256db2),console[_0x22677d(0x1ef)](_0x22677d(0x225))):console[_0x22677d(0x1ef)](_0x22677d(0x156));}),_0x4ab035[_0x11912d(0x210)]('success',_0x11912d(0x1bd)),_0x25a815['redirect']('/all_sales/view');}catch(_0xb4a985){console[_0x11912d(0x1ef)](_0xb4a985),_0x25a815[_0x11912d(0x253)](0xc8)[_0x11912d(0x1b9)]({'message1':_0xb4a985[_0x11912d(0x19a)]});}}),router[a0_0x39b0b7(0x1ac)]('/barcode/:id',auth,async(_0x2dbc9a,_0x69ed2a)=>{var _0x5dc78f=a0_0x39b0b7;try{const {username:_0xaf7ff3,email:_0x5686ca,role:_0x29448f}=_0x2dbc9a[_0x5dc78f(0x215)],_0x279d5d=_0x2dbc9a[_0x5dc78f(0x215)],_0x5e1406=await profile[_0x5dc78f(0x252)]({'email':_0x279d5d['email']}),_0x41e079=await master_shop[_0x5dc78f(0x1a6)]();console[_0x5dc78f(0x1ef)](_0x5dc78f(0x1ff),_0x41e079);const _0x3b2f67=_0x2dbc9a['params']['id'],_0x5a5ed4=await sales['findById'](_0x3b2f67);console[_0x5dc78f(0x1ef)](_0x5dc78f(0x16e),_0x5a5ed4);if(_0x41e079[0x0][_0x5dc78f(0x20c)]==_0x5dc78f(0x190))var _0x6bc51b=users[_0x5dc78f(0x244)];else{if(_0x41e079[0x0][_0x5dc78f(0x20c)]==_0x5dc78f(0x247))var _0x6bc51b=users[_0x5dc78f(0x247)];else{if(_0x41e079[0x0][_0x5dc78f(0x20c)]==_0x5dc78f(0x24b))var _0x6bc51b=users[_0x5dc78f(0x24b)];else{if(_0x41e079[0x0]['language']==_0x5dc78f(0x240))var _0x6bc51b=users[_0x5dc78f(0x240)];else{if(_0x41e079[0x0][_0x5dc78f(0x20c)]==_0x5dc78f(0x1b4))var _0x6bc51b=users[_0x5dc78f(0x1b4)];else{if(_0x41e079[0x0]['language']==_0x5dc78f(0x1ea))var _0x6bc51b=users[_0x5dc78f(0x245)];else{if(_0x41e079[0x0][_0x5dc78f(0x20c)]==_0x5dc78f(0x1ed))var _0x6bc51b=users[_0x5dc78f(0x1ed)];else{if(_0x41e079[0x0][_0x5dc78f(0x20c)]==_0x5dc78f(0x164))var _0x6bc51b=users[_0x5dc78f(0x1d4)];}}}}}}}_0x69ed2a[_0x5dc78f(0x1e1)](_0x5dc78f(0x199),{'success':_0x2dbc9a[_0x5dc78f(0x210)](_0x5dc78f(0x259)),'errors':_0x2dbc9a[_0x5dc78f(0x210)]('errors'),'role':_0x279d5d,'profile':_0x5e1406,'alldata':_0x5a5ed4,'master_shop':_0x41e079,'language':_0x6bc51b});}catch(_0x2897b5){console['log'](_0x2897b5);}}),router[a0_0x39b0b7(0x1fe)](a0_0x39b0b7(0x16c),async(_0x481881,_0x6a082a)=>{var _0x569b87=a0_0x39b0b7;const {product_code:_0x59a483,warehouse_name:_0x82d8c,rooms_data:_0x5a1452,Roomslist:_0xba06a}=_0x481881['body'],_0xc725fe=_0xba06a[_0x569b87(0x1a1)](','),_0x36ad89=[];async function _0x16e881(_0xa36ad9){var _0x1560ec=_0x569b87;const _0x33482f=await warehouse[_0x1560ec(0x21d)]([{'$match':{'name':_0x82d8c,'room':_0xa36ad9}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x59a483}},{'$group':{'_id':_0x1560ec(0x1b5),'name':{'$first':_0x1560ec(0x21e)},'product_stock':{'$first':_0x1560ec(0x1c1)},'primary_code':{'$first':_0x1560ec(0x227)},'secondary_code':{'$first':_0x1560ec(0x161)},'product_code':{'$first':_0x1560ec(0x1cd)},'level':{'$first':_0x1560ec(0x1b8)},'isle':{'$first':_0x1560ec(0x1d6)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1560ec(0x1cb)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1560ec(0x235)},'storage':{'$first':_0x1560ec(0x23a)},'rack':{'$first':_0x1560ec(0x1e8)},'expiry_date':{'$first':_0x1560ec(0x177)},'production_date':{'$first':_0x1560ec(0x22f)},'maxPerUnit':{'$first':_0x1560ec(0x1f0)},'batch_code':{'$first':_0x1560ec(0x1fb)},'product_cat':{'$first':_0x1560ec(0x183)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1560ec(0x18d)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x1560ec(0x22b)},'actual_uom':{'$first':_0x1560ec(0x237)}}}]),_0x57e52b=await warehouse[_0x1560ec(0x21d)]([{'$match':{'name':_0x82d8c,'room':_0xa36ad9}},{'$unwind':_0x1560ec(0x21c)},{'$match':{'product_details.secondary_code':_0x59a483}},{'$group':{'_id':_0x1560ec(0x1b5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1560ec(0x1c1)},'primary_code':{'$first':_0x1560ec(0x227)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1560ec(0x1cd)},'level':{'$first':_0x1560ec(0x1b8)},'isle':{'$first':_0x1560ec(0x1d6)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1560ec(0x1cb)},'unit':{'$first':_0x1560ec(0x18b)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1560ec(0x23a)},'rack':{'$first':_0x1560ec(0x1e8)},'expiry_date':{'$first':_0x1560ec(0x177)},'production_date':{'$first':_0x1560ec(0x22f)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x1560ec(0x183)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1560ec(0x18d)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x33482f['length']>0x0)_0x36ad89[_0x1560ec(0x19d)](_0x33482f);else _0x57e52b[_0x1560ec(0x1f2)]>0x0&&_0x36ad89['push'](_0x57e52b);}const _0x3260e2=_0xc725fe['map'](_0x5c88ef=>_0x16e881(_0x5c88ef));await Promise['all'](_0x3260e2),_0x6a082a['json'](_0x36ad89);}),module[a0_0x39b0b7(0x189)]=router;