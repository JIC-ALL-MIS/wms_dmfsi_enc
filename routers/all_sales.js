var a0_0x55d168=a0_0x3dac;function a0_0x3dac(_0x4aaf0a,_0x395fb3){var _0x41a163=a0_0x41a1();return a0_0x3dac=function(_0x3dace6,_0x4d93f4){_0x3dace6=_0x3dace6-0x97;var _0x3de1d1=_0x41a163[_0x3dace6];return _0x3de1d1;},a0_0x3dac(_0x4aaf0a,_0x395fb3);}(function(_0x2204cc,_0x120c38){var _0x110202=a0_0x3dac,_0x115b0b=_0x2204cc();while(!![]){try{var _0x4fabad=-parseInt(_0x110202(0x13b))/0x1+-parseInt(_0x110202(0x17b))/0x2*(-parseInt(_0x110202(0x14f))/0x3)+parseInt(_0x110202(0x169))/0x4*(-parseInt(_0x110202(0x162))/0x5)+-parseInt(_0x110202(0x11b))/0x6+-parseInt(_0x110202(0x176))/0x7*(parseInt(_0x110202(0x9d))/0x8)+parseInt(_0x110202(0x115))/0x9*(-parseInt(_0x110202(0xf2))/0xa)+parseInt(_0x110202(0x157))/0xb*(parseInt(_0x110202(0x18f))/0xc);if(_0x4fabad===_0x120c38)break;else _0x115b0b['push'](_0x115b0b['shift']());}catch(_0x34b4dc){_0x115b0b['push'](_0x115b0b['shift']());}}}(a0_0x41a1,0xed5f5));const express=require('express'),app=express(),router=express[a0_0x55d168(0x167)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x55d168(0x10e)),auth=require(a0_0x55d168(0x14d)),nodemailer=require('nodemailer'),users=require(a0_0x55d168(0xd1));router[a0_0x55d168(0x19b)]('/view',auth,async(_0x1c23cb,_0x109fd2)=>{var _0x5e16f7=a0_0x55d168;try{const {username:_0x27d7e8,email:_0x318518,role:_0x1e542f}=_0x1c23cb[_0x5e16f7(0x11c)],_0x121dd6=_0x1c23cb[_0x5e16f7(0x11c)],_0x43e10d=await profile['findOne']({'email':_0x121dd6[_0x5e16f7(0x165)]}),_0x4a9503=await master_shop[_0x5e16f7(0xfc)]();let _0x2056f0;if(_0x121dd6[_0x5e16f7(0x15c)]==_0x5e16f7(0x11d)){const _0x4f4d10=await staff[_0x5e16f7(0x10c)]({'email':_0x121dd6[_0x5e16f7(0x165)]});_0x2056f0=await sales[_0x5e16f7(0x180)]([{'$lookup':{'from':'customers','localField':_0x5e16f7(0x15b),'foreignField':_0x5e16f7(0x118),'as':_0x5e16f7(0xa3)}},{'$unwind':_0x5e16f7(0x19c)},{'$unwind':_0x5e16f7(0xd6)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5e16f7(0x14c)},'customers':{'$first':'$customer'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5e16f7(0xe6)},'sale_product':{'$push':_0x5e16f7(0xd6)},'note':{'$first':_0x5e16f7(0x146)},'return_data':{'$first':_0x5e16f7(0xf4)},'customers_docs':{'$first':_0x5e16f7(0x19c)},'total_saleproduct_quantity':{'$sum':_0x5e16f7(0x12b)},'level':{'$addToSet':_0x5e16f7(0xb0)},'isle':{'$addToSet':_0x5e16f7(0xd2)},'type':{'$addToSet':_0x5e16f7(0xe3)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x5e16f7(0x17c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x2056f0=await sales[_0x5e16f7(0x180)]([{'$lookup':{'from':_0x5e16f7(0x16b),'localField':_0x5e16f7(0x15b),'foreignField':_0x5e16f7(0x118),'as':_0x5e16f7(0xa3)}},{'$unwind':_0x5e16f7(0x19c)},{'$unwind':'$sale_product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x5e16f7(0x14c)},'customers':{'$first':_0x5e16f7(0x181)},'date':{'$first':_0x5e16f7(0x161)},'warehouse_name':{'$first':_0x5e16f7(0xe6)},'sale_product':{'$push':_0x5e16f7(0xd6)},'note':{'$first':_0x5e16f7(0x146)},'return_data':{'$first':_0x5e16f7(0xf4)},'customers_docs':{'$first':_0x5e16f7(0x19c)},'total_saleproduct_quantity':{'$sum':_0x5e16f7(0x12b)},'level':{'$addToSet':_0x5e16f7(0xb0)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x5e16f7(0xd8)},'isAllowEdit':{'$first':_0x5e16f7(0x17c)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x5e16f7(0xfd)](_0x5e16f7(0x12c),_0x2056f0);if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0x155)){var _0x2c4e2b=users['English'];console[_0x5e16f7(0xfd)](_0x2c4e2b);}else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0xc7))var _0x2c4e2b=users[_0x5e16f7(0xc7)];else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0x13a))var _0x2c4e2b=users[_0x5e16f7(0x13a)];else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0x195))var _0x2c4e2b=users['Spanish'];else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0xb7))var _0x2c4e2b=users[_0x5e16f7(0xb7)];else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0xa9))var _0x2c4e2b=users[_0x5e16f7(0xf7)];else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0xb1))var _0x2c4e2b=users[_0x5e16f7(0xb1)];else{if(_0x4a9503[0x0][_0x5e16f7(0xac)]==_0x5e16f7(0x150))var _0x2c4e2b=users['Arabic'];}}}}}}}_0x109fd2[_0x5e16f7(0x14b)](_0x5e16f7(0x132),{'success':_0x1c23cb['flash'](_0x5e16f7(0xff)),'errors':_0x1c23cb['flash'](_0x5e16f7(0xd4)),'sales':_0x2056f0,'profile':_0x43e10d,'role':_0x121dd6,'master_shop':_0x4a9503,'language':_0x2c4e2b});}catch(_0x262648){console['log'](_0x262648);}});function a0_0x41a1(){var _0x104b40=['$product_details.production_date','$finalize','/barcode_scanner','/view/return_sales/:id','$product_details.product_stock','isAllowEdit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.primary_code','floorlevel','/all_sales/view','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$sale_product.type','all','back','$warehouse_name','/give_payment/:id','received_amount','English','Email\x20sent\x20successfully','$product_details._id','max_per_unit','Sale\x20Return\x20Mail','quantity','/view/add_sales/:id','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','520ppYhpJ','length','$return_data','delivery_date','$product_details.storage','Portuguese','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','finalize','RMSEmail','Received\x20Payment\x20For\x20Sale','find','log','getDate','success','Shelves','sale_qty','push','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','sales_quantity','$room','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','stock','$product_details.floorlevel','user_id','findOne','customer_data','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','primary_code','<strong>\x20Regards\x20</strong>','</thead>','$product_details','sales_invoice','230625AzsLSx','product_list','Sales\x20Mail','name','primary_unit','edit_sales','6885966GFnoRH','user','staff','production_date','/all_sales/preview/','body','/../public','sendMail','<html><head><title></title>','exports','secondary_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Sales\x20Add\x20successfully','add_sales','<span\x20style=\x22float:\x20right;\x22>','$product','$sale_product.quantity','sales\x20all_data','Enabled','$product_details.batch_code','type','final','product_code','all_sales','OUT-','amount','Logo.png','sales\x20item\x20return\x20successfull','stock_data','An\x20error\x20occurred\x20while\x20saving\x20data.','storage','German','849520hSxpFw','prod_code','/upload/','$product_details.bay','_id','foreach\x20newproduct','purchases_data','random','add\x20post','concat','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$note','True','prod_invoice','$name','rack','render','$invoice','../middleware/auth','date','87eesDuv','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product.product_name','batch_code','</div>','English\x20(US)','False','32231243LeArph','RoomAssigned','<hr\x20class=\x22my-3\x22>','</span>','customer','role','/view/add_sales','level','$product_details.secondary_unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$date','3495ZOEwme','$product_details.pallet','maxperunit','email','save','Router','redirect','6340EIeewF','\x20Order\x20Date\x20:\x20','customers','</body></html>','return_qty','slice','prod_cat','bin','<h2>\x20','$product_details.product_cat','$product_details.maxPerUnit','currency_placement','Ambient','2668463ztfsjo','requested_qty','error','stocks','json','47812csmHqC','$isAllowEdit','post','/invoice/:id','Receiving\x20Area','aggregate','$customer','image','room_name','return_sale','</tr>','secondary_code','<div>','$product_details.expiry_date','Return\x20Rooms','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','filter','Floor','$product_details.rack','24eSxvJe','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Arabic','expiry_date','padStart','/view/:id','Spanish','$product_details.type','product_name','<h5\x20style=\x22text-align:\x20left;\x22>','<!DOCTYPE\x20html>','findById','get','$customers_docs','sale_product','</td>','</h5>','quantity_notConverted','product_details','bay','24jQwLwA','Enclosed','warehouse','Sale\x20Return','\x20Order\x20Number\x20:\x20','</table>','customers_docs','return_data','flash','currency','Raw\x20Materials','params','Portuguese\x20(BR)','$product_details.product_name','/preview/:id','language','product','$product_details.invoice','floor','$sale_product.bay','Chinese','due_amount','product_stock','There\x27s\x20a\x20error\x20in\x20this\x20transaction','edit_sales_view','delivery_code','French','forEach','master','Error\x20Occurs','catch','host','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<h5>','warehouse_name','Level','split','invoice','carton','</head><body>','unit','Hindi','$product_details.product_code','<tr>','toString','/view/add_sale/product','$product_details.bin','Sales\x20Update\x20successfully','$product_details.unit','map','status','../public/language/languages.json','$sale_product.bin','$product_details.secondary_code','errors','gmail','$sale_product'];a0_0x41a1=function(){return _0x104b40;};return a0_0x41a1();}async function getRandom8DigitNumber(){var _0x5ede80=a0_0x55d168;const _0xea6550=0x989680,_0x5707b4=0x5f5e0ff,_0x2b7d0a=Math[_0x5ede80(0xaf)](Math[_0x5ede80(0x142)]()*(_0x5707b4-_0xea6550+0x1))+_0xea6550;var _0x3972f1;const _0x3b429b=await sales[_0x5ede80(0x10c)]({'invoice':_0x5ede80(0x133)+_0x2b7d0a});return _0x3b429b&&_0x3b429b[_0x5ede80(0xf3)]>0x0?_0x3972f1=_0x5ede80(0x133)+_0x2b7d0a:_0x3972f1='OUT-'+_0x2b7d0a,_0x3972f1;}router[a0_0x55d168(0x19b)](a0_0x55d168(0x15d),auth,async(_0xd44ec3,_0x16ebec)=>{var _0x272ea1=a0_0x55d168;try{const {username:_0x5ddd60,email:_0x5c74d4,role:_0x32f4e3}=_0xd44ec3[_0x272ea1(0x11c)],_0x1e430a=_0xd44ec3[_0x272ea1(0x11c)],_0xcc6048=await profile[_0x272ea1(0x10c)]({'email':_0x1e430a[_0x272ea1(0x165)]}),_0x24e416=await master_shop[_0x272ea1(0xfc)](),_0x349f0e=await customer[_0x272ea1(0xfc)]({});let _0x3b80fd;if(_0x1e430a[_0x272ea1(0x15c)]==_0x272ea1(0x11d)){const _0x55e268=await staff['findOne']({'email':_0x1e430a[_0x272ea1(0x165)]});_0x3b80fd=await warehouse[_0x272ea1(0x180)]([{'$match':{'status':_0x272ea1(0x12d),'name':_0x55e268[_0x272ea1(0x9f)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x272ea1(0x18a)}}},{'$group':{'_id':_0x272ea1(0x149),'name':{'$first':_0x272ea1(0x149)}}},{'$sort':{'name':0x1}}]);}else _0x3b80fd=await warehouse['aggregate']([{'$match':{'status':_0x272ea1(0x12d),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x272ea1(0x18a)}}},{'$group':{'_id':'$name','name':{'$first':_0x272ea1(0x149)}}},{'$sort':{'name':0x1}}]);const _0x5e7321=await product[_0x272ea1(0xfc)]({});var _0x26d908=[_0x272ea1(0x175),'Enclosed'];const _0xc161a2=await sales['find']({}),_0x59909a=_0xc161a2[_0x272ea1(0xf3)]+0x1,_0x488621='OUT-'+_0x59909a[_0x272ea1(0xca)]()[_0x272ea1(0x193)](0x5,'0');if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0x155)){var _0x110b15=users[_0x272ea1(0xe9)];console[_0x272ea1(0xfd)](_0x110b15);}else{if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0xc7))var _0x110b15=users['Hindi'];else{if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0x13a))var _0x110b15=users[_0x272ea1(0x13a)];else{if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0x195))var _0x110b15=users['Spanish'];else{if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0xb7))var _0x110b15=users[_0x272ea1(0xb7)];else{if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0xa9))var _0x110b15=users[_0x272ea1(0xf7)];else{if(_0x24e416[0x0]['language']==_0x272ea1(0xb1))var _0x110b15=users[_0x272ea1(0xb1)];else{if(_0x24e416[0x0][_0x272ea1(0xac)]==_0x272ea1(0x150))var _0x110b15=users[_0x272ea1(0x191)];}}}}}}}const _0x41d972=getRandom8DigitNumber();_0x41d972['then'](_0x4924b2=>{var _0x8e2c09=_0x272ea1;_0x16ebec[_0x8e2c09(0x14b)](_0x8e2c09(0x128),{'success':_0xd44ec3[_0x8e2c09(0xa5)](_0x8e2c09(0xff)),'errors':_0xd44ec3[_0x8e2c09(0xa5)](_0x8e2c09(0xd4)),'role':_0x1e430a,'profile':_0xcc6048,'customer':_0x349f0e,'warehouse':_0x3b80fd,'product':_0x5e7321,'invoice':_0x4924b2,'master_shop':_0x24e416,'language':_0x110b15,'rooms_data':_0x26d908});})['catch'](_0x2029ac=>{var _0xb5b0a2=_0x272ea1;_0xd44ec3[_0xb5b0a2(0xa5)](_0xb5b0a2(0xd4),_0xb5b0a2(0xb4)),_0x16ebec[_0xb5b0a2(0x168)]('/all_sales/view');});}catch(_0x370b58){console['log'](_0x370b58);}}),router[a0_0x55d168(0x19b)](a0_0x55d168(0xef),auth,async(_0x4150f5,_0x23abc6)=>{var _0x455657=a0_0x55d168;try{const _0x2c8761=_0x4150f5[_0x455657(0xa8)]['id'];console[_0x455657(0xfd)](_0x2c8761);const _0x18f1ce=await product[_0x455657(0xfc)](),_0x4f19c4=await purchases[_0x455657(0x180)]([{'$match':{'warehouse_name':_0x2c8761}},{'$unwind':_0x455657(0x12a)},{'$group':{'_id':_0x455657(0x152)}}]);console[_0x455657(0xfd)](_0x455657(0x141),_0x4f19c4),_0x23abc6[_0x455657(0xd0)](0xc8)[_0x455657(0x17a)]({'purchases_data':_0x4f19c4,'product_data':_0x18f1ce});}catch(_0x58b8c3){console[_0x455657(0xfd)](_0x58b8c3);}}),router[a0_0x55d168(0x17d)](a0_0x55d168(0xcb),auth,async(_0x247c00,_0x4afc9e)=>{var _0x2feacb=a0_0x55d168;try{const {warehouse_data:_0x56619e,product_data:_0x2b4bf7}=_0x247c00['body'];console[_0x2feacb(0xfd)](_0x247c00[_0x2feacb(0x120)]['product_data']);;const _0x2fe93b=await master_shop['find']();console[_0x2feacb(0xfd)]('master',_0x2fe93b);const _0x2c1abd=await product[_0x2feacb(0x10c)]({'name':_0x2b4bf7});console[_0x2feacb(0xfd)](_0x2feacb(0xad),_0x2c1abd);const _0x5ad524=await warehouse[_0x2feacb(0x180)]([{'$match':{'name':_0x56619e}},{'$unwind':_0x2feacb(0x113)},{'$match':{'product_details.product_name':_0x2b4bf7}},{'$group':{'_id':_0x2feacb(0xaa),'product_stock':{'$first':_0x2feacb(0xdb)}}}]);console[_0x2feacb(0xfd)](_0x2feacb(0x137),_0x5ad524),_0x4afc9e[_0x2feacb(0xd0)](0xc8)[_0x2feacb(0x17a)]({'master':_0x2fe93b,'new_product':_0x2c1abd,'stock_data':_0x5ad524});}catch(_0xc70620){console[_0x2feacb(0xfd)](_0xc70620);}}),router[a0_0x55d168(0x17d)]('/view/add_sales',auth,async(_0x30aecb,_0x4efe48)=>{var _0x382757=a0_0x55d168;try{const {invoice:_0x1b3e49,date:_0xce83b0,warehouse_name:_0x1fdea5,product_name:_0x7ce519,stock:_0xf11518,quantity:_0x535e0f,note:_0x47eede,room:_0x179563,primary_code:_0x4d695a,secondary_code:_0x156c97,prod_code:_0x549b82,level:_0x416af7,isle:_0x8c7480,pallet:_0x5cf56e,batch_code:_0x308bdd,SCRN:_0x3f2e1a,expiry_date:_0x4e5ae5}=_0x30aecb[_0x382757(0x120)];if(typeof _0x7ce519==_0x382757(0xbd))var _0x4e3f39=[_0x30aecb[_0x382757(0x120)]['product_name']],_0x1a41f0=[_0x30aecb[_0x382757(0x120)][_0x382757(0x109)]],_0x2dbfdf=[_0x30aecb[_0x382757(0x120)][_0x382757(0xc4)]],_0x495f62=[_0x30aecb['body'][_0x382757(0x110)]],_0x1fc5ad=[_0x30aecb[_0x382757(0x120)][_0x382757(0x186)]],_0xd3f3f1=[_0x30aecb[_0x382757(0x120)]['prod_code']],_0x53aeef=[_0x30aecb[_0x382757(0x120)][_0x382757(0x15e)]],_0x25cdbc=[_0x30aecb[_0x382757(0x120)]['primary_unit']],_0xdd9d7b=[_0x30aecb['body'][_0x382757(0x125)]],_0x4809b0=[_0x30aecb['body'][_0x382757(0x153)]],_0x2fca0d=[_0x30aecb[_0x382757(0x120)][_0x382757(0x192)]],_0x2f0f43=[_0x30aecb[_0x382757(0x120)]['max_per_unit']],_0x18db1d=[_0x30aecb[_0x382757(0x120)][_0x382757(0x11e)]],_0x58cb5f=[_0x30aecb['body'][_0x382757(0x177)]],_0x3511a8=[_0x30aecb[_0x382757(0x120)][_0x382757(0xf5)]],_0x403c13=[_0x30aecb[_0x382757(0x120)][_0x382757(0xb6)]],_0x4e7d04=[_0x30aecb[_0x382757(0x120)]['prod_cat']],_0x512cdb=[_0x30aecb[_0x382757(0x120)][_0x382757(0xee)]],_0x2ec185=[_0x30aecb[_0x382757(0x120)][_0x382757(0x158)]],_0x4c9046=[_0x30aecb[_0x382757(0x120)][_0x382757(0x148)]];else var _0x4e3f39=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x197)]],_0x1a41f0=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x109)]],_0x2dbfdf=[..._0x30aecb[_0x382757(0x120)][_0x382757(0xc4)]],_0x495f62=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x110)]],_0x1fc5ad=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x186)]],_0xd3f3f1=[..._0x30aecb[_0x382757(0x120)]['prod_code']],_0x53aeef=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x15e)]],_0x25cdbc=[..._0x30aecb['body'][_0x382757(0x119)]],_0xdd9d7b=[..._0x30aecb[_0x382757(0x120)]['secondary_unit']],_0x4809b0=[..._0x30aecb[_0x382757(0x120)]['batch_code']],_0x2fca0d=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x192)]],_0x2f0f43=[..._0x30aecb[_0x382757(0x120)][_0x382757(0xec)]],_0x18db1d=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x11e)]],_0x58cb5f=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x177)]],_0x3511a8=[..._0x30aecb[_0x382757(0x120)][_0x382757(0xf5)]],_0x403c13=[..._0x30aecb[_0x382757(0x120)][_0x382757(0xb6)]],_0x4e7d04=[..._0x30aecb['body'][_0x382757(0x16f)]],_0x512cdb=[..._0x30aecb['body']['quantity']],_0x2ec185=[..._0x30aecb[_0x382757(0x120)][_0x382757(0x158)]],_0x4c9046=[..._0x30aecb[_0x382757(0x120)]['prod_invoice']];const _0x5ed590=_0x4e3f39[_0x382757(0xcf)](_0x29646d=>{return _0x29646d={'product_name':_0x29646d};});_0x1a41f0[_0x382757(0xb8)]((_0x280cdd,_0x256350)=>{var _0x346043=_0x382757;_0x5ed590[_0x256350][_0x346043(0x109)]=_0x280cdd;}),_0x2dbfdf[_0x382757(0xb8)]((_0x4e3d0a,_0x5b2d4a)=>{var _0x49eacd=_0x382757;_0x5ed590[_0x5b2d4a][_0x49eacd(0xee)]=_0x4e3d0a;}),_0x495f62['forEach']((_0x3d59e6,_0x1d3960)=>{_0x5ed590[_0x1d3960]['primary_code']=_0x3d59e6;}),_0x1fc5ad[_0x382757(0xb8)]((_0x409941,_0xba9c3a)=>{_0x5ed590[_0xba9c3a]['secondary_code']=_0x409941;}),_0xd3f3f1[_0x382757(0xb8)]((_0x512913,_0x445445)=>{var _0x280836=_0x382757;_0x5ed590[_0x445445][_0x280836(0x131)]=_0x512913;}),_0x53aeef['forEach']((_0x2dbebb,_0x4e0c06)=>{_0x2ec185['forEach']((_0x3ea644,_0x30b6bf)=>{var _0x3d5e75=a0_0x3dac;if(_0x3ea644==_0x3d5e75(0x17f)&&_0x4e0c06==_0x30b6bf){var _0x2f0683=_0x2dbebb['slice'](0x3);_0x5ed590[_0x4e0c06][_0x3d5e75(0x139)]=_0x2dbebb[0x0],_0x5ed590[_0x4e0c06][_0x3d5e75(0x14a)]=_0x2dbebb[0x1],_0x5ed590[_0x4e0c06][_0x3d5e75(0x9c)]=0x0,_0x5ed590[_0x4e0c06][_0x3d5e75(0x170)]=0x0,_0x5ed590[_0x4e0c06][_0x3d5e75(0x12f)]=_0x3d5e75(0x18d),_0x5ed590[_0x4e0c06][_0x3d5e75(0xdf)]=_0x2f0683;}else{if(_0x3ea644==_0x3d5e75(0x100)&&_0x4e0c06==_0x30b6bf){var _0x2f0683=_0x2dbebb[_0x3d5e75(0x16e)](0x3);_0x5ed590[_0x4e0c06][_0x3d5e75(0x139)]=_0x2dbebb[0x0],_0x5ed590[_0x4e0c06][_0x3d5e75(0x14a)]=_0x2dbebb[0x1],_0x5ed590[_0x4e0c06]['bay']=0x0,_0x5ed590[_0x4e0c06][_0x3d5e75(0x170)]=0x0,_0x5ed590[_0x4e0c06]['type']=_0x3d5e75(0x18d),_0x5ed590[_0x4e0c06]['floorlevel']=_0x2dbebb[0x5];}else{if(_0x4e0c06==_0x30b6bf){var _0x146e09;if(_0x2dbebb[0x4]=='L')_0x146e09='Level';else _0x2dbebb[0x4]=='F'&&(_0x146e09='Floor');_0x5ed590[_0x4e0c06][_0x3d5e75(0x139)]=_0x2dbebb[0x0],_0x5ed590[_0x4e0c06][_0x3d5e75(0x14a)]=_0x2dbebb[0x1],_0x5ed590[_0x4e0c06][_0x3d5e75(0x9c)]=_0x2dbebb[0x2],_0x5ed590[_0x4e0c06][_0x3d5e75(0x170)]=_0x2dbebb[0x3],_0x5ed590[_0x4e0c06]['type']=_0x146e09,_0x5ed590[_0x4e0c06]['floorlevel']=_0x2dbebb[0x5];}}}});}),_0x25cdbc['forEach']((_0x6c8b99,_0x3a4c7a)=>{var _0x42d5aa=_0x382757;_0x5ed590[_0x3a4c7a][_0x42d5aa(0xc6)]=_0x6c8b99;}),_0xdd9d7b[_0x382757(0xb8)]((_0x1a9b00,_0x3db3c6)=>{var _0x1402d1=_0x382757;_0x5ed590[_0x3db3c6][_0x1402d1(0x125)]=_0x1a9b00;}),_0x4809b0[_0x382757(0xb8)]((_0x589ddf,_0x5d4328)=>{var _0x5d5802=_0x382757;_0x5ed590[_0x5d4328][_0x5d5802(0x153)]=_0x589ddf;}),_0x2fca0d['forEach']((_0x2e3b93,_0x34af3c)=>{var _0x1f68d4=_0x382757;_0x5ed590[_0x34af3c][_0x1f68d4(0x192)]=_0x2e3b93;}),_0x2f0f43[_0x382757(0xb8)]((_0xc672fd,_0x42afae)=>{var _0x576d04=_0x382757;_0x5ed590[_0x42afae][_0x576d04(0x164)]=_0xc672fd;}),_0x18db1d[_0x382757(0xb8)]((_0x498ac3,_0x3da8a4)=>{var _0x511d56=_0x382757;_0x5ed590[_0x3da8a4][_0x511d56(0x11e)]=_0x498ac3;}),_0x58cb5f[_0x382757(0xb8)]((_0x4c13ac,_0x3f490d)=>{var _0x5ba134=_0x382757;_0x5ed590[_0x3f490d][_0x5ba134(0x177)]=_0x4c13ac;}),_0x3511a8['forEach']((_0x576de6,_0x403bba)=>{var _0x4ea5f8=_0x382757;_0x5ed590[_0x403bba][_0x4ea5f8(0xf5)]=_0x576de6;}),_0x403c13[_0x382757(0xb8)]((_0x572389,_0x5b62a7)=>{var _0x3ec7e2=_0x382757;_0x5ed590[_0x5b62a7][_0x3ec7e2(0xb6)]=_0x572389;}),_0x4e7d04[_0x382757(0xb8)]((_0x3ad2b7,_0x1b8e7f)=>{_0x5ed590[_0x1b8e7f]['prod_cat']=_0x3ad2b7;}),_0x512cdb[_0x382757(0xb8)]((_0x525e0b,_0x47608c)=>{var _0x57d270=_0x382757;_0x5ed590[_0x47608c][_0x57d270(0x9a)]=_0x525e0b;}),_0x2ec185[_0x382757(0xb8)]((_0x3e0e7c,_0x11b471)=>{var _0x1b21c6=_0x382757;_0x5ed590[_0x11b471][_0x1b21c6(0x183)]=_0x3e0e7c;}),_0x4c9046[_0x382757(0xb8)]((_0x420b12,_0x47dfad)=>{_0x5ed590[_0x47dfad]['invoice']=_0x420b12;});var _0x2e25b9=0x0;_0x5ed590[_0x382757(0xb8)](_0x302ee8=>{var _0x4d0c10=_0x382757;(_0x302ee8[_0x4d0c10(0x109)]<_0x302ee8[_0x4d0c10(0x9a)]||_0x302ee8[_0x4d0c10(0x9a)]==0x0)&&(console[_0x4d0c10(0xfd)](_0x4d0c10(0x140),_0x302ee8),_0x2e25b9++);});const _0x39ce93=_0x5ed590[_0x382757(0x18c)](_0x5e9877=>_0x5e9877[_0x382757(0xee)]!=='0'&&_0x5e9877[_0x382757(0xee)]!==''),_0x12a908=new sales({'invoice':_0x1b3e49,'customer':_0x30aecb[_0x382757(0x120)][_0x382757(0x15b)],'date':_0xce83b0,'warehouse_name':_0x1fdea5,'sale_product':_0x39ce93,'note':_0x47eede,'room':_0x179563,'primary_code':_0x4d695a,'secondary_code':_0x156c97,'prod_code':_0x549b82,'SCRN':_0x3f2e1a}),_0x3d2862=await _0x12a908[_0x382757(0x166)]();_0x30aecb[_0x382757(0xa5)](_0x382757(0xff),_0x382757(0x127)),_0x4efe48['redirect'](_0x382757(0x11f)+_0x3d2862[_0x382757(0x13f)]);}catch(_0x58be0b){console[_0x382757(0xfd)](_0x58be0b);}}),router[a0_0x55d168(0x19b)](a0_0x55d168(0xab),auth,async(_0x302979,_0x27160c)=>{var _0x1fe148=a0_0x55d168;try{const {username:_0x31ca90,email:_0x25cd84,role:_0x380ed5}=_0x302979[_0x1fe148(0x11c)],_0x24adf1=_0x302979[_0x1fe148(0x11c)],_0x8cdd56=await profile['findOne']({'email':_0x24adf1['email']}),_0x508171=await master_shop[_0x1fe148(0xfc)](),_0x21fecf=_0x302979[_0x1fe148(0xa8)]['id'],_0x781d06=await sales[_0x1fe148(0x19a)](_0x21fecf),_0x1a3b84=await warehouse[_0x1fe148(0x180)]([{'$match':{'name':_0x781d06[_0x1fe148(0xc0)]}},{'$unwind':_0x1fe148(0x113)},{'$group':{'_id':_0x1fe148(0xeb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1fe148(0xdb)},'bay':{'$first':_0x1fe148(0x13e)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1fe148(0x196)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1fe148(0xc8)},'storage':{'$first':_0x1fe148(0xf6)},'rack':{'$first':_0x1fe148(0x18e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1fe148(0xd7)}}}]),_0x4e4ac4=await customer[_0x1fe148(0xfc)]({});let _0x504363;if(_0x24adf1['role']==_0x1fe148(0x11d)){const _0x1b178e=await staff['findOne']({'email':_0x24adf1[_0x1fe148(0x165)]});_0x504363=await warehouse[_0x1fe148(0x180)]([{'$match':{'status':_0x1fe148(0x12d),'name':_0x1b178e['warehouse']}},{'$group':{'_id':_0x1fe148(0x149),'name':{'$first':_0x1fe148(0x149)}}}]);}else _0x504363=await warehouse[_0x1fe148(0x180)]([{'$match':{'status':_0x1fe148(0x12d)}},{'$group':{'_id':_0x1fe148(0x149),'name':{'$first':_0x1fe148(0x149)}}}]);const _0x434c92=await product[_0x1fe148(0xfc)]({}),_0x2a456d=await suppliers[_0x1fe148(0xfc)]({});if(_0x508171[0x0][_0x1fe148(0xac)]=='English\x20(US)'){var _0x4066aa=users[_0x1fe148(0xe9)];console[_0x1fe148(0xfd)](_0x4066aa);}else{if(_0x508171[0x0][_0x1fe148(0xac)]=='Hindi')var _0x4066aa=users[_0x1fe148(0xc7)];else{if(_0x508171[0x0]['language']==_0x1fe148(0x13a))var _0x4066aa=users['German'];else{if(_0x508171[0x0][_0x1fe148(0xac)]==_0x1fe148(0x195))var _0x4066aa=users[_0x1fe148(0x195)];else{if(_0x508171[0x0][_0x1fe148(0xac)]==_0x1fe148(0xb7))var _0x4066aa=users[_0x1fe148(0xb7)];else{if(_0x508171[0x0][_0x1fe148(0xac)]==_0x1fe148(0xa9))var _0x4066aa=users[_0x1fe148(0xf7)];else{if(_0x508171[0x0]['language']=='Chinese')var _0x4066aa=users['Chinese'];else{if(_0x508171[0x0][_0x1fe148(0xac)]=='Arabic\x20(ae)')var _0x4066aa=users[_0x1fe148(0x191)];}}}}}}}_0x27160c[_0x1fe148(0x14b)](_0x1fe148(0xb5),{'success':_0x302979[_0x1fe148(0xa5)](_0x1fe148(0xff)),'errors':_0x302979[_0x1fe148(0xa5)](_0x1fe148(0xd4)),'role':_0x24adf1,'profile':_0x8cdd56,'customer':_0x4e4ac4,'warehouse':_0x504363,'product':_0x1a3b84,'user':_0x781d06,'master_shop':_0x508171,'unit':_0x434c92,'language':_0x4066aa,'suppliers':_0x2a456d});}catch(_0x156f22){console['log'](_0x156f22);}}),router['post'](a0_0x55d168(0xab),auth,async(_0x5e43fe,_0x22debf)=>{var _0x18f1a6=a0_0x55d168;try{const _0x4e5afd=_0x5e43fe['params']['id'],{invoice:_0x3fe50e,warehouse_name:_0xcac739,room:_0x347887}=_0x5e43fe['body'],_0x307032=await sales[_0x18f1a6(0x10c)]({'invoice':_0x3fe50e}),_0x49d5b6=_0x307032['sale_product'][_0x18f1a6(0xcf)](async _0x483727=>{var _0x3945b4=_0x18f1a6,_0x2bcf46=await warehouse[_0x3945b4(0x10c)]({'name':_0xcac739,'room':_0x483727['room_name'],'warehouse_category':'Raw\x20Materials'});const _0x3445e0=_0x2bcf46[_0x3945b4(0x9b)][_0x3945b4(0xcf)](_0x46ab8f=>{var _0x4f70f3=_0x3945b4;_0x46ab8f[_0x4f70f3(0x197)]==_0x483727[_0x4f70f3(0x197)]&&_0x46ab8f[_0x4f70f3(0xdf)]==_0x483727['floorlevel']&&_0x46ab8f[_0x4f70f3(0x12f)]==_0x483727[_0x4f70f3(0x12f)]&&_0x46ab8f[_0x4f70f3(0x170)]==_0x483727[_0x4f70f3(0x170)]&&_0x46ab8f['bay']==_0x483727[_0x4f70f3(0x9c)]&&_0x46ab8f['rack']==_0x483727[_0x4f70f3(0x14a)]&&_0x46ab8f[_0x4f70f3(0x139)]==_0x483727['storage']&&_0x46ab8f[_0x4f70f3(0x192)]==_0x483727[_0x4f70f3(0x192)]&&_0x46ab8f[_0x4f70f3(0x153)]==_0x483727[_0x4f70f3(0x153)]&&_0x46ab8f[_0x4f70f3(0xc3)]==_0x483727[_0x4f70f3(0xc3)]&&(_0x46ab8f['product_stock']=_0x46ab8f[_0x4f70f3(0xb3)]-_0x483727[_0x4f70f3(0xee)]);});return _0x2bcf46;});Promise['all'](_0x49d5b6)['then'](async _0x121471=>{var _0x1b3269=_0x18f1a6;try{for(const _0xdd2cb of _0x121471){await _0xdd2cb[_0x1b3269(0x166)]();}_0x307032[_0x1b3269(0xf9)]='True';const _0x148cfa=await _0x307032['save'](),_0x567ff3=await master_shop[_0x1b3269(0xfc)](),_0x1bcc8e=await email_settings[_0x1b3269(0x10c)](),_0x390a6f=await supervisor_settings['find']();var _0x2c79fb=_0x307032[_0x1b3269(0x97)],_0x15a016='',_0x54bfbb;for(_0x54bfbb in _0x2c79fb){_0x15a016+=_0x1b3269(0xc9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c79fb[_0x54bfbb]['product_name']+_0x1b3269(0x98)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c79fb[_0x54bfbb][_0x1b3269(0x131)]+_0x1b3269(0x98)+_0x1b3269(0x190)+_0x2c79fb[_0x54bfbb][_0x1b3269(0xee)]+_0x1b3269(0x98)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c79fb[_0x54bfbb][_0x1b3269(0xc6)]+_0x1b3269(0x98)+_0x1b3269(0x190)+_0x2c79fb[_0x54bfbb][_0x1b3269(0x125)]+_0x1b3269(0x98)+_0x1b3269(0x190)+_0x307032[_0x1b3269(0xc0)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c79fb[_0x54bfbb]['room_name']+'</td>'+_0x1b3269(0x190)+_0x2c79fb[_0x54bfbb][_0x1b3269(0x139)]+_0x2c79fb[_0x54bfbb][_0x1b3269(0x14a)]+_0x2c79fb[_0x54bfbb][_0x1b3269(0x9c)]+_0x2c79fb[_0x54bfbb][_0x1b3269(0x170)]+_0x2c79fb[_0x54bfbb][_0x1b3269(0x12f)][0x0]+_0x2c79fb[_0x54bfbb][_0x1b3269(0xdf)]+_0x1b3269(0x98),'</tr>';}let _0x47c3d5=nodemailer['createTransport']({'host':_0x1bcc8e[_0x1b3269(0xbc)],'port':Number(_0x1bcc8e['port']),'secure':![],'auth':{'user':_0x1bcc8e[_0x1b3269(0x165)],'pass':_0x1bcc8e['password']}}),_0x35e646={'from':_0x1bcc8e['email'],'to':_0x390a6f[0x0][_0x1b3269(0xfa)],'subject':_0x1b3269(0x117),'attachments':[{'filename':_0x1b3269(0x135),'path':__dirname+_0x1b3269(0x121)+_0x1b3269(0x13d)+_0x567ff3[0x0][_0x1b3269(0x182)],'cid':_0x1b3269(0x103)}],'html':_0x1b3269(0x199)+_0x1b3269(0x123)+_0x1b3269(0xc5)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1b3269(0x187)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x1b3269(0x187)+_0x1b3269(0x171)+_0x567ff3[0x0][_0x1b3269(0xe1)]+_0x1b3269(0xf0)+_0x1b3269(0x154)+_0x1b3269(0x154)+_0x1b3269(0x159)+_0x1b3269(0x187)+_0x1b3269(0x198)+_0x1b3269(0xa1)+_0x307032[_0x1b3269(0xc3)]+'\x20'+_0x1b3269(0x129)+_0x1b3269(0x16a)+_0x307032[_0x1b3269(0x14e)]+'\x20'+_0x1b3269(0x15a)+_0x1b3269(0x99)+_0x1b3269(0x154)+_0x1b3269(0x160)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1b3269(0xc9)+_0x1b3269(0x18b)+_0x1b3269(0x104)+_0x1b3269(0x108)+_0x1b3269(0x10f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1b3269(0xf1)+_0x1b3269(0xe2)+_0x1b3269(0x151)+'</tr>'+_0x1b3269(0x112)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x15a016+'\x20'+'</tbody>'+_0x1b3269(0xa2)+_0x1b3269(0x187)+_0x1b3269(0x111)+_0x1b3269(0xbf)+_0x567ff3[0x0][_0x1b3269(0xe1)]+_0x1b3269(0x99)+_0x1b3269(0x154)+_0x1b3269(0x154)+'</body></html>'};_0x47c3d5[_0x1b3269(0x122)](_0x35e646,function(_0x4b8f5e,_0x465ade){var _0x21dc2f=_0x1b3269;_0x4b8f5e?(console[_0x21dc2f(0xfd)](_0x4b8f5e),console[_0x21dc2f(0xfd)](_0x21dc2f(0xba))):console[_0x21dc2f(0xfd)](_0x21dc2f(0xea));}),_0x5e43fe[_0x1b3269(0xa5)]('success',_0x1b3269(0xcd)),_0x22debf[_0x1b3269(0x168)](_0x1b3269(0x11f)+_0x4e5afd);}catch(_0x337b4e){console[_0x1b3269(0x178)](_0x337b4e),_0x22debf[_0x1b3269(0xd0)](0x1f4)[_0x1b3269(0x17a)]({'error':_0x1b3269(0x138)});}})[_0x18f1a6(0xbb)](_0x3027d8=>{var _0x8763bd=_0x18f1a6;console[_0x8763bd(0x178)](_0x3027d8),_0x22debf[_0x8763bd(0xd0)](0x1f4)[_0x8763bd(0x17a)]({'error':'An\x20error\x20occurred.'});});}catch(_0x27d8b2){console['log'](_0x27d8b2);}}),router[a0_0x55d168(0x19b)](a0_0x55d168(0x194),auth,async(_0x4186f1,_0x18d954)=>{var _0x404baa=a0_0x55d168;try{const {username:_0xf1a729,email:_0x5973dc,role:_0x4486d3}=_0x4186f1[_0x404baa(0x11c)],_0x58cc92=_0x4186f1['user'],_0x1fdb29=await profile['findOne']({'email':_0x58cc92[_0x404baa(0x165)]}),_0x180555=await master_shop[_0x404baa(0xfc)](),_0x416755=_0x4186f1['params']['id'],_0x3db663=await sales[_0x404baa(0x19a)](_0x416755);var _0x21f5f0=[_0x404baa(0x175),_0x404baa(0x9e)];const _0x1e7685=await warehouse[_0x404baa(0x180)]([{'$match':{'name':_0x3db663[_0x404baa(0xc0)],'warehouse_category':_0x404baa(0xa7)}},{'$unwind':_0x404baa(0x113)},{'$group':{'_id':_0x404baa(0xeb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x404baa(0xdb)},'bay':{'$first':_0x404baa(0x13e)},'bin':{'$first':_0x404baa(0xcc)},'type':{'$first':_0x404baa(0x196)},'floorlevel':{'$first':_0x404baa(0x10a)},'primary_code':{'$first':_0x404baa(0xde)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x404baa(0xc8)},'storage':{'$first':_0x404baa(0xf6)},'rack':{'$first':'$product_details.rack'}}}]),_0x1da5b9=await customer[_0x404baa(0xfc)]({});let _0x459a78;if(_0x58cc92[_0x404baa(0x15c)]==_0x404baa(0x11d)){const _0x562279=await staff[_0x404baa(0x10c)]({'email':_0x58cc92['email']});_0x459a78=await warehouse[_0x404baa(0x180)]([{'$match':{'status':_0x404baa(0x12d),'name':_0x562279[_0x404baa(0x9f)],'warehouse_category':_0x404baa(0xa7)}},{'$group':{'_id':_0x404baa(0x149),'name':{'$first':'$name'}}}]);}else _0x459a78=await warehouse['aggregate']([{'$match':{'status':_0x404baa(0x12d),'warehouse_category':_0x404baa(0xa7)}},{'$group':{'_id':'$name','name':{'$first':_0x404baa(0x149)}}}]);const _0x4030c0=await product[_0x404baa(0xfc)]({});if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0x155)){var _0x2f0fd1=users[_0x404baa(0xe9)];console[_0x404baa(0xfd)](_0x2f0fd1);}else{if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0xc7))var _0x2f0fd1=users[_0x404baa(0xc7)];else{if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0x13a))var _0x2f0fd1=users[_0x404baa(0x13a)];else{if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0x195))var _0x2f0fd1=users[_0x404baa(0x195)];else{if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0xb7))var _0x2f0fd1=users[_0x404baa(0xb7)];else{if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0xa9))var _0x2f0fd1=users[_0x404baa(0xf7)];else{if(_0x180555[0x0]['language']=='Chinese')var _0x2f0fd1=users['Chinese'];else{if(_0x180555[0x0][_0x404baa(0xac)]==_0x404baa(0x150))var _0x2f0fd1=users[_0x404baa(0x191)];}}}}}}}_0x18d954[_0x404baa(0x14b)](_0x404baa(0x11a),{'success':_0x4186f1['flash']('success'),'errors':_0x4186f1[_0x404baa(0xa5)](_0x404baa(0xd4)),'role':_0x58cc92,'profile':_0x1fdb29,'customer':_0x1da5b9,'warehouse':_0x459a78,'product':_0x1e7685,'user':_0x3db663,'master_shop':_0x180555,'unit':_0x4030c0,'language':_0x2f0fd1});}catch(_0x472bd7){console[_0x404baa(0xfd)](_0x472bd7);}}),router[a0_0x55d168(0x17d)](a0_0x55d168(0x194),auth,async(_0x3ec8c9,_0x44de33)=>{var _0x43a9de=a0_0x55d168;try{const _0x15649e=_0x3ec8c9[_0x43a9de(0xa8)]['id'],_0x15e7a6=await sales[_0x43a9de(0x10c)]({'_id':_0x3ec8c9[_0x43a9de(0xa8)]['id']}),_0x36ffc9=await warehouse['findOne']({'name':_0x15e7a6[_0x43a9de(0xc0)],'room':_0x3ec8c9['body']['room']}),{invoice:_0x222182,date:_0x8dab92,warehouse_name:_0x58a3ac,product_name:_0x15ea1d,stock:_0xab7ef,quantity:_0x168538,note:_0x21180d,room:_0x148a6e,customer:_0x10a28c,SCRN:_0x156f20}=_0x3ec8c9[_0x43a9de(0x120)];if(typeof _0x15ea1d==_0x43a9de(0xbd))var _0x575887=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x197)]],_0x5988f4=[_0x3ec8c9[_0x43a9de(0x120)]['stock']],_0xf84304=[_0x3ec8c9['body'][_0x43a9de(0xc4)]],_0x52777a=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x110)]],_0x345d29=[_0x3ec8c9[_0x43a9de(0x120)]['secondary_code']],_0x56e4ff=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x13c)]],_0x1359e4=[_0x3ec8c9['body'][_0x43a9de(0x15e)]],_0x5d02c4=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x119)]],_0x2be959=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x125)]],_0x343992=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x153)]],_0x166eef=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x192)]],_0x2eb026=[_0x3ec8c9[_0x43a9de(0x120)]['max_per_unit']],_0x3642eb=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x11e)]],_0x4ece76=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x177)]],_0x12f84b=[_0x3ec8c9['body'][_0x43a9de(0xf5)]],_0x277a22=[_0x3ec8c9['body']['delivery_code']],_0x2bb2d6=[_0x3ec8c9['body'][_0x43a9de(0x16f)]],_0x1e2fe3=[_0x3ec8c9['body'][_0x43a9de(0xee)]],_0x575a34=[_0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x158)]];else var _0x575887=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x197)]],_0x5988f4=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x109)]],_0xf84304=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0xc4)]],_0x52777a=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x110)]],_0x345d29=[..._0x3ec8c9['body']['secondary_code']],_0x56e4ff=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x13c)]],_0x1359e4=[..._0x3ec8c9[_0x43a9de(0x120)]['level']],_0x5d02c4=[..._0x3ec8c9['body']['primary_unit']],_0x2be959=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x125)]],_0x343992=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x153)]],_0x166eef=[..._0x3ec8c9['body']['expiry_date']],_0x2eb026=[..._0x3ec8c9[_0x43a9de(0x120)]['max_per_unit']],_0x3642eb=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x11e)]],_0x4ece76=[..._0x3ec8c9['body'][_0x43a9de(0x177)]],_0x12f84b=[..._0x3ec8c9['body'][_0x43a9de(0xf5)]],_0x277a22=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0xb6)]],_0x2bb2d6=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x16f)]],_0x1e2fe3=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0xee)]],_0x575a34=[..._0x3ec8c9[_0x43a9de(0x120)][_0x43a9de(0x158)]];const _0x110c4c=_0x575887[_0x43a9de(0xcf)](_0x34a621=>{return _0x34a621={'product_name':_0x34a621};});_0x5988f4['forEach']((_0xf60938,_0x29d940)=>{var _0x1653c8=_0x43a9de;_0x110c4c[_0x29d940][_0x1653c8(0x109)]=_0xf60938;}),_0xf84304[_0x43a9de(0xb8)]((_0x2b9be5,_0x1ece39)=>{var _0x2b1a40=_0x43a9de;_0x110c4c[_0x1ece39][_0x2b1a40(0xee)]=_0x2b9be5;}),_0x52777a[_0x43a9de(0xb8)]((_0x79b8a6,_0x1c95b4)=>{var _0x1acd3d=_0x43a9de;_0x110c4c[_0x1c95b4][_0x1acd3d(0x110)]=_0x79b8a6;}),_0x345d29['forEach']((_0x2303b1,_0x1b85eb)=>{_0x110c4c[_0x1b85eb]['secondary_code']=_0x2303b1;}),_0x56e4ff[_0x43a9de(0xb8)]((_0x13dcbe,_0x2b21d6)=>{var _0x2cc027=_0x43a9de;_0x110c4c[_0x2b21d6][_0x2cc027(0x131)]=_0x13dcbe;}),_0x1359e4['forEach']((_0x441bc0,_0x41f46d)=>{var _0x36bb26=_0x43a9de;_0x575a34[_0x36bb26(0xb8)]((_0x59e475,_0x1f8099)=>{var _0x49b2eb=_0x36bb26;if(_0x59e475=='Receiving\x20Area'&&_0x41f46d==_0x1f8099){var _0xd74883=_0x441bc0[_0x49b2eb(0x16e)](0x3);_0x110c4c[_0x41f46d]['storage']=_0x441bc0[0x0],_0x110c4c[_0x41f46d][_0x49b2eb(0x14a)]=_0x441bc0[0x1],_0x110c4c[_0x41f46d][_0x49b2eb(0x9c)]=0x0,_0x110c4c[_0x41f46d][_0x49b2eb(0x170)]=0x0,_0x110c4c[_0x41f46d][_0x49b2eb(0x12f)]='Floor',_0x110c4c[_0x41f46d][_0x49b2eb(0xdf)]=_0xd74883;}else{if(_0x59e475==_0x49b2eb(0x100)&&_0x41f46d==_0x1f8099){var _0xd74883=_0x441bc0[_0x49b2eb(0x16e)](0x3);_0x110c4c[_0x41f46d][_0x49b2eb(0x139)]=_0x441bc0[0x0],_0x110c4c[_0x41f46d][_0x49b2eb(0x14a)]=_0x441bc0[0x1],_0x110c4c[_0x41f46d]['bay']=0x0,_0x110c4c[_0x41f46d]['bin']=0x0,_0x110c4c[_0x41f46d][_0x49b2eb(0x12f)]=_0x49b2eb(0x18d),_0x110c4c[_0x41f46d][_0x49b2eb(0xdf)]=_0x441bc0[0x5];}else{if(_0x41f46d==_0x1f8099){var _0x4470ca;if(_0x441bc0[0x4]=='L')_0x4470ca=_0x49b2eb(0xc1);else _0x441bc0[0x4]=='F'&&(_0x4470ca=_0x49b2eb(0x18d));_0x110c4c[_0x41f46d][_0x49b2eb(0x139)]=_0x441bc0[0x0],_0x110c4c[_0x41f46d][_0x49b2eb(0x14a)]=_0x441bc0[0x1],_0x110c4c[_0x41f46d]['bay']=_0x441bc0[0x2],_0x110c4c[_0x41f46d][_0x49b2eb(0x170)]=_0x441bc0[0x3],_0x110c4c[_0x41f46d][_0x49b2eb(0x12f)]=_0x4470ca,_0x110c4c[_0x41f46d][_0x49b2eb(0xdf)]=_0x441bc0[0x5];}}}});}),_0x5d02c4['forEach']((_0x32cbd7,_0x4f7cc1)=>{_0x110c4c[_0x4f7cc1]['unit']=_0x32cbd7;}),_0x2be959[_0x43a9de(0xb8)]((_0x54efcc,_0x498e0f)=>{_0x110c4c[_0x498e0f]['secondary_unit']=_0x54efcc;}),_0x343992[_0x43a9de(0xb8)]((_0x141ec4,_0x267682)=>{var _0x5ae0ee=_0x43a9de;_0x110c4c[_0x267682][_0x5ae0ee(0x153)]=_0x141ec4;}),_0x166eef[_0x43a9de(0xb8)]((_0x203d03,_0x59dd44)=>{var _0x4732c9=_0x43a9de;_0x110c4c[_0x59dd44][_0x4732c9(0x192)]=_0x203d03;}),_0x2eb026[_0x43a9de(0xb8)]((_0x45f410,_0x37cfbb)=>{var _0x5f838d=_0x43a9de;_0x110c4c[_0x37cfbb][_0x5f838d(0x164)]=_0x45f410;}),_0x3642eb['forEach']((_0x2e776b,_0x4fbeb9)=>{var _0x19b279=_0x43a9de;_0x110c4c[_0x4fbeb9][_0x19b279(0x11e)]=_0x2e776b;}),_0x4ece76[_0x43a9de(0xb8)]((_0x453033,_0x1f2d6a)=>{var _0x6d11b3=_0x43a9de;_0x110c4c[_0x1f2d6a][_0x6d11b3(0x177)]=_0x453033;}),_0x12f84b[_0x43a9de(0xb8)]((_0x55062d,_0x31e9c8)=>{var _0x36f88b=_0x43a9de;_0x110c4c[_0x31e9c8][_0x36f88b(0xf5)]=_0x55062d;}),_0x277a22['forEach']((_0xe2f4d4,_0x206ce3)=>{var _0x2aeaae=_0x43a9de;_0x110c4c[_0x206ce3][_0x2aeaae(0xb6)]=_0xe2f4d4;}),_0x2bb2d6[_0x43a9de(0xb8)]((_0x48452f,_0xd2527d)=>{var _0x869de=_0x43a9de;_0x110c4c[_0xd2527d][_0x869de(0x16f)]=_0x48452f;}),_0x1e2fe3[_0x43a9de(0xb8)]((_0xcdc8a2,_0x2df65e)=>{var _0x26a2e8=_0x43a9de;_0x110c4c[_0x2df65e][_0x26a2e8(0x9a)]=_0xcdc8a2;}),_0x575a34[_0x43a9de(0xb8)]((_0x3a6e35,_0x46ed73)=>{var _0x17be73=_0x43a9de;_0x110c4c[_0x46ed73][_0x17be73(0x183)]=_0x3a6e35;});var _0x5e0a18=0x0;_0x110c4c[_0x43a9de(0xb8)](_0x10c673=>{var _0x2b75b6=_0x43a9de;console[_0x2b75b6(0xfd)](_0x2b75b6(0x140),_0x10c673),(parseInt(_0x10c673[_0x2b75b6(0x109)])<parseInt(_0x10c673[_0x2b75b6(0xee)])||parseInt(_0x10c673[_0x2b75b6(0xee)])==0x0)&&_0x5e0a18++;});if(_0x5e0a18!=0x0)return _0x3ec8c9['flash'](_0x43a9de(0xd4),_0x43a9de(0xf8)),_0x44de33[_0x43a9de(0x168)](_0x43a9de(0xe5));const _0x3b44ce=_0x110c4c[_0x43a9de(0x18c)](_0x4ae662=>_0x4ae662[_0x43a9de(0xee)]!=='0'&&_0x4ae662['quantity']!=='');_0x15e7a6[_0x43a9de(0xc3)]=_0x222182,_0x15e7a6[_0x43a9de(0x15b)]=_0x10a28c,_0x15e7a6[_0x43a9de(0x14e)]=_0x8dab92,_0x15e7a6[_0x43a9de(0xc0)]=_0x58a3ac,_0x15e7a6[_0x43a9de(0x97)]=_0x3b44ce,_0x15e7a6['note']=_0x21180d,_0x15e7a6['SCRN']=_0x156f20,_0x15e7a6['finalize']=_0x43a9de(0x156),_0x15e7a6[_0x43a9de(0xdc)]=_0x43a9de(0x156);const _0x421291=await _0x15e7a6[_0x43a9de(0x166)]();_0x3ec8c9[_0x43a9de(0xa5)]('success',_0x43a9de(0xcd)),_0x44de33[_0x43a9de(0x168)](_0x43a9de(0xe0));}catch(_0x3b442f){console[_0x43a9de(0xfd)](_0x3b442f);}}),router[a0_0x55d168(0x17d)](a0_0x55d168(0xe7),auth,async(_0x4ea98c,_0x517bb8)=>{var _0x129a3d=a0_0x55d168;try{const _0x151530=_0x4ea98c[_0x129a3d(0xa8)]['id'],{invoice:_0x15054f,customer:_0x31afbc,receivable_amount:_0x53a9a8,received_amount:_0x50f83b}=_0x4ea98c[_0x129a3d(0x120)],_0x5b42a6=await sales[_0x129a3d(0x19a)](_0x151530);console[_0x129a3d(0xfd)](_0x5b42a6);var _0x4d32b5=_0x53a9a8-_0x50f83b;console[_0x129a3d(0xfd)](_0x50f83b),_0x5b42a6[_0x129a3d(0xe8)]=parseFloat(_0x50f83b)+parseFloat(_0x5b42a6[_0x129a3d(0xe8)]),_0x5b42a6[_0x129a3d(0xb2)]=_0x4d32b5,console[_0x129a3d(0xfd)](_0x5b42a6);const _0x6f5cd7=await _0x5b42a6['save'](),_0x51ac2d=await c_payment_data[_0x129a3d(0x10c)]({'invoice':_0x15054f});_0x51ac2d[_0x129a3d(0x134)]=_0x4d32b5,await _0x51ac2d[_0x129a3d(0x166)]();let _0x1ec0e2=new Date(),_0x3c94c2=('0'+_0x1ec0e2[_0x129a3d(0xfe)]())[_0x129a3d(0x16e)](-0x2),_0x342a1a=('0'+(_0x1ec0e2['getMonth']()+0x1))[_0x129a3d(0x16e)](-0x2),_0x3126db=_0x1ec0e2[_0x129a3d(0x107)](),_0x341e40=_0x3126db+'-'+_0x342a1a+'-'+_0x3c94c2;const _0xb8fae1=new customer_payment({'invoice':_0x15054f,'date':_0x3126db+'-'+_0x342a1a+'-'+_0x3c94c2,'customer':_0x31afbc,'reason':_0x129a3d(0xfb),'amount':_0x50f83b}),_0x53723f=await _0xb8fae1['save']();_0x4ea98c[_0x129a3d(0xa5)](_0x129a3d(0xff),'payment\x20successfull'),_0x517bb8[_0x129a3d(0x168)](_0x129a3d(0xe0));}catch(_0x4caa09){console['log'](_0x4caa09);}}),router[a0_0x55d168(0x19b)](a0_0x55d168(0x17e),auth,async(_0x3e1b59,_0x157b2f)=>{var _0x5cfc05=a0_0x55d168;try{const {username:_0x597378,email:_0x38f573,role:_0x28ab03}=_0x3e1b59[_0x5cfc05(0x11c)],_0x47e47b=_0x3e1b59[_0x5cfc05(0x11c)],_0x42bc53=await profile[_0x5cfc05(0x10c)]({'email':_0x47e47b[_0x5cfc05(0x165)]}),_0x560118=await master_shop[_0x5cfc05(0xfc)]();console['log'](_0x5cfc05(0xb9),_0x560118);const _0x4be214=_0x3e1b59[_0x5cfc05(0xa8)]['id'],_0x564923=await sales[_0x5cfc05(0x19a)](_0x4be214);console[_0x5cfc05(0xfd)](_0x564923);const _0x394336=await customer[_0x5cfc05(0x10c)]({'name':_0x564923[_0x5cfc05(0x15b)]});console[_0x5cfc05(0xfd)](_0x394336);if(_0x560118[0x0]['language']==_0x5cfc05(0x155)){var _0xed3c44=users[_0x5cfc05(0xe9)];console['log'](_0xed3c44);}else{if(_0x560118[0x0][_0x5cfc05(0xac)]==_0x5cfc05(0xc7))var _0xed3c44=users[_0x5cfc05(0xc7)];else{if(_0x560118[0x0][_0x5cfc05(0xac)]==_0x5cfc05(0x13a))var _0xed3c44=users[_0x5cfc05(0x13a)];else{if(_0x560118[0x0][_0x5cfc05(0xac)]==_0x5cfc05(0x195))var _0xed3c44=users['Spanish'];else{if(_0x560118[0x0][_0x5cfc05(0xac)]==_0x5cfc05(0xb7))var _0xed3c44=users[_0x5cfc05(0xb7)];else{if(_0x560118[0x0][_0x5cfc05(0xac)]==_0x5cfc05(0xa9))var _0xed3c44=users['Portuguese'];else{if(_0x560118[0x0]['language']=='Chinese')var _0xed3c44=users[_0x5cfc05(0xb1)];else{if(_0x560118[0x0][_0x5cfc05(0xac)]=='Arabic\x20(ae)')var _0xed3c44=users[_0x5cfc05(0x191)];}}}}}}}_0x157b2f[_0x5cfc05(0x14b)](_0x5cfc05(0x114),{'success':_0x3e1b59[_0x5cfc05(0xa5)]('success'),'errors':_0x3e1b59[_0x5cfc05(0xa5)](_0x5cfc05(0xd4)),'role':_0x47e47b,'profile':_0x42bc53,'master_shop':_0x560118,'customers':_0x394336,'sales':_0x564923,'language':_0xed3c44});}catch(_0x4c7748){console['log'](_0x4c7748);}}),router[a0_0x55d168(0x19b)](a0_0x55d168(0xda),auth,async(_0x219f99,_0x2c8303)=>{var _0x492477=a0_0x55d168;try{const {username:_0x2cbf3b,email:_0x27d2d3,role:_0xef12ae}=_0x219f99[_0x492477(0x11c)],_0x40a352=_0x219f99[_0x492477(0x11c)],_0x32ca6c=await profile[_0x492477(0x10c)]({'email':_0x40a352['email']}),_0x1e500d=await master_shop['find']();console[_0x492477(0xfd)](_0x492477(0xb9),_0x1e500d);const _0x195a84=_0x219f99['params']['id'];console[_0x492477(0xfd)](_0x195a84);const _0x9c3909=await sales[_0x492477(0x19a)](_0x195a84);console['log'](_0x492477(0x10b),_0x9c3909);const _0x50cf13=await warehouse[_0x492477(0x180)]([{'$match':{'name':_0x492477(0x18a),'room':_0x492477(0x189)}},{'$unwind':_0x492477(0x113)},{'$group':{'_id':_0x492477(0xeb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x492477(0xdb)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x492477(0x163)},'primary_code':{'$first':_0x492477(0xde)},'secondary_code':{'$first':_0x492477(0xd3)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x492477(0xfd)]('stock_data',_0x50cf13);const _0xe4d865=await product['find']({});warehouse_data=await warehouse[_0x492477(0x180)]([{'$match':{'status':_0x492477(0x12d),'name':'Return\x20Goods','warehouse_category':_0x492477(0xa7)}},{'$group':{'_id':'$name','name':{'$first':_0x492477(0x149)}}},{'$sort':{'name':0x1}}]);var _0x35468d=[_0x492477(0x189)];if(_0x1e500d[0x0][_0x492477(0xac)]==_0x492477(0x155)){var _0x40abf3=users[_0x492477(0xe9)];console['log'](_0x40abf3);}else{if(_0x1e500d[0x0][_0x492477(0xac)]==_0x492477(0xc7))var _0x40abf3=users[_0x492477(0xc7)];else{if(_0x1e500d[0x0][_0x492477(0xac)]==_0x492477(0x13a))var _0x40abf3=users[_0x492477(0x13a)];else{if(_0x1e500d[0x0][_0x492477(0xac)]==_0x492477(0x195))var _0x40abf3=users[_0x492477(0x195)];else{if(_0x1e500d[0x0][_0x492477(0xac)]=='French')var _0x40abf3=users[_0x492477(0xb7)];else{if(_0x1e500d[0x0][_0x492477(0xac)]==_0x492477(0xa9))var _0x40abf3=users[_0x492477(0xf7)];else{if(_0x1e500d[0x0]['language']==_0x492477(0xb1))var _0x40abf3=users[_0x492477(0xb1)];else{if(_0x1e500d[0x0][_0x492477(0xac)]=='Arabic\x20(ae)')var _0x40abf3=users[_0x492477(0x191)];}}}}}}}_0x2c8303['render'](_0x492477(0x184),{'success':_0x219f99['flash'](_0x492477(0xff)),'errors':_0x219f99[_0x492477(0xa5)]('errors'),'role':_0x40a352,'profile':_0x32ca6c,'user':_0x9c3909,'stock':_0x50cf13,'master_shop':_0x1e500d,'unit':_0xe4d865,'language':_0x40abf3,'warehouses':warehouse_data,'rooms':_0x35468d});}catch(_0x573874){console['log'](_0x573874),_0x2c8303['status'](0xc8)[_0x492477(0x17a)]({'message':_0x573874['message']});}}),router[a0_0x55d168(0x17d)]('/view/return_sales/:id',auth,async(_0x1b9455,_0x2b98fa)=>{var _0x37dbf0=a0_0x55d168;try{const {invoice:_0x3ed5f3,date:_0x62381a,warehouse_name:_0x4a24d0,product_name:_0x5c285a,primary_code:_0x2a67d0,secondary_code:_0x10795b,product_code:_0x23b073,sales_quantity:_0x2aa427,stocks:_0x9b0172,return_qty:_0x10ca4c,Room_name:_0x40f9b8,to_warehouse_name:_0x594a50,to_Roomname:_0x1f0c05,to_Room_name:_0x2129ea,note:_0xac98d5,level:_0x1695ea,isle:_0x30d218,pallet:_0x41b4fc}=_0x1b9455[_0x37dbf0(0x120)];if(typeof _0x5c285a==_0x37dbf0(0xbd))var _0x48e1e5=[_0x1b9455['body'][_0x37dbf0(0x197)]],_0x18a46e=[_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x110)]],_0x2bd6a6=[_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x186)]],_0x3ee703=[_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x131)]],_0x5d20a1=[_0x1b9455['body'][_0x37dbf0(0x105)]],_0x2ce45a=[_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x179)]],_0x3d2221=[_0x1b9455['body'][_0x37dbf0(0x16d)]],_0x2c2057=[_0x1b9455[_0x37dbf0(0x120)]['bay']],_0x4eace9=[_0x1b9455['body'][_0x37dbf0(0x170)]],_0x209214=[_0x1b9455['body']['types']],_0x1ac4a3=[_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0xdf)]];else var _0x48e1e5=[..._0x1b9455[_0x37dbf0(0x120)]['product_name']],_0x18a46e=[..._0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x110)]],_0x2bd6a6=[..._0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x186)]],_0x3ee703=[..._0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x131)]],_0x5d20a1=[..._0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x105)]],_0x2ce45a=[..._0x1b9455[_0x37dbf0(0x120)]['stocks']],_0x3d2221=[..._0x1b9455[_0x37dbf0(0x120)]['return_qty']],_0x2c2057=[..._0x1b9455['body'][_0x37dbf0(0x9c)]],_0x4eace9=[..._0x1b9455['body']['bin']],_0x209214=[..._0x1b9455[_0x37dbf0(0x120)]['types']],_0x1ac4a3=[..._0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0xdf)]];const _0x56836d=_0x48e1e5[_0x37dbf0(0xcf)](_0x33c6a1=>{return _0x33c6a1={'product_name':_0x33c6a1};});_0x18a46e[_0x37dbf0(0xb8)]((_0x480b88,_0x45b019)=>{var _0x1800f8=_0x37dbf0;_0x56836d[_0x45b019][_0x1800f8(0x110)]=_0x480b88;}),_0x2bd6a6['forEach']((_0x3e9bd6,_0xe1ba88)=>{var _0x120506=_0x37dbf0;_0x56836d[_0xe1ba88][_0x120506(0x186)]=_0x3e9bd6;}),_0x3ee703[_0x37dbf0(0xb8)]((_0x3f2a1e,_0x520468)=>{var _0x4768f7=_0x37dbf0;_0x56836d[_0x520468][_0x4768f7(0x131)]=_0x3f2a1e;}),_0x5d20a1[_0x37dbf0(0xb8)]((_0x1954f2,_0x11e5c5)=>{var _0x19ee33=_0x37dbf0;_0x56836d[_0x11e5c5][_0x19ee33(0x101)]=_0x1954f2;}),_0x2ce45a[_0x37dbf0(0xb8)]((_0xe75388,_0x2e057e)=>{var _0x27e7ee=_0x37dbf0;_0x56836d[_0x2e057e][_0x27e7ee(0x109)]=_0xe75388;}),_0x3d2221[_0x37dbf0(0xb8)]((_0x557179,_0x2f1c37)=>{var _0x3bf265=_0x37dbf0;_0x56836d[_0x2f1c37][_0x3bf265(0x16d)]=_0x557179;}),_0x2c2057[_0x37dbf0(0xb8)]((_0x1b1ddf,_0x310a8c)=>{var _0x4125e6=_0x37dbf0;_0x56836d[_0x310a8c][_0x4125e6(0x9c)]=_0x1b1ddf;}),_0x4eace9['forEach']((_0x2772a0,_0x3917e9)=>{_0x56836d[_0x3917e9]['bin']=_0x2772a0;}),_0x209214[_0x37dbf0(0xb8)]((_0x1de906,_0x686625)=>{var _0x16f800=_0x37dbf0;_0x56836d[_0x686625][_0x16f800(0x12f)]=_0x1de906;}),_0x1ac4a3['forEach']((_0x31718e,_0x50f49b)=>{var _0x5c2530=_0x37dbf0;_0x56836d[_0x50f49b][_0x5c2530(0xdf)]=_0x31718e;});var _0x435278=0x0;_0x56836d[_0x37dbf0(0xb8)](_0x41025e=>{var _0x447811=_0x37dbf0;console[_0x447811(0xfd)](_0x447811(0x140),_0x41025e),(parseInt(_0x41025e[_0x447811(0x101)])<parseInt(_0x41025e[_0x447811(0x16d)])||parseInt(_0x41025e['stock'])<parseInt(_0x41025e[_0x447811(0x16d)])&&parseInt(_0x41025e[_0x447811(0x101)])>parseInt(_0x41025e[_0x447811(0x16d)])||parseInt(_0x41025e[_0x447811(0x16d)])==0x0)&&_0x435278++;});if(_0x435278!=0x0)return _0x1b9455[_0x37dbf0(0xa5)](_0x37dbf0(0xd4),_0x37dbf0(0x145)),_0x2b98fa[_0x37dbf0(0x168)]('back');const _0xccc09b=await sales[_0x37dbf0(0x10c)]({'invoice':_0x3ed5f3});console[_0x37dbf0(0xfd)](_0xccc09b),_0xccc09b[_0x37dbf0(0xa4)]=_0x37dbf0(0x147);const _0x2ba20f=await _0xccc09b[_0x37dbf0(0x166)](),_0x50222b=new sales_return({'invoice':_0x3ed5f3,'customer':_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x15b)],'date':_0x62381a,'warehouse_name':_0x4a24d0,'room':_0x40f9b8,'ToWarehouse':_0x594a50,'ToRoom':_0x2129ea,'return_sale':_0x56836d,'note':_0xac98d5}),_0x56e5dd=await _0x50222b[_0x37dbf0(0x166)]();console[_0x37dbf0(0xfd)](_0x50222b);const _0x25e72b=await sales_return['findOne']({'invoice':_0x3ed5f3}),_0x3b6470=await warehouse[_0x37dbf0(0x10c)]({'name':_0x594a50,'room':_0x2129ea});_0x25e72b[_0x37dbf0(0x184)][_0x37dbf0(0xb8)](_0x32077b=>{var _0x2d844f=_0x37dbf0,_0x3fe394=0x0;const _0x379cd7=_0x3b6470[_0x2d844f(0x9b)][_0x2d844f(0xcf)](_0x2f023c=>{var _0x2031f8=_0x2d844f;_0x2f023c['product_name']==_0x32077b[_0x2031f8(0x197)]&&_0x2f023c['floorlevel']==_0x32077b[_0x2031f8(0xdf)]&&_0x2f023c[_0x2031f8(0x12f)]==_0x32077b[_0x2031f8(0x12f)]&&_0x2f023c[_0x2031f8(0x170)]==_0x32077b[_0x2031f8(0x170)]&&_0x2f023c[_0x2031f8(0x9c)]==_0x32077b['bay']&&(_0x2f023c[_0x2031f8(0xb3)]=parseInt(_0x2f023c[_0x2031f8(0xb3)])+parseInt(_0x32077b[_0x2031f8(0x16d)]),_0x3fe394++);});_0x3fe394=='0'&&(_0x3b6470[_0x2d844f(0x9b)]=_0x3b6470[_0x2d844f(0x9b)][_0x2d844f(0x144)]({'product_name':_0x32077b[_0x2d844f(0x197)],'product_stock':_0x32077b['return_qty'],'primary_code':_0x32077b[_0x2d844f(0x110)],'secondary_code':_0x32077b[_0x2d844f(0x186)],'product_code':_0x32077b['product_code'],'bay':_0x32077b[_0x2d844f(0x9c)],'bin':_0x32077b[_0x2d844f(0x170)],'type':_0x32077b[_0x2d844f(0x12f)],'floorlevel':_0x32077b['floorlevel']})),console[_0x2d844f(0xfd)](_0x2d844f(0x130),_0x3b6470);}),await _0x3b6470[_0x37dbf0(0x166)](),console[_0x37dbf0(0xfd)](_0x1b9455['body']);const _0x1c6e75=new c_payment_data({'invoice':_0x3ed5f3,'customer':_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x15b)],'reason':_0x37dbf0(0xa0)});await _0x1c6e75[_0x37dbf0(0x166)]();const _0xa3c91d=await master_shop[_0x37dbf0(0xfc)]();console[_0x37dbf0(0xfd)](_0x37dbf0(0x143),_0xa3c91d[0x0][_0x37dbf0(0x182)]);const _0x2dae59=await email_settings[_0x37dbf0(0x10c)](),_0x48bfe4=await customer[_0x37dbf0(0x10c)]({'name':_0x1b9455[_0x37dbf0(0x120)][_0x37dbf0(0x15b)]});console['log'](_0x37dbf0(0x10d),_0x48bfe4);_0xa3c91d[0x0][_0x37dbf0(0x174)]==0x1?(right_currency=_0xa3c91d[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xa3c91d[0x0][_0x37dbf0(0xa6)]);var _0x533f0f=_0x48e1e5,_0x292445=_0x3d2221,_0x351b13='',_0x4a5f32;for(_0x4a5f32 in _0x533f0f){_0x351b13+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x533f0f[_0x4a5f32]+_0x37dbf0(0x98)+_0x37dbf0(0x190)+_0x292445[_0x4a5f32]+'</td>'+_0x37dbf0(0x185);}console['log'](_0x37dbf0(0x116),_0x351b13);let _0x5ea96c=nodemailer['createTransport']({'service':_0x37dbf0(0xd5),'auth':{'user':_0x2dae59[_0x37dbf0(0x165)],'pass':_0x2dae59['password']}}),_0x1ed7e3={'from':_0x2dae59[_0x37dbf0(0x165)],'to':_0x48bfe4[_0x37dbf0(0x165)],'subject':_0x37dbf0(0xed),'attachments':[{'filename':_0x37dbf0(0x135),'path':__dirname+_0x37dbf0(0x121)+_0x37dbf0(0x13d)+_0xa3c91d[0x0][_0x37dbf0(0x182)],'cid':_0x37dbf0(0x103)}],'html':'<!DOCTYPE\x20html>'+_0x37dbf0(0x123)+_0x37dbf0(0xc5)+_0x37dbf0(0x187)+_0x37dbf0(0xdd)+_0x37dbf0(0x187)+_0x37dbf0(0x126)+_0x37dbf0(0x154)+_0x37dbf0(0x187)+_0x37dbf0(0x171)+_0xa3c91d[0x0][_0x37dbf0(0xe1)]+_0x37dbf0(0xf0)+_0x37dbf0(0x154)+_0x37dbf0(0x154)+_0x37dbf0(0x159)+_0x37dbf0(0x187)+_0x37dbf0(0x198)+'\x20Order\x20Number\x20:\x20'+_0x3ed5f3+'\x20'+_0x37dbf0(0x129)+_0x37dbf0(0x16a)+_0x62381a+'\x20'+'</span>'+'</h5>'+_0x37dbf0(0x154)+_0x37dbf0(0x160)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x37dbf0(0xc9)+_0x37dbf0(0x18b)+_0x37dbf0(0xbe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x351b13+'\x20'+'</tbody>'+_0x37dbf0(0xa2)+_0x37dbf0(0x187)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0xa3c91d[0x0][_0x37dbf0(0xe1)]+'</h5>'+'</div>'+'</div>'+_0x37dbf0(0x16c)};_0x5ea96c[_0x37dbf0(0x122)](_0x1ed7e3,function(_0x15459d,_0x412e2c){var _0xc0d113=_0x37dbf0;_0x15459d?(console['log'](_0x15459d),console[_0xc0d113(0xfd)]('Error\x20Occurs')):console[_0xc0d113(0xfd)](_0xc0d113(0xea));}),_0x1b9455[_0x37dbf0(0xa5)]('success',_0x37dbf0(0x136)),_0x2b98fa[_0x37dbf0(0x168)](_0x37dbf0(0xe0));}catch(_0x21ed09){console[_0x37dbf0(0xfd)](_0x21ed09),_0x2b98fa[_0x37dbf0(0xd0)](0xc8)[_0x37dbf0(0x17a)]({'message1':_0x21ed09['message']});}}),router[a0_0x55d168(0x19b)]('/barcode/:id',auth,async(_0x10936b,_0xe36b0d)=>{var _0x64725f=a0_0x55d168;try{const {username:_0x49d685,email:_0x57d7d8,role:_0x7ed887}=_0x10936b['user'],_0x388517=_0x10936b[_0x64725f(0x11c)],_0x5b4bb1=await profile['findOne']({'email':_0x388517[_0x64725f(0x165)]}),_0x2c1dd1=await master_shop['find']();console[_0x64725f(0xfd)]('barcode\x20Product\x20master',_0x2c1dd1);const _0x464aa8=_0x10936b[_0x64725f(0xa8)]['id'],_0x249bc8=await sales[_0x64725f(0x19a)](_0x464aa8);console['log']('barcode\x20user_id',_0x249bc8);if(_0x2c1dd1[0x0][_0x64725f(0xac)]=='English\x20(US)')var _0x4ea796=users[_0x64725f(0xe9)];else{if(_0x2c1dd1[0x0]['language']=='Hindi')var _0x4ea796=users[_0x64725f(0xc7)];else{if(_0x2c1dd1[0x0][_0x64725f(0xac)]==_0x64725f(0x13a))var _0x4ea796=users[_0x64725f(0x13a)];else{if(_0x2c1dd1[0x0][_0x64725f(0xac)]==_0x64725f(0x195))var _0x4ea796=users[_0x64725f(0x195)];else{if(_0x2c1dd1[0x0]['language']=='French')var _0x4ea796=users['French'];else{if(_0x2c1dd1[0x0]['language']=='Portuguese\x20(BR)')var _0x4ea796=users['Portuguese'];else{if(_0x2c1dd1[0x0][_0x64725f(0xac)]==_0x64725f(0xb1))var _0x4ea796=users[_0x64725f(0xb1)];else{if(_0x2c1dd1[0x0][_0x64725f(0xac)]=='Arabic\x20(ae)')var _0x4ea796=users[_0x64725f(0x191)];}}}}}}}_0xe36b0d['render']('all_sales_barcode',{'success':_0x10936b[_0x64725f(0xa5)](_0x64725f(0xff)),'errors':_0x10936b[_0x64725f(0xa5)](_0x64725f(0xd4)),'role':_0x388517,'profile':_0x5b4bb1,'alldata':_0x249bc8,'master_shop':_0x2c1dd1,'language':_0x4ea796});}catch(_0x1f9ebd){console[_0x64725f(0xfd)](_0x1f9ebd);}}),router[a0_0x55d168(0x17d)](a0_0x55d168(0xd9),async(_0x3d7bdc,_0x4247f5)=>{var _0x1d4247=a0_0x55d168;const {product_code:_0x11a111,warehouse_name:_0x5f58b9,rooms_data:_0xc8dae4,Roomslist:_0x27e1fa}=_0x3d7bdc[_0x1d4247(0x120)],_0xf6c5fe=_0x27e1fa[_0x1d4247(0xc2)](','),_0x47519a=[];async function _0x3ea53a(_0x23cbc4){var _0x5dce31=_0x1d4247;const _0x2fe52b=await warehouse[_0x5dce31(0x180)]([{'$match':{'name':_0x5f58b9,'room':_0x23cbc4}},{'$unwind':_0x5dce31(0x113)},{'$match':{'product_details.primary_code':_0x11a111}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5dce31(0xaa)},'product_stock':{'$first':_0x5dce31(0xdb)},'primary_code':{'$first':_0x5dce31(0xde)},'secondary_code':{'$first':_0x5dce31(0xd3)},'product_code':{'$first':_0x5dce31(0xc8)},'level':{'$first':_0x5dce31(0x13e)},'isle':{'$first':_0x5dce31(0xcc)},'type':{'$first':_0x5dce31(0x196)},'pallet':{'$first':_0x5dce31(0x10a)},'unit':{'$first':_0x5dce31(0xce)},'secondary_unit':{'$first':_0x5dce31(0x15f)},'storage':{'$first':_0x5dce31(0xf6)},'rack':{'$first':_0x5dce31(0x18e)},'expiry_date':{'$first':_0x5dce31(0x188)},'production_date':{'$first':_0x5dce31(0xd7)},'maxPerUnit':{'$first':_0x5dce31(0x173)},'batch_code':{'$first':_0x5dce31(0x12e)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x5dce31(0x106)},'invoice':{'$first':_0x5dce31(0xae)},'actual_qty':{'$first':'$product_details.actual_qty'}}}]),_0x50fff1=await warehouse['aggregate']([{'$match':{'name':_0x5f58b9,'room':_0x23cbc4}},{'$unwind':_0x5dce31(0x113)},{'$match':{'product_details.secondary_code':_0x11a111}},{'$group':{'_id':_0x5dce31(0xeb),'name':{'$first':_0x5dce31(0xaa)},'product_stock':{'$first':_0x5dce31(0xdb)},'primary_code':{'$first':_0x5dce31(0xde)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5dce31(0xc8)},'level':{'$first':_0x5dce31(0x13e)},'isle':{'$first':_0x5dce31(0xcc)},'type':{'$first':_0x5dce31(0x196)},'pallet':{'$first':_0x5dce31(0x10a)},'unit':{'$first':_0x5dce31(0xce)},'secondary_unit':{'$first':_0x5dce31(0x15f)},'storage':{'$first':_0x5dce31(0xf6)},'rack':{'$first':_0x5dce31(0x18e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5dce31(0xd7)},'maxPerUnit':{'$first':_0x5dce31(0x173)},'batch_code':{'$first':_0x5dce31(0x12e)},'product_cat':{'$first':_0x5dce31(0x172)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2fe52b['length']>0x0)_0x47519a[_0x5dce31(0x102)](_0x2fe52b);else _0x50fff1[_0x5dce31(0xf3)]>0x0&&_0x47519a['push'](_0x50fff1);}const _0x4890de=_0xf6c5fe[_0x1d4247(0xcf)](_0x349bc5=>_0x3ea53a(_0x349bc5));await Promise[_0x1d4247(0xe4)](_0x4890de),_0x4247f5[_0x1d4247(0x17a)](_0x47519a);}),module[a0_0x55d168(0x124)]=router;