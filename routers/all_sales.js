var a0_0x3bbbeb=a0_0x5eed;(function(_0x57104c,_0x3f73c3){var _0x1569cc=a0_0x5eed,_0x3b5ecd=_0x57104c();while(!![]){try{var _0x1266c2=parseInt(_0x1569cc(0x2cd))/0x1*(-parseInt(_0x1569cc(0x28c))/0x2)+parseInt(_0x1569cc(0x20c))/0x3*(-parseInt(_0x1569cc(0x237))/0x4)+parseInt(_0x1569cc(0x24c))/0x5*(-parseInt(_0x1569cc(0x298))/0x6)+-parseInt(_0x1569cc(0x24e))/0x7+parseInt(_0x1569cc(0x27e))/0x8*(parseInt(_0x1569cc(0x222))/0x9)+-parseInt(_0x1569cc(0x253))/0xa*(-parseInt(_0x1569cc(0x226))/0xb)+parseInt(_0x1569cc(0x263))/0xc*(parseInt(_0x1569cc(0x2b6))/0xd);if(_0x1266c2===_0x3f73c3)break;else _0x3b5ecd['push'](_0x3b5ecd['shift']());}catch(_0x3d9765){_0x3b5ecd['push'](_0x3b5ecd['shift']());}}}(a0_0x3460,0x63fa7));function a0_0x5eed(_0x1a711f,_0x263cf2){var _0x34608b=a0_0x3460();return a0_0x5eed=function(_0x5eedcc,_0x2c5034){_0x5eedcc=_0x5eedcc-0x1dc;var _0x3b0023=_0x34608b[_0x5eedcc];return _0x3b0023;},a0_0x5eed(_0x1a711f,_0x263cf2);}const express=require(a0_0x3bbbeb(0x260)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x3bbbeb(0x213)),auth=require(a0_0x3bbbeb(0x240)),nodemailer=require('nodemailer'),users=require(a0_0x3bbbeb(0x20b));router[a0_0x3bbbeb(0x267)](a0_0x3bbbeb(0x21d),auth,async(_0x5f69d1,_0x3ea98f)=>{var _0x50c61d=a0_0x3bbbeb;try{const {username:_0x1fbedd,email:_0x1e2065,role:_0xc20213}=_0x5f69d1[_0x50c61d(0x22c)],_0x58215f=_0x5f69d1[_0x50c61d(0x22c)],_0x3083f3=await profile[_0x50c61d(0x250)]({'email':_0x58215f[_0x50c61d(0x1e7)]}),_0xc99a21=await master_shop[_0x50c61d(0x27f)]();let _0x3bbcdf;if(_0x58215f[_0x50c61d(0x224)]==_0x50c61d(0x214)){const _0x1f138f=await staff[_0x50c61d(0x250)]({'email':_0x58215f[_0x50c61d(0x1e7)]});_0x3bbcdf=await sales[_0x50c61d(0x29e)]([{'$lookup':{'from':_0x50c61d(0x257),'localField':_0x50c61d(0x27b),'foreignField':_0x50c61d(0x29f),'as':_0x50c61d(0x26b)}},{'$unwind':_0x50c61d(0x280)},{'$unwind':_0x50c61d(0x2dc)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x50c61d(0x1f3)},'date':{'$first':_0x50c61d(0x289)},'warehouse_name':{'$first':_0x50c61d(0x204)},'sale_product':{'$push':_0x50c61d(0x2dc)},'note':{'$first':_0x50c61d(0x206)},'return_data':{'$first':_0x50c61d(0x1f8)},'customers_docs':{'$first':_0x50c61d(0x280)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x50c61d(0x23a)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x50c61d(0x297)},'finalize':{'$first':_0x50c61d(0x299)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x3bbcdf=await sales[_0x50c61d(0x29e)]([{'$lookup':{'from':'customers','localField':'customer','foreignField':_0x50c61d(0x29f),'as':_0x50c61d(0x26b)}},{'$unwind':_0x50c61d(0x280)},{'$unwind':_0x50c61d(0x2dc)},{'$group':{'_id':_0x50c61d(0x25f),'invoice':{'$first':_0x50c61d(0x277)},'customers':{'$first':_0x50c61d(0x1f3)},'date':{'$first':_0x50c61d(0x289)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x50c61d(0x2dc)},'note':{'$first':_0x50c61d(0x206)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x50c61d(0x280)},'total_saleproduct_quantity':{'$sum':_0x50c61d(0x28d)},'level':{'$addToSet':_0x50c61d(0x207)},'isle':{'$addToSet':_0x50c61d(0x23a)},'type':{'$addToSet':_0x50c61d(0x2bc)},'pallet':{'$addToSet':_0x50c61d(0x297)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x50c61d(0x1f2)]('sales\x20all_data',_0x3bbcdf);if(_0xc99a21[0x0][_0x50c61d(0x24a)]==_0x50c61d(0x270)){var _0x18811f=users['English'];console[_0x50c61d(0x1f2)](_0x18811f);}else{if(_0xc99a21[0x0]['language']==_0x50c61d(0x268))var _0x18811f=users[_0x50c61d(0x268)];else{if(_0xc99a21[0x0][_0x50c61d(0x24a)]=='German')var _0x18811f=users['German'];else{if(_0xc99a21[0x0][_0x50c61d(0x24a)]==_0x50c61d(0x242))var _0x18811f=users['Spanish'];else{if(_0xc99a21[0x0][_0x50c61d(0x24a)]==_0x50c61d(0x1fb))var _0x18811f=users[_0x50c61d(0x1fb)];else{if(_0xc99a21[0x0][_0x50c61d(0x24a)]=='Portuguese\x20(BR)')var _0x18811f=users[_0x50c61d(0x269)];else{if(_0xc99a21[0x0][_0x50c61d(0x24a)]==_0x50c61d(0x276))var _0x18811f=users['Chinese'];else{if(_0xc99a21[0x0]['language']==_0x50c61d(0x2d7))var _0x18811f=users['Arabic'];}}}}}}}_0x3ea98f[_0x50c61d(0x21b)](_0x50c61d(0x1e0),{'success':_0x5f69d1['flash'](_0x50c61d(0x234)),'errors':_0x5f69d1[_0x50c61d(0x295)](_0x50c61d(0x261)),'sales':_0x3bbcdf,'profile':_0x3083f3,'role':_0x58215f,'master_shop':_0xc99a21,'language':_0x18811f});}catch(_0x1dd6c0){console[_0x50c61d(0x1f2)](_0x1dd6c0);}});async function getRandom8DigitNumber(){var _0x1214e5=a0_0x3bbbeb;const _0x473fc5=0x989680,_0x18027f=0x5f5e0ff,_0xae3771=Math[_0x1214e5(0x275)](Math[_0x1214e5(0x2c4)]()*(_0x18027f-_0x473fc5+0x1))+_0x473fc5;var _0x40749e;const _0x331244=await sales[_0x1214e5(0x250)]({'invoice':_0x1214e5(0x23b)+_0xae3771});return _0x331244&&_0x331244[_0x1214e5(0x2d1)]>0x0?_0x40749e=_0x1214e5(0x23b)+_0xae3771:_0x40749e=_0x1214e5(0x23b)+_0xae3771,_0x40749e;}router[a0_0x3bbbeb(0x267)](a0_0x3bbbeb(0x2cf),auth,async(_0x5cbfc9,_0x40348e)=>{var _0x279d1d=a0_0x3bbbeb;try{const {username:_0x5b775e,email:_0x472320,role:_0xc06c84}=_0x5cbfc9[_0x279d1d(0x22c)],_0x4b26c2=_0x5cbfc9[_0x279d1d(0x22c)],_0x4806f2=await profile[_0x279d1d(0x250)]({'email':_0x4b26c2['email']}),_0x4dc1b1=await master_shop[_0x279d1d(0x27f)](),_0x54fcd0=await customer[_0x279d1d(0x27f)]({});let _0x8bf6f4;if(_0x4b26c2[_0x279d1d(0x224)]==_0x279d1d(0x214)){const _0x4ce7b8=await staff[_0x279d1d(0x250)]({'email':_0x4b26c2[_0x279d1d(0x1e7)]});_0x8bf6f4=await warehouse['aggregate']([{'$match':{'status':_0x279d1d(0x2d5),'name':_0x4ce7b8[_0x279d1d(0x2cb)],'warehouse_category':_0x279d1d(0x2c5),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x279d1d(0x27c)}}},{'$sort':{'name':0x1}}]);}else _0x8bf6f4=await warehouse[_0x279d1d(0x29e)]([{'$match':{'status':_0x279d1d(0x2d5),'warehouse_category':_0x279d1d(0x2c5),'name':{'$ne':_0x279d1d(0x2ae)}}},{'$group':{'_id':'$name','name':{'$first':_0x279d1d(0x27c)}}},{'$sort':{'name':0x1}}]);const _0xe509d0=await product['find']({});var _0x3ffe3f=[_0x279d1d(0x229),_0x279d1d(0x2db)];const _0x172600=await sales[_0x279d1d(0x27f)]({}),_0x24c3dc=_0x172600['length']+0x1,_0xcfcb24=_0x279d1d(0x23b)+_0x24c3dc['toString']()[_0x279d1d(0x2c2)](0x5,'0');if(_0x4dc1b1[0x0]['language']==_0x279d1d(0x270)){var _0xfa8a72=users['English'];console['log'](_0xfa8a72);}else{if(_0x4dc1b1[0x0][_0x279d1d(0x24a)]==_0x279d1d(0x268))var _0xfa8a72=users[_0x279d1d(0x268)];else{if(_0x4dc1b1[0x0]['language']=='German')var _0xfa8a72=users['German'];else{if(_0x4dc1b1[0x0][_0x279d1d(0x24a)]==_0x279d1d(0x242))var _0xfa8a72=users['Spanish'];else{if(_0x4dc1b1[0x0]['language']==_0x279d1d(0x1fb))var _0xfa8a72=users[_0x279d1d(0x1fb)];else{if(_0x4dc1b1[0x0][_0x279d1d(0x24a)]=='Portuguese\x20(BR)')var _0xfa8a72=users[_0x279d1d(0x269)];else{if(_0x4dc1b1[0x0][_0x279d1d(0x24a)]==_0x279d1d(0x276))var _0xfa8a72=users['Chinese'];else{if(_0x4dc1b1[0x0]['language']==_0x279d1d(0x2d7))var _0xfa8a72=users[_0x279d1d(0x20e)];}}}}}}}const _0x1e6830=getRandom8DigitNumber();_0x1e6830['then'](_0x45940c=>{var _0x1c1164=_0x279d1d;_0x40348e[_0x1c1164(0x21b)](_0x1c1164(0x216),{'success':_0x5cbfc9[_0x1c1164(0x295)]('success'),'errors':_0x5cbfc9[_0x1c1164(0x295)](_0x1c1164(0x261)),'role':_0x4b26c2,'profile':_0x4806f2,'customer':_0x54fcd0,'warehouse':_0x8bf6f4,'product':_0xe509d0,'invoice':_0x45940c,'master_shop':_0x4dc1b1,'language':_0xfa8a72,'rooms_data':_0x3ffe3f});})[_0x279d1d(0x230)](_0x539b3f=>{var _0x83d090=_0x279d1d;_0x5cbfc9[_0x83d090(0x295)](_0x83d090(0x261),_0x83d090(0x1f5)),_0x40348e[_0x83d090(0x26d)](_0x83d090(0x1f1));});}catch(_0x344e89){console[_0x279d1d(0x1f2)](_0x344e89);}}),router[a0_0x3bbbeb(0x267)](a0_0x3bbbeb(0x24d),auth,async(_0x2bec12,_0x5380e2)=>{var _0x5d7f4d=a0_0x3bbbeb;try{const _0x29e696=_0x2bec12[_0x5d7f4d(0x221)]['id'];console['log'](_0x29e696);const _0x5715e6=await product[_0x5d7f4d(0x27f)](),_0x2d0f47=await purchases[_0x5d7f4d(0x29e)]([{'$match':{'warehouse_name':_0x29e696}},{'$unwind':_0x5d7f4d(0x208)},{'$group':{'_id':_0x5d7f4d(0x2c9)}}]);console['log']('purchases_data',_0x2d0f47),_0x5380e2[_0x5d7f4d(0x291)](0xc8)[_0x5d7f4d(0x264)]({'purchases_data':_0x2d0f47,'product_data':_0x5715e6});}catch(_0x3ceb29){console[_0x5d7f4d(0x1f2)](_0x3ceb29);}}),router[a0_0x3bbbeb(0x248)]('/view/add_sale/product',auth,async(_0x5ed038,_0x3ee807)=>{var _0x51ee57=a0_0x3bbbeb;try{const {warehouse_data:_0x493849,product_data:_0x5ead20}=_0x5ed038[_0x51ee57(0x1ea)];console[_0x51ee57(0x1f2)](_0x5ed038[_0x51ee57(0x1ea)][_0x51ee57(0x231)]);;const _0x347531=await master_shop[_0x51ee57(0x27f)]();console[_0x51ee57(0x1f2)]('master',_0x347531);const _0x2b3ebb=await product[_0x51ee57(0x250)]({'name':_0x5ead20});console['log'](_0x51ee57(0x211),_0x2b3ebb);const _0xf74102=await warehouse[_0x51ee57(0x29e)]([{'$match':{'name':_0x493849}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x5ead20}},{'$group':{'_id':_0x51ee57(0x271),'product_stock':{'$first':_0x51ee57(0x26a)}}}]);console[_0x51ee57(0x1f2)](_0x51ee57(0x2ad),_0xf74102),_0x3ee807[_0x51ee57(0x291)](0xc8)[_0x51ee57(0x264)]({'master':_0x347531,'new_product':_0x2b3ebb,'stock_data':_0xf74102});}catch(_0x22a9ea){console[_0x51ee57(0x1f2)](_0x22a9ea);}}),router[a0_0x3bbbeb(0x248)]('/view/add_sales',auth,async(_0x470a41,_0x7e5d46)=>{var _0x340ea5=a0_0x3bbbeb;try{const {invoice:_0x167185,date:_0x1aad5f,warehouse_name:_0x57d6dc,product_name:_0x25b38a,stock:_0x58e286,quantity:_0x28d96f,note:_0x5c8f50,room:_0x73d17c,primary_code:_0x36761a,secondary_code:_0x452c11,prod_code:_0x39a3a9,level:_0x449503,isle:_0x58dc8c,pallet:_0x4480de,batch_code:_0x4c0adf,SCRN:_0x20f776,expiry_date:_0x37a149}=_0x470a41['body'];if(typeof _0x25b38a=='string')var _0x198557=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x1ec)]],_0x1d9803=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x24f)]],_0x101a4f=[_0x470a41['body']['carton']],_0x5aab88=[_0x470a41['body'][_0x340ea5(0x2cc)]],_0x39b5fb=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x26c)]],_0x2f471c=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x22d)]],_0x1f0948=[_0x470a41['body']['level']],_0x4ceba0=[_0x470a41['body'][_0x340ea5(0x272)]],_0x51c8d4=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x205)]],_0x1db53e=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x2b1)]],_0x38c22a=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x287)]],_0x2156d5=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x1f0)]],_0x553ef6=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x22b)]],_0x597716=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x217)]],_0x4d4370=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x227)]],_0x93c524=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x2c7)]],_0xdab7f9=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x25b)]],_0x20d81a=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x258)]],_0x3a26fb=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x2a8)]],_0x249adc=[_0x470a41['body']['prod_invoice']],_0xd03027=[_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x27d)]],_0x2eefe3=[_0x470a41['body']['actual_uom']];else var _0x198557=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x1ec)]],_0x1d9803=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x24f)]],_0x101a4f=[..._0x470a41[_0x340ea5(0x1ea)]['carton']],_0x5aab88=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x2cc)]],_0x39b5fb=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x26c)]],_0x2f471c=[..._0x470a41[_0x340ea5(0x1ea)]['prod_code']],_0x1f0948=[..._0x470a41['body'][_0x340ea5(0x1ff)]],_0x4ceba0=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x272)]],_0x51c8d4=[..._0x470a41[_0x340ea5(0x1ea)]['secondary_unit']],_0x1db53e=[..._0x470a41['body'][_0x340ea5(0x2b1)]],_0x38c22a=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x287)]],_0x2156d5=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x1f0)]],_0x553ef6=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x22b)]],_0x597716=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x217)]],_0x4d4370=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x227)]],_0x93c524=[..._0x470a41['body']['delivery_code']],_0xdab7f9=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x25b)]],_0x20d81a=[..._0x470a41[_0x340ea5(0x1ea)]['quantity']],_0x3a26fb=[..._0x470a41[_0x340ea5(0x1ea)]['RoomAssigned']],_0x249adc=[..._0x470a41[_0x340ea5(0x1ea)]['prod_invoice']],_0xd03027=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x27d)]],_0x2eefe3=[..._0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x238)]];const _0x2822b7=_0x198557[_0x340ea5(0x2ac)](_0x32fab3=>{return _0x32fab3={'product_name':_0x32fab3};});_0x1d9803[_0x340ea5(0x256)]((_0x1b5623,_0x156f67)=>{var _0x1e907f=_0x340ea5;_0x2822b7[_0x156f67][_0x1e907f(0x24f)]=Math[_0x1e907f(0x265)](_0x1b5623);}),_0xd03027[_0x340ea5(0x256)]((_0x5c5264,_0x4c0018)=>{var _0x1fd225=_0x340ea5;_0x2822b7[_0x4c0018][_0x1fd225(0x27d)]=Math[_0x1fd225(0x265)](_0x5c5264);}),_0x2eefe3[_0x340ea5(0x256)]((_0x14ba54,_0x357eaa)=>{_0x2822b7[_0x357eaa]['actual_uom']=_0x14ba54;}),_0x101a4f[_0x340ea5(0x256)]((_0x2100d9,_0x533445)=>{_0x2822b7[_0x533445]['quantity']=_0x2100d9;}),_0x5aab88[_0x340ea5(0x256)]((_0x5d239f,_0x46a38e)=>{var _0x1661f8=_0x340ea5;_0x2822b7[_0x46a38e][_0x1661f8(0x2cc)]=_0x5d239f;}),_0x39b5fb[_0x340ea5(0x256)]((_0x236f14,_0x4cb123)=>{var _0x5b87de=_0x340ea5;_0x2822b7[_0x4cb123][_0x5b87de(0x26c)]=_0x236f14;}),_0x2f471c[_0x340ea5(0x256)]((_0x1a6967,_0x2e4e75)=>{var _0x445ba7=_0x340ea5;_0x2822b7[_0x2e4e75][_0x445ba7(0x281)]=_0x1a6967;}),_0x1f0948[_0x340ea5(0x256)]((_0x4b7c28,_0x3018f3)=>{var _0x25084d=_0x340ea5;_0x3a26fb[_0x25084d(0x256)]((_0x4460de,_0x43f3c2)=>{var _0x4f81c0=_0x25084d;if(_0x4460de==_0x4f81c0(0x1eb)&&_0x3018f3==_0x43f3c2){var _0x1b3206=_0x4b7c28[_0x4f81c0(0x29b)](0x3);_0x2822b7[_0x3018f3][_0x4f81c0(0x1f7)]=_0x4b7c28[0x0],_0x2822b7[_0x3018f3]['rack']=_0x4b7c28[0x1],_0x2822b7[_0x3018f3]['bay']=0x0,_0x2822b7[_0x3018f3]['bin']=0x0,_0x2822b7[_0x3018f3][_0x4f81c0(0x2d8)]='Floor',_0x2822b7[_0x3018f3][_0x4f81c0(0x288)]=_0x1b3206;}else{if(_0x4460de==_0x4f81c0(0x1e4)&&_0x3018f3==_0x43f3c2){var _0x1b3206=_0x4b7c28['slice'](0x3);_0x2822b7[_0x3018f3][_0x4f81c0(0x1f7)]=_0x4b7c28[0x0],_0x2822b7[_0x3018f3][_0x4f81c0(0x1fa)]=_0x4b7c28[0x1],_0x2822b7[_0x3018f3][_0x4f81c0(0x2b0)]=0x0,_0x2822b7[_0x3018f3]['bin']=0x0,_0x2822b7[_0x3018f3][_0x4f81c0(0x2d8)]=_0x4f81c0(0x2af),_0x2822b7[_0x3018f3][_0x4f81c0(0x288)]=_0x4b7c28[0x5];}else{if(_0x3018f3==_0x43f3c2){var _0x5edd00;if(_0x4b7c28[0x4]=='L')_0x5edd00=_0x4f81c0(0x2a1);else _0x4b7c28[0x4]=='F'&&(_0x5edd00=_0x4f81c0(0x2af));_0x2822b7[_0x3018f3][_0x4f81c0(0x1f7)]=_0x4b7c28[0x0],_0x2822b7[_0x3018f3][_0x4f81c0(0x1fa)]=_0x4b7c28[0x1],_0x2822b7[_0x3018f3]['bay']=_0x4b7c28[0x2],_0x2822b7[_0x3018f3][_0x4f81c0(0x21e)]=_0x4b7c28[0x3],_0x2822b7[_0x3018f3]['type']=_0x5edd00,_0x2822b7[_0x3018f3][_0x4f81c0(0x288)]=_0x4b7c28[0x5];}}}});}),_0x4ceba0[_0x340ea5(0x256)]((_0x515166,_0x35644f)=>{var _0x230506=_0x340ea5;_0x2822b7[_0x35644f][_0x230506(0x2a0)]=_0x515166;}),_0x51c8d4[_0x340ea5(0x256)]((_0x7465e2,_0x456923)=>{_0x2822b7[_0x456923]['secondary_unit']=_0x7465e2;}),_0x1db53e['forEach']((_0x4887c1,_0x4a81be)=>{var _0x551552=_0x340ea5;_0x2822b7[_0x4a81be][_0x551552(0x2b1)]=_0x4887c1;}),_0x38c22a[_0x340ea5(0x256)]((_0x5ce422,_0x416a46)=>{_0x2822b7[_0x416a46]['expiry_date']=_0x5ce422;}),_0x2156d5[_0x340ea5(0x256)]((_0x49053e,_0x3a56f0)=>{_0x2822b7[_0x3a56f0]['maxperunit']=_0x49053e;}),_0x553ef6['forEach']((_0x2f23cf,_0x501e78)=>{_0x2822b7[_0x501e78]['production_date']=_0x2f23cf;}),_0x597716[_0x340ea5(0x256)]((_0x551a0c,_0x3d5a09)=>{var _0x9e9033=_0x340ea5;_0x2822b7[_0x3d5a09][_0x9e9033(0x217)]=_0x551a0c;}),_0x4d4370['forEach']((_0x3f1c8b,_0x3494eb)=>{_0x2822b7[_0x3494eb]['delivery_date']=_0x3f1c8b;}),_0x93c524[_0x340ea5(0x256)]((_0x15144b,_0x2f2205)=>{var _0x85665=_0x340ea5;_0x2822b7[_0x2f2205][_0x85665(0x2c7)]=_0x15144b;}),_0xdab7f9[_0x340ea5(0x256)]((_0x47120c,_0x587829)=>{var _0x41db8c=_0x340ea5;_0x2822b7[_0x587829][_0x41db8c(0x25b)]=_0x47120c;}),_0x20d81a['forEach']((_0x515572,_0xce4d11)=>{_0x2822b7[_0xce4d11]['quantity_notConverted']=_0x515572;}),_0x3a26fb[_0x340ea5(0x256)]((_0x2be84a,_0x475001)=>{var _0x39c898=_0x340ea5;_0x2822b7[_0x475001][_0x39c898(0x1ee)]=_0x2be84a;}),_0x249adc[_0x340ea5(0x256)]((_0x24c674,_0x2ae8cb)=>{var _0x28c74a=_0x340ea5;_0x2822b7[_0x2ae8cb][_0x28c74a(0x215)]=_0x24c674;});var _0x247333=0x0;_0x2822b7[_0x340ea5(0x256)](_0x202064=>{var _0x112685=_0x340ea5;(_0x202064[_0x112685(0x24f)]<_0x202064[_0x112685(0x2b5)]||_0x202064[_0x112685(0x2b5)]==0x0)&&(console[_0x112685(0x1f2)](_0x112685(0x23c),_0x202064),_0x247333++);});const _0x31804d=_0x2822b7[_0x340ea5(0x2bd)](_0x40e21f=>_0x40e21f[_0x340ea5(0x258)]!=='0'&&_0x40e21f[_0x340ea5(0x258)]!==''),_0x55cd95=new sales({'invoice':_0x167185,'customer':_0x470a41[_0x340ea5(0x1ea)][_0x340ea5(0x27b)],'date':_0x1aad5f,'warehouse_name':_0x57d6dc,'sale_product':_0x31804d,'note':_0x5c8f50,'room':_0x73d17c,'primary_code':_0x36761a,'secondary_code':_0x452c11,'prod_code':_0x39a3a9,'SCRN':_0x20f776}),_0x4a306c=await _0x55cd95[_0x340ea5(0x2ab)]();_0x470a41[_0x340ea5(0x295)](_0x340ea5(0x234),_0x340ea5(0x28b)),_0x7e5d46[_0x340ea5(0x26d)]('/all_sales/preview/'+_0x4a306c[_0x340ea5(0x26e)]);}catch(_0x9f5ddb){console['log'](_0x9f5ddb);}}),router[a0_0x3bbbeb(0x267)](a0_0x3bbbeb(0x2a6),auth,async(_0x49dd8a,_0x173b63)=>{var _0x2b4144=a0_0x3bbbeb;try{const {username:_0x3e527b,email:_0x3ba3c0,role:_0xee86a2}=_0x49dd8a['user'],_0x5384bd=_0x49dd8a[_0x2b4144(0x22c)],_0x445eaa=await profile['findOne']({'email':_0x5384bd[_0x2b4144(0x1e7)]}),_0x18b68e=await master_shop['find'](),_0x16b826=_0x49dd8a[_0x2b4144(0x221)]['id'],_0x486fc4=await sales[_0x2b4144(0x282)](_0x16b826),_0x2c1900=await warehouse[_0x2b4144(0x29e)]([{'$match':{'name':_0x486fc4[_0x2b4144(0x2aa)]}},{'$unwind':_0x2b4144(0x284)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2b4144(0x271)},'product_stock':{'$first':_0x2b4144(0x26a)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2b4144(0x1ef)},'floorlevel':{'$first':_0x2b4144(0x244)},'primary_code':{'$first':_0x2b4144(0x1fe)},'secondary_code':{'$first':_0x2b4144(0x2dd)},'product_code':{'$first':_0x2b4144(0x243)},'storage':{'$first':_0x2b4144(0x247)},'rack':{'$first':_0x2b4144(0x262)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2b4144(0x203)}}}]),_0x369782=await customer[_0x2b4144(0x27f)]({});let _0x9d72d5;if(_0x5384bd[_0x2b4144(0x224)]==_0x2b4144(0x214)){const _0x2c9d3b=await staff[_0x2b4144(0x250)]({'email':_0x5384bd[_0x2b4144(0x1e7)]});_0x9d72d5=await warehouse['aggregate']([{'$match':{'status':_0x2b4144(0x2d5),'name':_0x2c9d3b[_0x2b4144(0x2cb)]}},{'$group':{'_id':_0x2b4144(0x27c),'name':{'$first':_0x2b4144(0x27c)}}}]);}else _0x9d72d5=await warehouse[_0x2b4144(0x29e)]([{'$match':{'status':_0x2b4144(0x2d5)}},{'$group':{'_id':_0x2b4144(0x27c),'name':{'$first':'$name'}}}]);const _0x51e096=await product['find']({}),_0x4ab6bf=await suppliers[_0x2b4144(0x27f)]({});if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x270)){var _0x57211b=users[_0x2b4144(0x279)];console[_0x2b4144(0x1f2)](_0x57211b);}else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]=='Hindi')var _0x57211b=users[_0x2b4144(0x268)];else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x1de))var _0x57211b=users[_0x2b4144(0x1de)];else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x242))var _0x57211b=users['Spanish'];else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x1fb))var _0x57211b=users[_0x2b4144(0x1fb)];else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x283))var _0x57211b=users['Portuguese'];else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x276))var _0x57211b=users[_0x2b4144(0x276)];else{if(_0x18b68e[0x0][_0x2b4144(0x24a)]==_0x2b4144(0x2d7))var _0x57211b=users[_0x2b4144(0x20e)];}}}}}}}_0x173b63[_0x2b4144(0x21b)]('edit_sales_view',{'success':_0x49dd8a[_0x2b4144(0x295)](_0x2b4144(0x234)),'errors':_0x49dd8a[_0x2b4144(0x295)](_0x2b4144(0x261)),'role':_0x5384bd,'profile':_0x445eaa,'customer':_0x369782,'warehouse':_0x9d72d5,'product':_0x2c1900,'user':_0x486fc4,'master_shop':_0x18b68e,'unit':_0x51e096,'language':_0x57211b,'suppliers':_0x4ab6bf});}catch(_0x2744a9){console[_0x2b4144(0x1f2)](_0x2744a9);}}),router[a0_0x3bbbeb(0x248)]('/preview/:id',auth,async(_0x5c35ba,_0x24e423)=>{var _0x5ef4f2=a0_0x3bbbeb;try{const _0xe10308=_0x5c35ba['params']['id'],{invoice:_0x1b203a,warehouse_name:_0x1ef8bc,room:_0x7057b1}=_0x5c35ba[_0x5ef4f2(0x1ea)],_0x3c39b9=await sales[_0x5ef4f2(0x250)]({'invoice':_0x1b203a}),_0x3fd566=_0x3c39b9[_0x5ef4f2(0x2b3)][_0x5ef4f2(0x2ac)](async _0x703124=>{var _0x143ae0=_0x5ef4f2,_0x2bae46=await warehouse[_0x143ae0(0x250)]({'name':_0x1ef8bc,'room':_0x703124[_0x143ae0(0x1ee)],'warehouse_category':_0x143ae0(0x2c5)});const _0x341719=_0x2bae46['product_details'][_0x143ae0(0x2ac)](_0x10fdde=>{var _0x1bb778=_0x143ae0;_0x10fdde[_0x1bb778(0x1ec)]==_0x703124['product_name']&&_0x10fdde[_0x1bb778(0x288)]==_0x703124['floorlevel']&&_0x10fdde['type']==_0x703124[_0x1bb778(0x2d8)]&&_0x10fdde[_0x1bb778(0x21e)]==_0x703124[_0x1bb778(0x21e)]&&_0x10fdde[_0x1bb778(0x2b0)]==_0x703124[_0x1bb778(0x2b0)]&&_0x10fdde[_0x1bb778(0x1fa)]==_0x703124[_0x1bb778(0x1fa)]&&_0x10fdde[_0x1bb778(0x1f7)]==_0x703124['storage']&&_0x10fdde[_0x1bb778(0x287)]==_0x703124[_0x1bb778(0x287)]&&_0x10fdde['batch_code']==_0x703124[_0x1bb778(0x2b1)]&&_0x10fdde['invoice']==_0x703124[_0x1bb778(0x215)]&&(_0x10fdde[_0x1bb778(0x1e2)]=Math[_0x1bb778(0x265)](_0x10fdde[_0x1bb778(0x1e2)])-Math[_0x1bb778(0x265)](_0x703124[_0x1bb778(0x258)]));});return _0x2bae46;});Promise[_0x5ef4f2(0x245)](_0x3fd566)['then'](async _0x592448=>{var _0x11ec41=_0x5ef4f2;try{for(const _0x52ac2a of _0x592448){await _0x52ac2a['save']();}_0x3c39b9[_0x11ec41(0x266)]='True';const _0x56e232=await _0x3c39b9['save'](),_0x15b46f=await master_shop[_0x11ec41(0x27f)](),_0x5a6725=await email_settings[_0x11ec41(0x250)](),_0x238c21=await supervisor_settings[_0x11ec41(0x27f)]();var _0x177772=_0x3c39b9[_0x11ec41(0x2b3)],_0x159ddb='',_0x314264;for(_0x314264 in _0x177772){_0x159ddb+='<tr>'+_0x11ec41(0x2c3)+_0x177772[_0x314264][_0x11ec41(0x1ec)]+_0x11ec41(0x202)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x177772[_0x314264]['product_code']+_0x11ec41(0x202)+_0x11ec41(0x2c3)+_0x177772[_0x314264]['quantity']+_0x11ec41(0x202)+_0x11ec41(0x2c3)+_0x177772[_0x314264]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x177772[_0x314264][_0x11ec41(0x205)]+'</td>'+_0x11ec41(0x2c3)+_0x3c39b9[_0x11ec41(0x2aa)]+_0x11ec41(0x202)+_0x11ec41(0x2c3)+_0x177772[_0x314264][_0x11ec41(0x1ee)]+'</td>'+_0x11ec41(0x2c3)+_0x177772[_0x314264]['storage']+_0x177772[_0x314264]['rack']+_0x177772[_0x314264]['bay']+_0x177772[_0x314264][_0x11ec41(0x21e)]+_0x177772[_0x314264]['type'][0x0]+_0x177772[_0x314264][_0x11ec41(0x288)]+_0x11ec41(0x202),_0x11ec41(0x225);}let _0x5de0bc=nodemailer[_0x11ec41(0x2b4)]({'host':_0x5a6725['host'],'port':Number(_0x5a6725[_0x11ec41(0x2a9)]),'secure':![],'auth':{'user':_0x5a6725['email'],'pass':_0x5a6725[_0x11ec41(0x29a)]}}),_0x4f385a={'from':_0x5a6725['email'],'to':_0x238c21[0x0][_0x11ec41(0x2c0)],'subject':_0x11ec41(0x2a4),'attachments':[{'filename':_0x11ec41(0x2de),'path':__dirname+'/../public'+_0x11ec41(0x1df)+_0x15b46f[0x0][_0x11ec41(0x25c)],'cid':_0x11ec41(0x1dc)}],'html':_0x11ec41(0x1f6)+_0x11ec41(0x219)+_0x11ec41(0x255)+_0x11ec41(0x20a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x11ec41(0x20a)+_0x11ec41(0x2a7)+_0x11ec41(0x1e9)+_0x11ec41(0x20a)+_0x11ec41(0x1fc)+_0x15b46f[0x0]['site_title']+'\x20</h2>'+_0x11ec41(0x1e9)+_0x11ec41(0x1e9)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x11ec41(0x28e)+_0x11ec41(0x1e6)+_0x3c39b9[_0x11ec41(0x215)]+'\x20'+_0x11ec41(0x1e8)+_0x11ec41(0x2be)+_0x3c39b9[_0x11ec41(0x228)]+'\x20'+_0x11ec41(0x2d6)+_0x11ec41(0x2b8)+_0x11ec41(0x1e9)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x11ec41(0x274)+'<tr>'+_0x11ec41(0x22a)+_0x11ec41(0x25e)+_0x11ec41(0x1fd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x11ec41(0x2da)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x11ec41(0x225)+_0x11ec41(0x2b7)+_0x11ec41(0x252)+'\x20'+_0x159ddb+'\x20'+_0x11ec41(0x23d)+_0x11ec41(0x2b9)+_0x11ec41(0x20a)+_0x11ec41(0x23e)+_0x11ec41(0x254)+_0x15b46f[0x0][_0x11ec41(0x20d)]+'</h5>'+'</div>'+_0x11ec41(0x1e9)+_0x11ec41(0x278)};_0x5de0bc[_0x11ec41(0x290)](_0x4f385a,function(_0x7eb3c4,_0x43237a){var _0x190895=_0x11ec41;_0x7eb3c4?(console[_0x190895(0x1f2)](_0x7eb3c4),console[_0x190895(0x1f2)](_0x190895(0x1ed))):console['log'](_0x190895(0x292));}),_0x5c35ba['flash'](_0x11ec41(0x234),_0x11ec41(0x273)),_0x24e423[_0x11ec41(0x26d)]('/all_sales/preview/'+_0xe10308);}catch(_0x45bec9){console[_0x11ec41(0x29d)](_0x45bec9),_0x24e423['status'](0x1f4)['json']({'error':_0x11ec41(0x25a)});}})[_0x5ef4f2(0x230)](_0x2313a7=>{var _0x34a7f6=_0x5ef4f2;console['error'](_0x2313a7),_0x24e423[_0x34a7f6(0x291)](0x1f4)[_0x34a7f6(0x264)]({'error':_0x34a7f6(0x2bb)});});}catch(_0x324d7c){console[_0x5ef4f2(0x1f2)](_0x324d7c);}}),router[a0_0x3bbbeb(0x267)](a0_0x3bbbeb(0x285),auth,async(_0x1428e9,_0x1daa03)=>{var _0x3d51ef=a0_0x3bbbeb;try{const {username:_0x323841,email:_0xaa261f,role:_0x20ec5b}=_0x1428e9[_0x3d51ef(0x22c)],_0x19cbd7=_0x1428e9[_0x3d51ef(0x22c)],_0x5e61ff=await profile[_0x3d51ef(0x250)]({'email':_0x19cbd7['email']}),_0x16495c=await master_shop['find'](),_0x5372d8=_0x1428e9[_0x3d51ef(0x221)]['id'],_0x167de2=await sales[_0x3d51ef(0x282)](_0x5372d8);var _0x4ad495=['Ambient',_0x3d51ef(0x2db)];const _0x1be0bd=await warehouse['aggregate']([{'$match':{'name':_0x167de2[_0x3d51ef(0x2aa)],'warehouse_category':_0x3d51ef(0x2c5)}},{'$unwind':_0x3d51ef(0x284)},{'$group':{'_id':_0x3d51ef(0x236),'name':{'$first':_0x3d51ef(0x271)},'product_stock':{'$first':_0x3d51ef(0x26a)},'bay':{'$first':_0x3d51ef(0x259)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3d51ef(0x1ef)},'floorlevel':{'$first':_0x3d51ef(0x244)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3d51ef(0x243)},'storage':{'$first':_0x3d51ef(0x247)},'rack':{'$first':_0x3d51ef(0x262)}}}]),_0x33ca20=await customer[_0x3d51ef(0x27f)]({});let _0x3b0d53;if(_0x19cbd7[_0x3d51ef(0x224)]==_0x3d51ef(0x214)){const _0x428a6c=await staff[_0x3d51ef(0x250)]({'email':_0x19cbd7[_0x3d51ef(0x1e7)]});_0x3b0d53=await warehouse[_0x3d51ef(0x29e)]([{'$match':{'status':_0x3d51ef(0x2d5),'name':_0x428a6c['warehouse'],'warehouse_category':_0x3d51ef(0x2c5)}},{'$group':{'_id':'$name','name':{'$first':_0x3d51ef(0x27c)}}}]);}else _0x3b0d53=await warehouse['aggregate']([{'$match':{'status':_0x3d51ef(0x2d5),'warehouse_category':_0x3d51ef(0x2c5)}},{'$group':{'_id':_0x3d51ef(0x27c),'name':{'$first':'$name'}}}]);const _0x5f4503=await product[_0x3d51ef(0x27f)]({});if(_0x16495c[0x0][_0x3d51ef(0x24a)]==_0x3d51ef(0x270)){var _0x3732cd=users['English'];console[_0x3d51ef(0x1f2)](_0x3732cd);}else{if(_0x16495c[0x0][_0x3d51ef(0x24a)]==_0x3d51ef(0x268))var _0x3732cd=users[_0x3d51ef(0x268)];else{if(_0x16495c[0x0][_0x3d51ef(0x24a)]==_0x3d51ef(0x1de))var _0x3732cd=users[_0x3d51ef(0x1de)];else{if(_0x16495c[0x0][_0x3d51ef(0x24a)]==_0x3d51ef(0x242))var _0x3732cd=users[_0x3d51ef(0x242)];else{if(_0x16495c[0x0][_0x3d51ef(0x24a)]==_0x3d51ef(0x1fb))var _0x3732cd=users[_0x3d51ef(0x1fb)];else{if(_0x16495c[0x0]['language']=='Portuguese\x20(BR)')var _0x3732cd=users['Portuguese'];else{if(_0x16495c[0x0]['language']=='Chinese')var _0x3732cd=users['Chinese'];else{if(_0x16495c[0x0][_0x3d51ef(0x24a)]==_0x3d51ef(0x2d7))var _0x3732cd=users[_0x3d51ef(0x20e)];}}}}}}}_0x1daa03['render'](_0x3d51ef(0x210),{'success':_0x1428e9[_0x3d51ef(0x295)]('success'),'errors':_0x1428e9['flash'](_0x3d51ef(0x261)),'role':_0x19cbd7,'profile':_0x5e61ff,'customer':_0x33ca20,'warehouse':_0x3b0d53,'product':_0x1be0bd,'user':_0x167de2,'master_shop':_0x16495c,'unit':_0x5f4503,'language':_0x3732cd});}catch(_0x5b5aae){console['log'](_0x5b5aae);}}),router[a0_0x3bbbeb(0x248)](a0_0x3bbbeb(0x285),auth,async(_0x440395,_0x537f74)=>{var _0x322d5d=a0_0x3bbbeb;try{const _0x35a299=_0x440395['params']['id'],_0x2e8583=await sales['findOne']({'_id':_0x440395[_0x322d5d(0x221)]['id']}),_0x24b369=await warehouse[_0x322d5d(0x250)]({'name':_0x2e8583['warehouse_name'],'room':_0x440395['body']['room']}),{invoice:_0x4de676,date:_0x4d2730,warehouse_name:_0x52e7a4,product_name:_0x5049e8,stock:_0x363f19,quantity:_0x5e2a30,note:_0x5d5c9d,room:_0x3a3b48,customer:_0x27564f,SCRN:_0x57a2b7}=_0x440395[_0x322d5d(0x1ea)];if(typeof _0x5049e8==_0x322d5d(0x22f))var _0x37cd92=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x1ec)]],_0x453be9=[_0x440395['body']['stock']],_0x4a3ee4=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x25d)]],_0x31d13b=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x2cc)]],_0x49bbd9=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x26c)]],_0x13d2a1=[_0x440395[_0x322d5d(0x1ea)]['prod_code']],_0x1b4ea5=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x1ff)]],_0x1cb175=[_0x440395[_0x322d5d(0x1ea)]['primary_unit']],_0x2df908=[_0x440395['body']['secondary_unit']],_0x1b31b7=[_0x440395[_0x322d5d(0x1ea)]['batch_code']],_0x42186c=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x287)]],_0x2b2261=[_0x440395[_0x322d5d(0x1ea)]['max_per_unit']],_0x569f91=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x22b)]],_0x95677a=[_0x440395['body']['requested_qty']],_0x1ac236=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x227)]],_0x1dfe1a=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x2c7)]],_0x2f2c32=[_0x440395['body'][_0x322d5d(0x25b)]],_0x362dcd=[_0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x258)]],_0x10aadf=[_0x440395[_0x322d5d(0x1ea)]['RoomAssigned']];else var _0x37cd92=[..._0x440395[_0x322d5d(0x1ea)]['product_name']],_0x453be9=[..._0x440395['body'][_0x322d5d(0x24f)]],_0x4a3ee4=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x25d)]],_0x31d13b=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x2cc)]],_0x49bbd9=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x26c)]],_0x13d2a1=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x22d)]],_0x1b4ea5=[..._0x440395['body'][_0x322d5d(0x1ff)]],_0x1cb175=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x272)]],_0x2df908=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x205)]],_0x1b31b7=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x2b1)]],_0x42186c=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x287)]],_0x2b2261=[..._0x440395['body'][_0x322d5d(0x1f0)]],_0x569f91=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x22b)]],_0x95677a=[..._0x440395[_0x322d5d(0x1ea)][_0x322d5d(0x217)]],_0x1ac236=[..._0x440395['body'][_0x322d5d(0x227)]],_0x1dfe1a=[..._0x440395[_0x322d5d(0x1ea)]['delivery_code']],_0x2f2c32=[..._0x440395[_0x322d5d(0x1ea)]['prod_cat']],_0x362dcd=[..._0x440395[_0x322d5d(0x1ea)]['quantity']],_0x10aadf=[..._0x440395[_0x322d5d(0x1ea)]['RoomAssigned']];const _0x504134=_0x37cd92[_0x322d5d(0x2ac)](_0xdd1489=>{return _0xdd1489={'product_name':_0xdd1489};});_0x453be9[_0x322d5d(0x256)]((_0x548ce3,_0x179f9e)=>{var _0x57c3c1=_0x322d5d;_0x504134[_0x179f9e][_0x57c3c1(0x24f)]=Math[_0x57c3c1(0x265)](_0x548ce3);}),_0x4a3ee4[_0x322d5d(0x256)]((_0x1bfcdf,_0x48afa9)=>{var _0x4d85c7=_0x322d5d;_0x504134[_0x48afa9][_0x4d85c7(0x258)]=_0x1bfcdf;}),_0x31d13b[_0x322d5d(0x256)]((_0x58232c,_0x4e7584)=>{var _0x56fa8f=_0x322d5d;_0x504134[_0x4e7584][_0x56fa8f(0x2cc)]=_0x58232c;}),_0x49bbd9['forEach']((_0x226674,_0x58780f)=>{var _0x278710=_0x322d5d;_0x504134[_0x58780f][_0x278710(0x26c)]=_0x226674;}),_0x13d2a1[_0x322d5d(0x256)]((_0x524345,_0x8b24dd)=>{_0x504134[_0x8b24dd]['product_code']=_0x524345;}),_0x1b4ea5[_0x322d5d(0x256)]((_0x404621,_0x4df9c0)=>{_0x10aadf['forEach']((_0x663f58,_0x586097)=>{var _0x54c809=a0_0x5eed;if(_0x663f58=='Receiving\x20Area'&&_0x4df9c0==_0x586097){var _0x3193d1=_0x404621[_0x54c809(0x29b)](0x3);_0x504134[_0x4df9c0][_0x54c809(0x1f7)]=_0x404621[0x0],_0x504134[_0x4df9c0][_0x54c809(0x1fa)]=_0x404621[0x1],_0x504134[_0x4df9c0]['bay']=0x0,_0x504134[_0x4df9c0][_0x54c809(0x21e)]=0x0,_0x504134[_0x4df9c0][_0x54c809(0x2d8)]=_0x54c809(0x2af),_0x504134[_0x4df9c0]['floorlevel']=_0x3193d1;}else{if(_0x663f58=='Shelves'&&_0x4df9c0==_0x586097){var _0x3193d1=_0x404621[_0x54c809(0x29b)](0x3);_0x504134[_0x4df9c0]['storage']=_0x404621[0x0],_0x504134[_0x4df9c0][_0x54c809(0x1fa)]=_0x404621[0x1],_0x504134[_0x4df9c0][_0x54c809(0x2b0)]=0x0,_0x504134[_0x4df9c0][_0x54c809(0x21e)]=0x0,_0x504134[_0x4df9c0]['type']=_0x54c809(0x2af),_0x504134[_0x4df9c0][_0x54c809(0x288)]=_0x404621[0x5];}else{if(_0x4df9c0==_0x586097){var _0x419719;if(_0x404621[0x4]=='L')_0x419719=_0x54c809(0x2a1);else _0x404621[0x4]=='F'&&(_0x419719=_0x54c809(0x2af));_0x504134[_0x4df9c0][_0x54c809(0x1f7)]=_0x404621[0x0],_0x504134[_0x4df9c0][_0x54c809(0x1fa)]=_0x404621[0x1],_0x504134[_0x4df9c0][_0x54c809(0x2b0)]=_0x404621[0x2],_0x504134[_0x4df9c0][_0x54c809(0x21e)]=_0x404621[0x3],_0x504134[_0x4df9c0][_0x54c809(0x2d8)]=_0x419719,_0x504134[_0x4df9c0][_0x54c809(0x288)]=_0x404621[0x5];}}}});}),_0x1cb175[_0x322d5d(0x256)]((_0x39684f,_0x28e4bc)=>{var _0xeaf29b=_0x322d5d;_0x504134[_0x28e4bc][_0xeaf29b(0x2a0)]=_0x39684f;}),_0x2df908[_0x322d5d(0x256)]((_0x315831,_0x3f1c16)=>{var _0x41b822=_0x322d5d;_0x504134[_0x3f1c16][_0x41b822(0x205)]=_0x315831;}),_0x1b31b7[_0x322d5d(0x256)]((_0x5d8b9f,_0x47dec2)=>{var _0x96da52=_0x322d5d;_0x504134[_0x47dec2][_0x96da52(0x2b1)]=_0x5d8b9f;}),_0x42186c[_0x322d5d(0x256)]((_0x403fef,_0x3ec495)=>{_0x504134[_0x3ec495]['expiry_date']=_0x403fef;}),_0x2b2261[_0x322d5d(0x256)]((_0x544bab,_0x4b3d70)=>{var _0x5c4832=_0x322d5d;_0x504134[_0x4b3d70][_0x5c4832(0x2b2)]=_0x544bab;}),_0x569f91[_0x322d5d(0x256)]((_0x1c3855,_0x76bab4)=>{var _0x2de973=_0x322d5d;_0x504134[_0x76bab4][_0x2de973(0x22b)]=_0x1c3855;}),_0x95677a[_0x322d5d(0x256)]((_0x91937a,_0x26ca8c)=>{var _0x50571f=_0x322d5d;_0x504134[_0x26ca8c][_0x50571f(0x217)]=Math[_0x50571f(0x265)](_0x91937a);}),_0x1ac236[_0x322d5d(0x256)]((_0x3d9e9b,_0x1130c5)=>{var _0x42e222=_0x322d5d;_0x504134[_0x1130c5][_0x42e222(0x227)]=_0x3d9e9b;}),_0x1dfe1a['forEach']((_0x183358,_0x5d60d8)=>{var _0xc414ef=_0x322d5d;_0x504134[_0x5d60d8][_0xc414ef(0x2c7)]=_0x183358;}),_0x2f2c32['forEach']((_0x557043,_0x10a9b8)=>{var _0x3cfe1d=_0x322d5d;_0x504134[_0x10a9b8][_0x3cfe1d(0x25b)]=_0x557043;}),_0x362dcd[_0x322d5d(0x256)]((_0x473859,_0x30d997)=>{var _0x4b2966=_0x322d5d;_0x504134[_0x30d997][_0x4b2966(0x2b5)]=_0x473859;}),_0x10aadf[_0x322d5d(0x256)]((_0x2aec11,_0xfb5d58)=>{_0x504134[_0xfb5d58]['room_name']=_0x2aec11;});var _0x2e491d=0x0;_0x504134['forEach'](_0x48500f=>{var _0x59db37=_0x322d5d;console[_0x59db37(0x1f2)](_0x59db37(0x23c),_0x48500f),(parseInt(_0x48500f['stock'])<parseInt(_0x48500f[_0x59db37(0x258)])||parseInt(_0x48500f[_0x59db37(0x258)])==0x0)&&_0x2e491d++;});if(_0x2e491d!=0x0)return _0x440395[_0x322d5d(0x295)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x537f74[_0x322d5d(0x26d)]('back');const _0x26daf=_0x504134['filter'](_0x55c84e=>_0x55c84e[_0x322d5d(0x258)]!=='0'&&_0x55c84e['quantity']!=='');_0x2e8583[_0x322d5d(0x215)]=_0x4de676,_0x2e8583[_0x322d5d(0x27b)]=_0x27564f,_0x2e8583['date']=_0x4d2730,_0x2e8583[_0x322d5d(0x2aa)]=_0x52e7a4,_0x2e8583['sale_product']=_0x26daf,_0x2e8583[_0x322d5d(0x286)]=_0x5d5c9d,_0x2e8583[_0x322d5d(0x2bf)]=_0x57a2b7,_0x2e8583[_0x322d5d(0x266)]='False',_0x2e8583[_0x322d5d(0x2d3)]=_0x322d5d(0x21a);const _0x1f0139=await _0x2e8583[_0x322d5d(0x2ab)]();_0x440395[_0x322d5d(0x295)](_0x322d5d(0x234),'Sales\x20Update\x20successfully'),_0x537f74['redirect'](_0x322d5d(0x1f1));}catch(_0x43e88d){console['log'](_0x43e88d);}}),router[a0_0x3bbbeb(0x248)]('/give_payment/:id',auth,async(_0x3bcbcd,_0x591cd4)=>{var _0x4fa599=a0_0x3bbbeb;try{const _0x14a8c7=_0x3bcbcd[_0x4fa599(0x221)]['id'],{invoice:_0x3d571a,customer:_0x158ee4,receivable_amount:_0x4b8b37,received_amount:_0x37bca4}=_0x3bcbcd['body'],_0x158d6e=await sales[_0x4fa599(0x282)](_0x14a8c7);console[_0x4fa599(0x1f2)](_0x158d6e);var _0x4b5bb0=_0x4b8b37-_0x37bca4;console[_0x4fa599(0x1f2)](_0x37bca4),_0x158d6e['received_amount']=parseFloat(_0x37bca4)+parseFloat(_0x158d6e[_0x4fa599(0x239)]),_0x158d6e[_0x4fa599(0x2a2)]=_0x4b5bb0,console[_0x4fa599(0x1f2)](_0x158d6e);const _0x10893f=await _0x158d6e[_0x4fa599(0x2ab)](),_0x778326=await c_payment_data['findOne']({'invoice':_0x3d571a});_0x778326[_0x4fa599(0x21f)]=_0x4b5bb0,await _0x778326[_0x4fa599(0x2ab)]();let _0x2ecc11=new Date(),_0x339d37=('0'+_0x2ecc11['getDate']())[_0x4fa599(0x29b)](-0x2),_0xc1dc84=('0'+(_0x2ecc11[_0x4fa599(0x218)]()+0x1))['slice'](-0x2),_0x1f6d87=_0x2ecc11[_0x4fa599(0x2c1)](),_0x1e165a=_0x1f6d87+'-'+_0xc1dc84+'-'+_0x339d37;const _0x335fd5=new customer_payment({'invoice':_0x3d571a,'date':_0x1f6d87+'-'+_0xc1dc84+'-'+_0x339d37,'customer':_0x158ee4,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0x37bca4}),_0x2ef369=await _0x335fd5[_0x4fa599(0x2ab)]();_0x3bcbcd[_0x4fa599(0x295)]('success',_0x4fa599(0x2ce)),_0x591cd4[_0x4fa599(0x26d)](_0x4fa599(0x1f1));}catch(_0x4897d9){console[_0x4fa599(0x1f2)](_0x4897d9);}}),router['get']('/invoice/:id',auth,async(_0x47d5be,_0x23ec64)=>{var _0x5abc34=a0_0x3bbbeb;try{const {username:_0x8be503,email:_0x34c5ec,role:_0x2b71d5}=_0x47d5be[_0x5abc34(0x22c)],_0x359eaf=_0x47d5be[_0x5abc34(0x22c)],_0x5a0efe=await profile['findOne']({'email':_0x359eaf[_0x5abc34(0x1e7)]}),_0x52413f=await master_shop['find']();console['log']('master',_0x52413f);const _0x3d1db4=_0x47d5be[_0x5abc34(0x221)]['id'],_0x216840=await sales[_0x5abc34(0x282)](_0x3d1db4);console[_0x5abc34(0x1f2)](_0x216840);const _0x16e0fe=await customer[_0x5abc34(0x250)]({'name':_0x216840[_0x5abc34(0x27b)]});console[_0x5abc34(0x1f2)](_0x16e0fe);if(_0x52413f[0x0][_0x5abc34(0x24a)]==_0x5abc34(0x270)){var _0x39076b=users[_0x5abc34(0x279)];console[_0x5abc34(0x1f2)](_0x39076b);}else{if(_0x52413f[0x0]['language']=='Hindi')var _0x39076b=users['Hindi'];else{if(_0x52413f[0x0][_0x5abc34(0x24a)]==_0x5abc34(0x1de))var _0x39076b=users[_0x5abc34(0x1de)];else{if(_0x52413f[0x0][_0x5abc34(0x24a)]==_0x5abc34(0x242))var _0x39076b=users[_0x5abc34(0x242)];else{if(_0x52413f[0x0][_0x5abc34(0x24a)]=='French')var _0x39076b=users[_0x5abc34(0x1fb)];else{if(_0x52413f[0x0][_0x5abc34(0x24a)]==_0x5abc34(0x283))var _0x39076b=users[_0x5abc34(0x269)];else{if(_0x52413f[0x0][_0x5abc34(0x24a)]==_0x5abc34(0x276))var _0x39076b=users['Chinese'];else{if(_0x52413f[0x0][_0x5abc34(0x24a)]=='Arabic\x20(ae)')var _0x39076b=users[_0x5abc34(0x20e)];}}}}}}}_0x23ec64[_0x5abc34(0x21b)]('sales_invoice',{'success':_0x47d5be['flash'](_0x5abc34(0x234)),'errors':_0x47d5be[_0x5abc34(0x295)](_0x5abc34(0x261)),'role':_0x359eaf,'profile':_0x5a0efe,'master_shop':_0x52413f,'customers':_0x16e0fe,'sales':_0x216840,'language':_0x39076b});}catch(_0x14ec8c){console[_0x5abc34(0x1f2)](_0x14ec8c);}}),router[a0_0x3bbbeb(0x267)](a0_0x3bbbeb(0x28a),auth,async(_0x36131c,_0xd78cc8)=>{var _0x2a61bc=a0_0x3bbbeb;try{const {username:_0x4a2439,email:_0x3d62a0,role:_0x493bd7}=_0x36131c['user'],_0x25d0b5=_0x36131c[_0x2a61bc(0x22c)],_0x2dc6cf=await profile[_0x2a61bc(0x250)]({'email':_0x25d0b5['email']}),_0x2e6b13=await master_shop[_0x2a61bc(0x27f)]();console['log'](_0x2a61bc(0x29c),_0x2e6b13);const _0x322cf0=_0x36131c['params']['id'];console[_0x2a61bc(0x1f2)](_0x322cf0);const _0x45106d=await sales[_0x2a61bc(0x282)](_0x322cf0);console['log'](_0x2a61bc(0x2a5),_0x45106d);const _0x5c93db=await warehouse[_0x2a61bc(0x29e)]([{'$match':{'name':_0x2a61bc(0x2ae),'room':'Return\x20Rooms'}},{'$unwind':_0x2a61bc(0x284)},{'$group':{'_id':_0x2a61bc(0x236),'name':{'$first':_0x2a61bc(0x271)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x2a61bc(0x28f)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x2a61bc(0x1fe)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2a61bc(0x243)}}}]);console[_0x2a61bc(0x1f2)](_0x2a61bc(0x2ad),_0x5c93db);const _0x2a4c72=await product['find']({});warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2a61bc(0x27c),'name':{'$first':_0x2a61bc(0x27c)}}},{'$sort':{'name':0x1}}]);var _0x293088=['Return\x20Rooms'];if(_0x2e6b13[0x0]['language']=='English\x20(US)'){var _0x5ca23a=users[_0x2a61bc(0x279)];console[_0x2a61bc(0x1f2)](_0x5ca23a);}else{if(_0x2e6b13[0x0][_0x2a61bc(0x24a)]==_0x2a61bc(0x268))var _0x5ca23a=users[_0x2a61bc(0x268)];else{if(_0x2e6b13[0x0][_0x2a61bc(0x24a)]==_0x2a61bc(0x1de))var _0x5ca23a=users[_0x2a61bc(0x1de)];else{if(_0x2e6b13[0x0][_0x2a61bc(0x24a)]==_0x2a61bc(0x242))var _0x5ca23a=users[_0x2a61bc(0x242)];else{if(_0x2e6b13[0x0][_0x2a61bc(0x24a)]==_0x2a61bc(0x1fb))var _0x5ca23a=users[_0x2a61bc(0x1fb)];else{if(_0x2e6b13[0x0][_0x2a61bc(0x24a)]=='Portuguese\x20(BR)')var _0x5ca23a=users[_0x2a61bc(0x269)];else{if(_0x2e6b13[0x0][_0x2a61bc(0x24a)]==_0x2a61bc(0x276))var _0x5ca23a=users[_0x2a61bc(0x276)];else{if(_0x2e6b13[0x0]['language']==_0x2a61bc(0x2d7))var _0x5ca23a=users[_0x2a61bc(0x20e)];}}}}}}}_0xd78cc8['render'](_0x2a61bc(0x1e5),{'success':_0x36131c[_0x2a61bc(0x295)]('success'),'errors':_0x36131c[_0x2a61bc(0x295)](_0x2a61bc(0x261)),'role':_0x25d0b5,'profile':_0x2dc6cf,'user':_0x45106d,'stock':_0x5c93db,'master_shop':_0x2e6b13,'unit':_0x2a4c72,'language':_0x5ca23a,'warehouses':warehouse_data,'rooms':_0x293088});}catch(_0x44f557){console[_0x2a61bc(0x1f2)](_0x44f557),_0xd78cc8[_0x2a61bc(0x291)](0xc8)[_0x2a61bc(0x264)]({'message':_0x44f557[_0x2a61bc(0x2d4)]});}}),router['post'](a0_0x3bbbeb(0x28a),auth,async(_0x5cf5e5,_0x3840a1)=>{var _0x3a0431=a0_0x3bbbeb;try{const {invoice:_0x2a5a8c,date:_0x39e0e2,warehouse_name:_0x282f18,product_name:_0x3f4e48,primary_code:_0x419e50,secondary_code:_0x1b98d0,product_code:_0x17a8a7,sales_quantity:_0x8f08aa,stocks:_0x4717a7,return_qty:_0x1b1424,Room_name:_0x3cc51c,to_warehouse_name:_0xa409ed,to_Roomname:_0x8cba29,to_Room_name:_0x3bb009,note:_0x3a2f18,level:_0x3d1176,isle:_0x32f962,pallet:_0x3b3fc3}=_0x5cf5e5[_0x3a0431(0x1ea)];if(typeof _0x3f4e48=='string')var _0x5bc95a=[_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x1ec)]],_0x79e8ed=[_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x2cc)]],_0x2ea069=[_0x5cf5e5['body'][_0x3a0431(0x26c)]],_0x3e6f8f=[_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x281)]],_0x135135=[_0x5cf5e5['body'][_0x3a0431(0x293)]],_0x3945fd=[_0x5cf5e5[_0x3a0431(0x1ea)]['stocks']],_0x54b21d=[_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x20f)]],_0x100dcf=[_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x2b0)]],_0x5b4959=[_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x21e)]],_0x2c2ee4=[_0x5cf5e5[_0x3a0431(0x1ea)]['types']],_0x1a9608=[_0x5cf5e5[_0x3a0431(0x1ea)]['floorlevel']];else var _0x5bc95a=[..._0x5cf5e5['body']['product_name']],_0x79e8ed=[..._0x5cf5e5[_0x3a0431(0x1ea)]['primary_code']],_0x2ea069=[..._0x5cf5e5['body'][_0x3a0431(0x26c)]],_0x3e6f8f=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x281)]],_0x135135=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x293)]],_0x3945fd=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x200)]],_0x54b21d=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x20f)]],_0x100dcf=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x2b0)]],_0x5b4959=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x21e)]],_0x2c2ee4=[..._0x5cf5e5['body'][_0x3a0431(0x2ba)]],_0x1a9608=[..._0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x288)]];const _0x4b5673=_0x5bc95a['map'](_0xa8c88d=>{return _0xa8c88d={'product_name':_0xa8c88d};});_0x79e8ed['forEach']((_0x351c2c,_0x1f4cb3)=>{var _0x24fa93=_0x3a0431;_0x4b5673[_0x1f4cb3][_0x24fa93(0x2cc)]=_0x351c2c;}),_0x2ea069[_0x3a0431(0x256)]((_0x56576e,_0x22be33)=>{var _0x4d0d3a=_0x3a0431;_0x4b5673[_0x22be33][_0x4d0d3a(0x26c)]=_0x56576e;}),_0x3e6f8f['forEach']((_0x27bd1a,_0x2e7b73)=>{_0x4b5673[_0x2e7b73]['product_code']=_0x27bd1a;}),_0x135135[_0x3a0431(0x256)]((_0x42c388,_0x324cc2)=>{var _0x45d515=_0x3a0431;_0x4b5673[_0x324cc2][_0x45d515(0x201)]=_0x42c388;}),_0x3945fd['forEach']((_0x55c371,_0x33c30f)=>{var _0x36a766=_0x3a0431;_0x4b5673[_0x33c30f][_0x36a766(0x24f)]=_0x55c371;}),_0x54b21d[_0x3a0431(0x256)]((_0x5f3fb2,_0x59ca5f)=>{_0x4b5673[_0x59ca5f]['return_qty']=_0x5f3fb2;}),_0x100dcf[_0x3a0431(0x256)]((_0x31c2d8,_0x30a0ac)=>{var _0x5349d8=_0x3a0431;_0x4b5673[_0x30a0ac][_0x5349d8(0x2b0)]=_0x31c2d8;}),_0x5b4959[_0x3a0431(0x256)]((_0x57371d,_0x7335d3)=>{var _0x42a95e=_0x3a0431;_0x4b5673[_0x7335d3][_0x42a95e(0x21e)]=_0x57371d;}),_0x2c2ee4['forEach']((_0x2ef754,_0x5b7387)=>{var _0x36b49d=_0x3a0431;_0x4b5673[_0x5b7387][_0x36b49d(0x2d8)]=_0x2ef754;}),_0x1a9608[_0x3a0431(0x256)]((_0x5ad8d1,_0x3dab84)=>{_0x4b5673[_0x3dab84]['floorlevel']=_0x5ad8d1;});var _0x50b54a=0x0;_0x4b5673['forEach'](_0x3e6c60=>{var _0x433f62=_0x3a0431;console[_0x433f62(0x1f2)]('foreach\x20newproduct',_0x3e6c60),(parseInt(_0x3e6c60['sale_qty'])<parseInt(_0x3e6c60[_0x433f62(0x20f)])||parseInt(_0x3e6c60[_0x433f62(0x24f)])<parseInt(_0x3e6c60['return_qty'])&&parseInt(_0x3e6c60['sale_qty'])>parseInt(_0x3e6c60[_0x433f62(0x20f)])||parseInt(_0x3e6c60[_0x433f62(0x20f)])==0x0)&&_0x50b54a++;});if(_0x50b54a!=0x0)return _0x5cf5e5[_0x3a0431(0x295)]('errors',_0x3a0431(0x251)),_0x3840a1[_0x3a0431(0x26d)](_0x3a0431(0x249));const _0x144040=await sales[_0x3a0431(0x250)]({'invoice':_0x2a5a8c});console[_0x3a0431(0x1f2)](_0x144040),_0x144040[_0x3a0431(0x223)]=_0x3a0431(0x2a3);const _0x5da4bb=await _0x144040[_0x3a0431(0x2ab)](),_0x4d8691=new sales_return({'invoice':_0x2a5a8c,'customer':_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x27b)],'date':_0x39e0e2,'warehouse_name':_0x282f18,'room':_0x3cc51c,'ToWarehouse':_0xa409ed,'ToRoom':_0x3bb009,'return_sale':_0x4b5673,'note':_0x3a2f18}),_0x5330c4=await _0x4d8691['save']();console[_0x3a0431(0x1f2)](_0x4d8691);const _0x318b86=await sales_return[_0x3a0431(0x250)]({'invoice':_0x2a5a8c}),_0x1ea933=await warehouse[_0x3a0431(0x250)]({'name':_0xa409ed,'room':_0x3bb009});_0x318b86['return_sale'][_0x3a0431(0x256)](_0x5dae04=>{var _0x700530=_0x3a0431,_0x1b4658=0x0;const _0x121164=_0x1ea933[_0x700530(0x2d9)][_0x700530(0x2ac)](_0x211f6d=>{var _0x266dc9=_0x700530;_0x211f6d['product_name']==_0x5dae04[_0x266dc9(0x1ec)]&&_0x211f6d[_0x266dc9(0x288)]==_0x5dae04[_0x266dc9(0x288)]&&_0x211f6d[_0x266dc9(0x2d8)]==_0x5dae04[_0x266dc9(0x2d8)]&&_0x211f6d[_0x266dc9(0x21e)]==_0x5dae04['bin']&&_0x211f6d['bay']==_0x5dae04['bay']&&(_0x211f6d['product_stock']=parseInt(_0x211f6d[_0x266dc9(0x1e2)])+parseInt(_0x5dae04['return_qty']),_0x1b4658++);});_0x1b4658=='0'&&(_0x1ea933[_0x700530(0x2d9)]=_0x1ea933['product_details'][_0x700530(0x246)]({'product_name':_0x5dae04[_0x700530(0x1ec)],'product_stock':_0x5dae04[_0x700530(0x20f)],'primary_code':_0x5dae04[_0x700530(0x2cc)],'secondary_code':_0x5dae04[_0x700530(0x26c)],'product_code':_0x5dae04[_0x700530(0x281)],'bay':_0x5dae04[_0x700530(0x2b0)],'bin':_0x5dae04[_0x700530(0x21e)],'type':_0x5dae04[_0x700530(0x2d8)],'floorlevel':_0x5dae04[_0x700530(0x288)]})),console[_0x700530(0x1f2)](_0x700530(0x220),_0x1ea933);}),await _0x1ea933[_0x3a0431(0x2ab)](),console[_0x3a0431(0x1f2)](_0x5cf5e5[_0x3a0431(0x1ea)]);const _0x4f2e5d=new c_payment_data({'invoice':_0x2a5a8c,'customer':_0x5cf5e5['body'][_0x3a0431(0x27b)],'reason':'Sale\x20Return'});await _0x4f2e5d['save']();const _0x3d3104=await master_shop[_0x3a0431(0x27f)]();console[_0x3a0431(0x1f2)](_0x3a0431(0x1f4),_0x3d3104[0x0][_0x3a0431(0x25c)]);const _0x389365=await email_settings[_0x3a0431(0x250)](),_0x3575f0=await customer[_0x3a0431(0x250)]({'name':_0x5cf5e5[_0x3a0431(0x1ea)][_0x3a0431(0x27b)]});console[_0x3a0431(0x1f2)]('customer_data',_0x3575f0);_0x3d3104[0x0][_0x3a0431(0x2c6)]==0x1?(right_currency=_0x3d3104[0x0][_0x3a0431(0x2c8)],left_currency=''):(right_currency='',left_currency=_0x3d3104[0x0][_0x3a0431(0x2c8)]);var _0x292b14=_0x5bc95a,_0x46cd8b=_0x54b21d,_0x29b417='',_0x5f0431;for(_0x5f0431 in _0x292b14){_0x29b417+=_0x3a0431(0x233)+_0x3a0431(0x2c3)+_0x292b14[_0x5f0431]+_0x3a0431(0x202)+_0x3a0431(0x2c3)+_0x46cd8b[_0x5f0431]+_0x3a0431(0x202)+_0x3a0431(0x225);}console[_0x3a0431(0x1f2)](_0x3a0431(0x212),_0x29b417);let _0x4f6ba2=nodemailer['createTransport']({'service':_0x3a0431(0x235),'auth':{'user':_0x389365[_0x3a0431(0x1e7)],'pass':_0x389365[_0x3a0431(0x29a)]}}),_0x908d94={'from':_0x389365[_0x3a0431(0x1e7)],'to':_0x3575f0[_0x3a0431(0x1e7)],'subject':_0x3a0431(0x1e3),'attachments':[{'filename':_0x3a0431(0x2de),'path':__dirname+_0x3a0431(0x1f9)+'/upload/'+_0x3d3104[0x0]['image'],'cid':'logo'}],'html':_0x3a0431(0x1f6)+_0x3a0431(0x219)+_0x3a0431(0x255)+_0x3a0431(0x20a)+_0x3a0431(0x2df)+'<div>'+_0x3a0431(0x2a7)+_0x3a0431(0x1e9)+'<div>'+_0x3a0431(0x1fc)+_0x3d3104[0x0][_0x3a0431(0x20d)]+'\x20</h2>'+_0x3a0431(0x1e9)+_0x3a0431(0x1e9)+'<hr\x20class=\x22my-3\x22>'+_0x3a0431(0x20a)+_0x3a0431(0x28e)+_0x3a0431(0x1e6)+_0x2a5a8c+'\x20'+_0x3a0431(0x1e8)+_0x3a0431(0x2be)+_0x39e0e2+'\x20'+_0x3a0431(0x2d6)+_0x3a0431(0x2b8)+_0x3a0431(0x1e9)+_0x3a0431(0x21c)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3a0431(0x233)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x3a0431(0x296)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x3a0431(0x22e)+_0x3a0431(0x225)+_0x3a0431(0x2b7)+_0x3a0431(0x252)+'\x20'+_0x29b417+'\x20'+_0x3a0431(0x23d)+_0x3a0431(0x2b9)+_0x3a0431(0x20a)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3d3104[0x0][_0x3a0431(0x20d)]+_0x3a0431(0x2b8)+_0x3a0431(0x1e9)+_0x3a0431(0x1e9)+'</body></html>'};_0x4f6ba2[_0x3a0431(0x290)](_0x908d94,function(_0x47a591,_0x48699f){var _0x4e834a=_0x3a0431;_0x47a591?(console[_0x4e834a(0x1f2)](_0x47a591),console[_0x4e834a(0x1f2)](_0x4e834a(0x1ed))):console['log'](_0x4e834a(0x292));}),_0x5cf5e5[_0x3a0431(0x295)](_0x3a0431(0x234),_0x3a0431(0x209)),_0x3840a1[_0x3a0431(0x26d)](_0x3a0431(0x1f1));}catch(_0x538446){console[_0x3a0431(0x1f2)](_0x538446),_0x3840a1['status'](0xc8)[_0x3a0431(0x264)]({'message1':_0x538446[_0x3a0431(0x2d4)]});}}),router[a0_0x3bbbeb(0x267)]('/barcode/:id',auth,async(_0xefcbe4,_0x4ae413)=>{var _0x38723b=a0_0x3bbbeb;try{const {username:_0x415216,email:_0x345771,role:_0x373398}=_0xefcbe4['user'],_0x99d578=_0xefcbe4[_0x38723b(0x22c)],_0x53ac99=await profile[_0x38723b(0x250)]({'email':_0x99d578['email']}),_0xe68fa1=await master_shop[_0x38723b(0x27f)]();console[_0x38723b(0x1f2)]('barcode\x20Product\x20master',_0xe68fa1);const _0x2fad69=_0xefcbe4[_0x38723b(0x221)]['id'],_0x23b140=await sales['findById'](_0x2fad69);console[_0x38723b(0x1f2)](_0x38723b(0x27a),_0x23b140);if(_0xe68fa1[0x0][_0x38723b(0x24a)]==_0x38723b(0x270))var _0x5d7b0e=users[_0x38723b(0x279)];else{if(_0xe68fa1[0x0][_0x38723b(0x24a)]==_0x38723b(0x268))var _0x5d7b0e=users[_0x38723b(0x268)];else{if(_0xe68fa1[0x0][_0x38723b(0x24a)]=='German')var _0x5d7b0e=users[_0x38723b(0x1de)];else{if(_0xe68fa1[0x0]['language']=='Spanish')var _0x5d7b0e=users['Spanish'];else{if(_0xe68fa1[0x0][_0x38723b(0x24a)]==_0x38723b(0x1fb))var _0x5d7b0e=users[_0x38723b(0x1fb)];else{if(_0xe68fa1[0x0][_0x38723b(0x24a)]==_0x38723b(0x283))var _0x5d7b0e=users[_0x38723b(0x269)];else{if(_0xe68fa1[0x0]['language']=='Chinese')var _0x5d7b0e=users['Chinese'];else{if(_0xe68fa1[0x0][_0x38723b(0x24a)]==_0x38723b(0x2d7))var _0x5d7b0e=users[_0x38723b(0x20e)];}}}}}}}_0x4ae413[_0x38723b(0x21b)](_0x38723b(0x1dd),{'success':_0xefcbe4[_0x38723b(0x295)](_0x38723b(0x234)),'errors':_0xefcbe4[_0x38723b(0x295)](_0x38723b(0x261)),'role':_0x99d578,'profile':_0x53ac99,'alldata':_0x23b140,'master_shop':_0xe68fa1,'language':_0x5d7b0e});}catch(_0x5b221c){console[_0x38723b(0x1f2)](_0x5b221c);}}),router[a0_0x3bbbeb(0x248)]('/barcode_scanner',async(_0x13264d,_0x42a3dc)=>{var _0x45ff98=a0_0x3bbbeb;const {product_code:_0x946511,warehouse_name:_0x40d955,rooms_data:_0x585fc0,Roomslist:_0x31758e}=_0x13264d[_0x45ff98(0x1ea)],_0x22f106=_0x31758e[_0x45ff98(0x23f)](','),_0x25e16a=[];async function _0x89a287(_0x32565e){var _0x56d99b=_0x45ff98;const _0x1d1ec2=await warehouse[_0x56d99b(0x29e)]([{'$match':{'name':_0x40d955,'room':_0x32565e}},{'$unwind':_0x56d99b(0x284)},{'$match':{'product_details.primary_code':_0x946511}},{'$group':{'_id':_0x56d99b(0x236),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x56d99b(0x26a)},'primary_code':{'$first':_0x56d99b(0x1fe)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x56d99b(0x243)},'level':{'$first':_0x56d99b(0x259)},'isle':{'$first':_0x56d99b(0x26f)},'type':{'$first':_0x56d99b(0x1ef)},'pallet':{'$first':_0x56d99b(0x244)},'unit':{'$first':_0x56d99b(0x24b)},'secondary_unit':{'$first':_0x56d99b(0x232)},'storage':{'$first':_0x56d99b(0x247)},'rack':{'$first':_0x56d99b(0x262)},'expiry_date':{'$first':_0x56d99b(0x294)},'production_date':{'$first':_0x56d99b(0x203)},'maxPerUnit':{'$first':_0x56d99b(0x2d0)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x56d99b(0x2d2)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x56d99b(0x1e1)}}}]),_0x2a2d1d=await warehouse[_0x56d99b(0x29e)]([{'$match':{'name':_0x40d955,'room':_0x32565e}},{'$unwind':_0x56d99b(0x284)},{'$match':{'product_details.secondary_code':_0x946511}},{'$group':{'_id':_0x56d99b(0x236),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x56d99b(0x26a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x56d99b(0x2dd)},'product_code':{'$first':_0x56d99b(0x243)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x56d99b(0x26f)},'type':{'$first':_0x56d99b(0x1ef)},'pallet':{'$first':_0x56d99b(0x244)},'unit':{'$first':_0x56d99b(0x24b)},'secondary_unit':{'$first':_0x56d99b(0x232)},'storage':{'$first':_0x56d99b(0x247)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x56d99b(0x294)},'production_date':{'$first':_0x56d99b(0x203)},'maxPerUnit':{'$first':_0x56d99b(0x2d0)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x56d99b(0x2ca)},'invoice':{'$first':_0x56d99b(0x2d2)}}}]);if(_0x1d1ec2['length']>0x0)_0x25e16a[_0x56d99b(0x241)](_0x1d1ec2);else _0x2a2d1d['length']>0x0&&_0x25e16a['push'](_0x2a2d1d);}const _0x373c9c=_0x22f106[_0x45ff98(0x2ac)](_0x2db4c9=>_0x89a287(_0x2db4c9));await Promise[_0x45ff98(0x245)](_0x373c9c),_0x42a3dc[_0x45ff98(0x264)](_0x25e16a);}),module['exports']=router;function a0_0x3460(){var _0xc621c4=['An\x20error\x20occurred.','$sale_product.type','filter','\x20Order\x20Date\x20:\x20','SCRN','RMSEmail','getFullYear','padStart','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','random','Raw\x20Materials','currency_placement','delivery_code','currency','$product.product_name','$room','warehouse','primary_code','1yLAfIV','payment\x20successfull','/view/add_sales','$product_details.maxPerUnit','length','$product_details.invoice','isAllowEdit','message','Enabled','</span>','Arabic\x20(ae)','type','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Enclosed','$sale_product','$product_details.secondary_code','Logo.png','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','logo','all_sales_barcode','German','/upload/','all_sales','$product_details.actual_uom','product_stock','Sale\x20Return\x20Mail','Shelves','return_sale','\x20Order\x20Number\x20:\x20','email','<span\x20style=\x22float:\x20right;\x22>','</div>','body','Receiving\x20Area','product_name','Error\x20Occurs','room_name','$product_details.type','max_per_unit','/all_sales/view','log','$customer','add\x20post','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<!DOCTYPE\x20html>','storage','$return_data','/../public','rack','French','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.primary_code','level','stocks','sale_qty','</td>','$product_details.production_date','$warehouse_name','secondary_unit','$note','$sale_product.bay','$product','sales\x20item\x20return\x20successfull','<div>','../public/language/languages.json','73911DChpEs','site_title','Arabic','return_qty','edit_sales','product','product_list','../models/all_models','staff','invoice','add_sales','requested_qty','getMonth','<html><head><title></title>','False','render','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/view','bin','amount','final','params','9AHiLjk','return_data','role','</tr>','33llygyy','delivery_date','date','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','production_date','user','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','string','catch','product_data','$product_details.secondary_unit','<tr>','success','gmail','$product_details._id','124jbUnzn','actual_uom','received_amount','$sale_product.bin','OUT-','foreach\x20newproduct','</tbody>','<strong>\x20Regards\x20</strong>','split','../middleware/auth','push','Spanish','$product_details.product_code','$product_details.floorlevel','all','concat','$product_details.storage','post','back','language','$product_details.unit','3460VPDdqj','/view/add_sales/:id','2610223FQXIWP','stock','findOne','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','<tbody\x20style=\x22text-align:\x20center;\x22>','1281130JQqPSL','<h5>','</head><body>','forEach','customers','quantity','$product_details.bay','An\x20error\x20occurred\x20while\x20saving\x20data.','prod_cat','image','carton','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$_id','express','errors','$product_details.rack','1220676EghPQm','json','abs','finalize','get','Hindi','Portuguese','$product_details.product_stock','customers_docs','secondary_code','redirect','_id','$product_details.bin','English\x20(US)','$product_details.product_name','primary_unit','Sales\x20Update\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','floor','Chinese','$invoice','</body></html>','English','barcode\x20user_id','customer','$name','actual_qty','2825776jTGJvv','find','$customers_docs','product_code','findById','Portuguese\x20(BR)','$product_details','/view/:id','note','expiry_date','floorlevel','$date','/view/return_sales/:id','Sales\x20Add\x20successfully','1009634blmgBo','$sale_product.quantity','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.isle','sendMail','status','Email\x20sent\x20successfully','sales_quantity','$product_details.expiry_date','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$sale_product.floorlevel','78zLgYdX','$finalize','password','slice','master','error','aggregate','name','unit','Level','due_amount','True','Sales\x20Mail','user_id','/preview/:id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','RoomAssigned','port','warehouse_name','save','map','stock_data','Return\x20Goods','Floor','bay','batch_code','maxperunit','sale_product','createTransport','quantity_notConverted','169qhOiAO','</thead>','</h5>','</table>','types'];a0_0x3460=function(){return _0xc621c4;};return a0_0x3460();}