var a0_0x2548e2=a0_0x53ed;function a0_0x53ed(_0x30fb50,_0x4f5bce){var _0x59411c=a0_0x5941();return a0_0x53ed=function(_0x53ed4c,_0x27ee39){_0x53ed4c=_0x53ed4c-0x19e;var _0x532aad=_0x59411c[_0x53ed4c];return _0x532aad;},a0_0x53ed(_0x30fb50,_0x4f5bce);}(function(_0x2f5f94,_0x212b0c){var _0x5bb96a=a0_0x53ed,_0x51288a=_0x2f5f94();while(!![]){try{var _0x4f93cb=-parseInt(_0x5bb96a(0x1ee))/0x1*(parseInt(_0x5bb96a(0x1b4))/0x2)+-parseInt(_0x5bb96a(0x21a))/0x3*(parseInt(_0x5bb96a(0x288))/0x4)+parseInt(_0x5bb96a(0x26c))/0x5*(parseInt(_0x5bb96a(0x248))/0x6)+parseInt(_0x5bb96a(0x205))/0x7*(parseInt(_0x5bb96a(0x2a1))/0x8)+-parseInt(_0x5bb96a(0x1b3))/0x9*(parseInt(_0x5bb96a(0x238))/0xa)+-parseInt(_0x5bb96a(0x2b1))/0xb+parseInt(_0x5bb96a(0x22b))/0xc*(parseInt(_0x5bb96a(0x1ec))/0xd);if(_0x4f93cb===_0x212b0c)break;else _0x51288a['push'](_0x51288a['shift']());}catch(_0x1fa43c){_0x51288a['push'](_0x51288a['shift']());}}}(a0_0x5941,0x4de93));const express=require(a0_0x2548e2(0x1b5)),app=express(),router=express[a0_0x2548e2(0x2a9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x2548e2(0x1c6)),auth=require(a0_0x2548e2(0x1e2)),nodemailer=require(a0_0x2548e2(0x1db)),users=require(a0_0x2548e2(0x290));function a0_0x5941(){var _0x1311a4=['gmail','$product_details.bin','RMSEmail','Receiving\x20Area','product_stock','amount','sale_product','$return_data','json','id_transact','level','currency','Enabled','4piuYuQ','image','$product_details.secondary_code','<h5\x20style=\x22text-align:\x20left;\x22>','Hindi','sale_qty','all_sales_barcode','$product_details.floorlevel','../public/language/languages.json','barcode\x20user_id','/view/add_sales','$product_details.unit','user','product','$product_details.product_stock','<!DOCTYPE\x20html>','Sales\x20Add\x20successfully','catch','date','carton','concat','primary_code','<h2>\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','get','232ClDinV','_id','$product_details.storage','delivery_code','params','</span>','Arabic','English\x20(US)','Router','message','received_amount','/view','unit','back','<div>','\x20Order\x20Date\x20:\x20','963589CAuVwQ','Received\x20Payment\x20For\x20Sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','findOne','id_transaction_from','$product_details.product_code','warehouse_name','</tbody>','actual_qty','English','/give_payment/:id','</div>','$sale_product.type','due_amount','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','split','floorlevel','barcode\x20Product\x20master','</thead>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','maxperunit','$product_details.pallet','<strong>\x20Regards\x20</strong>','map','expiry_date','18HqSBuk','54562bJEkAt','express','storage','$product_details.isle','secondary_code','Sale\x20Return\x20Mail','add_sales','There\x27s\x20a\x20error\x20in\x20this\x20transaction','room','Portuguese','/all_sales/view','master','$customer','customers_docs','$product_details.invoice','success','isAllowEdit','return_data','../models/all_models','quantity_notConverted','$product_details','<h5>','/../public','An\x20error\x20occurred\x20while\x20saving\x20data.','flash','stocks','/invoice/:id','An\x20error\x20occurred.','redirect','prod_cat','/preview/:id','sales\x20all_data','/all_sales/preview/','Spanish','payment\x20successfull','$invoice','$isAllowEdit','</body></html>','aggregate','nodemailer','$finalize','$sale_product.floorlevel','language','$product_details.rack','filter','$sale_product.bin','../middleware/auth','Enclosed','$product.product_name','$product_details.actual_uom','$product_details.type','error','$product_details.secondary_unit','final','OUT-','$product_details.product_cat','1378jphwtD','customer','14xHXpVC','type','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','staff','bay','edit_sales','$sale_product.bay','$sale_product','room_name','render','Level','batch_code','$sale_product.quantity','Return\x20Rooms','getFullYear','getMonth','return_qty','slice','secondary_unit','$product_details._id','Floor','Raw\x20Materials','39648ySAECJ','$name','then','<tbody\x20style=\x22text-align:\x20center;\x22>','createTransport','findById','purchases_data','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','post','edit_sales_view','German','quantity','RoomAssigned','/barcode/:id','stock_data','$warehouse_name','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.bay','$product_details.expiry_date','1127595VVImJs','forEach','Arabic\x20(ae)','floor','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','False','</td>','Return\x20Goods','invoice','$product_details.batch_code','types','port','</tr>','padStart','sales_invoice','customer_data','$product_details.level','135084tbjfmo','sales_quantity','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','customers','actual_uom','<hr\x20class=\x22my-3\x22>','string','role','add\x20post','<span\x20style=\x22float:\x20right;\x22>','1729590FCmEcb','Chinese','$product_details.product_name','prod_code','currency_placement','abs','errors','length','delivery_date','\x20Order\x20Number\x20:\x20','$note','foreach\x20newproduct','user_id','warehouse','logo','</table>','6LKpywA','rack','product_code','$product_details.actual_qty','production_date','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','push','save','Shelves','max_per_unit','Sales\x20Mail','product_details','/view/:id','all','prod_invoice','product_name','SCRN','Sale\x20Return','</h5>','stock','$product_details.production_date','requested_qty','Email\x20sent\x20successfully','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','primary_unit','log','/view/return_sales/:id','bin','body','</head><body>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Sales\x20Update\x20successfully','return_sale','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$date','764705tDsfft','Logo.png','/barcode_scanner','Error\x20Occurs','French','password','$customers_docs','True','product_data','name','<tr>','max','Portuguese\x20(BR)','find','$product_details.maxPerUnit'];a0_0x5941=function(){return _0x1311a4;};return a0_0x5941();}router['get'](a0_0x2548e2(0x2ac),auth,async(_0x32e856,_0x1e8c1c)=>{var _0x2a058=a0_0x2548e2;try{const {username:_0x43d739,email:_0x1bcd68,role:_0x2d00ac}=_0x32e856[_0x2a058(0x294)],_0x5348d7=_0x32e856[_0x2a058(0x294)],_0x45451b=await profile[_0x2a058(0x2b4)]({'email':_0x5348d7[_0x2a058(0x20c)]}),_0x500a36=await master_shop[_0x2a058(0x279)]();let _0xf228ba;if(_0x5348d7[_0x2a058(0x235)]==_0x2a058(0x1f2)){const _0x3416d3=await staff[_0x2a058(0x2b4)]({'email':_0x5348d7[_0x2a058(0x20c)]});_0xf228ba=await sales[_0x2a058(0x1da)]([{'$lookup':{'from':_0x2a058(0x231),'localField':_0x2a058(0x1ed),'foreignField':_0x2a058(0x275),'as':_0x2a058(0x1c1)}},{'$unwind':'$customers_docs'},{'$unwind':_0x2a058(0x1f6)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x2a058(0x1c0)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2a058(0x215)},'sale_product':{'$push':'$sale_product'},'note':{'$first':_0x2a058(0x242)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x2a058(0x272)},'total_saleproduct_quantity':{'$sum':_0x2a058(0x1fb)},'level':{'$addToSet':_0x2a058(0x1f5)},'isle':{'$addToSet':_0x2a058(0x1e1)},'type':{'$addToSet':_0x2a058(0x1a6)},'pallet':{'$addToSet':_0x2a058(0x1dd)},'finalize':{'$first':_0x2a058(0x1dc)},'isAllowEdit':{'$first':_0x2a058(0x1d8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0xf228ba=await sales['aggregate']([{'$lookup':{'from':_0x2a058(0x231),'localField':_0x2a058(0x1ed),'foreignField':'name','as':_0x2a058(0x1c1)}},{'$unwind':_0x2a058(0x272)},{'$unwind':_0x2a058(0x1f6)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2a058(0x1d7)},'customers':{'$first':_0x2a058(0x1c0)},'date':{'$first':_0x2a058(0x26b)},'warehouse_name':{'$first':_0x2a058(0x215)},'sale_product':{'$push':_0x2a058(0x1f6)},'note':{'$first':'$note'},'return_data':{'$first':_0x2a058(0x282)},'customers_docs':{'$first':_0x2a058(0x272)},'total_saleproduct_quantity':{'$sum':_0x2a058(0x1fb)},'level':{'$addToSet':_0x2a058(0x1f5)},'isle':{'$addToSet':_0x2a058(0x1e1)},'type':{'$addToSet':_0x2a058(0x1a6)},'pallet':{'$addToSet':_0x2a058(0x1dd)},'finalize':{'$first':_0x2a058(0x1dc)},'isAllowEdit':{'$first':_0x2a058(0x1d8)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console['log'](_0x2a058(0x1d3),_0xf228ba);if(_0x500a36[0x0][_0x2a058(0x1de)]==_0x2a058(0x2a8)){var _0x509ccf=users[_0x2a058(0x1a3)];console[_0x2a058(0x262)](_0x509ccf);}else{if(_0x500a36[0x0][_0x2a058(0x1de)]=='Hindi')var _0x509ccf=users[_0x2a058(0x28c)];else{if(_0x500a36[0x0][_0x2a058(0x1de)]==_0x2a058(0x210))var _0x509ccf=users[_0x2a058(0x210)];else{if(_0x500a36[0x0]['language']==_0x2a058(0x1d5))var _0x509ccf=users[_0x2a058(0x1d5)];else{if(_0x500a36[0x0]['language']==_0x2a058(0x270))var _0x509ccf=users[_0x2a058(0x270)];else{if(_0x500a36[0x0][_0x2a058(0x1de)]==_0x2a058(0x278))var _0x509ccf=users['Portuguese'];else{if(_0x500a36[0x0][_0x2a058(0x1de)]==_0x2a058(0x239))var _0x509ccf=users['Chinese'];else{if(_0x500a36[0x0][_0x2a058(0x1de)]==_0x2a058(0x21c))var _0x509ccf=users[_0x2a058(0x2a7)];}}}}}}}_0x1e8c1c[_0x2a058(0x1f8)]('all_sales',{'success':_0x32e856['flash'](_0x2a058(0x1c3)),'errors':_0x32e856[_0x2a058(0x1cc)](_0x2a058(0x23e)),'sales':_0xf228ba,'profile':_0x45451b,'role':_0x5348d7,'master_shop':_0x500a36,'language':_0x509ccf});}catch(_0x3d4b33){console[_0x2a058(0x262)](_0x3d4b33);}});async function getRandom8DigitNumber(){var _0x55c126=a0_0x2548e2;const _0x38e7f3=0x989680,_0x17c417=0x5f5e0ff,_0x33c8d4=Math[_0x55c126(0x21d)](Math['random']()*(_0x17c417-_0x38e7f3+0x1))+_0x38e7f3;var _0x366614;const _0x58e154=await sales[_0x55c126(0x2b4)]({'invoice':_0x55c126(0x1ea)+_0x33c8d4});return _0x58e154&&_0x58e154['length']>0x0?_0x366614=_0x55c126(0x1ea)+_0x33c8d4:_0x366614=_0x55c126(0x1ea)+_0x33c8d4,_0x366614;}router['get'](a0_0x2548e2(0x292),auth,async(_0x246684,_0x40edc8)=>{var _0x93e8a0=a0_0x2548e2;try{const {username:_0x196662,email:_0x45f133,role:_0x277295}=_0x246684[_0x93e8a0(0x294)],_0x3d0550=_0x246684[_0x93e8a0(0x294)],_0x2dc1d8=await profile['findOne']({'email':_0x3d0550[_0x93e8a0(0x20c)]}),_0x3152fd=await master_shop[_0x93e8a0(0x279)](),_0x595e87=await customer[_0x93e8a0(0x279)]({});let _0x4b6a0b;if(_0x3d0550['role']==_0x93e8a0(0x1f2)){const _0x437d7e=await staff[_0x93e8a0(0x2b4)]({'email':_0x3d0550[_0x93e8a0(0x20c)]});_0x4b6a0b=await warehouse[_0x93e8a0(0x1da)]([{'$match':{'status':_0x93e8a0(0x287),'name':_0x437d7e[_0x93e8a0(0x245)],'warehouse_category':_0x93e8a0(0x204),'name':{'$ne':_0x93e8a0(0x221)}}},{'$group':{'_id':_0x93e8a0(0x206),'name':{'$first':_0x93e8a0(0x206)}}},{'$sort':{'name':0x1}}]);}else _0x4b6a0b=await warehouse[_0x93e8a0(0x1da)]([{'$match':{'status':_0x93e8a0(0x287),'warehouse_category':_0x93e8a0(0x204),'name':{'$ne':_0x93e8a0(0x221)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x432c5c=await product[_0x93e8a0(0x279)]({});var _0x4c5541=['Ambient',_0x93e8a0(0x1e3)];const _0xa975be=await sales[_0x93e8a0(0x279)]({}),_0x570259=_0xa975be[_0x93e8a0(0x23f)]+0x1,_0x2a6238=_0x93e8a0(0x1ea)+_0x570259['toString']()[_0x93e8a0(0x227)](0x5,'0');if(_0x3152fd[0x0]['language']==_0x93e8a0(0x2a8)){var _0x50a3ac=users[_0x93e8a0(0x1a3)];console['log'](_0x50a3ac);}else{if(_0x3152fd[0x0][_0x93e8a0(0x1de)]=='Hindi')var _0x50a3ac=users[_0x93e8a0(0x28c)];else{if(_0x3152fd[0x0]['language']==_0x93e8a0(0x210))var _0x50a3ac=users[_0x93e8a0(0x210)];else{if(_0x3152fd[0x0][_0x93e8a0(0x1de)]==_0x93e8a0(0x1d5))var _0x50a3ac=users[_0x93e8a0(0x1d5)];else{if(_0x3152fd[0x0][_0x93e8a0(0x1de)]==_0x93e8a0(0x270))var _0x50a3ac=users[_0x93e8a0(0x270)];else{if(_0x3152fd[0x0][_0x93e8a0(0x1de)]==_0x93e8a0(0x278))var _0x50a3ac=users[_0x93e8a0(0x1bd)];else{if(_0x3152fd[0x0][_0x93e8a0(0x1de)]=='Chinese')var _0x50a3ac=users[_0x93e8a0(0x239)];else{if(_0x3152fd[0x0]['language']==_0x93e8a0(0x21c))var _0x50a3ac=users['Arabic'];}}}}}}}const _0x552d21=getRandom8DigitNumber();_0x552d21[_0x93e8a0(0x207)](_0xe2890a=>{var _0x55e603=_0x93e8a0;_0x40edc8[_0x55e603(0x1f8)](_0x55e603(0x1ba),{'success':_0x246684[_0x55e603(0x1cc)]('success'),'errors':_0x246684[_0x55e603(0x1cc)]('errors'),'role':_0x3d0550,'profile':_0x2dc1d8,'customer':_0x595e87,'warehouse':_0x4b6a0b,'product':_0x432c5c,'invoice':_0xe2890a,'master_shop':_0x3152fd,'language':_0x50a3ac,'rooms_data':_0x4c5541});})[_0x93e8a0(0x299)](_0x52de7b=>{var _0x1f78dd=_0x93e8a0;_0x246684[_0x1f78dd(0x1cc)](_0x1f78dd(0x23e),_0x1f78dd(0x1bb)),_0x40edc8['redirect'](_0x1f78dd(0x1be));});}catch(_0x3a1cca){console[_0x93e8a0(0x262)](_0x3a1cca);}}),router[a0_0x2548e2(0x2a0)]('/view/add_sales/:id',auth,async(_0xb4b494,_0x1ae103)=>{var _0x154f14=a0_0x2548e2;try{const _0x455c76=_0xb4b494[_0x154f14(0x2a5)]['id'];console[_0x154f14(0x262)](_0x455c76);const _0x1d5ad3=await product[_0x154f14(0x279)](),_0x25fcf3=await purchases['aggregate']([{'$match':{'warehouse_name':_0x455c76}},{'$unwind':'$product'},{'$group':{'_id':_0x154f14(0x1e4)}}]);console[_0x154f14(0x262)](_0x154f14(0x20b),_0x25fcf3),_0x1ae103[_0x154f14(0x22d)](0xc8)[_0x154f14(0x283)]({'purchases_data':_0x25fcf3,'product_data':_0x1d5ad3});}catch(_0x392ad3){console[_0x154f14(0x262)](_0x392ad3);}}),router[a0_0x2548e2(0x20e)]('/view/add_sale/product',auth,async(_0x5697f9,_0x5ac176)=>{var _0x40bf77=a0_0x2548e2;try{const {warehouse_data:_0x7050cf,product_data:_0x2f211e}=_0x5697f9[_0x40bf77(0x265)];console[_0x40bf77(0x262)](_0x5697f9[_0x40bf77(0x265)][_0x40bf77(0x274)]);;const _0x3f37b3=await master_shop['find']();console[_0x40bf77(0x262)]('master',_0x3f37b3);const _0x3c28e4=await product[_0x40bf77(0x2b4)]({'name':_0x2f211e});console['log'](_0x40bf77(0x295),_0x3c28e4);const _0x561209=await warehouse['aggregate']([{'$match':{'name':_0x7050cf}},{'$unwind':_0x40bf77(0x1c8)},{'$match':{'product_details.product_name':_0x2f211e}},{'$group':{'_id':_0x40bf77(0x23a),'product_stock':{'$first':_0x40bf77(0x296)}}}]);console['log'](_0x40bf77(0x214),_0x561209),_0x5ac176['status'](0xc8)['json']({'master':_0x3f37b3,'new_product':_0x3c28e4,'stock_data':_0x561209});}catch(_0x267b5d){console[_0x40bf77(0x262)](_0x267b5d);}}),router[a0_0x2548e2(0x20e)](a0_0x2548e2(0x292),auth,async(_0x7d0f62,_0x170896)=>{var _0x1c99ab=a0_0x2548e2;try{const {invoice:_0x2aa79a,date:_0x2f7d91,warehouse_name:_0x57ae3e,product_name:_0x28fa8b,stock:_0x1aa4db,quantity:_0x49c6a7,note:_0x20e9e6,room:_0x290da1,primary_code:_0x5a11ec,secondary_code:_0x212247,prod_code:_0x2ce3c9,level:_0x35aaeb,isle:_0x2fde86,pallet:_0x4225ea,batch_code:_0x459581,SCRN:_0x6bc4da,expiry_date:_0x206ac6}=_0x7d0f62[_0x1c99ab(0x265)];if(typeof _0x28fa8b=='string')var _0x3616cb=[_0x7d0f62[_0x1c99ab(0x265)]['product_name']],_0x4b3608=[_0x7d0f62[_0x1c99ab(0x265)]['stock']],_0x7943b1=[_0x7d0f62['body']['carton']],_0x4f27e5=[_0x7d0f62[_0x1c99ab(0x265)]['primary_code']],_0x453ddf=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1b8)]],_0x3f8581=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x23b)]],_0xee8ef1=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x285)]],_0x3bffed=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x261)]],_0x1c216e=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x201)]],_0x26e390=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1fa)]],_0x4d2ad1=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1b2)]],_0x40ee65=[_0x7d0f62['body'][_0x1c99ab(0x252)]],_0x102c46=[_0x7d0f62['body'][_0x1c99ab(0x24c)]],_0x3bde5=[_0x7d0f62[_0x1c99ab(0x265)]['requested_qty']],_0x1fe457=[_0x7d0f62['body'][_0x1c99ab(0x240)]],_0x3a73fd=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x2a4)]],_0x35cb71=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1d1)]],_0x523efe=[_0x7d0f62[_0x1c99ab(0x265)]['quantity']],_0x332442=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x212)]],_0xa0a23=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x257)]],_0x223e90=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1a2)]],_0x294a83=[_0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x232)]],_0x42c0c7=[_0x7d0f62['body'][_0x1c99ab(0x284)]];else var _0x3616cb=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x258)]],_0x4b3608=[..._0x7d0f62['body'][_0x1c99ab(0x25c)]],_0x7943b1=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x29b)]],_0x4f27e5=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x29d)]],_0x453ddf=[..._0x7d0f62['body'][_0x1c99ab(0x1b8)]],_0x3f8581=[..._0x7d0f62['body'][_0x1c99ab(0x23b)]],_0xee8ef1=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x285)]],_0x3bffed=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x261)]],_0x1c216e=[..._0x7d0f62[_0x1c99ab(0x265)]['secondary_unit']],_0x26e390=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1fa)]],_0x4d2ad1=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1b2)]],_0x40ee65=[..._0x7d0f62['body']['max_per_unit']],_0x102c46=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x24c)]],_0x3bde5=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x25e)]],_0x1fe457=[..._0x7d0f62['body']['delivery_date']],_0x3a73fd=[..._0x7d0f62['body'][_0x1c99ab(0x2a4)]],_0x35cb71=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1d1)]],_0x523efe=[..._0x7d0f62['body'][_0x1c99ab(0x211)]],_0x332442=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x212)]],_0xa0a23=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x257)]],_0x223e90=[..._0x7d0f62[_0x1c99ab(0x265)][_0x1c99ab(0x1a2)]],_0x294a83=[..._0x7d0f62['body'][_0x1c99ab(0x232)]],_0x42c0c7=[..._0x7d0f62[_0x1c99ab(0x265)]['id_transact']];const _0x5504db=_0x3616cb[_0x1c99ab(0x1b1)](_0x2b1c8e=>{return _0x2b1c8e={'product_name':_0x2b1c8e};});_0x4b3608['forEach']((_0x3c4733,_0x55344a)=>{var _0x19b6f6=_0x1c99ab;_0x5504db[_0x55344a][_0x19b6f6(0x25c)]=Math['abs'](_0x3c4733);}),_0x223e90[_0x1c99ab(0x21b)]((_0x10b937,_0x2efbfb)=>{_0x5504db[_0x2efbfb]['actual_qty']=Math['abs'](_0x10b937);}),_0x294a83[_0x1c99ab(0x21b)]((_0x415359,_0x428e07)=>{var _0x45e600=_0x1c99ab;_0x5504db[_0x428e07][_0x45e600(0x232)]=_0x415359;}),_0x42c0c7[_0x1c99ab(0x21b)]((_0x4758a0,_0x173a68)=>{var _0x535ac9=_0x1c99ab;_0x5504db[_0x173a68][_0x535ac9(0x19e)]=_0x4758a0;}),_0x7943b1[_0x1c99ab(0x21b)]((_0x287fd6,_0x44a3ac)=>{_0x5504db[_0x44a3ac]['quantity']=_0x287fd6;}),_0x4f27e5[_0x1c99ab(0x21b)]((_0x2974cd,_0x5d308f)=>{var _0x4f7717=_0x1c99ab;_0x5504db[_0x5d308f][_0x4f7717(0x29d)]=_0x2974cd;}),_0x453ddf['forEach']((_0x1c2032,_0x52119d)=>{var _0x32f162=_0x1c99ab;_0x5504db[_0x52119d][_0x32f162(0x1b8)]=_0x1c2032;}),_0x3f8581['forEach']((_0x29ff21,_0x1acc56)=>{var _0x432dfe=_0x1c99ab;_0x5504db[_0x1acc56][_0x432dfe(0x24a)]=_0x29ff21;}),_0xee8ef1[_0x1c99ab(0x21b)]((_0x34324e,_0x189816)=>{var _0x100227=_0x1c99ab;_0x332442[_0x100227(0x21b)]((_0x370a22,_0x1a5eef)=>{var _0x5d04d4=_0x100227;if(_0x370a22==_0x5d04d4(0x27e)&&_0x189816==_0x1a5eef){var _0x58f466=_0x34324e[_0x5d04d4(0x200)](0x3);_0x5504db[_0x189816][_0x5d04d4(0x1b6)]=_0x34324e[0x0],_0x5504db[_0x189816][_0x5d04d4(0x249)]=_0x34324e[0x1],_0x5504db[_0x189816]['bay']=0x0,_0x5504db[_0x189816][_0x5d04d4(0x264)]=0x0,_0x5504db[_0x189816][_0x5d04d4(0x1ef)]=_0x5d04d4(0x203),_0x5504db[_0x189816][_0x5d04d4(0x1aa)]=_0x58f466;}else{if(_0x370a22==_0x5d04d4(0x251)&&_0x189816==_0x1a5eef){var _0x58f466=_0x34324e['slice'](0x3);_0x5504db[_0x189816][_0x5d04d4(0x1b6)]=_0x34324e[0x0],_0x5504db[_0x189816][_0x5d04d4(0x249)]=_0x34324e[0x1],_0x5504db[_0x189816]['bay']=0x0,_0x5504db[_0x189816][_0x5d04d4(0x264)]=0x0,_0x5504db[_0x189816][_0x5d04d4(0x1ef)]=_0x5d04d4(0x203),_0x5504db[_0x189816][_0x5d04d4(0x1aa)]=_0x34324e[0x5];}else{if(_0x189816==_0x1a5eef){var _0x44d9ea;if(_0x34324e[0x4]=='L')_0x44d9ea=_0x5d04d4(0x1f9);else _0x34324e[0x4]=='F'&&(_0x44d9ea='Floor');_0x5504db[_0x189816][_0x5d04d4(0x1b6)]=_0x34324e[0x0],_0x5504db[_0x189816][_0x5d04d4(0x249)]=_0x34324e[0x1],_0x5504db[_0x189816][_0x5d04d4(0x1f3)]=_0x34324e[0x2],_0x5504db[_0x189816]['bin']=_0x34324e[0x3],_0x5504db[_0x189816][_0x5d04d4(0x1ef)]=_0x44d9ea,_0x5504db[_0x189816][_0x5d04d4(0x1aa)]=_0x34324e[0x5];}}}});}),_0x3bffed[_0x1c99ab(0x21b)]((_0x2b5c93,_0x49927e)=>{_0x5504db[_0x49927e]['unit']=_0x2b5c93;}),_0x1c216e['forEach']((_0x47f410,_0x343aa5)=>{_0x5504db[_0x343aa5]['secondary_unit']=_0x47f410;}),_0x26e390[_0x1c99ab(0x21b)]((_0x4103bb,_0x4670e1)=>{var _0x37669d=_0x1c99ab;_0x5504db[_0x4670e1][_0x37669d(0x1fa)]=_0x4103bb;}),_0x4d2ad1[_0x1c99ab(0x21b)]((_0x205753,_0x56bc17)=>{var _0x5d8578=_0x1c99ab;_0x5504db[_0x56bc17][_0x5d8578(0x1b2)]=_0x205753;}),_0x40ee65['forEach']((_0x1a35a2,_0x1e3aeb)=>{var _0xedaecc=_0x1c99ab;_0x5504db[_0x1e3aeb][_0xedaecc(0x1ae)]=_0x1a35a2;}),_0x102c46[_0x1c99ab(0x21b)]((_0xdc48bc,_0x2a97c7)=>{var _0x5d25ed=_0x1c99ab;_0x5504db[_0x2a97c7][_0x5d25ed(0x24c)]=_0xdc48bc;}),_0x3bde5[_0x1c99ab(0x21b)]((_0x5bbec5,_0x3951b7)=>{var _0x4f995a=_0x1c99ab;_0x5504db[_0x3951b7][_0x4f995a(0x25e)]=_0x5bbec5;}),_0x1fe457['forEach']((_0x22d199,_0x320fe1)=>{var _0x34bddd=_0x1c99ab;_0x5504db[_0x320fe1][_0x34bddd(0x240)]=_0x22d199;}),_0x3a73fd[_0x1c99ab(0x21b)]((_0x5f11ec,_0x2e0ea5)=>{var _0x4c39da=_0x1c99ab;_0x5504db[_0x2e0ea5][_0x4c39da(0x2a4)]=_0x5f11ec;}),_0x35cb71['forEach']((_0x3b9168,_0x5946b6)=>{var _0x5150f5=_0x1c99ab;_0x5504db[_0x5946b6][_0x5150f5(0x1d1)]=_0x3b9168;}),_0x523efe[_0x1c99ab(0x21b)]((_0x37930d,_0x3c9deb)=>{var _0xe35110=_0x1c99ab;_0x5504db[_0x3c9deb][_0xe35110(0x1c7)]=_0x37930d;}),_0x332442[_0x1c99ab(0x21b)]((_0x2a9624,_0x3aed17)=>{var _0x44dc19=_0x1c99ab;_0x5504db[_0x3aed17][_0x44dc19(0x1f7)]=_0x2a9624;}),_0xa0a23['forEach']((_0x5485ab,_0x5e6acc)=>{var _0x3903d8=_0x1c99ab;_0x5504db[_0x5e6acc][_0x3903d8(0x222)]=_0x5485ab;});var _0x7c90e3=0x0;_0x5504db[_0x1c99ab(0x21b)](_0x403291=>{var _0x3e47cd=_0x1c99ab;(_0x403291[_0x3e47cd(0x25c)]<_0x403291['quantity_notConverted']||_0x403291[_0x3e47cd(0x1c7)]==0x0)&&(console[_0x3e47cd(0x262)](_0x3e47cd(0x243),_0x403291),_0x7c90e3++);});const _0x443d35=_0x5504db[_0x1c99ab(0x1e0)](_0x38e897=>_0x38e897[_0x1c99ab(0x211)]!=='0'&&_0x38e897['quantity']!==''),_0x31e0c5=new sales({'invoice':_0x2aa79a,'customer':_0x7d0f62['body'][_0x1c99ab(0x1ed)],'date':_0x2f7d91,'warehouse_name':_0x57ae3e,'sale_product':_0x443d35,'note':_0x20e9e6,'room':_0x290da1,'primary_code':_0x5a11ec,'secondary_code':_0x212247,'prod_code':_0x2ce3c9,'SCRN':_0x6bc4da}),_0x488e6d=await _0x31e0c5[_0x1c99ab(0x250)]();_0x7d0f62[_0x1c99ab(0x1cc)](_0x1c99ab(0x1c3),_0x1c99ab(0x298)),_0x170896[_0x1c99ab(0x1d0)]('/all_sales/preview/'+_0x488e6d[_0x1c99ab(0x2a2)]);}catch(_0x3d424b){console['log'](_0x3d424b);}}),router[a0_0x2548e2(0x2a0)](a0_0x2548e2(0x1d2),auth,async(_0x3e69c1,_0x3b78cd)=>{var _0xac971c=a0_0x2548e2;try{const {username:_0x114bee,email:_0x406759,role:_0x1182df}=_0x3e69c1[_0xac971c(0x294)],_0x518f6f=_0x3e69c1['user'],_0x16ebed=await profile[_0xac971c(0x2b4)]({'email':_0x518f6f[_0xac971c(0x20c)]}),_0xc2644d=await master_shop['find'](),_0x12e729=_0x3e69c1[_0xac971c(0x2a5)]['id'],_0x17bf00=await sales[_0xac971c(0x20a)](_0x12e729),_0x142621=await warehouse['aggregate']([{'$match':{'name':_0x17bf00['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0xac971c(0x202),'name':{'$first':_0xac971c(0x23a)},'product_stock':{'$first':_0xac971c(0x296)},'bay':{'$first':_0xac971c(0x218)},'bin':{'$first':_0xac971c(0x27c)},'type':{'$first':_0xac971c(0x1e6)},'floorlevel':{'$first':_0xac971c(0x28f)},'primary_code':{'$first':_0xac971c(0x216)},'secondary_code':{'$first':_0xac971c(0x28a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xac971c(0x2a3)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xac971c(0x25d)},'invoice':{'$first':_0xac971c(0x1c2)}}}]),_0x5031bc=await customer[_0xac971c(0x279)]({});let _0xbb1ec4;if(_0x518f6f[_0xac971c(0x235)]==_0xac971c(0x1f2)){const _0x339a57=await staff[_0xac971c(0x2b4)]({'email':_0x518f6f[_0xac971c(0x20c)]});_0xbb1ec4=await warehouse[_0xac971c(0x1da)]([{'$match':{'status':'Enabled','name':_0x339a57[_0xac971c(0x245)]}},{'$group':{'_id':_0xac971c(0x206),'name':{'$first':'$name'}}}]);}else _0xbb1ec4=await warehouse[_0xac971c(0x1da)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0xac971c(0x206)}}}]);const _0x1a1465=await product[_0xac971c(0x279)]({}),_0x1742fc=await suppliers['find']({});if(_0xc2644d[0x0]['language']==_0xac971c(0x2a8)){var _0x5997a1=users[_0xac971c(0x1a3)];console[_0xac971c(0x262)](_0x5997a1);}else{if(_0xc2644d[0x0]['language']==_0xac971c(0x28c))var _0x5997a1=users[_0xac971c(0x28c)];else{if(_0xc2644d[0x0]['language']==_0xac971c(0x210))var _0x5997a1=users[_0xac971c(0x210)];else{if(_0xc2644d[0x0][_0xac971c(0x1de)]=='Spanish')var _0x5997a1=users['Spanish'];else{if(_0xc2644d[0x0][_0xac971c(0x1de)]==_0xac971c(0x270))var _0x5997a1=users['French'];else{if(_0xc2644d[0x0]['language']==_0xac971c(0x278))var _0x5997a1=users['Portuguese'];else{if(_0xc2644d[0x0][_0xac971c(0x1de)]==_0xac971c(0x239))var _0x5997a1=users[_0xac971c(0x239)];else{if(_0xc2644d[0x0][_0xac971c(0x1de)]==_0xac971c(0x21c))var _0x5997a1=users[_0xac971c(0x2a7)];}}}}}}}_0x3b78cd[_0xac971c(0x1f8)](_0xac971c(0x20f),{'success':_0x3e69c1[_0xac971c(0x1cc)](_0xac971c(0x1c3)),'errors':_0x3e69c1['flash'](_0xac971c(0x23e)),'role':_0x518f6f,'profile':_0x16ebed,'customer':_0x5031bc,'warehouse':_0xbb1ec4,'product':_0x142621,'user':_0x17bf00,'master_shop':_0xc2644d,'unit':_0x1a1465,'language':_0x5997a1,'suppliers':_0x1742fc});}catch(_0x4efb00){console[_0xac971c(0x262)](_0x4efb00);}}),router[a0_0x2548e2(0x20e)](a0_0x2548e2(0x1d2),auth,async(_0x7c93b,_0x198bcb)=>{var _0xd04cf=a0_0x2548e2;try{const _0x3f2e6e=_0x7c93b[_0xd04cf(0x2a5)]['id'],{invoice:_0x142fd5,warehouse_name:_0x2c573d,room:_0x29808b}=_0x7c93b[_0xd04cf(0x265)],_0x5b7ad4=await sales[_0xd04cf(0x2b4)]({'invoice':_0x142fd5}),_0x4157c9=_0x5b7ad4[_0xd04cf(0x281)]['map'](async _0x1017c8=>{var _0xc4c32b=_0xd04cf,_0x5e1d05=await warehouse['findOne']({'name':_0x2c573d,'room':_0x1017c8[_0xc4c32b(0x1f7)],'warehouse_category':_0xc4c32b(0x204)});const _0x44bced=_0x5e1d05[_0xc4c32b(0x254)]['map'](_0x4276c2=>{var _0x3b440b=_0xc4c32b;_0x4276c2[_0x3b440b(0x258)]==_0x1017c8[_0x3b440b(0x258)]&&_0x4276c2[_0x3b440b(0x1aa)]==_0x1017c8[_0x3b440b(0x1aa)]&&_0x4276c2[_0x3b440b(0x1ef)]==_0x1017c8[_0x3b440b(0x1ef)]&&_0x4276c2[_0x3b440b(0x264)]==_0x1017c8[_0x3b440b(0x264)]&&_0x4276c2[_0x3b440b(0x1f3)]==_0x1017c8[_0x3b440b(0x1f3)]&&_0x4276c2[_0x3b440b(0x249)]==_0x1017c8[_0x3b440b(0x249)]&&_0x4276c2[_0x3b440b(0x1b6)]==_0x1017c8[_0x3b440b(0x1b6)]&&_0x4276c2[_0x3b440b(0x1b2)]==_0x1017c8[_0x3b440b(0x1b2)]&&_0x4276c2[_0x3b440b(0x1fa)]==_0x1017c8['batch_code']&&_0x4276c2[_0x3b440b(0x2a2)]==_0x1017c8['id_transaction_from']&&(_0x4276c2[_0x3b440b(0x27f)]=Math[_0x3b440b(0x277)](0x0,Math[_0x3b440b(0x23d)](_0x4276c2[_0x3b440b(0x27f)])-Math[_0x3b440b(0x23d)](_0x1017c8[_0x3b440b(0x211)])));});return _0x5e1d05;});Promise[_0xd04cf(0x256)](_0x4157c9)[_0xd04cf(0x207)](async _0x415265=>{var _0x54b220=_0xd04cf;try{for(const _0x2478e6 of _0x415265){await _0x2478e6[_0x54b220(0x250)]();}_0x5b7ad4['finalize']=_0x54b220(0x273);const _0x334453=await _0x5b7ad4[_0x54b220(0x250)](),_0x586675=await master_shop[_0x54b220(0x279)](),_0x4c565e=await email_settings[_0x54b220(0x2b4)](),_0x39b593=await supervisor_settings['find']();var _0x2b7727=_0x5b7ad4[_0x54b220(0x281)],_0x42ffce='',_0x391c6b;for(_0x391c6b in _0x2b7727){_0x42ffce+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b7727[_0x391c6b][_0x54b220(0x258)]+_0x54b220(0x220)+_0x54b220(0x1ad)+_0x2b7727[_0x391c6b][_0x54b220(0x24a)]+'</td>'+_0x54b220(0x1ad)+_0x2b7727[_0x391c6b][_0x54b220(0x211)]+'</td>'+_0x54b220(0x1ad)+_0x2b7727[_0x391c6b][_0x54b220(0x2ad)]+_0x54b220(0x220)+_0x54b220(0x1ad)+_0x2b7727[_0x391c6b]['secondary_unit']+_0x54b220(0x220)+_0x54b220(0x1ad)+_0x5b7ad4[_0x54b220(0x1a0)]+_0x54b220(0x220)+_0x54b220(0x1ad)+_0x2b7727[_0x391c6b]['room_name']+_0x54b220(0x220)+_0x54b220(0x1ad)+_0x2b7727[_0x391c6b][_0x54b220(0x1b6)]+_0x2b7727[_0x391c6b][_0x54b220(0x249)]+_0x2b7727[_0x391c6b][_0x54b220(0x1f3)]+_0x2b7727[_0x391c6b][_0x54b220(0x264)]+_0x2b7727[_0x391c6b][_0x54b220(0x1ef)][0x0]+_0x2b7727[_0x391c6b][_0x54b220(0x1aa)]+'</td>','</tr>';}let _0x13ff77=nodemailer[_0x54b220(0x209)]({'host':_0x4c565e['host'],'port':Number(_0x4c565e[_0x54b220(0x225)]),'secure':![],'auth':{'user':_0x4c565e['email'],'pass':_0x4c565e['password']}}),_0x5571c4={'from':_0x4c565e[_0x54b220(0x20c)],'to':_0x39b593[0x0][_0x54b220(0x27d)],'subject':_0x54b220(0x253),'attachments':[{'filename':_0x54b220(0x26d),'path':__dirname+_0x54b220(0x1ca)+'/upload/'+_0x586675[0x0][_0x54b220(0x289)],'cid':'logo'}],'html':_0x54b220(0x297)+'<html><head><title></title>'+_0x54b220(0x266)+_0x54b220(0x2af)+_0x54b220(0x29f)+_0x54b220(0x2af)+_0x54b220(0x21e)+_0x54b220(0x1a5)+_0x54b220(0x2af)+_0x54b220(0x29e)+_0x586675[0x0]['site_title']+_0x54b220(0x1f0)+'</div>'+_0x54b220(0x1a5)+'<hr\x20class=\x22my-3\x22>'+_0x54b220(0x2af)+_0x54b220(0x28b)+_0x54b220(0x241)+_0x5b7ad4[_0x54b220(0x222)]+'\x20'+_0x54b220(0x237)+'\x20Order\x20Date\x20:\x20'+_0x5b7ad4[_0x54b220(0x29a)]+'\x20'+_0x54b220(0x2a6)+_0x54b220(0x25b)+_0x54b220(0x1a5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x54b220(0x267)+_0x54b220(0x276)+_0x54b220(0x230)+_0x54b220(0x20d)+_0x54b220(0x1f1)+_0x54b220(0x2b3)+_0x54b220(0x24e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x54b220(0x26a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x54b220(0x226)+_0x54b220(0x1ac)+_0x54b220(0x208)+'\x20'+_0x42ffce+'\x20'+_0x54b220(0x1a1)+_0x54b220(0x247)+_0x54b220(0x2af)+'<strong>\x20Regards\x20</strong>'+_0x54b220(0x1c9)+_0x586675[0x0][_0x54b220(0x24d)]+_0x54b220(0x25b)+_0x54b220(0x1a5)+'</div>'+_0x54b220(0x1d9)};_0x13ff77['sendMail'](_0x5571c4,function(_0x5e9de8,_0x394150){var _0x1cd7a9=_0x54b220;_0x5e9de8?(console['log'](_0x5e9de8),console['log'](_0x1cd7a9(0x26f))):console['log'](_0x1cd7a9(0x25f));}),_0x7c93b[_0x54b220(0x1cc)](_0x54b220(0x1c3),_0x54b220(0x268)),_0x198bcb[_0x54b220(0x1d0)](_0x54b220(0x1d4)+_0x3f2e6e);}catch(_0x2416da){console[_0x54b220(0x1e7)](_0x2416da),_0x198bcb[_0x54b220(0x22d)](0x1f4)[_0x54b220(0x283)]({'error':_0x54b220(0x1cb)});}})[_0xd04cf(0x299)](_0x21561f=>{var _0x3005da=_0xd04cf;console['error'](_0x21561f),_0x198bcb[_0x3005da(0x22d)](0x1f4)[_0x3005da(0x283)]({'error':_0x3005da(0x1cf)});});}catch(_0x6c89c6){console[_0xd04cf(0x262)](_0x6c89c6);}}),router['get']('/view/:id',auth,async(_0x2e89ec,_0x4516d2)=>{var _0x43a5a4=a0_0x2548e2;try{const {username:_0x220eb8,email:_0x441b81,role:_0x2ce2ce}=_0x2e89ec['user'],_0x35d2eb=_0x2e89ec['user'],_0x288daf=await profile[_0x43a5a4(0x2b4)]({'email':_0x35d2eb[_0x43a5a4(0x20c)]}),_0x33b844=await master_shop[_0x43a5a4(0x279)](),_0x118c1c=_0x2e89ec['params']['id'],_0x33ac20=await sales[_0x43a5a4(0x20a)](_0x118c1c);var _0x323767=['Ambient',_0x43a5a4(0x1e3)];const _0x4db7aa=await warehouse[_0x43a5a4(0x1da)]([{'$match':{'name':_0x33ac20[_0x43a5a4(0x1a0)],'warehouse_category':_0x43a5a4(0x204)}},{'$unwind':_0x43a5a4(0x1c8)},{'$group':{'_id':_0x43a5a4(0x202),'name':{'$first':_0x43a5a4(0x23a)},'product_stock':{'$first':_0x43a5a4(0x296)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x43a5a4(0x27c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x43a5a4(0x28f)},'primary_code':{'$first':_0x43a5a4(0x216)},'secondary_code':{'$first':_0x43a5a4(0x28a)},'product_code':{'$first':_0x43a5a4(0x19f)},'storage':{'$first':_0x43a5a4(0x2a3)},'rack':{'$first':'$product_details.rack'}}}]),_0x3241b9=await customer[_0x43a5a4(0x279)]({});let _0x216152;if(_0x35d2eb[_0x43a5a4(0x235)]==_0x43a5a4(0x1f2)){const _0x1dc80f=await staff['findOne']({'email':_0x35d2eb[_0x43a5a4(0x20c)]});_0x216152=await warehouse[_0x43a5a4(0x1da)]([{'$match':{'status':_0x43a5a4(0x287),'name':_0x1dc80f[_0x43a5a4(0x245)],'warehouse_category':_0x43a5a4(0x204)}},{'$group':{'_id':_0x43a5a4(0x206),'name':{'$first':'$name'}}}]);}else _0x216152=await warehouse['aggregate']([{'$match':{'status':_0x43a5a4(0x287),'warehouse_category':_0x43a5a4(0x204)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x43695f=await product[_0x43a5a4(0x279)]({});if(_0x33b844[0x0][_0x43a5a4(0x1de)]==_0x43a5a4(0x2a8)){var _0x4fe0f5=users[_0x43a5a4(0x1a3)];console[_0x43a5a4(0x262)](_0x4fe0f5);}else{if(_0x33b844[0x0][_0x43a5a4(0x1de)]==_0x43a5a4(0x28c))var _0x4fe0f5=users[_0x43a5a4(0x28c)];else{if(_0x33b844[0x0][_0x43a5a4(0x1de)]==_0x43a5a4(0x210))var _0x4fe0f5=users[_0x43a5a4(0x210)];else{if(_0x33b844[0x0][_0x43a5a4(0x1de)]==_0x43a5a4(0x1d5))var _0x4fe0f5=users['Spanish'];else{if(_0x33b844[0x0]['language']==_0x43a5a4(0x270))var _0x4fe0f5=users['French'];else{if(_0x33b844[0x0]['language']==_0x43a5a4(0x278))var _0x4fe0f5=users[_0x43a5a4(0x1bd)];else{if(_0x33b844[0x0][_0x43a5a4(0x1de)]==_0x43a5a4(0x239))var _0x4fe0f5=users[_0x43a5a4(0x239)];else{if(_0x33b844[0x0][_0x43a5a4(0x1de)]==_0x43a5a4(0x21c))var _0x4fe0f5=users[_0x43a5a4(0x2a7)];}}}}}}}_0x4516d2[_0x43a5a4(0x1f8)](_0x43a5a4(0x1f4),{'success':_0x2e89ec[_0x43a5a4(0x1cc)](_0x43a5a4(0x1c3)),'errors':_0x2e89ec[_0x43a5a4(0x1cc)](_0x43a5a4(0x23e)),'role':_0x35d2eb,'profile':_0x288daf,'customer':_0x3241b9,'warehouse':_0x216152,'product':_0x4db7aa,'user':_0x33ac20,'master_shop':_0x33b844,'unit':_0x43695f,'language':_0x4fe0f5});}catch(_0x50cb30){console[_0x43a5a4(0x262)](_0x50cb30);}}),router[a0_0x2548e2(0x20e)](a0_0x2548e2(0x255),auth,async(_0x1f5423,_0x51eb8f)=>{var _0x3d987d=a0_0x2548e2;try{const _0x204438=_0x1f5423[_0x3d987d(0x2a5)]['id'],_0x266a65=await sales[_0x3d987d(0x2b4)]({'_id':_0x1f5423['params']['id']}),_0x14a87c=await warehouse[_0x3d987d(0x2b4)]({'name':_0x266a65[_0x3d987d(0x1a0)],'room':_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x1bc)]}),{invoice:_0x5630eb,date:_0x3bc01c,warehouse_name:_0x39cc4d,product_name:_0x436b7c,stock:_0x21cdce,quantity:_0x2b73d6,note:_0xb45485,room:_0x5f44c3,customer:_0x225498,SCRN:_0x3ff6e5}=_0x1f5423[_0x3d987d(0x265)];if(typeof _0x436b7c=='string')var _0x2c166d=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x258)]],_0x44148b=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x25c)]],_0x1fda37=[_0x1f5423[_0x3d987d(0x265)]['carton']],_0x294b49=[_0x1f5423['body'][_0x3d987d(0x29d)]],_0x1823e0=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x1b8)]],_0x37836f=[_0x1f5423['body'][_0x3d987d(0x23b)]],_0x5e68ec=[_0x1f5423['body'][_0x3d987d(0x285)]],_0x7f07f9=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x261)]],_0x4a7831=[_0x1f5423['body']['secondary_unit']],_0x266f53=[_0x1f5423[_0x3d987d(0x265)]['batch_code']],_0x27f596=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x1b2)]],_0x1263e7=[_0x1f5423['body'][_0x3d987d(0x252)]],_0x3e99d6=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x24c)]],_0x5b68a9=[_0x1f5423[_0x3d987d(0x265)]['requested_qty']],_0x5e2bcc=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x240)]],_0x47f90f=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x2a4)]],_0x38ba4b=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x1d1)]],_0x3a0ffa=[_0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x211)]],_0x428df0=[_0x1f5423['body'][_0x3d987d(0x212)]];else var _0x2c166d=[..._0x1f5423[_0x3d987d(0x265)]['product_name']],_0x44148b=[..._0x1f5423['body'][_0x3d987d(0x25c)]],_0x1fda37=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x29b)]],_0x294b49=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x29d)]],_0x1823e0=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x1b8)]],_0x37836f=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x23b)]],_0x5e68ec=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x285)]],_0x7f07f9=[..._0x1f5423['body'][_0x3d987d(0x261)]],_0x4a7831=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x201)]],_0x266f53=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x1fa)]],_0x27f596=[..._0x1f5423['body'][_0x3d987d(0x1b2)]],_0x1263e7=[..._0x1f5423['body'][_0x3d987d(0x252)]],_0x3e99d6=[..._0x1f5423[_0x3d987d(0x265)]['production_date']],_0x5b68a9=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x25e)]],_0x5e2bcc=[..._0x1f5423['body'][_0x3d987d(0x240)]],_0x47f90f=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x2a4)]],_0x38ba4b=[..._0x1f5423[_0x3d987d(0x265)]['prod_cat']],_0x3a0ffa=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x211)]],_0x428df0=[..._0x1f5423[_0x3d987d(0x265)][_0x3d987d(0x212)]];const _0x43c32f=_0x2c166d['map'](_0x2ebda4=>{return _0x2ebda4={'product_name':_0x2ebda4};});_0x44148b[_0x3d987d(0x21b)]((_0x5b0156,_0x94b4cf)=>{var _0x163823=_0x3d987d;_0x43c32f[_0x94b4cf][_0x163823(0x25c)]=Math[_0x163823(0x23d)](_0x5b0156);}),_0x1fda37[_0x3d987d(0x21b)]((_0x5234c4,_0x2a256e)=>{var _0x2d6788=_0x3d987d;_0x43c32f[_0x2a256e][_0x2d6788(0x211)]=_0x5234c4;}),_0x294b49['forEach']((_0x19e844,_0xc229cf)=>{var _0x147ded=_0x3d987d;_0x43c32f[_0xc229cf][_0x147ded(0x29d)]=_0x19e844;}),_0x1823e0['forEach']((_0x122ed5,_0x333d7c)=>{var _0x55fa57=_0x3d987d;_0x43c32f[_0x333d7c][_0x55fa57(0x1b8)]=_0x122ed5;}),_0x37836f[_0x3d987d(0x21b)]((_0x8badd9,_0x5b6aa6)=>{var _0x613ae5=_0x3d987d;_0x43c32f[_0x5b6aa6][_0x613ae5(0x24a)]=_0x8badd9;}),_0x5e68ec['forEach']((_0x5d62a0,_0x2ba7cb)=>{_0x428df0['forEach']((_0x1add1c,_0x4f118c)=>{var _0x3a2400=a0_0x53ed;if(_0x1add1c==_0x3a2400(0x27e)&&_0x2ba7cb==_0x4f118c){var _0x1b453d=_0x5d62a0[_0x3a2400(0x200)](0x3);_0x43c32f[_0x2ba7cb]['storage']=_0x5d62a0[0x0],_0x43c32f[_0x2ba7cb][_0x3a2400(0x249)]=_0x5d62a0[0x1],_0x43c32f[_0x2ba7cb][_0x3a2400(0x1f3)]=0x0,_0x43c32f[_0x2ba7cb]['bin']=0x0,_0x43c32f[_0x2ba7cb][_0x3a2400(0x1ef)]=_0x3a2400(0x203),_0x43c32f[_0x2ba7cb]['floorlevel']=_0x1b453d;}else{if(_0x1add1c==_0x3a2400(0x251)&&_0x2ba7cb==_0x4f118c){var _0x1b453d=_0x5d62a0[_0x3a2400(0x200)](0x3);_0x43c32f[_0x2ba7cb][_0x3a2400(0x1b6)]=_0x5d62a0[0x0],_0x43c32f[_0x2ba7cb][_0x3a2400(0x249)]=_0x5d62a0[0x1],_0x43c32f[_0x2ba7cb][_0x3a2400(0x1f3)]=0x0,_0x43c32f[_0x2ba7cb][_0x3a2400(0x264)]=0x0,_0x43c32f[_0x2ba7cb][_0x3a2400(0x1ef)]=_0x3a2400(0x203),_0x43c32f[_0x2ba7cb][_0x3a2400(0x1aa)]=_0x5d62a0[0x5];}else{if(_0x2ba7cb==_0x4f118c){var _0x548bfc;if(_0x5d62a0[0x4]=='L')_0x548bfc=_0x3a2400(0x1f9);else _0x5d62a0[0x4]=='F'&&(_0x548bfc=_0x3a2400(0x203));_0x43c32f[_0x2ba7cb]['storage']=_0x5d62a0[0x0],_0x43c32f[_0x2ba7cb][_0x3a2400(0x249)]=_0x5d62a0[0x1],_0x43c32f[_0x2ba7cb][_0x3a2400(0x1f3)]=_0x5d62a0[0x2],_0x43c32f[_0x2ba7cb][_0x3a2400(0x264)]=_0x5d62a0[0x3],_0x43c32f[_0x2ba7cb][_0x3a2400(0x1ef)]=_0x548bfc,_0x43c32f[_0x2ba7cb][_0x3a2400(0x1aa)]=_0x5d62a0[0x5];}}}});}),_0x7f07f9['forEach']((_0x5c62b6,_0x5d2a61)=>{var _0x5510af=_0x3d987d;_0x43c32f[_0x5d2a61][_0x5510af(0x2ad)]=_0x5c62b6;}),_0x4a7831[_0x3d987d(0x21b)]((_0x42c18f,_0xb94298)=>{var _0x32216e=_0x3d987d;_0x43c32f[_0xb94298][_0x32216e(0x201)]=_0x42c18f;}),_0x266f53[_0x3d987d(0x21b)]((_0x5cbfcf,_0x48ad07)=>{var _0x91b431=_0x3d987d;_0x43c32f[_0x48ad07][_0x91b431(0x1fa)]=_0x5cbfcf;}),_0x27f596[_0x3d987d(0x21b)]((_0x297ea2,_0x3281dc)=>{var _0x219720=_0x3d987d;_0x43c32f[_0x3281dc][_0x219720(0x1b2)]=_0x297ea2;}),_0x1263e7[_0x3d987d(0x21b)]((_0x2aac75,_0x2bda0a)=>{var _0x255274=_0x3d987d;_0x43c32f[_0x2bda0a][_0x255274(0x1ae)]=_0x2aac75;}),_0x3e99d6[_0x3d987d(0x21b)]((_0x12fc79,_0x1a637e)=>{var _0x4145f8=_0x3d987d;_0x43c32f[_0x1a637e][_0x4145f8(0x24c)]=_0x12fc79;}),_0x5b68a9['forEach']((_0x61caec,_0x5070d8)=>{var _0x54d4eb=_0x3d987d;_0x43c32f[_0x5070d8][_0x54d4eb(0x25e)]=Math[_0x54d4eb(0x23d)](_0x61caec);}),_0x5e2bcc[_0x3d987d(0x21b)]((_0x55699f,_0x427fc8)=>{var _0x21565d=_0x3d987d;_0x43c32f[_0x427fc8][_0x21565d(0x240)]=_0x55699f;}),_0x47f90f[_0x3d987d(0x21b)]((_0x7cf7c,_0x238e44)=>{var _0x304488=_0x3d987d;_0x43c32f[_0x238e44][_0x304488(0x2a4)]=_0x7cf7c;}),_0x38ba4b[_0x3d987d(0x21b)]((_0x4a1641,_0x192193)=>{var _0x1d1bf4=_0x3d987d;_0x43c32f[_0x192193][_0x1d1bf4(0x1d1)]=_0x4a1641;}),_0x3a0ffa['forEach']((_0x2d6e04,_0x304e99)=>{var _0x7b406e=_0x3d987d;_0x43c32f[_0x304e99][_0x7b406e(0x1c7)]=_0x2d6e04;}),_0x428df0[_0x3d987d(0x21b)]((_0x3afd9e,_0x5de763)=>{_0x43c32f[_0x5de763]['room_name']=_0x3afd9e;});var _0x453edd=0x0;_0x43c32f['forEach'](_0x7e52b8=>{var _0xcd9bc2=_0x3d987d;console['log'](_0xcd9bc2(0x243),_0x7e52b8),(parseInt(_0x7e52b8['stock'])<parseInt(_0x7e52b8[_0xcd9bc2(0x211)])||parseInt(_0x7e52b8[_0xcd9bc2(0x211)])==0x0)&&_0x453edd++;});if(_0x453edd!=0x0)return _0x1f5423[_0x3d987d(0x1cc)](_0x3d987d(0x23e),_0x3d987d(0x1a8)),_0x51eb8f[_0x3d987d(0x1d0)](_0x3d987d(0x2ae));const _0x20a98f=_0x43c32f[_0x3d987d(0x1e0)](_0x50dc99=>_0x50dc99[_0x3d987d(0x211)]!=='0'&&_0x50dc99['quantity']!=='');_0x266a65[_0x3d987d(0x222)]=_0x5630eb,_0x266a65[_0x3d987d(0x1ed)]=_0x225498,_0x266a65[_0x3d987d(0x29a)]=_0x3bc01c,_0x266a65['warehouse_name']=_0x39cc4d,_0x266a65['sale_product']=_0x20a98f,_0x266a65['note']=_0xb45485,_0x266a65[_0x3d987d(0x259)]=_0x3ff6e5,_0x266a65['finalize']='False',_0x266a65[_0x3d987d(0x1c4)]=_0x3d987d(0x21f);const _0x3e8b14=await _0x266a65[_0x3d987d(0x250)]();_0x1f5423[_0x3d987d(0x1cc)](_0x3d987d(0x1c3),_0x3d987d(0x268)),_0x51eb8f[_0x3d987d(0x1d0)](_0x3d987d(0x1be));}catch(_0xdad433){console[_0x3d987d(0x262)](_0xdad433);}}),router[a0_0x2548e2(0x20e)](a0_0x2548e2(0x1a4),auth,async(_0x292785,_0x25c419)=>{var _0x2c54af=a0_0x2548e2;try{const _0x452e7f=_0x292785['params']['id'],{invoice:_0x320d14,customer:_0x246640,receivable_amount:_0x331c73,received_amount:_0x4ac434}=_0x292785[_0x2c54af(0x265)],_0x5de35a=await sales[_0x2c54af(0x20a)](_0x452e7f);console[_0x2c54af(0x262)](_0x5de35a);var _0x25e091=_0x331c73-_0x4ac434;console[_0x2c54af(0x262)](_0x4ac434),_0x5de35a['received_amount']=parseFloat(_0x4ac434)+parseFloat(_0x5de35a[_0x2c54af(0x2ab)]),_0x5de35a[_0x2c54af(0x1a7)]=_0x25e091,console[_0x2c54af(0x262)](_0x5de35a);const _0xf144b6=await _0x5de35a[_0x2c54af(0x250)](),_0x2b924e=await c_payment_data['findOne']({'invoice':_0x320d14});_0x2b924e[_0x2c54af(0x280)]=_0x25e091,await _0x2b924e[_0x2c54af(0x250)]();let _0x50fd2f=new Date(),_0x41acee=('0'+_0x50fd2f['getDate']())[_0x2c54af(0x200)](-0x2),_0x3b4bd1=('0'+(_0x50fd2f[_0x2c54af(0x1fe)]()+0x1))[_0x2c54af(0x200)](-0x2),_0x12b8f1=_0x50fd2f[_0x2c54af(0x1fd)](),_0x3cef78=_0x12b8f1+'-'+_0x3b4bd1+'-'+_0x41acee;const _0x45b89b=new customer_payment({'invoice':_0x320d14,'date':_0x12b8f1+'-'+_0x3b4bd1+'-'+_0x41acee,'customer':_0x246640,'reason':_0x2c54af(0x2b2),'amount':_0x4ac434}),_0x5d796d=await _0x45b89b['save']();_0x292785[_0x2c54af(0x1cc)]('success',_0x2c54af(0x1d6)),_0x25c419[_0x2c54af(0x1d0)]('/all_sales/view');}catch(_0x21cdcc){console[_0x2c54af(0x262)](_0x21cdcc);}}),router[a0_0x2548e2(0x2a0)](a0_0x2548e2(0x1ce),auth,async(_0x296ffb,_0x51b6c9)=>{var _0x6ea414=a0_0x2548e2;try{const {username:_0x2e622c,email:_0x20c9c3,role:_0x5127a1}=_0x296ffb[_0x6ea414(0x294)],_0x145e97=_0x296ffb[_0x6ea414(0x294)],_0x12a4e0=await profile[_0x6ea414(0x2b4)]({'email':_0x145e97['email']}),_0x4d706f=await master_shop['find']();console['log'](_0x6ea414(0x1bf),_0x4d706f);const _0x741231=_0x296ffb['params']['id'],_0x45a129=await sales[_0x6ea414(0x20a)](_0x741231);console[_0x6ea414(0x262)](_0x45a129);const _0x472513=await customer[_0x6ea414(0x2b4)]({'name':_0x45a129[_0x6ea414(0x1ed)]});console[_0x6ea414(0x262)](_0x472513);if(_0x4d706f[0x0][_0x6ea414(0x1de)]=='English\x20(US)'){var _0x55ae92=users[_0x6ea414(0x1a3)];console[_0x6ea414(0x262)](_0x55ae92);}else{if(_0x4d706f[0x0][_0x6ea414(0x1de)]==_0x6ea414(0x28c))var _0x55ae92=users[_0x6ea414(0x28c)];else{if(_0x4d706f[0x0][_0x6ea414(0x1de)]==_0x6ea414(0x210))var _0x55ae92=users['German'];else{if(_0x4d706f[0x0]['language']==_0x6ea414(0x1d5))var _0x55ae92=users[_0x6ea414(0x1d5)];else{if(_0x4d706f[0x0][_0x6ea414(0x1de)]==_0x6ea414(0x270))var _0x55ae92=users[_0x6ea414(0x270)];else{if(_0x4d706f[0x0][_0x6ea414(0x1de)]=='Portuguese\x20(BR)')var _0x55ae92=users[_0x6ea414(0x1bd)];else{if(_0x4d706f[0x0][_0x6ea414(0x1de)]=='Chinese')var _0x55ae92=users[_0x6ea414(0x239)];else{if(_0x4d706f[0x0][_0x6ea414(0x1de)]=='Arabic\x20(ae)')var _0x55ae92=users[_0x6ea414(0x2a7)];}}}}}}}_0x51b6c9['render'](_0x6ea414(0x228),{'success':_0x296ffb[_0x6ea414(0x1cc)]('success'),'errors':_0x296ffb[_0x6ea414(0x1cc)](_0x6ea414(0x23e)),'role':_0x145e97,'profile':_0x12a4e0,'master_shop':_0x4d706f,'customers':_0x472513,'sales':_0x45a129,'language':_0x55ae92});}catch(_0x492a1a){console[_0x6ea414(0x262)](_0x492a1a);}}),router['get'](a0_0x2548e2(0x263),auth,async(_0x40a83e,_0x23f119)=>{var _0x248a47=a0_0x2548e2;try{const {username:_0x5cf81a,email:_0x48990b,role:_0x3a087d}=_0x40a83e[_0x248a47(0x294)],_0x3c9d4a=_0x40a83e[_0x248a47(0x294)],_0xf442c2=await profile[_0x248a47(0x2b4)]({'email':_0x3c9d4a[_0x248a47(0x20c)]}),_0x13dab8=await master_shop[_0x248a47(0x279)]();console[_0x248a47(0x262)]('master',_0x13dab8);const _0x2d5b5d=_0x40a83e[_0x248a47(0x2a5)]['id'];console[_0x248a47(0x262)](_0x2d5b5d);const _0x5c3785=await sales[_0x248a47(0x20a)](_0x2d5b5d);console[_0x248a47(0x262)](_0x248a47(0x244),_0x5c3785);const _0x18af60=await warehouse[_0x248a47(0x1da)]([{'$match':{'name':_0x248a47(0x221),'room':'Return\x20Rooms'}},{'$unwind':_0x248a47(0x1c8)},{'$group':{'_id':_0x248a47(0x202),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x248a47(0x296)},'level':{'$first':_0x248a47(0x22a)},'isle':{'$first':_0x248a47(0x1b7)},'pallet':{'$first':_0x248a47(0x1af)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x248a47(0x28a)},'product_code':{'$first':_0x248a47(0x19f)}}}]);console[_0x248a47(0x262)]('stock_data',_0x18af60);const _0xd09a5b=await product[_0x248a47(0x279)]({});warehouse_data=await warehouse[_0x248a47(0x1da)]([{'$match':{'status':_0x248a47(0x287),'name':_0x248a47(0x221),'warehouse_category':_0x248a47(0x204)}},{'$group':{'_id':_0x248a47(0x206),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x4ac5b5=[_0x248a47(0x1fc)];if(_0x13dab8[0x0][_0x248a47(0x1de)]==_0x248a47(0x2a8)){var _0x516acd=users[_0x248a47(0x1a3)];console[_0x248a47(0x262)](_0x516acd);}else{if(_0x13dab8[0x0]['language']==_0x248a47(0x28c))var _0x516acd=users[_0x248a47(0x28c)];else{if(_0x13dab8[0x0][_0x248a47(0x1de)]==_0x248a47(0x210))var _0x516acd=users[_0x248a47(0x210)];else{if(_0x13dab8[0x0]['language']==_0x248a47(0x1d5))var _0x516acd=users[_0x248a47(0x1d5)];else{if(_0x13dab8[0x0][_0x248a47(0x1de)]==_0x248a47(0x270))var _0x516acd=users[_0x248a47(0x270)];else{if(_0x13dab8[0x0][_0x248a47(0x1de)]==_0x248a47(0x278))var _0x516acd=users['Portuguese'];else{if(_0x13dab8[0x0][_0x248a47(0x1de)]==_0x248a47(0x239))var _0x516acd=users['Chinese'];else{if(_0x13dab8[0x0][_0x248a47(0x1de)]=='Arabic\x20(ae)')var _0x516acd=users['Arabic'];}}}}}}}_0x23f119[_0x248a47(0x1f8)](_0x248a47(0x269),{'success':_0x40a83e['flash']('success'),'errors':_0x40a83e['flash']('errors'),'role':_0x3c9d4a,'profile':_0xf442c2,'user':_0x5c3785,'stock':_0x18af60,'master_shop':_0x13dab8,'unit':_0xd09a5b,'language':_0x516acd,'warehouses':warehouse_data,'rooms':_0x4ac5b5});}catch(_0x472698){console[_0x248a47(0x262)](_0x472698),_0x23f119[_0x248a47(0x22d)](0xc8)['json']({'message':_0x472698[_0x248a47(0x2aa)]});}}),router[a0_0x2548e2(0x20e)]('/view/return_sales/:id',auth,async(_0x489782,_0x3be6b1)=>{var _0x4172d1=a0_0x2548e2;try{const {invoice:_0x5a765e,date:_0x11d1b2,warehouse_name:_0x518d05,product_name:_0x298169,primary_code:_0x44c638,secondary_code:_0x456d1e,product_code:_0x30fc4a,sales_quantity:_0xada061,stocks:_0xf5ded9,return_qty:_0x5a4b35,Room_name:_0xabbbf0,to_warehouse_name:_0x336a3d,to_Roomname:_0x255bef,to_Room_name:_0x54d987,note:_0x57cd1a,level:_0x4e54b2,isle:_0x230beb,pallet:_0x51c993}=_0x489782['body'];if(typeof _0x298169==_0x4172d1(0x234))var _0x14215a=[_0x489782[_0x4172d1(0x265)]['product_name']],_0x423c10=[_0x489782['body'][_0x4172d1(0x29d)]],_0x3b69e9=[_0x489782[_0x4172d1(0x265)][_0x4172d1(0x1b8)]],_0x10157=[_0x489782[_0x4172d1(0x265)][_0x4172d1(0x24a)]],_0x17af9f=[_0x489782[_0x4172d1(0x265)][_0x4172d1(0x22c)]],_0x306ec7=[_0x489782[_0x4172d1(0x265)][_0x4172d1(0x1cd)]],_0x293437=[_0x489782['body'][_0x4172d1(0x1ff)]],_0x5d3c77=[_0x489782['body'][_0x4172d1(0x1f3)]],_0x2d91b6=[_0x489782[_0x4172d1(0x265)][_0x4172d1(0x264)]],_0x3bc3a1=[_0x489782[_0x4172d1(0x265)]['types']],_0x30eff7=[_0x489782[_0x4172d1(0x265)][_0x4172d1(0x1aa)]];else var _0x14215a=[..._0x489782[_0x4172d1(0x265)]['product_name']],_0x423c10=[..._0x489782['body'][_0x4172d1(0x29d)]],_0x3b69e9=[..._0x489782[_0x4172d1(0x265)][_0x4172d1(0x1b8)]],_0x10157=[..._0x489782[_0x4172d1(0x265)][_0x4172d1(0x24a)]],_0x17af9f=[..._0x489782[_0x4172d1(0x265)]['sales_quantity']],_0x306ec7=[..._0x489782[_0x4172d1(0x265)]['stocks']],_0x293437=[..._0x489782[_0x4172d1(0x265)][_0x4172d1(0x1ff)]],_0x5d3c77=[..._0x489782['body']['bay']],_0x2d91b6=[..._0x489782[_0x4172d1(0x265)][_0x4172d1(0x264)]],_0x3bc3a1=[..._0x489782[_0x4172d1(0x265)][_0x4172d1(0x224)]],_0x30eff7=[..._0x489782['body']['floorlevel']];const _0x2a062f=_0x14215a[_0x4172d1(0x1b1)](_0x144382=>{return _0x144382={'product_name':_0x144382};});_0x423c10[_0x4172d1(0x21b)]((_0x1ad385,_0x57fd4b)=>{var _0x4cb187=_0x4172d1;_0x2a062f[_0x57fd4b][_0x4cb187(0x29d)]=_0x1ad385;}),_0x3b69e9[_0x4172d1(0x21b)]((_0x2373f4,_0x40d240)=>{_0x2a062f[_0x40d240]['secondary_code']=_0x2373f4;}),_0x10157[_0x4172d1(0x21b)]((_0xb45578,_0x37ae22)=>{var _0x5d829e=_0x4172d1;_0x2a062f[_0x37ae22][_0x5d829e(0x24a)]=_0xb45578;}),_0x17af9f['forEach']((_0xaf544,_0x3742b7)=>{_0x2a062f[_0x3742b7]['sale_qty']=_0xaf544;}),_0x306ec7['forEach']((_0x58b7f6,_0x41b7a1)=>{var _0x264396=_0x4172d1;_0x2a062f[_0x41b7a1][_0x264396(0x25c)]=_0x58b7f6;}),_0x293437[_0x4172d1(0x21b)]((_0x584cbb,_0x1a1fb2)=>{var _0x94157e=_0x4172d1;_0x2a062f[_0x1a1fb2][_0x94157e(0x1ff)]=_0x584cbb;}),_0x5d3c77[_0x4172d1(0x21b)]((_0x159beb,_0x3a3850)=>{var _0x9e3370=_0x4172d1;_0x2a062f[_0x3a3850][_0x9e3370(0x1f3)]=_0x159beb;}),_0x2d91b6[_0x4172d1(0x21b)]((_0x2e552a,_0x30bcab)=>{var _0x50aa91=_0x4172d1;_0x2a062f[_0x30bcab][_0x50aa91(0x264)]=_0x2e552a;}),_0x3bc3a1[_0x4172d1(0x21b)]((_0x1ee790,_0x26d69b)=>{var _0x306952=_0x4172d1;_0x2a062f[_0x26d69b][_0x306952(0x1ef)]=_0x1ee790;}),_0x30eff7[_0x4172d1(0x21b)]((_0x194f0f,_0xa7f631)=>{_0x2a062f[_0xa7f631]['floorlevel']=_0x194f0f;});var _0x3adf91=0x0;_0x2a062f[_0x4172d1(0x21b)](_0x23d5d9=>{var _0x46c2f7=_0x4172d1;console[_0x46c2f7(0x262)](_0x46c2f7(0x243),_0x23d5d9),(parseInt(_0x23d5d9['sale_qty'])<parseInt(_0x23d5d9[_0x46c2f7(0x1ff)])||parseInt(_0x23d5d9[_0x46c2f7(0x25c)])<parseInt(_0x23d5d9['return_qty'])&&parseInt(_0x23d5d9[_0x46c2f7(0x28d)])>parseInt(_0x23d5d9['return_qty'])||parseInt(_0x23d5d9[_0x46c2f7(0x1ff)])==0x0)&&_0x3adf91++;});if(_0x3adf91!=0x0)return _0x489782['flash'](_0x4172d1(0x23e),_0x4172d1(0x260)),_0x3be6b1[_0x4172d1(0x1d0)](_0x4172d1(0x2ae));const _0x578665=await sales[_0x4172d1(0x2b4)]({'invoice':_0x5a765e});console[_0x4172d1(0x262)](_0x578665),_0x578665[_0x4172d1(0x1c5)]=_0x4172d1(0x273);const _0xcddc92=await _0x578665[_0x4172d1(0x250)](),_0x19af1c=new sales_return({'invoice':_0x5a765e,'customer':_0x489782['body']['customer'],'date':_0x11d1b2,'warehouse_name':_0x518d05,'room':_0xabbbf0,'ToWarehouse':_0x336a3d,'ToRoom':_0x54d987,'return_sale':_0x2a062f,'note':_0x57cd1a}),_0x25c0b7=await _0x19af1c[_0x4172d1(0x250)]();console[_0x4172d1(0x262)](_0x19af1c);const _0xfd782b=await sales_return[_0x4172d1(0x2b4)]({'invoice':_0x5a765e}),_0x595365=await warehouse[_0x4172d1(0x2b4)]({'name':_0x336a3d,'room':_0x54d987});_0xfd782b[_0x4172d1(0x269)][_0x4172d1(0x21b)](_0x4760ad=>{var _0x52c931=_0x4172d1,_0x268f5c=0x0;const _0x404fb8=_0x595365[_0x52c931(0x254)][_0x52c931(0x1b1)](_0x1e14e0=>{var _0x127e10=_0x52c931;_0x1e14e0[_0x127e10(0x258)]==_0x4760ad['product_name']&&_0x1e14e0[_0x127e10(0x1aa)]==_0x4760ad[_0x127e10(0x1aa)]&&_0x1e14e0[_0x127e10(0x1ef)]==_0x4760ad[_0x127e10(0x1ef)]&&_0x1e14e0['bin']==_0x4760ad[_0x127e10(0x264)]&&_0x1e14e0[_0x127e10(0x1f3)]==_0x4760ad['bay']&&(_0x1e14e0[_0x127e10(0x27f)]=parseInt(_0x1e14e0['product_stock'])+parseInt(_0x4760ad[_0x127e10(0x1ff)]),_0x268f5c++);});_0x268f5c=='0'&&(_0x595365['product_details']=_0x595365[_0x52c931(0x254)][_0x52c931(0x29c)]({'product_name':_0x4760ad[_0x52c931(0x258)],'product_stock':_0x4760ad['return_qty'],'primary_code':_0x4760ad[_0x52c931(0x29d)],'secondary_code':_0x4760ad['secondary_code'],'product_code':_0x4760ad[_0x52c931(0x24a)],'bay':_0x4760ad[_0x52c931(0x1f3)],'bin':_0x4760ad[_0x52c931(0x264)],'type':_0x4760ad[_0x52c931(0x1ef)],'floorlevel':_0x4760ad['floorlevel']})),console[_0x52c931(0x262)](_0x52c931(0x1e9),_0x595365);}),await _0x595365[_0x4172d1(0x250)](),console['log'](_0x489782[_0x4172d1(0x265)]);const _0x1a7f7f=new c_payment_data({'invoice':_0x5a765e,'customer':_0x489782[_0x4172d1(0x265)]['customer'],'reason':_0x4172d1(0x25a)});await _0x1a7f7f['save']();const _0x26a676=await master_shop['find']();console[_0x4172d1(0x262)](_0x4172d1(0x236),_0x26a676[0x0][_0x4172d1(0x289)]);const _0x5aa441=await email_settings[_0x4172d1(0x2b4)](),_0x363cdd=await customer[_0x4172d1(0x2b4)]({'name':_0x489782['body'][_0x4172d1(0x1ed)]});console['log'](_0x4172d1(0x229),_0x363cdd);_0x26a676[0x0][_0x4172d1(0x23c)]==0x1?(right_currency=_0x26a676[0x0][_0x4172d1(0x286)],left_currency=''):(right_currency='',left_currency=_0x26a676[0x0][_0x4172d1(0x286)]);var _0x317d19=_0x14215a,_0x289454=_0x293437,_0x23df34='',_0x58f79f;for(_0x58f79f in _0x317d19){_0x23df34+=_0x4172d1(0x276)+_0x4172d1(0x1ad)+_0x317d19[_0x58f79f]+_0x4172d1(0x220)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x289454[_0x58f79f]+_0x4172d1(0x220)+_0x4172d1(0x226);}console[_0x4172d1(0x262)]('product_list',_0x23df34);let _0x411a12=nodemailer[_0x4172d1(0x209)]({'service':_0x4172d1(0x27b),'auth':{'user':_0x5aa441['email'],'pass':_0x5aa441[_0x4172d1(0x271)]}}),_0x1bf2fa={'from':_0x5aa441['email'],'to':_0x363cdd[_0x4172d1(0x20c)],'subject':_0x4172d1(0x1b9),'attachments':[{'filename':_0x4172d1(0x26d),'path':__dirname+_0x4172d1(0x1ca)+'/upload/'+_0x26a676[0x0]['image'],'cid':_0x4172d1(0x246)}],'html':_0x4172d1(0x297)+'<html><head><title></title>'+'</head><body>'+_0x4172d1(0x2af)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x4172d1(0x2af)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x4172d1(0x2af)+_0x4172d1(0x29e)+_0x26a676[0x0][_0x4172d1(0x24d)]+_0x4172d1(0x1f0)+_0x4172d1(0x1a5)+_0x4172d1(0x1a5)+_0x4172d1(0x233)+_0x4172d1(0x2af)+_0x4172d1(0x28b)+'\x20Order\x20Number\x20:\x20'+_0x5a765e+'\x20'+_0x4172d1(0x237)+_0x4172d1(0x2b0)+_0x11d1b2+'\x20'+_0x4172d1(0x2a6)+_0x4172d1(0x25b)+_0x4172d1(0x1a5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4172d1(0x267)+_0x4172d1(0x276)+_0x4172d1(0x230)+_0x4172d1(0x217)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x4172d1(0x22e)+_0x4172d1(0x226)+_0x4172d1(0x1ac)+_0x4172d1(0x208)+'\x20'+_0x23df34+'\x20'+_0x4172d1(0x1a1)+_0x4172d1(0x247)+_0x4172d1(0x2af)+_0x4172d1(0x1b0)+_0x4172d1(0x1c9)+_0x26a676[0x0]['site_title']+'</h5>'+_0x4172d1(0x1a5)+_0x4172d1(0x1a5)+_0x4172d1(0x1d9)};_0x411a12[_0x4172d1(0x22f)](_0x1bf2fa,function(_0x246778,_0x30c2ef){var _0x5b73f3=_0x4172d1;_0x246778?(console[_0x5b73f3(0x262)](_0x246778),console['log']('Error\x20Occurs')):console[_0x5b73f3(0x262)](_0x5b73f3(0x25f));}),_0x489782[_0x4172d1(0x1cc)]('success','sales\x20item\x20return\x20successfull'),_0x3be6b1[_0x4172d1(0x1d0)](_0x4172d1(0x1be));}catch(_0x345edc){console['log'](_0x345edc),_0x3be6b1[_0x4172d1(0x22d)](0xc8)[_0x4172d1(0x283)]({'message1':_0x345edc['message']});}}),router[a0_0x2548e2(0x2a0)](a0_0x2548e2(0x213),auth,async(_0x5103a4,_0x381842)=>{var _0x4330d0=a0_0x2548e2;try{const {username:_0xd3036,email:_0x1f8dca,role:_0x436084}=_0x5103a4['user'],_0x1e1704=_0x5103a4['user'],_0x146052=await profile[_0x4330d0(0x2b4)]({'email':_0x1e1704[_0x4330d0(0x20c)]}),_0x4f37a9=await master_shop[_0x4330d0(0x279)]();console[_0x4330d0(0x262)](_0x4330d0(0x1ab),_0x4f37a9);const _0x438ebd=_0x5103a4['params']['id'],_0x86d37d=await sales[_0x4330d0(0x20a)](_0x438ebd);console[_0x4330d0(0x262)](_0x4330d0(0x291),_0x86d37d);if(_0x4f37a9[0x0][_0x4330d0(0x1de)]=='English\x20(US)')var _0x147f0f=users[_0x4330d0(0x1a3)];else{if(_0x4f37a9[0x0]['language']==_0x4330d0(0x28c))var _0x147f0f=users[_0x4330d0(0x28c)];else{if(_0x4f37a9[0x0][_0x4330d0(0x1de)]=='German')var _0x147f0f=users[_0x4330d0(0x210)];else{if(_0x4f37a9[0x0]['language']==_0x4330d0(0x1d5))var _0x147f0f=users[_0x4330d0(0x1d5)];else{if(_0x4f37a9[0x0][_0x4330d0(0x1de)]==_0x4330d0(0x270))var _0x147f0f=users[_0x4330d0(0x270)];else{if(_0x4f37a9[0x0][_0x4330d0(0x1de)]==_0x4330d0(0x278))var _0x147f0f=users['Portuguese'];else{if(_0x4f37a9[0x0][_0x4330d0(0x1de)]==_0x4330d0(0x239))var _0x147f0f=users[_0x4330d0(0x239)];else{if(_0x4f37a9[0x0][_0x4330d0(0x1de)]==_0x4330d0(0x21c))var _0x147f0f=users[_0x4330d0(0x2a7)];}}}}}}}_0x381842[_0x4330d0(0x1f8)](_0x4330d0(0x28e),{'success':_0x5103a4['flash'](_0x4330d0(0x1c3)),'errors':_0x5103a4[_0x4330d0(0x1cc)](_0x4330d0(0x23e)),'role':_0x1e1704,'profile':_0x146052,'alldata':_0x86d37d,'master_shop':_0x4f37a9,'language':_0x147f0f});}catch(_0x153907){console[_0x4330d0(0x262)](_0x153907);}}),router[a0_0x2548e2(0x20e)](a0_0x2548e2(0x26e),async(_0x28419d,_0x2a8982)=>{var _0x2b6a2c=a0_0x2548e2;const {product_code:_0x5e833c,warehouse_name:_0x3943f3,rooms_data:_0x2eb6c5,Roomslist:_0x489f77}=_0x28419d['body'],_0x307487=_0x489f77[_0x2b6a2c(0x1a9)](','),_0x1e8059=[];async function _0x23a3cb(_0x322127){var _0x36139d=_0x2b6a2c;const _0x5d7fec=await warehouse[_0x36139d(0x1da)]([{'$match':{'name':_0x3943f3,'room':_0x322127}},{'$unwind':_0x36139d(0x1c8)},{'$match':{'product_details.primary_code':_0x5e833c}},{'$group':{'_id':_0x36139d(0x202),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x36139d(0x296)},'primary_code':{'$first':_0x36139d(0x216)},'secondary_code':{'$first':_0x36139d(0x28a)},'product_code':{'$first':_0x36139d(0x19f)},'level':{'$first':_0x36139d(0x218)},'isle':{'$first':_0x36139d(0x27c)},'type':{'$first':_0x36139d(0x1e6)},'pallet':{'$first':_0x36139d(0x28f)},'unit':{'$first':_0x36139d(0x293)},'secondary_unit':{'$first':_0x36139d(0x1e8)},'storage':{'$first':_0x36139d(0x2a3)},'rack':{'$first':_0x36139d(0x1df)},'expiry_date':{'$first':_0x36139d(0x219)},'production_date':{'$first':_0x36139d(0x25d)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x36139d(0x223)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x36139d(0x1c2)},'actual_qty':{'$first':_0x36139d(0x24b)},'actual_uom':{'$first':_0x36139d(0x1e5)}}}]),_0x4d983d=await warehouse[_0x36139d(0x1da)]([{'$match':{'name':_0x3943f3,'room':_0x322127}},{'$unwind':_0x36139d(0x1c8)},{'$match':{'product_details.secondary_code':_0x5e833c}},{'$group':{'_id':_0x36139d(0x202),'name':{'$first':_0x36139d(0x23a)},'product_stock':{'$first':_0x36139d(0x296)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x36139d(0x28a)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x36139d(0x218)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x36139d(0x1e6)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x36139d(0x293)},'secondary_unit':{'$first':_0x36139d(0x1e8)},'storage':{'$first':_0x36139d(0x2a3)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x36139d(0x219)},'production_date':{'$first':_0x36139d(0x25d)},'maxPerUnit':{'$first':_0x36139d(0x27a)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x36139d(0x1eb)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x36139d(0x1c2)}}}]);if(_0x5d7fec[_0x36139d(0x23f)]>0x0)_0x1e8059[_0x36139d(0x24f)](_0x5d7fec);else _0x4d983d['length']>0x0&&_0x1e8059['push'](_0x4d983d);}const _0xe203b=_0x307487['map'](_0x3e0b97=>_0x23a3cb(_0x3e0b97));await Promise[_0x2b6a2c(0x256)](_0xe203b),_0x2a8982[_0x2b6a2c(0x283)](_0x1e8059);}),module['exports']=router;