var a0_0x5b7120=a0_0x1db4;(function(_0x4ad6a6,_0x5b8c87){var _0x411e42=a0_0x1db4,_0x39191c=_0x4ad6a6();while(!![]){try{var _0x39266c=parseInt(_0x411e42(0x185))/0x1*(parseInt(_0x411e42(0x16f))/0x2)+parseInt(_0x411e42(0x1b4))/0x3+parseInt(_0x411e42(0x20a))/0x4+-parseInt(_0x411e42(0x13d))/0x5*(parseInt(_0x411e42(0x204))/0x6)+parseInt(_0x411e42(0x15d))/0x7*(-parseInt(_0x411e42(0x219))/0x8)+parseInt(_0x411e42(0x1f1))/0x9+parseInt(_0x411e42(0x1f7))/0xa;if(_0x39266c===_0x5b8c87)break;else _0x39191c['push'](_0x39191c['shift']());}catch(_0x4f8f2e){_0x39191c['push'](_0x39191c['shift']());}}}(a0_0x23cd,0xa15ac));function a0_0x1db4(_0x4b7397,_0x295483){var _0x23cd47=a0_0x23cd();return a0_0x1db4=function(_0x1db4e0,_0x1f9dfb){_0x1db4e0=_0x1db4e0-0x11c;var _0x2ff275=_0x23cd47[_0x1db4e0];return _0x2ff275;},a0_0x1db4(_0x4b7397,_0x295483);}const express=require(a0_0x5b7120(0x1b9)),app=express(),router=express[a0_0x5b7120(0x126)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5b7120(0x1c0)),nodemailer=require(a0_0x5b7120(0x12f)),users=require(a0_0x5b7120(0x182));router[a0_0x5b7120(0x127)](a0_0x5b7120(0x173),auth,async(_0x3b8e1f,_0x322189)=>{var _0x4d6eba=a0_0x5b7120;try{const {username:_0x106346,email:_0x22baa9,role:_0x27e886}=_0x3b8e1f[_0x4d6eba(0x189)],_0x15ee68=_0x3b8e1f['user'],_0x19bd98=await profile[_0x4d6eba(0x1f0)]({'email':_0x15ee68[_0x4d6eba(0x17b)]}),_0x10485a=await master_shop[_0x4d6eba(0x131)]();let _0x47431e;if(_0x15ee68[_0x4d6eba(0x143)]==_0x4d6eba(0x196)){const _0x21ceff=await staff[_0x4d6eba(0x1f0)]({'email':_0x15ee68[_0x4d6eba(0x17b)]});_0x47431e=await sales[_0x4d6eba(0x16b)]([{'$lookup':{'from':_0x4d6eba(0x1e3),'localField':_0x4d6eba(0x1eb),'foreignField':'name','as':_0x4d6eba(0x20d)}},{'$unwind':_0x4d6eba(0x194)},{'$unwind':_0x4d6eba(0x19c)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4d6eba(0x1b2)},'customers':{'$first':_0x4d6eba(0x14e)},'date':{'$first':_0x4d6eba(0x202)},'warehouse_name':{'$first':_0x4d6eba(0x1fd)},'sale_product':{'$push':_0x4d6eba(0x19c)},'note':{'$first':'$note'},'return_data':{'$first':_0x4d6eba(0x17f)},'customers_docs':{'$first':_0x4d6eba(0x194)},'total_saleproduct_quantity':{'$sum':_0x4d6eba(0x209)},'level':{'$addToSet':_0x4d6eba(0x171)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x4d6eba(0x216)},'isAllowEdit':{'$first':_0x4d6eba(0x12d)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x47431e=await sales[_0x4d6eba(0x16b)]([{'$lookup':{'from':'customers','localField':_0x4d6eba(0x1eb),'foreignField':_0x4d6eba(0x18e),'as':_0x4d6eba(0x20d)}},{'$unwind':_0x4d6eba(0x194)},{'$unwind':_0x4d6eba(0x19c)},{'$group':{'_id':_0x4d6eba(0x172),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x4d6eba(0x14e)},'date':{'$first':_0x4d6eba(0x202)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x4d6eba(0x19c)},'note':{'$first':_0x4d6eba(0x1a6)},'return_data':{'$first':_0x4d6eba(0x17f)},'customers_docs':{'$first':_0x4d6eba(0x194)},'total_saleproduct_quantity':{'$sum':_0x4d6eba(0x209)},'level':{'$addToSet':_0x4d6eba(0x171)},'isle':{'$addToSet':'$sale_product.bin'},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x4d6eba(0x1b7)},'finalize':{'$first':_0x4d6eba(0x216)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x4d6eba(0x135)](_0x4d6eba(0x134),_0x47431e);if(_0x10485a[0x0]['language']==_0x4d6eba(0x1e1)){var _0xaeb3ed=users[_0x4d6eba(0x1ab)];console[_0x4d6eba(0x135)](_0xaeb3ed);}else{if(_0x10485a[0x0][_0x4d6eba(0x18f)]=='Hindi')var _0xaeb3ed=users[_0x4d6eba(0x1c9)];else{if(_0x10485a[0x0][_0x4d6eba(0x18f)]==_0x4d6eba(0x1da))var _0xaeb3ed=users['German'];else{if(_0x10485a[0x0][_0x4d6eba(0x18f)]==_0x4d6eba(0x1af))var _0xaeb3ed=users[_0x4d6eba(0x1af)];else{if(_0x10485a[0x0][_0x4d6eba(0x18f)]==_0x4d6eba(0x1bf))var _0xaeb3ed=users[_0x4d6eba(0x1bf)];else{if(_0x10485a[0x0][_0x4d6eba(0x18f)]==_0x4d6eba(0x1df))var _0xaeb3ed=users[_0x4d6eba(0x1b5)];else{if(_0x10485a[0x0]['language']=='Chinese')var _0xaeb3ed=users[_0x4d6eba(0x1a1)];else{if(_0x10485a[0x0][_0x4d6eba(0x18f)]==_0x4d6eba(0x198))var _0xaeb3ed=users[_0x4d6eba(0x1aa)];}}}}}}}_0x322189[_0x4d6eba(0x1dc)](_0x4d6eba(0x1ba),{'success':_0x3b8e1f[_0x4d6eba(0x1f6)](_0x4d6eba(0x213)),'errors':_0x3b8e1f[_0x4d6eba(0x1f6)](_0x4d6eba(0x1cc)),'sales':_0x47431e,'profile':_0x19bd98,'role':_0x15ee68,'master_shop':_0x10485a,'language':_0xaeb3ed});}catch(_0x56df11){console[_0x4d6eba(0x135)](_0x56df11);}});async function getRandom8DigitNumber(){var _0x1cb4a0=a0_0x5b7120;const _0x98c97d=0x989680,_0x47b2d0=0x5f5e0ff,_0x4a7038=Math[_0x1cb4a0(0x1ac)](Math[_0x1cb4a0(0x1bb)]()*(_0x47b2d0-_0x98c97d+0x1))+_0x98c97d;var _0x10da79;const _0x3ec8bb=await sales[_0x1cb4a0(0x1f0)]({'invoice':'OUT-'+_0x4a7038});return _0x3ec8bb&&_0x3ec8bb[_0x1cb4a0(0x123)]>0x0?_0x10da79='OUT-'+_0x4a7038:_0x10da79=_0x1cb4a0(0x210)+_0x4a7038,_0x10da79;}router['get'](a0_0x5b7120(0x1e6),auth,async(_0x37ea4d,_0x4a933b)=>{var _0x5832b0=a0_0x5b7120;try{const {username:_0x31da8b,email:_0x404f4c,role:_0x3f0976}=_0x37ea4d[_0x5832b0(0x189)],_0x4880c1=_0x37ea4d['user'],_0x32c743=await profile['findOne']({'email':_0x4880c1[_0x5832b0(0x17b)]}),_0x55b2d8=await master_shop[_0x5832b0(0x131)](),_0x5491d=await customer[_0x5832b0(0x131)]({});let _0x4e1570;if(_0x4880c1[_0x5832b0(0x143)]==_0x5832b0(0x196)){const _0x472799=await staff[_0x5832b0(0x1f0)]({'email':_0x4880c1[_0x5832b0(0x17b)]});_0x4e1570=await warehouse[_0x5832b0(0x16b)]([{'$match':{'status':_0x5832b0(0x157),'name':_0x472799[_0x5832b0(0x1ce)],'warehouse_category':_0x5832b0(0x21f),'name':{'$ne':_0x5832b0(0x186)}}},{'$group':{'_id':_0x5832b0(0x1d6),'name':{'$first':_0x5832b0(0x1d6)}}},{'$sort':{'name':0x1}}]);}else _0x4e1570=await warehouse[_0x5832b0(0x16b)]([{'$match':{'status':_0x5832b0(0x157),'warehouse_category':_0x5832b0(0x21f),'name':{'$ne':_0x5832b0(0x186)}}},{'$group':{'_id':_0x5832b0(0x1d6),'name':{'$first':_0x5832b0(0x1d6)}}},{'$sort':{'name':0x1}}]);const _0x3a76d0=await product[_0x5832b0(0x131)]({});var _0x409296=[_0x5832b0(0x129),_0x5832b0(0x120)];const _0x497dbc=await sales[_0x5832b0(0x131)]({}),_0x2d5ad8=_0x497dbc[_0x5832b0(0x123)]+0x1,_0x2f8eca=_0x5832b0(0x210)+_0x2d5ad8[_0x5832b0(0x206)]()[_0x5832b0(0x14a)](0x5,'0');if(_0x55b2d8[0x0][_0x5832b0(0x18f)]==_0x5832b0(0x1e1)){var _0x37f587=users[_0x5832b0(0x1ab)];console[_0x5832b0(0x135)](_0x37f587);}else{if(_0x55b2d8[0x0][_0x5832b0(0x18f)]=='Hindi')var _0x37f587=users[_0x5832b0(0x1c9)];else{if(_0x55b2d8[0x0][_0x5832b0(0x18f)]==_0x5832b0(0x1da))var _0x37f587=users['German'];else{if(_0x55b2d8[0x0][_0x5832b0(0x18f)]=='Spanish')var _0x37f587=users[_0x5832b0(0x1af)];else{if(_0x55b2d8[0x0]['language']==_0x5832b0(0x1bf))var _0x37f587=users[_0x5832b0(0x1bf)];else{if(_0x55b2d8[0x0]['language']=='Portuguese\x20(BR)')var _0x37f587=users['Portuguese'];else{if(_0x55b2d8[0x0]['language']=='Chinese')var _0x37f587=users[_0x5832b0(0x1a1)];else{if(_0x55b2d8[0x0][_0x5832b0(0x18f)]==_0x5832b0(0x198))var _0x37f587=users[_0x5832b0(0x1aa)];}}}}}}}const _0x5bacea=getRandom8DigitNumber();_0x5bacea[_0x5832b0(0x1ff)](_0x3e00ed=>{var _0x3854e2=_0x5832b0;_0x4a933b['render'](_0x3854e2(0x191),{'success':_0x37ea4d[_0x3854e2(0x1f6)](_0x3854e2(0x213)),'errors':_0x37ea4d[_0x3854e2(0x1f6)](_0x3854e2(0x1cc)),'role':_0x4880c1,'profile':_0x32c743,'customer':_0x5491d,'warehouse':_0x4e1570,'product':_0x3a76d0,'invoice':_0x3e00ed,'master_shop':_0x55b2d8,'language':_0x37f587,'rooms_data':_0x409296});})['catch'](_0x30bb6a=>{var _0x5f2ba3=_0x5832b0;_0x37ea4d[_0x5f2ba3(0x1f6)](_0x5f2ba3(0x1cc),_0x5f2ba3(0x17d)),_0x4a933b[_0x5f2ba3(0x188)](_0x5f2ba3(0x1a2));});}catch(_0x2ac379){console[_0x5832b0(0x135)](_0x2ac379);}}),router['get'](a0_0x5b7120(0x1f9),auth,async(_0x71ba49,_0x2fd352)=>{var _0x441e73=a0_0x5b7120;try{const _0x52080c=_0x71ba49[_0x441e73(0x19d)]['id'];console[_0x441e73(0x135)](_0x52080c);const _0xf831f0=await product['find'](),_0x3dc09d=await purchases[_0x441e73(0x16b)]([{'$match':{'warehouse_name':_0x52080c}},{'$unwind':_0x441e73(0x12c)},{'$group':{'_id':_0x441e73(0x205)}}]);console[_0x441e73(0x135)](_0x441e73(0x122),_0x3dc09d),_0x2fd352['status'](0xc8)[_0x441e73(0x1c2)]({'purchases_data':_0x3dc09d,'product_data':_0xf831f0});}catch(_0x5a049c){console['log'](_0x5a049c);}}),router[a0_0x5b7120(0x14f)](a0_0x5b7120(0x1cb),auth,async(_0x2c3993,_0x4fbf4d)=>{var _0x553632=a0_0x5b7120;try{const {warehouse_data:_0x575540,product_data:_0x41ab0c}=_0x2c3993[_0x553632(0x130)];console[_0x553632(0x135)](_0x2c3993[_0x553632(0x130)][_0x553632(0x1ec)]);;const _0x493aec=await master_shop[_0x553632(0x131)]();console[_0x553632(0x135)]('master',_0x493aec);const _0x2886e2=await product['findOne']({'name':_0x41ab0c});console[_0x553632(0x135)]('product',_0x2886e2);const _0xebaee1=await warehouse[_0x553632(0x16b)]([{'$match':{'name':_0x575540}},{'$unwind':_0x553632(0x136)},{'$match':{'product_details.product_name':_0x41ab0c}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':_0x553632(0x20e)}}}]);console[_0x553632(0x135)]('stock_data',_0xebaee1),_0x4fbf4d['status'](0xc8)[_0x553632(0x1c2)]({'master':_0x493aec,'new_product':_0x2886e2,'stock_data':_0xebaee1});}catch(_0x12f907){console['log'](_0x12f907);}}),router['post'](a0_0x5b7120(0x1e6),auth,async(_0x18e2bd,_0x2536ec)=>{var _0x59008e=a0_0x5b7120;try{const {invoice:_0x435195,date:_0x3bf686,warehouse_name:_0x496cf3,product_name:_0x224db8,stock:_0x9f1c7b,quantity:_0x574cb5,note:_0x45a565,room:_0x3e6fd9,primary_code:_0x2c22b6,secondary_code:_0x3cecf5,prod_code:_0x47772f,level:_0x35f031,isle:_0x859052,pallet:_0x20cc3c,batch_code:_0x90b419,SCRN:_0x2aa122,expiry_date:_0x6c3bf9}=_0x18e2bd[_0x59008e(0x130)];if(typeof _0x224db8=='string')var _0x4290c2=[_0x18e2bd[_0x59008e(0x130)]['product_name']],_0x34b124=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x197)]],_0x514e89=[_0x18e2bd['body'][_0x59008e(0x1c4)]],_0xdc146c=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x141)]],_0x37c64c=[_0x18e2bd['body'][_0x59008e(0x21d)]],_0x4a2c3a=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x20c)]],_0x1e14c8=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x215)]],_0x1f0f1b=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x20b)]],_0x503b5d=[_0x18e2bd['body'][_0x59008e(0x1dd)]],_0x2a9508=[_0x18e2bd['body'][_0x59008e(0x1bd)]],_0x2878c3=[_0x18e2bd['body'][_0x59008e(0x1d8)]],_0x3050ac=[_0x18e2bd[_0x59008e(0x130)]['max_per_unit']],_0x26732f=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1de)]],_0x2813c1=[_0x18e2bd['body'][_0x59008e(0x1ad)]],_0x1b0a4c=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x187)]],_0x484b76=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1b0)]],_0x5b906a=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x174)]],_0x1c09f9=[_0x18e2bd['body'][_0x59008e(0x16d)]],_0x317487=[_0x18e2bd['body'][_0x59008e(0x1c6)]],_0x34da8c=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x18a)]],_0x2fef59=[_0x18e2bd[_0x59008e(0x130)]['actual_qty']],_0x140f12=[_0x18e2bd[_0x59008e(0x130)][_0x59008e(0x13c)]];else var _0x4290c2=[..._0x18e2bd['body'][_0x59008e(0x1b3)]],_0x34b124=[..._0x18e2bd['body'][_0x59008e(0x197)]],_0x514e89=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1c4)]],_0xdc146c=[..._0x18e2bd['body']['primary_code']],_0x37c64c=[..._0x18e2bd[_0x59008e(0x130)]['secondary_code']],_0x4a2c3a=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x20c)]],_0x1e14c8=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x215)]],_0x1f0f1b=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x20b)]],_0x503b5d=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1dd)]],_0x2a9508=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1bd)]],_0x2878c3=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1d8)]],_0x3050ac=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1e7)]],_0x26732f=[..._0x18e2bd[_0x59008e(0x130)]['production_date']],_0x2813c1=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1ad)]],_0x1b0a4c=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x187)]],_0x484b76=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x1b0)]],_0x5b906a=[..._0x18e2bd['body'][_0x59008e(0x174)]],_0x1c09f9=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x16d)]],_0x317487=[..._0x18e2bd[_0x59008e(0x130)]['RoomAssigned']],_0x34da8c=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x18a)]],_0x2fef59=[..._0x18e2bd[_0x59008e(0x130)][_0x59008e(0x179)]],_0x140f12=[..._0x18e2bd[_0x59008e(0x130)]['actual_uom']];const _0x39880b=_0x4290c2['map'](_0x3493b2=>{return _0x3493b2={'product_name':_0x3493b2};});_0x34b124[_0x59008e(0x184)]((_0x4d024f,_0x44e03a)=>{var _0xbe70f8=_0x59008e;_0x39880b[_0x44e03a][_0xbe70f8(0x197)]=Math['abs'](_0x4d024f);}),_0x2fef59[_0x59008e(0x184)]((_0x222e5d,_0x565b72)=>{_0x39880b[_0x565b72]['actual_qty']=Math['abs'](_0x222e5d);}),_0x140f12[_0x59008e(0x184)]((_0x49a05a,_0x3a4b0b)=>{_0x39880b[_0x3a4b0b]['actual_uom']=_0x49a05a;}),_0x514e89[_0x59008e(0x184)]((_0x5d9934,_0x1263d7)=>{_0x39880b[_0x1263d7]['quantity']=_0x5d9934;}),_0xdc146c[_0x59008e(0x184)]((_0x519aa7,_0x789198)=>{var _0x3962bd=_0x59008e;_0x39880b[_0x789198][_0x3962bd(0x141)]=_0x519aa7;}),_0x37c64c[_0x59008e(0x184)]((_0x159b07,_0xcd8e93)=>{_0x39880b[_0xcd8e93]['secondary_code']=_0x159b07;}),_0x4a2c3a[_0x59008e(0x184)]((_0x397476,_0xabb128)=>{var _0x225f96=_0x59008e;_0x39880b[_0xabb128][_0x225f96(0x21c)]=_0x397476;}),_0x1e14c8[_0x59008e(0x184)]((_0x5cfa80,_0x3135f1)=>{_0x317487['forEach']((_0xce179a,_0xe2f7a2)=>{var _0x1207de=a0_0x1db4;if(_0xce179a==_0x1207de(0x139)&&_0x3135f1==_0xe2f7a2){var _0x298774=_0x5cfa80[_0x1207de(0x16a)](0x3);_0x39880b[_0x3135f1]['storage']=_0x5cfa80[0x0],_0x39880b[_0x3135f1][_0x1207de(0x1a4)]=_0x5cfa80[0x1],_0x39880b[_0x3135f1]['bay']=0x0,_0x39880b[_0x3135f1][_0x1207de(0x17e)]=0x0,_0x39880b[_0x3135f1][_0x1207de(0x192)]=_0x1207de(0x1ee),_0x39880b[_0x3135f1]['floorlevel']=_0x298774;}else{if(_0xce179a==_0x1207de(0x170)&&_0x3135f1==_0xe2f7a2){var _0x298774=_0x5cfa80['slice'](0x3);_0x39880b[_0x3135f1][_0x1207de(0x150)]=_0x5cfa80[0x0],_0x39880b[_0x3135f1][_0x1207de(0x1a4)]=_0x5cfa80[0x1],_0x39880b[_0x3135f1]['bay']=0x0,_0x39880b[_0x3135f1][_0x1207de(0x17e)]=0x0,_0x39880b[_0x3135f1][_0x1207de(0x192)]=_0x1207de(0x1ee),_0x39880b[_0x3135f1][_0x1207de(0x18b)]=_0x5cfa80[0x5];}else{if(_0x3135f1==_0xe2f7a2){var _0x1b5465;if(_0x5cfa80[0x4]=='L')_0x1b5465=_0x1207de(0x1f2);else _0x5cfa80[0x4]=='F'&&(_0x1b5465='Floor');_0x39880b[_0x3135f1][_0x1207de(0x150)]=_0x5cfa80[0x0],_0x39880b[_0x3135f1][_0x1207de(0x1a4)]=_0x5cfa80[0x1],_0x39880b[_0x3135f1]['bay']=_0x5cfa80[0x2],_0x39880b[_0x3135f1][_0x1207de(0x17e)]=_0x5cfa80[0x3],_0x39880b[_0x3135f1][_0x1207de(0x192)]=_0x1b5465,_0x39880b[_0x3135f1][_0x1207de(0x18b)]=_0x5cfa80[0x5];}}}});}),_0x1f0f1b[_0x59008e(0x184)]((_0x2a5964,_0x141244)=>{_0x39880b[_0x141244]['unit']=_0x2a5964;}),_0x503b5d[_0x59008e(0x184)]((_0x2c5ff1,_0x6ac949)=>{var _0x4c5924=_0x59008e;_0x39880b[_0x6ac949][_0x4c5924(0x1dd)]=_0x2c5ff1;}),_0x2a9508['forEach']((_0x15882b,_0x2ad7aa)=>{var _0x2525e0=_0x59008e;_0x39880b[_0x2ad7aa][_0x2525e0(0x1bd)]=_0x15882b;}),_0x2878c3['forEach']((_0x12bb46,_0x2219f3)=>{var _0x2749ef=_0x59008e;_0x39880b[_0x2219f3][_0x2749ef(0x1d8)]=_0x12bb46;}),_0x3050ac['forEach']((_0x5c2433,_0x33a10d)=>{var _0x19a852=_0x59008e;_0x39880b[_0x33a10d][_0x19a852(0x1a3)]=_0x5c2433;}),_0x26732f['forEach']((_0x47a607,_0x2077a2)=>{var _0xac8ba1=_0x59008e;_0x39880b[_0x2077a2][_0xac8ba1(0x1de)]=_0x47a607;}),_0x2813c1[_0x59008e(0x184)]((_0xdcb942,_0x35e405)=>{var _0x8ef538=_0x59008e;_0x39880b[_0x35e405][_0x8ef538(0x1ad)]=_0xdcb942;}),_0x1b0a4c[_0x59008e(0x184)]((_0xf84ef9,_0x596543)=>{var _0x111355=_0x59008e;_0x39880b[_0x596543][_0x111355(0x187)]=_0xf84ef9;}),_0x484b76[_0x59008e(0x184)]((_0x47e0ee,_0x133ddd)=>{var _0x16752f=_0x59008e;_0x39880b[_0x133ddd][_0x16752f(0x1b0)]=_0x47e0ee;}),_0x5b906a[_0x59008e(0x184)]((_0x958993,_0xb53246)=>{var _0x26e801=_0x59008e;_0x39880b[_0xb53246][_0x26e801(0x174)]=_0x958993;}),_0x1c09f9[_0x59008e(0x184)]((_0x5adc05,_0x219870)=>{_0x39880b[_0x219870]['quantity_notConverted']=_0x5adc05;}),_0x317487[_0x59008e(0x184)]((_0x12ba6f,_0x3f1aa1)=>{var _0x5e9f94=_0x59008e;_0x39880b[_0x3f1aa1][_0x5e9f94(0x125)]=_0x12ba6f;}),_0x34da8c['forEach']((_0x34b13c,_0x123fc1)=>{_0x39880b[_0x123fc1]['invoice']=_0x34b13c;});var _0x3c4ae3=0x0;_0x39880b[_0x59008e(0x184)](_0x1c6ef8=>{var _0x491768=_0x59008e;(_0x1c6ef8[_0x491768(0x197)]<_0x1c6ef8[_0x491768(0x224)]||_0x1c6ef8[_0x491768(0x224)]==0x0)&&(console[_0x491768(0x135)](_0x491768(0x1d7),_0x1c6ef8),_0x3c4ae3++);});const _0x3ecf3f=_0x39880b[_0x59008e(0x21e)](_0x216fad=>_0x216fad[_0x59008e(0x16d)]!=='0'&&_0x216fad[_0x59008e(0x16d)]!==''),_0x536fb3=new sales({'invoice':_0x435195,'customer':_0x18e2bd['body'][_0x59008e(0x1eb)],'date':_0x3bf686,'warehouse_name':_0x496cf3,'sale_product':_0x3ecf3f,'note':_0x45a565,'room':_0x3e6fd9,'primary_code':_0x2c22b6,'secondary_code':_0x3cecf5,'prod_code':_0x47772f,'SCRN':_0x2aa122}),_0xa30a25=await _0x536fb3['save']();_0x18e2bd[_0x59008e(0x1f6)](_0x59008e(0x213),_0x59008e(0x11f)),_0x2536ec[_0x59008e(0x188)](_0x59008e(0x147)+_0xa30a25['_id']);}catch(_0x5a1fbf){console[_0x59008e(0x135)](_0x5a1fbf);}}),router[a0_0x5b7120(0x127)](a0_0x5b7120(0x1d3),auth,async(_0x30aeaf,_0x19bdfa)=>{var _0x14b95e=a0_0x5b7120;try{const {username:_0x333d9b,email:_0x560090,role:_0x57cd38}=_0x30aeaf[_0x14b95e(0x189)],_0x4fa16=_0x30aeaf[_0x14b95e(0x189)],_0x169678=await profile['findOne']({'email':_0x4fa16['email']}),_0x4c742a=await master_shop[_0x14b95e(0x131)](),_0x2b411c=_0x30aeaf[_0x14b95e(0x19d)]['id'],_0x25cbaa=await sales[_0x14b95e(0x13b)](_0x2b411c),_0x495eef=await warehouse[_0x14b95e(0x16b)]([{'$match':{'name':_0x25cbaa[_0x14b95e(0x1d2)]}},{'$unwind':_0x14b95e(0x136)},{'$group':{'_id':_0x14b95e(0x1c7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x14b95e(0x20e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x14b95e(0x158)},'type':{'$first':_0x14b95e(0x17c)},'floorlevel':{'$first':_0x14b95e(0x200)},'primary_code':{'$first':_0x14b95e(0x1d4)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x14b95e(0x14c)},'storage':{'$first':_0x14b95e(0x212)},'rack':{'$first':_0x14b95e(0x1c3)},'expiry_date':{'$first':_0x14b95e(0x1ef)},'production_date':{'$first':_0x14b95e(0x1c5)},'invoice':{'$first':_0x14b95e(0x203)}}}]),_0x3b1e14=await customer[_0x14b95e(0x131)]({});let _0x49fc1c;if(_0x4fa16['role']==_0x14b95e(0x196)){const _0x4d428d=await staff[_0x14b95e(0x1f0)]({'email':_0x4fa16[_0x14b95e(0x17b)]});_0x49fc1c=await warehouse[_0x14b95e(0x16b)]([{'$match':{'status':_0x14b95e(0x157),'name':_0x4d428d[_0x14b95e(0x1ce)]}},{'$group':{'_id':_0x14b95e(0x1d6),'name':{'$first':'$name'}}}]);}else _0x49fc1c=await warehouse[_0x14b95e(0x16b)]([{'$match':{'status':_0x14b95e(0x157)}},{'$group':{'_id':_0x14b95e(0x1d6),'name':{'$first':_0x14b95e(0x1d6)}}}]);const _0x34a0c0=await product[_0x14b95e(0x131)]({}),_0x28f44a=await suppliers[_0x14b95e(0x131)]({});if(_0x4c742a[0x0]['language']==_0x14b95e(0x1e1)){var _0x239025=users['English'];console[_0x14b95e(0x135)](_0x239025);}else{if(_0x4c742a[0x0][_0x14b95e(0x18f)]==_0x14b95e(0x1c9))var _0x239025=users['Hindi'];else{if(_0x4c742a[0x0]['language']==_0x14b95e(0x1da))var _0x239025=users[_0x14b95e(0x1da)];else{if(_0x4c742a[0x0][_0x14b95e(0x18f)]==_0x14b95e(0x1af))var _0x239025=users['Spanish'];else{if(_0x4c742a[0x0][_0x14b95e(0x18f)]==_0x14b95e(0x1bf))var _0x239025=users[_0x14b95e(0x1bf)];else{if(_0x4c742a[0x0]['language']==_0x14b95e(0x1df))var _0x239025=users[_0x14b95e(0x1b5)];else{if(_0x4c742a[0x0]['language']==_0x14b95e(0x1a1))var _0x239025=users[_0x14b95e(0x1a1)];else{if(_0x4c742a[0x0]['language']==_0x14b95e(0x198))var _0x239025=users[_0x14b95e(0x1aa)];}}}}}}}_0x19bdfa[_0x14b95e(0x1dc)](_0x14b95e(0x149),{'success':_0x30aeaf[_0x14b95e(0x1f6)](_0x14b95e(0x213)),'errors':_0x30aeaf['flash'](_0x14b95e(0x1cc)),'role':_0x4fa16,'profile':_0x169678,'customer':_0x3b1e14,'warehouse':_0x49fc1c,'product':_0x495eef,'user':_0x25cbaa,'master_shop':_0x4c742a,'unit':_0x34a0c0,'language':_0x239025,'suppliers':_0x28f44a});}catch(_0x23990c){console[_0x14b95e(0x135)](_0x23990c);}}),router[a0_0x5b7120(0x14f)](a0_0x5b7120(0x1d3),auth,async(_0x1701ed,_0x58e889)=>{var _0x5740ea=a0_0x5b7120;try{const _0x50410b=_0x1701ed[_0x5740ea(0x19d)]['id'],{invoice:_0x4897f2,warehouse_name:_0x1b0c3e,room:_0x4e87c3}=_0x1701ed[_0x5740ea(0x130)],_0x40eab1=await sales[_0x5740ea(0x1f0)]({'invoice':_0x4897f2}),_0x567438=_0x40eab1[_0x5740ea(0x15e)][_0x5740ea(0x159)](async _0x1243e6=>{var _0x589195=_0x5740ea,_0x3d3930=await warehouse[_0x589195(0x1f0)]({'name':_0x1b0c3e,'room':_0x1243e6['room_name'],'warehouse_category':_0x589195(0x21f)});const _0x1f7426=_0x3d3930[_0x589195(0x144)][_0x589195(0x159)](_0x2305dc=>{var _0x27b761=_0x589195;_0x2305dc['product_name']==_0x1243e6[_0x27b761(0x1b3)]&&_0x2305dc['floorlevel']==_0x1243e6['floorlevel']&&_0x2305dc['type']==_0x1243e6[_0x27b761(0x192)]&&_0x2305dc['bin']==_0x1243e6[_0x27b761(0x17e)]&&_0x2305dc[_0x27b761(0x1e9)]==_0x1243e6[_0x27b761(0x1e9)]&&_0x2305dc[_0x27b761(0x1a4)]==_0x1243e6['rack']&&_0x2305dc[_0x27b761(0x150)]==_0x1243e6[_0x27b761(0x150)]&&_0x2305dc['expiry_date']==_0x1243e6[_0x27b761(0x1d8)]&&_0x2305dc[_0x27b761(0x1bd)]==_0x1243e6['batch_code']&&_0x2305dc[_0x27b761(0x222)]==_0x1243e6[_0x27b761(0x222)]&&(_0x2305dc[_0x27b761(0x13a)]=Math['max'](0x0,Math[_0x27b761(0x18d)](_0x2305dc['product_stock'])-Math[_0x27b761(0x18d)](_0x1243e6[_0x27b761(0x16d)])));});return _0x3d3930;});Promise[_0x5740ea(0x1a7)](_0x567438)[_0x5740ea(0x1ff)](async _0x27b96=>{var _0x47a11d=_0x5740ea;try{for(const _0x4f312 of _0x27b96){await _0x4f312[_0x47a11d(0x1fb)]();}_0x40eab1[_0x47a11d(0x166)]=_0x47a11d(0x168);const _0x20e1f1=await _0x40eab1[_0x47a11d(0x1fb)](),_0x5a019e=await master_shop[_0x47a11d(0x131)](),_0x42adcf=await email_settings[_0x47a11d(0x1f0)](),_0x1de65e=await supervisor_settings[_0x47a11d(0x131)]();var _0x69fbb4=_0x40eab1['sale_product'],_0x499f8d='',_0x59a412;for(_0x59a412 in _0x69fbb4){_0x499f8d+='<tr>'+_0x47a11d(0x14d)+_0x69fbb4[_0x59a412][_0x47a11d(0x1b3)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x69fbb4[_0x59a412][_0x47a11d(0x21c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x69fbb4[_0x59a412][_0x47a11d(0x16d)]+_0x47a11d(0x1a0)+_0x47a11d(0x14d)+_0x69fbb4[_0x59a412][_0x47a11d(0x1ae)]+_0x47a11d(0x1a0)+_0x47a11d(0x14d)+_0x69fbb4[_0x59a412][_0x47a11d(0x1dd)]+_0x47a11d(0x1a0)+_0x47a11d(0x14d)+_0x40eab1[_0x47a11d(0x1d2)]+_0x47a11d(0x1a0)+_0x47a11d(0x14d)+_0x69fbb4[_0x59a412][_0x47a11d(0x125)]+_0x47a11d(0x1a0)+_0x47a11d(0x14d)+_0x69fbb4[_0x59a412]['storage']+_0x69fbb4[_0x59a412]['rack']+_0x69fbb4[_0x59a412]['bay']+_0x69fbb4[_0x59a412][_0x47a11d(0x17e)]+_0x69fbb4[_0x59a412][_0x47a11d(0x192)][0x0]+_0x69fbb4[_0x59a412][_0x47a11d(0x18b)]+'</td>','</tr>';}let _0x39d265=nodemailer['createTransport']({'host':_0x42adcf[_0x47a11d(0x176)],'port':Number(_0x42adcf[_0x47a11d(0x1fc)]),'secure':![],'auth':{'user':_0x42adcf[_0x47a11d(0x17b)],'pass':_0x42adcf[_0x47a11d(0x152)]}}),_0x3ad07c={'from':_0x42adcf[_0x47a11d(0x17b)],'to':_0x1de65e[0x0][_0x47a11d(0x223)],'subject':_0x47a11d(0x1c8),'attachments':[{'filename':_0x47a11d(0x1a5),'path':__dirname+_0x47a11d(0x16e)+_0x47a11d(0x19f)+_0x5a019e[0x0][_0x47a11d(0x19b)],'cid':_0x47a11d(0x128)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x47a11d(0x201)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x47a11d(0x201)+_0x47a11d(0x1cf)+_0x47a11d(0x217)+_0x47a11d(0x201)+_0x47a11d(0x13e)+_0x5a019e[0x0][_0x47a11d(0x1ea)]+_0x47a11d(0x14b)+_0x47a11d(0x217)+_0x47a11d(0x217)+_0x47a11d(0x121)+_0x47a11d(0x201)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x40eab1['invoice']+'\x20'+_0x47a11d(0x1fa)+_0x47a11d(0x19e)+_0x40eab1[_0x47a11d(0x15c)]+'\x20'+_0x47a11d(0x16c)+_0x47a11d(0x155)+'</div>'+_0x47a11d(0x199)+_0x47a11d(0x221)+_0x47a11d(0x195)+_0x47a11d(0x220)+_0x47a11d(0x1f8)+_0x47a11d(0x218)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x47a11d(0x162)+_0x47a11d(0x137)+_0x47a11d(0x181)+'</tr>'+_0x47a11d(0x1cd)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x499f8d+'\x20'+'</tbody>'+_0x47a11d(0x11d)+_0x47a11d(0x201)+_0x47a11d(0x165)+_0x47a11d(0x1bc)+_0x5a019e[0x0][_0x47a11d(0x1ea)]+_0x47a11d(0x155)+'</div>'+_0x47a11d(0x217)+_0x47a11d(0x11c)};_0x39d265[_0x47a11d(0x1e2)](_0x3ad07c,function(_0x40014e,_0x228356){var _0x36b8a6=_0x47a11d;_0x40014e?(console[_0x36b8a6(0x135)](_0x40014e),console[_0x36b8a6(0x135)]('Error\x20Occurs')):console[_0x36b8a6(0x135)](_0x36b8a6(0x20f));}),_0x1701ed[_0x47a11d(0x1f6)](_0x47a11d(0x213),'Sales\x20Update\x20successfully'),_0x58e889[_0x47a11d(0x188)]('/all_sales/preview/'+_0x50410b);}catch(_0x4893d9){console['error'](_0x4893d9),_0x58e889['status'](0x1f4)[_0x47a11d(0x1c2)]({'error':_0x47a11d(0x132)});}})[_0x5740ea(0x148)](_0xdcec23=>{var _0x297a32=_0x5740ea;console[_0x297a32(0x153)](_0xdcec23),_0x58e889[_0x297a32(0x180)](0x1f4)[_0x297a32(0x1c2)]({'error':_0x297a32(0x12b)});});}catch(_0x432c77){console['log'](_0x432c77);}}),router[a0_0x5b7120(0x127)](a0_0x5b7120(0x140),auth,async(_0x433204,_0x4263e9)=>{var _0x2a7dce=a0_0x5b7120;try{const {username:_0x4873a1,email:_0x5e9918,role:_0x5d7dbe}=_0x433204[_0x2a7dce(0x189)],_0x4f1d4a=_0x433204[_0x2a7dce(0x189)],_0x51c3ac=await profile[_0x2a7dce(0x1f0)]({'email':_0x4f1d4a[_0x2a7dce(0x17b)]}),_0xe55426=await master_shop[_0x2a7dce(0x131)](),_0x2b3eb7=_0x433204[_0x2a7dce(0x19d)]['id'],_0x3dca16=await sales[_0x2a7dce(0x13b)](_0x2b3eb7);var _0x460562=[_0x2a7dce(0x129),'Enclosed'];const _0x59e17a=await warehouse[_0x2a7dce(0x16b)]([{'$match':{'name':_0x3dca16[_0x2a7dce(0x1d2)],'warehouse_category':_0x2a7dce(0x21f)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2a7dce(0x20e)},'bay':{'$first':_0x2a7dce(0x177)},'bin':{'$first':_0x2a7dce(0x158)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2a7dce(0x200)},'primary_code':{'$first':_0x2a7dce(0x1d4)},'secondary_code':{'$first':_0x2a7dce(0x151)},'product_code':{'$first':_0x2a7dce(0x14c)},'storage':{'$first':_0x2a7dce(0x212)},'rack':{'$first':_0x2a7dce(0x1c3)}}}]),_0xa9a14a=await customer[_0x2a7dce(0x131)]({});let _0xafb78b;if(_0x4f1d4a[_0x2a7dce(0x143)]=='staff'){const _0x5d3fb4=await staff[_0x2a7dce(0x1f0)]({'email':_0x4f1d4a[_0x2a7dce(0x17b)]});_0xafb78b=await warehouse[_0x2a7dce(0x16b)]([{'$match':{'status':_0x2a7dce(0x157),'name':_0x5d3fb4[_0x2a7dce(0x1ce)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x2a7dce(0x1d6)}}}]);}else _0xafb78b=await warehouse[_0x2a7dce(0x16b)]([{'$match':{'status':_0x2a7dce(0x157),'warehouse_category':_0x2a7dce(0x21f)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5921f3=await product[_0x2a7dce(0x131)]({});if(_0xe55426[0x0][_0x2a7dce(0x18f)]==_0x2a7dce(0x1e1)){var _0x63e4be=users[_0x2a7dce(0x1ab)];console[_0x2a7dce(0x135)](_0x63e4be);}else{if(_0xe55426[0x0][_0x2a7dce(0x18f)]=='Hindi')var _0x63e4be=users[_0x2a7dce(0x1c9)];else{if(_0xe55426[0x0][_0x2a7dce(0x18f)]==_0x2a7dce(0x1da))var _0x63e4be=users[_0x2a7dce(0x1da)];else{if(_0xe55426[0x0]['language']==_0x2a7dce(0x1af))var _0x63e4be=users[_0x2a7dce(0x1af)];else{if(_0xe55426[0x0][_0x2a7dce(0x18f)]==_0x2a7dce(0x1bf))var _0x63e4be=users[_0x2a7dce(0x1bf)];else{if(_0xe55426[0x0][_0x2a7dce(0x18f)]==_0x2a7dce(0x1df))var _0x63e4be=users[_0x2a7dce(0x1b5)];else{if(_0xe55426[0x0][_0x2a7dce(0x18f)]==_0x2a7dce(0x1a1))var _0x63e4be=users[_0x2a7dce(0x1a1)];else{if(_0xe55426[0x0][_0x2a7dce(0x18f)]==_0x2a7dce(0x198))var _0x63e4be=users[_0x2a7dce(0x1aa)];}}}}}}}_0x4263e9[_0x2a7dce(0x1dc)]('edit_sales',{'success':_0x433204['flash'](_0x2a7dce(0x213)),'errors':_0x433204['flash'](_0x2a7dce(0x1cc)),'role':_0x4f1d4a,'profile':_0x51c3ac,'customer':_0xa9a14a,'warehouse':_0xafb78b,'product':_0x59e17a,'user':_0x3dca16,'master_shop':_0xe55426,'unit':_0x5921f3,'language':_0x63e4be});}catch(_0x2680cb){console[_0x2a7dce(0x135)](_0x2680cb);}}),router[a0_0x5b7120(0x14f)](a0_0x5b7120(0x140),auth,async(_0x16bd42,_0x234b49)=>{var _0x92279f=a0_0x5b7120;try{const _0x3fc478=_0x16bd42[_0x92279f(0x19d)]['id'],_0xa5591f=await sales[_0x92279f(0x1f0)]({'_id':_0x16bd42[_0x92279f(0x19d)]['id']}),_0x56e1da=await warehouse['findOne']({'name':_0xa5591f[_0x92279f(0x1d2)],'room':_0x16bd42[_0x92279f(0x130)]['room']}),{invoice:_0x59ca87,date:_0x1c0c55,warehouse_name:_0x5d1866,product_name:_0x23f86a,stock:_0x34edee,quantity:_0x4875ee,note:_0x2faf40,room:_0x74553b,customer:_0x1781cb,SCRN:_0x57baca}=_0x16bd42[_0x92279f(0x130)];if(typeof _0x23f86a==_0x92279f(0x164))var _0x44a0bb=[_0x16bd42[_0x92279f(0x130)]['product_name']],_0x3821aa=[_0x16bd42[_0x92279f(0x130)]['stock']],_0x5109b9=[_0x16bd42['body']['carton']],_0x1494ef=[_0x16bd42['body'][_0x92279f(0x141)]],_0x8c036e=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x21d)]],_0x162880=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x20c)]],_0x156b25=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x215)]],_0x6f980c=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x20b)]],_0x4d5c44=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x1dd)]],_0x2848d4=[_0x16bd42['body']['batch_code']],_0x1901b8=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x1d8)]],_0x599444=[_0x16bd42['body'][_0x92279f(0x1e7)]],_0x104eaf=[_0x16bd42[_0x92279f(0x130)]['production_date']],_0x106b9b=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x1ad)]],_0x337326=[_0x16bd42['body'][_0x92279f(0x187)]],_0x34abe6=[_0x16bd42[_0x92279f(0x130)]['delivery_code']],_0x5a5165=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x174)]],_0x1ce61b=[_0x16bd42[_0x92279f(0x130)]['quantity']],_0x3172d8=[_0x16bd42[_0x92279f(0x130)][_0x92279f(0x1c6)]];else var _0x44a0bb=[..._0x16bd42[_0x92279f(0x130)]['product_name']],_0x3821aa=[..._0x16bd42[_0x92279f(0x130)]['stock']],_0x5109b9=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x1c4)]],_0x1494ef=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x141)]],_0x8c036e=[..._0x16bd42['body']['secondary_code']],_0x162880=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x20c)]],_0x156b25=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x215)]],_0x6f980c=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x20b)]],_0x4d5c44=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x1dd)]],_0x2848d4=[..._0x16bd42['body'][_0x92279f(0x1bd)]],_0x1901b8=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x1d8)]],_0x599444=[..._0x16bd42['body'][_0x92279f(0x1e7)]],_0x104eaf=[..._0x16bd42['body']['production_date']],_0x106b9b=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x1ad)]],_0x337326=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x187)]],_0x34abe6=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x1b0)]],_0x5a5165=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x174)]],_0x1ce61b=[..._0x16bd42[_0x92279f(0x130)]['quantity']],_0x3172d8=[..._0x16bd42[_0x92279f(0x130)][_0x92279f(0x1c6)]];const _0x97ec70=_0x44a0bb[_0x92279f(0x159)](_0x2699e6=>{return _0x2699e6={'product_name':_0x2699e6};});_0x3821aa['forEach']((_0x1df654,_0x5a4e25)=>{var _0x2bf8ea=_0x92279f;_0x97ec70[_0x5a4e25][_0x2bf8ea(0x197)]=Math['abs'](_0x1df654);}),_0x5109b9['forEach']((_0x34eb37,_0x277652)=>{_0x97ec70[_0x277652]['quantity']=_0x34eb37;}),_0x1494ef['forEach']((_0x3b3f2f,_0x5966d9)=>{_0x97ec70[_0x5966d9]['primary_code']=_0x3b3f2f;}),_0x8c036e[_0x92279f(0x184)]((_0x11236f,_0x172f9d)=>{var _0x301f18=_0x92279f;_0x97ec70[_0x172f9d][_0x301f18(0x21d)]=_0x11236f;}),_0x162880[_0x92279f(0x184)]((_0x1c1302,_0x4845d0)=>{var _0x1ad0f8=_0x92279f;_0x97ec70[_0x4845d0][_0x1ad0f8(0x21c)]=_0x1c1302;}),_0x156b25[_0x92279f(0x184)]((_0xd6bfd3,_0x58a8e7)=>{var _0x3653b6=_0x92279f;_0x3172d8[_0x3653b6(0x184)]((_0x47760a,_0x3aca78)=>{var _0x17b21c=_0x3653b6;if(_0x47760a=='Receiving\x20Area'&&_0x58a8e7==_0x3aca78){var _0xd124d4=_0xd6bfd3[_0x17b21c(0x16a)](0x3);_0x97ec70[_0x58a8e7][_0x17b21c(0x150)]=_0xd6bfd3[0x0],_0x97ec70[_0x58a8e7][_0x17b21c(0x1a4)]=_0xd6bfd3[0x1],_0x97ec70[_0x58a8e7][_0x17b21c(0x1e9)]=0x0,_0x97ec70[_0x58a8e7][_0x17b21c(0x17e)]=0x0,_0x97ec70[_0x58a8e7][_0x17b21c(0x192)]=_0x17b21c(0x1ee),_0x97ec70[_0x58a8e7][_0x17b21c(0x18b)]=_0xd124d4;}else{if(_0x47760a==_0x17b21c(0x170)&&_0x58a8e7==_0x3aca78){var _0xd124d4=_0xd6bfd3['slice'](0x3);_0x97ec70[_0x58a8e7]['storage']=_0xd6bfd3[0x0],_0x97ec70[_0x58a8e7]['rack']=_0xd6bfd3[0x1],_0x97ec70[_0x58a8e7][_0x17b21c(0x1e9)]=0x0,_0x97ec70[_0x58a8e7][_0x17b21c(0x17e)]=0x0,_0x97ec70[_0x58a8e7][_0x17b21c(0x192)]=_0x17b21c(0x1ee),_0x97ec70[_0x58a8e7][_0x17b21c(0x18b)]=_0xd6bfd3[0x5];}else{if(_0x58a8e7==_0x3aca78){var _0x520353;if(_0xd6bfd3[0x4]=='L')_0x520353=_0x17b21c(0x1f2);else _0xd6bfd3[0x4]=='F'&&(_0x520353='Floor');_0x97ec70[_0x58a8e7]['storage']=_0xd6bfd3[0x0],_0x97ec70[_0x58a8e7]['rack']=_0xd6bfd3[0x1],_0x97ec70[_0x58a8e7][_0x17b21c(0x1e9)]=_0xd6bfd3[0x2],_0x97ec70[_0x58a8e7][_0x17b21c(0x17e)]=_0xd6bfd3[0x3],_0x97ec70[_0x58a8e7][_0x17b21c(0x192)]=_0x520353,_0x97ec70[_0x58a8e7]['floorlevel']=_0xd6bfd3[0x5];}}}});}),_0x6f980c['forEach']((_0x30168d,_0x49c66c)=>{var _0x3db31f=_0x92279f;_0x97ec70[_0x49c66c][_0x3db31f(0x1ae)]=_0x30168d;}),_0x4d5c44['forEach']((_0x168079,_0x3b25fd)=>{var _0x2474d7=_0x92279f;_0x97ec70[_0x3b25fd][_0x2474d7(0x1dd)]=_0x168079;}),_0x2848d4[_0x92279f(0x184)]((_0xae367f,_0x439b2c)=>{var _0x1bcb26=_0x92279f;_0x97ec70[_0x439b2c][_0x1bcb26(0x1bd)]=_0xae367f;}),_0x1901b8[_0x92279f(0x184)]((_0x45beb6,_0xd78eef)=>{_0x97ec70[_0xd78eef]['expiry_date']=_0x45beb6;}),_0x599444[_0x92279f(0x184)]((_0x313008,_0x24a6cf)=>{var _0x32d972=_0x92279f;_0x97ec70[_0x24a6cf][_0x32d972(0x1a3)]=_0x313008;}),_0x104eaf[_0x92279f(0x184)]((_0x4aa376,_0xe65b4b)=>{var _0x29f1f6=_0x92279f;_0x97ec70[_0xe65b4b][_0x29f1f6(0x1de)]=_0x4aa376;}),_0x106b9b[_0x92279f(0x184)]((_0x17a14b,_0x30a85e)=>{var _0x31f7ba=_0x92279f;_0x97ec70[_0x30a85e][_0x31f7ba(0x1ad)]=Math['abs'](_0x17a14b);}),_0x337326['forEach']((_0xcbff83,_0x2b3fef)=>{var _0x593053=_0x92279f;_0x97ec70[_0x2b3fef][_0x593053(0x187)]=_0xcbff83;}),_0x34abe6[_0x92279f(0x184)]((_0x1aef4b,_0xd2628c)=>{var _0x2cf844=_0x92279f;_0x97ec70[_0xd2628c][_0x2cf844(0x1b0)]=_0x1aef4b;}),_0x5a5165[_0x92279f(0x184)]((_0xefb370,_0x53b5f9)=>{var _0x3c6c6f=_0x92279f;_0x97ec70[_0x53b5f9][_0x3c6c6f(0x174)]=_0xefb370;}),_0x1ce61b['forEach']((_0x3e531b,_0x1e373a)=>{_0x97ec70[_0x1e373a]['quantity_notConverted']=_0x3e531b;}),_0x3172d8[_0x92279f(0x184)]((_0x40818b,_0x3d1808)=>{var _0x4ef73a=_0x92279f;_0x97ec70[_0x3d1808][_0x4ef73a(0x125)]=_0x40818b;});var _0x3277fa=0x0;_0x97ec70[_0x92279f(0x184)](_0x4e4312=>{var _0x21dd21=_0x92279f;console[_0x21dd21(0x135)](_0x21dd21(0x1d7),_0x4e4312),(parseInt(_0x4e4312[_0x21dd21(0x197)])<parseInt(_0x4e4312[_0x21dd21(0x16d)])||parseInt(_0x4e4312['quantity'])==0x0)&&_0x3277fa++;});if(_0x3277fa!=0x0)return _0x16bd42['flash'](_0x92279f(0x1cc),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x234b49['redirect'](_0x92279f(0x211));const _0x1a3e99=_0x97ec70['filter'](_0x28cbb1=>_0x28cbb1[_0x92279f(0x16d)]!=='0'&&_0x28cbb1[_0x92279f(0x16d)]!=='');_0xa5591f[_0x92279f(0x222)]=_0x59ca87,_0xa5591f[_0x92279f(0x1eb)]=_0x1781cb,_0xa5591f[_0x92279f(0x15c)]=_0x1c0c55,_0xa5591f[_0x92279f(0x1d2)]=_0x5d1866,_0xa5591f[_0x92279f(0x15e)]=_0x1a3e99,_0xa5591f['note']=_0x2faf40,_0xa5591f[_0x92279f(0x1e8)]=_0x57baca,_0xa5591f[_0x92279f(0x166)]=_0x92279f(0x154),_0xa5591f['isAllowEdit']=_0x92279f(0x154);const _0x55b9f0=await _0xa5591f['save']();_0x16bd42[_0x92279f(0x1f6)](_0x92279f(0x213),_0x92279f(0x1be)),_0x234b49['redirect'](_0x92279f(0x1a2));}catch(_0x42f13c){console[_0x92279f(0x135)](_0x42f13c);}}),router[a0_0x5b7120(0x14f)](a0_0x5b7120(0x1b8),auth,async(_0x263c5e,_0x44733d)=>{var _0x5b9aac=a0_0x5b7120;try{const _0x4eba88=_0x263c5e[_0x5b9aac(0x19d)]['id'],{invoice:_0x34c7e1,customer:_0x26bd39,receivable_amount:_0x49bec3,received_amount:_0x566b74}=_0x263c5e['body'],_0x462f9f=await sales['findById'](_0x4eba88);console['log'](_0x462f9f);var _0x412834=_0x49bec3-_0x566b74;console['log'](_0x566b74),_0x462f9f[_0x5b9aac(0x156)]=parseFloat(_0x566b74)+parseFloat(_0x462f9f[_0x5b9aac(0x156)]),_0x462f9f[_0x5b9aac(0x160)]=_0x412834,console[_0x5b9aac(0x135)](_0x462f9f);const _0x4980b3=await _0x462f9f[_0x5b9aac(0x1fb)](),_0x84cd52=await c_payment_data['findOne']({'invoice':_0x34c7e1});_0x84cd52['amount']=_0x412834,await _0x84cd52[_0x5b9aac(0x1fb)]();let _0x1b3643=new Date(),_0x5c2c2a=('0'+_0x1b3643[_0x5b9aac(0x161)]())[_0x5b9aac(0x16a)](-0x2),_0x114f82=('0'+(_0x1b3643[_0x5b9aac(0x1e5)]()+0x1))['slice'](-0x2),_0x5d8186=_0x1b3643[_0x5b9aac(0x1b1)](),_0x413512=_0x5d8186+'-'+_0x114f82+'-'+_0x5c2c2a;const _0x2690e9=new customer_payment({'invoice':_0x34c7e1,'date':_0x5d8186+'-'+_0x114f82+'-'+_0x5c2c2a,'customer':_0x26bd39,'reason':_0x5b9aac(0x1d9),'amount':_0x566b74}),_0x1637f9=await _0x2690e9[_0x5b9aac(0x1fb)]();_0x263c5e[_0x5b9aac(0x1f6)](_0x5b9aac(0x213),_0x5b9aac(0x1fe)),_0x44733d[_0x5b9aac(0x188)]('/all_sales/view');}catch(_0x32a6a3){console[_0x5b9aac(0x135)](_0x32a6a3);}}),router[a0_0x5b7120(0x127)](a0_0x5b7120(0x12e),auth,async(_0x555081,_0x290196)=>{var _0x42d122=a0_0x5b7120;try{const {username:_0x293165,email:_0x1eeaf6,role:_0x115991}=_0x555081['user'],_0x2d396f=_0x555081['user'],_0xc61e2=await profile[_0x42d122(0x1f0)]({'email':_0x2d396f['email']}),_0x37f9fa=await master_shop[_0x42d122(0x131)]();console[_0x42d122(0x135)]('master',_0x37f9fa);const _0x549e38=_0x555081[_0x42d122(0x19d)]['id'],_0x26ddc2=await sales['findById'](_0x549e38);console[_0x42d122(0x135)](_0x26ddc2);const _0x3a0d10=await customer['findOne']({'name':_0x26ddc2[_0x42d122(0x1eb)]});console[_0x42d122(0x135)](_0x3a0d10);if(_0x37f9fa[0x0][_0x42d122(0x18f)]==_0x42d122(0x1e1)){var _0x354fd3=users[_0x42d122(0x1ab)];console[_0x42d122(0x135)](_0x354fd3);}else{if(_0x37f9fa[0x0][_0x42d122(0x18f)]=='Hindi')var _0x354fd3=users[_0x42d122(0x1c9)];else{if(_0x37f9fa[0x0][_0x42d122(0x18f)]==_0x42d122(0x1da))var _0x354fd3=users['German'];else{if(_0x37f9fa[0x0]['language']==_0x42d122(0x1af))var _0x354fd3=users[_0x42d122(0x1af)];else{if(_0x37f9fa[0x0]['language']==_0x42d122(0x1bf))var _0x354fd3=users['French'];else{if(_0x37f9fa[0x0][_0x42d122(0x18f)]=='Portuguese\x20(BR)')var _0x354fd3=users[_0x42d122(0x1b5)];else{if(_0x37f9fa[0x0]['language']==_0x42d122(0x1a1))var _0x354fd3=users[_0x42d122(0x1a1)];else{if(_0x37f9fa[0x0][_0x42d122(0x18f)]==_0x42d122(0x198))var _0x354fd3=users[_0x42d122(0x1aa)];}}}}}}}_0x290196[_0x42d122(0x1dc)](_0x42d122(0x167),{'success':_0x555081[_0x42d122(0x1f6)]('success'),'errors':_0x555081['flash'](_0x42d122(0x1cc)),'role':_0x2d396f,'profile':_0xc61e2,'master_shop':_0x37f9fa,'customers':_0x3a0d10,'sales':_0x26ddc2,'language':_0x354fd3});}catch(_0x21ae39){console[_0x42d122(0x135)](_0x21ae39);}}),router['get'](a0_0x5b7120(0x15f),auth,async(_0x5c2e74,_0x183951)=>{var _0x5f53ac=a0_0x5b7120;try{const {username:_0x12b0cf,email:_0x102aa1,role:_0x4a2648}=_0x5c2e74[_0x5f53ac(0x189)],_0x5984e5=_0x5c2e74[_0x5f53ac(0x189)],_0x1d17fd=await profile[_0x5f53ac(0x1f0)]({'email':_0x5984e5['email']}),_0x3fbe3a=await master_shop['find']();console[_0x5f53ac(0x135)](_0x5f53ac(0x1f5),_0x3fbe3a);const _0x92a76f=_0x5c2e74[_0x5f53ac(0x19d)]['id'];console[_0x5f53ac(0x135)](_0x92a76f);const _0xb8517b=await sales[_0x5f53ac(0x13b)](_0x92a76f);console[_0x5f53ac(0x135)]('user_id',_0xb8517b);const _0x46ebd6=await warehouse[_0x5f53ac(0x16b)]([{'$match':{'name':'Return\x20Goods','room':_0x5f53ac(0x208)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5f53ac(0x1c7),'name':{'$first':_0x5f53ac(0x15a)},'product_stock':{'$first':_0x5f53ac(0x20e)},'level':{'$first':_0x5f53ac(0x1ca)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5f53ac(0x151)},'product_code':{'$first':_0x5f53ac(0x14c)}}}]);console[_0x5f53ac(0x135)]('stock_data',_0x46ebd6);const _0x511e2c=await product[_0x5f53ac(0x131)]({});warehouse_data=await warehouse[_0x5f53ac(0x16b)]([{'$match':{'status':_0x5f53ac(0x157),'name':_0x5f53ac(0x186),'warehouse_category':_0x5f53ac(0x21f)}},{'$group':{'_id':_0x5f53ac(0x1d6),'name':{'$first':_0x5f53ac(0x1d6)}}},{'$sort':{'name':0x1}}]);var _0x1df969=[_0x5f53ac(0x208)];if(_0x3fbe3a[0x0]['language']==_0x5f53ac(0x1e1)){var _0x499114=users[_0x5f53ac(0x1ab)];console[_0x5f53ac(0x135)](_0x499114);}else{if(_0x3fbe3a[0x0][_0x5f53ac(0x18f)]==_0x5f53ac(0x1c9))var _0x499114=users['Hindi'];else{if(_0x3fbe3a[0x0][_0x5f53ac(0x18f)]==_0x5f53ac(0x1da))var _0x499114=users['German'];else{if(_0x3fbe3a[0x0]['language']==_0x5f53ac(0x1af))var _0x499114=users[_0x5f53ac(0x1af)];else{if(_0x3fbe3a[0x0][_0x5f53ac(0x18f)]==_0x5f53ac(0x1bf))var _0x499114=users[_0x5f53ac(0x1bf)];else{if(_0x3fbe3a[0x0][_0x5f53ac(0x18f)]==_0x5f53ac(0x1df))var _0x499114=users['Portuguese'];else{if(_0x3fbe3a[0x0]['language']==_0x5f53ac(0x1a1))var _0x499114=users[_0x5f53ac(0x1a1)];else{if(_0x3fbe3a[0x0][_0x5f53ac(0x18f)]==_0x5f53ac(0x198))var _0x499114=users['Arabic'];}}}}}}}_0x183951['render'](_0x5f53ac(0x145),{'success':_0x5c2e74[_0x5f53ac(0x1f6)]('success'),'errors':_0x5c2e74[_0x5f53ac(0x1f6)]('errors'),'role':_0x5984e5,'profile':_0x1d17fd,'user':_0xb8517b,'stock':_0x46ebd6,'master_shop':_0x3fbe3a,'unit':_0x511e2c,'language':_0x499114,'warehouses':warehouse_data,'rooms':_0x1df969});}catch(_0x166297){console[_0x5f53ac(0x135)](_0x166297),_0x183951['status'](0xc8)[_0x5f53ac(0x1c2)]({'message':_0x166297[_0x5f53ac(0x21a)]});}}),router[a0_0x5b7120(0x14f)](a0_0x5b7120(0x15f),auth,async(_0x5a3a8e,_0xe38f4b)=>{var _0x280451=a0_0x5b7120;try{const {invoice:_0x363568,date:_0x54b19c,warehouse_name:_0x28d2d6,product_name:_0x841aed,primary_code:_0x251101,secondary_code:_0x4cabeb,product_code:_0x2983e4,sales_quantity:_0x4c9903,stocks:_0x392b70,return_qty:_0x460189,Room_name:_0x1525c5,to_warehouse_name:_0x236687,to_Roomname:_0x5d3050,to_Room_name:_0x14ba4c,note:_0xb557e,level:_0x10dd2b,isle:_0x5365b8,pallet:_0x307f69}=_0x5a3a8e[_0x280451(0x130)];if(typeof _0x841aed==_0x280451(0x164))var _0x5456cd=[_0x5a3a8e[_0x280451(0x130)][_0x280451(0x1b3)]],_0x5666cc=[_0x5a3a8e[_0x280451(0x130)][_0x280451(0x141)]],_0x14c2d4=[_0x5a3a8e[_0x280451(0x130)][_0x280451(0x21d)]],_0x59cee3=[_0x5a3a8e[_0x280451(0x130)][_0x280451(0x21c)]],_0x3bdaa1=[_0x5a3a8e[_0x280451(0x130)]['sales_quantity']],_0xd5edda=[_0x5a3a8e['body'][_0x280451(0x214)]],_0x27d77f=[_0x5a3a8e[_0x280451(0x130)][_0x280451(0x1a8)]],_0x14c144=[_0x5a3a8e['body']['bay']],_0x1d8642=[_0x5a3a8e['body'][_0x280451(0x17e)]],_0x56e065=[_0x5a3a8e['body'][_0x280451(0x1e0)]],_0x144718=[_0x5a3a8e[_0x280451(0x130)][_0x280451(0x18b)]];else var _0x5456cd=[..._0x5a3a8e['body'][_0x280451(0x1b3)]],_0x5666cc=[..._0x5a3a8e[_0x280451(0x130)][_0x280451(0x141)]],_0x14c2d4=[..._0x5a3a8e[_0x280451(0x130)]['secondary_code']],_0x59cee3=[..._0x5a3a8e[_0x280451(0x130)]['product_code']],_0x3bdaa1=[..._0x5a3a8e[_0x280451(0x130)][_0x280451(0x17a)]],_0xd5edda=[..._0x5a3a8e[_0x280451(0x130)][_0x280451(0x214)]],_0x27d77f=[..._0x5a3a8e['body'][_0x280451(0x1a8)]],_0x14c144=[..._0x5a3a8e['body']['bay']],_0x1d8642=[..._0x5a3a8e['body']['bin']],_0x56e065=[..._0x5a3a8e[_0x280451(0x130)][_0x280451(0x1e0)]],_0x144718=[..._0x5a3a8e[_0x280451(0x130)][_0x280451(0x18b)]];const _0x48b530=_0x5456cd['map'](_0xa5d4f=>{return _0xa5d4f={'product_name':_0xa5d4f};});_0x5666cc[_0x280451(0x184)]((_0x3536db,_0x112118)=>{var _0x385a57=_0x280451;_0x48b530[_0x112118][_0x385a57(0x141)]=_0x3536db;}),_0x14c2d4[_0x280451(0x184)]((_0x2ae752,_0x2f131a)=>{var _0x1bbfae=_0x280451;_0x48b530[_0x2f131a][_0x1bbfae(0x21d)]=_0x2ae752;}),_0x59cee3[_0x280451(0x184)]((_0x7e00f7,_0x38a893)=>{_0x48b530[_0x38a893]['product_code']=_0x7e00f7;}),_0x3bdaa1[_0x280451(0x184)]((_0x283434,_0x49b117)=>{var _0x16c8f0=_0x280451;_0x48b530[_0x49b117][_0x16c8f0(0x1a9)]=_0x283434;}),_0xd5edda[_0x280451(0x184)]((_0x219fda,_0x3ad9a0)=>{_0x48b530[_0x3ad9a0]['stock']=_0x219fda;}),_0x27d77f[_0x280451(0x184)]((_0x11e818,_0x3c64fa)=>{var _0x3ae177=_0x280451;_0x48b530[_0x3c64fa][_0x3ae177(0x1a8)]=_0x11e818;}),_0x14c144[_0x280451(0x184)]((_0x1ce461,_0x20413d)=>{_0x48b530[_0x20413d]['bay']=_0x1ce461;}),_0x1d8642[_0x280451(0x184)]((_0x6263d9,_0x157432)=>{var _0x1500e3=_0x280451;_0x48b530[_0x157432][_0x1500e3(0x17e)]=_0x6263d9;}),_0x56e065[_0x280451(0x184)]((_0x3670bb,_0x430233)=>{_0x48b530[_0x430233]['type']=_0x3670bb;}),_0x144718[_0x280451(0x184)]((_0x283605,_0x3cb1ba)=>{var _0x56f33f=_0x280451;_0x48b530[_0x3cb1ba][_0x56f33f(0x18b)]=_0x283605;});var _0x1ff8ab=0x0;_0x48b530[_0x280451(0x184)](_0x58a521=>{var _0x23f0f8=_0x280451;console[_0x23f0f8(0x135)](_0x23f0f8(0x1d7),_0x58a521),(parseInt(_0x58a521[_0x23f0f8(0x1a9)])<parseInt(_0x58a521[_0x23f0f8(0x1a8)])||parseInt(_0x58a521[_0x23f0f8(0x197)])<parseInt(_0x58a521[_0x23f0f8(0x1a8)])&&parseInt(_0x58a521[_0x23f0f8(0x1a9)])>parseInt(_0x58a521[_0x23f0f8(0x1a8)])||parseInt(_0x58a521[_0x23f0f8(0x1a8)])==0x0)&&_0x1ff8ab++;});if(_0x1ff8ab!=0x0)return _0x5a3a8e[_0x280451(0x1f6)]('errors',_0x280451(0x1f3)),_0xe38f4b['redirect'](_0x280451(0x211));const _0x221204=await sales[_0x280451(0x1f0)]({'invoice':_0x363568});console[_0x280451(0x135)](_0x221204),_0x221204['return_data']=_0x280451(0x168);const _0x3ec79e=await _0x221204[_0x280451(0x1fb)](),_0x3bc5a6=new sales_return({'invoice':_0x363568,'customer':_0x5a3a8e[_0x280451(0x130)][_0x280451(0x1eb)],'date':_0x54b19c,'warehouse_name':_0x28d2d6,'room':_0x1525c5,'ToWarehouse':_0x236687,'ToRoom':_0x14ba4c,'return_sale':_0x48b530,'note':_0xb557e}),_0x1aa0a3=await _0x3bc5a6[_0x280451(0x1fb)]();console[_0x280451(0x135)](_0x3bc5a6);const _0x88ed16=await sales_return[_0x280451(0x1f0)]({'invoice':_0x363568}),_0x3a958a=await warehouse[_0x280451(0x1f0)]({'name':_0x236687,'room':_0x14ba4c});_0x88ed16[_0x280451(0x145)][_0x280451(0x184)](_0xae56ff=>{var _0x7db539=_0x280451,_0x536fe5=0x0;const _0x200072=_0x3a958a[_0x7db539(0x144)]['map'](_0x524eee=>{var _0x28aa93=_0x7db539;_0x524eee[_0x28aa93(0x1b3)]==_0xae56ff[_0x28aa93(0x1b3)]&&_0x524eee[_0x28aa93(0x18b)]==_0xae56ff['floorlevel']&&_0x524eee[_0x28aa93(0x192)]==_0xae56ff['type']&&_0x524eee['bin']==_0xae56ff['bin']&&_0x524eee['bay']==_0xae56ff['bay']&&(_0x524eee['product_stock']=parseInt(_0x524eee[_0x28aa93(0x13a)])+parseInt(_0xae56ff['return_qty']),_0x536fe5++);});_0x536fe5=='0'&&(_0x3a958a[_0x7db539(0x144)]=_0x3a958a['product_details'][_0x7db539(0x124)]({'product_name':_0xae56ff[_0x7db539(0x1b3)],'product_stock':_0xae56ff[_0x7db539(0x1a8)],'primary_code':_0xae56ff[_0x7db539(0x141)],'secondary_code':_0xae56ff[_0x7db539(0x21d)],'product_code':_0xae56ff[_0x7db539(0x21c)],'bay':_0xae56ff[_0x7db539(0x1e9)],'bin':_0xae56ff[_0x7db539(0x17e)],'type':_0xae56ff['type'],'floorlevel':_0xae56ff['floorlevel']})),console[_0x7db539(0x135)](_0x7db539(0x1c1),_0x3a958a);}),await _0x3a958a[_0x280451(0x1fb)](),console['log'](_0x5a3a8e[_0x280451(0x130)]);const _0x43ba6f=new c_payment_data({'invoice':_0x363568,'customer':_0x5a3a8e['body'][_0x280451(0x1eb)],'reason':_0x280451(0x11e)});await _0x43ba6f[_0x280451(0x1fb)]();const _0x1ddb11=await master_shop[_0x280451(0x131)]();console[_0x280451(0x135)]('add\x20post',_0x1ddb11[0x0][_0x280451(0x19b)]);const _0x340cdf=await email_settings[_0x280451(0x1f0)](),_0x4ad7cf=await customer[_0x280451(0x1f0)]({'name':_0x5a3a8e[_0x280451(0x130)][_0x280451(0x1eb)]});console[_0x280451(0x135)](_0x280451(0x1e4),_0x4ad7cf);_0x1ddb11[0x0][_0x280451(0x183)]==0x1?(right_currency=_0x1ddb11[0x0][_0x280451(0x1b6)],left_currency=''):(right_currency='',left_currency=_0x1ddb11[0x0][_0x280451(0x1b6)]);var _0x4ea9ad=_0x5456cd,_0xcb9b81=_0x27d77f,_0x19fc1d='',_0x71f9c5;for(_0x71f9c5 in _0x4ea9ad){_0x19fc1d+=_0x280451(0x195)+_0x280451(0x14d)+_0x4ea9ad[_0x71f9c5]+_0x280451(0x1a0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcb9b81[_0x71f9c5]+'</td>'+_0x280451(0x142);}console[_0x280451(0x135)]('product_list',_0x19fc1d);let _0x2c782c=nodemailer[_0x280451(0x1d5)]({'service':_0x280451(0x1d1),'auth':{'user':_0x340cdf[_0x280451(0x17b)],'pass':_0x340cdf[_0x280451(0x152)]}}),_0x1aa37f={'from':_0x340cdf['email'],'to':_0x4ad7cf[_0x280451(0x17b)],'subject':'Sale\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+'/upload/'+_0x1ddb11[0x0][_0x280451(0x19b)],'cid':_0x280451(0x128)}],'html':_0x280451(0x1d0)+_0x280451(0x19a)+_0x280451(0x133)+_0x280451(0x201)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x280451(0x1cf)+_0x280451(0x217)+'<div>'+'<h2>\x20'+_0x1ddb11[0x0][_0x280451(0x1ea)]+_0x280451(0x14b)+_0x280451(0x217)+_0x280451(0x217)+_0x280451(0x121)+_0x280451(0x201)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x280451(0x1db)+_0x363568+'\x20'+_0x280451(0x1fa)+'\x20Order\x20Date\x20:\x20'+_0x54b19c+'\x20'+'</span>'+_0x280451(0x155)+'</div>'+_0x280451(0x199)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x280451(0x220)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>'+_0x280451(0x193)+_0x280451(0x142)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x19fc1d+'\x20'+_0x280451(0x15b)+_0x280451(0x11d)+_0x280451(0x201)+_0x280451(0x165)+_0x280451(0x1bc)+_0x1ddb11[0x0][_0x280451(0x1ea)]+_0x280451(0x155)+'</div>'+'</div>'+_0x280451(0x11c)};_0x2c782c[_0x280451(0x1e2)](_0x1aa37f,function(_0x38dfb3,_0x525e4e){var _0x2e248b=_0x280451;_0x38dfb3?(console['log'](_0x38dfb3),console[_0x2e248b(0x135)]('Error\x20Occurs')):console[_0x2e248b(0x135)](_0x2e248b(0x20f));}),_0x5a3a8e[_0x280451(0x1f6)](_0x280451(0x213),'sales\x20item\x20return\x20successfull'),_0xe38f4b[_0x280451(0x188)](_0x280451(0x1a2));}catch(_0x47451a){console['log'](_0x47451a),_0xe38f4b['status'](0xc8)['json']({'message1':_0x47451a['message']});}}),router[a0_0x5b7120(0x127)](a0_0x5b7120(0x21b),auth,async(_0x40c466,_0xfc8d81)=>{var _0x506e45=a0_0x5b7120;try{const {username:_0x33df2e,email:_0x3fc94f,role:_0x2bf91d}=_0x40c466[_0x506e45(0x189)],_0x5a642b=_0x40c466[_0x506e45(0x189)],_0x3bbbfa=await profile[_0x506e45(0x1f0)]({'email':_0x5a642b[_0x506e45(0x17b)]}),_0x51aca2=await master_shop[_0x506e45(0x131)]();console[_0x506e45(0x135)]('barcode\x20Product\x20master',_0x51aca2);const _0x2c0f08=_0x40c466['params']['id'],_0x8bcc14=await sales[_0x506e45(0x13b)](_0x2c0f08);console[_0x506e45(0x135)](_0x506e45(0x169),_0x8bcc14);if(_0x51aca2[0x0]['language']=='English\x20(US)')var _0x2a80ac=users['English'];else{if(_0x51aca2[0x0][_0x506e45(0x18f)]==_0x506e45(0x1c9))var _0x2a80ac=users['Hindi'];else{if(_0x51aca2[0x0][_0x506e45(0x18f)]==_0x506e45(0x1da))var _0x2a80ac=users['German'];else{if(_0x51aca2[0x0][_0x506e45(0x18f)]==_0x506e45(0x1af))var _0x2a80ac=users[_0x506e45(0x1af)];else{if(_0x51aca2[0x0]['language']==_0x506e45(0x1bf))var _0x2a80ac=users[_0x506e45(0x1bf)];else{if(_0x51aca2[0x0][_0x506e45(0x18f)]==_0x506e45(0x1df))var _0x2a80ac=users[_0x506e45(0x1b5)];else{if(_0x51aca2[0x0][_0x506e45(0x18f)]=='Chinese')var _0x2a80ac=users[_0x506e45(0x1a1)];else{if(_0x51aca2[0x0]['language']==_0x506e45(0x198))var _0x2a80ac=users['Arabic'];}}}}}}}_0xfc8d81[_0x506e45(0x1dc)](_0x506e45(0x163),{'success':_0x40c466['flash'](_0x506e45(0x213)),'errors':_0x40c466['flash']('errors'),'role':_0x5a642b,'profile':_0x3bbbfa,'alldata':_0x8bcc14,'master_shop':_0x51aca2,'language':_0x2a80ac});}catch(_0x80150){console[_0x506e45(0x135)](_0x80150);}}),router[a0_0x5b7120(0x14f)](a0_0x5b7120(0x13f),async(_0xd0eae,_0xff920a)=>{var _0x20e510=a0_0x5b7120;const {product_code:_0x2f9e90,warehouse_name:_0x153f35,rooms_data:_0x3e4bbf,Roomslist:_0x46bdf7}=_0xd0eae[_0x20e510(0x130)],_0x3e200c=_0x46bdf7[_0x20e510(0x138)](','),_0x5b01c8=[];async function _0x298441(_0x198ec8){var _0x130fef=_0x20e510;const _0x71c23a=await warehouse['aggregate']([{'$match':{'name':_0x153f35,'room':_0x198ec8}},{'$unwind':_0x130fef(0x136)},{'$match':{'product_details.primary_code':_0x2f9e90}},{'$group':{'_id':_0x130fef(0x1c7),'name':{'$first':_0x130fef(0x15a)},'product_stock':{'$first':_0x130fef(0x20e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x130fef(0x151)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x130fef(0x177)},'isle':{'$first':_0x130fef(0x158)},'type':{'$first':_0x130fef(0x17c)},'pallet':{'$first':_0x130fef(0x200)},'unit':{'$first':_0x130fef(0x178)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x130fef(0x212)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x130fef(0x1ed)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x130fef(0x18c)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x130fef(0x203)},'actual_qty':{'$first':_0x130fef(0x175)},'actual_uom':{'$first':_0x130fef(0x1f4)}}}]),_0xa3da97=await warehouse[_0x130fef(0x16b)]([{'$match':{'name':_0x153f35,'room':_0x198ec8}},{'$unwind':_0x130fef(0x136)},{'$match':{'product_details.secondary_code':_0x2f9e90}},{'$group':{'_id':_0x130fef(0x1c7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x130fef(0x20e)},'primary_code':{'$first':_0x130fef(0x1d4)},'secondary_code':{'$first':_0x130fef(0x151)},'product_code':{'$first':_0x130fef(0x14c)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x130fef(0x158)},'type':{'$first':_0x130fef(0x17c)},'pallet':{'$first':_0x130fef(0x200)},'unit':{'$first':_0x130fef(0x178)},'secondary_unit':{'$first':_0x130fef(0x12a)},'storage':{'$first':_0x130fef(0x212)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x130fef(0x1ef)},'production_date':{'$first':_0x130fef(0x1c5)},'maxPerUnit':{'$first':_0x130fef(0x1ed)},'batch_code':{'$first':_0x130fef(0x146)},'product_cat':{'$first':_0x130fef(0x18c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x71c23a[_0x130fef(0x123)]>0x0)_0x5b01c8['push'](_0x71c23a);else _0xa3da97[_0x130fef(0x123)]>0x0&&_0x5b01c8[_0x130fef(0x207)](_0xa3da97);}const _0x1562fa=_0x3e200c[_0x20e510(0x159)](_0x1297bb=>_0x298441(_0x1297bb));await Promise[_0x20e510(0x1a7)](_0x1562fa),_0xff920a['json'](_0x5b01c8);}),module[a0_0x5b7120(0x190)]=router;function a0_0x23cd(){var _0x3050a7=['sale_qty','Arabic','English','floor','requested_qty','unit','Spanish','delivery_code','getFullYear','$invoice','product_name','1760283WFFZbP','Portuguese','currency','$sale_product.floorlevel','/give_payment/:id','express','all_sales','random','<h5>','batch_code','Sales\x20Update\x20successfully','French','../middleware/auth','final','json','$product_details.rack','carton','$product_details.production_date','RoomAssigned','$product_details._id','Sales\x20Mail','Hindi','$product_details.level','/view/add_sale/product','errors','</thead>','warehouse','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<!DOCTYPE\x20html>','gmail','warehouse_name','/preview/:id','$product_details.primary_code','createTransport','$name','foreach\x20newproduct','expiry_date','Received\x20Payment\x20For\x20Sale','German','\x20Order\x20Number\x20:\x20','render','secondary_unit','production_date','Portuguese\x20(BR)','types','English\x20(US)','sendMail','customers','customer_data','getMonth','/view/add_sales','max_per_unit','SCRN','bay','site_title','customer','product_data','$product_details.maxPerUnit','Floor','$product_details.expiry_date','findOne','8260245CzfMgP','Level','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.actual_uom','master','flash','2215370OHeVQL','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/view/add_sales/:id','<span\x20style=\x22float:\x20right;\x22>','save','port','$warehouse_name','payment\x20successfull','then','$product_details.floorlevel','<div>','$date','$product_details.invoice','3603078vKNwGo','$product.product_name','toString','push','Return\x20Rooms','$sale_product.quantity','2695060DUuFpZ','primary_unit','prod_code','customers_docs','$product_details.product_stock','Email\x20sent\x20successfully','OUT-','back','$product_details.storage','success','stocks','level','$finalize','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','8lotTCz','message','/barcode/:id','product_code','secondary_code','filter','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','invoice','RMSEmail','quantity_notConverted','</body></html>','</table>','Sale\x20Return','Sales\x20Add\x20successfully','Enclosed','<hr\x20class=\x22my-3\x22>','purchases_data','length','concat','room_name','Router','get','logo','Ambient','$product_details.secondary_unit','An\x20error\x20occurred.','$product','$isAllowEdit','/invoice/:id','nodemailer','body','find','An\x20error\x20occurred\x20while\x20saving\x20data.','</head><body>','sales\x20all_data','log','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','split','Receiving\x20Area','product_stock','findById','actual_uom','10UiHUdA','<h2>\x20','/barcode_scanner','/view/:id','primary_code','</tr>','role','product_details','return_sale','$product_details.batch_code','/all_sales/preview/','catch','edit_sales_view','padStart','\x20</h2>','$product_details.product_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$customer','post','storage','$product_details.secondary_code','password','error','False','</h5>','received_amount','Enabled','$product_details.bin','map','$product_details.product_name','</tbody>','date','7791742MdpzeC','sale_product','/view/return_sales/:id','due_amount','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','all_sales_barcode','string','<strong>\x20Regards\x20</strong>','finalize','sales_invoice','True','barcode\x20user_id','slice','aggregate','</span>','quantity','/../public','575172GnbsUp','Shelves','$sale_product.bay','$_id','/view','prod_cat','$product_details.actual_qty','host','$product_details.bay','$product_details.unit','actual_qty','sales_quantity','email','$product_details.type','There\x27s\x20a\x20error\x20in\x20this\x20transaction','bin','$return_data','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../public/language/languages.json','currency_placement','forEach','2UhyBGP','Return\x20Goods','delivery_date','redirect','user','prod_invoice','floorlevel','$product_details.product_cat','abs','name','language','exports','add_sales','type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$customers_docs','<tr>','staff','stock','Arabic\x20(ae)','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<html><head><title></title>','image','$sale_product','params','\x20Order\x20Date\x20:\x20','/upload/','</td>','Chinese','/all_sales/view','maxperunit','rack','Logo.png','$note','all','return_qty'];a0_0x23cd=function(){return _0x3050a7;};return a0_0x23cd();}