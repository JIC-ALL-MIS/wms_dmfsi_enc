var a0_0x591ade=a0_0x3736;function a0_0x3458(){var _0x16e098=['Ambient','floorlevel','$sale_product.bin','catch','production_date','max','303582jAHSgO','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','warehouse_name','max_per_unit','RoomAssigned','secondary_code','redirect','$isAllowEdit','$product_details.bin','invoice','user','maxperunit','quantity','$product_details.isle','$product.product_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','map','types','<h5\x20style=\x22text-align:\x20left;\x22>','SCRN','English\x20(US)','$name','$product_details.rack','sales\x20item\x20return\x20successfull','stock_data','<tbody\x20style=\x22text-align:\x20center;\x22>','delivery_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$_id','Hindi','language','floor','primary_unit','$product_details.actual_qty','name','expiry_date','</td>','forEach','$product_details.expiry_date','<tr>','save','</head><body>','getDate','Sale\x20Return','/../public','return_sale','password','bin','all','site_title','staff','delivery_date','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','secondary_unit','actual_qty','isAllowEdit','$product_details.type','$sale_product.floorlevel','/preview/:id','getFullYear','$product_details.primary_code','carton','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','True','nodemailer','\x20Order\x20Date\x20:\x20','flash','createTransport','$product_details.production_date','finalize','$warehouse_name','customer','post','port','22QARzLK','Arabic','$customer','$product','errors','$product_details.storage','Portuguese\x20(BR)','</tr>','Sales\x20Add\x20successfully','role','$product_details.batch_code','length','$product_details','OUT-','product','warehouse','note','../models/all_models','$customers_docs','requested_qty','Receiving\x20Area','host','unit','currency_placement','sendMail','<!DOCTYPE\x20html>','Portuguese','$date','add_sales','$sale_product.bay','padStart','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','back','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','foreach\x20newproduct','string','10746392OXlsZt','$invoice','id_transaction_from','final','/all_sales/preview/','/invoice/:id','$finalize','Sale\x20Return\x20Mail','$sale_product.quantity','$product_details.floorlevel','json','user_id','product_code','Spanish','all_sales','2073291zhbZOm','/view/add_sales/:id','</table>','Return\x20Goods','<span\x20style=\x22float:\x20right;\x22>','$sale_product','split','<html><head><title></title>','Enclosed','abs','$sale_product.type','<h5>','../middleware/auth','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','3464930wTbsgC','currency','received_amount','id_transact','edit_sales','due_amount','RMSEmail','False','prod_code','customer_data','English','/view/add_sale/product','Sales\x20Update\x20successfully','$product_details.maxPerUnit','return_qty','customers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Sales\x20Mail','params','sale_product','</tbody>','</span>','prod_cat','level','product_data','rack','Enabled','email','return_data','room_name','Logo.png','findOne','findById','concat','\x20Order\x20Number\x20:\x20','image','/all_sales/view','An\x20error\x20occurred\x20while\x20saving\x20data.','/upload/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.unit','<hr\x20class=\x22my-3\x22>','\x20</h2>','error','$product_details.product_cat','logo','/view/add_sales','find','stock','storage','1870490LcyEwd','<strong>\x20Regards\x20</strong>','random','get','type','Chinese','$product_details.product_code','product_name','prod_invoice','3875244CgVlxI','toString','_id','$product_details.secondary_code','sales_invoice','barcode\x20user_id','60757NceQVK','sales_quantity','$product_details._id','<h2>\x20','Arabic\x20(ae)','batch_code','aggregate','stocks','Router','bay','success','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','filter','customers','body','gmail','slice','log','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.invoice','message','Raw\x20Materials','</thead>','barcode\x20Product\x20master','sale_qty','quantity_notConverted','$return_data','$product_details.bay','Floor','actual_uom','payment\x20successfull','/view','$product_details.secondary_unit','</div>','$note','German','date','then','product_details','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','exports','product_stock','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','push','render','$product_details.product_stock','French','<div>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Level','$room','edit_sales_view','/view/return_sales/:id','$product_details.level'];a0_0x3458=function(){return _0x16e098;};return a0_0x3458();}function a0_0x3736(_0x34687d,_0xd9d754){var _0x3458b9=a0_0x3458();return a0_0x3736=function(_0x373672,_0x16a0df){_0x373672=_0x373672-0xcd;var _0x242fca=_0x3458b9[_0x373672];return _0x242fca;},a0_0x3736(_0x34687d,_0xd9d754);}(function(_0x335159,_0x32a199){var _0x576a3f=a0_0x3736,_0xc5065d=_0x335159();while(!![]){try{var _0x4d1dcc=-parseInt(_0x576a3f(0x181))/0x1*(-parseInt(_0x576a3f(0xfd))/0x2)+-parseInt(_0x576a3f(0x131))/0x3+parseInt(_0x576a3f(0x17b))/0x4+parseInt(_0x576a3f(0x172))/0x5+parseInt(_0x576a3f(0x1c0))/0x6+parseInt(_0x576a3f(0x140))/0x7+-parseInt(_0x576a3f(0x122))/0x8;if(_0x4d1dcc===_0x32a199)break;else _0xc5065d['push'](_0xc5065d['shift']());}catch(_0xcf148a){_0xc5065d['push'](_0xc5065d['shift']());}}}(a0_0x3458,0x7f8bb));const express=require('express'),app=express(),router=express[a0_0x591ade(0x189)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x591ade(0x10e)),auth=require(a0_0x591ade(0x13d)),nodemailer=require(a0_0x591ade(0xf3)),users=require('../public/language/languages.json');router['get'](a0_0x591ade(0x1a1),auth,async(_0xb5a770,_0x4f4870)=>{var _0x40cdb7=a0_0x591ade;try{const {username:_0x1b6212,email:_0x2a03a2,role:_0x513e5a}=_0xb5a770[_0x40cdb7(0x1ca)],_0x4421fa=_0xb5a770['user'],_0x31bdde=await profile['findOne']({'email':_0x4421fa[_0x40cdb7(0x15b)]}),_0x3e5346=await master_shop[_0x40cdb7(0x16f)]();let _0x48ec26;if(_0x4421fa['role']==_0x40cdb7(0xe3)){const _0x551885=await staff[_0x40cdb7(0x15f)]({'email':_0x4421fa[_0x40cdb7(0x15b)]});_0x48ec26=await sales[_0x40cdb7(0x187)]([{'$lookup':{'from':_0x40cdb7(0x18f),'localField':_0x40cdb7(0xfa),'foreignField':_0x40cdb7(0xd3),'as':_0x40cdb7(0x14f)}},{'$unwind':'$customers_docs'},{'$unwind':_0x40cdb7(0x136)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':'$customer'},'date':{'$first':_0x40cdb7(0x118)},'warehouse_name':{'$first':_0x40cdb7(0xf9)},'sale_product':{'$push':_0x40cdb7(0x136)},'note':{'$first':_0x40cdb7(0x1a4)},'return_data':{'$first':_0x40cdb7(0x19c)},'customers_docs':{'$first':'$customers_docs'},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x40cdb7(0x1bc)},'type':{'$addToSet':_0x40cdb7(0x13b)},'pallet':{'$addToSet':_0x40cdb7(0xeb)},'finalize':{'$first':_0x40cdb7(0x128)},'isAllowEdit':{'$first':_0x40cdb7(0x1c7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x48ec26=await sales[_0x40cdb7(0x187)]([{'$lookup':{'from':_0x40cdb7(0x18f),'localField':_0x40cdb7(0xfa),'foreignField':_0x40cdb7(0xd3),'as':_0x40cdb7(0x14f)}},{'$unwind':_0x40cdb7(0x10f)},{'$unwind':_0x40cdb7(0x136)},{'$group':{'_id':_0x40cdb7(0xcd),'invoice':{'$first':_0x40cdb7(0x123)},'customers':{'$first':_0x40cdb7(0xff)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x40cdb7(0xf9)},'sale_product':{'$push':_0x40cdb7(0x136)},'note':{'$first':_0x40cdb7(0x1a4)},'return_data':{'$first':_0x40cdb7(0x19c)},'customers_docs':{'$first':_0x40cdb7(0x10f)},'total_saleproduct_quantity':{'$sum':_0x40cdb7(0x12a)},'level':{'$addToSet':_0x40cdb7(0x11a)},'isle':{'$addToSet':_0x40cdb7(0x1bc)},'type':{'$addToSet':_0x40cdb7(0x13b)},'pallet':{'$addToSet':_0x40cdb7(0xeb)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x40cdb7(0x1c7)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x40cdb7(0x193)]('sales\x20all_data',_0x48ec26);if(_0x3e5346[0x0][_0x40cdb7(0xcf)]==_0x40cdb7(0x1d5)){var _0xe77d91=users[_0x40cdb7(0x14a)];console[_0x40cdb7(0x193)](_0xe77d91);}else{if(_0x3e5346[0x0][_0x40cdb7(0xcf)]==_0x40cdb7(0xce))var _0xe77d91=users[_0x40cdb7(0xce)];else{if(_0x3e5346[0x0]['language']==_0x40cdb7(0x1a5))var _0xe77d91=users[_0x40cdb7(0x1a5)];else{if(_0x3e5346[0x0][_0x40cdb7(0xcf)]==_0x40cdb7(0x12f))var _0xe77d91=users[_0x40cdb7(0x12f)];else{if(_0x3e5346[0x0][_0x40cdb7(0xcf)]=='French')var _0xe77d91=users['French'];else{if(_0x3e5346[0x0][_0x40cdb7(0xcf)]==_0x40cdb7(0x103))var _0xe77d91=users[_0x40cdb7(0x117)];else{if(_0x3e5346[0x0][_0x40cdb7(0xcf)]==_0x40cdb7(0x177))var _0xe77d91=users[_0x40cdb7(0x177)];else{if(_0x3e5346[0x0]['language']=='Arabic\x20(ae)')var _0xe77d91=users[_0x40cdb7(0xfe)];}}}}}}}_0x4f4870[_0x40cdb7(0x1b0)](_0x40cdb7(0x130),{'success':_0xb5a770[_0x40cdb7(0xf5)]('success'),'errors':_0xb5a770[_0x40cdb7(0xf5)](_0x40cdb7(0x101)),'sales':_0x48ec26,'profile':_0x31bdde,'role':_0x4421fa,'master_shop':_0x3e5346,'language':_0xe77d91});}catch(_0x5065a4){console[_0x40cdb7(0x193)](_0x5065a4);}});async function getRandom8DigitNumber(){var _0x2245b7=a0_0x591ade;const _0x8d2a65=0x989680,_0x2b309d=0x5f5e0ff,_0x1c0bfe=Math[_0x2245b7(0xd0)](Math[_0x2245b7(0x174)]()*(_0x2b309d-_0x8d2a65+0x1))+_0x8d2a65;var _0x3a87c8;const _0x5c4176=await sales[_0x2245b7(0x15f)]({'invoice':_0x2245b7(0x10a)+_0x1c0bfe});return _0x5c4176&&_0x5c4176[_0x2245b7(0x108)]>0x0?_0x3a87c8=_0x2245b7(0x10a)+_0x1c0bfe:_0x3a87c8=_0x2245b7(0x10a)+_0x1c0bfe,_0x3a87c8;}router[a0_0x591ade(0x175)]('/view/add_sales',auth,async(_0x1b0117,_0x50b48b)=>{var _0x15ff37=a0_0x591ade;try{const {username:_0x246370,email:_0x5bef97,role:_0x45ba50}=_0x1b0117[_0x15ff37(0x1ca)],_0x471b2b=_0x1b0117[_0x15ff37(0x1ca)],_0x450786=await profile[_0x15ff37(0x15f)]({'email':_0x471b2b['email']}),_0x38f2af=await master_shop[_0x15ff37(0x16f)](),_0x57f412=await customer[_0x15ff37(0x16f)]({});let _0x35ff1e;if(_0x471b2b[_0x15ff37(0x106)]==_0x15ff37(0xe3)){const _0x3725b8=await staff[_0x15ff37(0x15f)]({'email':_0x471b2b[_0x15ff37(0x15b)]});_0x35ff1e=await warehouse['aggregate']([{'$match':{'status':_0x15ff37(0x15a),'name':_0x3725b8[_0x15ff37(0x10c)],'warehouse_category':_0x15ff37(0x197),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x15ff37(0x1d6),'name':{'$first':_0x15ff37(0x1d6)}}},{'$sort':{'name':0x1}}]);}else _0x35ff1e=await warehouse['aggregate']([{'$match':{'status':_0x15ff37(0x15a),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x15ff37(0x1d6)}}},{'$sort':{'name':0x1}}]);const _0x5e1c1d=await product[_0x15ff37(0x16f)]({});var _0x491f5b=[_0x15ff37(0x1ba),_0x15ff37(0x139)];const _0x2719d9=await sales['find']({}),_0x1d2229=_0x2719d9[_0x15ff37(0x108)]+0x1,_0x58b0bd=_0x15ff37(0x10a)+_0x1d2229[_0x15ff37(0x17c)]()[_0x15ff37(0x11b)](0x5,'0');if(_0x38f2af[0x0][_0x15ff37(0xcf)]=='English\x20(US)'){var _0x49dc87=users[_0x15ff37(0x14a)];console['log'](_0x49dc87);}else{if(_0x38f2af[0x0][_0x15ff37(0xcf)]==_0x15ff37(0xce))var _0x49dc87=users[_0x15ff37(0xce)];else{if(_0x38f2af[0x0][_0x15ff37(0xcf)]==_0x15ff37(0x1a5))var _0x49dc87=users['German'];else{if(_0x38f2af[0x0][_0x15ff37(0xcf)]==_0x15ff37(0x12f))var _0x49dc87=users['Spanish'];else{if(_0x38f2af[0x0][_0x15ff37(0xcf)]=='French')var _0x49dc87=users[_0x15ff37(0x1b2)];else{if(_0x38f2af[0x0][_0x15ff37(0xcf)]==_0x15ff37(0x103))var _0x49dc87=users[_0x15ff37(0x117)];else{if(_0x38f2af[0x0][_0x15ff37(0xcf)]==_0x15ff37(0x177))var _0x49dc87=users[_0x15ff37(0x177)];else{if(_0x38f2af[0x0]['language']==_0x15ff37(0x185))var _0x49dc87=users[_0x15ff37(0xfe)];}}}}}}}const _0x372ca1=getRandom8DigitNumber();_0x372ca1[_0x15ff37(0x1a7)](_0x18aa35=>{var _0x15cc1f=_0x15ff37;_0x50b48b['render'](_0x15cc1f(0x119),{'success':_0x1b0117['flash'](_0x15cc1f(0x18b)),'errors':_0x1b0117[_0x15cc1f(0xf5)](_0x15cc1f(0x101)),'role':_0x471b2b,'profile':_0x450786,'customer':_0x57f412,'warehouse':_0x35ff1e,'product':_0x5e1c1d,'invoice':_0x18aa35,'master_shop':_0x38f2af,'language':_0x49dc87,'rooms_data':_0x491f5b});})[_0x15ff37(0x1bd)](_0xe4d8fb=>{var _0x4e1716=_0x15ff37;_0x1b0117[_0x4e1716(0xf5)](_0x4e1716(0x101),_0x4e1716(0x1dc)),_0x50b48b[_0x4e1716(0x1c6)](_0x4e1716(0x164));});}catch(_0x5c538c){console[_0x15ff37(0x193)](_0x5c538c);}}),router['get'](a0_0x591ade(0x132),auth,async(_0x3f2803,_0x4013cc)=>{var _0x2378ad=a0_0x591ade;try{const _0x4376db=_0x3f2803[_0x2378ad(0x152)]['id'];console[_0x2378ad(0x193)](_0x4376db);const _0x4d43b1=await product[_0x2378ad(0x16f)](),_0x1c2fbd=await purchases[_0x2378ad(0x187)]([{'$match':{'warehouse_name':_0x4376db}},{'$unwind':_0x2378ad(0x100)},{'$group':{'_id':_0x2378ad(0x1ce)}}]);console[_0x2378ad(0x193)]('purchases_data',_0x1c2fbd),_0x4013cc[_0x2378ad(0xf0)](0xc8)[_0x2378ad(0x12c)]({'purchases_data':_0x1c2fbd,'product_data':_0x4d43b1});}catch(_0x50eb6f){console[_0x2378ad(0x193)](_0x50eb6f);}}),router[a0_0x591ade(0xfb)](a0_0x591ade(0x14b),auth,async(_0x3f8ff7,_0x3497d1)=>{var _0xc0de9c=a0_0x591ade;try{const {warehouse_data:_0x2fee80,product_data:_0xad3067}=_0x3f8ff7['body'];console[_0xc0de9c(0x193)](_0x3f8ff7['body'][_0xc0de9c(0x158)]);;const _0x4d5c41=await master_shop[_0xc0de9c(0x16f)]();console[_0xc0de9c(0x193)](_0xc0de9c(0x11e),_0x4d5c41);const _0x930904=await product[_0xc0de9c(0x15f)]({'name':_0xad3067});console[_0xc0de9c(0x193)](_0xc0de9c(0x10b),_0x930904);const _0x158319=await warehouse['aggregate']([{'$match':{'name':_0x2fee80}},{'$unwind':_0xc0de9c(0x109)},{'$match':{'product_details.product_name':_0xad3067}},{'$group':{'_id':_0xc0de9c(0x1d0),'product_stock':{'$first':_0xc0de9c(0x1b1)}}}]);console['log'](_0xc0de9c(0x1d9),_0x158319),_0x3497d1['status'](0xc8)[_0xc0de9c(0x12c)]({'master':_0x4d5c41,'new_product':_0x930904,'stock_data':_0x158319});}catch(_0x2b883b){console[_0xc0de9c(0x193)](_0x2b883b);}}),router[a0_0x591ade(0xfb)](a0_0x591ade(0x16e),auth,async(_0x47f948,_0x3656d2)=>{var _0xf5cf9a=a0_0x591ade;try{const {invoice:_0x359f67,date:_0x54d0b1,warehouse_name:_0x3cccb2,product_name:_0x3b8812,stock:_0x4541bd,quantity:_0x4a744c,note:_0x3ec40b,room:_0x25d23e,primary_code:_0xb98cdd,secondary_code:_0x2d8895,prod_code:_0x595095,level:_0x1a9a28,isle:_0x403d64,pallet:_0x37b749,batch_code:_0xa1d891,SCRN:_0x40e9f4,expiry_date:_0xb50635}=_0x47f948[_0xf5cf9a(0x190)];if(typeof _0x3b8812=='string')var _0x380b62=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x179)]],_0x3c169d=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x170)]],_0x4e24b1=[_0x47f948[_0xf5cf9a(0x190)]['carton']],_0x599824=[_0x47f948[_0xf5cf9a(0x190)]['primary_code']],_0xd518ab=[_0x47f948[_0xf5cf9a(0x190)]['secondary_code']],_0x1de9b9=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x148)]],_0x38951d=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x157)]],_0x16f194=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0xd1)]],_0xf0bca5=[_0x47f948[_0xf5cf9a(0x190)]['secondary_unit']],_0x480396=[_0x47f948['body']['batch_code']],_0x5cfa78=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0xd4)]],_0x1fdee3=[_0x47f948[_0xf5cf9a(0x190)]['max_per_unit']],_0x4eed6d=[_0x47f948[_0xf5cf9a(0x190)]['production_date']],_0x5ef081=[_0x47f948['body'][_0xf5cf9a(0x110)]],_0x580501=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0xe4)]],_0xf362ce=[_0x47f948['body']['delivery_code']],_0x331f60=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x156)]],_0x3168c3=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x1cc)]],_0x2610b6=[_0x47f948['body']['RoomAssigned']],_0x25aff0=[_0x47f948['body'][_0xf5cf9a(0x17a)]],_0x41686e=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0xe8)]],_0x5bf15a=[_0x47f948[_0xf5cf9a(0x190)]['actual_uom']],_0x2f3849=[_0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x143)]];else var _0x380b62=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x179)]],_0x3c169d=[..._0x47f948[_0xf5cf9a(0x190)]['stock']],_0x4e24b1=[..._0x47f948[_0xf5cf9a(0x190)]['carton']],_0x599824=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x1a9)]],_0xd518ab=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x1c5)]],_0x1de9b9=[..._0x47f948[_0xf5cf9a(0x190)]['prod_code']],_0x38951d=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x157)]],_0x16f194=[..._0x47f948[_0xf5cf9a(0x190)]['primary_unit']],_0xf0bca5=[..._0x47f948[_0xf5cf9a(0x190)]['secondary_unit']],_0x480396=[..._0x47f948['body'][_0xf5cf9a(0x186)]],_0x5cfa78=[..._0x47f948[_0xf5cf9a(0x190)]['expiry_date']],_0x1fdee3=[..._0x47f948['body'][_0xf5cf9a(0x1c3)]],_0x4eed6d=[..._0x47f948['body']['production_date']],_0x5ef081=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x110)]],_0x580501=[..._0x47f948['body'][_0xf5cf9a(0xe4)]],_0xf362ce=[..._0x47f948['body']['delivery_code']],_0x331f60=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x156)]],_0x3168c3=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x1cc)]],_0x2610b6=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x1c4)]],_0x25aff0=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x17a)]],_0x41686e=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0xe8)]],_0x5bf15a=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x19f)]],_0x2f3849=[..._0x47f948[_0xf5cf9a(0x190)][_0xf5cf9a(0x143)]];const _0x7074cf=_0x380b62['map'](_0x310f9a=>{return _0x310f9a={'product_name':_0x310f9a};});_0x3c169d[_0xf5cf9a(0xd6)]((_0x124619,_0x457da5)=>{var _0x5b4e61=_0xf5cf9a;_0x7074cf[_0x457da5][_0x5b4e61(0x170)]=Math[_0x5b4e61(0x13a)](_0x124619);}),_0x41686e['forEach']((_0xc6bfca,_0x5c9207)=>{var _0xa65a31=_0xf5cf9a;_0x7074cf[_0x5c9207][_0xa65a31(0xe8)]=Math['abs'](_0xc6bfca);}),_0x5bf15a[_0xf5cf9a(0xd6)]((_0x520dff,_0x3e8b94)=>{var _0x445652=_0xf5cf9a;_0x7074cf[_0x3e8b94][_0x445652(0x19f)]=_0x520dff;}),_0x2f3849[_0xf5cf9a(0xd6)]((_0x13a511,_0x5dade9)=>{var _0x5484ec=_0xf5cf9a;_0x7074cf[_0x5dade9][_0x5484ec(0x124)]=_0x13a511;}),_0x4e24b1[_0xf5cf9a(0xd6)]((_0x27934d,_0x3710d0)=>{_0x7074cf[_0x3710d0]['quantity']=_0x27934d;}),_0x599824[_0xf5cf9a(0xd6)]((_0x76fb44,_0x3ff7a7)=>{_0x7074cf[_0x3ff7a7]['primary_code']=_0x76fb44;}),_0xd518ab['forEach']((_0x404eef,_0x5c9ad3)=>{var _0x22ad2e=_0xf5cf9a;_0x7074cf[_0x5c9ad3][_0x22ad2e(0x1c5)]=_0x404eef;}),_0x1de9b9['forEach']((_0x4ccb1a,_0x35bfe5)=>{var _0x3afcb6=_0xf5cf9a;_0x7074cf[_0x35bfe5][_0x3afcb6(0x12e)]=_0x4ccb1a;}),_0x38951d[_0xf5cf9a(0xd6)]((_0x9fc2b0,_0x24af6c)=>{_0x2610b6['forEach']((_0x43575f,_0x22fcaf)=>{var _0x3d26f2=a0_0x3736;if(_0x43575f=='Receiving\x20Area'&&_0x24af6c==_0x22fcaf){var _0x5cc897=_0x9fc2b0[_0x3d26f2(0x192)](0x3);_0x7074cf[_0x24af6c]['storage']=_0x9fc2b0[0x0],_0x7074cf[_0x24af6c][_0x3d26f2(0x159)]=_0x9fc2b0[0x1],_0x7074cf[_0x24af6c][_0x3d26f2(0x18a)]=0x0,_0x7074cf[_0x24af6c][_0x3d26f2(0xe0)]=0x0,_0x7074cf[_0x24af6c][_0x3d26f2(0x176)]='Floor',_0x7074cf[_0x24af6c][_0x3d26f2(0x1bb)]=_0x5cc897;}else{if(_0x43575f==_0x3d26f2(0xe5)&&_0x24af6c==_0x22fcaf){var _0x5cc897=_0x9fc2b0['slice'](0x3);_0x7074cf[_0x24af6c][_0x3d26f2(0x171)]=_0x9fc2b0[0x0],_0x7074cf[_0x24af6c]['rack']=_0x9fc2b0[0x1],_0x7074cf[_0x24af6c][_0x3d26f2(0x18a)]=0x0,_0x7074cf[_0x24af6c][_0x3d26f2(0xe0)]=0x0,_0x7074cf[_0x24af6c][_0x3d26f2(0x176)]=_0x3d26f2(0x19e),_0x7074cf[_0x24af6c][_0x3d26f2(0x1bb)]=_0x9fc2b0[0x5];}else{if(_0x24af6c==_0x22fcaf){var _0x56e634;if(_0x9fc2b0[0x4]=='L')_0x56e634=_0x3d26f2(0x1b5);else _0x9fc2b0[0x4]=='F'&&(_0x56e634=_0x3d26f2(0x19e));_0x7074cf[_0x24af6c]['storage']=_0x9fc2b0[0x0],_0x7074cf[_0x24af6c][_0x3d26f2(0x159)]=_0x9fc2b0[0x1],_0x7074cf[_0x24af6c][_0x3d26f2(0x18a)]=_0x9fc2b0[0x2],_0x7074cf[_0x24af6c]['bin']=_0x9fc2b0[0x3],_0x7074cf[_0x24af6c][_0x3d26f2(0x176)]=_0x56e634,_0x7074cf[_0x24af6c][_0x3d26f2(0x1bb)]=_0x9fc2b0[0x5];}}}});}),_0x16f194[_0xf5cf9a(0xd6)]((_0x452db1,_0x961b5b)=>{var _0x37d08a=_0xf5cf9a;_0x7074cf[_0x961b5b][_0x37d08a(0x113)]=_0x452db1;}),_0xf0bca5[_0xf5cf9a(0xd6)]((_0x2777f1,_0x1b139b)=>{var _0x480627=_0xf5cf9a;_0x7074cf[_0x1b139b][_0x480627(0xe7)]=_0x2777f1;}),_0x480396[_0xf5cf9a(0xd6)]((_0xd2d6a9,_0x5cdef7)=>{var _0x24c52d=_0xf5cf9a;_0x7074cf[_0x5cdef7][_0x24c52d(0x186)]=_0xd2d6a9;}),_0x5cfa78[_0xf5cf9a(0xd6)]((_0x1445de,_0x238b3e)=>{var _0x3ad6a0=_0xf5cf9a;_0x7074cf[_0x238b3e][_0x3ad6a0(0xd4)]=_0x1445de;}),_0x1fdee3[_0xf5cf9a(0xd6)]((_0x531509,_0x163de5)=>{var _0x45f731=_0xf5cf9a;_0x7074cf[_0x163de5][_0x45f731(0x1cb)]=_0x531509;}),_0x4eed6d[_0xf5cf9a(0xd6)]((_0x77e425,_0x5b2bd3)=>{var _0x37b42e=_0xf5cf9a;_0x7074cf[_0x5b2bd3][_0x37b42e(0x1be)]=_0x77e425;}),_0x5ef081[_0xf5cf9a(0xd6)]((_0x37b63b,_0x5f32ef)=>{var _0x4560fb=_0xf5cf9a;_0x7074cf[_0x5f32ef][_0x4560fb(0x110)]=_0x37b63b;}),_0x580501[_0xf5cf9a(0xd6)]((_0x1f41a3,_0x3dcc2e)=>{var _0x103deb=_0xf5cf9a;_0x7074cf[_0x3dcc2e][_0x103deb(0xe4)]=_0x1f41a3;}),_0xf362ce[_0xf5cf9a(0xd6)]((_0xd35381,_0x31f5fa)=>{var _0x4814d5=_0xf5cf9a;_0x7074cf[_0x31f5fa][_0x4814d5(0x1db)]=_0xd35381;}),_0x331f60[_0xf5cf9a(0xd6)]((_0x4b5419,_0x3e23b2)=>{var _0x246a06=_0xf5cf9a;_0x7074cf[_0x3e23b2][_0x246a06(0x156)]=_0x4b5419;}),_0x3168c3[_0xf5cf9a(0xd6)]((_0x21863d,_0x769e80)=>{var _0x4ce229=_0xf5cf9a;_0x7074cf[_0x769e80][_0x4ce229(0x19b)]=_0x21863d;}),_0x2610b6[_0xf5cf9a(0xd6)]((_0x219d54,_0x22391c)=>{var _0x202d7d=_0xf5cf9a;_0x7074cf[_0x22391c][_0x202d7d(0x15d)]=_0x219d54;}),_0x25aff0[_0xf5cf9a(0xd6)]((_0x38a640,_0x1fd754)=>{var _0x58e87c=_0xf5cf9a;_0x7074cf[_0x1fd754][_0x58e87c(0x1c9)]=_0x38a640;});var _0x28059f=0x0;_0x7074cf[_0xf5cf9a(0xd6)](_0x92ee33=>{var _0x1c5e19=_0xf5cf9a;(_0x92ee33['stock']<_0x92ee33[_0x1c5e19(0x19b)]||_0x92ee33[_0x1c5e19(0x19b)]==0x0)&&(console[_0x1c5e19(0x193)]('foreach\x20newproduct',_0x92ee33),_0x28059f++);});const _0x14b03b=_0x7074cf[_0xf5cf9a(0x18e)](_0xf9c0db=>_0xf9c0db[_0xf5cf9a(0x1cc)]!=='0'&&_0xf9c0db[_0xf5cf9a(0x1cc)]!==''),_0x5df019=new sales({'invoice':_0x359f67,'customer':_0x47f948[_0xf5cf9a(0x190)]['customer'],'date':_0x54d0b1,'warehouse_name':_0x3cccb2,'sale_product':_0x14b03b,'note':_0x3ec40b,'room':_0x25d23e,'primary_code':_0xb98cdd,'secondary_code':_0x2d8895,'prod_code':_0x595095,'SCRN':_0x40e9f4}),_0x5263a8=await _0x5df019['save']();_0x47f948[_0xf5cf9a(0xf5)](_0xf5cf9a(0x18b),_0xf5cf9a(0x105)),_0x3656d2[_0xf5cf9a(0x1c6)](_0xf5cf9a(0x126)+_0x5263a8[_0xf5cf9a(0x17d)]);}catch(_0x427f9f){console[_0xf5cf9a(0x193)](_0x427f9f);}}),router[a0_0x591ade(0x175)](a0_0x591ade(0xec),auth,async(_0x46e977,_0x45238b)=>{var _0x89dad8=a0_0x591ade;try{const {username:_0x412ad6,email:_0x9a24e1,role:_0x2acb21}=_0x46e977[_0x89dad8(0x1ca)],_0x1a7bdc=_0x46e977[_0x89dad8(0x1ca)],_0x4764bb=await profile['findOne']({'email':_0x1a7bdc[_0x89dad8(0x15b)]}),_0x35e8ac=await master_shop[_0x89dad8(0x16f)](),_0x3ce984=_0x46e977[_0x89dad8(0x152)]['id'],_0x5336f5=await sales['findById'](_0x3ce984),_0x1d1001=await warehouse[_0x89dad8(0x187)]([{'$match':{'name':_0x5336f5['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x89dad8(0x183),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x89dad8(0x1b1)},'bay':{'$first':_0x89dad8(0x19d)},'bin':{'$first':_0x89dad8(0x1c8)},'type':{'$first':_0x89dad8(0xea)},'floorlevel':{'$first':_0x89dad8(0x12b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x89dad8(0x1d7)},'expiry_date':{'$first':_0x89dad8(0xd7)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x89dad8(0x195)}}}]),_0x2d9a49=await customer['find']({});let _0x5b376f;if(_0x1a7bdc[_0x89dad8(0x106)]=='staff'){const _0x3bc189=await staff['findOne']({'email':_0x1a7bdc[_0x89dad8(0x15b)]});_0x5b376f=await warehouse[_0x89dad8(0x187)]([{'$match':{'status':_0x89dad8(0x15a),'name':_0x3bc189['warehouse']}},{'$group':{'_id':_0x89dad8(0x1d6),'name':{'$first':'$name'}}}]);}else _0x5b376f=await warehouse[_0x89dad8(0x187)]([{'$match':{'status':_0x89dad8(0x15a)}},{'$group':{'_id':_0x89dad8(0x1d6),'name':{'$first':_0x89dad8(0x1d6)}}}]);const _0x496576=await product[_0x89dad8(0x16f)]({}),_0x705d5b=await suppliers[_0x89dad8(0x16f)]({});if(_0x35e8ac[0x0][_0x89dad8(0xcf)]==_0x89dad8(0x1d5)){var _0x479eef=users[_0x89dad8(0x14a)];console['log'](_0x479eef);}else{if(_0x35e8ac[0x0]['language']=='Hindi')var _0x479eef=users[_0x89dad8(0xce)];else{if(_0x35e8ac[0x0]['language']==_0x89dad8(0x1a5))var _0x479eef=users[_0x89dad8(0x1a5)];else{if(_0x35e8ac[0x0]['language']==_0x89dad8(0x12f))var _0x479eef=users[_0x89dad8(0x12f)];else{if(_0x35e8ac[0x0][_0x89dad8(0xcf)]==_0x89dad8(0x1b2))var _0x479eef=users[_0x89dad8(0x1b2)];else{if(_0x35e8ac[0x0][_0x89dad8(0xcf)]=='Portuguese\x20(BR)')var _0x479eef=users[_0x89dad8(0x117)];else{if(_0x35e8ac[0x0]['language']=='Chinese')var _0x479eef=users[_0x89dad8(0x177)];else{if(_0x35e8ac[0x0][_0x89dad8(0xcf)]=='Arabic\x20(ae)')var _0x479eef=users['Arabic'];}}}}}}}_0x45238b['render'](_0x89dad8(0x1b7),{'success':_0x46e977[_0x89dad8(0xf5)](_0x89dad8(0x18b)),'errors':_0x46e977[_0x89dad8(0xf5)](_0x89dad8(0x101)),'role':_0x1a7bdc,'profile':_0x4764bb,'customer':_0x2d9a49,'warehouse':_0x5b376f,'product':_0x1d1001,'user':_0x5336f5,'master_shop':_0x35e8ac,'unit':_0x496576,'language':_0x479eef,'suppliers':_0x705d5b});}catch(_0x2ca25d){console[_0x89dad8(0x193)](_0x2ca25d);}}),router[a0_0x591ade(0xfb)]('/preview/:id',auth,async(_0x26f61d,_0x177648)=>{var _0x5d8e9d=a0_0x591ade;try{const _0x41019d=_0x26f61d[_0x5d8e9d(0x152)]['id'],{invoice:_0x47ca9a,warehouse_name:_0x3e4e17,room:_0x5a0c95}=_0x26f61d[_0x5d8e9d(0x190)],_0x2c8e91=await sales[_0x5d8e9d(0x15f)]({'invoice':_0x47ca9a}),_0xcfaca=_0x2c8e91['sale_product']['map'](async _0x20b318=>{var _0x413977=_0x5d8e9d,_0x221ec1=await warehouse[_0x413977(0x15f)]({'name':_0x3e4e17,'room':_0x20b318[_0x413977(0x15d)],'warehouse_category':'Raw\x20Materials'});const _0x1e0a8f=_0x221ec1[_0x413977(0x1a8)]['map'](_0x344083=>{var _0x119e56=_0x413977;_0x344083[_0x119e56(0x179)]==_0x20b318['product_name']&&_0x344083[_0x119e56(0x1bb)]==_0x20b318[_0x119e56(0x1bb)]&&_0x344083['type']==_0x20b318['type']&&_0x344083[_0x119e56(0xe0)]==_0x20b318[_0x119e56(0xe0)]&&_0x344083['bay']==_0x20b318['bay']&&_0x344083[_0x119e56(0x159)]==_0x20b318[_0x119e56(0x159)]&&_0x344083['storage']==_0x20b318[_0x119e56(0x171)]&&_0x344083['expiry_date']==_0x20b318[_0x119e56(0xd4)]&&_0x344083[_0x119e56(0x186)]==_0x20b318[_0x119e56(0x186)]&&_0x344083[_0x119e56(0x1c9)]==_0x20b318[_0x119e56(0x1c9)]&&_0x344083[_0x119e56(0x17d)]==_0x20b318[_0x119e56(0x124)]&&(_0x344083[_0x119e56(0x1ac)]=Math[_0x119e56(0x1bf)](0x0,Math[_0x119e56(0x13a)](_0x344083[_0x119e56(0x1ac)])-Math[_0x119e56(0x13a)](_0x20b318[_0x119e56(0x1cc)])));});return _0x221ec1;});Promise[_0x5d8e9d(0xe1)](_0xcfaca)['then'](async _0x5b363a=>{var _0x3ccbd3=_0x5d8e9d;try{for(const _0x4247ee of _0x5b363a){await _0x4247ee['save']();}_0x2c8e91['finalize']=_0x3ccbd3(0xf2);const _0x55d97c=await _0x2c8e91[_0x3ccbd3(0xd9)](),_0x4b208d=await master_shop[_0x3ccbd3(0x16f)](),_0x5cb38b=await email_settings[_0x3ccbd3(0x15f)](),_0x33860a=await supervisor_settings[_0x3ccbd3(0x16f)]();var _0x14f507=_0x2c8e91[_0x3ccbd3(0x153)],_0x30229d='',_0x3699f6;for(_0x3699f6 in _0x14f507){_0x30229d+=_0x3ccbd3(0xd8)+_0x3ccbd3(0x11c)+_0x14f507[_0x3699f6][_0x3ccbd3(0x179)]+'</td>'+_0x3ccbd3(0x11c)+_0x14f507[_0x3699f6][_0x3ccbd3(0x12e)]+_0x3ccbd3(0xd5)+_0x3ccbd3(0x11c)+_0x14f507[_0x3699f6][_0x3ccbd3(0x1cc)]+_0x3ccbd3(0xd5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14f507[_0x3699f6]['unit']+_0x3ccbd3(0xd5)+_0x3ccbd3(0x11c)+_0x14f507[_0x3699f6]['secondary_unit']+_0x3ccbd3(0xd5)+_0x3ccbd3(0x11c)+_0x2c8e91['warehouse_name']+_0x3ccbd3(0xd5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14f507[_0x3699f6][_0x3ccbd3(0x15d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14f507[_0x3699f6][_0x3ccbd3(0x171)]+_0x14f507[_0x3699f6][_0x3ccbd3(0x159)]+_0x14f507[_0x3699f6][_0x3ccbd3(0x18a)]+_0x14f507[_0x3699f6][_0x3ccbd3(0xe0)]+_0x14f507[_0x3699f6][_0x3ccbd3(0x176)][0x0]+_0x14f507[_0x3699f6][_0x3ccbd3(0x1bb)]+_0x3ccbd3(0xd5),'</tr>';}let _0x4302e8=nodemailer['createTransport']({'host':_0x5cb38b[_0x3ccbd3(0x112)],'port':Number(_0x5cb38b[_0x3ccbd3(0xfc)]),'secure':![],'auth':{'user':_0x5cb38b[_0x3ccbd3(0x15b)],'pass':_0x5cb38b['password']}}),_0x40556d={'from':_0x5cb38b['email'],'to':_0x33860a[0x0][_0x3ccbd3(0x146)],'subject':_0x3ccbd3(0x151),'attachments':[{'filename':_0x3ccbd3(0x15e),'path':__dirname+_0x3ccbd3(0xdd)+_0x3ccbd3(0x166)+_0x4b208d[0x0][_0x3ccbd3(0x163)],'cid':'logo'}],'html':_0x3ccbd3(0x116)+_0x3ccbd3(0x138)+_0x3ccbd3(0xda)+_0x3ccbd3(0x1b3)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3ccbd3(0x1b3)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3ccbd3(0x1a3)+'<div>'+_0x3ccbd3(0x184)+_0x4b208d[0x0][_0x3ccbd3(0xe2)]+_0x3ccbd3(0x16a)+_0x3ccbd3(0x1a3)+_0x3ccbd3(0x1a3)+_0x3ccbd3(0x169)+_0x3ccbd3(0x1b3)+_0x3ccbd3(0x1d3)+'\x20Order\x20Number\x20:\x20'+_0x2c8e91['invoice']+'\x20'+_0x3ccbd3(0x135)+_0x3ccbd3(0xf4)+_0x2c8e91['date']+'\x20'+'</span>'+'</h5>'+_0x3ccbd3(0x1a3)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3ccbd3(0x1cf)+_0x3ccbd3(0xd8)+_0x3ccbd3(0xf1)+_0x3ccbd3(0x1c1)+_0x3ccbd3(0x1aa)+_0x3ccbd3(0x11f)+_0x3ccbd3(0x13f)+_0x3ccbd3(0x150)+_0x3ccbd3(0x1ae)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3ccbd3(0x104)+_0x3ccbd3(0x198)+_0x3ccbd3(0x1da)+'\x20'+_0x30229d+'\x20'+_0x3ccbd3(0x154)+'</table>'+_0x3ccbd3(0x1b3)+_0x3ccbd3(0x173)+_0x3ccbd3(0x13c)+_0x4b208d[0x0]['site_title']+_0x3ccbd3(0x1ad)+'</div>'+_0x3ccbd3(0x1a3)+'</body></html>'};_0x4302e8['sendMail'](_0x40556d,function(_0x240383,_0x3bd454){var _0x3baa47=_0x3ccbd3;_0x240383?(console[_0x3baa47(0x193)](_0x240383),console[_0x3baa47(0x193)]('Error\x20Occurs')):console[_0x3baa47(0x193)]('Email\x20sent\x20successfully');}),_0x26f61d['flash'](_0x3ccbd3(0x18b),'Sales\x20Update\x20successfully'),_0x177648['redirect'](_0x3ccbd3(0x126)+_0x41019d);}catch(_0x23f1ac){console['error'](_0x23f1ac),_0x177648[_0x3ccbd3(0xf0)](0x1f4)[_0x3ccbd3(0x12c)]({'error':_0x3ccbd3(0x165)});}})['catch'](_0x3cef85=>{var _0x55d507=_0x5d8e9d;console[_0x55d507(0x16b)](_0x3cef85),_0x177648[_0x55d507(0xf0)](0x1f4)[_0x55d507(0x12c)]({'error':'An\x20error\x20occurred.'});});}catch(_0x5773f0){console['log'](_0x5773f0);}}),router[a0_0x591ade(0x175)]('/view/:id',auth,async(_0x33e0f0,_0x1a75bf)=>{var _0x208b23=a0_0x591ade;try{const {username:_0x9891fa,email:_0xf4fb0,role:_0x4488de}=_0x33e0f0[_0x208b23(0x1ca)],_0x11ea66=_0x33e0f0[_0x208b23(0x1ca)],_0x4db9d1=await profile[_0x208b23(0x15f)]({'email':_0x11ea66[_0x208b23(0x15b)]}),_0x2522d0=await master_shop[_0x208b23(0x16f)](),_0x4c044e=_0x33e0f0[_0x208b23(0x152)]['id'],_0x200c46=await sales[_0x208b23(0x160)](_0x4c044e);var _0x562711=[_0x208b23(0x1ba),_0x208b23(0x139)];const _0x398c40=await warehouse[_0x208b23(0x187)]([{'$match':{'name':_0x200c46[_0x208b23(0x1c2)],'warehouse_category':_0x208b23(0x197)}},{'$unwind':_0x208b23(0x109)},{'$group':{'_id':_0x208b23(0x183),'name':{'$first':_0x208b23(0x1d0)},'product_stock':{'$first':_0x208b23(0x1b1)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x208b23(0x1c8)},'type':{'$first':_0x208b23(0xea)},'floorlevel':{'$first':_0x208b23(0x12b)},'primary_code':{'$first':_0x208b23(0xee)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x208b23(0x178)},'storage':{'$first':_0x208b23(0x102)},'rack':{'$first':_0x208b23(0x1d7)}}}]),_0x1928fe=await customer[_0x208b23(0x16f)]({});let _0x518437;if(_0x11ea66[_0x208b23(0x106)]==_0x208b23(0xe3)){const _0x508bad=await staff[_0x208b23(0x15f)]({'email':_0x11ea66[_0x208b23(0x15b)]});_0x518437=await warehouse['aggregate']([{'$match':{'status':_0x208b23(0x15a),'name':_0x508bad[_0x208b23(0x10c)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x208b23(0x1d6),'name':{'$first':'$name'}}}]);}else _0x518437=await warehouse[_0x208b23(0x187)]([{'$match':{'status':'Enabled','warehouse_category':_0x208b23(0x197)}},{'$group':{'_id':_0x208b23(0x1d6),'name':{'$first':_0x208b23(0x1d6)}}}]);const _0x2b24ce=await product[_0x208b23(0x16f)]({});if(_0x2522d0[0x0][_0x208b23(0xcf)]=='English\x20(US)'){var _0x3ab5f1=users['English'];console[_0x208b23(0x193)](_0x3ab5f1);}else{if(_0x2522d0[0x0]['language']==_0x208b23(0xce))var _0x3ab5f1=users[_0x208b23(0xce)];else{if(_0x2522d0[0x0][_0x208b23(0xcf)]==_0x208b23(0x1a5))var _0x3ab5f1=users['German'];else{if(_0x2522d0[0x0][_0x208b23(0xcf)]=='Spanish')var _0x3ab5f1=users[_0x208b23(0x12f)];else{if(_0x2522d0[0x0][_0x208b23(0xcf)]=='French')var _0x3ab5f1=users[_0x208b23(0x1b2)];else{if(_0x2522d0[0x0]['language']=='Portuguese\x20(BR)')var _0x3ab5f1=users['Portuguese'];else{if(_0x2522d0[0x0][_0x208b23(0xcf)]=='Chinese')var _0x3ab5f1=users['Chinese'];else{if(_0x2522d0[0x0][_0x208b23(0xcf)]==_0x208b23(0x185))var _0x3ab5f1=users[_0x208b23(0xfe)];}}}}}}}_0x1a75bf[_0x208b23(0x1b0)](_0x208b23(0x144),{'success':_0x33e0f0[_0x208b23(0xf5)]('success'),'errors':_0x33e0f0['flash'](_0x208b23(0x101)),'role':_0x11ea66,'profile':_0x4db9d1,'customer':_0x1928fe,'warehouse':_0x518437,'product':_0x398c40,'user':_0x200c46,'master_shop':_0x2522d0,'unit':_0x2b24ce,'language':_0x3ab5f1});}catch(_0x169bc8){console['log'](_0x169bc8);}}),router[a0_0x591ade(0xfb)]('/view/:id',auth,async(_0x1d19ba,_0x299559)=>{var _0x1dbc8c=a0_0x591ade;try{const _0x2caf36=_0x1d19ba[_0x1dbc8c(0x152)]['id'],_0x165250=await sales[_0x1dbc8c(0x15f)]({'_id':_0x1d19ba[_0x1dbc8c(0x152)]['id']}),_0x8990fb=await warehouse[_0x1dbc8c(0x15f)]({'name':_0x165250[_0x1dbc8c(0x1c2)],'room':_0x1d19ba[_0x1dbc8c(0x190)]['room']}),{invoice:_0xe3ca25,date:_0x51dfab,warehouse_name:_0x243d0b,product_name:_0x32b182,stock:_0x15b7f3,quantity:_0x555c10,note:_0x263b29,room:_0x2e8ad6,customer:_0x553e9a,SCRN:_0x2abcce}=_0x1d19ba[_0x1dbc8c(0x190)];if(typeof _0x32b182==_0x1dbc8c(0x121))var _0x341729=[_0x1d19ba[_0x1dbc8c(0x190)]['product_name']],_0x10d387=[_0x1d19ba[_0x1dbc8c(0x190)]['stock']],_0x279658=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xef)]],_0x4df26c=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1a9)]],_0x3c2403=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1c5)]],_0xe0bf63=[_0x1d19ba['body'][_0x1dbc8c(0x148)]],_0x156c9b=[_0x1d19ba['body'][_0x1dbc8c(0x157)]],_0x1334fb=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xd1)]],_0x203680=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xe7)]],_0x46da5a=[_0x1d19ba[_0x1dbc8c(0x190)]['batch_code']],_0x365409=[_0x1d19ba['body'][_0x1dbc8c(0xd4)]],_0x1047b0=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1c3)]],_0x26add2=[_0x1d19ba['body'][_0x1dbc8c(0x1be)]],_0x33cc4a=[_0x1d19ba['body']['requested_qty']],_0x843199=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xe4)]],_0xf1a899=[_0x1d19ba[_0x1dbc8c(0x190)]['delivery_code']],_0x40ec88=[_0x1d19ba['body'][_0x1dbc8c(0x156)]],_0x3f6da1=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1cc)]],_0x52282c=[_0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1c4)]];else var _0x341729=[..._0x1d19ba['body']['product_name']],_0x10d387=[..._0x1d19ba[_0x1dbc8c(0x190)]['stock']],_0x279658=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xef)]],_0x4df26c=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1a9)]],_0x3c2403=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1c5)]],_0xe0bf63=[..._0x1d19ba[_0x1dbc8c(0x190)]['prod_code']],_0x156c9b=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x157)]],_0x1334fb=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xd1)]],_0x203680=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xe7)]],_0x46da5a=[..._0x1d19ba[_0x1dbc8c(0x190)]['batch_code']],_0x365409=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0xd4)]],_0x1047b0=[..._0x1d19ba['body'][_0x1dbc8c(0x1c3)]],_0x26add2=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1be)]],_0x33cc4a=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x110)]],_0x843199=[..._0x1d19ba['body'][_0x1dbc8c(0xe4)]],_0xf1a899=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x1db)]],_0x40ec88=[..._0x1d19ba[_0x1dbc8c(0x190)][_0x1dbc8c(0x156)]],_0x3f6da1=[..._0x1d19ba[_0x1dbc8c(0x190)]['quantity']],_0x52282c=[..._0x1d19ba[_0x1dbc8c(0x190)]['RoomAssigned']];const _0x2c2919=_0x341729[_0x1dbc8c(0x1d1)](_0x5fcb39=>{return _0x5fcb39={'product_name':_0x5fcb39};});_0x10d387[_0x1dbc8c(0xd6)]((_0x72f453,_0x137082)=>{var _0x13a8bb=_0x1dbc8c;_0x2c2919[_0x137082][_0x13a8bb(0x170)]=Math[_0x13a8bb(0x13a)](_0x72f453);}),_0x279658[_0x1dbc8c(0xd6)]((_0x4d8a9d,_0x5cd3d5)=>{_0x2c2919[_0x5cd3d5]['quantity']=_0x4d8a9d;}),_0x4df26c[_0x1dbc8c(0xd6)]((_0x100270,_0x112201)=>{_0x2c2919[_0x112201]['primary_code']=_0x100270;}),_0x3c2403[_0x1dbc8c(0xd6)]((_0x2ed7c6,_0x249936)=>{var _0x225aa5=_0x1dbc8c;_0x2c2919[_0x249936][_0x225aa5(0x1c5)]=_0x2ed7c6;}),_0xe0bf63['forEach']((_0x3a8e73,_0x2aaeca)=>{var _0x4bbc15=_0x1dbc8c;_0x2c2919[_0x2aaeca][_0x4bbc15(0x12e)]=_0x3a8e73;}),_0x156c9b[_0x1dbc8c(0xd6)]((_0x1710a6,_0x543eeb)=>{_0x52282c['forEach']((_0x4c9899,_0x4b647a)=>{var _0x1bec5e=a0_0x3736;if(_0x4c9899==_0x1bec5e(0x111)&&_0x543eeb==_0x4b647a){var _0x2840dc=_0x1710a6['slice'](0x3);_0x2c2919[_0x543eeb][_0x1bec5e(0x171)]=_0x1710a6[0x0],_0x2c2919[_0x543eeb]['rack']=_0x1710a6[0x1],_0x2c2919[_0x543eeb][_0x1bec5e(0x18a)]=0x0,_0x2c2919[_0x543eeb]['bin']=0x0,_0x2c2919[_0x543eeb]['type']=_0x1bec5e(0x19e),_0x2c2919[_0x543eeb][_0x1bec5e(0x1bb)]=_0x2840dc;}else{if(_0x4c9899==_0x1bec5e(0xe5)&&_0x543eeb==_0x4b647a){var _0x2840dc=_0x1710a6['slice'](0x3);_0x2c2919[_0x543eeb]['storage']=_0x1710a6[0x0],_0x2c2919[_0x543eeb][_0x1bec5e(0x159)]=_0x1710a6[0x1],_0x2c2919[_0x543eeb][_0x1bec5e(0x18a)]=0x0,_0x2c2919[_0x543eeb][_0x1bec5e(0xe0)]=0x0,_0x2c2919[_0x543eeb][_0x1bec5e(0x176)]=_0x1bec5e(0x19e),_0x2c2919[_0x543eeb]['floorlevel']=_0x1710a6[0x5];}else{if(_0x543eeb==_0x4b647a){var _0x4a614d;if(_0x1710a6[0x4]=='L')_0x4a614d=_0x1bec5e(0x1b5);else _0x1710a6[0x4]=='F'&&(_0x4a614d='Floor');_0x2c2919[_0x543eeb][_0x1bec5e(0x171)]=_0x1710a6[0x0],_0x2c2919[_0x543eeb][_0x1bec5e(0x159)]=_0x1710a6[0x1],_0x2c2919[_0x543eeb]['bay']=_0x1710a6[0x2],_0x2c2919[_0x543eeb]['bin']=_0x1710a6[0x3],_0x2c2919[_0x543eeb][_0x1bec5e(0x176)]=_0x4a614d,_0x2c2919[_0x543eeb]['floorlevel']=_0x1710a6[0x5];}}}});}),_0x1334fb['forEach']((_0x2767cf,_0x3cf72f)=>{_0x2c2919[_0x3cf72f]['unit']=_0x2767cf;}),_0x203680[_0x1dbc8c(0xd6)]((_0x4d4a3f,_0x3d3413)=>{_0x2c2919[_0x3d3413]['secondary_unit']=_0x4d4a3f;}),_0x46da5a[_0x1dbc8c(0xd6)]((_0x4d8d8c,_0x560987)=>{var _0xd2c747=_0x1dbc8c;_0x2c2919[_0x560987][_0xd2c747(0x186)]=_0x4d8d8c;}),_0x365409[_0x1dbc8c(0xd6)]((_0x51935e,_0x20e6b1)=>{var _0x36a9b8=_0x1dbc8c;_0x2c2919[_0x20e6b1][_0x36a9b8(0xd4)]=_0x51935e;}),_0x1047b0[_0x1dbc8c(0xd6)]((_0x1c276f,_0x280e2a)=>{var _0x1ddf3b=_0x1dbc8c;_0x2c2919[_0x280e2a][_0x1ddf3b(0x1cb)]=_0x1c276f;}),_0x26add2[_0x1dbc8c(0xd6)]((_0x1ee021,_0x528727)=>{var _0xa4d93d=_0x1dbc8c;_0x2c2919[_0x528727][_0xa4d93d(0x1be)]=_0x1ee021;}),_0x33cc4a[_0x1dbc8c(0xd6)]((_0x8e122a,_0x3d79e1)=>{var _0x48efb6=_0x1dbc8c;_0x2c2919[_0x3d79e1][_0x48efb6(0x110)]=Math[_0x48efb6(0x13a)](_0x8e122a);}),_0x843199[_0x1dbc8c(0xd6)]((_0x1a53bf,_0x5ac090)=>{var _0x381bd9=_0x1dbc8c;_0x2c2919[_0x5ac090][_0x381bd9(0xe4)]=_0x1a53bf;}),_0xf1a899[_0x1dbc8c(0xd6)]((_0x3ea507,_0x1f3f8f)=>{var _0x29a3a0=_0x1dbc8c;_0x2c2919[_0x1f3f8f][_0x29a3a0(0x1db)]=_0x3ea507;}),_0x40ec88[_0x1dbc8c(0xd6)]((_0xc649e6,_0x58fa7f)=>{_0x2c2919[_0x58fa7f]['prod_cat']=_0xc649e6;}),_0x3f6da1[_0x1dbc8c(0xd6)]((_0x40fa1a,_0x552ed8)=>{var _0x567e73=_0x1dbc8c;_0x2c2919[_0x552ed8][_0x567e73(0x19b)]=_0x40fa1a;}),_0x52282c[_0x1dbc8c(0xd6)]((_0x1b7b8b,_0x5dbd2a)=>{var _0xa7252=_0x1dbc8c;_0x2c2919[_0x5dbd2a][_0xa7252(0x15d)]=_0x1b7b8b;});var _0x2b4fb5=0x0;_0x2c2919['forEach'](_0x2746e4=>{var _0x319115=_0x1dbc8c;console[_0x319115(0x193)](_0x319115(0x120),_0x2746e4),(parseInt(_0x2746e4[_0x319115(0x170)])<parseInt(_0x2746e4[_0x319115(0x1cc)])||parseInt(_0x2746e4['quantity'])==0x0)&&_0x2b4fb5++;});if(_0x2b4fb5!=0x0)return _0x1d19ba[_0x1dbc8c(0xf5)](_0x1dbc8c(0x101),_0x1dbc8c(0x194)),_0x299559['redirect'](_0x1dbc8c(0x11d));const _0x1b4c2e=_0x2c2919[_0x1dbc8c(0x18e)](_0x16a23d=>_0x16a23d[_0x1dbc8c(0x1cc)]!=='0'&&_0x16a23d[_0x1dbc8c(0x1cc)]!=='');_0x165250[_0x1dbc8c(0x1c9)]=_0xe3ca25,_0x165250['customer']=_0x553e9a,_0x165250[_0x1dbc8c(0x1a6)]=_0x51dfab,_0x165250[_0x1dbc8c(0x1c2)]=_0x243d0b,_0x165250[_0x1dbc8c(0x153)]=_0x1b4c2e,_0x165250[_0x1dbc8c(0x10d)]=_0x263b29,_0x165250[_0x1dbc8c(0x1d4)]=_0x2abcce,_0x165250[_0x1dbc8c(0xf8)]=_0x1dbc8c(0x147),_0x165250[_0x1dbc8c(0xe9)]=_0x1dbc8c(0x147);const _0xa96f8c=await _0x165250[_0x1dbc8c(0xd9)]();_0x1d19ba[_0x1dbc8c(0xf5)](_0x1dbc8c(0x18b),_0x1dbc8c(0x14c)),_0x299559[_0x1dbc8c(0x1c6)](_0x1dbc8c(0x164));}catch(_0x5be151){console['log'](_0x5be151);}}),router[a0_0x591ade(0xfb)]('/give_payment/:id',auth,async(_0x5ee2fc,_0x2f659e)=>{var _0x55250e=a0_0x591ade;try{const _0xdeb569=_0x5ee2fc[_0x55250e(0x152)]['id'],{invoice:_0x54f2cd,customer:_0xf70e08,receivable_amount:_0x4afd58,received_amount:_0xe5283a}=_0x5ee2fc[_0x55250e(0x190)],_0x42203f=await sales['findById'](_0xdeb569);console[_0x55250e(0x193)](_0x42203f);var _0x346613=_0x4afd58-_0xe5283a;console['log'](_0xe5283a),_0x42203f[_0x55250e(0x142)]=parseFloat(_0xe5283a)+parseFloat(_0x42203f[_0x55250e(0x142)]),_0x42203f[_0x55250e(0x145)]=_0x346613,console['log'](_0x42203f);const _0x56b303=await _0x42203f['save'](),_0x17ac93=await c_payment_data[_0x55250e(0x15f)]({'invoice':_0x54f2cd});_0x17ac93['amount']=_0x346613,await _0x17ac93['save']();let _0x49eeaa=new Date(),_0x3d9614=('0'+_0x49eeaa[_0x55250e(0xdb)]())[_0x55250e(0x192)](-0x2),_0x25047a=('0'+(_0x49eeaa['getMonth']()+0x1))['slice'](-0x2),_0x325049=_0x49eeaa[_0x55250e(0xed)](),_0x1a7ae1=_0x325049+'-'+_0x25047a+'-'+_0x3d9614;const _0x2bdcba=new customer_payment({'invoice':_0x54f2cd,'date':_0x325049+'-'+_0x25047a+'-'+_0x3d9614,'customer':_0xf70e08,'reason':'Received\x20Payment\x20For\x20Sale','amount':_0xe5283a}),_0x59cf07=await _0x2bdcba[_0x55250e(0xd9)]();_0x5ee2fc[_0x55250e(0xf5)](_0x55250e(0x18b),_0x55250e(0x1a0)),_0x2f659e[_0x55250e(0x1c6)]('/all_sales/view');}catch(_0x4bcdab){console[_0x55250e(0x193)](_0x4bcdab);}}),router['get'](a0_0x591ade(0x127),auth,async(_0x5d15ea,_0x199035)=>{var _0x246c3c=a0_0x591ade;try{const {username:_0x526b7a,email:_0x2d2c3f,role:_0x3c08ba}=_0x5d15ea[_0x246c3c(0x1ca)],_0x568e51=_0x5d15ea[_0x246c3c(0x1ca)],_0x390dcb=await profile[_0x246c3c(0x15f)]({'email':_0x568e51[_0x246c3c(0x15b)]}),_0x4c3b74=await master_shop[_0x246c3c(0x16f)]();console[_0x246c3c(0x193)](_0x246c3c(0x11e),_0x4c3b74);const _0x334076=_0x5d15ea[_0x246c3c(0x152)]['id'],_0x4b3e40=await sales[_0x246c3c(0x160)](_0x334076);console[_0x246c3c(0x193)](_0x4b3e40);const _0x24fe05=await customer[_0x246c3c(0x15f)]({'name':_0x4b3e40['customer']});console[_0x246c3c(0x193)](_0x24fe05);if(_0x4c3b74[0x0]['language']==_0x246c3c(0x1d5)){var _0xfb6b03=users['English'];console[_0x246c3c(0x193)](_0xfb6b03);}else{if(_0x4c3b74[0x0][_0x246c3c(0xcf)]=='Hindi')var _0xfb6b03=users[_0x246c3c(0xce)];else{if(_0x4c3b74[0x0][_0x246c3c(0xcf)]=='German')var _0xfb6b03=users[_0x246c3c(0x1a5)];else{if(_0x4c3b74[0x0][_0x246c3c(0xcf)]=='Spanish')var _0xfb6b03=users[_0x246c3c(0x12f)];else{if(_0x4c3b74[0x0][_0x246c3c(0xcf)]==_0x246c3c(0x1b2))var _0xfb6b03=users[_0x246c3c(0x1b2)];else{if(_0x4c3b74[0x0][_0x246c3c(0xcf)]=='Portuguese\x20(BR)')var _0xfb6b03=users[_0x246c3c(0x117)];else{if(_0x4c3b74[0x0]['language']=='Chinese')var _0xfb6b03=users[_0x246c3c(0x177)];else{if(_0x4c3b74[0x0][_0x246c3c(0xcf)]==_0x246c3c(0x185))var _0xfb6b03=users['Arabic'];}}}}}}}_0x199035[_0x246c3c(0x1b0)](_0x246c3c(0x17f),{'success':_0x5d15ea[_0x246c3c(0xf5)](_0x246c3c(0x18b)),'errors':_0x5d15ea[_0x246c3c(0xf5)](_0x246c3c(0x101)),'role':_0x568e51,'profile':_0x390dcb,'master_shop':_0x4c3b74,'customers':_0x24fe05,'sales':_0x4b3e40,'language':_0xfb6b03});}catch(_0x492678){console[_0x246c3c(0x193)](_0x492678);}}),router['get'](a0_0x591ade(0x1b8),auth,async(_0x35a056,_0x3b16d8)=>{var _0x30f4e2=a0_0x591ade;try{const {username:_0x40c1e3,email:_0x31136f,role:_0x7afe23}=_0x35a056['user'],_0x29c020=_0x35a056[_0x30f4e2(0x1ca)],_0x283767=await profile[_0x30f4e2(0x15f)]({'email':_0x29c020[_0x30f4e2(0x15b)]}),_0x2e4a32=await master_shop[_0x30f4e2(0x16f)]();console[_0x30f4e2(0x193)](_0x30f4e2(0x11e),_0x2e4a32);const _0x245d40=_0x35a056[_0x30f4e2(0x152)]['id'];console[_0x30f4e2(0x193)](_0x245d40);const _0x3fe019=await sales[_0x30f4e2(0x160)](_0x245d40);console[_0x30f4e2(0x193)](_0x30f4e2(0x12d),_0x3fe019);const _0x24f8fa=await warehouse['aggregate']([{'$match':{'name':_0x30f4e2(0x134),'room':'Return\x20Rooms'}},{'$unwind':_0x30f4e2(0x109)},{'$group':{'_id':_0x30f4e2(0x183),'name':{'$first':_0x30f4e2(0x1d0)},'product_stock':{'$first':_0x30f4e2(0x1b1)},'level':{'$first':_0x30f4e2(0x1b9)},'isle':{'$first':_0x30f4e2(0x1cd)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x30f4e2(0xee)},'secondary_code':{'$first':_0x30f4e2(0x17e)},'product_code':{'$first':_0x30f4e2(0x178)}}}]);console[_0x30f4e2(0x193)]('stock_data',_0x24f8fa);const _0x180372=await product[_0x30f4e2(0x16f)]({});warehouse_data=await warehouse[_0x30f4e2(0x187)]([{'$match':{'status':_0x30f4e2(0x15a),'name':_0x30f4e2(0x134),'warehouse_category':_0x30f4e2(0x197)}},{'$group':{'_id':_0x30f4e2(0x1d6),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);var _0x308133=['Return\x20Rooms'];if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]==_0x30f4e2(0x1d5)){var _0x2d3f1f=users['English'];console['log'](_0x2d3f1f);}else{if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]==_0x30f4e2(0xce))var _0x2d3f1f=users['Hindi'];else{if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]==_0x30f4e2(0x1a5))var _0x2d3f1f=users[_0x30f4e2(0x1a5)];else{if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]==_0x30f4e2(0x12f))var _0x2d3f1f=users['Spanish'];else{if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]=='French')var _0x2d3f1f=users['French'];else{if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]=='Portuguese\x20(BR)')var _0x2d3f1f=users[_0x30f4e2(0x117)];else{if(_0x2e4a32[0x0]['language']==_0x30f4e2(0x177))var _0x2d3f1f=users[_0x30f4e2(0x177)];else{if(_0x2e4a32[0x0][_0x30f4e2(0xcf)]==_0x30f4e2(0x185))var _0x2d3f1f=users[_0x30f4e2(0xfe)];}}}}}}}_0x3b16d8['render'](_0x30f4e2(0xde),{'success':_0x35a056[_0x30f4e2(0xf5)]('success'),'errors':_0x35a056[_0x30f4e2(0xf5)](_0x30f4e2(0x101)),'role':_0x29c020,'profile':_0x283767,'user':_0x3fe019,'stock':_0x24f8fa,'master_shop':_0x2e4a32,'unit':_0x180372,'language':_0x2d3f1f,'warehouses':warehouse_data,'rooms':_0x308133});}catch(_0x5e8776){console['log'](_0x5e8776),_0x3b16d8[_0x30f4e2(0xf0)](0xc8)[_0x30f4e2(0x12c)]({'message':_0x5e8776[_0x30f4e2(0x196)]});}}),router[a0_0x591ade(0xfb)](a0_0x591ade(0x1b8),auth,async(_0x221514,_0x574d88)=>{var _0x370eaf=a0_0x591ade;try{const {invoice:_0x2e4775,date:_0x155fbb,warehouse_name:_0x12a758,product_name:_0x496b23,primary_code:_0x426d4a,secondary_code:_0x37febd,product_code:_0x8be137,sales_quantity:_0x7f92c6,stocks:_0x105241,return_qty:_0x2bef60,Room_name:_0x2da37c,to_warehouse_name:_0x1cfbaa,to_Roomname:_0x2d524c,to_Room_name:_0x5bbaee,note:_0x387b5b,level:_0x59adf3,isle:_0xe443b6,pallet:_0x343e96}=_0x221514['body'];if(typeof _0x496b23==_0x370eaf(0x121))var _0x3a81e6=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x179)]],_0x1da3d2=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x1a9)]],_0x1932a3=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x1c5)]],_0x5dd5d8=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x12e)]],_0x1ec406=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x182)]],_0x28facc=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x188)]],_0x392abb=[_0x221514[_0x370eaf(0x190)]['return_qty']],_0x5598ce=[_0x221514[_0x370eaf(0x190)]['bay']],_0x5c094e=[_0x221514['body'][_0x370eaf(0xe0)]],_0x1fbd40=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x1d2)]],_0xe6cded=[_0x221514[_0x370eaf(0x190)][_0x370eaf(0x1bb)]];else var _0x3a81e6=[..._0x221514['body'][_0x370eaf(0x179)]],_0x1da3d2=[..._0x221514[_0x370eaf(0x190)][_0x370eaf(0x1a9)]],_0x1932a3=[..._0x221514[_0x370eaf(0x190)]['secondary_code']],_0x5dd5d8=[..._0x221514[_0x370eaf(0x190)][_0x370eaf(0x12e)]],_0x1ec406=[..._0x221514[_0x370eaf(0x190)][_0x370eaf(0x182)]],_0x28facc=[..._0x221514[_0x370eaf(0x190)][_0x370eaf(0x188)]],_0x392abb=[..._0x221514[_0x370eaf(0x190)]['return_qty']],_0x5598ce=[..._0x221514[_0x370eaf(0x190)][_0x370eaf(0x18a)]],_0x5c094e=[..._0x221514[_0x370eaf(0x190)][_0x370eaf(0xe0)]],_0x1fbd40=[..._0x221514[_0x370eaf(0x190)]['types']],_0xe6cded=[..._0x221514[_0x370eaf(0x190)]['floorlevel']];const _0x16a9d6=_0x3a81e6['map'](_0x43a418=>{return _0x43a418={'product_name':_0x43a418};});_0x1da3d2[_0x370eaf(0xd6)]((_0x31c3ac,_0x7073ae)=>{var _0x5c1ee3=_0x370eaf;_0x16a9d6[_0x7073ae][_0x5c1ee3(0x1a9)]=_0x31c3ac;}),_0x1932a3[_0x370eaf(0xd6)]((_0xfbf97f,_0x56b9a5)=>{var _0x297529=_0x370eaf;_0x16a9d6[_0x56b9a5][_0x297529(0x1c5)]=_0xfbf97f;}),_0x5dd5d8[_0x370eaf(0xd6)]((_0x4f7e5d,_0x5d5aea)=>{_0x16a9d6[_0x5d5aea]['product_code']=_0x4f7e5d;}),_0x1ec406[_0x370eaf(0xd6)]((_0x420722,_0x25d7f6)=>{var _0x47d09d=_0x370eaf;_0x16a9d6[_0x25d7f6][_0x47d09d(0x19a)]=_0x420722;}),_0x28facc[_0x370eaf(0xd6)]((_0x3bdf1b,_0x236f9c)=>{var _0x17a8dd=_0x370eaf;_0x16a9d6[_0x236f9c][_0x17a8dd(0x170)]=_0x3bdf1b;}),_0x392abb[_0x370eaf(0xd6)]((_0x40e62a,_0x284448)=>{_0x16a9d6[_0x284448]['return_qty']=_0x40e62a;}),_0x5598ce['forEach']((_0x5d3568,_0x110c68)=>{var _0x251057=_0x370eaf;_0x16a9d6[_0x110c68][_0x251057(0x18a)]=_0x5d3568;}),_0x5c094e[_0x370eaf(0xd6)]((_0x330640,_0xcba347)=>{var _0x49a7b4=_0x370eaf;_0x16a9d6[_0xcba347][_0x49a7b4(0xe0)]=_0x330640;}),_0x1fbd40[_0x370eaf(0xd6)]((_0x34a682,_0x472c8d)=>{var _0x2150db=_0x370eaf;_0x16a9d6[_0x472c8d][_0x2150db(0x176)]=_0x34a682;}),_0xe6cded[_0x370eaf(0xd6)]((_0x4700bd,_0x59167f)=>{var _0x164cb7=_0x370eaf;_0x16a9d6[_0x59167f][_0x164cb7(0x1bb)]=_0x4700bd;});var _0x59a953=0x0;_0x16a9d6['forEach'](_0x48731e=>{var _0x1d6a7c=_0x370eaf;console[_0x1d6a7c(0x193)](_0x1d6a7c(0x120),_0x48731e),(parseInt(_0x48731e['sale_qty'])<parseInt(_0x48731e[_0x1d6a7c(0x14e)])||parseInt(_0x48731e[_0x1d6a7c(0x170)])<parseInt(_0x48731e[_0x1d6a7c(0x14e)])&&parseInt(_0x48731e[_0x1d6a7c(0x19a)])>parseInt(_0x48731e[_0x1d6a7c(0x14e)])||parseInt(_0x48731e[_0x1d6a7c(0x14e)])==0x0)&&_0x59a953++;});if(_0x59a953!=0x0)return _0x221514[_0x370eaf(0xf5)](_0x370eaf(0x101),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x574d88[_0x370eaf(0x1c6)](_0x370eaf(0x11d));const _0x259833=await sales[_0x370eaf(0x15f)]({'invoice':_0x2e4775});console['log'](_0x259833),_0x259833[_0x370eaf(0x15c)]=_0x370eaf(0xf2);const _0x4362ea=await _0x259833['save'](),_0x342cd4=new sales_return({'invoice':_0x2e4775,'customer':_0x221514[_0x370eaf(0x190)]['customer'],'date':_0x155fbb,'warehouse_name':_0x12a758,'room':_0x2da37c,'ToWarehouse':_0x1cfbaa,'ToRoom':_0x5bbaee,'return_sale':_0x16a9d6,'note':_0x387b5b}),_0xe80cbf=await _0x342cd4[_0x370eaf(0xd9)]();console[_0x370eaf(0x193)](_0x342cd4);const _0x260384=await sales_return['findOne']({'invoice':_0x2e4775}),_0x13fdef=await warehouse[_0x370eaf(0x15f)]({'name':_0x1cfbaa,'room':_0x5bbaee});_0x260384[_0x370eaf(0xde)]['forEach'](_0x49d6e3=>{var _0x3e546b=_0x370eaf,_0xa8fa09=0x0;const _0x54cf04=_0x13fdef['product_details'][_0x3e546b(0x1d1)](_0x48cbdb=>{var _0x4a15b9=_0x3e546b;_0x48cbdb[_0x4a15b9(0x179)]==_0x49d6e3['product_name']&&_0x48cbdb['floorlevel']==_0x49d6e3['floorlevel']&&_0x48cbdb[_0x4a15b9(0x176)]==_0x49d6e3[_0x4a15b9(0x176)]&&_0x48cbdb[_0x4a15b9(0xe0)]==_0x49d6e3[_0x4a15b9(0xe0)]&&_0x48cbdb[_0x4a15b9(0x18a)]==_0x49d6e3[_0x4a15b9(0x18a)]&&(_0x48cbdb[_0x4a15b9(0x1ac)]=parseInt(_0x48cbdb[_0x4a15b9(0x1ac)])+parseInt(_0x49d6e3['return_qty']),_0xa8fa09++);});_0xa8fa09=='0'&&(_0x13fdef['product_details']=_0x13fdef[_0x3e546b(0x1a8)][_0x3e546b(0x161)]({'product_name':_0x49d6e3[_0x3e546b(0x179)],'product_stock':_0x49d6e3['return_qty'],'primary_code':_0x49d6e3[_0x3e546b(0x1a9)],'secondary_code':_0x49d6e3[_0x3e546b(0x1c5)],'product_code':_0x49d6e3[_0x3e546b(0x12e)],'bay':_0x49d6e3[_0x3e546b(0x18a)],'bin':_0x49d6e3[_0x3e546b(0xe0)],'type':_0x49d6e3[_0x3e546b(0x176)],'floorlevel':_0x49d6e3[_0x3e546b(0x1bb)]})),console[_0x3e546b(0x193)](_0x3e546b(0x125),_0x13fdef);}),await _0x13fdef[_0x370eaf(0xd9)](),console[_0x370eaf(0x193)](_0x221514['body']);const _0xf27cea=new c_payment_data({'invoice':_0x2e4775,'customer':_0x221514[_0x370eaf(0x190)][_0x370eaf(0xfa)],'reason':_0x370eaf(0xdc)});await _0xf27cea[_0x370eaf(0xd9)]();const _0x343763=await master_shop[_0x370eaf(0x16f)]();console[_0x370eaf(0x193)]('add\x20post',_0x343763[0x0][_0x370eaf(0x163)]);const _0x47ebbd=await email_settings[_0x370eaf(0x15f)](),_0x368d76=await customer[_0x370eaf(0x15f)]({'name':_0x221514[_0x370eaf(0x190)][_0x370eaf(0xfa)]});console['log'](_0x370eaf(0x149),_0x368d76);_0x343763[0x0][_0x370eaf(0x114)]==0x1?(right_currency=_0x343763[0x0][_0x370eaf(0x141)],left_currency=''):(right_currency='',left_currency=_0x343763[0x0]['currency']);var _0xca2670=_0x3a81e6,_0x308788=_0x392abb,_0x355400='',_0x5353ec;for(_0x5353ec in _0xca2670){_0x355400+=_0x370eaf(0xd8)+_0x370eaf(0x11c)+_0xca2670[_0x5353ec]+_0x370eaf(0xd5)+_0x370eaf(0x11c)+_0x308788[_0x5353ec]+'</td>'+_0x370eaf(0x104);}console[_0x370eaf(0x193)]('product_list',_0x355400);let _0x51546d=nodemailer[_0x370eaf(0xf6)]({'service':_0x370eaf(0x191),'auth':{'user':_0x47ebbd[_0x370eaf(0x15b)],'pass':_0x47ebbd[_0x370eaf(0xdf)]}}),_0xf33130={'from':_0x47ebbd['email'],'to':_0x368d76['email'],'subject':_0x370eaf(0x129),'attachments':[{'filename':_0x370eaf(0x15e),'path':__dirname+_0x370eaf(0xdd)+_0x370eaf(0x166)+_0x343763[0x0]['image'],'cid':_0x370eaf(0x16d)}],'html':'<!DOCTYPE\x20html>'+_0x370eaf(0x138)+_0x370eaf(0xda)+_0x370eaf(0x1b3)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x370eaf(0x1b3)+_0x370eaf(0x1b4)+_0x370eaf(0x1a3)+_0x370eaf(0x1b3)+'<h2>\x20'+_0x343763[0x0][_0x370eaf(0xe2)]+_0x370eaf(0x16a)+_0x370eaf(0x1a3)+_0x370eaf(0x1a3)+_0x370eaf(0x169)+'<div>'+_0x370eaf(0x1d3)+_0x370eaf(0x162)+_0x2e4775+'\x20'+_0x370eaf(0x135)+_0x370eaf(0xf4)+_0x155fbb+'\x20'+_0x370eaf(0x155)+_0x370eaf(0x1ad)+_0x370eaf(0x1a3)+_0x370eaf(0x167)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x370eaf(0xd8)+_0x370eaf(0xf1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x370eaf(0x18d)+_0x370eaf(0xe6)+'</tr>'+_0x370eaf(0x198)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x355400+'\x20'+_0x370eaf(0x154)+_0x370eaf(0x133)+_0x370eaf(0x1b3)+_0x370eaf(0x173)+_0x370eaf(0x13c)+_0x343763[0x0][_0x370eaf(0xe2)]+_0x370eaf(0x1ad)+_0x370eaf(0x1a3)+_0x370eaf(0x1a3)+_0x370eaf(0x13e)};_0x51546d[_0x370eaf(0x115)](_0xf33130,function(_0x38767e,_0x4f4b68){var _0x4b496c=_0x370eaf;_0x38767e?(console[_0x4b496c(0x193)](_0x38767e),console[_0x4b496c(0x193)](_0x4b496c(0x18c))):console['log']('Email\x20sent\x20successfully');}),_0x221514[_0x370eaf(0xf5)](_0x370eaf(0x18b),_0x370eaf(0x1d8)),_0x574d88[_0x370eaf(0x1c6)](_0x370eaf(0x164));}catch(_0x914067){console[_0x370eaf(0x193)](_0x914067),_0x574d88['status'](0xc8)[_0x370eaf(0x12c)]({'message1':_0x914067[_0x370eaf(0x196)]});}}),router[a0_0x591ade(0x175)]('/barcode/:id',auth,async(_0x4182f4,_0x179a9c)=>{var _0x47906f=a0_0x591ade;try{const {username:_0x4d3946,email:_0x4c7c84,role:_0x564cd0}=_0x4182f4[_0x47906f(0x1ca)],_0x585a13=_0x4182f4[_0x47906f(0x1ca)],_0x178f68=await profile[_0x47906f(0x15f)]({'email':_0x585a13[_0x47906f(0x15b)]}),_0x5639a7=await master_shop[_0x47906f(0x16f)]();console['log'](_0x47906f(0x199),_0x5639a7);const _0x47009f=_0x4182f4[_0x47906f(0x152)]['id'],_0x22d488=await sales[_0x47906f(0x160)](_0x47009f);console[_0x47906f(0x193)](_0x47906f(0x180),_0x22d488);if(_0x5639a7[0x0][_0x47906f(0xcf)]=='English\x20(US)')var _0x4a3d76=users[_0x47906f(0x14a)];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]=='Hindi')var _0x4a3d76=users[_0x47906f(0xce)];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]==_0x47906f(0x1a5))var _0x4a3d76=users['German'];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]==_0x47906f(0x12f))var _0x4a3d76=users[_0x47906f(0x12f)];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]==_0x47906f(0x1b2))var _0x4a3d76=users[_0x47906f(0x1b2)];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]==_0x47906f(0x103))var _0x4a3d76=users[_0x47906f(0x117)];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]==_0x47906f(0x177))var _0x4a3d76=users[_0x47906f(0x177)];else{if(_0x5639a7[0x0][_0x47906f(0xcf)]==_0x47906f(0x185))var _0x4a3d76=users[_0x47906f(0xfe)];}}}}}}}_0x179a9c[_0x47906f(0x1b0)]('all_sales_barcode',{'success':_0x4182f4[_0x47906f(0xf5)](_0x47906f(0x18b)),'errors':_0x4182f4[_0x47906f(0xf5)](_0x47906f(0x101)),'role':_0x585a13,'profile':_0x178f68,'alldata':_0x22d488,'master_shop':_0x5639a7,'language':_0x4a3d76});}catch(_0x250957){console[_0x47906f(0x193)](_0x250957);}}),router[a0_0x591ade(0xfb)]('/barcode_scanner',async(_0x4dc6e1,_0x3ce448)=>{var _0x3cdcd5=a0_0x591ade;const {product_code:_0x5a170f,warehouse_name:_0x58f774,rooms_data:_0x21805d,Roomslist:_0x55e914}=_0x4dc6e1['body'],_0x18c2ef=_0x55e914[_0x3cdcd5(0x137)](','),_0xcfc326=[];async function _0xd03c8e(_0x1c743b){var _0x4a20d9=_0x3cdcd5;const _0x56494d=await warehouse[_0x4a20d9(0x187)]([{'$match':{'name':_0x58f774,'room':_0x1c743b}},{'$unwind':_0x4a20d9(0x109)},{'$match':{'product_details.primary_code':_0x5a170f}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4a20d9(0xee)},'secondary_code':{'$first':_0x4a20d9(0x17e)},'product_code':{'$first':_0x4a20d9(0x178)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4a20d9(0x1c8)},'type':{'$first':_0x4a20d9(0xea)},'pallet':{'$first':_0x4a20d9(0x12b)},'unit':{'$first':_0x4a20d9(0x168)},'secondary_unit':{'$first':_0x4a20d9(0x1a2)},'storage':{'$first':_0x4a20d9(0x102)},'rack':{'$first':_0x4a20d9(0x1d7)},'expiry_date':{'$first':_0x4a20d9(0xd7)},'production_date':{'$first':_0x4a20d9(0xf7)},'maxPerUnit':{'$first':_0x4a20d9(0x14d)},'batch_code':{'$first':_0x4a20d9(0x107)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x4a20d9(0x1b6)},'invoice':{'$first':_0x4a20d9(0x195)},'actual_qty':{'$first':_0x4a20d9(0xd2)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x295f43=await warehouse[_0x4a20d9(0x187)]([{'$match':{'name':_0x58f774,'room':_0x1c743b}},{'$unwind':_0x4a20d9(0x109)},{'$match':{'product_details.secondary_code':_0x5a170f}},{'$group':{'_id':_0x4a20d9(0x183),'name':{'$first':_0x4a20d9(0x1d0)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4a20d9(0xee)},'secondary_code':{'$first':_0x4a20d9(0x17e)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x4a20d9(0x19d)},'isle':{'$first':_0x4a20d9(0x1c8)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4a20d9(0x168)},'secondary_unit':{'$first':_0x4a20d9(0x1a2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4a20d9(0xf7)},'maxPerUnit':{'$first':_0x4a20d9(0x14d)},'batch_code':{'$first':_0x4a20d9(0x107)},'product_cat':{'$first':_0x4a20d9(0x16c)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x4a20d9(0x1b6)},'invoice':{'$first':_0x4a20d9(0x195)}}}]);if(_0x56494d[_0x4a20d9(0x108)]>0x0)_0xcfc326[_0x4a20d9(0x1af)](_0x56494d);else _0x295f43[_0x4a20d9(0x108)]>0x0&&_0xcfc326['push'](_0x295f43);}const _0x385584=_0x18c2ef[_0x3cdcd5(0x1d1)](_0x42d0ff=>_0xd03c8e(_0x42d0ff));await Promise[_0x3cdcd5(0xe1)](_0x385584),_0x3ce448[_0x3cdcd5(0x12c)](_0xcfc326);}),module[a0_0x591ade(0x1ab)]=router;