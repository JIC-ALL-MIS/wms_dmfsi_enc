var a0_0x2ba82f=a0_0x7579;(function(_0x5345c9,_0x410312){var _0x3a8003=a0_0x7579,_0xec3e27=_0x5345c9();while(!![]){try{var _0xfcb693=parseInt(_0x3a8003(0x26a))/0x1*(parseInt(_0x3a8003(0x1ed))/0x2)+parseInt(_0x3a8003(0x27a))/0x3*(parseInt(_0x3a8003(0x1ba))/0x4)+-parseInt(_0x3a8003(0x2a1))/0x5*(parseInt(_0x3a8003(0x289))/0x6)+-parseInt(_0x3a8003(0x20e))/0x7+-parseInt(_0x3a8003(0x290))/0x8*(parseInt(_0x3a8003(0x1c3))/0x9)+parseInt(_0x3a8003(0x279))/0xa*(-parseInt(_0x3a8003(0x1c1))/0xb)+parseInt(_0x3a8003(0x203))/0xc;if(_0xfcb693===_0x410312)break;else _0xec3e27['push'](_0xec3e27['shift']());}catch(_0x41148e){_0xec3e27['push'](_0xec3e27['shift']());}}}(a0_0x32e2,0x9bef6));const express=require(a0_0x2ba82f(0x1b3)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x2ba82f(0x22b)),nodemailer=require(a0_0x2ba82f(0x1b8)),users=require('../public/language/languages.json');function a0_0x7579(_0x4808eb,_0x208567){var _0x32e26e=a0_0x32e2();return a0_0x7579=function(_0x7579c6,_0x20ab6c){_0x7579c6=_0x7579c6-0x1b3;var _0x4b0d91=_0x32e26e[_0x7579c6];return _0x4b0d91;},a0_0x7579(_0x4808eb,_0x208567);}router[a0_0x2ba82f(0x220)](a0_0x2ba82f(0x226),auth,async(_0x45d2db,_0x1a2a08)=>{var _0x3d1ed8=a0_0x2ba82f;try{const {username:_0x463c5a,email:_0xa76552,role:_0xd3cd91}=_0x45d2db[_0x3d1ed8(0x293)],_0x56e76b=_0x45d2db[_0x3d1ed8(0x293)],_0x400005=await profile[_0x3d1ed8(0x244)]({'email':_0x56e76b[_0x3d1ed8(0x1f8)]}),_0x370fe2=await master_shop[_0x3d1ed8(0x2c3)]();let _0x1996b2;if(_0x56e76b['role']==_0x3d1ed8(0x1da)){const _0x576737=await staff[_0x3d1ed8(0x244)]({'email':_0x56e76b[_0x3d1ed8(0x1f8)]});_0x1996b2=await sales[_0x3d1ed8(0x1ef)]([{'$lookup':{'from':_0x3d1ed8(0x25f),'localField':_0x3d1ed8(0x1cf),'foreignField':_0x3d1ed8(0x28b),'as':_0x3d1ed8(0x2c1)}},{'$unwind':_0x3d1ed8(0x28e)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x3d1ed8(0x210),'invoice':{'$first':_0x3d1ed8(0x1fb)},'customers':{'$first':_0x3d1ed8(0x288)},'date':{'$first':_0x3d1ed8(0x1f0)},'warehouse_name':{'$first':_0x3d1ed8(0x1fe)},'sale_product':{'$push':_0x3d1ed8(0x1f6)},'note':{'$first':_0x3d1ed8(0x269)},'return_data':{'$first':_0x3d1ed8(0x1c6)},'customers_docs':{'$first':_0x3d1ed8(0x28e)},'total_saleproduct_quantity':{'$sum':_0x3d1ed8(0x237)},'level':{'$addToSet':_0x3d1ed8(0x278)},'isle':{'$addToSet':_0x3d1ed8(0x24f)},'type':{'$addToSet':_0x3d1ed8(0x1e0)},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x3d1ed8(0x1b9)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x1996b2=await sales[_0x3d1ed8(0x1ef)]([{'$lookup':{'from':_0x3d1ed8(0x25f),'localField':_0x3d1ed8(0x1cf),'foreignField':_0x3d1ed8(0x28b),'as':_0x3d1ed8(0x2c1)}},{'$unwind':_0x3d1ed8(0x28e)},{'$unwind':_0x3d1ed8(0x1f6)},{'$group':{'_id':_0x3d1ed8(0x210),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x3d1ed8(0x288)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3d1ed8(0x1fe)},'sale_product':{'$push':_0x3d1ed8(0x1f6)},'note':{'$first':'$note'},'return_data':{'$first':_0x3d1ed8(0x1c6)},'customers_docs':{'$first':_0x3d1ed8(0x28e)},'total_saleproduct_quantity':{'$sum':_0x3d1ed8(0x237)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x3d1ed8(0x24f)},'type':{'$addToSet':_0x3d1ed8(0x1e0)},'pallet':{'$addToSet':_0x3d1ed8(0x2b2)},'finalize':{'$first':_0x3d1ed8(0x1b9)},'isAllowEdit':{'$first':_0x3d1ed8(0x21a)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x3d1ed8(0x22d)](_0x3d1ed8(0x223),_0x1996b2);if(_0x370fe2[0x0]['language']=='English\x20(US)'){var _0x452638=users[_0x3d1ed8(0x225)];console[_0x3d1ed8(0x22d)](_0x452638);}else{if(_0x370fe2[0x0][_0x3d1ed8(0x1fd)]==_0x3d1ed8(0x1c2))var _0x452638=users[_0x3d1ed8(0x1c2)];else{if(_0x370fe2[0x0][_0x3d1ed8(0x1fd)]==_0x3d1ed8(0x1cd))var _0x452638=users[_0x3d1ed8(0x1cd)];else{if(_0x370fe2[0x0]['language']=='Spanish')var _0x452638=users[_0x3d1ed8(0x1ca)];else{if(_0x370fe2[0x0][_0x3d1ed8(0x1fd)]==_0x3d1ed8(0x218))var _0x452638=users[_0x3d1ed8(0x218)];else{if(_0x370fe2[0x0][_0x3d1ed8(0x1fd)]=='Portuguese\x20(BR)')var _0x452638=users[_0x3d1ed8(0x1d2)];else{if(_0x370fe2[0x0]['language']==_0x3d1ed8(0x257))var _0x452638=users[_0x3d1ed8(0x257)];else{if(_0x370fe2[0x0]['language']==_0x3d1ed8(0x2bb))var _0x452638=users[_0x3d1ed8(0x2a7)];}}}}}}}_0x1a2a08[_0x3d1ed8(0x28f)]('all_sales',{'success':_0x45d2db[_0x3d1ed8(0x2a4)](_0x3d1ed8(0x240)),'errors':_0x45d2db[_0x3d1ed8(0x2a4)](_0x3d1ed8(0x260)),'sales':_0x1996b2,'profile':_0x400005,'role':_0x56e76b,'master_shop':_0x370fe2,'language':_0x452638});}catch(_0x2f5151){console['log'](_0x2f5151);}});function a0_0x32e2(){var _0x1e44d2=['$product_details.pallet','delivery_date','<hr\x20class=\x22my-3\x22>','push','types','gmail','max','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$sale_product.quantity','split','level','redirect','</span>','/all_sales/view','/invoice/:id','getMonth','return_sale','success','$product_details.secondary_code','padStart','$product','findOne','room_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.maxPerUnit','slice','image','/all_sales/preview/','Email\x20sent\x20successfully','max_per_unit','back','product_code','$sale_product.bin','/barcode/:id','/preview/:id','actual_uom','amount','random','Logo.png','$name','Chinese','</div>','RMSEmail','catch','</head><body>','Return\x20Goods','$product_details.level','maxperunit','customers','errors','type','secondary_code','length','<strong>\x20Regards\x20</strong>','False','id_transaction_from','\x20Order\x20Number\x20:\x20','purchases_data','$note','3tmDDuA','</table>','edit_sales_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Portuguese\x20(BR)','requested_qty','received_amount','Sales\x20Mail','Sales\x20Add\x20successfully','createTransport','$product_details.bin','OUT-','_id','SCRN','$sale_product.bay','2723410VmHtDE','31467xCPhfZ','Received\x20Payment\x20For\x20Sale','primary_code','\x20Order\x20Date\x20:\x20','exports','edit_sales','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','bay','$product.product_name','/view/return_sales/:id','$product_details','getDate','logo','$customer','6GGvMVr','map','name','An\x20error\x20occurred\x20while\x20saving\x20data.','Enclosed','$customers_docs','render','40056VBCQAx','$product_details.invoice','string','user','$room','stock','/view/add_sales','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_list','An\x20error\x20occurred.','quantity_notConverted','master','expiry_date','$product_details.expiry_date','/barcode_scanner','primary_unit','$product_details._id','4656445buKwOJ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','user_id','flash','Return\x20Rooms','sale_product','Arabic','date','prod_invoice','secondary_unit','currency_placement','bin','English\x20(US)','message','error','</h5>','product','$sale_product.floorlevel','</body></html>','delivery_code','$product_details.primary_code','Ambient','$product_details.product_name','<html><head><title></title>','$product_details.rack','$product_details.isle','Arabic\x20(ae)','$product_details.storage','toString','due_amount','$product_details.bay','RoomAssigned','customers_docs','$product_details.production_date','find','host','True','<h5\x20style=\x22text-align:\x20left;\x22>','sales\x20item\x20return\x20successfull','express','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_stock','$product_details.secondary_unit','Error\x20Occurs','nodemailer','$finalize','96dCxDAx','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','return_data','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.batch_code','11KxXoSY','Hindi','2205AFDDgt','Sale\x20Return\x20Mail','/view/add_sale/product','$return_data','actual_qty','all_sales_barcode','$product_details.product_stock','Spanish','$product_details.type','barcode\x20Product\x20master','German','/upload/','customer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','production_date','Portuguese','add\x20post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Floor','stock_data','Shelves','\x20</h2>','</tbody>','staff','<tbody\x20style=\x22text-align:\x20center;\x22>','filter','foreach\x20newproduct','batch_code','sales_invoice','$sale_product.type','/give_payment/:id','id_transact','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Raw\x20Materials','warehouse_name','product_name','<!DOCTYPE\x20html>','return_qty','rack','$product_details.actual_uom','floor','floorlevel','375676KwncYs','prod_cat','aggregate','$date','status','forEach','product_details','port','</thead>','$sale_product','$product_details.product_cat','email','stocks','warehouse','$invoice','<h5>','language','$warehouse_name','all','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','body','quantity','34062708DkJRas','Level','sale_qty','save','abs','sendMail','Sales\x20Update\x20successfully','password','site_title','then','final','4093278EkMuyL','$product_details.floorlevel','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/view/:id','invoice','storage','$product_details.product_code','findById','/../public','French','carton','$isAllowEdit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','params','<div>','json','prod_code','get','</tr>','$product_details.unit','sales\x20all_data','role','English','/view','sales_quantity','Receiving\x20Area','add_sales','<tr>','../middleware/auth','<h2>\x20','log','post'];a0_0x32e2=function(){return _0x1e44d2;};return a0_0x32e2();}async function getRandom8DigitNumber(){var _0xc228c5=a0_0x2ba82f;const _0xccb086=0x989680,_0x1c6853=0x5f5e0ff,_0x4b129=Math[_0xc228c5(0x1eb)](Math[_0xc228c5(0x254)]()*(_0x1c6853-_0xccb086+0x1))+_0xccb086;var _0x2fd09a;const _0x20d689=await sales['findOne']({'invoice':_0xc228c5(0x275)+_0x4b129});return _0x20d689&&_0x20d689[_0xc228c5(0x263)]>0x0?_0x2fd09a='OUT-'+_0x4b129:_0x2fd09a=_0xc228c5(0x275)+_0x4b129,_0x2fd09a;}router[a0_0x2ba82f(0x220)]('/view/add_sales',auth,async(_0x566647,_0x21d429)=>{var _0x55c4e9=a0_0x2ba82f;try{const {username:_0x400c79,email:_0x3bcbb4,role:_0x45f028}=_0x566647[_0x55c4e9(0x293)],_0x46939c=_0x566647[_0x55c4e9(0x293)],_0x5eafc=await profile[_0x55c4e9(0x244)]({'email':_0x46939c['email']}),_0x2eb485=await master_shop[_0x55c4e9(0x2c3)](),_0x76c534=await customer['find']({});let _0x49fa43;if(_0x46939c[_0x55c4e9(0x224)]==_0x55c4e9(0x1da)){const _0x3f23ef=await staff['findOne']({'email':_0x46939c[_0x55c4e9(0x1f8)]});_0x49fa43=await warehouse[_0x55c4e9(0x1ef)]([{'$match':{'status':_0x55c4e9(0x280),'name':_0x3f23ef[_0x55c4e9(0x1fa)],'warehouse_category':_0x55c4e9(0x1e4),'name':{'$ne':_0x55c4e9(0x25c)}}},{'$group':{'_id':'$name','name':{'$first':_0x55c4e9(0x256)}}},{'$sort':{'name':0x1}}]);}else _0x49fa43=await warehouse[_0x55c4e9(0x1ef)]([{'$match':{'status':_0x55c4e9(0x280),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x55c4e9(0x25c)}}},{'$group':{'_id':_0x55c4e9(0x256),'name':{'$first':_0x55c4e9(0x256)}}},{'$sort':{'name':0x1}}]);const _0x1baa41=await product['find']({});var _0x247e80=[_0x55c4e9(0x2b6),_0x55c4e9(0x28d)];const _0x19edf6=await sales['find']({}),_0x144cc4=_0x19edf6['length']+0x1,_0x4db579=_0x55c4e9(0x275)+_0x144cc4[_0x55c4e9(0x2bd)]()[_0x55c4e9(0x242)](0x5,'0');if(_0x2eb485[0x0][_0x55c4e9(0x1fd)]==_0x55c4e9(0x2ad)){var _0x19c7e8=users[_0x55c4e9(0x225)];console[_0x55c4e9(0x22d)](_0x19c7e8);}else{if(_0x2eb485[0x0]['language']==_0x55c4e9(0x1c2))var _0x19c7e8=users[_0x55c4e9(0x1c2)];else{if(_0x2eb485[0x0]['language']==_0x55c4e9(0x1cd))var _0x19c7e8=users['German'];else{if(_0x2eb485[0x0][_0x55c4e9(0x1fd)]==_0x55c4e9(0x1ca))var _0x19c7e8=users[_0x55c4e9(0x1ca)];else{if(_0x2eb485[0x0][_0x55c4e9(0x1fd)]==_0x55c4e9(0x218))var _0x19c7e8=users[_0x55c4e9(0x218)];else{if(_0x2eb485[0x0]['language']==_0x55c4e9(0x26e))var _0x19c7e8=users['Portuguese'];else{if(_0x2eb485[0x0][_0x55c4e9(0x1fd)]==_0x55c4e9(0x257))var _0x19c7e8=users[_0x55c4e9(0x257)];else{if(_0x2eb485[0x0][_0x55c4e9(0x1fd)]=='Arabic\x20(ae)')var _0x19c7e8=users[_0x55c4e9(0x2a7)];}}}}}}}const _0x3acabf=getRandom8DigitNumber();_0x3acabf[_0x55c4e9(0x20c)](_0xa0c515=>{var _0x1812a6=_0x55c4e9;_0x21d429[_0x1812a6(0x28f)](_0x1812a6(0x229),{'success':_0x566647[_0x1812a6(0x2a4)](_0x1812a6(0x240)),'errors':_0x566647[_0x1812a6(0x2a4)](_0x1812a6(0x260)),'role':_0x46939c,'profile':_0x5eafc,'customer':_0x76c534,'warehouse':_0x49fa43,'product':_0x1baa41,'invoice':_0xa0c515,'master_shop':_0x2eb485,'language':_0x19c7e8,'rooms_data':_0x247e80});})[_0x55c4e9(0x25a)](_0x734d7c=>{var _0x5858c2=_0x55c4e9;_0x566647['flash'](_0x5858c2(0x260),_0x5858c2(0x1b4)),_0x21d429[_0x5858c2(0x23a)](_0x5858c2(0x23c));});}catch(_0x3a1af9){console['log'](_0x3a1af9);}}),router[a0_0x2ba82f(0x220)]('/view/add_sales/:id',auth,async(_0x194135,_0x1455e3)=>{var _0x4d52b6=a0_0x2ba82f;try{const _0x5c5a9f=_0x194135[_0x4d52b6(0x21c)]['id'];console['log'](_0x5c5a9f);const _0x341a68=await product['find'](),_0x43937f=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5c5a9f}},{'$unwind':_0x4d52b6(0x243)},{'$group':{'_id':_0x4d52b6(0x283)}}]);console[_0x4d52b6(0x22d)](_0x4d52b6(0x268),_0x43937f),_0x1455e3[_0x4d52b6(0x1f1)](0xc8)[_0x4d52b6(0x21e)]({'purchases_data':_0x43937f,'product_data':_0x341a68});}catch(_0x170e05){console[_0x4d52b6(0x22d)](_0x170e05);}}),router['post'](a0_0x2ba82f(0x1c5),auth,async(_0x5d5f17,_0x379555)=>{var _0x73ce7f=a0_0x2ba82f;try{const {warehouse_data:_0x47589,product_data:_0x5d312e}=_0x5d5f17[_0x73ce7f(0x201)];console[_0x73ce7f(0x22d)](_0x5d5f17[_0x73ce7f(0x201)]['product_data']);;const _0x39559c=await master_shop[_0x73ce7f(0x2c3)]();console[_0x73ce7f(0x22d)](_0x73ce7f(0x29b),_0x39559c);const _0x5590e6=await product[_0x73ce7f(0x244)]({'name':_0x5d312e});console[_0x73ce7f(0x22d)](_0x73ce7f(0x2b1),_0x5590e6);const _0x495f1a=await warehouse['aggregate']([{'$match':{'name':_0x47589}},{'$unwind':_0x73ce7f(0x285)},{'$match':{'product_details.product_name':_0x5d312e}},{'$group':{'_id':_0x73ce7f(0x2b7),'product_stock':{'$first':_0x73ce7f(0x1c9)}}}]);console[_0x73ce7f(0x22d)](_0x73ce7f(0x1d6),_0x495f1a),_0x379555[_0x73ce7f(0x1f1)](0xc8)['json']({'master':_0x39559c,'new_product':_0x5590e6,'stock_data':_0x495f1a});}catch(_0x35c2de){console[_0x73ce7f(0x22d)](_0x35c2de);}}),router['post'](a0_0x2ba82f(0x296),auth,async(_0x3d5105,_0x228c96)=>{var _0x26aa0d=a0_0x2ba82f;try{const {invoice:_0x4c7434,date:_0x1fd11d,warehouse_name:_0x289f7d,product_name:_0x257901,stock:_0xa637ab,quantity:_0x1c29c0,note:_0x32e347,room:_0x3f8c57,primary_code:_0x2f08c9,secondary_code:_0x44ebd6,prod_code:_0x1d982f,level:_0x12fca7,isle:_0x5df84b,pallet:_0xeb2b4c,batch_code:_0xb48159,SCRN:_0x4f0e91,expiry_date:_0x1cd2bf}=_0x3d5105['body'];if(typeof _0x257901==_0x26aa0d(0x292))var _0xf5896e=[_0x3d5105[_0x26aa0d(0x201)]['product_name']],_0x2e0133=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x295)]],_0x164239=[_0x3d5105[_0x26aa0d(0x201)]['carton']],_0x5edf74=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x27c)]],_0x36d13c=[_0x3d5105['body'][_0x26aa0d(0x262)]],_0x3b49a9=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x21f)]],_0x1507b0=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x239)]],_0x1391b4=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x29f)]],_0x530285=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x2aa)]],_0x5d48ee=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x1de)]],_0x36dbb1=[_0x3d5105['body'][_0x26aa0d(0x29c)]],_0x429d72=[_0x3d5105['body'][_0x26aa0d(0x24c)]],_0x25ad45=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x1d1)]],_0x4602a6=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x26f)]],_0x42e08d=[_0x3d5105[_0x26aa0d(0x201)]['delivery_date']],_0x77239=[_0x3d5105[_0x26aa0d(0x201)]['delivery_code']],_0xf6a2d1=[_0x3d5105[_0x26aa0d(0x201)]['prod_cat']],_0x564e16=[_0x3d5105[_0x26aa0d(0x201)]['quantity']],_0x48c813=[_0x3d5105[_0x26aa0d(0x201)]['RoomAssigned']],_0x574e52=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x2a9)]],_0x4f7e49=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x1c7)]],_0xbf15d=[_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x252)]],_0xdd8c84=[_0x3d5105[_0x26aa0d(0x201)]['id_transact']];else var _0xf5896e=[..._0x3d5105[_0x26aa0d(0x201)]['product_name']],_0x2e0133=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x295)]],_0x164239=[..._0x3d5105[_0x26aa0d(0x201)]['carton']],_0x5edf74=[..._0x3d5105['body'][_0x26aa0d(0x27c)]],_0x36d13c=[..._0x3d5105[_0x26aa0d(0x201)]['secondary_code']],_0x3b49a9=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x21f)]],_0x1507b0=[..._0x3d5105[_0x26aa0d(0x201)]['level']],_0x1391b4=[..._0x3d5105['body'][_0x26aa0d(0x29f)]],_0x530285=[..._0x3d5105['body'][_0x26aa0d(0x2aa)]],_0x5d48ee=[..._0x3d5105[_0x26aa0d(0x201)]['batch_code']],_0x36dbb1=[..._0x3d5105[_0x26aa0d(0x201)]['expiry_date']],_0x429d72=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x24c)]],_0x25ad45=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x1d1)]],_0x4602a6=[..._0x3d5105[_0x26aa0d(0x201)]['requested_qty']],_0x42e08d=[..._0x3d5105['body'][_0x26aa0d(0x230)]],_0x77239=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x2b4)]],_0xf6a2d1=[..._0x3d5105['body'][_0x26aa0d(0x1ee)]],_0x564e16=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x202)]],_0x48c813=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x2c0)]],_0x574e52=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x2a9)]],_0x4f7e49=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x1c7)]],_0xbf15d=[..._0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x252)]],_0xdd8c84=[..._0x3d5105['body'][_0x26aa0d(0x1e2)]];const _0x2b4d15=_0xf5896e[_0x26aa0d(0x28a)](_0x63d4b4=>{return _0x63d4b4={'product_name':_0x63d4b4};});_0x2e0133[_0x26aa0d(0x1f2)]((_0x4a24c1,_0x32915e)=>{var _0xb53ad5=_0x26aa0d;_0x2b4d15[_0x32915e][_0xb53ad5(0x295)]=Math[_0xb53ad5(0x207)](_0x4a24c1);}),_0x4f7e49[_0x26aa0d(0x1f2)]((_0x4e49fa,_0x1a5751)=>{_0x2b4d15[_0x1a5751]['actual_qty']=Math['abs'](_0x4e49fa);}),_0xbf15d['forEach']((_0xf57ad0,_0x158593)=>{_0x2b4d15[_0x158593]['actual_uom']=_0xf57ad0;}),_0xdd8c84[_0x26aa0d(0x1f2)]((_0x1974f0,_0x124b97)=>{var _0x3f7672=_0x26aa0d;_0x2b4d15[_0x124b97][_0x3f7672(0x266)]=_0x1974f0;}),_0x164239[_0x26aa0d(0x1f2)]((_0x248ed8,_0x59b213)=>{_0x2b4d15[_0x59b213]['quantity']=_0x248ed8;}),_0x5edf74[_0x26aa0d(0x1f2)]((_0x4e3864,_0x4eb35e)=>{var _0x133a56=_0x26aa0d;_0x2b4d15[_0x4eb35e][_0x133a56(0x27c)]=_0x4e3864;}),_0x36d13c[_0x26aa0d(0x1f2)]((_0x30ad60,_0x2ed864)=>{var _0x25b4b7=_0x26aa0d;_0x2b4d15[_0x2ed864][_0x25b4b7(0x262)]=_0x30ad60;}),_0x3b49a9[_0x26aa0d(0x1f2)]((_0x20b541,_0x5ad1a8)=>{var _0x1093a4=_0x26aa0d;_0x2b4d15[_0x5ad1a8][_0x1093a4(0x24e)]=_0x20b541;}),_0x1507b0[_0x26aa0d(0x1f2)]((_0x55fc39,_0x50a706)=>{var _0xa764f5=_0x26aa0d;_0x48c813[_0xa764f5(0x1f2)]((_0x4d5d34,_0x148df5)=>{var _0x221ab9=_0xa764f5;if(_0x4d5d34==_0x221ab9(0x228)&&_0x50a706==_0x148df5){var _0x3d6097=_0x55fc39[_0x221ab9(0x248)](0x3);_0x2b4d15[_0x50a706][_0x221ab9(0x214)]=_0x55fc39[0x0],_0x2b4d15[_0x50a706][_0x221ab9(0x1e9)]=_0x55fc39[0x1],_0x2b4d15[_0x50a706][_0x221ab9(0x282)]=0x0,_0x2b4d15[_0x50a706][_0x221ab9(0x2ac)]=0x0,_0x2b4d15[_0x50a706][_0x221ab9(0x261)]=_0x221ab9(0x1d5),_0x2b4d15[_0x50a706]['floorlevel']=_0x3d6097;}else{if(_0x4d5d34=='Shelves'&&_0x50a706==_0x148df5){var _0x3d6097=_0x55fc39[_0x221ab9(0x248)](0x3);_0x2b4d15[_0x50a706][_0x221ab9(0x214)]=_0x55fc39[0x0],_0x2b4d15[_0x50a706][_0x221ab9(0x1e9)]=_0x55fc39[0x1],_0x2b4d15[_0x50a706][_0x221ab9(0x282)]=0x0,_0x2b4d15[_0x50a706][_0x221ab9(0x2ac)]=0x0,_0x2b4d15[_0x50a706][_0x221ab9(0x261)]=_0x221ab9(0x1d5),_0x2b4d15[_0x50a706][_0x221ab9(0x1ec)]=_0x55fc39[0x5];}else{if(_0x50a706==_0x148df5){var _0x102d49;if(_0x55fc39[0x4]=='L')_0x102d49=_0x221ab9(0x204);else _0x55fc39[0x4]=='F'&&(_0x102d49='Floor');_0x2b4d15[_0x50a706][_0x221ab9(0x214)]=_0x55fc39[0x0],_0x2b4d15[_0x50a706][_0x221ab9(0x1e9)]=_0x55fc39[0x1],_0x2b4d15[_0x50a706]['bay']=_0x55fc39[0x2],_0x2b4d15[_0x50a706][_0x221ab9(0x2ac)]=_0x55fc39[0x3],_0x2b4d15[_0x50a706][_0x221ab9(0x261)]=_0x102d49,_0x2b4d15[_0x50a706][_0x221ab9(0x1ec)]=_0x55fc39[0x5];}}}});}),_0x1391b4[_0x26aa0d(0x1f2)]((_0x3d4a43,_0x48b6a4)=>{_0x2b4d15[_0x48b6a4]['unit']=_0x3d4a43;}),_0x530285[_0x26aa0d(0x1f2)]((_0x49dbc1,_0x3f922c)=>{var _0x4f3673=_0x26aa0d;_0x2b4d15[_0x3f922c][_0x4f3673(0x2aa)]=_0x49dbc1;}),_0x5d48ee[_0x26aa0d(0x1f2)]((_0x21ee56,_0x24aca2)=>{var _0x1be13a=_0x26aa0d;_0x2b4d15[_0x24aca2][_0x1be13a(0x1de)]=_0x21ee56;}),_0x36dbb1[_0x26aa0d(0x1f2)]((_0x3cf403,_0x442512)=>{_0x2b4d15[_0x442512]['expiry_date']=_0x3cf403;}),_0x429d72[_0x26aa0d(0x1f2)]((_0x263106,_0x298f50)=>{var _0x3eb00c=_0x26aa0d;_0x2b4d15[_0x298f50][_0x3eb00c(0x25e)]=_0x263106;}),_0x25ad45[_0x26aa0d(0x1f2)]((_0x112490,_0x3b7e34)=>{var _0x3fc3e7=_0x26aa0d;_0x2b4d15[_0x3b7e34][_0x3fc3e7(0x1d1)]=_0x112490;}),_0x4602a6['forEach']((_0x493313,_0x227cc9)=>{_0x2b4d15[_0x227cc9]['requested_qty']=_0x493313;}),_0x42e08d['forEach']((_0x23b85d,_0x259608)=>{var _0x25100d=_0x26aa0d;_0x2b4d15[_0x259608][_0x25100d(0x230)]=_0x23b85d;}),_0x77239[_0x26aa0d(0x1f2)]((_0x3e5634,_0xac4f39)=>{var _0x54facf=_0x26aa0d;_0x2b4d15[_0xac4f39][_0x54facf(0x2b4)]=_0x3e5634;}),_0xf6a2d1[_0x26aa0d(0x1f2)]((_0x2689c0,_0x2dde5b)=>{var _0x8e760c=_0x26aa0d;_0x2b4d15[_0x2dde5b][_0x8e760c(0x1ee)]=_0x2689c0;}),_0x564e16[_0x26aa0d(0x1f2)]((_0xf15a1f,_0x2ffe1b)=>{var _0x1f124d=_0x26aa0d;_0x2b4d15[_0x2ffe1b][_0x1f124d(0x29a)]=_0xf15a1f;}),_0x48c813[_0x26aa0d(0x1f2)]((_0x1082bf,_0x103f31)=>{var _0x533b87=_0x26aa0d;_0x2b4d15[_0x103f31][_0x533b87(0x245)]=_0x1082bf;}),_0x574e52['forEach']((_0xf6b08a,_0x3cc7db)=>{var _0x201ffb=_0x26aa0d;_0x2b4d15[_0x3cc7db][_0x201ffb(0x213)]=_0xf6b08a;});var _0x32af3a=0x0;_0x2b4d15['forEach'](_0x5f3009=>{var _0x21ff9d=_0x26aa0d;(_0x5f3009[_0x21ff9d(0x295)]<_0x5f3009[_0x21ff9d(0x29a)]||_0x5f3009[_0x21ff9d(0x29a)]==0x0)&&(console[_0x21ff9d(0x22d)](_0x21ff9d(0x1dd),_0x5f3009),_0x32af3a++);});const _0x422bf0=_0x2b4d15[_0x26aa0d(0x1dc)](_0x3f1ba6=>_0x3f1ba6[_0x26aa0d(0x202)]!=='0'&&_0x3f1ba6[_0x26aa0d(0x202)]!==''),_0x4736a8=new sales({'invoice':_0x4c7434,'customer':_0x3d5105[_0x26aa0d(0x201)][_0x26aa0d(0x1cf)],'date':_0x1fd11d,'warehouse_name':_0x289f7d,'sale_product':_0x422bf0,'note':_0x32e347,'room':_0x3f8c57,'primary_code':_0x2f08c9,'secondary_code':_0x44ebd6,'prod_code':_0x1d982f,'SCRN':_0x4f0e91}),_0x33b507=await _0x4736a8['save']();_0x3d5105['flash'](_0x26aa0d(0x240),_0x26aa0d(0x272)),_0x228c96[_0x26aa0d(0x23a)](_0x26aa0d(0x24a)+_0x33b507[_0x26aa0d(0x276)]);}catch(_0x1be2e0){console[_0x26aa0d(0x22d)](_0x1be2e0);}}),router['get'](a0_0x2ba82f(0x251),auth,async(_0x67da35,_0x58ca8b)=>{var _0x3e7e27=a0_0x2ba82f;try{const {username:_0x3c434e,email:_0x138985,role:_0x1eb82c}=_0x67da35[_0x3e7e27(0x293)],_0xb2810c=_0x67da35[_0x3e7e27(0x293)],_0x14b566=await profile['findOne']({'email':_0xb2810c[_0x3e7e27(0x1f8)]}),_0x429922=await master_shop[_0x3e7e27(0x2c3)](),_0x9883b6=_0x67da35[_0x3e7e27(0x21c)]['id'],_0x4bf0d4=await sales[_0x3e7e27(0x216)](_0x9883b6),_0xe394ac=await warehouse['aggregate']([{'$match':{'name':_0x4bf0d4[_0x3e7e27(0x1e5)]}},{'$unwind':_0x3e7e27(0x285)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3e7e27(0x2b7)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3e7e27(0x2bf)},'bin':{'$first':_0x3e7e27(0x274)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3e7e27(0x20f)},'primary_code':{'$first':_0x3e7e27(0x2b5)},'secondary_code':{'$first':_0x3e7e27(0x241)},'product_code':{'$first':_0x3e7e27(0x215)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3e7e27(0x2b9)},'expiry_date':{'$first':_0x3e7e27(0x29d)},'production_date':{'$first':'$product_details.production_date'},'invoice':{'$first':_0x3e7e27(0x291)}}}]),_0xce098a=await customer[_0x3e7e27(0x2c3)]({});let _0x51cdc6;if(_0xb2810c[_0x3e7e27(0x224)]==_0x3e7e27(0x1da)){const _0x3aa64c=await staff[_0x3e7e27(0x244)]({'email':_0xb2810c[_0x3e7e27(0x1f8)]});_0x51cdc6=await warehouse[_0x3e7e27(0x1ef)]([{'$match':{'status':_0x3e7e27(0x280),'name':_0x3aa64c[_0x3e7e27(0x1fa)]}},{'$group':{'_id':_0x3e7e27(0x256),'name':{'$first':_0x3e7e27(0x256)}}}]);}else _0x51cdc6=await warehouse[_0x3e7e27(0x1ef)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3e7e27(0x256),'name':{'$first':_0x3e7e27(0x256)}}}]);const _0x1f7232=await product[_0x3e7e27(0x2c3)]({}),_0x59383d=await suppliers['find']({});if(_0x429922[0x0][_0x3e7e27(0x1fd)]==_0x3e7e27(0x2ad)){var _0x39008b=users['English'];console[_0x3e7e27(0x22d)](_0x39008b);}else{if(_0x429922[0x0][_0x3e7e27(0x1fd)]==_0x3e7e27(0x1c2))var _0x39008b=users[_0x3e7e27(0x1c2)];else{if(_0x429922[0x0][_0x3e7e27(0x1fd)]==_0x3e7e27(0x1cd))var _0x39008b=users[_0x3e7e27(0x1cd)];else{if(_0x429922[0x0][_0x3e7e27(0x1fd)]==_0x3e7e27(0x1ca))var _0x39008b=users[_0x3e7e27(0x1ca)];else{if(_0x429922[0x0][_0x3e7e27(0x1fd)]==_0x3e7e27(0x218))var _0x39008b=users[_0x3e7e27(0x218)];else{if(_0x429922[0x0]['language']==_0x3e7e27(0x26e))var _0x39008b=users[_0x3e7e27(0x1d2)];else{if(_0x429922[0x0]['language']==_0x3e7e27(0x257))var _0x39008b=users[_0x3e7e27(0x257)];else{if(_0x429922[0x0][_0x3e7e27(0x1fd)]=='Arabic\x20(ae)')var _0x39008b=users[_0x3e7e27(0x2a7)];}}}}}}}_0x58ca8b[_0x3e7e27(0x28f)](_0x3e7e27(0x26c),{'success':_0x67da35[_0x3e7e27(0x2a4)]('success'),'errors':_0x67da35[_0x3e7e27(0x2a4)](_0x3e7e27(0x260)),'role':_0xb2810c,'profile':_0x14b566,'customer':_0xce098a,'warehouse':_0x51cdc6,'product':_0xe394ac,'user':_0x4bf0d4,'master_shop':_0x429922,'unit':_0x1f7232,'language':_0x39008b,'suppliers':_0x59383d});}catch(_0x2128b7){console['log'](_0x2128b7);}}),router[a0_0x2ba82f(0x22e)](a0_0x2ba82f(0x251),auth,async(_0x221ad6,_0x508f14)=>{var _0x42fbe3=a0_0x2ba82f;try{const _0x437f67=_0x221ad6[_0x42fbe3(0x21c)]['id'],{invoice:_0x386c9f,warehouse_name:_0x36a0d,room:_0x39c729}=_0x221ad6[_0x42fbe3(0x201)],_0x37bcee=await sales['findOne']({'invoice':_0x386c9f}),_0x4aeaf9=_0x37bcee['sale_product'][_0x42fbe3(0x28a)](async _0x446ae3=>{var _0x530219=_0x42fbe3,_0x4a9dec=await warehouse['findOne']({'name':_0x36a0d,'room':_0x446ae3[_0x530219(0x245)],'warehouse_category':_0x530219(0x1e4)});const _0x2560e7=_0x4a9dec[_0x530219(0x1f3)][_0x530219(0x28a)](_0x5a455c=>{var _0x4921c4=_0x530219;_0x5a455c[_0x4921c4(0x1e6)]==_0x446ae3[_0x4921c4(0x1e6)]&&_0x5a455c[_0x4921c4(0x1ec)]==_0x446ae3['floorlevel']&&_0x5a455c[_0x4921c4(0x261)]==_0x446ae3[_0x4921c4(0x261)]&&_0x5a455c[_0x4921c4(0x2ac)]==_0x446ae3[_0x4921c4(0x2ac)]&&_0x5a455c[_0x4921c4(0x282)]==_0x446ae3[_0x4921c4(0x282)]&&_0x5a455c[_0x4921c4(0x1e9)]==_0x446ae3[_0x4921c4(0x1e9)]&&_0x5a455c['storage']==_0x446ae3[_0x4921c4(0x214)]&&_0x5a455c[_0x4921c4(0x29c)]==_0x446ae3[_0x4921c4(0x29c)]&&_0x5a455c[_0x4921c4(0x1de)]==_0x446ae3[_0x4921c4(0x1de)]&&_0x5a455c[_0x4921c4(0x213)]==_0x446ae3[_0x4921c4(0x213)]&&_0x5a455c['_id']==_0x446ae3[_0x4921c4(0x266)]&&(_0x5a455c[_0x4921c4(0x1b5)]=Math[_0x4921c4(0x235)](0x0,Math['abs'](_0x5a455c[_0x4921c4(0x1b5)])-Math['abs'](_0x446ae3[_0x4921c4(0x202)])));});return _0x4a9dec;});Promise[_0x42fbe3(0x1ff)](_0x4aeaf9)['then'](async _0x37dacc=>{var _0x1189e5=_0x42fbe3;try{for(const _0x30e046 of _0x37dacc){await _0x30e046[_0x1189e5(0x206)]();}_0x37bcee['finalize']=_0x1189e5(0x2c5);const _0x3b1fbe=await _0x37bcee['save'](),_0x35338a=await master_shop[_0x1189e5(0x2c3)](),_0x2d0a81=await email_settings[_0x1189e5(0x244)](),_0x1f2db0=await supervisor_settings[_0x1189e5(0x2c3)]();var _0x109d85=_0x37bcee[_0x1189e5(0x2a6)],_0x3d59f7='',_0x4501c0;for(_0x4501c0 in _0x109d85){_0x3d59f7+=_0x1189e5(0x22a)+_0x1189e5(0x200)+_0x109d85[_0x4501c0]['product_name']+'</td>'+_0x1189e5(0x200)+_0x109d85[_0x4501c0][_0x1189e5(0x24e)]+_0x1189e5(0x1bb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x109d85[_0x4501c0][_0x1189e5(0x202)]+_0x1189e5(0x1bb)+_0x1189e5(0x200)+_0x109d85[_0x4501c0]['unit']+'</td>'+_0x1189e5(0x200)+_0x109d85[_0x4501c0][_0x1189e5(0x2aa)]+_0x1189e5(0x1bb)+_0x1189e5(0x200)+_0x37bcee['warehouse_name']+_0x1189e5(0x1bb)+_0x1189e5(0x200)+_0x109d85[_0x4501c0][_0x1189e5(0x245)]+'</td>'+_0x1189e5(0x200)+_0x109d85[_0x4501c0][_0x1189e5(0x214)]+_0x109d85[_0x4501c0][_0x1189e5(0x1e9)]+_0x109d85[_0x4501c0][_0x1189e5(0x282)]+_0x109d85[_0x4501c0][_0x1189e5(0x2ac)]+_0x109d85[_0x4501c0][_0x1189e5(0x261)][0x0]+_0x109d85[_0x4501c0][_0x1189e5(0x1ec)]+'</td>','</tr>';}let _0x20499a=nodemailer['createTransport']({'host':_0x2d0a81[_0x1189e5(0x2c4)],'port':Number(_0x2d0a81[_0x1189e5(0x1f4)]),'secure':![],'auth':{'user':_0x2d0a81['email'],'pass':_0x2d0a81[_0x1189e5(0x20a)]}}),_0x3c6c81={'from':_0x2d0a81['email'],'to':_0x1f2db0[0x0][_0x1189e5(0x259)],'subject':_0x1189e5(0x271),'attachments':[{'filename':_0x1189e5(0x255),'path':__dirname+_0x1189e5(0x217)+_0x1189e5(0x1ce)+_0x35338a[0x0][_0x1189e5(0x249)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x1189e5(0x2b8)+_0x1189e5(0x25b)+_0x1189e5(0x21d)+_0x1189e5(0x297)+_0x1189e5(0x21d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x1189e5(0x22c)+_0x35338a[0x0][_0x1189e5(0x20b)]+_0x1189e5(0x1d8)+_0x1189e5(0x258)+_0x1189e5(0x258)+_0x1189e5(0x231)+_0x1189e5(0x21d)+_0x1189e5(0x2c6)+_0x1189e5(0x267)+_0x37bcee['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x37bcee[_0x1189e5(0x2a8)]+'\x20'+'</span>'+_0x1189e5(0x2b0)+_0x1189e5(0x258)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1189e5(0x236)+'<tr>'+_0x1189e5(0x1e3)+_0x1189e5(0x21b)+_0x1189e5(0x1d4)+_0x1189e5(0x2a2)+_0x1189e5(0x26d)+_0x1189e5(0x211)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1189e5(0x1bf)+_0x1189e5(0x221)+_0x1189e5(0x1f5)+_0x1189e5(0x1db)+'\x20'+_0x3d59f7+'\x20'+'</tbody>'+_0x1189e5(0x26b)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x1189e5(0x1fc)+_0x35338a[0x0][_0x1189e5(0x20b)]+'</h5>'+_0x1189e5(0x258)+'</div>'+'</body></html>'};_0x20499a[_0x1189e5(0x208)](_0x3c6c81,function(_0x1823dd,_0x582169){var _0x4a423a=_0x1189e5;_0x1823dd?(console['log'](_0x1823dd),console[_0x4a423a(0x22d)](_0x4a423a(0x1b7))):console['log'](_0x4a423a(0x24b));}),_0x221ad6['flash']('success',_0x1189e5(0x209)),_0x508f14[_0x1189e5(0x23a)](_0x1189e5(0x24a)+_0x437f67);}catch(_0x10fdd7){console[_0x1189e5(0x2af)](_0x10fdd7),_0x508f14[_0x1189e5(0x1f1)](0x1f4)[_0x1189e5(0x21e)]({'error':_0x1189e5(0x28c)});}})['catch'](_0x4553ec=>{var _0x453891=_0x42fbe3;console[_0x453891(0x2af)](_0x4553ec),_0x508f14[_0x453891(0x1f1)](0x1f4)[_0x453891(0x21e)]({'error':_0x453891(0x299)});});}catch(_0x476cec){console[_0x42fbe3(0x22d)](_0x476cec);}}),router[a0_0x2ba82f(0x220)](a0_0x2ba82f(0x212),auth,async(_0x3cdf35,_0x55e565)=>{var _0x135840=a0_0x2ba82f;try{const {username:_0x4d4fff,email:_0x300af1,role:_0x4f2db2}=_0x3cdf35['user'],_0x4eb115=_0x3cdf35[_0x135840(0x293)],_0x45f5db=await profile[_0x135840(0x244)]({'email':_0x4eb115[_0x135840(0x1f8)]}),_0x8958ec=await master_shop['find'](),_0xa46f9b=_0x3cdf35[_0x135840(0x21c)]['id'],_0x14bec0=await sales[_0x135840(0x216)](_0xa46f9b);var _0x2abe9a=[_0x135840(0x2b6),_0x135840(0x28d)];const _0xd394d6=await warehouse[_0x135840(0x1ef)]([{'$match':{'name':_0x14bec0[_0x135840(0x1e5)],'warehouse_category':_0x135840(0x1e4)}},{'$unwind':_0x135840(0x285)},{'$group':{'_id':_0x135840(0x2a0),'name':{'$first':_0x135840(0x2b7)},'product_stock':{'$first':_0x135840(0x1c9)},'bay':{'$first':_0x135840(0x2bf)},'bin':{'$first':_0x135840(0x274)},'type':{'$first':_0x135840(0x1cb)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x135840(0x2b5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x135840(0x215)},'storage':{'$first':_0x135840(0x2bc)},'rack':{'$first':'$product_details.rack'}}}]),_0x1b0119=await customer[_0x135840(0x2c3)]({});let _0x2d76a0;if(_0x4eb115[_0x135840(0x224)]=='staff'){const _0x236362=await staff[_0x135840(0x244)]({'email':_0x4eb115[_0x135840(0x1f8)]});_0x2d76a0=await warehouse[_0x135840(0x1ef)]([{'$match':{'status':_0x135840(0x280),'name':_0x236362[_0x135840(0x1fa)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x135840(0x256),'name':{'$first':'$name'}}}]);}else _0x2d76a0=await warehouse[_0x135840(0x1ef)]([{'$match':{'status':_0x135840(0x280),'warehouse_category':_0x135840(0x1e4)}},{'$group':{'_id':_0x135840(0x256),'name':{'$first':'$name'}}}]);const _0x16c088=await product[_0x135840(0x2c3)]({});if(_0x8958ec[0x0][_0x135840(0x1fd)]=='English\x20(US)'){var _0x4a42ff=users[_0x135840(0x225)];console[_0x135840(0x22d)](_0x4a42ff);}else{if(_0x8958ec[0x0][_0x135840(0x1fd)]==_0x135840(0x1c2))var _0x4a42ff=users[_0x135840(0x1c2)];else{if(_0x8958ec[0x0][_0x135840(0x1fd)]==_0x135840(0x1cd))var _0x4a42ff=users['German'];else{if(_0x8958ec[0x0]['language']=='Spanish')var _0x4a42ff=users['Spanish'];else{if(_0x8958ec[0x0][_0x135840(0x1fd)]=='French')var _0x4a42ff=users[_0x135840(0x218)];else{if(_0x8958ec[0x0][_0x135840(0x1fd)]=='Portuguese\x20(BR)')var _0x4a42ff=users['Portuguese'];else{if(_0x8958ec[0x0]['language']==_0x135840(0x257))var _0x4a42ff=users[_0x135840(0x257)];else{if(_0x8958ec[0x0]['language']==_0x135840(0x2bb))var _0x4a42ff=users[_0x135840(0x2a7)];}}}}}}}_0x55e565[_0x135840(0x28f)](_0x135840(0x27f),{'success':_0x3cdf35['flash']('success'),'errors':_0x3cdf35[_0x135840(0x2a4)](_0x135840(0x260)),'role':_0x4eb115,'profile':_0x45f5db,'customer':_0x1b0119,'warehouse':_0x2d76a0,'product':_0xd394d6,'user':_0x14bec0,'master_shop':_0x8958ec,'unit':_0x16c088,'language':_0x4a42ff});}catch(_0x717c1b){console[_0x135840(0x22d)](_0x717c1b);}}),router['post']('/view/:id',auth,async(_0x3e99aa,_0x190d0c)=>{var _0x456384=a0_0x2ba82f;try{const _0x38ee47=_0x3e99aa[_0x456384(0x21c)]['id'],_0x36cb2a=await sales[_0x456384(0x244)]({'_id':_0x3e99aa['params']['id']}),_0x661101=await warehouse[_0x456384(0x244)]({'name':_0x36cb2a[_0x456384(0x1e5)],'room':_0x3e99aa[_0x456384(0x201)]['room']}),{invoice:_0x466855,date:_0x439c3f,warehouse_name:_0x273a29,product_name:_0x23fb90,stock:_0x1d7bff,quantity:_0x32c504,note:_0x19e105,room:_0x38b164,customer:_0x19ced4,SCRN:_0x56749b}=_0x3e99aa[_0x456384(0x201)];if(typeof _0x23fb90==_0x456384(0x292))var _0x4d24c3=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x1e6)]],_0x408d66=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x295)]],_0x1ef019=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x219)]],_0x262f15=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x27c)]],_0x2bea6d=[_0x3e99aa[_0x456384(0x201)]['secondary_code']],_0x84dae0=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x21f)]],_0x5ede0f=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x239)]],_0x227312=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x29f)]],_0x5d9925=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x2aa)]],_0x5d302e=[_0x3e99aa['body'][_0x456384(0x1de)]],_0x34e64e=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x29c)]],_0x5b420a=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x24c)]],_0x3bf262=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x1d1)]],_0xbe41e1=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x26f)]],_0x2043f1=[_0x3e99aa[_0x456384(0x201)]['delivery_date']],_0x27e736=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x2b4)]],_0x42bf3d=[_0x3e99aa['body'][_0x456384(0x1ee)]],_0x113fed=[_0x3e99aa[_0x456384(0x201)][_0x456384(0x202)]],_0x561f62=[_0x3e99aa[_0x456384(0x201)]['RoomAssigned']];else var _0x4d24c3=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x1e6)]],_0x408d66=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x295)]],_0x1ef019=[..._0x3e99aa[_0x456384(0x201)]['carton']],_0x262f15=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x27c)]],_0x2bea6d=[..._0x3e99aa['body']['secondary_code']],_0x84dae0=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x21f)]],_0x5ede0f=[..._0x3e99aa[_0x456384(0x201)]['level']],_0x227312=[..._0x3e99aa[_0x456384(0x201)]['primary_unit']],_0x5d9925=[..._0x3e99aa[_0x456384(0x201)]['secondary_unit']],_0x5d302e=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x1de)]],_0x34e64e=[..._0x3e99aa['body'][_0x456384(0x29c)]],_0x5b420a=[..._0x3e99aa[_0x456384(0x201)]['max_per_unit']],_0x3bf262=[..._0x3e99aa['body']['production_date']],_0xbe41e1=[..._0x3e99aa['body'][_0x456384(0x26f)]],_0x2043f1=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x230)]],_0x27e736=[..._0x3e99aa[_0x456384(0x201)]['delivery_code']],_0x42bf3d=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x1ee)]],_0x113fed=[..._0x3e99aa[_0x456384(0x201)]['quantity']],_0x561f62=[..._0x3e99aa[_0x456384(0x201)][_0x456384(0x2c0)]];const _0x33274c=_0x4d24c3[_0x456384(0x28a)](_0x5716c8=>{return _0x5716c8={'product_name':_0x5716c8};});_0x408d66['forEach']((_0x4c5f78,_0x196273)=>{var _0x4a7610=_0x456384;_0x33274c[_0x196273]['stock']=Math[_0x4a7610(0x207)](_0x4c5f78);}),_0x1ef019['forEach']((_0x587a82,_0x1338d0)=>{var _0x53c538=_0x456384;_0x33274c[_0x1338d0][_0x53c538(0x202)]=_0x587a82;}),_0x262f15[_0x456384(0x1f2)]((_0x46d9fe,_0xd76e01)=>{_0x33274c[_0xd76e01]['primary_code']=_0x46d9fe;}),_0x2bea6d[_0x456384(0x1f2)]((_0x3ad58f,_0x32463e)=>{var _0xb82774=_0x456384;_0x33274c[_0x32463e][_0xb82774(0x262)]=_0x3ad58f;}),_0x84dae0['forEach']((_0x173744,_0x1ef3ef)=>{var _0x3d1e76=_0x456384;_0x33274c[_0x1ef3ef][_0x3d1e76(0x24e)]=_0x173744;}),_0x5ede0f['forEach']((_0x5c22a3,_0x52a280)=>{_0x561f62['forEach']((_0x5c4590,_0x5023c7)=>{var _0x527679=a0_0x7579;if(_0x5c4590==_0x527679(0x228)&&_0x52a280==_0x5023c7){var _0x54bb7a=_0x5c22a3[_0x527679(0x248)](0x3);_0x33274c[_0x52a280][_0x527679(0x214)]=_0x5c22a3[0x0],_0x33274c[_0x52a280][_0x527679(0x1e9)]=_0x5c22a3[0x1],_0x33274c[_0x52a280][_0x527679(0x282)]=0x0,_0x33274c[_0x52a280][_0x527679(0x2ac)]=0x0,_0x33274c[_0x52a280][_0x527679(0x261)]=_0x527679(0x1d5),_0x33274c[_0x52a280]['floorlevel']=_0x54bb7a;}else{if(_0x5c4590==_0x527679(0x1d7)&&_0x52a280==_0x5023c7){var _0x54bb7a=_0x5c22a3[_0x527679(0x248)](0x3);_0x33274c[_0x52a280][_0x527679(0x214)]=_0x5c22a3[0x0],_0x33274c[_0x52a280]['rack']=_0x5c22a3[0x1],_0x33274c[_0x52a280][_0x527679(0x282)]=0x0,_0x33274c[_0x52a280]['bin']=0x0,_0x33274c[_0x52a280][_0x527679(0x261)]=_0x527679(0x1d5),_0x33274c[_0x52a280]['floorlevel']=_0x5c22a3[0x5];}else{if(_0x52a280==_0x5023c7){var _0x3de7e4;if(_0x5c22a3[0x4]=='L')_0x3de7e4=_0x527679(0x204);else _0x5c22a3[0x4]=='F'&&(_0x3de7e4=_0x527679(0x1d5));_0x33274c[_0x52a280][_0x527679(0x214)]=_0x5c22a3[0x0],_0x33274c[_0x52a280][_0x527679(0x1e9)]=_0x5c22a3[0x1],_0x33274c[_0x52a280][_0x527679(0x282)]=_0x5c22a3[0x2],_0x33274c[_0x52a280][_0x527679(0x2ac)]=_0x5c22a3[0x3],_0x33274c[_0x52a280][_0x527679(0x261)]=_0x3de7e4,_0x33274c[_0x52a280][_0x527679(0x1ec)]=_0x5c22a3[0x5];}}}});}),_0x227312[_0x456384(0x1f2)]((_0x107a79,_0x31a161)=>{_0x33274c[_0x31a161]['unit']=_0x107a79;}),_0x5d9925['forEach']((_0x53bd8d,_0x1779f4)=>{var _0x8c3981=_0x456384;_0x33274c[_0x1779f4][_0x8c3981(0x2aa)]=_0x53bd8d;}),_0x5d302e[_0x456384(0x1f2)]((_0xf716fd,_0x177374)=>{var _0x143574=_0x456384;_0x33274c[_0x177374][_0x143574(0x1de)]=_0xf716fd;}),_0x34e64e[_0x456384(0x1f2)]((_0x1d20ee,_0xcc4959)=>{var _0x575d08=_0x456384;_0x33274c[_0xcc4959][_0x575d08(0x29c)]=_0x1d20ee;}),_0x5b420a[_0x456384(0x1f2)]((_0x52c3a5,_0x5b6d25)=>{var _0x4ea67c=_0x456384;_0x33274c[_0x5b6d25][_0x4ea67c(0x25e)]=_0x52c3a5;}),_0x3bf262[_0x456384(0x1f2)]((_0x290084,_0x11f132)=>{var _0x49fa21=_0x456384;_0x33274c[_0x11f132][_0x49fa21(0x1d1)]=_0x290084;}),_0xbe41e1[_0x456384(0x1f2)]((_0x396994,_0x453371)=>{var _0xe957c6=_0x456384;_0x33274c[_0x453371][_0xe957c6(0x26f)]=Math[_0xe957c6(0x207)](_0x396994);}),_0x2043f1['forEach']((_0x1935d6,_0x19505c)=>{var _0x242e5d=_0x456384;_0x33274c[_0x19505c][_0x242e5d(0x230)]=_0x1935d6;}),_0x27e736[_0x456384(0x1f2)]((_0x174c5d,_0x22ce2d)=>{_0x33274c[_0x22ce2d]['delivery_code']=_0x174c5d;}),_0x42bf3d[_0x456384(0x1f2)]((_0x57950b,_0x16edd3)=>{_0x33274c[_0x16edd3]['prod_cat']=_0x57950b;}),_0x113fed['forEach']((_0x2a418c,_0x377920)=>{var _0x32e418=_0x456384;_0x33274c[_0x377920][_0x32e418(0x29a)]=_0x2a418c;}),_0x561f62['forEach']((_0x284b28,_0x11fccb)=>{var _0x30f4cc=_0x456384;_0x33274c[_0x11fccb][_0x30f4cc(0x245)]=_0x284b28;});var _0x276d3d=0x0;_0x33274c['forEach'](_0x346c95=>{var _0x536651=_0x456384;console[_0x536651(0x22d)](_0x536651(0x1dd),_0x346c95),(parseInt(_0x346c95[_0x536651(0x295)])<parseInt(_0x346c95[_0x536651(0x202)])||parseInt(_0x346c95[_0x536651(0x202)])==0x0)&&_0x276d3d++;});if(_0x276d3d!=0x0)return _0x3e99aa[_0x456384(0x2a4)]('errors',_0x456384(0x246)),_0x190d0c['redirect'](_0x456384(0x24d));const _0xadda61=_0x33274c[_0x456384(0x1dc)](_0x3b0bf9=>_0x3b0bf9[_0x456384(0x202)]!=='0'&&_0x3b0bf9[_0x456384(0x202)]!=='');_0x36cb2a[_0x456384(0x213)]=_0x466855,_0x36cb2a[_0x456384(0x1cf)]=_0x19ced4,_0x36cb2a[_0x456384(0x2a8)]=_0x439c3f,_0x36cb2a['warehouse_name']=_0x273a29,_0x36cb2a['sale_product']=_0xadda61,_0x36cb2a['note']=_0x19e105,_0x36cb2a[_0x456384(0x277)]=_0x56749b,_0x36cb2a['finalize']=_0x456384(0x265),_0x36cb2a['isAllowEdit']='False';const _0x4e2f47=await _0x36cb2a[_0x456384(0x206)]();_0x3e99aa[_0x456384(0x2a4)](_0x456384(0x240),'Sales\x20Update\x20successfully'),_0x190d0c['redirect']('/all_sales/view');}catch(_0x57568a){console[_0x456384(0x22d)](_0x57568a);}}),router[a0_0x2ba82f(0x22e)](a0_0x2ba82f(0x1e1),auth,async(_0x4fe604,_0x2643b6)=>{var _0x1f7c77=a0_0x2ba82f;try{const _0x38d262=_0x4fe604['params']['id'],{invoice:_0x2512e4,customer:_0x51f7ec,receivable_amount:_0x1f9094,received_amount:_0x4abc6d}=_0x4fe604[_0x1f7c77(0x201)],_0x212988=await sales[_0x1f7c77(0x216)](_0x38d262);console[_0x1f7c77(0x22d)](_0x212988);var _0x4da4dd=_0x1f9094-_0x4abc6d;console['log'](_0x4abc6d),_0x212988[_0x1f7c77(0x270)]=parseFloat(_0x4abc6d)+parseFloat(_0x212988[_0x1f7c77(0x270)]),_0x212988[_0x1f7c77(0x2be)]=_0x4da4dd,console[_0x1f7c77(0x22d)](_0x212988);const _0x4a2b22=await _0x212988[_0x1f7c77(0x206)](),_0x1520f7=await c_payment_data[_0x1f7c77(0x244)]({'invoice':_0x2512e4});_0x1520f7[_0x1f7c77(0x253)]=_0x4da4dd,await _0x1520f7[_0x1f7c77(0x206)]();let _0x4498e6=new Date(),_0x1b8ed5=('0'+_0x4498e6[_0x1f7c77(0x286)]())[_0x1f7c77(0x248)](-0x2),_0x457ef8=('0'+(_0x4498e6[_0x1f7c77(0x23e)]()+0x1))['slice'](-0x2),_0x484c93=_0x4498e6['getFullYear'](),_0x68f909=_0x484c93+'-'+_0x457ef8+'-'+_0x1b8ed5;const _0x4eaee5=new customer_payment({'invoice':_0x2512e4,'date':_0x484c93+'-'+_0x457ef8+'-'+_0x1b8ed5,'customer':_0x51f7ec,'reason':_0x1f7c77(0x27b),'amount':_0x4abc6d}),_0x1f86fa=await _0x4eaee5[_0x1f7c77(0x206)]();_0x4fe604[_0x1f7c77(0x2a4)](_0x1f7c77(0x240),'payment\x20successfull'),_0x2643b6[_0x1f7c77(0x23a)](_0x1f7c77(0x23c));}catch(_0x3e8e42){console[_0x1f7c77(0x22d)](_0x3e8e42);}}),router['get'](a0_0x2ba82f(0x23d),auth,async(_0x4b4a57,_0x2e6835)=>{var _0x52b675=a0_0x2ba82f;try{const {username:_0x570c24,email:_0x551b4d,role:_0x4ec269}=_0x4b4a57[_0x52b675(0x293)],_0x33b59d=_0x4b4a57[_0x52b675(0x293)],_0x3b84a3=await profile[_0x52b675(0x244)]({'email':_0x33b59d[_0x52b675(0x1f8)]}),_0x53b227=await master_shop['find']();console[_0x52b675(0x22d)](_0x52b675(0x29b),_0x53b227);const _0x501d14=_0x4b4a57[_0x52b675(0x21c)]['id'],_0x115e33=await sales['findById'](_0x501d14);console[_0x52b675(0x22d)](_0x115e33);const _0x1017c8=await customer[_0x52b675(0x244)]({'name':_0x115e33[_0x52b675(0x1cf)]});console[_0x52b675(0x22d)](_0x1017c8);if(_0x53b227[0x0]['language']==_0x52b675(0x2ad)){var _0x59039c=users[_0x52b675(0x225)];console[_0x52b675(0x22d)](_0x59039c);}else{if(_0x53b227[0x0]['language']==_0x52b675(0x1c2))var _0x59039c=users['Hindi'];else{if(_0x53b227[0x0]['language']==_0x52b675(0x1cd))var _0x59039c=users[_0x52b675(0x1cd)];else{if(_0x53b227[0x0][_0x52b675(0x1fd)]==_0x52b675(0x1ca))var _0x59039c=users[_0x52b675(0x1ca)];else{if(_0x53b227[0x0][_0x52b675(0x1fd)]==_0x52b675(0x218))var _0x59039c=users[_0x52b675(0x218)];else{if(_0x53b227[0x0][_0x52b675(0x1fd)]==_0x52b675(0x26e))var _0x59039c=users[_0x52b675(0x1d2)];else{if(_0x53b227[0x0][_0x52b675(0x1fd)]==_0x52b675(0x257))var _0x59039c=users[_0x52b675(0x257)];else{if(_0x53b227[0x0][_0x52b675(0x1fd)]==_0x52b675(0x2bb))var _0x59039c=users['Arabic'];}}}}}}}_0x2e6835[_0x52b675(0x28f)](_0x52b675(0x1df),{'success':_0x4b4a57[_0x52b675(0x2a4)](_0x52b675(0x240)),'errors':_0x4b4a57[_0x52b675(0x2a4)]('errors'),'role':_0x33b59d,'profile':_0x3b84a3,'master_shop':_0x53b227,'customers':_0x1017c8,'sales':_0x115e33,'language':_0x59039c});}catch(_0x2df9f1){console[_0x52b675(0x22d)](_0x2df9f1);}}),router[a0_0x2ba82f(0x220)]('/view/return_sales/:id',auth,async(_0x4693b5,_0x13662e)=>{var _0x492dc7=a0_0x2ba82f;try{const {username:_0x162fa8,email:_0x15f546,role:_0x3ff0e2}=_0x4693b5[_0x492dc7(0x293)],_0x46eff1=_0x4693b5[_0x492dc7(0x293)],_0x43d25e=await profile[_0x492dc7(0x244)]({'email':_0x46eff1['email']}),_0x697fa=await master_shop[_0x492dc7(0x2c3)]();console['log'](_0x492dc7(0x29b),_0x697fa);const _0x4be1b1=_0x4693b5['params']['id'];console[_0x492dc7(0x22d)](_0x4be1b1);const _0x1bc373=await sales['findById'](_0x4be1b1);console[_0x492dc7(0x22d)](_0x492dc7(0x2a3),_0x1bc373);const _0x40c76b=await warehouse[_0x492dc7(0x1ef)]([{'$match':{'name':_0x492dc7(0x25c),'room':_0x492dc7(0x2a5)}},{'$unwind':_0x492dc7(0x285)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x492dc7(0x2b7)},'product_stock':{'$first':_0x492dc7(0x1c9)},'level':{'$first':_0x492dc7(0x25d)},'isle':{'$first':_0x492dc7(0x2ba)},'pallet':{'$first':_0x492dc7(0x22f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x492dc7(0x241)},'product_code':{'$first':'$product_details.product_code'}}}]);console[_0x492dc7(0x22d)](_0x492dc7(0x1d6),_0x40c76b);const _0x1872b5=await product[_0x492dc7(0x2c3)]({});warehouse_data=await warehouse[_0x492dc7(0x1ef)]([{'$match':{'status':_0x492dc7(0x280),'name':_0x492dc7(0x25c),'warehouse_category':_0x492dc7(0x1e4)}},{'$group':{'_id':_0x492dc7(0x256),'name':{'$first':_0x492dc7(0x256)}}},{'$sort':{'name':0x1}}]);var _0x51cd58=[_0x492dc7(0x2a5)];if(_0x697fa[0x0]['language']==_0x492dc7(0x2ad)){var _0xff5f=users[_0x492dc7(0x225)];console[_0x492dc7(0x22d)](_0xff5f);}else{if(_0x697fa[0x0][_0x492dc7(0x1fd)]==_0x492dc7(0x1c2))var _0xff5f=users[_0x492dc7(0x1c2)];else{if(_0x697fa[0x0][_0x492dc7(0x1fd)]==_0x492dc7(0x1cd))var _0xff5f=users[_0x492dc7(0x1cd)];else{if(_0x697fa[0x0][_0x492dc7(0x1fd)]==_0x492dc7(0x1ca))var _0xff5f=users[_0x492dc7(0x1ca)];else{if(_0x697fa[0x0]['language']=='French')var _0xff5f=users['French'];else{if(_0x697fa[0x0][_0x492dc7(0x1fd)]==_0x492dc7(0x26e))var _0xff5f=users[_0x492dc7(0x1d2)];else{if(_0x697fa[0x0][_0x492dc7(0x1fd)]==_0x492dc7(0x257))var _0xff5f=users[_0x492dc7(0x257)];else{if(_0x697fa[0x0]['language']==_0x492dc7(0x2bb))var _0xff5f=users[_0x492dc7(0x2a7)];}}}}}}}_0x13662e[_0x492dc7(0x28f)](_0x492dc7(0x23f),{'success':_0x4693b5[_0x492dc7(0x2a4)]('success'),'errors':_0x4693b5[_0x492dc7(0x2a4)]('errors'),'role':_0x46eff1,'profile':_0x43d25e,'user':_0x1bc373,'stock':_0x40c76b,'master_shop':_0x697fa,'unit':_0x1872b5,'language':_0xff5f,'warehouses':warehouse_data,'rooms':_0x51cd58});}catch(_0x566c6b){console[_0x492dc7(0x22d)](_0x566c6b),_0x13662e[_0x492dc7(0x1f1)](0xc8)[_0x492dc7(0x21e)]({'message':_0x566c6b[_0x492dc7(0x2ae)]});}}),router[a0_0x2ba82f(0x22e)](a0_0x2ba82f(0x284),auth,async(_0x20be40,_0x17ac17)=>{var _0x3a930c=a0_0x2ba82f;try{const {invoice:_0x4d8cfe,date:_0x719cae,warehouse_name:_0x25b83c,product_name:_0x521eeb,primary_code:_0x411174,secondary_code:_0x4699c3,product_code:_0x2bb48b,sales_quantity:_0x5a421a,stocks:_0x3164e5,return_qty:_0x216ae4,Room_name:_0x16457d,to_warehouse_name:_0xe982be,to_Roomname:_0x19efed,to_Room_name:_0x5cb90b,note:_0x1fa433,level:_0x3e6d25,isle:_0x49b798,pallet:_0x253d76}=_0x20be40[_0x3a930c(0x201)];if(typeof _0x521eeb==_0x3a930c(0x292))var _0x4eee54=[_0x20be40[_0x3a930c(0x201)]['product_name']],_0x59d2c7=[_0x20be40['body'][_0x3a930c(0x27c)]],_0x4e507c=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x262)]],_0x330bd5=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x24e)]],_0x53d844=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x227)]],_0x55231c=[_0x20be40['body'][_0x3a930c(0x1f9)]],_0x5a25ae=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x1e8)]],_0x1fbca7=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x282)]],_0x2dd7fc=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x2ac)]],_0x5f3553=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x233)]],_0x47ca56=[_0x20be40[_0x3a930c(0x201)][_0x3a930c(0x1ec)]];else var _0x4eee54=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x1e6)]],_0x59d2c7=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x27c)]],_0x4e507c=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x262)]],_0x330bd5=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x24e)]],_0x53d844=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x227)]],_0x55231c=[..._0x20be40['body'][_0x3a930c(0x1f9)]],_0x5a25ae=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x1e8)]],_0x1fbca7=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x282)]],_0x2dd7fc=[..._0x20be40['body'][_0x3a930c(0x2ac)]],_0x5f3553=[..._0x20be40[_0x3a930c(0x201)][_0x3a930c(0x233)]],_0x47ca56=[..._0x20be40['body'][_0x3a930c(0x1ec)]];const _0x24a487=_0x4eee54[_0x3a930c(0x28a)](_0x32b2a8=>{return _0x32b2a8={'product_name':_0x32b2a8};});_0x59d2c7[_0x3a930c(0x1f2)]((_0x7576ae,_0x394874)=>{var _0x3ccb67=_0x3a930c;_0x24a487[_0x394874][_0x3ccb67(0x27c)]=_0x7576ae;}),_0x4e507c[_0x3a930c(0x1f2)]((_0x2f7c83,_0x31b9a3)=>{var _0x549369=_0x3a930c;_0x24a487[_0x31b9a3][_0x549369(0x262)]=_0x2f7c83;}),_0x330bd5['forEach']((_0xe20320,_0x42a3fa)=>{var _0x5c2050=_0x3a930c;_0x24a487[_0x42a3fa][_0x5c2050(0x24e)]=_0xe20320;}),_0x53d844[_0x3a930c(0x1f2)]((_0xa2297f,_0xc5bdf8)=>{_0x24a487[_0xc5bdf8]['sale_qty']=_0xa2297f;}),_0x55231c[_0x3a930c(0x1f2)]((_0x4ad6c6,_0x2b434c)=>{var _0x1a4158=_0x3a930c;_0x24a487[_0x2b434c][_0x1a4158(0x295)]=_0x4ad6c6;}),_0x5a25ae[_0x3a930c(0x1f2)]((_0x133924,_0x345c7d)=>{var _0x570759=_0x3a930c;_0x24a487[_0x345c7d][_0x570759(0x1e8)]=_0x133924;}),_0x1fbca7['forEach']((_0x3bae54,_0x2ae03c)=>{var _0x139507=_0x3a930c;_0x24a487[_0x2ae03c][_0x139507(0x282)]=_0x3bae54;}),_0x2dd7fc[_0x3a930c(0x1f2)]((_0x26f9b1,_0x2fe3cf)=>{_0x24a487[_0x2fe3cf]['bin']=_0x26f9b1;}),_0x5f3553[_0x3a930c(0x1f2)]((_0x122747,_0x899082)=>{var _0x51e784=_0x3a930c;_0x24a487[_0x899082][_0x51e784(0x261)]=_0x122747;}),_0x47ca56[_0x3a930c(0x1f2)]((_0x568836,_0x1e2e64)=>{var _0x5d08b5=_0x3a930c;_0x24a487[_0x1e2e64][_0x5d08b5(0x1ec)]=_0x568836;});var _0x43d1c5=0x0;_0x24a487[_0x3a930c(0x1f2)](_0x284eeb=>{var _0x2f56fa=_0x3a930c;console[_0x2f56fa(0x22d)](_0x2f56fa(0x1dd),_0x284eeb),(parseInt(_0x284eeb[_0x2f56fa(0x205)])<parseInt(_0x284eeb[_0x2f56fa(0x1e8)])||parseInt(_0x284eeb[_0x2f56fa(0x295)])<parseInt(_0x284eeb[_0x2f56fa(0x1e8)])&&parseInt(_0x284eeb[_0x2f56fa(0x205)])>parseInt(_0x284eeb[_0x2f56fa(0x1e8)])||parseInt(_0x284eeb[_0x2f56fa(0x1e8)])==0x0)&&_0x43d1c5++;});if(_0x43d1c5!=0x0)return _0x20be40['flash'](_0x3a930c(0x260),'Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty'),_0x17ac17[_0x3a930c(0x23a)](_0x3a930c(0x24d));const _0x283c63=await sales[_0x3a930c(0x244)]({'invoice':_0x4d8cfe});console[_0x3a930c(0x22d)](_0x283c63),_0x283c63[_0x3a930c(0x1bd)]='True';const _0x3ba09c=await _0x283c63[_0x3a930c(0x206)](),_0x37efd5=new sales_return({'invoice':_0x4d8cfe,'customer':_0x20be40['body'][_0x3a930c(0x1cf)],'date':_0x719cae,'warehouse_name':_0x25b83c,'room':_0x16457d,'ToWarehouse':_0xe982be,'ToRoom':_0x5cb90b,'return_sale':_0x24a487,'note':_0x1fa433}),_0x2d9e6a=await _0x37efd5[_0x3a930c(0x206)]();console['log'](_0x37efd5);const _0xed2dfd=await sales_return[_0x3a930c(0x244)]({'invoice':_0x4d8cfe}),_0x313e3c=await warehouse['findOne']({'name':_0xe982be,'room':_0x5cb90b});_0xed2dfd[_0x3a930c(0x23f)][_0x3a930c(0x1f2)](_0x4c8a94=>{var _0x824443=_0x3a930c,_0x2675cb=0x0;const _0x7bc566=_0x313e3c[_0x824443(0x1f3)]['map'](_0x4a8346=>{var _0x330fb6=_0x824443;_0x4a8346[_0x330fb6(0x1e6)]==_0x4c8a94['product_name']&&_0x4a8346['floorlevel']==_0x4c8a94[_0x330fb6(0x1ec)]&&_0x4a8346[_0x330fb6(0x261)]==_0x4c8a94['type']&&_0x4a8346[_0x330fb6(0x2ac)]==_0x4c8a94[_0x330fb6(0x2ac)]&&_0x4a8346[_0x330fb6(0x282)]==_0x4c8a94[_0x330fb6(0x282)]&&(_0x4a8346[_0x330fb6(0x1b5)]=parseInt(_0x4a8346[_0x330fb6(0x1b5)])+parseInt(_0x4c8a94[_0x330fb6(0x1e8)]),_0x2675cb++);});_0x2675cb=='0'&&(_0x313e3c['product_details']=_0x313e3c[_0x824443(0x1f3)]['concat']({'product_name':_0x4c8a94['product_name'],'product_stock':_0x4c8a94[_0x824443(0x1e8)],'primary_code':_0x4c8a94[_0x824443(0x27c)],'secondary_code':_0x4c8a94[_0x824443(0x262)],'product_code':_0x4c8a94[_0x824443(0x24e)],'bay':_0x4c8a94[_0x824443(0x282)],'bin':_0x4c8a94[_0x824443(0x2ac)],'type':_0x4c8a94[_0x824443(0x261)],'floorlevel':_0x4c8a94[_0x824443(0x1ec)]})),console[_0x824443(0x22d)](_0x824443(0x20d),_0x313e3c);}),await _0x313e3c['save'](),console['log'](_0x20be40['body']);const _0x28c9d4=new c_payment_data({'invoice':_0x4d8cfe,'customer':_0x20be40['body'][_0x3a930c(0x1cf)],'reason':'Sale\x20Return'});await _0x28c9d4[_0x3a930c(0x206)]();const _0x471149=await master_shop[_0x3a930c(0x2c3)]();console[_0x3a930c(0x22d)](_0x3a930c(0x1d3),_0x471149[0x0][_0x3a930c(0x249)]);const _0x3456ab=await email_settings['findOne'](),_0x36307e=await customer[_0x3a930c(0x244)]({'name':_0x20be40['body'][_0x3a930c(0x1cf)]});console['log']('customer_data',_0x36307e);_0x471149[0x0][_0x3a930c(0x2ab)]==0x1?(right_currency=_0x471149[0x0][_0x3a930c(0x1be)],left_currency=''):(right_currency='',left_currency=_0x471149[0x0][_0x3a930c(0x1be)]);var _0x58b623=_0x4eee54,_0x18145c=_0x5a25ae,_0x13537e='',_0x102b98;for(_0x102b98 in _0x58b623){_0x13537e+='<tr>'+_0x3a930c(0x200)+_0x58b623[_0x102b98]+_0x3a930c(0x1bb)+_0x3a930c(0x200)+_0x18145c[_0x102b98]+_0x3a930c(0x1bb)+_0x3a930c(0x221);}console[_0x3a930c(0x22d)](_0x3a930c(0x298),_0x13537e);let _0x55fc6f=nodemailer[_0x3a930c(0x273)]({'service':_0x3a930c(0x234),'auth':{'user':_0x3456ab[_0x3a930c(0x1f8)],'pass':_0x3456ab[_0x3a930c(0x20a)]}}),_0x359266={'from':_0x3456ab[_0x3a930c(0x1f8)],'to':_0x36307e[_0x3a930c(0x1f8)],'subject':_0x3a930c(0x1c4),'attachments':[{'filename':'Logo.png','path':__dirname+_0x3a930c(0x217)+_0x3a930c(0x1ce)+_0x471149[0x0][_0x3a930c(0x249)],'cid':_0x3a930c(0x287)}],'html':_0x3a930c(0x1e7)+_0x3a930c(0x2b8)+_0x3a930c(0x25b)+_0x3a930c(0x21d)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3a930c(0x21d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3a930c(0x258)+_0x3a930c(0x21d)+_0x3a930c(0x22c)+_0x471149[0x0]['site_title']+'\x20</h2>'+_0x3a930c(0x258)+_0x3a930c(0x258)+_0x3a930c(0x231)+'<div>'+_0x3a930c(0x2c6)+'\x20Order\x20Number\x20:\x20'+_0x4d8cfe+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3a930c(0x27d)+_0x719cae+'\x20'+_0x3a930c(0x23b)+_0x3a930c(0x2b0)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x3a930c(0x1e3)+_0x3a930c(0x1d0)+_0x3a930c(0x1bc)+_0x3a930c(0x281)+'</tr>'+_0x3a930c(0x1f5)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x13537e+'\x20'+_0x3a930c(0x1d9)+_0x3a930c(0x26b)+'<div>'+_0x3a930c(0x264)+_0x3a930c(0x1fc)+_0x471149[0x0][_0x3a930c(0x20b)]+_0x3a930c(0x2b0)+_0x3a930c(0x258)+_0x3a930c(0x258)+_0x3a930c(0x2b3)};_0x55fc6f['sendMail'](_0x359266,function(_0x16a70d,_0x48ba9a){var _0x15c33a=_0x3a930c;_0x16a70d?(console[_0x15c33a(0x22d)](_0x16a70d),console[_0x15c33a(0x22d)](_0x15c33a(0x1b7))):console['log']('Email\x20sent\x20successfully');}),_0x20be40[_0x3a930c(0x2a4)](_0x3a930c(0x240),_0x3a930c(0x2c7)),_0x17ac17[_0x3a930c(0x23a)](_0x3a930c(0x23c));}catch(_0x5bae6c){console['log'](_0x5bae6c),_0x17ac17['status'](0xc8)[_0x3a930c(0x21e)]({'message1':_0x5bae6c[_0x3a930c(0x2ae)]});}}),router[a0_0x2ba82f(0x220)](a0_0x2ba82f(0x250),auth,async(_0x32ca8c,_0x2894de)=>{var _0x498c88=a0_0x2ba82f;try{const {username:_0x26cd80,email:_0x17e6a7,role:_0x497d76}=_0x32ca8c[_0x498c88(0x293)],_0x30ea58=_0x32ca8c['user'],_0x159ee4=await profile[_0x498c88(0x244)]({'email':_0x30ea58[_0x498c88(0x1f8)]}),_0x45f2d5=await master_shop[_0x498c88(0x2c3)]();console[_0x498c88(0x22d)](_0x498c88(0x1cc),_0x45f2d5);const _0x1e0162=_0x32ca8c[_0x498c88(0x21c)]['id'],_0x5a587c=await sales['findById'](_0x1e0162);console[_0x498c88(0x22d)]('barcode\x20user_id',_0x5a587c);if(_0x45f2d5[0x0][_0x498c88(0x1fd)]==_0x498c88(0x2ad))var _0xaa92db=users[_0x498c88(0x225)];else{if(_0x45f2d5[0x0][_0x498c88(0x1fd)]==_0x498c88(0x1c2))var _0xaa92db=users[_0x498c88(0x1c2)];else{if(_0x45f2d5[0x0][_0x498c88(0x1fd)]==_0x498c88(0x1cd))var _0xaa92db=users['German'];else{if(_0x45f2d5[0x0][_0x498c88(0x1fd)]==_0x498c88(0x1ca))var _0xaa92db=users[_0x498c88(0x1ca)];else{if(_0x45f2d5[0x0][_0x498c88(0x1fd)]=='French')var _0xaa92db=users[_0x498c88(0x218)];else{if(_0x45f2d5[0x0]['language']==_0x498c88(0x26e))var _0xaa92db=users[_0x498c88(0x1d2)];else{if(_0x45f2d5[0x0][_0x498c88(0x1fd)]==_0x498c88(0x257))var _0xaa92db=users[_0x498c88(0x257)];else{if(_0x45f2d5[0x0][_0x498c88(0x1fd)]==_0x498c88(0x2bb))var _0xaa92db=users[_0x498c88(0x2a7)];}}}}}}}_0x2894de[_0x498c88(0x28f)](_0x498c88(0x1c8),{'success':_0x32ca8c['flash'](_0x498c88(0x240)),'errors':_0x32ca8c[_0x498c88(0x2a4)]('errors'),'role':_0x30ea58,'profile':_0x159ee4,'alldata':_0x5a587c,'master_shop':_0x45f2d5,'language':_0xaa92db});}catch(_0xbcc60f){console[_0x498c88(0x22d)](_0xbcc60f);}}),router[a0_0x2ba82f(0x22e)](a0_0x2ba82f(0x29e),async(_0x38352f,_0x19d043)=>{var _0x4a3acb=a0_0x2ba82f;const {product_code:_0x5c3382,warehouse_name:_0x4f0fbb,rooms_data:_0x4b85b4,Roomslist:_0x657c8e}=_0x38352f[_0x4a3acb(0x201)],_0x3f9fa6=_0x657c8e[_0x4a3acb(0x238)](','),_0x22ca99=[];async function _0x7abcfb(_0x861ec6){var _0x27202d=_0x4a3acb;const _0x153ad5=await warehouse[_0x27202d(0x1ef)]([{'$match':{'name':_0x4f0fbb,'room':_0x861ec6}},{'$unwind':_0x27202d(0x285)},{'$match':{'product_details.primary_code':_0x5c3382}},{'$group':{'_id':_0x27202d(0x2a0),'name':{'$first':_0x27202d(0x2b7)},'product_stock':{'$first':_0x27202d(0x1c9)},'primary_code':{'$first':_0x27202d(0x2b5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x27202d(0x215)},'level':{'$first':_0x27202d(0x2bf)},'isle':{'$first':_0x27202d(0x274)},'type':{'$first':_0x27202d(0x1cb)},'pallet':{'$first':_0x27202d(0x20f)},'unit':{'$first':_0x27202d(0x222)},'secondary_unit':{'$first':_0x27202d(0x1b6)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x27202d(0x2b9)},'expiry_date':{'$first':_0x27202d(0x29d)},'production_date':{'$first':_0x27202d(0x2c2)},'maxPerUnit':{'$first':_0x27202d(0x247)},'batch_code':{'$first':_0x27202d(0x1c0)},'product_cat':{'$first':_0x27202d(0x1f7)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x27202d(0x294)},'invoice':{'$first':_0x27202d(0x291)},'actual_qty':{'$first':'$product_details.actual_qty'},'actual_uom':{'$first':_0x27202d(0x1ea)}}}]),_0x53456a=await warehouse['aggregate']([{'$match':{'name':_0x4f0fbb,'room':_0x861ec6}},{'$unwind':_0x27202d(0x285)},{'$match':{'product_details.secondary_code':_0x5c3382}},{'$group':{'_id':_0x27202d(0x2a0),'name':{'$first':_0x27202d(0x2b7)},'product_stock':{'$first':_0x27202d(0x1c9)},'primary_code':{'$first':_0x27202d(0x2b5)},'secondary_code':{'$first':_0x27202d(0x241)},'product_code':{'$first':_0x27202d(0x215)},'level':{'$first':_0x27202d(0x2bf)},'isle':{'$first':_0x27202d(0x274)},'type':{'$first':_0x27202d(0x1cb)},'pallet':{'$first':_0x27202d(0x20f)},'unit':{'$first':_0x27202d(0x222)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x27202d(0x29d)},'production_date':{'$first':_0x27202d(0x2c2)},'maxPerUnit':{'$first':_0x27202d(0x247)},'batch_code':{'$first':_0x27202d(0x1c0)},'product_cat':{'$first':_0x27202d(0x1f7)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x27202d(0x291)}}}]);if(_0x153ad5['length']>0x0)_0x22ca99[_0x27202d(0x232)](_0x153ad5);else _0x53456a[_0x27202d(0x263)]>0x0&&_0x22ca99[_0x27202d(0x232)](_0x53456a);}const _0x4181ba=_0x3f9fa6['map'](_0x33efe5=>_0x7abcfb(_0x33efe5));await Promise['all'](_0x4181ba),_0x19d043[_0x4a3acb(0x21e)](_0x22ca99);}),module[a0_0x2ba82f(0x27e)]=router;