var a0_0x4abe0a=a0_0x1f46;(function(_0x3e72b1,_0x15a0ce){var _0x1bc555=a0_0x1f46,_0x22b195=_0x3e72b1();while(!![]){try{var _0x39eb6d=-parseInt(_0x1bc555(0xcd))/0x1*(parseInt(_0x1bc555(0xd6))/0x2)+parseInt(_0x1bc555(0x117))/0x3*(-parseInt(_0x1bc555(0xfc))/0x4)+-parseInt(_0x1bc555(0x168))/0x5+-parseInt(_0x1bc555(0x149))/0x6+parseInt(_0x1bc555(0xcc))/0x7+-parseInt(_0x1bc555(0x102))/0x8*(-parseInt(_0x1bc555(0x104))/0x9)+parseInt(_0x1bc555(0x11a))/0xa;if(_0x39eb6d===_0x15a0ce)break;else _0x22b195['push'](_0x22b195['shift']());}catch(_0x50046b){_0x22b195['push'](_0x22b195['shift']());}}}(a0_0x541c,0x30761));const express=require(a0_0x4abe0a(0x10f)),app=express(),router=express[a0_0x4abe0a(0x19d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x4abe0a(0x115)),auth=require(a0_0x4abe0a(0x16a)),nodemailer=require('nodemailer'),users=require(a0_0x4abe0a(0xd2));function a0_0x1f46(_0x8395ed,_0x3649e0){var _0x541c24=a0_0x541c();return a0_0x1f46=function(_0x1f466e,_0x25f21e){_0x1f466e=_0x1f466e-0x8f;var _0x473f65=_0x541c24[_0x1f466e];return _0x473f65;},a0_0x1f46(_0x8395ed,_0x3649e0);}router[a0_0x4abe0a(0x98)]('/view',auth,async(_0x9050f7,_0x5a136d)=>{var _0x480ee8=a0_0x4abe0a;try{const {username:_0x12f9e1,email:_0x3ee9bc,role:_0x42ccb8}=_0x9050f7['user'],_0x50ebb0=_0x9050f7[_0x480ee8(0x192)],_0x34104b=await profile[_0x480ee8(0xae)]({'email':_0x50ebb0[_0x480ee8(0x1a5)]}),_0x4fb3f5=await master_shop[_0x480ee8(0x95)]();let _0x368e00;if(_0x50ebb0[_0x480ee8(0xc7)]==_0x480ee8(0xb8)){const _0x404db7=await staff['findOne']({'email':_0x50ebb0[_0x480ee8(0x1a5)]});_0x368e00=await sales[_0x480ee8(0xc1)]([{'$lookup':{'from':'customers','localField':_0x480ee8(0x172),'foreignField':_0x480ee8(0x143),'as':_0x480ee8(0xea)}},{'$unwind':_0x480ee8(0xab)},{'$unwind':_0x480ee8(0xa7)},{'$group':{'_id':_0x480ee8(0x18b),'invoice':{'$first':'$invoice'},'customers':{'$first':_0x480ee8(0x19b)},'date':{'$first':_0x480ee8(0xba)},'warehouse_name':{'$first':'$warehouse_name'},'sale_product':{'$push':_0x480ee8(0xa7)},'note':{'$first':_0x480ee8(0xe0)},'return_data':{'$first':_0x480ee8(0x16f)},'customers_docs':{'$first':_0x480ee8(0xab)},'total_saleproduct_quantity':{'$sum':'$sale_product.quantity'},'level':{'$addToSet':_0x480ee8(0xc9)},'isle':{'$addToSet':_0x480ee8(0xf0)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':'$sale_product.floorlevel'},'finalize':{'$first':_0x480ee8(0x14b)},'isAllowEdit':{'$first':_0x480ee8(0x126)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x368e00=await sales[_0x480ee8(0xc1)]([{'$lookup':{'from':_0x480ee8(0x134),'localField':_0x480ee8(0x172),'foreignField':_0x480ee8(0x143),'as':_0x480ee8(0xea)}},{'$unwind':_0x480ee8(0xab)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x480ee8(0x18b),'invoice':{'$first':_0x480ee8(0x174)},'customers':{'$first':_0x480ee8(0x19b)},'date':{'$first':_0x480ee8(0xba)},'warehouse_name':{'$first':_0x480ee8(0xf7)},'sale_product':{'$push':_0x480ee8(0xa7)},'note':{'$first':_0x480ee8(0xe0)},'return_data':{'$first':_0x480ee8(0x16f)},'customers_docs':{'$first':_0x480ee8(0xab)},'total_saleproduct_quantity':{'$sum':_0x480ee8(0x155)},'level':{'$addToSet':'$sale_product.bay'},'isle':{'$addToSet':_0x480ee8(0xf0)},'type':{'$addToSet':_0x480ee8(0xff)},'pallet':{'$addToSet':_0x480ee8(0x1a3)},'finalize':{'$first':_0x480ee8(0x14b)},'isAllowEdit':{'$first':_0x480ee8(0x126)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x480ee8(0x101)](_0x480ee8(0xf6),_0x368e00);if(_0x4fb3f5[0x0][_0x480ee8(0x18e)]==_0x480ee8(0xa8)){var _0xa8f34f=users[_0x480ee8(0xe6)];console[_0x480ee8(0x101)](_0xa8f34f);}else{if(_0x4fb3f5[0x0]['language']==_0x480ee8(0x13c))var _0xa8f34f=users[_0x480ee8(0x13c)];else{if(_0x4fb3f5[0x0][_0x480ee8(0x18e)]=='German')var _0xa8f34f=users[_0x480ee8(0x100)];else{if(_0x4fb3f5[0x0][_0x480ee8(0x18e)]==_0x480ee8(0xce))var _0xa8f34f=users['Spanish'];else{if(_0x4fb3f5[0x0][_0x480ee8(0x18e)]==_0x480ee8(0x17a))var _0xa8f34f=users['French'];else{if(_0x4fb3f5[0x0]['language']=='Portuguese\x20(BR)')var _0xa8f34f=users[_0x480ee8(0x144)];else{if(_0x4fb3f5[0x0][_0x480ee8(0x18e)]=='Chinese')var _0xa8f34f=users['Chinese'];else{if(_0x4fb3f5[0x0]['language']==_0x480ee8(0x110))var _0xa8f34f=users['Arabic'];}}}}}}}_0x5a136d[_0x480ee8(0xaa)]('all_sales',{'success':_0x9050f7['flash'](_0x480ee8(0x183)),'errors':_0x9050f7[_0x480ee8(0xa2)]('errors'),'sales':_0x368e00,'profile':_0x34104b,'role':_0x50ebb0,'master_shop':_0x4fb3f5,'language':_0xa8f34f});}catch(_0x270053){console[_0x480ee8(0x101)](_0x270053);}});async function getRandom8DigitNumber(){var _0x51f135=a0_0x4abe0a;const _0x5a3f3c=0x989680,_0x145d87=0x5f5e0ff,_0xcbcd02=Math[_0x51f135(0x129)](Math[_0x51f135(0x99)]()*(_0x145d87-_0x5a3f3c+0x1))+_0x5a3f3c;var _0x1421b9;const _0x3e98e4=await sales[_0x51f135(0xae)]({'invoice':_0x51f135(0x111)+_0xcbcd02});return _0x3e98e4&&_0x3e98e4[_0x51f135(0x120)]>0x0?_0x1421b9='OUT-'+_0xcbcd02:_0x1421b9=_0x51f135(0x111)+_0xcbcd02,_0x1421b9;}function a0_0x541c(){var _0xbb2b09=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','get','random','push','getFullYear','primary_unit','$product_details.expiry_date','Arabic','$product_details.invoice','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.floorlevel','flash','message','currency','return_sale','primary_code','$sale_product','English\x20(US)','sales_invoice','render','$customers_docs','status','unit','findOne','actual_qty','max_per_unit','$product.product_name','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','catch','stocks','findById','<html><head><title></title>','staff','Receiving\x20Area','$date','<h5>','$product_details.primary_code','Floor','gmail','final','\x20</h2>','aggregate','error','stock_data','Sales\x20Update\x20successfully','$product_details.rack','site_title','role','secondary_code','$sale_product.bay','maxperunit','</td>','1457925nanMWY','196557dHIgGG','Spanish','expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','edit_sales_view','../public/language/languages.json','<table\x20style=\x22width:\x20100%\x20!important;\x22>','sale_qty','product_code','4USGfaK','date','sales_quantity','/upload/','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_name','Received\x20Payment\x20For\x20Sale','$product_details.unit','Return\x20Goods','$note','finalize','payment\x20successfull','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','redirect','English','return_data','slice','</span>','customers_docs','forEach','<span\x20style=\x22float:\x20right;\x22>','$product_details.level','$product_details.bay','Sale\x20Return','$sale_product.bin','False','getDate','batch_code','Level','</tbody>','sales\x20all_data','$warehouse_name','$product_details.actual_qty','errors','map','Error\x20Occurs','268196NqzlJp','all','createTransport','$sale_product.type','German','log','8qgYMJn','received_amount','813573VzEBtd','padStart','due_amount','stock','post','quantity_notConverted','$product_details.production_date','invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Sales\x20Add\x20successfully','prod_code','express','Arabic\x20(ae)','OUT-','actual_uom','master','params','../models/all_models','room','3aYfFPC','port','carton','5056290OJUkzN','sale_product','Chinese','id_transact','Sale\x20Return\x20Mail','logo','length','max','foreach\x20newproduct','/view/add_sales/:id','sales\x20item\x20return\x20successfull','Logo.png','$isAllowEdit','$name','back','floor','level','quantity','barcode\x20user_id','return_qty','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/preview/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','then','production_date','customers','</table>','</h5>','Portuguese\x20(BR)','/../public','Ambient','warehouse_name','Raw\x20Materials','Hindi','$product_details.maxPerUnit','/view/:id','<tr>','SCRN','/barcode_scanner','id_transaction_from','name','Portuguese','/barcode/:id','<h2>\x20','$product_details.isle','Email\x20sent\x20successfully','719610haIksT','_id','$finalize','<div>','RMSEmail','user_id','$product_details.secondary_unit','body','save','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$sale_product.quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','/all_sales/preview/','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.secondary_code','$product_details','currency_placement','room_name','$product_details.product_code','product_name','\x20Order\x20Date\x20:\x20','bin','$product_details.bin','storage','purchases_data','</tr>','$product_details._id','$product_details.product_stock','/view/add_sales','128530rcuHMz','getMonth','../middleware/auth','RoomAssigned','Shelves','floorlevel','product_details','$return_data','all_sales_barcode','barcode\x20Product\x20master','customer','sendMail','$invoice','string','image','prod_cat','types','An\x20error\x20occurred.','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/invoice/:id','product','/view/add_sale/product','/give_payment/:id','/all_sales/view','type','Return\x20Rooms','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_invoice','Sales\x20Mail','isAllowEdit','concat','customer_data','delivery_date','$_id','product_list','Enclosed','language','$product_details.batch_code','</div>','</head><body>','user','$product_details.storage','$product_details.type','abs','</body></html>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/view/return_sales/:id','split','warehouse','$customer','bay','Router','delivery_code','requested_qty','Enabled','add\x20post','secondary_unit','$sale_product.floorlevel','json','email','True','$room','$product_details.product_cat','<strong>\x20Regards\x20</strong>','</thead>','<tbody\x20style=\x22text-align:\x20center;\x22>','product_stock','find'];a0_0x541c=function(){return _0xbb2b09;};return a0_0x541c();}router[a0_0x4abe0a(0x98)](a0_0x4abe0a(0x167),auth,async(_0x505a1a,_0x1a7ec8)=>{var _0x54bee2=a0_0x4abe0a;try{const {username:_0x6c597f,email:_0x50aa75,role:_0x11c92b}=_0x505a1a[_0x54bee2(0x192)],_0x4dc057=_0x505a1a[_0x54bee2(0x192)],_0x6af596=await profile['findOne']({'email':_0x4dc057[_0x54bee2(0x1a5)]}),_0x534664=await master_shop['find'](),_0x40aa12=await customer[_0x54bee2(0x95)]({});let _0x5f4d11;if(_0x4dc057[_0x54bee2(0xc7)]=='staff'){const _0x25312=await staff[_0x54bee2(0xae)]({'email':_0x4dc057['email']});_0x5f4d11=await warehouse[_0x54bee2(0xc1)]([{'$match':{'status':_0x54bee2(0x1a0),'name':_0x25312[_0x54bee2(0x19a)],'warehouse_category':_0x54bee2(0x13b),'name':{'$ne':_0x54bee2(0xdf)}}},{'$group':{'_id':_0x54bee2(0x127),'name':{'$first':_0x54bee2(0x127)}}},{'$sort':{'name':0x1}}]);}else _0x5f4d11=await warehouse['aggregate']([{'$match':{'status':_0x54bee2(0x1a0),'warehouse_category':_0x54bee2(0x13b),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x54bee2(0x127),'name':{'$first':_0x54bee2(0x127)}}},{'$sort':{'name':0x1}}]);const _0x4b0bfb=await product[_0x54bee2(0x95)]({});var _0x41edce=[_0x54bee2(0x139),'Enclosed'];const _0x5afa91=await sales[_0x54bee2(0x95)]({}),_0x122beb=_0x5afa91[_0x54bee2(0x120)]+0x1,_0xfca9a1=_0x54bee2(0x111)+_0x122beb[_0x54bee2(0xe3)]()[_0x54bee2(0x105)](0x5,'0');if(_0x534664[0x0]['language']=='English\x20(US)'){var _0xd6b0d8=users['English'];console[_0x54bee2(0x101)](_0xd6b0d8);}else{if(_0x534664[0x0]['language']=='Hindi')var _0xd6b0d8=users[_0x54bee2(0x13c)];else{if(_0x534664[0x0][_0x54bee2(0x18e)]==_0x54bee2(0x100))var _0xd6b0d8=users[_0x54bee2(0x100)];else{if(_0x534664[0x0]['language']==_0x54bee2(0xce))var _0xd6b0d8=users[_0x54bee2(0xce)];else{if(_0x534664[0x0][_0x54bee2(0x18e)]==_0x54bee2(0x17a))var _0xd6b0d8=users[_0x54bee2(0x17a)];else{if(_0x534664[0x0][_0x54bee2(0x18e)]==_0x54bee2(0x137))var _0xd6b0d8=users[_0x54bee2(0x144)];else{if(_0x534664[0x0]['language']==_0x54bee2(0x11c))var _0xd6b0d8=users['Chinese'];else{if(_0x534664[0x0]['language']==_0x54bee2(0x110))var _0xd6b0d8=users[_0x54bee2(0x9e)];}}}}}}}const _0x28015c=getRandom8DigitNumber();_0x28015c['then'](_0x30eef3=>{var _0x334464=_0x54bee2;_0x1a7ec8[_0x334464(0xaa)]('add_sales',{'success':_0x505a1a['flash'](_0x334464(0x183)),'errors':_0x505a1a['flash']('errors'),'role':_0x4dc057,'profile':_0x6af596,'customer':_0x40aa12,'warehouse':_0x5f4d11,'product':_0x4b0bfb,'invoice':_0x30eef3,'master_shop':_0x534664,'language':_0xd6b0d8,'rooms_data':_0x41edce});})[_0x54bee2(0xb4)](_0x1f178d=>{var _0x16202f=_0x54bee2;_0x505a1a[_0x16202f(0xa2)]('errors',_0x16202f(0x158)),_0x1a7ec8['redirect'](_0x16202f(0x180));});}catch(_0xed8176){console['log'](_0xed8176);}}),router[a0_0x4abe0a(0x98)](a0_0x4abe0a(0x123),auth,async(_0xd34c1c,_0x36720f)=>{var _0x580817=a0_0x4abe0a;try{const _0x28dc6a=_0xd34c1c[_0x580817(0x114)]['id'];console[_0x580817(0x101)](_0x28dc6a);const _0x3396d3=await product[_0x580817(0x95)](),_0x2b6b7=await purchases[_0x580817(0xc1)]([{'$match':{'warehouse_name':_0x28dc6a}},{'$unwind':'$product'},{'$group':{'_id':_0x580817(0xb1)}}]);console[_0x580817(0x101)](_0x580817(0x163),_0x2b6b7),_0x36720f['status'](0xc8)[_0x580817(0x1a4)]({'purchases_data':_0x2b6b7,'product_data':_0x3396d3});}catch(_0x2a9999){console['log'](_0x2a9999);}}),router[a0_0x4abe0a(0x108)](a0_0x4abe0a(0x17e),auth,async(_0x5010c3,_0x2d2731)=>{var _0x3eab80=a0_0x4abe0a;try{const {warehouse_data:_0x5dc9ab,product_data:_0xd01a3a}=_0x5010c3[_0x3eab80(0x150)];console['log'](_0x5010c3[_0x3eab80(0x150)]['product_data']);;const _0x4070aa=await master_shop[_0x3eab80(0x95)]();console[_0x3eab80(0x101)](_0x3eab80(0x113),_0x4070aa);const _0x475a3c=await product[_0x3eab80(0xae)]({'name':_0xd01a3a});console['log'](_0x3eab80(0x17d),_0x475a3c);const _0x47e433=await warehouse[_0x3eab80(0xc1)]([{'$match':{'name':_0x5dc9ab}},{'$unwind':_0x3eab80(0x15a)},{'$match':{'product_details.product_name':_0xd01a3a}},{'$group':{'_id':'$product_details.product_name','product_stock':{'$first':'$product_details.product_stock'}}}]);console['log']('stock_data',_0x47e433),_0x2d2731[_0x3eab80(0xac)](0xc8)[_0x3eab80(0x1a4)]({'master':_0x4070aa,'new_product':_0x475a3c,'stock_data':_0x47e433});}catch(_0x3977bf){console[_0x3eab80(0x101)](_0x3977bf);}}),router[a0_0x4abe0a(0x108)](a0_0x4abe0a(0x167),auth,async(_0x5e7947,_0x5adf04)=>{var _0x44ff1f=a0_0x4abe0a;try{const {invoice:_0x54ff81,date:_0x61825c,warehouse_name:_0x2987f7,product_name:_0x3d4813,stock:_0x59c991,quantity:_0x5ef502,note:_0x1891a8,room:_0x21cdae,primary_code:_0x4c7d6d,secondary_code:_0x2e192b,prod_code:_0x56fc1c,level:_0x10d962,isle:_0x11a703,pallet:_0x31ef8f,batch_code:_0x303db8,SCRN:_0x7f3a1,expiry_date:_0x3f7a01}=_0x5e7947[_0x44ff1f(0x150)];if(typeof _0x3d4813==_0x44ff1f(0x175))var _0x553029=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x15e)]],_0x3e36be=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x107)]],_0x738cde=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x119)]],_0x2d93c2=[_0x5e7947['body']['primary_code']],_0x478bb0=[_0x5e7947[_0x44ff1f(0x150)]['secondary_code']],_0x516032=[_0x5e7947[_0x44ff1f(0x150)]['prod_code']],_0x289eb3=[_0x5e7947[_0x44ff1f(0x150)]['level']],_0x1668a3=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x9c)]],_0x3d6de5=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x1a2)]],_0x28192e=[_0x5e7947['body'][_0x44ff1f(0xf3)]],_0x5a1ba6=[_0x5e7947['body'][_0x44ff1f(0xcf)]],_0x158d68=[_0x5e7947[_0x44ff1f(0x150)]['max_per_unit']],_0x427b5d=[_0x5e7947['body']['production_date']],_0x54d403=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x19f)]],_0x514579=[_0x5e7947['body']['delivery_date']],_0x136718=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x19e)]],_0x89984c=[_0x5e7947['body']['prod_cat']],_0x4efb1f=[_0x5e7947['body'][_0x44ff1f(0x12b)]],_0x4986fb=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x16b)]],_0x1f43b2=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x185)]],_0x733ab=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0xaf)]],_0x405f22=[_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x112)]],_0x3e1d65=[_0x5e7947['body'][_0x44ff1f(0x11d)]];else var _0x553029=[..._0x5e7947['body']['product_name']],_0x3e36be=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x107)]],_0x738cde=[..._0x5e7947['body'][_0x44ff1f(0x119)]],_0x2d93c2=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0xa6)]],_0x478bb0=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0xc8)]],_0x516032=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x10e)]],_0x289eb3=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x12a)]],_0x1668a3=[..._0x5e7947[_0x44ff1f(0x150)]['primary_unit']],_0x3d6de5=[..._0x5e7947[_0x44ff1f(0x150)]['secondary_unit']],_0x28192e=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0xf3)]],_0x5a1ba6=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0xcf)]],_0x158d68=[..._0x5e7947['body'][_0x44ff1f(0xb0)]],_0x427b5d=[..._0x5e7947[_0x44ff1f(0x150)]['production_date']],_0x54d403=[..._0x5e7947['body'][_0x44ff1f(0x19f)]],_0x514579=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x18a)]],_0x136718=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x19e)]],_0x89984c=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x177)]],_0x4efb1f=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x12b)]],_0x4986fb=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x16b)]],_0x1f43b2=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x185)]],_0x733ab=[..._0x5e7947['body']['actual_qty']],_0x405f22=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x112)]],_0x3e1d65=[..._0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x11d)]];const _0x17563d=_0x553029[_0x44ff1f(0xfa)](_0xbcae53=>{return _0xbcae53={'product_name':_0xbcae53};});_0x3e36be[_0x44ff1f(0xeb)]((_0x1c3e78,_0xc1bb66)=>{var _0x3ffb20=_0x44ff1f;_0x17563d[_0xc1bb66][_0x3ffb20(0x107)]=Math['abs'](_0x1c3e78);}),_0x733ab[_0x44ff1f(0xeb)]((_0x468147,_0x3d7034)=>{_0x17563d[_0x3d7034]['actual_qty']=Math['abs'](_0x468147);}),_0x405f22[_0x44ff1f(0xeb)]((_0x6d912f,_0x58c62c)=>{var _0x40cb56=_0x44ff1f;_0x17563d[_0x58c62c][_0x40cb56(0x112)]=_0x6d912f;}),_0x3e1d65['forEach']((_0x1cfb99,_0x29b3fa)=>{var _0x1e7d52=_0x44ff1f;_0x17563d[_0x29b3fa][_0x1e7d52(0x142)]=_0x1cfb99;}),_0x738cde[_0x44ff1f(0xeb)]((_0x396186,_0x435331)=>{_0x17563d[_0x435331]['quantity']=_0x396186;}),_0x2d93c2[_0x44ff1f(0xeb)]((_0x890c48,_0x54b149)=>{var _0x52f604=_0x44ff1f;_0x17563d[_0x54b149][_0x52f604(0xa6)]=_0x890c48;}),_0x478bb0[_0x44ff1f(0xeb)]((_0x2bf07b,_0x47c763)=>{var _0x1dbdd7=_0x44ff1f;_0x17563d[_0x47c763][_0x1dbdd7(0xc8)]=_0x2bf07b;}),_0x516032[_0x44ff1f(0xeb)]((_0x1d98fc,_0x1adcd4)=>{var _0x4cf562=_0x44ff1f;_0x17563d[_0x1adcd4][_0x4cf562(0xd5)]=_0x1d98fc;}),_0x289eb3[_0x44ff1f(0xeb)]((_0x598a04,_0xc83aac)=>{_0x4986fb['forEach']((_0x31d927,_0x3dba73)=>{var _0x56b7cd=a0_0x1f46;if(_0x31d927==_0x56b7cd(0xb9)&&_0xc83aac==_0x3dba73){var _0x1b625c=_0x598a04[_0x56b7cd(0xe8)](0x3);_0x17563d[_0xc83aac]['storage']=_0x598a04[0x0],_0x17563d[_0xc83aac][_0x56b7cd(0xb2)]=_0x598a04[0x1],_0x17563d[_0xc83aac][_0x56b7cd(0x19c)]=0x0,_0x17563d[_0xc83aac]['bin']=0x0,_0x17563d[_0xc83aac][_0x56b7cd(0x181)]='Floor',_0x17563d[_0xc83aac][_0x56b7cd(0x16d)]=_0x1b625c;}else{if(_0x31d927==_0x56b7cd(0x16c)&&_0xc83aac==_0x3dba73){var _0x1b625c=_0x598a04[_0x56b7cd(0xe8)](0x3);_0x17563d[_0xc83aac][_0x56b7cd(0x162)]=_0x598a04[0x0],_0x17563d[_0xc83aac][_0x56b7cd(0xb2)]=_0x598a04[0x1],_0x17563d[_0xc83aac][_0x56b7cd(0x19c)]=0x0,_0x17563d[_0xc83aac][_0x56b7cd(0x160)]=0x0,_0x17563d[_0xc83aac]['type']=_0x56b7cd(0xbd),_0x17563d[_0xc83aac][_0x56b7cd(0x16d)]=_0x598a04[0x5];}else{if(_0xc83aac==_0x3dba73){var _0x127d27;if(_0x598a04[0x4]=='L')_0x127d27='Level';else _0x598a04[0x4]=='F'&&(_0x127d27=_0x56b7cd(0xbd));_0x17563d[_0xc83aac]['storage']=_0x598a04[0x0],_0x17563d[_0xc83aac][_0x56b7cd(0xb2)]=_0x598a04[0x1],_0x17563d[_0xc83aac][_0x56b7cd(0x19c)]=_0x598a04[0x2],_0x17563d[_0xc83aac][_0x56b7cd(0x160)]=_0x598a04[0x3],_0x17563d[_0xc83aac][_0x56b7cd(0x181)]=_0x127d27,_0x17563d[_0xc83aac][_0x56b7cd(0x16d)]=_0x598a04[0x5];}}}});}),_0x1668a3[_0x44ff1f(0xeb)]((_0x27d81a,_0x5bc064)=>{var _0x47c60d=_0x44ff1f;_0x17563d[_0x5bc064][_0x47c60d(0xad)]=_0x27d81a;}),_0x3d6de5['forEach']((_0x2708b9,_0x2824e4)=>{var _0xe73764=_0x44ff1f;_0x17563d[_0x2824e4][_0xe73764(0x1a2)]=_0x2708b9;}),_0x28192e['forEach']((_0x5da8c7,_0x54d521)=>{var _0x17cdf3=_0x44ff1f;_0x17563d[_0x54d521][_0x17cdf3(0xf3)]=_0x5da8c7;}),_0x5a1ba6['forEach']((_0x1bb641,_0x2ea0c8)=>{var _0x1533a1=_0x44ff1f;_0x17563d[_0x2ea0c8][_0x1533a1(0xcf)]=_0x1bb641;}),_0x158d68[_0x44ff1f(0xeb)]((_0x4528bd,_0x472b07)=>{var _0x23d601=_0x44ff1f;_0x17563d[_0x472b07][_0x23d601(0xca)]=_0x4528bd;}),_0x427b5d[_0x44ff1f(0xeb)]((_0x58bb2f,_0x46f8cf)=>{var _0x3733ca=_0x44ff1f;_0x17563d[_0x46f8cf][_0x3733ca(0x133)]=_0x58bb2f;}),_0x54d403[_0x44ff1f(0xeb)]((_0x51685a,_0x3bdb22)=>{var _0x2810e5=_0x44ff1f;_0x17563d[_0x3bdb22][_0x2810e5(0x19f)]=_0x51685a;}),_0x514579['forEach']((_0x2b11be,_0x4d5c16)=>{var _0x276ec3=_0x44ff1f;_0x17563d[_0x4d5c16][_0x276ec3(0x18a)]=_0x2b11be;}),_0x136718['forEach']((_0x1c960c,_0x2290e0)=>{var _0x4c9869=_0x44ff1f;_0x17563d[_0x2290e0][_0x4c9869(0x19e)]=_0x1c960c;}),_0x89984c[_0x44ff1f(0xeb)]((_0x46b3c5,_0x44c5f2)=>{var _0x28cc04=_0x44ff1f;_0x17563d[_0x44c5f2][_0x28cc04(0x177)]=_0x46b3c5;}),_0x4efb1f[_0x44ff1f(0xeb)]((_0x513609,_0x3e3f27)=>{var _0x19712a=_0x44ff1f;_0x17563d[_0x3e3f27][_0x19712a(0x109)]=_0x513609;}),_0x4986fb['forEach']((_0xaa0fd9,_0x1b59c9)=>{var _0x2edc45=_0x44ff1f;_0x17563d[_0x1b59c9][_0x2edc45(0x15c)]=_0xaa0fd9;}),_0x1f43b2[_0x44ff1f(0xeb)]((_0x4b9488,_0x35c1d2)=>{var _0x3a7f03=_0x44ff1f;_0x17563d[_0x35c1d2][_0x3a7f03(0x10b)]=_0x4b9488;});var _0x230fd4=0x0;_0x17563d['forEach'](_0x12f804=>{var _0x43456d=_0x44ff1f;(_0x12f804[_0x43456d(0x107)]<_0x12f804[_0x43456d(0x109)]||_0x12f804['quantity_notConverted']==0x0)&&(console[_0x43456d(0x101)](_0x43456d(0x122),_0x12f804),_0x230fd4++);});const _0x5cdc3d=_0x17563d[_0x44ff1f(0x12e)](_0x2fae93=>_0x2fae93[_0x44ff1f(0x12b)]!=='0'&&_0x2fae93[_0x44ff1f(0x12b)]!==''),_0x38fae5=new sales({'invoice':_0x54ff81,'customer':_0x5e7947[_0x44ff1f(0x150)][_0x44ff1f(0x172)],'date':_0x61825c,'warehouse_name':_0x2987f7,'sale_product':_0x5cdc3d,'note':_0x1891a8,'room':_0x21cdae,'primary_code':_0x4c7d6d,'secondary_code':_0x2e192b,'prod_code':_0x56fc1c,'SCRN':_0x7f3a1}),_0x206726=await _0x38fae5[_0x44ff1f(0x151)]();_0x5e7947['flash']('success',_0x44ff1f(0x10d)),_0x5adf04[_0x44ff1f(0xe5)](_0x44ff1f(0x157)+_0x206726[_0x44ff1f(0x14a)]);}catch(_0x5cd301){console['log'](_0x5cd301);}}),router[a0_0x4abe0a(0x98)]('/preview/:id',auth,async(_0x2e2fb2,_0x4455a7)=>{var _0x16c699=a0_0x4abe0a;try{const {username:_0x4c5a63,email:_0xa8a6d6,role:_0x7f3519}=_0x2e2fb2['user'],_0xbc535=_0x2e2fb2[_0x16c699(0x192)],_0x5110c2=await profile['findOne']({'email':_0xbc535['email']}),_0x122cf5=await master_shop[_0x16c699(0x95)](),_0x5c131d=_0x2e2fb2[_0x16c699(0x114)]['id'],_0x36000b=await sales['findById'](_0x5c131d),_0x326440=await warehouse[_0x16c699(0xc1)]([{'$match':{'name':_0x36000b['warehouse_name']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x16c699(0x165),'name':{'$first':_0x16c699(0xdc)},'product_stock':{'$first':_0x16c699(0x166)},'bay':{'$first':_0x16c699(0xee)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x16c699(0x194)},'floorlevel':{'$first':_0x16c699(0xa1)},'primary_code':{'$first':_0x16c699(0xbc)},'secondary_code':{'$first':_0x16c699(0x159)},'product_code':{'$first':_0x16c699(0x15d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x16c699(0xc5)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x16c699(0x10a)},'invoice':{'$first':_0x16c699(0x9f)}}}]),_0x5f1003=await customer[_0x16c699(0x95)]({});let _0x23cf47;if(_0xbc535[_0x16c699(0xc7)]=='staff'){const _0x5dfc59=await staff[_0x16c699(0xae)]({'email':_0xbc535['email']});_0x23cf47=await warehouse[_0x16c699(0xc1)]([{'$match':{'status':_0x16c699(0x1a0),'name':_0x5dfc59[_0x16c699(0x19a)]}},{'$group':{'_id':'$name','name':{'$first':_0x16c699(0x127)}}}]);}else _0x23cf47=await warehouse[_0x16c699(0xc1)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x16c699(0x127),'name':{'$first':_0x16c699(0x127)}}}]);const _0x483514=await product[_0x16c699(0x95)]({}),_0x227b7e=await suppliers['find']({});if(_0x122cf5[0x0][_0x16c699(0x18e)]==_0x16c699(0xa8)){var _0x287557=users[_0x16c699(0xe6)];console[_0x16c699(0x101)](_0x287557);}else{if(_0x122cf5[0x0][_0x16c699(0x18e)]==_0x16c699(0x13c))var _0x287557=users[_0x16c699(0x13c)];else{if(_0x122cf5[0x0][_0x16c699(0x18e)]==_0x16c699(0x100))var _0x287557=users[_0x16c699(0x100)];else{if(_0x122cf5[0x0]['language']==_0x16c699(0xce))var _0x287557=users[_0x16c699(0xce)];else{if(_0x122cf5[0x0][_0x16c699(0x18e)]==_0x16c699(0x17a))var _0x287557=users[_0x16c699(0x17a)];else{if(_0x122cf5[0x0]['language']==_0x16c699(0x137))var _0x287557=users[_0x16c699(0x144)];else{if(_0x122cf5[0x0]['language']==_0x16c699(0x11c))var _0x287557=users[_0x16c699(0x11c)];else{if(_0x122cf5[0x0]['language']==_0x16c699(0x110))var _0x287557=users['Arabic'];}}}}}}}_0x4455a7[_0x16c699(0xaa)](_0x16c699(0xd1),{'success':_0x2e2fb2[_0x16c699(0xa2)](_0x16c699(0x183)),'errors':_0x2e2fb2['flash'](_0x16c699(0xf9)),'role':_0xbc535,'profile':_0x5110c2,'customer':_0x5f1003,'warehouse':_0x23cf47,'product':_0x326440,'user':_0x36000b,'master_shop':_0x122cf5,'unit':_0x483514,'language':_0x287557,'suppliers':_0x227b7e});}catch(_0x975f3){console[_0x16c699(0x101)](_0x975f3);}}),router[a0_0x4abe0a(0x108)](a0_0x4abe0a(0x130),auth,async(_0x449dca,_0x371cf3)=>{var _0x3310ff=a0_0x4abe0a;try{const _0x3533a1=_0x449dca[_0x3310ff(0x114)]['id'],{invoice:_0x20df63,warehouse_name:_0x52b55a,room:_0x21a699}=_0x449dca[_0x3310ff(0x150)],_0x71cde1=await sales['findOne']({'invoice':_0x20df63}),_0x3a4963=_0x71cde1['sale_product']['map'](async _0x8e9439=>{var _0x5ab744=_0x3310ff,_0x3cd381=await warehouse[_0x5ab744(0xae)]({'name':_0x52b55a,'room':_0x8e9439['room_name'],'warehouse_category':_0x5ab744(0x13b)});const _0x18faed=_0x3cd381[_0x5ab744(0x16e)][_0x5ab744(0xfa)](_0x135988=>{var _0x52a095=_0x5ab744;_0x135988[_0x52a095(0x15e)]==_0x8e9439[_0x52a095(0x15e)]&&_0x135988['floorlevel']==_0x8e9439[_0x52a095(0x16d)]&&_0x135988['type']==_0x8e9439[_0x52a095(0x181)]&&_0x135988['bin']==_0x8e9439[_0x52a095(0x160)]&&_0x135988[_0x52a095(0x19c)]==_0x8e9439[_0x52a095(0x19c)]&&_0x135988[_0x52a095(0xb2)]==_0x8e9439['rack']&&_0x135988[_0x52a095(0x162)]==_0x8e9439[_0x52a095(0x162)]&&_0x135988[_0x52a095(0xcf)]==_0x8e9439[_0x52a095(0xcf)]&&_0x135988['batch_code']==_0x8e9439[_0x52a095(0xf3)]&&_0x135988[_0x52a095(0x10b)]==_0x8e9439[_0x52a095(0x10b)]&&_0x135988[_0x52a095(0x14a)]==_0x8e9439[_0x52a095(0x142)]&&(_0x135988[_0x52a095(0x94)]=Math[_0x52a095(0x121)](0x0,Math[_0x52a095(0x195)](_0x135988[_0x52a095(0x94)])-Math[_0x52a095(0x195)](_0x8e9439['quantity'])));});return _0x3cd381;});Promise[_0x3310ff(0xfd)](_0x3a4963)[_0x3310ff(0x132)](async _0x3e51eb=>{var _0x13f2f8=_0x3310ff;try{for(const _0x3adfc3 of _0x3e51eb){await _0x3adfc3[_0x13f2f8(0x151)]();}_0x71cde1[_0x13f2f8(0xe1)]='True';const _0x45aab6=await _0x71cde1['save'](),_0x151c9c=await master_shop[_0x13f2f8(0x95)](),_0x327337=await email_settings['findOne'](),_0x2dc9bc=await supervisor_settings['find']();var _0x330367=_0x71cde1['sale_product'],_0x49d8d6='',_0x4086e5;for(_0x4086e5 in _0x330367){_0x49d8d6+=_0x13f2f8(0x13f)+_0x13f2f8(0x152)+_0x330367[_0x4086e5][_0x13f2f8(0x15e)]+_0x13f2f8(0xcb)+_0x13f2f8(0x152)+_0x330367[_0x4086e5][_0x13f2f8(0xd5)]+_0x13f2f8(0xcb)+_0x13f2f8(0x152)+_0x330367[_0x4086e5][_0x13f2f8(0x12b)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x330367[_0x4086e5][_0x13f2f8(0xad)]+_0x13f2f8(0xcb)+_0x13f2f8(0x152)+_0x330367[_0x4086e5][_0x13f2f8(0x1a2)]+_0x13f2f8(0xcb)+_0x13f2f8(0x152)+_0x71cde1['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x330367[_0x4086e5][_0x13f2f8(0x15c)]+'</td>'+_0x13f2f8(0x152)+_0x330367[_0x4086e5][_0x13f2f8(0x162)]+_0x330367[_0x4086e5][_0x13f2f8(0xb2)]+_0x330367[_0x4086e5]['bay']+_0x330367[_0x4086e5]['bin']+_0x330367[_0x4086e5][_0x13f2f8(0x181)][0x0]+_0x330367[_0x4086e5]['floorlevel']+_0x13f2f8(0xcb),'</tr>';}let _0x328794=nodemailer['createTransport']({'host':_0x327337['host'],'port':Number(_0x327337[_0x13f2f8(0x118)]),'secure':![],'auth':{'user':_0x327337[_0x13f2f8(0x1a5)],'pass':_0x327337['password']}}),_0x5c80ad={'from':_0x327337[_0x13f2f8(0x1a5)],'to':_0x2dc9bc[0x0][_0x13f2f8(0x14d)],'subject':_0x13f2f8(0x186),'attachments':[{'filename':'Logo.png','path':__dirname+_0x13f2f8(0x138)+_0x13f2f8(0xd9)+_0x151c9c[0x0][_0x13f2f8(0x176)],'cid':_0x13f2f8(0x11f)}],'html':_0x13f2f8(0xda)+_0x13f2f8(0xb7)+_0x13f2f8(0x191)+_0x13f2f8(0x14c)+_0x13f2f8(0x131)+_0x13f2f8(0x14c)+_0x13f2f8(0x10c)+_0x13f2f8(0x190)+_0x13f2f8(0x14c)+_0x13f2f8(0x146)+_0x151c9c[0x0]['site_title']+_0x13f2f8(0xc0)+_0x13f2f8(0x190)+_0x13f2f8(0x190)+'<hr\x20class=\x22my-3\x22>'+_0x13f2f8(0x14c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x71cde1[_0x13f2f8(0x10b)]+'\x20'+_0x13f2f8(0xec)+_0x13f2f8(0x15f)+_0x71cde1[_0x13f2f8(0xd7)]+'\x20'+_0x13f2f8(0xe9)+_0x13f2f8(0x136)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x13f2f8(0x197)+_0x13f2f8(0x13f)+_0x13f2f8(0x154)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x13f2f8(0x17b)+_0x13f2f8(0xb3)+_0x13f2f8(0x97)+_0x13f2f8(0x12f)+_0x13f2f8(0xe4)+_0x13f2f8(0x96)+_0x13f2f8(0x164)+_0x13f2f8(0x92)+_0x13f2f8(0x93)+'\x20'+_0x49d8d6+'\x20'+_0x13f2f8(0xf5)+_0x13f2f8(0x135)+_0x13f2f8(0x14c)+'<strong>\x20Regards\x20</strong>'+_0x13f2f8(0xbb)+_0x151c9c[0x0][_0x13f2f8(0xc6)]+_0x13f2f8(0x136)+_0x13f2f8(0x190)+_0x13f2f8(0x190)+_0x13f2f8(0x196)};_0x328794[_0x13f2f8(0x173)](_0x5c80ad,function(_0x82818,_0x2d147){var _0x27d92c=_0x13f2f8;_0x82818?(console[_0x27d92c(0x101)](_0x82818),console[_0x27d92c(0x101)](_0x27d92c(0xfb))):console[_0x27d92c(0x101)](_0x27d92c(0x148));}),_0x449dca[_0x13f2f8(0xa2)](_0x13f2f8(0x183),'Sales\x20Update\x20successfully'),_0x371cf3['redirect'](_0x13f2f8(0x157)+_0x3533a1);}catch(_0x2e4aed){console[_0x13f2f8(0xc2)](_0x2e4aed),_0x371cf3[_0x13f2f8(0xac)](0x1f4)[_0x13f2f8(0x1a4)]({'error':_0x13f2f8(0xd0)});}})[_0x3310ff(0xb4)](_0x5717d6=>{var _0x407825=_0x3310ff;console['error'](_0x5717d6),_0x371cf3[_0x407825(0xac)](0x1f4)[_0x407825(0x1a4)]({'error':_0x407825(0x179)});});}catch(_0x1c2c0d){console[_0x3310ff(0x101)](_0x1c2c0d);}}),router[a0_0x4abe0a(0x98)](a0_0x4abe0a(0x13e),auth,async(_0x29a9ac,_0x31251d)=>{var _0x6a7336=a0_0x4abe0a;try{const {username:_0x48ad55,email:_0x596e25,role:_0x1ca6dc}=_0x29a9ac['user'],_0x3db7b8=_0x29a9ac[_0x6a7336(0x192)],_0x1646a0=await profile[_0x6a7336(0xae)]({'email':_0x3db7b8[_0x6a7336(0x1a5)]}),_0x4e0b52=await master_shop[_0x6a7336(0x95)](),_0x3a60a0=_0x29a9ac['params']['id'],_0x423bbb=await sales[_0x6a7336(0xb6)](_0x3a60a0);var _0x28adca=[_0x6a7336(0x139),_0x6a7336(0x18d)];const _0x201c6f=await warehouse['aggregate']([{'$match':{'name':_0x423bbb[_0x6a7336(0x13a)],'warehouse_category':_0x6a7336(0x13b)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x6a7336(0xdc)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x6a7336(0xee)},'bin':{'$first':_0x6a7336(0x161)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x6a7336(0xa1)},'primary_code':{'$first':_0x6a7336(0xbc)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x6a7336(0xc5)}}}]),_0x2fd5d3=await customer['find']({});let _0xab8187;if(_0x3db7b8[_0x6a7336(0xc7)]==_0x6a7336(0xb8)){const _0x473620=await staff[_0x6a7336(0xae)]({'email':_0x3db7b8[_0x6a7336(0x1a5)]});_0xab8187=await warehouse[_0x6a7336(0xc1)]([{'$match':{'status':_0x6a7336(0x1a0),'name':_0x473620[_0x6a7336(0x19a)],'warehouse_category':_0x6a7336(0x13b)}},{'$group':{'_id':_0x6a7336(0x127),'name':{'$first':_0x6a7336(0x127)}}}]);}else _0xab8187=await warehouse['aggregate']([{'$match':{'status':_0x6a7336(0x1a0),'warehouse_category':_0x6a7336(0x13b)}},{'$group':{'_id':_0x6a7336(0x127),'name':{'$first':'$name'}}}]);const _0x4eacdb=await product[_0x6a7336(0x95)]({});if(_0x4e0b52[0x0][_0x6a7336(0x18e)]==_0x6a7336(0xa8)){var _0x464f2d=users[_0x6a7336(0xe6)];console[_0x6a7336(0x101)](_0x464f2d);}else{if(_0x4e0b52[0x0]['language']==_0x6a7336(0x13c))var _0x464f2d=users[_0x6a7336(0x13c)];else{if(_0x4e0b52[0x0][_0x6a7336(0x18e)]==_0x6a7336(0x100))var _0x464f2d=users[_0x6a7336(0x100)];else{if(_0x4e0b52[0x0][_0x6a7336(0x18e)]==_0x6a7336(0xce))var _0x464f2d=users['Spanish'];else{if(_0x4e0b52[0x0][_0x6a7336(0x18e)]==_0x6a7336(0x17a))var _0x464f2d=users['French'];else{if(_0x4e0b52[0x0][_0x6a7336(0x18e)]=='Portuguese\x20(BR)')var _0x464f2d=users[_0x6a7336(0x144)];else{if(_0x4e0b52[0x0]['language']==_0x6a7336(0x11c))var _0x464f2d=users[_0x6a7336(0x11c)];else{if(_0x4e0b52[0x0]['language']==_0x6a7336(0x110))var _0x464f2d=users['Arabic'];}}}}}}}_0x31251d[_0x6a7336(0xaa)]('edit_sales',{'success':_0x29a9ac[_0x6a7336(0xa2)]('success'),'errors':_0x29a9ac[_0x6a7336(0xa2)]('errors'),'role':_0x3db7b8,'profile':_0x1646a0,'customer':_0x2fd5d3,'warehouse':_0xab8187,'product':_0x201c6f,'user':_0x423bbb,'master_shop':_0x4e0b52,'unit':_0x4eacdb,'language':_0x464f2d});}catch(_0xcf9308){console[_0x6a7336(0x101)](_0xcf9308);}}),router[a0_0x4abe0a(0x108)](a0_0x4abe0a(0x13e),auth,async(_0x3d0897,_0xa43698)=>{var _0x32e380=a0_0x4abe0a;try{const _0x2f5ba5=_0x3d0897[_0x32e380(0x114)]['id'],_0xbd409c=await sales[_0x32e380(0xae)]({'_id':_0x3d0897['params']['id']}),_0x42e8a8=await warehouse[_0x32e380(0xae)]({'name':_0xbd409c['warehouse_name'],'room':_0x3d0897[_0x32e380(0x150)][_0x32e380(0x116)]}),{invoice:_0x232ef3,date:_0x22b0a3,warehouse_name:_0x20090a,product_name:_0x3707e5,stock:_0x13e21b,quantity:_0x1b880f,note:_0x2bc298,room:_0x5db483,customer:_0x7036d8,SCRN:_0x2c1006}=_0x3d0897['body'];if(typeof _0x3707e5=='string')var _0x517673=[_0x3d0897['body'][_0x32e380(0x15e)]],_0x2dc393=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0x107)]],_0x52e014=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0x119)]],_0x216d3e=[_0x3d0897[_0x32e380(0x150)]['primary_code']],_0x4410bd=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0xc8)]],_0x5633f8=[_0x3d0897['body'][_0x32e380(0x10e)]],_0x1d49cb=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0x12a)]],_0x175f8a=[_0x3d0897[_0x32e380(0x150)]['primary_unit']],_0x40e31b=[_0x3d0897['body'][_0x32e380(0x1a2)]],_0x182ce9=[_0x3d0897['body'][_0x32e380(0xf3)]],_0x9ae70a=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0xcf)]],_0x4e01be=[_0x3d0897[_0x32e380(0x150)]['max_per_unit']],_0xa703cc=[_0x3d0897['body'][_0x32e380(0x133)]],_0x2b0e12=[_0x3d0897['body'][_0x32e380(0x19f)]],_0x16e1bd=[_0x3d0897[_0x32e380(0x150)]['delivery_date']],_0x2a1a83=[_0x3d0897['body']['delivery_code']],_0x5a3784=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0x177)]],_0x2df7dd=[_0x3d0897[_0x32e380(0x150)][_0x32e380(0x12b)]],_0x40935e=[_0x3d0897[_0x32e380(0x150)]['RoomAssigned']];else var _0x517673=[..._0x3d0897[_0x32e380(0x150)]['product_name']],_0x2dc393=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x107)]],_0x52e014=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x119)]],_0x216d3e=[..._0x3d0897[_0x32e380(0x150)]['primary_code']],_0x4410bd=[..._0x3d0897[_0x32e380(0x150)]['secondary_code']],_0x5633f8=[..._0x3d0897[_0x32e380(0x150)]['prod_code']],_0x1d49cb=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x12a)]],_0x175f8a=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x9c)]],_0x40e31b=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x1a2)]],_0x182ce9=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0xf3)]],_0x9ae70a=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0xcf)]],_0x4e01be=[..._0x3d0897['body'][_0x32e380(0xb0)]],_0xa703cc=[..._0x3d0897[_0x32e380(0x150)]['production_date']],_0x2b0e12=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x19f)]],_0x16e1bd=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x18a)]],_0x2a1a83=[..._0x3d0897['body'][_0x32e380(0x19e)]],_0x5a3784=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x177)]],_0x2df7dd=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x12b)]],_0x40935e=[..._0x3d0897[_0x32e380(0x150)][_0x32e380(0x16b)]];const _0x765f8e=_0x517673[_0x32e380(0xfa)](_0x2eba18=>{return _0x2eba18={'product_name':_0x2eba18};});_0x2dc393['forEach']((_0x2ffb8f,_0xa08dd3)=>{var _0x3ac0be=_0x32e380;_0x765f8e[_0xa08dd3][_0x3ac0be(0x107)]=Math[_0x3ac0be(0x195)](_0x2ffb8f);}),_0x52e014[_0x32e380(0xeb)]((_0x4c3a1e,_0x132319)=>{var _0x2d7672=_0x32e380;_0x765f8e[_0x132319][_0x2d7672(0x12b)]=_0x4c3a1e;}),_0x216d3e[_0x32e380(0xeb)]((_0x51fe35,_0x2ea25e)=>{var _0x35b5fa=_0x32e380;_0x765f8e[_0x2ea25e][_0x35b5fa(0xa6)]=_0x51fe35;}),_0x4410bd[_0x32e380(0xeb)]((_0x41bb98,_0x6ce6a5)=>{var _0x3c5aa6=_0x32e380;_0x765f8e[_0x6ce6a5][_0x3c5aa6(0xc8)]=_0x41bb98;}),_0x5633f8[_0x32e380(0xeb)]((_0x5973b2,_0x29c105)=>{_0x765f8e[_0x29c105]['product_code']=_0x5973b2;}),_0x1d49cb['forEach']((_0x46026d,_0x23e191)=>{var _0x1c33bd=_0x32e380;_0x40935e[_0x1c33bd(0xeb)]((_0x5917e0,_0x21a626)=>{var _0x808d9f=_0x1c33bd;if(_0x5917e0=='Receiving\x20Area'&&_0x23e191==_0x21a626){var _0x1bdc69=_0x46026d[_0x808d9f(0xe8)](0x3);_0x765f8e[_0x23e191]['storage']=_0x46026d[0x0],_0x765f8e[_0x23e191][_0x808d9f(0xb2)]=_0x46026d[0x1],_0x765f8e[_0x23e191][_0x808d9f(0x19c)]=0x0,_0x765f8e[_0x23e191][_0x808d9f(0x160)]=0x0,_0x765f8e[_0x23e191][_0x808d9f(0x181)]=_0x808d9f(0xbd),_0x765f8e[_0x23e191][_0x808d9f(0x16d)]=_0x1bdc69;}else{if(_0x5917e0=='Shelves'&&_0x23e191==_0x21a626){var _0x1bdc69=_0x46026d[_0x808d9f(0xe8)](0x3);_0x765f8e[_0x23e191][_0x808d9f(0x162)]=_0x46026d[0x0],_0x765f8e[_0x23e191][_0x808d9f(0xb2)]=_0x46026d[0x1],_0x765f8e[_0x23e191][_0x808d9f(0x19c)]=0x0,_0x765f8e[_0x23e191][_0x808d9f(0x160)]=0x0,_0x765f8e[_0x23e191][_0x808d9f(0x181)]='Floor',_0x765f8e[_0x23e191][_0x808d9f(0x16d)]=_0x46026d[0x5];}else{if(_0x23e191==_0x21a626){var _0x22fb00;if(_0x46026d[0x4]=='L')_0x22fb00=_0x808d9f(0xf4);else _0x46026d[0x4]=='F'&&(_0x22fb00=_0x808d9f(0xbd));_0x765f8e[_0x23e191][_0x808d9f(0x162)]=_0x46026d[0x0],_0x765f8e[_0x23e191][_0x808d9f(0xb2)]=_0x46026d[0x1],_0x765f8e[_0x23e191][_0x808d9f(0x19c)]=_0x46026d[0x2],_0x765f8e[_0x23e191]['bin']=_0x46026d[0x3],_0x765f8e[_0x23e191]['type']=_0x22fb00,_0x765f8e[_0x23e191][_0x808d9f(0x16d)]=_0x46026d[0x5];}}}});}),_0x175f8a['forEach']((_0x276700,_0x212fbe)=>{var _0x578d46=_0x32e380;_0x765f8e[_0x212fbe][_0x578d46(0xad)]=_0x276700;}),_0x40e31b[_0x32e380(0xeb)]((_0x37ced6,_0x29c867)=>{_0x765f8e[_0x29c867]['secondary_unit']=_0x37ced6;}),_0x182ce9[_0x32e380(0xeb)]((_0x448700,_0x4beb49)=>{_0x765f8e[_0x4beb49]['batch_code']=_0x448700;}),_0x9ae70a[_0x32e380(0xeb)]((_0x67c168,_0x56b7ea)=>{var _0x187716=_0x32e380;_0x765f8e[_0x56b7ea][_0x187716(0xcf)]=_0x67c168;}),_0x4e01be['forEach']((_0x57b7c9,_0x95a314)=>{var _0x4e861f=_0x32e380;_0x765f8e[_0x95a314][_0x4e861f(0xca)]=_0x57b7c9;}),_0xa703cc[_0x32e380(0xeb)]((_0x6a3751,_0x290945)=>{var _0xe1086f=_0x32e380;_0x765f8e[_0x290945][_0xe1086f(0x133)]=_0x6a3751;}),_0x2b0e12[_0x32e380(0xeb)]((_0x9590,_0x1c8a3f)=>{_0x765f8e[_0x1c8a3f]['requested_qty']=Math['abs'](_0x9590);}),_0x16e1bd[_0x32e380(0xeb)]((_0x3b6d4d,_0x40cb38)=>{var _0x5bdc17=_0x32e380;_0x765f8e[_0x40cb38][_0x5bdc17(0x18a)]=_0x3b6d4d;}),_0x2a1a83[_0x32e380(0xeb)]((_0x8a64c,_0x3967bc)=>{_0x765f8e[_0x3967bc]['delivery_code']=_0x8a64c;}),_0x5a3784[_0x32e380(0xeb)]((_0xbb74b0,_0x1f9a57)=>{var _0x1e2bcc=_0x32e380;_0x765f8e[_0x1f9a57][_0x1e2bcc(0x177)]=_0xbb74b0;}),_0x2df7dd[_0x32e380(0xeb)]((_0x5af6e5,_0x5af269)=>{var _0x1ae066=_0x32e380;_0x765f8e[_0x5af269][_0x1ae066(0x109)]=_0x5af6e5;}),_0x40935e[_0x32e380(0xeb)]((_0x2e4b36,_0x493446)=>{var _0x53b98a=_0x32e380;_0x765f8e[_0x493446][_0x53b98a(0x15c)]=_0x2e4b36;});var _0x4d4151=0x0;_0x765f8e['forEach'](_0x5d2a8d=>{var _0x3c519f=_0x32e380;console['log'](_0x3c519f(0x122),_0x5d2a8d),(parseInt(_0x5d2a8d[_0x3c519f(0x107)])<parseInt(_0x5d2a8d[_0x3c519f(0x12b)])||parseInt(_0x5d2a8d[_0x3c519f(0x12b)])==0x0)&&_0x4d4151++;});if(_0x4d4151!=0x0)return _0x3d0897[_0x32e380(0xa2)](_0x32e380(0xf9),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0xa43698[_0x32e380(0xe5)](_0x32e380(0x128));const _0x59395=_0x765f8e[_0x32e380(0x12e)](_0x2332a1=>_0x2332a1[_0x32e380(0x12b)]!=='0'&&_0x2332a1[_0x32e380(0x12b)]!=='');_0xbd409c['invoice']=_0x232ef3,_0xbd409c[_0x32e380(0x172)]=_0x7036d8,_0xbd409c[_0x32e380(0xd7)]=_0x22b0a3,_0xbd409c[_0x32e380(0x13a)]=_0x20090a,_0xbd409c[_0x32e380(0x11b)]=_0x59395,_0xbd409c['note']=_0x2bc298,_0xbd409c[_0x32e380(0x140)]=_0x2c1006,_0xbd409c['finalize']=_0x32e380(0xf1),_0xbd409c[_0x32e380(0x187)]='False';const _0x29f93b=await _0xbd409c['save']();_0x3d0897[_0x32e380(0xa2)]('success',_0x32e380(0xc4)),_0xa43698[_0x32e380(0xe5)]('/all_sales/view');}catch(_0x33d77e){console['log'](_0x33d77e);}}),router[a0_0x4abe0a(0x108)](a0_0x4abe0a(0x17f),auth,async(_0x4a9b38,_0x41158f)=>{var _0x94c7ae=a0_0x4abe0a;try{const _0x4e1a59=_0x4a9b38[_0x94c7ae(0x114)]['id'],{invoice:_0x192c33,customer:_0x51d154,receivable_amount:_0x18899d,received_amount:_0x281f7f}=_0x4a9b38['body'],_0x41fce7=await sales[_0x94c7ae(0xb6)](_0x4e1a59);console['log'](_0x41fce7);var _0xb2e309=_0x18899d-_0x281f7f;console[_0x94c7ae(0x101)](_0x281f7f),_0x41fce7['received_amount']=parseFloat(_0x281f7f)+parseFloat(_0x41fce7[_0x94c7ae(0x103)]),_0x41fce7[_0x94c7ae(0x106)]=_0xb2e309,console[_0x94c7ae(0x101)](_0x41fce7);const _0x43136f=await _0x41fce7[_0x94c7ae(0x151)](),_0xb18d20=await c_payment_data[_0x94c7ae(0xae)]({'invoice':_0x192c33});_0xb18d20['amount']=_0xb2e309,await _0xb18d20[_0x94c7ae(0x151)]();let _0x5e5e98=new Date(),_0x5dd04f=('0'+_0x5e5e98[_0x94c7ae(0xf2)]())[_0x94c7ae(0xe8)](-0x2),_0x3c8487=('0'+(_0x5e5e98[_0x94c7ae(0x169)]()+0x1))['slice'](-0x2),_0x1831b6=_0x5e5e98[_0x94c7ae(0x9b)](),_0x4adfbc=_0x1831b6+'-'+_0x3c8487+'-'+_0x5dd04f;const _0x3cbcda=new customer_payment({'invoice':_0x192c33,'date':_0x1831b6+'-'+_0x3c8487+'-'+_0x5dd04f,'customer':_0x51d154,'reason':_0x94c7ae(0xdd),'amount':_0x281f7f}),_0x3e46d4=await _0x3cbcda[_0x94c7ae(0x151)]();_0x4a9b38['flash'](_0x94c7ae(0x183),_0x94c7ae(0xe2)),_0x41158f[_0x94c7ae(0xe5)](_0x94c7ae(0x180));}catch(_0x4c660a){console[_0x94c7ae(0x101)](_0x4c660a);}}),router['get'](a0_0x4abe0a(0x17c),auth,async(_0x18adb6,_0x1c9b2e)=>{var _0x221191=a0_0x4abe0a;try{const {username:_0x3c6fc1,email:_0x321309,role:_0x5e7793}=_0x18adb6[_0x221191(0x192)],_0x17e416=_0x18adb6['user'],_0x40e136=await profile[_0x221191(0xae)]({'email':_0x17e416[_0x221191(0x1a5)]}),_0x81d162=await master_shop[_0x221191(0x95)]();console['log'](_0x221191(0x113),_0x81d162);const _0x1a7cc4=_0x18adb6[_0x221191(0x114)]['id'],_0x57389e=await sales['findById'](_0x1a7cc4);console[_0x221191(0x101)](_0x57389e);const _0x1b3163=await customer['findOne']({'name':_0x57389e['customer']});console[_0x221191(0x101)](_0x1b3163);if(_0x81d162[0x0][_0x221191(0x18e)]=='English\x20(US)'){var _0x2a2c00=users[_0x221191(0xe6)];console[_0x221191(0x101)](_0x2a2c00);}else{if(_0x81d162[0x0][_0x221191(0x18e)]==_0x221191(0x13c))var _0x2a2c00=users[_0x221191(0x13c)];else{if(_0x81d162[0x0][_0x221191(0x18e)]==_0x221191(0x100))var _0x2a2c00=users[_0x221191(0x100)];else{if(_0x81d162[0x0][_0x221191(0x18e)]==_0x221191(0xce))var _0x2a2c00=users['Spanish'];else{if(_0x81d162[0x0][_0x221191(0x18e)]==_0x221191(0x17a))var _0x2a2c00=users[_0x221191(0x17a)];else{if(_0x81d162[0x0][_0x221191(0x18e)]==_0x221191(0x137))var _0x2a2c00=users['Portuguese'];else{if(_0x81d162[0x0][_0x221191(0x18e)]==_0x221191(0x11c))var _0x2a2c00=users[_0x221191(0x11c)];else{if(_0x81d162[0x0]['language']==_0x221191(0x110))var _0x2a2c00=users[_0x221191(0x9e)];}}}}}}}_0x1c9b2e[_0x221191(0xaa)](_0x221191(0xa9),{'success':_0x18adb6[_0x221191(0xa2)](_0x221191(0x183)),'errors':_0x18adb6[_0x221191(0xa2)]('errors'),'role':_0x17e416,'profile':_0x40e136,'master_shop':_0x81d162,'customers':_0x1b3163,'sales':_0x57389e,'language':_0x2a2c00});}catch(_0x53f3c8){console[_0x221191(0x101)](_0x53f3c8);}}),router['get'](a0_0x4abe0a(0x198),auth,async(_0x4feec1,_0x2639f7)=>{var _0x56766b=a0_0x4abe0a;try{const {username:_0x6dbdd8,email:_0x1c987e,role:_0xa6fad7}=_0x4feec1[_0x56766b(0x192)],_0x21e1ae=_0x4feec1['user'],_0x32e57b=await profile[_0x56766b(0xae)]({'email':_0x21e1ae[_0x56766b(0x1a5)]}),_0x4d3bc5=await master_shop[_0x56766b(0x95)]();console[_0x56766b(0x101)]('master',_0x4d3bc5);const _0x169e15=_0x4feec1[_0x56766b(0x114)]['id'];console['log'](_0x169e15);const _0x34ba44=await sales['findById'](_0x169e15);console[_0x56766b(0x101)](_0x56766b(0x14e),_0x34ba44);const _0x336ab4=await warehouse[_0x56766b(0xc1)]([{'$match':{'name':_0x56766b(0xdf),'room':_0x56766b(0x182)}},{'$unwind':_0x56766b(0x15a)},{'$group':{'_id':_0x56766b(0x165),'name':{'$first':_0x56766b(0xdc)},'product_stock':{'$first':_0x56766b(0x166)},'level':{'$first':_0x56766b(0xed)},'isle':{'$first':_0x56766b(0x147)},'pallet':{'$first':'$product_details.pallet'},'primary_code':{'$first':_0x56766b(0xbc)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x56766b(0x15d)}}}]);console[_0x56766b(0x101)](_0x56766b(0xc3),_0x336ab4);const _0xd186b6=await product[_0x56766b(0x95)]({});warehouse_data=await warehouse[_0x56766b(0xc1)]([{'$match':{'status':_0x56766b(0x1a0),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x56766b(0x127)}}},{'$sort':{'name':0x1}}]);var _0x3a0584=[_0x56766b(0x182)];if(_0x4d3bc5[0x0][_0x56766b(0x18e)]=='English\x20(US)'){var _0x36f170=users[_0x56766b(0xe6)];console[_0x56766b(0x101)](_0x36f170);}else{if(_0x4d3bc5[0x0]['language']=='Hindi')var _0x36f170=users[_0x56766b(0x13c)];else{if(_0x4d3bc5[0x0][_0x56766b(0x18e)]=='German')var _0x36f170=users[_0x56766b(0x100)];else{if(_0x4d3bc5[0x0][_0x56766b(0x18e)]=='Spanish')var _0x36f170=users[_0x56766b(0xce)];else{if(_0x4d3bc5[0x0]['language']==_0x56766b(0x17a))var _0x36f170=users['French'];else{if(_0x4d3bc5[0x0][_0x56766b(0x18e)]==_0x56766b(0x137))var _0x36f170=users[_0x56766b(0x144)];else{if(_0x4d3bc5[0x0]['language']=='Chinese')var _0x36f170=users[_0x56766b(0x11c)];else{if(_0x4d3bc5[0x0][_0x56766b(0x18e)]==_0x56766b(0x110))var _0x36f170=users[_0x56766b(0x9e)];}}}}}}}_0x2639f7[_0x56766b(0xaa)]('return_sale',{'success':_0x4feec1['flash'](_0x56766b(0x183)),'errors':_0x4feec1[_0x56766b(0xa2)](_0x56766b(0xf9)),'role':_0x21e1ae,'profile':_0x32e57b,'user':_0x34ba44,'stock':_0x336ab4,'master_shop':_0x4d3bc5,'unit':_0xd186b6,'language':_0x36f170,'warehouses':warehouse_data,'rooms':_0x3a0584});}catch(_0x9f9d80){console[_0x56766b(0x101)](_0x9f9d80),_0x2639f7[_0x56766b(0xac)](0xc8)[_0x56766b(0x1a4)]({'message':_0x9f9d80[_0x56766b(0xa3)]});}}),router['post'](a0_0x4abe0a(0x198),auth,async(_0x545115,_0x26016b)=>{var _0x500e84=a0_0x4abe0a;try{const {invoice:_0x25d15a,date:_0x237b60,warehouse_name:_0x1ee22a,product_name:_0x19e8eb,primary_code:_0x455465,secondary_code:_0x46600b,product_code:_0xa79110,sales_quantity:_0x2414b4,stocks:_0x2c98dd,return_qty:_0x115f28,Room_name:_0x561298,to_warehouse_name:_0x29b735,to_Roomname:_0x503f59,to_Room_name:_0x412040,note:_0x4d5cb5,level:_0x4bf2de,isle:_0x4bf58e,pallet:_0x5f1072}=_0x545115[_0x500e84(0x150)];if(typeof _0x19e8eb=='string')var _0x5b3d9f=[_0x545115['body'][_0x500e84(0x15e)]],_0x4663a7=[_0x545115[_0x500e84(0x150)][_0x500e84(0xa6)]],_0x431c1a=[_0x545115[_0x500e84(0x150)][_0x500e84(0xc8)]],_0x441d88=[_0x545115[_0x500e84(0x150)][_0x500e84(0xd5)]],_0x457d18=[_0x545115['body'][_0x500e84(0xd8)]],_0x2b1620=[_0x545115['body'][_0x500e84(0xb5)]],_0x1143da=[_0x545115['body'][_0x500e84(0x12d)]],_0x2fdafb=[_0x545115[_0x500e84(0x150)]['bay']],_0x2dfde2=[_0x545115['body'][_0x500e84(0x160)]],_0x54d223=[_0x545115[_0x500e84(0x150)][_0x500e84(0x178)]],_0x47161a=[_0x545115[_0x500e84(0x150)][_0x500e84(0x16d)]];else var _0x5b3d9f=[..._0x545115['body'][_0x500e84(0x15e)]],_0x4663a7=[..._0x545115[_0x500e84(0x150)][_0x500e84(0xa6)]],_0x431c1a=[..._0x545115[_0x500e84(0x150)][_0x500e84(0xc8)]],_0x441d88=[..._0x545115[_0x500e84(0x150)][_0x500e84(0xd5)]],_0x457d18=[..._0x545115['body'][_0x500e84(0xd8)]],_0x2b1620=[..._0x545115['body'][_0x500e84(0xb5)]],_0x1143da=[..._0x545115[_0x500e84(0x150)][_0x500e84(0x12d)]],_0x2fdafb=[..._0x545115[_0x500e84(0x150)][_0x500e84(0x19c)]],_0x2dfde2=[..._0x545115[_0x500e84(0x150)][_0x500e84(0x160)]],_0x54d223=[..._0x545115[_0x500e84(0x150)][_0x500e84(0x178)]],_0x47161a=[..._0x545115[_0x500e84(0x150)][_0x500e84(0x16d)]];const _0x3605bc=_0x5b3d9f[_0x500e84(0xfa)](_0x46337e=>{return _0x46337e={'product_name':_0x46337e};});_0x4663a7['forEach']((_0xdd79f5,_0x24fcea)=>{_0x3605bc[_0x24fcea]['primary_code']=_0xdd79f5;}),_0x431c1a['forEach']((_0x131b2f,_0x1aa0e7)=>{_0x3605bc[_0x1aa0e7]['secondary_code']=_0x131b2f;}),_0x441d88[_0x500e84(0xeb)]((_0x3eda3b,_0x38bb2e)=>{var _0x2fe61e=_0x500e84;_0x3605bc[_0x38bb2e][_0x2fe61e(0xd5)]=_0x3eda3b;}),_0x457d18['forEach']((_0x49c1d4,_0x5406a4)=>{var _0x358db3=_0x500e84;_0x3605bc[_0x5406a4][_0x358db3(0xd4)]=_0x49c1d4;}),_0x2b1620['forEach']((_0xaf5780,_0x45bcc2)=>{var _0x2ed07c=_0x500e84;_0x3605bc[_0x45bcc2][_0x2ed07c(0x107)]=_0xaf5780;}),_0x1143da[_0x500e84(0xeb)]((_0x3136cc,_0x5593d5)=>{_0x3605bc[_0x5593d5]['return_qty']=_0x3136cc;}),_0x2fdafb[_0x500e84(0xeb)]((_0x3207c2,_0x4100eb)=>{var _0x511ca5=_0x500e84;_0x3605bc[_0x4100eb][_0x511ca5(0x19c)]=_0x3207c2;}),_0x2dfde2[_0x500e84(0xeb)]((_0x4c7ef9,_0x3cf168)=>{var _0x29e032=_0x500e84;_0x3605bc[_0x3cf168][_0x29e032(0x160)]=_0x4c7ef9;}),_0x54d223['forEach']((_0x44d9cc,_0x166de8)=>{_0x3605bc[_0x166de8]['type']=_0x44d9cc;}),_0x47161a[_0x500e84(0xeb)]((_0x3a7e47,_0x2501b0)=>{_0x3605bc[_0x2501b0]['floorlevel']=_0x3a7e47;});var _0x59ae26=0x0;_0x3605bc[_0x500e84(0xeb)](_0x5be72d=>{var _0x4fea69=_0x500e84;console[_0x4fea69(0x101)](_0x4fea69(0x122),_0x5be72d),(parseInt(_0x5be72d[_0x4fea69(0xd4)])<parseInt(_0x5be72d[_0x4fea69(0x12d)])||parseInt(_0x5be72d[_0x4fea69(0x107)])<parseInt(_0x5be72d[_0x4fea69(0x12d)])&&parseInt(_0x5be72d['sale_qty'])>parseInt(_0x5be72d['return_qty'])||parseInt(_0x5be72d[_0x4fea69(0x12d)])==0x0)&&_0x59ae26++;});if(_0x59ae26!=0x0)return _0x545115['flash'](_0x500e84(0xf9),_0x500e84(0xa0)),_0x26016b[_0x500e84(0xe5)](_0x500e84(0x128));const _0x51e636=await sales['findOne']({'invoice':_0x25d15a});console[_0x500e84(0x101)](_0x51e636),_0x51e636[_0x500e84(0xe7)]=_0x500e84(0x1a6);const _0x5e831c=await _0x51e636[_0x500e84(0x151)](),_0x5b82ca=new sales_return({'invoice':_0x25d15a,'customer':_0x545115[_0x500e84(0x150)]['customer'],'date':_0x237b60,'warehouse_name':_0x1ee22a,'room':_0x561298,'ToWarehouse':_0x29b735,'ToRoom':_0x412040,'return_sale':_0x3605bc,'note':_0x4d5cb5}),_0x5e03de=await _0x5b82ca[_0x500e84(0x151)]();console['log'](_0x5b82ca);const _0xabc176=await sales_return['findOne']({'invoice':_0x25d15a}),_0x38fa5d=await warehouse[_0x500e84(0xae)]({'name':_0x29b735,'room':_0x412040});_0xabc176[_0x500e84(0xa5)][_0x500e84(0xeb)](_0x567833=>{var _0x4609bd=_0x500e84,_0x5d3d85=0x0;const _0x4c0106=_0x38fa5d[_0x4609bd(0x16e)]['map'](_0x282f2d=>{var _0x42d1e2=_0x4609bd;_0x282f2d[_0x42d1e2(0x15e)]==_0x567833['product_name']&&_0x282f2d[_0x42d1e2(0x16d)]==_0x567833['floorlevel']&&_0x282f2d[_0x42d1e2(0x181)]==_0x567833['type']&&_0x282f2d['bin']==_0x567833[_0x42d1e2(0x160)]&&_0x282f2d['bay']==_0x567833[_0x42d1e2(0x19c)]&&(_0x282f2d[_0x42d1e2(0x94)]=parseInt(_0x282f2d[_0x42d1e2(0x94)])+parseInt(_0x567833[_0x42d1e2(0x12d)]),_0x5d3d85++);});_0x5d3d85=='0'&&(_0x38fa5d['product_details']=_0x38fa5d[_0x4609bd(0x16e)][_0x4609bd(0x188)]({'product_name':_0x567833['product_name'],'product_stock':_0x567833['return_qty'],'primary_code':_0x567833[_0x4609bd(0xa6)],'secondary_code':_0x567833[_0x4609bd(0xc8)],'product_code':_0x567833['product_code'],'bay':_0x567833[_0x4609bd(0x19c)],'bin':_0x567833[_0x4609bd(0x160)],'type':_0x567833['type'],'floorlevel':_0x567833[_0x4609bd(0x16d)]})),console['log'](_0x4609bd(0xbf),_0x38fa5d);}),await _0x38fa5d[_0x500e84(0x151)](),console[_0x500e84(0x101)](_0x545115[_0x500e84(0x150)]);const _0x36c607=new c_payment_data({'invoice':_0x25d15a,'customer':_0x545115[_0x500e84(0x150)][_0x500e84(0x172)],'reason':_0x500e84(0xef)});await _0x36c607['save']();const _0x35b29f=await master_shop[_0x500e84(0x95)]();console[_0x500e84(0x101)](_0x500e84(0x1a1),_0x35b29f[0x0][_0x500e84(0x176)]);const _0x51f032=await email_settings['findOne'](),_0x24a2c7=await customer[_0x500e84(0xae)]({'name':_0x545115[_0x500e84(0x150)]['customer']});console[_0x500e84(0x101)](_0x500e84(0x189),_0x24a2c7);_0x35b29f[0x0][_0x500e84(0x15b)]==0x1?(right_currency=_0x35b29f[0x0][_0x500e84(0xa4)],left_currency=''):(right_currency='',left_currency=_0x35b29f[0x0]['currency']);var _0x211142=_0x5b3d9f,_0x23bcbb=_0x1143da,_0x4a9e71='',_0x5ceaf7;for(_0x5ceaf7 in _0x211142){_0x4a9e71+=_0x500e84(0x13f)+_0x500e84(0x152)+_0x211142[_0x5ceaf7]+'</td>'+_0x500e84(0x152)+_0x23bcbb[_0x5ceaf7]+'</td>'+_0x500e84(0x164);}console[_0x500e84(0x101)](_0x500e84(0x18c),_0x4a9e71);let _0x1b254c=nodemailer[_0x500e84(0xfe)]({'service':_0x500e84(0xbe),'auth':{'user':_0x51f032[_0x500e84(0x1a5)],'pass':_0x51f032['password']}}),_0x3cd03d={'from':_0x51f032[_0x500e84(0x1a5)],'to':_0x24a2c7[_0x500e84(0x1a5)],'subject':_0x500e84(0x11e),'attachments':[{'filename':_0x500e84(0x125),'path':__dirname+_0x500e84(0x138)+'/upload/'+_0x35b29f[0x0]['image'],'cid':'logo'}],'html':_0x500e84(0xda)+_0x500e84(0xb7)+_0x500e84(0x191)+_0x500e84(0x14c)+_0x500e84(0x131)+_0x500e84(0x14c)+_0x500e84(0x10c)+_0x500e84(0x190)+_0x500e84(0x14c)+_0x500e84(0x146)+_0x35b29f[0x0][_0x500e84(0xc6)]+_0x500e84(0xc0)+_0x500e84(0x190)+_0x500e84(0x190)+'<hr\x20class=\x22my-3\x22>'+_0x500e84(0x14c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x25d15a+'\x20'+_0x500e84(0xec)+'\x20Order\x20Date\x20:\x20'+_0x237b60+'\x20'+_0x500e84(0xe9)+'</h5>'+_0x500e84(0x190)+_0x500e84(0xd3)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x500e84(0x13f)+_0x500e84(0x154)+_0x500e84(0xdb)+_0x500e84(0x156)+_0x500e84(0x184)+_0x500e84(0x164)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4a9e71+'\x20'+'</tbody>'+_0x500e84(0x135)+_0x500e84(0x14c)+_0x500e84(0x91)+_0x500e84(0xbb)+_0x35b29f[0x0][_0x500e84(0xc6)]+'</h5>'+_0x500e84(0x190)+_0x500e84(0x190)+_0x500e84(0x196)};_0x1b254c[_0x500e84(0x173)](_0x3cd03d,function(_0x3bf57c,_0xe51de){var _0xb30a48=_0x500e84;_0x3bf57c?(console[_0xb30a48(0x101)](_0x3bf57c),console[_0xb30a48(0x101)](_0xb30a48(0xfb))):console[_0xb30a48(0x101)]('Email\x20sent\x20successfully');}),_0x545115[_0x500e84(0xa2)](_0x500e84(0x183),_0x500e84(0x124)),_0x26016b[_0x500e84(0xe5)](_0x500e84(0x180));}catch(_0x5e9bb9){console['log'](_0x5e9bb9),_0x26016b[_0x500e84(0xac)](0xc8)[_0x500e84(0x1a4)]({'message1':_0x5e9bb9['message']});}}),router[a0_0x4abe0a(0x98)](a0_0x4abe0a(0x145),auth,async(_0x3308ef,_0x1cfb2a)=>{var _0x5ee68b=a0_0x4abe0a;try{const {username:_0x159ba1,email:_0x28c960,role:_0xd785c8}=_0x3308ef[_0x5ee68b(0x192)],_0x3f7de1=_0x3308ef[_0x5ee68b(0x192)],_0x5b0671=await profile['findOne']({'email':_0x3f7de1[_0x5ee68b(0x1a5)]}),_0x2a7813=await master_shop[_0x5ee68b(0x95)]();console['log'](_0x5ee68b(0x171),_0x2a7813);const _0x36015b=_0x3308ef['params']['id'],_0x452a15=await sales[_0x5ee68b(0xb6)](_0x36015b);console[_0x5ee68b(0x101)](_0x5ee68b(0x12c),_0x452a15);if(_0x2a7813[0x0][_0x5ee68b(0x18e)]==_0x5ee68b(0xa8))var _0x534785=users[_0x5ee68b(0xe6)];else{if(_0x2a7813[0x0][_0x5ee68b(0x18e)]=='Hindi')var _0x534785=users[_0x5ee68b(0x13c)];else{if(_0x2a7813[0x0][_0x5ee68b(0x18e)]=='German')var _0x534785=users[_0x5ee68b(0x100)];else{if(_0x2a7813[0x0][_0x5ee68b(0x18e)]==_0x5ee68b(0xce))var _0x534785=users[_0x5ee68b(0xce)];else{if(_0x2a7813[0x0][_0x5ee68b(0x18e)]=='French')var _0x534785=users[_0x5ee68b(0x17a)];else{if(_0x2a7813[0x0]['language']==_0x5ee68b(0x137))var _0x534785=users[_0x5ee68b(0x144)];else{if(_0x2a7813[0x0][_0x5ee68b(0x18e)]==_0x5ee68b(0x11c))var _0x534785=users[_0x5ee68b(0x11c)];else{if(_0x2a7813[0x0][_0x5ee68b(0x18e)]==_0x5ee68b(0x110))var _0x534785=users['Arabic'];}}}}}}}_0x1cfb2a[_0x5ee68b(0xaa)](_0x5ee68b(0x170),{'success':_0x3308ef[_0x5ee68b(0xa2)]('success'),'errors':_0x3308ef['flash'](_0x5ee68b(0xf9)),'role':_0x3f7de1,'profile':_0x5b0671,'alldata':_0x452a15,'master_shop':_0x2a7813,'language':_0x534785});}catch(_0x20d04d){console[_0x5ee68b(0x101)](_0x20d04d);}}),router[a0_0x4abe0a(0x108)](a0_0x4abe0a(0x141),async(_0x11e630,_0x5b5e2f)=>{var _0x3f1869=a0_0x4abe0a;const {product_code:_0x6e1f61,warehouse_name:_0x98e6dc,rooms_data:_0xb974cd,Roomslist:_0x2a66b5}=_0x11e630[_0x3f1869(0x150)],_0x460ab6=_0x2a66b5[_0x3f1869(0x199)](','),_0x178bdf=[];async function _0x3187c3(_0x5a0c62){var _0x59c2e9=_0x3f1869;const _0x4a3773=await warehouse['aggregate']([{'$match':{'name':_0x98e6dc,'room':_0x5a0c62}},{'$unwind':_0x59c2e9(0x15a)},{'$match':{'product_details.primary_code':_0x6e1f61}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x59c2e9(0xdc)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x59c2e9(0x159)},'product_code':{'$first':_0x59c2e9(0x15d)},'level':{'$first':_0x59c2e9(0xee)},'isle':{'$first':_0x59c2e9(0x161)},'type':{'$first':_0x59c2e9(0x194)},'pallet':{'$first':_0x59c2e9(0xa1)},'unit':{'$first':_0x59c2e9(0xde)},'secondary_unit':{'$first':_0x59c2e9(0x14f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x59c2e9(0xc5)},'expiry_date':{'$first':_0x59c2e9(0x9d)},'production_date':{'$first':_0x59c2e9(0x10a)},'maxPerUnit':{'$first':_0x59c2e9(0x13d)},'batch_code':{'$first':_0x59c2e9(0x18f)},'product_cat':{'$first':_0x59c2e9(0x90)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x59c2e9(0x9f)},'actual_qty':{'$first':_0x59c2e9(0xf8)},'actual_uom':{'$first':'$product_details.actual_uom'}}}]),_0x2e5459=await warehouse[_0x59c2e9(0xc1)]([{'$match':{'name':_0x98e6dc,'room':_0x5a0c62}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x6e1f61}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x59c2e9(0x166)},'primary_code':{'$first':_0x59c2e9(0xbc)},'secondary_code':{'$first':_0x59c2e9(0x159)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x59c2e9(0xee)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x59c2e9(0xa1)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x59c2e9(0x14f)},'storage':{'$first':_0x59c2e9(0x193)},'rack':{'$first':_0x59c2e9(0xc5)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x59c2e9(0x10a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x59c2e9(0x90)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x59c2e9(0x8f)},'invoice':{'$first':_0x59c2e9(0x9f)}}}]);if(_0x4a3773[_0x59c2e9(0x120)]>0x0)_0x178bdf[_0x59c2e9(0x9a)](_0x4a3773);else _0x2e5459[_0x59c2e9(0x120)]>0x0&&_0x178bdf['push'](_0x2e5459);}const _0x8c9244=_0x460ab6[_0x3f1869(0xfa)](_0x11ddaf=>_0x3187c3(_0x11ddaf));await Promise['all'](_0x8c9244),_0x5b5e2f[_0x3f1869(0x1a4)](_0x178bdf);}),module[a0_0x4abe0a(0x153)]=router;