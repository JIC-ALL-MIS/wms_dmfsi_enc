function a0_0x3d23(_0x4ba05e,_0x37d25c){var _0x3eacb9=a0_0x3eac();return a0_0x3d23=function(_0x3d2316,_0x4a0795){_0x3d2316=_0x3d2316-0x193;var _0x5d8504=_0x3eacb9[_0x3d2316];return _0x5d8504;},a0_0x3d23(_0x4ba05e,_0x37d25c);}var a0_0x414afb=a0_0x3d23;function a0_0x3eac(){var _0x119692=['</table>','/view/add_sales/:id','delivery_code','customers','filter','received_amount','redirect','customers_docs','random','$finalize','<div>','actual_uom','return_sale','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Price\x20</th>','Portuguese\x20(BR)','prod_code','message','params','sales_quantity','log','$product_details.product_cat','$product_details.product_code','Arabic','rack','An\x20error\x20occurred.','max','stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.storage','Error\x20Occurs','English\x20(US)','sale_qty','production_date','find','product_name','unit','/give_payment/:id','floorlevel','express','Received\x20Payment\x20For\x20Sale','secondary_code','forEach','stocks','\x20Order\x20Date\x20:\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','$product','$product.product_name','$invoice','$product_details.rack','then','$product_details.invoice','$product_details','createTransport','/view/add_sale/product','/all_sales/preview/','Sale\x20Return','9430980GtWpCj','sendMail','274519wRukaZ','gmail','site_title','/barcode/:id','warehouse_name','RMSEmail','Arabic\x20(ae)','Email\x20sent\x20successfully','sales\x20item\x20return\x20successfull','6216291ACYqtp','prod_cat','<strong>\x20Regards\x20</strong>','json','/preview/:id','$note','/view/:id','Sales\x20Update\x20successfully','actual_qty','$product_details.expiry_date','errors','/invoice/:id','Enabled','prod_invoice','edit_sales_view','<tbody\x20style=\x22text-align:\x20center;\x22>','Portuguese','</span>','$sale_product.quantity','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</head><body>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','../models/all_models','id_transact','logo','278973lwwRDy','Sales\x20Mail','$sale_product.floorlevel','$product_details.primary_code','$product_details.actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','RoomAssigned','all_sales_barcode','<tr>','room','$return_data','<span\x20style=\x22float:\x20right;\x22>','render','<!DOCTYPE\x20html>','map','/upload/','<hr\x20class=\x22my-3\x22>','requested_qty','product_list','Return\x20Goods','$product_details.secondary_unit','$product_details.batch_code','user','Return\x20Rooms','type','email','role','quantity','floor','An\x20error\x20occurred\x20while\x20saving\x20data.','<h2>\x20','return_qty','length','</tr>','$product_details.type','False','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','post','</h5>','slice','</div>','$product_details.production_date','level','</thead>','$product_details.floorlevel','sales\x20all_data','warehouse','$product_details._id','$customers_docs','$product_details.product_name','back','Ambient','$warehouse_name','$product_details.bin','toString','OUT-','finalize','Receiving\x20Area','Floor','Level','$customer','sale_product','$product_details.unit','currency','/view/add_sales','\x20Order\x20Number\x20:\x20','1256iKDSZZ','language','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','nodemailer','string','French','error','_id','True','$product_details.bay','due_amount','barcode\x20user_id','findOne','edit_sales','Raw\x20Materials','findById','flash','abs','maxperunit','Hindi','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</td>','20rTiYZh','split','push','$product_details.product_stock','$product_details.isle','$product_details.actual_uom','expiry_date','product_stock','$sale_product.bay','SCRN','$isAllowEdit','host','product_code','product_data','</body></html>','Must\x20not\x20be\x20greater\x20than\x20sale\x20Qty','$product_details.maxPerUnit','bin','602660LbfyBb','image','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','success','master','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','primary_unit','78644qTmJGf','</tbody>','quantity_notConverted','65674JdvacE','foreach\x20newproduct','user_id','stock_data','German','carton','$sale_product','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','../public/language/languages.json','getFullYear','$_id','$room','isAllowEdit','padStart','product','save','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','catch','/view','$date','name','Enclosed','concat','primary_code','Logo.png','Spanish','Sale\x20Return\x20Mail','<h5\x20style=\x22text-align:\x20left;\x22>','batch_code','<html><head><title></title>','product_details','invoice','types','/../public','\x20</h2>','bay','$product_details.level','customer','date','$product_details.pallet','delivery_date','/all_sales/view','$name','max_per_unit','room_name','barcode\x20Product\x20master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<h5>','Chinese','storage','staff','$product_details.secondary_code','$sale_product.bin','English','password','secondary_unit','all','/view/return_sales/:id'];a0_0x3eac=function(){return _0x119692;};return a0_0x3eac();}(function(_0x5c36a0,_0x1d229f){var _0x728195=a0_0x3d23,_0xb2cea4=_0x5c36a0();while(!![]){try{var _0x466f26=-parseInt(_0x728195(0x1f2))/0x1+-parseInt(_0x728195(0x288))/0x2+-parseInt(_0x728195(0x214))/0x3+-parseInt(_0x728195(0x280))/0x4*(-parseInt(_0x728195(0x26e))/0x5)+-parseInt(_0x728195(0x1f0))/0x6+parseInt(_0x728195(0x28b))/0x7*(parseInt(_0x728195(0x256))/0x8)+parseInt(_0x728195(0x1fb))/0x9;if(_0x466f26===_0x1d229f)break;else _0xb2cea4['push'](_0xb2cea4['shift']());}catch(_0x22d5d8){_0xb2cea4['push'](_0xb2cea4['shift']());}}}(a0_0x3eac,0xc04d7));const express=require(a0_0x414afb(0x1dd)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,c_payment_data,email_settings,supervisor_settings}=require(a0_0x414afb(0x211)),auth=require('../middleware/auth'),nodemailer=require(a0_0x414afb(0x25b)),users=require(a0_0x414afb(0x293));router[a0_0x414afb(0x1e4)](a0_0x414afb(0x29e),auth,async(_0x5a17bf,_0x14e9f5)=>{var _0x353e91=a0_0x414afb;try{const {username:_0x559bc2,email:_0x4e3d14,role:_0x112f4c}=_0x5a17bf[_0x353e91(0x22a)],_0x50d58c=_0x5a17bf['user'],_0x194a3a=await profile[_0x353e91(0x264)]({'email':_0x50d58c[_0x353e91(0x22d)]}),_0x5cb907=await master_shop[_0x353e91(0x1d8)]();let _0x26d5b9;if(_0x50d58c['role']==_0x353e91(0x1ae)){const _0x5f44fd=await staff[_0x353e91(0x264)]({'email':_0x50d58c[_0x353e91(0x22d)]});_0x26d5b9=await sales[_0x353e91(0x282)]([{'$lookup':{'from':_0x353e91(0x1b9),'localField':_0x353e91(0x1a1),'foreignField':_0x353e91(0x2a0),'as':'customers_docs'}},{'$unwind':_0x353e91(0x244)},{'$unwind':_0x353e91(0x291)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'customers':{'$first':_0x353e91(0x250)},'date':{'$first':_0x353e91(0x29f)},'warehouse_name':{'$first':_0x353e91(0x248)},'sale_product':{'$push':_0x353e91(0x291)},'note':{'$first':_0x353e91(0x200)},'return_data':{'$first':_0x353e91(0x21e)},'customers_docs':{'$first':_0x353e91(0x244)},'total_saleproduct_quantity':{'$sum':_0x353e91(0x20d)},'level':{'$addToSet':_0x353e91(0x276)},'isle':{'$addToSet':_0x353e91(0x1b0)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x353e91(0x216)},'finalize':{'$first':_0x353e91(0x1bf)},'isAllowEdit':{'$first':_0x353e91(0x278)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);}else _0x26d5b9=await sales['aggregate']([{'$lookup':{'from':_0x353e91(0x1b9),'localField':'customer','foreignField':'name','as':_0x353e91(0x1bd)}},{'$unwind':_0x353e91(0x244)},{'$unwind':'$sale_product'},{'$group':{'_id':_0x353e91(0x295),'invoice':{'$first':_0x353e91(0x1e7)},'customers':{'$first':_0x353e91(0x250)},'date':{'$first':_0x353e91(0x29f)},'warehouse_name':{'$first':_0x353e91(0x248)},'sale_product':{'$push':_0x353e91(0x291)},'note':{'$first':_0x353e91(0x200)},'return_data':{'$first':'$return_data'},'customers_docs':{'$first':_0x353e91(0x244)},'total_saleproduct_quantity':{'$sum':_0x353e91(0x20d)},'level':{'$addToSet':_0x353e91(0x276)},'isle':{'$addToSet':_0x353e91(0x1b0)},'type':{'$addToSet':'$sale_product.type'},'pallet':{'$addToSet':_0x353e91(0x216)},'finalize':{'$first':_0x353e91(0x1bf)},'isAllowEdit':{'$first':_0x353e91(0x278)}}},{'$project':{'_id':0x1,'invoice':0x1,'customers':0x1,'date':0x1,'warehouse_name':0x1,'sale_product':0x1,'note':0x1,'return_data':0x1,'customers_docs':0x1,'total_saleproduct_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'pallet':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);console[_0x353e91(0x1ca)](_0x353e91(0x241),_0x26d5b9);if(_0x5cb907[0x0]['language']==_0x353e91(0x1d5)){var _0x234995=users['English'];console[_0x353e91(0x1ca)](_0x234995);}else{if(_0x5cb907[0x0]['language']==_0x353e91(0x26b))var _0x234995=users[_0x353e91(0x26b)];else{if(_0x5cb907[0x0]['language']==_0x353e91(0x28f))var _0x234995=users[_0x353e91(0x28f)];else{if(_0x5cb907[0x0]['language']==_0x353e91(0x195))var _0x234995=users[_0x353e91(0x195)];else{if(_0x5cb907[0x0]['language']==_0x353e91(0x25d))var _0x234995=users[_0x353e91(0x25d)];else{if(_0x5cb907[0x0][_0x353e91(0x257)]=='Portuguese\x20(BR)')var _0x234995=users[_0x353e91(0x20b)];else{if(_0x5cb907[0x0]['language']==_0x353e91(0x1ac))var _0x234995=users['Chinese'];else{if(_0x5cb907[0x0][_0x353e91(0x257)]==_0x353e91(0x1f8))var _0x234995=users[_0x353e91(0x1cd)];}}}}}}}_0x14e9f5[_0x353e91(0x220)]('all_sales',{'success':_0x5a17bf[_0x353e91(0x268)](_0x353e91(0x284)),'errors':_0x5a17bf[_0x353e91(0x268)](_0x353e91(0x205)),'sales':_0x26d5b9,'profile':_0x194a3a,'role':_0x50d58c,'master_shop':_0x5cb907,'language':_0x234995});}catch(_0x38f22b){console[_0x353e91(0x1ca)](_0x38f22b);}});async function getRandom8DigitNumber(){var _0x56c73b=a0_0x414afb;const _0x3362db=0x989680,_0x45b392=0x5f5e0ff,_0x5e04dc=Math[_0x56c73b(0x230)](Math[_0x56c73b(0x1be)]()*(_0x45b392-_0x3362db+0x1))+_0x3362db;var _0xfd1680;const _0x4b6d3b=await sales[_0x56c73b(0x264)]({'invoice':_0x56c73b(0x24b)+_0x5e04dc});return _0x4b6d3b&&_0x4b6d3b[_0x56c73b(0x234)]>0x0?_0xfd1680='OUT-'+_0x5e04dc:_0xfd1680=_0x56c73b(0x24b)+_0x5e04dc,_0xfd1680;}router[a0_0x414afb(0x1e4)](a0_0x414afb(0x254),auth,async(_0x47f3a3,_0x255fb4)=>{var _0x46048d=a0_0x414afb;try{const {username:_0x373caf,email:_0x10244d,role:_0x201090}=_0x47f3a3[_0x46048d(0x22a)],_0x53908e=_0x47f3a3[_0x46048d(0x22a)],_0x7804e1=await profile['findOne']({'email':_0x53908e['email']}),_0x401878=await master_shop[_0x46048d(0x1d8)](),_0x597766=await customer['find']({});let _0x1326b0;if(_0x53908e['role']=='staff'){const _0xd2484a=await staff['findOne']({'email':_0x53908e[_0x46048d(0x22d)]});_0x1326b0=await warehouse[_0x46048d(0x282)]([{'$match':{'status':'Enabled','name':_0xd2484a['warehouse'],'warehouse_category':_0x46048d(0x266),'name':{'$ne':_0x46048d(0x227)}}},{'$group':{'_id':'$name','name':{'$first':_0x46048d(0x1a6)}}},{'$sort':{'name':0x1}}]);}else _0x1326b0=await warehouse[_0x46048d(0x282)]([{'$match':{'status':_0x46048d(0x207),'warehouse_category':_0x46048d(0x266),'name':{'$ne':_0x46048d(0x227)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]);const _0x22b154=await product[_0x46048d(0x1d8)]({});var _0xadbae8=[_0x46048d(0x247),_0x46048d(0x2a1)];const _0x348bed=await sales[_0x46048d(0x1d8)]({}),_0x38f0ba=_0x348bed[_0x46048d(0x234)]+0x1,_0x47a846=_0x46048d(0x24b)+_0x38f0ba[_0x46048d(0x24a)]()[_0x46048d(0x298)](0x5,'0');if(_0x401878[0x0][_0x46048d(0x257)]==_0x46048d(0x1d5)){var _0x526e11=users[_0x46048d(0x1b1)];console[_0x46048d(0x1ca)](_0x526e11);}else{if(_0x401878[0x0]['language']==_0x46048d(0x26b))var _0x526e11=users['Hindi'];else{if(_0x401878[0x0][_0x46048d(0x257)]=='German')var _0x526e11=users[_0x46048d(0x28f)];else{if(_0x401878[0x0]['language']==_0x46048d(0x195))var _0x526e11=users[_0x46048d(0x195)];else{if(_0x401878[0x0][_0x46048d(0x257)]==_0x46048d(0x25d))var _0x526e11=users['French'];else{if(_0x401878[0x0][_0x46048d(0x257)]==_0x46048d(0x1c5))var _0x526e11=users[_0x46048d(0x20b)];else{if(_0x401878[0x0][_0x46048d(0x257)]==_0x46048d(0x1ac))var _0x526e11=users[_0x46048d(0x1ac)];else{if(_0x401878[0x0][_0x46048d(0x257)]=='Arabic\x20(ae)')var _0x526e11=users['Arabic'];}}}}}}}const _0x1f497e=getRandom8DigitNumber();_0x1f497e[_0x46048d(0x1e9)](_0x1bbdd6=>{var _0x343ee0=_0x46048d;_0x255fb4['render']('add_sales',{'success':_0x47f3a3[_0x343ee0(0x268)](_0x343ee0(0x284)),'errors':_0x47f3a3[_0x343ee0(0x268)]('errors'),'role':_0x53908e,'profile':_0x7804e1,'customer':_0x597766,'warehouse':_0x1326b0,'product':_0x22b154,'invoice':_0x1bbdd6,'master_shop':_0x401878,'language':_0x526e11,'rooms_data':_0xadbae8});})[_0x46048d(0x29d)](_0x28232b=>{var _0x25f253=_0x46048d;_0x47f3a3[_0x25f253(0x268)](_0x25f253(0x205),_0x25f253(0x210)),_0x255fb4[_0x25f253(0x1bc)](_0x25f253(0x1a5));});}catch(_0xb8e44f){console[_0x46048d(0x1ca)](_0xb8e44f);}}),router[a0_0x414afb(0x1e4)](a0_0x414afb(0x1b7),auth,async(_0x3fe770,_0x4db92e)=>{var _0x4efb8f=a0_0x414afb;try{const _0x1e1808=_0x3fe770[_0x4efb8f(0x1c8)]['id'];console['log'](_0x1e1808);const _0x1ea3dd=await product['find'](),_0x2284cc=await purchases[_0x4efb8f(0x282)]([{'$match':{'warehouse_name':_0x1e1808}},{'$unwind':_0x4efb8f(0x1e5)},{'$group':{'_id':_0x4efb8f(0x1e6)}}]);console[_0x4efb8f(0x1ca)]('purchases_data',_0x2284cc),_0x4db92e['status'](0xc8)[_0x4efb8f(0x1fe)]({'purchases_data':_0x2284cc,'product_data':_0x1ea3dd});}catch(_0x10deb0){console[_0x4efb8f(0x1ca)](_0x10deb0);}}),router[a0_0x414afb(0x239)](a0_0x414afb(0x1ed),auth,async(_0x38fdb5,_0x467f71)=>{var _0x43a54d=a0_0x414afb;try{const {warehouse_data:_0x1b3365,product_data:_0x32bc28}=_0x38fdb5[_0x43a54d(0x1c3)];console['log'](_0x38fdb5['body'][_0x43a54d(0x27b)]);;const _0x519ca9=await master_shop[_0x43a54d(0x1d8)]();console['log'](_0x43a54d(0x285),_0x519ca9);const _0x15f822=await product[_0x43a54d(0x264)]({'name':_0x32bc28});console[_0x43a54d(0x1ca)](_0x43a54d(0x299),_0x15f822);const _0x2a69bf=await warehouse['aggregate']([{'$match':{'name':_0x1b3365}},{'$unwind':'$product_details'},{'$match':{'product_details.product_name':_0x32bc28}},{'$group':{'_id':_0x43a54d(0x245),'product_stock':{'$first':'$product_details.product_stock'}}}]);console['log'](_0x43a54d(0x28e),_0x2a69bf),_0x467f71[_0x43a54d(0x258)](0xc8)[_0x43a54d(0x1fe)]({'master':_0x519ca9,'new_product':_0x15f822,'stock_data':_0x2a69bf});}catch(_0x4fa256){console[_0x43a54d(0x1ca)](_0x4fa256);}}),router['post'](a0_0x414afb(0x254),auth,async(_0x3e5634,_0x53ef4c)=>{var _0xfdc0e6=a0_0x414afb;try{const {invoice:_0x527153,date:_0x39ea8f,warehouse_name:_0xc144a6,product_name:_0x52628c,stock:_0x60b3c8,quantity:_0x49895c,note:_0x999259,room:_0x4bf2a7,primary_code:_0x4f9268,secondary_code:_0x50e385,prod_code:_0x5db75b,level:_0x1e6c90,isle:_0x1b3cba,pallet:_0x383081,batch_code:_0x501b29,SCRN:_0x32e7d5,expiry_date:_0x1a9fcf}=_0x3e5634[_0xfdc0e6(0x1c3)];if(typeof _0x52628c==_0xfdc0e6(0x25c))var _0x40888e=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1d9)]],_0x1d4bcb=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1d1)]],_0x5904b0=[_0x3e5634[_0xfdc0e6(0x1c3)]['carton']],_0x298570=[_0x3e5634['body'][_0xfdc0e6(0x193)]],_0x20417b=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1df)]],_0x50731c=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1c6)]],_0x6158e4=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x23e)]],_0x851132=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x287)]],_0x2eb000=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1b3)]],_0x674071=[_0x3e5634['body']['batch_code']],_0x3e9b57=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x274)]],_0x213b44=[_0x3e5634[_0xfdc0e6(0x1c3)]['max_per_unit']],_0x3ee741=[_0x3e5634['body'][_0xfdc0e6(0x1d7)]],_0x35e08a=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x225)]],_0x53ce72=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1a4)]],_0x343973=[_0x3e5634['body']['delivery_code']],_0x3aa058=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1fc)]],_0x1732ef=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x22f)]],_0x35faa7=[_0x3e5634[_0xfdc0e6(0x1c3)]['RoomAssigned']],_0x25a83a=[_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x208)]],_0x103f5e=[_0x3e5634[_0xfdc0e6(0x1c3)]['actual_qty']],_0x5d6203=[_0x3e5634[_0xfdc0e6(0x1c3)]['actual_uom']],_0x4d6172=[_0x3e5634['body'][_0xfdc0e6(0x212)]];else var _0x40888e=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1d9)]],_0x1d4bcb=[..._0x3e5634['body']['stock']],_0x5904b0=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x290)]],_0x298570=[..._0x3e5634['body']['primary_code']],_0x20417b=[..._0x3e5634[_0xfdc0e6(0x1c3)]['secondary_code']],_0x50731c=[..._0x3e5634['body']['prod_code']],_0x6158e4=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x23e)]],_0x851132=[..._0x3e5634['body']['primary_unit']],_0x2eb000=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1b3)]],_0x674071=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x198)]],_0x3e9b57=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x274)]],_0x213b44=[..._0x3e5634[_0xfdc0e6(0x1c3)]['max_per_unit']],_0x3ee741=[..._0x3e5634['body'][_0xfdc0e6(0x1d7)]],_0x35e08a=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x225)]],_0x53ce72=[..._0x3e5634['body'][_0xfdc0e6(0x1a4)]],_0x343973=[..._0x3e5634['body']['delivery_code']],_0x3aa058=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1fc)]],_0x1732ef=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x22f)]],_0x35faa7=[..._0x3e5634[_0xfdc0e6(0x1c3)]['RoomAssigned']],_0x25a83a=[..._0x3e5634['body']['prod_invoice']],_0x103f5e=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x203)]],_0x5d6203=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1c1)]],_0x4d6172=[..._0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x212)]];const _0x31849f=_0x40888e[_0xfdc0e6(0x222)](_0x5df39a=>{return _0x5df39a={'product_name':_0x5df39a};});_0x1d4bcb['forEach']((_0x35771c,_0x18986d)=>{var _0x2aa832=_0xfdc0e6;_0x31849f[_0x18986d][_0x2aa832(0x1d1)]=Math[_0x2aa832(0x269)](_0x35771c);}),_0x103f5e[_0xfdc0e6(0x1e0)]((_0x283853,_0x36d907)=>{var _0xb1f4a6=_0xfdc0e6;_0x31849f[_0x36d907]['actual_qty']=Math[_0xb1f4a6(0x269)](_0x283853);}),_0x5d6203['forEach']((_0x52bfe6,_0x3447c9)=>{var _0x42b3b7=_0xfdc0e6;_0x31849f[_0x3447c9][_0x42b3b7(0x1c1)]=_0x52bfe6;}),_0x4d6172[_0xfdc0e6(0x1e0)]((_0x77aefa,_0x151d44)=>{_0x31849f[_0x151d44]['id_transaction_from']=_0x77aefa;}),_0x5904b0[_0xfdc0e6(0x1e0)]((_0x462d3f,_0x499495)=>{_0x31849f[_0x499495]['quantity']=_0x462d3f;}),_0x298570['forEach']((_0x45cc96,_0x3525dd)=>{var _0x4e088f=_0xfdc0e6;_0x31849f[_0x3525dd][_0x4e088f(0x193)]=_0x45cc96;}),_0x20417b[_0xfdc0e6(0x1e0)]((_0x22de25,_0x1b4674)=>{var _0x112259=_0xfdc0e6;_0x31849f[_0x1b4674][_0x112259(0x1df)]=_0x22de25;}),_0x50731c[_0xfdc0e6(0x1e0)]((_0x137c20,_0x23bac5)=>{var _0xdd70e4=_0xfdc0e6;_0x31849f[_0x23bac5][_0xdd70e4(0x27a)]=_0x137c20;}),_0x6158e4[_0xfdc0e6(0x1e0)]((_0x1526d7,_0x55e560)=>{var _0x20caa0=_0xfdc0e6;_0x35faa7[_0x20caa0(0x1e0)]((_0x1cec68,_0x18de33)=>{var _0x288519=_0x20caa0;if(_0x1cec68=='Receiving\x20Area'&&_0x55e560==_0x18de33){var _0x44242c=_0x1526d7[_0x288519(0x23b)](0x3);_0x31849f[_0x55e560][_0x288519(0x1ad)]=_0x1526d7[0x0],_0x31849f[_0x55e560][_0x288519(0x1ce)]=_0x1526d7[0x1],_0x31849f[_0x55e560]['bay']=0x0,_0x31849f[_0x55e560][_0x288519(0x27f)]=0x0,_0x31849f[_0x55e560][_0x288519(0x22c)]=_0x288519(0x24e),_0x31849f[_0x55e560][_0x288519(0x1dc)]=_0x44242c;}else{if(_0x1cec68=='Shelves'&&_0x55e560==_0x18de33){var _0x44242c=_0x1526d7['slice'](0x3);_0x31849f[_0x55e560][_0x288519(0x1ad)]=_0x1526d7[0x0],_0x31849f[_0x55e560][_0x288519(0x1ce)]=_0x1526d7[0x1],_0x31849f[_0x55e560][_0x288519(0x19f)]=0x0,_0x31849f[_0x55e560][_0x288519(0x27f)]=0x0,_0x31849f[_0x55e560][_0x288519(0x22c)]='Floor',_0x31849f[_0x55e560][_0x288519(0x1dc)]=_0x1526d7[0x5];}else{if(_0x55e560==_0x18de33){var _0x42287c;if(_0x1526d7[0x4]=='L')_0x42287c=_0x288519(0x24f);else _0x1526d7[0x4]=='F'&&(_0x42287c=_0x288519(0x24e));_0x31849f[_0x55e560][_0x288519(0x1ad)]=_0x1526d7[0x0],_0x31849f[_0x55e560][_0x288519(0x1ce)]=_0x1526d7[0x1],_0x31849f[_0x55e560][_0x288519(0x19f)]=_0x1526d7[0x2],_0x31849f[_0x55e560][_0x288519(0x27f)]=_0x1526d7[0x3],_0x31849f[_0x55e560][_0x288519(0x22c)]=_0x42287c,_0x31849f[_0x55e560][_0x288519(0x1dc)]=_0x1526d7[0x5];}}}});}),_0x851132['forEach']((_0x23e57e,_0x439061)=>{var _0x2e968f=_0xfdc0e6;_0x31849f[_0x439061][_0x2e968f(0x1da)]=_0x23e57e;}),_0x2eb000[_0xfdc0e6(0x1e0)]((_0x2fb12f,_0x291475)=>{_0x31849f[_0x291475]['secondary_unit']=_0x2fb12f;}),_0x674071[_0xfdc0e6(0x1e0)]((_0x55394e,_0x1f4535)=>{var _0x5435f6=_0xfdc0e6;_0x31849f[_0x1f4535][_0x5435f6(0x198)]=_0x55394e;}),_0x3e9b57['forEach']((_0x4aa4df,_0x249d2c)=>{var _0x42e17a=_0xfdc0e6;_0x31849f[_0x249d2c][_0x42e17a(0x274)]=_0x4aa4df;}),_0x213b44[_0xfdc0e6(0x1e0)]((_0x4b6931,_0x1b1c5f)=>{_0x31849f[_0x1b1c5f]['maxperunit']=_0x4b6931;}),_0x3ee741[_0xfdc0e6(0x1e0)]((_0x2cf219,_0x446b57)=>{_0x31849f[_0x446b57]['production_date']=_0x2cf219;}),_0x35e08a[_0xfdc0e6(0x1e0)]((_0xc7294c,_0x215db2)=>{var _0x256d01=_0xfdc0e6;_0x31849f[_0x215db2][_0x256d01(0x225)]=_0xc7294c;}),_0x53ce72[_0xfdc0e6(0x1e0)]((_0xff315d,_0x3e0816)=>{var _0x51f8aa=_0xfdc0e6;_0x31849f[_0x3e0816][_0x51f8aa(0x1a4)]=_0xff315d;}),_0x343973['forEach']((_0x5bf6bc,_0x44fada)=>{_0x31849f[_0x44fada]['delivery_code']=_0x5bf6bc;}),_0x3aa058['forEach']((_0x466182,_0x99b31a)=>{var _0x5063bc=_0xfdc0e6;_0x31849f[_0x99b31a][_0x5063bc(0x1fc)]=_0x466182;}),_0x1732ef['forEach']((_0x296e8f,_0x38034f)=>{var _0x12f488=_0xfdc0e6;_0x31849f[_0x38034f][_0x12f488(0x28a)]=_0x296e8f;}),_0x35faa7['forEach']((_0x41d597,_0x31c45a)=>{_0x31849f[_0x31c45a]['room_name']=_0x41d597;}),_0x25a83a[_0xfdc0e6(0x1e0)]((_0x5a211a,_0x2589d7)=>{var _0x4519cc=_0xfdc0e6;_0x31849f[_0x2589d7][_0x4519cc(0x19b)]=_0x5a211a;});var _0x32d0e2=0x0;_0x31849f[_0xfdc0e6(0x1e0)](_0x5502c0=>{var _0x43c794=_0xfdc0e6;(_0x5502c0[_0x43c794(0x1d1)]<_0x5502c0[_0x43c794(0x28a)]||_0x5502c0[_0x43c794(0x28a)]==0x0)&&(console[_0x43c794(0x1ca)]('foreach\x20newproduct',_0x5502c0),_0x32d0e2++);});const _0x2e9d01=_0x31849f[_0xfdc0e6(0x1ba)](_0x24d555=>_0x24d555[_0xfdc0e6(0x22f)]!=='0'&&_0x24d555['quantity']!==''),_0x129de4=new sales({'invoice':_0x527153,'customer':_0x3e5634[_0xfdc0e6(0x1c3)][_0xfdc0e6(0x1a1)],'date':_0x39ea8f,'warehouse_name':_0xc144a6,'sale_product':_0x2e9d01,'note':_0x999259,'room':_0x4bf2a7,'primary_code':_0x4f9268,'secondary_code':_0x50e385,'prod_code':_0x5db75b,'SCRN':_0x32e7d5}),_0x64f47e=await _0x129de4[_0xfdc0e6(0x29a)]();_0x3e5634[_0xfdc0e6(0x268)](_0xfdc0e6(0x284),'Sales\x20Add\x20successfully'),_0x53ef4c[_0xfdc0e6(0x1bc)](_0xfdc0e6(0x1ee)+_0x64f47e[_0xfdc0e6(0x25f)]);}catch(_0x2e344f){console[_0xfdc0e6(0x1ca)](_0x2e344f);}}),router[a0_0x414afb(0x1e4)](a0_0x414afb(0x1ff),auth,async(_0xa09021,_0x5a213e)=>{var _0x3e0363=a0_0x414afb;try{const {username:_0x1a1b12,email:_0x8999df,role:_0x36a630}=_0xa09021[_0x3e0363(0x22a)],_0x3ff3d7=_0xa09021[_0x3e0363(0x22a)],_0x558ef7=await profile[_0x3e0363(0x264)]({'email':_0x3ff3d7[_0x3e0363(0x22d)]}),_0x50dc7b=await master_shop[_0x3e0363(0x1d8)](),_0x3ee816=_0xa09021['params']['id'],_0x1aab15=await sales[_0x3e0363(0x267)](_0x3ee816),_0x19950e=await warehouse['aggregate']([{'$match':{'name':_0x1aab15[_0x3e0363(0x1f6)]}},{'$unwind':_0x3e0363(0x1eb)},{'$group':{'_id':_0x3e0363(0x243),'name':{'$first':_0x3e0363(0x245)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3e0363(0x261)},'bin':{'$first':_0x3e0363(0x249)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3e0363(0x240)},'primary_code':{'$first':_0x3e0363(0x217)},'secondary_code':{'$first':_0x3e0363(0x1af)},'product_code':{'$first':_0x3e0363(0x1cc)},'storage':{'$first':_0x3e0363(0x1d3)},'rack':{'$first':_0x3e0363(0x1e8)},'expiry_date':{'$first':_0x3e0363(0x204)},'production_date':{'$first':_0x3e0363(0x23d)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x22be2e=await customer[_0x3e0363(0x1d8)]({});let _0x3f2cde;if(_0x3ff3d7[_0x3e0363(0x22e)]==_0x3e0363(0x1ae)){const _0xe39da9=await staff[_0x3e0363(0x264)]({'email':_0x3ff3d7['email']});_0x3f2cde=await warehouse[_0x3e0363(0x282)]([{'$match':{'status':'Enabled','name':_0xe39da9[_0x3e0363(0x242)]}},{'$group':{'_id':_0x3e0363(0x1a6),'name':{'$first':_0x3e0363(0x1a6)}}}]);}else _0x3f2cde=await warehouse[_0x3e0363(0x282)]([{'$match':{'status':_0x3e0363(0x207)}},{'$group':{'_id':'$name','name':{'$first':_0x3e0363(0x1a6)}}}]);const _0x715318=await product[_0x3e0363(0x1d8)]({}),_0x3698bf=await suppliers['find']({});if(_0x50dc7b[0x0]['language']=='English\x20(US)'){var _0x4d6eeb=users[_0x3e0363(0x1b1)];console[_0x3e0363(0x1ca)](_0x4d6eeb);}else{if(_0x50dc7b[0x0]['language']=='Hindi')var _0x4d6eeb=users[_0x3e0363(0x26b)];else{if(_0x50dc7b[0x0][_0x3e0363(0x257)]==_0x3e0363(0x28f))var _0x4d6eeb=users['German'];else{if(_0x50dc7b[0x0]['language']==_0x3e0363(0x195))var _0x4d6eeb=users[_0x3e0363(0x195)];else{if(_0x50dc7b[0x0][_0x3e0363(0x257)]==_0x3e0363(0x25d))var _0x4d6eeb=users[_0x3e0363(0x25d)];else{if(_0x50dc7b[0x0]['language']==_0x3e0363(0x1c5))var _0x4d6eeb=users['Portuguese'];else{if(_0x50dc7b[0x0][_0x3e0363(0x257)]==_0x3e0363(0x1ac))var _0x4d6eeb=users[_0x3e0363(0x1ac)];else{if(_0x50dc7b[0x0][_0x3e0363(0x257)]==_0x3e0363(0x1f8))var _0x4d6eeb=users[_0x3e0363(0x1cd)];}}}}}}}_0x5a213e['render'](_0x3e0363(0x209),{'success':_0xa09021[_0x3e0363(0x268)](_0x3e0363(0x284)),'errors':_0xa09021[_0x3e0363(0x268)]('errors'),'role':_0x3ff3d7,'profile':_0x558ef7,'customer':_0x22be2e,'warehouse':_0x3f2cde,'product':_0x19950e,'user':_0x1aab15,'master_shop':_0x50dc7b,'unit':_0x715318,'language':_0x4d6eeb,'suppliers':_0x3698bf});}catch(_0x243f0e){console[_0x3e0363(0x1ca)](_0x243f0e);}}),router[a0_0x414afb(0x239)](a0_0x414afb(0x1ff),auth,async(_0x8aee14,_0x32e51d)=>{var _0x36c9db=a0_0x414afb;try{const _0x4febf6=_0x8aee14['params']['id'],{invoice:_0xfdf7d5,warehouse_name:_0x446df6,room:_0x306fca}=_0x8aee14[_0x36c9db(0x1c3)],_0x2c472f=await sales[_0x36c9db(0x264)]({'invoice':_0xfdf7d5}),_0x298ad8=_0x2c472f[_0x36c9db(0x251)][_0x36c9db(0x222)](async _0x31d9f7=>{var _0x3b579b=_0x36c9db,_0x8cca58=await warehouse['findOne']({'name':_0x446df6,'room':_0x31d9f7[_0x3b579b(0x1a8)],'warehouse_category':'Raw\x20Materials'});const _0x434c7d=_0x8cca58['product_details']['map'](_0xcd531=>{var _0x10e30c=_0x3b579b;_0xcd531[_0x10e30c(0x1d9)]==_0x31d9f7[_0x10e30c(0x1d9)]&&_0xcd531[_0x10e30c(0x1dc)]==_0x31d9f7[_0x10e30c(0x1dc)]&&_0xcd531[_0x10e30c(0x22c)]==_0x31d9f7[_0x10e30c(0x22c)]&&_0xcd531[_0x10e30c(0x27f)]==_0x31d9f7[_0x10e30c(0x27f)]&&_0xcd531[_0x10e30c(0x19f)]==_0x31d9f7['bay']&&_0xcd531[_0x10e30c(0x1ce)]==_0x31d9f7['rack']&&_0xcd531[_0x10e30c(0x1ad)]==_0x31d9f7['storage']&&_0xcd531[_0x10e30c(0x274)]==_0x31d9f7[_0x10e30c(0x274)]&&_0xcd531[_0x10e30c(0x198)]==_0x31d9f7[_0x10e30c(0x198)]&&_0xcd531[_0x10e30c(0x19b)]==_0x31d9f7[_0x10e30c(0x19b)]&&_0xcd531[_0x10e30c(0x25f)]==_0x31d9f7['id_transaction_from']&&(_0xcd531[_0x10e30c(0x275)]=Math[_0x10e30c(0x1d0)](0x0,Math[_0x10e30c(0x269)](_0xcd531[_0x10e30c(0x275)])-Math[_0x10e30c(0x269)](_0x31d9f7['quantity'])));});return _0x8cca58;});Promise[_0x36c9db(0x1b4)](_0x298ad8)[_0x36c9db(0x1e9)](async _0xae9cfc=>{var _0xdb8a8=_0x36c9db;try{for(const _0x12a9d8 of _0xae9cfc){await _0x12a9d8[_0xdb8a8(0x29a)]();}_0x2c472f[_0xdb8a8(0x24c)]=_0xdb8a8(0x260);const _0x29fcf4=await _0x2c472f[_0xdb8a8(0x29a)](),_0x39fa13=await master_shop[_0xdb8a8(0x1d8)](),_0x4bcbb8=await email_settings[_0xdb8a8(0x264)](),_0x3e7c51=await supervisor_settings[_0xdb8a8(0x1d8)]();var _0x3e6004=_0x2c472f[_0xdb8a8(0x251)],_0x258fac='',_0x264cca;for(_0x264cca in _0x3e6004){_0x258fac+=_0xdb8a8(0x21c)+_0xdb8a8(0x1e3)+_0x3e6004[_0x264cca][_0xdb8a8(0x1d9)]+_0xdb8a8(0x26d)+_0xdb8a8(0x1e3)+_0x3e6004[_0x264cca][_0xdb8a8(0x27a)]+_0xdb8a8(0x26d)+_0xdb8a8(0x1e3)+_0x3e6004[_0x264cca]['quantity']+_0xdb8a8(0x26d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e6004[_0x264cca][_0xdb8a8(0x1da)]+_0xdb8a8(0x26d)+_0xdb8a8(0x1e3)+_0x3e6004[_0x264cca]['secondary_unit']+'</td>'+_0xdb8a8(0x1e3)+_0x2c472f[_0xdb8a8(0x1f6)]+_0xdb8a8(0x26d)+_0xdb8a8(0x1e3)+_0x3e6004[_0x264cca]['room_name']+_0xdb8a8(0x26d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e6004[_0x264cca][_0xdb8a8(0x1ad)]+_0x3e6004[_0x264cca][_0xdb8a8(0x1ce)]+_0x3e6004[_0x264cca][_0xdb8a8(0x19f)]+_0x3e6004[_0x264cca][_0xdb8a8(0x27f)]+_0x3e6004[_0x264cca][_0xdb8a8(0x22c)][0x0]+_0x3e6004[_0x264cca][_0xdb8a8(0x1dc)]+_0xdb8a8(0x26d),_0xdb8a8(0x235);}let _0x119ed7=nodemailer[_0xdb8a8(0x1ec)]({'host':_0x4bcbb8[_0xdb8a8(0x279)],'port':Number(_0x4bcbb8['port']),'secure':![],'auth':{'user':_0x4bcbb8[_0xdb8a8(0x22d)],'pass':_0x4bcbb8[_0xdb8a8(0x1b2)]}}),_0x19ea33={'from':_0x4bcbb8[_0xdb8a8(0x22d)],'to':_0x3e7c51[0x0][_0xdb8a8(0x1f7)],'subject':_0xdb8a8(0x215),'attachments':[{'filename':_0xdb8a8(0x194),'path':__dirname+'/../public'+_0xdb8a8(0x223)+_0x39fa13[0x0][_0xdb8a8(0x281)],'cid':_0xdb8a8(0x213)}],'html':_0xdb8a8(0x221)+_0xdb8a8(0x199)+_0xdb8a8(0x20f)+_0xdb8a8(0x1c0)+_0xdb8a8(0x238)+_0xdb8a8(0x1c0)+_0xdb8a8(0x26c)+_0xdb8a8(0x23c)+'<div>'+'<h2>\x20'+_0x39fa13[0x0]['site_title']+_0xdb8a8(0x19e)+_0xdb8a8(0x23c)+_0xdb8a8(0x23c)+_0xdb8a8(0x224)+_0xdb8a8(0x1c0)+_0xdb8a8(0x197)+'\x20Order\x20Number\x20:\x20'+_0x2c472f[_0xdb8a8(0x19b)]+'\x20'+_0xdb8a8(0x21f)+_0xdb8a8(0x1e2)+_0x2c472f[_0xdb8a8(0x1a2)]+'\x20'+_0xdb8a8(0x20c)+_0xdb8a8(0x23a)+_0xdb8a8(0x23c)+_0xdb8a8(0x20e)+_0xdb8a8(0x286)+_0xdb8a8(0x21c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xdb8a8(0x283)+_0xdb8a8(0x219)+_0xdb8a8(0x1d2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0xdb8a8(0x259)+_0xdb8a8(0x25a)+_0xdb8a8(0x235)+_0xdb8a8(0x23f)+_0xdb8a8(0x20a)+'\x20'+_0x258fac+'\x20'+_0xdb8a8(0x289)+_0xdb8a8(0x1b6)+_0xdb8a8(0x1c0)+_0xdb8a8(0x1fd)+_0xdb8a8(0x1ab)+_0x39fa13[0x0][_0xdb8a8(0x1f4)]+_0xdb8a8(0x23a)+_0xdb8a8(0x23c)+_0xdb8a8(0x23c)+_0xdb8a8(0x27c)};_0x119ed7['sendMail'](_0x19ea33,function(_0x4c9c87,_0x5a8605){var _0xb0b251=_0xdb8a8;_0x4c9c87?(console['log'](_0x4c9c87),console[_0xb0b251(0x1ca)](_0xb0b251(0x1d4))):console[_0xb0b251(0x1ca)]('Email\x20sent\x20successfully');}),_0x8aee14[_0xdb8a8(0x268)](_0xdb8a8(0x284),_0xdb8a8(0x202)),_0x32e51d[_0xdb8a8(0x1bc)](_0xdb8a8(0x1ee)+_0x4febf6);}catch(_0x309832){console[_0xdb8a8(0x25e)](_0x309832),_0x32e51d['status'](0x1f4)['json']({'error':_0xdb8a8(0x231)});}})[_0x36c9db(0x29d)](_0x118082=>{var _0x267c7c=_0x36c9db;console[_0x267c7c(0x25e)](_0x118082),_0x32e51d[_0x267c7c(0x258)](0x1f4)[_0x267c7c(0x1fe)]({'error':_0x267c7c(0x1cf)});});}catch(_0x20da5e){console[_0x36c9db(0x1ca)](_0x20da5e);}}),router['get'](a0_0x414afb(0x201),auth,async(_0x2a11be,_0x13146d)=>{var _0x401432=a0_0x414afb;try{const {username:_0xf3f252,email:_0x4f8f09,role:_0x5eb3f1}=_0x2a11be[_0x401432(0x22a)],_0x1dbf6b=_0x2a11be[_0x401432(0x22a)],_0x2d86ee=await profile[_0x401432(0x264)]({'email':_0x1dbf6b[_0x401432(0x22d)]}),_0x1fe516=await master_shop['find'](),_0x497e79=_0x2a11be[_0x401432(0x1c8)]['id'],_0x2a6054=await sales[_0x401432(0x267)](_0x497e79);var _0x59d1b0=[_0x401432(0x247),_0x401432(0x2a1)];const _0x2b6330=await warehouse[_0x401432(0x282)]([{'$match':{'name':_0x2a6054[_0x401432(0x1f6)],'warehouse_category':_0x401432(0x266)}},{'$unwind':_0x401432(0x1eb)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x401432(0x271)},'bay':{'$first':_0x401432(0x261)},'bin':{'$first':_0x401432(0x249)},'type':{'$first':_0x401432(0x236)},'floorlevel':{'$first':_0x401432(0x240)},'primary_code':{'$first':_0x401432(0x217)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x401432(0x1cc)},'storage':{'$first':_0x401432(0x1d3)},'rack':{'$first':_0x401432(0x1e8)}}}]),_0x244884=await customer[_0x401432(0x1d8)]({});let _0x109da5;if(_0x1dbf6b[_0x401432(0x22e)]=='staff'){const _0x493702=await staff['findOne']({'email':_0x1dbf6b[_0x401432(0x22d)]});_0x109da5=await warehouse['aggregate']([{'$match':{'status':_0x401432(0x207),'name':_0x493702['warehouse'],'warehouse_category':_0x401432(0x266)}},{'$group':{'_id':'$name','name':{'$first':_0x401432(0x1a6)}}}]);}else _0x109da5=await warehouse['aggregate']([{'$match':{'status':_0x401432(0x207),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x401432(0x1a6),'name':{'$first':_0x401432(0x1a6)}}}]);const _0x2819c4=await product[_0x401432(0x1d8)]({});if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x1d5)){var _0x845da4=users['English'];console[_0x401432(0x1ca)](_0x845da4);}else{if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x26b))var _0x845da4=users[_0x401432(0x26b)];else{if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x28f))var _0x845da4=users[_0x401432(0x28f)];else{if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x195))var _0x845da4=users[_0x401432(0x195)];else{if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x25d))var _0x845da4=users[_0x401432(0x25d)];else{if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x1c5))var _0x845da4=users[_0x401432(0x20b)];else{if(_0x1fe516[0x0]['language']==_0x401432(0x1ac))var _0x845da4=users[_0x401432(0x1ac)];else{if(_0x1fe516[0x0][_0x401432(0x257)]==_0x401432(0x1f8))var _0x845da4=users[_0x401432(0x1cd)];}}}}}}}_0x13146d[_0x401432(0x220)](_0x401432(0x265),{'success':_0x2a11be['flash'](_0x401432(0x284)),'errors':_0x2a11be[_0x401432(0x268)](_0x401432(0x205)),'role':_0x1dbf6b,'profile':_0x2d86ee,'customer':_0x244884,'warehouse':_0x109da5,'product':_0x2b6330,'user':_0x2a6054,'master_shop':_0x1fe516,'unit':_0x2819c4,'language':_0x845da4});}catch(_0x288fbe){console[_0x401432(0x1ca)](_0x288fbe);}}),router['post'](a0_0x414afb(0x201),auth,async(_0x46d095,_0x19d9d5)=>{var _0x10042e=a0_0x414afb;try{const _0x25647d=_0x46d095[_0x10042e(0x1c8)]['id'],_0x1303fa=await sales[_0x10042e(0x264)]({'_id':_0x46d095[_0x10042e(0x1c8)]['id']}),_0x459385=await warehouse[_0x10042e(0x264)]({'name':_0x1303fa['warehouse_name'],'room':_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x21d)]}),{invoice:_0x3380a3,date:_0xd3624b,warehouse_name:_0x37148a,product_name:_0x1218ec,stock:_0x23b531,quantity:_0x49d646,note:_0xd77048,room:_0x52e1e3,customer:_0x31b089,SCRN:_0x5117e3}=_0x46d095[_0x10042e(0x1c3)];if(typeof _0x1218ec=='string')var _0x53041c=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1d9)]],_0x2d249d=[_0x46d095['body'][_0x10042e(0x1d1)]],_0x426907=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x290)]],_0x9381d0=[_0x46d095['body'][_0x10042e(0x193)]],_0x4fa772=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1df)]],_0x2f0598=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1c6)]],_0x2eb3ac=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x23e)]],_0x571fef=[_0x46d095['body'][_0x10042e(0x287)]],_0x2eaa15=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1b3)]],_0x2c417b=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x198)]],_0x2650cf=[_0x46d095['body'][_0x10042e(0x274)]],_0x2c9f81=[_0x46d095[_0x10042e(0x1c3)]['max_per_unit']],_0x39a92e=[_0x46d095['body'][_0x10042e(0x1d7)]],_0x17e740=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x225)]],_0x588aaa=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1a4)]],_0x130be4=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1b8)]],_0x3ebbb=[_0x46d095[_0x10042e(0x1c3)]['prod_cat']],_0x37c56b=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x22f)]],_0x18bc2d=[_0x46d095[_0x10042e(0x1c3)][_0x10042e(0x21a)]];else var _0x53041c=[..._0x46d095['body']['product_name']],_0x2d249d=[..._0x46d095['body'][_0x10042e(0x1d1)]],_0x426907=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x290)]],_0x9381d0=[..._0x46d095['body'][_0x10042e(0x193)]],_0x4fa772=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1df)]],_0x2f0598=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1c6)]],_0x2eb3ac=[..._0x46d095[_0x10042e(0x1c3)]['level']],_0x571fef=[..._0x46d095[_0x10042e(0x1c3)]['primary_unit']],_0x2eaa15=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1b3)]],_0x2c417b=[..._0x46d095['body']['batch_code']],_0x2650cf=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x274)]],_0x2c9f81=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1a7)]],_0x39a92e=[..._0x46d095['body'][_0x10042e(0x1d7)]],_0x17e740=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x225)]],_0x588aaa=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1a4)]],_0x130be4=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1b8)]],_0x3ebbb=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x1fc)]],_0x37c56b=[..._0x46d095[_0x10042e(0x1c3)]['quantity']],_0x18bc2d=[..._0x46d095[_0x10042e(0x1c3)][_0x10042e(0x21a)]];const _0x5a16e6=_0x53041c[_0x10042e(0x222)](_0x1c32f8=>{return _0x1c32f8={'product_name':_0x1c32f8};});_0x2d249d[_0x10042e(0x1e0)]((_0x434ea7,_0x234ed9)=>{var _0x5ab5bf=_0x10042e;_0x5a16e6[_0x234ed9][_0x5ab5bf(0x1d1)]=Math['abs'](_0x434ea7);}),_0x426907['forEach']((_0x273da8,_0x3e2ef7)=>{var _0x2ba1b5=_0x10042e;_0x5a16e6[_0x3e2ef7][_0x2ba1b5(0x22f)]=_0x273da8;}),_0x9381d0['forEach']((_0x3a91ad,_0x356ac9)=>{_0x5a16e6[_0x356ac9]['primary_code']=_0x3a91ad;}),_0x4fa772[_0x10042e(0x1e0)]((_0x3f3aaa,_0x1cd79a)=>{_0x5a16e6[_0x1cd79a]['secondary_code']=_0x3f3aaa;}),_0x2f0598[_0x10042e(0x1e0)]((_0x4a1b82,_0x67788c)=>{var _0x2d0a5d=_0x10042e;_0x5a16e6[_0x67788c][_0x2d0a5d(0x27a)]=_0x4a1b82;}),_0x2eb3ac[_0x10042e(0x1e0)]((_0x338230,_0x20ecd3)=>{var _0x375b0b=_0x10042e;_0x18bc2d[_0x375b0b(0x1e0)]((_0x765f6e,_0x294819)=>{var _0x43e4bd=_0x375b0b;if(_0x765f6e==_0x43e4bd(0x24d)&&_0x20ecd3==_0x294819){var _0x522c0c=_0x338230['slice'](0x3);_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1ad)]=_0x338230[0x0],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1ce)]=_0x338230[0x1],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x19f)]=0x0,_0x5a16e6[_0x20ecd3]['bin']=0x0,_0x5a16e6[_0x20ecd3]['type']='Floor',_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1dc)]=_0x522c0c;}else{if(_0x765f6e=='Shelves'&&_0x20ecd3==_0x294819){var _0x522c0c=_0x338230[_0x43e4bd(0x23b)](0x3);_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1ad)]=_0x338230[0x0],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1ce)]=_0x338230[0x1],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x19f)]=0x0,_0x5a16e6[_0x20ecd3][_0x43e4bd(0x27f)]=0x0,_0x5a16e6[_0x20ecd3][_0x43e4bd(0x22c)]='Floor',_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1dc)]=_0x338230[0x5];}else{if(_0x20ecd3==_0x294819){var _0x21902a;if(_0x338230[0x4]=='L')_0x21902a=_0x43e4bd(0x24f);else _0x338230[0x4]=='F'&&(_0x21902a=_0x43e4bd(0x24e));_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1ad)]=_0x338230[0x0],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x1ce)]=_0x338230[0x1],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x19f)]=_0x338230[0x2],_0x5a16e6[_0x20ecd3]['bin']=_0x338230[0x3],_0x5a16e6[_0x20ecd3][_0x43e4bd(0x22c)]=_0x21902a,_0x5a16e6[_0x20ecd3]['floorlevel']=_0x338230[0x5];}}}});}),_0x571fef[_0x10042e(0x1e0)]((_0x1eaa26,_0x217872)=>{var _0xa90833=_0x10042e;_0x5a16e6[_0x217872][_0xa90833(0x1da)]=_0x1eaa26;}),_0x2eaa15[_0x10042e(0x1e0)]((_0x102a42,_0x5eb563)=>{_0x5a16e6[_0x5eb563]['secondary_unit']=_0x102a42;}),_0x2c417b[_0x10042e(0x1e0)]((_0x2dbec7,_0x181d5f)=>{var _0x2c2638=_0x10042e;_0x5a16e6[_0x181d5f][_0x2c2638(0x198)]=_0x2dbec7;}),_0x2650cf['forEach']((_0x2b5804,_0x5447f3)=>{var _0x457a74=_0x10042e;_0x5a16e6[_0x5447f3][_0x457a74(0x274)]=_0x2b5804;}),_0x2c9f81['forEach']((_0x2c2e0e,_0x1c1a74)=>{var _0x2da7f8=_0x10042e;_0x5a16e6[_0x1c1a74][_0x2da7f8(0x26a)]=_0x2c2e0e;}),_0x39a92e[_0x10042e(0x1e0)]((_0x428f7d,_0x1eb349)=>{_0x5a16e6[_0x1eb349]['production_date']=_0x428f7d;}),_0x17e740[_0x10042e(0x1e0)]((_0xa5533,_0x2b84fa)=>{var _0x49643c=_0x10042e;_0x5a16e6[_0x2b84fa][_0x49643c(0x225)]=Math[_0x49643c(0x269)](_0xa5533);}),_0x588aaa[_0x10042e(0x1e0)]((_0x4f177e,_0x4cfce0)=>{var _0x2399a7=_0x10042e;_0x5a16e6[_0x4cfce0][_0x2399a7(0x1a4)]=_0x4f177e;}),_0x130be4[_0x10042e(0x1e0)]((_0x379247,_0x533263)=>{_0x5a16e6[_0x533263]['delivery_code']=_0x379247;}),_0x3ebbb[_0x10042e(0x1e0)]((_0xaf1a5b,_0x462ea3)=>{_0x5a16e6[_0x462ea3]['prod_cat']=_0xaf1a5b;}),_0x37c56b[_0x10042e(0x1e0)]((_0x471863,_0x117d83)=>{var _0x387263=_0x10042e;_0x5a16e6[_0x117d83][_0x387263(0x28a)]=_0x471863;}),_0x18bc2d[_0x10042e(0x1e0)]((_0x2fe042,_0x1a6285)=>{_0x5a16e6[_0x1a6285]['room_name']=_0x2fe042;});var _0x504a2b=0x0;_0x5a16e6['forEach'](_0x339c7b=>{var _0x2d7af4=_0x10042e;console[_0x2d7af4(0x1ca)](_0x2d7af4(0x28c),_0x339c7b),(parseInt(_0x339c7b[_0x2d7af4(0x1d1)])<parseInt(_0x339c7b[_0x2d7af4(0x22f)])||parseInt(_0x339c7b[_0x2d7af4(0x22f)])==0x0)&&_0x504a2b++;});if(_0x504a2b!=0x0)return _0x46d095[_0x10042e(0x268)]('errors',_0x10042e(0x292)),_0x19d9d5[_0x10042e(0x1bc)](_0x10042e(0x246));const _0x1bda9d=_0x5a16e6[_0x10042e(0x1ba)](_0x191979=>_0x191979[_0x10042e(0x22f)]!=='0'&&_0x191979['quantity']!=='');_0x1303fa[_0x10042e(0x19b)]=_0x3380a3,_0x1303fa[_0x10042e(0x1a1)]=_0x31b089,_0x1303fa[_0x10042e(0x1a2)]=_0xd3624b,_0x1303fa[_0x10042e(0x1f6)]=_0x37148a,_0x1303fa[_0x10042e(0x251)]=_0x1bda9d,_0x1303fa[_0x10042e(0x29b)]=_0xd77048,_0x1303fa[_0x10042e(0x277)]=_0x5117e3,_0x1303fa[_0x10042e(0x24c)]='False',_0x1303fa[_0x10042e(0x297)]=_0x10042e(0x237);const _0xa819a=await _0x1303fa[_0x10042e(0x29a)]();_0x46d095[_0x10042e(0x268)]('success',_0x10042e(0x202)),_0x19d9d5[_0x10042e(0x1bc)](_0x10042e(0x1a5));}catch(_0x74a6a){console['log'](_0x74a6a);}}),router[a0_0x414afb(0x239)](a0_0x414afb(0x1db),auth,async(_0x41d34e,_0x4f4bb2)=>{var _0x59e8d9=a0_0x414afb;try{const _0x3c0ee0=_0x41d34e['params']['id'],{invoice:_0x1021a0,customer:_0x47fe20,receivable_amount:_0x2e03a1,received_amount:_0xf23396}=_0x41d34e[_0x59e8d9(0x1c3)],_0x261d1d=await sales[_0x59e8d9(0x267)](_0x3c0ee0);console[_0x59e8d9(0x1ca)](_0x261d1d);var _0x233aec=_0x2e03a1-_0xf23396;console[_0x59e8d9(0x1ca)](_0xf23396),_0x261d1d[_0x59e8d9(0x1bb)]=parseFloat(_0xf23396)+parseFloat(_0x261d1d[_0x59e8d9(0x1bb)]),_0x261d1d[_0x59e8d9(0x262)]=_0x233aec,console[_0x59e8d9(0x1ca)](_0x261d1d);const _0x134be8=await _0x261d1d[_0x59e8d9(0x29a)](),_0x2e3272=await c_payment_data[_0x59e8d9(0x264)]({'invoice':_0x1021a0});_0x2e3272['amount']=_0x233aec,await _0x2e3272[_0x59e8d9(0x29a)]();let _0x3a71fe=new Date(),_0xc9b63f=('0'+_0x3a71fe['getDate']())['slice'](-0x2),_0x487f05=('0'+(_0x3a71fe['getMonth']()+0x1))[_0x59e8d9(0x23b)](-0x2),_0x4ba9b5=_0x3a71fe[_0x59e8d9(0x294)](),_0x4d85e7=_0x4ba9b5+'-'+_0x487f05+'-'+_0xc9b63f;const _0x2c6053=new customer_payment({'invoice':_0x1021a0,'date':_0x4ba9b5+'-'+_0x487f05+'-'+_0xc9b63f,'customer':_0x47fe20,'reason':_0x59e8d9(0x1de),'amount':_0xf23396}),_0x50a73e=await _0x2c6053[_0x59e8d9(0x29a)]();_0x41d34e[_0x59e8d9(0x268)](_0x59e8d9(0x284),'payment\x20successfull'),_0x4f4bb2['redirect'](_0x59e8d9(0x1a5));}catch(_0x3cf249){console[_0x59e8d9(0x1ca)](_0x3cf249);}}),router[a0_0x414afb(0x1e4)](a0_0x414afb(0x206),auth,async(_0x5a19fb,_0x1c7718)=>{var _0x7ce537=a0_0x414afb;try{const {username:_0x7bf99f,email:_0x5eea0d,role:_0x146435}=_0x5a19fb[_0x7ce537(0x22a)],_0x1b6e94=_0x5a19fb[_0x7ce537(0x22a)],_0x51f266=await profile[_0x7ce537(0x264)]({'email':_0x1b6e94[_0x7ce537(0x22d)]}),_0x56bff0=await master_shop[_0x7ce537(0x1d8)]();console[_0x7ce537(0x1ca)](_0x7ce537(0x285),_0x56bff0);const _0x566bae=_0x5a19fb[_0x7ce537(0x1c8)]['id'],_0x64348e=await sales[_0x7ce537(0x267)](_0x566bae);console[_0x7ce537(0x1ca)](_0x64348e);const _0x53f82e=await customer['findOne']({'name':_0x64348e[_0x7ce537(0x1a1)]});console[_0x7ce537(0x1ca)](_0x53f82e);if(_0x56bff0[0x0]['language']==_0x7ce537(0x1d5)){var _0x3ad362=users[_0x7ce537(0x1b1)];console[_0x7ce537(0x1ca)](_0x3ad362);}else{if(_0x56bff0[0x0][_0x7ce537(0x257)]==_0x7ce537(0x26b))var _0x3ad362=users[_0x7ce537(0x26b)];else{if(_0x56bff0[0x0]['language']==_0x7ce537(0x28f))var _0x3ad362=users[_0x7ce537(0x28f)];else{if(_0x56bff0[0x0][_0x7ce537(0x257)]==_0x7ce537(0x195))var _0x3ad362=users[_0x7ce537(0x195)];else{if(_0x56bff0[0x0][_0x7ce537(0x257)]==_0x7ce537(0x25d))var _0x3ad362=users[_0x7ce537(0x25d)];else{if(_0x56bff0[0x0][_0x7ce537(0x257)]=='Portuguese\x20(BR)')var _0x3ad362=users[_0x7ce537(0x20b)];else{if(_0x56bff0[0x0][_0x7ce537(0x257)]=='Chinese')var _0x3ad362=users['Chinese'];else{if(_0x56bff0[0x0][_0x7ce537(0x257)]==_0x7ce537(0x1f8))var _0x3ad362=users[_0x7ce537(0x1cd)];}}}}}}}_0x1c7718['render']('sales_invoice',{'success':_0x5a19fb[_0x7ce537(0x268)](_0x7ce537(0x284)),'errors':_0x5a19fb[_0x7ce537(0x268)](_0x7ce537(0x205)),'role':_0x1b6e94,'profile':_0x51f266,'master_shop':_0x56bff0,'customers':_0x53f82e,'sales':_0x64348e,'language':_0x3ad362});}catch(_0x1de963){console[_0x7ce537(0x1ca)](_0x1de963);}}),router['get'](a0_0x414afb(0x1b5),auth,async(_0xee0e5e,_0x26006a)=>{var _0x329cb0=a0_0x414afb;try{const {username:_0x2c885f,email:_0x4113ac,role:_0x5136d4}=_0xee0e5e[_0x329cb0(0x22a)],_0x350999=_0xee0e5e[_0x329cb0(0x22a)],_0x55fa84=await profile['findOne']({'email':_0x350999[_0x329cb0(0x22d)]}),_0x28efbe=await master_shop[_0x329cb0(0x1d8)]();console['log'](_0x329cb0(0x285),_0x28efbe);const _0x380e19=_0xee0e5e[_0x329cb0(0x1c8)]['id'];console[_0x329cb0(0x1ca)](_0x380e19);const _0x5ef728=await sales['findById'](_0x380e19);console[_0x329cb0(0x1ca)](_0x329cb0(0x28d),_0x5ef728);const _0x501785=await warehouse[_0x329cb0(0x282)]([{'$match':{'name':'Return\x20Goods','room':'Return\x20Rooms'}},{'$unwind':_0x329cb0(0x1eb)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x329cb0(0x271)},'level':{'$first':_0x329cb0(0x1a0)},'isle':{'$first':_0x329cb0(0x272)},'pallet':{'$first':_0x329cb0(0x1a3)},'primary_code':{'$first':_0x329cb0(0x217)},'secondary_code':{'$first':_0x329cb0(0x1af)},'product_code':{'$first':_0x329cb0(0x1cc)}}}]);console[_0x329cb0(0x1ca)](_0x329cb0(0x28e),_0x501785);const _0x441d9e=await product['find']({});warehouse_data=await warehouse[_0x329cb0(0x282)]([{'$match':{'status':_0x329cb0(0x207),'name':'Return\x20Goods','warehouse_category':_0x329cb0(0x266)}},{'$group':{'_id':_0x329cb0(0x1a6),'name':{'$first':_0x329cb0(0x1a6)}}},{'$sort':{'name':0x1}}]);var _0x461ad4=[_0x329cb0(0x22b)];if(_0x28efbe[0x0][_0x329cb0(0x257)]=='English\x20(US)'){var _0x514ef3=users['English'];console[_0x329cb0(0x1ca)](_0x514ef3);}else{if(_0x28efbe[0x0]['language']==_0x329cb0(0x26b))var _0x514ef3=users[_0x329cb0(0x26b)];else{if(_0x28efbe[0x0][_0x329cb0(0x257)]==_0x329cb0(0x28f))var _0x514ef3=users[_0x329cb0(0x28f)];else{if(_0x28efbe[0x0][_0x329cb0(0x257)]=='Spanish')var _0x514ef3=users['Spanish'];else{if(_0x28efbe[0x0]['language']==_0x329cb0(0x25d))var _0x514ef3=users[_0x329cb0(0x25d)];else{if(_0x28efbe[0x0][_0x329cb0(0x257)]==_0x329cb0(0x1c5))var _0x514ef3=users[_0x329cb0(0x20b)];else{if(_0x28efbe[0x0]['language']==_0x329cb0(0x1ac))var _0x514ef3=users[_0x329cb0(0x1ac)];else{if(_0x28efbe[0x0][_0x329cb0(0x257)]==_0x329cb0(0x1f8))var _0x514ef3=users['Arabic'];}}}}}}}_0x26006a['render']('return_sale',{'success':_0xee0e5e[_0x329cb0(0x268)](_0x329cb0(0x284)),'errors':_0xee0e5e[_0x329cb0(0x268)](_0x329cb0(0x205)),'role':_0x350999,'profile':_0x55fa84,'user':_0x5ef728,'stock':_0x501785,'master_shop':_0x28efbe,'unit':_0x441d9e,'language':_0x514ef3,'warehouses':warehouse_data,'rooms':_0x461ad4});}catch(_0x56c306){console[_0x329cb0(0x1ca)](_0x56c306),_0x26006a[_0x329cb0(0x258)](0xc8)[_0x329cb0(0x1fe)]({'message':_0x56c306[_0x329cb0(0x1c7)]});}}),router[a0_0x414afb(0x239)]('/view/return_sales/:id',auth,async(_0x33ceac,_0x1db46c)=>{var _0x5ed44d=a0_0x414afb;try{const {invoice:_0x45f791,date:_0x332636,warehouse_name:_0x6fd6f0,product_name:_0x167ea4,primary_code:_0x5c4679,secondary_code:_0x173693,product_code:_0x312832,sales_quantity:_0x472579,stocks:_0x1557c5,return_qty:_0x4d3b3b,Room_name:_0x251c78,to_warehouse_name:_0x9aedd6,to_Roomname:_0xb57300,to_Room_name:_0x1ca7ae,note:_0x331127,level:_0x26bc5c,isle:_0x343a8f,pallet:_0x4153b7}=_0x33ceac[_0x5ed44d(0x1c3)];if(typeof _0x167ea4==_0x5ed44d(0x25c))var _0x49ee49=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1d9)]],_0x5ebdcb=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x193)]],_0x2eb46b=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1df)]],_0x35fed9=[_0x33ceac['body'][_0x5ed44d(0x27a)]],_0x1a476e=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1c9)]],_0x5ef2f9=[_0x33ceac[_0x5ed44d(0x1c3)]['stocks']],_0x2c0e4e=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x233)]],_0x4f7266=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x19f)]],_0xc7c7d2=[_0x33ceac['body'][_0x5ed44d(0x27f)]],_0x43c1eb=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x19c)]],_0x118851=[_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1dc)]];else var _0x49ee49=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1d9)]],_0x5ebdcb=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x193)]],_0x2eb46b=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1df)]],_0x35fed9=[..._0x33ceac['body'][_0x5ed44d(0x27a)]],_0x1a476e=[..._0x33ceac['body']['sales_quantity']],_0x5ef2f9=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1e1)]],_0x2c0e4e=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x233)]],_0x4f7266=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x19f)]],_0xc7c7d2=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x27f)]],_0x43c1eb=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x19c)]],_0x118851=[..._0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1dc)]];const _0x18c985=_0x49ee49[_0x5ed44d(0x222)](_0x2e6c85=>{return _0x2e6c85={'product_name':_0x2e6c85};});_0x5ebdcb[_0x5ed44d(0x1e0)]((_0x4f55e3,_0x58852d)=>{_0x18c985[_0x58852d]['primary_code']=_0x4f55e3;}),_0x2eb46b[_0x5ed44d(0x1e0)]((_0x5241ca,_0x39924a)=>{var _0x2b7e66=_0x5ed44d;_0x18c985[_0x39924a][_0x2b7e66(0x1df)]=_0x5241ca;}),_0x35fed9[_0x5ed44d(0x1e0)]((_0x271a4b,_0x1b08b1)=>{_0x18c985[_0x1b08b1]['product_code']=_0x271a4b;}),_0x1a476e['forEach']((_0x5a7354,_0x234ac9)=>{var _0x4d9979=_0x5ed44d;_0x18c985[_0x234ac9][_0x4d9979(0x1d6)]=_0x5a7354;}),_0x5ef2f9['forEach']((_0x3c9552,_0x2e6678)=>{var _0x278a44=_0x5ed44d;_0x18c985[_0x2e6678][_0x278a44(0x1d1)]=_0x3c9552;}),_0x2c0e4e[_0x5ed44d(0x1e0)]((_0x367fcf,_0x24d73d)=>{var _0x5e1d14=_0x5ed44d;_0x18c985[_0x24d73d][_0x5e1d14(0x233)]=_0x367fcf;}),_0x4f7266[_0x5ed44d(0x1e0)]((_0x394d38,_0x1e36b2)=>{var _0x25b9a9=_0x5ed44d;_0x18c985[_0x1e36b2][_0x25b9a9(0x19f)]=_0x394d38;}),_0xc7c7d2[_0x5ed44d(0x1e0)]((_0x55acfb,_0x49d1b4)=>{var _0xb9f8ad=_0x5ed44d;_0x18c985[_0x49d1b4][_0xb9f8ad(0x27f)]=_0x55acfb;}),_0x43c1eb[_0x5ed44d(0x1e0)]((_0x2526d7,_0x577561)=>{var _0xe2d884=_0x5ed44d;_0x18c985[_0x577561][_0xe2d884(0x22c)]=_0x2526d7;}),_0x118851[_0x5ed44d(0x1e0)]((_0xf78617,_0x461ccd)=>{var _0xb61a58=_0x5ed44d;_0x18c985[_0x461ccd][_0xb61a58(0x1dc)]=_0xf78617;});var _0x49f432=0x0;_0x18c985[_0x5ed44d(0x1e0)](_0x41da7b=>{var _0xad03ce=_0x5ed44d;console[_0xad03ce(0x1ca)](_0xad03ce(0x28c),_0x41da7b),(parseInt(_0x41da7b['sale_qty'])<parseInt(_0x41da7b['return_qty'])||parseInt(_0x41da7b[_0xad03ce(0x1d1)])<parseInt(_0x41da7b[_0xad03ce(0x233)])&&parseInt(_0x41da7b[_0xad03ce(0x1d6)])>parseInt(_0x41da7b[_0xad03ce(0x233)])||parseInt(_0x41da7b[_0xad03ce(0x233)])==0x0)&&_0x49f432++;});if(_0x49f432!=0x0)return _0x33ceac['flash'](_0x5ed44d(0x205),_0x5ed44d(0x27d)),_0x1db46c[_0x5ed44d(0x1bc)]('back');const _0x21db24=await sales[_0x5ed44d(0x264)]({'invoice':_0x45f791});console[_0x5ed44d(0x1ca)](_0x21db24),_0x21db24['return_data']=_0x5ed44d(0x260);const _0x5a6e96=await _0x21db24[_0x5ed44d(0x29a)](),_0x4f5ff6=new sales_return({'invoice':_0x45f791,'customer':_0x33ceac[_0x5ed44d(0x1c3)]['customer'],'date':_0x332636,'warehouse_name':_0x6fd6f0,'room':_0x251c78,'ToWarehouse':_0x9aedd6,'ToRoom':_0x1ca7ae,'return_sale':_0x18c985,'note':_0x331127}),_0x5563d7=await _0x4f5ff6[_0x5ed44d(0x29a)]();console[_0x5ed44d(0x1ca)](_0x4f5ff6);const _0x449497=await sales_return[_0x5ed44d(0x264)]({'invoice':_0x45f791}),_0x543a10=await warehouse['findOne']({'name':_0x9aedd6,'room':_0x1ca7ae});_0x449497[_0x5ed44d(0x1c2)][_0x5ed44d(0x1e0)](_0x29a507=>{var _0x3b130b=_0x5ed44d,_0x25e507=0x0;const _0x94bd9a=_0x543a10['product_details'][_0x3b130b(0x222)](_0x4ea6b7=>{var _0x9dd241=_0x3b130b;_0x4ea6b7[_0x9dd241(0x1d9)]==_0x29a507[_0x9dd241(0x1d9)]&&_0x4ea6b7[_0x9dd241(0x1dc)]==_0x29a507[_0x9dd241(0x1dc)]&&_0x4ea6b7['type']==_0x29a507['type']&&_0x4ea6b7[_0x9dd241(0x27f)]==_0x29a507[_0x9dd241(0x27f)]&&_0x4ea6b7[_0x9dd241(0x19f)]==_0x29a507[_0x9dd241(0x19f)]&&(_0x4ea6b7[_0x9dd241(0x275)]=parseInt(_0x4ea6b7[_0x9dd241(0x275)])+parseInt(_0x29a507['return_qty']),_0x25e507++);});_0x25e507=='0'&&(_0x543a10[_0x3b130b(0x19a)]=_0x543a10['product_details'][_0x3b130b(0x2a2)]({'product_name':_0x29a507[_0x3b130b(0x1d9)],'product_stock':_0x29a507[_0x3b130b(0x233)],'primary_code':_0x29a507[_0x3b130b(0x193)],'secondary_code':_0x29a507[_0x3b130b(0x1df)],'product_code':_0x29a507[_0x3b130b(0x27a)],'bay':_0x29a507['bay'],'bin':_0x29a507[_0x3b130b(0x27f)],'type':_0x29a507[_0x3b130b(0x22c)],'floorlevel':_0x29a507[_0x3b130b(0x1dc)]})),console[_0x3b130b(0x1ca)]('final',_0x543a10);}),await _0x543a10[_0x5ed44d(0x29a)](),console[_0x5ed44d(0x1ca)](_0x33ceac[_0x5ed44d(0x1c3)]);const _0x1479cc=new c_payment_data({'invoice':_0x45f791,'customer':_0x33ceac[_0x5ed44d(0x1c3)]['customer'],'reason':_0x5ed44d(0x1ef)});await _0x1479cc[_0x5ed44d(0x29a)]();const _0x357c76=await master_shop[_0x5ed44d(0x1d8)]();console[_0x5ed44d(0x1ca)]('add\x20post',_0x357c76[0x0][_0x5ed44d(0x281)]);const _0x471448=await email_settings['findOne'](),_0x1abb57=await customer[_0x5ed44d(0x264)]({'name':_0x33ceac[_0x5ed44d(0x1c3)][_0x5ed44d(0x1a1)]});console[_0x5ed44d(0x1ca)]('customer_data',_0x1abb57);_0x357c76[0x0]['currency_placement']==0x1?(right_currency=_0x357c76[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x357c76[0x0][_0x5ed44d(0x253)]);var _0xd90b47=_0x49ee49,_0x20730b=_0x2c0e4e,_0x400a9e='',_0x25e20f;for(_0x25e20f in _0xd90b47){_0x400a9e+=_0x5ed44d(0x21c)+_0x5ed44d(0x1e3)+_0xd90b47[_0x25e20f]+_0x5ed44d(0x26d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20730b[_0x25e20f]+'</td>'+_0x5ed44d(0x235);}console['log'](_0x5ed44d(0x226),_0x400a9e);let _0x119430=nodemailer['createTransport']({'service':_0x5ed44d(0x1f3),'auth':{'user':_0x471448[_0x5ed44d(0x22d)],'pass':_0x471448[_0x5ed44d(0x1b2)]}}),_0x212c3d={'from':_0x471448[_0x5ed44d(0x22d)],'to':_0x1abb57[_0x5ed44d(0x22d)],'subject':_0x5ed44d(0x196),'attachments':[{'filename':_0x5ed44d(0x194),'path':__dirname+_0x5ed44d(0x19d)+_0x5ed44d(0x223)+_0x357c76[0x0][_0x5ed44d(0x281)],'cid':_0x5ed44d(0x213)}],'html':'<!DOCTYPE\x20html>'+_0x5ed44d(0x199)+'</head><body>'+'<div>'+_0x5ed44d(0x238)+_0x5ed44d(0x1c0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5ed44d(0x23c)+'<div>'+_0x5ed44d(0x232)+_0x357c76[0x0][_0x5ed44d(0x1f4)]+'\x20</h2>'+_0x5ed44d(0x23c)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x5ed44d(0x197)+_0x5ed44d(0x255)+_0x45f791+'\x20'+_0x5ed44d(0x21f)+_0x5ed44d(0x1e2)+_0x332636+'\x20'+'</span>'+_0x5ed44d(0x23a)+'</div>'+_0x5ed44d(0x20e)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5ed44d(0x21c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x5ed44d(0x1aa)+_0x5ed44d(0x1c4)+_0x5ed44d(0x29c)+_0x5ed44d(0x235)+_0x5ed44d(0x23f)+_0x5ed44d(0x20a)+'\x20'+_0x400a9e+'\x20'+'</tbody>'+_0x5ed44d(0x1b6)+_0x5ed44d(0x1c0)+_0x5ed44d(0x1fd)+_0x5ed44d(0x1ab)+_0x357c76[0x0][_0x5ed44d(0x1f4)]+_0x5ed44d(0x23a)+_0x5ed44d(0x23c)+'</div>'+_0x5ed44d(0x27c)};_0x119430[_0x5ed44d(0x1f1)](_0x212c3d,function(_0x50f0e2,_0x13bc6f){var _0x1efdd3=_0x5ed44d;_0x50f0e2?(console[_0x1efdd3(0x1ca)](_0x50f0e2),console[_0x1efdd3(0x1ca)]('Error\x20Occurs')):console[_0x1efdd3(0x1ca)](_0x1efdd3(0x1f9));}),_0x33ceac[_0x5ed44d(0x268)](_0x5ed44d(0x284),_0x5ed44d(0x1fa)),_0x1db46c[_0x5ed44d(0x1bc)]('/all_sales/view');}catch(_0x515eac){console[_0x5ed44d(0x1ca)](_0x515eac),_0x1db46c[_0x5ed44d(0x258)](0xc8)['json']({'message1':_0x515eac[_0x5ed44d(0x1c7)]});}}),router['get'](a0_0x414afb(0x1f5),auth,async(_0x17b117,_0x38a9fd)=>{var _0x2884ea=a0_0x414afb;try{const {username:_0x696095,email:_0x3a5419,role:_0x48aad3}=_0x17b117[_0x2884ea(0x22a)],_0x39e707=_0x17b117[_0x2884ea(0x22a)],_0x272f95=await profile[_0x2884ea(0x264)]({'email':_0x39e707[_0x2884ea(0x22d)]}),_0x342f57=await master_shop[_0x2884ea(0x1d8)]();console['log'](_0x2884ea(0x1a9),_0x342f57);const _0x3e416f=_0x17b117[_0x2884ea(0x1c8)]['id'],_0x341ce4=await sales[_0x2884ea(0x267)](_0x3e416f);console['log'](_0x2884ea(0x263),_0x341ce4);if(_0x342f57[0x0]['language']==_0x2884ea(0x1d5))var _0x58949e=users[_0x2884ea(0x1b1)];else{if(_0x342f57[0x0][_0x2884ea(0x257)]=='Hindi')var _0x58949e=users['Hindi'];else{if(_0x342f57[0x0]['language']==_0x2884ea(0x28f))var _0x58949e=users[_0x2884ea(0x28f)];else{if(_0x342f57[0x0][_0x2884ea(0x257)]==_0x2884ea(0x195))var _0x58949e=users[_0x2884ea(0x195)];else{if(_0x342f57[0x0]['language']==_0x2884ea(0x25d))var _0x58949e=users[_0x2884ea(0x25d)];else{if(_0x342f57[0x0]['language']=='Portuguese\x20(BR)')var _0x58949e=users[_0x2884ea(0x20b)];else{if(_0x342f57[0x0][_0x2884ea(0x257)]=='Chinese')var _0x58949e=users[_0x2884ea(0x1ac)];else{if(_0x342f57[0x0][_0x2884ea(0x257)]==_0x2884ea(0x1f8))var _0x58949e=users[_0x2884ea(0x1cd)];}}}}}}}_0x38a9fd['render'](_0x2884ea(0x21b),{'success':_0x17b117[_0x2884ea(0x268)]('success'),'errors':_0x17b117[_0x2884ea(0x268)](_0x2884ea(0x205)),'role':_0x39e707,'profile':_0x272f95,'alldata':_0x341ce4,'master_shop':_0x342f57,'language':_0x58949e});}catch(_0x1437be){console[_0x2884ea(0x1ca)](_0x1437be);}}),router[a0_0x414afb(0x239)]('/barcode_scanner',async(_0xd4a500,_0xb3c890)=>{var _0x5b7a4f=a0_0x414afb;const {product_code:_0x206883,warehouse_name:_0x16521b,rooms_data:_0x181951,Roomslist:_0xc7d8d3}=_0xd4a500[_0x5b7a4f(0x1c3)],_0x24b03c=_0xc7d8d3[_0x5b7a4f(0x26f)](','),_0x446658=[];async function _0x324deb(_0x50f177){var _0x1387ec=_0x5b7a4f;const _0x20d240=await warehouse['aggregate']([{'$match':{'name':_0x16521b,'room':_0x50f177}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x206883}},{'$group':{'_id':_0x1387ec(0x243),'name':{'$first':_0x1387ec(0x245)},'product_stock':{'$first':_0x1387ec(0x271)},'primary_code':{'$first':_0x1387ec(0x217)},'secondary_code':{'$first':_0x1387ec(0x1af)},'product_code':{'$first':_0x1387ec(0x1cc)},'level':{'$first':_0x1387ec(0x261)},'isle':{'$first':_0x1387ec(0x249)},'type':{'$first':_0x1387ec(0x236)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1387ec(0x252)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1387ec(0x1e8)},'expiry_date':{'$first':_0x1387ec(0x204)},'production_date':{'$first':_0x1387ec(0x23d)},'maxPerUnit':{'$first':_0x1387ec(0x27e)},'batch_code':{'$first':_0x1387ec(0x229)},'product_cat':{'$first':_0x1387ec(0x1cb)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1387ec(0x296)},'invoice':{'$first':'$product_details.invoice'},'actual_qty':{'$first':_0x1387ec(0x218)},'actual_uom':{'$first':_0x1387ec(0x273)}}}]),_0x3d4dee=await warehouse[_0x1387ec(0x282)]([{'$match':{'name':_0x16521b,'room':_0x50f177}},{'$unwind':_0x1387ec(0x1eb)},{'$match':{'product_details.secondary_code':_0x206883}},{'$group':{'_id':_0x1387ec(0x243),'name':{'$first':_0x1387ec(0x245)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1387ec(0x217)},'secondary_code':{'$first':_0x1387ec(0x1af)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1387ec(0x261)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1387ec(0x236)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1387ec(0x228)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1387ec(0x1e8)},'expiry_date':{'$first':_0x1387ec(0x204)},'production_date':{'$first':_0x1387ec(0x23d)},'maxPerUnit':{'$first':_0x1387ec(0x27e)},'batch_code':{'$first':_0x1387ec(0x229)},'product_cat':{'$first':_0x1387ec(0x1cb)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x1387ec(0x296)},'invoice':{'$first':_0x1387ec(0x1ea)}}}]);if(_0x20d240['length']>0x0)_0x446658[_0x1387ec(0x270)](_0x20d240);else _0x3d4dee[_0x1387ec(0x234)]>0x0&&_0x446658[_0x1387ec(0x270)](_0x3d4dee);}const _0x35b931=_0x24b03c[_0x5b7a4f(0x222)](_0x129ff9=>_0x324deb(_0x129ff9));await Promise[_0x5b7a4f(0x1b4)](_0x35b931),_0xb3c890[_0x5b7a4f(0x1fe)](_0x446658);}),module['exports']=router;