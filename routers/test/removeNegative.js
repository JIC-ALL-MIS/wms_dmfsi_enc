const a0_0x310508=a0_0x1256;function a0_0x3879(){const _0x2e8559=['$product','14800005047429','$product.id_transaction_id','218792jOSmSh','$sale_product.invoice','$name','1041786MXOGzD','updateMany','$$invoice','../../models/all_models','116004SyEfDb','$product.to_room_name','$product_details.invoice','aggregate','$invoice','modifiedCount','$warehouse_name','$product_details.product_code','map','$sale_product.product_name','errors','/join','$product.product_code','$sale_product.room_name','$sale_product','/warehouse_monitor','warehouse_data','data_sales','$product_details','\x20documents\x20updated','exports','Router','$sale_product.id_transaction_from','invoice','get','475923kxIMLI','$product_details.product_stock','data_transfer','$product.new_adjust_qty','flash','$product.invoice','480148SPJWZH','$product.product_name','$product._id','162671pxVNbq','length','push','table\x20page','$to_warehouse','valueOf','status','$product.id_transaction_from','$sale_product._id','171475dnytGd','_id','log','/checking','render','json','all','message','$sale_product.product_code','$room','monitor','data_adjustment'];a0_0x3879=function(){return _0x2e8559;};return a0_0x3879();}(function(_0x5a3a75,_0x553357){const _0xd1d592=a0_0x1256,_0x3aacf2=_0x5a3a75();while(!![]){try{const _0x57ca19=parseInt(_0xd1d592(0x1c0))/0x1+parseInt(_0xd1d592(0x19e))/0x2+-parseInt(_0xd1d592(0x1b7))/0x3+-parseInt(_0xd1d592(0x1bd))/0x4+-parseInt(_0xd1d592(0x1c9))/0x5+parseInt(_0xd1d592(0x1db))/0x6+parseInt(_0xd1d592(0x1d8))/0x7;if(_0x57ca19===_0x553357)break;else _0x3aacf2['push'](_0x3aacf2['shift']());}catch(_0x11a487){_0x3aacf2['push'](_0x3aacf2['shift']());}}}(a0_0x3879,0x1b7cb));const express=require('express'),app=express(),router=express[a0_0x310508(0x1b3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require(a0_0x310508(0x19d));function a0_0x1256(_0x356af9,_0x3624c0){const _0x38790e=a0_0x3879();return a0_0x1256=function(_0x125667,_0x9e7cb8){_0x125667=_0x125667-0x19c;let _0x2b5f98=_0x38790e[_0x125667];return _0x2b5f98;},a0_0x1256(_0x356af9,_0x3624c0);}router[a0_0x310508(0x1b6)]('/negative',async(_0x195048,_0x5fe469)=>{const _0x22e730=a0_0x310508;try{const _0x4070dd=await warehouse[_0x22e730(0x1dc)]({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x5fe469[_0x22e730(0x1ce)]({'status':_0x4070dd[_0x22e730(0x1a3)]+_0x22e730(0x1b1)});}catch(_0x5348cd){console[_0x22e730(0x1cb)]('table\x20page',_0x5348cd),_0x5fe469[_0x22e730(0x1c6)](0xc8)[_0x22e730(0x1ce)]({'message':_0x5348cd['message']});}}),router[a0_0x310508(0x1b6)](a0_0x310508(0x1cc),async(_0x2cde74,_0x1837b6)=>{const _0x46c722=a0_0x310508;try{const _0x1f3cdb=await warehouse[_0x46c722(0x1a1)]([{'$unwind':_0x46c722(0x1b0)},{'$match':{'product_details.invoice':'INCF-52068316','product_details.primary_code':_0x46c722(0x1d6)}},{'$group':{'_id':{'name':_0x46c722(0x1da),'room':_0x46c722(0x1d2)},'products':{'$push':_0x46c722(0x1b0)}}}]);_0x1837b6[_0x46c722(0x1ce)](_0x1f3cdb);}catch(_0x5ca189){console[_0x46c722(0x1cb)](_0x46c722(0x1c3),_0x5ca189),_0x1837b6['status'](0xc8)[_0x46c722(0x1ce)]({'message':_0x5ca189[_0x46c722(0x1d0)]});}}),router[a0_0x310508(0x1b6)](a0_0x310508(0x1ad),async(_0xc5056d,_0x591f12)=>{const _0x9fb62c=a0_0x310508;_0x591f12[_0x9fb62c(0x1cd)](_0x9fb62c(0x1d3),{'success':_0xc5056d['flash']('success'),'errors':_0xc5056d[_0x9fb62c(0x1bb)](_0x9fb62c(0x1a8))});}),router[a0_0x310508(0x1b6)](a0_0x310508(0x1a9),async(_0x2c4889,_0x33f5fd)=>{const _0x446ee4=a0_0x310508;var _0x50b0ce=await purchases['aggregate']([{'$lookup':{'from':'warehouses','let':{'invoice':_0x446ee4(0x1a2)},'pipeline':[{'$unwind':_0x446ee4(0x1b0)},{'$match':{'$expr':{'$eq':[_0x446ee4(0x19c),_0x446ee4(0x1a0)]}}},{'$project':{'_id':'$product_details._id','product_name':'$product_details.product_name','product_code':_0x446ee4(0x1a5),'quantity_available':_0x446ee4(0x1b8),'warehouse_name':_0x446ee4(0x1da),'warehouse_room':'$room','invoice':_0x446ee4(0x1a0)}}],'as':'warehouse_data'}}]);_0x50b0ce[_0x446ee4(0x1af)]={},await Promise[_0x446ee4(0x1cf)](_0x50b0ce[_0x446ee4(0x1a6)](async _0x564d22=>{const _0x3bbc10=_0x446ee4;_0x50b0ce[_0x3bbc10(0x1af)][_0x564d22[_0x3bbc10(0x1b5)]]=[],await Promise['all'](_0x564d22[_0x3bbc10(0x1ae)][_0x3bbc10(0x1a6)](async _0x5617ab=>{const _0x13bf90=_0x3bbc10,_0x9c8526=await sales[_0x13bf90(0x1a1)]([{'$unwind':_0x13bf90(0x1ac)},{'$match':{'sale_product.id_transaction_from':_0x5617ab['_id'][_0x13bf90(0x1c5)](),'sale_product.invoice':_0x5617ab[_0x13bf90(0x1b5)]}},{'$project':{'_id':_0x13bf90(0x1c8),'product_name':_0x13bf90(0x1a7),'product_code':_0x13bf90(0x1d1),'quantity_available':'$sale_product.quantity','warehouse_name':_0x13bf90(0x1a4),'warehouse_room':_0x13bf90(0x1ab),'product_invoice':_0x13bf90(0x1d9),'invoice':_0x13bf90(0x1a2),'id_transaction_from':_0x13bf90(0x1b4)}}]);_0x9c8526[_0x13bf90(0x1c1)]>0x0&&_0x50b0ce['data_sales'][_0x564d22[_0x13bf90(0x1b5)]]['push'](..._0x9c8526);}));})),_0x50b0ce[_0x446ee4(0x1af)]=_0x50b0ce['data_sales'],_0x50b0ce['data_adjustment']={},await Promise[_0x446ee4(0x1cf)](_0x50b0ce['map'](async _0x180f56=>{_0x50b0ce['data_adjustment'][_0x180f56['invoice']]=[],await Promise['all'](_0x180f56['warehouse_data']['map'](async _0x131cdf=>{const _0x3eb67d=a0_0x1256,_0x11fcc1=await adjustment['aggregate']([{'$unwind':_0x3eb67d(0x1d5)},{'$match':{'product.id_transaction_from':_0x131cdf[_0x3eb67d(0x1ca)][_0x3eb67d(0x1c5)](),'product.invoice':_0x131cdf['invoice']}},{'$project':{'_id':_0x3eb67d(0x1bf),'product_name':'$product.product_name','product_code':_0x3eb67d(0x1aa),'quantity_available':_0x3eb67d(0x1ba),'warehouse_name':_0x3eb67d(0x1a4),'warehouse_room':'$product.room_names','product_invoice':_0x3eb67d(0x1bc),'invoice':_0x3eb67d(0x1a2),'id_transaction_from':_0x3eb67d(0x1c7)}}]);_0x11fcc1['length']>0x0&&_0x50b0ce[_0x3eb67d(0x1d4)][_0x180f56[_0x3eb67d(0x1b5)]][_0x3eb67d(0x1c2)](..._0x11fcc1);}));})),_0x50b0ce['data_transfer']={},await Promise[_0x446ee4(0x1cf)](_0x50b0ce[_0x446ee4(0x1a6)](async _0x2aa2fb=>{const _0x291a4a=_0x446ee4;_0x50b0ce[_0x291a4a(0x1b9)][_0x2aa2fb[_0x291a4a(0x1b5)]]=[],await Promise['all'](_0x2aa2fb[_0x291a4a(0x1ae)][_0x291a4a(0x1a6)](async _0x299397=>{const _0x371cb9=_0x291a4a,_0x104e71=await transfers[_0x371cb9(0x1a1)]([{'$unwind':_0x371cb9(0x1d5)},{'$match':{'product.id_transaction_id':_0x299397[_0x371cb9(0x1ca)][_0x371cb9(0x1c5)](),'product.To_invoice':_0x299397['invoice']}},{'$project':{'_id':_0x371cb9(0x1bf),'product_name':_0x371cb9(0x1be),'product_code':_0x371cb9(0x1aa),'quantity_available':'$product.to_quantity','warehouse_name':_0x371cb9(0x1c4),'warehouse_room':'$product.room_names','product_invoice':_0x371cb9(0x19f),'invoice':_0x371cb9(0x1a2),'id_transaction_id':_0x371cb9(0x1d7)}}]);console['log'](_0x104e71),_0x104e71[_0x371cb9(0x1c1)]>0x0&&_0x50b0ce[_0x371cb9(0x1b9)][_0x2aa2fb[_0x371cb9(0x1b5)]][_0x371cb9(0x1c2)](..._0x104e71);}));})),_0x33f5fd['json']({'purchases_warehouse':_0x50b0ce,'data_sales':_0x50b0ce[_0x446ee4(0x1af)],'data_adjustment':_0x50b0ce[_0x446ee4(0x1d4)],'data_transfer':_0x50b0ce[_0x446ee4(0x1b9)]});}),module[a0_0x310508(0x1b2)]=router;