const a0_0x1d77a3=a0_0x3d65;function a0_0x3d65(_0x13df03,_0x56f7af){const _0x28bfcc=a0_0x28bf();return a0_0x3d65=function(_0x3d6585,_0x437a2e){_0x3d6585=_0x3d6585-0x1e1;let _0x3a4576=_0x28bfcc[_0x3d6585];return _0x3a4576;},a0_0x3d65(_0x13df03,_0x56f7af);}(function(_0x456d38,_0x2e59bb){const _0x15d000=a0_0x3d65,_0x4261b2=_0x456d38();while(!![]){try{const _0x26c08d=parseInt(_0x15d000(0x208))/0x1+parseInt(_0x15d000(0x206))/0x2*(-parseInt(_0x15d000(0x201))/0x3)+parseInt(_0x15d000(0x20b))/0x4+parseInt(_0x15d000(0x21f))/0x5*(-parseInt(_0x15d000(0x213))/0x6)+-parseInt(_0x15d000(0x1fd))/0x7*(parseInt(_0x15d000(0x1eb))/0x8)+-parseInt(_0x15d000(0x203))/0x9*(-parseInt(_0x15d000(0x1f2))/0xa)+parseInt(_0x15d000(0x20f))/0xb;if(_0x26c08d===_0x2e59bb)break;else _0x4261b2['push'](_0x4261b2['shift']());}catch(_0x1fd441){_0x4261b2['push'](_0x4261b2['shift']());}}}(a0_0x28bf,0xe46e1));function a0_0x28bf(){const _0x4a940b=['message','$sale_product','3612174kkwQSA','push','1269663YgaEpc','$warehouse_name','modifiedCount','7290516ySexnh','$product.to_quantity','$sale_product.invoice','\x20documents\x20updated','23378762pWEGVJ','invoice','table\x20page','$sale_product.room_name','3702GYNdQr','data_adjustment','$product.product_code','INCF-52068316','render','_id','$product_details.product_code','$product.product_name','success','flash','$product.id_transaction_from','status','13945aaPDtc','map','$room','$$invoice','$invoice','$product','$product_details','log','all','$product_details.product_name','json','/warehouse_monitor','$name','8FtqaSr','length','valueOf','warehouse_data','warehouses','/checking','Router','4540HOksLB','get','$product.id_transaction_id','aggregate','errors','$product_details.invoice','exports','$product_details._id','express','$sale_product.quantity','$product_details.product_stock','6728407NLZzDs','data_sales','$product._id','/join','3vZxCqz','$product.room_names','4086ZNySsy'];a0_0x28bf=function(){return _0x4a940b;};return a0_0x28bf();}const express=require(a0_0x1d77a3(0x1fa)),app=express(),router=express[a0_0x1d77a3(0x1f1)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings,purchases_finished,sales_finished,adjustment_finished,transfers,transfers_finished,sales,adjustment}=require('../../models/all_models');router[a0_0x1d77a3(0x1f3)]('/negative',async(_0x5bca78,_0x3efdd6)=>{const _0x4391ef=a0_0x1d77a3;try{const _0x475663=await warehouse['updateMany']({'product_details.product_stock':{'$lt':0x0}},{'$mul':{'product_details.$[elem].product_stock':-0x1}},{'arrayFilters':[{'elem.product_stock':{'$lt':0x0}}]});_0x3efdd6[_0x4391ef(0x1e8)]({'status':_0x475663[_0x4391ef(0x20a)]+_0x4391ef(0x20e)});}catch(_0x4e0493){console[_0x4391ef(0x1e5)](_0x4391ef(0x211),_0x4e0493),_0x3efdd6[_0x4391ef(0x21e)](0xc8)[_0x4391ef(0x1e8)]({'message':_0x4e0493[_0x4391ef(0x204)]});}}),router['get'](a0_0x1d77a3(0x1f0),async(_0x366c93,_0x3f8310)=>{const _0x55f1aa=a0_0x1d77a3;try{const _0x59b9c9=await warehouse[_0x55f1aa(0x1f5)]([{'$unwind':_0x55f1aa(0x1e4)},{'$match':{'product_details.invoice':_0x55f1aa(0x216),'product_details.primary_code':'14800005047429'}},{'$group':{'_id':{'name':_0x55f1aa(0x1ea),'room':'$room'},'products':{'$push':_0x55f1aa(0x1e4)}}}]);_0x3f8310[_0x55f1aa(0x1e8)](_0x59b9c9);}catch(_0x26ce22){console[_0x55f1aa(0x1e5)](_0x55f1aa(0x211),_0x26ce22),_0x3f8310[_0x55f1aa(0x21e)](0xc8)[_0x55f1aa(0x1e8)]({'message':_0x26ce22[_0x55f1aa(0x204)]});}}),router[a0_0x1d77a3(0x1f3)](a0_0x1d77a3(0x1e9),async(_0x37de77,_0xe66fb9)=>{const _0x6647e2=a0_0x1d77a3;_0xe66fb9[_0x6647e2(0x217)]('monitor',{'success':_0x37de77[_0x6647e2(0x21c)](_0x6647e2(0x21b)),'errors':_0x37de77[_0x6647e2(0x21c)](_0x6647e2(0x1f6))});}),router[a0_0x1d77a3(0x1f3)](a0_0x1d77a3(0x200),async(_0x414f92,_0x36ac2d)=>{const _0x6670dc=a0_0x1d77a3;var _0xe38fd5=await purchases[_0x6670dc(0x1f5)]([{'$lookup':{'from':_0x6670dc(0x1ef),'let':{'invoice':'$invoice'},'pipeline':[{'$unwind':_0x6670dc(0x1e4)},{'$match':{'$expr':{'$eq':[_0x6670dc(0x1e1),_0x6670dc(0x1f7)]}}},{'$project':{'_id':_0x6670dc(0x1f9),'product_name':_0x6670dc(0x1e7),'product_code':_0x6670dc(0x219),'quantity_available':_0x6670dc(0x1fc),'warehouse_name':_0x6670dc(0x1ea),'warehouse_room':_0x6670dc(0x221),'invoice':'$product_details.invoice'}}],'as':_0x6670dc(0x1ee)}}]);_0xe38fd5['data_sales']={},await Promise[_0x6670dc(0x1e6)](_0xe38fd5[_0x6670dc(0x220)](async _0x46998c=>{const _0x571e1f=_0x6670dc;_0xe38fd5[_0x571e1f(0x1fe)][_0x46998c['invoice']]=[],await Promise[_0x571e1f(0x1e6)](_0x46998c[_0x571e1f(0x1ee)]['map'](async _0x3c9440=>{const _0x221f22=_0x571e1f,_0x545753=await sales[_0x221f22(0x1f5)]([{'$unwind':_0x221f22(0x205)},{'$match':{'sale_product.id_transaction_from':_0x3c9440[_0x221f22(0x218)][_0x221f22(0x1ed)](),'sale_product.invoice':_0x3c9440[_0x221f22(0x210)]}},{'$project':{'_id':'$sale_product._id','product_name':'$sale_product.product_name','product_code':'$sale_product.product_code','quantity_available':_0x221f22(0x1fb),'warehouse_name':_0x221f22(0x209),'warehouse_room':_0x221f22(0x212),'product_invoice':_0x221f22(0x20d),'invoice':_0x221f22(0x1e2),'id_transaction_from':'$sale_product.id_transaction_from'}}]);_0x545753[_0x221f22(0x1ec)]>0x0&&_0xe38fd5[_0x221f22(0x1fe)][_0x46998c[_0x221f22(0x210)]]['push'](..._0x545753);}));})),_0xe38fd5[_0x6670dc(0x1fe)]=_0xe38fd5[_0x6670dc(0x1fe)],_0xe38fd5[_0x6670dc(0x214)]={},await Promise[_0x6670dc(0x1e6)](_0xe38fd5[_0x6670dc(0x220)](async _0x16dafe=>{const _0x3e3d78=_0x6670dc;_0xe38fd5[_0x3e3d78(0x214)][_0x16dafe[_0x3e3d78(0x210)]]=[],await Promise[_0x3e3d78(0x1e6)](_0x16dafe['warehouse_data'][_0x3e3d78(0x220)](async _0x4ce5fa=>{const _0x20e65a=_0x3e3d78,_0x3329aa=await adjustment[_0x20e65a(0x1f5)]([{'$unwind':_0x20e65a(0x1e3)},{'$match':{'product.id_transaction_from':_0x4ce5fa['_id']['valueOf'](),'product.invoice':_0x4ce5fa[_0x20e65a(0x210)]}},{'$project':{'_id':'$product._id','product_name':_0x20e65a(0x21a),'product_code':_0x20e65a(0x215),'quantity_available':'$product.new_adjust_qty','warehouse_name':_0x20e65a(0x209),'warehouse_room':'$product.room_names','product_invoice':'$product.invoice','invoice':_0x20e65a(0x1e2),'id_transaction_from':_0x20e65a(0x21d)}}]);_0x3329aa[_0x20e65a(0x1ec)]>0x0&&_0xe38fd5[_0x20e65a(0x214)][_0x16dafe[_0x20e65a(0x210)]][_0x20e65a(0x207)](..._0x3329aa);}));})),_0xe38fd5['data_transfer']={},await Promise['all'](_0xe38fd5[_0x6670dc(0x220)](async _0x48c618=>{const _0x94681a=_0x6670dc;_0xe38fd5['data_transfer'][_0x48c618['invoice']]=[],await Promise[_0x94681a(0x1e6)](_0x48c618[_0x94681a(0x1ee)][_0x94681a(0x220)](async _0x22aced=>{const _0x315b71=_0x94681a,_0xa114f2=await transfers[_0x315b71(0x1f5)]([{'$unwind':'$product'},{'$match':{'product.id_transaction_id':_0x22aced[_0x315b71(0x218)][_0x315b71(0x1ed)](),'product.To_invoice':_0x22aced[_0x315b71(0x210)]}},{'$project':{'_id':_0x315b71(0x1ff),'product_name':_0x315b71(0x21a),'product_code':_0x315b71(0x215),'quantity_available':_0x315b71(0x20c),'warehouse_name':'$to_warehouse','warehouse_room':_0x315b71(0x202),'product_invoice':'$product.to_room_name','invoice':_0x315b71(0x1e2),'id_transaction_id':_0x315b71(0x1f4)}}]);console[_0x315b71(0x1e5)](_0xa114f2),_0xa114f2[_0x315b71(0x1ec)]>0x0&&_0xe38fd5['data_transfer'][_0x48c618[_0x315b71(0x210)]][_0x315b71(0x207)](..._0xa114f2);}));})),_0x36ac2d[_0x6670dc(0x1e8)]({'purchases_warehouse':_0xe38fd5,'data_sales':_0xe38fd5[_0x6670dc(0x1fe)],'data_adjustment':_0xe38fd5[_0x6670dc(0x214)],'data_transfer':_0xe38fd5['data_transfer']});}),module[a0_0x1d77a3(0x1f8)]=router;