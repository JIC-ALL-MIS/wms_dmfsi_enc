var a0_0x553593=a0_0x871f;(function(_0x5366ac,_0x371b2a){var _0x4f8f4a=a0_0x871f,_0x346782=_0x5366ac();while(!![]){try{var _0x4f5d42=parseInt(_0x4f8f4a(0x264))/0x1*(parseInt(_0x4f8f4a(0x1b6))/0x2)+-parseInt(_0x4f8f4a(0x1d5))/0x3+parseInt(_0x4f8f4a(0x231))/0x4*(-parseInt(_0x4f8f4a(0x246))/0x5)+-parseInt(_0x4f8f4a(0x259))/0x6*(parseInt(_0x4f8f4a(0x217))/0x7)+-parseInt(_0x4f8f4a(0x25c))/0x8*(-parseInt(_0x4f8f4a(0x24b))/0x9)+parseInt(_0x4f8f4a(0x256))/0xa+parseInt(_0x4f8f4a(0x221))/0xb*(parseInt(_0x4f8f4a(0x18c))/0xc);if(_0x4f5d42===_0x371b2a)break;else _0x346782['push'](_0x346782['shift']());}catch(_0x485bd4){_0x346782['push'](_0x346782['shift']());}}}(a0_0x578a,0xbc39d));const express=require(a0_0x553593(0x25e)),app=express(),router=express[a0_0x553593(0x1fc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,email_settings,supervisor_settings}=require(a0_0x553593(0x26f)),auth=require('../middleware/auth'),users=require(a0_0x553593(0x261)),nodemailer=require('nodemailer');router[a0_0x553593(0x1e8)](a0_0x553593(0x1ef),auth,async(_0x5f07fd,_0x400e7e)=>{var _0x3b70fb=a0_0x553593;try{const {username:_0x30bad6,email:_0x15b591,role:_0x1fc0e3}=_0x5f07fd['user'],_0x5aa1e2=_0x5f07fd[_0x3b70fb(0x22a)],_0x4c33ff=await profile[_0x3b70fb(0x18e)]({'email':_0x5aa1e2[_0x3b70fb(0x1b9)]}),_0x190a8a=await master_shop[_0x3b70fb(0x26a)]();console[_0x3b70fb(0x1ab)](_0x3b70fb(0x21d),_0x190a8a);let _0x536945;if(_0x5aa1e2[_0x3b70fb(0x230)]==_0x3b70fb(0x23f)){const _0x5c3b4c=await staff[_0x3b70fb(0x18e)]({'email':_0x5aa1e2[_0x3b70fb(0x1b9)]});_0x536945=await transfers[_0x3b70fb(0x26a)]({'from_warehouse':_0x5c3b4c[_0x3b70fb(0x204)]});}else _0x536945=await transfers[_0x3b70fb(0x26b)]([{'$unwind':_0x3b70fb(0x1f5)},{'$group':{'_id':_0x3b70fb(0x1c5),'invoice':{'$first':_0x3b70fb(0x268)},'date':{'$first':_0x3b70fb(0x19e)},'from_warehouse':{'$first':_0x3b70fb(0x271)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x3b70fb(0x245)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x190a8a[0x0][_0x3b70fb(0x250)]==_0x3b70fb(0x1f1)){var _0x96b8f3=users[_0x3b70fb(0x1d1)];console[_0x3b70fb(0x1ab)](_0x96b8f3);}else{if(_0x190a8a[0x0][_0x3b70fb(0x250)]==_0x3b70fb(0x1fa))var _0x96b8f3=users[_0x3b70fb(0x1fa)];else{if(_0x190a8a[0x0][_0x3b70fb(0x250)]==_0x3b70fb(0x19d))var _0x96b8f3=users['German'];else{if(_0x190a8a[0x0][_0x3b70fb(0x250)]=='Spanish')var _0x96b8f3=users['Spanish'];else{if(_0x190a8a[0x0][_0x3b70fb(0x250)]=='French')var _0x96b8f3=users[_0x3b70fb(0x25f)];else{if(_0x190a8a[0x0]['language']==_0x3b70fb(0x206))var _0x96b8f3=users['Portuguese'];else{if(_0x190a8a[0x0][_0x3b70fb(0x250)]==_0x3b70fb(0x192))var _0x96b8f3=users[_0x3b70fb(0x192)];else{if(_0x190a8a[0x0][_0x3b70fb(0x250)]==_0x3b70fb(0x1ed))var _0x96b8f3=users[_0x3b70fb(0x237)];}}}}}}}_0x400e7e[_0x3b70fb(0x1f9)](_0x3b70fb(0x1cd),{'success':_0x5f07fd[_0x3b70fb(0x22d)](_0x3b70fb(0x213)),'errors':_0x5f07fd[_0x3b70fb(0x22d)]('errors'),'role':_0x5aa1e2,'profile':_0x4c33ff,'master_shop':_0x190a8a,'transfer':_0x536945,'language':_0x96b8f3});}catch(_0x20bc29){console[_0x3b70fb(0x1ab)](_0x20bc29);}});async function getRandom8DigitNumber(){var _0x1d83a0=a0_0x553593;const _0x364ef4=0x989680,_0x205e78=0x5f5e0ff,_0x2c3e25=Math[_0x1d83a0(0x1d0)](Math[_0x1d83a0(0x25a)]()*(_0x205e78-_0x364ef4+0x1))+_0x364ef4;var _0x5e3fb5;const _0x262d7b=await transfers['findOne']({'invoice':_0x1d83a0(0x25d)+_0x2c3e25});return _0x262d7b&&_0x262d7b[_0x1d83a0(0x222)]>0x0?_0x5e3fb5=_0x1d83a0(0x25d)+_0x2c3e25:_0x5e3fb5='TRF-'+_0x2c3e25,_0x5e3fb5;}router[a0_0x553593(0x1e8)](a0_0x553593(0x200),auth,async(_0x59c7fd,_0x1f5c4b)=>{var _0x25f3c2=a0_0x553593;try{const {username:_0x282929,email:_0x330362,role:_0x259d49}=_0x59c7fd[_0x25f3c2(0x22a)],_0x1f5b3b=_0x59c7fd[_0x25f3c2(0x22a)],_0x7951d3=await profile[_0x25f3c2(0x18e)]({'email':_0x1f5b3b[_0x25f3c2(0x1b9)]}),_0x104576=await master_shop['find']();console['log'](_0x25f3c2(0x21d),_0x104576);let _0x4978e6;if(_0x1f5b3b[_0x25f3c2(0x230)]=='staff'){const _0x5e0dbc=await staff[_0x25f3c2(0x18e)]({'email':_0x1f5b3b['email']});_0x4978e6=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x5e0dbc[_0x25f3c2(0x204)],'warehouse_category':_0x25f3c2(0x26c)}},{'$group':{'_id':'$name','name':{'$first':_0x25f3c2(0x1b4)}}}]);}else _0x4978e6=await warehouse[_0x25f3c2(0x26b)]([{'$match':{'status':_0x25f3c2(0x234),'warehouse_category':_0x25f3c2(0x26c)}},{'$group':{'_id':_0x25f3c2(0x1b4),'name':{'$first':_0x25f3c2(0x1b4)}}}]);var _0x325413=['Ambient',_0x25f3c2(0x203),_0x25f3c2(0x24e)];const _0x4ac2c6=await transfers[_0x25f3c2(0x26a)]({}),_0x2f2624=_0x4ac2c6['length']+0x1,_0x41e6cd=_0x25f3c2(0x25d)+_0x2f2624['toString']()[_0x25f3c2(0x224)](0x5,'0');if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x1f1)){var _0x55d71a=users['English'];console[_0x25f3c2(0x1ab)](_0x55d71a);}else{if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x1fa))var _0x55d71a=users[_0x25f3c2(0x1fa)];else{if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x19d))var _0x55d71a=users[_0x25f3c2(0x19d)];else{if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x1a7))var _0x55d71a=users[_0x25f3c2(0x1a7)];else{if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x25f))var _0x55d71a=users['French'];else{if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x206))var _0x55d71a=users[_0x25f3c2(0x260)];else{if(_0x104576[0x0]['language']==_0x25f3c2(0x192))var _0x55d71a=users['Chinese'];else{if(_0x104576[0x0][_0x25f3c2(0x250)]==_0x25f3c2(0x1ed))var _0x55d71a=users[_0x25f3c2(0x237)];}}}}}}}const _0x6110b6=getRandom8DigitNumber();_0x6110b6[_0x25f3c2(0x22b)](_0x5789e8=>{var _0x3b1e64=_0x25f3c2;_0x1f5c4b['render'](_0x3b1e64(0x1d4),{'success':_0x59c7fd[_0x3b1e64(0x22d)](_0x3b1e64(0x213)),'errors':_0x59c7fd[_0x3b1e64(0x22d)](_0x3b1e64(0x1fb)),'role':_0x1f5b3b,'profile':_0x7951d3,'master_shop':_0x104576,'warehouse':_0x4978e6,'language':_0x55d71a,'rooms_data':_0x325413,'invoice':_0x5789e8});})[_0x25f3c2(0x1dc)](_0x459cfc=>{var _0x592a66=_0x25f3c2;_0x59c7fd[_0x592a66(0x22d)]('errors',_0x592a66(0x1a2)),_0x1f5c4b[_0x592a66(0x19b)]('/transfer/view');});}catch(_0x3f3006){console['log'](_0x3f3006);}}),router[a0_0x553593(0x215)]('/view/add_transfer',auth,async(_0x48d794,_0x3ce9ef)=>{var _0x18b3af=a0_0x553593;try{console[_0x18b3af(0x1ab)](_0x48d794[_0x18b3af(0x18b)]);const {date:_0x5576b8,from_warehouse:_0x287b80,FromRoom_name:_0x317d2c,to_warehouse:_0x455879,ToRoom_name:_0x814f8f,prod_name:_0x2d8543,from_prod_qty:_0x30b044,from_prod_level:_0x45f8eb,from_prod_isle:_0x14e53f,from_prod_pallet:_0x100f4e,to_prod_qty:_0x3e92cc,to_prod_level:_0x1c4831,to_prod_isle:_0x2044c1,to_prod_pallet:_0x523bf9,primary_code:_0x4b2338,secondary_code:_0x32e810,product_code3:_0x64a80f,note:_0x3b5ca2,MaxStocks_data2:_0xbe47b9,invoice:_0x283d11,expiry_date:_0x55e6b2}=_0x48d794['body'];if(typeof _0x2d8543=='string')var _0x1f5c49=[_0x48d794['body']['prod_name']],_0x47c5b5=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x219)]],_0x418b52=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x191)]],_0x24d54e=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x239)]],_0x15a07d=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x18f)]],_0x578035=[_0x48d794['body'][_0x18b3af(0x1ce)]],_0x3b6692=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x194)]],_0x1cc962=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x24a)]],_0xe59d5a=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1ca)]],_0xc843ea=[_0x48d794['body']['primary_unit']],_0x353c6b=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x244)]],_0x5f4579=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1aa)]],_0x3e5a87=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x211)]],_0x183fe4=[_0x48d794[_0x18b3af(0x18b)]['max_per_unit']],_0x518192=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1a4)]],_0x577e18=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1c9)]],_0x32ce90=[_0x48d794['body'][_0x18b3af(0x22e)]],_0x56acd2=[_0x48d794['body'][_0x18b3af(0x1d2)]],_0x3975fe=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x216)]],_0x473dc0=[_0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x247)]];else var _0x1f5c49=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1e7)]],_0x47c5b5=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x219)]],_0x418b52=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x191)]],_0x24d54e=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x239)]],_0x15a07d=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x18f)]],_0x578035=[..._0x48d794['body'][_0x18b3af(0x1ce)]],_0x3b6692=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x194)]],_0x1cc962=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x24a)]],_0xe59d5a=[..._0x48d794['body'][_0x18b3af(0x1ca)]],_0xc843ea=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x202)]],_0x353c6b=[..._0x48d794['body'][_0x18b3af(0x244)]],_0x5f4579=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1aa)]],_0x3e5a87=[..._0x48d794['body']['expiry_date']],_0x183fe4=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x23a)]],_0x518192=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x1a4)]],_0x577e18=[..._0x48d794['body'][_0x18b3af(0x1c9)]],_0x32ce90=[..._0x48d794[_0x18b3af(0x18b)]['RoomAssigned']],_0x56acd2=[..._0x48d794['body'][_0x18b3af(0x1d2)]],_0x3975fe=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x216)]],_0x473dc0=[..._0x48d794[_0x18b3af(0x18b)][_0x18b3af(0x247)]];const _0xe60b3b=_0x1f5c49[_0x18b3af(0x21c)](_0xb8e168=>{return _0xb8e168={'product_name':_0xb8e168};});_0x47c5b5[_0x18b3af(0x266)]((_0x1c02d4,_0x56f316)=>{var _0x3b0ce0=_0x18b3af;_0xe60b3b[_0x56f316][_0x3b0ce0(0x243)]=_0x1c02d4;}),_0x3975fe['forEach']((_0x2805bb,_0x4d31d0)=>{_0xe60b3b[_0x4d31d0]['from_invoice']=_0x2805bb;}),_0x473dc0[_0x18b3af(0x266)]((_0x38ef15,_0x1f0d5b)=>{var _0x2525b1=_0x18b3af;_0xe60b3b[_0x1f0d5b][_0x2525b1(0x1cb)]=_0x38ef15;}),_0x418b52[_0x18b3af(0x266)]((_0x326e81,_0x590052)=>{var _0x148345=_0x18b3af;_0x32ce90[_0x148345(0x266)]((_0x768b32,_0x4fd60f)=>{var _0x3d4c29=_0x148345;if(_0x768b32==_0x3d4c29(0x193)&&_0x590052==_0x4fd60f){var _0x531673=_0x326e81[_0x3d4c29(0x267)](0x3);_0xe60b3b[_0x590052][_0x3d4c29(0x248)]=_0x326e81[0x0],_0xe60b3b[_0x590052][_0x3d4c29(0x20f)]=_0x326e81[0x1],_0xe60b3b[_0x590052][_0x3d4c29(0x263)]=0x0,_0xe60b3b[_0x590052][_0x3d4c29(0x23c)]=0x0,_0xe60b3b[_0x590052][_0x3d4c29(0x24f)]=_0x3d4c29(0x1ac),_0xe60b3b[_0x590052]['from_floorlevel']=_0x531673;}else{if(_0x768b32==_0x3d4c29(0x272)&&_0x590052==_0x4fd60f){var _0x531673=_0x326e81[_0x3d4c29(0x267)](0x3);_0xe60b3b[_0x590052]['from_storage']=_0x326e81[0x0],_0xe60b3b[_0x590052]['from_rack']=_0x326e81[0x1],_0xe60b3b[_0x590052][_0x3d4c29(0x263)]=0x0,_0xe60b3b[_0x590052][_0x3d4c29(0x23c)]=0x0,_0xe60b3b[_0x590052][_0x3d4c29(0x24f)]=_0x3d4c29(0x1ac),_0xe60b3b[_0x590052][_0x3d4c29(0x214)]=_0x326e81[0x5];}else{if(_0x590052==_0x4fd60f){var _0x2ffc0a;if(_0x326e81[0x4]=='L')_0x2ffc0a=_0x3d4c29(0x1c4);else _0x326e81[0x4]=='F'&&(_0x2ffc0a=_0x3d4c29(0x1ac));_0xe60b3b[_0x590052][_0x3d4c29(0x248)]=_0x326e81[0x0],_0xe60b3b[_0x590052][_0x3d4c29(0x20f)]=_0x326e81[0x1],_0xe60b3b[_0x590052]['from_bay']=_0x326e81[0x2],_0xe60b3b[_0x590052][_0x3d4c29(0x23c)]=_0x326e81[0x3],_0xe60b3b[_0x590052]['from_types']=_0x2ffc0a,_0xe60b3b[_0x590052]['from_floorlevel']=_0x326e81[0x5];}}}});}),_0x24d54e['forEach']((_0x5b41a4,_0x1ff6ff)=>{_0xe60b3b[_0x1ff6ff]['to_quantity']=_0x5b41a4;}),_0x15a07d[_0x18b3af(0x266)]((_0x3712bb,_0x563866)=>{var _0x10b45d=_0x18b3af;_0x56acd2[_0x10b45d(0x266)]((_0x210179,_0x1d3362)=>{var _0x12d1c2=_0x10b45d;if(_0x210179==_0x12d1c2(0x193)&&_0x563866==_0x1d3362){var _0x58cc97=_0x3712bb[_0x12d1c2(0x267)](0x3);_0xe60b3b[_0x563866]['storage']=_0x3712bb[0x0],_0xe60b3b[_0x563866][_0x12d1c2(0x1cc)]=_0x3712bb[0x1],_0xe60b3b[_0x563866][_0x12d1c2(0x251)]=0x0,_0xe60b3b[_0x563866]['to_bin']=0x0,_0xe60b3b[_0x563866][_0x12d1c2(0x1a8)]=_0x12d1c2(0x1ac),_0xe60b3b[_0x563866][_0x12d1c2(0x240)]=_0x58cc97;}else{if(_0x210179=='Shelves'&&_0x563866==_0x1d3362){var _0x58cc97=_0x3712bb[_0x12d1c2(0x267)](0x3);_0xe60b3b[_0x563866][_0x12d1c2(0x1ee)]=_0x3712bb[0x0],_0xe60b3b[_0x563866]['rack']=_0x3712bb[0x1],_0xe60b3b[_0x563866][_0x12d1c2(0x251)]=0x0,_0xe60b3b[_0x563866][_0x12d1c2(0x1af)]=0x0,_0xe60b3b[_0x563866][_0x12d1c2(0x1a8)]='Floor',_0xe60b3b[_0x563866]['to_floorlevel']=_0x3712bb[0x5];}else{if(_0x563866==_0x1d3362){var _0x4bbcbc;if(_0x3712bb[0x4]=='L')_0x4bbcbc=_0x12d1c2(0x1c4);else _0x3712bb[0x4]=='F'&&(_0x4bbcbc=_0x12d1c2(0x1ac));_0xe60b3b[_0x563866][_0x12d1c2(0x1ee)]=_0x3712bb[0x0],_0xe60b3b[_0x563866][_0x12d1c2(0x1cc)]=_0x3712bb[0x1],_0xe60b3b[_0x563866][_0x12d1c2(0x251)]=_0x3712bb[0x2],_0xe60b3b[_0x563866]['to_bin']=_0x3712bb[0x3],_0xe60b3b[_0x563866]['to_types']=_0x4bbcbc,_0xe60b3b[_0x563866][_0x12d1c2(0x240)]=_0x3712bb[0x5];}}}});}),_0x578035[_0x18b3af(0x266)]((_0x352056,_0x31387e)=>{var _0x295340=_0x18b3af;_0xe60b3b[_0x31387e][_0x295340(0x1ce)]=_0x352056;}),_0x3b6692[_0x18b3af(0x266)]((_0x1d1422,_0x35cc1a)=>{var _0x5a9cfb=_0x18b3af;_0xe60b3b[_0x35cc1a][_0x5a9cfb(0x194)]=_0x1d1422;}),_0x1cc962['forEach']((_0x342040,_0x2d5d52)=>{_0xe60b3b[_0x2d5d52]['product_code']=_0x342040;}),_0xe59d5a[_0x18b3af(0x266)]((_0x520ac3,_0x326f21)=>{var _0x1a2a01=_0x18b3af;_0xe60b3b[_0x326f21][_0x1a2a01(0x20e)]=_0x520ac3;}),_0xc843ea[_0x18b3af(0x266)]((_0xeb1038,_0x541b36)=>{var _0x5ec72c=_0x18b3af;_0xe60b3b[_0x541b36][_0x5ec72c(0x210)]=_0xeb1038;}),_0x353c6b[_0x18b3af(0x266)]((_0x13e48e,_0x3b03b2)=>{var _0x5cd392=_0x18b3af;_0xe60b3b[_0x3b03b2][_0x5cd392(0x244)]=_0x13e48e;}),_0x5f4579[_0x18b3af(0x266)]((_0x412a39,_0x3db796)=>{var _0x514e5f=_0x18b3af;_0xe60b3b[_0x3db796][_0x514e5f(0x1aa)]=_0x412a39;}),_0x3e5a87['forEach']((_0x3e11f7,_0x1d435f)=>{var _0x4d9f16=_0x18b3af;_0xe60b3b[_0x1d435f][_0x4d9f16(0x211)]=_0x3e11f7;}),_0x183fe4[_0x18b3af(0x266)]((_0x225eb7,_0x3e7ee1)=>{_0xe60b3b[_0x3e7ee1]['maxperunit']=_0x225eb7;}),_0x518192['forEach']((_0x2be987,_0x14b94c)=>{var _0x142416=_0x18b3af;_0xe60b3b[_0x14b94c][_0x142416(0x1a4)]=_0x2be987;}),_0x577e18[_0x18b3af(0x266)]((_0x137f1b,_0x518ad7)=>{_0xe60b3b[_0x518ad7]['prod_cat']=_0x137f1b;}),_0x32ce90['forEach']((_0x374fae,_0x329463)=>{var _0x4a81f1=_0x18b3af;_0xe60b3b[_0x329463][_0x4a81f1(0x1bd)]=_0x374fae;}),_0x56acd2[_0x18b3af(0x266)]((_0x1f7a3b,_0x155099)=>{var _0x428b2f=_0x18b3af;_0xe60b3b[_0x155099][_0x428b2f(0x1f4)]=_0x1f7a3b;});const _0xf588e4=_0xe60b3b[_0x18b3af(0x1df)](_0x37c206=>_0x37c206[_0x18b3af(0x25b)]!=='0'&&_0x37c206[_0x18b3af(0x25b)]!==''||_0x37c206[_0x18b3af(0x240)]!=='0'&&_0x37c206['to_floorlevel']!==''),_0x48c024=new transfers({'date':_0x5576b8,'from_warehouse':_0x287b80,'to_warehouse':_0x455879,'product':_0xf588e4,'note':_0x3b5ca2,'invoice':_0x283d11}),_0x1159dc=await _0x48c024[_0x18b3af(0x252)]();_0x48d794['flash'](_0x18b3af(0x213),'Product\x20Transfer\x20successfully'),_0x3ce9ef[_0x18b3af(0x19b)](_0x18b3af(0x220)+_0x1159dc[_0x18b3af(0x1d7)]);}catch(_0x1012b8){console['log'](_0x1012b8),_0x3ce9ef[_0x18b3af(0x1fe)](0xc8)[_0x18b3af(0x275)]({'errorMessage':_0x1012b8['message']});}}),router[a0_0x553593(0x1e8)]('/preview/:id',auth,async(_0x2a9b1c,_0xce87a8)=>{var _0x592898=a0_0x553593;try{const {username:_0x2e97e1,email:_0x5d6d9c,role:_0x2e5969}=_0x2a9b1c[_0x592898(0x22a)],_0xbab32e=_0x2a9b1c[_0x592898(0x22a)],_0x3aebdb=await profile[_0x592898(0x18e)]({'email':_0xbab32e[_0x592898(0x1b9)]}),_0xd36972=await master_shop[_0x592898(0x26a)]();console[_0x592898(0x1ab)](_0x592898(0x21d),_0xd36972);const _0x5a8366=await transfers[_0x592898(0x23d)](_0x2a9b1c['params']['id']);let _0x3b589d=new Date(_0x5a8366[_0x592898(0x211)]),_0x6cdca4=('0'+_0x3b589d[_0x592898(0x22f)]())[_0x592898(0x267)](-0x2),_0x542b13=('0'+(_0x3b589d['getMonth']()+0x1))['slice'](-0x2),_0x31e2cb=_0x3b589d['getFullYear'](),_0x4365a0=_0x31e2cb+'-'+_0x542b13+'-'+_0x6cdca4,_0x3761fb;if(_0xbab32e[_0x592898(0x230)]=='staff'){const _0x4207c9=await staff['findOne']({'email':_0xbab32e[_0x592898(0x1b9)]});_0x3761fb=await warehouse[_0x592898(0x26a)]({'status':_0x592898(0x234),'name':_0x4207c9['warehouse'],'warehouse_category':_0x592898(0x26c)});}else _0x3761fb=await warehouse[_0x592898(0x26a)]({'status':_0x592898(0x234),'warehouse_category':_0x592898(0x26c)});const _0x58a354=await warehouse['aggregate']([{'$match':{'name':_0x5a8366['from_warehouse']}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x592898(0x1b2)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x592898(0x1d6)},'primary_code':{'$first':_0x592898(0x1ea)},'secondary_code':{'$first':_0x592898(0x24d)},'product_code':{'$first':_0x592898(0x209)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x592898(0x1db)},'expiry_date':{'$first':_0x592898(0x1c2)},'production_date':{'$first':_0x592898(0x20a)},'room':{'$first':_0x592898(0x1ad)}}}]);if(_0xd36972[0x0][_0x592898(0x250)]==_0x592898(0x1f1)){var _0x58a37f=users['English'];console[_0x592898(0x1ab)](_0x58a37f);}else{if(_0xd36972[0x0]['language']==_0x592898(0x1fa))var _0x58a37f=users[_0x592898(0x1fa)];else{if(_0xd36972[0x0][_0x592898(0x250)]==_0x592898(0x19d))var _0x58a37f=users[_0x592898(0x19d)];else{if(_0xd36972[0x0][_0x592898(0x250)]==_0x592898(0x1a7))var _0x58a37f=users[_0x592898(0x1a7)];else{if(_0xd36972[0x0][_0x592898(0x250)]=='French')var _0x58a37f=users[_0x592898(0x25f)];else{if(_0xd36972[0x0][_0x592898(0x250)]==_0x592898(0x206))var _0x58a37f=users[_0x592898(0x260)];else{if(_0xd36972[0x0]['language']==_0x592898(0x192))var _0x58a37f=users['Chinese'];else{if(_0xd36972[0x0]['language']==_0x592898(0x1ed))var _0x58a37f=users['Arabic'];}}}}}}}_0xce87a8['render'](_0x592898(0x273),{'success':_0x2a9b1c[_0x592898(0x22d)](_0x592898(0x213)),'errors':_0x2a9b1c[_0x592898(0x22d)](_0x592898(0x1fb)),'role':_0xbab32e,'profile':_0x3aebdb,'master_shop':_0xd36972,'warehouse':_0x3761fb,'transfer':_0x5a8366,'stock':_0x58a354,'language':_0x58a37f});}catch(_0x2c1f2b){console[_0x592898(0x1ab)](_0x2c1f2b);}}),router[a0_0x553593(0x215)](a0_0x553593(0x1a1),auth,async(_0x119547,_0x1b4821)=>{var _0xe4373d=a0_0x553593;try{const _0x4f4ffa=_0x119547[_0xe4373d(0x18d)]['id'],{from_warehouse:_0x117bb8,FromRoom_name:_0x4d9ef3,to_warehouse:_0x2ffe65,ToRoom_name:_0x210758}=_0x119547[_0xe4373d(0x18b)],_0x2f8e16=await transfers['findById']({'_id':_0x4f4ffa}),_0x20aaaa=_0x2f8e16[_0xe4373d(0x198)][_0xe4373d(0x21c)](async _0x580153=>{var _0x304623=_0xe4373d;if(_0x580153['to_quantity']>0x0){var _0x1af59a=await warehouse[_0x304623(0x18e)]({'name':_0x2f8e16[_0x304623(0x1be)],'room':_0x580153[_0x304623(0x1bd)],'warehouse_category':'Raw\x20Materials'});const _0x1f9722=_0x1af59a['product_details'][_0x304623(0x21c)](_0xe2a91e=>{var _0x1fea77=_0x304623;_0xe2a91e[_0x1fea77(0x26e)]==_0x580153[_0x1fea77(0x26e)]&&_0xe2a91e[_0x1fea77(0x1e5)]==_0x580153['from_floorlevel']&&_0xe2a91e[_0x1fea77(0x1bb)]==_0x580153[_0x1fea77(0x24f)]&&_0xe2a91e[_0x1fea77(0x205)]==_0x580153['from_bin']&&_0xe2a91e['bay']==_0x580153['from_bay']&&_0xe2a91e['rack']==_0x580153[_0x1fea77(0x20f)]&&_0xe2a91e['storage']==_0x580153[_0x1fea77(0x248)]&&_0xe2a91e['expiry_date']==_0x580153[_0x1fea77(0x211)]&&_0xe2a91e[_0x1fea77(0x1aa)]==_0x580153['batch_code']&&_0xe2a91e[_0x1fea77(0x1a4)]==_0x580153[_0x1fea77(0x1a4)]&&_0xe2a91e[_0x1fea77(0x1f6)]==_0x580153[_0x1fea77(0x216)]&&(_0xe2a91e['product_stock']=_0xe2a91e['product_stock']-_0x580153[_0x1fea77(0x25b)]);});}return _0x1af59a;});Promise['all'](_0x20aaaa)[_0xe4373d(0x22b)](async _0x21f037=>{var _0x30328a=_0xe4373d;try{for(const _0x752370 of _0x21f037){await _0x752370[_0x30328a(0x252)]();}try{const _0x4a3177=_0x2f8e16[_0x30328a(0x198)][_0x30328a(0x21c)](async _0x267c53=>{var _0x171bf2=_0x30328a;if(_0x267c53[_0x171bf2(0x25b)]>0x0){var _0x14c24c=await warehouse[_0x171bf2(0x18e)]({'name':_0x2f8e16[_0x171bf2(0x242)],'room':_0x267c53[_0x171bf2(0x1f4)],'warehouse_category':_0x171bf2(0x26c)}),_0xfdaed8=0x0;const _0x4574f2=_0x14c24c[_0x171bf2(0x1d3)][_0x171bf2(0x21c)](_0x36e5fe=>{var _0x310f12=_0x171bf2;_0x36e5fe[_0x310f12(0x26e)]==_0x267c53[_0x310f12(0x26e)]&&_0x36e5fe[_0x310f12(0x1e5)]==_0x267c53[_0x310f12(0x240)]&&_0x36e5fe['type']==_0x267c53[_0x310f12(0x1a8)]&&_0x36e5fe[_0x310f12(0x205)]==_0x267c53[_0x310f12(0x1af)]&&_0x36e5fe['bay']==_0x267c53[_0x310f12(0x251)]&&_0x36e5fe['rack']==_0x267c53['rack']&&_0x36e5fe[_0x310f12(0x1ee)]==_0x267c53[_0x310f12(0x1ee)]&&_0x36e5fe[_0x310f12(0x211)]==_0x267c53['expiry_date']&&_0x36e5fe['batch_code']==_0x267c53[_0x310f12(0x1aa)]&&_0x36e5fe[_0x310f12(0x1a4)]==_0x267c53['production_date']&&_0x36e5fe[_0x310f12(0x1f6)]==_0x267c53['To_invoice']&&(_0x36e5fe[_0x310f12(0x24c)]=_0x36e5fe['product_stock']+_0x267c53['to_quantity'],_0xfdaed8++);});_0xfdaed8=='0'&&(_0x14c24c['product_details']=_0x14c24c[_0x171bf2(0x1d3)]['concat']({'product_name':_0x267c53[_0x171bf2(0x26e)],'product_stock':_0x267c53[_0x171bf2(0x25b)],'bay':_0x267c53[_0x171bf2(0x251)],'bin':_0x267c53[_0x171bf2(0x1af)],'type':_0x267c53[_0x171bf2(0x1a8)],'floorlevel':_0x267c53[_0x171bf2(0x240)],'storage':_0x267c53[_0x171bf2(0x1ee)],'rack':_0x267c53['rack'],'product_code':_0x267c53[_0x171bf2(0x249)],'primary_code':_0x267c53[_0x171bf2(0x1ce)],'secondary_code':_0x267c53['secondary_code'],'maxProducts':_0x267c53[_0x171bf2(0x20e)],'storage':_0x267c53[_0x171bf2(0x1ee)],'rack':_0x267c53[_0x171bf2(0x1cc)],'expiry_date':_0x267c53[_0x171bf2(0x211)],'maxPerUnit':_0x267c53['maxperunit'],'batch_code':_0x267c53[_0x171bf2(0x1aa)],'production_date':_0x267c53[_0x171bf2(0x1a4)]}));}return _0x14c24c;});Promise[_0x30328a(0x225)](_0x4a3177)['then'](async _0x11a0f8=>{var _0x3a4994=_0x30328a;try{for(const _0xc933dd of _0x11a0f8){await warehouse[_0x3a4994(0x227)]({'_id':_0xc933dd[_0x3a4994(0x1d7)]},{'$addToSet':{'product_details':{'$each':_0xc933dd[_0x3a4994(0x1d3)]}}});}_0x2f8e16['finalize']=_0x3a4994(0x1a3);const _0x20aacb=await _0x2f8e16[_0x3a4994(0x252)](),_0x3c6a06=await master_shop[_0x3a4994(0x26a)](),_0x2a8ba1=await email_settings[_0x3a4994(0x18e)](),_0x2de5b0=await supervisor_settings[_0x3a4994(0x26a)]();var _0x485374=_0x2f8e16[_0x3a4994(0x198)],_0x2b7a3b='',_0xc03cb9;for(_0xc03cb9 in _0x485374){_0x2b7a3b+='<tr>'+_0x3a4994(0x1bc)+_0x485374[_0xc03cb9][_0x3a4994(0x26e)]+_0x3a4994(0x1a6)+_0x3a4994(0x1bc)+_0x485374[_0xc03cb9]['product_code']+_0x3a4994(0x1a6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x485374[_0xc03cb9]['to_quantity']+_0x3a4994(0x1a6)+_0x3a4994(0x1bc)+_0x485374[_0xc03cb9]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x485374[_0xc03cb9][_0x3a4994(0x244)]+_0x3a4994(0x1a6)+_0x3a4994(0x1bc)+_0x2f8e16['to_warehouse']+_0x3a4994(0x1a6)+_0x3a4994(0x1bc)+_0x485374[_0xc03cb9][_0x3a4994(0x1f4)]+_0x3a4994(0x1a6)+_0x3a4994(0x1bc)+_0x485374[_0xc03cb9][_0x3a4994(0x1ee)]+_0x485374[_0xc03cb9][_0x3a4994(0x1cc)]+_0x485374[_0xc03cb9][_0x3a4994(0x251)]+_0x485374[_0xc03cb9][_0x3a4994(0x1af)]+_0x485374[_0xc03cb9][_0x3a4994(0x1a8)][0x0]+_0x485374[_0xc03cb9][_0x3a4994(0x240)]+_0x3a4994(0x1a6),_0x3a4994(0x1b8);}let _0x58d86f=nodemailer[_0x3a4994(0x19f)]({'host':_0x2a8ba1['host'],'port':Number(_0x2a8ba1['port']),'secure':![],'auth':{'user':_0x2a8ba1[_0x3a4994(0x1b9)],'pass':_0x2a8ba1[_0x3a4994(0x255)]}}),_0x3106ef={'from':_0x2a8ba1['email'],'to':_0x2de5b0[0x0][_0x3a4994(0x1c7)],'subject':_0x3a4994(0x228),'attachments':[{'filename':_0x3a4994(0x21a),'path':__dirname+_0x3a4994(0x1c6)+_0x3a4994(0x21b)+_0x3c6a06[0x0][_0x3a4994(0x1ae)],'cid':_0x3a4994(0x235)}],'html':'<!DOCTYPE\x20html>'+_0x3a4994(0x1b5)+_0x3a4994(0x1da)+_0x3a4994(0x1f0)+_0x3a4994(0x241)+_0x3a4994(0x1f0)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3a4994(0x1d9)+_0x3a4994(0x1f0)+_0x3a4994(0x270)+_0x3c6a06[0x0]['site_title']+_0x3a4994(0x1b3)+_0x3a4994(0x1d9)+_0x3a4994(0x1d9)+_0x3a4994(0x253)+_0x3a4994(0x1f0)+_0x3a4994(0x199)+_0x3a4994(0x1a9)+_0x2f8e16[_0x3a4994(0x1f6)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x3a4994(0x1de)+_0x2f8e16[_0x3a4994(0x23e)]+'\x20'+_0x3a4994(0x218)+_0x3a4994(0x1f7)+'</div>'+_0x3a4994(0x1e9)+_0x3a4994(0x1c8)+_0x3a4994(0x274)+_0x3a4994(0x19c)+_0x3a4994(0x195)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x3a4994(0x1f8)+_0x3a4994(0x1d8)+_0x3a4994(0x254)+_0x3a4994(0x1a0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3a4994(0x1b8)+_0x3a4994(0x208)+_0x3a4994(0x196)+'\x20'+_0x2b7a3b+'\x20'+'</tbody>'+_0x3a4994(0x21f)+_0x3a4994(0x1f0)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3c6a06[0x0]['site_title']+_0x3a4994(0x1f7)+'</div>'+'</div>'+_0x3a4994(0x1b1)};_0x58d86f['sendMail'](_0x3106ef,function(_0x410194,_0x1c83fc){var _0xb7958b=_0x3a4994;_0x410194?(console[_0xb7958b(0x1ab)](_0x410194),console[_0xb7958b(0x1ab)](_0xb7958b(0x207))):console['log']('Email\x20sent\x20successfully');}),_0x119547['flash']('success',_0x3a4994(0x238)),_0x1b4821['redirect']('/picking_list/PDF_transfer_rm/'+_0x20aacb[_0x3a4994(0x1d7)]);}catch(_0x2f6e8f){console['error'](_0x2f6e8f),_0x1b4821[_0x3a4994(0x1fe)](0x1f4)[_0x3a4994(0x275)]({'Perror':_0x3a4994(0x1e4),'message':_0x2f6e8f[_0x3a4994(0x1a5)]});}})[_0x30328a(0x1dc)](_0x3fcf2d=>{var _0x2b8ca5=_0x30328a;console[_0x2b8ca5(0x23b)](_0x3fcf2d),_0x1b4821[_0x2b8ca5(0x1fe)](0x1f4)['json']({'Perror':'An\x20error\x20occurred.'});});}catch(_0x5aab94){_0x1b4821[_0x30328a(0x275)](_0x5aab94);}}catch(_0x4ae267){console[_0x30328a(0x23b)](_0x4ae267),_0x1b4821[_0x30328a(0x1fe)](0x1f4)[_0x30328a(0x275)]({'Merror':_0x30328a(0x1e4),'Message':_0x4ae267['message']});}})['catch'](_0x242361=>{var _0x5c8b15=_0xe4373d;console[_0x5c8b15(0x23b)](_0x242361),_0x1b4821[_0x5c8b15(0x1fe)](0x1f4)[_0x5c8b15(0x275)]({'Merror':_0x5c8b15(0x1c1)});});}catch(_0x11fdca){console[_0xe4373d(0x1ab)](_0x11fdca);}});function a0_0x871f(_0x39e9ac,_0x3c42fa){var _0x578a6e=a0_0x578a();return a0_0x871f=function(_0x871f71,_0x54f9c8){_0x871f71=_0x871f71-0x18b;var _0x112274=_0x578a6e[_0x871f71];return _0x112274;},a0_0x871f(_0x39e9ac,_0x3c42fa);}function a0_0x578a(){var _0x4a9094=['from_prod_pallet','prod_name','get','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.primary_code','Rack\x20F','$product_details.storage','Arabic\x20(ae)','storage','/view','<div>','English\x20(US)','note','Rack\x20C','to_room_name','$product','invoice','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','render','Hindi','errors','Router','$product_details.product_name','status','/barcode_scanner','/view/add_transfer','bay','primary_unit','Enclosed','warehouse','bin','Portuguese\x20(BR)','Error\x20Occurs','</thead>','$product_details.product_code','$product_details.production_date','/transfer/view','from_room','/view/:id','maxProducts','from_rack','unit','expiry_date','from_rak','success','from_floorlevel','post','from_invoice','100982bzXnVh','</span>','from_prod_qty','Logo.png','/upload/','map','master','$product_details.isle','</table>','/transfer/preview/','11oeAnuF','length','Rack\x20A','padStart','all','Rack\x20E','updateOne','Transfer\x20Mail','$product_details.bay','user','then','$product_details.maxPerUnit','flash','RoomAssigned','getDate','role','1341076ezSZuE','rak','/barcode_scanner3','Enabled','logo','/barcode_scanner2','Arabic','Transfer\x20Finalize\x20Successfully','New_Qty_Converted','max_per_unit','error','from_bin','findById','date','staff','to_floorlevel','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','to_warehouse','from_quantity','secondary_unit','$product.to_room_name','5PcEGiG','to_invoice','from_storage','product_code','product_code3','9gXDZIC','product_stock','$product_details.secondary_code','Return\x20Rooms','from_types','language','to_bay','save','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','password','5287410mnIsCg','DRY\x20STORAGE','to_room','342odjcLJ','random','to_quantity','7728968KdwLGU','TRF-','express','French','Portuguese','../public/language/languages.json','$product_details.secondary_unit','from_bay','39Fshzia','$product_details.product_stock','forEach','slice','$invoice','split','find','aggregate','Raw\x20Materials','from_prod_isle','product_name','../models/all_models','<h2>\x20','$from_warehouse','Shelves','edit_transfer_view','<tr>','json','body','8154132alKGyX','params','findOne','to_prod_level','Rack\x20D','from_prod_level','Chinese','Receiving\x20Area','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','Transfer\x20Edit\x20Successfully','product','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.batch_code','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','German','$date','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/preview/:id','There\x27s\x20a\x20error\x20in\x20this\x20transaction','True','production_date','message','</td>','Spanish','to_types','\x20Order\x20Number\x20:\x20','batch_code','log','Floor','$room','image','to_bin','$product_details.type','</body></html>','$product_details.bin','\x20</h2>','$name','<html><head><title></title>','9806ZcxDdI','$product_details','</tr>','email','/CheckingWarehouse','type','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','from_room_name','from_warehouse','$product_details.level','Rack\x20B','An\x20error\x20occurred.','$product_details.expiry_date','to_prod_pallet','Level','$_id','/../public','RMSEmail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','prod_cat','MaxStocks_data2','To_invoice','rack','transfer','primary_code','$product_details.maxProducts','floor','English','ToRoomAssigned','product_details','add_transfer','1311198GjYsyG','$product_details.floorlevel','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</div>','</head><body>','$product_details.rack','catch','$product_details.unit','\x20Order\x20Date\x20:\x20','filter','$product_details.pallet','to_prod_qty','$product_details._id','to_prod_isle','An\x20error\x20occurred\x20while\x20saving\x20data.','floorlevel'];a0_0x578a=function(){return _0x4a9094;};return a0_0x578a();}function BayBinSelected(_0x17e266,_0xb563e0){var _0x36a115=a0_0x553593,_0x505359=[],_0x5daa05=[],_0x39ffe2=[],_0x388ea6=[],_0x578c11=[],_0x23d648=[];let _0x30ba7f=[];if(_0x17e266==_0x36a115(0x257))switch(_0xb563e0){case _0x36a115(0x223):_0x505359=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5daa05=[0x1,0x2],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=['Level',_0x36a115(0x1ac)],_0x578c11=['D'],_0x23d648=['A'];break;case _0x36a115(0x1c0):_0x505359=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5daa05=[0x1,0x2],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=[_0x36a115(0x1c4),_0x36a115(0x1ac)],_0x578c11=['D'],_0x23d648=['B'];break;case'Shelves':_0x505359=[0x0],_0x5daa05=[0x0],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=['Floor'],_0x578c11=['D'],_0x23d648=['S'];break;case _0x36a115(0x193):_0x505359=[0x0],_0x5daa05=[0x0],_0x388ea6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x39ffe2=[_0x36a115(0x1ac)],_0x578c11=['D'],_0x23d648=['R'];break;}else{if(_0x17e266=='COLD\x20STORAGE')switch(_0xb563e0){case _0x36a115(0x223):_0x505359=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5daa05=['B','F'],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=[_0x36a115(0x1c4),_0x36a115(0x1ac)],_0x578c11=['C'],_0x23d648=['A'];break;case'Rack\x20B':_0x505359=[0x5,0x4,0x3,0x2,0x1],_0x5daa05=['F','B','S'],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=['Level','Floor'],_0x578c11=['C'],_0x23d648=['B'];break;case _0x36a115(0x1f3):_0x505359=[0x1,0x2,0x3,0x4,0x5],_0x5daa05=['B','F','S'],_0x388ea6=[0x5,0x4,0x3,0x2,0x1],_0x39ffe2=[_0x36a115(0x1c4),_0x36a115(0x1ac)],_0x578c11=['C'],_0x23d648=['C'];break;case _0x36a115(0x190):_0x505359=[0x5,0x4,0x3,0x2,0x1],_0x5daa05=['F','B','S'],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=['Level',_0x36a115(0x1ac)],_0x578c11=['C'],_0x23d648=['D'];break;case _0x36a115(0x226):_0x505359=[0x4,0x3,0x2,0x1],_0x5daa05=[0x1,0x2],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=[_0x36a115(0x1c4),_0x36a115(0x1ac)],_0x578c11=['C'],_0x23d648=['E'];break;case _0x36a115(0x1eb):_0x505359=[0x1,0x2,0x3],_0x5daa05=[0x1,0x2],_0x388ea6=[0x1,0x2,0x3,0x4,0x5],_0x39ffe2=['Level'],_0x578c11=['C'],_0x23d648=['F'];break;}}return{'levels':_0x505359,'Isle':_0x5daa05,'rack':_0x388ea6,'type':_0x39ffe2,'storage':_0x578c11,'rak':_0x23d648};}router[a0_0x553593(0x1e8)](a0_0x553593(0x20d),auth,async(_0x52b3a1,_0x46cf7a)=>{var _0x48c1f5=a0_0x553593;try{const {username:_0xcae0fe,email:_0x32afe6,role:_0xd872db}=_0x52b3a1[_0x48c1f5(0x22a)],_0x24377e=_0x52b3a1[_0x48c1f5(0x22a)],_0x254368=await profile[_0x48c1f5(0x18e)]({'email':_0x24377e[_0x48c1f5(0x1b9)]}),_0x2d6b88=await master_shop['find'](),_0x39bc77=await transfers[_0x48c1f5(0x23d)](_0x52b3a1['params']['id']);let _0x24fca9;if(_0x24377e[_0x48c1f5(0x230)]=='staff'){const _0x27f7ea=await staff[_0x48c1f5(0x18e)]({'email':_0x24377e[_0x48c1f5(0x1b9)]});_0x24fca9=await warehouse['aggregate']([{'$match':{'status':_0x48c1f5(0x234),'name':_0x27f7ea[_0x48c1f5(0x204)],'warehouse_category':_0x48c1f5(0x26c)}},{'$group':{'_id':_0x48c1f5(0x1b4),'name':{'$first':_0x48c1f5(0x1b4)}}}]);}else _0x24fca9=await warehouse['aggregate']([{'$match':{'status':_0x48c1f5(0x234),'warehouse_category':_0x48c1f5(0x26c)}},{'$group':{'_id':'$name','name':{'$first':_0x48c1f5(0x1b4)}}}]);const _0x333c35=await warehouse[_0x48c1f5(0x26b)]([{'$match':{'name':_0x39bc77[_0x48c1f5(0x1be)],'warehouse_category':_0x48c1f5(0x26c)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x48c1f5(0x229)},'bin':{'$first':_0x48c1f5(0x1b2)},'type':{'$first':_0x48c1f5(0x1b0)},'floorlevel':{'$first':_0x48c1f5(0x1d6)},'primary_code':{'$first':_0x48c1f5(0x1ea)},'secondary_code':{'$first':_0x48c1f5(0x24d)},'product_code':{'$first':_0x48c1f5(0x209)},'storage':{'$first':_0x48c1f5(0x1ec)},'rack':{'$first':_0x48c1f5(0x1db)},'expiry_date':{'$first':_0x48c1f5(0x1c2)},'production_date':{'$first':_0x48c1f5(0x20a)},'room':{'$first':'$room'}}}]),_0x1f6ea6=await product[_0x48c1f5(0x26a)]({}),_0x338ff0=BayBinSelected(_0x39bc77[_0x48c1f5(0x242)],_0x39bc77['to_room']);if(_0x2d6b88[0x0][_0x48c1f5(0x250)]==_0x48c1f5(0x1f1)){var _0x565eec=users[_0x48c1f5(0x1d1)];console[_0x48c1f5(0x1ab)](_0x565eec);}else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]==_0x48c1f5(0x1fa))var _0x565eec=users['Hindi'];else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]==_0x48c1f5(0x19d))var _0x565eec=users[_0x48c1f5(0x19d)];else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]==_0x48c1f5(0x1a7))var _0x565eec=users[_0x48c1f5(0x1a7)];else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]=='French')var _0x565eec=users['French'];else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]==_0x48c1f5(0x206))var _0x565eec=users['Portuguese'];else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]=='Chinese')var _0x565eec=users[_0x48c1f5(0x192)];else{if(_0x2d6b88[0x0][_0x48c1f5(0x250)]==_0x48c1f5(0x1ed))var _0x565eec=users[_0x48c1f5(0x237)];}}}}}}}_0x46cf7a[_0x48c1f5(0x1f9)]('edit_transfer',{'success':_0x52b3a1[_0x48c1f5(0x22d)](_0x48c1f5(0x213)),'errors':_0x52b3a1[_0x48c1f5(0x22d)](_0x48c1f5(0x1fb)),'role':_0x24377e,'profile':_0x254368,'master_shop':_0x2d6b88,'warehouse':_0x24fca9,'transfer':_0x39bc77,'stock':_0x333c35,'unit':_0x1f6ea6,'language':_0x565eec});}catch(_0x41e94d){console[_0x48c1f5(0x1ab)](_0x41e94d);}}),router[a0_0x553593(0x215)](a0_0x553593(0x20d),auth,async(_0x8e2917,_0x188bd8)=>{var _0x236b74=a0_0x553593;try{const _0x54ede9=_0x8e2917[_0x236b74(0x18d)]['id'],_0x259c5b=await transfers[_0x236b74(0x23d)](_0x54ede9);_0x188bd8[_0x236b74(0x275)](_0x8e2917[_0x236b74(0x18b)]);return;const {date:_0x146b09,from_warehouse:_0x53d48d,FromRoom_name:_0x67d489,to_warehouse:_0xf0ad61,ToRoom_name:_0x3be7f6,prod_name:_0x14b3b6,from_prod_qty:_0x547a9e,from_prod_level:_0x44acbd,from_prod_isle:_0x216ac0,from_prod_pallet:_0x29d05f,to_prod_qty:_0x16b6ef,to_prod_level:_0x2e579d,to_prod_isle:_0xa537cf,to_prod_pallet:_0x596042,primary_code:_0x2d4071,secondary_code:_0x381ce5,product_code3:_0x317900,note:_0x82d024,invoice:_0x38e3f5,expiry_date:_0x5124f8}=_0x8e2917[_0x236b74(0x18b)];if(typeof _0x14b3b6=='string')var _0x2bac61=[_0x8e2917[_0x236b74(0x18b)]['prod_name']],_0x2d7409=[_0x8e2917[_0x236b74(0x18b)]['from_prod_qty']],_0x364750=[_0x8e2917['body']['from_prod_level']],_0xe3a5d1=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x26d)]],_0x47802b=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e6)]],_0x1f688d=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x24f)]],_0x55d903=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e1)]],_0x4aa8c2=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x18f)]],_0x530260=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e3)]],_0xf4520d=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1c3)]],_0x3a334f=[_0x8e2917[_0x236b74(0x18b)]['to_types']],_0x272d44=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1ee)]],_0x3982b6=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x232)]],_0x2a6e70=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1ce)]],_0x1cd8e8=[_0x8e2917[_0x236b74(0x18b)]['secondary_code']],_0x33086d=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x24a)]],_0x4ec8fd=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1ca)]],_0x4c1711=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x210)]],_0x9839cf=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x244)]],_0x3e8663=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1aa)]],_0x1f6887=[_0x8e2917['body'][_0x236b74(0x211)]],_0x2a5764=[_0x8e2917['body'][_0x236b74(0x248)]],_0x1900db=[_0x8e2917[_0x236b74(0x18b)][_0x236b74(0x212)]];else var _0x2bac61=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e7)]],_0x272d44=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1ee)]],_0x3982b6=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x232)]],_0x1f688d=[..._0x8e2917['body'][_0x236b74(0x24f)]],_0x3a334f=[..._0x8e2917[_0x236b74(0x18b)]['to_types']],_0x2d7409=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x219)]],_0x364750=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x191)]],_0xe3a5d1=[..._0x8e2917['body'][_0x236b74(0x26d)]],_0x47802b=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e6)]],_0x55d903=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e1)]],_0x4aa8c2=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x18f)]],_0x530260=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1e3)]],_0xf4520d=[..._0x8e2917[_0x236b74(0x18b)]['to_prod_pallet']],_0x2a6e70=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1ce)]],_0x1cd8e8=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x194)]],_0x33086d=[..._0x8e2917['body'][_0x236b74(0x24a)]],_0x4ec8fd=[..._0x8e2917['body'][_0x236b74(0x1ca)]],_0x4c1711=[..._0x8e2917['body'][_0x236b74(0x210)]],_0x9839cf=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x244)]],_0x3e8663=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x1aa)]],_0x1f6887=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x211)]],_0x2a5764=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x248)]],_0x1900db=[..._0x8e2917[_0x236b74(0x18b)][_0x236b74(0x212)]];const _0x113903=_0x2bac61[_0x236b74(0x21c)](_0x5ad9cd=>{return _0x5ad9cd={'product_name':_0x5ad9cd};});_0x2d7409['forEach']((_0xc63388,_0x4805e1)=>{var _0x48c261=_0x236b74;_0x113903[_0x4805e1][_0x48c261(0x243)]=_0xc63388;}),_0x364750[_0x236b74(0x266)]((_0x3dfd3d,_0x3f1810)=>{var _0x3e9b56=_0x236b74;_0x113903[_0x3f1810][_0x3e9b56(0x263)]=_0x3dfd3d;}),_0xe3a5d1['forEach']((_0x2c7c8f,_0x5801e8)=>{var _0x411bd7=_0x236b74;_0x113903[_0x5801e8][_0x411bd7(0x23c)]=_0x2c7c8f;}),_0x47802b[_0x236b74(0x266)]((_0x334f8d,_0x377131)=>{var _0xd5228=_0x236b74;_0x113903[_0x377131][_0xd5228(0x214)]=_0x334f8d;}),_0x55d903['forEach']((_0x2b54d3,_0x451887)=>{var _0x481932=_0x236b74;_0x113903[_0x451887][_0x481932(0x25b)]=_0x2b54d3;}),_0x4aa8c2['forEach']((_0x4d71d5,_0x1c1ae7)=>{var _0x5d0e3c=_0x236b74;_0x113903[_0x1c1ae7][_0x5d0e3c(0x251)]=_0x4d71d5;}),_0x530260[_0x236b74(0x266)]((_0xde21df,_0xca372a)=>{var _0x1f68d2=_0x236b74;_0x113903[_0xca372a][_0x1f68d2(0x1af)]=_0xde21df;}),_0xf4520d[_0x236b74(0x266)]((_0x50dcd8,_0x83d2dc)=>{_0x113903[_0x83d2dc]['to_floorlevel']=_0x50dcd8;}),_0x2a6e70[_0x236b74(0x266)]((_0x4231ea,_0x7b9a95)=>{var _0x2e6e4b=_0x236b74;_0x113903[_0x7b9a95][_0x2e6e4b(0x1ce)]=_0x4231ea;}),_0x1cd8e8['forEach']((_0x1ee3e8,_0x2403bd)=>{var _0x27a837=_0x236b74;_0x113903[_0x2403bd][_0x27a837(0x194)]=_0x1ee3e8;}),_0x33086d['forEach']((_0x13631d,_0x4b72b9)=>{var _0x37d25f=_0x236b74;_0x113903[_0x4b72b9][_0x37d25f(0x249)]=_0x13631d;}),_0x4ec8fd[_0x236b74(0x266)]((_0x5f1aa6,_0x175f21)=>{var _0x588681=_0x236b74;_0x113903[_0x175f21][_0x588681(0x20e)]=_0x5f1aa6;}),_0x4c1711[_0x236b74(0x266)]((_0x574db6,_0x5bbfc9)=>{var _0x2c9c6c=_0x236b74;_0x113903[_0x5bbfc9][_0x2c9c6c(0x210)]=_0x574db6;}),_0x9839cf[_0x236b74(0x266)]((_0x25e983,_0x53d076)=>{_0x113903[_0x53d076]['secondary_unit']=_0x25e983;}),_0x3e8663[_0x236b74(0x266)]((_0x508b44,_0x152356)=>{var _0xaf238=_0x236b74;_0x113903[_0x152356][_0xaf238(0x1aa)]=_0x508b44;}),_0x1f6887[_0x236b74(0x266)]((_0x4c1c31,_0x110bb7)=>{var _0x248b07=_0x236b74;_0x113903[_0x110bb7][_0x248b07(0x211)]=_0x4c1c31;}),_0x272d44['forEach']((_0xcac512,_0x5ac339)=>{_0x113903[_0x5ac339]['storage']=_0xcac512;}),_0x3982b6['forEach']((_0xa7978a,_0x3ae9b8)=>{var _0x315d38=_0x236b74;_0x113903[_0x3ae9b8][_0x315d38(0x1cc)]=_0xa7978a;}),_0x1f688d[_0x236b74(0x266)]((_0x3ca3ed,_0x3ab02f)=>{var _0x396d8b=_0x236b74;_0x113903[_0x3ab02f][_0x396d8b(0x24f)]=_0x3ca3ed;}),_0x3a334f['forEach']((_0xe8044d,_0xe5ff20)=>{_0x113903[_0xe5ff20]['to_types']=_0xe8044d;}),_0x2a5764[_0x236b74(0x266)]((_0x3580ee,_0x15ba76)=>{var _0x4f1a26=_0x236b74;_0x113903[_0x15ba76][_0x4f1a26(0x248)]=_0x3580ee;}),_0x1900db[_0x236b74(0x266)]((_0x206d7b,_0x51ad7c)=>{var _0x57c498=_0x236b74;_0x113903[_0x51ad7c][_0x57c498(0x20f)]=_0x206d7b;});const _0x36291e=_0x113903[_0x236b74(0x1df)](_0x41aeec=>_0x41aeec[_0x236b74(0x25b)]!=='0'&&_0x41aeec[_0x236b74(0x25b)]!==''||_0x41aeec[_0x236b74(0x240)]!=='0'&&_0x41aeec[_0x236b74(0x240)]!=='');var _0x497448=0x0;_0x36291e['forEach'](_0x14b2f7=>{var _0x3b6d8e=_0x236b74;parseInt(_0x14b2f7[_0x3b6d8e(0x243)])<parseInt(_0x14b2f7['to_quantity'])&&_0x497448++;});if(_0x497448!=0x0)return _0x8e2917[_0x236b74(0x22d)](_0x236b74(0x1fb),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x188bd8['redirect']('back');const _0x44b15c=await warehouse[_0x236b74(0x18e)]({'name':_0x259c5b['from_warehouse'],'room':_0x259c5b[_0x236b74(0x20c)]});_0x259c5b[_0x236b74(0x198)][_0x236b74(0x266)](_0x350104=>{var _0x48470c=_0x236b74;if(_0x350104[_0x48470c(0x25b)]>0x0){const _0x51338d=_0x44b15c[_0x48470c(0x1d3)][_0x48470c(0x21c)](_0x3d8b4f=>{var _0x4b651a=_0x48470c;_0x3d8b4f[_0x4b651a(0x26e)]==_0x350104[_0x4b651a(0x26e)]&&_0x3d8b4f[_0x4b651a(0x1e5)]==_0x350104[_0x4b651a(0x214)]&&_0x3d8b4f['type']==_0x350104[_0x4b651a(0x24f)]&&_0x3d8b4f[_0x4b651a(0x205)]==_0x350104[_0x4b651a(0x23c)]&&_0x3d8b4f[_0x4b651a(0x201)]==_0x350104[_0x4b651a(0x263)]&&_0x3d8b4f[_0x4b651a(0x1cc)]==_0x350104['from_rack']&&_0x3d8b4f[_0x4b651a(0x1ee)]==_0x350104[_0x4b651a(0x248)]&&(_0x3d8b4f['product_stock']=parseInt(_0x3d8b4f[_0x4b651a(0x24c)])+parseInt(_0x350104['to_quantity']));});}}),await _0x44b15c['save']();const _0x10b728=await warehouse[_0x236b74(0x18e)]({'name':_0x259c5b[_0x236b74(0x242)],'room':_0x259c5b[_0x236b74(0x258)]});_0x259c5b[_0x236b74(0x198)]['forEach'](_0x3b5daa=>{var _0x4c94c3=_0x236b74;if(_0x3b5daa[_0x4c94c3(0x25b)]>0x0){const _0x2acdb5=_0x10b728[_0x4c94c3(0x1d3)][_0x4c94c3(0x21c)](_0x2da66c=>{var _0x3194c6=_0x4c94c3;_0x2da66c[_0x3194c6(0x26e)]==_0x3b5daa[_0x3194c6(0x26e)]&&_0x2da66c[_0x3194c6(0x1e5)]==_0x3b5daa[_0x3194c6(0x240)]&&_0x2da66c[_0x3194c6(0x1bb)]==_0x3b5daa[_0x3194c6(0x1a8)]&&_0x2da66c[_0x3194c6(0x205)]==_0x3b5daa['to_bin']&&_0x2da66c['bay']==_0x3b5daa['to_bay']&&_0x2da66c[_0x3194c6(0x1cc)]==_0x3b5daa['rack']&&_0x2da66c['storage']==_0x3b5daa['storage']&&(_0x2da66c[_0x3194c6(0x24c)]=parseInt(_0x2da66c[_0x3194c6(0x24c)])-parseInt(_0x3b5daa['to_quantity']));});}}),await _0x10b728[_0x236b74(0x252)](),_0x259c5b[_0x236b74(0x23e)]=_0x146b09,_0x259c5b['from_warehouse']=_0x53d48d,_0x259c5b[_0x236b74(0x242)]=_0xf0ad61,_0x259c5b['product']=_0x36291e,_0x259c5b[_0x236b74(0x1f2)]=_0x82d024,_0x259c5b[_0x236b74(0x1f6)]=_0x38e3f5;const _0x224b50=await _0x259c5b['save']();console[_0x236b74(0x1ab)](_0x224b50);const _0x4cc5d8=await warehouse[_0x236b74(0x18e)]({'name':_0x53d48d,'room':_0x67d489});_0x224b50[_0x236b74(0x198)]['forEach'](_0x515e4f=>{var _0x2f460c=_0x236b74;if(_0x515e4f[_0x2f460c(0x25b)]>0x0){const _0x146351=_0x4cc5d8['product_details'][_0x2f460c(0x21c)](_0x457ce1=>{var _0x3891d7=_0x2f460c;_0x457ce1['product_name']==_0x515e4f[_0x3891d7(0x26e)]&&_0x457ce1[_0x3891d7(0x1e5)]==_0x515e4f['from_floorlevel']&&_0x457ce1[_0x3891d7(0x1bb)]==_0x515e4f[_0x3891d7(0x24f)]&&_0x457ce1[_0x3891d7(0x205)]==_0x515e4f['from_bin']&&_0x457ce1[_0x3891d7(0x201)]==_0x515e4f[_0x3891d7(0x263)]&&_0x457ce1[_0x3891d7(0x1cc)]==_0x515e4f[_0x3891d7(0x20f)]&&_0x457ce1[_0x3891d7(0x1ee)]==_0x515e4f['from_storage']&&(_0x457ce1[_0x3891d7(0x24c)]=parseInt(_0x457ce1[_0x3891d7(0x24c)])-parseInt(_0x515e4f['to_quantity']));});}}),await _0x4cc5d8[_0x236b74(0x252)]();const _0x141bfd=await warehouse[_0x236b74(0x18e)]({'name':_0xf0ad61,'room':_0x3be7f6});_0x224b50['product'][_0x236b74(0x266)](_0x39cdf9=>{var _0x3da701=_0x236b74;if(_0x39cdf9[_0x3da701(0x25b)]>0x0){var _0x591347=0x0;const _0xc9edcb=_0x141bfd[_0x3da701(0x1d3)]['map'](_0xd95c36=>{var _0xccc943=_0x3da701;_0xd95c36[_0xccc943(0x26e)]==_0x39cdf9[_0xccc943(0x26e)]&&_0xd95c36['floorlevel']==_0x39cdf9[_0xccc943(0x240)]&&_0xd95c36['type']==_0x39cdf9[_0xccc943(0x1a8)]&&_0xd95c36[_0xccc943(0x205)]==_0x39cdf9['to_bin']&&_0xd95c36['bay']==_0x39cdf9[_0xccc943(0x251)]&&_0xd95c36[_0xccc943(0x1cc)]==_0x39cdf9[_0xccc943(0x1cc)]&&_0xd95c36[_0xccc943(0x1ee)]==_0x39cdf9[_0xccc943(0x1ee)]&&(_0xd95c36[_0xccc943(0x24c)]=parseInt(_0xd95c36[_0xccc943(0x24c)])+parseInt(_0x39cdf9['to_quantity']),_0x591347++);});_0x591347=='0'&&(_0x141bfd[_0x3da701(0x1d3)]=_0x141bfd[_0x3da701(0x1d3)]['concat']({'product_name':_0x39cdf9['product_name'],'product_stock':_0x39cdf9['to_quantity'],'bay':_0x39cdf9[_0x3da701(0x251)],'bin':_0x39cdf9[_0x3da701(0x1af)],'type':_0x39cdf9[_0x3da701(0x1a8)],'floorlevel':_0x39cdf9[_0x3da701(0x240)],'storage':_0x39cdf9[_0x3da701(0x1ee)],'rack':_0x39cdf9[_0x3da701(0x1cc)],'product_code':_0x39cdf9[_0x3da701(0x249)],'primary_code':_0x39cdf9[_0x3da701(0x1ce)],'secondary_code':_0x39cdf9[_0x3da701(0x194)],'maxProducts':_0x39cdf9['maxProducts'],'storage':_0x39cdf9['storage'],'rack':_0x39cdf9[_0x3da701(0x1cc)]}));}}),await _0x141bfd[_0x236b74(0x252)](),_0x8e2917[_0x236b74(0x22d)]('success',_0x236b74(0x197)),_0x188bd8[_0x236b74(0x19b)](_0x236b74(0x20b));}catch(_0x5edfa2){console[_0x236b74(0x1ab)](_0x5edfa2);}}),router[a0_0x553593(0x215)](a0_0x553593(0x1ff),async(_0x19bcfd,_0x112f03)=>{var _0x3ee470=a0_0x553593;const {FromWareHouse:_0x5b73dc,FromRoom:_0x31ef9f,ToWarehouse:_0x3cb54e,ToRoom:_0x4c9cf7,primary_code:_0x495ff9,Roomslist:_0x6b9628}=_0x19bcfd['body'],_0x33bce0=_0x6b9628[_0x3ee470(0x269)](','),_0x1a6caa=[];async function _0x1dc1b1(_0x3c7f2f){var _0x4fb08e=_0x3ee470;const _0x204134=await warehouse[_0x4fb08e(0x26b)]([{'$match':{'name':_0x5b73dc,'room':_0x3c7f2f}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x495ff9}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x4fb08e(0x265)},'primary_code':{'$first':_0x4fb08e(0x1ea)},'secondary_code':{'$first':_0x4fb08e(0x24d)},'product_code':{'$first':_0x4fb08e(0x209)},'level':{'$first':_0x4fb08e(0x229)},'isle':{'$first':_0x4fb08e(0x1b2)},'type':{'$first':_0x4fb08e(0x1b0)},'pallet':{'$first':_0x4fb08e(0x1d6)},'unit':{'$first':_0x4fb08e(0x1dd)},'secondary_unit':{'$first':_0x4fb08e(0x262)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4fb08e(0x1db)},'expiry_date':{'$first':_0x4fb08e(0x1c2)},'production_date':{'$first':_0x4fb08e(0x20a)},'batch_code':{'$first':_0x4fb08e(0x19a)},'maxPerUnit':{'$first':_0x4fb08e(0x22c)},'prod_cat':{'$first':'P'},'roomNamed':{'$first':_0x4fb08e(0x1ad)},'maxProducts':{'$first':_0x4fb08e(0x1cf)}}}]),_0x71978e=await warehouse[_0x4fb08e(0x26b)]([{'$match':{'name':_0x5b73dc,'room':_0x3c7f2f}},{'$unwind':_0x4fb08e(0x1b7)},{'$match':{'product_details.secondary_code':_0x495ff9}},{'$group':{'_id':_0x4fb08e(0x1e2),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x4fb08e(0x265)},'primary_code':{'$first':_0x4fb08e(0x1ea)},'secondary_code':{'$first':_0x4fb08e(0x24d)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4fb08e(0x1b2)},'type':{'$first':_0x4fb08e(0x1b0)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4fb08e(0x1dd)},'secondary_unit':{'$first':_0x4fb08e(0x262)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4fb08e(0x1db)},'expiry_date':{'$first':_0x4fb08e(0x1c2)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x4fb08e(0x19a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'prod_cat':{'$first':'S'},'roomNamed':{'$first':_0x4fb08e(0x1ad)},'maxProducts':{'$first':_0x4fb08e(0x1cf)}}}]);if(_0x204134[_0x4fb08e(0x222)]>0x0)_0x1a6caa['push'](_0x204134);else _0x71978e['length']>0x0&&_0x1a6caa['push'](_0x71978e);}const _0x4f1579=_0x33bce0[_0x3ee470(0x21c)](_0xb057c0=>_0x1dc1b1(_0xb057c0));await Promise[_0x3ee470(0x225)](_0x4f1579),_0x112f03[_0x3ee470(0x275)](_0x1a6caa);}),router[a0_0x553593(0x215)](a0_0x553593(0x236),async(_0xf559ca,_0x1c16c1)=>{var _0x1e9bbc=a0_0x553593;try{const {FromWareHouse:_0x6aa145,FromRoom:_0xf155a9,ToWarehouse:_0x1676ba,ToRoom:_0x3bfc40,secondary_code:_0x4132fe}=_0xf559ca[_0x1e9bbc(0x18b)],_0x3a298d=await warehouse[_0x1e9bbc(0x26b)]([{'$match':{'name':_0x6aa145}},{'$unwind':_0x1e9bbc(0x1b7)},{'$match':{'product_details.secondary_code':_0x4132fe}},{'$group':{'_id':_0x1e9bbc(0x1e2),'name':{'$first':_0x1e9bbc(0x1fd)},'primary_code':{'$first':_0x1e9bbc(0x1ea)},'secondary_code':{'$first':_0x1e9bbc(0x24d)},'product_code':{'$first':_0x1e9bbc(0x209)},'instock':{'$first':_0x1e9bbc(0x265)},'warehouse':{'$first':'$name'},'level':{'$first':_0x1e9bbc(0x1bf)},'isle':{'$first':_0x1e9bbc(0x21e)},'pallet':{'$first':_0x1e9bbc(0x1e0)},'maxProducts':{'$first':_0x1e9bbc(0x1cf)},'unit':{'$first':_0x1e9bbc(0x1dd)}}}]);_0x1c16c1['status'](0xc8)['json'](_0x3a298d);}catch(_0x57e90a){_0x1c16c1[_0x1e9bbc(0x1fe)](0x194)[_0x1e9bbc(0x275)]({'message':_0x57e90a[_0x1e9bbc(0x1a5)]});}}),router['post'](a0_0x553593(0x233),async(_0x5d48bc,_0x38ba62)=>{var _0x42e636=a0_0x553593;try{const {FromWareHouse:_0x3b3be9,FromRoom:_0x50f39f,ToWarehouse:_0x14534f,ToRoom:_0x1c9767,product_code:_0x4e8490}=_0x5d48bc[_0x42e636(0x18b)],_0xe330e4=await warehouse[_0x42e636(0x26b)]([{'$match':{'name':_0x3b3be9}},{'$unwind':_0x42e636(0x1b7)},{'$match':{'product_details.product_code':_0x4e8490}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x42e636(0x1fd)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x42e636(0x24d)},'product_code':{'$first':_0x42e636(0x209)},'instock':{'$first':_0x42e636(0x265)},'warehouse':{'$first':_0x42e636(0x1b4)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x42e636(0x21e)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':'$product_details.unit'}}}]);_0x38ba62[_0x42e636(0x1fe)](0xc8)[_0x42e636(0x275)](_0xe330e4);}catch(_0x46b24c){_0x38ba62[_0x42e636(0x1fe)](0x194)[_0x42e636(0x275)]({'message':_0x46b24c[_0x42e636(0x1a5)]});}}),router[a0_0x553593(0x215)](a0_0x553593(0x1ba),async(_0x536cb4,_0x33c3ca)=>{var _0x536d06=a0_0x553593;const {level:_0x17fdb6,isle:_0x49df42,pallet:_0x1672d1,warehouses:_0x305996,room:_0x40319b}=_0x536cb4[_0x536d06(0x18b)];try{const _0x5922ef=await warehouse['aggregate']([{'$match':{'name':_0x305996,'room':_0x40319b}},{'$unwind':_0x536d06(0x1b7)},{'$match':{'product_details.level':parseInt(_0x17fdb6),'product_details.isle':_0x49df42,'product_details.pallet':parseInt(_0x1672d1)}},{'$group':{'_id':_0x536d06(0x1e2),'name':{'$first':_0x536d06(0x1fd)},'product_stock':{'$first':_0x536d06(0x265)},'level':{'$first':_0x536d06(0x1bf)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x536d06(0x1e0)},'maxProducts':{'$first':_0x536d06(0x1cf)}}}]);_0x33c3ca[_0x536d06(0x1fe)](0xc8)[_0x536d06(0x275)](_0x5922ef);}catch(_0x4d0f0a){_0x33c3ca['status'](0x194)[_0x536d06(0x275)]({'message':_0x4d0f0a[_0x536d06(0x1a5)]});}}),module['exports']=router;