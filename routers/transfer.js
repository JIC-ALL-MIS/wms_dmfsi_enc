function a0_0x59ba(){var _0x444167=['\x20<>\x20','rak','to_prod_pallet','Enabled','floorlevel','$product_details.type','DRY\x20STORAGE','</body></html>','user','save','/view/:id','True','/barcode_scanner3','rack','length','Hindi','/view','$product_details.batch_code','Rack\x20A','note','date','createTransport','$product_details.bay','id_transaction','status','$product_details.unit','id_transaction_id','$invoice','TRF-','9dHQOnA','floor','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','toString','$product_details.secondary_unit','edit_transfer_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','to_floorlevel','master','$product_details.rack','Floor','maxProducts','from_room_name','from_prod_isle','from_quantity','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','catch','type','product_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.expiry_date','\x20Order\x20Number\x20:\x20','$date','prod_name','from_storage','$product_details.invoice','from_rak','unit','</td>','aggregate','params','port','add_transfer','success','from_rack','There\x27s\x20a\x20error\x20in\x20this\x20transaction','batch_code','</table>','Router','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$finalize','/barcode_scanner2','</thead>','to_bin','to_room_name','all','body','to_bay','secondary_unit','$room','Raw\x20Materials','from_bay','to_invoice','to_warehouse','<hr\x20class=\x22my-3\x22>','render','findOne','$product_details.maxPerUnit','3201600vqesTA','secondary_code','</span>','/picking_list/PDF_transfer_rm/','product_code','RoomAssigned','from_types','_id','Arabic','Transfer\x20Mail','Shelves','find','ToRoomAssigned','message','from_prod_level','errors','email','here','Chinese','</h5>','$product.to_room_name','image','then','4212942DBzEBu','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','transfer','Ambient','random','An\x20error\x20occurred.','max_per_unit','COLD\x20STORAGE','$product_details.secondary_code','site_title','Logo.png','product','to_quantity','To_invoice','bay','split','get','language','Product\x20Transfer\x20successfully','\x20</h2>','flash','<h2>\x20','staff','slice','production_date','from_prod_pallet','Spanish','express','$product_details.floorlevel','Transfer\x20Edit\x20Successfully','French','sendMail','forEach','exports','edit_transfer','$product_details.pallet','22BjPWQo','json','expiry_date','primary_code','from_prod_qty','</div>','product_code3','20718401Mmneet','$product_details.bin','../middleware/auth','padStart','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','finalize','role','<h5>','/preview/:id','findById','German','$product_details.product_name','to_prod_level','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Level','$product.from_room_name','from_floorlevel','</head><body>','concat','Rack\x20D','8185163BxllBG','Portuguese','<div>','error','host','English','$product','Portuguese\x20(BR)','post','/transfer/view','English\x20(US)','string','map','push','Receiving\x20Area','5nYnHKT','product_stock','maxperunit','bin','Enclosed','filter','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.product_code','product_details','3282464upTEvu','storage','$product_details.level','<tr>','invoice','Arabic\x20(ae)','getMonth','from_invoice','5233852bXnHuX','from_bin','redirect','$product_details.primary_code','$product_details.storage','to_room','<!DOCTYPE\x20html>','New_Qty_Converted','$product_details._id','$product_details','primary_unit','to_prod_qty','to_types','updateOne','Rack\x20C','$product_details.isle','An\x20error\x20occurred\x20while\x20saving\x20data.','</tr>','from_warehouse','$isAllowEdit','66521oEgfya','3VPUgik','prod_cat','log','warehouse','/barcode_scanner','MaxStocks_data2','/CheckingWarehouse','password','$product_details.product_stock','nodemailer','$product_details.maxProducts','$product_details.production_date'];a0_0x59ba=function(){return _0x444167;};return a0_0x59ba();}var a0_0x5d356b=a0_0x5018;(function(_0x1fe733,_0x1efb23){var _0x303967=a0_0x5018,_0x539aee=_0x1fe733();while(!![]){try{var _0x900b4f=-parseInt(_0x303967(0x1ad))/0x1*(-parseInt(_0x303967(0x250))/0x2)+parseInt(_0x303967(0x1ae))/0x3*(-parseInt(_0x303967(0x28c))/0x4)+parseInt(_0x303967(0x27b))/0x5*(parseInt(_0x303967(0x22a))/0x6)+-parseInt(_0x303967(0x26c))/0x7+parseInt(_0x303967(0x284))/0x8*(-parseInt(_0x303967(0x1d7))/0x9)+parseInt(_0x303967(0x213))/0xa+parseInt(_0x303967(0x257))/0xb;if(_0x900b4f===_0x1efb23)break;else _0x539aee['push'](_0x539aee['shift']());}catch(_0x5f1856){_0x539aee['push'](_0x539aee['shift']());}}}(a0_0x59ba,0xb6f93));const express=require(a0_0x5d356b(0x247)),app=express(),router=express[a0_0x5d356b(0x1ff)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x5d356b(0x259)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x5d356b(0x1b7));router[a0_0x5d356b(0x23c)](a0_0x5d356b(0x1ca),auth,async(_0x2cc8fd,_0x5bee4b)=>{var _0x4fe5bc=a0_0x5d356b;try{const {username:_0x3aac1e,email:_0x16418e,role:_0x459c90}=_0x2cc8fd[_0x4fe5bc(0x1c2)],_0x28332e=_0x2cc8fd[_0x4fe5bc(0x1c2)],_0xa9668f=await profile[_0x4fe5bc(0x211)]({'email':_0x28332e[_0x4fe5bc(0x223)]}),_0x35cf60=await master_shop['find']();console[_0x4fe5bc(0x1b0)](_0x4fe5bc(0x1e0),_0x35cf60);let _0x540546;if(_0x28332e['role']=='staff'){const _0x2cf76f=await staff[_0x4fe5bc(0x211)]({'email':_0x28332e[_0x4fe5bc(0x223)]});_0x540546=await transfers[_0x4fe5bc(0x21e)]({'from_warehouse':_0x2cf76f['warehouse']});}else _0x540546=await transfers[_0x4fe5bc(0x1f6)]([{'$unwind':_0x4fe5bc(0x272)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4fe5bc(0x1d5)},'date':{'$first':_0x4fe5bc(0x1ef)},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x4fe5bc(0x267)},'to_room_name':{'$addToSet':_0x4fe5bc(0x227)},'finalize':{'$first':_0x4fe5bc(0x201)},'isAllowEdit':{'$first':_0x4fe5bc(0x1ac)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]==_0x4fe5bc(0x276)){var _0x225265=users[_0x4fe5bc(0x271)];console['log'](_0x225265);}else{if(_0x35cf60[0x0]['language']==_0x4fe5bc(0x1c9))var _0x225265=users[_0x4fe5bc(0x1c9)];else{if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]==_0x4fe5bc(0x261))var _0x225265=users[_0x4fe5bc(0x261)];else{if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]==_0x4fe5bc(0x246))var _0x225265=users['Spanish'];else{if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]==_0x4fe5bc(0x24a))var _0x225265=users['French'];else{if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]==_0x4fe5bc(0x273))var _0x225265=users[_0x4fe5bc(0x26d)];else{if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]==_0x4fe5bc(0x225))var _0x225265=users['Chinese'];else{if(_0x35cf60[0x0][_0x4fe5bc(0x23d)]=='Arabic\x20(ae)')var _0x225265=users[_0x4fe5bc(0x21b)];}}}}}}}_0x5bee4b['render'](_0x4fe5bc(0x22e),{'success':_0x2cc8fd[_0x4fe5bc(0x240)](_0x4fe5bc(0x1fa)),'errors':_0x2cc8fd[_0x4fe5bc(0x240)](_0x4fe5bc(0x222)),'role':_0x28332e,'profile':_0xa9668f,'master_shop':_0x35cf60,'transfer':_0x540546,'language':_0x225265});}catch(_0x3921f7){console[_0x4fe5bc(0x1b0)](_0x3921f7);}});function a0_0x5018(_0x3181b8,_0x562933){var _0x59ba78=a0_0x59ba();return a0_0x5018=function(_0x50182d,_0x3825b9){_0x50182d=_0x50182d-0x1aa;var _0xb4b285=_0x59ba78[_0x50182d];return _0xb4b285;},a0_0x5018(_0x3181b8,_0x562933);}async function getRandom8DigitNumber(){var _0x3f5a5c=a0_0x5d356b;const _0x15ac8b=0x989680,_0x34ecb0=0x5f5e0ff,_0x10b017=Math[_0x3f5a5c(0x1d8)](Math[_0x3f5a5c(0x230)]()*(_0x34ecb0-_0x15ac8b+0x1))+_0x15ac8b;var _0x56cfd1;const _0x416de6=await transfers['findOne']({'invoice':_0x3f5a5c(0x1d6)+_0x10b017});return _0x416de6&&_0x416de6[_0x3f5a5c(0x1c8)]>0x0?_0x56cfd1=_0x3f5a5c(0x1d6)+_0x10b017:_0x56cfd1=_0x3f5a5c(0x1d6)+_0x10b017,_0x56cfd1;}router['get']('/view/add_transfer',auth,async(_0x1a3017,_0x45ee83)=>{var _0x252c38=a0_0x5d356b;try{const {username:_0x57f103,email:_0x4585c7,role:_0x4f9713}=_0x1a3017[_0x252c38(0x1c2)],_0x1a907c=_0x1a3017[_0x252c38(0x1c2)],_0x511776=await profile[_0x252c38(0x211)]({'email':_0x1a907c['email']}),_0x1eacab=await master_shop[_0x252c38(0x21e)]();console[_0x252c38(0x1b0)](_0x252c38(0x1e0),_0x1eacab);let _0x383c59;if(_0x1a907c[_0x252c38(0x25d)]==_0x252c38(0x242)){const _0x437299=await staff[_0x252c38(0x211)]({'email':_0x1a907c[_0x252c38(0x223)]});_0x383c59=await warehouse[_0x252c38(0x1f6)]([{'$match':{'status':_0x252c38(0x1bd),'name':_0x437299['warehouse'],'warehouse_category':_0x252c38(0x20b)}},{'$group':{'_id':_0x252c38(0x1e7),'name':{'$first':_0x252c38(0x1e7)}}}]);}else _0x383c59=await warehouse[_0x252c38(0x1f6)]([{'$match':{'status':_0x252c38(0x1bd),'warehouse_category':_0x252c38(0x20b)}},{'$group':{'_id':'$name','name':{'$first':_0x252c38(0x1e7)}}}]);var _0x6f9904=[_0x252c38(0x22f),_0x252c38(0x27f),'Return\x20Rooms'];const _0x35c182=await transfers['find']({}),_0x53a9b4=_0x35c182['length']+0x1,_0x450e91='TRF-'+_0x53a9b4[_0x252c38(0x1db)]()[_0x252c38(0x25a)](0x5,'0');if(_0x1eacab[0x0][_0x252c38(0x23d)]==_0x252c38(0x276)){var _0xa94211=users[_0x252c38(0x271)];console[_0x252c38(0x1b0)](_0xa94211);}else{if(_0x1eacab[0x0]['language']==_0x252c38(0x1c9))var _0xa94211=users['Hindi'];else{if(_0x1eacab[0x0][_0x252c38(0x23d)]=='German')var _0xa94211=users[_0x252c38(0x261)];else{if(_0x1eacab[0x0][_0x252c38(0x23d)]==_0x252c38(0x246))var _0xa94211=users[_0x252c38(0x246)];else{if(_0x1eacab[0x0][_0x252c38(0x23d)]==_0x252c38(0x24a))var _0xa94211=users[_0x252c38(0x24a)];else{if(_0x1eacab[0x0][_0x252c38(0x23d)]=='Portuguese\x20(BR)')var _0xa94211=users[_0x252c38(0x26d)];else{if(_0x1eacab[0x0]['language']=='Chinese')var _0xa94211=users[_0x252c38(0x225)];else{if(_0x1eacab[0x0]['language']=='Arabic\x20(ae)')var _0xa94211=users['Arabic'];}}}}}}}const _0x13ca9a=getRandom8DigitNumber();_0x13ca9a['then'](_0x669c9e=>{var _0x243619=_0x252c38;_0x45ee83[_0x243619(0x210)](_0x243619(0x1f9),{'success':_0x1a3017[_0x243619(0x240)](_0x243619(0x1fa)),'errors':_0x1a3017[_0x243619(0x240)](_0x243619(0x222)),'role':_0x1a907c,'profile':_0x511776,'master_shop':_0x1eacab,'warehouse':_0x383c59,'language':_0xa94211,'rooms_data':_0x6f9904,'invoice':_0x669c9e});})[_0x252c38(0x1e9)](_0x584742=>{var _0x3b088d=_0x252c38;_0x1a3017['flash'](_0x3b088d(0x222),_0x3b088d(0x1fc)),_0x45ee83[_0x3b088d(0x28e)]('/transfer/view');});}catch(_0x342f59){console[_0x252c38(0x1b0)](_0x342f59);}}),router['post']('/view/add_transfer',auth,async(_0xc69d20,_0x28e573)=>{var _0x573658=a0_0x5d356b;try{console['log'](_0xc69d20[_0x573658(0x207)]);const {date:_0x30301c,from_warehouse:_0x401386,FromRoom_name:_0x247541,to_warehouse:_0x2849ca,ToRoom_name:_0x3e0128,prod_name:_0x1e53d4,from_prod_qty:_0x260866,from_prod_level:_0x41d17b,from_prod_isle:_0x4fa178,from_prod_pallet:_0x4363c3,to_prod_qty:_0x6c8097,to_prod_level:_0x25c59d,to_prod_isle:_0x117269,to_prod_pallet:_0x5ac057,primary_code:_0xe477e2,secondary_code:_0x442388,product_code3:_0x33dc19,note:_0x61adf7,MaxStocks_data2:_0x14f9e9,invoice:_0x392806,expiry_date:_0x5918ad}=_0xc69d20[_0x573658(0x207)];if(typeof _0x1e53d4==_0x573658(0x277))var _0x1b461e=[_0xc69d20['body'][_0x573658(0x1f0)]],_0x2d4a4c=[_0xc69d20[_0x573658(0x207)][_0x573658(0x254)]],_0x218e76=[_0xc69d20[_0x573658(0x207)][_0x573658(0x221)]],_0x281329=[_0xc69d20[_0x573658(0x207)][_0x573658(0x293)]],_0x486bc9=[_0xc69d20[_0x573658(0x207)]['to_prod_level']],_0x41b91d=[_0xc69d20[_0x573658(0x207)][_0x573658(0x253)]],_0x4a64f0=[_0xc69d20[_0x573658(0x207)][_0x573658(0x214)]],_0x1f57a8=[_0xc69d20[_0x573658(0x207)][_0x573658(0x256)]],_0x7e272c=[_0xc69d20[_0x573658(0x207)]['MaxStocks_data2']],_0x5ba5a6=[_0xc69d20[_0x573658(0x207)]['primary_unit']],_0x5585ee=[_0xc69d20['body'][_0x573658(0x209)]],_0xfc54ed=[_0xc69d20['body'][_0x573658(0x1fd)]],_0x57e0aa=[_0xc69d20[_0x573658(0x207)]['expiry_date']],_0x57f563=[_0xc69d20[_0x573658(0x207)][_0x573658(0x232)]],_0x3f386d=[_0xc69d20['body'][_0x573658(0x244)]],_0x29df27=[_0xc69d20[_0x573658(0x207)][_0x573658(0x1af)]],_0x33e700=[_0xc69d20[_0x573658(0x207)][_0x573658(0x218)]],_0x2826b2=[_0xc69d20[_0x573658(0x207)][_0x573658(0x21f)]],_0x12da18=[_0xc69d20[_0x573658(0x207)][_0x573658(0x28b)]],_0x246a71=[_0xc69d20[_0x573658(0x207)][_0x573658(0x20d)]],_0x520289=[_0xc69d20['body'][_0x573658(0x1d1)]];else var _0x1b461e=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x1f0)]],_0x2d4a4c=[..._0xc69d20[_0x573658(0x207)]['from_prod_qty']],_0x218e76=[..._0xc69d20['body'][_0x573658(0x221)]],_0x281329=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x293)]],_0x486bc9=[..._0xc69d20[_0x573658(0x207)]['to_prod_level']],_0x41b91d=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x253)]],_0x4a64f0=[..._0xc69d20[_0x573658(0x207)]['secondary_code']],_0x1f57a8=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x256)]],_0x7e272c=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x1b3)]],_0x5ba5a6=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x296)]],_0x5585ee=[..._0xc69d20[_0x573658(0x207)]['secondary_unit']],_0xfc54ed=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x1fd)]],_0x57e0aa=[..._0xc69d20['body'][_0x573658(0x252)]],_0x57f563=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x232)]],_0x3f386d=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x244)]],_0x29df27=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x1af)]],_0x33e700=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x218)]],_0x2826b2=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x21f)]],_0x12da18=[..._0xc69d20['body'][_0x573658(0x28b)]],_0x246a71=[..._0xc69d20[_0x573658(0x207)][_0x573658(0x20d)]],_0x520289=[..._0xc69d20['body']['id_transaction']];const _0x220e39=_0x1b461e[_0x573658(0x278)](_0x27dc25=>{return _0x27dc25={'product_name':_0x27dc25};});_0x2d4a4c[_0x573658(0x24c)]((_0x131c62,_0xbc39d)=>{var _0x2e8c05=_0x573658;_0x220e39[_0xbc39d][_0x2e8c05(0x1e6)]=_0x131c62;}),_0x12da18[_0x573658(0x24c)]((_0x5a37f7,_0x44fce3)=>{_0x220e39[_0x44fce3]['from_invoice']=_0x5a37f7;}),_0x246a71['forEach']((_0x26d12a,_0x308ff8)=>{var _0x362ae5=_0x573658;_0x220e39[_0x308ff8][_0x362ae5(0x239)]=_0x26d12a;}),_0x520289[_0x573658(0x24c)]((_0x319b8a,_0x46098b)=>{_0x220e39[_0x46098b]['id_transaction_id']=_0x319b8a;}),_0x218e76[_0x573658(0x24c)]((_0x594cca,_0x1bb495)=>{_0x33e700['forEach']((_0x5461be,_0x4ba21f)=>{var _0x590e5c=a0_0x5018;if(_0x5461be=='Receiving\x20Area'&&_0x1bb495==_0x4ba21f){var _0x18d8c5=_0x594cca[_0x590e5c(0x243)](0x3);_0x220e39[_0x1bb495][_0x590e5c(0x1f1)]=_0x594cca[0x0],_0x220e39[_0x1bb495][_0x590e5c(0x1fb)]=_0x594cca[0x1],_0x220e39[_0x1bb495][_0x590e5c(0x20c)]=0x0,_0x220e39[_0x1bb495][_0x590e5c(0x28d)]=0x0,_0x220e39[_0x1bb495][_0x590e5c(0x219)]=_0x590e5c(0x1e2),_0x220e39[_0x1bb495]['from_floorlevel']=_0x18d8c5;}else{if(_0x5461be==_0x590e5c(0x21d)&&_0x1bb495==_0x4ba21f){var _0x18d8c5=_0x594cca[_0x590e5c(0x243)](0x3);_0x220e39[_0x1bb495]['from_storage']=_0x594cca[0x0],_0x220e39[_0x1bb495][_0x590e5c(0x1fb)]=_0x594cca[0x1],_0x220e39[_0x1bb495][_0x590e5c(0x20c)]=0x0,_0x220e39[_0x1bb495]['from_bin']=0x0,_0x220e39[_0x1bb495][_0x590e5c(0x219)]=_0x590e5c(0x1e2),_0x220e39[_0x1bb495][_0x590e5c(0x268)]=_0x594cca[0x5];}else{if(_0x1bb495==_0x4ba21f){if(_0x594cca[0x0]=='A'&&_0x594cca[0x1]=='L'&&_0x594cca[0x2]=='L')console[_0x590e5c(0x1b0)](_0x5461be+_0x590e5c(0x1ba)+_0x1bb495+_0x590e5c(0x1ba)+_0x4ba21f+_0x590e5c(0x1ba)+_0x594cca+_0x590e5c(0x224)),_0x220e39[_0x1bb495][_0x590e5c(0x1f1)]=_0x594cca[0x0],_0x220e39[_0x1bb495]['from_rack']=_0x594cca[0x1],_0x220e39[_0x1bb495]['from_bay']=0x0,_0x220e39[_0x1bb495]['from_bin']=0x0,_0x220e39[_0x1bb495][_0x590e5c(0x219)]=_0x590e5c(0x1e2),_0x220e39[_0x1bb495]['from_floorlevel']=_0x594cca[0x3];else{var _0x2bc609;if(_0x594cca[0x4]=='L')_0x2bc609='Level';else _0x594cca[0x4]=='F'&&(_0x2bc609=_0x590e5c(0x1e2));_0x220e39[_0x1bb495]['from_storage']=_0x594cca[0x0],_0x220e39[_0x1bb495][_0x590e5c(0x1fb)]=_0x594cca[0x1],_0x220e39[_0x1bb495]['from_bay']=_0x594cca[0x2],_0x220e39[_0x1bb495][_0x590e5c(0x28d)]=_0x594cca[0x3],_0x220e39[_0x1bb495][_0x590e5c(0x219)]=_0x2bc609,_0x220e39[_0x1bb495][_0x590e5c(0x268)]=_0x594cca[0x5];}}}}});}),_0x281329[_0x573658(0x24c)]((_0x454d25,_0x5dcf70)=>{var _0x5da0dd=_0x573658;_0x220e39[_0x5dcf70][_0x5da0dd(0x238)]=_0x454d25;}),_0x486bc9[_0x573658(0x24c)]((_0x40c4dc,_0x15502c)=>{var _0x5e7a7d=_0x573658;_0x2826b2[_0x5e7a7d(0x24c)]((_0x564568,_0x387f5f)=>{var _0x5d0377=_0x5e7a7d;if(_0x564568==_0x5d0377(0x27a)&&_0x15502c==_0x387f5f){var _0x10364a=_0x40c4dc[_0x5d0377(0x243)](0x3);_0x220e39[_0x15502c][_0x5d0377(0x285)]=_0x40c4dc[0x0],_0x220e39[_0x15502c][_0x5d0377(0x1c7)]=_0x40c4dc[0x1],_0x220e39[_0x15502c][_0x5d0377(0x208)]=0x0,_0x220e39[_0x15502c][_0x5d0377(0x204)]=0x0,_0x220e39[_0x15502c][_0x5d0377(0x298)]='Floor',_0x220e39[_0x15502c][_0x5d0377(0x1df)]=_0x10364a;}else{if(_0x564568=='Shelves'&&_0x15502c==_0x387f5f){var _0x10364a=_0x40c4dc['slice'](0x3);_0x220e39[_0x15502c][_0x5d0377(0x285)]=_0x40c4dc[0x0],_0x220e39[_0x15502c][_0x5d0377(0x1c7)]=_0x40c4dc[0x1],_0x220e39[_0x15502c][_0x5d0377(0x208)]=0x0,_0x220e39[_0x15502c]['to_bin']=0x0,_0x220e39[_0x15502c][_0x5d0377(0x298)]='Floor',_0x220e39[_0x15502c][_0x5d0377(0x1df)]=_0x40c4dc[0x5];}else{if(_0x15502c==_0x387f5f){if(_0x40c4dc[0x0]=='A'&&_0x40c4dc[0x1]=='L'&&_0x40c4dc[0x2]=='L')console[_0x5d0377(0x1b0)](_0x564568+'\x20<>\x20'+_0x15502c+_0x5d0377(0x1ba)+_0x387f5f+_0x5d0377(0x1ba)+_0x40c4dc+'here'),_0x220e39[_0x15502c][_0x5d0377(0x285)]=_0x40c4dc[0x0],_0x220e39[_0x15502c][_0x5d0377(0x1c7)]=_0x40c4dc[0x1],_0x220e39[_0x15502c][_0x5d0377(0x208)]=0x0,_0x220e39[_0x15502c][_0x5d0377(0x204)]=0x0,_0x220e39[_0x15502c]['to_types']=_0x5d0377(0x1e2),_0x220e39[_0x15502c][_0x5d0377(0x1df)]=_0x40c4dc[0x3];else{var _0x24f216;if(_0x40c4dc[0x4]=='L')_0x24f216='Level';else _0x40c4dc[0x4]=='F'&&(_0x24f216=_0x5d0377(0x1e2));_0x220e39[_0x15502c]['storage']=_0x40c4dc[0x0],_0x220e39[_0x15502c][_0x5d0377(0x1c7)]=_0x40c4dc[0x1],_0x220e39[_0x15502c][_0x5d0377(0x208)]=_0x40c4dc[0x2],_0x220e39[_0x15502c][_0x5d0377(0x204)]=_0x40c4dc[0x3],_0x220e39[_0x15502c][_0x5d0377(0x298)]=_0x24f216,_0x220e39[_0x15502c]['to_floorlevel']=_0x40c4dc[0x5];}}}}});}),_0x41b91d[_0x573658(0x24c)]((_0x512619,_0x2c1058)=>{var _0x83d594=_0x573658;_0x220e39[_0x2c1058][_0x83d594(0x253)]=_0x512619;}),_0x4a64f0[_0x573658(0x24c)]((_0x125bcf,_0xf272f2)=>{var _0x3197ee=_0x573658;_0x220e39[_0xf272f2][_0x3197ee(0x214)]=_0x125bcf;}),_0x1f57a8[_0x573658(0x24c)]((_0x909fa7,_0x5d301f)=>{var _0x53754c=_0x573658;_0x220e39[_0x5d301f][_0x53754c(0x217)]=_0x909fa7;}),_0x7e272c[_0x573658(0x24c)]((_0x3189c3,_0xd5b1a6)=>{var _0x49f056=_0x573658;_0x220e39[_0xd5b1a6][_0x49f056(0x1e3)]=_0x3189c3;}),_0x5ba5a6[_0x573658(0x24c)]((_0x25ce65,_0x3b5c21)=>{_0x220e39[_0x3b5c21]['unit']=_0x25ce65;}),_0x5585ee[_0x573658(0x24c)]((_0x35d1f5,_0x38cf2a)=>{var _0xa16495=_0x573658;_0x220e39[_0x38cf2a][_0xa16495(0x209)]=_0x35d1f5;}),_0xfc54ed[_0x573658(0x24c)]((_0x396db6,_0x56590d)=>{var _0x532bf8=_0x573658;_0x220e39[_0x56590d][_0x532bf8(0x1fd)]=_0x396db6;}),_0x57e0aa[_0x573658(0x24c)]((_0x2ee705,_0x298060)=>{_0x220e39[_0x298060]['expiry_date']=_0x2ee705;}),_0x57f563[_0x573658(0x24c)]((_0x3b4892,_0x5a03ec)=>{var _0x581045=_0x573658;_0x220e39[_0x5a03ec][_0x581045(0x27d)]=_0x3b4892;}),_0x3f386d['forEach']((_0xae4f3,_0x5a6ce0)=>{var _0x25462e=_0x573658;_0x220e39[_0x5a6ce0][_0x25462e(0x244)]=_0xae4f3;}),_0x29df27[_0x573658(0x24c)]((_0x1e65ac,_0x4db062)=>{var _0x230bce=_0x573658;_0x220e39[_0x4db062][_0x230bce(0x1af)]=_0x1e65ac;}),_0x33e700[_0x573658(0x24c)]((_0xbcb629,_0x3d0f4a)=>{var _0x228b47=_0x573658;_0x220e39[_0x3d0f4a][_0x228b47(0x1e4)]=_0xbcb629;}),_0x2826b2[_0x573658(0x24c)]((_0x598e86,_0x3c0ade)=>{var _0x1fea7b=_0x573658;_0x220e39[_0x3c0ade][_0x1fea7b(0x205)]=_0x598e86;});const _0x43886f=_0x220e39[_0x573658(0x280)](_0x5a9ca6=>_0x5a9ca6[_0x573658(0x238)]!=='0'&&_0x5a9ca6[_0x573658(0x238)]!==''||_0x5a9ca6[_0x573658(0x1df)]!=='0'&&_0x5a9ca6['to_floorlevel']!==''),_0x3dd1d7=new transfers({'date':_0x30301c,'from_warehouse':_0x401386,'to_warehouse':_0x2849ca,'product':_0x43886f,'note':_0x61adf7,'invoice':_0x392806}),_0x17ce72=await _0x3dd1d7['save']();_0xc69d20['flash']('success',_0x573658(0x23e)),_0x28e573[_0x573658(0x28e)]('/transfer/preview/'+_0x17ce72[_0x573658(0x21a)]);}catch(_0x380c26){console[_0x573658(0x1b0)](_0x380c26),_0x28e573['status'](0xc8)[_0x573658(0x251)]({'errorMessage':_0x380c26[_0x573658(0x220)]});}}),router[a0_0x5d356b(0x23c)](a0_0x5d356b(0x25f),auth,async(_0x4a746b,_0x1e7233)=>{var _0x3ef763=a0_0x5d356b;try{const {username:_0x3ba2ff,email:_0x5422b6,role:_0x52948d}=_0x4a746b[_0x3ef763(0x1c2)],_0x582c3b=_0x4a746b[_0x3ef763(0x1c2)],_0x1af456=await profile[_0x3ef763(0x211)]({'email':_0x582c3b[_0x3ef763(0x223)]}),_0x5a3e10=await master_shop[_0x3ef763(0x21e)]();console['log'](_0x3ef763(0x1e0),_0x5a3e10);const _0x58578f=await transfers[_0x3ef763(0x260)](_0x4a746b[_0x3ef763(0x1f7)]['id']);let _0x22a5ba=new Date(_0x58578f[_0x3ef763(0x252)]),_0x51e5e6=('0'+_0x22a5ba['getDate']())[_0x3ef763(0x243)](-0x2),_0x5a962b=('0'+(_0x22a5ba[_0x3ef763(0x28a)]()+0x1))[_0x3ef763(0x243)](-0x2),_0x2e2680=_0x22a5ba['getFullYear'](),_0x1c50bb=_0x2e2680+'-'+_0x5a962b+'-'+_0x51e5e6,_0x49f398;if(_0x582c3b[_0x3ef763(0x25d)]=='staff'){const _0x561201=await staff[_0x3ef763(0x211)]({'email':_0x582c3b['email']});_0x49f398=await warehouse[_0x3ef763(0x21e)]({'status':_0x3ef763(0x1bd),'name':_0x561201[_0x3ef763(0x1b1)],'warehouse_category':'Raw\x20Materials'});}else _0x49f398=await warehouse['find']({'status':'Enabled','warehouse_category':_0x3ef763(0x20b)});const _0xc7cf70=await warehouse[_0x3ef763(0x1f6)]([{'$match':{'name':_0x58578f['from_warehouse']}},{'$unwind':_0x3ef763(0x295)},{'$group':{'_id':_0x3ef763(0x294),'name':{'$first':_0x3ef763(0x262)},'product_stock':{'$first':_0x3ef763(0x1b6)},'bay':{'$first':_0x3ef763(0x1d0)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3ef763(0x1bf)},'floorlevel':{'$first':_0x3ef763(0x248)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3ef763(0x1ed)},'production_date':{'$first':_0x3ef763(0x1b9)},'room':{'$first':_0x3ef763(0x20a)}}}]);if(_0x5a3e10[0x0]['language']==_0x3ef763(0x276)){var _0x58525c=users[_0x3ef763(0x271)];console[_0x3ef763(0x1b0)](_0x58525c);}else{if(_0x5a3e10[0x0][_0x3ef763(0x23d)]==_0x3ef763(0x1c9))var _0x58525c=users[_0x3ef763(0x1c9)];else{if(_0x5a3e10[0x0][_0x3ef763(0x23d)]==_0x3ef763(0x261))var _0x58525c=users['German'];else{if(_0x5a3e10[0x0]['language']=='Spanish')var _0x58525c=users[_0x3ef763(0x246)];else{if(_0x5a3e10[0x0][_0x3ef763(0x23d)]==_0x3ef763(0x24a))var _0x58525c=users['French'];else{if(_0x5a3e10[0x0][_0x3ef763(0x23d)]==_0x3ef763(0x273))var _0x58525c=users['Portuguese'];else{if(_0x5a3e10[0x0][_0x3ef763(0x23d)]=='Chinese')var _0x58525c=users[_0x3ef763(0x225)];else{if(_0x5a3e10[0x0][_0x3ef763(0x23d)]==_0x3ef763(0x289))var _0x58525c=users[_0x3ef763(0x21b)];}}}}}}}_0x1e7233[_0x3ef763(0x210)](_0x3ef763(0x1dd),{'success':_0x4a746b[_0x3ef763(0x240)]('success'),'errors':_0x4a746b[_0x3ef763(0x240)](_0x3ef763(0x222)),'role':_0x582c3b,'profile':_0x1af456,'master_shop':_0x5a3e10,'warehouse':_0x49f398,'transfer':_0x58578f,'stock':_0xc7cf70,'language':_0x58525c});}catch(_0x3e8dfd){console['log'](_0x3e8dfd);}}),router[a0_0x5d356b(0x274)](a0_0x5d356b(0x25f),auth,async(_0x3fda48,_0x241558)=>{var _0x25faf9=a0_0x5d356b;try{const _0x456834=_0x3fda48[_0x25faf9(0x1f7)]['id'],{from_warehouse:_0x5b4068,FromRoom_name:_0x2d1988,to_warehouse:_0x20b0b,ToRoom_name:_0x4de1fd}=_0x3fda48[_0x25faf9(0x207)],_0x4f7277=await transfers[_0x25faf9(0x260)]({'_id':_0x456834}),_0x1376a9=_0x4f7277[_0x25faf9(0x237)]['map'](async _0x3e6480=>{var _0x9109b6=_0x25faf9;if(_0x3e6480[_0x9109b6(0x238)]>0x0){var _0x414640=await warehouse[_0x9109b6(0x211)]({'name':_0x4f7277[_0x9109b6(0x1ab)],'room':_0x3e6480[_0x9109b6(0x1e4)],'warehouse_category':'Raw\x20Materials'});const _0x54cafd=_0x414640[_0x9109b6(0x283)][_0x9109b6(0x278)](_0x3c3859=>{var _0xcb0c0=_0x9109b6;_0x3c3859[_0xcb0c0(0x1eb)]==_0x3e6480['product_name']&&_0x3c3859[_0xcb0c0(0x1be)]==_0x3e6480[_0xcb0c0(0x268)]&&_0x3c3859[_0xcb0c0(0x1ea)]==_0x3e6480[_0xcb0c0(0x219)]&&_0x3c3859[_0xcb0c0(0x27e)]==_0x3e6480[_0xcb0c0(0x28d)]&&_0x3c3859[_0xcb0c0(0x23a)]==_0x3e6480[_0xcb0c0(0x20c)]&&_0x3c3859[_0xcb0c0(0x1c7)]==_0x3e6480[_0xcb0c0(0x1fb)]&&_0x3c3859['storage']==_0x3e6480[_0xcb0c0(0x1f1)]&&_0x3c3859['expiry_date']==_0x3e6480[_0xcb0c0(0x252)]&&_0x3c3859[_0xcb0c0(0x1fd)]==_0x3e6480[_0xcb0c0(0x1fd)]&&_0x3c3859[_0xcb0c0(0x244)]==_0x3e6480['production_date']&&_0x3c3859[_0xcb0c0(0x288)]==_0x3e6480['from_invoice']&&_0x3c3859[_0xcb0c0(0x21a)]==_0x3e6480[_0xcb0c0(0x1d4)]&&(_0x3c3859[_0xcb0c0(0x27c)]=_0x3c3859[_0xcb0c0(0x27c)]-_0x3e6480[_0xcb0c0(0x238)]);});}return _0x414640;});Promise[_0x25faf9(0x206)](_0x1376a9)[_0x25faf9(0x229)](async _0x58a58e=>{var _0x81b8eb=_0x25faf9;try{for(const _0x21509d of _0x58a58e){await _0x21509d['save']();}try{const _0x2417ee=_0x4f7277[_0x81b8eb(0x237)][_0x81b8eb(0x278)](async _0x5d343d=>{var _0x1cc50a=_0x81b8eb;if(_0x5d343d['to_quantity']>0x0){var _0x52354d=await warehouse[_0x1cc50a(0x211)]({'name':_0x4f7277[_0x1cc50a(0x20e)],'room':_0x5d343d['to_room_name'],'warehouse_category':'Raw\x20Materials'}),_0x34c02e=0x0;const _0x3080fc=_0x52354d[_0x1cc50a(0x283)]['map'](_0x185716=>{var _0x15d9c2=_0x1cc50a;_0x185716[_0x15d9c2(0x1eb)]==_0x5d343d['product_name']&&_0x185716[_0x15d9c2(0x1be)]==_0x5d343d[_0x15d9c2(0x1df)]&&_0x185716[_0x15d9c2(0x1ea)]==_0x5d343d[_0x15d9c2(0x298)]&&_0x185716[_0x15d9c2(0x27e)]==_0x5d343d['to_bin']&&_0x185716['bay']==_0x5d343d[_0x15d9c2(0x208)]&&_0x185716[_0x15d9c2(0x1c7)]==_0x5d343d[_0x15d9c2(0x1c7)]&&_0x185716['storage']==_0x5d343d[_0x15d9c2(0x285)]&&_0x185716[_0x15d9c2(0x252)]==_0x5d343d[_0x15d9c2(0x252)]&&_0x185716[_0x15d9c2(0x1fd)]==_0x5d343d['batch_code']&&_0x185716[_0x15d9c2(0x244)]==_0x5d343d[_0x15d9c2(0x244)]&&_0x185716[_0x15d9c2(0x288)]==_0x5d343d[_0x15d9c2(0x239)]&&(_0x185716[_0x15d9c2(0x27c)]=_0x185716[_0x15d9c2(0x27c)]+_0x5d343d['to_quantity'],_0x34c02e++);});_0x34c02e=='0'&&(_0x52354d[_0x1cc50a(0x283)]=_0x52354d[_0x1cc50a(0x283)][_0x1cc50a(0x26a)]({'product_name':_0x5d343d[_0x1cc50a(0x1eb)],'product_stock':_0x5d343d[_0x1cc50a(0x238)],'bay':_0x5d343d[_0x1cc50a(0x208)],'bin':_0x5d343d[_0x1cc50a(0x204)],'type':_0x5d343d[_0x1cc50a(0x298)],'floorlevel':_0x5d343d[_0x1cc50a(0x1df)],'storage':_0x5d343d['storage'],'rack':_0x5d343d[_0x1cc50a(0x1c7)],'product_code':_0x5d343d[_0x1cc50a(0x217)],'primary_code':_0x5d343d[_0x1cc50a(0x253)],'secondary_code':_0x5d343d[_0x1cc50a(0x214)],'maxProducts':_0x5d343d['maxProducts'],'storage':_0x5d343d['storage'],'rack':_0x5d343d[_0x1cc50a(0x1c7)],'expiry_date':_0x5d343d['expiry_date'],'maxPerUnit':_0x5d343d[_0x1cc50a(0x27d)],'batch_code':_0x5d343d[_0x1cc50a(0x1fd)],'production_date':_0x5d343d[_0x1cc50a(0x244)]}));}return _0x52354d;});Promise[_0x81b8eb(0x206)](_0x2417ee)[_0x81b8eb(0x229)](async _0x16d07c=>{var _0x57767a=_0x81b8eb;try{for(const _0x454720 of _0x16d07c){await warehouse[_0x57767a(0x299)]({'_id':_0x454720['_id']},{'$addToSet':{'product_details':{'$each':_0x454720[_0x57767a(0x283)]}}});}_0x4f7277[_0x57767a(0x25c)]=_0x57767a(0x1c5);const _0x4beee3=await _0x4f7277['save'](),_0xc12770=await master_shop[_0x57767a(0x21e)](),_0x205cdd=await email_settings[_0x57767a(0x211)](),_0x5b3a7e=await supervisor_settings[_0x57767a(0x21e)]();var _0x57b097=_0x4f7277[_0x57767a(0x237)],_0x48a0c4='',_0x12045a;for(_0x12045a in _0x57b097){_0x48a0c4+=_0x57767a(0x287)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57b097[_0x12045a][_0x57767a(0x1eb)]+_0x57767a(0x1f5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57b097[_0x12045a][_0x57767a(0x217)]+_0x57767a(0x1f5)+_0x57767a(0x200)+_0x57b097[_0x12045a][_0x57767a(0x238)]+_0x57767a(0x1f5)+_0x57767a(0x200)+_0x57b097[_0x12045a][_0x57767a(0x1f4)]+_0x57767a(0x1f5)+_0x57767a(0x200)+_0x57b097[_0x12045a]['secondary_unit']+_0x57767a(0x1f5)+_0x57767a(0x200)+_0x4f7277[_0x57767a(0x20e)]+_0x57767a(0x1f5)+_0x57767a(0x200)+_0x57b097[_0x12045a][_0x57767a(0x205)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57b097[_0x12045a]['storage']+_0x57b097[_0x12045a][_0x57767a(0x1c7)]+_0x57b097[_0x12045a][_0x57767a(0x208)]+_0x57b097[_0x12045a][_0x57767a(0x204)]+_0x57b097[_0x12045a]['to_types'][0x0]+_0x57b097[_0x12045a]['to_floorlevel']+_0x57767a(0x1f5),_0x57767a(0x1aa);}let _0x3fa369=nodemailer[_0x57767a(0x1cf)]({'host':_0x205cdd[_0x57767a(0x270)],'port':Number(_0x205cdd[_0x57767a(0x1f8)]),'secure':![],'auth':{'user':_0x205cdd[_0x57767a(0x223)],'pass':_0x205cdd[_0x57767a(0x1b5)]}}),_0xaf2972={'from':_0x205cdd[_0x57767a(0x223)],'to':_0x5b3a7e[0x0]['RMSEmail'],'subject':_0x57767a(0x21c),'attachments':[{'filename':_0x57767a(0x236),'path':__dirname+'/../public'+'/upload/'+_0xc12770[0x0][_0x57767a(0x228)],'cid':'logo'}],'html':_0x57767a(0x292)+'<html><head><title></title>'+_0x57767a(0x269)+_0x57767a(0x26e)+_0x57767a(0x25b)+'<div>'+_0x57767a(0x22b)+_0x57767a(0x255)+_0x57767a(0x26e)+_0x57767a(0x241)+_0xc12770[0x0][_0x57767a(0x235)]+_0x57767a(0x23f)+'</div>'+'</div>'+_0x57767a(0x20f)+_0x57767a(0x26e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x57767a(0x1ee)+_0x4f7277[_0x57767a(0x288)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x57767a(0x264)+_0x4f7277[_0x57767a(0x1ce)]+'\x20'+_0x57767a(0x215)+_0x57767a(0x226)+_0x57767a(0x255)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x57767a(0x22d)+_0x57767a(0x287)+_0x57767a(0x1da)+_0x57767a(0x265)+_0x57767a(0x1e8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x57767a(0x22c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x57767a(0x1de)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x57767a(0x1aa)+_0x57767a(0x203)+_0x57767a(0x281)+'\x20'+_0x48a0c4+'\x20'+'</tbody>'+_0x57767a(0x1fe)+_0x57767a(0x26e)+_0x57767a(0x1d9)+_0x57767a(0x25e)+_0xc12770[0x0]['site_title']+'</h5>'+_0x57767a(0x255)+_0x57767a(0x255)+_0x57767a(0x1c1)};_0x3fa369[_0x57767a(0x24b)](_0xaf2972,function(_0x1835e5,_0x64c6fd){var _0x17b63a=_0x57767a;_0x1835e5?(console[_0x17b63a(0x1b0)](_0x1835e5),console[_0x17b63a(0x1b0)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x3fda48[_0x57767a(0x240)]('success','Transfer\x20Finalize\x20Successfully'),_0x241558[_0x57767a(0x28e)](_0x57767a(0x216)+_0x4beee3['_id']);}catch(_0x23b2ea){console[_0x57767a(0x26f)](_0x23b2ea),_0x241558[_0x57767a(0x1d2)](0x1f4)[_0x57767a(0x251)]({'Perror':'An\x20error\x20occurred\x20while\x20saving\x20data.','message':_0x23b2ea[_0x57767a(0x220)]});}})[_0x81b8eb(0x1e9)](_0x44b3c4=>{var _0x181c4d=_0x81b8eb;console[_0x181c4d(0x26f)](_0x44b3c4),_0x241558['status'](0x1f4)[_0x181c4d(0x251)]({'Perror':_0x181c4d(0x231)});});}catch(_0x2eef13){_0x241558[_0x81b8eb(0x251)](_0x2eef13);}}catch(_0x38ac3e){console['error'](_0x38ac3e),_0x241558[_0x81b8eb(0x1d2)](0x1f4)[_0x81b8eb(0x251)]({'Merror':_0x81b8eb(0x29c),'Message':_0x38ac3e[_0x81b8eb(0x220)]});}})[_0x25faf9(0x1e9)](_0x37b13c=>{var _0x4d42e4=_0x25faf9;console[_0x4d42e4(0x26f)](_0x37b13c),_0x241558[_0x4d42e4(0x1d2)](0x1f4)[_0x4d42e4(0x251)]({'Merror':_0x4d42e4(0x231)});});}catch(_0x5ef51d){console[_0x25faf9(0x1b0)](_0x5ef51d);}});function BayBinSelected(_0x47a03c,_0x4ab2d7){var _0x5e2699=a0_0x5d356b,_0x5731a0=[],_0x4278c7=[],_0x10aae0=[],_0x3c2a36=[],_0x72b561=[],_0x5cfbd9=[];let _0x47eb91=[];if(_0x47a03c==_0x5e2699(0x1c0))switch(_0x4ab2d7){case _0x5e2699(0x1cc):_0x5731a0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4278c7=[0x1,0x2],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=[_0x5e2699(0x266),_0x5e2699(0x1e2)],_0x72b561=['D'],_0x5cfbd9=['A'];break;case'Rack\x20B':_0x5731a0=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4278c7=[0x1,0x2],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=[_0x5e2699(0x266),_0x5e2699(0x1e2)],_0x72b561=['D'],_0x5cfbd9=['B'];break;case _0x5e2699(0x21d):_0x5731a0=[0x0],_0x4278c7=[0x0],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=['Floor'],_0x72b561=['D'],_0x5cfbd9=['S'];break;case _0x5e2699(0x27a):_0x5731a0=[0x0],_0x4278c7=[0x0],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x10aae0=['Floor'],_0x72b561=['D'],_0x5cfbd9=['R'];break;}else{if(_0x47a03c==_0x5e2699(0x233))switch(_0x4ab2d7){case _0x5e2699(0x1cc):_0x5731a0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4278c7=['B','F'],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=[_0x5e2699(0x266),_0x5e2699(0x1e2)],_0x72b561=['C'],_0x5cfbd9=['A'];break;case'Rack\x20B':_0x5731a0=[0x5,0x4,0x3,0x2,0x1],_0x4278c7=['F','B','S'],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=['Level',_0x5e2699(0x1e2)],_0x72b561=['C'],_0x5cfbd9=['B'];break;case _0x5e2699(0x29a):_0x5731a0=[0x1,0x2,0x3,0x4,0x5],_0x4278c7=['B','F','S'],_0x3c2a36=[0x5,0x4,0x3,0x2,0x1],_0x10aae0=['Level',_0x5e2699(0x1e2)],_0x72b561=['C'],_0x5cfbd9=['C'];break;case _0x5e2699(0x26b):_0x5731a0=[0x5,0x4,0x3,0x2,0x1],_0x4278c7=['F','B','S'],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=[_0x5e2699(0x266),'Floor'],_0x72b561=['C'],_0x5cfbd9=['D'];break;case'Rack\x20E':_0x5731a0=[0x4,0x3,0x2,0x1],_0x4278c7=[0x1,0x2],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=[_0x5e2699(0x266),_0x5e2699(0x1e2)],_0x72b561=['C'],_0x5cfbd9=['E'];break;case'Rack\x20F':_0x5731a0=[0x1,0x2,0x3],_0x4278c7=[0x1,0x2],_0x3c2a36=[0x1,0x2,0x3,0x4,0x5],_0x10aae0=[_0x5e2699(0x266)],_0x72b561=['C'],_0x5cfbd9=['F'];break;}}return{'levels':_0x5731a0,'Isle':_0x4278c7,'rack':_0x3c2a36,'type':_0x10aae0,'storage':_0x72b561,'rak':_0x5cfbd9};}router['get'](a0_0x5d356b(0x1c4),auth,async(_0x5d9359,_0x2304d6)=>{var _0x853638=a0_0x5d356b;try{const {username:_0x17c8c8,email:_0x4a6c05,role:_0x5ea74c}=_0x5d9359[_0x853638(0x1c2)],_0x168f4d=_0x5d9359['user'],_0xec209e=await profile[_0x853638(0x211)]({'email':_0x168f4d[_0x853638(0x223)]}),_0x1f3e72=await master_shop[_0x853638(0x21e)](),_0x2d5dda=await transfers['findById'](_0x5d9359['params']['id']);let _0x56ecfc;if(_0x168f4d[_0x853638(0x25d)]=='staff'){const _0x134aa9=await staff[_0x853638(0x211)]({'email':_0x168f4d[_0x853638(0x223)]});_0x56ecfc=await warehouse[_0x853638(0x1f6)]([{'$match':{'status':_0x853638(0x1bd),'name':_0x134aa9[_0x853638(0x1b1)],'warehouse_category':_0x853638(0x20b)}},{'$group':{'_id':_0x853638(0x1e7),'name':{'$first':_0x853638(0x1e7)}}}]);}else _0x56ecfc=await warehouse[_0x853638(0x1f6)]([{'$match':{'status':_0x853638(0x1bd),'warehouse_category':_0x853638(0x20b)}},{'$group':{'_id':_0x853638(0x1e7),'name':{'$first':_0x853638(0x1e7)}}}]);const _0x354515=await warehouse[_0x853638(0x1f6)]([{'$match':{'name':_0x2d5dda['from_warehouse'],'warehouse_category':_0x853638(0x20b)}},{'$unwind':_0x853638(0x295)},{'$group':{'_id':_0x853638(0x294),'name':{'$first':_0x853638(0x262)},'product_stock':{'$first':_0x853638(0x1b6)},'bay':{'$first':_0x853638(0x1d0)},'bin':{'$first':_0x853638(0x258)},'type':{'$first':_0x853638(0x1bf)},'floorlevel':{'$first':_0x853638(0x248)},'primary_code':{'$first':_0x853638(0x28f)},'secondary_code':{'$first':_0x853638(0x234)},'product_code':{'$first':_0x853638(0x282)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x853638(0x1e1)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':_0x853638(0x20a)}}}]),_0x1101a7=await product['find']({}),_0x4a58e1=BayBinSelected(_0x2d5dda[_0x853638(0x20e)],_0x2d5dda[_0x853638(0x291)]);if(_0x1f3e72[0x0][_0x853638(0x23d)]==_0x853638(0x276)){var _0x11ef66=users[_0x853638(0x271)];console[_0x853638(0x1b0)](_0x11ef66);}else{if(_0x1f3e72[0x0][_0x853638(0x23d)]==_0x853638(0x1c9))var _0x11ef66=users[_0x853638(0x1c9)];else{if(_0x1f3e72[0x0][_0x853638(0x23d)]=='German')var _0x11ef66=users['German'];else{if(_0x1f3e72[0x0][_0x853638(0x23d)]==_0x853638(0x246))var _0x11ef66=users[_0x853638(0x246)];else{if(_0x1f3e72[0x0][_0x853638(0x23d)]==_0x853638(0x24a))var _0x11ef66=users[_0x853638(0x24a)];else{if(_0x1f3e72[0x0]['language']==_0x853638(0x273))var _0x11ef66=users['Portuguese'];else{if(_0x1f3e72[0x0][_0x853638(0x23d)]==_0x853638(0x225))var _0x11ef66=users[_0x853638(0x225)];else{if(_0x1f3e72[0x0][_0x853638(0x23d)]=='Arabic\x20(ae)')var _0x11ef66=users[_0x853638(0x21b)];}}}}}}}_0x2304d6[_0x853638(0x210)](_0x853638(0x24e),{'success':_0x5d9359[_0x853638(0x240)](_0x853638(0x1fa)),'errors':_0x5d9359['flash'](_0x853638(0x222)),'role':_0x168f4d,'profile':_0xec209e,'master_shop':_0x1f3e72,'warehouse':_0x56ecfc,'transfer':_0x2d5dda,'stock':_0x354515,'unit':_0x1101a7,'language':_0x11ef66});}catch(_0x4da99f){console[_0x853638(0x1b0)](_0x4da99f);}}),router['post']('/view/:id',auth,async(_0x1aa0a2,_0x3c7e98)=>{var _0x2fc222=a0_0x5d356b;try{const _0x41e95a=_0x1aa0a2[_0x2fc222(0x1f7)]['id'],_0x440101=await transfers[_0x2fc222(0x260)](_0x41e95a);_0x3c7e98[_0x2fc222(0x251)](_0x1aa0a2['body']);return;const {date:_0x5536ee,from_warehouse:_0x2d790c,FromRoom_name:_0xec0d40,to_warehouse:_0x2270b9,ToRoom_name:_0xb4e571,prod_name:_0x17a35f,from_prod_qty:_0x41708a,from_prod_level:_0x50bc2c,from_prod_isle:_0x1fbd99,from_prod_pallet:_0xb389e4,to_prod_qty:_0x41a324,to_prod_level:_0x464b14,to_prod_isle:_0x47d4d1,to_prod_pallet:_0x38821d,primary_code:_0x1bd1e1,secondary_code:_0x217ba9,product_code3:_0x4d2d23,note:_0x327490,invoice:_0x36b9f3,expiry_date:_0x2c4e67}=_0x1aa0a2[_0x2fc222(0x207)];if(typeof _0x17a35f==_0x2fc222(0x277))var _0x2d7371=[_0x1aa0a2[_0x2fc222(0x207)]['prod_name']],_0x23bef9=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x254)]],_0x386249=[_0x1aa0a2['body']['from_prod_level']],_0x4662e3=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1e5)]],_0xc10fac=[_0x1aa0a2['body'][_0x2fc222(0x245)]],_0x69f622=[_0x1aa0a2[_0x2fc222(0x207)]['from_types']],_0x2129cb=[_0x1aa0a2[_0x2fc222(0x207)]['to_prod_qty']],_0x37a30a=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x263)]],_0x11b50a=[_0x1aa0a2[_0x2fc222(0x207)]['to_prod_isle']],_0x1d84df=[_0x1aa0a2['body']['to_prod_pallet']],_0x3e3141=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x298)]],_0x2622c1=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x285)]],_0x361b2b=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1bb)]],_0x2124a8=[_0x1aa0a2[_0x2fc222(0x207)]['primary_code']],_0x360212=[_0x1aa0a2['body'][_0x2fc222(0x214)]],_0x513f34=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x256)]],_0x499e7c=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1b3)]],_0x599601=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1f4)]],_0x34505c=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x209)]],_0x15eace=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1fd)]],_0x34fe3d=[_0x1aa0a2['body'][_0x2fc222(0x252)]],_0x517e78=[_0x1aa0a2[_0x2fc222(0x207)]['from_storage']],_0x2a5ac2=[_0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1f3)]];else var _0x2d7371=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1f0)]],_0x2622c1=[..._0x1aa0a2['body']['storage']],_0x361b2b=[..._0x1aa0a2['body'][_0x2fc222(0x1bb)]],_0x69f622=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x219)]],_0x3e3141=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x298)]],_0x23bef9=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x254)]],_0x386249=[..._0x1aa0a2['body'][_0x2fc222(0x221)]],_0x4662e3=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1e5)]],_0xc10fac=[..._0x1aa0a2[_0x2fc222(0x207)]['from_prod_pallet']],_0x2129cb=[..._0x1aa0a2['body'][_0x2fc222(0x297)]],_0x37a30a=[..._0x1aa0a2[_0x2fc222(0x207)]['to_prod_level']],_0x11b50a=[..._0x1aa0a2['body']['to_prod_isle']],_0x1d84df=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1bc)]],_0x2124a8=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x253)]],_0x360212=[..._0x1aa0a2['body']['secondary_code']],_0x513f34=[..._0x1aa0a2[_0x2fc222(0x207)]['product_code3']],_0x499e7c=[..._0x1aa0a2['body'][_0x2fc222(0x1b3)]],_0x599601=[..._0x1aa0a2['body'][_0x2fc222(0x1f4)]],_0x34505c=[..._0x1aa0a2['body'][_0x2fc222(0x209)]],_0x15eace=[..._0x1aa0a2['body'][_0x2fc222(0x1fd)]],_0x34fe3d=[..._0x1aa0a2[_0x2fc222(0x207)]['expiry_date']],_0x517e78=[..._0x1aa0a2[_0x2fc222(0x207)][_0x2fc222(0x1f1)]],_0x2a5ac2=[..._0x1aa0a2['body']['from_rak']];const _0x30e6fa=_0x2d7371['map'](_0x4bf05d=>{return _0x4bf05d={'product_name':_0x4bf05d};});_0x23bef9['forEach']((_0x40f2d2,_0x178088)=>{var _0x2c81b4=_0x2fc222;_0x30e6fa[_0x178088][_0x2c81b4(0x1e6)]=_0x40f2d2;}),_0x386249[_0x2fc222(0x24c)]((_0x15f25a,_0x183dab)=>{var _0x5bba33=_0x2fc222;_0x30e6fa[_0x183dab][_0x5bba33(0x20c)]=_0x15f25a;}),_0x4662e3[_0x2fc222(0x24c)]((_0xc85483,_0x2a5a96)=>{var _0x1ed868=_0x2fc222;_0x30e6fa[_0x2a5a96][_0x1ed868(0x28d)]=_0xc85483;}),_0xc10fac[_0x2fc222(0x24c)]((_0x584b55,_0x2d3f45)=>{_0x30e6fa[_0x2d3f45]['from_floorlevel']=_0x584b55;}),_0x2129cb['forEach']((_0x587c4e,_0x541d5d)=>{var _0x40f556=_0x2fc222;_0x30e6fa[_0x541d5d][_0x40f556(0x238)]=_0x587c4e;}),_0x37a30a['forEach']((_0xc3e20c,_0x8a72d2)=>{_0x30e6fa[_0x8a72d2]['to_bay']=_0xc3e20c;}),_0x11b50a[_0x2fc222(0x24c)]((_0x3cd547,_0x459de6)=>{_0x30e6fa[_0x459de6]['to_bin']=_0x3cd547;}),_0x1d84df[_0x2fc222(0x24c)]((_0x242c41,_0x5c26ca)=>{var _0x2bf720=_0x2fc222;_0x30e6fa[_0x5c26ca][_0x2bf720(0x1df)]=_0x242c41;}),_0x2124a8[_0x2fc222(0x24c)]((_0x12baa5,_0x3d527f)=>{_0x30e6fa[_0x3d527f]['primary_code']=_0x12baa5;}),_0x360212[_0x2fc222(0x24c)]((_0x3bc446,_0xa93698)=>{var _0x10340d=_0x2fc222;_0x30e6fa[_0xa93698][_0x10340d(0x214)]=_0x3bc446;}),_0x513f34[_0x2fc222(0x24c)]((_0x48cf4d,_0x1b75ff)=>{var _0x33b370=_0x2fc222;_0x30e6fa[_0x1b75ff][_0x33b370(0x217)]=_0x48cf4d;}),_0x499e7c[_0x2fc222(0x24c)]((_0x46e2d2,_0x22d11d)=>{var _0x1a5542=_0x2fc222;_0x30e6fa[_0x22d11d][_0x1a5542(0x1e3)]=_0x46e2d2;}),_0x599601['forEach']((_0xa97c71,_0x2dd9c7)=>{var _0xaa3980=_0x2fc222;_0x30e6fa[_0x2dd9c7][_0xaa3980(0x1f4)]=_0xa97c71;}),_0x34505c[_0x2fc222(0x24c)]((_0x1f0156,_0x5acd41)=>{var _0x3a86f7=_0x2fc222;_0x30e6fa[_0x5acd41][_0x3a86f7(0x209)]=_0x1f0156;}),_0x15eace['forEach']((_0x3f9618,_0x49b579)=>{var _0x4e181b=_0x2fc222;_0x30e6fa[_0x49b579][_0x4e181b(0x1fd)]=_0x3f9618;}),_0x34fe3d[_0x2fc222(0x24c)]((_0x3ae046,_0x46ca42)=>{var _0x54209d=_0x2fc222;_0x30e6fa[_0x46ca42][_0x54209d(0x252)]=_0x3ae046;}),_0x2622c1[_0x2fc222(0x24c)]((_0x1f578f,_0x1412c3)=>{var _0x34f80f=_0x2fc222;_0x30e6fa[_0x1412c3][_0x34f80f(0x285)]=_0x1f578f;}),_0x361b2b[_0x2fc222(0x24c)]((_0x516d26,_0x194e87)=>{var _0x3401de=_0x2fc222;_0x30e6fa[_0x194e87][_0x3401de(0x1c7)]=_0x516d26;}),_0x69f622['forEach']((_0x2a5565,_0x2204f2)=>{var _0x335645=_0x2fc222;_0x30e6fa[_0x2204f2][_0x335645(0x219)]=_0x2a5565;}),_0x3e3141[_0x2fc222(0x24c)]((_0x461c9d,_0x4908e3)=>{var _0x376de5=_0x2fc222;_0x30e6fa[_0x4908e3][_0x376de5(0x298)]=_0x461c9d;}),_0x517e78[_0x2fc222(0x24c)]((_0x392373,_0x44f59d)=>{var _0x3d6542=_0x2fc222;_0x30e6fa[_0x44f59d][_0x3d6542(0x1f1)]=_0x392373;}),_0x2a5ac2[_0x2fc222(0x24c)]((_0x89183c,_0x136f63)=>{_0x30e6fa[_0x136f63]['from_rack']=_0x89183c;});const _0x26d8c6=_0x30e6fa[_0x2fc222(0x280)](_0x24d8db=>_0x24d8db['to_quantity']!=='0'&&_0x24d8db['to_quantity']!==''||_0x24d8db[_0x2fc222(0x1df)]!=='0'&&_0x24d8db['to_floorlevel']!=='');var _0x220973=0x0;_0x26d8c6[_0x2fc222(0x24c)](_0x5d276d=>{var _0x2c0c24=_0x2fc222;parseInt(_0x5d276d['from_quantity'])<parseInt(_0x5d276d[_0x2c0c24(0x238)])&&_0x220973++;});if(_0x220973!=0x0)return _0x1aa0a2[_0x2fc222(0x240)](_0x2fc222(0x222),_0x2fc222(0x1ec)),_0x3c7e98[_0x2fc222(0x28e)]('back');const _0x526493=await warehouse[_0x2fc222(0x211)]({'name':_0x440101[_0x2fc222(0x1ab)],'room':_0x440101['from_room']});_0x440101[_0x2fc222(0x237)][_0x2fc222(0x24c)](_0x1736fd=>{var _0x1a1ffb=_0x2fc222;if(_0x1736fd[_0x1a1ffb(0x238)]>0x0){const _0x281ad0=_0x526493[_0x1a1ffb(0x283)]['map'](_0x169295=>{var _0x4a307e=_0x1a1ffb;_0x169295[_0x4a307e(0x1eb)]==_0x1736fd[_0x4a307e(0x1eb)]&&_0x169295[_0x4a307e(0x1be)]==_0x1736fd[_0x4a307e(0x268)]&&_0x169295[_0x4a307e(0x1ea)]==_0x1736fd['from_types']&&_0x169295['bin']==_0x1736fd[_0x4a307e(0x28d)]&&_0x169295[_0x4a307e(0x23a)]==_0x1736fd[_0x4a307e(0x20c)]&&_0x169295[_0x4a307e(0x1c7)]==_0x1736fd[_0x4a307e(0x1fb)]&&_0x169295[_0x4a307e(0x285)]==_0x1736fd[_0x4a307e(0x1f1)]&&(_0x169295[_0x4a307e(0x27c)]=parseInt(_0x169295[_0x4a307e(0x27c)])+parseInt(_0x1736fd[_0x4a307e(0x238)]));});}}),await _0x526493[_0x2fc222(0x1c3)]();const _0x51e9c9=await warehouse[_0x2fc222(0x211)]({'name':_0x440101[_0x2fc222(0x20e)],'room':_0x440101['to_room']});_0x440101[_0x2fc222(0x237)]['forEach'](_0x1acd14=>{var _0x2ac0cf=_0x2fc222;if(_0x1acd14[_0x2ac0cf(0x238)]>0x0){const _0x3185cf=_0x51e9c9['product_details'][_0x2ac0cf(0x278)](_0x5c1ada=>{var _0x4d68f7=_0x2ac0cf;_0x5c1ada[_0x4d68f7(0x1eb)]==_0x1acd14[_0x4d68f7(0x1eb)]&&_0x5c1ada['floorlevel']==_0x1acd14[_0x4d68f7(0x1df)]&&_0x5c1ada[_0x4d68f7(0x1ea)]==_0x1acd14[_0x4d68f7(0x298)]&&_0x5c1ada[_0x4d68f7(0x27e)]==_0x1acd14['to_bin']&&_0x5c1ada['bay']==_0x1acd14[_0x4d68f7(0x208)]&&_0x5c1ada[_0x4d68f7(0x1c7)]==_0x1acd14[_0x4d68f7(0x1c7)]&&_0x5c1ada[_0x4d68f7(0x285)]==_0x1acd14[_0x4d68f7(0x285)]&&(_0x5c1ada['product_stock']=parseInt(_0x5c1ada[_0x4d68f7(0x27c)])-parseInt(_0x1acd14[_0x4d68f7(0x238)]));});}}),await _0x51e9c9[_0x2fc222(0x1c3)](),_0x440101[_0x2fc222(0x1ce)]=_0x5536ee,_0x440101[_0x2fc222(0x1ab)]=_0x2d790c,_0x440101[_0x2fc222(0x20e)]=_0x2270b9,_0x440101[_0x2fc222(0x237)]=_0x26d8c6,_0x440101[_0x2fc222(0x1cd)]=_0x327490,_0x440101[_0x2fc222(0x288)]=_0x36b9f3;const _0x4fb16c=await _0x440101[_0x2fc222(0x1c3)]();console[_0x2fc222(0x1b0)](_0x4fb16c);const _0x3b57ae=await warehouse[_0x2fc222(0x211)]({'name':_0x2d790c,'room':_0xec0d40});_0x4fb16c['product']['forEach'](_0x173c88=>{var _0x476259=_0x2fc222;if(_0x173c88[_0x476259(0x238)]>0x0){const _0x142bb5=_0x3b57ae['product_details']['map'](_0x30749b=>{var _0x278917=_0x476259;_0x30749b[_0x278917(0x1eb)]==_0x173c88[_0x278917(0x1eb)]&&_0x30749b['floorlevel']==_0x173c88[_0x278917(0x268)]&&_0x30749b['type']==_0x173c88[_0x278917(0x219)]&&_0x30749b['bin']==_0x173c88['from_bin']&&_0x30749b[_0x278917(0x23a)]==_0x173c88[_0x278917(0x20c)]&&_0x30749b['rack']==_0x173c88[_0x278917(0x1fb)]&&_0x30749b[_0x278917(0x285)]==_0x173c88[_0x278917(0x1f1)]&&(_0x30749b[_0x278917(0x27c)]=parseInt(_0x30749b[_0x278917(0x27c)])-parseInt(_0x173c88[_0x278917(0x238)]));});}}),await _0x3b57ae[_0x2fc222(0x1c3)]();const _0x41009b=await warehouse[_0x2fc222(0x211)]({'name':_0x2270b9,'room':_0xb4e571});_0x4fb16c[_0x2fc222(0x237)][_0x2fc222(0x24c)](_0x18ee31=>{var _0x2f85ef=_0x2fc222;if(_0x18ee31[_0x2f85ef(0x238)]>0x0){var _0xc70e48=0x0;const _0x3b7ad2=_0x41009b[_0x2f85ef(0x283)]['map'](_0x195342=>{var _0x2e0c8f=_0x2f85ef;_0x195342['product_name']==_0x18ee31[_0x2e0c8f(0x1eb)]&&_0x195342[_0x2e0c8f(0x1be)]==_0x18ee31[_0x2e0c8f(0x1df)]&&_0x195342[_0x2e0c8f(0x1ea)]==_0x18ee31['to_types']&&_0x195342[_0x2e0c8f(0x27e)]==_0x18ee31[_0x2e0c8f(0x204)]&&_0x195342[_0x2e0c8f(0x23a)]==_0x18ee31['to_bay']&&_0x195342[_0x2e0c8f(0x1c7)]==_0x18ee31[_0x2e0c8f(0x1c7)]&&_0x195342[_0x2e0c8f(0x285)]==_0x18ee31[_0x2e0c8f(0x285)]&&(_0x195342['product_stock']=parseInt(_0x195342[_0x2e0c8f(0x27c)])+parseInt(_0x18ee31['to_quantity']),_0xc70e48++);});_0xc70e48=='0'&&(_0x41009b[_0x2f85ef(0x283)]=_0x41009b[_0x2f85ef(0x283)]['concat']({'product_name':_0x18ee31['product_name'],'product_stock':_0x18ee31[_0x2f85ef(0x238)],'bay':_0x18ee31[_0x2f85ef(0x208)],'bin':_0x18ee31['to_bin'],'type':_0x18ee31[_0x2f85ef(0x298)],'floorlevel':_0x18ee31[_0x2f85ef(0x1df)],'storage':_0x18ee31['storage'],'rack':_0x18ee31[_0x2f85ef(0x1c7)],'product_code':_0x18ee31['product_code'],'primary_code':_0x18ee31[_0x2f85ef(0x253)],'secondary_code':_0x18ee31[_0x2f85ef(0x214)],'maxProducts':_0x18ee31['maxProducts'],'storage':_0x18ee31[_0x2f85ef(0x285)],'rack':_0x18ee31[_0x2f85ef(0x1c7)]}));}}),await _0x41009b['save'](),_0x1aa0a2[_0x2fc222(0x240)](_0x2fc222(0x1fa),_0x2fc222(0x249)),_0x3c7e98[_0x2fc222(0x28e)](_0x2fc222(0x275));}catch(_0x4d2cb7){console[_0x2fc222(0x1b0)](_0x4d2cb7);}}),router['post'](a0_0x5d356b(0x1b2),async(_0x293506,_0x56bd62)=>{var _0x559b37=a0_0x5d356b;const {FromWareHouse:_0x335834,FromRoom:_0x224936,ToWarehouse:_0x30fcdd,ToRoom:_0xccc6f4,primary_code:_0x4b504b,Roomslist:_0xf6a11c}=_0x293506[_0x559b37(0x207)],_0x9ed90c=_0xf6a11c[_0x559b37(0x23b)](','),_0x5c4107=[];async function _0x3393b0(_0x501ca2){var _0x37680f=_0x559b37;const _0x4d2b2a=await warehouse[_0x37680f(0x1f6)]([{'$match':{'name':_0x335834,'room':_0x501ca2}},{'$unwind':_0x37680f(0x295)},{'$match':{'product_details.primary_code':_0x4b504b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x37680f(0x262)},'instock':{'$first':_0x37680f(0x1b6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x37680f(0x234)},'product_code':{'$first':_0x37680f(0x282)},'level':{'$first':_0x37680f(0x1d0)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x37680f(0x1bf)},'pallet':{'$first':_0x37680f(0x248)},'unit':{'$first':_0x37680f(0x1d3)},'secondary_unit':{'$first':_0x37680f(0x1dc)},'storage':{'$first':_0x37680f(0x290)},'rack':{'$first':_0x37680f(0x1e1)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x37680f(0x1b9)},'batch_code':{'$first':_0x37680f(0x1cb)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'prod_cat':{'$first':'P'},'roomNamed':{'$first':'$room'},'maxProducts':{'$first':_0x37680f(0x1b8)},'invoice_product':{'$first':_0x37680f(0x1f2)}}}]),_0x355729=await warehouse[_0x37680f(0x1f6)]([{'$match':{'name':_0x335834,'room':_0x501ca2}},{'$unwind':_0x37680f(0x295)},{'$match':{'product_details.secondary_code':_0x4b504b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x37680f(0x262)},'instock':{'$first':_0x37680f(0x1b6)},'primary_code':{'$first':_0x37680f(0x28f)},'secondary_code':{'$first':_0x37680f(0x234)},'product_code':{'$first':_0x37680f(0x282)},'level':{'$first':_0x37680f(0x1d0)},'isle':{'$first':_0x37680f(0x258)},'type':{'$first':_0x37680f(0x1bf)},'pallet':{'$first':_0x37680f(0x248)},'unit':{'$first':_0x37680f(0x1d3)},'secondary_unit':{'$first':_0x37680f(0x1dc)},'storage':{'$first':_0x37680f(0x290)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x37680f(0x1ed)},'production_date':{'$first':_0x37680f(0x1b9)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x37680f(0x212)},'prod_cat':{'$first':'S'},'roomNamed':{'$first':_0x37680f(0x20a)},'maxProducts':{'$first':'$product_details.maxProducts'},'invoice_product':{'$first':_0x37680f(0x1f2)}}}]);if(_0x4d2b2a['length']>0x0)_0x5c4107[_0x37680f(0x279)](_0x4d2b2a);else _0x355729['length']>0x0&&_0x5c4107[_0x37680f(0x279)](_0x355729);}const _0x8f2196=_0x9ed90c[_0x559b37(0x278)](_0x3ff406=>_0x3393b0(_0x3ff406));await Promise[_0x559b37(0x206)](_0x8f2196),_0x56bd62['json'](_0x5c4107);}),router[a0_0x5d356b(0x274)](a0_0x5d356b(0x202),async(_0x5730ff,_0x3e19e1)=>{var _0x29adf6=a0_0x5d356b;try{const {FromWareHouse:_0x334623,FromRoom:_0x3638df,ToWarehouse:_0xcc3a43,ToRoom:_0x30879a,secondary_code:_0x260239}=_0x5730ff[_0x29adf6(0x207)],_0x5cf85e=await warehouse[_0x29adf6(0x1f6)]([{'$match':{'name':_0x334623}},{'$unwind':_0x29adf6(0x295)},{'$match':{'product_details.secondary_code':_0x260239}},{'$group':{'_id':_0x29adf6(0x294),'name':{'$first':_0x29adf6(0x262)},'primary_code':{'$first':_0x29adf6(0x28f)},'secondary_code':{'$first':_0x29adf6(0x234)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':_0x29adf6(0x286)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x29adf6(0x24f)},'maxProducts':{'$first':_0x29adf6(0x1b8)},'unit':{'$first':_0x29adf6(0x1d3)}}}]);_0x3e19e1[_0x29adf6(0x1d2)](0xc8)[_0x29adf6(0x251)](_0x5cf85e);}catch(_0x1e01bf){_0x3e19e1[_0x29adf6(0x1d2)](0x194)[_0x29adf6(0x251)]({'message':_0x1e01bf['message']});}}),router[a0_0x5d356b(0x274)](a0_0x5d356b(0x1c6),async(_0x14397c,_0x1aa514)=>{var _0x308a6f=a0_0x5d356b;try{const {FromWareHouse:_0x145774,FromRoom:_0x42f831,ToWarehouse:_0x104178,ToRoom:_0x1190d3,product_code:_0x2f2705}=_0x14397c['body'],_0x4da2a4=await warehouse[_0x308a6f(0x1f6)]([{'$match':{'name':_0x145774}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x2f2705}},{'$group':{'_id':_0x308a6f(0x294),'name':{'$first':_0x308a6f(0x262)},'primary_code':{'$first':_0x308a6f(0x28f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x308a6f(0x282)},'instock':{'$first':_0x308a6f(0x1b6)},'warehouse':{'$first':_0x308a6f(0x1e7)},'level':{'$first':_0x308a6f(0x286)},'isle':{'$first':_0x308a6f(0x29b)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':'$product_details.unit'}}}]);_0x1aa514['status'](0xc8)['json'](_0x4da2a4);}catch(_0x576292){_0x1aa514[_0x308a6f(0x1d2)](0x194)[_0x308a6f(0x251)]({'message':_0x576292[_0x308a6f(0x220)]});}}),router['post'](a0_0x5d356b(0x1b4),async(_0x458909,_0x1881bc)=>{var _0x352db4=a0_0x5d356b;const {level:_0x3247a4,isle:_0x172d54,pallet:_0x16144c,warehouses:_0x3bdda6,room:_0x3aeb94}=_0x458909['body'];try{const _0x5394ad=await warehouse['aggregate']([{'$match':{'name':_0x3bdda6,'room':_0x3aeb94}},{'$unwind':_0x352db4(0x295)},{'$match':{'product_details.level':parseInt(_0x3247a4),'product_details.isle':_0x172d54,'product_details.pallet':parseInt(_0x16144c)}},{'$group':{'_id':_0x352db4(0x294),'name':{'$first':_0x352db4(0x262)},'product_stock':{'$first':_0x352db4(0x1b6)},'level':{'$first':_0x352db4(0x286)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x352db4(0x24f)},'maxProducts':{'$first':_0x352db4(0x1b8)}}}]);_0x1881bc['status'](0xc8)[_0x352db4(0x251)](_0x5394ad);}catch(_0x4e90d1){_0x1881bc[_0x352db4(0x1d2)](0x194)[_0x352db4(0x251)]({'message':_0x4e90d1['message']});}}),module[a0_0x5d356b(0x24d)]=router;