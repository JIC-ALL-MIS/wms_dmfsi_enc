var a0_0x2f3a02=a0_0x5985;(function(_0x2621cb,_0x2d34dd){var _0x47ab36=a0_0x5985,_0x78b680=_0x2621cb();while(!![]){try{var _0x130ecc=parseInt(_0x47ab36(0xa5))/0x1+parseInt(_0x47ab36(0x136))/0x2+-parseInt(_0x47ab36(0x15b))/0x3*(parseInt(_0x47ab36(0x152))/0x4)+parseInt(_0x47ab36(0xd2))/0x5+-parseInt(_0x47ab36(0xd5))/0x6*(-parseInt(_0x47ab36(0x11c))/0x7)+-parseInt(_0x47ab36(0xa6))/0x8*(-parseInt(_0x47ab36(0xfe))/0x9)+-parseInt(_0x47ab36(0xbc))/0xa;if(_0x130ecc===_0x2d34dd)break;else _0x78b680['push'](_0x78b680['shift']());}catch(_0x383f5c){_0x78b680['push'](_0x78b680['shift']());}}}(a0_0x3966,0xd1389));const express=require(a0_0x2f3a02(0x9d)),app=express(),router=express[a0_0x2f3a02(0xac)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,email_settings,supervisor_settings}=require(a0_0x2f3a02(0x137)),auth=require(a0_0x2f3a02(0x132)),users=require(a0_0x2f3a02(0x14c)),nodemailer=require('nodemailer');function a0_0x5985(_0xffb2c1,_0x58b490){var _0x39664b=a0_0x3966();return a0_0x5985=function(_0x598519,_0x419721){_0x598519=_0x598519-0x70;var _0xfc3804=_0x39664b[_0x598519];return _0xfc3804;},a0_0x5985(_0xffb2c1,_0x58b490);}router['get']('/view',auth,async(_0x58c536,_0x4f3e8e)=>{var _0x724243=a0_0x2f3a02;try{const {username:_0x37feef,email:_0xdf2a3a,role:_0x44e688}=_0x58c536['user'],_0x3ca4e2=_0x58c536['user'],_0x474009=await profile['findOne']({'email':_0x3ca4e2['email']}),_0x2e89d5=await master_shop['find']();console[_0x724243(0x99)](_0x724243(0xcc),_0x2e89d5);let _0x5983d8;if(_0x3ca4e2['role']==_0x724243(0x113)){const _0x437c69=await staff[_0x724243(0xa2)]({'email':_0x3ca4e2[_0x724243(0xa1)]});_0x5983d8=await transfers[_0x724243(0x123)]({'from_warehouse':_0x437c69['warehouse']});}else _0x5983d8=await transfers[_0x724243(0x143)]([{'$unwind':_0x724243(0xea)},{'$group':{'_id':_0x724243(0xee),'invoice':{'$first':_0x724243(0x106)},'date':{'$first':_0x724243(0x12e)},'from_warehouse':{'$first':_0x724243(0x14b)},'to_warehouse':{'$first':_0x724243(0x87)},'from_room_name':{'$addToSet':_0x724243(0x11d)},'to_room_name':{'$addToSet':_0x724243(0xf6)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0x724243(0xfa)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x2e89d5[0x0][_0x724243(0x150)]=='English\x20(US)'){var _0x111952=users[_0x724243(0xcf)];console[_0x724243(0x99)](_0x111952);}else{if(_0x2e89d5[0x0][_0x724243(0x150)]==_0x724243(0x144))var _0x111952=users[_0x724243(0x144)];else{if(_0x2e89d5[0x0][_0x724243(0x150)]==_0x724243(0x15c))var _0x111952=users['German'];else{if(_0x2e89d5[0x0][_0x724243(0x150)]=='Spanish')var _0x111952=users[_0x724243(0x74)];else{if(_0x2e89d5[0x0]['language']==_0x724243(0xa4))var _0x111952=users[_0x724243(0xa4)];else{if(_0x2e89d5[0x0][_0x724243(0x150)]==_0x724243(0xb5))var _0x111952=users['Portuguese'];else{if(_0x2e89d5[0x0][_0x724243(0x150)]==_0x724243(0xf9))var _0x111952=users[_0x724243(0xf9)];else{if(_0x2e89d5[0x0]['language']=='Arabic\x20(ae)')var _0x111952=users[_0x724243(0xb9)];}}}}}}}_0x4f3e8e[_0x724243(0xe5)](_0x724243(0xb2),{'success':_0x58c536[_0x724243(0x8a)](_0x724243(0x11b)),'errors':_0x58c536[_0x724243(0x8a)](_0x724243(0x135)),'role':_0x3ca4e2,'profile':_0x474009,'master_shop':_0x2e89d5,'transfer':_0x5983d8,'language':_0x111952});}catch(_0x192368){console[_0x724243(0x99)](_0x192368);}});async function getRandom8DigitNumber(){var _0x1e3542=a0_0x2f3a02;const _0x413d08=0x989680,_0x4f83ea=0x5f5e0ff,_0x54e7c4=Math['floor'](Math['random']()*(_0x4f83ea-_0x413d08+0x1))+_0x413d08;var _0x40740e;const _0x420c49=await transfers[_0x1e3542(0xa2)]({'invoice':_0x1e3542(0xd1)+_0x54e7c4});return _0x420c49&&_0x420c49[_0x1e3542(0xb1)]>0x0?_0x40740e=_0x1e3542(0xd1)+_0x54e7c4:_0x40740e=_0x1e3542(0xd1)+_0x54e7c4,_0x40740e;}function a0_0x3966(){var _0x270a56=['$room','$product_details.isle','$product.to_room_name','filter','$product_details.unit','Chinese','$isAllowEdit','$product_details.rack','$product_details.product_stock','to_types','23103NIDqAq','string','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_name','$product_details.batch_code','status','MaxStocks_data2','port','$invoice','Logo.png','findById','$product_details.floorlevel','/picking_list/PDF_transfer_rm/','to_prod_pallet','Rack\x20F','Email\x20sent\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','from_prod_pallet','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','date','staff','Rack\x20D','from_bin','product','Transfer\x20Finalize\x20Successfully','<hr\x20class=\x22my-3\x22>','Enclosed','_id','success','9634814cPCDAo','$product.from_room_name','json','product_name','expiry_date','logo','$product_details.storage','find','redirect','$product_details.bin','$product_details.secondary_code','to_floorlevel','to_room_name','/view/add_transfer','/preview/:id','/transfer/view','English\x20(US)','Product\x20Transfer\x20successfully','$date','maxProducts','from_types','Arabic\x20(ae)','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','to_warehouse','errors','2421252QedaMV','../models/all_models','invoice','from_invoice','True','</tbody>','/upload/','secondary_unit','To_invoice','getDate','<html><head><title></title>','Portuguese','image','aggregate','Hindi','/CheckingWarehouse','storage','Transfer\x20Edit\x20Successfully','</thead>','post','product_details','$from_warehouse','../public/language/languages.json','Error\x20Occurs','to_invoice','to_bin','language','Return\x20Rooms','28HXfFKi','toString','<h5\x20style=\x22text-align:\x20left;\x22>','from_storage','password','$product_details._id','Ambient','back','$product_details.bay','506679YLVLgQ','German','secondary_code','<!DOCTYPE\x20html>','</h5>','$product_details.type','Rack\x20B','from_rack','</td>','<h5>','An\x20error\x20occurred.','finalize','Spanish','product_code','rack','$product_details','bin','New_Qty_Converted','to_room','from_quantity','updateOne','prod_cat','save','from_room_name','Raw\x20Materials','from_warehouse','Level','from_room','$product_details.secondary_unit','\x20Order\x20Date\x20:\x20','unit','$to_warehouse','user','from_prod_qty','flash','$product_details.maxPerUnit','batch_code','body','all','</div>','RMSEmail','Rack\x20C','error','from_rak','<h2>\x20','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.product_name','$product_details.expiry_date','$product_details.level','log','primary_code','\x20Order\x20Number\x20:\x20','site_title','express','slice','Rack\x20A','<span\x20style=\x22float:\x20right;\x22>','email','findOne','map','French','1706142weywhg','4192nLJOAg','split','exports','An\x20error\x20occurred\x20while\x20saving\x20data.','/../public','add_transfer','Router','padStart','<tr>','host','$product_details.product_code','length','transfer','bay','sendMail','Portuguese\x20(BR)','to_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','role','Arabic','/barcode_scanner2','\x20</h2>','36028120qZOxsV','ToRoomAssigned','</head><body>','type','Receiving\x20Area','primary_unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','to_prod_level','Floor','rak','$product_details.primary_code','RoomAssigned','from_bay','$product_details.production_date','params','from_prod_level','master','concat','getFullYear','English','/view/:id','TRF-','18770iZHNtl','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','6NpQQbI','<strong>\x20Regards\x20</strong>','<div>','$product_details.pallet','product_code3','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','production_date','from_floorlevel','then','get','edit_transfer_view','getMonth','to_bay','to_prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Rack\x20E','render','warehouse','$product_details.maxProducts','floorlevel','Enabled','$product','$name','product_stock','to_prod_isle','$_id','message','forEach','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','from_prod_isle','</body></html>'];a0_0x3966=function(){return _0x270a56;};return a0_0x3966();}router[a0_0x2f3a02(0xde)](a0_0x2f3a02(0x129),auth,async(_0x53afc6,_0x3ae17b)=>{var _0x1e8db9=a0_0x2f3a02;try{const {username:_0x19910f,email:_0x158764,role:_0x552810}=_0x53afc6[_0x1e8db9(0x88)],_0x12fd51=_0x53afc6[_0x1e8db9(0x88)],_0x5a5666=await profile[_0x1e8db9(0xa2)]({'email':_0x12fd51['email']}),_0x442869=await master_shop[_0x1e8db9(0x123)]();console[_0x1e8db9(0x99)](_0x1e8db9(0xcc),_0x442869);let _0x2b5ab4;if(_0x12fd51['role']==_0x1e8db9(0x113)){const _0x593212=await staff[_0x1e8db9(0xa2)]({'email':_0x12fd51[_0x1e8db9(0xa1)]});_0x2b5ab4=await warehouse[_0x1e8db9(0x143)]([{'$match':{'status':_0x1e8db9(0xe9),'name':_0x593212[_0x1e8db9(0xe6)],'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x1e8db9(0xeb)}}}]);}else _0x2b5ab4=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x1e8db9(0x80)}},{'$group':{'_id':_0x1e8db9(0xeb),'name':{'$first':'$name'}}}]);var _0x4aaeee=[_0x1e8db9(0x158),_0x1e8db9(0x119),_0x1e8db9(0x151)];const _0x44922c=await transfers[_0x1e8db9(0x123)]({}),_0xd6cd19=_0x44922c[_0x1e8db9(0xb1)]+0x1,_0x33053c=_0x1e8db9(0xd1)+_0xd6cd19[_0x1e8db9(0x153)]()[_0x1e8db9(0xad)](0x5,'0');if(_0x442869[0x0][_0x1e8db9(0x150)]==_0x1e8db9(0x12c)){var _0x2e28ad=users[_0x1e8db9(0xcf)];console[_0x1e8db9(0x99)](_0x2e28ad);}else{if(_0x442869[0x0]['language']==_0x1e8db9(0x144))var _0x2e28ad=users[_0x1e8db9(0x144)];else{if(_0x442869[0x0]['language']==_0x1e8db9(0x15c))var _0x2e28ad=users[_0x1e8db9(0x15c)];else{if(_0x442869[0x0][_0x1e8db9(0x150)]==_0x1e8db9(0x74))var _0x2e28ad=users[_0x1e8db9(0x74)];else{if(_0x442869[0x0][_0x1e8db9(0x150)]==_0x1e8db9(0xa4))var _0x2e28ad=users[_0x1e8db9(0xa4)];else{if(_0x442869[0x0][_0x1e8db9(0x150)]=='Portuguese\x20(BR)')var _0x2e28ad=users['Portuguese'];else{if(_0x442869[0x0][_0x1e8db9(0x150)]==_0x1e8db9(0xf9))var _0x2e28ad=users[_0x1e8db9(0xf9)];else{if(_0x442869[0x0][_0x1e8db9(0x150)]==_0x1e8db9(0x131))var _0x2e28ad=users[_0x1e8db9(0xb9)];}}}}}}}const _0x531736=getRandom8DigitNumber();_0x531736[_0x1e8db9(0xdd)](_0x12ff4c=>{var _0x5ac8e1=_0x1e8db9;_0x3ae17b['render'](_0x5ac8e1(0xab),{'success':_0x53afc6[_0x5ac8e1(0x8a)](_0x5ac8e1(0x11b)),'errors':_0x53afc6[_0x5ac8e1(0x8a)](_0x5ac8e1(0x135)),'role':_0x12fd51,'profile':_0x5a5666,'master_shop':_0x442869,'warehouse':_0x2b5ab4,'language':_0x2e28ad,'rooms_data':_0x4aaeee,'invoice':_0x12ff4c});})[_0x1e8db9(0xd3)](_0x2729e1=>{var _0x108c2e=_0x1e8db9;_0x53afc6[_0x108c2e(0x8a)](_0x108c2e(0x135),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3ae17b[_0x108c2e(0x124)](_0x108c2e(0x12b));});}catch(_0xa28f56){console[_0x1e8db9(0x99)](_0xa28f56);}}),router[a0_0x2f3a02(0x149)]('/view/add_transfer',auth,async(_0x2da083,_0x1bc8b3)=>{var _0x4d5f3b=a0_0x2f3a02;try{console[_0x4d5f3b(0x99)](_0x2da083[_0x4d5f3b(0x8d)]);const {date:_0x5b52c3,from_warehouse:_0x54a344,FromRoom_name:_0x11d758,to_warehouse:_0xb93fd8,ToRoom_name:_0x1060b8,prod_name:_0x177fac,from_prod_qty:_0x50c52f,from_prod_level:_0xec2b3c,from_prod_isle:_0x476618,from_prod_pallet:_0x824991,to_prod_qty:_0x4c5965,to_prod_level:_0x4d2bfa,to_prod_isle:_0x15ca42,to_prod_pallet:_0x35bbdb,primary_code:_0x2c1610,secondary_code:_0x5c088a,product_code3:_0x52a456,note:_0x3e185e,MaxStocks_data2:_0x242b83,invoice:_0x45a0c4,expiry_date:_0x4369c7}=_0x2da083[_0x4d5f3b(0x8d)];if(typeof _0x177fac==_0x4d5f3b(0xff))var _0x30e559=[_0x2da083[_0x4d5f3b(0x8d)]['prod_name']],_0xbc02a6=[_0x2da083['body']['from_prod_qty']],_0x16e22b=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xcb)]],_0x2f453e=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x79)]],_0x122cb4=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xc3)]],_0x1d3e48=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x9a)]],_0x4a8ef6=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x15d)]],_0x223718=[_0x2da083['body'][_0x4d5f3b(0xd9)]],_0x494f46=[_0x2da083[_0x4d5f3b(0x8d)]['MaxStocks_data2']],_0x2ba1e4=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xc1)]],_0x4b7e17=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x13d)]],_0x43e1a6=[_0x2da083[_0x4d5f3b(0x8d)]['batch_code']],_0x1bcd5d=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x120)]],_0x6176b4=[_0x2da083[_0x4d5f3b(0x8d)]['max_per_unit']],_0xf8250e=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xdb)]],_0x4c3ec0=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x7d)]],_0x5cd141=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xc7)]],_0x181b59=[_0x2da083[_0x4d5f3b(0x8d)]['ToRoomAssigned']],_0x4d3a0a=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x139)]],_0x550c64=[_0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x14e)]];else var _0x30e559=[..._0x2da083['body'][_0x4d5f3b(0x101)]],_0xbc02a6=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x89)]],_0x16e22b=[..._0x2da083[_0x4d5f3b(0x8d)]['from_prod_level']],_0x2f453e=[..._0x2da083[_0x4d5f3b(0x8d)]['New_Qty_Converted']],_0x122cb4=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xc3)]],_0x1d3e48=[..._0x2da083['body']['primary_code']],_0x4a8ef6=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x15d)]],_0x223718=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xd9)]],_0x494f46=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x104)]],_0x2ba1e4=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xc1)]],_0x4b7e17=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x13d)]],_0x43e1a6=[..._0x2da083[_0x4d5f3b(0x8d)]['batch_code']],_0x1bcd5d=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x120)]],_0x6176b4=[..._0x2da083[_0x4d5f3b(0x8d)]['max_per_unit']],_0xf8250e=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xdb)]],_0x4c3ec0=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0x7d)]],_0x5cd141=[..._0x2da083[_0x4d5f3b(0x8d)][_0x4d5f3b(0xc7)]],_0x181b59=[..._0x2da083['body'][_0x4d5f3b(0xbd)]],_0x4d3a0a=[..._0x2da083['body'][_0x4d5f3b(0x139)]],_0x550c64=[..._0x2da083['body'][_0x4d5f3b(0x14e)]];const _0xd9c342=_0x30e559['map'](_0x448782=>{return _0x448782={'product_name':_0x448782};});_0xbc02a6[_0x4d5f3b(0xf0)]((_0x2eee13,_0xc90f2b)=>{var _0x4e0f62=_0x4d5f3b;_0xd9c342[_0xc90f2b][_0x4e0f62(0x7b)]=_0x2eee13;}),_0x4d3a0a['forEach']((_0x49f3cc,_0x5968c3)=>{_0xd9c342[_0x5968c3]['from_invoice']=_0x49f3cc;}),_0x550c64['forEach']((_0x3615ab,_0x5d151f)=>{var _0x1661e5=_0x4d5f3b;_0xd9c342[_0x5d151f][_0x1661e5(0x13e)]=_0x3615ab;}),_0x16e22b['forEach']((_0xe044f4,_0x45d1e0)=>{var _0x586a43=_0x4d5f3b;_0x5cd141[_0x586a43(0xf0)]((_0x3ca85b,_0x477662)=>{var _0x43e41a=_0x586a43;if(_0x3ca85b==_0x43e41a(0xc0)&&_0x45d1e0==_0x477662){var _0x4187e0=_0xe044f4[_0x43e41a(0x9e)](0x3);_0xd9c342[_0x45d1e0][_0x43e41a(0x155)]=_0xe044f4[0x0],_0xd9c342[_0x45d1e0]['from_rack']=_0xe044f4[0x1],_0xd9c342[_0x45d1e0][_0x43e41a(0xc8)]=0x0,_0xd9c342[_0x45d1e0][_0x43e41a(0x115)]=0x0,_0xd9c342[_0x45d1e0]['from_types']=_0x43e41a(0xc4),_0xd9c342[_0x45d1e0][_0x43e41a(0xdc)]=_0x4187e0;}else{if(_0x3ca85b==_0x43e41a(0x110)&&_0x45d1e0==_0x477662){var _0x4187e0=_0xe044f4[_0x43e41a(0x9e)](0x3);_0xd9c342[_0x45d1e0][_0x43e41a(0x155)]=_0xe044f4[0x0],_0xd9c342[_0x45d1e0][_0x43e41a(0x162)]=_0xe044f4[0x1],_0xd9c342[_0x45d1e0][_0x43e41a(0xc8)]=0x0,_0xd9c342[_0x45d1e0][_0x43e41a(0x115)]=0x0,_0xd9c342[_0x45d1e0][_0x43e41a(0x130)]=_0x43e41a(0xc4),_0xd9c342[_0x45d1e0][_0x43e41a(0xdc)]=_0xe044f4[0x5];}else{if(_0x45d1e0==_0x477662){var _0x4aec94;if(_0xe044f4[0x4]=='L')_0x4aec94=_0x43e41a(0x82);else _0xe044f4[0x4]=='F'&&(_0x4aec94=_0x43e41a(0xc4));_0xd9c342[_0x45d1e0][_0x43e41a(0x155)]=_0xe044f4[0x0],_0xd9c342[_0x45d1e0][_0x43e41a(0x162)]=_0xe044f4[0x1],_0xd9c342[_0x45d1e0]['from_bay']=_0xe044f4[0x2],_0xd9c342[_0x45d1e0][_0x43e41a(0x115)]=_0xe044f4[0x3],_0xd9c342[_0x45d1e0][_0x43e41a(0x130)]=_0x4aec94,_0xd9c342[_0x45d1e0][_0x43e41a(0xdc)]=_0xe044f4[0x5];}}}});}),_0x2f453e[_0x4d5f3b(0xf0)]((_0x257eb7,_0x10806b)=>{_0xd9c342[_0x10806b]['to_quantity']=_0x257eb7;}),_0x122cb4[_0x4d5f3b(0xf0)]((_0x733ed1,_0x3718e6)=>{_0x181b59['forEach']((_0x4f0217,_0x239b53)=>{var _0x5055a5=a0_0x5985;if(_0x4f0217==_0x5055a5(0xc0)&&_0x3718e6==_0x239b53){var _0x36cc36=_0x733ed1['slice'](0x3);_0xd9c342[_0x3718e6][_0x5055a5(0x146)]=_0x733ed1[0x0],_0xd9c342[_0x3718e6][_0x5055a5(0x76)]=_0x733ed1[0x1],_0xd9c342[_0x3718e6][_0x5055a5(0xe1)]=0x0,_0xd9c342[_0x3718e6][_0x5055a5(0x14f)]=0x0,_0xd9c342[_0x3718e6][_0x5055a5(0xfd)]='Floor',_0xd9c342[_0x3718e6]['to_floorlevel']=_0x36cc36;}else{if(_0x4f0217=='Shelves'&&_0x3718e6==_0x239b53){var _0x36cc36=_0x733ed1[_0x5055a5(0x9e)](0x3);_0xd9c342[_0x3718e6][_0x5055a5(0x146)]=_0x733ed1[0x0],_0xd9c342[_0x3718e6][_0x5055a5(0x76)]=_0x733ed1[0x1],_0xd9c342[_0x3718e6][_0x5055a5(0xe1)]=0x0,_0xd9c342[_0x3718e6]['to_bin']=0x0,_0xd9c342[_0x3718e6][_0x5055a5(0xfd)]=_0x5055a5(0xc4),_0xd9c342[_0x3718e6][_0x5055a5(0x127)]=_0x733ed1[0x5];}else{if(_0x3718e6==_0x239b53){var _0xa49531;if(_0x733ed1[0x4]=='L')_0xa49531=_0x5055a5(0x82);else _0x733ed1[0x4]=='F'&&(_0xa49531='Floor');_0xd9c342[_0x3718e6][_0x5055a5(0x146)]=_0x733ed1[0x0],_0xd9c342[_0x3718e6][_0x5055a5(0x76)]=_0x733ed1[0x1],_0xd9c342[_0x3718e6]['to_bay']=_0x733ed1[0x2],_0xd9c342[_0x3718e6][_0x5055a5(0x14f)]=_0x733ed1[0x3],_0xd9c342[_0x3718e6][_0x5055a5(0xfd)]=_0xa49531,_0xd9c342[_0x3718e6]['to_floorlevel']=_0x733ed1[0x5];}}}});}),_0x1d3e48[_0x4d5f3b(0xf0)]((_0x4e755d,_0xb86bbe)=>{_0xd9c342[_0xb86bbe]['primary_code']=_0x4e755d;}),_0x4a8ef6[_0x4d5f3b(0xf0)]((_0x12ed28,_0x3de7de)=>{var _0x836c0b=_0x4d5f3b;_0xd9c342[_0x3de7de][_0x836c0b(0x15d)]=_0x12ed28;}),_0x223718[_0x4d5f3b(0xf0)]((_0x467387,_0x1eb497)=>{var _0x47bd08=_0x4d5f3b;_0xd9c342[_0x1eb497][_0x47bd08(0x75)]=_0x467387;}),_0x494f46[_0x4d5f3b(0xf0)]((_0x2fef7a,_0x185c12)=>{_0xd9c342[_0x185c12]['maxProducts']=_0x2fef7a;}),_0x2ba1e4[_0x4d5f3b(0xf0)]((_0x3fc362,_0xf7c891)=>{var _0xddb239=_0x4d5f3b;_0xd9c342[_0xf7c891][_0xddb239(0x86)]=_0x3fc362;}),_0x4b7e17[_0x4d5f3b(0xf0)]((_0x38369e,_0x2db749)=>{var _0xa873dc=_0x4d5f3b;_0xd9c342[_0x2db749][_0xa873dc(0x13d)]=_0x38369e;}),_0x43e1a6[_0x4d5f3b(0xf0)]((_0x24f3ee,_0x3c80a8)=>{var _0x5c8551=_0x4d5f3b;_0xd9c342[_0x3c80a8][_0x5c8551(0x8c)]=_0x24f3ee;}),_0x1bcd5d[_0x4d5f3b(0xf0)]((_0x5a182e,_0x404912)=>{var _0x71ec2c=_0x4d5f3b;_0xd9c342[_0x404912][_0x71ec2c(0x120)]=_0x5a182e;}),_0x6176b4[_0x4d5f3b(0xf0)]((_0x5c5d83,_0x235978)=>{_0xd9c342[_0x235978]['maxperunit']=_0x5c5d83;}),_0xf8250e['forEach']((_0x38f523,_0x15e2ff)=>{var _0x2d6c29=_0x4d5f3b;_0xd9c342[_0x15e2ff][_0x2d6c29(0xdb)]=_0x38f523;}),_0x4c3ec0[_0x4d5f3b(0xf0)]((_0xef236b,_0x51566a)=>{var _0x47460f=_0x4d5f3b;_0xd9c342[_0x51566a][_0x47460f(0x7d)]=_0xef236b;}),_0x5cd141['forEach']((_0x482a55,_0x223fa8)=>{var _0x393b1a=_0x4d5f3b;_0xd9c342[_0x223fa8][_0x393b1a(0x7f)]=_0x482a55;}),_0x181b59[_0x4d5f3b(0xf0)]((_0x2dcff1,_0x29c0e5)=>{var _0x3ef8c4=_0x4d5f3b;_0xd9c342[_0x29c0e5][_0x3ef8c4(0x128)]=_0x2dcff1;});const _0x4e0613=_0xd9c342[_0x4d5f3b(0xf7)](_0xd5b841=>_0xd5b841['to_quantity']!=='0'&&_0xd5b841[_0x4d5f3b(0xb6)]!==''||_0xd5b841[_0x4d5f3b(0x127)]!=='0'&&_0xd5b841[_0x4d5f3b(0x127)]!==''),_0x324ff0=new transfers({'date':_0x5b52c3,'from_warehouse':_0x54a344,'to_warehouse':_0xb93fd8,'product':_0x4e0613,'note':_0x3e185e,'invoice':_0x45a0c4}),_0x2ec83e=await _0x324ff0[_0x4d5f3b(0x7e)]();_0x2da083[_0x4d5f3b(0x8a)](_0x4d5f3b(0x11b),_0x4d5f3b(0x12d)),_0x1bc8b3[_0x4d5f3b(0x124)]('/transfer/preview/'+_0x2ec83e[_0x4d5f3b(0x11a)]);}catch(_0x5d4de7){console['log'](_0x5d4de7),_0x1bc8b3[_0x4d5f3b(0x103)](0xc8)[_0x4d5f3b(0x11e)]({'errorMessage':_0x5d4de7[_0x4d5f3b(0xef)]});}}),router[a0_0x2f3a02(0xde)](a0_0x2f3a02(0x12a),auth,async(_0x1cbab3,_0x2a508e)=>{var _0x486006=a0_0x2f3a02;try{const {username:_0x365188,email:_0x20b9ec,role:_0x1d7ea3}=_0x1cbab3[_0x486006(0x88)],_0x50aac7=_0x1cbab3['user'],_0x4a09d2=await profile[_0x486006(0xa2)]({'email':_0x50aac7['email']}),_0x4bb3d0=await master_shop[_0x486006(0x123)]();console[_0x486006(0x99)](_0x486006(0xcc),_0x4bb3d0);const _0x13b2bb=await transfers[_0x486006(0x108)](_0x1cbab3['params']['id']);let _0x4475d1=new Date(_0x13b2bb[_0x486006(0x120)]),_0xdca897=('0'+_0x4475d1[_0x486006(0x13f)]())['slice'](-0x2),_0x10cfe5=('0'+(_0x4475d1[_0x486006(0xe0)]()+0x1))['slice'](-0x2),_0x34aea3=_0x4475d1[_0x486006(0xce)](),_0x222fab=_0x34aea3+'-'+_0x10cfe5+'-'+_0xdca897,_0x37f0df;if(_0x50aac7[_0x486006(0xb8)]=='staff'){const _0x3646f8=await staff[_0x486006(0xa2)]({'email':_0x50aac7[_0x486006(0xa1)]});_0x37f0df=await warehouse[_0x486006(0x123)]({'status':_0x486006(0xe9),'name':_0x3646f8[_0x486006(0xe6)],'warehouse_category':_0x486006(0x80)});}else _0x37f0df=await warehouse[_0x486006(0x123)]({'status':'Enabled','warehouse_category':_0x486006(0x80)});const _0x7ce788=await warehouse[_0x486006(0x143)]([{'$match':{'name':_0x13b2bb[_0x486006(0x81)]}},{'$unwind':_0x486006(0x77)},{'$group':{'_id':_0x486006(0x157),'name':{'$first':_0x486006(0x96)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x486006(0x15a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x486006(0x109)},'primary_code':{'$first':_0x486006(0xc6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x486006(0xb0)},'storage':{'$first':_0x486006(0x122)},'rack':{'$first':_0x486006(0xfb)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x486006(0xc9)},'room':{'$first':_0x486006(0xf4)}}}]);if(_0x4bb3d0[0x0][_0x486006(0x150)]==_0x486006(0x12c)){var _0x4882b1=users[_0x486006(0xcf)];console['log'](_0x4882b1);}else{if(_0x4bb3d0[0x0][_0x486006(0x150)]==_0x486006(0x144))var _0x4882b1=users[_0x486006(0x144)];else{if(_0x4bb3d0[0x0][_0x486006(0x150)]==_0x486006(0x15c))var _0x4882b1=users[_0x486006(0x15c)];else{if(_0x4bb3d0[0x0][_0x486006(0x150)]=='Spanish')var _0x4882b1=users[_0x486006(0x74)];else{if(_0x4bb3d0[0x0][_0x486006(0x150)]==_0x486006(0xa4))var _0x4882b1=users['French'];else{if(_0x4bb3d0[0x0][_0x486006(0x150)]=='Portuguese\x20(BR)')var _0x4882b1=users['Portuguese'];else{if(_0x4bb3d0[0x0][_0x486006(0x150)]=='Chinese')var _0x4882b1=users[_0x486006(0xf9)];else{if(_0x4bb3d0[0x0]['language']==_0x486006(0x131))var _0x4882b1=users['Arabic'];}}}}}}}_0x2a508e[_0x486006(0xe5)](_0x486006(0xdf),{'success':_0x1cbab3[_0x486006(0x8a)](_0x486006(0x11b)),'errors':_0x1cbab3[_0x486006(0x8a)](_0x486006(0x135)),'role':_0x50aac7,'profile':_0x4a09d2,'master_shop':_0x4bb3d0,'warehouse':_0x37f0df,'transfer':_0x13b2bb,'stock':_0x7ce788,'language':_0x4882b1});}catch(_0x196ce8){console[_0x486006(0x99)](_0x196ce8);}}),router[a0_0x2f3a02(0x149)](a0_0x2f3a02(0x12a),auth,async(_0x5f132b,_0x2eb907)=>{var _0x3bcabd=a0_0x2f3a02;try{const _0x4b3023=_0x5f132b[_0x3bcabd(0xca)]['id'],{from_warehouse:_0x445a60,FromRoom_name:_0x17dcd0,to_warehouse:_0x59b0b6,ToRoom_name:_0x211f52}=_0x5f132b['body'],_0x2aaf5e=await transfers[_0x3bcabd(0x108)]({'_id':_0x4b3023}),_0x3e8a90=_0x2aaf5e[_0x3bcabd(0x116)][_0x3bcabd(0xa3)](async _0x1be58e=>{var _0x11dfb3=_0x3bcabd;if(_0x1be58e[_0x11dfb3(0xb6)]>0x0){var _0x1f6098=await warehouse['findOne']({'name':_0x2aaf5e[_0x11dfb3(0x81)],'room':_0x1be58e['from_room_name'],'warehouse_category':_0x11dfb3(0x80)});const _0xe8c9da=_0x1f6098[_0x11dfb3(0x14a)][_0x11dfb3(0xa3)](_0x5d9bbd=>{var _0x2dfc9c=_0x11dfb3;_0x5d9bbd['product_name']==_0x1be58e[_0x2dfc9c(0x11f)]&&_0x5d9bbd[_0x2dfc9c(0xe8)]==_0x1be58e[_0x2dfc9c(0xdc)]&&_0x5d9bbd[_0x2dfc9c(0xbf)]==_0x1be58e[_0x2dfc9c(0x130)]&&_0x5d9bbd[_0x2dfc9c(0x78)]==_0x1be58e[_0x2dfc9c(0x115)]&&_0x5d9bbd[_0x2dfc9c(0xb3)]==_0x1be58e['from_bay']&&_0x5d9bbd[_0x2dfc9c(0x76)]==_0x1be58e[_0x2dfc9c(0x162)]&&_0x5d9bbd[_0x2dfc9c(0x146)]==_0x1be58e[_0x2dfc9c(0x155)]&&_0x5d9bbd[_0x2dfc9c(0x120)]==_0x1be58e['expiry_date']&&_0x5d9bbd['batch_code']==_0x1be58e['batch_code']&&_0x5d9bbd[_0x2dfc9c(0xdb)]==_0x1be58e['production_date']&&_0x5d9bbd[_0x2dfc9c(0x138)]==_0x1be58e[_0x2dfc9c(0x139)]&&(_0x5d9bbd[_0x2dfc9c(0xec)]=_0x5d9bbd[_0x2dfc9c(0xec)]-_0x1be58e[_0x2dfc9c(0xb6)]);});}return _0x1f6098;});Promise[_0x3bcabd(0x8e)](_0x3e8a90)[_0x3bcabd(0xdd)](async _0x43e141=>{var _0x2acbb0=_0x3bcabd;try{for(const _0x252e91 of _0x43e141){await _0x252e91[_0x2acbb0(0x7e)]();}try{const _0x2c7402=_0x2aaf5e[_0x2acbb0(0x116)][_0x2acbb0(0xa3)](async _0x276a7b=>{var _0x1f5778=_0x2acbb0;if(_0x276a7b[_0x1f5778(0xb6)]>0x0){var _0x54f88c=await warehouse[_0x1f5778(0xa2)]({'name':_0x2aaf5e[_0x1f5778(0x134)],'room':_0x276a7b[_0x1f5778(0x128)],'warehouse_category':_0x1f5778(0x80)}),_0x4ffdba=0x0;const _0x5ecd77=_0x54f88c['product_details'][_0x1f5778(0xa3)](_0x34fe52=>{var _0x237dad=_0x1f5778;_0x34fe52[_0x237dad(0x11f)]==_0x276a7b[_0x237dad(0x11f)]&&_0x34fe52[_0x237dad(0xe8)]==_0x276a7b[_0x237dad(0x127)]&&_0x34fe52[_0x237dad(0xbf)]==_0x276a7b[_0x237dad(0xfd)]&&_0x34fe52[_0x237dad(0x78)]==_0x276a7b[_0x237dad(0x14f)]&&_0x34fe52[_0x237dad(0xb3)]==_0x276a7b['to_bay']&&_0x34fe52[_0x237dad(0x76)]==_0x276a7b['rack']&&_0x34fe52[_0x237dad(0x146)]==_0x276a7b[_0x237dad(0x146)]&&_0x34fe52['expiry_date']==_0x276a7b[_0x237dad(0x120)]&&_0x34fe52[_0x237dad(0x8c)]==_0x276a7b['batch_code']&&_0x34fe52[_0x237dad(0xdb)]==_0x276a7b[_0x237dad(0xdb)]&&_0x34fe52[_0x237dad(0x138)]==_0x276a7b[_0x237dad(0x13e)]&&(_0x34fe52[_0x237dad(0xec)]=_0x34fe52[_0x237dad(0xec)]+_0x276a7b[_0x237dad(0xb6)],_0x4ffdba++);});_0x4ffdba=='0'&&(_0x54f88c[_0x1f5778(0x14a)]=_0x54f88c[_0x1f5778(0x14a)][_0x1f5778(0xcd)]({'product_name':_0x276a7b[_0x1f5778(0x11f)],'product_stock':_0x276a7b[_0x1f5778(0xb6)],'bay':_0x276a7b[_0x1f5778(0xe1)],'bin':_0x276a7b[_0x1f5778(0x14f)],'type':_0x276a7b[_0x1f5778(0xfd)],'floorlevel':_0x276a7b['to_floorlevel'],'storage':_0x276a7b['storage'],'rack':_0x276a7b[_0x1f5778(0x76)],'product_code':_0x276a7b[_0x1f5778(0x75)],'primary_code':_0x276a7b[_0x1f5778(0x9a)],'secondary_code':_0x276a7b[_0x1f5778(0x15d)],'maxProducts':_0x276a7b[_0x1f5778(0x12f)],'storage':_0x276a7b[_0x1f5778(0x146)],'rack':_0x276a7b[_0x1f5778(0x76)],'expiry_date':_0x276a7b[_0x1f5778(0x120)],'maxPerUnit':_0x276a7b['maxperunit'],'batch_code':_0x276a7b[_0x1f5778(0x8c)],'production_date':_0x276a7b[_0x1f5778(0xdb)]}));}return _0x54f88c;});Promise[_0x2acbb0(0x8e)](_0x2c7402)[_0x2acbb0(0xdd)](async _0xc0d289=>{var _0x480ada=_0x2acbb0;try{for(const _0xc3646b of _0xc0d289){await warehouse[_0x480ada(0x7c)]({'_id':_0xc3646b[_0x480ada(0x11a)]},{'$addToSet':{'product_details':{'$each':_0xc3646b['product_details']}}});}_0x2aaf5e[_0x480ada(0x73)]=_0x480ada(0x13a);const _0xc44141=await _0x2aaf5e['save'](),_0x3ec1b3=await master_shop[_0x480ada(0x123)](),_0x44f13e=await email_settings[_0x480ada(0xa2)](),_0x3fcfda=await supervisor_settings['find']();var _0x4ad63e=_0x2aaf5e[_0x480ada(0x116)],_0x2c2b4a='',_0x16e3bd;for(_0x16e3bd in _0x4ad63e){_0x2c2b4a+=_0x480ada(0xae)+_0x480ada(0x100)+_0x4ad63e[_0x16e3bd]['product_name']+_0x480ada(0x70)+_0x480ada(0x100)+_0x4ad63e[_0x16e3bd]['product_code']+_0x480ada(0x70)+_0x480ada(0x100)+_0x4ad63e[_0x16e3bd][_0x480ada(0xb6)]+_0x480ada(0x70)+_0x480ada(0x100)+_0x4ad63e[_0x16e3bd]['unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4ad63e[_0x16e3bd][_0x480ada(0x13d)]+_0x480ada(0x70)+_0x480ada(0x100)+_0x2aaf5e[_0x480ada(0x134)]+_0x480ada(0x70)+_0x480ada(0x100)+_0x4ad63e[_0x16e3bd][_0x480ada(0x128)]+_0x480ada(0x70)+_0x480ada(0x100)+_0x4ad63e[_0x16e3bd][_0x480ada(0x146)]+_0x4ad63e[_0x16e3bd]['rack']+_0x4ad63e[_0x16e3bd]['to_bay']+_0x4ad63e[_0x16e3bd][_0x480ada(0x14f)]+_0x4ad63e[_0x16e3bd][_0x480ada(0xfd)][0x0]+_0x4ad63e[_0x16e3bd][_0x480ada(0x127)]+_0x480ada(0x70),'</tr>';}let _0x4e41cc=nodemailer['createTransport']({'host':_0x44f13e[_0x480ada(0xaf)],'port':Number(_0x44f13e[_0x480ada(0x105)]),'secure':![],'auth':{'user':_0x44f13e[_0x480ada(0xa1)],'pass':_0x44f13e[_0x480ada(0x156)]}}),_0x3a8497={'from':_0x44f13e[_0x480ada(0xa1)],'to':_0x3fcfda[0x0][_0x480ada(0x90)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x480ada(0x107),'path':__dirname+_0x480ada(0xaa)+_0x480ada(0x13c)+_0x3ec1b3[0x0][_0x480ada(0x142)],'cid':_0x480ada(0x121)}],'html':_0x480ada(0x15e)+_0x480ada(0x140)+_0x480ada(0xbe)+'<div>'+_0x480ada(0xda)+_0x480ada(0xd7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x480ada(0x8f)+_0x480ada(0xd7)+_0x480ada(0x94)+_0x3ec1b3[0x0][_0x480ada(0x9c)]+_0x480ada(0xbb)+_0x480ada(0x8f)+_0x480ada(0x8f)+_0x480ada(0x118)+_0x480ada(0xd7)+_0x480ada(0x154)+_0x480ada(0x9b)+_0x2aaf5e[_0x480ada(0x138)]+'\x20'+_0x480ada(0xa0)+_0x480ada(0x85)+_0x2aaf5e[_0x480ada(0x112)]+'\x20'+'</span>'+_0x480ada(0x15f)+_0x480ada(0x8f)+_0x480ada(0xc2)+_0x480ada(0x10e)+'<tr>'+_0x480ada(0xd4)+_0x480ada(0xb7)+_0x480ada(0xe3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x480ada(0x133)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x480ada(0x111)+'</tr>'+_0x480ada(0x148)+_0x480ada(0x95)+'\x20'+_0x2c2b4a+'\x20'+_0x480ada(0x13b)+'</table>'+_0x480ada(0xd7)+_0x480ada(0xd6)+_0x480ada(0x71)+_0x3ec1b3[0x0][_0x480ada(0x9c)]+_0x480ada(0x15f)+_0x480ada(0x8f)+_0x480ada(0x8f)+_0x480ada(0xf3)};_0x4e41cc[_0x480ada(0xb4)](_0x3a8497,function(_0x2007d1,_0x147557){var _0x2b5f5b=_0x480ada;_0x2007d1?(console[_0x2b5f5b(0x99)](_0x2007d1),console[_0x2b5f5b(0x99)](_0x2b5f5b(0x14d))):console['log'](_0x2b5f5b(0x10d));}),_0x5f132b[_0x480ada(0x8a)](_0x480ada(0x11b),_0x480ada(0x117)),_0x2eb907['redirect'](_0x480ada(0x10a)+_0xc44141['_id']);}catch(_0x103798){console[_0x480ada(0x92)](_0x103798),_0x2eb907[_0x480ada(0x103)](0x1f4)[_0x480ada(0x11e)]({'Perror':_0x480ada(0xa9),'message':_0x103798['message']});}})[_0x2acbb0(0xd3)](_0x2333ed=>{var _0x6c824d=_0x2acbb0;console[_0x6c824d(0x92)](_0x2333ed),_0x2eb907['status'](0x1f4)[_0x6c824d(0x11e)]({'Perror':_0x6c824d(0x72)});});}catch(_0x3335fb){_0x2eb907[_0x2acbb0(0x11e)](_0x3335fb);}}catch(_0x7a2f8e){console[_0x2acbb0(0x92)](_0x7a2f8e),_0x2eb907[_0x2acbb0(0x103)](0x1f4)[_0x2acbb0(0x11e)]({'Merror':'An\x20error\x20occurred\x20while\x20saving\x20data.','Message':_0x7a2f8e[_0x2acbb0(0xef)]});}})['catch'](_0x2d511b=>{var _0x1f42a0=_0x3bcabd;console[_0x1f42a0(0x92)](_0x2d511b),_0x2eb907[_0x1f42a0(0x103)](0x1f4)['json']({'Merror':_0x1f42a0(0x72)});});}catch(_0x3b037e){console[_0x3bcabd(0x99)](_0x3b037e);}});function BayBinSelected(_0x2b1164,_0x5c0abb){var _0x4084e1=a0_0x2f3a02,_0x5d7a82=[],_0x2c96fb=[],_0x416558=[],_0x541eea=[],_0x413b1e=[],_0x233fcc=[];let _0x50c84b=[];if(_0x2b1164=='DRY\x20STORAGE')switch(_0x5c0abb){case _0x4084e1(0x9f):_0x5d7a82=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2c96fb=[0x1,0x2],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=[_0x4084e1(0x82),_0x4084e1(0xc4)],_0x413b1e=['D'],_0x233fcc=['A'];break;case _0x4084e1(0x161):_0x5d7a82=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2c96fb=[0x1,0x2],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=[_0x4084e1(0x82),'Floor'],_0x413b1e=['D'],_0x233fcc=['B'];break;case _0x4084e1(0x110):_0x5d7a82=[0x0],_0x2c96fb=[0x0],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=['Floor'],_0x413b1e=['D'],_0x233fcc=['S'];break;case _0x4084e1(0xc0):_0x5d7a82=[0x0],_0x2c96fb=[0x0],_0x541eea=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x416558=[_0x4084e1(0xc4)],_0x413b1e=['D'],_0x233fcc=['R'];break;}else{if(_0x2b1164=='COLD\x20STORAGE')switch(_0x5c0abb){case'Rack\x20A':_0x5d7a82=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2c96fb=['B','F'],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=['Level',_0x4084e1(0xc4)],_0x413b1e=['C'],_0x233fcc=['A'];break;case _0x4084e1(0x161):_0x5d7a82=[0x5,0x4,0x3,0x2,0x1],_0x2c96fb=['F','B','S'],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=['Level',_0x4084e1(0xc4)],_0x413b1e=['C'],_0x233fcc=['B'];break;case _0x4084e1(0x91):_0x5d7a82=[0x1,0x2,0x3,0x4,0x5],_0x2c96fb=['B','F','S'],_0x541eea=[0x5,0x4,0x3,0x2,0x1],_0x416558=[_0x4084e1(0x82),_0x4084e1(0xc4)],_0x413b1e=['C'],_0x233fcc=['C'];break;case _0x4084e1(0x114):_0x5d7a82=[0x5,0x4,0x3,0x2,0x1],_0x2c96fb=['F','B','S'],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=[_0x4084e1(0x82),_0x4084e1(0xc4)],_0x413b1e=['C'],_0x233fcc=['D'];break;case _0x4084e1(0xe4):_0x5d7a82=[0x4,0x3,0x2,0x1],_0x2c96fb=[0x1,0x2],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=[_0x4084e1(0x82),_0x4084e1(0xc4)],_0x413b1e=['C'],_0x233fcc=['E'];break;case _0x4084e1(0x10c):_0x5d7a82=[0x1,0x2,0x3],_0x2c96fb=[0x1,0x2],_0x541eea=[0x1,0x2,0x3,0x4,0x5],_0x416558=['Level'],_0x413b1e=['C'],_0x233fcc=['F'];break;}}return{'levels':_0x5d7a82,'Isle':_0x2c96fb,'rack':_0x541eea,'type':_0x416558,'storage':_0x413b1e,'rak':_0x233fcc};}router[a0_0x2f3a02(0xde)](a0_0x2f3a02(0xd0),auth,async(_0x915282,_0x1bb8bb)=>{var _0xf64fbb=a0_0x2f3a02;try{const {username:_0x2f9d23,email:_0x55498f,role:_0x5ad1f0}=_0x915282[_0xf64fbb(0x88)],_0x5578b6=_0x915282[_0xf64fbb(0x88)],_0x297ec5=await profile[_0xf64fbb(0xa2)]({'email':_0x5578b6['email']}),_0x1d3b86=await master_shop['find'](),_0x24b4d7=await transfers[_0xf64fbb(0x108)](_0x915282[_0xf64fbb(0xca)]['id']);let _0x3b081c;if(_0x5578b6['role']==_0xf64fbb(0x113)){const _0x38fd53=await staff[_0xf64fbb(0xa2)]({'email':_0x5578b6[_0xf64fbb(0xa1)]});_0x3b081c=await warehouse['aggregate']([{'$match':{'status':_0xf64fbb(0xe9),'name':_0x38fd53[_0xf64fbb(0xe6)],'warehouse_category':_0xf64fbb(0x80)}},{'$group':{'_id':_0xf64fbb(0xeb),'name':{'$first':_0xf64fbb(0xeb)}}}]);}else _0x3b081c=await warehouse[_0xf64fbb(0x143)]([{'$match':{'status':_0xf64fbb(0xe9),'warehouse_category':_0xf64fbb(0x80)}},{'$group':{'_id':_0xf64fbb(0xeb),'name':{'$first':'$name'}}}]);const _0x1e1f8e=await warehouse[_0xf64fbb(0x143)]([{'$match':{'name':_0x24b4d7['from_warehouse'],'warehouse_category':_0xf64fbb(0x80)}},{'$unwind':_0xf64fbb(0x77)},{'$group':{'_id':_0xf64fbb(0x157),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xf64fbb(0xfc)},'bay':{'$first':_0xf64fbb(0x15a)},'bin':{'$first':_0xf64fbb(0x125)},'type':{'$first':_0xf64fbb(0x160)},'floorlevel':{'$first':_0xf64fbb(0x109)},'primary_code':{'$first':_0xf64fbb(0xc6)},'secondary_code':{'$first':_0xf64fbb(0x126)},'product_code':{'$first':_0xf64fbb(0xb0)},'storage':{'$first':_0xf64fbb(0x122)},'rack':{'$first':_0xf64fbb(0xfb)},'expiry_date':{'$first':_0xf64fbb(0x97)},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':'$room'}}}]),_0x5cba1a=await product['find']({}),_0x1affb4=BayBinSelected(_0x24b4d7[_0xf64fbb(0x134)],_0x24b4d7[_0xf64fbb(0x7a)]);if(_0x1d3b86[0x0][_0xf64fbb(0x150)]==_0xf64fbb(0x12c)){var _0x3236cc=users['English'];console['log'](_0x3236cc);}else{if(_0x1d3b86[0x0][_0xf64fbb(0x150)]==_0xf64fbb(0x144))var _0x3236cc=users['Hindi'];else{if(_0x1d3b86[0x0][_0xf64fbb(0x150)]==_0xf64fbb(0x15c))var _0x3236cc=users[_0xf64fbb(0x15c)];else{if(_0x1d3b86[0x0][_0xf64fbb(0x150)]=='Spanish')var _0x3236cc=users['Spanish'];else{if(_0x1d3b86[0x0]['language']==_0xf64fbb(0xa4))var _0x3236cc=users['French'];else{if(_0x1d3b86[0x0][_0xf64fbb(0x150)]=='Portuguese\x20(BR)')var _0x3236cc=users[_0xf64fbb(0x141)];else{if(_0x1d3b86[0x0][_0xf64fbb(0x150)]==_0xf64fbb(0xf9))var _0x3236cc=users['Chinese'];else{if(_0x1d3b86[0x0][_0xf64fbb(0x150)]=='Arabic\x20(ae)')var _0x3236cc=users[_0xf64fbb(0xb9)];}}}}}}}_0x1bb8bb[_0xf64fbb(0xe5)]('edit_transfer',{'success':_0x915282[_0xf64fbb(0x8a)]('success'),'errors':_0x915282[_0xf64fbb(0x8a)](_0xf64fbb(0x135)),'role':_0x5578b6,'profile':_0x297ec5,'master_shop':_0x1d3b86,'warehouse':_0x3b081c,'transfer':_0x24b4d7,'stock':_0x1e1f8e,'unit':_0x5cba1a,'language':_0x3236cc});}catch(_0x1bbf2a){console[_0xf64fbb(0x99)](_0x1bbf2a);}}),router[a0_0x2f3a02(0x149)](a0_0x2f3a02(0xd0),auth,async(_0x319808,_0x58d12d)=>{var _0xc80daf=a0_0x2f3a02;try{const _0x31fb6f=_0x319808['params']['id'],_0x3a6df0=await transfers[_0xc80daf(0x108)](_0x31fb6f);_0x58d12d['json'](_0x319808[_0xc80daf(0x8d)]);return;const {date:_0x43e1c1,from_warehouse:_0x93ebb7,FromRoom_name:_0xeb4bb8,to_warehouse:_0x192553,ToRoom_name:_0x5302bf,prod_name:_0x1606e3,from_prod_qty:_0x1bfa08,from_prod_level:_0x5a077c,from_prod_isle:_0x55d64b,from_prod_pallet:_0x340670,to_prod_qty:_0x29205f,to_prod_level:_0x9bc8df,to_prod_isle:_0x3cf856,to_prod_pallet:_0xb013a0,primary_code:_0x571d89,secondary_code:_0x43071e,product_code3:_0x43084d,note:_0xe6ab28,invoice:_0x40eddc,expiry_date:_0x1f88a1}=_0x319808[_0xc80daf(0x8d)];if(typeof _0x1606e3=='string')var _0x8f4c9=[_0x319808['body'][_0xc80daf(0x101)]],_0x34794e=[_0x319808['body'][_0xc80daf(0x89)]],_0x367b00=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0xcb)]],_0x392acb=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0xf2)]],_0x26677c=[_0x319808[_0xc80daf(0x8d)]['from_prod_pallet']],_0x2ee095=[_0x319808['body'][_0xc80daf(0x130)]],_0x3a0f24=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0xe2)]],_0x104408=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0xc3)]],_0x3c27a9=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0xed)]],_0xa184cd=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0x10b)]],_0x1ac450=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0xfd)]],_0x565545=[_0x319808[_0xc80daf(0x8d)]['storage']],_0x197f2d=[_0x319808['body'][_0xc80daf(0xc5)]],_0x550ab1=[_0x319808['body'][_0xc80daf(0x9a)]],_0x39a14f=[_0x319808['body'][_0xc80daf(0x15d)]],_0x3bbdda=[_0x319808['body'][_0xc80daf(0xd9)]],_0x1ada27=[_0x319808['body'][_0xc80daf(0x104)]],_0x2f2827=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0x86)]],_0x1a1abd=[_0x319808['body'][_0xc80daf(0x13d)]],_0x3b020d=[_0x319808[_0xc80daf(0x8d)]['batch_code']],_0x552fd8=[_0x319808['body'][_0xc80daf(0x120)]],_0x17559d=[_0x319808[_0xc80daf(0x8d)][_0xc80daf(0x155)]],_0x497f9e=[_0x319808['body'][_0xc80daf(0x93)]];else var _0x8f4c9=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x101)]],_0x565545=[..._0x319808['body']['storage']],_0x197f2d=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0xc5)]],_0x2ee095=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x130)]],_0x1ac450=[..._0x319808['body']['to_types']],_0x34794e=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x89)]],_0x367b00=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0xcb)]],_0x392acb=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0xf2)]],_0x26677c=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x10f)]],_0x3a0f24=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0xe2)]],_0x104408=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0xc3)]],_0x3c27a9=[..._0x319808[_0xc80daf(0x8d)]['to_prod_isle']],_0xa184cd=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x10b)]],_0x550ab1=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x9a)]],_0x39a14f=[..._0x319808['body']['secondary_code']],_0x3bbdda=[..._0x319808['body'][_0xc80daf(0xd9)]],_0x1ada27=[..._0x319808['body']['MaxStocks_data2']],_0x2f2827=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x86)]],_0x1a1abd=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x13d)]],_0x3b020d=[..._0x319808['body'][_0xc80daf(0x8c)]],_0x552fd8=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x120)]],_0x17559d=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x155)]],_0x497f9e=[..._0x319808[_0xc80daf(0x8d)][_0xc80daf(0x93)]];const _0x4c8020=_0x8f4c9[_0xc80daf(0xa3)](_0xaa0456=>{return _0xaa0456={'product_name':_0xaa0456};});_0x34794e['forEach']((_0x2976ce,_0x182e39)=>{var _0x27c852=_0xc80daf;_0x4c8020[_0x182e39][_0x27c852(0x7b)]=_0x2976ce;}),_0x367b00[_0xc80daf(0xf0)]((_0x447036,_0x42200f)=>{_0x4c8020[_0x42200f]['from_bay']=_0x447036;}),_0x392acb[_0xc80daf(0xf0)]((_0x22e477,_0x2f0123)=>{_0x4c8020[_0x2f0123]['from_bin']=_0x22e477;}),_0x26677c[_0xc80daf(0xf0)]((_0x5ef07c,_0x41ee95)=>{var _0x315acc=_0xc80daf;_0x4c8020[_0x41ee95][_0x315acc(0xdc)]=_0x5ef07c;}),_0x3a0f24[_0xc80daf(0xf0)]((_0x3ff8ca,_0x1a75f3)=>{_0x4c8020[_0x1a75f3]['to_quantity']=_0x3ff8ca;}),_0x104408['forEach']((_0x8fe74b,_0x2e51a3)=>{var _0x5177b0=_0xc80daf;_0x4c8020[_0x2e51a3][_0x5177b0(0xe1)]=_0x8fe74b;}),_0x3c27a9['forEach']((_0x27781b,_0xb7e392)=>{var _0xfed94f=_0xc80daf;_0x4c8020[_0xb7e392][_0xfed94f(0x14f)]=_0x27781b;}),_0xa184cd[_0xc80daf(0xf0)]((_0x2cf866,_0x402df4)=>{var _0x2ff071=_0xc80daf;_0x4c8020[_0x402df4][_0x2ff071(0x127)]=_0x2cf866;}),_0x550ab1['forEach']((_0x2b8d5c,_0x279a3f)=>{var _0x2278b4=_0xc80daf;_0x4c8020[_0x279a3f][_0x2278b4(0x9a)]=_0x2b8d5c;}),_0x39a14f[_0xc80daf(0xf0)]((_0x568f58,_0x1ce36b)=>{var _0x44ca45=_0xc80daf;_0x4c8020[_0x1ce36b][_0x44ca45(0x15d)]=_0x568f58;}),_0x3bbdda[_0xc80daf(0xf0)]((_0xa1df02,_0x137a95)=>{_0x4c8020[_0x137a95]['product_code']=_0xa1df02;}),_0x1ada27['forEach']((_0x5634ef,_0x450115)=>{var _0x23e73c=_0xc80daf;_0x4c8020[_0x450115][_0x23e73c(0x12f)]=_0x5634ef;}),_0x2f2827[_0xc80daf(0xf0)]((_0x24cbd5,_0x38d7a3)=>{var _0x9b5d8=_0xc80daf;_0x4c8020[_0x38d7a3][_0x9b5d8(0x86)]=_0x24cbd5;}),_0x1a1abd[_0xc80daf(0xf0)]((_0x2015c2,_0x37ef2b)=>{var _0x12ebf3=_0xc80daf;_0x4c8020[_0x37ef2b][_0x12ebf3(0x13d)]=_0x2015c2;}),_0x3b020d[_0xc80daf(0xf0)]((_0x1027f7,_0x2af342)=>{var _0x203b82=_0xc80daf;_0x4c8020[_0x2af342][_0x203b82(0x8c)]=_0x1027f7;}),_0x552fd8[_0xc80daf(0xf0)]((_0x4a8b73,_0x20aba9)=>{_0x4c8020[_0x20aba9]['expiry_date']=_0x4a8b73;}),_0x565545[_0xc80daf(0xf0)]((_0x12dd51,_0x10797a)=>{var _0x373cee=_0xc80daf;_0x4c8020[_0x10797a][_0x373cee(0x146)]=_0x12dd51;}),_0x197f2d[_0xc80daf(0xf0)]((_0x4fb541,_0x3a94b1)=>{var _0x6eefdf=_0xc80daf;_0x4c8020[_0x3a94b1][_0x6eefdf(0x76)]=_0x4fb541;}),_0x2ee095[_0xc80daf(0xf0)]((_0xac601,_0x3978f2)=>{_0x4c8020[_0x3978f2]['from_types']=_0xac601;}),_0x1ac450[_0xc80daf(0xf0)]((_0x510b30,_0x1775eb)=>{_0x4c8020[_0x1775eb]['to_types']=_0x510b30;}),_0x17559d['forEach']((_0x2ccb8c,_0x58f61d)=>{_0x4c8020[_0x58f61d]['from_storage']=_0x2ccb8c;}),_0x497f9e[_0xc80daf(0xf0)]((_0x5ba607,_0xa2740b)=>{var _0x86545f=_0xc80daf;_0x4c8020[_0xa2740b][_0x86545f(0x162)]=_0x5ba607;});const _0x11e6dd=_0x4c8020[_0xc80daf(0xf7)](_0x58991f=>_0x58991f[_0xc80daf(0xb6)]!=='0'&&_0x58991f[_0xc80daf(0xb6)]!==''||_0x58991f[_0xc80daf(0x127)]!=='0'&&_0x58991f['to_floorlevel']!=='');var _0x912743=0x0;_0x11e6dd[_0xc80daf(0xf0)](_0x292afe=>{var _0x4bc986=_0xc80daf;parseInt(_0x292afe[_0x4bc986(0x7b)])<parseInt(_0x292afe[_0x4bc986(0xb6)])&&_0x912743++;});if(_0x912743!=0x0)return _0x319808[_0xc80daf(0x8a)](_0xc80daf(0x135),_0xc80daf(0xf1)),_0x58d12d[_0xc80daf(0x124)](_0xc80daf(0x159));const _0x5ce573=await warehouse[_0xc80daf(0xa2)]({'name':_0x3a6df0[_0xc80daf(0x81)],'room':_0x3a6df0[_0xc80daf(0x83)]});_0x3a6df0[_0xc80daf(0x116)][_0xc80daf(0xf0)](_0x62f9c1=>{var _0x206402=_0xc80daf;if(_0x62f9c1[_0x206402(0xb6)]>0x0){const _0xdabf7e=_0x5ce573[_0x206402(0x14a)][_0x206402(0xa3)](_0x26b2d9=>{var _0xbb2ce1=_0x206402;_0x26b2d9['product_name']==_0x62f9c1[_0xbb2ce1(0x11f)]&&_0x26b2d9[_0xbb2ce1(0xe8)]==_0x62f9c1[_0xbb2ce1(0xdc)]&&_0x26b2d9[_0xbb2ce1(0xbf)]==_0x62f9c1[_0xbb2ce1(0x130)]&&_0x26b2d9[_0xbb2ce1(0x78)]==_0x62f9c1[_0xbb2ce1(0x115)]&&_0x26b2d9[_0xbb2ce1(0xb3)]==_0x62f9c1['from_bay']&&_0x26b2d9['rack']==_0x62f9c1[_0xbb2ce1(0x162)]&&_0x26b2d9[_0xbb2ce1(0x146)]==_0x62f9c1['from_storage']&&(_0x26b2d9[_0xbb2ce1(0xec)]=parseInt(_0x26b2d9['product_stock'])+parseInt(_0x62f9c1[_0xbb2ce1(0xb6)]));});}}),await _0x5ce573[_0xc80daf(0x7e)]();const _0x4a26e6=await warehouse['findOne']({'name':_0x3a6df0['to_warehouse'],'room':_0x3a6df0[_0xc80daf(0x7a)]});_0x3a6df0[_0xc80daf(0x116)]['forEach'](_0x40c838=>{var _0x47a178=_0xc80daf;if(_0x40c838[_0x47a178(0xb6)]>0x0){const _0x2bfd0d=_0x4a26e6[_0x47a178(0x14a)][_0x47a178(0xa3)](_0x134c2c=>{var _0x19b741=_0x47a178;_0x134c2c[_0x19b741(0x11f)]==_0x40c838[_0x19b741(0x11f)]&&_0x134c2c[_0x19b741(0xe8)]==_0x40c838['to_floorlevel']&&_0x134c2c['type']==_0x40c838[_0x19b741(0xfd)]&&_0x134c2c[_0x19b741(0x78)]==_0x40c838['to_bin']&&_0x134c2c['bay']==_0x40c838[_0x19b741(0xe1)]&&_0x134c2c[_0x19b741(0x76)]==_0x40c838[_0x19b741(0x76)]&&_0x134c2c[_0x19b741(0x146)]==_0x40c838[_0x19b741(0x146)]&&(_0x134c2c[_0x19b741(0xec)]=parseInt(_0x134c2c['product_stock'])-parseInt(_0x40c838[_0x19b741(0xb6)]));});}}),await _0x4a26e6[_0xc80daf(0x7e)](),_0x3a6df0['date']=_0x43e1c1,_0x3a6df0[_0xc80daf(0x81)]=_0x93ebb7,_0x3a6df0['to_warehouse']=_0x192553,_0x3a6df0['product']=_0x11e6dd,_0x3a6df0['note']=_0xe6ab28,_0x3a6df0['invoice']=_0x40eddc;const _0x5ac1d6=await _0x3a6df0[_0xc80daf(0x7e)]();console['log'](_0x5ac1d6);const _0x3eebe5=await warehouse[_0xc80daf(0xa2)]({'name':_0x93ebb7,'room':_0xeb4bb8});_0x5ac1d6[_0xc80daf(0x116)]['forEach'](_0x8abc2d=>{var _0x33b12a=_0xc80daf;if(_0x8abc2d[_0x33b12a(0xb6)]>0x0){const _0x479a95=_0x3eebe5[_0x33b12a(0x14a)][_0x33b12a(0xa3)](_0x1e1a65=>{var _0x57e02b=_0x33b12a;_0x1e1a65['product_name']==_0x8abc2d[_0x57e02b(0x11f)]&&_0x1e1a65[_0x57e02b(0xe8)]==_0x8abc2d['from_floorlevel']&&_0x1e1a65[_0x57e02b(0xbf)]==_0x8abc2d['from_types']&&_0x1e1a65[_0x57e02b(0x78)]==_0x8abc2d[_0x57e02b(0x115)]&&_0x1e1a65[_0x57e02b(0xb3)]==_0x8abc2d['from_bay']&&_0x1e1a65[_0x57e02b(0x76)]==_0x8abc2d['from_rack']&&_0x1e1a65[_0x57e02b(0x146)]==_0x8abc2d['from_storage']&&(_0x1e1a65[_0x57e02b(0xec)]=parseInt(_0x1e1a65[_0x57e02b(0xec)])-parseInt(_0x8abc2d[_0x57e02b(0xb6)]));});}}),await _0x3eebe5[_0xc80daf(0x7e)]();const _0x207d11=await warehouse['findOne']({'name':_0x192553,'room':_0x5302bf});_0x5ac1d6[_0xc80daf(0x116)][_0xc80daf(0xf0)](_0x511d8b=>{var _0x15ff04=_0xc80daf;if(_0x511d8b[_0x15ff04(0xb6)]>0x0){var _0x2b92d9=0x0;const _0x2d0b50=_0x207d11[_0x15ff04(0x14a)]['map'](_0x49cd30=>{var _0x403302=_0x15ff04;_0x49cd30['product_name']==_0x511d8b['product_name']&&_0x49cd30[_0x403302(0xe8)]==_0x511d8b[_0x403302(0x127)]&&_0x49cd30[_0x403302(0xbf)]==_0x511d8b[_0x403302(0xfd)]&&_0x49cd30[_0x403302(0x78)]==_0x511d8b['to_bin']&&_0x49cd30[_0x403302(0xb3)]==_0x511d8b[_0x403302(0xe1)]&&_0x49cd30[_0x403302(0x76)]==_0x511d8b['rack']&&_0x49cd30['storage']==_0x511d8b[_0x403302(0x146)]&&(_0x49cd30[_0x403302(0xec)]=parseInt(_0x49cd30[_0x403302(0xec)])+parseInt(_0x511d8b[_0x403302(0xb6)]),_0x2b92d9++);});_0x2b92d9=='0'&&(_0x207d11['product_details']=_0x207d11[_0x15ff04(0x14a)]['concat']({'product_name':_0x511d8b[_0x15ff04(0x11f)],'product_stock':_0x511d8b[_0x15ff04(0xb6)],'bay':_0x511d8b['to_bay'],'bin':_0x511d8b[_0x15ff04(0x14f)],'type':_0x511d8b[_0x15ff04(0xfd)],'floorlevel':_0x511d8b[_0x15ff04(0x127)],'storage':_0x511d8b[_0x15ff04(0x146)],'rack':_0x511d8b[_0x15ff04(0x76)],'product_code':_0x511d8b[_0x15ff04(0x75)],'primary_code':_0x511d8b['primary_code'],'secondary_code':_0x511d8b[_0x15ff04(0x15d)],'maxProducts':_0x511d8b[_0x15ff04(0x12f)],'storage':_0x511d8b[_0x15ff04(0x146)],'rack':_0x511d8b[_0x15ff04(0x76)]}));}}),await _0x207d11[_0xc80daf(0x7e)](),_0x319808[_0xc80daf(0x8a)](_0xc80daf(0x11b),_0xc80daf(0x147)),_0x58d12d['redirect'](_0xc80daf(0x12b));}catch(_0x4d0c7c){console[_0xc80daf(0x99)](_0x4d0c7c);}}),router[a0_0x2f3a02(0x149)]('/barcode_scanner',async(_0x264b46,_0x5d8487)=>{var _0xbefb97=a0_0x2f3a02;const {FromWareHouse:_0x414f34,FromRoom:_0xd48d6f,ToWarehouse:_0x3a5b4b,ToRoom:_0x49c7c1,primary_code:_0x33e69e,Roomslist:_0x57d23d}=_0x264b46[_0xbefb97(0x8d)],_0x55e14d=_0x57d23d[_0xbefb97(0xa7)](','),_0x49f27c=[];async function _0x50e4e6(_0x4ae125){var _0x3490e3=_0xbefb97;const _0x67d4ea=await warehouse[_0x3490e3(0x143)]([{'$match':{'name':_0x414f34,'room':_0x4ae125}},{'$unwind':_0x3490e3(0x77)},{'$match':{'product_details.primary_code':_0x33e69e}},{'$group':{'_id':_0x3490e3(0x157),'name':{'$first':_0x3490e3(0x96)},'instock':{'$first':_0x3490e3(0xfc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3490e3(0x126)},'product_code':{'$first':_0x3490e3(0xb0)},'level':{'$first':_0x3490e3(0x15a)},'isle':{'$first':_0x3490e3(0x125)},'type':{'$first':_0x3490e3(0x160)},'pallet':{'$first':_0x3490e3(0x109)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x3490e3(0x84)},'storage':{'$first':_0x3490e3(0x122)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3490e3(0x97)},'production_date':{'$first':_0x3490e3(0xc9)},'batch_code':{'$first':_0x3490e3(0x102)},'maxPerUnit':{'$first':_0x3490e3(0x8b)},'prod_cat':{'$first':'P'},'roomNamed':{'$first':_0x3490e3(0xf4)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]),_0xb6ac2=await warehouse[_0x3490e3(0x143)]([{'$match':{'name':_0x414f34,'room':_0x4ae125}},{'$unwind':_0x3490e3(0x77)},{'$match':{'product_details.secondary_code':_0x33e69e}},{'$group':{'_id':_0x3490e3(0x157),'name':{'$first':_0x3490e3(0x96)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3490e3(0xc6)},'secondary_code':{'$first':_0x3490e3(0x126)},'product_code':{'$first':_0x3490e3(0xb0)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x3490e3(0x125)},'type':{'$first':_0x3490e3(0x160)},'pallet':{'$first':_0x3490e3(0x109)},'unit':{'$first':_0x3490e3(0xf8)},'secondary_unit':{'$first':_0x3490e3(0x84)},'storage':{'$first':_0x3490e3(0x122)},'rack':{'$first':_0x3490e3(0xfb)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x3490e3(0x102)},'maxPerUnit':{'$first':_0x3490e3(0x8b)},'prod_cat':{'$first':'S'},'roomNamed':{'$first':_0x3490e3(0xf4)},'maxProducts':{'$first':_0x3490e3(0xe7)}}}]);if(_0x67d4ea[_0x3490e3(0xb1)]>0x0)_0x49f27c['push'](_0x67d4ea);else _0xb6ac2['length']>0x0&&_0x49f27c['push'](_0xb6ac2);}const _0x2a7a53=_0x55e14d['map'](_0x575e92=>_0x50e4e6(_0x575e92));await Promise[_0xbefb97(0x8e)](_0x2a7a53),_0x5d8487['json'](_0x49f27c);}),router[a0_0x2f3a02(0x149)](a0_0x2f3a02(0xba),async(_0x328573,_0x17bcc9)=>{var _0xbf3470=a0_0x2f3a02;try{const {FromWareHouse:_0x54bfc4,FromRoom:_0xe0b7ff,ToWarehouse:_0x1a68ec,ToRoom:_0x5179b0,secondary_code:_0x1c4664}=_0x328573[_0xbf3470(0x8d)],_0x4aaf36=await warehouse['aggregate']([{'$match':{'name':_0x54bfc4}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1c4664}},{'$group':{'_id':_0xbf3470(0x157),'name':{'$first':_0xbf3470(0x96)},'primary_code':{'$first':_0xbf3470(0xc6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xbf3470(0xb0)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0xbf3470(0xeb)},'level':{'$first':_0xbf3470(0x98)},'isle':{'$first':_0xbf3470(0xf5)},'pallet':{'$first':_0xbf3470(0xd8)},'maxProducts':{'$first':_0xbf3470(0xe7)},'unit':{'$first':_0xbf3470(0xf8)}}}]);_0x17bcc9[_0xbf3470(0x103)](0xc8)[_0xbf3470(0x11e)](_0x4aaf36);}catch(_0x338f83){_0x17bcc9[_0xbf3470(0x103)](0x194)[_0xbf3470(0x11e)]({'message':_0x338f83[_0xbf3470(0xef)]});}}),router['post']('/barcode_scanner3',async(_0x427985,_0x57bc25)=>{var _0x39d4a6=a0_0x2f3a02;try{const {FromWareHouse:_0x5edfe6,FromRoom:_0x4372b6,ToWarehouse:_0x4691dc,ToRoom:_0x3bc80e,product_code:_0x24ce2d}=_0x427985[_0x39d4a6(0x8d)],_0x452f2e=await warehouse[_0x39d4a6(0x143)]([{'$match':{'name':_0x5edfe6}},{'$unwind':_0x39d4a6(0x77)},{'$match':{'product_details.product_code':_0x24ce2d}},{'$group':{'_id':_0x39d4a6(0x157),'name':{'$first':_0x39d4a6(0x96)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x39d4a6(0x126)},'product_code':{'$first':_0x39d4a6(0xb0)},'instock':{'$first':_0x39d4a6(0xfc)},'warehouse':{'$first':_0x39d4a6(0xeb)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x39d4a6(0xf5)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x39d4a6(0xe7)},'unit':{'$first':_0x39d4a6(0xf8)}}}]);_0x57bc25[_0x39d4a6(0x103)](0xc8)[_0x39d4a6(0x11e)](_0x452f2e);}catch(_0x1e42c2){_0x57bc25[_0x39d4a6(0x103)](0x194)[_0x39d4a6(0x11e)]({'message':_0x1e42c2[_0x39d4a6(0xef)]});}}),router[a0_0x2f3a02(0x149)](a0_0x2f3a02(0x145),async(_0x1de556,_0x196deb)=>{var _0x5acfb4=a0_0x2f3a02;const {level:_0x125559,isle:_0x15a7f4,pallet:_0x32f95c,warehouses:_0x214d2c,room:_0x27061c}=_0x1de556[_0x5acfb4(0x8d)];try{const _0x5d2c7b=await warehouse['aggregate']([{'$match':{'name':_0x214d2c,'room':_0x27061c}},{'$unwind':_0x5acfb4(0x77)},{'$match':{'product_details.level':parseInt(_0x125559),'product_details.isle':_0x15a7f4,'product_details.pallet':parseInt(_0x32f95c)}},{'$group':{'_id':_0x5acfb4(0x157),'name':{'$first':_0x5acfb4(0x96)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x5acfb4(0x98)},'isle':{'$first':_0x5acfb4(0xf5)},'pallet':{'$first':_0x5acfb4(0xd8)},'maxProducts':{'$first':_0x5acfb4(0xe7)}}}]);_0x196deb['status'](0xc8)['json'](_0x5d2c7b);}catch(_0x190803){_0x196deb[_0x5acfb4(0x103)](0x194)[_0x5acfb4(0x11e)]({'message':_0x190803['message']});}}),module[a0_0x2f3a02(0xa8)]=router;