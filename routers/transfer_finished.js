var a0_0x5e7e3a=a0_0xa48b;(function(_0x1cd8ca,_0x4f73c6){var _0x40e524=a0_0xa48b,_0x1afc22=_0x1cd8ca();while(!![]){try{var _0x4b5ca3=parseInt(_0x40e524(0x141))/0x1*(-parseInt(_0x40e524(0x184))/0x2)+parseInt(_0x40e524(0x1a4))/0x3*(parseInt(_0x40e524(0x10a))/0x4)+-parseInt(_0x40e524(0x174))/0x5*(parseInt(_0x40e524(0x16d))/0x6)+-parseInt(_0x40e524(0x1a9))/0x7*(parseInt(_0x40e524(0x1da))/0x8)+-parseInt(_0x40e524(0x1d9))/0x9+parseInt(_0x40e524(0x1a8))/0xa*(-parseInt(_0x40e524(0x10e))/0xb)+-parseInt(_0x40e524(0x146))/0xc*(-parseInt(_0x40e524(0x12e))/0xd);if(_0x4b5ca3===_0x4f73c6)break;else _0x1afc22['push'](_0x1afc22['shift']());}catch(_0x22a981){_0x1afc22['push'](_0x1afc22['shift']());}}}(a0_0x3992,0x76767));function a0_0xa48b(_0x85bcc4,_0x44315b){var _0x3992d2=a0_0x3992();return a0_0xa48b=function(_0xa48b5f,_0x68aefa){_0xa48b5f=_0xa48b5f-0xf1;var _0x238ad9=_0x3992d2[_0xa48b5f];return _0x238ad9;},a0_0xa48b(_0x85bcc4,_0x44315b);}const express=require('express'),app=express(),router=express[a0_0x5e7e3a(0x111)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x5e7e3a(0x167)),auth=require(a0_0x5e7e3a(0x1ca)),users=require(a0_0x5e7e3a(0x1bd)),nodemailer=require('nodemailer');function a0_0x3992(){var _0xe55b73=['here1','English','English\x20(US)','post','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Logo.png','render','<span\x20style=\x22float:\x20right;\x22>','here2','/upload/','../models/all_models','language','Transfer\x20Mail','<tr>','from_room_name','success','474sRIMUE','</td>','length','An\x20error\x20occurred\x20while\x20saving\x20data.','from_quantity','errors','$finalize','59975oZboCm','DRY\x20GOODS','$product_details.product_stock','Spanish','/transfer_finished/preview/','Product\x20Transfer\x20successfully','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','role','$name','$product_details.production_date','<hr\x20class=\x22my-3\x22>','$product_details','findOne','product_date','Enclosed','/CheckingWarehouse','14pMjpdi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','production_date','from_prod_qty','product_code','Transfer\x20Finalize\x20Successfully','$product.from_room_name','$product_details._id','/../public','staff','/barcode_scanner','primary_unit','forEach','image','params','createTransport','logo','<!DOCTYPE\x20html>','MaxStocks_data','toString','ToRoomAssigned','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.bin','Arabic','product_code3','product_name','$product_details.isle','flash','$product_details.type','prod_cat','<div>','password','225768erAZkO','$from_warehouse','floor','note','10ftelkE','448AOKMMb','</h5>','slice','findById','An\x20error\x20occurred.','unit','Error\x20Occurs','to_room','from_invoice','to_warehouse','edit_transfer_finished_view','$product_details.rack','$product_details.expiry_date','body','to_quantity','/view','email','Enabled','$product_details.invoice','<strong>\x20Regards\x20</strong>','../public/language/languages.json','log','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','from_warehouse','transfer_data','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','host','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</table>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','getFullYear','../middleware/auth','$product.to_room_name','bay','catch','undefined','primary_code','to_prod_qty','$product_details.bay','German','maxProducts','updateOne','</body></html>','\x20<>\x20','$product_details.primary_code','FGSEmail','4316706AvRBQI','71104BBQMNn','to_room_name','/view/add_transfer','site_title','$product_details.maxProducts','back','$room','<h2>\x20','map','json','<html><head><title></title>','secondary_unit','maxPerUnit','to_floorlevel','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','from_bay','to_prod_level','product_stock','abs','/transfer/view','French','<h5>','then','error','Rack\x201','16cHvsgb','/barcode_scanner2','$product_details.unit','find','5172992HJgfIP','RoomAssigned','Chinese','Router','from_room','/view/:id','/barcode_scanner3','$product_details.secondary_code','get','\x20<=>\x20','_id','Portuguese','$product_details.product_code','MaxStocks_data2','QA\x20Warehouse','<h5\x20style=\x22text-align:\x20left;\x22>','$to_warehouse','</span>','</tr>','split','save','$product_details.floorlevel','True','$product_details.product_name','to_bay','product','<tbody\x20style=\x22text-align:\x20center;\x22>','New_Qty_Converted','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','concat','getMonth','\x20Order\x20Date\x20:\x20','36166117OleJeW','TRFF-','$product_details.maxPerUnit','filter','padStart','exports','redirect','port','secondary_code','Portuguese\x20(BR)','Arabic\x20(ae)','user','$product_details.storage','product_details','sendMail','transfer_finished','warehouse','invoice','expiry_date','18781mlPVAg','Finished\x20Goods','$product','max','FROZEN\x20GOODS','12NJUWey','all','random','$product_details.level','</div>','To_invoice','$product_details.pallet','/preview/:id','string','$product_details.batch_code','/transfer_finished/view','prod_name','to_invoice','Hindi','id_transaction','$product_details.secondary_unit','</tbody>','add_transfer_finished','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','batch_code','from_prod_level','message','aggregate'];a0_0x3992=function(){return _0xe55b73;};return a0_0x3992();}router['get'](a0_0x5e7e3a(0x1b8),auth,async(_0x3cb765,_0x212dfe)=>{var _0x3aa1a9=a0_0x5e7e3a;try{const {username:_0x3aa909,email:_0x4dbd2c,role:_0x52205d}=_0x3cb765[_0x3aa1a9(0x139)],_0xb5c56e=_0x3cb765[_0x3aa1a9(0x139)],_0x13d816=await profile[_0x3aa1a9(0x180)]({'email':_0xb5c56e['email']}),_0x28f28f=await master_shop[_0x3aa1a9(0x10d)]();let _0x902845;if(_0xb5c56e[_0x3aa1a9(0x17b)]==_0x3aa1a9(0x18d)){const _0x2aac5b=await staff[_0x3aa1a9(0x180)]({'email':_0xb5c56e[_0x3aa1a9(0x1b9)]});_0x902845=await transfers_finished[_0x3aa1a9(0x10d)]({'from_warehouse':_0x2aac5b['warehouse']});}else _0x902845=await transfers_finished[_0x3aa1a9(0x15c)]([{'$unwind':_0x3aa1a9(0x143)},{'$group':{'_id':_0x3aa1a9(0xfe),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'from_warehouse':{'$first':_0x3aa1a9(0x1a5)},'to_warehouse':{'$first':_0x3aa1a9(0x11e)},'from_room_name':{'$addToSet':_0x3aa1a9(0x18a)},'to_room_name':{'$addToSet':_0x3aa1a9(0x1cb)},'finalize':{'$first':_0x3aa1a9(0x173)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x28f28f[0x0][_0x3aa1a9(0x168)]==_0x3aa1a9(0x15f))var _0x13c056=users[_0x3aa1a9(0x15e)];else{if(_0x28f28f[0x0][_0x3aa1a9(0x168)]==_0x3aa1a9(0x153))var _0x13c056=users[_0x3aa1a9(0x153)];else{if(_0x28f28f[0x0][_0x3aa1a9(0x168)]==_0x3aa1a9(0x1d2))var _0x13c056=users['German'];else{if(_0x28f28f[0x0][_0x3aa1a9(0x168)]==_0x3aa1a9(0x177))var _0x13c056=users['Spanish'];else{if(_0x28f28f[0x0][_0x3aa1a9(0x168)]==_0x3aa1a9(0x105))var _0x13c056=users[_0x3aa1a9(0x105)];else{if(_0x28f28f[0x0][_0x3aa1a9(0x168)]==_0x3aa1a9(0x137))var _0x13c056=users[_0x3aa1a9(0x119)];else{if(_0x28f28f[0x0]['language']==_0x3aa1a9(0x110))var _0x13c056=users[_0x3aa1a9(0x110)];else{if(_0x28f28f[0x0]['language']==_0x3aa1a9(0x138))var _0x13c056=users[_0x3aa1a9(0x19b)];}}}}}}}_0x212dfe[_0x3aa1a9(0x163)](_0x3aa1a9(0x13d),{'success':_0x3cb765[_0x3aa1a9(0x19f)]('success'),'errors':_0x3cb765['flash']('errors'),'role':_0xb5c56e,'profile':_0x13d816,'master_shop':_0x28f28f,'transfer':_0x902845,'language':_0x13c056});}catch(_0x32b201){console[_0x3aa1a9(0x1be)](_0x32b201);}});async function getRandom8DigitNumber(){var _0x163a99=a0_0x5e7e3a;const _0x58855b=0x989680,_0x5b28f0=0x5f5e0ff,_0x6bc600=Math[_0x163a99(0x1a6)](Math[_0x163a99(0x148)]()*(_0x5b28f0-_0x58855b+0x1))+_0x58855b;var _0x53770b;const _0xbfc224=await transfers_finished[_0x163a99(0x180)]({'invoice':_0x163a99(0x12f)+_0x6bc600});return _0xbfc224&&_0xbfc224['length']>0x0?_0x53770b=_0x163a99(0x12f)+_0x6bc600:_0x53770b=_0x163a99(0x12f)+_0x6bc600,_0x53770b;}router[a0_0x5e7e3a(0x116)](a0_0x5e7e3a(0xf2),auth,async(_0x485516,_0x53bac4)=>{var _0x286bc2=a0_0x5e7e3a;try{const {username:_0x232a3f,email:_0x400cec,role:_0x317b14}=_0x485516[_0x286bc2(0x139)],_0x2768bd=_0x485516['user'],_0x10c993=await profile['findOne']({'email':_0x2768bd[_0x286bc2(0x1b9)]}),_0x21e98b=await master_shop[_0x286bc2(0x10d)]();let _0x4eadd3;if(_0x2768bd[_0x286bc2(0x17b)]==_0x286bc2(0x18d)){const _0x5bfbd4=await staff[_0x286bc2(0x180)]({'email':_0x2768bd[_0x286bc2(0x1b9)]});_0x4eadd3=await warehouse[_0x286bc2(0x15c)]([{'$match':{'status':_0x286bc2(0x1ba),'name':_0x5bfbd4[_0x286bc2(0x13e)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x286bc2(0x11c)}}},{'$group':{'_id':_0x286bc2(0x17c),'name':{'$first':'$name'}}}]);}else _0x4eadd3=await warehouse[_0x286bc2(0x15c)]([{'$match':{'status':'Enabled','warehouse_category':_0x286bc2(0x142),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x286bc2(0x17c),'name':{'$first':_0x286bc2(0x17c)}}}]);const _0x59da65=await transfers_finished[_0x286bc2(0x10d)]({}),_0xe607fc=_0x59da65[_0x286bc2(0x16f)]+0x1,_0x4fec47='TRFF-'+_0xe607fc[_0x286bc2(0x197)]()[_0x286bc2(0x132)](0x5,'0');if(_0x21e98b[0x0][_0x286bc2(0x168)]==_0x286bc2(0x15f))var _0x429e56=users[_0x286bc2(0x15e)];else{if(_0x21e98b[0x0][_0x286bc2(0x168)]==_0x286bc2(0x153))var _0x429e56=users['Hindi'];else{if(_0x21e98b[0x0]['language']==_0x286bc2(0x1d2))var _0x429e56=users['German'];else{if(_0x21e98b[0x0][_0x286bc2(0x168)]=='Spanish')var _0x429e56=users[_0x286bc2(0x177)];else{if(_0x21e98b[0x0]['language']==_0x286bc2(0x105))var _0x429e56=users[_0x286bc2(0x105)];else{if(_0x21e98b[0x0]['language']==_0x286bc2(0x137))var _0x429e56=users['Portuguese'];else{if(_0x21e98b[0x0][_0x286bc2(0x168)]==_0x286bc2(0x110))var _0x429e56=users[_0x286bc2(0x110)];else{if(_0x21e98b[0x0]['language']==_0x286bc2(0x138))var _0x429e56=users['Arabic'];}}}}}}}const _0x417797=getRandom8DigitNumber();_0x417797['then'](_0xbbd79c=>{var _0x37e88c=_0x286bc2;_0x53bac4[_0x37e88c(0x163)](_0x37e88c(0x157),{'success':_0x485516['flash']('success'),'errors':_0x485516[_0x37e88c(0x19f)](_0x37e88c(0x172)),'role':_0x2768bd,'profile':_0x10c993,'master_shop':_0x21e98b,'warehouse':_0x4eadd3,'language':_0x429e56,'invoice':_0xbbd79c});})[_0x286bc2(0x1cd)](_0x3b475f=>{var _0x207df4=_0x286bc2;_0x485516[_0x207df4(0x19f)](_0x207df4(0x172),_0x207df4(0x199)),_0x53bac4[_0x207df4(0x134)](_0x207df4(0x104));});}catch(_0x49e975){console[_0x286bc2(0x1be)](_0x49e975);}}),router[a0_0x5e7e3a(0x160)](a0_0x5e7e3a(0xf2),auth,async(_0x2b592e,_0x4f4a58)=>{var _0x37bb43=a0_0x5e7e3a;try{const {date:_0x185905,from_warehouse:_0x4b2243,FromRoom_name:_0x15982b,to_warehouse:_0x4ad262,ToRoom_name:_0x3fc1f8,prod_name:_0x421296,from_prod_qty:_0x5b1585,from_prod_level:_0x281aaa,from_prod_isle:_0x10f9a0,from_prod_pallet:_0x44637e,to_prod_qty:_0x394a13,to_prod_level:_0x2a75b7,to_prod_isle:_0x16878e,to_prod_pallet:_0x45b12d,primary_code:_0x5dc75a,secondary_code:_0x5c531e,product_code3:_0x8667ad,note:_0x2b923b,MaxStocks_data2:_0x1ac0a9,invoice:_0x527064,expiry_date:_0x2a765c}=_0x2b592e['body'];if(typeof _0x421296=='string')var _0x4728a0=[_0x2b592e[_0x37bb43(0x1b6)]['prod_name']],_0x182b90=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x187)]],_0x4467ba=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x15a)]],_0x3a1b3a=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x129)]],_0x2e555a=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x101)]],_0x43f71b=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x1cf)]],_0x50641d=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x136)]],_0x109253=[_0x2b592e[_0x37bb43(0x1b6)]['product_code3']],_0x186e69=[_0x2b592e['body'][_0x37bb43(0x11b)]],_0x2d241d=[_0x2b592e['body'][_0x37bb43(0x18f)]],_0x1ffd52=[_0x2b592e['body'][_0x37bb43(0xfb)]],_0x42a35e=[_0x2b592e['body'][_0x37bb43(0x159)]],_0x3cacb7=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x140)]],_0x19e1d1=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x181)]],_0x4fc3f2=[_0x2b592e[_0x37bb43(0x1b6)]['MaxStocks_data']],_0x3e5d88=[_0x2b592e['body'][_0x37bb43(0xfc)]],_0x200244=[_0x2b592e['body'][_0x37bb43(0x1a1)]],_0x160ad0=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x10f)]],_0x1eef1d=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x198)]],_0x36cb7f=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x1b1)]],_0x3ce95e=[_0x2b592e['body'][_0x37bb43(0x152)]],_0x2afe40=[_0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x154)]];else var _0x4728a0=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x151)]],_0x182b90=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x187)]],_0x4467ba=[..._0x2b592e[_0x37bb43(0x1b6)]['from_prod_level']],_0x3a1b3a=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x129)]],_0x2e555a=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x101)]],_0x43f71b=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x1cf)]],_0x50641d=[..._0x2b592e['body'][_0x37bb43(0x136)]],_0x109253=[..._0x2b592e['body'][_0x37bb43(0x19c)]],_0x186e69=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x11b)]],_0x2d241d=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x18f)]],_0x1ffd52=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0xfb)]],_0x42a35e=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x159)]],_0x3cacb7=[..._0x2b592e['body'][_0x37bb43(0x140)]],_0x19e1d1=[..._0x2b592e[_0x37bb43(0x1b6)]['product_date']],_0x4fc3f2=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x196)]],_0x3e5d88=[..._0x2b592e['body'][_0x37bb43(0xfc)]],_0x200244=[..._0x2b592e['body'][_0x37bb43(0x1a1)]],_0x160ad0=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x10f)]],_0x1eef1d=[..._0x2b592e[_0x37bb43(0x1b6)]['ToRoomAssigned']],_0x36cb7f=[..._0x2b592e['body'][_0x37bb43(0x1b1)]],_0x3ce95e=[..._0x2b592e['body'][_0x37bb43(0x152)]],_0x2afe40=[..._0x2b592e[_0x37bb43(0x1b6)][_0x37bb43(0x154)]];const _0x2cdd09=_0x4728a0['map'](_0x200941=>{return _0x200941={'product_name':_0x200941};});_0x182b90['forEach']((_0x13a8ef,_0x31a02e)=>{var _0xb3212d=_0x37bb43;_0x2cdd09[_0x31a02e][_0xb3212d(0x171)]=_0x13a8ef;}),_0x4467ba[_0x37bb43(0x190)]((_0x1f20d7,_0x3c94c4)=>{var _0x5049dd=_0x37bb43;_0x2cdd09[_0x3c94c4][_0x5049dd(0x100)]=_0x1f20d7;}),_0x2afe40[_0x37bb43(0x190)]((_0x10d3b8,_0x4adf21)=>{_0x2cdd09[_0x4adf21]['id_transaction']=_0x10d3b8;}),_0x36cb7f['forEach']((_0x52ad63,_0x4eed5f)=>{_0x2cdd09[_0x4eed5f]['from_invoice']=_0x52ad63;}),_0x3ce95e[_0x37bb43(0x190)]((_0x106984,_0x10fa2d)=>{var _0xb6770f=_0x37bb43;_0x2cdd09[_0x10fa2d][_0xb6770f(0x14b)]=_0x106984;}),_0x3a1b3a[_0x37bb43(0x190)]((_0x519b80,_0x44e487)=>{var _0x43befd=_0x37bb43;_0x2cdd09[_0x44e487][_0x43befd(0x1b7)]=_0x519b80;}),_0x2e555a[_0x37bb43(0x190)]((_0x14490b,_0x1a5f20)=>{var _0x1b005c=_0x37bb43;_0x2cdd09[_0x1a5f20][_0x1b005c(0x126)]=_0x14490b;}),_0x43f71b[_0x37bb43(0x190)]((_0x4bfdd7,_0xc60850)=>{var _0x14ffc8=_0x37bb43;_0x2cdd09[_0xc60850][_0x14ffc8(0x1cf)]=_0x4bfdd7;}),_0x50641d['forEach']((_0x2580fe,_0x33d92e)=>{var _0x431f12=_0x37bb43;_0x2cdd09[_0x33d92e][_0x431f12(0x136)]=_0x2580fe;}),_0x109253['forEach']((_0x31b116,_0x5ce78b)=>{var _0x5df0b0=_0x37bb43;_0x2cdd09[_0x5ce78b][_0x5df0b0(0x188)]=_0x31b116;}),_0x186e69[_0x37bb43(0x190)]((_0x9d4d35,_0x1b2a8f)=>{_0x2cdd09[_0x1b2a8f]['maxProducts']=_0x9d4d35;}),_0x2d241d[_0x37bb43(0x190)]((_0x36ff67,_0x3574ea)=>{var _0x1dc419=_0x37bb43;_0x2cdd09[_0x3574ea][_0x1dc419(0x1ae)]=_0x36ff67;}),_0x1ffd52['forEach']((_0x58f9eb,_0x50a73e)=>{var _0x5043b3=_0x37bb43;_0x2cdd09[_0x50a73e][_0x5043b3(0xfb)]=_0x58f9eb;}),_0x42a35e[_0x37bb43(0x190)]((_0x51bf13,_0x1f501f)=>{var _0x5467ce=_0x37bb43;_0x2cdd09[_0x1f501f][_0x5467ce(0x159)]=_0x51bf13;}),_0x3cacb7[_0x37bb43(0x190)]((_0x1abbaf,_0x465596)=>{_0x2cdd09[_0x465596]['expiry_date']=_0x1abbaf;}),_0x19e1d1[_0x37bb43(0x190)]((_0x248308,_0xcea18f)=>{var _0x410e4e=_0x37bb43;_0x2cdd09[_0xcea18f][_0x410e4e(0x186)]=_0x248308;}),_0x4fc3f2['forEach']((_0x3a5c41,_0x3987b5)=>{var _0x2e24ce=_0x37bb43;_0x2cdd09[_0x3987b5][_0x2e24ce(0x1d3)]=_0x3a5c41;}),_0x3e5d88[_0x37bb43(0x190)]((_0x19332b,_0x2b2b2c)=>{var _0x137c66=_0x37bb43;_0x2cdd09[_0x2b2b2c][_0x137c66(0xfc)]=_0x19332b;}),_0x200244[_0x37bb43(0x190)]((_0x1fe6b0,_0x28fe02)=>{var _0x1fdff8=_0x37bb43;_0x2cdd09[_0x28fe02][_0x1fdff8(0x1a1)]=_0x1fe6b0;}),_0x160ad0[_0x37bb43(0x190)]((_0x29adfd,_0x2aadfc)=>{var _0x4ddd3a=_0x37bb43;_0x2cdd09[_0x2aadfc][_0x4ddd3a(0x16b)]=_0x29adfd;}),_0x1eef1d[_0x37bb43(0x190)]((_0x1cdcb5,_0x2a81e6)=>{var _0x3ba09e=_0x37bb43;_0x2cdd09[_0x2a81e6][_0x3ba09e(0xf1)]=_0x1cdcb5;});const _0x39c187=_0x2cdd09[_0x37bb43(0x131)](_0x1bdd89=>_0x1bdd89[_0x37bb43(0x1b7)]!=='0'&&_0x1bdd89[_0x37bb43(0x1b7)]!==''||_0x1bdd89[_0x37bb43(0xfd)]!=='0'&&_0x1bdd89['to_floorlevel']!=='');var _0x5887e2=0x0;_0x39c187[_0x37bb43(0x190)](_0x1f42e3=>{var _0x145d29=_0x37bb43;parseInt(_0x1f42e3['from_quantity'])<parseInt(_0x1f42e3[_0x145d29(0x1b7)])&&_0x5887e2++;});if(_0x5887e2!=0x0)return _0x2b592e[_0x37bb43(0x19f)](_0x37bb43(0x172),_0x37bb43(0x161)),_0x4f4a58[_0x37bb43(0x134)](_0x37bb43(0xf5));const _0xb9cb7b=new transfers_finished({'date':_0x185905,'from_warehouse':_0x4b2243,'to_warehouse':_0x4ad262,'product':_0x39c187,'note':_0x2b923b,'invoice':_0x527064}),_0x32042f=await _0xb9cb7b['save']();_0x2b592e[_0x37bb43(0x19f)]('success',_0x37bb43(0x179)),_0x4f4a58[_0x37bb43(0x134)](_0x37bb43(0x178)+_0x32042f[_0x37bb43(0x118)]);}catch(_0x58f9fe){console[_0x37bb43(0x1be)](_0x58f9fe),_0x4f4a58['status'](0xc8)[_0x37bb43(0xf9)]({'errorMessage':_0x58f9fe['message']});}}),router[a0_0x5e7e3a(0x116)]('/preview/:id',auth,async(_0x494d34,_0x45ed00)=>{var _0xdeaf8a=a0_0x5e7e3a;try{const {username:_0x397092,email:_0x37a7f8,role:_0x46fa3a}=_0x494d34[_0xdeaf8a(0x139)],_0x672c79=_0x494d34[_0xdeaf8a(0x139)],_0x19b0a1=await profile[_0xdeaf8a(0x180)]({'email':_0x672c79[_0xdeaf8a(0x1b9)]}),_0xfb6013=await master_shop[_0xdeaf8a(0x10d)](),_0x5e9658=await transfers_finished[_0xdeaf8a(0x1ac)](_0x494d34['params']['id']);let _0x40f8ee;if(_0x672c79[_0xdeaf8a(0x17b)]==_0xdeaf8a(0x18d)){const _0x423647=await staff[_0xdeaf8a(0x180)]({'email':_0x672c79[_0xdeaf8a(0x1b9)]});_0x40f8ee=await warehouse[_0xdeaf8a(0x10d)]({'status':_0xdeaf8a(0x1ba),'name':_0x423647['warehouse'],'warehouse_category':_0xdeaf8a(0x142)});}else _0x40f8ee=await warehouse[_0xdeaf8a(0x10d)]({'status':'Enabled','warehouse_category':_0xdeaf8a(0x142)});const _0x373af9=await warehouse[_0xdeaf8a(0x15c)]([{'$match':{'name':_0x5e9658[_0xdeaf8a(0x1c0)],'warehouse_category':_0xdeaf8a(0x142)}},{'$unwind':'$product_details'},{'$group':{'_id':_0xdeaf8a(0x18b),'name':{'$first':_0xdeaf8a(0x125)},'product_stock':{'$first':_0xdeaf8a(0x176)},'bay':{'$first':_0xdeaf8a(0x1d1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xdeaf8a(0x1a0)},'floorlevel':{'$first':_0xdeaf8a(0x123)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xdeaf8a(0x115)},'product_code':{'$first':_0xdeaf8a(0x11a)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xdeaf8a(0x1b4)},'expiry_date':{'$first':_0xdeaf8a(0x1b5)},'production_date':{'$first':_0xdeaf8a(0x17d)},'room':{'$first':'$room'},'warehoue_name':{'$first':_0xdeaf8a(0x17c)}}}]),_0x34aa34=await product[_0xdeaf8a(0x10d)]({});if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x15f)){var _0x42d0e4=users[_0xdeaf8a(0x15e)];console[_0xdeaf8a(0x1be)](_0x42d0e4);}else{if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x153))var _0x42d0e4=users['Hindi'];else{if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x1d2))var _0x42d0e4=users[_0xdeaf8a(0x1d2)];else{if(_0xfb6013[0x0]['language']=='Spanish')var _0x42d0e4=users[_0xdeaf8a(0x177)];else{if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x105))var _0x42d0e4=users[_0xdeaf8a(0x105)];else{if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x137))var _0x42d0e4=users['Portuguese'];else{if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x110))var _0x42d0e4=users[_0xdeaf8a(0x110)];else{if(_0xfb6013[0x0][_0xdeaf8a(0x168)]==_0xdeaf8a(0x138))var _0x42d0e4=users[_0xdeaf8a(0x19b)];}}}}}}}_0x45ed00['render'](_0xdeaf8a(0x1b3),{'success':_0x494d34[_0xdeaf8a(0x19f)](_0xdeaf8a(0x16c)),'errors':_0x494d34[_0xdeaf8a(0x19f)]('errors'),'role':_0x672c79,'profile':_0x19b0a1,'master_shop':_0xfb6013,'warehouse':_0x40f8ee,'transfer':_0x5e9658,'stock':_0x373af9,'unit':_0x34aa34,'language':_0x42d0e4});}catch(_0x10ed39){console[_0xdeaf8a(0x1be)](_0x10ed39);}}),router[a0_0x5e7e3a(0x160)](a0_0x5e7e3a(0x14d),auth,async(_0x52d792,_0x4b923f)=>{var _0x49544f=a0_0x5e7e3a;try{const {invoice:_0x19973b,from_warehouse:_0x1a7a71,FromRoom_name:_0x56aed8,to_warehouse:_0x2a0666,ToRoom_name:_0x4df3c2}=_0x52d792['body'],_0x41aef8=await transfers_finished['findById'](_0x52d792[_0x49544f(0x192)]['id']),_0x261bb7=_0x41aef8[_0x49544f(0x127)][_0x49544f(0xf8)](async _0x11fb20=>{var _0x48cb27=_0x49544f;if(_0x11fb20[_0x48cb27(0x1b7)]>0x0){var _0x2ee6d3=await warehouse[_0x48cb27(0x180)]({'name':_0x1a7a71,'room':_0x11fb20[_0x48cb27(0x16b)],'warehouse_category':_0x48cb27(0x142)});const _0x2efc25=_0x2ee6d3[_0x48cb27(0x13b)]['map'](_0x183dea=>{var _0x45e363=_0x48cb27;_0x183dea[_0x45e363(0x19d)]==_0x11fb20[_0x45e363(0x19d)]&&_0x183dea[_0x45e363(0x1cc)]==_0x11fb20['from_bay']&&_0x183dea[_0x45e363(0x140)]==_0x11fb20[_0x45e363(0x140)]&&_0x183dea[_0x45e363(0x186)]==_0x11fb20[_0x45e363(0x186)]&&_0x183dea[_0x45e363(0x159)]==_0x11fb20[_0x45e363(0x159)]&&_0x183dea[_0x45e363(0x13f)]==_0x11fb20[_0x45e363(0x1b1)]&&(console[_0x45e363(0x1be)](_0x45e363(0x15d),_0x183dea[_0x45e363(0x102)]),typeof _0x11fb20[_0x45e363(0x154)]==_0x45e363(0x1ce)?_0x183dea[_0x45e363(0x102)]=Math[_0x45e363(0x144)](0x0,Math['abs'](_0x183dea[_0x45e363(0x102)])-Math[_0x45e363(0x103)](_0x11fb20[_0x45e363(0x1b7)])):_0x183dea[_0x45e363(0x102)]=Math[_0x45e363(0x144)](0x0,Math['abs'](_0x183dea[_0x45e363(0x102)])-Math[_0x45e363(0x103)](_0x11fb20['to_quantity'])));});}return _0x2ee6d3;});Promise[_0x49544f(0x147)](_0x261bb7)[_0x49544f(0x107)](async _0x15c248=>{var _0x29a250=_0x49544f;try{for(const _0x25ddee of _0x15c248){await _0x25ddee[_0x29a250(0x122)]();}const _0x120266=_0x41aef8[_0x29a250(0x127)][_0x29a250(0xf8)](async _0x42b5ac=>{var _0x3e2263=_0x29a250,_0x1b4f53=await warehouse[_0x3e2263(0x180)]({'name':_0x2a0666,'room':_0x42b5ac[_0x3e2263(0xf1)]});if(_0x42b5ac[_0x3e2263(0x1b7)]>0x0){var _0x1efd2e=0x0;const _0x43ad4e=_0x1b4f53[_0x3e2263(0x13b)][_0x3e2263(0xf8)](_0x27d43d=>{var _0xb18468=_0x3e2263;_0x27d43d[_0xb18468(0x19d)]==_0x42b5ac[_0xb18468(0x19d)]&&_0x27d43d[_0xb18468(0x1cc)]==_0x42b5ac[_0xb18468(0x126)]&&_0x27d43d['expiry_date']==_0x42b5ac[_0xb18468(0x140)]&&_0x27d43d[_0xb18468(0x186)]==_0x42b5ac[_0xb18468(0x186)]&&_0x27d43d['batch_code']==_0x42b5ac[_0xb18468(0x159)]&&_0x27d43d[_0xb18468(0x13f)]==_0x42b5ac[_0xb18468(0x14b)]&&(typeof _0x42b5ac['id_transaction']==_0xb18468(0x1ce)?(console[_0xb18468(0x1be)](_0xb18468(0x165),_0x27d43d['product_stock']+_0xb18468(0x1d6)+_0x27d43d[_0xb18468(0x118)]+_0xb18468(0x117)+Math[_0xb18468(0x103)](_0x27d43d[_0xb18468(0x102)])+Math[_0xb18468(0x103)](_0x42b5ac['to_quantity'])),_0x27d43d[_0xb18468(0x102)]=Math[_0xb18468(0x103)](_0x27d43d['product_stock'])+Math['abs'](_0x42b5ac[_0xb18468(0x1b7)])):_0x27d43d[_0xb18468(0x102)]=Math[_0xb18468(0x103)](_0x27d43d[_0xb18468(0x102)])+Math[_0xb18468(0x103)](_0x42b5ac[_0xb18468(0x1b7)]),_0x1efd2e++);});_0x1efd2e=='0'&&(_0x1b4f53['product_details']=_0x1b4f53[_0x3e2263(0x13b)][_0x3e2263(0x12b)]({'product_name':_0x42b5ac[_0x3e2263(0x19d)],'product_stock':_0x42b5ac[_0x3e2263(0x1b7)],'bay':_0x42b5ac[_0x3e2263(0x126)],'product_code':_0x42b5ac[_0x3e2263(0x188)],'primary_code':_0x42b5ac[_0x3e2263(0x1cf)],'secondary_code':_0x42b5ac[_0x3e2263(0x136)],'expiry_date':_0x42b5ac[_0x3e2263(0x140)],'production_date':_0x42b5ac[_0x3e2263(0x186)],'maxProducts':_0x42b5ac[_0x3e2263(0x1d3)],'batch_code':_0x42b5ac[_0x3e2263(0x159)],'secondary_unit':_0x42b5ac[_0x3e2263(0xfb)],'unit':_0x42b5ac[_0x3e2263(0x1ae)],'maxProducts':_0x42b5ac['maxProducts'],'maxPerUnit':_0x42b5ac['maxPerUnit'],'invoice':_0x42b5ac['To_invoice']}));}return _0x1b4f53;});Promise[_0x29a250(0x147)](_0x120266)[_0x29a250(0x107)](async _0x2446a4=>{var _0x579683=_0x29a250;try{for(const _0x209be3 of _0x2446a4){await warehouse[_0x579683(0x1d4)]({'_id':_0x209be3[_0x579683(0x118)]},{'$addToSet':{'product_details':{'$each':_0x209be3[_0x579683(0x13b)]}}});}_0x41aef8['finalize']=_0x579683(0x124);const _0x45034f=await _0x41aef8[_0x579683(0x122)](),_0x50cbad=await master_shop[_0x579683(0x10d)](),_0xc4d936=await email_settings[_0x579683(0x180)](),_0x15d7a1=await supervisor_settings[_0x579683(0x10d)]();var _0x5b9f31=_0x41aef8['product'],_0x67ce0c='',_0x3774df;for(_0x3774df in _0x5b9f31){var _0x3cf7f5='FG';_0x41aef8['to_warehouse']==_0x579683(0x175)&&(_0x3cf7f5='DG'),_0x67ce0c+=_0x579683(0x16a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b9f31[_0x3774df][_0x579683(0x19d)]+'</td>'+_0x579683(0x1c5)+_0x5b9f31[_0x3774df][_0x579683(0x188)]+'</td>'+_0x579683(0x1c5)+_0x5b9f31[_0x3774df][_0x579683(0x1b7)]+_0x579683(0x16e)+_0x579683(0x1c5)+_0x5b9f31[_0x3774df][_0x579683(0x1ae)]+'</td>'+_0x579683(0x1c5)+_0x5b9f31[_0x3774df][_0x579683(0xfb)]+_0x579683(0x16e)+_0x579683(0x1c5)+_0x41aef8[_0x579683(0x1b2)]+_0x579683(0x16e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b9f31[_0x3774df][_0x579683(0xf1)]+_0x579683(0x16e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3cf7f5+_0x5b9f31[_0x3774df]['to_bay']+_0x579683(0x16e)+_0x579683(0x120);}let _0x452e93=nodemailer[_0x579683(0x193)]({'host':_0xc4d936[_0x579683(0x1c4)],'port':Number(_0xc4d936[_0x579683(0x135)]),'secure':![],'auth':{'user':_0xc4d936['email'],'pass':_0xc4d936[_0x579683(0x1a3)]}}),_0x50f116={'from':_0xc4d936[_0x579683(0x1b9)],'to':_0x15d7a1[0x0][_0x579683(0x1d8)],'subject':_0x579683(0x169),'attachments':[{'filename':_0x579683(0x162),'path':__dirname+_0x579683(0x18c)+_0x579683(0x166)+_0x50cbad[0x0][_0x579683(0x191)],'cid':_0x579683(0x194)}],'html':_0x579683(0x195)+_0x579683(0xfa)+'</head><body>'+_0x579683(0x1a2)+_0x579683(0x17a)+'<div>'+_0x579683(0x1bf)+'</div>'+'<div>'+_0x579683(0xf7)+_0x50cbad[0x0]['site_title']+'\x20</h2>'+_0x579683(0x14a)+_0x579683(0x14a)+_0x579683(0x17e)+'<div>'+_0x579683(0x11d)+'\x20Order\x20Number\x20:\x20'+_0x41aef8['invoice']+'\x20'+_0x579683(0x164)+_0x579683(0x12d)+_0x41aef8['date']+'\x20'+_0x579683(0x11f)+_0x579683(0x1aa)+_0x579683(0x14a)+_0x579683(0x1c8)+_0x579683(0x1c7)+_0x579683(0x16a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x579683(0x1c3)+_0x579683(0x12a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x579683(0x185)+_0x579683(0xff)+_0x579683(0x120)+'</thead>'+_0x579683(0x128)+'\x20'+_0x67ce0c+'\x20'+_0x579683(0x156)+_0x579683(0x1c6)+_0x579683(0x1a2)+_0x579683(0x1bc)+_0x579683(0x106)+_0x50cbad[0x0][_0x579683(0xf3)]+'</h5>'+'</div>'+'</div>'+_0x579683(0x1d5)};_0x452e93[_0x579683(0x13c)](_0x50f116,function(_0x1607d0,_0x47cbe2){var _0xae1589=_0x579683;_0x1607d0?(console[_0xae1589(0x1be)](_0x1607d0),console[_0xae1589(0x1be)](_0xae1589(0x1af))):console[_0xae1589(0x1be)]('Email\x20sent\x20successfully');}),_0x52d792['flash'](_0x579683(0x16c),_0x579683(0x189)),_0x4b923f[_0x579683(0x134)]('/picking_list/PDF_transfer/'+_0x45034f[_0x579683(0x118)]);}catch(_0x257cba){console['error'](_0x257cba),_0x4b923f[_0x579683(0x1c2)](0x1f4)['json']({'error':_0x579683(0x158)});}})['catch'](_0x45ffa4=>{var _0x1a49d9=_0x29a250;console[_0x1a49d9(0x108)](_0x45ffa4),_0x4b923f['status'](0x1f4)[_0x1a49d9(0xf9)]({'error':_0x1a49d9(0x1ad)});});}catch(_0xf456bb){console[_0x29a250(0x108)](_0xf456bb),_0x4b923f[_0x29a250(0x1c2)](0x1f4)[_0x29a250(0xf9)]({'error':_0x29a250(0x170)});}})[_0x49544f(0x1cd)](_0x440b31=>{var _0x11a5a5=_0x49544f;console[_0x11a5a5(0x108)](_0x440b31),_0x4b923f[_0x11a5a5(0x1c2)](0x1f4)[_0x11a5a5(0xf9)]({'error':'An\x20error\x20occurred.'});});}catch(_0x18f4de){_0x4b923f[_0x49544f(0xf9)]({'message':_0x18f4de[_0x49544f(0x15b)]});}});function BayBinSelected(_0x40d4d3,_0x25985d){var _0x267c25=a0_0x5e7e3a,_0x3505d5=[];let _0x4aeefe=[];var _0x3c75f3=[];if(_0x40d4d3==_0x267c25(0x175)){switch(_0x25985d){case _0x267c25(0x109):_0x3505d5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x3505d5=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3c75f3=['DG'];}else{if(_0x40d4d3==_0x267c25(0x145)){switch(_0x25985d){case _0x267c25(0x109):_0x3505d5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x3505d5=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3c75f3=['FG'];}}return{'levels':_0x3505d5,'identify':_0x3c75f3};}router[a0_0x5e7e3a(0x116)](a0_0x5e7e3a(0x113),auth,async(_0x2d27ef,_0x678c5c)=>{var _0x2bbaf2=a0_0x5e7e3a;try{const {username:_0x1d58ea,email:_0x309130,role:_0x852774}=_0x2d27ef['user'],_0x3a1884=_0x2d27ef[_0x2bbaf2(0x139)],_0x439c57=await profile[_0x2bbaf2(0x180)]({'email':_0x3a1884[_0x2bbaf2(0x1b9)]}),_0x3d7a73=await master_shop['find'](),_0x1e16c9=await transfers_finished[_0x2bbaf2(0x1ac)](_0x2d27ef['params']['id']);let _0x5952f6=new Date(_0x1e16c9['expiry_date']),_0x50d9a5=('0'+_0x5952f6['getDate']())['slice'](-0x2),_0x591318=('0'+(_0x5952f6[_0x2bbaf2(0x12c)]()+0x1))[_0x2bbaf2(0x1ab)](-0x2),_0x94c54c=_0x5952f6[_0x2bbaf2(0x1c9)](),_0x469a18=_0x94c54c+'-'+_0x591318+'-'+_0x50d9a5,_0x5b4c0f;if(_0x3a1884[_0x2bbaf2(0x17b)]=='staff'){const _0x172882=await staff['findOne']({'email':_0x3a1884[_0x2bbaf2(0x1b9)]});_0x5b4c0f=await warehouse['find']({'status':'Enabled','name':_0x172882[_0x2bbaf2(0x13e)],'warehouse_category':_0x2bbaf2(0x142)});}else _0x5b4c0f=await warehouse[_0x2bbaf2(0x10d)]({'status':_0x2bbaf2(0x1ba),'warehouse_category':_0x2bbaf2(0x142)});const _0x21d13e=await warehouse[_0x2bbaf2(0x15c)]([{'$match':{'name':_0x1e16c9[_0x2bbaf2(0x1c0)],'room':_0x1e16c9[_0x2bbaf2(0x112)]}},{'$unwind':_0x2bbaf2(0x17f)},{'$group':{'_id':_0x2bbaf2(0x18b),'name':{'$first':_0x2bbaf2(0x125)},'product_stock':{'$first':_0x2bbaf2(0x176)},'bay':{'$first':_0x2bbaf2(0x1d1)},'bin':{'$first':_0x2bbaf2(0x19a)},'type':{'$first':_0x2bbaf2(0x1a0)},'floorlevel':{'$first':_0x2bbaf2(0x123)},'primary_code':{'$first':_0x2bbaf2(0x1d7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2bbaf2(0x11a)},'storage':{'$first':_0x2bbaf2(0x13a)},'rack':{'$first':_0x2bbaf2(0x1b4)}}}]);var _0x1b6032=[0x1,0x2,0x3,0x4],_0x34b6c1=['A','B','C','D','E','F','G','H','I','J'],_0x447b2e=['Ambient',_0x2bbaf2(0x182)];const _0x35e026=await product[_0x2bbaf2(0x10d)]({}),_0x2806c4=BayBinSelected(_0x1e16c9[_0x2bbaf2(0x1b2)],_0x1e16c9['to_room']);if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]==_0x2bbaf2(0x15f)){var _0x1b5fbe=users[_0x2bbaf2(0x15e)];console[_0x2bbaf2(0x1be)](_0x1b5fbe);}else{if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]==_0x2bbaf2(0x153))var _0x1b5fbe=users[_0x2bbaf2(0x153)];else{if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]==_0x2bbaf2(0x1d2))var _0x1b5fbe=users[_0x2bbaf2(0x1d2)];else{if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]==_0x2bbaf2(0x177))var _0x1b5fbe=users[_0x2bbaf2(0x177)];else{if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]=='French')var _0x1b5fbe=users[_0x2bbaf2(0x105)];else{if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]=='Portuguese\x20(BR)')var _0x1b5fbe=users['Portuguese'];else{if(_0x3d7a73[0x0][_0x2bbaf2(0x168)]=='Chinese')var _0x1b5fbe=users['Chinese'];else{if(_0x3d7a73[0x0]['language']=='Arabic\x20(ae)')var _0x1b5fbe=users['Arabic'];}}}}}}}_0x678c5c[_0x2bbaf2(0x163)]('edit_transfer_finished',{'success':_0x2d27ef[_0x2bbaf2(0x19f)](_0x2bbaf2(0x16c)),'errors':_0x2d27ef[_0x2bbaf2(0x19f)]('errors'),'role':_0x3a1884,'profile':_0x439c57,'master_shop':_0x3d7a73,'warehouse':_0x5b4c0f,'transfer':_0x1e16c9,'stock':_0x21d13e,'unit':_0x35e026,'language':_0x1b5fbe,'levels':_0x1b6032,'Isle':_0x34b6c1,'rooms_data':_0x447b2e,'ed_fullDate':_0x469a18,'dataSelected':_0x2806c4});}catch(_0x1a5393){console[_0x2bbaf2(0x1be)](_0x1a5393);}}),router[a0_0x5e7e3a(0x160)](a0_0x5e7e3a(0x113),auth,async(_0xad497c,_0x57ee22)=>{var _0x25f44a=a0_0x5e7e3a;try{const _0x58d615=_0xad497c[_0x25f44a(0x192)]['id'];console[_0x25f44a(0x1be)](_0xad497c[_0x25f44a(0x1b6)]);const _0x7c16dd=await transfers_finished['findById'](_0x58d615);console[_0x25f44a(0x1be)](_0x25f44a(0x1c1),_0x7c16dd);const {date:_0x3e77aa,from_warehouse:_0x3adc96,FromRoom_name:_0x3eb98d,to_warehouse:_0x23608a,ToRoom_name:_0x3ac5e7,prod_name:_0x2d2e02,from_prod_qty:_0x5b9b07,from_prod_level:_0xceaa52,from_prod_isle:_0x146dbb,from_prod_pallet:_0x44dd1f,to_prod_qty:_0x2c4df7,to_prod_level:_0x160965,to_prod_isle:_0x5864d5,to_prod_pallet:_0x4115f4,primary_code:_0x32ed22,secondary_code:_0x4ddcca,product_code3:_0xeb3894,note:_0x1a5a73,invoice:_0x3dd614,expiry_date:_0x5a2bb1}=_0xad497c['body'];if(typeof _0x2d2e02==_0x25f44a(0x14e))var _0x2f4fbb=[_0xad497c['body']['prod_name']],_0x3ad84c=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x187)]],_0xf218b2=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x15a)]],_0x36efbf=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x1d0)]],_0x464206=[_0xad497c['body'][_0x25f44a(0x101)]],_0x1a415b=[_0xad497c[_0x25f44a(0x1b6)]['primary_code']],_0x1381f6=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x136)]],_0x42d95c=[_0xad497c['body'][_0x25f44a(0x19c)]],_0x562fdc=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x11b)]],_0x2257fc=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x1ae)]],_0x5365d6=[_0xad497c[_0x25f44a(0x1b6)]['secondary_unit']],_0x17ed59=[_0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x159)]],_0x31549c=[_0xad497c[_0x25f44a(0x1b6)]['expiry_date']];else var _0x2f4fbb=[..._0xad497c['body'][_0x25f44a(0x151)]],_0x3ad84c=[..._0xad497c['body'][_0x25f44a(0x187)]],_0xf218b2=[..._0xad497c[_0x25f44a(0x1b6)]['from_prod_level']],_0x36efbf=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x1d0)]],_0x464206=[..._0xad497c[_0x25f44a(0x1b6)]['to_prod_level']],_0x1a415b=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x1cf)]],_0x1381f6=[..._0xad497c['body'][_0x25f44a(0x136)]],_0x42d95c=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x19c)]],_0x562fdc=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x11b)]],_0x2257fc=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x1ae)]],_0x5365d6=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0xfb)]],_0x17ed59=[..._0xad497c[_0x25f44a(0x1b6)][_0x25f44a(0x159)]],_0x31549c=[..._0xad497c[_0x25f44a(0x1b6)]['expiry_date']];const _0x577060=_0x2f4fbb['map'](_0x4f3229=>{return _0x4f3229={'product_name':_0x4f3229};});_0x3ad84c[_0x25f44a(0x190)]((_0x529581,_0x349bf5)=>{_0x577060[_0x349bf5]['from_quantity']=_0x529581;}),_0xf218b2[_0x25f44a(0x190)]((_0x5779c6,_0x17c901)=>{_0x577060[_0x17c901]['from_bay']=_0x5779c6;}),_0x36efbf['forEach']((_0x3a2ac2,_0x48f0da)=>{var _0x18840a=_0x25f44a;_0x577060[_0x48f0da][_0x18840a(0x1b7)]=_0x3a2ac2;}),_0x464206['forEach']((_0x1c40fb,_0x28aff5)=>{_0x577060[_0x28aff5]['to_bay']=_0x1c40fb;}),_0x1a415b[_0x25f44a(0x190)]((_0xb2d0bb,_0x5f3f20)=>{var _0x4b2be4=_0x25f44a;_0x577060[_0x5f3f20][_0x4b2be4(0x1cf)]=_0xb2d0bb;}),_0x1381f6[_0x25f44a(0x190)]((_0x5e3d46,_0xc31cd)=>{var _0x3f2c31=_0x25f44a;_0x577060[_0xc31cd][_0x3f2c31(0x136)]=_0x5e3d46;}),_0x42d95c[_0x25f44a(0x190)]((_0x3730ac,_0x45578f)=>{_0x577060[_0x45578f]['product_code']=_0x3730ac;}),_0x562fdc[_0x25f44a(0x190)]((_0x1b653f,_0x57c8e0)=>{var _0x1a9d10=_0x25f44a;_0x577060[_0x57c8e0][_0x1a9d10(0x1d3)]=_0x1b653f;}),_0x2257fc[_0x25f44a(0x190)]((_0xc6f463,_0x116168)=>{var _0x24dcdb=_0x25f44a;_0x577060[_0x116168][_0x24dcdb(0x1ae)]=_0xc6f463;}),_0x5365d6[_0x25f44a(0x190)]((_0x26cf97,_0x333080)=>{var _0x5849bb=_0x25f44a;_0x577060[_0x333080][_0x5849bb(0xfb)]=_0x26cf97;}),_0x17ed59['forEach']((_0x1322d5,_0x33f825)=>{_0x577060[_0x33f825]['batch_code']=_0x1322d5;}),_0x31549c[_0x25f44a(0x190)]((_0x390f57,_0x40696e)=>{var _0x35ae1a=_0x25f44a;_0x577060[_0x40696e][_0x35ae1a(0x140)]=_0x390f57;});const _0x316b87=_0x577060[_0x25f44a(0x131)](_0x476669=>_0x476669[_0x25f44a(0x1b7)]!=='0'&&_0x476669['to_quantity']!==''||_0x476669['to_floorlevel']!=='0'&&_0x476669[_0x25f44a(0xfd)]!=='');var _0x2d3bdb=0x0;_0x316b87[_0x25f44a(0x190)](_0x5e6e69=>{var _0x972fef=_0x25f44a;parseInt(_0x5e6e69[_0x972fef(0x171)])<parseInt(_0x5e6e69[_0x972fef(0x1b7)])&&_0x2d3bdb++;});if(_0x2d3bdb!=0x0)return _0xad497c[_0x25f44a(0x19f)](_0x25f44a(0x172),_0x25f44a(0x161)),_0x57ee22[_0x25f44a(0x134)](_0x25f44a(0xf5));const _0x31af08=await warehouse[_0x25f44a(0x180)]({'name':_0x7c16dd[_0x25f44a(0x1c0)],'room':_0x7c16dd[_0x25f44a(0x112)]});_0x7c16dd[_0x25f44a(0x127)]['forEach'](_0x1ef4f3=>{var _0x515c97=_0x25f44a;if(_0x1ef4f3['to_quantity']>0x0){const _0x1ceef0=_0x31af08[_0x515c97(0x13b)][_0x515c97(0xf8)](_0x161f8f=>{var _0x4d4a4d=_0x515c97;_0x161f8f[_0x4d4a4d(0x19d)]==_0x1ef4f3['product_name']&&_0x161f8f['bay']==_0x1ef4f3[_0x4d4a4d(0x100)]&&(_0x161f8f[_0x4d4a4d(0x102)]=parseInt(_0x161f8f[_0x4d4a4d(0x102)])+parseInt(_0x1ef4f3[_0x4d4a4d(0x1b7)]));});}}),await _0x31af08[_0x25f44a(0x122)]();const _0x5a4673=await warehouse[_0x25f44a(0x180)]({'name':_0x7c16dd[_0x25f44a(0x1b2)],'room':_0x7c16dd[_0x25f44a(0x1b0)]});_0x7c16dd[_0x25f44a(0x127)][_0x25f44a(0x190)](_0x567266=>{var _0x585834=_0x25f44a;if(_0x567266[_0x585834(0x1b7)]>0x0){const _0x4552d0=_0x5a4673[_0x585834(0x13b)][_0x585834(0xf8)](_0x48b8bb=>{var _0x1acfee=_0x585834;_0x48b8bb[_0x1acfee(0x19d)]==_0x567266[_0x1acfee(0x19d)]&&_0x48b8bb[_0x1acfee(0x1cc)]==_0x567266[_0x1acfee(0x126)]&&(_0x48b8bb[_0x1acfee(0x102)]=parseInt(_0x48b8bb['product_stock'])-parseInt(_0x567266[_0x1acfee(0x1b7)]));});}}),await _0x5a4673['save'](),_0x7c16dd['date']=_0x3e77aa,_0x7c16dd['from_warehouse']=_0x3adc96,_0x7c16dd['to_warehouse']=_0x23608a,_0x7c16dd[_0x25f44a(0x127)]=_0x316b87,_0x7c16dd[_0x25f44a(0x1a7)]=_0x1a5a73,_0x7c16dd[_0x25f44a(0x13f)]=_0x3dd614;const _0x6a053f=await _0x7c16dd[_0x25f44a(0x122)](),_0x506e23=await warehouse[_0x25f44a(0x180)]({'name':_0x3adc96,'room':_0x3eb98d});_0x6a053f[_0x25f44a(0x127)]['forEach'](_0xddac53=>{var _0x5732b4=_0x25f44a;if(_0xddac53[_0x5732b4(0x1b7)]>0x0){const _0x39457c=_0x506e23[_0x5732b4(0x13b)]['map'](_0x449d53=>{var _0x548111=_0x5732b4;_0x449d53['product_name']==_0xddac53[_0x548111(0x19d)]&&_0x449d53['bay']==_0xddac53[_0x548111(0x100)]&&(_0x449d53['product_stock']=parseInt(_0x449d53[_0x548111(0x102)])-parseInt(_0xddac53[_0x548111(0x1b7)]));});}}),await _0x506e23[_0x25f44a(0x122)]();const _0x35d753=await warehouse['findOne']({'name':_0x23608a,'room':_0x3ac5e7});_0x6a053f[_0x25f44a(0x127)][_0x25f44a(0x190)](_0x41b061=>{var _0x257e21=_0x25f44a;if(_0x41b061['to_quantity']>0x0){var _0x5a10b8=0x0;const _0x40d595=_0x35d753[_0x257e21(0x13b)][_0x257e21(0xf8)](_0x2b0573=>{var _0x2b713a=_0x257e21;_0x2b0573[_0x2b713a(0x19d)]==_0x41b061[_0x2b713a(0x19d)]&&_0x2b0573['bay']==_0x41b061[_0x2b713a(0x126)]&&(_0x2b0573[_0x2b713a(0x102)]=parseInt(_0x2b0573['product_stock'])+parseInt(_0x41b061[_0x2b713a(0x1b7)]),_0x5a10b8++);});_0x5a10b8=='0'&&(_0x35d753['product_details']=_0x35d753[_0x257e21(0x13b)][_0x257e21(0x12b)]({'product_name':_0x41b061['product_name'],'product_stock':_0x41b061[_0x257e21(0x1b7)],'bay':_0x41b061[_0x257e21(0x126)],'product_code':_0x41b061[_0x257e21(0x188)],'primary_code':_0x41b061[_0x257e21(0x1cf)],'secondary_code':_0x41b061['secondary_code'],'maxProducts':_0x41b061['maxProducts']}));}}),await _0x35d753['save'](),_0xad497c[_0x25f44a(0x19f)](_0x25f44a(0x16c),'Transfer\x20Edit\x20Successfully'),_0x57ee22[_0x25f44a(0x134)](_0x25f44a(0x150));}catch(_0x201ed8){console[_0x25f44a(0x1be)](_0x201ed8);}}),router[a0_0x5e7e3a(0x160)](a0_0x5e7e3a(0x18e),async(_0x156f0f,_0x4d014b)=>{var _0x27ea7f=a0_0x5e7e3a;const {FromWareHouse:_0x456ced,FromRoom:_0x2c2259,ToWarehouse:_0x29010e,ToRoom:_0x44237c,primary_code:_0x2a0c4f,Roomslist:_0x19a97}=_0x156f0f[_0x27ea7f(0x1b6)],_0x465e0f=_0x19a97[_0x27ea7f(0x121)](','),_0x3f9e4d=[];async function _0x1539ec(_0x478d76){var _0x160005=_0x27ea7f;const _0x532fef=await warehouse['aggregate']([{'$match':{'name':_0x456ced,'room':_0x478d76}},{'$unwind':_0x160005(0x17f)},{'$match':{'product_details.primary_code':_0x2a0c4f}},{'$group':{'_id':_0x160005(0x18b),'name':{'$first':_0x160005(0x125)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x160005(0x115)},'product_code':{'$first':_0x160005(0x11a)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x160005(0x1a0)},'pallet':{'$first':_0x160005(0x123)},'unit':{'$first':_0x160005(0x10c)},'secondary_unit':{'$first':_0x160005(0x155)},'storage':{'$first':_0x160005(0x13a)},'rack':{'$first':_0x160005(0x1b4)},'expiry_date':{'$first':_0x160005(0x1b5)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x160005(0x14f)},'maxPerUnit':{'$first':_0x160005(0x130)},'roomNamed':{'$first':_0x160005(0xf6)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0xae7382=await warehouse[_0x160005(0x15c)]([{'$match':{'name':_0x456ced,'room':_0x478d76}},{'$unwind':_0x160005(0x17f)},{'$match':{'product_details.secondary_code':_0x2a0c4f}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x160005(0x125)},'instock':{'$first':_0x160005(0x176)},'primary_code':{'$first':_0x160005(0x1d7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x160005(0x11a)},'level':{'$first':_0x160005(0x1d1)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x160005(0x1a0)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x160005(0x10c)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x160005(0x13a)},'rack':{'$first':_0x160005(0x1b4)},'expiry_date':{'$first':_0x160005(0x1b5)},'production_date':{'$first':_0x160005(0x17d)},'batch_code':{'$first':_0x160005(0x14f)},'maxPerUnit':{'$first':_0x160005(0x130)},'roomNamed':{'$first':_0x160005(0xf6)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x160005(0x1bb)}}}]);if(_0x532fef['length']>0x0)_0x3f9e4d['push'](_0x532fef);else _0xae7382[_0x160005(0x16f)]>0x0&&_0x3f9e4d['push'](_0xae7382);}const _0x386f65=_0x465e0f[_0x27ea7f(0xf8)](_0x25e985=>_0x1539ec(_0x25e985));await Promise[_0x27ea7f(0x147)](_0x386f65),_0x4d014b['json'](_0x3f9e4d);}),router[a0_0x5e7e3a(0x160)](a0_0x5e7e3a(0x10b),async(_0x3d1090,_0x21fae7)=>{var _0x525913=a0_0x5e7e3a;try{const {FromWareHouse:_0xdeeb69,FromRoom:_0x5865b8,ToWarehouse:_0x1ffae3,ToRoom:_0x1a36e3,secondary_code:_0x362cf7}=_0x3d1090[_0x525913(0x1b6)],_0x1d86ba=await warehouse[_0x525913(0x15c)]([{'$match':{'name':_0xdeeb69}},{'$unwind':_0x525913(0x17f)},{'$match':{'product_details.secondary_code':_0x362cf7}},{'$group':{'_id':_0x525913(0x18b),'name':{'$first':_0x525913(0x125)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x525913(0x115)},'product_code':{'$first':_0x525913(0x11a)},'instock':{'$first':_0x525913(0x176)},'warehouse':{'$first':'$name'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x525913(0x19e)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x525913(0xf4)},'unit':{'$first':_0x525913(0x10c)},'expiry_date':{'$first':_0x525913(0x1b5)},'production_date':{'$first':_0x525913(0x17d)}}}]);_0x21fae7['status'](0xc8)[_0x525913(0xf9)](_0x1d86ba);}catch(_0x49b10c){_0x21fae7[_0x525913(0x1c2)](0x194)[_0x525913(0xf9)]({'message':_0x49b10c[_0x525913(0x15b)]});}}),router['post'](a0_0x5e7e3a(0x114),async(_0x4227b3,_0x3a333e)=>{var _0x5ce468=a0_0x5e7e3a;try{const {FromWareHouse:_0x3a7b68,FromRoom:_0x44a48c,ToWarehouse:_0x10a0e9,ToRoom:_0x3a6c6a,product_code:_0x70c9bb}=_0x4227b3['body'],_0x57a999=await warehouse[_0x5ce468(0x15c)]([{'$match':{'name':_0x3a7b68}},{'$unwind':_0x5ce468(0x17f)},{'$match':{'product_details.product_code':_0x70c9bb}},{'$group':{'_id':_0x5ce468(0x18b),'name':{'$first':_0x5ce468(0x125)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5ce468(0x115)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x5ce468(0x176)},'warehouse':{'$first':_0x5ce468(0x17c)},'level':{'$first':_0x5ce468(0x149)},'isle':{'$first':_0x5ce468(0x19e)},'pallet':{'$first':_0x5ce468(0x14c)},'maxProducts':{'$first':_0x5ce468(0xf4)},'unit':{'$first':_0x5ce468(0x10c)}}}]);_0x3a333e[_0x5ce468(0x1c2)](0xc8)[_0x5ce468(0xf9)](_0x57a999);}catch(_0x4ffa56){_0x3a333e[_0x5ce468(0x1c2)](0x194)[_0x5ce468(0xf9)]({'message':_0x4ffa56[_0x5ce468(0x15b)]});}}),router[a0_0x5e7e3a(0x160)](a0_0x5e7e3a(0x183),async(_0x1b5124,_0x54bbff)=>{var _0x16d63c=a0_0x5e7e3a;const {productCode:_0x279874,bay:_0x2aabd1,warehouses:_0x2079fc,room:_0x1a4582}=_0x1b5124['body'];console['log'](_0x1b5124[_0x16d63c(0x1b6)]);try{const _0x2ce57b=await warehouse[_0x16d63c(0x15c)]([{'$match':{'name':_0x2079fc,'room':_0x1a4582}},{'$unwind':_0x16d63c(0x17f)},{'$match':{'product_details.bay':parseInt(_0x2aabd1)}},{'$group':{'_id':_0x16d63c(0x18b),'name':{'$first':_0x16d63c(0x125)},'product_stock':{'$first':_0x16d63c(0x176)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x16d63c(0xf4)}}}]);_0x54bbff[_0x16d63c(0x1c2)](0xc8)[_0x16d63c(0xf9)](_0x2ce57b);}catch(_0x2917e0){_0x54bbff['status'](0x194)['json']({'message':_0x2917e0['message']});}}),module[a0_0x5e7e3a(0x133)]=router;