var a0_0x55dd66=a0_0x58c6;(function(_0x147111,_0x546a69){var _0x27e0f0=a0_0x58c6,_0x2218fb=_0x147111();while(!![]){try{var _0xbc290c=-parseInt(_0x27e0f0(0x29c))/0x1*(parseInt(_0x27e0f0(0x2ae))/0x2)+parseInt(_0x27e0f0(0x2a0))/0x3*(-parseInt(_0x27e0f0(0x249))/0x4)+parseInt(_0x27e0f0(0x26b))/0x5+-parseInt(_0x27e0f0(0x25f))/0x6*(parseInt(_0x27e0f0(0x27a))/0x7)+-parseInt(_0x27e0f0(0x240))/0x8*(-parseInt(_0x27e0f0(0x280))/0x9)+parseInt(_0x27e0f0(0x203))/0xa+parseInt(_0x27e0f0(0x276))/0xb*(parseInt(_0x27e0f0(0x2b4))/0xc);if(_0xbc290c===_0x546a69)break;else _0x2218fb['push'](_0x2218fb['shift']());}catch(_0x5085ec){_0x2218fb['push'](_0x2218fb['shift']());}}}(a0_0xea43,0x9f9e0));const express=require(a0_0x55dd66(0x235)),app=express(),router=express[a0_0x55dd66(0x286)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x55dd66(0x227)),auth=require(a0_0x55dd66(0x263)),users=require(a0_0x55dd66(0x20b)),nodemailer=require(a0_0x55dd66(0x241));router[a0_0x55dd66(0x2b0)](a0_0x55dd66(0x270),auth,async(_0x45623e,_0x150b72)=>{var _0x177eb1=a0_0x55dd66;try{const {username:_0x30bf62,email:_0x41a228,role:_0x507a49}=_0x45623e[_0x177eb1(0x256)],_0x36ea8a=_0x45623e['user'],_0x18b5e4=await profile['findOne']({'email':_0x36ea8a[_0x177eb1(0x1fa)]}),_0xe43125=await master_shop[_0x177eb1(0x2c0)]();let _0x2768cf;if(_0x36ea8a[_0x177eb1(0x1f9)]==_0x177eb1(0x284)){const _0x4df79a=await staff[_0x177eb1(0x209)]({'email':_0x36ea8a[_0x177eb1(0x1fa)]});_0x2768cf=await transfers_finished[_0x177eb1(0x2c0)]({'from_warehouse':_0x4df79a[_0x177eb1(0x1e6)]});}else _0x2768cf=await transfers_finished['aggregate']([{'$unwind':_0x177eb1(0x22d)},{'$group':{'_id':_0x177eb1(0x288),'invoice':{'$first':'$invoice'},'date':{'$first':_0x177eb1(0x1ff)},'from_warehouse':{'$first':_0x177eb1(0x272)},'to_warehouse':{'$first':_0x177eb1(0x28a)},'from_room_name':{'$addToSet':_0x177eb1(0x279)},'to_room_name':{'$addToSet':_0x177eb1(0x2ba)},'finalize':{'$first':_0x177eb1(0x27f)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0xe43125[0x0][_0x177eb1(0x206)]=='English\x20(US)')var _0x43617b=users[_0x177eb1(0x290)];else{if(_0xe43125[0x0][_0x177eb1(0x206)]==_0x177eb1(0x238))var _0x43617b=users['Hindi'];else{if(_0xe43125[0x0]['language']=='German')var _0x43617b=users[_0x177eb1(0x22f)];else{if(_0xe43125[0x0]['language']=='Spanish')var _0x43617b=users['Spanish'];else{if(_0xe43125[0x0][_0x177eb1(0x206)]==_0x177eb1(0x1ef))var _0x43617b=users[_0x177eb1(0x1ef)];else{if(_0xe43125[0x0][_0x177eb1(0x206)]==_0x177eb1(0x294))var _0x43617b=users[_0x177eb1(0x26e)];else{if(_0xe43125[0x0]['language']==_0x177eb1(0x230))var _0x43617b=users[_0x177eb1(0x230)];else{if(_0xe43125[0x0][_0x177eb1(0x206)]==_0x177eb1(0x262))var _0x43617b=users['Arabic'];}}}}}}}_0x150b72['render'](_0x177eb1(0x2c5),{'success':_0x45623e['flash'](_0x177eb1(0x20e)),'errors':_0x45623e[_0x177eb1(0x1fd)](_0x177eb1(0x245)),'role':_0x36ea8a,'profile':_0x18b5e4,'master_shop':_0xe43125,'transfer':_0x2768cf,'language':_0x43617b});}catch(_0x339588){console['log'](_0x339588);}});function a0_0x58c6(_0x15ce2e,_0x191422){var _0xea4329=a0_0xea43();return a0_0x58c6=function(_0x58c63a,_0x46b592){_0x58c63a=_0x58c63a-0x1e5;var _0x18513f=_0xea4329[_0x58c63a];return _0x18513f;},a0_0x58c6(_0x15ce2e,_0x191422);}async function getRandom8DigitNumber(){var _0x3a8d95=a0_0x55dd66;const _0x5e89f3=0x989680,_0x548f47=0x5f5e0ff,_0x4480de=Math[_0x3a8d95(0x202)](Math[_0x3a8d95(0x2b1)]()*(_0x548f47-_0x5e89f3+0x1))+_0x5e89f3;var _0x1fae2f;const _0x5121b3=await transfers_finished[_0x3a8d95(0x209)]({'invoice':_0x3a8d95(0x21d)+_0x4480de});return _0x5121b3&&_0x5121b3['length']>0x0?_0x1fae2f='TRFF-'+_0x4480de:_0x1fae2f=_0x3a8d95(0x21d)+_0x4480de,_0x1fae2f;}router[a0_0x55dd66(0x2b0)](a0_0x55dd66(0x2c2),auth,async(_0x11ffc1,_0x4343f0)=>{var _0xa7db30=a0_0x55dd66;try{const {username:_0x190d94,email:_0x1a0f25,role:_0x4a3ad4}=_0x11ffc1['user'],_0x1bcd59=_0x11ffc1[_0xa7db30(0x256)],_0x592db8=await profile[_0xa7db30(0x209)]({'email':_0x1bcd59['email']}),_0x17b707=await master_shop[_0xa7db30(0x2c0)]();let _0x544c32;if(_0x1bcd59[_0xa7db30(0x1f9)]==_0xa7db30(0x284)){const _0x12e901=await staff[_0xa7db30(0x209)]({'email':_0x1bcd59[_0xa7db30(0x1fa)]});_0x544c32=await warehouse[_0xa7db30(0x24f)]([{'$match':{'status':_0xa7db30(0x1f7),'name':_0x12e901['warehouse'],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0xa7db30(0x219)}}},{'$group':{'_id':_0xa7db30(0x2a2),'name':{'$first':_0xa7db30(0x2a2)}}}]);}else _0x544c32=await warehouse[_0xa7db30(0x24f)]([{'$match':{'status':'Enabled','warehouse_category':_0xa7db30(0x21a),'name':{'$ne':_0xa7db30(0x219)}}},{'$group':{'_id':_0xa7db30(0x2a2),'name':{'$first':'$name'}}}]);const _0x49a834=await transfers_finished['find']({}),_0x46ea01=_0x49a834['length']+0x1,_0x38bc9c='TRFF-'+_0x46ea01[_0xa7db30(0x2b6)]()[_0xa7db30(0x217)](0x5,'0');if(_0x17b707[0x0]['language']==_0xa7db30(0x2bb))var _0x4be405=users[_0xa7db30(0x290)];else{if(_0x17b707[0x0][_0xa7db30(0x206)]=='Hindi')var _0x4be405=users[_0xa7db30(0x238)];else{if(_0x17b707[0x0][_0xa7db30(0x206)]=='German')var _0x4be405=users['German'];else{if(_0x17b707[0x0][_0xa7db30(0x206)]==_0xa7db30(0x239))var _0x4be405=users[_0xa7db30(0x239)];else{if(_0x17b707[0x0][_0xa7db30(0x206)]=='French')var _0x4be405=users[_0xa7db30(0x1ef)];else{if(_0x17b707[0x0]['language']==_0xa7db30(0x294))var _0x4be405=users[_0xa7db30(0x26e)];else{if(_0x17b707[0x0]['language']=='Chinese')var _0x4be405=users['Chinese'];else{if(_0x17b707[0x0][_0xa7db30(0x206)]=='Arabic\x20(ae)')var _0x4be405=users[_0xa7db30(0x248)];}}}}}}}const _0x3457da=getRandom8DigitNumber();_0x3457da[_0xa7db30(0x282)](_0x4db3b3=>{var _0x661931=_0xa7db30;_0x4343f0[_0x661931(0x232)](_0x661931(0x27b),{'success':_0x11ffc1[_0x661931(0x1fd)]('success'),'errors':_0x11ffc1[_0x661931(0x1fd)](_0x661931(0x245)),'role':_0x1bcd59,'profile':_0x592db8,'master_shop':_0x17b707,'warehouse':_0x544c32,'language':_0x4be405,'invoice':_0x4db3b3});})[_0xa7db30(0x2c1)](_0x2f4a3e=>{var _0x5d5f8f=_0xa7db30;_0x11ffc1[_0x5d5f8f(0x1fd)](_0x5d5f8f(0x245),_0x5d5f8f(0x295)),_0x4343f0['redirect'](_0x5d5f8f(0x220));});}catch(_0x50f924){console[_0xa7db30(0x267)](_0x50f924);}}),router[a0_0x55dd66(0x1f0)](a0_0x55dd66(0x2c2),auth,async(_0x289d0d,_0x1da748)=>{var _0x424134=a0_0x55dd66;try{const {date:_0x414bdb,from_warehouse:_0x109a5b,FromRoom_name:_0x924181,to_warehouse:_0x8b2cf9,ToRoom_name:_0x2b325a,prod_name:_0x167fcd,from_prod_qty:_0x36b0c1,from_prod_level:_0x2fba86,from_prod_isle:_0x363f79,from_prod_pallet:_0x595981,to_prod_qty:_0x114ed2,to_prod_level:_0x288dd0,to_prod_isle:_0x402560,to_prod_pallet:_0x121934,primary_code:_0x11113b,secondary_code:_0x35a5bc,product_code3:_0x219f50,note:_0x13afe9,MaxStocks_data2:_0x236e85,invoice:_0x4d1917,expiry_date:_0x41d53d}=_0x289d0d['body'];if(typeof _0x167fcd==_0x424134(0x287))var _0x2ed0a8=[_0x289d0d['body']['prod_name']],_0x41b280=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x23a)]],_0x433f28=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x259)]],_0xf60d08=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x296)]],_0x5ac267=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x275)]],_0x185c09=[_0x289d0d[_0x424134(0x20d)]['primary_code']],_0x2378e8=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x1e9)]],_0x4699da=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x243)]],_0x4a3b15=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x260)]],_0x41c952=[_0x289d0d['body']['primary_unit']],_0x1b9888=[_0x289d0d[_0x424134(0x20d)]['secondary_unit']],_0x38a341=[_0x289d0d['body'][_0x424134(0x20c)]],_0x2ee753=[_0x289d0d[_0x424134(0x20d)]['expiry_date']],_0x50fdaf=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x1ec)]],_0x38c750=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x25a)]],_0x14e3f9=[_0x289d0d['body'][_0x424134(0x246)]],_0x1e679d=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x2ac)]],_0x3a3b7a=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x24d)]],_0x323028=[_0x289d0d[_0x424134(0x20d)]['ToRoomAssigned']],_0x1844bf=[_0x289d0d['body']['from_invoice']],_0x5a2512=[_0x289d0d[_0x424134(0x20d)][_0x424134(0x266)]];else var _0x2ed0a8=[..._0x289d0d[_0x424134(0x20d)]['prod_name']],_0x41b280=[..._0x289d0d['body'][_0x424134(0x23a)]],_0x433f28=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x259)]],_0xf60d08=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x296)]],_0x5ac267=[..._0x289d0d[_0x424134(0x20d)]['to_prod_level']],_0x185c09=[..._0x289d0d['body'][_0x424134(0x1fb)]],_0x2378e8=[..._0x289d0d[_0x424134(0x20d)]['secondary_code']],_0x4699da=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x243)]],_0x4a3b15=[..._0x289d0d[_0x424134(0x20d)]['MaxStocks_data2']],_0x41c952=[..._0x289d0d[_0x424134(0x20d)]['primary_unit']],_0x1b9888=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x298)]],_0x38a341=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x20c)]],_0x2ee753=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x2af)]],_0x50fdaf=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x1ec)]],_0x38c750=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x25a)]],_0x14e3f9=[..._0x289d0d[_0x424134(0x20d)]['maxPerUnit']],_0x1e679d=[..._0x289d0d[_0x424134(0x20d)]['prod_cat']],_0x3a3b7a=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x24d)]],_0x323028=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x23d)]],_0x1844bf=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x277)]],_0x5a2512=[..._0x289d0d[_0x424134(0x20d)][_0x424134(0x266)]];const _0x31ee01=_0x2ed0a8['map'](_0x5e1113=>{return _0x5e1113={'product_name':_0x5e1113};});_0x41b280['forEach']((_0x3175af,_0x576418)=>{var _0x529fa7=_0x424134;_0x31ee01[_0x576418][_0x529fa7(0x1ea)]=_0x3175af;}),_0x433f28[_0x424134(0x20f)]((_0x559f34,_0x294ef6)=>{_0x31ee01[_0x294ef6]['from_bay']=_0x559f34;}),_0x1844bf['forEach']((_0x908f18,_0x1c2128)=>{_0x31ee01[_0x1c2128]['from_invoice']=_0x908f18;}),_0x5a2512[_0x424134(0x20f)]((_0x44e42b,_0x495a29)=>{var _0xda42c6=_0x424134;_0x31ee01[_0x495a29][_0xda42c6(0x255)]=_0x44e42b;}),_0xf60d08['forEach']((_0x631e09,_0x1d0c42)=>{var _0x45ab72=_0x424134;_0x31ee01[_0x1d0c42][_0x45ab72(0x213)]=_0x631e09;}),_0x5ac267[_0x424134(0x20f)]((_0x431a6b,_0x3afe58)=>{_0x31ee01[_0x3afe58]['to_bay']=_0x431a6b;}),_0x185c09[_0x424134(0x20f)]((_0x4f3783,_0x26ba13)=>{_0x31ee01[_0x26ba13]['primary_code']=_0x4f3783;}),_0x2378e8[_0x424134(0x20f)]((_0x4bbdcf,_0x3c33b0)=>{var _0x3773ed=_0x424134;_0x31ee01[_0x3c33b0][_0x3773ed(0x1e9)]=_0x4bbdcf;}),_0x4699da['forEach']((_0x4f7974,_0x234c26)=>{var _0x16e299=_0x424134;_0x31ee01[_0x234c26][_0x16e299(0x29e)]=_0x4f7974;}),_0x4a3b15[_0x424134(0x20f)]((_0x399038,_0x5d851d)=>{var _0x5758c8=_0x424134;_0x31ee01[_0x5d851d][_0x5758c8(0x29a)]=_0x399038;}),_0x41c952[_0x424134(0x20f)]((_0x47b4b1,_0x1654c3)=>{var _0x1d0a8d=_0x424134;_0x31ee01[_0x1654c3][_0x1d0a8d(0x1f2)]=_0x47b4b1;}),_0x1b9888[_0x424134(0x20f)]((_0x466f55,_0x2b8d2e)=>{var _0x445aa2=_0x424134;_0x31ee01[_0x2b8d2e][_0x445aa2(0x298)]=_0x466f55;}),_0x38a341[_0x424134(0x20f)]((_0x1d95e4,_0x947eb6)=>{var _0x489f14=_0x424134;_0x31ee01[_0x947eb6][_0x489f14(0x20c)]=_0x1d95e4;}),_0x2ee753['forEach']((_0x216202,_0x50191c)=>{var _0x17fe02=_0x424134;_0x31ee01[_0x50191c][_0x17fe02(0x2af)]=_0x216202;}),_0x50fdaf[_0x424134(0x20f)]((_0x24cce7,_0xe59e37)=>{var _0x473979=_0x424134;_0x31ee01[_0xe59e37][_0x473979(0x2bc)]=_0x24cce7;}),_0x38c750[_0x424134(0x20f)]((_0x2ce90d,_0xd88fa)=>{var _0x2dd899=_0x424134;_0x31ee01[_0xd88fa][_0x2dd899(0x29a)]=_0x2ce90d;}),_0x14e3f9[_0x424134(0x20f)]((_0x3a1dbf,_0x2f2d27)=>{var _0x53c3bd=_0x424134;_0x31ee01[_0x2f2d27][_0x53c3bd(0x246)]=_0x3a1dbf;}),_0x1e679d[_0x424134(0x20f)]((_0x5517cf,_0xe97c71)=>{var _0x7e326=_0x424134;_0x31ee01[_0xe97c71][_0x7e326(0x2ac)]=_0x5517cf;}),_0x3a3b7a['forEach']((_0x3a891c,_0x25a820)=>{var _0x184832=_0x424134;_0x31ee01[_0x25a820][_0x184832(0x233)]=_0x3a891c;}),_0x323028[_0x424134(0x20f)]((_0x2e32a4,_0x4cefcc)=>{_0x31ee01[_0x4cefcc]['to_room_name']=_0x2e32a4;});const _0x3632c2=_0x31ee01[_0x424134(0x200)](_0x546b3a=>_0x546b3a[_0x424134(0x213)]!=='0'&&_0x546b3a['to_quantity']!==''||_0x546b3a[_0x424134(0x2a1)]!=='0'&&_0x546b3a[_0x424134(0x2a1)]!=='');var _0x5d55f0=0x0;_0x3632c2[_0x424134(0x20f)](_0x58d11e=>{var _0x28c07d=_0x424134;parseInt(_0x58d11e[_0x28c07d(0x1ea)])<parseInt(_0x58d11e[_0x28c07d(0x213)])&&_0x5d55f0++;});if(_0x5d55f0!=0x0)return _0x289d0d[_0x424134(0x1fd)](_0x424134(0x245),_0x424134(0x27e)),_0x1da748[_0x424134(0x237)](_0x424134(0x1e7));const _0x4853c9=new transfers_finished({'date':_0x414bdb,'from_warehouse':_0x109a5b,'to_warehouse':_0x8b2cf9,'product':_0x3632c2,'note':_0x13afe9,'invoice':_0x4d1917}),_0xcac085=await _0x4853c9[_0x424134(0x215)]();_0x289d0d[_0x424134(0x1fd)](_0x424134(0x20e),'Product\x20Transfer\x20successfully'),_0x1da748[_0x424134(0x237)](_0x424134(0x1f4)+_0xcac085[_0x424134(0x23f)]);}catch(_0x48c749){console[_0x424134(0x267)](_0x48c749),_0x1da748[_0x424134(0x2b8)](0xc8)[_0x424134(0x29d)]({'errorMessage':_0x48c749[_0x424134(0x274)]});}}),router[a0_0x55dd66(0x2b0)](a0_0x55dd66(0x254),auth,async(_0x41213e,_0x265530)=>{var _0x45f8a1=a0_0x55dd66;try{const {username:_0x2ee42e,email:_0x54c8cb,role:_0x313c7f}=_0x41213e[_0x45f8a1(0x256)],_0x200ced=_0x41213e[_0x45f8a1(0x256)],_0x13915a=await profile['findOne']({'email':_0x200ced[_0x45f8a1(0x1fa)]}),_0x2bcbff=await master_shop[_0x45f8a1(0x2c0)](),_0x5b8d8a=await transfers_finished[_0x45f8a1(0x1eb)](_0x41213e['params']['id']);let _0xf76612;if(_0x200ced[_0x45f8a1(0x1f9)]==_0x45f8a1(0x284)){const _0x288f13=await staff['findOne']({'email':_0x200ced[_0x45f8a1(0x1fa)]});_0xf76612=await warehouse[_0x45f8a1(0x2c0)]({'status':'Enabled','name':_0x288f13['warehouse'],'warehouse_category':_0x45f8a1(0x21a)});}else _0xf76612=await warehouse['find']({'status':_0x45f8a1(0x1f7),'warehouse_category':_0x45f8a1(0x21a)});const _0x464f49=await warehouse[_0x45f8a1(0x24f)]([{'$match':{'name':_0x5b8d8a['from_warehouse'],'warehouse_category':_0x45f8a1(0x21a)}},{'$unwind':_0x45f8a1(0x2b3)},{'$group':{'_id':_0x45f8a1(0x2ad),'name':{'$first':_0x45f8a1(0x271)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x45f8a1(0x253)},'bin':{'$first':_0x45f8a1(0x2ab)},'type':{'$first':_0x45f8a1(0x21e)},'floorlevel':{'$first':_0x45f8a1(0x1e8)},'primary_code':{'$first':_0x45f8a1(0x218)},'secondary_code':{'$first':_0x45f8a1(0x2a8)},'product_code':{'$first':_0x45f8a1(0x205)},'storage':{'$first':_0x45f8a1(0x261)},'rack':{'$first':_0x45f8a1(0x28e)},'expiry_date':{'$first':_0x45f8a1(0x212)},'production_date':{'$first':_0x45f8a1(0x2be)},'room':{'$first':_0x45f8a1(0x29b)},'warehoue_name':{'$first':_0x45f8a1(0x2a2)}}}]),_0x21beb9=await product[_0x45f8a1(0x2c0)]({});if(_0x2bcbff[0x0][_0x45f8a1(0x206)]==_0x45f8a1(0x2bb)){var _0x3cf088=users[_0x45f8a1(0x290)];console['log'](_0x3cf088);}else{if(_0x2bcbff[0x0][_0x45f8a1(0x206)]==_0x45f8a1(0x238))var _0x3cf088=users['Hindi'];else{if(_0x2bcbff[0x0][_0x45f8a1(0x206)]=='German')var _0x3cf088=users['German'];else{if(_0x2bcbff[0x0][_0x45f8a1(0x206)]==_0x45f8a1(0x239))var _0x3cf088=users[_0x45f8a1(0x239)];else{if(_0x2bcbff[0x0]['language']=='French')var _0x3cf088=users['French'];else{if(_0x2bcbff[0x0][_0x45f8a1(0x206)]=='Portuguese\x20(BR)')var _0x3cf088=users['Portuguese'];else{if(_0x2bcbff[0x0][_0x45f8a1(0x206)]=='Chinese')var _0x3cf088=users[_0x45f8a1(0x230)];else{if(_0x2bcbff[0x0][_0x45f8a1(0x206)]=='Arabic\x20(ae)')var _0x3cf088=users['Arabic'];}}}}}}}_0x265530[_0x45f8a1(0x232)](_0x45f8a1(0x292),{'success':_0x41213e[_0x45f8a1(0x1fd)](_0x45f8a1(0x20e)),'errors':_0x41213e[_0x45f8a1(0x1fd)](_0x45f8a1(0x245)),'role':_0x200ced,'profile':_0x13915a,'master_shop':_0x2bcbff,'warehouse':_0xf76612,'transfer':_0x5b8d8a,'stock':_0x464f49,'unit':_0x21beb9,'language':_0x3cf088});}catch(_0x9d23f0){console[_0x45f8a1(0x267)](_0x9d23f0);}}),router[a0_0x55dd66(0x1f0)](a0_0x55dd66(0x254),auth,async(_0x49dadd,_0x452594)=>{var _0x190dab=a0_0x55dd66;try{const {invoice:_0x5c5b73,from_warehouse:_0x4c8cd4,FromRoom_name:_0x4f9e9a,to_warehouse:_0x5d2d20,ToRoom_name:_0x5aaf34}=_0x49dadd[_0x190dab(0x20d)],_0x4815ae=await transfers_finished['findById'](_0x49dadd[_0x190dab(0x226)]['id']),_0x534fa1=_0x4815ae[_0x190dab(0x28c)][_0x190dab(0x242)](async _0x1d785c=>{var _0x1ce8ac=_0x190dab;if(_0x1d785c[_0x1ce8ac(0x213)]>0x0){var _0x30ff60=await warehouse[_0x1ce8ac(0x209)]({'name':_0x4c8cd4,'room':_0x1d785c[_0x1ce8ac(0x233)],'warehouse_category':_0x1ce8ac(0x21a)});const _0x546abf=_0x30ff60[_0x1ce8ac(0x251)][_0x1ce8ac(0x242)](_0x29fd3e=>{var _0x22c4b9=_0x1ce8ac;_0x29fd3e[_0x22c4b9(0x22e)]==_0x1d785c[_0x22c4b9(0x22e)]&&_0x29fd3e[_0x22c4b9(0x201)]==_0x1d785c[_0x22c4b9(0x2b9)]&&_0x29fd3e[_0x22c4b9(0x2af)]==_0x1d785c[_0x22c4b9(0x2af)]&&_0x29fd3e[_0x22c4b9(0x2bc)]==_0x1d785c['production_date']&&_0x29fd3e[_0x22c4b9(0x20c)]==_0x1d785c[_0x22c4b9(0x20c)]&&_0x29fd3e['invoice']==_0x1d785c[_0x22c4b9(0x277)]&&(_0x29fd3e[_0x22c4b9(0x2aa)]=_0x29fd3e['product_stock']-_0x1d785c['to_quantity']);});}return _0x30ff60;});Promise[_0x190dab(0x22b)](_0x534fa1)[_0x190dab(0x282)](async _0x1622fb=>{var _0x2aa566=_0x190dab;try{for(const _0xec800b of _0x1622fb){await _0xec800b[_0x2aa566(0x215)]();}const _0x263a65=_0x4815ae[_0x2aa566(0x28c)][_0x2aa566(0x242)](async _0x2d8aec=>{var _0x5543f1=_0x2aa566,_0x129d2a=await warehouse[_0x5543f1(0x209)]({'name':_0x5d2d20,'room':_0x2d8aec[_0x5543f1(0x24c)]});if(_0x2d8aec[_0x5543f1(0x213)]>0x0){var _0x4549a6=0x0;const _0x3e2ba8=_0x129d2a[_0x5543f1(0x251)][_0x5543f1(0x242)](_0x53c576=>{var _0x11f2a4=_0x5543f1;_0x53c576[_0x11f2a4(0x22e)]==_0x2d8aec[_0x11f2a4(0x22e)]&&_0x53c576[_0x11f2a4(0x201)]==_0x2d8aec[_0x11f2a4(0x214)]&&_0x53c576[_0x11f2a4(0x2af)]==_0x2d8aec[_0x11f2a4(0x2af)]&&_0x53c576[_0x11f2a4(0x2bc)]==_0x2d8aec[_0x11f2a4(0x2bc)]&&_0x53c576['batch_code']==_0x2d8aec[_0x11f2a4(0x20c)]&&_0x53c576['invoice']==_0x2d8aec[_0x11f2a4(0x255)]&&(_0x53c576[_0x11f2a4(0x2aa)]=_0x53c576[_0x11f2a4(0x2aa)]+_0x2d8aec[_0x11f2a4(0x213)],_0x4549a6++);});_0x4549a6=='0'&&(_0x129d2a[_0x5543f1(0x251)]=_0x129d2a[_0x5543f1(0x251)][_0x5543f1(0x1fe)]({'product_name':_0x2d8aec[_0x5543f1(0x22e)],'product_stock':_0x2d8aec['to_quantity'],'bay':_0x2d8aec[_0x5543f1(0x214)],'product_code':_0x2d8aec[_0x5543f1(0x29e)],'primary_code':_0x2d8aec[_0x5543f1(0x1fb)],'secondary_code':_0x2d8aec['secondary_code'],'expiry_date':_0x2d8aec['expiry_date'],'production_date':_0x2d8aec[_0x5543f1(0x2bc)],'maxProducts':_0x2d8aec[_0x5543f1(0x29a)],'batch_code':_0x2d8aec[_0x5543f1(0x20c)],'secondary_unit':_0x2d8aec[_0x5543f1(0x298)],'unit':_0x2d8aec[_0x5543f1(0x1f2)],'maxProducts':_0x2d8aec['maxProducts'],'maxPerUnit':_0x2d8aec[_0x5543f1(0x246)],'invoice':_0x2d8aec[_0x5543f1(0x255)]}));}return _0x129d2a;});Promise['all'](_0x263a65)[_0x2aa566(0x282)](async _0x157e95=>{var _0x393541=_0x2aa566;try{for(const _0x39c9c4 of _0x157e95){await warehouse[_0x393541(0x21c)]({'_id':_0x39c9c4['_id']},{'$addToSet':{'product_details':{'$each':_0x39c9c4[_0x393541(0x251)]}}});}_0x4815ae[_0x393541(0x23b)]='True';const _0x497d2f=await _0x4815ae[_0x393541(0x215)](),_0xea1132=await master_shop[_0x393541(0x2c0)](),_0x5793dd=await email_settings[_0x393541(0x209)](),_0x448561=await supervisor_settings[_0x393541(0x2c0)]();var _0x1b3e08=_0x4815ae[_0x393541(0x28c)],_0x4ca829='',_0xd14eb9;for(_0xd14eb9 in _0x1b3e08){var _0xaa288='FG';_0x4815ae[_0x393541(0x281)]==_0x393541(0x1f8)&&(_0xaa288='DG'),_0x4ca829+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b3e08[_0xd14eb9]['product_name']+_0x393541(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b3e08[_0xd14eb9][_0x393541(0x29e)]+_0x393541(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b3e08[_0xd14eb9][_0x393541(0x213)]+_0x393541(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b3e08[_0xd14eb9][_0x393541(0x1f2)]+_0x393541(0x236)+_0x393541(0x2bd)+_0x1b3e08[_0xd14eb9][_0x393541(0x298)]+_0x393541(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4815ae[_0x393541(0x281)]+_0x393541(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b3e08[_0xd14eb9][_0x393541(0x24c)]+_0x393541(0x236)+_0x393541(0x2bd)+_0xaa288+_0x1b3e08[_0xd14eb9][_0x393541(0x214)]+_0x393541(0x236)+_0x393541(0x28f);}let _0x206aeb=nodemailer[_0x393541(0x2a9)]({'host':_0x5793dd[_0x393541(0x1fc)],'port':Number(_0x5793dd[_0x393541(0x222)]),'secure':![],'auth':{'user':_0x5793dd['email'],'pass':_0x5793dd['password']}}),_0x41d040={'from':_0x5793dd[_0x393541(0x1fa)],'to':_0x448561[0x0]['FGSEmail'],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x393541(0x273),'path':__dirname+_0x393541(0x2a7)+_0x393541(0x23e)+_0xea1132[0x0][_0x393541(0x293)],'cid':_0x393541(0x26a)}],'html':_0x393541(0x2c3)+_0x393541(0x24b)+_0x393541(0x26f)+_0x393541(0x221)+_0x393541(0x22c)+_0x393541(0x221)+_0x393541(0x2b5)+'</div>'+'<div>'+_0x393541(0x2a5)+_0xea1132[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x393541(0x210)+_0x393541(0x247)+_0x393541(0x221)+_0x393541(0x2b7)+_0x393541(0x27d)+_0x4815ae['invoice']+'\x20'+_0x393541(0x21b)+_0x393541(0x211)+_0x4815ae[_0x393541(0x299)]+'\x20'+_0x393541(0x257)+'</h5>'+_0x393541(0x210)+_0x393541(0x28b)+_0x393541(0x25d)+_0x393541(0x250)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x393541(0x2a4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x393541(0x228)+_0x393541(0x24e)+_0x393541(0x1ed)+_0x393541(0x1e5)+_0x393541(0x265)+_0x393541(0x28f)+'</thead>'+_0x393541(0x26d)+'\x20'+_0x4ca829+'\x20'+_0x393541(0x283)+'</table>'+_0x393541(0x221)+_0x393541(0x1ee)+'<h5>'+_0xea1132[0x0]['site_title']+_0x393541(0x2b2)+_0x393541(0x210)+_0x393541(0x210)+_0x393541(0x231)};_0x206aeb[_0x393541(0x264)](_0x41d040,function(_0x26df71,_0x7aa3ea){var _0x1175b7=_0x393541;_0x26df71?(console[_0x1175b7(0x267)](_0x26df71),console[_0x1175b7(0x267)](_0x1175b7(0x297))):console['log']('Email\x20sent\x20successfully');}),_0x49dadd[_0x393541(0x1fd)](_0x393541(0x20e),_0x393541(0x1f6)),_0x452594[_0x393541(0x237)]('/picking_list/PDF_transfer/'+_0x497d2f['_id']);}catch(_0x5064db){console[_0x393541(0x28d)](_0x5064db),_0x452594[_0x393541(0x2b8)](0x1f4)[_0x393541(0x29d)]({'error':_0x393541(0x229)});}})[_0x2aa566(0x2c1)](_0x551ff2=>{var _0xae9e6=_0x2aa566;console[_0xae9e6(0x28d)](_0x551ff2),_0x452594[_0xae9e6(0x2b8)](0x1f4)[_0xae9e6(0x29d)]({'error':_0xae9e6(0x291)});});}catch(_0x441a9b){console['error'](_0x441a9b),_0x452594[_0x2aa566(0x2b8)](0x1f4)[_0x2aa566(0x29d)]({'error':_0x2aa566(0x269)});}})[_0x190dab(0x2c1)](_0x5ab7aa=>{var _0x143ba9=_0x190dab;console[_0x143ba9(0x28d)](_0x5ab7aa),_0x452594['status'](0x1f4)['json']({'error':_0x143ba9(0x291)});});}catch(_0x543c9a){_0x452594[_0x190dab(0x29d)]({'message':_0x543c9a['message']});}});function a0_0xea43(){var _0xb0d29c=['<div>','port','prod_name','to_prod_qty','from_warehouse','params','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.unit','all','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product','product_name','German','Chinese','</body></html>','render','from_room_name','$product_details.maxPerUnit','express','</td>','redirect','Hindi','Spanish','from_prod_qty','finalize','getDate','ToRoomAssigned','/upload/','_id','804200UUyxNT','nodemailer','map','product_code3','split','errors','maxPerUnit','<hr\x20class=\x22my-3\x22>','Arabic','4aUTXQp','edit_transfer_finished','<html><head><title></title>','to_room_name','RoomAssigned','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','aggregate','<tr>','product_details','from_room','$product_details.bay','/preview/:id','To_invoice','user','</span>','Ambient','from_prod_level','MaxStocks_data','getFullYear','/CheckingWarehouse','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.pallet','6iwrQam','MaxStocks_data2','$product_details.storage','Arabic\x20(ae)','../middleware/auth','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','to_invoice','log','Transfer\x20Edit\x20Successfully','An\x20error\x20occurred\x20while\x20saving\x20data.','logo','639190BPLRmk','to_room','<tbody\x20style=\x22text-align:\x20center;\x22>','Portuguese','</head><body>','/view','$product_details.product_name','$from_warehouse','Logo.png','message','to_prod_level','1350393ebYspp','from_invoice','/barcode_scanner3','$product.from_room_name','4188541IQSMbj','add_transfer_finished','$product_details.secondary_unit','\x20Order\x20Number\x20:\x20','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$finalize','36djLByf','to_warehouse','then','</tbody>','staff','length','Router','string','$_id','$product_details.batch_code','$to_warehouse','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product','error','$product_details.rack','</tr>','English','An\x20error\x20occurred.','edit_transfer_finished_view','image','Portuguese\x20(BR)','There\x27s\x20a\x20error\x20in\x20this\x20transaction','New_Qty_Converted','Error\x20Occurs','secondary_unit','date','maxProducts','$room','279051DXjKWs','json','product_code','invoice','3079428DliLKN','to_floorlevel','$name','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<h2>\x20','$product_details.invoice','/../public','$product_details.secondary_code','createTransport','product_stock','$product_details.bin','prod_cat','$product_details._id','6PkcgLv','expiry_date','get','random','</h5>','$product_details','156RXqYGM','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','toString','<h5\x20style=\x22text-align:\x20left;\x22>','status','from_bay','$product.to_room_name','English\x20(US)','production_date','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.production_date','$product_details.level','find','catch','/view/add_transfer','<!DOCTYPE\x20html>','/barcode_scanner2','transfer_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','warehouse','back','$product_details.floorlevel','secondary_code','from_quantity','findById','product_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<strong>\x20Regards\x20</strong>','French','post','getMonth','unit','$product_details.maxProducts','/transfer_finished/preview/','push','Transfer\x20Finalize\x20Successfully','Enabled','DRY\x20GOODS','role','email','primary_code','host','flash','concat','$date','filter','bay','floor','9899270xDEWBR','slice','$product_details.product_code','language','$product_details.product_stock','Rack\x202','findOne','FROZEN\x20GOODS','../public/language/languages.json','batch_code','body','success','forEach','</div>','\x20Order\x20Date\x20:\x20','$product_details.expiry_date','to_quantity','to_bay','save','$product_details.isle','padStart','$product_details.primary_code','QA\x20Warehouse','Finished\x20Goods','<span\x20style=\x22float:\x20right;\x22>','updateOne','TRFF-','$product_details.type','note','/transfer/view'];a0_0xea43=function(){return _0xb0d29c;};return a0_0xea43();}function BayBinSelected(_0x2bce71,_0x16b731){var _0x465fd6=a0_0x55dd66,_0x1f4a6c=[];let _0x27370f=[];var _0x2d5904=[];if(_0x2bce71=='DRY\x20GOODS'){switch(_0x16b731){case'Rack\x201':_0x1f4a6c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x465fd6(0x208):_0x1f4a6c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2d5904=['DG'];}else{if(_0x2bce71==_0x465fd6(0x20a)){switch(_0x16b731){case'Rack\x201':_0x1f4a6c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x1f4a6c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2d5904=['FG'];}}return{'levels':_0x1f4a6c,'identify':_0x2d5904};}router[a0_0x55dd66(0x2b0)](a0_0x55dd66(0x2a3),auth,async(_0x50226c,_0x20a27b)=>{var _0x3c2b3c=a0_0x55dd66;try{const {username:_0x4fc22a,email:_0x54b4f9,role:_0x448fc5}=_0x50226c['user'],_0x502aec=_0x50226c['user'],_0x4bd6fa=await profile['findOne']({'email':_0x502aec[_0x3c2b3c(0x1fa)]}),_0x372f6b=await master_shop[_0x3c2b3c(0x2c0)](),_0x3f203f=await transfers_finished[_0x3c2b3c(0x1eb)](_0x50226c['params']['id']);let _0x44c1c5=new Date(_0x3f203f[_0x3c2b3c(0x2af)]),_0xe968d1=('0'+_0x44c1c5[_0x3c2b3c(0x23c)]())[_0x3c2b3c(0x204)](-0x2),_0x5c26f9=('0'+(_0x44c1c5[_0x3c2b3c(0x1f1)]()+0x1))['slice'](-0x2),_0x51fac3=_0x44c1c5[_0x3c2b3c(0x25b)](),_0x40b9f4=_0x51fac3+'-'+_0x5c26f9+'-'+_0xe968d1,_0x54662f;if(_0x502aec[_0x3c2b3c(0x1f9)]==_0x3c2b3c(0x284)){const _0x2aeb4b=await staff[_0x3c2b3c(0x209)]({'email':_0x502aec[_0x3c2b3c(0x1fa)]});_0x54662f=await warehouse[_0x3c2b3c(0x2c0)]({'status':'Enabled','name':_0x2aeb4b[_0x3c2b3c(0x1e6)],'warehouse_category':'Finished\x20Goods'});}else _0x54662f=await warehouse[_0x3c2b3c(0x2c0)]({'status':_0x3c2b3c(0x1f7),'warehouse_category':_0x3c2b3c(0x21a)});const _0x437b08=await warehouse[_0x3c2b3c(0x24f)]([{'$match':{'name':_0x3f203f[_0x3c2b3c(0x225)],'room':_0x3f203f[_0x3c2b3c(0x252)]}},{'$unwind':_0x3c2b3c(0x2b3)},{'$group':{'_id':_0x3c2b3c(0x2ad),'name':{'$first':_0x3c2b3c(0x271)},'product_stock':{'$first':_0x3c2b3c(0x207)},'bay':{'$first':_0x3c2b3c(0x253)},'bin':{'$first':_0x3c2b3c(0x2ab)},'type':{'$first':_0x3c2b3c(0x21e)},'floorlevel':{'$first':_0x3c2b3c(0x1e8)},'primary_code':{'$first':_0x3c2b3c(0x218)},'secondary_code':{'$first':_0x3c2b3c(0x2a8)},'product_code':{'$first':_0x3c2b3c(0x205)},'storage':{'$first':_0x3c2b3c(0x261)},'rack':{'$first':'$product_details.rack'}}}]);var _0x5b732b=[0x1,0x2,0x3,0x4],_0xa91397=['A','B','C','D','E','F','G','H','I','J'],_0x1d65b1=[_0x3c2b3c(0x258),'Enclosed'];const _0x10a37a=await product[_0x3c2b3c(0x2c0)]({}),_0x1a60fa=BayBinSelected(_0x3f203f[_0x3c2b3c(0x281)],_0x3f203f[_0x3c2b3c(0x26c)]);if(_0x372f6b[0x0][_0x3c2b3c(0x206)]==_0x3c2b3c(0x2bb)){var _0x43b784=users[_0x3c2b3c(0x290)];console[_0x3c2b3c(0x267)](_0x43b784);}else{if(_0x372f6b[0x0][_0x3c2b3c(0x206)]=='Hindi')var _0x43b784=users[_0x3c2b3c(0x238)];else{if(_0x372f6b[0x0][_0x3c2b3c(0x206)]=='German')var _0x43b784=users['German'];else{if(_0x372f6b[0x0]['language']==_0x3c2b3c(0x239))var _0x43b784=users['Spanish'];else{if(_0x372f6b[0x0]['language']==_0x3c2b3c(0x1ef))var _0x43b784=users[_0x3c2b3c(0x1ef)];else{if(_0x372f6b[0x0][_0x3c2b3c(0x206)]=='Portuguese\x20(BR)')var _0x43b784=users['Portuguese'];else{if(_0x372f6b[0x0]['language']==_0x3c2b3c(0x230))var _0x43b784=users[_0x3c2b3c(0x230)];else{if(_0x372f6b[0x0][_0x3c2b3c(0x206)]==_0x3c2b3c(0x262))var _0x43b784=users[_0x3c2b3c(0x248)];}}}}}}}_0x20a27b['render'](_0x3c2b3c(0x24a),{'success':_0x50226c[_0x3c2b3c(0x1fd)]('success'),'errors':_0x50226c[_0x3c2b3c(0x1fd)](_0x3c2b3c(0x245)),'role':_0x502aec,'profile':_0x4bd6fa,'master_shop':_0x372f6b,'warehouse':_0x54662f,'transfer':_0x3f203f,'stock':_0x437b08,'unit':_0x10a37a,'language':_0x43b784,'levels':_0x5b732b,'Isle':_0xa91397,'rooms_data':_0x1d65b1,'ed_fullDate':_0x40b9f4,'dataSelected':_0x1a60fa});}catch(_0x1b6e03){console['log'](_0x1b6e03);}}),router[a0_0x55dd66(0x1f0)](a0_0x55dd66(0x2a3),auth,async(_0x59a321,_0x551e91)=>{var _0x4f5ead=a0_0x55dd66;try{const _0x548895=_0x59a321[_0x4f5ead(0x226)]['id'];console[_0x4f5ead(0x267)](_0x59a321[_0x4f5ead(0x20d)]);const _0x398aa9=await transfers_finished['findById'](_0x548895);console[_0x4f5ead(0x267)]('transfer_data',_0x398aa9);const {date:_0x12cb55,from_warehouse:_0x5a802e,FromRoom_name:_0x5bb85e,to_warehouse:_0x30d594,ToRoom_name:_0x7ffa54,prod_name:_0x1fe623,from_prod_qty:_0x3e6ab5,from_prod_level:_0x16bcee,from_prod_isle:_0x4bf006,from_prod_pallet:_0x452e74,to_prod_qty:_0x303005,to_prod_level:_0x23d5c4,to_prod_isle:_0x214034,to_prod_pallet:_0x400e73,primary_code:_0x5a3dda,secondary_code:_0x9ea798,product_code3:_0x231ace,note:_0xf85960,invoice:_0x3f87b7,expiry_date:_0x3e4c5d}=_0x59a321['body'];if(typeof _0x1fe623==_0x4f5ead(0x287))var _0x25f785=[_0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x223)]],_0x204553=[_0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x23a)]],_0x48da30=[_0x59a321[_0x4f5ead(0x20d)]['from_prod_level']],_0x3c7ac5=[_0x59a321['body'][_0x4f5ead(0x224)]],_0x511775=[_0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x275)]],_0x57b70d=[_0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x1fb)]],_0x4fa8de=[_0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x1e9)]],_0xee2d94=[_0x59a321[_0x4f5ead(0x20d)]['product_code3']],_0xb3fab3=[_0x59a321['body'][_0x4f5ead(0x260)]],_0x17393c=[_0x59a321['body'][_0x4f5ead(0x1f2)]],_0x15e895=[_0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x298)]],_0x5472f5=[_0x59a321[_0x4f5ead(0x20d)]['batch_code']],_0xfe1aff=[_0x59a321[_0x4f5ead(0x20d)]['expiry_date']];else var _0x25f785=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x223)]],_0x204553=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x23a)]],_0x48da30=[..._0x59a321[_0x4f5ead(0x20d)]['from_prod_level']],_0x3c7ac5=[..._0x59a321[_0x4f5ead(0x20d)]['to_prod_qty']],_0x511775=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x275)]],_0x57b70d=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x1fb)]],_0x4fa8de=[..._0x59a321['body']['secondary_code']],_0xee2d94=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x243)]],_0xb3fab3=[..._0x59a321['body'][_0x4f5ead(0x260)]],_0x17393c=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x1f2)]],_0x15e895=[..._0x59a321[_0x4f5ead(0x20d)][_0x4f5ead(0x298)]],_0x5472f5=[..._0x59a321['body'][_0x4f5ead(0x20c)]],_0xfe1aff=[..._0x59a321['body'][_0x4f5ead(0x2af)]];const _0x12b565=_0x25f785[_0x4f5ead(0x242)](_0xfb1b55=>{return _0xfb1b55={'product_name':_0xfb1b55};});_0x204553['forEach']((_0x40bbd7,_0x3b9c0a)=>{var _0x27592a=_0x4f5ead;_0x12b565[_0x3b9c0a][_0x27592a(0x1ea)]=_0x40bbd7;}),_0x48da30[_0x4f5ead(0x20f)]((_0x2f10d1,_0x321042)=>{var _0x1e2edf=_0x4f5ead;_0x12b565[_0x321042][_0x1e2edf(0x2b9)]=_0x2f10d1;}),_0x3c7ac5[_0x4f5ead(0x20f)]((_0x1a5283,_0x83039e)=>{_0x12b565[_0x83039e]['to_quantity']=_0x1a5283;}),_0x511775[_0x4f5ead(0x20f)]((_0x4eef44,_0x40f737)=>{var _0x40e92e=_0x4f5ead;_0x12b565[_0x40f737][_0x40e92e(0x214)]=_0x4eef44;}),_0x57b70d[_0x4f5ead(0x20f)]((_0x6f6d21,_0x426c01)=>{var _0x6925e=_0x4f5ead;_0x12b565[_0x426c01][_0x6925e(0x1fb)]=_0x6f6d21;}),_0x4fa8de[_0x4f5ead(0x20f)]((_0x38aeb3,_0x5c4e0c)=>{var _0x461b27=_0x4f5ead;_0x12b565[_0x5c4e0c][_0x461b27(0x1e9)]=_0x38aeb3;}),_0xee2d94[_0x4f5ead(0x20f)]((_0x22dbe7,_0x162f54)=>{_0x12b565[_0x162f54]['product_code']=_0x22dbe7;}),_0xb3fab3[_0x4f5ead(0x20f)]((_0x3dfd12,_0x4564eb)=>{var _0x7c1b25=_0x4f5ead;_0x12b565[_0x4564eb][_0x7c1b25(0x29a)]=_0x3dfd12;}),_0x17393c[_0x4f5ead(0x20f)]((_0x2797df,_0x5e28a1)=>{var _0x5e7421=_0x4f5ead;_0x12b565[_0x5e28a1][_0x5e7421(0x1f2)]=_0x2797df;}),_0x15e895[_0x4f5ead(0x20f)]((_0xb1cf6e,_0x2e0ada)=>{var _0x321b55=_0x4f5ead;_0x12b565[_0x2e0ada][_0x321b55(0x298)]=_0xb1cf6e;}),_0x5472f5[_0x4f5ead(0x20f)]((_0x12963,_0x3813e1)=>{_0x12b565[_0x3813e1]['batch_code']=_0x12963;}),_0xfe1aff[_0x4f5ead(0x20f)]((_0x50c499,_0x239c96)=>{var _0x1bf145=_0x4f5ead;_0x12b565[_0x239c96][_0x1bf145(0x2af)]=_0x50c499;});const _0x2f317c=_0x12b565[_0x4f5ead(0x200)](_0x28c54d=>_0x28c54d['to_quantity']!=='0'&&_0x28c54d['to_quantity']!==''||_0x28c54d[_0x4f5ead(0x2a1)]!=='0'&&_0x28c54d['to_floorlevel']!=='');var _0x138ec6=0x0;_0x2f317c['forEach'](_0x422eee=>{var _0x14d6e8=_0x4f5ead;parseInt(_0x422eee[_0x14d6e8(0x1ea)])<parseInt(_0x422eee['to_quantity'])&&_0x138ec6++;});if(_0x138ec6!=0x0)return _0x59a321[_0x4f5ead(0x1fd)]('errors',_0x4f5ead(0x27e)),_0x551e91[_0x4f5ead(0x237)](_0x4f5ead(0x1e7));const _0xfead91=await warehouse[_0x4f5ead(0x209)]({'name':_0x398aa9[_0x4f5ead(0x225)],'room':_0x398aa9[_0x4f5ead(0x252)]});_0x398aa9['product']['forEach'](_0x262741=>{var _0x57b46d=_0x4f5ead;if(_0x262741[_0x57b46d(0x213)]>0x0){const _0x3fcedc=_0xfead91['product_details'][_0x57b46d(0x242)](_0x43269c=>{var _0x55f0ef=_0x57b46d;_0x43269c[_0x55f0ef(0x22e)]==_0x262741['product_name']&&_0x43269c[_0x55f0ef(0x201)]==_0x262741['from_bay']&&(_0x43269c['product_stock']=parseInt(_0x43269c[_0x55f0ef(0x2aa)])+parseInt(_0x262741[_0x55f0ef(0x213)]));});}}),await _0xfead91['save']();const _0x5661fb=await warehouse[_0x4f5ead(0x209)]({'name':_0x398aa9[_0x4f5ead(0x281)],'room':_0x398aa9['to_room']});_0x398aa9[_0x4f5ead(0x28c)][_0x4f5ead(0x20f)](_0x7b1145=>{var _0x3f1c0b=_0x4f5ead;if(_0x7b1145[_0x3f1c0b(0x213)]>0x0){const _0x4c403a=_0x5661fb['product_details'][_0x3f1c0b(0x242)](_0x37423d=>{var _0x25074b=_0x3f1c0b;_0x37423d[_0x25074b(0x22e)]==_0x7b1145[_0x25074b(0x22e)]&&_0x37423d[_0x25074b(0x201)]==_0x7b1145[_0x25074b(0x214)]&&(_0x37423d['product_stock']=parseInt(_0x37423d[_0x25074b(0x2aa)])-parseInt(_0x7b1145[_0x25074b(0x213)]));});}}),await _0x5661fb[_0x4f5ead(0x215)](),_0x398aa9['date']=_0x12cb55,_0x398aa9['from_warehouse']=_0x5a802e,_0x398aa9['to_warehouse']=_0x30d594,_0x398aa9[_0x4f5ead(0x28c)]=_0x2f317c,_0x398aa9[_0x4f5ead(0x21f)]=_0xf85960,_0x398aa9[_0x4f5ead(0x29f)]=_0x3f87b7;const _0x4dee67=await _0x398aa9['save'](),_0x3da945=await warehouse[_0x4f5ead(0x209)]({'name':_0x5a802e,'room':_0x5bb85e});_0x4dee67[_0x4f5ead(0x28c)][_0x4f5ead(0x20f)](_0x9c2b26=>{var _0x3075ca=_0x4f5ead;if(_0x9c2b26[_0x3075ca(0x213)]>0x0){const _0x2e534b=_0x3da945[_0x3075ca(0x251)][_0x3075ca(0x242)](_0x4e1dd8=>{var _0xfd4c1c=_0x3075ca;_0x4e1dd8[_0xfd4c1c(0x22e)]==_0x9c2b26[_0xfd4c1c(0x22e)]&&_0x4e1dd8[_0xfd4c1c(0x201)]==_0x9c2b26[_0xfd4c1c(0x2b9)]&&(_0x4e1dd8[_0xfd4c1c(0x2aa)]=parseInt(_0x4e1dd8[_0xfd4c1c(0x2aa)])-parseInt(_0x9c2b26[_0xfd4c1c(0x213)]));});}}),await _0x3da945[_0x4f5ead(0x215)]();const _0x5367d3=await warehouse['findOne']({'name':_0x30d594,'room':_0x7ffa54});_0x4dee67[_0x4f5ead(0x28c)][_0x4f5ead(0x20f)](_0x57bdf6=>{var _0x42ec92=_0x4f5ead;if(_0x57bdf6[_0x42ec92(0x213)]>0x0){var _0x264237=0x0;const _0x29ccbd=_0x5367d3[_0x42ec92(0x251)][_0x42ec92(0x242)](_0x10d2d3=>{var _0x5a0ad8=_0x42ec92;_0x10d2d3[_0x5a0ad8(0x22e)]==_0x57bdf6[_0x5a0ad8(0x22e)]&&_0x10d2d3[_0x5a0ad8(0x201)]==_0x57bdf6[_0x5a0ad8(0x214)]&&(_0x10d2d3[_0x5a0ad8(0x2aa)]=parseInt(_0x10d2d3['product_stock'])+parseInt(_0x57bdf6['to_quantity']),_0x264237++);});_0x264237=='0'&&(_0x5367d3['product_details']=_0x5367d3[_0x42ec92(0x251)][_0x42ec92(0x1fe)]({'product_name':_0x57bdf6[_0x42ec92(0x22e)],'product_stock':_0x57bdf6[_0x42ec92(0x213)],'bay':_0x57bdf6[_0x42ec92(0x214)],'product_code':_0x57bdf6[_0x42ec92(0x29e)],'primary_code':_0x57bdf6['primary_code'],'secondary_code':_0x57bdf6[_0x42ec92(0x1e9)],'maxProducts':_0x57bdf6['maxProducts']}));}}),await _0x5367d3[_0x4f5ead(0x215)](),_0x59a321[_0x4f5ead(0x1fd)]('success',_0x4f5ead(0x268)),_0x551e91[_0x4f5ead(0x237)]('/transfer_finished/view');}catch(_0x4bdb32){console['log'](_0x4bdb32);}}),router[a0_0x55dd66(0x1f0)]('/barcode_scanner',async(_0x54f5cd,_0x22cf4e)=>{var _0x538a13=a0_0x55dd66;const {FromWareHouse:_0x4e29e9,FromRoom:_0x1a4dd9,ToWarehouse:_0x5d40f7,ToRoom:_0x3f5ced,primary_code:_0x2703d9,Roomslist:_0x5a417c}=_0x54f5cd[_0x538a13(0x20d)],_0x5b1f5c=_0x5a417c[_0x538a13(0x244)](','),_0x322c92=[];async function _0x2a87b5(_0x10f65d){var _0x20f2d2=_0x538a13;const _0x73b525=await warehouse[_0x20f2d2(0x24f)]([{'$match':{'name':_0x4e29e9,'room':_0x10f65d}},{'$unwind':_0x20f2d2(0x2b3)},{'$match':{'product_details.primary_code':_0x2703d9}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x20f2d2(0x207)},'primary_code':{'$first':_0x20f2d2(0x218)},'secondary_code':{'$first':_0x20f2d2(0x2a8)},'product_code':{'$first':_0x20f2d2(0x205)},'level':{'$first':_0x20f2d2(0x253)},'isle':{'$first':_0x20f2d2(0x2ab)},'type':{'$first':_0x20f2d2(0x21e)},'pallet':{'$first':_0x20f2d2(0x1e8)},'unit':{'$first':_0x20f2d2(0x22a)},'secondary_unit':{'$first':_0x20f2d2(0x27c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x20f2d2(0x28e)},'expiry_date':{'$first':_0x20f2d2(0x212)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x20f2d2(0x289)},'maxPerUnit':{'$first':_0x20f2d2(0x234)},'roomNamed':{'$first':_0x20f2d2(0x29b)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x20f2d2(0x2a6)}}}]),_0x3337ba=await warehouse[_0x20f2d2(0x24f)]([{'$match':{'name':_0x4e29e9,'room':_0x10f65d}},{'$unwind':_0x20f2d2(0x2b3)},{'$match':{'product_details.secondary_code':_0x2703d9}},{'$group':{'_id':_0x20f2d2(0x2ad),'name':{'$first':_0x20f2d2(0x271)},'instock':{'$first':_0x20f2d2(0x207)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x20f2d2(0x2a8)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x20f2d2(0x21e)},'pallet':{'$first':_0x20f2d2(0x1e8)},'unit':{'$first':_0x20f2d2(0x22a)},'secondary_unit':{'$first':_0x20f2d2(0x27c)},'storage':{'$first':_0x20f2d2(0x261)},'rack':{'$first':_0x20f2d2(0x28e)},'expiry_date':{'$first':_0x20f2d2(0x212)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x20f2d2(0x289)},'maxPerUnit':{'$first':_0x20f2d2(0x234)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x20f2d2(0x2a6)}}}]);if(_0x73b525[_0x20f2d2(0x285)]>0x0)_0x322c92[_0x20f2d2(0x1f5)](_0x73b525);else _0x3337ba[_0x20f2d2(0x285)]>0x0&&_0x322c92[_0x20f2d2(0x1f5)](_0x3337ba);}const _0x570cd0=_0x5b1f5c['map'](_0x38579f=>_0x2a87b5(_0x38579f));await Promise[_0x538a13(0x22b)](_0x570cd0),_0x22cf4e[_0x538a13(0x29d)](_0x322c92);}),router[a0_0x55dd66(0x1f0)](a0_0x55dd66(0x2c4),async(_0x2962c6,_0x467f64)=>{var _0xed9a32=a0_0x55dd66;try{const {FromWareHouse:_0x2632e6,FromRoom:_0x1ba51e,ToWarehouse:_0xae2fd4,ToRoom:_0x4a2305,secondary_code:_0x52c6d4}=_0x2962c6['body'],_0xbd1491=await warehouse[_0xed9a32(0x24f)]([{'$match':{'name':_0x2632e6}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x52c6d4}},{'$group':{'_id':_0xed9a32(0x2ad),'name':{'$first':_0xed9a32(0x271)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xed9a32(0x2a8)},'product_code':{'$first':_0xed9a32(0x205)},'instock':{'$first':_0xed9a32(0x207)},'warehouse':{'$first':_0xed9a32(0x2a2)},'level':{'$first':_0xed9a32(0x2bf)},'isle':{'$first':_0xed9a32(0x216)},'pallet':{'$first':_0xed9a32(0x25e)},'maxProducts':{'$first':_0xed9a32(0x1f3)},'unit':{'$first':_0xed9a32(0x22a)},'expiry_date':{'$first':_0xed9a32(0x212)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x467f64[_0xed9a32(0x2b8)](0xc8)['json'](_0xbd1491);}catch(_0xc7ee15){_0x467f64[_0xed9a32(0x2b8)](0x194)[_0xed9a32(0x29d)]({'message':_0xc7ee15[_0xed9a32(0x274)]});}}),router[a0_0x55dd66(0x1f0)](a0_0x55dd66(0x278),async(_0x4ce10c,_0x117c19)=>{var _0xdea1b1=a0_0x55dd66;try{const {FromWareHouse:_0x16cd16,FromRoom:_0x2a3deb,ToWarehouse:_0x1e9bda,ToRoom:_0x4551f2,product_code:_0x183e48}=_0x4ce10c[_0xdea1b1(0x20d)],_0x22aef4=await warehouse[_0xdea1b1(0x24f)]([{'$match':{'name':_0x16cd16}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x183e48}},{'$group':{'_id':_0xdea1b1(0x2ad),'name':{'$first':_0xdea1b1(0x271)},'primary_code':{'$first':_0xdea1b1(0x218)},'secondary_code':{'$first':_0xdea1b1(0x2a8)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0xdea1b1(0x207)},'warehouse':{'$first':'$name'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0xdea1b1(0x216)},'pallet':{'$first':_0xdea1b1(0x25e)},'maxProducts':{'$first':_0xdea1b1(0x1f3)},'unit':{'$first':_0xdea1b1(0x22a)}}}]);_0x117c19[_0xdea1b1(0x2b8)](0xc8)[_0xdea1b1(0x29d)](_0x22aef4);}catch(_0x1b3a1e){_0x117c19['status'](0x194)['json']({'message':_0x1b3a1e[_0xdea1b1(0x274)]});}}),router['post'](a0_0x55dd66(0x25c),async(_0x4e781c,_0x3f23d3)=>{var _0x33d884=a0_0x55dd66;const {productCode:_0x234986,bay:_0x4d922f,warehouses:_0x32186a,room:_0x2be729}=_0x4e781c['body'];console[_0x33d884(0x267)](_0x4e781c[_0x33d884(0x20d)]);try{const _0x41b0ee=await warehouse['aggregate']([{'$match':{'name':_0x32186a,'room':_0x2be729}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4d922f)}},{'$group':{'_id':_0x33d884(0x2ad),'name':{'$first':_0x33d884(0x271)},'product_stock':{'$first':_0x33d884(0x207)},'bay':{'$first':_0x33d884(0x253)},'maxProducts':{'$first':_0x33d884(0x1f3)}}}]);_0x3f23d3['status'](0xc8)[_0x33d884(0x29d)](_0x41b0ee);}catch(_0x1e8abf){_0x3f23d3[_0x33d884(0x2b8)](0x194)[_0x33d884(0x29d)]({'message':_0x1e8abf[_0x33d884(0x274)]});}}),module['exports']=router;