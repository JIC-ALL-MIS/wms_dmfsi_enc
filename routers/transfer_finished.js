var a0_0x5ad9f2=a0_0x420f;function a0_0xfef6(){var _0x827ad6=['An\x20error\x20occurred.','</table>','Rack\x202','FGSEmail','from_invoice','$product_details.floorlevel','to_room_name','Enclosed','Chinese','QA\x20Warehouse','to_room','<strong>\x20Regards\x20</strong>','$product_details.invoice','/view/:id','flash','8701288qAGLmh','error','product_name','$invoice','../public/language/languages.json','from_prod_qty','finalize','220lwwNVF','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.product_name','/preview/:id','to_floorlevel','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','maxPerUnit','note','edit_transfer_finished_view','product_code','find','host','True','staff','To_invoice','filter','$from_warehouse','$product_details.bay','edit_transfer_finished','<tr>','warehouse','$product_details.storage','</td>','$product_details.bin','<span\x20style=\x22float:\x20right;\x22>','Transfer\x20Edit\x20Successfully','params','/upload/','954063EkSIfA','bay','An\x20error\x20occurred\x20while\x20saving\x20data.','message','<!DOCTYPE\x20html>','save','unit','production_date','$product_details.rack','express','getDate','English','string','product_stock','language','here1','aggregate','$product_details.pallet','product_code3','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','get','prod_name','findOne','all','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','padStart','Hindi','$product_details.production_date','FROZEN\x20GOODS','product_date','$name','add_transfer_finished','from_bay','\x20</h2>','<hr\x20class=\x22my-3\x22>','New_Qty_Converted','to_prod_qty','findById','then','/barcode_scanner2','split','/CheckingWarehouse','$product_details.isle','$product_details.maxProducts','ToRoomAssigned','site_title','to_quantity','body','$_id','length','sendMail','$product_details.level','</span>','6ueexLA','exports','3qnLTpA','max','product','date','email','</tbody>','2819704baVnfO','log','from_room','to_prod_level','push','from_prod_level','slice','transfer_data','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','maxProducts','TRFF-','$product','/view','redirect','<h5>','$product_details','abs','German','Arabic','expiry_date','undefined','French','id_transaction','$product_details.product_stock','$product_details.unit','Transfer\x20Finalize\x20Successfully','Error\x20Occurs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','here2','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','role','from_quantity','user','render','MaxStocks_data2','<h2>\x20','batch_code','\x20Order\x20Number\x20:\x20','<html><head><title></title>','/barcode_scanner3','RoomAssigned','$product.to_room_name','<h5\x20style=\x22text-align:\x20left;\x22>','toString','Product\x20Transfer\x20successfully','from_warehouse','\x20Order\x20Date\x20:\x20','Arabic\x20(ae)','$product_details.product_code','\x20<=>\x20','Router','5780730jjFYiK','getFullYear','nodemailer','map','</div>','to_bay','invoice','$product_details.maxPerUnit','floor','Logo.png','success','to_invoice','$date','6618983gkJVKI','port','/view/add_transfer','$product_details.expiry_date','errors','primary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','English\x20(US)','599860voJWym','</tr>','$product.from_room_name','forEach','to_warehouse','secondary_unit','MaxStocks_data','Portuguese','$product_details._id','</h5>','createTransport','back','/transfer_finished/preview/','Portuguese\x20(BR)','$product_details.batch_code','catch','$room','/transfer_finished/view','primary_unit','_id','$product_details.type','DRY\x20GOODS','2225236XCEYTe','concat','Ambient','secondary_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','post','Finished\x20Goods','../models/all_models','$product_details.secondary_code','product_details','Spanish','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','status','<div>','prod_cat','Enabled','Transfer\x20Mail','$product_details.primary_code','json','/../public'];a0_0xfef6=function(){return _0x827ad6;};return a0_0xfef6();}(function(_0x41fb41,_0x19e585){var _0x586c5c=a0_0x420f,_0x5aa956=_0x41fb41();while(!![]){try{var _0x33e1ed=parseInt(_0x586c5c(0x169))/0x1+parseInt(_0x586c5c(0x120))/0x2*(-parseInt(_0x586c5c(0x11a))/0x3)+parseInt(_0x586c5c(0x9a))/0x4+-parseInt(_0x586c5c(0x154))/0x5+parseInt(_0x586c5c(0x118))/0x6*(parseInt(_0x586c5c(0x161))/0x7)+-parseInt(_0x586c5c(0xbd))/0x8+-parseInt(_0x586c5c(0xe0))/0x9*(-parseInt(_0x586c5c(0xc4))/0xa);if(_0x33e1ed===_0x19e585)break;else _0x5aa956['push'](_0x5aa956['shift']());}catch(_0x132239){_0x5aa956['push'](_0x5aa956['shift']());}}}(a0_0xfef6,0xbe7c9));const express=require(a0_0x5ad9f2(0xe9)),app=express(),router=express[a0_0x5ad9f2(0x153)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x5ad9f2(0xa1)),auth=require('../middleware/auth'),users=require(a0_0x5ad9f2(0xc1)),nodemailer=require(a0_0x5ad9f2(0x156));router['get'](a0_0x5ad9f2(0x12c),auth,async(_0x47fa16,_0x493f39)=>{var _0x52be75=a0_0x5ad9f2;try{const {username:_0x4494f5,email:_0x180f88,role:_0x8406e7}=_0x47fa16[_0x52be75(0x141)],_0x2b3ebb=_0x47fa16[_0x52be75(0x141)],_0x3d0d83=await profile[_0x52be75(0xf8)]({'email':_0x2b3ebb[_0x52be75(0x11e)]}),_0x1b47ab=await master_shop[_0x52be75(0xce)]();let _0x19a197;if(_0x2b3ebb[_0x52be75(0x13f)]==_0x52be75(0xd1)){const _0x526b6b=await staff['findOne']({'email':_0x2b3ebb[_0x52be75(0x11e)]});_0x19a197=await transfers_finished[_0x52be75(0xce)]({'from_warehouse':_0x526b6b[_0x52be75(0xd8)]});}else _0x19a197=await transfers_finished['aggregate']([{'$unwind':_0x52be75(0x12b)},{'$group':{'_id':_0x52be75(0x113),'invoice':{'$first':_0x52be75(0xc0)},'date':{'$first':_0x52be75(0x160)},'from_warehouse':{'$first':_0x52be75(0xd4)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x52be75(0x16b)},'to_room_name':{'$addToSet':_0x52be75(0x14a)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x1b47ab[0x0][_0x52be75(0xee)]==_0x52be75(0x168))var _0x29ce4b=users[_0x52be75(0xeb)];else{if(_0x1b47ab[0x0]['language']==_0x52be75(0xfd))var _0x29ce4b=users['Hindi'];else{if(_0x1b47ab[0x0][_0x52be75(0xee)]==_0x52be75(0x131))var _0x29ce4b=users['German'];else{if(_0x1b47ab[0x0][_0x52be75(0xee)]==_0x52be75(0xa4))var _0x29ce4b=users['Spanish'];else{if(_0x1b47ab[0x0][_0x52be75(0xee)]=='French')var _0x29ce4b=users[_0x52be75(0x135)];else{if(_0x1b47ab[0x0][_0x52be75(0xee)]=='Portuguese\x20(BR)')var _0x29ce4b=users[_0x52be75(0x170)];else{if(_0x1b47ab[0x0][_0x52be75(0xee)]==_0x52be75(0xb6))var _0x29ce4b=users['Chinese'];else{if(_0x1b47ab[0x0][_0x52be75(0xee)]=='Arabic\x20(ae)')var _0x29ce4b=users[_0x52be75(0x132)];}}}}}}}_0x493f39['render']('transfer_finished',{'success':_0x47fa16['flash'](_0x52be75(0x15e)),'errors':_0x47fa16[_0x52be75(0xbc)](_0x52be75(0x165)),'role':_0x2b3ebb,'profile':_0x3d0d83,'master_shop':_0x1b47ab,'transfer':_0x19a197,'language':_0x29ce4b});}catch(_0x121f1c){console[_0x52be75(0x121)](_0x121f1c);}});async function getRandom8DigitNumber(){var _0x2d7501=a0_0x5ad9f2;const _0x207b2f=0x989680,_0x505211=0x5f5e0ff,_0x2c9dc8=Math[_0x2d7501(0x15c)](Math['random']()*(_0x505211-_0x207b2f+0x1))+_0x207b2f;var _0x5f3de9;const _0x128c08=await transfers_finished[_0x2d7501(0xf8)]({'invoice':_0x2d7501(0x12a)+_0x2c9dc8});return _0x128c08&&_0x128c08['length']>0x0?_0x5f3de9=_0x2d7501(0x12a)+_0x2c9dc8:_0x5f3de9=_0x2d7501(0x12a)+_0x2c9dc8,_0x5f3de9;}router[a0_0x5ad9f2(0xf6)](a0_0x5ad9f2(0x163),auth,async(_0x45efbd,_0x24572f)=>{var _0x54ea1d=a0_0x5ad9f2;try{const {username:_0x5577af,email:_0x1f6179,role:_0x2de6a6}=_0x45efbd[_0x54ea1d(0x141)],_0x5a6ea3=_0x45efbd['user'],_0x147dd8=await profile['findOne']({'email':_0x5a6ea3[_0x54ea1d(0x11e)]}),_0x5e8a50=await master_shop['find']();let _0x1c48bc;if(_0x5a6ea3[_0x54ea1d(0x13f)]=='staff'){const _0x2007fd=await staff[_0x54ea1d(0xf8)]({'email':_0x5a6ea3[_0x54ea1d(0x11e)]});_0x1c48bc=await warehouse[_0x54ea1d(0xf0)]([{'$match':{'status':_0x54ea1d(0xa9),'name':_0x2007fd[_0x54ea1d(0xd8)],'warehouse_category':_0x54ea1d(0xa0),'name':{'$ne':_0x54ea1d(0xb7)}}},{'$group':{'_id':_0x54ea1d(0x101),'name':{'$first':_0x54ea1d(0x101)}}}]);}else _0x1c48bc=await warehouse[_0x54ea1d(0xf0)]([{'$match':{'status':_0x54ea1d(0xa9),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x54ea1d(0x101)}}}]);const _0x4b3ddb=await transfers_finished[_0x54ea1d(0xce)]({}),_0x45c5c4=_0x4b3ddb[_0x54ea1d(0x114)]+0x1,_0x390fa0=_0x54ea1d(0x12a)+_0x45c5c4[_0x54ea1d(0x14c)]()[_0x54ea1d(0xfc)](0x5,'0');if(_0x5e8a50[0x0]['language']=='English\x20(US)')var _0x53181e=users['English'];else{if(_0x5e8a50[0x0]['language']==_0x54ea1d(0xfd))var _0x53181e=users['Hindi'];else{if(_0x5e8a50[0x0]['language']==_0x54ea1d(0x131))var _0x53181e=users[_0x54ea1d(0x131)];else{if(_0x5e8a50[0x0][_0x54ea1d(0xee)]=='Spanish')var _0x53181e=users[_0x54ea1d(0xa4)];else{if(_0x5e8a50[0x0]['language']==_0x54ea1d(0x135))var _0x53181e=users['French'];else{if(_0x5e8a50[0x0][_0x54ea1d(0xee)]==_0x54ea1d(0x91))var _0x53181e=users['Portuguese'];else{if(_0x5e8a50[0x0]['language']=='Chinese')var _0x53181e=users[_0x54ea1d(0xb6)];else{if(_0x5e8a50[0x0][_0x54ea1d(0xee)]=='Arabic\x20(ae)')var _0x53181e=users[_0x54ea1d(0x132)];}}}}}}}const _0x25ea20=getRandom8DigitNumber();_0x25ea20[_0x54ea1d(0x109)](_0x1bc8c7=>{var _0x18c360=_0x54ea1d;_0x24572f['render'](_0x18c360(0x102),{'success':_0x45efbd[_0x18c360(0xbc)](_0x18c360(0x15e)),'errors':_0x45efbd[_0x18c360(0xbc)](_0x18c360(0x165)),'role':_0x5a6ea3,'profile':_0x147dd8,'master_shop':_0x5e8a50,'warehouse':_0x1c48bc,'language':_0x53181e,'invoice':_0x1bc8c7});})['catch'](_0x61a8d8=>{var _0x2ded3b=_0x54ea1d;_0x45efbd[_0x2ded3b(0xbc)](_0x2ded3b(0x165),_0x2ded3b(0xfa)),_0x24572f[_0x2ded3b(0x12d)]('/transfer/view');});}catch(_0x1b66ba){console[_0x54ea1d(0x121)](_0x1b66ba);}}),router[a0_0x5ad9f2(0x9f)]('/view/add_transfer',auth,async(_0x1f00cb,_0x33028a)=>{var _0x478dc7=a0_0x5ad9f2;try{const {date:_0x15e0f5,from_warehouse:_0x5be806,FromRoom_name:_0x807d1b,to_warehouse:_0x5f473b,ToRoom_name:_0xb4cb75,prod_name:_0x12527a,from_prod_qty:_0x49b8cd,from_prod_level:_0x572025,from_prod_isle:_0x12c7b9,from_prod_pallet:_0x5a4d99,to_prod_qty:_0x1c4f3e,to_prod_level:_0x43d93f,to_prod_isle:_0x584ccc,to_prod_pallet:_0xdbf94b,primary_code:_0x35777d,secondary_code:_0x1a47b4,product_code3:_0x22c5eb,note:_0x266013,MaxStocks_data2:_0x465859,invoice:_0x29271b,expiry_date:_0x11b196}=_0x1f00cb[_0x478dc7(0x112)];if(typeof _0x12527a==_0x478dc7(0xec))var _0x1dfda6=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xf7)]],_0x2541bd=[_0x1f00cb['body'][_0x478dc7(0xc2)]],_0x3d521d=[_0x1f00cb['body'][_0x478dc7(0x125)]],_0x4f58f5=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x106)]],_0x522f69=[_0x1f00cb[_0x478dc7(0x112)]['to_prod_level']],_0x317b21=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x166)]],_0x33582e=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x9d)]],_0x43da27=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xf2)]],_0x474a24=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x143)]],_0x4a7046=[_0x1f00cb['body'][_0x478dc7(0x96)]],_0x4b3685=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x16e)]],_0x4bb82b=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x145)]],_0x54a817=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x133)]],_0x525ca5=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x100)]],_0x283be2=[_0x1f00cb['body'][_0x478dc7(0x16f)]],_0x44c8b2=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xca)]],_0x246e4b=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xa8)]],_0x182b85=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x149)]],_0x48e8c8=[_0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x10f)]],_0x263b47=[_0x1f00cb['body'][_0x478dc7(0xb2)]],_0x23b08e=[_0x1f00cb[_0x478dc7(0x112)]['to_invoice']],_0x6fd09f=[_0x1f00cb['body'][_0x478dc7(0x136)]];else var _0x1dfda6=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xf7)]],_0x2541bd=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xc2)]],_0x3d521d=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x125)]],_0x4f58f5=[..._0x1f00cb[_0x478dc7(0x112)]['New_Qty_Converted']],_0x522f69=[..._0x1f00cb[_0x478dc7(0x112)]['to_prod_level']],_0x317b21=[..._0x1f00cb['body']['primary_code']],_0x33582e=[..._0x1f00cb[_0x478dc7(0x112)]['secondary_code']],_0x43da27=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xf2)]],_0x474a24=[..._0x1f00cb['body']['MaxStocks_data2']],_0x4a7046=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x96)]],_0x4b3685=[..._0x1f00cb[_0x478dc7(0x112)]['secondary_unit']],_0x4bb82b=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x145)]],_0x54a817=[..._0x1f00cb['body'][_0x478dc7(0x133)]],_0x525ca5=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0x100)]],_0x283be2=[..._0x1f00cb['body'][_0x478dc7(0x16f)]],_0x44c8b2=[..._0x1f00cb['body'][_0x478dc7(0xca)]],_0x246e4b=[..._0x1f00cb[_0x478dc7(0x112)][_0x478dc7(0xa8)]],_0x182b85=[..._0x1f00cb['body'][_0x478dc7(0x149)]],_0x48e8c8=[..._0x1f00cb['body'][_0x478dc7(0x10f)]],_0x263b47=[..._0x1f00cb['body']['from_invoice']],_0x23b08e=[..._0x1f00cb['body'][_0x478dc7(0x15f)]],_0x6fd09f=[..._0x1f00cb[_0x478dc7(0x112)]['id_transaction']];const _0x5be60e=_0x1dfda6[_0x478dc7(0x157)](_0x4d27e3=>{return _0x4d27e3={'product_name':_0x4d27e3};});_0x2541bd['forEach']((_0x6790ec,_0xba6bb1)=>{_0x5be60e[_0xba6bb1]['from_quantity']=_0x6790ec;}),_0x3d521d[_0x478dc7(0x16c)]((_0x105c15,_0x54f093)=>{_0x5be60e[_0x54f093]['from_bay']=_0x105c15;}),_0x6fd09f[_0x478dc7(0x16c)]((_0x36ff10,_0x2f3c88)=>{var _0x31ae1e=_0x478dc7;_0x5be60e[_0x2f3c88][_0x31ae1e(0x136)]=_0x36ff10;}),_0x263b47[_0x478dc7(0x16c)]((_0x54a601,_0x4c34b7)=>{var _0x541ee8=_0x478dc7;_0x5be60e[_0x4c34b7][_0x541ee8(0xb2)]=_0x54a601;}),_0x23b08e[_0x478dc7(0x16c)]((_0x59cff8,_0x538e16)=>{var _0x21339d=_0x478dc7;_0x5be60e[_0x538e16][_0x21339d(0xd2)]=_0x59cff8;}),_0x4f58f5[_0x478dc7(0x16c)]((_0x3bd713,_0x493d13)=>{var _0x43e23b=_0x478dc7;_0x5be60e[_0x493d13][_0x43e23b(0x111)]=_0x3bd713;}),_0x522f69[_0x478dc7(0x16c)]((_0x127781,_0x3d0f69)=>{var _0x30f22c=_0x478dc7;_0x5be60e[_0x3d0f69][_0x30f22c(0x159)]=_0x127781;}),_0x317b21[_0x478dc7(0x16c)]((_0x43fb39,_0x3db3e1)=>{_0x5be60e[_0x3db3e1]['primary_code']=_0x43fb39;}),_0x33582e[_0x478dc7(0x16c)]((_0xab42d5,_0x3adb75)=>{var _0x49c2ec=_0x478dc7;_0x5be60e[_0x3adb75][_0x49c2ec(0x9d)]=_0xab42d5;}),_0x43da27['forEach']((_0x588e1b,_0x4ec93d)=>{var _0x1e64f5=_0x478dc7;_0x5be60e[_0x4ec93d][_0x1e64f5(0xcd)]=_0x588e1b;}),_0x474a24[_0x478dc7(0x16c)]((_0x3e2928,_0x281930)=>{var _0x452c5b=_0x478dc7;_0x5be60e[_0x281930][_0x452c5b(0x129)]=_0x3e2928;}),_0x4a7046[_0x478dc7(0x16c)]((_0x2d2534,_0x57be23)=>{var _0x5c0d8d=_0x478dc7;_0x5be60e[_0x57be23][_0x5c0d8d(0xe6)]=_0x2d2534;}),_0x4b3685['forEach']((_0x3e510f,_0x1e5fe7)=>{var _0x31b54e=_0x478dc7;_0x5be60e[_0x1e5fe7][_0x31b54e(0x16e)]=_0x3e510f;}),_0x4bb82b[_0x478dc7(0x16c)]((_0xfbf66,_0x3cc837)=>{var _0x1e2339=_0x478dc7;_0x5be60e[_0x3cc837][_0x1e2339(0x145)]=_0xfbf66;}),_0x54a817['forEach']((_0x543301,_0x261d09)=>{_0x5be60e[_0x261d09]['expiry_date']=_0x543301;}),_0x525ca5[_0x478dc7(0x16c)]((_0xf953a7,_0x5563ec)=>{var _0x4daa73=_0x478dc7;_0x5be60e[_0x5563ec][_0x4daa73(0xe7)]=_0xf953a7;}),_0x283be2[_0x478dc7(0x16c)]((_0x40ce6e,_0x2afbfb)=>{var _0x19f4f4=_0x478dc7;_0x5be60e[_0x2afbfb][_0x19f4f4(0x129)]=_0x40ce6e;}),_0x44c8b2[_0x478dc7(0x16c)]((_0x1414b2,_0x538e13)=>{_0x5be60e[_0x538e13]['maxPerUnit']=_0x1414b2;}),_0x246e4b[_0x478dc7(0x16c)]((_0x79b49e,_0x28cb0f)=>{_0x5be60e[_0x28cb0f]['prod_cat']=_0x79b49e;}),_0x182b85[_0x478dc7(0x16c)]((_0x393565,_0x1dc785)=>{_0x5be60e[_0x1dc785]['from_room_name']=_0x393565;}),_0x48e8c8[_0x478dc7(0x16c)]((_0x46d2e6,_0x2acac2)=>{var _0x82798d=_0x478dc7;_0x5be60e[_0x2acac2][_0x82798d(0xb4)]=_0x46d2e6;});const _0x1f903b=_0x5be60e[_0x478dc7(0xd3)](_0x23216a=>_0x23216a[_0x478dc7(0x111)]!=='0'&&_0x23216a[_0x478dc7(0x111)]!==''||_0x23216a[_0x478dc7(0xc8)]!=='0'&&_0x23216a[_0x478dc7(0xc8)]!=='');var _0x1dc0d5=0x0;_0x1f903b[_0x478dc7(0x16c)](_0x2671df=>{var _0x38ec40=_0x478dc7;parseInt(_0x2671df[_0x38ec40(0x140)])<parseInt(_0x2671df[_0x38ec40(0x111)])&&_0x1dc0d5++;});if(_0x1dc0d5!=0x0)return _0x1f00cb[_0x478dc7(0xbc)](_0x478dc7(0x165),_0x478dc7(0xc9)),_0x33028a[_0x478dc7(0x12d)](_0x478dc7(0x8f));const _0x151d76=new transfers_finished({'date':_0x15e0f5,'from_warehouse':_0x5be806,'to_warehouse':_0x5f473b,'product':_0x1f903b,'note':_0x266013,'invoice':_0x29271b}),_0x5cf197=await _0x151d76[_0x478dc7(0xe5)]();_0x1f00cb[_0x478dc7(0xbc)](_0x478dc7(0x15e),_0x478dc7(0x14d)),_0x33028a[_0x478dc7(0x12d)](_0x478dc7(0x90)+_0x5cf197[_0x478dc7(0x97)]);}catch(_0x44f911){console['log'](_0x44f911),_0x33028a[_0x478dc7(0xa6)](0xc8)['json']({'errorMessage':_0x44f911[_0x478dc7(0xe3)]});}}),router['get']('/preview/:id',auth,async(_0x240672,_0x5a7777)=>{var _0x1fcd55=a0_0x5ad9f2;try{const {username:_0x26a6c1,email:_0x1745ae,role:_0x2a10b4}=_0x240672[_0x1fcd55(0x141)],_0x35d202=_0x240672[_0x1fcd55(0x141)],_0x1965d3=await profile['findOne']({'email':_0x35d202[_0x1fcd55(0x11e)]}),_0x22d8aa=await master_shop['find'](),_0x424d69=await transfers_finished['findById'](_0x240672[_0x1fcd55(0xde)]['id']);let _0x595a41;if(_0x35d202['role']=='staff'){const _0x55797d=await staff['findOne']({'email':_0x35d202[_0x1fcd55(0x11e)]});_0x595a41=await warehouse[_0x1fcd55(0xce)]({'status':_0x1fcd55(0xa9),'name':_0x55797d[_0x1fcd55(0xd8)],'warehouse_category':_0x1fcd55(0xa0)});}else _0x595a41=await warehouse[_0x1fcd55(0xce)]({'status':_0x1fcd55(0xa9),'warehouse_category':'Finished\x20Goods'});const _0x13bede=await warehouse[_0x1fcd55(0xf0)]([{'$match':{'name':_0x424d69[_0x1fcd55(0x14e)],'warehouse_category':_0x1fcd55(0xa0)}},{'$unwind':_0x1fcd55(0x12f)},{'$group':{'_id':_0x1fcd55(0x171),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1fcd55(0x137)},'bay':{'$first':_0x1fcd55(0xd5)},'bin':{'$first':_0x1fcd55(0xdb)},'type':{'$first':_0x1fcd55(0x98)},'floorlevel':{'$first':_0x1fcd55(0xb3)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1fcd55(0xa2)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1fcd55(0xe8)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1fcd55(0xfe)},'room':{'$first':_0x1fcd55(0x94)},'warehoue_name':{'$first':_0x1fcd55(0x101)}}}]),_0x5887cc=await product['find']({});if(_0x22d8aa[0x0][_0x1fcd55(0xee)]==_0x1fcd55(0x168)){var _0x553c34=users['English'];console[_0x1fcd55(0x121)](_0x553c34);}else{if(_0x22d8aa[0x0]['language']==_0x1fcd55(0xfd))var _0x553c34=users[_0x1fcd55(0xfd)];else{if(_0x22d8aa[0x0][_0x1fcd55(0xee)]==_0x1fcd55(0x131))var _0x553c34=users[_0x1fcd55(0x131)];else{if(_0x22d8aa[0x0][_0x1fcd55(0xee)]==_0x1fcd55(0xa4))var _0x553c34=users['Spanish'];else{if(_0x22d8aa[0x0]['language']=='French')var _0x553c34=users['French'];else{if(_0x22d8aa[0x0][_0x1fcd55(0xee)]=='Portuguese\x20(BR)')var _0x553c34=users[_0x1fcd55(0x170)];else{if(_0x22d8aa[0x0]['language']==_0x1fcd55(0xb6))var _0x553c34=users['Chinese'];else{if(_0x22d8aa[0x0][_0x1fcd55(0xee)]=='Arabic\x20(ae)')var _0x553c34=users['Arabic'];}}}}}}}_0x5a7777[_0x1fcd55(0x142)](_0x1fcd55(0xcc),{'success':_0x240672[_0x1fcd55(0xbc)]('success'),'errors':_0x240672['flash']('errors'),'role':_0x35d202,'profile':_0x1965d3,'master_shop':_0x22d8aa,'warehouse':_0x595a41,'transfer':_0x424d69,'stock':_0x13bede,'unit':_0x5887cc,'language':_0x553c34});}catch(_0x37399b){console[_0x1fcd55(0x121)](_0x37399b);}}),router[a0_0x5ad9f2(0x9f)](a0_0x5ad9f2(0xc7),auth,async(_0x4a34b8,_0x5b9980)=>{var _0x586229=a0_0x5ad9f2;try{const {invoice:_0x2ea7be,from_warehouse:_0x1a12e7,FromRoom_name:_0x83b38b,to_warehouse:_0x1763f5,ToRoom_name:_0x239ab8}=_0x4a34b8[_0x586229(0x112)],_0x5cfcfd=await transfers_finished[_0x586229(0x108)](_0x4a34b8[_0x586229(0xde)]['id']),_0x5edff8=_0x5cfcfd[_0x586229(0x11c)][_0x586229(0x157)](async _0x3678ab=>{var _0x41ed43=_0x586229;if(_0x3678ab['to_quantity']>0x0){var _0x4c461c=await warehouse[_0x41ed43(0xf8)]({'name':_0x1a12e7,'room':_0x3678ab['from_room_name'],'warehouse_category':_0x41ed43(0xa0)});const _0x2d47dc=_0x4c461c[_0x41ed43(0xa3)][_0x41ed43(0x157)](_0x223cc7=>{var _0x482c0e=_0x41ed43;_0x223cc7[_0x482c0e(0xbf)]==_0x3678ab[_0x482c0e(0xbf)]&&_0x223cc7[_0x482c0e(0xe1)]==_0x3678ab['from_bay']&&_0x223cc7['expiry_date']==_0x3678ab[_0x482c0e(0x133)]&&_0x223cc7[_0x482c0e(0xe7)]==_0x3678ab['production_date']&&_0x223cc7[_0x482c0e(0x145)]==_0x3678ab[_0x482c0e(0x145)]&&_0x223cc7[_0x482c0e(0x15a)]==_0x3678ab[_0x482c0e(0xb2)]&&(console[_0x482c0e(0x121)](_0x482c0e(0xef),_0x223cc7[_0x482c0e(0xed)]),typeof _0x3678ab[_0x482c0e(0x136)]==_0x482c0e(0x134)?_0x223cc7['product_stock']=Math[_0x482c0e(0x11b)](0x0,Math[_0x482c0e(0x130)](_0x223cc7[_0x482c0e(0xed)])-Math[_0x482c0e(0x130)](_0x3678ab[_0x482c0e(0x111)])):_0x223cc7[_0x482c0e(0xed)]=Math['max'](0x0,Math[_0x482c0e(0x130)](_0x223cc7[_0x482c0e(0xed)])-Math[_0x482c0e(0x130)](_0x3678ab[_0x482c0e(0x111)])));});}return _0x4c461c;});Promise[_0x586229(0xf9)](_0x5edff8)[_0x586229(0x109)](async _0x124d7f=>{var _0x4a602f=_0x586229;try{for(const _0x24f8fa of _0x124d7f){await _0x24f8fa[_0x4a602f(0xe5)]();}const _0x5dcbe7=_0x5cfcfd[_0x4a602f(0x11c)][_0x4a602f(0x157)](async _0x57b855=>{var _0x265b67=_0x4a602f,_0x1bd4e2=await warehouse[_0x265b67(0xf8)]({'name':_0x1763f5,'room':_0x57b855['to_room_name']});if(_0x57b855['to_quantity']>0x0){var _0x2d984e=0x0;const _0x41bfbf=_0x1bd4e2[_0x265b67(0xa3)]['map'](_0x1ec449=>{var _0x42cbd1=_0x265b67;_0x1ec449['product_name']==_0x57b855[_0x42cbd1(0xbf)]&&_0x1ec449[_0x42cbd1(0xe1)]==_0x57b855[_0x42cbd1(0x159)]&&_0x1ec449['expiry_date']==_0x57b855['expiry_date']&&_0x1ec449['production_date']==_0x57b855[_0x42cbd1(0xe7)]&&_0x1ec449[_0x42cbd1(0x145)]==_0x57b855[_0x42cbd1(0x145)]&&_0x1ec449[_0x42cbd1(0x15a)]==_0x57b855[_0x42cbd1(0xd2)]&&(typeof _0x57b855[_0x42cbd1(0x136)]==_0x42cbd1(0x134)?(console[_0x42cbd1(0x121)](_0x42cbd1(0x13c),_0x1ec449['product_stock']+'\x20<>\x20'+_0x1ec449[_0x42cbd1(0x97)]+_0x42cbd1(0x152)+Math[_0x42cbd1(0x130)](_0x1ec449[_0x42cbd1(0xed)])+Math[_0x42cbd1(0x130)](_0x57b855[_0x42cbd1(0x111)])),_0x1ec449['product_stock']=Math[_0x42cbd1(0x130)](_0x1ec449[_0x42cbd1(0xed)])+Math['abs'](_0x57b855['to_quantity'])):_0x1ec449[_0x42cbd1(0xed)]=Math['abs'](_0x1ec449['product_stock'])+Math['abs'](_0x57b855['to_quantity']),_0x2d984e++);});_0x2d984e=='0'&&(_0x1bd4e2[_0x265b67(0xa3)]=_0x1bd4e2['product_details'][_0x265b67(0x9b)]({'product_name':_0x57b855[_0x265b67(0xbf)],'product_stock':_0x57b855[_0x265b67(0x111)],'bay':_0x57b855[_0x265b67(0x159)],'product_code':_0x57b855[_0x265b67(0xcd)],'primary_code':_0x57b855[_0x265b67(0x166)],'secondary_code':_0x57b855['secondary_code'],'expiry_date':_0x57b855[_0x265b67(0x133)],'production_date':_0x57b855[_0x265b67(0xe7)],'maxProducts':_0x57b855[_0x265b67(0x129)],'batch_code':_0x57b855[_0x265b67(0x145)],'secondary_unit':_0x57b855[_0x265b67(0x16e)],'unit':_0x57b855[_0x265b67(0xe6)],'maxProducts':_0x57b855[_0x265b67(0x129)],'maxPerUnit':_0x57b855[_0x265b67(0xca)],'invoice':_0x57b855[_0x265b67(0xd2)]}));}return _0x1bd4e2;});Promise['all'](_0x5dcbe7)[_0x4a602f(0x109)](async _0x466abd=>{var _0x2f7802=_0x4a602f;try{for(const _0x26152b of _0x466abd){await warehouse['updateOne']({'_id':_0x26152b['_id']},{'$addToSet':{'product_details':{'$each':_0x26152b[_0x2f7802(0xa3)]}}});}_0x5cfcfd[_0x2f7802(0xc3)]=_0x2f7802(0xd0);const _0x4c8c3=await _0x5cfcfd[_0x2f7802(0xe5)](),_0xb4cefc=await master_shop[_0x2f7802(0xce)](),_0x20fd4c=await email_settings['findOne'](),_0xf73844=await supervisor_settings[_0x2f7802(0xce)]();var _0x473653=_0x5cfcfd['product'],_0x4a2acb='',_0x5b280f;for(_0x5b280f in _0x473653){var _0x27bd1d='FG';_0x5cfcfd[_0x2f7802(0x16d)]=='DRY\x20GOODS'&&(_0x27bd1d='DG'),_0x4a2acb+=_0x2f7802(0xd7)+_0x2f7802(0xfb)+_0x473653[_0x5b280f]['product_name']+_0x2f7802(0xda)+_0x2f7802(0xfb)+_0x473653[_0x5b280f][_0x2f7802(0xcd)]+_0x2f7802(0xda)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x473653[_0x5b280f][_0x2f7802(0x111)]+_0x2f7802(0xda)+_0x2f7802(0xfb)+_0x473653[_0x5b280f][_0x2f7802(0xe6)]+'</td>'+_0x2f7802(0xfb)+_0x473653[_0x5b280f][_0x2f7802(0x16e)]+'</td>'+_0x2f7802(0xfb)+_0x5cfcfd[_0x2f7802(0x16d)]+_0x2f7802(0xda)+_0x2f7802(0xfb)+_0x473653[_0x5b280f][_0x2f7802(0xb4)]+_0x2f7802(0xda)+_0x2f7802(0xfb)+_0x27bd1d+_0x473653[_0x5b280f][_0x2f7802(0x159)]+_0x2f7802(0xda)+_0x2f7802(0x16a);}let _0x1dc9a9=nodemailer[_0x2f7802(0x173)]({'host':_0x20fd4c[_0x2f7802(0xcf)],'port':Number(_0x20fd4c[_0x2f7802(0x162)]),'secure':![],'auth':{'user':_0x20fd4c[_0x2f7802(0x11e)],'pass':_0x20fd4c['password']}}),_0x591214={'from':_0x20fd4c['email'],'to':_0xf73844[0x0][_0x2f7802(0xb1)],'subject':_0x2f7802(0xaa),'attachments':[{'filename':_0x2f7802(0x15d),'path':__dirname+_0x2f7802(0xad)+_0x2f7802(0xdf)+_0xb4cefc[0x0]['image'],'cid':'logo'}],'html':_0x2f7802(0xe4)+_0x2f7802(0x147)+'</head><body>'+_0x2f7802(0xa7)+_0x2f7802(0x128)+_0x2f7802(0xa7)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2f7802(0x158)+_0x2f7802(0xa7)+_0x2f7802(0x144)+_0xb4cefc[0x0][_0x2f7802(0x110)]+_0x2f7802(0x104)+_0x2f7802(0x158)+'</div>'+_0x2f7802(0x105)+_0x2f7802(0xa7)+_0x2f7802(0x14b)+_0x2f7802(0x146)+_0x5cfcfd[_0x2f7802(0x15a)]+'\x20'+_0x2f7802(0xdc)+_0x2f7802(0x14f)+_0x5cfcfd[_0x2f7802(0x11d)]+'\x20'+_0x2f7802(0x117)+_0x2f7802(0x172)+_0x2f7802(0x158)+_0x2f7802(0x9e)+_0x2f7802(0x13b)+_0x2f7802(0xd7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2f7802(0xc5)+_0x2f7802(0xf5)+_0x2f7802(0x13e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x2f7802(0xf3)+_0x2f7802(0x13d)+'</tr>'+'</thead>'+_0x2f7802(0x167)+'\x20'+_0x4a2acb+'\x20'+_0x2f7802(0x11f)+_0x2f7802(0xaf)+_0x2f7802(0xa7)+_0x2f7802(0xb9)+_0x2f7802(0x12e)+_0xb4cefc[0x0][_0x2f7802(0x110)]+_0x2f7802(0x172)+_0x2f7802(0x158)+_0x2f7802(0x158)+'</body></html>'};_0x1dc9a9[_0x2f7802(0x115)](_0x591214,function(_0x30be97,_0x5b2584){var _0x4ae162=_0x2f7802;_0x30be97?(console[_0x4ae162(0x121)](_0x30be97),console[_0x4ae162(0x121)](_0x4ae162(0x13a))):console['log']('Email\x20sent\x20successfully');}),_0x4a34b8[_0x2f7802(0xbc)](_0x2f7802(0x15e),_0x2f7802(0x139)),_0x5b9980[_0x2f7802(0x12d)]('/picking_list/PDF_transfer/'+_0x4c8c3['_id']);}catch(_0x3357cb){console[_0x2f7802(0xbe)](_0x3357cb),_0x5b9980[_0x2f7802(0xa6)](0x1f4)[_0x2f7802(0xac)]({'error':_0x2f7802(0xa5)});}})[_0x4a602f(0x93)](_0x389a1b=>{var _0x2a6d07=_0x4a602f;console['error'](_0x389a1b),_0x5b9980[_0x2a6d07(0xa6)](0x1f4)[_0x2a6d07(0xac)]({'error':_0x2a6d07(0xae)});});}catch(_0x1d4c1f){console[_0x4a602f(0xbe)](_0x1d4c1f),_0x5b9980[_0x4a602f(0xa6)](0x1f4)[_0x4a602f(0xac)]({'error':_0x4a602f(0xe2)});}})[_0x586229(0x93)](_0x4e329a=>{var _0x4f2ae0=_0x586229;console[_0x4f2ae0(0xbe)](_0x4e329a),_0x5b9980[_0x4f2ae0(0xa6)](0x1f4)['json']({'error':_0x4f2ae0(0xae)});});}catch(_0x2bde26){_0x5b9980[_0x586229(0xac)]({'message':_0x2bde26[_0x586229(0xe3)]});}});function a0_0x420f(_0x126127,_0xb6ec2d){var _0xfef68d=a0_0xfef6();return a0_0x420f=function(_0x420ff3,_0x2e39b4){_0x420ff3=_0x420ff3-0x8f;var _0x3504a9=_0xfef68d[_0x420ff3];return _0x3504a9;},a0_0x420f(_0x126127,_0xb6ec2d);}function BayBinSelected(_0x37f2ff,_0x14dcfe){var _0x1e6288=a0_0x5ad9f2,_0xb1fa87=[];let _0x34a87f=[];var _0x4f34de=[];if(_0x37f2ff==_0x1e6288(0x99)){switch(_0x14dcfe){case'Rack\x201':_0xb1fa87=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1e6288(0xb0):_0xb1fa87=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4f34de=['DG'];}else{if(_0x37f2ff==_0x1e6288(0xff)){switch(_0x14dcfe){case'Rack\x201':_0xb1fa87=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1e6288(0xb0):_0xb1fa87=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4f34de=['FG'];}}return{'levels':_0xb1fa87,'identify':_0x4f34de};}router['get']('/view/:id',auth,async(_0x2c319e,_0x247af7)=>{var _0x31bd41=a0_0x5ad9f2;try{const {username:_0x7a29a0,email:_0x1acc10,role:_0x47b656}=_0x2c319e[_0x31bd41(0x141)],_0x5da07f=_0x2c319e[_0x31bd41(0x141)],_0x2993e7=await profile[_0x31bd41(0xf8)]({'email':_0x5da07f[_0x31bd41(0x11e)]}),_0x37e173=await master_shop[_0x31bd41(0xce)](),_0x158c28=await transfers_finished[_0x31bd41(0x108)](_0x2c319e[_0x31bd41(0xde)]['id']);let _0x561cba=new Date(_0x158c28[_0x31bd41(0x133)]),_0x1d6b75=('0'+_0x561cba[_0x31bd41(0xea)]())[_0x31bd41(0x126)](-0x2),_0x41cac8=('0'+(_0x561cba['getMonth']()+0x1))['slice'](-0x2),_0x29aeef=_0x561cba[_0x31bd41(0x155)](),_0x22daa4=_0x29aeef+'-'+_0x41cac8+'-'+_0x1d6b75,_0x3c6ae0;if(_0x5da07f[_0x31bd41(0x13f)]=='staff'){const _0x38e0a5=await staff[_0x31bd41(0xf8)]({'email':_0x5da07f[_0x31bd41(0x11e)]});_0x3c6ae0=await warehouse[_0x31bd41(0xce)]({'status':_0x31bd41(0xa9),'name':_0x38e0a5[_0x31bd41(0xd8)],'warehouse_category':'Finished\x20Goods'});}else _0x3c6ae0=await warehouse['find']({'status':_0x31bd41(0xa9),'warehouse_category':_0x31bd41(0xa0)});const _0x589cfc=await warehouse[_0x31bd41(0xf0)]([{'$match':{'name':_0x158c28[_0x31bd41(0x14e)],'room':_0x158c28[_0x31bd41(0x122)]}},{'$unwind':_0x31bd41(0x12f)},{'$group':{'_id':_0x31bd41(0x171),'name':{'$first':_0x31bd41(0xc6)},'product_stock':{'$first':_0x31bd41(0x137)},'bay':{'$first':_0x31bd41(0xd5)},'bin':{'$first':_0x31bd41(0xdb)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x31bd41(0xb3)},'primary_code':{'$first':_0x31bd41(0xab)},'secondary_code':{'$first':_0x31bd41(0xa2)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x31bd41(0xd9)},'rack':{'$first':'$product_details.rack'}}}]);var _0x242b8b=[0x1,0x2,0x3,0x4],_0x1c6f75=['A','B','C','D','E','F','G','H','I','J'],_0x5c5fb7=[_0x31bd41(0x9c),_0x31bd41(0xb5)];const _0x344b30=await product['find']({}),_0x5d96c0=BayBinSelected(_0x158c28[_0x31bd41(0x16d)],_0x158c28[_0x31bd41(0xb8)]);if(_0x37e173[0x0][_0x31bd41(0xee)]==_0x31bd41(0x168)){var _0x17fddb=users[_0x31bd41(0xeb)];console['log'](_0x17fddb);}else{if(_0x37e173[0x0]['language']=='Hindi')var _0x17fddb=users['Hindi'];else{if(_0x37e173[0x0][_0x31bd41(0xee)]==_0x31bd41(0x131))var _0x17fddb=users[_0x31bd41(0x131)];else{if(_0x37e173[0x0]['language']==_0x31bd41(0xa4))var _0x17fddb=users[_0x31bd41(0xa4)];else{if(_0x37e173[0x0][_0x31bd41(0xee)]==_0x31bd41(0x135))var _0x17fddb=users[_0x31bd41(0x135)];else{if(_0x37e173[0x0][_0x31bd41(0xee)]==_0x31bd41(0x91))var _0x17fddb=users[_0x31bd41(0x170)];else{if(_0x37e173[0x0]['language']==_0x31bd41(0xb6))var _0x17fddb=users[_0x31bd41(0xb6)];else{if(_0x37e173[0x0][_0x31bd41(0xee)]==_0x31bd41(0x150))var _0x17fddb=users[_0x31bd41(0x132)];}}}}}}}_0x247af7[_0x31bd41(0x142)](_0x31bd41(0xd6),{'success':_0x2c319e[_0x31bd41(0xbc)](_0x31bd41(0x15e)),'errors':_0x2c319e['flash'](_0x31bd41(0x165)),'role':_0x5da07f,'profile':_0x2993e7,'master_shop':_0x37e173,'warehouse':_0x3c6ae0,'transfer':_0x158c28,'stock':_0x589cfc,'unit':_0x344b30,'language':_0x17fddb,'levels':_0x242b8b,'Isle':_0x1c6f75,'rooms_data':_0x5c5fb7,'ed_fullDate':_0x22daa4,'dataSelected':_0x5d96c0});}catch(_0x1c250d){console[_0x31bd41(0x121)](_0x1c250d);}}),router[a0_0x5ad9f2(0x9f)](a0_0x5ad9f2(0xbb),auth,async(_0x14e6c9,_0x1be2c4)=>{var _0x5b46b3=a0_0x5ad9f2;try{const _0x15be05=_0x14e6c9[_0x5b46b3(0xde)]['id'];console[_0x5b46b3(0x121)](_0x14e6c9['body']);const _0x1a9e51=await transfers_finished[_0x5b46b3(0x108)](_0x15be05);console[_0x5b46b3(0x121)](_0x5b46b3(0x127),_0x1a9e51);const {date:_0x53ed69,from_warehouse:_0xf5b9b5,FromRoom_name:_0x57f74e,to_warehouse:_0x33be96,ToRoom_name:_0x29d85c,prod_name:_0x3491b8,from_prod_qty:_0x3bb9e9,from_prod_level:_0xb1f5da,from_prod_isle:_0xd2701e,from_prod_pallet:_0x5043de,to_prod_qty:_0x25345a,to_prod_level:_0x55b83a,to_prod_isle:_0x2405cd,to_prod_pallet:_0x432413,primary_code:_0x3fd790,secondary_code:_0xb11642,product_code3:_0x4edaa4,note:_0x372367,invoice:_0x5c9e47,expiry_date:_0x15f471}=_0x14e6c9[_0x5b46b3(0x112)];if(typeof _0x3491b8==_0x5b46b3(0xec))var _0x448678=[_0x14e6c9['body'][_0x5b46b3(0xf7)]],_0x111d60=[_0x14e6c9['body'][_0x5b46b3(0xc2)]],_0x3df9dd=[_0x14e6c9['body'][_0x5b46b3(0x125)]],_0x392756=[_0x14e6c9['body'][_0x5b46b3(0x107)]],_0x2e7283=[_0x14e6c9['body'][_0x5b46b3(0x123)]],_0x4205f0=[_0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x166)]],_0xf86047=[_0x14e6c9[_0x5b46b3(0x112)]['secondary_code']],_0x42715c=[_0x14e6c9['body'][_0x5b46b3(0xf2)]],_0x38e9e3=[_0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x143)]],_0x13e6ac=[_0x14e6c9['body']['unit']],_0x3688b4=[_0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x16e)]],_0x22d9ad=[_0x14e6c9[_0x5b46b3(0x112)]['batch_code']],_0x14b430=[_0x14e6c9[_0x5b46b3(0x112)]['expiry_date']];else var _0x448678=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0xf7)]],_0x111d60=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0xc2)]],_0x3df9dd=[..._0x14e6c9['body'][_0x5b46b3(0x125)]],_0x392756=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x107)]],_0x2e7283=[..._0x14e6c9['body'][_0x5b46b3(0x123)]],_0x4205f0=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x166)]],_0xf86047=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x9d)]],_0x42715c=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0xf2)]],_0x38e9e3=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x143)]],_0x13e6ac=[..._0x14e6c9['body'][_0x5b46b3(0xe6)]],_0x3688b4=[..._0x14e6c9[_0x5b46b3(0x112)]['secondary_unit']],_0x22d9ad=[..._0x14e6c9[_0x5b46b3(0x112)]['batch_code']],_0x14b430=[..._0x14e6c9[_0x5b46b3(0x112)][_0x5b46b3(0x133)]];const _0x1fd7c6=_0x448678[_0x5b46b3(0x157)](_0x991281=>{return _0x991281={'product_name':_0x991281};});_0x111d60[_0x5b46b3(0x16c)]((_0x2b1b8e,_0x8c66a7)=>{var _0x5cf933=_0x5b46b3;_0x1fd7c6[_0x8c66a7][_0x5cf933(0x140)]=_0x2b1b8e;}),_0x3df9dd[_0x5b46b3(0x16c)]((_0x58aa96,_0x10dc4d)=>{var _0x35f3cf=_0x5b46b3;_0x1fd7c6[_0x10dc4d][_0x35f3cf(0x103)]=_0x58aa96;}),_0x392756[_0x5b46b3(0x16c)]((_0x20f50c,_0x45987a)=>{var _0x53f87f=_0x5b46b3;_0x1fd7c6[_0x45987a][_0x53f87f(0x111)]=_0x20f50c;}),_0x2e7283[_0x5b46b3(0x16c)]((_0x5c8786,_0x2bfc0c)=>{_0x1fd7c6[_0x2bfc0c]['to_bay']=_0x5c8786;}),_0x4205f0[_0x5b46b3(0x16c)]((_0x5c7f10,_0x64d4f9)=>{_0x1fd7c6[_0x64d4f9]['primary_code']=_0x5c7f10;}),_0xf86047[_0x5b46b3(0x16c)]((_0x2887b0,_0x3ed800)=>{var _0x3c8249=_0x5b46b3;_0x1fd7c6[_0x3ed800][_0x3c8249(0x9d)]=_0x2887b0;}),_0x42715c[_0x5b46b3(0x16c)]((_0x3499d4,_0x36d682)=>{var _0x4a9378=_0x5b46b3;_0x1fd7c6[_0x36d682][_0x4a9378(0xcd)]=_0x3499d4;}),_0x38e9e3[_0x5b46b3(0x16c)]((_0x4ed2c9,_0x281f9c)=>{var _0x1ad865=_0x5b46b3;_0x1fd7c6[_0x281f9c][_0x1ad865(0x129)]=_0x4ed2c9;}),_0x13e6ac[_0x5b46b3(0x16c)]((_0xb19ddc,_0x4ec8da)=>{_0x1fd7c6[_0x4ec8da]['unit']=_0xb19ddc;}),_0x3688b4['forEach']((_0x300acc,_0x50869c)=>{var _0xcd5a57=_0x5b46b3;_0x1fd7c6[_0x50869c][_0xcd5a57(0x16e)]=_0x300acc;}),_0x22d9ad[_0x5b46b3(0x16c)]((_0x3d11fa,_0x1dedcf)=>{var _0x54c4e2=_0x5b46b3;_0x1fd7c6[_0x1dedcf][_0x54c4e2(0x145)]=_0x3d11fa;}),_0x14b430[_0x5b46b3(0x16c)]((_0x33bf9e,_0x5301dc)=>{_0x1fd7c6[_0x5301dc]['expiry_date']=_0x33bf9e;});const _0x2be10f=_0x1fd7c6['filter'](_0xa160d3=>_0xa160d3[_0x5b46b3(0x111)]!=='0'&&_0xa160d3[_0x5b46b3(0x111)]!==''||_0xa160d3['to_floorlevel']!=='0'&&_0xa160d3['to_floorlevel']!=='');var _0x5a5d53=0x0;_0x2be10f[_0x5b46b3(0x16c)](_0xb0fea0=>{var _0x5e3681=_0x5b46b3;parseInt(_0xb0fea0[_0x5e3681(0x140)])<parseInt(_0xb0fea0[_0x5e3681(0x111)])&&_0x5a5d53++;});if(_0x5a5d53!=0x0)return _0x14e6c9[_0x5b46b3(0xbc)]('errors',_0x5b46b3(0xc9)),_0x1be2c4[_0x5b46b3(0x12d)](_0x5b46b3(0x8f));const _0x1d02ae=await warehouse['findOne']({'name':_0x1a9e51[_0x5b46b3(0x14e)],'room':_0x1a9e51['from_room']});_0x1a9e51[_0x5b46b3(0x11c)][_0x5b46b3(0x16c)](_0x3de036=>{var _0x5e5311=_0x5b46b3;if(_0x3de036[_0x5e5311(0x111)]>0x0){const _0x39f0ab=_0x1d02ae['product_details']['map'](_0x202a48=>{var _0x6e3ad5=_0x5e5311;_0x202a48[_0x6e3ad5(0xbf)]==_0x3de036[_0x6e3ad5(0xbf)]&&_0x202a48[_0x6e3ad5(0xe1)]==_0x3de036[_0x6e3ad5(0x103)]&&(_0x202a48[_0x6e3ad5(0xed)]=parseInt(_0x202a48[_0x6e3ad5(0xed)])+parseInt(_0x3de036[_0x6e3ad5(0x111)]));});}}),await _0x1d02ae[_0x5b46b3(0xe5)]();const _0x3d55bd=await warehouse[_0x5b46b3(0xf8)]({'name':_0x1a9e51[_0x5b46b3(0x16d)],'room':_0x1a9e51[_0x5b46b3(0xb8)]});_0x1a9e51['product']['forEach'](_0xeb7d9b=>{var _0x47d957=_0x5b46b3;if(_0xeb7d9b[_0x47d957(0x111)]>0x0){const _0x205aa0=_0x3d55bd['product_details'][_0x47d957(0x157)](_0x1b6bd1=>{var _0x42e83e=_0x47d957;_0x1b6bd1[_0x42e83e(0xbf)]==_0xeb7d9b['product_name']&&_0x1b6bd1[_0x42e83e(0xe1)]==_0xeb7d9b[_0x42e83e(0x159)]&&(_0x1b6bd1['product_stock']=parseInt(_0x1b6bd1[_0x42e83e(0xed)])-parseInt(_0xeb7d9b[_0x42e83e(0x111)]));});}}),await _0x3d55bd['save'](),_0x1a9e51[_0x5b46b3(0x11d)]=_0x53ed69,_0x1a9e51[_0x5b46b3(0x14e)]=_0xf5b9b5,_0x1a9e51[_0x5b46b3(0x16d)]=_0x33be96,_0x1a9e51[_0x5b46b3(0x11c)]=_0x2be10f,_0x1a9e51[_0x5b46b3(0xcb)]=_0x372367,_0x1a9e51[_0x5b46b3(0x15a)]=_0x5c9e47;const _0x5435f5=await _0x1a9e51[_0x5b46b3(0xe5)](),_0x3bb7f6=await warehouse[_0x5b46b3(0xf8)]({'name':_0xf5b9b5,'room':_0x57f74e});_0x5435f5[_0x5b46b3(0x11c)][_0x5b46b3(0x16c)](_0x5b0308=>{var _0x56f8eb=_0x5b46b3;if(_0x5b0308['to_quantity']>0x0){const _0x5dac29=_0x3bb7f6[_0x56f8eb(0xa3)]['map'](_0x310259=>{var _0x1b5082=_0x56f8eb;_0x310259[_0x1b5082(0xbf)]==_0x5b0308[_0x1b5082(0xbf)]&&_0x310259[_0x1b5082(0xe1)]==_0x5b0308[_0x1b5082(0x103)]&&(_0x310259['product_stock']=parseInt(_0x310259[_0x1b5082(0xed)])-parseInt(_0x5b0308[_0x1b5082(0x111)]));});}}),await _0x3bb7f6['save']();const _0x3be2bb=await warehouse[_0x5b46b3(0xf8)]({'name':_0x33be96,'room':_0x29d85c});_0x5435f5[_0x5b46b3(0x11c)][_0x5b46b3(0x16c)](_0xfec1a3=>{var _0x9968d8=_0x5b46b3;if(_0xfec1a3[_0x9968d8(0x111)]>0x0){var _0x11fb8c=0x0;const _0x4fbc6d=_0x3be2bb[_0x9968d8(0xa3)][_0x9968d8(0x157)](_0x2df039=>{var _0x3323fd=_0x9968d8;_0x2df039[_0x3323fd(0xbf)]==_0xfec1a3[_0x3323fd(0xbf)]&&_0x2df039[_0x3323fd(0xe1)]==_0xfec1a3[_0x3323fd(0x159)]&&(_0x2df039[_0x3323fd(0xed)]=parseInt(_0x2df039[_0x3323fd(0xed)])+parseInt(_0xfec1a3['to_quantity']),_0x11fb8c++);});_0x11fb8c=='0'&&(_0x3be2bb['product_details']=_0x3be2bb[_0x9968d8(0xa3)][_0x9968d8(0x9b)]({'product_name':_0xfec1a3[_0x9968d8(0xbf)],'product_stock':_0xfec1a3[_0x9968d8(0x111)],'bay':_0xfec1a3[_0x9968d8(0x159)],'product_code':_0xfec1a3[_0x9968d8(0xcd)],'primary_code':_0xfec1a3[_0x9968d8(0x166)],'secondary_code':_0xfec1a3[_0x9968d8(0x9d)],'maxProducts':_0xfec1a3[_0x9968d8(0x129)]}));}}),await _0x3be2bb[_0x5b46b3(0xe5)](),_0x14e6c9[_0x5b46b3(0xbc)](_0x5b46b3(0x15e),_0x5b46b3(0xdd)),_0x1be2c4[_0x5b46b3(0x12d)](_0x5b46b3(0x95));}catch(_0x396277){console[_0x5b46b3(0x121)](_0x396277);}}),router['post'](a0_0x5ad9f2(0xf4),async(_0x33677d,_0x598650)=>{var _0x5d9ed3=a0_0x5ad9f2;const {FromWareHouse:_0x1be991,FromRoom:_0x39f155,ToWarehouse:_0x2ff20a,ToRoom:_0x2b08b9,primary_code:_0x1884b0,Roomslist:_0x1f8a8c}=_0x33677d[_0x5d9ed3(0x112)],_0x35710c=_0x1f8a8c[_0x5d9ed3(0x10b)](','),_0xef727d=[];async function _0x370ae8(_0x5bd53c){var _0x278345=_0x5d9ed3;const _0x21c87f=await warehouse['aggregate']([{'$match':{'name':_0x1be991,'room':_0x5bd53c}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1884b0}},{'$group':{'_id':_0x278345(0x171),'name':{'$first':_0x278345(0xc6)},'instock':{'$first':_0x278345(0x137)},'primary_code':{'$first':_0x278345(0xab)},'secondary_code':{'$first':_0x278345(0xa2)},'product_code':{'$first':_0x278345(0x151)},'level':{'$first':_0x278345(0xd5)},'isle':{'$first':_0x278345(0xdb)},'type':{'$first':_0x278345(0x98)},'pallet':{'$first':_0x278345(0xb3)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x278345(0xd9)},'rack':{'$first':_0x278345(0xe8)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x278345(0x92)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x278345(0x94)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4775a5=await warehouse[_0x278345(0xf0)]([{'$match':{'name':_0x1be991,'room':_0x5bd53c}},{'$unwind':_0x278345(0x12f)},{'$match':{'product_details.secondary_code':_0x1884b0}},{'$group':{'_id':_0x278345(0x171),'name':{'$first':_0x278345(0xc6)},'instock':{'$first':_0x278345(0x137)},'primary_code':{'$first':_0x278345(0xab)},'secondary_code':{'$first':_0x278345(0xa2)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x278345(0xd5)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x278345(0x98)},'pallet':{'$first':_0x278345(0xb3)},'unit':{'$first':_0x278345(0x138)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x278345(0xe8)},'expiry_date':{'$first':_0x278345(0x164)},'production_date':{'$first':_0x278345(0xfe)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x278345(0x15b)},'roomNamed':{'$first':_0x278345(0x94)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x278345(0xba)}}}]);if(_0x21c87f[_0x278345(0x114)]>0x0)_0xef727d['push'](_0x21c87f);else _0x4775a5[_0x278345(0x114)]>0x0&&_0xef727d[_0x278345(0x124)](_0x4775a5);}const _0x281645=_0x35710c[_0x5d9ed3(0x157)](_0x178fa2=>_0x370ae8(_0x178fa2));await Promise['all'](_0x281645),_0x598650[_0x5d9ed3(0xac)](_0xef727d);}),router[a0_0x5ad9f2(0x9f)](a0_0x5ad9f2(0x10a),async(_0x7e1153,_0xafe02c)=>{var _0x4be0e3=a0_0x5ad9f2;try{const {FromWareHouse:_0x3dfa26,FromRoom:_0x3f426f,ToWarehouse:_0x335e6e,ToRoom:_0x61ed03,secondary_code:_0x18412e}=_0x7e1153['body'],_0x4a8922=await warehouse[_0x4be0e3(0xf0)]([{'$match':{'name':_0x3dfa26}},{'$unwind':_0x4be0e3(0x12f)},{'$match':{'product_details.secondary_code':_0x18412e}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x4be0e3(0xab)},'secondary_code':{'$first':_0x4be0e3(0xa2)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x4be0e3(0x137)},'warehouse':{'$first':_0x4be0e3(0x101)},'level':{'$first':_0x4be0e3(0x116)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4be0e3(0xf1)},'maxProducts':{'$first':_0x4be0e3(0x10e)},'unit':{'$first':_0x4be0e3(0x138)},'expiry_date':{'$first':_0x4be0e3(0x164)},'production_date':{'$first':_0x4be0e3(0xfe)}}}]);_0xafe02c['status'](0xc8)['json'](_0x4a8922);}catch(_0xfb467c){_0xafe02c[_0x4be0e3(0xa6)](0x194)[_0x4be0e3(0xac)]({'message':_0xfb467c[_0x4be0e3(0xe3)]});}}),router[a0_0x5ad9f2(0x9f)](a0_0x5ad9f2(0x148),async(_0x50900f,_0x5f386d)=>{var _0x467792=a0_0x5ad9f2;try{const {FromWareHouse:_0x3bcf96,FromRoom:_0x4d1c18,ToWarehouse:_0x455749,ToRoom:_0x2341bc,product_code:_0x342d3a}=_0x50900f[_0x467792(0x112)],_0x2d8694=await warehouse[_0x467792(0xf0)]([{'$match':{'name':_0x3bcf96}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x342d3a}},{'$group':{'_id':_0x467792(0x171),'name':{'$first':_0x467792(0xc6)},'primary_code':{'$first':_0x467792(0xab)},'secondary_code':{'$first':_0x467792(0xa2)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x467792(0x137)},'warehouse':{'$first':_0x467792(0x101)},'level':{'$first':_0x467792(0x116)},'isle':{'$first':_0x467792(0x10d)},'pallet':{'$first':_0x467792(0xf1)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x467792(0x138)}}}]);_0x5f386d[_0x467792(0xa6)](0xc8)[_0x467792(0xac)](_0x2d8694);}catch(_0x315d7b){_0x5f386d['status'](0x194)[_0x467792(0xac)]({'message':_0x315d7b[_0x467792(0xe3)]});}}),router[a0_0x5ad9f2(0x9f)](a0_0x5ad9f2(0x10c),async(_0x29e303,_0x243137)=>{var _0x309034=a0_0x5ad9f2;const {productCode:_0x51b761,bay:_0xf9c7c1,warehouses:_0x52b74b,room:_0x428878}=_0x29e303['body'];console[_0x309034(0x121)](_0x29e303[_0x309034(0x112)]);try{const _0x5a63dc=await warehouse['aggregate']([{'$match':{'name':_0x52b74b,'room':_0x428878}},{'$unwind':_0x309034(0x12f)},{'$match':{'product_details.bay':parseInt(_0xf9c7c1)}},{'$group':{'_id':_0x309034(0x171),'name':{'$first':_0x309034(0xc6)},'product_stock':{'$first':_0x309034(0x137)},'bay':{'$first':_0x309034(0xd5)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x243137[_0x309034(0xa6)](0xc8)[_0x309034(0xac)](_0x5a63dc);}catch(_0x86e478){_0x243137[_0x309034(0xa6)](0x194)['json']({'message':_0x86e478[_0x309034(0xe3)]});}}),module[a0_0x5ad9f2(0x119)]=router;