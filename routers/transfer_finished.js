var a0_0x3e53a0=a0_0x3350;function a0_0x3350(_0x3a622f,_0x1603e4){var _0x2d0a6a=a0_0x2d0a();return a0_0x3350=function(_0x33502a,_0x4b2fda){_0x33502a=_0x33502a-0x1b1;var _0x6d33be=_0x2d0a6a[_0x33502a];return _0x6d33be;},a0_0x3350(_0x3a622f,_0x1603e4);}(function(_0x44a20b,_0x824a9e){var _0x376a31=a0_0x3350,_0xa466de=_0x44a20b();while(!![]){try{var _0x1c906b=parseInt(_0x376a31(0x1e7))/0x1*(-parseInt(_0x376a31(0x1bc))/0x2)+parseInt(_0x376a31(0x280))/0x3+parseInt(_0x376a31(0x212))/0x4+-parseInt(_0x376a31(0x1d6))/0x5*(-parseInt(_0x376a31(0x1fa))/0x6)+parseInt(_0x376a31(0x1de))/0x7*(parseInt(_0x376a31(0x261))/0x8)+parseInt(_0x376a31(0x1b2))/0x9+-parseInt(_0x376a31(0x242))/0xa;if(_0x1c906b===_0x824a9e)break;else _0xa466de['push'](_0xa466de['shift']());}catch(_0x4bcf9e){_0xa466de['push'](_0xa466de['shift']());}}}(a0_0x2d0a,0x53380));const express=require(a0_0x3e53a0(0x1f2)),app=express(),router=express[a0_0x3e53a0(0x28b)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x3e53a0(0x1ba)),auth=require(a0_0x3e53a0(0x251)),users=require(a0_0x3e53a0(0x217)),nodemailer=require(a0_0x3e53a0(0x27a));router[a0_0x3e53a0(0x237)](a0_0x3e53a0(0x1c4),auth,async(_0x5acbdd,_0x26b65c)=>{var _0x20ab45=a0_0x3e53a0;try{const {username:_0x183bc7,email:_0x14c91c,role:_0x28f9a7}=_0x5acbdd['user'],_0x2a0461=_0x5acbdd[_0x20ab45(0x216)],_0x51721d=await profile[_0x20ab45(0x267)]({'email':_0x2a0461[_0x20ab45(0x205)]}),_0xaed90c=await master_shop[_0x20ab45(0x1e9)]();let _0x5d7923;if(_0x2a0461['role']==_0x20ab45(0x1d1)){const _0x1b85df=await staff[_0x20ab45(0x267)]({'email':_0x2a0461['email']});_0x5d7923=await transfers_finished[_0x20ab45(0x1e9)]({'from_warehouse':_0x1b85df[_0x20ab45(0x27e)]});}else _0x5d7923=await transfers_finished[_0x20ab45(0x228)]([{'$unwind':_0x20ab45(0x25c)},{'$group':{'_id':_0x20ab45(0x24f),'invoice':{'$first':_0x20ab45(0x1fd)},'date':{'$first':_0x20ab45(0x226)},'from_warehouse':{'$first':_0x20ab45(0x239)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x20ab45(0x232)},'to_room_name':{'$addToSet':_0x20ab45(0x1c1)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0xaed90c[0x0]['language']==_0x20ab45(0x1f1))var _0x4a77ca=users[_0x20ab45(0x21e)];else{if(_0xaed90c[0x0][_0x20ab45(0x268)]==_0x20ab45(0x274))var _0x4a77ca=users['Hindi'];else{if(_0xaed90c[0x0][_0x20ab45(0x268)]=='German')var _0x4a77ca=users[_0x20ab45(0x1c9)];else{if(_0xaed90c[0x0][_0x20ab45(0x268)]=='Spanish')var _0x4a77ca=users[_0x20ab45(0x1bd)];else{if(_0xaed90c[0x0][_0x20ab45(0x268)]=='French')var _0x4a77ca=users[_0x20ab45(0x231)];else{if(_0xaed90c[0x0][_0x20ab45(0x268)]==_0x20ab45(0x1f8))var _0x4a77ca=users[_0x20ab45(0x238)];else{if(_0xaed90c[0x0][_0x20ab45(0x268)]==_0x20ab45(0x24c))var _0x4a77ca=users[_0x20ab45(0x24c)];else{if(_0xaed90c[0x0]['language']==_0x20ab45(0x1cd))var _0x4a77ca=users[_0x20ab45(0x263)];}}}}}}}_0x26b65c[_0x20ab45(0x25e)]('transfer_finished',{'success':_0x5acbdd[_0x20ab45(0x1bf)](_0x20ab45(0x1e6)),'errors':_0x5acbdd[_0x20ab45(0x1bf)](_0x20ab45(0x283)),'role':_0x2a0461,'profile':_0x51721d,'master_shop':_0xaed90c,'transfer':_0x5d7923,'language':_0x4a77ca});}catch(_0x3cbf0c){console[_0x20ab45(0x23b)](_0x3cbf0c);}});function a0_0x2d0a(){var _0x224afe=['express','ToRoomAssigned','$product_details.level','$room','$product_details.type','\x20Order\x20Date\x20:\x20','Portuguese\x20(BR)','message','955254kzLUpo','$product_details.production_date','</body></html>','$invoice','random','prod_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','QA\x20Warehouse','then','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','email','maxPerUnit','host','batch_code','note','$product_details.floorlevel','$product_details.bin','push','<h2>\x20','expiry_date','secondary_code','$product_details.expiry_date','concat','3388aawfrJ','Rack\x201','primary_unit','</tr>','user','../public/language/languages.json','forEach','<span\x20style=\x22float:\x20right;\x22>','$product_details.unit','<div>','To_invoice','$product_details._id','English','</head><body>','_id','error','findById','$product_details.bay','date','$product_details.secondary_unit','$date','to_prod_level','aggregate','New_Qty_Converted','port','/CheckingWarehouse','to_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.isle','DRY\x20GOODS','$product_details.secondary_code','French','$product.from_room_name','$product_details.pallet','role','/barcode_scanner','$product_details','get','Portuguese','$from_warehouse','getFullYear','log','</td>','from_warehouse','MaxStocks_data','from_room_name','edit_transfer_finished','body','5343320iARPXi','$product_details.product_name','floor','product_code','image','$product_details.storage','</thead>','length','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','from_prod_level','Chinese','$name','logo','$_id','secondary_unit','../middleware/auth','Rack\x202','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.rack','getMonth','$product_details.maxProducts','Enabled','from_prod_qty','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.product_code','$product','<h5\x20style=\x22text-align:\x20left;\x22>','render','$product_details.product_stock','</h5>','184KlxkLp','to_warehouse','Arabic','catch','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','filter','findOne','language','to_room','/picking_list/PDF_transfer/','Error\x20Occurs','<!DOCTYPE\x20html>','to_bay','maxProducts','</div>','unit','edit_transfer_finished_view','An\x20error\x20occurred.','TRFF-','Hindi','product_stock','to_prod_qty','Finished\x20Goods','to_invoice','from_invoice','nodemailer','sendMail','$product_details.invoice','string','warehouse','<tr>','1137666VsfEVR','slice','RoomAssigned','errors','</span>','invoice','/view/add_transfer','updateOne','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Router','Transfer\x20Edit\x20Successfully','3354840jdcFYA','$product_details.maxPerUnit','to_floorlevel','product_name','json','There\x27s\x20a\x20error\x20in\x20this\x20transaction','product_details','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','../models/all_models','getDate','2198gfQsYG','Spanish','from_bay','flash','from_room','$product.to_room_name','from_quantity','exports','/view','primary_code','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/transfer_finished/view','German','/barcode_scanner2','<tbody\x20style=\x22text-align:\x20center;\x22>','to_room_name','Arabic\x20(ae)','FGSEmail','all','<table\x20style=\x22width:\x20100%\x20!important;\x22>','staff','/preview/:id','product_date','production_date','redirect','5EIqqRU','add_transfer_finished','$product_details.primary_code','save','Product\x20Transfer\x20successfully','map','prod_cat','Enclosed','15211yIQmsV','password','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<html><head><title></title>','transfer_data','bay','product_code3','success','79xAmofM','status','find','params','back','/../public','site_title','$product_details.batch_code','toString','MaxStocks_data2','English\x20(US)'];a0_0x2d0a=function(){return _0x224afe;};return a0_0x2d0a();}async function getRandom8DigitNumber(){var _0xcf57da=a0_0x3e53a0;const _0x4bf350=0x989680,_0x2bfe22=0x5f5e0ff,_0x281ded=Math[_0xcf57da(0x244)](Math[_0xcf57da(0x1fe)]()*(_0x2bfe22-_0x4bf350+0x1))+_0x4bf350;var _0x509190;const _0x4e3ba1=await transfers_finished[_0xcf57da(0x267)]({'invoice':'TRFF-'+_0x281ded});return _0x4e3ba1&&_0x4e3ba1[_0xcf57da(0x249)]>0x0?_0x509190=_0xcf57da(0x273)+_0x281ded:_0x509190=_0xcf57da(0x273)+_0x281ded,_0x509190;}router[a0_0x3e53a0(0x237)](a0_0x3e53a0(0x286),auth,async(_0x4c3abb,_0x56ad7c)=>{var _0x5cbc5f=a0_0x3e53a0;try{const {username:_0x35a816,email:_0x56ced1,role:_0x1ce7ea}=_0x4c3abb['user'],_0x44454c=_0x4c3abb[_0x5cbc5f(0x216)],_0xbe7810=await profile[_0x5cbc5f(0x267)]({'email':_0x44454c['email']}),_0x438060=await master_shop['find']();let _0x480de7;if(_0x44454c[_0x5cbc5f(0x234)]=='staff'){const _0x59ba93=await staff[_0x5cbc5f(0x267)]({'email':_0x44454c[_0x5cbc5f(0x205)]});_0x480de7=await warehouse['aggregate']([{'$match':{'status':_0x5cbc5f(0x258),'name':_0x59ba93[_0x5cbc5f(0x27e)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x5cbc5f(0x201)}}},{'$group':{'_id':_0x5cbc5f(0x24d),'name':{'$first':'$name'}}}]);}else _0x480de7=await warehouse['aggregate']([{'$match':{'status':_0x5cbc5f(0x258),'warehouse_category':_0x5cbc5f(0x277),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x5cbc5f(0x24d),'name':{'$first':_0x5cbc5f(0x24d)}}}]);const _0x37e744=await transfers_finished['find']({}),_0xbb1fc=_0x37e744[_0x5cbc5f(0x249)]+0x1,_0x4c9331=_0x5cbc5f(0x273)+_0xbb1fc[_0x5cbc5f(0x1ef)]()[_0x5cbc5f(0x1e0)](0x5,'0');if(_0x438060[0x0][_0x5cbc5f(0x268)]==_0x5cbc5f(0x1f1))var _0x55849a=users[_0x5cbc5f(0x21e)];else{if(_0x438060[0x0][_0x5cbc5f(0x268)]==_0x5cbc5f(0x274))var _0x55849a=users['Hindi'];else{if(_0x438060[0x0][_0x5cbc5f(0x268)]==_0x5cbc5f(0x1c9))var _0x55849a=users[_0x5cbc5f(0x1c9)];else{if(_0x438060[0x0]['language']==_0x5cbc5f(0x1bd))var _0x55849a=users[_0x5cbc5f(0x1bd)];else{if(_0x438060[0x0][_0x5cbc5f(0x268)]==_0x5cbc5f(0x231))var _0x55849a=users[_0x5cbc5f(0x231)];else{if(_0x438060[0x0][_0x5cbc5f(0x268)]=='Portuguese\x20(BR)')var _0x55849a=users['Portuguese'];else{if(_0x438060[0x0]['language']==_0x5cbc5f(0x24c))var _0x55849a=users[_0x5cbc5f(0x24c)];else{if(_0x438060[0x0][_0x5cbc5f(0x268)]==_0x5cbc5f(0x1cd))var _0x55849a=users[_0x5cbc5f(0x263)];}}}}}}}const _0x5c9d50=getRandom8DigitNumber();_0x5c9d50[_0x5cbc5f(0x202)](_0x3ed980=>{var _0x4c6349=_0x5cbc5f;_0x56ad7c[_0x4c6349(0x25e)](_0x4c6349(0x1d7),{'success':_0x4c3abb[_0x4c6349(0x1bf)](_0x4c6349(0x1e6)),'errors':_0x4c3abb[_0x4c6349(0x1bf)](_0x4c6349(0x283)),'role':_0x44454c,'profile':_0xbe7810,'master_shop':_0x438060,'warehouse':_0x480de7,'language':_0x55849a,'invoice':_0x3ed980});})[_0x5cbc5f(0x264)](_0x1dc2bd=>{var _0x1a509d=_0x5cbc5f;_0x4c3abb['flash'](_0x1a509d(0x283),_0x1a509d(0x1b7)),_0x56ad7c['redirect']('/transfer/view');});}catch(_0x141325){console[_0x5cbc5f(0x23b)](_0x141325);}}),router['post'](a0_0x3e53a0(0x286),auth,async(_0x57bfa9,_0x565e5a)=>{var _0xd43ae3=a0_0x3e53a0;try{const {date:_0x4bf20b,from_warehouse:_0x51ffab,FromRoom_name:_0x3790a0,to_warehouse:_0x5ee79d,ToRoom_name:_0x43fd15,prod_name:_0x51499d,from_prod_qty:_0x30872d,from_prod_level:_0x848d3e,from_prod_isle:_0x1de953,from_prod_pallet:_0x24ee89,to_prod_qty:_0x3ef507,to_prod_level:_0x5174bb,to_prod_isle:_0x2b47db,to_prod_pallet:_0x26abcc,primary_code:_0x2dbafb,secondary_code:_0x27ce06,product_code3:_0x18b62e,note:_0x55ae38,MaxStocks_data2:_0x56e01d,invoice:_0x6a7a39,expiry_date:_0x482401}=_0x57bfa9[_0xd43ae3(0x241)];if(typeof _0x51499d=='string')var _0x50597c=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1ff)]],_0x581cf5=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x259)]],_0x3d4a89=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x24b)]],_0x1addc1=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x229)]],_0x538c84=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x227)]],_0x48a2ce=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1c5)]],_0x3d871b=[_0x57bfa9['body']['secondary_code']],_0x13437c=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1e5)]],_0x35a95b=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1f0)]],_0x166c95=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x214)]],_0x3af556=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x250)]],_0x55ac13=[_0x57bfa9['body']['batch_code']],_0x2a7ac6=[_0x57bfa9[_0xd43ae3(0x241)]['expiry_date']],_0x4c36d4=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1d3)]],_0x194300=[_0x57bfa9['body']['MaxStocks_data']],_0x30a53b=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x206)]],_0x3fed63=[_0x57bfa9[_0xd43ae3(0x241)]['prod_cat']],_0x36a1d3=[_0x57bfa9['body'][_0xd43ae3(0x282)]],_0x4d8f45=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1f3)]],_0x584993=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x279)]],_0x560ef8=[_0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x278)]];else var _0x50597c=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1ff)]],_0x581cf5=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x259)]],_0x3d4a89=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x24b)]],_0x1addc1=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x229)]],_0x538c84=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x227)]],_0x48a2ce=[..._0x57bfa9[_0xd43ae3(0x241)]['primary_code']],_0x3d871b=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x20f)]],_0x13437c=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1e5)]],_0x35a95b=[..._0x57bfa9[_0xd43ae3(0x241)]['MaxStocks_data2']],_0x166c95=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x214)]],_0x3af556=[..._0x57bfa9[_0xd43ae3(0x241)]['secondary_unit']],_0x55ac13=[..._0x57bfa9['body'][_0xd43ae3(0x208)]],_0x2a7ac6=[..._0x57bfa9['body'][_0xd43ae3(0x20e)]],_0x4c36d4=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x1d3)]],_0x194300=[..._0x57bfa9['body'][_0xd43ae3(0x23e)]],_0x30a53b=[..._0x57bfa9[_0xd43ae3(0x241)]['maxPerUnit']],_0x3fed63=[..._0x57bfa9[_0xd43ae3(0x241)]['prod_cat']],_0x36a1d3=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x282)]],_0x4d8f45=[..._0x57bfa9[_0xd43ae3(0x241)]['ToRoomAssigned']],_0x584993=[..._0x57bfa9[_0xd43ae3(0x241)]['from_invoice']],_0x560ef8=[..._0x57bfa9[_0xd43ae3(0x241)][_0xd43ae3(0x278)]];const _0x4cd509=_0x50597c[_0xd43ae3(0x1db)](_0x47e77c=>{return _0x47e77c={'product_name':_0x47e77c};});_0x581cf5[_0xd43ae3(0x218)]((_0x2f3c7b,_0x1bd0fd)=>{var _0x206510=_0xd43ae3;_0x4cd509[_0x1bd0fd][_0x206510(0x1c2)]=_0x2f3c7b;}),_0x3d4a89['forEach']((_0x4a1a70,_0xb25db7)=>{var _0x38e699=_0xd43ae3;_0x4cd509[_0xb25db7][_0x38e699(0x1be)]=_0x4a1a70;}),_0x584993['forEach']((_0x1a162d,_0x1d03c1)=>{var _0xe67964=_0xd43ae3;_0x4cd509[_0x1d03c1][_0xe67964(0x279)]=_0x1a162d;}),_0x560ef8[_0xd43ae3(0x218)]((_0x21bb1d,_0x531201)=>{var _0x41752a=_0xd43ae3;_0x4cd509[_0x531201][_0x41752a(0x21c)]=_0x21bb1d;}),_0x1addc1['forEach']((_0x67dd3,_0x30930e)=>{var _0x4299b2=_0xd43ae3;_0x4cd509[_0x30930e][_0x4299b2(0x22c)]=_0x67dd3;}),_0x538c84['forEach']((_0x25329f,_0x120e51)=>{var _0x5dea52=_0xd43ae3;_0x4cd509[_0x120e51][_0x5dea52(0x26d)]=_0x25329f;}),_0x48a2ce[_0xd43ae3(0x218)]((_0x54b50b,_0x27c5ac)=>{_0x4cd509[_0x27c5ac]['primary_code']=_0x54b50b;}),_0x3d871b[_0xd43ae3(0x218)]((_0x268579,_0x380cb3)=>{_0x4cd509[_0x380cb3]['secondary_code']=_0x268579;}),_0x13437c['forEach']((_0x18a106,_0x1ef1d3)=>{_0x4cd509[_0x1ef1d3]['product_code']=_0x18a106;}),_0x35a95b[_0xd43ae3(0x218)]((_0x5d04c9,_0x4c4f62)=>{var _0xe9343d=_0xd43ae3;_0x4cd509[_0x4c4f62][_0xe9343d(0x26e)]=_0x5d04c9;}),_0x166c95[_0xd43ae3(0x218)]((_0x3aefc4,_0x317840)=>{var _0x3a55b8=_0xd43ae3;_0x4cd509[_0x317840][_0x3a55b8(0x270)]=_0x3aefc4;}),_0x3af556[_0xd43ae3(0x218)]((_0x482dfe,_0x3226ef)=>{_0x4cd509[_0x3226ef]['secondary_unit']=_0x482dfe;}),_0x55ac13[_0xd43ae3(0x218)]((_0x11ef80,_0x4b935c)=>{_0x4cd509[_0x4b935c]['batch_code']=_0x11ef80;}),_0x2a7ac6[_0xd43ae3(0x218)]((_0x1b1e4d,_0x8daaeb)=>{var _0x5cd937=_0xd43ae3;_0x4cd509[_0x8daaeb][_0x5cd937(0x20e)]=_0x1b1e4d;}),_0x4c36d4[_0xd43ae3(0x218)]((_0x12290f,_0x53a677)=>{_0x4cd509[_0x53a677]['production_date']=_0x12290f;}),_0x194300[_0xd43ae3(0x218)]((_0x48243f,_0x51c8ab)=>{_0x4cd509[_0x51c8ab]['maxProducts']=_0x48243f;}),_0x30a53b[_0xd43ae3(0x218)]((_0x537bae,_0xd493f7)=>{_0x4cd509[_0xd493f7]['maxPerUnit']=_0x537bae;}),_0x3fed63['forEach']((_0x4bb414,_0x30c81e)=>{var _0x1a1b07=_0xd43ae3;_0x4cd509[_0x30c81e][_0x1a1b07(0x1dc)]=_0x4bb414;}),_0x36a1d3['forEach']((_0x2c4f66,_0x402a42)=>{var _0x3586ba=_0xd43ae3;_0x4cd509[_0x402a42][_0x3586ba(0x23f)]=_0x2c4f66;}),_0x4d8f45[_0xd43ae3(0x218)]((_0x31c1fa,_0x4e60ff)=>{var _0x38e3d3=_0xd43ae3;_0x4cd509[_0x4e60ff][_0x38e3d3(0x1cc)]=_0x31c1fa;});const _0x59ca07=_0x4cd509[_0xd43ae3(0x266)](_0x3db230=>_0x3db230[_0xd43ae3(0x22c)]!=='0'&&_0x3db230[_0xd43ae3(0x22c)]!==''||_0x3db230[_0xd43ae3(0x1b4)]!=='0'&&_0x3db230['to_floorlevel']!=='');var _0x28db05=0x0;_0x59ca07[_0xd43ae3(0x218)](_0x166e9f=>{var _0x1919e6=_0xd43ae3;parseInt(_0x166e9f[_0x1919e6(0x1c2)])<parseInt(_0x166e9f[_0x1919e6(0x22c)])&&_0x28db05++;});if(_0x28db05!=0x0)return _0x57bfa9[_0xd43ae3(0x1bf)](_0xd43ae3(0x283),_0xd43ae3(0x1b9)),_0x565e5a['redirect'](_0xd43ae3(0x1eb));const _0x495012=new transfers_finished({'date':_0x4bf20b,'from_warehouse':_0x51ffab,'to_warehouse':_0x5ee79d,'product':_0x59ca07,'note':_0x55ae38,'invoice':_0x6a7a39}),_0x46cb10=await _0x495012[_0xd43ae3(0x1d9)]();_0x57bfa9['flash'](_0xd43ae3(0x1e6),_0xd43ae3(0x1da)),_0x565e5a[_0xd43ae3(0x1d5)]('/transfer_finished/preview/'+_0x46cb10[_0xd43ae3(0x220)]);}catch(_0x2fecfc){console['log'](_0x2fecfc),_0x565e5a[_0xd43ae3(0x1e8)](0xc8)[_0xd43ae3(0x1b6)]({'errorMessage':_0x2fecfc['message']});}}),router[a0_0x3e53a0(0x237)](a0_0x3e53a0(0x1d2),auth,async(_0x9e8267,_0x193405)=>{var _0x15840c=a0_0x3e53a0;try{const {username:_0x4629d4,email:_0x109dc1,role:_0x2689d7}=_0x9e8267['user'],_0x5a2b5c=_0x9e8267['user'],_0xdf4e5f=await profile['findOne']({'email':_0x5a2b5c[_0x15840c(0x205)]}),_0x324131=await master_shop[_0x15840c(0x1e9)](),_0x42522c=await transfers_finished[_0x15840c(0x222)](_0x9e8267[_0x15840c(0x1ea)]['id']);let _0x166d75;if(_0x5a2b5c[_0x15840c(0x234)]==_0x15840c(0x1d1)){const _0xd3c589=await staff[_0x15840c(0x267)]({'email':_0x5a2b5c[_0x15840c(0x205)]});_0x166d75=await warehouse['find']({'status':'Enabled','name':_0xd3c589[_0x15840c(0x27e)],'warehouse_category':_0x15840c(0x277)});}else _0x166d75=await warehouse[_0x15840c(0x1e9)]({'status':_0x15840c(0x258),'warehouse_category':'Finished\x20Goods'});const _0x46cecd=await warehouse[_0x15840c(0x228)]([{'$match':{'name':_0x42522c[_0x15840c(0x23d)],'warehouse_category':_0x15840c(0x277)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x15840c(0x21d),'name':{'$first':_0x15840c(0x243)},'product_stock':{'$first':_0x15840c(0x25f)},'bay':{'$first':_0x15840c(0x223)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x15840c(0x1f6)},'floorlevel':{'$first':_0x15840c(0x20a)},'primary_code':{'$first':_0x15840c(0x1d8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x15840c(0x25b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x15840c(0x255)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x15840c(0x1fb)},'room':{'$first':_0x15840c(0x1f5)},'warehoue_name':{'$first':_0x15840c(0x24d)}}}]),_0x57de1a=await product[_0x15840c(0x1e9)]({});if(_0x324131[0x0][_0x15840c(0x268)]==_0x15840c(0x1f1)){var _0x285b0a=users[_0x15840c(0x21e)];console['log'](_0x285b0a);}else{if(_0x324131[0x0][_0x15840c(0x268)]==_0x15840c(0x274))var _0x285b0a=users[_0x15840c(0x274)];else{if(_0x324131[0x0][_0x15840c(0x268)]==_0x15840c(0x1c9))var _0x285b0a=users['German'];else{if(_0x324131[0x0][_0x15840c(0x268)]==_0x15840c(0x1bd))var _0x285b0a=users[_0x15840c(0x1bd)];else{if(_0x324131[0x0]['language']=='French')var _0x285b0a=users['French'];else{if(_0x324131[0x0][_0x15840c(0x268)]=='Portuguese\x20(BR)')var _0x285b0a=users[_0x15840c(0x238)];else{if(_0x324131[0x0][_0x15840c(0x268)]==_0x15840c(0x24c))var _0x285b0a=users['Chinese'];else{if(_0x324131[0x0][_0x15840c(0x268)]==_0x15840c(0x1cd))var _0x285b0a=users[_0x15840c(0x263)];}}}}}}}_0x193405[_0x15840c(0x25e)](_0x15840c(0x271),{'success':_0x9e8267['flash']('success'),'errors':_0x9e8267[_0x15840c(0x1bf)](_0x15840c(0x283)),'role':_0x5a2b5c,'profile':_0xdf4e5f,'master_shop':_0x324131,'warehouse':_0x166d75,'transfer':_0x42522c,'stock':_0x46cecd,'unit':_0x57de1a,'language':_0x285b0a});}catch(_0x283696){console[_0x15840c(0x23b)](_0x283696);}}),router['post']('/preview/:id',auth,async(_0x128ce3,_0x2b3c6b)=>{var _0x18c027=a0_0x3e53a0;try{const {invoice:_0x185aed,from_warehouse:_0x9893d9,FromRoom_name:_0x274c80,to_warehouse:_0x37cbbe,ToRoom_name:_0x635d22}=_0x128ce3['body'],_0x16052e=await transfers_finished[_0x18c027(0x222)](_0x128ce3['params']['id']),_0x55f003=_0x16052e[_0x18c027(0x253)]['map'](async _0x31f1ae=>{var _0x434568=_0x18c027;if(_0x31f1ae[_0x434568(0x22c)]>0x0){var _0x228bcf=await warehouse['findOne']({'name':_0x9893d9,'room':_0x31f1ae[_0x434568(0x23f)],'warehouse_category':_0x434568(0x277)});const _0x4f2d13=_0x228bcf[_0x434568(0x1b8)][_0x434568(0x1db)](_0x196f2e=>{var _0x5365f2=_0x434568;_0x196f2e[_0x5365f2(0x1b5)]==_0x31f1ae['product_name']&&_0x196f2e[_0x5365f2(0x1e4)]==_0x31f1ae[_0x5365f2(0x1be)]&&_0x196f2e[_0x5365f2(0x20e)]==_0x31f1ae[_0x5365f2(0x20e)]&&_0x196f2e[_0x5365f2(0x1d4)]==_0x31f1ae[_0x5365f2(0x1d4)]&&_0x196f2e[_0x5365f2(0x208)]==_0x31f1ae[_0x5365f2(0x208)]&&_0x196f2e[_0x5365f2(0x285)]==_0x31f1ae[_0x5365f2(0x279)]&&(_0x196f2e[_0x5365f2(0x275)]=_0x196f2e[_0x5365f2(0x275)]-_0x31f1ae[_0x5365f2(0x22c)]);});}return _0x228bcf;});Promise[_0x18c027(0x1cf)](_0x55f003)[_0x18c027(0x202)](async _0x15e929=>{var _0x4b05f7=_0x18c027;try{for(const _0x56f590 of _0x15e929){await _0x56f590[_0x4b05f7(0x1d9)]();}const _0x4c25ed=_0x16052e[_0x4b05f7(0x253)][_0x4b05f7(0x1db)](async _0xfec143=>{var _0x518d71=_0x4b05f7,_0x2b743a=await warehouse[_0x518d71(0x267)]({'name':_0x37cbbe,'room':_0xfec143[_0x518d71(0x1cc)]});if(_0xfec143['to_quantity']>0x0){var _0x4dc0f6=0x0;const _0xaf5e3e=_0x2b743a[_0x518d71(0x1b8)][_0x518d71(0x1db)](_0xa83f04=>{var _0x3fb2af=_0x518d71;_0xa83f04[_0x3fb2af(0x1b5)]==_0xfec143[_0x3fb2af(0x1b5)]&&_0xa83f04[_0x3fb2af(0x1e4)]==_0xfec143[_0x3fb2af(0x26d)]&&_0xa83f04[_0x3fb2af(0x20e)]==_0xfec143[_0x3fb2af(0x20e)]&&_0xa83f04[_0x3fb2af(0x1d4)]==_0xfec143[_0x3fb2af(0x1d4)]&&_0xa83f04['batch_code']==_0xfec143['batch_code']&&_0xa83f04[_0x3fb2af(0x285)]==_0xfec143['To_invoice']&&(_0xa83f04['product_stock']=_0xa83f04[_0x3fb2af(0x275)]+_0xfec143[_0x3fb2af(0x22c)],_0x4dc0f6++);});_0x4dc0f6=='0'&&(_0x2b743a[_0x518d71(0x1b8)]=_0x2b743a[_0x518d71(0x1b8)]['concat']({'product_name':_0xfec143[_0x518d71(0x1b5)],'product_stock':_0xfec143[_0x518d71(0x22c)],'bay':_0xfec143[_0x518d71(0x26d)],'product_code':_0xfec143['product_code'],'primary_code':_0xfec143[_0x518d71(0x1c5)],'secondary_code':_0xfec143[_0x518d71(0x20f)],'expiry_date':_0xfec143[_0x518d71(0x20e)],'production_date':_0xfec143['production_date'],'maxProducts':_0xfec143[_0x518d71(0x26e)],'batch_code':_0xfec143['batch_code'],'secondary_unit':_0xfec143[_0x518d71(0x250)],'unit':_0xfec143[_0x518d71(0x270)],'maxProducts':_0xfec143['maxProducts'],'maxPerUnit':_0xfec143[_0x518d71(0x206)],'invoice':_0xfec143['To_invoice']}));}return _0x2b743a;});Promise[_0x4b05f7(0x1cf)](_0x4c25ed)[_0x4b05f7(0x202)](async _0x32fc7e=>{var _0x412b58=_0x4b05f7;try{for(const _0x1a89bf of _0x32fc7e){await warehouse[_0x412b58(0x287)]({'_id':_0x1a89bf[_0x412b58(0x220)]},{'$addToSet':{'product_details':{'$each':_0x1a89bf[_0x412b58(0x1b8)]}}});}_0x16052e['finalize']='True';const _0x27491e=await _0x16052e[_0x412b58(0x1d9)](),_0x2f6705=await master_shop[_0x412b58(0x1e9)](),_0x1f222c=await email_settings[_0x412b58(0x267)](),_0x41f2be=await supervisor_settings[_0x412b58(0x1e9)]();var _0x50554f=_0x16052e[_0x412b58(0x253)],_0x29a1da='',_0x2c6697;for(_0x2c6697 in _0x50554f){var _0x160974='FG';_0x16052e['to_warehouse']==_0x412b58(0x22f)&&(_0x160974='DG'),_0x29a1da+=_0x412b58(0x27f)+_0x412b58(0x265)+_0x50554f[_0x2c6697][_0x412b58(0x1b5)]+_0x412b58(0x23c)+_0x412b58(0x265)+_0x50554f[_0x2c6697][_0x412b58(0x245)]+_0x412b58(0x23c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50554f[_0x2c6697][_0x412b58(0x22c)]+_0x412b58(0x23c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50554f[_0x2c6697]['unit']+_0x412b58(0x23c)+_0x412b58(0x265)+_0x50554f[_0x2c6697]['secondary_unit']+_0x412b58(0x23c)+_0x412b58(0x265)+_0x16052e[_0x412b58(0x262)]+_0x412b58(0x23c)+_0x412b58(0x265)+_0x50554f[_0x2c6697][_0x412b58(0x1cc)]+_0x412b58(0x23c)+_0x412b58(0x265)+_0x160974+_0x50554f[_0x2c6697][_0x412b58(0x26d)]+'</td>'+_0x412b58(0x215);}let _0x5e8852=nodemailer['createTransport']({'host':_0x1f222c[_0x412b58(0x207)],'port':Number(_0x1f222c[_0x412b58(0x22a)]),'secure':![],'auth':{'user':_0x1f222c[_0x412b58(0x205)],'pass':_0x1f222c[_0x412b58(0x1df)]}}),_0x335759={'from':_0x1f222c[_0x412b58(0x205)],'to':_0x41f2be[0x0][_0x412b58(0x1ce)],'subject':'Transfer\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x412b58(0x1ec)+'/upload/'+_0x2f6705[0x0][_0x412b58(0x246)],'cid':_0x412b58(0x24e)}],'html':_0x412b58(0x26c)+_0x412b58(0x1e2)+_0x412b58(0x21f)+_0x412b58(0x21b)+_0x412b58(0x24a)+_0x412b58(0x21b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x412b58(0x26f)+_0x412b58(0x21b)+_0x412b58(0x20d)+_0x2f6705[0x0][_0x412b58(0x1ed)]+_0x412b58(0x288)+_0x412b58(0x26f)+_0x412b58(0x26f)+'<hr\x20class=\x22my-3\x22>'+_0x412b58(0x21b)+_0x412b58(0x25d)+'\x20Order\x20Number\x20:\x20'+_0x16052e[_0x412b58(0x285)]+'\x20'+_0x412b58(0x219)+_0x412b58(0x1f7)+_0x16052e['date']+'\x20'+_0x412b58(0x284)+_0x412b58(0x260)+'</div>'+_0x412b58(0x1d0)+_0x412b58(0x200)+_0x412b58(0x27f)+_0x412b58(0x289)+_0x412b58(0x1c7)+_0x412b58(0x254)+_0x412b58(0x22d)+_0x412b58(0x204)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x412b58(0x1e1)+_0x412b58(0x28a)+_0x412b58(0x215)+_0x412b58(0x248)+_0x412b58(0x1cb)+'\x20'+_0x29a1da+'\x20'+'</tbody>'+'</table>'+_0x412b58(0x21b)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x2f6705[0x0]['site_title']+_0x412b58(0x260)+'</div>'+_0x412b58(0x26f)+_0x412b58(0x1fc)};_0x5e8852[_0x412b58(0x27b)](_0x335759,function(_0x314f56,_0x4150a8){var _0x3f08dc=_0x412b58;_0x314f56?(console['log'](_0x314f56),console[_0x3f08dc(0x23b)](_0x3f08dc(0x26b))):console[_0x3f08dc(0x23b)]('Email\x20sent\x20successfully');}),_0x128ce3[_0x412b58(0x1bf)]('success','Transfer\x20Finalize\x20Successfully'),_0x2b3c6b[_0x412b58(0x1d5)](_0x412b58(0x26a)+_0x27491e['_id']);}catch(_0x23b297){console[_0x412b58(0x221)](_0x23b297),_0x2b3c6b['status'](0x1f4)[_0x412b58(0x1b6)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4b05f7(0x264)](_0x1de5c9=>{var _0x1be0a1=_0x4b05f7;console[_0x1be0a1(0x221)](_0x1de5c9),_0x2b3c6b[_0x1be0a1(0x1e8)](0x1f4)[_0x1be0a1(0x1b6)]({'error':_0x1be0a1(0x272)});});}catch(_0x45b070){console[_0x4b05f7(0x221)](_0x45b070),_0x2b3c6b[_0x4b05f7(0x1e8)](0x1f4)[_0x4b05f7(0x1b6)]({'error':_0x4b05f7(0x25a)});}})['catch'](_0xce6074=>{var _0x23e8b5=_0x18c027;console[_0x23e8b5(0x221)](_0xce6074),_0x2b3c6b['status'](0x1f4)[_0x23e8b5(0x1b6)]({'error':'An\x20error\x20occurred.'});});}catch(_0x1cbfee){_0x2b3c6b[_0x18c027(0x1b6)]({'message':_0x1cbfee[_0x18c027(0x1f9)]});}});function BayBinSelected(_0x5a8d52,_0x47a609){var _0xd7d2dc=a0_0x3e53a0,_0x51efd3=[];let _0x3de137=[];var _0xb84364=[];if(_0x5a8d52==_0xd7d2dc(0x22f)){switch(_0x47a609){case _0xd7d2dc(0x213):_0x51efd3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xd7d2dc(0x252):_0x51efd3=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xb84364=['DG'];}else{if(_0x5a8d52=='FROZEN\x20GOODS'){switch(_0x47a609){case _0xd7d2dc(0x213):_0x51efd3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xd7d2dc(0x252):_0x51efd3=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xb84364=['FG'];}}return{'levels':_0x51efd3,'identify':_0xb84364};}router['get']('/view/:id',auth,async(_0x3d22f4,_0x5b798e)=>{var _0x1857a1=a0_0x3e53a0;try{const {username:_0x2a0b5f,email:_0x51983f,role:_0x4a3a31}=_0x3d22f4['user'],_0x148dd4=_0x3d22f4['user'],_0x1fb23e=await profile[_0x1857a1(0x267)]({'email':_0x148dd4['email']}),_0x1b1368=await master_shop[_0x1857a1(0x1e9)](),_0x121588=await transfers_finished[_0x1857a1(0x222)](_0x3d22f4['params']['id']);let _0x28761f=new Date(_0x121588['expiry_date']),_0x41594d=('0'+_0x28761f[_0x1857a1(0x1bb)]())[_0x1857a1(0x281)](-0x2),_0x2fa494=('0'+(_0x28761f[_0x1857a1(0x256)]()+0x1))[_0x1857a1(0x281)](-0x2),_0x801833=_0x28761f[_0x1857a1(0x23a)](),_0x308450=_0x801833+'-'+_0x2fa494+'-'+_0x41594d,_0x157ff8;if(_0x148dd4[_0x1857a1(0x234)]==_0x1857a1(0x1d1)){const _0x1ac5d5=await staff[_0x1857a1(0x267)]({'email':_0x148dd4[_0x1857a1(0x205)]});_0x157ff8=await warehouse['find']({'status':_0x1857a1(0x258),'name':_0x1ac5d5[_0x1857a1(0x27e)],'warehouse_category':_0x1857a1(0x277)});}else _0x157ff8=await warehouse[_0x1857a1(0x1e9)]({'status':_0x1857a1(0x258),'warehouse_category':_0x1857a1(0x277)});const _0x4da337=await warehouse[_0x1857a1(0x228)]([{'$match':{'name':_0x121588[_0x1857a1(0x23d)],'room':_0x121588[_0x1857a1(0x1c0)]}},{'$unwind':_0x1857a1(0x236)},{'$group':{'_id':_0x1857a1(0x21d),'name':{'$first':_0x1857a1(0x243)},'product_stock':{'$first':_0x1857a1(0x25f)},'bay':{'$first':_0x1857a1(0x223)},'bin':{'$first':_0x1857a1(0x20b)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1857a1(0x20a)},'primary_code':{'$first':_0x1857a1(0x1d8)},'secondary_code':{'$first':_0x1857a1(0x230)},'product_code':{'$first':_0x1857a1(0x25b)},'storage':{'$first':_0x1857a1(0x247)},'rack':{'$first':_0x1857a1(0x255)}}}]);var _0x43148e=[0x1,0x2,0x3,0x4],_0x144020=['A','B','C','D','E','F','G','H','I','J'],_0x1a589b=['Ambient',_0x1857a1(0x1dd)];const _0x2b279f=await product[_0x1857a1(0x1e9)]({}),_0x58fe8c=BayBinSelected(_0x121588[_0x1857a1(0x262)],_0x121588[_0x1857a1(0x269)]);if(_0x1b1368[0x0][_0x1857a1(0x268)]==_0x1857a1(0x1f1)){var _0x434549=users['English'];console['log'](_0x434549);}else{if(_0x1b1368[0x0]['language']==_0x1857a1(0x274))var _0x434549=users['Hindi'];else{if(_0x1b1368[0x0][_0x1857a1(0x268)]=='German')var _0x434549=users[_0x1857a1(0x1c9)];else{if(_0x1b1368[0x0]['language']=='Spanish')var _0x434549=users[_0x1857a1(0x1bd)];else{if(_0x1b1368[0x0]['language']==_0x1857a1(0x231))var _0x434549=users[_0x1857a1(0x231)];else{if(_0x1b1368[0x0][_0x1857a1(0x268)]=='Portuguese\x20(BR)')var _0x434549=users[_0x1857a1(0x238)];else{if(_0x1b1368[0x0][_0x1857a1(0x268)]==_0x1857a1(0x24c))var _0x434549=users['Chinese'];else{if(_0x1b1368[0x0][_0x1857a1(0x268)]=='Arabic\x20(ae)')var _0x434549=users[_0x1857a1(0x263)];}}}}}}}_0x5b798e['render'](_0x1857a1(0x240),{'success':_0x3d22f4[_0x1857a1(0x1bf)](_0x1857a1(0x1e6)),'errors':_0x3d22f4[_0x1857a1(0x1bf)](_0x1857a1(0x283)),'role':_0x148dd4,'profile':_0x1fb23e,'master_shop':_0x1b1368,'warehouse':_0x157ff8,'transfer':_0x121588,'stock':_0x4da337,'unit':_0x2b279f,'language':_0x434549,'levels':_0x43148e,'Isle':_0x144020,'rooms_data':_0x1a589b,'ed_fullDate':_0x308450,'dataSelected':_0x58fe8c});}catch(_0x4f49a4){console[_0x1857a1(0x23b)](_0x4f49a4);}}),router[a0_0x3e53a0(0x203)](a0_0x3e53a0(0x1c6),auth,async(_0x5466f8,_0x514782)=>{var _0x650547=a0_0x3e53a0;try{const _0x41fc9c=_0x5466f8[_0x650547(0x1ea)]['id'];console['log'](_0x5466f8[_0x650547(0x241)]);const _0x99758b=await transfers_finished[_0x650547(0x222)](_0x41fc9c);console['log'](_0x650547(0x1e3),_0x99758b);const {date:_0x5d3bd4,from_warehouse:_0x1c7201,FromRoom_name:_0xf890bd,to_warehouse:_0x19b81b,ToRoom_name:_0x27f0ba,prod_name:_0x13f245,from_prod_qty:_0x280453,from_prod_level:_0x16d14c,from_prod_isle:_0x44f3e8,from_prod_pallet:_0x575416,to_prod_qty:_0x370016,to_prod_level:_0x284723,to_prod_isle:_0x2ba4f9,to_prod_pallet:_0x5b8688,primary_code:_0x214fbc,secondary_code:_0x3d7adb,product_code3:_0xa19644,note:_0x3a85c1,invoice:_0x5ed59a,expiry_date:_0x25c242}=_0x5466f8[_0x650547(0x241)];if(typeof _0x13f245==_0x650547(0x27d))var _0xa86df1=[_0x5466f8[_0x650547(0x241)]['prod_name']],_0x4037f1=[_0x5466f8['body']['from_prod_qty']],_0x1a81b2=[_0x5466f8[_0x650547(0x241)][_0x650547(0x24b)]],_0x4a8c71=[_0x5466f8['body'][_0x650547(0x276)]],_0x207baa=[_0x5466f8[_0x650547(0x241)][_0x650547(0x227)]],_0x538e47=[_0x5466f8[_0x650547(0x241)][_0x650547(0x1c5)]],_0x661ed4=[_0x5466f8[_0x650547(0x241)][_0x650547(0x20f)]],_0x2ff73d=[_0x5466f8[_0x650547(0x241)][_0x650547(0x1e5)]],_0x23ab51=[_0x5466f8['body'][_0x650547(0x1f0)]],_0x1b10a6=[_0x5466f8[_0x650547(0x241)][_0x650547(0x270)]],_0x4aea4b=[_0x5466f8[_0x650547(0x241)][_0x650547(0x250)]],_0x5b6ecb=[_0x5466f8[_0x650547(0x241)][_0x650547(0x208)]],_0x1c88c2=[_0x5466f8[_0x650547(0x241)][_0x650547(0x20e)]];else var _0xa86df1=[..._0x5466f8['body'][_0x650547(0x1ff)]],_0x4037f1=[..._0x5466f8[_0x650547(0x241)]['from_prod_qty']],_0x1a81b2=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x24b)]],_0x4a8c71=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x276)]],_0x207baa=[..._0x5466f8['body'][_0x650547(0x227)]],_0x538e47=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x1c5)]],_0x661ed4=[..._0x5466f8['body'][_0x650547(0x20f)]],_0x2ff73d=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x1e5)]],_0x23ab51=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x1f0)]],_0x1b10a6=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x270)]],_0x4aea4b=[..._0x5466f8['body']['secondary_unit']],_0x5b6ecb=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x208)]],_0x1c88c2=[..._0x5466f8[_0x650547(0x241)][_0x650547(0x20e)]];const _0x1effec=_0xa86df1[_0x650547(0x1db)](_0x29ce37=>{return _0x29ce37={'product_name':_0x29ce37};});_0x4037f1[_0x650547(0x218)]((_0x4c9715,_0x16af2)=>{var _0x45c355=_0x650547;_0x1effec[_0x16af2][_0x45c355(0x1c2)]=_0x4c9715;}),_0x1a81b2[_0x650547(0x218)]((_0x3f58f4,_0x389783)=>{var _0x4d71da=_0x650547;_0x1effec[_0x389783][_0x4d71da(0x1be)]=_0x3f58f4;}),_0x4a8c71[_0x650547(0x218)]((_0x642e48,_0x3f84be)=>{var _0x4ceb19=_0x650547;_0x1effec[_0x3f84be][_0x4ceb19(0x22c)]=_0x642e48;}),_0x207baa['forEach']((_0x3bf69a,_0xe67e47)=>{var _0x49b671=_0x650547;_0x1effec[_0xe67e47][_0x49b671(0x26d)]=_0x3bf69a;}),_0x538e47[_0x650547(0x218)]((_0x2523b4,_0x182ab5)=>{var _0x3155ad=_0x650547;_0x1effec[_0x182ab5][_0x3155ad(0x1c5)]=_0x2523b4;}),_0x661ed4[_0x650547(0x218)]((_0x193918,_0x512ee2)=>{_0x1effec[_0x512ee2]['secondary_code']=_0x193918;}),_0x2ff73d[_0x650547(0x218)]((_0x718613,_0x3fa99e)=>{var _0x23f359=_0x650547;_0x1effec[_0x3fa99e][_0x23f359(0x245)]=_0x718613;}),_0x23ab51['forEach']((_0x22bf46,_0x159d4a)=>{var _0x2b4b66=_0x650547;_0x1effec[_0x159d4a][_0x2b4b66(0x26e)]=_0x22bf46;}),_0x1b10a6[_0x650547(0x218)]((_0x3be675,_0x58db9b)=>{var _0x37a7f8=_0x650547;_0x1effec[_0x58db9b][_0x37a7f8(0x270)]=_0x3be675;}),_0x4aea4b['forEach']((_0x4ae4ce,_0x114646)=>{var _0x4a952c=_0x650547;_0x1effec[_0x114646][_0x4a952c(0x250)]=_0x4ae4ce;}),_0x5b6ecb['forEach']((_0x4d4e71,_0x40fe5e)=>{var _0x473826=_0x650547;_0x1effec[_0x40fe5e][_0x473826(0x208)]=_0x4d4e71;}),_0x1c88c2[_0x650547(0x218)]((_0x2ad0a2,_0x5aa3ab)=>{var _0x4dc0e6=_0x650547;_0x1effec[_0x5aa3ab][_0x4dc0e6(0x20e)]=_0x2ad0a2;});const _0x2d0483=_0x1effec['filter'](_0x42cfd5=>_0x42cfd5[_0x650547(0x22c)]!=='0'&&_0x42cfd5[_0x650547(0x22c)]!==''||_0x42cfd5[_0x650547(0x1b4)]!=='0'&&_0x42cfd5[_0x650547(0x1b4)]!=='');var _0x505520=0x0;_0x2d0483[_0x650547(0x218)](_0x5d38d1=>{var _0x5003e6=_0x650547;parseInt(_0x5d38d1[_0x5003e6(0x1c2)])<parseInt(_0x5d38d1[_0x5003e6(0x22c)])&&_0x505520++;});if(_0x505520!=0x0)return _0x5466f8[_0x650547(0x1bf)](_0x650547(0x283),_0x650547(0x1b9)),_0x514782['redirect'](_0x650547(0x1eb));const _0x380e48=await warehouse[_0x650547(0x267)]({'name':_0x99758b[_0x650547(0x23d)],'room':_0x99758b[_0x650547(0x1c0)]});_0x99758b['product']['forEach'](_0x436f6d=>{var _0x42d14f=_0x650547;if(_0x436f6d[_0x42d14f(0x22c)]>0x0){const _0x4feeb7=_0x380e48[_0x42d14f(0x1b8)][_0x42d14f(0x1db)](_0x598f9f=>{var _0x4ffdca=_0x42d14f;_0x598f9f['product_name']==_0x436f6d[_0x4ffdca(0x1b5)]&&_0x598f9f[_0x4ffdca(0x1e4)]==_0x436f6d[_0x4ffdca(0x1be)]&&(_0x598f9f[_0x4ffdca(0x275)]=parseInt(_0x598f9f['product_stock'])+parseInt(_0x436f6d[_0x4ffdca(0x22c)]));});}}),await _0x380e48['save']();const _0x2781b9=await warehouse[_0x650547(0x267)]({'name':_0x99758b[_0x650547(0x262)],'room':_0x99758b[_0x650547(0x269)]});_0x99758b['product'][_0x650547(0x218)](_0x1c3f2c=>{var _0x3809ad=_0x650547;if(_0x1c3f2c[_0x3809ad(0x22c)]>0x0){const _0x82de78=_0x2781b9[_0x3809ad(0x1b8)][_0x3809ad(0x1db)](_0x26298e=>{var _0x4d1f43=_0x3809ad;_0x26298e[_0x4d1f43(0x1b5)]==_0x1c3f2c[_0x4d1f43(0x1b5)]&&_0x26298e['bay']==_0x1c3f2c[_0x4d1f43(0x26d)]&&(_0x26298e[_0x4d1f43(0x275)]=parseInt(_0x26298e[_0x4d1f43(0x275)])-parseInt(_0x1c3f2c['to_quantity']));});}}),await _0x2781b9[_0x650547(0x1d9)](),_0x99758b[_0x650547(0x224)]=_0x5d3bd4,_0x99758b[_0x650547(0x23d)]=_0x1c7201,_0x99758b[_0x650547(0x262)]=_0x19b81b,_0x99758b[_0x650547(0x253)]=_0x2d0483,_0x99758b[_0x650547(0x209)]=_0x3a85c1,_0x99758b['invoice']=_0x5ed59a;const _0x314469=await _0x99758b[_0x650547(0x1d9)](),_0x5e8720=await warehouse[_0x650547(0x267)]({'name':_0x1c7201,'room':_0xf890bd});_0x314469[_0x650547(0x253)]['forEach'](_0x3d68a2=>{var _0x5a1e5a=_0x650547;if(_0x3d68a2[_0x5a1e5a(0x22c)]>0x0){const _0x10bfc5=_0x5e8720['product_details'][_0x5a1e5a(0x1db)](_0x3cc1d3=>{var _0x168cbc=_0x5a1e5a;_0x3cc1d3['product_name']==_0x3d68a2[_0x168cbc(0x1b5)]&&_0x3cc1d3[_0x168cbc(0x1e4)]==_0x3d68a2['from_bay']&&(_0x3cc1d3[_0x168cbc(0x275)]=parseInt(_0x3cc1d3[_0x168cbc(0x275)])-parseInt(_0x3d68a2[_0x168cbc(0x22c)]));});}}),await _0x5e8720[_0x650547(0x1d9)]();const _0x588d9e=await warehouse['findOne']({'name':_0x19b81b,'room':_0x27f0ba});_0x314469[_0x650547(0x253)][_0x650547(0x218)](_0x4b4a2d=>{var _0x3ea882=_0x650547;if(_0x4b4a2d['to_quantity']>0x0){var _0x510e30=0x0;const _0x52add1=_0x588d9e[_0x3ea882(0x1b8)][_0x3ea882(0x1db)](_0x1b1881=>{var _0x4c2a4a=_0x3ea882;_0x1b1881['product_name']==_0x4b4a2d[_0x4c2a4a(0x1b5)]&&_0x1b1881[_0x4c2a4a(0x1e4)]==_0x4b4a2d[_0x4c2a4a(0x26d)]&&(_0x1b1881['product_stock']=parseInt(_0x1b1881[_0x4c2a4a(0x275)])+parseInt(_0x4b4a2d[_0x4c2a4a(0x22c)]),_0x510e30++);});_0x510e30=='0'&&(_0x588d9e[_0x3ea882(0x1b8)]=_0x588d9e[_0x3ea882(0x1b8)][_0x3ea882(0x211)]({'product_name':_0x4b4a2d[_0x3ea882(0x1b5)],'product_stock':_0x4b4a2d['to_quantity'],'bay':_0x4b4a2d[_0x3ea882(0x26d)],'product_code':_0x4b4a2d[_0x3ea882(0x245)],'primary_code':_0x4b4a2d[_0x3ea882(0x1c5)],'secondary_code':_0x4b4a2d[_0x3ea882(0x20f)],'maxProducts':_0x4b4a2d[_0x3ea882(0x26e)]}));}}),await _0x588d9e['save'](),_0x5466f8[_0x650547(0x1bf)](_0x650547(0x1e6),_0x650547(0x1b1)),_0x514782[_0x650547(0x1d5)](_0x650547(0x1c8));}catch(_0x426e18){console[_0x650547(0x23b)](_0x426e18);}}),router[a0_0x3e53a0(0x203)](a0_0x3e53a0(0x235),async(_0x5def55,_0xf25d14)=>{var _0x3261e6=a0_0x3e53a0;const {FromWareHouse:_0x11b38a,FromRoom:_0x15e29b,ToWarehouse:_0x1fc3fb,ToRoom:_0x4d46dd,primary_code:_0x348d71,Roomslist:_0x3a8c96}=_0x5def55[_0x3261e6(0x241)],_0x5bcbaf=_0x3a8c96['split'](','),_0x246901=[];async function _0x2867fe(_0x42bfa0){var _0x48c63c=_0x3261e6;const _0x4ba507=await warehouse['aggregate']([{'$match':{'name':_0x11b38a,'room':_0x42bfa0}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x348d71}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x48c63c(0x25f)},'primary_code':{'$first':_0x48c63c(0x1d8)},'secondary_code':{'$first':_0x48c63c(0x230)},'product_code':{'$first':_0x48c63c(0x25b)},'level':{'$first':_0x48c63c(0x223)},'isle':{'$first':_0x48c63c(0x20b)},'type':{'$first':_0x48c63c(0x1f6)},'pallet':{'$first':_0x48c63c(0x20a)},'unit':{'$first':_0x48c63c(0x21a)},'secondary_unit':{'$first':_0x48c63c(0x225)},'storage':{'$first':_0x48c63c(0x247)},'rack':{'$first':_0x48c63c(0x255)},'expiry_date':{'$first':_0x48c63c(0x210)},'production_date':{'$first':_0x48c63c(0x1fb)},'batch_code':{'$first':_0x48c63c(0x1ee)},'maxPerUnit':{'$first':_0x48c63c(0x1b3)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4608bf=await warehouse[_0x48c63c(0x228)]([{'$match':{'name':_0x11b38a,'room':_0x42bfa0}},{'$unwind':_0x48c63c(0x236)},{'$match':{'product_details.secondary_code':_0x348d71}},{'$group':{'_id':_0x48c63c(0x21d),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x48c63c(0x25f)},'primary_code':{'$first':_0x48c63c(0x1d8)},'secondary_code':{'$first':_0x48c63c(0x230)},'product_code':{'$first':_0x48c63c(0x25b)},'level':{'$first':_0x48c63c(0x223)},'isle':{'$first':_0x48c63c(0x20b)},'type':{'$first':_0x48c63c(0x1f6)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x48c63c(0x21a)},'secondary_unit':{'$first':_0x48c63c(0x225)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x48c63c(0x255)},'expiry_date':{'$first':_0x48c63c(0x210)},'production_date':{'$first':_0x48c63c(0x1fb)},'batch_code':{'$first':_0x48c63c(0x1ee)},'maxPerUnit':{'$first':_0x48c63c(0x1b3)},'roomNamed':{'$first':_0x48c63c(0x1f5)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x48c63c(0x27c)}}}]);if(_0x4ba507[_0x48c63c(0x249)]>0x0)_0x246901['push'](_0x4ba507);else _0x4608bf[_0x48c63c(0x249)]>0x0&&_0x246901[_0x48c63c(0x20c)](_0x4608bf);}const _0x579498=_0x5bcbaf[_0x3261e6(0x1db)](_0xf8e72d=>_0x2867fe(_0xf8e72d));await Promise[_0x3261e6(0x1cf)](_0x579498),_0xf25d14[_0x3261e6(0x1b6)](_0x246901);}),router[a0_0x3e53a0(0x203)](a0_0x3e53a0(0x1ca),async(_0x5c475b,_0x369fb2)=>{var _0x3c3caf=a0_0x3e53a0;try{const {FromWareHouse:_0x28fbbf,FromRoom:_0x1e3a95,ToWarehouse:_0x4c4281,ToRoom:_0x51cd69,secondary_code:_0x4f600e}=_0x5c475b['body'],_0x7352f9=await warehouse['aggregate']([{'$match':{'name':_0x28fbbf}},{'$unwind':_0x3c3caf(0x236)},{'$match':{'product_details.secondary_code':_0x4f600e}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3c3caf(0x243)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x3c3caf(0x25f)},'warehouse':{'$first':'$name'},'level':{'$first':_0x3c3caf(0x1f4)},'isle':{'$first':_0x3c3caf(0x22e)},'pallet':{'$first':_0x3c3caf(0x233)},'maxProducts':{'$first':_0x3c3caf(0x257)},'unit':{'$first':_0x3c3caf(0x21a)},'expiry_date':{'$first':_0x3c3caf(0x210)},'production_date':{'$first':_0x3c3caf(0x1fb)}}}]);_0x369fb2['status'](0xc8)[_0x3c3caf(0x1b6)](_0x7352f9);}catch(_0x341815){_0x369fb2['status'](0x194)[_0x3c3caf(0x1b6)]({'message':_0x341815[_0x3c3caf(0x1f9)]});}}),router['post']('/barcode_scanner3',async(_0x1f2c52,_0x3867c6)=>{var _0x1acb4a=a0_0x3e53a0;try{const {FromWareHouse:_0x363323,FromRoom:_0xbe9f69,ToWarehouse:_0x310530,ToRoom:_0x2e5103,product_code:_0x57d4eb}=_0x1f2c52['body'],_0x2a9b50=await warehouse[_0x1acb4a(0x228)]([{'$match':{'name':_0x363323}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x57d4eb}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x1acb4a(0x1d8)},'secondary_code':{'$first':_0x1acb4a(0x230)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x1acb4a(0x25f)},'warehouse':{'$first':'$name'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x1acb4a(0x22e)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x1acb4a(0x21a)}}}]);_0x3867c6[_0x1acb4a(0x1e8)](0xc8)['json'](_0x2a9b50);}catch(_0xb456ed){_0x3867c6[_0x1acb4a(0x1e8)](0x194)[_0x1acb4a(0x1b6)]({'message':_0xb456ed['message']});}}),router[a0_0x3e53a0(0x203)](a0_0x3e53a0(0x22b),async(_0x470261,_0x3c30ed)=>{var _0x3c0493=a0_0x3e53a0;const {productCode:_0x4045b2,bay:_0x1c98f1,warehouses:_0x4ea85d,room:_0x2aa2fe}=_0x470261['body'];console[_0x3c0493(0x23b)](_0x470261[_0x3c0493(0x241)]);try{const _0x1e9ed9=await warehouse[_0x3c0493(0x228)]([{'$match':{'name':_0x4ea85d,'room':_0x2aa2fe}},{'$unwind':_0x3c0493(0x236)},{'$match':{'product_details.bay':parseInt(_0x1c98f1)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3c0493(0x243)},'product_stock':{'$first':_0x3c0493(0x25f)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x3c0493(0x257)}}}]);_0x3c30ed[_0x3c0493(0x1e8)](0xc8)[_0x3c0493(0x1b6)](_0x1e9ed9);}catch(_0x287595){_0x3c30ed[_0x3c0493(0x1e8)](0x194)[_0x3c0493(0x1b6)]({'message':_0x287595[_0x3c0493(0x1f9)]});}}),module[a0_0x3e53a0(0x1c3)]=router;