var a0_0x203598=a0_0x13ca;(function(_0x418b40,_0x218f76){var _0x5cd1b9=a0_0x13ca,_0x1e198e=_0x418b40();while(!![]){try{var _0x427115=parseInt(_0x5cd1b9(0x10d))/0x1+parseInt(_0x5cd1b9(0xf4))/0x2*(parseInt(_0x5cd1b9(0x184))/0x3)+parseInt(_0x5cd1b9(0x181))/0x4*(parseInt(_0x5cd1b9(0x17e))/0x5)+-parseInt(_0x5cd1b9(0x19f))/0x6+-parseInt(_0x5cd1b9(0x169))/0x7+parseInt(_0x5cd1b9(0x168))/0x8*(-parseInt(_0x5cd1b9(0x1b7))/0x9)+parseInt(_0x5cd1b9(0x13b))/0xa;if(_0x427115===_0x218f76)break;else _0x1e198e['push'](_0x1e198e['shift']());}catch(_0xd2fd5b){_0x1e198e['push'](_0x1e198e['shift']());}}}(a0_0x4100,0xbbbbc));const express=require(a0_0x203598(0x10b)),app=express(),router=express[a0_0x203598(0x157)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x203598(0x18e)),auth=require(a0_0x203598(0x19d)),users=require(a0_0x203598(0x14c)),nodemailer=require('nodemailer');router[a0_0x203598(0x12c)](a0_0x203598(0x176),auth,async(_0x498f6a,_0x258b2a)=>{var _0x4a1c26=a0_0x203598;try{const {username:_0x3cfdb7,email:_0x5413be,role:_0xad7b1b}=_0x498f6a[_0x4a1c26(0x1b6)],_0x530ade=_0x498f6a[_0x4a1c26(0x1b6)],_0x4baa54=await profile['findOne']({'email':_0x530ade[_0x4a1c26(0xe4)]}),_0x1f0e2e=await master_shop[_0x4a1c26(0x1bb)]();let _0x3f8b9b;if(_0x530ade[_0x4a1c26(0xfb)]==_0x4a1c26(0x1a9)){const _0x498766=await staff['findOne']({'email':_0x530ade[_0x4a1c26(0xe4)]});_0x3f8b9b=await transfers_finished[_0x4a1c26(0x1bb)]({'from_warehouse':_0x498766['warehouse']});}else _0x3f8b9b=await transfers_finished[_0x4a1c26(0x189)]([{'$unwind':_0x4a1c26(0x139)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4a1c26(0xf2)},'date':{'$first':'$date'},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x4a1c26(0x16b)},'from_room_name':{'$addToSet':_0x4a1c26(0xea)},'to_room_name':{'$addToSet':_0x4a1c26(0x110)},'finalize':{'$first':_0x4a1c26(0x114)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]=='English\x20(US)')var _0x25c83d=users[_0x4a1c26(0x1c0)];else{if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]==_0x4a1c26(0xe6))var _0x25c83d=users['Hindi'];else{if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]==_0x4a1c26(0x170))var _0x25c83d=users[_0x4a1c26(0x170)];else{if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]==_0x4a1c26(0x177))var _0x25c83d=users[_0x4a1c26(0x177)];else{if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]==_0x4a1c26(0x1b4))var _0x25c83d=users[_0x4a1c26(0x1b4)];else{if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]=='Portuguese\x20(BR)')var _0x25c83d=users[_0x4a1c26(0x15d)];else{if(_0x1f0e2e[0x0][_0x4a1c26(0x14f)]=='Chinese')var _0x25c83d=users[_0x4a1c26(0x149)];else{if(_0x1f0e2e[0x0]['language']==_0x4a1c26(0xe1))var _0x25c83d=users[_0x4a1c26(0x10f)];}}}}}}}_0x258b2a[_0x4a1c26(0x13f)](_0x4a1c26(0x125),{'success':_0x498f6a[_0x4a1c26(0x192)](_0x4a1c26(0x178)),'errors':_0x498f6a['flash']('errors'),'role':_0x530ade,'profile':_0x4baa54,'master_shop':_0x1f0e2e,'transfer':_0x3f8b9b,'language':_0x25c83d});}catch(_0x5d9d13){console[_0x4a1c26(0x17f)](_0x5d9d13);}});async function getRandom8DigitNumber(){var _0x456120=a0_0x203598;const _0x26ca82=0x989680,_0x5bed90=0x5f5e0ff,_0x11b04a=Math['floor'](Math[_0x456120(0x19c)]()*(_0x5bed90-_0x26ca82+0x1))+_0x26ca82;var _0x4bf97c;const _0xe5ec44=await transfers_finished[_0x456120(0x1bc)]({'invoice':_0x456120(0x11a)+_0x11b04a});return _0xe5ec44&&_0xe5ec44[_0x456120(0x196)]>0x0?_0x4bf97c=_0x456120(0x11a)+_0x11b04a:_0x4bf97c='TRFF-'+_0x11b04a,_0x4bf97c;}router[a0_0x203598(0x12c)](a0_0x203598(0x134),auth,async(_0x238a91,_0x54cbc6)=>{var _0x75add8=a0_0x203598;try{const {username:_0x2a5029,email:_0x1c6439,role:_0x1fcba7}=_0x238a91[_0x75add8(0x1b6)],_0x12dc58=_0x238a91[_0x75add8(0x1b6)],_0x490c71=await profile[_0x75add8(0x1bc)]({'email':_0x12dc58[_0x75add8(0xe4)]}),_0x4e4860=await master_shop[_0x75add8(0x1bb)]();let _0x4e9d0d;if(_0x12dc58[_0x75add8(0xfb)]=='staff'){const _0x4cf006=await staff[_0x75add8(0x1bc)]({'email':_0x12dc58[_0x75add8(0xe4)]});_0x4e9d0d=await warehouse[_0x75add8(0x189)]([{'$match':{'status':'Enabled','name':_0x4cf006['warehouse'],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x75add8(0x144)}}},{'$group':{'_id':_0x75add8(0xfe),'name':{'$first':_0x75add8(0xfe)}}}]);}else _0x4e9d0d=await warehouse[_0x75add8(0x189)]([{'$match':{'status':'Enabled','warehouse_category':_0x75add8(0x150),'name':{'$ne':_0x75add8(0x144)}}},{'$group':{'_id':_0x75add8(0xfe),'name':{'$first':_0x75add8(0xfe)}}}]);const _0x28be00=await transfers_finished[_0x75add8(0x1bb)]({}),_0x226b60=_0x28be00[_0x75add8(0x196)]+0x1,_0x5c3b2a=_0x75add8(0x11a)+_0x226b60[_0x75add8(0x194)]()[_0x75add8(0x14a)](0x5,'0');if(_0x4e4860[0x0][_0x75add8(0x14f)]==_0x75add8(0x1a5))var _0x443b47=users[_0x75add8(0x1c0)];else{if(_0x4e4860[0x0][_0x75add8(0x14f)]==_0x75add8(0xe6))var _0x443b47=users[_0x75add8(0xe6)];else{if(_0x4e4860[0x0][_0x75add8(0x14f)]==_0x75add8(0x170))var _0x443b47=users[_0x75add8(0x170)];else{if(_0x4e4860[0x0]['language']==_0x75add8(0x177))var _0x443b47=users['Spanish'];else{if(_0x4e4860[0x0][_0x75add8(0x14f)]==_0x75add8(0x1b4))var _0x443b47=users[_0x75add8(0x1b4)];else{if(_0x4e4860[0x0]['language']=='Portuguese\x20(BR)')var _0x443b47=users[_0x75add8(0x15d)];else{if(_0x4e4860[0x0][_0x75add8(0x14f)]==_0x75add8(0x149))var _0x443b47=users['Chinese'];else{if(_0x4e4860[0x0][_0x75add8(0x14f)]=='Arabic\x20(ae)')var _0x443b47=users[_0x75add8(0x10f)];}}}}}}}const _0x3321c2=getRandom8DigitNumber();_0x3321c2[_0x75add8(0x147)](_0x4e5c14=>{var _0xee636a=_0x75add8;_0x54cbc6[_0xee636a(0x13f)](_0xee636a(0x156),{'success':_0x238a91['flash'](_0xee636a(0x178)),'errors':_0x238a91['flash'](_0xee636a(0x16c)),'role':_0x12dc58,'profile':_0x490c71,'master_shop':_0x4e4860,'warehouse':_0x4e9d0d,'language':_0x443b47,'invoice':_0x4e5c14});})[_0x75add8(0x17c)](_0x42ba2d=>{var _0x19db86=_0x75add8;_0x238a91[_0x19db86(0x192)](_0x19db86(0x16c),_0x19db86(0xe8)),_0x54cbc6['redirect'](_0x19db86(0x1b1));});}catch(_0x4ec12e){console[_0x75add8(0x17f)](_0x4ec12e);}}),router[a0_0x203598(0x115)]('/view/add_transfer',auth,async(_0xa65a8c,_0x1eab70)=>{var _0x2bc9a4=a0_0x203598;try{const {date:_0x9d36b,from_warehouse:_0x21838d,FromRoom_name:_0x43dfd8,to_warehouse:_0x2631b5,ToRoom_name:_0xa4a8b4,prod_name:_0x3bc6d8,from_prod_qty:_0x3f357e,from_prod_level:_0x3279c6,from_prod_isle:_0x1c3d5a,from_prod_pallet:_0x18df3f,to_prod_qty:_0xd59372,to_prod_level:_0x224ba0,to_prod_isle:_0x267a40,to_prod_pallet:_0x3afb1c,primary_code:_0x905c3e,secondary_code:_0x238034,product_code3:_0x1d35b4,note:_0x1b8f11,MaxStocks_data2:_0x1d228d,invoice:_0x4cbfab,expiry_date:_0x2d40dd}=_0xa65a8c[_0x2bc9a4(0xf3)];if(typeof _0x3bc6d8=='string')var _0x35d99f=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x1aa)]],_0x3c4559=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x165)]],_0x141f84=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x131)]],_0x55d8f0=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x1b9)]],_0x5dd2ce=[_0xa65a8c['body'][_0x2bc9a4(0x103)]],_0x2e39c8=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x164)]],_0x50e16e=[_0xa65a8c[_0x2bc9a4(0xf3)]['secondary_code']],_0x51c9ae=[_0xa65a8c['body']['product_code3']],_0x5c0d85=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x162)]],_0x3005b8=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x159)]],_0x2674d1=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x17d)]],_0x3d861c=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0xec)]],_0x132f90=[_0xa65a8c[_0x2bc9a4(0xf3)]['expiry_date']],_0x3e5ca8=[_0xa65a8c['body'][_0x2bc9a4(0x133)]],_0x3f1cef=[_0xa65a8c[_0x2bc9a4(0xf3)]['MaxStocks_data']],_0x5afb18=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0xfd)]],_0x52432e=[_0xa65a8c['body'][_0x2bc9a4(0xf6)]],_0x479b1a=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x166)]],_0x6dcaf5=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x1b8)]],_0x12ff82=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x15a)]],_0x4d5f92=[_0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x183)]],_0x385a5a=[_0xa65a8c[_0x2bc9a4(0xf3)]['id_transaction']];else var _0x35d99f=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x1aa)]],_0x3c4559=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x165)]],_0x141f84=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x131)]],_0x55d8f0=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x1b9)]],_0x5dd2ce=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x103)]],_0x2e39c8=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x164)]],_0x50e16e=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x187)]],_0x51c9ae=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x17b)]],_0x5c0d85=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x162)]],_0x3005b8=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x159)]],_0x2674d1=[..._0xa65a8c['body'][_0x2bc9a4(0x17d)]],_0x3d861c=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0xec)]],_0x132f90=[..._0xa65a8c[_0x2bc9a4(0xf3)]['expiry_date']],_0x3e5ca8=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x133)]],_0x3f1cef=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x11d)]],_0x5afb18=[..._0xa65a8c['body'][_0x2bc9a4(0xfd)]],_0x52432e=[..._0xa65a8c[_0x2bc9a4(0xf3)]['prod_cat']],_0x479b1a=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x166)]],_0x6dcaf5=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x1b8)]],_0x12ff82=[..._0xa65a8c['body'][_0x2bc9a4(0x15a)]],_0x4d5f92=[..._0xa65a8c['body'][_0x2bc9a4(0x183)]],_0x385a5a=[..._0xa65a8c[_0x2bc9a4(0xf3)][_0x2bc9a4(0x158)]];const _0x1ed7e9=_0x35d99f[_0x2bc9a4(0x116)](_0x556484=>{return _0x556484={'product_name':_0x556484};});_0x3c4559[_0x2bc9a4(0x123)]((_0x3bed7b,_0x5c089c)=>{_0x1ed7e9[_0x5c089c]['from_quantity']=_0x3bed7b;}),_0x141f84[_0x2bc9a4(0x123)]((_0x1c2c61,_0x317fa7)=>{var _0x57bb0d=_0x2bc9a4;_0x1ed7e9[_0x317fa7][_0x57bb0d(0x167)]=_0x1c2c61;}),_0x385a5a[_0x2bc9a4(0x123)]((_0x531cd9,_0x25c47e)=>{var _0x406c16=_0x2bc9a4;_0x1ed7e9[_0x25c47e][_0x406c16(0x158)]=_0x531cd9;}),_0x12ff82['forEach']((_0x5b8da7,_0x3f7c83)=>{var _0x5407aa=_0x2bc9a4;_0x1ed7e9[_0x3f7c83][_0x5407aa(0x15a)]=_0x5b8da7;}),_0x4d5f92[_0x2bc9a4(0x123)]((_0x400fd8,_0x41b430)=>{var _0x3f0e2b=_0x2bc9a4;_0x1ed7e9[_0x41b430][_0x3f0e2b(0xe9)]=_0x400fd8;}),_0x55d8f0[_0x2bc9a4(0x123)]((_0x42bbf3,_0x574378)=>{var _0x494646=_0x2bc9a4;_0x1ed7e9[_0x574378][_0x494646(0x135)]=_0x42bbf3;}),_0x5dd2ce['forEach']((_0x32e801,_0x3bddf5)=>{var _0x72223d=_0x2bc9a4;_0x1ed7e9[_0x3bddf5][_0x72223d(0x173)]=_0x32e801;}),_0x2e39c8[_0x2bc9a4(0x123)]((_0x1b7a5c,_0x1537ac)=>{var _0x52c2e8=_0x2bc9a4;_0x1ed7e9[_0x1537ac][_0x52c2e8(0x164)]=_0x1b7a5c;}),_0x50e16e[_0x2bc9a4(0x123)]((_0x4ebe67,_0x150ce7)=>{_0x1ed7e9[_0x150ce7]['secondary_code']=_0x4ebe67;}),_0x51c9ae['forEach']((_0x15b8ea,_0x3ecbfa)=>{_0x1ed7e9[_0x3ecbfa]['product_code']=_0x15b8ea;}),_0x5c0d85[_0x2bc9a4(0x123)]((_0x45f0c6,_0x74c22d)=>{var _0x5e3811=_0x2bc9a4;_0x1ed7e9[_0x74c22d][_0x5e3811(0x143)]=_0x45f0c6;}),_0x3005b8['forEach']((_0x4c0c99,_0x14c69e)=>{var _0x1ccc29=_0x2bc9a4;_0x1ed7e9[_0x14c69e][_0x1ccc29(0xfc)]=_0x4c0c99;}),_0x2674d1[_0x2bc9a4(0x123)]((_0x37fe51,_0x55661a)=>{var _0x459ee8=_0x2bc9a4;_0x1ed7e9[_0x55661a][_0x459ee8(0x17d)]=_0x37fe51;}),_0x3d861c[_0x2bc9a4(0x123)]((_0x4148b7,_0x469031)=>{var _0x46edce=_0x2bc9a4;_0x1ed7e9[_0x469031][_0x46edce(0xec)]=_0x4148b7;}),_0x132f90[_0x2bc9a4(0x123)]((_0x503fba,_0x53a062)=>{var _0x50bb6f=_0x2bc9a4;_0x1ed7e9[_0x53a062][_0x50bb6f(0x12d)]=_0x503fba;}),_0x3e5ca8['forEach']((_0x284b71,_0x50317d)=>{_0x1ed7e9[_0x50317d]['production_date']=_0x284b71;}),_0x3f1cef['forEach']((_0x294ff0,_0x41fbbb)=>{var _0x228d2d=_0x2bc9a4;_0x1ed7e9[_0x41fbbb][_0x228d2d(0x143)]=_0x294ff0;}),_0x5afb18[_0x2bc9a4(0x123)]((_0x18d77f,_0x55f975)=>{var _0x5a1b2b=_0x2bc9a4;_0x1ed7e9[_0x55f975][_0x5a1b2b(0xfd)]=_0x18d77f;}),_0x52432e[_0x2bc9a4(0x123)]((_0x467e96,_0xe2b15b)=>{var _0x78c76b=_0x2bc9a4;_0x1ed7e9[_0xe2b15b][_0x78c76b(0xf6)]=_0x467e96;}),_0x479b1a[_0x2bc9a4(0x123)]((_0x1e3931,_0x83dda8)=>{var _0x3d53f0=_0x2bc9a4;_0x1ed7e9[_0x83dda8][_0x3d53f0(0x1a0)]=_0x1e3931;}),_0x6dcaf5[_0x2bc9a4(0x123)]((_0x1afb7e,_0x12fb2a)=>{_0x1ed7e9[_0x12fb2a]['to_room_name']=_0x1afb7e;});const _0x59e5ed=_0x1ed7e9[_0x2bc9a4(0x193)](_0x49ec67=>_0x49ec67[_0x2bc9a4(0x135)]!=='0'&&_0x49ec67[_0x2bc9a4(0x135)]!==''||_0x49ec67['to_floorlevel']!=='0'&&_0x49ec67['to_floorlevel']!=='');var _0x36086e=0x0;_0x59e5ed[_0x2bc9a4(0x123)](_0x96762f=>{var _0x174661=_0x2bc9a4;parseInt(_0x96762f[_0x174661(0x111)])<parseInt(_0x96762f['to_quantity'])&&_0x36086e++;});if(_0x36086e!=0x0)return _0xa65a8c['flash'](_0x2bc9a4(0x16c),_0x2bc9a4(0x1b3)),_0x1eab70[_0x2bc9a4(0x136)](_0x2bc9a4(0x198));const _0x1c8fae=new transfers_finished({'date':_0x9d36b,'from_warehouse':_0x21838d,'to_warehouse':_0x2631b5,'product':_0x59e5ed,'note':_0x1b8f11,'invoice':_0x4cbfab}),_0x1ccb83=await _0x1c8fae[_0x2bc9a4(0x151)]();_0xa65a8c[_0x2bc9a4(0x192)]('success','Product\x20Transfer\x20successfully'),_0x1eab70[_0x2bc9a4(0x136)](_0x2bc9a4(0x10a)+_0x1ccb83[_0x2bc9a4(0x129)]);}catch(_0x252b1f){console['log'](_0x252b1f),_0x1eab70[_0x2bc9a4(0x172)](0xc8)['json']({'errorMessage':_0x252b1f[_0x2bc9a4(0x142)]});}}),router[a0_0x203598(0x12c)](a0_0x203598(0x14e),auth,async(_0x375265,_0x56d767)=>{var _0x2f6bf6=a0_0x203598;try{const {username:_0x32649b,email:_0x1f9c2a,role:_0x3e8610}=_0x375265[_0x2f6bf6(0x1b6)],_0x40950e=_0x375265[_0x2f6bf6(0x1b6)],_0x591ab2=await profile['findOne']({'email':_0x40950e[_0x2f6bf6(0xe4)]}),_0x3a29cd=await master_shop[_0x2f6bf6(0x1bb)](),_0x14bcce=await transfers_finished[_0x2f6bf6(0x1bd)](_0x375265[_0x2f6bf6(0x1a2)]['id']);let _0x3bbd8b;if(_0x40950e[_0x2f6bf6(0xfb)]==_0x2f6bf6(0x1a9)){const _0x3fe747=await staff[_0x2f6bf6(0x1bc)]({'email':_0x40950e[_0x2f6bf6(0xe4)]});_0x3bbd8b=await warehouse[_0x2f6bf6(0x1bb)]({'status':_0x2f6bf6(0x13a),'name':_0x3fe747['warehouse'],'warehouse_category':_0x2f6bf6(0x150)});}else _0x3bbd8b=await warehouse['find']({'status':_0x2f6bf6(0x13a),'warehouse_category':'Finished\x20Goods'});const _0x20c159=await warehouse[_0x2f6bf6(0x189)]([{'$match':{'name':_0x14bcce[_0x2f6bf6(0x112)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x2f6bf6(0x152)},{'$group':{'_id':_0x2f6bf6(0x1a4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2f6bf6(0x182)},'bay':{'$first':_0x2f6bf6(0x11e)},'bin':{'$first':_0x2f6bf6(0x102)},'type':{'$first':_0x2f6bf6(0xf5)},'floorlevel':{'$first':_0x2f6bf6(0x1ba)},'primary_code':{'$first':_0x2f6bf6(0x118)},'secondary_code':{'$first':_0x2f6bf6(0x106)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2f6bf6(0x1a7)},'rack':{'$first':_0x2f6bf6(0x18a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2f6bf6(0xe5)},'room':{'$first':'$room'},'warehoue_name':{'$first':_0x2f6bf6(0xfe)}}}]),_0x2f071f=await product[_0x2f6bf6(0x1bb)]({});if(_0x3a29cd[0x0][_0x2f6bf6(0x14f)]==_0x2f6bf6(0x1a5)){var _0x4ce849=users[_0x2f6bf6(0x1c0)];console[_0x2f6bf6(0x17f)](_0x4ce849);}else{if(_0x3a29cd[0x0]['language']==_0x2f6bf6(0xe6))var _0x4ce849=users['Hindi'];else{if(_0x3a29cd[0x0]['language']==_0x2f6bf6(0x170))var _0x4ce849=users[_0x2f6bf6(0x170)];else{if(_0x3a29cd[0x0][_0x2f6bf6(0x14f)]==_0x2f6bf6(0x177))var _0x4ce849=users['Spanish'];else{if(_0x3a29cd[0x0]['language']==_0x2f6bf6(0x1b4))var _0x4ce849=users['French'];else{if(_0x3a29cd[0x0][_0x2f6bf6(0x14f)]==_0x2f6bf6(0x1c1))var _0x4ce849=users[_0x2f6bf6(0x15d)];else{if(_0x3a29cd[0x0]['language']==_0x2f6bf6(0x149))var _0x4ce849=users[_0x2f6bf6(0x149)];else{if(_0x3a29cd[0x0][_0x2f6bf6(0x14f)]=='Arabic\x20(ae)')var _0x4ce849=users[_0x2f6bf6(0x10f)];}}}}}}}_0x56d767[_0x2f6bf6(0x13f)](_0x2f6bf6(0x13e),{'success':_0x375265[_0x2f6bf6(0x192)](_0x2f6bf6(0x178)),'errors':_0x375265[_0x2f6bf6(0x192)](_0x2f6bf6(0x16c)),'role':_0x40950e,'profile':_0x591ab2,'master_shop':_0x3a29cd,'warehouse':_0x3bbd8b,'transfer':_0x14bcce,'stock':_0x20c159,'unit':_0x2f071f,'language':_0x4ce849});}catch(_0xe5dfeb){console[_0x2f6bf6(0x17f)](_0xe5dfeb);}}),router['post'](a0_0x203598(0x14e),auth,async(_0x8ef8,_0x444312)=>{var _0x1448bf=a0_0x203598;try{const {invoice:_0x35287d,from_warehouse:_0x26194c,FromRoom_name:_0x238c45,to_warehouse:_0xb273d7,ToRoom_name:_0x38dc9e}=_0x8ef8['body'],_0x29c7cc=await transfers_finished[_0x1448bf(0x1bd)](_0x8ef8[_0x1448bf(0x1a2)]['id']),_0x6a4ecf=_0x29c7cc[_0x1448bf(0x108)][_0x1448bf(0x116)](async _0x472ba8=>{var _0x1dd881=_0x1448bf;if(_0x472ba8['to_quantity']>0x0){var _0x1c3fee=await warehouse[_0x1dd881(0x1bc)]({'name':_0x26194c,'room':_0x472ba8[_0x1dd881(0x1a0)],'warehouse_category':_0x1dd881(0x150)});const _0x3d3096=_0x1c3fee['product_details'][_0x1dd881(0x116)](_0x2bbeba=>{var _0x20e25c=_0x1dd881;_0x2bbeba[_0x20e25c(0x11b)]==_0x472ba8['product_name']&&_0x2bbeba['bay']==_0x472ba8['from_bay']&&_0x2bbeba[_0x20e25c(0x12d)]==_0x472ba8['expiry_date']&&_0x2bbeba[_0x20e25c(0xf7)]==_0x472ba8[_0x20e25c(0xf7)]&&_0x2bbeba['batch_code']==_0x472ba8[_0x20e25c(0xec)]&&_0x2bbeba['invoice']==_0x472ba8[_0x20e25c(0x15a)]&&(console[_0x20e25c(0x17f)]('here1',_0x2bbeba[_0x20e25c(0x1c4)]),typeof _0x472ba8['id_transaction']==_0x20e25c(0xed)?_0x2bbeba[_0x20e25c(0x1c4)]=Math[_0x20e25c(0xf1)](0x0,Math[_0x20e25c(0x195)](_0x2bbeba['product_stock'])-Math[_0x20e25c(0x195)](_0x472ba8[_0x20e25c(0x135)])):_0x2bbeba[_0x20e25c(0x1c4)]=Math['max'](0x0,Math[_0x20e25c(0x195)](_0x2bbeba[_0x20e25c(0x1c4)])-Math['abs'](_0x472ba8[_0x20e25c(0x135)])));});}return _0x1c3fee;});Promise[_0x1448bf(0xf9)](_0x6a4ecf)['then'](async _0x3c8361=>{var _0x57dcfe=_0x1448bf;try{for(const _0xc3aec of _0x3c8361){await _0xc3aec['save']();}const _0x1dbf72=_0x29c7cc[_0x57dcfe(0x108)][_0x57dcfe(0x116)](async _0x6e70b=>{var _0x342461=_0x57dcfe,_0x356327=await warehouse[_0x342461(0x1bc)]({'name':_0xb273d7,'room':_0x6e70b[_0x342461(0x122)]});if(_0x6e70b[_0x342461(0x135)]>0x0){var _0x4faf32=0x0;const _0x1ec288=_0x356327['product_details'][_0x342461(0x116)](_0x520cfe=>{var _0x51f354=_0x342461;_0x520cfe[_0x51f354(0x11b)]==_0x6e70b['product_name']&&_0x520cfe[_0x51f354(0x105)]==_0x6e70b[_0x51f354(0x173)]&&_0x520cfe[_0x51f354(0x12d)]==_0x6e70b[_0x51f354(0x12d)]&&_0x520cfe[_0x51f354(0xf7)]==_0x6e70b[_0x51f354(0xf7)]&&_0x520cfe[_0x51f354(0xec)]==_0x6e70b[_0x51f354(0xec)]&&_0x520cfe[_0x51f354(0x1be)]==_0x6e70b[_0x51f354(0xe9)]&&(typeof _0x6e70b['id_transaction']=='undefined'?(console[_0x51f354(0x17f)](_0x51f354(0x14d),_0x520cfe[_0x51f354(0x1c4)]+_0x51f354(0x188)+_0x520cfe[_0x51f354(0x129)]+'\x20<=>\x20'+Math[_0x51f354(0x195)](_0x520cfe[_0x51f354(0x1c4)])+Math[_0x51f354(0x195)](_0x6e70b[_0x51f354(0x135)])),_0x520cfe[_0x51f354(0x1c4)]=Math[_0x51f354(0x195)](_0x520cfe[_0x51f354(0x1c4)])+Math[_0x51f354(0x195)](_0x6e70b[_0x51f354(0x135)])):_0x520cfe[_0x51f354(0x1c4)]=Math[_0x51f354(0x195)](_0x520cfe[_0x51f354(0x1c4)])+Math[_0x51f354(0x195)](_0x6e70b[_0x51f354(0x135)]),_0x4faf32++);});_0x4faf32=='0'&&(_0x356327[_0x342461(0x109)]=_0x356327[_0x342461(0x109)][_0x342461(0x1a3)]({'product_name':_0x6e70b[_0x342461(0x11b)],'product_stock':_0x6e70b[_0x342461(0x135)],'bay':_0x6e70b[_0x342461(0x173)],'product_code':_0x6e70b['product_code'],'primary_code':_0x6e70b[_0x342461(0x164)],'secondary_code':_0x6e70b['secondary_code'],'expiry_date':_0x6e70b[_0x342461(0x12d)],'production_date':_0x6e70b['production_date'],'maxProducts':_0x6e70b['maxProducts'],'batch_code':_0x6e70b[_0x342461(0xec)],'secondary_unit':_0x6e70b[_0x342461(0x17d)],'unit':_0x6e70b['unit'],'maxProducts':_0x6e70b[_0x342461(0x143)],'maxPerUnit':_0x6e70b[_0x342461(0xfd)],'invoice':_0x6e70b[_0x342461(0xe9)]}));}return _0x356327;});Promise[_0x57dcfe(0xf9)](_0x1dbf72)[_0x57dcfe(0x147)](async _0x4b9a4c=>{var _0x33e14a=_0x57dcfe;try{for(const _0x220f4a of _0x4b9a4c){await warehouse[_0x33e14a(0x1c2)]({'_id':_0x220f4a[_0x33e14a(0x129)]},{'$addToSet':{'product_details':{'$each':_0x220f4a[_0x33e14a(0x109)]}}});}_0x29c7cc[_0x33e14a(0x1c5)]=_0x33e14a(0x15b);const _0xb2e10b=await _0x29c7cc[_0x33e14a(0x151)](),_0x1101bf=await master_shop[_0x33e14a(0x1bb)](),_0x29336a=await email_settings['findOne'](),_0x855e4a=await supervisor_settings[_0x33e14a(0x1bb)]();var _0x41a707=_0x29c7cc['product'],_0x27d366='',_0x171141;for(_0x171141 in _0x41a707){var _0x5e9573='FG';_0x29c7cc[_0x33e14a(0x148)]==_0x33e14a(0x117)&&(_0x5e9573='DG'),_0x27d366+=_0x33e14a(0x107)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x41a707[_0x171141][_0x33e14a(0x11b)]+_0x33e14a(0x16f)+_0x33e14a(0x120)+_0x41a707[_0x171141][_0x33e14a(0x171)]+_0x33e14a(0x16f)+_0x33e14a(0x120)+_0x41a707[_0x171141][_0x33e14a(0x135)]+_0x33e14a(0x16f)+_0x33e14a(0x120)+_0x41a707[_0x171141][_0x33e14a(0xfc)]+'</td>'+_0x33e14a(0x120)+_0x41a707[_0x171141][_0x33e14a(0x17d)]+_0x33e14a(0x16f)+_0x33e14a(0x120)+_0x29c7cc[_0x33e14a(0x148)]+'</td>'+_0x33e14a(0x120)+_0x41a707[_0x171141]['to_room_name']+_0x33e14a(0x16f)+_0x33e14a(0x120)+_0x5e9573+_0x41a707[_0x171141][_0x33e14a(0x173)]+_0x33e14a(0x16f)+'</tr>';}let _0x3ddf29=nodemailer[_0x33e14a(0x138)]({'host':_0x29336a['host'],'port':Number(_0x29336a[_0x33e14a(0x12f)]),'secure':![],'auth':{'user':_0x29336a[_0x33e14a(0xe4)],'pass':_0x29336a['password']}}),_0x5e96ca={'from':_0x29336a[_0x33e14a(0xe4)],'to':_0x855e4a[0x0][_0x33e14a(0x15c)],'subject':_0x33e14a(0x197),'attachments':[{'filename':_0x33e14a(0x185),'path':__dirname+_0x33e14a(0x119)+_0x33e14a(0x140)+_0x1101bf[0x0][_0x33e14a(0xfa)],'cid':_0x33e14a(0xef)}],'html':_0x33e14a(0x121)+_0x33e14a(0xe7)+_0x33e14a(0x130)+'<div>'+_0x33e14a(0x1b0)+_0x33e14a(0x13c)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x33e14a(0x100)+'<div>'+'<h2>\x20'+_0x1101bf[0x0][_0x33e14a(0x19a)]+_0x33e14a(0x126)+_0x33e14a(0x100)+_0x33e14a(0x100)+_0x33e14a(0x12a)+_0x33e14a(0x13c)+_0x33e14a(0x128)+_0x33e14a(0x16a)+_0x29c7cc[_0x33e14a(0x1be)]+'\x20'+_0x33e14a(0x155)+_0x33e14a(0x1a8)+_0x29c7cc[_0x33e14a(0x124)]+'\x20'+_0x33e14a(0x16d)+'</h5>'+_0x33e14a(0x100)+_0x33e14a(0x1b2)+_0x33e14a(0x199)+_0x33e14a(0x107)+_0x33e14a(0x186)+_0x33e14a(0x18d)+_0x33e14a(0xeb)+_0x33e14a(0x11f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x33e14a(0x1af)+_0x33e14a(0x11c)+_0x33e14a(0x101)+'</tr>'+_0x33e14a(0x1b5)+_0x33e14a(0x132)+'\x20'+_0x27d366+'\x20'+_0x33e14a(0x18b)+_0x33e14a(0x18c)+_0x33e14a(0x13c)+_0x33e14a(0xff)+_0x33e14a(0x180)+_0x1101bf[0x0]['site_title']+_0x33e14a(0x1ac)+'</div>'+_0x33e14a(0x100)+_0x33e14a(0x12b)};_0x3ddf29[_0x33e14a(0x160)](_0x5e96ca,function(_0x5a4265,_0x78a0a1){var _0x4d4595=_0x33e14a;_0x5a4265?(console['log'](_0x5a4265),console[_0x4d4595(0x17f)](_0x4d4595(0x19b))):console[_0x4d4595(0x17f)]('Email\x20sent\x20successfully');}),_0x8ef8['flash']('success',_0x33e14a(0x127)),_0x444312[_0x33e14a(0x136)](_0x33e14a(0x179)+_0xb2e10b[_0x33e14a(0x129)]);}catch(_0x1cc2f7){console[_0x33e14a(0x1a1)](_0x1cc2f7),_0x444312[_0x33e14a(0x172)](0x1f4)[_0x33e14a(0xe2)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x57dcfe(0x17c)](_0x36adda=>{var _0x48b5d9=_0x57dcfe;console[_0x48b5d9(0x1a1)](_0x36adda),_0x444312[_0x48b5d9(0x172)](0x1f4)[_0x48b5d9(0xe2)]({'error':'An\x20error\x20occurred.'});});}catch(_0x1eb28d){console[_0x57dcfe(0x1a1)](_0x1eb28d),_0x444312[_0x57dcfe(0x172)](0x1f4)[_0x57dcfe(0xe2)]({'error':_0x57dcfe(0x190)});}})[_0x1448bf(0x17c)](_0xc21468=>{var _0x155fdf=_0x1448bf;console[_0x155fdf(0x1a1)](_0xc21468),_0x444312[_0x155fdf(0x172)](0x1f4)[_0x155fdf(0xe2)]({'error':_0x155fdf(0xf8)});});}catch(_0x5d7df1){_0x444312[_0x1448bf(0xe2)]({'message':_0x5d7df1[_0x1448bf(0x142)]});}});function a0_0x13ca(_0x48b4c9,_0xea344b){var _0x410078=a0_0x4100();return a0_0x13ca=function(_0x13ca9f,_0x501757){_0x13ca9f=_0x13ca9f-0xe1;var _0x58e29d=_0x410078[_0x13ca9f];return _0x58e29d;},a0_0x13ca(_0x48b4c9,_0xea344b);}function BayBinSelected(_0x3fe0f5,_0x5df626){var _0x151d21=a0_0x203598,_0x4ffc99=[];let _0x553f6d=[];var _0x1cf8f8=[];if(_0x3fe0f5==_0x151d21(0x117)){switch(_0x5df626){case _0x151d21(0x12e):_0x4ffc99=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x151d21(0xe3):_0x4ffc99=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1cf8f8=['DG'];}else{if(_0x3fe0f5==_0x151d21(0x1ad)){switch(_0x5df626){case _0x151d21(0x12e):_0x4ffc99=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x151d21(0xe3):_0x4ffc99=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1cf8f8=['FG'];}}return{'levels':_0x4ffc99,'identify':_0x1cf8f8};}function a0_0x4100(){var _0x11b9da=['id_transaction','primary_unit','from_invoice','True','FGSEmail','Portuguese','$product_details.isle','slice','sendMail','from_room','MaxStocks_data2','push','primary_code','from_prod_qty','RoomAssigned','from_bay','8136760jkJWiP','6242936flKNUa','\x20Order\x20Number\x20:\x20','$to_warehouse','errors','</span>','getMonth','</td>','German','product_code','status','to_bay','transfer_data','$product_details.batch_code','/view','Spanish','success','/picking_list/PDF_transfer/','to_prod_qty','product_code3','catch','secondary_unit','5DWzbtq','log','<h5>','564396LzpZcL','$product_details.product_stock','to_invoice','1117065IbBRHo','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','secondary_code','\x20<>\x20','aggregate','$product_details.rack','</tbody>','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','../models/all_models','string','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.invoice','flash','filter','toString','abs','length','Transfer\x20Mail','back','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','site_title','Error\x20Occurs','random','../middleware/auth','/CheckingWarehouse','6305352lbvOrK','from_room_name','error','params','concat','$product_details._id','English\x20(US)','Enclosed','$product_details.storage','\x20Order\x20Date\x20:\x20','staff','prod_name','$product_details.secondary_unit','</h5>','FROZEN\x20GOODS','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/transfer/view','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','French','</thead>','user','9MShBNX','ToRoomAssigned','New_Qty_Converted','$product_details.floorlevel','find','findOne','findById','invoice','to_room','English','Portuguese\x20(BR)','updateOne','/barcode_scanner3','product_stock','finalize','Arabic\x20(ae)','json','Rack\x202','email','$product_details.production_date','Hindi','<html><head><title></title>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','To_invoice','$product.from_room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','batch_code','undefined','$product_details.pallet','logo','$room','max','$invoice','body','2qIYrbQ','$product_details.type','prod_cat','production_date','An\x20error\x20occurred.','all','image','role','unit','maxPerUnit','$name','<strong>\x20Regards\x20</strong>','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.bin','to_prod_level','$product_details.level','bay','$product_details.secondary_code','<tr>','product','product_details','/transfer_finished/preview/','express','$product_details.maxPerUnit','14906oJGUhv','/barcode_scanner2','Arabic','$product.to_room_name','from_quantity','from_warehouse','$product_details.unit','$finalize','post','map','DRY\x20GOODS','$product_details.primary_code','/../public','TRFF-','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','MaxStocks_data','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<!DOCTYPE\x20html>','to_room_name','forEach','date','transfer_finished','\x20</h2>','Transfer\x20Finalize\x20Successfully','<h5\x20style=\x22text-align:\x20left;\x22>','_id','<hr\x20class=\x22my-3\x22>','</body></html>','get','expiry_date','Rack\x201','port','</head><body>','from_prod_level','<tbody\x20style=\x22text-align:\x20center;\x22>','product_date','/view/add_transfer','to_quantity','redirect','note','createTransport','$product','Enabled','32004310RcnFce','<div>','$product_details.product_name','edit_transfer_finished_view','render','/upload/','Ambient','message','maxProducts','QA\x20Warehouse','$product_details.product_code','/view/:id','then','to_warehouse','Chinese','padStart','$product_details.maxProducts','../public/language/languages.json','here2','/preview/:id','language','Finished\x20Goods','save','$product_details','warehouse','$product_details.expiry_date','<span\x20style=\x22float:\x20right;\x22>','add_transfer_finished','Router'];a0_0x4100=function(){return _0x11b9da;};return a0_0x4100();}router[a0_0x203598(0x12c)](a0_0x203598(0x146),auth,async(_0x40be99,_0x3e94a2)=>{var _0x4087a6=a0_0x203598;try{const {username:_0x139db3,email:_0x7b8f01,role:_0xbbb161}=_0x40be99[_0x4087a6(0x1b6)],_0x516f0e=_0x40be99[_0x4087a6(0x1b6)],_0x2494fa=await profile[_0x4087a6(0x1bc)]({'email':_0x516f0e[_0x4087a6(0xe4)]}),_0xabf92=await master_shop['find'](),_0x48d88b=await transfers_finished[_0x4087a6(0x1bd)](_0x40be99[_0x4087a6(0x1a2)]['id']);let _0x3ef056=new Date(_0x48d88b[_0x4087a6(0x12d)]),_0xefddca=('0'+_0x3ef056['getDate']())['slice'](-0x2),_0x1ab1a5=('0'+(_0x3ef056[_0x4087a6(0x16e)]()+0x1))[_0x4087a6(0x15f)](-0x2),_0x597161=_0x3ef056['getFullYear'](),_0x509486=_0x597161+'-'+_0x1ab1a5+'-'+_0xefddca,_0x598339;if(_0x516f0e[_0x4087a6(0xfb)]==_0x4087a6(0x1a9)){const _0x58c24a=await staff[_0x4087a6(0x1bc)]({'email':_0x516f0e[_0x4087a6(0xe4)]});_0x598339=await warehouse[_0x4087a6(0x1bb)]({'status':_0x4087a6(0x13a),'name':_0x58c24a[_0x4087a6(0x153)],'warehouse_category':_0x4087a6(0x150)});}else _0x598339=await warehouse['find']({'status':_0x4087a6(0x13a),'warehouse_category':'Finished\x20Goods'});const _0x1ff64d=await warehouse['aggregate']([{'$match':{'name':_0x48d88b[_0x4087a6(0x112)],'room':_0x48d88b[_0x4087a6(0x161)]}},{'$unwind':_0x4087a6(0x152)},{'$group':{'_id':_0x4087a6(0x1a4),'name':{'$first':_0x4087a6(0x13d)},'product_stock':{'$first':_0x4087a6(0x182)},'bay':{'$first':_0x4087a6(0x11e)},'bin':{'$first':_0x4087a6(0x102)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4087a6(0x1ba)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4087a6(0x106)},'product_code':{'$first':_0x4087a6(0x145)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);var _0x5d9f41=[0x1,0x2,0x3,0x4],_0x130b22=['A','B','C','D','E','F','G','H','I','J'],_0x12ff3f=[_0x4087a6(0x141),_0x4087a6(0x1a6)];const _0x47e010=await product[_0x4087a6(0x1bb)]({}),_0x44b763=BayBinSelected(_0x48d88b[_0x4087a6(0x148)],_0x48d88b[_0x4087a6(0x1bf)]);if(_0xabf92[0x0]['language']==_0x4087a6(0x1a5)){var _0x14f6ea=users[_0x4087a6(0x1c0)];console[_0x4087a6(0x17f)](_0x14f6ea);}else{if(_0xabf92[0x0][_0x4087a6(0x14f)]==_0x4087a6(0xe6))var _0x14f6ea=users[_0x4087a6(0xe6)];else{if(_0xabf92[0x0][_0x4087a6(0x14f)]==_0x4087a6(0x170))var _0x14f6ea=users[_0x4087a6(0x170)];else{if(_0xabf92[0x0]['language']=='Spanish')var _0x14f6ea=users[_0x4087a6(0x177)];else{if(_0xabf92[0x0][_0x4087a6(0x14f)]==_0x4087a6(0x1b4))var _0x14f6ea=users['French'];else{if(_0xabf92[0x0][_0x4087a6(0x14f)]==_0x4087a6(0x1c1))var _0x14f6ea=users[_0x4087a6(0x15d)];else{if(_0xabf92[0x0][_0x4087a6(0x14f)]==_0x4087a6(0x149))var _0x14f6ea=users[_0x4087a6(0x149)];else{if(_0xabf92[0x0][_0x4087a6(0x14f)]=='Arabic\x20(ae)')var _0x14f6ea=users['Arabic'];}}}}}}}_0x3e94a2[_0x4087a6(0x13f)]('edit_transfer_finished',{'success':_0x40be99[_0x4087a6(0x192)](_0x4087a6(0x178)),'errors':_0x40be99[_0x4087a6(0x192)](_0x4087a6(0x16c)),'role':_0x516f0e,'profile':_0x2494fa,'master_shop':_0xabf92,'warehouse':_0x598339,'transfer':_0x48d88b,'stock':_0x1ff64d,'unit':_0x47e010,'language':_0x14f6ea,'levels':_0x5d9f41,'Isle':_0x130b22,'rooms_data':_0x12ff3f,'ed_fullDate':_0x509486,'dataSelected':_0x44b763});}catch(_0x1f6941){console[_0x4087a6(0x17f)](_0x1f6941);}}),router['post']('/view/:id',auth,async(_0x2ef71f,_0x3e568f)=>{var _0x3e495a=a0_0x203598;try{const _0x381e43=_0x2ef71f[_0x3e495a(0x1a2)]['id'];console['log'](_0x2ef71f[_0x3e495a(0xf3)]);const _0x381519=await transfers_finished[_0x3e495a(0x1bd)](_0x381e43);console[_0x3e495a(0x17f)](_0x3e495a(0x174),_0x381519);const {date:_0x55cfb2,from_warehouse:_0x31eb9b,FromRoom_name:_0x3a1c53,to_warehouse:_0x2dec48,ToRoom_name:_0x1b8283,prod_name:_0x4badc4,from_prod_qty:_0x316ddc,from_prod_level:_0xb79413,from_prod_isle:_0x1a931a,from_prod_pallet:_0x456d70,to_prod_qty:_0xf8dcb5,to_prod_level:_0x23543b,to_prod_isle:_0xf60f15,to_prod_pallet:_0x18ef03,primary_code:_0x8c2657,secondary_code:_0x332c4b,product_code3:_0x3cb78d,note:_0x44dd01,invoice:_0x5c4734,expiry_date:_0x41435e}=_0x2ef71f[_0x3e495a(0xf3)];if(typeof _0x4badc4==_0x3e495a(0x18f))var _0x3d434a=[_0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x1aa)]],_0x52b466=[_0x2ef71f[_0x3e495a(0xf3)]['from_prod_qty']],_0x45d6a5=[_0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x131)]],_0x1a877e=[_0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x17a)]],_0x59c508=[_0x2ef71f['body'][_0x3e495a(0x103)]],_0x5cf0d7=[_0x2ef71f['body'][_0x3e495a(0x164)]],_0x19c1cb=[_0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x187)]],_0x149ea8=[_0x2ef71f[_0x3e495a(0xf3)]['product_code3']],_0x3d8c10=[_0x2ef71f[_0x3e495a(0xf3)]['MaxStocks_data2']],_0x180c33=[_0x2ef71f[_0x3e495a(0xf3)]['unit']],_0x6092b6=[_0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x17d)]],_0x442478=[_0x2ef71f['body'][_0x3e495a(0xec)]],_0x282788=[_0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x12d)]];else var _0x3d434a=[..._0x2ef71f[_0x3e495a(0xf3)]['prod_name']],_0x52b466=[..._0x2ef71f[_0x3e495a(0xf3)]['from_prod_qty']],_0x45d6a5=[..._0x2ef71f['body']['from_prod_level']],_0x1a877e=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x17a)]],_0x59c508=[..._0x2ef71f['body'][_0x3e495a(0x103)]],_0x5cf0d7=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x164)]],_0x19c1cb=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x187)]],_0x149ea8=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x17b)]],_0x3d8c10=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0x162)]],_0x180c33=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0xfc)]],_0x6092b6=[..._0x2ef71f['body']['secondary_unit']],_0x442478=[..._0x2ef71f[_0x3e495a(0xf3)][_0x3e495a(0xec)]],_0x282788=[..._0x2ef71f[_0x3e495a(0xf3)]['expiry_date']];const _0x57ebb1=_0x3d434a[_0x3e495a(0x116)](_0x4df839=>{return _0x4df839={'product_name':_0x4df839};});_0x52b466[_0x3e495a(0x123)]((_0x5908e9,_0xb8520a)=>{var _0x23b9e6=_0x3e495a;_0x57ebb1[_0xb8520a][_0x23b9e6(0x111)]=_0x5908e9;}),_0x45d6a5[_0x3e495a(0x123)]((_0x158dbc,_0x53416e)=>{var _0x10c785=_0x3e495a;_0x57ebb1[_0x53416e][_0x10c785(0x167)]=_0x158dbc;}),_0x1a877e['forEach']((_0x16035a,_0x46fe4a)=>{var _0x1e627b=_0x3e495a;_0x57ebb1[_0x46fe4a][_0x1e627b(0x135)]=_0x16035a;}),_0x59c508[_0x3e495a(0x123)]((_0x243d74,_0x3316da)=>{_0x57ebb1[_0x3316da]['to_bay']=_0x243d74;}),_0x5cf0d7[_0x3e495a(0x123)]((_0x34009a,_0x156a89)=>{var _0x5a562e=_0x3e495a;_0x57ebb1[_0x156a89][_0x5a562e(0x164)]=_0x34009a;}),_0x19c1cb['forEach']((_0x28a2cd,_0x20552b)=>{var _0x4b143e=_0x3e495a;_0x57ebb1[_0x20552b][_0x4b143e(0x187)]=_0x28a2cd;}),_0x149ea8[_0x3e495a(0x123)]((_0x93a7d6,_0x2c9fd7)=>{var _0x74dec3=_0x3e495a;_0x57ebb1[_0x2c9fd7][_0x74dec3(0x171)]=_0x93a7d6;}),_0x3d8c10[_0x3e495a(0x123)]((_0x2e8a71,_0x1aeb7f)=>{_0x57ebb1[_0x1aeb7f]['maxProducts']=_0x2e8a71;}),_0x180c33[_0x3e495a(0x123)]((_0x1e9ff6,_0x4b61d9)=>{_0x57ebb1[_0x4b61d9]['unit']=_0x1e9ff6;}),_0x6092b6[_0x3e495a(0x123)]((_0x3cd2e1,_0x32bace)=>{var _0x122d54=_0x3e495a;_0x57ebb1[_0x32bace][_0x122d54(0x17d)]=_0x3cd2e1;}),_0x442478['forEach']((_0x35db7c,_0x98bad9)=>{_0x57ebb1[_0x98bad9]['batch_code']=_0x35db7c;}),_0x282788[_0x3e495a(0x123)]((_0x4d3428,_0x11369c)=>{var _0x42a337=_0x3e495a;_0x57ebb1[_0x11369c][_0x42a337(0x12d)]=_0x4d3428;});const _0x2bcfa1=_0x57ebb1[_0x3e495a(0x193)](_0x353221=>_0x353221[_0x3e495a(0x135)]!=='0'&&_0x353221[_0x3e495a(0x135)]!==''||_0x353221['to_floorlevel']!=='0'&&_0x353221['to_floorlevel']!=='');var _0x4fa679=0x0;_0x2bcfa1[_0x3e495a(0x123)](_0x1ee9c9=>{var _0x269ade=_0x3e495a;parseInt(_0x1ee9c9['from_quantity'])<parseInt(_0x1ee9c9[_0x269ade(0x135)])&&_0x4fa679++;});if(_0x4fa679!=0x0)return _0x2ef71f[_0x3e495a(0x192)](_0x3e495a(0x16c),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3e568f[_0x3e495a(0x136)](_0x3e495a(0x198));const _0x46a950=await warehouse[_0x3e495a(0x1bc)]({'name':_0x381519[_0x3e495a(0x112)],'room':_0x381519['from_room']});_0x381519['product'][_0x3e495a(0x123)](_0x11b152=>{var _0x5e579c=_0x3e495a;if(_0x11b152['to_quantity']>0x0){const _0x4bdc99=_0x46a950[_0x5e579c(0x109)][_0x5e579c(0x116)](_0x32ec92=>{var _0x38b519=_0x5e579c;_0x32ec92[_0x38b519(0x11b)]==_0x11b152[_0x38b519(0x11b)]&&_0x32ec92[_0x38b519(0x105)]==_0x11b152[_0x38b519(0x167)]&&(_0x32ec92[_0x38b519(0x1c4)]=parseInt(_0x32ec92[_0x38b519(0x1c4)])+parseInt(_0x11b152[_0x38b519(0x135)]));});}}),await _0x46a950[_0x3e495a(0x151)]();const _0x1bb171=await warehouse[_0x3e495a(0x1bc)]({'name':_0x381519[_0x3e495a(0x148)],'room':_0x381519[_0x3e495a(0x1bf)]});_0x381519['product'][_0x3e495a(0x123)](_0x1421fb=>{var _0x195e6c=_0x3e495a;if(_0x1421fb[_0x195e6c(0x135)]>0x0){const _0x48cfc3=_0x1bb171[_0x195e6c(0x109)][_0x195e6c(0x116)](_0x39af65=>{var _0x20d8e6=_0x195e6c;_0x39af65[_0x20d8e6(0x11b)]==_0x1421fb['product_name']&&_0x39af65[_0x20d8e6(0x105)]==_0x1421fb[_0x20d8e6(0x173)]&&(_0x39af65[_0x20d8e6(0x1c4)]=parseInt(_0x39af65[_0x20d8e6(0x1c4)])-parseInt(_0x1421fb[_0x20d8e6(0x135)]));});}}),await _0x1bb171['save'](),_0x381519['date']=_0x55cfb2,_0x381519[_0x3e495a(0x112)]=_0x31eb9b,_0x381519[_0x3e495a(0x148)]=_0x2dec48,_0x381519[_0x3e495a(0x108)]=_0x2bcfa1,_0x381519[_0x3e495a(0x137)]=_0x44dd01,_0x381519['invoice']=_0x5c4734;const _0x34e280=await _0x381519['save'](),_0x4ed824=await warehouse[_0x3e495a(0x1bc)]({'name':_0x31eb9b,'room':_0x3a1c53});_0x34e280[_0x3e495a(0x108)]['forEach'](_0x446ee6=>{var _0x58d5e3=_0x3e495a;if(_0x446ee6[_0x58d5e3(0x135)]>0x0){const _0x59dd54=_0x4ed824[_0x58d5e3(0x109)][_0x58d5e3(0x116)](_0x4c9805=>{var _0x501735=_0x58d5e3;_0x4c9805['product_name']==_0x446ee6[_0x501735(0x11b)]&&_0x4c9805[_0x501735(0x105)]==_0x446ee6[_0x501735(0x167)]&&(_0x4c9805['product_stock']=parseInt(_0x4c9805[_0x501735(0x1c4)])-parseInt(_0x446ee6[_0x501735(0x135)]));});}}),await _0x4ed824[_0x3e495a(0x151)]();const _0x51b49a=await warehouse[_0x3e495a(0x1bc)]({'name':_0x2dec48,'room':_0x1b8283});_0x34e280[_0x3e495a(0x108)][_0x3e495a(0x123)](_0x45cd81=>{var _0x3b26cc=_0x3e495a;if(_0x45cd81[_0x3b26cc(0x135)]>0x0){var _0x56a4b0=0x0;const _0x133668=_0x51b49a['product_details'][_0x3b26cc(0x116)](_0x40f272=>{var _0x2ae9c4=_0x3b26cc;_0x40f272[_0x2ae9c4(0x11b)]==_0x45cd81[_0x2ae9c4(0x11b)]&&_0x40f272['bay']==_0x45cd81['to_bay']&&(_0x40f272[_0x2ae9c4(0x1c4)]=parseInt(_0x40f272['product_stock'])+parseInt(_0x45cd81[_0x2ae9c4(0x135)]),_0x56a4b0++);});_0x56a4b0=='0'&&(_0x51b49a['product_details']=_0x51b49a[_0x3b26cc(0x109)]['concat']({'product_name':_0x45cd81['product_name'],'product_stock':_0x45cd81[_0x3b26cc(0x135)],'bay':_0x45cd81[_0x3b26cc(0x173)],'product_code':_0x45cd81[_0x3b26cc(0x171)],'primary_code':_0x45cd81[_0x3b26cc(0x164)],'secondary_code':_0x45cd81[_0x3b26cc(0x187)],'maxProducts':_0x45cd81[_0x3b26cc(0x143)]}));}}),await _0x51b49a['save'](),_0x2ef71f['flash'](_0x3e495a(0x178),'Transfer\x20Edit\x20Successfully'),_0x3e568f['redirect']('/transfer_finished/view');}catch(_0x274203){console[_0x3e495a(0x17f)](_0x274203);}}),router['post'](a0_0x203598(0x1ae),async(_0x1bba95,_0x3403c7)=>{var _0x18b3ed=a0_0x203598;const {FromWareHouse:_0x17e7d3,FromRoom:_0x1892da,ToWarehouse:_0x2f31c0,ToRoom:_0x2afcd5,primary_code:_0x3f48c6,Roomslist:_0x38c964}=_0x1bba95[_0x18b3ed(0xf3)],_0x177929=_0x38c964['split'](','),_0x5edcdf=[];async function _0x1fd494(_0x489492){var _0xb1bbe7=_0x18b3ed;const _0x2ffb7a=await warehouse[_0xb1bbe7(0x189)]([{'$match':{'name':_0x17e7d3,'room':_0x489492}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x3f48c6}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xb1bbe7(0x13d)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xb1bbe7(0x145)},'level':{'$first':_0xb1bbe7(0x11e)},'isle':{'$first':_0xb1bbe7(0x102)},'type':{'$first':_0xb1bbe7(0xf5)},'pallet':{'$first':_0xb1bbe7(0x1ba)},'unit':{'$first':_0xb1bbe7(0x113)},'secondary_unit':{'$first':_0xb1bbe7(0x1ab)},'storage':{'$first':_0xb1bbe7(0x1a7)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xb1bbe7(0x154)},'production_date':{'$first':_0xb1bbe7(0xe5)},'batch_code':{'$first':_0xb1bbe7(0x175)},'maxPerUnit':{'$first':_0xb1bbe7(0x10c)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0xb1bbe7(0x191)}}}]),_0x240607=await warehouse[_0xb1bbe7(0x189)]([{'$match':{'name':_0x17e7d3,'room':_0x489492}},{'$unwind':_0xb1bbe7(0x152)},{'$match':{'product_details.secondary_code':_0x3f48c6}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xb1bbe7(0x13d)},'instock':{'$first':_0xb1bbe7(0x182)},'primary_code':{'$first':_0xb1bbe7(0x118)},'secondary_code':{'$first':_0xb1bbe7(0x106)},'product_code':{'$first':_0xb1bbe7(0x145)},'level':{'$first':_0xb1bbe7(0x11e)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0xb1bbe7(0xf5)},'pallet':{'$first':_0xb1bbe7(0x1ba)},'unit':{'$first':_0xb1bbe7(0x113)},'secondary_unit':{'$first':_0xb1bbe7(0x1ab)},'storage':{'$first':_0xb1bbe7(0x1a7)},'rack':{'$first':_0xb1bbe7(0x18a)},'expiry_date':{'$first':_0xb1bbe7(0x154)},'production_date':{'$first':_0xb1bbe7(0xe5)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0xb1bbe7(0x10c)},'roomNamed':{'$first':_0xb1bbe7(0xf0)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0xb1bbe7(0x191)}}}]);if(_0x2ffb7a[_0xb1bbe7(0x196)]>0x0)_0x5edcdf[_0xb1bbe7(0x163)](_0x2ffb7a);else _0x240607[_0xb1bbe7(0x196)]>0x0&&_0x5edcdf['push'](_0x240607);}const _0x58b342=_0x177929[_0x18b3ed(0x116)](_0x80a331=>_0x1fd494(_0x80a331));await Promise[_0x18b3ed(0xf9)](_0x58b342),_0x3403c7[_0x18b3ed(0xe2)](_0x5edcdf);}),router[a0_0x203598(0x115)](a0_0x203598(0x10e),async(_0x4ed67e,_0x7a6a1d)=>{var _0x177847=a0_0x203598;try{const {FromWareHouse:_0x1087b6,FromRoom:_0x2d25c5,ToWarehouse:_0x15c423,ToRoom:_0x55a83b,secondary_code:_0x498e99}=_0x4ed67e[_0x177847(0xf3)],_0x349a96=await warehouse[_0x177847(0x189)]([{'$match':{'name':_0x1087b6}},{'$unwind':_0x177847(0x152)},{'$match':{'product_details.secondary_code':_0x498e99}},{'$group':{'_id':_0x177847(0x1a4),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x177847(0x118)},'secondary_code':{'$first':_0x177847(0x106)},'product_code':{'$first':_0x177847(0x145)},'instock':{'$first':_0x177847(0x182)},'warehouse':{'$first':_0x177847(0xfe)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x177847(0x15e)},'pallet':{'$first':_0x177847(0xee)},'maxProducts':{'$first':_0x177847(0x14b)},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x177847(0x154)},'production_date':{'$first':_0x177847(0xe5)}}}]);_0x7a6a1d['status'](0xc8)[_0x177847(0xe2)](_0x349a96);}catch(_0x97878d){_0x7a6a1d[_0x177847(0x172)](0x194)['json']({'message':_0x97878d[_0x177847(0x142)]});}}),router[a0_0x203598(0x115)](a0_0x203598(0x1c3),async(_0x2c3d19,_0xaa97e2)=>{var _0x3b89a3=a0_0x203598;try{const {FromWareHouse:_0x5deb27,FromRoom:_0x27ba3a,ToWarehouse:_0x274755,ToRoom:_0x461cdd,product_code:_0x4c0d3c}=_0x2c3d19[_0x3b89a3(0xf3)],_0x6a752d=await warehouse['aggregate']([{'$match':{'name':_0x5deb27}},{'$unwind':_0x3b89a3(0x152)},{'$match':{'product_details.product_code':_0x4c0d3c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3b89a3(0x13d)},'primary_code':{'$first':_0x3b89a3(0x118)},'secondary_code':{'$first':_0x3b89a3(0x106)},'product_code':{'$first':_0x3b89a3(0x145)},'instock':{'$first':_0x3b89a3(0x182)},'warehouse':{'$first':_0x3b89a3(0xfe)},'level':{'$first':_0x3b89a3(0x104)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x3b89a3(0xee)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x3b89a3(0x113)}}}]);_0xaa97e2[_0x3b89a3(0x172)](0xc8)['json'](_0x6a752d);}catch(_0x291e54){_0xaa97e2[_0x3b89a3(0x172)](0x194)[_0x3b89a3(0xe2)]({'message':_0x291e54['message']});}}),router[a0_0x203598(0x115)](a0_0x203598(0x19e),async(_0x21c8b1,_0xafc0ca)=>{var _0x7d54fd=a0_0x203598;const {productCode:_0x4e1fe2,bay:_0x505e5d,warehouses:_0x4c895b,room:_0x668de}=_0x21c8b1['body'];console['log'](_0x21c8b1[_0x7d54fd(0xf3)]);try{const _0x4b881d=await warehouse[_0x7d54fd(0x189)]([{'$match':{'name':_0x4c895b,'room':_0x668de}},{'$unwind':_0x7d54fd(0x152)},{'$match':{'product_details.bay':parseInt(_0x505e5d)}},{'$group':{'_id':_0x7d54fd(0x1a4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x7d54fd(0x11e)},'maxProducts':{'$first':_0x7d54fd(0x14b)}}}]);_0xafc0ca[_0x7d54fd(0x172)](0xc8)['json'](_0x4b881d);}catch(_0x26c561){_0xafc0ca[_0x7d54fd(0x172)](0x194)[_0x7d54fd(0xe2)]({'message':_0x26c561[_0x7d54fd(0x142)]});}}),module['exports']=router;