var a0_0x3175b8=a0_0x66c5;function a0_0x81e4(){var _0x564af5=['error','$product_details','TRFF-','$product_details._id','$product_details.level','get','</span>','39229nGeQKE','transfer_finished','$product_details.type','/view/add_transfer','product_code3','<span\x20style=\x22float:\x20right;\x22>','to_prod_level','QA\x20Warehouse','product_date','params','<tbody\x20style=\x22text-align:\x20center;\x22>','from_quantity','French','save','from_bay','concat','</div>','../models/all_models','$product_details.maxProducts','Enabled','True','<h5\x20style=\x22text-align:\x20left;\x22>','<div>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.primary_code','$finalize','email','German','English\x20(US)','$product_details.isle','<h2>\x20','MaxStocks_data','back','$product','split','$product_details.bin','$product_details.batch_code','<strong>\x20Regards\x20</strong>','from_invoice','/view/:id','to_bay','Email\x20sent\x20successfully','/barcode_scanner2','to_room','finalize','Portuguese\x20(BR)','production_date','host','1448NKhovG','164WsbFts','/view','slice','json','10SWYpUP','getDate','filter','Product\x20Transfer\x20successfully','/transfer_finished/preview/','catch','Logo.png','primary_unit','Spanish','$product_details.expiry_date','FGSEmail','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','findOne','batch_code','\x20Order\x20Date\x20:\x20','ToRoomAssigned','bay','New_Qty_Converted','find','to_quantity','$product_details.unit','log','<h5>','$name','Ambient','string','user','2252313hMIhgh','/transfer_finished/view','../middleware/auth','DRY\x20GOODS','product_details','logo','maxProducts','$product.from_room_name','all','<!DOCTYPE\x20html>','errors','_id','/preview/:id','nodemailer','Arabic','$product_details.invoice','to_floorlevel','$product_details.floorlevel','invoice','</tr>','/../public','to_room_name','$invoice','success','maxPerUnit','prod_cat','site_title','language','push','Rack\x201','Transfer\x20Mail','$product_details.bay','from_room','expiry_date','$room','$product_details.secondary_unit','$product_details.maxPerUnit','port','Arabic\x20(ae)','12271ESNXED','/barcode_scanner','note','/transfer/view','An\x20error\x20occurred.','date','flash','to_invoice','$product_details.product_name','$product_details.product_stock','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.production_date','Enclosed','/barcode_scanner3','Transfer\x20Edit\x20Successfully','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.product_code','Chinese','secondary_code','edit_transfer_finished_view','createTransport','getMonth','warehouse','toString','prod_name','<tr>','length','sendMail','role','$product_details.storage','forEach','from_prod_qty','$product_details.rack','Transfer\x20Finalize\x20Successfully','product_code','getFullYear','</thead>','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','1910016FukmYP','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','map','floor','</body></html>','<hr\x20class=\x22my-3\x22>','product','from_room_name','exports','secondary_unit','findById','status','product_name','6711rThJxz','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','then','from_prod_level','aggregate','$product_details.pallet','</td>','RoomAssigned','100565WbEJIV','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../public/language/languages.json','Portuguese','message','To_invoice','500rSzPxi','English','Finished\x20Goods','from_warehouse','post','to_warehouse','redirect','render','Hindi','MaxStocks_data2','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','unit','$product_details.secondary_code','primary_code','/picking_list/PDF_transfer/','edit_transfer_finished','body','211398aZbUSr','$to_warehouse'];a0_0x81e4=function(){return _0x564af5;};return a0_0x81e4();}(function(_0x1d1cdd,_0x2d40d0){var _0x18d445=a0_0x66c5,_0x462a67=_0x1d1cdd();while(!![]){try{var _0x5b5322=parseInt(_0x18d445(0x1b2))/0x1*(parseInt(_0x18d445(0x112))/0x2)+-parseInt(_0x18d445(0x189))/0x3*(parseInt(_0x18d445(0x10e))/0x4)+-parseInt(_0x18d445(0x191))/0x5+-parseInt(_0x18d445(0x17c))/0x6+-parseInt(_0x18d445(0x154))/0x7*(parseInt(_0x18d445(0x10d))/0x8)+-parseInt(_0x18d445(0x12d))/0x9+-parseInt(_0x18d445(0x197))/0xa*(-parseInt(_0x18d445(0x1a9))/0xb);if(_0x5b5322===_0x2d40d0)break;else _0x462a67['push'](_0x462a67['shift']());}catch(_0xe45322){_0x462a67['push'](_0x462a67['shift']());}}}(a0_0x81e4,0x26e61));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x3175b8(0x1c3)),auth=require(a0_0x3175b8(0x12f)),users=require(a0_0x3175b8(0x193)),nodemailer=require(a0_0x3175b8(0x13a));function a0_0x66c5(_0x1648ac,_0xd8b73a){var _0x81e4fc=a0_0x81e4();return a0_0x66c5=function(_0x66c5ef,_0xf16dc8){_0x66c5ef=_0x66c5ef-0x10a;var _0x345ba7=_0x81e4fc[_0x66c5ef];return _0x345ba7;},a0_0x66c5(_0x1648ac,_0xd8b73a);}router[a0_0x3175b8(0x1b0)](a0_0x3175b8(0x10f),auth,async(_0x17f537,_0x5cb5cc)=>{var _0x347dc1=a0_0x3175b8;try{const {username:_0xdfbbeb,email:_0x44a66c,role:_0x1fe87b}=_0x17f537[_0x347dc1(0x12c)],_0x48a1c9=_0x17f537[_0x347dc1(0x12c)],_0x13a1b5=await profile['findOne']({'email':_0x48a1c9['email']}),_0x303a0e=await master_shop[_0x347dc1(0x124)]();let _0x364c89;if(_0x48a1c9['role']==_0x347dc1(0x15e)){const _0x2d009c=await staff[_0x347dc1(0x11e)]({'email':_0x48a1c9[_0x347dc1(0x1cc)]});_0x364c89=await transfers_finished[_0x347dc1(0x124)]({'from_warehouse':_0x2d009c[_0x347dc1(0x16b)]});}else _0x364c89=await transfers_finished[_0x347dc1(0x18d)]([{'$unwind':_0x347dc1(0x1d3)},{'$group':{'_id':'$_id','invoice':{'$first':_0x347dc1(0x143)},'date':{'$first':'$date'},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x347dc1(0x1aa)},'from_room_name':{'$addToSet':_0x347dc1(0x134)},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x347dc1(0x1cb)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x303a0e[0x0][_0x347dc1(0x148)]==_0x347dc1(0x1ce))var _0x548ee2=users[_0x347dc1(0x198)];else{if(_0x303a0e[0x0][_0x347dc1(0x148)]==_0x347dc1(0x19f))var _0x548ee2=users[_0x347dc1(0x19f)];else{if(_0x303a0e[0x0]['language']==_0x347dc1(0x1cd))var _0x548ee2=users[_0x347dc1(0x1cd)];else{if(_0x303a0e[0x0][_0x347dc1(0x148)]=='Spanish')var _0x548ee2=users[_0x347dc1(0x11a)];else{if(_0x303a0e[0x0][_0x347dc1(0x148)]=='French')var _0x548ee2=users[_0x347dc1(0x1be)];else{if(_0x303a0e[0x0]['language']=='Portuguese\x20(BR)')var _0x548ee2=users[_0x347dc1(0x194)];else{if(_0x303a0e[0x0]['language']=='Chinese')var _0x548ee2=users['Chinese'];else{if(_0x303a0e[0x0]['language']==_0x347dc1(0x153))var _0x548ee2=users['Arabic'];}}}}}}}_0x5cb5cc[_0x347dc1(0x19e)](_0x347dc1(0x1b3),{'success':_0x17f537[_0x347dc1(0x15a)](_0x347dc1(0x144)),'errors':_0x17f537['flash'](_0x347dc1(0x137)),'role':_0x48a1c9,'profile':_0x13a1b5,'master_shop':_0x303a0e,'transfer':_0x364c89,'language':_0x548ee2});}catch(_0x3eae56){console[_0x347dc1(0x127)](_0x3eae56);}});async function getRandom8DigitNumber(){var _0x3e2602=a0_0x3175b8;const _0xe8efbc=0x989680,_0x510adf=0x5f5e0ff,_0x55de97=Math[_0x3e2602(0x17f)](Math[_0x3e2602(0x1a1)]()*(_0x510adf-_0xe8efbc+0x1))+_0xe8efbc;var _0x1c25cf;const _0x4a9411=await transfers_finished[_0x3e2602(0x11e)]({'invoice':_0x3e2602(0x1ad)+_0x55de97});return _0x4a9411&&_0x4a9411[_0x3e2602(0x16f)]>0x0?_0x1c25cf='TRFF-'+_0x55de97:_0x1c25cf=_0x3e2602(0x1ad)+_0x55de97,_0x1c25cf;}router[a0_0x3175b8(0x1b0)](a0_0x3175b8(0x1b5),auth,async(_0x1715b0,_0x3e4387)=>{var _0x5c6bb8=a0_0x3175b8;try{const {username:_0x5627b0,email:_0x47476f,role:_0x2c80bd}=_0x1715b0[_0x5c6bb8(0x12c)],_0x45e148=_0x1715b0[_0x5c6bb8(0x12c)],_0x32f049=await profile[_0x5c6bb8(0x11e)]({'email':_0x45e148[_0x5c6bb8(0x1cc)]}),_0x1ccee4=await master_shop[_0x5c6bb8(0x124)]();let _0x25feaf;if(_0x45e148[_0x5c6bb8(0x171)]==_0x5c6bb8(0x15e)){const _0x382354=await staff[_0x5c6bb8(0x11e)]({'email':_0x45e148[_0x5c6bb8(0x1cc)]});_0x25feaf=await warehouse[_0x5c6bb8(0x18d)]([{'$match':{'status':_0x5c6bb8(0x1c5),'name':_0x382354['warehouse'],'warehouse_category':_0x5c6bb8(0x199),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x5c6bb8(0x129),'name':{'$first':'$name'}}}]);}else _0x25feaf=await warehouse[_0x5c6bb8(0x18d)]([{'$match':{'status':'Enabled','warehouse_category':_0x5c6bb8(0x199),'name':{'$ne':_0x5c6bb8(0x1b9)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5a7463=await transfers_finished['find']({}),_0x59aedd=_0x5a7463[_0x5c6bb8(0x16f)]+0x1,_0xabf06f=_0x5c6bb8(0x1ad)+_0x59aedd[_0x5c6bb8(0x16c)]()['padStart'](0x5,'0');if(_0x1ccee4[0x0][_0x5c6bb8(0x148)]==_0x5c6bb8(0x1ce))var _0x479135=users[_0x5c6bb8(0x198)];else{if(_0x1ccee4[0x0]['language']==_0x5c6bb8(0x19f))var _0x479135=users[_0x5c6bb8(0x19f)];else{if(_0x1ccee4[0x0][_0x5c6bb8(0x148)]==_0x5c6bb8(0x1cd))var _0x479135=users[_0x5c6bb8(0x1cd)];else{if(_0x1ccee4[0x0][_0x5c6bb8(0x148)]==_0x5c6bb8(0x11a))var _0x479135=users[_0x5c6bb8(0x11a)];else{if(_0x1ccee4[0x0][_0x5c6bb8(0x148)]=='French')var _0x479135=users[_0x5c6bb8(0x1be)];else{if(_0x1ccee4[0x0][_0x5c6bb8(0x148)]=='Portuguese\x20(BR)')var _0x479135=users[_0x5c6bb8(0x194)];else{if(_0x1ccee4[0x0][_0x5c6bb8(0x148)]==_0x5c6bb8(0x166))var _0x479135=users[_0x5c6bb8(0x166)];else{if(_0x1ccee4[0x0]['language']==_0x5c6bb8(0x153))var _0x479135=users[_0x5c6bb8(0x13b)];}}}}}}}const _0x5c5cc2=getRandom8DigitNumber();_0x5c5cc2[_0x5c6bb8(0x18b)](_0x2159da=>{var _0x343c28=_0x5c6bb8;_0x3e4387[_0x343c28(0x19e)]('add_transfer_finished',{'success':_0x1715b0['flash'](_0x343c28(0x144)),'errors':_0x1715b0[_0x343c28(0x15a)](_0x343c28(0x137)),'role':_0x45e148,'profile':_0x32f049,'master_shop':_0x1ccee4,'warehouse':_0x25feaf,'language':_0x479135,'invoice':_0x2159da});})[_0x5c6bb8(0x117)](_0x92b5bb=>{var _0xa7f21f=_0x5c6bb8;_0x1715b0['flash'](_0xa7f21f(0x137),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3e4387[_0xa7f21f(0x19d)](_0xa7f21f(0x157));});}catch(_0x909f1d){console[_0x5c6bb8(0x127)](_0x909f1d);}}),router['post'](a0_0x3175b8(0x1b5),auth,async(_0x3b9018,_0x5cd780)=>{var _0x3fdab1=a0_0x3175b8;try{const {date:_0x209d73,from_warehouse:_0x1b046e,FromRoom_name:_0x1ad966,to_warehouse:_0x564047,ToRoom_name:_0x4b2220,prod_name:_0x2c9617,from_prod_qty:_0x12de15,from_prod_level:_0x228d27,from_prod_isle:_0x2fc616,from_prod_pallet:_0x404266,to_prod_qty:_0x5aef00,to_prod_level:_0x3c28ff,to_prod_isle:_0x5e8616,to_prod_pallet:_0x58d485,primary_code:_0x2c0a4d,secondary_code:_0x336b5e,product_code3:_0x57ff20,note:_0x181722,MaxStocks_data2:_0x1a8258,invoice:_0x565a51,expiry_date:_0x3d473b}=_0x3b9018[_0x3fdab1(0x1a8)];if(typeof _0x2c9617==_0x3fdab1(0x12b))var _0x532be7=[_0x3b9018['body'][_0x3fdab1(0x16d)]],_0x139a3b=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x174)]],_0x19d286=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x18c)]],_0x2b1ca4=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x123)]],_0x65b78b=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1b8)]],_0x464b88=[_0x3b9018[_0x3fdab1(0x1a8)]['primary_code']],_0xdd3cbf=[_0x3b9018['body'][_0x3fdab1(0x167)]],_0x4ce7c4=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1b6)]],_0x3181b2=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1a0)]],_0x12c434=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x119)]],_0x4caea0=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x185)]],_0x236c58=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x11f)]],_0x1514fe=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x14e)]],_0x2a996f=[_0x3b9018['body'][_0x3fdab1(0x1ba)]],_0x5d7ae3=[_0x3b9018['body'][_0x3fdab1(0x1d1)]],_0x2623fd=[_0x3b9018[_0x3fdab1(0x1a8)]['maxPerUnit']],_0x5d69f3=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x146)]],_0x3b85ca=[_0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x190)]],_0x4c28ac=[_0x3b9018[_0x3fdab1(0x1a8)]['ToRoomAssigned']],_0xf8497e=[_0x3b9018[_0x3fdab1(0x1a8)]['from_invoice']],_0x18bf54=[_0x3b9018['body'][_0x3fdab1(0x15b)]];else var _0x532be7=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x16d)]],_0x139a3b=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x174)]],_0x19d286=[..._0x3b9018['body'][_0x3fdab1(0x18c)]],_0x2b1ca4=[..._0x3b9018['body'][_0x3fdab1(0x123)]],_0x65b78b=[..._0x3b9018[_0x3fdab1(0x1a8)]['to_prod_level']],_0x464b88=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1a5)]],_0xdd3cbf=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x167)]],_0x4ce7c4=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1b6)]],_0x3181b2=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1a0)]],_0x12c434=[..._0x3b9018['body']['primary_unit']],_0x4caea0=[..._0x3b9018[_0x3fdab1(0x1a8)]['secondary_unit']],_0x236c58=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x11f)]],_0x1514fe=[..._0x3b9018['body'][_0x3fdab1(0x14e)]],_0x2a996f=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1ba)]],_0x5d7ae3=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x1d1)]],_0x2623fd=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x145)]],_0x5d69f3=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x146)]],_0x3b85ca=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x190)]],_0x4c28ac=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x121)]],_0xf8497e=[..._0x3b9018[_0x3fdab1(0x1a8)]['from_invoice']],_0x18bf54=[..._0x3b9018[_0x3fdab1(0x1a8)][_0x3fdab1(0x15b)]];const _0x3c2240=_0x532be7[_0x3fdab1(0x17e)](_0x1cc318=>{return _0x1cc318={'product_name':_0x1cc318};});_0x139a3b[_0x3fdab1(0x173)]((_0x1b8e61,_0x2ec917)=>{var _0x250abd=_0x3fdab1;_0x3c2240[_0x2ec917][_0x250abd(0x1bd)]=_0x1b8e61;}),_0x19d286[_0x3fdab1(0x173)]((_0x59baad,_0x9ddadf)=>{var _0x378a46=_0x3fdab1;_0x3c2240[_0x9ddadf][_0x378a46(0x1c0)]=_0x59baad;}),_0xf8497e[_0x3fdab1(0x173)]((_0x37e4c0,_0x2d57b6)=>{var _0x5f268f=_0x3fdab1;_0x3c2240[_0x2d57b6][_0x5f268f(0x1d8)]=_0x37e4c0;}),_0x18bf54[_0x3fdab1(0x173)]((_0x1d1ef3,_0x365f3a)=>{var _0x4e69d1=_0x3fdab1;_0x3c2240[_0x365f3a][_0x4e69d1(0x196)]=_0x1d1ef3;}),_0x2b1ca4['forEach']((_0x2ba7e1,_0x3068bd)=>{var _0x2204f0=_0x3fdab1;_0x3c2240[_0x3068bd][_0x2204f0(0x125)]=_0x2ba7e1;}),_0x65b78b['forEach']((_0x490ab8,_0x4cf411)=>{var _0x4cf7f6=_0x3fdab1;_0x3c2240[_0x4cf411][_0x4cf7f6(0x1da)]=_0x490ab8;}),_0x464b88['forEach']((_0x2d4b8d,_0x62fccc)=>{var _0x3d9d00=_0x3fdab1;_0x3c2240[_0x62fccc][_0x3d9d00(0x1a5)]=_0x2d4b8d;}),_0xdd3cbf[_0x3fdab1(0x173)]((_0xd6cbea,_0x5c6274)=>{var _0x29d1e1=_0x3fdab1;_0x3c2240[_0x5c6274][_0x29d1e1(0x167)]=_0xd6cbea;}),_0x4ce7c4[_0x3fdab1(0x173)]((_0x32a3dc,_0x2fa2d9)=>{var _0x54352c=_0x3fdab1;_0x3c2240[_0x2fa2d9][_0x54352c(0x177)]=_0x32a3dc;}),_0x3181b2[_0x3fdab1(0x173)]((_0x15280e,_0x2d8e06)=>{var _0x13ea05=_0x3fdab1;_0x3c2240[_0x2d8e06][_0x13ea05(0x133)]=_0x15280e;}),_0x12c434[_0x3fdab1(0x173)]((_0x7bb3f8,_0x29b93e)=>{_0x3c2240[_0x29b93e]['unit']=_0x7bb3f8;}),_0x4caea0['forEach']((_0x19e8a5,_0x56a9bc)=>{var _0x64fa9b=_0x3fdab1;_0x3c2240[_0x56a9bc][_0x64fa9b(0x185)]=_0x19e8a5;}),_0x236c58['forEach']((_0x4f3398,_0x108d34)=>{var _0x3865e2=_0x3fdab1;_0x3c2240[_0x108d34][_0x3865e2(0x11f)]=_0x4f3398;}),_0x1514fe[_0x3fdab1(0x173)]((_0xe53b93,_0x39d29e)=>{var _0x8f3df3=_0x3fdab1;_0x3c2240[_0x39d29e][_0x8f3df3(0x14e)]=_0xe53b93;}),_0x2a996f['forEach']((_0x1ad4ee,_0x226b92)=>{var _0x48ae4d=_0x3fdab1;_0x3c2240[_0x226b92][_0x48ae4d(0x10b)]=_0x1ad4ee;}),_0x5d7ae3[_0x3fdab1(0x173)]((_0x506bd3,_0x41acd2)=>{var _0x31d397=_0x3fdab1;_0x3c2240[_0x41acd2][_0x31d397(0x133)]=_0x506bd3;}),_0x2623fd[_0x3fdab1(0x173)]((_0xcd7ff9,_0x5a3df0)=>{var _0x367500=_0x3fdab1;_0x3c2240[_0x5a3df0][_0x367500(0x145)]=_0xcd7ff9;}),_0x5d69f3[_0x3fdab1(0x173)]((_0xa4fe91,_0x511f54)=>{var _0x1cfe38=_0x3fdab1;_0x3c2240[_0x511f54][_0x1cfe38(0x146)]=_0xa4fe91;}),_0x3b85ca[_0x3fdab1(0x173)]((_0x224f02,_0x65fc89)=>{var _0x4b635e=_0x3fdab1;_0x3c2240[_0x65fc89][_0x4b635e(0x183)]=_0x224f02;}),_0x4c28ac['forEach']((_0x3ef6ca,_0x333fa8)=>{_0x3c2240[_0x333fa8]['to_room_name']=_0x3ef6ca;});const _0x2d9306=_0x3c2240[_0x3fdab1(0x114)](_0x12e91a=>_0x12e91a['to_quantity']!=='0'&&_0x12e91a['to_quantity']!==''||_0x12e91a[_0x3fdab1(0x13d)]!=='0'&&_0x12e91a[_0x3fdab1(0x13d)]!=='');var _0x1d0416=0x0;_0x2d9306[_0x3fdab1(0x173)](_0x270f78=>{var _0x59b1f8=_0x3fdab1;parseInt(_0x270f78[_0x59b1f8(0x1bd)])<parseInt(_0x270f78[_0x59b1f8(0x125)])&&_0x1d0416++;});if(_0x1d0416!=0x0)return _0x3b9018['flash'](_0x3fdab1(0x137),_0x3fdab1(0x11d)),_0x5cd780[_0x3fdab1(0x19d)](_0x3fdab1(0x1d2));const _0x23c168=new transfers_finished({'date':_0x209d73,'from_warehouse':_0x1b046e,'to_warehouse':_0x564047,'product':_0x2d9306,'note':_0x181722,'invoice':_0x565a51}),_0x243932=await _0x23c168[_0x3fdab1(0x1bf)]();_0x3b9018[_0x3fdab1(0x15a)](_0x3fdab1(0x144),_0x3fdab1(0x115)),_0x5cd780[_0x3fdab1(0x19d)](_0x3fdab1(0x116)+_0x243932[_0x3fdab1(0x138)]);}catch(_0x4b7a91){console['log'](_0x4b7a91),_0x5cd780[_0x3fdab1(0x187)](0xc8)[_0x3fdab1(0x111)]({'errorMessage':_0x4b7a91[_0x3fdab1(0x195)]});}}),router['get'](a0_0x3175b8(0x139),auth,async(_0x17a4e4,_0x5575d6)=>{var _0x4a47cb=a0_0x3175b8;try{const {username:_0x2d3a58,email:_0x1c9822,role:_0x436c1d}=_0x17a4e4[_0x4a47cb(0x12c)],_0x927cc5=_0x17a4e4[_0x4a47cb(0x12c)],_0x249e9a=await profile[_0x4a47cb(0x11e)]({'email':_0x927cc5[_0x4a47cb(0x1cc)]}),_0x201136=await master_shop[_0x4a47cb(0x124)](),_0x238e72=await transfers_finished[_0x4a47cb(0x186)](_0x17a4e4['params']['id']);let _0x1cc2b5;if(_0x927cc5[_0x4a47cb(0x171)]==_0x4a47cb(0x15e)){const _0x84542=await staff[_0x4a47cb(0x11e)]({'email':_0x927cc5['email']});_0x1cc2b5=await warehouse[_0x4a47cb(0x124)]({'status':'Enabled','name':_0x84542[_0x4a47cb(0x16b)],'warehouse_category':'Finished\x20Goods'});}else _0x1cc2b5=await warehouse[_0x4a47cb(0x124)]({'status':'Enabled','warehouse_category':_0x4a47cb(0x199)});const _0x15a4bd=await warehouse['aggregate']([{'$match':{'name':_0x238e72['from_warehouse'],'warehouse_category':_0x4a47cb(0x199)}},{'$unwind':_0x4a47cb(0x1ac)},{'$group':{'_id':_0x4a47cb(0x1ae),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4a47cb(0x15d)},'bay':{'$first':_0x4a47cb(0x14c)},'bin':{'$first':_0x4a47cb(0x1d5)},'type':{'$first':_0x4a47cb(0x1b4)},'floorlevel':{'$first':_0x4a47cb(0x13e)},'primary_code':{'$first':_0x4a47cb(0x1ca)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4a47cb(0x172)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4a47cb(0x11b)},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':_0x4a47cb(0x14f)},'warehoue_name':{'$first':_0x4a47cb(0x129)}}}]),_0x12140f=await product[_0x4a47cb(0x124)]({});if(_0x201136[0x0]['language']==_0x4a47cb(0x1ce)){var _0x54630b=users[_0x4a47cb(0x198)];console[_0x4a47cb(0x127)](_0x54630b);}else{if(_0x201136[0x0]['language']=='Hindi')var _0x54630b=users['Hindi'];else{if(_0x201136[0x0][_0x4a47cb(0x148)]==_0x4a47cb(0x1cd))var _0x54630b=users[_0x4a47cb(0x1cd)];else{if(_0x201136[0x0][_0x4a47cb(0x148)]==_0x4a47cb(0x11a))var _0x54630b=users['Spanish'];else{if(_0x201136[0x0][_0x4a47cb(0x148)]==_0x4a47cb(0x1be))var _0x54630b=users[_0x4a47cb(0x1be)];else{if(_0x201136[0x0][_0x4a47cb(0x148)]==_0x4a47cb(0x10a))var _0x54630b=users[_0x4a47cb(0x194)];else{if(_0x201136[0x0][_0x4a47cb(0x148)]==_0x4a47cb(0x166))var _0x54630b=users[_0x4a47cb(0x166)];else{if(_0x201136[0x0][_0x4a47cb(0x148)]==_0x4a47cb(0x153))var _0x54630b=users[_0x4a47cb(0x13b)];}}}}}}}_0x5575d6[_0x4a47cb(0x19e)](_0x4a47cb(0x168),{'success':_0x17a4e4['flash']('success'),'errors':_0x17a4e4[_0x4a47cb(0x15a)]('errors'),'role':_0x927cc5,'profile':_0x249e9a,'master_shop':_0x201136,'warehouse':_0x1cc2b5,'transfer':_0x238e72,'stock':_0x15a4bd,'unit':_0x12140f,'language':_0x54630b});}catch(_0x553e81){console[_0x4a47cb(0x127)](_0x553e81);}}),router['post'](a0_0x3175b8(0x139),auth,async(_0x54a3db,_0x107f06)=>{var _0x44161b=a0_0x3175b8;try{const {invoice:_0x1704ef,from_warehouse:_0x203199,FromRoom_name:_0x23a114,to_warehouse:_0xe0970d,ToRoom_name:_0x303671}=_0x54a3db['body'],_0x57ac8a=await transfers_finished[_0x44161b(0x186)](_0x54a3db[_0x44161b(0x1bb)]['id']),_0x4e47a3=_0x57ac8a['product']['map'](async _0x5790f3=>{var _0x5ad05d=_0x44161b;if(_0x5790f3[_0x5ad05d(0x125)]>0x0){var _0x19c96e=await warehouse['findOne']({'name':_0x203199,'room':_0x5790f3[_0x5ad05d(0x183)],'warehouse_category':_0x5ad05d(0x199)});const _0x5c2849=_0x19c96e[_0x5ad05d(0x131)][_0x5ad05d(0x17e)](_0x304f2a=>{var _0x43453b=_0x5ad05d;_0x304f2a['product_name']==_0x5790f3[_0x43453b(0x188)]&&_0x304f2a[_0x43453b(0x122)]==_0x5790f3['from_bay']&&_0x304f2a[_0x43453b(0x14e)]==_0x5790f3[_0x43453b(0x14e)]&&_0x304f2a[_0x43453b(0x10b)]==_0x5790f3[_0x43453b(0x10b)]&&_0x304f2a[_0x43453b(0x11f)]==_0x5790f3[_0x43453b(0x11f)]&&_0x304f2a['invoice']==_0x5790f3[_0x43453b(0x1d8)]&&(_0x304f2a[_0x43453b(0x17a)]=_0x304f2a[_0x43453b(0x17a)]-_0x5790f3[_0x43453b(0x125)]);});}return _0x19c96e;});Promise[_0x44161b(0x135)](_0x4e47a3)[_0x44161b(0x18b)](async _0x15f3e4=>{var _0x49132a=_0x44161b;try{for(const _0x4d3049 of _0x15f3e4){await _0x4d3049['save']();}const _0x599798=_0x57ac8a[_0x49132a(0x182)][_0x49132a(0x17e)](async _0x28019f=>{var _0x37f776=_0x49132a,_0x2a92f1=await warehouse[_0x37f776(0x11e)]({'name':_0xe0970d,'room':_0x28019f[_0x37f776(0x142)]});if(_0x28019f[_0x37f776(0x125)]>0x0){var _0x1324a4=0x0;const _0x4e3f33=_0x2a92f1[_0x37f776(0x131)][_0x37f776(0x17e)](_0x3efc8e=>{var _0x5d5ff0=_0x37f776;_0x3efc8e[_0x5d5ff0(0x188)]==_0x28019f['product_name']&&_0x3efc8e['bay']==_0x28019f[_0x5d5ff0(0x1da)]&&_0x3efc8e['expiry_date']==_0x28019f[_0x5d5ff0(0x14e)]&&_0x3efc8e[_0x5d5ff0(0x10b)]==_0x28019f[_0x5d5ff0(0x10b)]&&_0x3efc8e[_0x5d5ff0(0x11f)]==_0x28019f['batch_code']&&_0x3efc8e[_0x5d5ff0(0x13f)]==_0x28019f[_0x5d5ff0(0x196)]&&(_0x3efc8e['product_stock']=_0x3efc8e['product_stock']+_0x28019f[_0x5d5ff0(0x125)],_0x1324a4++);});_0x1324a4=='0'&&(_0x2a92f1[_0x37f776(0x131)]=_0x2a92f1['product_details'][_0x37f776(0x1c1)]({'product_name':_0x28019f[_0x37f776(0x188)],'product_stock':_0x28019f['to_quantity'],'bay':_0x28019f['to_bay'],'product_code':_0x28019f[_0x37f776(0x177)],'primary_code':_0x28019f['primary_code'],'secondary_code':_0x28019f[_0x37f776(0x167)],'expiry_date':_0x28019f[_0x37f776(0x14e)],'production_date':_0x28019f[_0x37f776(0x10b)],'maxProducts':_0x28019f[_0x37f776(0x133)],'batch_code':_0x28019f[_0x37f776(0x11f)],'secondary_unit':_0x28019f[_0x37f776(0x185)],'unit':_0x28019f[_0x37f776(0x1a3)],'maxProducts':_0x28019f[_0x37f776(0x133)],'maxPerUnit':_0x28019f[_0x37f776(0x145)],'invoice':_0x28019f[_0x37f776(0x196)]}));}return _0x2a92f1;});Promise[_0x49132a(0x135)](_0x599798)[_0x49132a(0x18b)](async _0x33e982=>{var _0xd289e3=_0x49132a;try{for(const _0x4631ec of _0x33e982){await warehouse['updateOne']({'_id':_0x4631ec[_0xd289e3(0x138)]},{'$addToSet':{'product_details':{'$each':_0x4631ec[_0xd289e3(0x131)]}}});}_0x57ac8a[_0xd289e3(0x1de)]=_0xd289e3(0x1c6);const _0x1662ed=await _0x57ac8a['save'](),_0x1bc549=await master_shop[_0xd289e3(0x124)](),_0x2a694d=await email_settings['findOne'](),_0x3272a2=await supervisor_settings[_0xd289e3(0x124)]();var _0x4066a9=_0x57ac8a[_0xd289e3(0x182)],_0x267349='',_0x4bf166;for(_0x4bf166 in _0x4066a9){var _0x578ce5='FG';_0x57ac8a['to_warehouse']==_0xd289e3(0x130)&&(_0x578ce5='DG'),_0x267349+=_0xd289e3(0x16e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4066a9[_0x4bf166][_0xd289e3(0x188)]+_0xd289e3(0x18f)+_0xd289e3(0x192)+_0x4066a9[_0x4bf166][_0xd289e3(0x177)]+_0xd289e3(0x18f)+_0xd289e3(0x192)+_0x4066a9[_0x4bf166][_0xd289e3(0x125)]+_0xd289e3(0x18f)+_0xd289e3(0x192)+_0x4066a9[_0x4bf166][_0xd289e3(0x1a3)]+_0xd289e3(0x18f)+_0xd289e3(0x192)+_0x4066a9[_0x4bf166][_0xd289e3(0x185)]+_0xd289e3(0x18f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57ac8a[_0xd289e3(0x19c)]+'</td>'+_0xd289e3(0x192)+_0x4066a9[_0x4bf166][_0xd289e3(0x142)]+_0xd289e3(0x18f)+_0xd289e3(0x192)+_0x578ce5+_0x4066a9[_0x4bf166]['to_bay']+_0xd289e3(0x18f)+_0xd289e3(0x140);}let _0x40c09a=nodemailer[_0xd289e3(0x169)]({'host':_0x2a694d[_0xd289e3(0x10c)],'port':Number(_0x2a694d[_0xd289e3(0x152)]),'secure':![],'auth':{'user':_0x2a694d[_0xd289e3(0x1cc)],'pass':_0x2a694d['password']}}),_0x5adc96={'from':_0x2a694d[_0xd289e3(0x1cc)],'to':_0x3272a2[0x0][_0xd289e3(0x11c)],'subject':_0xd289e3(0x14b),'attachments':[{'filename':_0xd289e3(0x118),'path':__dirname+_0xd289e3(0x141)+'/upload/'+_0x1bc549[0x0]['image'],'cid':_0xd289e3(0x132)}],'html':_0xd289e3(0x136)+'<html><head><title></title>'+'</head><body>'+_0xd289e3(0x1c8)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0xd289e3(0x164)+_0xd289e3(0x1c2)+'<div>'+_0xd289e3(0x1d0)+_0x1bc549[0x0]['site_title']+'\x20</h2>'+_0xd289e3(0x1c2)+'</div>'+_0xd289e3(0x181)+'<div>'+_0xd289e3(0x1c7)+'\x20Order\x20Number\x20:\x20'+_0x57ac8a[_0xd289e3(0x13f)]+'\x20'+_0xd289e3(0x1b7)+_0xd289e3(0x120)+_0x57ac8a[_0xd289e3(0x159)]+'\x20'+_0xd289e3(0x1b1)+'</h5>'+_0xd289e3(0x1c2)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0xd289e3(0x17d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0xd289e3(0x18a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0xd289e3(0x17b)+_0xd289e3(0x1a2)+_0xd289e3(0x15f)+'</tr>'+_0xd289e3(0x179)+_0xd289e3(0x1bc)+'\x20'+_0x267349+'\x20'+'</tbody>'+'</table>'+_0xd289e3(0x1c8)+_0xd289e3(0x1d7)+_0xd289e3(0x128)+_0x1bc549[0x0][_0xd289e3(0x147)]+'</h5>'+_0xd289e3(0x1c2)+_0xd289e3(0x1c2)+_0xd289e3(0x180)};_0x40c09a[_0xd289e3(0x170)](_0x5adc96,function(_0x40fbae,_0x3ebd4e){var _0x13fcd1=_0xd289e3;_0x40fbae?(console['log'](_0x40fbae),console[_0x13fcd1(0x127)]('Error\x20Occurs')):console[_0x13fcd1(0x127)](_0x13fcd1(0x1db));}),_0x54a3db[_0xd289e3(0x15a)]('success',_0xd289e3(0x176)),_0x107f06[_0xd289e3(0x19d)](_0xd289e3(0x1a6)+_0x1662ed[_0xd289e3(0x138)]);}catch(_0x2e2889){console[_0xd289e3(0x1ab)](_0x2e2889),_0x107f06['status'](0x1f4)[_0xd289e3(0x111)]({'error':_0xd289e3(0x1c9)});}})['catch'](_0x436145=>{var _0x330771=_0x49132a;console['error'](_0x436145),_0x107f06[_0x330771(0x187)](0x1f4)['json']({'error':_0x330771(0x158)});});}catch(_0x48d95b){console['error'](_0x48d95b),_0x107f06['status'](0x1f4)[_0x49132a(0x111)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x275b33=>{var _0xd88f41=_0x44161b;console['error'](_0x275b33),_0x107f06[_0xd88f41(0x187)](0x1f4)[_0xd88f41(0x111)]({'error':_0xd88f41(0x158)});});}catch(_0xc99f46){_0x107f06[_0x44161b(0x111)]({'message':_0xc99f46['message']});}});function BayBinSelected(_0x25f7d3,_0x3db673){var _0x1d9ace=a0_0x3175b8,_0x593f2b=[];let _0x4bbfbb=[];var _0x518c9b=[];if(_0x25f7d3==_0x1d9ace(0x130)){switch(_0x3db673){case _0x1d9ace(0x14a):_0x593f2b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x593f2b=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x518c9b=['DG'];}else{if(_0x25f7d3=='FROZEN\x20GOODS'){switch(_0x3db673){case _0x1d9ace(0x14a):_0x593f2b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x593f2b=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x518c9b=['FG'];}}return{'levels':_0x593f2b,'identify':_0x518c9b};}router['get'](a0_0x3175b8(0x1d9),auth,async(_0x536276,_0x31e502)=>{var _0x410b59=a0_0x3175b8;try{const {username:_0x5109bb,email:_0x177130,role:_0x53c22b}=_0x536276['user'],_0x34d330=_0x536276['user'],_0x148465=await profile[_0x410b59(0x11e)]({'email':_0x34d330[_0x410b59(0x1cc)]}),_0x5cb1cc=await master_shop[_0x410b59(0x124)](),_0x30fc69=await transfers_finished['findById'](_0x536276['params']['id']);let _0x224d54=new Date(_0x30fc69[_0x410b59(0x14e)]),_0x1a7756=('0'+_0x224d54[_0x410b59(0x113)]())[_0x410b59(0x110)](-0x2),_0x15172a=('0'+(_0x224d54[_0x410b59(0x16a)]()+0x1))[_0x410b59(0x110)](-0x2),_0x2e8eab=_0x224d54[_0x410b59(0x178)](),_0x3fbb89=_0x2e8eab+'-'+_0x15172a+'-'+_0x1a7756,_0x46a4cb;if(_0x34d330[_0x410b59(0x171)]==_0x410b59(0x15e)){const _0x490ce8=await staff['findOne']({'email':_0x34d330[_0x410b59(0x1cc)]});_0x46a4cb=await warehouse[_0x410b59(0x124)]({'status':_0x410b59(0x1c5),'name':_0x490ce8[_0x410b59(0x16b)],'warehouse_category':_0x410b59(0x199)});}else _0x46a4cb=await warehouse[_0x410b59(0x124)]({'status':'Enabled','warehouse_category':_0x410b59(0x199)});const _0x2286ad=await warehouse[_0x410b59(0x18d)]([{'$match':{'name':_0x30fc69[_0x410b59(0x19a)],'room':_0x30fc69[_0x410b59(0x14d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x410b59(0x1ae),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x410b59(0x15d)},'bay':{'$first':_0x410b59(0x14c)},'bin':{'$first':_0x410b59(0x1d5)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x410b59(0x13e)},'primary_code':{'$first':_0x410b59(0x1ca)},'secondary_code':{'$first':_0x410b59(0x1a4)},'product_code':{'$first':_0x410b59(0x165)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x410b59(0x175)}}}]);var _0x5aedbc=[0x1,0x2,0x3,0x4],_0x5e4923=['A','B','C','D','E','F','G','H','I','J'],_0x44ed84=[_0x410b59(0x12a),_0x410b59(0x161)];const _0xeadef=await product[_0x410b59(0x124)]({}),_0x221b94=BayBinSelected(_0x30fc69[_0x410b59(0x19c)],_0x30fc69['to_room']);if(_0x5cb1cc[0x0]['language']==_0x410b59(0x1ce)){var _0x5b062b=users[_0x410b59(0x198)];console[_0x410b59(0x127)](_0x5b062b);}else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]==_0x410b59(0x19f))var _0x5b062b=users[_0x410b59(0x19f)];else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]==_0x410b59(0x1cd))var _0x5b062b=users[_0x410b59(0x1cd)];else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]=='Spanish')var _0x5b062b=users['Spanish'];else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]==_0x410b59(0x1be))var _0x5b062b=users[_0x410b59(0x1be)];else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]==_0x410b59(0x10a))var _0x5b062b=users[_0x410b59(0x194)];else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]==_0x410b59(0x166))var _0x5b062b=users['Chinese'];else{if(_0x5cb1cc[0x0][_0x410b59(0x148)]==_0x410b59(0x153))var _0x5b062b=users['Arabic'];}}}}}}}_0x31e502['render'](_0x410b59(0x1a7),{'success':_0x536276['flash'](_0x410b59(0x144)),'errors':_0x536276[_0x410b59(0x15a)](_0x410b59(0x137)),'role':_0x34d330,'profile':_0x148465,'master_shop':_0x5cb1cc,'warehouse':_0x46a4cb,'transfer':_0x30fc69,'stock':_0x2286ad,'unit':_0xeadef,'language':_0x5b062b,'levels':_0x5aedbc,'Isle':_0x5e4923,'rooms_data':_0x44ed84,'ed_fullDate':_0x3fbb89,'dataSelected':_0x221b94});}catch(_0x10a5d2){console[_0x410b59(0x127)](_0x10a5d2);}}),router[a0_0x3175b8(0x19b)](a0_0x3175b8(0x1d9),auth,async(_0x5c3f7b,_0x3e92fa)=>{var _0x393068=a0_0x3175b8;try{const _0x596a28=_0x5c3f7b[_0x393068(0x1bb)]['id'];console[_0x393068(0x127)](_0x5c3f7b[_0x393068(0x1a8)]);const _0x5b8f78=await transfers_finished['findById'](_0x596a28);console[_0x393068(0x127)]('transfer_data',_0x5b8f78);const {date:_0x26bd61,from_warehouse:_0x2a20d5,FromRoom_name:_0x47215c,to_warehouse:_0x80b30,ToRoom_name:_0x44d992,prod_name:_0x4d139c,from_prod_qty:_0x3c53d8,from_prod_level:_0x282396,from_prod_isle:_0x2131bf,from_prod_pallet:_0x4d199c,to_prod_qty:_0x87d7b6,to_prod_level:_0x44b1e4,to_prod_isle:_0x54b063,to_prod_pallet:_0x296d40,primary_code:_0x1a1444,secondary_code:_0x5dff8e,product_code3:_0x188ab8,note:_0x4917b0,invoice:_0x36128d,expiry_date:_0x90fc05}=_0x5c3f7b['body'];if(typeof _0x4d139c==_0x393068(0x12b))var _0x418c64=[_0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x16d)]],_0x848341=[_0x5c3f7b[_0x393068(0x1a8)]['from_prod_qty']],_0x42e618=[_0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x18c)]],_0x193083=[_0x5c3f7b[_0x393068(0x1a8)]['to_prod_qty']],_0x23ba52=[_0x5c3f7b['body'][_0x393068(0x1b8)]],_0x4d9eae=[_0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x1a5)]],_0xdc37b7=[_0x5c3f7b['body'][_0x393068(0x167)]],_0x1552ae=[_0x5c3f7b[_0x393068(0x1a8)]['product_code3']],_0x213592=[_0x5c3f7b['body'][_0x393068(0x1a0)]],_0x104e9a=[_0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x1a3)]],_0x4d60ac=[_0x5c3f7b['body'][_0x393068(0x185)]],_0x319e50=[_0x5c3f7b['body'][_0x393068(0x11f)]],_0x1fea79=[_0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x14e)]];else var _0x418c64=[..._0x5c3f7b['body'][_0x393068(0x16d)]],_0x848341=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x174)]],_0x42e618=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x18c)]],_0x193083=[..._0x5c3f7b['body']['to_prod_qty']],_0x23ba52=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x1b8)]],_0x4d9eae=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x1a5)]],_0xdc37b7=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x167)]],_0x1552ae=[..._0x5c3f7b[_0x393068(0x1a8)]['product_code3']],_0x213592=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x1a0)]],_0x104e9a=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x1a3)]],_0x4d60ac=[..._0x5c3f7b['body'][_0x393068(0x185)]],_0x319e50=[..._0x5c3f7b[_0x393068(0x1a8)][_0x393068(0x11f)]],_0x1fea79=[..._0x5c3f7b['body'][_0x393068(0x14e)]];const _0x53993a=_0x418c64[_0x393068(0x17e)](_0x5a3d82=>{return _0x5a3d82={'product_name':_0x5a3d82};});_0x848341[_0x393068(0x173)]((_0x259be4,_0x167f5e)=>{var _0x3a810b=_0x393068;_0x53993a[_0x167f5e][_0x3a810b(0x1bd)]=_0x259be4;}),_0x42e618['forEach']((_0x50b723,_0x48825e)=>{var _0x1456e0=_0x393068;_0x53993a[_0x48825e][_0x1456e0(0x1c0)]=_0x50b723;}),_0x193083[_0x393068(0x173)]((_0xa24053,_0x2ee000)=>{var _0x402699=_0x393068;_0x53993a[_0x2ee000][_0x402699(0x125)]=_0xa24053;}),_0x23ba52[_0x393068(0x173)]((_0x455002,_0x246fd7)=>{var _0x500533=_0x393068;_0x53993a[_0x246fd7][_0x500533(0x1da)]=_0x455002;}),_0x4d9eae['forEach']((_0x10bcba,_0x5d52f7)=>{_0x53993a[_0x5d52f7]['primary_code']=_0x10bcba;}),_0xdc37b7[_0x393068(0x173)]((_0x29fbcb,_0x3c1704)=>{var _0x160fc8=_0x393068;_0x53993a[_0x3c1704][_0x160fc8(0x167)]=_0x29fbcb;}),_0x1552ae['forEach']((_0x138f6f,_0x44680d)=>{_0x53993a[_0x44680d]['product_code']=_0x138f6f;}),_0x213592['forEach']((_0x203062,_0x17f705)=>{var _0x5674ba=_0x393068;_0x53993a[_0x17f705][_0x5674ba(0x133)]=_0x203062;}),_0x104e9a[_0x393068(0x173)]((_0x157698,_0x21b1e3)=>{_0x53993a[_0x21b1e3]['unit']=_0x157698;}),_0x4d60ac[_0x393068(0x173)]((_0x38945a,_0x3a3735)=>{var _0x45bdf2=_0x393068;_0x53993a[_0x3a3735][_0x45bdf2(0x185)]=_0x38945a;}),_0x319e50[_0x393068(0x173)]((_0x312074,_0x106259)=>{var _0x11ce1c=_0x393068;_0x53993a[_0x106259][_0x11ce1c(0x11f)]=_0x312074;}),_0x1fea79[_0x393068(0x173)]((_0xd76fbe,_0x536dc3)=>{_0x53993a[_0x536dc3]['expiry_date']=_0xd76fbe;});const _0x350291=_0x53993a[_0x393068(0x114)](_0x420cb9=>_0x420cb9[_0x393068(0x125)]!=='0'&&_0x420cb9[_0x393068(0x125)]!==''||_0x420cb9[_0x393068(0x13d)]!=='0'&&_0x420cb9[_0x393068(0x13d)]!=='');var _0x182b51=0x0;_0x350291[_0x393068(0x173)](_0x17086b=>{var _0xc95104=_0x393068;parseInt(_0x17086b[_0xc95104(0x1bd)])<parseInt(_0x17086b['to_quantity'])&&_0x182b51++;});if(_0x182b51!=0x0)return _0x5c3f7b['flash']('errors',_0x393068(0x11d)),_0x3e92fa[_0x393068(0x19d)]('back');const _0x3d95d2=await warehouse[_0x393068(0x11e)]({'name':_0x5b8f78[_0x393068(0x19a)],'room':_0x5b8f78[_0x393068(0x14d)]});_0x5b8f78[_0x393068(0x182)]['forEach'](_0x29cdf=>{var _0x1ff395=_0x393068;if(_0x29cdf[_0x1ff395(0x125)]>0x0){const _0x36e1b0=_0x3d95d2[_0x1ff395(0x131)][_0x1ff395(0x17e)](_0x4e3c9f=>{var _0x5f4327=_0x1ff395;_0x4e3c9f[_0x5f4327(0x188)]==_0x29cdf[_0x5f4327(0x188)]&&_0x4e3c9f['bay']==_0x29cdf[_0x5f4327(0x1c0)]&&(_0x4e3c9f['product_stock']=parseInt(_0x4e3c9f[_0x5f4327(0x17a)])+parseInt(_0x29cdf['to_quantity']));});}}),await _0x3d95d2['save']();const _0x265451=await warehouse['findOne']({'name':_0x5b8f78[_0x393068(0x19c)],'room':_0x5b8f78[_0x393068(0x1dd)]});_0x5b8f78[_0x393068(0x182)][_0x393068(0x173)](_0x41d8e2=>{var _0x1497a0=_0x393068;if(_0x41d8e2[_0x1497a0(0x125)]>0x0){const _0xec1bf2=_0x265451['product_details']['map'](_0x177711=>{var _0x54309c=_0x1497a0;_0x177711[_0x54309c(0x188)]==_0x41d8e2[_0x54309c(0x188)]&&_0x177711[_0x54309c(0x122)]==_0x41d8e2[_0x54309c(0x1da)]&&(_0x177711['product_stock']=parseInt(_0x177711[_0x54309c(0x17a)])-parseInt(_0x41d8e2[_0x54309c(0x125)]));});}}),await _0x265451[_0x393068(0x1bf)](),_0x5b8f78[_0x393068(0x159)]=_0x26bd61,_0x5b8f78[_0x393068(0x19a)]=_0x2a20d5,_0x5b8f78[_0x393068(0x19c)]=_0x80b30,_0x5b8f78['product']=_0x350291,_0x5b8f78[_0x393068(0x156)]=_0x4917b0,_0x5b8f78['invoice']=_0x36128d;const _0xeee85e=await _0x5b8f78[_0x393068(0x1bf)](),_0xc122d6=await warehouse[_0x393068(0x11e)]({'name':_0x2a20d5,'room':_0x47215c});_0xeee85e[_0x393068(0x182)][_0x393068(0x173)](_0x4966a8=>{var _0x22a1c1=_0x393068;if(_0x4966a8[_0x22a1c1(0x125)]>0x0){const _0x334f33=_0xc122d6[_0x22a1c1(0x131)][_0x22a1c1(0x17e)](_0x52e8a9=>{var _0x4fadc8=_0x22a1c1;_0x52e8a9[_0x4fadc8(0x188)]==_0x4966a8[_0x4fadc8(0x188)]&&_0x52e8a9[_0x4fadc8(0x122)]==_0x4966a8['from_bay']&&(_0x52e8a9[_0x4fadc8(0x17a)]=parseInt(_0x52e8a9[_0x4fadc8(0x17a)])-parseInt(_0x4966a8[_0x4fadc8(0x125)]));});}}),await _0xc122d6[_0x393068(0x1bf)]();const _0x1ce283=await warehouse[_0x393068(0x11e)]({'name':_0x80b30,'room':_0x44d992});_0xeee85e[_0x393068(0x182)][_0x393068(0x173)](_0x4816d4=>{var _0x1d2533=_0x393068;if(_0x4816d4[_0x1d2533(0x125)]>0x0){var _0x15a19a=0x0;const _0x272bf8=_0x1ce283[_0x1d2533(0x131)][_0x1d2533(0x17e)](_0x24c6e7=>{var _0xe16d2b=_0x1d2533;_0x24c6e7['product_name']==_0x4816d4[_0xe16d2b(0x188)]&&_0x24c6e7[_0xe16d2b(0x122)]==_0x4816d4[_0xe16d2b(0x1da)]&&(_0x24c6e7[_0xe16d2b(0x17a)]=parseInt(_0x24c6e7[_0xe16d2b(0x17a)])+parseInt(_0x4816d4['to_quantity']),_0x15a19a++);});_0x15a19a=='0'&&(_0x1ce283[_0x1d2533(0x131)]=_0x1ce283[_0x1d2533(0x131)][_0x1d2533(0x1c1)]({'product_name':_0x4816d4[_0x1d2533(0x188)],'product_stock':_0x4816d4[_0x1d2533(0x125)],'bay':_0x4816d4[_0x1d2533(0x1da)],'product_code':_0x4816d4[_0x1d2533(0x177)],'primary_code':_0x4816d4['primary_code'],'secondary_code':_0x4816d4[_0x1d2533(0x167)],'maxProducts':_0x4816d4[_0x1d2533(0x133)]}));}}),await _0x1ce283[_0x393068(0x1bf)](),_0x5c3f7b[_0x393068(0x15a)](_0x393068(0x144),_0x393068(0x163)),_0x3e92fa['redirect'](_0x393068(0x12e));}catch(_0x1a96c3){console[_0x393068(0x127)](_0x1a96c3);}}),router['post'](a0_0x3175b8(0x155),async(_0x28a5eb,_0x45f644)=>{var _0x4111d8=a0_0x3175b8;const {FromWareHouse:_0x57d2ec,FromRoom:_0x5b9ed9,ToWarehouse:_0x56ceac,ToRoom:_0x24e545,primary_code:_0x26c9a9,Roomslist:_0x42bf1c}=_0x28a5eb[_0x4111d8(0x1a8)],_0x2bed11=_0x42bf1c[_0x4111d8(0x1d4)](','),_0x352962=[];async function _0x23d219(_0x53dacd){var _0x3b4b11=_0x4111d8;const _0x369eb6=await warehouse['aggregate']([{'$match':{'name':_0x57d2ec,'room':_0x53dacd}},{'$unwind':_0x3b4b11(0x1ac)},{'$match':{'product_details.primary_code':_0x26c9a9}},{'$group':{'_id':_0x3b4b11(0x1ae),'name':{'$first':'$product_details.product_name'},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3b4b11(0x1ca)},'secondary_code':{'$first':_0x3b4b11(0x1a4)},'product_code':{'$first':_0x3b4b11(0x165)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x3b4b11(0x1d5)},'type':{'$first':_0x3b4b11(0x1b4)},'pallet':{'$first':_0x3b4b11(0x13e)},'unit':{'$first':_0x3b4b11(0x126)},'secondary_unit':{'$first':_0x3b4b11(0x150)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3b4b11(0x175)},'expiry_date':{'$first':_0x3b4b11(0x11b)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x3b4b11(0x151)},'roomNamed':{'$first':_0x3b4b11(0x14f)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x3b4b11(0x13c)}}}]),_0x4d395b=await warehouse[_0x3b4b11(0x18d)]([{'$match':{'name':_0x57d2ec,'room':_0x53dacd}},{'$unwind':_0x3b4b11(0x1ac)},{'$match':{'product_details.secondary_code':_0x26c9a9}},{'$group':{'_id':_0x3b4b11(0x1ae),'name':{'$first':_0x3b4b11(0x15c)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3b4b11(0x1a4)},'product_code':{'$first':_0x3b4b11(0x165)},'level':{'$first':_0x3b4b11(0x14c)},'isle':{'$first':_0x3b4b11(0x1d5)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3b4b11(0x13e)},'unit':{'$first':_0x3b4b11(0x126)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3b4b11(0x172)},'rack':{'$first':_0x3b4b11(0x175)},'expiry_date':{'$first':_0x3b4b11(0x11b)},'production_date':{'$first':_0x3b4b11(0x160)},'batch_code':{'$first':_0x3b4b11(0x1d6)},'maxPerUnit':{'$first':_0x3b4b11(0x151)},'roomNamed':{'$first':_0x3b4b11(0x14f)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x3b4b11(0x13c)}}}]);if(_0x369eb6[_0x3b4b11(0x16f)]>0x0)_0x352962[_0x3b4b11(0x149)](_0x369eb6);else _0x4d395b['length']>0x0&&_0x352962[_0x3b4b11(0x149)](_0x4d395b);}const _0x3b4270=_0x2bed11['map'](_0x4e1131=>_0x23d219(_0x4e1131));await Promise[_0x4111d8(0x135)](_0x3b4270),_0x45f644['json'](_0x352962);}),router[a0_0x3175b8(0x19b)](a0_0x3175b8(0x1dc),async(_0x2bb838,_0x2b7ba6)=>{var _0x1c363=a0_0x3175b8;try{const {FromWareHouse:_0x663f15,FromRoom:_0x43c50c,ToWarehouse:_0x2e463f,ToRoom:_0x1d44d3,secondary_code:_0x24b9d4}=_0x2bb838[_0x1c363(0x1a8)],_0xefc91=await warehouse[_0x1c363(0x18d)]([{'$match':{'name':_0x663f15}},{'$unwind':_0x1c363(0x1ac)},{'$match':{'product_details.secondary_code':_0x24b9d4}},{'$group':{'_id':_0x1c363(0x1ae),'name':{'$first':_0x1c363(0x15c)},'primary_code':{'$first':_0x1c363(0x1ca)},'secondary_code':{'$first':_0x1c363(0x1a4)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x1c363(0x15d)},'warehouse':{'$first':_0x1c363(0x129)},'level':{'$first':_0x1c363(0x1af)},'isle':{'$first':_0x1c363(0x1cf)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x1c363(0x1c4)},'unit':{'$first':_0x1c363(0x126)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1c363(0x160)}}}]);_0x2b7ba6['status'](0xc8)[_0x1c363(0x111)](_0xefc91);}catch(_0x334ee9){_0x2b7ba6[_0x1c363(0x187)](0x194)['json']({'message':_0x334ee9[_0x1c363(0x195)]});}}),router[a0_0x3175b8(0x19b)](a0_0x3175b8(0x162),async(_0x1f5a8a,_0x5c1955)=>{var _0x550436=a0_0x3175b8;try{const {FromWareHouse:_0x575f4e,FromRoom:_0x555065,ToWarehouse:_0x456a6a,ToRoom:_0x3a5176,product_code:_0x348877}=_0x1f5a8a[_0x550436(0x1a8)],_0x5eed14=await warehouse[_0x550436(0x18d)]([{'$match':{'name':_0x575f4e}},{'$unwind':_0x550436(0x1ac)},{'$match':{'product_details.product_code':_0x348877}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x550436(0x1ca)},'secondary_code':{'$first':_0x550436(0x1a4)},'product_code':{'$first':_0x550436(0x165)},'instock':{'$first':_0x550436(0x15d)},'warehouse':{'$first':_0x550436(0x129)},'level':{'$first':_0x550436(0x1af)},'isle':{'$first':_0x550436(0x1cf)},'pallet':{'$first':_0x550436(0x18e)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x550436(0x126)}}}]);_0x5c1955['status'](0xc8)['json'](_0x5eed14);}catch(_0xf025b9){_0x5c1955['status'](0x194)[_0x550436(0x111)]({'message':_0xf025b9[_0x550436(0x195)]});}}),router[a0_0x3175b8(0x19b)]('/CheckingWarehouse',async(_0x29cf19,_0x502991)=>{var _0xa6284a=a0_0x3175b8;const {productCode:_0x1688ed,bay:_0x4983ce,warehouses:_0xb60cd6,room:_0x4ddf4d}=_0x29cf19['body'];console['log'](_0x29cf19[_0xa6284a(0x1a8)]);try{const _0x2ca1e5=await warehouse['aggregate']([{'$match':{'name':_0xb60cd6,'room':_0x4ddf4d}},{'$unwind':_0xa6284a(0x1ac)},{'$match':{'product_details.bay':parseInt(_0x4983ce)}},{'$group':{'_id':_0xa6284a(0x1ae),'name':{'$first':_0xa6284a(0x15c)},'product_stock':{'$first':_0xa6284a(0x15d)},'bay':{'$first':_0xa6284a(0x14c)},'maxProducts':{'$first':_0xa6284a(0x1c4)}}}]);_0x502991['status'](0xc8)[_0xa6284a(0x111)](_0x2ca1e5);}catch(_0x41cab4){_0x502991[_0xa6284a(0x187)](0x194)[_0xa6284a(0x111)]({'message':_0x41cab4['message']});}}),module[a0_0x3175b8(0x184)]=router;