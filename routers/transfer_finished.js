var a0_0x3e3a92=a0_0x50ef;(function(_0x15ee5e,_0x4bd7c2){var _0x137f44=a0_0x50ef,_0x4d3251=_0x15ee5e();while(!![]){try{var _0x37111e=-parseInt(_0x137f44(0x17c))/0x1+-parseInt(_0x137f44(0x166))/0x2+parseInt(_0x137f44(0x15a))/0x3+-parseInt(_0x137f44(0xfa))/0x4+parseInt(_0x137f44(0x172))/0x5+parseInt(_0x137f44(0x145))/0x6+parseInt(_0x137f44(0x173))/0x7*(-parseInt(_0x137f44(0xe1))/0x8);if(_0x37111e===_0x4bd7c2)break;else _0x4d3251['push'](_0x4d3251['shift']());}catch(_0x10ce19){_0x4d3251['push'](_0x4d3251['shift']());}}}(a0_0x3b93,0x50b86));const express=require(a0_0x3e3a92(0x179)),app=express(),router=express[a0_0x3e3a92(0x128)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x3e3a92(0x182)),auth=require('../middleware/auth'),users=require(a0_0x3e3a92(0x12a)),nodemailer=require(a0_0x3e3a92(0xec));router[a0_0x3e3a92(0x110)]('/view',auth,async(_0x5a22c9,_0x55e731)=>{var _0x50e023=a0_0x3e3a92;try{const {username:_0x1c48b7,email:_0x415009,role:_0x5c44fe}=_0x5a22c9['user'],_0x120295=_0x5a22c9[_0x50e023(0x146)],_0x46d873=await profile['findOne']({'email':_0x120295[_0x50e023(0x10a)]}),_0x32cb87=await master_shop[_0x50e023(0xfb)]();let _0x17efeb;if(_0x120295[_0x50e023(0x16b)]=='staff'){const _0x4914bf=await staff[_0x50e023(0x16c)]({'email':_0x120295['email']});_0x17efeb=await transfers_finished[_0x50e023(0xfb)]({'from_warehouse':_0x4914bf[_0x50e023(0x161)]});}else _0x17efeb=await transfers_finished['aggregate']([{'$unwind':_0x50e023(0xfd)},{'$group':{'_id':_0x50e023(0x17e),'invoice':{'$first':_0x50e023(0x195)},'date':{'$first':_0x50e023(0xe4)},'from_warehouse':{'$first':_0x50e023(0xed)},'to_warehouse':{'$first':_0x50e023(0x132)},'from_room_name':{'$addToSet':_0x50e023(0x160)},'to_room_name':{'$addToSet':_0x50e023(0x16a)},'finalize':{'$first':_0x50e023(0x10d)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x32cb87[0x0][_0x50e023(0x133)]==_0x50e023(0x19e))var _0x580deb=users[_0x50e023(0xc4)];else{if(_0x32cb87[0x0][_0x50e023(0x133)]=='Hindi')var _0x580deb=users[_0x50e023(0x150)];else{if(_0x32cb87[0x0][_0x50e023(0x133)]==_0x50e023(0x141))var _0x580deb=users[_0x50e023(0x141)];else{if(_0x32cb87[0x0][_0x50e023(0x133)]==_0x50e023(0x123))var _0x580deb=users[_0x50e023(0x123)];else{if(_0x32cb87[0x0]['language']=='French')var _0x580deb=users[_0x50e023(0xc7)];else{if(_0x32cb87[0x0]['language']==_0x50e023(0x13a))var _0x580deb=users[_0x50e023(0xdd)];else{if(_0x32cb87[0x0]['language']==_0x50e023(0x1a0))var _0x580deb=users[_0x50e023(0x1a0)];else{if(_0x32cb87[0x0][_0x50e023(0x133)]=='Arabic\x20(ae)')var _0x580deb=users['Arabic'];}}}}}}}_0x55e731['render']('transfer_finished',{'success':_0x5a22c9[_0x50e023(0xda)](_0x50e023(0x19b)),'errors':_0x5a22c9[_0x50e023(0xda)](_0x50e023(0x153)),'role':_0x120295,'profile':_0x46d873,'master_shop':_0x32cb87,'transfer':_0x17efeb,'language':_0x580deb});}catch(_0xd33505){console[_0x50e023(0x11a)](_0xd33505);}});function a0_0x50ef(_0x5172f9,_0x36a5ce){var _0x3b93b9=a0_0x3b93();return a0_0x50ef=function(_0x50eff0,_0x54f9f4){_0x50eff0=_0x50eff0-0xc4;var _0x25e6dd=_0x3b93b9[_0x50eff0];return _0x25e6dd;},a0_0x50ef(_0x5172f9,_0x36a5ce);}async function getRandom8DigitNumber(){var _0x2006df=a0_0x3e3a92;const _0x3f22c5=0x989680,_0x4c57f5=0x5f5e0ff,_0x1e463f=Math[_0x2006df(0x120)](Math[_0x2006df(0xea)]()*(_0x4c57f5-_0x3f22c5+0x1))+_0x3f22c5;var _0x58ca47;const _0x32db14=await transfers_finished[_0x2006df(0x16c)]({'invoice':_0x2006df(0xf3)+_0x1e463f});return _0x32db14&&_0x32db14[_0x2006df(0x14f)]>0x0?_0x58ca47=_0x2006df(0xf3)+_0x1e463f:_0x58ca47='TRFF-'+_0x1e463f,_0x58ca47;}router[a0_0x3e3a92(0x110)](a0_0x3e3a92(0x14b),auth,async(_0xe03bef,_0x1704d5)=>{var _0x5e0e9d=a0_0x3e3a92;try{const {username:_0x2ddcce,email:_0x1eb597,role:_0x48cefd}=_0xe03bef['user'],_0x5d1aad=_0xe03bef[_0x5e0e9d(0x146)],_0xc5e3b5=await profile['findOne']({'email':_0x5d1aad['email']}),_0x2755ed=await master_shop[_0x5e0e9d(0xfb)]();let _0xd69f7e;if(_0x5d1aad[_0x5e0e9d(0x16b)]=='staff'){const _0x4939b5=await staff[_0x5e0e9d(0x16c)]({'email':_0x5d1aad[_0x5e0e9d(0x10a)]});_0xd69f7e=await warehouse[_0x5e0e9d(0x127)]([{'$match':{'status':_0x5e0e9d(0x14d),'name':_0x4939b5[_0x5e0e9d(0x161)],'warehouse_category':_0x5e0e9d(0x152),'name':{'$ne':_0x5e0e9d(0xf4)}}},{'$group':{'_id':_0x5e0e9d(0x10f),'name':{'$first':_0x5e0e9d(0x10f)}}}]);}else _0xd69f7e=await warehouse[_0x5e0e9d(0x127)]([{'$match':{'status':'Enabled','warehouse_category':_0x5e0e9d(0x152),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x517d9c=await transfers_finished[_0x5e0e9d(0xfb)]({}),_0x552167=_0x517d9c[_0x5e0e9d(0x14f)]+0x1,_0x1fd93b=_0x5e0e9d(0xf3)+_0x552167[_0x5e0e9d(0x144)]()[_0x5e0e9d(0x136)](0x5,'0');if(_0x2755ed[0x0][_0x5e0e9d(0x133)]=='English\x20(US)')var _0x5bd107=users[_0x5e0e9d(0xc4)];else{if(_0x2755ed[0x0][_0x5e0e9d(0x133)]=='Hindi')var _0x5bd107=users[_0x5e0e9d(0x150)];else{if(_0x2755ed[0x0][_0x5e0e9d(0x133)]==_0x5e0e9d(0x141))var _0x5bd107=users['German'];else{if(_0x2755ed[0x0]['language']=='Spanish')var _0x5bd107=users[_0x5e0e9d(0x123)];else{if(_0x2755ed[0x0][_0x5e0e9d(0x133)]=='French')var _0x5bd107=users[_0x5e0e9d(0xc7)];else{if(_0x2755ed[0x0][_0x5e0e9d(0x133)]=='Portuguese\x20(BR)')var _0x5bd107=users[_0x5e0e9d(0xdd)];else{if(_0x2755ed[0x0][_0x5e0e9d(0x133)]==_0x5e0e9d(0x1a0))var _0x5bd107=users[_0x5e0e9d(0x1a0)];else{if(_0x2755ed[0x0][_0x5e0e9d(0x133)]=='Arabic\x20(ae)')var _0x5bd107=users['Arabic'];}}}}}}}const _0x72add1=getRandom8DigitNumber();_0x72add1[_0x5e0e9d(0x105)](_0x8b52cd=>{var _0x4c1adc=_0x5e0e9d;_0x1704d5[_0x4c1adc(0x163)](_0x4c1adc(0x101),{'success':_0xe03bef['flash'](_0x4c1adc(0x19b)),'errors':_0xe03bef[_0x4c1adc(0xda)](_0x4c1adc(0x153)),'role':_0x5d1aad,'profile':_0xc5e3b5,'master_shop':_0x2755ed,'warehouse':_0xd69f7e,'language':_0x5bd107,'invoice':_0x8b52cd});})[_0x5e0e9d(0x13d)](_0xebef76=>{var _0x2cdbbf=_0x5e0e9d;_0xe03bef[_0x2cdbbf(0xda)]('errors',_0x2cdbbf(0x158)),_0x1704d5['redirect'](_0x2cdbbf(0x164));});}catch(_0x371732){console[_0x5e0e9d(0x11a)](_0x371732);}}),router[a0_0x3e3a92(0xe7)](a0_0x3e3a92(0x14b),auth,async(_0x5a677f,_0x307dce)=>{var _0x3e1664=a0_0x3e3a92;try{const {date:_0x22bb78,from_warehouse:_0x304df5,FromRoom_name:_0x495e4c,to_warehouse:_0x278e6a,ToRoom_name:_0xce2cc3,prod_name:_0x3eb4ac,from_prod_qty:_0x31eb43,from_prod_level:_0x3a85b8,from_prod_isle:_0x406c4b,from_prod_pallet:_0x488d1c,to_prod_qty:_0x16770d,to_prod_level:_0x5a0e5c,to_prod_isle:_0x235f57,to_prod_pallet:_0x1a8e30,primary_code:_0x4b3534,secondary_code:_0x2e5d1c,product_code3:_0x75fbda,note:_0x56e97f,MaxStocks_data2:_0x429c98,invoice:_0x21ba41,expiry_date:_0x5b2dea}=_0x5a677f[_0x3e1664(0xcf)];if(typeof _0x3eb4ac=='string')var _0x38af28=[_0x5a677f['body'][_0x3e1664(0x1a6)]],_0x57bf1a=[_0x5a677f['body']['from_prod_qty']],_0x48580a=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xca)]],_0x2821b7=[_0x5a677f['body'][_0x3e1664(0x130)]],_0xb209a8=[_0x5a677f[_0x3e1664(0xcf)]['to_prod_level']],_0x4d4437=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x151)]],_0x16c6f4=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x11d)]],_0x4f672e=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xdc)]],_0x9c1a07=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x109)]],_0x2a9eef=[_0x5a677f[_0x3e1664(0xcf)]['primary_unit']],_0x2b8268=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x18e)]],_0x4ac99b=[_0x5a677f[_0x3e1664(0xcf)]['batch_code']],_0x38d561=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x156)]],_0x2ca8d2=[_0x5a677f['body'][_0x3e1664(0xfe)]],_0x6d8fc2=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xd1)]],_0x299aeb=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x124)]],_0x4a18a1=[_0x5a677f['body']['prod_cat']],_0x1114a=[_0x5a677f[_0x3e1664(0xcf)]['RoomAssigned']],_0x6156d2=[_0x5a677f['body'][_0x3e1664(0x134)]],_0x4190d6=[_0x5a677f['body']['from_invoice']],_0x5d1831=[_0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xce)]],_0x270e05=[_0x5a677f[_0x3e1664(0xcf)]['id_transaction']];else var _0x38af28=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x1a6)]],_0x57bf1a=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x10e)]],_0x48580a=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xca)]],_0x2821b7=[..._0x5a677f['body'][_0x3e1664(0x130)]],_0xb209a8=[..._0x5a677f[_0x3e1664(0xcf)]['to_prod_level']],_0x4d4437=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x151)]],_0x16c6f4=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x11d)]],_0x4f672e=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xdc)]],_0x9c1a07=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x109)]],_0x2a9eef=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xe8)]],_0x2b8268=[..._0x5a677f['body']['secondary_unit']],_0x4ac99b=[..._0x5a677f['body'][_0x3e1664(0x170)]],_0x38d561=[..._0x5a677f[_0x3e1664(0xcf)]['expiry_date']],_0x2ca8d2=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xfe)]],_0x6d8fc2=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xd1)]],_0x299aeb=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x124)]],_0x4a18a1=[..._0x5a677f[_0x3e1664(0xcf)]['prod_cat']],_0x1114a=[..._0x5a677f[_0x3e1664(0xcf)]['RoomAssigned']],_0x6156d2=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x134)]],_0x4190d6=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0x19d)]],_0x5d1831=[..._0x5a677f[_0x3e1664(0xcf)][_0x3e1664(0xce)]],_0x270e05=[..._0x5a677f['body'][_0x3e1664(0x135)]];const _0x4d7106=_0x38af28[_0x3e1664(0x15d)](_0x577c58=>{return _0x577c58={'product_name':_0x577c58};});_0x57bf1a['forEach']((_0x88d132,_0x581d6d)=>{var _0x52f6d5=_0x3e1664;_0x4d7106[_0x581d6d][_0x52f6d5(0x169)]=_0x88d132;}),_0x48580a['forEach']((_0x4ee040,_0x3c1d3b)=>{var _0x1b8d2d=_0x3e1664;_0x4d7106[_0x3c1d3b][_0x1b8d2d(0x193)]=_0x4ee040;}),_0x270e05[_0x3e1664(0xdb)]((_0x4dacd4,_0x444831)=>{_0x4d7106[_0x444831]['id_transaction']=_0x4dacd4;}),_0x4190d6['forEach']((_0x2bfd5d,_0x5e3327)=>{var _0x3af095=_0x3e1664;_0x4d7106[_0x5e3327][_0x3af095(0x19d)]=_0x2bfd5d;}),_0x5d1831[_0x3e1664(0xdb)]((_0x4bfb87,_0x1103ad)=>{var _0x7f3659=_0x3e1664;_0x4d7106[_0x1103ad][_0x7f3659(0x140)]=_0x4bfb87;}),_0x2821b7[_0x3e1664(0xdb)]((_0x5a82f8,_0x59f2cf)=>{var _0x5e2a21=_0x3e1664;_0x4d7106[_0x59f2cf][_0x5e2a21(0x178)]=_0x5a82f8;}),_0xb209a8[_0x3e1664(0xdb)]((_0x48fe62,_0x3b48c6)=>{var _0xb25f9a=_0x3e1664;_0x4d7106[_0x3b48c6][_0xb25f9a(0x15f)]=_0x48fe62;}),_0x4d4437[_0x3e1664(0xdb)]((_0x47b53d,_0x1abf9a)=>{var _0x51a0ea=_0x3e1664;_0x4d7106[_0x1abf9a][_0x51a0ea(0x151)]=_0x47b53d;}),_0x16c6f4[_0x3e1664(0xdb)]((_0x325afd,_0x1b9f56)=>{var _0x27f20a=_0x3e1664;_0x4d7106[_0x1b9f56][_0x27f20a(0x11d)]=_0x325afd;}),_0x4f672e[_0x3e1664(0xdb)]((_0x3dcde2,_0x26f832)=>{var _0x2ebc14=_0x3e1664;_0x4d7106[_0x26f832][_0x2ebc14(0x126)]=_0x3dcde2;}),_0x9c1a07[_0x3e1664(0xdb)]((_0x3db279,_0x517d7f)=>{var _0x206e3a=_0x3e1664;_0x4d7106[_0x517d7f][_0x206e3a(0x189)]=_0x3db279;}),_0x2a9eef[_0x3e1664(0xdb)]((_0x3848bf,_0x3ee3bf)=>{var _0xe47d7e=_0x3e1664;_0x4d7106[_0x3ee3bf][_0xe47d7e(0x143)]=_0x3848bf;}),_0x2b8268['forEach']((_0x15435f,_0x4b1ec1)=>{var _0x3231ec=_0x3e1664;_0x4d7106[_0x4b1ec1][_0x3231ec(0x18e)]=_0x15435f;}),_0x4ac99b[_0x3e1664(0xdb)]((_0xa85680,_0x1ae42f)=>{_0x4d7106[_0x1ae42f]['batch_code']=_0xa85680;}),_0x38d561['forEach']((_0x37d124,_0x386e93)=>{var _0x383c03=_0x3e1664;_0x4d7106[_0x386e93][_0x383c03(0x156)]=_0x37d124;}),_0x2ca8d2[_0x3e1664(0xdb)]((_0x542d82,_0x15f6bc)=>{_0x4d7106[_0x15f6bc]['production_date']=_0x542d82;}),_0x6d8fc2[_0x3e1664(0xdb)]((_0x1f9d4e,_0xffdf87)=>{_0x4d7106[_0xffdf87]['maxProducts']=_0x1f9d4e;}),_0x299aeb[_0x3e1664(0xdb)]((_0x310a54,_0x31f0df)=>{var _0xdeda0e=_0x3e1664;_0x4d7106[_0x31f0df][_0xdeda0e(0x124)]=_0x310a54;}),_0x4a18a1[_0x3e1664(0xdb)]((_0x5481cf,_0x142d8d)=>{var _0x41d9cd=_0x3e1664;_0x4d7106[_0x142d8d][_0x41d9cd(0x176)]=_0x5481cf;}),_0x1114a[_0x3e1664(0xdb)]((_0x2933f4,_0x51c584)=>{var _0x1c3064=_0x3e1664;_0x4d7106[_0x51c584][_0x1c3064(0xc5)]=_0x2933f4;}),_0x6156d2[_0x3e1664(0xdb)]((_0x491dde,_0x3fb745)=>{var _0x33f222=_0x3e1664;_0x4d7106[_0x3fb745][_0x33f222(0x13c)]=_0x491dde;});const _0x1e24c1=_0x4d7106[_0x3e1664(0x13b)](_0x3b4496=>_0x3b4496[_0x3e1664(0x178)]!=='0'&&_0x3b4496[_0x3e1664(0x178)]!==''||_0x3b4496['to_floorlevel']!=='0'&&_0x3b4496[_0x3e1664(0x12c)]!=='');var _0x1d0312=0x0;_0x1e24c1[_0x3e1664(0xdb)](_0x47ca89=>{var _0x1943e=_0x3e1664;parseInt(_0x47ca89[_0x1943e(0x169)])<parseInt(_0x47ca89['to_quantity'])&&_0x1d0312++;});if(_0x1d0312!=0x0)return _0x5a677f[_0x3e1664(0xda)](_0x3e1664(0x153),_0x3e1664(0x16f)),_0x307dce[_0x3e1664(0x165)](_0x3e1664(0x11f));const _0x532354=new transfers_finished({'date':_0x22bb78,'from_warehouse':_0x304df5,'to_warehouse':_0x278e6a,'product':_0x1e24c1,'note':_0x56e97f,'invoice':_0x21ba41}),_0x224d8d=await _0x532354[_0x3e1664(0x137)]();_0x5a677f['flash']('success',_0x3e1664(0x108)),_0x307dce[_0x3e1664(0x165)](_0x3e1664(0x1a1)+_0x224d8d['_id']);}catch(_0x32ef7a){console[_0x3e1664(0x11a)](_0x32ef7a),_0x307dce[_0x3e1664(0xc8)](0xc8)[_0x3e1664(0x113)]({'errorMessage':_0x32ef7a[_0x3e1664(0x186)]});}}),router[a0_0x3e3a92(0x110)](a0_0x3e3a92(0x119),auth,async(_0x345dbc,_0x4af8cd)=>{var _0x17c5cf=a0_0x3e3a92;try{const {username:_0x206418,email:_0x4dfb95,role:_0x28274a}=_0x345dbc[_0x17c5cf(0x146)],_0x1f83ef=_0x345dbc['user'],_0x3f8653=await profile[_0x17c5cf(0x16c)]({'email':_0x1f83ef[_0x17c5cf(0x10a)]}),_0x38f281=await master_shop[_0x17c5cf(0xfb)](),_0x54f3bf=await transfers_finished[_0x17c5cf(0x139)](_0x345dbc[_0x17c5cf(0x115)]['id']);let _0x3ce5c7;if(_0x1f83ef[_0x17c5cf(0x16b)]==_0x17c5cf(0xf6)){const _0x37534d=await staff['findOne']({'email':_0x1f83ef[_0x17c5cf(0x10a)]});_0x3ce5c7=await warehouse[_0x17c5cf(0xfb)]({'status':_0x17c5cf(0x14d),'name':_0x37534d['warehouse'],'warehouse_category':_0x17c5cf(0x152)});}else _0x3ce5c7=await warehouse['find']({'status':_0x17c5cf(0x14d),'warehouse_category':'Finished\x20Goods'});const _0x5ec1ee=await warehouse['aggregate']([{'$match':{'name':_0x54f3bf['from_warehouse'],'warehouse_category':_0x17c5cf(0x152)}},{'$unwind':_0x17c5cf(0xf9)},{'$group':{'_id':_0x17c5cf(0x14c),'name':{'$first':_0x17c5cf(0xf8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x17c5cf(0x15e)},'bin':{'$first':_0x17c5cf(0x191)},'type':{'$first':_0x17c5cf(0x177)},'floorlevel':{'$first':_0x17c5cf(0xd5)},'primary_code':{'$first':_0x17c5cf(0x102)},'secondary_code':{'$first':_0x17c5cf(0x194)},'product_code':{'$first':_0x17c5cf(0x1a3)},'storage':{'$first':_0x17c5cf(0x18d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x17c5cf(0x129)},'production_date':{'$first':_0x17c5cf(0x12b)},'room':{'$first':_0x17c5cf(0x19c)},'warehoue_name':{'$first':_0x17c5cf(0x10f)}}}]),_0x38742b=await product['find']({});if(_0x38f281[0x0][_0x17c5cf(0x133)]==_0x17c5cf(0x19e)){var _0x220877=users['English'];console['log'](_0x220877);}else{if(_0x38f281[0x0]['language']==_0x17c5cf(0x150))var _0x220877=users['Hindi'];else{if(_0x38f281[0x0][_0x17c5cf(0x133)]==_0x17c5cf(0x141))var _0x220877=users[_0x17c5cf(0x141)];else{if(_0x38f281[0x0][_0x17c5cf(0x133)]==_0x17c5cf(0x123))var _0x220877=users['Spanish'];else{if(_0x38f281[0x0][_0x17c5cf(0x133)]==_0x17c5cf(0xc7))var _0x220877=users[_0x17c5cf(0xc7)];else{if(_0x38f281[0x0]['language']==_0x17c5cf(0x13a))var _0x220877=users['Portuguese'];else{if(_0x38f281[0x0]['language']==_0x17c5cf(0x1a0))var _0x220877=users[_0x17c5cf(0x1a0)];else{if(_0x38f281[0x0][_0x17c5cf(0x133)]==_0x17c5cf(0xd4))var _0x220877=users[_0x17c5cf(0x16e)];}}}}}}}_0x4af8cd['render'](_0x17c5cf(0xd0),{'success':_0x345dbc[_0x17c5cf(0xda)](_0x17c5cf(0x19b)),'errors':_0x345dbc[_0x17c5cf(0xda)](_0x17c5cf(0x153)),'role':_0x1f83ef,'profile':_0x3f8653,'master_shop':_0x38f281,'warehouse':_0x3ce5c7,'transfer':_0x54f3bf,'stock':_0x5ec1ee,'unit':_0x38742b,'language':_0x220877});}catch(_0x449ef4){console[_0x17c5cf(0x11a)](_0x449ef4);}}),router['post'](a0_0x3e3a92(0x119),auth,async(_0x16f44d,_0xb72520)=>{var _0x5f57ef=a0_0x3e3a92;try{const {invoice:_0x224735,from_warehouse:_0x5d40a5,FromRoom_name:_0x369fa8,to_warehouse:_0x54b23b,ToRoom_name:_0x18fe2a}=_0x16f44d['body'],_0x1a05c1=await transfers_finished[_0x5f57ef(0x139)](_0x16f44d['params']['id']),_0x52a200=_0x1a05c1[_0x5f57ef(0x16d)][_0x5f57ef(0x15d)](async _0x6451cf=>{var _0x162d86=_0x5f57ef;if(_0x6451cf['to_quantity']>0x0){var _0x22fbbe=await warehouse[_0x162d86(0x16c)]({'name':_0x5d40a5,'room':_0x6451cf['from_room_name'],'warehouse_category':_0x162d86(0x152)});const _0x495e3c=_0x22fbbe[_0x162d86(0x157)][_0x162d86(0x15d)](_0x148dda=>{var _0x1c931a=_0x162d86;_0x148dda[_0x1c931a(0xfc)]==_0x6451cf[_0x1c931a(0xfc)]&&_0x148dda[_0x1c931a(0x180)]==_0x6451cf[_0x1c931a(0x193)]&&_0x148dda[_0x1c931a(0x156)]==_0x6451cf[_0x1c931a(0x156)]&&_0x148dda[_0x1c931a(0xd8)]==_0x6451cf[_0x1c931a(0xd8)]&&_0x148dda[_0x1c931a(0x170)]==_0x6451cf[_0x1c931a(0x170)]&&_0x148dda[_0x1c931a(0x1a2)]==_0x6451cf['from_invoice']&&(console[_0x1c931a(0x11a)](_0x1c931a(0x175),_0x148dda[_0x1c931a(0xd3)]),typeof _0x6451cf['id_transaction']==_0x1c931a(0x18b)?_0x148dda[_0x1c931a(0xd3)]=Math[_0x1c931a(0x131)](0x0,Math[_0x1c931a(0x122)](_0x148dda[_0x1c931a(0xd3)])-Math[_0x1c931a(0x122)](_0x6451cf['to_quantity'])):_0x148dda[_0x1c931a(0xd3)]=Math[_0x1c931a(0x131)](0x0,Math[_0x1c931a(0x122)](_0x148dda[_0x1c931a(0xd3)])-Math[_0x1c931a(0x122)](_0x6451cf[_0x1c931a(0x178)])));});}return _0x22fbbe;});Promise[_0x5f57ef(0x114)](_0x52a200)[_0x5f57ef(0x105)](async _0x512fa7=>{var _0x31a03c=_0x5f57ef;try{for(const _0xd96350 of _0x512fa7){await _0xd96350[_0x31a03c(0x137)]();}const _0x56ea0a=_0x1a05c1[_0x31a03c(0x16d)][_0x31a03c(0x15d)](async _0xa39edb=>{var _0xd23be=_0x31a03c,_0x183fd5=await warehouse[_0xd23be(0x16c)]({'name':_0x54b23b,'room':_0xa39edb[_0xd23be(0x13c)]});if(_0xa39edb[_0xd23be(0x178)]>0x0){var _0x353154=0x0;const _0x2a3446=_0x183fd5[_0xd23be(0x157)]['map'](_0x2cb0c0=>{var _0x56d6c8=_0xd23be;_0x2cb0c0['product_name']==_0xa39edb[_0x56d6c8(0xfc)]&&_0x2cb0c0[_0x56d6c8(0x180)]==_0xa39edb[_0x56d6c8(0x15f)]&&_0x2cb0c0['expiry_date']==_0xa39edb[_0x56d6c8(0x156)]&&_0x2cb0c0[_0x56d6c8(0xd8)]==_0xa39edb['production_date']&&_0x2cb0c0[_0x56d6c8(0x170)]==_0xa39edb[_0x56d6c8(0x170)]&&_0x2cb0c0['invoice']==_0xa39edb[_0x56d6c8(0x140)]&&(typeof _0xa39edb['id_transaction']=='undefined'?(console[_0x56d6c8(0x11a)](_0x56d6c8(0x104),_0x2cb0c0['product_stock']+_0x56d6c8(0xdf)+_0x2cb0c0['_id']+_0x56d6c8(0xe2)+Math[_0x56d6c8(0x122)](_0x2cb0c0[_0x56d6c8(0xd3)])+Math[_0x56d6c8(0x122)](_0xa39edb['to_quantity'])),_0x2cb0c0[_0x56d6c8(0xd3)]=Math[_0x56d6c8(0x122)](_0x2cb0c0[_0x56d6c8(0xd3)])+Math['abs'](_0xa39edb[_0x56d6c8(0x178)])):_0x2cb0c0[_0x56d6c8(0xd3)]=Math[_0x56d6c8(0x122)](_0x2cb0c0[_0x56d6c8(0xd3)])+Math[_0x56d6c8(0x122)](_0xa39edb[_0x56d6c8(0x178)]),_0x353154++);});_0x353154=='0'&&(_0x183fd5[_0xd23be(0x157)]=_0x183fd5['product_details'][_0xd23be(0x190)]({'product_name':_0xa39edb[_0xd23be(0xfc)],'product_stock':_0xa39edb[_0xd23be(0x178)],'bay':_0xa39edb[_0xd23be(0x15f)],'product_code':_0xa39edb[_0xd23be(0x126)],'primary_code':_0xa39edb[_0xd23be(0x151)],'secondary_code':_0xa39edb[_0xd23be(0x11d)],'expiry_date':_0xa39edb[_0xd23be(0x156)],'production_date':_0xa39edb[_0xd23be(0xd8)],'maxProducts':_0xa39edb[_0xd23be(0x189)],'batch_code':_0xa39edb[_0xd23be(0x170)],'secondary_unit':_0xa39edb[_0xd23be(0x18e)],'unit':_0xa39edb[_0xd23be(0x143)],'maxProducts':_0xa39edb[_0xd23be(0x189)],'maxPerUnit':_0xa39edb['maxPerUnit'],'invoice':_0xa39edb[_0xd23be(0x140)]}));}return _0x183fd5;});Promise[_0x31a03c(0x114)](_0x56ea0a)[_0x31a03c(0x105)](async _0x129553=>{var _0x325dbc=_0x31a03c;try{for(const _0x212a69 of _0x129553){await warehouse[_0x325dbc(0x168)]({'_id':_0x212a69[_0x325dbc(0xe0)]},{'$addToSet':{'product_details':{'$each':_0x212a69[_0x325dbc(0x157)]}}});}_0x1a05c1[_0x325dbc(0x187)]=_0x325dbc(0x184);const _0x31b246=await _0x1a05c1['save'](),_0xf8902f=await master_shop[_0x325dbc(0xfb)](),_0x20441b=await email_settings[_0x325dbc(0x16c)](),_0x33c13b=await supervisor_settings[_0x325dbc(0xfb)]();var _0x35b487=_0x1a05c1[_0x325dbc(0x16d)],_0x2c7b52='',_0x38b73c;for(_0x38b73c in _0x35b487){var _0x2ff4cb='FG';_0x1a05c1['to_warehouse']==_0x325dbc(0x11c)&&(_0x2ff4cb='DG'),_0x2c7b52+=_0x325dbc(0x18f)+_0x325dbc(0x107)+_0x35b487[_0x38b73c]['product_name']+_0x325dbc(0x11e)+_0x325dbc(0x107)+_0x35b487[_0x38b73c][_0x325dbc(0x126)]+_0x325dbc(0x11e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35b487[_0x38b73c][_0x325dbc(0x178)]+_0x325dbc(0x11e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35b487[_0x38b73c][_0x325dbc(0x143)]+_0x325dbc(0x11e)+_0x325dbc(0x107)+_0x35b487[_0x38b73c][_0x325dbc(0x18e)]+'</td>'+_0x325dbc(0x107)+_0x1a05c1[_0x325dbc(0xcc)]+_0x325dbc(0x11e)+_0x325dbc(0x107)+_0x35b487[_0x38b73c][_0x325dbc(0x13c)]+'</td>'+_0x325dbc(0x107)+_0x2ff4cb+_0x35b487[_0x38b73c][_0x325dbc(0x15f)]+_0x325dbc(0x11e)+'</tr>';}let _0x1aa60b=nodemailer['createTransport']({'host':_0x20441b['host'],'port':Number(_0x20441b[_0x325dbc(0x17a)]),'secure':![],'auth':{'user':_0x20441b[_0x325dbc(0x10a)],'pass':_0x20441b[_0x325dbc(0x116)]}}),_0x5f550b={'from':_0x20441b['email'],'to':_0x33c13b[0x0][_0x325dbc(0xc9)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x325dbc(0x149),'path':__dirname+_0x325dbc(0x15c)+'/upload/'+_0xf8902f[0x0][_0x325dbc(0x125)],'cid':_0x325dbc(0x155)}],'html':_0x325dbc(0x159)+'<html><head><title></title>'+'</head><body>'+_0x325dbc(0x181)+_0x325dbc(0xf2)+_0x325dbc(0x181)+_0x325dbc(0x13e)+_0x325dbc(0x12f)+'<div>'+'<h2>\x20'+_0xf8902f[0x0][_0x325dbc(0x13f)]+'\x20</h2>'+_0x325dbc(0x12f)+_0x325dbc(0x12f)+'<hr\x20class=\x22my-3\x22>'+_0x325dbc(0x181)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x1a05c1[_0x325dbc(0x1a2)]+'\x20'+_0x325dbc(0xeb)+'\x20Order\x20Date\x20:\x20'+_0x1a05c1[_0x325dbc(0x111)]+'\x20'+_0x325dbc(0x138)+_0x325dbc(0x147)+'</div>'+_0x325dbc(0xf5)+_0x325dbc(0x10b)+_0x325dbc(0x18f)+_0x325dbc(0x148)+_0x325dbc(0xcd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x325dbc(0x18a)+_0x325dbc(0xf1)+_0x325dbc(0xff)+_0x325dbc(0xf7)+_0x325dbc(0x103)+_0x325dbc(0xe6)+_0x325dbc(0xd2)+_0x325dbc(0x19f)+'\x20'+_0x2c7b52+'\x20'+_0x325dbc(0x171)+_0x325dbc(0xee)+_0x325dbc(0x181)+_0x325dbc(0x106)+_0x325dbc(0xe3)+_0xf8902f[0x0]['site_title']+_0x325dbc(0x147)+_0x325dbc(0x12f)+_0x325dbc(0x12f)+_0x325dbc(0x117)};_0x1aa60b[_0x325dbc(0xe9)](_0x5f550b,function(_0x2c1ffe,_0x11eb41){var _0x46d4eb=_0x325dbc;_0x2c1ffe?(console[_0x46d4eb(0x11a)](_0x2c1ffe),console['log']('Error\x20Occurs')):console[_0x46d4eb(0x11a)](_0x46d4eb(0xd6));}),_0x16f44d[_0x325dbc(0xda)](_0x325dbc(0x19b),'Transfer\x20Finalize\x20Successfully'),_0xb72520['redirect'](_0x325dbc(0x174)+_0x31b246[_0x325dbc(0xe0)]);}catch(_0x351467){console[_0x325dbc(0x14a)](_0x351467),_0xb72520['status'](0x1f4)[_0x325dbc(0x113)]({'error':_0x325dbc(0x1a5)});}})['catch'](_0x58dac5=>{var _0x392b78=_0x31a03c;console['error'](_0x58dac5),_0xb72520[_0x392b78(0xc8)](0x1f4)[_0x392b78(0x113)]({'error':_0x392b78(0x17f)});});}catch(_0x455c0f){console[_0x31a03c(0x14a)](_0x455c0f),_0xb72520[_0x31a03c(0xc8)](0x1f4)[_0x31a03c(0x113)]({'error':_0x31a03c(0x192)});}})['catch'](_0x2cfda1=>{var _0x34e65f=_0x5f57ef;console[_0x34e65f(0x14a)](_0x2cfda1),_0xb72520[_0x34e65f(0xc8)](0x1f4)[_0x34e65f(0x113)]({'error':_0x34e65f(0x17f)});});}catch(_0x3f07d1){_0xb72520['json']({'message':_0x3f07d1[_0x5f57ef(0x186)]});}});function BayBinSelected(_0x225ad7,_0x3354b1){var _0x20086b=a0_0x3e3a92,_0x3fb0f4=[];let _0x540218=[];var _0x2dcb3b=[];if(_0x225ad7=='DRY\x20GOODS'){switch(_0x3354b1){case _0x20086b(0x118):_0x3fb0f4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x20086b(0x12e):_0x3fb0f4=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x2dcb3b=['DG'];}else{if(_0x225ad7==_0x20086b(0x19a)){switch(_0x3354b1){case _0x20086b(0x118):_0x3fb0f4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x20086b(0x12e):_0x3fb0f4=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x2dcb3b=['FG'];}}return{'levels':_0x3fb0f4,'identify':_0x2dcb3b};}function a0_0x3b93(){var _0x1c6d43=['$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','TRFF-','QA\x20Warehouse','<table\x20style=\x22width:\x20100%\x20!important;\x22>','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.product_name','$product_details','1687800FCQVEu','find','product_name','$product','product_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/CheckingWarehouse','add_transfer_finished','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','here2','then','<strong>\x20Regards\x20</strong>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Product\x20Transfer\x20successfully','MaxStocks_data2','email','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','getFullYear','$finalize','from_prod_qty','$name','get','date','$product_details.batch_code','json','all','params','password','</body></html>','Rack\x201','/preview/:id','log','push','DRY\x20GOODS','secondary_code','</td>','back','floor','$product_details.pallet','abs','Spanish','maxPerUnit','image','product_code','aggregate','Router','$product_details.expiry_date','../public/language/languages.json','$product_details.production_date','to_floorlevel','$product_details.rack','Rack\x202','</div>','New_Qty_Converted','max','$to_warehouse','language','ToRoomAssigned','id_transaction','padStart','save','</span>','findById','Portuguese\x20(BR)','filter','to_room_name','catch','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','site_title','To_invoice','German','$product_details.secondary_unit','unit','toString','2262174QhldeZ','user','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Logo.png','error','/view/add_transfer','$product_details._id','Enabled','$product_details.unit','length','Hindi','primary_code','Finished\x20Goods','errors','/view/:id','logo','expiry_date','product_details','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<!DOCTYPE\x20html>','1939023Hqkxaw','$product_details.product_stock','/../public','map','$product_details.bay','to_bay','$product.from_room_name','warehouse','from_room','render','/transfer/view','redirect','209204uZqctF','Ambient','updateOne','from_quantity','$product.to_room_name','role','findOne','product','Arabic','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','batch_code','</tbody>','2890010XoPoIf','1003716NGrSMR','/picking_list/PDF_transfer/','here1','prod_cat','$product_details.type','to_quantity','express','port','from_warehouse','27250EwdpMU','to_room','$_id','An\x20error\x20occurred.','bay','<div>','../models/all_models','to_prod_level','True','Enclosed','message','finalize','string','maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','undefined','slice','$product_details.storage','secondary_unit','<tr>','concat','$product_details.bin','An\x20error\x20occurred\x20while\x20saving\x20data.','from_bay','$product_details.secondary_code','$invoice','$product_details.invoice','getMonth','$product_details.maxProducts','to_prod_qty','FROZEN\x20GOODS','success','$room','from_invoice','English\x20(US)','<tbody\x20style=\x22text-align:\x20center;\x22>','Chinese','/transfer_finished/preview/','invoice','$product_details.product_code','/barcode_scanner','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','prod_name','English','from_room_name','getDate','French','status','FGSEmail','from_prod_level','/barcode_scanner2','to_warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','to_invoice','body','edit_transfer_finished_view','MaxStocks_data','</thead>','product_stock','Arabic\x20(ae)','$product_details.floorlevel','Email\x20sent\x20successfully','Transfer\x20Edit\x20Successfully','production_date','/barcode_scanner3','flash','forEach','product_code3','Portuguese','$product_details.maxPerUnit','\x20<>\x20','_id','40skmTXL','\x20<=>\x20','<h5>','$date','split','</tr>','post','primary_unit','sendMail','random','<span\x20style=\x22float:\x20right;\x22>','nodemailer','$from_warehouse','</table>','$product_details.isle'];a0_0x3b93=function(){return _0x1c6d43;};return a0_0x3b93();}router['get'](a0_0x3e3a92(0x154),auth,async(_0x3eb3bf,_0x312c4e)=>{var _0x46cf36=a0_0x3e3a92;try{const {username:_0x32fac9,email:_0x2f0bb0,role:_0x4b3d88}=_0x3eb3bf[_0x46cf36(0x146)],_0xc8d0cd=_0x3eb3bf[_0x46cf36(0x146)],_0x326d15=await profile['findOne']({'email':_0xc8d0cd[_0x46cf36(0x10a)]}),_0x196ee7=await master_shop[_0x46cf36(0xfb)](),_0x1fb95e=await transfers_finished[_0x46cf36(0x139)](_0x3eb3bf[_0x46cf36(0x115)]['id']);let _0x5e6e32=new Date(_0x1fb95e[_0x46cf36(0x156)]),_0x20f69b=('0'+_0x5e6e32[_0x46cf36(0xc6)]())[_0x46cf36(0x18c)](-0x2),_0x6145e7=('0'+(_0x5e6e32[_0x46cf36(0x197)]()+0x1))[_0x46cf36(0x18c)](-0x2),_0x4acf84=_0x5e6e32[_0x46cf36(0x10c)](),_0x12faad=_0x4acf84+'-'+_0x6145e7+'-'+_0x20f69b,_0x35070a;if(_0xc8d0cd[_0x46cf36(0x16b)]=='staff'){const _0x9b761=await staff['findOne']({'email':_0xc8d0cd[_0x46cf36(0x10a)]});_0x35070a=await warehouse['find']({'status':_0x46cf36(0x14d),'name':_0x9b761[_0x46cf36(0x161)],'warehouse_category':_0x46cf36(0x152)});}else _0x35070a=await warehouse['find']({'status':_0x46cf36(0x14d),'warehouse_category':_0x46cf36(0x152)});const _0x4b556e=await warehouse[_0x46cf36(0x127)]([{'$match':{'name':_0x1fb95e[_0x46cf36(0x17b)],'room':_0x1fb95e[_0x46cf36(0x162)]}},{'$unwind':_0x46cf36(0xf9)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x46cf36(0x15b)},'bay':{'$first':_0x46cf36(0x15e)},'bin':{'$first':_0x46cf36(0x191)},'type':{'$first':_0x46cf36(0x177)},'floorlevel':{'$first':_0x46cf36(0xd5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x46cf36(0x194)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x46cf36(0x18d)},'rack':{'$first':_0x46cf36(0x12d)}}}]);var _0x5d3a4b=[0x1,0x2,0x3,0x4],_0x2ca192=['A','B','C','D','E','F','G','H','I','J'],_0x526c90=[_0x46cf36(0x167),_0x46cf36(0x185)];const _0x194e14=await product[_0x46cf36(0xfb)]({}),_0x3c794e=BayBinSelected(_0x1fb95e[_0x46cf36(0xcc)],_0x1fb95e[_0x46cf36(0x17d)]);if(_0x196ee7[0x0][_0x46cf36(0x133)]=='English\x20(US)'){var _0xe88bfa=users[_0x46cf36(0xc4)];console[_0x46cf36(0x11a)](_0xe88bfa);}else{if(_0x196ee7[0x0][_0x46cf36(0x133)]==_0x46cf36(0x150))var _0xe88bfa=users[_0x46cf36(0x150)];else{if(_0x196ee7[0x0]['language']==_0x46cf36(0x141))var _0xe88bfa=users[_0x46cf36(0x141)];else{if(_0x196ee7[0x0][_0x46cf36(0x133)]==_0x46cf36(0x123))var _0xe88bfa=users[_0x46cf36(0x123)];else{if(_0x196ee7[0x0]['language']==_0x46cf36(0xc7))var _0xe88bfa=users['French'];else{if(_0x196ee7[0x0][_0x46cf36(0x133)]==_0x46cf36(0x13a))var _0xe88bfa=users[_0x46cf36(0xdd)];else{if(_0x196ee7[0x0][_0x46cf36(0x133)]=='Chinese')var _0xe88bfa=users[_0x46cf36(0x1a0)];else{if(_0x196ee7[0x0][_0x46cf36(0x133)]==_0x46cf36(0xd4))var _0xe88bfa=users[_0x46cf36(0x16e)];}}}}}}}_0x312c4e[_0x46cf36(0x163)]('edit_transfer_finished',{'success':_0x3eb3bf[_0x46cf36(0xda)]('success'),'errors':_0x3eb3bf[_0x46cf36(0xda)](_0x46cf36(0x153)),'role':_0xc8d0cd,'profile':_0x326d15,'master_shop':_0x196ee7,'warehouse':_0x35070a,'transfer':_0x1fb95e,'stock':_0x4b556e,'unit':_0x194e14,'language':_0xe88bfa,'levels':_0x5d3a4b,'Isle':_0x2ca192,'rooms_data':_0x526c90,'ed_fullDate':_0x12faad,'dataSelected':_0x3c794e});}catch(_0x4455dd){console['log'](_0x4455dd);}}),router['post'](a0_0x3e3a92(0x154),auth,async(_0x51024c,_0x1951ee)=>{var _0x444111=a0_0x3e3a92;try{const _0x4e8916=_0x51024c[_0x444111(0x115)]['id'];console[_0x444111(0x11a)](_0x51024c[_0x444111(0xcf)]);const _0x1727a4=await transfers_finished[_0x444111(0x139)](_0x4e8916);console[_0x444111(0x11a)]('transfer_data',_0x1727a4);const {date:_0x345b0c,from_warehouse:_0x2dda3c,FromRoom_name:_0x20c63f,to_warehouse:_0x26d29e,ToRoom_name:_0x30d9ec,prod_name:_0x18268c,from_prod_qty:_0x2b8ccb,from_prod_level:_0xc23b2c,from_prod_isle:_0x35123a,from_prod_pallet:_0x1db363,to_prod_qty:_0x5dcfb6,to_prod_level:_0x3d7595,to_prod_isle:_0x4f48dc,to_prod_pallet:_0x1bcb1e,primary_code:_0x51c655,secondary_code:_0x562882,product_code3:_0x300c5c,note:_0x561ec2,invoice:_0x418e75,expiry_date:_0x279f8f}=_0x51024c[_0x444111(0xcf)];if(typeof _0x18268c==_0x444111(0x188))var _0x45c376=[_0x51024c[_0x444111(0xcf)]['prod_name']],_0x962a3f=[_0x51024c[_0x444111(0xcf)][_0x444111(0x10e)]],_0x278ab3=[_0x51024c[_0x444111(0xcf)]['from_prod_level']],_0x69b1e4=[_0x51024c[_0x444111(0xcf)][_0x444111(0x199)]],_0x4fe1fc=[_0x51024c['body'][_0x444111(0x183)]],_0xa539a7=[_0x51024c[_0x444111(0xcf)][_0x444111(0x151)]],_0xc58af0=[_0x51024c[_0x444111(0xcf)][_0x444111(0x11d)]],_0x4814de=[_0x51024c[_0x444111(0xcf)]['product_code3']],_0x6945a2=[_0x51024c[_0x444111(0xcf)][_0x444111(0x109)]],_0x393b01=[_0x51024c[_0x444111(0xcf)][_0x444111(0x143)]],_0x1ebd74=[_0x51024c[_0x444111(0xcf)][_0x444111(0x18e)]],_0x241251=[_0x51024c[_0x444111(0xcf)][_0x444111(0x170)]],_0x475f8a=[_0x51024c['body']['expiry_date']];else var _0x45c376=[..._0x51024c[_0x444111(0xcf)][_0x444111(0x1a6)]],_0x962a3f=[..._0x51024c[_0x444111(0xcf)][_0x444111(0x10e)]],_0x278ab3=[..._0x51024c[_0x444111(0xcf)]['from_prod_level']],_0x69b1e4=[..._0x51024c[_0x444111(0xcf)][_0x444111(0x199)]],_0x4fe1fc=[..._0x51024c['body'][_0x444111(0x183)]],_0xa539a7=[..._0x51024c[_0x444111(0xcf)]['primary_code']],_0xc58af0=[..._0x51024c['body'][_0x444111(0x11d)]],_0x4814de=[..._0x51024c[_0x444111(0xcf)][_0x444111(0xdc)]],_0x6945a2=[..._0x51024c[_0x444111(0xcf)][_0x444111(0x109)]],_0x393b01=[..._0x51024c['body'][_0x444111(0x143)]],_0x1ebd74=[..._0x51024c['body'][_0x444111(0x18e)]],_0x241251=[..._0x51024c['body'][_0x444111(0x170)]],_0x475f8a=[..._0x51024c[_0x444111(0xcf)][_0x444111(0x156)]];const _0x7b5c40=_0x45c376[_0x444111(0x15d)](_0x2e89a2=>{return _0x2e89a2={'product_name':_0x2e89a2};});_0x962a3f[_0x444111(0xdb)]((_0x3dd83b,_0x47ca68)=>{var _0x58b0e8=_0x444111;_0x7b5c40[_0x47ca68][_0x58b0e8(0x169)]=_0x3dd83b;}),_0x278ab3['forEach']((_0x1cd805,_0x3232b2)=>{var _0x490865=_0x444111;_0x7b5c40[_0x3232b2][_0x490865(0x193)]=_0x1cd805;}),_0x69b1e4[_0x444111(0xdb)]((_0x306e7e,_0x9b447a)=>{var _0x380be6=_0x444111;_0x7b5c40[_0x9b447a][_0x380be6(0x178)]=_0x306e7e;}),_0x4fe1fc[_0x444111(0xdb)]((_0x494426,_0x4a41b2)=>{var _0x7a5bf5=_0x444111;_0x7b5c40[_0x4a41b2][_0x7a5bf5(0x15f)]=_0x494426;}),_0xa539a7[_0x444111(0xdb)]((_0x42b3ea,_0x4a1ef6)=>{var _0x1c2edf=_0x444111;_0x7b5c40[_0x4a1ef6][_0x1c2edf(0x151)]=_0x42b3ea;}),_0xc58af0['forEach']((_0x3fa2d7,_0x673f41)=>{var _0x2ead42=_0x444111;_0x7b5c40[_0x673f41][_0x2ead42(0x11d)]=_0x3fa2d7;}),_0x4814de[_0x444111(0xdb)]((_0x5cbc4a,_0x5ab800)=>{var _0x4c18e1=_0x444111;_0x7b5c40[_0x5ab800][_0x4c18e1(0x126)]=_0x5cbc4a;}),_0x6945a2[_0x444111(0xdb)]((_0x32d3ce,_0x1028b7)=>{_0x7b5c40[_0x1028b7]['maxProducts']=_0x32d3ce;}),_0x393b01['forEach']((_0x180209,_0x5b6960)=>{var _0xd27596=_0x444111;_0x7b5c40[_0x5b6960][_0xd27596(0x143)]=_0x180209;}),_0x1ebd74[_0x444111(0xdb)]((_0xb80312,_0x95f746)=>{var _0x4c6829=_0x444111;_0x7b5c40[_0x95f746][_0x4c6829(0x18e)]=_0xb80312;}),_0x241251[_0x444111(0xdb)]((_0x2edbf8,_0x325959)=>{_0x7b5c40[_0x325959]['batch_code']=_0x2edbf8;}),_0x475f8a['forEach']((_0x4ff585,_0x180b65)=>{var _0x2db6c8=_0x444111;_0x7b5c40[_0x180b65][_0x2db6c8(0x156)]=_0x4ff585;});const _0x11897c=_0x7b5c40[_0x444111(0x13b)](_0x94dcd3=>_0x94dcd3[_0x444111(0x178)]!=='0'&&_0x94dcd3['to_quantity']!==''||_0x94dcd3[_0x444111(0x12c)]!=='0'&&_0x94dcd3[_0x444111(0x12c)]!=='');var _0x1a0dd8=0x0;_0x11897c['forEach'](_0x487b92=>{var _0x2384a1=_0x444111;parseInt(_0x487b92[_0x2384a1(0x169)])<parseInt(_0x487b92['to_quantity'])&&_0x1a0dd8++;});if(_0x1a0dd8!=0x0)return _0x51024c[_0x444111(0xda)]('errors',_0x444111(0x16f)),_0x1951ee[_0x444111(0x165)]('back');const _0x3c4b7d=await warehouse[_0x444111(0x16c)]({'name':_0x1727a4[_0x444111(0x17b)],'room':_0x1727a4[_0x444111(0x162)]});_0x1727a4[_0x444111(0x16d)][_0x444111(0xdb)](_0x3e2e63=>{var _0x2c842a=_0x444111;if(_0x3e2e63[_0x2c842a(0x178)]>0x0){const _0x29c95b=_0x3c4b7d[_0x2c842a(0x157)]['map'](_0x432d55=>{var _0x1ce1b4=_0x2c842a;_0x432d55['product_name']==_0x3e2e63['product_name']&&_0x432d55[_0x1ce1b4(0x180)]==_0x3e2e63[_0x1ce1b4(0x193)]&&(_0x432d55['product_stock']=parseInt(_0x432d55[_0x1ce1b4(0xd3)])+parseInt(_0x3e2e63[_0x1ce1b4(0x178)]));});}}),await _0x3c4b7d[_0x444111(0x137)]();const _0x424989=await warehouse['findOne']({'name':_0x1727a4[_0x444111(0xcc)],'room':_0x1727a4[_0x444111(0x17d)]});_0x1727a4[_0x444111(0x16d)][_0x444111(0xdb)](_0x530dd6=>{var _0x1d92fc=_0x444111;if(_0x530dd6[_0x1d92fc(0x178)]>0x0){const _0x4cc214=_0x424989[_0x1d92fc(0x157)][_0x1d92fc(0x15d)](_0x21494a=>{var _0x2f78e1=_0x1d92fc;_0x21494a[_0x2f78e1(0xfc)]==_0x530dd6[_0x2f78e1(0xfc)]&&_0x21494a[_0x2f78e1(0x180)]==_0x530dd6[_0x2f78e1(0x15f)]&&(_0x21494a[_0x2f78e1(0xd3)]=parseInt(_0x21494a[_0x2f78e1(0xd3)])-parseInt(_0x530dd6[_0x2f78e1(0x178)]));});}}),await _0x424989[_0x444111(0x137)](),_0x1727a4[_0x444111(0x111)]=_0x345b0c,_0x1727a4[_0x444111(0x17b)]=_0x2dda3c,_0x1727a4[_0x444111(0xcc)]=_0x26d29e,_0x1727a4[_0x444111(0x16d)]=_0x11897c,_0x1727a4['note']=_0x561ec2,_0x1727a4[_0x444111(0x1a2)]=_0x418e75;const _0x5d6ba9=await _0x1727a4[_0x444111(0x137)](),_0x48686c=await warehouse['findOne']({'name':_0x2dda3c,'room':_0x20c63f});_0x5d6ba9['product'][_0x444111(0xdb)](_0x3c4d21=>{var _0x1b4271=_0x444111;if(_0x3c4d21[_0x1b4271(0x178)]>0x0){const _0x23186=_0x48686c['product_details'][_0x1b4271(0x15d)](_0x4c0b77=>{var _0x53f341=_0x1b4271;_0x4c0b77[_0x53f341(0xfc)]==_0x3c4d21[_0x53f341(0xfc)]&&_0x4c0b77['bay']==_0x3c4d21[_0x53f341(0x193)]&&(_0x4c0b77[_0x53f341(0xd3)]=parseInt(_0x4c0b77[_0x53f341(0xd3)])-parseInt(_0x3c4d21[_0x53f341(0x178)]));});}}),await _0x48686c[_0x444111(0x137)]();const _0x26f8ec=await warehouse[_0x444111(0x16c)]({'name':_0x26d29e,'room':_0x30d9ec});_0x5d6ba9['product'][_0x444111(0xdb)](_0x3b97fe=>{var _0x583b1b=_0x444111;if(_0x3b97fe[_0x583b1b(0x178)]>0x0){var _0x4fb629=0x0;const _0x2bbcfc=_0x26f8ec['product_details'][_0x583b1b(0x15d)](_0xacce6a=>{var _0x25536b=_0x583b1b;_0xacce6a[_0x25536b(0xfc)]==_0x3b97fe[_0x25536b(0xfc)]&&_0xacce6a['bay']==_0x3b97fe[_0x25536b(0x15f)]&&(_0xacce6a[_0x25536b(0xd3)]=parseInt(_0xacce6a[_0x25536b(0xd3)])+parseInt(_0x3b97fe[_0x25536b(0x178)]),_0x4fb629++);});_0x4fb629=='0'&&(_0x26f8ec[_0x583b1b(0x157)]=_0x26f8ec[_0x583b1b(0x157)]['concat']({'product_name':_0x3b97fe[_0x583b1b(0xfc)],'product_stock':_0x3b97fe['to_quantity'],'bay':_0x3b97fe[_0x583b1b(0x15f)],'product_code':_0x3b97fe['product_code'],'primary_code':_0x3b97fe[_0x583b1b(0x151)],'secondary_code':_0x3b97fe[_0x583b1b(0x11d)],'maxProducts':_0x3b97fe[_0x583b1b(0x189)]}));}}),await _0x26f8ec[_0x444111(0x137)](),_0x51024c['flash'](_0x444111(0x19b),_0x444111(0xd7)),_0x1951ee[_0x444111(0x165)]('/transfer_finished/view');}catch(_0x2ddba6){console[_0x444111(0x11a)](_0x2ddba6);}}),router[a0_0x3e3a92(0xe7)](a0_0x3e3a92(0x1a4),async(_0x14d44a,_0x2fcf35)=>{var _0x14a958=a0_0x3e3a92;const {FromWareHouse:_0x4a5cb2,FromRoom:_0x3e50f2,ToWarehouse:_0x336166,ToRoom:_0x19f29d,primary_code:_0x490a44,Roomslist:_0x3ad081}=_0x14d44a[_0x14a958(0xcf)],_0x4d9682=_0x3ad081[_0x14a958(0xe5)](','),_0x42e2e4=[];async function _0x18c43f(_0x5aa434){var _0x1e4c85=_0x14a958;const _0x39f5a5=await warehouse[_0x1e4c85(0x127)]([{'$match':{'name':_0x4a5cb2,'room':_0x5aa434}},{'$unwind':_0x1e4c85(0xf9)},{'$match':{'product_details.primary_code':_0x490a44}},{'$group':{'_id':_0x1e4c85(0x14c),'name':{'$first':'$product_details.product_name'},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1e4c85(0x194)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1e4c85(0x191)},'type':{'$first':_0x1e4c85(0x177)},'pallet':{'$first':_0x1e4c85(0xd5)},'unit':{'$first':_0x1e4c85(0x14e)},'secondary_unit':{'$first':_0x1e4c85(0x142)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1e4c85(0x12d)},'expiry_date':{'$first':_0x1e4c85(0x129)},'production_date':{'$first':_0x1e4c85(0x12b)},'batch_code':{'$first':_0x1e4c85(0x112)},'maxPerUnit':{'$first':_0x1e4c85(0xde)},'roomNamed':{'$first':_0x1e4c85(0x19c)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x1e4c85(0x196)}}}]),_0x1b1b10=await warehouse[_0x1e4c85(0x127)]([{'$match':{'name':_0x4a5cb2,'room':_0x5aa434}},{'$unwind':_0x1e4c85(0xf9)},{'$match':{'product_details.secondary_code':_0x490a44}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1e4c85(0xf8)},'instock':{'$first':_0x1e4c85(0x15b)},'primary_code':{'$first':_0x1e4c85(0x102)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1e4c85(0x1a3)},'level':{'$first':_0x1e4c85(0x15e)},'isle':{'$first':_0x1e4c85(0x191)},'type':{'$first':_0x1e4c85(0x177)},'pallet':{'$first':_0x1e4c85(0xd5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1e4c85(0x142)},'storage':{'$first':_0x1e4c85(0x18d)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1e4c85(0x129)},'production_date':{'$first':_0x1e4c85(0x12b)},'batch_code':{'$first':_0x1e4c85(0x112)},'maxPerUnit':{'$first':_0x1e4c85(0xde)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x1e4c85(0x196)}}}]);if(_0x39f5a5[_0x1e4c85(0x14f)]>0x0)_0x42e2e4[_0x1e4c85(0x11b)](_0x39f5a5);else _0x1b1b10[_0x1e4c85(0x14f)]>0x0&&_0x42e2e4[_0x1e4c85(0x11b)](_0x1b1b10);}const _0x32027e=_0x4d9682[_0x14a958(0x15d)](_0x56dfda=>_0x18c43f(_0x56dfda));await Promise[_0x14a958(0x114)](_0x32027e),_0x2fcf35[_0x14a958(0x113)](_0x42e2e4);}),router['post'](a0_0x3e3a92(0xcb),async(_0xd949f6,_0x42f316)=>{var _0x3028b3=a0_0x3e3a92;try{const {FromWareHouse:_0x2ff36f,FromRoom:_0x1c04a8,ToWarehouse:_0x427798,ToRoom:_0x1dead7,secondary_code:_0x2cc56b}=_0xd949f6[_0x3028b3(0xcf)],_0x46042a=await warehouse[_0x3028b3(0x127)]([{'$match':{'name':_0x2ff36f}},{'$unwind':_0x3028b3(0xf9)},{'$match':{'product_details.secondary_code':_0x2cc56b}},{'$group':{'_id':_0x3028b3(0x14c),'name':{'$first':_0x3028b3(0xf8)},'primary_code':{'$first':_0x3028b3(0x102)},'secondary_code':{'$first':_0x3028b3(0x194)},'product_code':{'$first':_0x3028b3(0x1a3)},'instock':{'$first':_0x3028b3(0x15b)},'warehouse':{'$first':_0x3028b3(0x10f)},'level':{'$first':_0x3028b3(0xf0)},'isle':{'$first':_0x3028b3(0xef)},'pallet':{'$first':_0x3028b3(0x121)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x3028b3(0x14e)},'expiry_date':{'$first':_0x3028b3(0x129)},'production_date':{'$first':_0x3028b3(0x12b)}}}]);_0x42f316[_0x3028b3(0xc8)](0xc8)['json'](_0x46042a);}catch(_0x44cb79){_0x42f316[_0x3028b3(0xc8)](0x194)[_0x3028b3(0x113)]({'message':_0x44cb79[_0x3028b3(0x186)]});}}),router['post'](a0_0x3e3a92(0xd9),async(_0x613f53,_0x1709fc)=>{var _0x211d17=a0_0x3e3a92;try{const {FromWareHouse:_0x4085e3,FromRoom:_0x14923e,ToWarehouse:_0x57cda2,ToRoom:_0x1d0b98,product_code:_0x3b865e}=_0x613f53[_0x211d17(0xcf)],_0x1a42b0=await warehouse[_0x211d17(0x127)]([{'$match':{'name':_0x4085e3}},{'$unwind':_0x211d17(0xf9)},{'$match':{'product_details.product_code':_0x3b865e}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x211d17(0xf8)},'primary_code':{'$first':_0x211d17(0x102)},'secondary_code':{'$first':_0x211d17(0x194)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x211d17(0x15b)},'warehouse':{'$first':_0x211d17(0x10f)},'level':{'$first':_0x211d17(0xf0)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x211d17(0x14e)}}}]);_0x1709fc[_0x211d17(0xc8)](0xc8)[_0x211d17(0x113)](_0x1a42b0);}catch(_0x5e87c7){_0x1709fc[_0x211d17(0xc8)](0x194)[_0x211d17(0x113)]({'message':_0x5e87c7[_0x211d17(0x186)]});}}),router[a0_0x3e3a92(0xe7)](a0_0x3e3a92(0x100),async(_0x4f63f8,_0xd82513)=>{var _0x5546fd=a0_0x3e3a92;const {productCode:_0x66dd41,bay:_0x5434b2,warehouses:_0x1ba530,room:_0x3fb381}=_0x4f63f8[_0x5546fd(0xcf)];console[_0x5546fd(0x11a)](_0x4f63f8[_0x5546fd(0xcf)]);try{const _0x2e3b8e=await warehouse['aggregate']([{'$match':{'name':_0x1ba530,'room':_0x3fb381}},{'$unwind':_0x5546fd(0xf9)},{'$match':{'product_details.bay':parseInt(_0x5434b2)}},{'$group':{'_id':_0x5546fd(0x14c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5546fd(0x15b)},'bay':{'$first':_0x5546fd(0x15e)},'maxProducts':{'$first':_0x5546fd(0x198)}}}]);_0xd82513['status'](0xc8)[_0x5546fd(0x113)](_0x2e3b8e);}catch(_0x5a91f7){_0xd82513[_0x5546fd(0xc8)](0x194)[_0x5546fd(0x113)]({'message':_0x5a91f7[_0x5546fd(0x186)]});}}),module['exports']=router;