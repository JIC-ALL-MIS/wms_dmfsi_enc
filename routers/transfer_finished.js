function a0_0x48f9(_0x37a92a,_0x1d684f){var _0x798bdb=a0_0x798b();return a0_0x48f9=function(_0x48f948,_0x6b9a0a){_0x48f948=_0x48f948-0xc6;var _0x5b77aa=_0x798bdb[_0x48f948];return _0x5b77aa;},a0_0x48f9(_0x37a92a,_0x1d684f);}var a0_0x344258=a0_0x48f9;(function(_0x5bdb5e,_0x5cf1d9){var _0x140a80=a0_0x48f9,_0x2054cd=_0x5bdb5e();while(!![]){try{var _0x3a3c27=-parseInt(_0x140a80(0x126))/0x1+-parseInt(_0x140a80(0x105))/0x2+parseInt(_0x140a80(0x117))/0x3*(parseInt(_0x140a80(0x106))/0x4)+-parseInt(_0x140a80(0x177))/0x5+-parseInt(_0x140a80(0x143))/0x6*(parseInt(_0x140a80(0x169))/0x7)+parseInt(_0x140a80(0x198))/0x8*(-parseInt(_0x140a80(0x16d))/0x9)+parseInt(_0x140a80(0x157))/0xa*(parseInt(_0x140a80(0x163))/0xb);if(_0x3a3c27===_0x5cf1d9)break;else _0x2054cd['push'](_0x2054cd['shift']());}catch(_0x3e620e){_0x2054cd['push'](_0x2054cd['shift']());}}}(a0_0x798b,0x562a3));function a0_0x798b(){var _0x1f5fc5=['<table\x20style=\x22width:\x20100%\x20!important;\x22>','French','/barcode_scanner3','Transfer\x20Finalize\x20Successfully','/barcode_scanner','$product_details.isle','save','to_prod_level','from_prod_qty','\x20Order\x20Number\x20:\x20','DRY\x20GOODS','id_transaction','ToRoomAssigned','$product_details.storage','image','$product_details.unit','split','edit_transfer_finished_view','forEach','message','email','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','24LyPsJh','from_warehouse','from_invoice','Transfer\x20Mail','$product_details.bay','warehouse','abs','$product_details._id','to_bay','Enabled','toString','success','Portuguese','params','createTransport','/barcode_scanner2','express','expiry_date','$from_warehouse','Arabic','76270YAczTA','render','$product_details.type','flash','post','/../public','$_id','<h2>\x20','secondary_unit','RoomAssigned','maxProducts','<h5>','2673mKbXtY','find','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','port','$product_details.floorlevel','/CheckingWarehouse','1160649vacqcV','from_room_name','here2','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','9Txmmlh','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.invoice','/view/:id','maxPerUnit','add_transfer_finished','<hr\x20class=\x22my-3\x22>','product_stock','$product_details.product_code','$finalize','2505900NDaNOg','MaxStocks_data2','English\x20(US)','$product.from_room_name','$product','finalize','Error\x20Occurs','production_date','$product_details','/preview/:id','error','primary_code','</h5>','/transfer_finished/view','length','TRFF-','to_invoice','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','logo','get','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','all','getMonth','$product_details.pallet','unit','password','random','user','../middleware/auth','</body></html>','/view/add_transfer','German','1414376qMqGhI','<div>','aggregate','role','note','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Hindi','$product_details.expiry_date','</tr>','date','Rack\x201','</table>','transfer_finished','New_Qty_Converted','$room','English','Ambient','</td>','slice','secondary_code','findOne','../public/language/languages.json','MaxStocks_data','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','filter','body','<!DOCTYPE\x20html>','Rack\x202','host','primary_unit','to_warehouse','from_prod_level','language','back','bay','$product_details.batch_code','Transfer\x20Edit\x20Successfully','prod_cat','$product_details.secondary_unit','product','max','$name','json','from_room','$product_details.bin','$to_warehouse','<span\x20style=\x22float:\x20right;\x22>','/picking_list/PDF_transfer/','To_invoice','product_name','redirect','log','staff','map','findById','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','product_details','FROZEN\x20GOODS','errors','$product_details.maxPerUnit','<html><head><title></title>','Chinese','getDate','product_date','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','batch_code','catch','Portuguese\x20(BR)','to_prod_qty','then','\x20</h2>','invoice','</div>','push','edit_transfer_finished','$product_details.maxProducts','97862OWrVVQ','2186504mChEsf','$product_details.production_date','to_floorlevel','undefined','to_room_name','status','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<tr>','<tbody\x20style=\x22text-align:\x20center;\x22>','product_code','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','from_bay','There\x27s\x20a\x20error\x20in\x20this\x20transaction','to_room','<h5\x20style=\x22text-align:\x20left;\x22>','3pdTTIi','to_quantity','Finished\x20Goods','QA\x20Warehouse','from_quantity','string','$product_details.primary_code','$product_details.secondary_code','/transfer/view','site_title','/transfer_finished/preview/','product_code3','$product_details.product_stock','/upload/','Arabic\x20(ae)','656920LATlZX','exports','_id','$product_details.product_name','Spanish','Email\x20sent\x20successfully','An\x20error\x20occurred.'];a0_0x798b=function(){return _0x1f5fc5;};return a0_0x798b();}const express=require(a0_0x344258(0x153)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x344258(0x111)),auth=require(a0_0x344258(0x194)),users=require(a0_0x344258(0xcc)),nodemailer=require('nodemailer');router[a0_0x344258(0x18b)]('/view',auth,async(_0x5d3758,_0x29edac)=>{var _0x1e3b4=a0_0x344258;try{const {username:_0x604ffc,email:_0x84135c,role:_0x13adfb}=_0x5d3758[_0x1e3b4(0x193)],_0x59fe19=_0x5d3758[_0x1e3b4(0x193)],_0x21a660=await profile[_0x1e3b4(0xcb)]({'email':_0x59fe19[_0x1e3b4(0x141)]}),_0x4f3b42=await master_shop['find']();let _0x3570fe;if(_0x59fe19[_0x1e3b4(0x19b)]==_0x1e3b4(0xeb)){const _0x493972=await staff['findOne']({'email':_0x59fe19[_0x1e3b4(0x141)]});_0x3570fe=await transfers_finished['find']({'from_warehouse':_0x493972[_0x1e3b4(0x148)]});}else _0x3570fe=await transfers_finished[_0x1e3b4(0x19a)]([{'$unwind':_0x1e3b4(0x17b)},{'$group':{'_id':_0x1e3b4(0x15d),'invoice':{'$first':_0x1e3b4(0xee)},'date':{'$first':'$date'},'from_warehouse':{'$first':_0x1e3b4(0x155)},'to_warehouse':{'$first':_0x1e3b4(0xe4)},'from_room_name':{'$addToSet':_0x1e3b4(0x17a)},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x1e3b4(0x176)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x4f3b42[0x0][_0x1e3b4(0xd7)]==_0x1e3b4(0x179))var _0x2bd42c=users['English'];else{if(_0x4f3b42[0x0]['language']==_0x1e3b4(0x19f))var _0x2bd42c=users[_0x1e3b4(0x19f)];else{if(_0x4f3b42[0x0][_0x1e3b4(0xd7)]==_0x1e3b4(0x197))var _0x2bd42c=users[_0x1e3b4(0x197)];else{if(_0x4f3b42[0x0][_0x1e3b4(0xd7)]=='Spanish')var _0x2bd42c=users[_0x1e3b4(0x12a)];else{if(_0x4f3b42[0x0]['language']==_0x1e3b4(0x12e))var _0x2bd42c=users['French'];else{if(_0x4f3b42[0x0][_0x1e3b4(0xd7)]=='Portuguese\x20(BR)')var _0x2bd42c=users['Portuguese'];else{if(_0x4f3b42[0x0]['language']=='Chinese')var _0x2bd42c=users['Chinese'];else{if(_0x4f3b42[0x0]['language']==_0x1e3b4(0x125))var _0x2bd42c=users['Arabic'];}}}}}}}_0x29edac[_0x1e3b4(0x158)](_0x1e3b4(0x1a5),{'success':_0x5d3758[_0x1e3b4(0x15a)]('success'),'errors':_0x5d3758[_0x1e3b4(0x15a)](_0x1e3b4(0xf2)),'role':_0x59fe19,'profile':_0x21a660,'master_shop':_0x4f3b42,'transfer':_0x3570fe,'language':_0x2bd42c});}catch(_0x1a1e21){console[_0x1e3b4(0xea)](_0x1a1e21);}});async function getRandom8DigitNumber(){var _0x8c061d=a0_0x344258;const _0x3aaeda=0x989680,_0x498c73=0x5f5e0ff,_0xdc11a9=Math['floor'](Math[_0x8c061d(0x192)]()*(_0x498c73-_0x3aaeda+0x1))+_0x3aaeda;var _0x46123b;const _0x53e053=await transfers_finished[_0x8c061d(0xcb)]({'invoice':_0x8c061d(0x186)+_0xdc11a9});return _0x53e053&&_0x53e053[_0x8c061d(0x185)]>0x0?_0x46123b=_0x8c061d(0x186)+_0xdc11a9:_0x46123b=_0x8c061d(0x186)+_0xdc11a9,_0x46123b;}router[a0_0x344258(0x18b)](a0_0x344258(0x196),auth,async(_0x425c63,_0x35b34f)=>{var _0x4e95b9=a0_0x344258;try{const {username:_0x5421c0,email:_0x3dd0f0,role:_0x4a03f1}=_0x425c63['user'],_0x40e083=_0x425c63[_0x4e95b9(0x193)],_0x3a1001=await profile[_0x4e95b9(0xcb)]({'email':_0x40e083[_0x4e95b9(0x141)]}),_0x2816df=await master_shop[_0x4e95b9(0x164)]();let _0x278b33;if(_0x40e083[_0x4e95b9(0x19b)]==_0x4e95b9(0xeb)){const _0x44cfb4=await staff['findOne']({'email':_0x40e083[_0x4e95b9(0x141)]});_0x278b33=await warehouse['aggregate']([{'$match':{'status':_0x4e95b9(0x14c),'name':_0x44cfb4['warehouse'],'warehouse_category':_0x4e95b9(0x119),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x278b33=await warehouse['aggregate']([{'$match':{'status':_0x4e95b9(0x14c),'warehouse_category':_0x4e95b9(0x119),'name':{'$ne':_0x4e95b9(0x11a)}}},{'$group':{'_id':_0x4e95b9(0xe0),'name':{'$first':_0x4e95b9(0xe0)}}}]);const _0x38c02f=await transfers_finished[_0x4e95b9(0x164)]({}),_0x2839dc=_0x38c02f['length']+0x1,_0x56f693='TRFF-'+_0x2839dc[_0x4e95b9(0x14d)]()['padStart'](0x5,'0');if(_0x2816df[0x0]['language']==_0x4e95b9(0x179))var _0x25d3b1=users[_0x4e95b9(0xc6)];else{if(_0x2816df[0x0][_0x4e95b9(0xd7)]==_0x4e95b9(0x19f))var _0x25d3b1=users[_0x4e95b9(0x19f)];else{if(_0x2816df[0x0][_0x4e95b9(0xd7)]==_0x4e95b9(0x197))var _0x25d3b1=users[_0x4e95b9(0x197)];else{if(_0x2816df[0x0]['language']==_0x4e95b9(0x12a))var _0x25d3b1=users['Spanish'];else{if(_0x2816df[0x0][_0x4e95b9(0xd7)]==_0x4e95b9(0x12e))var _0x25d3b1=users[_0x4e95b9(0x12e)];else{if(_0x2816df[0x0][_0x4e95b9(0xd7)]=='Portuguese\x20(BR)')var _0x25d3b1=users[_0x4e95b9(0x14f)];else{if(_0x2816df[0x0][_0x4e95b9(0xd7)]==_0x4e95b9(0xf5))var _0x25d3b1=users['Chinese'];else{if(_0x2816df[0x0][_0x4e95b9(0xd7)]==_0x4e95b9(0x125))var _0x25d3b1=users[_0x4e95b9(0x156)];}}}}}}}const _0x5e4419=getRandom8DigitNumber();_0x5e4419[_0x4e95b9(0xfe)](_0x4a1841=>{var _0x4a467f=_0x4e95b9;_0x35b34f[_0x4a467f(0x158)](_0x4a467f(0x172),{'success':_0x425c63[_0x4a467f(0x15a)](_0x4a467f(0x14e)),'errors':_0x425c63[_0x4a467f(0x15a)](_0x4a467f(0xf2)),'role':_0x40e083,'profile':_0x3a1001,'master_shop':_0x2816df,'warehouse':_0x278b33,'language':_0x25d3b1,'invoice':_0x4a1841});})[_0x4e95b9(0xfb)](_0x50b7d0=>{var _0x56ad5e=_0x4e95b9;_0x425c63[_0x56ad5e(0x15a)](_0x56ad5e(0xf2),_0x56ad5e(0x114)),_0x35b34f[_0x56ad5e(0xe9)](_0x56ad5e(0x11f));});}catch(_0x58db0f){console[_0x4e95b9(0xea)](_0x58db0f);}}),router['post'](a0_0x344258(0x196),auth,async(_0x4de5f7,_0x3dc6e8)=>{var _0x15b324=a0_0x344258;try{const {date:_0x5d6499,from_warehouse:_0x144163,FromRoom_name:_0x23173a,to_warehouse:_0x563bce,ToRoom_name:_0x385ac4,prod_name:_0x1dc2f6,from_prod_qty:_0x557bf5,from_prod_level:_0x589b38,from_prod_isle:_0x11cff8,from_prod_pallet:_0x386a70,to_prod_qty:_0x3b1fc4,to_prod_level:_0xa8b167,to_prod_isle:_0x5a727f,to_prod_pallet:_0x40409f,primary_code:_0x26038c,secondary_code:_0x34bcdb,product_code3:_0x42bf94,note:_0x4c9df2,MaxStocks_data2:_0x5ee01a,invoice:_0x586a3f,expiry_date:_0x3dbef8}=_0x4de5f7[_0x15b324(0xd0)];if(typeof _0x1dc2f6=='string')var _0x1f3c9f=[_0x4de5f7['body'][_0x15b324(0x19d)]],_0x5bc693=[_0x4de5f7[_0x15b324(0xd0)]['from_prod_qty']],_0x36fa07=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xd6)]],_0x5b5863=[_0x4de5f7[_0x15b324(0xd0)]['New_Qty_Converted']],_0x3b9ee6=[_0x4de5f7[_0x15b324(0xd0)]['to_prod_level']],_0x3cf782=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x182)]],_0x389467=[_0x4de5f7['body'][_0x15b324(0xca)]],_0x565d45=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x122)]],_0x1095cb=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x178)]],_0x28e737=[_0x4de5f7['body'][_0x15b324(0xd4)]],_0x2e16e3=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x15f)]],_0x53e8cf=[_0x4de5f7['body'][_0x15b324(0xfa)]],_0x5ecfa9=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x154)]],_0x314c95=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xf7)]],_0x4d9b76=[_0x4de5f7['body'][_0x15b324(0xcd)]],_0x2be4dc=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x171)]],_0x393017=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xdc)]],_0x3d852a=[_0x4de5f7['body'][_0x15b324(0x160)]],_0xb317ff=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x139)]],_0x346f5f=[_0x4de5f7[_0x15b324(0xd0)]['from_invoice']],_0x3be3ff=[_0x4de5f7[_0x15b324(0xd0)]['to_invoice']],_0x254976=[_0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x138)]];else var _0x1f3c9f=[..._0x4de5f7['body'][_0x15b324(0x19d)]],_0x5bc693=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x135)]],_0x36fa07=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xd6)]],_0x5b5863=[..._0x4de5f7['body'][_0x15b324(0x1a6)]],_0x3b9ee6=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x134)]],_0x3cf782=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x182)]],_0x389467=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xca)]],_0x565d45=[..._0x4de5f7[_0x15b324(0xd0)]['product_code3']],_0x1095cb=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x178)]],_0x28e737=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xd4)]],_0x2e16e3=[..._0x4de5f7['body'][_0x15b324(0x15f)]],_0x53e8cf=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xfa)]],_0x5ecfa9=[..._0x4de5f7['body'][_0x15b324(0x154)]],_0x314c95=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xf7)]],_0x4d9b76=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xcd)]],_0x2be4dc=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x171)]],_0x393017=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0xdc)]],_0x3d852a=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x160)]],_0xb317ff=[..._0x4de5f7['body']['ToRoomAssigned']],_0x346f5f=[..._0x4de5f7[_0x15b324(0xd0)][_0x15b324(0x145)]],_0x3be3ff=[..._0x4de5f7['body'][_0x15b324(0x187)]],_0x254976=[..._0x4de5f7['body'][_0x15b324(0x138)]];const _0x2fa049=_0x1f3c9f[_0x15b324(0xec)](_0x5e89ed=>{return _0x5e89ed={'product_name':_0x5e89ed};});_0x5bc693[_0x15b324(0x13f)]((_0x536201,_0x4b252b)=>{_0x2fa049[_0x4b252b]['from_quantity']=_0x536201;}),_0x36fa07['forEach']((_0x28066b,_0x17dce4)=>{var _0x58e0c8=_0x15b324;_0x2fa049[_0x17dce4][_0x58e0c8(0x113)]=_0x28066b;}),_0x254976[_0x15b324(0x13f)]((_0x3cf4c7,_0xcdce0f)=>{var _0x6dac33=_0x15b324;_0x2fa049[_0xcdce0f][_0x6dac33(0x138)]=_0x3cf4c7;}),_0x346f5f[_0x15b324(0x13f)]((_0x403498,_0x39e46d)=>{var _0x301d9c=_0x15b324;_0x2fa049[_0x39e46d][_0x301d9c(0x145)]=_0x403498;}),_0x3be3ff[_0x15b324(0x13f)]((_0x2e455a,_0x40f718)=>{var _0xdebe8a=_0x15b324;_0x2fa049[_0x40f718][_0xdebe8a(0xe7)]=_0x2e455a;}),_0x5b5863['forEach']((_0x1331ed,_0xbbd018)=>{_0x2fa049[_0xbbd018]['to_quantity']=_0x1331ed;}),_0x3b9ee6[_0x15b324(0x13f)]((_0x19f530,_0x64bc3a)=>{_0x2fa049[_0x64bc3a]['to_bay']=_0x19f530;}),_0x3cf782[_0x15b324(0x13f)]((_0x1b2341,_0x5cca00)=>{_0x2fa049[_0x5cca00]['primary_code']=_0x1b2341;}),_0x389467['forEach']((_0x1e1b40,_0x15807a)=>{var _0x534ace=_0x15b324;_0x2fa049[_0x15807a][_0x534ace(0xca)]=_0x1e1b40;}),_0x565d45['forEach']((_0x4bcf51,_0x508e76)=>{var _0x4c0fb7=_0x15b324;_0x2fa049[_0x508e76][_0x4c0fb7(0x110)]=_0x4bcf51;}),_0x1095cb['forEach']((_0x4ac315,_0x2161b0)=>{var _0x44db2f=_0x15b324;_0x2fa049[_0x2161b0][_0x44db2f(0x161)]=_0x4ac315;}),_0x28e737[_0x15b324(0x13f)]((_0x20ff9d,_0x201317)=>{var _0xc34fb0=_0x15b324;_0x2fa049[_0x201317][_0xc34fb0(0x190)]=_0x20ff9d;}),_0x2e16e3[_0x15b324(0x13f)]((_0x21275e,_0x577306)=>{var _0x138843=_0x15b324;_0x2fa049[_0x577306][_0x138843(0x15f)]=_0x21275e;}),_0x53e8cf[_0x15b324(0x13f)]((_0x467cac,_0x5bb67c)=>{var _0x559b58=_0x15b324;_0x2fa049[_0x5bb67c][_0x559b58(0xfa)]=_0x467cac;}),_0x5ecfa9[_0x15b324(0x13f)]((_0x121b61,_0x4ed998)=>{var _0x9ebfb4=_0x15b324;_0x2fa049[_0x4ed998][_0x9ebfb4(0x154)]=_0x121b61;}),_0x314c95[_0x15b324(0x13f)]((_0x3002ae,_0x4b4de3)=>{var _0x1473ad=_0x15b324;_0x2fa049[_0x4b4de3][_0x1473ad(0x17e)]=_0x3002ae;}),_0x4d9b76[_0x15b324(0x13f)]((_0x59aa8a,_0x120957)=>{_0x2fa049[_0x120957]['maxProducts']=_0x59aa8a;}),_0x2be4dc[_0x15b324(0x13f)]((_0x59fd49,_0x5de4e8)=>{var _0x255c58=_0x15b324;_0x2fa049[_0x5de4e8][_0x255c58(0x171)]=_0x59fd49;}),_0x393017['forEach']((_0x1ebfb,_0x71622a)=>{var _0x233c26=_0x15b324;_0x2fa049[_0x71622a][_0x233c26(0xdc)]=_0x1ebfb;}),_0x3d852a[_0x15b324(0x13f)]((_0x2388c8,_0x19ff43)=>{_0x2fa049[_0x19ff43]['from_room_name']=_0x2388c8;}),_0xb317ff[_0x15b324(0x13f)]((_0x302936,_0x141683)=>{_0x2fa049[_0x141683]['to_room_name']=_0x302936;});const _0x5d15f1=_0x2fa049[_0x15b324(0xcf)](_0x3c2de6=>_0x3c2de6['to_quantity']!=='0'&&_0x3c2de6[_0x15b324(0x118)]!==''||_0x3c2de6[_0x15b324(0x108)]!=='0'&&_0x3c2de6[_0x15b324(0x108)]!=='');var _0x4f3bac=0x0;_0x5d15f1['forEach'](_0x221d0c=>{var _0x5b95f5=_0x15b324;parseInt(_0x221d0c[_0x5b95f5(0x11b)])<parseInt(_0x221d0c[_0x5b95f5(0x118)])&&_0x4f3bac++;});if(_0x4f3bac!=0x0)return _0x4de5f7[_0x15b324(0x15a)](_0x15b324(0xf2),_0x15b324(0x165)),_0x3dc6e8[_0x15b324(0xe9)](_0x15b324(0xd8));const _0x486e37=new transfers_finished({'date':_0x5d6499,'from_warehouse':_0x144163,'to_warehouse':_0x563bce,'product':_0x5d15f1,'note':_0x4c9df2,'invoice':_0x586a3f}),_0x49082f=await _0x486e37[_0x15b324(0x133)]();_0x4de5f7[_0x15b324(0x15a)](_0x15b324(0x14e),'Product\x20Transfer\x20successfully'),_0x3dc6e8['redirect'](_0x15b324(0x121)+_0x49082f[_0x15b324(0x128)]);}catch(_0x55d0a6){console[_0x15b324(0xea)](_0x55d0a6),_0x3dc6e8[_0x15b324(0x10b)](0xc8)[_0x15b324(0xe1)]({'errorMessage':_0x55d0a6[_0x15b324(0x140)]});}}),router[a0_0x344258(0x18b)]('/preview/:id',auth,async(_0x3f6870,_0x47d6d4)=>{var _0x5e5ed8=a0_0x344258;try{const {username:_0x428340,email:_0xa75a40,role:_0x114b2e}=_0x3f6870[_0x5e5ed8(0x193)],_0x1bde74=_0x3f6870[_0x5e5ed8(0x193)],_0x4bd638=await profile['findOne']({'email':_0x1bde74['email']}),_0x55c8f9=await master_shop[_0x5e5ed8(0x164)](),_0x32b9e6=await transfers_finished['findById'](_0x3f6870[_0x5e5ed8(0x150)]['id']);let _0x845cac;if(_0x1bde74[_0x5e5ed8(0x19b)]==_0x5e5ed8(0xeb)){const _0x1eb971=await staff['findOne']({'email':_0x1bde74[_0x5e5ed8(0x141)]});_0x845cac=await warehouse['find']({'status':_0x5e5ed8(0x14c),'name':_0x1eb971[_0x5e5ed8(0x148)],'warehouse_category':_0x5e5ed8(0x119)});}else _0x845cac=await warehouse[_0x5e5ed8(0x164)]({'status':'Enabled','warehouse_category':_0x5e5ed8(0x119)});const _0x65c482=await warehouse[_0x5e5ed8(0x19a)]([{'$match':{'name':_0x32b9e6[_0x5e5ed8(0x144)],'warehouse_category':_0x5e5ed8(0x119)}},{'$unwind':_0x5e5ed8(0x17f)},{'$group':{'_id':_0x5e5ed8(0x14a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5e5ed8(0x123)},'bay':{'$first':_0x5e5ed8(0x147)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5e5ed8(0x167)},'primary_code':{'$first':_0x5e5ed8(0x11d)},'secondary_code':{'$first':_0x5e5ed8(0x11e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5e5ed8(0x107)},'room':{'$first':_0x5e5ed8(0x1a7)},'warehoue_name':{'$first':'$name'}}}]),_0x116a47=await product[_0x5e5ed8(0x164)]({});if(_0x55c8f9[0x0][_0x5e5ed8(0xd7)]==_0x5e5ed8(0x179)){var _0xb71e6b=users[_0x5e5ed8(0xc6)];console[_0x5e5ed8(0xea)](_0xb71e6b);}else{if(_0x55c8f9[0x0]['language']==_0x5e5ed8(0x19f))var _0xb71e6b=users[_0x5e5ed8(0x19f)];else{if(_0x55c8f9[0x0]['language']==_0x5e5ed8(0x197))var _0xb71e6b=users[_0x5e5ed8(0x197)];else{if(_0x55c8f9[0x0][_0x5e5ed8(0xd7)]==_0x5e5ed8(0x12a))var _0xb71e6b=users[_0x5e5ed8(0x12a)];else{if(_0x55c8f9[0x0][_0x5e5ed8(0xd7)]=='French')var _0xb71e6b=users[_0x5e5ed8(0x12e)];else{if(_0x55c8f9[0x0][_0x5e5ed8(0xd7)]==_0x5e5ed8(0xfc))var _0xb71e6b=users['Portuguese'];else{if(_0x55c8f9[0x0]['language']=='Chinese')var _0xb71e6b=users['Chinese'];else{if(_0x55c8f9[0x0][_0x5e5ed8(0xd7)]==_0x5e5ed8(0x125))var _0xb71e6b=users[_0x5e5ed8(0x156)];}}}}}}}_0x47d6d4[_0x5e5ed8(0x158)](_0x5e5ed8(0x13e),{'success':_0x3f6870[_0x5e5ed8(0x15a)](_0x5e5ed8(0x14e)),'errors':_0x3f6870[_0x5e5ed8(0x15a)](_0x5e5ed8(0xf2)),'role':_0x1bde74,'profile':_0x4bd638,'master_shop':_0x55c8f9,'warehouse':_0x845cac,'transfer':_0x32b9e6,'stock':_0x65c482,'unit':_0x116a47,'language':_0xb71e6b});}catch(_0x423e0a){console[_0x5e5ed8(0xea)](_0x423e0a);}}),router[a0_0x344258(0x15b)](a0_0x344258(0x180),auth,async(_0x15daa8,_0x4804c7)=>{var _0xf328c3=a0_0x344258;try{const {invoice:_0xa09aac,from_warehouse:_0x31edcb,FromRoom_name:_0x27ca94,to_warehouse:_0x256fb5,ToRoom_name:_0x202141}=_0x15daa8[_0xf328c3(0xd0)],_0x1f24b2=await transfers_finished[_0xf328c3(0xed)](_0x15daa8[_0xf328c3(0x150)]['id']),_0x20d91f=_0x1f24b2[_0xf328c3(0xde)][_0xf328c3(0xec)](async _0x35efb0=>{var _0x20d357=_0xf328c3;if(_0x35efb0['to_quantity']>0x0){var _0x36e065=await warehouse['findOne']({'name':_0x31edcb,'room':_0x35efb0[_0x20d357(0x16a)],'warehouse_category':_0x20d357(0x119)});const _0x1de9bf=_0x36e065[_0x20d357(0xf0)][_0x20d357(0xec)](_0x16aaf0=>{var _0x51da10=_0x20d357;_0x16aaf0[_0x51da10(0xe8)]==_0x35efb0['product_name']&&_0x16aaf0[_0x51da10(0xd9)]==_0x35efb0[_0x51da10(0x113)]&&_0x16aaf0[_0x51da10(0x154)]==_0x35efb0[_0x51da10(0x154)]&&_0x16aaf0['production_date']==_0x35efb0[_0x51da10(0x17e)]&&_0x16aaf0[_0x51da10(0xfa)]==_0x35efb0[_0x51da10(0xfa)]&&_0x16aaf0['invoice']==_0x35efb0[_0x51da10(0x145)]&&(console[_0x51da10(0xea)]('here1',_0x16aaf0[_0x51da10(0x174)]),typeof _0x35efb0[_0x51da10(0x138)]==_0x51da10(0x109)?_0x16aaf0[_0x51da10(0x174)]=Math[_0x51da10(0xdf)](0x0,Math[_0x51da10(0x149)](_0x16aaf0[_0x51da10(0x174)])-Math['abs'](_0x35efb0[_0x51da10(0x118)])):_0x16aaf0[_0x51da10(0x174)]=Math['max'](0x0,Math['abs'](_0x16aaf0[_0x51da10(0x174)])-Math[_0x51da10(0x149)](_0x35efb0[_0x51da10(0x118)])));});}return _0x36e065;});Promise[_0xf328c3(0x18d)](_0x20d91f)[_0xf328c3(0xfe)](async _0x2ed466=>{var _0x102032=_0xf328c3;try{for(const _0x54c1f6 of _0x2ed466){await _0x54c1f6[_0x102032(0x133)]();}const _0x1cbddf=_0x1f24b2['product'][_0x102032(0xec)](async _0x2478a7=>{var _0x296c35=_0x102032,_0x26f9ba=await warehouse[_0x296c35(0xcb)]({'name':_0x256fb5,'room':_0x2478a7[_0x296c35(0x10a)]});if(_0x2478a7[_0x296c35(0x118)]>0x0){var _0x16a8cb=0x0;const _0x11bd2e=_0x26f9ba['product_details'][_0x296c35(0xec)](_0x51895d=>{var _0x373c20=_0x296c35;_0x51895d['product_name']==_0x2478a7[_0x373c20(0xe8)]&&_0x51895d[_0x373c20(0xd9)]==_0x2478a7[_0x373c20(0x14b)]&&_0x51895d['expiry_date']==_0x2478a7[_0x373c20(0x154)]&&_0x51895d['production_date']==_0x2478a7[_0x373c20(0x17e)]&&_0x51895d[_0x373c20(0xfa)]==_0x2478a7[_0x373c20(0xfa)]&&_0x51895d[_0x373c20(0x100)]==_0x2478a7['To_invoice']&&(typeof _0x2478a7[_0x373c20(0x138)]=='undefined'?(console[_0x373c20(0xea)](_0x373c20(0x16b),_0x51895d[_0x373c20(0x174)]+'\x20<>\x20'+_0x51895d[_0x373c20(0x128)]+'\x20<=>\x20'+Math[_0x373c20(0x149)](_0x51895d[_0x373c20(0x174)])+Math[_0x373c20(0x149)](_0x2478a7['to_quantity'])),_0x51895d[_0x373c20(0x174)]=Math[_0x373c20(0x149)](_0x51895d[_0x373c20(0x174)])+Math['abs'](_0x2478a7[_0x373c20(0x118)])):_0x51895d[_0x373c20(0x174)]=Math[_0x373c20(0x149)](_0x51895d[_0x373c20(0x174)])+Math['abs'](_0x2478a7[_0x373c20(0x118)]),_0x16a8cb++);});_0x16a8cb=='0'&&(_0x26f9ba[_0x296c35(0xf0)]=_0x26f9ba[_0x296c35(0xf0)]['concat']({'product_name':_0x2478a7[_0x296c35(0xe8)],'product_stock':_0x2478a7['to_quantity'],'bay':_0x2478a7[_0x296c35(0x14b)],'product_code':_0x2478a7['product_code'],'primary_code':_0x2478a7['primary_code'],'secondary_code':_0x2478a7[_0x296c35(0xca)],'expiry_date':_0x2478a7[_0x296c35(0x154)],'production_date':_0x2478a7['production_date'],'maxProducts':_0x2478a7[_0x296c35(0x161)],'batch_code':_0x2478a7['batch_code'],'secondary_unit':_0x2478a7[_0x296c35(0x15f)],'unit':_0x2478a7['unit'],'maxProducts':_0x2478a7['maxProducts'],'maxPerUnit':_0x2478a7[_0x296c35(0x171)],'invoice':_0x2478a7['To_invoice']}));}return _0x26f9ba;});Promise[_0x102032(0x18d)](_0x1cbddf)[_0x102032(0xfe)](async _0x3a1291=>{var _0x15ad63=_0x102032;try{for(const _0x4b4e82 of _0x3a1291){await warehouse['updateOne']({'_id':_0x4b4e82[_0x15ad63(0x128)]},{'$addToSet':{'product_details':{'$each':_0x4b4e82[_0x15ad63(0xf0)]}}});}_0x1f24b2[_0x15ad63(0x17c)]='True';const _0x2a1f4f=await _0x1f24b2[_0x15ad63(0x133)](),_0x513c33=await master_shop['find'](),_0x563b7b=await email_settings[_0x15ad63(0xcb)](),_0x11867b=await supervisor_settings[_0x15ad63(0x164)]();var _0x1f80fc=_0x1f24b2[_0x15ad63(0xde)],_0x25e54f='',_0x39130f;for(_0x39130f in _0x1f80fc){var _0x14b499='FG';_0x1f24b2[_0x15ad63(0xd5)]==_0x15ad63(0x137)&&(_0x14b499='DG'),_0x25e54f+=_0x15ad63(0x10e)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f80fc[_0x39130f][_0x15ad63(0xe8)]+_0x15ad63(0xc8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f80fc[_0x39130f][_0x15ad63(0x110)]+_0x15ad63(0xc8)+_0x15ad63(0x142)+_0x1f80fc[_0x39130f]['to_quantity']+'</td>'+_0x15ad63(0x142)+_0x1f80fc[_0x39130f][_0x15ad63(0x190)]+'</td>'+_0x15ad63(0x142)+_0x1f80fc[_0x39130f][_0x15ad63(0x15f)]+_0x15ad63(0xc8)+_0x15ad63(0x142)+_0x1f24b2['to_warehouse']+_0x15ad63(0xc8)+_0x15ad63(0x142)+_0x1f80fc[_0x39130f][_0x15ad63(0x10a)]+'</td>'+_0x15ad63(0x142)+_0x14b499+_0x1f80fc[_0x39130f][_0x15ad63(0x14b)]+_0x15ad63(0xc8)+_0x15ad63(0x1a1);}let _0x127e53=nodemailer[_0x15ad63(0x151)]({'host':_0x563b7b[_0x15ad63(0xd3)],'port':Number(_0x563b7b[_0x15ad63(0x166)]),'secure':![],'auth':{'user':_0x563b7b[_0x15ad63(0x141)],'pass':_0x563b7b[_0x15ad63(0x191)]}}),_0x34e02a={'from':_0x563b7b['email'],'to':_0x11867b[0x0]['FGSEmail'],'subject':_0x15ad63(0x146),'attachments':[{'filename':_0x15ad63(0x188),'path':__dirname+_0x15ad63(0x15c)+_0x15ad63(0x124)+_0x513c33[0x0][_0x15ad63(0x13b)],'cid':_0x15ad63(0x18a)}],'html':_0x15ad63(0xd1)+_0x15ad63(0xf4)+'</head><body>'+_0x15ad63(0x199)+_0x15ad63(0x18c)+_0x15ad63(0x199)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x15ad63(0x101)+_0x15ad63(0x199)+_0x15ad63(0x15e)+_0x513c33[0x0][_0x15ad63(0x120)]+_0x15ad63(0xff)+_0x15ad63(0x101)+_0x15ad63(0x101)+_0x15ad63(0x173)+_0x15ad63(0x199)+_0x15ad63(0x116)+_0x15ad63(0x136)+_0x1f24b2[_0x15ad63(0x100)]+'\x20'+_0x15ad63(0xe5)+'\x20Order\x20Date\x20:\x20'+_0x1f24b2[_0x15ad63(0x1a2)]+'\x20'+'</span>'+_0x15ad63(0x183)+_0x15ad63(0x101)+_0x15ad63(0x12d)+_0x15ad63(0xce)+_0x15ad63(0x10e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x15ad63(0x16c)+_0x15ad63(0x19e)+_0x15ad63(0x112)+_0x15ad63(0x189)+_0x15ad63(0xf9)+_0x15ad63(0xef)+_0x15ad63(0x10d)+_0x15ad63(0x1a1)+'</thead>'+_0x15ad63(0x10f)+'\x20'+_0x25e54f+'\x20'+'</tbody>'+_0x15ad63(0x1a4)+_0x15ad63(0x199)+'<strong>\x20Regards\x20</strong>'+_0x15ad63(0x162)+_0x513c33[0x0][_0x15ad63(0x120)]+'</h5>'+_0x15ad63(0x101)+'</div>'+_0x15ad63(0x195)};_0x127e53['sendMail'](_0x34e02a,function(_0x58e702,_0x186def){var _0x3bf53b=_0x15ad63;_0x58e702?(console[_0x3bf53b(0xea)](_0x58e702),console[_0x3bf53b(0xea)](_0x3bf53b(0x17d))):console['log'](_0x3bf53b(0x12b));}),_0x15daa8[_0x15ad63(0x15a)]('success',_0x15ad63(0x130)),_0x4804c7[_0x15ad63(0xe9)](_0x15ad63(0xe6)+_0x2a1f4f['_id']);}catch(_0x4d03a5){console['error'](_0x4d03a5),_0x4804c7[_0x15ad63(0x10b)](0x1f4)[_0x15ad63(0xe1)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x43f59d=>{var _0x339c12=_0x102032;console[_0x339c12(0x181)](_0x43f59d),_0x4804c7['status'](0x1f4)[_0x339c12(0xe1)]({'error':_0x339c12(0x12c)});});}catch(_0x4b29b4){console[_0x102032(0x181)](_0x4b29b4),_0x4804c7[_0x102032(0x10b)](0x1f4)[_0x102032(0xe1)]({'error':_0x102032(0x16e)});}})['catch'](_0x426c=>{var _0x2139fe=_0xf328c3;console[_0x2139fe(0x181)](_0x426c),_0x4804c7[_0x2139fe(0x10b)](0x1f4)[_0x2139fe(0xe1)]({'error':_0x2139fe(0x12c)});});}catch(_0xd52bbc){_0x4804c7[_0xf328c3(0xe1)]({'message':_0xd52bbc[_0xf328c3(0x140)]});}});function BayBinSelected(_0x344ecc,_0x5ee6be){var _0x6e0bf5=a0_0x344258,_0x3ab409=[];let _0x1ce49b=[];var _0x76ede8=[];if(_0x344ecc==_0x6e0bf5(0x137)){switch(_0x5ee6be){case _0x6e0bf5(0x1a3):_0x3ab409=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x6e0bf5(0xd2):_0x3ab409=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x76ede8=['DG'];}else{if(_0x344ecc==_0x6e0bf5(0xf1)){switch(_0x5ee6be){case'Rack\x201':_0x3ab409=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x6e0bf5(0xd2):_0x3ab409=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x76ede8=['FG'];}}return{'levels':_0x3ab409,'identify':_0x76ede8};}router[a0_0x344258(0x18b)]('/view/:id',auth,async(_0xaa2836,_0x3a6eab)=>{var _0x19bdfc=a0_0x344258;try{const {username:_0x2c479e,email:_0xd73366,role:_0x2985a6}=_0xaa2836[_0x19bdfc(0x193)],_0x160273=_0xaa2836['user'],_0x5a42a2=await profile[_0x19bdfc(0xcb)]({'email':_0x160273[_0x19bdfc(0x141)]}),_0x580c5a=await master_shop[_0x19bdfc(0x164)](),_0x4371ce=await transfers_finished['findById'](_0xaa2836['params']['id']);let _0x23bfe5=new Date(_0x4371ce[_0x19bdfc(0x154)]),_0x308a59=('0'+_0x23bfe5[_0x19bdfc(0xf6)]())[_0x19bdfc(0xc9)](-0x2),_0xb64663=('0'+(_0x23bfe5[_0x19bdfc(0x18e)]()+0x1))['slice'](-0x2),_0x59510d=_0x23bfe5['getFullYear'](),_0x5a2153=_0x59510d+'-'+_0xb64663+'-'+_0x308a59,_0x19cd81;if(_0x160273[_0x19bdfc(0x19b)]=='staff'){const _0x221f6c=await staff['findOne']({'email':_0x160273['email']});_0x19cd81=await warehouse[_0x19bdfc(0x164)]({'status':_0x19bdfc(0x14c),'name':_0x221f6c[_0x19bdfc(0x148)],'warehouse_category':_0x19bdfc(0x119)});}else _0x19cd81=await warehouse[_0x19bdfc(0x164)]({'status':_0x19bdfc(0x14c),'warehouse_category':'Finished\x20Goods'});const _0x1fffd9=await warehouse[_0x19bdfc(0x19a)]([{'$match':{'name':_0x4371ce[_0x19bdfc(0x144)],'room':_0x4371ce['from_room']}},{'$unwind':_0x19bdfc(0x17f)},{'$group':{'_id':_0x19bdfc(0x14a),'name':{'$first':_0x19bdfc(0x129)},'product_stock':{'$first':_0x19bdfc(0x123)},'bay':{'$first':_0x19bdfc(0x147)},'bin':{'$first':_0x19bdfc(0xe3)},'type':{'$first':_0x19bdfc(0x159)},'floorlevel':{'$first':_0x19bdfc(0x167)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x19bdfc(0x11e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x19bdfc(0x13a)},'rack':{'$first':'$product_details.rack'}}}]);var _0x5d9f7a=[0x1,0x2,0x3,0x4],_0x1da3dd=['A','B','C','D','E','F','G','H','I','J'],_0x53b61b=[_0x19bdfc(0xc7),'Enclosed'];const _0x1a0fb4=await product['find']({}),_0x5c5e21=BayBinSelected(_0x4371ce[_0x19bdfc(0xd5)],_0x4371ce[_0x19bdfc(0x115)]);if(_0x580c5a[0x0][_0x19bdfc(0xd7)]=='English\x20(US)'){var _0x5d68cd=users[_0x19bdfc(0xc6)];console[_0x19bdfc(0xea)](_0x5d68cd);}else{if(_0x580c5a[0x0]['language']==_0x19bdfc(0x19f))var _0x5d68cd=users[_0x19bdfc(0x19f)];else{if(_0x580c5a[0x0][_0x19bdfc(0xd7)]=='German')var _0x5d68cd=users[_0x19bdfc(0x197)];else{if(_0x580c5a[0x0][_0x19bdfc(0xd7)]==_0x19bdfc(0x12a))var _0x5d68cd=users[_0x19bdfc(0x12a)];else{if(_0x580c5a[0x0]['language']==_0x19bdfc(0x12e))var _0x5d68cd=users[_0x19bdfc(0x12e)];else{if(_0x580c5a[0x0][_0x19bdfc(0xd7)]==_0x19bdfc(0xfc))var _0x5d68cd=users['Portuguese'];else{if(_0x580c5a[0x0][_0x19bdfc(0xd7)]==_0x19bdfc(0xf5))var _0x5d68cd=users[_0x19bdfc(0xf5)];else{if(_0x580c5a[0x0][_0x19bdfc(0xd7)]==_0x19bdfc(0x125))var _0x5d68cd=users[_0x19bdfc(0x156)];}}}}}}}_0x3a6eab[_0x19bdfc(0x158)](_0x19bdfc(0x103),{'success':_0xaa2836[_0x19bdfc(0x15a)](_0x19bdfc(0x14e)),'errors':_0xaa2836['flash'](_0x19bdfc(0xf2)),'role':_0x160273,'profile':_0x5a42a2,'master_shop':_0x580c5a,'warehouse':_0x19cd81,'transfer':_0x4371ce,'stock':_0x1fffd9,'unit':_0x1a0fb4,'language':_0x5d68cd,'levels':_0x5d9f7a,'Isle':_0x1da3dd,'rooms_data':_0x53b61b,'ed_fullDate':_0x5a2153,'dataSelected':_0x5c5e21});}catch(_0x1e469c){console[_0x19bdfc(0xea)](_0x1e469c);}}),router[a0_0x344258(0x15b)](a0_0x344258(0x170),auth,async(_0x5a7729,_0x4e4a7d)=>{var _0x2d79fe=a0_0x344258;try{const _0x75fc1c=_0x5a7729[_0x2d79fe(0x150)]['id'];console[_0x2d79fe(0xea)](_0x5a7729[_0x2d79fe(0xd0)]);const _0xf67f6b=await transfers_finished[_0x2d79fe(0xed)](_0x75fc1c);console[_0x2d79fe(0xea)]('transfer_data',_0xf67f6b);const {date:_0x2c1887,from_warehouse:_0x12259c,FromRoom_name:_0x231d56,to_warehouse:_0x1b5d42,ToRoom_name:_0xfdfbd7,prod_name:_0x4634dd,from_prod_qty:_0x3c0541,from_prod_level:_0x47df3d,from_prod_isle:_0x563f22,from_prod_pallet:_0xb5391f,to_prod_qty:_0xe82aa5,to_prod_level:_0x18a5f2,to_prod_isle:_0x50b3a9,to_prod_pallet:_0x448a84,primary_code:_0x306d76,secondary_code:_0x3c4708,product_code3:_0x5b6a86,note:_0x34bac0,invoice:_0x193c80,expiry_date:_0x567fcd}=_0x5a7729['body'];if(typeof _0x4634dd==_0x2d79fe(0x11c))var _0x1c3803=[_0x5a7729['body'][_0x2d79fe(0x19d)]],_0xf22f25=[_0x5a7729['body']['from_prod_qty']],_0x244851=[_0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0xd6)]],_0x390f1c=[_0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0xfd)]],_0xe13b92=[_0x5a7729['body'][_0x2d79fe(0x134)]],_0x36c203=[_0x5a7729['body'][_0x2d79fe(0x182)]],_0x5a816d=[_0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0xca)]],_0x1dc3a1=[_0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0x122)]],_0xfbb11d=[_0x5a7729[_0x2d79fe(0xd0)]['MaxStocks_data2']],_0x2a46a1=[_0x5a7729['body']['unit']],_0x4cc89a=[_0x5a7729['body'][_0x2d79fe(0x15f)]],_0x23e49f=[_0x5a7729[_0x2d79fe(0xd0)]['batch_code']],_0x24931e=[_0x5a7729[_0x2d79fe(0xd0)]['expiry_date']];else var _0x1c3803=[..._0x5a7729['body'][_0x2d79fe(0x19d)]],_0xf22f25=[..._0x5a7729[_0x2d79fe(0xd0)]['from_prod_qty']],_0x244851=[..._0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0xd6)]],_0x390f1c=[..._0x5a7729['body'][_0x2d79fe(0xfd)]],_0xe13b92=[..._0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0x134)]],_0x36c203=[..._0x5a7729['body'][_0x2d79fe(0x182)]],_0x5a816d=[..._0x5a7729['body'][_0x2d79fe(0xca)]],_0x1dc3a1=[..._0x5a7729['body'][_0x2d79fe(0x122)]],_0xfbb11d=[..._0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0x178)]],_0x2a46a1=[..._0x5a7729['body'][_0x2d79fe(0x190)]],_0x4cc89a=[..._0x5a7729['body'][_0x2d79fe(0x15f)]],_0x23e49f=[..._0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0xfa)]],_0x24931e=[..._0x5a7729[_0x2d79fe(0xd0)][_0x2d79fe(0x154)]];const _0x122d4d=_0x1c3803[_0x2d79fe(0xec)](_0x4a4d2b=>{return _0x4a4d2b={'product_name':_0x4a4d2b};});_0xf22f25[_0x2d79fe(0x13f)]((_0xeb08c3,_0x32adc8)=>{_0x122d4d[_0x32adc8]['from_quantity']=_0xeb08c3;}),_0x244851[_0x2d79fe(0x13f)]((_0x130368,_0x264e07)=>{_0x122d4d[_0x264e07]['from_bay']=_0x130368;}),_0x390f1c[_0x2d79fe(0x13f)]((_0x33fd32,_0x1a746e)=>{var _0x38d0e3=_0x2d79fe;_0x122d4d[_0x1a746e][_0x38d0e3(0x118)]=_0x33fd32;}),_0xe13b92[_0x2d79fe(0x13f)]((_0x4070b8,_0x9de84f)=>{var _0xce2757=_0x2d79fe;_0x122d4d[_0x9de84f][_0xce2757(0x14b)]=_0x4070b8;}),_0x36c203[_0x2d79fe(0x13f)]((_0x2350df,_0x2f7e5a)=>{var _0x218d15=_0x2d79fe;_0x122d4d[_0x2f7e5a][_0x218d15(0x182)]=_0x2350df;}),_0x5a816d['forEach']((_0x556504,_0x5abba6)=>{var _0x1f1c98=_0x2d79fe;_0x122d4d[_0x5abba6][_0x1f1c98(0xca)]=_0x556504;}),_0x1dc3a1[_0x2d79fe(0x13f)]((_0x4d87aa,_0x44464d)=>{var _0xe5535e=_0x2d79fe;_0x122d4d[_0x44464d][_0xe5535e(0x110)]=_0x4d87aa;}),_0xfbb11d[_0x2d79fe(0x13f)]((_0x226b32,_0x5b042f)=>{var _0x29e698=_0x2d79fe;_0x122d4d[_0x5b042f][_0x29e698(0x161)]=_0x226b32;}),_0x2a46a1[_0x2d79fe(0x13f)]((_0x5050e6,_0x6a5030)=>{var _0x583783=_0x2d79fe;_0x122d4d[_0x6a5030][_0x583783(0x190)]=_0x5050e6;}),_0x4cc89a['forEach']((_0x22ca2b,_0x492a6f)=>{var _0x3c7146=_0x2d79fe;_0x122d4d[_0x492a6f][_0x3c7146(0x15f)]=_0x22ca2b;}),_0x23e49f[_0x2d79fe(0x13f)]((_0x2c80de,_0x64d02)=>{var _0x496c23=_0x2d79fe;_0x122d4d[_0x64d02][_0x496c23(0xfa)]=_0x2c80de;}),_0x24931e[_0x2d79fe(0x13f)]((_0x316577,_0xe6b494)=>{_0x122d4d[_0xe6b494]['expiry_date']=_0x316577;});const _0x5d65a7=_0x122d4d[_0x2d79fe(0xcf)](_0x30bd68=>_0x30bd68[_0x2d79fe(0x118)]!=='0'&&_0x30bd68[_0x2d79fe(0x118)]!==''||_0x30bd68[_0x2d79fe(0x108)]!=='0'&&_0x30bd68[_0x2d79fe(0x108)]!=='');var _0x4507cd=0x0;_0x5d65a7['forEach'](_0x31099a=>{var _0x4fc4fe=_0x2d79fe;parseInt(_0x31099a[_0x4fc4fe(0x11b)])<parseInt(_0x31099a['to_quantity'])&&_0x4507cd++;});if(_0x4507cd!=0x0)return _0x5a7729[_0x2d79fe(0x15a)](_0x2d79fe(0xf2),_0x2d79fe(0x165)),_0x4e4a7d[_0x2d79fe(0xe9)]('back');const _0x51a452=await warehouse[_0x2d79fe(0xcb)]({'name':_0xf67f6b[_0x2d79fe(0x144)],'room':_0xf67f6b[_0x2d79fe(0xe2)]});_0xf67f6b[_0x2d79fe(0xde)][_0x2d79fe(0x13f)](_0x64269f=>{var _0x26df92=_0x2d79fe;if(_0x64269f[_0x26df92(0x118)]>0x0){const _0x270678=_0x51a452['product_details'][_0x26df92(0xec)](_0xff4354=>{var _0xdac78c=_0x26df92;_0xff4354[_0xdac78c(0xe8)]==_0x64269f[_0xdac78c(0xe8)]&&_0xff4354[_0xdac78c(0xd9)]==_0x64269f[_0xdac78c(0x113)]&&(_0xff4354['product_stock']=parseInt(_0xff4354['product_stock'])+parseInt(_0x64269f['to_quantity']));});}}),await _0x51a452[_0x2d79fe(0x133)]();const _0x5a11ed=await warehouse[_0x2d79fe(0xcb)]({'name':_0xf67f6b[_0x2d79fe(0xd5)],'room':_0xf67f6b[_0x2d79fe(0x115)]});_0xf67f6b['product']['forEach'](_0x15dacf=>{var _0x5d3230=_0x2d79fe;if(_0x15dacf[_0x5d3230(0x118)]>0x0){const _0x2054c9=_0x5a11ed[_0x5d3230(0xf0)][_0x5d3230(0xec)](_0x4ca530=>{var _0x397625=_0x5d3230;_0x4ca530[_0x397625(0xe8)]==_0x15dacf[_0x397625(0xe8)]&&_0x4ca530[_0x397625(0xd9)]==_0x15dacf[_0x397625(0x14b)]&&(_0x4ca530[_0x397625(0x174)]=parseInt(_0x4ca530[_0x397625(0x174)])-parseInt(_0x15dacf[_0x397625(0x118)]));});}}),await _0x5a11ed[_0x2d79fe(0x133)](),_0xf67f6b[_0x2d79fe(0x1a2)]=_0x2c1887,_0xf67f6b[_0x2d79fe(0x144)]=_0x12259c,_0xf67f6b[_0x2d79fe(0xd5)]=_0x1b5d42,_0xf67f6b[_0x2d79fe(0xde)]=_0x5d65a7,_0xf67f6b[_0x2d79fe(0x19c)]=_0x34bac0,_0xf67f6b[_0x2d79fe(0x100)]=_0x193c80;const _0x1843d2=await _0xf67f6b[_0x2d79fe(0x133)](),_0x3d840f=await warehouse['findOne']({'name':_0x12259c,'room':_0x231d56});_0x1843d2['product'][_0x2d79fe(0x13f)](_0xdc135f=>{var _0x4e3389=_0x2d79fe;if(_0xdc135f[_0x4e3389(0x118)]>0x0){const _0x5cdbe4=_0x3d840f['product_details'][_0x4e3389(0xec)](_0x555da9=>{var _0x4ec460=_0x4e3389;_0x555da9[_0x4ec460(0xe8)]==_0xdc135f[_0x4ec460(0xe8)]&&_0x555da9['bay']==_0xdc135f[_0x4ec460(0x113)]&&(_0x555da9['product_stock']=parseInt(_0x555da9[_0x4ec460(0x174)])-parseInt(_0xdc135f[_0x4ec460(0x118)]));});}}),await _0x3d840f[_0x2d79fe(0x133)]();const _0x150c21=await warehouse['findOne']({'name':_0x1b5d42,'room':_0xfdfbd7});_0x1843d2['product']['forEach'](_0xcb8afa=>{var _0x49c72c=_0x2d79fe;if(_0xcb8afa[_0x49c72c(0x118)]>0x0){var _0x58cc6f=0x0;const _0x712058=_0x150c21[_0x49c72c(0xf0)][_0x49c72c(0xec)](_0x223bf5=>{var _0x42e2a6=_0x49c72c;_0x223bf5[_0x42e2a6(0xe8)]==_0xcb8afa[_0x42e2a6(0xe8)]&&_0x223bf5[_0x42e2a6(0xd9)]==_0xcb8afa[_0x42e2a6(0x14b)]&&(_0x223bf5[_0x42e2a6(0x174)]=parseInt(_0x223bf5['product_stock'])+parseInt(_0xcb8afa[_0x42e2a6(0x118)]),_0x58cc6f++);});_0x58cc6f=='0'&&(_0x150c21[_0x49c72c(0xf0)]=_0x150c21[_0x49c72c(0xf0)][_0x49c72c(0x10c)]({'product_name':_0xcb8afa[_0x49c72c(0xe8)],'product_stock':_0xcb8afa[_0x49c72c(0x118)],'bay':_0xcb8afa[_0x49c72c(0x14b)],'product_code':_0xcb8afa[_0x49c72c(0x110)],'primary_code':_0xcb8afa['primary_code'],'secondary_code':_0xcb8afa[_0x49c72c(0xca)],'maxProducts':_0xcb8afa[_0x49c72c(0x161)]}));}}),await _0x150c21[_0x2d79fe(0x133)](),_0x5a7729['flash']('success',_0x2d79fe(0xdb)),_0x4e4a7d[_0x2d79fe(0xe9)](_0x2d79fe(0x184));}catch(_0x4c6264){console[_0x2d79fe(0xea)](_0x4c6264);}}),router['post'](a0_0x344258(0x131),async(_0x3452f3,_0x3d5db3)=>{var _0x2fce56=a0_0x344258;const {FromWareHouse:_0x2460e1,FromRoom:_0x3714e9,ToWarehouse:_0x180555,ToRoom:_0x1290cd,primary_code:_0x77e74,Roomslist:_0x3e1242}=_0x3452f3[_0x2fce56(0xd0)],_0x3bede7=_0x3e1242[_0x2fce56(0x13d)](','),_0x4c6d72=[];async function _0x3a8dbd(_0x2f7b0b){var _0x2dff26=_0x2fce56;const _0x5134f3=await warehouse['aggregate']([{'$match':{'name':_0x2460e1,'room':_0x2f7b0b}},{'$unwind':_0x2dff26(0x17f)},{'$match':{'product_details.primary_code':_0x77e74}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x2dff26(0x123)},'primary_code':{'$first':_0x2dff26(0x11d)},'secondary_code':{'$first':_0x2dff26(0x11e)},'product_code':{'$first':_0x2dff26(0x175)},'level':{'$first':_0x2dff26(0x147)},'isle':{'$first':_0x2dff26(0xe3)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2dff26(0x167)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2dff26(0xdd)},'storage':{'$first':_0x2dff26(0x13a)},'rack':{'$first':_0x2dff26(0xf8)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2dff26(0x107)},'batch_code':{'$first':_0x2dff26(0xda)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x2dff26(0x16f)}}}]),_0x24b324=await warehouse[_0x2dff26(0x19a)]([{'$match':{'name':_0x2460e1,'room':_0x2f7b0b}},{'$unwind':_0x2dff26(0x17f)},{'$match':{'product_details.secondary_code':_0x77e74}},{'$group':{'_id':_0x2dff26(0x14a),'name':{'$first':_0x2dff26(0x129)},'instock':{'$first':_0x2dff26(0x123)},'primary_code':{'$first':_0x2dff26(0x11d)},'secondary_code':{'$first':_0x2dff26(0x11e)},'product_code':{'$first':_0x2dff26(0x175)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2dff26(0x159)},'pallet':{'$first':_0x2dff26(0x167)},'unit':{'$first':_0x2dff26(0x13c)},'secondary_unit':{'$first':_0x2dff26(0xdd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2dff26(0x1a0)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x2dff26(0xf3)},'roomNamed':{'$first':_0x2dff26(0x1a7)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x5134f3[_0x2dff26(0x185)]>0x0)_0x4c6d72['push'](_0x5134f3);else _0x24b324[_0x2dff26(0x185)]>0x0&&_0x4c6d72[_0x2dff26(0x102)](_0x24b324);}const _0x4c7136=_0x3bede7[_0x2fce56(0xec)](_0x478ae2=>_0x3a8dbd(_0x478ae2));await Promise['all'](_0x4c7136),_0x3d5db3[_0x2fce56(0xe1)](_0x4c6d72);}),router[a0_0x344258(0x15b)](a0_0x344258(0x152),async(_0x466b8a,_0x5aadb5)=>{var _0x13d569=a0_0x344258;try{const {FromWareHouse:_0x34d20b,FromRoom:_0x5d0758,ToWarehouse:_0x12abd2,ToRoom:_0x1737f8,secondary_code:_0x596383}=_0x466b8a[_0x13d569(0xd0)],_0x493042=await warehouse['aggregate']([{'$match':{'name':_0x34d20b}},{'$unwind':_0x13d569(0x17f)},{'$match':{'product_details.secondary_code':_0x596383}},{'$group':{'_id':_0x13d569(0x14a),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x13d569(0x11d)},'secondary_code':{'$first':_0x13d569(0x11e)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x13d569(0x123)},'warehouse':{'$first':_0x13d569(0xe0)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x13d569(0x132)},'pallet':{'$first':_0x13d569(0x18f)},'maxProducts':{'$first':_0x13d569(0x104)},'unit':{'$first':_0x13d569(0x13c)},'expiry_date':{'$first':_0x13d569(0x1a0)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x5aadb5[_0x13d569(0x10b)](0xc8)[_0x13d569(0xe1)](_0x493042);}catch(_0x198f4d){_0x5aadb5[_0x13d569(0x10b)](0x194)['json']({'message':_0x198f4d[_0x13d569(0x140)]});}}),router[a0_0x344258(0x15b)](a0_0x344258(0x12f),async(_0x3dedc7,_0x375ebc)=>{var _0x126c61=a0_0x344258;try{const {FromWareHouse:_0x1d0cb9,FromRoom:_0x4c70eb,ToWarehouse:_0x183ada,ToRoom:_0x23b58d,product_code:_0x40525f}=_0x3dedc7[_0x126c61(0xd0)],_0x44098d=await warehouse['aggregate']([{'$match':{'name':_0x1d0cb9}},{'$unwind':_0x126c61(0x17f)},{'$match':{'product_details.product_code':_0x40525f}},{'$group':{'_id':_0x126c61(0x14a),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x126c61(0x11d)},'secondary_code':{'$first':_0x126c61(0x11e)},'product_code':{'$first':_0x126c61(0x175)},'instock':{'$first':_0x126c61(0x123)},'warehouse':{'$first':_0x126c61(0xe0)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x126c61(0x132)},'pallet':{'$first':_0x126c61(0x18f)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x126c61(0x13c)}}}]);_0x375ebc[_0x126c61(0x10b)](0xc8)[_0x126c61(0xe1)](_0x44098d);}catch(_0x105804){_0x375ebc[_0x126c61(0x10b)](0x194)[_0x126c61(0xe1)]({'message':_0x105804['message']});}}),router[a0_0x344258(0x15b)](a0_0x344258(0x168),async(_0x36ee33,_0x325b45)=>{var _0x2d2001=a0_0x344258;const {productCode:_0x2b1878,bay:_0x5f1201,warehouses:_0x2eec03,room:_0x46ec4f}=_0x36ee33['body'];console[_0x2d2001(0xea)](_0x36ee33[_0x2d2001(0xd0)]);try{const _0x206f44=await warehouse['aggregate']([{'$match':{'name':_0x2eec03,'room':_0x46ec4f}},{'$unwind':_0x2d2001(0x17f)},{'$match':{'product_details.bay':parseInt(_0x5f1201)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2d2001(0x129)},'product_stock':{'$first':_0x2d2001(0x123)},'bay':{'$first':_0x2d2001(0x147)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x325b45[_0x2d2001(0x10b)](0xc8)['json'](_0x206f44);}catch(_0x4ad14f){_0x325b45[_0x2d2001(0x10b)](0x194)['json']({'message':_0x4ad14f['message']});}}),module[a0_0x344258(0x127)]=router;