var a0_0x27acc5=a0_0x4187;(function(_0x407dc0,_0x4e5817){var _0xd2f099=a0_0x4187,_0x15b91b=_0x407dc0();while(!![]){try{var _0x49438b=-parseInt(_0xd2f099(0x23d))/0x1*(-parseInt(_0xd2f099(0x186))/0x2)+parseInt(_0xd2f099(0x1a5))/0x3*(-parseInt(_0xd2f099(0x1d7))/0x4)+-parseInt(_0xd2f099(0x22e))/0x5*(parseInt(_0xd2f099(0x1e3))/0x6)+-parseInt(_0xd2f099(0x24f))/0x7+-parseInt(_0xd2f099(0x18a))/0x8+parseInt(_0xd2f099(0x192))/0x9*(-parseInt(_0xd2f099(0x17e))/0xa)+parseInt(_0xd2f099(0x225))/0xb;if(_0x49438b===_0x4e5817)break;else _0x15b91b['push'](_0x15b91b['shift']());}catch(_0x3846c6){_0x15b91b['push'](_0x15b91b['shift']());}}}(a0_0x4f81,0xdfbf5));const express=require(a0_0x27acc5(0x1a9)),app=express(),router=express[a0_0x27acc5(0x243)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x27acc5(0x1e8)),auth=require(a0_0x27acc5(0x224)),users=require(a0_0x27acc5(0x23a)),nodemailer=require('nodemailer');function a0_0x4187(_0x1818d7,_0x65b50b){var _0x4f8141=a0_0x4f81();return a0_0x4187=function(_0x4187c9,_0x59ffb6){_0x4187c9=_0x4187c9-0x16d;var _0xdf95e8=_0x4f8141[_0x4187c9];return _0xdf95e8;},a0_0x4187(_0x1818d7,_0x65b50b);}function a0_0x4f81(){var _0x3e992a=['role','<span\x20style=\x22float:\x20right;\x22>','</table>','Rack\x201','maxPerUnit','error','log','user','prod_cat','bay','getDate','to_room','<tr>','product_name','$product_details.invoice','to_warehouse','success','findById','An\x20error\x20occurred.','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/barcode_scanner2','$_id','get','add_transfer_finished','\x20<>\x20','password','aggregate','New_Qty_Converted','$product_details.bin','$product_details.bay','slice','from_quantity','</td>','$product_details.rack','to_invoice','14272HCNQIu','random','warehouse','getMonth','DRY\x20GOODS','$product_details.type','errors','German','$product_details.unit','to_quantity','French','product','503538msdLEC','json','finalize','True','$product_details.primary_code','../models/all_models','MaxStocks_data2','/barcode_scanner3','Portuguese\x20(BR)','<!DOCTYPE\x20html>','post','toString','$product_details','</div>','email','Spanish','product_details','batch_code','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','to_bay','Transfer\x20Finalize\x20Successfully','then','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','from_prod_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','findOne','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view/:id','to_prod_level','$product_details.production_date','MaxStocks_data','$to_warehouse','Transfer\x20Edit\x20Successfully','QA\x20Warehouse','render','$finalize','_id','staff','abs','\x20<=>\x20','status','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</span>','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.secondary_code','from_warehouse','$room','/transfer/view','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','string','logo','$product_details.product_name','prod_name','from_prod_level','$product_details.expiry_date','</body></html>','RoomAssigned','getFullYear','FGSEmail','<hr\x20class=\x22my-3\x22>','/../public','../middleware/auth','59857930YHumyf','/transfer_finished/preview/','product_code','$product_details.maxProducts','invoice','save','Portuguese','production_date','sendMail','70GLNVPr','/upload/','$product_details.maxPerUnit','forEach','exports','$product_details.storage','secondary_unit','padStart','site_title','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../public/language/languages.json','to_prod_qty','English','280883OVjnjK','unit','from_invoice','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','body','Router','English\x20(US)','Arabic','map','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','push','/preview/:id','length','floor','from_bay','flash','$product_details.secondary_unit','6205080HCvnTa','There\x27s\x20a\x20error\x20in\x20this\x20transaction','id_transaction','redirect','Arabic\x20(ae)','product_code3','<div>','maxProducts','find','TRFF-','primary_code','Logo.png','params','$product_details._id','Chinese','</head><body>','expiry_date','back','</tbody>','480OXbFOI','ToRoomAssigned','Finished\x20Goods','from_room_name','$product_details.pallet','To_invoice','FROZEN\x20GOODS','/CheckingWarehouse','2yJpfwF','secondary_code','here2','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','12208592HRlczz','/view/add_transfer','max','Rack\x202','<h2>\x20','<html><head><title></title>','<strong>\x20Regards\x20</strong>','message','108738mzgsPE','to_room_name','Hindi','image','from_room','$product_details.product_stock','Error\x20Occurs','primary_unit','<tbody\x20style=\x22text-align:\x20center;\x22>','port','catch','all','$product_details.batch_code','updateOne','to_floorlevel','edit_transfer_finished_view','Email\x20sent\x20successfully','$product_details.level','createTransport','537MoiWBA','$product_details.floorlevel','</tr>','filter','express','/barcode_scanner','date','product_stock','Enabled','concat','Ambient','$product_details.isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','edit_transfer_finished','product_date'];a0_0x4f81=function(){return _0x3e992a;};return a0_0x4f81();}router[a0_0x27acc5(0x1ca)]('/view',auth,async(_0x40e225,_0x34a147)=>{var _0x5c34c2=a0_0x27acc5;try{const {username:_0x2e8c75,email:_0x472251,role:_0xdd5ac4}=_0x40e225[_0x5c34c2(0x1bb)],_0x1f5542=_0x40e225[_0x5c34c2(0x1bb)],_0x489935=await profile['findOne']({'email':_0x1f5542[_0x5c34c2(0x1f1)]}),_0x19a241=await master_shop[_0x5c34c2(0x173)]();let _0x43616a;if(_0x1f5542['role']==_0x5c34c2(0x20a)){const _0x221a02=await staff[_0x5c34c2(0x1fd)]({'email':_0x1f5542[_0x5c34c2(0x1f1)]});_0x43616a=await transfers_finished['find']({'from_warehouse':_0x221a02['warehouse']});}else _0x43616a=await transfers_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x5c34c2(0x1c9),'invoice':{'$first':_0x5c34c2(0x210)},'date':{'$first':'$date'},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x5c34c2(0x204)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x5c34c2(0x208)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x19a241[0x0][_0x5c34c2(0x1fe)]==_0x5c34c2(0x244))var _0x15b6c4=users[_0x5c34c2(0x23c)];else{if(_0x19a241[0x0]['language']==_0x5c34c2(0x194))var _0x15b6c4=users[_0x5c34c2(0x194)];else{if(_0x19a241[0x0][_0x5c34c2(0x1fe)]==_0x5c34c2(0x1de))var _0x15b6c4=users[_0x5c34c2(0x1de)];else{if(_0x19a241[0x0][_0x5c34c2(0x1fe)]==_0x5c34c2(0x1f2))var _0x15b6c4=users[_0x5c34c2(0x1f2)];else{if(_0x19a241[0x0][_0x5c34c2(0x1fe)]=='French')var _0x15b6c4=users['French'];else{if(_0x19a241[0x0][_0x5c34c2(0x1fe)]==_0x5c34c2(0x1eb))var _0x15b6c4=users[_0x5c34c2(0x22b)];else{if(_0x19a241[0x0][_0x5c34c2(0x1fe)]=='Chinese')var _0x15b6c4=users[_0x5c34c2(0x179)];else{if(_0x19a241[0x0][_0x5c34c2(0x1fe)]==_0x5c34c2(0x16f))var _0x15b6c4=users[_0x5c34c2(0x245)];}}}}}}}_0x34a147[_0x5c34c2(0x207)]('transfer_finished',{'success':_0x40e225[_0x5c34c2(0x24d)]('success'),'errors':_0x40e225[_0x5c34c2(0x24d)](_0x5c34c2(0x1dd)),'role':_0x1f5542,'profile':_0x489935,'master_shop':_0x19a241,'transfer':_0x43616a,'language':_0x15b6c4});}catch(_0x12d433){console[_0x5c34c2(0x1ba)](_0x12d433);}});async function getRandom8DigitNumber(){var _0x13d714=a0_0x27acc5;const _0x1ed339=0x989680,_0x14a55f=0x5f5e0ff,_0xb34dd9=Math[_0x13d714(0x24b)](Math[_0x13d714(0x1d8)]()*(_0x14a55f-_0x1ed339+0x1))+_0x1ed339;var _0x439099;const _0x3ce481=await transfers_finished['findOne']({'invoice':'TRFF-'+_0xb34dd9});return _0x3ce481&&_0x3ce481['length']>0x0?_0x439099=_0x13d714(0x174)+_0xb34dd9:_0x439099=_0x13d714(0x174)+_0xb34dd9,_0x439099;}router[a0_0x27acc5(0x1ca)](a0_0x27acc5(0x18b),auth,async(_0x3b081d,_0x22a4a8)=>{var _0xa2b3fd=a0_0x27acc5;try{const {username:_0x48dedf,email:_0x1b4ba4,role:_0x2c9a45}=_0x3b081d[_0xa2b3fd(0x1bb)],_0x266801=_0x3b081d[_0xa2b3fd(0x1bb)],_0x1a360e=await profile[_0xa2b3fd(0x1fd)]({'email':_0x266801[_0xa2b3fd(0x1f1)]}),_0xea45e=await master_shop[_0xa2b3fd(0x173)]();let _0x6c3f36;if(_0x266801['role']==_0xa2b3fd(0x20a)){const _0x2d8957=await staff[_0xa2b3fd(0x1fd)]({'email':_0x266801['email']});_0x6c3f36=await warehouse[_0xa2b3fd(0x1ce)]([{'$match':{'status':_0xa2b3fd(0x1ad),'name':_0x2d8957[_0xa2b3fd(0x1d9)],'warehouse_category':_0xa2b3fd(0x180),'name':{'$ne':_0xa2b3fd(0x206)}}},{'$group':{'_id':_0xa2b3fd(0x240),'name':{'$first':_0xa2b3fd(0x240)}}}]);}else _0x6c3f36=await warehouse[_0xa2b3fd(0x1ce)]([{'$match':{'status':_0xa2b3fd(0x1ad),'warehouse_category':_0xa2b3fd(0x180),'name':{'$ne':_0xa2b3fd(0x206)}}},{'$group':{'_id':_0xa2b3fd(0x240),'name':{'$first':_0xa2b3fd(0x240)}}}]);const _0x47f658=await transfers_finished['find']({}),_0x1b8b1d=_0x47f658['length']+0x1,_0x2ed8dd='TRFF-'+_0x1b8b1d[_0xa2b3fd(0x1ee)]()[_0xa2b3fd(0x235)](0x5,'0');if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]==_0xa2b3fd(0x244))var _0x47d099=users[_0xa2b3fd(0x23c)];else{if(_0xea45e[0x0]['language']==_0xa2b3fd(0x194))var _0x47d099=users['Hindi'];else{if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]=='German')var _0x47d099=users[_0xa2b3fd(0x1de)];else{if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]==_0xa2b3fd(0x1f2))var _0x47d099=users['Spanish'];else{if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]==_0xa2b3fd(0x1e1))var _0x47d099=users[_0xa2b3fd(0x1e1)];else{if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]==_0xa2b3fd(0x1eb))var _0x47d099=users['Portuguese'];else{if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]=='Chinese')var _0x47d099=users[_0xa2b3fd(0x179)];else{if(_0xea45e[0x0][_0xa2b3fd(0x1fe)]==_0xa2b3fd(0x16f))var _0x47d099=users['Arabic'];}}}}}}}const _0x5d9a5b=getRandom8DigitNumber();_0x5d9a5b[_0xa2b3fd(0x1f9)](_0x575066=>{var _0x27479d=_0xa2b3fd;_0x22a4a8['render'](_0x27479d(0x1cb),{'success':_0x3b081d[_0x27479d(0x24d)](_0x27479d(0x1c4)),'errors':_0x3b081d['flash'](_0x27479d(0x1dd)),'role':_0x266801,'profile':_0x1a360e,'master_shop':_0xea45e,'warehouse':_0x6c3f36,'language':_0x47d099,'invoice':_0x575066});})[_0xa2b3fd(0x19c)](_0x3c84c3=>{var _0x40df3e=_0xa2b3fd;_0x3b081d[_0x40df3e(0x24d)]('errors',_0x40df3e(0x250)),_0x22a4a8[_0x40df3e(0x16e)](_0x40df3e(0x215));});}catch(_0x33b198){console['log'](_0x33b198);}}),router[a0_0x27acc5(0x1ed)](a0_0x27acc5(0x18b),auth,async(_0x4b9d5f,_0x4ea786)=>{var _0x1e7b3c=a0_0x27acc5;try{const {date:_0x3739c3,from_warehouse:_0x2c0d97,FromRoom_name:_0x4ede1c,to_warehouse:_0x5cda34,ToRoom_name:_0xf73eca,prod_name:_0x8e6ecb,from_prod_qty:_0x42f0dd,from_prod_level:_0x273016,from_prod_isle:_0xfa38a9,from_prod_pallet:_0x10964d,to_prod_qty:_0x22efe7,to_prod_level:_0x37bd73,to_prod_isle:_0x25aa15,to_prod_pallet:_0x39b7ee,primary_code:_0x49103f,secondary_code:_0x3e5740,product_code3:_0x767526,note:_0x5e4328,MaxStocks_data2:_0x5a641d,invoice:_0x131d6a,expiry_date:_0x156367}=_0x4b9d5f['body'];if(typeof _0x8e6ecb==_0x1e7b3c(0x218))var _0x56ea12=[_0x4b9d5f[_0x1e7b3c(0x242)]['prod_name']],_0x48f95a=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1fb)]],_0x5d194b=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x21c)]],_0x34a4c5=[_0x4b9d5f[_0x1e7b3c(0x242)]['New_Qty_Converted']],_0x5cae6e=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x201)]],_0x411222=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x175)]],_0x35419c=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x187)]],_0xb481c8=[_0x4b9d5f['body'][_0x1e7b3c(0x170)]],_0x37f76d=[_0x4b9d5f[_0x1e7b3c(0x242)]['MaxStocks_data2']],_0x5a837e=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x199)]],_0x53983d=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x234)]],_0x18e703=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1f4)]],_0x226a63=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x17b)]],_0x61e5f8=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1b3)]],_0x4040c2=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x203)]],_0x324d8a=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1b8)]],_0x4595ee=[_0x4b9d5f[_0x1e7b3c(0x242)]['prod_cat']],_0x1ec11b=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x21f)]],_0x18ba69=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x17f)]],_0x2cc683=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x23f)]],_0x38735=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1d6)]],_0x5b9b1f=[_0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x16d)]];else var _0x56ea12=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x21b)]],_0x48f95a=[..._0x4b9d5f[_0x1e7b3c(0x242)]['from_prod_qty']],_0x5d194b=[..._0x4b9d5f[_0x1e7b3c(0x242)]['from_prod_level']],_0x34a4c5=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1cf)]],_0x5cae6e=[..._0x4b9d5f['body'][_0x1e7b3c(0x201)]],_0x411222=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x175)]],_0x35419c=[..._0x4b9d5f['body'][_0x1e7b3c(0x187)]],_0xb481c8=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x170)]],_0x37f76d=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1e9)]],_0x5a837e=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x199)]],_0x53983d=[..._0x4b9d5f['body']['secondary_unit']],_0x18e703=[..._0x4b9d5f['body'][_0x1e7b3c(0x1f4)]],_0x226a63=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x17b)]],_0x61e5f8=[..._0x4b9d5f[_0x1e7b3c(0x242)]['product_date']],_0x4040c2=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x203)]],_0x324d8a=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1b8)]],_0x4595ee=[..._0x4b9d5f[_0x1e7b3c(0x242)][_0x1e7b3c(0x1bc)]],_0x1ec11b=[..._0x4b9d5f[_0x1e7b3c(0x242)]['RoomAssigned']],_0x18ba69=[..._0x4b9d5f[_0x1e7b3c(0x242)]['ToRoomAssigned']],_0x2cc683=[..._0x4b9d5f['body'][_0x1e7b3c(0x23f)]],_0x38735=[..._0x4b9d5f['body'][_0x1e7b3c(0x1d6)]],_0x5b9b1f=[..._0x4b9d5f['body']['id_transaction']];const _0x5d4733=_0x56ea12[_0x1e7b3c(0x246)](_0xf71d14=>{return _0xf71d14={'product_name':_0xf71d14};});_0x48f95a['forEach']((_0x589c49,_0x33eb93)=>{_0x5d4733[_0x33eb93]['from_quantity']=_0x589c49;}),_0x5d194b['forEach']((_0x2c0cbe,_0x2b20fa)=>{var _0x2f5c88=_0x1e7b3c;_0x5d4733[_0x2b20fa][_0x2f5c88(0x24c)]=_0x2c0cbe;}),_0x5b9b1f['forEach']((_0x39a56b,_0xfd7ee0)=>{var _0x2b988d=_0x1e7b3c;_0x5d4733[_0xfd7ee0][_0x2b988d(0x16d)]=_0x39a56b;}),_0x2cc683[_0x1e7b3c(0x231)]((_0x54ffb8,_0x419a59)=>{_0x5d4733[_0x419a59]['from_invoice']=_0x54ffb8;}),_0x38735[_0x1e7b3c(0x231)]((_0x38aa43,_0x20b9f1)=>{var _0x2e3fd6=_0x1e7b3c;_0x5d4733[_0x20b9f1][_0x2e3fd6(0x183)]=_0x38aa43;}),_0x34a4c5[_0x1e7b3c(0x231)]((_0x40d163,_0x4d49b1)=>{var _0x539989=_0x1e7b3c;_0x5d4733[_0x4d49b1][_0x539989(0x1e0)]=_0x40d163;}),_0x5cae6e[_0x1e7b3c(0x231)]((_0x2c1fba,_0x131b20)=>{var _0x344ad7=_0x1e7b3c;_0x5d4733[_0x131b20][_0x344ad7(0x1f7)]=_0x2c1fba;}),_0x411222['forEach']((_0x90b6ec,_0x1f6ad7)=>{var _0x254efc=_0x1e7b3c;_0x5d4733[_0x1f6ad7][_0x254efc(0x175)]=_0x90b6ec;}),_0x35419c['forEach']((_0x3d4ad7,_0x426b6a)=>{var _0x529e73=_0x1e7b3c;_0x5d4733[_0x426b6a][_0x529e73(0x187)]=_0x3d4ad7;}),_0xb481c8[_0x1e7b3c(0x231)]((_0x2dbcd5,_0x3d833)=>{var _0x2cebd5=_0x1e7b3c;_0x5d4733[_0x3d833][_0x2cebd5(0x227)]=_0x2dbcd5;}),_0x37f76d[_0x1e7b3c(0x231)]((_0x5a3ee3,_0x159102)=>{var _0x35aa03=_0x1e7b3c;_0x5d4733[_0x159102][_0x35aa03(0x172)]=_0x5a3ee3;}),_0x5a837e[_0x1e7b3c(0x231)]((_0x518790,_0x3bc928)=>{var _0x306a24=_0x1e7b3c;_0x5d4733[_0x3bc928][_0x306a24(0x23e)]=_0x518790;}),_0x53983d[_0x1e7b3c(0x231)]((_0x30c94f,_0x3e83ca)=>{var _0x1de29e=_0x1e7b3c;_0x5d4733[_0x3e83ca][_0x1de29e(0x234)]=_0x30c94f;}),_0x18e703[_0x1e7b3c(0x231)]((_0x3760e1,_0x209478)=>{var _0x452b57=_0x1e7b3c;_0x5d4733[_0x209478][_0x452b57(0x1f4)]=_0x3760e1;}),_0x226a63['forEach']((_0x16afc5,_0x2c395d)=>{var _0x36ff36=_0x1e7b3c;_0x5d4733[_0x2c395d][_0x36ff36(0x17b)]=_0x16afc5;}),_0x61e5f8[_0x1e7b3c(0x231)]((_0x16b916,_0x5ccb9c)=>{_0x5d4733[_0x5ccb9c]['production_date']=_0x16b916;}),_0x4040c2[_0x1e7b3c(0x231)]((_0x844bec,_0x33126c)=>{var _0x33abb1=_0x1e7b3c;_0x5d4733[_0x33126c][_0x33abb1(0x172)]=_0x844bec;}),_0x324d8a['forEach']((_0x142624,_0x1b2bfc)=>{var _0x1d5f46=_0x1e7b3c;_0x5d4733[_0x1b2bfc][_0x1d5f46(0x1b8)]=_0x142624;}),_0x4595ee[_0x1e7b3c(0x231)]((_0x4e92a1,_0xf6b628)=>{var _0x6681ed=_0x1e7b3c;_0x5d4733[_0xf6b628][_0x6681ed(0x1bc)]=_0x4e92a1;}),_0x1ec11b[_0x1e7b3c(0x231)]((_0xb021c6,_0x31b272)=>{var _0x188522=_0x1e7b3c;_0x5d4733[_0x31b272][_0x188522(0x181)]=_0xb021c6;}),_0x18ba69[_0x1e7b3c(0x231)]((_0x1484fe,_0x4041f7)=>{var _0x20e64a=_0x1e7b3c;_0x5d4733[_0x4041f7][_0x20e64a(0x193)]=_0x1484fe;});const _0x4f7e01=_0x5d4733[_0x1e7b3c(0x1a8)](_0x30bfe8=>_0x30bfe8[_0x1e7b3c(0x1e0)]!=='0'&&_0x30bfe8[_0x1e7b3c(0x1e0)]!==''||_0x30bfe8[_0x1e7b3c(0x1a0)]!=='0'&&_0x30bfe8['to_floorlevel']!=='');var _0x44abc7=0x0;_0x4f7e01['forEach'](_0x56249b=>{var _0x22cfb5=_0x1e7b3c;parseInt(_0x56249b[_0x22cfb5(0x1d3)])<parseInt(_0x56249b[_0x22cfb5(0x1e0)])&&_0x44abc7++;});if(_0x44abc7!=0x0)return _0x4b9d5f[_0x1e7b3c(0x24d)](_0x1e7b3c(0x1dd),_0x1e7b3c(0x1c7)),_0x4ea786[_0x1e7b3c(0x16e)](_0x1e7b3c(0x17c));const _0x36b653=new transfers_finished({'date':_0x3739c3,'from_warehouse':_0x2c0d97,'to_warehouse':_0x5cda34,'product':_0x4f7e01,'note':_0x5e4328,'invoice':_0x131d6a}),_0x1b6705=await _0x36b653['save']();_0x4b9d5f[_0x1e7b3c(0x24d)](_0x1e7b3c(0x1c4),'Product\x20Transfer\x20successfully'),_0x4ea786[_0x1e7b3c(0x16e)](_0x1e7b3c(0x226)+_0x1b6705[_0x1e7b3c(0x209)]);}catch(_0x59f434){console[_0x1e7b3c(0x1ba)](_0x59f434),_0x4ea786[_0x1e7b3c(0x20d)](0xc8)[_0x1e7b3c(0x1e4)]({'errorMessage':_0x59f434[_0x1e7b3c(0x191)]});}}),router[a0_0x27acc5(0x1ca)](a0_0x27acc5(0x249),auth,async(_0x33f0ca,_0x19817c)=>{var _0x18b373=a0_0x27acc5;try{const {username:_0x5dc580,email:_0x2af00f,role:_0x23ce48}=_0x33f0ca[_0x18b373(0x1bb)],_0x4c407f=_0x33f0ca[_0x18b373(0x1bb)],_0x347d12=await profile[_0x18b373(0x1fd)]({'email':_0x4c407f[_0x18b373(0x1f1)]}),_0x50a42c=await master_shop[_0x18b373(0x173)](),_0x15cf10=await transfers_finished[_0x18b373(0x1c5)](_0x33f0ca['params']['id']);let _0xd1f9a9;if(_0x4c407f[_0x18b373(0x1b4)]==_0x18b373(0x20a)){const _0x26575f=await staff[_0x18b373(0x1fd)]({'email':_0x4c407f[_0x18b373(0x1f1)]});_0xd1f9a9=await warehouse[_0x18b373(0x173)]({'status':'Enabled','name':_0x26575f[_0x18b373(0x1d9)],'warehouse_category':'Finished\x20Goods'});}else _0xd1f9a9=await warehouse['find']({'status':_0x18b373(0x1ad),'warehouse_category':'Finished\x20Goods'});const _0x19ae22=await warehouse[_0x18b373(0x1ce)]([{'$match':{'name':_0x15cf10[_0x18b373(0x213)],'warehouse_category':_0x18b373(0x180)}},{'$unwind':_0x18b373(0x1ef)},{'$group':{'_id':_0x18b373(0x178),'name':{'$first':_0x18b373(0x21a)},'product_stock':{'$first':_0x18b373(0x197)},'bay':{'$first':_0x18b373(0x1d1)},'bin':{'$first':_0x18b373(0x1d0)},'type':{'$first':_0x18b373(0x1dc)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x18b373(0x1e7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x18b373(0x1f5)},'storage':{'$first':_0x18b373(0x233)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x18b373(0x21d)},'production_date':{'$first':_0x18b373(0x202)},'room':{'$first':_0x18b373(0x214)},'warehoue_name':{'$first':'$name'}}}]),_0x3afba6=await product[_0x18b373(0x173)]({});if(_0x50a42c[0x0][_0x18b373(0x1fe)]=='English\x20(US)'){var _0x40753d=users[_0x18b373(0x23c)];console[_0x18b373(0x1ba)](_0x40753d);}else{if(_0x50a42c[0x0][_0x18b373(0x1fe)]=='Hindi')var _0x40753d=users['Hindi'];else{if(_0x50a42c[0x0][_0x18b373(0x1fe)]==_0x18b373(0x1de))var _0x40753d=users['German'];else{if(_0x50a42c[0x0][_0x18b373(0x1fe)]=='Spanish')var _0x40753d=users[_0x18b373(0x1f2)];else{if(_0x50a42c[0x0][_0x18b373(0x1fe)]==_0x18b373(0x1e1))var _0x40753d=users[_0x18b373(0x1e1)];else{if(_0x50a42c[0x0]['language']=='Portuguese\x20(BR)')var _0x40753d=users[_0x18b373(0x22b)];else{if(_0x50a42c[0x0][_0x18b373(0x1fe)]==_0x18b373(0x179))var _0x40753d=users[_0x18b373(0x179)];else{if(_0x50a42c[0x0]['language']==_0x18b373(0x16f))var _0x40753d=users['Arabic'];}}}}}}}_0x19817c[_0x18b373(0x207)](_0x18b373(0x1a1),{'success':_0x33f0ca[_0x18b373(0x24d)](_0x18b373(0x1c4)),'errors':_0x33f0ca[_0x18b373(0x24d)](_0x18b373(0x1dd)),'role':_0x4c407f,'profile':_0x347d12,'master_shop':_0x50a42c,'warehouse':_0xd1f9a9,'transfer':_0x15cf10,'stock':_0x19ae22,'unit':_0x3afba6,'language':_0x40753d});}catch(_0x994813){console['log'](_0x994813);}}),router['post'](a0_0x27acc5(0x249),auth,async(_0x27ee3a,_0x596fb6)=>{var _0x5f24fb=a0_0x27acc5;try{const {invoice:_0x4a7a21,from_warehouse:_0x274ff7,FromRoom_name:_0x581f47,to_warehouse:_0x3adb5d,ToRoom_name:_0x3a71c7}=_0x27ee3a[_0x5f24fb(0x242)],_0x493ce6=await transfers_finished[_0x5f24fb(0x1c5)](_0x27ee3a['params']['id']),_0x10834b=_0x493ce6[_0x5f24fb(0x1e2)]['map'](async _0x111af0=>{var _0x2cfe7c=_0x5f24fb;if(_0x111af0[_0x2cfe7c(0x1e0)]>0x0){var _0xb0e392=await warehouse[_0x2cfe7c(0x1fd)]({'name':_0x274ff7,'room':_0x111af0[_0x2cfe7c(0x181)],'warehouse_category':_0x2cfe7c(0x180)});const _0x3ec6a8=_0xb0e392[_0x2cfe7c(0x1f3)][_0x2cfe7c(0x246)](_0x4fd837=>{var _0x4fcd50=_0x2cfe7c;_0x4fd837[_0x4fcd50(0x1c1)]==_0x111af0[_0x4fcd50(0x1c1)]&&_0x4fd837['bay']==_0x111af0[_0x4fcd50(0x24c)]&&_0x4fd837['expiry_date']==_0x111af0[_0x4fcd50(0x17b)]&&_0x4fd837[_0x4fcd50(0x22c)]==_0x111af0['production_date']&&_0x4fd837[_0x4fcd50(0x1f4)]==_0x111af0['batch_code']&&_0x4fd837['invoice']==_0x111af0[_0x4fcd50(0x23f)]&&(console[_0x4fcd50(0x1ba)]('here1',_0x4fd837['product_stock']),typeof _0x111af0[_0x4fcd50(0x16d)]=='undefined'?_0x4fd837[_0x4fcd50(0x1ac)]=Math[_0x4fcd50(0x18c)](0x0,Math[_0x4fcd50(0x20b)](_0x4fd837[_0x4fcd50(0x1ac)])-Math['abs'](_0x111af0['to_quantity'])):_0x4fd837[_0x4fcd50(0x1ac)]=Math[_0x4fcd50(0x18c)](0x0,Math[_0x4fcd50(0x20b)](_0x4fd837[_0x4fcd50(0x1ac)])-Math['abs'](_0x111af0[_0x4fcd50(0x1e0)])));});}return _0xb0e392;});Promise['all'](_0x10834b)[_0x5f24fb(0x1f9)](async _0x36084d=>{var _0x5e0695=_0x5f24fb;try{for(const _0x1b171c of _0x36084d){await _0x1b171c[_0x5e0695(0x22a)]();}const _0x35bb92=_0x493ce6[_0x5e0695(0x1e2)][_0x5e0695(0x246)](async _0x4efece=>{var _0x96880f=_0x5e0695,_0x191f46=await warehouse[_0x96880f(0x1fd)]({'name':_0x3adb5d,'room':_0x4efece['to_room_name']});if(_0x4efece[_0x96880f(0x1e0)]>0x0){var _0x417316=0x0;const _0xca318c=_0x191f46['product_details'][_0x96880f(0x246)](_0x4d8b41=>{var _0x5e70c4=_0x96880f;_0x4d8b41['product_name']==_0x4efece[_0x5e70c4(0x1c1)]&&_0x4d8b41[_0x5e70c4(0x1bd)]==_0x4efece['to_bay']&&_0x4d8b41[_0x5e70c4(0x17b)]==_0x4efece['expiry_date']&&_0x4d8b41[_0x5e70c4(0x22c)]==_0x4efece[_0x5e70c4(0x22c)]&&_0x4d8b41[_0x5e70c4(0x1f4)]==_0x4efece[_0x5e70c4(0x1f4)]&&_0x4d8b41[_0x5e70c4(0x229)]==_0x4efece[_0x5e70c4(0x183)]&&(typeof _0x4efece[_0x5e70c4(0x16d)]=='undefined'?(console[_0x5e70c4(0x1ba)](_0x5e70c4(0x188),_0x4d8b41[_0x5e70c4(0x1ac)]+_0x5e70c4(0x1cc)+_0x4d8b41['_id']+_0x5e70c4(0x20c)+Math[_0x5e70c4(0x20b)](_0x4d8b41[_0x5e70c4(0x1ac)])+Math[_0x5e70c4(0x20b)](_0x4efece[_0x5e70c4(0x1e0)])),_0x4d8b41[_0x5e70c4(0x1ac)]=Math[_0x5e70c4(0x20b)](_0x4d8b41[_0x5e70c4(0x1ac)])+Math['abs'](_0x4efece[_0x5e70c4(0x1e0)])):_0x4d8b41['product_stock']=Math[_0x5e70c4(0x20b)](_0x4d8b41['product_stock'])+Math['abs'](_0x4efece[_0x5e70c4(0x1e0)]),_0x417316++);});_0x417316=='0'&&(_0x191f46[_0x96880f(0x1f3)]=_0x191f46['product_details'][_0x96880f(0x1ae)]({'product_name':_0x4efece[_0x96880f(0x1c1)],'product_stock':_0x4efece[_0x96880f(0x1e0)],'bay':_0x4efece[_0x96880f(0x1f7)],'product_code':_0x4efece['product_code'],'primary_code':_0x4efece[_0x96880f(0x175)],'secondary_code':_0x4efece[_0x96880f(0x187)],'expiry_date':_0x4efece['expiry_date'],'production_date':_0x4efece[_0x96880f(0x22c)],'maxProducts':_0x4efece[_0x96880f(0x172)],'batch_code':_0x4efece[_0x96880f(0x1f4)],'secondary_unit':_0x4efece[_0x96880f(0x234)],'unit':_0x4efece[_0x96880f(0x23e)],'maxProducts':_0x4efece[_0x96880f(0x172)],'maxPerUnit':_0x4efece[_0x96880f(0x1b8)],'invoice':_0x4efece[_0x96880f(0x183)]}));}return _0x191f46;});Promise[_0x5e0695(0x19d)](_0x35bb92)['then'](async _0x6ac7c8=>{var _0x314d06=_0x5e0695;try{for(const _0x984fc9 of _0x6ac7c8){await warehouse[_0x314d06(0x19f)]({'_id':_0x984fc9[_0x314d06(0x209)]},{'$addToSet':{'product_details':{'$each':_0x984fc9[_0x314d06(0x1f3)]}}});}_0x493ce6[_0x314d06(0x1e5)]=_0x314d06(0x1e6);const _0x2346cd=await _0x493ce6['save'](),_0x27cf8a=await master_shop[_0x314d06(0x173)](),_0x5d1fc5=await email_settings['findOne'](),_0x24eefc=await supervisor_settings['find']();var _0x4a5e03=_0x493ce6[_0x314d06(0x1e2)],_0x455894='',_0x3ecbd8;for(_0x3ecbd8 in _0x4a5e03){var _0x269512='FG';_0x493ce6[_0x314d06(0x1c3)]=='DRY\x20GOODS'&&(_0x269512='DG'),_0x455894+=_0x314d06(0x1c0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4a5e03[_0x3ecbd8][_0x314d06(0x1c1)]+_0x314d06(0x1d4)+_0x314d06(0x189)+_0x4a5e03[_0x3ecbd8][_0x314d06(0x227)]+_0x314d06(0x1d4)+_0x314d06(0x189)+_0x4a5e03[_0x3ecbd8]['to_quantity']+_0x314d06(0x1d4)+_0x314d06(0x189)+_0x4a5e03[_0x3ecbd8][_0x314d06(0x23e)]+_0x314d06(0x1d4)+_0x314d06(0x189)+_0x4a5e03[_0x3ecbd8][_0x314d06(0x234)]+'</td>'+_0x314d06(0x189)+_0x493ce6['to_warehouse']+_0x314d06(0x1d4)+_0x314d06(0x189)+_0x4a5e03[_0x3ecbd8][_0x314d06(0x193)]+_0x314d06(0x1d4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x269512+_0x4a5e03[_0x3ecbd8][_0x314d06(0x1f7)]+_0x314d06(0x1d4)+_0x314d06(0x1a7);}let _0x1868f1=nodemailer[_0x314d06(0x1a4)]({'host':_0x5d1fc5['host'],'port':Number(_0x5d1fc5[_0x314d06(0x19b)]),'secure':![],'auth':{'user':_0x5d1fc5[_0x314d06(0x1f1)],'pass':_0x5d1fc5[_0x314d06(0x1cd)]}}),_0x21042a={'from':_0x5d1fc5[_0x314d06(0x1f1)],'to':_0x24eefc[0x0][_0x314d06(0x221)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x314d06(0x176),'path':__dirname+_0x314d06(0x223)+_0x314d06(0x22f)+_0x27cf8a[0x0][_0x314d06(0x195)],'cid':_0x314d06(0x219)}],'html':_0x314d06(0x1ec)+_0x314d06(0x18f)+_0x314d06(0x17a)+_0x314d06(0x171)+_0x314d06(0x1fa)+_0x314d06(0x171)+_0x314d06(0x1fc)+_0x314d06(0x1f0)+_0x314d06(0x171)+_0x314d06(0x18e)+_0x27cf8a[0x0][_0x314d06(0x236)]+'\x20</h2>'+_0x314d06(0x1f0)+_0x314d06(0x1f0)+_0x314d06(0x222)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x493ce6[_0x314d06(0x229)]+'\x20'+_0x314d06(0x1b5)+'\x20Order\x20Date\x20:\x20'+_0x493ce6[_0x314d06(0x1ab)]+'\x20'+_0x314d06(0x20f)+_0x314d06(0x216)+_0x314d06(0x1f0)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x314d06(0x20e)+_0x314d06(0x1c0)+_0x314d06(0x1ff)+_0x314d06(0x238)+_0x314d06(0x241)+_0x314d06(0x1f6)+_0x314d06(0x211)+_0x314d06(0x217)+_0x314d06(0x1b1)+_0x314d06(0x239)+_0x314d06(0x1a7)+'</thead>'+_0x314d06(0x19a)+'\x20'+_0x455894+'\x20'+_0x314d06(0x17d)+_0x314d06(0x1b6)+_0x314d06(0x171)+_0x314d06(0x190)+'<h5>'+_0x27cf8a[0x0][_0x314d06(0x236)]+_0x314d06(0x216)+_0x314d06(0x1f0)+_0x314d06(0x1f0)+_0x314d06(0x21e)};_0x1868f1[_0x314d06(0x22d)](_0x21042a,function(_0xb1aa3a,_0x32c2a4){var _0x21b2b9=_0x314d06;_0xb1aa3a?(console['log'](_0xb1aa3a),console[_0x21b2b9(0x1ba)](_0x21b2b9(0x198))):console[_0x21b2b9(0x1ba)](_0x21b2b9(0x1a2));}),_0x27ee3a[_0x314d06(0x24d)](_0x314d06(0x1c4),_0x314d06(0x1f8)),_0x596fb6[_0x314d06(0x16e)]('/picking_list/PDF_transfer/'+_0x2346cd[_0x314d06(0x209)]);}catch(_0x550e2a){console[_0x314d06(0x1b9)](_0x550e2a),_0x596fb6[_0x314d06(0x20d)](0x1f4)[_0x314d06(0x1e4)]({'error':_0x314d06(0x247)});}})[_0x5e0695(0x19c)](_0xf9b270=>{var _0x5e1e22=_0x5e0695;console[_0x5e1e22(0x1b9)](_0xf9b270),_0x596fb6[_0x5e1e22(0x20d)](0x1f4)['json']({'error':_0x5e1e22(0x1c6)});});}catch(_0x2eeed1){console[_0x5e0695(0x1b9)](_0x2eeed1),_0x596fb6[_0x5e0695(0x20d)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x21ec15=>{var _0x52c390=_0x5f24fb;console[_0x52c390(0x1b9)](_0x21ec15),_0x596fb6[_0x52c390(0x20d)](0x1f4)[_0x52c390(0x1e4)]({'error':_0x52c390(0x1c6)});});}catch(_0x2e114a){_0x596fb6[_0x5f24fb(0x1e4)]({'message':_0x2e114a[_0x5f24fb(0x191)]});}});function BayBinSelected(_0x30fe8b,_0x2e122b){var _0x32bbb2=a0_0x27acc5,_0x18738f=[];let _0x4c2abd=[];var _0x1b8ded=[];if(_0x30fe8b==_0x32bbb2(0x1db)){switch(_0x2e122b){case'Rack\x201':_0x18738f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x32bbb2(0x18d):_0x18738f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1b8ded=['DG'];}else{if(_0x30fe8b==_0x32bbb2(0x184)){switch(_0x2e122b){case _0x32bbb2(0x1b7):_0x18738f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x32bbb2(0x18d):_0x18738f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1b8ded=['FG'];}}return{'levels':_0x18738f,'identify':_0x1b8ded};}router[a0_0x27acc5(0x1ca)](a0_0x27acc5(0x200),auth,async(_0x331c7d,_0x1d7f72)=>{var _0x2d239d=a0_0x27acc5;try{const {username:_0x1c40c6,email:_0x9f73b9,role:_0x21aa62}=_0x331c7d[_0x2d239d(0x1bb)],_0x3b9c07=_0x331c7d[_0x2d239d(0x1bb)],_0x214532=await profile['findOne']({'email':_0x3b9c07['email']}),_0x2d7a05=await master_shop['find'](),_0x304957=await transfers_finished[_0x2d239d(0x1c5)](_0x331c7d[_0x2d239d(0x177)]['id']);let _0xba3b24=new Date(_0x304957[_0x2d239d(0x17b)]),_0x17774e=('0'+_0xba3b24[_0x2d239d(0x1be)]())[_0x2d239d(0x1d2)](-0x2),_0x2ad372=('0'+(_0xba3b24[_0x2d239d(0x1da)]()+0x1))[_0x2d239d(0x1d2)](-0x2),_0x23d758=_0xba3b24[_0x2d239d(0x220)](),_0x4a2f43=_0x23d758+'-'+_0x2ad372+'-'+_0x17774e,_0x348b89;if(_0x3b9c07[_0x2d239d(0x1b4)]==_0x2d239d(0x20a)){const _0x5264e3=await staff['findOne']({'email':_0x3b9c07[_0x2d239d(0x1f1)]});_0x348b89=await warehouse[_0x2d239d(0x173)]({'status':_0x2d239d(0x1ad),'name':_0x5264e3[_0x2d239d(0x1d9)],'warehouse_category':_0x2d239d(0x180)});}else _0x348b89=await warehouse[_0x2d239d(0x173)]({'status':_0x2d239d(0x1ad),'warehouse_category':_0x2d239d(0x180)});const _0x51d10a=await warehouse[_0x2d239d(0x1ce)]([{'$match':{'name':_0x304957[_0x2d239d(0x213)],'room':_0x304957[_0x2d239d(0x196)]}},{'$unwind':_0x2d239d(0x1ef)},{'$group':{'_id':_0x2d239d(0x178),'name':{'$first':_0x2d239d(0x21a)},'product_stock':{'$first':_0x2d239d(0x197)},'bay':{'$first':_0x2d239d(0x1d1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2d239d(0x1dc)},'floorlevel':{'$first':_0x2d239d(0x1a6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2d239d(0x212)},'product_code':{'$first':_0x2d239d(0x1f5)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2d239d(0x1d5)}}}]);var _0x4979f9=[0x1,0x2,0x3,0x4],_0x31ef84=['A','B','C','D','E','F','G','H','I','J'],_0x5a0309=[_0x2d239d(0x1af),'Enclosed'];const _0x51efd1=await product[_0x2d239d(0x173)]({}),_0x2e1fff=BayBinSelected(_0x304957[_0x2d239d(0x1c3)],_0x304957[_0x2d239d(0x1bf)]);if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]==_0x2d239d(0x244)){var _0x1bae4d=users[_0x2d239d(0x23c)];console[_0x2d239d(0x1ba)](_0x1bae4d);}else{if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]==_0x2d239d(0x194))var _0x1bae4d=users[_0x2d239d(0x194)];else{if(_0x2d7a05[0x0]['language']==_0x2d239d(0x1de))var _0x1bae4d=users[_0x2d239d(0x1de)];else{if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]=='Spanish')var _0x1bae4d=users[_0x2d239d(0x1f2)];else{if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]==_0x2d239d(0x1e1))var _0x1bae4d=users[_0x2d239d(0x1e1)];else{if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]=='Portuguese\x20(BR)')var _0x1bae4d=users[_0x2d239d(0x22b)];else{if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]==_0x2d239d(0x179))var _0x1bae4d=users[_0x2d239d(0x179)];else{if(_0x2d7a05[0x0][_0x2d239d(0x1fe)]==_0x2d239d(0x16f))var _0x1bae4d=users[_0x2d239d(0x245)];}}}}}}}_0x1d7f72[_0x2d239d(0x207)](_0x2d239d(0x1b2),{'success':_0x331c7d[_0x2d239d(0x24d)](_0x2d239d(0x1c4)),'errors':_0x331c7d[_0x2d239d(0x24d)](_0x2d239d(0x1dd)),'role':_0x3b9c07,'profile':_0x214532,'master_shop':_0x2d7a05,'warehouse':_0x348b89,'transfer':_0x304957,'stock':_0x51d10a,'unit':_0x51efd1,'language':_0x1bae4d,'levels':_0x4979f9,'Isle':_0x31ef84,'rooms_data':_0x5a0309,'ed_fullDate':_0x4a2f43,'dataSelected':_0x2e1fff});}catch(_0x51ecbb){console[_0x2d239d(0x1ba)](_0x51ecbb);}}),router[a0_0x27acc5(0x1ed)]('/view/:id',auth,async(_0x82cab9,_0x5c7e1b)=>{var _0x2c67eb=a0_0x27acc5;try{const _0x2baf09=_0x82cab9[_0x2c67eb(0x177)]['id'];console['log'](_0x82cab9['body']);const _0xda16fd=await transfers_finished[_0x2c67eb(0x1c5)](_0x2baf09);console[_0x2c67eb(0x1ba)]('transfer_data',_0xda16fd);const {date:_0x4adca8,from_warehouse:_0x3b5578,FromRoom_name:_0x1cb7a1,to_warehouse:_0x29a939,ToRoom_name:_0x3e1140,prod_name:_0x54fce8,from_prod_qty:_0x2b9cc8,from_prod_level:_0x14984a,from_prod_isle:_0x375d30,from_prod_pallet:_0xaf6363,to_prod_qty:_0x397a84,to_prod_level:_0x59c79c,to_prod_isle:_0x1e835e,to_prod_pallet:_0x197535,primary_code:_0xb6679,secondary_code:_0x5d4728,product_code3:_0x4e1267,note:_0x20af0a,invoice:_0x415725,expiry_date:_0x5475f6}=_0x82cab9['body'];if(typeof _0x54fce8==_0x2c67eb(0x218))var _0xf7161e=[_0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x21b)]],_0x2b856d=[_0x82cab9['body']['from_prod_qty']],_0x3026cd=[_0x82cab9['body'][_0x2c67eb(0x21c)]],_0x228840=[_0x82cab9['body'][_0x2c67eb(0x23b)]],_0x1f78b6=[_0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x201)]],_0x30ebbb=[_0x82cab9['body']['primary_code']],_0x1682c7=[_0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x187)]],_0x4c139c=[_0x82cab9['body'][_0x2c67eb(0x170)]],_0x29d728=[_0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x1e9)]],_0x1898fa=[_0x82cab9['body'][_0x2c67eb(0x23e)]],_0x1fbbac=[_0x82cab9['body'][_0x2c67eb(0x234)]],_0x773f50=[_0x82cab9[_0x2c67eb(0x242)]['batch_code']],_0x4e81b8=[_0x82cab9['body']['expiry_date']];else var _0xf7161e=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x21b)]],_0x2b856d=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x1fb)]],_0x3026cd=[..._0x82cab9['body'][_0x2c67eb(0x21c)]],_0x228840=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x23b)]],_0x1f78b6=[..._0x82cab9['body']['to_prod_level']],_0x30ebbb=[..._0x82cab9[_0x2c67eb(0x242)]['primary_code']],_0x1682c7=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x187)]],_0x4c139c=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x170)]],_0x29d728=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x1e9)]],_0x1898fa=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x23e)]],_0x1fbbac=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x234)]],_0x773f50=[..._0x82cab9[_0x2c67eb(0x242)]['batch_code']],_0x4e81b8=[..._0x82cab9[_0x2c67eb(0x242)][_0x2c67eb(0x17b)]];const _0x19cffc=_0xf7161e[_0x2c67eb(0x246)](_0x5dd04d=>{return _0x5dd04d={'product_name':_0x5dd04d};});_0x2b856d['forEach']((_0x529a6c,_0x46ebbd)=>{var _0x118d27=_0x2c67eb;_0x19cffc[_0x46ebbd][_0x118d27(0x1d3)]=_0x529a6c;}),_0x3026cd['forEach']((_0x47710f,_0xb16fc3)=>{var _0x39bf5b=_0x2c67eb;_0x19cffc[_0xb16fc3][_0x39bf5b(0x24c)]=_0x47710f;}),_0x228840['forEach']((_0x143aad,_0x185407)=>{var _0x36fbad=_0x2c67eb;_0x19cffc[_0x185407][_0x36fbad(0x1e0)]=_0x143aad;}),_0x1f78b6[_0x2c67eb(0x231)]((_0x334bd0,_0x78ad1)=>{var _0x2ead29=_0x2c67eb;_0x19cffc[_0x78ad1][_0x2ead29(0x1f7)]=_0x334bd0;}),_0x30ebbb[_0x2c67eb(0x231)]((_0x162b9a,_0x4fa9d4)=>{_0x19cffc[_0x4fa9d4]['primary_code']=_0x162b9a;}),_0x1682c7[_0x2c67eb(0x231)]((_0x25c1ad,_0x43cfba)=>{var _0x30e356=_0x2c67eb;_0x19cffc[_0x43cfba][_0x30e356(0x187)]=_0x25c1ad;}),_0x4c139c[_0x2c67eb(0x231)]((_0x2d5b6f,_0x494ccc)=>{var _0x1b8c10=_0x2c67eb;_0x19cffc[_0x494ccc][_0x1b8c10(0x227)]=_0x2d5b6f;}),_0x29d728[_0x2c67eb(0x231)]((_0x2dda48,_0x50b103)=>{var _0x1d0c24=_0x2c67eb;_0x19cffc[_0x50b103][_0x1d0c24(0x172)]=_0x2dda48;}),_0x1898fa[_0x2c67eb(0x231)]((_0x4404a2,_0x467f69)=>{var _0x5f1d63=_0x2c67eb;_0x19cffc[_0x467f69][_0x5f1d63(0x23e)]=_0x4404a2;}),_0x1fbbac[_0x2c67eb(0x231)]((_0x337a9d,_0x3d02bd)=>{var _0xda31ce=_0x2c67eb;_0x19cffc[_0x3d02bd][_0xda31ce(0x234)]=_0x337a9d;}),_0x773f50['forEach']((_0x2f66a3,_0x265528)=>{var _0x2b9970=_0x2c67eb;_0x19cffc[_0x265528][_0x2b9970(0x1f4)]=_0x2f66a3;}),_0x4e81b8[_0x2c67eb(0x231)]((_0x2c269d,_0x25189e)=>{_0x19cffc[_0x25189e]['expiry_date']=_0x2c269d;});const _0x48d5f9=_0x19cffc[_0x2c67eb(0x1a8)](_0x599753=>_0x599753[_0x2c67eb(0x1e0)]!=='0'&&_0x599753[_0x2c67eb(0x1e0)]!==''||_0x599753['to_floorlevel']!=='0'&&_0x599753[_0x2c67eb(0x1a0)]!=='');var _0x1d256a=0x0;_0x48d5f9[_0x2c67eb(0x231)](_0x47c779=>{var _0x54f372=_0x2c67eb;parseInt(_0x47c779[_0x54f372(0x1d3)])<parseInt(_0x47c779[_0x54f372(0x1e0)])&&_0x1d256a++;});if(_0x1d256a!=0x0)return _0x82cab9['flash'](_0x2c67eb(0x1dd),_0x2c67eb(0x1c7)),_0x5c7e1b[_0x2c67eb(0x16e)](_0x2c67eb(0x17c));const _0x4885e0=await warehouse['findOne']({'name':_0xda16fd['from_warehouse'],'room':_0xda16fd[_0x2c67eb(0x196)]});_0xda16fd[_0x2c67eb(0x1e2)][_0x2c67eb(0x231)](_0x28891c=>{var _0x26e1bc=_0x2c67eb;if(_0x28891c[_0x26e1bc(0x1e0)]>0x0){const _0x576c8a=_0x4885e0[_0x26e1bc(0x1f3)][_0x26e1bc(0x246)](_0x172d41=>{var _0x5993b8=_0x26e1bc;_0x172d41[_0x5993b8(0x1c1)]==_0x28891c[_0x5993b8(0x1c1)]&&_0x172d41['bay']==_0x28891c[_0x5993b8(0x24c)]&&(_0x172d41['product_stock']=parseInt(_0x172d41['product_stock'])+parseInt(_0x28891c[_0x5993b8(0x1e0)]));});}}),await _0x4885e0[_0x2c67eb(0x22a)]();const _0x1abc5f=await warehouse[_0x2c67eb(0x1fd)]({'name':_0xda16fd['to_warehouse'],'room':_0xda16fd[_0x2c67eb(0x1bf)]});_0xda16fd[_0x2c67eb(0x1e2)]['forEach'](_0x111971=>{var _0x22dfc0=_0x2c67eb;if(_0x111971[_0x22dfc0(0x1e0)]>0x0){const _0x4225a3=_0x1abc5f[_0x22dfc0(0x1f3)]['map'](_0x117dda=>{var _0x5df7bf=_0x22dfc0;_0x117dda[_0x5df7bf(0x1c1)]==_0x111971['product_name']&&_0x117dda[_0x5df7bf(0x1bd)]==_0x111971[_0x5df7bf(0x1f7)]&&(_0x117dda[_0x5df7bf(0x1ac)]=parseInt(_0x117dda[_0x5df7bf(0x1ac)])-parseInt(_0x111971['to_quantity']));});}}),await _0x1abc5f[_0x2c67eb(0x22a)](),_0xda16fd[_0x2c67eb(0x1ab)]=_0x4adca8,_0xda16fd[_0x2c67eb(0x213)]=_0x3b5578,_0xda16fd['to_warehouse']=_0x29a939,_0xda16fd[_0x2c67eb(0x1e2)]=_0x48d5f9,_0xda16fd[_0x2c67eb(0x237)]=_0x20af0a,_0xda16fd[_0x2c67eb(0x229)]=_0x415725;const _0x1a0893=await _0xda16fd[_0x2c67eb(0x22a)](),_0x23eda5=await warehouse[_0x2c67eb(0x1fd)]({'name':_0x3b5578,'room':_0x1cb7a1});_0x1a0893[_0x2c67eb(0x1e2)]['forEach'](_0x4fdc2e=>{var _0x33e9b0=_0x2c67eb;if(_0x4fdc2e[_0x33e9b0(0x1e0)]>0x0){const _0x2fb759=_0x23eda5[_0x33e9b0(0x1f3)][_0x33e9b0(0x246)](_0x2104a8=>{var _0x5e1bf9=_0x33e9b0;_0x2104a8['product_name']==_0x4fdc2e['product_name']&&_0x2104a8[_0x5e1bf9(0x1bd)]==_0x4fdc2e[_0x5e1bf9(0x24c)]&&(_0x2104a8[_0x5e1bf9(0x1ac)]=parseInt(_0x2104a8[_0x5e1bf9(0x1ac)])-parseInt(_0x4fdc2e[_0x5e1bf9(0x1e0)]));});}}),await _0x23eda5['save']();const _0x193728=await warehouse['findOne']({'name':_0x29a939,'room':_0x3e1140});_0x1a0893[_0x2c67eb(0x1e2)][_0x2c67eb(0x231)](_0x460255=>{var _0x22a24b=_0x2c67eb;if(_0x460255['to_quantity']>0x0){var _0x5760a1=0x0;const _0x335bd2=_0x193728[_0x22a24b(0x1f3)][_0x22a24b(0x246)](_0x26fe4b=>{var _0x265ec2=_0x22a24b;_0x26fe4b[_0x265ec2(0x1c1)]==_0x460255[_0x265ec2(0x1c1)]&&_0x26fe4b['bay']==_0x460255[_0x265ec2(0x1f7)]&&(_0x26fe4b[_0x265ec2(0x1ac)]=parseInt(_0x26fe4b[_0x265ec2(0x1ac)])+parseInt(_0x460255[_0x265ec2(0x1e0)]),_0x5760a1++);});_0x5760a1=='0'&&(_0x193728['product_details']=_0x193728[_0x22a24b(0x1f3)][_0x22a24b(0x1ae)]({'product_name':_0x460255['product_name'],'product_stock':_0x460255['to_quantity'],'bay':_0x460255[_0x22a24b(0x1f7)],'product_code':_0x460255[_0x22a24b(0x227)],'primary_code':_0x460255[_0x22a24b(0x175)],'secondary_code':_0x460255[_0x22a24b(0x187)],'maxProducts':_0x460255[_0x22a24b(0x172)]}));}}),await _0x193728['save'](),_0x82cab9[_0x2c67eb(0x24d)]('success',_0x2c67eb(0x205)),_0x5c7e1b[_0x2c67eb(0x16e)]('/transfer_finished/view');}catch(_0x2d7c8e){console[_0x2c67eb(0x1ba)](_0x2d7c8e);}}),router[a0_0x27acc5(0x1ed)](a0_0x27acc5(0x1aa),async(_0x51526d,_0x15978c)=>{var _0x579e49=a0_0x27acc5;const {FromWareHouse:_0x42ccac,FromRoom:_0xe1ef19,ToWarehouse:_0xba3e10,ToRoom:_0x31bc48,primary_code:_0x365990,Roomslist:_0x4d3c15}=_0x51526d[_0x579e49(0x242)],_0x337fd7=_0x4d3c15['split'](','),_0x116097=[];async function _0x1895a6(_0x2e1f00){var _0x158fb9=_0x579e49;const _0x2d5147=await warehouse[_0x158fb9(0x1ce)]([{'$match':{'name':_0x42ccac,'room':_0x2e1f00}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x365990}},{'$group':{'_id':_0x158fb9(0x178),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x158fb9(0x197)},'primary_code':{'$first':_0x158fb9(0x1e7)},'secondary_code':{'$first':_0x158fb9(0x212)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x158fb9(0x1dc)},'pallet':{'$first':_0x158fb9(0x1a6)},'unit':{'$first':_0x158fb9(0x1df)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x158fb9(0x233)},'rack':{'$first':_0x158fb9(0x1d5)},'expiry_date':{'$first':_0x158fb9(0x21d)},'production_date':{'$first':_0x158fb9(0x202)},'batch_code':{'$first':_0x158fb9(0x19e)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x158fb9(0x214)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x158fb9(0x1c2)}}}]),_0x388518=await warehouse['aggregate']([{'$match':{'name':_0x42ccac,'room':_0x2e1f00}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x365990}},{'$group':{'_id':_0x158fb9(0x178),'name':{'$first':_0x158fb9(0x21a)},'instock':{'$first':_0x158fb9(0x197)},'primary_code':{'$first':_0x158fb9(0x1e7)},'secondary_code':{'$first':_0x158fb9(0x212)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x158fb9(0x1d1)},'isle':{'$first':_0x158fb9(0x1d0)},'type':{'$first':_0x158fb9(0x1dc)},'pallet':{'$first':_0x158fb9(0x1a6)},'unit':{'$first':_0x158fb9(0x1df)},'secondary_unit':{'$first':_0x158fb9(0x24e)},'storage':{'$first':_0x158fb9(0x233)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x158fb9(0x21d)},'production_date':{'$first':_0x158fb9(0x202)},'batch_code':{'$first':_0x158fb9(0x19e)},'maxPerUnit':{'$first':_0x158fb9(0x230)},'roomNamed':{'$first':_0x158fb9(0x214)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2d5147[_0x158fb9(0x24a)]>0x0)_0x116097[_0x158fb9(0x248)](_0x2d5147);else _0x388518[_0x158fb9(0x24a)]>0x0&&_0x116097[_0x158fb9(0x248)](_0x388518);}const _0x2b9590=_0x337fd7[_0x579e49(0x246)](_0x529d13=>_0x1895a6(_0x529d13));await Promise[_0x579e49(0x19d)](_0x2b9590),_0x15978c[_0x579e49(0x1e4)](_0x116097);}),router[a0_0x27acc5(0x1ed)](a0_0x27acc5(0x1c8),async(_0x2b76f3,_0x5d3e7f)=>{var _0x422612=a0_0x27acc5;try{const {FromWareHouse:_0x1e9931,FromRoom:_0x29e975,ToWarehouse:_0x5dba53,ToRoom:_0x4cba18,secondary_code:_0x34a302}=_0x2b76f3[_0x422612(0x242)],_0x435bb8=await warehouse[_0x422612(0x1ce)]([{'$match':{'name':_0x1e9931}},{'$unwind':_0x422612(0x1ef)},{'$match':{'product_details.secondary_code':_0x34a302}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x422612(0x21a)},'primary_code':{'$first':_0x422612(0x1e7)},'secondary_code':{'$first':_0x422612(0x212)},'product_code':{'$first':_0x422612(0x1f5)},'instock':{'$first':_0x422612(0x197)},'warehouse':{'$first':'$name'},'level':{'$first':_0x422612(0x1a3)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x422612(0x182)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x422612(0x202)}}}]);_0x5d3e7f[_0x422612(0x20d)](0xc8)[_0x422612(0x1e4)](_0x435bb8);}catch(_0xf786b){_0x5d3e7f['status'](0x194)[_0x422612(0x1e4)]({'message':_0xf786b['message']});}}),router['post'](a0_0x27acc5(0x1ea),async(_0x1c0af6,_0x4a3685)=>{var _0x48a5cb=a0_0x27acc5;try{const {FromWareHouse:_0x702b57,FromRoom:_0x1c6adb,ToWarehouse:_0x5ad2a7,ToRoom:_0x1a2eda,product_code:_0x695251}=_0x1c0af6[_0x48a5cb(0x242)],_0xacb6fe=await warehouse[_0x48a5cb(0x1ce)]([{'$match':{'name':_0x702b57}},{'$unwind':_0x48a5cb(0x1ef)},{'$match':{'product_details.product_code':_0x695251}},{'$group':{'_id':_0x48a5cb(0x178),'name':{'$first':_0x48a5cb(0x21a)},'primary_code':{'$first':_0x48a5cb(0x1e7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x48a5cb(0x1f5)},'instock':{'$first':_0x48a5cb(0x197)},'warehouse':{'$first':_0x48a5cb(0x240)},'level':{'$first':_0x48a5cb(0x1a3)},'isle':{'$first':_0x48a5cb(0x1b0)},'pallet':{'$first':_0x48a5cb(0x182)},'maxProducts':{'$first':_0x48a5cb(0x228)},'unit':{'$first':_0x48a5cb(0x1df)}}}]);_0x4a3685[_0x48a5cb(0x20d)](0xc8)[_0x48a5cb(0x1e4)](_0xacb6fe);}catch(_0x312ba3){_0x4a3685[_0x48a5cb(0x20d)](0x194)[_0x48a5cb(0x1e4)]({'message':_0x312ba3[_0x48a5cb(0x191)]});}}),router[a0_0x27acc5(0x1ed)](a0_0x27acc5(0x185),async(_0x518185,_0x2ce99f)=>{var _0x1cd48c=a0_0x27acc5;const {productCode:_0x3722cc,bay:_0x41c97f,warehouses:_0x215fc3,room:_0x28a9a1}=_0x518185[_0x1cd48c(0x242)];console[_0x1cd48c(0x1ba)](_0x518185[_0x1cd48c(0x242)]);try{const _0x22814b=await warehouse[_0x1cd48c(0x1ce)]([{'$match':{'name':_0x215fc3,'room':_0x28a9a1}},{'$unwind':_0x1cd48c(0x1ef)},{'$match':{'product_details.bay':parseInt(_0x41c97f)}},{'$group':{'_id':_0x1cd48c(0x178),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1cd48c(0x1d1)},'maxProducts':{'$first':_0x1cd48c(0x228)}}}]);_0x2ce99f['status'](0xc8)[_0x1cd48c(0x1e4)](_0x22814b);}catch(_0xf7f78d){_0x2ce99f['status'](0x194)['json']({'message':_0xf7f78d[_0x1cd48c(0x191)]});}}),module[a0_0x27acc5(0x232)]=router;