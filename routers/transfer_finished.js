var a0_0x1204d2=a0_0x2498;(function(_0x3fb3c8,_0x3b6a80){var _0x468b30=a0_0x2498,_0x2c59b8=_0x3fb3c8();while(!![]){try{var _0x3df602=-parseInt(_0x468b30(0x11c))/0x1+-parseInt(_0x468b30(0x1a0))/0x2+parseInt(_0x468b30(0x16b))/0x3+parseInt(_0x468b30(0x123))/0x4+-parseInt(_0x468b30(0x19f))/0x5*(parseInt(_0x468b30(0x166))/0x6)+parseInt(_0x468b30(0x180))/0x7+parseInt(_0x468b30(0x131))/0x8;if(_0x3df602===_0x3b6a80)break;else _0x2c59b8['push'](_0x2c59b8['shift']());}catch(_0x2a6e99){_0x2c59b8['push'](_0x2c59b8['shift']());}}}(a0_0x8b18,0x78c67));const express=require(a0_0x1204d2(0x1bc)),app=express(),router=express[a0_0x1204d2(0x129)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1204d2(0x191)),users=require(a0_0x1204d2(0x16f)),nodemailer=require(a0_0x1204d2(0x1ce));function a0_0x8b18(){var _0x326414=['floor','$product_details.unit','aggregate','MaxStocks_data2','message','</table>','895963glOcXq','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<h5>','Chinese','to_invoice','product','$product_details.product_stock','2287728nSWxcF','/../public','email','<div>','error','back','Router','errors','An\x20error\x20occurred\x20while\x20saving\x20data.','batch_code','params','to_prod_level','QA\x20Warehouse','RoomAssigned','548424jSimKk','</span>','warehouse','prod_name','</div>','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','slice','host','product_date','map','success','$product.to_room_name','edit_transfer_finished_view','\x20Order\x20Date\x20:\x20','all','getFullYear','$product.from_room_name','$product_details.primary_code','/view/add_transfer','padStart','ToRoomAssigned','/transfer_finished/preview/','</tr>','$product_details.bay','production_date','from_quantity','Enabled','getMonth','To_invoice','product_name','from_bay','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','invoice','transfer_finished','random','$product_details.maxPerUnit','findOne','$_id','maxProducts','length','role','Arabic\x20(ae)','<span\x20style=\x22float:\x20right;\x22>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','English','product_code','Rack\x202','$product_details.production_date','render','$product_details.secondary_code','password','/preview/:id','24FrxrCK','split','body','from_room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','1300170IOtAtM','$product_details.secondary_unit','transfer_data','product_stock','../public/language/languages.json','flash','</head><body>','to_prod_qty','finalize','/barcode_scanner3','to_room_name','$product_details.product_code','Transfer\x20Edit\x20Successfully','primary_code','French','note','log','concat','unit','string','redirect','2397199gaShNG','FGSEmail','bay','DRY\x20GOODS','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/picking_list/PDF_transfer/','sendMail','from_warehouse','Arabic','product_code3','$product_details.expiry_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<hr\x20class=\x22my-3\x22>','TRFF-','Portuguese\x20(BR)','$product_details.type','True','../middleware/auth','/view','English\x20(US)','to_floorlevel','Portuguese','MaxStocks_data','$room','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<strong>\x20Regards\x20</strong>','from_room','$invoice','port','Hindi','20635tFPVUa','18332rdLzKI','toString','secondary_unit','/CheckingWarehouse','edit_transfer_finished','secondary_code','push','$product_details.batch_code','staff','</thead>','createTransport','Email\x20sent\x20successfully','$product_details.level','from_prod_level','Ambient','from_prod_qty','find','to_warehouse','Enclosed','catch','language','status','<tbody\x20style=\x22text-align:\x20center;\x22>','filter','New_Qty_Converted','$product_details.maxProducts','There\x27s\x20a\x20error\x20in\x20this\x20transaction','getDate','express','then','$product_details._id','Finished\x20Goods','<!DOCTYPE\x20html>','$product_details.isle','$name','product_details','Rack\x201','get','German','<html><head><title></title>','date','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.pallet','$product_details','$product_details.product_name','<tr>','nodemailer','maxPerUnit','$product_details.bin','$product_details.floorlevel','</h5>','Error\x20Occurs','site_title','json','to_quantity','expiry_date','$from_warehouse','</body></html>','$product_details.storage','$product_details.invoice','Product\x20Transfer\x20successfully','prod_cat','save','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','exports','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','from_invoice','to_room','</tbody>','findById','user','_id','to_bay','primary_unit','/view/:id','An\x20error\x20occurred.','post'];a0_0x8b18=function(){return _0x326414;};return a0_0x8b18();}router[a0_0x1204d2(0x1c5)](a0_0x1204d2(0x192),auth,async(_0x3e97aa,_0x110bd3)=>{var _0xd49c33=a0_0x1204d2;try{const {username:_0x4f40ff,email:_0x532034,role:_0x44470e}=_0x3e97aa[_0xd49c33(0x10f)],_0x474781=_0x3e97aa[_0xd49c33(0x10f)],_0x2df5f8=await profile['findOne']({'email':_0x474781['email']}),_0x15e19f=await master_shop[_0xd49c33(0x1b0)]();let _0x304ecc;if(_0x474781[_0xd49c33(0x15a)]==_0xd49c33(0x1a8)){const _0x4fbd42=await staff[_0xd49c33(0x156)]({'email':_0x474781[_0xd49c33(0x125)]});_0x304ecc=await transfers_finished[_0xd49c33(0x1b0)]({'from_warehouse':_0x4fbd42[_0xd49c33(0x133)]});}else _0x304ecc=await transfers_finished[_0xd49c33(0x118)]([{'$unwind':'$product'},{'$group':{'_id':_0xd49c33(0x157),'invoice':{'$first':_0xd49c33(0x19c)},'date':{'$first':'$date'},'from_warehouse':{'$first':_0xd49c33(0x1d8)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0xd49c33(0x142)},'to_room_name':{'$addToSet':_0xd49c33(0x13d)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x15e19f[0x0][_0xd49c33(0x1b4)]==_0xd49c33(0x193))var _0x30e8aa=users[_0xd49c33(0x15e)];else{if(_0x15e19f[0x0]['language']==_0xd49c33(0x19e))var _0x30e8aa=users[_0xd49c33(0x19e)];else{if(_0x15e19f[0x0]['language']==_0xd49c33(0x1c6))var _0x30e8aa=users[_0xd49c33(0x1c6)];else{if(_0x15e19f[0x0][_0xd49c33(0x1b4)]==_0xd49c33(0x136))var _0x30e8aa=users[_0xd49c33(0x136)];else{if(_0x15e19f[0x0][_0xd49c33(0x1b4)]==_0xd49c33(0x179))var _0x30e8aa=users[_0xd49c33(0x179)];else{if(_0x15e19f[0x0]['language']==_0xd49c33(0x18e))var _0x30e8aa=users[_0xd49c33(0x195)];else{if(_0x15e19f[0x0][_0xd49c33(0x1b4)]=='Chinese')var _0x30e8aa=users[_0xd49c33(0x11f)];else{if(_0x15e19f[0x0][_0xd49c33(0x1b4)]==_0xd49c33(0x15b))var _0x30e8aa=users[_0xd49c33(0x188)];}}}}}}}_0x110bd3[_0xd49c33(0x162)](_0xd49c33(0x153),{'success':_0x3e97aa[_0xd49c33(0x170)](_0xd49c33(0x13c)),'errors':_0x3e97aa['flash'](_0xd49c33(0x12a)),'role':_0x474781,'profile':_0x2df5f8,'master_shop':_0x15e19f,'transfer':_0x304ecc,'language':_0x30e8aa});}catch(_0x282682){console['log'](_0x282682);}});async function getRandom8DigitNumber(){var _0x3599f8=a0_0x1204d2;const _0x5e74af=0x989680,_0x4f10d0=0x5f5e0ff,_0xe68ac9=Math[_0x3599f8(0x116)](Math[_0x3599f8(0x154)]()*(_0x4f10d0-_0x5e74af+0x1))+_0x5e74af;var _0x3ecd56;const _0x4db1d0=await transfers_finished[_0x3599f8(0x156)]({'invoice':_0x3599f8(0x18d)+_0xe68ac9});return _0x4db1d0&&_0x4db1d0[_0x3599f8(0x159)]>0x0?_0x3ecd56=_0x3599f8(0x18d)+_0xe68ac9:_0x3ecd56=_0x3599f8(0x18d)+_0xe68ac9,_0x3ecd56;}router[a0_0x1204d2(0x1c5)]('/view/add_transfer',auth,async(_0x47c8eb,_0x11c59e)=>{var _0x35563c=a0_0x1204d2;try{const {username:_0xac8aee,email:_0x36972d,role:_0x27482e}=_0x47c8eb[_0x35563c(0x10f)],_0x4379e6=_0x47c8eb[_0x35563c(0x10f)],_0x15cf11=await profile[_0x35563c(0x156)]({'email':_0x4379e6[_0x35563c(0x125)]}),_0x517199=await master_shop[_0x35563c(0x1b0)]();let _0x3cca85;if(_0x4379e6[_0x35563c(0x15a)]==_0x35563c(0x1a8)){const _0x443a42=await staff[_0x35563c(0x156)]({'email':_0x4379e6['email']});_0x3cca85=await warehouse[_0x35563c(0x118)]([{'$match':{'status':'Enabled','name':_0x443a42['warehouse'],'warehouse_category':_0x35563c(0x1bf),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x35563c(0x1c2),'name':{'$first':_0x35563c(0x1c2)}}}]);}else _0x3cca85=await warehouse[_0x35563c(0x118)]([{'$match':{'status':_0x35563c(0x14c),'warehouse_category':_0x35563c(0x1bf),'name':{'$ne':_0x35563c(0x12f)}}},{'$group':{'_id':_0x35563c(0x1c2),'name':{'$first':_0x35563c(0x1c2)}}}]);const _0x1ba38b=await transfers_finished[_0x35563c(0x1b0)]({}),_0x3bfa30=_0x1ba38b[_0x35563c(0x159)]+0x1,_0x4cd424='TRFF-'+_0x3bfa30[_0x35563c(0x1a1)]()[_0x35563c(0x145)](0x5,'0');if(_0x517199[0x0][_0x35563c(0x1b4)]==_0x35563c(0x193))var _0x273e20=users[_0x35563c(0x15e)];else{if(_0x517199[0x0]['language']=='Hindi')var _0x273e20=users[_0x35563c(0x19e)];else{if(_0x517199[0x0][_0x35563c(0x1b4)]==_0x35563c(0x1c6))var _0x273e20=users[_0x35563c(0x1c6)];else{if(_0x517199[0x0]['language']==_0x35563c(0x136))var _0x273e20=users['Spanish'];else{if(_0x517199[0x0][_0x35563c(0x1b4)]=='French')var _0x273e20=users[_0x35563c(0x179)];else{if(_0x517199[0x0]['language']=='Portuguese\x20(BR)')var _0x273e20=users[_0x35563c(0x195)];else{if(_0x517199[0x0]['language']==_0x35563c(0x11f))var _0x273e20=users['Chinese'];else{if(_0x517199[0x0]['language']==_0x35563c(0x15b))var _0x273e20=users['Arabic'];}}}}}}}const _0x242d4b=getRandom8DigitNumber();_0x242d4b[_0x35563c(0x1bd)](_0x4b7a19=>{var _0x2fbce7=_0x35563c;_0x11c59e['render']('add_transfer_finished',{'success':_0x47c8eb[_0x2fbce7(0x170)](_0x2fbce7(0x13c)),'errors':_0x47c8eb[_0x2fbce7(0x170)](_0x2fbce7(0x12a)),'role':_0x4379e6,'profile':_0x15cf11,'master_shop':_0x517199,'warehouse':_0x3cca85,'language':_0x273e20,'invoice':_0x4b7a19});})[_0x35563c(0x1b3)](_0x254e4e=>{var _0x490261=_0x35563c;_0x47c8eb[_0x490261(0x170)]('errors',_0x490261(0x1ba)),_0x11c59e[_0x490261(0x17f)]('/transfer/view');});}catch(_0x425bd9){console[_0x35563c(0x17b)](_0x425bd9);}}),router['post'](a0_0x1204d2(0x144),auth,async(_0x3392ee,_0x16401e)=>{var _0x2f8e08=a0_0x1204d2;try{const {date:_0x46a088,from_warehouse:_0x30f8f5,FromRoom_name:_0x3e2643,to_warehouse:_0x25bfeb,ToRoom_name:_0x2c8da0,prod_name:_0x41e7ee,from_prod_qty:_0x91ec3a,from_prod_level:_0x1c4ebe,from_prod_isle:_0x7059e8,from_prod_pallet:_0x3b0605,to_prod_qty:_0x427b86,to_prod_level:_0x5b65ed,to_prod_isle:_0x3496ff,to_prod_pallet:_0x9d1b0,primary_code:_0x4ab3d3,secondary_code:_0x35baf7,product_code3:_0x13013c,note:_0x3450a3,MaxStocks_data2:_0x25a267,invoice:_0x4e2e13,expiry_date:_0x1b1423}=_0x3392ee[_0x2f8e08(0x168)];if(typeof _0x41e7ee==_0x2f8e08(0x17e))var _0x279fa4=[_0x3392ee['body']['prod_name']],_0x32a8c2=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1af)]],_0x525d1a=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1ad)]],_0xbd866=[_0x3392ee[_0x2f8e08(0x168)]['New_Qty_Converted']],_0x2eeac4=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x12e)]],_0x30f89a=[_0x3392ee['body'][_0x2f8e08(0x178)]],_0x17d15a=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1a5)]],_0x4a7ec6=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x189)]],_0xc614aa=[_0x3392ee['body'][_0x2f8e08(0x119)]],_0x38f4f3=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x112)]],_0x511622=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1a2)]],_0x2d9b26=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x12c)]],_0x53654a=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1d7)]],_0x1c56c3=[_0x3392ee['body']['product_date']],_0x1428c5=[_0x3392ee['body'][_0x2f8e08(0x196)]],_0x3e2cea=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1cf)]],_0x1b0a43=[_0x3392ee['body'][_0x2f8e08(0x1dd)]],_0x2b6fbf=[_0x3392ee['body'][_0x2f8e08(0x130)]],_0x1fe0f8=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x146)]],_0x187e04=[_0x3392ee[_0x2f8e08(0x168)]['from_invoice']],_0xfc4eda=[_0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x120)]];else var _0x279fa4=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x134)]],_0x32a8c2=[..._0x3392ee[_0x2f8e08(0x168)]['from_prod_qty']],_0x525d1a=[..._0x3392ee[_0x2f8e08(0x168)]['from_prod_level']],_0xbd866=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1b8)]],_0x2eeac4=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x12e)]],_0x30f89a=[..._0x3392ee[_0x2f8e08(0x168)]['primary_code']],_0x17d15a=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1a5)]],_0x4a7ec6=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x189)]],_0xc614aa=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x119)]],_0x38f4f3=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x112)]],_0x511622=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1a2)]],_0x2d9b26=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x12c)]],_0x53654a=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1d7)]],_0x1c56c3=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x13a)]],_0x1428c5=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x196)]],_0x3e2cea=[..._0x3392ee[_0x2f8e08(0x168)]['maxPerUnit']],_0x1b0a43=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x1dd)]],_0x2b6fbf=[..._0x3392ee[_0x2f8e08(0x168)]['RoomAssigned']],_0x1fe0f8=[..._0x3392ee['body'][_0x2f8e08(0x146)]],_0x187e04=[..._0x3392ee[_0x2f8e08(0x168)]['from_invoice']],_0xfc4eda=[..._0x3392ee[_0x2f8e08(0x168)][_0x2f8e08(0x120)]];const _0x3a501b=_0x279fa4[_0x2f8e08(0x13b)](_0x5a8401=>{return _0x5a8401={'product_name':_0x5a8401};});_0x32a8c2[_0x2f8e08(0x198)]((_0x409b30,_0xcb43e)=>{var _0x7b844e=_0x2f8e08;_0x3a501b[_0xcb43e][_0x7b844e(0x14b)]=_0x409b30;}),_0x525d1a[_0x2f8e08(0x198)]((_0x2dd002,_0x51a9f1)=>{var _0x26114c=_0x2f8e08;_0x3a501b[_0x51a9f1][_0x26114c(0x150)]=_0x2dd002;}),_0x187e04[_0x2f8e08(0x198)]((_0x5c955b,_0xa10e31)=>{var _0x14b884=_0x2f8e08;_0x3a501b[_0xa10e31][_0x14b884(0x10b)]=_0x5c955b;}),_0xfc4eda[_0x2f8e08(0x198)]((_0x291797,_0x238422)=>{var _0x2ed267=_0x2f8e08;_0x3a501b[_0x238422][_0x2ed267(0x14e)]=_0x291797;}),_0xbd866[_0x2f8e08(0x198)]((_0x57f2d1,_0xeadac)=>{_0x3a501b[_0xeadac]['to_quantity']=_0x57f2d1;}),_0x2eeac4[_0x2f8e08(0x198)]((_0x12b624,_0x130eee)=>{var _0x36583d=_0x2f8e08;_0x3a501b[_0x130eee][_0x36583d(0x111)]=_0x12b624;}),_0x30f89a[_0x2f8e08(0x198)]((_0x43c653,_0xa3db0c)=>{_0x3a501b[_0xa3db0c]['primary_code']=_0x43c653;}),_0x17d15a[_0x2f8e08(0x198)]((_0x1afb09,_0x2a69e5)=>{var _0x295525=_0x2f8e08;_0x3a501b[_0x2a69e5][_0x295525(0x1a5)]=_0x1afb09;}),_0x4a7ec6['forEach']((_0x5e47ca,_0x37bca5)=>{var _0x573e40=_0x2f8e08;_0x3a501b[_0x37bca5][_0x573e40(0x15f)]=_0x5e47ca;}),_0xc614aa['forEach']((_0x260c96,_0x1364dc)=>{var _0x1cbc44=_0x2f8e08;_0x3a501b[_0x1364dc][_0x1cbc44(0x158)]=_0x260c96;}),_0x38f4f3[_0x2f8e08(0x198)]((_0x3d1e3b,_0x4ace1d)=>{var _0x163cfd=_0x2f8e08;_0x3a501b[_0x4ace1d][_0x163cfd(0x17d)]=_0x3d1e3b;}),_0x511622[_0x2f8e08(0x198)]((_0x4b8e63,_0x5eb58d)=>{_0x3a501b[_0x5eb58d]['secondary_unit']=_0x4b8e63;}),_0x2d9b26[_0x2f8e08(0x198)]((_0x17ef60,_0x1bd5b1)=>{var _0x20948e=_0x2f8e08;_0x3a501b[_0x1bd5b1][_0x20948e(0x12c)]=_0x17ef60;}),_0x53654a['forEach']((_0x18942a,_0x3276fa)=>{var _0x218e34=_0x2f8e08;_0x3a501b[_0x3276fa][_0x218e34(0x1d7)]=_0x18942a;}),_0x1c56c3['forEach']((_0x38148e,_0x4ea4cd)=>{var _0x2d7cc2=_0x2f8e08;_0x3a501b[_0x4ea4cd][_0x2d7cc2(0x14a)]=_0x38148e;}),_0x1428c5['forEach']((_0x4469cd,_0x56a41d)=>{_0x3a501b[_0x56a41d]['maxProducts']=_0x4469cd;}),_0x3e2cea[_0x2f8e08(0x198)]((_0x3916ed,_0x5f3e17)=>{var _0x343c9c=_0x2f8e08;_0x3a501b[_0x5f3e17][_0x343c9c(0x1cf)]=_0x3916ed;}),_0x1b0a43[_0x2f8e08(0x198)]((_0x46bbe8,_0x34d2a4)=>{var _0xe45b89=_0x2f8e08;_0x3a501b[_0x34d2a4][_0xe45b89(0x1dd)]=_0x46bbe8;}),_0x2b6fbf[_0x2f8e08(0x198)]((_0x4a59c9,_0x196901)=>{var _0x4a1f72=_0x2f8e08;_0x3a501b[_0x196901][_0x4a1f72(0x169)]=_0x4a59c9;}),_0x1fe0f8[_0x2f8e08(0x198)]((_0x4d0a7a,_0x323490)=>{var _0x1949f9=_0x2f8e08;_0x3a501b[_0x323490][_0x1949f9(0x175)]=_0x4d0a7a;});const _0x4a87ea=_0x3a501b[_0x2f8e08(0x1b7)](_0x3360c4=>_0x3360c4['to_quantity']!=='0'&&_0x3360c4[_0x2f8e08(0x1d6)]!==''||_0x3360c4[_0x2f8e08(0x194)]!=='0'&&_0x3360c4[_0x2f8e08(0x194)]!=='');var _0x30b056=0x0;_0x4a87ea['forEach'](_0x10f0e3=>{var _0x36819d=_0x2f8e08;parseInt(_0x10f0e3[_0x36819d(0x14b)])<parseInt(_0x10f0e3[_0x36819d(0x1d6)])&&_0x30b056++;});if(_0x30b056!=0x0)return _0x3392ee[_0x2f8e08(0x170)](_0x2f8e08(0x12a),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x16401e[_0x2f8e08(0x17f)](_0x2f8e08(0x128));const _0xb87131=new transfers_finished({'date':_0x46a088,'from_warehouse':_0x30f8f5,'to_warehouse':_0x25bfeb,'product':_0x4a87ea,'note':_0x3450a3,'invoice':_0x4e2e13}),_0x4485ad=await _0xb87131['save']();_0x3392ee['flash'](_0x2f8e08(0x13c),_0x2f8e08(0x1dc)),_0x16401e[_0x2f8e08(0x17f)](_0x2f8e08(0x147)+_0x4485ad['_id']);}catch(_0x406ac9){console['log'](_0x406ac9),_0x16401e[_0x2f8e08(0x1b5)](0xc8)[_0x2f8e08(0x1d5)]({'errorMessage':_0x406ac9['message']});}}),router[a0_0x1204d2(0x1c5)](a0_0x1204d2(0x165),auth,async(_0xcdad43,_0x177dd7)=>{var _0x35034a=a0_0x1204d2;try{const {username:_0x5a6fb4,email:_0xc4c903,role:_0x376645}=_0xcdad43[_0x35034a(0x10f)],_0x1662cc=_0xcdad43['user'],_0x3d5dae=await profile['findOne']({'email':_0x1662cc['email']}),_0x1f7e55=await master_shop['find'](),_0x5a7397=await transfers_finished['findById'](_0xcdad43[_0x35034a(0x12d)]['id']);let _0x3f39bc;if(_0x1662cc['role']==_0x35034a(0x1a8)){const _0x32aed8=await staff[_0x35034a(0x156)]({'email':_0x1662cc[_0x35034a(0x125)]});_0x3f39bc=await warehouse[_0x35034a(0x1b0)]({'status':'Enabled','name':_0x32aed8[_0x35034a(0x133)],'warehouse_category':_0x35034a(0x1bf)});}else _0x3f39bc=await warehouse[_0x35034a(0x1b0)]({'status':_0x35034a(0x14c),'warehouse_category':'Finished\x20Goods'});const _0x476096=await warehouse[_0x35034a(0x118)]([{'$match':{'name':_0x5a7397['from_warehouse'],'warehouse_category':_0x35034a(0x1bf)}},{'$unwind':_0x35034a(0x1cb)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x35034a(0x122)},'bay':{'$first':_0x35034a(0x149)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x35034a(0x18f)},'floorlevel':{'$first':_0x35034a(0x1d1)},'primary_code':{'$first':_0x35034a(0x143)},'secondary_code':{'$first':_0x35034a(0x163)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x35034a(0x1da)},'rack':{'$first':_0x35034a(0x1df)},'expiry_date':{'$first':_0x35034a(0x18a)},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':_0x35034a(0x197)},'warehoue_name':{'$first':_0x35034a(0x1c2)}}}]),_0x317770=await product[_0x35034a(0x1b0)]({});if(_0x1f7e55[0x0]['language']==_0x35034a(0x193)){var _0x11463d=users['English'];console[_0x35034a(0x17b)](_0x11463d);}else{if(_0x1f7e55[0x0][_0x35034a(0x1b4)]=='Hindi')var _0x11463d=users[_0x35034a(0x19e)];else{if(_0x1f7e55[0x0][_0x35034a(0x1b4)]==_0x35034a(0x1c6))var _0x11463d=users[_0x35034a(0x1c6)];else{if(_0x1f7e55[0x0]['language']==_0x35034a(0x136))var _0x11463d=users['Spanish'];else{if(_0x1f7e55[0x0]['language']==_0x35034a(0x179))var _0x11463d=users['French'];else{if(_0x1f7e55[0x0][_0x35034a(0x1b4)]==_0x35034a(0x18e))var _0x11463d=users['Portuguese'];else{if(_0x1f7e55[0x0][_0x35034a(0x1b4)]==_0x35034a(0x11f))var _0x11463d=users[_0x35034a(0x11f)];else{if(_0x1f7e55[0x0][_0x35034a(0x1b4)]==_0x35034a(0x15b))var _0x11463d=users[_0x35034a(0x188)];}}}}}}}_0x177dd7[_0x35034a(0x162)](_0x35034a(0x13e),{'success':_0xcdad43[_0x35034a(0x170)]('success'),'errors':_0xcdad43['flash'](_0x35034a(0x12a)),'role':_0x1662cc,'profile':_0x3d5dae,'master_shop':_0x1f7e55,'warehouse':_0x3f39bc,'transfer':_0x5a7397,'stock':_0x476096,'unit':_0x317770,'language':_0x11463d});}catch(_0x4f705f){console[_0x35034a(0x17b)](_0x4f705f);}}),router[a0_0x1204d2(0x115)](a0_0x1204d2(0x165),auth,async(_0x367a4e,_0x2ac176)=>{var _0x371fe4=a0_0x1204d2;try{const {invoice:_0x99ada7,from_warehouse:_0x2f2d30,FromRoom_name:_0x577443,to_warehouse:_0x11eb02,ToRoom_name:_0x2ff8e0}=_0x367a4e[_0x371fe4(0x168)],_0x3f39df=await transfers_finished[_0x371fe4(0x10e)](_0x367a4e['params']['id']),_0x4f0d23=_0x3f39df[_0x371fe4(0x121)][_0x371fe4(0x13b)](async _0x5799d3=>{var _0x5df093=_0x371fe4;if(_0x5799d3['to_quantity']>0x0){var _0x2c69b9=await warehouse['findOne']({'name':_0x2f2d30,'room':_0x5799d3['from_room_name'],'warehouse_category':_0x5df093(0x1bf)});const _0x136b1c=_0x2c69b9[_0x5df093(0x1c3)][_0x5df093(0x13b)](_0x5ee63e=>{var _0x276052=_0x5df093;_0x5ee63e[_0x276052(0x14f)]==_0x5799d3[_0x276052(0x14f)]&&_0x5ee63e['bay']==_0x5799d3[_0x276052(0x150)]&&_0x5ee63e[_0x276052(0x1d7)]==_0x5799d3[_0x276052(0x1d7)]&&_0x5ee63e['production_date']==_0x5799d3[_0x276052(0x14a)]&&_0x5ee63e[_0x276052(0x12c)]==_0x5799d3[_0x276052(0x12c)]&&_0x5ee63e[_0x276052(0x152)]==_0x5799d3[_0x276052(0x10b)]&&(_0x5ee63e[_0x276052(0x16e)]=_0x5ee63e[_0x276052(0x16e)]-_0x5799d3[_0x276052(0x1d6)]);});}return _0x2c69b9;});Promise[_0x371fe4(0x140)](_0x4f0d23)['then'](async _0x12a870=>{var _0x331daf=_0x371fe4;try{for(const _0x41b28a of _0x12a870){await _0x41b28a[_0x331daf(0x1de)]();}const _0x309d6e=_0x3f39df['product']['map'](async _0x4221e0=>{var _0x3d906b=_0x331daf,_0x5e6545=await warehouse[_0x3d906b(0x156)]({'name':_0x11eb02,'room':_0x4221e0['to_room_name']});if(_0x4221e0[_0x3d906b(0x1d6)]>0x0){var _0x59b485=0x0;const _0x2bf3f1=_0x5e6545[_0x3d906b(0x1c3)]['map'](_0xea0c7f=>{var _0xa1254f=_0x3d906b;_0xea0c7f[_0xa1254f(0x14f)]==_0x4221e0[_0xa1254f(0x14f)]&&_0xea0c7f[_0xa1254f(0x182)]==_0x4221e0[_0xa1254f(0x111)]&&_0xea0c7f[_0xa1254f(0x1d7)]==_0x4221e0[_0xa1254f(0x1d7)]&&_0xea0c7f['production_date']==_0x4221e0[_0xa1254f(0x14a)]&&_0xea0c7f[_0xa1254f(0x12c)]==_0x4221e0[_0xa1254f(0x12c)]&&_0xea0c7f[_0xa1254f(0x152)]==_0x4221e0[_0xa1254f(0x14e)]&&(_0xea0c7f[_0xa1254f(0x16e)]=_0xea0c7f[_0xa1254f(0x16e)]+_0x4221e0[_0xa1254f(0x1d6)],_0x59b485++);});_0x59b485=='0'&&(_0x5e6545[_0x3d906b(0x1c3)]=_0x5e6545[_0x3d906b(0x1c3)]['concat']({'product_name':_0x4221e0['product_name'],'product_stock':_0x4221e0[_0x3d906b(0x1d6)],'bay':_0x4221e0[_0x3d906b(0x111)],'product_code':_0x4221e0[_0x3d906b(0x15f)],'primary_code':_0x4221e0[_0x3d906b(0x178)],'secondary_code':_0x4221e0[_0x3d906b(0x1a5)],'expiry_date':_0x4221e0[_0x3d906b(0x1d7)],'production_date':_0x4221e0[_0x3d906b(0x14a)],'maxProducts':_0x4221e0['maxProducts'],'batch_code':_0x4221e0[_0x3d906b(0x12c)],'secondary_unit':_0x4221e0[_0x3d906b(0x1a2)],'unit':_0x4221e0[_0x3d906b(0x17d)],'maxProducts':_0x4221e0[_0x3d906b(0x158)],'maxPerUnit':_0x4221e0['maxPerUnit'],'invoice':_0x4221e0[_0x3d906b(0x14e)]}));}return _0x5e6545;});Promise[_0x331daf(0x140)](_0x309d6e)[_0x331daf(0x1bd)](async _0x755ae9=>{var _0x177600=_0x331daf;try{for(const _0x24b40f of _0x755ae9){await warehouse['updateOne']({'_id':_0x24b40f['_id']},{'$addToSet':{'product_details':{'$each':_0x24b40f[_0x177600(0x1c3)]}}});}_0x3f39df[_0x177600(0x173)]=_0x177600(0x190);const _0x954023=await _0x3f39df[_0x177600(0x1de)](),_0x5a2dab=await master_shop[_0x177600(0x1b0)](),_0x17b6c0=await email_settings[_0x177600(0x156)](),_0x9aca04=await supervisor_settings['find']();var _0x5c7ebf=_0x3f39df['product'],_0x5016fc='',_0x39bc95;for(_0x39bc95 in _0x5c7ebf){var _0x57fead='FG';_0x3f39df[_0x177600(0x1b1)]==_0x177600(0x183)&&(_0x57fead='DG'),_0x5016fc+=_0x177600(0x1cd)+_0x177600(0x184)+_0x5c7ebf[_0x39bc95][_0x177600(0x14f)]+_0x177600(0x109)+_0x177600(0x184)+_0x5c7ebf[_0x39bc95][_0x177600(0x15f)]+_0x177600(0x109)+_0x177600(0x184)+_0x5c7ebf[_0x39bc95][_0x177600(0x1d6)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c7ebf[_0x39bc95][_0x177600(0x17d)]+_0x177600(0x109)+_0x177600(0x184)+_0x5c7ebf[_0x39bc95]['secondary_unit']+'</td>'+_0x177600(0x184)+_0x3f39df[_0x177600(0x1b1)]+_0x177600(0x109)+_0x177600(0x184)+_0x5c7ebf[_0x39bc95][_0x177600(0x175)]+_0x177600(0x109)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57fead+_0x5c7ebf[_0x39bc95]['to_bay']+_0x177600(0x109)+_0x177600(0x148);}let _0x41935a=nodemailer[_0x177600(0x1aa)]({'host':_0x17b6c0[_0x177600(0x139)],'port':Number(_0x17b6c0[_0x177600(0x19d)]),'secure':![],'auth':{'user':_0x17b6c0[_0x177600(0x125)],'pass':_0x17b6c0[_0x177600(0x164)]}}),_0x161b47={'from':_0x17b6c0['email'],'to':_0x9aca04[0x0][_0x177600(0x181)],'subject':'Transfer\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x177600(0x124)+'/upload/'+_0x5a2dab[0x0]['image'],'cid':'logo'}],'html':_0x177600(0x1c0)+_0x177600(0x1c7)+_0x177600(0x171)+_0x177600(0x126)+_0x177600(0x151)+_0x177600(0x126)+_0x177600(0x18b)+'</div>'+'<div>'+'<h2>\x20'+_0x5a2dab[0x0][_0x177600(0x1d4)]+'\x20</h2>'+_0x177600(0x135)+_0x177600(0x135)+_0x177600(0x18c)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x3f39df[_0x177600(0x152)]+'\x20'+_0x177600(0x15c)+_0x177600(0x13f)+_0x3f39df[_0x177600(0x1c8)]+'\x20'+_0x177600(0x132)+_0x177600(0x1d2)+_0x177600(0x135)+_0x177600(0x11d)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x177600(0x1cd)+_0x177600(0x199)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x177600(0x137)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x177600(0x1e0)+_0x177600(0x10a)+_0x177600(0x16a)+_0x177600(0x148)+_0x177600(0x1a9)+_0x177600(0x1b6)+'\x20'+_0x5016fc+'\x20'+_0x177600(0x10d)+_0x177600(0x11b)+'<div>'+_0x177600(0x19a)+_0x177600(0x11e)+_0x5a2dab[0x0]['site_title']+_0x177600(0x1d2)+'</div>'+_0x177600(0x135)+_0x177600(0x1d9)};_0x41935a[_0x177600(0x186)](_0x161b47,function(_0x106631,_0xaff064){var _0x2c2fda=_0x177600;_0x106631?(console[_0x2c2fda(0x17b)](_0x106631),console[_0x2c2fda(0x17b)](_0x2c2fda(0x1d3))):console[_0x2c2fda(0x17b)](_0x2c2fda(0x1ab));}),_0x367a4e[_0x177600(0x170)]('success','Transfer\x20Finalize\x20Successfully'),_0x2ac176[_0x177600(0x17f)](_0x177600(0x185)+_0x954023[_0x177600(0x110)]);}catch(_0x4cfea5){console[_0x177600(0x127)](_0x4cfea5),_0x2ac176[_0x177600(0x1b5)](0x1f4)[_0x177600(0x1d5)]({'error':_0x177600(0x15d)});}})[_0x331daf(0x1b3)](_0xa08518=>{var _0x262226=_0x331daf;console['error'](_0xa08518),_0x2ac176[_0x262226(0x1b5)](0x1f4)[_0x262226(0x1d5)]({'error':'An\x20error\x20occurred.'});});}catch(_0x22ba36){console['error'](_0x22ba36),_0x2ac176['status'](0x1f4)['json']({'error':_0x331daf(0x12b)});}})[_0x371fe4(0x1b3)](_0x1cc2a6=>{var _0x2ec486=_0x371fe4;console[_0x2ec486(0x127)](_0x1cc2a6),_0x2ac176['status'](0x1f4)[_0x2ec486(0x1d5)]({'error':_0x2ec486(0x114)});});}catch(_0x47ee45){_0x2ac176['json']({'message':_0x47ee45[_0x371fe4(0x11a)]});}});function a0_0x2498(_0x3edf3f,_0x127143){var _0x8b18df=a0_0x8b18();return a0_0x2498=function(_0x249881,_0x4398b6){_0x249881=_0x249881-0x109;var _0x23fa28=_0x8b18df[_0x249881];return _0x23fa28;},a0_0x2498(_0x3edf3f,_0x127143);}function BayBinSelected(_0x6b4aa4,_0x16bda8){var _0x53889f=a0_0x1204d2,_0x1bcf5=[];let _0x1f218d=[];var _0x5d70c8=[];if(_0x6b4aa4==_0x53889f(0x183)){switch(_0x16bda8){case'Rack\x201':_0x1bcf5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x53889f(0x160):_0x1bcf5=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5d70c8=['DG'];}else{if(_0x6b4aa4=='FROZEN\x20GOODS'){switch(_0x16bda8){case _0x53889f(0x1c4):_0x1bcf5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x53889f(0x160):_0x1bcf5=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5d70c8=['FG'];}}return{'levels':_0x1bcf5,'identify':_0x5d70c8};}router['get'](a0_0x1204d2(0x113),auth,async(_0x30a906,_0x350ec2)=>{var _0x27d98a=a0_0x1204d2;try{const {username:_0x468bc3,email:_0x3bb035,role:_0x35a3e1}=_0x30a906[_0x27d98a(0x10f)],_0x267a05=_0x30a906[_0x27d98a(0x10f)],_0x54e785=await profile[_0x27d98a(0x156)]({'email':_0x267a05[_0x27d98a(0x125)]}),_0x325f5a=await master_shop[_0x27d98a(0x1b0)](),_0x4e2130=await transfers_finished['findById'](_0x30a906[_0x27d98a(0x12d)]['id']);let _0x11581e=new Date(_0x4e2130[_0x27d98a(0x1d7)]),_0x29588f=('0'+_0x11581e[_0x27d98a(0x1bb)]())[_0x27d98a(0x138)](-0x2),_0x148986=('0'+(_0x11581e[_0x27d98a(0x14d)]()+0x1))[_0x27d98a(0x138)](-0x2),_0xb5664f=_0x11581e[_0x27d98a(0x141)](),_0x41dfbe=_0xb5664f+'-'+_0x148986+'-'+_0x29588f,_0x49f489;if(_0x267a05[_0x27d98a(0x15a)]==_0x27d98a(0x1a8)){const _0x2fff95=await staff[_0x27d98a(0x156)]({'email':_0x267a05['email']});_0x49f489=await warehouse[_0x27d98a(0x1b0)]({'status':_0x27d98a(0x14c),'name':_0x2fff95['warehouse'],'warehouse_category':_0x27d98a(0x1bf)});}else _0x49f489=await warehouse['find']({'status':_0x27d98a(0x14c),'warehouse_category':_0x27d98a(0x1bf)});const _0x36c898=await warehouse[_0x27d98a(0x118)]([{'$match':{'name':_0x4e2130[_0x27d98a(0x187)],'room':_0x4e2130['from_room']}},{'$unwind':_0x27d98a(0x1cb)},{'$group':{'_id':_0x27d98a(0x1be),'name':{'$first':_0x27d98a(0x1cc)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x27d98a(0x149)},'bin':{'$first':_0x27d98a(0x1d0)},'type':{'$first':_0x27d98a(0x18f)},'floorlevel':{'$first':_0x27d98a(0x1d1)},'primary_code':{'$first':_0x27d98a(0x143)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x27d98a(0x1da)},'rack':{'$first':_0x27d98a(0x1df)}}}]);var _0x1bcd9d=[0x1,0x2,0x3,0x4],_0x2cd80d=['A','B','C','D','E','F','G','H','I','J'],_0x519097=[_0x27d98a(0x1ae),_0x27d98a(0x1b2)];const _0x1d064c=await product[_0x27d98a(0x1b0)]({}),_0x42c959=BayBinSelected(_0x4e2130[_0x27d98a(0x1b1)],_0x4e2130[_0x27d98a(0x10c)]);if(_0x325f5a[0x0][_0x27d98a(0x1b4)]==_0x27d98a(0x193)){var _0x45fa01=users['English'];console[_0x27d98a(0x17b)](_0x45fa01);}else{if(_0x325f5a[0x0][_0x27d98a(0x1b4)]==_0x27d98a(0x19e))var _0x45fa01=users[_0x27d98a(0x19e)];else{if(_0x325f5a[0x0][_0x27d98a(0x1b4)]==_0x27d98a(0x1c6))var _0x45fa01=users[_0x27d98a(0x1c6)];else{if(_0x325f5a[0x0][_0x27d98a(0x1b4)]==_0x27d98a(0x136))var _0x45fa01=users['Spanish'];else{if(_0x325f5a[0x0]['language']==_0x27d98a(0x179))var _0x45fa01=users[_0x27d98a(0x179)];else{if(_0x325f5a[0x0][_0x27d98a(0x1b4)]=='Portuguese\x20(BR)')var _0x45fa01=users['Portuguese'];else{if(_0x325f5a[0x0][_0x27d98a(0x1b4)]==_0x27d98a(0x11f))var _0x45fa01=users['Chinese'];else{if(_0x325f5a[0x0]['language']==_0x27d98a(0x15b))var _0x45fa01=users['Arabic'];}}}}}}}_0x350ec2[_0x27d98a(0x162)](_0x27d98a(0x1a4),{'success':_0x30a906[_0x27d98a(0x170)](_0x27d98a(0x13c)),'errors':_0x30a906[_0x27d98a(0x170)](_0x27d98a(0x12a)),'role':_0x267a05,'profile':_0x54e785,'master_shop':_0x325f5a,'warehouse':_0x49f489,'transfer':_0x4e2130,'stock':_0x36c898,'unit':_0x1d064c,'language':_0x45fa01,'levels':_0x1bcd9d,'Isle':_0x2cd80d,'rooms_data':_0x519097,'ed_fullDate':_0x41dfbe,'dataSelected':_0x42c959});}catch(_0x3131a4){console[_0x27d98a(0x17b)](_0x3131a4);}}),router[a0_0x1204d2(0x115)](a0_0x1204d2(0x113),auth,async(_0x61e61f,_0x1e4e5c)=>{var _0x27ebee=a0_0x1204d2;try{const _0x14f291=_0x61e61f[_0x27ebee(0x12d)]['id'];console[_0x27ebee(0x17b)](_0x61e61f[_0x27ebee(0x168)]);const _0xd36714=await transfers_finished[_0x27ebee(0x10e)](_0x14f291);console['log'](_0x27ebee(0x16d),_0xd36714);const {date:_0x110f35,from_warehouse:_0x490b08,FromRoom_name:_0x198a57,to_warehouse:_0x1395f7,ToRoom_name:_0x352f2d,prod_name:_0x2b8063,from_prod_qty:_0x5cd9c3,from_prod_level:_0x15e32b,from_prod_isle:_0x5cfede,from_prod_pallet:_0x4e8ad1,to_prod_qty:_0x4bc186,to_prod_level:_0x5d319a,to_prod_isle:_0x26f433,to_prod_pallet:_0x2f84e3,primary_code:_0x56e956,secondary_code:_0x3a3e66,product_code3:_0x50a31b,note:_0x44b12f,invoice:_0x196328,expiry_date:_0x5a48af}=_0x61e61f[_0x27ebee(0x168)];if(typeof _0x2b8063=='string')var _0x30702b=[_0x61e61f[_0x27ebee(0x168)]['prod_name']],_0x309fc7=[_0x61e61f[_0x27ebee(0x168)]['from_prod_qty']],_0x12195d=[_0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1ad)]],_0x4a5fe7=[_0x61e61f['body']['to_prod_qty']],_0x3ee47d=[_0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x12e)]],_0x4a5970=[_0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x178)]],_0x2751a5=[_0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1a5)]],_0x51ceed=[_0x61e61f[_0x27ebee(0x168)]['product_code3']],_0x950463=[_0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x119)]],_0x5caa8a=[_0x61e61f['body']['unit']],_0x271aae=[_0x61e61f['body'][_0x27ebee(0x1a2)]],_0xe2d77d=[_0x61e61f['body']['batch_code']],_0x19f31f=[_0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1d7)]];else var _0x30702b=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x134)]],_0x309fc7=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1af)]],_0x12195d=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1ad)]],_0x4a5fe7=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x172)]],_0x3ee47d=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x12e)]],_0x4a5970=[..._0x61e61f[_0x27ebee(0x168)]['primary_code']],_0x2751a5=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1a5)]],_0x51ceed=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x189)]],_0x950463=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x119)]],_0x5caa8a=[..._0x61e61f['body'][_0x27ebee(0x17d)]],_0x271aae=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x1a2)]],_0xe2d77d=[..._0x61e61f[_0x27ebee(0x168)][_0x27ebee(0x12c)]],_0x19f31f=[..._0x61e61f[_0x27ebee(0x168)]['expiry_date']];const _0x6eb5be=_0x30702b[_0x27ebee(0x13b)](_0x4b8fdc=>{return _0x4b8fdc={'product_name':_0x4b8fdc};});_0x309fc7[_0x27ebee(0x198)]((_0x5c6f61,_0x1f8cd3)=>{_0x6eb5be[_0x1f8cd3]['from_quantity']=_0x5c6f61;}),_0x12195d[_0x27ebee(0x198)]((_0xf00d7a,_0x52336d)=>{var _0x231acb=_0x27ebee;_0x6eb5be[_0x52336d][_0x231acb(0x150)]=_0xf00d7a;}),_0x4a5fe7['forEach']((_0x2e716a,_0xde5046)=>{var _0x4cde50=_0x27ebee;_0x6eb5be[_0xde5046][_0x4cde50(0x1d6)]=_0x2e716a;}),_0x3ee47d[_0x27ebee(0x198)]((_0x12ea54,_0x5abe36)=>{var _0x37fdf2=_0x27ebee;_0x6eb5be[_0x5abe36][_0x37fdf2(0x111)]=_0x12ea54;}),_0x4a5970['forEach']((_0x2b8b86,_0xf64b47)=>{var _0x4d31fa=_0x27ebee;_0x6eb5be[_0xf64b47][_0x4d31fa(0x178)]=_0x2b8b86;}),_0x2751a5['forEach']((_0x75d3c3,_0x55c185)=>{var _0x5c56a6=_0x27ebee;_0x6eb5be[_0x55c185][_0x5c56a6(0x1a5)]=_0x75d3c3;}),_0x51ceed[_0x27ebee(0x198)]((_0x255c72,_0x52fd53)=>{_0x6eb5be[_0x52fd53]['product_code']=_0x255c72;}),_0x950463[_0x27ebee(0x198)]((_0x490936,_0x24eb39)=>{_0x6eb5be[_0x24eb39]['maxProducts']=_0x490936;}),_0x5caa8a[_0x27ebee(0x198)]((_0x34837b,_0x3636be)=>{var _0x439060=_0x27ebee;_0x6eb5be[_0x3636be][_0x439060(0x17d)]=_0x34837b;}),_0x271aae['forEach']((_0x1407e2,_0x29c264)=>{_0x6eb5be[_0x29c264]['secondary_unit']=_0x1407e2;}),_0xe2d77d[_0x27ebee(0x198)]((_0x27b813,_0x17f785)=>{var _0x36d065=_0x27ebee;_0x6eb5be[_0x17f785][_0x36d065(0x12c)]=_0x27b813;}),_0x19f31f[_0x27ebee(0x198)]((_0xf23c45,_0x553f14)=>{var _0x59f87b=_0x27ebee;_0x6eb5be[_0x553f14][_0x59f87b(0x1d7)]=_0xf23c45;});const _0x403613=_0x6eb5be['filter'](_0x2b6c08=>_0x2b6c08[_0x27ebee(0x1d6)]!=='0'&&_0x2b6c08['to_quantity']!==''||_0x2b6c08[_0x27ebee(0x194)]!=='0'&&_0x2b6c08[_0x27ebee(0x194)]!=='');var _0x17365f=0x0;_0x403613[_0x27ebee(0x198)](_0x2b5a9b=>{var _0x2b1064=_0x27ebee;parseInt(_0x2b5a9b[_0x2b1064(0x14b)])<parseInt(_0x2b5a9b[_0x2b1064(0x1d6)])&&_0x17365f++;});if(_0x17365f!=0x0)return _0x61e61f['flash'](_0x27ebee(0x12a),_0x27ebee(0x1c9)),_0x1e4e5c[_0x27ebee(0x17f)](_0x27ebee(0x128));const _0x1553a5=await warehouse[_0x27ebee(0x156)]({'name':_0xd36714[_0x27ebee(0x187)],'room':_0xd36714[_0x27ebee(0x19b)]});_0xd36714[_0x27ebee(0x121)][_0x27ebee(0x198)](_0xfdaadc=>{var _0x18eb80=_0x27ebee;if(_0xfdaadc['to_quantity']>0x0){const _0x3435fe=_0x1553a5[_0x18eb80(0x1c3)][_0x18eb80(0x13b)](_0xa69edc=>{var _0x553ac3=_0x18eb80;_0xa69edc['product_name']==_0xfdaadc[_0x553ac3(0x14f)]&&_0xa69edc[_0x553ac3(0x182)]==_0xfdaadc['from_bay']&&(_0xa69edc[_0x553ac3(0x16e)]=parseInt(_0xa69edc[_0x553ac3(0x16e)])+parseInt(_0xfdaadc['to_quantity']));});}}),await _0x1553a5['save']();const _0x41b013=await warehouse[_0x27ebee(0x156)]({'name':_0xd36714[_0x27ebee(0x1b1)],'room':_0xd36714[_0x27ebee(0x10c)]});_0xd36714[_0x27ebee(0x121)][_0x27ebee(0x198)](_0x122905=>{var _0x108470=_0x27ebee;if(_0x122905[_0x108470(0x1d6)]>0x0){const _0xc75d3e=_0x41b013['product_details'][_0x108470(0x13b)](_0x5c4850=>{var _0x23d0f1=_0x108470;_0x5c4850[_0x23d0f1(0x14f)]==_0x122905[_0x23d0f1(0x14f)]&&_0x5c4850[_0x23d0f1(0x182)]==_0x122905[_0x23d0f1(0x111)]&&(_0x5c4850[_0x23d0f1(0x16e)]=parseInt(_0x5c4850[_0x23d0f1(0x16e)])-parseInt(_0x122905[_0x23d0f1(0x1d6)]));});}}),await _0x41b013[_0x27ebee(0x1de)](),_0xd36714[_0x27ebee(0x1c8)]=_0x110f35,_0xd36714[_0x27ebee(0x187)]=_0x490b08,_0xd36714[_0x27ebee(0x1b1)]=_0x1395f7,_0xd36714[_0x27ebee(0x121)]=_0x403613,_0xd36714[_0x27ebee(0x17a)]=_0x44b12f,_0xd36714[_0x27ebee(0x152)]=_0x196328;const _0x3c6d2e=await _0xd36714[_0x27ebee(0x1de)](),_0x486cca=await warehouse[_0x27ebee(0x156)]({'name':_0x490b08,'room':_0x198a57});_0x3c6d2e[_0x27ebee(0x121)][_0x27ebee(0x198)](_0x1a21e1=>{var _0x2e857d=_0x27ebee;if(_0x1a21e1['to_quantity']>0x0){const _0x94d34e=_0x486cca[_0x2e857d(0x1c3)][_0x2e857d(0x13b)](_0x36e3f4=>{var _0x1269af=_0x2e857d;_0x36e3f4[_0x1269af(0x14f)]==_0x1a21e1[_0x1269af(0x14f)]&&_0x36e3f4['bay']==_0x1a21e1['from_bay']&&(_0x36e3f4[_0x1269af(0x16e)]=parseInt(_0x36e3f4['product_stock'])-parseInt(_0x1a21e1[_0x1269af(0x1d6)]));});}}),await _0x486cca['save']();const _0x5df488=await warehouse[_0x27ebee(0x156)]({'name':_0x1395f7,'room':_0x352f2d});_0x3c6d2e[_0x27ebee(0x121)][_0x27ebee(0x198)](_0x84175c=>{var _0x2454cc=_0x27ebee;if(_0x84175c[_0x2454cc(0x1d6)]>0x0){var _0x3b90ee=0x0;const _0x4987ea=_0x5df488[_0x2454cc(0x1c3)][_0x2454cc(0x13b)](_0x478bcc=>{var _0x4a2c0b=_0x2454cc;_0x478bcc[_0x4a2c0b(0x14f)]==_0x84175c['product_name']&&_0x478bcc[_0x4a2c0b(0x182)]==_0x84175c['to_bay']&&(_0x478bcc[_0x4a2c0b(0x16e)]=parseInt(_0x478bcc[_0x4a2c0b(0x16e)])+parseInt(_0x84175c[_0x4a2c0b(0x1d6)]),_0x3b90ee++);});_0x3b90ee=='0'&&(_0x5df488[_0x2454cc(0x1c3)]=_0x5df488[_0x2454cc(0x1c3)][_0x2454cc(0x17c)]({'product_name':_0x84175c[_0x2454cc(0x14f)],'product_stock':_0x84175c[_0x2454cc(0x1d6)],'bay':_0x84175c[_0x2454cc(0x111)],'product_code':_0x84175c['product_code'],'primary_code':_0x84175c['primary_code'],'secondary_code':_0x84175c['secondary_code'],'maxProducts':_0x84175c['maxProducts']}));}}),await _0x5df488[_0x27ebee(0x1de)](),_0x61e61f[_0x27ebee(0x170)](_0x27ebee(0x13c),_0x27ebee(0x177)),_0x1e4e5c[_0x27ebee(0x17f)]('/transfer_finished/view');}catch(_0x167e08){console[_0x27ebee(0x17b)](_0x167e08);}}),router['post']('/barcode_scanner',async(_0x91fe9e,_0x5119ad)=>{var _0x20bc71=a0_0x1204d2;const {FromWareHouse:_0x13dcb7,FromRoom:_0x6ddcd9,ToWarehouse:_0x34bef5,ToRoom:_0x58722a,primary_code:_0x2647bb,Roomslist:_0x57e0db}=_0x91fe9e[_0x20bc71(0x168)],_0x118b10=_0x57e0db[_0x20bc71(0x167)](','),_0x1965db=[];async function _0xa0861(_0x258e3d){var _0x4a9314=_0x20bc71;const _0x10c5af=await warehouse[_0x4a9314(0x118)]([{'$match':{'name':_0x13dcb7,'room':_0x258e3d}},{'$unwind':_0x4a9314(0x1cb)},{'$match':{'product_details.primary_code':_0x2647bb}},{'$group':{'_id':_0x4a9314(0x1be),'name':{'$first':_0x4a9314(0x1cc)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4a9314(0x143)},'secondary_code':{'$first':_0x4a9314(0x163)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4a9314(0x18f)},'pallet':{'$first':_0x4a9314(0x1d1)},'unit':{'$first':_0x4a9314(0x117)},'secondary_unit':{'$first':_0x4a9314(0x16c)},'storage':{'$first':_0x4a9314(0x1da)},'rack':{'$first':_0x4a9314(0x1df)},'expiry_date':{'$first':_0x4a9314(0x18a)},'production_date':{'$first':_0x4a9314(0x161)},'batch_code':{'$first':_0x4a9314(0x1a7)},'maxPerUnit':{'$first':_0x4a9314(0x155)},'roomNamed':{'$first':_0x4a9314(0x197)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x4a9314(0x1db)}}}]),_0x319280=await warehouse[_0x4a9314(0x118)]([{'$match':{'name':_0x13dcb7,'room':_0x258e3d}},{'$unwind':_0x4a9314(0x1cb)},{'$match':{'product_details.secondary_code':_0x2647bb}},{'$group':{'_id':_0x4a9314(0x1be),'name':{'$first':'$product_details.product_name'},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4a9314(0x163)},'product_code':{'$first':_0x4a9314(0x176)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4a9314(0x18f)},'pallet':{'$first':_0x4a9314(0x1d1)},'unit':{'$first':_0x4a9314(0x117)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4a9314(0x1da)},'rack':{'$first':_0x4a9314(0x1df)},'expiry_date':{'$first':_0x4a9314(0x18a)},'production_date':{'$first':_0x4a9314(0x161)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x4a9314(0x155)},'roomNamed':{'$first':_0x4a9314(0x197)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x10c5af[_0x4a9314(0x159)]>0x0)_0x1965db['push'](_0x10c5af);else _0x319280[_0x4a9314(0x159)]>0x0&&_0x1965db[_0x4a9314(0x1a6)](_0x319280);}const _0xb5ec53=_0x118b10[_0x20bc71(0x13b)](_0x30fe17=>_0xa0861(_0x30fe17));await Promise[_0x20bc71(0x140)](_0xb5ec53),_0x5119ad[_0x20bc71(0x1d5)](_0x1965db);}),router[a0_0x1204d2(0x115)]('/barcode_scanner2',async(_0x4dbd16,_0x53684f)=>{var _0x21d77b=a0_0x1204d2;try{const {FromWareHouse:_0x89b7b6,FromRoom:_0x15cc3b,ToWarehouse:_0x161c4f,ToRoom:_0x34b027,secondary_code:_0x129c0b}=_0x4dbd16[_0x21d77b(0x168)],_0x40b621=await warehouse['aggregate']([{'$match':{'name':_0x89b7b6}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x129c0b}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x21d77b(0x1cc)},'primary_code':{'$first':_0x21d77b(0x143)},'secondary_code':{'$first':_0x21d77b(0x163)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x21d77b(0x122)},'warehouse':{'$first':'$name'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x21d77b(0x1c1)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x21d77b(0x1b9)},'unit':{'$first':_0x21d77b(0x117)},'expiry_date':{'$first':_0x21d77b(0x18a)},'production_date':{'$first':_0x21d77b(0x161)}}}]);_0x53684f[_0x21d77b(0x1b5)](0xc8)[_0x21d77b(0x1d5)](_0x40b621);}catch(_0x3e4324){_0x53684f[_0x21d77b(0x1b5)](0x194)[_0x21d77b(0x1d5)]({'message':_0x3e4324[_0x21d77b(0x11a)]});}}),router[a0_0x1204d2(0x115)](a0_0x1204d2(0x174),async(_0x71401e,_0x352aa3)=>{var _0xa2ebbc=a0_0x1204d2;try{const {FromWareHouse:_0x39fa38,FromRoom:_0x205b8c,ToWarehouse:_0x35bbae,ToRoom:_0x1dc4fd,product_code:_0x18b799}=_0x71401e[_0xa2ebbc(0x168)],_0x5c03b6=await warehouse[_0xa2ebbc(0x118)]([{'$match':{'name':_0x39fa38}},{'$unwind':_0xa2ebbc(0x1cb)},{'$match':{'product_details.product_code':_0x18b799}},{'$group':{'_id':_0xa2ebbc(0x1be),'name':{'$first':_0xa2ebbc(0x1cc)},'primary_code':{'$first':_0xa2ebbc(0x143)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xa2ebbc(0x176)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':_0xa2ebbc(0x1ac)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xa2ebbc(0x1ca)},'maxProducts':{'$first':_0xa2ebbc(0x1b9)},'unit':{'$first':'$product_details.unit'}}}]);_0x352aa3[_0xa2ebbc(0x1b5)](0xc8)[_0xa2ebbc(0x1d5)](_0x5c03b6);}catch(_0x560f19){_0x352aa3[_0xa2ebbc(0x1b5)](0x194)[_0xa2ebbc(0x1d5)]({'message':_0x560f19[_0xa2ebbc(0x11a)]});}}),router[a0_0x1204d2(0x115)](a0_0x1204d2(0x1a3),async(_0x23d873,_0x3763dc)=>{var _0x20de32=a0_0x1204d2;const {productCode:_0x1d6841,bay:_0x3370e7,warehouses:_0x147c7c,room:_0x16bee9}=_0x23d873[_0x20de32(0x168)];console['log'](_0x23d873['body']);try{const _0x2cd603=await warehouse[_0x20de32(0x118)]([{'$match':{'name':_0x147c7c,'room':_0x16bee9}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x3370e7)}},{'$group':{'_id':_0x20de32(0x1be),'name':{'$first':_0x20de32(0x1cc)},'product_stock':{'$first':_0x20de32(0x122)},'bay':{'$first':_0x20de32(0x149)},'maxProducts':{'$first':_0x20de32(0x1b9)}}}]);_0x3763dc[_0x20de32(0x1b5)](0xc8)[_0x20de32(0x1d5)](_0x2cd603);}catch(_0x293829){_0x3763dc['status'](0x194)[_0x20de32(0x1d5)]({'message':_0x293829[_0x20de32(0x11a)]});}}),module[a0_0x1204d2(0x1e1)]=router;