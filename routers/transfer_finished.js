var a0_0x486a30=a0_0x5ef3;function a0_0x5ef3(_0x415b8a,_0x10568d){var _0x1c31dd=a0_0x1c31();return a0_0x5ef3=function(_0x5ef35a,_0x63c78e){_0x5ef35a=_0x5ef35a-0x1ac;var _0x265a11=_0x1c31dd[_0x5ef35a];return _0x265a11;},a0_0x5ef3(_0x415b8a,_0x10568d);}(function(_0x19e5b0,_0x5e1237){var _0x5a8398=a0_0x5ef3,_0x59d47a=_0x19e5b0();while(!![]){try{var _0x162c3a=-parseInt(_0x5a8398(0x1ca))/0x1+parseInt(_0x5a8398(0x28a))/0x2+-parseInt(_0x5a8398(0x281))/0x3*(-parseInt(_0x5a8398(0x201))/0x4)+-parseInt(_0x5a8398(0x245))/0x5+parseInt(_0x5a8398(0x1f3))/0x6+parseInt(_0x5a8398(0x25a))/0x7*(-parseInt(_0x5a8398(0x216))/0x8)+-parseInt(_0x5a8398(0x24f))/0x9*(-parseInt(_0x5a8398(0x1ec))/0xa);if(_0x162c3a===_0x5e1237)break;else _0x59d47a['push'](_0x59d47a['shift']());}catch(_0x3abf2a){_0x59d47a['push'](_0x59d47a['shift']());}}}(a0_0x1c31,0xe5872));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x486a30(0x1ee)),auth=require(a0_0x486a30(0x21b)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x486a30(0x271));function a0_0x1c31(){var _0x346be1=['7PtCbQf','An\x20error\x20occurred.','get','language','maxProducts','$product_details.level','Spanish','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_code','$product_details.type','errors','/view','Rack\x202','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','warehouse','/upload/','$room','note','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','string','$product_details.batch_code','catch','nodemailer','</h5>','Enclosed','$to_warehouse','product_name','from_room_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','to_warehouse','filter','production_date','redirect','</span>','from_quantity','to_room_name','Enabled','$product_details.isle','21JpmKvv','English','\x20</h2>','RoomAssigned','expiry_date','prod_name','</table>','undefined','Error\x20Occurs','2875464WkxiIA','bay','status','from_warehouse','product_details','unit','$product_details.maxProducts','Hindi','findById','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','back','here1','log','MaxStocks_data2','Ambient','<!DOCTYPE\x20html>','New_Qty_Converted','FROZEN\x20GOODS','/transfer/view','prod_cat','password','to_floorlevel','staff','secondary_unit','$product_details.secondary_code','product_date','to_invoice','maxPerUnit','\x20Order\x20Number\x20:\x20','padStart','$product_details.expiry_date','$product_details','1366378Gtrume','to_prod_qty','exports','logo','$product','role','/barcode_scanner3','$product.to_room_name','Transfer\x20Mail','</td>','To_invoice','Transfer\x20Finalize\x20Successfully','$product_details.pallet','all','finalize','product','error','params','body','json','batch_code','/barcode_scanner','id_transaction','English\x20(US)','$product_details.product_name','<h5\x20style=\x22text-align:\x20left;\x22>','to_bay','$finalize','$product_details.secondary_unit','/../public','$product_details.bay','port','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','then','147800alKukk','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','../models/all_models','getDate','find','$product_details.rack','$product.from_room_name','8662476eMbkuc','/CheckingWarehouse','$name','from_prod_qty','<tr>','</div>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','invoice','</head><body>','/view/:id','map','German','product_code','$product_details.maxPerUnit','64964rFUlBF','primary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','Email\x20sent\x20successfully','_id','from_prod_level','/preview/:id','$product_details.bin','$invoice','forEach','Finished\x20Goods','toString','from_invoice','from_room','ToRoomAssigned','Rack\x201','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','render','product_code3','$product_details.storage','date','2985008rYUgQK','DRY\x20GOODS','getFullYear','message','$product_details.product_stock','../middleware/auth','floor','$_id','concat','/picking_list/PDF_transfer/','here2','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Logo.png','</tr>','aggregate','QA\x20Warehouse','French','sendMail','/transfer_finished/preview/','max','length','Portuguese\x20(BR)','TRFF-','Portuguese','Arabic\x20(ae)','slice','$product_details.unit','\x20<>\x20','$product_details.floorlevel','Arabic','transfer_finished','$from_warehouse','/view/add_transfer','edit_transfer_finished','MaxStocks_data','site_title','secondary_code','$product_details.primary_code','Product\x20Transfer\x20successfully','post','Chinese','random','to_room','save','email','from_bay','findOne','1799275FStPJF','add_transfer_finished','$product_details.invoice','transfer_data','<div>','<span\x20style=\x22float:\x20right;\x22>','/barcode_scanner2','user','</tbody>','</thead>','27WjENFm','to_prod_level','success','product_stock','abs','to_quantity','\x20Order\x20Date\x20:\x20','flash','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','split'];a0_0x1c31=function(){return _0x346be1;};return a0_0x1c31();}router['get'](a0_0x486a30(0x265),auth,async(_0x1b650e,_0xbc8a66)=>{var _0x27572b=a0_0x486a30;try{const {username:_0x39fcc3,email:_0x2d6e2e,role:_0xa68436}=_0x1b650e['user'],_0x290b70=_0x1b650e['user'],_0xf7c0db=await profile[_0x27572b(0x244)]({'email':_0x290b70['email']}),_0x4b0d8f=await master_shop[_0x27572b(0x1f0)]();let _0x1fbd9a;if(_0x290b70[_0x27572b(0x1cf)]==_0x27572b(0x1c0)){const _0x337554=await staff[_0x27572b(0x244)]({'email':_0x290b70[_0x27572b(0x242)]});_0x1fbd9a=await transfers_finished[_0x27572b(0x1f0)]({'from_warehouse':_0x337554[_0x27572b(0x268)]});}else _0x1fbd9a=await transfers_finished['aggregate']([{'$unwind':_0x27572b(0x1ce)},{'$group':{'_id':_0x27572b(0x21d),'invoice':{'$first':_0x27572b(0x209)},'date':{'$first':'$date'},'from_warehouse':{'$first':_0x27572b(0x235)},'to_warehouse':{'$first':_0x27572b(0x274)},'from_room_name':{'$addToSet':_0x27572b(0x1f2)},'to_room_name':{'$addToSet':_0x27572b(0x1d1)},'finalize':{'$first':_0x27572b(0x1e5)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x4b0d8f[0x0][_0x27572b(0x25d)]==_0x27572b(0x1e1))var _0x4c891f=users['English'];else{if(_0x4b0d8f[0x0][_0x27572b(0x25d)]=='Hindi')var _0x4c891f=users[_0x27572b(0x1b1)];else{if(_0x4b0d8f[0x0][_0x27572b(0x25d)]==_0x27572b(0x1fe))var _0x4c891f=users['German'];else{if(_0x4b0d8f[0x0][_0x27572b(0x25d)]=='Spanish')var _0x4c891f=users[_0x27572b(0x260)];else{if(_0x4b0d8f[0x0]['language']==_0x27572b(0x226))var _0x4c891f=users['French'];else{if(_0x4b0d8f[0x0]['language']==_0x27572b(0x22b))var _0x4c891f=users[_0x27572b(0x22d)];else{if(_0x4b0d8f[0x0][_0x27572b(0x25d)]=='Chinese')var _0x4c891f=users['Chinese'];else{if(_0x4b0d8f[0x0]['language']==_0x27572b(0x22e))var _0x4c891f=users[_0x27572b(0x233)];}}}}}}}_0xbc8a66['render'](_0x27572b(0x234),{'success':_0x1b650e['flash'](_0x27572b(0x251)),'errors':_0x1b650e['flash'](_0x27572b(0x264)),'role':_0x290b70,'profile':_0xf7c0db,'master_shop':_0x4b0d8f,'transfer':_0x1fbd9a,'language':_0x4c891f});}catch(_0x4bacb1){console['log'](_0x4bacb1);}});async function getRandom8DigitNumber(){var _0x5a0cb6=a0_0x486a30;const _0x5907b4=0x989680,_0x149daf=0x5f5e0ff,_0x5d8230=Math[_0x5a0cb6(0x21c)](Math[_0x5a0cb6(0x23f)]()*(_0x149daf-_0x5907b4+0x1))+_0x5907b4;var _0x101142;const _0x287b9d=await transfers_finished[_0x5a0cb6(0x244)]({'invoice':_0x5a0cb6(0x22c)+_0x5d8230});return _0x287b9d&&_0x287b9d['length']>0x0?_0x101142='TRFF-'+_0x5d8230:_0x101142='TRFF-'+_0x5d8230,_0x101142;}router[a0_0x486a30(0x25c)](a0_0x486a30(0x236),auth,async(_0x299de8,_0x5721e1)=>{var _0x10433e=a0_0x486a30;try{const {username:_0x21279b,email:_0x3cb384,role:_0xbff2b}=_0x299de8[_0x10433e(0x24c)],_0x57722a=_0x299de8['user'],_0x4736e5=await profile[_0x10433e(0x244)]({'email':_0x57722a[_0x10433e(0x242)]}),_0x168198=await master_shop[_0x10433e(0x1f0)]();let _0x55c70d;if(_0x57722a[_0x10433e(0x1cf)]==_0x10433e(0x1c0)){const _0x2a9112=await staff[_0x10433e(0x244)]({'email':_0x57722a[_0x10433e(0x242)]});_0x55c70d=await warehouse[_0x10433e(0x224)]([{'$match':{'status':'Enabled','name':_0x2a9112[_0x10433e(0x268)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x10433e(0x225)}}},{'$group':{'_id':_0x10433e(0x1f5),'name':{'$first':'$name'}}}]);}else _0x55c70d=await warehouse['aggregate']([{'$match':{'status':_0x10433e(0x27f),'warehouse_category':_0x10433e(0x20b),'name':{'$ne':_0x10433e(0x225)}}},{'$group':{'_id':_0x10433e(0x1f5),'name':{'$first':_0x10433e(0x1f5)}}}]);const _0x358817=await transfers_finished[_0x10433e(0x1f0)]({}),_0x56c28e=_0x358817[_0x10433e(0x22a)]+0x1,_0x303983=_0x10433e(0x22c)+_0x56c28e[_0x10433e(0x20c)]()[_0x10433e(0x1c7)](0x5,'0');if(_0x168198[0x0]['language']==_0x10433e(0x1e1))var _0x29dff4=users[_0x10433e(0x282)];else{if(_0x168198[0x0][_0x10433e(0x25d)]==_0x10433e(0x1b1))var _0x29dff4=users[_0x10433e(0x1b1)];else{if(_0x168198[0x0][_0x10433e(0x25d)]=='German')var _0x29dff4=users[_0x10433e(0x1fe)];else{if(_0x168198[0x0]['language']==_0x10433e(0x260))var _0x29dff4=users['Spanish'];else{if(_0x168198[0x0][_0x10433e(0x25d)]==_0x10433e(0x226))var _0x29dff4=users[_0x10433e(0x226)];else{if(_0x168198[0x0]['language']==_0x10433e(0x22b))var _0x29dff4=users[_0x10433e(0x22d)];else{if(_0x168198[0x0][_0x10433e(0x25d)]==_0x10433e(0x23e))var _0x29dff4=users[_0x10433e(0x23e)];else{if(_0x168198[0x0]['language']==_0x10433e(0x22e))var _0x29dff4=users['Arabic'];}}}}}}}const _0x3d3a93=getRandom8DigitNumber();_0x3d3a93['then'](_0x3249a7=>{var _0x3e6a24=_0x10433e;_0x5721e1['render'](_0x3e6a24(0x246),{'success':_0x299de8[_0x3e6a24(0x256)](_0x3e6a24(0x251)),'errors':_0x299de8['flash'](_0x3e6a24(0x264)),'role':_0x57722a,'profile':_0x4736e5,'master_shop':_0x168198,'warehouse':_0x55c70d,'language':_0x29dff4,'invoice':_0x3249a7});})[_0x10433e(0x270)](_0x586aed=>{var _0x490133=_0x10433e;_0x299de8[_0x490133(0x256)](_0x490133(0x264),_0x490133(0x1f9)),_0x5721e1['redirect'](_0x490133(0x1bc));});}catch(_0x273246){console['log'](_0x273246);}}),router[a0_0x486a30(0x23d)](a0_0x486a30(0x236),auth,async(_0x104797,_0x1f0ece)=>{var _0x4cba00=a0_0x486a30;try{const {date:_0x4ee358,from_warehouse:_0x4f605c,FromRoom_name:_0x14bbf8,to_warehouse:_0x3f7f74,ToRoom_name:_0x351949,prod_name:_0x4037de,from_prod_qty:_0x4667da,from_prod_level:_0x20f17a,from_prod_isle:_0x5a227b,from_prod_pallet:_0x304d7d,to_prod_qty:_0x3e91c1,to_prod_level:_0x4ddce4,to_prod_isle:_0x26d58e,to_prod_pallet:_0x302071,primary_code:_0x453b38,secondary_code:_0x3c30cd,product_code3:_0x25f5d1,note:_0x42d427,MaxStocks_data2:_0x22ffaa,invoice:_0x185edb,expiry_date:_0x49be7e}=_0x104797[_0x4cba00(0x1dc)];if(typeof _0x4037de==_0x4cba00(0x26e))var _0x1efbc0=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x286)]],_0x127eac=[_0x104797[_0x4cba00(0x1dc)]['from_prod_qty']],_0x491bd6=[_0x104797[_0x4cba00(0x1dc)]['from_prod_level']],_0xede8ec=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1ba)]],_0x4393e3=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x250)]],_0x251030=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x202)]],_0x592568=[_0x104797[_0x4cba00(0x1dc)]['secondary_code']],_0x406d13=[_0x104797['body'][_0x4cba00(0x213)]],_0x64b5a9=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1b7)]],_0x4c0371=[_0x104797[_0x4cba00(0x1dc)]['primary_unit']],_0x135fa7=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c1)]],_0x4969a8=[_0x104797['body'][_0x4cba00(0x1de)]],_0x1c4a3a=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x285)]],_0x41af6b=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c3)]],_0x1cf3d3=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x238)]],_0x323ee4=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c5)]],_0x5e854a=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1bd)]],_0x4c1418=[_0x104797['body']['RoomAssigned']],_0x50b263=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x20f)]],_0x5722e6=[_0x104797['body'][_0x4cba00(0x20d)]],_0x12a588=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c4)]],_0x316205=[_0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1e0)]];else var _0x1efbc0=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x286)]],_0x127eac=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1f6)]],_0x491bd6=[..._0x104797['body']['from_prod_level']],_0xede8ec=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1ba)]],_0x4393e3=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x250)]],_0x251030=[..._0x104797[_0x4cba00(0x1dc)]['primary_code']],_0x592568=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x23a)]],_0x406d13=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x213)]],_0x64b5a9=[..._0x104797[_0x4cba00(0x1dc)]['MaxStocks_data2']],_0x4c0371=[..._0x104797[_0x4cba00(0x1dc)]['primary_unit']],_0x135fa7=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c1)]],_0x4969a8=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1de)]],_0x1c4a3a=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x285)]],_0x41af6b=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c3)]],_0x1cf3d3=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x238)]],_0x323ee4=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c5)]],_0x5e854a=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1bd)]],_0x4c1418=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x284)]],_0x50b263=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x20f)]],_0x5722e6=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x20d)]],_0x12a588=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1c4)]],_0x316205=[..._0x104797[_0x4cba00(0x1dc)][_0x4cba00(0x1e0)]];const _0x54c0b6=_0x1efbc0[_0x4cba00(0x1fd)](_0xbe799=>{return _0xbe799={'product_name':_0xbe799};});_0x127eac['forEach']((_0x1400fe,_0x39a75f)=>{_0x54c0b6[_0x39a75f]['from_quantity']=_0x1400fe;}),_0x491bd6[_0x4cba00(0x20a)]((_0x2b8311,_0x5269c4)=>{var _0x1acdf7=_0x4cba00;_0x54c0b6[_0x5269c4][_0x1acdf7(0x243)]=_0x2b8311;}),_0x316205[_0x4cba00(0x20a)]((_0x2f5bb3,_0x311609)=>{var _0x448558=_0x4cba00;_0x54c0b6[_0x311609][_0x448558(0x1e0)]=_0x2f5bb3;}),_0x5722e6['forEach']((_0x5cb17d,_0x398ab7)=>{var _0x32b671=_0x4cba00;_0x54c0b6[_0x398ab7][_0x32b671(0x20d)]=_0x5cb17d;}),_0x12a588[_0x4cba00(0x20a)]((_0x4f5188,_0x928fe3)=>{var _0x5c8f36=_0x4cba00;_0x54c0b6[_0x928fe3][_0x5c8f36(0x1d4)]=_0x4f5188;}),_0xede8ec['forEach']((_0x33023b,_0x591603)=>{var _0x30e657=_0x4cba00;_0x54c0b6[_0x591603][_0x30e657(0x254)]=_0x33023b;}),_0x4393e3[_0x4cba00(0x20a)]((_0x4627c4,_0x11b949)=>{var _0x340528=_0x4cba00;_0x54c0b6[_0x11b949][_0x340528(0x1e4)]=_0x4627c4;}),_0x251030[_0x4cba00(0x20a)]((_0x346dcf,_0x5f0afd)=>{var _0x56252d=_0x4cba00;_0x54c0b6[_0x5f0afd][_0x56252d(0x202)]=_0x346dcf;}),_0x592568[_0x4cba00(0x20a)]((_0x1709e0,_0x1a02fb)=>{var _0x516fac=_0x4cba00;_0x54c0b6[_0x1a02fb][_0x516fac(0x23a)]=_0x1709e0;}),_0x406d13[_0x4cba00(0x20a)]((_0x552161,_0x3af69d)=>{var _0x63753b=_0x4cba00;_0x54c0b6[_0x3af69d][_0x63753b(0x1ff)]=_0x552161;}),_0x64b5a9[_0x4cba00(0x20a)]((_0x3b86a8,_0x3650bd)=>{var _0x49a8cf=_0x4cba00;_0x54c0b6[_0x3650bd][_0x49a8cf(0x25e)]=_0x3b86a8;}),_0x4c0371[_0x4cba00(0x20a)]((_0x3f5e69,_0x180299)=>{var _0xb2875=_0x4cba00;_0x54c0b6[_0x180299][_0xb2875(0x1af)]=_0x3f5e69;}),_0x135fa7['forEach']((_0x134f78,_0x247ccc)=>{var _0x1bc4aa=_0x4cba00;_0x54c0b6[_0x247ccc][_0x1bc4aa(0x1c1)]=_0x134f78;}),_0x4969a8[_0x4cba00(0x20a)]((_0x4da608,_0x8bb4a0)=>{var _0x583a5a=_0x4cba00;_0x54c0b6[_0x8bb4a0][_0x583a5a(0x1de)]=_0x4da608;}),_0x1c4a3a[_0x4cba00(0x20a)]((_0x43e2f6,_0x16233b)=>{_0x54c0b6[_0x16233b]['expiry_date']=_0x43e2f6;}),_0x41af6b[_0x4cba00(0x20a)]((_0x2d660b,_0x8a4ddd)=>{var _0x3a9f13=_0x4cba00;_0x54c0b6[_0x8a4ddd][_0x3a9f13(0x27a)]=_0x2d660b;}),_0x1cf3d3[_0x4cba00(0x20a)]((_0x3702ae,_0x2a80b8)=>{var _0xd018b8=_0x4cba00;_0x54c0b6[_0x2a80b8][_0xd018b8(0x25e)]=_0x3702ae;}),_0x323ee4[_0x4cba00(0x20a)]((_0x557fb6,_0x370285)=>{var _0x2a52bd=_0x4cba00;_0x54c0b6[_0x370285][_0x2a52bd(0x1c5)]=_0x557fb6;}),_0x5e854a[_0x4cba00(0x20a)]((_0x1995c4,_0xeb8d74)=>{var _0x392f08=_0x4cba00;_0x54c0b6[_0xeb8d74][_0x392f08(0x1bd)]=_0x1995c4;}),_0x4c1418[_0x4cba00(0x20a)]((_0x1757e7,_0x2a928b)=>{var _0x247a07=_0x4cba00;_0x54c0b6[_0x2a928b][_0x247a07(0x276)]=_0x1757e7;}),_0x50b263[_0x4cba00(0x20a)]((_0x4c2353,_0x138028)=>{var _0x186579=_0x4cba00;_0x54c0b6[_0x138028][_0x186579(0x27e)]=_0x4c2353;});const _0x5e72f2=_0x54c0b6['filter'](_0x4c0712=>_0x4c0712['to_quantity']!=='0'&&_0x4c0712[_0x4cba00(0x254)]!==''||_0x4c0712[_0x4cba00(0x1bf)]!=='0'&&_0x4c0712['to_floorlevel']!=='');var _0x5db3be=0x0;_0x5e72f2[_0x4cba00(0x20a)](_0x2181ff=>{var _0x551793=_0x4cba00;parseInt(_0x2181ff[_0x551793(0x27d)])<parseInt(_0x2181ff[_0x551793(0x254)])&&_0x5db3be++;});if(_0x5db3be!=0x0)return _0x104797[_0x4cba00(0x256)](_0x4cba00(0x264),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x1f0ece[_0x4cba00(0x27b)](_0x4cba00(0x1b4));const _0x1a44d7=new transfers_finished({'date':_0x4ee358,'from_warehouse':_0x4f605c,'to_warehouse':_0x3f7f74,'product':_0x5e72f2,'note':_0x42d427,'invoice':_0x185edb}),_0x4a170=await _0x1a44d7[_0x4cba00(0x241)]();_0x104797[_0x4cba00(0x256)](_0x4cba00(0x251),_0x4cba00(0x23c)),_0x1f0ece[_0x4cba00(0x27b)](_0x4cba00(0x228)+_0x4a170[_0x4cba00(0x205)]);}catch(_0x5c4e1a){console[_0x4cba00(0x1b6)](_0x5c4e1a),_0x1f0ece['status'](0xc8)[_0x4cba00(0x1dd)]({'errorMessage':_0x5c4e1a[_0x4cba00(0x219)]});}}),router[a0_0x486a30(0x25c)]('/preview/:id',auth,async(_0x292156,_0x154771)=>{var _0xe824f6=a0_0x486a30;try{const {username:_0x17deb7,email:_0xd4fdbf,role:_0x2c5ab0}=_0x292156[_0xe824f6(0x24c)],_0x1dce7c=_0x292156[_0xe824f6(0x24c)],_0x163995=await profile[_0xe824f6(0x244)]({'email':_0x1dce7c[_0xe824f6(0x242)]}),_0x17fd17=await master_shop[_0xe824f6(0x1f0)](),_0x5265b6=await transfers_finished[_0xe824f6(0x1b2)](_0x292156[_0xe824f6(0x1db)]['id']);let _0x201a36;if(_0x1dce7c[_0xe824f6(0x1cf)]==_0xe824f6(0x1c0)){const _0x90b868=await staff[_0xe824f6(0x244)]({'email':_0x1dce7c[_0xe824f6(0x242)]});_0x201a36=await warehouse[_0xe824f6(0x1f0)]({'status':_0xe824f6(0x27f),'name':_0x90b868[_0xe824f6(0x268)],'warehouse_category':_0xe824f6(0x20b)});}else _0x201a36=await warehouse['find']({'status':_0xe824f6(0x27f),'warehouse_category':'Finished\x20Goods'});const _0x157e5f=await warehouse[_0xe824f6(0x224)]([{'$match':{'name':_0x5265b6[_0xe824f6(0x1ad)],'warehouse_category':_0xe824f6(0x20b)}},{'$unwind':_0xe824f6(0x1c9)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xe824f6(0x1e2)},'product_stock':{'$first':_0xe824f6(0x21a)},'bay':{'$first':_0xe824f6(0x1e8)},'bin':{'$first':_0xe824f6(0x208)},'type':{'$first':_0xe824f6(0x263)},'floorlevel':{'$first':_0xe824f6(0x232)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xe824f6(0x1c2)},'product_code':{'$first':_0xe824f6(0x262)},'storage':{'$first':_0xe824f6(0x214)},'rack':{'$first':_0xe824f6(0x1f1)},'expiry_date':{'$first':_0xe824f6(0x1c8)},'production_date':{'$first':_0xe824f6(0x26c)},'room':{'$first':'$room'},'warehoue_name':{'$first':_0xe824f6(0x1f5)}}}]),_0x30282d=await product[_0xe824f6(0x1f0)]({});if(_0x17fd17[0x0][_0xe824f6(0x25d)]==_0xe824f6(0x1e1)){var _0x2172ea=users[_0xe824f6(0x282)];console[_0xe824f6(0x1b6)](_0x2172ea);}else{if(_0x17fd17[0x0][_0xe824f6(0x25d)]==_0xe824f6(0x1b1))var _0x2172ea=users[_0xe824f6(0x1b1)];else{if(_0x17fd17[0x0][_0xe824f6(0x25d)]==_0xe824f6(0x1fe))var _0x2172ea=users[_0xe824f6(0x1fe)];else{if(_0x17fd17[0x0][_0xe824f6(0x25d)]==_0xe824f6(0x260))var _0x2172ea=users['Spanish'];else{if(_0x17fd17[0x0][_0xe824f6(0x25d)]=='French')var _0x2172ea=users[_0xe824f6(0x226)];else{if(_0x17fd17[0x0][_0xe824f6(0x25d)]=='Portuguese\x20(BR)')var _0x2172ea=users[_0xe824f6(0x22d)];else{if(_0x17fd17[0x0][_0xe824f6(0x25d)]==_0xe824f6(0x23e))var _0x2172ea=users[_0xe824f6(0x23e)];else{if(_0x17fd17[0x0]['language']=='Arabic\x20(ae)')var _0x2172ea=users[_0xe824f6(0x233)];}}}}}}}_0x154771[_0xe824f6(0x212)]('edit_transfer_finished_view',{'success':_0x292156[_0xe824f6(0x256)](_0xe824f6(0x251)),'errors':_0x292156[_0xe824f6(0x256)](_0xe824f6(0x264)),'role':_0x1dce7c,'profile':_0x163995,'master_shop':_0x17fd17,'warehouse':_0x201a36,'transfer':_0x5265b6,'stock':_0x157e5f,'unit':_0x30282d,'language':_0x2172ea});}catch(_0x51b332){console[_0xe824f6(0x1b6)](_0x51b332);}}),router['post'](a0_0x486a30(0x207),auth,async(_0x54d6b4,_0x54e416)=>{var _0x20a143=a0_0x486a30;try{const {invoice:_0x5f4c15,from_warehouse:_0x2fd19f,FromRoom_name:_0x4f55f3,to_warehouse:_0xb01361,ToRoom_name:_0xc7585b}=_0x54d6b4[_0x20a143(0x1dc)],_0x15fc94=await transfers_finished[_0x20a143(0x1b2)](_0x54d6b4[_0x20a143(0x1db)]['id']),_0x59d953=_0x15fc94[_0x20a143(0x1d9)]['map'](async _0x28f20c=>{var _0x5ece3c=_0x20a143;if(_0x28f20c['to_quantity']>0x0){var _0x454ca5=await warehouse[_0x5ece3c(0x244)]({'name':_0x2fd19f,'room':_0x28f20c[_0x5ece3c(0x276)],'warehouse_category':_0x5ece3c(0x20b)});const _0x176cab=_0x454ca5[_0x5ece3c(0x1ae)][_0x5ece3c(0x1fd)](_0x23ea8b=>{var _0x15c271=_0x5ece3c;_0x23ea8b['product_name']==_0x28f20c[_0x15c271(0x275)]&&_0x23ea8b['bay']==_0x28f20c[_0x15c271(0x243)]&&_0x23ea8b[_0x15c271(0x285)]==_0x28f20c[_0x15c271(0x285)]&&_0x23ea8b['production_date']==_0x28f20c[_0x15c271(0x27a)]&&_0x23ea8b['batch_code']==_0x28f20c[_0x15c271(0x1de)]&&_0x23ea8b[_0x15c271(0x1fa)]==_0x28f20c[_0x15c271(0x20d)]&&(console[_0x15c271(0x1b6)](_0x15c271(0x1b5),_0x23ea8b[_0x15c271(0x252)]),typeof _0x28f20c['id_transaction']==_0x15c271(0x288)?_0x23ea8b['product_stock']=Math[_0x15c271(0x229)](0x0,Math[_0x15c271(0x253)](_0x23ea8b[_0x15c271(0x252)])-Math['abs'](_0x28f20c['to_quantity'])):_0x23ea8b[_0x15c271(0x252)]=Math[_0x15c271(0x229)](0x0,Math[_0x15c271(0x253)](_0x23ea8b[_0x15c271(0x252)])-Math[_0x15c271(0x253)](_0x28f20c[_0x15c271(0x254)])));});}return _0x454ca5;});Promise[_0x20a143(0x1d7)](_0x59d953)[_0x20a143(0x1eb)](async _0xc5824f=>{var _0x5bc33a=_0x20a143;try{for(const _0x279d37 of _0xc5824f){await _0x279d37[_0x5bc33a(0x241)]();}const _0xd79ef5=_0x15fc94['product']['map'](async _0x34e759=>{var _0x331775=_0x5bc33a,_0x3959f3=await warehouse[_0x331775(0x244)]({'name':_0xb01361,'room':_0x34e759[_0x331775(0x27e)]});if(_0x34e759[_0x331775(0x254)]>0x0){var _0x3baffb=0x0;const _0x31cb96=_0x3959f3[_0x331775(0x1ae)]['map'](_0x596ccb=>{var _0x57660d=_0x331775;_0x596ccb[_0x57660d(0x275)]==_0x34e759[_0x57660d(0x275)]&&_0x596ccb['bay']==_0x34e759[_0x57660d(0x1e4)]&&_0x596ccb[_0x57660d(0x285)]==_0x34e759['expiry_date']&&_0x596ccb['production_date']==_0x34e759['production_date']&&_0x596ccb[_0x57660d(0x1de)]==_0x34e759[_0x57660d(0x1de)]&&_0x596ccb[_0x57660d(0x1fa)]==_0x34e759[_0x57660d(0x1d4)]&&(typeof _0x34e759['id_transaction']=='undefined'?(console[_0x57660d(0x1b6)](_0x57660d(0x220),_0x596ccb[_0x57660d(0x252)]+_0x57660d(0x231)+_0x596ccb[_0x57660d(0x205)]+'\x20<=>\x20'+Math[_0x57660d(0x253)](_0x596ccb[_0x57660d(0x252)])+Math[_0x57660d(0x253)](_0x34e759[_0x57660d(0x254)])),_0x596ccb[_0x57660d(0x252)]=Math[_0x57660d(0x253)](_0x596ccb[_0x57660d(0x252)])+Math['abs'](_0x34e759[_0x57660d(0x254)])):_0x596ccb['product_stock']=Math[_0x57660d(0x253)](_0x596ccb[_0x57660d(0x252)])+Math[_0x57660d(0x253)](_0x34e759[_0x57660d(0x254)]),_0x3baffb++);});_0x3baffb=='0'&&(_0x3959f3[_0x331775(0x1ae)]=_0x3959f3[_0x331775(0x1ae)]['concat']({'product_name':_0x34e759[_0x331775(0x275)],'product_stock':_0x34e759[_0x331775(0x254)],'bay':_0x34e759['to_bay'],'product_code':_0x34e759[_0x331775(0x1ff)],'primary_code':_0x34e759[_0x331775(0x202)],'secondary_code':_0x34e759[_0x331775(0x23a)],'expiry_date':_0x34e759['expiry_date'],'production_date':_0x34e759['production_date'],'maxProducts':_0x34e759['maxProducts'],'batch_code':_0x34e759['batch_code'],'secondary_unit':_0x34e759[_0x331775(0x1c1)],'unit':_0x34e759[_0x331775(0x1af)],'maxProducts':_0x34e759[_0x331775(0x25e)],'maxPerUnit':_0x34e759[_0x331775(0x1c5)],'invoice':_0x34e759[_0x331775(0x1d4)]}));}return _0x3959f3;});Promise[_0x5bc33a(0x1d7)](_0xd79ef5)['then'](async _0x115989=>{var _0x43226a=_0x5bc33a;try{for(const _0x4654c7 of _0x115989){await warehouse['updateOne']({'_id':_0x4654c7[_0x43226a(0x205)]},{'$addToSet':{'product_details':{'$each':_0x4654c7[_0x43226a(0x1ae)]}}});}_0x15fc94[_0x43226a(0x1d8)]='True';const _0x5c6fef=await _0x15fc94['save'](),_0x569667=await master_shop['find'](),_0x5affde=await email_settings[_0x43226a(0x244)](),_0x530fd6=await supervisor_settings[_0x43226a(0x1f0)]();var _0x50cd32=_0x15fc94[_0x43226a(0x1d9)],_0x16a974='',_0x4b1652;for(_0x4b1652 in _0x50cd32){var _0x5efcef='FG';_0x15fc94[_0x43226a(0x278)]==_0x43226a(0x217)&&(_0x5efcef='DG'),_0x16a974+=_0x43226a(0x1f7)+_0x43226a(0x1b3)+_0x50cd32[_0x4b1652][_0x43226a(0x275)]+_0x43226a(0x1d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50cd32[_0x4b1652][_0x43226a(0x1ff)]+_0x43226a(0x1d3)+_0x43226a(0x1b3)+_0x50cd32[_0x4b1652][_0x43226a(0x254)]+_0x43226a(0x1d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50cd32[_0x4b1652][_0x43226a(0x1af)]+'</td>'+_0x43226a(0x1b3)+_0x50cd32[_0x4b1652]['secondary_unit']+_0x43226a(0x1d3)+_0x43226a(0x1b3)+_0x15fc94[_0x43226a(0x278)]+_0x43226a(0x1d3)+_0x43226a(0x1b3)+_0x50cd32[_0x4b1652][_0x43226a(0x27e)]+_0x43226a(0x1d3)+_0x43226a(0x1b3)+_0x5efcef+_0x50cd32[_0x4b1652][_0x43226a(0x1e4)]+'</td>'+'</tr>';}let _0x5bb153=nodemailer['createTransport']({'host':_0x5affde['host'],'port':Number(_0x5affde[_0x43226a(0x1e9)]),'secure':![],'auth':{'user':_0x5affde[_0x43226a(0x242)],'pass':_0x5affde[_0x43226a(0x1be)]}}),_0x5e1ce7={'from':_0x5affde['email'],'to':_0x530fd6[0x0]['FGSEmail'],'subject':_0x43226a(0x1d2),'attachments':[{'filename':_0x43226a(0x222),'path':__dirname+_0x43226a(0x1e7)+_0x43226a(0x269)+_0x569667[0x0]['image'],'cid':_0x43226a(0x1cd)}],'html':_0x43226a(0x1b9)+'<html><head><title></title>'+_0x43226a(0x1fb)+_0x43226a(0x249)+_0x43226a(0x277)+_0x43226a(0x249)+_0x43226a(0x1ea)+_0x43226a(0x1f8)+_0x43226a(0x249)+'<h2>\x20'+_0x569667[0x0]['site_title']+_0x43226a(0x283)+_0x43226a(0x1f8)+_0x43226a(0x1f8)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x43226a(0x1e3)+_0x43226a(0x1c6)+_0x15fc94[_0x43226a(0x1fa)]+'\x20'+_0x43226a(0x24a)+_0x43226a(0x255)+_0x15fc94[_0x43226a(0x215)]+'\x20'+_0x43226a(0x27c)+_0x43226a(0x272)+'</div>'+_0x43226a(0x261)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x43226a(0x1f7)+_0x43226a(0x258)+_0x43226a(0x221)+_0x43226a(0x267)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x43226a(0x211)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x43226a(0x26d)+_0x43226a(0x223)+_0x43226a(0x24e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x16a974+'\x20'+_0x43226a(0x24d)+_0x43226a(0x287)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x569667[0x0][_0x43226a(0x239)]+_0x43226a(0x272)+_0x43226a(0x1f8)+_0x43226a(0x1f8)+'</body></html>'};_0x5bb153[_0x43226a(0x227)](_0x5e1ce7,function(_0x44000f,_0x1dc39e){var _0x5db0a1=_0x43226a;_0x44000f?(console[_0x5db0a1(0x1b6)](_0x44000f),console['log'](_0x5db0a1(0x289))):console[_0x5db0a1(0x1b6)](_0x5db0a1(0x204));}),_0x54d6b4['flash'](_0x43226a(0x251),_0x43226a(0x1d5)),_0x54e416['redirect'](_0x43226a(0x21f)+_0x5c6fef[_0x43226a(0x205)]);}catch(_0x23b885){console[_0x43226a(0x1da)](_0x23b885),_0x54e416[_0x43226a(0x1ac)](0x1f4)[_0x43226a(0x1dd)]({'error':_0x43226a(0x1ed)});}})[_0x5bc33a(0x270)](_0x27a590=>{var _0x2a43d6=_0x5bc33a;console[_0x2a43d6(0x1da)](_0x27a590),_0x54e416[_0x2a43d6(0x1ac)](0x1f4)['json']({'error':_0x2a43d6(0x25b)});});}catch(_0x257367){console[_0x5bc33a(0x1da)](_0x257367),_0x54e416[_0x5bc33a(0x1ac)](0x1f4)['json']({'error':_0x5bc33a(0x203)});}})[_0x20a143(0x270)](_0x287553=>{var _0x2e0649=_0x20a143;console[_0x2e0649(0x1da)](_0x287553),_0x54e416['status'](0x1f4)[_0x2e0649(0x1dd)]({'error':_0x2e0649(0x25b)});});}catch(_0x2b20ab){_0x54e416[_0x20a143(0x1dd)]({'message':_0x2b20ab['message']});}});function BayBinSelected(_0x177a6e,_0x35d602){var _0x5c9b24=a0_0x486a30,_0x3ba4f9=[];let _0x1c6f81=[];var _0x273add=[];if(_0x177a6e==_0x5c9b24(0x217)){switch(_0x35d602){case'Rack\x201':_0x3ba4f9=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5c9b24(0x266):_0x3ba4f9=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x273add=['DG'];}else{if(_0x177a6e==_0x5c9b24(0x1bb)){switch(_0x35d602){case _0x5c9b24(0x210):_0x3ba4f9=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5c9b24(0x266):_0x3ba4f9=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x273add=['FG'];}}return{'levels':_0x3ba4f9,'identify':_0x273add};}router[a0_0x486a30(0x25c)](a0_0x486a30(0x1fc),auth,async(_0x365d11,_0x514651)=>{var _0x19c8f9=a0_0x486a30;try{const {username:_0x291a4d,email:_0x2f140e,role:_0x48d999}=_0x365d11[_0x19c8f9(0x24c)],_0x31b7fb=_0x365d11[_0x19c8f9(0x24c)],_0x4a8ddb=await profile[_0x19c8f9(0x244)]({'email':_0x31b7fb['email']}),_0x4bda93=await master_shop['find'](),_0x5d9e53=await transfers_finished['findById'](_0x365d11[_0x19c8f9(0x1db)]['id']);let _0x48d1a=new Date(_0x5d9e53[_0x19c8f9(0x285)]),_0x2d89dc=('0'+_0x48d1a[_0x19c8f9(0x1ef)]())[_0x19c8f9(0x22f)](-0x2),_0x24e1b8=('0'+(_0x48d1a['getMonth']()+0x1))[_0x19c8f9(0x22f)](-0x2),_0x3aca53=_0x48d1a[_0x19c8f9(0x218)](),_0x1a1003=_0x3aca53+'-'+_0x24e1b8+'-'+_0x2d89dc,_0x501924;if(_0x31b7fb[_0x19c8f9(0x1cf)]==_0x19c8f9(0x1c0)){const _0x1caa46=await staff['findOne']({'email':_0x31b7fb['email']});_0x501924=await warehouse[_0x19c8f9(0x1f0)]({'status':_0x19c8f9(0x27f),'name':_0x1caa46[_0x19c8f9(0x268)],'warehouse_category':_0x19c8f9(0x20b)});}else _0x501924=await warehouse[_0x19c8f9(0x1f0)]({'status':_0x19c8f9(0x27f),'warehouse_category':_0x19c8f9(0x20b)});const _0x3b08b0=await warehouse[_0x19c8f9(0x224)]([{'$match':{'name':_0x5d9e53['from_warehouse'],'room':_0x5d9e53[_0x19c8f9(0x20e)]}},{'$unwind':_0x19c8f9(0x1c9)},{'$group':{'_id':_0x19c8f9(0x257),'name':{'$first':_0x19c8f9(0x1e2)},'product_stock':{'$first':_0x19c8f9(0x21a)},'bay':{'$first':_0x19c8f9(0x1e8)},'bin':{'$first':_0x19c8f9(0x208)},'type':{'$first':_0x19c8f9(0x263)},'floorlevel':{'$first':_0x19c8f9(0x232)},'primary_code':{'$first':_0x19c8f9(0x23b)},'secondary_code':{'$first':_0x19c8f9(0x1c2)},'product_code':{'$first':_0x19c8f9(0x262)},'storage':{'$first':_0x19c8f9(0x214)},'rack':{'$first':'$product_details.rack'}}}]);var _0x9be2ec=[0x1,0x2,0x3,0x4],_0x457d63=['A','B','C','D','E','F','G','H','I','J'],_0x12b81a=[_0x19c8f9(0x1b8),_0x19c8f9(0x273)];const _0x14eb9c=await product['find']({}),_0x4ba005=BayBinSelected(_0x5d9e53['to_warehouse'],_0x5d9e53[_0x19c8f9(0x240)]);if(_0x4bda93[0x0][_0x19c8f9(0x25d)]==_0x19c8f9(0x1e1)){var _0x7d8cfe=users['English'];console[_0x19c8f9(0x1b6)](_0x7d8cfe);}else{if(_0x4bda93[0x0]['language']==_0x19c8f9(0x1b1))var _0x7d8cfe=users[_0x19c8f9(0x1b1)];else{if(_0x4bda93[0x0][_0x19c8f9(0x25d)]==_0x19c8f9(0x1fe))var _0x7d8cfe=users[_0x19c8f9(0x1fe)];else{if(_0x4bda93[0x0][_0x19c8f9(0x25d)]=='Spanish')var _0x7d8cfe=users['Spanish'];else{if(_0x4bda93[0x0][_0x19c8f9(0x25d)]=='French')var _0x7d8cfe=users[_0x19c8f9(0x226)];else{if(_0x4bda93[0x0][_0x19c8f9(0x25d)]==_0x19c8f9(0x22b))var _0x7d8cfe=users['Portuguese'];else{if(_0x4bda93[0x0]['language']=='Chinese')var _0x7d8cfe=users[_0x19c8f9(0x23e)];else{if(_0x4bda93[0x0]['language']=='Arabic\x20(ae)')var _0x7d8cfe=users[_0x19c8f9(0x233)];}}}}}}}_0x514651[_0x19c8f9(0x212)](_0x19c8f9(0x237),{'success':_0x365d11[_0x19c8f9(0x256)](_0x19c8f9(0x251)),'errors':_0x365d11[_0x19c8f9(0x256)]('errors'),'role':_0x31b7fb,'profile':_0x4a8ddb,'master_shop':_0x4bda93,'warehouse':_0x501924,'transfer':_0x5d9e53,'stock':_0x3b08b0,'unit':_0x14eb9c,'language':_0x7d8cfe,'levels':_0x9be2ec,'Isle':_0x457d63,'rooms_data':_0x12b81a,'ed_fullDate':_0x1a1003,'dataSelected':_0x4ba005});}catch(_0x2f17ee){console[_0x19c8f9(0x1b6)](_0x2f17ee);}}),router[a0_0x486a30(0x23d)]('/view/:id',auth,async(_0x2e7e6b,_0x41e246)=>{var _0x1923a4=a0_0x486a30;try{const _0x5733b0=_0x2e7e6b['params']['id'];console[_0x1923a4(0x1b6)](_0x2e7e6b['body']);const _0x2641dd=await transfers_finished[_0x1923a4(0x1b2)](_0x5733b0);console['log'](_0x1923a4(0x248),_0x2641dd);const {date:_0x515616,from_warehouse:_0x23fb86,FromRoom_name:_0x22ac09,to_warehouse:_0xd9d43c,ToRoom_name:_0x5021ce,prod_name:_0x5f5159,from_prod_qty:_0x348e98,from_prod_level:_0x502315,from_prod_isle:_0x9c66a6,from_prod_pallet:_0x1c6bc2,to_prod_qty:_0x183857,to_prod_level:_0x1406d3,to_prod_isle:_0x4096b2,to_prod_pallet:_0x1e8bf7,primary_code:_0x853a40,secondary_code:_0x465c37,product_code3:_0x4081e5,note:_0x486bc7,invoice:_0x140d9f,expiry_date:_0x2fd050}=_0x2e7e6b[_0x1923a4(0x1dc)];if(typeof _0x5f5159==_0x1923a4(0x26e))var _0x3c7c19=[_0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x286)]],_0x44f950=[_0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1f6)]],_0x3c27b9=[_0x2e7e6b['body'][_0x1923a4(0x206)]],_0x3e9295=[_0x2e7e6b[_0x1923a4(0x1dc)]['to_prod_qty']],_0x57e935=[_0x2e7e6b['body'][_0x1923a4(0x250)]],_0x2d9220=[_0x2e7e6b['body'][_0x1923a4(0x202)]],_0x58b454=[_0x2e7e6b['body'][_0x1923a4(0x23a)]],_0x4bc99b=[_0x2e7e6b['body'][_0x1923a4(0x213)]],_0x3bf4dc=[_0x2e7e6b[_0x1923a4(0x1dc)]['MaxStocks_data2']],_0x5adc58=[_0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1af)]],_0x4c6ae8=[_0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1c1)]],_0x44340b=[_0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1de)]],_0x313a7d=[_0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x285)]];else var _0x3c7c19=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x286)]],_0x44f950=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1f6)]],_0x3c27b9=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x206)]],_0x3e9295=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1cb)]],_0x57e935=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x250)]],_0x2d9220=[..._0x2e7e6b[_0x1923a4(0x1dc)]['primary_code']],_0x58b454=[..._0x2e7e6b['body']['secondary_code']],_0x4bc99b=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x213)]],_0x3bf4dc=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1b7)]],_0x5adc58=[..._0x2e7e6b['body'][_0x1923a4(0x1af)]],_0x4c6ae8=[..._0x2e7e6b['body'][_0x1923a4(0x1c1)]],_0x44340b=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x1de)]],_0x313a7d=[..._0x2e7e6b[_0x1923a4(0x1dc)][_0x1923a4(0x285)]];const _0x578d4=_0x3c7c19[_0x1923a4(0x1fd)](_0x2ff91f=>{return _0x2ff91f={'product_name':_0x2ff91f};});_0x44f950['forEach']((_0x59e7e0,_0x358e1c)=>{var _0x5e807c=_0x1923a4;_0x578d4[_0x358e1c][_0x5e807c(0x27d)]=_0x59e7e0;}),_0x3c27b9[_0x1923a4(0x20a)]((_0x5592b3,_0x121c47)=>{var _0x4dde57=_0x1923a4;_0x578d4[_0x121c47][_0x4dde57(0x243)]=_0x5592b3;}),_0x3e9295['forEach']((_0x428842,_0x3a936c)=>{var _0x3a0526=_0x1923a4;_0x578d4[_0x3a936c][_0x3a0526(0x254)]=_0x428842;}),_0x57e935[_0x1923a4(0x20a)]((_0x383b0e,_0x2490bc)=>{var _0x324d7e=_0x1923a4;_0x578d4[_0x2490bc][_0x324d7e(0x1e4)]=_0x383b0e;}),_0x2d9220[_0x1923a4(0x20a)]((_0x145d14,_0x2f0168)=>{var _0x53559c=_0x1923a4;_0x578d4[_0x2f0168][_0x53559c(0x202)]=_0x145d14;}),_0x58b454[_0x1923a4(0x20a)]((_0x1018da,_0x5bb108)=>{var _0x18640b=_0x1923a4;_0x578d4[_0x5bb108][_0x18640b(0x23a)]=_0x1018da;}),_0x4bc99b[_0x1923a4(0x20a)]((_0x214c86,_0x3d78bf)=>{_0x578d4[_0x3d78bf]['product_code']=_0x214c86;}),_0x3bf4dc['forEach']((_0x3d154e,_0x51b5a7)=>{var _0x2355f7=_0x1923a4;_0x578d4[_0x51b5a7][_0x2355f7(0x25e)]=_0x3d154e;}),_0x5adc58[_0x1923a4(0x20a)]((_0x4c7347,_0x400f37)=>{_0x578d4[_0x400f37]['unit']=_0x4c7347;}),_0x4c6ae8[_0x1923a4(0x20a)]((_0x5012e8,_0x23bb6d)=>{var _0xf79c65=_0x1923a4;_0x578d4[_0x23bb6d][_0xf79c65(0x1c1)]=_0x5012e8;}),_0x44340b[_0x1923a4(0x20a)]((_0x172bde,_0x54335f)=>{_0x578d4[_0x54335f]['batch_code']=_0x172bde;}),_0x313a7d[_0x1923a4(0x20a)]((_0x3eac6a,_0x36c847)=>{_0x578d4[_0x36c847]['expiry_date']=_0x3eac6a;});const _0x48b2a9=_0x578d4[_0x1923a4(0x279)](_0x109a5c=>_0x109a5c[_0x1923a4(0x254)]!=='0'&&_0x109a5c[_0x1923a4(0x254)]!==''||_0x109a5c['to_floorlevel']!=='0'&&_0x109a5c['to_floorlevel']!=='');var _0x546e24=0x0;_0x48b2a9['forEach'](_0x4f7f4a=>{parseInt(_0x4f7f4a['from_quantity'])<parseInt(_0x4f7f4a['to_quantity'])&&_0x546e24++;});if(_0x546e24!=0x0)return _0x2e7e6b['flash'](_0x1923a4(0x264),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x41e246['redirect'](_0x1923a4(0x1b4));const _0x22aca1=await warehouse[_0x1923a4(0x244)]({'name':_0x2641dd[_0x1923a4(0x1ad)],'room':_0x2641dd[_0x1923a4(0x20e)]});_0x2641dd[_0x1923a4(0x1d9)][_0x1923a4(0x20a)](_0x9e85cd=>{var _0x3e6649=_0x1923a4;if(_0x9e85cd['to_quantity']>0x0){const _0x3cdfc5=_0x22aca1[_0x3e6649(0x1ae)]['map'](_0x396044=>{var _0x1fee35=_0x3e6649;_0x396044[_0x1fee35(0x275)]==_0x9e85cd[_0x1fee35(0x275)]&&_0x396044['bay']==_0x9e85cd[_0x1fee35(0x243)]&&(_0x396044[_0x1fee35(0x252)]=parseInt(_0x396044[_0x1fee35(0x252)])+parseInt(_0x9e85cd[_0x1fee35(0x254)]));});}}),await _0x22aca1[_0x1923a4(0x241)]();const _0x38ec8b=await warehouse[_0x1923a4(0x244)]({'name':_0x2641dd[_0x1923a4(0x278)],'room':_0x2641dd[_0x1923a4(0x240)]});_0x2641dd[_0x1923a4(0x1d9)][_0x1923a4(0x20a)](_0x3381b2=>{var _0x1bc02b=_0x1923a4;if(_0x3381b2['to_quantity']>0x0){const _0x98ceed=_0x38ec8b[_0x1bc02b(0x1ae)][_0x1bc02b(0x1fd)](_0x32f908=>{var _0x557576=_0x1bc02b;_0x32f908[_0x557576(0x275)]==_0x3381b2[_0x557576(0x275)]&&_0x32f908[_0x557576(0x28b)]==_0x3381b2[_0x557576(0x1e4)]&&(_0x32f908[_0x557576(0x252)]=parseInt(_0x32f908['product_stock'])-parseInt(_0x3381b2['to_quantity']));});}}),await _0x38ec8b[_0x1923a4(0x241)](),_0x2641dd[_0x1923a4(0x215)]=_0x515616,_0x2641dd[_0x1923a4(0x1ad)]=_0x23fb86,_0x2641dd[_0x1923a4(0x278)]=_0xd9d43c,_0x2641dd[_0x1923a4(0x1d9)]=_0x48b2a9,_0x2641dd[_0x1923a4(0x26b)]=_0x486bc7,_0x2641dd[_0x1923a4(0x1fa)]=_0x140d9f;const _0x4270fe=await _0x2641dd[_0x1923a4(0x241)](),_0x2b3ce9=await warehouse['findOne']({'name':_0x23fb86,'room':_0x22ac09});_0x4270fe[_0x1923a4(0x1d9)][_0x1923a4(0x20a)](_0x245f72=>{var _0x2d6704=_0x1923a4;if(_0x245f72[_0x2d6704(0x254)]>0x0){const _0x5274a3=_0x2b3ce9['product_details'][_0x2d6704(0x1fd)](_0x9bdf28=>{var _0x362866=_0x2d6704;_0x9bdf28[_0x362866(0x275)]==_0x245f72[_0x362866(0x275)]&&_0x9bdf28[_0x362866(0x28b)]==_0x245f72[_0x362866(0x243)]&&(_0x9bdf28[_0x362866(0x252)]=parseInt(_0x9bdf28['product_stock'])-parseInt(_0x245f72['to_quantity']));});}}),await _0x2b3ce9[_0x1923a4(0x241)]();const _0x4418b7=await warehouse[_0x1923a4(0x244)]({'name':_0xd9d43c,'room':_0x5021ce});_0x4270fe[_0x1923a4(0x1d9)][_0x1923a4(0x20a)](_0x2a2dde=>{var _0x5ced2f=_0x1923a4;if(_0x2a2dde[_0x5ced2f(0x254)]>0x0){var _0x21fc40=0x0;const _0x487c2e=_0x4418b7[_0x5ced2f(0x1ae)]['map'](_0x3976c4=>{var _0x2dd247=_0x5ced2f;_0x3976c4[_0x2dd247(0x275)]==_0x2a2dde['product_name']&&_0x3976c4[_0x2dd247(0x28b)]==_0x2a2dde[_0x2dd247(0x1e4)]&&(_0x3976c4[_0x2dd247(0x252)]=parseInt(_0x3976c4[_0x2dd247(0x252)])+parseInt(_0x2a2dde[_0x2dd247(0x254)]),_0x21fc40++);});_0x21fc40=='0'&&(_0x4418b7['product_details']=_0x4418b7['product_details'][_0x5ced2f(0x21e)]({'product_name':_0x2a2dde[_0x5ced2f(0x275)],'product_stock':_0x2a2dde[_0x5ced2f(0x254)],'bay':_0x2a2dde[_0x5ced2f(0x1e4)],'product_code':_0x2a2dde['product_code'],'primary_code':_0x2a2dde[_0x5ced2f(0x202)],'secondary_code':_0x2a2dde['secondary_code'],'maxProducts':_0x2a2dde['maxProducts']}));}}),await _0x4418b7[_0x1923a4(0x241)](),_0x2e7e6b[_0x1923a4(0x256)]('success','Transfer\x20Edit\x20Successfully'),_0x41e246[_0x1923a4(0x27b)]('/transfer_finished/view');}catch(_0x66c44e){console['log'](_0x66c44e);}}),router[a0_0x486a30(0x23d)](a0_0x486a30(0x1df),async(_0x46679f,_0x40bd83)=>{var _0x3bdf05=a0_0x486a30;const {FromWareHouse:_0x4dcb7b,FromRoom:_0x52a394,ToWarehouse:_0x484c2b,ToRoom:_0x19bbc2,primary_code:_0x40aec4,Roomslist:_0x4607da}=_0x46679f[_0x3bdf05(0x1dc)],_0x4e6618=_0x4607da[_0x3bdf05(0x259)](','),_0x4b7a93=[];async function _0x59ea30(_0xa32804){var _0x585166=_0x3bdf05;const _0x45d3ae=await warehouse['aggregate']([{'$match':{'name':_0x4dcb7b,'room':_0xa32804}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x40aec4}},{'$group':{'_id':_0x585166(0x257),'name':{'$first':_0x585166(0x1e2)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x585166(0x23b)},'secondary_code':{'$first':_0x585166(0x1c2)},'product_code':{'$first':_0x585166(0x262)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x585166(0x208)},'type':{'$first':_0x585166(0x263)},'pallet':{'$first':_0x585166(0x232)},'unit':{'$first':_0x585166(0x230)},'secondary_unit':{'$first':_0x585166(0x1e6)},'storage':{'$first':_0x585166(0x214)},'rack':{'$first':_0x585166(0x1f1)},'expiry_date':{'$first':_0x585166(0x1c8)},'production_date':{'$first':_0x585166(0x26c)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x585166(0x200)},'roomNamed':{'$first':_0x585166(0x26a)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x585166(0x247)}}}]),_0x57804d=await warehouse[_0x585166(0x224)]([{'$match':{'name':_0x4dcb7b,'room':_0xa32804}},{'$unwind':_0x585166(0x1c9)},{'$match':{'product_details.secondary_code':_0x40aec4}},{'$group':{'_id':_0x585166(0x257),'name':{'$first':_0x585166(0x1e2)},'instock':{'$first':_0x585166(0x21a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x585166(0x1c2)},'product_code':{'$first':_0x585166(0x262)},'level':{'$first':_0x585166(0x1e8)},'isle':{'$first':_0x585166(0x208)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x585166(0x232)},'unit':{'$first':_0x585166(0x230)},'secondary_unit':{'$first':_0x585166(0x1e6)},'storage':{'$first':_0x585166(0x214)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x585166(0x26c)},'batch_code':{'$first':_0x585166(0x26f)},'maxPerUnit':{'$first':_0x585166(0x200)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x45d3ae['length']>0x0)_0x4b7a93['push'](_0x45d3ae);else _0x57804d[_0x585166(0x22a)]>0x0&&_0x4b7a93['push'](_0x57804d);}const _0x577c62=_0x4e6618['map'](_0x56b85b=>_0x59ea30(_0x56b85b));await Promise[_0x3bdf05(0x1d7)](_0x577c62),_0x40bd83[_0x3bdf05(0x1dd)](_0x4b7a93);}),router[a0_0x486a30(0x23d)](a0_0x486a30(0x24b),async(_0xe84f6c,_0x11de66)=>{var _0x219d9c=a0_0x486a30;try{const {FromWareHouse:_0x2d76e9,FromRoom:_0x11a9b0,ToWarehouse:_0x69eccf,ToRoom:_0x41425a,secondary_code:_0x404ab9}=_0xe84f6c[_0x219d9c(0x1dc)],_0x3affb7=await warehouse[_0x219d9c(0x224)]([{'$match':{'name':_0x2d76e9}},{'$unwind':_0x219d9c(0x1c9)},{'$match':{'product_details.secondary_code':_0x404ab9}},{'$group':{'_id':_0x219d9c(0x257),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x219d9c(0x1c2)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x219d9c(0x21a)},'warehouse':{'$first':'$name'},'level':{'$first':_0x219d9c(0x25f)},'isle':{'$first':_0x219d9c(0x280)},'pallet':{'$first':_0x219d9c(0x1d6)},'maxProducts':{'$first':_0x219d9c(0x1b0)},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x219d9c(0x1c8)},'production_date':{'$first':_0x219d9c(0x26c)}}}]);_0x11de66['status'](0xc8)[_0x219d9c(0x1dd)](_0x3affb7);}catch(_0x5a3f09){_0x11de66[_0x219d9c(0x1ac)](0x194)[_0x219d9c(0x1dd)]({'message':_0x5a3f09['message']});}}),router[a0_0x486a30(0x23d)](a0_0x486a30(0x1d0),async(_0xa11778,_0x20b401)=>{var _0x4f1bcb=a0_0x486a30;try{const {FromWareHouse:_0x41a6eb,FromRoom:_0x3fe41c,ToWarehouse:_0x3bd697,ToRoom:_0x39ef4f,product_code:_0x5941c7}=_0xa11778[_0x4f1bcb(0x1dc)],_0x3ee022=await warehouse[_0x4f1bcb(0x224)]([{'$match':{'name':_0x41a6eb}},{'$unwind':_0x4f1bcb(0x1c9)},{'$match':{'product_details.product_code':_0x5941c7}},{'$group':{'_id':_0x4f1bcb(0x257),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x4f1bcb(0x23b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4f1bcb(0x262)},'instock':{'$first':_0x4f1bcb(0x21a)},'warehouse':{'$first':'$name'},'level':{'$first':_0x4f1bcb(0x25f)},'isle':{'$first':_0x4f1bcb(0x280)},'pallet':{'$first':_0x4f1bcb(0x1d6)},'maxProducts':{'$first':_0x4f1bcb(0x1b0)},'unit':{'$first':_0x4f1bcb(0x230)}}}]);_0x20b401[_0x4f1bcb(0x1ac)](0xc8)['json'](_0x3ee022);}catch(_0x2b46db){_0x20b401['status'](0x194)[_0x4f1bcb(0x1dd)]({'message':_0x2b46db[_0x4f1bcb(0x219)]});}}),router[a0_0x486a30(0x23d)](a0_0x486a30(0x1f4),async(_0x229d98,_0x4f00ab)=>{var _0x2cc00d=a0_0x486a30;const {productCode:_0x21bbaf,bay:_0x59d128,warehouses:_0x4f6125,room:_0x3feb17}=_0x229d98[_0x2cc00d(0x1dc)];console[_0x2cc00d(0x1b6)](_0x229d98[_0x2cc00d(0x1dc)]);try{const _0x3a1f0d=await warehouse[_0x2cc00d(0x224)]([{'$match':{'name':_0x4f6125,'room':_0x3feb17}},{'$unwind':_0x2cc00d(0x1c9)},{'$match':{'product_details.bay':parseInt(_0x59d128)}},{'$group':{'_id':_0x2cc00d(0x257),'name':{'$first':_0x2cc00d(0x1e2)},'product_stock':{'$first':_0x2cc00d(0x21a)},'bay':{'$first':_0x2cc00d(0x1e8)},'maxProducts':{'$first':_0x2cc00d(0x1b0)}}}]);_0x4f00ab[_0x2cc00d(0x1ac)](0xc8)[_0x2cc00d(0x1dd)](_0x3a1f0d);}catch(_0x32a401){_0x4f00ab[_0x2cc00d(0x1ac)](0x194)[_0x2cc00d(0x1dd)]({'message':_0x32a401['message']});}}),module[a0_0x486a30(0x1cc)]=router;