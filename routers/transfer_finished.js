var a0_0x38b483=a0_0x4293;(function(_0x22b874,_0x5bd7f6){var _0x198324=a0_0x4293,_0x1d1e1c=_0x22b874();while(!![]){try{var _0x3d3ec7=parseInt(_0x198324(0x147))/0x1*(-parseInt(_0x198324(0x177))/0x2)+-parseInt(_0x198324(0x18f))/0x3*(-parseInt(_0x198324(0x192))/0x4)+-parseInt(_0x198324(0xe4))/0x5+parseInt(_0x198324(0x11d))/0x6*(-parseInt(_0x198324(0xc0))/0x7)+-parseInt(_0x198324(0xe3))/0x8*(parseInt(_0x198324(0xcc))/0x9)+-parseInt(_0x198324(0xbe))/0xa+-parseInt(_0x198324(0x158))/0xb*(-parseInt(_0x198324(0xe2))/0xc);if(_0x3d3ec7===_0x5bd7f6)break;else _0x1d1e1c['push'](_0x1d1e1c['shift']());}catch(_0x401f28){_0x1d1e1c['push'](_0x1d1e1c['shift']());}}}(a0_0x1244,0xa9300));function a0_0x4293(_0x19911e,_0x505f3f){var _0x12449a=a0_0x1244();return a0_0x4293=function(_0x42937e,_0x5888e5){_0x42937e=_0x42937e-0xbe;var _0x34366d=_0x12449a[_0x42937e];return _0x34366d;},a0_0x4293(_0x19911e,_0x505f3f);}const express=require(a0_0x38b483(0x18a)),app=express(),router=express[a0_0x38b483(0x11e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x38b483(0x197)),auth=require(a0_0x38b483(0x146)),users=require(a0_0x38b483(0xe9)),nodemailer=require(a0_0x38b483(0xc4));router[a0_0x38b483(0xd7)]('/view',auth,async(_0x2acafc,_0x30ee83)=>{var _0x9c11ef=a0_0x38b483;try{const {username:_0x3ddf12,email:_0x580452,role:_0x1eb18a}=_0x2acafc[_0x9c11ef(0x16b)],_0x1a0a22=_0x2acafc[_0x9c11ef(0x16b)],_0xba59ea=await profile['findOne']({'email':_0x1a0a22[_0x9c11ef(0xf7)]}),_0x5e6544=await master_shop[_0x9c11ef(0xf8)]();let _0x355812;if(_0x1a0a22[_0x9c11ef(0x150)]==_0x9c11ef(0xe8)){const _0x582102=await staff[_0x9c11ef(0x172)]({'email':_0x1a0a22['email']});_0x355812=await transfers_finished['find']({'from_warehouse':_0x582102[_0x9c11ef(0x145)]});}else _0x355812=await transfers_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x9c11ef(0xdf)},'from_warehouse':{'$first':_0x9c11ef(0xf3)},'to_warehouse':{'$first':_0x9c11ef(0x111)},'from_room_name':{'$addToSet':_0x9c11ef(0xd9)},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x5e6544[0x0][_0x9c11ef(0x133)]==_0x9c11ef(0x181))var _0xa7b31e=users['English'];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]==_0x9c11ef(0x17c))var _0xa7b31e=users['Hindi'];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]==_0x9c11ef(0x13a))var _0xa7b31e=users['German'];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]=='Spanish')var _0xa7b31e=users[_0x9c11ef(0x10c)];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]==_0x9c11ef(0xda))var _0xa7b31e=users[_0x9c11ef(0xda)];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]==_0x9c11ef(0x128))var _0xa7b31e=users[_0x9c11ef(0xef)];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]=='Chinese')var _0xa7b31e=users[_0x9c11ef(0x18c)];else{if(_0x5e6544[0x0][_0x9c11ef(0x133)]==_0x9c11ef(0xd6))var _0xa7b31e=users[_0x9c11ef(0x15d)];}}}}}}}_0x30ee83[_0x9c11ef(0xde)](_0x9c11ef(0x162),{'success':_0x2acafc[_0x9c11ef(0x12b)](_0x9c11ef(0x163)),'errors':_0x2acafc[_0x9c11ef(0x12b)](_0x9c11ef(0xf6)),'role':_0x1a0a22,'profile':_0xba59ea,'master_shop':_0x5e6544,'transfer':_0x355812,'language':_0xa7b31e});}catch(_0x321851){console[_0x9c11ef(0xe7)](_0x321851);}});async function getRandom8DigitNumber(){var _0x143781=a0_0x38b483;const _0x3396b4=0x989680,_0x3c90d8=0x5f5e0ff,_0x71930a=Math[_0x143781(0x179)](Math[_0x143781(0x167)]()*(_0x3c90d8-_0x3396b4+0x1))+_0x3396b4;var _0x5d594e;const _0x437e3c=await transfers_finished[_0x143781(0x172)]({'invoice':_0x143781(0xfc)+_0x71930a});return _0x437e3c&&_0x437e3c[_0x143781(0x157)]>0x0?_0x5d594e=_0x143781(0xfc)+_0x71930a:_0x5d594e=_0x143781(0xfc)+_0x71930a,_0x5d594e;}function a0_0x1244(){var _0x15a4e=['To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','Arabic\x20(ae)','get','DRY\x20GOODS','$product.from_room_name','French','<span\x20style=\x22float:\x20right;\x22>','$product_details.secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','render','$date','</tr>','</tbody>','1116pwLPeL','1429016KNjWkR','5453610BgPcVU','image','from_room_name','log','staff','../public/language/languages.json','all','error','Enabled','to_room','$product_details.primary_code','Portuguese','primary_code','Logo.png','production_date','$from_warehouse','filter','to_warehouse','errors','email','find','bay','getMonth','</body></html>','TRFF-','json','Transfer\x20Edit\x20Successfully','to_prod_level','save','padStart','<html><head><title></title>','\x20</h2>','MaxStocks_data','host','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.bay','$product_details.maxProducts','status','<table\x20style=\x22width:\x20100%\x20!important;\x22>','maxPerUnit','Spanish','to_floorlevel','$room','$product_details.production_date','$product_details._id','$to_warehouse','$product_details.storage','/transfer/view','$product_details.isle','To_invoice','<div>','Rack\x201','edit_transfer_finished_view','to_invoice','findById','$product_details.floorlevel','from_warehouse','6yJqQWs','Router','product','product_code','English','$product_details.maxPerUnit','maxProducts','prod_cat','/transfer_finished/preview/','from_prod_level','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Portuguese\x20(BR)','$product_details.invoice','\x20Order\x20Number\x20:\x20','flash','Error\x20Occurs','<strong>\x20Regards\x20</strong>','password','/view/add_transfer','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/picking_list/PDF_transfer/','language','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details','/barcode_scanner2','<tbody\x20style=\x22text-align:\x20center;\x22>','secondary_code','German','from_invoice','createTransport','_id','map','split','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','back','<tr>','note','warehouse','../middleware/auth','1170083wpmLFN','forEach','transfer_data','push','from_room','product_name','\x20Order\x20Date\x20:\x20','$product_details.pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','role','body','</span>','<hr\x20class=\x22my-3\x22>','RoomAssigned','$product_details.secondary_code','batch_code','length','751454NvCbYr','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_code3','Ambient','invoice','Arabic','from_quantity','There\x27s\x20a\x20error\x20in\x20this\x20transaction','from_bay','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','transfer_finished','success','aggregate','to_room_name','catch','random','Finished\x20Goods','post','from_prod_qty','user','$product_details.unit','$product_details.product_code','string','$product_details.bin','An\x20error\x20occurred.','$product_details.batch_code','findOne','expiry_date','FGSEmail','Rack\x202','$product_details.product_name','2jJwVQb','product_stock','floor','finalize','sendMail','Hindi','to_prod_qty','/barcode_scanner3','message','to_bay','English\x20(US)','Transfer\x20Mail','True','New_Qty_Converted','$product_details.level','unit','An\x20error\x20occurred\x20while\x20saving\x20data.','site_title','/../public','express','primary_unit','Chinese','</h5>','MaxStocks_data2','2685TOQbZd','$product_details.rack','then','1032aPaoix','logo','/transfer_finished/view','/view/:id','product_details','../models/all_models','redirect','</table>','Email\x20sent\x20successfully','</td>','13717240GvtoMs','secondary_unit','8307803GzudRM','params','ToRoomAssigned','/CheckingWarehouse','nodemailer','edit_transfer_finished','$product_details.expiry_date','$product_details.type','<h5\x20style=\x22text-align:\x20left;\x22>','product_date','</div>','port','54pNQbhi','exports','to_quantity','concat','prod_name','QA\x20Warehouse','$name','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'];a0_0x1244=function(){return _0x15a4e;};return a0_0x1244();}router[a0_0x38b483(0xd7)](a0_0x38b483(0x12f),auth,async(_0x3abadc,_0x11279a)=>{var _0x37e3bc=a0_0x38b483;try{const {username:_0x217a4e,email:_0x1ed1af,role:_0x159e28}=_0x3abadc[_0x37e3bc(0x16b)],_0x3d4ac8=_0x3abadc['user'],_0xefdd59=await profile['findOne']({'email':_0x3d4ac8[_0x37e3bc(0xf7)]}),_0x18b159=await master_shop[_0x37e3bc(0xf8)]();let _0x4f2237;if(_0x3d4ac8[_0x37e3bc(0x150)]==_0x37e3bc(0xe8)){const _0x413b6f=await staff['findOne']({'email':_0x3d4ac8[_0x37e3bc(0xf7)]});_0x4f2237=await warehouse['aggregate']([{'$match':{'status':_0x37e3bc(0xec),'name':_0x413b6f[_0x37e3bc(0x145)],'warehouse_category':_0x37e3bc(0x168),'name':{'$ne':_0x37e3bc(0xd1)}}},{'$group':{'_id':_0x37e3bc(0xd2),'name':{'$first':_0x37e3bc(0xd2)}}}]);}else _0x4f2237=await warehouse['aggregate']([{'$match':{'status':_0x37e3bc(0xec),'warehouse_category':_0x37e3bc(0x168),'name':{'$ne':_0x37e3bc(0xd1)}}},{'$group':{'_id':_0x37e3bc(0xd2),'name':{'$first':_0x37e3bc(0xd2)}}}]);const _0x81a1d1=await transfers_finished[_0x37e3bc(0xf8)]({}),_0x29b7a2=_0x81a1d1[_0x37e3bc(0x157)]+0x1,_0x3689b7=_0x37e3bc(0xfc)+_0x29b7a2['toString']()[_0x37e3bc(0x101)](0x5,'0');if(_0x18b159[0x0][_0x37e3bc(0x133)]=='English\x20(US)')var _0x2f0596=users['English'];else{if(_0x18b159[0x0][_0x37e3bc(0x133)]==_0x37e3bc(0x17c))var _0x2f0596=users[_0x37e3bc(0x17c)];else{if(_0x18b159[0x0][_0x37e3bc(0x133)]==_0x37e3bc(0x13a))var _0x2f0596=users[_0x37e3bc(0x13a)];else{if(_0x18b159[0x0]['language']==_0x37e3bc(0x10c))var _0x2f0596=users['Spanish'];else{if(_0x18b159[0x0][_0x37e3bc(0x133)]=='French')var _0x2f0596=users[_0x37e3bc(0xda)];else{if(_0x18b159[0x0][_0x37e3bc(0x133)]=='Portuguese\x20(BR)')var _0x2f0596=users[_0x37e3bc(0xef)];else{if(_0x18b159[0x0]['language']==_0x37e3bc(0x18c))var _0x2f0596=users[_0x37e3bc(0x18c)];else{if(_0x18b159[0x0]['language']==_0x37e3bc(0xd6))var _0x2f0596=users[_0x37e3bc(0x15d)];}}}}}}}const _0x231115=getRandom8DigitNumber();_0x231115[_0x37e3bc(0x191)](_0x205667=>{var _0x452d30=_0x37e3bc;_0x11279a[_0x452d30(0xde)]('add_transfer_finished',{'success':_0x3abadc[_0x452d30(0x12b)](_0x452d30(0x163)),'errors':_0x3abadc[_0x452d30(0x12b)]('errors'),'role':_0x3d4ac8,'profile':_0xefdd59,'master_shop':_0x18b159,'warehouse':_0x4f2237,'language':_0x2f0596,'invoice':_0x205667});})[_0x37e3bc(0x166)](_0x467f25=>{var _0x2b7b8a=_0x37e3bc;_0x3abadc['flash'](_0x2b7b8a(0xf6),_0x2b7b8a(0x15f)),_0x11279a['redirect'](_0x2b7b8a(0x113));});}catch(_0xdb94f5){console['log'](_0xdb94f5);}}),router[a0_0x38b483(0x169)](a0_0x38b483(0x12f),auth,async(_0x469916,_0x19724c)=>{var _0x10c8a9=a0_0x38b483;try{const {date:_0x4e7b45,from_warehouse:_0xb58c7c,FromRoom_name:_0x58d8c0,to_warehouse:_0x44ab68,ToRoom_name:_0x348537,prod_name:_0x36b2bc,from_prod_qty:_0x2458ff,from_prod_level:_0x3c99a7,from_prod_isle:_0x40a42a,from_prod_pallet:_0x3f8db4,to_prod_qty:_0x4f6fd8,to_prod_level:_0x4493d9,to_prod_isle:_0x5e4110,to_prod_pallet:_0x2ea39c,primary_code:_0x4848bf,secondary_code:_0x171399,product_code3:_0x9fc414,note:_0x11c1b8,MaxStocks_data2:_0x448a3f,invoice:_0x27ca2b,expiry_date:_0x335299}=_0x469916[_0x10c8a9(0x151)];if(typeof _0x36b2bc==_0x10c8a9(0x16e))var _0x2e2df7=[_0x469916[_0x10c8a9(0x151)]['prod_name']],_0x376131=[_0x469916[_0x10c8a9(0x151)]['from_prod_qty']],_0xce8e42=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x126)]],_0x35ad20=[_0x469916['body'][_0x10c8a9(0x184)]],_0x2bfd8d=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xff)]],_0xdfedf1=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xf0)]],_0x32a463=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x139)]],_0x6bbfdb=[_0x469916['body'][_0x10c8a9(0x15a)]],_0x4a728a=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x18e)]],_0x2beae2=[_0x469916['body'][_0x10c8a9(0x18b)]],_0xd3109d=[_0x469916['body'][_0x10c8a9(0xbf)]],_0x5ae9c7=[_0x469916[_0x10c8a9(0x151)]['batch_code']],_0x484a31=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x173)]],_0x294e08=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xc9)]],_0x1eb193=[_0x469916['body'][_0x10c8a9(0x104)]],_0x49aee8=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x10b)]],_0x53f070=[_0x469916[_0x10c8a9(0x151)]['prod_cat']],_0x3c0daf=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x154)]],_0x4d4ab6=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xc2)]],_0x58165d=[_0x469916[_0x10c8a9(0x151)]['from_invoice']],_0xb6e6ea=[_0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x119)]];else var _0x2e2df7=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xd0)]],_0x376131=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x16a)]],_0xce8e42=[..._0x469916['body'][_0x10c8a9(0x126)]],_0x35ad20=[..._0x469916['body'][_0x10c8a9(0x184)]],_0x2bfd8d=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xff)]],_0xdfedf1=[..._0x469916[_0x10c8a9(0x151)]['primary_code']],_0x32a463=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x139)]],_0x6bbfdb=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x15a)]],_0x4a728a=[..._0x469916['body']['MaxStocks_data2']],_0x2beae2=[..._0x469916[_0x10c8a9(0x151)]['primary_unit']],_0xd3109d=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xbf)]],_0x5ae9c7=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x156)]],_0x484a31=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x173)]],_0x294e08=[..._0x469916['body'][_0x10c8a9(0xc9)]],_0x1eb193=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x104)]],_0x49aee8=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x10b)]],_0x53f070=[..._0x469916['body'][_0x10c8a9(0x124)]],_0x3c0daf=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x154)]],_0x4d4ab6=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0xc2)]],_0x58165d=[..._0x469916['body'][_0x10c8a9(0x13b)]],_0xb6e6ea=[..._0x469916[_0x10c8a9(0x151)][_0x10c8a9(0x119)]];const _0x35f0eb=_0x2e2df7['map'](_0xac97c3=>{return _0xac97c3={'product_name':_0xac97c3};});_0x376131[_0x10c8a9(0x148)]((_0x5afe0c,_0x50547f)=>{var _0x586ecb=_0x10c8a9;_0x35f0eb[_0x50547f][_0x586ecb(0x15e)]=_0x5afe0c;}),_0xce8e42['forEach']((_0x2a518c,_0x29e89a)=>{var _0x4aa5d1=_0x10c8a9;_0x35f0eb[_0x29e89a][_0x4aa5d1(0x160)]=_0x2a518c;}),_0x58165d[_0x10c8a9(0x148)]((_0x52b48c,_0x1a31cb)=>{_0x35f0eb[_0x1a31cb]['from_invoice']=_0x52b48c;}),_0xb6e6ea[_0x10c8a9(0x148)]((_0x50164c,_0x5e2fdc)=>{var _0xced2e5=_0x10c8a9;_0x35f0eb[_0x5e2fdc][_0xced2e5(0x115)]=_0x50164c;}),_0x35ad20[_0x10c8a9(0x148)]((_0x41c95b,_0x1debcd)=>{var _0x85c3f3=_0x10c8a9;_0x35f0eb[_0x1debcd][_0x85c3f3(0xce)]=_0x41c95b;}),_0x2bfd8d[_0x10c8a9(0x148)]((_0x4e13b4,_0x3ed34c)=>{var _0x44e848=_0x10c8a9;_0x35f0eb[_0x3ed34c][_0x44e848(0x180)]=_0x4e13b4;}),_0xdfedf1[_0x10c8a9(0x148)]((_0x59110b,_0x138866)=>{_0x35f0eb[_0x138866]['primary_code']=_0x59110b;}),_0x32a463[_0x10c8a9(0x148)]((_0x5bc7e1,_0x248a0f)=>{var _0x2eb61f=_0x10c8a9;_0x35f0eb[_0x248a0f][_0x2eb61f(0x139)]=_0x5bc7e1;}),_0x6bbfdb[_0x10c8a9(0x148)]((_0x2e405c,_0x145dc8)=>{var _0x436dbb=_0x10c8a9;_0x35f0eb[_0x145dc8][_0x436dbb(0x120)]=_0x2e405c;}),_0x4a728a[_0x10c8a9(0x148)]((_0xaeb50f,_0x493219)=>{var _0x414b3a=_0x10c8a9;_0x35f0eb[_0x493219][_0x414b3a(0x123)]=_0xaeb50f;}),_0x2beae2[_0x10c8a9(0x148)]((_0x1594f2,_0x2c9174)=>{_0x35f0eb[_0x2c9174]['unit']=_0x1594f2;}),_0xd3109d[_0x10c8a9(0x148)]((_0x45642d,_0x30639a)=>{var _0xcec755=_0x10c8a9;_0x35f0eb[_0x30639a][_0xcec755(0xbf)]=_0x45642d;}),_0x5ae9c7['forEach']((_0x1fb3a0,_0x21e81b)=>{var _0x16f485=_0x10c8a9;_0x35f0eb[_0x21e81b][_0x16f485(0x156)]=_0x1fb3a0;}),_0x484a31['forEach']((_0x530296,_0x2d51b0)=>{_0x35f0eb[_0x2d51b0]['expiry_date']=_0x530296;}),_0x294e08[_0x10c8a9(0x148)]((_0x5002c0,_0x2566d7)=>{var _0x45335c=_0x10c8a9;_0x35f0eb[_0x2566d7][_0x45335c(0xf2)]=_0x5002c0;}),_0x1eb193[_0x10c8a9(0x148)]((_0x1a90c3,_0x46980e)=>{_0x35f0eb[_0x46980e]['maxProducts']=_0x1a90c3;}),_0x49aee8[_0x10c8a9(0x148)]((_0x17b204,_0x2d4da1)=>{var _0x4e3bfd=_0x10c8a9;_0x35f0eb[_0x2d4da1][_0x4e3bfd(0x10b)]=_0x17b204;}),_0x53f070[_0x10c8a9(0x148)]((_0x16f93e,_0xd411c)=>{var _0x187909=_0x10c8a9;_0x35f0eb[_0xd411c][_0x187909(0x124)]=_0x16f93e;}),_0x3c0daf[_0x10c8a9(0x148)]((_0x3e6ebe,_0x1769f5)=>{var _0x3544cc=_0x10c8a9;_0x35f0eb[_0x1769f5][_0x3544cc(0xe6)]=_0x3e6ebe;}),_0x4d4ab6['forEach']((_0xd0fa6e,_0x540c4b)=>{var _0x25288e=_0x10c8a9;_0x35f0eb[_0x540c4b][_0x25288e(0x165)]=_0xd0fa6e;});const _0x3684=_0x35f0eb['filter'](_0x4ccff4=>_0x4ccff4[_0x10c8a9(0xce)]!=='0'&&_0x4ccff4[_0x10c8a9(0xce)]!==''||_0x4ccff4['to_floorlevel']!=='0'&&_0x4ccff4[_0x10c8a9(0x10d)]!=='');var _0x451f3e=0x0;_0x3684[_0x10c8a9(0x148)](_0x13b8fb=>{var _0x2beee5=_0x10c8a9;parseInt(_0x13b8fb[_0x2beee5(0x15e)])<parseInt(_0x13b8fb[_0x2beee5(0xce)])&&_0x451f3e++;});if(_0x451f3e!=0x0)return _0x469916[_0x10c8a9(0x12b)]('errors',_0x10c8a9(0x127)),_0x19724c[_0x10c8a9(0x198)](_0x10c8a9(0x142));const _0x280159=new transfers_finished({'date':_0x4e7b45,'from_warehouse':_0xb58c7c,'to_warehouse':_0x44ab68,'product':_0x3684,'note':_0x11c1b8,'invoice':_0x27ca2b}),_0x137d9b=await _0x280159[_0x10c8a9(0x100)]();_0x469916[_0x10c8a9(0x12b)](_0x10c8a9(0x163),'Product\x20Transfer\x20successfully'),_0x19724c[_0x10c8a9(0x198)](_0x10c8a9(0x125)+_0x137d9b[_0x10c8a9(0x13d)]);}catch(_0x49ebbe){console[_0x10c8a9(0xe7)](_0x49ebbe),_0x19724c[_0x10c8a9(0x109)](0xc8)[_0x10c8a9(0xfd)]({'errorMessage':_0x49ebbe[_0x10c8a9(0x17f)]});}}),router[a0_0x38b483(0xd7)]('/preview/:id',auth,async(_0x4e1398,_0x47188a)=>{var _0x423f79=a0_0x38b483;try{const {username:_0x5a4f04,email:_0x5b4c2a,role:_0x293a91}=_0x4e1398[_0x423f79(0x16b)],_0x2a9ea2=_0x4e1398[_0x423f79(0x16b)],_0x35277a=await profile[_0x423f79(0x172)]({'email':_0x2a9ea2['email']}),_0x77252c=await master_shop['find'](),_0x188b91=await transfers_finished[_0x423f79(0x11a)](_0x4e1398['params']['id']);let _0x6f0b9a;if(_0x2a9ea2[_0x423f79(0x150)]==_0x423f79(0xe8)){const _0x13e50c=await staff[_0x423f79(0x172)]({'email':_0x2a9ea2['email']});_0x6f0b9a=await warehouse[_0x423f79(0xf8)]({'status':'Enabled','name':_0x13e50c[_0x423f79(0x145)],'warehouse_category':'Finished\x20Goods'});}else _0x6f0b9a=await warehouse[_0x423f79(0xf8)]({'status':_0x423f79(0xec),'warehouse_category':'Finished\x20Goods'});const _0x380413=await warehouse[_0x423f79(0x164)]([{'$match':{'name':_0x188b91['from_warehouse'],'warehouse_category':_0x423f79(0x168)}},{'$unwind':_0x423f79(0x136)},{'$group':{'_id':_0x423f79(0x110),'name':{'$first':_0x423f79(0x176)},'product_stock':{'$first':_0x423f79(0x134)},'bay':{'$first':_0x423f79(0x107)},'bin':{'$first':_0x423f79(0x16f)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x423f79(0xee)},'secondary_code':{'$first':_0x423f79(0x155)},'product_code':{'$first':_0x423f79(0x16d)},'storage':{'$first':_0x423f79(0x112)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x423f79(0x10f)},'room':{'$first':_0x423f79(0x10e)},'warehoue_name':{'$first':_0x423f79(0xd2)}}}]),_0x511929=await product[_0x423f79(0xf8)]({});if(_0x77252c[0x0][_0x423f79(0x133)]==_0x423f79(0x181)){var _0x158565=users[_0x423f79(0x121)];console[_0x423f79(0xe7)](_0x158565);}else{if(_0x77252c[0x0]['language']==_0x423f79(0x17c))var _0x158565=users[_0x423f79(0x17c)];else{if(_0x77252c[0x0][_0x423f79(0x133)]==_0x423f79(0x13a))var _0x158565=users[_0x423f79(0x13a)];else{if(_0x77252c[0x0]['language']==_0x423f79(0x10c))var _0x158565=users['Spanish'];else{if(_0x77252c[0x0][_0x423f79(0x133)]==_0x423f79(0xda))var _0x158565=users[_0x423f79(0xda)];else{if(_0x77252c[0x0][_0x423f79(0x133)]=='Portuguese\x20(BR)')var _0x158565=users['Portuguese'];else{if(_0x77252c[0x0][_0x423f79(0x133)]=='Chinese')var _0x158565=users[_0x423f79(0x18c)];else{if(_0x77252c[0x0][_0x423f79(0x133)]==_0x423f79(0xd6))var _0x158565=users[_0x423f79(0x15d)];}}}}}}}_0x47188a[_0x423f79(0xde)](_0x423f79(0x118),{'success':_0x4e1398[_0x423f79(0x12b)](_0x423f79(0x163)),'errors':_0x4e1398[_0x423f79(0x12b)](_0x423f79(0xf6)),'role':_0x2a9ea2,'profile':_0x35277a,'master_shop':_0x77252c,'warehouse':_0x6f0b9a,'transfer':_0x188b91,'stock':_0x380413,'unit':_0x511929,'language':_0x158565});}catch(_0x4c9d2b){console[_0x423f79(0xe7)](_0x4c9d2b);}}),router[a0_0x38b483(0x169)]('/preview/:id',auth,async(_0x566d9b,_0x3940cc)=>{var _0x83c522=a0_0x38b483;try{const {invoice:_0x5c6160,from_warehouse:_0x2186b4,FromRoom_name:_0x30efe6,to_warehouse:_0x5b2351,ToRoom_name:_0x382431}=_0x566d9b[_0x83c522(0x151)],_0xa75eab=await transfers_finished[_0x83c522(0x11a)](_0x566d9b[_0x83c522(0xc1)]['id']),_0x2a7c6e=_0xa75eab['product'][_0x83c522(0x13e)](async _0x5f00e5=>{var _0x125d68=_0x83c522;if(_0x5f00e5[_0x125d68(0xce)]>0x0){var _0x13b5b6=await warehouse[_0x125d68(0x172)]({'name':_0x2186b4,'room':_0x5f00e5[_0x125d68(0xe6)],'warehouse_category':_0x125d68(0x168)});const _0x2c6876=_0x13b5b6[_0x125d68(0x196)][_0x125d68(0x13e)](_0x660c37=>{var _0x3872d2=_0x125d68;_0x660c37[_0x3872d2(0x14c)]==_0x5f00e5['product_name']&&_0x660c37['bay']==_0x5f00e5[_0x3872d2(0x160)]&&_0x660c37[_0x3872d2(0x173)]==_0x5f00e5[_0x3872d2(0x173)]&&_0x660c37[_0x3872d2(0xf2)]==_0x5f00e5[_0x3872d2(0xf2)]&&_0x660c37[_0x3872d2(0x156)]==_0x5f00e5[_0x3872d2(0x156)]&&_0x660c37[_0x3872d2(0x15c)]==_0x5f00e5[_0x3872d2(0x13b)]&&(_0x660c37[_0x3872d2(0x178)]=_0x660c37[_0x3872d2(0x178)]-_0x5f00e5[_0x3872d2(0xce)]);});}return _0x13b5b6;});Promise[_0x83c522(0xea)](_0x2a7c6e)[_0x83c522(0x191)](async _0x5c9883=>{var _0x269182=_0x83c522;try{for(const _0x4e3a8a of _0x5c9883){await _0x4e3a8a[_0x269182(0x100)]();}const _0x31cf32=_0xa75eab[_0x269182(0x11f)][_0x269182(0x13e)](async _0x23b077=>{var _0x73aeba=_0x269182,_0x3d7603=await warehouse[_0x73aeba(0x172)]({'name':_0x5b2351,'room':_0x23b077[_0x73aeba(0x165)]});if(_0x23b077[_0x73aeba(0xce)]>0x0){var _0x97272e=0x0;const _0x79152e=_0x3d7603[_0x73aeba(0x196)][_0x73aeba(0x13e)](_0x10ee07=>{var _0x1f376c=_0x73aeba;_0x10ee07[_0x1f376c(0x14c)]==_0x23b077[_0x1f376c(0x14c)]&&_0x10ee07[_0x1f376c(0xf9)]==_0x23b077['to_bay']&&_0x10ee07[_0x1f376c(0x173)]==_0x23b077[_0x1f376c(0x173)]&&_0x10ee07['production_date']==_0x23b077['production_date']&&_0x10ee07[_0x1f376c(0x156)]==_0x23b077[_0x1f376c(0x156)]&&_0x10ee07[_0x1f376c(0x15c)]==_0x23b077[_0x1f376c(0x115)]&&(_0x10ee07[_0x1f376c(0x178)]=_0x10ee07[_0x1f376c(0x178)]+_0x23b077[_0x1f376c(0xce)],_0x97272e++);});_0x97272e=='0'&&(_0x3d7603[_0x73aeba(0x196)]=_0x3d7603[_0x73aeba(0x196)][_0x73aeba(0xcf)]({'product_name':_0x23b077[_0x73aeba(0x14c)],'product_stock':_0x23b077['to_quantity'],'bay':_0x23b077[_0x73aeba(0x180)],'product_code':_0x23b077[_0x73aeba(0x120)],'primary_code':_0x23b077['primary_code'],'secondary_code':_0x23b077[_0x73aeba(0x139)],'expiry_date':_0x23b077[_0x73aeba(0x173)],'production_date':_0x23b077[_0x73aeba(0xf2)],'maxProducts':_0x23b077[_0x73aeba(0x123)],'batch_code':_0x23b077[_0x73aeba(0x156)],'secondary_unit':_0x23b077[_0x73aeba(0xbf)],'unit':_0x23b077[_0x73aeba(0x186)],'maxProducts':_0x23b077[_0x73aeba(0x123)],'maxPerUnit':_0x23b077[_0x73aeba(0x10b)],'invoice':_0x23b077[_0x73aeba(0x115)]}));}return _0x3d7603;});Promise['all'](_0x31cf32)[_0x269182(0x191)](async _0x2bfc48=>{var _0x1e4233=_0x269182;try{for(const _0x22d765 of _0x2bfc48){await warehouse['updateOne']({'_id':_0x22d765['_id']},{'$addToSet':{'product_details':{'$each':_0x22d765[_0x1e4233(0x196)]}}});}_0xa75eab[_0x1e4233(0x17a)]=_0x1e4233(0x183);const _0x705ac5=await _0xa75eab['save'](),_0x1e942d=await master_shop[_0x1e4233(0xf8)](),_0x5bf86c=await email_settings[_0x1e4233(0x172)](),_0x2a8275=await supervisor_settings[_0x1e4233(0xf8)]();var _0x6829c=_0xa75eab['product'],_0x44ca21='',_0x3117f3;for(_0x3117f3 in _0x6829c){var _0x1952a1='FG';_0xa75eab['to_warehouse']==_0x1e4233(0xd8)&&(_0x1952a1='DG'),_0x44ca21+='<tr>'+_0x1e4233(0x140)+_0x6829c[_0x3117f3][_0x1e4233(0x14c)]+_0x1e4233(0x19b)+_0x1e4233(0x140)+_0x6829c[_0x3117f3][_0x1e4233(0x120)]+_0x1e4233(0x19b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x6829c[_0x3117f3][_0x1e4233(0xce)]+'</td>'+_0x1e4233(0x140)+_0x6829c[_0x3117f3][_0x1e4233(0x186)]+_0x1e4233(0x19b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x6829c[_0x3117f3][_0x1e4233(0xbf)]+_0x1e4233(0x19b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xa75eab[_0x1e4233(0xf5)]+'</td>'+_0x1e4233(0x140)+_0x6829c[_0x3117f3]['to_room_name']+_0x1e4233(0x19b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1952a1+_0x6829c[_0x3117f3][_0x1e4233(0x180)]+_0x1e4233(0x19b)+_0x1e4233(0xe0);}let _0x4c9c2b=nodemailer[_0x1e4233(0x13c)]({'host':_0x5bf86c[_0x1e4233(0x105)],'port':Number(_0x5bf86c[_0x1e4233(0xcb)]),'secure':![],'auth':{'user':_0x5bf86c[_0x1e4233(0xf7)],'pass':_0x5bf86c[_0x1e4233(0x12e)]}}),_0x44578c={'from':_0x5bf86c[_0x1e4233(0xf7)],'to':_0x2a8275[0x0][_0x1e4233(0x174)],'subject':_0x1e4233(0x182),'attachments':[{'filename':_0x1e4233(0xf1),'path':__dirname+_0x1e4233(0x189)+_0x1e4233(0x130)+_0x1e942d[0x0][_0x1e4233(0xe5)],'cid':_0x1e4233(0x193)}],'html':'<!DOCTYPE\x20html>'+_0x1e4233(0x102)+'</head><body>'+'<div>'+_0x1e4233(0x161)+'<div>'+_0x1e4233(0x106)+_0x1e4233(0xca)+_0x1e4233(0x116)+'<h2>\x20'+_0x1e942d[0x0]['site_title']+_0x1e4233(0x103)+_0x1e4233(0xca)+_0x1e4233(0xca)+_0x1e4233(0x153)+'<div>'+_0x1e4233(0xc8)+_0x1e4233(0x12a)+_0xa75eab[_0x1e4233(0x15c)]+'\x20'+_0x1e4233(0xdb)+_0x1e4233(0x14d)+_0xa75eab[_0x1e4233(0xd3)]+'\x20'+_0x1e4233(0x152)+_0x1e4233(0x18d)+_0x1e4233(0xca)+_0x1e4233(0x10a)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1e4233(0x143)+_0x1e4233(0xdd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1e4233(0x141)+_0x1e4233(0x135)+_0x1e4233(0x159)+_0x1e4233(0x14f)+_0x1e4233(0xd4)+_0x1e4233(0x131)+'</tr>'+'</thead>'+_0x1e4233(0x138)+'\x20'+_0x44ca21+'\x20'+_0x1e4233(0xe1)+_0x1e4233(0x199)+_0x1e4233(0x116)+_0x1e4233(0x12d)+'<h5>'+_0x1e942d[0x0][_0x1e4233(0x188)]+_0x1e4233(0x18d)+_0x1e4233(0xca)+_0x1e4233(0xca)+_0x1e4233(0xfb)};_0x4c9c2b[_0x1e4233(0x17b)](_0x44578c,function(_0x38432b,_0x152247){var _0x27530c=_0x1e4233;_0x38432b?(console[_0x27530c(0xe7)](_0x38432b),console[_0x27530c(0xe7)](_0x27530c(0x12c))):console[_0x27530c(0xe7)](_0x27530c(0x19a));}),_0x566d9b[_0x1e4233(0x12b)](_0x1e4233(0x163),'Transfer\x20Finalize\x20Successfully'),_0x3940cc['redirect'](_0x1e4233(0x132)+_0x705ac5['_id']);}catch(_0x181a33){console[_0x1e4233(0xeb)](_0x181a33),_0x3940cc[_0x1e4233(0x109)](0x1f4)['json']({'error':_0x1e4233(0xd5)});}})['catch'](_0x3dc627=>{var _0x324547=_0x269182;console[_0x324547(0xeb)](_0x3dc627),_0x3940cc[_0x324547(0x109)](0x1f4)[_0x324547(0xfd)]({'error':_0x324547(0x170)});});}catch(_0x23c8ef){console[_0x269182(0xeb)](_0x23c8ef),_0x3940cc[_0x269182(0x109)](0x1f4)[_0x269182(0xfd)]({'error':_0x269182(0x187)});}})[_0x83c522(0x166)](_0xd9cd4f=>{var _0x1512e4=_0x83c522;console[_0x1512e4(0xeb)](_0xd9cd4f),_0x3940cc['status'](0x1f4)[_0x1512e4(0xfd)]({'error':_0x1512e4(0x170)});});}catch(_0x358bdf){_0x3940cc[_0x83c522(0xfd)]({'message':_0x358bdf['message']});}});function BayBinSelected(_0x3992d9,_0x231043){var _0x238d71=a0_0x38b483,_0x32bbee=[];let _0x4cd3ad=[];var _0x41eaf5=[];if(_0x3992d9=='DRY\x20GOODS'){switch(_0x231043){case _0x238d71(0x117):_0x32bbee=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x238d71(0x175):_0x32bbee=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x41eaf5=['DG'];}else{if(_0x3992d9=='FROZEN\x20GOODS'){switch(_0x231043){case'Rack\x201':_0x32bbee=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x32bbee=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x41eaf5=['FG'];}}return{'levels':_0x32bbee,'identify':_0x41eaf5};}router[a0_0x38b483(0xd7)](a0_0x38b483(0x195),auth,async(_0x47ad9b,_0x214fc8)=>{var _0x4411d0=a0_0x38b483;try{const {username:_0x5d3943,email:_0x42355c,role:_0x3925a7}=_0x47ad9b[_0x4411d0(0x16b)],_0x57e402=_0x47ad9b[_0x4411d0(0x16b)],_0x1be748=await profile[_0x4411d0(0x172)]({'email':_0x57e402[_0x4411d0(0xf7)]}),_0x5dded4=await master_shop[_0x4411d0(0xf8)](),_0x4e9e10=await transfers_finished[_0x4411d0(0x11a)](_0x47ad9b[_0x4411d0(0xc1)]['id']);let _0x2cb533=new Date(_0x4e9e10[_0x4411d0(0x173)]),_0x21ba98=('0'+_0x2cb533['getDate']())['slice'](-0x2),_0x24698c=('0'+(_0x2cb533[_0x4411d0(0xfa)]()+0x1))['slice'](-0x2),_0x339ee2=_0x2cb533['getFullYear'](),_0x11ed13=_0x339ee2+'-'+_0x24698c+'-'+_0x21ba98,_0x5314c7;if(_0x57e402[_0x4411d0(0x150)]==_0x4411d0(0xe8)){const _0x333c32=await staff[_0x4411d0(0x172)]({'email':_0x57e402[_0x4411d0(0xf7)]});_0x5314c7=await warehouse[_0x4411d0(0xf8)]({'status':_0x4411d0(0xec),'name':_0x333c32[_0x4411d0(0x145)],'warehouse_category':_0x4411d0(0x168)});}else _0x5314c7=await warehouse[_0x4411d0(0xf8)]({'status':_0x4411d0(0xec),'warehouse_category':_0x4411d0(0x168)});const _0x5bc491=await warehouse['aggregate']([{'$match':{'name':_0x4e9e10[_0x4411d0(0x11c)],'room':_0x4e9e10[_0x4411d0(0x14b)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4411d0(0x110),'name':{'$first':_0x4411d0(0x176)},'product_stock':{'$first':_0x4411d0(0x134)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4411d0(0x16f)},'type':{'$first':_0x4411d0(0xc7)},'floorlevel':{'$first':_0x4411d0(0x11b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4411d0(0x155)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4411d0(0x190)}}}]);var _0x317602=[0x1,0x2,0x3,0x4],_0x146811=['A','B','C','D','E','F','G','H','I','J'],_0x54b6f7=[_0x4411d0(0x15b),'Enclosed'];const _0xf1a095=await product['find']({}),_0x56f6e5=BayBinSelected(_0x4e9e10[_0x4411d0(0xf5)],_0x4e9e10[_0x4411d0(0xed)]);if(_0x5dded4[0x0][_0x4411d0(0x133)]==_0x4411d0(0x181)){var _0x4dc0cd=users[_0x4411d0(0x121)];console[_0x4411d0(0xe7)](_0x4dc0cd);}else{if(_0x5dded4[0x0]['language']==_0x4411d0(0x17c))var _0x4dc0cd=users[_0x4411d0(0x17c)];else{if(_0x5dded4[0x0][_0x4411d0(0x133)]=='German')var _0x4dc0cd=users['German'];else{if(_0x5dded4[0x0][_0x4411d0(0x133)]==_0x4411d0(0x10c))var _0x4dc0cd=users[_0x4411d0(0x10c)];else{if(_0x5dded4[0x0]['language']==_0x4411d0(0xda))var _0x4dc0cd=users[_0x4411d0(0xda)];else{if(_0x5dded4[0x0][_0x4411d0(0x133)]=='Portuguese\x20(BR)')var _0x4dc0cd=users[_0x4411d0(0xef)];else{if(_0x5dded4[0x0][_0x4411d0(0x133)]==_0x4411d0(0x18c))var _0x4dc0cd=users[_0x4411d0(0x18c)];else{if(_0x5dded4[0x0][_0x4411d0(0x133)]==_0x4411d0(0xd6))var _0x4dc0cd=users[_0x4411d0(0x15d)];}}}}}}}_0x214fc8[_0x4411d0(0xde)](_0x4411d0(0xc5),{'success':_0x47ad9b[_0x4411d0(0x12b)](_0x4411d0(0x163)),'errors':_0x47ad9b[_0x4411d0(0x12b)](_0x4411d0(0xf6)),'role':_0x57e402,'profile':_0x1be748,'master_shop':_0x5dded4,'warehouse':_0x5314c7,'transfer':_0x4e9e10,'stock':_0x5bc491,'unit':_0xf1a095,'language':_0x4dc0cd,'levels':_0x317602,'Isle':_0x146811,'rooms_data':_0x54b6f7,'ed_fullDate':_0x11ed13,'dataSelected':_0x56f6e5});}catch(_0x24c03c){console[_0x4411d0(0xe7)](_0x24c03c);}}),router[a0_0x38b483(0x169)](a0_0x38b483(0x195),auth,async(_0x403cb1,_0x5646b0)=>{var _0x53e517=a0_0x38b483;try{const _0x189eca=_0x403cb1[_0x53e517(0xc1)]['id'];console[_0x53e517(0xe7)](_0x403cb1[_0x53e517(0x151)]);const _0x196499=await transfers_finished[_0x53e517(0x11a)](_0x189eca);console[_0x53e517(0xe7)](_0x53e517(0x149),_0x196499);const {date:_0x2c630b,from_warehouse:_0x49629b,FromRoom_name:_0xb1fcc9,to_warehouse:_0x5b70b1,ToRoom_name:_0x4d9c15,prod_name:_0x439af3,from_prod_qty:_0x24a25d,from_prod_level:_0x5d639c,from_prod_isle:_0xfb6854,from_prod_pallet:_0x3e91d9,to_prod_qty:_0x277884,to_prod_level:_0x3c15b8,to_prod_isle:_0x3a8ef0,to_prod_pallet:_0x1e13f1,primary_code:_0x598bf7,secondary_code:_0x46a8c8,product_code3:_0x2cf5c5,note:_0x2c722d,invoice:_0x204c9d,expiry_date:_0x4cbc5a}=_0x403cb1[_0x53e517(0x151)];if(typeof _0x439af3==_0x53e517(0x16e))var _0x5a5406=[_0x403cb1['body'][_0x53e517(0xd0)]],_0x325e12=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x16a)]],_0x4239ef=[_0x403cb1[_0x53e517(0x151)]['from_prod_level']],_0x2ce5c6=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x17d)]],_0x4c67af=[_0x403cb1['body'][_0x53e517(0xff)]],_0x1a41a0=[_0x403cb1['body'][_0x53e517(0xf0)]],_0x5bbb33=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x139)]],_0x530425=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x15a)]],_0x2e665a=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x18e)]],_0x23eb27=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x186)]],_0x38a4ad=[_0x403cb1['body'][_0x53e517(0xbf)]],_0x2c7cde=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x156)]],_0x451c9b=[_0x403cb1[_0x53e517(0x151)][_0x53e517(0x173)]];else var _0x5a5406=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0xd0)]],_0x325e12=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0x16a)]],_0x4239ef=[..._0x403cb1['body'][_0x53e517(0x126)]],_0x2ce5c6=[..._0x403cb1[_0x53e517(0x151)]['to_prod_qty']],_0x4c67af=[..._0x403cb1[_0x53e517(0x151)]['to_prod_level']],_0x1a41a0=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0xf0)]],_0x5bbb33=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0x139)]],_0x530425=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0x15a)]],_0x2e665a=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0x18e)]],_0x23eb27=[..._0x403cb1[_0x53e517(0x151)][_0x53e517(0x186)]],_0x38a4ad=[..._0x403cb1[_0x53e517(0x151)]['secondary_unit']],_0x2c7cde=[..._0x403cb1['body'][_0x53e517(0x156)]],_0x451c9b=[..._0x403cb1['body']['expiry_date']];const _0x2edc5d=_0x5a5406['map'](_0x3109f4=>{return _0x3109f4={'product_name':_0x3109f4};});_0x325e12[_0x53e517(0x148)]((_0x2d3df8,_0x4e00f2)=>{_0x2edc5d[_0x4e00f2]['from_quantity']=_0x2d3df8;}),_0x4239ef[_0x53e517(0x148)]((_0x3b24a3,_0x45bfdc)=>{var _0x5b56bb=_0x53e517;_0x2edc5d[_0x45bfdc][_0x5b56bb(0x160)]=_0x3b24a3;}),_0x2ce5c6['forEach']((_0x492906,_0x5f583b)=>{var _0x378291=_0x53e517;_0x2edc5d[_0x5f583b][_0x378291(0xce)]=_0x492906;}),_0x4c67af[_0x53e517(0x148)]((_0xc5a002,_0x2396d4)=>{var _0x21c028=_0x53e517;_0x2edc5d[_0x2396d4][_0x21c028(0x180)]=_0xc5a002;}),_0x1a41a0[_0x53e517(0x148)]((_0x2e8d38,_0x2405d0)=>{_0x2edc5d[_0x2405d0]['primary_code']=_0x2e8d38;}),_0x5bbb33[_0x53e517(0x148)]((_0x46911e,_0x6dc72c)=>{var _0xdca428=_0x53e517;_0x2edc5d[_0x6dc72c][_0xdca428(0x139)]=_0x46911e;}),_0x530425[_0x53e517(0x148)]((_0x381afb,_0x2624f2)=>{var _0x3ff6da=_0x53e517;_0x2edc5d[_0x2624f2][_0x3ff6da(0x120)]=_0x381afb;}),_0x2e665a['forEach']((_0x57f2bc,_0x1dbb95)=>{var _0x25a3c0=_0x53e517;_0x2edc5d[_0x1dbb95][_0x25a3c0(0x123)]=_0x57f2bc;}),_0x23eb27[_0x53e517(0x148)]((_0x5be8e0,_0x362995)=>{var _0x2c4c4d=_0x53e517;_0x2edc5d[_0x362995][_0x2c4c4d(0x186)]=_0x5be8e0;}),_0x38a4ad[_0x53e517(0x148)]((_0x16a6a8,_0x342d7a)=>{var _0x4a8783=_0x53e517;_0x2edc5d[_0x342d7a][_0x4a8783(0xbf)]=_0x16a6a8;}),_0x2c7cde[_0x53e517(0x148)]((_0x3128af,_0x3ab464)=>{var _0xa8a181=_0x53e517;_0x2edc5d[_0x3ab464][_0xa8a181(0x156)]=_0x3128af;}),_0x451c9b[_0x53e517(0x148)]((_0x365c77,_0x4bee31)=>{var _0x5cb91e=_0x53e517;_0x2edc5d[_0x4bee31][_0x5cb91e(0x173)]=_0x365c77;});const _0x257626=_0x2edc5d[_0x53e517(0xf4)](_0x38624d=>_0x38624d[_0x53e517(0xce)]!=='0'&&_0x38624d['to_quantity']!==''||_0x38624d[_0x53e517(0x10d)]!=='0'&&_0x38624d['to_floorlevel']!=='');var _0x23952a=0x0;_0x257626[_0x53e517(0x148)](_0x1dac32=>{parseInt(_0x1dac32['from_quantity'])<parseInt(_0x1dac32['to_quantity'])&&_0x23952a++;});if(_0x23952a!=0x0)return _0x403cb1[_0x53e517(0x12b)](_0x53e517(0xf6),_0x53e517(0x127)),_0x5646b0['redirect'](_0x53e517(0x142));const _0x4da604=await warehouse['findOne']({'name':_0x196499[_0x53e517(0x11c)],'room':_0x196499[_0x53e517(0x14b)]});_0x196499[_0x53e517(0x11f)][_0x53e517(0x148)](_0x3dd501=>{var _0x397e27=_0x53e517;if(_0x3dd501['to_quantity']>0x0){const _0x2a6dd4=_0x4da604[_0x397e27(0x196)]['map'](_0x14a7b5=>{var _0x1e9a4e=_0x397e27;_0x14a7b5[_0x1e9a4e(0x14c)]==_0x3dd501['product_name']&&_0x14a7b5[_0x1e9a4e(0xf9)]==_0x3dd501[_0x1e9a4e(0x160)]&&(_0x14a7b5[_0x1e9a4e(0x178)]=parseInt(_0x14a7b5[_0x1e9a4e(0x178)])+parseInt(_0x3dd501[_0x1e9a4e(0xce)]));});}}),await _0x4da604[_0x53e517(0x100)]();const _0x54bbd3=await warehouse['findOne']({'name':_0x196499[_0x53e517(0xf5)],'room':_0x196499[_0x53e517(0xed)]});_0x196499['product'][_0x53e517(0x148)](_0x562d40=>{var _0x3d2e17=_0x53e517;if(_0x562d40[_0x3d2e17(0xce)]>0x0){const _0x2cbab4=_0x54bbd3[_0x3d2e17(0x196)]['map'](_0x3f6e7b=>{var _0x645089=_0x3d2e17;_0x3f6e7b[_0x645089(0x14c)]==_0x562d40[_0x645089(0x14c)]&&_0x3f6e7b[_0x645089(0xf9)]==_0x562d40[_0x645089(0x180)]&&(_0x3f6e7b['product_stock']=parseInt(_0x3f6e7b[_0x645089(0x178)])-parseInt(_0x562d40[_0x645089(0xce)]));});}}),await _0x54bbd3[_0x53e517(0x100)](),_0x196499[_0x53e517(0xd3)]=_0x2c630b,_0x196499[_0x53e517(0x11c)]=_0x49629b,_0x196499[_0x53e517(0xf5)]=_0x5b70b1,_0x196499[_0x53e517(0x11f)]=_0x257626,_0x196499[_0x53e517(0x144)]=_0x2c722d,_0x196499[_0x53e517(0x15c)]=_0x204c9d;const _0x7372b6=await _0x196499[_0x53e517(0x100)](),_0x23e70f=await warehouse[_0x53e517(0x172)]({'name':_0x49629b,'room':_0xb1fcc9});_0x7372b6[_0x53e517(0x11f)][_0x53e517(0x148)](_0x332e98=>{var _0x3ada31=_0x53e517;if(_0x332e98['to_quantity']>0x0){const _0x5a138b=_0x23e70f[_0x3ada31(0x196)]['map'](_0x38f4be=>{var _0x1bf266=_0x3ada31;_0x38f4be['product_name']==_0x332e98['product_name']&&_0x38f4be['bay']==_0x332e98[_0x1bf266(0x160)]&&(_0x38f4be[_0x1bf266(0x178)]=parseInt(_0x38f4be['product_stock'])-parseInt(_0x332e98[_0x1bf266(0xce)]));});}}),await _0x23e70f['save']();const _0x13675c=await warehouse['findOne']({'name':_0x5b70b1,'room':_0x4d9c15});_0x7372b6[_0x53e517(0x11f)][_0x53e517(0x148)](_0x484d8e=>{var _0x131e9d=_0x53e517;if(_0x484d8e[_0x131e9d(0xce)]>0x0){var _0x42017e=0x0;const _0xcc99e8=_0x13675c[_0x131e9d(0x196)]['map'](_0xd85ede=>{var _0x341228=_0x131e9d;_0xd85ede['product_name']==_0x484d8e[_0x341228(0x14c)]&&_0xd85ede['bay']==_0x484d8e[_0x341228(0x180)]&&(_0xd85ede[_0x341228(0x178)]=parseInt(_0xd85ede[_0x341228(0x178)])+parseInt(_0x484d8e[_0x341228(0xce)]),_0x42017e++);});_0x42017e=='0'&&(_0x13675c[_0x131e9d(0x196)]=_0x13675c[_0x131e9d(0x196)][_0x131e9d(0xcf)]({'product_name':_0x484d8e[_0x131e9d(0x14c)],'product_stock':_0x484d8e[_0x131e9d(0xce)],'bay':_0x484d8e[_0x131e9d(0x180)],'product_code':_0x484d8e[_0x131e9d(0x120)],'primary_code':_0x484d8e[_0x131e9d(0xf0)],'secondary_code':_0x484d8e[_0x131e9d(0x139)],'maxProducts':_0x484d8e[_0x131e9d(0x123)]}));}}),await _0x13675c['save'](),_0x403cb1[_0x53e517(0x12b)](_0x53e517(0x163),_0x53e517(0xfe)),_0x5646b0['redirect'](_0x53e517(0x194));}catch(_0x35b7b9){console[_0x53e517(0xe7)](_0x35b7b9);}}),router[a0_0x38b483(0x169)]('/barcode_scanner',async(_0x2c7678,_0x40dc2c)=>{var _0x342d8b=a0_0x38b483;const {FromWareHouse:_0x4dd317,FromRoom:_0x2f511c,ToWarehouse:_0x2816b2,ToRoom:_0x3a81b4,primary_code:_0x2b2d6b,Roomslist:_0xf2b706}=_0x2c7678[_0x342d8b(0x151)],_0x560748=_0xf2b706[_0x342d8b(0x13f)](','),_0x2067a9=[];async function _0x149d2e(_0x1abaec){var _0x220b4b=_0x342d8b;const _0x4b0357=await warehouse[_0x220b4b(0x164)]([{'$match':{'name':_0x4dd317,'room':_0x1abaec}},{'$unwind':_0x220b4b(0x136)},{'$match':{'product_details.primary_code':_0x2b2d6b}},{'$group':{'_id':_0x220b4b(0x110),'name':{'$first':_0x220b4b(0x176)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x220b4b(0x155)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x220b4b(0x107)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x220b4b(0xc7)},'pallet':{'$first':_0x220b4b(0x11b)},'unit':{'$first':_0x220b4b(0x16c)},'secondary_unit':{'$first':_0x220b4b(0xdc)},'storage':{'$first':_0x220b4b(0x112)},'rack':{'$first':_0x220b4b(0x190)},'expiry_date':{'$first':_0x220b4b(0xc6)},'production_date':{'$first':_0x220b4b(0x10f)},'batch_code':{'$first':_0x220b4b(0x171)},'maxPerUnit':{'$first':_0x220b4b(0x122)},'roomNamed':{'$first':_0x220b4b(0x10e)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x220b4b(0x129)}}}]),_0x4ccb07=await warehouse[_0x220b4b(0x164)]([{'$match':{'name':_0x4dd317,'room':_0x1abaec}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x2b2d6b}},{'$group':{'_id':_0x220b4b(0x110),'name':{'$first':_0x220b4b(0x176)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x220b4b(0x155)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x220b4b(0x107)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x220b4b(0xc7)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x220b4b(0x16c)},'secondary_unit':{'$first':_0x220b4b(0xdc)},'storage':{'$first':_0x220b4b(0x112)},'rack':{'$first':_0x220b4b(0x190)},'expiry_date':{'$first':_0x220b4b(0xc6)},'production_date':{'$first':_0x220b4b(0x10f)},'batch_code':{'$first':_0x220b4b(0x171)},'maxPerUnit':{'$first':_0x220b4b(0x122)},'roomNamed':{'$first':_0x220b4b(0x10e)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x220b4b(0x129)}}}]);if(_0x4b0357[_0x220b4b(0x157)]>0x0)_0x2067a9[_0x220b4b(0x14a)](_0x4b0357);else _0x4ccb07[_0x220b4b(0x157)]>0x0&&_0x2067a9[_0x220b4b(0x14a)](_0x4ccb07);}const _0x5c34d4=_0x560748[_0x342d8b(0x13e)](_0x1acf01=>_0x149d2e(_0x1acf01));await Promise[_0x342d8b(0xea)](_0x5c34d4),_0x40dc2c[_0x342d8b(0xfd)](_0x2067a9);}),router[a0_0x38b483(0x169)](a0_0x38b483(0x137),async(_0x37aa71,_0x4d31fe)=>{var _0x5bc303=a0_0x38b483;try{const {FromWareHouse:_0x1ecfcd,FromRoom:_0x3141bd,ToWarehouse:_0x3abbc0,ToRoom:_0x4fd18e,secondary_code:_0x4fb1fd}=_0x37aa71[_0x5bc303(0x151)],_0x2b6e55=await warehouse[_0x5bc303(0x164)]([{'$match':{'name':_0x1ecfcd}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x4fb1fd}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5bc303(0x176)},'primary_code':{'$first':_0x5bc303(0xee)},'secondary_code':{'$first':_0x5bc303(0x155)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x5bc303(0x134)},'warehouse':{'$first':'$name'},'level':{'$first':_0x5bc303(0x185)},'isle':{'$first':_0x5bc303(0x114)},'pallet':{'$first':_0x5bc303(0x14e)},'maxProducts':{'$first':_0x5bc303(0x108)},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x5bc303(0xc6)},'production_date':{'$first':_0x5bc303(0x10f)}}}]);_0x4d31fe['status'](0xc8)[_0x5bc303(0xfd)](_0x2b6e55);}catch(_0x11f061){_0x4d31fe[_0x5bc303(0x109)](0x194)[_0x5bc303(0xfd)]({'message':_0x11f061['message']});}}),router[a0_0x38b483(0x169)](a0_0x38b483(0x17e),async(_0x391ce2,_0x317822)=>{var _0x5bf0e5=a0_0x38b483;try{const {FromWareHouse:_0x3b68ae,FromRoom:_0x5f5260,ToWarehouse:_0x28cf3a,ToRoom:_0x3dee42,product_code:_0x26d822}=_0x391ce2[_0x5bf0e5(0x151)],_0x41f3ce=await warehouse[_0x5bf0e5(0x164)]([{'$match':{'name':_0x3b68ae}},{'$unwind':_0x5bf0e5(0x136)},{'$match':{'product_details.product_code':_0x26d822}},{'$group':{'_id':_0x5bf0e5(0x110),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x5bf0e5(0xee)},'secondary_code':{'$first':_0x5bf0e5(0x155)},'product_code':{'$first':_0x5bf0e5(0x16d)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':_0x5bf0e5(0x185)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x5bf0e5(0x108)},'unit':{'$first':_0x5bf0e5(0x16c)}}}]);_0x317822[_0x5bf0e5(0x109)](0xc8)[_0x5bf0e5(0xfd)](_0x41f3ce);}catch(_0x2aeab7){_0x317822[_0x5bf0e5(0x109)](0x194)['json']({'message':_0x2aeab7[_0x5bf0e5(0x17f)]});}}),router[a0_0x38b483(0x169)](a0_0x38b483(0xc3),async(_0x18f6a5,_0xf6b5d4)=>{var _0x4ebf1a=a0_0x38b483;const {productCode:_0x39fe45,bay:_0xb7aa4c,warehouses:_0x1ce403,room:_0x37739f}=_0x18f6a5[_0x4ebf1a(0x151)];console[_0x4ebf1a(0xe7)](_0x18f6a5[_0x4ebf1a(0x151)]);try{const _0x55d844=await warehouse[_0x4ebf1a(0x164)]([{'$match':{'name':_0x1ce403,'room':_0x37739f}},{'$unwind':_0x4ebf1a(0x136)},{'$match':{'product_details.bay':parseInt(_0xb7aa4c)}},{'$group':{'_id':_0x4ebf1a(0x110),'name':{'$first':_0x4ebf1a(0x176)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xf6b5d4[_0x4ebf1a(0x109)](0xc8)[_0x4ebf1a(0xfd)](_0x55d844);}catch(_0x45e309){_0xf6b5d4['status'](0x194)[_0x4ebf1a(0xfd)]({'message':_0x45e309[_0x4ebf1a(0x17f)]});}}),module[a0_0x38b483(0xcd)]=router;