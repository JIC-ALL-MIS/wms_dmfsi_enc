var a0_0xf0084f=a0_0x413a;(function(_0x39c60c,_0x2b49ed){var _0x3a395e=a0_0x413a,_0x3fbfd0=_0x39c60c();while(!![]){try{var _0x4ba6a8=parseInt(_0x3a395e(0x102))/0x1+parseInt(_0x3a395e(0x194))/0x2+parseInt(_0x3a395e(0x199))/0x3*(parseInt(_0x3a395e(0x1c1))/0x4)+parseInt(_0x3a395e(0x1bb))/0x5*(-parseInt(_0x3a395e(0x158))/0x6)+parseInt(_0x3a395e(0x1d5))/0x7+-parseInt(_0x3a395e(0x17f))/0x8*(parseInt(_0x3a395e(0x17c))/0x9)+-parseInt(_0x3a395e(0x144))/0xa;if(_0x4ba6a8===_0x2b49ed)break;else _0x3fbfd0['push'](_0x3fbfd0['shift']());}catch(_0x1bf44d){_0x3fbfd0['push'](_0x3fbfd0['shift']());}}}(a0_0x5bac,0x90f53));const express=require(a0_0xf0084f(0x1c6)),app=express(),router=express[a0_0xf0084f(0x169)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0xf0084f(0x1be)),auth=require('../middleware/auth'),users=require(a0_0xf0084f(0x1d8)),nodemailer=require(a0_0xf0084f(0x174));function a0_0x413a(_0x5eb06b,_0x30bff8){var _0x5baccf=a0_0x5bac();return a0_0x413a=function(_0x413acc,_0x2991ce){_0x413acc=_0x413acc-0x102;var _0x1db21f=_0x5baccf[_0x413acc];return _0x1db21f;},a0_0x413a(_0x5eb06b,_0x30bff8);}router['get'](a0_0xf0084f(0x1d7),auth,async(_0x21bc5a,_0x21ef31)=>{var _0x2670a5=a0_0xf0084f;try{const {username:_0x4c18b2,email:_0x3a4120,role:_0x575a89}=_0x21bc5a['user'],_0x59a86c=_0x21bc5a[_0x2670a5(0x115)],_0x31c084=await profile[_0x2670a5(0x125)]({'email':_0x59a86c[_0x2670a5(0x14e)]}),_0x574e4=await master_shop[_0x2670a5(0x16c)]();let _0x3425dc;if(_0x59a86c['role']==_0x2670a5(0x103)){const _0x3eff08=await staff['findOne']({'email':_0x59a86c[_0x2670a5(0x14e)]});_0x3425dc=await transfers_finished['find']({'from_warehouse':_0x3eff08[_0x2670a5(0x165)]});}else _0x3425dc=await transfers_finished['aggregate']([{'$unwind':_0x2670a5(0x14a)},{'$group':{'_id':_0x2670a5(0x121),'invoice':{'$first':_0x2670a5(0x135)},'date':{'$first':_0x2670a5(0x18f)},'from_warehouse':{'$first':_0x2670a5(0x193)},'to_warehouse':{'$first':_0x2670a5(0x1a2)},'from_room_name':{'$addToSet':_0x2670a5(0x15f)},'to_room_name':{'$addToSet':_0x2670a5(0x17a)},'finalize':{'$first':_0x2670a5(0x134)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x574e4[0x0][_0x2670a5(0x1a1)]==_0x2670a5(0x167))var _0x2fffc5=users[_0x2670a5(0x1ba)];else{if(_0x574e4[0x0][_0x2670a5(0x1a1)]=='Hindi')var _0x2fffc5=users['Hindi'];else{if(_0x574e4[0x0][_0x2670a5(0x1a1)]==_0x2670a5(0x1b2))var _0x2fffc5=users['German'];else{if(_0x574e4[0x0][_0x2670a5(0x1a1)]==_0x2670a5(0x189))var _0x2fffc5=users[_0x2670a5(0x189)];else{if(_0x574e4[0x0][_0x2670a5(0x1a1)]==_0x2670a5(0x143))var _0x2fffc5=users[_0x2670a5(0x143)];else{if(_0x574e4[0x0]['language']=='Portuguese\x20(BR)')var _0x2fffc5=users[_0x2670a5(0x1c2)];else{if(_0x574e4[0x0][_0x2670a5(0x1a1)]==_0x2670a5(0x159))var _0x2fffc5=users[_0x2670a5(0x159)];else{if(_0x574e4[0x0][_0x2670a5(0x1a1)]==_0x2670a5(0x11f))var _0x2fffc5=users['Arabic'];}}}}}}}_0x21ef31[_0x2670a5(0x179)]('transfer_finished',{'success':_0x21bc5a[_0x2670a5(0x1b8)](_0x2670a5(0x107)),'errors':_0x21bc5a['flash'](_0x2670a5(0x157)),'role':_0x59a86c,'profile':_0x31c084,'master_shop':_0x574e4,'transfer':_0x3425dc,'language':_0x2fffc5});}catch(_0x4cde1b){console[_0x2670a5(0x11b)](_0x4cde1b);}});function a0_0x5bac(){var _0x50f7db=['/view/add_transfer','slice','$product_details.bin','product_date','abs','German','from_quantity','<html><head><title></title>','FGSEmail','$product_details.storage','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','flash','_id','English','156835gUkZhc','$product_details.floorlevel','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../models/all_models','edit_transfer_finished','/transfer_finished/preview/','268364ZogNRL','Portuguese','status','$product_details.isle','message','express','Enclosed','image','length','product','sendMail','to_bay','to_room_name','/preview/:id','batch_code','\x20Order\x20Number\x20:\x20','$product_details.type','secondary_unit','product_name','$product_details.bay','4951695JWvTws','prod_name','/view','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','To_invoice','$product_details.invoice','secondary_code','$product_details.production_date','filter','date','197380wWUhTm','staff','save','$product_details','from_invoice','success','\x20<>\x20','product_stock','ToRoomAssigned','$product_details.batch_code','</tbody>','to_quantity','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','note','</span>','primary_code','site_title','<table\x20style=\x22width:\x20100%\x20!important;\x22>','user','/transfer/view','bay','to_room','</div>','push','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','findById','$product_details.product_code','Arabic\x20(ae)','then','$_id','$product_details.product_stock','from_prod_qty','body','findOne','/CheckingWarehouse','all','to_warehouse','$product_details.product_name','forEach','$product_details.secondary_unit','<!DOCTYPE\x20html>','expiry_date','edit_transfer_finished_view','id_transaction','here1','New_Qty_Converted','redirect','maxPerUnit','$finalize','$invoice','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','back','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','get','</thead>','<tbody\x20style=\x22text-align:\x20center;\x22>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','random','$product_details.pallet','$product_details.expiry_date','<div>','/transfer_finished/view','French','2238780MGCtYY','\x20</h2>','MaxStocks_data','$product_details.maxPerUnit','$product_details._id','Portuguese\x20(BR)','$product','/barcode_scanner','role','Transfer\x20Finalize\x20Successfully','email','</td>','Transfer\x20Edit\x20Successfully','An\x20error\x20occurred\x20while\x20saving\x20data.','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Rack\x201','max','string','/barcode_scanner2','errors','30zvMTFG','Chinese','Hindi','Finished\x20Goods','post','from_bay','to_prod_qty','$product.from_room_name','</table>','add_transfer_finished','transfer_data','toString','logo','warehouse','getDate','English\x20(US)','$product_details.unit','Router','$product_details.secondary_code','<h5>','find','$product_details.maxProducts','updateOne','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Product\x20Transfer\x20successfully','catch','</tr>','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','TRFF-','product_details','prod_cat','render','$product.to_room_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','3909474iutvSY','undefined','from_room','16wiWCSn','json','$product_details.level','aggregate','to_prod_level','exports','There\x27s\x20a\x20error\x20in\x20this\x20transaction','primary_unit','MaxStocks_data2','from_prod_level','Spanish','padStart','$room','concat','map','Ambient','$date','product_code3','to_floorlevel','/barcode_scanner3','$from_warehouse','1071842LxeGYw','True','from_warehouse','params','Enabled','18JsVsPI','split','maxProducts','to_invoice','here2','unit','error','<h2>\x20','language','$to_warehouse','/view/:id','$name','$product_details.primary_code','QA\x20Warehouse','production_date','invoice','product_code','from_room_name','password','Logo.png'];a0_0x5bac=function(){return _0x50f7db;};return a0_0x5bac();}async function getRandom8DigitNumber(){var _0x45f21d=a0_0xf0084f;const _0x8ac281=0x989680,_0x127024=0x5f5e0ff,_0x35d65d=Math['floor'](Math[_0x45f21d(0x13e)]()*(_0x127024-_0x8ac281+0x1))+_0x8ac281;var _0x32aaee;const _0xaa5c65=await transfers_finished[_0x45f21d(0x125)]({'invoice':_0x45f21d(0x176)+_0x35d65d});return _0xaa5c65&&_0xaa5c65[_0x45f21d(0x1c9)]>0x0?_0x32aaee='TRFF-'+_0x35d65d:_0x32aaee=_0x45f21d(0x176)+_0x35d65d,_0x32aaee;}router['get']('/view/add_transfer',auth,async(_0x44ffcc,_0x43c6af)=>{var _0x4e216b=a0_0xf0084f;try{const {username:_0x179637,email:_0x29c55b,role:_0x4a6985}=_0x44ffcc[_0x4e216b(0x115)],_0x57551e=_0x44ffcc[_0x4e216b(0x115)],_0x2eea45=await profile[_0x4e216b(0x125)]({'email':_0x57551e[_0x4e216b(0x14e)]}),_0x132e84=await master_shop[_0x4e216b(0x16c)]();let _0x46c1fd;if(_0x57551e[_0x4e216b(0x14c)]==_0x4e216b(0x103)){const _0x28c010=await staff['findOne']({'email':_0x57551e[_0x4e216b(0x14e)]});_0x46c1fd=await warehouse[_0x4e216b(0x182)]([{'$match':{'status':_0x4e216b(0x198),'name':_0x28c010[_0x4e216b(0x165)],'warehouse_category':_0x4e216b(0x15b),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x4e216b(0x1a4),'name':{'$first':_0x4e216b(0x1a4)}}}]);}else _0x46c1fd=await warehouse[_0x4e216b(0x182)]([{'$match':{'status':_0x4e216b(0x198),'warehouse_category':_0x4e216b(0x15b),'name':{'$ne':_0x4e216b(0x1a6)}}},{'$group':{'_id':'$name','name':{'$first':_0x4e216b(0x1a4)}}}]);const _0x1e47fc=await transfers_finished['find']({}),_0x54dcb5=_0x1e47fc['length']+0x1,_0x11a42f='TRFF-'+_0x54dcb5[_0x4e216b(0x163)]()[_0x4e216b(0x18a)](0x5,'0');if(_0x132e84[0x0][_0x4e216b(0x1a1)]==_0x4e216b(0x167))var _0x5571d6=users[_0x4e216b(0x1ba)];else{if(_0x132e84[0x0]['language']==_0x4e216b(0x15a))var _0x5571d6=users[_0x4e216b(0x15a)];else{if(_0x132e84[0x0][_0x4e216b(0x1a1)]==_0x4e216b(0x1b2))var _0x5571d6=users[_0x4e216b(0x1b2)];else{if(_0x132e84[0x0][_0x4e216b(0x1a1)]==_0x4e216b(0x189))var _0x5571d6=users[_0x4e216b(0x189)];else{if(_0x132e84[0x0][_0x4e216b(0x1a1)]==_0x4e216b(0x143))var _0x5571d6=users[_0x4e216b(0x143)];else{if(_0x132e84[0x0][_0x4e216b(0x1a1)]=='Portuguese\x20(BR)')var _0x5571d6=users[_0x4e216b(0x1c2)];else{if(_0x132e84[0x0][_0x4e216b(0x1a1)]==_0x4e216b(0x159))var _0x5571d6=users['Chinese'];else{if(_0x132e84[0x0][_0x4e216b(0x1a1)]=='Arabic\x20(ae)')var _0x5571d6=users['Arabic'];}}}}}}}const _0x3fb396=getRandom8DigitNumber();_0x3fb396[_0x4e216b(0x120)](_0x16d2f1=>{var _0x805bfe=_0x4e216b;_0x43c6af[_0x805bfe(0x179)](_0x805bfe(0x161),{'success':_0x44ffcc[_0x805bfe(0x1b8)](_0x805bfe(0x107)),'errors':_0x44ffcc['flash'](_0x805bfe(0x157)),'role':_0x57551e,'profile':_0x2eea45,'master_shop':_0x132e84,'warehouse':_0x46c1fd,'language':_0x5571d6,'invoice':_0x16d2f1});})[_0x4e216b(0x172)](_0x188811=>{var _0x49da47=_0x4e216b;_0x44ffcc[_0x49da47(0x1b8)](_0x49da47(0x157),_0x49da47(0x185)),_0x43c6af[_0x49da47(0x132)](_0x49da47(0x116));});}catch(_0x440f2d){console['log'](_0x440f2d);}}),router[a0_0xf0084f(0x15c)](a0_0xf0084f(0x1ad),auth,async(_0x1b3072,_0x1fe8af)=>{var _0x18fccf=a0_0xf0084f;try{const {date:_0x1c9422,from_warehouse:_0x5b3182,FromRoom_name:_0x4a34d2,to_warehouse:_0x1aa7ea,ToRoom_name:_0x1f4fbc,prod_name:_0x4803e9,from_prod_qty:_0x3e9582,from_prod_level:_0x498910,from_prod_isle:_0x512e31,from_prod_pallet:_0x204902,to_prod_qty:_0x5a1ea3,to_prod_level:_0x49d117,to_prod_isle:_0x2437b5,to_prod_pallet:_0x425af2,primary_code:_0x3a8980,secondary_code:_0x1aec17,product_code3:_0x25170a,note:_0x5c4f7b,MaxStocks_data2:_0x1cf905,invoice:_0x4f0f4d,expiry_date:_0x52e3d2}=_0x1b3072['body'];if(typeof _0x4803e9==_0x18fccf(0x155))var _0x294866=[_0x1b3072[_0x18fccf(0x124)]['prod_name']],_0x3e5411=[_0x1b3072['body'][_0x18fccf(0x123)]],_0x23785c=[_0x1b3072['body'][_0x18fccf(0x188)]],_0xa772b3=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x131)]],_0x103689=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x183)]],_0x2fde34=[_0x1b3072[_0x18fccf(0x124)]['primary_code']],_0x1235d2=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1dc)]],_0x519095=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x190)]],_0x172107=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x187)]],_0x47287a=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x186)]],_0x33b5f0=[_0x1b3072[_0x18fccf(0x124)]['secondary_unit']],_0x16a391=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1cf)]],_0x214df8=[_0x1b3072['body'][_0x18fccf(0x12d)]],_0x20a71b=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1b0)]],_0x7ba893=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x146)]],_0x415a4e=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x133)]],_0xa3e43=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x178)]],_0x30bdb5=[_0x1b3072[_0x18fccf(0x124)]['RoomAssigned']],_0x4a75ff=[_0x1b3072['body'][_0x18fccf(0x10a)]],_0x40e8d3=[_0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x106)]],_0x4381b1=[_0x1b3072[_0x18fccf(0x124)]['to_invoice']],_0x490772=[_0x1b3072[_0x18fccf(0x124)]['id_transaction']];else var _0x294866=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1d6)]],_0x3e5411=[..._0x1b3072['body'][_0x18fccf(0x123)]],_0x23785c=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x188)]],_0xa772b3=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x131)]],_0x103689=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x183)]],_0x2fde34=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x112)]],_0x1235d2=[..._0x1b3072[_0x18fccf(0x124)]['secondary_code']],_0x519095=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x190)]],_0x172107=[..._0x1b3072['body']['MaxStocks_data2']],_0x47287a=[..._0x1b3072['body']['primary_unit']],_0x33b5f0=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1d2)]],_0x16a391=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1cf)]],_0x214df8=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x12d)]],_0x20a71b=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x1b0)]],_0x7ba893=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x146)]],_0x415a4e=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x133)]],_0xa3e43=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x178)]],_0x30bdb5=[..._0x1b3072['body']['RoomAssigned']],_0x4a75ff=[..._0x1b3072[_0x18fccf(0x124)]['ToRoomAssigned']],_0x40e8d3=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x106)]],_0x4381b1=[..._0x1b3072[_0x18fccf(0x124)][_0x18fccf(0x19c)]],_0x490772=[..._0x1b3072['body'][_0x18fccf(0x12f)]];const _0x65e97c=_0x294866[_0x18fccf(0x18d)](_0x42ef8e=>{return _0x42ef8e={'product_name':_0x42ef8e};});_0x3e5411[_0x18fccf(0x12a)]((_0x15b681,_0x3b7985)=>{var _0x18d650=_0x18fccf;_0x65e97c[_0x3b7985][_0x18d650(0x1b3)]=_0x15b681;}),_0x23785c[_0x18fccf(0x12a)]((_0x7d3dbf,_0x4661be)=>{var _0x188fd5=_0x18fccf;_0x65e97c[_0x4661be][_0x188fd5(0x15d)]=_0x7d3dbf;}),_0x490772['forEach']((_0x105271,_0xfbfe23)=>{var _0x755eb3=_0x18fccf;_0x65e97c[_0xfbfe23][_0x755eb3(0x12f)]=_0x105271;}),_0x40e8d3[_0x18fccf(0x12a)]((_0x4e98eb,_0x345e32)=>{var _0xf285f1=_0x18fccf;_0x65e97c[_0x345e32][_0xf285f1(0x106)]=_0x4e98eb;}),_0x4381b1[_0x18fccf(0x12a)]((_0x1e57b1,_0x435727)=>{var _0xb9d8bd=_0x18fccf;_0x65e97c[_0x435727][_0xb9d8bd(0x1da)]=_0x1e57b1;}),_0xa772b3[_0x18fccf(0x12a)]((_0x2ce938,_0x2b6a67)=>{var _0x353270=_0x18fccf;_0x65e97c[_0x2b6a67][_0x353270(0x10d)]=_0x2ce938;}),_0x103689[_0x18fccf(0x12a)]((_0x5e0909,_0x5a567c)=>{_0x65e97c[_0x5a567c]['to_bay']=_0x5e0909;}),_0x2fde34[_0x18fccf(0x12a)]((_0x3ee9d8,_0x4ca9ff)=>{_0x65e97c[_0x4ca9ff]['primary_code']=_0x3ee9d8;}),_0x1235d2[_0x18fccf(0x12a)]((_0x223c7b,_0x44657f)=>{var _0x23c467=_0x18fccf;_0x65e97c[_0x44657f][_0x23c467(0x1dc)]=_0x223c7b;}),_0x519095[_0x18fccf(0x12a)]((_0x2ab1f2,_0x4b67b0)=>{var _0x575442=_0x18fccf;_0x65e97c[_0x4b67b0][_0x575442(0x1a9)]=_0x2ab1f2;}),_0x172107[_0x18fccf(0x12a)]((_0x191e65,_0x5da5ce)=>{var _0x20f99f=_0x18fccf;_0x65e97c[_0x5da5ce][_0x20f99f(0x19b)]=_0x191e65;}),_0x47287a[_0x18fccf(0x12a)]((_0x3fda57,_0x3497b2)=>{var _0x1bcecd=_0x18fccf;_0x65e97c[_0x3497b2][_0x1bcecd(0x19e)]=_0x3fda57;}),_0x33b5f0[_0x18fccf(0x12a)]((_0x583c88,_0x28d815)=>{var _0x3adfd9=_0x18fccf;_0x65e97c[_0x28d815][_0x3adfd9(0x1d2)]=_0x583c88;}),_0x16a391[_0x18fccf(0x12a)]((_0x52cce2,_0x7ebb8e)=>{var _0x3eec93=_0x18fccf;_0x65e97c[_0x7ebb8e][_0x3eec93(0x1cf)]=_0x52cce2;}),_0x214df8[_0x18fccf(0x12a)]((_0x537d85,_0x6ac20a)=>{var _0x228b34=_0x18fccf;_0x65e97c[_0x6ac20a][_0x228b34(0x12d)]=_0x537d85;}),_0x20a71b[_0x18fccf(0x12a)]((_0x500fb3,_0x5300b1)=>{var _0x38623e=_0x18fccf;_0x65e97c[_0x5300b1][_0x38623e(0x1a7)]=_0x500fb3;}),_0x7ba893['forEach']((_0x437f9e,_0xd76193)=>{var _0x515d62=_0x18fccf;_0x65e97c[_0xd76193][_0x515d62(0x19b)]=_0x437f9e;}),_0x415a4e[_0x18fccf(0x12a)]((_0x353340,_0x572c8c)=>{_0x65e97c[_0x572c8c]['maxPerUnit']=_0x353340;}),_0xa3e43[_0x18fccf(0x12a)]((_0x40bf3a,_0x187459)=>{var _0x513101=_0x18fccf;_0x65e97c[_0x187459][_0x513101(0x178)]=_0x40bf3a;}),_0x30bdb5[_0x18fccf(0x12a)]((_0x1a1e44,_0x357d98)=>{var _0x390d69=_0x18fccf;_0x65e97c[_0x357d98][_0x390d69(0x1aa)]=_0x1a1e44;}),_0x4a75ff[_0x18fccf(0x12a)]((_0x1faafd,_0x40a145)=>{var _0x20cf60=_0x18fccf;_0x65e97c[_0x40a145][_0x20cf60(0x1cd)]=_0x1faafd;});const _0x2f0186=_0x65e97c[_0x18fccf(0x1de)](_0x4f937c=>_0x4f937c[_0x18fccf(0x10d)]!=='0'&&_0x4f937c['to_quantity']!==''||_0x4f937c[_0x18fccf(0x191)]!=='0'&&_0x4f937c[_0x18fccf(0x191)]!=='');var _0x4f4722=0x0;_0x2f0186[_0x18fccf(0x12a)](_0x580723=>{var _0x1400fa=_0x18fccf;parseInt(_0x580723[_0x1400fa(0x1b3)])<parseInt(_0x580723[_0x1400fa(0x10d)])&&_0x4f4722++;});if(_0x4f4722!=0x0)return _0x1b3072[_0x18fccf(0x1b8)](_0x18fccf(0x157),_0x18fccf(0x1b7)),_0x1fe8af['redirect'](_0x18fccf(0x138));const _0x2c33bc=new transfers_finished({'date':_0x1c9422,'from_warehouse':_0x5b3182,'to_warehouse':_0x1aa7ea,'product':_0x2f0186,'note':_0x5c4f7b,'invoice':_0x4f0f4d}),_0x4ebc55=await _0x2c33bc[_0x18fccf(0x104)]();_0x1b3072[_0x18fccf(0x1b8)](_0x18fccf(0x107),_0x18fccf(0x171)),_0x1fe8af[_0x18fccf(0x132)](_0x18fccf(0x1c0)+_0x4ebc55[_0x18fccf(0x1b9)]);}catch(_0x112580){console[_0x18fccf(0x11b)](_0x112580),_0x1fe8af[_0x18fccf(0x1c3)](0xc8)['json']({'errorMessage':_0x112580['message']});}}),router[a0_0xf0084f(0x13a)](a0_0xf0084f(0x1ce),auth,async(_0x361a7d,_0x4cf26e)=>{var _0x23980a=a0_0xf0084f;try{const {username:_0x1885d2,email:_0x5274d4,role:_0x195ea1}=_0x361a7d[_0x23980a(0x115)],_0x1d4856=_0x361a7d[_0x23980a(0x115)],_0x274ce1=await profile[_0x23980a(0x125)]({'email':_0x1d4856[_0x23980a(0x14e)]}),_0x363746=await master_shop[_0x23980a(0x16c)](),_0x519772=await transfers_finished['findById'](_0x361a7d[_0x23980a(0x197)]['id']);let _0x306461;if(_0x1d4856[_0x23980a(0x14c)]==_0x23980a(0x103)){const _0x413a1b=await staff[_0x23980a(0x125)]({'email':_0x1d4856['email']});_0x306461=await warehouse[_0x23980a(0x16c)]({'status':_0x23980a(0x198),'name':_0x413a1b['warehouse'],'warehouse_category':_0x23980a(0x15b)});}else _0x306461=await warehouse['find']({'status':_0x23980a(0x198),'warehouse_category':'Finished\x20Goods'});const _0x4acfad=await warehouse[_0x23980a(0x182)]([{'$match':{'name':_0x519772[_0x23980a(0x196)],'warehouse_category':_0x23980a(0x15b)}},{'$unwind':_0x23980a(0x105)},{'$group':{'_id':_0x23980a(0x148),'name':{'$first':_0x23980a(0x129)},'product_stock':{'$first':_0x23980a(0x122)},'bay':{'$first':_0x23980a(0x1d4)},'bin':{'$first':_0x23980a(0x1af)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x23980a(0x1bc)},'primary_code':{'$first':_0x23980a(0x1a5)},'secondary_code':{'$first':_0x23980a(0x16a)},'product_code':{'$first':_0x23980a(0x11e)},'storage':{'$first':_0x23980a(0x1b6)},'rack':{'$first':_0x23980a(0x16f)},'expiry_date':{'$first':_0x23980a(0x140)},'production_date':{'$first':_0x23980a(0x1dd)},'room':{'$first':_0x23980a(0x18b)},'warehoue_name':{'$first':'$name'}}}]),_0xa7cd7b=await product['find']({});if(_0x363746[0x0][_0x23980a(0x1a1)]=='English\x20(US)'){var _0x19d540=users['English'];console['log'](_0x19d540);}else{if(_0x363746[0x0][_0x23980a(0x1a1)]==_0x23980a(0x15a))var _0x19d540=users[_0x23980a(0x15a)];else{if(_0x363746[0x0][_0x23980a(0x1a1)]=='German')var _0x19d540=users[_0x23980a(0x1b2)];else{if(_0x363746[0x0][_0x23980a(0x1a1)]==_0x23980a(0x189))var _0x19d540=users[_0x23980a(0x189)];else{if(_0x363746[0x0][_0x23980a(0x1a1)]=='French')var _0x19d540=users[_0x23980a(0x143)];else{if(_0x363746[0x0][_0x23980a(0x1a1)]==_0x23980a(0x149))var _0x19d540=users[_0x23980a(0x1c2)];else{if(_0x363746[0x0]['language']==_0x23980a(0x159))var _0x19d540=users[_0x23980a(0x159)];else{if(_0x363746[0x0][_0x23980a(0x1a1)]==_0x23980a(0x11f))var _0x19d540=users['Arabic'];}}}}}}}_0x4cf26e['render'](_0x23980a(0x12e),{'success':_0x361a7d[_0x23980a(0x1b8)](_0x23980a(0x107)),'errors':_0x361a7d[_0x23980a(0x1b8)]('errors'),'role':_0x1d4856,'profile':_0x274ce1,'master_shop':_0x363746,'warehouse':_0x306461,'transfer':_0x519772,'stock':_0x4acfad,'unit':_0xa7cd7b,'language':_0x19d540});}catch(_0x1bf070){console[_0x23980a(0x11b)](_0x1bf070);}}),router['post']('/preview/:id',auth,async(_0x47cde6,_0x25c4e5)=>{var _0x480705=a0_0xf0084f;try{const {invoice:_0x2d3d6f,from_warehouse:_0x1590c0,FromRoom_name:_0x2d4856,to_warehouse:_0x4a6426,ToRoom_name:_0x29e750}=_0x47cde6[_0x480705(0x124)],_0x4fdabd=await transfers_finished[_0x480705(0x11d)](_0x47cde6[_0x480705(0x197)]['id']),_0x138d39=_0x4fdabd['product'][_0x480705(0x18d)](async _0xeda880=>{var _0x44cce3=_0x480705;if(_0xeda880[_0x44cce3(0x10d)]>0x0){var _0x99b2e3=await warehouse[_0x44cce3(0x125)]({'name':_0x1590c0,'room':_0xeda880[_0x44cce3(0x1aa)],'warehouse_category':_0x44cce3(0x15b)});const _0x107f53=_0x99b2e3['product_details'][_0x44cce3(0x18d)](_0x582b70=>{var _0xeb6245=_0x44cce3;_0x582b70['product_name']==_0xeda880['product_name']&&_0x582b70[_0xeb6245(0x117)]==_0xeda880[_0xeb6245(0x15d)]&&_0x582b70[_0xeb6245(0x12d)]==_0xeda880['expiry_date']&&_0x582b70['production_date']==_0xeda880['production_date']&&_0x582b70['batch_code']==_0xeda880[_0xeb6245(0x1cf)]&&_0x582b70[_0xeb6245(0x1a8)]==_0xeda880[_0xeb6245(0x106)]&&(console[_0xeb6245(0x11b)](_0xeb6245(0x130),_0x582b70['product_stock']),typeof _0xeda880[_0xeb6245(0x12f)]==_0xeb6245(0x17d)?_0x582b70[_0xeb6245(0x109)]=Math[_0xeb6245(0x154)](0x0,Math[_0xeb6245(0x1b1)](_0x582b70['product_stock'])-Math['abs'](_0xeda880[_0xeb6245(0x10d)])):_0x582b70['product_stock']=Math[_0xeb6245(0x154)](0x0,Math[_0xeb6245(0x1b1)](_0x582b70['product_stock'])-Math[_0xeb6245(0x1b1)](_0xeda880[_0xeb6245(0x10d)])));});}return _0x99b2e3;});Promise['all'](_0x138d39)[_0x480705(0x120)](async _0x4a9347=>{var _0x28c26e=_0x480705;try{for(const _0x2794ff of _0x4a9347){await _0x2794ff['save']();}const _0x3f03ee=_0x4fdabd[_0x28c26e(0x1ca)][_0x28c26e(0x18d)](async _0x240075=>{var _0x2ca7c5=_0x28c26e,_0x4dc217=await warehouse[_0x2ca7c5(0x125)]({'name':_0x4a6426,'room':_0x240075['to_room_name']});if(_0x240075[_0x2ca7c5(0x10d)]>0x0){var _0x430fa5=0x0;const _0x1d89b0=_0x4dc217[_0x2ca7c5(0x177)][_0x2ca7c5(0x18d)](_0x2a4986=>{var _0x1f6d40=_0x2ca7c5;_0x2a4986[_0x1f6d40(0x1d3)]==_0x240075[_0x1f6d40(0x1d3)]&&_0x2a4986[_0x1f6d40(0x117)]==_0x240075[_0x1f6d40(0x1cc)]&&_0x2a4986[_0x1f6d40(0x12d)]==_0x240075[_0x1f6d40(0x12d)]&&_0x2a4986[_0x1f6d40(0x1a7)]==_0x240075[_0x1f6d40(0x1a7)]&&_0x2a4986[_0x1f6d40(0x1cf)]==_0x240075['batch_code']&&_0x2a4986[_0x1f6d40(0x1a8)]==_0x240075[_0x1f6d40(0x1da)]&&(typeof _0x240075['id_transaction']==_0x1f6d40(0x17d)?(console['log'](_0x1f6d40(0x19d),_0x2a4986[_0x1f6d40(0x109)]+_0x1f6d40(0x108)+_0x2a4986[_0x1f6d40(0x1b9)]+'\x20<=>\x20'+Math[_0x1f6d40(0x1b1)](_0x2a4986[_0x1f6d40(0x109)])+Math[_0x1f6d40(0x1b1)](_0x240075[_0x1f6d40(0x10d)])),_0x2a4986[_0x1f6d40(0x109)]=Math[_0x1f6d40(0x1b1)](_0x2a4986['product_stock'])+Math[_0x1f6d40(0x1b1)](_0x240075['to_quantity'])):_0x2a4986[_0x1f6d40(0x109)]=Math[_0x1f6d40(0x1b1)](_0x2a4986[_0x1f6d40(0x109)])+Math[_0x1f6d40(0x1b1)](_0x240075[_0x1f6d40(0x10d)]),_0x430fa5++);});_0x430fa5=='0'&&(_0x4dc217['product_details']=_0x4dc217['product_details'][_0x2ca7c5(0x18c)]({'product_name':_0x240075[_0x2ca7c5(0x1d3)],'product_stock':_0x240075['to_quantity'],'bay':_0x240075[_0x2ca7c5(0x1cc)],'product_code':_0x240075[_0x2ca7c5(0x1a9)],'primary_code':_0x240075[_0x2ca7c5(0x112)],'secondary_code':_0x240075[_0x2ca7c5(0x1dc)],'expiry_date':_0x240075[_0x2ca7c5(0x12d)],'production_date':_0x240075[_0x2ca7c5(0x1a7)],'maxProducts':_0x240075[_0x2ca7c5(0x19b)],'batch_code':_0x240075[_0x2ca7c5(0x1cf)],'secondary_unit':_0x240075[_0x2ca7c5(0x1d2)],'unit':_0x240075[_0x2ca7c5(0x19e)],'maxProducts':_0x240075[_0x2ca7c5(0x19b)],'maxPerUnit':_0x240075[_0x2ca7c5(0x133)],'invoice':_0x240075[_0x2ca7c5(0x1da)]}));}return _0x4dc217;});Promise[_0x28c26e(0x127)](_0x3f03ee)[_0x28c26e(0x120)](async _0x74c484=>{var _0x568c69=_0x28c26e;try{for(const _0x582080 of _0x74c484){await warehouse[_0x568c69(0x16e)]({'_id':_0x582080[_0x568c69(0x1b9)]},{'$addToSet':{'product_details':{'$each':_0x582080[_0x568c69(0x177)]}}});}_0x4fdabd['finalize']=_0x568c69(0x195);const _0x4fa4e8=await _0x4fdabd[_0x568c69(0x104)](),_0x1d3bc5=await master_shop[_0x568c69(0x16c)](),_0x38aa57=await email_settings['findOne'](),_0x19a6e4=await supervisor_settings[_0x568c69(0x16c)]();var _0x592681=_0x4fdabd[_0x568c69(0x1ca)],_0xc47d6d='',_0x53febd;for(_0x53febd in _0x592681){var _0x5a81c9='FG';_0x4fdabd[_0x568c69(0x128)]=='DRY\x20GOODS'&&(_0x5a81c9='DG'),_0xc47d6d+='<tr>'+_0x568c69(0x1bd)+_0x592681[_0x53febd][_0x568c69(0x1d3)]+_0x568c69(0x14f)+_0x568c69(0x1bd)+_0x592681[_0x53febd][_0x568c69(0x1a9)]+_0x568c69(0x14f)+_0x568c69(0x1bd)+_0x592681[_0x53febd][_0x568c69(0x10d)]+_0x568c69(0x14f)+_0x568c69(0x1bd)+_0x592681[_0x53febd]['unit']+_0x568c69(0x14f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x592681[_0x53febd][_0x568c69(0x1d2)]+'</td>'+_0x568c69(0x1bd)+_0x4fdabd[_0x568c69(0x128)]+_0x568c69(0x14f)+_0x568c69(0x1bd)+_0x592681[_0x53febd][_0x568c69(0x1cd)]+_0x568c69(0x14f)+_0x568c69(0x1bd)+_0x5a81c9+_0x592681[_0x53febd][_0x568c69(0x1cc)]+_0x568c69(0x14f)+_0x568c69(0x173);}let _0x32c575=nodemailer['createTransport']({'host':_0x38aa57['host'],'port':Number(_0x38aa57['port']),'secure':![],'auth':{'user':_0x38aa57[_0x568c69(0x14e)],'pass':_0x38aa57[_0x568c69(0x1ab)]}}),_0x54945b={'from':_0x38aa57[_0x568c69(0x14e)],'to':_0x19a6e4[0x0][_0x568c69(0x1b5)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x568c69(0x1ac),'path':__dirname+'/../public'+'/upload/'+_0x1d3bc5[0x0][_0x568c69(0x1c8)],'cid':_0x568c69(0x164)}],'html':_0x568c69(0x12c)+_0x568c69(0x1b4)+'</head><body>'+'<div>'+_0x568c69(0x139)+'<div>'+_0x568c69(0x17b)+_0x568c69(0x119)+_0x568c69(0x141)+_0x568c69(0x1a0)+_0x1d3bc5[0x0][_0x568c69(0x113)]+_0x568c69(0x145)+_0x568c69(0x119)+_0x568c69(0x119)+'<hr\x20class=\x22my-3\x22>'+_0x568c69(0x141)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x568c69(0x1d0)+_0x4fdabd[_0x568c69(0x1a8)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x4fdabd[_0x568c69(0x1df)]+'\x20'+_0x568c69(0x111)+'</h5>'+'</div>'+_0x568c69(0x114)+_0x568c69(0x152)+'<tr>'+_0x568c69(0x10f)+_0x568c69(0x170)+_0x568c69(0x175)+_0x568c69(0x11c)+_0x568c69(0x1d9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x568c69(0x137)+'</tr>'+_0x568c69(0x13b)+_0x568c69(0x13c)+'\x20'+_0xc47d6d+'\x20'+_0x568c69(0x10c)+_0x568c69(0x160)+_0x568c69(0x141)+'<strong>\x20Regards\x20</strong>'+_0x568c69(0x16b)+_0x1d3bc5[0x0][_0x568c69(0x113)]+'</h5>'+_0x568c69(0x119)+_0x568c69(0x119)+_0x568c69(0x10e)};_0x32c575[_0x568c69(0x1cb)](_0x54945b,function(_0x1f44c0,_0x1d1610){var _0x562d55=_0x568c69;_0x1f44c0?(console[_0x562d55(0x11b)](_0x1f44c0),console[_0x562d55(0x11b)]('Error\x20Occurs')):console[_0x562d55(0x11b)]('Email\x20sent\x20successfully');}),_0x47cde6['flash'](_0x568c69(0x107),_0x568c69(0x14d)),_0x25c4e5[_0x568c69(0x132)]('/picking_list/PDF_transfer/'+_0x4fa4e8[_0x568c69(0x1b9)]);}catch(_0x2f00e2){console[_0x568c69(0x19f)](_0x2f00e2),_0x25c4e5[_0x568c69(0x1c3)](0x1f4)['json']({'error':_0x568c69(0x13d)});}})[_0x28c26e(0x172)](_0x5a52eb=>{var _0x55c389=_0x28c26e;console[_0x55c389(0x19f)](_0x5a52eb),_0x25c4e5[_0x55c389(0x1c3)](0x1f4)[_0x55c389(0x180)]({'error':_0x55c389(0x136)});});}catch(_0xf9f003){console[_0x28c26e(0x19f)](_0xf9f003),_0x25c4e5[_0x28c26e(0x1c3)](0x1f4)[_0x28c26e(0x180)]({'error':_0x28c26e(0x151)});}})['catch'](_0x60de89=>{var _0x503d4a=_0x480705;console['error'](_0x60de89),_0x25c4e5[_0x503d4a(0x1c3)](0x1f4)['json']({'error':_0x503d4a(0x136)});});}catch(_0x25125b){_0x25c4e5['json']({'message':_0x25125b[_0x480705(0x1c5)]});}});function BayBinSelected(_0x30e26c,_0x23044d){var _0x4c185d=a0_0xf0084f,_0x57504d=[];let _0x58974d=[];var _0x317eb3=[];if(_0x30e26c=='DRY\x20GOODS'){switch(_0x23044d){case _0x4c185d(0x153):_0x57504d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x57504d=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x317eb3=['DG'];}else{if(_0x30e26c=='FROZEN\x20GOODS'){switch(_0x23044d){case _0x4c185d(0x153):_0x57504d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x57504d=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x317eb3=['FG'];}}return{'levels':_0x57504d,'identify':_0x317eb3};}router[a0_0xf0084f(0x13a)]('/view/:id',auth,async(_0x34ccfb,_0x365191)=>{var _0x2cecde=a0_0xf0084f;try{const {username:_0x239699,email:_0x487da8,role:_0x410723}=_0x34ccfb[_0x2cecde(0x115)],_0x270e30=_0x34ccfb[_0x2cecde(0x115)],_0x25e56c=await profile[_0x2cecde(0x125)]({'email':_0x270e30[_0x2cecde(0x14e)]}),_0x37b084=await master_shop[_0x2cecde(0x16c)](),_0x9e773=await transfers_finished['findById'](_0x34ccfb[_0x2cecde(0x197)]['id']);let _0x58e31d=new Date(_0x9e773[_0x2cecde(0x12d)]),_0x30d9d8=('0'+_0x58e31d[_0x2cecde(0x166)]())[_0x2cecde(0x1ae)](-0x2),_0x57ae9d=('0'+(_0x58e31d['getMonth']()+0x1))['slice'](-0x2),_0x3728a9=_0x58e31d['getFullYear'](),_0x413a07=_0x3728a9+'-'+_0x57ae9d+'-'+_0x30d9d8,_0x48e799;if(_0x270e30[_0x2cecde(0x14c)]=='staff'){const _0x49a117=await staff[_0x2cecde(0x125)]({'email':_0x270e30[_0x2cecde(0x14e)]});_0x48e799=await warehouse[_0x2cecde(0x16c)]({'status':'Enabled','name':_0x49a117[_0x2cecde(0x165)],'warehouse_category':_0x2cecde(0x15b)});}else _0x48e799=await warehouse[_0x2cecde(0x16c)]({'status':_0x2cecde(0x198),'warehouse_category':_0x2cecde(0x15b)});const _0x2c9785=await warehouse[_0x2cecde(0x182)]([{'$match':{'name':_0x9e773[_0x2cecde(0x196)],'room':_0x9e773[_0x2cecde(0x17e)]}},{'$unwind':_0x2cecde(0x105)},{'$group':{'_id':_0x2cecde(0x148),'name':{'$first':_0x2cecde(0x129)},'product_stock':{'$first':_0x2cecde(0x122)},'bay':{'$first':_0x2cecde(0x1d4)},'bin':{'$first':_0x2cecde(0x1af)},'type':{'$first':_0x2cecde(0x1d1)},'floorlevel':{'$first':_0x2cecde(0x1bc)},'primary_code':{'$first':_0x2cecde(0x1a5)},'secondary_code':{'$first':_0x2cecde(0x16a)},'product_code':{'$first':_0x2cecde(0x11e)},'storage':{'$first':_0x2cecde(0x1b6)},'rack':{'$first':_0x2cecde(0x16f)}}}]);var _0x3a5b71=[0x1,0x2,0x3,0x4],_0x13c64c=['A','B','C','D','E','F','G','H','I','J'],_0x5e9c74=[_0x2cecde(0x18e),_0x2cecde(0x1c7)];const _0x234793=await product[_0x2cecde(0x16c)]({}),_0x3d4835=BayBinSelected(_0x9e773[_0x2cecde(0x128)],_0x9e773[_0x2cecde(0x118)]);if(_0x37b084[0x0][_0x2cecde(0x1a1)]==_0x2cecde(0x167)){var _0x2c1e9a=users[_0x2cecde(0x1ba)];console[_0x2cecde(0x11b)](_0x2c1e9a);}else{if(_0x37b084[0x0][_0x2cecde(0x1a1)]==_0x2cecde(0x15a))var _0x2c1e9a=users[_0x2cecde(0x15a)];else{if(_0x37b084[0x0][_0x2cecde(0x1a1)]==_0x2cecde(0x1b2))var _0x2c1e9a=users[_0x2cecde(0x1b2)];else{if(_0x37b084[0x0]['language']==_0x2cecde(0x189))var _0x2c1e9a=users[_0x2cecde(0x189)];else{if(_0x37b084[0x0]['language']==_0x2cecde(0x143))var _0x2c1e9a=users[_0x2cecde(0x143)];else{if(_0x37b084[0x0]['language']==_0x2cecde(0x149))var _0x2c1e9a=users[_0x2cecde(0x1c2)];else{if(_0x37b084[0x0][_0x2cecde(0x1a1)]=='Chinese')var _0x2c1e9a=users[_0x2cecde(0x159)];else{if(_0x37b084[0x0][_0x2cecde(0x1a1)]==_0x2cecde(0x11f))var _0x2c1e9a=users['Arabic'];}}}}}}}_0x365191[_0x2cecde(0x179)](_0x2cecde(0x1bf),{'success':_0x34ccfb['flash'](_0x2cecde(0x107)),'errors':_0x34ccfb[_0x2cecde(0x1b8)](_0x2cecde(0x157)),'role':_0x270e30,'profile':_0x25e56c,'master_shop':_0x37b084,'warehouse':_0x48e799,'transfer':_0x9e773,'stock':_0x2c9785,'unit':_0x234793,'language':_0x2c1e9a,'levels':_0x3a5b71,'Isle':_0x13c64c,'rooms_data':_0x5e9c74,'ed_fullDate':_0x413a07,'dataSelected':_0x3d4835});}catch(_0xa84fd5){console[_0x2cecde(0x11b)](_0xa84fd5);}}),router['post'](a0_0xf0084f(0x1a3),auth,async(_0x4970e0,_0x4735e4)=>{var _0x3b847d=a0_0xf0084f;try{const _0xad854f=_0x4970e0[_0x3b847d(0x197)]['id'];console['log'](_0x4970e0[_0x3b847d(0x124)]);const _0x3b9e0e=await transfers_finished[_0x3b847d(0x11d)](_0xad854f);console['log'](_0x3b847d(0x162),_0x3b9e0e);const {date:_0x1c60cc,from_warehouse:_0x27767f,FromRoom_name:_0x5b23e0,to_warehouse:_0x1bd97f,ToRoom_name:_0x4ed4b9,prod_name:_0x565649,from_prod_qty:_0x4d6c1c,from_prod_level:_0x29d2bd,from_prod_isle:_0x18cfec,from_prod_pallet:_0x135a54,to_prod_qty:_0x25744a,to_prod_level:_0x154046,to_prod_isle:_0x13357f,to_prod_pallet:_0x5805dc,primary_code:_0x6a7ae0,secondary_code:_0x3b5ae4,product_code3:_0xef4813,note:_0x263c64,invoice:_0x5ed4f2,expiry_date:_0x32166b}=_0x4970e0[_0x3b847d(0x124)];if(typeof _0x565649=='string')var _0x280a30=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x1d6)]],_0x22815c=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x123)]],_0x585047=[_0x4970e0['body'][_0x3b847d(0x188)]],_0x2f929c=[_0x4970e0[_0x3b847d(0x124)]['to_prod_qty']],_0x550d34=[_0x4970e0['body'][_0x3b847d(0x183)]],_0x52a4e3=[_0x4970e0['body'][_0x3b847d(0x112)]],_0x31e987=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x1dc)]],_0x575904=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x190)]],_0x2a5f2e=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x187)]],_0x582c4a=[_0x4970e0['body'][_0x3b847d(0x19e)]],_0x2a3ae9=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x1d2)]],_0x40eae0=[_0x4970e0['body'][_0x3b847d(0x1cf)]],_0x1e6322=[_0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x12d)]];else var _0x280a30=[..._0x4970e0['body']['prod_name']],_0x22815c=[..._0x4970e0[_0x3b847d(0x124)]['from_prod_qty']],_0x585047=[..._0x4970e0[_0x3b847d(0x124)]['from_prod_level']],_0x2f929c=[..._0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x15e)]],_0x550d34=[..._0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x183)]],_0x52a4e3=[..._0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x112)]],_0x31e987=[..._0x4970e0[_0x3b847d(0x124)]['secondary_code']],_0x575904=[..._0x4970e0['body'][_0x3b847d(0x190)]],_0x2a5f2e=[..._0x4970e0['body']['MaxStocks_data2']],_0x582c4a=[..._0x4970e0[_0x3b847d(0x124)]['unit']],_0x2a3ae9=[..._0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x1d2)]],_0x40eae0=[..._0x4970e0['body'][_0x3b847d(0x1cf)]],_0x1e6322=[..._0x4970e0[_0x3b847d(0x124)][_0x3b847d(0x12d)]];const _0x17cc70=_0x280a30[_0x3b847d(0x18d)](_0x4914a5=>{return _0x4914a5={'product_name':_0x4914a5};});_0x22815c['forEach']((_0x24d9fd,_0x8e0e8f)=>{_0x17cc70[_0x8e0e8f]['from_quantity']=_0x24d9fd;}),_0x585047[_0x3b847d(0x12a)]((_0x2f15ea,_0x34303d)=>{var _0x3330e0=_0x3b847d;_0x17cc70[_0x34303d][_0x3330e0(0x15d)]=_0x2f15ea;}),_0x2f929c[_0x3b847d(0x12a)]((_0x234968,_0x3f8e17)=>{_0x17cc70[_0x3f8e17]['to_quantity']=_0x234968;}),_0x550d34[_0x3b847d(0x12a)]((_0x227afa,_0x20e709)=>{var _0x2a9243=_0x3b847d;_0x17cc70[_0x20e709][_0x2a9243(0x1cc)]=_0x227afa;}),_0x52a4e3[_0x3b847d(0x12a)]((_0x5b4c4f,_0x3bd785)=>{_0x17cc70[_0x3bd785]['primary_code']=_0x5b4c4f;}),_0x31e987[_0x3b847d(0x12a)]((_0x1d7341,_0x1669e6)=>{var _0xdc3206=_0x3b847d;_0x17cc70[_0x1669e6][_0xdc3206(0x1dc)]=_0x1d7341;}),_0x575904['forEach']((_0x863ad7,_0x530690)=>{var _0x40652d=_0x3b847d;_0x17cc70[_0x530690][_0x40652d(0x1a9)]=_0x863ad7;}),_0x2a5f2e[_0x3b847d(0x12a)]((_0xd83470,_0x516796)=>{var _0x44a505=_0x3b847d;_0x17cc70[_0x516796][_0x44a505(0x19b)]=_0xd83470;}),_0x582c4a[_0x3b847d(0x12a)]((_0x1e8bc7,_0x311471)=>{var _0x38125d=_0x3b847d;_0x17cc70[_0x311471][_0x38125d(0x19e)]=_0x1e8bc7;}),_0x2a3ae9[_0x3b847d(0x12a)]((_0x491e6b,_0x2fbf9d)=>{_0x17cc70[_0x2fbf9d]['secondary_unit']=_0x491e6b;}),_0x40eae0[_0x3b847d(0x12a)]((_0x20b2ce,_0x3ed37d)=>{var _0x2347c7=_0x3b847d;_0x17cc70[_0x3ed37d][_0x2347c7(0x1cf)]=_0x20b2ce;}),_0x1e6322[_0x3b847d(0x12a)]((_0x40c9a9,_0x58714a)=>{var _0x365f9b=_0x3b847d;_0x17cc70[_0x58714a][_0x365f9b(0x12d)]=_0x40c9a9;});const _0x1355c3=_0x17cc70[_0x3b847d(0x1de)](_0x1bbc4a=>_0x1bbc4a[_0x3b847d(0x10d)]!=='0'&&_0x1bbc4a[_0x3b847d(0x10d)]!==''||_0x1bbc4a[_0x3b847d(0x191)]!=='0'&&_0x1bbc4a[_0x3b847d(0x191)]!=='');var _0x35ff83=0x0;_0x1355c3[_0x3b847d(0x12a)](_0x11fb8d=>{var _0x2aa397=_0x3b847d;parseInt(_0x11fb8d[_0x2aa397(0x1b3)])<parseInt(_0x11fb8d[_0x2aa397(0x10d)])&&_0x35ff83++;});if(_0x35ff83!=0x0)return _0x4970e0[_0x3b847d(0x1b8)](_0x3b847d(0x157),_0x3b847d(0x1b7)),_0x4735e4[_0x3b847d(0x132)](_0x3b847d(0x138));const _0xcecc89=await warehouse[_0x3b847d(0x125)]({'name':_0x3b9e0e[_0x3b847d(0x196)],'room':_0x3b9e0e[_0x3b847d(0x17e)]});_0x3b9e0e[_0x3b847d(0x1ca)][_0x3b847d(0x12a)](_0x49b7b3=>{var _0x16bc3d=_0x3b847d;if(_0x49b7b3[_0x16bc3d(0x10d)]>0x0){const _0xba80f7=_0xcecc89[_0x16bc3d(0x177)][_0x16bc3d(0x18d)](_0xcb80df=>{var _0x3250bc=_0x16bc3d;_0xcb80df[_0x3250bc(0x1d3)]==_0x49b7b3[_0x3250bc(0x1d3)]&&_0xcb80df[_0x3250bc(0x117)]==_0x49b7b3[_0x3250bc(0x15d)]&&(_0xcb80df['product_stock']=parseInt(_0xcb80df[_0x3250bc(0x109)])+parseInt(_0x49b7b3[_0x3250bc(0x10d)]));});}}),await _0xcecc89[_0x3b847d(0x104)]();const _0x5a40f4=await warehouse['findOne']({'name':_0x3b9e0e[_0x3b847d(0x128)],'room':_0x3b9e0e[_0x3b847d(0x118)]});_0x3b9e0e['product']['forEach'](_0x5176a8=>{var _0x482770=_0x3b847d;if(_0x5176a8[_0x482770(0x10d)]>0x0){const _0x14ec82=_0x5a40f4['product_details'][_0x482770(0x18d)](_0x3c1bbd=>{var _0x2c4dac=_0x482770;_0x3c1bbd[_0x2c4dac(0x1d3)]==_0x5176a8[_0x2c4dac(0x1d3)]&&_0x3c1bbd[_0x2c4dac(0x117)]==_0x5176a8[_0x2c4dac(0x1cc)]&&(_0x3c1bbd[_0x2c4dac(0x109)]=parseInt(_0x3c1bbd[_0x2c4dac(0x109)])-parseInt(_0x5176a8[_0x2c4dac(0x10d)]));});}}),await _0x5a40f4[_0x3b847d(0x104)](),_0x3b9e0e[_0x3b847d(0x1df)]=_0x1c60cc,_0x3b9e0e[_0x3b847d(0x196)]=_0x27767f,_0x3b9e0e[_0x3b847d(0x128)]=_0x1bd97f,_0x3b9e0e['product']=_0x1355c3,_0x3b9e0e[_0x3b847d(0x110)]=_0x263c64,_0x3b9e0e['invoice']=_0x5ed4f2;const _0x110980=await _0x3b9e0e[_0x3b847d(0x104)](),_0x201054=await warehouse[_0x3b847d(0x125)]({'name':_0x27767f,'room':_0x5b23e0});_0x110980[_0x3b847d(0x1ca)][_0x3b847d(0x12a)](_0x134ae1=>{var _0x5337f5=_0x3b847d;if(_0x134ae1[_0x5337f5(0x10d)]>0x0){const _0xf8de07=_0x201054[_0x5337f5(0x177)][_0x5337f5(0x18d)](_0x57de87=>{var _0x1413e4=_0x5337f5;_0x57de87[_0x1413e4(0x1d3)]==_0x134ae1[_0x1413e4(0x1d3)]&&_0x57de87['bay']==_0x134ae1[_0x1413e4(0x15d)]&&(_0x57de87['product_stock']=parseInt(_0x57de87['product_stock'])-parseInt(_0x134ae1[_0x1413e4(0x10d)]));});}}),await _0x201054[_0x3b847d(0x104)]();const _0x34af83=await warehouse['findOne']({'name':_0x1bd97f,'room':_0x4ed4b9});_0x110980['product'][_0x3b847d(0x12a)](_0x5898a6=>{var _0x18f586=_0x3b847d;if(_0x5898a6['to_quantity']>0x0){var _0x2cad19=0x0;const _0x3d9ad1=_0x34af83[_0x18f586(0x177)]['map'](_0x55684b=>{var _0x2f639e=_0x18f586;_0x55684b[_0x2f639e(0x1d3)]==_0x5898a6[_0x2f639e(0x1d3)]&&_0x55684b[_0x2f639e(0x117)]==_0x5898a6[_0x2f639e(0x1cc)]&&(_0x55684b[_0x2f639e(0x109)]=parseInt(_0x55684b[_0x2f639e(0x109)])+parseInt(_0x5898a6['to_quantity']),_0x2cad19++);});_0x2cad19=='0'&&(_0x34af83[_0x18f586(0x177)]=_0x34af83[_0x18f586(0x177)][_0x18f586(0x18c)]({'product_name':_0x5898a6[_0x18f586(0x1d3)],'product_stock':_0x5898a6[_0x18f586(0x10d)],'bay':_0x5898a6[_0x18f586(0x1cc)],'product_code':_0x5898a6[_0x18f586(0x1a9)],'primary_code':_0x5898a6[_0x18f586(0x112)],'secondary_code':_0x5898a6[_0x18f586(0x1dc)],'maxProducts':_0x5898a6[_0x18f586(0x19b)]}));}}),await _0x34af83[_0x3b847d(0x104)](),_0x4970e0['flash'](_0x3b847d(0x107),_0x3b847d(0x150)),_0x4735e4[_0x3b847d(0x132)](_0x3b847d(0x142));}catch(_0x2db050){console[_0x3b847d(0x11b)](_0x2db050);}}),router[a0_0xf0084f(0x15c)](a0_0xf0084f(0x14b),async(_0x45de49,_0x170907)=>{var _0x3351b1=a0_0xf0084f;const {FromWareHouse:_0x19b58c,FromRoom:_0x5f0ff3,ToWarehouse:_0x1098ff,ToRoom:_0x248fff,primary_code:_0x1d2b8a,Roomslist:_0x13ecc7}=_0x45de49[_0x3351b1(0x124)],_0x5355d6=_0x13ecc7[_0x3351b1(0x19a)](','),_0x217738=[];async function _0x5b9bd0(_0xdd19ac){var _0xed8f3a=_0x3351b1;const _0x4d02e3=await warehouse[_0xed8f3a(0x182)]([{'$match':{'name':_0x19b58c,'room':_0xdd19ac}},{'$unwind':_0xed8f3a(0x105)},{'$match':{'product_details.primary_code':_0x1d2b8a}},{'$group':{'_id':_0xed8f3a(0x148),'name':{'$first':_0xed8f3a(0x129)},'instock':{'$first':_0xed8f3a(0x122)},'primary_code':{'$first':_0xed8f3a(0x1a5)},'secondary_code':{'$first':_0xed8f3a(0x16a)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xed8f3a(0x1d4)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xed8f3a(0x1bc)},'unit':{'$first':_0xed8f3a(0x168)},'secondary_unit':{'$first':_0xed8f3a(0x12b)},'storage':{'$first':_0xed8f3a(0x1b6)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xed8f3a(0x140)},'production_date':{'$first':_0xed8f3a(0x1dd)},'batch_code':{'$first':_0xed8f3a(0x10b)},'maxPerUnit':{'$first':_0xed8f3a(0x147)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0xed8f3a(0x1db)}}}]),_0xde20df=await warehouse[_0xed8f3a(0x182)]([{'$match':{'name':_0x19b58c,'room':_0xdd19ac}},{'$unwind':_0xed8f3a(0x105)},{'$match':{'product_details.secondary_code':_0x1d2b8a}},{'$group':{'_id':_0xed8f3a(0x148),'name':{'$first':_0xed8f3a(0x129)},'instock':{'$first':_0xed8f3a(0x122)},'primary_code':{'$first':_0xed8f3a(0x1a5)},'secondary_code':{'$first':_0xed8f3a(0x16a)},'product_code':{'$first':_0xed8f3a(0x11e)},'level':{'$first':_0xed8f3a(0x1d4)},'isle':{'$first':_0xed8f3a(0x1af)},'type':{'$first':_0xed8f3a(0x1d1)},'pallet':{'$first':_0xed8f3a(0x1bc)},'unit':{'$first':_0xed8f3a(0x168)},'secondary_unit':{'$first':_0xed8f3a(0x12b)},'storage':{'$first':_0xed8f3a(0x1b6)},'rack':{'$first':_0xed8f3a(0x16f)},'expiry_date':{'$first':_0xed8f3a(0x140)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0xed8f3a(0x10b)},'maxPerUnit':{'$first':_0xed8f3a(0x147)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0xed8f3a(0x1db)}}}]);if(_0x4d02e3['length']>0x0)_0x217738[_0xed8f3a(0x11a)](_0x4d02e3);else _0xde20df[_0xed8f3a(0x1c9)]>0x0&&_0x217738[_0xed8f3a(0x11a)](_0xde20df);}const _0x82115a=_0x5355d6[_0x3351b1(0x18d)](_0x105f71=>_0x5b9bd0(_0x105f71));await Promise[_0x3351b1(0x127)](_0x82115a),_0x170907[_0x3351b1(0x180)](_0x217738);}),router['post'](a0_0xf0084f(0x156),async(_0x1f85d0,_0x5d033f)=>{var _0x2b29c2=a0_0xf0084f;try{const {FromWareHouse:_0x42c18f,FromRoom:_0x1b3879,ToWarehouse:_0x9afe80,ToRoom:_0x113fc8,secondary_code:_0x560694}=_0x1f85d0['body'],_0xe6ac79=await warehouse[_0x2b29c2(0x182)]([{'$match':{'name':_0x42c18f}},{'$unwind':_0x2b29c2(0x105)},{'$match':{'product_details.secondary_code':_0x560694}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2b29c2(0x129)},'primary_code':{'$first':_0x2b29c2(0x1a5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2b29c2(0x11e)},'instock':{'$first':_0x2b29c2(0x122)},'warehouse':{'$first':_0x2b29c2(0x1a4)},'level':{'$first':_0x2b29c2(0x181)},'isle':{'$first':_0x2b29c2(0x1c4)},'pallet':{'$first':_0x2b29c2(0x13f)},'maxProducts':{'$first':_0x2b29c2(0x16d)},'unit':{'$first':_0x2b29c2(0x168)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'}}}]);_0x5d033f[_0x2b29c2(0x1c3)](0xc8)['json'](_0xe6ac79);}catch(_0x4b63c9){_0x5d033f[_0x2b29c2(0x1c3)](0x194)[_0x2b29c2(0x180)]({'message':_0x4b63c9['message']});}}),router[a0_0xf0084f(0x15c)](a0_0xf0084f(0x192),async(_0x320c8f,_0x58d294)=>{var _0x134f23=a0_0xf0084f;try{const {FromWareHouse:_0x291916,FromRoom:_0x54937a,ToWarehouse:_0x3d9074,ToRoom:_0x491548,product_code:_0x1ce50c}=_0x320c8f[_0x134f23(0x124)],_0x4f8ced=await warehouse[_0x134f23(0x182)]([{'$match':{'name':_0x291916}},{'$unwind':_0x134f23(0x105)},{'$match':{'product_details.product_code':_0x1ce50c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x134f23(0x129)},'primary_code':{'$first':_0x134f23(0x1a5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x134f23(0x11e)},'instock':{'$first':_0x134f23(0x122)},'warehouse':{'$first':'$name'},'level':{'$first':_0x134f23(0x181)},'isle':{'$first':_0x134f23(0x1c4)},'pallet':{'$first':_0x134f23(0x13f)},'maxProducts':{'$first':_0x134f23(0x16d)},'unit':{'$first':_0x134f23(0x168)}}}]);_0x58d294[_0x134f23(0x1c3)](0xc8)[_0x134f23(0x180)](_0x4f8ced);}catch(_0x2a1367){_0x58d294[_0x134f23(0x1c3)](0x194)[_0x134f23(0x180)]({'message':_0x2a1367['message']});}}),router[a0_0xf0084f(0x15c)](a0_0xf0084f(0x126),async(_0x5d16d1,_0x54bdbc)=>{var _0x2db619=a0_0xf0084f;const {productCode:_0x1604fc,bay:_0x581279,warehouses:_0x32be9f,room:_0x36e56d}=_0x5d16d1[_0x2db619(0x124)];console['log'](_0x5d16d1[_0x2db619(0x124)]);try{const _0x32c05a=await warehouse[_0x2db619(0x182)]([{'$match':{'name':_0x32be9f,'room':_0x36e56d}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x581279)}},{'$group':{'_id':_0x2db619(0x148),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2db619(0x122)},'bay':{'$first':_0x2db619(0x1d4)},'maxProducts':{'$first':_0x2db619(0x16d)}}}]);_0x54bdbc[_0x2db619(0x1c3)](0xc8)[_0x2db619(0x180)](_0x32c05a);}catch(_0x42aba5){_0x54bdbc['status'](0x194)[_0x2db619(0x180)]({'message':_0x42aba5[_0x2db619(0x1c5)]});}}),module[a0_0xf0084f(0x184)]=router;