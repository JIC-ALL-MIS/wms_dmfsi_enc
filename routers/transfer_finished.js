function a0_0x1171(_0x4b6588,_0x3a4c94){var _0x2e5dd9=a0_0x2e5d();return a0_0x1171=function(_0x117190,_0xa23d5c){_0x117190=_0x117190-0x123;var _0x35975a=_0x2e5dd9[_0x117190];return _0x35975a;},a0_0x1171(_0x4b6588,_0x3a4c94);}var a0_0x440762=a0_0x1171;(function(_0x2358d6,_0x545a85){var _0x1b60ea=a0_0x1171,_0x5342b6=_0x2358d6();while(!![]){try{var _0x8c76f8=parseInt(_0x1b60ea(0x174))/0x1+-parseInt(_0x1b60ea(0x13e))/0x2+-parseInt(_0x1b60ea(0x12d))/0x3*(-parseInt(_0x1b60ea(0x194))/0x4)+-parseInt(_0x1b60ea(0x15c))/0x5+-parseInt(_0x1b60ea(0x1fe))/0x6*(-parseInt(_0x1b60ea(0x1a0))/0x7)+-parseInt(_0x1b60ea(0x1d5))/0x8+parseInt(_0x1b60ea(0x1ad))/0x9*(-parseInt(_0x1b60ea(0x1b9))/0xa);if(_0x8c76f8===_0x545a85)break;else _0x5342b6['push'](_0x5342b6['shift']());}catch(_0x38c875){_0x5342b6['push'](_0x5342b6['shift']());}}}(a0_0x2e5d,0x896fa));const express=require(a0_0x440762(0x154)),app=express(),router=express[a0_0x440762(0x17a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x440762(0x125)),auth=require(a0_0x440762(0x1a8)),users=require(a0_0x440762(0x12a)),nodemailer=require('nodemailer');router[a0_0x440762(0x18e)]('/view',auth,async(_0x89cb58,_0x2a0d0b)=>{var _0x59b96f=a0_0x440762;try{const {username:_0x516d4f,email:_0x53ed4b,role:_0x482092}=_0x89cb58['user'],_0x22bc4d=_0x89cb58[_0x59b96f(0x132)],_0x30dc45=await profile[_0x59b96f(0x1ee)]({'email':_0x22bc4d[_0x59b96f(0x1a1)]}),_0x21b7ae=await master_shop[_0x59b96f(0x16b)]();let _0x223c7f;if(_0x22bc4d['role']=='staff'){const _0x191163=await staff[_0x59b96f(0x1ee)]({'email':_0x22bc4d[_0x59b96f(0x1a1)]});_0x223c7f=await transfers_finished[_0x59b96f(0x16b)]({'from_warehouse':_0x191163[_0x59b96f(0x1ab)]});}else _0x223c7f=await transfers_finished[_0x59b96f(0x15a)]([{'$unwind':'$product'},{'$group':{'_id':_0x59b96f(0x17d),'invoice':{'$first':'$invoice'},'date':{'$first':_0x59b96f(0x1ba)},'from_warehouse':{'$first':_0x59b96f(0x1f5)},'to_warehouse':{'$first':_0x59b96f(0x198)},'from_room_name':{'$addToSet':_0x59b96f(0x1e4)},'to_room_name':{'$addToSet':_0x59b96f(0x1a9)},'finalize':{'$first':_0x59b96f(0x1de)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x21b7ae[0x0]['language']==_0x59b96f(0x1e0))var _0x3c6cdc=users[_0x59b96f(0x157)];else{if(_0x21b7ae[0x0]['language']==_0x59b96f(0x19c))var _0x3c6cdc=users[_0x59b96f(0x19c)];else{if(_0x21b7ae[0x0][_0x59b96f(0x1a5)]==_0x59b96f(0x1ce))var _0x3c6cdc=users[_0x59b96f(0x1ce)];else{if(_0x21b7ae[0x0][_0x59b96f(0x1a5)]==_0x59b96f(0x1cf))var _0x3c6cdc=users[_0x59b96f(0x1cf)];else{if(_0x21b7ae[0x0]['language']=='French')var _0x3c6cdc=users['French'];else{if(_0x21b7ae[0x0]['language']==_0x59b96f(0x1ac))var _0x3c6cdc=users[_0x59b96f(0x137)];else{if(_0x21b7ae[0x0][_0x59b96f(0x1a5)]==_0x59b96f(0x16a))var _0x3c6cdc=users[_0x59b96f(0x16a)];else{if(_0x21b7ae[0x0][_0x59b96f(0x1a5)]==_0x59b96f(0x186))var _0x3c6cdc=users[_0x59b96f(0x190)];}}}}}}}_0x2a0d0b[_0x59b96f(0x12e)](_0x59b96f(0x1bf),{'success':_0x89cb58[_0x59b96f(0x1c0)]('success'),'errors':_0x89cb58[_0x59b96f(0x1c0)](_0x59b96f(0x1d7)),'role':_0x22bc4d,'profile':_0x30dc45,'master_shop':_0x21b7ae,'transfer':_0x223c7f,'language':_0x3c6cdc});}catch(_0x15b755){console[_0x59b96f(0x19b)](_0x15b755);}});async function getRandom8DigitNumber(){var _0xf10f01=a0_0x440762;const _0x26c6fb=0x989680,_0x2d0520=0x5f5e0ff,_0x3b18ff=Math[_0xf10f01(0x1a6)](Math[_0xf10f01(0x1be)]()*(_0x2d0520-_0x26c6fb+0x1))+_0x26c6fb;var _0x4dcbde;const _0x167000=await transfers_finished[_0xf10f01(0x1ee)]({'invoice':_0xf10f01(0x145)+_0x3b18ff});return _0x167000&&_0x167000['length']>0x0?_0x4dcbde='TRFF-'+_0x3b18ff:_0x4dcbde=_0xf10f01(0x145)+_0x3b18ff,_0x4dcbde;}router[a0_0x440762(0x18e)]('/view/add_transfer',auth,async(_0x229247,_0x2259e6)=>{var _0x25e339=a0_0x440762;try{const {username:_0x2c92be,email:_0x56a364,role:_0x10203c}=_0x229247['user'],_0x4f2d2c=_0x229247['user'],_0x43c60f=await profile[_0x25e339(0x1ee)]({'email':_0x4f2d2c[_0x25e339(0x1a1)]}),_0x26a652=await master_shop[_0x25e339(0x16b)]();let _0x46ba41;if(_0x4f2d2c[_0x25e339(0x1dd)]==_0x25e339(0x15b)){const _0x5785af=await staff['findOne']({'email':_0x4f2d2c['email']});_0x46ba41=await warehouse[_0x25e339(0x15a)]([{'$match':{'status':'Enabled','name':_0x5785af['warehouse'],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x25e339(0x1a2),'name':{'$first':_0x25e339(0x1a2)}}}]);}else _0x46ba41=await warehouse['aggregate']([{'$match':{'status':_0x25e339(0x153),'warehouse_category':_0x25e339(0x15d),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x25e339(0x1a2),'name':{'$first':_0x25e339(0x1a2)}}}]);const _0x2a7ad2=await transfers_finished[_0x25e339(0x16b)]({}),_0x2a6d9a=_0x2a7ad2['length']+0x1,_0x1649dd=_0x25e339(0x145)+_0x2a6d9a[_0x25e339(0x136)]()[_0x25e339(0x1b4)](0x5,'0');if(_0x26a652[0x0]['language']==_0x25e339(0x1e0))var _0x169067=users[_0x25e339(0x157)];else{if(_0x26a652[0x0][_0x25e339(0x1a5)]=='Hindi')var _0x169067=users[_0x25e339(0x19c)];else{if(_0x26a652[0x0]['language']=='German')var _0x169067=users[_0x25e339(0x1ce)];else{if(_0x26a652[0x0][_0x25e339(0x1a5)]==_0x25e339(0x1cf))var _0x169067=users[_0x25e339(0x1cf)];else{if(_0x26a652[0x0][_0x25e339(0x1a5)]=='French')var _0x169067=users['French'];else{if(_0x26a652[0x0]['language']==_0x25e339(0x1ac))var _0x169067=users['Portuguese'];else{if(_0x26a652[0x0][_0x25e339(0x1a5)]=='Chinese')var _0x169067=users[_0x25e339(0x16a)];else{if(_0x26a652[0x0][_0x25e339(0x1a5)]==_0x25e339(0x186))var _0x169067=users['Arabic'];}}}}}}}const _0x1864b3=getRandom8DigitNumber();_0x1864b3[_0x25e339(0x1f0)](_0x16e164=>{var _0x3da304=_0x25e339;_0x2259e6[_0x3da304(0x12e)](_0x3da304(0x16d),{'success':_0x229247[_0x3da304(0x1c0)](_0x3da304(0x189)),'errors':_0x229247[_0x3da304(0x1c0)](_0x3da304(0x1d7)),'role':_0x4f2d2c,'profile':_0x43c60f,'master_shop':_0x26a652,'warehouse':_0x46ba41,'language':_0x169067,'invoice':_0x16e164});})[_0x25e339(0x1e6)](_0x1d279f=>{var _0x29a1d5=_0x25e339;_0x229247['flash'](_0x29a1d5(0x1d7),_0x29a1d5(0x165)),_0x2259e6[_0x29a1d5(0x1db)]('/transfer/view');});}catch(_0x547ba1){console['log'](_0x547ba1);}}),router['post']('/view/add_transfer',auth,async(_0x28e1c6,_0x309a23)=>{var _0x43bb2c=a0_0x440762;try{const {date:_0x418d71,from_warehouse:_0x2c8c10,FromRoom_name:_0x11d682,to_warehouse:_0xe33db5,ToRoom_name:_0xbedcf8,prod_name:_0x1b422e,from_prod_qty:_0x42e0d6,from_prod_level:_0x180521,from_prod_isle:_0x463e63,from_prod_pallet:_0x2b0600,to_prod_qty:_0x48f5e7,to_prod_level:_0x365903,to_prod_isle:_0x3c918a,to_prod_pallet:_0x4d3f25,primary_code:_0x593aea,secondary_code:_0x281ec9,product_code3:_0x2d7150,note:_0xb706de,MaxStocks_data2:_0x40c7a6,invoice:_0x52201e,expiry_date:_0x45b5b2}=_0x28e1c6[_0x43bb2c(0x131)];if(typeof _0x1b422e=='string')var _0x422a80=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1c3)]],_0x512221=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x192)]],_0x5e3c20=[_0x28e1c6[_0x43bb2c(0x131)]['from_prod_level']],_0x5b6751=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1b8)]],_0x3ebcc2=[_0x28e1c6[_0x43bb2c(0x131)]['to_prod_level']],_0x1de90a=[_0x28e1c6[_0x43bb2c(0x131)]['primary_code']],_0x322c50=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x172)]],_0x56caba=[_0x28e1c6[_0x43bb2c(0x131)]['product_code3']],_0x3836b2=[_0x28e1c6[_0x43bb2c(0x131)]['MaxStocks_data2']],_0x274706=[_0x28e1c6[_0x43bb2c(0x131)]['primary_unit']],_0x9f831b=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1b6)]],_0x5f0de9=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x17e)]],_0xdf49b=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1b7)]],_0x1d738e=[_0x28e1c6[_0x43bb2c(0x131)]['product_date']],_0x308907=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x148)]],_0x55b84c=[_0x28e1c6['body'][_0x43bb2c(0x141)]],_0x25de52=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x19a)]],_0x513b71=[_0x28e1c6['body'][_0x43bb2c(0x14a)]],_0x1e4aac=[_0x28e1c6[_0x43bb2c(0x131)]['ToRoomAssigned']],_0x20c60f=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1eb)]],_0x1ed852=[_0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1bd)]],_0x1cdb2a=[_0x28e1c6['body'][_0x43bb2c(0x14d)]];else var _0x422a80=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1c3)]],_0x512221=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x192)]],_0x5e3c20=[..._0x28e1c6[_0x43bb2c(0x131)]['from_prod_level']],_0x5b6751=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1b8)]],_0x3ebcc2=[..._0x28e1c6['body']['to_prod_level']],_0x1de90a=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1c2)]],_0x322c50=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x172)]],_0x56caba=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x177)]],_0x3836b2=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x13c)]],_0x274706=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x161)]],_0x9f831b=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x1b6)]],_0x5f0de9=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x17e)]],_0xdf49b=[..._0x28e1c6['body']['expiry_date']],_0x1d738e=[..._0x28e1c6[_0x43bb2c(0x131)]['product_date']],_0x308907=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x148)]],_0x55b84c=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x141)]],_0x25de52=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x19a)]],_0x513b71=[..._0x28e1c6['body'][_0x43bb2c(0x14a)]],_0x1e4aac=[..._0x28e1c6['body']['ToRoomAssigned']],_0x20c60f=[..._0x28e1c6['body'][_0x43bb2c(0x1eb)]],_0x1ed852=[..._0x28e1c6[_0x43bb2c(0x131)]['to_invoice']],_0x1cdb2a=[..._0x28e1c6[_0x43bb2c(0x131)][_0x43bb2c(0x14d)]];const _0xd2c982=_0x422a80[_0x43bb2c(0x1f8)](_0x34a389=>{return _0x34a389={'product_name':_0x34a389};});_0x512221[_0x43bb2c(0x1c1)]((_0x23aaac,_0x4ae59b)=>{var _0x52fe1d=_0x43bb2c;_0xd2c982[_0x4ae59b][_0x52fe1d(0x1f9)]=_0x23aaac;}),_0x5e3c20[_0x43bb2c(0x1c1)]((_0x58d4df,_0x5beaca)=>{_0xd2c982[_0x5beaca]['from_bay']=_0x58d4df;}),_0x1cdb2a[_0x43bb2c(0x1c1)]((_0x18ceed,_0x4969c1)=>{var _0x1d0d71=_0x43bb2c;_0xd2c982[_0x4969c1][_0x1d0d71(0x14d)]=_0x18ceed;}),_0x20c60f[_0x43bb2c(0x1c1)]((_0x15ba81,_0x554df1)=>{_0xd2c982[_0x554df1]['from_invoice']=_0x15ba81;}),_0x1ed852[_0x43bb2c(0x1c1)]((_0x3d3ba1,_0x32f05a)=>{var _0x465517=_0x43bb2c;_0xd2c982[_0x32f05a][_0x465517(0x19e)]=_0x3d3ba1;}),_0x5b6751[_0x43bb2c(0x1c1)]((_0x1da4d6,_0x42a0f0)=>{var _0x189ae1=_0x43bb2c;_0xd2c982[_0x42a0f0][_0x189ae1(0x160)]=_0x1da4d6;}),_0x3ebcc2[_0x43bb2c(0x1c1)]((_0x3405aa,_0x4a6003)=>{_0xd2c982[_0x4a6003]['to_bay']=_0x3405aa;}),_0x1de90a[_0x43bb2c(0x1c1)]((_0x947d47,_0x4377f)=>{var _0x4d6094=_0x43bb2c;_0xd2c982[_0x4377f][_0x4d6094(0x1c2)]=_0x947d47;}),_0x322c50['forEach']((_0xc36dd8,_0x4309db)=>{var _0x92aedc=_0x43bb2c;_0xd2c982[_0x4309db][_0x92aedc(0x172)]=_0xc36dd8;}),_0x56caba[_0x43bb2c(0x1c1)]((_0x124738,_0x3fcdd8)=>{_0xd2c982[_0x3fcdd8]['product_code']=_0x124738;}),_0x3836b2[_0x43bb2c(0x1c1)]((_0x34c095,_0x467896)=>{var _0x5257d0=_0x43bb2c;_0xd2c982[_0x467896][_0x5257d0(0x17f)]=_0x34c095;}),_0x274706[_0x43bb2c(0x1c1)]((_0x59c0fb,_0x539c85)=>{_0xd2c982[_0x539c85]['unit']=_0x59c0fb;}),_0x9f831b[_0x43bb2c(0x1c1)]((_0x374576,_0x5748e9)=>{var _0x144a34=_0x43bb2c;_0xd2c982[_0x5748e9][_0x144a34(0x1b6)]=_0x374576;}),_0x5f0de9['forEach']((_0x51cabf,_0x193bb7)=>{var _0x521b7b=_0x43bb2c;_0xd2c982[_0x193bb7][_0x521b7b(0x17e)]=_0x51cabf;}),_0xdf49b['forEach']((_0x50ccb1,_0x2ddb76)=>{_0xd2c982[_0x2ddb76]['expiry_date']=_0x50ccb1;}),_0x1d738e['forEach']((_0x572756,_0x5e0cd5)=>{_0xd2c982[_0x5e0cd5]['production_date']=_0x572756;}),_0x308907['forEach']((_0x43eb3d,_0x522d6e)=>{var _0xa8cffe=_0x43bb2c;_0xd2c982[_0x522d6e][_0xa8cffe(0x17f)]=_0x43eb3d;}),_0x55b84c[_0x43bb2c(0x1c1)]((_0x10aa70,_0x50508a)=>{var _0x2c0c6f=_0x43bb2c;_0xd2c982[_0x50508a][_0x2c0c6f(0x141)]=_0x10aa70;}),_0x25de52[_0x43bb2c(0x1c1)]((_0x49128a,_0x24da9d)=>{var _0x393752=_0x43bb2c;_0xd2c982[_0x24da9d][_0x393752(0x19a)]=_0x49128a;}),_0x513b71[_0x43bb2c(0x1c1)]((_0x725d24,_0x5bf8a0)=>{var _0x2aa24c=_0x43bb2c;_0xd2c982[_0x5bf8a0][_0x2aa24c(0x1c5)]=_0x725d24;}),_0x1e4aac[_0x43bb2c(0x1c1)]((_0x1548e3,_0x2bb3dd)=>{var _0x4eaf8e=_0x43bb2c;_0xd2c982[_0x2bb3dd][_0x4eaf8e(0x146)]=_0x1548e3;});const _0x4a9762=_0xd2c982['filter'](_0x134f4f=>_0x134f4f[_0x43bb2c(0x160)]!=='0'&&_0x134f4f[_0x43bb2c(0x160)]!==''||_0x134f4f[_0x43bb2c(0x13b)]!=='0'&&_0x134f4f[_0x43bb2c(0x13b)]!=='');var _0x51b5a9=0x0;_0x4a9762[_0x43bb2c(0x1c1)](_0x30968e=>{var _0x22bd5b=_0x43bb2c;parseInt(_0x30968e['from_quantity'])<parseInt(_0x30968e[_0x22bd5b(0x160)])&&_0x51b5a9++;});if(_0x51b5a9!=0x0)return _0x28e1c6[_0x43bb2c(0x1c0)](_0x43bb2c(0x1d7),_0x43bb2c(0x1c7)),_0x309a23[_0x43bb2c(0x1db)]('back');const _0x58abe6=new transfers_finished({'date':_0x418d71,'from_warehouse':_0x2c8c10,'to_warehouse':_0xe33db5,'product':_0x4a9762,'note':_0xb706de,'invoice':_0x52201e}),_0x5ce2e0=await _0x58abe6[_0x43bb2c(0x159)]();_0x28e1c6[_0x43bb2c(0x1c0)]('success',_0x43bb2c(0x1df)),_0x309a23[_0x43bb2c(0x1db)](_0x43bb2c(0x1a3)+_0x5ce2e0[_0x43bb2c(0x13d)]);}catch(_0x5b0215){console[_0x43bb2c(0x19b)](_0x5b0215),_0x309a23[_0x43bb2c(0x1e9)](0xc8)[_0x43bb2c(0x1da)]({'errorMessage':_0x5b0215[_0x43bb2c(0x16c)]});}}),router['get'](a0_0x440762(0x1f1),auth,async(_0x224fb4,_0x350b92)=>{var _0x564f00=a0_0x440762;try{const {username:_0x11fa6d,email:_0x31c1cc,role:_0x5d210f}=_0x224fb4['user'],_0x1d1490=_0x224fb4[_0x564f00(0x132)],_0x2f2ab6=await profile[_0x564f00(0x1ee)]({'email':_0x1d1490[_0x564f00(0x1a1)]}),_0x50c914=await master_shop[_0x564f00(0x16b)](),_0x39dfe6=await transfers_finished[_0x564f00(0x13f)](_0x224fb4[_0x564f00(0x14b)]['id']);let _0xceecd2;if(_0x1d1490['role']==_0x564f00(0x15b)){const _0xda1e12=await staff[_0x564f00(0x1ee)]({'email':_0x1d1490['email']});_0xceecd2=await warehouse[_0x564f00(0x16b)]({'status':_0x564f00(0x153),'name':_0xda1e12[_0x564f00(0x1ab)],'warehouse_category':'Finished\x20Goods'});}else _0xceecd2=await warehouse[_0x564f00(0x16b)]({'status':_0x564f00(0x153),'warehouse_category':_0x564f00(0x15d)});const _0x4fdd67=await warehouse[_0x564f00(0x15a)]([{'$match':{'name':_0x39dfe6['from_warehouse'],'warehouse_category':_0x564f00(0x15d)}},{'$unwind':_0x564f00(0x18b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x564f00(0x201)},'product_stock':{'$first':_0x564f00(0x149)},'bay':{'$first':_0x564f00(0x1c8)},'bin':{'$first':_0x564f00(0x1d0)},'type':{'$first':_0x564f00(0x1aa)},'floorlevel':{'$first':_0x564f00(0x123)},'primary_code':{'$first':_0x564f00(0x1e3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x564f00(0x17c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':'$room'},'warehoue_name':{'$first':_0x564f00(0x1a2)}}}]),_0x41b39c=await product['find']({});if(_0x50c914[0x0]['language']==_0x564f00(0x1e0)){var _0x31c0b0=users[_0x564f00(0x157)];console[_0x564f00(0x19b)](_0x31c0b0);}else{if(_0x50c914[0x0][_0x564f00(0x1a5)]==_0x564f00(0x19c))var _0x31c0b0=users['Hindi'];else{if(_0x50c914[0x0]['language']==_0x564f00(0x1ce))var _0x31c0b0=users[_0x564f00(0x1ce)];else{if(_0x50c914[0x0][_0x564f00(0x1a5)]==_0x564f00(0x1cf))var _0x31c0b0=users[_0x564f00(0x1cf)];else{if(_0x50c914[0x0]['language']==_0x564f00(0x176))var _0x31c0b0=users[_0x564f00(0x176)];else{if(_0x50c914[0x0][_0x564f00(0x1a5)]==_0x564f00(0x1ac))var _0x31c0b0=users[_0x564f00(0x137)];else{if(_0x50c914[0x0][_0x564f00(0x1a5)]=='Chinese')var _0x31c0b0=users[_0x564f00(0x16a)];else{if(_0x50c914[0x0][_0x564f00(0x1a5)]==_0x564f00(0x186))var _0x31c0b0=users['Arabic'];}}}}}}}_0x350b92[_0x564f00(0x12e)](_0x564f00(0x199),{'success':_0x224fb4['flash'](_0x564f00(0x189)),'errors':_0x224fb4[_0x564f00(0x1c0)]('errors'),'role':_0x1d1490,'profile':_0x2f2ab6,'master_shop':_0x50c914,'warehouse':_0xceecd2,'transfer':_0x39dfe6,'stock':_0x4fdd67,'unit':_0x41b39c,'language':_0x31c0b0});}catch(_0x32767f){console[_0x564f00(0x19b)](_0x32767f);}}),router['post'](a0_0x440762(0x1f1),auth,async(_0x15203c,_0x29ba01)=>{var _0x1546b7=a0_0x440762;try{const {invoice:_0x489fe3,from_warehouse:_0x14f736,FromRoom_name:_0x3d1f9b,to_warehouse:_0x57045e,ToRoom_name:_0x170734}=_0x15203c[_0x1546b7(0x131)],_0x125422=await transfers_finished[_0x1546b7(0x13f)](_0x15203c[_0x1546b7(0x14b)]['id']),_0x4b25de=_0x125422[_0x1546b7(0x124)][_0x1546b7(0x1f8)](async _0x4fc953=>{var _0x5a37cd=_0x1546b7;if(_0x4fc953[_0x5a37cd(0x160)]>0x0){var _0x36e67f=await warehouse['findOne']({'name':_0x14f736,'room':_0x4fc953['from_room_name'],'warehouse_category':_0x5a37cd(0x15d)});const _0x1a3ce8=_0x36e67f[_0x5a37cd(0x1ef)][_0x5a37cd(0x1f8)](_0x17cae4=>{var _0x4be7e9=_0x5a37cd;_0x17cae4[_0x4be7e9(0x203)]==_0x4fc953[_0x4be7e9(0x203)]&&_0x17cae4[_0x4be7e9(0x14c)]==_0x4fc953['from_bay']&&_0x17cae4[_0x4be7e9(0x1b7)]==_0x4fc953[_0x4be7e9(0x1b7)]&&_0x17cae4['production_date']==_0x4fc953[_0x4be7e9(0x16e)]&&_0x17cae4[_0x4be7e9(0x17e)]==_0x4fc953['batch_code']&&_0x17cae4[_0x4be7e9(0x150)]==_0x4fc953['from_invoice']&&(console[_0x4be7e9(0x19b)](_0x4be7e9(0x185),_0x17cae4['product_stock']),typeof _0x4fc953[_0x4be7e9(0x14d)]==_0x4be7e9(0x127)?_0x17cae4[_0x4be7e9(0x12c)]=Math[_0x4be7e9(0x1bb)](0x0,Math[_0x4be7e9(0x18c)](_0x17cae4[_0x4be7e9(0x12c)])-Math[_0x4be7e9(0x18c)](_0x4fc953['to_quantity'])):_0x17cae4['product_stock']=Math['max'](0x0,Math[_0x4be7e9(0x18c)](_0x17cae4[_0x4be7e9(0x12c)])-Math[_0x4be7e9(0x18c)](_0x4fc953[_0x4be7e9(0x160)])));});}return _0x36e67f;});Promise['all'](_0x4b25de)[_0x1546b7(0x1f0)](async _0x173b99=>{var _0x331a96=_0x1546b7;try{for(const _0x4a1d2b of _0x173b99){await _0x4a1d2b[_0x331a96(0x159)]();}const _0x382b5d=_0x125422[_0x331a96(0x124)][_0x331a96(0x1f8)](async _0x239434=>{var _0x4bf105=_0x331a96,_0x3572e5=await warehouse['findOne']({'name':_0x57045e,'room':_0x239434['to_room_name']});if(_0x239434[_0x4bf105(0x160)]>0x0){var _0x125953=0x0;const _0x340894=_0x3572e5[_0x4bf105(0x1ef)][_0x4bf105(0x1f8)](_0x41b267=>{var _0x12106e=_0x4bf105;_0x41b267[_0x12106e(0x203)]==_0x239434[_0x12106e(0x203)]&&_0x41b267[_0x12106e(0x14c)]==_0x239434[_0x12106e(0x180)]&&_0x41b267[_0x12106e(0x1b7)]==_0x239434['expiry_date']&&_0x41b267[_0x12106e(0x16e)]==_0x239434[_0x12106e(0x16e)]&&_0x41b267[_0x12106e(0x17e)]==_0x239434[_0x12106e(0x17e)]&&_0x41b267[_0x12106e(0x150)]==_0x239434[_0x12106e(0x19e)]&&(typeof _0x239434[_0x12106e(0x14d)]==_0x12106e(0x127)?(console[_0x12106e(0x19b)](_0x12106e(0x1f7),_0x41b267['product_stock']+_0x12106e(0x1ec)+_0x41b267[_0x12106e(0x13d)]+_0x12106e(0x18f)+Math[_0x12106e(0x18c)](_0x41b267['product_stock'])+Math['abs'](_0x239434[_0x12106e(0x160)])),_0x41b267[_0x12106e(0x12c)]=Math[_0x12106e(0x18c)](_0x41b267['product_stock'])+Math[_0x12106e(0x18c)](_0x239434['to_quantity'])):_0x41b267[_0x12106e(0x12c)]=Math['abs'](_0x41b267[_0x12106e(0x12c)])+Math['abs'](_0x239434[_0x12106e(0x160)]),_0x125953++);});_0x125953=='0'&&(_0x3572e5[_0x4bf105(0x1ef)]=_0x3572e5[_0x4bf105(0x1ef)]['concat']({'product_name':_0x239434[_0x4bf105(0x203)],'product_stock':_0x239434[_0x4bf105(0x160)],'bay':_0x239434['to_bay'],'product_code':_0x239434[_0x4bf105(0x1b1)],'primary_code':_0x239434[_0x4bf105(0x1c2)],'secondary_code':_0x239434[_0x4bf105(0x172)],'expiry_date':_0x239434[_0x4bf105(0x1b7)],'production_date':_0x239434[_0x4bf105(0x16e)],'maxProducts':_0x239434[_0x4bf105(0x17f)],'batch_code':_0x239434[_0x4bf105(0x17e)],'secondary_unit':_0x239434[_0x4bf105(0x1b6)],'unit':_0x239434['unit'],'maxProducts':_0x239434[_0x4bf105(0x17f)],'maxPerUnit':_0x239434[_0x4bf105(0x141)],'invoice':_0x239434[_0x4bf105(0x19e)]}));}return _0x3572e5;});Promise[_0x331a96(0x200)](_0x382b5d)[_0x331a96(0x1f0)](async _0x5c8989=>{var _0x15e4a6=_0x331a96;try{for(const _0xfab0a of _0x5c8989){await warehouse[_0x15e4a6(0x1ca)]({'_id':_0xfab0a['_id']},{'$addToSet':{'product_details':{'$each':_0xfab0a[_0x15e4a6(0x1ef)]}}});}_0x125422[_0x15e4a6(0x173)]=_0x15e4a6(0x1e2);const _0x426edd=await _0x125422[_0x15e4a6(0x159)](),_0x2b853f=await master_shop[_0x15e4a6(0x16b)](),_0x248e4e=await email_settings[_0x15e4a6(0x1ee)](),_0xb8f476=await supervisor_settings[_0x15e4a6(0x16b)]();var _0x33229d=_0x125422[_0x15e4a6(0x124)],_0x5efa7e='',_0x47474e;for(_0x47474e in _0x33229d){var _0x366f42='FG';_0x125422[_0x15e4a6(0x187)]=='DRY\x20GOODS'&&(_0x366f42='DG'),_0x5efa7e+=_0x15e4a6(0x1d4)+_0x15e4a6(0x130)+_0x33229d[_0x47474e][_0x15e4a6(0x203)]+_0x15e4a6(0x15f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x33229d[_0x47474e]['product_code']+_0x15e4a6(0x15f)+_0x15e4a6(0x130)+_0x33229d[_0x47474e][_0x15e4a6(0x160)]+_0x15e4a6(0x15f)+_0x15e4a6(0x130)+_0x33229d[_0x47474e]['unit']+_0x15e4a6(0x15f)+_0x15e4a6(0x130)+_0x33229d[_0x47474e][_0x15e4a6(0x1b6)]+'</td>'+_0x15e4a6(0x130)+_0x125422[_0x15e4a6(0x187)]+'</td>'+_0x15e4a6(0x130)+_0x33229d[_0x47474e][_0x15e4a6(0x146)]+_0x15e4a6(0x15f)+_0x15e4a6(0x130)+_0x366f42+_0x33229d[_0x47474e]['to_bay']+_0x15e4a6(0x15f)+_0x15e4a6(0x129);}let _0xbb4c47=nodemailer['createTransport']({'host':_0x248e4e[_0x15e4a6(0x1d1)],'port':Number(_0x248e4e[_0x15e4a6(0x191)]),'secure':![],'auth':{'user':_0x248e4e['email'],'pass':_0x248e4e[_0x15e4a6(0x144)]}}),_0x208781={'from':_0x248e4e['email'],'to':_0xb8f476[0x0]['FGSEmail'],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x15e4a6(0x164),'path':__dirname+_0x15e4a6(0x12f)+_0x15e4a6(0x152)+_0x2b853f[0x0]['image'],'cid':_0x15e4a6(0x18d)}],'html':_0x15e4a6(0x15e)+_0x15e4a6(0x19f)+_0x15e4a6(0x188)+_0x15e4a6(0x1fc)+_0x15e4a6(0x147)+'<div>'+_0x15e4a6(0x1d8)+_0x15e4a6(0x1c4)+_0x15e4a6(0x1fc)+_0x15e4a6(0x142)+_0x2b853f[0x0][_0x15e4a6(0x1ae)]+_0x15e4a6(0x197)+_0x15e4a6(0x1c4)+_0x15e4a6(0x1c4)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x15e4a6(0x1f2)+_0x15e4a6(0x1f6)+_0x125422[_0x15e4a6(0x150)]+'\x20'+_0x15e4a6(0x133)+'\x20Order\x20Date\x20:\x20'+_0x125422['date']+'\x20'+_0x15e4a6(0x138)+'</h5>'+_0x15e4a6(0x1c4)+_0x15e4a6(0x1cd)+_0x15e4a6(0x1b5)+_0x15e4a6(0x1d4)+_0x15e4a6(0x202)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x15e4a6(0x140)+_0x15e4a6(0x1e1)+_0x15e4a6(0x171)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x15e4a6(0x12b)+_0x15e4a6(0x183)+_0x15e4a6(0x129)+_0x15e4a6(0x182)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5efa7e+'\x20'+'</tbody>'+'</table>'+_0x15e4a6(0x1fc)+_0x15e4a6(0x196)+_0x15e4a6(0x170)+_0x2b853f[0x0]['site_title']+_0x15e4a6(0x1b0)+_0x15e4a6(0x1c4)+'</div>'+_0x15e4a6(0x1e7)};_0xbb4c47[_0x15e4a6(0x1cc)](_0x208781,function(_0x4a0269,_0x4afa86){var _0x4e670f=_0x15e4a6;_0x4a0269?(console[_0x4e670f(0x19b)](_0x4a0269),console[_0x4e670f(0x19b)](_0x4e670f(0x143))):console[_0x4e670f(0x19b)]('Email\x20sent\x20successfully');}),_0x15203c['flash']('success',_0x15e4a6(0x193)),_0x29ba01[_0x15e4a6(0x1db)](_0x15e4a6(0x169)+_0x426edd['_id']);}catch(_0x57db38){console['error'](_0x57db38),_0x29ba01['status'](0x1f4)[_0x15e4a6(0x1da)]({'error':_0x15e4a6(0x1a7)});}})['catch'](_0x23fedb=>{var _0x533da8=_0x331a96;console[_0x533da8(0x184)](_0x23fedb),_0x29ba01[_0x533da8(0x1e9)](0x1f4)[_0x533da8(0x1da)]({'error':_0x533da8(0x1d9)});});}catch(_0x14c975){console['error'](_0x14c975),_0x29ba01[_0x331a96(0x1e9)](0x1f4)[_0x331a96(0x1da)]({'error':_0x331a96(0x134)});}})[_0x1546b7(0x1e6)](_0x371df8=>{var _0x4d335f=_0x1546b7;console[_0x4d335f(0x184)](_0x371df8),_0x29ba01['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x21f4a2){_0x29ba01[_0x1546b7(0x1da)]({'message':_0x21f4a2[_0x1546b7(0x16c)]});}});function BayBinSelected(_0x39b483,_0x141b81){var _0x49b042=a0_0x440762,_0x4c4e69=[];let _0x5050e9=[];var _0x5760a9=[];if(_0x39b483=='DRY\x20GOODS'){switch(_0x141b81){case'Rack\x201':_0x4c4e69=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x49b042(0x1d6):_0x4c4e69=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5760a9=['DG'];}else{if(_0x39b483==_0x49b042(0x151)){switch(_0x141b81){case _0x49b042(0x1bc):_0x4c4e69=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x49b042(0x1d6):_0x4c4e69=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5760a9=['FG'];}}return{'levels':_0x4c4e69,'identify':_0x5760a9};}function a0_0x2e5d(){var _0x1cc64e=['host','note','getFullYear','<tr>','5103016QnVdjg','Rack\x202','errors','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','An\x20error\x20occurred.','json','redirect','filter','role','$finalize','Product\x20Transfer\x20successfully','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','True','$product_details.primary_code','$product.from_room_name','$product_details._id','catch','</body></html>','Transfer\x20Edit\x20Successfully','status','$product_details.level','from_invoice','\x20<>\x20','$product_details.invoice','findOne','product_details','then','/preview/:id','<h5\x20style=\x22text-align:\x20left;\x22>','post','/CheckingWarehouse','$from_warehouse','\x20Order\x20Number\x20:\x20','here2','map','from_quantity','$product_details.product_code','Ambient','<div>','concat','2557116bdPPEh','string','all','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_name','$product_details.floorlevel','product','../models/all_models','$product_details.maxProducts','undefined','/barcode_scanner3','</tr>','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','product_stock','2672619MiEXuX','render','/../public','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','body','user','<span\x20style=\x22float:\x20right;\x22>','An\x20error\x20occurred\x20while\x20saving\x20data.','from_prod_level','toString','Portuguese','</span>','$product_details.pallet','slice','to_floorlevel','MaxStocks_data2','_id','947836AIJapY','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','maxPerUnit','<h2>\x20','Error\x20Occurs','password','TRFF-','to_room_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','MaxStocks_data','$product_details.product_stock','RoomAssigned','params','bay','id_transaction','$product_details.production_date','transfer_data','invoice','FROZEN\x20GOODS','/upload/','Enabled','express','$product_details.maxPerUnit','/barcode_scanner2','English','date','save','aggregate','staff','2151185QghQcg','Finished\x20Goods','<!DOCTYPE\x20html>','</td>','to_quantity','primary_unit','to_prod_qty','getMonth','Logo.png','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view/:id','$product_details.unit','from_warehouse','/picking_list/PDF_transfer/','Chinese','find','message','add_transfer_finished','production_date','$product_details.secondary_code','<h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','secondary_code','finalize','832290hrEfpN','$product_details.isle','French','product_code3','to_prod_level','split','Router','$product_details.rack','$product_details.storage','$_id','batch_code','maxProducts','to_bay','back','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','error','here1','Arabic\x20(ae)','to_warehouse','</head><body>','success','length','$product_details','abs','logo','get','\x20<=>\x20','Arabic','port','from_prod_qty','Transfer\x20Finalize\x20Successfully','4awQEIJ','edit_transfer_finished','<strong>\x20Regards\x20</strong>','\x20</h2>','$to_warehouse','edit_transfer_finished_view','prod_cat','log','Hindi','$product_details.expiry_date','To_invoice','<html><head><title></title>','14BHixeC','email','$name','/transfer_finished/preview/','from_bay','language','floor','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','../middleware/auth','$product.to_room_name','$product_details.type','warehouse','Portuguese\x20(BR)','1411695gOAgJt','site_title','to_room','</h5>','product_code','$product_details.secondary_unit','$room','padStart','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_unit','expiry_date','New_Qty_Converted','30pYljDH','$date','max','Rack\x201','to_invoice','random','transfer_finished','flash','forEach','primary_code','prod_name','</div>','from_room_name','unit','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.bay','$product_details.batch_code','updateOne','Enclosed','sendMail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','German','Spanish','$product_details.bin'];a0_0x2e5d=function(){return _0x1cc64e;};return a0_0x2e5d();}router[a0_0x440762(0x18e)](a0_0x440762(0x166),auth,async(_0x294d5d,_0xbcf937)=>{var _0x794227=a0_0x440762;try{const {username:_0x1d2c6a,email:_0x202768,role:_0x5edc04}=_0x294d5d[_0x794227(0x132)],_0x4405fd=_0x294d5d[_0x794227(0x132)],_0x1398f4=await profile[_0x794227(0x1ee)]({'email':_0x4405fd['email']}),_0x578207=await master_shop[_0x794227(0x16b)](),_0x14b0c1=await transfers_finished[_0x794227(0x13f)](_0x294d5d['params']['id']);let _0x335586=new Date(_0x14b0c1[_0x794227(0x1b7)]),_0x13e689=('0'+_0x335586['getDate']())['slice'](-0x2),_0x4ade10=('0'+(_0x335586[_0x794227(0x163)]()+0x1))[_0x794227(0x13a)](-0x2),_0x347318=_0x335586[_0x794227(0x1d3)](),_0x411f0a=_0x347318+'-'+_0x4ade10+'-'+_0x13e689,_0x24face;if(_0x4405fd[_0x794227(0x1dd)]==_0x794227(0x15b)){const _0x6ec3a7=await staff[_0x794227(0x1ee)]({'email':_0x4405fd[_0x794227(0x1a1)]});_0x24face=await warehouse[_0x794227(0x16b)]({'status':_0x794227(0x153),'name':_0x6ec3a7[_0x794227(0x1ab)],'warehouse_category':_0x794227(0x15d)});}else _0x24face=await warehouse[_0x794227(0x16b)]({'status':_0x794227(0x153),'warehouse_category':'Finished\x20Goods'});const _0x5af515=await warehouse[_0x794227(0x15a)]([{'$match':{'name':_0x14b0c1[_0x794227(0x168)],'room':_0x14b0c1['from_room']}},{'$unwind':_0x794227(0x18b)},{'$group':{'_id':_0x794227(0x1e5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x794227(0x149)},'bay':{'$first':_0x794227(0x1c8)},'bin':{'$first':_0x794227(0x1d0)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x794227(0x123)},'primary_code':{'$first':_0x794227(0x1e3)},'secondary_code':{'$first':_0x794227(0x16f)},'product_code':{'$first':_0x794227(0x1fa)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);var _0x42e6a5=[0x1,0x2,0x3,0x4],_0x325e78=['A','B','C','D','E','F','G','H','I','J'],_0x1595cf=[_0x794227(0x1fb),_0x794227(0x1cb)];const _0x338127=await product[_0x794227(0x16b)]({}),_0x8e135=BayBinSelected(_0x14b0c1[_0x794227(0x187)],_0x14b0c1[_0x794227(0x1af)]);if(_0x578207[0x0][_0x794227(0x1a5)]==_0x794227(0x1e0)){var _0x110640=users[_0x794227(0x157)];console[_0x794227(0x19b)](_0x110640);}else{if(_0x578207[0x0][_0x794227(0x1a5)]=='Hindi')var _0x110640=users[_0x794227(0x19c)];else{if(_0x578207[0x0]['language']==_0x794227(0x1ce))var _0x110640=users['German'];else{if(_0x578207[0x0][_0x794227(0x1a5)]==_0x794227(0x1cf))var _0x110640=users[_0x794227(0x1cf)];else{if(_0x578207[0x0]['language']=='French')var _0x110640=users[_0x794227(0x176)];else{if(_0x578207[0x0]['language']=='Portuguese\x20(BR)')var _0x110640=users['Portuguese'];else{if(_0x578207[0x0][_0x794227(0x1a5)]==_0x794227(0x16a))var _0x110640=users['Chinese'];else{if(_0x578207[0x0][_0x794227(0x1a5)]==_0x794227(0x186))var _0x110640=users[_0x794227(0x190)];}}}}}}}_0xbcf937['render'](_0x794227(0x195),{'success':_0x294d5d[_0x794227(0x1c0)](_0x794227(0x189)),'errors':_0x294d5d[_0x794227(0x1c0)](_0x794227(0x1d7)),'role':_0x4405fd,'profile':_0x1398f4,'master_shop':_0x578207,'warehouse':_0x24face,'transfer':_0x14b0c1,'stock':_0x5af515,'unit':_0x338127,'language':_0x110640,'levels':_0x42e6a5,'Isle':_0x325e78,'rooms_data':_0x1595cf,'ed_fullDate':_0x411f0a,'dataSelected':_0x8e135});}catch(_0x385c32){console['log'](_0x385c32);}}),router['post'](a0_0x440762(0x166),auth,async(_0x57936c,_0x42d700)=>{var _0x458e72=a0_0x440762;try{const _0x44dc40=_0x57936c[_0x458e72(0x14b)]['id'];console[_0x458e72(0x19b)](_0x57936c[_0x458e72(0x131)]);const _0x11b911=await transfers_finished['findById'](_0x44dc40);console[_0x458e72(0x19b)](_0x458e72(0x14f),_0x11b911);const {date:_0x1b0157,from_warehouse:_0x45c43f,FromRoom_name:_0x5a63c7,to_warehouse:_0x29c66a,ToRoom_name:_0x2bb101,prod_name:_0x406483,from_prod_qty:_0x27b8a3,from_prod_level:_0x22d69f,from_prod_isle:_0x214b27,from_prod_pallet:_0x2eb17d,to_prod_qty:_0x2412fd,to_prod_level:_0x947c,to_prod_isle:_0x39d80b,to_prod_pallet:_0x5961fa,primary_code:_0x1f706a,secondary_code:_0x4077af,product_code3:_0x513084,note:_0x339978,invoice:_0x276a5a,expiry_date:_0xe93936}=_0x57936c['body'];if(typeof _0x406483==_0x458e72(0x1ff))var _0x278a02=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x1c3)]],_0xf91cda=[_0x57936c[_0x458e72(0x131)]['from_prod_qty']],_0x16f12c=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x135)]],_0xdc4588=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x162)]],_0x1dc9e6=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x178)]],_0x9ec091=[_0x57936c['body'][_0x458e72(0x1c2)]],_0x1dc366=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x172)]],_0x1ec003=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x177)]],_0x70e0b5=[_0x57936c['body']['MaxStocks_data2']],_0xeca820=[_0x57936c['body'][_0x458e72(0x1c6)]],_0x35ebda=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x1b6)]],_0x183b8d=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x17e)]],_0x1bc89e=[_0x57936c[_0x458e72(0x131)][_0x458e72(0x1b7)]];else var _0x278a02=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x1c3)]],_0xf91cda=[..._0x57936c[_0x458e72(0x131)]['from_prod_qty']],_0x16f12c=[..._0x57936c[_0x458e72(0x131)]['from_prod_level']],_0xdc4588=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x162)]],_0x1dc9e6=[..._0x57936c[_0x458e72(0x131)]['to_prod_level']],_0x9ec091=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x1c2)]],_0x1dc366=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x172)]],_0x1ec003=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x177)]],_0x70e0b5=[..._0x57936c[_0x458e72(0x131)]['MaxStocks_data2']],_0xeca820=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x1c6)]],_0x35ebda=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x1b6)]],_0x183b8d=[..._0x57936c[_0x458e72(0x131)][_0x458e72(0x17e)]],_0x1bc89e=[..._0x57936c['body']['expiry_date']];const _0x8d4c95=_0x278a02['map'](_0x2db555=>{return _0x2db555={'product_name':_0x2db555};});_0xf91cda[_0x458e72(0x1c1)]((_0x33a7cf,_0x209edc)=>{_0x8d4c95[_0x209edc]['from_quantity']=_0x33a7cf;}),_0x16f12c[_0x458e72(0x1c1)]((_0x452c5f,_0x37a729)=>{_0x8d4c95[_0x37a729]['from_bay']=_0x452c5f;}),_0xdc4588[_0x458e72(0x1c1)]((_0x25aa5e,_0x47f81f)=>{_0x8d4c95[_0x47f81f]['to_quantity']=_0x25aa5e;}),_0x1dc9e6[_0x458e72(0x1c1)]((_0x33822e,_0x2ba7c2)=>{var _0x2b8882=_0x458e72;_0x8d4c95[_0x2ba7c2][_0x2b8882(0x180)]=_0x33822e;}),_0x9ec091[_0x458e72(0x1c1)]((_0x1ce204,_0x483585)=>{var _0x4efce8=_0x458e72;_0x8d4c95[_0x483585][_0x4efce8(0x1c2)]=_0x1ce204;}),_0x1dc366[_0x458e72(0x1c1)]((_0x194894,_0x5afba3)=>{var _0x2cc04b=_0x458e72;_0x8d4c95[_0x5afba3][_0x2cc04b(0x172)]=_0x194894;}),_0x1ec003[_0x458e72(0x1c1)]((_0x14f5b5,_0x2f6e0a)=>{var _0x31e2ee=_0x458e72;_0x8d4c95[_0x2f6e0a][_0x31e2ee(0x1b1)]=_0x14f5b5;}),_0x70e0b5[_0x458e72(0x1c1)]((_0x59fb0e,_0x425523)=>{var _0x3ec6c9=_0x458e72;_0x8d4c95[_0x425523][_0x3ec6c9(0x17f)]=_0x59fb0e;}),_0xeca820['forEach']((_0x28b0eb,_0x109039)=>{_0x8d4c95[_0x109039]['unit']=_0x28b0eb;}),_0x35ebda[_0x458e72(0x1c1)]((_0x4c8be0,_0x174f03)=>{var _0x363c6c=_0x458e72;_0x8d4c95[_0x174f03][_0x363c6c(0x1b6)]=_0x4c8be0;}),_0x183b8d['forEach']((_0x1edf11,_0x2cea65)=>{var _0x24210f=_0x458e72;_0x8d4c95[_0x2cea65][_0x24210f(0x17e)]=_0x1edf11;}),_0x1bc89e[_0x458e72(0x1c1)]((_0x5b6d3f,_0x514110)=>{var _0x2a6679=_0x458e72;_0x8d4c95[_0x514110][_0x2a6679(0x1b7)]=_0x5b6d3f;});const _0x3636da=_0x8d4c95[_0x458e72(0x1dc)](_0x2ba4fd=>_0x2ba4fd[_0x458e72(0x160)]!=='0'&&_0x2ba4fd[_0x458e72(0x160)]!==''||_0x2ba4fd[_0x458e72(0x13b)]!=='0'&&_0x2ba4fd[_0x458e72(0x13b)]!=='');var _0xcd6f22=0x0;_0x3636da['forEach'](_0xeb07c=>{var _0xb8112e=_0x458e72;parseInt(_0xeb07c[_0xb8112e(0x1f9)])<parseInt(_0xeb07c[_0xb8112e(0x160)])&&_0xcd6f22++;});if(_0xcd6f22!=0x0)return _0x57936c['flash'](_0x458e72(0x1d7),_0x458e72(0x1c7)),_0x42d700[_0x458e72(0x1db)](_0x458e72(0x181));const _0x42d853=await warehouse[_0x458e72(0x1ee)]({'name':_0x11b911[_0x458e72(0x168)],'room':_0x11b911['from_room']});_0x11b911[_0x458e72(0x124)]['forEach'](_0x393f11=>{var _0x3e823d=_0x458e72;if(_0x393f11[_0x3e823d(0x160)]>0x0){const _0xd53656=_0x42d853[_0x3e823d(0x1ef)][_0x3e823d(0x1f8)](_0x53116c=>{var _0x24afac=_0x3e823d;_0x53116c['product_name']==_0x393f11[_0x24afac(0x203)]&&_0x53116c[_0x24afac(0x14c)]==_0x393f11[_0x24afac(0x1a4)]&&(_0x53116c[_0x24afac(0x12c)]=parseInt(_0x53116c[_0x24afac(0x12c)])+parseInt(_0x393f11['to_quantity']));});}}),await _0x42d853[_0x458e72(0x159)]();const _0x29d8df=await warehouse[_0x458e72(0x1ee)]({'name':_0x11b911[_0x458e72(0x187)],'room':_0x11b911['to_room']});_0x11b911[_0x458e72(0x124)][_0x458e72(0x1c1)](_0x5f2a24=>{var _0x3a9a4f=_0x458e72;if(_0x5f2a24[_0x3a9a4f(0x160)]>0x0){const _0x2d904d=_0x29d8df[_0x3a9a4f(0x1ef)][_0x3a9a4f(0x1f8)](_0x444e19=>{var _0x327872=_0x3a9a4f;_0x444e19[_0x327872(0x203)]==_0x5f2a24[_0x327872(0x203)]&&_0x444e19[_0x327872(0x14c)]==_0x5f2a24[_0x327872(0x180)]&&(_0x444e19[_0x327872(0x12c)]=parseInt(_0x444e19[_0x327872(0x12c)])-parseInt(_0x5f2a24['to_quantity']));});}}),await _0x29d8df[_0x458e72(0x159)](),_0x11b911[_0x458e72(0x158)]=_0x1b0157,_0x11b911[_0x458e72(0x168)]=_0x45c43f,_0x11b911[_0x458e72(0x187)]=_0x29c66a,_0x11b911['product']=_0x3636da,_0x11b911[_0x458e72(0x1d2)]=_0x339978,_0x11b911[_0x458e72(0x150)]=_0x276a5a;const _0x496a18=await _0x11b911[_0x458e72(0x159)](),_0x1bf323=await warehouse['findOne']({'name':_0x45c43f,'room':_0x5a63c7});_0x496a18[_0x458e72(0x124)]['forEach'](_0x2b3f74=>{var _0x4636e1=_0x458e72;if(_0x2b3f74[_0x4636e1(0x160)]>0x0){const _0x54fb19=_0x1bf323[_0x4636e1(0x1ef)]['map'](_0x5e159e=>{var _0x4fe701=_0x4636e1;_0x5e159e[_0x4fe701(0x203)]==_0x2b3f74['product_name']&&_0x5e159e[_0x4fe701(0x14c)]==_0x2b3f74['from_bay']&&(_0x5e159e[_0x4fe701(0x12c)]=parseInt(_0x5e159e[_0x4fe701(0x12c)])-parseInt(_0x2b3f74[_0x4fe701(0x160)]));});}}),await _0x1bf323[_0x458e72(0x159)]();const _0x5e45f8=await warehouse['findOne']({'name':_0x29c66a,'room':_0x2bb101});_0x496a18['product']['forEach'](_0x1768c7=>{var _0xbc886e=_0x458e72;if(_0x1768c7['to_quantity']>0x0){var _0xe05dec=0x0;const _0x4fd456=_0x5e45f8[_0xbc886e(0x1ef)][_0xbc886e(0x1f8)](_0x27fb38=>{var _0x3f1b6b=_0xbc886e;_0x27fb38[_0x3f1b6b(0x203)]==_0x1768c7['product_name']&&_0x27fb38['bay']==_0x1768c7[_0x3f1b6b(0x180)]&&(_0x27fb38[_0x3f1b6b(0x12c)]=parseInt(_0x27fb38['product_stock'])+parseInt(_0x1768c7[_0x3f1b6b(0x160)]),_0xe05dec++);});_0xe05dec=='0'&&(_0x5e45f8['product_details']=_0x5e45f8[_0xbc886e(0x1ef)][_0xbc886e(0x1fd)]({'product_name':_0x1768c7[_0xbc886e(0x203)],'product_stock':_0x1768c7['to_quantity'],'bay':_0x1768c7[_0xbc886e(0x180)],'product_code':_0x1768c7[_0xbc886e(0x1b1)],'primary_code':_0x1768c7[_0xbc886e(0x1c2)],'secondary_code':_0x1768c7[_0xbc886e(0x172)],'maxProducts':_0x1768c7[_0xbc886e(0x17f)]}));}}),await _0x5e45f8['save'](),_0x57936c['flash'](_0x458e72(0x189),_0x458e72(0x1e8)),_0x42d700['redirect']('/transfer_finished/view');}catch(_0x58a907){console[_0x458e72(0x19b)](_0x58a907);}}),router[a0_0x440762(0x1f3)]('/barcode_scanner',async(_0x598db4,_0x4f81dd)=>{var _0x4d8e18=a0_0x440762;const {FromWareHouse:_0x2bd22f,FromRoom:_0x430fac,ToWarehouse:_0x306524,ToRoom:_0x363d84,primary_code:_0x3beeca,Roomslist:_0x484afd}=_0x598db4[_0x4d8e18(0x131)],_0x45dc85=_0x484afd[_0x4d8e18(0x179)](','),_0x5b8fd2=[];async function _0x52b50e(_0x475103){var _0x4a833e=_0x4d8e18;const _0x247f7e=await warehouse[_0x4a833e(0x15a)]([{'$match':{'name':_0x2bd22f,'room':_0x475103}},{'$unwind':_0x4a833e(0x18b)},{'$match':{'product_details.primary_code':_0x3beeca}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4a833e(0x201)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4a833e(0x1e3)},'secondary_code':{'$first':_0x4a833e(0x16f)},'product_code':{'$first':_0x4a833e(0x1fa)},'level':{'$first':_0x4a833e(0x1c8)},'isle':{'$first':_0x4a833e(0x1d0)},'type':{'$first':_0x4a833e(0x1aa)},'pallet':{'$first':_0x4a833e(0x123)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4a833e(0x17c)},'rack':{'$first':_0x4a833e(0x17b)},'expiry_date':{'$first':_0x4a833e(0x19d)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x4a833e(0x1c9)},'maxPerUnit':{'$first':_0x4a833e(0x155)},'roomNamed':{'$first':_0x4a833e(0x1b3)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x4a833e(0x1ed)}}}]),_0x1259b1=await warehouse[_0x4a833e(0x15a)]([{'$match':{'name':_0x2bd22f,'room':_0x475103}},{'$unwind':_0x4a833e(0x18b)},{'$match':{'product_details.secondary_code':_0x3beeca}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4a833e(0x201)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x4a833e(0x1e3)},'secondary_code':{'$first':_0x4a833e(0x16f)},'product_code':{'$first':_0x4a833e(0x1fa)},'level':{'$first':_0x4a833e(0x1c8)},'isle':{'$first':_0x4a833e(0x1d0)},'type':{'$first':_0x4a833e(0x1aa)},'pallet':{'$first':_0x4a833e(0x123)},'unit':{'$first':_0x4a833e(0x167)},'secondary_unit':{'$first':_0x4a833e(0x1b2)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4a833e(0x19d)},'production_date':{'$first':_0x4a833e(0x14e)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x4a833e(0x155)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x4a833e(0x1ed)}}}]);if(_0x247f7e[_0x4a833e(0x18a)]>0x0)_0x5b8fd2['push'](_0x247f7e);else _0x1259b1[_0x4a833e(0x18a)]>0x0&&_0x5b8fd2['push'](_0x1259b1);}const _0x114122=_0x45dc85[_0x4d8e18(0x1f8)](_0x151139=>_0x52b50e(_0x151139));await Promise[_0x4d8e18(0x200)](_0x114122),_0x4f81dd[_0x4d8e18(0x1da)](_0x5b8fd2);}),router['post'](a0_0x440762(0x156),async(_0x4fd6cc,_0x5ccbc5)=>{var _0x584da5=a0_0x440762;try{const {FromWareHouse:_0x24bb6d,FromRoom:_0xb7b3d6,ToWarehouse:_0x289a42,ToRoom:_0x18588c,secondary_code:_0x33ceee}=_0x4fd6cc['body'],_0x5c86b0=await warehouse['aggregate']([{'$match':{'name':_0x24bb6d}},{'$unwind':_0x584da5(0x18b)},{'$match':{'product_details.secondary_code':_0x33ceee}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x584da5(0x201)},'primary_code':{'$first':_0x584da5(0x1e3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x584da5(0x149)},'warehouse':{'$first':_0x584da5(0x1a2)},'level':{'$first':_0x584da5(0x1ea)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x584da5(0x126)},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x584da5(0x19d)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x5ccbc5[_0x584da5(0x1e9)](0xc8)['json'](_0x5c86b0);}catch(_0x453902){_0x5ccbc5[_0x584da5(0x1e9)](0x194)[_0x584da5(0x1da)]({'message':_0x453902[_0x584da5(0x16c)]});}}),router[a0_0x440762(0x1f3)](a0_0x440762(0x128),async(_0x3db9db,_0x166ce1)=>{var _0x24f587=a0_0x440762;try{const {FromWareHouse:_0x417f52,FromRoom:_0x4fb083,ToWarehouse:_0x212f95,ToRoom:_0x11ebb7,product_code:_0x334bb0}=_0x3db9db[_0x24f587(0x131)],_0x155271=await warehouse[_0x24f587(0x15a)]([{'$match':{'name':_0x417f52}},{'$unwind':_0x24f587(0x18b)},{'$match':{'product_details.product_code':_0x334bb0}},{'$group':{'_id':_0x24f587(0x1e5),'name':{'$first':_0x24f587(0x201)},'primary_code':{'$first':_0x24f587(0x1e3)},'secondary_code':{'$first':_0x24f587(0x16f)},'product_code':{'$first':_0x24f587(0x1fa)},'instock':{'$first':_0x24f587(0x149)},'warehouse':{'$first':_0x24f587(0x1a2)},'level':{'$first':_0x24f587(0x1ea)},'isle':{'$first':_0x24f587(0x175)},'pallet':{'$first':_0x24f587(0x139)},'maxProducts':{'$first':_0x24f587(0x126)},'unit':{'$first':'$product_details.unit'}}}]);_0x166ce1['status'](0xc8)[_0x24f587(0x1da)](_0x155271);}catch(_0x175cb2){_0x166ce1[_0x24f587(0x1e9)](0x194)[_0x24f587(0x1da)]({'message':_0x175cb2[_0x24f587(0x16c)]});}}),router['post'](a0_0x440762(0x1f4),async(_0x14bda2,_0xf422e4)=>{var _0x2c71fd=a0_0x440762;const {productCode:_0x5c03dd,bay:_0x296b3c,warehouses:_0x590337,room:_0x2b3d58}=_0x14bda2[_0x2c71fd(0x131)];console[_0x2c71fd(0x19b)](_0x14bda2['body']);try{const _0x1e5643=await warehouse['aggregate']([{'$match':{'name':_0x590337,'room':_0x2b3d58}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x296b3c)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2c71fd(0x201)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xf422e4['status'](0xc8)[_0x2c71fd(0x1da)](_0x1e5643);}catch(_0x2c5bfc){_0xf422e4[_0x2c71fd(0x1e9)](0x194)[_0x2c71fd(0x1da)]({'message':_0x2c5bfc[_0x2c71fd(0x16c)]});}}),module['exports']=router;