var a0_0x580683=a0_0x4ef3;function a0_0x4ef3(_0x20e170,_0x1a7fd1){var _0x2021aa=a0_0x2021();return a0_0x4ef3=function(_0x4ef35c,_0x4af8da){_0x4ef35c=_0x4ef35c-0x97;var _0x4fa912=_0x2021aa[_0x4ef35c];return _0x4fa912;},a0_0x4ef3(_0x20e170,_0x1a7fd1);}function a0_0x2021(){var _0xf2cea7=['catch','expiry_date','add_transfer_finished','createTransport','email','<strong>\x20Regards\x20</strong>','post','</tbody>','nodemailer','split','Finished\x20Goods','Enabled','image','edit_transfer_finished_view','secondary_code','$product_details.maxPerUnit','Enclosed','</table>','FROZEN\x20GOODS','</div>','<h2>\x20','to_room','to_bay','port','$product_details._id','user','success','maxPerUnit','$product_details.pallet','$product_details.level','<html><head><title></title>','random','language','1094340lQNWtY','/barcode_scanner','errors','json','from_room_name','findById','Rack\x201','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Error\x20Occurs','transfer_data','Rack\x202','$product_details.secondary_unit','from_prod_qty','/CheckingWarehouse','Arabic\x20(ae)','from_bay','12273777SnIdrX','edit_transfer_finished','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','from_room','abs','params','string','aggregate','<tr>','/barcode_scanner2','here1','$product_details.invoice','to_prod_qty','MaxStocks_data','flash','ToRoomAssigned','$product_details.product_code','RoomAssigned','updateOne','product_stock','MaxStocks_data2','DRY\x20GOODS','\x20Order\x20Date\x20:\x20','sendMail','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','getFullYear','slice','host','Hindi','To_invoice','redirect','find','<span\x20style=\x22float:\x20right;\x22>','map','here2','2940112OLMteD','<tbody\x20style=\x22text-align:\x20center;\x22>','/preview/:id','product_code','$product.to_room_name','$product_details.primary_code','product','</thead>','prod_name','unit','$product_details.batch_code','Ambient','to_warehouse','from_quantity','234612ZkKIDX','invoice','TRFF-','$product_details.secondary_code','to_quantity','77kiBKco','$product_details.isle','push','/transfer_finished/preview/','328402gDckQe','Arabic','German','$to_warehouse','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Logo.png','secondary_unit','$product_details.expiry_date','$finalize','\x20<=>\x20','<hr\x20class=\x22my-3\x22>','to_prod_level','</h5>','id_transaction','$product_details.floorlevel','New_Qty_Converted','product_details','to_invoice','then','batch_code','warehouse','../models/all_models','English\x20(US)','undefined','9FOqHGd','concat','\x20<>\x20','note','$product_details.rack','$invoice','$product_details.unit','An\x20error\x20occurred\x20while\x20saving\x20data.','Transfer\x20Edit\x20Successfully','\x20</h2>','$product_details.bay','/view/add_transfer','../middleware/auth','/picking_list/PDF_transfer/','<div>','save','/barcode_scanner3','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','</span>','date','product_date','role','filter','primary_unit','log','transfer_finished','$product_details.product_name','An\x20error\x20occurred.','message','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</tr>','error','primary_code','max','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','English','$product_details.storage','Portuguese\x20(BR)','maxProducts','Portuguese','status','product_name','$product_details.type','product_code3','$product_details.production_date','staff','Spanish','to_room_name','$name','French','Chinese','production_date','$product_details.product_stock','306103WtSszg','</td>','all','$product.from_room_name','$product','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','render','$product_details.maxProducts','length','logo','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','True','from_warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$date','_id','site_title','$product_details','</head><body>','/transfer/view','$product_details.bin','bay','$_id','exports','$room','findOne','/../public','to_floorlevel','from_prod_level','from_invoice','forEach','back','493308BwDVCO','padStart','body'];a0_0x2021=function(){return _0xf2cea7;};return a0_0x2021();}(function(_0x45c55d,_0x38d45d){var _0x4bf8ad=a0_0x4ef3,_0x3bd01c=_0x45c55d();while(!![]){try{var _0x313916=-parseInt(_0x4bf8ad(0xea))/0x1+parseInt(_0x4bf8ad(0x9c))/0x2*(-parseInt(_0x4bf8ad(0xb4))/0x3)+-parseInt(_0x4bf8ad(0x10c))/0x4+-parseInt(_0x4bf8ad(0x130))/0x5+parseInt(_0x4bf8ad(0x172))/0x6*(parseInt(_0x4bf8ad(0x98))/0x7)+-parseInt(_0x4bf8ad(0x164))/0x8+parseInt(_0x4bf8ad(0x140))/0x9;if(_0x313916===_0x38d45d)break;else _0x3bd01c['push'](_0x3bd01c['shift']());}catch(_0x4d7ce4){_0x3bd01c['push'](_0x3bd01c['shift']());}}}(a0_0x2021,0x45b14));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x580683(0xb1)),auth=require(a0_0x580683(0xc0)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x580683(0x117));router[a0_0x580683(0xf5)]('/view',auth,async(_0x2de0c7,_0x2063e1)=>{var _0xfa5783=a0_0x580683;try{const {username:_0x11e774,email:_0x2f5433,role:_0x382ca7}=_0x2de0c7[_0xfa5783(0x128)],_0xbd991a=_0x2de0c7[_0xfa5783(0x128)],_0x57188b=await profile[_0xfa5783(0x105)]({'email':_0xbd991a[_0xfa5783(0x113)]}),_0x14a250=await master_shop[_0xfa5783(0x160)]();let _0x44533b;if(_0xbd991a[_0xfa5783(0xc9)]==_0xfa5783(0xe2)){const _0x141bdc=await staff[_0xfa5783(0x105)]({'email':_0xbd991a[_0xfa5783(0x113)]});_0x44533b=await transfers_finished[_0xfa5783(0x160)]({'from_warehouse':_0x141bdc['warehouse']});}else _0x44533b=await transfers_finished[_0xfa5783(0x148)]([{'$unwind':_0xfa5783(0xee)},{'$group':{'_id':_0xfa5783(0x102),'invoice':{'$first':_0xfa5783(0xb9)},'date':{'$first':_0xfa5783(0xfa)},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0xfa5783(0x9f)},'from_room_name':{'$addToSet':_0xfa5783(0xed)},'to_room_name':{'$addToSet':_0xfa5783(0x168)},'finalize':{'$first':_0xfa5783(0xa4)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x14a250[0x0][_0xfa5783(0x12f)]==_0xfa5783(0xb2))var _0x17da03=users[_0xfa5783(0xd8)];else{if(_0x14a250[0x0]['language']==_0xfa5783(0x15d))var _0x17da03=users[_0xfa5783(0x15d)];else{if(_0x14a250[0x0]['language']==_0xfa5783(0x9e))var _0x17da03=users['German'];else{if(_0x14a250[0x0][_0xfa5783(0x12f)]=='Spanish')var _0x17da03=users['Spanish'];else{if(_0x14a250[0x0][_0xfa5783(0x12f)]=='French')var _0x17da03=users[_0xfa5783(0xe6)];else{if(_0x14a250[0x0][_0xfa5783(0x12f)]==_0xfa5783(0xda))var _0x17da03=users['Portuguese'];else{if(_0x14a250[0x0][_0xfa5783(0x12f)]==_0xfa5783(0xe7))var _0x17da03=users[_0xfa5783(0xe7)];else{if(_0x14a250[0x0]['language']==_0xfa5783(0x13e))var _0x17da03=users[_0xfa5783(0x9d)];}}}}}}}_0x2063e1[_0xfa5783(0xf1)](_0xfa5783(0xcd),{'success':_0x2de0c7[_0xfa5783(0x14f)](_0xfa5783(0x129)),'errors':_0x2de0c7[_0xfa5783(0x14f)](_0xfa5783(0x132)),'role':_0xbd991a,'profile':_0x57188b,'master_shop':_0x14a250,'transfer':_0x44533b,'language':_0x17da03});}catch(_0x399354){console[_0xfa5783(0xcc)](_0x399354);}});async function getRandom8DigitNumber(){var _0x51d8fb=a0_0x580683;const _0x2f6cde=0x989680,_0xf7aff9=0x5f5e0ff,_0x3bdc3e=Math['floor'](Math[_0x51d8fb(0x12e)]()*(_0xf7aff9-_0x2f6cde+0x1))+_0x2f6cde;var _0x4153b4;const _0x4589ef=await transfers_finished[_0x51d8fb(0x105)]({'invoice':_0x51d8fb(0x174)+_0x3bdc3e});return _0x4589ef&&_0x4589ef[_0x51d8fb(0xf3)]>0x0?_0x4153b4=_0x51d8fb(0x174)+_0x3bdc3e:_0x4153b4=_0x51d8fb(0x174)+_0x3bdc3e,_0x4153b4;}router['get'](a0_0x580683(0xbf),auth,async(_0x109d82,_0x431ed5)=>{var _0x3de69d=a0_0x580683;try{const {username:_0x11f4e2,email:_0x39bfe6,role:_0x592203}=_0x109d82[_0x3de69d(0x128)],_0xa63692=_0x109d82[_0x3de69d(0x128)],_0x5ea4f=await profile[_0x3de69d(0x105)]({'email':_0xa63692[_0x3de69d(0x113)]}),_0x1a0776=await master_shop['find']();let _0x255aa3;if(_0xa63692[_0x3de69d(0xc9)]==_0x3de69d(0xe2)){const _0x541b47=await staff[_0x3de69d(0x105)]({'email':_0xa63692[_0x3de69d(0x113)]});_0x255aa3=await warehouse[_0x3de69d(0x148)]([{'$match':{'status':'Enabled','name':_0x541b47[_0x3de69d(0xb0)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3de69d(0xe5),'name':{'$first':_0x3de69d(0xe5)}}}]);}else _0x255aa3=await warehouse[_0x3de69d(0x148)]([{'$match':{'status':_0x3de69d(0x11a),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3de69d(0xe5),'name':{'$first':_0x3de69d(0xe5)}}}]);const _0x378e7f=await transfers_finished[_0x3de69d(0x160)]({}),_0x20afeb=_0x378e7f[_0x3de69d(0xf3)]+0x1,_0x1fab3d='TRFF-'+_0x20afeb['toString']()[_0x3de69d(0x10d)](0x5,'0');if(_0x1a0776[0x0]['language']=='English\x20(US)')var _0x595879=users[_0x3de69d(0xd8)];else{if(_0x1a0776[0x0][_0x3de69d(0x12f)]==_0x3de69d(0x15d))var _0x595879=users['Hindi'];else{if(_0x1a0776[0x0][_0x3de69d(0x12f)]==_0x3de69d(0x9e))var _0x595879=users[_0x3de69d(0x9e)];else{if(_0x1a0776[0x0]['language']==_0x3de69d(0xe3))var _0x595879=users['Spanish'];else{if(_0x1a0776[0x0][_0x3de69d(0x12f)]==_0x3de69d(0xe6))var _0x595879=users[_0x3de69d(0xe6)];else{if(_0x1a0776[0x0][_0x3de69d(0x12f)]==_0x3de69d(0xda))var _0x595879=users['Portuguese'];else{if(_0x1a0776[0x0][_0x3de69d(0x12f)]==_0x3de69d(0xe7))var _0x595879=users[_0x3de69d(0xe7)];else{if(_0x1a0776[0x0]['language']=='Arabic\x20(ae)')var _0x595879=users[_0x3de69d(0x9d)];}}}}}}}const _0x11150a=getRandom8DigitNumber();_0x11150a[_0x3de69d(0xae)](_0x5b2160=>{var _0x45146e=_0x3de69d;_0x431ed5['render'](_0x45146e(0x111),{'success':_0x109d82[_0x45146e(0x14f)](_0x45146e(0x129)),'errors':_0x109d82[_0x45146e(0x14f)]('errors'),'role':_0xa63692,'profile':_0x5ea4f,'master_shop':_0x1a0776,'warehouse':_0x255aa3,'language':_0x595879,'invoice':_0x5b2160});})[_0x3de69d(0x10f)](_0x4f6bd3=>{var _0x15fcc5=_0x3de69d;_0x109d82[_0x15fcc5(0x14f)](_0x15fcc5(0x132),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x431ed5['redirect'](_0x15fcc5(0xff));});}catch(_0x5a5dd5){console[_0x3de69d(0xcc)](_0x5a5dd5);}}),router[a0_0x580683(0x115)](a0_0x580683(0xbf),auth,async(_0x185f26,_0x514c06)=>{var _0x4ccb67=a0_0x580683;try{const {date:_0x9fbd78,from_warehouse:_0x4d3127,FromRoom_name:_0x28500a,to_warehouse:_0x36bb8e,ToRoom_name:_0x2e2a00,prod_name:_0x17b7b0,from_prod_qty:_0x21722e,from_prod_level:_0x323155,from_prod_isle:_0x502053,from_prod_pallet:_0x452990,to_prod_qty:_0x3f739f,to_prod_level:_0x4ab188,to_prod_isle:_0x2125ae,to_prod_pallet:_0x11b280,primary_code:_0x35b048,secondary_code:_0x1d6aa6,product_code3:_0x2cc5ef,note:_0x24aa4b,MaxStocks_data2:_0x7fca6e,invoice:_0x2bec1f,expiry_date:_0x9162e5}=_0x185f26[_0x4ccb67(0x10e)];if(typeof _0x17b7b0==_0x4ccb67(0x147))var _0x53fdad=[_0x185f26[_0x4ccb67(0x10e)]['prod_name']],_0x4c3529=[_0x185f26[_0x4ccb67(0x10e)]['from_prod_qty']],_0x3f1a65=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x108)]],_0x1d9697=[_0x185f26[_0x4ccb67(0x10e)]['New_Qty_Converted']],_0x45cc52=[_0x185f26[_0x4ccb67(0x10e)]['to_prod_level']],_0x277044=[_0x185f26['body'][_0x4ccb67(0xd4)]],_0x3d30da=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x11d)]],_0x19d08c=[_0x185f26[_0x4ccb67(0x10e)]['product_code3']],_0x4fd890=[_0x185f26[_0x4ccb67(0x10e)]['MaxStocks_data2']],_0x2e609a=[_0x185f26[_0x4ccb67(0x10e)]['primary_unit']],_0x33b093=[_0x185f26['body'][_0x4ccb67(0xa2)]],_0x3ba7f5=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xaf)]],_0x556d4c=[_0x185f26[_0x4ccb67(0x10e)]['expiry_date']],_0x22ed66=[_0x185f26[_0x4ccb67(0x10e)]['product_date']],_0x59f40f=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x14e)]],_0xacd780=[_0x185f26['body'][_0x4ccb67(0x12a)]],_0x176059=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x142)]],_0x5be61e=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x152)]],_0x577102=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x150)]],_0x456d38=[_0x185f26['body']['from_invoice']],_0x40d4e5=[_0x185f26['body'][_0x4ccb67(0xad)]],_0x5a09c1=[_0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xa9)]];else var _0x53fdad=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x16c)]],_0x4c3529=[..._0x185f26[_0x4ccb67(0x10e)]['from_prod_qty']],_0x3f1a65=[..._0x185f26['body'][_0x4ccb67(0x108)]],_0x1d9697=[..._0x185f26['body'][_0x4ccb67(0xab)]],_0x45cc52=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xa7)]],_0x277044=[..._0x185f26['body'][_0x4ccb67(0xd4)]],_0x3d30da=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x11d)]],_0x19d08c=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xe0)]],_0x4fd890=[..._0x185f26[_0x4ccb67(0x10e)]['MaxStocks_data2']],_0x2e609a=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xcb)]],_0x33b093=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xa2)]],_0x3ba7f5=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xaf)]],_0x556d4c=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x110)]],_0x22ed66=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xc8)]],_0x59f40f=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x14e)]],_0xacd780=[..._0x185f26['body']['maxPerUnit']],_0x176059=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x142)]],_0x5be61e=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x152)]],_0x577102=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x150)]],_0x456d38=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0x109)]],_0x40d4e5=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xad)]],_0x5a09c1=[..._0x185f26[_0x4ccb67(0x10e)][_0x4ccb67(0xa9)]];const _0x44ad40=_0x53fdad[_0x4ccb67(0x162)](_0x473703=>{return _0x473703={'product_name':_0x473703};});_0x4c3529[_0x4ccb67(0x10a)]((_0x2d1ab5,_0x57a1b4)=>{var _0x5b4ab0=_0x4ccb67;_0x44ad40[_0x57a1b4][_0x5b4ab0(0x171)]=_0x2d1ab5;}),_0x3f1a65['forEach']((_0x3a94ff,_0x16a1b2)=>{var _0x4c3abd=_0x4ccb67;_0x44ad40[_0x16a1b2][_0x4c3abd(0x13f)]=_0x3a94ff;}),_0x5a09c1[_0x4ccb67(0x10a)]((_0x2e09dd,_0x230622)=>{var _0x223db9=_0x4ccb67;_0x44ad40[_0x230622][_0x223db9(0xa9)]=_0x2e09dd;}),_0x456d38[_0x4ccb67(0x10a)]((_0x5f0def,_0x1fbf87)=>{var _0x3c8a7e=_0x4ccb67;_0x44ad40[_0x1fbf87][_0x3c8a7e(0x109)]=_0x5f0def;}),_0x40d4e5['forEach']((_0x7801f1,_0x3a613a)=>{_0x44ad40[_0x3a613a]['To_invoice']=_0x7801f1;}),_0x1d9697[_0x4ccb67(0x10a)]((_0x2929ea,_0x7beb06)=>{var _0x54c3fd=_0x4ccb67;_0x44ad40[_0x7beb06][_0x54c3fd(0x97)]=_0x2929ea;}),_0x45cc52[_0x4ccb67(0x10a)]((_0x331cf0,_0x24d190)=>{var _0x271386=_0x4ccb67;_0x44ad40[_0x24d190][_0x271386(0x125)]=_0x331cf0;}),_0x277044['forEach']((_0x12d4e7,_0x22ec3d)=>{var _0x4af95e=_0x4ccb67;_0x44ad40[_0x22ec3d][_0x4af95e(0xd4)]=_0x12d4e7;}),_0x3d30da[_0x4ccb67(0x10a)]((_0x53b699,_0x59e6f1)=>{_0x44ad40[_0x59e6f1]['secondary_code']=_0x53b699;}),_0x19d08c[_0x4ccb67(0x10a)]((_0x414f83,_0x41c9d0)=>{_0x44ad40[_0x41c9d0]['product_code']=_0x414f83;}),_0x4fd890[_0x4ccb67(0x10a)]((_0x43479f,_0x35b43c)=>{var _0x406410=_0x4ccb67;_0x44ad40[_0x35b43c][_0x406410(0xdb)]=_0x43479f;}),_0x2e609a[_0x4ccb67(0x10a)]((_0xc0af3c,_0x529a62)=>{var _0x18f434=_0x4ccb67;_0x44ad40[_0x529a62][_0x18f434(0x16d)]=_0xc0af3c;}),_0x33b093['forEach']((_0x274afb,_0x1a87a2)=>{var _0x1b6b34=_0x4ccb67;_0x44ad40[_0x1a87a2][_0x1b6b34(0xa2)]=_0x274afb;}),_0x3ba7f5['forEach']((_0x1bc9d8,_0x20f655)=>{var _0x373491=_0x4ccb67;_0x44ad40[_0x20f655][_0x373491(0xaf)]=_0x1bc9d8;}),_0x556d4c['forEach']((_0x16ec8c,_0xcb697a)=>{var _0x49f1fa=_0x4ccb67;_0x44ad40[_0xcb697a][_0x49f1fa(0x110)]=_0x16ec8c;}),_0x22ed66['forEach']((_0x4010c5,_0xb73dc4)=>{_0x44ad40[_0xb73dc4]['production_date']=_0x4010c5;}),_0x59f40f[_0x4ccb67(0x10a)]((_0x44861e,_0x2cacad)=>{var _0x53aa4b=_0x4ccb67;_0x44ad40[_0x2cacad][_0x53aa4b(0xdb)]=_0x44861e;}),_0xacd780[_0x4ccb67(0x10a)]((_0x4a41ad,_0x346fc7)=>{var _0x1697df=_0x4ccb67;_0x44ad40[_0x346fc7][_0x1697df(0x12a)]=_0x4a41ad;}),_0x176059[_0x4ccb67(0x10a)]((_0x4651b2,_0x185fa7)=>{var _0x267c71=_0x4ccb67;_0x44ad40[_0x185fa7][_0x267c71(0x142)]=_0x4651b2;}),_0x5be61e[_0x4ccb67(0x10a)]((_0x439a64,_0x174845)=>{var _0x27b26a=_0x4ccb67;_0x44ad40[_0x174845][_0x27b26a(0x134)]=_0x439a64;}),_0x577102[_0x4ccb67(0x10a)]((_0x8abc24,_0x3628a0)=>{var _0x13551c=_0x4ccb67;_0x44ad40[_0x3628a0][_0x13551c(0xe4)]=_0x8abc24;});const _0x21d7dd=_0x44ad40[_0x4ccb67(0xca)](_0x1d3c31=>_0x1d3c31[_0x4ccb67(0x97)]!=='0'&&_0x1d3c31[_0x4ccb67(0x97)]!==''||_0x1d3c31[_0x4ccb67(0x107)]!=='0'&&_0x1d3c31[_0x4ccb67(0x107)]!=='');var _0x2114c1=0x0;_0x21d7dd[_0x4ccb67(0x10a)](_0x30a47d=>{var _0x14a231=_0x4ccb67;parseInt(_0x30a47d[_0x14a231(0x171)])<parseInt(_0x30a47d[_0x14a231(0x97)])&&_0x2114c1++;});if(_0x2114c1!=0x0)return _0x185f26[_0x4ccb67(0x14f)](_0x4ccb67(0x132),_0x4ccb67(0x159)),_0x514c06['redirect'](_0x4ccb67(0x10b));const _0x45e3f1=new transfers_finished({'date':_0x9fbd78,'from_warehouse':_0x4d3127,'to_warehouse':_0x36bb8e,'product':_0x21d7dd,'note':_0x24aa4b,'invoice':_0x2bec1f}),_0x4cbab8=await _0x45e3f1[_0x4ccb67(0xc3)]();_0x185f26[_0x4ccb67(0x14f)]('success','Product\x20Transfer\x20successfully'),_0x514c06[_0x4ccb67(0x15f)](_0x4ccb67(0x9b)+_0x4cbab8['_id']);}catch(_0x3452f5){console['log'](_0x3452f5),_0x514c06[_0x4ccb67(0xdd)](0xc8)[_0x4ccb67(0x133)]({'errorMessage':_0x3452f5['message']});}}),router['get'](a0_0x580683(0x166),auth,async(_0x5f1894,_0x49f7d5)=>{var _0x7bfbf7=a0_0x580683;try{const {username:_0x2d9152,email:_0x19022a,role:_0x509a32}=_0x5f1894[_0x7bfbf7(0x128)],_0x458a6b=_0x5f1894[_0x7bfbf7(0x128)],_0x5096be=await profile['findOne']({'email':_0x458a6b[_0x7bfbf7(0x113)]}),_0xdc2eb=await master_shop[_0x7bfbf7(0x160)](),_0x44729f=await transfers_finished[_0x7bfbf7(0x135)](_0x5f1894[_0x7bfbf7(0x146)]['id']);let _0x22523a;if(_0x458a6b['role']==_0x7bfbf7(0xe2)){const _0x2aa247=await staff[_0x7bfbf7(0x105)]({'email':_0x458a6b[_0x7bfbf7(0x113)]});_0x22523a=await warehouse[_0x7bfbf7(0x160)]({'status':_0x7bfbf7(0x11a),'name':_0x2aa247[_0x7bfbf7(0xb0)],'warehouse_category':'Finished\x20Goods'});}else _0x22523a=await warehouse[_0x7bfbf7(0x160)]({'status':_0x7bfbf7(0x11a),'warehouse_category':_0x7bfbf7(0x119)});const _0x5e33da=await warehouse[_0x7bfbf7(0x148)]([{'$match':{'name':_0x44729f[_0x7bfbf7(0xf8)],'warehouse_category':_0x7bfbf7(0x119)}},{'$unwind':_0x7bfbf7(0xfd)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x7bfbf7(0xe9)},'bay':{'$first':_0x7bfbf7(0xbe)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x7bfbf7(0xdf)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x7bfbf7(0x175)},'product_code':{'$first':_0x7bfbf7(0x151)},'storage':{'$first':_0x7bfbf7(0xd9)},'rack':{'$first':_0x7bfbf7(0xb8)},'expiry_date':{'$first':_0x7bfbf7(0xa3)},'production_date':{'$first':_0x7bfbf7(0xe1)},'room':{'$first':_0x7bfbf7(0x104)},'warehoue_name':{'$first':_0x7bfbf7(0xe5)}}}]),_0x95a2be=await product[_0x7bfbf7(0x160)]({});if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]==_0x7bfbf7(0xb2)){var _0x4da184=users[_0x7bfbf7(0xd8)];console['log'](_0x4da184);}else{if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]=='Hindi')var _0x4da184=users['Hindi'];else{if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]==_0x7bfbf7(0x9e))var _0x4da184=users[_0x7bfbf7(0x9e)];else{if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]==_0x7bfbf7(0xe3))var _0x4da184=users[_0x7bfbf7(0xe3)];else{if(_0xdc2eb[0x0]['language']=='French')var _0x4da184=users[_0x7bfbf7(0xe6)];else{if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]==_0x7bfbf7(0xda))var _0x4da184=users['Portuguese'];else{if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]==_0x7bfbf7(0xe7))var _0x4da184=users[_0x7bfbf7(0xe7)];else{if(_0xdc2eb[0x0][_0x7bfbf7(0x12f)]==_0x7bfbf7(0x13e))var _0x4da184=users['Arabic'];}}}}}}}_0x49f7d5[_0x7bfbf7(0xf1)](_0x7bfbf7(0x11c),{'success':_0x5f1894[_0x7bfbf7(0x14f)](_0x7bfbf7(0x129)),'errors':_0x5f1894[_0x7bfbf7(0x14f)](_0x7bfbf7(0x132)),'role':_0x458a6b,'profile':_0x5096be,'master_shop':_0xdc2eb,'warehouse':_0x22523a,'transfer':_0x44729f,'stock':_0x5e33da,'unit':_0x95a2be,'language':_0x4da184});}catch(_0x2f9d3e){console[_0x7bfbf7(0xcc)](_0x2f9d3e);}}),router['post'](a0_0x580683(0x166),auth,async(_0x56e986,_0x38aecc)=>{var _0x4fcf08=a0_0x580683;try{const {invoice:_0x12bf92,from_warehouse:_0x49f94b,FromRoom_name:_0x11a240,to_warehouse:_0x44a4e4,ToRoom_name:_0x2d40c9}=_0x56e986[_0x4fcf08(0x10e)],_0x103004=await transfers_finished['findById'](_0x56e986['params']['id']),_0x47a4ec=_0x103004[_0x4fcf08(0x16a)][_0x4fcf08(0x162)](async _0x211a1a=>{var _0x532896=_0x4fcf08;if(_0x211a1a[_0x532896(0x97)]>0x0){var _0x3567fa=await warehouse[_0x532896(0x105)]({'name':_0x49f94b,'room':_0x211a1a[_0x532896(0x134)],'warehouse_category':_0x532896(0x119)});const _0x3fc38e=_0x3567fa[_0x532896(0xac)][_0x532896(0x162)](_0x3ba9ea=>{var _0x54c9c2=_0x532896;_0x3ba9ea[_0x54c9c2(0xde)]==_0x211a1a[_0x54c9c2(0xde)]&&_0x3ba9ea[_0x54c9c2(0x101)]==_0x211a1a[_0x54c9c2(0x13f)]&&_0x3ba9ea['expiry_date']==_0x211a1a[_0x54c9c2(0x110)]&&_0x3ba9ea[_0x54c9c2(0xe8)]==_0x211a1a[_0x54c9c2(0xe8)]&&_0x3ba9ea[_0x54c9c2(0xaf)]==_0x211a1a[_0x54c9c2(0xaf)]&&_0x3ba9ea['invoice']==_0x211a1a[_0x54c9c2(0x109)]&&(console['log'](_0x54c9c2(0x14b),_0x3ba9ea[_0x54c9c2(0x154)]),typeof _0x211a1a[_0x54c9c2(0xa9)]==_0x54c9c2(0xb3)?_0x3ba9ea[_0x54c9c2(0x154)]=Math[_0x54c9c2(0xd5)](0x0,Math[_0x54c9c2(0x145)](_0x3ba9ea[_0x54c9c2(0x154)])-Math['abs'](_0x211a1a[_0x54c9c2(0x97)])):_0x3ba9ea['product_stock']=Math[_0x54c9c2(0xd5)](0x0,Math[_0x54c9c2(0x145)](_0x3ba9ea[_0x54c9c2(0x154)])-Math[_0x54c9c2(0x145)](_0x211a1a[_0x54c9c2(0x97)])));});}return _0x3567fa;});Promise['all'](_0x47a4ec)[_0x4fcf08(0xae)](async _0x8c9664=>{var _0x5a066d=_0x4fcf08;try{for(const _0xa9f40c of _0x8c9664){await _0xa9f40c[_0x5a066d(0xc3)]();}const _0x189d7e=_0x103004[_0x5a066d(0x16a)][_0x5a066d(0x162)](async _0x459fbb=>{var _0x2d46d8=_0x5a066d,_0x2b8168=await warehouse[_0x2d46d8(0x105)]({'name':_0x44a4e4,'room':_0x459fbb[_0x2d46d8(0xe4)]});if(_0x459fbb[_0x2d46d8(0x97)]>0x0){var _0x150d82=0x0;const _0x4681e4=_0x2b8168['product_details'][_0x2d46d8(0x162)](_0x5d6dc9=>{var _0x50096=_0x2d46d8;_0x5d6dc9[_0x50096(0xde)]==_0x459fbb[_0x50096(0xde)]&&_0x5d6dc9[_0x50096(0x101)]==_0x459fbb[_0x50096(0x125)]&&_0x5d6dc9[_0x50096(0x110)]==_0x459fbb[_0x50096(0x110)]&&_0x5d6dc9['production_date']==_0x459fbb[_0x50096(0xe8)]&&_0x5d6dc9[_0x50096(0xaf)]==_0x459fbb['batch_code']&&_0x5d6dc9[_0x50096(0x173)]==_0x459fbb['To_invoice']&&(typeof _0x459fbb['id_transaction']==_0x50096(0xb3)?(console['log'](_0x50096(0x163),_0x5d6dc9[_0x50096(0x154)]+_0x50096(0xb6)+_0x5d6dc9[_0x50096(0xfb)]+_0x50096(0xa5)+Math[_0x50096(0x145)](_0x5d6dc9[_0x50096(0x154)])+Math[_0x50096(0x145)](_0x459fbb[_0x50096(0x97)])),_0x5d6dc9[_0x50096(0x154)]=Math[_0x50096(0x145)](_0x5d6dc9[_0x50096(0x154)])+Math['abs'](_0x459fbb[_0x50096(0x97)])):_0x5d6dc9[_0x50096(0x154)]=Math[_0x50096(0x145)](_0x5d6dc9[_0x50096(0x154)])+Math['abs'](_0x459fbb['to_quantity']),_0x150d82++);});_0x150d82=='0'&&(_0x2b8168['product_details']=_0x2b8168[_0x2d46d8(0xac)][_0x2d46d8(0xb5)]({'product_name':_0x459fbb['product_name'],'product_stock':_0x459fbb[_0x2d46d8(0x97)],'bay':_0x459fbb[_0x2d46d8(0x125)],'product_code':_0x459fbb[_0x2d46d8(0x167)],'primary_code':_0x459fbb[_0x2d46d8(0xd4)],'secondary_code':_0x459fbb[_0x2d46d8(0x11d)],'expiry_date':_0x459fbb[_0x2d46d8(0x110)],'production_date':_0x459fbb[_0x2d46d8(0xe8)],'maxProducts':_0x459fbb[_0x2d46d8(0xdb)],'batch_code':_0x459fbb[_0x2d46d8(0xaf)],'secondary_unit':_0x459fbb[_0x2d46d8(0xa2)],'unit':_0x459fbb[_0x2d46d8(0x16d)],'maxProducts':_0x459fbb[_0x2d46d8(0xdb)],'maxPerUnit':_0x459fbb[_0x2d46d8(0x12a)],'invoice':_0x459fbb[_0x2d46d8(0x15e)]}));}return _0x2b8168;});Promise[_0x5a066d(0xec)](_0x189d7e)[_0x5a066d(0xae)](async _0x1b0075=>{var _0x261fcd=_0x5a066d;try{for(const _0x2f9ef8 of _0x1b0075){await warehouse[_0x261fcd(0x153)]({'_id':_0x2f9ef8['_id']},{'$addToSet':{'product_details':{'$each':_0x2f9ef8['product_details']}}});}_0x103004['finalize']=_0x261fcd(0xf7);const _0x344159=await _0x103004[_0x261fcd(0xc3)](),_0x128f0c=await master_shop[_0x261fcd(0x160)](),_0x39ed4d=await email_settings[_0x261fcd(0x105)](),_0x2be516=await supervisor_settings['find']();var _0x317f1d=_0x103004['product'],_0x2351db='',_0x2f175e;for(_0x2f175e in _0x317f1d){var _0x9545f0='FG';_0x103004['to_warehouse']==_0x261fcd(0x156)&&(_0x9545f0='DG'),_0x2351db+='<tr>'+_0x261fcd(0x137)+_0x317f1d[_0x2f175e][_0x261fcd(0xde)]+_0x261fcd(0xeb)+_0x261fcd(0x137)+_0x317f1d[_0x2f175e][_0x261fcd(0x167)]+_0x261fcd(0xeb)+_0x261fcd(0x137)+_0x317f1d[_0x2f175e][_0x261fcd(0x97)]+_0x261fcd(0xeb)+_0x261fcd(0x137)+_0x317f1d[_0x2f175e][_0x261fcd(0x16d)]+_0x261fcd(0xeb)+_0x261fcd(0x137)+_0x317f1d[_0x2f175e][_0x261fcd(0xa2)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x103004[_0x261fcd(0x170)]+_0x261fcd(0xeb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x317f1d[_0x2f175e][_0x261fcd(0xe4)]+_0x261fcd(0xeb)+_0x261fcd(0x137)+_0x9545f0+_0x317f1d[_0x2f175e][_0x261fcd(0x125)]+_0x261fcd(0xeb)+_0x261fcd(0xd2);}let _0x37f4fe=nodemailer[_0x261fcd(0x112)]({'host':_0x39ed4d[_0x261fcd(0x15c)],'port':Number(_0x39ed4d[_0x261fcd(0x126)]),'secure':![],'auth':{'user':_0x39ed4d[_0x261fcd(0x113)],'pass':_0x39ed4d['password']}}),_0x1c879f={'from':_0x39ed4d[_0x261fcd(0x113)],'to':_0x2be516[0x0]['FGSEmail'],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x261fcd(0xa1),'path':__dirname+_0x261fcd(0x106)+'/upload/'+_0x128f0c[0x0][_0x261fcd(0x11b)],'cid':_0x261fcd(0xf4)}],'html':'<!DOCTYPE\x20html>'+_0x261fcd(0x12d)+_0x261fcd(0xfe)+'<div>'+_0x261fcd(0xd1)+_0x261fcd(0xc2)+_0x261fcd(0xa0)+'</div>'+_0x261fcd(0xc2)+_0x261fcd(0x123)+_0x128f0c[0x0][_0x261fcd(0xfc)]+_0x261fcd(0xbd)+_0x261fcd(0x122)+'</div>'+_0x261fcd(0xa6)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x103004['invoice']+'\x20'+_0x261fcd(0x161)+_0x261fcd(0x157)+_0x103004[_0x261fcd(0xc7)]+'\x20'+_0x261fcd(0xc6)+_0x261fcd(0xa8)+_0x261fcd(0x122)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x261fcd(0x149)+_0x261fcd(0x143)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x261fcd(0xd7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x261fcd(0xf9)+_0x261fcd(0xf6)+_0x261fcd(0xd6)+_0x261fcd(0xf0)+_0x261fcd(0xd2)+_0x261fcd(0x16b)+_0x261fcd(0x165)+'\x20'+_0x2351db+'\x20'+_0x261fcd(0x116)+_0x261fcd(0x120)+_0x261fcd(0xc2)+_0x261fcd(0x114)+'<h5>'+_0x128f0c[0x0][_0x261fcd(0xfc)]+_0x261fcd(0xa8)+'</div>'+_0x261fcd(0x122)+'</body></html>'};_0x37f4fe[_0x261fcd(0x158)](_0x1c879f,function(_0x15d900,_0x1db06c){var _0x5ad6f5=_0x261fcd;_0x15d900?(console['log'](_0x15d900),console[_0x5ad6f5(0xcc)](_0x5ad6f5(0x138))):console['log']('Email\x20sent\x20successfully');}),_0x56e986[_0x261fcd(0x14f)](_0x261fcd(0x129),'Transfer\x20Finalize\x20Successfully'),_0x38aecc[_0x261fcd(0x15f)](_0x261fcd(0xc1)+_0x344159[_0x261fcd(0xfb)]);}catch(_0x4eb044){console[_0x261fcd(0xd3)](_0x4eb044),_0x38aecc[_0x261fcd(0xdd)](0x1f4)['json']({'error':_0x261fcd(0xc5)});}})[_0x5a066d(0x10f)](_0x4dbb3e=>{var _0x2a61f9=_0x5a066d;console[_0x2a61f9(0xd3)](_0x4dbb3e),_0x38aecc[_0x2a61f9(0xdd)](0x1f4)['json']({'error':_0x2a61f9(0xcf)});});}catch(_0xa6abab){console['error'](_0xa6abab),_0x38aecc[_0x5a066d(0xdd)](0x1f4)[_0x5a066d(0x133)]({'error':_0x5a066d(0xbb)});}})[_0x4fcf08(0x10f)](_0x482554=>{var _0x290d8e=_0x4fcf08;console[_0x290d8e(0xd3)](_0x482554),_0x38aecc['status'](0x1f4)[_0x290d8e(0x133)]({'error':_0x290d8e(0xcf)});});}catch(_0x1e3b56){_0x38aecc['json']({'message':_0x1e3b56['message']});}});function BayBinSelected(_0x3cd40f,_0x2fa7ad){var _0x4ef949=a0_0x580683,_0x514869=[];let _0x1203f4=[];var _0x4ddd19=[];if(_0x3cd40f==_0x4ef949(0x156)){switch(_0x2fa7ad){case _0x4ef949(0x136):_0x514869=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x514869=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4ddd19=['DG'];}else{if(_0x3cd40f==_0x4ef949(0x121)){switch(_0x2fa7ad){case _0x4ef949(0x136):_0x514869=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4ef949(0x13a):_0x514869=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4ddd19=['FG'];}}return{'levels':_0x514869,'identify':_0x4ddd19};}router[a0_0x580683(0xf5)](a0_0x580683(0xef),auth,async(_0x4be456,_0x577659)=>{var _0x548767=a0_0x580683;try{const {username:_0x201687,email:_0x12eeeb,role:_0x9d374e}=_0x4be456[_0x548767(0x128)],_0x4618d6=_0x4be456[_0x548767(0x128)],_0x2c3275=await profile[_0x548767(0x105)]({'email':_0x4618d6[_0x548767(0x113)]}),_0x20fd1b=await master_shop[_0x548767(0x160)](),_0x4b3240=await transfers_finished['findById'](_0x4be456[_0x548767(0x146)]['id']);let _0x409b74=new Date(_0x4b3240[_0x548767(0x110)]),_0x387d68=('0'+_0x409b74['getDate']())[_0x548767(0x15b)](-0x2),_0x5a46fe=('0'+(_0x409b74['getMonth']()+0x1))[_0x548767(0x15b)](-0x2),_0x4e9402=_0x409b74[_0x548767(0x15a)](),_0x2cee0c=_0x4e9402+'-'+_0x5a46fe+'-'+_0x387d68,_0x5eac26;if(_0x4618d6[_0x548767(0xc9)]==_0x548767(0xe2)){const _0x4bf9e9=await staff['findOne']({'email':_0x4618d6[_0x548767(0x113)]});_0x5eac26=await warehouse[_0x548767(0x160)]({'status':_0x548767(0x11a),'name':_0x4bf9e9[_0x548767(0xb0)],'warehouse_category':_0x548767(0x119)});}else _0x5eac26=await warehouse[_0x548767(0x160)]({'status':_0x548767(0x11a),'warehouse_category':_0x548767(0x119)});const _0x545b32=await warehouse['aggregate']([{'$match':{'name':_0x4b3240[_0x548767(0xf8)],'room':_0x4b3240[_0x548767(0x144)]}},{'$unwind':_0x548767(0xfd)},{'$group':{'_id':_0x548767(0x127),'name':{'$first':_0x548767(0xce)},'product_stock':{'$first':_0x548767(0xe9)},'bay':{'$first':_0x548767(0xbe)},'bin':{'$first':_0x548767(0x100)},'type':{'$first':_0x548767(0xdf)},'floorlevel':{'$first':_0x548767(0xaa)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x548767(0x175)},'product_code':{'$first':_0x548767(0x151)},'storage':{'$first':_0x548767(0xd9)},'rack':{'$first':'$product_details.rack'}}}]);var _0x14e146=[0x1,0x2,0x3,0x4],_0x3eb7df=['A','B','C','D','E','F','G','H','I','J'],_0x65058f=[_0x548767(0x16f),_0x548767(0x11f)];const _0x96a7f0=await product[_0x548767(0x160)]({}),_0x2b1e1b=BayBinSelected(_0x4b3240['to_warehouse'],_0x4b3240[_0x548767(0x124)]);if(_0x20fd1b[0x0]['language']=='English\x20(US)'){var _0x1344f6=users[_0x548767(0xd8)];console[_0x548767(0xcc)](_0x1344f6);}else{if(_0x20fd1b[0x0][_0x548767(0x12f)]=='Hindi')var _0x1344f6=users[_0x548767(0x15d)];else{if(_0x20fd1b[0x0][_0x548767(0x12f)]=='German')var _0x1344f6=users[_0x548767(0x9e)];else{if(_0x20fd1b[0x0][_0x548767(0x12f)]==_0x548767(0xe3))var _0x1344f6=users[_0x548767(0xe3)];else{if(_0x20fd1b[0x0]['language']==_0x548767(0xe6))var _0x1344f6=users['French'];else{if(_0x20fd1b[0x0][_0x548767(0x12f)]==_0x548767(0xda))var _0x1344f6=users[_0x548767(0xdc)];else{if(_0x20fd1b[0x0]['language']==_0x548767(0xe7))var _0x1344f6=users['Chinese'];else{if(_0x20fd1b[0x0][_0x548767(0x12f)]=='Arabic\x20(ae)')var _0x1344f6=users[_0x548767(0x9d)];}}}}}}}_0x577659[_0x548767(0xf1)](_0x548767(0x141),{'success':_0x4be456[_0x548767(0x14f)](_0x548767(0x129)),'errors':_0x4be456[_0x548767(0x14f)]('errors'),'role':_0x4618d6,'profile':_0x2c3275,'master_shop':_0x20fd1b,'warehouse':_0x5eac26,'transfer':_0x4b3240,'stock':_0x545b32,'unit':_0x96a7f0,'language':_0x1344f6,'levels':_0x14e146,'Isle':_0x3eb7df,'rooms_data':_0x65058f,'ed_fullDate':_0x2cee0c,'dataSelected':_0x2b1e1b});}catch(_0x3a4eea){console[_0x548767(0xcc)](_0x3a4eea);}}),router['post'](a0_0x580683(0xef),auth,async(_0x411ba5,_0x16b85b)=>{var _0x426a68=a0_0x580683;try{const _0x3ca3fb=_0x411ba5[_0x426a68(0x146)]['id'];console[_0x426a68(0xcc)](_0x411ba5[_0x426a68(0x10e)]);const _0x42a6cc=await transfers_finished[_0x426a68(0x135)](_0x3ca3fb);console[_0x426a68(0xcc)](_0x426a68(0x139),_0x42a6cc);const {date:_0x4290fc,from_warehouse:_0xbc85c0,FromRoom_name:_0xe87340,to_warehouse:_0x9fdd15,ToRoom_name:_0x35500b,prod_name:_0x6526dd,from_prod_qty:_0x471eef,from_prod_level:_0x3d5d70,from_prod_isle:_0x10433e,from_prod_pallet:_0x4bcd84,to_prod_qty:_0x44be4b,to_prod_level:_0x5942fa,to_prod_isle:_0x8a2876,to_prod_pallet:_0x57970a,primary_code:_0x4e8ce7,secondary_code:_0x3c3f2d,product_code3:_0x4372a7,note:_0x81ea62,invoice:_0x380e38,expiry_date:_0x467c8c}=_0x411ba5[_0x426a68(0x10e)];if(typeof _0x6526dd==_0x426a68(0x147))var _0x3a072d=[_0x411ba5['body']['prod_name']],_0x1509e4=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0x13c)]],_0x48a178=[_0x411ba5[_0x426a68(0x10e)]['from_prod_level']],_0x36d8fc=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0x14d)]],_0x24e251=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0xa7)]],_0x40b190=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0xd4)]],_0x315a46=[_0x411ba5['body'][_0x426a68(0x11d)]],_0x266ed4=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0xe0)]],_0x251a99=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0x155)]],_0x5c006c=[_0x411ba5[_0x426a68(0x10e)][_0x426a68(0x16d)]],_0x3abe7d=[_0x411ba5['body']['secondary_unit']],_0x415b8c=[_0x411ba5[_0x426a68(0x10e)]['batch_code']],_0x4d141c=[_0x411ba5[_0x426a68(0x10e)]['expiry_date']];else var _0x3a072d=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x16c)]],_0x1509e4=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x13c)]],_0x48a178=[..._0x411ba5[_0x426a68(0x10e)]['from_prod_level']],_0x36d8fc=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x14d)]],_0x24e251=[..._0x411ba5[_0x426a68(0x10e)]['to_prod_level']],_0x40b190=[..._0x411ba5[_0x426a68(0x10e)]['primary_code']],_0x315a46=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x11d)]],_0x266ed4=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0xe0)]],_0x251a99=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x155)]],_0x5c006c=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x16d)]],_0x3abe7d=[..._0x411ba5[_0x426a68(0x10e)]['secondary_unit']],_0x415b8c=[..._0x411ba5[_0x426a68(0x10e)]['batch_code']],_0x4d141c=[..._0x411ba5[_0x426a68(0x10e)][_0x426a68(0x110)]];const _0x30bf72=_0x3a072d[_0x426a68(0x162)](_0x381559=>{return _0x381559={'product_name':_0x381559};});_0x1509e4['forEach']((_0x2739be,_0x532d57)=>{_0x30bf72[_0x532d57]['from_quantity']=_0x2739be;}),_0x48a178[_0x426a68(0x10a)]((_0x40228f,_0x2da0c5)=>{_0x30bf72[_0x2da0c5]['from_bay']=_0x40228f;}),_0x36d8fc[_0x426a68(0x10a)]((_0x1f0295,_0x49259c)=>{var _0x76ea5b=_0x426a68;_0x30bf72[_0x49259c][_0x76ea5b(0x97)]=_0x1f0295;}),_0x24e251[_0x426a68(0x10a)]((_0x57d4b9,_0x164d94)=>{var _0x2ed9ab=_0x426a68;_0x30bf72[_0x164d94][_0x2ed9ab(0x125)]=_0x57d4b9;}),_0x40b190[_0x426a68(0x10a)]((_0x50b2c6,_0x53bd09)=>{_0x30bf72[_0x53bd09]['primary_code']=_0x50b2c6;}),_0x315a46[_0x426a68(0x10a)]((_0x2b655c,_0x324440)=>{var _0x3bf385=_0x426a68;_0x30bf72[_0x324440][_0x3bf385(0x11d)]=_0x2b655c;}),_0x266ed4[_0x426a68(0x10a)]((_0x44e128,_0x23e756)=>{var _0x57f1ca=_0x426a68;_0x30bf72[_0x23e756][_0x57f1ca(0x167)]=_0x44e128;}),_0x251a99[_0x426a68(0x10a)]((_0x2ee831,_0x594173)=>{var _0x3ac05b=_0x426a68;_0x30bf72[_0x594173][_0x3ac05b(0xdb)]=_0x2ee831;}),_0x5c006c[_0x426a68(0x10a)]((_0xe89c66,_0x2eb68e)=>{var _0x26e0b1=_0x426a68;_0x30bf72[_0x2eb68e][_0x26e0b1(0x16d)]=_0xe89c66;}),_0x3abe7d[_0x426a68(0x10a)]((_0x1a5094,_0x3d7590)=>{var _0x3315dd=_0x426a68;_0x30bf72[_0x3d7590][_0x3315dd(0xa2)]=_0x1a5094;}),_0x415b8c['forEach']((_0x877580,_0x275a2d)=>{_0x30bf72[_0x275a2d]['batch_code']=_0x877580;}),_0x4d141c[_0x426a68(0x10a)]((_0x20c066,_0xa3042)=>{var _0x4d7339=_0x426a68;_0x30bf72[_0xa3042][_0x4d7339(0x110)]=_0x20c066;});const _0x3ad82e=_0x30bf72['filter'](_0x555bc6=>_0x555bc6[_0x426a68(0x97)]!=='0'&&_0x555bc6[_0x426a68(0x97)]!==''||_0x555bc6[_0x426a68(0x107)]!=='0'&&_0x555bc6[_0x426a68(0x107)]!=='');var _0x36bb73=0x0;_0x3ad82e[_0x426a68(0x10a)](_0x143c82=>{var _0x31cf5a=_0x426a68;parseInt(_0x143c82[_0x31cf5a(0x171)])<parseInt(_0x143c82[_0x31cf5a(0x97)])&&_0x36bb73++;});if(_0x36bb73!=0x0)return _0x411ba5[_0x426a68(0x14f)](_0x426a68(0x132),_0x426a68(0x159)),_0x16b85b[_0x426a68(0x15f)](_0x426a68(0x10b));const _0x1153f7=await warehouse[_0x426a68(0x105)]({'name':_0x42a6cc[_0x426a68(0xf8)],'room':_0x42a6cc[_0x426a68(0x144)]});_0x42a6cc[_0x426a68(0x16a)][_0x426a68(0x10a)](_0xb33a32=>{var _0x592f13=_0x426a68;if(_0xb33a32[_0x592f13(0x97)]>0x0){const _0x46a680=_0x1153f7[_0x592f13(0xac)][_0x592f13(0x162)](_0x2e805b=>{var _0x3bdb6b=_0x592f13;_0x2e805b[_0x3bdb6b(0xde)]==_0xb33a32[_0x3bdb6b(0xde)]&&_0x2e805b[_0x3bdb6b(0x101)]==_0xb33a32[_0x3bdb6b(0x13f)]&&(_0x2e805b[_0x3bdb6b(0x154)]=parseInt(_0x2e805b['product_stock'])+parseInt(_0xb33a32['to_quantity']));});}}),await _0x1153f7['save']();const _0x20eb75=await warehouse[_0x426a68(0x105)]({'name':_0x42a6cc['to_warehouse'],'room':_0x42a6cc[_0x426a68(0x124)]});_0x42a6cc[_0x426a68(0x16a)]['forEach'](_0x50bd8e=>{var _0x2bfed9=_0x426a68;if(_0x50bd8e['to_quantity']>0x0){const _0x4fd7ec=_0x20eb75[_0x2bfed9(0xac)][_0x2bfed9(0x162)](_0x3ffb90=>{var _0x244f91=_0x2bfed9;_0x3ffb90[_0x244f91(0xde)]==_0x50bd8e['product_name']&&_0x3ffb90['bay']==_0x50bd8e[_0x244f91(0x125)]&&(_0x3ffb90[_0x244f91(0x154)]=parseInt(_0x3ffb90[_0x244f91(0x154)])-parseInt(_0x50bd8e[_0x244f91(0x97)]));});}}),await _0x20eb75[_0x426a68(0xc3)](),_0x42a6cc['date']=_0x4290fc,_0x42a6cc['from_warehouse']=_0xbc85c0,_0x42a6cc[_0x426a68(0x170)]=_0x9fdd15,_0x42a6cc[_0x426a68(0x16a)]=_0x3ad82e,_0x42a6cc[_0x426a68(0xb7)]=_0x81ea62,_0x42a6cc['invoice']=_0x380e38;const _0x74ad36=await _0x42a6cc[_0x426a68(0xc3)](),_0x2bd9f1=await warehouse[_0x426a68(0x105)]({'name':_0xbc85c0,'room':_0xe87340});_0x74ad36[_0x426a68(0x16a)]['forEach'](_0x504e14=>{var _0x52c752=_0x426a68;if(_0x504e14['to_quantity']>0x0){const _0x38eeeb=_0x2bd9f1['product_details'][_0x52c752(0x162)](_0x530407=>{var _0x47ec04=_0x52c752;_0x530407[_0x47ec04(0xde)]==_0x504e14[_0x47ec04(0xde)]&&_0x530407[_0x47ec04(0x101)]==_0x504e14[_0x47ec04(0x13f)]&&(_0x530407[_0x47ec04(0x154)]=parseInt(_0x530407[_0x47ec04(0x154)])-parseInt(_0x504e14['to_quantity']));});}}),await _0x2bd9f1['save']();const _0x39314b=await warehouse['findOne']({'name':_0x9fdd15,'room':_0x35500b});_0x74ad36[_0x426a68(0x16a)][_0x426a68(0x10a)](_0x2fc1dc=>{var _0x38f05d=_0x426a68;if(_0x2fc1dc['to_quantity']>0x0){var _0x4acc73=0x0;const _0x5a5830=_0x39314b[_0x38f05d(0xac)][_0x38f05d(0x162)](_0x157f90=>{var _0x1c1eb2=_0x38f05d;_0x157f90[_0x1c1eb2(0xde)]==_0x2fc1dc[_0x1c1eb2(0xde)]&&_0x157f90[_0x1c1eb2(0x101)]==_0x2fc1dc[_0x1c1eb2(0x125)]&&(_0x157f90[_0x1c1eb2(0x154)]=parseInt(_0x157f90[_0x1c1eb2(0x154)])+parseInt(_0x2fc1dc[_0x1c1eb2(0x97)]),_0x4acc73++);});_0x4acc73=='0'&&(_0x39314b[_0x38f05d(0xac)]=_0x39314b[_0x38f05d(0xac)]['concat']({'product_name':_0x2fc1dc[_0x38f05d(0xde)],'product_stock':_0x2fc1dc[_0x38f05d(0x97)],'bay':_0x2fc1dc[_0x38f05d(0x125)],'product_code':_0x2fc1dc['product_code'],'primary_code':_0x2fc1dc['primary_code'],'secondary_code':_0x2fc1dc[_0x38f05d(0x11d)],'maxProducts':_0x2fc1dc[_0x38f05d(0xdb)]}));}}),await _0x39314b[_0x426a68(0xc3)](),_0x411ba5[_0x426a68(0x14f)](_0x426a68(0x129),_0x426a68(0xbc)),_0x16b85b[_0x426a68(0x15f)]('/transfer_finished/view');}catch(_0x2912cf){console[_0x426a68(0xcc)](_0x2912cf);}}),router[a0_0x580683(0x115)](a0_0x580683(0x131),async(_0x16d14c,_0x4c3417)=>{var _0x30c914=a0_0x580683;const {FromWareHouse:_0x19460f,FromRoom:_0x58330d,ToWarehouse:_0x1e55bd,ToRoom:_0x3a8ad2,primary_code:_0x10bbe4,Roomslist:_0x2b1921}=_0x16d14c['body'],_0x1d84a3=_0x2b1921[_0x30c914(0x118)](','),_0x29fc0c=[];async function _0x308830(_0x4efa6d){var _0x1ac54e=_0x30c914;const _0x24f7e3=await warehouse[_0x1ac54e(0x148)]([{'$match':{'name':_0x19460f,'room':_0x4efa6d}},{'$unwind':_0x1ac54e(0xfd)},{'$match':{'product_details.primary_code':_0x10bbe4}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1ac54e(0xce)},'instock':{'$first':_0x1ac54e(0xe9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1ac54e(0x175)},'product_code':{'$first':_0x1ac54e(0x151)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1ac54e(0x100)},'type':{'$first':_0x1ac54e(0xdf)},'pallet':{'$first':_0x1ac54e(0xaa)},'unit':{'$first':_0x1ac54e(0xba)},'secondary_unit':{'$first':_0x1ac54e(0x13b)},'storage':{'$first':_0x1ac54e(0xd9)},'rack':{'$first':_0x1ac54e(0xb8)},'expiry_date':{'$first':_0x1ac54e(0xa3)},'production_date':{'$first':_0x1ac54e(0xe1)},'batch_code':{'$first':_0x1ac54e(0x16e)},'maxPerUnit':{'$first':_0x1ac54e(0x11e)},'roomNamed':{'$first':_0x1ac54e(0x104)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x541b3b=await warehouse[_0x1ac54e(0x148)]([{'$match':{'name':_0x19460f,'room':_0x4efa6d}},{'$unwind':_0x1ac54e(0xfd)},{'$match':{'product_details.secondary_code':_0x10bbe4}},{'$group':{'_id':_0x1ac54e(0x127),'name':{'$first':_0x1ac54e(0xce)},'instock':{'$first':_0x1ac54e(0xe9)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1ac54e(0x151)},'level':{'$first':_0x1ac54e(0xbe)},'isle':{'$first':_0x1ac54e(0x100)},'type':{'$first':_0x1ac54e(0xdf)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1ac54e(0xba)},'secondary_unit':{'$first':_0x1ac54e(0x13b)},'storage':{'$first':_0x1ac54e(0xd9)},'rack':{'$first':_0x1ac54e(0xb8)},'expiry_date':{'$first':_0x1ac54e(0xa3)},'production_date':{'$first':_0x1ac54e(0xe1)},'batch_code':{'$first':_0x1ac54e(0x16e)},'maxPerUnit':{'$first':_0x1ac54e(0x11e)},'roomNamed':{'$first':_0x1ac54e(0x104)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x1ac54e(0x14c)}}}]);if(_0x24f7e3[_0x1ac54e(0xf3)]>0x0)_0x29fc0c[_0x1ac54e(0x9a)](_0x24f7e3);else _0x541b3b[_0x1ac54e(0xf3)]>0x0&&_0x29fc0c[_0x1ac54e(0x9a)](_0x541b3b);}const _0x289497=_0x1d84a3['map'](_0x573074=>_0x308830(_0x573074));await Promise[_0x30c914(0xec)](_0x289497),_0x4c3417['json'](_0x29fc0c);}),router['post'](a0_0x580683(0x14a),async(_0x1e7563,_0x1baf8f)=>{var _0x493b2c=a0_0x580683;try{const {FromWareHouse:_0x214222,FromRoom:_0x1d664,ToWarehouse:_0x1a81e2,ToRoom:_0x44efb2,secondary_code:_0x153af3}=_0x1e7563['body'],_0x58c06f=await warehouse['aggregate']([{'$match':{'name':_0x214222}},{'$unwind':_0x493b2c(0xfd)},{'$match':{'product_details.secondary_code':_0x153af3}},{'$group':{'_id':_0x493b2c(0x127),'name':{'$first':_0x493b2c(0xce)},'primary_code':{'$first':_0x493b2c(0x169)},'secondary_code':{'$first':_0x493b2c(0x175)},'product_code':{'$first':_0x493b2c(0x151)},'instock':{'$first':_0x493b2c(0xe9)},'warehouse':{'$first':_0x493b2c(0xe5)},'level':{'$first':_0x493b2c(0x12c)},'isle':{'$first':_0x493b2c(0x99)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x493b2c(0xf2)},'unit':{'$first':_0x493b2c(0xba)},'expiry_date':{'$first':_0x493b2c(0xa3)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x1baf8f[_0x493b2c(0xdd)](0xc8)[_0x493b2c(0x133)](_0x58c06f);}catch(_0x19f396){_0x1baf8f[_0x493b2c(0xdd)](0x194)['json']({'message':_0x19f396['message']});}}),router[a0_0x580683(0x115)](a0_0x580683(0xc4),async(_0x705299,_0x126f63)=>{var _0x5915d1=a0_0x580683;try{const {FromWareHouse:_0xe35f43,FromRoom:_0x244a4e,ToWarehouse:_0x276372,ToRoom:_0x14a1f2,product_code:_0xcbd934}=_0x705299[_0x5915d1(0x10e)],_0x4b494b=await warehouse[_0x5915d1(0x148)]([{'$match':{'name':_0xe35f43}},{'$unwind':_0x5915d1(0xfd)},{'$match':{'product_details.product_code':_0xcbd934}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5915d1(0xce)},'primary_code':{'$first':_0x5915d1(0x169)},'secondary_code':{'$first':_0x5915d1(0x175)},'product_code':{'$first':_0x5915d1(0x151)},'instock':{'$first':_0x5915d1(0xe9)},'warehouse':{'$first':_0x5915d1(0xe5)},'level':{'$first':_0x5915d1(0x12c)},'isle':{'$first':_0x5915d1(0x99)},'pallet':{'$first':_0x5915d1(0x12b)},'maxProducts':{'$first':_0x5915d1(0xf2)},'unit':{'$first':'$product_details.unit'}}}]);_0x126f63['status'](0xc8)['json'](_0x4b494b);}catch(_0xdda53d){_0x126f63[_0x5915d1(0xdd)](0x194)['json']({'message':_0xdda53d[_0x5915d1(0xd0)]});}}),router[a0_0x580683(0x115)](a0_0x580683(0x13d),async(_0x33cbd5,_0x396b86)=>{var _0x3f8d5c=a0_0x580683;const {productCode:_0x690180,bay:_0x164a6a,warehouses:_0x11b255,room:_0x32fdf2}=_0x33cbd5[_0x3f8d5c(0x10e)];console[_0x3f8d5c(0xcc)](_0x33cbd5['body']);try{const _0x4eb59e=await warehouse[_0x3f8d5c(0x148)]([{'$match':{'name':_0x11b255,'room':_0x32fdf2}},{'$unwind':_0x3f8d5c(0xfd)},{'$match':{'product_details.bay':parseInt(_0x164a6a)}},{'$group':{'_id':_0x3f8d5c(0x127),'name':{'$first':_0x3f8d5c(0xce)},'product_stock':{'$first':_0x3f8d5c(0xe9)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x396b86[_0x3f8d5c(0xdd)](0xc8)[_0x3f8d5c(0x133)](_0x4eb59e);}catch(_0x151fac){_0x396b86['status'](0x194)['json']({'message':_0x151fac[_0x3f8d5c(0xd0)]});}}),module[a0_0x580683(0x103)]=router;