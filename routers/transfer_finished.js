var a0_0x271b30=a0_0x3b69;(function(_0x434085,_0x3ccb9a){var _0x358d34=a0_0x3b69,_0x5e9941=_0x434085();while(!![]){try{var _0x3b1aab=parseInt(_0x358d34(0x294))/0x1+-parseInt(_0x358d34(0x1e4))/0x2*(-parseInt(_0x358d34(0x22d))/0x3)+-parseInt(_0x358d34(0x27a))/0x4+parseInt(_0x358d34(0x273))/0x5*(parseInt(_0x358d34(0x1f9))/0x6)+-parseInt(_0x358d34(0x1d7))/0x7*(parseInt(_0x358d34(0x282))/0x8)+-parseInt(_0x358d34(0x227))/0x9*(-parseInt(_0x358d34(0x27f))/0xa)+parseInt(_0x358d34(0x295))/0xb*(parseInt(_0x358d34(0x1d2))/0xc);if(_0x3b1aab===_0x3ccb9a)break;else _0x5e9941['push'](_0x5e9941['shift']());}catch(_0x22379e){_0x5e9941['push'](_0x5e9941['shift']());}}}(a0_0x2adb,0x87cf5));function a0_0x3b69(_0x3b6b67,_0x32a8ac){var _0x2adb2a=a0_0x2adb();return a0_0x3b69=function(_0x3b69e3,_0x297c7a){_0x3b69e3=_0x3b69e3-0x1ca;var _0x41e499=_0x2adb2a[_0x3b69e3];return _0x41e499;},a0_0x3b69(_0x3b6b67,_0x32a8ac);}const express=require('express'),app=express(),router=express[a0_0x271b30(0x283)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0x271b30(0x1ee)),nodemailer=require(a0_0x271b30(0x1f6));router['get'](a0_0x271b30(0x277),auth,async(_0x5d6b44,_0x525185)=>{var _0x649b93=a0_0x271b30;try{const {username:_0x3bb9f7,email:_0x824725,role:_0x2a4b59}=_0x5d6b44[_0x649b93(0x253)],_0x35e6cd=_0x5d6b44['user'],_0x37a369=await profile[_0x649b93(0x205)]({'email':_0x35e6cd['email']}),_0x2805f3=await master_shop[_0x649b93(0x263)]();let _0x2c6cc7;if(_0x35e6cd['role']==_0x649b93(0x225)){const _0x3297c2=await staff['findOne']({'email':_0x35e6cd[_0x649b93(0x25c)]});_0x2c6cc7=await transfers_finished[_0x649b93(0x263)]({'from_warehouse':_0x3297c2[_0x649b93(0x228)]});}else _0x2c6cc7=await transfers_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x649b93(0x207),'invoice':{'$first':_0x649b93(0x257)},'date':{'$first':_0x649b93(0x285)},'from_warehouse':{'$first':_0x649b93(0x1fb)},'to_warehouse':{'$first':_0x649b93(0x221)},'from_room_name':{'$addToSet':_0x649b93(0x1f1)},'to_room_name':{'$addToSet':_0x649b93(0x1f3)},'finalize':{'$first':_0x649b93(0x250)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x2805f3[0x0]['language']==_0x649b93(0x222))var _0x4476cf=users[_0x649b93(0x220)];else{if(_0x2805f3[0x0]['language']==_0x649b93(0x202))var _0x4476cf=users[_0x649b93(0x202)];else{if(_0x2805f3[0x0]['language']=='German')var _0x4476cf=users[_0x649b93(0x206)];else{if(_0x2805f3[0x0][_0x649b93(0x1d9)]=='Spanish')var _0x4476cf=users[_0x649b93(0x252)];else{if(_0x2805f3[0x0][_0x649b93(0x1d9)]==_0x649b93(0x216))var _0x4476cf=users['French'];else{if(_0x2805f3[0x0][_0x649b93(0x1d9)]=='Portuguese\x20(BR)')var _0x4476cf=users[_0x649b93(0x26a)];else{if(_0x2805f3[0x0][_0x649b93(0x1d9)]==_0x649b93(0x24a))var _0x4476cf=users[_0x649b93(0x24a)];else{if(_0x2805f3[0x0][_0x649b93(0x1d9)]==_0x649b93(0x1fd))var _0x4476cf=users[_0x649b93(0x23d)];}}}}}}}_0x525185[_0x649b93(0x242)](_0x649b93(0x23a),{'success':_0x5d6b44['flash'](_0x649b93(0x236)),'errors':_0x5d6b44[_0x649b93(0x20b)]('errors'),'role':_0x35e6cd,'profile':_0x37a369,'master_shop':_0x2805f3,'transfer':_0x2c6cc7,'language':_0x4476cf});}catch(_0x1ef763){console[_0x649b93(0x211)](_0x1ef763);}});async function getRandom8DigitNumber(){var _0x5ed3a8=a0_0x271b30;const _0x30f1c3=0x989680,_0x4df70d=0x5f5e0ff,_0x46fd86=Math[_0x5ed3a8(0x201)](Math[_0x5ed3a8(0x289)]()*(_0x4df70d-_0x30f1c3+0x1))+_0x30f1c3;var _0x5e044d;const _0x3b3c0c=await transfers_finished[_0x5ed3a8(0x205)]({'invoice':_0x5ed3a8(0x229)+_0x46fd86});return _0x3b3c0c&&_0x3b3c0c[_0x5ed3a8(0x20c)]>0x0?_0x5e044d=_0x5ed3a8(0x229)+_0x46fd86:_0x5e044d=_0x5ed3a8(0x229)+_0x46fd86,_0x5e044d;}function a0_0x2adb(){var _0x30c972=['<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','map','from_room_name','<!DOCTYPE\x20html>','Enclosed','$product_details.storage','to_quantity','To_invoice','createTransport','filter','<tbody\x20style=\x22text-align:\x20center;\x22>','edit_transfer_finished','<h2>\x20','prod_cat','from_prod_level','bay','error','password','</div>','/upload/','to_prod_level','host','Enabled','Portuguese\x20(BR)','to_room_name','/barcode_scanner3','from_invoice','from_bay','$product_details.product_name','</h5>','product_code','secondary_code','$name','/barcode_scanner2','923256mAVmPu','<strong>\x20Regards\x20</strong>','$product_details.rack','undefined','exports','91PKeqcb','$product_details.secondary_code','language','</td>','$product_details.pallet','unit','<div>','/barcode_scanner','to_room','$product_details.bay','_id','$product_details.maxPerUnit','post','2gxmWHi','getDate','Finished\x20Goods','primary_code','from_room','maxPerUnit','\x20</h2>','date','Logo.png','to_warehouse','../public/language/languages.json','Rack\x202','$product_details.product_code','$product.from_room_name','An\x20error\x20occurred.','$product.to_room_name','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','nodemailer','Email\x20sent\x20successfully','maxProducts','13122IuPbRV','FGSEmail','$from_warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Arabic\x20(ae)','$product_details.type','params','site_title','floor','Hindi','push','transfer_data','findOne','German','$_id','Ambient','There\x27s\x20a\x20error\x20in\x20this\x20transaction','edit_transfer_finished_view','flash','length','<tr>','json','concat','port','log','Transfer\x20Finalize\x20Successfully','split','status','$product_details.production_date','French','id_transaction','<h5>','/transfer_finished/preview/','/transfer_finished/view','product_code3','$product_details.secondary_unit','$product_details.expiry_date','then','ToRoomAssigned','English','$to_warehouse','English\x20(US)','here2','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','staff','errors','2731761rtAOXQ','warehouse','TRFF-','note','</body></html>','image','449418vwkPDE','$product_details.maxProducts','message','$product_details.unit','<html><head><title></title>','$product_details.bin','/view/add_transfer','invoice','product','success','product_name','getMonth','$product_details.invoice','transfer_finished','to_bay','get','Arabic','findById','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.primary_code','expiry_date','render','body','/view/:id','add_transfer_finished','\x20Order\x20Number\x20:\x20','updateOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','production_date','Chinese','</head><body>','redirect','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/picking_list/PDF_transfer/','toString','$finalize','aggregate','Spanish','user','$product_details._id','Transfer\x20Edit\x20Successfully','Error\x20Occurs','$invoice','product_date','\x20Order\x20Date\x20:\x20','to_prod_qty','/transfer/view','email','product_stock','from_quantity','Transfer\x20Mail','<h5\x20style=\x22text-align:\x20left;\x22>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','slice','find','catch','save','abs','New_Qty_Converted','\x20<>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Portuguese','primary_unit','batch_code','to_floorlevel','MaxStocks_data','/preview/:id','$product_details','forEach','product_details','2140HvYnYm','back','DRY\x20GOODS','prod_name','/view','</tbody>','RoomAssigned','4330280FrDyOq','max','$room','<table\x20style=\x22width:\x20100%\x20!important;\x22>','logo','10rZOxdH','MaxStocks_data2','from_prod_qty','30928EFMjFl','Router','from_warehouse','$date','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.floorlevel','role','random','Rack\x201','/CheckingWarehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','finalize','$product_details.product_stock','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.batch_code','secondary_unit','$product_details.isle','145858DfiQNH','22tVvOPH','all'];a0_0x2adb=function(){return _0x30c972;};return a0_0x2adb();}router['get'](a0_0x271b30(0x233),auth,async(_0x25482f,_0x583ce3)=>{var _0x3efe9e=a0_0x271b30;try{const {username:_0x5c5872,email:_0x116284,role:_0x41a63d}=_0x25482f['user'],_0x1f57c5=_0x25482f[_0x3efe9e(0x253)],_0x56bb39=await profile[_0x3efe9e(0x205)]({'email':_0x1f57c5[_0x3efe9e(0x25c)]}),_0x5de0db=await master_shop['find']();let _0x5e1246;if(_0x1f57c5[_0x3efe9e(0x288)]==_0x3efe9e(0x225)){const _0x1857f5=await staff[_0x3efe9e(0x205)]({'email':_0x1f57c5['email']});_0x5e1246=await warehouse['aggregate']([{'$match':{'status':_0x3efe9e(0x2ad),'name':_0x1857f5[_0x3efe9e(0x228)],'warehouse_category':_0x3efe9e(0x1e6),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3efe9e(0x1d0),'name':{'$first':'$name'}}}]);}else _0x5e1246=await warehouse[_0x3efe9e(0x251)]([{'$match':{'status':_0x3efe9e(0x2ad),'warehouse_category':_0x3efe9e(0x1e6),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3efe9e(0x1d0),'name':{'$first':_0x3efe9e(0x1d0)}}}]);const _0x1f1480=await transfers_finished['find']({}),_0x54ab52=_0x1f1480[_0x3efe9e(0x20c)]+0x1,_0x4d1995=_0x3efe9e(0x229)+_0x54ab52[_0x3efe9e(0x24f)]()['padStart'](0x5,'0');if(_0x5de0db[0x0][_0x3efe9e(0x1d9)]==_0x3efe9e(0x222))var _0x9f5b50=users[_0x3efe9e(0x220)];else{if(_0x5de0db[0x0]['language']==_0x3efe9e(0x202))var _0x9f5b50=users[_0x3efe9e(0x202)];else{if(_0x5de0db[0x0]['language']==_0x3efe9e(0x206))var _0x9f5b50=users[_0x3efe9e(0x206)];else{if(_0x5de0db[0x0][_0x3efe9e(0x1d9)]=='Spanish')var _0x9f5b50=users[_0x3efe9e(0x252)];else{if(_0x5de0db[0x0]['language']==_0x3efe9e(0x216))var _0x9f5b50=users[_0x3efe9e(0x216)];else{if(_0x5de0db[0x0][_0x3efe9e(0x1d9)]==_0x3efe9e(0x2ae))var _0x9f5b50=users['Portuguese'];else{if(_0x5de0db[0x0][_0x3efe9e(0x1d9)]==_0x3efe9e(0x24a))var _0x9f5b50=users[_0x3efe9e(0x24a)];else{if(_0x5de0db[0x0][_0x3efe9e(0x1d9)]=='Arabic\x20(ae)')var _0x9f5b50=users[_0x3efe9e(0x23d)];}}}}}}}const _0x59e6ff=getRandom8DigitNumber();_0x59e6ff[_0x3efe9e(0x21e)](_0x27b54b=>{var _0x2ca7ef=_0x3efe9e;_0x583ce3[_0x2ca7ef(0x242)](_0x2ca7ef(0x245),{'success':_0x25482f[_0x2ca7ef(0x20b)](_0x2ca7ef(0x236)),'errors':_0x25482f[_0x2ca7ef(0x20b)]('errors'),'role':_0x1f57c5,'profile':_0x56bb39,'master_shop':_0x5de0db,'warehouse':_0x5e1246,'language':_0x9f5b50,'invoice':_0x27b54b});})[_0x3efe9e(0x264)](_0x3d3294=>{var _0x2d393d=_0x3efe9e;_0x25482f[_0x2d393d(0x20b)](_0x2d393d(0x226),_0x2d393d(0x209)),_0x583ce3['redirect'](_0x2d393d(0x25b));});}catch(_0x5eeed6){console[_0x3efe9e(0x211)](_0x5eeed6);}}),router[a0_0x271b30(0x1e3)](a0_0x271b30(0x233),auth,async(_0x5b46fa,_0x440e3b)=>{var _0x20e838=a0_0x271b30;try{const {date:_0x1ad293,from_warehouse:_0x4d7047,FromRoom_name:_0x31bbe2,to_warehouse:_0x2d6e5c,ToRoom_name:_0x416f57,prod_name:_0x39becc,from_prod_qty:_0x3814f8,from_prod_level:_0x5b8c85,from_prod_isle:_0x540a79,from_prod_pallet:_0xe8f1d9,to_prod_qty:_0x469fc9,to_prod_level:_0x2ae9e5,to_prod_isle:_0x1fefb3,to_prod_pallet:_0x42bebf,primary_code:_0xd8c4c7,secondary_code:_0x2b2291,product_code3:_0x2f5540,note:_0x43fce4,MaxStocks_data2:_0x5318a0,invoice:_0x3fa800,expiry_date:_0x2936c9}=_0x5b46fa[_0x20e838(0x243)];if(typeof _0x39becc=='string')var _0x64bcc4=[_0x5b46fa['body'][_0x20e838(0x276)]],_0x13881c=[_0x5b46fa['body'][_0x20e838(0x281)]],_0x20a743=[_0x5b46fa[_0x20e838(0x243)][_0x20e838(0x2a5)]],_0x247d0c=[_0x5b46fa[_0x20e838(0x243)]['New_Qty_Converted']],_0x3ef966=[_0x5b46fa[_0x20e838(0x243)][_0x20e838(0x2ab)]],_0x39ad42=[_0x5b46fa[_0x20e838(0x243)][_0x20e838(0x1e7)]],_0x5eb720=[_0x5b46fa[_0x20e838(0x243)]['secondary_code']],_0x4970bf=[_0x5b46fa['body'][_0x20e838(0x21b)]],_0x1ef7af=[_0x5b46fa[_0x20e838(0x243)]['MaxStocks_data2']],_0x579284=[_0x5b46fa['body'][_0x20e838(0x26b)]],_0x4ae12e=[_0x5b46fa[_0x20e838(0x243)][_0x20e838(0x292)]],_0x3671ca=[_0x5b46fa[_0x20e838(0x243)]['batch_code']],_0x4a3f5e=[_0x5b46fa['body'][_0x20e838(0x241)]],_0x3afb34=[_0x5b46fa['body'][_0x20e838(0x258)]],_0x37488d=[_0x5b46fa['body']['MaxStocks_data']],_0x15fed5=[_0x5b46fa['body'][_0x20e838(0x1e9)]],_0x5e17c9=[_0x5b46fa[_0x20e838(0x243)]['prod_cat']],_0x16913b=[_0x5b46fa['body'][_0x20e838(0x279)]],_0x18fcc2=[_0x5b46fa[_0x20e838(0x243)]['ToRoomAssigned']],_0x4ed296=[_0x5b46fa[_0x20e838(0x243)][_0x20e838(0x1ca)]],_0x113f93=[_0x5b46fa[_0x20e838(0x243)]['to_invoice']],_0x195556=[_0x5b46fa[_0x20e838(0x243)][_0x20e838(0x217)]];else var _0x64bcc4=[..._0x5b46fa[_0x20e838(0x243)]['prod_name']],_0x13881c=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x281)]],_0x20a743=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x2a5)]],_0x247d0c=[..._0x5b46fa['body'][_0x20e838(0x267)]],_0x3ef966=[..._0x5b46fa['body'][_0x20e838(0x2ab)]],_0x39ad42=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x1e7)]],_0x5eb720=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x1cf)]],_0x4970bf=[..._0x5b46fa['body']['product_code3']],_0x1ef7af=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x280)]],_0x579284=[..._0x5b46fa[_0x20e838(0x243)]['primary_unit']],_0x4ae12e=[..._0x5b46fa[_0x20e838(0x243)]['secondary_unit']],_0x3671ca=[..._0x5b46fa['body']['batch_code']],_0x4a3f5e=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x241)]],_0x3afb34=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x258)]],_0x37488d=[..._0x5b46fa['body'][_0x20e838(0x26e)]],_0x15fed5=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x1e9)]],_0x5e17c9=[..._0x5b46fa['body'][_0x20e838(0x2a4)]],_0x16913b=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x279)]],_0x18fcc2=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x21f)]],_0x4ed296=[..._0x5b46fa[_0x20e838(0x243)]['from_invoice']],_0x113f93=[..._0x5b46fa[_0x20e838(0x243)]['to_invoice']],_0x195556=[..._0x5b46fa[_0x20e838(0x243)][_0x20e838(0x217)]];const _0x1d70ba=_0x64bcc4[_0x20e838(0x298)](_0x54d7ce=>{return _0x54d7ce={'product_name':_0x54d7ce};});_0x13881c['forEach']((_0x140885,_0x40dca4)=>{var _0x4a3543=_0x20e838;_0x1d70ba[_0x40dca4][_0x4a3543(0x25e)]=_0x140885;}),_0x20a743[_0x20e838(0x271)]((_0x465ab9,_0x511c22)=>{_0x1d70ba[_0x511c22]['from_bay']=_0x465ab9;}),_0x195556[_0x20e838(0x271)]((_0xb4a163,_0x30fa45)=>{var _0x1f8c7c=_0x20e838;_0x1d70ba[_0x30fa45][_0x1f8c7c(0x217)]=_0xb4a163;}),_0x4ed296[_0x20e838(0x271)]((_0x240126,_0x4cfaa4)=>{var _0x399a91=_0x20e838;_0x1d70ba[_0x4cfaa4][_0x399a91(0x1ca)]=_0x240126;}),_0x113f93[_0x20e838(0x271)]((_0x3d8da9,_0x47676f)=>{var _0x307a89=_0x20e838;_0x1d70ba[_0x47676f][_0x307a89(0x29e)]=_0x3d8da9;}),_0x247d0c[_0x20e838(0x271)]((_0x9a8422,_0xcb278b)=>{_0x1d70ba[_0xcb278b]['to_quantity']=_0x9a8422;}),_0x3ef966['forEach']((_0x4d5fa6,_0x3ebce7)=>{var _0x4a27e5=_0x20e838;_0x1d70ba[_0x3ebce7][_0x4a27e5(0x23b)]=_0x4d5fa6;}),_0x39ad42[_0x20e838(0x271)]((_0x2221a8,_0x17f670)=>{var _0x35b71e=_0x20e838;_0x1d70ba[_0x17f670][_0x35b71e(0x1e7)]=_0x2221a8;}),_0x5eb720['forEach']((_0x292a46,_0x2d17f3)=>{var _0x1ae3a7=_0x20e838;_0x1d70ba[_0x2d17f3][_0x1ae3a7(0x1cf)]=_0x292a46;}),_0x4970bf[_0x20e838(0x271)]((_0x370e0f,_0xec1f0)=>{_0x1d70ba[_0xec1f0]['product_code']=_0x370e0f;}),_0x1ef7af[_0x20e838(0x271)]((_0x3270bf,_0x33366f)=>{var _0x46c43d=_0x20e838;_0x1d70ba[_0x33366f][_0x46c43d(0x1f8)]=_0x3270bf;}),_0x579284[_0x20e838(0x271)]((_0x22507f,_0x37568a)=>{var _0x3126fa=_0x20e838;_0x1d70ba[_0x37568a][_0x3126fa(0x1dc)]=_0x22507f;}),_0x4ae12e[_0x20e838(0x271)]((_0x4953bd,_0x36b649)=>{var _0x161423=_0x20e838;_0x1d70ba[_0x36b649][_0x161423(0x292)]=_0x4953bd;}),_0x3671ca[_0x20e838(0x271)]((_0x22ac5,_0x4cc1f0)=>{var _0x1effb8=_0x20e838;_0x1d70ba[_0x4cc1f0][_0x1effb8(0x26c)]=_0x22ac5;}),_0x4a3f5e[_0x20e838(0x271)]((_0x2393bb,_0x191bd2)=>{var _0xfa86e6=_0x20e838;_0x1d70ba[_0x191bd2][_0xfa86e6(0x241)]=_0x2393bb;}),_0x3afb34[_0x20e838(0x271)]((_0x152033,_0x28f016)=>{_0x1d70ba[_0x28f016]['production_date']=_0x152033;}),_0x37488d[_0x20e838(0x271)]((_0x31b263,_0x270ce9)=>{var _0x418fce=_0x20e838;_0x1d70ba[_0x270ce9][_0x418fce(0x1f8)]=_0x31b263;}),_0x15fed5[_0x20e838(0x271)]((_0x1450af,_0x281dc1)=>{var _0x52253a=_0x20e838;_0x1d70ba[_0x281dc1][_0x52253a(0x1e9)]=_0x1450af;}),_0x5e17c9[_0x20e838(0x271)]((_0x2df952,_0x113cac)=>{var _0x32bfe7=_0x20e838;_0x1d70ba[_0x113cac][_0x32bfe7(0x2a4)]=_0x2df952;}),_0x16913b[_0x20e838(0x271)]((_0x15d857,_0x337c93)=>{var _0xffc162=_0x20e838;_0x1d70ba[_0x337c93][_0xffc162(0x299)]=_0x15d857;}),_0x18fcc2[_0x20e838(0x271)]((_0x350ff4,_0x35fc36)=>{var _0xdf06c0=_0x20e838;_0x1d70ba[_0x35fc36][_0xdf06c0(0x2af)]=_0x350ff4;});const _0x41794b=_0x1d70ba['filter'](_0x2cee22=>_0x2cee22[_0x20e838(0x29d)]!=='0'&&_0x2cee22[_0x20e838(0x29d)]!==''||_0x2cee22[_0x20e838(0x26d)]!=='0'&&_0x2cee22[_0x20e838(0x26d)]!=='');var _0x28905a=0x0;_0x41794b[_0x20e838(0x271)](_0xd4d78f=>{var _0x2e9eac=_0x20e838;parseInt(_0xd4d78f[_0x2e9eac(0x25e)])<parseInt(_0xd4d78f[_0x2e9eac(0x29d)])&&_0x28905a++;});if(_0x28905a!=0x0)return _0x5b46fa[_0x20e838(0x20b)](_0x20e838(0x226),_0x20e838(0x261)),_0x440e3b['redirect'](_0x20e838(0x274));const _0x4c8f6b=new transfers_finished({'date':_0x1ad293,'from_warehouse':_0x4d7047,'to_warehouse':_0x2d6e5c,'product':_0x41794b,'note':_0x43fce4,'invoice':_0x3fa800}),_0x2c4045=await _0x4c8f6b[_0x20e838(0x265)]();_0x5b46fa['flash']('success','Product\x20Transfer\x20successfully'),_0x440e3b[_0x20e838(0x24c)](_0x20e838(0x219)+_0x2c4045[_0x20e838(0x1e1)]);}catch(_0x4dc075){console['log'](_0x4dc075),_0x440e3b['status'](0xc8)[_0x20e838(0x20e)]({'errorMessage':_0x4dc075[_0x20e838(0x22f)]});}}),router[a0_0x271b30(0x23c)]('/preview/:id',auth,async(_0x4d2624,_0x5c95b6)=>{var _0x45ba85=a0_0x271b30;try{const {username:_0x2c2463,email:_0x23bb02,role:_0x4de82b}=_0x4d2624[_0x45ba85(0x253)],_0xe19180=_0x4d2624['user'],_0x44bcaa=await profile['findOne']({'email':_0xe19180[_0x45ba85(0x25c)]}),_0x22a53b=await master_shop[_0x45ba85(0x263)](),_0x1be333=await transfers_finished[_0x45ba85(0x23e)](_0x4d2624[_0x45ba85(0x1ff)]['id']);let _0x1a52be;if(_0xe19180[_0x45ba85(0x288)]==_0x45ba85(0x225)){const _0x568c2a=await staff[_0x45ba85(0x205)]({'email':_0xe19180[_0x45ba85(0x25c)]});_0x1a52be=await warehouse['find']({'status':_0x45ba85(0x2ad),'name':_0x568c2a['warehouse'],'warehouse_category':_0x45ba85(0x1e6)});}else _0x1a52be=await warehouse['find']({'status':_0x45ba85(0x2ad),'warehouse_category':'Finished\x20Goods'});const _0x56ee9c=await warehouse['aggregate']([{'$match':{'name':_0x1be333['from_warehouse'],'warehouse_category':_0x45ba85(0x1e6)}},{'$unwind':_0x45ba85(0x270)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x45ba85(0x1cc)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x45ba85(0x1e0)},'bin':{'$first':_0x45ba85(0x232)},'type':{'$first':_0x45ba85(0x1fe)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x45ba85(0x240)},'secondary_code':{'$first':_0x45ba85(0x1d8)},'product_code':{'$first':_0x45ba85(0x1f0)},'storage':{'$first':_0x45ba85(0x29c)},'rack':{'$first':_0x45ba85(0x1d4)},'expiry_date':{'$first':_0x45ba85(0x21d)},'production_date':{'$first':_0x45ba85(0x215)},'room':{'$first':_0x45ba85(0x27c)},'warehoue_name':{'$first':_0x45ba85(0x1d0)}}}]),_0x456e03=await product[_0x45ba85(0x263)]({});if(_0x22a53b[0x0]['language']=='English\x20(US)'){var _0x39848d=users[_0x45ba85(0x220)];console[_0x45ba85(0x211)](_0x39848d);}else{if(_0x22a53b[0x0][_0x45ba85(0x1d9)]==_0x45ba85(0x202))var _0x39848d=users['Hindi'];else{if(_0x22a53b[0x0][_0x45ba85(0x1d9)]=='German')var _0x39848d=users[_0x45ba85(0x206)];else{if(_0x22a53b[0x0][_0x45ba85(0x1d9)]==_0x45ba85(0x252))var _0x39848d=users['Spanish'];else{if(_0x22a53b[0x0][_0x45ba85(0x1d9)]==_0x45ba85(0x216))var _0x39848d=users[_0x45ba85(0x216)];else{if(_0x22a53b[0x0][_0x45ba85(0x1d9)]==_0x45ba85(0x2ae))var _0x39848d=users['Portuguese'];else{if(_0x22a53b[0x0]['language']==_0x45ba85(0x24a))var _0x39848d=users[_0x45ba85(0x24a)];else{if(_0x22a53b[0x0][_0x45ba85(0x1d9)]==_0x45ba85(0x1fd))var _0x39848d=users[_0x45ba85(0x23d)];}}}}}}}_0x5c95b6[_0x45ba85(0x242)](_0x45ba85(0x20a),{'success':_0x4d2624[_0x45ba85(0x20b)](_0x45ba85(0x236)),'errors':_0x4d2624['flash'](_0x45ba85(0x226)),'role':_0xe19180,'profile':_0x44bcaa,'master_shop':_0x22a53b,'warehouse':_0x1a52be,'transfer':_0x1be333,'stock':_0x56ee9c,'unit':_0x456e03,'language':_0x39848d});}catch(_0x6f986){console['log'](_0x6f986);}}),router[a0_0x271b30(0x1e3)](a0_0x271b30(0x26f),auth,async(_0x102904,_0x3bf56a)=>{var _0x416499=a0_0x271b30;try{const {invoice:_0x7e8c8a,from_warehouse:_0x47ab15,FromRoom_name:_0x2e0d86,to_warehouse:_0x26c3c1,ToRoom_name:_0xaa1b1e}=_0x102904[_0x416499(0x243)],_0x2361a6=await transfers_finished[_0x416499(0x23e)](_0x102904[_0x416499(0x1ff)]['id']),_0x4a5fb2=_0x2361a6[_0x416499(0x235)]['map'](async _0x2696d9=>{var _0x2dad34=_0x416499;if(_0x2696d9[_0x2dad34(0x29d)]>0x0){var _0x2512aa=await warehouse[_0x2dad34(0x205)]({'name':_0x47ab15,'room':_0x2696d9[_0x2dad34(0x299)],'warehouse_category':_0x2dad34(0x1e6)});const _0x39c7c6=_0x2512aa[_0x2dad34(0x272)][_0x2dad34(0x298)](_0x39e76a=>{var _0x4c796d=_0x2dad34;_0x39e76a[_0x4c796d(0x237)]==_0x2696d9[_0x4c796d(0x237)]&&_0x39e76a[_0x4c796d(0x2a6)]==_0x2696d9[_0x4c796d(0x1cb)]&&_0x39e76a[_0x4c796d(0x241)]==_0x2696d9[_0x4c796d(0x241)]&&_0x39e76a[_0x4c796d(0x249)]==_0x2696d9[_0x4c796d(0x249)]&&_0x39e76a['batch_code']==_0x2696d9[_0x4c796d(0x26c)]&&_0x39e76a[_0x4c796d(0x234)]==_0x2696d9[_0x4c796d(0x1ca)]&&(console[_0x4c796d(0x211)]('here1',_0x39e76a['product_stock']),typeof _0x2696d9[_0x4c796d(0x217)]==_0x4c796d(0x1d5)?_0x39e76a[_0x4c796d(0x25d)]=Math[_0x4c796d(0x27b)](0x0,Math[_0x4c796d(0x266)](_0x39e76a[_0x4c796d(0x25d)])-Math[_0x4c796d(0x266)](_0x2696d9[_0x4c796d(0x29d)])):_0x39e76a[_0x4c796d(0x25d)]=Math[_0x4c796d(0x27b)](0x0,Math[_0x4c796d(0x266)](_0x39e76a[_0x4c796d(0x25d)])-Math[_0x4c796d(0x266)](_0x2696d9[_0x4c796d(0x29d)])));});}return _0x2512aa;});Promise[_0x416499(0x296)](_0x4a5fb2)[_0x416499(0x21e)](async _0x3a2d93=>{var _0x3328b7=_0x416499;try{for(const _0x102d02 of _0x3a2d93){await _0x102d02['save']();}const _0xf9da43=_0x2361a6[_0x3328b7(0x235)]['map'](async _0x338f60=>{var _0x4d620f=_0x3328b7,_0x3e197e=await warehouse['findOne']({'name':_0x26c3c1,'room':_0x338f60[_0x4d620f(0x2af)]});if(_0x338f60[_0x4d620f(0x29d)]>0x0){var _0xa02330=0x0;const _0x2336bf=_0x3e197e[_0x4d620f(0x272)][_0x4d620f(0x298)](_0xad34b5=>{var _0x24ec99=_0x4d620f;_0xad34b5[_0x24ec99(0x237)]==_0x338f60['product_name']&&_0xad34b5[_0x24ec99(0x2a6)]==_0x338f60[_0x24ec99(0x23b)]&&_0xad34b5[_0x24ec99(0x241)]==_0x338f60['expiry_date']&&_0xad34b5[_0x24ec99(0x249)]==_0x338f60[_0x24ec99(0x249)]&&_0xad34b5[_0x24ec99(0x26c)]==_0x338f60['batch_code']&&_0xad34b5[_0x24ec99(0x234)]==_0x338f60[_0x24ec99(0x29e)]&&(typeof _0x338f60[_0x24ec99(0x217)]=='undefined'?(console[_0x24ec99(0x211)](_0x24ec99(0x223),_0xad34b5[_0x24ec99(0x25d)]+_0x24ec99(0x268)+_0xad34b5[_0x24ec99(0x1e1)]+'\x20<=>\x20'+Math['abs'](_0xad34b5[_0x24ec99(0x25d)])+Math[_0x24ec99(0x266)](_0x338f60[_0x24ec99(0x29d)])),_0xad34b5[_0x24ec99(0x25d)]=Math['abs'](_0xad34b5[_0x24ec99(0x25d)])+Math[_0x24ec99(0x266)](_0x338f60[_0x24ec99(0x29d)])):_0xad34b5[_0x24ec99(0x25d)]=Math[_0x24ec99(0x266)](_0xad34b5[_0x24ec99(0x25d)])+Math[_0x24ec99(0x266)](_0x338f60['to_quantity']),_0xa02330++);});_0xa02330=='0'&&(_0x3e197e[_0x4d620f(0x272)]=_0x3e197e[_0x4d620f(0x272)][_0x4d620f(0x20f)]({'product_name':_0x338f60[_0x4d620f(0x237)],'product_stock':_0x338f60[_0x4d620f(0x29d)],'bay':_0x338f60['to_bay'],'product_code':_0x338f60[_0x4d620f(0x1ce)],'primary_code':_0x338f60[_0x4d620f(0x1e7)],'secondary_code':_0x338f60['secondary_code'],'expiry_date':_0x338f60['expiry_date'],'production_date':_0x338f60[_0x4d620f(0x249)],'maxProducts':_0x338f60[_0x4d620f(0x1f8)],'batch_code':_0x338f60[_0x4d620f(0x26c)],'secondary_unit':_0x338f60[_0x4d620f(0x292)],'unit':_0x338f60['unit'],'maxProducts':_0x338f60[_0x4d620f(0x1f8)],'maxPerUnit':_0x338f60[_0x4d620f(0x1e9)],'invoice':_0x338f60[_0x4d620f(0x29e)]}));}return _0x3e197e;});Promise['all'](_0xf9da43)[_0x3328b7(0x21e)](async _0x580557=>{var _0x506b7b=_0x3328b7;try{for(const _0x835bb0 of _0x580557){await warehouse[_0x506b7b(0x247)]({'_id':_0x835bb0[_0x506b7b(0x1e1)]},{'$addToSet':{'product_details':{'$each':_0x835bb0['product_details']}}});}_0x2361a6[_0x506b7b(0x28d)]='True';const _0x34896c=await _0x2361a6[_0x506b7b(0x265)](),_0x2d4fd7=await master_shop[_0x506b7b(0x263)](),_0x21819f=await email_settings[_0x506b7b(0x205)](),_0x10e336=await supervisor_settings[_0x506b7b(0x263)]();var _0x1026d4=_0x2361a6['product'],_0x1d2fba='',_0x340b2a;for(_0x340b2a in _0x1026d4){var _0x30a45e='FG';_0x2361a6[_0x506b7b(0x1ed)]=='DRY\x20GOODS'&&(_0x30a45e='DG'),_0x1d2fba+=_0x506b7b(0x20d)+_0x506b7b(0x297)+_0x1026d4[_0x340b2a]['product_name']+'</td>'+_0x506b7b(0x297)+_0x1026d4[_0x340b2a][_0x506b7b(0x1ce)]+_0x506b7b(0x1da)+_0x506b7b(0x297)+_0x1026d4[_0x340b2a][_0x506b7b(0x29d)]+_0x506b7b(0x1da)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1026d4[_0x340b2a][_0x506b7b(0x1dc)]+_0x506b7b(0x1da)+_0x506b7b(0x297)+_0x1026d4[_0x340b2a][_0x506b7b(0x292)]+_0x506b7b(0x1da)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2361a6[_0x506b7b(0x1ed)]+_0x506b7b(0x1da)+_0x506b7b(0x297)+_0x1026d4[_0x340b2a][_0x506b7b(0x2af)]+_0x506b7b(0x1da)+_0x506b7b(0x297)+_0x30a45e+_0x1026d4[_0x340b2a][_0x506b7b(0x23b)]+_0x506b7b(0x1da)+'</tr>';}let _0x50a55f=nodemailer[_0x506b7b(0x29f)]({'host':_0x21819f[_0x506b7b(0x2ac)],'port':Number(_0x21819f[_0x506b7b(0x210)]),'secure':![],'auth':{'user':_0x21819f[_0x506b7b(0x25c)],'pass':_0x21819f[_0x506b7b(0x2a8)]}}),_0x1c30e3={'from':_0x21819f[_0x506b7b(0x25c)],'to':_0x10e336[0x0][_0x506b7b(0x1fa)],'subject':_0x506b7b(0x25f),'attachments':[{'filename':_0x506b7b(0x1ec),'path':__dirname+_0x506b7b(0x28f)+_0x506b7b(0x2aa)+_0x2d4fd7[0x0][_0x506b7b(0x22c)],'cid':_0x506b7b(0x27e)}],'html':_0x506b7b(0x29a)+_0x506b7b(0x231)+_0x506b7b(0x24b)+_0x506b7b(0x1dd)+_0x506b7b(0x286)+_0x506b7b(0x1dd)+_0x506b7b(0x24d)+_0x506b7b(0x2a9)+_0x506b7b(0x1dd)+_0x506b7b(0x2a3)+_0x2d4fd7[0x0][_0x506b7b(0x200)]+_0x506b7b(0x1ea)+_0x506b7b(0x2a9)+_0x506b7b(0x2a9)+'<hr\x20class=\x22my-3\x22>'+_0x506b7b(0x1dd)+_0x506b7b(0x260)+_0x506b7b(0x246)+_0x2361a6[_0x506b7b(0x234)]+'\x20'+_0x506b7b(0x1f4)+_0x506b7b(0x259)+_0x2361a6['date']+'\x20'+'</span>'+_0x506b7b(0x1cd)+_0x506b7b(0x2a9)+_0x506b7b(0x27d)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x506b7b(0x20d)+_0x506b7b(0x269)+_0x506b7b(0x28c)+_0x506b7b(0x248)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x506b7b(0x224)+_0x506b7b(0x1f5)+_0x506b7b(0x290)+_0x506b7b(0x1fc)+'</tr>'+'</thead>'+_0x506b7b(0x2a1)+'\x20'+_0x1d2fba+'\x20'+_0x506b7b(0x278)+'</table>'+_0x506b7b(0x1dd)+_0x506b7b(0x1d3)+_0x506b7b(0x218)+_0x2d4fd7[0x0]['site_title']+_0x506b7b(0x1cd)+'</div>'+_0x506b7b(0x2a9)+_0x506b7b(0x22b)};_0x50a55f['sendMail'](_0x1c30e3,function(_0x5655dd,_0x9fdada){var _0x2ef0c0=_0x506b7b;_0x5655dd?(console[_0x2ef0c0(0x211)](_0x5655dd),console[_0x2ef0c0(0x211)](_0x2ef0c0(0x256))):console[_0x2ef0c0(0x211)](_0x2ef0c0(0x1f7));}),_0x102904[_0x506b7b(0x20b)]('success',_0x506b7b(0x212)),_0x3bf56a[_0x506b7b(0x24c)](_0x506b7b(0x24e)+_0x34896c[_0x506b7b(0x1e1)]);}catch(_0x1cd1a3){console[_0x506b7b(0x2a7)](_0x1cd1a3),_0x3bf56a[_0x506b7b(0x214)](0x1f4)['json']({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3328b7(0x264)](_0x3d0f78=>{var _0x335f2d=_0x3328b7;console['error'](_0x3d0f78),_0x3bf56a[_0x335f2d(0x214)](0x1f4)[_0x335f2d(0x20e)]({'error':_0x335f2d(0x1f2)});});}catch(_0x3ddde2){console[_0x3328b7(0x2a7)](_0x3ddde2),_0x3bf56a[_0x3328b7(0x214)](0x1f4)[_0x3328b7(0x20e)]({'error':_0x3328b7(0x23f)});}})['catch'](_0x1bff78=>{var _0x104df2=_0x416499;console[_0x104df2(0x2a7)](_0x1bff78),_0x3bf56a[_0x104df2(0x214)](0x1f4)[_0x104df2(0x20e)]({'error':_0x104df2(0x1f2)});});}catch(_0x36e9a5){_0x3bf56a[_0x416499(0x20e)]({'message':_0x36e9a5['message']});}});function BayBinSelected(_0x423823,_0x2af346){var _0x453f3e=a0_0x271b30,_0x4e6c85=[];let _0x340bdb=[];var _0x5ea767=[];if(_0x423823==_0x453f3e(0x275)){switch(_0x2af346){case _0x453f3e(0x28a):_0x4e6c85=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x453f3e(0x1ef):_0x4e6c85=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5ea767=['DG'];}else{if(_0x423823=='FROZEN\x20GOODS'){switch(_0x2af346){case _0x453f3e(0x28a):_0x4e6c85=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x453f3e(0x1ef):_0x4e6c85=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5ea767=['FG'];}}return{'levels':_0x4e6c85,'identify':_0x5ea767};}router[a0_0x271b30(0x23c)](a0_0x271b30(0x244),auth,async(_0x3d1971,_0x619603)=>{var _0x4e0744=a0_0x271b30;try{const {username:_0x45f923,email:_0x50eeb0,role:_0x147d4b}=_0x3d1971[_0x4e0744(0x253)],_0x166731=_0x3d1971[_0x4e0744(0x253)],_0x518699=await profile[_0x4e0744(0x205)]({'email':_0x166731[_0x4e0744(0x25c)]}),_0x23d281=await master_shop[_0x4e0744(0x263)](),_0x998834=await transfers_finished[_0x4e0744(0x23e)](_0x3d1971[_0x4e0744(0x1ff)]['id']);let _0x364019=new Date(_0x998834[_0x4e0744(0x241)]),_0x156977=('0'+_0x364019[_0x4e0744(0x1e5)]())[_0x4e0744(0x262)](-0x2),_0x12dc95=('0'+(_0x364019[_0x4e0744(0x238)]()+0x1))[_0x4e0744(0x262)](-0x2),_0x2a0a4f=_0x364019['getFullYear'](),_0x9c1a62=_0x2a0a4f+'-'+_0x12dc95+'-'+_0x156977,_0x3253e1;if(_0x166731[_0x4e0744(0x288)]=='staff'){const _0x4e66c4=await staff[_0x4e0744(0x205)]({'email':_0x166731[_0x4e0744(0x25c)]});_0x3253e1=await warehouse[_0x4e0744(0x263)]({'status':_0x4e0744(0x2ad),'name':_0x4e66c4[_0x4e0744(0x228)],'warehouse_category':_0x4e0744(0x1e6)});}else _0x3253e1=await warehouse[_0x4e0744(0x263)]({'status':_0x4e0744(0x2ad),'warehouse_category':_0x4e0744(0x1e6)});const _0x26a085=await warehouse[_0x4e0744(0x251)]([{'$match':{'name':_0x998834[_0x4e0744(0x284)],'room':_0x998834['from_room']}},{'$unwind':_0x4e0744(0x270)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4e0744(0x1cc)},'product_stock':{'$first':_0x4e0744(0x28e)},'bay':{'$first':_0x4e0744(0x1e0)},'bin':{'$first':_0x4e0744(0x232)},'type':{'$first':_0x4e0744(0x1fe)},'floorlevel':{'$first':_0x4e0744(0x287)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4e0744(0x29c)},'rack':{'$first':_0x4e0744(0x1d4)}}}]);var _0x269eec=[0x1,0x2,0x3,0x4],_0x588b33=['A','B','C','D','E','F','G','H','I','J'],_0x30b711=[_0x4e0744(0x208),_0x4e0744(0x29b)];const _0x536688=await product[_0x4e0744(0x263)]({}),_0x1e2620=BayBinSelected(_0x998834[_0x4e0744(0x1ed)],_0x998834[_0x4e0744(0x1df)]);if(_0x23d281[0x0][_0x4e0744(0x1d9)]==_0x4e0744(0x222)){var _0x8d66f=users[_0x4e0744(0x220)];console[_0x4e0744(0x211)](_0x8d66f);}else{if(_0x23d281[0x0]['language']==_0x4e0744(0x202))var _0x8d66f=users[_0x4e0744(0x202)];else{if(_0x23d281[0x0][_0x4e0744(0x1d9)]==_0x4e0744(0x206))var _0x8d66f=users['German'];else{if(_0x23d281[0x0][_0x4e0744(0x1d9)]==_0x4e0744(0x252))var _0x8d66f=users[_0x4e0744(0x252)];else{if(_0x23d281[0x0]['language']==_0x4e0744(0x216))var _0x8d66f=users[_0x4e0744(0x216)];else{if(_0x23d281[0x0][_0x4e0744(0x1d9)]==_0x4e0744(0x2ae))var _0x8d66f=users[_0x4e0744(0x26a)];else{if(_0x23d281[0x0][_0x4e0744(0x1d9)]=='Chinese')var _0x8d66f=users[_0x4e0744(0x24a)];else{if(_0x23d281[0x0][_0x4e0744(0x1d9)]==_0x4e0744(0x1fd))var _0x8d66f=users[_0x4e0744(0x23d)];}}}}}}}_0x619603['render'](_0x4e0744(0x2a2),{'success':_0x3d1971['flash'](_0x4e0744(0x236)),'errors':_0x3d1971[_0x4e0744(0x20b)]('errors'),'role':_0x166731,'profile':_0x518699,'master_shop':_0x23d281,'warehouse':_0x3253e1,'transfer':_0x998834,'stock':_0x26a085,'unit':_0x536688,'language':_0x8d66f,'levels':_0x269eec,'Isle':_0x588b33,'rooms_data':_0x30b711,'ed_fullDate':_0x9c1a62,'dataSelected':_0x1e2620});}catch(_0x72ab82){console[_0x4e0744(0x211)](_0x72ab82);}}),router['post'](a0_0x271b30(0x244),auth,async(_0x475c5d,_0x5cdb0c)=>{var _0xc82c83=a0_0x271b30;try{const _0x34d079=_0x475c5d[_0xc82c83(0x1ff)]['id'];console[_0xc82c83(0x211)](_0x475c5d[_0xc82c83(0x243)]);const _0x34e320=await transfers_finished['findById'](_0x34d079);console[_0xc82c83(0x211)](_0xc82c83(0x204),_0x34e320);const {date:_0x5e8669,from_warehouse:_0x2342da,FromRoom_name:_0x270f45,to_warehouse:_0xd1ce7c,ToRoom_name:_0x543dc2,prod_name:_0xd99f23,from_prod_qty:_0x51e53e,from_prod_level:_0xb2a5f0,from_prod_isle:_0x498bed,from_prod_pallet:_0x35d384,to_prod_qty:_0x5dd7a6,to_prod_level:_0xd533de,to_prod_isle:_0x4dc1d1,to_prod_pallet:_0x3e3087,primary_code:_0x24a95c,secondary_code:_0x50735a,product_code3:_0x31e720,note:_0x2a6507,invoice:_0x4bc0f3,expiry_date:_0x2fdddc}=_0x475c5d[_0xc82c83(0x243)];if(typeof _0xd99f23=='string')var _0x516e96=[_0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x276)]],_0x3c1a5d=[_0x475c5d[_0xc82c83(0x243)]['from_prod_qty']],_0x14ae5f=[_0x475c5d[_0xc82c83(0x243)]['from_prod_level']],_0x50d5b2=[_0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x25a)]],_0x4198a1=[_0x475c5d[_0xc82c83(0x243)]['to_prod_level']],_0x18e2b0=[_0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x1e7)]],_0x1b1f94=[_0x475c5d[_0xc82c83(0x243)]['secondary_code']],_0x1012e7=[_0x475c5d['body']['product_code3']],_0x5cdbea=[_0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x280)]],_0xf2e5f9=[_0x475c5d[_0xc82c83(0x243)]['unit']],_0x152189=[_0x475c5d[_0xc82c83(0x243)]['secondary_unit']],_0x1a717a=[_0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x26c)]],_0x38e526=[_0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x241)]];else var _0x516e96=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x276)]],_0x3c1a5d=[..._0x475c5d[_0xc82c83(0x243)]['from_prod_qty']],_0x14ae5f=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x2a5)]],_0x50d5b2=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x25a)]],_0x4198a1=[..._0x475c5d['body'][_0xc82c83(0x2ab)]],_0x18e2b0=[..._0x475c5d[_0xc82c83(0x243)]['primary_code']],_0x1b1f94=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x1cf)]],_0x1012e7=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x21b)]],_0x5cdbea=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x280)]],_0xf2e5f9=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x1dc)]],_0x152189=[..._0x475c5d['body'][_0xc82c83(0x292)]],_0x1a717a=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x26c)]],_0x38e526=[..._0x475c5d[_0xc82c83(0x243)][_0xc82c83(0x241)]];const _0xe236a=_0x516e96[_0xc82c83(0x298)](_0x2dafb2=>{return _0x2dafb2={'product_name':_0x2dafb2};});_0x3c1a5d[_0xc82c83(0x271)]((_0x25d2f5,_0x4a3bd2)=>{var _0x3a30e3=_0xc82c83;_0xe236a[_0x4a3bd2][_0x3a30e3(0x25e)]=_0x25d2f5;}),_0x14ae5f[_0xc82c83(0x271)]((_0x404d6e,_0x27af6c)=>{var _0x3ae0bf=_0xc82c83;_0xe236a[_0x27af6c][_0x3ae0bf(0x1cb)]=_0x404d6e;}),_0x50d5b2['forEach']((_0x3ee717,_0x5b772b)=>{_0xe236a[_0x5b772b]['to_quantity']=_0x3ee717;}),_0x4198a1[_0xc82c83(0x271)]((_0x53ddc3,_0x3b9234)=>{var _0x35356e=_0xc82c83;_0xe236a[_0x3b9234][_0x35356e(0x23b)]=_0x53ddc3;}),_0x18e2b0[_0xc82c83(0x271)]((_0x8e4b2a,_0x5e918e)=>{var _0x2adaf5=_0xc82c83;_0xe236a[_0x5e918e][_0x2adaf5(0x1e7)]=_0x8e4b2a;}),_0x1b1f94[_0xc82c83(0x271)]((_0x243160,_0x28a200)=>{var _0x2e2638=_0xc82c83;_0xe236a[_0x28a200][_0x2e2638(0x1cf)]=_0x243160;}),_0x1012e7[_0xc82c83(0x271)]((_0x708968,_0x597db3)=>{var _0x2a9161=_0xc82c83;_0xe236a[_0x597db3][_0x2a9161(0x1ce)]=_0x708968;}),_0x5cdbea[_0xc82c83(0x271)]((_0x64b44c,_0x1a7755)=>{_0xe236a[_0x1a7755]['maxProducts']=_0x64b44c;}),_0xf2e5f9['forEach']((_0x12c864,_0x24fe87)=>{var _0xb45da5=_0xc82c83;_0xe236a[_0x24fe87][_0xb45da5(0x1dc)]=_0x12c864;}),_0x152189[_0xc82c83(0x271)]((_0x12da36,_0x5e29ef)=>{var _0x3ab050=_0xc82c83;_0xe236a[_0x5e29ef][_0x3ab050(0x292)]=_0x12da36;}),_0x1a717a[_0xc82c83(0x271)]((_0x367838,_0xfe33bd)=>{_0xe236a[_0xfe33bd]['batch_code']=_0x367838;}),_0x38e526[_0xc82c83(0x271)]((_0x2c0711,_0x4e6fa9)=>{var _0x2114c2=_0xc82c83;_0xe236a[_0x4e6fa9][_0x2114c2(0x241)]=_0x2c0711;});const _0x4d5545=_0xe236a[_0xc82c83(0x2a0)](_0x255045=>_0x255045[_0xc82c83(0x29d)]!=='0'&&_0x255045[_0xc82c83(0x29d)]!==''||_0x255045['to_floorlevel']!=='0'&&_0x255045['to_floorlevel']!=='');var _0x48a058=0x0;_0x4d5545['forEach'](_0xc9f779=>{var _0x5d6940=_0xc82c83;parseInt(_0xc9f779[_0x5d6940(0x25e)])<parseInt(_0xc9f779['to_quantity'])&&_0x48a058++;});if(_0x48a058!=0x0)return _0x475c5d[_0xc82c83(0x20b)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x5cdb0c[_0xc82c83(0x24c)](_0xc82c83(0x274));const _0xa16eff=await warehouse[_0xc82c83(0x205)]({'name':_0x34e320['from_warehouse'],'room':_0x34e320[_0xc82c83(0x1e8)]});_0x34e320[_0xc82c83(0x235)][_0xc82c83(0x271)](_0x515a81=>{var _0x23b50c=_0xc82c83;if(_0x515a81['to_quantity']>0x0){const _0x4cb9a8=_0xa16eff[_0x23b50c(0x272)][_0x23b50c(0x298)](_0x40ad77=>{var _0x4fbe3b=_0x23b50c;_0x40ad77['product_name']==_0x515a81[_0x4fbe3b(0x237)]&&_0x40ad77[_0x4fbe3b(0x2a6)]==_0x515a81[_0x4fbe3b(0x1cb)]&&(_0x40ad77[_0x4fbe3b(0x25d)]=parseInt(_0x40ad77[_0x4fbe3b(0x25d)])+parseInt(_0x515a81['to_quantity']));});}}),await _0xa16eff[_0xc82c83(0x265)]();const _0x500cdf=await warehouse[_0xc82c83(0x205)]({'name':_0x34e320['to_warehouse'],'room':_0x34e320[_0xc82c83(0x1df)]});_0x34e320[_0xc82c83(0x235)][_0xc82c83(0x271)](_0x557803=>{var _0x2549f4=_0xc82c83;if(_0x557803[_0x2549f4(0x29d)]>0x0){const _0x1d907a=_0x500cdf[_0x2549f4(0x272)][_0x2549f4(0x298)](_0x1f76a5=>{var _0x10c343=_0x2549f4;_0x1f76a5['product_name']==_0x557803[_0x10c343(0x237)]&&_0x1f76a5[_0x10c343(0x2a6)]==_0x557803[_0x10c343(0x23b)]&&(_0x1f76a5['product_stock']=parseInt(_0x1f76a5[_0x10c343(0x25d)])-parseInt(_0x557803[_0x10c343(0x29d)]));});}}),await _0x500cdf[_0xc82c83(0x265)](),_0x34e320[_0xc82c83(0x1eb)]=_0x5e8669,_0x34e320['from_warehouse']=_0x2342da,_0x34e320[_0xc82c83(0x1ed)]=_0xd1ce7c,_0x34e320[_0xc82c83(0x235)]=_0x4d5545,_0x34e320[_0xc82c83(0x22a)]=_0x2a6507,_0x34e320['invoice']=_0x4bc0f3;const _0x591de8=await _0x34e320[_0xc82c83(0x265)](),_0x1c7a9c=await warehouse[_0xc82c83(0x205)]({'name':_0x2342da,'room':_0x270f45});_0x591de8['product'][_0xc82c83(0x271)](_0x8d58ec=>{var _0x381b13=_0xc82c83;if(_0x8d58ec[_0x381b13(0x29d)]>0x0){const _0x252f03=_0x1c7a9c[_0x381b13(0x272)]['map'](_0x25a4ef=>{var _0x5bd335=_0x381b13;_0x25a4ef['product_name']==_0x8d58ec[_0x5bd335(0x237)]&&_0x25a4ef[_0x5bd335(0x2a6)]==_0x8d58ec[_0x5bd335(0x1cb)]&&(_0x25a4ef['product_stock']=parseInt(_0x25a4ef[_0x5bd335(0x25d)])-parseInt(_0x8d58ec[_0x5bd335(0x29d)]));});}}),await _0x1c7a9c[_0xc82c83(0x265)]();const _0x531900=await warehouse['findOne']({'name':_0xd1ce7c,'room':_0x543dc2});_0x591de8[_0xc82c83(0x235)][_0xc82c83(0x271)](_0x3ad331=>{var _0x5b88d6=_0xc82c83;if(_0x3ad331[_0x5b88d6(0x29d)]>0x0){var _0x35f343=0x0;const _0x5585ba=_0x531900['product_details'][_0x5b88d6(0x298)](_0x44cdd1=>{var _0x1894ce=_0x5b88d6;_0x44cdd1['product_name']==_0x3ad331[_0x1894ce(0x237)]&&_0x44cdd1[_0x1894ce(0x2a6)]==_0x3ad331['to_bay']&&(_0x44cdd1[_0x1894ce(0x25d)]=parseInt(_0x44cdd1['product_stock'])+parseInt(_0x3ad331[_0x1894ce(0x29d)]),_0x35f343++);});_0x35f343=='0'&&(_0x531900[_0x5b88d6(0x272)]=_0x531900[_0x5b88d6(0x272)][_0x5b88d6(0x20f)]({'product_name':_0x3ad331[_0x5b88d6(0x237)],'product_stock':_0x3ad331[_0x5b88d6(0x29d)],'bay':_0x3ad331[_0x5b88d6(0x23b)],'product_code':_0x3ad331[_0x5b88d6(0x1ce)],'primary_code':_0x3ad331[_0x5b88d6(0x1e7)],'secondary_code':_0x3ad331[_0x5b88d6(0x1cf)],'maxProducts':_0x3ad331['maxProducts']}));}}),await _0x531900[_0xc82c83(0x265)](),_0x475c5d[_0xc82c83(0x20b)](_0xc82c83(0x236),_0xc82c83(0x255)),_0x5cdb0c[_0xc82c83(0x24c)](_0xc82c83(0x21a));}catch(_0x4afc3a){console[_0xc82c83(0x211)](_0x4afc3a);}}),router[a0_0x271b30(0x1e3)](a0_0x271b30(0x1de),async(_0x1bcb6e,_0x35d8df)=>{var _0x1f59b8=a0_0x271b30;const {FromWareHouse:_0x1481c9,FromRoom:_0x341395,ToWarehouse:_0x430a4f,ToRoom:_0x17ec64,primary_code:_0x502071,Roomslist:_0x51a90d}=_0x1bcb6e[_0x1f59b8(0x243)],_0x399874=_0x51a90d[_0x1f59b8(0x213)](','),_0x1dec07=[];async function _0x3541c1(_0x216fc4){var _0x367e12=_0x1f59b8;const _0x1d3735=await warehouse['aggregate']([{'$match':{'name':_0x1481c9,'room':_0x216fc4}},{'$unwind':_0x367e12(0x270)},{'$match':{'product_details.primary_code':_0x502071}},{'$group':{'_id':_0x367e12(0x254),'name':{'$first':_0x367e12(0x1cc)},'instock':{'$first':_0x367e12(0x28e)},'primary_code':{'$first':_0x367e12(0x240)},'secondary_code':{'$first':_0x367e12(0x1d8)},'product_code':{'$first':_0x367e12(0x1f0)},'level':{'$first':_0x367e12(0x1e0)},'isle':{'$first':_0x367e12(0x232)},'type':{'$first':_0x367e12(0x1fe)},'pallet':{'$first':_0x367e12(0x287)},'unit':{'$first':_0x367e12(0x230)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x367e12(0x29c)},'rack':{'$first':_0x367e12(0x1d4)},'expiry_date':{'$first':_0x367e12(0x21d)},'production_date':{'$first':_0x367e12(0x215)},'batch_code':{'$first':_0x367e12(0x291)},'maxPerUnit':{'$first':_0x367e12(0x1e2)},'roomNamed':{'$first':_0x367e12(0x27c)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x367e12(0x239)}}}]),_0x4e0d70=await warehouse[_0x367e12(0x251)]([{'$match':{'name':_0x1481c9,'room':_0x216fc4}},{'$unwind':_0x367e12(0x270)},{'$match':{'product_details.secondary_code':_0x502071}},{'$group':{'_id':_0x367e12(0x254),'name':{'$first':_0x367e12(0x1cc)},'instock':{'$first':_0x367e12(0x28e)},'primary_code':{'$first':_0x367e12(0x240)},'secondary_code':{'$first':_0x367e12(0x1d8)},'product_code':{'$first':_0x367e12(0x1f0)},'level':{'$first':_0x367e12(0x1e0)},'isle':{'$first':_0x367e12(0x232)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x367e12(0x287)},'unit':{'$first':_0x367e12(0x230)},'secondary_unit':{'$first':_0x367e12(0x21c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x367e12(0x215)},'batch_code':{'$first':_0x367e12(0x291)},'maxPerUnit':{'$first':_0x367e12(0x1e2)},'roomNamed':{'$first':_0x367e12(0x27c)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x367e12(0x239)}}}]);if(_0x1d3735[_0x367e12(0x20c)]>0x0)_0x1dec07[_0x367e12(0x203)](_0x1d3735);else _0x4e0d70[_0x367e12(0x20c)]>0x0&&_0x1dec07[_0x367e12(0x203)](_0x4e0d70);}const _0x470199=_0x399874[_0x1f59b8(0x298)](_0x33d44c=>_0x3541c1(_0x33d44c));await Promise[_0x1f59b8(0x296)](_0x470199),_0x35d8df['json'](_0x1dec07);}),router[a0_0x271b30(0x1e3)](a0_0x271b30(0x1d1),async(_0x27c9df,_0x41a206)=>{var _0x53f241=a0_0x271b30;try{const {FromWareHouse:_0x1e423f,FromRoom:_0x18dd75,ToWarehouse:_0xc7b232,ToRoom:_0x2636bd,secondary_code:_0x5ab0dd}=_0x27c9df[_0x53f241(0x243)],_0x4302dd=await warehouse[_0x53f241(0x251)]([{'$match':{'name':_0x1e423f}},{'$unwind':_0x53f241(0x270)},{'$match':{'product_details.secondary_code':_0x5ab0dd}},{'$group':{'_id':_0x53f241(0x254),'name':{'$first':_0x53f241(0x1cc)},'primary_code':{'$first':_0x53f241(0x240)},'secondary_code':{'$first':_0x53f241(0x1d8)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x53f241(0x28e)},'warehouse':{'$first':_0x53f241(0x1d0)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x53f241(0x293)},'pallet':{'$first':_0x53f241(0x1db)},'maxProducts':{'$first':_0x53f241(0x22e)},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x53f241(0x21d)},'production_date':{'$first':_0x53f241(0x215)}}}]);_0x41a206['status'](0xc8)[_0x53f241(0x20e)](_0x4302dd);}catch(_0x2e5207){_0x41a206['status'](0x194)[_0x53f241(0x20e)]({'message':_0x2e5207[_0x53f241(0x22f)]});}}),router[a0_0x271b30(0x1e3)](a0_0x271b30(0x2b0),async(_0x52abc0,_0xb90156)=>{var _0x346d3c=a0_0x271b30;try{const {FromWareHouse:_0x5056f2,FromRoom:_0x437f93,ToWarehouse:_0xae64e3,ToRoom:_0x1fd269,product_code:_0x2532dc}=_0x52abc0[_0x346d3c(0x243)],_0x591a85=await warehouse[_0x346d3c(0x251)]([{'$match':{'name':_0x5056f2}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x2532dc}},{'$group':{'_id':_0x346d3c(0x254),'name':{'$first':_0x346d3c(0x1cc)},'primary_code':{'$first':_0x346d3c(0x240)},'secondary_code':{'$first':_0x346d3c(0x1d8)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x346d3c(0x28e)},'warehouse':{'$first':_0x346d3c(0x1d0)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x346d3c(0x1db)},'maxProducts':{'$first':_0x346d3c(0x22e)},'unit':{'$first':'$product_details.unit'}}}]);_0xb90156['status'](0xc8)['json'](_0x591a85);}catch(_0x4ab37b){_0xb90156[_0x346d3c(0x214)](0x194)['json']({'message':_0x4ab37b[_0x346d3c(0x22f)]});}}),router[a0_0x271b30(0x1e3)](a0_0x271b30(0x28b),async(_0x155644,_0x3750f2)=>{var _0x3fc054=a0_0x271b30;const {productCode:_0x222dcd,bay:_0x51f85f,warehouses:_0x59ee39,room:_0x2b6222}=_0x155644['body'];console['log'](_0x155644['body']);try{const _0x2cede7=await warehouse[_0x3fc054(0x251)]([{'$match':{'name':_0x59ee39,'room':_0x2b6222}},{'$unwind':_0x3fc054(0x270)},{'$match':{'product_details.bay':parseInt(_0x51f85f)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3fc054(0x28e)},'bay':{'$first':_0x3fc054(0x1e0)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3750f2['status'](0xc8)[_0x3fc054(0x20e)](_0x2cede7);}catch(_0x4d33cd){_0x3750f2['status'](0x194)[_0x3fc054(0x20e)]({'message':_0x4d33cd['message']});}}),module[a0_0x271b30(0x1d6)]=router;