var a0_0x137a18=a0_0x3e3a;(function(_0x3e10b8,_0x14715c){var _0x6467bb=a0_0x3e3a,_0x2063b8=_0x3e10b8();while(!![]){try{var _0x34002e=parseInt(_0x6467bb(0x230))/0x1*(parseInt(_0x6467bb(0x226))/0x2)+parseInt(_0x6467bb(0x2b7))/0x3*(parseInt(_0x6467bb(0x241))/0x4)+-parseInt(_0x6467bb(0x214))/0x5+parseInt(_0x6467bb(0x1fc))/0x6*(parseInt(_0x6467bb(0x20e))/0x7)+-parseInt(_0x6467bb(0x27c))/0x8+-parseInt(_0x6467bb(0x2a5))/0x9+parseInt(_0x6467bb(0x20f))/0xa*(parseInt(_0x6467bb(0x245))/0xb);if(_0x34002e===_0x14715c)break;else _0x2063b8['push'](_0x2063b8['shift']());}catch(_0x5372cb){_0x2063b8['push'](_0x2063b8['shift']());}}}(a0_0x2685,0x684e4));const express=require('express'),app=express(),router=express[a0_0x137a18(0x255)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x137a18(0x201)),auth=require(a0_0x137a18(0x246)),users=require(a0_0x137a18(0x2b9)),nodemailer=require(a0_0x137a18(0x234));router[a0_0x137a18(0x217)](a0_0x137a18(0x259),auth,async(_0x59b7b8,_0x374119)=>{var _0x54451a=a0_0x137a18;try{const {username:_0x49eaf9,email:_0x4d31b0,role:_0xc9d3fa}=_0x59b7b8[_0x54451a(0x2ad)],_0x995396=_0x59b7b8[_0x54451a(0x2ad)],_0x57a70f=await profile[_0x54451a(0x298)]({'email':_0x995396[_0x54451a(0x204)]}),_0x33d82c=await master_shop['find']();let _0x595769;if(_0x995396['role']==_0x54451a(0x1fd)){const _0x3e30ba=await staff[_0x54451a(0x298)]({'email':_0x995396[_0x54451a(0x204)]});_0x595769=await transfers_finished['find']({'from_warehouse':_0x3e30ba[_0x54451a(0x27d)]});}else _0x595769=await transfers_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x54451a(0x22b),'invoice':{'$first':_0x54451a(0x1fb)},'date':{'$first':_0x54451a(0x281)},'from_warehouse':{'$first':_0x54451a(0x1fa)},'to_warehouse':{'$first':_0x54451a(0x235)},'from_room_name':{'$addToSet':_0x54451a(0x267)},'to_room_name':{'$addToSet':_0x54451a(0x23b)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x33d82c[0x0][_0x54451a(0x210)]==_0x54451a(0x213))var _0x41cb61=users[_0x54451a(0x20b)];else{if(_0x33d82c[0x0][_0x54451a(0x210)]=='Hindi')var _0x41cb61=users['Hindi'];else{if(_0x33d82c[0x0][_0x54451a(0x210)]==_0x54451a(0x1e6))var _0x41cb61=users[_0x54451a(0x1e6)];else{if(_0x33d82c[0x0][_0x54451a(0x210)]=='Spanish')var _0x41cb61=users[_0x54451a(0x209)];else{if(_0x33d82c[0x0][_0x54451a(0x210)]==_0x54451a(0x2a2))var _0x41cb61=users[_0x54451a(0x2a2)];else{if(_0x33d82c[0x0]['language']=='Portuguese\x20(BR)')var _0x41cb61=users[_0x54451a(0x233)];else{if(_0x33d82c[0x0][_0x54451a(0x210)]=='Chinese')var _0x41cb61=users['Chinese'];else{if(_0x33d82c[0x0][_0x54451a(0x210)]==_0x54451a(0x237))var _0x41cb61=users[_0x54451a(0x26c)];}}}}}}}_0x374119['render'](_0x54451a(0x292),{'success':_0x59b7b8[_0x54451a(0x222)]('success'),'errors':_0x59b7b8['flash'](_0x54451a(0x223)),'role':_0x995396,'profile':_0x57a70f,'master_shop':_0x33d82c,'transfer':_0x595769,'language':_0x41cb61});}catch(_0x4ea962){console[_0x54451a(0x1ec)](_0x4ea962);}});async function getRandom8DigitNumber(){var _0x5d7708=a0_0x137a18;const _0x2c6c74=0x989680,_0x13b131=0x5f5e0ff,_0x530eef=Math['floor'](Math[_0x5d7708(0x1e9)]()*(_0x13b131-_0x2c6c74+0x1))+_0x2c6c74;var _0x94a041;const _0x47bb75=await transfers_finished[_0x5d7708(0x298)]({'invoice':_0x5d7708(0x28c)+_0x530eef});return _0x47bb75&&_0x47bb75['length']>0x0?_0x94a041=_0x5d7708(0x28c)+_0x530eef:_0x94a041=_0x5d7708(0x28c)+_0x530eef,_0x94a041;}function a0_0x2685(){var _0x57cacd=['max','$_id','secondary_code','/transfer_finished/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.secondary_unit','377686MqVYfE','$product_details.product_code','maxPerUnit','Portuguese','nodemailer','$to_warehouse','$product_details.bay','Arabic\x20(ae)','to_quantity','error','from_quantity','$product.to_room_name','</tr>','$room','$product_details.floorlevel','invoice','to_bay','156hFGPZM','/barcode_scanner2','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</tbody>','4246htVFaJ','../middleware/auth','expiry_date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','undefined','params','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<html><head><title></title>','edit_transfer_finished_view','note','$product_details.maxPerUnit','post','</td>','\x20<>\x20','Hindi','success','Router','</div>','/view/:id','Chinese','/view','port','to_room_name','to_invoice','product_name','prod_cat','Error\x20Occurs','password','redirect','True','Transfer\x20Edit\x20Successfully','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.production_date','find','$product.from_room_name','from_invoice','then','$product_details.expiry_date','bay','Arabic','findById','$name','$product_details.level','Enclosed','To_invoice','$product_details.maxProducts','FROZEN\x20GOODS','primary_unit','MaxStocks_data','$product_details.secondary_code','abs','product_code3','primary_code','<h5>','to_room','1831200UEVMFS','warehouse','$product_details','/CheckingWarehouse','map','$date','secondary_unit','Finished\x20Goods','/upload/','exports','product_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','MaxStocks_data2','$product_details.unit','FGSEmail','TRFF-','<span\x20style=\x22float:\x20right;\x22>','</thead>','toString','_id','product_date','transfer_finished','production_date','/barcode_scanner3','add_transfer_finished','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','findOne','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','id_transaction','<tr>','from_room','body','save','QA\x20Warehouse','to_prod_qty','French','aggregate','logo','6508665Gjohyq','updateOne','push','An\x20error\x20occurred.','Rack\x201','\x20Order\x20Date\x20:\x20','from_bay','host','user','/picking_list/PDF_transfer/','message','/preview/:id','product_details','/view/add_transfer','from_warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','split','$product_details.batch_code','28452EMxPUe','string','../public/language/languages.json','filter','$product_details.rack','edit_transfer_finished','DRY\x20GOODS','/transfer_finished/view','unit','\x20Order\x20Number\x20:\x20','createTransport','</table>','$product_details.product_stock','forEach','$product_details.type','concat','<strong>\x20Regards\x20</strong>','ToRoomAssigned','German','Enabled','Transfer\x20Finalize\x20Successfully','random','from_prod_qty','batch_code','log','to_floorlevel','Ambient','here2','length','New_Qty_Converted','from_room_name','getFullYear','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<!DOCTYPE\x20html>','$product_details.primary_code','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details._id','all','$from_warehouse','$invoice','6xtwmyj','staff','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','to_prod_level','../models/all_models','<h5\x20style=\x22text-align:\x20left;\x22>','from_prod_level','email','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.invoice','product_stock','<div>','Spanish','$product_details.isle','English','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/../public','4418407VMNUSL','7330wbbqmT','language','render','maxProducts','English\x20(US)','1411900JKkciW','$product_details.bin','padStart','get','$product_details.product_name','</h5>','back','catch','date','$product_details.pallet','status','$product_details.storage','Email\x20sent\x20successfully','role','flash','errors','prod_name','getMonth','2wcedGe','to_warehouse','site_title','Product\x20Transfer\x20successfully'];a0_0x2685=function(){return _0x57cacd;};return a0_0x2685();}router['get'](a0_0x137a18(0x2b2),auth,async(_0x556e6f,_0x3cd4ba)=>{var _0x13995f=a0_0x137a18;try{const {username:_0x49416c,email:_0x2cec43,role:_0x5ae65f}=_0x556e6f[_0x13995f(0x2ad)],_0x1defee=_0x556e6f[_0x13995f(0x2ad)],_0x804212=await profile['findOne']({'email':_0x1defee['email']}),_0x545c31=await master_shop[_0x13995f(0x266)]();let _0xe7e935;if(_0x1defee[_0x13995f(0x221)]==_0x13995f(0x1fd)){const _0x30d424=await staff['findOne']({'email':_0x1defee[_0x13995f(0x204)]});_0xe7e935=await warehouse[_0x13995f(0x2a3)]([{'$match':{'status':_0x13995f(0x1e7),'name':_0x30d424[_0x13995f(0x27d)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x13995f(0x26e),'name':{'$first':_0x13995f(0x26e)}}}]);}else _0xe7e935=await warehouse['aggregate']([{'$match':{'status':_0x13995f(0x1e7),'warehouse_category':_0x13995f(0x283),'name':{'$ne':_0x13995f(0x2a0)}}},{'$group':{'_id':_0x13995f(0x26e),'name':{'$first':_0x13995f(0x26e)}}}]);const _0x13a6e3=await transfers_finished[_0x13995f(0x266)]({}),_0x75504a=_0x13a6e3['length']+0x1,_0x3703ba='TRFF-'+_0x75504a[_0x13995f(0x28f)]()[_0x13995f(0x216)](0x5,'0');if(_0x545c31[0x0][_0x13995f(0x210)]==_0x13995f(0x213))var _0x4d9dd1=users[_0x13995f(0x20b)];else{if(_0x545c31[0x0][_0x13995f(0x210)]=='Hindi')var _0x4d9dd1=users[_0x13995f(0x253)];else{if(_0x545c31[0x0]['language']==_0x13995f(0x1e6))var _0x4d9dd1=users[_0x13995f(0x1e6)];else{if(_0x545c31[0x0][_0x13995f(0x210)]==_0x13995f(0x209))var _0x4d9dd1=users['Spanish'];else{if(_0x545c31[0x0]['language']=='French')var _0x4d9dd1=users[_0x13995f(0x2a2)];else{if(_0x545c31[0x0][_0x13995f(0x210)]=='Portuguese\x20(BR)')var _0x4d9dd1=users[_0x13995f(0x233)];else{if(_0x545c31[0x0]['language']==_0x13995f(0x258))var _0x4d9dd1=users[_0x13995f(0x258)];else{if(_0x545c31[0x0][_0x13995f(0x210)]==_0x13995f(0x237))var _0x4d9dd1=users[_0x13995f(0x26c)];}}}}}}}const _0x219d39=getRandom8DigitNumber();_0x219d39['then'](_0x187d79=>{var _0x4a5d8b=_0x13995f;_0x3cd4ba[_0x4a5d8b(0x211)](_0x4a5d8b(0x295),{'success':_0x556e6f[_0x4a5d8b(0x222)](_0x4a5d8b(0x254)),'errors':_0x556e6f[_0x4a5d8b(0x222)](_0x4a5d8b(0x223)),'role':_0x1defee,'profile':_0x804212,'master_shop':_0x545c31,'warehouse':_0xe7e935,'language':_0x4d9dd1,'invoice':_0x187d79});})[_0x13995f(0x21b)](_0x5452da=>{var _0x2b4086=_0x13995f;_0x556e6f[_0x2b4086(0x222)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3cd4ba[_0x2b4086(0x261)]('/transfer/view');});}catch(_0x5b3a6b){console[_0x13995f(0x1ec)](_0x5b3a6b);}}),router['post']('/view/add_transfer',auth,async(_0x1e959d,_0x4332f1)=>{var _0x341f57=a0_0x137a18;try{const {date:_0x5830ce,from_warehouse:_0x50516a,FromRoom_name:_0x146bb5,to_warehouse:_0x31675f,ToRoom_name:_0x3ed6f0,prod_name:_0x7cbc13,from_prod_qty:_0x64b4fd,from_prod_level:_0x5b9bcc,from_prod_isle:_0x148c6e,from_prod_pallet:_0x595af8,to_prod_qty:_0xef6bfe,to_prod_level:_0xadf056,to_prod_isle:_0x27e810,to_prod_pallet:_0x4a37bb,primary_code:_0x478315,secondary_code:_0x4f5caa,product_code3:_0x14e11a,note:_0x6f15d8,MaxStocks_data2:_0x57503b,invoice:_0x164440,expiry_date:_0x44cd93}=_0x1e959d['body'];if(typeof _0x7cbc13==_0x341f57(0x2b8))var _0x1b5f95=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x224)]],_0x389a8d=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1ea)]],_0x31920d=[_0x1e959d[_0x341f57(0x29e)]['from_prod_level']],_0x5725ef=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1f1)]],_0x4a0594=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x200)]],_0x2354a5=[_0x1e959d[_0x341f57(0x29e)]['primary_code']],_0x3b45f6=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x22c)]],_0x156551=[_0x1e959d[_0x341f57(0x29e)]['product_code3']],_0x4904cf=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x289)]],_0x1bbe96=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x274)]],_0x49f7cd=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x282)]],_0x36fccf=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1eb)]],_0x139823=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x247)]],_0x2d3af4=[_0x1e959d[_0x341f57(0x29e)]['product_date']],_0x4ec465=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x275)]],_0x2e3d8a=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x232)]],_0x3b2d5d=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x25e)]],_0x2ee1a2=[_0x1e959d[_0x341f57(0x29e)]['RoomAssigned']],_0x569bef=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1e5)]],_0x1def36=[_0x1e959d[_0x341f57(0x29e)][_0x341f57(0x268)]],_0x344d6c=[_0x1e959d['body'][_0x341f57(0x25c)]],_0x347987=[_0x1e959d['body']['id_transaction']];else var _0x1b5f95=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x224)]],_0x389a8d=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1ea)]],_0x31920d=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x203)]],_0x5725ef=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1f1)]],_0x4a0594=[..._0x1e959d['body'][_0x341f57(0x200)]],_0x2354a5=[..._0x1e959d['body'][_0x341f57(0x279)]],_0x3b45f6=[..._0x1e959d['body']['secondary_code']],_0x156551=[..._0x1e959d['body'][_0x341f57(0x278)]],_0x4904cf=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x289)]],_0x1bbe96=[..._0x1e959d[_0x341f57(0x29e)]['primary_unit']],_0x49f7cd=[..._0x1e959d[_0x341f57(0x29e)]['secondary_unit']],_0x36fccf=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x1eb)]],_0x139823=[..._0x1e959d['body'][_0x341f57(0x247)]],_0x2d3af4=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x291)]],_0x4ec465=[..._0x1e959d['body'][_0x341f57(0x275)]],_0x2e3d8a=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x232)]],_0x3b2d5d=[..._0x1e959d['body'][_0x341f57(0x25e)]],_0x2ee1a2=[..._0x1e959d[_0x341f57(0x29e)]['RoomAssigned']],_0x569bef=[..._0x1e959d[_0x341f57(0x29e)]['ToRoomAssigned']],_0x1def36=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x268)]],_0x344d6c=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x25c)]],_0x347987=[..._0x1e959d[_0x341f57(0x29e)][_0x341f57(0x29b)]];const _0x56e9ff=_0x1b5f95['map'](_0x50b69d=>{return _0x50b69d={'product_name':_0x50b69d};});_0x389a8d['forEach']((_0x11c6ec,_0x4a0b17)=>{var _0x3c09e7=_0x341f57;_0x56e9ff[_0x4a0b17][_0x3c09e7(0x23a)]=_0x11c6ec;}),_0x31920d[_0x341f57(0x1e1)]((_0x1ffa16,_0x349568)=>{var _0x2f1491=_0x341f57;_0x56e9ff[_0x349568][_0x2f1491(0x2ab)]=_0x1ffa16;}),_0x347987[_0x341f57(0x1e1)]((_0x1d65ca,_0x5e3777)=>{var _0x2fb77e=_0x341f57;_0x56e9ff[_0x5e3777][_0x2fb77e(0x29b)]=_0x1d65ca;}),_0x1def36[_0x341f57(0x1e1)]((_0x9d7031,_0x4ca8f0)=>{_0x56e9ff[_0x4ca8f0]['from_invoice']=_0x9d7031;}),_0x344d6c['forEach']((_0x565c2b,_0x3766a0)=>{_0x56e9ff[_0x3766a0]['To_invoice']=_0x565c2b;}),_0x5725ef[_0x341f57(0x1e1)]((_0x1bc45e,_0x95dcbe)=>{var _0x6ccf1f=_0x341f57;_0x56e9ff[_0x95dcbe][_0x6ccf1f(0x238)]=_0x1bc45e;}),_0x4a0594[_0x341f57(0x1e1)]((_0x42f94f,_0x261f6c)=>{var _0x529a35=_0x341f57;_0x56e9ff[_0x261f6c][_0x529a35(0x240)]=_0x42f94f;}),_0x2354a5['forEach']((_0x44835c,_0x3fbd0d)=>{var _0x149061=_0x341f57;_0x56e9ff[_0x3fbd0d][_0x149061(0x279)]=_0x44835c;}),_0x3b45f6[_0x341f57(0x1e1)]((_0x4224a3,_0x58ead1)=>{var _0x3ac237=_0x341f57;_0x56e9ff[_0x58ead1][_0x3ac237(0x22c)]=_0x4224a3;}),_0x156551['forEach']((_0x3985a9,_0x102fdc)=>{var _0xa30131=_0x341f57;_0x56e9ff[_0x102fdc][_0xa30131(0x286)]=_0x3985a9;}),_0x4904cf['forEach']((_0x3dd966,_0x46f8b4)=>{var _0x1d91ce=_0x341f57;_0x56e9ff[_0x46f8b4][_0x1d91ce(0x212)]=_0x3dd966;}),_0x1bbe96['forEach']((_0x6d4e8c,_0x345687)=>{var _0x2c23ee=_0x341f57;_0x56e9ff[_0x345687][_0x2c23ee(0x2bf)]=_0x6d4e8c;}),_0x49f7cd[_0x341f57(0x1e1)]((_0x119360,_0x59db96)=>{var _0x5b4c14=_0x341f57;_0x56e9ff[_0x59db96][_0x5b4c14(0x282)]=_0x119360;}),_0x36fccf['forEach']((_0x10de15,_0x2c7e7e)=>{var _0x558abe=_0x341f57;_0x56e9ff[_0x2c7e7e][_0x558abe(0x1eb)]=_0x10de15;}),_0x139823['forEach']((_0x5bbba7,_0x63c28b)=>{_0x56e9ff[_0x63c28b]['expiry_date']=_0x5bbba7;}),_0x2d3af4[_0x341f57(0x1e1)]((_0x3e5d67,_0x14f1e6)=>{_0x56e9ff[_0x14f1e6]['production_date']=_0x3e5d67;}),_0x4ec465[_0x341f57(0x1e1)]((_0x4e88a3,_0xbe1e84)=>{var _0x2c84a0=_0x341f57;_0x56e9ff[_0xbe1e84][_0x2c84a0(0x212)]=_0x4e88a3;}),_0x2e3d8a[_0x341f57(0x1e1)]((_0x580f83,_0x780a5)=>{var _0x55970d=_0x341f57;_0x56e9ff[_0x780a5][_0x55970d(0x232)]=_0x580f83;}),_0x3b2d5d[_0x341f57(0x1e1)]((_0x277819,_0x521024)=>{_0x56e9ff[_0x521024]['prod_cat']=_0x277819;}),_0x2ee1a2[_0x341f57(0x1e1)]((_0x511d5e,_0x3052c3)=>{_0x56e9ff[_0x3052c3]['from_room_name']=_0x511d5e;}),_0x569bef['forEach']((_0x5f5bc0,_0x3305c8)=>{_0x56e9ff[_0x3305c8]['to_room_name']=_0x5f5bc0;});const _0x2476d7=_0x56e9ff[_0x341f57(0x2ba)](_0x5710c6=>_0x5710c6[_0x341f57(0x238)]!=='0'&&_0x5710c6['to_quantity']!==''||_0x5710c6[_0x341f57(0x1ed)]!=='0'&&_0x5710c6[_0x341f57(0x1ed)]!=='');var _0x37a9c0=0x0;_0x2476d7[_0x341f57(0x1e1)](_0x59f6ce=>{var _0x2f0c63=_0x341f57;parseInt(_0x59f6ce[_0x2f0c63(0x23a)])<parseInt(_0x59f6ce[_0x2f0c63(0x238)])&&_0x37a9c0++;});if(_0x37a9c0!=0x0)return _0x1e959d['flash'](_0x341f57(0x223),_0x341f57(0x1f7)),_0x4332f1[_0x341f57(0x261)](_0x341f57(0x21a));const _0x2eabda=new transfers_finished({'date':_0x5830ce,'from_warehouse':_0x50516a,'to_warehouse':_0x31675f,'product':_0x2476d7,'note':_0x6f15d8,'invoice':_0x164440}),_0x1cd821=await _0x2eabda['save']();_0x1e959d['flash'](_0x341f57(0x254),_0x341f57(0x229)),_0x4332f1['redirect'](_0x341f57(0x22d)+_0x1cd821[_0x341f57(0x290)]);}catch(_0x59f6b2){console[_0x341f57(0x1ec)](_0x59f6b2),_0x4332f1[_0x341f57(0x21e)](0xc8)[_0x341f57(0x1fe)]({'errorMessage':_0x59f6b2[_0x341f57(0x2af)]});}}),router[a0_0x137a18(0x217)](a0_0x137a18(0x2b0),auth,async(_0x47a5fd,_0x11fc98)=>{var _0x397f8d=a0_0x137a18;try{const {username:_0x34dc28,email:_0x5952de,role:_0x3b50fd}=_0x47a5fd[_0x397f8d(0x2ad)],_0x5a87aa=_0x47a5fd[_0x397f8d(0x2ad)],_0x484d6e=await profile['findOne']({'email':_0x5a87aa[_0x397f8d(0x204)]}),_0x25cf69=await master_shop['find'](),_0x10dd47=await transfers_finished['findById'](_0x47a5fd[_0x397f8d(0x24a)]['id']);let _0x49f5b4;if(_0x5a87aa['role']==_0x397f8d(0x1fd)){const _0x3d32bf=await staff['findOne']({'email':_0x5a87aa['email']});_0x49f5b4=await warehouse[_0x397f8d(0x266)]({'status':_0x397f8d(0x1e7),'name':_0x3d32bf[_0x397f8d(0x27d)],'warehouse_category':_0x397f8d(0x283)});}else _0x49f5b4=await warehouse[_0x397f8d(0x266)]({'status':_0x397f8d(0x1e7),'warehouse_category':_0x397f8d(0x283)});const _0x5b3d5e=await warehouse[_0x397f8d(0x2a3)]([{'$match':{'name':_0x10dd47['from_warehouse'],'warehouse_category':_0x397f8d(0x283)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x397f8d(0x1f8),'name':{'$first':_0x397f8d(0x218)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x397f8d(0x236)},'bin':{'$first':_0x397f8d(0x215)},'type':{'$first':_0x397f8d(0x1e2)},'floorlevel':{'$first':_0x397f8d(0x23e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x397f8d(0x276)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x397f8d(0x21f)},'rack':{'$first':_0x397f8d(0x2bb)},'expiry_date':{'$first':_0x397f8d(0x26a)},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':_0x397f8d(0x23d)},'warehoue_name':{'$first':_0x397f8d(0x26e)}}}]),_0x6d6d6f=await product[_0x397f8d(0x266)]({});if(_0x25cf69[0x0][_0x397f8d(0x210)]==_0x397f8d(0x213)){var _0x4574c0=users[_0x397f8d(0x20b)];console['log'](_0x4574c0);}else{if(_0x25cf69[0x0][_0x397f8d(0x210)]=='Hindi')var _0x4574c0=users[_0x397f8d(0x253)];else{if(_0x25cf69[0x0][_0x397f8d(0x210)]==_0x397f8d(0x1e6))var _0x4574c0=users['German'];else{if(_0x25cf69[0x0][_0x397f8d(0x210)]==_0x397f8d(0x209))var _0x4574c0=users['Spanish'];else{if(_0x25cf69[0x0][_0x397f8d(0x210)]=='French')var _0x4574c0=users[_0x397f8d(0x2a2)];else{if(_0x25cf69[0x0][_0x397f8d(0x210)]=='Portuguese\x20(BR)')var _0x4574c0=users[_0x397f8d(0x233)];else{if(_0x25cf69[0x0][_0x397f8d(0x210)]==_0x397f8d(0x258))var _0x4574c0=users['Chinese'];else{if(_0x25cf69[0x0][_0x397f8d(0x210)]==_0x397f8d(0x237))var _0x4574c0=users[_0x397f8d(0x26c)];}}}}}}}_0x11fc98[_0x397f8d(0x211)](_0x397f8d(0x24d),{'success':_0x47a5fd['flash'](_0x397f8d(0x254)),'errors':_0x47a5fd['flash'](_0x397f8d(0x223)),'role':_0x5a87aa,'profile':_0x484d6e,'master_shop':_0x25cf69,'warehouse':_0x49f5b4,'transfer':_0x10dd47,'stock':_0x5b3d5e,'unit':_0x6d6d6f,'language':_0x4574c0});}catch(_0x1d24f5){console['log'](_0x1d24f5);}}),router[a0_0x137a18(0x250)]('/preview/:id',auth,async(_0x369a93,_0x43d9ce)=>{var _0x5d4268=a0_0x137a18;try{const {invoice:_0x2e6b01,from_warehouse:_0x1b52f6,FromRoom_name:_0x4d6e02,to_warehouse:_0x1b19fd,ToRoom_name:_0x3513fe}=_0x369a93[_0x5d4268(0x29e)],_0x438e1c=await transfers_finished[_0x5d4268(0x26d)](_0x369a93['params']['id']),_0x2d8420=_0x438e1c[_0x5d4268(0x296)][_0x5d4268(0x280)](async _0x29c5ff=>{var _0x3db933=_0x5d4268;if(_0x29c5ff['to_quantity']>0x0){var _0x5474cd=await warehouse[_0x3db933(0x298)]({'name':_0x1b52f6,'room':_0x29c5ff[_0x3db933(0x1f2)],'warehouse_category':_0x3db933(0x283)});const _0x5bdc52=_0x5474cd[_0x3db933(0x2b1)][_0x3db933(0x280)](_0x314117=>{var _0x39fd49=_0x3db933;_0x314117[_0x39fd49(0x25d)]==_0x29c5ff['product_name']&&_0x314117['bay']==_0x29c5ff[_0x39fd49(0x2ab)]&&_0x314117['expiry_date']==_0x29c5ff[_0x39fd49(0x247)]&&_0x314117[_0x39fd49(0x293)]==_0x29c5ff[_0x39fd49(0x293)]&&_0x314117[_0x39fd49(0x1eb)]==_0x29c5ff['batch_code']&&_0x314117[_0x39fd49(0x23f)]==_0x29c5ff[_0x39fd49(0x268)]&&(console[_0x39fd49(0x1ec)]('here1',_0x314117[_0x39fd49(0x207)]),typeof _0x29c5ff['id_transaction']==_0x39fd49(0x249)?_0x314117[_0x39fd49(0x207)]=Math[_0x39fd49(0x22a)](0x0,Math[_0x39fd49(0x277)](_0x314117[_0x39fd49(0x207)])-Math[_0x39fd49(0x277)](_0x29c5ff['to_quantity'])):_0x314117[_0x39fd49(0x207)]=Math[_0x39fd49(0x22a)](0x0,Math[_0x39fd49(0x277)](_0x314117[_0x39fd49(0x207)])-Math[_0x39fd49(0x277)](_0x29c5ff[_0x39fd49(0x238)])));});}return _0x5474cd;});Promise['all'](_0x2d8420)[_0x5d4268(0x269)](async _0x1baa71=>{var _0x4fbf24=_0x5d4268;try{for(const _0x450c06 of _0x1baa71){await _0x450c06[_0x4fbf24(0x29f)]();}const _0x1db00d=_0x438e1c['product'][_0x4fbf24(0x280)](async _0x533d51=>{var _0x41af81=_0x4fbf24,_0x211da2=await warehouse['findOne']({'name':_0x1b19fd,'room':_0x533d51['to_room_name']});if(_0x533d51[_0x41af81(0x238)]>0x0){var _0x46a2b1=0x0;const _0x2eb74b=_0x211da2[_0x41af81(0x2b1)][_0x41af81(0x280)](_0x3ff650=>{var _0x196d1e=_0x41af81;_0x3ff650['product_name']==_0x533d51[_0x196d1e(0x25d)]&&_0x3ff650['bay']==_0x533d51['to_bay']&&_0x3ff650[_0x196d1e(0x247)]==_0x533d51[_0x196d1e(0x247)]&&_0x3ff650[_0x196d1e(0x293)]==_0x533d51[_0x196d1e(0x293)]&&_0x3ff650[_0x196d1e(0x1eb)]==_0x533d51[_0x196d1e(0x1eb)]&&_0x3ff650['invoice']==_0x533d51['To_invoice']&&(typeof _0x533d51['id_transaction']==_0x196d1e(0x249)?(console['log'](_0x196d1e(0x1ef),_0x3ff650[_0x196d1e(0x207)]+_0x196d1e(0x252)+_0x3ff650['_id']+'\x20<=>\x20'+Math['abs'](_0x3ff650[_0x196d1e(0x207)])+Math[_0x196d1e(0x277)](_0x533d51['to_quantity'])),_0x3ff650[_0x196d1e(0x207)]=Math[_0x196d1e(0x277)](_0x3ff650[_0x196d1e(0x207)])+Math[_0x196d1e(0x277)](_0x533d51[_0x196d1e(0x238)])):_0x3ff650['product_stock']=Math[_0x196d1e(0x277)](_0x3ff650[_0x196d1e(0x207)])+Math['abs'](_0x533d51['to_quantity']),_0x46a2b1++);});_0x46a2b1=='0'&&(_0x211da2['product_details']=_0x211da2[_0x41af81(0x2b1)]['concat']({'product_name':_0x533d51['product_name'],'product_stock':_0x533d51['to_quantity'],'bay':_0x533d51[_0x41af81(0x240)],'product_code':_0x533d51['product_code'],'primary_code':_0x533d51[_0x41af81(0x279)],'secondary_code':_0x533d51[_0x41af81(0x22c)],'expiry_date':_0x533d51[_0x41af81(0x247)],'production_date':_0x533d51[_0x41af81(0x293)],'maxProducts':_0x533d51[_0x41af81(0x212)],'batch_code':_0x533d51[_0x41af81(0x1eb)],'secondary_unit':_0x533d51[_0x41af81(0x282)],'unit':_0x533d51['unit'],'maxProducts':_0x533d51[_0x41af81(0x212)],'maxPerUnit':_0x533d51[_0x41af81(0x232)],'invoice':_0x533d51[_0x41af81(0x271)]}));}return _0x211da2;});Promise[_0x4fbf24(0x1f9)](_0x1db00d)[_0x4fbf24(0x269)](async _0x4a1d3d=>{var _0x41e51b=_0x4fbf24;try{for(const _0x3b190c of _0x4a1d3d){await warehouse[_0x41e51b(0x2a6)]({'_id':_0x3b190c[_0x41e51b(0x290)]},{'$addToSet':{'product_details':{'$each':_0x3b190c[_0x41e51b(0x2b1)]}}});}_0x438e1c['finalize']=_0x41e51b(0x262);const _0x293dc3=await _0x438e1c[_0x41e51b(0x29f)](),_0x4f93e5=await master_shop[_0x41e51b(0x266)](),_0x58d12b=await email_settings[_0x41e51b(0x298)](),_0x26a8f9=await supervisor_settings['find']();var _0x25494e=_0x438e1c[_0x41e51b(0x296)],_0x5b791c='',_0x430068;for(_0x430068 in _0x25494e){var _0x362c91='FG';_0x438e1c['to_warehouse']==_0x41e51b(0x2bd)&&(_0x362c91='DG'),_0x5b791c+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x25494e[_0x430068]['product_name']+_0x41e51b(0x251)+_0x41e51b(0x287)+_0x25494e[_0x430068]['product_code']+_0x41e51b(0x251)+_0x41e51b(0x287)+_0x25494e[_0x430068][_0x41e51b(0x238)]+_0x41e51b(0x251)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x25494e[_0x430068][_0x41e51b(0x2bf)]+'</td>'+_0x41e51b(0x287)+_0x25494e[_0x430068][_0x41e51b(0x282)]+'</td>'+_0x41e51b(0x287)+_0x438e1c['to_warehouse']+_0x41e51b(0x251)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x25494e[_0x430068][_0x41e51b(0x25b)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x362c91+_0x25494e[_0x430068][_0x41e51b(0x240)]+'</td>'+_0x41e51b(0x23c);}let _0x2a2433=nodemailer[_0x41e51b(0x2c1)]({'host':_0x58d12b[_0x41e51b(0x2ac)],'port':Number(_0x58d12b[_0x41e51b(0x25a)]),'secure':![],'auth':{'user':_0x58d12b[_0x41e51b(0x204)],'pass':_0x58d12b[_0x41e51b(0x260)]}}),_0x1b2297={'from':_0x58d12b['email'],'to':_0x26a8f9[0x0][_0x41e51b(0x28b)],'subject':'Transfer\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x41e51b(0x20d)+_0x41e51b(0x284)+_0x4f93e5[0x0]['image'],'cid':_0x41e51b(0x2a4)}],'html':_0x41e51b(0x1f5)+_0x41e51b(0x24c)+'</head><body>'+_0x41e51b(0x208)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x41e51b(0x208)+_0x41e51b(0x20c)+_0x41e51b(0x256)+'<div>'+'<h2>\x20'+_0x4f93e5[0x0][_0x41e51b(0x228)]+'\x20</h2>'+_0x41e51b(0x256)+_0x41e51b(0x256)+'<hr\x20class=\x22my-3\x22>'+_0x41e51b(0x208)+_0x41e51b(0x202)+_0x41e51b(0x2c0)+_0x438e1c[_0x41e51b(0x23f)]+'\x20'+_0x41e51b(0x28d)+_0x41e51b(0x2aa)+_0x438e1c[_0x41e51b(0x21c)]+'\x20'+'</span>'+_0x41e51b(0x219)+_0x41e51b(0x256)+_0x41e51b(0x248)+_0x41e51b(0x1f4)+_0x41e51b(0x29c)+_0x41e51b(0x1ff)+_0x41e51b(0x22e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x41e51b(0x24b)+_0x41e51b(0x243)+_0x41e51b(0x2b4)+_0x41e51b(0x297)+_0x41e51b(0x29a)+'</tr>'+_0x41e51b(0x28e)+_0x41e51b(0x288)+'\x20'+_0x5b791c+'\x20'+_0x41e51b(0x244)+_0x41e51b(0x1df)+'<div>'+_0x41e51b(0x1e4)+_0x41e51b(0x27a)+_0x4f93e5[0x0][_0x41e51b(0x228)]+_0x41e51b(0x219)+'</div>'+_0x41e51b(0x256)+'</body></html>'};_0x2a2433['sendMail'](_0x1b2297,function(_0x59346b,_0x5f110d){var _0x4da1e3=_0x41e51b;_0x59346b?(console[_0x4da1e3(0x1ec)](_0x59346b),console[_0x4da1e3(0x1ec)](_0x4da1e3(0x25f))):console[_0x4da1e3(0x1ec)](_0x4da1e3(0x220));}),_0x369a93[_0x41e51b(0x222)]('success',_0x41e51b(0x1e8)),_0x43d9ce[_0x41e51b(0x261)](_0x41e51b(0x2ae)+_0x293dc3[_0x41e51b(0x290)]);}catch(_0x5efa31){console['error'](_0x5efa31),_0x43d9ce[_0x41e51b(0x21e)](0x1f4)[_0x41e51b(0x1fe)]({'error':_0x41e51b(0x205)});}})[_0x4fbf24(0x21b)](_0x306088=>{var _0x336663=_0x4fbf24;console[_0x336663(0x239)](_0x306088),_0x43d9ce['status'](0x1f4)[_0x336663(0x1fe)]({'error':_0x336663(0x2a8)});});}catch(_0x76bd8a){console[_0x4fbf24(0x239)](_0x76bd8a),_0x43d9ce[_0x4fbf24(0x21e)](0x1f4)['json']({'error':_0x4fbf24(0x264)});}})['catch'](_0x4aa5a1=>{var _0x2ce30e=_0x5d4268;console[_0x2ce30e(0x239)](_0x4aa5a1),_0x43d9ce[_0x2ce30e(0x21e)](0x1f4)[_0x2ce30e(0x1fe)]({'error':_0x2ce30e(0x2a8)});});}catch(_0x1ef105){_0x43d9ce[_0x5d4268(0x1fe)]({'message':_0x1ef105['message']});}});function a0_0x3e3a(_0x868e16,_0x944cfc){var _0x2685ce=a0_0x2685();return a0_0x3e3a=function(_0x3e3ab0,_0x17bdcd){_0x3e3ab0=_0x3e3ab0-0x1df;var _0x987082=_0x2685ce[_0x3e3ab0];return _0x987082;},a0_0x3e3a(_0x868e16,_0x944cfc);}function BayBinSelected(_0x41ce46,_0x11f982){var _0x41afdc=a0_0x137a18,_0x4fbefe=[];let _0x5d7bb8=[];var _0x52e819=[];if(_0x41ce46==_0x41afdc(0x2bd)){switch(_0x11f982){case _0x41afdc(0x2a9):_0x4fbefe=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x4fbefe=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x52e819=['DG'];}else{if(_0x41ce46==_0x41afdc(0x273)){switch(_0x11f982){case _0x41afdc(0x2a9):_0x4fbefe=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x4fbefe=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x52e819=['FG'];}}return{'levels':_0x4fbefe,'identify':_0x52e819};}router[a0_0x137a18(0x217)](a0_0x137a18(0x257),auth,async(_0x4777e1,_0x472563)=>{var _0x13e2fa=a0_0x137a18;try{const {username:_0x294eaf,email:_0x36ec52,role:_0x6f8e73}=_0x4777e1['user'],_0x151093=_0x4777e1[_0x13e2fa(0x2ad)],_0x4e2c45=await profile[_0x13e2fa(0x298)]({'email':_0x151093[_0x13e2fa(0x204)]}),_0x39de0d=await master_shop[_0x13e2fa(0x266)](),_0x27c928=await transfers_finished[_0x13e2fa(0x26d)](_0x4777e1[_0x13e2fa(0x24a)]['id']);let _0x428c86=new Date(_0x27c928[_0x13e2fa(0x247)]),_0x4a9ba9=('0'+_0x428c86['getDate']())[_0x13e2fa(0x299)](-0x2),_0x3fd9cd=('0'+(_0x428c86[_0x13e2fa(0x225)]()+0x1))[_0x13e2fa(0x299)](-0x2),_0x1c358c=_0x428c86[_0x13e2fa(0x1f3)](),_0x57399e=_0x1c358c+'-'+_0x3fd9cd+'-'+_0x4a9ba9,_0x1db3fd;if(_0x151093['role']==_0x13e2fa(0x1fd)){const _0x19b26e=await staff[_0x13e2fa(0x298)]({'email':_0x151093[_0x13e2fa(0x204)]});_0x1db3fd=await warehouse[_0x13e2fa(0x266)]({'status':_0x13e2fa(0x1e7),'name':_0x19b26e[_0x13e2fa(0x27d)],'warehouse_category':_0x13e2fa(0x283)});}else _0x1db3fd=await warehouse[_0x13e2fa(0x266)]({'status':_0x13e2fa(0x1e7),'warehouse_category':'Finished\x20Goods'});const _0x14f66c=await warehouse[_0x13e2fa(0x2a3)]([{'$match':{'name':_0x27c928[_0x13e2fa(0x2b3)],'room':_0x27c928[_0x13e2fa(0x29d)]}},{'$unwind':_0x13e2fa(0x27e)},{'$group':{'_id':_0x13e2fa(0x1f8),'name':{'$first':_0x13e2fa(0x218)},'product_stock':{'$first':_0x13e2fa(0x1e0)},'bay':{'$first':_0x13e2fa(0x236)},'bin':{'$first':_0x13e2fa(0x215)},'type':{'$first':_0x13e2fa(0x1e2)},'floorlevel':{'$first':_0x13e2fa(0x23e)},'primary_code':{'$first':_0x13e2fa(0x1f6)},'secondary_code':{'$first':_0x13e2fa(0x276)},'product_code':{'$first':_0x13e2fa(0x231)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x13e2fa(0x2bb)}}}]);var _0x48e18f=[0x1,0x2,0x3,0x4],_0x598c5d=['A','B','C','D','E','F','G','H','I','J'],_0x135d63=[_0x13e2fa(0x1ee),_0x13e2fa(0x270)];const _0x5a5f69=await product[_0x13e2fa(0x266)]({}),_0x49ef29=BayBinSelected(_0x27c928[_0x13e2fa(0x227)],_0x27c928['to_room']);if(_0x39de0d[0x0][_0x13e2fa(0x210)]=='English\x20(US)'){var _0x2ba8e1=users['English'];console[_0x13e2fa(0x1ec)](_0x2ba8e1);}else{if(_0x39de0d[0x0][_0x13e2fa(0x210)]==_0x13e2fa(0x253))var _0x2ba8e1=users[_0x13e2fa(0x253)];else{if(_0x39de0d[0x0][_0x13e2fa(0x210)]==_0x13e2fa(0x1e6))var _0x2ba8e1=users[_0x13e2fa(0x1e6)];else{if(_0x39de0d[0x0][_0x13e2fa(0x210)]==_0x13e2fa(0x209))var _0x2ba8e1=users[_0x13e2fa(0x209)];else{if(_0x39de0d[0x0]['language']==_0x13e2fa(0x2a2))var _0x2ba8e1=users[_0x13e2fa(0x2a2)];else{if(_0x39de0d[0x0][_0x13e2fa(0x210)]=='Portuguese\x20(BR)')var _0x2ba8e1=users[_0x13e2fa(0x233)];else{if(_0x39de0d[0x0][_0x13e2fa(0x210)]==_0x13e2fa(0x258))var _0x2ba8e1=users['Chinese'];else{if(_0x39de0d[0x0][_0x13e2fa(0x210)]==_0x13e2fa(0x237))var _0x2ba8e1=users[_0x13e2fa(0x26c)];}}}}}}}_0x472563[_0x13e2fa(0x211)](_0x13e2fa(0x2bc),{'success':_0x4777e1[_0x13e2fa(0x222)]('success'),'errors':_0x4777e1[_0x13e2fa(0x222)]('errors'),'role':_0x151093,'profile':_0x4e2c45,'master_shop':_0x39de0d,'warehouse':_0x1db3fd,'transfer':_0x27c928,'stock':_0x14f66c,'unit':_0x5a5f69,'language':_0x2ba8e1,'levels':_0x48e18f,'Isle':_0x598c5d,'rooms_data':_0x135d63,'ed_fullDate':_0x57399e,'dataSelected':_0x49ef29});}catch(_0x77e30f){console[_0x13e2fa(0x1ec)](_0x77e30f);}}),router[a0_0x137a18(0x250)]('/view/:id',auth,async(_0x5be55d,_0x491481)=>{var _0x20ffb3=a0_0x137a18;try{const _0x3d5555=_0x5be55d[_0x20ffb3(0x24a)]['id'];console[_0x20ffb3(0x1ec)](_0x5be55d['body']);const _0x42c2f3=await transfers_finished[_0x20ffb3(0x26d)](_0x3d5555);console[_0x20ffb3(0x1ec)]('transfer_data',_0x42c2f3);const {date:_0x1714a5,from_warehouse:_0x9bcd86,FromRoom_name:_0x57d258,to_warehouse:_0x539a26,ToRoom_name:_0x8be581,prod_name:_0x3301de,from_prod_qty:_0x34fc2f,from_prod_level:_0x530468,from_prod_isle:_0x182c9c,from_prod_pallet:_0x375432,to_prod_qty:_0x4fa93a,to_prod_level:_0x38ea93,to_prod_isle:_0x3299ff,to_prod_pallet:_0x3afc5a,primary_code:_0x311233,secondary_code:_0x1a38e7,product_code3:_0x3aa22a,note:_0x3bb212,invoice:_0x2e71a2,expiry_date:_0x4a2a15}=_0x5be55d[_0x20ffb3(0x29e)];if(typeof _0x3301de==_0x20ffb3(0x2b8))var _0x7062e8=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x224)]],_0x37324b=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x1ea)]],_0x440c85=[_0x5be55d[_0x20ffb3(0x29e)]['from_prod_level']],_0x402826=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x2a1)]],_0x285027=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x200)]],_0x34060b=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x279)]],_0x5db1ef=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x22c)]],_0x1da00f=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x278)]],_0x10a8c1=[_0x5be55d['body'][_0x20ffb3(0x289)]],_0x32f46f=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x2bf)]],_0x3a2f23=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x282)]],_0x58ae69=[_0x5be55d['body'][_0x20ffb3(0x1eb)]],_0x4581e7=[_0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x247)]];else var _0x7062e8=[..._0x5be55d[_0x20ffb3(0x29e)]['prod_name']],_0x37324b=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x1ea)]],_0x440c85=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x203)]],_0x402826=[..._0x5be55d[_0x20ffb3(0x29e)]['to_prod_qty']],_0x285027=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x200)]],_0x34060b=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x279)]],_0x5db1ef=[..._0x5be55d['body'][_0x20ffb3(0x22c)]],_0x1da00f=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x278)]],_0x10a8c1=[..._0x5be55d[_0x20ffb3(0x29e)]['MaxStocks_data2']],_0x32f46f=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x2bf)]],_0x3a2f23=[..._0x5be55d[_0x20ffb3(0x29e)]['secondary_unit']],_0x58ae69=[..._0x5be55d['body'][_0x20ffb3(0x1eb)]],_0x4581e7=[..._0x5be55d[_0x20ffb3(0x29e)][_0x20ffb3(0x247)]];const _0x58112f=_0x7062e8[_0x20ffb3(0x280)](_0x1789cc=>{return _0x1789cc={'product_name':_0x1789cc};});_0x37324b[_0x20ffb3(0x1e1)]((_0x3b4d82,_0x2eff4c)=>{_0x58112f[_0x2eff4c]['from_quantity']=_0x3b4d82;}),_0x440c85['forEach']((_0x1ddcf9,_0x3406d7)=>{var _0x446618=_0x20ffb3;_0x58112f[_0x3406d7][_0x446618(0x2ab)]=_0x1ddcf9;}),_0x402826['forEach']((_0xe37a20,_0x3f1d0d)=>{var _0x5436c2=_0x20ffb3;_0x58112f[_0x3f1d0d][_0x5436c2(0x238)]=_0xe37a20;}),_0x285027[_0x20ffb3(0x1e1)]((_0x49dde7,_0x1f4ab1)=>{_0x58112f[_0x1f4ab1]['to_bay']=_0x49dde7;}),_0x34060b[_0x20ffb3(0x1e1)]((_0x39eee3,_0x240dab)=>{var _0x36b149=_0x20ffb3;_0x58112f[_0x240dab][_0x36b149(0x279)]=_0x39eee3;}),_0x5db1ef[_0x20ffb3(0x1e1)]((_0x2fac24,_0x2081d8)=>{var _0x2aeffe=_0x20ffb3;_0x58112f[_0x2081d8][_0x2aeffe(0x22c)]=_0x2fac24;}),_0x1da00f['forEach']((_0x4a8755,_0x50e414)=>{var _0x506ddd=_0x20ffb3;_0x58112f[_0x50e414][_0x506ddd(0x286)]=_0x4a8755;}),_0x10a8c1[_0x20ffb3(0x1e1)]((_0x460938,_0x3329a7)=>{var _0x417907=_0x20ffb3;_0x58112f[_0x3329a7][_0x417907(0x212)]=_0x460938;}),_0x32f46f['forEach']((_0x3f31e9,_0x4e6aad)=>{var _0x3c58a4=_0x20ffb3;_0x58112f[_0x4e6aad][_0x3c58a4(0x2bf)]=_0x3f31e9;}),_0x3a2f23[_0x20ffb3(0x1e1)]((_0x557e5e,_0xa64386)=>{var _0x51034b=_0x20ffb3;_0x58112f[_0xa64386][_0x51034b(0x282)]=_0x557e5e;}),_0x58ae69[_0x20ffb3(0x1e1)]((_0x52ce94,_0x1f2fa5)=>{var _0x473a55=_0x20ffb3;_0x58112f[_0x1f2fa5][_0x473a55(0x1eb)]=_0x52ce94;}),_0x4581e7[_0x20ffb3(0x1e1)]((_0x5a60f3,_0x16cff7)=>{var _0x3b60db=_0x20ffb3;_0x58112f[_0x16cff7][_0x3b60db(0x247)]=_0x5a60f3;});const _0x1fa316=_0x58112f[_0x20ffb3(0x2ba)](_0x3e0c54=>_0x3e0c54[_0x20ffb3(0x238)]!=='0'&&_0x3e0c54[_0x20ffb3(0x238)]!==''||_0x3e0c54[_0x20ffb3(0x1ed)]!=='0'&&_0x3e0c54[_0x20ffb3(0x1ed)]!=='');var _0xfc53a4=0x0;_0x1fa316[_0x20ffb3(0x1e1)](_0xbf85f5=>{var _0x122846=_0x20ffb3;parseInt(_0xbf85f5[_0x122846(0x23a)])<parseInt(_0xbf85f5['to_quantity'])&&_0xfc53a4++;});if(_0xfc53a4!=0x0)return _0x5be55d[_0x20ffb3(0x222)](_0x20ffb3(0x223),_0x20ffb3(0x1f7)),_0x491481['redirect']('back');const _0xaec7cd=await warehouse['findOne']({'name':_0x42c2f3[_0x20ffb3(0x2b3)],'room':_0x42c2f3[_0x20ffb3(0x29d)]});_0x42c2f3[_0x20ffb3(0x296)]['forEach'](_0x209645=>{var _0x3f9e82=_0x20ffb3;if(_0x209645[_0x3f9e82(0x238)]>0x0){const _0x390f6e=_0xaec7cd[_0x3f9e82(0x2b1)][_0x3f9e82(0x280)](_0x5b1a89=>{var _0xb2e9cc=_0x3f9e82;_0x5b1a89[_0xb2e9cc(0x25d)]==_0x209645[_0xb2e9cc(0x25d)]&&_0x5b1a89['bay']==_0x209645[_0xb2e9cc(0x2ab)]&&(_0x5b1a89[_0xb2e9cc(0x207)]=parseInt(_0x5b1a89[_0xb2e9cc(0x207)])+parseInt(_0x209645['to_quantity']));});}}),await _0xaec7cd[_0x20ffb3(0x29f)]();const _0x3a4bfb=await warehouse[_0x20ffb3(0x298)]({'name':_0x42c2f3[_0x20ffb3(0x227)],'room':_0x42c2f3[_0x20ffb3(0x27b)]});_0x42c2f3['product'][_0x20ffb3(0x1e1)](_0x29f70c=>{var _0x50540b=_0x20ffb3;if(_0x29f70c[_0x50540b(0x238)]>0x0){const _0x2895b1=_0x3a4bfb[_0x50540b(0x2b1)][_0x50540b(0x280)](_0x47260d=>{var _0x22f51c=_0x50540b;_0x47260d['product_name']==_0x29f70c[_0x22f51c(0x25d)]&&_0x47260d[_0x22f51c(0x26b)]==_0x29f70c[_0x22f51c(0x240)]&&(_0x47260d[_0x22f51c(0x207)]=parseInt(_0x47260d[_0x22f51c(0x207)])-parseInt(_0x29f70c[_0x22f51c(0x238)]));});}}),await _0x3a4bfb[_0x20ffb3(0x29f)](),_0x42c2f3['date']=_0x1714a5,_0x42c2f3['from_warehouse']=_0x9bcd86,_0x42c2f3[_0x20ffb3(0x227)]=_0x539a26,_0x42c2f3[_0x20ffb3(0x296)]=_0x1fa316,_0x42c2f3[_0x20ffb3(0x24e)]=_0x3bb212,_0x42c2f3['invoice']=_0x2e71a2;const _0x347a9c=await _0x42c2f3[_0x20ffb3(0x29f)](),_0x49576e=await warehouse[_0x20ffb3(0x298)]({'name':_0x9bcd86,'room':_0x57d258});_0x347a9c[_0x20ffb3(0x296)][_0x20ffb3(0x1e1)](_0x27883a=>{var _0x38633e=_0x20ffb3;if(_0x27883a[_0x38633e(0x238)]>0x0){const _0x3704b8=_0x49576e['product_details']['map'](_0x567100=>{var _0x59e090=_0x38633e;_0x567100[_0x59e090(0x25d)]==_0x27883a[_0x59e090(0x25d)]&&_0x567100[_0x59e090(0x26b)]==_0x27883a[_0x59e090(0x2ab)]&&(_0x567100['product_stock']=parseInt(_0x567100[_0x59e090(0x207)])-parseInt(_0x27883a[_0x59e090(0x238)]));});}}),await _0x49576e[_0x20ffb3(0x29f)]();const _0xd47cd6=await warehouse[_0x20ffb3(0x298)]({'name':_0x539a26,'room':_0x8be581});_0x347a9c[_0x20ffb3(0x296)][_0x20ffb3(0x1e1)](_0x3d0bbd=>{var _0x32ac7a=_0x20ffb3;if(_0x3d0bbd[_0x32ac7a(0x238)]>0x0){var _0x20679c=0x0;const _0x36bf18=_0xd47cd6[_0x32ac7a(0x2b1)][_0x32ac7a(0x280)](_0x2160a0=>{var _0x1ddfec=_0x32ac7a;_0x2160a0[_0x1ddfec(0x25d)]==_0x3d0bbd['product_name']&&_0x2160a0[_0x1ddfec(0x26b)]==_0x3d0bbd[_0x1ddfec(0x240)]&&(_0x2160a0['product_stock']=parseInt(_0x2160a0[_0x1ddfec(0x207)])+parseInt(_0x3d0bbd[_0x1ddfec(0x238)]),_0x20679c++);});_0x20679c=='0'&&(_0xd47cd6['product_details']=_0xd47cd6[_0x32ac7a(0x2b1)][_0x32ac7a(0x1e3)]({'product_name':_0x3d0bbd[_0x32ac7a(0x25d)],'product_stock':_0x3d0bbd[_0x32ac7a(0x238)],'bay':_0x3d0bbd[_0x32ac7a(0x240)],'product_code':_0x3d0bbd[_0x32ac7a(0x286)],'primary_code':_0x3d0bbd['primary_code'],'secondary_code':_0x3d0bbd[_0x32ac7a(0x22c)],'maxProducts':_0x3d0bbd[_0x32ac7a(0x212)]}));}}),await _0xd47cd6[_0x20ffb3(0x29f)](),_0x5be55d[_0x20ffb3(0x222)]('success',_0x20ffb3(0x263)),_0x491481[_0x20ffb3(0x261)](_0x20ffb3(0x2be));}catch(_0x55c451){console[_0x20ffb3(0x1ec)](_0x55c451);}}),router[a0_0x137a18(0x250)]('/barcode_scanner',async(_0x422c45,_0x10ba24)=>{var _0x1b5bb8=a0_0x137a18;const {FromWareHouse:_0x59f4ad,FromRoom:_0x14ead9,ToWarehouse:_0xb90e65,ToRoom:_0x5484f7,primary_code:_0x2212ba,Roomslist:_0x27b572}=_0x422c45[_0x1b5bb8(0x29e)],_0x73f36d=_0x27b572[_0x1b5bb8(0x2b5)](','),_0x453ef9=[];async function _0xde0d16(_0x5a4273){var _0x4af9cf=_0x1b5bb8;const _0x106b6c=await warehouse[_0x4af9cf(0x2a3)]([{'$match':{'name':_0x59f4ad,'room':_0x5a4273}},{'$unwind':_0x4af9cf(0x27e)},{'$match':{'product_details.primary_code':_0x2212ba}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x4af9cf(0x1e0)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4af9cf(0x276)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x4af9cf(0x236)},'isle':{'$first':_0x4af9cf(0x215)},'type':{'$first':_0x4af9cf(0x1e2)},'pallet':{'$first':_0x4af9cf(0x23e)},'unit':{'$first':_0x4af9cf(0x28a)},'secondary_unit':{'$first':_0x4af9cf(0x22f)},'storage':{'$first':_0x4af9cf(0x21f)},'rack':{'$first':_0x4af9cf(0x2bb)},'expiry_date':{'$first':_0x4af9cf(0x26a)},'production_date':{'$first':_0x4af9cf(0x265)},'batch_code':{'$first':_0x4af9cf(0x2b6)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x4af9cf(0x23d)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x4af9cf(0x206)}}}]),_0x269900=await warehouse['aggregate']([{'$match':{'name':_0x59f4ad,'room':_0x5a4273}},{'$unwind':_0x4af9cf(0x27e)},{'$match':{'product_details.secondary_code':_0x2212ba}},{'$group':{'_id':_0x4af9cf(0x1f8),'name':{'$first':_0x4af9cf(0x218)},'instock':{'$first':_0x4af9cf(0x1e0)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4af9cf(0x276)},'product_code':{'$first':_0x4af9cf(0x231)},'level':{'$first':_0x4af9cf(0x236)},'isle':{'$first':_0x4af9cf(0x215)},'type':{'$first':_0x4af9cf(0x1e2)},'pallet':{'$first':_0x4af9cf(0x23e)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4af9cf(0x2bb)},'expiry_date':{'$first':_0x4af9cf(0x26a)},'production_date':{'$first':_0x4af9cf(0x265)},'batch_code':{'$first':_0x4af9cf(0x2b6)},'maxPerUnit':{'$first':_0x4af9cf(0x24f)},'roomNamed':{'$first':_0x4af9cf(0x23d)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x4af9cf(0x206)}}}]);if(_0x106b6c[_0x4af9cf(0x1f0)]>0x0)_0x453ef9[_0x4af9cf(0x2a7)](_0x106b6c);else _0x269900[_0x4af9cf(0x1f0)]>0x0&&_0x453ef9[_0x4af9cf(0x2a7)](_0x269900);}const _0x319169=_0x73f36d[_0x1b5bb8(0x280)](_0x5740ee=>_0xde0d16(_0x5740ee));await Promise[_0x1b5bb8(0x1f9)](_0x319169),_0x10ba24[_0x1b5bb8(0x1fe)](_0x453ef9);}),router[a0_0x137a18(0x250)](a0_0x137a18(0x242),async(_0x43b12e,_0x5c8b77)=>{var _0x5b5361=a0_0x137a18;try{const {FromWareHouse:_0x1370c4,FromRoom:_0x2bf4f6,ToWarehouse:_0x3ced69,ToRoom:_0x55be35,secondary_code:_0x15aae1}=_0x43b12e['body'],_0x249883=await warehouse[_0x5b5361(0x2a3)]([{'$match':{'name':_0x1370c4}},{'$unwind':_0x5b5361(0x27e)},{'$match':{'product_details.secondary_code':_0x15aae1}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x5b5361(0x1f6)},'secondary_code':{'$first':_0x5b5361(0x276)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x5b5361(0x1e0)},'warehouse':{'$first':'$name'},'level':{'$first':_0x5b5361(0x26f)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5b5361(0x21d)},'maxProducts':{'$first':_0x5b5361(0x272)},'unit':{'$first':_0x5b5361(0x28a)},'expiry_date':{'$first':_0x5b5361(0x26a)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x5c8b77['status'](0xc8)[_0x5b5361(0x1fe)](_0x249883);}catch(_0x41a9b7){_0x5c8b77[_0x5b5361(0x21e)](0x194)[_0x5b5361(0x1fe)]({'message':_0x41a9b7[_0x5b5361(0x2af)]});}}),router[a0_0x137a18(0x250)](a0_0x137a18(0x294),async(_0x703695,_0x5a12b4)=>{var _0x49edfa=a0_0x137a18;try{const {FromWareHouse:_0x1e68db,FromRoom:_0x56742c,ToWarehouse:_0x50c8bb,ToRoom:_0x11dea9,product_code:_0x51ed04}=_0x703695['body'],_0x54ba5a=await warehouse[_0x49edfa(0x2a3)]([{'$match':{'name':_0x1e68db}},{'$unwind':_0x49edfa(0x27e)},{'$match':{'product_details.product_code':_0x51ed04}},{'$group':{'_id':_0x49edfa(0x1f8),'name':{'$first':_0x49edfa(0x218)},'primary_code':{'$first':_0x49edfa(0x1f6)},'secondary_code':{'$first':_0x49edfa(0x276)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x49edfa(0x1e0)},'warehouse':{'$first':_0x49edfa(0x26e)},'level':{'$first':_0x49edfa(0x26f)},'isle':{'$first':_0x49edfa(0x20a)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x49edfa(0x272)},'unit':{'$first':_0x49edfa(0x28a)}}}]);_0x5a12b4[_0x49edfa(0x21e)](0xc8)[_0x49edfa(0x1fe)](_0x54ba5a);}catch(_0x4e431c){_0x5a12b4[_0x49edfa(0x21e)](0x194)['json']({'message':_0x4e431c[_0x49edfa(0x2af)]});}}),router[a0_0x137a18(0x250)](a0_0x137a18(0x27f),async(_0x1875d0,_0xf70d29)=>{var _0x432469=a0_0x137a18;const {productCode:_0x3f5613,bay:_0x160b9d,warehouses:_0x351c3c,room:_0x251298}=_0x1875d0['body'];console['log'](_0x1875d0[_0x432469(0x29e)]);try{const _0xc61cb=await warehouse[_0x432469(0x2a3)]([{'$match':{'name':_0x351c3c,'room':_0x251298}},{'$unwind':_0x432469(0x27e)},{'$match':{'product_details.bay':parseInt(_0x160b9d)}},{'$group':{'_id':_0x432469(0x1f8),'name':{'$first':_0x432469(0x218)},'product_stock':{'$first':_0x432469(0x1e0)},'bay':{'$first':_0x432469(0x236)},'maxProducts':{'$first':_0x432469(0x272)}}}]);_0xf70d29['status'](0xc8)['json'](_0xc61cb);}catch(_0x29bcb8){_0xf70d29['status'](0x194)[_0x432469(0x1fe)]({'message':_0x29bcb8[_0x432469(0x2af)]});}}),module[a0_0x137a18(0x285)]=router;