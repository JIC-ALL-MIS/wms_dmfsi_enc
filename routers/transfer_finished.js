var a0_0x1f932e=a0_0x5c43;(function(_0x14fed7,_0x336584){var _0x38c901=a0_0x5c43,_0x47b780=_0x14fed7();while(!![]){try{var _0x2ba61b=parseInt(_0x38c901(0xce))/0x1+-parseInt(_0x38c901(0x176))/0x2*(parseInt(_0x38c901(0xda))/0x3)+-parseInt(_0x38c901(0xd6))/0x4+parseInt(_0x38c901(0x128))/0x5+parseInt(_0x38c901(0x15c))/0x6*(parseInt(_0x38c901(0xd3))/0x7)+-parseInt(_0x38c901(0x184))/0x8+parseInt(_0x38c901(0x117))/0x9;if(_0x2ba61b===_0x336584)break;else _0x47b780['push'](_0x47b780['shift']());}catch(_0x1ea248){_0x47b780['push'](_0x47b780['shift']());}}}(a0_0x1487,0x33492));const express=require(a0_0x1f932e(0x127)),app=express(),router=express[a0_0x1f932e(0x177)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x1f932e(0x16a)),auth=require(a0_0x1f932e(0x1a0)),users=require(a0_0x1f932e(0x113)),nodemailer=require(a0_0x1f932e(0x102));router[a0_0x1f932e(0x161)](a0_0x1f932e(0x158),auth,async(_0x34701c,_0x527e6f)=>{var _0x423b46=a0_0x1f932e;try{const {username:_0x2b8f19,email:_0x35b0d2,role:_0x171f3d}=_0x34701c['user'],_0x59550b=_0x34701c[_0x423b46(0x18b)],_0x176578=await profile[_0x423b46(0x17a)]({'email':_0x59550b[_0x423b46(0x11c)]}),_0x20b2b1=await master_shop[_0x423b46(0x17b)]();let _0x1c7e84;if(_0x59550b[_0x423b46(0x16b)]==_0x423b46(0xdd)){const _0x3ebc1a=await staff[_0x423b46(0x17a)]({'email':_0x59550b['email']});_0x1c7e84=await transfers_finished['find']({'from_warehouse':_0x3ebc1a['warehouse']});}else _0x1c7e84=await transfers_finished['aggregate']([{'$unwind':_0x423b46(0xd1)},{'$group':{'_id':_0x423b46(0x143),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'from_warehouse':{'$first':_0x423b46(0x101)},'to_warehouse':{'$first':_0x423b46(0x115)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x423b46(0xf1)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x20b2b1[0x0][_0x423b46(0xfa)]=='English\x20(US)')var _0x4604fb=users[_0x423b46(0xd2)];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0x197))var _0x4604fb=users[_0x423b46(0x197)];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0xd0))var _0x4604fb=users[_0x423b46(0xd0)];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0x150))var _0x4604fb=users[_0x423b46(0x150)];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0x107))var _0x4604fb=users[_0x423b46(0x107)];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0x142))var _0x4604fb=users['Portuguese'];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0x190))var _0x4604fb=users[_0x423b46(0x190)];else{if(_0x20b2b1[0x0][_0x423b46(0xfa)]==_0x423b46(0x15b))var _0x4604fb=users['Arabic'];}}}}}}}_0x527e6f[_0x423b46(0x17d)]('transfer_finished',{'success':_0x34701c[_0x423b46(0x18f)](_0x423b46(0x18c)),'errors':_0x34701c['flash'](_0x423b46(0x14f)),'role':_0x59550b,'profile':_0x176578,'master_shop':_0x20b2b1,'transfer':_0x1c7e84,'language':_0x4604fb});}catch(_0x2ec128){console['log'](_0x2ec128);}});async function getRandom8DigitNumber(){var _0x2d6770=a0_0x1f932e;const _0x1045a4=0x989680,_0x3bd625=0x5f5e0ff,_0x588139=Math['floor'](Math['random']()*(_0x3bd625-_0x1045a4+0x1))+_0x1045a4;var _0x3b77e4;const _0x219eaa=await transfers_finished[_0x2d6770(0x17a)]({'invoice':_0x2d6770(0x110)+_0x588139});return _0x219eaa&&_0x219eaa[_0x2d6770(0xe5)]>0x0?_0x3b77e4=_0x2d6770(0x110)+_0x588139:_0x3b77e4=_0x2d6770(0x110)+_0x588139,_0x3b77e4;}router['get'](a0_0x1f932e(0x193),auth,async(_0x3eec79,_0x14f74d)=>{var _0xf88d05=a0_0x1f932e;try{const {username:_0x5eeda5,email:_0x5cf434,role:_0x2e07fa}=_0x3eec79['user'],_0x2a3930=_0x3eec79[_0xf88d05(0x18b)],_0x294f69=await profile['findOne']({'email':_0x2a3930['email']}),_0x34804e=await master_shop['find']();let _0x3f76c7;if(_0x2a3930[_0xf88d05(0x16b)]==_0xf88d05(0xdd)){const _0x517f4f=await staff[_0xf88d05(0x17a)]({'email':_0x2a3930[_0xf88d05(0x11c)]});_0x3f76c7=await warehouse[_0xf88d05(0xcc)]([{'$match':{'status':_0xf88d05(0x118),'name':_0x517f4f['warehouse'],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0xf88d05(0x130)}}},{'$group':{'_id':_0xf88d05(0x126),'name':{'$first':_0xf88d05(0x126)}}}]);}else _0x3f76c7=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0xf88d05(0x130)}}},{'$group':{'_id':_0xf88d05(0x126),'name':{'$first':_0xf88d05(0x126)}}}]);const _0x5a3a38=await transfers_finished[_0xf88d05(0x17b)]({}),_0x2555c7=_0x5a3a38[_0xf88d05(0xe5)]+0x1,_0x2ecbdf=_0xf88d05(0x110)+_0x2555c7[_0xf88d05(0x131)]()[_0xf88d05(0x198)](0x5,'0');if(_0x34804e[0x0][_0xf88d05(0xfa)]==_0xf88d05(0x15d))var _0x3b5193=users['English'];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]==_0xf88d05(0x197))var _0x3b5193=users[_0xf88d05(0x197)];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]==_0xf88d05(0xd0))var _0x3b5193=users[_0xf88d05(0xd0)];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]=='Spanish')var _0x3b5193=users[_0xf88d05(0x150)];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]=='French')var _0x3b5193=users[_0xf88d05(0x107)];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]==_0xf88d05(0x142))var _0x3b5193=users[_0xf88d05(0x17c)];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]==_0xf88d05(0x190))var _0x3b5193=users[_0xf88d05(0x190)];else{if(_0x34804e[0x0][_0xf88d05(0xfa)]==_0xf88d05(0x15b))var _0x3b5193=users[_0xf88d05(0x14b)];}}}}}}}const _0x5e2282=getRandom8DigitNumber();_0x5e2282[_0xf88d05(0x116)](_0x1a351a=>{var _0x129a69=_0xf88d05;_0x14f74d[_0x129a69(0x17d)](_0x129a69(0x174),{'success':_0x3eec79['flash'](_0x129a69(0x18c)),'errors':_0x3eec79['flash'](_0x129a69(0x14f)),'role':_0x2a3930,'profile':_0x294f69,'master_shop':_0x34804e,'warehouse':_0x3f76c7,'language':_0x3b5193,'invoice':_0x1a351a});})[_0xf88d05(0x105)](_0x58ba40=>{var _0x3a2356=_0xf88d05;_0x3eec79[_0x3a2356(0x18f)]('errors',_0x3a2356(0x12f)),_0x14f74d['redirect'](_0x3a2356(0x140));});}catch(_0x1c245b){console[_0xf88d05(0x134)](_0x1c245b);}}),router['post'](a0_0x1f932e(0x193),auth,async(_0x2b1397,_0x146c3d)=>{var _0x3a5270=a0_0x1f932e;try{const {date:_0x492c95,from_warehouse:_0x3da5d3,FromRoom_name:_0x369e5a,to_warehouse:_0x486751,ToRoom_name:_0x533d87,prod_name:_0x2b508f,from_prod_qty:_0x4a0dd1,from_prod_level:_0x1a1e10,from_prod_isle:_0x450136,from_prod_pallet:_0x339494,to_prod_qty:_0x3732b1,to_prod_level:_0x170794,to_prod_isle:_0x143153,to_prod_pallet:_0x2aa2be,primary_code:_0x4236d4,secondary_code:_0x4d6f1a,product_code3:_0x37fcde,note:_0x325a99,MaxStocks_data2:_0x3b4698,invoice:_0x53743c,expiry_date:_0x4bdd2a}=_0x2b1397[_0x3a5270(0x19e)];if(typeof _0x2b508f==_0x3a5270(0x15e))var _0xcced3c=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x185)]],_0x5d9c7f=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x10e)]],_0x40d1c5=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x168)]],_0x297829=[_0x2b1397[_0x3a5270(0x19e)]['New_Qty_Converted']],_0x31d7b8=[_0x2b1397['body']['to_prod_level']],_0x6ed70a=[_0x2b1397[_0x3a5270(0x19e)]['primary_code']],_0x2a1c8d=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x13b)]],_0xfbb9fb=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xcb)]],_0x34931c=[_0x2b1397['body'][_0x3a5270(0xf8)]],_0x562fea=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x14d)]],_0x4567ad=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x13d)]],_0x31a108=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x135)]],_0x1cf457=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x10d)]],_0x64dcbe=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x17f)]],_0x11a66b=[_0x2b1397['body'][_0x3a5270(0xde)]],_0x18cb92=[_0x2b1397['body']['maxPerUnit']],_0x1d9230=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xf2)]],_0x4fe637=[_0x2b1397['body'][_0x3a5270(0x119)]],_0x27530a=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xd9)]],_0x306832=[_0x2b1397['body'][_0x3a5270(0x12a)]],_0x23bee8=[_0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x15f)]],_0x2d4812=[_0x2b1397['body'][_0x3a5270(0x195)]];else var _0xcced3c=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x185)]],_0x5d9c7f=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x10e)]],_0x40d1c5=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x168)]],_0x297829=[..._0x2b1397[_0x3a5270(0x19e)]['New_Qty_Converted']],_0x31d7b8=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x10c)]],_0x6ed70a=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x1a5)]],_0x2a1c8d=[..._0x2b1397['body'][_0x3a5270(0x13b)]],_0xfbb9fb=[..._0x2b1397['body']['product_code3']],_0x34931c=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xf8)]],_0x562fea=[..._0x2b1397[_0x3a5270(0x19e)]['primary_unit']],_0x4567ad=[..._0x2b1397['body'][_0x3a5270(0x13d)]],_0x31a108=[..._0x2b1397['body'][_0x3a5270(0x135)]],_0x1cf457=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x10d)]],_0x64dcbe=[..._0x2b1397[_0x3a5270(0x19e)]['product_date']],_0x11a66b=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xde)]],_0x18cb92=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x1a6)]],_0x1d9230=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xf2)]],_0x4fe637=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x119)]],_0x27530a=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0xd9)]],_0x306832=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x12a)]],_0x23bee8=[..._0x2b1397[_0x3a5270(0x19e)]['to_invoice']],_0x2d4812=[..._0x2b1397[_0x3a5270(0x19e)][_0x3a5270(0x195)]];const _0x29d8af=_0xcced3c[_0x3a5270(0x13a)](_0x70fae=>{return _0x70fae={'product_name':_0x70fae};});_0x5d9c7f[_0x3a5270(0x163)]((_0x2669e3,_0x38b716)=>{_0x29d8af[_0x38b716]['from_quantity']=_0x2669e3;}),_0x40d1c5[_0x3a5270(0x163)]((_0x258b94,_0x227cf5)=>{_0x29d8af[_0x227cf5]['from_bay']=_0x258b94;}),_0x2d4812[_0x3a5270(0x163)]((_0x4825e1,_0x4c8d44)=>{_0x29d8af[_0x4c8d44]['id_transaction']=_0x4825e1;}),_0x306832[_0x3a5270(0x163)]((_0x1c4f8a,_0x4e28e8)=>{_0x29d8af[_0x4e28e8]['from_invoice']=_0x1c4f8a;}),_0x23bee8[_0x3a5270(0x163)]((_0x50386c,_0x6f3615)=>{var _0x3ea056=_0x3a5270;_0x29d8af[_0x6f3615][_0x3ea056(0x199)]=_0x50386c;}),_0x297829['forEach']((_0x5cbc7a,_0x4f7f16)=>{var _0x5f3ec5=_0x3a5270;_0x29d8af[_0x4f7f16][_0x5f3ec5(0x133)]=_0x5cbc7a;}),_0x31d7b8[_0x3a5270(0x163)]((_0xbb3360,_0x421b4f)=>{var _0x5ad668=_0x3a5270;_0x29d8af[_0x421b4f][_0x5ad668(0xef)]=_0xbb3360;}),_0x6ed70a[_0x3a5270(0x163)]((_0x1d02ae,_0x1f2e83)=>{_0x29d8af[_0x1f2e83]['primary_code']=_0x1d02ae;}),_0x2a1c8d[_0x3a5270(0x163)]((_0x5be065,_0x335bcd)=>{var _0xf802aa=_0x3a5270;_0x29d8af[_0x335bcd][_0xf802aa(0x13b)]=_0x5be065;}),_0xfbb9fb[_0x3a5270(0x163)]((_0x2a8d06,_0xd9291a)=>{var _0x3abe3d=_0x3a5270;_0x29d8af[_0xd9291a][_0x3abe3d(0x149)]=_0x2a8d06;}),_0x34931c[_0x3a5270(0x163)]((_0x192a8d,_0x229669)=>{var _0x316ab9=_0x3a5270;_0x29d8af[_0x229669][_0x316ab9(0x16f)]=_0x192a8d;}),_0x562fea['forEach']((_0x3eae7e,_0x123858)=>{_0x29d8af[_0x123858]['unit']=_0x3eae7e;}),_0x4567ad[_0x3a5270(0x163)]((_0x5b59ff,_0x43f76b)=>{var _0x11980e=_0x3a5270;_0x29d8af[_0x43f76b][_0x11980e(0x13d)]=_0x5b59ff;}),_0x31a108[_0x3a5270(0x163)]((_0xfa028,_0x594d6a)=>{var _0x18c1e8=_0x3a5270;_0x29d8af[_0x594d6a][_0x18c1e8(0x135)]=_0xfa028;}),_0x1cf457[_0x3a5270(0x163)]((_0x1d06ec,_0x4aaa5c)=>{var _0x4deba2=_0x3a5270;_0x29d8af[_0x4aaa5c][_0x4deba2(0x10d)]=_0x1d06ec;}),_0x64dcbe[_0x3a5270(0x163)]((_0x169172,_0xf740a1)=>{var _0x5698b3=_0x3a5270;_0x29d8af[_0xf740a1][_0x5698b3(0x19b)]=_0x169172;}),_0x11a66b[_0x3a5270(0x163)]((_0x3bba1a,_0x32b49a)=>{var _0x4d6ea6=_0x3a5270;_0x29d8af[_0x32b49a][_0x4d6ea6(0x16f)]=_0x3bba1a;}),_0x18cb92['forEach']((_0x2b3a74,_0x1e298b)=>{var _0x18942b=_0x3a5270;_0x29d8af[_0x1e298b][_0x18942b(0x1a6)]=_0x2b3a74;}),_0x1d9230['forEach']((_0x19081c,_0x4660a6)=>{_0x29d8af[_0x4660a6]['prod_cat']=_0x19081c;}),_0x4fe637['forEach']((_0x3e0613,_0xf4d0d2)=>{var _0x50e221=_0x3a5270;_0x29d8af[_0xf4d0d2][_0x50e221(0x171)]=_0x3e0613;}),_0x27530a[_0x3a5270(0x163)]((_0x1adb6b,_0x2098eb)=>{var _0x1e3ad2=_0x3a5270;_0x29d8af[_0x2098eb][_0x1e3ad2(0x169)]=_0x1adb6b;});const _0x2125aa=_0x29d8af[_0x3a5270(0x122)](_0x23eeac=>_0x23eeac['to_quantity']!=='0'&&_0x23eeac[_0x3a5270(0x133)]!==''||_0x23eeac[_0x3a5270(0x173)]!=='0'&&_0x23eeac[_0x3a5270(0x173)]!=='');var _0x3ab3e6=0x0;_0x2125aa[_0x3a5270(0x163)](_0x437739=>{var _0x405c99=_0x3a5270;parseInt(_0x437739[_0x405c99(0x11e)])<parseInt(_0x437739[_0x405c99(0x133)])&&_0x3ab3e6++;});if(_0x3ab3e6!=0x0)return _0x2b1397[_0x3a5270(0x18f)](_0x3a5270(0x14f),_0x3a5270(0x152)),_0x146c3d[_0x3a5270(0xff)]('back');const _0x2512ad=new transfers_finished({'date':_0x492c95,'from_warehouse':_0x3da5d3,'to_warehouse':_0x486751,'product':_0x2125aa,'note':_0x325a99,'invoice':_0x53743c}),_0x5bfb2b=await _0x2512ad[_0x3a5270(0x13e)]();_0x2b1397[_0x3a5270(0x18f)](_0x3a5270(0x18c),_0x3a5270(0x18d)),_0x146c3d[_0x3a5270(0xff)](_0x3a5270(0xe9)+_0x5bfb2b[_0x3a5270(0x10f)]);}catch(_0x58eb2a){console['log'](_0x58eb2a),_0x146c3d[_0x3a5270(0x137)](0xc8)[_0x3a5270(0x123)]({'errorMessage':_0x58eb2a[_0x3a5270(0xfd)]});}}),router[a0_0x1f932e(0x161)](a0_0x1f932e(0x100),auth,async(_0x384248,_0x10b611)=>{var _0x541a3b=a0_0x1f932e;try{const {username:_0x91d681,email:_0x2069c9,role:_0x31c25d}=_0x384248['user'],_0x484d1c=_0x384248['user'],_0xe1ffc5=await profile[_0x541a3b(0x17a)]({'email':_0x484d1c[_0x541a3b(0x11c)]}),_0x5c8de2=await master_shop[_0x541a3b(0x17b)](),_0x338ec1=await transfers_finished[_0x541a3b(0x106)](_0x384248['params']['id']);let _0x25f5b9;if(_0x484d1c['role']==_0x541a3b(0xdd)){const _0x2f2186=await staff['findOne']({'email':_0x484d1c[_0x541a3b(0x11c)]});_0x25f5b9=await warehouse[_0x541a3b(0x17b)]({'status':_0x541a3b(0x118),'name':_0x2f2186['warehouse'],'warehouse_category':_0x541a3b(0xd5)});}else _0x25f5b9=await warehouse['find']({'status':_0x541a3b(0x118),'warehouse_category':'Finished\x20Goods'});const _0x2fe083=await warehouse[_0x541a3b(0xcc)]([{'$match':{'name':_0x338ec1['from_warehouse'],'warehouse_category':_0x541a3b(0xd5)}},{'$unwind':_0x541a3b(0x147)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x541a3b(0x11d)},'product_stock':{'$first':_0x541a3b(0x159)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x541a3b(0xfc)},'type':{'$first':_0x541a3b(0xe8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x541a3b(0x144)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x541a3b(0xec)},'storage':{'$first':_0x541a3b(0x112)},'rack':{'$first':_0x541a3b(0x132)},'expiry_date':{'$first':_0x541a3b(0xe3)},'production_date':{'$first':_0x541a3b(0x157)},'room':{'$first':_0x541a3b(0x164)},'warehoue_name':{'$first':'$name'}}}]),_0x206016=await product[_0x541a3b(0x17b)]({});if(_0x5c8de2[0x0][_0x541a3b(0xfa)]==_0x541a3b(0x15d)){var _0x177d67=users[_0x541a3b(0xd2)];console[_0x541a3b(0x134)](_0x177d67);}else{if(_0x5c8de2[0x0][_0x541a3b(0xfa)]==_0x541a3b(0x197))var _0x177d67=users[_0x541a3b(0x197)];else{if(_0x5c8de2[0x0][_0x541a3b(0xfa)]==_0x541a3b(0xd0))var _0x177d67=users[_0x541a3b(0xd0)];else{if(_0x5c8de2[0x0]['language']==_0x541a3b(0x150))var _0x177d67=users[_0x541a3b(0x150)];else{if(_0x5c8de2[0x0][_0x541a3b(0xfa)]==_0x541a3b(0x107))var _0x177d67=users['French'];else{if(_0x5c8de2[0x0]['language']==_0x541a3b(0x142))var _0x177d67=users[_0x541a3b(0x17c)];else{if(_0x5c8de2[0x0]['language']==_0x541a3b(0x190))var _0x177d67=users['Chinese'];else{if(_0x5c8de2[0x0][_0x541a3b(0xfa)]==_0x541a3b(0x15b))var _0x177d67=users[_0x541a3b(0x14b)];}}}}}}}_0x10b611[_0x541a3b(0x17d)]('edit_transfer_finished_view',{'success':_0x384248[_0x541a3b(0x18f)]('success'),'errors':_0x384248[_0x541a3b(0x18f)](_0x541a3b(0x14f)),'role':_0x484d1c,'profile':_0xe1ffc5,'master_shop':_0x5c8de2,'warehouse':_0x25f5b9,'transfer':_0x338ec1,'stock':_0x2fe083,'unit':_0x206016,'language':_0x177d67});}catch(_0x559da4){console[_0x541a3b(0x134)](_0x559da4);}}),router['post'](a0_0x1f932e(0x100),auth,async(_0x10d1db,_0x43e442)=>{var _0x593c55=a0_0x1f932e;try{const {invoice:_0x213740,from_warehouse:_0x4e4d39,FromRoom_name:_0x201d6c,to_warehouse:_0x3062b7,ToRoom_name:_0x75897f}=_0x10d1db[_0x593c55(0x19e)],_0xc14bb=await transfers_finished['findById'](_0x10d1db[_0x593c55(0x114)]['id']),_0x3dc0c6=_0xc14bb[_0x593c55(0x12c)]['map'](async _0x176dea=>{var _0x127cfd=_0x593c55;if(_0x176dea[_0x127cfd(0x133)]>0x0){var _0x38e33f=await warehouse['findOne']({'name':_0x4e4d39,'room':_0x176dea[_0x127cfd(0x171)],'warehouse_category':_0x127cfd(0xd5)});const _0x450edc=_0x38e33f['product_details'][_0x127cfd(0x13a)](_0x4fb7dc=>{var _0x1038c5=_0x127cfd;_0x4fb7dc[_0x1038c5(0x1a3)]==_0x176dea['product_name']&&_0x4fb7dc[_0x1038c5(0x13c)]==_0x176dea[_0x1038c5(0x1a4)]&&_0x4fb7dc[_0x1038c5(0x10d)]==_0x176dea[_0x1038c5(0x10d)]&&_0x4fb7dc[_0x1038c5(0x19b)]==_0x176dea[_0x1038c5(0x19b)]&&_0x4fb7dc[_0x1038c5(0x135)]==_0x176dea[_0x1038c5(0x135)]&&_0x4fb7dc[_0x1038c5(0x11f)]==_0x176dea[_0x1038c5(0x12a)]&&(console[_0x1038c5(0x134)](_0x1038c5(0x1a2),_0x4fb7dc['product_stock']),typeof _0x176dea['id_transaction']=='undefined'?_0x4fb7dc[_0x1038c5(0x178)]=Math[_0x1038c5(0xd8)](0x0,Math[_0x1038c5(0x188)](_0x4fb7dc[_0x1038c5(0x178)])-Math[_0x1038c5(0x188)](_0x176dea[_0x1038c5(0x133)])):_0x4fb7dc['product_stock']=Math['max'](0x0,Math[_0x1038c5(0x188)](_0x4fb7dc['product_stock'])-Math[_0x1038c5(0x188)](_0x176dea[_0x1038c5(0x133)])));});}return _0x38e33f;});Promise[_0x593c55(0x154)](_0x3dc0c6)[_0x593c55(0x116)](async _0x56f075=>{var _0x5c77fc=_0x593c55;try{for(const _0x409d31 of _0x56f075){await _0x409d31[_0x5c77fc(0x13e)]();}const _0x45dc0d=_0xc14bb[_0x5c77fc(0x12c)][_0x5c77fc(0x13a)](async _0x248ea3=>{var _0x3c6e85=_0x5c77fc,_0x2cc305=await warehouse[_0x3c6e85(0x17a)]({'name':_0x3062b7,'room':_0x248ea3[_0x3c6e85(0x169)]});if(_0x248ea3[_0x3c6e85(0x133)]>0x0){var _0x554247=0x0;const _0x5e7b8e=_0x2cc305[_0x3c6e85(0x155)][_0x3c6e85(0x13a)](_0x1277c5=>{var _0x29f18c=_0x3c6e85;_0x1277c5[_0x29f18c(0x1a3)]==_0x248ea3[_0x29f18c(0x1a3)]&&_0x1277c5[_0x29f18c(0x13c)]==_0x248ea3['to_bay']&&_0x1277c5['expiry_date']==_0x248ea3[_0x29f18c(0x10d)]&&_0x1277c5[_0x29f18c(0x19b)]==_0x248ea3[_0x29f18c(0x19b)]&&_0x1277c5['batch_code']==_0x248ea3[_0x29f18c(0x135)]&&_0x1277c5[_0x29f18c(0x11f)]==_0x248ea3[_0x29f18c(0x199)]&&(typeof _0x248ea3['id_transaction']==_0x29f18c(0x160)?(console['log'](_0x29f18c(0x187),_0x1277c5[_0x29f18c(0x178)]+_0x29f18c(0x18e)+_0x1277c5[_0x29f18c(0x10f)]+'\x20<=>\x20'+Math[_0x29f18c(0x188)](_0x1277c5[_0x29f18c(0x178)])+Math['abs'](_0x248ea3[_0x29f18c(0x133)])),_0x1277c5[_0x29f18c(0x178)]=Math[_0x29f18c(0x188)](_0x1277c5['product_stock'])+Math['abs'](_0x248ea3['to_quantity'])):_0x1277c5[_0x29f18c(0x178)]=Math['abs'](_0x1277c5[_0x29f18c(0x178)])+Math['abs'](_0x248ea3[_0x29f18c(0x133)]),_0x554247++);});_0x554247=='0'&&(_0x2cc305['product_details']=_0x2cc305[_0x3c6e85(0x155)]['concat']({'product_name':_0x248ea3[_0x3c6e85(0x1a3)],'product_stock':_0x248ea3[_0x3c6e85(0x133)],'bay':_0x248ea3['to_bay'],'product_code':_0x248ea3[_0x3c6e85(0x149)],'primary_code':_0x248ea3['primary_code'],'secondary_code':_0x248ea3['secondary_code'],'expiry_date':_0x248ea3[_0x3c6e85(0x10d)],'production_date':_0x248ea3[_0x3c6e85(0x19b)],'maxProducts':_0x248ea3['maxProducts'],'batch_code':_0x248ea3[_0x3c6e85(0x135)],'secondary_unit':_0x248ea3[_0x3c6e85(0x13d)],'unit':_0x248ea3[_0x3c6e85(0x10a)],'maxProducts':_0x248ea3['maxProducts'],'maxPerUnit':_0x248ea3[_0x3c6e85(0x1a6)],'invoice':_0x248ea3[_0x3c6e85(0x199)]}));}return _0x2cc305;});Promise['all'](_0x45dc0d)[_0x5c77fc(0x116)](async _0x51664c=>{var _0x2bb9e4=_0x5c77fc;try{for(const _0x3dbed3 of _0x51664c){await warehouse[_0x2bb9e4(0xcd)]({'_id':_0x3dbed3[_0x2bb9e4(0x10f)]},{'$addToSet':{'product_details':{'$each':_0x3dbed3[_0x2bb9e4(0x155)]}}});}_0xc14bb[_0x2bb9e4(0x129)]=_0x2bb9e4(0x141);const _0x251084=await _0xc14bb[_0x2bb9e4(0x13e)](),_0x35a1a3=await master_shop[_0x2bb9e4(0x17b)](),_0xd8bf03=await email_settings['findOne'](),_0x2af46f=await supervisor_settings[_0x2bb9e4(0x17b)]();var _0x369f3f=_0xc14bb['product'],_0x5a7b2f='',_0x247e5e;for(_0x247e5e in _0x369f3f){var _0x55a111='FG';_0xc14bb[_0x2bb9e4(0x125)]==_0x2bb9e4(0x11b)&&(_0x55a111='DG'),_0x5a7b2f+=_0x2bb9e4(0x121)+_0x2bb9e4(0xdb)+_0x369f3f[_0x247e5e]['product_name']+_0x2bb9e4(0xf4)+_0x2bb9e4(0xdb)+_0x369f3f[_0x247e5e][_0x2bb9e4(0x149)]+_0x2bb9e4(0xf4)+_0x2bb9e4(0xdb)+_0x369f3f[_0x247e5e][_0x2bb9e4(0x133)]+_0x2bb9e4(0xf4)+_0x2bb9e4(0xdb)+_0x369f3f[_0x247e5e][_0x2bb9e4(0x10a)]+'</td>'+_0x2bb9e4(0xdb)+_0x369f3f[_0x247e5e][_0x2bb9e4(0x13d)]+_0x2bb9e4(0xf4)+_0x2bb9e4(0xdb)+_0xc14bb[_0x2bb9e4(0x125)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x369f3f[_0x247e5e][_0x2bb9e4(0x169)]+_0x2bb9e4(0xf4)+_0x2bb9e4(0xdb)+_0x55a111+_0x369f3f[_0x247e5e][_0x2bb9e4(0xef)]+_0x2bb9e4(0xf4)+_0x2bb9e4(0xf7);}let _0x405f97=nodemailer[_0x2bb9e4(0x12d)]({'host':_0xd8bf03[_0x2bb9e4(0xd4)],'port':Number(_0xd8bf03[_0x2bb9e4(0x103)]),'secure':![],'auth':{'user':_0xd8bf03[_0x2bb9e4(0x11c)],'pass':_0xd8bf03[_0x2bb9e4(0xcf)]}}),_0x16ada9={'from':_0xd8bf03[_0x2bb9e4(0x11c)],'to':_0x2af46f[0x0][_0x2bb9e4(0x12b)],'subject':_0x2bb9e4(0x167),'attachments':[{'filename':'Logo.png','path':__dirname+_0x2bb9e4(0xe2)+_0x2bb9e4(0x108)+_0x35a1a3[0x0]['image'],'cid':_0x2bb9e4(0xd7)}],'html':_0x2bb9e4(0x19a)+'<html><head><title></title>'+'</head><body>'+_0x2bb9e4(0x16c)+_0x2bb9e4(0x16d)+_0x2bb9e4(0x16c)+_0x2bb9e4(0x14c)+_0x2bb9e4(0xf3)+_0x2bb9e4(0x16c)+_0x2bb9e4(0x19c)+_0x35a1a3[0x0][_0x2bb9e4(0x183)]+'\x20</h2>'+_0x2bb9e4(0xf3)+_0x2bb9e4(0xf3)+_0x2bb9e4(0xeb)+_0x2bb9e4(0x16c)+_0x2bb9e4(0x12e)+'\x20Order\x20Number\x20:\x20'+_0xc14bb[_0x2bb9e4(0x11f)]+'\x20'+_0x2bb9e4(0xe7)+_0x2bb9e4(0x19f)+_0xc14bb[_0x2bb9e4(0x192)]+'\x20'+_0x2bb9e4(0x162)+_0x2bb9e4(0xca)+_0x2bb9e4(0xf3)+_0x2bb9e4(0x15a)+_0x2bb9e4(0x182)+_0x2bb9e4(0x121)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x2bb9e4(0x156)+_0x2bb9e4(0xed)+_0x2bb9e4(0x18a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x2bb9e4(0x166)+_0x2bb9e4(0x153)+_0x2bb9e4(0xf7)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5a7b2f+'\x20'+_0x2bb9e4(0x180)+_0x2bb9e4(0x179)+_0x2bb9e4(0x16c)+_0x2bb9e4(0x146)+'<h5>'+_0x35a1a3[0x0][_0x2bb9e4(0x183)]+_0x2bb9e4(0xca)+'</div>'+_0x2bb9e4(0xf3)+_0x2bb9e4(0x151)};_0x405f97[_0x2bb9e4(0x139)](_0x16ada9,function(_0x86373c,_0x4df17e){var _0x577393=_0x2bb9e4;_0x86373c?(console['log'](_0x86373c),console['log'](_0x577393(0x109))):console[_0x577393(0x134)]('Email\x20sent\x20successfully');}),_0x10d1db[_0x2bb9e4(0x18f)](_0x2bb9e4(0x18c),_0x2bb9e4(0x14e)),_0x43e442['redirect']('/picking_list/PDF_transfer/'+_0x251084[_0x2bb9e4(0x10f)]);}catch(_0x85cca7){console[_0x2bb9e4(0x175)](_0x85cca7),_0x43e442[_0x2bb9e4(0x137)](0x1f4)[_0x2bb9e4(0x123)]({'error':_0x2bb9e4(0x165)});}})[_0x5c77fc(0x105)](_0x5c5817=>{var _0x526992=_0x5c77fc;console[_0x526992(0x175)](_0x5c5817),_0x43e442[_0x526992(0x137)](0x1f4)['json']({'error':_0x526992(0xdc)});});}catch(_0x775f84){console['error'](_0x775f84),_0x43e442[_0x5c77fc(0x137)](0x1f4)[_0x5c77fc(0x123)]({'error':_0x5c77fc(0x172)});}})['catch'](_0x3ac08f=>{var _0x390cfa=_0x593c55;console['error'](_0x3ac08f),_0x43e442[_0x390cfa(0x137)](0x1f4)[_0x390cfa(0x123)]({'error':_0x390cfa(0xdc)});});}catch(_0x1bd5f1){_0x43e442['json']({'message':_0x1bd5f1[_0x593c55(0xfd)]});}});function BayBinSelected(_0x5ababd,_0x3e482e){var _0x37000c=a0_0x1f932e,_0x54a283=[];let _0x2068b0=[];var _0x31dec9=[];if(_0x5ababd=='DRY\x20GOODS'){switch(_0x3e482e){case _0x37000c(0x189):_0x54a283=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x54a283=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x31dec9=['DG'];}else{if(_0x5ababd==_0x37000c(0x11a)){switch(_0x3e482e){case _0x37000c(0x189):_0x54a283=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x54a283=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x31dec9=['FG'];}}return{'levels':_0x54a283,'identify':_0x31dec9};}function a0_0x5c43(_0x351e01,_0x2f5ae4){var _0x1487ea=a0_0x1487();return a0_0x5c43=function(_0x5c434a,_0x510b54){_0x5c434a=_0x5c434a-0xca;var _0x2b09b3=_0x1487ea[_0x5c434a];return _0x2b09b3;},a0_0x5c43(_0x351e01,_0x2f5ae4);}router[a0_0x1f932e(0x161)](a0_0x1f932e(0x145),auth,async(_0x5098c8,_0x2f25c6)=>{var _0x934585=a0_0x1f932e;try{const {username:_0x51c3b6,email:_0x15005e,role:_0x2320ce}=_0x5098c8['user'],_0x333946=_0x5098c8[_0x934585(0x18b)],_0x241af9=await profile[_0x934585(0x17a)]({'email':_0x333946[_0x934585(0x11c)]}),_0x1e4013=await master_shop[_0x934585(0x17b)](),_0x3fde15=await transfers_finished[_0x934585(0x106)](_0x5098c8[_0x934585(0x114)]['id']);let _0x2c0e73=new Date(_0x3fde15[_0x934585(0x10d)]),_0x2c7d46=('0'+_0x2c0e73[_0x934585(0x10b)]())[_0x934585(0xf0)](-0x2),_0x3a3c75=('0'+(_0x2c0e73['getMonth']()+0x1))['slice'](-0x2),_0x3f1bbb=_0x2c0e73[_0x934585(0x1a1)](),_0x421318=_0x3f1bbb+'-'+_0x3a3c75+'-'+_0x2c7d46,_0x31c900;if(_0x333946['role']==_0x934585(0xdd)){const _0x1dfb49=await staff[_0x934585(0x17a)]({'email':_0x333946['email']});_0x31c900=await warehouse['find']({'status':'Enabled','name':_0x1dfb49[_0x934585(0x186)],'warehouse_category':'Finished\x20Goods'});}else _0x31c900=await warehouse['find']({'status':_0x934585(0x118),'warehouse_category':_0x934585(0xd5)});const _0x25e816=await warehouse[_0x934585(0xcc)]([{'$match':{'name':_0x3fde15[_0x934585(0x19d)],'room':_0x3fde15[_0x934585(0xf5)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x934585(0x11d)},'product_stock':{'$first':_0x934585(0x159)},'bay':{'$first':_0x934585(0x111)},'bin':{'$first':_0x934585(0xfc)},'type':{'$first':_0x934585(0xe8)},'floorlevel':{'$first':_0x934585(0xe0)},'primary_code':{'$first':_0x934585(0x144)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x934585(0x112)},'rack':{'$first':'$product_details.rack'}}}]);var _0x2a6edb=[0x1,0x2,0x3,0x4],_0x43bbac=['A','B','C','D','E','F','G','H','I','J'],_0x4b540e=[_0x934585(0x138),'Enclosed'];const _0x1221fe=await product['find']({}),_0x5e848a=BayBinSelected(_0x3fde15[_0x934585(0x125)],_0x3fde15[_0x934585(0x17e)]);if(_0x1e4013[0x0][_0x934585(0xfa)]=='English\x20(US)'){var _0x2fda0b=users['English'];console[_0x934585(0x134)](_0x2fda0b);}else{if(_0x1e4013[0x0][_0x934585(0xfa)]==_0x934585(0x197))var _0x2fda0b=users['Hindi'];else{if(_0x1e4013[0x0][_0x934585(0xfa)]=='German')var _0x2fda0b=users['German'];else{if(_0x1e4013[0x0][_0x934585(0xfa)]=='Spanish')var _0x2fda0b=users[_0x934585(0x150)];else{if(_0x1e4013[0x0][_0x934585(0xfa)]==_0x934585(0x107))var _0x2fda0b=users[_0x934585(0x107)];else{if(_0x1e4013[0x0][_0x934585(0xfa)]==_0x934585(0x142))var _0x2fda0b=users[_0x934585(0x17c)];else{if(_0x1e4013[0x0][_0x934585(0xfa)]==_0x934585(0x190))var _0x2fda0b=users[_0x934585(0x190)];else{if(_0x1e4013[0x0][_0x934585(0xfa)]=='Arabic\x20(ae)')var _0x2fda0b=users['Arabic'];}}}}}}}_0x2f25c6[_0x934585(0x17d)](_0x934585(0xfe),{'success':_0x5098c8['flash'](_0x934585(0x18c)),'errors':_0x5098c8[_0x934585(0x18f)](_0x934585(0x14f)),'role':_0x333946,'profile':_0x241af9,'master_shop':_0x1e4013,'warehouse':_0x31c900,'transfer':_0x3fde15,'stock':_0x25e816,'unit':_0x1221fe,'language':_0x2fda0b,'levels':_0x2a6edb,'Isle':_0x43bbac,'rooms_data':_0x4b540e,'ed_fullDate':_0x421318,'dataSelected':_0x5e848a});}catch(_0x51b577){console[_0x934585(0x134)](_0x51b577);}}),router[a0_0x1f932e(0xe4)](a0_0x1f932e(0x145),auth,async(_0x254340,_0x5406a8)=>{var _0x438eda=a0_0x1f932e;try{const _0x2338d8=_0x254340[_0x438eda(0x114)]['id'];console['log'](_0x254340[_0x438eda(0x19e)]);const _0x36b3f1=await transfers_finished[_0x438eda(0x106)](_0x2338d8);console[_0x438eda(0x134)]('transfer_data',_0x36b3f1);const {date:_0x2ca5f4,from_warehouse:_0x5566c4,FromRoom_name:_0x11a8d6,to_warehouse:_0x28732b,ToRoom_name:_0x473524,prod_name:_0x49226d,from_prod_qty:_0x2fbd50,from_prod_level:_0x446007,from_prod_isle:_0x4e91f3,from_prod_pallet:_0x512dc8,to_prod_qty:_0x47dff6,to_prod_level:_0x4018b2,to_prod_isle:_0x46d949,to_prod_pallet:_0x1fe103,primary_code:_0xfd7470,secondary_code:_0x4b94f6,product_code3:_0x4b8ca7,note:_0x1eb126,invoice:_0x3eaaff,expiry_date:_0x48db7e}=_0x254340[_0x438eda(0x19e)];if(typeof _0x49226d==_0x438eda(0x15e))var _0xf99f38=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x185)]],_0x37bfa6=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x10e)]],_0x1ca9e1=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x168)]],_0x36f87c=[_0x254340[_0x438eda(0x19e)]['to_prod_qty']],_0x162690=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x10c)]],_0x8b24d1=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x1a5)]],_0x1b66b5=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x13b)]],_0x2d6047=[_0x254340[_0x438eda(0x19e)]['product_code3']],_0x16cd42=[_0x254340[_0x438eda(0x19e)][_0x438eda(0xf8)]],_0x2db740=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x10a)]],_0x489166=[_0x254340[_0x438eda(0x19e)]['secondary_unit']],_0x4a52df=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x135)]],_0x4efb27=[_0x254340[_0x438eda(0x19e)][_0x438eda(0x10d)]];else var _0xf99f38=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x185)]],_0x37bfa6=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x10e)]],_0x1ca9e1=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x168)]],_0x36f87c=[..._0x254340['body']['to_prod_qty']],_0x162690=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x10c)]],_0x8b24d1=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x1a5)]],_0x1b66b5=[..._0x254340[_0x438eda(0x19e)]['secondary_code']],_0x2d6047=[..._0x254340['body'][_0x438eda(0xcb)]],_0x16cd42=[..._0x254340[_0x438eda(0x19e)]['MaxStocks_data2']],_0x2db740=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x10a)]],_0x489166=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x13d)]],_0x4a52df=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x135)]],_0x4efb27=[..._0x254340[_0x438eda(0x19e)][_0x438eda(0x10d)]];const _0x24111a=_0xf99f38[_0x438eda(0x13a)](_0x4e9207=>{return _0x4e9207={'product_name':_0x4e9207};});_0x37bfa6[_0x438eda(0x163)]((_0x16b307,_0x41390a)=>{_0x24111a[_0x41390a]['from_quantity']=_0x16b307;}),_0x1ca9e1[_0x438eda(0x163)]((_0x279060,_0x81392f)=>{var _0x2020ae=_0x438eda;_0x24111a[_0x81392f][_0x2020ae(0x1a4)]=_0x279060;}),_0x36f87c[_0x438eda(0x163)]((_0x1d9272,_0x376c26)=>{_0x24111a[_0x376c26]['to_quantity']=_0x1d9272;}),_0x162690[_0x438eda(0x163)]((_0x7af16c,_0x393fb2)=>{_0x24111a[_0x393fb2]['to_bay']=_0x7af16c;}),_0x8b24d1[_0x438eda(0x163)]((_0x52b870,_0x3c97d1)=>{_0x24111a[_0x3c97d1]['primary_code']=_0x52b870;}),_0x1b66b5[_0x438eda(0x163)]((_0x1190c0,_0x29ecfe)=>{var _0x22e94b=_0x438eda;_0x24111a[_0x29ecfe][_0x22e94b(0x13b)]=_0x1190c0;}),_0x2d6047[_0x438eda(0x163)]((_0x20341c,_0x440061)=>{_0x24111a[_0x440061]['product_code']=_0x20341c;}),_0x16cd42[_0x438eda(0x163)]((_0x24e6e1,_0x16027f)=>{var _0x23f627=_0x438eda;_0x24111a[_0x16027f][_0x23f627(0x16f)]=_0x24e6e1;}),_0x2db740['forEach']((_0x5a2954,_0x3e3b67)=>{var _0x45f97b=_0x438eda;_0x24111a[_0x3e3b67][_0x45f97b(0x10a)]=_0x5a2954;}),_0x489166[_0x438eda(0x163)]((_0x4f6016,_0x4d73c9)=>{var _0x2d2096=_0x438eda;_0x24111a[_0x4d73c9][_0x2d2096(0x13d)]=_0x4f6016;}),_0x4a52df['forEach']((_0x45e5f2,_0x401646)=>{var _0x3ecccc=_0x438eda;_0x24111a[_0x401646][_0x3ecccc(0x135)]=_0x45e5f2;}),_0x4efb27[_0x438eda(0x163)]((_0xf267de,_0x30ba9e)=>{_0x24111a[_0x30ba9e]['expiry_date']=_0xf267de;});const _0x5b7a2d=_0x24111a[_0x438eda(0x122)](_0x4fdec9=>_0x4fdec9['to_quantity']!=='0'&&_0x4fdec9[_0x438eda(0x133)]!==''||_0x4fdec9['to_floorlevel']!=='0'&&_0x4fdec9[_0x438eda(0x173)]!=='');var _0x3a0449=0x0;_0x5b7a2d[_0x438eda(0x163)](_0xa68985=>{var _0x587800=_0x438eda;parseInt(_0xa68985[_0x587800(0x11e)])<parseInt(_0xa68985['to_quantity'])&&_0x3a0449++;});if(_0x3a0449!=0x0)return _0x254340[_0x438eda(0x18f)](_0x438eda(0x14f),_0x438eda(0x152)),_0x5406a8[_0x438eda(0xff)]('back');const _0x522a9a=await warehouse[_0x438eda(0x17a)]({'name':_0x36b3f1['from_warehouse'],'room':_0x36b3f1[_0x438eda(0xf5)]});_0x36b3f1['product'][_0x438eda(0x163)](_0x23eb40=>{var _0x2c943f=_0x438eda;if(_0x23eb40['to_quantity']>0x0){const _0x5ca8e9=_0x522a9a[_0x2c943f(0x155)][_0x2c943f(0x13a)](_0xd48a7a=>{var _0x3cd7c5=_0x2c943f;_0xd48a7a[_0x3cd7c5(0x1a3)]==_0x23eb40['product_name']&&_0xd48a7a['bay']==_0x23eb40['from_bay']&&(_0xd48a7a['product_stock']=parseInt(_0xd48a7a[_0x3cd7c5(0x178)])+parseInt(_0x23eb40[_0x3cd7c5(0x133)]));});}}),await _0x522a9a[_0x438eda(0x13e)]();const _0x37e221=await warehouse[_0x438eda(0x17a)]({'name':_0x36b3f1['to_warehouse'],'room':_0x36b3f1['to_room']});_0x36b3f1[_0x438eda(0x12c)][_0x438eda(0x163)](_0x1005a8=>{var _0x4e45ac=_0x438eda;if(_0x1005a8[_0x4e45ac(0x133)]>0x0){const _0xbbf92=_0x37e221[_0x4e45ac(0x155)][_0x4e45ac(0x13a)](_0x141a31=>{var _0x142491=_0x4e45ac;_0x141a31['product_name']==_0x1005a8['product_name']&&_0x141a31[_0x142491(0x13c)]==_0x1005a8[_0x142491(0xef)]&&(_0x141a31[_0x142491(0x178)]=parseInt(_0x141a31[_0x142491(0x178)])-parseInt(_0x1005a8[_0x142491(0x133)]));});}}),await _0x37e221['save'](),_0x36b3f1[_0x438eda(0x192)]=_0x2ca5f4,_0x36b3f1[_0x438eda(0x19d)]=_0x5566c4,_0x36b3f1[_0x438eda(0x125)]=_0x28732b,_0x36b3f1['product']=_0x5b7a2d,_0x36b3f1[_0x438eda(0xdf)]=_0x1eb126,_0x36b3f1[_0x438eda(0x11f)]=_0x3eaaff;const _0x4faf47=await _0x36b3f1[_0x438eda(0x13e)](),_0x4f0fa1=await warehouse[_0x438eda(0x17a)]({'name':_0x5566c4,'room':_0x11a8d6});_0x4faf47[_0x438eda(0x12c)][_0x438eda(0x163)](_0x1ae780=>{var _0x32d41d=_0x438eda;if(_0x1ae780[_0x32d41d(0x133)]>0x0){const _0x5bb4e3=_0x4f0fa1[_0x32d41d(0x155)][_0x32d41d(0x13a)](_0x10d08a=>{var _0x956ebf=_0x32d41d;_0x10d08a[_0x956ebf(0x1a3)]==_0x1ae780[_0x956ebf(0x1a3)]&&_0x10d08a[_0x956ebf(0x13c)]==_0x1ae780[_0x956ebf(0x1a4)]&&(_0x10d08a[_0x956ebf(0x178)]=parseInt(_0x10d08a['product_stock'])-parseInt(_0x1ae780['to_quantity']));});}}),await _0x4f0fa1[_0x438eda(0x13e)]();const _0x47b740=await warehouse[_0x438eda(0x17a)]({'name':_0x28732b,'room':_0x473524});_0x4faf47[_0x438eda(0x12c)]['forEach'](_0x17a061=>{var _0x11605b=_0x438eda;if(_0x17a061[_0x11605b(0x133)]>0x0){var _0x431c74=0x0;const _0x591cbb=_0x47b740['product_details']['map'](_0x12580f=>{var _0x4e7de4=_0x11605b;_0x12580f[_0x4e7de4(0x1a3)]==_0x17a061[_0x4e7de4(0x1a3)]&&_0x12580f[_0x4e7de4(0x13c)]==_0x17a061[_0x4e7de4(0xef)]&&(_0x12580f[_0x4e7de4(0x178)]=parseInt(_0x12580f[_0x4e7de4(0x178)])+parseInt(_0x17a061['to_quantity']),_0x431c74++);});_0x431c74=='0'&&(_0x47b740[_0x11605b(0x155)]=_0x47b740[_0x11605b(0x155)][_0x11605b(0xee)]({'product_name':_0x17a061[_0x11605b(0x1a3)],'product_stock':_0x17a061[_0x11605b(0x133)],'bay':_0x17a061['to_bay'],'product_code':_0x17a061[_0x11605b(0x149)],'primary_code':_0x17a061[_0x11605b(0x1a5)],'secondary_code':_0x17a061[_0x11605b(0x13b)],'maxProducts':_0x17a061['maxProducts']}));}}),await _0x47b740[_0x438eda(0x13e)](),_0x254340['flash'](_0x438eda(0x18c),_0x438eda(0x13f)),_0x5406a8['redirect'](_0x438eda(0xe6));}catch(_0x390900){console['log'](_0x390900);}}),router['post'](a0_0x1f932e(0x14a),async(_0x334ef8,_0x20f5a4)=>{var _0x4abbb3=a0_0x1f932e;const {FromWareHouse:_0x5bb569,FromRoom:_0x2f2d41,ToWarehouse:_0x6e0e84,ToRoom:_0xd7ca3a,primary_code:_0x1c16be,Roomslist:_0xd5f382}=_0x334ef8[_0x4abbb3(0x19e)],_0x5bb663=_0xd5f382[_0x4abbb3(0xf9)](','),_0x26f7cf=[];async function _0x587151(_0x32db5b){var _0x5d526f=_0x4abbb3;const _0x1cca0b=await warehouse['aggregate']([{'$match':{'name':_0x5bb569,'room':_0x32db5b}},{'$unwind':_0x5d526f(0x147)},{'$match':{'product_details.primary_code':_0x1c16be}},{'$group':{'_id':_0x5d526f(0x170),'name':{'$first':_0x5d526f(0x11d)},'instock':{'$first':_0x5d526f(0x159)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d526f(0x104)},'product_code':{'$first':_0x5d526f(0xec)},'level':{'$first':_0x5d526f(0x111)},'isle':{'$first':_0x5d526f(0xfc)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x5d526f(0xe0)},'unit':{'$first':_0x5d526f(0xfb)},'secondary_unit':{'$first':_0x5d526f(0x16e)},'storage':{'$first':_0x5d526f(0x112)},'rack':{'$first':_0x5d526f(0x132)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x5d526f(0xe1)},'maxPerUnit':{'$first':_0x5d526f(0x148)},'roomNamed':{'$first':_0x5d526f(0x164)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x5d526f(0x136)}}}]),_0x5c2141=await warehouse[_0x5d526f(0xcc)]([{'$match':{'name':_0x5bb569,'room':_0x32db5b}},{'$unwind':_0x5d526f(0x147)},{'$match':{'product_details.secondary_code':_0x1c16be}},{'$group':{'_id':_0x5d526f(0x170),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x5d526f(0x159)},'primary_code':{'$first':_0x5d526f(0x144)},'secondary_code':{'$first':_0x5d526f(0x104)},'product_code':{'$first':_0x5d526f(0xec)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x5d526f(0xfc)},'type':{'$first':_0x5d526f(0xe8)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x5d526f(0x112)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5d526f(0xe3)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x5d526f(0xe1)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x5d526f(0x164)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x5d526f(0x136)}}}]);if(_0x1cca0b[_0x5d526f(0xe5)]>0x0)_0x26f7cf[_0x5d526f(0x191)](_0x1cca0b);else _0x5c2141[_0x5d526f(0xe5)]>0x0&&_0x26f7cf[_0x5d526f(0x191)](_0x5c2141);}const _0x8fdcf2=_0x5bb663[_0x4abbb3(0x13a)](_0x12558c=>_0x587151(_0x12558c));await Promise[_0x4abbb3(0x154)](_0x8fdcf2),_0x20f5a4[_0x4abbb3(0x123)](_0x26f7cf);}),router['post'](a0_0x1f932e(0xf6),async(_0x3ead7a,_0x79358a)=>{var _0x4031c3=a0_0x1f932e;try{const {FromWareHouse:_0x32a031,FromRoom:_0x38c119,ToWarehouse:_0x3c4400,ToRoom:_0x19ac9a,secondary_code:_0x263e04}=_0x3ead7a[_0x4031c3(0x19e)],_0xdc5d22=await warehouse[_0x4031c3(0xcc)]([{'$match':{'name':_0x32a031}},{'$unwind':_0x4031c3(0x147)},{'$match':{'product_details.secondary_code':_0x263e04}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x4031c3(0x144)},'secondary_code':{'$first':_0x4031c3(0x104)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x4031c3(0x159)},'warehouse':{'$first':'$name'},'level':{'$first':_0x4031c3(0x196)},'isle':{'$first':_0x4031c3(0xea)},'pallet':{'$first':_0x4031c3(0x124)},'maxProducts':{'$first':_0x4031c3(0x181)},'unit':{'$first':_0x4031c3(0xfb)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4031c3(0x157)}}}]);_0x79358a[_0x4031c3(0x137)](0xc8)['json'](_0xdc5d22);}catch(_0x3e5b9b){_0x79358a[_0x4031c3(0x137)](0x194)[_0x4031c3(0x123)]({'message':_0x3e5b9b[_0x4031c3(0xfd)]});}}),router['post']('/barcode_scanner3',async(_0x4a9ac7,_0x3b0bb3)=>{var _0x3d4d22=a0_0x1f932e;try{const {FromWareHouse:_0x32c95b,FromRoom:_0xe9e631,ToWarehouse:_0x4ca52a,ToRoom:_0xd3ce91,product_code:_0x216997}=_0x4a9ac7[_0x3d4d22(0x19e)],_0x3d157a=await warehouse[_0x3d4d22(0xcc)]([{'$match':{'name':_0x32c95b}},{'$unwind':_0x3d4d22(0x147)},{'$match':{'product_details.product_code':_0x216997}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3d4d22(0x11d)},'primary_code':{'$first':_0x3d4d22(0x144)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x3d4d22(0x159)},'warehouse':{'$first':_0x3d4d22(0x126)},'level':{'$first':_0x3d4d22(0x196)},'isle':{'$first':_0x3d4d22(0xea)},'pallet':{'$first':_0x3d4d22(0x124)},'maxProducts':{'$first':_0x3d4d22(0x181)},'unit':{'$first':'$product_details.unit'}}}]);_0x3b0bb3[_0x3d4d22(0x137)](0xc8)['json'](_0x3d157a);}catch(_0xd5f81f){_0x3b0bb3[_0x3d4d22(0x137)](0x194)[_0x3d4d22(0x123)]({'message':_0xd5f81f[_0x3d4d22(0xfd)]});}}),router[a0_0x1f932e(0xe4)](a0_0x1f932e(0x120),async(_0x151a4f,_0x2f0177)=>{var _0x37b2f9=a0_0x1f932e;const {productCode:_0x5a644f,bay:_0x3e2938,warehouses:_0xc3ce83,room:_0x41aac8}=_0x151a4f[_0x37b2f9(0x19e)];console['log'](_0x151a4f[_0x37b2f9(0x19e)]);try{const _0x3ce274=await warehouse[_0x37b2f9(0xcc)]([{'$match':{'name':_0xc3ce83,'room':_0x41aac8}},{'$unwind':_0x37b2f9(0x147)},{'$match':{'product_details.bay':parseInt(_0x3e2938)}},{'$group':{'_id':_0x37b2f9(0x170),'name':{'$first':_0x37b2f9(0x11d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x37b2f9(0x111)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x2f0177[_0x37b2f9(0x137)](0xc8)[_0x37b2f9(0x123)](_0x3ce274);}catch(_0x105664){_0x2f0177[_0x37b2f9(0x137)](0x194)[_0x37b2f9(0x123)]({'message':_0x105664[_0x37b2f9(0xfd)]});}}),module[a0_0x1f932e(0x194)]=router;function a0_0x1487(){var _0x441415=['$name','express','451730mkQLFd','finalize','from_invoice','FGSEmail','product','createTransport','<h5\x20style=\x22text-align:\x20left;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','QA\x20Warehouse','toString','$product_details.rack','to_quantity','log','batch_code','$product_details.invoice','status','Ambient','sendMail','map','secondary_code','bay','secondary_unit','save','Transfer\x20Edit\x20Successfully','/transfer/view','True','Portuguese\x20(BR)','$_id','$product_details.primary_code','/view/:id','<strong>\x20Regards\x20</strong>','$product_details','$product_details.maxPerUnit','product_code','/barcode_scanner','Arabic','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','primary_unit','Transfer\x20Finalize\x20Successfully','errors','Spanish','</body></html>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','all','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.production_date','/view','$product_details.product_stock','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic\x20(ae)','54NebhzJ','English\x20(US)','string','to_invoice','undefined','get','</span>','forEach','$room','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Transfer\x20Mail','from_prod_level','to_room_name','../models/all_models','role','<div>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.secondary_unit','maxProducts','$product_details._id','from_room_name','An\x20error\x20occurred\x20while\x20saving\x20data.','to_floorlevel','add_transfer_finished','error','94eKQzEi','Router','product_stock','</table>','findOne','find','Portuguese','render','to_room','product_date','</tbody>','$product_details.maxProducts','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','site_title','3287072ImYhPM','prod_name','warehouse','here2','abs','Rack\x201','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','user','success','Product\x20Transfer\x20successfully','\x20<>\x20','flash','Chinese','push','date','/view/add_transfer','exports','id_transaction','$product_details.level','Hindi','padStart','To_invoice','<!DOCTYPE\x20html>','production_date','<h2>\x20','from_warehouse','body','\x20Order\x20Date\x20:\x20','../middleware/auth','getFullYear','here1','product_name','from_bay','primary_code','maxPerUnit','</h5>','product_code3','aggregate','updateOne','257776EuzGeT','password','German','$product','English','62923vGrQUW','host','Finished\x20Goods','829376wOKjiW','logo','max','ToRoomAssigned','13065ZjehvI','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','An\x20error\x20occurred.','staff','MaxStocks_data','note','$product_details.floorlevel','$product_details.batch_code','/../public','$product_details.expiry_date','post','length','/transfer_finished/view','<span\x20style=\x22float:\x20right;\x22>','$product_details.type','/transfer_finished/preview/','$product_details.isle','<hr\x20class=\x22my-3\x22>','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','concat','to_bay','slice','$finalize','prod_cat','</div>','</td>','from_room','/barcode_scanner2','</tr>','MaxStocks_data2','split','language','$product_details.unit','$product_details.bin','message','edit_transfer_finished','redirect','/preview/:id','$from_warehouse','nodemailer','port','$product_details.secondary_code','catch','findById','French','/upload/','Error\x20Occurs','unit','getDate','to_prod_level','expiry_date','from_prod_qty','_id','TRFF-','$product_details.bay','$product_details.storage','../public/language/languages.json','params','$to_warehouse','then','5435604qqZfgX','Enabled','RoomAssigned','FROZEN\x20GOODS','DRY\x20GOODS','email','$product_details.product_name','from_quantity','invoice','/CheckingWarehouse','<tr>','filter','json','$product_details.pallet','to_warehouse'];a0_0x1487=function(){return _0x441415;};return a0_0x1487();}