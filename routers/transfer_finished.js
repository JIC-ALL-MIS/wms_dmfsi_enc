var a0_0x3c95c9=a0_0x38bc;(function(_0xa57de5,_0x3a2d32){var _0x14901b=a0_0x38bc,_0x3ac8d5=_0xa57de5();while(!![]){try{var _0x348f73=parseInt(_0x14901b(0xb9))/0x1+-parseInt(_0x14901b(0xe9))/0x2*(-parseInt(_0x14901b(0xd5))/0x3)+-parseInt(_0x14901b(0x10a))/0x4*(parseInt(_0x14901b(0x71))/0x5)+parseInt(_0x14901b(0xdb))/0x6+parseInt(_0x14901b(0xcf))/0x7+-parseInt(_0x14901b(0x7b))/0x8*(-parseInt(_0x14901b(0xdd))/0x9)+-parseInt(_0x14901b(0x99))/0xa;if(_0x348f73===_0x3a2d32)break;else _0x3ac8d5['push'](_0x3ac8d5['shift']());}catch(_0x51d0fb){_0x3ac8d5['push'](_0x3ac8d5['shift']());}}}(a0_0x529f,0xc4aa6));const express=require(a0_0x3c95c9(0x11b)),app=express(),router=express[a0_0x3c95c9(0x106)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3c95c9(0x110)),users=require(a0_0x3c95c9(0x104)),nodemailer=require('nodemailer');router[a0_0x3c95c9(0x9e)](a0_0x3c95c9(0x82),auth,async(_0x4ccf00,_0x4a37a1)=>{var _0x21a627=a0_0x3c95c9;try{const {username:_0x2352af,email:_0xbb63d0,role:_0x1f08af}=_0x4ccf00[_0x21a627(0x7c)],_0x1d2765=_0x4ccf00[_0x21a627(0x7c)],_0x56bbcb=await profile[_0x21a627(0x95)]({'email':_0x1d2765[_0x21a627(0x8e)]}),_0x335feb=await master_shop[_0x21a627(0xe3)]();let _0x1561c8;if(_0x1d2765[_0x21a627(0xa5)]==_0x21a627(0xd7)){const _0x44a505=await staff[_0x21a627(0x95)]({'email':_0x1d2765['email']});_0x1561c8=await transfers_finished[_0x21a627(0xe3)]({'from_warehouse':_0x44a505['warehouse']});}else _0x1561c8=await transfers_finished[_0x21a627(0xfd)]([{'$unwind':_0x21a627(0x6b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x21a627(0xf2)},'date':{'$first':_0x21a627(0x6a)},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x21a627(0x105)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x21a627(0x109)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x335feb[0x0][_0x21a627(0x88)]==_0x21a627(0x12c))var _0x40e28b=users[_0x21a627(0xfb)];else{if(_0x335feb[0x0]['language']==_0x21a627(0x10c))var _0x40e28b=users['Hindi'];else{if(_0x335feb[0x0][_0x21a627(0x88)]==_0x21a627(0x94))var _0x40e28b=users['German'];else{if(_0x335feb[0x0][_0x21a627(0x88)]==_0x21a627(0x133))var _0x40e28b=users[_0x21a627(0x133)];else{if(_0x335feb[0x0][_0x21a627(0x88)]==_0x21a627(0xd0))var _0x40e28b=users[_0x21a627(0xd0)];else{if(_0x335feb[0x0][_0x21a627(0x88)]==_0x21a627(0xbf))var _0x40e28b=users[_0x21a627(0x10d)];else{if(_0x335feb[0x0][_0x21a627(0x88)]==_0x21a627(0x134))var _0x40e28b=users['Chinese'];else{if(_0x335feb[0x0][_0x21a627(0x88)]=='Arabic\x20(ae)')var _0x40e28b=users[_0x21a627(0x129)];}}}}}}}_0x4a37a1[_0x21a627(0x93)](_0x21a627(0x111),{'success':_0x4ccf00[_0x21a627(0x7d)]('success'),'errors':_0x4ccf00[_0x21a627(0x7d)](_0x21a627(0x9d)),'role':_0x1d2765,'profile':_0x56bbcb,'master_shop':_0x335feb,'transfer':_0x1561c8,'language':_0x40e28b});}catch(_0x2e9152){console['log'](_0x2e9152);}});function a0_0x38bc(_0xb3eeb8,_0x32e2c8){var _0x529f54=a0_0x529f();return a0_0x38bc=function(_0x38bce3,_0x44b7fc){_0x38bce3=_0x38bce3-0x64;var _0x5d8b74=_0x529f54[_0x38bce3];return _0x5d8b74;},a0_0x38bc(_0xb3eeb8,_0x32e2c8);}async function getRandom8DigitNumber(){var _0x4df2fb=a0_0x3c95c9;const _0x47c367=0x989680,_0x22c2cf=0x5f5e0ff,_0x3234a0=Math['floor'](Math['random']()*(_0x22c2cf-_0x47c367+0x1))+_0x47c367;var _0x107102;const _0x8f9604=await transfers_finished['findOne']({'invoice':_0x4df2fb(0xb4)+_0x3234a0});return _0x8f9604&&_0x8f9604['length']>0x0?_0x107102=_0x4df2fb(0xb4)+_0x3234a0:_0x107102=_0x4df2fb(0xb4)+_0x3234a0,_0x107102;}router[a0_0x3c95c9(0x9e)](a0_0x3c95c9(0x11f),auth,async(_0x4c7b4a,_0x53ae4d)=>{var _0x1fbf2b=a0_0x3c95c9;try{const {username:_0x138c2b,email:_0x4820b6,role:_0x575e57}=_0x4c7b4a[_0x1fbf2b(0x7c)],_0x5ec3d8=_0x4c7b4a[_0x1fbf2b(0x7c)],_0x5a4a87=await profile[_0x1fbf2b(0x95)]({'email':_0x5ec3d8[_0x1fbf2b(0x8e)]}),_0x15c5d7=await master_shop[_0x1fbf2b(0xe3)]();let _0x242dec;if(_0x5ec3d8['role']==_0x1fbf2b(0xd7)){const _0x1b525a=await staff[_0x1fbf2b(0x95)]({'email':_0x5ec3d8['email']});_0x242dec=await warehouse[_0x1fbf2b(0xfd)]([{'$match':{'status':_0x1fbf2b(0xab),'name':_0x1b525a['warehouse'],'warehouse_category':_0x1fbf2b(0xa8),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1fbf2b(0xe4),'name':{'$first':'$name'}}}]);}else _0x242dec=await warehouse['aggregate']([{'$match':{'status':_0x1fbf2b(0xab),'warehouse_category':_0x1fbf2b(0xa8),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1fbf2b(0xe4),'name':{'$first':_0x1fbf2b(0xe4)}}}]);const _0x1c8f3f=await transfers_finished[_0x1fbf2b(0xe3)]({}),_0x3fffd4=_0x1c8f3f[_0x1fbf2b(0x13b)]+0x1,_0x3cc9e9=_0x1fbf2b(0xb4)+_0x3fffd4[_0x1fbf2b(0xca)]()[_0x1fbf2b(0x70)](0x5,'0');if(_0x15c5d7[0x0][_0x1fbf2b(0x88)]==_0x1fbf2b(0x12c))var _0x574855=users[_0x1fbf2b(0xfb)];else{if(_0x15c5d7[0x0][_0x1fbf2b(0x88)]==_0x1fbf2b(0x10c))var _0x574855=users[_0x1fbf2b(0x10c)];else{if(_0x15c5d7[0x0][_0x1fbf2b(0x88)]==_0x1fbf2b(0x94))var _0x574855=users[_0x1fbf2b(0x94)];else{if(_0x15c5d7[0x0][_0x1fbf2b(0x88)]==_0x1fbf2b(0x133))var _0x574855=users['Spanish'];else{if(_0x15c5d7[0x0][_0x1fbf2b(0x88)]==_0x1fbf2b(0xd0))var _0x574855=users['French'];else{if(_0x15c5d7[0x0]['language']=='Portuguese\x20(BR)')var _0x574855=users[_0x1fbf2b(0x10d)];else{if(_0x15c5d7[0x0][_0x1fbf2b(0x88)]==_0x1fbf2b(0x134))var _0x574855=users['Chinese'];else{if(_0x15c5d7[0x0]['language']==_0x1fbf2b(0x117))var _0x574855=users['Arabic'];}}}}}}}const _0x350060=getRandom8DigitNumber();_0x350060['then'](_0xd8d729=>{var _0x150463=_0x1fbf2b;_0x53ae4d['render'](_0x150463(0xf4),{'success':_0x4c7b4a[_0x150463(0x7d)](_0x150463(0x87)),'errors':_0x4c7b4a[_0x150463(0x7d)]('errors'),'role':_0x5ec3d8,'profile':_0x5a4a87,'master_shop':_0x15c5d7,'warehouse':_0x242dec,'language':_0x574855,'invoice':_0xd8d729});})[_0x1fbf2b(0x136)](_0x1ecdfa=>{var _0x5adc4b=_0x1fbf2b;_0x4c7b4a['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x53ae4d[_0x5adc4b(0xd1)](_0x5adc4b(0x83));});}catch(_0x1a7cc4){console[_0x1fbf2b(0xa1)](_0x1a7cc4);}}),router[a0_0x3c95c9(0x91)](a0_0x3c95c9(0x11f),auth,async(_0x3f9935,_0x761bb3)=>{var _0x38d8d8=a0_0x3c95c9;try{const {date:_0x399f05,from_warehouse:_0x3eb6b2,FromRoom_name:_0x57afa4,to_warehouse:_0x72dc74,ToRoom_name:_0x5e0335,prod_name:_0x38028e,from_prod_qty:_0x5923d4,from_prod_level:_0x5c14d5,from_prod_isle:_0x108d7d,from_prod_pallet:_0x37c1dc,to_prod_qty:_0xa74d74,to_prod_level:_0x2f91a5,to_prod_isle:_0x2f4eda,to_prod_pallet:_0x4a1321,primary_code:_0x1a7797,secondary_code:_0x2aeafb,product_code3:_0xebc59,note:_0x3fb313,MaxStocks_data2:_0x55cce8,invoice:_0x49fd45,expiry_date:_0x41898d}=_0x3f9935[_0x38d8d8(0xac)];if(typeof _0x38028e=='string')var _0x5b49a5=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x77)]],_0x540cd8=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xdc)]],_0xc602f1=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xda)]],_0x54b970=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x138)]],_0x59029e=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x7a)]],_0x14082d=[_0x3f9935['body']['primary_code']],_0x3a3e2e=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xb3)]],_0x40a77c=[_0x3f9935['body'][_0x38d8d8(0x113)]],_0x1813a0=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xe8)]],_0x43812c=[_0x3f9935[_0x38d8d8(0xac)]['primary_unit']],_0xb9ea02=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x8c)]],_0x4fa31c=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xd6)]],_0x137018=[_0x3f9935['body'][_0x38d8d8(0x67)]],_0x1c0743=[_0x3f9935[_0x38d8d8(0xac)]['product_date']],_0x110d82=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xa4)]],_0x753999=[_0x3f9935[_0x38d8d8(0xac)]['maxPerUnit']],_0x4738af=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xf5)]],_0x284b4d=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x85)]],_0x119d86=[_0x3f9935['body']['ToRoomAssigned']],_0x251329=[_0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x124)]],_0x299b16=[_0x3f9935['body'][_0x38d8d8(0xf9)]];else var _0x5b49a5=[..._0x3f9935['body'][_0x38d8d8(0x77)]],_0x540cd8=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xdc)]],_0xc602f1=[..._0x3f9935[_0x38d8d8(0xac)]['from_prod_level']],_0x54b970=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x138)]],_0x59029e=[..._0x3f9935['body'][_0x38d8d8(0x7a)]],_0x14082d=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x123)]],_0x3a3e2e=[..._0x3f9935['body'][_0x38d8d8(0xb3)]],_0x40a77c=[..._0x3f9935['body']['product_code3']],_0x1813a0=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xe8)]],_0x43812c=[..._0x3f9935[_0x38d8d8(0xac)]['primary_unit']],_0xb9ea02=[..._0x3f9935[_0x38d8d8(0xac)]['secondary_unit']],_0x4fa31c=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xd6)]],_0x137018=[..._0x3f9935['body']['expiry_date']],_0x1c0743=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x8a)]],_0x110d82=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xa4)]],_0x753999=[..._0x3f9935['body'][_0x38d8d8(0xc1)]],_0x4738af=[..._0x3f9935[_0x38d8d8(0xac)]['prod_cat']],_0x284b4d=[..._0x3f9935[_0x38d8d8(0xac)]['RoomAssigned']],_0x119d86=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0x128)]],_0x251329=[..._0x3f9935[_0x38d8d8(0xac)]['from_invoice']],_0x299b16=[..._0x3f9935[_0x38d8d8(0xac)][_0x38d8d8(0xf9)]];const _0x49045e=_0x5b49a5[_0x38d8d8(0x12a)](_0x550a0c=>{return _0x550a0c={'product_name':_0x550a0c};});_0x540cd8[_0x38d8d8(0x11c)]((_0x371d02,_0x433dfd)=>{var _0x56a7aa=_0x38d8d8;_0x49045e[_0x433dfd][_0x56a7aa(0xb8)]=_0x371d02;}),_0xc602f1[_0x38d8d8(0x11c)]((_0x4761ae,_0x40de85)=>{var _0x484e8f=_0x38d8d8;_0x49045e[_0x40de85][_0x484e8f(0xc3)]=_0x4761ae;}),_0x251329[_0x38d8d8(0x11c)]((_0x3034fe,_0x391339)=>{var _0x3d26d9=_0x38d8d8;_0x49045e[_0x391339][_0x3d26d9(0x124)]=_0x3034fe;}),_0x299b16[_0x38d8d8(0x11c)]((_0x4e2912,_0x1de6bb)=>{var _0x49a1a5=_0x38d8d8;_0x49045e[_0x1de6bb][_0x49a1a5(0x72)]=_0x4e2912;}),_0x54b970[_0x38d8d8(0x11c)]((_0x39c5d9,_0x581e89)=>{_0x49045e[_0x581e89]['to_quantity']=_0x39c5d9;}),_0x59029e[_0x38d8d8(0x11c)]((_0x2901e5,_0x1adcd6)=>{var _0x3c8f93=_0x38d8d8;_0x49045e[_0x1adcd6][_0x3c8f93(0x9f)]=_0x2901e5;}),_0x14082d[_0x38d8d8(0x11c)]((_0x391b63,_0x53c574)=>{var _0x46e3de=_0x38d8d8;_0x49045e[_0x53c574][_0x46e3de(0x123)]=_0x391b63;}),_0x3a3e2e['forEach']((_0x13d848,_0x496d18)=>{_0x49045e[_0x496d18]['secondary_code']=_0x13d848;}),_0x40a77c[_0x38d8d8(0x11c)]((_0x21cedd,_0x169e6f)=>{var _0x2168ac=_0x38d8d8;_0x49045e[_0x169e6f][_0x2168ac(0x65)]=_0x21cedd;}),_0x1813a0[_0x38d8d8(0x11c)]((_0x290052,_0xa595f8)=>{_0x49045e[_0xa595f8]['maxProducts']=_0x290052;}),_0x43812c[_0x38d8d8(0x11c)]((_0x32868e,_0x544f62)=>{var _0xf68d0=_0x38d8d8;_0x49045e[_0x544f62][_0xf68d0(0xb7)]=_0x32868e;}),_0xb9ea02[_0x38d8d8(0x11c)]((_0x1ddb9d,_0x496841)=>{var _0x58cb8a=_0x38d8d8;_0x49045e[_0x496841][_0x58cb8a(0x8c)]=_0x1ddb9d;}),_0x4fa31c['forEach']((_0x1f0d39,_0x3867cb)=>{var _0x38d196=_0x38d8d8;_0x49045e[_0x3867cb][_0x38d196(0xd6)]=_0x1f0d39;}),_0x137018[_0x38d8d8(0x11c)]((_0x56ff07,_0x3d9928)=>{var _0x16a0a0=_0x38d8d8;_0x49045e[_0x3d9928][_0x16a0a0(0x67)]=_0x56ff07;}),_0x1c0743['forEach']((_0x490e29,_0x5604e5)=>{_0x49045e[_0x5604e5]['production_date']=_0x490e29;}),_0x110d82[_0x38d8d8(0x11c)]((_0x5c7739,_0x55a6cc)=>{var _0x4182e8=_0x38d8d8;_0x49045e[_0x55a6cc][_0x4182e8(0xcc)]=_0x5c7739;}),_0x753999['forEach']((_0x348fcf,_0x3c50ca)=>{var _0x372c38=_0x38d8d8;_0x49045e[_0x3c50ca][_0x372c38(0xc1)]=_0x348fcf;}),_0x4738af[_0x38d8d8(0x11c)]((_0x13c352,_0x1c1fa2)=>{_0x49045e[_0x1c1fa2]['prod_cat']=_0x13c352;}),_0x284b4d[_0x38d8d8(0x11c)]((_0x401b65,_0x47a455)=>{var _0x1a882d=_0x38d8d8;_0x49045e[_0x47a455][_0x1a882d(0xdf)]=_0x401b65;}),_0x119d86['forEach']((_0x2b783c,_0x4392c0)=>{var _0x4664e5=_0x38d8d8;_0x49045e[_0x4392c0][_0x4664e5(0x126)]=_0x2b783c;});const _0x2d3d6a=_0x49045e[_0x38d8d8(0xa6)](_0x1357c3=>_0x1357c3[_0x38d8d8(0xa2)]!=='0'&&_0x1357c3['to_quantity']!==''||_0x1357c3[_0x38d8d8(0x98)]!=='0'&&_0x1357c3[_0x38d8d8(0x98)]!=='');var _0x27df6a=0x0;_0x2d3d6a[_0x38d8d8(0x11c)](_0x3cd0af=>{var _0x130960=_0x38d8d8;parseInt(_0x3cd0af[_0x130960(0xb8)])<parseInt(_0x3cd0af[_0x130960(0xa2)])&&_0x27df6a++;});if(_0x27df6a!=0x0)return _0x3f9935[_0x38d8d8(0x7d)](_0x38d8d8(0x9d),_0x38d8d8(0x6f)),_0x761bb3['redirect'](_0x38d8d8(0xc2));const _0x5471d2=new transfers_finished({'date':_0x399f05,'from_warehouse':_0x3eb6b2,'to_warehouse':_0x72dc74,'product':_0x2d3d6a,'note':_0x3fb313,'invoice':_0x49fd45}),_0x53965b=await _0x5471d2['save']();_0x3f9935[_0x38d8d8(0x7d)](_0x38d8d8(0x87),_0x38d8d8(0x74)),_0x761bb3[_0x38d8d8(0xd1)](_0x38d8d8(0x139)+_0x53965b[_0x38d8d8(0x10e)]);}catch(_0x467ded){console[_0x38d8d8(0xa1)](_0x467ded),_0x761bb3[_0x38d8d8(0x9b)](0xc8)[_0x38d8d8(0x11a)]({'errorMessage':_0x467ded['message']});}}),router[a0_0x3c95c9(0x9e)](a0_0x3c95c9(0xbb),auth,async(_0x582086,_0x1e8195)=>{var _0x20ec42=a0_0x3c95c9;try{const {username:_0x4a9242,email:_0x345990,role:_0x203675}=_0x582086[_0x20ec42(0x7c)],_0x2d1322=_0x582086['user'],_0x1f4488=await profile['findOne']({'email':_0x2d1322[_0x20ec42(0x8e)]}),_0x5b0220=await master_shop[_0x20ec42(0xe3)](),_0x4b15a8=await transfers_finished['findById'](_0x582086[_0x20ec42(0x7f)]['id']);let _0x26fae8;if(_0x2d1322[_0x20ec42(0xa5)]==_0x20ec42(0xd7)){const _0x946d9f=await staff[_0x20ec42(0x95)]({'email':_0x2d1322['email']});_0x26fae8=await warehouse['find']({'status':_0x20ec42(0xab),'name':_0x946d9f['warehouse'],'warehouse_category':_0x20ec42(0xa8)});}else _0x26fae8=await warehouse[_0x20ec42(0xe3)]({'status':'Enabled','warehouse_category':_0x20ec42(0xa8)});const _0x2049cd=await warehouse[_0x20ec42(0xfd)]([{'$match':{'name':_0x4b15a8[_0x20ec42(0xf1)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x20ec42(0x100)},'product_stock':{'$first':_0x20ec42(0x12b)},'bay':{'$first':_0x20ec42(0x76)},'bin':{'$first':_0x20ec42(0x12d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x20ec42(0x122)},'primary_code':{'$first':_0x20ec42(0xeb)},'secondary_code':{'$first':_0x20ec42(0xd2)},'product_code':{'$first':_0x20ec42(0xec)},'storage':{'$first':_0x20ec42(0xb0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x20ec42(0xf6)},'room':{'$first':_0x20ec42(0xc8)},'warehoue_name':{'$first':'$name'}}}]),_0x5c180b=await product[_0x20ec42(0xe3)]({});if(_0x5b0220[0x0]['language']==_0x20ec42(0x12c)){var _0x5292e0=users[_0x20ec42(0xfb)];console[_0x20ec42(0xa1)](_0x5292e0);}else{if(_0x5b0220[0x0]['language']==_0x20ec42(0x10c))var _0x5292e0=users[_0x20ec42(0x10c)];else{if(_0x5b0220[0x0][_0x20ec42(0x88)]==_0x20ec42(0x94))var _0x5292e0=users[_0x20ec42(0x94)];else{if(_0x5b0220[0x0][_0x20ec42(0x88)]==_0x20ec42(0x133))var _0x5292e0=users['Spanish'];else{if(_0x5b0220[0x0]['language']==_0x20ec42(0xd0))var _0x5292e0=users[_0x20ec42(0xd0)];else{if(_0x5b0220[0x0][_0x20ec42(0x88)]==_0x20ec42(0xbf))var _0x5292e0=users[_0x20ec42(0x10d)];else{if(_0x5b0220[0x0][_0x20ec42(0x88)]==_0x20ec42(0x134))var _0x5292e0=users['Chinese'];else{if(_0x5b0220[0x0]['language']=='Arabic\x20(ae)')var _0x5292e0=users[_0x20ec42(0x129)];}}}}}}}_0x1e8195[_0x20ec42(0x93)](_0x20ec42(0xa7),{'success':_0x582086[_0x20ec42(0x7d)](_0x20ec42(0x87)),'errors':_0x582086[_0x20ec42(0x7d)](_0x20ec42(0x9d)),'role':_0x2d1322,'profile':_0x1f4488,'master_shop':_0x5b0220,'warehouse':_0x26fae8,'transfer':_0x4b15a8,'stock':_0x2049cd,'unit':_0x5c180b,'language':_0x5292e0});}catch(_0x56f724){console[_0x20ec42(0xa1)](_0x56f724);}}),router[a0_0x3c95c9(0x91)]('/preview/:id',auth,async(_0x36402b,_0x564e08)=>{var _0x47b819=a0_0x3c95c9;try{const {invoice:_0x10ac13,from_warehouse:_0x49d5cc,FromRoom_name:_0x4a9527,to_warehouse:_0x3fd741,ToRoom_name:_0x23cd72}=_0x36402b[_0x47b819(0xac)],_0x2652d7=await transfers_finished[_0x47b819(0x103)](_0x36402b[_0x47b819(0x7f)]['id']),_0x10186b=_0x2652d7[_0x47b819(0xf8)][_0x47b819(0x12a)](async _0x1f0cb1=>{var _0x50adc2=_0x47b819;if(_0x1f0cb1[_0x50adc2(0xa2)]>0x0){var _0x270fd9=await warehouse[_0x50adc2(0x95)]({'name':_0x49d5cc,'room':_0x1f0cb1[_0x50adc2(0xdf)],'warehouse_category':_0x50adc2(0xa8)});const _0x16013a=_0x270fd9[_0x50adc2(0xd8)][_0x50adc2(0x12a)](_0x34700c=>{var _0x28ad2a=_0x50adc2;_0x34700c[_0x28ad2a(0x96)]==_0x1f0cb1[_0x28ad2a(0x96)]&&_0x34700c[_0x28ad2a(0x131)]==_0x1f0cb1[_0x28ad2a(0xc3)]&&_0x34700c['expiry_date']==_0x1f0cb1['expiry_date']&&_0x34700c[_0x28ad2a(0x119)]==_0x1f0cb1[_0x28ad2a(0x119)]&&_0x34700c[_0x28ad2a(0xd6)]==_0x1f0cb1[_0x28ad2a(0xd6)]&&_0x34700c[_0x28ad2a(0xd3)]==_0x1f0cb1[_0x28ad2a(0x124)]&&(_0x34700c[_0x28ad2a(0xea)]=_0x34700c[_0x28ad2a(0xea)]-_0x1f0cb1[_0x28ad2a(0xa2)]);});}return _0x270fd9;});Promise[_0x47b819(0x66)](_0x10186b)[_0x47b819(0x6c)](async _0x19de8d=>{var _0x408cb0=_0x47b819;try{for(const _0x1636d1 of _0x19de8d){await _0x1636d1[_0x408cb0(0x8f)]();}const _0x5b2e9d=_0x2652d7[_0x408cb0(0xf8)]['map'](async _0x3003e2=>{var _0x13d31c=_0x408cb0,_0x5748e3=await warehouse['findOne']({'name':_0x3fd741,'room':_0x3003e2[_0x13d31c(0x126)]});if(_0x3003e2[_0x13d31c(0xa2)]>0x0){var _0x2bcbe5=0x0;const _0xe722b8=_0x5748e3[_0x13d31c(0xd8)][_0x13d31c(0x12a)](_0x4c0c7a=>{var _0x5dede8=_0x13d31c;_0x4c0c7a[_0x5dede8(0x96)]==_0x3003e2[_0x5dede8(0x96)]&&_0x4c0c7a[_0x5dede8(0x131)]==_0x3003e2['to_bay']&&_0x4c0c7a[_0x5dede8(0x67)]==_0x3003e2['expiry_date']&&_0x4c0c7a['production_date']==_0x3003e2[_0x5dede8(0x119)]&&_0x4c0c7a[_0x5dede8(0xd6)]==_0x3003e2[_0x5dede8(0xd6)]&&_0x4c0c7a['invoice']==_0x3003e2['To_invoice']&&(_0x4c0c7a[_0x5dede8(0xea)]=_0x4c0c7a[_0x5dede8(0xea)]+_0x3003e2[_0x5dede8(0xa2)],_0x2bcbe5++);});_0x2bcbe5=='0'&&(_0x5748e3[_0x13d31c(0xd8)]=_0x5748e3[_0x13d31c(0xd8)][_0x13d31c(0x8b)]({'product_name':_0x3003e2[_0x13d31c(0x96)],'product_stock':_0x3003e2['to_quantity'],'bay':_0x3003e2[_0x13d31c(0x9f)],'product_code':_0x3003e2[_0x13d31c(0x65)],'primary_code':_0x3003e2[_0x13d31c(0x123)],'secondary_code':_0x3003e2[_0x13d31c(0xb3)],'expiry_date':_0x3003e2[_0x13d31c(0x67)],'production_date':_0x3003e2[_0x13d31c(0x119)],'maxProducts':_0x3003e2['maxProducts'],'batch_code':_0x3003e2['batch_code'],'secondary_unit':_0x3003e2[_0x13d31c(0x8c)],'unit':_0x3003e2['unit'],'maxProducts':_0x3003e2[_0x13d31c(0xcc)],'maxPerUnit':_0x3003e2[_0x13d31c(0xc1)],'invoice':_0x3003e2[_0x13d31c(0x72)]}));}return _0x5748e3;});Promise[_0x408cb0(0x66)](_0x5b2e9d)[_0x408cb0(0x6c)](async _0x5317fc=>{var _0xfbdfd9=_0x408cb0;try{for(const _0x4ff724 of _0x5317fc){await warehouse[_0xfbdfd9(0x12f)]({'_id':_0x4ff724[_0xfbdfd9(0x10e)]},{'$addToSet':{'product_details':{'$each':_0x4ff724['product_details']}}});}_0x2652d7[_0xfbdfd9(0x68)]=_0xfbdfd9(0xfe);const _0x44ae4e=await _0x2652d7['save'](),_0x2d4382=await master_shop['find'](),_0x57ce11=await email_settings['findOne'](),_0xa9e933=await supervisor_settings[_0xfbdfd9(0xe3)]();var _0x2a97d8=_0x2652d7[_0xfbdfd9(0xf8)],_0x5d591a='',_0x21bcc0;for(_0x21bcc0 in _0x2a97d8){var _0x4036c3='FG';_0x2652d7[_0xfbdfd9(0xb1)]==_0xfbdfd9(0x101)&&(_0x4036c3='DG'),_0x5d591a+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a97d8[_0x21bcc0][_0xfbdfd9(0x96)]+_0xfbdfd9(0x102)+_0xfbdfd9(0x116)+_0x2a97d8[_0x21bcc0][_0xfbdfd9(0x65)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a97d8[_0x21bcc0][_0xfbdfd9(0xa2)]+_0xfbdfd9(0x102)+_0xfbdfd9(0x116)+_0x2a97d8[_0x21bcc0][_0xfbdfd9(0xb7)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a97d8[_0x21bcc0]['secondary_unit']+_0xfbdfd9(0x102)+_0xfbdfd9(0x116)+_0x2652d7['to_warehouse']+'</td>'+_0xfbdfd9(0x116)+_0x2a97d8[_0x21bcc0][_0xfbdfd9(0x126)]+_0xfbdfd9(0x102)+_0xfbdfd9(0x116)+_0x4036c3+_0x2a97d8[_0x21bcc0][_0xfbdfd9(0x9f)]+_0xfbdfd9(0x102)+_0xfbdfd9(0x69);}let _0x3d4df2=nodemailer[_0xfbdfd9(0x64)]({'host':_0x57ce11['host'],'port':Number(_0x57ce11[_0xfbdfd9(0xe2)]),'secure':![],'auth':{'user':_0x57ce11[_0xfbdfd9(0x8e)],'pass':_0x57ce11[_0xfbdfd9(0xee)]}}),_0x9b4910={'from':_0x57ce11['email'],'to':_0xa9e933[0x0][_0xfbdfd9(0xe0)],'subject':_0xfbdfd9(0xde),'attachments':[{'filename':_0xfbdfd9(0x79),'path':__dirname+_0xfbdfd9(0xc9)+_0xfbdfd9(0xe6)+_0x2d4382[0x0][_0xfbdfd9(0xb2)],'cid':_0xfbdfd9(0xf7)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0xfbdfd9(0x112)+_0xfbdfd9(0xcd)+_0xfbdfd9(0x9c)+_0xfbdfd9(0xcd)+_0xfbdfd9(0x84)+'</div>'+_0xfbdfd9(0xcd)+_0xfbdfd9(0xff)+_0x2d4382[0x0][_0xfbdfd9(0x90)]+_0xfbdfd9(0xe1)+_0xfbdfd9(0xc5)+_0xfbdfd9(0xc5)+_0xfbdfd9(0x13d)+_0xfbdfd9(0xcd)+_0xfbdfd9(0xaa)+_0xfbdfd9(0xbd)+_0x2652d7[_0xfbdfd9(0xd3)]+'\x20'+_0xfbdfd9(0xa0)+_0xfbdfd9(0xfc)+_0x2652d7[_0xfbdfd9(0xae)]+'\x20'+_0xfbdfd9(0xd9)+_0xfbdfd9(0xe7)+_0xfbdfd9(0xc5)+_0xfbdfd9(0x13c)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xfbdfd9(0x130)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xfbdfd9(0x75)+_0xfbdfd9(0x89)+_0xfbdfd9(0x132)+_0xfbdfd9(0x135)+_0xfbdfd9(0x10b)+_0xfbdfd9(0xce)+_0xfbdfd9(0xc7)+_0xfbdfd9(0x69)+'</thead>'+_0xfbdfd9(0x12e)+'\x20'+_0x5d591a+'\x20'+_0xfbdfd9(0xa9)+'</table>'+_0xfbdfd9(0xcd)+_0xfbdfd9(0x13a)+'<h5>'+_0x2d4382[0x0][_0xfbdfd9(0x90)]+'</h5>'+'</div>'+_0xfbdfd9(0xc5)+_0xfbdfd9(0xbe)};_0x3d4df2[_0xfbdfd9(0x107)](_0x9b4910,function(_0x416ce5,_0x5b4643){var _0x4d3e28=_0xfbdfd9;_0x416ce5?(console[_0x4d3e28(0xa1)](_0x416ce5),console['log'](_0x4d3e28(0x9a))):console[_0x4d3e28(0xa1)]('Email\x20sent\x20successfully');}),_0x36402b[_0xfbdfd9(0x7d)](_0xfbdfd9(0x87),_0xfbdfd9(0xc6)),_0x564e08[_0xfbdfd9(0xd1)](_0xfbdfd9(0x108)+_0x44ae4e[_0xfbdfd9(0x10e)]);}catch(_0x4609a8){console[_0xfbdfd9(0x115)](_0x4609a8),_0x564e08[_0xfbdfd9(0x9b)](0x1f4)['json']({'error':_0xfbdfd9(0x8d)});}})['catch'](_0xe3ec4a=>{var _0xdc5131=_0x408cb0;console[_0xdc5131(0x115)](_0xe3ec4a),_0x564e08['status'](0x1f4)[_0xdc5131(0x11a)]({'error':_0xdc5131(0x7e)});});}catch(_0x5b4099){console[_0x408cb0(0x115)](_0x5b4099),_0x564e08[_0x408cb0(0x9b)](0x1f4)['json']({'error':_0x408cb0(0xbc)});}})[_0x47b819(0x136)](_0x1cae95=>{var _0x25fdb1=_0x47b819;console[_0x25fdb1(0x115)](_0x1cae95),_0x564e08[_0x25fdb1(0x9b)](0x1f4)[_0x25fdb1(0x11a)]({'error':_0x25fdb1(0x7e)});});}catch(_0x1ed6cd){_0x564e08['json']({'message':_0x1ed6cd[_0x47b819(0x6e)]});}});function BayBinSelected(_0x31f60c,_0xf566be){var _0x146f5a=a0_0x3c95c9,_0xaf9624=[];let _0x121ad1=[];var _0x3d8898=[];if(_0x31f60c==_0x146f5a(0x101)){switch(_0xf566be){case _0x146f5a(0x80):_0xaf9624=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x146f5a(0x121):_0xaf9624=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3d8898=['DG'];}else{if(_0x31f60c=='FROZEN\x20GOODS'){switch(_0xf566be){case _0x146f5a(0x80):_0xaf9624=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x146f5a(0x121):_0xaf9624=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3d8898=['FG'];}}return{'levels':_0xaf9624,'identify':_0x3d8898};}router['get']('/view/:id',auth,async(_0x2418b3,_0x496bb6)=>{var _0x73081e=a0_0x3c95c9;try{const {username:_0x16b8ef,email:_0x3b6bd9,role:_0x50b983}=_0x2418b3['user'],_0x56dc2a=_0x2418b3['user'],_0x30a54c=await profile[_0x73081e(0x95)]({'email':_0x56dc2a[_0x73081e(0x8e)]}),_0x32a2cc=await master_shop[_0x73081e(0xe3)](),_0x159744=await transfers_finished['findById'](_0x2418b3[_0x73081e(0x7f)]['id']);let _0x3e18f5=new Date(_0x159744[_0x73081e(0x67)]),_0x54c370=('0'+_0x3e18f5[_0x73081e(0xcb)]())[_0x73081e(0x81)](-0x2),_0x39589a=('0'+(_0x3e18f5[_0x73081e(0x120)]()+0x1))[_0x73081e(0x81)](-0x2),_0x94d2d7=_0x3e18f5[_0x73081e(0x78)](),_0x422876=_0x94d2d7+'-'+_0x39589a+'-'+_0x54c370,_0x315f02;if(_0x56dc2a[_0x73081e(0xa5)]==_0x73081e(0xd7)){const _0x249b7f=await staff['findOne']({'email':_0x56dc2a[_0x73081e(0x8e)]});_0x315f02=await warehouse[_0x73081e(0xe3)]({'status':_0x73081e(0xab),'name':_0x249b7f[_0x73081e(0xaf)],'warehouse_category':_0x73081e(0xa8)});}else _0x315f02=await warehouse[_0x73081e(0xe3)]({'status':_0x73081e(0xab),'warehouse_category':_0x73081e(0xa8)});const _0x5f04b4=await warehouse[_0x73081e(0xfd)]([{'$match':{'name':_0x159744['from_warehouse'],'room':_0x159744['from_room']}},{'$unwind':_0x73081e(0xc0)},{'$group':{'_id':_0x73081e(0xfa),'name':{'$first':_0x73081e(0x100)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x73081e(0x76)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x73081e(0x122)},'primary_code':{'$first':_0x73081e(0xeb)},'secondary_code':{'$first':_0x73081e(0xd2)},'product_code':{'$first':_0x73081e(0xec)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x73081e(0xe5)}}}]);var _0x263ad5=[0x1,0x2,0x3,0x4],_0x2f756a=['A','B','C','D','E','F','G','H','I','J'],_0x83934a=['Ambient',_0x73081e(0x11e)];const _0x34c3a8=await product[_0x73081e(0xe3)]({}),_0x1c9111=BayBinSelected(_0x159744['to_warehouse'],_0x159744[_0x73081e(0x86)]);if(_0x32a2cc[0x0][_0x73081e(0x88)]==_0x73081e(0x12c)){var _0x4cbf4c=users['English'];console[_0x73081e(0xa1)](_0x4cbf4c);}else{if(_0x32a2cc[0x0][_0x73081e(0x88)]==_0x73081e(0x10c))var _0x4cbf4c=users[_0x73081e(0x10c)];else{if(_0x32a2cc[0x0][_0x73081e(0x88)]=='German')var _0x4cbf4c=users['German'];else{if(_0x32a2cc[0x0][_0x73081e(0x88)]=='Spanish')var _0x4cbf4c=users[_0x73081e(0x133)];else{if(_0x32a2cc[0x0][_0x73081e(0x88)]==_0x73081e(0xd0))var _0x4cbf4c=users['French'];else{if(_0x32a2cc[0x0]['language']==_0x73081e(0xbf))var _0x4cbf4c=users[_0x73081e(0x10d)];else{if(_0x32a2cc[0x0][_0x73081e(0x88)]==_0x73081e(0x134))var _0x4cbf4c=users[_0x73081e(0x134)];else{if(_0x32a2cc[0x0][_0x73081e(0x88)]==_0x73081e(0x117))var _0x4cbf4c=users[_0x73081e(0x129)];}}}}}}}_0x496bb6[_0x73081e(0x93)]('edit_transfer_finished',{'success':_0x2418b3[_0x73081e(0x7d)]('success'),'errors':_0x2418b3[_0x73081e(0x7d)]('errors'),'role':_0x56dc2a,'profile':_0x30a54c,'master_shop':_0x32a2cc,'warehouse':_0x315f02,'transfer':_0x159744,'stock':_0x5f04b4,'unit':_0x34c3a8,'language':_0x4cbf4c,'levels':_0x263ad5,'Isle':_0x2f756a,'rooms_data':_0x83934a,'ed_fullDate':_0x422876,'dataSelected':_0x1c9111});}catch(_0x50f96d){console[_0x73081e(0xa1)](_0x50f96d);}}),router[a0_0x3c95c9(0x91)](a0_0x3c95c9(0x6d),auth,async(_0x12dc02,_0x2755e2)=>{var _0x3b7a6b=a0_0x3c95c9;try{const _0x217be7=_0x12dc02[_0x3b7a6b(0x7f)]['id'];console['log'](_0x12dc02[_0x3b7a6b(0xac)]);const _0x12ad3e=await transfers_finished[_0x3b7a6b(0x103)](_0x217be7);console['log'](_0x3b7a6b(0x92),_0x12ad3e);const {date:_0x5946c0,from_warehouse:_0x694462,FromRoom_name:_0x36773b,to_warehouse:_0x4464c6,ToRoom_name:_0x13f3e2,prod_name:_0x1e88aa,from_prod_qty:_0xa67200,from_prod_level:_0xa55fd3,from_prod_isle:_0x1e9bea,from_prod_pallet:_0x280aa5,to_prod_qty:_0x3d7329,to_prod_level:_0x38b02b,to_prod_isle:_0x4acc24,to_prod_pallet:_0x2126f9,primary_code:_0x16610a,secondary_code:_0x308f3a,product_code3:_0x105759,note:_0x1effb6,invoice:_0x5832f8,expiry_date:_0x444375}=_0x12dc02['body'];if(typeof _0x1e88aa==_0x3b7a6b(0x127))var _0x594f50=[_0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0x77)]],_0x8ac081=[_0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xdc)]],_0x1025d8=[_0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xda)]],_0x58c5e3=[_0x12dc02[_0x3b7a6b(0xac)]['to_prod_qty']],_0x376365=[_0x12dc02['body'][_0x3b7a6b(0x7a)]],_0x3c2493=[_0x12dc02['body'][_0x3b7a6b(0x123)]],_0x19ab4f=[_0x12dc02['body']['secondary_code']],_0x25f523=[_0x12dc02['body']['product_code3']],_0x59a683=[_0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xe8)]],_0x23769a=[_0x12dc02[_0x3b7a6b(0xac)]['unit']],_0x31ca65=[_0x12dc02['body'][_0x3b7a6b(0x8c)]],_0x2357ad=[_0x12dc02['body'][_0x3b7a6b(0xd6)]],_0x39fc48=[_0x12dc02['body'][_0x3b7a6b(0x67)]];else var _0x594f50=[..._0x12dc02[_0x3b7a6b(0xac)]['prod_name']],_0x8ac081=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xdc)]],_0x1025d8=[..._0x12dc02[_0x3b7a6b(0xac)]['from_prod_level']],_0x58c5e3=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xd4)]],_0x376365=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0x7a)]],_0x3c2493=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0x123)]],_0x19ab4f=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xb3)]],_0x25f523=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0x113)]],_0x59a683=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xe8)]],_0x23769a=[..._0x12dc02['body'][_0x3b7a6b(0xb7)]],_0x31ca65=[..._0x12dc02['body']['secondary_unit']],_0x2357ad=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0xd6)]],_0x39fc48=[..._0x12dc02[_0x3b7a6b(0xac)][_0x3b7a6b(0x67)]];const _0x146d17=_0x594f50[_0x3b7a6b(0x12a)](_0x45bae6=>{return _0x45bae6={'product_name':_0x45bae6};});_0x8ac081['forEach']((_0x2cb9fd,_0x412bc4)=>{var _0x1602d7=_0x3b7a6b;_0x146d17[_0x412bc4][_0x1602d7(0xb8)]=_0x2cb9fd;}),_0x1025d8['forEach']((_0x5f2319,_0x1355df)=>{_0x146d17[_0x1355df]['from_bay']=_0x5f2319;}),_0x58c5e3['forEach']((_0xcfef8e,_0x4cb827)=>{var _0x438349=_0x3b7a6b;_0x146d17[_0x4cb827][_0x438349(0xa2)]=_0xcfef8e;}),_0x376365['forEach']((_0x4becb8,_0x19ff98)=>{var _0x19e89c=_0x3b7a6b;_0x146d17[_0x19ff98][_0x19e89c(0x9f)]=_0x4becb8;}),_0x3c2493[_0x3b7a6b(0x11c)]((_0x7f6263,_0x49b2ef)=>{var _0x154f11=_0x3b7a6b;_0x146d17[_0x49b2ef][_0x154f11(0x123)]=_0x7f6263;}),_0x19ab4f[_0x3b7a6b(0x11c)]((_0x320a8d,_0x5cb51b)=>{var _0x142452=_0x3b7a6b;_0x146d17[_0x5cb51b][_0x142452(0xb3)]=_0x320a8d;}),_0x25f523[_0x3b7a6b(0x11c)]((_0x2213bf,_0x36fde6)=>{var _0x57807d=_0x3b7a6b;_0x146d17[_0x36fde6][_0x57807d(0x65)]=_0x2213bf;}),_0x59a683[_0x3b7a6b(0x11c)]((_0x2658cb,_0x54ee45)=>{_0x146d17[_0x54ee45]['maxProducts']=_0x2658cb;}),_0x23769a['forEach']((_0x1fd011,_0x2b63d0)=>{var _0x2c6994=_0x3b7a6b;_0x146d17[_0x2b63d0][_0x2c6994(0xb7)]=_0x1fd011;}),_0x31ca65['forEach']((_0x13fe05,_0x21d6fe)=>{var _0x3225b3=_0x3b7a6b;_0x146d17[_0x21d6fe][_0x3225b3(0x8c)]=_0x13fe05;}),_0x2357ad[_0x3b7a6b(0x11c)]((_0xd83d7c,_0x142841)=>{var _0x589e5f=_0x3b7a6b;_0x146d17[_0x142841][_0x589e5f(0xd6)]=_0xd83d7c;}),_0x39fc48['forEach']((_0x5e1e70,_0x1105fb)=>{var _0x3adc89=_0x3b7a6b;_0x146d17[_0x1105fb][_0x3adc89(0x67)]=_0x5e1e70;});const _0x42e1ec=_0x146d17[_0x3b7a6b(0xa6)](_0x567926=>_0x567926[_0x3b7a6b(0xa2)]!=='0'&&_0x567926['to_quantity']!==''||_0x567926[_0x3b7a6b(0x98)]!=='0'&&_0x567926['to_floorlevel']!=='');var _0xfa13f8=0x0;_0x42e1ec[_0x3b7a6b(0x11c)](_0x171060=>{var _0x472635=_0x3b7a6b;parseInt(_0x171060[_0x472635(0xb8)])<parseInt(_0x171060[_0x472635(0xa2)])&&_0xfa13f8++;});if(_0xfa13f8!=0x0)return _0x12dc02[_0x3b7a6b(0x7d)]('errors',_0x3b7a6b(0x6f)),_0x2755e2['redirect'](_0x3b7a6b(0xc2));const _0x4ce3df=await warehouse[_0x3b7a6b(0x95)]({'name':_0x12ad3e[_0x3b7a6b(0xf1)],'room':_0x12ad3e['from_room']});_0x12ad3e[_0x3b7a6b(0xf8)][_0x3b7a6b(0x11c)](_0xeb19d3=>{var _0x2ad144=_0x3b7a6b;if(_0xeb19d3['to_quantity']>0x0){const _0x3b298f=_0x4ce3df[_0x2ad144(0xd8)][_0x2ad144(0x12a)](_0x17b5ea=>{var _0x527ffd=_0x2ad144;_0x17b5ea['product_name']==_0xeb19d3['product_name']&&_0x17b5ea['bay']==_0xeb19d3[_0x527ffd(0xc3)]&&(_0x17b5ea[_0x527ffd(0xea)]=parseInt(_0x17b5ea[_0x527ffd(0xea)])+parseInt(_0xeb19d3['to_quantity']));});}}),await _0x4ce3df[_0x3b7a6b(0x8f)]();const _0x1f1f4=await warehouse[_0x3b7a6b(0x95)]({'name':_0x12ad3e[_0x3b7a6b(0xb1)],'room':_0x12ad3e['to_room']});_0x12ad3e[_0x3b7a6b(0xf8)][_0x3b7a6b(0x11c)](_0x34d125=>{var _0xfa28a7=_0x3b7a6b;if(_0x34d125[_0xfa28a7(0xa2)]>0x0){const _0x193d3a=_0x1f1f4[_0xfa28a7(0xd8)]['map'](_0x47891a=>{var _0x3c4ac6=_0xfa28a7;_0x47891a[_0x3c4ac6(0x96)]==_0x34d125['product_name']&&_0x47891a['bay']==_0x34d125[_0x3c4ac6(0x9f)]&&(_0x47891a[_0x3c4ac6(0xea)]=parseInt(_0x47891a[_0x3c4ac6(0xea)])-parseInt(_0x34d125['to_quantity']));});}}),await _0x1f1f4['save'](),_0x12ad3e[_0x3b7a6b(0xae)]=_0x5946c0,_0x12ad3e[_0x3b7a6b(0xf1)]=_0x694462,_0x12ad3e[_0x3b7a6b(0xb1)]=_0x4464c6,_0x12ad3e['product']=_0x42e1ec,_0x12ad3e[_0x3b7a6b(0xb5)]=_0x1effb6,_0x12ad3e[_0x3b7a6b(0xd3)]=_0x5832f8;const _0x4a6547=await _0x12ad3e[_0x3b7a6b(0x8f)](),_0x576013=await warehouse[_0x3b7a6b(0x95)]({'name':_0x694462,'room':_0x36773b});_0x4a6547['product'][_0x3b7a6b(0x11c)](_0x912591=>{var _0x22fe0b=_0x3b7a6b;if(_0x912591[_0x22fe0b(0xa2)]>0x0){const _0x296184=_0x576013[_0x22fe0b(0xd8)]['map'](_0x358401=>{var _0x547ca2=_0x22fe0b;_0x358401[_0x547ca2(0x96)]==_0x912591['product_name']&&_0x358401['bay']==_0x912591[_0x547ca2(0xc3)]&&(_0x358401['product_stock']=parseInt(_0x358401['product_stock'])-parseInt(_0x912591[_0x547ca2(0xa2)]));});}}),await _0x576013[_0x3b7a6b(0x8f)]();const _0x3f0799=await warehouse[_0x3b7a6b(0x95)]({'name':_0x4464c6,'room':_0x13f3e2});_0x4a6547[_0x3b7a6b(0xf8)][_0x3b7a6b(0x11c)](_0x488dd7=>{var _0x3c5227=_0x3b7a6b;if(_0x488dd7['to_quantity']>0x0){var _0x16ac5b=0x0;const _0x32719a=_0x3f0799['product_details'][_0x3c5227(0x12a)](_0x1e2b17=>{var _0x61d764=_0x3c5227;_0x1e2b17[_0x61d764(0x96)]==_0x488dd7[_0x61d764(0x96)]&&_0x1e2b17[_0x61d764(0x131)]==_0x488dd7[_0x61d764(0x9f)]&&(_0x1e2b17[_0x61d764(0xea)]=parseInt(_0x1e2b17[_0x61d764(0xea)])+parseInt(_0x488dd7[_0x61d764(0xa2)]),_0x16ac5b++);});_0x16ac5b=='0'&&(_0x3f0799[_0x3c5227(0xd8)]=_0x3f0799[_0x3c5227(0xd8)][_0x3c5227(0x8b)]({'product_name':_0x488dd7[_0x3c5227(0x96)],'product_stock':_0x488dd7[_0x3c5227(0xa2)],'bay':_0x488dd7[_0x3c5227(0x9f)],'product_code':_0x488dd7[_0x3c5227(0x65)],'primary_code':_0x488dd7['primary_code'],'secondary_code':_0x488dd7['secondary_code'],'maxProducts':_0x488dd7[_0x3c5227(0xcc)]}));}}),await _0x3f0799[_0x3b7a6b(0x8f)](),_0x12dc02['flash'](_0x3b7a6b(0x87),'Transfer\x20Edit\x20Successfully'),_0x2755e2['redirect']('/transfer_finished/view');}catch(_0x4d28d7){console[_0x3b7a6b(0xa1)](_0x4d28d7);}}),router['post'](a0_0x3c95c9(0xba),async(_0x3ec69d,_0x46cfad)=>{var _0x49e07c=a0_0x3c95c9;const {FromWareHouse:_0x4c9126,FromRoom:_0x57e389,ToWarehouse:_0x460cca,ToRoom:_0x5c20f3,primary_code:_0x29bb2a,Roomslist:_0x5cabaf}=_0x3ec69d[_0x49e07c(0xac)],_0x1be790=_0x5cabaf['split'](','),_0x531323=[];async function _0x504e57(_0x39090d){var _0xc2d29=_0x49e07c;const _0x40fada=await warehouse[_0xc2d29(0xfd)]([{'$match':{'name':_0x4c9126,'room':_0x39090d}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x29bb2a}},{'$group':{'_id':_0xc2d29(0xfa),'name':{'$first':_0xc2d29(0x100)},'instock':{'$first':_0xc2d29(0x12b)},'primary_code':{'$first':_0xc2d29(0xeb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xc2d29(0xec)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0xc2d29(0x12d)},'type':{'$first':_0xc2d29(0x118)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xc2d29(0x73)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0xc2d29(0xb0)},'rack':{'$first':_0xc2d29(0xe5)},'expiry_date':{'$first':_0xc2d29(0x114)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0xc2d29(0xed)},'maxPerUnit':{'$first':_0xc2d29(0xad)},'roomNamed':{'$first':_0xc2d29(0xc8)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0xc2d29(0x11d)}}}]),_0x2cfcd6=await warehouse[_0xc2d29(0xfd)]([{'$match':{'name':_0x4c9126,'room':_0x39090d}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x29bb2a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xc2d29(0x100)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0xc2d29(0xeb)},'secondary_code':{'$first':_0xc2d29(0xd2)},'product_code':{'$first':_0xc2d29(0xec)},'level':{'$first':_0xc2d29(0x76)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0xc2d29(0x118)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xc2d29(0x73)},'secondary_unit':{'$first':_0xc2d29(0xb6)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xc2d29(0xe5)},'expiry_date':{'$first':_0xc2d29(0x114)},'production_date':{'$first':_0xc2d29(0xf6)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0xc2d29(0xad)},'roomNamed':{'$first':_0xc2d29(0xc8)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0xc2d29(0x11d)}}}]);if(_0x40fada[_0xc2d29(0x13b)]>0x0)_0x531323[_0xc2d29(0x125)](_0x40fada);else _0x2cfcd6[_0xc2d29(0x13b)]>0x0&&_0x531323['push'](_0x2cfcd6);}const _0x1b393c=_0x1be790['map'](_0x197bb8=>_0x504e57(_0x197bb8));await Promise['all'](_0x1b393c),_0x46cfad[_0x49e07c(0x11a)](_0x531323);}),router[a0_0x3c95c9(0x91)](a0_0x3c95c9(0xf3),async(_0x55f537,_0x1bee2b)=>{var _0x2e28b8=a0_0x3c95c9;try{const {FromWareHouse:_0x5ec101,FromRoom:_0x91d18b,ToWarehouse:_0x1f57c4,ToRoom:_0x46b907,secondary_code:_0x277e62}=_0x55f537[_0x2e28b8(0xac)],_0x2a99b5=await warehouse['aggregate']([{'$match':{'name':_0x5ec101}},{'$unwind':_0x2e28b8(0xc0)},{'$match':{'product_details.secondary_code':_0x277e62}},{'$group':{'_id':_0x2e28b8(0xfa),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x2e28b8(0xeb)},'secondary_code':{'$first':_0x2e28b8(0xd2)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0x2e28b8(0xe4)},'level':{'$first':_0x2e28b8(0x10f)},'isle':{'$first':_0x2e28b8(0xef)},'pallet':{'$first':_0x2e28b8(0x137)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x2e28b8(0x73)},'expiry_date':{'$first':_0x2e28b8(0x114)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x1bee2b[_0x2e28b8(0x9b)](0xc8)[_0x2e28b8(0x11a)](_0x2a99b5);}catch(_0x29b91b){_0x1bee2b['status'](0x194)[_0x2e28b8(0x11a)]({'message':_0x29b91b[_0x2e28b8(0x6e)]});}}),router[a0_0x3c95c9(0x91)](a0_0x3c95c9(0xa3),async(_0x5a953e,_0x25537a)=>{var _0x1727e6=a0_0x3c95c9;try{const {FromWareHouse:_0xad9630,FromRoom:_0x31d040,ToWarehouse:_0x3bd288,ToRoom:_0x12db57,product_code:_0x495110}=_0x5a953e[_0x1727e6(0xac)],_0x11cd43=await warehouse['aggregate']([{'$match':{'name':_0xad9630}},{'$unwind':_0x1727e6(0xc0)},{'$match':{'product_details.product_code':_0x495110}},{'$group':{'_id':_0x1727e6(0xfa),'name':{'$first':_0x1727e6(0x100)},'primary_code':{'$first':_0x1727e6(0xeb)},'secondary_code':{'$first':_0x1727e6(0xd2)},'product_code':{'$first':_0x1727e6(0xec)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':_0x1727e6(0x10f)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x1727e6(0x137)},'maxProducts':{'$first':_0x1727e6(0xf0)},'unit':{'$first':_0x1727e6(0x73)}}}]);_0x25537a[_0x1727e6(0x9b)](0xc8)[_0x1727e6(0x11a)](_0x11cd43);}catch(_0x4da33a){_0x25537a[_0x1727e6(0x9b)](0x194)[_0x1727e6(0x11a)]({'message':_0x4da33a['message']});}}),router['post'](a0_0x3c95c9(0x97),async(_0x271973,_0x35465d)=>{var _0x4f1f56=a0_0x3c95c9;const {productCode:_0x2d9747,bay:_0x3f205e,warehouses:_0x5a143d,room:_0x596ece}=_0x271973[_0x4f1f56(0xac)];console[_0x4f1f56(0xa1)](_0x271973[_0x4f1f56(0xac)]);try{const _0x5d008e=await warehouse[_0x4f1f56(0xfd)]([{'$match':{'name':_0x5a143d,'room':_0x596ece}},{'$unwind':_0x4f1f56(0xc0)},{'$match':{'product_details.bay':parseInt(_0x3f205e)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4f1f56(0x100)},'product_stock':{'$first':_0x4f1f56(0x12b)},'bay':{'$first':_0x4f1f56(0x76)},'maxProducts':{'$first':_0x4f1f56(0xf0)}}}]);_0x35465d[_0x4f1f56(0x9b)](0xc8)[_0x4f1f56(0x11a)](_0x5d008e);}catch(_0x3cb4f5){_0x35465d['status'](0x194)['json']({'message':_0x3cb4f5[_0x4f1f56(0x6e)]});}}),module[a0_0x3c95c9(0xc4)]=router;function a0_0x529f(){var _0x3d2bac=['from_room_name','FGSEmail','\x20</h2>','port','find','$name','$product_details.rack','/upload/','</h5>','MaxStocks_data2','112knmZGz','product_stock','$product_details.primary_code','$product_details.product_code','$product_details.batch_code','password','$product_details.isle','$product_details.maxProducts','from_warehouse','$invoice','/barcode_scanner2','add_transfer_finished','prod_cat','$product_details.production_date','logo','product','to_invoice','$product_details._id','English','\x20Order\x20Date\x20:\x20','aggregate','True','<h2>\x20','$product_details.product_name','DRY\x20GOODS','</td>','findById','../public/language/languages.json','$to_warehouse','Router','sendMail','/picking_list/PDF_transfer/','$finalize','2208TBcqWI','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Hindi','Portuguese','_id','$product_details.level','../middleware/auth','transfer_finished','</head><body>','product_code3','$product_details.expiry_date','error','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Arabic\x20(ae)','$product_details.type','production_date','json','express','forEach','$product_details.invoice','Enclosed','/view/add_transfer','getMonth','Rack\x202','$product_details.floorlevel','primary_code','from_invoice','push','to_room_name','string','ToRoomAssigned','Arabic','map','$product_details.product_stock','English\x20(US)','$product_details.bin','<tbody\x20style=\x22text-align:\x20center;\x22>','updateOne','<tr>','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Spanish','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','catch','$product_details.pallet','New_Qty_Converted','/transfer_finished/preview/','<strong>\x20Regards\x20</strong>','length','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<hr\x20class=\x22my-3\x22>','createTransport','product_code','all','expiry_date','finalize','</tr>','$date','$product','then','/view/:id','message','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','padStart','13165JLnQRP','To_invoice','$product_details.unit','Product\x20Transfer\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.bay','prod_name','getFullYear','Logo.png','to_prod_level','24ervwDn','user','flash','An\x20error\x20occurred.','params','Rack\x201','slice','/view','/transfer/view','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','RoomAssigned','to_room','success','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_date','concat','secondary_unit','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','email','save','site_title','post','transfer_data','render','German','findOne','product_name','/CheckingWarehouse','to_floorlevel','28967900TVLCra','Error\x20Occurs','status','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','errors','get','to_bay','<span\x20style=\x22float:\x20right;\x22>','log','to_quantity','/barcode_scanner3','MaxStocks_data','role','filter','edit_transfer_finished_view','Finished\x20Goods','</tbody>','<h5\x20style=\x22text-align:\x20left;\x22>','Enabled','body','$product_details.maxPerUnit','date','warehouse','$product_details.storage','to_warehouse','image','secondary_code','TRFF-','note','$product_details.secondary_unit','unit','from_quantity','693572TcSVYT','/barcode_scanner','/preview/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','\x20Order\x20Number\x20:\x20','</body></html>','Portuguese\x20(BR)','$product_details','maxPerUnit','back','from_bay','exports','</div>','Transfer\x20Finalize\x20Successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$room','/../public','toString','getDate','maxProducts','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','7859061VqBjgd','French','redirect','$product_details.secondary_code','invoice','to_prod_qty','43314BCwWip','batch_code','staff','product_details','</span>','from_prod_level','6136104lFFcki','from_prod_qty','4524723OtXfbC','Transfer\x20Mail'];a0_0x529f=function(){return _0x3d2bac;};return a0_0x529f();}