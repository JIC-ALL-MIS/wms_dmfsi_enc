var a0_0x38156e=a0_0x4106;function a0_0x2480(){var _0x46a429=['$product_details.bay','French','<tbody\x20style=\x22text-align:\x20center;\x22>','floor','Rack\x201','<div>','to_room_name','</h5>','</tr>','catch','forEach','transfer_finished','sendMail','product','../public/language/languages.json','RoomAssigned','slice','/barcode_scanner3','all','product_details','prod_name','1156755cIbYsk','$invoice','\x20Order\x20Number\x20:\x20','batch_code','<h5\x20style=\x22text-align:\x20left;\x22>','flash','logo','from_quantity','$room','Rack\x202','$product_details.primary_code','German','$product_details.floorlevel','QA\x20Warehouse','MaxStocks_data2','$product_details.unit','product_date','/upload/','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','primary_unit','Arabic','<span\x20style=\x22float:\x20right;\x22>','$product_details.production_date','Transfer\x20Finalize\x20Successfully','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','length','New_Qty_Converted','48390NmJxpA','aggregate','$product','</body></html>','$product_details.storage','to_room','$product_details.maxProducts','Logo.png','padStart','True','getDate','save','from_prod_qty','warehouse','Router','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','finalize','secondary_unit','password','log','then','../models/all_models','to_prod_qty','Portuguese','from_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','../middleware/auth','unit','product_stock','$product_details.isle','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','Portuguese\x20(BR)','transfer_data','date','email','maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','json','$product_details.batch_code','Finished\x20Goods','$product_details.expiry_date','to_prod_level','exports','getFullYear','</head><body>','\x20</h2>','updateOne','Error\x20Occurs','</div>','edit_transfer_finished_view','user','image','prod_cat','$product_details.level','getMonth','<!DOCTYPE\x20html>','nodemailer','ToRoomAssigned','To_invoice','error','to_invoice','role','get','/view/add_transfer','success','</td>','/../public','$product_details.invoice','port','to_warehouse','from_bay','\x20Order\x20Date\x20:\x20','$product_details.product_stock','English','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','redirect','34nCkuRY','</thead>','params','render','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.rack','from_room_name','product_name','/preview/:id','split','<h2>\x20','/view/:id','bay','createTransport','Product\x20Transfer\x20successfully','production_date','$product_details.product_code','23090870YsEion','filter','English\x20(US)','$name','host','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','4328505fBQgpQ','$product_details.maxPerUnit','/barcode_scanner2','Arabic\x20(ae)','from_room','staff','post','findById','toString','product_code3','/picking_list/PDF_transfer/','edit_transfer_finished','3123240HZovMP','expiry_date','$product_details.product_name','665JKXmXa','Spanish','language','20675YYJzTx','status','44377XqUOep','to_quantity','<hr\x20class=\x22my-3\x22>','from_prod_level','$product_details.type','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','invoice','add_transfer_finished','/barcode_scanner','$product_details.secondary_unit','FROZEN\x20GOODS','1164ymcSRl','to_floorlevel','findOne','DRY\x20GOODS','Transfer\x20Edit\x20Successfully','back','maxProducts','$date','body','concat','<html><head><title></title>','map','from_warehouse','$product_details.secondary_code','MaxStocks_data','$product.to_room_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','express','to_bay','errors','$product_details._id','TRFF-','An\x20error\x20occurred\x20while\x20saving\x20data.','Chinese','Enabled','/transfer/view','primary_code','push','string','$finalize','An\x20error\x20occurred.','Hindi','Transfer\x20Mail','$from_warehouse','$product_details','find'];a0_0x2480=function(){return _0x46a429;};return a0_0x2480();}(function(_0x37bdaf,_0x34397f){var _0x26926e=a0_0x4106,_0x48971f=_0x37bdaf();while(!![]){try{var _0x1cb99b=-parseInt(_0x26926e(0x244))/0x1*(parseInt(_0x26926e(0x218))/0x2)+-parseInt(_0x26926e(0x28c))/0x3+parseInt(_0x26926e(0x253))/0x4*(-parseInt(_0x26926e(0x242))/0x5)+parseInt(_0x26926e(0x2a8))/0x6*(parseInt(_0x26926e(0x23f))/0x7)+parseInt(_0x26926e(0x23c))/0x8+-parseInt(_0x26926e(0x230))/0x9+parseInt(_0x26926e(0x229))/0xa;if(_0x1cb99b===_0x34397f)break;else _0x48971f['push'](_0x48971f['shift']());}catch(_0x297021){_0x48971f['push'](_0x48971f['shift']());}}}(a0_0x2480,0x9c9a3));const express=require(a0_0x38156e(0x264)),app=express(),router=express[a0_0x38156e(0x1d9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x38156e(0x1e0)),auth=require(a0_0x38156e(0x1e5)),users=require(a0_0x38156e(0x285)),nodemailer=require(a0_0x38156e(0x203));router['get']('/view',auth,async(_0x5af31b,_0x334254)=>{var _0x3c4e83=a0_0x38156e;try{const {username:_0x35f194,email:_0x2490c4,role:_0x44cedc}=_0x5af31b['user'],_0x4bf259=_0x5af31b['user'],_0x36cc9c=await profile[_0x3c4e83(0x255)]({'email':_0x4bf259[_0x3c4e83(0x1ed)]}),_0x33eaf8=await master_shop['find']();let _0x5b218a;if(_0x4bf259[_0x3c4e83(0x208)]==_0x3c4e83(0x235)){const _0x1aab81=await staff['findOne']({'email':_0x4bf259[_0x3c4e83(0x1ed)]});_0x5b218a=await transfers_finished[_0x3c4e83(0x276)]({'from_warehouse':_0x1aab81[_0x3c4e83(0x1d8)]});}else _0x5b218a=await transfers_finished[_0x3c4e83(0x2a9)]([{'$unwind':_0x3c4e83(0x2aa)},{'$group':{'_id':'$_id','invoice':{'$first':_0x3c4e83(0x28d)},'date':{'$first':_0x3c4e83(0x25a)},'from_warehouse':{'$first':_0x3c4e83(0x274)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x3c4e83(0x262)},'finalize':{'$first':_0x3c4e83(0x270)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x33eaf8[0x0][_0x3c4e83(0x241)]==_0x3c4e83(0x22b))var _0x22ac2d=users[_0x3c4e83(0x214)];else{if(_0x33eaf8[0x0][_0x3c4e83(0x241)]==_0x3c4e83(0x272))var _0x22ac2d=users[_0x3c4e83(0x272)];else{if(_0x33eaf8[0x0][_0x3c4e83(0x241)]=='German')var _0x22ac2d=users[_0x3c4e83(0x297)];else{if(_0x33eaf8[0x0][_0x3c4e83(0x241)]=='Spanish')var _0x22ac2d=users[_0x3c4e83(0x240)];else{if(_0x33eaf8[0x0][_0x3c4e83(0x241)]==_0x3c4e83(0x278))var _0x22ac2d=users[_0x3c4e83(0x278)];else{if(_0x33eaf8[0x0][_0x3c4e83(0x241)]==_0x3c4e83(0x1ea))var _0x22ac2d=users['Portuguese'];else{if(_0x33eaf8[0x0][_0x3c4e83(0x241)]==_0x3c4e83(0x26a))var _0x22ac2d=users[_0x3c4e83(0x26a)];else{if(_0x33eaf8[0x0]['language']==_0x3c4e83(0x233))var _0x22ac2d=users[_0x3c4e83(0x2a1)];}}}}}}}_0x334254[_0x3c4e83(0x21b)](_0x3c4e83(0x282),{'success':_0x5af31b['flash'](_0x3c4e83(0x20b)),'errors':_0x5af31b[_0x3c4e83(0x291)](_0x3c4e83(0x266)),'role':_0x4bf259,'profile':_0x36cc9c,'master_shop':_0x33eaf8,'transfer':_0x5b218a,'language':_0x22ac2d});}catch(_0x15bc16){console[_0x3c4e83(0x1de)](_0x15bc16);}});async function getRandom8DigitNumber(){var _0x482509=a0_0x38156e;const _0x884674=0x989680,_0x2c6f74=0x5f5e0ff,_0x1adcf8=Math[_0x482509(0x27a)](Math['random']()*(_0x2c6f74-_0x884674+0x1))+_0x884674;var _0x4211d9;const _0xa96d00=await transfers_finished[_0x482509(0x255)]({'invoice':_0x482509(0x268)+_0x1adcf8});return _0xa96d00&&_0xa96d00[_0x482509(0x2a6)]>0x0?_0x4211d9=_0x482509(0x268)+_0x1adcf8:_0x4211d9=_0x482509(0x268)+_0x1adcf8,_0x4211d9;}router[a0_0x38156e(0x209)](a0_0x38156e(0x20a),auth,async(_0x347859,_0x3fc047)=>{var _0x351331=a0_0x38156e;try{const {username:_0x1350f4,email:_0x3d781e,role:_0x506120}=_0x347859['user'],_0x1cf78f=_0x347859[_0x351331(0x1fd)],_0x518d45=await profile[_0x351331(0x255)]({'email':_0x1cf78f['email']}),_0x5a12cb=await master_shop[_0x351331(0x276)]();let _0x4abf71;if(_0x1cf78f[_0x351331(0x208)]=='staff'){const _0x10f59e=await staff[_0x351331(0x255)]({'email':_0x1cf78f[_0x351331(0x1ed)]});_0x4abf71=await warehouse[_0x351331(0x2a9)]([{'$match':{'status':_0x351331(0x26b),'name':_0x10f59e[_0x351331(0x1d8)],'warehouse_category':_0x351331(0x1f2),'name':{'$ne':_0x351331(0x299)}}},{'$group':{'_id':_0x351331(0x22c),'name':{'$first':_0x351331(0x22c)}}}]);}else _0x4abf71=await warehouse[_0x351331(0x2a9)]([{'$match':{'status':_0x351331(0x26b),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x351331(0x299)}}},{'$group':{'_id':'$name','name':{'$first':_0x351331(0x22c)}}}]);const _0x37d877=await transfers_finished[_0x351331(0x276)]({}),_0x5de02d=_0x37d877[_0x351331(0x2a6)]+0x1,_0xce19c=_0x351331(0x268)+_0x5de02d[_0x351331(0x238)]()[_0x351331(0x2b0)](0x5,'0');if(_0x5a12cb[0x0]['language']==_0x351331(0x22b))var _0xdadd2b=users['English'];else{if(_0x5a12cb[0x0]['language']==_0x351331(0x272))var _0xdadd2b=users[_0x351331(0x272)];else{if(_0x5a12cb[0x0]['language']==_0x351331(0x297))var _0xdadd2b=users['German'];else{if(_0x5a12cb[0x0]['language']==_0x351331(0x240))var _0xdadd2b=users[_0x351331(0x240)];else{if(_0x5a12cb[0x0][_0x351331(0x241)]==_0x351331(0x278))var _0xdadd2b=users[_0x351331(0x278)];else{if(_0x5a12cb[0x0][_0x351331(0x241)]==_0x351331(0x1ea))var _0xdadd2b=users[_0x351331(0x1e2)];else{if(_0x5a12cb[0x0][_0x351331(0x241)]==_0x351331(0x26a))var _0xdadd2b=users[_0x351331(0x26a)];else{if(_0x5a12cb[0x0][_0x351331(0x241)]==_0x351331(0x233))var _0xdadd2b=users[_0x351331(0x2a1)];}}}}}}}const _0x3055f2=getRandom8DigitNumber();_0x3055f2['then'](_0x4a8be1=>{var _0x3f7e31=_0x351331;_0x3fc047[_0x3f7e31(0x21b)](_0x3f7e31(0x24f),{'success':_0x347859[_0x3f7e31(0x291)](_0x3f7e31(0x20b)),'errors':_0x347859[_0x3f7e31(0x291)](_0x3f7e31(0x266)),'role':_0x1cf78f,'profile':_0x518d45,'master_shop':_0x5a12cb,'warehouse':_0x4abf71,'language':_0xdadd2b,'invoice':_0x4a8be1});})[_0x351331(0x280)](_0x463642=>{var _0x1eb1c2=_0x351331;_0x347859['flash']('errors',_0x1eb1c2(0x263)),_0x3fc047[_0x1eb1c2(0x217)](_0x1eb1c2(0x26c));});}catch(_0x2001dc){console[_0x351331(0x1de)](_0x2001dc);}}),router[a0_0x38156e(0x236)](a0_0x38156e(0x20a),auth,async(_0x4e6421,_0x155039)=>{var _0x4d3533=a0_0x38156e;try{const {date:_0x58b4d1,from_warehouse:_0x2d7e78,FromRoom_name:_0x42ea67,to_warehouse:_0x183e34,ToRoom_name:_0x4a38cd,prod_name:_0x5e5a73,from_prod_qty:_0x36840d,from_prod_level:_0x32a39b,from_prod_isle:_0x269f45,from_prod_pallet:_0x5cdb58,to_prod_qty:_0x51573f,to_prod_level:_0x103fbe,to_prod_isle:_0x20b257,to_prod_pallet:_0x4e6a7d,primary_code:_0x17dda9,secondary_code:_0x3ebc91,product_code3:_0x3f06fc,note:_0xb71830,MaxStocks_data2:_0x5bc970,invoice:_0x4bdd59,expiry_date:_0x46cbd2}=_0x4e6421[_0x4d3533(0x25b)];if(typeof _0x5e5a73=='string')var _0x1839c2=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x28b)]],_0x2cbd59=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1d7)]],_0x378702=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x247)]],_0x34f485=[_0x4e6421[_0x4d3533(0x25b)]['New_Qty_Converted']],_0x2f65cf=[_0x4e6421[_0x4d3533(0x25b)]['to_prod_level']],_0x45b14e=[_0x4e6421[_0x4d3533(0x25b)]['primary_code']],_0x51c24b=[_0x4e6421[_0x4d3533(0x25b)]['secondary_code']],_0x59db75=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x239)]],_0x30a485=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x29a)]],_0x3476d4=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x2a0)]],_0x57c40c=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1dc)]],_0x4069b6=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x28f)]],_0x1e439a=[_0x4e6421['body']['expiry_date']],_0x199af1=[_0x4e6421['body'][_0x4d3533(0x29c)]],_0x22f3fb=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x261)]],_0x22ba1b=[_0x4e6421['body'][_0x4d3533(0x1ee)]],_0x426e76=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1ff)]],_0x58902a=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x286)]],_0x4b4223=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x204)]],_0x54745a=[_0x4e6421[_0x4d3533(0x25b)]['from_invoice']],_0x1be081=[_0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x207)]];else var _0x1839c2=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x28b)]],_0x2cbd59=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1d7)]],_0x378702=[..._0x4e6421[_0x4d3533(0x25b)]['from_prod_level']],_0x34f485=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x2a7)]],_0x2f65cf=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1f4)]],_0x45b14e=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x26d)]],_0x51c24b=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x249)]],_0x59db75=[..._0x4e6421['body'][_0x4d3533(0x239)]],_0x30a485=[..._0x4e6421['body'][_0x4d3533(0x29a)]],_0x3476d4=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x2a0)]],_0x57c40c=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1dc)]],_0x4069b6=[..._0x4e6421['body'][_0x4d3533(0x28f)]],_0x1e439a=[..._0x4e6421['body'][_0x4d3533(0x23d)]],_0x199af1=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x29c)]],_0x22f3fb=[..._0x4e6421['body'][_0x4d3533(0x261)]],_0x22ba1b=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x1ee)]],_0x426e76=[..._0x4e6421[_0x4d3533(0x25b)]['prod_cat']],_0x58902a=[..._0x4e6421[_0x4d3533(0x25b)]['RoomAssigned']],_0x4b4223=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x204)]],_0x54745a=[..._0x4e6421['body'][_0x4d3533(0x1e3)]],_0x1be081=[..._0x4e6421[_0x4d3533(0x25b)][_0x4d3533(0x207)]];const _0x13afa7=_0x1839c2[_0x4d3533(0x25e)](_0x387f77=>{return _0x387f77={'product_name':_0x387f77};});_0x2cbd59['forEach']((_0x282744,_0x346684)=>{var _0x3e00e6=_0x4d3533;_0x13afa7[_0x346684][_0x3e00e6(0x293)]=_0x282744;}),_0x378702[_0x4d3533(0x281)]((_0x10faa9,_0x3d1647)=>{_0x13afa7[_0x3d1647]['from_bay']=_0x10faa9;}),_0x54745a[_0x4d3533(0x281)]((_0x1ff6b7,_0x52995b)=>{var _0x263d66=_0x4d3533;_0x13afa7[_0x52995b][_0x263d66(0x1e3)]=_0x1ff6b7;}),_0x1be081['forEach']((_0x58af59,_0x368959)=>{_0x13afa7[_0x368959]['To_invoice']=_0x58af59;}),_0x34f485[_0x4d3533(0x281)]((_0x452e0d,_0x4117b5)=>{_0x13afa7[_0x4117b5]['to_quantity']=_0x452e0d;}),_0x2f65cf['forEach']((_0x4842ee,_0x20cb84)=>{var _0x3fc1cd=_0x4d3533;_0x13afa7[_0x20cb84][_0x3fc1cd(0x265)]=_0x4842ee;}),_0x45b14e[_0x4d3533(0x281)]((_0x1322ec,_0x426a0b)=>{_0x13afa7[_0x426a0b]['primary_code']=_0x1322ec;}),_0x51c24b[_0x4d3533(0x281)]((_0x3bd979,_0xcf718e)=>{var _0x14c51c=_0x4d3533;_0x13afa7[_0xcf718e][_0x14c51c(0x249)]=_0x3bd979;}),_0x59db75['forEach']((_0x71af63,_0x37e3c9)=>{var _0x528f8f=_0x4d3533;_0x13afa7[_0x37e3c9][_0x528f8f(0x215)]=_0x71af63;}),_0x30a485[_0x4d3533(0x281)]((_0x54fcde,_0x2320c7)=>{_0x13afa7[_0x2320c7]['maxProducts']=_0x54fcde;}),_0x3476d4['forEach']((_0x378b97,_0x355ef5)=>{var _0x9ba0cc=_0x4d3533;_0x13afa7[_0x355ef5][_0x9ba0cc(0x1e6)]=_0x378b97;}),_0x57c40c['forEach']((_0x170460,_0x57309d)=>{var _0x19d9eb=_0x4d3533;_0x13afa7[_0x57309d][_0x19d9eb(0x1dc)]=_0x170460;}),_0x4069b6[_0x4d3533(0x281)]((_0x22465d,_0x38a3a6)=>{var _0x5c87fb=_0x4d3533;_0x13afa7[_0x38a3a6][_0x5c87fb(0x28f)]=_0x22465d;}),_0x1e439a[_0x4d3533(0x281)]((_0x475ca8,_0x1bc66c)=>{var _0x4c1121=_0x4d3533;_0x13afa7[_0x1bc66c][_0x4c1121(0x23d)]=_0x475ca8;}),_0x199af1['forEach']((_0x14b727,_0x1ff5de)=>{var _0x2ea601=_0x4d3533;_0x13afa7[_0x1ff5de][_0x2ea601(0x227)]=_0x14b727;}),_0x22f3fb[_0x4d3533(0x281)]((_0x1b647a,_0x217575)=>{var _0x354640=_0x4d3533;_0x13afa7[_0x217575][_0x354640(0x259)]=_0x1b647a;}),_0x22ba1b[_0x4d3533(0x281)]((_0x13947d,_0x2a3fdb)=>{var _0x306633=_0x4d3533;_0x13afa7[_0x2a3fdb][_0x306633(0x1ee)]=_0x13947d;}),_0x426e76[_0x4d3533(0x281)]((_0x483748,_0x3993be)=>{var _0x1d56f6=_0x4d3533;_0x13afa7[_0x3993be][_0x1d56f6(0x1ff)]=_0x483748;}),_0x58902a[_0x4d3533(0x281)]((_0xe369,_0xd8a5df)=>{var _0x5ef64b=_0x4d3533;_0x13afa7[_0xd8a5df][_0x5ef64b(0x21e)]=_0xe369;}),_0x4b4223[_0x4d3533(0x281)]((_0xb011e9,_0x5cc658)=>{var _0x5b37c0=_0x4d3533;_0x13afa7[_0x5cc658][_0x5b37c0(0x27d)]=_0xb011e9;});const _0xabd1ef=_0x13afa7[_0x4d3533(0x22a)](_0x59b7be=>_0x59b7be[_0x4d3533(0x245)]!=='0'&&_0x59b7be[_0x4d3533(0x245)]!==''||_0x59b7be[_0x4d3533(0x254)]!=='0'&&_0x59b7be['to_floorlevel']!=='');var _0x163351=0x0;_0xabd1ef[_0x4d3533(0x281)](_0x113157=>{var _0x142a34=_0x4d3533;parseInt(_0x113157[_0x142a34(0x293)])<parseInt(_0x113157['to_quantity'])&&_0x163351++;});if(_0x163351!=0x0)return _0x4e6421[_0x4d3533(0x291)](_0x4d3533(0x266),_0x4d3533(0x1e9)),_0x155039['redirect'](_0x4d3533(0x258));const _0x40b588=new transfers_finished({'date':_0x58b4d1,'from_warehouse':_0x2d7e78,'to_warehouse':_0x183e34,'product':_0xabd1ef,'note':_0xb71830,'invoice':_0x4bdd59}),_0x1da359=await _0x40b588['save']();_0x4e6421['flash'](_0x4d3533(0x20b),_0x4d3533(0x226)),_0x155039[_0x4d3533(0x217)]('/transfer_finished/preview/'+_0x1da359[_0x4d3533(0x24c)]);}catch(_0x4146ed){console['log'](_0x4146ed),_0x155039[_0x4d3533(0x243)](0xc8)['json']({'errorMessage':_0x4146ed['message']});}}),router[a0_0x38156e(0x209)](a0_0x38156e(0x220),auth,async(_0x165817,_0x47ce26)=>{var _0x26bdbb=a0_0x38156e;try{const {username:_0x14e1cc,email:_0x437044,role:_0x1efbd3}=_0x165817[_0x26bdbb(0x1fd)],_0x541c93=_0x165817[_0x26bdbb(0x1fd)],_0x3695df=await profile[_0x26bdbb(0x255)]({'email':_0x541c93['email']}),_0x1ea2b4=await master_shop['find'](),_0x31abd6=await transfers_finished[_0x26bdbb(0x237)](_0x165817[_0x26bdbb(0x21a)]['id']);let _0x411e3d;if(_0x541c93[_0x26bdbb(0x208)]==_0x26bdbb(0x235)){const _0x3a4c9d=await staff[_0x26bdbb(0x255)]({'email':_0x541c93[_0x26bdbb(0x1ed)]});_0x411e3d=await warehouse[_0x26bdbb(0x276)]({'status':_0x26bdbb(0x26b),'name':_0x3a4c9d[_0x26bdbb(0x1d8)],'warehouse_category':_0x26bdbb(0x1f2)});}else _0x411e3d=await warehouse[_0x26bdbb(0x276)]({'status':_0x26bdbb(0x26b),'warehouse_category':_0x26bdbb(0x1f2)});const _0x315ef2=await warehouse[_0x26bdbb(0x2a9)]([{'$match':{'name':_0x31abd6[_0x26bdbb(0x25f)],'warehouse_category':_0x26bdbb(0x1f2)}},{'$unwind':_0x26bdbb(0x275)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x26bdbb(0x23e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x26bdbb(0x277)},'bin':{'$first':_0x26bdbb(0x22e)},'type':{'$first':_0x26bdbb(0x248)},'floorlevel':{'$first':_0x26bdbb(0x298)},'primary_code':{'$first':_0x26bdbb(0x296)},'secondary_code':{'$first':_0x26bdbb(0x260)},'product_code':{'$first':_0x26bdbb(0x228)},'storage':{'$first':_0x26bdbb(0x2ac)},'rack':{'$first':_0x26bdbb(0x21d)},'expiry_date':{'$first':_0x26bdbb(0x1f3)},'production_date':{'$first':_0x26bdbb(0x2a3)},'room':{'$first':_0x26bdbb(0x294)},'warehoue_name':{'$first':_0x26bdbb(0x22c)}}}]),_0x537ad2=await product[_0x26bdbb(0x276)]({});if(_0x1ea2b4[0x0][_0x26bdbb(0x241)]==_0x26bdbb(0x22b)){var _0x31afbf=users['English'];console[_0x26bdbb(0x1de)](_0x31afbf);}else{if(_0x1ea2b4[0x0]['language']==_0x26bdbb(0x272))var _0x31afbf=users[_0x26bdbb(0x272)];else{if(_0x1ea2b4[0x0][_0x26bdbb(0x241)]=='German')var _0x31afbf=users[_0x26bdbb(0x297)];else{if(_0x1ea2b4[0x0][_0x26bdbb(0x241)]==_0x26bdbb(0x240))var _0x31afbf=users[_0x26bdbb(0x240)];else{if(_0x1ea2b4[0x0][_0x26bdbb(0x241)]==_0x26bdbb(0x278))var _0x31afbf=users[_0x26bdbb(0x278)];else{if(_0x1ea2b4[0x0]['language']==_0x26bdbb(0x1ea))var _0x31afbf=users[_0x26bdbb(0x1e2)];else{if(_0x1ea2b4[0x0][_0x26bdbb(0x241)]==_0x26bdbb(0x26a))var _0x31afbf=users['Chinese'];else{if(_0x1ea2b4[0x0][_0x26bdbb(0x241)]=='Arabic\x20(ae)')var _0x31afbf=users[_0x26bdbb(0x2a1)];}}}}}}}_0x47ce26[_0x26bdbb(0x21b)](_0x26bdbb(0x1fc),{'success':_0x165817[_0x26bdbb(0x291)](_0x26bdbb(0x20b)),'errors':_0x165817[_0x26bdbb(0x291)](_0x26bdbb(0x266)),'role':_0x541c93,'profile':_0x3695df,'master_shop':_0x1ea2b4,'warehouse':_0x411e3d,'transfer':_0x31abd6,'stock':_0x315ef2,'unit':_0x537ad2,'language':_0x31afbf});}catch(_0x4b7453){console[_0x26bdbb(0x1de)](_0x4b7453);}}),router[a0_0x38156e(0x236)](a0_0x38156e(0x220),auth,async(_0x293148,_0x16d974)=>{var _0x8c988b=a0_0x38156e;try{const {invoice:_0x2c884d,from_warehouse:_0x2c3606,FromRoom_name:_0x16102,to_warehouse:_0x22e91c,ToRoom_name:_0x4b7a71}=_0x293148[_0x8c988b(0x25b)],_0x370c09=await transfers_finished[_0x8c988b(0x237)](_0x293148[_0x8c988b(0x21a)]['id']),_0x2fae4f=_0x370c09['product'][_0x8c988b(0x25e)](async _0x150c70=>{var _0xcdebb5=_0x8c988b;if(_0x150c70[_0xcdebb5(0x245)]>0x0){var _0x5a0837=await warehouse[_0xcdebb5(0x255)]({'name':_0x2c3606,'room':_0x150c70[_0xcdebb5(0x21e)],'warehouse_category':'Finished\x20Goods'});const _0x4c7152=_0x5a0837[_0xcdebb5(0x28a)][_0xcdebb5(0x25e)](_0x44b55f=>{var _0x2ba571=_0xcdebb5;_0x44b55f[_0x2ba571(0x21f)]==_0x150c70[_0x2ba571(0x21f)]&&_0x44b55f['bay']==_0x150c70[_0x2ba571(0x211)]&&_0x44b55f[_0x2ba571(0x23d)]==_0x150c70[_0x2ba571(0x23d)]&&_0x44b55f[_0x2ba571(0x227)]==_0x150c70[_0x2ba571(0x227)]&&_0x44b55f[_0x2ba571(0x28f)]==_0x150c70[_0x2ba571(0x28f)]&&_0x44b55f[_0x2ba571(0x24e)]==_0x150c70[_0x2ba571(0x1e3)]&&(_0x44b55f['product_stock']=_0x44b55f[_0x2ba571(0x1e7)]-_0x150c70[_0x2ba571(0x245)]);});}return _0x5a0837;});Promise['all'](_0x2fae4f)[_0x8c988b(0x1df)](async _0x505615=>{var _0x49d830=_0x8c988b;try{for(const _0x93eadf of _0x505615){await _0x93eadf[_0x49d830(0x1d6)]();}const _0x35b059=_0x370c09['product']['map'](async _0x3d4dc8=>{var _0x29d4ce=_0x49d830,_0x501706=await warehouse[_0x29d4ce(0x255)]({'name':_0x22e91c,'room':_0x3d4dc8[_0x29d4ce(0x27d)]});if(_0x3d4dc8[_0x29d4ce(0x245)]>0x0){var _0x1b72c6=0x0;const _0x43c496=_0x501706[_0x29d4ce(0x28a)][_0x29d4ce(0x25e)](_0x233b3e=>{var _0x95270a=_0x29d4ce;_0x233b3e[_0x95270a(0x21f)]==_0x3d4dc8[_0x95270a(0x21f)]&&_0x233b3e[_0x95270a(0x224)]==_0x3d4dc8[_0x95270a(0x265)]&&_0x233b3e['expiry_date']==_0x3d4dc8[_0x95270a(0x23d)]&&_0x233b3e[_0x95270a(0x227)]==_0x3d4dc8[_0x95270a(0x227)]&&_0x233b3e[_0x95270a(0x28f)]==_0x3d4dc8[_0x95270a(0x28f)]&&_0x233b3e[_0x95270a(0x24e)]==_0x3d4dc8[_0x95270a(0x205)]&&(_0x233b3e[_0x95270a(0x1e7)]=_0x233b3e[_0x95270a(0x1e7)]+_0x3d4dc8[_0x95270a(0x245)],_0x1b72c6++);});_0x1b72c6=='0'&&(_0x501706['product_details']=_0x501706[_0x29d4ce(0x28a)][_0x29d4ce(0x25c)]({'product_name':_0x3d4dc8['product_name'],'product_stock':_0x3d4dc8[_0x29d4ce(0x245)],'bay':_0x3d4dc8['to_bay'],'product_code':_0x3d4dc8[_0x29d4ce(0x215)],'primary_code':_0x3d4dc8[_0x29d4ce(0x26d)],'secondary_code':_0x3d4dc8[_0x29d4ce(0x249)],'expiry_date':_0x3d4dc8[_0x29d4ce(0x23d)],'production_date':_0x3d4dc8[_0x29d4ce(0x227)],'maxProducts':_0x3d4dc8['maxProducts'],'batch_code':_0x3d4dc8[_0x29d4ce(0x28f)],'secondary_unit':_0x3d4dc8[_0x29d4ce(0x1dc)],'unit':_0x3d4dc8[_0x29d4ce(0x1e6)],'maxProducts':_0x3d4dc8['maxProducts'],'maxPerUnit':_0x3d4dc8[_0x29d4ce(0x1ee)],'invoice':_0x3d4dc8['To_invoice']}));}return _0x501706;});Promise['all'](_0x35b059)[_0x49d830(0x1df)](async _0x5c1a0c=>{var _0x43abf1=_0x49d830;try{for(const _0x2b2db9 of _0x5c1a0c){await warehouse[_0x43abf1(0x1f9)]({'_id':_0x2b2db9['_id']},{'$addToSet':{'product_details':{'$each':_0x2b2db9[_0x43abf1(0x28a)]}}});}_0x370c09[_0x43abf1(0x1db)]=_0x43abf1(0x2b1);const _0x52326e=await _0x370c09[_0x43abf1(0x1d6)](),_0x47fb56=await master_shop[_0x43abf1(0x276)](),_0x1227eb=await email_settings[_0x43abf1(0x255)](),_0x2b43a0=await supervisor_settings[_0x43abf1(0x276)]();var _0x2bee11=_0x370c09[_0x43abf1(0x284)],_0x3d1351='',_0x588b04;for(_0x588b04 in _0x2bee11){var _0x52a7aa='FG';_0x370c09[_0x43abf1(0x210)]==_0x43abf1(0x256)&&(_0x52a7aa='DG'),_0x3d1351+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bee11[_0x588b04]['product_name']+_0x43abf1(0x20c)+_0x43abf1(0x2a5)+_0x2bee11[_0x588b04][_0x43abf1(0x215)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bee11[_0x588b04]['to_quantity']+_0x43abf1(0x20c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bee11[_0x588b04]['unit']+_0x43abf1(0x20c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bee11[_0x588b04][_0x43abf1(0x1dc)]+'</td>'+_0x43abf1(0x2a5)+_0x370c09[_0x43abf1(0x210)]+'</td>'+_0x43abf1(0x2a5)+_0x2bee11[_0x588b04]['to_room_name']+_0x43abf1(0x20c)+_0x43abf1(0x2a5)+_0x52a7aa+_0x2bee11[_0x588b04][_0x43abf1(0x265)]+_0x43abf1(0x20c)+_0x43abf1(0x27f);}let _0xb2da3=nodemailer[_0x43abf1(0x225)]({'host':_0x1227eb[_0x43abf1(0x22d)],'port':Number(_0x1227eb[_0x43abf1(0x20f)]),'secure':![],'auth':{'user':_0x1227eb[_0x43abf1(0x1ed)],'pass':_0x1227eb[_0x43abf1(0x1dd)]}}),_0xab4634={'from':_0x1227eb['email'],'to':_0x2b43a0[0x0]['FGSEmail'],'subject':_0x43abf1(0x273),'attachments':[{'filename':_0x43abf1(0x2af),'path':__dirname+_0x43abf1(0x20d)+_0x43abf1(0x29d)+_0x47fb56[0x0][_0x43abf1(0x1fe)],'cid':_0x43abf1(0x292)}],'html':_0x43abf1(0x202)+_0x43abf1(0x25d)+_0x43abf1(0x1f7)+'<div>'+_0x43abf1(0x21c)+_0x43abf1(0x27c)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x43abf1(0x222)+_0x47fb56[0x0]['site_title']+_0x43abf1(0x1f8)+_0x43abf1(0x1fb)+_0x43abf1(0x1fb)+_0x43abf1(0x246)+_0x43abf1(0x27c)+_0x43abf1(0x290)+_0x43abf1(0x28e)+_0x370c09[_0x43abf1(0x24e)]+'\x20'+_0x43abf1(0x2a2)+_0x43abf1(0x212)+_0x370c09[_0x43abf1(0x1ec)]+'\x20'+'</span>'+'</h5>'+_0x43abf1(0x1fb)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x43abf1(0x216)+_0x43abf1(0x1ef)+_0x43abf1(0x24a)+_0x43abf1(0x24b)+_0x43abf1(0x24d)+_0x43abf1(0x22f)+_0x43abf1(0x1e4)+_0x43abf1(0x29f)+_0x43abf1(0x27f)+_0x43abf1(0x219)+_0x43abf1(0x279)+'\x20'+_0x3d1351+'\x20'+'</tbody>'+'</table>'+_0x43abf1(0x27c)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x47fb56[0x0]['site_title']+_0x43abf1(0x27e)+_0x43abf1(0x1fb)+_0x43abf1(0x1fb)+_0x43abf1(0x2ab)};_0xb2da3[_0x43abf1(0x283)](_0xab4634,function(_0x158cfd,_0x4aa8cf){var _0x4ec235=_0x43abf1;_0x158cfd?(console[_0x4ec235(0x1de)](_0x158cfd),console[_0x4ec235(0x1de)](_0x4ec235(0x1fa))):console[_0x4ec235(0x1de)]('Email\x20sent\x20successfully');}),_0x293148[_0x43abf1(0x291)](_0x43abf1(0x20b),_0x43abf1(0x2a4)),_0x16d974[_0x43abf1(0x217)](_0x43abf1(0x23a)+_0x52326e[_0x43abf1(0x24c)]);}catch(_0x323f6e){console[_0x43abf1(0x206)](_0x323f6e),_0x16d974[_0x43abf1(0x243)](0x1f4)[_0x43abf1(0x1f0)]({'error':_0x43abf1(0x1da)});}})[_0x49d830(0x280)](_0x24af11=>{var _0x134ed2=_0x49d830;console[_0x134ed2(0x206)](_0x24af11),_0x16d974[_0x134ed2(0x243)](0x1f4)[_0x134ed2(0x1f0)]({'error':_0x134ed2(0x271)});});}catch(_0x563c0b){console['error'](_0x563c0b),_0x16d974[_0x49d830(0x243)](0x1f4)['json']({'error':_0x49d830(0x269)});}})[_0x8c988b(0x280)](_0x43247c=>{var _0x15837f=_0x8c988b;console['error'](_0x43247c),_0x16d974[_0x15837f(0x243)](0x1f4)[_0x15837f(0x1f0)]({'error':_0x15837f(0x271)});});}catch(_0x414fdc){_0x16d974['json']({'message':_0x414fdc['message']});}});function a0_0x4106(_0x297aa7,_0x386ace){var _0x2480dc=a0_0x2480();return a0_0x4106=function(_0x4106b9,_0x2ef460){_0x4106b9=_0x4106b9-0x1d6;var _0x294a31=_0x2480dc[_0x4106b9];return _0x294a31;},a0_0x4106(_0x297aa7,_0x386ace);}function BayBinSelected(_0x73fd32,_0x34d878){var _0xcbcc5b=a0_0x38156e,_0x3c7e15=[];let _0x2dc127=[];var _0x3528d5=[];if(_0x73fd32==_0xcbcc5b(0x256)){switch(_0x34d878){case _0xcbcc5b(0x27b):_0x3c7e15=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0xcbcc5b(0x295):_0x3c7e15=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3528d5=['DG'];}else{if(_0x73fd32==_0xcbcc5b(0x252)){switch(_0x34d878){case _0xcbcc5b(0x27b):_0x3c7e15=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0xcbcc5b(0x295):_0x3c7e15=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3528d5=['FG'];}}return{'levels':_0x3c7e15,'identify':_0x3528d5};}router[a0_0x38156e(0x209)](a0_0x38156e(0x223),auth,async(_0x1617fb,_0x5b50f0)=>{var _0x4d4395=a0_0x38156e;try{const {username:_0x313bd1,email:_0x51c754,role:_0x4fa0a6}=_0x1617fb[_0x4d4395(0x1fd)],_0x59381c=_0x1617fb[_0x4d4395(0x1fd)],_0x506654=await profile[_0x4d4395(0x255)]({'email':_0x59381c[_0x4d4395(0x1ed)]}),_0x483920=await master_shop['find'](),_0xe97b37=await transfers_finished[_0x4d4395(0x237)](_0x1617fb[_0x4d4395(0x21a)]['id']);let _0xd4223d=new Date(_0xe97b37[_0x4d4395(0x23d)]),_0x3ef790=('0'+_0xd4223d[_0x4d4395(0x2b2)]())[_0x4d4395(0x287)](-0x2),_0x1d376f=('0'+(_0xd4223d[_0x4d4395(0x201)]()+0x1))[_0x4d4395(0x287)](-0x2),_0x5da9d4=_0xd4223d[_0x4d4395(0x1f6)](),_0x3ee966=_0x5da9d4+'-'+_0x1d376f+'-'+_0x3ef790,_0x9943bb;if(_0x59381c[_0x4d4395(0x208)]==_0x4d4395(0x235)){const _0x1f63ee=await staff[_0x4d4395(0x255)]({'email':_0x59381c[_0x4d4395(0x1ed)]});_0x9943bb=await warehouse[_0x4d4395(0x276)]({'status':_0x4d4395(0x26b),'name':_0x1f63ee[_0x4d4395(0x1d8)],'warehouse_category':'Finished\x20Goods'});}else _0x9943bb=await warehouse[_0x4d4395(0x276)]({'status':_0x4d4395(0x26b),'warehouse_category':_0x4d4395(0x1f2)});const _0x1fd763=await warehouse[_0x4d4395(0x2a9)]([{'$match':{'name':_0xe97b37['from_warehouse'],'room':_0xe97b37[_0x4d4395(0x234)]}},{'$unwind':_0x4d4395(0x275)},{'$group':{'_id':_0x4d4395(0x267),'name':{'$first':_0x4d4395(0x23e)},'product_stock':{'$first':_0x4d4395(0x213)},'bay':{'$first':_0x4d4395(0x277)},'bin':{'$first':_0x4d4395(0x22e)},'type':{'$first':_0x4d4395(0x248)},'floorlevel':{'$first':_0x4d4395(0x298)},'primary_code':{'$first':_0x4d4395(0x296)},'secondary_code':{'$first':_0x4d4395(0x260)},'product_code':{'$first':_0x4d4395(0x228)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4d4395(0x21d)}}}]);var _0x419ea4=[0x1,0x2,0x3,0x4],_0x2b2db3=['A','B','C','D','E','F','G','H','I','J'],_0x4c05a5=['Ambient','Enclosed'];const _0x313b93=await product[_0x4d4395(0x276)]({}),_0x5ce9c7=BayBinSelected(_0xe97b37['to_warehouse'],_0xe97b37[_0x4d4395(0x2ad)]);if(_0x483920[0x0][_0x4d4395(0x241)]=='English\x20(US)'){var _0x3f66a8=users['English'];console['log'](_0x3f66a8);}else{if(_0x483920[0x0]['language']==_0x4d4395(0x272))var _0x3f66a8=users[_0x4d4395(0x272)];else{if(_0x483920[0x0]['language']==_0x4d4395(0x297))var _0x3f66a8=users['German'];else{if(_0x483920[0x0][_0x4d4395(0x241)]==_0x4d4395(0x240))var _0x3f66a8=users[_0x4d4395(0x240)];else{if(_0x483920[0x0][_0x4d4395(0x241)]==_0x4d4395(0x278))var _0x3f66a8=users[_0x4d4395(0x278)];else{if(_0x483920[0x0][_0x4d4395(0x241)]==_0x4d4395(0x1ea))var _0x3f66a8=users[_0x4d4395(0x1e2)];else{if(_0x483920[0x0][_0x4d4395(0x241)]=='Chinese')var _0x3f66a8=users[_0x4d4395(0x26a)];else{if(_0x483920[0x0][_0x4d4395(0x241)]==_0x4d4395(0x233))var _0x3f66a8=users[_0x4d4395(0x2a1)];}}}}}}}_0x5b50f0['render'](_0x4d4395(0x23b),{'success':_0x1617fb[_0x4d4395(0x291)]('success'),'errors':_0x1617fb[_0x4d4395(0x291)](_0x4d4395(0x266)),'role':_0x59381c,'profile':_0x506654,'master_shop':_0x483920,'warehouse':_0x9943bb,'transfer':_0xe97b37,'stock':_0x1fd763,'unit':_0x313b93,'language':_0x3f66a8,'levels':_0x419ea4,'Isle':_0x2b2db3,'rooms_data':_0x4c05a5,'ed_fullDate':_0x3ee966,'dataSelected':_0x5ce9c7});}catch(_0x388f69){console[_0x4d4395(0x1de)](_0x388f69);}}),router[a0_0x38156e(0x236)]('/view/:id',auth,async(_0x5aa6d7,_0x591063)=>{var _0x33164c=a0_0x38156e;try{const _0x4ddf64=_0x5aa6d7[_0x33164c(0x21a)]['id'];console[_0x33164c(0x1de)](_0x5aa6d7[_0x33164c(0x25b)]);const _0x4bb714=await transfers_finished[_0x33164c(0x237)](_0x4ddf64);console[_0x33164c(0x1de)](_0x33164c(0x1eb),_0x4bb714);const {date:_0xbf8781,from_warehouse:_0x1fd5f4,FromRoom_name:_0x364f2b,to_warehouse:_0x343038,ToRoom_name:_0x7907f0,prod_name:_0x1b7f41,from_prod_qty:_0x453779,from_prod_level:_0x284d9b,from_prod_isle:_0x279f0c,from_prod_pallet:_0x4a767d,to_prod_qty:_0x563b25,to_prod_level:_0x132437,to_prod_isle:_0x4d1556,to_prod_pallet:_0x396f57,primary_code:_0x2864f4,secondary_code:_0x3a0036,product_code3:_0x5de8fe,note:_0x1f6655,invoice:_0x124e77,expiry_date:_0x2f42b3}=_0x5aa6d7[_0x33164c(0x25b)];if(typeof _0x1b7f41==_0x33164c(0x26f))var _0x2b7828=[_0x5aa6d7[_0x33164c(0x25b)]['prod_name']],_0x3f0ef8=[_0x5aa6d7[_0x33164c(0x25b)]['from_prod_qty']],_0x291232=[_0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x247)]],_0x1631c3=[_0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x1e1)]],_0x48c111=[_0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x1f4)]],_0x37d01b=[_0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x26d)]],_0x53bead=[_0x5aa6d7['body'][_0x33164c(0x249)]],_0x50817e=[_0x5aa6d7[_0x33164c(0x25b)]['product_code3']],_0x5af712=[_0x5aa6d7[_0x33164c(0x25b)]['MaxStocks_data2']],_0x1ba302=[_0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x1e6)]],_0x3c7e8f=[_0x5aa6d7[_0x33164c(0x25b)]['secondary_unit']],_0x349445=[_0x5aa6d7[_0x33164c(0x25b)]['batch_code']],_0x5c72de=[_0x5aa6d7['body'][_0x33164c(0x23d)]];else var _0x2b7828=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x28b)]],_0x3f0ef8=[..._0x5aa6d7['body'][_0x33164c(0x1d7)]],_0x291232=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x247)]],_0x1631c3=[..._0x5aa6d7['body'][_0x33164c(0x1e1)]],_0x48c111=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x1f4)]],_0x37d01b=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x26d)]],_0x53bead=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x249)]],_0x50817e=[..._0x5aa6d7['body']['product_code3']],_0x5af712=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x29a)]],_0x1ba302=[..._0x5aa6d7[_0x33164c(0x25b)]['unit']],_0x3c7e8f=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x1dc)]],_0x349445=[..._0x5aa6d7[_0x33164c(0x25b)][_0x33164c(0x28f)]],_0x5c72de=[..._0x5aa6d7[_0x33164c(0x25b)]['expiry_date']];const _0x2776bf=_0x2b7828[_0x33164c(0x25e)](_0x1ae36a=>{return _0x1ae36a={'product_name':_0x1ae36a};});_0x3f0ef8['forEach']((_0x165d6a,_0x2a658a)=>{var _0x150d9e=_0x33164c;_0x2776bf[_0x2a658a][_0x150d9e(0x293)]=_0x165d6a;}),_0x291232[_0x33164c(0x281)]((_0x444a98,_0x9e47d0)=>{var _0x452c46=_0x33164c;_0x2776bf[_0x9e47d0][_0x452c46(0x211)]=_0x444a98;}),_0x1631c3[_0x33164c(0x281)]((_0x5b4f28,_0x5b986e)=>{_0x2776bf[_0x5b986e]['to_quantity']=_0x5b4f28;}),_0x48c111[_0x33164c(0x281)]((_0xf7c7f1,_0xe6ea8c)=>{var _0x13e367=_0x33164c;_0x2776bf[_0xe6ea8c][_0x13e367(0x265)]=_0xf7c7f1;}),_0x37d01b['forEach']((_0x23f823,_0x500435)=>{var _0x488a5c=_0x33164c;_0x2776bf[_0x500435][_0x488a5c(0x26d)]=_0x23f823;}),_0x53bead[_0x33164c(0x281)]((_0x59de2e,_0x5f5b6e)=>{var _0x1c5c18=_0x33164c;_0x2776bf[_0x5f5b6e][_0x1c5c18(0x249)]=_0x59de2e;}),_0x50817e['forEach']((_0x2b15a7,_0x1c775e)=>{_0x2776bf[_0x1c775e]['product_code']=_0x2b15a7;}),_0x5af712['forEach']((_0x588293,_0x4d54ef)=>{var _0x23c16f=_0x33164c;_0x2776bf[_0x4d54ef][_0x23c16f(0x259)]=_0x588293;}),_0x1ba302[_0x33164c(0x281)]((_0x59b25e,_0x4e2cf2)=>{var _0x6cad14=_0x33164c;_0x2776bf[_0x4e2cf2][_0x6cad14(0x1e6)]=_0x59b25e;}),_0x3c7e8f['forEach']((_0x2cc3de,_0x1dc5e3)=>{_0x2776bf[_0x1dc5e3]['secondary_unit']=_0x2cc3de;}),_0x349445[_0x33164c(0x281)]((_0x143f24,_0x241c19)=>{_0x2776bf[_0x241c19]['batch_code']=_0x143f24;}),_0x5c72de['forEach']((_0x2d2471,_0x45c792)=>{_0x2776bf[_0x45c792]['expiry_date']=_0x2d2471;});const _0x42965e=_0x2776bf['filter'](_0x3e1c9a=>_0x3e1c9a['to_quantity']!=='0'&&_0x3e1c9a[_0x33164c(0x245)]!==''||_0x3e1c9a[_0x33164c(0x254)]!=='0'&&_0x3e1c9a['to_floorlevel']!=='');var _0x17382a=0x0;_0x42965e[_0x33164c(0x281)](_0x205286=>{var _0x24c929=_0x33164c;parseInt(_0x205286[_0x24c929(0x293)])<parseInt(_0x205286['to_quantity'])&&_0x17382a++;});if(_0x17382a!=0x0)return _0x5aa6d7[_0x33164c(0x291)]('errors',_0x33164c(0x1e9)),_0x591063[_0x33164c(0x217)](_0x33164c(0x258));const _0x3b5868=await warehouse[_0x33164c(0x255)]({'name':_0x4bb714[_0x33164c(0x25f)],'room':_0x4bb714[_0x33164c(0x234)]});_0x4bb714[_0x33164c(0x284)][_0x33164c(0x281)](_0x558cbf=>{var _0x4f4471=_0x33164c;if(_0x558cbf[_0x4f4471(0x245)]>0x0){const _0x82a705=_0x3b5868[_0x4f4471(0x28a)]['map'](_0x516036=>{var _0x941646=_0x4f4471;_0x516036['product_name']==_0x558cbf['product_name']&&_0x516036[_0x941646(0x224)]==_0x558cbf[_0x941646(0x211)]&&(_0x516036['product_stock']=parseInt(_0x516036[_0x941646(0x1e7)])+parseInt(_0x558cbf['to_quantity']));});}}),await _0x3b5868[_0x33164c(0x1d6)]();const _0x406d67=await warehouse[_0x33164c(0x255)]({'name':_0x4bb714['to_warehouse'],'room':_0x4bb714[_0x33164c(0x2ad)]});_0x4bb714[_0x33164c(0x284)][_0x33164c(0x281)](_0x741b31=>{var _0xac6807=_0x33164c;if(_0x741b31[_0xac6807(0x245)]>0x0){const _0x38b49a=_0x406d67[_0xac6807(0x28a)]['map'](_0x5973ce=>{var _0x14a9ef=_0xac6807;_0x5973ce['product_name']==_0x741b31[_0x14a9ef(0x21f)]&&_0x5973ce[_0x14a9ef(0x224)]==_0x741b31[_0x14a9ef(0x265)]&&(_0x5973ce[_0x14a9ef(0x1e7)]=parseInt(_0x5973ce['product_stock'])-parseInt(_0x741b31['to_quantity']));});}}),await _0x406d67[_0x33164c(0x1d6)](),_0x4bb714[_0x33164c(0x1ec)]=_0xbf8781,_0x4bb714['from_warehouse']=_0x1fd5f4,_0x4bb714[_0x33164c(0x210)]=_0x343038,_0x4bb714[_0x33164c(0x284)]=_0x42965e,_0x4bb714['note']=_0x1f6655,_0x4bb714[_0x33164c(0x24e)]=_0x124e77;const _0x5e135c=await _0x4bb714['save'](),_0x5834d3=await warehouse['findOne']({'name':_0x1fd5f4,'room':_0x364f2b});_0x5e135c[_0x33164c(0x284)][_0x33164c(0x281)](_0x7e814c=>{var _0x1317d3=_0x33164c;if(_0x7e814c['to_quantity']>0x0){const _0x5a508a=_0x5834d3[_0x1317d3(0x28a)][_0x1317d3(0x25e)](_0x14db4e=>{var _0x16dfdf=_0x1317d3;_0x14db4e[_0x16dfdf(0x21f)]==_0x7e814c[_0x16dfdf(0x21f)]&&_0x14db4e[_0x16dfdf(0x224)]==_0x7e814c[_0x16dfdf(0x211)]&&(_0x14db4e['product_stock']=parseInt(_0x14db4e[_0x16dfdf(0x1e7)])-parseInt(_0x7e814c['to_quantity']));});}}),await _0x5834d3[_0x33164c(0x1d6)]();const _0xbede48=await warehouse['findOne']({'name':_0x343038,'room':_0x7907f0});_0x5e135c[_0x33164c(0x284)][_0x33164c(0x281)](_0x58d3f4=>{var _0x36392a=_0x33164c;if(_0x58d3f4['to_quantity']>0x0){var _0x2fe46b=0x0;const _0x3aa060=_0xbede48[_0x36392a(0x28a)]['map'](_0x1a23af=>{var _0x237a85=_0x36392a;_0x1a23af[_0x237a85(0x21f)]==_0x58d3f4[_0x237a85(0x21f)]&&_0x1a23af[_0x237a85(0x224)]==_0x58d3f4['to_bay']&&(_0x1a23af[_0x237a85(0x1e7)]=parseInt(_0x1a23af['product_stock'])+parseInt(_0x58d3f4[_0x237a85(0x245)]),_0x2fe46b++);});_0x2fe46b=='0'&&(_0xbede48[_0x36392a(0x28a)]=_0xbede48[_0x36392a(0x28a)][_0x36392a(0x25c)]({'product_name':_0x58d3f4[_0x36392a(0x21f)],'product_stock':_0x58d3f4[_0x36392a(0x245)],'bay':_0x58d3f4[_0x36392a(0x265)],'product_code':_0x58d3f4['product_code'],'primary_code':_0x58d3f4[_0x36392a(0x26d)],'secondary_code':_0x58d3f4[_0x36392a(0x249)],'maxProducts':_0x58d3f4[_0x36392a(0x259)]}));}}),await _0xbede48[_0x33164c(0x1d6)](),_0x5aa6d7[_0x33164c(0x291)]('success',_0x33164c(0x257)),_0x591063[_0x33164c(0x217)]('/transfer_finished/view');}catch(_0x3c0d92){console[_0x33164c(0x1de)](_0x3c0d92);}}),router['post'](a0_0x38156e(0x250),async(_0x5110c5,_0x2905b3)=>{var _0x360b38=a0_0x38156e;const {FromWareHouse:_0x5c8346,FromRoom:_0xbe9d15,ToWarehouse:_0x32a98c,ToRoom:_0x5bc88d,primary_code:_0x4cb5ca,Roomslist:_0x5d2669}=_0x5110c5[_0x360b38(0x25b)],_0x296437=_0x5d2669[_0x360b38(0x221)](','),_0x587a69=[];async function _0x1adf68(_0x34416e){var _0x5c38b4=_0x360b38;const _0x2fd54c=await warehouse[_0x5c38b4(0x2a9)]([{'$match':{'name':_0x5c8346,'room':_0x34416e}},{'$unwind':_0x5c38b4(0x275)},{'$match':{'product_details.primary_code':_0x4cb5ca}},{'$group':{'_id':_0x5c38b4(0x267),'name':{'$first':_0x5c38b4(0x23e)},'instock':{'$first':_0x5c38b4(0x213)},'primary_code':{'$first':_0x5c38b4(0x296)},'secondary_code':{'$first':_0x5c38b4(0x260)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5c38b4(0x277)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x5c38b4(0x248)},'pallet':{'$first':_0x5c38b4(0x298)},'unit':{'$first':_0x5c38b4(0x29b)},'secondary_unit':{'$first':_0x5c38b4(0x251)},'storage':{'$first':_0x5c38b4(0x2ac)},'rack':{'$first':_0x5c38b4(0x21d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5c38b4(0x2a3)},'batch_code':{'$first':_0x5c38b4(0x1f1)},'maxPerUnit':{'$first':_0x5c38b4(0x231)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x5c38b4(0x20e)}}}]),_0x547d4d=await warehouse['aggregate']([{'$match':{'name':_0x5c8346,'room':_0x34416e}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x4cb5ca}},{'$group':{'_id':_0x5c38b4(0x267),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x5c38b4(0x213)},'primary_code':{'$first':_0x5c38b4(0x296)},'secondary_code':{'$first':_0x5c38b4(0x260)},'product_code':{'$first':_0x5c38b4(0x228)},'level':{'$first':_0x5c38b4(0x277)},'isle':{'$first':_0x5c38b4(0x22e)},'type':{'$first':_0x5c38b4(0x248)},'pallet':{'$first':_0x5c38b4(0x298)},'unit':{'$first':_0x5c38b4(0x29b)},'secondary_unit':{'$first':_0x5c38b4(0x251)},'storage':{'$first':_0x5c38b4(0x2ac)},'rack':{'$first':_0x5c38b4(0x21d)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5c38b4(0x2a3)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x5c38b4(0x231)},'roomNamed':{'$first':_0x5c38b4(0x294)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2fd54c['length']>0x0)_0x587a69[_0x5c38b4(0x26e)](_0x2fd54c);else _0x547d4d['length']>0x0&&_0x587a69['push'](_0x547d4d);}const _0x568be9=_0x296437[_0x360b38(0x25e)](_0x21bb30=>_0x1adf68(_0x21bb30));await Promise[_0x360b38(0x289)](_0x568be9),_0x2905b3[_0x360b38(0x1f0)](_0x587a69);}),router['post'](a0_0x38156e(0x232),async(_0x3d122a,_0x1a30a4)=>{var _0x1bafd1=a0_0x38156e;try{const {FromWareHouse:_0x19f475,FromRoom:_0x9cf692,ToWarehouse:_0x3ff7b1,ToRoom:_0x2df9f9,secondary_code:_0x3df2cf}=_0x3d122a[_0x1bafd1(0x25b)],_0x3822c6=await warehouse['aggregate']([{'$match':{'name':_0x19f475}},{'$unwind':_0x1bafd1(0x275)},{'$match':{'product_details.secondary_code':_0x3df2cf}},{'$group':{'_id':_0x1bafd1(0x267),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x1bafd1(0x296)},'secondary_code':{'$first':_0x1bafd1(0x260)},'product_code':{'$first':_0x1bafd1(0x228)},'instock':{'$first':_0x1bafd1(0x213)},'warehouse':{'$first':'$name'},'level':{'$first':_0x1bafd1(0x200)},'isle':{'$first':_0x1bafd1(0x1e8)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x1bafd1(0x29b)},'expiry_date':{'$first':_0x1bafd1(0x1f3)},'production_date':{'$first':_0x1bafd1(0x2a3)}}}]);_0x1a30a4[_0x1bafd1(0x243)](0xc8)['json'](_0x3822c6);}catch(_0x558ba0){_0x1a30a4[_0x1bafd1(0x243)](0x194)[_0x1bafd1(0x1f0)]({'message':_0x558ba0[_0x1bafd1(0x29e)]});}}),router[a0_0x38156e(0x236)](a0_0x38156e(0x288),async(_0x901ef1,_0x3792dd)=>{var _0x595d13=a0_0x38156e;try{const {FromWareHouse:_0x20f145,FromRoom:_0x418dff,ToWarehouse:_0x3f573f,ToRoom:_0x759ff0,product_code:_0x4613c3}=_0x901ef1[_0x595d13(0x25b)],_0x62b2cc=await warehouse[_0x595d13(0x2a9)]([{'$match':{'name':_0x20f145}},{'$unwind':_0x595d13(0x275)},{'$match':{'product_details.product_code':_0x4613c3}},{'$group':{'_id':_0x595d13(0x267),'name':{'$first':_0x595d13(0x23e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x595d13(0x260)},'product_code':{'$first':_0x595d13(0x228)},'instock':{'$first':_0x595d13(0x213)},'warehouse':{'$first':_0x595d13(0x22c)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x595d13(0x1e8)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x595d13(0x2ae)},'unit':{'$first':'$product_details.unit'}}}]);_0x3792dd['status'](0xc8)[_0x595d13(0x1f0)](_0x62b2cc);}catch(_0x56d69d){_0x3792dd[_0x595d13(0x243)](0x194)['json']({'message':_0x56d69d['message']});}}),router[a0_0x38156e(0x236)]('/CheckingWarehouse',async(_0x586170,_0x24f12e)=>{var _0x2e5116=a0_0x38156e;const {productCode:_0x54d9ff,bay:_0x5811e9,warehouses:_0x1387b5,room:_0x2a80e5}=_0x586170['body'];console[_0x2e5116(0x1de)](_0x586170[_0x2e5116(0x25b)]);try{const _0x9906fe=await warehouse[_0x2e5116(0x2a9)]([{'$match':{'name':_0x1387b5,'room':_0x2a80e5}},{'$unwind':_0x2e5116(0x275)},{'$match':{'product_details.bay':parseInt(_0x5811e9)}},{'$group':{'_id':_0x2e5116(0x267),'name':{'$first':_0x2e5116(0x23e)},'product_stock':{'$first':_0x2e5116(0x213)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x2e5116(0x2ae)}}}]);_0x24f12e['status'](0xc8)[_0x2e5116(0x1f0)](_0x9906fe);}catch(_0x3345f1){_0x24f12e[_0x2e5116(0x243)](0x194)[_0x2e5116(0x1f0)]({'message':_0x3345f1[_0x2e5116(0x29e)]});}}),module[a0_0x38156e(0x1f5)]=router;