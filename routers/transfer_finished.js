var a0_0x336b7e=a0_0x1598;(function(_0xe683ea,_0x2a4ed2){var _0x3bf20f=a0_0x1598,_0x4ce7eb=_0xe683ea();while(!![]){try{var _0x4fe4e6=parseInt(_0x3bf20f(0x17e))/0x1+parseInt(_0x3bf20f(0x159))/0x2+parseInt(_0x3bf20f(0x19b))/0x3+parseInt(_0x3bf20f(0x206))/0x4*(-parseInt(_0x3bf20f(0x1d4))/0x5)+-parseInt(_0x3bf20f(0x193))/0x6*(-parseInt(_0x3bf20f(0x1fe))/0x7)+-parseInt(_0x3bf20f(0x161))/0x8*(parseInt(_0x3bf20f(0x150))/0x9)+parseInt(_0x3bf20f(0x1f1))/0xa;if(_0x4fe4e6===_0x2a4ed2)break;else _0x4ce7eb['push'](_0x4ce7eb['shift']());}catch(_0x57ce99){_0x4ce7eb['push'](_0x4ce7eb['shift']());}}}(a0_0x12e9,0x36c88));const express=require(a0_0x336b7e(0x209)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x336b7e(0x1ce)),auth=require(a0_0x336b7e(0x1cf)),users=require(a0_0x336b7e(0x174)),nodemailer=require('nodemailer');router[a0_0x336b7e(0x20b)](a0_0x336b7e(0x1e8),auth,async(_0x2c4c3c,_0x56517a)=>{var _0x491981=a0_0x336b7e;try{const {username:_0x317698,email:_0x30df22,role:_0x59a198}=_0x2c4c3c[_0x491981(0x197)],_0x22f98d=_0x2c4c3c[_0x491981(0x197)],_0x29089f=await profile[_0x491981(0x171)]({'email':_0x22f98d[_0x491981(0x157)]}),_0x5c400d=await master_shop[_0x491981(0x207)]();let _0x16cbfb;if(_0x22f98d[_0x491981(0x1e3)]==_0x491981(0x212)){const _0x24d835=await staff['findOne']({'email':_0x22f98d[_0x491981(0x157)]});_0x16cbfb=await transfers_finished[_0x491981(0x207)]({'from_warehouse':_0x24d835[_0x491981(0x1aa)]});}else _0x16cbfb=await transfers_finished[_0x491981(0x190)]([{'$unwind':_0x491981(0x1a3)},{'$group':{'_id':_0x491981(0x1b9),'invoice':{'$first':_0x491981(0x187)},'date':{'$first':_0x491981(0x1ae)},'from_warehouse':{'$first':_0x491981(0x1ec)},'to_warehouse':{'$first':_0x491981(0x1c6)},'from_room_name':{'$addToSet':_0x491981(0x1cd)},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x5c400d[0x0]['language']==_0x491981(0x1dc))var _0x4d75d3=users[_0x491981(0x21a)];else{if(_0x5c400d[0x0][_0x491981(0x1de)]=='Hindi')var _0x4d75d3=users[_0x491981(0x14d)];else{if(_0x5c400d[0x0]['language']=='German')var _0x4d75d3=users[_0x491981(0x15e)];else{if(_0x5c400d[0x0][_0x491981(0x1de)]==_0x491981(0x18a))var _0x4d75d3=users[_0x491981(0x18a)];else{if(_0x5c400d[0x0][_0x491981(0x1de)]==_0x491981(0x1e4))var _0x4d75d3=users['French'];else{if(_0x5c400d[0x0][_0x491981(0x1de)]=='Portuguese\x20(BR)')var _0x4d75d3=users[_0x491981(0x211)];else{if(_0x5c400d[0x0][_0x491981(0x1de)]==_0x491981(0x178))var _0x4d75d3=users[_0x491981(0x178)];else{if(_0x5c400d[0x0][_0x491981(0x1de)]==_0x491981(0x176))var _0x4d75d3=users[_0x491981(0x222)];}}}}}}}_0x56517a['render'](_0x491981(0x1f5),{'success':_0x2c4c3c['flash'](_0x491981(0x216)),'errors':_0x2c4c3c[_0x491981(0x205)]('errors'),'role':_0x22f98d,'profile':_0x29089f,'master_shop':_0x5c400d,'transfer':_0x16cbfb,'language':_0x4d75d3});}catch(_0x53acae){console[_0x491981(0x15a)](_0x53acae);}});async function getRandom8DigitNumber(){var _0x2653c4=a0_0x336b7e;const _0x5e926d=0x989680,_0x390a0b=0x5f5e0ff,_0x46e700=Math['floor'](Math[_0x2653c4(0x15d)]()*(_0x390a0b-_0x5e926d+0x1))+_0x5e926d;var _0x5409c1;const _0x560ba1=await transfers_finished[_0x2653c4(0x171)]({'invoice':_0x2653c4(0x1a4)+_0x46e700});return _0x560ba1&&_0x560ba1[_0x2653c4(0x1f4)]>0x0?_0x5409c1=_0x2653c4(0x1a4)+_0x46e700:_0x5409c1=_0x2653c4(0x1a4)+_0x46e700,_0x5409c1;}function a0_0x1598(_0x27b003,_0xa55cd7){var _0x12e9f7=a0_0x12e9();return a0_0x1598=function(_0x159809,_0x3c0489){_0x159809=_0x159809-0x14a;var _0x3ecbe9=_0x12e9f7[_0x159809];return _0x3ecbe9;},a0_0x1598(_0x27b003,_0xa55cd7);}router[a0_0x336b7e(0x20b)](a0_0x336b7e(0x1ea),auth,async(_0x4de16b,_0x403d60)=>{var _0x471e56=a0_0x336b7e;try{const {username:_0x27d3e2,email:_0x1140e3,role:_0x29ca1d}=_0x4de16b[_0x471e56(0x197)],_0x1a16fd=_0x4de16b[_0x471e56(0x197)],_0x2c475d=await profile[_0x471e56(0x171)]({'email':_0x1a16fd['email']}),_0x2adeb9=await master_shop['find']();let _0x44d6f5;if(_0x1a16fd[_0x471e56(0x1e3)]==_0x471e56(0x212)){const _0x458722=await staff[_0x471e56(0x171)]({'email':_0x1a16fd['email']});_0x44d6f5=await warehouse['aggregate']([{'$match':{'status':_0x471e56(0x1ca),'name':_0x458722['warehouse'],'warehouse_category':_0x471e56(0x14e),'name':{'$ne':_0x471e56(0x1b6)}}},{'$group':{'_id':_0x471e56(0x189),'name':{'$first':_0x471e56(0x189)}}}]);}else _0x44d6f5=await warehouse[_0x471e56(0x190)]([{'$match':{'status':'Enabled','warehouse_category':_0x471e56(0x14e),'name':{'$ne':_0x471e56(0x1b6)}}},{'$group':{'_id':_0x471e56(0x189),'name':{'$first':_0x471e56(0x189)}}}]);const _0x390d79=await transfers_finished['find']({}),_0x3bf282=_0x390d79[_0x471e56(0x1f4)]+0x1,_0x2b7228=_0x471e56(0x1a4)+_0x3bf282['toString']()['padStart'](0x5,'0');if(_0x2adeb9[0x0]['language']==_0x471e56(0x1dc))var _0x2e6058=users[_0x471e56(0x21a)];else{if(_0x2adeb9[0x0]['language']==_0x471e56(0x14d))var _0x2e6058=users[_0x471e56(0x14d)];else{if(_0x2adeb9[0x0][_0x471e56(0x1de)]==_0x471e56(0x15e))var _0x2e6058=users[_0x471e56(0x15e)];else{if(_0x2adeb9[0x0][_0x471e56(0x1de)]=='Spanish')var _0x2e6058=users[_0x471e56(0x18a)];else{if(_0x2adeb9[0x0][_0x471e56(0x1de)]==_0x471e56(0x1e4))var _0x2e6058=users[_0x471e56(0x1e4)];else{if(_0x2adeb9[0x0][_0x471e56(0x1de)]=='Portuguese\x20(BR)')var _0x2e6058=users[_0x471e56(0x211)];else{if(_0x2adeb9[0x0][_0x471e56(0x1de)]==_0x471e56(0x178))var _0x2e6058=users[_0x471e56(0x178)];else{if(_0x2adeb9[0x0]['language']==_0x471e56(0x176))var _0x2e6058=users['Arabic'];}}}}}}}const _0x170f32=getRandom8DigitNumber();_0x170f32[_0x471e56(0x166)](_0x565aba=>{var _0x32b172=_0x471e56;_0x403d60['render'](_0x32b172(0x20c),{'success':_0x4de16b[_0x32b172(0x205)](_0x32b172(0x216)),'errors':_0x4de16b['flash'](_0x32b172(0x1d1)),'role':_0x1a16fd,'profile':_0x2c475d,'master_shop':_0x2adeb9,'warehouse':_0x44d6f5,'language':_0x2e6058,'invoice':_0x565aba});})['catch'](_0x5463f0=>{var _0x5b78b0=_0x471e56;_0x4de16b[_0x5b78b0(0x205)](_0x5b78b0(0x1d1),_0x5b78b0(0x1ff)),_0x403d60['redirect'](_0x5b78b0(0x215));});}catch(_0xd0250e){console[_0x471e56(0x15a)](_0xd0250e);}}),router[a0_0x336b7e(0x17d)](a0_0x336b7e(0x1ea),auth,async(_0x32614e,_0x4b3f00)=>{var _0x577070=a0_0x336b7e;try{const {date:_0x4d16b1,from_warehouse:_0xcea565,FromRoom_name:_0x424019,to_warehouse:_0x503d90,ToRoom_name:_0x5f5768,prod_name:_0x536a55,from_prod_qty:_0x1fe6ed,from_prod_level:_0x3d6227,from_prod_isle:_0x31f3e8,from_prod_pallet:_0x586ec5,to_prod_qty:_0x130c0e,to_prod_level:_0xe9d2e9,to_prod_isle:_0x48385a,to_prod_pallet:_0x191c80,primary_code:_0x3641a4,secondary_code:_0x3f2927,product_code3:_0x41a237,note:_0x3e5865,MaxStocks_data2:_0x4e2d8a,invoice:_0x403978,expiry_date:_0x43a607}=_0x32614e[_0x577070(0x200)];if(typeof _0x536a55=='string')var _0xcea127=[_0x32614e[_0x577070(0x200)]['prod_name']],_0x2e61d4=[_0x32614e['body']['from_prod_qty']],_0x31064b=[_0x32614e['body'][_0x577070(0x1ed)]],_0x5ce502=[_0x32614e['body'][_0x577070(0x16a)]],_0xbece54=[_0x32614e[_0x577070(0x200)][_0x577070(0x1cb)]],_0x27c1d1=[_0x32614e['body']['primary_code']],_0x4928bc=[_0x32614e[_0x577070(0x200)][_0x577070(0x158)]],_0x4dbed7=[_0x32614e[_0x577070(0x200)][_0x577070(0x1a2)]],_0x349e8c=[_0x32614e['body']['MaxStocks_data2']],_0x560687=[_0x32614e[_0x577070(0x200)][_0x577070(0x162)]],_0x26acff=[_0x32614e['body'][_0x577070(0x1a1)]],_0xb9b372=[_0x32614e['body']['batch_code']],_0x3408bb=[_0x32614e[_0x577070(0x200)][_0x577070(0x217)]],_0x38dbc0=[_0x32614e[_0x577070(0x200)]['product_date']],_0x22cdf6=[_0x32614e[_0x577070(0x200)][_0x577070(0x1c4)]],_0x1f5b9a=[_0x32614e[_0x577070(0x200)][_0x577070(0x1f6)]],_0x48f309=[_0x32614e['body'][_0x577070(0x1be)]],_0x16613a=[_0x32614e[_0x577070(0x200)]['RoomAssigned']],_0x508417=[_0x32614e['body'][_0x577070(0x1fa)]],_0x4e3cfe=[_0x32614e['body'][_0x577070(0x1b8)]],_0x1aa0c8=[_0x32614e[_0x577070(0x200)][_0x577070(0x201)]];else var _0xcea127=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1dd)]],_0x2e61d4=[..._0x32614e[_0x577070(0x200)][_0x577070(0x21d)]],_0x31064b=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1ed)]],_0x5ce502=[..._0x32614e[_0x577070(0x200)][_0x577070(0x16a)]],_0xbece54=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1cb)]],_0x27c1d1=[..._0x32614e['body']['primary_code']],_0x4928bc=[..._0x32614e[_0x577070(0x200)][_0x577070(0x158)]],_0x4dbed7=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1a2)]],_0x349e8c=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1ee)]],_0x560687=[..._0x32614e['body']['primary_unit']],_0x26acff=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1a1)]],_0xb9b372=[..._0x32614e[_0x577070(0x200)]['batch_code']],_0x3408bb=[..._0x32614e[_0x577070(0x200)][_0x577070(0x217)]],_0x38dbc0=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1fc)]],_0x22cdf6=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1c4)]],_0x1f5b9a=[..._0x32614e[_0x577070(0x200)][_0x577070(0x1f6)]],_0x48f309=[..._0x32614e['body'][_0x577070(0x1be)]],_0x16613a=[..._0x32614e[_0x577070(0x200)]['RoomAssigned']],_0x508417=[..._0x32614e['body']['ToRoomAssigned']],_0x4e3cfe=[..._0x32614e['body']['from_invoice']],_0x1aa0c8=[..._0x32614e[_0x577070(0x200)]['to_invoice']];const _0x5e4d47=_0xcea127['map'](_0x27d9bc=>{return _0x27d9bc={'product_name':_0x27d9bc};});_0x2e61d4[_0x577070(0x1b5)]((_0x1ecf0c,_0x31393e)=>{var _0xb7db88=_0x577070;_0x5e4d47[_0x31393e][_0xb7db88(0x17f)]=_0x1ecf0c;}),_0x31064b[_0x577070(0x1b5)]((_0x1bccd6,_0x5349f5)=>{_0x5e4d47[_0x5349f5]['from_bay']=_0x1bccd6;}),_0x4e3cfe['forEach']((_0xf15b40,_0x439b10)=>{_0x5e4d47[_0x439b10]['from_invoice']=_0xf15b40;}),_0x1aa0c8[_0x577070(0x1b5)]((_0x46f267,_0x1db6a3)=>{_0x5e4d47[_0x1db6a3]['To_invoice']=_0x46f267;}),_0x5ce502[_0x577070(0x1b5)]((_0x31c194,_0x467c7a)=>{_0x5e4d47[_0x467c7a]['to_quantity']=_0x31c194;}),_0xbece54[_0x577070(0x1b5)]((_0x44d27d,_0x378c5d)=>{var _0x3197a0=_0x577070;_0x5e4d47[_0x378c5d][_0x3197a0(0x183)]=_0x44d27d;}),_0x27c1d1['forEach']((_0x6ddc3a,_0x225f03)=>{var _0x39b8bd=_0x577070;_0x5e4d47[_0x225f03][_0x39b8bd(0x14b)]=_0x6ddc3a;}),_0x4928bc[_0x577070(0x1b5)]((_0x28bd93,_0x44dd90)=>{var _0x5189a6=_0x577070;_0x5e4d47[_0x44dd90][_0x5189a6(0x158)]=_0x28bd93;}),_0x4dbed7[_0x577070(0x1b5)]((_0x1ee3ad,_0xa8cca5)=>{var _0x5bad00=_0x577070;_0x5e4d47[_0xa8cca5][_0x5bad00(0x1f9)]=_0x1ee3ad;}),_0x349e8c[_0x577070(0x1b5)]((_0x53fb66,_0xac9e76)=>{_0x5e4d47[_0xac9e76]['maxProducts']=_0x53fb66;}),_0x560687[_0x577070(0x1b5)]((_0x3a857f,_0x4b4601)=>{var _0x4f5b41=_0x577070;_0x5e4d47[_0x4b4601][_0x4f5b41(0x1c2)]=_0x3a857f;}),_0x26acff[_0x577070(0x1b5)]((_0x37dd3b,_0x5654a8)=>{var _0x1fa90a=_0x577070;_0x5e4d47[_0x5654a8][_0x1fa90a(0x1a1)]=_0x37dd3b;}),_0xb9b372[_0x577070(0x1b5)]((_0x3fe846,_0x5b8578)=>{_0x5e4d47[_0x5b8578]['batch_code']=_0x3fe846;}),_0x3408bb['forEach']((_0xca34d6,_0x348d23)=>{_0x5e4d47[_0x348d23]['expiry_date']=_0xca34d6;}),_0x38dbc0[_0x577070(0x1b5)]((_0x3cbe18,_0x4503a3)=>{_0x5e4d47[_0x4503a3]['production_date']=_0x3cbe18;}),_0x22cdf6[_0x577070(0x1b5)]((_0x307396,_0x51531f)=>{var _0x184f84=_0x577070;_0x5e4d47[_0x51531f][_0x184f84(0x194)]=_0x307396;}),_0x1f5b9a[_0x577070(0x1b5)]((_0x798806,_0x1f65e1)=>{var _0x38647b=_0x577070;_0x5e4d47[_0x1f65e1][_0x38647b(0x1f6)]=_0x798806;}),_0x48f309['forEach']((_0x4ea865,_0x2ecce6)=>{_0x5e4d47[_0x2ecce6]['prod_cat']=_0x4ea865;}),_0x16613a['forEach']((_0x35d471,_0x1b25a3)=>{var _0x1bb9fc=_0x577070;_0x5e4d47[_0x1b25a3][_0x1bb9fc(0x18c)]=_0x35d471;}),_0x508417[_0x577070(0x1b5)]((_0x2ad0c2,_0x17f12)=>{var _0x52450a=_0x577070;_0x5e4d47[_0x17f12][_0x52450a(0x16b)]=_0x2ad0c2;});const _0x366c4d=_0x5e4d47['filter'](_0x3c8949=>_0x3c8949[_0x577070(0x172)]!=='0'&&_0x3c8949[_0x577070(0x172)]!==''||_0x3c8949['to_floorlevel']!=='0'&&_0x3c8949[_0x577070(0x19e)]!=='');var _0xaff095=0x0;_0x366c4d[_0x577070(0x1b5)](_0xc3ae43=>{var _0x5ecc0b=_0x577070;parseInt(_0xc3ae43[_0x5ecc0b(0x17f)])<parseInt(_0xc3ae43[_0x5ecc0b(0x172)])&&_0xaff095++;});if(_0xaff095!=0x0)return _0x32614e['flash'](_0x577070(0x1d1),_0x577070(0x169)),_0x4b3f00[_0x577070(0x1ef)](_0x577070(0x16f));const _0xfd1155=new transfers_finished({'date':_0x4d16b1,'from_warehouse':_0xcea565,'to_warehouse':_0x503d90,'product':_0x366c4d,'note':_0x3e5865,'invoice':_0x403978}),_0x1e5484=await _0xfd1155['save']();_0x32614e[_0x577070(0x205)](_0x577070(0x216),'Product\x20Transfer\x20successfully'),_0x4b3f00[_0x577070(0x1ef)](_0x577070(0x15f)+_0x1e5484[_0x577070(0x1df)]);}catch(_0x2716a6){console[_0x577070(0x15a)](_0x2716a6),_0x4b3f00['status'](0xc8)[_0x577070(0x156)]({'errorMessage':_0x2716a6['message']});}}),router[a0_0x336b7e(0x20b)](a0_0x336b7e(0x213),auth,async(_0x38fed0,_0x1040a2)=>{var _0x5271eb=a0_0x336b7e;try{const {username:_0x44c671,email:_0x54382d,role:_0x39306d}=_0x38fed0[_0x5271eb(0x197)],_0x27601c=_0x38fed0[_0x5271eb(0x197)],_0xa26326=await profile['findOne']({'email':_0x27601c[_0x5271eb(0x157)]}),_0x25be12=await master_shop[_0x5271eb(0x207)](),_0x28dd8f=await transfers_finished[_0x5271eb(0x1d0)](_0x38fed0['params']['id']);let _0xce9ce4;if(_0x27601c[_0x5271eb(0x1e3)]==_0x5271eb(0x212)){const _0x2b44c6=await staff[_0x5271eb(0x171)]({'email':_0x27601c[_0x5271eb(0x157)]});_0xce9ce4=await warehouse[_0x5271eb(0x207)]({'status':_0x5271eb(0x1ca),'name':_0x2b44c6[_0x5271eb(0x1aa)],'warehouse_category':_0x5271eb(0x14e)});}else _0xce9ce4=await warehouse[_0x5271eb(0x207)]({'status':_0x5271eb(0x1ca),'warehouse_category':_0x5271eb(0x14e)});const _0x495531=await warehouse[_0x5271eb(0x190)]([{'$match':{'name':_0x28dd8f[_0x5271eb(0x1e7)],'warehouse_category':_0x5271eb(0x14e)}},{'$unwind':_0x5271eb(0x199)},{'$group':{'_id':_0x5271eb(0x165),'name':{'$first':_0x5271eb(0x17c)},'product_stock':{'$first':_0x5271eb(0x16c)},'bay':{'$first':_0x5271eb(0x21b)},'bin':{'$first':_0x5271eb(0x1e9)},'type':{'$first':_0x5271eb(0x1b1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5271eb(0x203)},'product_code':{'$first':_0x5271eb(0x186)},'storage':{'$first':_0x5271eb(0x17a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5271eb(0x173)},'production_date':{'$first':_0x5271eb(0x1f2)},'room':{'$first':_0x5271eb(0x18b)},'warehoue_name':{'$first':'$name'}}}]),_0x1c4e0c=await product[_0x5271eb(0x207)]({});if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x1dc)){var _0x16eda9=users['English'];console['log'](_0x16eda9);}else{if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x14d))var _0x16eda9=users[_0x5271eb(0x14d)];else{if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x15e))var _0x16eda9=users['German'];else{if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x18a))var _0x16eda9=users[_0x5271eb(0x18a)];else{if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x1e4))var _0x16eda9=users[_0x5271eb(0x1e4)];else{if(_0x25be12[0x0]['language']=='Portuguese\x20(BR)')var _0x16eda9=users[_0x5271eb(0x211)];else{if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x178))var _0x16eda9=users['Chinese'];else{if(_0x25be12[0x0][_0x5271eb(0x1de)]==_0x5271eb(0x176))var _0x16eda9=users['Arabic'];}}}}}}}_0x1040a2[_0x5271eb(0x1a6)](_0x5271eb(0x1da),{'success':_0x38fed0['flash']('success'),'errors':_0x38fed0[_0x5271eb(0x205)](_0x5271eb(0x1d1)),'role':_0x27601c,'profile':_0xa26326,'master_shop':_0x25be12,'warehouse':_0xce9ce4,'transfer':_0x28dd8f,'stock':_0x495531,'unit':_0x1c4e0c,'language':_0x16eda9});}catch(_0x4dab62){console[_0x5271eb(0x15a)](_0x4dab62);}}),router[a0_0x336b7e(0x17d)](a0_0x336b7e(0x213),auth,async(_0x2c7b97,_0x30e6b5)=>{var _0xbe7ba3=a0_0x336b7e;try{const {invoice:_0x4b990d,from_warehouse:_0x13e0d9,FromRoom_name:_0x565fb0,to_warehouse:_0x12cf9a,ToRoom_name:_0x258546}=_0x2c7b97[_0xbe7ba3(0x200)],_0x33284b=await transfers_finished[_0xbe7ba3(0x1d0)](_0x2c7b97[_0xbe7ba3(0x19a)]['id']),_0x4c3ebb=_0x33284b[_0xbe7ba3(0x1f8)][_0xbe7ba3(0x1bb)](async _0x49a6e7=>{var _0x493a8b=_0xbe7ba3;if(_0x49a6e7[_0x493a8b(0x172)]>0x0){var _0x9a619b=await warehouse[_0x493a8b(0x171)]({'name':_0x13e0d9,'room':_0x49a6e7[_0x493a8b(0x18c)],'warehouse_category':_0x493a8b(0x14e)});const _0x50a34e=_0x9a619b[_0x493a8b(0x20a)][_0x493a8b(0x1bb)](_0x2a254a=>{var _0x2833fa=_0x493a8b;_0x2a254a[_0x2833fa(0x15b)]==_0x49a6e7[_0x2833fa(0x15b)]&&_0x2a254a[_0x2833fa(0x163)]==_0x49a6e7['from_bay']&&_0x2a254a[_0x2833fa(0x217)]==_0x49a6e7[_0x2833fa(0x217)]&&_0x2a254a[_0x2833fa(0x1af)]==_0x49a6e7[_0x2833fa(0x1af)]&&_0x2a254a[_0x2833fa(0x19d)]==_0x49a6e7[_0x2833fa(0x19d)]&&_0x2a254a[_0x2833fa(0x184)]==_0x49a6e7[_0x2833fa(0x1b8)]&&(_0x2a254a[_0x2833fa(0x20d)]=_0x2a254a[_0x2833fa(0x20d)]-_0x49a6e7['to_quantity']);});}return _0x9a619b;});Promise[_0xbe7ba3(0x18e)](_0x4c3ebb)[_0xbe7ba3(0x166)](async _0x3a1228=>{var _0x5a6a7c=_0xbe7ba3;try{for(const _0x3a21bf of _0x3a1228){await _0x3a21bf['save']();}const _0xabc464=_0x33284b[_0x5a6a7c(0x1f8)][_0x5a6a7c(0x1bb)](async _0x39bbb6=>{var _0xe3372b=_0x5a6a7c,_0x35cbd5=await warehouse[_0xe3372b(0x171)]({'name':_0x12cf9a,'room':_0x39bbb6[_0xe3372b(0x16b)]});if(_0x39bbb6[_0xe3372b(0x172)]>0x0){var _0x1d5e03=0x0;const _0x5dc6f4=_0x35cbd5['product_details']['map'](_0x325bf5=>{var _0x5d96b3=_0xe3372b;_0x325bf5[_0x5d96b3(0x15b)]==_0x39bbb6[_0x5d96b3(0x15b)]&&_0x325bf5[_0x5d96b3(0x163)]==_0x39bbb6[_0x5d96b3(0x183)]&&_0x325bf5[_0x5d96b3(0x217)]==_0x39bbb6[_0x5d96b3(0x217)]&&_0x325bf5[_0x5d96b3(0x1af)]==_0x39bbb6[_0x5d96b3(0x1af)]&&_0x325bf5[_0x5d96b3(0x19d)]==_0x39bbb6['batch_code']&&_0x325bf5[_0x5d96b3(0x184)]==_0x39bbb6[_0x5d96b3(0x1bc)]&&(_0x325bf5[_0x5d96b3(0x20d)]=_0x325bf5[_0x5d96b3(0x20d)]+_0x39bbb6[_0x5d96b3(0x172)],_0x1d5e03++);});_0x1d5e03=='0'&&(_0x35cbd5['product_details']=_0x35cbd5[_0xe3372b(0x20a)][_0xe3372b(0x214)]({'product_name':_0x39bbb6[_0xe3372b(0x15b)],'product_stock':_0x39bbb6['to_quantity'],'bay':_0x39bbb6[_0xe3372b(0x183)],'product_code':_0x39bbb6[_0xe3372b(0x1f9)],'primary_code':_0x39bbb6[_0xe3372b(0x14b)],'secondary_code':_0x39bbb6[_0xe3372b(0x158)],'expiry_date':_0x39bbb6[_0xe3372b(0x217)],'production_date':_0x39bbb6['production_date'],'maxProducts':_0x39bbb6[_0xe3372b(0x194)],'batch_code':_0x39bbb6[_0xe3372b(0x19d)],'secondary_unit':_0x39bbb6['secondary_unit'],'unit':_0x39bbb6['unit'],'maxProducts':_0x39bbb6[_0xe3372b(0x194)],'maxPerUnit':_0x39bbb6[_0xe3372b(0x1f6)],'invoice':_0x39bbb6['To_invoice']}));}return _0x35cbd5;});Promise[_0x5a6a7c(0x18e)](_0xabc464)[_0x5a6a7c(0x166)](async _0xe1fdc1=>{var _0x116f34=_0x5a6a7c;try{for(const _0x3f830d of _0xe1fdc1){await warehouse[_0x116f34(0x1a5)]({'_id':_0x3f830d['_id']},{'$addToSet':{'product_details':{'$each':_0x3f830d[_0x116f34(0x20a)]}}});}_0x33284b[_0x116f34(0x1c7)]=_0x116f34(0x188);const _0x4363a8=await _0x33284b[_0x116f34(0x179)](),_0x44fe10=await master_shop[_0x116f34(0x207)](),_0x2f43a7=await email_settings['findOne'](),_0xf5653d=await supervisor_settings[_0x116f34(0x207)]();var _0x357e09=_0x33284b[_0x116f34(0x1f8)],_0x5805c8='',_0x189538;for(_0x189538 in _0x357e09){var _0x55d076='FG';_0x33284b[_0x116f34(0x168)]=='DRY\x20GOODS'&&(_0x55d076='DG'),_0x5805c8+=_0x116f34(0x1e2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x357e09[_0x189538]['product_name']+_0x116f34(0x192)+_0x116f34(0x1e1)+_0x357e09[_0x189538][_0x116f34(0x1f9)]+_0x116f34(0x192)+_0x116f34(0x1e1)+_0x357e09[_0x189538][_0x116f34(0x172)]+_0x116f34(0x192)+_0x116f34(0x1e1)+_0x357e09[_0x189538][_0x116f34(0x1c2)]+_0x116f34(0x192)+_0x116f34(0x1e1)+_0x357e09[_0x189538]['secondary_unit']+_0x116f34(0x192)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x33284b[_0x116f34(0x168)]+'</td>'+_0x116f34(0x1e1)+_0x357e09[_0x189538][_0x116f34(0x16b)]+_0x116f34(0x192)+_0x116f34(0x1e1)+_0x55d076+_0x357e09[_0x189538][_0x116f34(0x183)]+_0x116f34(0x192)+_0x116f34(0x20f);}let _0x528aa9=nodemailer[_0x116f34(0x14f)]({'host':_0x2f43a7[_0x116f34(0x175)],'port':Number(_0x2f43a7[_0x116f34(0x219)]),'secure':![],'auth':{'user':_0x2f43a7[_0x116f34(0x157)],'pass':_0x2f43a7[_0x116f34(0x1c1)]}}),_0xa43fe6={'from':_0x2f43a7[_0x116f34(0x157)],'to':_0xf5653d[0x0]['FGSEmail'],'subject':_0x116f34(0x151),'attachments':[{'filename':_0x116f34(0x1f7),'path':__dirname+_0x116f34(0x1d8)+_0x116f34(0x19c)+_0x44fe10[0x0][_0x116f34(0x1a7)],'cid':_0x116f34(0x153)}],'html':_0x116f34(0x164)+_0x116f34(0x170)+_0x116f34(0x1d2)+'<div>'+_0x116f34(0x1f0)+_0x116f34(0x21f)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x116f34(0x18f)+_0x44fe10[0x0][_0x116f34(0x1db)]+_0x116f34(0x1d6)+_0x116f34(0x1cc)+_0x116f34(0x1cc)+_0x116f34(0x1fd)+_0x116f34(0x21f)+_0x116f34(0x16e)+'\x20Order\x20Number\x20:\x20'+_0x33284b[_0x116f34(0x184)]+'\x20'+_0x116f34(0x1b0)+'\x20Order\x20Date\x20:\x20'+_0x33284b['date']+'\x20'+_0x116f34(0x1f3)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x116f34(0x204)+_0x116f34(0x1e2)+_0x116f34(0x185)+_0x116f34(0x182)+_0x116f34(0x1a9)+_0x116f34(0x1eb)+_0x116f34(0x1a8)+_0x116f34(0x1c5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x116f34(0x14c)+_0x116f34(0x20f)+_0x116f34(0x191)+_0x116f34(0x1b7)+'\x20'+_0x5805c8+'\x20'+_0x116f34(0x1d3)+'</table>'+_0x116f34(0x21f)+_0x116f34(0x19f)+_0x116f34(0x154)+_0x44fe10[0x0][_0x116f34(0x1db)]+_0x116f34(0x1e6)+_0x116f34(0x1cc)+_0x116f34(0x1cc)+_0x116f34(0x1bd)};_0x528aa9['sendMail'](_0xa43fe6,function(_0x3898ba,_0x285aca){var _0x4f7339=_0x116f34;_0x3898ba?(console['log'](_0x3898ba),console[_0x4f7339(0x15a)](_0x4f7339(0x155))):console[_0x4f7339(0x15a)](_0x4f7339(0x1ab));}),_0x2c7b97[_0x116f34(0x205)](_0x116f34(0x216),_0x116f34(0x1b4)),_0x30e6b5[_0x116f34(0x1ef)]('/picking_list/PDF_transfer/'+_0x4363a8[_0x116f34(0x1df)]);}catch(_0x2e9d3e){console[_0x116f34(0x198)](_0x2e9d3e),_0x30e6b5[_0x116f34(0x181)](0x1f4)[_0x116f34(0x156)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x255228=>{var _0x5432de=_0x5a6a7c;console[_0x5432de(0x198)](_0x255228),_0x30e6b5[_0x5432de(0x181)](0x1f4)[_0x5432de(0x156)]({'error':_0x5432de(0x177)});});}catch(_0x134f15){console[_0x5a6a7c(0x198)](_0x134f15),_0x30e6b5['status'](0x1f4)[_0x5a6a7c(0x156)]({'error':_0x5a6a7c(0x15c)});}})[_0xbe7ba3(0x210)](_0x366f8c=>{var _0x3724a3=_0xbe7ba3;console['error'](_0x366f8c),_0x30e6b5[_0x3724a3(0x181)](0x1f4)[_0x3724a3(0x156)]({'error':'An\x20error\x20occurred.'});});}catch(_0x2c6bc0){_0x30e6b5[_0xbe7ba3(0x156)]({'message':_0x2c6bc0[_0xbe7ba3(0x21c)]});}});function BayBinSelected(_0x40921b,_0x20e0bb){var _0x59fca1=a0_0x336b7e,_0x9d4577=[];let _0x149d06=[];var _0x579eb7=[];if(_0x40921b==_0x59fca1(0x160)){switch(_0x20e0bb){case _0x59fca1(0x14a):_0x9d4577=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x59fca1(0x1bf):_0x9d4577=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x579eb7=['DG'];}else{if(_0x40921b==_0x59fca1(0x1c9)){switch(_0x20e0bb){case'Rack\x201':_0x9d4577=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x59fca1(0x1bf):_0x9d4577=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x579eb7=['FG'];}}return{'levels':_0x9d4577,'identify':_0x579eb7};}function a0_0x12e9(){var _0xd2a591=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','to_bay','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.product_code','$invoice','True','$name','Spanish','$room','from_room_name','$product_details.batch_code','all','<h2>\x20','aggregate','</thead>','</td>','18SxfnTF','maxProducts','filter','/view/:id','user','error','$product_details','params','1091637Naxutp','/upload/','batch_code','to_floorlevel','<strong>\x20Regards\x20</strong>','/barcode_scanner','secondary_unit','product_code3','$product','TRFF-','updateOne','render','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','warehouse','Email\x20sent\x20successfully','$product_details.level','to_room','$date','production_date','<span\x20style=\x22float:\x20right;\x22>','$product_details.type','/barcode_scanner2','$product_details.maxProducts','Transfer\x20Finalize\x20Successfully','forEach','QA\x20Warehouse','<tbody\x20style=\x22text-align:\x20center;\x22>','from_invoice','$_id','$product_details.isle','map','To_invoice','</body></html>','prod_cat','Rack\x202','Ambient','password','unit','Enclosed','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$to_warehouse','finalize','$product_details.pallet','FROZEN\x20GOODS','Enabled','to_prod_level','</div>','$product.from_room_name','../models/all_models','../middleware/auth','findById','errors','</head><body>','</tbody>','33365MgcGlo','$product_details.invoice','\x20</h2>','$product_details.maxPerUnit','/../public','$product_details.unit','edit_transfer_finished_view','site_title','English\x20(US)','prod_name','language','_id','/CheckingWarehouse','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<tr>','role','French','to_prod_qty','</h5>','from_warehouse','/view','$product_details.bin','/view/add_transfer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$from_warehouse','from_prod_level','MaxStocks_data2','redirect','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','1164480mrSJGP','$product_details.production_date','</span>','length','transfer_finished','maxPerUnit','Logo.png','product','product_code','ToRoomAssigned','/transfer_finished/view','product_date','<hr\x20class=\x22my-3\x22>','468244qkKxeN','There\x27s\x20a\x20error\x20in\x20this\x20transaction','body','to_invoice','$product_details.secondary_unit','$product_details.secondary_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','flash','236LEMnKz','find','$product_details.floorlevel','express','product_details','get','add_transfer_finished','product_stock','$product_details.primary_code','</tr>','catch','Portuguese','staff','/preview/:id','concat','/transfer/view','success','expiry_date','date','port','English','$product_details.bay','message','from_prod_qty','push','<div>','slice','getDate','Arabic','Rack\x201','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Hindi','Finished\x20Goods','createTransport','243aronJs','Transfer\x20Mail','getFullYear','logo','<h5>','Error\x20Occurs','json','email','secondary_code','521680BOcpHM','log','product_name','An\x20error\x20occurred\x20while\x20saving\x20data.','random','German','/transfer_finished/preview/','DRY\x20GOODS','130376MfgcRa','primary_unit','bay','<!DOCTYPE\x20html>','$product_details._id','then','getMonth','to_warehouse','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','New_Qty_Converted','to_room_name','$product_details.product_stock','from_bay','<h5\x20style=\x22text-align:\x20left;\x22>','back','<html><head><title></title>','findOne','to_quantity','$product_details.expiry_date','../public/language/languages.json','host','Arabic\x20(ae)','An\x20error\x20occurred.','Chinese','save','$product_details.storage','$product_details.rack','$product_details.product_name','post','116275wimWHP','from_quantity','exports','status'];a0_0x12e9=function(){return _0xd2a591;};return a0_0x12e9();}router['get']('/view/:id',auth,async(_0x15abfb,_0x1fb729)=>{var _0x40119d=a0_0x336b7e;try{const {username:_0x442d2c,email:_0x6d6ad6,role:_0x2dd4ac}=_0x15abfb['user'],_0x1e5836=_0x15abfb[_0x40119d(0x197)],_0x12fb28=await profile[_0x40119d(0x171)]({'email':_0x1e5836[_0x40119d(0x157)]}),_0x566ba7=await master_shop[_0x40119d(0x207)](),_0x4ecbb0=await transfers_finished[_0x40119d(0x1d0)](_0x15abfb[_0x40119d(0x19a)]['id']);let _0x4fa9a5=new Date(_0x4ecbb0[_0x40119d(0x217)]),_0x2de6bc=('0'+_0x4fa9a5[_0x40119d(0x221)]())[_0x40119d(0x220)](-0x2),_0xd9e12=('0'+(_0x4fa9a5[_0x40119d(0x167)]()+0x1))[_0x40119d(0x220)](-0x2),_0x3b13e7=_0x4fa9a5[_0x40119d(0x152)](),_0x372691=_0x3b13e7+'-'+_0xd9e12+'-'+_0x2de6bc,_0x4e5958;if(_0x1e5836[_0x40119d(0x1e3)]==_0x40119d(0x212)){const _0x321116=await staff[_0x40119d(0x171)]({'email':_0x1e5836[_0x40119d(0x157)]});_0x4e5958=await warehouse[_0x40119d(0x207)]({'status':_0x40119d(0x1ca),'name':_0x321116['warehouse'],'warehouse_category':_0x40119d(0x14e)});}else _0x4e5958=await warehouse['find']({'status':_0x40119d(0x1ca),'warehouse_category':_0x40119d(0x14e)});const _0x30acd9=await warehouse['aggregate']([{'$match':{'name':_0x4ecbb0[_0x40119d(0x1e7)],'room':_0x4ecbb0['from_room']}},{'$unwind':_0x40119d(0x199)},{'$group':{'_id':_0x40119d(0x165),'name':{'$first':_0x40119d(0x17c)},'product_stock':{'$first':_0x40119d(0x16c)},'bay':{'$first':_0x40119d(0x21b)},'bin':{'$first':_0x40119d(0x1e9)},'type':{'$first':_0x40119d(0x1b1)},'floorlevel':{'$first':_0x40119d(0x208)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x40119d(0x203)},'product_code':{'$first':_0x40119d(0x186)},'storage':{'$first':_0x40119d(0x17a)},'rack':{'$first':_0x40119d(0x17b)}}}]);var _0x35b1a7=[0x1,0x2,0x3,0x4],_0x35e819=['A','B','C','D','E','F','G','H','I','J'],_0x2d0a22=[_0x40119d(0x1c0),_0x40119d(0x1c3)];const _0x238ad9=await product['find']({}),_0x59773c=BayBinSelected(_0x4ecbb0['to_warehouse'],_0x4ecbb0['to_room']);if(_0x566ba7[0x0][_0x40119d(0x1de)]=='English\x20(US)'){var _0x5f4eed=users[_0x40119d(0x21a)];console[_0x40119d(0x15a)](_0x5f4eed);}else{if(_0x566ba7[0x0][_0x40119d(0x1de)]==_0x40119d(0x14d))var _0x5f4eed=users['Hindi'];else{if(_0x566ba7[0x0][_0x40119d(0x1de)]==_0x40119d(0x15e))var _0x5f4eed=users['German'];else{if(_0x566ba7[0x0]['language']==_0x40119d(0x18a))var _0x5f4eed=users['Spanish'];else{if(_0x566ba7[0x0]['language']==_0x40119d(0x1e4))var _0x5f4eed=users[_0x40119d(0x1e4)];else{if(_0x566ba7[0x0][_0x40119d(0x1de)]=='Portuguese\x20(BR)')var _0x5f4eed=users[_0x40119d(0x211)];else{if(_0x566ba7[0x0][_0x40119d(0x1de)]==_0x40119d(0x178))var _0x5f4eed=users[_0x40119d(0x178)];else{if(_0x566ba7[0x0][_0x40119d(0x1de)]=='Arabic\x20(ae)')var _0x5f4eed=users[_0x40119d(0x222)];}}}}}}}_0x1fb729[_0x40119d(0x1a6)]('edit_transfer_finished',{'success':_0x15abfb[_0x40119d(0x205)]('success'),'errors':_0x15abfb[_0x40119d(0x205)](_0x40119d(0x1d1)),'role':_0x1e5836,'profile':_0x12fb28,'master_shop':_0x566ba7,'warehouse':_0x4e5958,'transfer':_0x4ecbb0,'stock':_0x30acd9,'unit':_0x238ad9,'language':_0x5f4eed,'levels':_0x35b1a7,'Isle':_0x35e819,'rooms_data':_0x2d0a22,'ed_fullDate':_0x372691,'dataSelected':_0x59773c});}catch(_0x26aa1a){console[_0x40119d(0x15a)](_0x26aa1a);}}),router[a0_0x336b7e(0x17d)](a0_0x336b7e(0x196),auth,async(_0x1fd8af,_0x266c3f)=>{var _0x5aa6b8=a0_0x336b7e;try{const _0x2a24f5=_0x1fd8af[_0x5aa6b8(0x19a)]['id'];console['log'](_0x1fd8af[_0x5aa6b8(0x200)]);const _0x1bd450=await transfers_finished[_0x5aa6b8(0x1d0)](_0x2a24f5);console[_0x5aa6b8(0x15a)]('transfer_data',_0x1bd450);const {date:_0x263c8b,from_warehouse:_0x3c39c9,FromRoom_name:_0x280687,to_warehouse:_0xca60b2,ToRoom_name:_0xc49b28,prod_name:_0x3202ba,from_prod_qty:_0x5f17e1,from_prod_level:_0x2e722d,from_prod_isle:_0x1049a6,from_prod_pallet:_0x57609d,to_prod_qty:_0x46a215,to_prod_level:_0x1bbb7f,to_prod_isle:_0x494b2c,to_prod_pallet:_0x1a7ac3,primary_code:_0x4919ca,secondary_code:_0x38bc46,product_code3:_0x56d1b7,note:_0x11ad07,invoice:_0xba5c2f,expiry_date:_0x15f5ac}=_0x1fd8af[_0x5aa6b8(0x200)];if(typeof _0x3202ba=='string')var _0x5b29c7=[_0x1fd8af['body'][_0x5aa6b8(0x1dd)]],_0x5d99f7=[_0x1fd8af[_0x5aa6b8(0x200)]['from_prod_qty']],_0x4354be=[_0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1ed)]],_0x1974e8=[_0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1e5)]],_0x2c58a8=[_0x1fd8af[_0x5aa6b8(0x200)]['to_prod_level']],_0x5b2732=[_0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x14b)]],_0x2cecb7=[_0x1fd8af['body'][_0x5aa6b8(0x158)]],_0x2203df=[_0x1fd8af[_0x5aa6b8(0x200)]['product_code3']],_0x4fc53e=[_0x1fd8af['body'][_0x5aa6b8(0x1ee)]],_0x3434d4=[_0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1c2)]],_0x28c899=[_0x1fd8af['body'][_0x5aa6b8(0x1a1)]],_0x4a31cd=[_0x1fd8af['body'][_0x5aa6b8(0x19d)]],_0x5832c9=[_0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x217)]];else var _0x5b29c7=[..._0x1fd8af[_0x5aa6b8(0x200)]['prod_name']],_0x5d99f7=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x21d)]],_0x4354be=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1ed)]],_0x1974e8=[..._0x1fd8af['body']['to_prod_qty']],_0x2c58a8=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1cb)]],_0x5b2732=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x14b)]],_0x2cecb7=[..._0x1fd8af['body'][_0x5aa6b8(0x158)]],_0x2203df=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1a2)]],_0x4fc53e=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1ee)]],_0x3434d4=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x1c2)]],_0x28c899=[..._0x1fd8af[_0x5aa6b8(0x200)]['secondary_unit']],_0x4a31cd=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x19d)]],_0x5832c9=[..._0x1fd8af[_0x5aa6b8(0x200)][_0x5aa6b8(0x217)]];const _0x13dddb=_0x5b29c7[_0x5aa6b8(0x1bb)](_0x163f4e=>{return _0x163f4e={'product_name':_0x163f4e};});_0x5d99f7[_0x5aa6b8(0x1b5)]((_0x4c6dd4,_0x38c382)=>{var _0x46089a=_0x5aa6b8;_0x13dddb[_0x38c382][_0x46089a(0x17f)]=_0x4c6dd4;}),_0x4354be[_0x5aa6b8(0x1b5)]((_0x178e17,_0x472b21)=>{var _0x2daec4=_0x5aa6b8;_0x13dddb[_0x472b21][_0x2daec4(0x16d)]=_0x178e17;}),_0x1974e8[_0x5aa6b8(0x1b5)]((_0x41b73f,_0x496685)=>{var _0x5013c5=_0x5aa6b8;_0x13dddb[_0x496685][_0x5013c5(0x172)]=_0x41b73f;}),_0x2c58a8[_0x5aa6b8(0x1b5)]((_0x1df68b,_0x2cabd3)=>{_0x13dddb[_0x2cabd3]['to_bay']=_0x1df68b;}),_0x5b2732[_0x5aa6b8(0x1b5)]((_0x3480de,_0xe1f97f)=>{var _0x22ec4d=_0x5aa6b8;_0x13dddb[_0xe1f97f][_0x22ec4d(0x14b)]=_0x3480de;}),_0x2cecb7['forEach']((_0xddb789,_0x340891)=>{var _0x3e3ba0=_0x5aa6b8;_0x13dddb[_0x340891][_0x3e3ba0(0x158)]=_0xddb789;}),_0x2203df[_0x5aa6b8(0x1b5)]((_0x409d66,_0x5c09d0)=>{var _0x574044=_0x5aa6b8;_0x13dddb[_0x5c09d0][_0x574044(0x1f9)]=_0x409d66;}),_0x4fc53e[_0x5aa6b8(0x1b5)]((_0x96aadf,_0x153880)=>{var _0x38af46=_0x5aa6b8;_0x13dddb[_0x153880][_0x38af46(0x194)]=_0x96aadf;}),_0x3434d4['forEach']((_0x5c47cd,_0x53f282)=>{var _0x3cba0e=_0x5aa6b8;_0x13dddb[_0x53f282][_0x3cba0e(0x1c2)]=_0x5c47cd;}),_0x28c899[_0x5aa6b8(0x1b5)]((_0x54055d,_0x5d91c2)=>{var _0x584d5c=_0x5aa6b8;_0x13dddb[_0x5d91c2][_0x584d5c(0x1a1)]=_0x54055d;}),_0x4a31cd[_0x5aa6b8(0x1b5)]((_0x5dc056,_0x143eb0)=>{var _0x481378=_0x5aa6b8;_0x13dddb[_0x143eb0][_0x481378(0x19d)]=_0x5dc056;}),_0x5832c9['forEach']((_0x5b99cb,_0x5240f7)=>{_0x13dddb[_0x5240f7]['expiry_date']=_0x5b99cb;});const _0x46da76=_0x13dddb[_0x5aa6b8(0x195)](_0xb3225a=>_0xb3225a['to_quantity']!=='0'&&_0xb3225a['to_quantity']!==''||_0xb3225a[_0x5aa6b8(0x19e)]!=='0'&&_0xb3225a[_0x5aa6b8(0x19e)]!=='');var _0x3c7ede=0x0;_0x46da76[_0x5aa6b8(0x1b5)](_0x3b21f0=>{var _0x421f10=_0x5aa6b8;parseInt(_0x3b21f0[_0x421f10(0x17f)])<parseInt(_0x3b21f0[_0x421f10(0x172)])&&_0x3c7ede++;});if(_0x3c7ede!=0x0)return _0x1fd8af[_0x5aa6b8(0x205)](_0x5aa6b8(0x1d1),_0x5aa6b8(0x169)),_0x266c3f[_0x5aa6b8(0x1ef)](_0x5aa6b8(0x16f));const _0x582ffe=await warehouse[_0x5aa6b8(0x171)]({'name':_0x1bd450[_0x5aa6b8(0x1e7)],'room':_0x1bd450['from_room']});_0x1bd450[_0x5aa6b8(0x1f8)][_0x5aa6b8(0x1b5)](_0x23ec94=>{var _0x46ac2b=_0x5aa6b8;if(_0x23ec94['to_quantity']>0x0){const _0x116561=_0x582ffe[_0x46ac2b(0x20a)][_0x46ac2b(0x1bb)](_0x3c64ac=>{var _0x2dcdf5=_0x46ac2b;_0x3c64ac['product_name']==_0x23ec94[_0x2dcdf5(0x15b)]&&_0x3c64ac[_0x2dcdf5(0x163)]==_0x23ec94[_0x2dcdf5(0x16d)]&&(_0x3c64ac[_0x2dcdf5(0x20d)]=parseInt(_0x3c64ac[_0x2dcdf5(0x20d)])+parseInt(_0x23ec94[_0x2dcdf5(0x172)]));});}}),await _0x582ffe[_0x5aa6b8(0x179)]();const _0x3f122f=await warehouse[_0x5aa6b8(0x171)]({'name':_0x1bd450[_0x5aa6b8(0x168)],'room':_0x1bd450[_0x5aa6b8(0x1ad)]});_0x1bd450['product'][_0x5aa6b8(0x1b5)](_0x53b539=>{var _0x16ea51=_0x5aa6b8;if(_0x53b539[_0x16ea51(0x172)]>0x0){const _0x2542a0=_0x3f122f[_0x16ea51(0x20a)][_0x16ea51(0x1bb)](_0x47da1b=>{var _0x68377=_0x16ea51;_0x47da1b['product_name']==_0x53b539[_0x68377(0x15b)]&&_0x47da1b[_0x68377(0x163)]==_0x53b539[_0x68377(0x183)]&&(_0x47da1b[_0x68377(0x20d)]=parseInt(_0x47da1b[_0x68377(0x20d)])-parseInt(_0x53b539[_0x68377(0x172)]));});}}),await _0x3f122f[_0x5aa6b8(0x179)](),_0x1bd450[_0x5aa6b8(0x218)]=_0x263c8b,_0x1bd450['from_warehouse']=_0x3c39c9,_0x1bd450['to_warehouse']=_0xca60b2,_0x1bd450[_0x5aa6b8(0x1f8)]=_0x46da76,_0x1bd450['note']=_0x11ad07,_0x1bd450[_0x5aa6b8(0x184)]=_0xba5c2f;const _0x503813=await _0x1bd450[_0x5aa6b8(0x179)](),_0x4ab87f=await warehouse['findOne']({'name':_0x3c39c9,'room':_0x280687});_0x503813[_0x5aa6b8(0x1f8)][_0x5aa6b8(0x1b5)](_0x29a75b=>{var _0x586ee9=_0x5aa6b8;if(_0x29a75b[_0x586ee9(0x172)]>0x0){const _0x3df065=_0x4ab87f[_0x586ee9(0x20a)][_0x586ee9(0x1bb)](_0x3b5b99=>{var _0x5d539a=_0x586ee9;_0x3b5b99['product_name']==_0x29a75b['product_name']&&_0x3b5b99['bay']==_0x29a75b[_0x5d539a(0x16d)]&&(_0x3b5b99[_0x5d539a(0x20d)]=parseInt(_0x3b5b99[_0x5d539a(0x20d)])-parseInt(_0x29a75b['to_quantity']));});}}),await _0x4ab87f[_0x5aa6b8(0x179)]();const _0x1ceef8=await warehouse['findOne']({'name':_0xca60b2,'room':_0xc49b28});_0x503813[_0x5aa6b8(0x1f8)]['forEach'](_0x6a04d9=>{var _0x27a3b1=_0x5aa6b8;if(_0x6a04d9[_0x27a3b1(0x172)]>0x0){var _0x1380c7=0x0;const _0x344d67=_0x1ceef8[_0x27a3b1(0x20a)][_0x27a3b1(0x1bb)](_0xc1b8bf=>{var _0x4ee553=_0x27a3b1;_0xc1b8bf[_0x4ee553(0x15b)]==_0x6a04d9[_0x4ee553(0x15b)]&&_0xc1b8bf[_0x4ee553(0x163)]==_0x6a04d9[_0x4ee553(0x183)]&&(_0xc1b8bf[_0x4ee553(0x20d)]=parseInt(_0xc1b8bf[_0x4ee553(0x20d)])+parseInt(_0x6a04d9['to_quantity']),_0x1380c7++);});_0x1380c7=='0'&&(_0x1ceef8[_0x27a3b1(0x20a)]=_0x1ceef8[_0x27a3b1(0x20a)][_0x27a3b1(0x214)]({'product_name':_0x6a04d9[_0x27a3b1(0x15b)],'product_stock':_0x6a04d9['to_quantity'],'bay':_0x6a04d9['to_bay'],'product_code':_0x6a04d9['product_code'],'primary_code':_0x6a04d9['primary_code'],'secondary_code':_0x6a04d9['secondary_code'],'maxProducts':_0x6a04d9[_0x27a3b1(0x194)]}));}}),await _0x1ceef8[_0x5aa6b8(0x179)](),_0x1fd8af[_0x5aa6b8(0x205)](_0x5aa6b8(0x216),'Transfer\x20Edit\x20Successfully'),_0x266c3f[_0x5aa6b8(0x1ef)](_0x5aa6b8(0x1fb));}catch(_0x416c88){console[_0x5aa6b8(0x15a)](_0x416c88);}}),router[a0_0x336b7e(0x17d)](a0_0x336b7e(0x1a0),async(_0x109fd9,_0x198105)=>{var _0x3295d2=a0_0x336b7e;const {FromWareHouse:_0x1b12c7,FromRoom:_0x73ffc9,ToWarehouse:_0x26bcea,ToRoom:_0x2a48e3,primary_code:_0x419b9e,Roomslist:_0x4ed10b}=_0x109fd9[_0x3295d2(0x200)],_0x5a77da=_0x4ed10b['split'](','),_0x408e79=[];async function _0xa003ae(_0x3a8d09){var _0x320c45=_0x3295d2;const _0x37604a=await warehouse['aggregate']([{'$match':{'name':_0x1b12c7,'room':_0x3a8d09}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x419b9e}},{'$group':{'_id':_0x320c45(0x165),'name':{'$first':_0x320c45(0x17c)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x320c45(0x20e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x320c45(0x186)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x320c45(0x1e9)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x320c45(0x208)},'unit':{'$first':_0x320c45(0x1d9)},'secondary_unit':{'$first':_0x320c45(0x202)},'storage':{'$first':_0x320c45(0x17a)},'rack':{'$first':_0x320c45(0x17b)},'expiry_date':{'$first':_0x320c45(0x173)},'production_date':{'$first':_0x320c45(0x1f2)},'batch_code':{'$first':_0x320c45(0x18d)},'maxPerUnit':{'$first':_0x320c45(0x1d7)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x320c45(0x1d5)}}}]),_0x25bfbf=await warehouse[_0x320c45(0x190)]([{'$match':{'name':_0x1b12c7,'room':_0x3a8d09}},{'$unwind':_0x320c45(0x199)},{'$match':{'product_details.secondary_code':_0x419b9e}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x320c45(0x16c)},'primary_code':{'$first':_0x320c45(0x20e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x320c45(0x1b1)},'pallet':{'$first':_0x320c45(0x208)},'unit':{'$first':_0x320c45(0x1d9)},'secondary_unit':{'$first':_0x320c45(0x202)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x320c45(0x17b)},'expiry_date':{'$first':_0x320c45(0x173)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x320c45(0x1d7)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x320c45(0x1d5)}}}]);if(_0x37604a[_0x320c45(0x1f4)]>0x0)_0x408e79['push'](_0x37604a);else _0x25bfbf[_0x320c45(0x1f4)]>0x0&&_0x408e79[_0x320c45(0x21e)](_0x25bfbf);}const _0x2f07ef=_0x5a77da[_0x3295d2(0x1bb)](_0x5a38c5=>_0xa003ae(_0x5a38c5));await Promise[_0x3295d2(0x18e)](_0x2f07ef),_0x198105['json'](_0x408e79);}),router['post'](a0_0x336b7e(0x1b2),async(_0x25d82f,_0x492e9b)=>{var _0x4e60c6=a0_0x336b7e;try{const {FromWareHouse:_0xf1ece3,FromRoom:_0x1d11b7,ToWarehouse:_0xd842b9,ToRoom:_0x7d0d72,secondary_code:_0x1d1cab}=_0x25d82f[_0x4e60c6(0x200)],_0x2922d4=await warehouse[_0x4e60c6(0x190)]([{'$match':{'name':_0xf1ece3}},{'$unwind':_0x4e60c6(0x199)},{'$match':{'product_details.secondary_code':_0x1d1cab}},{'$group':{'_id':_0x4e60c6(0x165),'name':{'$first':_0x4e60c6(0x17c)},'primary_code':{'$first':_0x4e60c6(0x20e)},'secondary_code':{'$first':_0x4e60c6(0x203)},'product_code':{'$first':_0x4e60c6(0x186)},'instock':{'$first':_0x4e60c6(0x16c)},'warehouse':{'$first':'$name'},'level':{'$first':_0x4e60c6(0x1ac)},'isle':{'$first':_0x4e60c6(0x1ba)},'pallet':{'$first':_0x4e60c6(0x1c8)},'maxProducts':{'$first':_0x4e60c6(0x1b3)},'unit':{'$first':_0x4e60c6(0x1d9)},'expiry_date':{'$first':_0x4e60c6(0x173)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x492e9b[_0x4e60c6(0x181)](0xc8)[_0x4e60c6(0x156)](_0x2922d4);}catch(_0x51902b){_0x492e9b['status'](0x194)[_0x4e60c6(0x156)]({'message':_0x51902b[_0x4e60c6(0x21c)]});}}),router['post']('/barcode_scanner3',async(_0xec02ca,_0x2acae0)=>{var _0x5b2970=a0_0x336b7e;try{const {FromWareHouse:_0x295f3a,FromRoom:_0x42f593,ToWarehouse:_0x44a71a,ToRoom:_0x319fb4,product_code:_0x11ac69}=_0xec02ca['body'],_0x5bc247=await warehouse[_0x5b2970(0x190)]([{'$match':{'name':_0x295f3a}},{'$unwind':_0x5b2970(0x199)},{'$match':{'product_details.product_code':_0x11ac69}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5b2970(0x17c)},'primary_code':{'$first':_0x5b2970(0x20e)},'secondary_code':{'$first':_0x5b2970(0x203)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x5b2970(0x16c)},'warehouse':{'$first':_0x5b2970(0x189)},'level':{'$first':_0x5b2970(0x1ac)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5b2970(0x1c8)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':'$product_details.unit'}}}]);_0x2acae0[_0x5b2970(0x181)](0xc8)[_0x5b2970(0x156)](_0x5bc247);}catch(_0x157174){_0x2acae0[_0x5b2970(0x181)](0x194)[_0x5b2970(0x156)]({'message':_0x157174['message']});}}),router[a0_0x336b7e(0x17d)](a0_0x336b7e(0x1e0),async(_0x35cdc3,_0x285f82)=>{var _0x343c0b=a0_0x336b7e;const {productCode:_0x181015,bay:_0x7d283a,warehouses:_0x2ab7cb,room:_0x406ff3}=_0x35cdc3['body'];console[_0x343c0b(0x15a)](_0x35cdc3[_0x343c0b(0x200)]);try{const _0x579398=await warehouse[_0x343c0b(0x190)]([{'$match':{'name':_0x2ab7cb,'room':_0x406ff3}},{'$unwind':_0x343c0b(0x199)},{'$match':{'product_details.bay':parseInt(_0x7d283a)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x343c0b(0x17c)},'product_stock':{'$first':_0x343c0b(0x16c)},'bay':{'$first':_0x343c0b(0x21b)},'maxProducts':{'$first':_0x343c0b(0x1b3)}}}]);_0x285f82[_0x343c0b(0x181)](0xc8)['json'](_0x579398);}catch(_0x3ff06e){_0x285f82[_0x343c0b(0x181)](0x194)[_0x343c0b(0x156)]({'message':_0x3ff06e[_0x343c0b(0x21c)]});}}),module[a0_0x336b7e(0x180)]=router;