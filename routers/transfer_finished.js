var a0_0x5494d4=a0_0xd388;(function(_0x5a4dc4,_0x9f0632){var _0x55de2c=a0_0xd388,_0x30ceec=_0x5a4dc4();while(!![]){try{var _0x5320fd=parseInt(_0x55de2c(0x76))/0x1+-parseInt(_0x55de2c(0xca))/0x2+-parseInt(_0x55de2c(0x134))/0x3*(parseInt(_0x55de2c(0x13c))/0x4)+parseInt(_0x55de2c(0x10a))/0x5+-parseInt(_0x55de2c(0xb6))/0x6+parseInt(_0x55de2c(0x11b))/0x7*(-parseInt(_0x55de2c(0x7a))/0x8)+parseInt(_0x55de2c(0xd0))/0x9;if(_0x5320fd===_0x9f0632)break;else _0x30ceec['push'](_0x30ceec['shift']());}catch(_0x294d2d){_0x30ceec['push'](_0x30ceec['shift']());}}}(a0_0x43b5,0xb3c5e));const express=require('express'),app=express(),router=express[a0_0x5494d4(0x11e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x5494d4(0xbe)),auth=require('../middleware/auth'),users=require('../public/language/languages.json'),nodemailer=require('nodemailer');router['get'](a0_0x5494d4(0x13e),auth,async(_0x3b2346,_0x2b61ed)=>{var _0x2fca8a=a0_0x5494d4;try{const {username:_0x10d93f,email:_0x4a1acd,role:_0x2572d0}=_0x3b2346[_0x2fca8a(0x81)],_0x22a03c=_0x3b2346[_0x2fca8a(0x81)],_0x59cec4=await profile['findOne']({'email':_0x22a03c[_0x2fca8a(0x109)]}),_0x39bd86=await master_shop[_0x2fca8a(0x141)]();let _0x3dc961;if(_0x22a03c[_0x2fca8a(0x13d)]==_0x2fca8a(0x98)){const _0x25274f=await staff[_0x2fca8a(0x112)]({'email':_0x22a03c[_0x2fca8a(0x109)]});_0x3dc961=await transfers_finished[_0x2fca8a(0x141)]({'from_warehouse':_0x25274f['warehouse']});}else _0x3dc961=await transfers_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x2fca8a(0x142),'invoice':{'$first':_0x2fca8a(0x137)},'date':{'$first':'$date'},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x2fca8a(0xfd)},'from_room_name':{'$addToSet':_0x2fca8a(0x13f)},'to_room_name':{'$addToSet':_0x2fca8a(0xcb)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x39bd86[0x0][_0x2fca8a(0xa2)]==_0x2fca8a(0x128))var _0x476d33=users[_0x2fca8a(0x136)];else{if(_0x39bd86[0x0]['language']==_0x2fca8a(0xe9))var _0x476d33=users[_0x2fca8a(0xe9)];else{if(_0x39bd86[0x0][_0x2fca8a(0xa2)]==_0x2fca8a(0x117))var _0x476d33=users['German'];else{if(_0x39bd86[0x0]['language']==_0x2fca8a(0x123))var _0x476d33=users['Spanish'];else{if(_0x39bd86[0x0][_0x2fca8a(0xa2)]==_0x2fca8a(0xec))var _0x476d33=users[_0x2fca8a(0xec)];else{if(_0x39bd86[0x0][_0x2fca8a(0xa2)]=='Portuguese\x20(BR)')var _0x476d33=users[_0x2fca8a(0x80)];else{if(_0x39bd86[0x0][_0x2fca8a(0xa2)]=='Chinese')var _0x476d33=users[_0x2fca8a(0x12f)];else{if(_0x39bd86[0x0]['language']==_0x2fca8a(0x100))var _0x476d33=users[_0x2fca8a(0xf7)];}}}}}}}_0x2b61ed[_0x2fca8a(0x127)](_0x2fca8a(0x113),{'success':_0x3b2346['flash']('success'),'errors':_0x3b2346['flash']('errors'),'role':_0x22a03c,'profile':_0x59cec4,'master_shop':_0x39bd86,'transfer':_0x3dc961,'language':_0x476d33});}catch(_0x5cc5fb){console['log'](_0x5cc5fb);}});async function getRandom8DigitNumber(){var _0x24f421=a0_0x5494d4;const _0x1b2bff=0x989680,_0x39b661=0x5f5e0ff,_0xbaf99f=Math[_0x24f421(0x9b)](Math['random']()*(_0x39b661-_0x1b2bff+0x1))+_0x1b2bff;var _0x2ec60c;const _0x1e798a=await transfers_finished[_0x24f421(0x112)]({'invoice':_0x24f421(0x114)+_0xbaf99f});return _0x1e798a&&_0x1e798a[_0x24f421(0x8d)]>0x0?_0x2ec60c=_0x24f421(0x114)+_0xbaf99f:_0x2ec60c=_0x24f421(0x114)+_0xbaf99f,_0x2ec60c;}router[a0_0x5494d4(0xb8)](a0_0x5494d4(0xfa),auth,async(_0x1327e4,_0x2a14e0)=>{var _0x5d8d8c=a0_0x5494d4;try{const {username:_0x230ddf,email:_0x541fb2,role:_0x24ca78}=_0x1327e4[_0x5d8d8c(0x81)],_0x1692a2=_0x1327e4[_0x5d8d8c(0x81)],_0xfe12cb=await profile[_0x5d8d8c(0x112)]({'email':_0x1692a2[_0x5d8d8c(0x109)]}),_0x5d770e=await master_shop[_0x5d8d8c(0x141)]();let _0x26b923;if(_0x1692a2[_0x5d8d8c(0x13d)]==_0x5d8d8c(0x98)){const _0x9afe8a=await staff[_0x5d8d8c(0x112)]({'email':_0x1692a2[_0x5d8d8c(0x109)]});_0x26b923=await warehouse[_0x5d8d8c(0xd9)]([{'$match':{'status':_0x5d8d8c(0xee),'name':_0x9afe8a[_0x5d8d8c(0x12c)],'warehouse_category':_0x5d8d8c(0x9a),'name':{'$ne':_0x5d8d8c(0x91)}}},{'$group':{'_id':_0x5d8d8c(0xb2),'name':{'$first':_0x5d8d8c(0xb2)}}}]);}else _0x26b923=await warehouse[_0x5d8d8c(0xd9)]([{'$match':{'status':_0x5d8d8c(0xee),'warehouse_category':_0x5d8d8c(0x9a),'name':{'$ne':_0x5d8d8c(0x91)}}},{'$group':{'_id':_0x5d8d8c(0xb2),'name':{'$first':_0x5d8d8c(0xb2)}}}]);const _0x34fd79=await transfers_finished[_0x5d8d8c(0x141)]({}),_0x4a69a6=_0x34fd79[_0x5d8d8c(0x8d)]+0x1,_0x554984=_0x5d8d8c(0x114)+_0x4a69a6['toString']()[_0x5d8d8c(0x104)](0x5,'0');if(_0x5d770e[0x0][_0x5d8d8c(0xa2)]==_0x5d8d8c(0x128))var _0x2420aa=users['English'];else{if(_0x5d770e[0x0]['language']==_0x5d8d8c(0xe9))var _0x2420aa=users[_0x5d8d8c(0xe9)];else{if(_0x5d770e[0x0][_0x5d8d8c(0xa2)]==_0x5d8d8c(0x117))var _0x2420aa=users[_0x5d8d8c(0x117)];else{if(_0x5d770e[0x0][_0x5d8d8c(0xa2)]==_0x5d8d8c(0x123))var _0x2420aa=users[_0x5d8d8c(0x123)];else{if(_0x5d770e[0x0]['language']=='French')var _0x2420aa=users['French'];else{if(_0x5d770e[0x0][_0x5d8d8c(0xa2)]==_0x5d8d8c(0x129))var _0x2420aa=users[_0x5d8d8c(0x80)];else{if(_0x5d770e[0x0][_0x5d8d8c(0xa2)]==_0x5d8d8c(0x12f))var _0x2420aa=users[_0x5d8d8c(0x12f)];else{if(_0x5d770e[0x0][_0x5d8d8c(0xa2)]=='Arabic\x20(ae)')var _0x2420aa=users[_0x5d8d8c(0xf7)];}}}}}}}const _0x2c14fd=getRandom8DigitNumber();_0x2c14fd['then'](_0x1289f5=>{var _0x42b0a3=_0x5d8d8c;_0x2a14e0[_0x42b0a3(0x127)](_0x42b0a3(0x84),{'success':_0x1327e4[_0x42b0a3(0x87)](_0x42b0a3(0xa7)),'errors':_0x1327e4[_0x42b0a3(0x87)](_0x42b0a3(0xc0)),'role':_0x1692a2,'profile':_0xfe12cb,'master_shop':_0x5d770e,'warehouse':_0x26b923,'language':_0x2420aa,'invoice':_0x1289f5});})[_0x5d8d8c(0x122)](_0x2926bd=>{var _0x5088de=_0x5d8d8c;_0x1327e4[_0x5088de(0x87)](_0x5088de(0xc0),_0x5088de(0xd1)),_0x2a14e0['redirect'](_0x5088de(0xe7));});}catch(_0x1e58a9){console[_0x5d8d8c(0x89)](_0x1e58a9);}}),router[a0_0x5494d4(0xc2)](a0_0x5494d4(0xfa),auth,async(_0x2d8761,_0x42b823)=>{var _0xc89db=a0_0x5494d4;try{const {date:_0x538a26,from_warehouse:_0x1ba224,FromRoom_name:_0x5b7d4b,to_warehouse:_0x58488d,ToRoom_name:_0x308996,prod_name:_0x16d4a2,from_prod_qty:_0xd7bb93,from_prod_level:_0x3a9808,from_prod_isle:_0x22f83d,from_prod_pallet:_0x319154,to_prod_qty:_0x2a586e,to_prod_level:_0xe33beb,to_prod_isle:_0x22fbbd,to_prod_pallet:_0x388aed,primary_code:_0x1ac109,secondary_code:_0x4e7ec7,product_code3:_0x287de9,note:_0x52a2e4,MaxStocks_data2:_0x1716a0,invoice:_0x4da2b4,expiry_date:_0x11741e}=_0x2d8761[_0xc89db(0x7b)];if(typeof _0x16d4a2==_0xc89db(0xbd))var _0x1d36d8=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0xc6)]],_0x152a2c=[_0x2d8761[_0xc89db(0x7b)]['from_prod_qty']],_0xf18ad5=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x108)]],_0x2abe32=[_0x2d8761['body'][_0xc89db(0xc1)]],_0x24c144=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x121)]],_0x13b08d=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x9d)]],_0x1b5373=[_0x2d8761['body'][_0xc89db(0x120)]],_0x1528b4=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x132)]],_0x367e0b=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x74)]],_0x69fc2b=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x8c)]],_0x35f76d=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x82)]],_0x31dea1=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x71)]],_0x1d248d=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0xd3)]],_0x184f46=[_0x2d8761['body'][_0xc89db(0xdf)]],_0x582a13=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0xb9)]],_0x2851ad=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x11d)]],_0x176276=[_0x2d8761[_0xc89db(0x7b)]['prod_cat']],_0x4ec863=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0xdd)]],_0x24e4dd=[_0x2d8761[_0xc89db(0x7b)]['ToRoomAssigned']],_0x5a0d9f=[_0x2d8761[_0xc89db(0x7b)][_0xc89db(0x90)]],_0x46a64f=[_0x2d8761[_0xc89db(0x7b)]['to_invoice']];else var _0x1d36d8=[..._0x2d8761[_0xc89db(0x7b)]['prod_name']],_0x152a2c=[..._0x2d8761['body']['from_prod_qty']],_0xf18ad5=[..._0x2d8761[_0xc89db(0x7b)]['from_prod_level']],_0x2abe32=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0xc1)]],_0x24c144=[..._0x2d8761['body'][_0xc89db(0x121)]],_0x13b08d=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0x9d)]],_0x1b5373=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0x120)]],_0x1528b4=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0x132)]],_0x367e0b=[..._0x2d8761[_0xc89db(0x7b)]['MaxStocks_data2']],_0x69fc2b=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0x8c)]],_0x35f76d=[..._0x2d8761[_0xc89db(0x7b)]['secondary_unit']],_0x31dea1=[..._0x2d8761[_0xc89db(0x7b)]['batch_code']],_0x1d248d=[..._0x2d8761[_0xc89db(0x7b)]['expiry_date']],_0x184f46=[..._0x2d8761['body']['product_date']],_0x582a13=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0xb9)]],_0x2851ad=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0x11d)]],_0x176276=[..._0x2d8761[_0xc89db(0x7b)]['prod_cat']],_0x4ec863=[..._0x2d8761['body'][_0xc89db(0xdd)]],_0x24e4dd=[..._0x2d8761[_0xc89db(0x7b)]['ToRoomAssigned']],_0x5a0d9f=[..._0x2d8761[_0xc89db(0x7b)][_0xc89db(0x90)]],_0x46a64f=[..._0x2d8761['body'][_0xc89db(0xd2)]];const _0xbea1b8=_0x1d36d8['map'](_0x74df93=>{return _0x74df93={'product_name':_0x74df93};});_0x152a2c[_0xc89db(0xed)]((_0x18a16e,_0x1c5e94)=>{_0xbea1b8[_0x1c5e94]['from_quantity']=_0x18a16e;}),_0xf18ad5[_0xc89db(0xed)]((_0x138fc7,_0x4739f4)=>{var _0x641839=_0xc89db;_0xbea1b8[_0x4739f4][_0x641839(0x10b)]=_0x138fc7;}),_0x5a0d9f[_0xc89db(0xed)]((_0x8220e0,_0x4b4413)=>{_0xbea1b8[_0x4b4413]['from_invoice']=_0x8220e0;}),_0x46a64f[_0xc89db(0xed)]((_0x2ea557,_0xc7e54d)=>{_0xbea1b8[_0xc7e54d]['To_invoice']=_0x2ea557;}),_0x2abe32['forEach']((_0x228fe2,_0x269bf6)=>{var _0x122b9d=_0xc89db;_0xbea1b8[_0x269bf6][_0x122b9d(0x88)]=_0x228fe2;}),_0x24c144[_0xc89db(0xed)]((_0x172051,_0x1a9ec3)=>{_0xbea1b8[_0x1a9ec3]['to_bay']=_0x172051;}),_0x13b08d[_0xc89db(0xed)]((_0x1af41c,_0x142e8e)=>{var _0x2dff91=_0xc89db;_0xbea1b8[_0x142e8e][_0x2dff91(0x9d)]=_0x1af41c;}),_0x1b5373[_0xc89db(0xed)]((_0x63fc0,_0x2dc381)=>{var _0x4b1aa1=_0xc89db;_0xbea1b8[_0x2dc381][_0x4b1aa1(0x120)]=_0x63fc0;}),_0x1528b4[_0xc89db(0xed)]((_0x2b0f80,_0x43dd4d)=>{_0xbea1b8[_0x43dd4d]['product_code']=_0x2b0f80;}),_0x367e0b[_0xc89db(0xed)]((_0x36e9b6,_0x5f49d9)=>{_0xbea1b8[_0x5f49d9]['maxProducts']=_0x36e9b6;}),_0x69fc2b['forEach']((_0x39d013,_0x19f363)=>{var _0x19d222=_0xc89db;_0xbea1b8[_0x19f363][_0x19d222(0x79)]=_0x39d013;}),_0x35f76d[_0xc89db(0xed)]((_0x4bf705,_0x18fb53)=>{var _0x166dca=_0xc89db;_0xbea1b8[_0x18fb53][_0x166dca(0x82)]=_0x4bf705;}),_0x31dea1[_0xc89db(0xed)]((_0x3c6c93,_0x134bf1)=>{var _0x35ea3c=_0xc89db;_0xbea1b8[_0x134bf1][_0x35ea3c(0x71)]=_0x3c6c93;}),_0x1d248d['forEach']((_0x40a00a,_0xfcb21b)=>{var _0x366c6a=_0xc89db;_0xbea1b8[_0xfcb21b][_0x366c6a(0xd3)]=_0x40a00a;}),_0x184f46[_0xc89db(0xed)]((_0x16d632,_0x42710a)=>{var _0x239714=_0xc89db;_0xbea1b8[_0x42710a][_0x239714(0xac)]=_0x16d632;}),_0x582a13[_0xc89db(0xed)]((_0x2f273f,_0x2fd4fe)=>{var _0x50c699=_0xc89db;_0xbea1b8[_0x2fd4fe][_0x50c699(0xbc)]=_0x2f273f;}),_0x2851ad[_0xc89db(0xed)]((_0x1202d3,_0x13ca84)=>{_0xbea1b8[_0x13ca84]['maxPerUnit']=_0x1202d3;}),_0x176276['forEach']((_0x4c373e,_0xb096e6)=>{var _0x534a70=_0xc89db;_0xbea1b8[_0xb096e6][_0x534a70(0xf9)]=_0x4c373e;}),_0x4ec863[_0xc89db(0xed)]((_0x48ed94,_0xbcaa7d)=>{var _0x563683=_0xc89db;_0xbea1b8[_0xbcaa7d][_0x563683(0xf4)]=_0x48ed94;}),_0x24e4dd[_0xc89db(0xed)]((_0x30e577,_0x429dc3)=>{var _0x2c0d69=_0xc89db;_0xbea1b8[_0x429dc3][_0x2c0d69(0xfb)]=_0x30e577;});const _0x17da91=_0xbea1b8[_0xc89db(0x73)](_0x38e343=>_0x38e343[_0xc89db(0x88)]!=='0'&&_0x38e343['to_quantity']!==''||_0x38e343[_0xc89db(0x10c)]!=='0'&&_0x38e343[_0xc89db(0x10c)]!=='');var _0x41f2b7=0x0;_0x17da91[_0xc89db(0xed)](_0x579f6d=>{var _0x2ec2ac=_0xc89db;parseInt(_0x579f6d[_0x2ec2ac(0x106)])<parseInt(_0x579f6d['to_quantity'])&&_0x41f2b7++;});if(_0x41f2b7!=0x0)return _0x2d8761[_0xc89db(0x87)](_0xc89db(0xc0),_0xc89db(0x126)),_0x42b823[_0xc89db(0x93)](_0xc89db(0x6c));const _0xcc1793=new transfers_finished({'date':_0x538a26,'from_warehouse':_0x1ba224,'to_warehouse':_0x58488d,'product':_0x17da91,'note':_0x52a2e4,'invoice':_0x4da2b4}),_0x9229fd=await _0xcc1793[_0xc89db(0x8a)]();_0x2d8761[_0xc89db(0x87)]('success',_0xc89db(0xff)),_0x42b823[_0xc89db(0x93)]('/transfer_finished/preview/'+_0x9229fd[_0xc89db(0x105)]);}catch(_0x266621){console[_0xc89db(0x89)](_0x266621),_0x42b823[_0xc89db(0xe2)](0xc8)['json']({'errorMessage':_0x266621[_0xc89db(0x140)]});}}),router[a0_0x5494d4(0xb8)](a0_0x5494d4(0xa9),auth,async(_0x1d1d62,_0x37159b)=>{var _0x4cdac8=a0_0x5494d4;try{const {username:_0x55540c,email:_0x385753,role:_0x9a76a8}=_0x1d1d62[_0x4cdac8(0x81)],_0x28f466=_0x1d1d62[_0x4cdac8(0x81)],_0x579fdb=await profile['findOne']({'email':_0x28f466['email']}),_0x40f07f=await master_shop['find'](),_0x567d79=await transfers_finished['findById'](_0x1d1d62[_0x4cdac8(0xd8)]['id']);let _0x14b48c;if(_0x28f466[_0x4cdac8(0x13d)]==_0x4cdac8(0x98)){const _0x55834d=await staff[_0x4cdac8(0x112)]({'email':_0x28f466[_0x4cdac8(0x109)]});_0x14b48c=await warehouse[_0x4cdac8(0x141)]({'status':_0x4cdac8(0xee),'name':_0x55834d[_0x4cdac8(0x12c)],'warehouse_category':_0x4cdac8(0x9a)});}else _0x14b48c=await warehouse[_0x4cdac8(0x141)]({'status':_0x4cdac8(0xee),'warehouse_category':_0x4cdac8(0x9a)});const _0x27c60c=await warehouse[_0x4cdac8(0xd9)]([{'$match':{'name':_0x567d79[_0x4cdac8(0xe0)],'warehouse_category':_0x4cdac8(0x9a)}},{'$unwind':_0x4cdac8(0x7d)},{'$group':{'_id':_0x4cdac8(0x97),'name':{'$first':_0x4cdac8(0x12a)},'product_stock':{'$first':_0x4cdac8(0xd7)},'bay':{'$first':_0x4cdac8(0xa4)},'bin':{'$first':_0x4cdac8(0xda)},'type':{'$first':_0x4cdac8(0xa8)},'floorlevel':{'$first':_0x4cdac8(0xd4)},'primary_code':{'$first':_0x4cdac8(0x78)},'secondary_code':{'$first':_0x4cdac8(0x12b)},'product_code':{'$first':_0x4cdac8(0x9c)},'storage':{'$first':_0x4cdac8(0x92)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4cdac8(0xa1)},'production_date':{'$first':_0x4cdac8(0xea)},'room':{'$first':'$room'},'warehoue_name':{'$first':_0x4cdac8(0xb2)}}}]),_0x1b6828=await product[_0x4cdac8(0x141)]({});if(_0x40f07f[0x0][_0x4cdac8(0xa2)]=='English\x20(US)'){var _0x16e403=users[_0x4cdac8(0x136)];console['log'](_0x16e403);}else{if(_0x40f07f[0x0][_0x4cdac8(0xa2)]==_0x4cdac8(0xe9))var _0x16e403=users[_0x4cdac8(0xe9)];else{if(_0x40f07f[0x0]['language']=='German')var _0x16e403=users['German'];else{if(_0x40f07f[0x0][_0x4cdac8(0xa2)]==_0x4cdac8(0x123))var _0x16e403=users[_0x4cdac8(0x123)];else{if(_0x40f07f[0x0][_0x4cdac8(0xa2)]=='French')var _0x16e403=users['French'];else{if(_0x40f07f[0x0][_0x4cdac8(0xa2)]==_0x4cdac8(0x129))var _0x16e403=users[_0x4cdac8(0x80)];else{if(_0x40f07f[0x0][_0x4cdac8(0xa2)]==_0x4cdac8(0x12f))var _0x16e403=users[_0x4cdac8(0x12f)];else{if(_0x40f07f[0x0][_0x4cdac8(0xa2)]==_0x4cdac8(0x100))var _0x16e403=users[_0x4cdac8(0xf7)];}}}}}}}_0x37159b[_0x4cdac8(0x127)](_0x4cdac8(0xb3),{'success':_0x1d1d62[_0x4cdac8(0x87)](_0x4cdac8(0xa7)),'errors':_0x1d1d62[_0x4cdac8(0x87)]('errors'),'role':_0x28f466,'profile':_0x579fdb,'master_shop':_0x40f07f,'warehouse':_0x14b48c,'transfer':_0x567d79,'stock':_0x27c60c,'unit':_0x1b6828,'language':_0x16e403});}catch(_0x1d55af){console[_0x4cdac8(0x89)](_0x1d55af);}}),router['post'](a0_0x5494d4(0xa9),auth,async(_0x441661,_0x19d949)=>{var _0x13239d=a0_0x5494d4;try{const {invoice:_0x3c19f1,from_warehouse:_0x1577ce,FromRoom_name:_0x293a8,to_warehouse:_0x4d85cb,ToRoom_name:_0x8f712a}=_0x441661[_0x13239d(0x7b)],_0x1f1275=await transfers_finished[_0x13239d(0xfe)](_0x441661[_0x13239d(0xd8)]['id']),_0x5bbcb3=_0x1f1275[_0x13239d(0x139)][_0x13239d(0x10d)](async _0x5a6353=>{var _0x366aa9=_0x13239d;if(_0x5a6353['to_quantity']>0x0){var _0x407598=await warehouse[_0x366aa9(0x112)]({'name':_0x1577ce,'room':_0x5a6353['from_room_name'],'warehouse_category':_0x366aa9(0x9a)});const _0x278174=_0x407598[_0x366aa9(0x13a)]['map'](_0x344988=>{var _0x2f44df=_0x366aa9;_0x344988[_0x2f44df(0xa5)]==_0x5a6353[_0x2f44df(0xa5)]&&_0x344988[_0x2f44df(0x12d)]==_0x5a6353['from_bay']&&_0x344988[_0x2f44df(0xd3)]==_0x5a6353[_0x2f44df(0xd3)]&&_0x344988[_0x2f44df(0xac)]==_0x5a6353[_0x2f44df(0xac)]&&_0x344988[_0x2f44df(0x71)]==_0x5a6353[_0x2f44df(0x71)]&&_0x344988['invoice']==_0x5a6353[_0x2f44df(0x90)]&&(_0x344988['product_stock']=_0x344988[_0x2f44df(0xf1)]-_0x5a6353['to_quantity']);});}return _0x407598;});Promise[_0x13239d(0x103)](_0x5bbcb3)[_0x13239d(0xa0)](async _0x354087=>{var _0x538769=_0x13239d;try{for(const _0x445ef3 of _0x354087){await _0x445ef3[_0x538769(0x8a)]();}const _0x38ebb4=_0x1f1275['product']['map'](async _0x1369ed=>{var _0x5a9eb7=_0x538769,_0xd4c21b=await warehouse[_0x5a9eb7(0x112)]({'name':_0x4d85cb,'room':_0x1369ed['to_room_name']});if(_0x1369ed['to_quantity']>0x0){var _0x2f4f4a=0x0;const _0x33deb9=_0xd4c21b[_0x5a9eb7(0x13a)][_0x5a9eb7(0x10d)](_0x271f94=>{var _0x30cfe7=_0x5a9eb7;_0x271f94['product_name']==_0x1369ed[_0x30cfe7(0xa5)]&&_0x271f94[_0x30cfe7(0x12d)]==_0x1369ed[_0x30cfe7(0xb7)]&&_0x271f94['expiry_date']==_0x1369ed[_0x30cfe7(0xd3)]&&_0x271f94[_0x30cfe7(0xac)]==_0x1369ed[_0x30cfe7(0xac)]&&_0x271f94['batch_code']==_0x1369ed['batch_code']&&_0x271f94[_0x30cfe7(0x13b)]==_0x1369ed[_0x30cfe7(0xe6)]&&(_0x271f94[_0x30cfe7(0xf1)]=_0x271f94[_0x30cfe7(0xf1)]+_0x1369ed[_0x30cfe7(0x88)],_0x2f4f4a++);});_0x2f4f4a=='0'&&(_0xd4c21b['product_details']=_0xd4c21b[_0x5a9eb7(0x13a)]['concat']({'product_name':_0x1369ed[_0x5a9eb7(0xa5)],'product_stock':_0x1369ed['to_quantity'],'bay':_0x1369ed['to_bay'],'product_code':_0x1369ed['product_code'],'primary_code':_0x1369ed['primary_code'],'secondary_code':_0x1369ed[_0x5a9eb7(0x120)],'expiry_date':_0x1369ed[_0x5a9eb7(0xd3)],'production_date':_0x1369ed[_0x5a9eb7(0xac)],'maxProducts':_0x1369ed[_0x5a9eb7(0xbc)],'batch_code':_0x1369ed[_0x5a9eb7(0x71)],'secondary_unit':_0x1369ed['secondary_unit'],'unit':_0x1369ed['unit'],'maxProducts':_0x1369ed[_0x5a9eb7(0xbc)],'maxPerUnit':_0x1369ed[_0x5a9eb7(0x11d)],'invoice':_0x1369ed['To_invoice']}));}return _0xd4c21b;});Promise[_0x538769(0x103)](_0x38ebb4)[_0x538769(0xa0)](async _0x2d9b51=>{var _0x443e14=_0x538769;try{for(const _0x898e47 of _0x2d9b51){await warehouse['updateOne']({'_id':_0x898e47[_0x443e14(0x105)]},{'$addToSet':{'product_details':{'$each':_0x898e47[_0x443e14(0x13a)]}}});}_0x1f1275[_0x443e14(0x11f)]=_0x443e14(0x8e);const _0xc8605a=await _0x1f1275[_0x443e14(0x8a)](),_0xfcd2f=await master_shop[_0x443e14(0x141)](),_0x2e349e=await email_settings['findOne'](),_0x4ba8bb=await supervisor_settings[_0x443e14(0x141)]();var _0x37134a=_0x1f1275['product'],_0x29a91d='',_0x33db39;for(_0x33db39 in _0x37134a){var _0x392b7b='FG';_0x1f1275[_0x443e14(0x10f)]==_0x443e14(0xf5)&&(_0x392b7b='DG'),_0x29a91d+=_0x443e14(0xce)+_0x443e14(0xef)+_0x37134a[_0x33db39][_0x443e14(0xa5)]+_0x443e14(0xba)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37134a[_0x33db39]['product_code']+_0x443e14(0xba)+_0x443e14(0xef)+_0x37134a[_0x33db39][_0x443e14(0x88)]+_0x443e14(0xba)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37134a[_0x33db39][_0x443e14(0x79)]+_0x443e14(0xba)+_0x443e14(0xef)+_0x37134a[_0x33db39]['secondary_unit']+_0x443e14(0xba)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f1275[_0x443e14(0x10f)]+_0x443e14(0xba)+_0x443e14(0xef)+_0x37134a[_0x33db39][_0x443e14(0xfb)]+_0x443e14(0xba)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x392b7b+_0x37134a[_0x33db39]['to_bay']+_0x443e14(0xba)+_0x443e14(0x7c);}let _0x2312ab=nodemailer[_0x443e14(0xc5)]({'host':_0x2e349e[_0x443e14(0xae)],'port':Number(_0x2e349e[_0x443e14(0xe8)]),'secure':![],'auth':{'user':_0x2e349e[_0x443e14(0x109)],'pass':_0x2e349e[_0x443e14(0xc8)]}}),_0x5aba88={'from':_0x2e349e[_0x443e14(0x109)],'to':_0x4ba8bb[0x0][_0x443e14(0x10e)],'subject':_0x443e14(0xdb),'attachments':[{'filename':'Logo.png','path':__dirname+_0x443e14(0xcd)+_0x443e14(0x11c)+_0xfcd2f[0x0][_0x443e14(0x118)],'cid':'logo'}],'html':_0x443e14(0x124)+'<html><head><title></title>'+_0x443e14(0xc3)+_0x443e14(0x8f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x443e14(0x8f)+_0x443e14(0xb0)+_0x443e14(0x111)+_0x443e14(0x8f)+_0x443e14(0xf2)+_0xfcd2f[0x0][_0x443e14(0x94)]+_0x443e14(0x86)+_0x443e14(0x111)+_0x443e14(0x111)+_0x443e14(0xdc)+_0x443e14(0x8f)+_0x443e14(0x6e)+_0x443e14(0xeb)+_0x1f1275[_0x443e14(0x13b)]+'\x20'+_0x443e14(0x138)+_0x443e14(0x72)+_0x1f1275[_0x443e14(0x143)]+'\x20'+_0x443e14(0x107)+'</h5>'+_0x443e14(0x111)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x443e14(0x11a)+_0x443e14(0xce)+_0x443e14(0x6b)+_0x443e14(0xf3)+_0x443e14(0xcf)+_0x443e14(0x7e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x443e14(0x6f)+_0x443e14(0xf6)+_0x443e14(0x7f)+_0x443e14(0x7c)+_0x443e14(0xc4)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x29a91d+'\x20'+_0x443e14(0xf8)+_0x443e14(0xf0)+'<div>'+_0x443e14(0x116)+_0x443e14(0x8b)+_0xfcd2f[0x0][_0x443e14(0x94)]+_0x443e14(0x95)+_0x443e14(0x111)+'</div>'+'</body></html>'};_0x2312ab[_0x443e14(0xde)](_0x5aba88,function(_0xd57156,_0x3222e1){var _0x5402ab=_0x443e14;_0xd57156?(console['log'](_0xd57156),console[_0x5402ab(0x89)](_0x5402ab(0xfc))):console['log'](_0x5402ab(0xd6));}),_0x441661['flash'](_0x443e14(0xa7),'Transfer\x20Finalize\x20Successfully'),_0x19d949[_0x443e14(0x93)](_0x443e14(0x125)+_0xc8605a[_0x443e14(0x105)]);}catch(_0x384590){console[_0x443e14(0xe1)](_0x384590),_0x19d949[_0x443e14(0xe2)](0x1f4)['json']({'error':_0x443e14(0x96)});}})[_0x538769(0x122)](_0x1e2c30=>{var _0x12c6a1=_0x538769;console[_0x12c6a1(0xe1)](_0x1e2c30),_0x19d949[_0x12c6a1(0xe2)](0x1f4)[_0x12c6a1(0xab)]({'error':'An\x20error\x20occurred.'});});}catch(_0x32cee0){console[_0x538769(0xe1)](_0x32cee0),_0x19d949[_0x538769(0xe2)](0x1f4)[_0x538769(0xab)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x13239d(0x122)](_0x32f7bc=>{var _0x531959=_0x13239d;console[_0x531959(0xe1)](_0x32f7bc),_0x19d949[_0x531959(0xe2)](0x1f4)[_0x531959(0xab)]({'error':'An\x20error\x20occurred.'});});}catch(_0x365f31){_0x19d949['json']({'message':_0x365f31[_0x13239d(0x140)]});}});function a0_0xd388(_0x3221fb,_0x1a724f){var _0x43b50c=a0_0x43b5();return a0_0xd388=function(_0xd3887f,_0x31de88){_0xd3887f=_0xd3887f-0x6b;var _0x2222ce=_0x43b50c[_0xd3887f];return _0x2222ce;},a0_0xd388(_0x3221fb,_0x1a724f);}function a0_0x43b5(){var _0x56cb4a=['maxPerUnit','Router','finalize','secondary_code','to_prod_level','catch','Spanish','<!DOCTYPE\x20html>','/picking_list/PDF_transfer/','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','render','English\x20(US)','Portuguese\x20(BR)','$product_details.product_name','$product_details.secondary_code','warehouse','bay','getMonth','Chinese','/CheckingWarehouse','from_prod_qty','product_code3','slice','27wcATdk','/barcode_scanner','English','$invoice','<span\x20style=\x22float:\x20right;\x22>','product','product_details','invoice','387308MjyxoX','role','/view','$product.from_room_name','message','find','$_id','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','back','$product_details.batch_code','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','split','batch_code','\x20Order\x20Date\x20:\x20','filter','MaxStocks_data2','$product_details.rack','853856qEIpae','to_prod_qty','$product_details.primary_code','unit','8FbVhFZ','body','</tr>','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Portuguese','user','secondary_unit','Rack\x201','add_transfer_finished','transfer_data','\x20</h2>','flash','to_quantity','log','save','<h5>','primary_unit','length','True','<div>','from_invoice','QA\x20Warehouse','$product_details.storage','redirect','site_title','</h5>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details._id','staff','/transfer_finished/view','Finished\x20Goods','floor','$product_details.product_code','primary_code','Rack\x202','$product_details.level','then','$product_details.expiry_date','language','to_room','$product_details.bay','product_name','$product_details.maxProducts','success','$product_details.type','/preview/:id','Enclosed','json','production_date','concat','host','/barcode_scanner2','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Transfer\x20Edit\x20Successfully','$name','edit_transfer_finished_view','/view/:id','exports','7883196ovVzOC','to_bay','get','MaxStocks_data','</td>','$product_details.secondary_unit','maxProducts','string','../models/all_models','/barcode_scanner3','errors','New_Qty_Converted','post','</head><body>','</thead>','createTransport','prod_name','push','password','product_code','2060512IhPfLd','$product.to_room_name','$product_details.maxPerUnit','/../public','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','30886389VaElxy','There\x27s\x20a\x20error\x20in\x20this\x20transaction','to_invoice','expiry_date','$product_details.floorlevel','$product_details.pallet','Email\x20sent\x20successfully','$product_details.product_stock','params','aggregate','$product_details.bin','Transfer\x20Mail','<hr\x20class=\x22my-3\x22>','RoomAssigned','sendMail','product_date','from_warehouse','error','status','getDate','Ambient','$product_details.invoice','To_invoice','/transfer/view','port','Hindi','$product_details.production_date','\x20Order\x20Number\x20:\x20','French','forEach','Enabled','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</table>','product_stock','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','from_room_name','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Arabic','</tbody>','prod_cat','/view/add_transfer','to_room_name','Error\x20Occurs','$to_warehouse','findById','Product\x20Transfer\x20successfully','Arabic\x20(ae)','$product_details.unit','getFullYear','all','padStart','_id','from_quantity','</span>','from_prod_level','email','2132345teuvok','from_bay','to_floorlevel','map','FGSEmail','to_warehouse','$room','</div>','findOne','transfer_finished','TRFF-','$product_details.isle','<strong>\x20Regards\x20</strong>','German','image','from_room','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','5321617hvfIpr','/upload/'];a0_0x43b5=function(){return _0x56cb4a;};return a0_0x43b5();}function BayBinSelected(_0x436f68,_0x9bc21e){var _0x4d68d0=a0_0x5494d4,_0x2b4fd1=[];let _0x1f0962=[];var _0x1cc70a=[];if(_0x436f68==_0x4d68d0(0xf5)){switch(_0x9bc21e){case _0x4d68d0(0x83):_0x2b4fd1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4d68d0(0x9e):_0x2b4fd1=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x1cc70a=['DG'];}else{if(_0x436f68=='FROZEN\x20GOODS'){switch(_0x9bc21e){case _0x4d68d0(0x83):_0x2b4fd1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4d68d0(0x9e):_0x2b4fd1=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x1cc70a=['FG'];}}return{'levels':_0x2b4fd1,'identify':_0x1cc70a};}router[a0_0x5494d4(0xb8)]('/view/:id',auth,async(_0x245c0b,_0x447d83)=>{var _0x2faa25=a0_0x5494d4;try{const {username:_0x22c9e8,email:_0x2f5d61,role:_0x1e5161}=_0x245c0b['user'],_0x2a0f82=_0x245c0b[_0x2faa25(0x81)],_0x47b703=await profile[_0x2faa25(0x112)]({'email':_0x2a0f82['email']}),_0x980c5e=await master_shop[_0x2faa25(0x141)](),_0x2c2796=await transfers_finished[_0x2faa25(0xfe)](_0x245c0b[_0x2faa25(0xd8)]['id']);let _0x40f360=new Date(_0x2c2796[_0x2faa25(0xd3)]),_0x1c3997=('0'+_0x40f360[_0x2faa25(0xe3)]())[_0x2faa25(0x133)](-0x2),_0x3a92b1=('0'+(_0x40f360[_0x2faa25(0x12e)]()+0x1))[_0x2faa25(0x133)](-0x2),_0x56dbf3=_0x40f360[_0x2faa25(0x102)](),_0x3c7b9b=_0x56dbf3+'-'+_0x3a92b1+'-'+_0x1c3997,_0x28ba31;if(_0x2a0f82[_0x2faa25(0x13d)]=='staff'){const _0x10b35e=await staff['findOne']({'email':_0x2a0f82[_0x2faa25(0x109)]});_0x28ba31=await warehouse[_0x2faa25(0x141)]({'status':_0x2faa25(0xee),'name':_0x10b35e['warehouse'],'warehouse_category':_0x2faa25(0x9a)});}else _0x28ba31=await warehouse[_0x2faa25(0x141)]({'status':_0x2faa25(0xee),'warehouse_category':'Finished\x20Goods'});const _0x371e2c=await warehouse['aggregate']([{'$match':{'name':_0x2c2796['from_warehouse'],'room':_0x2c2796[_0x2faa25(0x119)]}},{'$unwind':_0x2faa25(0x7d)},{'$group':{'_id':_0x2faa25(0x97),'name':{'$first':_0x2faa25(0x12a)},'product_stock':{'$first':_0x2faa25(0xd7)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2faa25(0xd4)},'primary_code':{'$first':_0x2faa25(0x78)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2faa25(0x75)}}}]);var _0x41d941=[0x1,0x2,0x3,0x4],_0x23a27e=['A','B','C','D','E','F','G','H','I','J'],_0x2a5bc6=[_0x2faa25(0xe4),_0x2faa25(0xaa)];const _0x2148a7=await product[_0x2faa25(0x141)]({}),_0x1054ab=BayBinSelected(_0x2c2796[_0x2faa25(0x10f)],_0x2c2796[_0x2faa25(0xa3)]);if(_0x980c5e[0x0][_0x2faa25(0xa2)]==_0x2faa25(0x128)){var _0x194195=users[_0x2faa25(0x136)];console[_0x2faa25(0x89)](_0x194195);}else{if(_0x980c5e[0x0][_0x2faa25(0xa2)]==_0x2faa25(0xe9))var _0x194195=users[_0x2faa25(0xe9)];else{if(_0x980c5e[0x0][_0x2faa25(0xa2)]==_0x2faa25(0x117))var _0x194195=users[_0x2faa25(0x117)];else{if(_0x980c5e[0x0][_0x2faa25(0xa2)]=='Spanish')var _0x194195=users[_0x2faa25(0x123)];else{if(_0x980c5e[0x0][_0x2faa25(0xa2)]==_0x2faa25(0xec))var _0x194195=users[_0x2faa25(0xec)];else{if(_0x980c5e[0x0][_0x2faa25(0xa2)]==_0x2faa25(0x129))var _0x194195=users[_0x2faa25(0x80)];else{if(_0x980c5e[0x0]['language']=='Chinese')var _0x194195=users[_0x2faa25(0x12f)];else{if(_0x980c5e[0x0]['language']=='Arabic\x20(ae)')var _0x194195=users[_0x2faa25(0xf7)];}}}}}}}_0x447d83[_0x2faa25(0x127)]('edit_transfer_finished',{'success':_0x245c0b[_0x2faa25(0x87)]('success'),'errors':_0x245c0b[_0x2faa25(0x87)](_0x2faa25(0xc0)),'role':_0x2a0f82,'profile':_0x47b703,'master_shop':_0x980c5e,'warehouse':_0x28ba31,'transfer':_0x2c2796,'stock':_0x371e2c,'unit':_0x2148a7,'language':_0x194195,'levels':_0x41d941,'Isle':_0x23a27e,'rooms_data':_0x2a5bc6,'ed_fullDate':_0x3c7b9b,'dataSelected':_0x1054ab});}catch(_0x2d3b6e){console['log'](_0x2d3b6e);}}),router['post'](a0_0x5494d4(0xb4),auth,async(_0x5ce4b9,_0x3e8f11)=>{var _0x51a4b2=a0_0x5494d4;try{const _0x1b818a=_0x5ce4b9[_0x51a4b2(0xd8)]['id'];console[_0x51a4b2(0x89)](_0x5ce4b9[_0x51a4b2(0x7b)]);const _0x275434=await transfers_finished[_0x51a4b2(0xfe)](_0x1b818a);console[_0x51a4b2(0x89)](_0x51a4b2(0x85),_0x275434);const {date:_0x501067,from_warehouse:_0x4cbb2a,FromRoom_name:_0x576f0f,to_warehouse:_0x5c12cd,ToRoom_name:_0x5197b3,prod_name:_0x2e3625,from_prod_qty:_0x38168b,from_prod_level:_0x2771b8,from_prod_isle:_0x153cda,from_prod_pallet:_0x51b384,to_prod_qty:_0x5bd17a,to_prod_level:_0x688f63,to_prod_isle:_0x320aaf,to_prod_pallet:_0x477f3c,primary_code:_0x4ea110,secondary_code:_0x3aee6f,product_code3:_0x38db3e,note:_0x105911,invoice:_0x10c81f,expiry_date:_0x23812b}=_0x5ce4b9['body'];if(typeof _0x2e3625=='string')var _0x45ffa4=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0xc6)]],_0x2f3aa8=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x131)]],_0x156b9a=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x108)]],_0x38b223=[_0x5ce4b9['body'][_0x51a4b2(0x77)]],_0x5d477e=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x121)]],_0x53199c=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x9d)]],_0x2b6d46=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x120)]],_0x28efc5=[_0x5ce4b9['body'][_0x51a4b2(0x132)]],_0x5b5a82=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x74)]],_0x444b00=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x79)]],_0xe55a7f=[_0x5ce4b9['body'][_0x51a4b2(0x82)]],_0x222134=[_0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x71)]],_0x564e38=[_0x5ce4b9[_0x51a4b2(0x7b)]['expiry_date']];else var _0x45ffa4=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0xc6)]],_0x2f3aa8=[..._0x5ce4b9['body'][_0x51a4b2(0x131)]],_0x156b9a=[..._0x5ce4b9[_0x51a4b2(0x7b)]['from_prod_level']],_0x38b223=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x77)]],_0x5d477e=[..._0x5ce4b9['body'][_0x51a4b2(0x121)]],_0x53199c=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x9d)]],_0x2b6d46=[..._0x5ce4b9['body'][_0x51a4b2(0x120)]],_0x28efc5=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x132)]],_0x5b5a82=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x74)]],_0x444b00=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0x79)]],_0xe55a7f=[..._0x5ce4b9['body'][_0x51a4b2(0x82)]],_0x222134=[..._0x5ce4b9[_0x51a4b2(0x7b)]['batch_code']],_0x564e38=[..._0x5ce4b9[_0x51a4b2(0x7b)][_0x51a4b2(0xd3)]];const _0x2abef0=_0x45ffa4[_0x51a4b2(0x10d)](_0x3bf7bb=>{return _0x3bf7bb={'product_name':_0x3bf7bb};});_0x2f3aa8['forEach']((_0xc1ca5d,_0x270ed7)=>{var _0x20bac0=_0x51a4b2;_0x2abef0[_0x270ed7][_0x20bac0(0x106)]=_0xc1ca5d;}),_0x156b9a[_0x51a4b2(0xed)]((_0x3c5cb8,_0x5babc0)=>{var _0x24cb04=_0x51a4b2;_0x2abef0[_0x5babc0][_0x24cb04(0x10b)]=_0x3c5cb8;}),_0x38b223['forEach']((_0x3107ea,_0x23cf3d)=>{var _0x214e3d=_0x51a4b2;_0x2abef0[_0x23cf3d][_0x214e3d(0x88)]=_0x3107ea;}),_0x5d477e[_0x51a4b2(0xed)]((_0x17f67b,_0x492444)=>{var _0x4667f0=_0x51a4b2;_0x2abef0[_0x492444][_0x4667f0(0xb7)]=_0x17f67b;}),_0x53199c[_0x51a4b2(0xed)]((_0xdef500,_0x289596)=>{var _0x285abb=_0x51a4b2;_0x2abef0[_0x289596][_0x285abb(0x9d)]=_0xdef500;}),_0x2b6d46['forEach']((_0x6ad00c,_0x1cf426)=>{var _0x51d0c7=_0x51a4b2;_0x2abef0[_0x1cf426][_0x51d0c7(0x120)]=_0x6ad00c;}),_0x28efc5['forEach']((_0x2dedb4,_0x43b540)=>{_0x2abef0[_0x43b540]['product_code']=_0x2dedb4;}),_0x5b5a82[_0x51a4b2(0xed)]((_0x49e4c9,_0x2b421a)=>{var _0x37fdc7=_0x51a4b2;_0x2abef0[_0x2b421a][_0x37fdc7(0xbc)]=_0x49e4c9;}),_0x444b00['forEach']((_0x1f6a56,_0x46ceb6)=>{var _0x4edffa=_0x51a4b2;_0x2abef0[_0x46ceb6][_0x4edffa(0x79)]=_0x1f6a56;}),_0xe55a7f[_0x51a4b2(0xed)]((_0x3f3c87,_0x32d229)=>{var _0x5899a6=_0x51a4b2;_0x2abef0[_0x32d229][_0x5899a6(0x82)]=_0x3f3c87;}),_0x222134[_0x51a4b2(0xed)]((_0xcfcbf0,_0x52aa1a)=>{_0x2abef0[_0x52aa1a]['batch_code']=_0xcfcbf0;}),_0x564e38[_0x51a4b2(0xed)]((_0x42cf27,_0x48bb8d)=>{_0x2abef0[_0x48bb8d]['expiry_date']=_0x42cf27;});const _0x17e2cb=_0x2abef0[_0x51a4b2(0x73)](_0x32519c=>_0x32519c['to_quantity']!=='0'&&_0x32519c[_0x51a4b2(0x88)]!==''||_0x32519c['to_floorlevel']!=='0'&&_0x32519c[_0x51a4b2(0x10c)]!=='');var _0x274705=0x0;_0x17e2cb['forEach'](_0x95753e=>{var _0x46e43c=_0x51a4b2;parseInt(_0x95753e[_0x46e43c(0x106)])<parseInt(_0x95753e[_0x46e43c(0x88)])&&_0x274705++;});if(_0x274705!=0x0)return _0x5ce4b9['flash'](_0x51a4b2(0xc0),_0x51a4b2(0x126)),_0x3e8f11[_0x51a4b2(0x93)]('back');const _0x2ede5e=await warehouse['findOne']({'name':_0x275434[_0x51a4b2(0xe0)],'room':_0x275434[_0x51a4b2(0x119)]});_0x275434['product'][_0x51a4b2(0xed)](_0x503eda=>{var _0x33f571=_0x51a4b2;if(_0x503eda[_0x33f571(0x88)]>0x0){const _0x5b3b7b=_0x2ede5e['product_details'][_0x33f571(0x10d)](_0x1b2584=>{var _0x2a51a4=_0x33f571;_0x1b2584['product_name']==_0x503eda[_0x2a51a4(0xa5)]&&_0x1b2584[_0x2a51a4(0x12d)]==_0x503eda[_0x2a51a4(0x10b)]&&(_0x1b2584[_0x2a51a4(0xf1)]=parseInt(_0x1b2584[_0x2a51a4(0xf1)])+parseInt(_0x503eda[_0x2a51a4(0x88)]));});}}),await _0x2ede5e['save']();const _0x1d213e=await warehouse[_0x51a4b2(0x112)]({'name':_0x275434[_0x51a4b2(0x10f)],'room':_0x275434[_0x51a4b2(0xa3)]});_0x275434[_0x51a4b2(0x139)]['forEach'](_0x7ee4c4=>{var _0x5dfb75=_0x51a4b2;if(_0x7ee4c4['to_quantity']>0x0){const _0x309748=_0x1d213e[_0x5dfb75(0x13a)][_0x5dfb75(0x10d)](_0x545ba4=>{var _0x51974c=_0x5dfb75;_0x545ba4[_0x51974c(0xa5)]==_0x7ee4c4[_0x51974c(0xa5)]&&_0x545ba4[_0x51974c(0x12d)]==_0x7ee4c4[_0x51974c(0xb7)]&&(_0x545ba4[_0x51974c(0xf1)]=parseInt(_0x545ba4[_0x51974c(0xf1)])-parseInt(_0x7ee4c4[_0x51974c(0x88)]));});}}),await _0x1d213e['save'](),_0x275434[_0x51a4b2(0x143)]=_0x501067,_0x275434[_0x51a4b2(0xe0)]=_0x4cbb2a,_0x275434['to_warehouse']=_0x5c12cd,_0x275434[_0x51a4b2(0x139)]=_0x17e2cb,_0x275434['note']=_0x105911,_0x275434[_0x51a4b2(0x13b)]=_0x10c81f;const _0x241b94=await _0x275434[_0x51a4b2(0x8a)](),_0x2bb2b4=await warehouse[_0x51a4b2(0x112)]({'name':_0x4cbb2a,'room':_0x576f0f});_0x241b94[_0x51a4b2(0x139)][_0x51a4b2(0xed)](_0x52e4ac=>{var _0x3486b9=_0x51a4b2;if(_0x52e4ac[_0x3486b9(0x88)]>0x0){const _0x40b749=_0x2bb2b4[_0x3486b9(0x13a)]['map'](_0x5e9256=>{var _0x2e6856=_0x3486b9;_0x5e9256[_0x2e6856(0xa5)]==_0x52e4ac[_0x2e6856(0xa5)]&&_0x5e9256[_0x2e6856(0x12d)]==_0x52e4ac[_0x2e6856(0x10b)]&&(_0x5e9256[_0x2e6856(0xf1)]=parseInt(_0x5e9256[_0x2e6856(0xf1)])-parseInt(_0x52e4ac[_0x2e6856(0x88)]));});}}),await _0x2bb2b4[_0x51a4b2(0x8a)]();const _0x8c734f=await warehouse[_0x51a4b2(0x112)]({'name':_0x5c12cd,'room':_0x5197b3});_0x241b94[_0x51a4b2(0x139)]['forEach'](_0x31c7c4=>{var _0x35cf93=_0x51a4b2;if(_0x31c7c4[_0x35cf93(0x88)]>0x0){var _0xd234cc=0x0;const _0x4a65ff=_0x8c734f[_0x35cf93(0x13a)]['map'](_0x2fe89d=>{var _0x1b57ea=_0x35cf93;_0x2fe89d[_0x1b57ea(0xa5)]==_0x31c7c4[_0x1b57ea(0xa5)]&&_0x2fe89d[_0x1b57ea(0x12d)]==_0x31c7c4['to_bay']&&(_0x2fe89d[_0x1b57ea(0xf1)]=parseInt(_0x2fe89d['product_stock'])+parseInt(_0x31c7c4['to_quantity']),_0xd234cc++);});_0xd234cc=='0'&&(_0x8c734f[_0x35cf93(0x13a)]=_0x8c734f[_0x35cf93(0x13a)][_0x35cf93(0xad)]({'product_name':_0x31c7c4[_0x35cf93(0xa5)],'product_stock':_0x31c7c4[_0x35cf93(0x88)],'bay':_0x31c7c4[_0x35cf93(0xb7)],'product_code':_0x31c7c4[_0x35cf93(0xc9)],'primary_code':_0x31c7c4[_0x35cf93(0x9d)],'secondary_code':_0x31c7c4[_0x35cf93(0x120)],'maxProducts':_0x31c7c4[_0x35cf93(0xbc)]}));}}),await _0x8c734f[_0x51a4b2(0x8a)](),_0x5ce4b9[_0x51a4b2(0x87)](_0x51a4b2(0xa7),_0x51a4b2(0xb1)),_0x3e8f11[_0x51a4b2(0x93)](_0x51a4b2(0x99));}catch(_0x3ac58b){console[_0x51a4b2(0x89)](_0x3ac58b);}}),router[a0_0x5494d4(0xc2)](a0_0x5494d4(0x135),async(_0x2db150,_0x18c3ce)=>{var _0x23433a=a0_0x5494d4;const {FromWareHouse:_0x2a3f38,FromRoom:_0x2a770f,ToWarehouse:_0x14edcd,ToRoom:_0x5dec8d,primary_code:_0x3da8c3,Roomslist:_0x218198}=_0x2db150[_0x23433a(0x7b)],_0x52a22e=_0x218198[_0x23433a(0x70)](','),_0x3abc28=[];async function _0x4689aa(_0x5b9cc4){var _0x3fc926=_0x23433a;const _0x5d5afd=await warehouse[_0x3fc926(0xd9)]([{'$match':{'name':_0x2a3f38,'room':_0x5b9cc4}},{'$unwind':_0x3fc926(0x7d)},{'$match':{'product_details.primary_code':_0x3da8c3}},{'$group':{'_id':_0x3fc926(0x97),'name':{'$first':_0x3fc926(0x12a)},'instock':{'$first':_0x3fc926(0xd7)},'primary_code':{'$first':_0x3fc926(0x78)},'secondary_code':{'$first':_0x3fc926(0x12b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3fc926(0xa4)},'isle':{'$first':_0x3fc926(0xda)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3fc926(0x101)},'secondary_unit':{'$first':_0x3fc926(0xbb)},'storage':{'$first':_0x3fc926(0x92)},'rack':{'$first':_0x3fc926(0x75)},'expiry_date':{'$first':_0x3fc926(0xa1)},'production_date':{'$first':_0x3fc926(0xea)},'batch_code':{'$first':_0x3fc926(0x6d)},'maxPerUnit':{'$first':_0x3fc926(0xcc)},'roomNamed':{'$first':_0x3fc926(0x110)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x3fc926(0xe5)}}}]),_0x5cdb78=await warehouse['aggregate']([{'$match':{'name':_0x2a3f38,'room':_0x5b9cc4}},{'$unwind':_0x3fc926(0x7d)},{'$match':{'product_details.secondary_code':_0x3da8c3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3fc926(0x12a)},'instock':{'$first':_0x3fc926(0xd7)},'primary_code':{'$first':_0x3fc926(0x78)},'secondary_code':{'$first':_0x3fc926(0x12b)},'product_code':{'$first':_0x3fc926(0x9c)},'level':{'$first':_0x3fc926(0xa4)},'isle':{'$first':_0x3fc926(0xda)},'type':{'$first':_0x3fc926(0xa8)},'pallet':{'$first':_0x3fc926(0xd4)},'unit':{'$first':_0x3fc926(0x101)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3fc926(0x92)},'rack':{'$first':_0x3fc926(0x75)},'expiry_date':{'$first':_0x3fc926(0xa1)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x3fc926(0x6d)},'maxPerUnit':{'$first':_0x3fc926(0xcc)},'roomNamed':{'$first':_0x3fc926(0x110)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x5d5afd['length']>0x0)_0x3abc28[_0x3fc926(0xc7)](_0x5d5afd);else _0x5cdb78[_0x3fc926(0x8d)]>0x0&&_0x3abc28[_0x3fc926(0xc7)](_0x5cdb78);}const _0x41228a=_0x52a22e[_0x23433a(0x10d)](_0x2123b0=>_0x4689aa(_0x2123b0));await Promise['all'](_0x41228a),_0x18c3ce[_0x23433a(0xab)](_0x3abc28);}),router[a0_0x5494d4(0xc2)](a0_0x5494d4(0xaf),async(_0x3b74c1,_0x33aa8e)=>{var _0x3c8aa4=a0_0x5494d4;try{const {FromWareHouse:_0x4eb3b4,FromRoom:_0xa9e28c,ToWarehouse:_0x3692c0,ToRoom:_0x5461d6,secondary_code:_0x25329c}=_0x3b74c1['body'],_0x193c65=await warehouse[_0x3c8aa4(0xd9)]([{'$match':{'name':_0x4eb3b4}},{'$unwind':_0x3c8aa4(0x7d)},{'$match':{'product_details.secondary_code':_0x25329c}},{'$group':{'_id':_0x3c8aa4(0x97),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x3c8aa4(0x78)},'secondary_code':{'$first':_0x3c8aa4(0x12b)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x3c8aa4(0xd7)},'warehouse':{'$first':'$name'},'level':{'$first':_0x3c8aa4(0x9f)},'isle':{'$first':_0x3c8aa4(0x115)},'pallet':{'$first':_0x3c8aa4(0xd5)},'maxProducts':{'$first':_0x3c8aa4(0xa6)},'unit':{'$first':_0x3c8aa4(0x101)},'expiry_date':{'$first':_0x3c8aa4(0xa1)},'production_date':{'$first':_0x3c8aa4(0xea)}}}]);_0x33aa8e['status'](0xc8)[_0x3c8aa4(0xab)](_0x193c65);}catch(_0xb6597f){_0x33aa8e[_0x3c8aa4(0xe2)](0x194)['json']({'message':_0xb6597f[_0x3c8aa4(0x140)]});}}),router[a0_0x5494d4(0xc2)](a0_0x5494d4(0xbf),async(_0x3e8b22,_0x435cf9)=>{var _0xbdb10e=a0_0x5494d4;try{const {FromWareHouse:_0x473c63,FromRoom:_0x2127e2,ToWarehouse:_0x4fad83,ToRoom:_0xb6d8da,product_code:_0x38e33c}=_0x3e8b22[_0xbdb10e(0x7b)],_0x4b8b56=await warehouse[_0xbdb10e(0xd9)]([{'$match':{'name':_0x473c63}},{'$unwind':_0xbdb10e(0x7d)},{'$match':{'product_details.product_code':_0x38e33c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xbdb10e(0x12a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xbdb10e(0x9c)},'instock':{'$first':_0xbdb10e(0xd7)},'warehouse':{'$first':_0xbdb10e(0xb2)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0xbdb10e(0x115)},'pallet':{'$first':_0xbdb10e(0xd5)},'maxProducts':{'$first':_0xbdb10e(0xa6)},'unit':{'$first':_0xbdb10e(0x101)}}}]);_0x435cf9[_0xbdb10e(0xe2)](0xc8)['json'](_0x4b8b56);}catch(_0x3be077){_0x435cf9[_0xbdb10e(0xe2)](0x194)[_0xbdb10e(0xab)]({'message':_0x3be077[_0xbdb10e(0x140)]});}}),router[a0_0x5494d4(0xc2)](a0_0x5494d4(0x130),async(_0x186ee0,_0x42db52)=>{var _0x393b68=a0_0x5494d4;const {productCode:_0x31ffbd,bay:_0x3567c7,warehouses:_0x527056,room:_0x56918d}=_0x186ee0['body'];console[_0x393b68(0x89)](_0x186ee0[_0x393b68(0x7b)]);try{const _0x48ec0c=await warehouse[_0x393b68(0xd9)]([{'$match':{'name':_0x527056,'room':_0x56918d}},{'$unwind':_0x393b68(0x7d)},{'$match':{'product_details.bay':parseInt(_0x3567c7)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x393b68(0x12a)},'product_stock':{'$first':_0x393b68(0xd7)},'bay':{'$first':_0x393b68(0xa4)},'maxProducts':{'$first':_0x393b68(0xa6)}}}]);_0x42db52[_0x393b68(0xe2)](0xc8)['json'](_0x48ec0c);}catch(_0x1d090a){_0x42db52[_0x393b68(0xe2)](0x194)['json']({'message':_0x1d090a[_0x393b68(0x140)]});}}),module[a0_0x5494d4(0xb5)]=router;