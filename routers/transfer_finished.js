var a0_0x1128df=a0_0x58d1;(function(_0x4705af,_0x4519ca){var _0x2ffa71=a0_0x58d1,_0x525339=_0x4705af();while(!![]){try{var _0x5bed57=-parseInt(_0x2ffa71(0x17f))/0x1+parseInt(_0x2ffa71(0x1bc))/0x2+parseInt(_0x2ffa71(0x199))/0x3+parseInt(_0x2ffa71(0x15c))/0x4+parseInt(_0x2ffa71(0x1d6))/0x5+parseInt(_0x2ffa71(0x134))/0x6*(-parseInt(_0x2ffa71(0x1d7))/0x7)+parseInt(_0x2ffa71(0x1d2))/0x8;if(_0x5bed57===_0x4519ca)break;else _0x525339['push'](_0x525339['shift']());}catch(_0xe222d0){_0x525339['push'](_0x525339['shift']());}}}(a0_0x1c4a,0x73c28));function a0_0x58d1(_0x5d3397,_0x499c7f){var _0x1c4ad1=a0_0x1c4a();return a0_0x58d1=function(_0x58d19b,_0x162c75){_0x58d19b=_0x58d19b-0x129;var _0x2b21a3=_0x1c4ad1[_0x58d19b];return _0x2b21a3;},a0_0x58d1(_0x5d3397,_0x499c7f);}const express=require(a0_0x1128df(0x1b7)),app=express(),router=express[a0_0x1128df(0x16f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x1128df(0x1d1)),auth=require('../middleware/auth'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x1128df(0x1b2));router[a0_0x1128df(0x1ac)](a0_0x1128df(0x19e),auth,async(_0x56da5d,_0x381178)=>{var _0x41e053=a0_0x1128df;try{const {username:_0x59cdd9,email:_0x20e878,role:_0x520fdd}=_0x56da5d['user'],_0x29b3cf=_0x56da5d[_0x41e053(0x1f3)],_0x57588f=await profile[_0x41e053(0x184)]({'email':_0x29b3cf[_0x41e053(0x18e)]}),_0x38ca50=await master_shop['find']();let _0xdaff4d;if(_0x29b3cf[_0x41e053(0x157)]=='staff'){const _0x556527=await staff['findOne']({'email':_0x29b3cf['email']});_0xdaff4d=await transfers_finished[_0x41e053(0x149)]({'from_warehouse':_0x556527[_0x41e053(0x131)]});}else _0xdaff4d=await transfers_finished[_0x41e053(0x204)]([{'$unwind':_0x41e053(0x14e)},{'$group':{'_id':_0x41e053(0x1a5),'invoice':{'$first':_0x41e053(0x1b1)},'date':{'$first':_0x41e053(0x1a0)},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x41e053(0x18f)},'from_room_name':{'$addToSet':_0x41e053(0x191)},'to_room_name':{'$addToSet':_0x41e053(0x1f5)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x1b5))var _0x59ffd8=users[_0x41e053(0x14b)];else{if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x163))var _0x59ffd8=users[_0x41e053(0x163)];else{if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x158))var _0x59ffd8=users['German'];else{if(_0x38ca50[0x0][_0x41e053(0x161)]=='Spanish')var _0x59ffd8=users[_0x41e053(0x1fa)];else{if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x177))var _0x59ffd8=users[_0x41e053(0x177)];else{if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x1aa))var _0x59ffd8=users['Portuguese'];else{if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x1b4))var _0x59ffd8=users[_0x41e053(0x1b4)];else{if(_0x38ca50[0x0][_0x41e053(0x161)]==_0x41e053(0x167))var _0x59ffd8=users[_0x41e053(0x171)];}}}}}}}_0x381178[_0x41e053(0x1f8)]('transfer_finished',{'success':_0x56da5d[_0x41e053(0x159)]('success'),'errors':_0x56da5d[_0x41e053(0x159)](_0x41e053(0x12e)),'role':_0x29b3cf,'profile':_0x57588f,'master_shop':_0x38ca50,'transfer':_0xdaff4d,'language':_0x59ffd8});}catch(_0x2da546){console[_0x41e053(0x1b9)](_0x2da546);}});async function getRandom8DigitNumber(){var _0x879cc7=a0_0x1128df;const _0x36e0b1=0x989680,_0x408bc3=0x5f5e0ff,_0x114823=Math['floor'](Math[_0x879cc7(0x147)]()*(_0x408bc3-_0x36e0b1+0x1))+_0x36e0b1;var _0x317bdd;const _0x21fc5a=await transfers_finished[_0x879cc7(0x184)]({'invoice':_0x879cc7(0x1fc)+_0x114823});return _0x21fc5a&&_0x21fc5a[_0x879cc7(0x1d3)]>0x0?_0x317bdd=_0x879cc7(0x1fc)+_0x114823:_0x317bdd=_0x879cc7(0x1fc)+_0x114823,_0x317bdd;}function a0_0x1c4a(){var _0x417838=['French','success','</tr>','id_transaction','There\x27s\x20a\x20error\x20in\x20this\x20transaction','message','to_invoice','Email\x20sent\x20successfully','750081BbTQYQ','from_room_name','undefined','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Error\x20Occurs','findOne','prod_name','port','\x20<=>\x20','MaxStocks_data2','to_prod_level','json','\x20Order\x20Date\x20:\x20','Enclosed','$product_details.pallet','email','$to_warehouse','Portuguese','$product.from_room_name','$product_details.expiry_date','\x20Order\x20Number\x20:\x20','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.primary_code','unit','to_room','map','1636530dkZoeT','abs','body','FGSEmail','$product_details.bin','/view','batch_code','$date','$product_details._id','/transfer_finished/view','error','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$_id','/view/add_transfer','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div>','/transfer/view','Portuguese\x20(BR)','date','get','$product_details.secondary_code','$room','<tr>','Transfer\x20Edit\x20Successfully','$invoice','nodemailer','$name','Chinese','English\x20(US)','_id','express','then','log','$product_details.isle','image','1253770ehezDs','to_quantity','product_name','To_invoice','save','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','getDate','<html><head><title></title>','$product_details.product_stock','product_date','/barcode_scanner2','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','</td>','$product_details.batch_code','to_bay','$product_details.type','add_transfer_finished','site_title','Rack\x201','</h5>','../models/all_models','1071520fRMvMD','length','$product_details.product_name','params','2307140yTAfmC','4660327lerguV','/transfer_finished/preview/','to_warehouse','</head><body>','back','/barcode_scanner','</div>','$product_details.floorlevel','from_quantity','$product_details.product_code','Product\x20Transfer\x20successfully','to_room_name','filter','prod_cat','to_floorlevel','from_warehouse','$product_details.unit','status','invoice','/view/:id','secondary_code','createTransport','MaxStocks_data','product','<strong>\x20Regards\x20</strong>','primary_code','post','Enabled','user','$product_details.maxProducts','$product.to_room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','all','render','product_code3','Spanish','/../public','TRFF-','exports','<h5\x20style=\x22text-align:\x20left;\x22>','from_prod_level','$product_details.rack','catch','redirect','FROZEN\x20GOODS','aggregate','transfer_data','concat','$product_details.secondary_unit','product_stock','/CheckingWarehouse','expiry_date','errors','from_prod_qty','note','warehouse','True','\x20</h2>','6EBmAnF','<hr\x20class=\x22my-3\x22>','getFullYear','updateOne','</body></html>','to_prod_qty','here2','secondary_unit','product_code','</tbody>','ToRoomAssigned','<h5>','from_room','edit_transfer_finished','$product_details.invoice','Logo.png','password','string','<table\x20style=\x22width:\x20100%\x20!important;\x22>','random','$product_details','find','here1','English','from_bay','Rack\x202','$product','primary_unit','QA\x20Warehouse','maxPerUnit','DRY\x20GOODS','push','production_date','findById','Finished\x20Goods','role','German','flash','Ambient','<h2>\x20','488924hynpKC','staff','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','forEach','max','language','/preview/:id','Hindi','$product_details.production_date','slice','\x20<>\x20','Arabic\x20(ae)','</table>','maxProducts','padStart','product_details','from_invoice','RoomAssigned','$product_details.bay','Router','New_Qty_Converted','Arabic','bay','$product_details.level','finalize','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<thead\x20style=\x22width:\x20100%\x20!important;\x22>'];a0_0x1c4a=function(){return _0x417838;};return a0_0x1c4a();}router['get'](a0_0x1128df(0x1a6),auth,async(_0x31a21a,_0x172fc4)=>{var _0x27130d=a0_0x1128df;try{const {username:_0x282321,email:_0x4eb87a,role:_0x38ce3a}=_0x31a21a[_0x27130d(0x1f3)],_0xd3d024=_0x31a21a[_0x27130d(0x1f3)],_0x3e470a=await profile[_0x27130d(0x184)]({'email':_0xd3d024[_0x27130d(0x18e)]}),_0x3033ee=await master_shop[_0x27130d(0x149)]();let _0x443cb0;if(_0xd3d024['role']==_0x27130d(0x15d)){const _0xe24852=await staff[_0x27130d(0x184)]({'email':_0xd3d024[_0x27130d(0x18e)]});_0x443cb0=await warehouse[_0x27130d(0x204)]([{'$match':{'status':_0x27130d(0x1f2),'name':_0xe24852[_0x27130d(0x131)],'warehouse_category':_0x27130d(0x156),'name':{'$ne':_0x27130d(0x150)}}},{'$group':{'_id':_0x27130d(0x1b3),'name':{'$first':_0x27130d(0x1b3)}}}]);}else _0x443cb0=await warehouse[_0x27130d(0x204)]([{'$match':{'status':_0x27130d(0x1f2),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x27130d(0x150)}}},{'$group':{'_id':'$name','name':{'$first':_0x27130d(0x1b3)}}}]);const _0x5b3119=await transfers_finished[_0x27130d(0x149)]({}),_0x594763=_0x5b3119[_0x27130d(0x1d3)]+0x1,_0x28072e=_0x27130d(0x1fc)+_0x594763['toString']()[_0x27130d(0x16a)](0x5,'0');if(_0x3033ee[0x0][_0x27130d(0x161)]==_0x27130d(0x1b5))var _0x3fe62e=users[_0x27130d(0x14b)];else{if(_0x3033ee[0x0]['language']==_0x27130d(0x163))var _0x3fe62e=users[_0x27130d(0x163)];else{if(_0x3033ee[0x0][_0x27130d(0x161)]==_0x27130d(0x158))var _0x3fe62e=users[_0x27130d(0x158)];else{if(_0x3033ee[0x0][_0x27130d(0x161)]==_0x27130d(0x1fa))var _0x3fe62e=users['Spanish'];else{if(_0x3033ee[0x0][_0x27130d(0x161)]=='French')var _0x3fe62e=users[_0x27130d(0x177)];else{if(_0x3033ee[0x0][_0x27130d(0x161)]==_0x27130d(0x1aa))var _0x3fe62e=users[_0x27130d(0x190)];else{if(_0x3033ee[0x0][_0x27130d(0x161)]==_0x27130d(0x1b4))var _0x3fe62e=users[_0x27130d(0x1b4)];else{if(_0x3033ee[0x0][_0x27130d(0x161)]==_0x27130d(0x167))var _0x3fe62e=users[_0x27130d(0x171)];}}}}}}}const _0x498419=getRandom8DigitNumber();_0x498419[_0x27130d(0x1b8)](_0x18ecbb=>{var _0xd0526d=_0x27130d;_0x172fc4[_0xd0526d(0x1f8)](_0xd0526d(0x1cd),{'success':_0x31a21a[_0xd0526d(0x159)](_0xd0526d(0x178)),'errors':_0x31a21a[_0xd0526d(0x159)](_0xd0526d(0x12e)),'role':_0xd3d024,'profile':_0x3e470a,'master_shop':_0x3033ee,'warehouse':_0x443cb0,'language':_0x3fe62e,'invoice':_0x18ecbb});})[_0x27130d(0x201)](_0xd448a8=>{var _0x54bfa6=_0x27130d;_0x31a21a[_0x54bfa6(0x159)](_0x54bfa6(0x12e),_0x54bfa6(0x17b)),_0x172fc4['redirect'](_0x54bfa6(0x1a9));});}catch(_0x1a2d2e){console['log'](_0x1a2d2e);}}),router[a0_0x1128df(0x1f1)]('/view/add_transfer',auth,async(_0x7d3801,_0x350a07)=>{var _0x1389e1=a0_0x1128df;try{const {date:_0xf5d6bd,from_warehouse:_0x5bc33f,FromRoom_name:_0x17d9b1,to_warehouse:_0x44b3f4,ToRoom_name:_0x4a35ca,prod_name:_0x2901fe,from_prod_qty:_0x38825f,from_prod_level:_0x2deb65,from_prod_isle:_0x237bc0,from_prod_pallet:_0x4146e1,to_prod_qty:_0xa9c35b,to_prod_level:_0x47000,to_prod_isle:_0x11733c,to_prod_pallet:_0x2adac6,primary_code:_0xed0ea8,secondary_code:_0x3c6bfd,product_code3:_0x293e4e,note:_0x1d04c6,MaxStocks_data2:_0x25436e,invoice:_0x396090,expiry_date:_0xd38196}=_0x7d3801[_0x1389e1(0x19b)];if(typeof _0x2901fe==_0x1389e1(0x145))var _0x18bea7=[_0x7d3801[_0x1389e1(0x19b)]['prod_name']],_0x319ae2=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x12f)]],_0x46d367=[_0x7d3801['body'][_0x1389e1(0x1ff)]],_0x4fb32d=[_0x7d3801['body'][_0x1389e1(0x170)]],_0x4de6e0=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x189)]],_0x4cf42f=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x1f0)]],_0x515d88=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x1eb)]],_0x5687c4=[_0x7d3801[_0x1389e1(0x19b)]['product_code3']],_0x45e415=[_0x7d3801['body'][_0x1389e1(0x188)]],_0x2b1bf7=[_0x7d3801['body'][_0x1389e1(0x14f)]],_0x527681=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x13b)]],_0x5af634=[_0x7d3801['body'][_0x1389e1(0x19f)]],_0x420d06=[_0x7d3801['body'][_0x1389e1(0x12d)]],_0x2830c6=[_0x7d3801[_0x1389e1(0x19b)]['product_date']],_0x4a5875=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x1ed)]],_0x39ed8f=[_0x7d3801['body'][_0x1389e1(0x151)]],_0x3197a3=[_0x7d3801[_0x1389e1(0x19b)]['prod_cat']],_0x5aa096=[_0x7d3801['body'][_0x1389e1(0x16d)]],_0xe43fca=[_0x7d3801['body'][_0x1389e1(0x13e)]],_0x22ebc2=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x16c)]],_0x330682=[_0x7d3801['body'][_0x1389e1(0x17d)]],_0x1d9dba=[_0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x17a)]];else var _0x18bea7=[..._0x7d3801['body'][_0x1389e1(0x185)]],_0x319ae2=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x12f)]],_0x46d367=[..._0x7d3801[_0x1389e1(0x19b)]['from_prod_level']],_0x4fb32d=[..._0x7d3801['body']['New_Qty_Converted']],_0x4de6e0=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x189)]],_0x4cf42f=[..._0x7d3801[_0x1389e1(0x19b)]['primary_code']],_0x515d88=[..._0x7d3801[_0x1389e1(0x19b)]['secondary_code']],_0x5687c4=[..._0x7d3801['body'][_0x1389e1(0x1f9)]],_0x45e415=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x188)]],_0x2b1bf7=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x14f)]],_0x527681=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x13b)]],_0x5af634=[..._0x7d3801['body'][_0x1389e1(0x19f)]],_0x420d06=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x12d)]],_0x2830c6=[..._0x7d3801['body'][_0x1389e1(0x1c6)]],_0x4a5875=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x1ed)]],_0x39ed8f=[..._0x7d3801[_0x1389e1(0x19b)]['maxPerUnit']],_0x3197a3=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x1e4)]],_0x5aa096=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x16d)]],_0xe43fca=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x13e)]],_0x22ebc2=[..._0x7d3801['body'][_0x1389e1(0x16c)]],_0x330682=[..._0x7d3801[_0x1389e1(0x19b)][_0x1389e1(0x17d)]],_0x1d9dba=[..._0x7d3801[_0x1389e1(0x19b)]['id_transaction']];const _0x163c72=_0x18bea7[_0x1389e1(0x198)](_0x16be60=>{return _0x16be60={'product_name':_0x16be60};});_0x319ae2[_0x1389e1(0x15f)]((_0x58fd03,_0x1a43b6)=>{var _0x45635b=_0x1389e1;_0x163c72[_0x1a43b6][_0x45635b(0x1df)]=_0x58fd03;}),_0x46d367['forEach']((_0x267f03,_0x1a862e)=>{var _0xbe2ead=_0x1389e1;_0x163c72[_0x1a862e][_0xbe2ead(0x14c)]=_0x267f03;}),_0x1d9dba[_0x1389e1(0x15f)]((_0x12b313,_0x587f48)=>{var _0x27d21c=_0x1389e1;_0x163c72[_0x587f48][_0x27d21c(0x17a)]=_0x12b313;}),_0x22ebc2['forEach']((_0x11692b,_0x4a0904)=>{var _0xdfbdf=_0x1389e1;_0x163c72[_0x4a0904][_0xdfbdf(0x16c)]=_0x11692b;}),_0x330682[_0x1389e1(0x15f)]((_0x5a8e1e,_0x20c82a)=>{var _0x42afb8=_0x1389e1;_0x163c72[_0x20c82a][_0x42afb8(0x1bf)]=_0x5a8e1e;}),_0x4fb32d[_0x1389e1(0x15f)]((_0x17541e,_0x41114b)=>{var _0x2e74a1=_0x1389e1;_0x163c72[_0x41114b][_0x2e74a1(0x1bd)]=_0x17541e;}),_0x4de6e0[_0x1389e1(0x15f)]((_0x102f13,_0xa0d482)=>{var _0x2e7809=_0x1389e1;_0x163c72[_0xa0d482][_0x2e7809(0x1cb)]=_0x102f13;}),_0x4cf42f[_0x1389e1(0x15f)]((_0x4f391b,_0x3cbb69)=>{_0x163c72[_0x3cbb69]['primary_code']=_0x4f391b;}),_0x515d88['forEach']((_0x625b3a,_0x5a46ad)=>{var _0x319a22=_0x1389e1;_0x163c72[_0x5a46ad][_0x319a22(0x1eb)]=_0x625b3a;}),_0x5687c4[_0x1389e1(0x15f)]((_0x280774,_0x59db83)=>{var _0x5d3bff=_0x1389e1;_0x163c72[_0x59db83][_0x5d3bff(0x13c)]=_0x280774;}),_0x45e415[_0x1389e1(0x15f)]((_0x454788,_0x223a19)=>{var _0x42f2cc=_0x1389e1;_0x163c72[_0x223a19][_0x42f2cc(0x169)]=_0x454788;}),_0x2b1bf7[_0x1389e1(0x15f)]((_0x11ca2e,_0x5781bd)=>{var _0x1413ad=_0x1389e1;_0x163c72[_0x5781bd][_0x1413ad(0x196)]=_0x11ca2e;}),_0x527681[_0x1389e1(0x15f)]((_0x52eb25,_0x46d117)=>{var _0x4ef284=_0x1389e1;_0x163c72[_0x46d117][_0x4ef284(0x13b)]=_0x52eb25;}),_0x5af634[_0x1389e1(0x15f)]((_0x5ced28,_0x2c93e7)=>{var _0x1c0369=_0x1389e1;_0x163c72[_0x2c93e7][_0x1c0369(0x19f)]=_0x5ced28;}),_0x420d06[_0x1389e1(0x15f)]((_0x13aaeb,_0x304521)=>{var _0x1a3dbf=_0x1389e1;_0x163c72[_0x304521][_0x1a3dbf(0x12d)]=_0x13aaeb;}),_0x2830c6[_0x1389e1(0x15f)]((_0xc012e8,_0x3169c1)=>{var _0xcff6a4=_0x1389e1;_0x163c72[_0x3169c1][_0xcff6a4(0x154)]=_0xc012e8;}),_0x4a5875['forEach']((_0x3911e7,_0x2349ff)=>{var _0x5e8343=_0x1389e1;_0x163c72[_0x2349ff][_0x5e8343(0x169)]=_0x3911e7;}),_0x39ed8f['forEach']((_0x1fe746,_0x4f416e)=>{var _0x4e1c85=_0x1389e1;_0x163c72[_0x4f416e][_0x4e1c85(0x151)]=_0x1fe746;}),_0x3197a3['forEach']((_0x25b48a,_0x1333ac)=>{var _0x2db6ba=_0x1389e1;_0x163c72[_0x1333ac][_0x2db6ba(0x1e4)]=_0x25b48a;}),_0x5aa096['forEach']((_0x5edbe1,_0x3f56a5)=>{var _0x57ebb9=_0x1389e1;_0x163c72[_0x3f56a5][_0x57ebb9(0x180)]=_0x5edbe1;}),_0xe43fca[_0x1389e1(0x15f)]((_0x1c75bb,_0x5571d7)=>{_0x163c72[_0x5571d7]['to_room_name']=_0x1c75bb;});const _0x147f87=_0x163c72[_0x1389e1(0x1e3)](_0x4647c4=>_0x4647c4[_0x1389e1(0x1bd)]!=='0'&&_0x4647c4[_0x1389e1(0x1bd)]!==''||_0x4647c4[_0x1389e1(0x1e5)]!=='0'&&_0x4647c4[_0x1389e1(0x1e5)]!=='');var _0x13a239=0x0;_0x147f87[_0x1389e1(0x15f)](_0x5bbf48=>{parseInt(_0x5bbf48['from_quantity'])<parseInt(_0x5bbf48['to_quantity'])&&_0x13a239++;});if(_0x13a239!=0x0)return _0x7d3801['flash'](_0x1389e1(0x12e),_0x1389e1(0x175)),_0x350a07[_0x1389e1(0x202)]('back');const _0x4e9f21=new transfers_finished({'date':_0xf5d6bd,'from_warehouse':_0x5bc33f,'to_warehouse':_0x44b3f4,'product':_0x147f87,'note':_0x1d04c6,'invoice':_0x396090}),_0xfc0cf6=await _0x4e9f21['save']();_0x7d3801[_0x1389e1(0x159)]('success',_0x1389e1(0x1e1)),_0x350a07['redirect'](_0x1389e1(0x1d8)+_0xfc0cf6['_id']);}catch(_0x4f117c){console['log'](_0x4f117c),_0x350a07['status'](0xc8)[_0x1389e1(0x18a)]({'errorMessage':_0x4f117c[_0x1389e1(0x17c)]});}}),router['get'](a0_0x1128df(0x162),auth,async(_0x360c90,_0x4d2e3e)=>{var _0x360a0c=a0_0x1128df;try{const {username:_0x2e2618,email:_0x5c4a85,role:_0x2d3ccd}=_0x360c90['user'],_0x333d28=_0x360c90[_0x360a0c(0x1f3)],_0x37503d=await profile['findOne']({'email':_0x333d28['email']}),_0x3b6887=await master_shop[_0x360a0c(0x149)](),_0x2fed73=await transfers_finished[_0x360a0c(0x155)](_0x360c90['params']['id']);let _0x55201e;if(_0x333d28[_0x360a0c(0x157)]==_0x360a0c(0x15d)){const _0x48ea6c=await staff[_0x360a0c(0x184)]({'email':_0x333d28[_0x360a0c(0x18e)]});_0x55201e=await warehouse['find']({'status':_0x360a0c(0x1f2),'name':_0x48ea6c['warehouse'],'warehouse_category':_0x360a0c(0x156)});}else _0x55201e=await warehouse['find']({'status':_0x360a0c(0x1f2),'warehouse_category':'Finished\x20Goods'});const _0x54a639=await warehouse['aggregate']([{'$match':{'name':_0x2fed73[_0x360a0c(0x1e6)],'warehouse_category':_0x360a0c(0x156)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x360a0c(0x1a1),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x360a0c(0x1c5)},'bay':{'$first':_0x360a0c(0x16e)},'bin':{'$first':_0x360a0c(0x19d)},'type':{'$first':_0x360a0c(0x1cc)},'floorlevel':{'$first':_0x360a0c(0x1de)},'primary_code':{'$first':_0x360a0c(0x195)},'secondary_code':{'$first':_0x360a0c(0x1ad)},'product_code':{'$first':_0x360a0c(0x1e0)},'storage':{'$first':_0x360a0c(0x1c1)},'rack':{'$first':_0x360a0c(0x200)},'expiry_date':{'$first':_0x360a0c(0x192)},'production_date':{'$first':_0x360a0c(0x164)},'room':{'$first':_0x360a0c(0x1ae)},'warehoue_name':{'$first':_0x360a0c(0x1b3)}}}]),_0x5628c0=await product['find']({});if(_0x3b6887[0x0][_0x360a0c(0x161)]=='English\x20(US)'){var _0x49cef6=users[_0x360a0c(0x14b)];console[_0x360a0c(0x1b9)](_0x49cef6);}else{if(_0x3b6887[0x0]['language']==_0x360a0c(0x163))var _0x49cef6=users[_0x360a0c(0x163)];else{if(_0x3b6887[0x0][_0x360a0c(0x161)]=='German')var _0x49cef6=users[_0x360a0c(0x158)];else{if(_0x3b6887[0x0][_0x360a0c(0x161)]==_0x360a0c(0x1fa))var _0x49cef6=users[_0x360a0c(0x1fa)];else{if(_0x3b6887[0x0]['language']=='French')var _0x49cef6=users[_0x360a0c(0x177)];else{if(_0x3b6887[0x0]['language']==_0x360a0c(0x1aa))var _0x49cef6=users[_0x360a0c(0x190)];else{if(_0x3b6887[0x0][_0x360a0c(0x161)]=='Chinese')var _0x49cef6=users[_0x360a0c(0x1b4)];else{if(_0x3b6887[0x0][_0x360a0c(0x161)]==_0x360a0c(0x167))var _0x49cef6=users[_0x360a0c(0x171)];}}}}}}}_0x4d2e3e[_0x360a0c(0x1f8)]('edit_transfer_finished_view',{'success':_0x360c90[_0x360a0c(0x159)](_0x360a0c(0x178)),'errors':_0x360c90['flash']('errors'),'role':_0x333d28,'profile':_0x37503d,'master_shop':_0x3b6887,'warehouse':_0x55201e,'transfer':_0x2fed73,'stock':_0x54a639,'unit':_0x5628c0,'language':_0x49cef6});}catch(_0x18bbe5){console['log'](_0x18bbe5);}}),router['post'](a0_0x1128df(0x162),auth,async(_0x45b1ee,_0x188ee8)=>{var _0x369372=a0_0x1128df;try{const {invoice:_0x130bf7,from_warehouse:_0x27de57,FromRoom_name:_0x343499,to_warehouse:_0x3dd713,ToRoom_name:_0x2ef907}=_0x45b1ee['body'],_0x10e3da=await transfers_finished['findById'](_0x45b1ee[_0x369372(0x1d5)]['id']),_0x2ee816=_0x10e3da['product'][_0x369372(0x198)](async _0x368d7b=>{var _0x4cc4e5=_0x369372;if(_0x368d7b[_0x4cc4e5(0x1bd)]>0x0){var _0x4e0bdb=await warehouse[_0x4cc4e5(0x184)]({'name':_0x27de57,'room':_0x368d7b[_0x4cc4e5(0x180)],'warehouse_category':_0x4cc4e5(0x156)});const _0x2603da=_0x4e0bdb[_0x4cc4e5(0x16b)][_0x4cc4e5(0x198)](_0x56b7ab=>{var _0x987827=_0x4cc4e5;_0x56b7ab[_0x987827(0x1be)]==_0x368d7b[_0x987827(0x1be)]&&_0x56b7ab[_0x987827(0x172)]==_0x368d7b[_0x987827(0x14c)]&&_0x56b7ab[_0x987827(0x12d)]==_0x368d7b[_0x987827(0x12d)]&&_0x56b7ab[_0x987827(0x154)]==_0x368d7b[_0x987827(0x154)]&&_0x56b7ab[_0x987827(0x19f)]==_0x368d7b[_0x987827(0x19f)]&&_0x56b7ab['invoice']==_0x368d7b['from_invoice']&&(console[_0x987827(0x1b9)](_0x987827(0x14a),_0x56b7ab['product_stock']),typeof _0x368d7b[_0x987827(0x17a)]==_0x987827(0x181)?_0x56b7ab['product_stock']=Math[_0x987827(0x160)](0x0,Math['abs'](_0x56b7ab[_0x987827(0x12b)])-Math[_0x987827(0x19a)](_0x368d7b[_0x987827(0x1bd)])):_0x56b7ab['product_stock']=Math[_0x987827(0x160)](0x0,Math[_0x987827(0x19a)](_0x56b7ab[_0x987827(0x12b)])-Math[_0x987827(0x19a)](_0x368d7b[_0x987827(0x1bd)])));});}return _0x4e0bdb;});Promise[_0x369372(0x1f7)](_0x2ee816)['then'](async _0x198837=>{var _0x59b4d7=_0x369372;try{for(const _0x1ae348 of _0x198837){await _0x1ae348[_0x59b4d7(0x1c0)]();}const _0x11ccc3=_0x10e3da['product']['map'](async _0x328cf6=>{var _0x355936=_0x59b4d7,_0x251ffd=await warehouse[_0x355936(0x184)]({'name':_0x3dd713,'room':_0x328cf6[_0x355936(0x1e2)]});if(_0x328cf6[_0x355936(0x1bd)]>0x0){var _0x1998c0=0x0;const _0x3c2740=_0x251ffd[_0x355936(0x16b)][_0x355936(0x198)](_0x313f85=>{var _0x55b605=_0x355936;_0x313f85[_0x55b605(0x1be)]==_0x328cf6['product_name']&&_0x313f85[_0x55b605(0x172)]==_0x328cf6[_0x55b605(0x1cb)]&&_0x313f85[_0x55b605(0x12d)]==_0x328cf6['expiry_date']&&_0x313f85['production_date']==_0x328cf6[_0x55b605(0x154)]&&_0x313f85['batch_code']==_0x328cf6['batch_code']&&_0x313f85[_0x55b605(0x1e9)]==_0x328cf6[_0x55b605(0x1bf)]&&(typeof _0x328cf6['id_transaction']=='undefined'?(console[_0x55b605(0x1b9)](_0x55b605(0x13a),_0x313f85[_0x55b605(0x12b)]+_0x55b605(0x166)+_0x313f85[_0x55b605(0x1b6)]+_0x55b605(0x187)+Math[_0x55b605(0x19a)](_0x313f85[_0x55b605(0x12b)])+Math[_0x55b605(0x19a)](_0x328cf6[_0x55b605(0x1bd)])),_0x313f85[_0x55b605(0x12b)]=Math[_0x55b605(0x19a)](_0x313f85['product_stock'])+Math[_0x55b605(0x19a)](_0x328cf6['to_quantity'])):_0x313f85[_0x55b605(0x12b)]=Math[_0x55b605(0x19a)](_0x313f85['product_stock'])+Math['abs'](_0x328cf6[_0x55b605(0x1bd)]),_0x1998c0++);});_0x1998c0=='0'&&(_0x251ffd[_0x355936(0x16b)]=_0x251ffd['product_details'][_0x355936(0x129)]({'product_name':_0x328cf6[_0x355936(0x1be)],'product_stock':_0x328cf6['to_quantity'],'bay':_0x328cf6['to_bay'],'product_code':_0x328cf6[_0x355936(0x13c)],'primary_code':_0x328cf6[_0x355936(0x1f0)],'secondary_code':_0x328cf6[_0x355936(0x1eb)],'expiry_date':_0x328cf6[_0x355936(0x12d)],'production_date':_0x328cf6[_0x355936(0x154)],'maxProducts':_0x328cf6[_0x355936(0x169)],'batch_code':_0x328cf6[_0x355936(0x19f)],'secondary_unit':_0x328cf6['secondary_unit'],'unit':_0x328cf6['unit'],'maxProducts':_0x328cf6[_0x355936(0x169)],'maxPerUnit':_0x328cf6[_0x355936(0x151)],'invoice':_0x328cf6[_0x355936(0x1bf)]}));}return _0x251ffd;});Promise['all'](_0x11ccc3)['then'](async _0x40a2e2=>{var _0x5b8498=_0x59b4d7;try{for(const _0x2ad107 of _0x40a2e2){await warehouse[_0x5b8498(0x137)]({'_id':_0x2ad107[_0x5b8498(0x1b6)]},{'$addToSet':{'product_details':{'$each':_0x2ad107[_0x5b8498(0x16b)]}}});}_0x10e3da[_0x5b8498(0x174)]=_0x5b8498(0x132);const _0x1eb8f1=await _0x10e3da['save'](),_0x591ad8=await master_shop[_0x5b8498(0x149)](),_0x342d5b=await email_settings[_0x5b8498(0x184)](),_0x4f1000=await supervisor_settings[_0x5b8498(0x149)]();var _0x52291e=_0x10e3da['product'],_0xaeaf50='',_0x2a265c;for(_0x2a265c in _0x52291e){var _0x55c1be='FG';_0x10e3da[_0x5b8498(0x1d9)]=='DRY\x20GOODS'&&(_0x55c1be='DG'),_0xaeaf50+='<tr>'+_0x5b8498(0x1a4)+_0x52291e[_0x2a265c]['product_name']+'</td>'+_0x5b8498(0x1a4)+_0x52291e[_0x2a265c][_0x5b8498(0x13c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x52291e[_0x2a265c][_0x5b8498(0x1bd)]+_0x5b8498(0x1c9)+_0x5b8498(0x1a4)+_0x52291e[_0x2a265c]['unit']+_0x5b8498(0x1c9)+_0x5b8498(0x1a4)+_0x52291e[_0x2a265c][_0x5b8498(0x13b)]+'</td>'+_0x5b8498(0x1a4)+_0x10e3da[_0x5b8498(0x1d9)]+_0x5b8498(0x1c9)+_0x5b8498(0x1a4)+_0x52291e[_0x2a265c][_0x5b8498(0x1e2)]+'</td>'+_0x5b8498(0x1a4)+_0x55c1be+_0x52291e[_0x2a265c][_0x5b8498(0x1cb)]+_0x5b8498(0x1c9)+_0x5b8498(0x179);}let _0x177105=nodemailer[_0x5b8498(0x1ec)]({'host':_0x342d5b['host'],'port':Number(_0x342d5b[_0x5b8498(0x186)]),'secure':![],'auth':{'user':_0x342d5b[_0x5b8498(0x18e)],'pass':_0x342d5b[_0x5b8498(0x144)]}}),_0x284274={'from':_0x342d5b[_0x5b8498(0x18e)],'to':_0x4f1000[0x0][_0x5b8498(0x19c)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x5b8498(0x143),'path':__dirname+_0x5b8498(0x1fb)+'/upload/'+_0x591ad8[0x0][_0x5b8498(0x1bb)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5b8498(0x1c4)+_0x5b8498(0x1da)+_0x5b8498(0x1a8)+_0x5b8498(0x15e)+'<div>'+_0x5b8498(0x1a7)+_0x5b8498(0x1dd)+_0x5b8498(0x1a8)+_0x5b8498(0x15b)+_0x591ad8[0x0]['site_title']+_0x5b8498(0x133)+'</div>'+_0x5b8498(0x1dd)+_0x5b8498(0x135)+_0x5b8498(0x1a8)+_0x5b8498(0x1fe)+_0x5b8498(0x193)+_0x10e3da[_0x5b8498(0x1e9)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5b8498(0x18b)+_0x10e3da[_0x5b8498(0x1ab)]+'\x20'+'</span>'+_0x5b8498(0x1d0)+_0x5b8498(0x1dd)+_0x5b8498(0x146)+_0x5b8498(0x176)+_0x5b8498(0x1af)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5b8498(0x1c2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x5b8498(0x1f6)+_0x5b8498(0x182)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5b8498(0x179)+'</thead>'+_0x5b8498(0x194)+'\x20'+_0xaeaf50+'\x20'+_0x5b8498(0x13d)+_0x5b8498(0x168)+_0x5b8498(0x1a8)+_0x5b8498(0x1ef)+_0x5b8498(0x13f)+_0x591ad8[0x0][_0x5b8498(0x1ce)]+_0x5b8498(0x1d0)+_0x5b8498(0x1dd)+_0x5b8498(0x1dd)+_0x5b8498(0x138)};_0x177105['sendMail'](_0x284274,function(_0x3607a9,_0x555c7b){var _0x476d59=_0x5b8498;_0x3607a9?(console['log'](_0x3607a9),console[_0x476d59(0x1b9)](_0x476d59(0x183))):console[_0x476d59(0x1b9)](_0x476d59(0x17e));}),_0x45b1ee['flash'](_0x5b8498(0x178),'Transfer\x20Finalize\x20Successfully'),_0x188ee8['redirect']('/picking_list/PDF_transfer/'+_0x1eb8f1[_0x5b8498(0x1b6)]);}catch(_0x3031f8){console['error'](_0x3031f8),_0x188ee8[_0x5b8498(0x1e8)](0x1f4)[_0x5b8498(0x18a)]({'error':_0x5b8498(0x1c8)});}})[_0x59b4d7(0x201)](_0x4f76d4=>{var _0x54124e=_0x59b4d7;console[_0x54124e(0x1a3)](_0x4f76d4),_0x188ee8['status'](0x1f4)[_0x54124e(0x18a)]({'error':'An\x20error\x20occurred.'});});}catch(_0x82295a){console[_0x59b4d7(0x1a3)](_0x82295a),_0x188ee8['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x29183a=>{var _0x47aa69=_0x369372;console[_0x47aa69(0x1a3)](_0x29183a),_0x188ee8[_0x47aa69(0x1e8)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x29d42b){_0x188ee8[_0x369372(0x18a)]({'message':_0x29d42b[_0x369372(0x17c)]});}});function BayBinSelected(_0x1768c3,_0x24a891){var _0x3e7a4d=a0_0x1128df,_0x4ca02b=[];let _0x2541e1=[];var _0x5946dc=[];if(_0x1768c3==_0x3e7a4d(0x152)){switch(_0x24a891){case _0x3e7a4d(0x1cf):_0x4ca02b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x3e7a4d(0x14d):_0x4ca02b=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5946dc=['DG'];}else{if(_0x1768c3==_0x3e7a4d(0x203)){switch(_0x24a891){case'Rack\x201':_0x4ca02b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x3e7a4d(0x14d):_0x4ca02b=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5946dc=['FG'];}}return{'levels':_0x4ca02b,'identify':_0x5946dc};}router['get'](a0_0x1128df(0x1ea),auth,async(_0x193740,_0x4b7816)=>{var _0x2ce37f=a0_0x1128df;try{const {username:_0x52cf46,email:_0x56ae19,role:_0x2cd79b}=_0x193740['user'],_0x3dd70b=_0x193740['user'],_0x57170c=await profile[_0x2ce37f(0x184)]({'email':_0x3dd70b[_0x2ce37f(0x18e)]}),_0x2e0c92=await master_shop[_0x2ce37f(0x149)](),_0x5d7dbf=await transfers_finished['findById'](_0x193740[_0x2ce37f(0x1d5)]['id']);let _0x306e2a=new Date(_0x5d7dbf[_0x2ce37f(0x12d)]),_0x4cdbc1=('0'+_0x306e2a[_0x2ce37f(0x1c3)]())[_0x2ce37f(0x165)](-0x2),_0x44f991=('0'+(_0x306e2a['getMonth']()+0x1))['slice'](-0x2),_0x2f6e35=_0x306e2a[_0x2ce37f(0x136)](),_0x38e54a=_0x2f6e35+'-'+_0x44f991+'-'+_0x4cdbc1,_0x315315;if(_0x3dd70b[_0x2ce37f(0x157)]==_0x2ce37f(0x15d)){const _0x3bfd1a=await staff[_0x2ce37f(0x184)]({'email':_0x3dd70b[_0x2ce37f(0x18e)]});_0x315315=await warehouse['find']({'status':_0x2ce37f(0x1f2),'name':_0x3bfd1a[_0x2ce37f(0x131)],'warehouse_category':_0x2ce37f(0x156)});}else _0x315315=await warehouse['find']({'status':_0x2ce37f(0x1f2),'warehouse_category':'Finished\x20Goods'});const _0x1b486=await warehouse[_0x2ce37f(0x204)]([{'$match':{'name':_0x5d7dbf[_0x2ce37f(0x1e6)],'room':_0x5d7dbf['from_room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2ce37f(0x1a1),'name':{'$first':_0x2ce37f(0x1d4)},'product_stock':{'$first':_0x2ce37f(0x1c5)},'bay':{'$first':_0x2ce37f(0x16e)},'bin':{'$first':_0x2ce37f(0x19d)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2ce37f(0x1de)},'primary_code':{'$first':_0x2ce37f(0x195)},'secondary_code':{'$first':_0x2ce37f(0x1ad)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2ce37f(0x1c1)},'rack':{'$first':_0x2ce37f(0x200)}}}]);var _0xc7a780=[0x1,0x2,0x3,0x4],_0x502b2d=['A','B','C','D','E','F','G','H','I','J'],_0x49d9b8=[_0x2ce37f(0x15a),_0x2ce37f(0x18c)];const _0x57ccfd=await product[_0x2ce37f(0x149)]({}),_0x4db359=BayBinSelected(_0x5d7dbf[_0x2ce37f(0x1d9)],_0x5d7dbf['to_room']);if(_0x2e0c92[0x0][_0x2ce37f(0x161)]==_0x2ce37f(0x1b5)){var _0x5187df=users[_0x2ce37f(0x14b)];console['log'](_0x5187df);}else{if(_0x2e0c92[0x0]['language']==_0x2ce37f(0x163))var _0x5187df=users[_0x2ce37f(0x163)];else{if(_0x2e0c92[0x0][_0x2ce37f(0x161)]==_0x2ce37f(0x158))var _0x5187df=users[_0x2ce37f(0x158)];else{if(_0x2e0c92[0x0][_0x2ce37f(0x161)]==_0x2ce37f(0x1fa))var _0x5187df=users[_0x2ce37f(0x1fa)];else{if(_0x2e0c92[0x0][_0x2ce37f(0x161)]==_0x2ce37f(0x177))var _0x5187df=users['French'];else{if(_0x2e0c92[0x0]['language']==_0x2ce37f(0x1aa))var _0x5187df=users[_0x2ce37f(0x190)];else{if(_0x2e0c92[0x0]['language']=='Chinese')var _0x5187df=users['Chinese'];else{if(_0x2e0c92[0x0][_0x2ce37f(0x161)]==_0x2ce37f(0x167))var _0x5187df=users['Arabic'];}}}}}}}_0x4b7816[_0x2ce37f(0x1f8)](_0x2ce37f(0x141),{'success':_0x193740[_0x2ce37f(0x159)](_0x2ce37f(0x178)),'errors':_0x193740['flash'](_0x2ce37f(0x12e)),'role':_0x3dd70b,'profile':_0x57170c,'master_shop':_0x2e0c92,'warehouse':_0x315315,'transfer':_0x5d7dbf,'stock':_0x1b486,'unit':_0x57ccfd,'language':_0x5187df,'levels':_0xc7a780,'Isle':_0x502b2d,'rooms_data':_0x49d9b8,'ed_fullDate':_0x38e54a,'dataSelected':_0x4db359});}catch(_0x5808d7){console[_0x2ce37f(0x1b9)](_0x5808d7);}}),router[a0_0x1128df(0x1f1)](a0_0x1128df(0x1ea),auth,async(_0x31b041,_0x3c2f4d)=>{var _0x1262c0=a0_0x1128df;try{const _0x5954c8=_0x31b041['params']['id'];console[_0x1262c0(0x1b9)](_0x31b041[_0x1262c0(0x19b)]);const _0x1ae68a=await transfers_finished[_0x1262c0(0x155)](_0x5954c8);console[_0x1262c0(0x1b9)](_0x1262c0(0x205),_0x1ae68a);const {date:_0x311e7b,from_warehouse:_0x519473,FromRoom_name:_0x2d72d4,to_warehouse:_0x1cbfb4,ToRoom_name:_0x5afce3,prod_name:_0x35efe3,from_prod_qty:_0x284205,from_prod_level:_0x2eaa05,from_prod_isle:_0x1495b0,from_prod_pallet:_0x25518d,to_prod_qty:_0x4a3dff,to_prod_level:_0xa28358,to_prod_isle:_0x4dcad3,to_prod_pallet:_0x3074a2,primary_code:_0x2ab125,secondary_code:_0x89251a,product_code3:_0x46810,note:_0x2f9775,invoice:_0xb4c1d7,expiry_date:_0x956cff}=_0x31b041[_0x1262c0(0x19b)];if(typeof _0x35efe3==_0x1262c0(0x145))var _0x43dcdb=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x185)]],_0x182dcb=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x12f)]],_0x3017d0=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1ff)]],_0x148882=[_0x31b041['body'][_0x1262c0(0x139)]],_0x589854=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x189)]],_0x35f813=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1f0)]],_0x4eda70=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1eb)]],_0x3bb62c=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1f9)]],_0x19545f=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x188)]],_0x5e178c=[_0x31b041['body'][_0x1262c0(0x196)]],_0x1a2ada=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x13b)]],_0x13fec5=[_0x31b041['body']['batch_code']],_0x1af9fa=[_0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x12d)]];else var _0x43dcdb=[..._0x31b041['body'][_0x1262c0(0x185)]],_0x182dcb=[..._0x31b041[_0x1262c0(0x19b)]['from_prod_qty']],_0x3017d0=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1ff)]],_0x148882=[..._0x31b041['body']['to_prod_qty']],_0x589854=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x189)]],_0x35f813=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1f0)]],_0x4eda70=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x1eb)]],_0x3bb62c=[..._0x31b041[_0x1262c0(0x19b)]['product_code3']],_0x19545f=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x188)]],_0x5e178c=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x196)]],_0x1a2ada=[..._0x31b041['body'][_0x1262c0(0x13b)]],_0x13fec5=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x19f)]],_0x1af9fa=[..._0x31b041[_0x1262c0(0x19b)][_0x1262c0(0x12d)]];const _0x3e32b5=_0x43dcdb[_0x1262c0(0x198)](_0x115838=>{return _0x115838={'product_name':_0x115838};});_0x182dcb[_0x1262c0(0x15f)]((_0x2f04d3,_0x3bace2)=>{var _0x4cb2e6=_0x1262c0;_0x3e32b5[_0x3bace2][_0x4cb2e6(0x1df)]=_0x2f04d3;}),_0x3017d0[_0x1262c0(0x15f)]((_0x39c651,_0x56d91)=>{_0x3e32b5[_0x56d91]['from_bay']=_0x39c651;}),_0x148882['forEach']((_0x57a32a,_0x29c425)=>{var _0x1f51f1=_0x1262c0;_0x3e32b5[_0x29c425][_0x1f51f1(0x1bd)]=_0x57a32a;}),_0x589854[_0x1262c0(0x15f)]((_0x2ca623,_0x2f555a)=>{var _0xd377e2=_0x1262c0;_0x3e32b5[_0x2f555a][_0xd377e2(0x1cb)]=_0x2ca623;}),_0x35f813[_0x1262c0(0x15f)]((_0x20b260,_0x39129c)=>{var _0xce4c92=_0x1262c0;_0x3e32b5[_0x39129c][_0xce4c92(0x1f0)]=_0x20b260;}),_0x4eda70[_0x1262c0(0x15f)]((_0xd3dea0,_0x2c9ac8)=>{var _0x3cc3c1=_0x1262c0;_0x3e32b5[_0x2c9ac8][_0x3cc3c1(0x1eb)]=_0xd3dea0;}),_0x3bb62c[_0x1262c0(0x15f)]((_0x5e1a01,_0x22ca43)=>{_0x3e32b5[_0x22ca43]['product_code']=_0x5e1a01;}),_0x19545f[_0x1262c0(0x15f)]((_0xdba31f,_0x3dfc43)=>{var _0x396794=_0x1262c0;_0x3e32b5[_0x3dfc43][_0x396794(0x169)]=_0xdba31f;}),_0x5e178c[_0x1262c0(0x15f)]((_0x451e70,_0x231636)=>{var _0x17922e=_0x1262c0;_0x3e32b5[_0x231636][_0x17922e(0x196)]=_0x451e70;}),_0x1a2ada['forEach']((_0xe95df6,_0xf4f225)=>{var _0x45c2c4=_0x1262c0;_0x3e32b5[_0xf4f225][_0x45c2c4(0x13b)]=_0xe95df6;}),_0x13fec5[_0x1262c0(0x15f)]((_0x32004c,_0x544969)=>{var _0x22dd0c=_0x1262c0;_0x3e32b5[_0x544969][_0x22dd0c(0x19f)]=_0x32004c;}),_0x1af9fa[_0x1262c0(0x15f)]((_0x448933,_0x353118)=>{_0x3e32b5[_0x353118]['expiry_date']=_0x448933;});const _0x574bde=_0x3e32b5[_0x1262c0(0x1e3)](_0x3c3c12=>_0x3c3c12[_0x1262c0(0x1bd)]!=='0'&&_0x3c3c12[_0x1262c0(0x1bd)]!==''||_0x3c3c12[_0x1262c0(0x1e5)]!=='0'&&_0x3c3c12[_0x1262c0(0x1e5)]!=='');var _0x3b6e4c=0x0;_0x574bde[_0x1262c0(0x15f)](_0x256e49=>{var _0xf6a0c5=_0x1262c0;parseInt(_0x256e49[_0xf6a0c5(0x1df)])<parseInt(_0x256e49[_0xf6a0c5(0x1bd)])&&_0x3b6e4c++;});if(_0x3b6e4c!=0x0)return _0x31b041[_0x1262c0(0x159)](_0x1262c0(0x12e),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3c2f4d[_0x1262c0(0x202)](_0x1262c0(0x1db));const _0x2cd303=await warehouse[_0x1262c0(0x184)]({'name':_0x1ae68a['from_warehouse'],'room':_0x1ae68a[_0x1262c0(0x140)]});_0x1ae68a['product']['forEach'](_0x57a025=>{var _0x5e52b9=_0x1262c0;if(_0x57a025['to_quantity']>0x0){const _0xf95f60=_0x2cd303[_0x5e52b9(0x16b)][_0x5e52b9(0x198)](_0x1fb64f=>{var _0xb5c1b6=_0x5e52b9;_0x1fb64f[_0xb5c1b6(0x1be)]==_0x57a025[_0xb5c1b6(0x1be)]&&_0x1fb64f['bay']==_0x57a025[_0xb5c1b6(0x14c)]&&(_0x1fb64f['product_stock']=parseInt(_0x1fb64f[_0xb5c1b6(0x12b)])+parseInt(_0x57a025[_0xb5c1b6(0x1bd)]));});}}),await _0x2cd303['save']();const _0x299cae=await warehouse['findOne']({'name':_0x1ae68a['to_warehouse'],'room':_0x1ae68a[_0x1262c0(0x197)]});_0x1ae68a[_0x1262c0(0x1ee)][_0x1262c0(0x15f)](_0xea5a74=>{var _0x4eb7bc=_0x1262c0;if(_0xea5a74[_0x4eb7bc(0x1bd)]>0x0){const _0x24a473=_0x299cae['product_details'][_0x4eb7bc(0x198)](_0x36bff7=>{var _0x567d3d=_0x4eb7bc;_0x36bff7[_0x567d3d(0x1be)]==_0xea5a74[_0x567d3d(0x1be)]&&_0x36bff7[_0x567d3d(0x172)]==_0xea5a74[_0x567d3d(0x1cb)]&&(_0x36bff7[_0x567d3d(0x12b)]=parseInt(_0x36bff7[_0x567d3d(0x12b)])-parseInt(_0xea5a74[_0x567d3d(0x1bd)]));});}}),await _0x299cae['save'](),_0x1ae68a[_0x1262c0(0x1ab)]=_0x311e7b,_0x1ae68a[_0x1262c0(0x1e6)]=_0x519473,_0x1ae68a['to_warehouse']=_0x1cbfb4,_0x1ae68a[_0x1262c0(0x1ee)]=_0x574bde,_0x1ae68a[_0x1262c0(0x130)]=_0x2f9775,_0x1ae68a[_0x1262c0(0x1e9)]=_0xb4c1d7;const _0x1d3089=await _0x1ae68a['save'](),_0x3c61d8=await warehouse[_0x1262c0(0x184)]({'name':_0x519473,'room':_0x2d72d4});_0x1d3089[_0x1262c0(0x1ee)]['forEach'](_0x237ea0=>{var _0x41f73f=_0x1262c0;if(_0x237ea0['to_quantity']>0x0){const _0x582ad3=_0x3c61d8[_0x41f73f(0x16b)][_0x41f73f(0x198)](_0x199930=>{var _0x3e6514=_0x41f73f;_0x199930[_0x3e6514(0x1be)]==_0x237ea0[_0x3e6514(0x1be)]&&_0x199930[_0x3e6514(0x172)]==_0x237ea0[_0x3e6514(0x14c)]&&(_0x199930[_0x3e6514(0x12b)]=parseInt(_0x199930['product_stock'])-parseInt(_0x237ea0[_0x3e6514(0x1bd)]));});}}),await _0x3c61d8[_0x1262c0(0x1c0)]();const _0x4f31a8=await warehouse['findOne']({'name':_0x1cbfb4,'room':_0x5afce3});_0x1d3089[_0x1262c0(0x1ee)]['forEach'](_0x56e9f0=>{var _0x2cb288=_0x1262c0;if(_0x56e9f0[_0x2cb288(0x1bd)]>0x0){var _0x181642=0x0;const _0x2f612f=_0x4f31a8['product_details'][_0x2cb288(0x198)](_0x5752ac=>{var _0x54d1de=_0x2cb288;_0x5752ac['product_name']==_0x56e9f0[_0x54d1de(0x1be)]&&_0x5752ac[_0x54d1de(0x172)]==_0x56e9f0[_0x54d1de(0x1cb)]&&(_0x5752ac[_0x54d1de(0x12b)]=parseInt(_0x5752ac[_0x54d1de(0x12b)])+parseInt(_0x56e9f0[_0x54d1de(0x1bd)]),_0x181642++);});_0x181642=='0'&&(_0x4f31a8[_0x2cb288(0x16b)]=_0x4f31a8['product_details'][_0x2cb288(0x129)]({'product_name':_0x56e9f0[_0x2cb288(0x1be)],'product_stock':_0x56e9f0[_0x2cb288(0x1bd)],'bay':_0x56e9f0[_0x2cb288(0x1cb)],'product_code':_0x56e9f0[_0x2cb288(0x13c)],'primary_code':_0x56e9f0['primary_code'],'secondary_code':_0x56e9f0[_0x2cb288(0x1eb)],'maxProducts':_0x56e9f0[_0x2cb288(0x169)]}));}}),await _0x4f31a8['save'](),_0x31b041[_0x1262c0(0x159)](_0x1262c0(0x178),_0x1262c0(0x1b0)),_0x3c2f4d[_0x1262c0(0x202)](_0x1262c0(0x1a2));}catch(_0x10722b){console[_0x1262c0(0x1b9)](_0x10722b);}}),router[a0_0x1128df(0x1f1)](a0_0x1128df(0x1dc),async(_0xb3d6b,_0x34610e)=>{var _0x358268=a0_0x1128df;const {FromWareHouse:_0x34b42c,FromRoom:_0x27ff18,ToWarehouse:_0xec6a5a,ToRoom:_0x3b777d,primary_code:_0xa2a0a,Roomslist:_0x3fb351}=_0xb3d6b[_0x358268(0x19b)],_0x190f02=_0x3fb351['split'](','),_0x399a18=[];async function _0x12f736(_0x52bd09){var _0x58edd6=_0x358268;const _0x4e9622=await warehouse['aggregate']([{'$match':{'name':_0x34b42c,'room':_0x52bd09}},{'$unwind':_0x58edd6(0x148)},{'$match':{'product_details.primary_code':_0xa2a0a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x58edd6(0x1d4)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x58edd6(0x195)},'secondary_code':{'$first':_0x58edd6(0x1ad)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x58edd6(0x16e)},'isle':{'$first':_0x58edd6(0x19d)},'type':{'$first':_0x58edd6(0x1cc)},'pallet':{'$first':_0x58edd6(0x1de)},'unit':{'$first':_0x58edd6(0x1e7)},'secondary_unit':{'$first':_0x58edd6(0x12a)},'storage':{'$first':_0x58edd6(0x1c1)},'rack':{'$first':_0x58edd6(0x200)},'expiry_date':{'$first':_0x58edd6(0x192)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x58edd6(0x1ae)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x291f20=await warehouse[_0x58edd6(0x204)]([{'$match':{'name':_0x34b42c,'room':_0x52bd09}},{'$unwind':_0x58edd6(0x148)},{'$match':{'product_details.secondary_code':_0xa2a0a}},{'$group':{'_id':_0x58edd6(0x1a1),'name':{'$first':_0x58edd6(0x1d4)},'instock':{'$first':_0x58edd6(0x1c5)},'primary_code':{'$first':_0x58edd6(0x195)},'secondary_code':{'$first':_0x58edd6(0x1ad)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x58edd6(0x16e)},'isle':{'$first':_0x58edd6(0x19d)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x58edd6(0x1de)},'unit':{'$first':_0x58edd6(0x1e7)},'secondary_unit':{'$first':_0x58edd6(0x12a)},'storage':{'$first':_0x58edd6(0x1c1)},'rack':{'$first':_0x58edd6(0x200)},'expiry_date':{'$first':_0x58edd6(0x192)},'production_date':{'$first':_0x58edd6(0x164)},'batch_code':{'$first':_0x58edd6(0x1ca)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x58edd6(0x1ae)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x58edd6(0x142)}}}]);if(_0x4e9622[_0x58edd6(0x1d3)]>0x0)_0x399a18['push'](_0x4e9622);else _0x291f20['length']>0x0&&_0x399a18[_0x58edd6(0x153)](_0x291f20);}const _0x226dbe=_0x190f02[_0x358268(0x198)](_0xa0306d=>_0x12f736(_0xa0306d));await Promise[_0x358268(0x1f7)](_0x226dbe),_0x34610e[_0x358268(0x18a)](_0x399a18);}),router[a0_0x1128df(0x1f1)](a0_0x1128df(0x1c7),async(_0x5a546c,_0x281fee)=>{var _0x175f72=a0_0x1128df;try{const {FromWareHouse:_0x242a04,FromRoom:_0x14f3b0,ToWarehouse:_0x81dcfc,ToRoom:_0x59bf77,secondary_code:_0x3e7816}=_0x5a546c[_0x175f72(0x19b)],_0x3a7631=await warehouse['aggregate']([{'$match':{'name':_0x242a04}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3e7816}},{'$group':{'_id':_0x175f72(0x1a1),'name':{'$first':_0x175f72(0x1d4)},'primary_code':{'$first':_0x175f72(0x195)},'secondary_code':{'$first':_0x175f72(0x1ad)},'product_code':{'$first':_0x175f72(0x1e0)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':_0x175f72(0x173)},'isle':{'$first':_0x175f72(0x1ba)},'pallet':{'$first':_0x175f72(0x18d)},'maxProducts':{'$first':_0x175f72(0x1f4)},'unit':{'$first':_0x175f72(0x1e7)},'expiry_date':{'$first':_0x175f72(0x192)},'production_date':{'$first':'$product_details.production_date'}}}]);_0x281fee[_0x175f72(0x1e8)](0xc8)[_0x175f72(0x18a)](_0x3a7631);}catch(_0x467aaf){_0x281fee[_0x175f72(0x1e8)](0x194)[_0x175f72(0x18a)]({'message':_0x467aaf[_0x175f72(0x17c)]});}}),router[a0_0x1128df(0x1f1)]('/barcode_scanner3',async(_0x1feb60,_0x183828)=>{var _0x57f920=a0_0x1128df;try{const {FromWareHouse:_0x5c0785,FromRoom:_0xec6f9e,ToWarehouse:_0x131f92,ToRoom:_0x54161e,product_code:_0x4943db}=_0x1feb60[_0x57f920(0x19b)],_0x562fb7=await warehouse[_0x57f920(0x204)]([{'$match':{'name':_0x5c0785}},{'$unwind':_0x57f920(0x148)},{'$match':{'product_details.product_code':_0x4943db}},{'$group':{'_id':_0x57f920(0x1a1),'name':{'$first':_0x57f920(0x1d4)},'primary_code':{'$first':_0x57f920(0x195)},'secondary_code':{'$first':_0x57f920(0x1ad)},'product_code':{'$first':_0x57f920(0x1e0)},'instock':{'$first':_0x57f920(0x1c5)},'warehouse':{'$first':_0x57f920(0x1b3)},'level':{'$first':_0x57f920(0x173)},'isle':{'$first':_0x57f920(0x1ba)},'pallet':{'$first':_0x57f920(0x18d)},'maxProducts':{'$first':_0x57f920(0x1f4)},'unit':{'$first':'$product_details.unit'}}}]);_0x183828['status'](0xc8)[_0x57f920(0x18a)](_0x562fb7);}catch(_0x436f7b){_0x183828[_0x57f920(0x1e8)](0x194)[_0x57f920(0x18a)]({'message':_0x436f7b['message']});}}),router[a0_0x1128df(0x1f1)](a0_0x1128df(0x12c),async(_0xf834b1,_0x12fa33)=>{var _0x115a56=a0_0x1128df;const {productCode:_0x107dd4,bay:_0x26a27c,warehouses:_0x274fef,room:_0x2bde6c}=_0xf834b1[_0x115a56(0x19b)];console['log'](_0xf834b1[_0x115a56(0x19b)]);try{const _0x4bb6ee=await warehouse['aggregate']([{'$match':{'name':_0x274fef,'room':_0x2bde6c}},{'$unwind':_0x115a56(0x148)},{'$match':{'product_details.bay':parseInt(_0x26a27c)}},{'$group':{'_id':_0x115a56(0x1a1),'name':{'$first':_0x115a56(0x1d4)},'product_stock':{'$first':_0x115a56(0x1c5)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x115a56(0x1f4)}}}]);_0x12fa33[_0x115a56(0x1e8)](0xc8)[_0x115a56(0x18a)](_0x4bb6ee);}catch(_0xbe6afc){_0x12fa33[_0x115a56(0x1e8)](0x194)[_0x115a56(0x18a)]({'message':_0xbe6afc[_0x115a56(0x17c)]});}}),module[a0_0x1128df(0x1fd)]=router;