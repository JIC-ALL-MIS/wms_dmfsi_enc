var a0_0x2c9195=a0_0x1560;(function(_0x355a81,_0x52d9b6){var _0x23bf31=a0_0x1560,_0x3aa63b=_0x355a81();while(!![]){try{var _0x2a429e=-parseInt(_0x23bf31(0x1fd))/0x1+parseInt(_0x23bf31(0x200))/0x2+parseInt(_0x23bf31(0x1fe))/0x3+parseInt(_0x23bf31(0x1ce))/0x4+parseInt(_0x23bf31(0x253))/0x5*(-parseInt(_0x23bf31(0x206))/0x6)+-parseInt(_0x23bf31(0x215))/0x7+-parseInt(_0x23bf31(0x21d))/0x8*(-parseInt(_0x23bf31(0x20b))/0x9);if(_0x2a429e===_0x52d9b6)break;else _0x3aa63b['push'](_0x3aa63b['shift']());}catch(_0x12edb1){_0x3aa63b['push'](_0x3aa63b['shift']());}}}(a0_0x1ded,0x80ae1));const express=require(a0_0x2c9195(0x25a)),app=express(),router=express[a0_0x2c9195(0x274)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x2c9195(0x282)),auth=require(a0_0x2c9195(0x1e7)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x2c9195(0x26e));router[a0_0x2c9195(0x2a3)]('/view',auth,async(_0x27e6d6,_0x4ba710)=>{var _0x340724=a0_0x2c9195;try{const {username:_0x4e38c3,email:_0x317496,role:_0x541267}=_0x27e6d6[_0x340724(0x26c)],_0x18ec00=_0x27e6d6[_0x340724(0x26c)],_0x3925ef=await profile['findOne']({'email':_0x18ec00[_0x340724(0x242)]}),_0x507b0f=await master_shop['find']();let _0x329927;if(_0x18ec00[_0x340724(0x293)]==_0x340724(0x2a6)){const _0xef126=await staff['findOne']({'email':_0x18ec00[_0x340724(0x242)]});_0x329927=await transfers_finished['find']({'from_warehouse':_0xef126[_0x340724(0x1df)]});}else _0x329927=await transfers_finished[_0x340724(0x1ee)]([{'$unwind':_0x340724(0x239)},{'$group':{'_id':_0x340724(0x2a8),'invoice':{'$first':_0x340724(0x1d6)},'date':{'$first':_0x340724(0x296)},'from_warehouse':{'$first':_0x340724(0x248)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x340724(0x1cd)},'to_room_name':{'$addToSet':_0x340724(0x1f1)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x507b0f[0x0][_0x340724(0x23b)]==_0x340724(0x297))var _0x5a8359=users[_0x340724(0x286)];else{if(_0x507b0f[0x0][_0x340724(0x23b)]==_0x340724(0x24f))var _0x5a8359=users[_0x340724(0x24f)];else{if(_0x507b0f[0x0][_0x340724(0x23b)]==_0x340724(0x24e))var _0x5a8359=users[_0x340724(0x24e)];else{if(_0x507b0f[0x0]['language']==_0x340724(0x2a0))var _0x5a8359=users[_0x340724(0x2a0)];else{if(_0x507b0f[0x0][_0x340724(0x23b)]=='French')var _0x5a8359=users['French'];else{if(_0x507b0f[0x0][_0x340724(0x23b)]==_0x340724(0x20d))var _0x5a8359=users[_0x340724(0x245)];else{if(_0x507b0f[0x0][_0x340724(0x23b)]=='Chinese')var _0x5a8359=users[_0x340724(0x280)];else{if(_0x507b0f[0x0][_0x340724(0x23b)]==_0x340724(0x1e2))var _0x5a8359=users['Arabic'];}}}}}}}_0x4ba710[_0x340724(0x27e)](_0x340724(0x1d2),{'success':_0x27e6d6[_0x340724(0x1e1)](_0x340724(0x25d)),'errors':_0x27e6d6['flash'](_0x340724(0x266)),'role':_0x18ec00,'profile':_0x3925ef,'master_shop':_0x507b0f,'transfer':_0x329927,'language':_0x5a8359});}catch(_0x4d21eb){console[_0x340724(0x216)](_0x4d21eb);}});async function getRandom8DigitNumber(){var _0x1151c9=a0_0x2c9195;const _0x233576=0x989680,_0x28e2be=0x5f5e0ff,_0x3c20d6=Math[_0x1151c9(0x1d8)](Math[_0x1151c9(0x1f9)]()*(_0x28e2be-_0x233576+0x1))+_0x233576;var _0x5f17ef;const _0x4dbb9f=await transfers_finished[_0x1151c9(0x1e8)]({'invoice':_0x1151c9(0x1f7)+_0x3c20d6});return _0x4dbb9f&&_0x4dbb9f[_0x1151c9(0x214)]>0x0?_0x5f17ef=_0x1151c9(0x1f7)+_0x3c20d6:_0x5f17ef='TRFF-'+_0x3c20d6,_0x5f17ef;}function a0_0x1ded(){var _0x3992c2=['find','<tr>','$product.to_room_name','$product_details.bay','$product_details.batch_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','to_invoice','$product_details.maxProducts','TRFF-','maxProducts','random','An\x20error\x20occurred.','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','to_bay','570584oUxxTn','1012359ZSJTjk','$product_details.secondary_code','1145496akAodO','</tbody>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','from_room','MaxStocks_data2','5635992wPwCzV','prod_name','push','Transfer\x20Edit\x20Successfully','$product_details','27sYSnIe','expiry_date','Portuguese\x20(BR)','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Finished\x20Goods','primary_unit','bay','Arabic','length','1718150MIfDvT','log','to_warehouse','exports','unit','to_room_name','post','</div>','3494104AahQKj','batch_code','$product_details.production_date','$name','edit_transfer_finished','</body></html>','<h5>','id_transaction','product_stock','logo','then','/CheckingWarehouse','/transfer/view','$product_details.invoice','Email\x20sent\x20successfully','</td>','product_name','$product_details.pallet','$product_details.floorlevel','date','_id','/view/add_transfer','sendMail','$product_details.rack','back','password','\x20Order\x20Date\x20:\x20','finalize','$product','message','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_cat','toString','RoomAssigned','/picking_list/PDF_transfer/','DRY\x20GOODS','email','add_transfer_finished','$product_details.product_stock','Portuguese','$product_details.isle','secondary_code','$from_warehouse','to_quantity','$room','primary_code','getFullYear','from_warehouse','German','Hindi','production_date','params','site_title','5cGvqCF','$product_details.level','filter','/upload/','product_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','body','express','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','from_invoice','success','$product_details._id','QA\x20Warehouse','Enclosed','</tr>','error','<h5\x20style=\x22text-align:\x20left;\x22>','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','errors','here1','<div>','An\x20error\x20occurred\x20while\x20saving\x20data.','French','transfer_data','user','$product_details.secondary_unit','nodemailer','</h5>','ToRoomAssigned','status','secondary_unit','to_floorlevel','Router','Product\x20Transfer\x20successfully','to_prod_level','findById','concat','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.bin','Rack\x201','from_prod_qty','render','</table>','Chinese','slice','../models/all_models','/view/:id','$product_details.storage','product','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','createTransport','from_bay','to_room','maxPerUnit','</thead>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<html><head><title></title>','/preview/:id','New_Qty_Converted','Rack\x202','from_quantity','role','To_invoice','invoice','$date','English\x20(US)','$product_details.expiry_date','to_prod_qty','forEach','$product_details.primary_code','$product_details.type','save','json','$product_details.product_code','Spanish','note','split','get','all','catch','staff','<hr\x20class=\x22my-3\x22>','$_id','/transfer_finished/view','from_prod_level','</span>','from_room_name','redirect','<!DOCTYPE\x20html>','Logo.png','$product_details.product_name','$product.from_room_name','247796WRVdlX','$product_details.unit','Enabled','here2','transfer_finished','There\x27s\x20a\x20error\x20in\x20this\x20transaction','getDate','undefined','$invoice','<strong>\x20Regards\x20</strong>','floor','Error\x20Occurs','\x20</h2>','/../public','\x20<>\x20','abs','product_code','warehouse','Ambient','flash','Arabic\x20(ae)','Transfer\x20Mail','<tbody\x20style=\x22text-align:\x20center;\x22>','map','product_details','../middleware/auth','findOne','/barcode_scanner2','product_code3','$product_details.maxPerUnit','port','<span\x20style=\x22float:\x20right;\x22>','aggregate'];a0_0x1ded=function(){return _0x3992c2;};return a0_0x1ded();}router[a0_0x2c9195(0x2a3)](a0_0x2c9195(0x232),auth,async(_0x191dd1,_0x436b7e)=>{var _0x544590=a0_0x2c9195;try{const {username:_0x126e8c,email:_0x505efd,role:_0x1dd12d}=_0x191dd1['user'],_0x486038=_0x191dd1[_0x544590(0x26c)],_0x25dd93=await profile[_0x544590(0x1e8)]({'email':_0x486038['email']}),_0x4badb5=await master_shop['find']();let _0x5e9ff1;if(_0x486038['role']=='staff'){const _0x7c03d4=await staff[_0x544590(0x1e8)]({'email':_0x486038[_0x544590(0x242)]});_0x5e9ff1=await warehouse[_0x544590(0x1ee)]([{'$match':{'status':'Enabled','name':_0x7c03d4['warehouse'],'warehouse_category':_0x544590(0x210),'name':{'$ne':_0x544590(0x25f)}}},{'$group':{'_id':_0x544590(0x220),'name':{'$first':_0x544590(0x220)}}}]);}else _0x5e9ff1=await warehouse[_0x544590(0x1ee)]([{'$match':{'status':_0x544590(0x1d0),'warehouse_category':_0x544590(0x210),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1b73ff=await transfers_finished[_0x544590(0x1ef)]({}),_0x55b7ba=_0x1b73ff[_0x544590(0x214)]+0x1,_0x10dc10='TRFF-'+_0x55b7ba[_0x544590(0x23e)]()['padStart'](0x5,'0');if(_0x4badb5[0x0]['language']==_0x544590(0x297))var _0x273565=users[_0x544590(0x286)];else{if(_0x4badb5[0x0]['language']==_0x544590(0x24f))var _0x273565=users[_0x544590(0x24f)];else{if(_0x4badb5[0x0][_0x544590(0x23b)]==_0x544590(0x24e))var _0x273565=users[_0x544590(0x24e)];else{if(_0x4badb5[0x0]['language']==_0x544590(0x2a0))var _0x273565=users['Spanish'];else{if(_0x4badb5[0x0][_0x544590(0x23b)]==_0x544590(0x26a))var _0x273565=users[_0x544590(0x26a)];else{if(_0x4badb5[0x0]['language']==_0x544590(0x20d))var _0x273565=users[_0x544590(0x245)];else{if(_0x4badb5[0x0][_0x544590(0x23b)]=='Chinese')var _0x273565=users[_0x544590(0x280)];else{if(_0x4badb5[0x0][_0x544590(0x23b)]=='Arabic\x20(ae)')var _0x273565=users[_0x544590(0x213)];}}}}}}}const _0x208edf=getRandom8DigitNumber();_0x208edf[_0x544590(0x227)](_0x5067ef=>{var _0x2be59e=_0x544590;_0x436b7e[_0x2be59e(0x27e)](_0x2be59e(0x243),{'success':_0x191dd1[_0x2be59e(0x1e1)](_0x2be59e(0x25d)),'errors':_0x191dd1[_0x2be59e(0x1e1)]('errors'),'role':_0x486038,'profile':_0x25dd93,'master_shop':_0x4badb5,'warehouse':_0x5e9ff1,'language':_0x273565,'invoice':_0x5067ef});})[_0x544590(0x2a5)](_0x40d5fd=>{var _0x538134=_0x544590;_0x191dd1[_0x538134(0x1e1)]('errors',_0x538134(0x1d3)),_0x436b7e[_0x538134(0x2ad)](_0x538134(0x229));});}catch(_0x131077){console[_0x544590(0x216)](_0x131077);}}),router[a0_0x2c9195(0x21b)](a0_0x2c9195(0x232),auth,async(_0x2eea78,_0x2589e1)=>{var _0x45965e=a0_0x2c9195;try{const {date:_0x525eb8,from_warehouse:_0x2e8a0b,FromRoom_name:_0x4f14e5,to_warehouse:_0x18175e,ToRoom_name:_0x165165,prod_name:_0x45443b,from_prod_qty:_0x541e0b,from_prod_level:_0xc8c11d,from_prod_isle:_0x33b7ca,from_prod_pallet:_0x5c717e,to_prod_qty:_0x243af6,to_prod_level:_0x18c69d,to_prod_isle:_0x11e590,to_prod_pallet:_0x26d054,primary_code:_0x17987e,secondary_code:_0x20a70e,product_code3:_0x4a1d4c,note:_0x697b56,MaxStocks_data2:_0x26d4c3,invoice:_0xdb3c69,expiry_date:_0x1bf4d8}=_0x2eea78['body'];if(typeof _0x45443b==_0x45965e(0x20e))var _0x41aec0=[_0x2eea78[_0x45965e(0x259)]['prod_name']],_0x5b3d81=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x27d)]],_0x3fd52f=[_0x2eea78[_0x45965e(0x259)]['from_prod_level']],_0x4855e4=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x290)]],_0x1bd36c=[_0x2eea78[_0x45965e(0x259)]['to_prod_level']],_0x3860d8=[_0x2eea78['body'][_0x45965e(0x24b)]],_0x45a887=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x247)]],_0x4c8376=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x1ea)]],_0x4e020b=[_0x2eea78['body']['MaxStocks_data2']],_0x58749d=[_0x2eea78[_0x45965e(0x259)]['primary_unit']],_0x268144=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x272)]],_0x10e5da=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x21e)]],_0x15f6f6=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x20c)]],_0x30e0a4=[_0x2eea78['body'][_0x45965e(0x257)]],_0x4ddacb=[_0x2eea78['body'][_0x45965e(0x264)]],_0x11148a=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x28b)]],_0x1ab398=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x23d)]],_0x4d5922=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x23f)]],_0x48f8c3=[_0x2eea78['body'][_0x45965e(0x270)]],_0x3c2e9d=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x25c)]],_0x2af55e=[_0x2eea78[_0x45965e(0x259)][_0x45965e(0x1f5)]],_0x4ac3ed=[_0x2eea78[_0x45965e(0x259)]['id_transaction']];else var _0x41aec0=[..._0x2eea78[_0x45965e(0x259)]['prod_name']],_0x5b3d81=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x27d)]],_0x3fd52f=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x2aa)]],_0x4855e4=[..._0x2eea78['body']['New_Qty_Converted']],_0x1bd36c=[..._0x2eea78['body'][_0x45965e(0x276)]],_0x3860d8=[..._0x2eea78[_0x45965e(0x259)]['primary_code']],_0x45a887=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x247)]],_0x4c8376=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x1ea)]],_0x4e020b=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x205)]],_0x58749d=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x211)]],_0x268144=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x272)]],_0x10e5da=[..._0x2eea78['body'][_0x45965e(0x21e)]],_0x15f6f6=[..._0x2eea78['body']['expiry_date']],_0x30e0a4=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x257)]],_0x4ddacb=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x264)]],_0x11148a=[..._0x2eea78['body'][_0x45965e(0x28b)]],_0x1ab398=[..._0x2eea78['body'][_0x45965e(0x23d)]],_0x4d5922=[..._0x2eea78['body'][_0x45965e(0x23f)]],_0x48f8c3=[..._0x2eea78['body'][_0x45965e(0x270)]],_0x3c2e9d=[..._0x2eea78['body']['from_invoice']],_0x2af55e=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x1f5)]],_0x4ac3ed=[..._0x2eea78[_0x45965e(0x259)][_0x45965e(0x224)]];const _0x78d8f4=_0x41aec0[_0x45965e(0x1e5)](_0x3944bf=>{return _0x3944bf={'product_name':_0x3944bf};});_0x5b3d81[_0x45965e(0x29a)]((_0x53f007,_0x127e83)=>{var _0x336ae6=_0x45965e;_0x78d8f4[_0x127e83][_0x336ae6(0x292)]=_0x53f007;}),_0x3fd52f[_0x45965e(0x29a)]((_0x2650e9,_0x5aade9)=>{_0x78d8f4[_0x5aade9]['from_bay']=_0x2650e9;}),_0x4ac3ed[_0x45965e(0x29a)]((_0x2ddb30,_0x5bb23c)=>{_0x78d8f4[_0x5bb23c]['id_transaction']=_0x2ddb30;}),_0x3c2e9d[_0x45965e(0x29a)]((_0x1e9a08,_0x5e36e4)=>{var _0x47e8b8=_0x45965e;_0x78d8f4[_0x5e36e4][_0x47e8b8(0x25c)]=_0x1e9a08;}),_0x2af55e[_0x45965e(0x29a)]((_0x498de8,_0x29f885)=>{var _0x202138=_0x45965e;_0x78d8f4[_0x29f885][_0x202138(0x294)]=_0x498de8;}),_0x4855e4['forEach']((_0x24de0d,_0xcf25b7)=>{var _0x3cb975=_0x45965e;_0x78d8f4[_0xcf25b7][_0x3cb975(0x249)]=_0x24de0d;}),_0x1bd36c[_0x45965e(0x29a)]((_0x78c6eb,_0x17cfbf)=>{var _0x1ffe6f=_0x45965e;_0x78d8f4[_0x17cfbf][_0x1ffe6f(0x1fc)]=_0x78c6eb;}),_0x3860d8[_0x45965e(0x29a)]((_0x26fa91,_0x34ae61)=>{var _0x46a9ad=_0x45965e;_0x78d8f4[_0x34ae61][_0x46a9ad(0x24b)]=_0x26fa91;}),_0x45a887['forEach']((_0x34c5cf,_0x2c6367)=>{var _0x44ed88=_0x45965e;_0x78d8f4[_0x2c6367][_0x44ed88(0x247)]=_0x34c5cf;}),_0x4c8376['forEach']((_0x5d36cf,_0x33faf2)=>{var _0x1ce638=_0x45965e;_0x78d8f4[_0x33faf2][_0x1ce638(0x1de)]=_0x5d36cf;}),_0x4e020b[_0x45965e(0x29a)]((_0x5e1fee,_0x906289)=>{var _0x30f2bd=_0x45965e;_0x78d8f4[_0x906289][_0x30f2bd(0x1f8)]=_0x5e1fee;}),_0x58749d[_0x45965e(0x29a)]((_0x4dde6f,_0x2a1540)=>{_0x78d8f4[_0x2a1540]['unit']=_0x4dde6f;}),_0x268144['forEach']((_0xd95dfd,_0x1c8165)=>{var _0x4bb76c=_0x45965e;_0x78d8f4[_0x1c8165][_0x4bb76c(0x272)]=_0xd95dfd;}),_0x10e5da[_0x45965e(0x29a)]((_0x573f69,_0x1b38fa)=>{_0x78d8f4[_0x1b38fa]['batch_code']=_0x573f69;}),_0x15f6f6[_0x45965e(0x29a)]((_0x2151f9,_0x3949e3)=>{var _0x35d865=_0x45965e;_0x78d8f4[_0x3949e3][_0x35d865(0x20c)]=_0x2151f9;}),_0x30e0a4[_0x45965e(0x29a)]((_0x1f476d,_0xb3692)=>{var _0x1d10bb=_0x45965e;_0x78d8f4[_0xb3692][_0x1d10bb(0x250)]=_0x1f476d;}),_0x4ddacb['forEach']((_0xc7bae2,_0x373fb9)=>{var _0x4ff86c=_0x45965e;_0x78d8f4[_0x373fb9][_0x4ff86c(0x1f8)]=_0xc7bae2;}),_0x11148a['forEach']((_0x5c035c,_0x897c9)=>{var _0x50faf6=_0x45965e;_0x78d8f4[_0x897c9][_0x50faf6(0x28b)]=_0x5c035c;}),_0x1ab398[_0x45965e(0x29a)]((_0x4efdb6,_0x1c341d)=>{var _0x236d16=_0x45965e;_0x78d8f4[_0x1c341d][_0x236d16(0x23d)]=_0x4efdb6;}),_0x4d5922['forEach']((_0x251768,_0xc99483)=>{var _0x44b932=_0x45965e;_0x78d8f4[_0xc99483][_0x44b932(0x2ac)]=_0x251768;}),_0x48f8c3['forEach']((_0x884e40,_0x2178a1)=>{var _0x2a9739=_0x45965e;_0x78d8f4[_0x2178a1][_0x2a9739(0x21a)]=_0x884e40;});const _0x5442c9=_0x78d8f4[_0x45965e(0x255)](_0x2a2b3e=>_0x2a2b3e[_0x45965e(0x249)]!=='0'&&_0x2a2b3e[_0x45965e(0x249)]!==''||_0x2a2b3e[_0x45965e(0x273)]!=='0'&&_0x2a2b3e[_0x45965e(0x273)]!=='');var _0x18bf59=0x0;_0x5442c9['forEach'](_0x5a584f=>{var _0x7fd8=_0x45965e;parseInt(_0x5a584f['from_quantity'])<parseInt(_0x5a584f[_0x7fd8(0x249)])&&_0x18bf59++;});if(_0x18bf59!=0x0)return _0x2eea78[_0x45965e(0x1e1)](_0x45965e(0x266),_0x45965e(0x202)),_0x2589e1[_0x45965e(0x2ad)]('back');const _0x481d0a=new transfers_finished({'date':_0x525eb8,'from_warehouse':_0x2e8a0b,'to_warehouse':_0x18175e,'product':_0x5442c9,'note':_0x697b56,'invoice':_0xdb3c69}),_0x39153d=await _0x481d0a[_0x45965e(0x29d)]();_0x2eea78[_0x45965e(0x1e1)](_0x45965e(0x25d),_0x45965e(0x275)),_0x2589e1[_0x45965e(0x2ad)]('/transfer_finished/preview/'+_0x39153d[_0x45965e(0x231)]);}catch(_0x37a2c0){console[_0x45965e(0x216)](_0x37a2c0),_0x2589e1[_0x45965e(0x271)](0xc8)['json']({'errorMessage':_0x37a2c0[_0x45965e(0x23a)]});}}),router[a0_0x2c9195(0x2a3)](a0_0x2c9195(0x28f),auth,async(_0x306672,_0x35a9c8)=>{var _0x210cb8=a0_0x2c9195;try{const {username:_0x7f2d2a,email:_0x48f555,role:_0x1405a7}=_0x306672['user'],_0x19f022=_0x306672[_0x210cb8(0x26c)],_0x2c67b0=await profile['findOne']({'email':_0x19f022['email']}),_0x2c7330=await master_shop[_0x210cb8(0x1ef)](),_0x360070=await transfers_finished['findById'](_0x306672[_0x210cb8(0x251)]['id']);let _0x81a49a;if(_0x19f022['role']=='staff'){const _0x25e795=await staff[_0x210cb8(0x1e8)]({'email':_0x19f022['email']});_0x81a49a=await warehouse[_0x210cb8(0x1ef)]({'status':_0x210cb8(0x1d0),'name':_0x25e795[_0x210cb8(0x1df)],'warehouse_category':_0x210cb8(0x210)});}else _0x81a49a=await warehouse[_0x210cb8(0x1ef)]({'status':_0x210cb8(0x1d0),'warehouse_category':_0x210cb8(0x210)});const _0x49ad9f=await warehouse[_0x210cb8(0x1ee)]([{'$match':{'name':_0x360070['from_warehouse'],'warehouse_category':_0x210cb8(0x210)}},{'$unwind':_0x210cb8(0x20a)},{'$group':{'_id':_0x210cb8(0x25e),'name':{'$first':_0x210cb8(0x1cc)},'product_stock':{'$first':_0x210cb8(0x244)},'bay':{'$first':_0x210cb8(0x1f2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x210cb8(0x22f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x210cb8(0x1ff)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x210cb8(0x234)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x210cb8(0x21f)},'room':{'$first':_0x210cb8(0x24a)},'warehoue_name':{'$first':'$name'}}}]),_0x5110b8=await product['find']({});if(_0x2c7330[0x0]['language']==_0x210cb8(0x297)){var _0x151bc7=users[_0x210cb8(0x286)];console[_0x210cb8(0x216)](_0x151bc7);}else{if(_0x2c7330[0x0]['language']==_0x210cb8(0x24f))var _0x151bc7=users[_0x210cb8(0x24f)];else{if(_0x2c7330[0x0][_0x210cb8(0x23b)]=='German')var _0x151bc7=users['German'];else{if(_0x2c7330[0x0][_0x210cb8(0x23b)]==_0x210cb8(0x2a0))var _0x151bc7=users[_0x210cb8(0x2a0)];else{if(_0x2c7330[0x0][_0x210cb8(0x23b)]==_0x210cb8(0x26a))var _0x151bc7=users[_0x210cb8(0x26a)];else{if(_0x2c7330[0x0][_0x210cb8(0x23b)]==_0x210cb8(0x20d))var _0x151bc7=users[_0x210cb8(0x245)];else{if(_0x2c7330[0x0][_0x210cb8(0x23b)]==_0x210cb8(0x280))var _0x151bc7=users['Chinese'];else{if(_0x2c7330[0x0]['language']==_0x210cb8(0x1e2))var _0x151bc7=users[_0x210cb8(0x213)];}}}}}}}_0x35a9c8['render']('edit_transfer_finished_view',{'success':_0x306672[_0x210cb8(0x1e1)](_0x210cb8(0x25d)),'errors':_0x306672['flash'](_0x210cb8(0x266)),'role':_0x19f022,'profile':_0x2c67b0,'master_shop':_0x2c7330,'warehouse':_0x81a49a,'transfer':_0x360070,'stock':_0x49ad9f,'unit':_0x5110b8,'language':_0x151bc7});}catch(_0x405521){console['log'](_0x405521);}}),router['post'](a0_0x2c9195(0x28f),auth,async(_0x56df66,_0x49df31)=>{var _0x335cad=a0_0x2c9195;try{const {invoice:_0x5f5c4a,from_warehouse:_0x3772ff,FromRoom_name:_0xbfb96b,to_warehouse:_0x3f04a1,ToRoom_name:_0x25bf78}=_0x56df66[_0x335cad(0x259)],_0x1eaf2b=await transfers_finished[_0x335cad(0x277)](_0x56df66['params']['id']),_0x1d44fe=_0x1eaf2b[_0x335cad(0x285)][_0x335cad(0x1e5)](async _0x312e95=>{var _0x45e131=_0x335cad;if(_0x312e95[_0x45e131(0x249)]>0x0){var _0x3656db=await warehouse[_0x45e131(0x1e8)]({'name':_0x3772ff,'room':_0x312e95[_0x45e131(0x2ac)],'warehouse_category':_0x45e131(0x210)});const _0x336113=_0x3656db['product_details'][_0x45e131(0x1e5)](_0x467330=>{var _0x919fb4=_0x45e131;_0x467330[_0x919fb4(0x22d)]==_0x312e95[_0x919fb4(0x22d)]&&_0x467330[_0x919fb4(0x212)]==_0x312e95[_0x919fb4(0x289)]&&_0x467330['expiry_date']==_0x312e95[_0x919fb4(0x20c)]&&_0x467330['production_date']==_0x312e95[_0x919fb4(0x250)]&&_0x467330['batch_code']==_0x312e95[_0x919fb4(0x21e)]&&_0x467330[_0x919fb4(0x295)]==_0x312e95[_0x919fb4(0x25c)]&&(console[_0x919fb4(0x216)](_0x919fb4(0x267),_0x467330[_0x919fb4(0x225)]),typeof _0x312e95[_0x919fb4(0x224)]=='undefined'?_0x467330[_0x919fb4(0x225)]=Math['max'](0x0,Math[_0x919fb4(0x1dd)](_0x467330[_0x919fb4(0x225)])-Math[_0x919fb4(0x1dd)](_0x312e95[_0x919fb4(0x249)])):_0x467330[_0x919fb4(0x225)]=Math['max'](0x0,Math[_0x919fb4(0x1dd)](_0x467330[_0x919fb4(0x225)])-Math[_0x919fb4(0x1dd)](_0x312e95[_0x919fb4(0x249)])));});}return _0x3656db;});Promise['all'](_0x1d44fe)['then'](async _0x51c411=>{var _0x2ed613=_0x335cad;try{for(const _0x50b3cc of _0x51c411){await _0x50b3cc[_0x2ed613(0x29d)]();}const _0x5e6356=_0x1eaf2b[_0x2ed613(0x285)][_0x2ed613(0x1e5)](async _0x108794=>{var _0x1a8981=_0x2ed613,_0x1e1d38=await warehouse[_0x1a8981(0x1e8)]({'name':_0x3f04a1,'room':_0x108794[_0x1a8981(0x21a)]});if(_0x108794['to_quantity']>0x0){var _0x3ba0db=0x0;const _0x5530b5=_0x1e1d38[_0x1a8981(0x1e6)]['map'](_0x377986=>{var _0x47c0ae=_0x1a8981;_0x377986[_0x47c0ae(0x22d)]==_0x108794['product_name']&&_0x377986['bay']==_0x108794[_0x47c0ae(0x1fc)]&&_0x377986[_0x47c0ae(0x20c)]==_0x108794['expiry_date']&&_0x377986[_0x47c0ae(0x250)]==_0x108794[_0x47c0ae(0x250)]&&_0x377986['batch_code']==_0x108794[_0x47c0ae(0x21e)]&&_0x377986['invoice']==_0x108794[_0x47c0ae(0x294)]&&(typeof _0x108794[_0x47c0ae(0x224)]==_0x47c0ae(0x1d5)?(console[_0x47c0ae(0x216)](_0x47c0ae(0x1d1),_0x377986[_0x47c0ae(0x225)]+_0x47c0ae(0x1dc)+_0x377986[_0x47c0ae(0x231)]+'\x20<=>\x20'+Math['abs'](_0x377986['product_stock'])+Math[_0x47c0ae(0x1dd)](_0x108794[_0x47c0ae(0x249)])),_0x377986[_0x47c0ae(0x225)]=Math[_0x47c0ae(0x1dd)](_0x377986['product_stock'])+Math['abs'](_0x108794[_0x47c0ae(0x249)])):_0x377986[_0x47c0ae(0x225)]=Math['abs'](_0x377986['product_stock'])+Math[_0x47c0ae(0x1dd)](_0x108794[_0x47c0ae(0x249)]),_0x3ba0db++);});_0x3ba0db=='0'&&(_0x1e1d38[_0x1a8981(0x1e6)]=_0x1e1d38[_0x1a8981(0x1e6)][_0x1a8981(0x278)]({'product_name':_0x108794['product_name'],'product_stock':_0x108794[_0x1a8981(0x249)],'bay':_0x108794['to_bay'],'product_code':_0x108794[_0x1a8981(0x1de)],'primary_code':_0x108794[_0x1a8981(0x24b)],'secondary_code':_0x108794[_0x1a8981(0x247)],'expiry_date':_0x108794[_0x1a8981(0x20c)],'production_date':_0x108794[_0x1a8981(0x250)],'maxProducts':_0x108794['maxProducts'],'batch_code':_0x108794['batch_code'],'secondary_unit':_0x108794[_0x1a8981(0x272)],'unit':_0x108794[_0x1a8981(0x219)],'maxProducts':_0x108794[_0x1a8981(0x1f8)],'maxPerUnit':_0x108794['maxPerUnit'],'invoice':_0x108794[_0x1a8981(0x294)]}));}return _0x1e1d38;});Promise[_0x2ed613(0x2a4)](_0x5e6356)['then'](async _0x415dc5=>{var _0x2d2473=_0x2ed613;try{for(const _0xac33ac of _0x415dc5){await warehouse['updateOne']({'_id':_0xac33ac[_0x2d2473(0x231)]},{'$addToSet':{'product_details':{'$each':_0xac33ac[_0x2d2473(0x1e6)]}}});}_0x1eaf2b[_0x2d2473(0x238)]='True';const _0x1bb01f=await _0x1eaf2b[_0x2d2473(0x29d)](),_0x41d0c5=await master_shop['find'](),_0xc8aee3=await email_settings[_0x2d2473(0x1e8)](),_0x3a599d=await supervisor_settings[_0x2d2473(0x1ef)]();var _0xc781b4=_0x1eaf2b[_0x2d2473(0x285)],_0x580540='',_0x295355;for(_0x295355 in _0xc781b4){var _0x44ba13='FG';_0x1eaf2b[_0x2d2473(0x217)]=='DRY\x20GOODS'&&(_0x44ba13='DG'),_0x580540+='<tr>'+_0x2d2473(0x1fb)+_0xc781b4[_0x295355][_0x2d2473(0x22d)]+_0x2d2473(0x22c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc781b4[_0x295355][_0x2d2473(0x1de)]+_0x2d2473(0x22c)+_0x2d2473(0x1fb)+_0xc781b4[_0x295355][_0x2d2473(0x249)]+_0x2d2473(0x22c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc781b4[_0x295355][_0x2d2473(0x219)]+'</td>'+_0x2d2473(0x1fb)+_0xc781b4[_0x295355]['secondary_unit']+'</td>'+_0x2d2473(0x1fb)+_0x1eaf2b[_0x2d2473(0x217)]+_0x2d2473(0x22c)+_0x2d2473(0x1fb)+_0xc781b4[_0x295355][_0x2d2473(0x21a)]+'</td>'+_0x2d2473(0x1fb)+_0x44ba13+_0xc781b4[_0x295355]['to_bay']+_0x2d2473(0x22c)+_0x2d2473(0x261);}let _0x211e4e=nodemailer[_0x2d2473(0x288)]({'host':_0xc8aee3['host'],'port':Number(_0xc8aee3[_0x2d2473(0x1ec)]),'secure':![],'auth':{'user':_0xc8aee3['email'],'pass':_0xc8aee3[_0x2d2473(0x236)]}}),_0x20ddfc={'from':_0xc8aee3['email'],'to':_0x3a599d[0x0]['FGSEmail'],'subject':_0x2d2473(0x1e3),'attachments':[{'filename':_0x2d2473(0x1cb),'path':__dirname+_0x2d2473(0x1db)+_0x2d2473(0x256)+_0x41d0c5[0x0]['image'],'cid':_0x2d2473(0x226)}],'html':_0x2d2473(0x1ca)+_0x2d2473(0x28e)+'</head><body>'+_0x2d2473(0x268)+_0x2d2473(0x1f4)+_0x2d2473(0x268)+_0x2d2473(0x279)+_0x2d2473(0x21c)+'<div>'+'<h2>\x20'+_0x41d0c5[0x0][_0x2d2473(0x252)]+_0x2d2473(0x1da)+_0x2d2473(0x21c)+'</div>'+_0x2d2473(0x2a7)+_0x2d2473(0x268)+_0x2d2473(0x263)+'\x20Order\x20Number\x20:\x20'+_0x1eaf2b[_0x2d2473(0x295)]+'\x20'+_0x2d2473(0x1ed)+_0x2d2473(0x237)+_0x1eaf2b[_0x2d2473(0x230)]+'\x20'+_0x2d2473(0x2ab)+_0x2d2473(0x26f)+_0x2d2473(0x21c)+_0x2d2473(0x28d)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2d2473(0x1f0)+_0x2d2473(0x20f)+_0x2d2473(0x258)+_0x2d2473(0x23c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x2d2473(0x287)+_0x2d2473(0x203)+_0x2d2473(0x27a)+_0x2d2473(0x265)+'</tr>'+_0x2d2473(0x28c)+_0x2d2473(0x1e4)+'\x20'+_0x580540+'\x20'+_0x2d2473(0x201)+_0x2d2473(0x27f)+'<div>'+_0x2d2473(0x1d7)+_0x2d2473(0x223)+_0x41d0c5[0x0]['site_title']+_0x2d2473(0x26f)+'</div>'+_0x2d2473(0x21c)+_0x2d2473(0x222)};_0x211e4e[_0x2d2473(0x233)](_0x20ddfc,function(_0x155516,_0x4d2578){var _0x2427f8=_0x2d2473;_0x155516?(console[_0x2427f8(0x216)](_0x155516),console[_0x2427f8(0x216)](_0x2427f8(0x1d9))):console[_0x2427f8(0x216)](_0x2427f8(0x22b));}),_0x56df66[_0x2d2473(0x1e1)](_0x2d2473(0x25d),'Transfer\x20Finalize\x20Successfully'),_0x49df31[_0x2d2473(0x2ad)](_0x2d2473(0x240)+_0x1bb01f[_0x2d2473(0x231)]);}catch(_0x20c3c3){console[_0x2d2473(0x262)](_0x20c3c3),_0x49df31[_0x2d2473(0x271)](0x1f4)['json']({'error':_0x2d2473(0x25b)});}})[_0x2ed613(0x2a5)](_0x432e37=>{var _0x523081=_0x2ed613;console['error'](_0x432e37),_0x49df31[_0x523081(0x271)](0x1f4)[_0x523081(0x29e)]({'error':_0x523081(0x1fa)});});}catch(_0x2a6bbc){console[_0x2ed613(0x262)](_0x2a6bbc),_0x49df31[_0x2ed613(0x271)](0x1f4)[_0x2ed613(0x29e)]({'error':_0x2ed613(0x269)});}})[_0x335cad(0x2a5)](_0x108e7d=>{var _0x1fb444=_0x335cad;console[_0x1fb444(0x262)](_0x108e7d),_0x49df31[_0x1fb444(0x271)](0x1f4)[_0x1fb444(0x29e)]({'error':'An\x20error\x20occurred.'});});}catch(_0x21dd36){_0x49df31['json']({'message':_0x21dd36[_0x335cad(0x23a)]});}});function BayBinSelected(_0x1f6bd6,_0x5a3619){var _0x4993e0=a0_0x2c9195,_0x51f16f=[];let _0x42256f=[];var _0x3d1b9a=[];if(_0x1f6bd6==_0x4993e0(0x241)){switch(_0x5a3619){case _0x4993e0(0x27c):_0x51f16f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x51f16f=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3d1b9a=['DG'];}else{if(_0x1f6bd6=='FROZEN\x20GOODS'){switch(_0x5a3619){case _0x4993e0(0x27c):_0x51f16f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4993e0(0x291):_0x51f16f=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3d1b9a=['FG'];}}return{'levels':_0x51f16f,'identify':_0x3d1b9a};}function a0_0x1560(_0x299a2d,_0x4e2eb5){var _0x1ded57=a0_0x1ded();return a0_0x1560=function(_0x15601a,_0x2f9d0a){_0x15601a=_0x15601a-0x1ca;var _0x5507d9=_0x1ded57[_0x15601a];return _0x5507d9;},a0_0x1560(_0x299a2d,_0x4e2eb5);}router['get'](a0_0x2c9195(0x283),auth,async(_0x22f021,_0x9a2f98)=>{var _0xa06818=a0_0x2c9195;try{const {username:_0x46ab91,email:_0x2d3520,role:_0x222004}=_0x22f021[_0xa06818(0x26c)],_0x1f1064=_0x22f021[_0xa06818(0x26c)],_0x1a2d22=await profile[_0xa06818(0x1e8)]({'email':_0x1f1064[_0xa06818(0x242)]}),_0x261695=await master_shop['find'](),_0x50d618=await transfers_finished[_0xa06818(0x277)](_0x22f021[_0xa06818(0x251)]['id']);let _0x93af79=new Date(_0x50d618[_0xa06818(0x20c)]),_0x278318=('0'+_0x93af79[_0xa06818(0x1d4)]())[_0xa06818(0x281)](-0x2),_0x90c639=('0'+(_0x93af79['getMonth']()+0x1))[_0xa06818(0x281)](-0x2),_0x5b4804=_0x93af79[_0xa06818(0x24c)](),_0x5dad2b=_0x5b4804+'-'+_0x90c639+'-'+_0x278318,_0x1a972d;if(_0x1f1064[_0xa06818(0x293)]==_0xa06818(0x2a6)){const _0x32a2a9=await staff[_0xa06818(0x1e8)]({'email':_0x1f1064[_0xa06818(0x242)]});_0x1a972d=await warehouse[_0xa06818(0x1ef)]({'status':'Enabled','name':_0x32a2a9[_0xa06818(0x1df)],'warehouse_category':_0xa06818(0x210)});}else _0x1a972d=await warehouse[_0xa06818(0x1ef)]({'status':_0xa06818(0x1d0),'warehouse_category':_0xa06818(0x210)});const _0x255b19=await warehouse['aggregate']([{'$match':{'name':_0x50d618[_0xa06818(0x24d)],'room':_0x50d618[_0xa06818(0x204)]}},{'$unwind':_0xa06818(0x20a)},{'$group':{'_id':_0xa06818(0x25e),'name':{'$first':_0xa06818(0x1cc)},'product_stock':{'$first':_0xa06818(0x244)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xa06818(0x27b)},'type':{'$first':_0xa06818(0x29c)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xa06818(0x29b)},'secondary_code':{'$first':_0xa06818(0x1ff)},'product_code':{'$first':_0xa06818(0x29f)},'storage':{'$first':_0xa06818(0x284)},'rack':{'$first':'$product_details.rack'}}}]);var _0x23cea3=[0x1,0x2,0x3,0x4],_0x1cd929=['A','B','C','D','E','F','G','H','I','J'],_0xe5d849=[_0xa06818(0x1e0),_0xa06818(0x260)];const _0x313ef0=await product[_0xa06818(0x1ef)]({}),_0xafb9ce=BayBinSelected(_0x50d618[_0xa06818(0x217)],_0x50d618[_0xa06818(0x28a)]);if(_0x261695[0x0]['language']==_0xa06818(0x297)){var _0x3ce031=users[_0xa06818(0x286)];console['log'](_0x3ce031);}else{if(_0x261695[0x0][_0xa06818(0x23b)]=='Hindi')var _0x3ce031=users[_0xa06818(0x24f)];else{if(_0x261695[0x0][_0xa06818(0x23b)]==_0xa06818(0x24e))var _0x3ce031=users[_0xa06818(0x24e)];else{if(_0x261695[0x0][_0xa06818(0x23b)]==_0xa06818(0x2a0))var _0x3ce031=users[_0xa06818(0x2a0)];else{if(_0x261695[0x0][_0xa06818(0x23b)]==_0xa06818(0x26a))var _0x3ce031=users[_0xa06818(0x26a)];else{if(_0x261695[0x0]['language']==_0xa06818(0x20d))var _0x3ce031=users[_0xa06818(0x245)];else{if(_0x261695[0x0][_0xa06818(0x23b)]=='Chinese')var _0x3ce031=users[_0xa06818(0x280)];else{if(_0x261695[0x0]['language']==_0xa06818(0x1e2))var _0x3ce031=users[_0xa06818(0x213)];}}}}}}}_0x9a2f98[_0xa06818(0x27e)](_0xa06818(0x221),{'success':_0x22f021[_0xa06818(0x1e1)](_0xa06818(0x25d)),'errors':_0x22f021[_0xa06818(0x1e1)](_0xa06818(0x266)),'role':_0x1f1064,'profile':_0x1a2d22,'master_shop':_0x261695,'warehouse':_0x1a972d,'transfer':_0x50d618,'stock':_0x255b19,'unit':_0x313ef0,'language':_0x3ce031,'levels':_0x23cea3,'Isle':_0x1cd929,'rooms_data':_0xe5d849,'ed_fullDate':_0x5dad2b,'dataSelected':_0xafb9ce});}catch(_0x23cb9d){console[_0xa06818(0x216)](_0x23cb9d);}}),router[a0_0x2c9195(0x21b)](a0_0x2c9195(0x283),auth,async(_0xb22ddc,_0xe2459e)=>{var _0x54a3d8=a0_0x2c9195;try{const _0x43196f=_0xb22ddc[_0x54a3d8(0x251)]['id'];console[_0x54a3d8(0x216)](_0xb22ddc[_0x54a3d8(0x259)]);const _0x269a62=await transfers_finished['findById'](_0x43196f);console[_0x54a3d8(0x216)](_0x54a3d8(0x26b),_0x269a62);const {date:_0x418d43,from_warehouse:_0x281572,FromRoom_name:_0x4ebc01,to_warehouse:_0x23229c,ToRoom_name:_0x579923,prod_name:_0x4793c6,from_prod_qty:_0x57ef19,from_prod_level:_0x34ed7a,from_prod_isle:_0x28c374,from_prod_pallet:_0x1e0fc3,to_prod_qty:_0x23ed90,to_prod_level:_0x17669f,to_prod_isle:_0x1819d4,to_prod_pallet:_0x36df56,primary_code:_0x36bedc,secondary_code:_0x41040a,product_code3:_0x5c392b,note:_0x4c97a6,invoice:_0x23b748,expiry_date:_0x13142d}=_0xb22ddc['body'];if(typeof _0x4793c6==_0x54a3d8(0x20e))var _0x130d8f=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x207)]],_0x2dd3d3=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x27d)]],_0x37e40c=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x2aa)]],_0x51f449=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x299)]],_0xb537ec=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x276)]],_0x16f621=[_0xb22ddc[_0x54a3d8(0x259)]['primary_code']],_0x276d52=[_0xb22ddc[_0x54a3d8(0x259)]['secondary_code']],_0xa81cd7=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x1ea)]],_0x37b1a8=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x205)]],_0x272d9c=[_0xb22ddc['body']['unit']],_0x13601c=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x272)]],_0x2d6cfc=[_0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x21e)]],_0x40220b=[_0xb22ddc['body'][_0x54a3d8(0x20c)]];else var _0x130d8f=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x207)]],_0x2dd3d3=[..._0xb22ddc['body'][_0x54a3d8(0x27d)]],_0x37e40c=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x2aa)]],_0x51f449=[..._0xb22ddc['body'][_0x54a3d8(0x299)]],_0xb537ec=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x276)]],_0x16f621=[..._0xb22ddc[_0x54a3d8(0x259)]['primary_code']],_0x276d52=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x247)]],_0xa81cd7=[..._0xb22ddc['body'][_0x54a3d8(0x1ea)]],_0x37b1a8=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x205)]],_0x272d9c=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x219)]],_0x13601c=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x272)]],_0x2d6cfc=[..._0xb22ddc[_0x54a3d8(0x259)][_0x54a3d8(0x21e)]],_0x40220b=[..._0xb22ddc[_0x54a3d8(0x259)]['expiry_date']];const _0x46c5c9=_0x130d8f[_0x54a3d8(0x1e5)](_0x49b92a=>{return _0x49b92a={'product_name':_0x49b92a};});_0x2dd3d3[_0x54a3d8(0x29a)]((_0x37c4d7,_0x192303)=>{_0x46c5c9[_0x192303]['from_quantity']=_0x37c4d7;}),_0x37e40c[_0x54a3d8(0x29a)]((_0x4b3db3,_0x1b9dff)=>{var _0x13b7db=_0x54a3d8;_0x46c5c9[_0x1b9dff][_0x13b7db(0x289)]=_0x4b3db3;}),_0x51f449[_0x54a3d8(0x29a)]((_0x4297f4,_0x9a1693)=>{var _0x38367d=_0x54a3d8;_0x46c5c9[_0x9a1693][_0x38367d(0x249)]=_0x4297f4;}),_0xb537ec[_0x54a3d8(0x29a)]((_0x27fdf5,_0xcd23ac)=>{var _0x3f843a=_0x54a3d8;_0x46c5c9[_0xcd23ac][_0x3f843a(0x1fc)]=_0x27fdf5;}),_0x16f621['forEach']((_0x285177,_0x5306dc)=>{var _0x5c29f1=_0x54a3d8;_0x46c5c9[_0x5306dc][_0x5c29f1(0x24b)]=_0x285177;}),_0x276d52['forEach']((_0x237304,_0x3dc84e)=>{var _0x2446e0=_0x54a3d8;_0x46c5c9[_0x3dc84e][_0x2446e0(0x247)]=_0x237304;}),_0xa81cd7[_0x54a3d8(0x29a)]((_0x432afb,_0x5e331e)=>{var _0x452b25=_0x54a3d8;_0x46c5c9[_0x5e331e][_0x452b25(0x1de)]=_0x432afb;}),_0x37b1a8[_0x54a3d8(0x29a)]((_0x49c640,_0x1e3ec7)=>{_0x46c5c9[_0x1e3ec7]['maxProducts']=_0x49c640;}),_0x272d9c['forEach']((_0x21682d,_0x31bd5c)=>{var _0x316b0c=_0x54a3d8;_0x46c5c9[_0x31bd5c][_0x316b0c(0x219)]=_0x21682d;}),_0x13601c['forEach']((_0x4d1dab,_0x312453)=>{var _0x529278=_0x54a3d8;_0x46c5c9[_0x312453][_0x529278(0x272)]=_0x4d1dab;}),_0x2d6cfc[_0x54a3d8(0x29a)]((_0x1f44aa,_0x3e5d52)=>{var _0x3a2b61=_0x54a3d8;_0x46c5c9[_0x3e5d52][_0x3a2b61(0x21e)]=_0x1f44aa;}),_0x40220b[_0x54a3d8(0x29a)]((_0x331159,_0x3e926e)=>{var _0x3c524a=_0x54a3d8;_0x46c5c9[_0x3e926e][_0x3c524a(0x20c)]=_0x331159;});const _0x12394a=_0x46c5c9[_0x54a3d8(0x255)](_0x5c4706=>_0x5c4706[_0x54a3d8(0x249)]!=='0'&&_0x5c4706[_0x54a3d8(0x249)]!==''||_0x5c4706[_0x54a3d8(0x273)]!=='0'&&_0x5c4706[_0x54a3d8(0x273)]!=='');var _0xab9c2=0x0;_0x12394a[_0x54a3d8(0x29a)](_0x42756f=>{var _0x370252=_0x54a3d8;parseInt(_0x42756f[_0x370252(0x292)])<parseInt(_0x42756f[_0x370252(0x249)])&&_0xab9c2++;});if(_0xab9c2!=0x0)return _0xb22ddc['flash'](_0x54a3d8(0x266),_0x54a3d8(0x202)),_0xe2459e['redirect'](_0x54a3d8(0x235));const _0x914298=await warehouse[_0x54a3d8(0x1e8)]({'name':_0x269a62[_0x54a3d8(0x24d)],'room':_0x269a62['from_room']});_0x269a62[_0x54a3d8(0x285)][_0x54a3d8(0x29a)](_0x15285e=>{var _0x796637=_0x54a3d8;if(_0x15285e[_0x796637(0x249)]>0x0){const _0x48ee7e=_0x914298['product_details'][_0x796637(0x1e5)](_0x10e0c5=>{var _0x158442=_0x796637;_0x10e0c5[_0x158442(0x22d)]==_0x15285e[_0x158442(0x22d)]&&_0x10e0c5[_0x158442(0x212)]==_0x15285e[_0x158442(0x289)]&&(_0x10e0c5[_0x158442(0x225)]=parseInt(_0x10e0c5[_0x158442(0x225)])+parseInt(_0x15285e['to_quantity']));});}}),await _0x914298[_0x54a3d8(0x29d)]();const _0x246643=await warehouse[_0x54a3d8(0x1e8)]({'name':_0x269a62['to_warehouse'],'room':_0x269a62[_0x54a3d8(0x28a)]});_0x269a62[_0x54a3d8(0x285)]['forEach'](_0x212377=>{var _0x240ff8=_0x54a3d8;if(_0x212377[_0x240ff8(0x249)]>0x0){const _0x350e06=_0x246643[_0x240ff8(0x1e6)][_0x240ff8(0x1e5)](_0x510b65=>{var _0xbe0c55=_0x240ff8;_0x510b65['product_name']==_0x212377[_0xbe0c55(0x22d)]&&_0x510b65[_0xbe0c55(0x212)]==_0x212377[_0xbe0c55(0x1fc)]&&(_0x510b65['product_stock']=parseInt(_0x510b65[_0xbe0c55(0x225)])-parseInt(_0x212377[_0xbe0c55(0x249)]));});}}),await _0x246643[_0x54a3d8(0x29d)](),_0x269a62['date']=_0x418d43,_0x269a62[_0x54a3d8(0x24d)]=_0x281572,_0x269a62[_0x54a3d8(0x217)]=_0x23229c,_0x269a62[_0x54a3d8(0x285)]=_0x12394a,_0x269a62[_0x54a3d8(0x2a1)]=_0x4c97a6,_0x269a62[_0x54a3d8(0x295)]=_0x23b748;const _0x39149d=await _0x269a62[_0x54a3d8(0x29d)](),_0x4b963a=await warehouse['findOne']({'name':_0x281572,'room':_0x4ebc01});_0x39149d[_0x54a3d8(0x285)][_0x54a3d8(0x29a)](_0x5a0775=>{var _0x33e4fa=_0x54a3d8;if(_0x5a0775['to_quantity']>0x0){const _0x5d2419=_0x4b963a[_0x33e4fa(0x1e6)][_0x33e4fa(0x1e5)](_0x517795=>{var _0x1fb6ff=_0x33e4fa;_0x517795['product_name']==_0x5a0775['product_name']&&_0x517795[_0x1fb6ff(0x212)]==_0x5a0775[_0x1fb6ff(0x289)]&&(_0x517795[_0x1fb6ff(0x225)]=parseInt(_0x517795[_0x1fb6ff(0x225)])-parseInt(_0x5a0775['to_quantity']));});}}),await _0x4b963a[_0x54a3d8(0x29d)]();const _0x3f3518=await warehouse[_0x54a3d8(0x1e8)]({'name':_0x23229c,'room':_0x579923});_0x39149d[_0x54a3d8(0x285)][_0x54a3d8(0x29a)](_0x450bdb=>{var _0x3b61da=_0x54a3d8;if(_0x450bdb['to_quantity']>0x0){var _0x3a0ced=0x0;const _0xc53b6=_0x3f3518['product_details'][_0x3b61da(0x1e5)](_0x3e74b4=>{var _0x2add51=_0x3b61da;_0x3e74b4[_0x2add51(0x22d)]==_0x450bdb[_0x2add51(0x22d)]&&_0x3e74b4[_0x2add51(0x212)]==_0x450bdb[_0x2add51(0x1fc)]&&(_0x3e74b4['product_stock']=parseInt(_0x3e74b4[_0x2add51(0x225)])+parseInt(_0x450bdb[_0x2add51(0x249)]),_0x3a0ced++);});_0x3a0ced=='0'&&(_0x3f3518[_0x3b61da(0x1e6)]=_0x3f3518[_0x3b61da(0x1e6)][_0x3b61da(0x278)]({'product_name':_0x450bdb['product_name'],'product_stock':_0x450bdb[_0x3b61da(0x249)],'bay':_0x450bdb[_0x3b61da(0x1fc)],'product_code':_0x450bdb[_0x3b61da(0x1de)],'primary_code':_0x450bdb['primary_code'],'secondary_code':_0x450bdb[_0x3b61da(0x247)],'maxProducts':_0x450bdb[_0x3b61da(0x1f8)]}));}}),await _0x3f3518[_0x54a3d8(0x29d)](),_0xb22ddc[_0x54a3d8(0x1e1)](_0x54a3d8(0x25d),_0x54a3d8(0x209)),_0xe2459e[_0x54a3d8(0x2ad)](_0x54a3d8(0x2a9));}catch(_0x396396){console[_0x54a3d8(0x216)](_0x396396);}}),router['post']('/barcode_scanner',async(_0x289a13,_0x428cef)=>{var _0x22f107=a0_0x2c9195;const {FromWareHouse:_0x16834e,FromRoom:_0xc7b757,ToWarehouse:_0xec3aac,ToRoom:_0x10ac18,primary_code:_0x4c2b67,Roomslist:_0xe79945}=_0x289a13['body'],_0x374a84=_0xe79945[_0x22f107(0x2a2)](','),_0x57602a=[];async function _0x56b9a5(_0x456fb3){var _0x57ed1f=_0x22f107;const _0x4c0d11=await warehouse[_0x57ed1f(0x1ee)]([{'$match':{'name':_0x16834e,'room':_0x456fb3}},{'$unwind':_0x57ed1f(0x20a)},{'$match':{'product_details.primary_code':_0x4c2b67}},{'$group':{'_id':_0x57ed1f(0x25e),'name':{'$first':_0x57ed1f(0x1cc)},'instock':{'$first':_0x57ed1f(0x244)},'primary_code':{'$first':_0x57ed1f(0x29b)},'secondary_code':{'$first':_0x57ed1f(0x1ff)},'product_code':{'$first':_0x57ed1f(0x29f)},'level':{'$first':_0x57ed1f(0x1f2)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x57ed1f(0x29c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x57ed1f(0x1cf)},'secondary_unit':{'$first':_0x57ed1f(0x26d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x57ed1f(0x234)},'expiry_date':{'$first':_0x57ed1f(0x298)},'production_date':{'$first':_0x57ed1f(0x21f)},'batch_code':{'$first':_0x57ed1f(0x1f3)},'maxPerUnit':{'$first':_0x57ed1f(0x1eb)},'roomNamed':{'$first':_0x57ed1f(0x24a)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x57ed1f(0x22a)}}}]),_0x19d885=await warehouse[_0x57ed1f(0x1ee)]([{'$match':{'name':_0x16834e,'room':_0x456fb3}},{'$unwind':_0x57ed1f(0x20a)},{'$match':{'product_details.secondary_code':_0x4c2b67}},{'$group':{'_id':_0x57ed1f(0x25e),'name':{'$first':_0x57ed1f(0x1cc)},'instock':{'$first':_0x57ed1f(0x244)},'primary_code':{'$first':_0x57ed1f(0x29b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x57ed1f(0x29f)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x57ed1f(0x27b)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x57ed1f(0x22f)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x57ed1f(0x26d)},'storage':{'$first':_0x57ed1f(0x284)},'rack':{'$first':_0x57ed1f(0x234)},'expiry_date':{'$first':_0x57ed1f(0x298)},'production_date':{'$first':_0x57ed1f(0x21f)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x57ed1f(0x1eb)},'roomNamed':{'$first':_0x57ed1f(0x24a)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x4c0d11[_0x57ed1f(0x214)]>0x0)_0x57602a[_0x57ed1f(0x208)](_0x4c0d11);else _0x19d885[_0x57ed1f(0x214)]>0x0&&_0x57602a[_0x57ed1f(0x208)](_0x19d885);}const _0x12373a=_0x374a84[_0x22f107(0x1e5)](_0x495195=>_0x56b9a5(_0x495195));await Promise[_0x22f107(0x2a4)](_0x12373a),_0x428cef['json'](_0x57602a);}),router[a0_0x2c9195(0x21b)](a0_0x2c9195(0x1e9),async(_0x37ed3b,_0x5282e0)=>{var _0x3ff50f=a0_0x2c9195;try{const {FromWareHouse:_0x6ea787,FromRoom:_0x37460b,ToWarehouse:_0x181dd9,ToRoom:_0x841da8,secondary_code:_0x1417c4}=_0x37ed3b[_0x3ff50f(0x259)],_0x285242=await warehouse[_0x3ff50f(0x1ee)]([{'$match':{'name':_0x6ea787}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1417c4}},{'$group':{'_id':_0x3ff50f(0x25e),'name':{'$first':_0x3ff50f(0x1cc)},'primary_code':{'$first':_0x3ff50f(0x29b)},'secondary_code':{'$first':_0x3ff50f(0x1ff)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x3ff50f(0x244)},'warehouse':{'$first':_0x3ff50f(0x220)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x3ff50f(0x246)},'pallet':{'$first':_0x3ff50f(0x22e)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x3ff50f(0x298)},'production_date':{'$first':_0x3ff50f(0x21f)}}}]);_0x5282e0['status'](0xc8)[_0x3ff50f(0x29e)](_0x285242);}catch(_0x3fe8e6){_0x5282e0[_0x3ff50f(0x271)](0x194)[_0x3ff50f(0x29e)]({'message':_0x3fe8e6[_0x3ff50f(0x23a)]});}}),router[a0_0x2c9195(0x21b)]('/barcode_scanner3',async(_0xb26d98,_0x548425)=>{var _0x396c31=a0_0x2c9195;try{const {FromWareHouse:_0x10c187,FromRoom:_0x3649a8,ToWarehouse:_0x37934f,ToRoom:_0x5263f9,product_code:_0x173a58}=_0xb26d98[_0x396c31(0x259)],_0x25a4e4=await warehouse[_0x396c31(0x1ee)]([{'$match':{'name':_0x10c187}},{'$unwind':_0x396c31(0x20a)},{'$match':{'product_details.product_code':_0x173a58}},{'$group':{'_id':_0x396c31(0x25e),'name':{'$first':_0x396c31(0x1cc)},'primary_code':{'$first':_0x396c31(0x29b)},'secondary_code':{'$first':_0x396c31(0x1ff)},'product_code':{'$first':_0x396c31(0x29f)},'instock':{'$first':_0x396c31(0x244)},'warehouse':{'$first':_0x396c31(0x220)},'level':{'$first':_0x396c31(0x254)},'isle':{'$first':_0x396c31(0x246)},'pallet':{'$first':_0x396c31(0x22e)},'maxProducts':{'$first':_0x396c31(0x1f6)},'unit':{'$first':_0x396c31(0x1cf)}}}]);_0x548425[_0x396c31(0x271)](0xc8)['json'](_0x25a4e4);}catch(_0x3309bb){_0x548425[_0x396c31(0x271)](0x194)[_0x396c31(0x29e)]({'message':_0x3309bb[_0x396c31(0x23a)]});}}),router[a0_0x2c9195(0x21b)](a0_0x2c9195(0x228),async(_0x51ede8,_0x115335)=>{var _0x35c1cb=a0_0x2c9195;const {productCode:_0x54caa6,bay:_0x4adc5b,warehouses:_0x46f6f9,room:_0x48df67}=_0x51ede8[_0x35c1cb(0x259)];console[_0x35c1cb(0x216)](_0x51ede8[_0x35c1cb(0x259)]);try{const _0x3691dc=await warehouse[_0x35c1cb(0x1ee)]([{'$match':{'name':_0x46f6f9,'room':_0x48df67}},{'$unwind':_0x35c1cb(0x20a)},{'$match':{'product_details.bay':parseInt(_0x4adc5b)}},{'$group':{'_id':_0x35c1cb(0x25e),'name':{'$first':_0x35c1cb(0x1cc)},'product_stock':{'$first':_0x35c1cb(0x244)},'bay':{'$first':_0x35c1cb(0x1f2)},'maxProducts':{'$first':_0x35c1cb(0x1f6)}}}]);_0x115335['status'](0xc8)['json'](_0x3691dc);}catch(_0x4d85b9){_0x115335[_0x35c1cb(0x271)](0x194)[_0x35c1cb(0x29e)]({'message':_0x4d85b9[_0x35c1cb(0x23a)]});}}),module[a0_0x2c9195(0x218)]=router;