var a0_0x5e18dd=a0_0x4c23;(function(_0x23c163,_0x3bd4e3){var _0xcc4b28=a0_0x4c23,_0x40be62=_0x23c163();while(!![]){try{var _0x2b39bc=-parseInt(_0xcc4b28(0x251))/0x1+-parseInt(_0xcc4b28(0x1a3))/0x2*(-parseInt(_0xcc4b28(0x1b3))/0x3)+parseInt(_0xcc4b28(0x1de))/0x4+-parseInt(_0xcc4b28(0x217))/0x5+-parseInt(_0xcc4b28(0x1d8))/0x6*(parseInt(_0xcc4b28(0x1c0))/0x7)+-parseInt(_0xcc4b28(0x1a5))/0x8*(-parseInt(_0xcc4b28(0x19e))/0x9)+parseInt(_0xcc4b28(0x256))/0xa;if(_0x2b39bc===_0x3bd4e3)break;else _0x40be62['push'](_0x40be62['shift']());}catch(_0x4ca40e){_0x40be62['push'](_0x40be62['shift']());}}}(a0_0x2147,0x74a0e));const express=require(a0_0x5e18dd(0x1f0)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x5e18dd(0x23c)),auth=require(a0_0x5e18dd(0x23f)),users=require(a0_0x5e18dd(0x224)),nodemailer=require(a0_0x5e18dd(0x239));function a0_0x4c23(_0x1073cf,_0x419e27){var _0x214791=a0_0x2147();return a0_0x4c23=function(_0x4c2343,_0x2c6562){_0x4c2343=_0x4c2343-0x196;var _0x49a4ee=_0x214791[_0x4c2343];return _0x49a4ee;},a0_0x4c23(_0x1073cf,_0x419e27);}router[a0_0x5e18dd(0x255)](a0_0x5e18dd(0x259),auth,async(_0x1ba149,_0x101a07)=>{var _0x2af0f7=a0_0x5e18dd;try{const {username:_0x4f8564,email:_0x512ed7,role:_0xb6f084}=_0x1ba149['user'],_0xf289e4=_0x1ba149[_0x2af0f7(0x211)],_0x46d196=await profile['findOne']({'email':_0xf289e4[_0x2af0f7(0x1fc)]}),_0x26fff2=await master_shop[_0x2af0f7(0x1c7)]();let _0x299197;if(_0xf289e4[_0x2af0f7(0x221)]==_0x2af0f7(0x207)){const _0x143224=await staff[_0x2af0f7(0x1d2)]({'email':_0xf289e4[_0x2af0f7(0x1fc)]});_0x299197=await transfers_finished[_0x2af0f7(0x1c7)]({'from_warehouse':_0x143224['warehouse']});}else _0x299197=await transfers_finished[_0x2af0f7(0x1ca)]([{'$unwind':_0x2af0f7(0x22f)},{'$group':{'_id':_0x2af0f7(0x1e9),'invoice':{'$first':_0x2af0f7(0x1d6)},'date':{'$first':_0x2af0f7(0x1f2)},'from_warehouse':{'$first':_0x2af0f7(0x1a4)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x2af0f7(0x235)},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x2af0f7(0x21c)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x26fff2[0x0]['language']==_0x2af0f7(0x206))var _0x24d4ce=users[_0x2af0f7(0x1f1)];else{if(_0x26fff2[0x0]['language']==_0x2af0f7(0x227))var _0x24d4ce=users[_0x2af0f7(0x227)];else{if(_0x26fff2[0x0]['language']==_0x2af0f7(0x215))var _0x24d4ce=users['German'];else{if(_0x26fff2[0x0]['language']==_0x2af0f7(0x22d))var _0x24d4ce=users[_0x2af0f7(0x22d)];else{if(_0x26fff2[0x0][_0x2af0f7(0x225)]==_0x2af0f7(0x1e1))var _0x24d4ce=users[_0x2af0f7(0x1e1)];else{if(_0x26fff2[0x0][_0x2af0f7(0x225)]==_0x2af0f7(0x20b))var _0x24d4ce=users[_0x2af0f7(0x1db)];else{if(_0x26fff2[0x0][_0x2af0f7(0x225)]=='Chinese')var _0x24d4ce=users[_0x2af0f7(0x1a9)];else{if(_0x26fff2[0x0][_0x2af0f7(0x225)]==_0x2af0f7(0x1d4))var _0x24d4ce=users[_0x2af0f7(0x226)];}}}}}}}_0x101a07[_0x2af0f7(0x1a7)]('transfer_finished',{'success':_0x1ba149['flash']('success'),'errors':_0x1ba149[_0x2af0f7(0x24d)](_0x2af0f7(0x1fb)),'role':_0xf289e4,'profile':_0x46d196,'master_shop':_0x26fff2,'transfer':_0x299197,'language':_0x24d4ce});}catch(_0x9a7a1){console[_0x2af0f7(0x22a)](_0x9a7a1);}});async function getRandom8DigitNumber(){var _0x57753d=a0_0x5e18dd;const _0x40d358=0x989680,_0x2e167f=0x5f5e0ff,_0x5331d1=Math[_0x57753d(0x230)](Math[_0x57753d(0x1c8)]()*(_0x2e167f-_0x40d358+0x1))+_0x40d358;var _0x475e70;const _0x73f69d=await transfers_finished[_0x57753d(0x1d2)]({'invoice':_0x57753d(0x1e7)+_0x5331d1});return _0x73f69d&&_0x73f69d[_0x57753d(0x196)]>0x0?_0x475e70='TRFF-'+_0x5331d1:_0x475e70=_0x57753d(0x1e7)+_0x5331d1,_0x475e70;}router[a0_0x5e18dd(0x255)](a0_0x5e18dd(0x19f),auth,async(_0x31ba09,_0x587349)=>{var _0x2bd542=a0_0x5e18dd;try{const {username:_0x4aab61,email:_0x4fc582,role:_0x5a51ba}=_0x31ba09['user'],_0x260fbd=_0x31ba09['user'],_0x342ae2=await profile[_0x2bd542(0x1d2)]({'email':_0x260fbd[_0x2bd542(0x1fc)]}),_0x2d3df2=await master_shop['find']();let _0x2f0623;if(_0x260fbd[_0x2bd542(0x221)]==_0x2bd542(0x207)){const _0x4263cb=await staff[_0x2bd542(0x1d2)]({'email':_0x260fbd[_0x2bd542(0x1fc)]});_0x2f0623=await warehouse[_0x2bd542(0x1ca)]([{'$match':{'status':_0x2bd542(0x1f6),'name':_0x4263cb[_0x2bd542(0x264)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x2bd542(0x1a6),'name':{'$first':'$name'}}}]);}else _0x2f0623=await warehouse[_0x2bd542(0x1ca)]([{'$match':{'status':_0x2bd542(0x1f6),'warehouse_category':_0x2bd542(0x254),'name':{'$ne':_0x2bd542(0x1fd)}}},{'$group':{'_id':_0x2bd542(0x1a6),'name':{'$first':_0x2bd542(0x1a6)}}}]);const _0x3a21c6=await transfers_finished[_0x2bd542(0x1c7)]({}),_0xee17b7=_0x3a21c6[_0x2bd542(0x196)]+0x1,_0x45e903=_0x2bd542(0x1e7)+_0xee17b7[_0x2bd542(0x1e0)]()['padStart'](0x5,'0');if(_0x2d3df2[0x0][_0x2bd542(0x225)]==_0x2bd542(0x206))var _0x3ce470=users[_0x2bd542(0x1f1)];else{if(_0x2d3df2[0x0]['language']==_0x2bd542(0x227))var _0x3ce470=users[_0x2bd542(0x227)];else{if(_0x2d3df2[0x0][_0x2bd542(0x225)]==_0x2bd542(0x215))var _0x3ce470=users[_0x2bd542(0x215)];else{if(_0x2d3df2[0x0]['language']=='Spanish')var _0x3ce470=users[_0x2bd542(0x22d)];else{if(_0x2d3df2[0x0]['language']=='French')var _0x3ce470=users[_0x2bd542(0x1e1)];else{if(_0x2d3df2[0x0]['language']=='Portuguese\x20(BR)')var _0x3ce470=users[_0x2bd542(0x1db)];else{if(_0x2d3df2[0x0][_0x2bd542(0x225)]==_0x2bd542(0x1a9))var _0x3ce470=users[_0x2bd542(0x1a9)];else{if(_0x2d3df2[0x0][_0x2bd542(0x225)]=='Arabic\x20(ae)')var _0x3ce470=users[_0x2bd542(0x226)];}}}}}}}const _0x32158f=getRandom8DigitNumber();_0x32158f[_0x2bd542(0x21b)](_0x162251=>{var _0x316903=_0x2bd542;_0x587349[_0x316903(0x1a7)](_0x316903(0x210),{'success':_0x31ba09[_0x316903(0x24d)](_0x316903(0x260)),'errors':_0x31ba09[_0x316903(0x24d)](_0x316903(0x1fb)),'role':_0x260fbd,'profile':_0x342ae2,'master_shop':_0x2d3df2,'warehouse':_0x2f0623,'language':_0x3ce470,'invoice':_0x162251});})[_0x2bd542(0x1f3)](_0x35423a=>{var _0x33a53e=_0x2bd542;_0x31ba09['flash'](_0x33a53e(0x1fb),_0x33a53e(0x24b)),_0x587349['redirect'](_0x33a53e(0x218));});}catch(_0x5d2b32){console[_0x2bd542(0x22a)](_0x5d2b32);}}),router[a0_0x5e18dd(0x261)]('/view/add_transfer',auth,async(_0x5a2f89,_0x2363ab)=>{var _0x45cdb7=a0_0x5e18dd;try{const {date:_0x62e26f,from_warehouse:_0x119c78,FromRoom_name:_0x273717,to_warehouse:_0x4326d7,ToRoom_name:_0x9785aa,prod_name:_0x35eff1,from_prod_qty:_0xc15e6,from_prod_level:_0x8d76a6,from_prod_isle:_0x158063,from_prod_pallet:_0x108c98,to_prod_qty:_0x5159bd,to_prod_level:_0x25e465,to_prod_isle:_0x42ec04,to_prod_pallet:_0x1bb4f3,primary_code:_0x4d2f75,secondary_code:_0x54334f,product_code3:_0x4f8847,note:_0x4f2948,MaxStocks_data2:_0xdbc21c,invoice:_0x22c24f,expiry_date:_0x307d27}=_0x5a2f89[_0x45cdb7(0x25f)];if(typeof _0x35eff1=='string')var _0x4c9e5e=[_0x5a2f89[_0x45cdb7(0x25f)]['prod_name']],_0x3e07a6=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1f5)]],_0x4bf6af=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1be)]],_0x22a363=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1bc)]],_0x4153ea=[_0x5a2f89['body'][_0x45cdb7(0x1d3)]],_0x30ad5e=[_0x5a2f89['body'][_0x45cdb7(0x1b5)]],_0x2fe5cb=[_0x5a2f89[_0x45cdb7(0x25f)]['secondary_code']],_0x3be29a=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x232)]],_0x480f5b=[_0x5a2f89[_0x45cdb7(0x25f)]['MaxStocks_data2']],_0x2ad438=[_0x5a2f89['body'][_0x45cdb7(0x1ac)]],_0x38ae76=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1bd)]],_0x482740=[_0x5a2f89['body'][_0x45cdb7(0x1b9)]],_0x2538b5=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x238)]],_0x4f629e=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x197)]],_0x4d7ab9=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1a1)]],_0x3f0ef1=[_0x5a2f89[_0x45cdb7(0x25f)]['maxPerUnit']],_0x62c45d=[_0x5a2f89['body'][_0x45cdb7(0x1d9)]],_0x5b8d55=[_0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1b1)]],_0x586bdd=[_0x5a2f89['body'][_0x45cdb7(0x1f4)]],_0x3b80c2=[_0x5a2f89[_0x45cdb7(0x25f)]['from_invoice']],_0x413e40=[_0x5a2f89[_0x45cdb7(0x25f)]['to_invoice']];else var _0x4c9e5e=[..._0x5a2f89[_0x45cdb7(0x25f)]['prod_name']],_0x3e07a6=[..._0x5a2f89['body'][_0x45cdb7(0x1f5)]],_0x4bf6af=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1be)]],_0x22a363=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1bc)]],_0x4153ea=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1d3)]],_0x30ad5e=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1b5)]],_0x2fe5cb=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x199)]],_0x3be29a=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x232)]],_0x480f5b=[..._0x5a2f89['body'][_0x45cdb7(0x20f)]],_0x2ad438=[..._0x5a2f89[_0x45cdb7(0x25f)]['primary_unit']],_0x38ae76=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1bd)]],_0x482740=[..._0x5a2f89['body'][_0x45cdb7(0x1b9)]],_0x2538b5=[..._0x5a2f89[_0x45cdb7(0x25f)]['expiry_date']],_0x4f629e=[..._0x5a2f89['body'][_0x45cdb7(0x197)]],_0x4d7ab9=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1a1)]],_0x3f0ef1=[..._0x5a2f89[_0x45cdb7(0x25f)]['maxPerUnit']],_0x62c45d=[..._0x5a2f89['body'][_0x45cdb7(0x1d9)]],_0x5b8d55=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1b1)]],_0x586bdd=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x1f4)]],_0x3b80c2=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x23e)]],_0x413e40=[..._0x5a2f89[_0x45cdb7(0x25f)][_0x45cdb7(0x213)]];const _0x7e0d6b=_0x4c9e5e['map'](_0x5d421d=>{return _0x5d421d={'product_name':_0x5d421d};});_0x3e07a6[_0x45cdb7(0x248)]((_0x4eecf2,_0x435a84)=>{var _0x21cc90=_0x45cdb7;_0x7e0d6b[_0x435a84][_0x21cc90(0x23d)]=_0x4eecf2;}),_0x4bf6af['forEach']((_0x5bdcda,_0x200479)=>{var _0x9fe71d=_0x45cdb7;_0x7e0d6b[_0x200479][_0x9fe71d(0x247)]=_0x5bdcda;}),_0x3b80c2['forEach']((_0x58a840,_0x1b4258)=>{_0x7e0d6b[_0x1b4258]['from_invoice']=_0x58a840;}),_0x413e40[_0x45cdb7(0x248)]((_0xb1420c,_0x14075c)=>{var _0x486868=_0x45cdb7;_0x7e0d6b[_0x14075c][_0x486868(0x266)]=_0xb1420c;}),_0x22a363[_0x45cdb7(0x248)]((_0x8b4ba5,_0x5bcca6)=>{_0x7e0d6b[_0x5bcca6]['to_quantity']=_0x8b4ba5;}),_0x4153ea[_0x45cdb7(0x248)]((_0x50e6e1,_0x1a76bb)=>{_0x7e0d6b[_0x1a76bb]['to_bay']=_0x50e6e1;}),_0x30ad5e['forEach']((_0x57d0ce,_0x5077a9)=>{var _0x36eadf=_0x45cdb7;_0x7e0d6b[_0x5077a9][_0x36eadf(0x1b5)]=_0x57d0ce;}),_0x2fe5cb[_0x45cdb7(0x248)]((_0x4da4b4,_0x3c1182)=>{var _0x963978=_0x45cdb7;_0x7e0d6b[_0x3c1182][_0x963978(0x199)]=_0x4da4b4;}),_0x3be29a[_0x45cdb7(0x248)]((_0x530246,_0x234b42)=>{_0x7e0d6b[_0x234b42]['product_code']=_0x530246;}),_0x480f5b[_0x45cdb7(0x248)]((_0x17f99a,_0x3262cb)=>{_0x7e0d6b[_0x3262cb]['maxProducts']=_0x17f99a;}),_0x2ad438[_0x45cdb7(0x248)]((_0x41a2cc,_0x3a248d)=>{var _0x44428b=_0x45cdb7;_0x7e0d6b[_0x3a248d][_0x44428b(0x1ec)]=_0x41a2cc;}),_0x38ae76[_0x45cdb7(0x248)]((_0x230bd1,_0xa77387)=>{var _0x19e4c0=_0x45cdb7;_0x7e0d6b[_0xa77387][_0x19e4c0(0x1bd)]=_0x230bd1;}),_0x482740['forEach']((_0x8edab2,_0x14ca7c)=>{var _0x1740e1=_0x45cdb7;_0x7e0d6b[_0x14ca7c][_0x1740e1(0x1b9)]=_0x8edab2;}),_0x2538b5[_0x45cdb7(0x248)]((_0x3e0a13,_0x52e443)=>{var _0x518a1f=_0x45cdb7;_0x7e0d6b[_0x52e443][_0x518a1f(0x238)]=_0x3e0a13;}),_0x4f629e[_0x45cdb7(0x248)]((_0x3e528f,_0x374fc4)=>{var _0x3f96c7=_0x45cdb7;_0x7e0d6b[_0x374fc4][_0x3f96c7(0x22b)]=_0x3e528f;}),_0x4d7ab9['forEach']((_0xbcb3e5,_0x58da59)=>{_0x7e0d6b[_0x58da59]['maxProducts']=_0xbcb3e5;}),_0x3f0ef1[_0x45cdb7(0x248)]((_0x5a0666,_0x430e24)=>{_0x7e0d6b[_0x430e24]['maxPerUnit']=_0x5a0666;}),_0x62c45d[_0x45cdb7(0x248)]((_0x44c2b4,_0x52446e)=>{var _0x45f456=_0x45cdb7;_0x7e0d6b[_0x52446e][_0x45f456(0x1d9)]=_0x44c2b4;}),_0x5b8d55[_0x45cdb7(0x248)]((_0x30ade9,_0x1579b3)=>{var _0x5170ee=_0x45cdb7;_0x7e0d6b[_0x1579b3][_0x5170ee(0x25a)]=_0x30ade9;}),_0x586bdd['forEach']((_0xfc72f3,_0x1debb2)=>{var _0x2016be=_0x45cdb7;_0x7e0d6b[_0x1debb2][_0x2016be(0x1af)]=_0xfc72f3;});const _0x1ebbb4=_0x7e0d6b[_0x45cdb7(0x228)](_0x48d69b=>_0x48d69b['to_quantity']!=='0'&&_0x48d69b[_0x45cdb7(0x25b)]!==''||_0x48d69b['to_floorlevel']!=='0'&&_0x48d69b[_0x45cdb7(0x1ff)]!=='');var _0x48b07e=0x0;_0x1ebbb4[_0x45cdb7(0x248)](_0x56e10e=>{var _0x1de430=_0x45cdb7;parseInt(_0x56e10e[_0x1de430(0x23d)])<parseInt(_0x56e10e[_0x1de430(0x25b)])&&_0x48b07e++;});if(_0x48b07e!=0x0)return _0x5a2f89['flash'](_0x45cdb7(0x1fb),_0x45cdb7(0x242)),_0x2363ab['redirect'](_0x45cdb7(0x1dc));const _0x4c7235=new transfers_finished({'date':_0x62e26f,'from_warehouse':_0x119c78,'to_warehouse':_0x4326d7,'product':_0x1ebbb4,'note':_0x4f2948,'invoice':_0x22c24f}),_0x2bf3ab=await _0x4c7235[_0x45cdb7(0x219)]();_0x5a2f89[_0x45cdb7(0x24d)](_0x45cdb7(0x260),'Product\x20Transfer\x20successfully'),_0x2363ab[_0x45cdb7(0x244)]('/transfer_finished/preview/'+_0x2bf3ab[_0x45cdb7(0x19d)]);}catch(_0x1fb79c){console['log'](_0x1fb79c),_0x2363ab[_0x45cdb7(0x220)](0xc8)[_0x45cdb7(0x25e)]({'errorMessage':_0x1fb79c[_0x45cdb7(0x203)]});}}),router[a0_0x5e18dd(0x255)](a0_0x5e18dd(0x1e3),auth,async(_0xece92,_0x72cd59)=>{var _0x4b4674=a0_0x5e18dd;try{const {username:_0x11b6d2,email:_0x51538e,role:_0x3baa43}=_0xece92[_0x4b4674(0x211)],_0x1e4914=_0xece92['user'],_0x14e28f=await profile[_0x4b4674(0x1d2)]({'email':_0x1e4914['email']}),_0xa5eaf0=await master_shop[_0x4b4674(0x1c7)](),_0x5ce8e0=await transfers_finished[_0x4b4674(0x1e5)](_0xece92[_0x4b4674(0x19a)]['id']);let _0x4eda9f;if(_0x1e4914[_0x4b4674(0x221)]==_0x4b4674(0x207)){const _0x50386b=await staff[_0x4b4674(0x1d2)]({'email':_0x1e4914[_0x4b4674(0x1fc)]});_0x4eda9f=await warehouse[_0x4b4674(0x1c7)]({'status':_0x4b4674(0x1f6),'name':_0x50386b['warehouse'],'warehouse_category':_0x4b4674(0x254)});}else _0x4eda9f=await warehouse['find']({'status':_0x4b4674(0x1f6),'warehouse_category':_0x4b4674(0x254)});const _0x1491b0=await warehouse[_0x4b4674(0x1ca)]([{'$match':{'name':_0x5ce8e0[_0x4b4674(0x21f)],'warehouse_category':_0x4b4674(0x254)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4b4674(0x1dd),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4b4674(0x1a0)},'bay':{'$first':_0x4b4674(0x1e4)},'bin':{'$first':_0x4b4674(0x212)},'type':{'$first':_0x4b4674(0x1d0)},'floorlevel':{'$first':_0x4b4674(0x204)},'primary_code':{'$first':_0x4b4674(0x245)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4b4674(0x20e)},'storage':{'$first':_0x4b4674(0x1a8)},'rack':{'$first':_0x4b4674(0x24e)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':_0x4b4674(0x1bb)},'warehoue_name':{'$first':_0x4b4674(0x1a6)}}}]),_0x533941=await product[_0x4b4674(0x1c7)]({});if(_0xa5eaf0[0x0][_0x4b4674(0x225)]==_0x4b4674(0x206)){var _0x5c7793=users[_0x4b4674(0x1f1)];console['log'](_0x5c7793);}else{if(_0xa5eaf0[0x0][_0x4b4674(0x225)]=='Hindi')var _0x5c7793=users[_0x4b4674(0x227)];else{if(_0xa5eaf0[0x0][_0x4b4674(0x225)]==_0x4b4674(0x215))var _0x5c7793=users[_0x4b4674(0x215)];else{if(_0xa5eaf0[0x0][_0x4b4674(0x225)]==_0x4b4674(0x22d))var _0x5c7793=users[_0x4b4674(0x22d)];else{if(_0xa5eaf0[0x0][_0x4b4674(0x225)]==_0x4b4674(0x1e1))var _0x5c7793=users[_0x4b4674(0x1e1)];else{if(_0xa5eaf0[0x0]['language']=='Portuguese\x20(BR)')var _0x5c7793=users[_0x4b4674(0x1db)];else{if(_0xa5eaf0[0x0]['language']=='Chinese')var _0x5c7793=users['Chinese'];else{if(_0xa5eaf0[0x0][_0x4b4674(0x225)]==_0x4b4674(0x1d4))var _0x5c7793=users['Arabic'];}}}}}}}_0x72cd59[_0x4b4674(0x1a7)]('edit_transfer_finished_view',{'success':_0xece92['flash']('success'),'errors':_0xece92[_0x4b4674(0x24d)](_0x4b4674(0x1fb)),'role':_0x1e4914,'profile':_0x14e28f,'master_shop':_0xa5eaf0,'warehouse':_0x4eda9f,'transfer':_0x5ce8e0,'stock':_0x1491b0,'unit':_0x533941,'language':_0x5c7793});}catch(_0x3ce061){console[_0x4b4674(0x22a)](_0x3ce061);}}),router['post']('/preview/:id',auth,async(_0x4bdcb5,_0x8b6d5d)=>{var _0x30542e=a0_0x5e18dd;try{const {invoice:_0x5061f8,from_warehouse:_0x4ba398,FromRoom_name:_0x3cdd16,to_warehouse:_0x2e964a,ToRoom_name:_0x35e0e0}=_0x4bdcb5[_0x30542e(0x25f)],_0x12c783=await transfers_finished[_0x30542e(0x1e5)](_0x4bdcb5[_0x30542e(0x19a)]['id']),_0x20a147=_0x12c783[_0x30542e(0x1d7)][_0x30542e(0x1aa)](async _0x2b69c1=>{var _0x4c9858=_0x30542e;if(_0x2b69c1[_0x4c9858(0x25b)]>0x0){var _0x41a3ca=await warehouse[_0x4c9858(0x1d2)]({'name':_0x4ba398,'room':_0x2b69c1['from_room_name'],'warehouse_category':'Finished\x20Goods'});const _0x39cbba=_0x41a3ca[_0x4c9858(0x1ed)][_0x4c9858(0x1aa)](_0x45df67=>{var _0x5a59a2=_0x4c9858;_0x45df67[_0x5a59a2(0x1f7)]==_0x2b69c1[_0x5a59a2(0x1f7)]&&_0x45df67[_0x5a59a2(0x1cb)]==_0x2b69c1['from_bay']&&_0x45df67[_0x5a59a2(0x238)]==_0x2b69c1[_0x5a59a2(0x238)]&&_0x45df67['production_date']==_0x2b69c1[_0x5a59a2(0x22b)]&&_0x45df67[_0x5a59a2(0x1b9)]==_0x2b69c1['batch_code']&&_0x45df67[_0x5a59a2(0x1b6)]==_0x2b69c1[_0x5a59a2(0x23e)]&&(_0x45df67[_0x5a59a2(0x208)]=_0x45df67['product_stock']-_0x2b69c1[_0x5a59a2(0x25b)]);});}return _0x41a3ca;});Promise['all'](_0x20a147)[_0x30542e(0x21b)](async _0x20912b=>{var _0x3957f4=_0x30542e;try{for(const _0x37827d of _0x20912b){await _0x37827d['save']();}const _0x148281=_0x12c783['product'][_0x3957f4(0x1aa)](async _0x5e9980=>{var _0x93c80b=_0x3957f4,_0x493d26=await warehouse[_0x93c80b(0x1d2)]({'name':_0x2e964a,'room':_0x5e9980['to_room_name']});if(_0x5e9980[_0x93c80b(0x25b)]>0x0){var _0x5d42c3=0x0;const _0x1bc2a5=_0x493d26[_0x93c80b(0x1ed)]['map'](_0x355da4=>{var _0x2e16ce=_0x93c80b;_0x355da4[_0x2e16ce(0x1f7)]==_0x5e9980[_0x2e16ce(0x1f7)]&&_0x355da4[_0x2e16ce(0x1cb)]==_0x5e9980[_0x2e16ce(0x216)]&&_0x355da4[_0x2e16ce(0x238)]==_0x5e9980[_0x2e16ce(0x238)]&&_0x355da4[_0x2e16ce(0x22b)]==_0x5e9980['production_date']&&_0x355da4[_0x2e16ce(0x1b9)]==_0x5e9980[_0x2e16ce(0x1b9)]&&_0x355da4[_0x2e16ce(0x1b6)]==_0x5e9980[_0x2e16ce(0x266)]&&(_0x355da4[_0x2e16ce(0x208)]=_0x355da4[_0x2e16ce(0x208)]+_0x5e9980[_0x2e16ce(0x25b)],_0x5d42c3++);});_0x5d42c3=='0'&&(_0x493d26[_0x93c80b(0x1ed)]=_0x493d26['product_details']['concat']({'product_name':_0x5e9980[_0x93c80b(0x1f7)],'product_stock':_0x5e9980['to_quantity'],'bay':_0x5e9980['to_bay'],'product_code':_0x5e9980[_0x93c80b(0x246)],'primary_code':_0x5e9980[_0x93c80b(0x1b5)],'secondary_code':_0x5e9980[_0x93c80b(0x199)],'expiry_date':_0x5e9980[_0x93c80b(0x238)],'production_date':_0x5e9980['production_date'],'maxProducts':_0x5e9980[_0x93c80b(0x20d)],'batch_code':_0x5e9980[_0x93c80b(0x1b9)],'secondary_unit':_0x5e9980[_0x93c80b(0x1bd)],'unit':_0x5e9980['unit'],'maxProducts':_0x5e9980['maxProducts'],'maxPerUnit':_0x5e9980[_0x93c80b(0x1c5)],'invoice':_0x5e9980[_0x93c80b(0x266)]}));}return _0x493d26;});Promise[_0x3957f4(0x1c6)](_0x148281)['then'](async _0x3cc560=>{var _0x4c22f5=_0x3957f4;try{for(const _0x45a115 of _0x3cc560){await warehouse[_0x4c22f5(0x23a)]({'_id':_0x45a115['_id']},{'$addToSet':{'product_details':{'$each':_0x45a115[_0x4c22f5(0x1ed)]}}});}_0x12c783[_0x4c22f5(0x1c1)]=_0x4c22f5(0x1ae);const _0x544461=await _0x12c783[_0x4c22f5(0x219)](),_0x27cf16=await master_shop[_0x4c22f5(0x1c7)](),_0x3d48cb=await email_settings['findOne'](),_0x438bda=await supervisor_settings[_0x4c22f5(0x1c7)]();var _0x1c3cef=_0x12c783[_0x4c22f5(0x1d7)],_0xeb41dc='',_0x401293;for(_0x401293 in _0x1c3cef){var _0x1b9af1='FG';_0x12c783[_0x4c22f5(0x265)]==_0x4c22f5(0x25c)&&(_0x1b9af1='DG'),_0xeb41dc+=_0x4c22f5(0x250)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1c3cef[_0x401293][_0x4c22f5(0x1f7)]+_0x4c22f5(0x19b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1c3cef[_0x401293][_0x4c22f5(0x246)]+_0x4c22f5(0x19b)+_0x4c22f5(0x21d)+_0x1c3cef[_0x401293][_0x4c22f5(0x25b)]+_0x4c22f5(0x19b)+_0x4c22f5(0x21d)+_0x1c3cef[_0x401293]['unit']+'</td>'+_0x4c22f5(0x21d)+_0x1c3cef[_0x401293][_0x4c22f5(0x1bd)]+'</td>'+_0x4c22f5(0x21d)+_0x12c783[_0x4c22f5(0x265)]+_0x4c22f5(0x19b)+_0x4c22f5(0x21d)+_0x1c3cef[_0x401293][_0x4c22f5(0x1af)]+'</td>'+_0x4c22f5(0x21d)+_0x1b9af1+_0x1c3cef[_0x401293]['to_bay']+_0x4c22f5(0x19b)+'</tr>';}let _0xf59270=nodemailer[_0x4c22f5(0x1b7)]({'host':_0x3d48cb['host'],'port':Number(_0x3d48cb[_0x4c22f5(0x1ce)]),'secure':![],'auth':{'user':_0x3d48cb[_0x4c22f5(0x1fc)],'pass':_0x3d48cb[_0x4c22f5(0x198)]}}),_0x4c1098={'from':_0x3d48cb[_0x4c22f5(0x1fc)],'to':_0x438bda[0x0]['FGSEmail'],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x4c22f5(0x234),'path':__dirname+_0x4c22f5(0x20a)+_0x4c22f5(0x1c3)+_0x27cf16[0x0][_0x4c22f5(0x1c2)],'cid':'logo'}],'html':_0x4c22f5(0x23b)+_0x4c22f5(0x1cd)+_0x4c22f5(0x1b4)+_0x4c22f5(0x1ab)+_0x4c22f5(0x1ee)+_0x4c22f5(0x1ab)+_0x4c22f5(0x1f9)+_0x4c22f5(0x1d1)+_0x4c22f5(0x1ab)+_0x4c22f5(0x253)+_0x27cf16[0x0][_0x4c22f5(0x202)]+'\x20</h2>'+_0x4c22f5(0x1d1)+_0x4c22f5(0x1d1)+_0x4c22f5(0x1c4)+_0x4c22f5(0x1ab)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4c22f5(0x1ef)+_0x12c783[_0x4c22f5(0x1b6)]+'\x20'+_0x4c22f5(0x243)+_0x4c22f5(0x20c)+_0x12c783['date']+'\x20'+_0x4c22f5(0x1ba)+_0x4c22f5(0x222)+_0x4c22f5(0x1d1)+_0x4c22f5(0x214)+_0x4c22f5(0x24c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4c22f5(0x25d)+_0x4c22f5(0x257)+_0x4c22f5(0x233)+_0x4c22f5(0x209)+_0x4c22f5(0x24f)+_0x4c22f5(0x1fe)+_0x4c22f5(0x21a)+_0x4c22f5(0x231)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xeb41dc+'\x20'+_0x4c22f5(0x1ea)+'</table>'+'<div>'+_0x4c22f5(0x252)+'<h5>'+_0x27cf16[0x0][_0x4c22f5(0x202)]+_0x4c22f5(0x222)+_0x4c22f5(0x1d1)+_0x4c22f5(0x1d1)+_0x4c22f5(0x1c9)};_0xf59270[_0x4c22f5(0x1e8)](_0x4c1098,function(_0x3282d5,_0x288a80){var _0x477d6e=_0x4c22f5;_0x3282d5?(console[_0x477d6e(0x22a)](_0x3282d5),console['log'](_0x477d6e(0x229))):console[_0x477d6e(0x22a)]('Email\x20sent\x20successfully');}),_0x4bdcb5[_0x4c22f5(0x24d)](_0x4c22f5(0x260),'Transfer\x20Finalize\x20Successfully'),_0x8b6d5d[_0x4c22f5(0x244)](_0x4c22f5(0x263)+_0x544461[_0x4c22f5(0x19d)]);}catch(_0x2bb406){console[_0x4c22f5(0x205)](_0x2bb406),_0x8b6d5d['status'](0x1f4)['json']({'error':_0x4c22f5(0x1d5)});}})[_0x3957f4(0x1f3)](_0x1f2257=>{var _0x177de7=_0x3957f4;console[_0x177de7(0x205)](_0x1f2257),_0x8b6d5d[_0x177de7(0x220)](0x1f4)[_0x177de7(0x25e)]({'error':_0x177de7(0x201)});});}catch(_0x11b2cf){console[_0x3957f4(0x205)](_0x11b2cf),_0x8b6d5d['status'](0x1f4)[_0x3957f4(0x25e)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x30542e(0x1f3)](_0x364ed3=>{var _0x4c5fa3=_0x30542e;console['error'](_0x364ed3),_0x8b6d5d[_0x4c5fa3(0x220)](0x1f4)['json']({'error':_0x4c5fa3(0x201)});});}catch(_0x5e0f69){_0x8b6d5d[_0x30542e(0x25e)]({'message':_0x5e0f69[_0x30542e(0x203)]});}});function BayBinSelected(_0x33cce9,_0x4a080b){var _0x1030ff=a0_0x5e18dd,_0x104b63=[];let _0x4823d8=[];var _0x5d6abb=[];if(_0x33cce9==_0x1030ff(0x25c)){switch(_0x4a080b){case _0x1030ff(0x1cc):_0x104b63=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1030ff(0x22e):_0x104b63=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5d6abb=['DG'];}else{if(_0x33cce9=='FROZEN\x20GOODS'){switch(_0x4a080b){case _0x1030ff(0x1cc):_0x104b63=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1030ff(0x22e):_0x104b63=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5d6abb=['FG'];}}return{'levels':_0x104b63,'identify':_0x5d6abb};}function a0_0x2147(){var _0x490422=['$product_details.bay','findById','$product_details.isle','TRFF-','sendMail','$_id','</tbody>','/view/:id','unit','product_details','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','\x20Order\x20Number\x20:\x20','express','English','$date','catch','ToRoomAssigned','from_prod_qty','Enabled','product_name','$product_details.pallet','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getDate','errors','email','QA\x20Warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','to_floorlevel','edit_transfer_finished','An\x20error\x20occurred.','site_title','message','$product_details.floorlevel','error','English\x20(US)','staff','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/../public','Portuguese\x20(BR)','\x20Order\x20Date\x20:\x20','maxProducts','$product_details.product_code','MaxStocks_data2','add_transfer_finished','user','$product_details.bin','to_invoice','<table\x20style=\x22width:\x20100%\x20!important;\x22>','German','to_bay','888105SZrtwS','/transfer/view','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','then','$finalize','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.unit','from_warehouse','status','role','</h5>','to_prod_qty','../public/language/languages.json','language','Arabic','Hindi','filter','Error\x20Occurs','log','production_date','$product_details.expiry_date','Spanish','Rack\x202','$product','floor','</tr>','product_code3','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Logo.png','$product.from_room_name','slice','Ambient','expiry_date','nodemailer','updateOne','<!DOCTYPE\x20html>','../models/all_models','from_quantity','from_invoice','../middleware/auth','$product_details.secondary_code','from_room','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<span\x20style=\x22float:\x20right;\x22>','redirect','$product_details.primary_code','product_code','from_bay','forEach','/CheckingWarehouse','$product_details.level','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','flash','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<tr>','699085QKYVDc','<strong>\x20Regards\x20</strong>','<h2>\x20','Finished\x20Goods','get','1359090cnJzja','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/barcode_scanner3','/view','from_room_name','to_quantity','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','json','body','success','post','$product_details.production_date','/picking_list/PDF_transfer/','warehouse','to_warehouse','To_invoice','to_room','length','product_date','password','secondary_code','params','</td>','date','_id','189QBYqwp','/view/add_transfer','$product_details.product_stock','MaxStocks_data','prod_name','3554LpWzRi','$from_warehouse','247976FhCmzi','$name','render','$product_details.storage','Chinese','map','<div>','primary_unit','string','True','to_room_name','$product_details.secondary_unit','RoomAssigned','$product_details.product_name','1083akXpxE','</head><body>','primary_code','invoice','createTransport','$product_details.invoice','batch_code','</span>','$room','New_Qty_Converted','secondary_unit','from_prod_level','$product_details.maxProducts','3340442euLLYQ','finalize','image','/upload/','<hr\x20class=\x22my-3\x22>','maxPerUnit','all','find','random','</body></html>','aggregate','bay','Rack\x201','<html><head><title></title>','port','$product_details','$product_details.type','</div>','findOne','to_prod_level','Arabic\x20(ae)','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','$invoice','product','12lThzRB','prod_cat','note','Portuguese','back','$product_details._id','3521940ZXsKTr','push','toString','French','$product_details.maxPerUnit','/preview/:id'];a0_0x2147=function(){return _0x490422;};return a0_0x2147();}router[a0_0x5e18dd(0x255)](a0_0x5e18dd(0x1eb),auth,async(_0x4585c1,_0x4e4bee)=>{var _0x16c686=a0_0x5e18dd;try{const {username:_0x4a7e4e,email:_0x55a915,role:_0x261fb8}=_0x4585c1['user'],_0x5665e1=_0x4585c1[_0x16c686(0x211)],_0x53f5df=await profile[_0x16c686(0x1d2)]({'email':_0x5665e1[_0x16c686(0x1fc)]}),_0x269770=await master_shop[_0x16c686(0x1c7)](),_0x24c224=await transfers_finished[_0x16c686(0x1e5)](_0x4585c1[_0x16c686(0x19a)]['id']);let _0x826915=new Date(_0x24c224[_0x16c686(0x238)]),_0x2b8d16=('0'+_0x826915[_0x16c686(0x1fa)]())[_0x16c686(0x236)](-0x2),_0x510007=('0'+(_0x826915['getMonth']()+0x1))[_0x16c686(0x236)](-0x2),_0x15e43d=_0x826915['getFullYear'](),_0x1cca35=_0x15e43d+'-'+_0x510007+'-'+_0x2b8d16,_0x580285;if(_0x5665e1['role']==_0x16c686(0x207)){const _0x3fe31f=await staff[_0x16c686(0x1d2)]({'email':_0x5665e1[_0x16c686(0x1fc)]});_0x580285=await warehouse[_0x16c686(0x1c7)]({'status':_0x16c686(0x1f6),'name':_0x3fe31f['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0x580285=await warehouse['find']({'status':_0x16c686(0x1f6),'warehouse_category':_0x16c686(0x254)});const _0x5d8c29=await warehouse[_0x16c686(0x1ca)]([{'$match':{'name':_0x24c224[_0x16c686(0x21f)],'room':_0x24c224['from_room']}},{'$unwind':_0x16c686(0x1cf)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x16c686(0x1b2)},'product_stock':{'$first':_0x16c686(0x1a0)},'bay':{'$first':_0x16c686(0x1e4)},'bin':{'$first':_0x16c686(0x212)},'type':{'$first':_0x16c686(0x1d0)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x16c686(0x245)},'secondary_code':{'$first':_0x16c686(0x240)},'product_code':{'$first':_0x16c686(0x20e)},'storage':{'$first':_0x16c686(0x1a8)},'rack':{'$first':_0x16c686(0x24e)}}}]);var _0x1b35f6=[0x1,0x2,0x3,0x4],_0x1ffea3=['A','B','C','D','E','F','G','H','I','J'],_0x589e97=[_0x16c686(0x237),'Enclosed'];const _0x3b2553=await product[_0x16c686(0x1c7)]({}),_0x14c4c1=BayBinSelected(_0x24c224[_0x16c686(0x265)],_0x24c224[_0x16c686(0x267)]);if(_0x269770[0x0][_0x16c686(0x225)]==_0x16c686(0x206)){var _0x15a65b=users[_0x16c686(0x1f1)];console[_0x16c686(0x22a)](_0x15a65b);}else{if(_0x269770[0x0]['language']==_0x16c686(0x227))var _0x15a65b=users[_0x16c686(0x227)];else{if(_0x269770[0x0][_0x16c686(0x225)]==_0x16c686(0x215))var _0x15a65b=users['German'];else{if(_0x269770[0x0][_0x16c686(0x225)]==_0x16c686(0x22d))var _0x15a65b=users[_0x16c686(0x22d)];else{if(_0x269770[0x0][_0x16c686(0x225)]==_0x16c686(0x1e1))var _0x15a65b=users[_0x16c686(0x1e1)];else{if(_0x269770[0x0]['language']==_0x16c686(0x20b))var _0x15a65b=users['Portuguese'];else{if(_0x269770[0x0][_0x16c686(0x225)]==_0x16c686(0x1a9))var _0x15a65b=users['Chinese'];else{if(_0x269770[0x0][_0x16c686(0x225)]==_0x16c686(0x1d4))var _0x15a65b=users[_0x16c686(0x226)];}}}}}}}_0x4e4bee['render'](_0x16c686(0x200),{'success':_0x4585c1[_0x16c686(0x24d)]('success'),'errors':_0x4585c1[_0x16c686(0x24d)](_0x16c686(0x1fb)),'role':_0x5665e1,'profile':_0x53f5df,'master_shop':_0x269770,'warehouse':_0x580285,'transfer':_0x24c224,'stock':_0x5d8c29,'unit':_0x3b2553,'language':_0x15a65b,'levels':_0x1b35f6,'Isle':_0x1ffea3,'rooms_data':_0x589e97,'ed_fullDate':_0x1cca35,'dataSelected':_0x14c4c1});}catch(_0x309b60){console[_0x16c686(0x22a)](_0x309b60);}}),router[a0_0x5e18dd(0x261)]('/view/:id',auth,async(_0x2bc5a5,_0x3c88d0)=>{var _0xb62b28=a0_0x5e18dd;try{const _0xebc139=_0x2bc5a5['params']['id'];console[_0xb62b28(0x22a)](_0x2bc5a5[_0xb62b28(0x25f)]);const _0x3f7aad=await transfers_finished['findById'](_0xebc139);console[_0xb62b28(0x22a)]('transfer_data',_0x3f7aad);const {date:_0x491366,from_warehouse:_0x131be8,FromRoom_name:_0x3a3646,to_warehouse:_0x3342c0,ToRoom_name:_0x45e41f,prod_name:_0x25ac29,from_prod_qty:_0x1df91e,from_prod_level:_0xe939d0,from_prod_isle:_0x4cc050,from_prod_pallet:_0x197211,to_prod_qty:_0x15c1fd,to_prod_level:_0x16d364,to_prod_isle:_0x539fe7,to_prod_pallet:_0x4456a4,primary_code:_0x548700,secondary_code:_0x29b1ad,product_code3:_0x5f23b5,note:_0x53bcf0,invoice:_0x574dc0,expiry_date:_0x59d82d}=_0x2bc5a5['body'];if(typeof _0x25ac29==_0xb62b28(0x1ad))var _0x2d1130=[_0x2bc5a5[_0xb62b28(0x25f)]['prod_name']],_0x38d04d=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1f5)]],_0xe40e3=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1be)]],_0x3e41a3=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x223)]],_0x1f17e1=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1d3)]],_0x28258a=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1b5)]],_0x116ef7=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x199)]],_0x839517=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x232)]],_0x89324a=[_0x2bc5a5[_0xb62b28(0x25f)]['MaxStocks_data2']],_0x46e10f=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1ec)]],_0x516bb2=[_0x2bc5a5['body'][_0xb62b28(0x1bd)]],_0x247287=[_0x2bc5a5['body'][_0xb62b28(0x1b9)]],_0x19164c=[_0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x238)]];else var _0x2d1130=[..._0x2bc5a5['body'][_0xb62b28(0x1a2)]],_0x38d04d=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1f5)]],_0xe40e3=[..._0x2bc5a5[_0xb62b28(0x25f)]['from_prod_level']],_0x3e41a3=[..._0x2bc5a5['body']['to_prod_qty']],_0x1f17e1=[..._0x2bc5a5['body'][_0xb62b28(0x1d3)]],_0x28258a=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1b5)]],_0x116ef7=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x199)]],_0x839517=[..._0x2bc5a5['body'][_0xb62b28(0x232)]],_0x89324a=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x20f)]],_0x46e10f=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1ec)]],_0x516bb2=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1bd)]],_0x247287=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x1b9)]],_0x19164c=[..._0x2bc5a5[_0xb62b28(0x25f)][_0xb62b28(0x238)]];const _0x18f74a=_0x2d1130[_0xb62b28(0x1aa)](_0x460933=>{return _0x460933={'product_name':_0x460933};});_0x38d04d['forEach']((_0x1c3ffd,_0x3f206e)=>{_0x18f74a[_0x3f206e]['from_quantity']=_0x1c3ffd;}),_0xe40e3['forEach']((_0x2a4888,_0x3de647)=>{var _0xc94bb8=_0xb62b28;_0x18f74a[_0x3de647][_0xc94bb8(0x247)]=_0x2a4888;}),_0x3e41a3[_0xb62b28(0x248)]((_0x52f78a,_0x4d5a10)=>{_0x18f74a[_0x4d5a10]['to_quantity']=_0x52f78a;}),_0x1f17e1[_0xb62b28(0x248)]((_0x21bf27,_0x4e8b2e)=>{_0x18f74a[_0x4e8b2e]['to_bay']=_0x21bf27;}),_0x28258a['forEach']((_0x53a72a,_0x321157)=>{var _0x8b1f2c=_0xb62b28;_0x18f74a[_0x321157][_0x8b1f2c(0x1b5)]=_0x53a72a;}),_0x116ef7[_0xb62b28(0x248)]((_0x28d86a,_0x45c633)=>{var _0x42abf8=_0xb62b28;_0x18f74a[_0x45c633][_0x42abf8(0x199)]=_0x28d86a;}),_0x839517[_0xb62b28(0x248)]((_0x85cd7c,_0x58be3a)=>{var _0x17df5f=_0xb62b28;_0x18f74a[_0x58be3a][_0x17df5f(0x246)]=_0x85cd7c;}),_0x89324a['forEach']((_0xbca4c,_0x587dc4)=>{var _0x38469e=_0xb62b28;_0x18f74a[_0x587dc4][_0x38469e(0x20d)]=_0xbca4c;}),_0x46e10f[_0xb62b28(0x248)]((_0x35bdc6,_0x207b68)=>{_0x18f74a[_0x207b68]['unit']=_0x35bdc6;}),_0x516bb2[_0xb62b28(0x248)]((_0x39ee5d,_0x32b0b3)=>{var _0x316e8e=_0xb62b28;_0x18f74a[_0x32b0b3][_0x316e8e(0x1bd)]=_0x39ee5d;}),_0x247287[_0xb62b28(0x248)]((_0x15fd4d,_0x33d294)=>{var _0xad4fdc=_0xb62b28;_0x18f74a[_0x33d294][_0xad4fdc(0x1b9)]=_0x15fd4d;}),_0x19164c[_0xb62b28(0x248)]((_0x3bdf29,_0x60af99)=>{_0x18f74a[_0x60af99]['expiry_date']=_0x3bdf29;});const _0x155cf7=_0x18f74a[_0xb62b28(0x228)](_0x3459e0=>_0x3459e0[_0xb62b28(0x25b)]!=='0'&&_0x3459e0[_0xb62b28(0x25b)]!==''||_0x3459e0[_0xb62b28(0x1ff)]!=='0'&&_0x3459e0['to_floorlevel']!=='');var _0x146d4f=0x0;_0x155cf7['forEach'](_0xbece1c=>{var _0x55abd0=_0xb62b28;parseInt(_0xbece1c[_0x55abd0(0x23d)])<parseInt(_0xbece1c['to_quantity'])&&_0x146d4f++;});if(_0x146d4f!=0x0)return _0x2bc5a5[_0xb62b28(0x24d)]('errors','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3c88d0[_0xb62b28(0x244)]('back');const _0x4f2c03=await warehouse[_0xb62b28(0x1d2)]({'name':_0x3f7aad[_0xb62b28(0x21f)],'room':_0x3f7aad[_0xb62b28(0x241)]});_0x3f7aad[_0xb62b28(0x1d7)][_0xb62b28(0x248)](_0x1da06f=>{var _0x8a6e0c=_0xb62b28;if(_0x1da06f['to_quantity']>0x0){const _0xdb86c2=_0x4f2c03['product_details'][_0x8a6e0c(0x1aa)](_0x168333=>{var _0x200dca=_0x8a6e0c;_0x168333['product_name']==_0x1da06f[_0x200dca(0x1f7)]&&_0x168333[_0x200dca(0x1cb)]==_0x1da06f[_0x200dca(0x247)]&&(_0x168333[_0x200dca(0x208)]=parseInt(_0x168333[_0x200dca(0x208)])+parseInt(_0x1da06f[_0x200dca(0x25b)]));});}}),await _0x4f2c03[_0xb62b28(0x219)]();const _0x2f8462=await warehouse[_0xb62b28(0x1d2)]({'name':_0x3f7aad[_0xb62b28(0x265)],'room':_0x3f7aad[_0xb62b28(0x267)]});_0x3f7aad[_0xb62b28(0x1d7)][_0xb62b28(0x248)](_0x200adc=>{var _0x44bc57=_0xb62b28;if(_0x200adc['to_quantity']>0x0){const _0x168e13=_0x2f8462[_0x44bc57(0x1ed)][_0x44bc57(0x1aa)](_0x1e0c17=>{var _0x4c8c2a=_0x44bc57;_0x1e0c17['product_name']==_0x200adc[_0x4c8c2a(0x1f7)]&&_0x1e0c17[_0x4c8c2a(0x1cb)]==_0x200adc[_0x4c8c2a(0x216)]&&(_0x1e0c17[_0x4c8c2a(0x208)]=parseInt(_0x1e0c17[_0x4c8c2a(0x208)])-parseInt(_0x200adc[_0x4c8c2a(0x25b)]));});}}),await _0x2f8462[_0xb62b28(0x219)](),_0x3f7aad[_0xb62b28(0x19c)]=_0x491366,_0x3f7aad['from_warehouse']=_0x131be8,_0x3f7aad['to_warehouse']=_0x3342c0,_0x3f7aad[_0xb62b28(0x1d7)]=_0x155cf7,_0x3f7aad[_0xb62b28(0x1da)]=_0x53bcf0,_0x3f7aad[_0xb62b28(0x1b6)]=_0x574dc0;const _0x1ee03f=await _0x3f7aad[_0xb62b28(0x219)](),_0x2509e3=await warehouse['findOne']({'name':_0x131be8,'room':_0x3a3646});_0x1ee03f[_0xb62b28(0x1d7)][_0xb62b28(0x248)](_0x148f5b=>{var _0x592ab5=_0xb62b28;if(_0x148f5b[_0x592ab5(0x25b)]>0x0){const _0x23505e=_0x2509e3['product_details']['map'](_0xe6fffc=>{var _0x2c872f=_0x592ab5;_0xe6fffc[_0x2c872f(0x1f7)]==_0x148f5b[_0x2c872f(0x1f7)]&&_0xe6fffc['bay']==_0x148f5b[_0x2c872f(0x247)]&&(_0xe6fffc[_0x2c872f(0x208)]=parseInt(_0xe6fffc[_0x2c872f(0x208)])-parseInt(_0x148f5b[_0x2c872f(0x25b)]));});}}),await _0x2509e3[_0xb62b28(0x219)]();const _0x1ed525=await warehouse['findOne']({'name':_0x3342c0,'room':_0x45e41f});_0x1ee03f[_0xb62b28(0x1d7)][_0xb62b28(0x248)](_0x53f43a=>{var _0x590653=_0xb62b28;if(_0x53f43a['to_quantity']>0x0){var _0xc155fa=0x0;const _0xc55e4d=_0x1ed525[_0x590653(0x1ed)][_0x590653(0x1aa)](_0x332710=>{var _0x2036e3=_0x590653;_0x332710[_0x2036e3(0x1f7)]==_0x53f43a[_0x2036e3(0x1f7)]&&_0x332710['bay']==_0x53f43a[_0x2036e3(0x216)]&&(_0x332710[_0x2036e3(0x208)]=parseInt(_0x332710[_0x2036e3(0x208)])+parseInt(_0x53f43a['to_quantity']),_0xc155fa++);});_0xc155fa=='0'&&(_0x1ed525['product_details']=_0x1ed525[_0x590653(0x1ed)]['concat']({'product_name':_0x53f43a[_0x590653(0x1f7)],'product_stock':_0x53f43a[_0x590653(0x25b)],'bay':_0x53f43a['to_bay'],'product_code':_0x53f43a['product_code'],'primary_code':_0x53f43a['primary_code'],'secondary_code':_0x53f43a['secondary_code'],'maxProducts':_0x53f43a[_0x590653(0x20d)]}));}}),await _0x1ed525['save'](),_0x2bc5a5[_0xb62b28(0x24d)]('success','Transfer\x20Edit\x20Successfully'),_0x3c88d0[_0xb62b28(0x244)]('/transfer_finished/view');}catch(_0x6ee976){console[_0xb62b28(0x22a)](_0x6ee976);}}),router[a0_0x5e18dd(0x261)]('/barcode_scanner',async(_0x1ff7b9,_0x3bd1b3)=>{var _0x1b63bc=a0_0x5e18dd;const {FromWareHouse:_0x3be7fd,FromRoom:_0x8fdfb8,ToWarehouse:_0x349aa1,ToRoom:_0x38dc8a,primary_code:_0x24f160,Roomslist:_0x41524f}=_0x1ff7b9[_0x1b63bc(0x25f)],_0x2cfb20=_0x41524f['split'](','),_0x371794=[];async function _0x4407ca(_0x196aef){var _0x4edb7a=_0x1b63bc;const _0x30018c=await warehouse['aggregate']([{'$match':{'name':_0x3be7fd,'room':_0x196aef}},{'$unwind':_0x4edb7a(0x1cf)},{'$match':{'product_details.primary_code':_0x24f160}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4edb7a(0x1b2)},'instock':{'$first':_0x4edb7a(0x1a0)},'primary_code':{'$first':_0x4edb7a(0x245)},'secondary_code':{'$first':_0x4edb7a(0x240)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4edb7a(0x1d0)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4edb7a(0x21e)},'secondary_unit':{'$first':_0x4edb7a(0x1b0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4edb7a(0x24e)},'expiry_date':{'$first':_0x4edb7a(0x22c)},'production_date':{'$first':_0x4edb7a(0x262)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x4edb7a(0x1e2)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x4edb7a(0x1b8)}}}]),_0x29a258=await warehouse[_0x4edb7a(0x1ca)]([{'$match':{'name':_0x3be7fd,'room':_0x196aef}},{'$unwind':_0x4edb7a(0x1cf)},{'$match':{'product_details.secondary_code':_0x24f160}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4edb7a(0x1b2)},'instock':{'$first':_0x4edb7a(0x1a0)},'primary_code':{'$first':_0x4edb7a(0x245)},'secondary_code':{'$first':_0x4edb7a(0x240)},'product_code':{'$first':_0x4edb7a(0x20e)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4edb7a(0x212)},'type':{'$first':_0x4edb7a(0x1d0)},'pallet':{'$first':_0x4edb7a(0x204)},'unit':{'$first':_0x4edb7a(0x21e)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4edb7a(0x24e)},'expiry_date':{'$first':_0x4edb7a(0x22c)},'production_date':{'$first':_0x4edb7a(0x262)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x4edb7a(0x1e2)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x30018c[_0x4edb7a(0x196)]>0x0)_0x371794[_0x4edb7a(0x1df)](_0x30018c);else _0x29a258[_0x4edb7a(0x196)]>0x0&&_0x371794[_0x4edb7a(0x1df)](_0x29a258);}const _0x356651=_0x2cfb20[_0x1b63bc(0x1aa)](_0xbc3443=>_0x4407ca(_0xbc3443));await Promise[_0x1b63bc(0x1c6)](_0x356651),_0x3bd1b3[_0x1b63bc(0x25e)](_0x371794);}),router['post']('/barcode_scanner2',async(_0x58cfce,_0x58fb00)=>{var _0x402675=a0_0x5e18dd;try{const {FromWareHouse:_0x47be35,FromRoom:_0x1524a9,ToWarehouse:_0x178605,ToRoom:_0x3911b7,secondary_code:_0x1b15ad}=_0x58cfce[_0x402675(0x25f)],_0x51db91=await warehouse[_0x402675(0x1ca)]([{'$match':{'name':_0x47be35}},{'$unwind':_0x402675(0x1cf)},{'$match':{'product_details.secondary_code':_0x1b15ad}},{'$group':{'_id':_0x402675(0x1dd),'name':{'$first':_0x402675(0x1b2)},'primary_code':{'$first':_0x402675(0x245)},'secondary_code':{'$first':_0x402675(0x240)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x402675(0x1a0)},'warehouse':{'$first':_0x402675(0x1a6)},'level':{'$first':_0x402675(0x24a)},'isle':{'$first':_0x402675(0x1e6)},'pallet':{'$first':_0x402675(0x1f8)},'maxProducts':{'$first':_0x402675(0x1bf)},'unit':{'$first':'$product_details.unit'},'expiry_date':{'$first':_0x402675(0x22c)},'production_date':{'$first':_0x402675(0x262)}}}]);_0x58fb00[_0x402675(0x220)](0xc8)[_0x402675(0x25e)](_0x51db91);}catch(_0x311c1f){_0x58fb00['status'](0x194)[_0x402675(0x25e)]({'message':_0x311c1f[_0x402675(0x203)]});}}),router[a0_0x5e18dd(0x261)](a0_0x5e18dd(0x258),async(_0x3c92ff,_0x6e14c1)=>{var _0x1360ed=a0_0x5e18dd;try{const {FromWareHouse:_0x8fa17f,FromRoom:_0x217c12,ToWarehouse:_0x31a082,ToRoom:_0x509d6f,product_code:_0x57b9f}=_0x3c92ff[_0x1360ed(0x25f)],_0xc50ec2=await warehouse[_0x1360ed(0x1ca)]([{'$match':{'name':_0x8fa17f}},{'$unwind':_0x1360ed(0x1cf)},{'$match':{'product_details.product_code':_0x57b9f}},{'$group':{'_id':_0x1360ed(0x1dd),'name':{'$first':_0x1360ed(0x1b2)},'primary_code':{'$first':_0x1360ed(0x245)},'secondary_code':{'$first':_0x1360ed(0x240)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x1360ed(0x1a0)},'warehouse':{'$first':_0x1360ed(0x1a6)},'level':{'$first':_0x1360ed(0x24a)},'isle':{'$first':_0x1360ed(0x1e6)},'pallet':{'$first':_0x1360ed(0x1f8)},'maxProducts':{'$first':_0x1360ed(0x1bf)},'unit':{'$first':'$product_details.unit'}}}]);_0x6e14c1['status'](0xc8)['json'](_0xc50ec2);}catch(_0x5d044a){_0x6e14c1[_0x1360ed(0x220)](0x194)[_0x1360ed(0x25e)]({'message':_0x5d044a[_0x1360ed(0x203)]});}}),router[a0_0x5e18dd(0x261)](a0_0x5e18dd(0x249),async(_0x565f2c,_0x51ae10)=>{var _0x3d700d=a0_0x5e18dd;const {productCode:_0x1cd75a,bay:_0x1d3f9b,warehouses:_0x51c6d5,room:_0x1eddb8}=_0x565f2c['body'];console[_0x3d700d(0x22a)](_0x565f2c[_0x3d700d(0x25f)]);try{const _0x2a1372=await warehouse[_0x3d700d(0x1ca)]([{'$match':{'name':_0x51c6d5,'room':_0x1eddb8}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x1d3f9b)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3d700d(0x1b2)},'product_stock':{'$first':_0x3d700d(0x1a0)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x3d700d(0x1bf)}}}]);_0x51ae10[_0x3d700d(0x220)](0xc8)['json'](_0x2a1372);}catch(_0x54c221){_0x51ae10[_0x3d700d(0x220)](0x194)[_0x3d700d(0x25e)]({'message':_0x54c221[_0x3d700d(0x203)]});}}),module['exports']=router;