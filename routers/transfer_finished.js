var a0_0xec633e=a0_0x24b5;function a0_0x2722(){var _0x3f8b79=['to_room_name','$product_details.bay','../models/all_models','<hr\x20class=\x22my-3\x22>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','params','ToRoomAssigned','DRY\x20GOODS','findById','\x20Order\x20Date\x20:\x20','role','to_invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','to_bay','246IJrjnn','\x20Order\x20Number\x20:\x20','log','from_quantity','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<h5>','email','5626115CNaJrP','$to_warehouse','createTransport','4874Lrkutv','$product_details.secondary_unit','Arabic','from_bay','$product_details.maxProducts','An\x20error\x20occurred.','/picking_list/PDF_transfer/','Finished\x20Goods','from_invoice','$product_details.production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','errors','$product.to_room_name','$product_details.unit','</td>','/transfer_finished/view','user','<tr>','Enabled','<html><head><title></title>','$name','Logo.png','Product\x20Transfer\x20successfully','product_name','$product_details.product_stock','prod_cat','$product.from_room_name','<h5\x20style=\x22text-align:\x20left;\x22>','MaxStocks_data','bay','forEach','from_prod_level','Hindi','product_date','status','/preview/:id','../middleware/auth','$product_details.storage','$product_details.maxPerUnit','Arabic\x20(ae)','<!DOCTYPE\x20html>','finalize','$product_details.type','from_room','to_room','warehouse','prod_name','toString','sendMail','transfer_data','An\x20error\x20occurred\x20while\x20saving\x20data.','concat','image','language','_id','$product_details.expiry_date','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','find','staff','from_room_name','True','primary_unit','get','Router','4236408sBRwjN','from_warehouse','add_transfer_finished','to_prod_qty','host','</thead>','Portuguese\x20(BR)','$room','site_title','/barcode_scanner2','$product_details.primary_code','$product_details.pallet','to_warehouse','to_prod_level','logo','unit','English\x20(US)','/transfer/view','$product_details.isle','MaxStocks_data2','New_Qty_Converted','293278hJITwA','transfer_finished','product_details','Chinese','$product_details.product_code','$product_details.invoice','Spanish','batch_code','$product_details.floorlevel','to_floorlevel','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','English','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</h5>','/../public','string','back','flash','product_stock','$product_details','length','Rack\x201','385tGTHpc','success','QA\x20Warehouse','</span>','to_quantity','212604QTdTpx','$product_details.product_name','message','getFullYear','json','aggregate','maxProducts','French','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','getMonth','5vRWhtM','To_invoice','split','then','maxPerUnit','password','product','10HqxjGN','/view/add_transfer','$_id','$product_details.bin','$invoice','61480XDsEWV','RoomAssigned','Ambient','slice','/view','/barcode_scanner3','/view/:id','$product_details.secondary_code','</head><body>','$product_details.rack','TRFF-','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<strong>\x20Regards\x20</strong>','date','<tbody\x20style=\x22text-align:\x20center;\x22>','from_prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','catch','body','Portuguese','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','expiry_date','Enclosed','invoice','secondary_code','nodemailer','note','German','FGSEmail','primary_code','$product_details.batch_code','redirect','<h2>\x20','16360OELvBk','Transfer\x20Edit\x20Successfully','</div>','all','product_code','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','findOne','error','updateOne','/CheckingWarehouse','port','push','map','Rack\x202','secondary_unit','/barcode_scanner','<span\x20style=\x22float:\x20right;\x22>','exports','$product','product_code3','</tr>','$finalize','<div>','render','filter','There\x27s\x20a\x20error\x20in\x20this\x20transaction','production_date'];a0_0x2722=function(){return _0x3f8b79;};return a0_0x2722();}(function(_0x5c32b6,_0x2363ad){var _0x5a7aac=a0_0x24b5,_0x159a78=_0x5c32b6();while(!![]){try{var _0xc43d4c=-parseInt(_0x5a7aac(0x115))/0x1+-parseInt(_0x5a7aac(0x19e))/0x2*(-parseInt(_0x5a7aac(0x194))/0x3)+parseInt(_0x5a7aac(0x168))/0x4+parseInt(_0x5a7aac(0x13b))/0x5*(parseInt(_0x5a7aac(0x131))/0x6)+parseInt(_0x5a7aac(0x12c))/0x7*(parseInt(_0x5a7aac(0x147))/0x8)+parseInt(_0x5a7aac(0x100))/0x9*(-parseInt(_0x5a7aac(0x142))/0xa)+parseInt(_0x5a7aac(0x19b))/0xb;if(_0xc43d4c===_0x2363ad)break;else _0x159a78['push'](_0x159a78['shift']());}catch(_0x3297fe){_0x159a78['push'](_0x159a78['shift']());}}}(a0_0x2722,0x63fa4));const express=require('express'),app=express(),router=express[a0_0xec633e(0xff)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0xec633e(0x186)),auth=require(a0_0xec633e(0xe3)),users=require('../public/language/languages.json'),nodemailer=require(a0_0xec633e(0x160));router[a0_0xec633e(0xfe)](a0_0xec633e(0x14b),auth,async(_0x581d7b,_0xdfc40b)=>{var _0x40af27=a0_0xec633e;try{const {username:_0x2da830,email:_0x20fcbf,role:_0x4f7f49}=_0x581d7b[_0x40af27(0xcf)],_0x43a8cf=_0x581d7b[_0x40af27(0xcf)],_0x541672=await profile[_0x40af27(0x16f)]({'email':_0x43a8cf[_0x40af27(0x19a)]}),_0xc2b41a=await master_shop['find']();let _0x5b0832;if(_0x43a8cf[_0x40af27(0x18e)]==_0x40af27(0xfa)){const _0x1f50e8=await staff[_0x40af27(0x16f)]({'email':_0x43a8cf['email']});_0x5b0832=await transfers_finished[_0x40af27(0xf9)]({'from_warehouse':_0x1f50e8['warehouse']});}else _0x5b0832=await transfers_finished[_0x40af27(0x136)]([{'$unwind':_0x40af27(0x17b)},{'$group':{'_id':_0x40af27(0x144),'invoice':{'$first':_0x40af27(0x146)},'date':{'$first':'$date'},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x40af27(0x19c)},'from_room_name':{'$addToSet':_0x40af27(0xd9)},'to_room_name':{'$addToSet':_0x40af27(0xcb)},'finalize':{'$first':_0x40af27(0x17e)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0xc2b41a[0x0][_0x40af27(0xf4)]==_0x40af27(0x110))var _0x1cd824=users['English'];else{if(_0xc2b41a[0x0][_0x40af27(0xf4)]==_0x40af27(0xdf))var _0x1cd824=users[_0x40af27(0xdf)];else{if(_0xc2b41a[0x0]['language']==_0x40af27(0x162))var _0x1cd824=users[_0x40af27(0x162)];else{if(_0xc2b41a[0x0]['language']==_0x40af27(0x11b))var _0x1cd824=users[_0x40af27(0x11b)];else{if(_0xc2b41a[0x0][_0x40af27(0xf4)]==_0x40af27(0x138))var _0x1cd824=users[_0x40af27(0x138)];else{if(_0xc2b41a[0x0][_0x40af27(0xf4)]==_0x40af27(0x106))var _0x1cd824=users[_0x40af27(0x15a)];else{if(_0xc2b41a[0x0][_0x40af27(0xf4)]==_0x40af27(0x118))var _0x1cd824=users['Chinese'];else{if(_0xc2b41a[0x0][_0x40af27(0xf4)]==_0x40af27(0xe6))var _0x1cd824=users[_0x40af27(0x1a0)];}}}}}}}_0xdfc40b[_0x40af27(0x180)](_0x40af27(0x116),{'success':_0x581d7b[_0x40af27(0x127)]('success'),'errors':_0x581d7b[_0x40af27(0x127)]('errors'),'role':_0x43a8cf,'profile':_0x541672,'master_shop':_0xc2b41a,'transfer':_0x5b0832,'language':_0x1cd824});}catch(_0x2efcf1){console[_0x40af27(0x196)](_0x2efcf1);}});function a0_0x24b5(_0x25491b,_0x4ac56f){var _0x2722f2=a0_0x2722();return a0_0x24b5=function(_0x24b524,_0x3414d8){_0x24b524=_0x24b524-0xcb;var _0x531af9=_0x2722f2[_0x24b524];return _0x531af9;},a0_0x24b5(_0x25491b,_0x4ac56f);}async function getRandom8DigitNumber(){var _0x2ff8e3=a0_0xec633e;const _0x2eaf29=0x989680,_0x5d6629=0x5f5e0ff,_0xd31394=Math['floor'](Math['random']()*(_0x5d6629-_0x2eaf29+0x1))+_0x2eaf29;var _0x10ebf6;const _0x40497c=await transfers_finished[_0x2ff8e3(0x16f)]({'invoice':_0x2ff8e3(0x151)+_0xd31394});return _0x40497c&&_0x40497c[_0x2ff8e3(0x12a)]>0x0?_0x10ebf6=_0x2ff8e3(0x151)+_0xd31394:_0x10ebf6='TRFF-'+_0xd31394,_0x10ebf6;}router[a0_0xec633e(0xfe)](a0_0xec633e(0x143),auth,async(_0x430e94,_0x6c7ade)=>{var _0x48a09f=a0_0xec633e;try{const {username:_0x55b5d2,email:_0xde5c7f,role:_0x37fe7b}=_0x430e94['user'],_0x5d0316=_0x430e94[_0x48a09f(0xcf)],_0x288c46=await profile[_0x48a09f(0x16f)]({'email':_0x5d0316[_0x48a09f(0x19a)]}),_0x13d1c8=await master_shop[_0x48a09f(0xf9)]();let _0x337728;if(_0x5d0316[_0x48a09f(0x18e)]==_0x48a09f(0xfa)){const _0x4055a6=await staff[_0x48a09f(0x16f)]({'email':_0x5d0316[_0x48a09f(0x19a)]});_0x337728=await warehouse[_0x48a09f(0x136)]([{'$match':{'status':'Enabled','name':_0x4055a6['warehouse'],'warehouse_category':_0x48a09f(0x1a5),'name':{'$ne':_0x48a09f(0x12e)}}},{'$group':{'_id':'$name','name':{'$first':_0x48a09f(0xd3)}}}]);}else _0x337728=await warehouse[_0x48a09f(0x136)]([{'$match':{'status':_0x48a09f(0xd1),'warehouse_category':_0x48a09f(0x1a5),'name':{'$ne':_0x48a09f(0x12e)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x31d2f8=await transfers_finished[_0x48a09f(0xf9)]({}),_0x380372=_0x31d2f8['length']+0x1,_0x287469='TRFF-'+_0x380372[_0x48a09f(0xee)]()['padStart'](0x5,'0');if(_0x13d1c8[0x0]['language']==_0x48a09f(0x110))var _0x81f34=users[_0x48a09f(0x121)];else{if(_0x13d1c8[0x0][_0x48a09f(0xf4)]=='Hindi')var _0x81f34=users[_0x48a09f(0xdf)];else{if(_0x13d1c8[0x0]['language']==_0x48a09f(0x162))var _0x81f34=users['German'];else{if(_0x13d1c8[0x0][_0x48a09f(0xf4)]==_0x48a09f(0x11b))var _0x81f34=users['Spanish'];else{if(_0x13d1c8[0x0][_0x48a09f(0xf4)]==_0x48a09f(0x138))var _0x81f34=users[_0x48a09f(0x138)];else{if(_0x13d1c8[0x0]['language']==_0x48a09f(0x106))var _0x81f34=users[_0x48a09f(0x15a)];else{if(_0x13d1c8[0x0][_0x48a09f(0xf4)]==_0x48a09f(0x118))var _0x81f34=users[_0x48a09f(0x118)];else{if(_0x13d1c8[0x0]['language']==_0x48a09f(0xe6))var _0x81f34=users[_0x48a09f(0x1a0)];}}}}}}}const _0x30d694=getRandom8DigitNumber();_0x30d694[_0x48a09f(0x13e)](_0x2d01f0=>{var _0x581a76=_0x48a09f;_0x6c7ade[_0x581a76(0x180)](_0x581a76(0x102),{'success':_0x430e94['flash'](_0x581a76(0x12d)),'errors':_0x430e94['flash'](_0x581a76(0x1a9)),'role':_0x5d0316,'profile':_0x288c46,'master_shop':_0x13d1c8,'warehouse':_0x337728,'language':_0x81f34,'invoice':_0x2d01f0});})[_0x48a09f(0x158)](_0x53b871=>{var _0x309295=_0x48a09f;_0x430e94[_0x309295(0x127)]('errors',_0x309295(0x182)),_0x6c7ade[_0x309295(0x166)](_0x309295(0x111));});}catch(_0x34a8b8){console[_0x48a09f(0x196)](_0x34a8b8);}}),router[a0_0xec633e(0x11f)](a0_0xec633e(0x143),auth,async(_0x5b0e9d,_0xc29da4)=>{var _0x2c05b6=a0_0xec633e;try{const {date:_0x2c1390,from_warehouse:_0x42daf8,FromRoom_name:_0x313bf9,to_warehouse:_0x4d0f33,ToRoom_name:_0x310b61,prod_name:_0x3cd4f0,from_prod_qty:_0x35dea8,from_prod_level:_0x5960b1,from_prod_isle:_0x450125,from_prod_pallet:_0x49a02a,to_prod_qty:_0x3453a5,to_prod_level:_0x4b6313,to_prod_isle:_0x3a4d4c,to_prod_pallet:_0x3fbcef,primary_code:_0xb656e6,secondary_code:_0x18175d,product_code3:_0x490929,note:_0x446045,MaxStocks_data2:_0x5a21bc,invoice:_0x3d9e71,expiry_date:_0xbf0763}=_0x5b0e9d[_0x2c05b6(0x159)];if(typeof _0x3cd4f0==_0x2c05b6(0x125))var _0x5dbba3=[_0x5b0e9d[_0x2c05b6(0x159)]['prod_name']],_0x3fdb7f=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x156)]],_0x252f14=[_0x5b0e9d[_0x2c05b6(0x159)]['from_prod_level']],_0xdac83c=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x114)]],_0x5c85da=[_0x5b0e9d[_0x2c05b6(0x159)]['to_prod_level']],_0x4200af=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x164)]],_0x7a63d1=[_0x5b0e9d[_0x2c05b6(0x159)]['secondary_code']],_0x2f4c66=[_0x5b0e9d[_0x2c05b6(0x159)]['product_code3']],_0x25a1ed=[_0x5b0e9d['body'][_0x2c05b6(0x113)]],_0xe2a56b=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xfd)]],_0x3fd1db=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x177)]],_0x428764=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x11c)]],_0xf3e25=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x15c)]],_0x3cb2b4=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xe0)]],_0x47407a=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xdb)]],_0xcffd6=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x13f)]],_0x44fdd5=[_0x5b0e9d[_0x2c05b6(0x159)]['prod_cat']],_0x399667=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x148)]],_0xa6e7ef=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x18a)]],_0xdf947b=[_0x5b0e9d['body'][_0x2c05b6(0x1a6)]],_0x14dd27=[_0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x18f)]];else var _0x5dbba3=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xed)]],_0x3fdb7f=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x156)]],_0x252f14=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xde)]],_0xdac83c=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x114)]],_0x5c85da=[..._0x5b0e9d['body'][_0x2c05b6(0x10d)]],_0x4200af=[..._0x5b0e9d['body'][_0x2c05b6(0x164)]],_0x7a63d1=[..._0x5b0e9d[_0x2c05b6(0x159)]['secondary_code']],_0x2f4c66=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x17c)]],_0x25a1ed=[..._0x5b0e9d['body'][_0x2c05b6(0x113)]],_0xe2a56b=[..._0x5b0e9d['body'][_0x2c05b6(0xfd)]],_0x3fd1db=[..._0x5b0e9d['body'][_0x2c05b6(0x177)]],_0x428764=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x11c)]],_0xf3e25=[..._0x5b0e9d['body']['expiry_date']],_0x3cb2b4=[..._0x5b0e9d['body'][_0x2c05b6(0xe0)]],_0x47407a=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xdb)]],_0xcffd6=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x13f)]],_0x44fdd5=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0xd8)]],_0x399667=[..._0x5b0e9d['body']['RoomAssigned']],_0xa6e7ef=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x18a)]],_0xdf947b=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x1a6)]],_0x14dd27=[..._0x5b0e9d[_0x2c05b6(0x159)][_0x2c05b6(0x18f)]];const _0x257993=_0x5dbba3[_0x2c05b6(0x175)](_0x336cff=>{return _0x336cff={'product_name':_0x336cff};});_0x3fdb7f[_0x2c05b6(0xdd)]((_0x2a9c18,_0x57d66f)=>{_0x257993[_0x57d66f]['from_quantity']=_0x2a9c18;}),_0x252f14['forEach']((_0x203475,_0x16c249)=>{var _0x1f2f5e=_0x2c05b6;_0x257993[_0x16c249][_0x1f2f5e(0x1a1)]=_0x203475;}),_0xdf947b[_0x2c05b6(0xdd)]((_0x200380,_0x34a81b)=>{var _0x48e63a=_0x2c05b6;_0x257993[_0x34a81b][_0x48e63a(0x1a6)]=_0x200380;}),_0x14dd27[_0x2c05b6(0xdd)]((_0x286417,_0x4fdf0d)=>{var _0x44b192=_0x2c05b6;_0x257993[_0x4fdf0d][_0x44b192(0x13c)]=_0x286417;}),_0xdac83c[_0x2c05b6(0xdd)]((_0x253ea2,_0x5b9865)=>{_0x257993[_0x5b9865]['to_quantity']=_0x253ea2;}),_0x5c85da['forEach']((_0x2c31bc,_0x1b7edd)=>{var _0x523e4e=_0x2c05b6;_0x257993[_0x1b7edd][_0x523e4e(0x193)]=_0x2c31bc;}),_0x4200af[_0x2c05b6(0xdd)]((_0x1bb3bb,_0x516333)=>{_0x257993[_0x516333]['primary_code']=_0x1bb3bb;}),_0x7a63d1['forEach']((_0x5b0d7f,_0x1f52d4)=>{var _0x72d0f4=_0x2c05b6;_0x257993[_0x1f52d4][_0x72d0f4(0x15f)]=_0x5b0d7f;}),_0x2f4c66[_0x2c05b6(0xdd)]((_0x20b684,_0x2b6d4a)=>{var _0x2fcc2f=_0x2c05b6;_0x257993[_0x2b6d4a][_0x2fcc2f(0x16c)]=_0x20b684;}),_0x25a1ed[_0x2c05b6(0xdd)]((_0x368e8c,_0x2abdd5)=>{var _0xf812fe=_0x2c05b6;_0x257993[_0x2abdd5][_0xf812fe(0x137)]=_0x368e8c;}),_0xe2a56b[_0x2c05b6(0xdd)]((_0x1a1385,_0x3a13d3)=>{var _0x6e502b=_0x2c05b6;_0x257993[_0x3a13d3][_0x6e502b(0x10f)]=_0x1a1385;}),_0x3fd1db[_0x2c05b6(0xdd)]((_0x1eae30,_0x9a044d)=>{var _0x1bbc0f=_0x2c05b6;_0x257993[_0x9a044d][_0x1bbc0f(0x177)]=_0x1eae30;}),_0x428764[_0x2c05b6(0xdd)]((_0x2138f6,_0x376721)=>{var _0x4fdf7b=_0x2c05b6;_0x257993[_0x376721][_0x4fdf7b(0x11c)]=_0x2138f6;}),_0xf3e25[_0x2c05b6(0xdd)]((_0xcb7ad8,_0x38b476)=>{_0x257993[_0x38b476]['expiry_date']=_0xcb7ad8;}),_0x3cb2b4['forEach']((_0x1bbdd7,_0x5ae3cc)=>{_0x257993[_0x5ae3cc]['production_date']=_0x1bbdd7;}),_0x47407a[_0x2c05b6(0xdd)]((_0x4da36f,_0x4ab5cb)=>{_0x257993[_0x4ab5cb]['maxProducts']=_0x4da36f;}),_0xcffd6[_0x2c05b6(0xdd)]((_0x29047f,_0x46ab2f)=>{var _0x559193=_0x2c05b6;_0x257993[_0x46ab2f][_0x559193(0x13f)]=_0x29047f;}),_0x44fdd5[_0x2c05b6(0xdd)]((_0x5e866f,_0x2926f6)=>{var _0x9c85b4=_0x2c05b6;_0x257993[_0x2926f6][_0x9c85b4(0xd8)]=_0x5e866f;}),_0x399667[_0x2c05b6(0xdd)]((_0x148bae,_0x17dab4)=>{_0x257993[_0x17dab4]['from_room_name']=_0x148bae;}),_0xa6e7ef[_0x2c05b6(0xdd)]((_0x4fc33a,_0x2b9546)=>{_0x257993[_0x2b9546]['to_room_name']=_0x4fc33a;});const _0x520c18=_0x257993[_0x2c05b6(0x181)](_0x4f7f93=>_0x4f7f93[_0x2c05b6(0x130)]!=='0'&&_0x4f7f93[_0x2c05b6(0x130)]!==''||_0x4f7f93['to_floorlevel']!=='0'&&_0x4f7f93['to_floorlevel']!=='');var _0x18a76b=0x0;_0x520c18[_0x2c05b6(0xdd)](_0x1528f6=>{var _0x889009=_0x2c05b6;parseInt(_0x1528f6['from_quantity'])<parseInt(_0x1528f6[_0x889009(0x130)])&&_0x18a76b++;});if(_0x18a76b!=0x0)return _0x5b0e9d[_0x2c05b6(0x127)]('errors',_0x2c05b6(0x188)),_0xc29da4[_0x2c05b6(0x166)](_0x2c05b6(0x126));const _0xfb6d7d=new transfers_finished({'date':_0x2c1390,'from_warehouse':_0x42daf8,'to_warehouse':_0x4d0f33,'product':_0x520c18,'note':_0x446045,'invoice':_0x3d9e71}),_0x3c0fb2=await _0xfb6d7d[_0x2c05b6(0xf7)]();_0x5b0e9d[_0x2c05b6(0x127)](_0x2c05b6(0x12d),_0x2c05b6(0xd5)),_0xc29da4[_0x2c05b6(0x166)]('/transfer_finished/preview/'+_0x3c0fb2['_id']);}catch(_0x3470b6){console['log'](_0x3470b6),_0xc29da4[_0x2c05b6(0xe1)](0xc8)[_0x2c05b6(0x135)]({'errorMessage':_0x3470b6['message']});}}),router[a0_0xec633e(0xfe)](a0_0xec633e(0xe2),auth,async(_0x25bfd7,_0x10f426)=>{var _0x41247c=a0_0xec633e;try{const {username:_0x1cf944,email:_0x5d1685,role:_0x5edc80}=_0x25bfd7['user'],_0xfeb03c=_0x25bfd7[_0x41247c(0xcf)],_0x16650d=await profile[_0x41247c(0x16f)]({'email':_0xfeb03c['email']}),_0x1bfcb1=await master_shop[_0x41247c(0xf9)](),_0x4b0189=await transfers_finished[_0x41247c(0x18c)](_0x25bfd7[_0x41247c(0x189)]['id']);let _0x4d9d1e;if(_0xfeb03c['role']==_0x41247c(0xfa)){const _0x19bc38=await staff[_0x41247c(0x16f)]({'email':_0xfeb03c['email']});_0x4d9d1e=await warehouse[_0x41247c(0xf9)]({'status':'Enabled','name':_0x19bc38[_0x41247c(0xec)],'warehouse_category':_0x41247c(0x1a5)});}else _0x4d9d1e=await warehouse[_0x41247c(0xf9)]({'status':'Enabled','warehouse_category':_0x41247c(0x1a5)});const _0x28abb3=await warehouse[_0x41247c(0x136)]([{'$match':{'name':_0x4b0189[_0x41247c(0x101)],'warehouse_category':_0x41247c(0x1a5)}},{'$unwind':_0x41247c(0x129)},{'$group':{'_id':_0x41247c(0x16d),'name':{'$first':_0x41247c(0x132)},'product_stock':{'$first':_0x41247c(0xd7)},'bay':{'$first':_0x41247c(0x185)},'bin':{'$first':_0x41247c(0x145)},'type':{'$first':_0x41247c(0xe9)},'floorlevel':{'$first':_0x41247c(0x11d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x41247c(0x14e)},'product_code':{'$first':_0x41247c(0x119)},'storage':{'$first':_0x41247c(0xe4)},'rack':{'$first':_0x41247c(0x150)},'expiry_date':{'$first':_0x41247c(0xf6)},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':'$room'},'warehoue_name':{'$first':_0x41247c(0xd3)}}}]),_0x2778c4=await product[_0x41247c(0xf9)]({});if(_0x1bfcb1[0x0][_0x41247c(0xf4)]==_0x41247c(0x110)){var _0x229e50=users[_0x41247c(0x121)];console[_0x41247c(0x196)](_0x229e50);}else{if(_0x1bfcb1[0x0]['language']==_0x41247c(0xdf))var _0x229e50=users[_0x41247c(0xdf)];else{if(_0x1bfcb1[0x0][_0x41247c(0xf4)]==_0x41247c(0x162))var _0x229e50=users['German'];else{if(_0x1bfcb1[0x0][_0x41247c(0xf4)]=='Spanish')var _0x229e50=users[_0x41247c(0x11b)];else{if(_0x1bfcb1[0x0][_0x41247c(0xf4)]==_0x41247c(0x138))var _0x229e50=users['French'];else{if(_0x1bfcb1[0x0]['language']=='Portuguese\x20(BR)')var _0x229e50=users[_0x41247c(0x15a)];else{if(_0x1bfcb1[0x0][_0x41247c(0xf4)]=='Chinese')var _0x229e50=users['Chinese'];else{if(_0x1bfcb1[0x0][_0x41247c(0xf4)]==_0x41247c(0xe6))var _0x229e50=users['Arabic'];}}}}}}}_0x10f426[_0x41247c(0x180)]('edit_transfer_finished_view',{'success':_0x25bfd7[_0x41247c(0x127)](_0x41247c(0x12d)),'errors':_0x25bfd7[_0x41247c(0x127)](_0x41247c(0x1a9)),'role':_0xfeb03c,'profile':_0x16650d,'master_shop':_0x1bfcb1,'warehouse':_0x4d9d1e,'transfer':_0x4b0189,'stock':_0x28abb3,'unit':_0x2778c4,'language':_0x229e50});}catch(_0x3ff0c7){console['log'](_0x3ff0c7);}}),router['post'](a0_0xec633e(0xe2),auth,async(_0x28136f,_0x1b53fc)=>{var _0x59a106=a0_0xec633e;try{const {invoice:_0x1042be,from_warehouse:_0x37ad5b,FromRoom_name:_0x2b6b88,to_warehouse:_0x545867,ToRoom_name:_0x4df14d}=_0x28136f[_0x59a106(0x159)],_0x58d3bb=await transfers_finished[_0x59a106(0x18c)](_0x28136f[_0x59a106(0x189)]['id']),_0x4f982b=_0x58d3bb[_0x59a106(0x141)][_0x59a106(0x175)](async _0x158f1f=>{var _0x4128e4=_0x59a106;if(_0x158f1f[_0x4128e4(0x130)]>0x0){var _0x13d795=await warehouse[_0x4128e4(0x16f)]({'name':_0x37ad5b,'room':_0x158f1f[_0x4128e4(0xfb)],'warehouse_category':_0x4128e4(0x1a5)});const _0x1c1a31=_0x13d795[_0x4128e4(0x117)]['map'](_0x156965=>{var _0x3620e6=_0x4128e4;_0x156965[_0x3620e6(0xd6)]==_0x158f1f[_0x3620e6(0xd6)]&&_0x156965[_0x3620e6(0xdc)]==_0x158f1f['from_bay']&&_0x156965['expiry_date']==_0x158f1f[_0x3620e6(0x15c)]&&_0x156965[_0x3620e6(0x183)]==_0x158f1f['production_date']&&_0x156965[_0x3620e6(0x11c)]==_0x158f1f[_0x3620e6(0x11c)]&&_0x156965[_0x3620e6(0x15e)]==_0x158f1f[_0x3620e6(0x1a6)]&&(_0x156965[_0x3620e6(0x128)]=_0x156965[_0x3620e6(0x128)]-_0x158f1f[_0x3620e6(0x130)]);});}return _0x13d795;});Promise[_0x59a106(0x16b)](_0x4f982b)[_0x59a106(0x13e)](async _0x5a616f=>{var _0x4b4caf=_0x59a106;try{for(const _0x3e6004 of _0x5a616f){await _0x3e6004['save']();}const _0x3c14fb=_0x58d3bb['product'][_0x4b4caf(0x175)](async _0x320a7a=>{var _0x574986=_0x4b4caf,_0x582fec=await warehouse[_0x574986(0x16f)]({'name':_0x545867,'room':_0x320a7a[_0x574986(0x184)]});if(_0x320a7a[_0x574986(0x130)]>0x0){var _0x6f496a=0x0;const _0x48213c=_0x582fec['product_details'][_0x574986(0x175)](_0x5b08c6=>{var _0xa43507=_0x574986;_0x5b08c6[_0xa43507(0xd6)]==_0x320a7a[_0xa43507(0xd6)]&&_0x5b08c6['bay']==_0x320a7a[_0xa43507(0x193)]&&_0x5b08c6['expiry_date']==_0x320a7a['expiry_date']&&_0x5b08c6['production_date']==_0x320a7a[_0xa43507(0x183)]&&_0x5b08c6[_0xa43507(0x11c)]==_0x320a7a[_0xa43507(0x11c)]&&_0x5b08c6[_0xa43507(0x15e)]==_0x320a7a[_0xa43507(0x13c)]&&(_0x5b08c6[_0xa43507(0x128)]=_0x5b08c6[_0xa43507(0x128)]+_0x320a7a[_0xa43507(0x130)],_0x6f496a++);});_0x6f496a=='0'&&(_0x582fec['product_details']=_0x582fec['product_details'][_0x574986(0xf2)]({'product_name':_0x320a7a[_0x574986(0xd6)],'product_stock':_0x320a7a['to_quantity'],'bay':_0x320a7a[_0x574986(0x193)],'product_code':_0x320a7a[_0x574986(0x16c)],'primary_code':_0x320a7a[_0x574986(0x164)],'secondary_code':_0x320a7a['secondary_code'],'expiry_date':_0x320a7a['expiry_date'],'production_date':_0x320a7a['production_date'],'maxProducts':_0x320a7a[_0x574986(0x137)],'batch_code':_0x320a7a[_0x574986(0x11c)],'secondary_unit':_0x320a7a['secondary_unit'],'unit':_0x320a7a['unit'],'maxProducts':_0x320a7a[_0x574986(0x137)],'maxPerUnit':_0x320a7a[_0x574986(0x13f)],'invoice':_0x320a7a[_0x574986(0x13c)]}));}return _0x582fec;});Promise[_0x4b4caf(0x16b)](_0x3c14fb)['then'](async _0x379880=>{var _0x45696c=_0x4b4caf;try{for(const _0xdb98e6 of _0x379880){await warehouse[_0x45696c(0x171)]({'_id':_0xdb98e6[_0x45696c(0xf5)]},{'$addToSet':{'product_details':{'$each':_0xdb98e6[_0x45696c(0x117)]}}});}_0x58d3bb[_0x45696c(0xe8)]=_0x45696c(0xfc);const _0x34f387=await _0x58d3bb['save'](),_0x264aa4=await master_shop['find'](),_0x54a87d=await email_settings[_0x45696c(0x16f)](),_0x490c4a=await supervisor_settings[_0x45696c(0xf9)]();var _0x3b2aa1=_0x58d3bb[_0x45696c(0x141)],_0x5bcf42='',_0x820bf0;for(_0x820bf0 in _0x3b2aa1){var _0x8c9dc3='FG';_0x58d3bb['to_warehouse']=='DRY\x20GOODS'&&(_0x8c9dc3='DG'),_0x5bcf42+=_0x45696c(0xd0)+_0x45696c(0x15b)+_0x3b2aa1[_0x820bf0][_0x45696c(0xd6)]+'</td>'+_0x45696c(0x15b)+_0x3b2aa1[_0x820bf0][_0x45696c(0x16c)]+_0x45696c(0xcd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b2aa1[_0x820bf0][_0x45696c(0x130)]+_0x45696c(0xcd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b2aa1[_0x820bf0][_0x45696c(0x10f)]+_0x45696c(0xcd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b2aa1[_0x820bf0][_0x45696c(0x177)]+'</td>'+_0x45696c(0x15b)+_0x58d3bb[_0x45696c(0x10c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b2aa1[_0x820bf0][_0x45696c(0x184)]+_0x45696c(0xcd)+_0x45696c(0x15b)+_0x8c9dc3+_0x3b2aa1[_0x820bf0][_0x45696c(0x193)]+'</td>'+'</tr>';}let _0x4ef040=nodemailer[_0x45696c(0x19d)]({'host':_0x54a87d[_0x45696c(0x104)],'port':Number(_0x54a87d[_0x45696c(0x173)]),'secure':![],'auth':{'user':_0x54a87d[_0x45696c(0x19a)],'pass':_0x54a87d[_0x45696c(0x140)]}}),_0x1e07f9={'from':_0x54a87d['email'],'to':_0x490c4a[0x0][_0x45696c(0x163)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x45696c(0xd4),'path':__dirname+_0x45696c(0x124)+'/upload/'+_0x264aa4[0x0][_0x45696c(0xf3)],'cid':_0x45696c(0x10e)}],'html':_0x45696c(0xe7)+_0x45696c(0xd2)+_0x45696c(0x14f)+_0x45696c(0x17f)+_0x45696c(0x190)+'<div>'+_0x45696c(0x152)+_0x45696c(0x16a)+_0x45696c(0x17f)+_0x45696c(0x167)+_0x264aa4[0x0][_0x45696c(0x108)]+'\x20</h2>'+'</div>'+_0x45696c(0x16a)+_0x45696c(0x187)+'<div>'+_0x45696c(0xda)+_0x45696c(0x195)+_0x58d3bb['invoice']+'\x20'+_0x45696c(0x179)+_0x45696c(0x18d)+_0x58d3bb[_0x45696c(0x154)]+'\x20'+_0x45696c(0x12f)+'</h5>'+_0x45696c(0x16a)+_0x45696c(0x122)+_0x45696c(0x198)+_0x45696c(0xd0)+_0x45696c(0x192)+_0x45696c(0x157)+_0x45696c(0x139)+_0x45696c(0x16e)+_0x45696c(0x1a8)+_0x45696c(0xf8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x45696c(0x120)+_0x45696c(0x17d)+_0x45696c(0x105)+_0x45696c(0x155)+'\x20'+_0x5bcf42+'\x20'+'</tbody>'+'</table>'+_0x45696c(0x17f)+_0x45696c(0x153)+_0x45696c(0x199)+_0x264aa4[0x0]['site_title']+_0x45696c(0x123)+'</div>'+_0x45696c(0x16a)+_0x45696c(0x191)};_0x4ef040[_0x45696c(0xef)](_0x1e07f9,function(_0x3d8961,_0x6091b8){var _0x410ba3=_0x45696c;_0x3d8961?(console[_0x410ba3(0x196)](_0x3d8961),console['log']('Error\x20Occurs')):console[_0x410ba3(0x196)]('Email\x20sent\x20successfully');}),_0x28136f[_0x45696c(0x127)](_0x45696c(0x12d),'Transfer\x20Finalize\x20Successfully'),_0x1b53fc[_0x45696c(0x166)](_0x45696c(0x1a4)+_0x34f387[_0x45696c(0xf5)]);}catch(_0x4ede1a){console[_0x45696c(0x170)](_0x4ede1a),_0x1b53fc[_0x45696c(0xe1)](0x1f4)[_0x45696c(0x135)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x34dc47=>{var _0x213ac6=_0x4b4caf;console[_0x213ac6(0x170)](_0x34dc47),_0x1b53fc[_0x213ac6(0xe1)](0x1f4)[_0x213ac6(0x135)]({'error':_0x213ac6(0x1a3)});});}catch(_0x60cbc6){console[_0x4b4caf(0x170)](_0x60cbc6),_0x1b53fc[_0x4b4caf(0xe1)](0x1f4)[_0x4b4caf(0x135)]({'error':_0x4b4caf(0xf1)});}})[_0x59a106(0x158)](_0x3cf0d2=>{var _0x67f56a=_0x59a106;console[_0x67f56a(0x170)](_0x3cf0d2),_0x1b53fc['status'](0x1f4)[_0x67f56a(0x135)]({'error':_0x67f56a(0x1a3)});});}catch(_0x468f46){_0x1b53fc['json']({'message':_0x468f46[_0x59a106(0x133)]});}});function BayBinSelected(_0x577018,_0x4bef81){var _0x1f9c02=a0_0xec633e,_0xb81c74=[];let _0x355ffb=[];var _0x46bfbf=[];if(_0x577018==_0x1f9c02(0x18b)){switch(_0x4bef81){case _0x1f9c02(0x12b):_0xb81c74=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1f9c02(0x176):_0xb81c74=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x46bfbf=['DG'];}else{if(_0x577018=='FROZEN\x20GOODS'){switch(_0x4bef81){case _0x1f9c02(0x12b):_0xb81c74=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1f9c02(0x176):_0xb81c74=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x46bfbf=['FG'];}}return{'levels':_0xb81c74,'identify':_0x46bfbf};}router[a0_0xec633e(0xfe)](a0_0xec633e(0x14d),auth,async(_0x51d92c,_0x4c662e)=>{var _0x3bd408=a0_0xec633e;try{const {username:_0x326621,email:_0xab8afc,role:_0x445ac2}=_0x51d92c[_0x3bd408(0xcf)],_0x20259e=_0x51d92c['user'],_0x8d66d4=await profile[_0x3bd408(0x16f)]({'email':_0x20259e[_0x3bd408(0x19a)]}),_0x584424=await master_shop['find'](),_0x2efbbe=await transfers_finished[_0x3bd408(0x18c)](_0x51d92c[_0x3bd408(0x189)]['id']);let _0x584c50=new Date(_0x2efbbe['expiry_date']),_0x89a702=('0'+_0x584c50['getDate']())[_0x3bd408(0x14a)](-0x2),_0x3120f4=('0'+(_0x584c50[_0x3bd408(0x13a)]()+0x1))[_0x3bd408(0x14a)](-0x2),_0x472848=_0x584c50[_0x3bd408(0x134)](),_0x34a908=_0x472848+'-'+_0x3120f4+'-'+_0x89a702,_0x467885;if(_0x20259e[_0x3bd408(0x18e)]==_0x3bd408(0xfa)){const _0x14ae51=await staff[_0x3bd408(0x16f)]({'email':_0x20259e[_0x3bd408(0x19a)]});_0x467885=await warehouse[_0x3bd408(0xf9)]({'status':'Enabled','name':_0x14ae51[_0x3bd408(0xec)],'warehouse_category':_0x3bd408(0x1a5)});}else _0x467885=await warehouse['find']({'status':_0x3bd408(0xd1),'warehouse_category':_0x3bd408(0x1a5)});const _0x484e6f=await warehouse[_0x3bd408(0x136)]([{'$match':{'name':_0x2efbbe['from_warehouse'],'room':_0x2efbbe[_0x3bd408(0xea)]}},{'$unwind':_0x3bd408(0x129)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3bd408(0x132)},'product_stock':{'$first':_0x3bd408(0xd7)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3bd408(0xe9)},'floorlevel':{'$first':_0x3bd408(0x11d)},'primary_code':{'$first':_0x3bd408(0x10a)},'secondary_code':{'$first':_0x3bd408(0x14e)},'product_code':{'$first':_0x3bd408(0x119)},'storage':{'$first':_0x3bd408(0xe4)},'rack':{'$first':_0x3bd408(0x150)}}}]);var _0x54dfe6=[0x1,0x2,0x3,0x4],_0x52c221=['A','B','C','D','E','F','G','H','I','J'],_0x39ba46=[_0x3bd408(0x149),_0x3bd408(0x15d)];const _0x2aca1f=await product[_0x3bd408(0xf9)]({}),_0xd4b85a=BayBinSelected(_0x2efbbe[_0x3bd408(0x10c)],_0x2efbbe[_0x3bd408(0xeb)]);if(_0x584424[0x0][_0x3bd408(0xf4)]==_0x3bd408(0x110)){var _0x1451d5=users[_0x3bd408(0x121)];console[_0x3bd408(0x196)](_0x1451d5);}else{if(_0x584424[0x0][_0x3bd408(0xf4)]==_0x3bd408(0xdf))var _0x1451d5=users['Hindi'];else{if(_0x584424[0x0]['language']==_0x3bd408(0x162))var _0x1451d5=users[_0x3bd408(0x162)];else{if(_0x584424[0x0][_0x3bd408(0xf4)]==_0x3bd408(0x11b))var _0x1451d5=users[_0x3bd408(0x11b)];else{if(_0x584424[0x0]['language']==_0x3bd408(0x138))var _0x1451d5=users[_0x3bd408(0x138)];else{if(_0x584424[0x0][_0x3bd408(0xf4)]=='Portuguese\x20(BR)')var _0x1451d5=users[_0x3bd408(0x15a)];else{if(_0x584424[0x0]['language']==_0x3bd408(0x118))var _0x1451d5=users[_0x3bd408(0x118)];else{if(_0x584424[0x0]['language']==_0x3bd408(0xe6))var _0x1451d5=users[_0x3bd408(0x1a0)];}}}}}}}_0x4c662e['render']('edit_transfer_finished',{'success':_0x51d92c[_0x3bd408(0x127)](_0x3bd408(0x12d)),'errors':_0x51d92c[_0x3bd408(0x127)](_0x3bd408(0x1a9)),'role':_0x20259e,'profile':_0x8d66d4,'master_shop':_0x584424,'warehouse':_0x467885,'transfer':_0x2efbbe,'stock':_0x484e6f,'unit':_0x2aca1f,'language':_0x1451d5,'levels':_0x54dfe6,'Isle':_0x52c221,'rooms_data':_0x39ba46,'ed_fullDate':_0x34a908,'dataSelected':_0xd4b85a});}catch(_0x3194cc){console[_0x3bd408(0x196)](_0x3194cc);}}),router[a0_0xec633e(0x11f)](a0_0xec633e(0x14d),auth,async(_0x4440d4,_0x116821)=>{var _0x359f35=a0_0xec633e;try{const _0xdd78f0=_0x4440d4[_0x359f35(0x189)]['id'];console[_0x359f35(0x196)](_0x4440d4[_0x359f35(0x159)]);const _0x508ce5=await transfers_finished['findById'](_0xdd78f0);console[_0x359f35(0x196)](_0x359f35(0xf0),_0x508ce5);const {date:_0x4c56a8,from_warehouse:_0x441099,FromRoom_name:_0x57103e,to_warehouse:_0xbd3741,ToRoom_name:_0x41ebea,prod_name:_0x194220,from_prod_qty:_0x426d8c,from_prod_level:_0x266ecb,from_prod_isle:_0x59ec6c,from_prod_pallet:_0x43dce1,to_prod_qty:_0x1a4e9c,to_prod_level:_0x5ed9ba,to_prod_isle:_0x8405ee,to_prod_pallet:_0x29a3e8,primary_code:_0x5f3e6a,secondary_code:_0x349c3c,product_code3:_0x464809,note:_0x1dfc01,invoice:_0x438c5a,expiry_date:_0x2dac9d}=_0x4440d4[_0x359f35(0x159)];if(typeof _0x194220=='string')var _0x49e985=[_0x4440d4['body'][_0x359f35(0xed)]],_0x129463=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x156)]],_0x4ec6ce=[_0x4440d4[_0x359f35(0x159)]['from_prod_level']],_0x1d4664=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x103)]],_0x19c163=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x10d)]],_0x424930=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x164)]],_0x2092a6=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x15f)]],_0xcdc2f3=[_0x4440d4['body']['product_code3']],_0xb0e69e=[_0x4440d4['body']['MaxStocks_data2']],_0xbaab7e=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x10f)]],_0x50c87f=[_0x4440d4[_0x359f35(0x159)]['secondary_unit']],_0x3730fb=[_0x4440d4['body'][_0x359f35(0x11c)]],_0x3cf8f6=[_0x4440d4[_0x359f35(0x159)][_0x359f35(0x15c)]];else var _0x49e985=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0xed)]],_0x129463=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x156)]],_0x4ec6ce=[..._0x4440d4[_0x359f35(0x159)]['from_prod_level']],_0x1d4664=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x103)]],_0x19c163=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x10d)]],_0x424930=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x164)]],_0x2092a6=[..._0x4440d4[_0x359f35(0x159)]['secondary_code']],_0xcdc2f3=[..._0x4440d4['body']['product_code3']],_0xb0e69e=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x113)]],_0xbaab7e=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x10f)]],_0x50c87f=[..._0x4440d4['body'][_0x359f35(0x177)]],_0x3730fb=[..._0x4440d4[_0x359f35(0x159)][_0x359f35(0x11c)]],_0x3cf8f6=[..._0x4440d4[_0x359f35(0x159)]['expiry_date']];const _0x378630=_0x49e985[_0x359f35(0x175)](_0x4a1e0b=>{return _0x4a1e0b={'product_name':_0x4a1e0b};});_0x129463['forEach']((_0x27b2d4,_0x470e83)=>{var _0x49a818=_0x359f35;_0x378630[_0x470e83][_0x49a818(0x197)]=_0x27b2d4;}),_0x4ec6ce[_0x359f35(0xdd)]((_0x2c6d9a,_0x4da7cb)=>{var _0x182b36=_0x359f35;_0x378630[_0x4da7cb][_0x182b36(0x1a1)]=_0x2c6d9a;}),_0x1d4664['forEach']((_0x1365b4,_0xafdfd5)=>{_0x378630[_0xafdfd5]['to_quantity']=_0x1365b4;}),_0x19c163[_0x359f35(0xdd)]((_0x3e23f0,_0x3e9c80)=>{var _0x209b33=_0x359f35;_0x378630[_0x3e9c80][_0x209b33(0x193)]=_0x3e23f0;}),_0x424930['forEach']((_0x5b768b,_0x54d1b0)=>{var _0x4a0ad1=_0x359f35;_0x378630[_0x54d1b0][_0x4a0ad1(0x164)]=_0x5b768b;}),_0x2092a6[_0x359f35(0xdd)]((_0x54b42e,_0x599625)=>{_0x378630[_0x599625]['secondary_code']=_0x54b42e;}),_0xcdc2f3[_0x359f35(0xdd)]((_0x27c21d,_0x24ff27)=>{var _0x5c596d=_0x359f35;_0x378630[_0x24ff27][_0x5c596d(0x16c)]=_0x27c21d;}),_0xb0e69e['forEach']((_0x5f0735,_0x4d5c1d)=>{var _0x2187ad=_0x359f35;_0x378630[_0x4d5c1d][_0x2187ad(0x137)]=_0x5f0735;}),_0xbaab7e[_0x359f35(0xdd)]((_0x39d186,_0x318125)=>{_0x378630[_0x318125]['unit']=_0x39d186;}),_0x50c87f[_0x359f35(0xdd)]((_0x76c581,_0x5575e5)=>{var _0x3245d6=_0x359f35;_0x378630[_0x5575e5][_0x3245d6(0x177)]=_0x76c581;}),_0x3730fb[_0x359f35(0xdd)]((_0x117df5,_0x4df5cc)=>{_0x378630[_0x4df5cc]['batch_code']=_0x117df5;}),_0x3cf8f6[_0x359f35(0xdd)]((_0x76aa58,_0x7af08b)=>{var _0x199e60=_0x359f35;_0x378630[_0x7af08b][_0x199e60(0x15c)]=_0x76aa58;});const _0x4289ea=_0x378630[_0x359f35(0x181)](_0x53d8ef=>_0x53d8ef[_0x359f35(0x130)]!=='0'&&_0x53d8ef[_0x359f35(0x130)]!==''||_0x53d8ef['to_floorlevel']!=='0'&&_0x53d8ef[_0x359f35(0x11e)]!=='');var _0xd12abc=0x0;_0x4289ea[_0x359f35(0xdd)](_0x1b49ec=>{var _0x100a43=_0x359f35;parseInt(_0x1b49ec[_0x100a43(0x197)])<parseInt(_0x1b49ec[_0x100a43(0x130)])&&_0xd12abc++;});if(_0xd12abc!=0x0)return _0x4440d4[_0x359f35(0x127)](_0x359f35(0x1a9),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x116821[_0x359f35(0x166)](_0x359f35(0x126));const _0x410d3e=await warehouse[_0x359f35(0x16f)]({'name':_0x508ce5[_0x359f35(0x101)],'room':_0x508ce5[_0x359f35(0xea)]});_0x508ce5['product']['forEach'](_0x28e542=>{var _0x240456=_0x359f35;if(_0x28e542['to_quantity']>0x0){const _0x19f84f=_0x410d3e[_0x240456(0x117)]['map'](_0x53faa5=>{var _0x5ec9b4=_0x240456;_0x53faa5['product_name']==_0x28e542[_0x5ec9b4(0xd6)]&&_0x53faa5['bay']==_0x28e542[_0x5ec9b4(0x1a1)]&&(_0x53faa5[_0x5ec9b4(0x128)]=parseInt(_0x53faa5[_0x5ec9b4(0x128)])+parseInt(_0x28e542[_0x5ec9b4(0x130)]));});}}),await _0x410d3e[_0x359f35(0xf7)]();const _0x216e25=await warehouse[_0x359f35(0x16f)]({'name':_0x508ce5[_0x359f35(0x10c)],'room':_0x508ce5['to_room']});_0x508ce5[_0x359f35(0x141)][_0x359f35(0xdd)](_0x393347=>{var _0x17942f=_0x359f35;if(_0x393347[_0x17942f(0x130)]>0x0){const _0x4e2f43=_0x216e25['product_details']['map'](_0x1fcaaf=>{var _0x45bfc4=_0x17942f;_0x1fcaaf[_0x45bfc4(0xd6)]==_0x393347[_0x45bfc4(0xd6)]&&_0x1fcaaf[_0x45bfc4(0xdc)]==_0x393347['to_bay']&&(_0x1fcaaf[_0x45bfc4(0x128)]=parseInt(_0x1fcaaf[_0x45bfc4(0x128)])-parseInt(_0x393347['to_quantity']));});}}),await _0x216e25[_0x359f35(0xf7)](),_0x508ce5[_0x359f35(0x154)]=_0x4c56a8,_0x508ce5[_0x359f35(0x101)]=_0x441099,_0x508ce5[_0x359f35(0x10c)]=_0xbd3741,_0x508ce5[_0x359f35(0x141)]=_0x4289ea,_0x508ce5[_0x359f35(0x161)]=_0x1dfc01,_0x508ce5[_0x359f35(0x15e)]=_0x438c5a;const _0xbe8d35=await _0x508ce5['save'](),_0x54996c=await warehouse[_0x359f35(0x16f)]({'name':_0x441099,'room':_0x57103e});_0xbe8d35[_0x359f35(0x141)][_0x359f35(0xdd)](_0x229873=>{var _0xfb6c15=_0x359f35;if(_0x229873[_0xfb6c15(0x130)]>0x0){const _0x3a5e1e=_0x54996c[_0xfb6c15(0x117)][_0xfb6c15(0x175)](_0x55a6ab=>{var _0x1015ed=_0xfb6c15;_0x55a6ab['product_name']==_0x229873[_0x1015ed(0xd6)]&&_0x55a6ab['bay']==_0x229873[_0x1015ed(0x1a1)]&&(_0x55a6ab['product_stock']=parseInt(_0x55a6ab['product_stock'])-parseInt(_0x229873['to_quantity']));});}}),await _0x54996c['save']();const _0x245400=await warehouse[_0x359f35(0x16f)]({'name':_0xbd3741,'room':_0x41ebea});_0xbe8d35['product'][_0x359f35(0xdd)](_0x35e529=>{var _0x52b1a9=_0x359f35;if(_0x35e529['to_quantity']>0x0){var _0x183c43=0x0;const _0x8b1028=_0x245400['product_details'][_0x52b1a9(0x175)](_0x39a7ef=>{var _0x3dc512=_0x52b1a9;_0x39a7ef[_0x3dc512(0xd6)]==_0x35e529[_0x3dc512(0xd6)]&&_0x39a7ef[_0x3dc512(0xdc)]==_0x35e529['to_bay']&&(_0x39a7ef[_0x3dc512(0x128)]=parseInt(_0x39a7ef['product_stock'])+parseInt(_0x35e529[_0x3dc512(0x130)]),_0x183c43++);});_0x183c43=='0'&&(_0x245400[_0x52b1a9(0x117)]=_0x245400[_0x52b1a9(0x117)][_0x52b1a9(0xf2)]({'product_name':_0x35e529[_0x52b1a9(0xd6)],'product_stock':_0x35e529[_0x52b1a9(0x130)],'bay':_0x35e529[_0x52b1a9(0x193)],'product_code':_0x35e529[_0x52b1a9(0x16c)],'primary_code':_0x35e529[_0x52b1a9(0x164)],'secondary_code':_0x35e529['secondary_code'],'maxProducts':_0x35e529[_0x52b1a9(0x137)]}));}}),await _0x245400[_0x359f35(0xf7)](),_0x4440d4[_0x359f35(0x127)](_0x359f35(0x12d),_0x359f35(0x169)),_0x116821['redirect'](_0x359f35(0xce));}catch(_0x2f99d2){console[_0x359f35(0x196)](_0x2f99d2);}}),router[a0_0xec633e(0x11f)](a0_0xec633e(0x178),async(_0x480bd3,_0x2fec32)=>{var _0x720106=a0_0xec633e;const {FromWareHouse:_0x12e80a,FromRoom:_0x13ceab,ToWarehouse:_0x34d41f,ToRoom:_0x3ed74c,primary_code:_0x5942da,Roomslist:_0x1ace21}=_0x480bd3['body'],_0xf4634c=_0x1ace21[_0x720106(0x13d)](','),_0x379a09=[];async function _0x159f4e(_0x2048b1){var _0x1d9bab=_0x720106;const _0x3f405e=await warehouse[_0x1d9bab(0x136)]([{'$match':{'name':_0x12e80a,'room':_0x2048b1}},{'$unwind':_0x1d9bab(0x129)},{'$match':{'product_details.primary_code':_0x5942da}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1d9bab(0x132)},'instock':{'$first':_0x1d9bab(0xd7)},'primary_code':{'$first':_0x1d9bab(0x10a)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x1d9bab(0x185)},'isle':{'$first':_0x1d9bab(0x145)},'type':{'$first':_0x1d9bab(0xe9)},'pallet':{'$first':_0x1d9bab(0x11d)},'unit':{'$first':_0x1d9bab(0xcc)},'secondary_unit':{'$first':_0x1d9bab(0x19f)},'storage':{'$first':_0x1d9bab(0xe4)},'rack':{'$first':_0x1d9bab(0x150)},'expiry_date':{'$first':_0x1d9bab(0xf6)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1d9bab(0x165)},'maxPerUnit':{'$first':_0x1d9bab(0xe5)},'roomNamed':{'$first':_0x1d9bab(0x107)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x1d9bab(0x11a)}}}]),_0x3a6383=await warehouse[_0x1d9bab(0x136)]([{'$match':{'name':_0x12e80a,'room':_0x2048b1}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x5942da}},{'$group':{'_id':_0x1d9bab(0x16d),'name':{'$first':_0x1d9bab(0x132)},'instock':{'$first':_0x1d9bab(0xd7)},'primary_code':{'$first':_0x1d9bab(0x10a)},'secondary_code':{'$first':_0x1d9bab(0x14e)},'product_code':{'$first':_0x1d9bab(0x119)},'level':{'$first':_0x1d9bab(0x185)},'isle':{'$first':_0x1d9bab(0x145)},'type':{'$first':_0x1d9bab(0xe9)},'pallet':{'$first':_0x1d9bab(0x11d)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x1d9bab(0x19f)},'storage':{'$first':_0x1d9bab(0xe4)},'rack':{'$first':_0x1d9bab(0x150)},'expiry_date':{'$first':_0x1d9bab(0xf6)},'production_date':{'$first':_0x1d9bab(0x1a7)},'batch_code':{'$first':_0x1d9bab(0x165)},'maxPerUnit':{'$first':_0x1d9bab(0xe5)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x1d9bab(0x11a)}}}]);if(_0x3f405e[_0x1d9bab(0x12a)]>0x0)_0x379a09[_0x1d9bab(0x174)](_0x3f405e);else _0x3a6383[_0x1d9bab(0x12a)]>0x0&&_0x379a09['push'](_0x3a6383);}const _0x1f2235=_0xf4634c[_0x720106(0x175)](_0x11349f=>_0x159f4e(_0x11349f));await Promise[_0x720106(0x16b)](_0x1f2235),_0x2fec32['json'](_0x379a09);}),router[a0_0xec633e(0x11f)](a0_0xec633e(0x109),async(_0x1a779e,_0x11e2b5)=>{var _0x8f237f=a0_0xec633e;try{const {FromWareHouse:_0xef8c06,FromRoom:_0x41a13f,ToWarehouse:_0x575280,ToRoom:_0x1b0b38,secondary_code:_0x1cee6e}=_0x1a779e[_0x8f237f(0x159)],_0x4aa17f=await warehouse[_0x8f237f(0x136)]([{'$match':{'name':_0xef8c06}},{'$unwind':_0x8f237f(0x129)},{'$match':{'product_details.secondary_code':_0x1cee6e}},{'$group':{'_id':_0x8f237f(0x16d),'name':{'$first':_0x8f237f(0x132)},'primary_code':{'$first':_0x8f237f(0x10a)},'secondary_code':{'$first':_0x8f237f(0x14e)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0x8f237f(0xd3)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x8f237f(0x112)},'pallet':{'$first':_0x8f237f(0x10b)},'maxProducts':{'$first':_0x8f237f(0x1a2)},'unit':{'$first':_0x8f237f(0xcc)},'expiry_date':{'$first':_0x8f237f(0xf6)},'production_date':{'$first':_0x8f237f(0x1a7)}}}]);_0x11e2b5[_0x8f237f(0xe1)](0xc8)[_0x8f237f(0x135)](_0x4aa17f);}catch(_0xbeadf3){_0x11e2b5['status'](0x194)[_0x8f237f(0x135)]({'message':_0xbeadf3[_0x8f237f(0x133)]});}}),router[a0_0xec633e(0x11f)](a0_0xec633e(0x14c),async(_0x1961f7,_0x1c7b06)=>{var _0x346281=a0_0xec633e;try{const {FromWareHouse:_0x28facc,FromRoom:_0x2e6b0a,ToWarehouse:_0x3e1e92,ToRoom:_0x1de371,product_code:_0x310107}=_0x1961f7[_0x346281(0x159)],_0x33df1e=await warehouse[_0x346281(0x136)]([{'$match':{'name':_0x28facc}},{'$unwind':_0x346281(0x129)},{'$match':{'product_details.product_code':_0x310107}},{'$group':{'_id':_0x346281(0x16d),'name':{'$first':_0x346281(0x132)},'primary_code':{'$first':_0x346281(0x10a)},'secondary_code':{'$first':_0x346281(0x14e)},'product_code':{'$first':_0x346281(0x119)},'instock':{'$first':_0x346281(0xd7)},'warehouse':{'$first':_0x346281(0xd3)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x346281(0x112)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x346281(0x1a2)},'unit':{'$first':_0x346281(0xcc)}}}]);_0x1c7b06['status'](0xc8)[_0x346281(0x135)](_0x33df1e);}catch(_0x37d04f){_0x1c7b06[_0x346281(0xe1)](0x194)[_0x346281(0x135)]({'message':_0x37d04f[_0x346281(0x133)]});}}),router[a0_0xec633e(0x11f)](a0_0xec633e(0x172),async(_0x8bdb2d,_0xa64bba)=>{var _0x1b06e1=a0_0xec633e;const {productCode:_0x7c17ab,bay:_0x520848,warehouses:_0x5ac37e,room:_0x3aeb98}=_0x8bdb2d['body'];console[_0x1b06e1(0x196)](_0x8bdb2d[_0x1b06e1(0x159)]);try{const _0x363b59=await warehouse[_0x1b06e1(0x136)]([{'$match':{'name':_0x5ac37e,'room':_0x3aeb98}},{'$unwind':_0x1b06e1(0x129)},{'$match':{'product_details.bay':parseInt(_0x520848)}},{'$group':{'_id':_0x1b06e1(0x16d),'name':{'$first':_0x1b06e1(0x132)},'product_stock':{'$first':_0x1b06e1(0xd7)},'bay':{'$first':_0x1b06e1(0x185)},'maxProducts':{'$first':_0x1b06e1(0x1a2)}}}]);_0xa64bba['status'](0xc8)['json'](_0x363b59);}catch(_0x5c74c7){_0xa64bba['status'](0x194)['json']({'message':_0x5c74c7['message']});}}),module[a0_0xec633e(0x17a)]=router;