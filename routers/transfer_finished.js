var a0_0x180469=a0_0x47e6;(function(_0x2d44eb,_0x1a969a){var _0x4ff4e7=a0_0x47e6,_0x3b63de=_0x2d44eb();while(!![]){try{var _0x417766=parseInt(_0x4ff4e7(0xfb))/0x1*(-parseInt(_0x4ff4e7(0x116))/0x2)+-parseInt(_0x4ff4e7(0x178))/0x3*(parseInt(_0x4ff4e7(0x140))/0x4)+parseInt(_0x4ff4e7(0xc9))/0x5*(parseInt(_0x4ff4e7(0x12d))/0x6)+-parseInt(_0x4ff4e7(0xe6))/0x7*(-parseInt(_0x4ff4e7(0x149))/0x8)+parseInt(_0x4ff4e7(0x179))/0x9*(parseInt(_0x4ff4e7(0x16f))/0xa)+parseInt(_0x4ff4e7(0x128))/0xb+-parseInt(_0x4ff4e7(0x147))/0xc*(parseInt(_0x4ff4e7(0x16b))/0xd);if(_0x417766===_0x1a969a)break;else _0x3b63de['push'](_0x3b63de['shift']());}catch(_0x3bdc4e){_0x3b63de['push'](_0x3b63de['shift']());}}}(a0_0x13fd,0x4cb30));const express=require(a0_0x180469(0xfe)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x180469(0xea)),auth=require(a0_0x180469(0x16e)),users=require(a0_0x180469(0x110)),nodemailer=require(a0_0x180469(0xfc));router[a0_0x180469(0x138)]('/view',auth,async(_0x1a3f03,_0x3d8df2)=>{var _0x56b104=a0_0x180469;try{const {username:_0xaf97b0,email:_0xf719ae,role:_0x2977a3}=_0x1a3f03[_0x56b104(0xdd)],_0x1c3545=_0x1a3f03[_0x56b104(0xdd)],_0x32584b=await profile[_0x56b104(0x18b)]({'email':_0x1c3545['email']}),_0x67ddaa=await master_shop[_0x56b104(0x126)]();let _0x486112;if(_0x1c3545['role']=='staff'){const _0x40ed02=await staff['findOne']({'email':_0x1c3545[_0x56b104(0x15a)]});_0x486112=await transfers_finished['find']({'from_warehouse':_0x40ed02[_0x56b104(0x12f)]});}else _0x486112=await transfers_finished[_0x56b104(0xf6)]([{'$unwind':_0x56b104(0xdf)},{'$group':{'_id':_0x56b104(0x100),'invoice':{'$first':_0x56b104(0x113)},'date':{'$first':_0x56b104(0xc3)},'from_warehouse':{'$first':_0x56b104(0xd8)},'to_warehouse':{'$first':_0x56b104(0x17c)},'from_room_name':{'$addToSet':_0x56b104(0xe3)},'to_room_name':{'$addToSet':_0x56b104(0x153)},'finalize':{'$first':_0x56b104(0x10e)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x67ddaa[0x0]['language']==_0x56b104(0x181))var _0x272f04=users[_0x56b104(0x141)];else{if(_0x67ddaa[0x0][_0x56b104(0x105)]=='Hindi')var _0x272f04=users[_0x56b104(0x102)];else{if(_0x67ddaa[0x0][_0x56b104(0x105)]=='German')var _0x272f04=users[_0x56b104(0x177)];else{if(_0x67ddaa[0x0]['language']==_0x56b104(0x13b))var _0x272f04=users[_0x56b104(0x13b)];else{if(_0x67ddaa[0x0]['language']==_0x56b104(0xf8))var _0x272f04=users[_0x56b104(0xf8)];else{if(_0x67ddaa[0x0][_0x56b104(0x105)]==_0x56b104(0xfa))var _0x272f04=users[_0x56b104(0xd5)];else{if(_0x67ddaa[0x0][_0x56b104(0x105)]==_0x56b104(0x11d))var _0x272f04=users[_0x56b104(0x11d)];else{if(_0x67ddaa[0x0][_0x56b104(0x105)]=='Arabic\x20(ae)')var _0x272f04=users[_0x56b104(0x11f)];}}}}}}}_0x3d8df2[_0x56b104(0x17e)](_0x56b104(0x14e),{'success':_0x1a3f03['flash'](_0x56b104(0xca)),'errors':_0x1a3f03[_0x56b104(0xe1)](_0x56b104(0x13a)),'role':_0x1c3545,'profile':_0x32584b,'master_shop':_0x67ddaa,'transfer':_0x486112,'language':_0x272f04});}catch(_0x344f0b){console[_0x56b104(0x169)](_0x344f0b);}});async function getRandom8DigitNumber(){var _0x3d3139=a0_0x180469;const _0x40640e=0x989680,_0x458565=0x5f5e0ff,_0x13cf12=Math[_0x3d3139(0x15f)](Math[_0x3d3139(0x145)]()*(_0x458565-_0x40640e+0x1))+_0x40640e;var _0x22a4a0;const _0x10950f=await transfers_finished['findOne']({'invoice':_0x3d3139(0x112)+_0x13cf12});return _0x10950f&&_0x10950f[_0x3d3139(0xeb)]>0x0?_0x22a4a0='TRFF-'+_0x13cf12:_0x22a4a0=_0x3d3139(0x112)+_0x13cf12,_0x22a4a0;}router[a0_0x180469(0x138)]('/view/add_transfer',auth,async(_0x135af2,_0x52c2df)=>{var _0x4720ff=a0_0x180469;try{const {username:_0x40dee9,email:_0x2442b2,role:_0x11904a}=_0x135af2['user'],_0x4b1f7e=_0x135af2['user'],_0x444fa3=await profile[_0x4720ff(0x18b)]({'email':_0x4b1f7e[_0x4720ff(0x15a)]}),_0x5a85eb=await master_shop['find']();let _0x431d46;if(_0x4b1f7e[_0x4720ff(0xce)]==_0x4720ff(0xc1)){const _0x4705e2=await staff['findOne']({'email':_0x4b1f7e[_0x4720ff(0x15a)]});_0x431d46=await warehouse['aggregate']([{'$match':{'status':_0x4720ff(0x183),'name':_0x4705e2[_0x4720ff(0x12f)],'warehouse_category':_0x4720ff(0xc4),'name':{'$ne':_0x4720ff(0x130)}}},{'$group':{'_id':_0x4720ff(0xc6),'name':{'$first':'$name'}}}]);}else _0x431d46=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x4720ff(0x130)}}},{'$group':{'_id':_0x4720ff(0xc6),'name':{'$first':_0x4720ff(0xc6)}}}]);const _0x4a6d85=await transfers_finished[_0x4720ff(0x126)]({}),_0x13af8d=_0x4a6d85[_0x4720ff(0xeb)]+0x1,_0x5262a1=_0x4720ff(0x112)+_0x13af8d['toString']()[_0x4720ff(0x122)](0x5,'0');if(_0x5a85eb[0x0][_0x4720ff(0x105)]=='English\x20(US)')var _0x4964d3=users[_0x4720ff(0x141)];else{if(_0x5a85eb[0x0][_0x4720ff(0x105)]==_0x4720ff(0x102))var _0x4964d3=users[_0x4720ff(0x102)];else{if(_0x5a85eb[0x0][_0x4720ff(0x105)]==_0x4720ff(0x177))var _0x4964d3=users['German'];else{if(_0x5a85eb[0x0][_0x4720ff(0x105)]==_0x4720ff(0x13b))var _0x4964d3=users[_0x4720ff(0x13b)];else{if(_0x5a85eb[0x0][_0x4720ff(0x105)]==_0x4720ff(0xf8))var _0x4964d3=users[_0x4720ff(0xf8)];else{if(_0x5a85eb[0x0][_0x4720ff(0x105)]=='Portuguese\x20(BR)')var _0x4964d3=users['Portuguese'];else{if(_0x5a85eb[0x0]['language']=='Chinese')var _0x4964d3=users[_0x4720ff(0x11d)];else{if(_0x5a85eb[0x0][_0x4720ff(0x105)]=='Arabic\x20(ae)')var _0x4964d3=users[_0x4720ff(0x11f)];}}}}}}}const _0x4cb2a8=getRandom8DigitNumber();_0x4cb2a8['then'](_0x5ce92e=>{var _0x43c146=_0x4720ff;_0x52c2df[_0x43c146(0x17e)](_0x43c146(0xf5),{'success':_0x135af2[_0x43c146(0xe1)]('success'),'errors':_0x135af2['flash'](_0x43c146(0x13a)),'role':_0x4b1f7e,'profile':_0x444fa3,'master_shop':_0x5a85eb,'warehouse':_0x431d46,'language':_0x4964d3,'invoice':_0x5ce92e});})[_0x4720ff(0x11b)](_0x3011ed=>{var _0x5cc81d=_0x4720ff;_0x135af2[_0x5cc81d(0xe1)](_0x5cc81d(0x13a),_0x5cc81d(0x18f)),_0x52c2df[_0x5cc81d(0xc2)](_0x5cc81d(0x118));});}catch(_0x334765){console[_0x4720ff(0x169)](_0x334765);}}),router[a0_0x180469(0x167)](a0_0x180469(0x10a),auth,async(_0x4de9c6,_0x5e1105)=>{var _0x41a5fb=a0_0x180469;try{const {date:_0x9bb5b7,from_warehouse:_0x1843d9,FromRoom_name:_0x1a6be9,to_warehouse:_0x488a6a,ToRoom_name:_0x3e19d1,prod_name:_0x330992,from_prod_qty:_0x6bbaa9,from_prod_level:_0xb568cc,from_prod_isle:_0x4a6e5f,from_prod_pallet:_0x4a6590,to_prod_qty:_0x5c638e,to_prod_level:_0x4205eb,to_prod_isle:_0x581450,to_prod_pallet:_0x4fa8f3,primary_code:_0x2b057b,secondary_code:_0x532c08,product_code3:_0x5cd9e5,note:_0x346e4,MaxStocks_data2:_0x40a0ba,invoice:_0x39a1a2,expiry_date:_0x29a1a1}=_0x4de9c6[_0x41a5fb(0x163)];if(typeof _0x330992=='string')var _0x4a3ba1=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x13e)]],_0x133a9d=[_0x4de9c6['body'][_0x41a5fb(0x150)]],_0x4401da=[_0x4de9c6[_0x41a5fb(0x163)]['from_prod_level']],_0x394aed=[_0x4de9c6[_0x41a5fb(0x163)]['New_Qty_Converted']],_0x11966b=[_0x4de9c6['body'][_0x41a5fb(0x111)]],_0x5c2255=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x171)]],_0x321470=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x18a)]],_0x2929f4=[_0x4de9c6[_0x41a5fb(0x163)]['product_code3']],_0x21d0a7=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x137)]],_0x682b9f=[_0x4de9c6[_0x41a5fb(0x163)]['primary_unit']],_0x3e4cc1=[_0x4de9c6[_0x41a5fb(0x163)]['secondary_unit']],_0x29c464=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x190)]],_0x3e56a6=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0xf1)]],_0x3cae7f=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x151)]],_0xe0299a=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x146)]],_0x4fa460=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x103)]],_0x1639af=[_0x4de9c6[_0x41a5fb(0x163)]['prod_cat']],_0x4cc30c=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0xc5)]],_0x1c388f=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x188)]],_0x49437b=[_0x4de9c6[_0x41a5fb(0x163)]['from_invoice']],_0x301b3f=[_0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x121)]];else var _0x4a3ba1=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x13e)]],_0x133a9d=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x150)]],_0x4401da=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x13c)]],_0x394aed=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x10f)]],_0x11966b=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x111)]],_0x5c2255=[..._0x4de9c6['body'][_0x41a5fb(0x171)]],_0x321470=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x18a)]],_0x2929f4=[..._0x4de9c6['body'][_0x41a5fb(0x10c)]],_0x21d0a7=[..._0x4de9c6['body'][_0x41a5fb(0x137)]],_0x682b9f=[..._0x4de9c6[_0x41a5fb(0x163)]['primary_unit']],_0x3e4cc1=[..._0x4de9c6[_0x41a5fb(0x163)]['secondary_unit']],_0x29c464=[..._0x4de9c6['body'][_0x41a5fb(0x190)]],_0x3e56a6=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0xf1)]],_0x3cae7f=[..._0x4de9c6['body'][_0x41a5fb(0x151)]],_0xe0299a=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x146)]],_0x4fa460=[..._0x4de9c6[_0x41a5fb(0x163)]['maxPerUnit']],_0x1639af=[..._0x4de9c6['body'][_0x41a5fb(0xf4)]],_0x4cc30c=[..._0x4de9c6[_0x41a5fb(0x163)]['RoomAssigned']],_0x1c388f=[..._0x4de9c6[_0x41a5fb(0x163)][_0x41a5fb(0x188)]],_0x49437b=[..._0x4de9c6['body'][_0x41a5fb(0x158)]],_0x301b3f=[..._0x4de9c6['body'][_0x41a5fb(0x121)]];const _0x17a9c9=_0x4a3ba1[_0x41a5fb(0x135)](_0x34209c=>{return _0x34209c={'product_name':_0x34209c};});_0x133a9d[_0x41a5fb(0xf9)]((_0x599ca3,_0x34375d)=>{_0x17a9c9[_0x34375d]['from_quantity']=_0x599ca3;}),_0x4401da['forEach']((_0x46e691,_0x43d49b)=>{var _0x18a29=_0x41a5fb;_0x17a9c9[_0x43d49b][_0x18a29(0x143)]=_0x46e691;}),_0x49437b['forEach']((_0x57939d,_0x487ebd)=>{var _0x437a52=_0x41a5fb;_0x17a9c9[_0x487ebd][_0x437a52(0x158)]=_0x57939d;}),_0x301b3f[_0x41a5fb(0xf9)]((_0x34f5da,_0x47d07b)=>{var _0x414205=_0x41a5fb;_0x17a9c9[_0x47d07b][_0x414205(0xcb)]=_0x34f5da;}),_0x394aed['forEach']((_0x221a84,_0x9bf310)=>{_0x17a9c9[_0x9bf310]['to_quantity']=_0x221a84;}),_0x11966b[_0x41a5fb(0xf9)]((_0x2b18af,_0x2f1b49)=>{var _0x289296=_0x41a5fb;_0x17a9c9[_0x2f1b49][_0x289296(0x15d)]=_0x2b18af;}),_0x5c2255[_0x41a5fb(0xf9)]((_0x411c61,_0x76c5b8)=>{_0x17a9c9[_0x76c5b8]['primary_code']=_0x411c61;}),_0x321470[_0x41a5fb(0xf9)]((_0x3b188e,_0x2cbb52)=>{var _0x5a9851=_0x41a5fb;_0x17a9c9[_0x2cbb52][_0x5a9851(0x18a)]=_0x3b188e;}),_0x2929f4[_0x41a5fb(0xf9)]((_0x26a014,_0x39287d)=>{var _0x2cd0f1=_0x41a5fb;_0x17a9c9[_0x39287d][_0x2cd0f1(0x17d)]=_0x26a014;}),_0x21d0a7[_0x41a5fb(0xf9)]((_0x3b3d70,_0x3f5168)=>{_0x17a9c9[_0x3f5168]['maxProducts']=_0x3b3d70;}),_0x682b9f[_0x41a5fb(0xf9)]((_0x5ca9cb,_0xf37faf)=>{var _0x333b0d=_0x41a5fb;_0x17a9c9[_0xf37faf][_0x333b0d(0x11c)]=_0x5ca9cb;}),_0x3e4cc1[_0x41a5fb(0xf9)]((_0x58c17b,_0x237ddc)=>{var _0x436862=_0x41a5fb;_0x17a9c9[_0x237ddc][_0x436862(0x104)]=_0x58c17b;}),_0x29c464[_0x41a5fb(0xf9)]((_0x56c674,_0x423ded)=>{var _0x35c57a=_0x41a5fb;_0x17a9c9[_0x423ded][_0x35c57a(0x190)]=_0x56c674;}),_0x3e56a6[_0x41a5fb(0xf9)]((_0x52b3af,_0xa9e479)=>{var _0x362106=_0x41a5fb;_0x17a9c9[_0xa9e479][_0x362106(0xf1)]=_0x52b3af;}),_0x3cae7f[_0x41a5fb(0xf9)]((_0x13c481,_0x359ff4)=>{_0x17a9c9[_0x359ff4]['production_date']=_0x13c481;}),_0xe0299a['forEach']((_0x53da22,_0x2f1472)=>{var _0x187da7=_0x41a5fb;_0x17a9c9[_0x2f1472][_0x187da7(0xe4)]=_0x53da22;}),_0x4fa460[_0x41a5fb(0xf9)]((_0x4046d9,_0x3903e4)=>{var _0x3e5217=_0x41a5fb;_0x17a9c9[_0x3903e4][_0x3e5217(0x103)]=_0x4046d9;}),_0x1639af[_0x41a5fb(0xf9)]((_0x5a6399,_0x2b3f8c)=>{var _0x3386f1=_0x41a5fb;_0x17a9c9[_0x2b3f8c][_0x3386f1(0xf4)]=_0x5a6399;}),_0x4cc30c['forEach']((_0x313bc8,_0x3199e1)=>{var _0x265c1f=_0x41a5fb;_0x17a9c9[_0x3199e1][_0x265c1f(0x174)]=_0x313bc8;}),_0x1c388f[_0x41a5fb(0xf9)]((_0x33313c,_0x245c21)=>{var _0x2ec5a6=_0x41a5fb;_0x17a9c9[_0x245c21][_0x2ec5a6(0x124)]=_0x33313c;});const _0x33da2f=_0x17a9c9[_0x41a5fb(0x136)](_0x33f931=>_0x33f931[_0x41a5fb(0x125)]!=='0'&&_0x33f931[_0x41a5fb(0x125)]!==''||_0x33f931[_0x41a5fb(0xe5)]!=='0'&&_0x33f931[_0x41a5fb(0xe5)]!=='');var _0x100b38=0x0;_0x33da2f[_0x41a5fb(0xf9)](_0x3686b1=>{var _0x52334f=_0x41a5fb;parseInt(_0x3686b1['from_quantity'])<parseInt(_0x3686b1[_0x52334f(0x125)])&&_0x100b38++;});if(_0x100b38!=0x0)return _0x4de9c6['flash']('errors',_0x41a5fb(0xed)),_0x5e1105['redirect'](_0x41a5fb(0x165));const _0x3009f9=new transfers_finished({'date':_0x9bb5b7,'from_warehouse':_0x1843d9,'to_warehouse':_0x488a6a,'product':_0x33da2f,'note':_0x346e4,'invoice':_0x39a1a2}),_0x44ccac=await _0x3009f9[_0x41a5fb(0xc0)]();_0x4de9c6[_0x41a5fb(0xe1)](_0x41a5fb(0xca),_0x41a5fb(0x139)),_0x5e1105[_0x41a5fb(0xc2)]('/transfer_finished/preview/'+_0x44ccac['_id']);}catch(_0x4edd11){console['log'](_0x4edd11),_0x5e1105[_0x41a5fb(0x119)](0xc8)[_0x41a5fb(0x16c)]({'errorMessage':_0x4edd11['message']});}}),router[a0_0x180469(0x138)](a0_0x180469(0xcd),auth,async(_0x52903b,_0xa78688)=>{var _0x2be06a=a0_0x180469;try{const {username:_0x503d6f,email:_0x589905,role:_0x39f1c3}=_0x52903b[_0x2be06a(0xdd)],_0x558125=_0x52903b[_0x2be06a(0xdd)],_0x2dfdf4=await profile['findOne']({'email':_0x558125[_0x2be06a(0x15a)]}),_0xa0480c=await master_shop[_0x2be06a(0x126)](),_0x4ca086=await transfers_finished[_0x2be06a(0x16d)](_0x52903b['params']['id']);let _0x6c1e69;if(_0x558125['role']=='staff'){const _0x269634=await staff['findOne']({'email':_0x558125[_0x2be06a(0x15a)]});_0x6c1e69=await warehouse[_0x2be06a(0x126)]({'status':_0x2be06a(0x183),'name':_0x269634[_0x2be06a(0x12f)],'warehouse_category':_0x2be06a(0xc4)});}else _0x6c1e69=await warehouse[_0x2be06a(0x126)]({'status':'Enabled','warehouse_category':_0x2be06a(0xc4)});const _0x35e2d0=await warehouse['aggregate']([{'$match':{'name':_0x4ca086[_0x2be06a(0x176)],'warehouse_category':_0x2be06a(0xc4)}},{'$unwind':_0x2be06a(0xf7)},{'$group':{'_id':_0x2be06a(0x109),'name':{'$first':_0x2be06a(0x173)},'product_stock':{'$first':_0x2be06a(0xc7)},'bay':{'$first':_0x2be06a(0xdb)},'bin':{'$first':_0x2be06a(0xd2)},'type':{'$first':_0x2be06a(0xda)},'floorlevel':{'$first':_0x2be06a(0x133)},'primary_code':{'$first':_0x2be06a(0xc8)},'secondary_code':{'$first':_0x2be06a(0x155)},'product_code':{'$first':_0x2be06a(0xd1)},'storage':{'$first':_0x2be06a(0x14b)},'rack':{'$first':_0x2be06a(0x184)},'expiry_date':{'$first':_0x2be06a(0x107)},'production_date':{'$first':_0x2be06a(0x12b)},'room':{'$first':'$room'},'warehoue_name':{'$first':'$name'}}}]),_0x1b3bd9=await product[_0x2be06a(0x126)]({});if(_0xa0480c[0x0][_0x2be06a(0x105)]=='English\x20(US)'){var _0x3c06a6=users[_0x2be06a(0x141)];console[_0x2be06a(0x169)](_0x3c06a6);}else{if(_0xa0480c[0x0][_0x2be06a(0x105)]==_0x2be06a(0x102))var _0x3c06a6=users[_0x2be06a(0x102)];else{if(_0xa0480c[0x0][_0x2be06a(0x105)]==_0x2be06a(0x177))var _0x3c06a6=users[_0x2be06a(0x177)];else{if(_0xa0480c[0x0]['language']=='Spanish')var _0x3c06a6=users[_0x2be06a(0x13b)];else{if(_0xa0480c[0x0]['language']==_0x2be06a(0xf8))var _0x3c06a6=users[_0x2be06a(0xf8)];else{if(_0xa0480c[0x0][_0x2be06a(0x105)]=='Portuguese\x20(BR)')var _0x3c06a6=users[_0x2be06a(0xd5)];else{if(_0xa0480c[0x0]['language']==_0x2be06a(0x11d))var _0x3c06a6=users[_0x2be06a(0x11d)];else{if(_0xa0480c[0x0][_0x2be06a(0x105)]==_0x2be06a(0x17b))var _0x3c06a6=users[_0x2be06a(0x11f)];}}}}}}}_0xa78688[_0x2be06a(0x17e)](_0x2be06a(0xfd),{'success':_0x52903b[_0x2be06a(0xe1)](_0x2be06a(0xca)),'errors':_0x52903b[_0x2be06a(0xe1)](_0x2be06a(0x13a)),'role':_0x558125,'profile':_0x2dfdf4,'master_shop':_0xa0480c,'warehouse':_0x6c1e69,'transfer':_0x4ca086,'stock':_0x35e2d0,'unit':_0x1b3bd9,'language':_0x3c06a6});}catch(_0xd7bc4e){console['log'](_0xd7bc4e);}}),router[a0_0x180469(0x167)]('/preview/:id',auth,async(_0x560211,_0x1c5996)=>{var _0x12395a=a0_0x180469;try{const {invoice:_0x1eefd3,from_warehouse:_0x3a51d4,FromRoom_name:_0x1ce723,to_warehouse:_0x30bfd8,ToRoom_name:_0x5a8168}=_0x560211[_0x12395a(0x163)],_0x49887f=await transfers_finished[_0x12395a(0x16d)](_0x560211[_0x12395a(0x180)]['id']),_0x56929b=_0x49887f[_0x12395a(0x166)][_0x12395a(0x135)](async _0x207ded=>{var _0x33620a=_0x12395a;if(_0x207ded[_0x33620a(0x125)]>0x0){var _0x156c00=await warehouse[_0x33620a(0x18b)]({'name':_0x3a51d4,'room':_0x207ded[_0x33620a(0x174)],'warehouse_category':_0x33620a(0xc4)});const _0x369f60=_0x156c00[_0x33620a(0xd0)][_0x33620a(0x135)](_0xfd8512=>{var _0x8f029a=_0x33620a;_0xfd8512[_0x8f029a(0x157)]==_0x207ded[_0x8f029a(0x157)]&&_0xfd8512[_0x8f029a(0x17a)]==_0x207ded[_0x8f029a(0x143)]&&_0xfd8512[_0x8f029a(0xf1)]==_0x207ded[_0x8f029a(0xf1)]&&_0xfd8512[_0x8f029a(0x161)]==_0x207ded[_0x8f029a(0x161)]&&_0xfd8512[_0x8f029a(0x190)]==_0x207ded[_0x8f029a(0x190)]&&_0xfd8512[_0x8f029a(0x182)]==_0x207ded['from_invoice']&&(_0xfd8512[_0x8f029a(0x142)]=_0xfd8512[_0x8f029a(0x142)]-_0x207ded[_0x8f029a(0x125)]);});}return _0x156c00;});Promise[_0x12395a(0x108)](_0x56929b)[_0x12395a(0x156)](async _0x21f3d6=>{var _0x8ff733=_0x12395a;try{for(const _0xca0884 of _0x21f3d6){await _0xca0884[_0x8ff733(0xc0)]();}const _0xb514ef=_0x49887f[_0x8ff733(0x166)][_0x8ff733(0x135)](async _0x49825b=>{var _0x2a27ca=_0x8ff733,_0x3b697a=await warehouse[_0x2a27ca(0x18b)]({'name':_0x30bfd8,'room':_0x49825b['to_room_name']});if(_0x49825b['to_quantity']>0x0){var _0x4a9e95=0x0;const _0x146b80=_0x3b697a['product_details'][_0x2a27ca(0x135)](_0x22307e=>{var _0x865cae=_0x2a27ca;_0x22307e[_0x865cae(0x157)]==_0x49825b['product_name']&&_0x22307e[_0x865cae(0x17a)]==_0x49825b['to_bay']&&_0x22307e[_0x865cae(0xf1)]==_0x49825b[_0x865cae(0xf1)]&&_0x22307e[_0x865cae(0x161)]==_0x49825b[_0x865cae(0x161)]&&_0x22307e[_0x865cae(0x190)]==_0x49825b[_0x865cae(0x190)]&&_0x22307e[_0x865cae(0x182)]==_0x49825b[_0x865cae(0xcb)]&&(_0x22307e['product_stock']=_0x22307e[_0x865cae(0x142)]+_0x49825b[_0x865cae(0x125)],_0x4a9e95++);});_0x4a9e95=='0'&&(_0x3b697a['product_details']=_0x3b697a[_0x2a27ca(0xd0)]['concat']({'product_name':_0x49825b[_0x2a27ca(0x157)],'product_stock':_0x49825b['to_quantity'],'bay':_0x49825b['to_bay'],'product_code':_0x49825b[_0x2a27ca(0x17d)],'primary_code':_0x49825b[_0x2a27ca(0x171)],'secondary_code':_0x49825b['secondary_code'],'expiry_date':_0x49825b[_0x2a27ca(0xf1)],'production_date':_0x49825b[_0x2a27ca(0x161)],'maxProducts':_0x49825b[_0x2a27ca(0xe4)],'batch_code':_0x49825b['batch_code'],'secondary_unit':_0x49825b[_0x2a27ca(0x104)],'unit':_0x49825b[_0x2a27ca(0x11c)],'maxProducts':_0x49825b[_0x2a27ca(0xe4)],'maxPerUnit':_0x49825b[_0x2a27ca(0x103)],'invoice':_0x49825b[_0x2a27ca(0xcb)]}));}return _0x3b697a;});Promise[_0x8ff733(0x108)](_0xb514ef)[_0x8ff733(0x156)](async _0x290dde=>{var _0x40fcc9=_0x8ff733;try{for(const _0x5c3a12 of _0x290dde){await warehouse[_0x40fcc9(0x10b)]({'_id':_0x5c3a12['_id']},{'$addToSet':{'product_details':{'$each':_0x5c3a12[_0x40fcc9(0xd0)]}}});}_0x49887f[_0x40fcc9(0x123)]=_0x40fcc9(0xee);const _0x3df319=await _0x49887f['save'](),_0x355428=await master_shop['find'](),_0x46e36a=await email_settings[_0x40fcc9(0x18b)](),_0x1af4ee=await supervisor_settings[_0x40fcc9(0x126)]();var _0x1841a6=_0x49887f['product'],_0x3c74d5='',_0x3caece;for(_0x3caece in _0x1841a6){var _0x2e7677='FG';_0x49887f[_0x40fcc9(0x11e)]=='DRY\x20GOODS'&&(_0x2e7677='DG'),_0x3c74d5+=_0x40fcc9(0x186)+_0x40fcc9(0x14f)+_0x1841a6[_0x3caece][_0x40fcc9(0x157)]+_0x40fcc9(0x132)+_0x40fcc9(0x14f)+_0x1841a6[_0x3caece]['product_code']+_0x40fcc9(0x132)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1841a6[_0x3caece][_0x40fcc9(0x125)]+_0x40fcc9(0x132)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1841a6[_0x3caece][_0x40fcc9(0x11c)]+_0x40fcc9(0x132)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1841a6[_0x3caece][_0x40fcc9(0x104)]+_0x40fcc9(0x132)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x49887f[_0x40fcc9(0x11e)]+'</td>'+_0x40fcc9(0x14f)+_0x1841a6[_0x3caece][_0x40fcc9(0x124)]+'</td>'+_0x40fcc9(0x14f)+_0x2e7677+_0x1841a6[_0x3caece][_0x40fcc9(0x15d)]+'</td>'+'</tr>';}let _0x10abf2=nodemailer[_0x40fcc9(0x189)]({'host':_0x46e36a[_0x40fcc9(0x168)],'port':Number(_0x46e36a['port']),'secure':![],'auth':{'user':_0x46e36a[_0x40fcc9(0x15a)],'pass':_0x46e36a[_0x40fcc9(0x175)]}}),_0x314c67={'from':_0x46e36a[_0x40fcc9(0x15a)],'to':_0x1af4ee[0x0]['FGSEmail'],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x40fcc9(0xcf),'path':__dirname+'/../public'+_0x40fcc9(0x14d)+_0x355428[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x40fcc9(0xe8)+_0x40fcc9(0xd4)+'<div>'+_0x40fcc9(0x18c)+_0x40fcc9(0x14c)+_0x40fcc9(0xff)+_0x40fcc9(0x101)+_0x40fcc9(0x14c)+_0x40fcc9(0xd9)+_0x355428[0x0][_0x40fcc9(0x191)]+_0x40fcc9(0x127)+_0x40fcc9(0x101)+_0x40fcc9(0x101)+_0x40fcc9(0xe7)+_0x40fcc9(0x14c)+_0x40fcc9(0x170)+'\x20Order\x20Number\x20:\x20'+_0x49887f[_0x40fcc9(0x182)]+'\x20'+_0x40fcc9(0x120)+_0x40fcc9(0xdc)+_0x49887f[_0x40fcc9(0xf2)]+'\x20'+_0x40fcc9(0xd3)+_0x40fcc9(0xbf)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x40fcc9(0x106)+'<tr>'+_0x40fcc9(0x16a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x40fcc9(0x18d)+_0x40fcc9(0xd6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x40fcc9(0xe0)+'</thead>'+_0x40fcc9(0x13f)+'\x20'+_0x3c74d5+'\x20'+_0x40fcc9(0x192)+'</table>'+_0x40fcc9(0x14c)+_0x40fcc9(0x15b)+_0x40fcc9(0x144)+_0x355428[0x0]['site_title']+_0x40fcc9(0xbf)+'</div>'+_0x40fcc9(0x101)+_0x40fcc9(0xcc)};_0x10abf2[_0x40fcc9(0xef)](_0x314c67,function(_0x511e80,_0x46299b){var _0x5771c1=_0x40fcc9;_0x511e80?(console[_0x5771c1(0x169)](_0x511e80),console['log'](_0x5771c1(0x14a))):console[_0x5771c1(0x169)](_0x5771c1(0xf0));}),_0x560211[_0x40fcc9(0xe1)](_0x40fcc9(0xca),_0x40fcc9(0xde)),_0x1c5996[_0x40fcc9(0xc2)]('/picking_list/PDF_transfer/'+_0x3df319['_id']);}catch(_0x5d3fe2){console['error'](_0x5d3fe2),_0x1c5996[_0x40fcc9(0x119)](0x1f4)['json']({'error':_0x40fcc9(0x18e)});}})[_0x8ff733(0x11b)](_0x433f9b=>{var _0x5debac=_0x8ff733;console[_0x5debac(0xe9)](_0x433f9b),_0x1c5996['status'](0x1f4)[_0x5debac(0x16c)]({'error':_0x5debac(0x114)});});}catch(_0x40f401){console[_0x8ff733(0xe9)](_0x40f401),_0x1c5996[_0x8ff733(0x119)](0x1f4)[_0x8ff733(0x16c)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x12395a(0x11b)](_0x1a6f77=>{var _0x289e82=_0x12395a;console[_0x289e82(0xe9)](_0x1a6f77),_0x1c5996['status'](0x1f4)[_0x289e82(0x16c)]({'error':_0x289e82(0x114)});});}catch(_0x46f79f){_0x1c5996[_0x12395a(0x16c)]({'message':_0x46f79f['message']});}});function BayBinSelected(_0x4200f8,_0x113b05){var _0x27803f=a0_0x180469,_0xfbd66c=[];let _0x3d7499=[];var _0x518dc2=[];if(_0x4200f8==_0x27803f(0x185)){switch(_0x113b05){case'Rack\x201':_0xfbd66c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x27803f(0x10d):_0xfbd66c=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x518dc2=['DG'];}else{if(_0x4200f8=='FROZEN\x20GOODS'){switch(_0x113b05){case _0x27803f(0x162):_0xfbd66c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x27803f(0x10d):_0xfbd66c=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x518dc2=['FG'];}}return{'levels':_0xfbd66c,'identify':_0x518dc2};}function a0_0x47e6(_0x43d42c,_0x525223){var _0x13fd9b=a0_0x13fd();return a0_0x47e6=function(_0x47e6fc,_0x190117){_0x47e6fc=_0x47e6fc-0xbe;var _0x7e7fdc=_0x13fd9b[_0x47e6fc];return _0x7e7fdc;},a0_0x47e6(_0x43d42c,_0x525223);}function a0_0x13fd(){var _0x5d3fc1=['To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','There\x27s\x20a\x20error\x20in\x20this\x20transaction','batch_code','site_title','</tbody>','from_room','</h5>','save','staff','redirect','$date','Finished\x20Goods','RoomAssigned','$name','$product_details.product_stock','$product_details.primary_code','19255XVOgcA','success','To_invoice','</body></html>','/preview/:id','role','Logo.png','product_details','$product_details.product_code','$product_details.bin','</span>','</head><body>','Portuguese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/barcode_scanner3','$from_warehouse','<h2>\x20','$product_details.type','$product_details.bay','\x20Order\x20Date\x20:\x20','user','Transfer\x20Finalize\x20Successfully','$product','</tr>','flash','to_prod_qty','$product.from_room_name','maxProducts','to_floorlevel','652771ISwCer','<hr\x20class=\x22my-3\x22>','<html><head><title></title>','error','../models/all_models','length','concat','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','True','sendMail','Email\x20sent\x20successfully','expiry_date','date','push','prod_cat','add_transfer_finished','aggregate','$product_details','French','forEach','Portuguese\x20(BR)','158266douosJ','nodemailer','edit_transfer_finished_view','express','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$_id','</div>','Hindi','maxPerUnit','secondary_unit','language','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.expiry_date','all','$product_details._id','/view/add_transfer','updateOne','product_code3','Rack\x202','$finalize','New_Qty_Converted','../public/language/languages.json','to_prod_level','TRFF-','$invoice','An\x20error\x20occurred.','from_quantity','6VCscxU','getFullYear','/transfer/view','status','transfer_data','catch','unit','Chinese','to_warehouse','Arabic','<span\x20style=\x22float:\x20right;\x22>','to_invoice','padStart','finalize','to_room_name','to_quantity','find','\x20</h2>','5377273mfPkxH','/CheckingWarehouse','$product_details.unit','$product_details.production_date','$product_details.secondary_unit','822gevHnY','$product_details.batch_code','warehouse','QA\x20Warehouse','$product_details.invoice','</td>','$product_details.floorlevel','$product_details.maxPerUnit','map','filter','MaxStocks_data2','get','Product\x20Transfer\x20successfully','errors','Spanish','from_prod_level','$product_details.pallet','prod_name','<tbody\x20style=\x22text-align:\x20center;\x22>','148868JjEaqb','English','product_stock','from_bay','<h5>','random','MaxStocks_data','12ZGuDbH','getMonth','24OWBvQJ','Error\x20Occurs','$product_details.storage','<div>','/upload/','transfer_finished','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','from_prod_qty','product_date','$product_details.isle','$product.to_room_name','message','$product_details.secondary_code','then','product_name','from_invoice','note','email','<strong>\x20Regards\x20</strong>','/view/:id','to_bay','to_room','floor','/transfer_finished/view','production_date','Rack\x201','body','/barcode_scanner2','back','product','post','host','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','10065679IRUhJZ','json','findById','../middleware/auth','10QDXvOY','<h5\x20style=\x22text-align:\x20left;\x22>','primary_code','$product_details.level','$product_details.product_name','from_room_name','password','from_warehouse','German','6jSeXjL','3073374yAtkbh','bay','Arabic\x20(ae)','$to_warehouse','product_code','render','$product_details.maxProducts','params','English\x20(US)','invoice','Enabled','$product_details.rack','DRY\x20GOODS','<tr>','split','ToRoomAssigned','createTransport','secondary_code','findOne','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'];a0_0x13fd=function(){return _0x5d3fc1;};return a0_0x13fd();}router[a0_0x180469(0x138)](a0_0x180469(0x15c),auth,async(_0x1ba966,_0x5bee03)=>{var _0x241ad3=a0_0x180469;try{const {username:_0x4a4a33,email:_0x117849,role:_0x58d1fc}=_0x1ba966[_0x241ad3(0xdd)],_0x5c9ac2=_0x1ba966['user'],_0x3fbc45=await profile['findOne']({'email':_0x5c9ac2[_0x241ad3(0x15a)]}),_0x5b98f3=await master_shop['find'](),_0x2f0180=await transfers_finished['findById'](_0x1ba966['params']['id']);let _0x355240=new Date(_0x2f0180[_0x241ad3(0xf1)]),_0x5a84e3=('0'+_0x355240['getDate']())['slice'](-0x2),_0x4e65f4=('0'+(_0x355240[_0x241ad3(0x148)]()+0x1))['slice'](-0x2),_0x52531c=_0x355240[_0x241ad3(0x117)](),_0x35b7ca=_0x52531c+'-'+_0x4e65f4+'-'+_0x5a84e3,_0xf2efc6;if(_0x5c9ac2[_0x241ad3(0xce)]==_0x241ad3(0xc1)){const _0x4faa50=await staff['findOne']({'email':_0x5c9ac2[_0x241ad3(0x15a)]});_0xf2efc6=await warehouse[_0x241ad3(0x126)]({'status':_0x241ad3(0x183),'name':_0x4faa50[_0x241ad3(0x12f)],'warehouse_category':_0x241ad3(0xc4)});}else _0xf2efc6=await warehouse[_0x241ad3(0x126)]({'status':_0x241ad3(0x183),'warehouse_category':_0x241ad3(0xc4)});const _0x595de6=await warehouse[_0x241ad3(0xf6)]([{'$match':{'name':_0x2f0180['from_warehouse'],'room':_0x2f0180[_0x241ad3(0xbe)]}},{'$unwind':_0x241ad3(0xf7)},{'$group':{'_id':_0x241ad3(0x109),'name':{'$first':_0x241ad3(0x173)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x241ad3(0xdb)},'bin':{'$first':_0x241ad3(0xd2)},'type':{'$first':_0x241ad3(0xda)},'floorlevel':{'$first':_0x241ad3(0x133)},'primary_code':{'$first':_0x241ad3(0xc8)},'secondary_code':{'$first':_0x241ad3(0x155)},'product_code':{'$first':_0x241ad3(0xd1)},'storage':{'$first':_0x241ad3(0x14b)},'rack':{'$first':_0x241ad3(0x184)}}}]);var _0x3100d3=[0x1,0x2,0x3,0x4],_0x4cfa8c=['A','B','C','D','E','F','G','H','I','J'],_0x2c66ac=['Ambient','Enclosed'];const _0x46515e=await product[_0x241ad3(0x126)]({}),_0x1fe46c=BayBinSelected(_0x2f0180[_0x241ad3(0x11e)],_0x2f0180[_0x241ad3(0x15e)]);if(_0x5b98f3[0x0][_0x241ad3(0x105)]=='English\x20(US)'){var _0x30f1be=users[_0x241ad3(0x141)];console[_0x241ad3(0x169)](_0x30f1be);}else{if(_0x5b98f3[0x0][_0x241ad3(0x105)]==_0x241ad3(0x102))var _0x30f1be=users[_0x241ad3(0x102)];else{if(_0x5b98f3[0x0][_0x241ad3(0x105)]==_0x241ad3(0x177))var _0x30f1be=users[_0x241ad3(0x177)];else{if(_0x5b98f3[0x0][_0x241ad3(0x105)]=='Spanish')var _0x30f1be=users['Spanish'];else{if(_0x5b98f3[0x0][_0x241ad3(0x105)]==_0x241ad3(0xf8))var _0x30f1be=users[_0x241ad3(0xf8)];else{if(_0x5b98f3[0x0]['language']=='Portuguese\x20(BR)')var _0x30f1be=users['Portuguese'];else{if(_0x5b98f3[0x0]['language']=='Chinese')var _0x30f1be=users['Chinese'];else{if(_0x5b98f3[0x0][_0x241ad3(0x105)]==_0x241ad3(0x17b))var _0x30f1be=users[_0x241ad3(0x11f)];}}}}}}}_0x5bee03[_0x241ad3(0x17e)]('edit_transfer_finished',{'success':_0x1ba966[_0x241ad3(0xe1)]('success'),'errors':_0x1ba966[_0x241ad3(0xe1)]('errors'),'role':_0x5c9ac2,'profile':_0x3fbc45,'master_shop':_0x5b98f3,'warehouse':_0xf2efc6,'transfer':_0x2f0180,'stock':_0x595de6,'unit':_0x46515e,'language':_0x30f1be,'levels':_0x3100d3,'Isle':_0x4cfa8c,'rooms_data':_0x2c66ac,'ed_fullDate':_0x35b7ca,'dataSelected':_0x1fe46c});}catch(_0x5d8fc6){console['log'](_0x5d8fc6);}}),router[a0_0x180469(0x167)](a0_0x180469(0x15c),auth,async(_0x23aa93,_0x17a8dc)=>{var _0x59ba15=a0_0x180469;try{const _0x178174=_0x23aa93[_0x59ba15(0x180)]['id'];console['log'](_0x23aa93[_0x59ba15(0x163)]);const _0x2e7d0b=await transfers_finished[_0x59ba15(0x16d)](_0x178174);console[_0x59ba15(0x169)](_0x59ba15(0x11a),_0x2e7d0b);const {date:_0x59ce7e,from_warehouse:_0x28918a,FromRoom_name:_0x1199ee,to_warehouse:_0x1acae0,ToRoom_name:_0x2667b9,prod_name:_0x17ce20,from_prod_qty:_0x37a14b,from_prod_level:_0x4c37b0,from_prod_isle:_0x1ccc8e,from_prod_pallet:_0x5bb5c7,to_prod_qty:_0x279009,to_prod_level:_0x12416d,to_prod_isle:_0x28da4b,to_prod_pallet:_0x2c13bd,primary_code:_0x238999,secondary_code:_0x43c7d3,product_code3:_0x479840,note:_0x1d71de,invoice:_0x35b024,expiry_date:_0x1130aa}=_0x23aa93[_0x59ba15(0x163)];if(typeof _0x17ce20=='string')var _0x2ad1fc=[_0x23aa93['body'][_0x59ba15(0x13e)]],_0x4b1772=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x150)]],_0x3a9b0e=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x13c)]],_0x473164=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0xe2)]],_0x4c4930=[_0x23aa93[_0x59ba15(0x163)]['to_prod_level']],_0x932c03=[_0x23aa93[_0x59ba15(0x163)]['primary_code']],_0x169fe1=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x18a)]],_0x3ae5ba=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x10c)]],_0x18957b=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x137)]],_0x456e24=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x11c)]],_0x1ca009=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x104)]],_0x3c98ff=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x190)]],_0x3e06c8=[_0x23aa93[_0x59ba15(0x163)][_0x59ba15(0xf1)]];else var _0x2ad1fc=[..._0x23aa93['body']['prod_name']],_0x4b1772=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x150)]],_0x3a9b0e=[..._0x23aa93[_0x59ba15(0x163)]['from_prod_level']],_0x473164=[..._0x23aa93[_0x59ba15(0x163)]['to_prod_qty']],_0x4c4930=[..._0x23aa93[_0x59ba15(0x163)]['to_prod_level']],_0x932c03=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x171)]],_0x169fe1=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x18a)]],_0x3ae5ba=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x10c)]],_0x18957b=[..._0x23aa93[_0x59ba15(0x163)]['MaxStocks_data2']],_0x456e24=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x11c)]],_0x1ca009=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0x104)]],_0x3c98ff=[..._0x23aa93[_0x59ba15(0x163)]['batch_code']],_0x3e06c8=[..._0x23aa93[_0x59ba15(0x163)][_0x59ba15(0xf1)]];const _0x5f5722=_0x2ad1fc[_0x59ba15(0x135)](_0x4f0c7d=>{return _0x4f0c7d={'product_name':_0x4f0c7d};});_0x4b1772['forEach']((_0x37a456,_0x2d8da1)=>{var _0x3352f0=_0x59ba15;_0x5f5722[_0x2d8da1][_0x3352f0(0x115)]=_0x37a456;}),_0x3a9b0e[_0x59ba15(0xf9)]((_0x357889,_0x2dfd25)=>{_0x5f5722[_0x2dfd25]['from_bay']=_0x357889;}),_0x473164[_0x59ba15(0xf9)]((_0x2f189c,_0x512b62)=>{var _0x4f0936=_0x59ba15;_0x5f5722[_0x512b62][_0x4f0936(0x125)]=_0x2f189c;}),_0x4c4930[_0x59ba15(0xf9)]((_0x32a6e0,_0x3b552e)=>{var _0x4274c8=_0x59ba15;_0x5f5722[_0x3b552e][_0x4274c8(0x15d)]=_0x32a6e0;}),_0x932c03[_0x59ba15(0xf9)]((_0x5d81b4,_0x33d9ff)=>{var _0x3f8126=_0x59ba15;_0x5f5722[_0x33d9ff][_0x3f8126(0x171)]=_0x5d81b4;}),_0x169fe1['forEach']((_0x214012,_0x58f3d2)=>{var _0x23b54f=_0x59ba15;_0x5f5722[_0x58f3d2][_0x23b54f(0x18a)]=_0x214012;}),_0x3ae5ba[_0x59ba15(0xf9)]((_0x1a2d57,_0x568279)=>{_0x5f5722[_0x568279]['product_code']=_0x1a2d57;}),_0x18957b[_0x59ba15(0xf9)]((_0x4f4305,_0x117f78)=>{var _0x6aaafb=_0x59ba15;_0x5f5722[_0x117f78][_0x6aaafb(0xe4)]=_0x4f4305;}),_0x456e24['forEach']((_0x226b33,_0x551f45)=>{var _0x37cf1a=_0x59ba15;_0x5f5722[_0x551f45][_0x37cf1a(0x11c)]=_0x226b33;}),_0x1ca009[_0x59ba15(0xf9)]((_0x4eb533,_0x16e3ce)=>{var _0x13957c=_0x59ba15;_0x5f5722[_0x16e3ce][_0x13957c(0x104)]=_0x4eb533;}),_0x3c98ff[_0x59ba15(0xf9)]((_0x2eb273,_0x574ac6)=>{var _0x366169=_0x59ba15;_0x5f5722[_0x574ac6][_0x366169(0x190)]=_0x2eb273;}),_0x3e06c8[_0x59ba15(0xf9)]((_0x2e01f4,_0x175db2)=>{_0x5f5722[_0x175db2]['expiry_date']=_0x2e01f4;});const _0x41a3db=_0x5f5722[_0x59ba15(0x136)](_0x116565=>_0x116565[_0x59ba15(0x125)]!=='0'&&_0x116565[_0x59ba15(0x125)]!==''||_0x116565['to_floorlevel']!=='0'&&_0x116565[_0x59ba15(0xe5)]!=='');var _0x4aefd2=0x0;_0x41a3db[_0x59ba15(0xf9)](_0x46e070=>{var _0x168cbc=_0x59ba15;parseInt(_0x46e070[_0x168cbc(0x115)])<parseInt(_0x46e070[_0x168cbc(0x125)])&&_0x4aefd2++;});if(_0x4aefd2!=0x0)return _0x23aa93[_0x59ba15(0xe1)](_0x59ba15(0x13a),_0x59ba15(0xed)),_0x17a8dc['redirect'](_0x59ba15(0x165));const _0x7bc9cf=await warehouse['findOne']({'name':_0x2e7d0b[_0x59ba15(0x176)],'room':_0x2e7d0b['from_room']});_0x2e7d0b[_0x59ba15(0x166)][_0x59ba15(0xf9)](_0x1ce27a=>{var _0x3e84d4=_0x59ba15;if(_0x1ce27a['to_quantity']>0x0){const _0x371acf=_0x7bc9cf['product_details'][_0x3e84d4(0x135)](_0x8b3154=>{var _0xe2efcb=_0x3e84d4;_0x8b3154[_0xe2efcb(0x157)]==_0x1ce27a[_0xe2efcb(0x157)]&&_0x8b3154['bay']==_0x1ce27a[_0xe2efcb(0x143)]&&(_0x8b3154[_0xe2efcb(0x142)]=parseInt(_0x8b3154[_0xe2efcb(0x142)])+parseInt(_0x1ce27a[_0xe2efcb(0x125)]));});}}),await _0x7bc9cf[_0x59ba15(0xc0)]();const _0x23fb6c=await warehouse[_0x59ba15(0x18b)]({'name':_0x2e7d0b[_0x59ba15(0x11e)],'room':_0x2e7d0b[_0x59ba15(0x15e)]});_0x2e7d0b[_0x59ba15(0x166)][_0x59ba15(0xf9)](_0x1d6a9d=>{var _0x145acf=_0x59ba15;if(_0x1d6a9d[_0x145acf(0x125)]>0x0){const _0x17f3f7=_0x23fb6c[_0x145acf(0xd0)]['map'](_0x42a46c=>{var _0x198c87=_0x145acf;_0x42a46c['product_name']==_0x1d6a9d[_0x198c87(0x157)]&&_0x42a46c[_0x198c87(0x17a)]==_0x1d6a9d['to_bay']&&(_0x42a46c[_0x198c87(0x142)]=parseInt(_0x42a46c['product_stock'])-parseInt(_0x1d6a9d['to_quantity']));});}}),await _0x23fb6c['save'](),_0x2e7d0b[_0x59ba15(0xf2)]=_0x59ce7e,_0x2e7d0b[_0x59ba15(0x176)]=_0x28918a,_0x2e7d0b[_0x59ba15(0x11e)]=_0x1acae0,_0x2e7d0b[_0x59ba15(0x166)]=_0x41a3db,_0x2e7d0b[_0x59ba15(0x159)]=_0x1d71de,_0x2e7d0b[_0x59ba15(0x182)]=_0x35b024;const _0x53d5e7=await _0x2e7d0b[_0x59ba15(0xc0)](),_0x5cbe41=await warehouse['findOne']({'name':_0x28918a,'room':_0x1199ee});_0x53d5e7[_0x59ba15(0x166)][_0x59ba15(0xf9)](_0x12c936=>{var _0x43d511=_0x59ba15;if(_0x12c936[_0x43d511(0x125)]>0x0){const _0x30feb6=_0x5cbe41[_0x43d511(0xd0)][_0x43d511(0x135)](_0x6df8ab=>{var _0x4abfd1=_0x43d511;_0x6df8ab['product_name']==_0x12c936[_0x4abfd1(0x157)]&&_0x6df8ab[_0x4abfd1(0x17a)]==_0x12c936[_0x4abfd1(0x143)]&&(_0x6df8ab[_0x4abfd1(0x142)]=parseInt(_0x6df8ab[_0x4abfd1(0x142)])-parseInt(_0x12c936[_0x4abfd1(0x125)]));});}}),await _0x5cbe41[_0x59ba15(0xc0)]();const _0x452a1d=await warehouse[_0x59ba15(0x18b)]({'name':_0x1acae0,'room':_0x2667b9});_0x53d5e7[_0x59ba15(0x166)]['forEach'](_0x53fac8=>{var _0x5376c6=_0x59ba15;if(_0x53fac8['to_quantity']>0x0){var _0x28f111=0x0;const _0x3db1c2=_0x452a1d[_0x5376c6(0xd0)][_0x5376c6(0x135)](_0x245e0b=>{var _0x1b9c1a=_0x5376c6;_0x245e0b[_0x1b9c1a(0x157)]==_0x53fac8[_0x1b9c1a(0x157)]&&_0x245e0b[_0x1b9c1a(0x17a)]==_0x53fac8[_0x1b9c1a(0x15d)]&&(_0x245e0b[_0x1b9c1a(0x142)]=parseInt(_0x245e0b['product_stock'])+parseInt(_0x53fac8['to_quantity']),_0x28f111++);});_0x28f111=='0'&&(_0x452a1d[_0x5376c6(0xd0)]=_0x452a1d[_0x5376c6(0xd0)][_0x5376c6(0xec)]({'product_name':_0x53fac8[_0x5376c6(0x157)],'product_stock':_0x53fac8[_0x5376c6(0x125)],'bay':_0x53fac8['to_bay'],'product_code':_0x53fac8['product_code'],'primary_code':_0x53fac8[_0x5376c6(0x171)],'secondary_code':_0x53fac8[_0x5376c6(0x18a)],'maxProducts':_0x53fac8[_0x5376c6(0xe4)]}));}}),await _0x452a1d[_0x59ba15(0xc0)](),_0x23aa93[_0x59ba15(0xe1)](_0x59ba15(0xca),'Transfer\x20Edit\x20Successfully'),_0x17a8dc[_0x59ba15(0xc2)](_0x59ba15(0x160));}catch(_0x5d548f){console[_0x59ba15(0x169)](_0x5d548f);}}),router['post']('/barcode_scanner',async(_0x524073,_0x444e1)=>{var _0x26981b=a0_0x180469;const {FromWareHouse:_0x52cc46,FromRoom:_0x137443,ToWarehouse:_0x471230,ToRoom:_0x4f7d25,primary_code:_0x591c4c,Roomslist:_0xc1d3f3}=_0x524073[_0x26981b(0x163)],_0x3f14bc=_0xc1d3f3[_0x26981b(0x187)](','),_0x4fa972=[];async function _0x312628(_0x265060){var _0x131be5=_0x26981b;const _0x2ad1dc=await warehouse[_0x131be5(0xf6)]([{'$match':{'name':_0x52cc46,'room':_0x265060}},{'$unwind':_0x131be5(0xf7)},{'$match':{'product_details.primary_code':_0x591c4c}},{'$group':{'_id':_0x131be5(0x109),'name':{'$first':_0x131be5(0x173)},'instock':{'$first':_0x131be5(0xc7)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x131be5(0xd1)},'level':{'$first':_0x131be5(0xdb)},'isle':{'$first':_0x131be5(0xd2)},'type':{'$first':_0x131be5(0xda)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x131be5(0x12c)},'storage':{'$first':_0x131be5(0x14b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x131be5(0x107)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x131be5(0x12e)},'maxPerUnit':{'$first':_0x131be5(0x134)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4801e8=await warehouse['aggregate']([{'$match':{'name':_0x52cc46,'room':_0x265060}},{'$unwind':_0x131be5(0xf7)},{'$match':{'product_details.secondary_code':_0x591c4c}},{'$group':{'_id':_0x131be5(0x109),'name':{'$first':_0x131be5(0x173)},'instock':{'$first':_0x131be5(0xc7)},'primary_code':{'$first':_0x131be5(0xc8)},'secondary_code':{'$first':_0x131be5(0x155)},'product_code':{'$first':_0x131be5(0xd1)},'level':{'$first':_0x131be5(0xdb)},'isle':{'$first':_0x131be5(0xd2)},'type':{'$first':_0x131be5(0xda)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x131be5(0x12a)},'secondary_unit':{'$first':_0x131be5(0x12c)},'storage':{'$first':_0x131be5(0x14b)},'rack':{'$first':_0x131be5(0x184)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x131be5(0x12b)},'batch_code':{'$first':_0x131be5(0x12e)},'maxPerUnit':{'$first':_0x131be5(0x134)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x131be5(0x131)}}}]);if(_0x2ad1dc[_0x131be5(0xeb)]>0x0)_0x4fa972['push'](_0x2ad1dc);else _0x4801e8[_0x131be5(0xeb)]>0x0&&_0x4fa972[_0x131be5(0xf3)](_0x4801e8);}const _0x1dfff2=_0x3f14bc[_0x26981b(0x135)](_0x37bec4=>_0x312628(_0x37bec4));await Promise[_0x26981b(0x108)](_0x1dfff2),_0x444e1[_0x26981b(0x16c)](_0x4fa972);}),router['post'](a0_0x180469(0x164),async(_0x5399cb,_0x481571)=>{var _0x3761b4=a0_0x180469;try{const {FromWareHouse:_0x3f6766,FromRoom:_0x444eae,ToWarehouse:_0x52d75d,ToRoom:_0x21e4d3,secondary_code:_0x411dc4}=_0x5399cb[_0x3761b4(0x163)],_0x3aa96a=await warehouse[_0x3761b4(0xf6)]([{'$match':{'name':_0x3f6766}},{'$unwind':_0x3761b4(0xf7)},{'$match':{'product_details.secondary_code':_0x411dc4}},{'$group':{'_id':_0x3761b4(0x109),'name':{'$first':_0x3761b4(0x173)},'primary_code':{'$first':_0x3761b4(0xc8)},'secondary_code':{'$first':_0x3761b4(0x155)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x3761b4(0xc7)},'warehouse':{'$first':_0x3761b4(0xc6)},'level':{'$first':_0x3761b4(0x172)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x3761b4(0x13d)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x3761b4(0x12a)},'expiry_date':{'$first':_0x3761b4(0x107)},'production_date':{'$first':_0x3761b4(0x12b)}}}]);_0x481571[_0x3761b4(0x119)](0xc8)['json'](_0x3aa96a);}catch(_0x1df050){_0x481571[_0x3761b4(0x119)](0x194)[_0x3761b4(0x16c)]({'message':_0x1df050[_0x3761b4(0x154)]});}}),router[a0_0x180469(0x167)](a0_0x180469(0xd7),async(_0x5a7e49,_0x13acaa)=>{var _0x53cbe9=a0_0x180469;try{const {FromWareHouse:_0x302953,FromRoom:_0x38433f,ToWarehouse:_0x451fd9,ToRoom:_0x3206e8,product_code:_0x31c8b5}=_0x5a7e49[_0x53cbe9(0x163)],_0x5ee1ea=await warehouse['aggregate']([{'$match':{'name':_0x302953}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x31c8b5}},{'$group':{'_id':_0x53cbe9(0x109),'name':{'$first':_0x53cbe9(0x173)},'primary_code':{'$first':_0x53cbe9(0xc8)},'secondary_code':{'$first':_0x53cbe9(0x155)},'product_code':{'$first':_0x53cbe9(0xd1)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x53cbe9(0x152)},'pallet':{'$first':_0x53cbe9(0x13d)},'maxProducts':{'$first':_0x53cbe9(0x17f)},'unit':{'$first':_0x53cbe9(0x12a)}}}]);_0x13acaa['status'](0xc8)[_0x53cbe9(0x16c)](_0x5ee1ea);}catch(_0x2c16d8){_0x13acaa[_0x53cbe9(0x119)](0x194)[_0x53cbe9(0x16c)]({'message':_0x2c16d8[_0x53cbe9(0x154)]});}}),router[a0_0x180469(0x167)](a0_0x180469(0x129),async(_0x38ea87,_0x150e0c)=>{var _0x13e1cc=a0_0x180469;const {productCode:_0x16d952,bay:_0x44e5f0,warehouses:_0x547d28,room:_0x42256f}=_0x38ea87[_0x13e1cc(0x163)];console['log'](_0x38ea87['body']);try{const _0x1a65bb=await warehouse[_0x13e1cc(0xf6)]([{'$match':{'name':_0x547d28,'room':_0x42256f}},{'$unwind':_0x13e1cc(0xf7)},{'$match':{'product_details.bay':parseInt(_0x44e5f0)}},{'$group':{'_id':_0x13e1cc(0x109),'name':{'$first':_0x13e1cc(0x173)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x13e1cc(0xdb)},'maxProducts':{'$first':_0x13e1cc(0x17f)}}}]);_0x150e0c[_0x13e1cc(0x119)](0xc8)[_0x13e1cc(0x16c)](_0x1a65bb);}catch(_0x8b5540){_0x150e0c[_0x13e1cc(0x119)](0x194)[_0x13e1cc(0x16c)]({'message':_0x8b5540['message']});}}),module['exports']=router;