var a0_0x3ca044=a0_0x3d5e;(function(_0x2eb3e2,_0x2dcced){var _0xd2ad80=a0_0x3d5e,_0x3f81ff=_0x2eb3e2();while(!![]){try{var _0x4eaa11=-parseInt(_0xd2ad80(0x196))/0x1*(-parseInt(_0xd2ad80(0x160))/0x2)+parseInt(_0xd2ad80(0xf0))/0x3+-parseInt(_0xd2ad80(0xdb))/0x4*(parseInt(_0xd2ad80(0x112))/0x5)+parseInt(_0xd2ad80(0x14d))/0x6+-parseInt(_0xd2ad80(0x185))/0x7+parseInt(_0xd2ad80(0xeb))/0x8*(parseInt(_0xd2ad80(0xf8))/0x9)+-parseInt(_0xd2ad80(0x158))/0xa*(parseInt(_0xd2ad80(0x16a))/0xb);if(_0x4eaa11===_0x2dcced)break;else _0x3f81ff['push'](_0x3f81ff['shift']());}catch(_0x2670f7){_0x3f81ff['push'](_0x3f81ff['shift']());}}}(a0_0x502f,0xd72c8));const express=require('express'),app=express(),router=express[a0_0x3ca044(0x190)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x3ca044(0x194)),auth=require(a0_0x3ca044(0x15c)),users=require(a0_0x3ca044(0x109)),nodemailer=require('nodemailer');router['get']('/view',auth,async(_0x2dbe38,_0x343968)=>{var _0x385427=a0_0x3ca044;try{const {username:_0x51d5bb,email:_0x219465,role:_0x563d38}=_0x2dbe38[_0x385427(0x11b)],_0xde6890=_0x2dbe38['user'],_0x3d9061=await profile['findOne']({'email':_0xde6890['email']}),_0x555175=await master_shop[_0x385427(0x19d)]();let _0x27642a;if(_0xde6890['role']==_0x385427(0xea)){const _0x25668f=await staff[_0x385427(0xcd)]({'email':_0xde6890[_0x385427(0x104)]});_0x27642a=await transfers_finished[_0x385427(0x19d)]({'from_warehouse':_0x25668f[_0x385427(0x157)]});}else _0x27642a=await transfers_finished[_0x385427(0x17c)]([{'$unwind':_0x385427(0x110)},{'$group':{'_id':_0x385427(0x176),'invoice':{'$first':_0x385427(0xdc)},'date':{'$first':_0x385427(0x152)},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':_0x385427(0x144)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x385427(0x183)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x555175[0x0][_0x385427(0x131)]==_0x385427(0x14c))var _0x30746a=users[_0x385427(0xef)];else{if(_0x555175[0x0]['language']==_0x385427(0xff))var _0x30746a=users['Hindi'];else{if(_0x555175[0x0][_0x385427(0x131)]==_0x385427(0x118))var _0x30746a=users['German'];else{if(_0x555175[0x0][_0x385427(0x131)]==_0x385427(0x115))var _0x30746a=users['Spanish'];else{if(_0x555175[0x0][_0x385427(0x131)]=='French')var _0x30746a=users[_0x385427(0x102)];else{if(_0x555175[0x0][_0x385427(0x131)]=='Portuguese\x20(BR)')var _0x30746a=users[_0x385427(0x191)];else{if(_0x555175[0x0][_0x385427(0x131)]=='Chinese')var _0x30746a=users[_0x385427(0x16b)];else{if(_0x555175[0x0][_0x385427(0x131)]==_0x385427(0x19f))var _0x30746a=users[_0x385427(0x150)];}}}}}}}_0x343968['render']('transfer_finished',{'success':_0x2dbe38['flash'](_0x385427(0x13a)),'errors':_0x2dbe38[_0x385427(0x14b)](_0x385427(0xd0)),'role':_0xde6890,'profile':_0x3d9061,'master_shop':_0x555175,'transfer':_0x27642a,'language':_0x30746a});}catch(_0x24146b){console[_0x385427(0x122)](_0x24146b);}});async function getRandom8DigitNumber(){var _0x5cf3f1=a0_0x3ca044;const _0x1d9db9=0x989680,_0x1dffa5=0x5f5e0ff,_0x2e3fab=Math['floor'](Math[_0x5cf3f1(0x151)]()*(_0x1dffa5-_0x1d9db9+0x1))+_0x1d9db9;var _0x14c572;const _0xeb837c=await transfers_finished['findOne']({'invoice':_0x5cf3f1(0x105)+_0x2e3fab});return _0xeb837c&&_0xeb837c[_0x5cf3f1(0xec)]>0x0?_0x14c572=_0x5cf3f1(0x105)+_0x2e3fab:_0x14c572=_0x5cf3f1(0x105)+_0x2e3fab,_0x14c572;}function a0_0x3d5e(_0x4243a0,_0x513d78){var _0x502f65=a0_0x502f();return a0_0x3d5e=function(_0x3d5e29,_0x3f9a1e){_0x3d5e29=_0x3d5e29-0xcb;var _0x3d8702=_0x502f65[_0x3d5e29];return _0x3d8702;},a0_0x3d5e(_0x4243a0,_0x513d78);}function a0_0x502f(){var _0x22f650=['staff','9208icRBeK','length','production_date','to_bay','English','3446829pOrMsc','$product_details.product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<!DOCTYPE\x20html>','/view/add_transfer','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</h5>','$product_details.bin','1206bBnWJi','Transfer\x20Edit\x20Successfully','from_invoice','secondary_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','transfer_data','$product_details.secondary_unit','Hindi','params','FROZEN\x20GOODS','French','invoice','email','TRFF-','split','Rack\x202','to_quantity','../public/language/languages.json','port','$product_details.rack','</thead>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','DRY\x20GOODS','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product','to_room','104565VuUbAr','$product_details.pallet','padStart','Spanish','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','<h2>\x20','German','site_title','exports','user','New_Qty_Converted','createTransport','from_prod_level','To_invoice','product_date','error','log','$product_details.unit','updateOne','An\x20error\x20occurred\x20while\x20saving\x20data.','to_prod_level','<div>','maxProducts','to_floorlevel','/CheckingWarehouse','$product_details.isle','/view/:id','to_room_name','MaxStocks_data2','note','date','language','from_room','$product_details.batch_code','save','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','message','</div>','Transfer\x20Mail','success','password','$product_details._id','<h5>','Portuguese\x20(BR)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','getDate','/barcode_scanner','from_quantity','slice','$to_warehouse','image','</tbody>','</head><body>','status','product','/barcode_scanner2','flash','English\x20(US)','7148418pcpqso','Enclosed','\x20</h2>','Arabic','random','$date','$product_details.type','$product_details.production_date','host','$product_details.invoice','warehouse','990950gtUoJY','to_warehouse','QA\x20Warehouse','$product_details.bay','../middleware/auth','Rack\x201','$product_details.secondary_code','$product_details.primary_code','22SAqTdQ','batch_code','FGSEmail','$name','finalize','maxPerUnit','to_invoice','unit','_id','then','110ZZbZOd','Chinese','$product_details.level','body','</table>','$product_details.floorlevel','from_prod_qty','filter','product_stock','get','from_warehouse','ToRoomAssigned','$_id','logo','findById','/transfer_finished/preview/','bay','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','aggregate','primary_unit','forEach','from_room_name','catch','/barcode_scanner3','prod_cat','$finalize','</tr>','9286760DmfaJe','getFullYear','RoomAssigned','product_code','Finished\x20Goods','<tr>','map','post','all','$product_details.maxPerUnit','product_code3','Router','Portuguese','$product_details.expiry_date','toString','../models/all_models','</td>','100159UMrAis','$product_details.product_code','$product_details.product_name','prod_name','primary_code','Error\x20Occurs','string','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Arabic\x20(ae)','<hr\x20class=\x22my-3\x22>','secondary_unit','from_bay','edit_transfer_finished','Enabled','findOne','Transfer\x20Finalize\x20Successfully','/picking_list/PDF_transfer/','errors','product_details','/upload/','<strong>\x20Regards\x20</strong>','$product_details.maxProducts','push','An\x20error\x20occurred.','$product_details','Ambient','MaxStocks_data','/preview/:id','76wCzXNN','$invoice','There\x27s\x20a\x20error\x20in\x20this\x20transaction','role','to_prod_qty','product_name','json','render','$product_details.storage','\x20Order\x20Number\x20:\x20','$room','expiry_date','back','concat','sendMail'];a0_0x502f=function(){return _0x22f650;};return a0_0x502f();}router[a0_0x3ca044(0x173)](a0_0x3ca044(0xf4),auth,async(_0x4caa20,_0x40a6e2)=>{var _0x2d9da7=a0_0x3ca044;try{const {username:_0x1f31b6,email:_0xbffac,role:_0x3ad09d}=_0x4caa20['user'],_0x34e79f=_0x4caa20[_0x2d9da7(0x11b)],_0x2868de=await profile['findOne']({'email':_0x34e79f[_0x2d9da7(0x104)]}),_0x42d006=await master_shop[_0x2d9da7(0x19d)]();let _0x1c38f8;if(_0x34e79f[_0x2d9da7(0xde)]=='staff'){const _0x310891=await staff[_0x2d9da7(0xcd)]({'email':_0x34e79f[_0x2d9da7(0x104)]});_0x1c38f8=await warehouse[_0x2d9da7(0x17c)]([{'$match':{'status':_0x2d9da7(0xcc),'name':_0x310891[_0x2d9da7(0x157)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1c38f8=await warehouse[_0x2d9da7(0x17c)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x2d9da7(0x15a)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5f04ee=await transfers_finished[_0x2d9da7(0x19d)]({}),_0x555fcf=_0x5f04ee['length']+0x1,_0x156051=_0x2d9da7(0x105)+_0x555fcf[_0x2d9da7(0x193)]()[_0x2d9da7(0x114)](0x5,'0');if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x14c))var _0x5ce729=users[_0x2d9da7(0xef)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0xff))var _0x5ce729=users[_0x2d9da7(0xff)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x118))var _0x5ce729=users[_0x2d9da7(0x118)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x115))var _0x5ce729=users[_0x2d9da7(0x115)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x102))var _0x5ce729=users[_0x2d9da7(0x102)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x13e))var _0x5ce729=users[_0x2d9da7(0x191)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x16b))var _0x5ce729=users[_0x2d9da7(0x16b)];else{if(_0x42d006[0x0][_0x2d9da7(0x131)]==_0x2d9da7(0x19f))var _0x5ce729=users[_0x2d9da7(0x150)];}}}}}}}const _0x19fd72=getRandom8DigitNumber();_0x19fd72[_0x2d9da7(0x169)](_0x21b568=>{var _0x269aba=_0x2d9da7;_0x40a6e2[_0x269aba(0xe2)]('add_transfer_finished',{'success':_0x4caa20['flash'](_0x269aba(0x13a)),'errors':_0x4caa20[_0x269aba(0x14b)]('errors'),'role':_0x34e79f,'profile':_0x2868de,'master_shop':_0x42d006,'warehouse':_0x1c38f8,'language':_0x5ce729,'invoice':_0x21b568});})[_0x2d9da7(0x180)](_0x30a480=>{var _0x218482=_0x2d9da7;_0x4caa20['flash'](_0x218482(0xd0),_0x218482(0xdd)),_0x40a6e2[_0x218482(0x135)]('/transfer/view');});}catch(_0x3904ce){console[_0x2d9da7(0x122)](_0x3904ce);}}),router[a0_0x3ca044(0x18c)](a0_0x3ca044(0xf4),auth,async(_0x48cb2a,_0x223c0a)=>{var _0x3063be=a0_0x3ca044;try{const {date:_0x202a73,from_warehouse:_0x2d71aa,FromRoom_name:_0x3da66a,to_warehouse:_0x1cd86a,ToRoom_name:_0x1400b3,prod_name:_0x451dfb,from_prod_qty:_0x5f0b17,from_prod_level:_0x20e44a,from_prod_isle:_0x1295e8,from_prod_pallet:_0x599dfd,to_prod_qty:_0x4cc633,to_prod_level:_0x4f86a2,to_prod_isle:_0x244d72,to_prod_pallet:_0x288591,primary_code:_0x311f7d,secondary_code:_0x440bbf,product_code3:_0x40b002,note:_0x25308d,MaxStocks_data2:_0x425271,invoice:_0xd19f24,expiry_date:_0x2ca035}=_0x48cb2a[_0x3063be(0x16d)];if(typeof _0x451dfb==_0x3063be(0x19c))var _0x3c0e4b=[_0x48cb2a[_0x3063be(0x16d)]['prod_name']],_0x5437a7=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x170)]],_0x18a688=[_0x48cb2a[_0x3063be(0x16d)]['from_prod_level']],_0x590bc6=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x11c)]],_0x1daa46=[_0x48cb2a['body'][_0x3063be(0x126)]],_0x1e8cda=[_0x48cb2a['body'][_0x3063be(0x19a)]],_0x2ec492=[_0x48cb2a[_0x3063be(0x16d)]['secondary_code']],_0x172639=[_0x48cb2a['body'][_0x3063be(0x18f)]],_0x3e8ea2=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x12e)]],_0x223127=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x17d)]],_0x5ea7e0=[_0x48cb2a['body'][_0x3063be(0x1a1)]],_0x5861a6=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x161)]],_0x286b75=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0xe6)]],_0xdcd06d=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x120)]],_0x5605d9=[_0x48cb2a[_0x3063be(0x16d)]['MaxStocks_data']],_0x5831f2=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x165)]],_0x40d93b=[_0x48cb2a[_0x3063be(0x16d)]['prod_cat']],_0x438359=[_0x48cb2a['body'][_0x3063be(0x187)]],_0x242aa6=[_0x48cb2a['body'][_0x3063be(0x175)]],_0x542b68=[_0x48cb2a[_0x3063be(0x16d)][_0x3063be(0xfa)]],_0x53acfa=[_0x48cb2a['body']['to_invoice']];else var _0x3c0e4b=[..._0x48cb2a['body'][_0x3063be(0x199)]],_0x5437a7=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x170)]],_0x18a688=[..._0x48cb2a['body'][_0x3063be(0x11e)]],_0x590bc6=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x11c)]],_0x1daa46=[..._0x48cb2a['body'][_0x3063be(0x126)]],_0x1e8cda=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x19a)]],_0x2ec492=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0xfb)]],_0x172639=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x18f)]],_0x3e8ea2=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x12e)]],_0x223127=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x17d)]],_0x5ea7e0=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x1a1)]],_0x5861a6=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x161)]],_0x286b75=[..._0x48cb2a[_0x3063be(0x16d)]['expiry_date']],_0xdcd06d=[..._0x48cb2a[_0x3063be(0x16d)]['product_date']],_0x5605d9=[..._0x48cb2a['body'][_0x3063be(0xd9)]],_0x5831f2=[..._0x48cb2a['body'][_0x3063be(0x165)]],_0x40d93b=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x182)]],_0x438359=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x187)]],_0x242aa6=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x175)]],_0x542b68=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0xfa)]],_0x53acfa=[..._0x48cb2a[_0x3063be(0x16d)][_0x3063be(0x166)]];const _0x2486e5=_0x3c0e4b[_0x3063be(0x18b)](_0x3305ed=>{return _0x3305ed={'product_name':_0x3305ed};});_0x5437a7[_0x3063be(0x17e)]((_0x239382,_0x3d7151)=>{var _0x4b6b75=_0x3063be;_0x2486e5[_0x3d7151][_0x4b6b75(0x142)]=_0x239382;}),_0x18a688[_0x3063be(0x17e)]((_0x9b6f10,_0x5a5316)=>{var _0x164330=_0x3063be;_0x2486e5[_0x5a5316][_0x164330(0x1a2)]=_0x9b6f10;}),_0x542b68[_0x3063be(0x17e)]((_0x2a863c,_0x483a1e)=>{var _0x2242e1=_0x3063be;_0x2486e5[_0x483a1e][_0x2242e1(0xfa)]=_0x2a863c;}),_0x53acfa[_0x3063be(0x17e)]((_0x49da48,_0x23b3a2)=>{_0x2486e5[_0x23b3a2]['To_invoice']=_0x49da48;}),_0x590bc6['forEach']((_0x328e7b,_0x6651da)=>{var _0xcfcb1a=_0x3063be;_0x2486e5[_0x6651da][_0xcfcb1a(0x108)]=_0x328e7b;}),_0x1daa46[_0x3063be(0x17e)]((_0x4d1fc1,_0x347a1b)=>{var _0xc9fac5=_0x3063be;_0x2486e5[_0x347a1b][_0xc9fac5(0xee)]=_0x4d1fc1;}),_0x1e8cda[_0x3063be(0x17e)]((_0x36fe30,_0x331057)=>{var _0x3c1b52=_0x3063be;_0x2486e5[_0x331057][_0x3c1b52(0x19a)]=_0x36fe30;}),_0x2ec492['forEach']((_0xa8e0f1,_0x295a30)=>{var _0x36e8bf=_0x3063be;_0x2486e5[_0x295a30][_0x36e8bf(0xfb)]=_0xa8e0f1;}),_0x172639[_0x3063be(0x17e)]((_0x266c66,_0x56b837)=>{var _0xf5d412=_0x3063be;_0x2486e5[_0x56b837][_0xf5d412(0x188)]=_0x266c66;}),_0x3e8ea2[_0x3063be(0x17e)]((_0x1f6ffb,_0x336f3c)=>{var _0x57c081=_0x3063be;_0x2486e5[_0x336f3c][_0x57c081(0x128)]=_0x1f6ffb;}),_0x223127['forEach']((_0x1531eb,_0x2a7bc0)=>{var _0x2e5c90=_0x3063be;_0x2486e5[_0x2a7bc0][_0x2e5c90(0x167)]=_0x1531eb;}),_0x5ea7e0[_0x3063be(0x17e)]((_0x25ad88,_0x56e225)=>{var _0x2e5057=_0x3063be;_0x2486e5[_0x56e225][_0x2e5057(0x1a1)]=_0x25ad88;}),_0x5861a6[_0x3063be(0x17e)]((_0x55338d,_0xf3353c)=>{var _0x352112=_0x3063be;_0x2486e5[_0xf3353c][_0x352112(0x161)]=_0x55338d;}),_0x286b75[_0x3063be(0x17e)]((_0x4cb886,_0x453be5)=>{var _0x1e1535=_0x3063be;_0x2486e5[_0x453be5][_0x1e1535(0xe6)]=_0x4cb886;}),_0xdcd06d[_0x3063be(0x17e)]((_0x46c193,_0x1a83b1)=>{var _0x454af0=_0x3063be;_0x2486e5[_0x1a83b1][_0x454af0(0xed)]=_0x46c193;}),_0x5605d9[_0x3063be(0x17e)]((_0x495290,_0x40cd5f)=>{_0x2486e5[_0x40cd5f]['maxProducts']=_0x495290;}),_0x5831f2['forEach']((_0x3446fa,_0x6a035e)=>{_0x2486e5[_0x6a035e]['maxPerUnit']=_0x3446fa;}),_0x40d93b['forEach']((_0xa2fc9d,_0x7e5263)=>{var _0x806f63=_0x3063be;_0x2486e5[_0x7e5263][_0x806f63(0x182)]=_0xa2fc9d;}),_0x438359[_0x3063be(0x17e)]((_0x4f3e92,_0x1dcb4e)=>{var _0x33493c=_0x3063be;_0x2486e5[_0x1dcb4e][_0x33493c(0x17f)]=_0x4f3e92;}),_0x242aa6[_0x3063be(0x17e)]((_0x746b08,_0x266b75)=>{var _0x8ae37d=_0x3063be;_0x2486e5[_0x266b75][_0x8ae37d(0x12d)]=_0x746b08;});const _0x1df7db=_0x2486e5[_0x3063be(0x171)](_0x2d2c58=>_0x2d2c58['to_quantity']!=='0'&&_0x2d2c58[_0x3063be(0x108)]!==''||_0x2d2c58[_0x3063be(0x129)]!=='0'&&_0x2d2c58[_0x3063be(0x129)]!=='');var _0x460802=0x0;_0x1df7db[_0x3063be(0x17e)](_0x5d5d95=>{var _0x446a5b=_0x3063be;parseInt(_0x5d5d95[_0x446a5b(0x142)])<parseInt(_0x5d5d95[_0x446a5b(0x108)])&&_0x460802++;});if(_0x460802!=0x0)return _0x48cb2a[_0x3063be(0x14b)](_0x3063be(0xd0),_0x3063be(0x10d)),_0x223c0a[_0x3063be(0x135)]('back');const _0x31c32d=new transfers_finished({'date':_0x202a73,'from_warehouse':_0x2d71aa,'to_warehouse':_0x1cd86a,'product':_0x1df7db,'note':_0x25308d,'invoice':_0xd19f24}),_0x2e2ab2=await _0x31c32d[_0x3063be(0x134)]();_0x48cb2a[_0x3063be(0x14b)](_0x3063be(0x13a),'Product\x20Transfer\x20successfully'),_0x223c0a['redirect'](_0x3063be(0x179)+_0x2e2ab2[_0x3063be(0x168)]);}catch(_0x570b2d){console['log'](_0x570b2d),_0x223c0a[_0x3063be(0x148)](0xc8)[_0x3063be(0xe1)]({'errorMessage':_0x570b2d['message']});}}),router['get'](a0_0x3ca044(0xda),auth,async(_0x1a6a24,_0x8f416a)=>{var _0x59874d=a0_0x3ca044;try{const {username:_0x50e862,email:_0x421ede,role:_0x1ce391}=_0x1a6a24['user'],_0x5c7d75=_0x1a6a24[_0x59874d(0x11b)],_0xf01c17=await profile[_0x59874d(0xcd)]({'email':_0x5c7d75['email']}),_0x4422bb=await master_shop[_0x59874d(0x19d)](),_0x15ecfb=await transfers_finished['findById'](_0x1a6a24['params']['id']);let _0x5445eb;if(_0x5c7d75[_0x59874d(0xde)]==_0x59874d(0xea)){const _0x34d556=await staff['findOne']({'email':_0x5c7d75[_0x59874d(0x104)]});_0x5445eb=await warehouse['find']({'status':_0x59874d(0xcc),'name':_0x34d556['warehouse'],'warehouse_category':_0x59874d(0x189)});}else _0x5445eb=await warehouse[_0x59874d(0x19d)]({'status':_0x59874d(0xcc),'warehouse_category':_0x59874d(0x189)});const _0x4e764d=await warehouse[_0x59874d(0x17c)]([{'$match':{'name':_0x15ecfb[_0x59874d(0x174)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x59874d(0xd7)},{'$group':{'_id':_0x59874d(0x13c),'name':{'$first':_0x59874d(0x198)},'product_stock':{'$first':_0x59874d(0xf1)},'bay':{'$first':_0x59874d(0x15b)},'bin':{'$first':_0x59874d(0xf7)},'type':{'$first':_0x59874d(0x153)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x59874d(0x15f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x59874d(0x197)},'storage':{'$first':_0x59874d(0xe3)},'rack':{'$first':_0x59874d(0x10b)},'expiry_date':{'$first':_0x59874d(0x192)},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':'$room'},'warehoue_name':{'$first':'$name'}}}]),_0x4c3ad2=await product[_0x59874d(0x19d)]({});if(_0x4422bb[0x0][_0x59874d(0x131)]=='English\x20(US)'){var _0x400375=users[_0x59874d(0xef)];console[_0x59874d(0x122)](_0x400375);}else{if(_0x4422bb[0x0][_0x59874d(0x131)]=='Hindi')var _0x400375=users[_0x59874d(0xff)];else{if(_0x4422bb[0x0]['language']==_0x59874d(0x118))var _0x400375=users[_0x59874d(0x118)];else{if(_0x4422bb[0x0][_0x59874d(0x131)]==_0x59874d(0x115))var _0x400375=users[_0x59874d(0x115)];else{if(_0x4422bb[0x0][_0x59874d(0x131)]=='French')var _0x400375=users['French'];else{if(_0x4422bb[0x0]['language']=='Portuguese\x20(BR)')var _0x400375=users[_0x59874d(0x191)];else{if(_0x4422bb[0x0][_0x59874d(0x131)]==_0x59874d(0x16b))var _0x400375=users[_0x59874d(0x16b)];else{if(_0x4422bb[0x0]['language']=='Arabic\x20(ae)')var _0x400375=users[_0x59874d(0x150)];}}}}}}}_0x8f416a[_0x59874d(0xe2)]('edit_transfer_finished_view',{'success':_0x1a6a24[_0x59874d(0x14b)](_0x59874d(0x13a)),'errors':_0x1a6a24['flash'](_0x59874d(0xd0)),'role':_0x5c7d75,'profile':_0xf01c17,'master_shop':_0x4422bb,'warehouse':_0x5445eb,'transfer':_0x15ecfb,'stock':_0x4e764d,'unit':_0x4c3ad2,'language':_0x400375});}catch(_0x58fb23){console[_0x59874d(0x122)](_0x58fb23);}}),router[a0_0x3ca044(0x18c)](a0_0x3ca044(0xda),auth,async(_0x403732,_0x29988a)=>{var _0x23e36d=a0_0x3ca044;try{const {invoice:_0x3359a5,from_warehouse:_0x16954a,FromRoom_name:_0x8618e,to_warehouse:_0x34cc06,ToRoom_name:_0x5976f8}=_0x403732[_0x23e36d(0x16d)],_0x40d938=await transfers_finished['findById'](_0x403732[_0x23e36d(0x100)]['id']),_0x50af6c=_0x40d938[_0x23e36d(0x149)][_0x23e36d(0x18b)](async _0x1199d9=>{var _0x47d7a9=_0x23e36d;if(_0x1199d9[_0x47d7a9(0x108)]>0x0){var _0x4ee61d=await warehouse[_0x47d7a9(0xcd)]({'name':_0x16954a,'room':_0x1199d9[_0x47d7a9(0x17f)],'warehouse_category':_0x47d7a9(0x189)});const _0x54b8e7=_0x4ee61d['product_details'][_0x47d7a9(0x18b)](_0x47b52a=>{var _0xe0450a=_0x47d7a9;_0x47b52a[_0xe0450a(0xe0)]==_0x1199d9['product_name']&&_0x47b52a[_0xe0450a(0x17a)]==_0x1199d9[_0xe0450a(0x1a2)]&&_0x47b52a[_0xe0450a(0xe6)]==_0x1199d9[_0xe0450a(0xe6)]&&_0x47b52a[_0xe0450a(0xed)]==_0x1199d9['production_date']&&_0x47b52a[_0xe0450a(0x161)]==_0x1199d9[_0xe0450a(0x161)]&&_0x47b52a[_0xe0450a(0x103)]==_0x1199d9[_0xe0450a(0xfa)]&&(_0x47b52a[_0xe0450a(0x172)]=_0x47b52a['product_stock']-_0x1199d9[_0xe0450a(0x108)]);});}return _0x4ee61d;});Promise[_0x23e36d(0x18d)](_0x50af6c)[_0x23e36d(0x169)](async _0x4d4fdb=>{var _0x2608d0=_0x23e36d;try{for(const _0x7b05c of _0x4d4fdb){await _0x7b05c['save']();}const _0x1bb774=_0x40d938[_0x2608d0(0x149)]['map'](async _0x49639f=>{var _0x4d36cb=_0x2608d0,_0x3155f1=await warehouse[_0x4d36cb(0xcd)]({'name':_0x34cc06,'room':_0x49639f[_0x4d36cb(0x12d)]});if(_0x49639f[_0x4d36cb(0x108)]>0x0){var _0x102982=0x0;const _0x15e983=_0x3155f1[_0x4d36cb(0xd1)][_0x4d36cb(0x18b)](_0x4c3037=>{var _0x3f5030=_0x4d36cb;_0x4c3037[_0x3f5030(0xe0)]==_0x49639f[_0x3f5030(0xe0)]&&_0x4c3037[_0x3f5030(0x17a)]==_0x49639f[_0x3f5030(0xee)]&&_0x4c3037[_0x3f5030(0xe6)]==_0x49639f['expiry_date']&&_0x4c3037[_0x3f5030(0xed)]==_0x49639f['production_date']&&_0x4c3037[_0x3f5030(0x161)]==_0x49639f[_0x3f5030(0x161)]&&_0x4c3037[_0x3f5030(0x103)]==_0x49639f[_0x3f5030(0x11f)]&&(_0x4c3037[_0x3f5030(0x172)]=_0x4c3037[_0x3f5030(0x172)]+_0x49639f['to_quantity'],_0x102982++);});_0x102982=='0'&&(_0x3155f1['product_details']=_0x3155f1[_0x4d36cb(0xd1)][_0x4d36cb(0xe8)]({'product_name':_0x49639f[_0x4d36cb(0xe0)],'product_stock':_0x49639f[_0x4d36cb(0x108)],'bay':_0x49639f[_0x4d36cb(0xee)],'product_code':_0x49639f[_0x4d36cb(0x188)],'primary_code':_0x49639f[_0x4d36cb(0x19a)],'secondary_code':_0x49639f[_0x4d36cb(0xfb)],'expiry_date':_0x49639f[_0x4d36cb(0xe6)],'production_date':_0x49639f[_0x4d36cb(0xed)],'maxProducts':_0x49639f['maxProducts'],'batch_code':_0x49639f[_0x4d36cb(0x161)],'secondary_unit':_0x49639f[_0x4d36cb(0x1a1)],'unit':_0x49639f[_0x4d36cb(0x167)],'maxProducts':_0x49639f[_0x4d36cb(0x128)],'maxPerUnit':_0x49639f[_0x4d36cb(0x165)],'invoice':_0x49639f[_0x4d36cb(0x11f)]}));}return _0x3155f1;});Promise[_0x2608d0(0x18d)](_0x1bb774)[_0x2608d0(0x169)](async _0x3b898b=>{var _0xbaf30f=_0x2608d0;try{for(const _0x4ef213 of _0x3b898b){await warehouse[_0xbaf30f(0x124)]({'_id':_0x4ef213['_id']},{'$addToSet':{'product_details':{'$each':_0x4ef213[_0xbaf30f(0xd1)]}}});}_0x40d938[_0xbaf30f(0x164)]='True';const _0x54f18f=await _0x40d938[_0xbaf30f(0x134)](),_0x2141f6=await master_shop[_0xbaf30f(0x19d)](),_0x2d3a1f=await email_settings[_0xbaf30f(0xcd)](),_0x47d985=await supervisor_settings['find']();var _0x29355e=_0x40d938['product'],_0x27b6d9='',_0x4372e3;for(_0x4372e3 in _0x29355e){var _0x5b1c4e='FG';_0x40d938[_0xbaf30f(0x159)]=='DRY\x20GOODS'&&(_0x5b1c4e='DG'),_0x27b6d9+='<tr>'+_0xbaf30f(0x17b)+_0x29355e[_0x4372e3][_0xbaf30f(0xe0)]+_0xbaf30f(0x195)+_0xbaf30f(0x17b)+_0x29355e[_0x4372e3]['product_code']+_0xbaf30f(0x195)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x29355e[_0x4372e3][_0xbaf30f(0x108)]+_0xbaf30f(0x195)+_0xbaf30f(0x17b)+_0x29355e[_0x4372e3]['unit']+_0xbaf30f(0x195)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x29355e[_0x4372e3]['secondary_unit']+_0xbaf30f(0x195)+_0xbaf30f(0x17b)+_0x40d938['to_warehouse']+_0xbaf30f(0x195)+_0xbaf30f(0x17b)+_0x29355e[_0x4372e3][_0xbaf30f(0x12d)]+_0xbaf30f(0x195)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5b1c4e+_0x29355e[_0x4372e3]['to_bay']+'</td>'+'</tr>';}let _0x3dddbb=nodemailer[_0xbaf30f(0x11d)]({'host':_0x2d3a1f[_0xbaf30f(0x155)],'port':Number(_0x2d3a1f[_0xbaf30f(0x10a)]),'secure':![],'auth':{'user':_0x2d3a1f['email'],'pass':_0x2d3a1f[_0xbaf30f(0x13b)]}}),_0x347945={'from':_0x2d3a1f['email'],'to':_0x47d985[0x0][_0xbaf30f(0x162)],'subject':_0xbaf30f(0x139),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0xbaf30f(0xd2)+_0x2141f6[0x0][_0xbaf30f(0x145)],'cid':_0xbaf30f(0x177)}],'html':_0xbaf30f(0xf3)+'<html><head><title></title>'+_0xbaf30f(0x147)+_0xbaf30f(0x127)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xbaf30f(0x127)+_0xbaf30f(0xf5)+_0xbaf30f(0x138)+_0xbaf30f(0x127)+_0xbaf30f(0x117)+_0x2141f6[0x0][_0xbaf30f(0x119)]+_0xbaf30f(0x14f)+'</div>'+'</div>'+_0xbaf30f(0x1a0)+_0xbaf30f(0x127)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xbaf30f(0xe4)+_0x40d938[_0xbaf30f(0x103)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x40d938[_0xbaf30f(0x130)]+'\x20'+'</span>'+_0xbaf30f(0xf6)+_0xbaf30f(0x138)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xbaf30f(0xfc)+_0xbaf30f(0x18a)+_0xbaf30f(0xf2)+_0xbaf30f(0x13f)+_0xbaf30f(0x136)+_0xbaf30f(0x10f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0xbaf30f(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xbaf30f(0x184)+_0xbaf30f(0x10c)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x27b6d9+'\x20'+_0xbaf30f(0x146)+_0xbaf30f(0x16e)+_0xbaf30f(0x127)+_0xbaf30f(0xd3)+_0xbaf30f(0x13d)+_0x2141f6[0x0]['site_title']+_0xbaf30f(0xf6)+_0xbaf30f(0x138)+_0xbaf30f(0x138)+'</body></html>'};_0x3dddbb[_0xbaf30f(0xe9)](_0x347945,function(_0x50f2b0,_0xce5048){var _0xe2cea4=_0xbaf30f;_0x50f2b0?(console['log'](_0x50f2b0),console[_0xe2cea4(0x122)](_0xe2cea4(0x19b))):console[_0xe2cea4(0x122)]('Email\x20sent\x20successfully');}),_0x403732[_0xbaf30f(0x14b)](_0xbaf30f(0x13a),_0xbaf30f(0xce)),_0x29988a[_0xbaf30f(0x135)](_0xbaf30f(0xcf)+_0x54f18f[_0xbaf30f(0x168)]);}catch(_0x6b0057){console['error'](_0x6b0057),_0x29988a[_0xbaf30f(0x148)](0x1f4)['json']({'error':_0xbaf30f(0x116)});}})['catch'](_0x1fa1aa=>{var _0x30039a=_0x2608d0;console['error'](_0x1fa1aa),_0x29988a[_0x30039a(0x148)](0x1f4)[_0x30039a(0xe1)]({'error':_0x30039a(0xd6)});});}catch(_0x5080d0){console[_0x2608d0(0x121)](_0x5080d0),_0x29988a[_0x2608d0(0x148)](0x1f4)[_0x2608d0(0xe1)]({'error':_0x2608d0(0x125)});}})[_0x23e36d(0x180)](_0x30e5c7=>{var _0x2faeb7=_0x23e36d;console[_0x2faeb7(0x121)](_0x30e5c7),_0x29988a['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x5ef7c0){_0x29988a[_0x23e36d(0xe1)]({'message':_0x5ef7c0['message']});}});function BayBinSelected(_0x56c72d,_0x5f07ce){var _0x2118d8=a0_0x3ca044,_0x2f578e=[];let _0x3b0e5=[];var _0x14b01b=[];if(_0x56c72d==_0x2118d8(0x10e)){switch(_0x5f07ce){case _0x2118d8(0x15d):_0x2f578e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x2118d8(0x107):_0x2f578e=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x14b01b=['DG'];}else{if(_0x56c72d==_0x2118d8(0x101)){switch(_0x5f07ce){case _0x2118d8(0x15d):_0x2f578e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x2f578e=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x14b01b=['FG'];}}return{'levels':_0x2f578e,'identify':_0x14b01b};}router[a0_0x3ca044(0x173)](a0_0x3ca044(0x12c),auth,async(_0x482050,_0x12800d)=>{var _0x4daa78=a0_0x3ca044;try{const {username:_0x171f10,email:_0x406007,role:_0x5b9fb0}=_0x482050[_0x4daa78(0x11b)],_0x54f769=_0x482050['user'],_0x37fa45=await profile[_0x4daa78(0xcd)]({'email':_0x54f769[_0x4daa78(0x104)]}),_0xabb30d=await master_shop['find'](),_0x3ef867=await transfers_finished['findById'](_0x482050[_0x4daa78(0x100)]['id']);let _0x403d67=new Date(_0x3ef867[_0x4daa78(0xe6)]),_0x5e0497=('0'+_0x403d67[_0x4daa78(0x140)]())[_0x4daa78(0x143)](-0x2),_0xd2d19d=('0'+(_0x403d67['getMonth']()+0x1))[_0x4daa78(0x143)](-0x2),_0x1fadd8=_0x403d67[_0x4daa78(0x186)](),_0x9fb3b4=_0x1fadd8+'-'+_0xd2d19d+'-'+_0x5e0497,_0x5b0005;if(_0x54f769[_0x4daa78(0xde)]==_0x4daa78(0xea)){const _0x3283bf=await staff[_0x4daa78(0xcd)]({'email':_0x54f769[_0x4daa78(0x104)]});_0x5b0005=await warehouse[_0x4daa78(0x19d)]({'status':'Enabled','name':_0x3283bf[_0x4daa78(0x157)],'warehouse_category':_0x4daa78(0x189)});}else _0x5b0005=await warehouse[_0x4daa78(0x19d)]({'status':_0x4daa78(0xcc),'warehouse_category':_0x4daa78(0x189)});const _0x317542=await warehouse[_0x4daa78(0x17c)]([{'$match':{'name':_0x3ef867[_0x4daa78(0x174)],'room':_0x3ef867[_0x4daa78(0x132)]}},{'$unwind':_0x4daa78(0xd7)},{'$group':{'_id':_0x4daa78(0x13c),'name':{'$first':_0x4daa78(0x198)},'product_stock':{'$first':_0x4daa78(0xf1)},'bay':{'$first':_0x4daa78(0x15b)},'bin':{'$first':_0x4daa78(0xf7)},'type':{'$first':_0x4daa78(0x153)},'floorlevel':{'$first':_0x4daa78(0x16f)},'primary_code':{'$first':_0x4daa78(0x15f)},'secondary_code':{'$first':_0x4daa78(0x15e)},'product_code':{'$first':_0x4daa78(0x197)},'storage':{'$first':_0x4daa78(0xe3)},'rack':{'$first':_0x4daa78(0x10b)}}}]);var _0x2c6325=[0x1,0x2,0x3,0x4],_0x1be025=['A','B','C','D','E','F','G','H','I','J'],_0x548032=[_0x4daa78(0xd8),_0x4daa78(0x14e)];const _0x103ded=await product['find']({}),_0x22b4a4=BayBinSelected(_0x3ef867[_0x4daa78(0x159)],_0x3ef867['to_room']);if(_0xabb30d[0x0][_0x4daa78(0x131)]==_0x4daa78(0x14c)){var _0x5c098f=users[_0x4daa78(0xef)];console['log'](_0x5c098f);}else{if(_0xabb30d[0x0][_0x4daa78(0x131)]=='Hindi')var _0x5c098f=users[_0x4daa78(0xff)];else{if(_0xabb30d[0x0][_0x4daa78(0x131)]==_0x4daa78(0x118))var _0x5c098f=users[_0x4daa78(0x118)];else{if(_0xabb30d[0x0]['language']==_0x4daa78(0x115))var _0x5c098f=users['Spanish'];else{if(_0xabb30d[0x0][_0x4daa78(0x131)]=='French')var _0x5c098f=users[_0x4daa78(0x102)];else{if(_0xabb30d[0x0][_0x4daa78(0x131)]=='Portuguese\x20(BR)')var _0x5c098f=users[_0x4daa78(0x191)];else{if(_0xabb30d[0x0][_0x4daa78(0x131)]==_0x4daa78(0x16b))var _0x5c098f=users['Chinese'];else{if(_0xabb30d[0x0]['language']==_0x4daa78(0x19f))var _0x5c098f=users[_0x4daa78(0x150)];}}}}}}}_0x12800d[_0x4daa78(0xe2)](_0x4daa78(0xcb),{'success':_0x482050[_0x4daa78(0x14b)](_0x4daa78(0x13a)),'errors':_0x482050[_0x4daa78(0x14b)](_0x4daa78(0xd0)),'role':_0x54f769,'profile':_0x37fa45,'master_shop':_0xabb30d,'warehouse':_0x5b0005,'transfer':_0x3ef867,'stock':_0x317542,'unit':_0x103ded,'language':_0x5c098f,'levels':_0x2c6325,'Isle':_0x1be025,'rooms_data':_0x548032,'ed_fullDate':_0x9fb3b4,'dataSelected':_0x22b4a4});}catch(_0x410524){console[_0x4daa78(0x122)](_0x410524);}}),router['post']('/view/:id',auth,async(_0x417511,_0x454283)=>{var _0x5ebea2=a0_0x3ca044;try{const _0x4f4763=_0x417511[_0x5ebea2(0x100)]['id'];console['log'](_0x417511[_0x5ebea2(0x16d)]);const _0x2b7188=await transfers_finished[_0x5ebea2(0x178)](_0x4f4763);console[_0x5ebea2(0x122)](_0x5ebea2(0xfd),_0x2b7188);const {date:_0x98e8af,from_warehouse:_0x55b7ed,FromRoom_name:_0x33b3b0,to_warehouse:_0x4feb65,ToRoom_name:_0x42f2a1,prod_name:_0xf246d5,from_prod_qty:_0x6355a1,from_prod_level:_0x35b863,from_prod_isle:_0x229ebf,from_prod_pallet:_0x26f397,to_prod_qty:_0x2d5e0d,to_prod_level:_0x238f02,to_prod_isle:_0x2bf55a,to_prod_pallet:_0x5c447f,primary_code:_0x4cb17d,secondary_code:_0x6eee45,product_code3:_0xe70568,note:_0x25dcd0,invoice:_0x449f2c,expiry_date:_0x49f789}=_0x417511[_0x5ebea2(0x16d)];if(typeof _0xf246d5==_0x5ebea2(0x19c))var _0xa71dd=[_0x417511[_0x5ebea2(0x16d)]['prod_name']],_0x264959=[_0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x170)]],_0x1f9c17=[_0x417511['body'][_0x5ebea2(0x11e)]],_0x13e785=[_0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0xdf)]],_0x98b726=[_0x417511['body'][_0x5ebea2(0x126)]],_0x7b495f=[_0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x19a)]],_0x5a5aae=[_0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0xfb)]],_0x686214=[_0x417511['body'][_0x5ebea2(0x18f)]],_0x22a498=[_0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x12e)]],_0x5ce08e=[_0x417511[_0x5ebea2(0x16d)]['unit']],_0x4b2f59=[_0x417511[_0x5ebea2(0x16d)]['secondary_unit']],_0x5ef4ea=[_0x417511['body']['batch_code']],_0x1bb249=[_0x417511['body'][_0x5ebea2(0xe6)]];else var _0xa71dd=[..._0x417511[_0x5ebea2(0x16d)]['prod_name']],_0x264959=[..._0x417511['body'][_0x5ebea2(0x170)]],_0x1f9c17=[..._0x417511[_0x5ebea2(0x16d)]['from_prod_level']],_0x13e785=[..._0x417511[_0x5ebea2(0x16d)]['to_prod_qty']],_0x98b726=[..._0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x126)]],_0x7b495f=[..._0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x19a)]],_0x5a5aae=[..._0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0xfb)]],_0x686214=[..._0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x18f)]],_0x22a498=[..._0x417511['body'][_0x5ebea2(0x12e)]],_0x5ce08e=[..._0x417511[_0x5ebea2(0x16d)]['unit']],_0x4b2f59=[..._0x417511[_0x5ebea2(0x16d)][_0x5ebea2(0x1a1)]],_0x5ef4ea=[..._0x417511[_0x5ebea2(0x16d)]['batch_code']],_0x1bb249=[..._0x417511[_0x5ebea2(0x16d)]['expiry_date']];const _0x29e71e=_0xa71dd[_0x5ebea2(0x18b)](_0x27dee7=>{return _0x27dee7={'product_name':_0x27dee7};});_0x264959[_0x5ebea2(0x17e)]((_0x437777,_0x22d9a1)=>{var _0x59e775=_0x5ebea2;_0x29e71e[_0x22d9a1][_0x59e775(0x142)]=_0x437777;}),_0x1f9c17[_0x5ebea2(0x17e)]((_0x539ef6,_0xe30e8e)=>{_0x29e71e[_0xe30e8e]['from_bay']=_0x539ef6;}),_0x13e785['forEach']((_0x1eeace,_0x40f656)=>{var _0x55742e=_0x5ebea2;_0x29e71e[_0x40f656][_0x55742e(0x108)]=_0x1eeace;}),_0x98b726[_0x5ebea2(0x17e)]((_0x31d934,_0x16864b)=>{var _0x48816a=_0x5ebea2;_0x29e71e[_0x16864b][_0x48816a(0xee)]=_0x31d934;}),_0x7b495f[_0x5ebea2(0x17e)]((_0x590d7a,_0x5c6edf)=>{var _0x55e055=_0x5ebea2;_0x29e71e[_0x5c6edf][_0x55e055(0x19a)]=_0x590d7a;}),_0x5a5aae['forEach']((_0x2b48e1,_0x111e33)=>{var _0xafc61f=_0x5ebea2;_0x29e71e[_0x111e33][_0xafc61f(0xfb)]=_0x2b48e1;}),_0x686214['forEach']((_0x1e35f7,_0x5a77f6)=>{var _0x2212ce=_0x5ebea2;_0x29e71e[_0x5a77f6][_0x2212ce(0x188)]=_0x1e35f7;}),_0x22a498[_0x5ebea2(0x17e)]((_0x203446,_0x220961)=>{var _0x4a5d69=_0x5ebea2;_0x29e71e[_0x220961][_0x4a5d69(0x128)]=_0x203446;}),_0x5ce08e[_0x5ebea2(0x17e)]((_0x49d212,_0x35d2d1)=>{var _0x21f815=_0x5ebea2;_0x29e71e[_0x35d2d1][_0x21f815(0x167)]=_0x49d212;}),_0x4b2f59['forEach']((_0x29bc1e,_0x4e6bae)=>{var _0xb495e7=_0x5ebea2;_0x29e71e[_0x4e6bae][_0xb495e7(0x1a1)]=_0x29bc1e;}),_0x5ef4ea[_0x5ebea2(0x17e)]((_0x13ec69,_0x43e7c2)=>{var _0x1d721b=_0x5ebea2;_0x29e71e[_0x43e7c2][_0x1d721b(0x161)]=_0x13ec69;}),_0x1bb249[_0x5ebea2(0x17e)]((_0x8feeb2,_0x46401a)=>{_0x29e71e[_0x46401a]['expiry_date']=_0x8feeb2;});const _0x3668f3=_0x29e71e[_0x5ebea2(0x171)](_0x7377ea=>_0x7377ea[_0x5ebea2(0x108)]!=='0'&&_0x7377ea[_0x5ebea2(0x108)]!==''||_0x7377ea['to_floorlevel']!=='0'&&_0x7377ea['to_floorlevel']!=='');var _0x13fb4f=0x0;_0x3668f3[_0x5ebea2(0x17e)](_0x3222c1=>{var _0xf4d5f0=_0x5ebea2;parseInt(_0x3222c1[_0xf4d5f0(0x142)])<parseInt(_0x3222c1[_0xf4d5f0(0x108)])&&_0x13fb4f++;});if(_0x13fb4f!=0x0)return _0x417511[_0x5ebea2(0x14b)]('errors',_0x5ebea2(0x10d)),_0x454283[_0x5ebea2(0x135)](_0x5ebea2(0xe7));const _0xfcb950=await warehouse[_0x5ebea2(0xcd)]({'name':_0x2b7188['from_warehouse'],'room':_0x2b7188[_0x5ebea2(0x132)]});_0x2b7188[_0x5ebea2(0x149)][_0x5ebea2(0x17e)](_0x113d6e=>{var _0x19fc4d=_0x5ebea2;if(_0x113d6e[_0x19fc4d(0x108)]>0x0){const _0x4cd3ed=_0xfcb950[_0x19fc4d(0xd1)][_0x19fc4d(0x18b)](_0x48662f=>{var _0x206748=_0x19fc4d;_0x48662f[_0x206748(0xe0)]==_0x113d6e[_0x206748(0xe0)]&&_0x48662f[_0x206748(0x17a)]==_0x113d6e[_0x206748(0x1a2)]&&(_0x48662f['product_stock']=parseInt(_0x48662f[_0x206748(0x172)])+parseInt(_0x113d6e[_0x206748(0x108)]));});}}),await _0xfcb950['save']();const _0xe625e8=await warehouse[_0x5ebea2(0xcd)]({'name':_0x2b7188[_0x5ebea2(0x159)],'room':_0x2b7188[_0x5ebea2(0x111)]});_0x2b7188[_0x5ebea2(0x149)][_0x5ebea2(0x17e)](_0x264a98=>{var _0x1fccbf=_0x5ebea2;if(_0x264a98['to_quantity']>0x0){const _0x4ba121=_0xe625e8[_0x1fccbf(0xd1)][_0x1fccbf(0x18b)](_0x475967=>{var _0x423114=_0x1fccbf;_0x475967[_0x423114(0xe0)]==_0x264a98[_0x423114(0xe0)]&&_0x475967['bay']==_0x264a98[_0x423114(0xee)]&&(_0x475967[_0x423114(0x172)]=parseInt(_0x475967[_0x423114(0x172)])-parseInt(_0x264a98[_0x423114(0x108)]));});}}),await _0xe625e8['save'](),_0x2b7188['date']=_0x98e8af,_0x2b7188[_0x5ebea2(0x174)]=_0x55b7ed,_0x2b7188[_0x5ebea2(0x159)]=_0x4feb65,_0x2b7188[_0x5ebea2(0x149)]=_0x3668f3,_0x2b7188[_0x5ebea2(0x12f)]=_0x25dcd0,_0x2b7188[_0x5ebea2(0x103)]=_0x449f2c;const _0x513309=await _0x2b7188[_0x5ebea2(0x134)](),_0x285bd1=await warehouse[_0x5ebea2(0xcd)]({'name':_0x55b7ed,'room':_0x33b3b0});_0x513309[_0x5ebea2(0x149)][_0x5ebea2(0x17e)](_0x421620=>{var _0x390e66=_0x5ebea2;if(_0x421620[_0x390e66(0x108)]>0x0){const _0x1fcc72=_0x285bd1[_0x390e66(0xd1)][_0x390e66(0x18b)](_0x2d9f55=>{var _0x59a756=_0x390e66;_0x2d9f55[_0x59a756(0xe0)]==_0x421620[_0x59a756(0xe0)]&&_0x2d9f55[_0x59a756(0x17a)]==_0x421620[_0x59a756(0x1a2)]&&(_0x2d9f55[_0x59a756(0x172)]=parseInt(_0x2d9f55['product_stock'])-parseInt(_0x421620[_0x59a756(0x108)]));});}}),await _0x285bd1['save']();const _0x506f94=await warehouse[_0x5ebea2(0xcd)]({'name':_0x4feb65,'room':_0x42f2a1});_0x513309['product'][_0x5ebea2(0x17e)](_0x127d57=>{var _0x41ab31=_0x5ebea2;if(_0x127d57[_0x41ab31(0x108)]>0x0){var _0x3390cf=0x0;const _0x106bb0=_0x506f94[_0x41ab31(0xd1)][_0x41ab31(0x18b)](_0x39f595=>{var _0x56f0e7=_0x41ab31;_0x39f595[_0x56f0e7(0xe0)]==_0x127d57['product_name']&&_0x39f595[_0x56f0e7(0x17a)]==_0x127d57[_0x56f0e7(0xee)]&&(_0x39f595[_0x56f0e7(0x172)]=parseInt(_0x39f595['product_stock'])+parseInt(_0x127d57[_0x56f0e7(0x108)]),_0x3390cf++);});_0x3390cf=='0'&&(_0x506f94[_0x41ab31(0xd1)]=_0x506f94[_0x41ab31(0xd1)][_0x41ab31(0xe8)]({'product_name':_0x127d57['product_name'],'product_stock':_0x127d57[_0x41ab31(0x108)],'bay':_0x127d57[_0x41ab31(0xee)],'product_code':_0x127d57[_0x41ab31(0x188)],'primary_code':_0x127d57[_0x41ab31(0x19a)],'secondary_code':_0x127d57[_0x41ab31(0xfb)],'maxProducts':_0x127d57[_0x41ab31(0x128)]}));}}),await _0x506f94[_0x5ebea2(0x134)](),_0x417511['flash'](_0x5ebea2(0x13a),_0x5ebea2(0xf9)),_0x454283[_0x5ebea2(0x135)]('/transfer_finished/view');}catch(_0x1c5295){console[_0x5ebea2(0x122)](_0x1c5295);}}),router[a0_0x3ca044(0x18c)](a0_0x3ca044(0x141),async(_0x1a3ad7,_0x57b944)=>{var _0x20fa2f=a0_0x3ca044;const {FromWareHouse:_0x6b9a10,FromRoom:_0xb8a5a4,ToWarehouse:_0x1cd2d8,ToRoom:_0x195d62,primary_code:_0xd32044,Roomslist:_0x4eb7f5}=_0x1a3ad7[_0x20fa2f(0x16d)],_0x15121f=_0x4eb7f5[_0x20fa2f(0x106)](','),_0x5577eb=[];async function _0x308f6c(_0x4094c){var _0x5e95dd=_0x20fa2f;const _0xaed3dc=await warehouse['aggregate']([{'$match':{'name':_0x6b9a10,'room':_0x4094c}},{'$unwind':_0x5e95dd(0xd7)},{'$match':{'product_details.primary_code':_0xd32044}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5e95dd(0x198)},'instock':{'$first':_0x5e95dd(0xf1)},'primary_code':{'$first':_0x5e95dd(0x15f)},'secondary_code':{'$first':_0x5e95dd(0x15e)},'product_code':{'$first':_0x5e95dd(0x197)},'level':{'$first':_0x5e95dd(0x15b)},'isle':{'$first':_0x5e95dd(0xf7)},'type':{'$first':_0x5e95dd(0x153)},'pallet':{'$first':_0x5e95dd(0x16f)},'unit':{'$first':_0x5e95dd(0x123)},'secondary_unit':{'$first':_0x5e95dd(0xfe)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5e95dd(0x10b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x5e95dd(0x154)},'batch_code':{'$first':_0x5e95dd(0x133)},'maxPerUnit':{'$first':_0x5e95dd(0x18e)},'roomNamed':{'$first':_0x5e95dd(0xe5)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x5e95dd(0x156)}}}]),_0x27b857=await warehouse[_0x5e95dd(0x17c)]([{'$match':{'name':_0x6b9a10,'room':_0x4094c}},{'$unwind':_0x5e95dd(0xd7)},{'$match':{'product_details.secondary_code':_0xd32044}},{'$group':{'_id':_0x5e95dd(0x13c),'name':{'$first':_0x5e95dd(0x198)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5e95dd(0x15e)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x5e95dd(0xf7)},'type':{'$first':_0x5e95dd(0x153)},'pallet':{'$first':_0x5e95dd(0x16f)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x5e95dd(0xfe)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5e95dd(0x192)},'production_date':{'$first':_0x5e95dd(0x154)},'batch_code':{'$first':_0x5e95dd(0x133)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x5e95dd(0xe5)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0xaed3dc[_0x5e95dd(0xec)]>0x0)_0x5577eb[_0x5e95dd(0xd5)](_0xaed3dc);else _0x27b857['length']>0x0&&_0x5577eb[_0x5e95dd(0xd5)](_0x27b857);}const _0x2378b5=_0x15121f['map'](_0x2e02aa=>_0x308f6c(_0x2e02aa));await Promise[_0x20fa2f(0x18d)](_0x2378b5),_0x57b944['json'](_0x5577eb);}),router[a0_0x3ca044(0x18c)](a0_0x3ca044(0x14a),async(_0x3e06db,_0x4909b2)=>{var _0x580dff=a0_0x3ca044;try{const {FromWareHouse:_0x4c398a,FromRoom:_0x26fbe3,ToWarehouse:_0x542592,ToRoom:_0x1d3d14,secondary_code:_0x2654e1}=_0x3e06db[_0x580dff(0x16d)],_0x30adbc=await warehouse[_0x580dff(0x17c)]([{'$match':{'name':_0x4c398a}},{'$unwind':_0x580dff(0xd7)},{'$match':{'product_details.secondary_code':_0x2654e1}},{'$group':{'_id':_0x580dff(0x13c),'name':{'$first':_0x580dff(0x198)},'primary_code':{'$first':_0x580dff(0x15f)},'secondary_code':{'$first':_0x580dff(0x15e)},'product_code':{'$first':_0x580dff(0x197)},'instock':{'$first':_0x580dff(0xf1)},'warehouse':{'$first':_0x580dff(0x163)},'level':{'$first':_0x580dff(0x16c)},'isle':{'$first':_0x580dff(0x12b)},'pallet':{'$first':_0x580dff(0x113)},'maxProducts':{'$first':_0x580dff(0xd4)},'unit':{'$first':_0x580dff(0x123)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'}}}]);_0x4909b2[_0x580dff(0x148)](0xc8)[_0x580dff(0xe1)](_0x30adbc);}catch(_0x534faf){_0x4909b2[_0x580dff(0x148)](0x194)[_0x580dff(0xe1)]({'message':_0x534faf[_0x580dff(0x137)]});}}),router[a0_0x3ca044(0x18c)](a0_0x3ca044(0x181),async(_0xc4af9f,_0x50d3be)=>{var _0x1f50e9=a0_0x3ca044;try{const {FromWareHouse:_0x48cdf1,FromRoom:_0x176351,ToWarehouse:_0x21806f,ToRoom:_0xff8619,product_code:_0x16ac9d}=_0xc4af9f['body'],_0x2d6f76=await warehouse[_0x1f50e9(0x17c)]([{'$match':{'name':_0x48cdf1}},{'$unwind':_0x1f50e9(0xd7)},{'$match':{'product_details.product_code':_0x16ac9d}},{'$group':{'_id':_0x1f50e9(0x13c),'name':{'$first':_0x1f50e9(0x198)},'primary_code':{'$first':_0x1f50e9(0x15f)},'secondary_code':{'$first':_0x1f50e9(0x15e)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x1f50e9(0xf1)},'warehouse':{'$first':'$name'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x1f50e9(0x12b)},'pallet':{'$first':_0x1f50e9(0x113)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':'$product_details.unit'}}}]);_0x50d3be['status'](0xc8)[_0x1f50e9(0xe1)](_0x2d6f76);}catch(_0x439bfe){_0x50d3be['status'](0x194)[_0x1f50e9(0xe1)]({'message':_0x439bfe['message']});}}),router[a0_0x3ca044(0x18c)](a0_0x3ca044(0x12a),async(_0x5e8a75,_0x270a87)=>{var _0x4ac249=a0_0x3ca044;const {productCode:_0x2ba5cd,bay:_0x5e49a8,warehouses:_0x120aec,room:_0x58f2f2}=_0x5e8a75[_0x4ac249(0x16d)];console['log'](_0x5e8a75[_0x4ac249(0x16d)]);try{const _0x48c777=await warehouse[_0x4ac249(0x17c)]([{'$match':{'name':_0x120aec,'room':_0x58f2f2}},{'$unwind':_0x4ac249(0xd7)},{'$match':{'product_details.bay':parseInt(_0x5e49a8)}},{'$group':{'_id':_0x4ac249(0x13c),'name':{'$first':_0x4ac249(0x198)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4ac249(0x15b)},'maxProducts':{'$first':_0x4ac249(0xd4)}}}]);_0x270a87[_0x4ac249(0x148)](0xc8)[_0x4ac249(0xe1)](_0x48c777);}catch(_0x354a0f){_0x270a87[_0x4ac249(0x148)](0x194)[_0x4ac249(0xe1)]({'message':_0x354a0f[_0x4ac249(0x137)]});}}),module[a0_0x3ca044(0x11a)]=router;