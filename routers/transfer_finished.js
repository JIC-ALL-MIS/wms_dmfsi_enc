function a0_0x536e(){var _0xb8c058=['get','image','</thead>','concat','Rack\x202','True','\x20</h2>','English','flash','from_prod_level','Transfer\x20Edit\x20Successfully','production_date','Transfer\x20Mail','_id','$product_details','$product_details.production_date','$product.to_room_name','catch','status','$product_details.unit','</head><body>','<hr\x20class=\x22my-3\x22>','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','to_floorlevel','find','/barcode_scanner2','RoomAssigned','to_warehouse','/transfer_finished/preview/','$product_details.invoice','aggregate','$product_details._id','574797fUyMhz','Email\x20sent\x20successfully','$product_details.expiry_date','/CheckingWarehouse','$_id','batch_code','slice','$product_details.product_code','Arabic','transfer_finished','primary_unit','Enabled','<strong>\x20Regards\x20</strong>','$product_details.secondary_code','$product_details.pallet','$product_details.product_stock','</span>','port','save','createTransport','maxProducts','map','findById','errors','/view/add_transfer','TRFF-','French','prod_name','from_quantity','Ambient','error','edit_transfer_finished_view','to_invoice','$product_details.rack','/transfer/view','site_title','to_room','warehouse','$product_details.secondary_unit','from_invoice','<span\x20style=\x22float:\x20right;\x22>','Portuguese\x20(BR)','$product_details.maxPerUnit','15612KbyxVQ','/../public','post','to_prod_level','product_code3','express','New_Qty_Converted','\x20Order\x20Number\x20:\x20','date','$product.from_room_name','../public/language/languages.json','Chinese','length','logo','<!DOCTYPE\x20html>','$product_details.product_name','Error\x20Occurs','sendMail','all','512652rLISBs','staff','from_bay','/view/:id','MaxStocks_data2','bay','1148KROQuU','Portuguese','json','9fHICDG','<div>','language','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','Arabic\x20(ae)','to_prod_qty','render','floor','$product_details.primary_code','role','1725328omaGyq','/barcode_scanner','$product_details.batch_code','<h5\x20style=\x22text-align:\x20left;\x22>','getFullYear','$product_details.isle','<table\x20style=\x22width:\x20100%\x20!important;\x22>','from_room','$room','German','An\x20error\x20occurred.','8FSLvht','910878ZPFJMr','1563360nnxNDj','getDate','$name','$product_details.type','filter','An\x20error\x20occurred\x20while\x20saving\x20data.','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','push','getMonth','$product_details.bay','$product_details.floorlevel','prod_cat','expiry_date','</tr>','secondary_code','body','/upload/','QA\x20Warehouse','success','<html><head><title></title>','findOne','<tbody\x20style=\x22text-align:\x20center;\x22>','To_invoice','English\x20(US)','invoice','string','updateOne','Logo.png','product_details','product_stock','product','toString','from_warehouse','user','product_name','product_date','$product_details.maxProducts','to_quantity','product_code','unit','Rack\x201','secondary_unit','FGSEmail','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','</div>','MaxStocks_data','maxPerUnit','Hindi','finalize','/barcode_scanner3','to_bay','then','$product_details.storage','params','<tr>','FROZEN\x20GOODS','padStart','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.level','primary_code','from_room_name','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.bin','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</td>','$invoice','from_prod_qty','Finished\x20Goods','log','redirect','random','Spanish','message','note','forEach','$finalize','/preview/:id','15908570jdWDPH','email','add_transfer_finished','</body></html>'];a0_0x536e=function(){return _0xb8c058;};return a0_0x536e();}var a0_0xea8ec7=a0_0x233e;(function(_0x23d62a,_0x1ce274){var _0x43dd8b=a0_0x233e,_0x71d3c4=_0x23d62a();while(!![]){try{var _0x538461=-parseInt(_0x43dd8b(0x110))/0x1+parseInt(_0x43dd8b(0x14e))/0x2+-parseInt(_0x43dd8b(0x16d))/0x3*(parseInt(_0x43dd8b(0x16c))/0x4)+parseInt(_0x43dd8b(0x16e))/0x5+parseInt(_0x43dd8b(0x13b))/0x6*(-parseInt(_0x43dd8b(0x154))/0x7)+-parseInt(_0x43dd8b(0x161))/0x8+parseInt(_0x43dd8b(0x157))/0x9*(parseInt(_0x43dd8b(0x1be))/0xa);if(_0x538461===_0x1ce274)break;else _0x71d3c4['push'](_0x71d3c4['shift']());}catch(_0x1e62d5){_0x71d3c4['push'](_0x71d3c4['shift']());}}}(a0_0x536e,0x51e34));const express=require(a0_0xea8ec7(0x140)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0xea8ec7(0x145)),nodemailer=require(a0_0xea8ec7(0x1af));function a0_0x233e(_0xa8ecf1,_0x2b3121){var _0x536e5e=a0_0x536e();return a0_0x233e=function(_0x233ed1,_0x244253){_0x233ed1=_0x233ed1-0xec;var _0x126c74=_0x536e5e[_0x233ed1];return _0x126c74;},a0_0x233e(_0xa8ecf1,_0x2b3121);}router['get']('/view',auth,async(_0x2158c3,_0x21f247)=>{var _0x12ca1d=a0_0xea8ec7;try{const {username:_0x23b78f,email:_0x45ef22,role:_0x3dbd66}=_0x2158c3['user'],_0x1dd07d=_0x2158c3[_0x12ca1d(0x18f)],_0x1a21d0=await profile[_0x12ca1d(0x182)]({'email':_0x1dd07d[_0x12ca1d(0xec)]}),_0x124b5b=await master_shop[_0x12ca1d(0x108)]();let _0x1f3846;if(_0x1dd07d[_0x12ca1d(0x160)]==_0x12ca1d(0x14f)){const _0x52179c=await staff[_0x12ca1d(0x182)]({'email':_0x1dd07d[_0x12ca1d(0xec)]});_0x1f3846=await transfers_finished[_0x12ca1d(0x108)]({'from_warehouse':_0x52179c[_0x12ca1d(0x135)]});}else _0x1f3846=await transfers_finished[_0x12ca1d(0x10e)]([{'$unwind':'$product'},{'$group':{'_id':_0x12ca1d(0x114),'invoice':{'$first':_0x12ca1d(0x1b2)},'date':{'$first':'$date'},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x12ca1d(0x144)},'to_room_name':{'$addToSet':_0x12ca1d(0xff)},'finalize':{'$first':_0x12ca1d(0x1bc)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x124b5b[0x0][_0x12ca1d(0x159)]==_0x12ca1d(0x185))var _0x5960b7=users['English'];else{if(_0x124b5b[0x0]['language']=='Hindi')var _0x5960b7=users[_0x12ca1d(0x19f)];else{if(_0x124b5b[0x0]['language']=='German')var _0x5960b7=users[_0x12ca1d(0x16a)];else{if(_0x124b5b[0x0][_0x12ca1d(0x159)]=='Spanish')var _0x5960b7=users[_0x12ca1d(0x1b8)];else{if(_0x124b5b[0x0][_0x12ca1d(0x159)]=='French')var _0x5960b7=users[_0x12ca1d(0x12a)];else{if(_0x124b5b[0x0][_0x12ca1d(0x159)]=='Portuguese\x20(BR)')var _0x5960b7=users['Portuguese'];else{if(_0x124b5b[0x0][_0x12ca1d(0x159)]==_0x12ca1d(0x146))var _0x5960b7=users[_0x12ca1d(0x146)];else{if(_0x124b5b[0x0][_0x12ca1d(0x159)]==_0x12ca1d(0x15b))var _0x5960b7=users[_0x12ca1d(0x118)];}}}}}}}_0x21f247['render'](_0x12ca1d(0x119),{'success':_0x2158c3[_0x12ca1d(0xf7)](_0x12ca1d(0x180)),'errors':_0x2158c3[_0x12ca1d(0xf7)](_0x12ca1d(0x127)),'role':_0x1dd07d,'profile':_0x1a21d0,'master_shop':_0x124b5b,'transfer':_0x1f3846,'language':_0x5960b7});}catch(_0x2ce7fa){console['log'](_0x2ce7fa);}});async function getRandom8DigitNumber(){var _0x5d3012=a0_0xea8ec7;const _0x577bed=0x989680,_0x60b76b=0x5f5e0ff,_0x215db5=Math[_0x5d3012(0x15e)](Math[_0x5d3012(0x1b7)]()*(_0x60b76b-_0x577bed+0x1))+_0x577bed;var _0x3fce38;const _0x548b1d=await transfers_finished[_0x5d3012(0x182)]({'invoice':_0x5d3012(0x129)+_0x215db5});return _0x548b1d&&_0x548b1d[_0x5d3012(0x147)]>0x0?_0x3fce38=_0x5d3012(0x129)+_0x215db5:_0x3fce38=_0x5d3012(0x129)+_0x215db5,_0x3fce38;}router['get'](a0_0xea8ec7(0x128),auth,async(_0x2aed4d,_0x1a1b03)=>{var _0x407691=a0_0xea8ec7;try{const {username:_0xee09a8,email:_0x1f785d,role:_0x406b77}=_0x2aed4d[_0x407691(0x18f)],_0x158ad8=_0x2aed4d[_0x407691(0x18f)],_0x4171bc=await profile[_0x407691(0x182)]({'email':_0x158ad8[_0x407691(0xec)]}),_0x499613=await master_shop[_0x407691(0x108)]();let _0x34bde0;if(_0x158ad8[_0x407691(0x160)]=='staff'){const _0x5f5173=await staff[_0x407691(0x182)]({'email':_0x158ad8['email']});_0x34bde0=await warehouse[_0x407691(0x10e)]([{'$match':{'status':_0x407691(0x11b),'name':_0x5f5173['warehouse'],'warehouse_category':_0x407691(0x1b4),'name':{'$ne':_0x407691(0x17f)}}},{'$group':{'_id':_0x407691(0x170),'name':{'$first':_0x407691(0x170)}}}]);}else _0x34bde0=await warehouse[_0x407691(0x10e)]([{'$match':{'status':_0x407691(0x11b),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x407691(0x17f)}}},{'$group':{'_id':'$name','name':{'$first':_0x407691(0x170)}}}]);const _0xdaa1e0=await transfers_finished[_0x407691(0x108)]({}),_0x587af0=_0xdaa1e0[_0x407691(0x147)]+0x1,_0x4c95f3='TRFF-'+_0x587af0[_0x407691(0x18d)]()[_0x407691(0x1a8)](0x5,'0');if(_0x499613[0x0][_0x407691(0x159)]=='English\x20(US)')var _0x540ef3=users[_0x407691(0xf6)];else{if(_0x499613[0x0][_0x407691(0x159)]==_0x407691(0x19f))var _0x540ef3=users[_0x407691(0x19f)];else{if(_0x499613[0x0][_0x407691(0x159)]==_0x407691(0x16a))var _0x540ef3=users[_0x407691(0x16a)];else{if(_0x499613[0x0][_0x407691(0x159)]==_0x407691(0x1b8))var _0x540ef3=users[_0x407691(0x1b8)];else{if(_0x499613[0x0][_0x407691(0x159)]==_0x407691(0x12a))var _0x540ef3=users[_0x407691(0x12a)];else{if(_0x499613[0x0][_0x407691(0x159)]==_0x407691(0x139))var _0x540ef3=users[_0x407691(0x155)];else{if(_0x499613[0x0]['language']==_0x407691(0x146))var _0x540ef3=users[_0x407691(0x146)];else{if(_0x499613[0x0][_0x407691(0x159)]==_0x407691(0x15b))var _0x540ef3=users['Arabic'];}}}}}}}const _0x56381a=getRandom8DigitNumber();_0x56381a[_0x407691(0x1a3)](_0x4113e6=>{var _0x3aaafe=_0x407691;_0x1a1b03['render'](_0x3aaafe(0xed),{'success':_0x2aed4d[_0x3aaafe(0xf7)](_0x3aaafe(0x180)),'errors':_0x2aed4d['flash']('errors'),'role':_0x158ad8,'profile':_0x4171bc,'master_shop':_0x499613,'warehouse':_0x34bde0,'language':_0x540ef3,'invoice':_0x4113e6});})[_0x407691(0x100)](_0x515c17=>{var _0x1392a9=_0x407691;_0x2aed4d[_0x1392a9(0xf7)](_0x1392a9(0x127),_0x1392a9(0x1a9)),_0x1a1b03[_0x1392a9(0x1b6)](_0x1392a9(0x132));});}catch(_0x3bdaf7){console[_0x407691(0x1b5)](_0x3bdaf7);}}),router[a0_0xea8ec7(0x13d)](a0_0xea8ec7(0x128),auth,async(_0x2b2d69,_0xdf7ec6)=>{var _0xe95840=a0_0xea8ec7;try{const {date:_0x52bbfd,from_warehouse:_0x4eae16,FromRoom_name:_0x31c2fd,to_warehouse:_0x1155b7,ToRoom_name:_0x58d960,prod_name:_0x457506,from_prod_qty:_0x483df2,from_prod_level:_0x2a191c,from_prod_isle:_0x549bab,from_prod_pallet:_0x331ef5,to_prod_qty:_0x4bde54,to_prod_level:_0x5380bc,to_prod_isle:_0x525667,to_prod_pallet:_0x24d2c5,primary_code:_0x202534,secondary_code:_0x30a937,product_code3:_0x425714,note:_0x834c06,MaxStocks_data2:_0x4dbf28,invoice:_0x2ee3c6,expiry_date:_0x210c12}=_0x2b2d69[_0xe95840(0x17d)];if(typeof _0x457506=='string')var _0x123f53=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x12b)]],_0x4a88c1=[_0x2b2d69[_0xe95840(0x17d)]['from_prod_qty']],_0x5cbb94=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0xf8)]],_0x24cc26=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x141)]],_0x1055e0=[_0x2b2d69['body']['to_prod_level']],_0x15737b=[_0x2b2d69[_0xe95840(0x17d)]['primary_code']],_0x33c65a=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x17c)]],_0x13d0b5=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x13f)]],_0x4c5fcd=[_0x2b2d69['body'][_0xe95840(0x152)]],_0x30f4e6=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x11a)]],_0x5e4475=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x197)]],_0x498a47=[_0x2b2d69['body'][_0xe95840(0x115)]],_0x595268=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x17a)]],_0x25e882=[_0x2b2d69[_0xe95840(0x17d)]['product_date']],_0x51920f=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x19d)]],_0x2ed91d=[_0x2b2d69['body'][_0xe95840(0x19e)]],_0x245341=[_0x2b2d69['body']['prod_cat']],_0x2f0a1f=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x10a)]],_0x1efb23=[_0x2b2d69[_0xe95840(0x17d)]['ToRoomAssigned']],_0xa29e52=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x137)]],_0x2443d4=[_0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x130)]];else var _0x123f53=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x12b)]],_0x4a88c1=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x1b3)]],_0x5cbb94=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0xf8)]],_0x24cc26=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x141)]],_0x1055e0=[..._0x2b2d69['body'][_0xe95840(0x13e)]],_0x15737b=[..._0x2b2d69['body']['primary_code']],_0x33c65a=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x17c)]],_0x13d0b5=[..._0x2b2d69['body']['product_code3']],_0x4c5fcd=[..._0x2b2d69[_0xe95840(0x17d)]['MaxStocks_data2']],_0x30f4e6=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x11a)]],_0x5e4475=[..._0x2b2d69[_0xe95840(0x17d)]['secondary_unit']],_0x498a47=[..._0x2b2d69['body'][_0xe95840(0x115)]],_0x595268=[..._0x2b2d69[_0xe95840(0x17d)]['expiry_date']],_0x25e882=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x191)]],_0x51920f=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x19d)]],_0x2ed91d=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x19e)]],_0x245341=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x179)]],_0x2f0a1f=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x10a)]],_0x1efb23=[..._0x2b2d69[_0xe95840(0x17d)]['ToRoomAssigned']],_0xa29e52=[..._0x2b2d69[_0xe95840(0x17d)][_0xe95840(0x137)]],_0x2443d4=[..._0x2b2d69[_0xe95840(0x17d)]['to_invoice']];const _0xa86015=_0x123f53[_0xe95840(0x125)](_0x4047e7=>{return _0x4047e7={'product_name':_0x4047e7};});_0x4a88c1[_0xe95840(0x1bb)]((_0x279483,_0xb5102c)=>{var _0x43e39c=_0xe95840;_0xa86015[_0xb5102c][_0x43e39c(0x12c)]=_0x279483;}),_0x5cbb94[_0xe95840(0x1bb)]((_0x49e16d,_0x4395be)=>{var _0x2d0e74=_0xe95840;_0xa86015[_0x4395be][_0x2d0e74(0x150)]=_0x49e16d;}),_0xa29e52[_0xe95840(0x1bb)]((_0x1aedc5,_0x55adea)=>{var _0x11ad5b=_0xe95840;_0xa86015[_0x55adea][_0x11ad5b(0x137)]=_0x1aedc5;}),_0x2443d4['forEach']((_0x3c2119,_0x402f7a)=>{var _0x26f4a8=_0xe95840;_0xa86015[_0x402f7a][_0x26f4a8(0x184)]=_0x3c2119;}),_0x24cc26[_0xe95840(0x1bb)]((_0x343bd8,_0x430943)=>{_0xa86015[_0x430943]['to_quantity']=_0x343bd8;}),_0x1055e0[_0xe95840(0x1bb)]((_0x14bc70,_0x59bfb9)=>{var _0x47adcb=_0xe95840;_0xa86015[_0x59bfb9][_0x47adcb(0x1a2)]=_0x14bc70;}),_0x15737b[_0xe95840(0x1bb)]((_0x36443b,_0x35ddba)=>{var _0x16164c=_0xe95840;_0xa86015[_0x35ddba][_0x16164c(0x1ab)]=_0x36443b;}),_0x33c65a[_0xe95840(0x1bb)]((_0x362838,_0x2c6a15)=>{var _0x4edf56=_0xe95840;_0xa86015[_0x2c6a15][_0x4edf56(0x17c)]=_0x362838;}),_0x13d0b5[_0xe95840(0x1bb)]((_0x57ef05,_0x570c9e)=>{var _0x181645=_0xe95840;_0xa86015[_0x570c9e][_0x181645(0x194)]=_0x57ef05;}),_0x4c5fcd[_0xe95840(0x1bb)]((_0x583106,_0x139233)=>{var _0x307b94=_0xe95840;_0xa86015[_0x139233][_0x307b94(0x124)]=_0x583106;}),_0x30f4e6[_0xe95840(0x1bb)]((_0xbc92a9,_0x3ae922)=>{_0xa86015[_0x3ae922]['unit']=_0xbc92a9;}),_0x5e4475[_0xe95840(0x1bb)]((_0x4cca36,_0x22c6fb)=>{var _0x2003f4=_0xe95840;_0xa86015[_0x22c6fb][_0x2003f4(0x197)]=_0x4cca36;}),_0x498a47['forEach']((_0x5374ec,_0x2189c8)=>{var _0x3e82f6=_0xe95840;_0xa86015[_0x2189c8][_0x3e82f6(0x115)]=_0x5374ec;}),_0x595268[_0xe95840(0x1bb)]((_0x4ff548,_0x486df6)=>{var _0x2363b3=_0xe95840;_0xa86015[_0x486df6][_0x2363b3(0x17a)]=_0x4ff548;}),_0x25e882[_0xe95840(0x1bb)]((_0x39a004,_0x4127b4)=>{var _0x371dcb=_0xe95840;_0xa86015[_0x4127b4][_0x371dcb(0xfa)]=_0x39a004;}),_0x51920f[_0xe95840(0x1bb)]((_0x51b185,_0x1f2c56)=>{_0xa86015[_0x1f2c56]['maxProducts']=_0x51b185;}),_0x2ed91d[_0xe95840(0x1bb)]((_0x3fb64f,_0x220017)=>{var _0xd9ea1b=_0xe95840;_0xa86015[_0x220017][_0xd9ea1b(0x19e)]=_0x3fb64f;}),_0x245341['forEach']((_0x4a5fed,_0xb799c9)=>{var _0x27cedf=_0xe95840;_0xa86015[_0xb799c9][_0x27cedf(0x179)]=_0x4a5fed;}),_0x2f0a1f['forEach']((_0x4d6cf5,_0x44cd7f)=>{var _0x3b591d=_0xe95840;_0xa86015[_0x44cd7f][_0x3b591d(0x1ac)]=_0x4d6cf5;}),_0x1efb23[_0xe95840(0x1bb)]((_0x2b7f61,_0x70b596)=>{_0xa86015[_0x70b596]['to_room_name']=_0x2b7f61;});const _0x5219bd=_0xa86015['filter'](_0x1c4fa7=>_0x1c4fa7[_0xe95840(0x193)]!=='0'&&_0x1c4fa7[_0xe95840(0x193)]!==''||_0x1c4fa7['to_floorlevel']!=='0'&&_0x1c4fa7['to_floorlevel']!=='');var _0x5b7ae1=0x0;_0x5219bd['forEach'](_0x461752=>{var _0x2e70cd=_0xe95840;parseInt(_0x461752['from_quantity'])<parseInt(_0x461752[_0x2e70cd(0x193)])&&_0x5b7ae1++;});if(_0x5b7ae1!=0x0)return _0x2b2d69[_0xe95840(0xf7)](_0xe95840(0x127),_0xe95840(0x1ad)),_0xdf7ec6['redirect']('back');const _0x1e36da=new transfers_finished({'date':_0x52bbfd,'from_warehouse':_0x4eae16,'to_warehouse':_0x1155b7,'product':_0x5219bd,'note':_0x834c06,'invoice':_0x2ee3c6}),_0x29f121=await _0x1e36da[_0xe95840(0x122)]();_0x2b2d69[_0xe95840(0xf7)](_0xe95840(0x180),'Product\x20Transfer\x20successfully'),_0xdf7ec6[_0xe95840(0x1b6)](_0xe95840(0x10c)+_0x29f121[_0xe95840(0xfc)]);}catch(_0x3a2fbe){console[_0xe95840(0x1b5)](_0x3a2fbe),_0xdf7ec6[_0xe95840(0x101)](0xc8)[_0xe95840(0x156)]({'errorMessage':_0x3a2fbe[_0xe95840(0x1b9)]});}}),router[a0_0xea8ec7(0xef)](a0_0xea8ec7(0x1bd),auth,async(_0x3c020a,_0x4e2e9d)=>{var _0x1b7ee0=a0_0xea8ec7;try{const {username:_0x4752a2,email:_0xd64b2c,role:_0x5d5847}=_0x3c020a[_0x1b7ee0(0x18f)],_0x34c39c=_0x3c020a[_0x1b7ee0(0x18f)],_0x40796=await profile['findOne']({'email':_0x34c39c[_0x1b7ee0(0xec)]}),_0x5d567d=await master_shop[_0x1b7ee0(0x108)](),_0x172710=await transfers_finished[_0x1b7ee0(0x126)](_0x3c020a[_0x1b7ee0(0x1a5)]['id']);let _0x49fd1c;if(_0x34c39c[_0x1b7ee0(0x160)]==_0x1b7ee0(0x14f)){const _0x30e5c4=await staff['findOne']({'email':_0x34c39c['email']});_0x49fd1c=await warehouse[_0x1b7ee0(0x108)]({'status':_0x1b7ee0(0x11b),'name':_0x30e5c4[_0x1b7ee0(0x135)],'warehouse_category':_0x1b7ee0(0x1b4)});}else _0x49fd1c=await warehouse[_0x1b7ee0(0x108)]({'status':_0x1b7ee0(0x11b),'warehouse_category':_0x1b7ee0(0x1b4)});const _0x116696=await warehouse[_0x1b7ee0(0x10e)]([{'$match':{'name':_0x172710[_0x1b7ee0(0x18e)],'warehouse_category':_0x1b7ee0(0x1b4)}},{'$unwind':_0x1b7ee0(0xfd)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1b7ee0(0x11f)},'bay':{'$first':_0x1b7ee0(0x177)},'bin':{'$first':_0x1b7ee0(0x1ae)},'type':{'$first':_0x1b7ee0(0x171)},'floorlevel':{'$first':_0x1b7ee0(0x178)},'primary_code':{'$first':_0x1b7ee0(0x15f)},'secondary_code':{'$first':_0x1b7ee0(0x11d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x1b7ee0(0x1a4)},'rack':{'$first':_0x1b7ee0(0x131)},'expiry_date':{'$first':_0x1b7ee0(0x112)},'production_date':{'$first':_0x1b7ee0(0xfe)},'room':{'$first':_0x1b7ee0(0x169)},'warehoue_name':{'$first':'$name'}}}]),_0x4bd36f=await product[_0x1b7ee0(0x108)]({});if(_0x5d567d[0x0][_0x1b7ee0(0x159)]==_0x1b7ee0(0x185)){var _0x39303c=users[_0x1b7ee0(0xf6)];console[_0x1b7ee0(0x1b5)](_0x39303c);}else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]=='Hindi')var _0x39303c=users['Hindi'];else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]==_0x1b7ee0(0x16a))var _0x39303c=users['German'];else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]=='Spanish')var _0x39303c=users[_0x1b7ee0(0x1b8)];else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]==_0x1b7ee0(0x12a))var _0x39303c=users[_0x1b7ee0(0x12a)];else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]==_0x1b7ee0(0x139))var _0x39303c=users['Portuguese'];else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]==_0x1b7ee0(0x146))var _0x39303c=users[_0x1b7ee0(0x146)];else{if(_0x5d567d[0x0][_0x1b7ee0(0x159)]==_0x1b7ee0(0x15b))var _0x39303c=users['Arabic'];}}}}}}}_0x4e2e9d[_0x1b7ee0(0x15d)](_0x1b7ee0(0x12f),{'success':_0x3c020a[_0x1b7ee0(0xf7)](_0x1b7ee0(0x180)),'errors':_0x3c020a['flash'](_0x1b7ee0(0x127)),'role':_0x34c39c,'profile':_0x40796,'master_shop':_0x5d567d,'warehouse':_0x49fd1c,'transfer':_0x172710,'stock':_0x116696,'unit':_0x4bd36f,'language':_0x39303c});}catch(_0x184f26){console[_0x1b7ee0(0x1b5)](_0x184f26);}}),router[a0_0xea8ec7(0x13d)](a0_0xea8ec7(0x1bd),auth,async(_0x8e083d,_0x5e7809)=>{var _0x3c507f=a0_0xea8ec7;try{const {invoice:_0x5a21c3,from_warehouse:_0x1233c1,FromRoom_name:_0x1f3fb2,to_warehouse:_0x595732,ToRoom_name:_0x4cf4cf}=_0x8e083d[_0x3c507f(0x17d)],_0x3e6514=await transfers_finished[_0x3c507f(0x126)](_0x8e083d['params']['id']),_0x274639=_0x3e6514['product'][_0x3c507f(0x125)](async _0x50d1ad=>{var _0x16be09=_0x3c507f;if(_0x50d1ad[_0x16be09(0x193)]>0x0){var _0x345640=await warehouse['findOne']({'name':_0x1233c1,'room':_0x50d1ad['from_room_name'],'warehouse_category':'Finished\x20Goods'});const _0x3a2aa0=_0x345640[_0x16be09(0x18a)][_0x16be09(0x125)](_0x5456c9=>{var _0x772bc7=_0x16be09;_0x5456c9[_0x772bc7(0x190)]==_0x50d1ad[_0x772bc7(0x190)]&&_0x5456c9[_0x772bc7(0x153)]==_0x50d1ad[_0x772bc7(0x150)]&&_0x5456c9[_0x772bc7(0x17a)]==_0x50d1ad[_0x772bc7(0x17a)]&&_0x5456c9[_0x772bc7(0xfa)]==_0x50d1ad[_0x772bc7(0xfa)]&&_0x5456c9['batch_code']==_0x50d1ad[_0x772bc7(0x115)]&&_0x5456c9[_0x772bc7(0x186)]==_0x50d1ad[_0x772bc7(0x137)]&&(_0x5456c9[_0x772bc7(0x18b)]=_0x5456c9[_0x772bc7(0x18b)]-_0x50d1ad['to_quantity']);});}return _0x345640;});Promise[_0x3c507f(0x14d)](_0x274639)[_0x3c507f(0x1a3)](async _0x5a1c60=>{var _0x3f4e2d=_0x3c507f;try{for(const _0x36d501 of _0x5a1c60){await _0x36d501[_0x3f4e2d(0x122)]();}const _0x47e9ba=_0x3e6514[_0x3f4e2d(0x18c)][_0x3f4e2d(0x125)](async _0x5578a5=>{var _0x805d19=_0x3f4e2d,_0x11fd38=await warehouse[_0x805d19(0x182)]({'name':_0x595732,'room':_0x5578a5['to_room_name']});if(_0x5578a5['to_quantity']>0x0){var _0x4b47fc=0x0;const _0x52d5a9=_0x11fd38['product_details']['map'](_0x2f57b6=>{var _0x4c8bcd=_0x805d19;_0x2f57b6[_0x4c8bcd(0x190)]==_0x5578a5[_0x4c8bcd(0x190)]&&_0x2f57b6[_0x4c8bcd(0x153)]==_0x5578a5[_0x4c8bcd(0x1a2)]&&_0x2f57b6[_0x4c8bcd(0x17a)]==_0x5578a5[_0x4c8bcd(0x17a)]&&_0x2f57b6[_0x4c8bcd(0xfa)]==_0x5578a5[_0x4c8bcd(0xfa)]&&_0x2f57b6[_0x4c8bcd(0x115)]==_0x5578a5['batch_code']&&_0x2f57b6[_0x4c8bcd(0x186)]==_0x5578a5['To_invoice']&&(_0x2f57b6[_0x4c8bcd(0x18b)]=_0x2f57b6[_0x4c8bcd(0x18b)]+_0x5578a5[_0x4c8bcd(0x193)],_0x4b47fc++);});_0x4b47fc=='0'&&(_0x11fd38['product_details']=_0x11fd38[_0x805d19(0x18a)][_0x805d19(0xf2)]({'product_name':_0x5578a5[_0x805d19(0x190)],'product_stock':_0x5578a5[_0x805d19(0x193)],'bay':_0x5578a5['to_bay'],'product_code':_0x5578a5[_0x805d19(0x194)],'primary_code':_0x5578a5[_0x805d19(0x1ab)],'secondary_code':_0x5578a5['secondary_code'],'expiry_date':_0x5578a5['expiry_date'],'production_date':_0x5578a5[_0x805d19(0xfa)],'maxProducts':_0x5578a5[_0x805d19(0x124)],'batch_code':_0x5578a5[_0x805d19(0x115)],'secondary_unit':_0x5578a5['secondary_unit'],'unit':_0x5578a5[_0x805d19(0x195)],'maxProducts':_0x5578a5[_0x805d19(0x124)],'maxPerUnit':_0x5578a5[_0x805d19(0x19e)],'invoice':_0x5578a5[_0x805d19(0x184)]}));}return _0x11fd38;});Promise[_0x3f4e2d(0x14d)](_0x47e9ba)['then'](async _0xa42d81=>{var _0x57990d=_0x3f4e2d;try{for(const _0x5a9015 of _0xa42d81){await warehouse[_0x57990d(0x188)]({'_id':_0x5a9015[_0x57990d(0xfc)]},{'$addToSet':{'product_details':{'$each':_0x5a9015[_0x57990d(0x18a)]}}});}_0x3e6514[_0x57990d(0x1a0)]=_0x57990d(0xf4);const _0x1aedea=await _0x3e6514[_0x57990d(0x122)](),_0x5b783b=await master_shop[_0x57990d(0x108)](),_0x3d2693=await email_settings[_0x57990d(0x182)](),_0x48d799=await supervisor_settings[_0x57990d(0x108)]();var _0x2fc9e1=_0x3e6514[_0x57990d(0x18c)],_0x44cea2='',_0x210c5d;for(_0x210c5d in _0x2fc9e1){var _0x107dba='FG';_0x3e6514[_0x57990d(0x10b)]=='DRY\x20GOODS'&&(_0x107dba='DG'),_0x44cea2+=_0x57990d(0x1a6)+_0x57990d(0x174)+_0x2fc9e1[_0x210c5d][_0x57990d(0x190)]+_0x57990d(0x1b1)+_0x57990d(0x174)+_0x2fc9e1[_0x210c5d][_0x57990d(0x194)]+_0x57990d(0x1b1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2fc9e1[_0x210c5d][_0x57990d(0x193)]+_0x57990d(0x1b1)+_0x57990d(0x174)+_0x2fc9e1[_0x210c5d]['unit']+'</td>'+_0x57990d(0x174)+_0x2fc9e1[_0x210c5d][_0x57990d(0x197)]+'</td>'+_0x57990d(0x174)+_0x3e6514[_0x57990d(0x10b)]+_0x57990d(0x1b1)+_0x57990d(0x174)+_0x2fc9e1[_0x210c5d]['to_room_name']+_0x57990d(0x1b1)+_0x57990d(0x174)+_0x107dba+_0x2fc9e1[_0x210c5d][_0x57990d(0x1a2)]+_0x57990d(0x1b1)+_0x57990d(0x17b);}let _0x452f9d=nodemailer[_0x57990d(0x123)]({'host':_0x3d2693['host'],'port':Number(_0x3d2693[_0x57990d(0x121)]),'secure':![],'auth':{'user':_0x3d2693[_0x57990d(0xec)],'pass':_0x3d2693[_0x57990d(0x105)]}}),_0x2c35a4={'from':_0x3d2693[_0x57990d(0xec)],'to':_0x48d799[0x0][_0x57990d(0x198)],'subject':_0x57990d(0xfb),'attachments':[{'filename':_0x57990d(0x189),'path':__dirname+_0x57990d(0x13c)+_0x57990d(0x17e)+_0x5b783b[0x0][_0x57990d(0xf0)],'cid':_0x57990d(0x148)}],'html':_0x57990d(0x149)+_0x57990d(0x181)+_0x57990d(0x103)+_0x57990d(0x158)+_0x57990d(0x199)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x57990d(0x19c)+_0x57990d(0x158)+'<h2>\x20'+_0x5b783b[0x0][_0x57990d(0x133)]+_0x57990d(0xf5)+_0x57990d(0x19c)+_0x57990d(0x19c)+_0x57990d(0x104)+_0x57990d(0x158)+_0x57990d(0x164)+_0x57990d(0x142)+_0x3e6514[_0x57990d(0x186)]+'\x20'+_0x57990d(0x138)+'\x20Order\x20Date\x20:\x20'+_0x3e6514[_0x57990d(0x143)]+'\x20'+_0x57990d(0x120)+'</h5>'+'</div>'+_0x57990d(0x167)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x57990d(0x106)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x57990d(0x1b0)+_0x57990d(0x19b)+'</tr>'+_0x57990d(0xf1)+_0x57990d(0x183)+'\x20'+_0x44cea2+'\x20'+'</tbody>'+'</table>'+_0x57990d(0x158)+_0x57990d(0x11c)+'<h5>'+_0x5b783b[0x0]['site_title']+'</h5>'+_0x57990d(0x19c)+_0x57990d(0x19c)+_0x57990d(0xee)};_0x452f9d[_0x57990d(0x14c)](_0x2c35a4,function(_0x45b420,_0x12c343){var _0x58a777=_0x57990d;_0x45b420?(console[_0x58a777(0x1b5)](_0x45b420),console[_0x58a777(0x1b5)](_0x58a777(0x14b))):console[_0x58a777(0x1b5)](_0x58a777(0x111));}),_0x8e083d[_0x57990d(0xf7)](_0x57990d(0x180),'Transfer\x20Finalize\x20Successfully'),_0x5e7809['redirect']('/picking_list/PDF_transfer/'+_0x1aedea[_0x57990d(0xfc)]);}catch(_0x4e5072){console[_0x57990d(0x12e)](_0x4e5072),_0x5e7809[_0x57990d(0x101)](0x1f4)['json']({'error':_0x57990d(0x15a)});}})[_0x3f4e2d(0x100)](_0x52f2a6=>{var _0x5610bd=_0x3f4e2d;console[_0x5610bd(0x12e)](_0x52f2a6),_0x5e7809[_0x5610bd(0x101)](0x1f4)[_0x5610bd(0x156)]({'error':'An\x20error\x20occurred.'});});}catch(_0x51cb79){console[_0x3f4e2d(0x12e)](_0x51cb79),_0x5e7809[_0x3f4e2d(0x101)](0x1f4)[_0x3f4e2d(0x156)]({'error':_0x3f4e2d(0x173)});}})[_0x3c507f(0x100)](_0x3b79da=>{var _0x48729d=_0x3c507f;console['error'](_0x3b79da),_0x5e7809[_0x48729d(0x101)](0x1f4)[_0x48729d(0x156)]({'error':_0x48729d(0x16b)});});}catch(_0x190981){_0x5e7809[_0x3c507f(0x156)]({'message':_0x190981[_0x3c507f(0x1b9)]});}});function BayBinSelected(_0x5c87e3,_0x1fda45){var _0x4a199e=a0_0xea8ec7,_0x1526b1=[];let _0xdffc08=[];var _0x5c27ba=[];if(_0x5c87e3=='DRY\x20GOODS'){switch(_0x1fda45){case _0x4a199e(0x196):_0x1526b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4a199e(0xf3):_0x1526b1=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5c27ba=['DG'];}else{if(_0x5c87e3==_0x4a199e(0x1a7)){switch(_0x1fda45){case _0x4a199e(0x196):_0x1526b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x1526b1=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5c27ba=['FG'];}}return{'levels':_0x1526b1,'identify':_0x5c27ba};}router[a0_0xea8ec7(0xef)](a0_0xea8ec7(0x151),auth,async(_0xb3274b,_0x43a813)=>{var _0x2010d4=a0_0xea8ec7;try{const {username:_0x1a00e9,email:_0x528b0f,role:_0x215d59}=_0xb3274b[_0x2010d4(0x18f)],_0x24305d=_0xb3274b[_0x2010d4(0x18f)],_0x4bf85e=await profile[_0x2010d4(0x182)]({'email':_0x24305d[_0x2010d4(0xec)]}),_0x2edb8a=await master_shop['find'](),_0x112cc0=await transfers_finished['findById'](_0xb3274b[_0x2010d4(0x1a5)]['id']);let _0x13e780=new Date(_0x112cc0[_0x2010d4(0x17a)]),_0x3b823d=('0'+_0x13e780[_0x2010d4(0x16f)]())[_0x2010d4(0x116)](-0x2),_0x453039=('0'+(_0x13e780[_0x2010d4(0x176)]()+0x1))['slice'](-0x2),_0x57d04d=_0x13e780[_0x2010d4(0x165)](),_0x546905=_0x57d04d+'-'+_0x453039+'-'+_0x3b823d,_0x34e811;if(_0x24305d['role']==_0x2010d4(0x14f)){const _0x35ebb3=await staff[_0x2010d4(0x182)]({'email':_0x24305d[_0x2010d4(0xec)]});_0x34e811=await warehouse[_0x2010d4(0x108)]({'status':_0x2010d4(0x11b),'name':_0x35ebb3[_0x2010d4(0x135)],'warehouse_category':'Finished\x20Goods'});}else _0x34e811=await warehouse['find']({'status':_0x2010d4(0x11b),'warehouse_category':_0x2010d4(0x1b4)});const _0x16e6eb=await warehouse[_0x2010d4(0x10e)]([{'$match':{'name':_0x112cc0[_0x2010d4(0x18e)],'room':_0x112cc0[_0x2010d4(0x168)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2010d4(0x14a)},'product_stock':{'$first':_0x2010d4(0x11f)},'bay':{'$first':_0x2010d4(0x177)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2010d4(0x178)},'primary_code':{'$first':_0x2010d4(0x15f)},'secondary_code':{'$first':_0x2010d4(0x11d)},'product_code':{'$first':_0x2010d4(0x117)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2010d4(0x131)}}}]);var _0x3b9e5d=[0x1,0x2,0x3,0x4],_0x236051=['A','B','C','D','E','F','G','H','I','J'],_0x326011=[_0x2010d4(0x12d),'Enclosed'];const _0x20ef43=await product[_0x2010d4(0x108)]({}),_0x12c831=BayBinSelected(_0x112cc0[_0x2010d4(0x10b)],_0x112cc0[_0x2010d4(0x134)]);if(_0x2edb8a[0x0]['language']=='English\x20(US)'){var _0x3d13a3=users[_0x2010d4(0xf6)];console[_0x2010d4(0x1b5)](_0x3d13a3);}else{if(_0x2edb8a[0x0]['language']=='Hindi')var _0x3d13a3=users[_0x2010d4(0x19f)];else{if(_0x2edb8a[0x0]['language']==_0x2010d4(0x16a))var _0x3d13a3=users['German'];else{if(_0x2edb8a[0x0][_0x2010d4(0x159)]==_0x2010d4(0x1b8))var _0x3d13a3=users[_0x2010d4(0x1b8)];else{if(_0x2edb8a[0x0]['language']=='French')var _0x3d13a3=users[_0x2010d4(0x12a)];else{if(_0x2edb8a[0x0][_0x2010d4(0x159)]==_0x2010d4(0x139))var _0x3d13a3=users[_0x2010d4(0x155)];else{if(_0x2edb8a[0x0][_0x2010d4(0x159)]==_0x2010d4(0x146))var _0x3d13a3=users[_0x2010d4(0x146)];else{if(_0x2edb8a[0x0][_0x2010d4(0x159)]==_0x2010d4(0x15b))var _0x3d13a3=users[_0x2010d4(0x118)];}}}}}}}_0x43a813[_0x2010d4(0x15d)]('edit_transfer_finished',{'success':_0xb3274b[_0x2010d4(0xf7)]('success'),'errors':_0xb3274b[_0x2010d4(0xf7)](_0x2010d4(0x127)),'role':_0x24305d,'profile':_0x4bf85e,'master_shop':_0x2edb8a,'warehouse':_0x34e811,'transfer':_0x112cc0,'stock':_0x16e6eb,'unit':_0x20ef43,'language':_0x3d13a3,'levels':_0x3b9e5d,'Isle':_0x236051,'rooms_data':_0x326011,'ed_fullDate':_0x546905,'dataSelected':_0x12c831});}catch(_0x53d1d0){console[_0x2010d4(0x1b5)](_0x53d1d0);}}),router['post'](a0_0xea8ec7(0x151),auth,async(_0x596d70,_0x35d318)=>{var _0x440d64=a0_0xea8ec7;try{const _0x53a515=_0x596d70['params']['id'];console['log'](_0x596d70[_0x440d64(0x17d)]);const _0x10d22a=await transfers_finished[_0x440d64(0x126)](_0x53a515);console['log']('transfer_data',_0x10d22a);const {date:_0x4c0bd7,from_warehouse:_0x2127c6,FromRoom_name:_0x3a2038,to_warehouse:_0x85a18,ToRoom_name:_0xb93061,prod_name:_0x45c1be,from_prod_qty:_0x90b59d,from_prod_level:_0x31dff1,from_prod_isle:_0x3eb112,from_prod_pallet:_0x351bfd,to_prod_qty:_0x3d1f26,to_prod_level:_0x32b212,to_prod_isle:_0xccc6a8,to_prod_pallet:_0x59167f,primary_code:_0x551f20,secondary_code:_0x1c394b,product_code3:_0x4c7511,note:_0x3a24cc,invoice:_0x436376,expiry_date:_0x4108ce}=_0x596d70[_0x440d64(0x17d)];if(typeof _0x45c1be==_0x440d64(0x187))var _0x1a5338=[_0x596d70[_0x440d64(0x17d)]['prod_name']],_0x181069=[_0x596d70[_0x440d64(0x17d)][_0x440d64(0x1b3)]],_0x32c9dd=[_0x596d70['body']['from_prod_level']],_0x5ac181=[_0x596d70[_0x440d64(0x17d)][_0x440d64(0x15c)]],_0x891d5a=[_0x596d70[_0x440d64(0x17d)][_0x440d64(0x13e)]],_0x4d8323=[_0x596d70[_0x440d64(0x17d)][_0x440d64(0x1ab)]],_0x3d9c57=[_0x596d70['body'][_0x440d64(0x17c)]],_0x582021=[_0x596d70['body'][_0x440d64(0x13f)]],_0x5ae8b5=[_0x596d70[_0x440d64(0x17d)][_0x440d64(0x152)]],_0x389148=[_0x596d70['body'][_0x440d64(0x195)]],_0x34171f=[_0x596d70['body'][_0x440d64(0x197)]],_0x1d0e45=[_0x596d70['body'][_0x440d64(0x115)]],_0x5595f9=[_0x596d70[_0x440d64(0x17d)][_0x440d64(0x17a)]];else var _0x1a5338=[..._0x596d70[_0x440d64(0x17d)][_0x440d64(0x12b)]],_0x181069=[..._0x596d70[_0x440d64(0x17d)]['from_prod_qty']],_0x32c9dd=[..._0x596d70[_0x440d64(0x17d)][_0x440d64(0xf8)]],_0x5ac181=[..._0x596d70['body'][_0x440d64(0x15c)]],_0x891d5a=[..._0x596d70[_0x440d64(0x17d)][_0x440d64(0x13e)]],_0x4d8323=[..._0x596d70[_0x440d64(0x17d)][_0x440d64(0x1ab)]],_0x3d9c57=[..._0x596d70[_0x440d64(0x17d)]['secondary_code']],_0x582021=[..._0x596d70['body']['product_code3']],_0x5ae8b5=[..._0x596d70['body'][_0x440d64(0x152)]],_0x389148=[..._0x596d70['body']['unit']],_0x34171f=[..._0x596d70[_0x440d64(0x17d)]['secondary_unit']],_0x1d0e45=[..._0x596d70[_0x440d64(0x17d)][_0x440d64(0x115)]],_0x5595f9=[..._0x596d70[_0x440d64(0x17d)][_0x440d64(0x17a)]];const _0x56b15e=_0x1a5338[_0x440d64(0x125)](_0xf65054=>{return _0xf65054={'product_name':_0xf65054};});_0x181069[_0x440d64(0x1bb)]((_0x520f4c,_0x34233c)=>{_0x56b15e[_0x34233c]['from_quantity']=_0x520f4c;}),_0x32c9dd[_0x440d64(0x1bb)]((_0x3a9bea,_0x12d2c5)=>{_0x56b15e[_0x12d2c5]['from_bay']=_0x3a9bea;}),_0x5ac181['forEach']((_0x2926f9,_0x2e3f0b)=>{var _0x51bd00=_0x440d64;_0x56b15e[_0x2e3f0b][_0x51bd00(0x193)]=_0x2926f9;}),_0x891d5a[_0x440d64(0x1bb)]((_0x4f19a9,_0x473868)=>{var _0x5b30da=_0x440d64;_0x56b15e[_0x473868][_0x5b30da(0x1a2)]=_0x4f19a9;}),_0x4d8323[_0x440d64(0x1bb)]((_0x566fb1,_0x522d04)=>{var _0x5b2ff5=_0x440d64;_0x56b15e[_0x522d04][_0x5b2ff5(0x1ab)]=_0x566fb1;}),_0x3d9c57['forEach']((_0x4b2d48,_0x27d598)=>{_0x56b15e[_0x27d598]['secondary_code']=_0x4b2d48;}),_0x582021[_0x440d64(0x1bb)]((_0x370ac6,_0x109fef)=>{_0x56b15e[_0x109fef]['product_code']=_0x370ac6;}),_0x5ae8b5[_0x440d64(0x1bb)]((_0x4696ac,_0x50192b)=>{var _0x298672=_0x440d64;_0x56b15e[_0x50192b][_0x298672(0x124)]=_0x4696ac;}),_0x389148['forEach']((_0x1afe51,_0x225895)=>{var _0xfeb0b2=_0x440d64;_0x56b15e[_0x225895][_0xfeb0b2(0x195)]=_0x1afe51;}),_0x34171f['forEach']((_0x2c3b42,_0x16aa83)=>{_0x56b15e[_0x16aa83]['secondary_unit']=_0x2c3b42;}),_0x1d0e45[_0x440d64(0x1bb)]((_0x101dda,_0x123418)=>{var _0x3fd563=_0x440d64;_0x56b15e[_0x123418][_0x3fd563(0x115)]=_0x101dda;}),_0x5595f9['forEach']((_0xe7012b,_0x1abe37)=>{_0x56b15e[_0x1abe37]['expiry_date']=_0xe7012b;});const _0x2959cf=_0x56b15e[_0x440d64(0x172)](_0x50a11d=>_0x50a11d[_0x440d64(0x193)]!=='0'&&_0x50a11d[_0x440d64(0x193)]!==''||_0x50a11d[_0x440d64(0x107)]!=='0'&&_0x50a11d['to_floorlevel']!=='');var _0x429f4c=0x0;_0x2959cf[_0x440d64(0x1bb)](_0x4a6f8b=>{var _0x1ce766=_0x440d64;parseInt(_0x4a6f8b[_0x1ce766(0x12c)])<parseInt(_0x4a6f8b['to_quantity'])&&_0x429f4c++;});if(_0x429f4c!=0x0)return _0x596d70['flash'](_0x440d64(0x127),_0x440d64(0x1ad)),_0x35d318[_0x440d64(0x1b6)](_0x440d64(0x19a));const _0x1319f6=await warehouse[_0x440d64(0x182)]({'name':_0x10d22a['from_warehouse'],'room':_0x10d22a[_0x440d64(0x168)]});_0x10d22a[_0x440d64(0x18c)][_0x440d64(0x1bb)](_0x13597f=>{var _0x31c18b=_0x440d64;if(_0x13597f[_0x31c18b(0x193)]>0x0){const _0x22372d=_0x1319f6[_0x31c18b(0x18a)][_0x31c18b(0x125)](_0x17d895=>{var _0x21c945=_0x31c18b;_0x17d895[_0x21c945(0x190)]==_0x13597f[_0x21c945(0x190)]&&_0x17d895['bay']==_0x13597f[_0x21c945(0x150)]&&(_0x17d895[_0x21c945(0x18b)]=parseInt(_0x17d895[_0x21c945(0x18b)])+parseInt(_0x13597f['to_quantity']));});}}),await _0x1319f6[_0x440d64(0x122)]();const _0x2da05b=await warehouse['findOne']({'name':_0x10d22a['to_warehouse'],'room':_0x10d22a[_0x440d64(0x134)]});_0x10d22a[_0x440d64(0x18c)][_0x440d64(0x1bb)](_0x38fdc8=>{var _0x319185=_0x440d64;if(_0x38fdc8['to_quantity']>0x0){const _0x3850d0=_0x2da05b[_0x319185(0x18a)]['map'](_0x5778f7=>{var _0x4b1dc5=_0x319185;_0x5778f7[_0x4b1dc5(0x190)]==_0x38fdc8[_0x4b1dc5(0x190)]&&_0x5778f7['bay']==_0x38fdc8[_0x4b1dc5(0x1a2)]&&(_0x5778f7['product_stock']=parseInt(_0x5778f7[_0x4b1dc5(0x18b)])-parseInt(_0x38fdc8[_0x4b1dc5(0x193)]));});}}),await _0x2da05b[_0x440d64(0x122)](),_0x10d22a['date']=_0x4c0bd7,_0x10d22a[_0x440d64(0x18e)]=_0x2127c6,_0x10d22a[_0x440d64(0x10b)]=_0x85a18,_0x10d22a[_0x440d64(0x18c)]=_0x2959cf,_0x10d22a[_0x440d64(0x1ba)]=_0x3a24cc,_0x10d22a['invoice']=_0x436376;const _0x5afe13=await _0x10d22a[_0x440d64(0x122)](),_0x520209=await warehouse[_0x440d64(0x182)]({'name':_0x2127c6,'room':_0x3a2038});_0x5afe13[_0x440d64(0x18c)][_0x440d64(0x1bb)](_0x539cce=>{var _0x91bed5=_0x440d64;if(_0x539cce['to_quantity']>0x0){const _0x5c034a=_0x520209[_0x91bed5(0x18a)]['map'](_0xe0e3c3=>{var _0x3f6fe5=_0x91bed5;_0xe0e3c3[_0x3f6fe5(0x190)]==_0x539cce['product_name']&&_0xe0e3c3[_0x3f6fe5(0x153)]==_0x539cce[_0x3f6fe5(0x150)]&&(_0xe0e3c3[_0x3f6fe5(0x18b)]=parseInt(_0xe0e3c3[_0x3f6fe5(0x18b)])-parseInt(_0x539cce[_0x3f6fe5(0x193)]));});}}),await _0x520209[_0x440d64(0x122)]();const _0x148288=await warehouse[_0x440d64(0x182)]({'name':_0x85a18,'room':_0xb93061});_0x5afe13[_0x440d64(0x18c)]['forEach'](_0x1e6aeb=>{var _0x5d967f=_0x440d64;if(_0x1e6aeb[_0x5d967f(0x193)]>0x0){var _0x4e2ced=0x0;const _0x5d4726=_0x148288[_0x5d967f(0x18a)][_0x5d967f(0x125)](_0x4f0896=>{var _0x2c8faa=_0x5d967f;_0x4f0896[_0x2c8faa(0x190)]==_0x1e6aeb[_0x2c8faa(0x190)]&&_0x4f0896[_0x2c8faa(0x153)]==_0x1e6aeb[_0x2c8faa(0x1a2)]&&(_0x4f0896['product_stock']=parseInt(_0x4f0896['product_stock'])+parseInt(_0x1e6aeb[_0x2c8faa(0x193)]),_0x4e2ced++);});_0x4e2ced=='0'&&(_0x148288['product_details']=_0x148288[_0x5d967f(0x18a)][_0x5d967f(0xf2)]({'product_name':_0x1e6aeb['product_name'],'product_stock':_0x1e6aeb[_0x5d967f(0x193)],'bay':_0x1e6aeb[_0x5d967f(0x1a2)],'product_code':_0x1e6aeb['product_code'],'primary_code':_0x1e6aeb['primary_code'],'secondary_code':_0x1e6aeb[_0x5d967f(0x17c)],'maxProducts':_0x1e6aeb[_0x5d967f(0x124)]}));}}),await _0x148288[_0x440d64(0x122)](),_0x596d70[_0x440d64(0xf7)](_0x440d64(0x180),_0x440d64(0xf9)),_0x35d318[_0x440d64(0x1b6)]('/transfer_finished/view');}catch(_0x1b365a){console[_0x440d64(0x1b5)](_0x1b365a);}}),router[a0_0xea8ec7(0x13d)](a0_0xea8ec7(0x162),async(_0x12d6ef,_0x1abbf1)=>{var _0x1a1db7=a0_0xea8ec7;const {FromWareHouse:_0x3aa8e2,FromRoom:_0x12beb3,ToWarehouse:_0x94463,ToRoom:_0x5c9c70,primary_code:_0x17a0da,Roomslist:_0x2e94d3}=_0x12d6ef[_0x1a1db7(0x17d)],_0xe4edff=_0x2e94d3['split'](','),_0x44ba28=[];async function _0x47cb28(_0x2d957e){var _0x11a657=_0x1a1db7;const _0xad5686=await warehouse[_0x11a657(0x10e)]([{'$match':{'name':_0x3aa8e2,'room':_0x2d957e}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x17a0da}},{'$group':{'_id':_0x11a657(0x10f),'name':{'$first':_0x11a657(0x14a)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x11a657(0x15f)},'secondary_code':{'$first':_0x11a657(0x11d)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x11a657(0x1ae)},'type':{'$first':_0x11a657(0x171)},'pallet':{'$first':_0x11a657(0x178)},'unit':{'$first':_0x11a657(0x102)},'secondary_unit':{'$first':_0x11a657(0x136)},'storage':{'$first':_0x11a657(0x1a4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x11a657(0xfe)},'batch_code':{'$first':_0x11a657(0x163)},'maxPerUnit':{'$first':_0x11a657(0x13a)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x567a5d=await warehouse[_0x11a657(0x10e)]([{'$match':{'name':_0x3aa8e2,'room':_0x2d957e}},{'$unwind':_0x11a657(0xfd)},{'$match':{'product_details.secondary_code':_0x17a0da}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x11a657(0x11f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x11a657(0x11d)},'product_code':{'$first':_0x11a657(0x117)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x11a657(0x171)},'pallet':{'$first':_0x11a657(0x178)},'unit':{'$first':_0x11a657(0x102)},'secondary_unit':{'$first':_0x11a657(0x136)},'storage':{'$first':_0x11a657(0x1a4)},'rack':{'$first':_0x11a657(0x131)},'expiry_date':{'$first':_0x11a657(0x112)},'production_date':{'$first':_0x11a657(0xfe)},'batch_code':{'$first':_0x11a657(0x163)},'maxPerUnit':{'$first':_0x11a657(0x13a)},'roomNamed':{'$first':_0x11a657(0x169)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x11a657(0x10d)}}}]);if(_0xad5686['length']>0x0)_0x44ba28[_0x11a657(0x175)](_0xad5686);else _0x567a5d[_0x11a657(0x147)]>0x0&&_0x44ba28[_0x11a657(0x175)](_0x567a5d);}const _0x510b84=_0xe4edff[_0x1a1db7(0x125)](_0x2eb687=>_0x47cb28(_0x2eb687));await Promise['all'](_0x510b84),_0x1abbf1[_0x1a1db7(0x156)](_0x44ba28);}),router['post'](a0_0xea8ec7(0x109),async(_0x3457dc,_0x3edb4c)=>{var _0x42b323=a0_0xea8ec7;try{const {FromWareHouse:_0x23cd2e,FromRoom:_0x28b5b6,ToWarehouse:_0x2009b6,ToRoom:_0x28b0c2,secondary_code:_0x359492}=_0x3457dc['body'],_0x14d950=await warehouse['aggregate']([{'$match':{'name':_0x23cd2e}},{'$unwind':_0x42b323(0xfd)},{'$match':{'product_details.secondary_code':_0x359492}},{'$group':{'_id':_0x42b323(0x10f),'name':{'$first':_0x42b323(0x14a)},'primary_code':{'$first':_0x42b323(0x15f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x42b323(0x11f)},'warehouse':{'$first':_0x42b323(0x170)},'level':{'$first':_0x42b323(0x1aa)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x42b323(0x11e)},'maxProducts':{'$first':_0x42b323(0x192)},'unit':{'$first':_0x42b323(0x102)},'expiry_date':{'$first':_0x42b323(0x112)},'production_date':{'$first':_0x42b323(0xfe)}}}]);_0x3edb4c['status'](0xc8)[_0x42b323(0x156)](_0x14d950);}catch(_0x42eda0){_0x3edb4c[_0x42b323(0x101)](0x194)[_0x42b323(0x156)]({'message':_0x42eda0[_0x42b323(0x1b9)]});}}),router[a0_0xea8ec7(0x13d)](a0_0xea8ec7(0x1a1),async(_0x340a45,_0x29772b)=>{var _0x5ce8fe=a0_0xea8ec7;try{const {FromWareHouse:_0x822ab6,FromRoom:_0x1dd5b1,ToWarehouse:_0x487fb9,ToRoom:_0x2c7ae1,product_code:_0x326ba3}=_0x340a45['body'],_0x4ebc0a=await warehouse['aggregate']([{'$match':{'name':_0x822ab6}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x326ba3}},{'$group':{'_id':_0x5ce8fe(0x10f),'name':{'$first':_0x5ce8fe(0x14a)},'primary_code':{'$first':_0x5ce8fe(0x15f)},'secondary_code':{'$first':_0x5ce8fe(0x11d)},'product_code':{'$first':_0x5ce8fe(0x117)},'instock':{'$first':_0x5ce8fe(0x11f)},'warehouse':{'$first':_0x5ce8fe(0x170)},'level':{'$first':_0x5ce8fe(0x1aa)},'isle':{'$first':_0x5ce8fe(0x166)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x5ce8fe(0x192)},'unit':{'$first':_0x5ce8fe(0x102)}}}]);_0x29772b[_0x5ce8fe(0x101)](0xc8)[_0x5ce8fe(0x156)](_0x4ebc0a);}catch(_0x230f8f){_0x29772b['status'](0x194)[_0x5ce8fe(0x156)]({'message':_0x230f8f[_0x5ce8fe(0x1b9)]});}}),router[a0_0xea8ec7(0x13d)](a0_0xea8ec7(0x113),async(_0xdca58b,_0x4f1b48)=>{var _0x53199d=a0_0xea8ec7;const {productCode:_0x3dc35b,bay:_0x4f8467,warehouses:_0x39a8d0,room:_0x28f337}=_0xdca58b[_0x53199d(0x17d)];console['log'](_0xdca58b[_0x53199d(0x17d)]);try{const _0x40617a=await warehouse[_0x53199d(0x10e)]([{'$match':{'name':_0x39a8d0,'room':_0x28f337}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4f8467)}},{'$group':{'_id':_0x53199d(0x10f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x53199d(0x11f)},'bay':{'$first':_0x53199d(0x177)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4f1b48['status'](0xc8)[_0x53199d(0x156)](_0x40617a);}catch(_0x5a2aa8){_0x4f1b48[_0x53199d(0x101)](0x194)[_0x53199d(0x156)]({'message':_0x5a2aa8[_0x53199d(0x1b9)]});}}),module['exports']=router;