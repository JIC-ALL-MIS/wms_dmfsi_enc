var a0_0x1a5396=a0_0x1eff;(function(_0x1d0502,_0x21a980){var _0x2df8c6=a0_0x1eff,_0x4f7a3c=_0x1d0502();while(!![]){try{var _0x253cc8=-parseInt(_0x2df8c6(0xb4))/0x1+-parseInt(_0x2df8c6(0xa0))/0x2+-parseInt(_0x2df8c6(0x102))/0x3+-parseInt(_0x2df8c6(0x12c))/0x4+parseInt(_0x2df8c6(0xc4))/0x5+-parseInt(_0x2df8c6(0xac))/0x6+parseInt(_0x2df8c6(0xd9))/0x7;if(_0x253cc8===_0x21a980)break;else _0x4f7a3c['push'](_0x4f7a3c['shift']());}catch(_0x133ff8){_0x4f7a3c['push'](_0x4f7a3c['shift']());}}}(a0_0x4440,0xb5997));function a0_0x4440(){var _0x5ba809=['site_title','password','Rack\x202','<h2>\x20','Ambient','$product_details.level','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','getDate','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','QA\x20Warehouse','<strong>\x20Regards\x20</strong>','<!DOCTYPE\x20html>','from_invoice','$from_warehouse','product_details','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.expiry_date','bay','../middleware/auth','German','$product_details.secondary_unit','batch_code','aggregate','Logo.png','message','$product_details.production_date','product_code3','secondary_code','Chinese','production_date','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','primary_code','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','\x20Order\x20Date\x20:\x20','findById','FROZEN\x20GOODS','<span\x20style=\x22float:\x20right;\x22>','forEach','padStart','English','/view','Portuguese','True','/picking_list/PDF_transfer/','product','Arabic','$product_details.product_name','staff','Spanish','map','$product_details.maxProducts','/barcode_scanner2','1861844puTcJe','English\x20(US)','$date','errors','toString','json','role','catch','MaxStocks_data','<div>','filter','random','6600474hPJwxX','back','$finalize','maxPerUnit','note','Enclosed','expiry_date','DRY\x20GOODS','913869EogwZn','An\x20error\x20occurred\x20while\x20saving\x20data.','product_name','$product_details.product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.storage','$product_details.bin','port','/transfer_finished/view','$product_details._id','RoomAssigned','$product_details.invoice','length','finalize','TRFF-','prod_name','7366280IaKawh','to_floorlevel','to_warehouse','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','getFullYear','</div>','_id','unit','sendMail','<tbody\x20style=\x22text-align:\x20center;\x22>','</tr>','product_code','params','$product_details.type','To_invoice','from_quantity','$product_details.rack','$product_details.maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','save','<tr>','29821862OgwJSF','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','then','$product.from_room_name','to_room','</head><body>','status','maxProducts','$product_details.batch_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<html><head><title></title>','New_Qty_Converted','</body></html>','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/transfer_finished/preview/','exports','$product_details.unit','/../public','to_prod_level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.bay','edit_transfer_finished_view','to_prod_qty','Email\x20sent\x20successfully','get','nodemailer','Transfer\x20Finalize\x20Successfully','date','</thead>','Finished\x20Goods','logo','error','slice','$product_details.primary_code','find','primary_unit','body','Rack\x201','$product_details.isle','prod_cat','1790094JXWlls','warehouse','log','from_room','push','Arabic\x20(ae)','Router','$product.to_room_name','findOne','render','host','$product_details.pallet','flash','</table>','An\x20error\x20occurred.','Hindi','from_prod_level','add_transfer_finished','secondary_unit','Enabled','from_room_name','Transfer\x20Edit\x20Successfully','$product_details.product_stock','success','concat','$room','to_quantity','$product_details','</tbody>','updateOne','from_warehouse','all','There\x27s\x20a\x20error\x20in\x20this\x20transaction','string','<table\x20style=\x22width:\x20100%\x20!important;\x22>','language','/upload/','post','product_stock','transfer_data','$product_details.floorlevel','invoice','5792492clObUK','$invoice','user','Transfer\x20Mail','$product_details.secondary_code','getMonth','to_invoice','from_bay','/view/add_transfer','to_bay','French','MaxStocks_data2','to_room_name','../public/language/languages.json','$name','email','<h5>','<h5\x20style=\x22text-align:\x20left;\x22>','/view/:id','</h5>','from_prod_qty','Portuguese\x20(BR)'];a0_0x4440=function(){return _0x5ba809;};return a0_0x4440();}const express=require('express'),app=express(),router=express[a0_0x1a5396(0x108)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1a5396(0x156)),users=require(a0_0x1a5396(0x139)),nodemailer=require(a0_0x1a5396(0xf3));router['get'](a0_0x1a5396(0x16d),auth,async(_0x266a0f,_0x193908)=>{var _0x4fc225=a0_0x1a5396;try{const {username:_0x4a3598,email:_0x27b335,role:_0x3634fe}=_0x266a0f[_0x4fc225(0x12e)],_0x21d8c1=_0x266a0f[_0x4fc225(0x12e)],_0xde9ba7=await profile[_0x4fc225(0x10a)]({'email':_0x21d8c1[_0x4fc225(0x13b)]}),_0x48abfd=await master_shop[_0x4fc225(0xfc)]();let _0x32ddce;if(_0x21d8c1[_0x4fc225(0xa6)]==_0x4fc225(0x9b)){const _0x1d522e=await staff[_0x4fc225(0x10a)]({'email':_0x21d8c1['email']});_0x32ddce=await transfers_finished['find']({'from_warehouse':_0x1d522e['warehouse']});}else _0x32ddce=await transfers_finished[_0x4fc225(0x15a)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x4fc225(0x12d)},'date':{'$first':_0x4fc225(0xa2)},'from_warehouse':{'$first':_0x4fc225(0x150)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x4fc225(0xdc)},'to_room_name':{'$addToSet':_0x4fc225(0x109)},'finalize':{'$first':_0x4fc225(0xae)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x48abfd[0x0][_0x4fc225(0x125)]==_0x4fc225(0xa1))var _0xfa20b=users[_0x4fc225(0x16c)];else{if(_0x48abfd[0x0][_0x4fc225(0x125)]==_0x4fc225(0x111))var _0xfa20b=users[_0x4fc225(0x111)];else{if(_0x48abfd[0x0][_0x4fc225(0x125)]=='German')var _0xfa20b=users[_0x4fc225(0x157)];else{if(_0x48abfd[0x0]['language']==_0x4fc225(0x9c))var _0xfa20b=users['Spanish'];else{if(_0x48abfd[0x0][_0x4fc225(0x125)]==_0x4fc225(0x136))var _0xfa20b=users[_0x4fc225(0x136)];else{if(_0x48abfd[0x0][_0x4fc225(0x125)]==_0x4fc225(0x141))var _0xfa20b=users['Portuguese'];else{if(_0x48abfd[0x0]['language']==_0x4fc225(0x160))var _0xfa20b=users[_0x4fc225(0x160)];else{if(_0x48abfd[0x0][_0x4fc225(0x125)]=='Arabic\x20(ae)')var _0xfa20b=users[_0x4fc225(0x99)];}}}}}}}_0x193908[_0x4fc225(0x10b)]('transfer_finished',{'success':_0x266a0f[_0x4fc225(0x10e)](_0x4fc225(0x119)),'errors':_0x266a0f['flash']('errors'),'role':_0x21d8c1,'profile':_0xde9ba7,'master_shop':_0x48abfd,'transfer':_0x32ddce,'language':_0xfa20b});}catch(_0x5b71d3){console[_0x4fc225(0x104)](_0x5b71d3);}});async function getRandom8DigitNumber(){var _0xee9b0c=a0_0x1a5396;const _0x26acfd=0x989680,_0x4b47f3=0x5f5e0ff,_0x1db121=Math['floor'](Math[_0xee9b0c(0xab)]()*(_0x4b47f3-_0x26acfd+0x1))+_0x26acfd;var _0x151212;const _0x4c8118=await transfers_finished[_0xee9b0c(0x10a)]({'invoice':'TRFF-'+_0x1db121});return _0x4c8118&&_0x4c8118[_0xee9b0c(0xc0)]>0x0?_0x151212=_0xee9b0c(0xc2)+_0x1db121:_0x151212=_0xee9b0c(0xc2)+_0x1db121,_0x151212;}router[a0_0x1a5396(0xf2)](a0_0x1a5396(0x134),auth,async(_0x176e2a,_0x1f7c29)=>{var _0x592456=a0_0x1a5396;try{const {username:_0x21cbf0,email:_0x1c6a95,role:_0x28c217}=_0x176e2a['user'],_0x325c11=_0x176e2a[_0x592456(0x12e)],_0x27caee=await profile[_0x592456(0x10a)]({'email':_0x325c11[_0x592456(0x13b)]}),_0x4c4cc2=await master_shop[_0x592456(0xfc)]();let _0x411824;if(_0x325c11[_0x592456(0xa6)]==_0x592456(0x9b)){const _0x3cf1bf=await staff[_0x592456(0x10a)]({'email':_0x325c11[_0x592456(0x13b)]});_0x411824=await warehouse[_0x592456(0x15a)]([{'$match':{'status':_0x592456(0x115),'name':_0x3cf1bf[_0x592456(0x103)],'warehouse_category':_0x592456(0xf7),'name':{'$ne':_0x592456(0x14c)}}},{'$group':{'_id':_0x592456(0x13a),'name':{'$first':_0x592456(0x13a)}}}]);}else _0x411824=await warehouse[_0x592456(0x15a)]([{'$match':{'status':_0x592456(0x115),'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x592456(0x13a)}}}]);const _0x2eaedd=await transfers_finished[_0x592456(0xfc)]({}),_0x3e16ec=_0x2eaedd['length']+0x1,_0x504d17=_0x592456(0xc2)+_0x3e16ec[_0x592456(0xa4)]()[_0x592456(0x16b)](0x5,'0');if(_0x4c4cc2[0x0][_0x592456(0x125)]==_0x592456(0xa1))var _0x6a6aca=users[_0x592456(0x16c)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]=='Hindi')var _0x6a6aca=users[_0x592456(0x111)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]==_0x592456(0x157))var _0x6a6aca=users[_0x592456(0x157)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]==_0x592456(0x9c))var _0x6a6aca=users[_0x592456(0x9c)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]=='French')var _0x6a6aca=users[_0x592456(0x136)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]=='Portuguese\x20(BR)')var _0x6a6aca=users[_0x592456(0x16e)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]==_0x592456(0x160))var _0x6a6aca=users[_0x592456(0x160)];else{if(_0x4c4cc2[0x0][_0x592456(0x125)]==_0x592456(0x107))var _0x6a6aca=users[_0x592456(0x99)];}}}}}}}const _0x3b4b39=getRandom8DigitNumber();_0x3b4b39[_0x592456(0xdb)](_0x1574f2=>{var _0x508606=_0x592456;_0x1f7c29['render'](_0x508606(0x113),{'success':_0x176e2a[_0x508606(0x10e)]('success'),'errors':_0x176e2a[_0x508606(0x10e)]('errors'),'role':_0x325c11,'profile':_0x27caee,'master_shop':_0x4c4cc2,'warehouse':_0x411824,'language':_0x6a6aca,'invoice':_0x1574f2});})[_0x592456(0xa7)](_0x48ec1b=>{var _0x25257f=_0x592456;_0x176e2a[_0x25257f(0x10e)]('errors',_0x25257f(0x122)),_0x1f7c29['redirect']('/transfer/view');});}catch(_0x57d6ea){console['log'](_0x57d6ea);}}),router[a0_0x1a5396(0x127)]('/view/add_transfer',auth,async(_0x195589,_0x56f65a)=>{var _0x4274ba=a0_0x1a5396;try{const {date:_0x10d927,from_warehouse:_0x1bf0d5,FromRoom_name:_0x24e71e,to_warehouse:_0x1f7110,ToRoom_name:_0x237a1f,prod_name:_0x143ede,from_prod_qty:_0x36f24d,from_prod_level:_0x4712dc,from_prod_isle:_0x4c724f,from_prod_pallet:_0x11962f,to_prod_qty:_0x53add4,to_prod_level:_0x42210b,to_prod_isle:_0x2be4d1,to_prod_pallet:_0x4a9347,primary_code:_0x3b2ac5,secondary_code:_0x2144ff,product_code3:_0xa0a34e,note:_0x45a5a4,MaxStocks_data2:_0x55ce64,invoice:_0x54ca0c,expiry_date:_0x18cf95}=_0x195589[_0x4274ba(0xfe)];if(typeof _0x143ede==_0x4274ba(0x123))var _0x377df4=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0xc3)]],_0x1afbdf=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x140)]],_0x24163c=[_0x195589[_0x4274ba(0xfe)]['from_prod_level']],_0x195515=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0xe4)]],_0x2b88c9=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0xec)]],_0x324d01=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x163)]],_0x754a8=[_0x195589['body'][_0x4274ba(0x15f)]],_0x3064da=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x15e)]],_0x30abc0=[_0x195589['body'][_0x4274ba(0x137)]],_0x3a43bb=[_0x195589[_0x4274ba(0xfe)]['primary_unit']],_0x3a356b=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x114)]],_0x2190f4=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x159)]],_0x410a5c=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0xb2)]],_0x195889=[_0x195589[_0x4274ba(0xfe)]['product_date']],_0x56dba5=[_0x195589[_0x4274ba(0xfe)]['MaxStocks_data']],_0x2e0edd=[_0x195589[_0x4274ba(0xfe)]['maxPerUnit']],_0x9a2950=[_0x195589[_0x4274ba(0xfe)]['prod_cat']],_0x56e65a=[_0x195589[_0x4274ba(0xfe)]['RoomAssigned']],_0x3a4bbe=[_0x195589[_0x4274ba(0xfe)]['ToRoomAssigned']],_0x1248d7=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x14f)]],_0x692e=[_0x195589[_0x4274ba(0xfe)][_0x4274ba(0x132)]];else var _0x377df4=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0xc3)]],_0x1afbdf=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0x140)]],_0x24163c=[..._0x195589['body'][_0x4274ba(0x112)]],_0x195515=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0xe4)]],_0x2b88c9=[..._0x195589['body'][_0x4274ba(0xec)]],_0x324d01=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0x163)]],_0x754a8=[..._0x195589['body'][_0x4274ba(0x15f)]],_0x3064da=[..._0x195589['body'][_0x4274ba(0x15e)]],_0x30abc0=[..._0x195589[_0x4274ba(0xfe)]['MaxStocks_data2']],_0x3a43bb=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0xfd)]],_0x3a356b=[..._0x195589[_0x4274ba(0xfe)]['secondary_unit']],_0x2190f4=[..._0x195589['body'][_0x4274ba(0x159)]],_0x410a5c=[..._0x195589['body'][_0x4274ba(0xb2)]],_0x195889=[..._0x195589[_0x4274ba(0xfe)]['product_date']],_0x56dba5=[..._0x195589['body'][_0x4274ba(0xa8)]],_0x2e0edd=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0xaf)]],_0x9a2950=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0x101)]],_0x56e65a=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0xbe)]],_0x3a4bbe=[..._0x195589[_0x4274ba(0xfe)]['ToRoomAssigned']],_0x1248d7=[..._0x195589[_0x4274ba(0xfe)][_0x4274ba(0x14f)]],_0x692e=[..._0x195589['body']['to_invoice']];const _0x1ded85=_0x377df4[_0x4274ba(0x9d)](_0x478337=>{return _0x478337={'product_name':_0x478337};});_0x1afbdf['forEach']((_0x4375f6,_0x415d01)=>{_0x1ded85[_0x415d01]['from_quantity']=_0x4375f6;}),_0x24163c[_0x4274ba(0x16a)]((_0x2e1e12,_0x218c13)=>{_0x1ded85[_0x218c13]['from_bay']=_0x2e1e12;}),_0x1248d7[_0x4274ba(0x16a)]((_0x7c0a07,_0x270d6a)=>{var _0x368da5=_0x4274ba;_0x1ded85[_0x270d6a][_0x368da5(0x14f)]=_0x7c0a07;}),_0x692e['forEach']((_0xd03471,_0x56363b)=>{var _0x2eda52=_0x4274ba;_0x1ded85[_0x56363b][_0x2eda52(0xd2)]=_0xd03471;}),_0x195515['forEach']((_0x402ecd,_0x58532b)=>{var _0x58002d=_0x4274ba;_0x1ded85[_0x58532b][_0x58002d(0x11c)]=_0x402ecd;}),_0x2b88c9['forEach']((_0x46392c,_0x3e4ce2)=>{var _0x4c67e5=_0x4274ba;_0x1ded85[_0x3e4ce2][_0x4c67e5(0x135)]=_0x46392c;}),_0x324d01[_0x4274ba(0x16a)]((_0x360b63,_0x376c8e)=>{var _0x2a995d=_0x4274ba;_0x1ded85[_0x376c8e][_0x2a995d(0x163)]=_0x360b63;}),_0x754a8[_0x4274ba(0x16a)]((_0x3c1835,_0x549597)=>{_0x1ded85[_0x549597]['secondary_code']=_0x3c1835;}),_0x3064da[_0x4274ba(0x16a)]((_0x2f0917,_0x4a8cbc)=>{var _0x2bead2=_0x4274ba;_0x1ded85[_0x4a8cbc][_0x2bead2(0xcf)]=_0x2f0917;}),_0x30abc0['forEach']((_0x3c91de,_0x29ae29)=>{_0x1ded85[_0x29ae29]['maxProducts']=_0x3c91de;}),_0x3a43bb[_0x4274ba(0x16a)]((_0xb0c19c,_0x1b323f)=>{var _0x297d84=_0x4274ba;_0x1ded85[_0x1b323f][_0x297d84(0xcb)]=_0xb0c19c;}),_0x3a356b['forEach']((_0xaf985,_0x3f435a)=>{var _0x5f145d=_0x4274ba;_0x1ded85[_0x3f435a][_0x5f145d(0x114)]=_0xaf985;}),_0x2190f4[_0x4274ba(0x16a)]((_0xc4f4e4,_0x35ddc0)=>{_0x1ded85[_0x35ddc0]['batch_code']=_0xc4f4e4;}),_0x410a5c[_0x4274ba(0x16a)]((_0x2f2508,_0x2fe544)=>{var _0x5cdc71=_0x4274ba;_0x1ded85[_0x2fe544][_0x5cdc71(0xb2)]=_0x2f2508;}),_0x195889['forEach']((_0x2e7977,_0x508bb3)=>{var _0x4065e1=_0x4274ba;_0x1ded85[_0x508bb3][_0x4065e1(0x161)]=_0x2e7977;}),_0x56dba5['forEach']((_0x4f64f9,_0x4f6347)=>{var _0x40bcaf=_0x4274ba;_0x1ded85[_0x4f6347][_0x40bcaf(0xe0)]=_0x4f64f9;}),_0x2e0edd[_0x4274ba(0x16a)]((_0x1967de,_0x932b83)=>{var _0x987513=_0x4274ba;_0x1ded85[_0x932b83][_0x987513(0xaf)]=_0x1967de;}),_0x9a2950['forEach']((_0x481cf8,_0xcadf4e)=>{var _0x31754a=_0x4274ba;_0x1ded85[_0xcadf4e][_0x31754a(0x101)]=_0x481cf8;}),_0x56e65a[_0x4274ba(0x16a)]((_0x4d2bc7,_0x33948e)=>{var _0xe6f1e=_0x4274ba;_0x1ded85[_0x33948e][_0xe6f1e(0x116)]=_0x4d2bc7;}),_0x3a4bbe[_0x4274ba(0x16a)]((_0x48008f,_0x5565ef)=>{var _0x434891=_0x4274ba;_0x1ded85[_0x5565ef][_0x434891(0x138)]=_0x48008f;});const _0x346e96=_0x1ded85[_0x4274ba(0xaa)](_0x5f35ee=>_0x5f35ee['to_quantity']!=='0'&&_0x5f35ee[_0x4274ba(0x11c)]!==''||_0x5f35ee['to_floorlevel']!=='0'&&_0x5f35ee[_0x4274ba(0xc5)]!=='');var _0x420784=0x0;_0x346e96['forEach'](_0x175c86=>{var _0x5dcf94=_0x4274ba;parseInt(_0x175c86[_0x5dcf94(0xd3)])<parseInt(_0x175c86['to_quantity'])&&_0x420784++;});if(_0x420784!=0x0)return _0x195589[_0x4274ba(0x10e)](_0x4274ba(0xa3),_0x4274ba(0x14a)),_0x56f65a[_0x4274ba(0x152)](_0x4274ba(0xad));const _0x4f0fa3=new transfers_finished({'date':_0x10d927,'from_warehouse':_0x1bf0d5,'to_warehouse':_0x1f7110,'product':_0x346e96,'note':_0x45a5a4,'invoice':_0x54ca0c}),_0xccfd03=await _0x4f0fa3[_0x4274ba(0xd7)]();_0x195589[_0x4274ba(0x10e)](_0x4274ba(0x119),'Product\x20Transfer\x20successfully'),_0x56f65a['redirect'](_0x4274ba(0xe8)+_0xccfd03[_0x4274ba(0xca)]);}catch(_0x2b4f3b){console['log'](_0x2b4f3b),_0x56f65a['status'](0xc8)[_0x4274ba(0xa5)]({'errorMessage':_0x2b4f3b[_0x4274ba(0x15c)]});}}),router[a0_0x1a5396(0xf2)]('/preview/:id',auth,async(_0x4cda39,_0x15f322)=>{var _0x3a0e0f=a0_0x1a5396;try{const {username:_0x14c555,email:_0x17bc0e,role:_0x194bc3}=_0x4cda39[_0x3a0e0f(0x12e)],_0x17e16e=_0x4cda39[_0x3a0e0f(0x12e)],_0x4d4ffe=await profile[_0x3a0e0f(0x10a)]({'email':_0x17e16e['email']}),_0x46da51=await master_shop[_0x3a0e0f(0xfc)](),_0x115586=await transfers_finished['findById'](_0x4cda39[_0x3a0e0f(0xd0)]['id']);let _0x456f14;if(_0x17e16e[_0x3a0e0f(0xa6)]==_0x3a0e0f(0x9b)){const _0x133eb6=await staff[_0x3a0e0f(0x10a)]({'email':_0x17e16e[_0x3a0e0f(0x13b)]});_0x456f14=await warehouse[_0x3a0e0f(0xfc)]({'status':_0x3a0e0f(0x115),'name':_0x133eb6[_0x3a0e0f(0x103)],'warehouse_category':_0x3a0e0f(0xf7)});}else _0x456f14=await warehouse[_0x3a0e0f(0xfc)]({'status':_0x3a0e0f(0x115),'warehouse_category':'Finished\x20Goods'});const _0x47d9b5=await warehouse[_0x3a0e0f(0x15a)]([{'$match':{'name':_0x115586[_0x3a0e0f(0x120)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3a0e0f(0xbd),'name':{'$first':_0x3a0e0f(0x9a)},'product_stock':{'$first':_0x3a0e0f(0x118)},'bay':{'$first':_0x3a0e0f(0xee)},'bin':{'$first':_0x3a0e0f(0xba)},'type':{'$first':_0x3a0e0f(0xd1)},'floorlevel':{'$first':_0x3a0e0f(0x12a)},'primary_code':{'$first':_0x3a0e0f(0xfb)},'secondary_code':{'$first':_0x3a0e0f(0x130)},'product_code':{'$first':_0x3a0e0f(0xb7)},'storage':{'$first':_0x3a0e0f(0xb9)},'rack':{'$first':_0x3a0e0f(0xd4)},'expiry_date':{'$first':_0x3a0e0f(0x154)},'production_date':{'$first':_0x3a0e0f(0x15d)},'room':{'$first':'$room'},'warehoue_name':{'$first':'$name'}}}]),_0x4f4e68=await product[_0x3a0e0f(0xfc)]({});if(_0x46da51[0x0]['language']==_0x3a0e0f(0xa1)){var _0x3f756e=users[_0x3a0e0f(0x16c)];console[_0x3a0e0f(0x104)](_0x3f756e);}else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]==_0x3a0e0f(0x111))var _0x3f756e=users[_0x3a0e0f(0x111)];else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]==_0x3a0e0f(0x157))var _0x3f756e=users[_0x3a0e0f(0x157)];else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]==_0x3a0e0f(0x9c))var _0x3f756e=users[_0x3a0e0f(0x9c)];else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]=='French')var _0x3f756e=users['French'];else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]==_0x3a0e0f(0x141))var _0x3f756e=users['Portuguese'];else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]==_0x3a0e0f(0x160))var _0x3f756e=users[_0x3a0e0f(0x160)];else{if(_0x46da51[0x0][_0x3a0e0f(0x125)]==_0x3a0e0f(0x107))var _0x3f756e=users[_0x3a0e0f(0x99)];}}}}}}}_0x15f322[_0x3a0e0f(0x10b)](_0x3a0e0f(0xef),{'success':_0x4cda39[_0x3a0e0f(0x10e)](_0x3a0e0f(0x119)),'errors':_0x4cda39[_0x3a0e0f(0x10e)](_0x3a0e0f(0xa3)),'role':_0x17e16e,'profile':_0x4d4ffe,'master_shop':_0x46da51,'warehouse':_0x456f14,'transfer':_0x115586,'stock':_0x47d9b5,'unit':_0x4f4e68,'language':_0x3f756e});}catch(_0x5781c8){console['log'](_0x5781c8);}}),router['post'](a0_0x1a5396(0xe6),auth,async(_0x5c6a69,_0x539107)=>{var _0x23cbc6=a0_0x1a5396;try{const {invoice:_0x59c26d,from_warehouse:_0x4def23,FromRoom_name:_0x615643,to_warehouse:_0x12651c,ToRoom_name:_0xa043e6}=_0x5c6a69[_0x23cbc6(0xfe)],_0x493c95=await transfers_finished[_0x23cbc6(0x167)](_0x5c6a69[_0x23cbc6(0xd0)]['id']),_0xcdbaea=_0x493c95[_0x23cbc6(0x98)][_0x23cbc6(0x9d)](async _0x468b0d=>{var _0xf47094=_0x23cbc6;if(_0x468b0d[_0xf47094(0x11c)]>0x0){var _0x42fb89=await warehouse[_0xf47094(0x10a)]({'name':_0x4def23,'room':_0x468b0d[_0xf47094(0x116)],'warehouse_category':_0xf47094(0xf7)});const _0x22aa4d=_0x42fb89[_0xf47094(0x151)][_0xf47094(0x9d)](_0x39ff54=>{var _0x9de760=_0xf47094;_0x39ff54[_0x9de760(0xb6)]==_0x468b0d[_0x9de760(0xb6)]&&_0x39ff54['bay']==_0x468b0d['from_bay']&&_0x39ff54[_0x9de760(0xb2)]==_0x468b0d[_0x9de760(0xb2)]&&_0x39ff54[_0x9de760(0x161)]==_0x468b0d[_0x9de760(0x161)]&&_0x39ff54[_0x9de760(0x159)]==_0x468b0d[_0x9de760(0x159)]&&_0x39ff54[_0x9de760(0x12b)]==_0x468b0d[_0x9de760(0x14f)]&&(_0x39ff54['product_stock']=_0x39ff54[_0x9de760(0x128)]-_0x468b0d[_0x9de760(0x11c)]);});}return _0x42fb89;});Promise[_0x23cbc6(0x121)](_0xcdbaea)[_0x23cbc6(0xdb)](async _0x3397ad=>{var _0x31c2a4=_0x23cbc6;try{for(const _0x1c47f1 of _0x3397ad){await _0x1c47f1['save']();}const _0x292906=_0x493c95['product'][_0x31c2a4(0x9d)](async _0x38b985=>{var _0x196bbf=_0x31c2a4,_0x41d956=await warehouse['findOne']({'name':_0x12651c,'room':_0x38b985[_0x196bbf(0x138)]});if(_0x38b985[_0x196bbf(0x11c)]>0x0){var _0x217222=0x0;const _0x5d62f8=_0x41d956[_0x196bbf(0x151)][_0x196bbf(0x9d)](_0x3f90b5=>{var _0x531f8e=_0x196bbf;_0x3f90b5['product_name']==_0x38b985['product_name']&&_0x3f90b5['bay']==_0x38b985[_0x531f8e(0x135)]&&_0x3f90b5[_0x531f8e(0xb2)]==_0x38b985[_0x531f8e(0xb2)]&&_0x3f90b5[_0x531f8e(0x161)]==_0x38b985['production_date']&&_0x3f90b5[_0x531f8e(0x159)]==_0x38b985[_0x531f8e(0x159)]&&_0x3f90b5['invoice']==_0x38b985[_0x531f8e(0xd2)]&&(_0x3f90b5[_0x531f8e(0x128)]=_0x3f90b5[_0x531f8e(0x128)]+_0x38b985[_0x531f8e(0x11c)],_0x217222++);});_0x217222=='0'&&(_0x41d956[_0x196bbf(0x151)]=_0x41d956[_0x196bbf(0x151)]['concat']({'product_name':_0x38b985[_0x196bbf(0xb6)],'product_stock':_0x38b985[_0x196bbf(0x11c)],'bay':_0x38b985[_0x196bbf(0x135)],'product_code':_0x38b985[_0x196bbf(0xcf)],'primary_code':_0x38b985[_0x196bbf(0x163)],'secondary_code':_0x38b985[_0x196bbf(0x15f)],'expiry_date':_0x38b985[_0x196bbf(0xb2)],'production_date':_0x38b985[_0x196bbf(0x161)],'maxProducts':_0x38b985['maxProducts'],'batch_code':_0x38b985['batch_code'],'secondary_unit':_0x38b985[_0x196bbf(0x114)],'unit':_0x38b985['unit'],'maxProducts':_0x38b985[_0x196bbf(0xe0)],'maxPerUnit':_0x38b985[_0x196bbf(0xaf)],'invoice':_0x38b985[_0x196bbf(0xd2)]}));}return _0x41d956;});Promise[_0x31c2a4(0x121)](_0x292906)[_0x31c2a4(0xdb)](async _0x478c82=>{var _0x250b2b=_0x31c2a4;try{for(const _0x5703db of _0x478c82){await warehouse[_0x250b2b(0x11f)]({'_id':_0x5703db[_0x250b2b(0xca)]},{'$addToSet':{'product_details':{'$each':_0x5703db[_0x250b2b(0x151)]}}});}_0x493c95[_0x250b2b(0xc1)]=_0x250b2b(0x96);const _0xa3bdc=await _0x493c95[_0x250b2b(0xd7)](),_0x5a168c=await master_shop[_0x250b2b(0xfc)](),_0x3cd32c=await email_settings[_0x250b2b(0x10a)](),_0x53a8f=await supervisor_settings['find']();var _0x7f77c1=_0x493c95[_0x250b2b(0x98)],_0x1fa9d6='',_0x44e69e;for(_0x44e69e in _0x7f77c1){var _0x4edebe='FG';_0x493c95[_0x250b2b(0xc6)]==_0x250b2b(0xb3)&&(_0x4edebe='DG'),_0x1fa9d6+=_0x250b2b(0xd8)+_0x250b2b(0x148)+_0x7f77c1[_0x44e69e]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x7f77c1[_0x44e69e]['product_code']+_0x250b2b(0x164)+_0x250b2b(0x148)+_0x7f77c1[_0x44e69e][_0x250b2b(0x11c)]+_0x250b2b(0x164)+_0x250b2b(0x148)+_0x7f77c1[_0x44e69e]['unit']+'</td>'+_0x250b2b(0x148)+_0x7f77c1[_0x44e69e][_0x250b2b(0x114)]+'</td>'+_0x250b2b(0x148)+_0x493c95[_0x250b2b(0xc6)]+_0x250b2b(0x164)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x7f77c1[_0x44e69e]['to_room_name']+_0x250b2b(0x164)+_0x250b2b(0x148)+_0x4edebe+_0x7f77c1[_0x44e69e]['to_bay']+_0x250b2b(0x164)+_0x250b2b(0xce);}let _0x235701=nodemailer['createTransport']({'host':_0x3cd32c[_0x250b2b(0x10c)],'port':Number(_0x3cd32c[_0x250b2b(0xbb)]),'secure':![],'auth':{'user':_0x3cd32c[_0x250b2b(0x13b)],'pass':_0x3cd32c[_0x250b2b(0x143)]}}),_0x397ed8={'from':_0x3cd32c[_0x250b2b(0x13b)],'to':_0x53a8f[0x0]['FGSEmail'],'subject':_0x250b2b(0x12f),'attachments':[{'filename':_0x250b2b(0x15b),'path':__dirname+_0x250b2b(0xeb)+_0x250b2b(0x126)+_0x5a168c[0x0]['image'],'cid':_0x250b2b(0xf8)}],'html':_0x250b2b(0x14e)+_0x250b2b(0xe3)+_0x250b2b(0xde)+_0x250b2b(0xa9)+_0x250b2b(0xc7)+'<div>'+_0x250b2b(0xe2)+_0x250b2b(0xc9)+_0x250b2b(0xa9)+_0x250b2b(0x145)+_0x5a168c[0x0]['site_title']+'\x20</h2>'+_0x250b2b(0xc9)+_0x250b2b(0xc9)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x250b2b(0x13d)+'\x20Order\x20Number\x20:\x20'+_0x493c95[_0x250b2b(0x12b)]+'\x20'+_0x250b2b(0x169)+_0x250b2b(0x166)+_0x493c95[_0x250b2b(0xf5)]+'\x20'+'</span>'+'</h5>'+_0x250b2b(0xc9)+_0x250b2b(0x124)+_0x250b2b(0x14b)+_0x250b2b(0xd8)+_0x250b2b(0xb8)+_0x250b2b(0xed)+_0x250b2b(0xda)+_0x250b2b(0x153)+_0x250b2b(0xe7)+_0x250b2b(0xd6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x250b2b(0x165)+'</tr>'+_0x250b2b(0xf6)+_0x250b2b(0xcd)+'\x20'+_0x1fa9d6+'\x20'+_0x250b2b(0x11e)+_0x250b2b(0x10f)+'<div>'+_0x250b2b(0x14d)+_0x250b2b(0x13c)+_0x5a168c[0x0][_0x250b2b(0x142)]+_0x250b2b(0x13f)+_0x250b2b(0xc9)+_0x250b2b(0xc9)+_0x250b2b(0xe5)};_0x235701[_0x250b2b(0xcc)](_0x397ed8,function(_0x511ff8,_0x21f122){var _0x3a3261=_0x250b2b;_0x511ff8?(console[_0x3a3261(0x104)](_0x511ff8),console[_0x3a3261(0x104)]('Error\x20Occurs')):console['log'](_0x3a3261(0xf1));}),_0x5c6a69[_0x250b2b(0x10e)](_0x250b2b(0x119),_0x250b2b(0xf4)),_0x539107[_0x250b2b(0x152)](_0x250b2b(0x97)+_0xa3bdc[_0x250b2b(0xca)]);}catch(_0x10a261){console[_0x250b2b(0xf9)](_0x10a261),_0x539107[_0x250b2b(0xdf)](0x1f4)[_0x250b2b(0xa5)]({'error':_0x250b2b(0x162)});}})[_0x31c2a4(0xa7)](_0xb3648f=>{var _0x60af8e=_0x31c2a4;console[_0x60af8e(0xf9)](_0xb3648f),_0x539107['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x227028){console[_0x31c2a4(0xf9)](_0x227028),_0x539107[_0x31c2a4(0xdf)](0x1f4)[_0x31c2a4(0xa5)]({'error':_0x31c2a4(0xb5)});}})[_0x23cbc6(0xa7)](_0x5b143a=>{var _0x10399b=_0x23cbc6;console[_0x10399b(0xf9)](_0x5b143a),_0x539107['status'](0x1f4)[_0x10399b(0xa5)]({'error':_0x10399b(0x110)});});}catch(_0x4a2379){_0x539107[_0x23cbc6(0xa5)]({'message':_0x4a2379[_0x23cbc6(0x15c)]});}});function BayBinSelected(_0x249d50,_0x57a33b){var _0x1f7ee5=a0_0x1a5396,_0x3533f3=[];let _0x47353f=[];var _0x3c00fd=[];if(_0x249d50==_0x1f7ee5(0xb3)){switch(_0x57a33b){case _0x1f7ee5(0xff):_0x3533f3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0x3533f3=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3c00fd=['DG'];}else{if(_0x249d50==_0x1f7ee5(0x168)){switch(_0x57a33b){case _0x1f7ee5(0xff):_0x3533f3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x1f7ee5(0x144):_0x3533f3=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3c00fd=['FG'];}}return{'levels':_0x3533f3,'identify':_0x3c00fd};}function a0_0x1eff(_0x469525,_0x4ca213){var _0x444036=a0_0x4440();return a0_0x1eff=function(_0x1eff83,_0x267903){_0x1eff83=_0x1eff83-0x96;var _0x33126d=_0x444036[_0x1eff83];return _0x33126d;},a0_0x1eff(_0x469525,_0x4ca213);}router[a0_0x1a5396(0xf2)](a0_0x1a5396(0x13e),auth,async(_0x218466,_0x4a437e)=>{var _0x4bf0b1=a0_0x1a5396;try{const {username:_0x25b82e,email:_0x314273,role:_0x3f6fac}=_0x218466[_0x4bf0b1(0x12e)],_0x2d3621=_0x218466['user'],_0x315e37=await profile['findOne']({'email':_0x2d3621[_0x4bf0b1(0x13b)]}),_0x13ef88=await master_shop['find'](),_0x37cbb8=await transfers_finished[_0x4bf0b1(0x167)](_0x218466[_0x4bf0b1(0xd0)]['id']);let _0x314bed=new Date(_0x37cbb8[_0x4bf0b1(0xb2)]),_0x3eed41=('0'+_0x314bed[_0x4bf0b1(0x149)]())[_0x4bf0b1(0xfa)](-0x2),_0x15c920=('0'+(_0x314bed[_0x4bf0b1(0x131)]()+0x1))[_0x4bf0b1(0xfa)](-0x2),_0x2608ab=_0x314bed[_0x4bf0b1(0xc8)](),_0x534bfb=_0x2608ab+'-'+_0x15c920+'-'+_0x3eed41,_0x1c9375;if(_0x2d3621[_0x4bf0b1(0xa6)]=='staff'){const _0x453603=await staff[_0x4bf0b1(0x10a)]({'email':_0x2d3621[_0x4bf0b1(0x13b)]});_0x1c9375=await warehouse[_0x4bf0b1(0xfc)]({'status':_0x4bf0b1(0x115),'name':_0x453603['warehouse'],'warehouse_category':_0x4bf0b1(0xf7)});}else _0x1c9375=await warehouse[_0x4bf0b1(0xfc)]({'status':_0x4bf0b1(0x115),'warehouse_category':_0x4bf0b1(0xf7)});const _0x432963=await warehouse[_0x4bf0b1(0x15a)]([{'$match':{'name':_0x37cbb8[_0x4bf0b1(0x120)],'room':_0x37cbb8[_0x4bf0b1(0x105)]}},{'$unwind':_0x4bf0b1(0x11d)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4bf0b1(0x9a)},'product_stock':{'$first':_0x4bf0b1(0x118)},'bay':{'$first':_0x4bf0b1(0xee)},'bin':{'$first':_0x4bf0b1(0xba)},'type':{'$first':_0x4bf0b1(0xd1)},'floorlevel':{'$first':_0x4bf0b1(0x12a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4bf0b1(0x130)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4bf0b1(0xb9)},'rack':{'$first':_0x4bf0b1(0xd4)}}}]);var _0x3c2e80=[0x1,0x2,0x3,0x4],_0x4724a3=['A','B','C','D','E','F','G','H','I','J'],_0x515e2e=[_0x4bf0b1(0x146),_0x4bf0b1(0xb1)];const _0x1fd082=await product[_0x4bf0b1(0xfc)]({}),_0x54fff6=BayBinSelected(_0x37cbb8[_0x4bf0b1(0xc6)],_0x37cbb8['to_room']);if(_0x13ef88[0x0]['language']==_0x4bf0b1(0xa1)){var _0x36d1bd=users[_0x4bf0b1(0x16c)];console['log'](_0x36d1bd);}else{if(_0x13ef88[0x0][_0x4bf0b1(0x125)]=='Hindi')var _0x36d1bd=users['Hindi'];else{if(_0x13ef88[0x0][_0x4bf0b1(0x125)]==_0x4bf0b1(0x157))var _0x36d1bd=users[_0x4bf0b1(0x157)];else{if(_0x13ef88[0x0][_0x4bf0b1(0x125)]==_0x4bf0b1(0x9c))var _0x36d1bd=users[_0x4bf0b1(0x9c)];else{if(_0x13ef88[0x0][_0x4bf0b1(0x125)]==_0x4bf0b1(0x136))var _0x36d1bd=users[_0x4bf0b1(0x136)];else{if(_0x13ef88[0x0]['language']==_0x4bf0b1(0x141))var _0x36d1bd=users[_0x4bf0b1(0x16e)];else{if(_0x13ef88[0x0]['language']==_0x4bf0b1(0x160))var _0x36d1bd=users[_0x4bf0b1(0x160)];else{if(_0x13ef88[0x0]['language']==_0x4bf0b1(0x107))var _0x36d1bd=users[_0x4bf0b1(0x99)];}}}}}}}_0x4a437e['render']('edit_transfer_finished',{'success':_0x218466[_0x4bf0b1(0x10e)](_0x4bf0b1(0x119)),'errors':_0x218466[_0x4bf0b1(0x10e)](_0x4bf0b1(0xa3)),'role':_0x2d3621,'profile':_0x315e37,'master_shop':_0x13ef88,'warehouse':_0x1c9375,'transfer':_0x37cbb8,'stock':_0x432963,'unit':_0x1fd082,'language':_0x36d1bd,'levels':_0x3c2e80,'Isle':_0x4724a3,'rooms_data':_0x515e2e,'ed_fullDate':_0x534bfb,'dataSelected':_0x54fff6});}catch(_0x1139dc){console['log'](_0x1139dc);}}),router[a0_0x1a5396(0x127)](a0_0x1a5396(0x13e),auth,async(_0x2e1d97,_0x483797)=>{var _0x5c03fd=a0_0x1a5396;try{const _0x11dbad=_0x2e1d97['params']['id'];console[_0x5c03fd(0x104)](_0x2e1d97[_0x5c03fd(0xfe)]);const _0x3b5b8c=await transfers_finished[_0x5c03fd(0x167)](_0x11dbad);console[_0x5c03fd(0x104)](_0x5c03fd(0x129),_0x3b5b8c);const {date:_0x413298,from_warehouse:_0x37c117,FromRoom_name:_0x3c54bc,to_warehouse:_0x1cf8af,ToRoom_name:_0x42c71d,prod_name:_0x5ab671,from_prod_qty:_0x571b0a,from_prod_level:_0x12571f,from_prod_isle:_0x2f47b6,from_prod_pallet:_0x55fdf2,to_prod_qty:_0x1ea8e5,to_prod_level:_0x3fe56c,to_prod_isle:_0x158167,to_prod_pallet:_0x192fb0,primary_code:_0x512677,secondary_code:_0x271499,product_code3:_0x52505f,note:_0x37792f,invoice:_0x50aeb8,expiry_date:_0x1bf80f}=_0x2e1d97['body'];if(typeof _0x5ab671==_0x5c03fd(0x123))var _0x29765c=[_0x2e1d97['body'][_0x5c03fd(0xc3)]],_0x2191ff=[_0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x140)]],_0x35621c=[_0x2e1d97['body'][_0x5c03fd(0x112)]],_0x4de324=[_0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0xf0)]],_0x309295=[_0x2e1d97['body'][_0x5c03fd(0xec)]],_0x3c8d1a=[_0x2e1d97[_0x5c03fd(0xfe)]['primary_code']],_0x3bf431=[_0x2e1d97['body'][_0x5c03fd(0x15f)]],_0x5f2915=[_0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x15e)]],_0x49a872=[_0x2e1d97['body'][_0x5c03fd(0x137)]],_0x3c2877=[_0x2e1d97['body'][_0x5c03fd(0xcb)]],_0x3ee43d=[_0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x114)]],_0x1b841f=[_0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x159)]],_0x1d8861=[_0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0xb2)]];else var _0x29765c=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0xc3)]],_0x2191ff=[..._0x2e1d97['body'][_0x5c03fd(0x140)]],_0x35621c=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x112)]],_0x4de324=[..._0x2e1d97[_0x5c03fd(0xfe)]['to_prod_qty']],_0x309295=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0xec)]],_0x3c8d1a=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x163)]],_0x3bf431=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x15f)]],_0x5f2915=[..._0x2e1d97['body']['product_code3']],_0x49a872=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x137)]],_0x3c2877=[..._0x2e1d97[_0x5c03fd(0xfe)]['unit']],_0x3ee43d=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x114)]],_0x1b841f=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0x159)]],_0x1d8861=[..._0x2e1d97[_0x5c03fd(0xfe)][_0x5c03fd(0xb2)]];const _0x3cc34d=_0x29765c['map'](_0x294fb5=>{return _0x294fb5={'product_name':_0x294fb5};});_0x2191ff[_0x5c03fd(0x16a)]((_0x50f803,_0x483d7b)=>{var _0x5ef3bf=_0x5c03fd;_0x3cc34d[_0x483d7b][_0x5ef3bf(0xd3)]=_0x50f803;}),_0x35621c[_0x5c03fd(0x16a)]((_0x3990d8,_0x43a667)=>{var _0x3d3e10=_0x5c03fd;_0x3cc34d[_0x43a667][_0x3d3e10(0x133)]=_0x3990d8;}),_0x4de324[_0x5c03fd(0x16a)]((_0x880fcc,_0x17e6ab)=>{var _0x58de1b=_0x5c03fd;_0x3cc34d[_0x17e6ab][_0x58de1b(0x11c)]=_0x880fcc;}),_0x309295[_0x5c03fd(0x16a)]((_0x35dd37,_0x4bb0bf)=>{var _0xdc32de=_0x5c03fd;_0x3cc34d[_0x4bb0bf][_0xdc32de(0x135)]=_0x35dd37;}),_0x3c8d1a[_0x5c03fd(0x16a)]((_0x1f67c,_0x2bf1a6)=>{var _0x150d08=_0x5c03fd;_0x3cc34d[_0x2bf1a6][_0x150d08(0x163)]=_0x1f67c;}),_0x3bf431['forEach']((_0x35f74e,_0x1ca448)=>{var _0x43eda0=_0x5c03fd;_0x3cc34d[_0x1ca448][_0x43eda0(0x15f)]=_0x35f74e;}),_0x5f2915['forEach']((_0xe4e625,_0x43acfd)=>{var _0x1bd2ca=_0x5c03fd;_0x3cc34d[_0x43acfd][_0x1bd2ca(0xcf)]=_0xe4e625;}),_0x49a872[_0x5c03fd(0x16a)]((_0x21e144,_0x59307c)=>{var _0x3c7cd2=_0x5c03fd;_0x3cc34d[_0x59307c][_0x3c7cd2(0xe0)]=_0x21e144;}),_0x3c2877[_0x5c03fd(0x16a)]((_0x44428c,_0x27ac13)=>{var _0x481128=_0x5c03fd;_0x3cc34d[_0x27ac13][_0x481128(0xcb)]=_0x44428c;}),_0x3ee43d[_0x5c03fd(0x16a)]((_0x4f5553,_0x440f30)=>{var _0x59a6b5=_0x5c03fd;_0x3cc34d[_0x440f30][_0x59a6b5(0x114)]=_0x4f5553;}),_0x1b841f[_0x5c03fd(0x16a)]((_0xf5a224,_0x44aaf5)=>{_0x3cc34d[_0x44aaf5]['batch_code']=_0xf5a224;}),_0x1d8861['forEach']((_0x49d138,_0x115f16)=>{_0x3cc34d[_0x115f16]['expiry_date']=_0x49d138;});const _0x429463=_0x3cc34d[_0x5c03fd(0xaa)](_0x5415b8=>_0x5415b8[_0x5c03fd(0x11c)]!=='0'&&_0x5415b8[_0x5c03fd(0x11c)]!==''||_0x5415b8[_0x5c03fd(0xc5)]!=='0'&&_0x5415b8['to_floorlevel']!=='');var _0x1a31a2=0x0;_0x429463[_0x5c03fd(0x16a)](_0x22a20b=>{var _0x1f553b=_0x5c03fd;parseInt(_0x22a20b[_0x1f553b(0xd3)])<parseInt(_0x22a20b[_0x1f553b(0x11c)])&&_0x1a31a2++;});if(_0x1a31a2!=0x0)return _0x2e1d97[_0x5c03fd(0x10e)]('errors',_0x5c03fd(0x14a)),_0x483797[_0x5c03fd(0x152)]('back');const _0x59fb04=await warehouse['findOne']({'name':_0x3b5b8c[_0x5c03fd(0x120)],'room':_0x3b5b8c[_0x5c03fd(0x105)]});_0x3b5b8c[_0x5c03fd(0x98)][_0x5c03fd(0x16a)](_0x3b4cc1=>{var _0x1be6cf=_0x5c03fd;if(_0x3b4cc1[_0x1be6cf(0x11c)]>0x0){const _0x1d7834=_0x59fb04[_0x1be6cf(0x151)][_0x1be6cf(0x9d)](_0xd53f2=>{var _0x70c0b5=_0x1be6cf;_0xd53f2[_0x70c0b5(0xb6)]==_0x3b4cc1[_0x70c0b5(0xb6)]&&_0xd53f2['bay']==_0x3b4cc1['from_bay']&&(_0xd53f2[_0x70c0b5(0x128)]=parseInt(_0xd53f2[_0x70c0b5(0x128)])+parseInt(_0x3b4cc1[_0x70c0b5(0x11c)]));});}}),await _0x59fb04['save']();const _0x5cdfef=await warehouse[_0x5c03fd(0x10a)]({'name':_0x3b5b8c['to_warehouse'],'room':_0x3b5b8c[_0x5c03fd(0xdd)]});_0x3b5b8c[_0x5c03fd(0x98)][_0x5c03fd(0x16a)](_0x43d303=>{var _0x31918a=_0x5c03fd;if(_0x43d303[_0x31918a(0x11c)]>0x0){const _0x5533d4=_0x5cdfef[_0x31918a(0x151)][_0x31918a(0x9d)](_0x4241e3=>{var _0x43a888=_0x31918a;_0x4241e3[_0x43a888(0xb6)]==_0x43d303[_0x43a888(0xb6)]&&_0x4241e3[_0x43a888(0x155)]==_0x43d303[_0x43a888(0x135)]&&(_0x4241e3['product_stock']=parseInt(_0x4241e3[_0x43a888(0x128)])-parseInt(_0x43d303[_0x43a888(0x11c)]));});}}),await _0x5cdfef['save'](),_0x3b5b8c[_0x5c03fd(0xf5)]=_0x413298,_0x3b5b8c[_0x5c03fd(0x120)]=_0x37c117,_0x3b5b8c[_0x5c03fd(0xc6)]=_0x1cf8af,_0x3b5b8c[_0x5c03fd(0x98)]=_0x429463,_0x3b5b8c[_0x5c03fd(0xb0)]=_0x37792f,_0x3b5b8c['invoice']=_0x50aeb8;const _0x9f02a2=await _0x3b5b8c[_0x5c03fd(0xd7)](),_0xb44d02=await warehouse[_0x5c03fd(0x10a)]({'name':_0x37c117,'room':_0x3c54bc});_0x9f02a2[_0x5c03fd(0x98)][_0x5c03fd(0x16a)](_0x15e34f=>{var _0x162e80=_0x5c03fd;if(_0x15e34f[_0x162e80(0x11c)]>0x0){const _0x3b6f9f=_0xb44d02['product_details']['map'](_0x187fc7=>{var _0x5f57d6=_0x162e80;_0x187fc7[_0x5f57d6(0xb6)]==_0x15e34f['product_name']&&_0x187fc7['bay']==_0x15e34f[_0x5f57d6(0x133)]&&(_0x187fc7[_0x5f57d6(0x128)]=parseInt(_0x187fc7[_0x5f57d6(0x128)])-parseInt(_0x15e34f['to_quantity']));});}}),await _0xb44d02[_0x5c03fd(0xd7)]();const _0x1b6cd0=await warehouse[_0x5c03fd(0x10a)]({'name':_0x1cf8af,'room':_0x42c71d});_0x9f02a2['product'][_0x5c03fd(0x16a)](_0xcb9803=>{var _0x5e7fa4=_0x5c03fd;if(_0xcb9803[_0x5e7fa4(0x11c)]>0x0){var _0x19da2c=0x0;const _0x3276af=_0x1b6cd0[_0x5e7fa4(0x151)][_0x5e7fa4(0x9d)](_0x140f05=>{var _0x3b61d5=_0x5e7fa4;_0x140f05['product_name']==_0xcb9803[_0x3b61d5(0xb6)]&&_0x140f05[_0x3b61d5(0x155)]==_0xcb9803[_0x3b61d5(0x135)]&&(_0x140f05[_0x3b61d5(0x128)]=parseInt(_0x140f05[_0x3b61d5(0x128)])+parseInt(_0xcb9803['to_quantity']),_0x19da2c++);});_0x19da2c=='0'&&(_0x1b6cd0[_0x5e7fa4(0x151)]=_0x1b6cd0[_0x5e7fa4(0x151)][_0x5e7fa4(0x11a)]({'product_name':_0xcb9803[_0x5e7fa4(0xb6)],'product_stock':_0xcb9803[_0x5e7fa4(0x11c)],'bay':_0xcb9803['to_bay'],'product_code':_0xcb9803[_0x5e7fa4(0xcf)],'primary_code':_0xcb9803['primary_code'],'secondary_code':_0xcb9803[_0x5e7fa4(0x15f)],'maxProducts':_0xcb9803[_0x5e7fa4(0xe0)]}));}}),await _0x1b6cd0[_0x5c03fd(0xd7)](),_0x2e1d97[_0x5c03fd(0x10e)](_0x5c03fd(0x119),_0x5c03fd(0x117)),_0x483797['redirect'](_0x5c03fd(0xbc));}catch(_0x31e5da){console[_0x5c03fd(0x104)](_0x31e5da);}}),router['post']('/barcode_scanner',async(_0x578186,_0x1f4412)=>{var _0x365acb=a0_0x1a5396;const {FromWareHouse:_0x1f6117,FromRoom:_0x403b0c,ToWarehouse:_0x307f0b,ToRoom:_0x131c1e,primary_code:_0x1d3eb1,Roomslist:_0x59a668}=_0x578186[_0x365acb(0xfe)],_0x5b0940=_0x59a668['split'](','),_0x4a11b0=[];async function _0x4f5d42(_0x33c54b){var _0x269a56=_0x365acb;const _0x153eb6=await warehouse[_0x269a56(0x15a)]([{'$match':{'name':_0x1f6117,'room':_0x33c54b}},{'$unwind':_0x269a56(0x11d)},{'$match':{'product_details.primary_code':_0x1d3eb1}},{'$group':{'_id':_0x269a56(0xbd),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x269a56(0x118)},'primary_code':{'$first':_0x269a56(0xfb)},'secondary_code':{'$first':_0x269a56(0x130)},'product_code':{'$first':_0x269a56(0xb7)},'level':{'$first':_0x269a56(0xee)},'isle':{'$first':_0x269a56(0xba)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x269a56(0x158)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x269a56(0xd4)},'expiry_date':{'$first':_0x269a56(0x154)},'production_date':{'$first':_0x269a56(0x15d)},'batch_code':{'$first':_0x269a56(0xe1)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x269a56(0x11b)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x1eb2c9=await warehouse[_0x269a56(0x15a)]([{'$match':{'name':_0x1f6117,'room':_0x33c54b}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1d3eb1}},{'$group':{'_id':_0x269a56(0xbd),'name':{'$first':_0x269a56(0x9a)},'instock':{'$first':_0x269a56(0x118)},'primary_code':{'$first':_0x269a56(0xfb)},'secondary_code':{'$first':_0x269a56(0x130)},'product_code':{'$first':_0x269a56(0xb7)},'level':{'$first':_0x269a56(0xee)},'isle':{'$first':_0x269a56(0xba)},'type':{'$first':_0x269a56(0xd1)},'pallet':{'$first':_0x269a56(0x12a)},'unit':{'$first':_0x269a56(0xea)},'secondary_unit':{'$first':_0x269a56(0x158)},'storage':{'$first':_0x269a56(0xb9)},'rack':{'$first':_0x269a56(0xd4)},'expiry_date':{'$first':_0x269a56(0x154)},'production_date':{'$first':_0x269a56(0x15d)},'batch_code':{'$first':_0x269a56(0xe1)},'maxPerUnit':{'$first':_0x269a56(0xd5)},'roomNamed':{'$first':_0x269a56(0x11b)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x269a56(0xbf)}}}]);if(_0x153eb6['length']>0x0)_0x4a11b0[_0x269a56(0x106)](_0x153eb6);else _0x1eb2c9[_0x269a56(0xc0)]>0x0&&_0x4a11b0[_0x269a56(0x106)](_0x1eb2c9);}const _0x3f088a=_0x5b0940[_0x365acb(0x9d)](_0x5cecd8=>_0x4f5d42(_0x5cecd8));await Promise[_0x365acb(0x121)](_0x3f088a),_0x1f4412[_0x365acb(0xa5)](_0x4a11b0);}),router[a0_0x1a5396(0x127)](a0_0x1a5396(0x9f),async(_0x3abb95,_0x52a6c5)=>{var _0x5a7ce7=a0_0x1a5396;try{const {FromWareHouse:_0x366fa1,FromRoom:_0x3c4cd6,ToWarehouse:_0x3421f2,ToRoom:_0x583f3d,secondary_code:_0x49e3fa}=_0x3abb95['body'],_0x564a4d=await warehouse['aggregate']([{'$match':{'name':_0x366fa1}},{'$unwind':_0x5a7ce7(0x11d)},{'$match':{'product_details.secondary_code':_0x49e3fa}},{'$group':{'_id':_0x5a7ce7(0xbd),'name':{'$first':_0x5a7ce7(0x9a)},'primary_code':{'$first':_0x5a7ce7(0xfb)},'secondary_code':{'$first':_0x5a7ce7(0x130)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0x5a7ce7(0x13a)},'level':{'$first':_0x5a7ce7(0x147)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5a7ce7(0x10d)},'maxProducts':{'$first':_0x5a7ce7(0x9e)},'unit':{'$first':_0x5a7ce7(0xea)},'expiry_date':{'$first':_0x5a7ce7(0x154)},'production_date':{'$first':_0x5a7ce7(0x15d)}}}]);_0x52a6c5[_0x5a7ce7(0xdf)](0xc8)['json'](_0x564a4d);}catch(_0xf91c59){_0x52a6c5[_0x5a7ce7(0xdf)](0x194)[_0x5a7ce7(0xa5)]({'message':_0xf91c59[_0x5a7ce7(0x15c)]});}}),router['post']('/barcode_scanner3',async(_0x456751,_0x5c7170)=>{var _0x3c00d3=a0_0x1a5396;try{const {FromWareHouse:_0x4d9ecb,FromRoom:_0x36f6f9,ToWarehouse:_0x15ed79,ToRoom:_0x57ab66,product_code:_0x32627e}=_0x456751[_0x3c00d3(0xfe)],_0x2eec41=await warehouse['aggregate']([{'$match':{'name':_0x4d9ecb}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x32627e}},{'$group':{'_id':_0x3c00d3(0xbd),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x3c00d3(0xfb)},'secondary_code':{'$first':_0x3c00d3(0x130)},'product_code':{'$first':_0x3c00d3(0xb7)},'instock':{'$first':_0x3c00d3(0x118)},'warehouse':{'$first':_0x3c00d3(0x13a)},'level':{'$first':_0x3c00d3(0x147)},'isle':{'$first':_0x3c00d3(0x100)},'pallet':{'$first':_0x3c00d3(0x10d)},'maxProducts':{'$first':_0x3c00d3(0x9e)},'unit':{'$first':_0x3c00d3(0xea)}}}]);_0x5c7170[_0x3c00d3(0xdf)](0xc8)[_0x3c00d3(0xa5)](_0x2eec41);}catch(_0x4dbb44){_0x5c7170[_0x3c00d3(0xdf)](0x194)['json']({'message':_0x4dbb44[_0x3c00d3(0x15c)]});}}),router[a0_0x1a5396(0x127)]('/CheckingWarehouse',async(_0x12fe25,_0x4b0fe3)=>{var _0x2e72c9=a0_0x1a5396;const {productCode:_0x396176,bay:_0x11ba60,warehouses:_0x4e4df7,room:_0x5b301c}=_0x12fe25[_0x2e72c9(0xfe)];console[_0x2e72c9(0x104)](_0x12fe25[_0x2e72c9(0xfe)]);try{const _0x13dbd7=await warehouse[_0x2e72c9(0x15a)]([{'$match':{'name':_0x4e4df7,'room':_0x5b301c}},{'$unwind':_0x2e72c9(0x11d)},{'$match':{'product_details.bay':parseInt(_0x11ba60)}},{'$group':{'_id':_0x2e72c9(0xbd),'name':{'$first':_0x2e72c9(0x9a)},'product_stock':{'$first':_0x2e72c9(0x118)},'bay':{'$first':_0x2e72c9(0xee)},'maxProducts':{'$first':_0x2e72c9(0x9e)}}}]);_0x4b0fe3[_0x2e72c9(0xdf)](0xc8)[_0x2e72c9(0xa5)](_0x13dbd7);}catch(_0x2cba18){_0x4b0fe3[_0x2e72c9(0xdf)](0x194)[_0x2e72c9(0xa5)]({'message':_0x2cba18[_0x2e72c9(0x15c)]});}}),module[a0_0x1a5396(0xe9)]=router;