var a0_0x8ce878=a0_0x59e6;(function(_0x154605,_0x182b17){var _0x8bcccf=a0_0x59e6,_0x112450=_0x154605();while(!![]){try{var _0x2f14e2=parseInt(_0x8bcccf(0x1fb))/0x1+-parseInt(_0x8bcccf(0x246))/0x2*(parseInt(_0x8bcccf(0x235))/0x3)+-parseInt(_0x8bcccf(0x241))/0x4+-parseInt(_0x8bcccf(0x27f))/0x5+-parseInt(_0x8bcccf(0x22f))/0x6*(parseInt(_0x8bcccf(0x28f))/0x7)+parseInt(_0x8bcccf(0x1ff))/0x8+parseInt(_0x8bcccf(0x21f))/0x9;if(_0x2f14e2===_0x182b17)break;else _0x112450['push'](_0x112450['shift']());}catch(_0x4f190e){_0x112450['push'](_0x112450['shift']());}}}(a0_0x5313,0x693d5));const express=require(a0_0x8ce878(0x29f)),app=express(),router=express[a0_0x8ce878(0x1f3)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x8ce878(0x255)),users=require(a0_0x8ce878(0x288)),nodemailer=require(a0_0x8ce878(0x240));function a0_0x59e6(_0x1bbc04,_0x1c594a){var _0x531390=a0_0x5313();return a0_0x59e6=function(_0x59e64c,_0x243a89){_0x59e64c=_0x59e64c-0x1e1;var _0x23bebb=_0x531390[_0x59e64c];return _0x23bebb;},a0_0x59e6(_0x1bbc04,_0x1c594a);}router[a0_0x8ce878(0x247)](a0_0x8ce878(0x27e),auth,async(_0x4b7233,_0x175fa0)=>{var _0x5f2f75=a0_0x8ce878;try{const {username:_0x344f05,email:_0x504a96,role:_0x4ab28c}=_0x4b7233[_0x5f2f75(0x2b3)],_0x25259e=_0x4b7233['user'],_0x773cd6=await profile[_0x5f2f75(0x1fd)]({'email':_0x25259e['email']}),_0x47d23d=await master_shop[_0x5f2f75(0x1f4)]();let _0x5a1ca6;if(_0x25259e[_0x5f2f75(0x211)]==_0x5f2f75(0x26a)){const _0x517403=await staff[_0x5f2f75(0x1fd)]({'email':_0x25259e[_0x5f2f75(0x2ad)]});_0x5a1ca6=await transfers_finished[_0x5f2f75(0x1f4)]({'from_warehouse':_0x517403['warehouse']});}else _0x5a1ca6=await transfers_finished[_0x5f2f75(0x215)]([{'$unwind':_0x5f2f75(0x27b)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x5f2f75(0x296)},'from_warehouse':{'$first':_0x5f2f75(0x249)},'to_warehouse':{'$first':_0x5f2f75(0x2b8)},'from_room_name':{'$addToSet':_0x5f2f75(0x280)},'to_room_name':{'$addToSet':_0x5f2f75(0x28a)},'finalize':{'$first':_0x5f2f75(0x254)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x47d23d[0x0][_0x5f2f75(0x25e)]==_0x5f2f75(0x2aa))var _0x38f67b=users[_0x5f2f75(0x2b4)];else{if(_0x47d23d[0x0][_0x5f2f75(0x25e)]==_0x5f2f75(0x1e3))var _0x38f67b=users[_0x5f2f75(0x1e3)];else{if(_0x47d23d[0x0]['language']==_0x5f2f75(0x229))var _0x38f67b=users[_0x5f2f75(0x229)];else{if(_0x47d23d[0x0]['language']==_0x5f2f75(0x2a9))var _0x38f67b=users[_0x5f2f75(0x2a9)];else{if(_0x47d23d[0x0][_0x5f2f75(0x25e)]=='French')var _0x38f67b=users['French'];else{if(_0x47d23d[0x0]['language']==_0x5f2f75(0x278))var _0x38f67b=users['Portuguese'];else{if(_0x47d23d[0x0][_0x5f2f75(0x25e)]==_0x5f2f75(0x25f))var _0x38f67b=users[_0x5f2f75(0x25f)];else{if(_0x47d23d[0x0][_0x5f2f75(0x25e)]==_0x5f2f75(0x244))var _0x38f67b=users[_0x5f2f75(0x217)];}}}}}}}_0x175fa0[_0x5f2f75(0x1fe)](_0x5f2f75(0x214),{'success':_0x4b7233[_0x5f2f75(0x25a)](_0x5f2f75(0x21a)),'errors':_0x4b7233[_0x5f2f75(0x25a)](_0x5f2f75(0x274)),'role':_0x25259e,'profile':_0x773cd6,'master_shop':_0x47d23d,'transfer':_0x5a1ca6,'language':_0x38f67b});}catch(_0x4deed1){console[_0x5f2f75(0x282)](_0x4deed1);}});async function getRandom8DigitNumber(){var _0x526af3=a0_0x8ce878;const _0x17957b=0x989680,_0x3c413e=0x5f5e0ff,_0x5edef1=Math[_0x526af3(0x221)](Math[_0x526af3(0x299)]()*(_0x3c413e-_0x17957b+0x1))+_0x17957b;var _0x3dc7f2;const _0x325d47=await transfers_finished[_0x526af3(0x1fd)]({'invoice':_0x526af3(0x1e9)+_0x5edef1});return _0x325d47&&_0x325d47[_0x526af3(0x2a3)]>0x0?_0x3dc7f2=_0x526af3(0x1e9)+_0x5edef1:_0x3dc7f2=_0x526af3(0x1e9)+_0x5edef1,_0x3dc7f2;}router[a0_0x8ce878(0x247)](a0_0x8ce878(0x1e7),auth,async(_0x4a120a,_0x161ba9)=>{var _0x100d2a=a0_0x8ce878;try{const {username:_0x530b2d,email:_0x5db98d,role:_0xda18c1}=_0x4a120a[_0x100d2a(0x2b3)],_0x1ef737=_0x4a120a[_0x100d2a(0x2b3)],_0x1a4ee2=await profile[_0x100d2a(0x1fd)]({'email':_0x1ef737[_0x100d2a(0x2ad)]}),_0x3a5cb1=await master_shop[_0x100d2a(0x1f4)]();let _0x501550;if(_0x1ef737[_0x100d2a(0x211)]==_0x100d2a(0x26a)){const _0x2adc37=await staff[_0x100d2a(0x1fd)]({'email':_0x1ef737['email']});_0x501550=await warehouse['aggregate']([{'$match':{'status':_0x100d2a(0x22d),'name':_0x2adc37[_0x100d2a(0x2a6)],'warehouse_category':_0x100d2a(0x287),'name':{'$ne':_0x100d2a(0x233)}}},{'$group':{'_id':_0x100d2a(0x250),'name':{'$first':_0x100d2a(0x250)}}}]);}else _0x501550=await warehouse[_0x100d2a(0x215)]([{'$match':{'status':_0x100d2a(0x22d),'warehouse_category':_0x100d2a(0x287),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x100d2a(0x250),'name':{'$first':_0x100d2a(0x250)}}}]);const _0x34923b=await transfers_finished[_0x100d2a(0x1f4)]({}),_0x8c1912=_0x34923b[_0x100d2a(0x2a3)]+0x1,_0xf9358c=_0x100d2a(0x1e9)+_0x8c1912[_0x100d2a(0x245)]()['padStart'](0x5,'0');if(_0x3a5cb1[0x0][_0x100d2a(0x25e)]=='English\x20(US)')var _0x34f457=users['English'];else{if(_0x3a5cb1[0x0][_0x100d2a(0x25e)]==_0x100d2a(0x1e3))var _0x34f457=users[_0x100d2a(0x1e3)];else{if(_0x3a5cb1[0x0][_0x100d2a(0x25e)]==_0x100d2a(0x229))var _0x34f457=users[_0x100d2a(0x229)];else{if(_0x3a5cb1[0x0][_0x100d2a(0x25e)]==_0x100d2a(0x2a9))var _0x34f457=users[_0x100d2a(0x2a9)];else{if(_0x3a5cb1[0x0]['language']=='French')var _0x34f457=users[_0x100d2a(0x213)];else{if(_0x3a5cb1[0x0]['language']==_0x100d2a(0x278))var _0x34f457=users['Portuguese'];else{if(_0x3a5cb1[0x0][_0x100d2a(0x25e)]==_0x100d2a(0x25f))var _0x34f457=users[_0x100d2a(0x25f)];else{if(_0x3a5cb1[0x0]['language']==_0x100d2a(0x244))var _0x34f457=users[_0x100d2a(0x217)];}}}}}}}const _0x143b85=getRandom8DigitNumber();_0x143b85[_0x100d2a(0x1e2)](_0x214ad6=>{var _0x5ef6c7=_0x100d2a;_0x161ba9['render'](_0x5ef6c7(0x228),{'success':_0x4a120a['flash'](_0x5ef6c7(0x21a)),'errors':_0x4a120a['flash'](_0x5ef6c7(0x274)),'role':_0x1ef737,'profile':_0x1a4ee2,'master_shop':_0x3a5cb1,'warehouse':_0x501550,'language':_0x34f457,'invoice':_0x214ad6});})[_0x100d2a(0x23e)](_0x495a5c=>{var _0x44a200=_0x100d2a;_0x4a120a[_0x44a200(0x25a)](_0x44a200(0x274),_0x44a200(0x212)),_0x161ba9['redirect'](_0x44a200(0x295));});}catch(_0x3cbe63){console[_0x100d2a(0x282)](_0x3cbe63);}}),router[a0_0x8ce878(0x2b7)](a0_0x8ce878(0x1e7),auth,async(_0x4985d0,_0x26be78)=>{var _0x3de3b9=a0_0x8ce878;try{const {date:_0x14ab4d,from_warehouse:_0x19dcfa,FromRoom_name:_0x58b8d6,to_warehouse:_0x24525b,ToRoom_name:_0x201863,prod_name:_0x3f4e14,from_prod_qty:_0x106b3d,from_prod_level:_0x5c7667,from_prod_isle:_0x45a88b,from_prod_pallet:_0x3beb69,to_prod_qty:_0x3a358c,to_prod_level:_0x3c30ab,to_prod_isle:_0x169fc2,to_prod_pallet:_0x40423e,primary_code:_0x43cb1f,secondary_code:_0x2accee,product_code3:_0x267b15,note:_0x4bd2ac,MaxStocks_data2:_0x1b99dd,invoice:_0x3ed8ef,expiry_date:_0x17bad7}=_0x4985d0[_0x3de3b9(0x25b)];if(typeof _0x3f4e14==_0x3de3b9(0x22b))var _0x59d473=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x28b)]],_0x16acf1=[_0x4985d0[_0x3de3b9(0x25b)]['from_prod_qty']],_0x2379ee=[_0x4985d0['body'][_0x3de3b9(0x253)]],_0x5796eb=[_0x4985d0[_0x3de3b9(0x25b)]['New_Qty_Converted']],_0x5bac85=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x1ed)]],_0x132ee0=[_0x4985d0['body']['primary_code']],_0x24e62e=[_0x4985d0[_0x3de3b9(0x25b)]['secondary_code']],_0x4d0cf3=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x203)]],_0x5d4000=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x206)]],_0x2034bb=[_0x4985d0['body']['primary_unit']],_0x21684e=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x1e5)]],_0x2827ee=[_0x4985d0['body']['batch_code']],_0x5cb765=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x2b0)]],_0x115056=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x277)]],_0x4c45c4=[_0x4985d0['body'][_0x3de3b9(0x2a7)]],_0x3f89a3=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x286)]],_0x8c1c0b=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x1f1)]],_0x4bbcf4=[_0x4985d0['body']['RoomAssigned']],_0x1347b9=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x232)]],_0x555fb5=[_0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x227)]],_0x12ae14=[_0x4985d0['body'][_0x3de3b9(0x21c)]];else var _0x59d473=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x28b)]],_0x16acf1=[..._0x4985d0[_0x3de3b9(0x25b)]['from_prod_qty']],_0x2379ee=[..._0x4985d0['body']['from_prod_level']],_0x5796eb=[..._0x4985d0['body'][_0x3de3b9(0x291)]],_0x5bac85=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x1ed)]],_0x132ee0=[..._0x4985d0['body'][_0x3de3b9(0x21d)]],_0x24e62e=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x209)]],_0x4d0cf3=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x203)]],_0x5d4000=[..._0x4985d0[_0x3de3b9(0x25b)]['MaxStocks_data2']],_0x2034bb=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x1f8)]],_0x21684e=[..._0x4985d0['body'][_0x3de3b9(0x1e5)]],_0x2827ee=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x218)]],_0x5cb765=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x2b0)]],_0x115056=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x277)]],_0x4c45c4=[..._0x4985d0['body']['MaxStocks_data']],_0x3f89a3=[..._0x4985d0[_0x3de3b9(0x25b)]['maxPerUnit']],_0x8c1c0b=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x1f1)]],_0x4bbcf4=[..._0x4985d0['body'][_0x3de3b9(0x224)]],_0x1347b9=[..._0x4985d0['body']['ToRoomAssigned']],_0x555fb5=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x227)]],_0x12ae14=[..._0x4985d0[_0x3de3b9(0x25b)][_0x3de3b9(0x21c)]];const _0x444c58=_0x59d473[_0x3de3b9(0x293)](_0x47d11c=>{return _0x47d11c={'product_name':_0x47d11c};});_0x16acf1['forEach']((_0x774eeb,_0x5c419b)=>{var _0x4808f2=_0x3de3b9;_0x444c58[_0x5c419b][_0x4808f2(0x1f0)]=_0x774eeb;}),_0x2379ee[_0x3de3b9(0x2b6)]((_0x315399,_0x5d2e5f)=>{_0x444c58[_0x5d2e5f]['from_bay']=_0x315399;}),_0x555fb5[_0x3de3b9(0x2b6)]((_0x22bec7,_0x4ec23c)=>{var _0x35cbbe=_0x3de3b9;_0x444c58[_0x4ec23c][_0x35cbbe(0x227)]=_0x22bec7;}),_0x12ae14['forEach']((_0x4c2d32,_0x50152e)=>{var _0x2267e9=_0x3de3b9;_0x444c58[_0x50152e][_0x2267e9(0x20e)]=_0x4c2d32;}),_0x5796eb[_0x3de3b9(0x2b6)]((_0x28ad46,_0x462524)=>{_0x444c58[_0x462524]['to_quantity']=_0x28ad46;}),_0x5bac85[_0x3de3b9(0x2b6)]((_0x5969c7,_0x37b24d)=>{var _0x2ed92f=_0x3de3b9;_0x444c58[_0x37b24d][_0x2ed92f(0x21e)]=_0x5969c7;}),_0x132ee0[_0x3de3b9(0x2b6)]((_0x2a9635,_0x22eda6)=>{_0x444c58[_0x22eda6]['primary_code']=_0x2a9635;}),_0x24e62e[_0x3de3b9(0x2b6)]((_0x59aa84,_0x380b1f)=>{_0x444c58[_0x380b1f]['secondary_code']=_0x59aa84;}),_0x4d0cf3[_0x3de3b9(0x2b6)]((_0xe2e9b,_0x1a2122)=>{_0x444c58[_0x1a2122]['product_code']=_0xe2e9b;}),_0x5d4000['forEach']((_0x3a3241,_0x1c0f56)=>{var _0x2c7d4e=_0x3de3b9;_0x444c58[_0x1c0f56][_0x2c7d4e(0x205)]=_0x3a3241;}),_0x2034bb[_0x3de3b9(0x2b6)]((_0x31e371,_0x206b44)=>{var _0x55d045=_0x3de3b9;_0x444c58[_0x206b44][_0x55d045(0x29d)]=_0x31e371;}),_0x21684e[_0x3de3b9(0x2b6)]((_0x8d3c18,_0x2a4fb1)=>{var _0x25dc30=_0x3de3b9;_0x444c58[_0x2a4fb1][_0x25dc30(0x1e5)]=_0x8d3c18;}),_0x2827ee[_0x3de3b9(0x2b6)]((_0x55897b,_0x3a9fd7)=>{var _0x5e9857=_0x3de3b9;_0x444c58[_0x3a9fd7][_0x5e9857(0x218)]=_0x55897b;}),_0x5cb765[_0x3de3b9(0x2b6)]((_0x44741f,_0x57a514)=>{_0x444c58[_0x57a514]['expiry_date']=_0x44741f;}),_0x115056[_0x3de3b9(0x2b6)]((_0x43a16e,_0x1f9634)=>{var _0xa7931=_0x3de3b9;_0x444c58[_0x1f9634][_0xa7931(0x24e)]=_0x43a16e;}),_0x4c45c4[_0x3de3b9(0x2b6)]((_0x1a971e,_0xe2030b)=>{var _0x15f976=_0x3de3b9;_0x444c58[_0xe2030b][_0x15f976(0x205)]=_0x1a971e;}),_0x3f89a3[_0x3de3b9(0x2b6)]((_0x537e83,_0x269811)=>{var _0x9ea079=_0x3de3b9;_0x444c58[_0x269811][_0x9ea079(0x286)]=_0x537e83;}),_0x8c1c0b[_0x3de3b9(0x2b6)]((_0x3ca17e,_0x12dca3)=>{var _0x2f6c52=_0x3de3b9;_0x444c58[_0x12dca3][_0x2f6c52(0x1f1)]=_0x3ca17e;}),_0x4bbcf4['forEach']((_0x248952,_0x12f22c)=>{var _0x26c4d5=_0x3de3b9;_0x444c58[_0x12f22c][_0x26c4d5(0x23b)]=_0x248952;}),_0x1347b9[_0x3de3b9(0x2b6)]((_0x2b1c44,_0x1b1c7e)=>{_0x444c58[_0x1b1c7e]['to_room_name']=_0x2b1c44;});const _0x2e1700=_0x444c58[_0x3de3b9(0x1e8)](_0x730e77=>_0x730e77['to_quantity']!=='0'&&_0x730e77['to_quantity']!==''||_0x730e77[_0x3de3b9(0x24f)]!=='0'&&_0x730e77[_0x3de3b9(0x24f)]!=='');var _0x1d2046=0x0;_0x2e1700[_0x3de3b9(0x2b6)](_0x553f4b=>{var _0xaf2f32=_0x3de3b9;parseInt(_0x553f4b[_0xaf2f32(0x1f0)])<parseInt(_0x553f4b['to_quantity'])&&_0x1d2046++;});if(_0x1d2046!=0x0)return _0x4985d0[_0x3de3b9(0x25a)]('errors',_0x3de3b9(0x294)),_0x26be78[_0x3de3b9(0x25d)](_0x3de3b9(0x1fa));const _0x20de43=new transfers_finished({'date':_0x14ab4d,'from_warehouse':_0x19dcfa,'to_warehouse':_0x24525b,'product':_0x2e1700,'note':_0x4bd2ac,'invoice':_0x3ed8ef}),_0x21377a=await _0x20de43[_0x3de3b9(0x29e)]();_0x4985d0[_0x3de3b9(0x25a)](_0x3de3b9(0x21a),_0x3de3b9(0x1f2)),_0x26be78['redirect'](_0x3de3b9(0x269)+_0x21377a['_id']);}catch(_0x49c7ea){console[_0x3de3b9(0x282)](_0x49c7ea),_0x26be78[_0x3de3b9(0x289)](0xc8)['json']({'errorMessage':_0x49c7ea[_0x3de3b9(0x238)]});}}),router[a0_0x8ce878(0x247)](a0_0x8ce878(0x1ef),auth,async(_0x232545,_0x403494)=>{var _0x51ab65=a0_0x8ce878;try{const {username:_0x245ce0,email:_0xcc3074,role:_0x4ab157}=_0x232545[_0x51ab65(0x2b3)],_0x2fd34b=_0x232545[_0x51ab65(0x2b3)],_0x251e49=await profile[_0x51ab65(0x1fd)]({'email':_0x2fd34b[_0x51ab65(0x2ad)]}),_0x18e933=await master_shop[_0x51ab65(0x1f4)](),_0x6862b6=await transfers_finished[_0x51ab65(0x1fc)](_0x232545[_0x51ab65(0x239)]['id']);let _0x4ffec5;if(_0x2fd34b[_0x51ab65(0x211)]==_0x51ab65(0x26a)){const _0x23eee4=await staff['findOne']({'email':_0x2fd34b[_0x51ab65(0x2ad)]});_0x4ffec5=await warehouse[_0x51ab65(0x1f4)]({'status':'Enabled','name':_0x23eee4[_0x51ab65(0x2a6)],'warehouse_category':_0x51ab65(0x287)});}else _0x4ffec5=await warehouse[_0x51ab65(0x1f4)]({'status':_0x51ab65(0x22d),'warehouse_category':_0x51ab65(0x287)});const _0x5813bb=await warehouse[_0x51ab65(0x215)]([{'$match':{'name':_0x6862b6[_0x51ab65(0x29a)],'warehouse_category':_0x51ab65(0x287)}},{'$unwind':_0x51ab65(0x23d)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x51ab65(0x251)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x51ab65(0x22c)},'bin':{'$first':_0x51ab65(0x252)},'type':{'$first':_0x51ab65(0x2a0)},'floorlevel':{'$first':_0x51ab65(0x267)},'primary_code':{'$first':_0x51ab65(0x265)},'secondary_code':{'$first':_0x51ab65(0x234)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x51ab65(0x28d)},'rack':{'$first':_0x51ab65(0x260)},'expiry_date':{'$first':_0x51ab65(0x281)},'production_date':{'$first':_0x51ab65(0x28e)},'room':{'$first':_0x51ab65(0x270)},'warehoue_name':{'$first':_0x51ab65(0x250)}}}]),_0x161654=await product[_0x51ab65(0x1f4)]({});if(_0x18e933[0x0][_0x51ab65(0x25e)]==_0x51ab65(0x2aa)){var _0x4c608f=users[_0x51ab65(0x2b4)];console[_0x51ab65(0x282)](_0x4c608f);}else{if(_0x18e933[0x0][_0x51ab65(0x25e)]=='Hindi')var _0x4c608f=users[_0x51ab65(0x1e3)];else{if(_0x18e933[0x0][_0x51ab65(0x25e)]==_0x51ab65(0x229))var _0x4c608f=users[_0x51ab65(0x229)];else{if(_0x18e933[0x0]['language']==_0x51ab65(0x2a9))var _0x4c608f=users[_0x51ab65(0x2a9)];else{if(_0x18e933[0x0][_0x51ab65(0x25e)]==_0x51ab65(0x213))var _0x4c608f=users[_0x51ab65(0x213)];else{if(_0x18e933[0x0][_0x51ab65(0x25e)]==_0x51ab65(0x278))var _0x4c608f=users[_0x51ab65(0x271)];else{if(_0x18e933[0x0][_0x51ab65(0x25e)]==_0x51ab65(0x25f))var _0x4c608f=users[_0x51ab65(0x25f)];else{if(_0x18e933[0x0][_0x51ab65(0x25e)]==_0x51ab65(0x244))var _0x4c608f=users['Arabic'];}}}}}}}_0x403494['render'](_0x51ab65(0x2b5),{'success':_0x232545[_0x51ab65(0x25a)](_0x51ab65(0x21a)),'errors':_0x232545['flash'](_0x51ab65(0x274)),'role':_0x2fd34b,'profile':_0x251e49,'master_shop':_0x18e933,'warehouse':_0x4ffec5,'transfer':_0x6862b6,'stock':_0x5813bb,'unit':_0x161654,'language':_0x4c608f});}catch(_0x5c58d2){console[_0x51ab65(0x282)](_0x5c58d2);}}),router[a0_0x8ce878(0x2b7)]('/preview/:id',auth,async(_0x457f3e,_0x5a4152)=>{var _0x2e26c2=a0_0x8ce878;try{const {invoice:_0x5c0e23,from_warehouse:_0x537636,FromRoom_name:_0x59b500,to_warehouse:_0x39cb91,ToRoom_name:_0x591070}=_0x457f3e['body'],_0x215c50=await transfers_finished[_0x2e26c2(0x1fc)](_0x457f3e['params']['id']),_0x2f1af4=_0x215c50['product'][_0x2e26c2(0x293)](async _0x4b9129=>{var _0x7e2c6f=_0x2e26c2;if(_0x4b9129['to_quantity']>0x0){var _0x52d37b=await warehouse[_0x7e2c6f(0x1fd)]({'name':_0x537636,'room':_0x4b9129[_0x7e2c6f(0x23b)],'warehouse_category':_0x7e2c6f(0x287)});const _0x16ce95=_0x52d37b[_0x7e2c6f(0x263)][_0x7e2c6f(0x293)](_0x5763c8=>{var _0x1132ee=_0x7e2c6f;_0x5763c8[_0x1132ee(0x256)]==_0x4b9129[_0x1132ee(0x256)]&&_0x5763c8[_0x1132ee(0x2a1)]==_0x4b9129[_0x1132ee(0x236)]&&_0x5763c8['expiry_date']==_0x4b9129[_0x1132ee(0x2b0)]&&_0x5763c8[_0x1132ee(0x24e)]==_0x4b9129['production_date']&&_0x5763c8[_0x1132ee(0x218)]==_0x4b9129[_0x1132ee(0x218)]&&_0x5763c8[_0x1132ee(0x1f6)]==_0x4b9129[_0x1132ee(0x227)]&&(_0x5763c8['product_stock']=_0x5763c8[_0x1132ee(0x21b)]-_0x4b9129[_0x1132ee(0x29b)]);});}return _0x52d37b;});Promise['all'](_0x2f1af4)[_0x2e26c2(0x1e2)](async _0x20baea=>{var _0x4eeccd=_0x2e26c2;try{for(const _0x4d95a2 of _0x20baea){await _0x4d95a2[_0x4eeccd(0x29e)]();}const _0x177190=_0x215c50[_0x4eeccd(0x290)][_0x4eeccd(0x293)](async _0x596f6e=>{var _0x2c8e0e=_0x4eeccd,_0x57270c=await warehouse['findOne']({'name':_0x39cb91,'room':_0x596f6e[_0x2c8e0e(0x23a)]});if(_0x596f6e[_0x2c8e0e(0x29b)]>0x0){var _0x5b0f7f=0x0;const _0x534b8c=_0x57270c[_0x2c8e0e(0x263)][_0x2c8e0e(0x293)](_0x59e887=>{var _0x5501cb=_0x2c8e0e;_0x59e887['product_name']==_0x596f6e['product_name']&&_0x59e887[_0x5501cb(0x2a1)]==_0x596f6e[_0x5501cb(0x21e)]&&_0x59e887[_0x5501cb(0x2b0)]==_0x596f6e[_0x5501cb(0x2b0)]&&_0x59e887[_0x5501cb(0x24e)]==_0x596f6e[_0x5501cb(0x24e)]&&_0x59e887['batch_code']==_0x596f6e[_0x5501cb(0x218)]&&_0x59e887[_0x5501cb(0x1f6)]==_0x596f6e[_0x5501cb(0x20e)]&&(_0x59e887['product_stock']=_0x59e887[_0x5501cb(0x21b)]+_0x596f6e[_0x5501cb(0x29b)],_0x5b0f7f++);});_0x5b0f7f=='0'&&(_0x57270c['product_details']=_0x57270c[_0x2c8e0e(0x263)][_0x2c8e0e(0x2af)]({'product_name':_0x596f6e[_0x2c8e0e(0x256)],'product_stock':_0x596f6e['to_quantity'],'bay':_0x596f6e['to_bay'],'product_code':_0x596f6e[_0x2c8e0e(0x273)],'primary_code':_0x596f6e[_0x2c8e0e(0x21d)],'secondary_code':_0x596f6e[_0x2c8e0e(0x209)],'expiry_date':_0x596f6e[_0x2c8e0e(0x2b0)],'production_date':_0x596f6e[_0x2c8e0e(0x24e)],'maxProducts':_0x596f6e['maxProducts'],'batch_code':_0x596f6e[_0x2c8e0e(0x218)],'secondary_unit':_0x596f6e[_0x2c8e0e(0x1e5)],'unit':_0x596f6e[_0x2c8e0e(0x29d)],'maxProducts':_0x596f6e[_0x2c8e0e(0x205)],'maxPerUnit':_0x596f6e['maxPerUnit'],'invoice':_0x596f6e[_0x2c8e0e(0x20e)]}));}return _0x57270c;});Promise['all'](_0x177190)[_0x4eeccd(0x1e2)](async _0x49bc74=>{var _0x43fc39=_0x4eeccd;try{for(const _0x319fbb of _0x49bc74){await warehouse[_0x43fc39(0x243)]({'_id':_0x319fbb[_0x43fc39(0x26b)]},{'$addToSet':{'product_details':{'$each':_0x319fbb[_0x43fc39(0x263)]}}});}_0x215c50['finalize']='True';const _0x1459f9=await _0x215c50[_0x43fc39(0x29e)](),_0x10eab0=await master_shop[_0x43fc39(0x1f4)](),_0x27fb1e=await email_settings[_0x43fc39(0x1fd)](),_0x57a1ab=await supervisor_settings[_0x43fc39(0x1f4)]();var _0x4764c9=_0x215c50[_0x43fc39(0x290)],_0x1faa26='',_0x269316;for(_0x269316 in _0x4764c9){var _0x25ba16='FG';_0x215c50[_0x43fc39(0x24d)]==_0x43fc39(0x264)&&(_0x25ba16='DG'),_0x1faa26+='<tr>'+_0x43fc39(0x20d)+_0x4764c9[_0x269316][_0x43fc39(0x256)]+_0x43fc39(0x27d)+_0x43fc39(0x20d)+_0x4764c9[_0x269316][_0x43fc39(0x273)]+'</td>'+_0x43fc39(0x20d)+_0x4764c9[_0x269316][_0x43fc39(0x29b)]+_0x43fc39(0x27d)+_0x43fc39(0x20d)+_0x4764c9[_0x269316]['unit']+'</td>'+_0x43fc39(0x20d)+_0x4764c9[_0x269316][_0x43fc39(0x1e5)]+_0x43fc39(0x27d)+_0x43fc39(0x20d)+_0x215c50[_0x43fc39(0x24d)]+_0x43fc39(0x27d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4764c9[_0x269316][_0x43fc39(0x23a)]+'</td>'+_0x43fc39(0x20d)+_0x25ba16+_0x4764c9[_0x269316][_0x43fc39(0x21e)]+_0x43fc39(0x27d)+_0x43fc39(0x298);}let _0x3d54da=nodemailer['createTransport']({'host':_0x27fb1e['host'],'port':Number(_0x27fb1e[_0x43fc39(0x28c)]),'secure':![],'auth':{'user':_0x27fb1e['email'],'pass':_0x27fb1e[_0x43fc39(0x1e6)]}}),_0x2952b5={'from':_0x27fb1e['email'],'to':_0x57a1ab[0x0][_0x43fc39(0x20a)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x43fc39(0x276),'path':__dirname+_0x43fc39(0x219)+_0x43fc39(0x20c)+_0x10eab0[0x0]['image'],'cid':'logo'}],'html':_0x43fc39(0x285)+_0x43fc39(0x279)+_0x43fc39(0x22a)+_0x43fc39(0x225)+_0x43fc39(0x1e4)+_0x43fc39(0x225)+_0x43fc39(0x262)+_0x43fc39(0x20f)+_0x43fc39(0x225)+'<h2>\x20'+_0x10eab0[0x0][_0x43fc39(0x2b1)]+_0x43fc39(0x297)+'</div>'+_0x43fc39(0x20f)+_0x43fc39(0x259)+_0x43fc39(0x225)+_0x43fc39(0x23f)+_0x43fc39(0x2b2)+_0x215c50[_0x43fc39(0x1f6)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x215c50[_0x43fc39(0x231)]+'\x20'+_0x43fc39(0x202)+'</h5>'+_0x43fc39(0x20f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x43fc39(0x223)+_0x43fc39(0x257)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x43fc39(0x266)+_0x43fc39(0x200)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x43fc39(0x1f5)+_0x43fc39(0x24a)+_0x43fc39(0x1ea)+_0x43fc39(0x261)+_0x43fc39(0x298)+_0x43fc39(0x2a4)+_0x43fc39(0x26e)+'\x20'+_0x1faa26+'\x20'+_0x43fc39(0x27a)+_0x43fc39(0x26f)+_0x43fc39(0x225)+_0x43fc39(0x26d)+_0x43fc39(0x24c)+_0x10eab0[0x0][_0x43fc39(0x2b1)]+'</h5>'+'</div>'+_0x43fc39(0x20f)+'</body></html>'};_0x3d54da[_0x43fc39(0x201)](_0x2952b5,function(_0x124c66,_0x282aa8){var _0x3ef36f=_0x43fc39;_0x124c66?(console['log'](_0x124c66),console[_0x3ef36f(0x282)](_0x3ef36f(0x248))):console[_0x3ef36f(0x282)]('Email\x20sent\x20successfully');}),_0x457f3e['flash'](_0x43fc39(0x21a),'Transfer\x20Finalize\x20Successfully'),_0x5a4152['redirect'](_0x43fc39(0x237)+_0x1459f9[_0x43fc39(0x26b)]);}catch(_0x2b6cf8){console['error'](_0x2b6cf8),_0x5a4152[_0x43fc39(0x289)](0x1f4)[_0x43fc39(0x222)]({'error':_0x43fc39(0x1e1)});}})[_0x4eeccd(0x23e)](_0x65d240=>{var _0x388344=_0x4eeccd;console['error'](_0x65d240),_0x5a4152[_0x388344(0x289)](0x1f4)[_0x388344(0x222)]({'error':_0x388344(0x2a5)});});}catch(_0x5bf4e){console[_0x4eeccd(0x20b)](_0x5bf4e),_0x5a4152[_0x4eeccd(0x289)](0x1f4)[_0x4eeccd(0x222)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x2e26c2(0x23e)](_0x11a3c6=>{var _0x3bed45=_0x2e26c2;console[_0x3bed45(0x20b)](_0x11a3c6),_0x5a4152[_0x3bed45(0x289)](0x1f4)[_0x3bed45(0x222)]({'error':_0x3bed45(0x2a5)});});}catch(_0x1f3ab4){_0x5a4152[_0x2e26c2(0x222)]({'message':_0x1f3ab4[_0x2e26c2(0x238)]});}});function a0_0x5313(){var _0x77690f=['error','/upload/','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','To_invoice','</div>','edit_transfer_finished','role','There\x27s\x20a\x20error\x20in\x20this\x20transaction','French','transfer_finished','aggregate','/barcode_scanner3','Arabic','batch_code','/../public','success','product_stock','to_invoice','primary_code','to_bay','16900011snYuBt','$product_details.maxProducts','floor','json','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssigned','<div>','/view/:id','from_invoice','add_transfer_finished','German','</head><body>','string','$product_details.bay','Enabled','Enclosed','14412fKZbep','/barcode_scanner','date','ToRoomAssigned','QA\x20Warehouse','$product_details.secondary_code','3fnHzUY','from_bay','/picking_list/PDF_transfer/','message','params','to_room_name','from_room_name','to_room','$product_details','catch','<h5\x20style=\x22text-align:\x20left;\x22>','nodemailer','2673964hmpgbC','$product_details.pallet','updateOne','Arabic\x20(ae)','toString','751514BREKNO','get','Error\x20Occurs','$from_warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details._id','<h5>','to_warehouse','production_date','to_floorlevel','$name','$product_details.product_name','$product_details.bin','from_prod_level','$finalize','../middleware/auth','product_name','<tr>','$product_details.batch_code','<hr\x20class=\x22my-3\x22>','flash','body','/CheckingWarehouse','redirect','language','Chinese','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_details','DRY\x20GOODS','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.floorlevel','$product_details.unit','/transfer_finished/preview/','staff','_id','split','<strong>\x20Regards\x20</strong>','<tbody\x20style=\x22text-align:\x20center;\x22>','</table>','$room','Portuguese','$product_details.product_stock','product_code','errors','note','Logo.png','product_date','Portuguese\x20(BR)','<html><head><title></title>','</tbody>','$product','$product_details.product_code','</td>','/view','3585405qzzrif','$product.from_room_name','$product_details.expiry_date','log','$product_details.level','from_room','<!DOCTYPE\x20html>','maxPerUnit','Finished\x20Goods','../public/language/languages.json','status','$product.to_room_name','prod_name','port','$product_details.storage','$product_details.production_date','2261WcNMIw','product','New_Qty_Converted','$product_details.isle','map','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','/transfer/view','$date','\x20</h2>','</tr>','random','from_warehouse','to_quantity','$product_details.invoice','unit','save','express','$product_details.type','bay','push','length','</thead>','An\x20error\x20occurred.','warehouse','MaxStocks_data','Rack\x201','Spanish','English\x20(US)','exports','slice','email','FROZEN\x20GOODS','concat','expiry_date','site_title','\x20Order\x20Number\x20:\x20','user','English','edit_transfer_finished_view','forEach','post','$to_warehouse','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','then','Hindi','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','secondary_unit','password','/view/add_transfer','filter','TRFF-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.secondary_unit','Rack\x202','to_prod_level','getFullYear','/preview/:id','from_quantity','prod_cat','Product\x20Transfer\x20successfully','Router','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','invoice','Ambient','primary_unit','getMonth','back','778029HMjzsY','findById','findOne','render','2499424WPgXJJ','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','sendMail','</span>','product_code3','Transfer\x20Edit\x20Successfully','maxProducts','MaxStocks_data2','from_prod_qty','$product_details.maxPerUnit','secondary_code','FGSEmail'];a0_0x5313=function(){return _0x77690f;};return a0_0x5313();}function BayBinSelected(_0x5a64eb,_0x19677b){var _0x5e227d=a0_0x8ce878,_0x1a24ba=[];let _0xc18d3e=[];var _0x3b804d=[];if(_0x5a64eb==_0x5e227d(0x264)){switch(_0x19677b){case _0x5e227d(0x2a8):_0x1a24ba=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x5e227d(0x1ec):_0x1a24ba=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x3b804d=['DG'];}else{if(_0x5a64eb==_0x5e227d(0x2ae)){switch(_0x19677b){case'Rack\x201':_0x1a24ba=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x5e227d(0x1ec):_0x1a24ba=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x3b804d=['FG'];}}return{'levels':_0x1a24ba,'identify':_0x3b804d};}router[a0_0x8ce878(0x247)]('/view/:id',auth,async(_0xecf0bd,_0x307cba)=>{var _0x47f6ca=a0_0x8ce878;try{const {username:_0x5793ce,email:_0x1908e5,role:_0x1c9512}=_0xecf0bd[_0x47f6ca(0x2b3)],_0x2ff23e=_0xecf0bd[_0x47f6ca(0x2b3)],_0x8c7dff=await profile[_0x47f6ca(0x1fd)]({'email':_0x2ff23e['email']}),_0x579687=await master_shop[_0x47f6ca(0x1f4)](),_0x3f1ce0=await transfers_finished['findById'](_0xecf0bd[_0x47f6ca(0x239)]['id']);let _0x33cf18=new Date(_0x3f1ce0[_0x47f6ca(0x2b0)]),_0x388cc2=('0'+_0x33cf18['getDate']())[_0x47f6ca(0x2ac)](-0x2),_0x17b2b1=('0'+(_0x33cf18[_0x47f6ca(0x1f9)]()+0x1))[_0x47f6ca(0x2ac)](-0x2),_0x723126=_0x33cf18[_0x47f6ca(0x1ee)](),_0x472a05=_0x723126+'-'+_0x17b2b1+'-'+_0x388cc2,_0x5218bf;if(_0x2ff23e['role']==_0x47f6ca(0x26a)){const _0x252303=await staff[_0x47f6ca(0x1fd)]({'email':_0x2ff23e[_0x47f6ca(0x2ad)]});_0x5218bf=await warehouse[_0x47f6ca(0x1f4)]({'status':_0x47f6ca(0x22d),'name':_0x252303[_0x47f6ca(0x2a6)],'warehouse_category':'Finished\x20Goods'});}else _0x5218bf=await warehouse[_0x47f6ca(0x1f4)]({'status':'Enabled','warehouse_category':'Finished\x20Goods'});const _0x210388=await warehouse['aggregate']([{'$match':{'name':_0x3f1ce0['from_warehouse'],'room':_0x3f1ce0['from_room']}},{'$unwind':_0x47f6ca(0x23d)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x47f6ca(0x272)},'bay':{'$first':_0x47f6ca(0x22c)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x47f6ca(0x267)},'primary_code':{'$first':_0x47f6ca(0x265)},'secondary_code':{'$first':_0x47f6ca(0x234)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x47f6ca(0x260)}}}]);var _0x58357e=[0x1,0x2,0x3,0x4],_0x406c4c=['A','B','C','D','E','F','G','H','I','J'],_0x16cd18=[_0x47f6ca(0x1f7),_0x47f6ca(0x22e)];const _0x34edaa=await product['find']({}),_0x412ff6=BayBinSelected(_0x3f1ce0[_0x47f6ca(0x24d)],_0x3f1ce0[_0x47f6ca(0x23c)]);if(_0x579687[0x0][_0x47f6ca(0x25e)]==_0x47f6ca(0x2aa)){var _0x2c4261=users[_0x47f6ca(0x2b4)];console[_0x47f6ca(0x282)](_0x2c4261);}else{if(_0x579687[0x0][_0x47f6ca(0x25e)]==_0x47f6ca(0x1e3))var _0x2c4261=users[_0x47f6ca(0x1e3)];else{if(_0x579687[0x0][_0x47f6ca(0x25e)]==_0x47f6ca(0x229))var _0x2c4261=users[_0x47f6ca(0x229)];else{if(_0x579687[0x0][_0x47f6ca(0x25e)]=='Spanish')var _0x2c4261=users[_0x47f6ca(0x2a9)];else{if(_0x579687[0x0]['language']==_0x47f6ca(0x213))var _0x2c4261=users[_0x47f6ca(0x213)];else{if(_0x579687[0x0]['language']==_0x47f6ca(0x278))var _0x2c4261=users[_0x47f6ca(0x271)];else{if(_0x579687[0x0][_0x47f6ca(0x25e)]==_0x47f6ca(0x25f))var _0x2c4261=users[_0x47f6ca(0x25f)];else{if(_0x579687[0x0][_0x47f6ca(0x25e)]=='Arabic\x20(ae)')var _0x2c4261=users['Arabic'];}}}}}}}_0x307cba['render'](_0x47f6ca(0x210),{'success':_0xecf0bd['flash']('success'),'errors':_0xecf0bd['flash'](_0x47f6ca(0x274)),'role':_0x2ff23e,'profile':_0x8c7dff,'master_shop':_0x579687,'warehouse':_0x5218bf,'transfer':_0x3f1ce0,'stock':_0x210388,'unit':_0x34edaa,'language':_0x2c4261,'levels':_0x58357e,'Isle':_0x406c4c,'rooms_data':_0x16cd18,'ed_fullDate':_0x472a05,'dataSelected':_0x412ff6});}catch(_0x2a285e){console['log'](_0x2a285e);}}),router[a0_0x8ce878(0x2b7)](a0_0x8ce878(0x226),auth,async(_0x395bba,_0x284696)=>{var _0x13a287=a0_0x8ce878;try{const _0x55d8fc=_0x395bba['params']['id'];console[_0x13a287(0x282)](_0x395bba[_0x13a287(0x25b)]);const _0x4e2401=await transfers_finished['findById'](_0x55d8fc);console[_0x13a287(0x282)]('transfer_data',_0x4e2401);const {date:_0x52620f,from_warehouse:_0x264b9e,FromRoom_name:_0x19e265,to_warehouse:_0x226db1,ToRoom_name:_0x56aaf6,prod_name:_0x270f0f,from_prod_qty:_0x21da32,from_prod_level:_0xf936fb,from_prod_isle:_0xe631fd,from_prod_pallet:_0x5b43ff,to_prod_qty:_0x1d27ec,to_prod_level:_0x40b3c1,to_prod_isle:_0x2939d4,to_prod_pallet:_0x483760,primary_code:_0x4cd57a,secondary_code:_0x4f2106,product_code3:_0x46d260,note:_0x5c3010,invoice:_0x35e857,expiry_date:_0x472535}=_0x395bba[_0x13a287(0x25b)];if(typeof _0x270f0f=='string')var _0x1ee875=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x28b)]],_0x2e62bb=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x207)]],_0x41a12a=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x253)]],_0x29b854=[_0x395bba[_0x13a287(0x25b)]['to_prod_qty']],_0x1d3acc=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x1ed)]],_0x3a7e90=[_0x395bba[_0x13a287(0x25b)]['primary_code']],_0x1ea05b=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x209)]],_0x3d3656=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x203)]],_0x510139=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x206)]],_0x17f8b1=[_0x395bba[_0x13a287(0x25b)]['unit']],_0x21cf0a=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x1e5)]],_0x48b2f8=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x218)]],_0x231b4b=[_0x395bba[_0x13a287(0x25b)][_0x13a287(0x2b0)]];else var _0x1ee875=[..._0x395bba['body']['prod_name']],_0x2e62bb=[..._0x395bba[_0x13a287(0x25b)]['from_prod_qty']],_0x41a12a=[..._0x395bba[_0x13a287(0x25b)][_0x13a287(0x253)]],_0x29b854=[..._0x395bba[_0x13a287(0x25b)]['to_prod_qty']],_0x1d3acc=[..._0x395bba[_0x13a287(0x25b)][_0x13a287(0x1ed)]],_0x3a7e90=[..._0x395bba[_0x13a287(0x25b)][_0x13a287(0x21d)]],_0x1ea05b=[..._0x395bba[_0x13a287(0x25b)]['secondary_code']],_0x3d3656=[..._0x395bba[_0x13a287(0x25b)]['product_code3']],_0x510139=[..._0x395bba[_0x13a287(0x25b)][_0x13a287(0x206)]],_0x17f8b1=[..._0x395bba[_0x13a287(0x25b)]['unit']],_0x21cf0a=[..._0x395bba[_0x13a287(0x25b)][_0x13a287(0x1e5)]],_0x48b2f8=[..._0x395bba[_0x13a287(0x25b)][_0x13a287(0x218)]],_0x231b4b=[..._0x395bba[_0x13a287(0x25b)]['expiry_date']];const _0x2cf079=_0x1ee875['map'](_0x4e61b2=>{return _0x4e61b2={'product_name':_0x4e61b2};});_0x2e62bb[_0x13a287(0x2b6)]((_0x13c3df,_0x423415)=>{var _0x4259c2=_0x13a287;_0x2cf079[_0x423415][_0x4259c2(0x1f0)]=_0x13c3df;}),_0x41a12a[_0x13a287(0x2b6)]((_0x5c86dd,_0x5ed58b)=>{var _0x11b319=_0x13a287;_0x2cf079[_0x5ed58b][_0x11b319(0x236)]=_0x5c86dd;}),_0x29b854[_0x13a287(0x2b6)]((_0x2503c4,_0x492478)=>{var _0x1e6d1c=_0x13a287;_0x2cf079[_0x492478][_0x1e6d1c(0x29b)]=_0x2503c4;}),_0x1d3acc[_0x13a287(0x2b6)]((_0x511d84,_0x128278)=>{var _0x1cbd90=_0x13a287;_0x2cf079[_0x128278][_0x1cbd90(0x21e)]=_0x511d84;}),_0x3a7e90[_0x13a287(0x2b6)]((_0x371377,_0x8e897)=>{var _0x2a21fd=_0x13a287;_0x2cf079[_0x8e897][_0x2a21fd(0x21d)]=_0x371377;}),_0x1ea05b[_0x13a287(0x2b6)]((_0x181324,_0x446f8d)=>{_0x2cf079[_0x446f8d]['secondary_code']=_0x181324;}),_0x3d3656[_0x13a287(0x2b6)]((_0x371947,_0x497248)=>{var _0x464de5=_0x13a287;_0x2cf079[_0x497248][_0x464de5(0x273)]=_0x371947;}),_0x510139[_0x13a287(0x2b6)]((_0x51ff97,_0xc92705)=>{var _0x2f9058=_0x13a287;_0x2cf079[_0xc92705][_0x2f9058(0x205)]=_0x51ff97;}),_0x17f8b1['forEach']((_0x430794,_0xb84009)=>{var _0x233c3e=_0x13a287;_0x2cf079[_0xb84009][_0x233c3e(0x29d)]=_0x430794;}),_0x21cf0a[_0x13a287(0x2b6)]((_0x39a731,_0x914d05)=>{var _0x3adbaa=_0x13a287;_0x2cf079[_0x914d05][_0x3adbaa(0x1e5)]=_0x39a731;}),_0x48b2f8[_0x13a287(0x2b6)]((_0x2be823,_0x3bd1ba)=>{var _0x27c4bb=_0x13a287;_0x2cf079[_0x3bd1ba][_0x27c4bb(0x218)]=_0x2be823;}),_0x231b4b[_0x13a287(0x2b6)]((_0x169b01,_0x21b8ae)=>{_0x2cf079[_0x21b8ae]['expiry_date']=_0x169b01;});const _0x221962=_0x2cf079[_0x13a287(0x1e8)](_0x189e61=>_0x189e61[_0x13a287(0x29b)]!=='0'&&_0x189e61['to_quantity']!==''||_0x189e61[_0x13a287(0x24f)]!=='0'&&_0x189e61[_0x13a287(0x24f)]!=='');var _0x5e0591=0x0;_0x221962['forEach'](_0x33fd9a=>{var _0x373582=_0x13a287;parseInt(_0x33fd9a[_0x373582(0x1f0)])<parseInt(_0x33fd9a[_0x373582(0x29b)])&&_0x5e0591++;});if(_0x5e0591!=0x0)return _0x395bba['flash'](_0x13a287(0x274),_0x13a287(0x294)),_0x284696[_0x13a287(0x25d)](_0x13a287(0x1fa));const _0x5570f8=await warehouse[_0x13a287(0x1fd)]({'name':_0x4e2401[_0x13a287(0x29a)],'room':_0x4e2401[_0x13a287(0x284)]});_0x4e2401[_0x13a287(0x290)][_0x13a287(0x2b6)](_0x56c441=>{var _0x142f79=_0x13a287;if(_0x56c441[_0x142f79(0x29b)]>0x0){const _0x41106b=_0x5570f8[_0x142f79(0x263)][_0x142f79(0x293)](_0x37399c=>{var _0x35366b=_0x142f79;_0x37399c[_0x35366b(0x256)]==_0x56c441[_0x35366b(0x256)]&&_0x37399c['bay']==_0x56c441[_0x35366b(0x236)]&&(_0x37399c[_0x35366b(0x21b)]=parseInt(_0x37399c[_0x35366b(0x21b)])+parseInt(_0x56c441[_0x35366b(0x29b)]));});}}),await _0x5570f8[_0x13a287(0x29e)]();const _0x4af597=await warehouse[_0x13a287(0x1fd)]({'name':_0x4e2401[_0x13a287(0x24d)],'room':_0x4e2401[_0x13a287(0x23c)]});_0x4e2401[_0x13a287(0x290)][_0x13a287(0x2b6)](_0x286eb1=>{var _0x47e97d=_0x13a287;if(_0x286eb1[_0x47e97d(0x29b)]>0x0){const _0x410efc=_0x4af597[_0x47e97d(0x263)][_0x47e97d(0x293)](_0x380ff6=>{var _0x18b150=_0x47e97d;_0x380ff6[_0x18b150(0x256)]==_0x286eb1[_0x18b150(0x256)]&&_0x380ff6[_0x18b150(0x2a1)]==_0x286eb1[_0x18b150(0x21e)]&&(_0x380ff6['product_stock']=parseInt(_0x380ff6[_0x18b150(0x21b)])-parseInt(_0x286eb1['to_quantity']));});}}),await _0x4af597['save'](),_0x4e2401['date']=_0x52620f,_0x4e2401[_0x13a287(0x29a)]=_0x264b9e,_0x4e2401['to_warehouse']=_0x226db1,_0x4e2401['product']=_0x221962,_0x4e2401[_0x13a287(0x275)]=_0x5c3010,_0x4e2401[_0x13a287(0x1f6)]=_0x35e857;const _0xd0f743=await _0x4e2401['save'](),_0x4014f4=await warehouse['findOne']({'name':_0x264b9e,'room':_0x19e265});_0xd0f743[_0x13a287(0x290)][_0x13a287(0x2b6)](_0x3fff3a=>{var _0x3c9a28=_0x13a287;if(_0x3fff3a[_0x3c9a28(0x29b)]>0x0){const _0x6c6bcc=_0x4014f4['product_details']['map'](_0x505b81=>{var _0x431e99=_0x3c9a28;_0x505b81[_0x431e99(0x256)]==_0x3fff3a[_0x431e99(0x256)]&&_0x505b81[_0x431e99(0x2a1)]==_0x3fff3a[_0x431e99(0x236)]&&(_0x505b81[_0x431e99(0x21b)]=parseInt(_0x505b81[_0x431e99(0x21b)])-parseInt(_0x3fff3a[_0x431e99(0x29b)]));});}}),await _0x4014f4[_0x13a287(0x29e)]();const _0x3bfc31=await warehouse[_0x13a287(0x1fd)]({'name':_0x226db1,'room':_0x56aaf6});_0xd0f743['product']['forEach'](_0x107ecf=>{var _0x5acf2d=_0x13a287;if(_0x107ecf[_0x5acf2d(0x29b)]>0x0){var _0x2675bd=0x0;const _0x11aee5=_0x3bfc31[_0x5acf2d(0x263)][_0x5acf2d(0x293)](_0x3c7279=>{var _0x2f93e4=_0x5acf2d;_0x3c7279[_0x2f93e4(0x256)]==_0x107ecf[_0x2f93e4(0x256)]&&_0x3c7279['bay']==_0x107ecf[_0x2f93e4(0x21e)]&&(_0x3c7279['product_stock']=parseInt(_0x3c7279['product_stock'])+parseInt(_0x107ecf[_0x2f93e4(0x29b)]),_0x2675bd++);});_0x2675bd=='0'&&(_0x3bfc31[_0x5acf2d(0x263)]=_0x3bfc31[_0x5acf2d(0x263)][_0x5acf2d(0x2af)]({'product_name':_0x107ecf[_0x5acf2d(0x256)],'product_stock':_0x107ecf['to_quantity'],'bay':_0x107ecf[_0x5acf2d(0x21e)],'product_code':_0x107ecf['product_code'],'primary_code':_0x107ecf[_0x5acf2d(0x21d)],'secondary_code':_0x107ecf['secondary_code'],'maxProducts':_0x107ecf[_0x5acf2d(0x205)]}));}}),await _0x3bfc31[_0x13a287(0x29e)](),_0x395bba[_0x13a287(0x25a)](_0x13a287(0x21a),_0x13a287(0x204)),_0x284696[_0x13a287(0x25d)]('/transfer_finished/view');}catch(_0x5cfcd7){console['log'](_0x5cfcd7);}}),router[a0_0x8ce878(0x2b7)](a0_0x8ce878(0x230),async(_0x287da6,_0x15ee9d)=>{var _0x2d83c2=a0_0x8ce878;const {FromWareHouse:_0x443951,FromRoom:_0x4ab9ad,ToWarehouse:_0x46e4d4,ToRoom:_0x51eaba,primary_code:_0x26bfd3,Roomslist:_0xbcb741}=_0x287da6[_0x2d83c2(0x25b)],_0x2c8f3a=_0xbcb741[_0x2d83c2(0x26c)](','),_0x12ba57=[];async function _0x25ec1f(_0x497e18){var _0x2d4db2=_0x2d83c2;const _0x14175d=await warehouse[_0x2d4db2(0x215)]([{'$match':{'name':_0x443951,'room':_0x497e18}},{'$unwind':_0x2d4db2(0x23d)},{'$match':{'product_details.primary_code':_0x26bfd3}},{'$group':{'_id':_0x2d4db2(0x24b),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x2d4db2(0x272)},'primary_code':{'$first':_0x2d4db2(0x265)},'secondary_code':{'$first':_0x2d4db2(0x234)},'product_code':{'$first':_0x2d4db2(0x27c)},'level':{'$first':_0x2d4db2(0x22c)},'isle':{'$first':_0x2d4db2(0x252)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2d4db2(0x267)},'unit':{'$first':_0x2d4db2(0x268)},'secondary_unit':{'$first':_0x2d4db2(0x1eb)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2d4db2(0x260)},'expiry_date':{'$first':_0x2d4db2(0x281)},'production_date':{'$first':_0x2d4db2(0x28e)},'batch_code':{'$first':_0x2d4db2(0x258)},'maxPerUnit':{'$first':_0x2d4db2(0x208)},'roomNamed':{'$first':_0x2d4db2(0x270)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x2d4db2(0x29c)}}}]),_0x3d1277=await warehouse[_0x2d4db2(0x215)]([{'$match':{'name':_0x443951,'room':_0x497e18}},{'$unwind':_0x2d4db2(0x23d)},{'$match':{'product_details.secondary_code':_0x26bfd3}},{'$group':{'_id':_0x2d4db2(0x24b),'name':{'$first':_0x2d4db2(0x251)},'instock':{'$first':_0x2d4db2(0x272)},'primary_code':{'$first':_0x2d4db2(0x265)},'secondary_code':{'$first':_0x2d4db2(0x234)},'product_code':{'$first':_0x2d4db2(0x27c)},'level':{'$first':_0x2d4db2(0x22c)},'isle':{'$first':_0x2d4db2(0x252)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2d4db2(0x267)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2d4db2(0x1eb)},'storage':{'$first':_0x2d4db2(0x28d)},'rack':{'$first':_0x2d4db2(0x260)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2d4db2(0x258)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x2d4db2(0x270)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x2d4db2(0x29c)}}}]);if(_0x14175d[_0x2d4db2(0x2a3)]>0x0)_0x12ba57[_0x2d4db2(0x2a2)](_0x14175d);else _0x3d1277[_0x2d4db2(0x2a3)]>0x0&&_0x12ba57[_0x2d4db2(0x2a2)](_0x3d1277);}const _0x2394dd=_0x2c8f3a[_0x2d83c2(0x293)](_0xc54f4a=>_0x25ec1f(_0xc54f4a));await Promise['all'](_0x2394dd),_0x15ee9d[_0x2d83c2(0x222)](_0x12ba57);}),router[a0_0x8ce878(0x2b7)]('/barcode_scanner2',async(_0x158129,_0x58f338)=>{var _0x547eac=a0_0x8ce878;try{const {FromWareHouse:_0x35324e,FromRoom:_0x4f8045,ToWarehouse:_0x190386,ToRoom:_0x204970,secondary_code:_0x4dc41e}=_0x158129[_0x547eac(0x25b)],_0x400c4c=await warehouse[_0x547eac(0x215)]([{'$match':{'name':_0x35324e}},{'$unwind':_0x547eac(0x23d)},{'$match':{'product_details.secondary_code':_0x4dc41e}},{'$group':{'_id':_0x547eac(0x24b),'name':{'$first':_0x547eac(0x251)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x547eac(0x234)},'product_code':{'$first':_0x547eac(0x27c)},'instock':{'$first':_0x547eac(0x272)},'warehouse':{'$first':_0x547eac(0x250)},'level':{'$first':_0x547eac(0x283)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x547eac(0x242)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x547eac(0x268)},'expiry_date':{'$first':_0x547eac(0x281)},'production_date':{'$first':_0x547eac(0x28e)}}}]);_0x58f338[_0x547eac(0x289)](0xc8)[_0x547eac(0x222)](_0x400c4c);}catch(_0x298517){_0x58f338['status'](0x194)[_0x547eac(0x222)]({'message':_0x298517[_0x547eac(0x238)]});}}),router[a0_0x8ce878(0x2b7)](a0_0x8ce878(0x216),async(_0x624d85,_0x118a5b)=>{var _0x407a3=a0_0x8ce878;try{const {FromWareHouse:_0x26ad96,FromRoom:_0x68d07f,ToWarehouse:_0xb50da4,ToRoom:_0x29a1d6,product_code:_0x5808c6}=_0x624d85['body'],_0x1376fb=await warehouse[_0x407a3(0x215)]([{'$match':{'name':_0x26ad96}},{'$unwind':_0x407a3(0x23d)},{'$match':{'product_details.product_code':_0x5808c6}},{'$group':{'_id':_0x407a3(0x24b),'name':{'$first':_0x407a3(0x251)},'primary_code':{'$first':_0x407a3(0x265)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x407a3(0x27c)},'instock':{'$first':_0x407a3(0x272)},'warehouse':{'$first':_0x407a3(0x250)},'level':{'$first':_0x407a3(0x283)},'isle':{'$first':_0x407a3(0x292)},'pallet':{'$first':_0x407a3(0x242)},'maxProducts':{'$first':_0x407a3(0x220)},'unit':{'$first':_0x407a3(0x268)}}}]);_0x118a5b[_0x407a3(0x289)](0xc8)[_0x407a3(0x222)](_0x1376fb);}catch(_0xdee2fd){_0x118a5b[_0x407a3(0x289)](0x194)[_0x407a3(0x222)]({'message':_0xdee2fd[_0x407a3(0x238)]});}}),router[a0_0x8ce878(0x2b7)](a0_0x8ce878(0x25c),async(_0x2e3e15,_0x15997d)=>{var _0x4127b3=a0_0x8ce878;const {productCode:_0x18b089,bay:_0x25eeec,warehouses:_0x419448,room:_0x406f53}=_0x2e3e15[_0x4127b3(0x25b)];console[_0x4127b3(0x282)](_0x2e3e15[_0x4127b3(0x25b)]);try{const _0x66e495=await warehouse[_0x4127b3(0x215)]([{'$match':{'name':_0x419448,'room':_0x406f53}},{'$unwind':_0x4127b3(0x23d)},{'$match':{'product_details.bay':parseInt(_0x25eeec)}},{'$group':{'_id':_0x4127b3(0x24b),'name':{'$first':_0x4127b3(0x251)},'product_stock':{'$first':_0x4127b3(0x272)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x4127b3(0x220)}}}]);_0x15997d['status'](0xc8)[_0x4127b3(0x222)](_0x66e495);}catch(_0x3f7934){_0x15997d[_0x4127b3(0x289)](0x194)[_0x4127b3(0x222)]({'message':_0x3f7934[_0x4127b3(0x238)]});}}),module[a0_0x8ce878(0x2ab)]=router;