var a0_0x14855f=a0_0x3a38;(function(_0x1f9434,_0x338572){var _0x2a406d=a0_0x3a38,_0x5eb29b=_0x1f9434();while(!![]){try{var _0x725741=parseInt(_0x2a406d(0x1eb))/0x1*(parseInt(_0x2a406d(0x24d))/0x2)+-parseInt(_0x2a406d(0x1d4))/0x3+parseInt(_0x2a406d(0x1bf))/0x4+-parseInt(_0x2a406d(0x246))/0x5*(-parseInt(_0x2a406d(0x1da))/0x6)+-parseInt(_0x2a406d(0x203))/0x7+parseInt(_0x2a406d(0x23a))/0x8+-parseInt(_0x2a406d(0x17f))/0x9;if(_0x725741===_0x338572)break;else _0x5eb29b['push'](_0x5eb29b['shift']());}catch(_0x527cc4){_0x5eb29b['push'](_0x5eb29b['shift']());}}}(a0_0x4ece,0xb82dc));const express=require('express'),app=express(),router=express[a0_0x14855f(0x210)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x14855f(0x1e5)),users=require(a0_0x14855f(0x1b5)),nodemailer=require(a0_0x14855f(0x23f));router[a0_0x14855f(0x214)](a0_0x14855f(0x221),auth,async(_0x50886f,_0x558f00)=>{var _0x31724f=a0_0x14855f;try{const {username:_0x1850c5,email:_0x54d6e6,role:_0x1d99fa}=_0x50886f[_0x31724f(0x1cc)],_0x59d9d3=_0x50886f['user'],_0x3fb30d=await profile[_0x31724f(0x1ef)]({'email':_0x59d9d3[_0x31724f(0x233)]}),_0x55df05=await master_shop['find']();let _0x85fe68;if(_0x59d9d3[_0x31724f(0x23b)]==_0x31724f(0x1e0)){const _0x215d6c=await staff[_0x31724f(0x1ef)]({'email':_0x59d9d3[_0x31724f(0x233)]});_0x85fe68=await transfers_finished[_0x31724f(0x212)]({'from_warehouse':_0x215d6c['warehouse']});}else _0x85fe68=await transfers_finished[_0x31724f(0x1f4)]([{'$unwind':'$product'},{'$group':{'_id':_0x31724f(0x25c),'invoice':{'$first':_0x31724f(0x241)},'date':{'$first':_0x31724f(0x235)},'from_warehouse':{'$first':_0x31724f(0x1c6)},'to_warehouse':{'$first':_0x31724f(0x19b)},'from_room_name':{'$addToSet':_0x31724f(0x1af)},'to_room_name':{'$addToSet':_0x31724f(0x1dd)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x55df05[0x0]['language']==_0x31724f(0x1e2))var _0x5039e2=users[_0x31724f(0x1a8)];else{if(_0x55df05[0x0][_0x31724f(0x236)]==_0x31724f(0x1d5))var _0x5039e2=users['Hindi'];else{if(_0x55df05[0x0][_0x31724f(0x236)]=='German')var _0x5039e2=users[_0x31724f(0x234)];else{if(_0x55df05[0x0][_0x31724f(0x236)]==_0x31724f(0x254))var _0x5039e2=users[_0x31724f(0x254)];else{if(_0x55df05[0x0][_0x31724f(0x236)]==_0x31724f(0x22e))var _0x5039e2=users[_0x31724f(0x22e)];else{if(_0x55df05[0x0]['language']==_0x31724f(0x25d))var _0x5039e2=users[_0x31724f(0x251)];else{if(_0x55df05[0x0][_0x31724f(0x236)]=='Chinese')var _0x5039e2=users[_0x31724f(0x18e)];else{if(_0x55df05[0x0][_0x31724f(0x236)]==_0x31724f(0x211))var _0x5039e2=users['Arabic'];}}}}}}}_0x558f00[_0x31724f(0x197)](_0x31724f(0x196),{'success':_0x50886f[_0x31724f(0x240)]('success'),'errors':_0x50886f['flash'](_0x31724f(0x1ec)),'role':_0x59d9d3,'profile':_0x3fb30d,'master_shop':_0x55df05,'transfer':_0x85fe68,'language':_0x5039e2});}catch(_0x37159e){console[_0x31724f(0x219)](_0x37159e);}});async function getRandom8DigitNumber(){var _0x24f383=a0_0x14855f;const _0x568fee=0x989680,_0x8ce471=0x5f5e0ff,_0x1c50c4=Math[_0x24f383(0x22a)](Math[_0x24f383(0x253)]()*(_0x8ce471-_0x568fee+0x1))+_0x568fee;var _0x5ec6b6;const _0x141155=await transfers_finished[_0x24f383(0x1ef)]({'invoice':'TRFF-'+_0x1c50c4});return _0x141155&&_0x141155['length']>0x0?_0x5ec6b6=_0x24f383(0x21c)+_0x1c50c4:_0x5ec6b6=_0x24f383(0x21c)+_0x1c50c4,_0x5ec6b6;}router[a0_0x14855f(0x214)](a0_0x14855f(0x1df),auth,async(_0x4fb1e7,_0x659776)=>{var _0x52f440=a0_0x14855f;try{const {username:_0xf4451b,email:_0x14d414,role:_0x41da61}=_0x4fb1e7[_0x52f440(0x1cc)],_0x28b0d1=_0x4fb1e7[_0x52f440(0x1cc)],_0x1b7325=await profile['findOne']({'email':_0x28b0d1[_0x52f440(0x233)]}),_0x473e33=await master_shop[_0x52f440(0x212)]();let _0x169608;if(_0x28b0d1[_0x52f440(0x23b)]=='staff'){const _0xefb8d3=await staff[_0x52f440(0x1ef)]({'email':_0x28b0d1[_0x52f440(0x233)]});_0x169608=await warehouse[_0x52f440(0x1f4)]([{'$match':{'status':_0x52f440(0x1a7),'name':_0xefb8d3[_0x52f440(0x19c)],'warehouse_category':_0x52f440(0x182),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x52f440(0x21f),'name':{'$first':_0x52f440(0x21f)}}}]);}else _0x169608=await warehouse[_0x52f440(0x1f4)]([{'$match':{'status':_0x52f440(0x1a7),'warehouse_category':_0x52f440(0x182),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x52f440(0x21f)}}}]);const _0x2efdc0=await transfers_finished[_0x52f440(0x212)]({}),_0xe94daa=_0x2efdc0[_0x52f440(0x1db)]+0x1,_0x2f9006=_0x52f440(0x21c)+_0xe94daa[_0x52f440(0x1b3)]()[_0x52f440(0x1ee)](0x5,'0');if(_0x473e33[0x0][_0x52f440(0x236)]==_0x52f440(0x1e2))var _0x4bffbf=users[_0x52f440(0x1a8)];else{if(_0x473e33[0x0][_0x52f440(0x236)]==_0x52f440(0x1d5))var _0x4bffbf=users['Hindi'];else{if(_0x473e33[0x0][_0x52f440(0x236)]=='German')var _0x4bffbf=users[_0x52f440(0x234)];else{if(_0x473e33[0x0]['language']=='Spanish')var _0x4bffbf=users['Spanish'];else{if(_0x473e33[0x0][_0x52f440(0x236)]==_0x52f440(0x22e))var _0x4bffbf=users[_0x52f440(0x22e)];else{if(_0x473e33[0x0]['language']=='Portuguese\x20(BR)')var _0x4bffbf=users[_0x52f440(0x251)];else{if(_0x473e33[0x0][_0x52f440(0x236)]==_0x52f440(0x18e))var _0x4bffbf=users[_0x52f440(0x18e)];else{if(_0x473e33[0x0][_0x52f440(0x236)]==_0x52f440(0x211))var _0x4bffbf=users['Arabic'];}}}}}}}const _0x1c4b0e=getRandom8DigitNumber();_0x1c4b0e['then'](_0x224f7c=>{var _0x1d5d16=_0x52f440;_0x659776['render'](_0x1d5d16(0x18d),{'success':_0x4fb1e7[_0x1d5d16(0x240)](_0x1d5d16(0x1b0)),'errors':_0x4fb1e7[_0x1d5d16(0x240)](_0x1d5d16(0x1ec)),'role':_0x28b0d1,'profile':_0x1b7325,'master_shop':_0x473e33,'warehouse':_0x169608,'language':_0x4bffbf,'invoice':_0x224f7c});})[_0x52f440(0x18a)](_0x2c2c1d=>{var _0x3f8f78=_0x52f440;_0x4fb1e7['flash'](_0x3f8f78(0x1ec),_0x3f8f78(0x21e)),_0x659776[_0x3f8f78(0x208)](_0x3f8f78(0x1aa));});}catch(_0x3fe1a2){console[_0x52f440(0x219)](_0x3fe1a2);}}),router[a0_0x14855f(0x1a5)](a0_0x14855f(0x1df),auth,async(_0x1b149e,_0x111d8e)=>{var _0x4ce5ff=a0_0x14855f;try{const {date:_0x20ab0d,from_warehouse:_0xfbd704,FromRoom_name:_0x5b4d2c,to_warehouse:_0x44f53b,ToRoom_name:_0x3c8104,prod_name:_0x132843,from_prod_qty:_0x1f07d8,from_prod_level:_0x2478cd,from_prod_isle:_0x52592e,from_prod_pallet:_0x5ec77f,to_prod_qty:_0x4df2fc,to_prod_level:_0x14805b,to_prod_isle:_0x4e4a74,to_prod_pallet:_0x111ae1,primary_code:_0x1411fd,secondary_code:_0x2b61b8,product_code3:_0x25d71d,note:_0x5c98a5,MaxStocks_data2:_0x2b5f35,invoice:_0x29894f,expiry_date:_0x165682}=_0x1b149e[_0x4ce5ff(0x232)];if(typeof _0x132843==_0x4ce5ff(0x193))var _0x237256=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x189)]],_0x119b56=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x249)]],_0xde9797=[_0x1b149e[_0x4ce5ff(0x232)]['from_prod_level']],_0x2f3708=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x256)]],_0xe78a2f=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1f2)]],_0x471402=[_0x1b149e[_0x4ce5ff(0x232)]['primary_code']],_0x38f50f=[_0x1b149e[_0x4ce5ff(0x232)]['secondary_code']],_0x20a052=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1e8)]],_0xc146dc=[_0x1b149e[_0x4ce5ff(0x232)]['MaxStocks_data2']],_0x7c42b6=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x216)]],_0x5e8e56=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x230)]],_0x4b010f=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x238)]],_0x2779c3=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1a2)]],_0x578d68=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x226)]],_0x35fbc2=[_0x1b149e['body'][_0x4ce5ff(0x1de)]],_0x3cc5bb=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x199)]],_0x597a94=[_0x1b149e['body'][_0x4ce5ff(0x18f)]],_0xcec715=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x242)]],_0xf77bd2=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1f6)]],_0x2f6c16=[_0x1b149e['body']['from_invoice']],_0x459670=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1e4)]],_0x2f3216=[_0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x259)]];else var _0x237256=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x189)]],_0x119b56=[..._0x1b149e['body'][_0x4ce5ff(0x249)]],_0xde9797=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x206)]],_0x2f3708=[..._0x1b149e['body'][_0x4ce5ff(0x256)]],_0xe78a2f=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1f2)]],_0x471402=[..._0x1b149e[_0x4ce5ff(0x232)]['primary_code']],_0x38f50f=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x24e)]],_0x20a052=[..._0x1b149e['body']['product_code3']],_0xc146dc=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1f8)]],_0x7c42b6=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x216)]],_0x5e8e56=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x230)]],_0x4b010f=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x238)]],_0x2779c3=[..._0x1b149e['body'][_0x4ce5ff(0x1a2)]],_0x578d68=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x226)]],_0x35fbc2=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1de)]],_0x3cc5bb=[..._0x1b149e['body'][_0x4ce5ff(0x199)]],_0x597a94=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x18f)]],_0xcec715=[..._0x1b149e['body'][_0x4ce5ff(0x242)]],_0xf77bd2=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1f6)]],_0x2f6c16=[..._0x1b149e[_0x4ce5ff(0x232)]['from_invoice']],_0x459670=[..._0x1b149e[_0x4ce5ff(0x232)][_0x4ce5ff(0x1e4)]],_0x2f3216=[..._0x1b149e['body'][_0x4ce5ff(0x259)]];const _0x41463a=_0x237256['map'](_0x2e8f80=>{return _0x2e8f80={'product_name':_0x2e8f80};});_0x119b56[_0x4ce5ff(0x1c7)]((_0x2a4717,_0x57ce7b)=>{var _0x535177=_0x4ce5ff;_0x41463a[_0x57ce7b][_0x535177(0x1e1)]=_0x2a4717;}),_0xde9797[_0x4ce5ff(0x1c7)]((_0x2bad08,_0x5bc77f)=>{var _0xf30884=_0x4ce5ff;_0x41463a[_0x5bc77f][_0xf30884(0x1ab)]=_0x2bad08;}),_0x2f3216['forEach']((_0x8033c6,_0xc8cc85)=>{_0x41463a[_0xc8cc85]['id_transaction']=_0x8033c6;}),_0x2f6c16['forEach']((_0x164d35,_0x39c50a)=>{var _0x5f52fa=_0x4ce5ff;_0x41463a[_0x39c50a][_0x5f52fa(0x1f7)]=_0x164d35;}),_0x459670[_0x4ce5ff(0x1c7)]((_0xba3070,_0xd5ef67)=>{_0x41463a[_0xd5ef67]['To_invoice']=_0xba3070;}),_0x2f3708[_0x4ce5ff(0x1c7)]((_0xc0b3ad,_0x178370)=>{var _0x395179=_0x4ce5ff;_0x41463a[_0x178370][_0x395179(0x24c)]=_0xc0b3ad;}),_0xe78a2f[_0x4ce5ff(0x1c7)]((_0x7aac26,_0x242afd)=>{_0x41463a[_0x242afd]['to_bay']=_0x7aac26;}),_0x471402['forEach']((_0x57f648,_0x309a6d)=>{var _0x55c927=_0x4ce5ff;_0x41463a[_0x309a6d][_0x55c927(0x186)]=_0x57f648;}),_0x38f50f[_0x4ce5ff(0x1c7)]((_0x38bd12,_0x147b8d)=>{_0x41463a[_0x147b8d]['secondary_code']=_0x38bd12;}),_0x20a052[_0x4ce5ff(0x1c7)]((_0x23b230,_0xc1f22b)=>{_0x41463a[_0xc1f22b]['product_code']=_0x23b230;}),_0xc146dc[_0x4ce5ff(0x1c7)]((_0x248fc0,_0x5fe19f)=>{var _0x5d6a31=_0x4ce5ff;_0x41463a[_0x5fe19f][_0x5d6a31(0x19d)]=_0x248fc0;}),_0x7c42b6[_0x4ce5ff(0x1c7)]((_0x828dcd,_0x151106)=>{_0x41463a[_0x151106]['unit']=_0x828dcd;}),_0x5e8e56['forEach']((_0x560e23,_0x21f1b9)=>{_0x41463a[_0x21f1b9]['secondary_unit']=_0x560e23;}),_0x4b010f[_0x4ce5ff(0x1c7)]((_0x11bff1,_0x39d561)=>{var _0x269c81=_0x4ce5ff;_0x41463a[_0x39d561][_0x269c81(0x238)]=_0x11bff1;}),_0x2779c3['forEach']((_0xec2d0b,_0x41420f)=>{var _0x372b32=_0x4ce5ff;_0x41463a[_0x41420f][_0x372b32(0x1a2)]=_0xec2d0b;}),_0x578d68['forEach']((_0x169f2e,_0x3842a7)=>{_0x41463a[_0x3842a7]['production_date']=_0x169f2e;}),_0x35fbc2['forEach']((_0x3769d3,_0x40b53f)=>{var _0x3b09d1=_0x4ce5ff;_0x41463a[_0x40b53f][_0x3b09d1(0x19d)]=_0x3769d3;}),_0x3cc5bb[_0x4ce5ff(0x1c7)]((_0x4f136a,_0xe4139d)=>{var _0x223409=_0x4ce5ff;_0x41463a[_0xe4139d][_0x223409(0x199)]=_0x4f136a;}),_0x597a94[_0x4ce5ff(0x1c7)]((_0x53c8fa,_0x16ea38)=>{_0x41463a[_0x16ea38]['prod_cat']=_0x53c8fa;}),_0xcec715[_0x4ce5ff(0x1c7)]((_0x41f46e,_0x44b06f)=>{var _0x2c3b4b=_0x4ce5ff;_0x41463a[_0x44b06f][_0x2c3b4b(0x1c9)]=_0x41f46e;}),_0xf77bd2['forEach']((_0x5b6e7a,_0x357c30)=>{var _0x25e602=_0x4ce5ff;_0x41463a[_0x357c30][_0x25e602(0x24b)]=_0x5b6e7a;});const _0x420e17=_0x41463a[_0x4ce5ff(0x192)](_0x495da2=>_0x495da2[_0x4ce5ff(0x24c)]!=='0'&&_0x495da2[_0x4ce5ff(0x24c)]!==''||_0x495da2[_0x4ce5ff(0x183)]!=='0'&&_0x495da2['to_floorlevel']!=='');var _0x2d5b4e=0x0;_0x420e17[_0x4ce5ff(0x1c7)](_0x310b13=>{var _0x569a80=_0x4ce5ff;parseInt(_0x310b13[_0x569a80(0x1e1)])<parseInt(_0x310b13[_0x569a80(0x24c)])&&_0x2d5b4e++;});if(_0x2d5b4e!=0x0)return _0x1b149e[_0x4ce5ff(0x240)]('errors',_0x4ce5ff(0x229)),_0x111d8e[_0x4ce5ff(0x208)](_0x4ce5ff(0x215));const _0x204942=new transfers_finished({'date':_0x20ab0d,'from_warehouse':_0xfbd704,'to_warehouse':_0x44f53b,'product':_0x420e17,'note':_0x5c98a5,'invoice':_0x29894f}),_0x4a67d9=await _0x204942['save']();_0x1b149e['flash'](_0x4ce5ff(0x1b0),_0x4ce5ff(0x228)),_0x111d8e[_0x4ce5ff(0x208)](_0x4ce5ff(0x1b9)+_0x4a67d9[_0x4ce5ff(0x1ed)]);}catch(_0x66ca4e){console['log'](_0x66ca4e),_0x111d8e[_0x4ce5ff(0x1b2)](0xc8)[_0x4ce5ff(0x19e)]({'errorMessage':_0x66ca4e['message']});}}),router['get'](a0_0x14855f(0x19a),auth,async(_0x52bac8,_0x419bfc)=>{var _0x44cad0=a0_0x14855f;try{const {username:_0x44880d,email:_0x3fa1dd,role:_0x22576c}=_0x52bac8[_0x44cad0(0x1cc)],_0x5872f1=_0x52bac8[_0x44cad0(0x1cc)],_0x5780d9=await profile[_0x44cad0(0x1ef)]({'email':_0x5872f1[_0x44cad0(0x233)]}),_0x1b5ec2=await master_shop[_0x44cad0(0x212)](),_0x339516=await transfers_finished[_0x44cad0(0x23e)](_0x52bac8[_0x44cad0(0x248)]['id']);let _0xa65f81;if(_0x5872f1['role']==_0x44cad0(0x1e0)){const _0x31352d=await staff[_0x44cad0(0x1ef)]({'email':_0x5872f1[_0x44cad0(0x233)]});_0xa65f81=await warehouse[_0x44cad0(0x212)]({'status':_0x44cad0(0x1a7),'name':_0x31352d['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0xa65f81=await warehouse[_0x44cad0(0x212)]({'status':'Enabled','warehouse_category':_0x44cad0(0x182)});const _0x17c134=await warehouse[_0x44cad0(0x1f4)]([{'$match':{'name':_0x339516[_0x44cad0(0x1b6)],'warehouse_category':_0x44cad0(0x182)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x44cad0(0x20f)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x44cad0(0x1b8)},'bin':{'$first':_0x44cad0(0x1d2)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x44cad0(0x1f3)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x44cad0(0x22c)},'storage':{'$first':_0x44cad0(0x1d8)},'rack':{'$first':_0x44cad0(0x1d0)},'expiry_date':{'$first':_0x44cad0(0x1ce)},'production_date':{'$first':_0x44cad0(0x22f)},'room':{'$first':_0x44cad0(0x231)},'warehoue_name':{'$first':_0x44cad0(0x21f)}}}]),_0x1f2a92=await product[_0x44cad0(0x212)]({});if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x1e2)){var _0x548123=users[_0x44cad0(0x1a8)];console[_0x44cad0(0x219)](_0x548123);}else{if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x1d5))var _0x548123=users[_0x44cad0(0x1d5)];else{if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x234))var _0x548123=users[_0x44cad0(0x234)];else{if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x254))var _0x548123=users['Spanish'];else{if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x22e))var _0x548123=users[_0x44cad0(0x22e)];else{if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x25d))var _0x548123=users['Portuguese'];else{if(_0x1b5ec2[0x0]['language']==_0x44cad0(0x18e))var _0x548123=users[_0x44cad0(0x18e)];else{if(_0x1b5ec2[0x0][_0x44cad0(0x236)]==_0x44cad0(0x211))var _0x548123=users['Arabic'];}}}}}}}_0x419bfc['render']('edit_transfer_finished_view',{'success':_0x52bac8[_0x44cad0(0x240)](_0x44cad0(0x1b0)),'errors':_0x52bac8[_0x44cad0(0x240)](_0x44cad0(0x1ec)),'role':_0x5872f1,'profile':_0x5780d9,'master_shop':_0x1b5ec2,'warehouse':_0xa65f81,'transfer':_0x339516,'stock':_0x17c134,'unit':_0x1f2a92,'language':_0x548123});}catch(_0x3ea7fb){console[_0x44cad0(0x219)](_0x3ea7fb);}}),router[a0_0x14855f(0x1a5)](a0_0x14855f(0x19a),auth,async(_0x37b155,_0x269246)=>{var _0x12affe=a0_0x14855f;try{const {invoice:_0x40a2ca,from_warehouse:_0x11c23a,FromRoom_name:_0x411b98,to_warehouse:_0x2c7b24,ToRoom_name:_0x4cec2b}=_0x37b155[_0x12affe(0x232)],_0x1b66c2=await transfers_finished[_0x12affe(0x23e)](_0x37b155[_0x12affe(0x248)]['id']),_0x5c7266=_0x1b66c2[_0x12affe(0x20d)][_0x12affe(0x1cd)](async _0x5ba580=>{var _0x47a546=_0x12affe;if(_0x5ba580[_0x47a546(0x24c)]>0x0){var _0x34fb96=await warehouse[_0x47a546(0x1ef)]({'name':_0x11c23a,'room':_0x5ba580[_0x47a546(0x1c9)],'warehouse_category':_0x47a546(0x182)});const _0x34faef=_0x34fb96[_0x47a546(0x20c)][_0x47a546(0x1cd)](_0x26a1ca=>{var _0x4ef299=_0x47a546;_0x26a1ca[_0x4ef299(0x1a1)]==_0x5ba580['product_name']&&_0x26a1ca['bay']==_0x5ba580[_0x4ef299(0x1ab)]&&_0x26a1ca['expiry_date']==_0x5ba580[_0x4ef299(0x1a2)]&&_0x26a1ca[_0x4ef299(0x220)]==_0x5ba580['production_date']&&_0x26a1ca[_0x4ef299(0x238)]==_0x5ba580[_0x4ef299(0x238)]&&_0x26a1ca[_0x4ef299(0x1fe)]==_0x5ba580[_0x4ef299(0x1f7)]&&(console['log'](_0x4ef299(0x213),_0x26a1ca[_0x4ef299(0x20a)]),typeof _0x5ba580[_0x4ef299(0x259)]==_0x4ef299(0x1a4)?_0x26a1ca['product_stock']=Math['max'](0x0,Math[_0x4ef299(0x202)](_0x26a1ca[_0x4ef299(0x20a)])-Math['abs'](_0x5ba580[_0x4ef299(0x24c)])):_0x26a1ca[_0x4ef299(0x20a)]=Math['max'](0x0,Math[_0x4ef299(0x202)](_0x26a1ca[_0x4ef299(0x20a)])-Math['abs'](_0x5ba580['to_quantity'])));});}return _0x34fb96;});Promise[_0x12affe(0x1f9)](_0x5c7266)['then'](async _0x4f3f35=>{var _0xa6f516=_0x12affe;try{for(const _0x1e947e of _0x4f3f35){await _0x1e947e['save']();}const _0x3aac64=_0x1b66c2['product'][_0xa6f516(0x1cd)](async _0x1c47e6=>{var _0x169ec6=_0xa6f516,_0x4ddf3c=await warehouse[_0x169ec6(0x1ef)]({'name':_0x2c7b24,'room':_0x1c47e6['to_room_name']});if(_0x1c47e6[_0x169ec6(0x24c)]>0x0){var _0xc50dd8=0x0;const _0x34c3c5=_0x4ddf3c[_0x169ec6(0x20c)][_0x169ec6(0x1cd)](_0x4bf642=>{var _0x30448e=_0x169ec6;_0x4bf642[_0x30448e(0x1a1)]==_0x1c47e6['product_name']&&_0x4bf642['bay']==_0x1c47e6[_0x30448e(0x1ae)]&&_0x4bf642['expiry_date']==_0x1c47e6[_0x30448e(0x1a2)]&&_0x4bf642[_0x30448e(0x220)]==_0x1c47e6[_0x30448e(0x220)]&&_0x4bf642[_0x30448e(0x238)]==_0x1c47e6['batch_code']&&_0x4bf642[_0x30448e(0x1fe)]==_0x1c47e6[_0x30448e(0x1f1)]&&(typeof _0x1c47e6[_0x30448e(0x259)]==_0x30448e(0x1a4)?(console[_0x30448e(0x219)](_0x30448e(0x25a),_0x4bf642['product_stock']+_0x30448e(0x243)+_0x4bf642[_0x30448e(0x1ed)]+'\x20<=>\x20'+Math[_0x30448e(0x202)](_0x4bf642[_0x30448e(0x20a)])+Math[_0x30448e(0x202)](_0x1c47e6[_0x30448e(0x24c)])),_0x4bf642[_0x30448e(0x20a)]=Math[_0x30448e(0x202)](_0x4bf642['product_stock'])+Math[_0x30448e(0x202)](_0x1c47e6[_0x30448e(0x24c)])):_0x4bf642[_0x30448e(0x20a)]=Math[_0x30448e(0x202)](_0x4bf642[_0x30448e(0x20a)])+Math[_0x30448e(0x202)](_0x1c47e6[_0x30448e(0x24c)]),_0xc50dd8++);});_0xc50dd8=='0'&&(_0x4ddf3c[_0x169ec6(0x20c)]=_0x4ddf3c['product_details'][_0x169ec6(0x1e6)]({'product_name':_0x1c47e6['product_name'],'product_stock':_0x1c47e6[_0x169ec6(0x24c)],'bay':_0x1c47e6[_0x169ec6(0x1ae)],'product_code':_0x1c47e6[_0x169ec6(0x19f)],'primary_code':_0x1c47e6[_0x169ec6(0x186)],'secondary_code':_0x1c47e6[_0x169ec6(0x24e)],'expiry_date':_0x1c47e6[_0x169ec6(0x1a2)],'production_date':_0x1c47e6['production_date'],'maxProducts':_0x1c47e6[_0x169ec6(0x19d)],'batch_code':_0x1c47e6[_0x169ec6(0x238)],'secondary_unit':_0x1c47e6[_0x169ec6(0x230)],'unit':_0x1c47e6[_0x169ec6(0x18c)],'maxProducts':_0x1c47e6[_0x169ec6(0x19d)],'maxPerUnit':_0x1c47e6['maxPerUnit'],'invoice':_0x1c47e6[_0x169ec6(0x1f1)]}));}return _0x4ddf3c;});Promise['all'](_0x3aac64)[_0xa6f516(0x1e9)](async _0x382bc5=>{var _0x3c4e9b=_0xa6f516;try{for(const _0x1e420c of _0x382bc5){await warehouse['updateOne']({'_id':_0x1e420c[_0x3c4e9b(0x1ed)]},{'$addToSet':{'product_details':{'$each':_0x1e420c[_0x3c4e9b(0x20c)]}}});}_0x1b66c2[_0x3c4e9b(0x1c8)]='True';const _0x1c6535=await _0x1b66c2[_0x3c4e9b(0x21d)](),_0x1999d4=await master_shop[_0x3c4e9b(0x212)](),_0x3cd038=await email_settings[_0x3c4e9b(0x1ef)](),_0x38e715=await supervisor_settings[_0x3c4e9b(0x212)]();var _0x37c36f=_0x1b66c2[_0x3c4e9b(0x20d)],_0x5d0de2='',_0x511bc1;for(_0x511bc1 in _0x37c36f){var _0x42be9d='FG';_0x1b66c2[_0x3c4e9b(0x1bd)]==_0x3c4e9b(0x223)&&(_0x42be9d='DG'),_0x5d0de2+=_0x3c4e9b(0x1fd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37c36f[_0x511bc1][_0x3c4e9b(0x1a1)]+_0x3c4e9b(0x1d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37c36f[_0x511bc1][_0x3c4e9b(0x19f)]+_0x3c4e9b(0x1d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37c36f[_0x511bc1]['to_quantity']+_0x3c4e9b(0x1d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37c36f[_0x511bc1][_0x3c4e9b(0x18c)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x37c36f[_0x511bc1][_0x3c4e9b(0x230)]+_0x3c4e9b(0x1d3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1b66c2[_0x3c4e9b(0x1bd)]+_0x3c4e9b(0x1d3)+_0x3c4e9b(0x23d)+_0x37c36f[_0x511bc1][_0x3c4e9b(0x24b)]+_0x3c4e9b(0x1d3)+_0x3c4e9b(0x23d)+_0x42be9d+_0x37c36f[_0x511bc1][_0x3c4e9b(0x1ae)]+_0x3c4e9b(0x1d3)+_0x3c4e9b(0x217);}let _0x40a573=nodemailer[_0x3c4e9b(0x218)]({'host':_0x3cd038[_0x3c4e9b(0x1ba)],'port':Number(_0x3cd038['port']),'secure':![],'auth':{'user':_0x3cd038['email'],'pass':_0x3cd038[_0x3c4e9b(0x185)]}}),_0x378a76={'from':_0x3cd038[_0x3c4e9b(0x233)],'to':_0x38e715[0x0][_0x3c4e9b(0x1d1)],'subject':_0x3c4e9b(0x207),'attachments':[{'filename':_0x3c4e9b(0x1fc),'path':__dirname+'/../public'+_0x3c4e9b(0x1c2)+_0x1999d4[0x0][_0x3c4e9b(0x187)],'cid':_0x3c4e9b(0x1d9)}],'html':_0x3c4e9b(0x1c1)+'<html><head><title></title>'+_0x3c4e9b(0x1f0)+_0x3c4e9b(0x191)+_0x3c4e9b(0x1ff)+_0x3c4e9b(0x191)+_0x3c4e9b(0x18b)+_0x3c4e9b(0x245)+'<div>'+'<h2>\x20'+_0x1999d4[0x0][_0x3c4e9b(0x181)]+_0x3c4e9b(0x194)+_0x3c4e9b(0x245)+_0x3c4e9b(0x245)+_0x3c4e9b(0x222)+_0x3c4e9b(0x191)+_0x3c4e9b(0x1be)+_0x3c4e9b(0x224)+_0x1b66c2['invoice']+'\x20'+_0x3c4e9b(0x1fa)+_0x3c4e9b(0x1cf)+_0x1b66c2[_0x3c4e9b(0x1a6)]+'\x20'+_0x3c4e9b(0x22b)+_0x3c4e9b(0x227)+_0x3c4e9b(0x245)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3c4e9b(0x209)+_0x3c4e9b(0x1fd)+_0x3c4e9b(0x247)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x3c4e9b(0x1e7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3c4e9b(0x1bb)+_0x3c4e9b(0x1b4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x3c4e9b(0x217)+_0x3c4e9b(0x1f5)+_0x3c4e9b(0x180)+'\x20'+_0x5d0de2+'\x20'+_0x3c4e9b(0x1dc)+_0x3c4e9b(0x21a)+_0x3c4e9b(0x191)+_0x3c4e9b(0x258)+_0x3c4e9b(0x201)+_0x1999d4[0x0][_0x3c4e9b(0x181)]+'</h5>'+'</div>'+_0x3c4e9b(0x245)+'</body></html>'};_0x40a573[_0x3c4e9b(0x1e3)](_0x378a76,function(_0x46f78d,_0xd136fa){var _0x293252=_0x3c4e9b;_0x46f78d?(console[_0x293252(0x219)](_0x46f78d),console[_0x293252(0x219)](_0x293252(0x1cb))):console[_0x293252(0x219)](_0x293252(0x250));}),_0x37b155['flash'](_0x3c4e9b(0x1b0),_0x3c4e9b(0x1ad)),_0x269246[_0x3c4e9b(0x208)]('/picking_list/PDF_transfer/'+_0x1c6535[_0x3c4e9b(0x1ed)]);}catch(_0x17cc27){console['error'](_0x17cc27),_0x269246[_0x3c4e9b(0x1b2)](0x1f4)[_0x3c4e9b(0x19e)]({'error':'To\x20An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x17d8ff=>{var _0x206330=_0xa6f516;console[_0x206330(0x1c0)](_0x17d8ff),_0x269246[_0x206330(0x1b2)](0x1f4)[_0x206330(0x19e)]({'error':_0x206330(0x1a3)});});}catch(_0x319b9e){console[_0xa6f516(0x1c0)](_0x319b9e),_0x269246[_0xa6f516(0x1b2)](0x1f4)[_0xa6f516(0x19e)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x12affe(0x18a)](_0x57a36e=>{var _0x3a1417=_0x12affe;console[_0x3a1417(0x1c0)](_0x57a36e),_0x269246[_0x3a1417(0x1b2)](0x1f4)[_0x3a1417(0x19e)]({'error':_0x3a1417(0x1a3)});});}catch(_0x5dec8f){_0x269246[_0x12affe(0x19e)]({'message':_0x5dec8f['message']});}});function a0_0x4ece(){var _0x15dc6e=['FROZEN\x20GOODS','prod_name','catch','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','unit','add_transfer_finished','Chinese','prod_cat','$product_details.product_stock','<div>','filter','string','\x20</h2>','Arabic','transfer_finished','render','/CheckingWarehouse','maxPerUnit','/preview/:id','$to_warehouse','warehouse','maxProducts','json','product_code','Ambient','product_name','expiry_date','An\x20error\x20occurred.','undefined','post','date','Enabled','English','$product_details.isle','/transfer/view','from_bay','to_prod_qty','Transfer\x20Finalize\x20Successfully','to_bay','$product.from_room_name','success','Rack\x201','status','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','../public/language/languages.json','from_warehouse','$product_details.secondary_code','$product_details.bay','/transfer_finished/preview/','host','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','note','to_warehouse','<h5\x20style=\x22text-align:\x20left;\x22>','5736308Qgvnsk','error','<!DOCTYPE\x20html>','/upload/','getDate','from_room','$product_details.batch_code','$from_warehouse','forEach','finalize','from_room_name','/barcode_scanner2','Error\x20Occurs','user','map','$product_details.expiry_date','\x20Order\x20Date\x20:\x20','$product_details.rack','FGSEmail','$product_details.bin','</td>','1911129ntrUEe','Hindi','$product_details','push','$product_details.storage','logo','6WAjebY','length','</tbody>','$product.to_room_name','MaxStocks_data','/view/add_transfer','staff','from_quantity','English\x20(US)','sendMail','to_invoice','../middleware/auth','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_code3','then','/transfer_finished/view','5gRKktk','errors','_id','padStart','findOne','</head><body>','To_invoice','to_prod_level','$product_details.floorlevel','aggregate','</thead>','ToRoomAssigned','from_invoice','MaxStocks_data2','all','<span\x20style=\x22float:\x20right;\x22>','to_room','Logo.png','<tr>','invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/view/:id','<h5>','abs','7837662PglYXA','$product_details.maxProducts','slice','from_prod_level','Transfer\x20Mail','redirect','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_stock','Rack\x202','product_details','product','message','$product_details.product_name','Router','Arabic\x20(ae)','find','here1','get','back','primary_unit','</tr>','createTransport','log','</table>','split','TRFF-','save','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$name','production_date','/view','<hr\x20class=\x22my-3\x22>','DRY\x20GOODS','\x20Order\x20Number\x20:\x20','$product_details.secondary_unit','product_date','</h5>','Product\x20Transfer\x20successfully','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','floor','</span>','$product_details.product_code','Enclosed','French','$product_details.production_date','secondary_unit','$room','body','email','German','$date','language','$product_details.maxPerUnit','batch_code','edit_transfer_finished','10752560weuIYw','role','$product_details.pallet','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','findById','nodemailer','flash','$invoice','RoomAssigned','\x20<>\x20','$product_details.invoice','</div>','5887315abDzDn','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','params','from_prod_qty','$product_details.unit','to_room_name','to_quantity','538634msmExE','secondary_code','/barcode_scanner','Email\x20sent\x20successfully','Portuguese','getMonth','random','Spanish','$product_details.primary_code','New_Qty_Converted','bay','<strong>\x20Regards\x20</strong>','id_transaction','here2','/barcode_scanner3','$_id','Portuguese\x20(BR)','$product_details.level','$product_details._id','25119810WpxXIb','<tbody\x20style=\x22text-align:\x20center;\x22>','site_title','Finished\x20Goods','to_floorlevel','$product_details.type','password','primary_code','image'];a0_0x4ece=function(){return _0x15dc6e;};return a0_0x4ece();}function a0_0x3a38(_0x11e9b,_0x1297cb){var _0x4ece96=a0_0x4ece();return a0_0x3a38=function(_0x3a3851,_0x257369){_0x3a3851=_0x3a3851-0x17f;var _0x879f87=_0x4ece96[_0x3a3851];return _0x879f87;},a0_0x3a38(_0x11e9b,_0x1297cb);}function BayBinSelected(_0x384063,_0x39798f){var _0x13d2ea=a0_0x14855f,_0x38c5b8=[];let _0x1d6c8f=[];var _0x34acf5=[];if(_0x384063==_0x13d2ea(0x223)){switch(_0x39798f){case _0x13d2ea(0x1b1):_0x38c5b8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x13d2ea(0x20b):_0x38c5b8=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x34acf5=['DG'];}else{if(_0x384063==_0x13d2ea(0x188)){switch(_0x39798f){case _0x13d2ea(0x1b1):_0x38c5b8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x13d2ea(0x20b):_0x38c5b8=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x34acf5=['FG'];}}return{'levels':_0x38c5b8,'identify':_0x34acf5};}router['get']('/view/:id',auth,async(_0x590cbb,_0x1867bd)=>{var _0x30246c=a0_0x14855f;try{const {username:_0x385f04,email:_0x4115f7,role:_0x557e77}=_0x590cbb[_0x30246c(0x1cc)],_0x4b9ab6=_0x590cbb[_0x30246c(0x1cc)],_0x4885da=await profile[_0x30246c(0x1ef)]({'email':_0x4b9ab6[_0x30246c(0x233)]}),_0x220f4f=await master_shop[_0x30246c(0x212)](),_0x717ffa=await transfers_finished[_0x30246c(0x23e)](_0x590cbb[_0x30246c(0x248)]['id']);let _0x3c8383=new Date(_0x717ffa[_0x30246c(0x1a2)]),_0x418afa=('0'+_0x3c8383[_0x30246c(0x1c3)]())[_0x30246c(0x205)](-0x2),_0x620366=('0'+(_0x3c8383[_0x30246c(0x252)]()+0x1))[_0x30246c(0x205)](-0x2),_0x2412ff=_0x3c8383['getFullYear'](),_0x111d4b=_0x2412ff+'-'+_0x620366+'-'+_0x418afa,_0x597805;if(_0x4b9ab6[_0x30246c(0x23b)]==_0x30246c(0x1e0)){const _0xbb1cca=await staff[_0x30246c(0x1ef)]({'email':_0x4b9ab6[_0x30246c(0x233)]});_0x597805=await warehouse[_0x30246c(0x212)]({'status':_0x30246c(0x1a7),'name':_0xbb1cca[_0x30246c(0x19c)],'warehouse_category':'Finished\x20Goods'});}else _0x597805=await warehouse[_0x30246c(0x212)]({'status':_0x30246c(0x1a7),'warehouse_category':_0x30246c(0x182)});const _0x47e2f3=await warehouse[_0x30246c(0x1f4)]([{'$match':{'name':_0x717ffa[_0x30246c(0x1b6)],'room':_0x717ffa[_0x30246c(0x1c4)]}},{'$unwind':_0x30246c(0x1d6)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x30246c(0x20f)},'product_stock':{'$first':_0x30246c(0x190)},'bay':{'$first':_0x30246c(0x1b8)},'bin':{'$first':_0x30246c(0x1d2)},'type':{'$first':_0x30246c(0x184)},'floorlevel':{'$first':_0x30246c(0x1f3)},'primary_code':{'$first':_0x30246c(0x255)},'secondary_code':{'$first':_0x30246c(0x1b7)},'product_code':{'$first':_0x30246c(0x22c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);var _0x5693bb=[0x1,0x2,0x3,0x4],_0x3c40c7=['A','B','C','D','E','F','G','H','I','J'],_0x158a2d=[_0x30246c(0x1a0),_0x30246c(0x22d)];const _0x458c6c=await product['find']({}),_0x5d3853=BayBinSelected(_0x717ffa[_0x30246c(0x1bd)],_0x717ffa['to_room']);if(_0x220f4f[0x0]['language']=='English\x20(US)'){var _0x56d907=users[_0x30246c(0x1a8)];console[_0x30246c(0x219)](_0x56d907);}else{if(_0x220f4f[0x0][_0x30246c(0x236)]==_0x30246c(0x1d5))var _0x56d907=users[_0x30246c(0x1d5)];else{if(_0x220f4f[0x0]['language']==_0x30246c(0x234))var _0x56d907=users[_0x30246c(0x234)];else{if(_0x220f4f[0x0][_0x30246c(0x236)]==_0x30246c(0x254))var _0x56d907=users['Spanish'];else{if(_0x220f4f[0x0]['language']=='French')var _0x56d907=users['French'];else{if(_0x220f4f[0x0][_0x30246c(0x236)]==_0x30246c(0x25d))var _0x56d907=users[_0x30246c(0x251)];else{if(_0x220f4f[0x0][_0x30246c(0x236)]==_0x30246c(0x18e))var _0x56d907=users[_0x30246c(0x18e)];else{if(_0x220f4f[0x0][_0x30246c(0x236)]==_0x30246c(0x211))var _0x56d907=users[_0x30246c(0x195)];}}}}}}}_0x1867bd[_0x30246c(0x197)](_0x30246c(0x239),{'success':_0x590cbb[_0x30246c(0x240)](_0x30246c(0x1b0)),'errors':_0x590cbb[_0x30246c(0x240)](_0x30246c(0x1ec)),'role':_0x4b9ab6,'profile':_0x4885da,'master_shop':_0x220f4f,'warehouse':_0x597805,'transfer':_0x717ffa,'stock':_0x47e2f3,'unit':_0x458c6c,'language':_0x56d907,'levels':_0x5693bb,'Isle':_0x3c40c7,'rooms_data':_0x158a2d,'ed_fullDate':_0x111d4b,'dataSelected':_0x5d3853});}catch(_0x471e1f){console[_0x30246c(0x219)](_0x471e1f);}}),router[a0_0x14855f(0x1a5)](a0_0x14855f(0x200),auth,async(_0x33123e,_0x36a6b9)=>{var _0x3b4e83=a0_0x14855f;try{const _0xade9f0=_0x33123e[_0x3b4e83(0x248)]['id'];console[_0x3b4e83(0x219)](_0x33123e['body']);const _0x4abc85=await transfers_finished[_0x3b4e83(0x23e)](_0xade9f0);console['log']('transfer_data',_0x4abc85);const {date:_0x2e01d9,from_warehouse:_0xcb87d6,FromRoom_name:_0x5dbc0f,to_warehouse:_0x284dcf,ToRoom_name:_0x4d968a,prod_name:_0x2e3292,from_prod_qty:_0x1daf74,from_prod_level:_0x31c1b9,from_prod_isle:_0x3e2d17,from_prod_pallet:_0x945910,to_prod_qty:_0x507b2e,to_prod_level:_0x24b45c,to_prod_isle:_0x1ba36b,to_prod_pallet:_0x596006,primary_code:_0x630fe4,secondary_code:_0x24295e,product_code3:_0x24a515,note:_0x5354bf,invoice:_0x551c22,expiry_date:_0x20025b}=_0x33123e['body'];if(typeof _0x2e3292==_0x3b4e83(0x193))var _0x2ad305=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x189)]],_0x43a7d0=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x249)]],_0x15703c=[_0x33123e[_0x3b4e83(0x232)]['from_prod_level']],_0x5b410b=[_0x33123e['body']['to_prod_qty']],_0x406564=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x1f2)]],_0x23e43f=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x186)]],_0x1d7233=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x24e)]],_0x19e727=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x1e8)]],_0x1793e7=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x1f8)]],_0x1afbcd=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x18c)]],_0x13df9c=[_0x33123e['body'][_0x3b4e83(0x230)]],_0x278718=[_0x33123e[_0x3b4e83(0x232)]['batch_code']],_0x173fb8=[_0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x1a2)]];else var _0x2ad305=[..._0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x189)]],_0x43a7d0=[..._0x33123e['body'][_0x3b4e83(0x249)]],_0x15703c=[..._0x33123e[_0x3b4e83(0x232)]['from_prod_level']],_0x5b410b=[..._0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x1ac)]],_0x406564=[..._0x33123e[_0x3b4e83(0x232)]['to_prod_level']],_0x23e43f=[..._0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x186)]],_0x1d7233=[..._0x33123e[_0x3b4e83(0x232)]['secondary_code']],_0x19e727=[..._0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x1e8)]],_0x1793e7=[..._0x33123e['body']['MaxStocks_data2']],_0x1afbcd=[..._0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x18c)]],_0x13df9c=[..._0x33123e[_0x3b4e83(0x232)][_0x3b4e83(0x230)]],_0x278718=[..._0x33123e['body'][_0x3b4e83(0x238)]],_0x173fb8=[..._0x33123e[_0x3b4e83(0x232)]['expiry_date']];const _0x603e4f=_0x2ad305[_0x3b4e83(0x1cd)](_0x42eef7=>{return _0x42eef7={'product_name':_0x42eef7};});_0x43a7d0[_0x3b4e83(0x1c7)]((_0x5165dc,_0x1cb4d7)=>{_0x603e4f[_0x1cb4d7]['from_quantity']=_0x5165dc;}),_0x15703c['forEach']((_0x221783,_0x438037)=>{var _0x170069=_0x3b4e83;_0x603e4f[_0x438037][_0x170069(0x1ab)]=_0x221783;}),_0x5b410b[_0x3b4e83(0x1c7)]((_0xe2cba7,_0x28ad5d)=>{var _0x1cbd17=_0x3b4e83;_0x603e4f[_0x28ad5d][_0x1cbd17(0x24c)]=_0xe2cba7;}),_0x406564[_0x3b4e83(0x1c7)]((_0x342a6e,_0x59281e)=>{var _0x5566cf=_0x3b4e83;_0x603e4f[_0x59281e][_0x5566cf(0x1ae)]=_0x342a6e;}),_0x23e43f[_0x3b4e83(0x1c7)]((_0x3ac233,_0x38125f)=>{_0x603e4f[_0x38125f]['primary_code']=_0x3ac233;}),_0x1d7233[_0x3b4e83(0x1c7)]((_0xa58aa4,_0x29b94d)=>{var _0x3364d9=_0x3b4e83;_0x603e4f[_0x29b94d][_0x3364d9(0x24e)]=_0xa58aa4;}),_0x19e727[_0x3b4e83(0x1c7)]((_0x7046a2,_0x331786)=>{var _0x1d2b96=_0x3b4e83;_0x603e4f[_0x331786][_0x1d2b96(0x19f)]=_0x7046a2;}),_0x1793e7[_0x3b4e83(0x1c7)]((_0x5d089e,_0x383626)=>{var _0x32ecdd=_0x3b4e83;_0x603e4f[_0x383626][_0x32ecdd(0x19d)]=_0x5d089e;}),_0x1afbcd[_0x3b4e83(0x1c7)]((_0x3e8780,_0x32dd04)=>{var _0x1521b4=_0x3b4e83;_0x603e4f[_0x32dd04][_0x1521b4(0x18c)]=_0x3e8780;}),_0x13df9c[_0x3b4e83(0x1c7)]((_0x49fad1,_0x512bdb)=>{_0x603e4f[_0x512bdb]['secondary_unit']=_0x49fad1;}),_0x278718[_0x3b4e83(0x1c7)]((_0xc1ed1a,_0x4a75a1)=>{_0x603e4f[_0x4a75a1]['batch_code']=_0xc1ed1a;}),_0x173fb8[_0x3b4e83(0x1c7)]((_0x3732fa,_0x47f733)=>{var _0x51ded5=_0x3b4e83;_0x603e4f[_0x47f733][_0x51ded5(0x1a2)]=_0x3732fa;});const _0x43d4ef=_0x603e4f[_0x3b4e83(0x192)](_0x5a23fe=>_0x5a23fe[_0x3b4e83(0x24c)]!=='0'&&_0x5a23fe[_0x3b4e83(0x24c)]!==''||_0x5a23fe[_0x3b4e83(0x183)]!=='0'&&_0x5a23fe[_0x3b4e83(0x183)]!=='');var _0x190e99=0x0;_0x43d4ef['forEach'](_0x350fc6=>{var _0x8ec202=_0x3b4e83;parseInt(_0x350fc6[_0x8ec202(0x1e1)])<parseInt(_0x350fc6['to_quantity'])&&_0x190e99++;});if(_0x190e99!=0x0)return _0x33123e[_0x3b4e83(0x240)](_0x3b4e83(0x1ec),_0x3b4e83(0x229)),_0x36a6b9[_0x3b4e83(0x208)](_0x3b4e83(0x215));const _0x547543=await warehouse[_0x3b4e83(0x1ef)]({'name':_0x4abc85[_0x3b4e83(0x1b6)],'room':_0x4abc85[_0x3b4e83(0x1c4)]});_0x4abc85[_0x3b4e83(0x20d)][_0x3b4e83(0x1c7)](_0x4a0113=>{var _0x528775=_0x3b4e83;if(_0x4a0113['to_quantity']>0x0){const _0x53c216=_0x547543[_0x528775(0x20c)]['map'](_0x336229=>{var _0x59076a=_0x528775;_0x336229[_0x59076a(0x1a1)]==_0x4a0113['product_name']&&_0x336229[_0x59076a(0x257)]==_0x4a0113['from_bay']&&(_0x336229[_0x59076a(0x20a)]=parseInt(_0x336229['product_stock'])+parseInt(_0x4a0113[_0x59076a(0x24c)]));});}}),await _0x547543[_0x3b4e83(0x21d)]();const _0x2317b6=await warehouse['findOne']({'name':_0x4abc85[_0x3b4e83(0x1bd)],'room':_0x4abc85[_0x3b4e83(0x1fb)]});_0x4abc85[_0x3b4e83(0x20d)][_0x3b4e83(0x1c7)](_0x4cc4e2=>{var _0x4d3114=_0x3b4e83;if(_0x4cc4e2[_0x4d3114(0x24c)]>0x0){const _0x5d5407=_0x2317b6[_0x4d3114(0x20c)][_0x4d3114(0x1cd)](_0x2078ef=>{var _0x12f112=_0x4d3114;_0x2078ef[_0x12f112(0x1a1)]==_0x4cc4e2['product_name']&&_0x2078ef['bay']==_0x4cc4e2[_0x12f112(0x1ae)]&&(_0x2078ef[_0x12f112(0x20a)]=parseInt(_0x2078ef[_0x12f112(0x20a)])-parseInt(_0x4cc4e2['to_quantity']));});}}),await _0x2317b6['save'](),_0x4abc85['date']=_0x2e01d9,_0x4abc85[_0x3b4e83(0x1b6)]=_0xcb87d6,_0x4abc85[_0x3b4e83(0x1bd)]=_0x284dcf,_0x4abc85['product']=_0x43d4ef,_0x4abc85[_0x3b4e83(0x1bc)]=_0x5354bf,_0x4abc85[_0x3b4e83(0x1fe)]=_0x551c22;const _0x2809aa=await _0x4abc85['save'](),_0x3ac6be=await warehouse[_0x3b4e83(0x1ef)]({'name':_0xcb87d6,'room':_0x5dbc0f});_0x2809aa[_0x3b4e83(0x20d)][_0x3b4e83(0x1c7)](_0x1a648b=>{var _0x4ae9f0=_0x3b4e83;if(_0x1a648b[_0x4ae9f0(0x24c)]>0x0){const _0x3194a6=_0x3ac6be[_0x4ae9f0(0x20c)][_0x4ae9f0(0x1cd)](_0x52b17e=>{var _0x32198d=_0x4ae9f0;_0x52b17e[_0x32198d(0x1a1)]==_0x1a648b[_0x32198d(0x1a1)]&&_0x52b17e[_0x32198d(0x257)]==_0x1a648b[_0x32198d(0x1ab)]&&(_0x52b17e['product_stock']=parseInt(_0x52b17e[_0x32198d(0x20a)])-parseInt(_0x1a648b[_0x32198d(0x24c)]));});}}),await _0x3ac6be[_0x3b4e83(0x21d)]();const _0x3c8afa=await warehouse[_0x3b4e83(0x1ef)]({'name':_0x284dcf,'room':_0x4d968a});_0x2809aa[_0x3b4e83(0x20d)]['forEach'](_0x2ac595=>{var _0x802f95=_0x3b4e83;if(_0x2ac595[_0x802f95(0x24c)]>0x0){var _0x2c938b=0x0;const _0x354f64=_0x3c8afa['product_details'][_0x802f95(0x1cd)](_0x1282be=>{var _0x1fe3b0=_0x802f95;_0x1282be[_0x1fe3b0(0x1a1)]==_0x2ac595['product_name']&&_0x1282be[_0x1fe3b0(0x257)]==_0x2ac595[_0x1fe3b0(0x1ae)]&&(_0x1282be[_0x1fe3b0(0x20a)]=parseInt(_0x1282be[_0x1fe3b0(0x20a)])+parseInt(_0x2ac595[_0x1fe3b0(0x24c)]),_0x2c938b++);});_0x2c938b=='0'&&(_0x3c8afa[_0x802f95(0x20c)]=_0x3c8afa[_0x802f95(0x20c)][_0x802f95(0x1e6)]({'product_name':_0x2ac595[_0x802f95(0x1a1)],'product_stock':_0x2ac595['to_quantity'],'bay':_0x2ac595[_0x802f95(0x1ae)],'product_code':_0x2ac595[_0x802f95(0x19f)],'primary_code':_0x2ac595[_0x802f95(0x186)],'secondary_code':_0x2ac595[_0x802f95(0x24e)],'maxProducts':_0x2ac595[_0x802f95(0x19d)]}));}}),await _0x3c8afa[_0x3b4e83(0x21d)](),_0x33123e[_0x3b4e83(0x240)]('success','Transfer\x20Edit\x20Successfully'),_0x36a6b9[_0x3b4e83(0x208)](_0x3b4e83(0x1ea));}catch(_0x214ddf){console['log'](_0x214ddf);}}),router[a0_0x14855f(0x1a5)](a0_0x14855f(0x24f),async(_0x47b740,_0x41253f)=>{var _0x3c51dc=a0_0x14855f;const {FromWareHouse:_0x355987,FromRoom:_0x4c657b,ToWarehouse:_0x4ff81f,ToRoom:_0x2d889b,primary_code:_0x1e3140,Roomslist:_0x16bbc5}=_0x47b740[_0x3c51dc(0x232)],_0x4fb325=_0x16bbc5[_0x3c51dc(0x21b)](','),_0x501f29=[];async function _0x566ab8(_0x10e590){var _0x20e119=_0x3c51dc;const _0x398b98=await warehouse['aggregate']([{'$match':{'name':_0x355987,'room':_0x10e590}},{'$unwind':_0x20e119(0x1d6)},{'$match':{'product_details.primary_code':_0x1e3140}},{'$group':{'_id':_0x20e119(0x25f),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x20e119(0x190)},'primary_code':{'$first':_0x20e119(0x255)},'secondary_code':{'$first':_0x20e119(0x1b7)},'product_code':{'$first':_0x20e119(0x22c)},'level':{'$first':_0x20e119(0x1b8)},'isle':{'$first':_0x20e119(0x1d2)},'type':{'$first':_0x20e119(0x184)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x20e119(0x225)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x20e119(0x1ce)},'production_date':{'$first':_0x20e119(0x22f)},'batch_code':{'$first':_0x20e119(0x1c5)},'maxPerUnit':{'$first':_0x20e119(0x237)},'roomNamed':{'$first':_0x20e119(0x231)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x20e119(0x244)}}}]),_0x45aaef=await warehouse['aggregate']([{'$match':{'name':_0x355987,'room':_0x10e590}},{'$unwind':_0x20e119(0x1d6)},{'$match':{'product_details.secondary_code':_0x1e3140}},{'$group':{'_id':_0x20e119(0x25f),'name':{'$first':_0x20e119(0x20f)},'instock':{'$first':_0x20e119(0x190)},'primary_code':{'$first':_0x20e119(0x255)},'secondary_code':{'$first':_0x20e119(0x1b7)},'product_code':{'$first':_0x20e119(0x22c)},'level':{'$first':_0x20e119(0x1b8)},'isle':{'$first':_0x20e119(0x1d2)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x20e119(0x1f3)},'unit':{'$first':_0x20e119(0x24a)},'secondary_unit':{'$first':_0x20e119(0x225)},'storage':{'$first':_0x20e119(0x1d8)},'rack':{'$first':_0x20e119(0x1d0)},'expiry_date':{'$first':_0x20e119(0x1ce)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x20e119(0x1c5)},'maxPerUnit':{'$first':_0x20e119(0x237)},'roomNamed':{'$first':_0x20e119(0x231)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x20e119(0x244)}}}]);if(_0x398b98[_0x20e119(0x1db)]>0x0)_0x501f29[_0x20e119(0x1d7)](_0x398b98);else _0x45aaef[_0x20e119(0x1db)]>0x0&&_0x501f29[_0x20e119(0x1d7)](_0x45aaef);}const _0x50683e=_0x4fb325['map'](_0x46b38e=>_0x566ab8(_0x46b38e));await Promise[_0x3c51dc(0x1f9)](_0x50683e),_0x41253f[_0x3c51dc(0x19e)](_0x501f29);}),router['post'](a0_0x14855f(0x1ca),async(_0x443251,_0x4b6142)=>{var _0x114d6e=a0_0x14855f;try{const {FromWareHouse:_0x138c71,FromRoom:_0x4c93ff,ToWarehouse:_0x59ce07,ToRoom:_0x1c75d3,secondary_code:_0x5bc056}=_0x443251[_0x114d6e(0x232)],_0x3a7efd=await warehouse[_0x114d6e(0x1f4)]([{'$match':{'name':_0x138c71}},{'$unwind':_0x114d6e(0x1d6)},{'$match':{'product_details.secondary_code':_0x5bc056}},{'$group':{'_id':_0x114d6e(0x25f),'name':{'$first':_0x114d6e(0x20f)},'primary_code':{'$first':_0x114d6e(0x255)},'secondary_code':{'$first':_0x114d6e(0x1b7)},'product_code':{'$first':_0x114d6e(0x22c)},'instock':{'$first':_0x114d6e(0x190)},'warehouse':{'$first':_0x114d6e(0x21f)},'level':{'$first':_0x114d6e(0x25e)},'isle':{'$first':_0x114d6e(0x1a9)},'pallet':{'$first':_0x114d6e(0x23c)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x114d6e(0x24a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'}}}]);_0x4b6142[_0x114d6e(0x1b2)](0xc8)[_0x114d6e(0x19e)](_0x3a7efd);}catch(_0x51a4d8){_0x4b6142[_0x114d6e(0x1b2)](0x194)[_0x114d6e(0x19e)]({'message':_0x51a4d8['message']});}}),router[a0_0x14855f(0x1a5)](a0_0x14855f(0x25b),async(_0x16c7c4,_0x478656)=>{var _0x589a98=a0_0x14855f;try{const {FromWareHouse:_0x134c0c,FromRoom:_0x271924,ToWarehouse:_0x2c8972,ToRoom:_0x41bf74,product_code:_0x44f0ed}=_0x16c7c4['body'],_0x1cb2f7=await warehouse[_0x589a98(0x1f4)]([{'$match':{'name':_0x134c0c}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x44f0ed}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x589a98(0x20f)},'primary_code':{'$first':_0x589a98(0x255)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x589a98(0x22c)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0x589a98(0x21f)},'level':{'$first':_0x589a98(0x25e)},'isle':{'$first':_0x589a98(0x1a9)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x589a98(0x204)},'unit':{'$first':_0x589a98(0x24a)}}}]);_0x478656['status'](0xc8)['json'](_0x1cb2f7);}catch(_0x4ca5aa){_0x478656[_0x589a98(0x1b2)](0x194)[_0x589a98(0x19e)]({'message':_0x4ca5aa[_0x589a98(0x20e)]});}}),router[a0_0x14855f(0x1a5)](a0_0x14855f(0x198),async(_0x3489e0,_0x1808cb)=>{var _0x37a0f3=a0_0x14855f;const {productCode:_0x1d9145,bay:_0x2e9229,warehouses:_0x59c2f2,room:_0x213759}=_0x3489e0['body'];console['log'](_0x3489e0['body']);try{const _0x1fa551=await warehouse['aggregate']([{'$match':{'name':_0x59c2f2,'room':_0x213759}},{'$unwind':_0x37a0f3(0x1d6)},{'$match':{'product_details.bay':parseInt(_0x2e9229)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x37a0f3(0x190)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x37a0f3(0x204)}}}]);_0x1808cb['status'](0xc8)[_0x37a0f3(0x19e)](_0x1fa551);}catch(_0x41b8f3){_0x1808cb['status'](0x194)[_0x37a0f3(0x19e)]({'message':_0x41b8f3[_0x37a0f3(0x20e)]});}}),module['exports']=router;