var a0_0x4e2127=a0_0x4ca7;function a0_0xb7f5(){var _0x352f7f=['to_prod_qty','concat','product_code3','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.level','</body></html>','add_transfer_finished','$from_warehouse','transfer_data','$product_details.product_stock','role','To_invoice','</tr>','Transfer\x20Edit\x20Successfully','to_room','120keZDqu','</div>','$product_details.batch_code','maxPerUnit','to_invoice','post','$product_details.production_date','$product_details.invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<!DOCTYPE\x20html>','TRFF-','$name','$product_details.floorlevel','$product_details.expiry_date','exports','/../public','save','from_quantity','product_date','note','sendMail','MaxStocks_data2','8299210Frqlnh','<h2>\x20','image','express','<tr>','from_room_name','$product_details.secondary_code','$product_details.isle','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','params','930180xuJddY','from_bay','slice','DRY\x20GOODS','</thead>','Enclosed','$_id','Rack\x202','$product_details.primary_code','Portuguese\x20(BR)','padStart','from_warehouse','</td>','updateOne','True','$product_details.bin','$product_details.storage','New_Qty_Converted','<html><head><title></title>','language','getFullYear','errors','password','to_warehouse','FGSEmail','/CheckingWarehouse','FROZEN\x20GOODS','$to_warehouse','RoomAssigned','An\x20error\x20occurred.','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','findById','from_prod_qty','to_prod_level','production_date','findOne','filter','catch','QA\x20Warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','16eRZEXZ','edit_transfer_finished_view','unit','to_quantity','error','22996tycaej','to_bay','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/view/:id','map','from_room','from_invoice','log','product_name','<span\x20style=\x22float:\x20right;\x22>','date','$product_details.bay','secondary_code','message','$product.to_room_name','Portuguese','invoice','English','product_details','/upload/','Arabic\x20(ae)','Finished\x20Goods','$product.from_room_name','38hpMgtC','status','back','156573hGpgMm','product','\x20Order\x20Date\x20:\x20','/barcode_scanner2','user','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','warehouse','Hindi','</tbody>','_id','</head><body>','818946bUmdOq','/transfer/view','Product\x20Transfer\x20successfully','English\x20(US)','$product_details.maxPerUnit','$room','createTransport','secondary_unit','then','/barcode_scanner','35078857zCjJcy','from_prod_level','Enabled','Logo.png','push','$product_details.type','string','<table\x20style=\x22width:\x20100%\x20!important;\x22>','../middleware/auth','$product_details.pallet','Router','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_cat','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','Ambient','/barcode_scanner3','getDate','Error\x20Occurs','$product_details._id','success','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h5>','<div>','port','$product_details.secondary_unit','staff','transfer_finished','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Arabic','</h5>','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','primary_code','French','expiry_date','</table>','German','to_floorlevel','\x20</h2>','<h5\x20style=\x22text-align:\x20left;\x22>','$finalize','/view/add_transfer','aggregate','render','body','/preview/:id','$product_details.product_code','$product_details.rack','get','flash','to_room_name','688947xPKQkx','$date','$invoice','Spanish','MaxStocks_data','/picking_list/PDF_transfer/','5lBuVAb','Chinese','$product_details','maxProducts','prod_name','product_stock','split','length','ToRoomAssigned','bay','$product_details.product_name','Transfer\x20Finalize\x20Successfully','batch_code','$product_details.unit','find','Email\x20sent\x20successfully','product_code','json','nodemailer','site_title','/transfer_finished/view','primary_unit','$product_details.maxProducts','forEach'];a0_0xb7f5=function(){return _0x352f7f;};return a0_0xb7f5();}(function(_0x115f77,_0x30e30a){var _0x57acab=a0_0x4ca7,_0x5045d3=_0x115f77();while(!![]){try{var _0x308c88=parseInt(_0x57acab(0x15c))/0x1*(-parseInt(_0x57acab(0x174))/0x2)+-parseInt(_0x57acab(0x177))/0x3*(parseInt(_0x57acab(0x1ee))/0x4)+parseInt(_0x57acab(0x1c7))/0x5*(parseInt(_0x57acab(0x12f))/0x6)+parseInt(_0x57acab(0x1c1))/0x7+-parseInt(_0x57acab(0x157))/0x8*(-parseInt(_0x57acab(0x182))/0x9)+-parseInt(_0x57acab(0x204))/0xa+parseInt(_0x57acab(0x18c))/0xb;if(_0x308c88===_0x30e30a)break;else _0x5045d3['push'](_0x5045d3['shift']());}catch(_0x4477b4){_0x5045d3['push'](_0x5045d3['shift']());}}}(a0_0xb7f5,0xc152b));const express=require(a0_0x4e2127(0x127)),app=express(),router=express[a0_0x4e2127(0x196)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x4e2127(0x194)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x4e2127(0x1d9));function a0_0x4ca7(_0x2f6b16,_0x13cc11){var _0xb7f5b8=a0_0xb7f5();return a0_0x4ca7=function(_0x4ca7d1,_0x5eb250){_0x4ca7d1=_0x4ca7d1-0x126;var _0x36475e=_0xb7f5b8[_0x4ca7d1];return _0x36475e;},a0_0x4ca7(_0x2f6b16,_0x13cc11);}router[a0_0x4e2127(0x1be)]('/view',auth,async(_0x1c81dc,_0x5de09e)=>{var _0xb886f4=a0_0x4e2127;try{const {username:_0x122ab5,email:_0x32252c,role:_0x3d270f}=_0x1c81dc[_0xb886f4(0x17b)],_0x3ee06f=_0x1c81dc[_0xb886f4(0x17b)],_0xf69b56=await profile[_0xb886f4(0x152)]({'email':_0x3ee06f[_0xb886f4(0x197)]}),_0x215df1=await master_shop[_0xb886f4(0x1d5)]();let _0xa8e9f2;if(_0x3ee06f[_0xb886f4(0x1e9)]==_0xb886f4(0x1a7)){const _0x2be6b1=await staff[_0xb886f4(0x152)]({'email':_0x3ee06f[_0xb886f4(0x197)]});_0xa8e9f2=await transfers_finished['find']({'from_warehouse':_0x2be6b1['warehouse']});}else _0xa8e9f2=await transfers_finished[_0xb886f4(0x1b8)]([{'$unwind':'$product'},{'$group':{'_id':_0xb886f4(0x135),'invoice':{'$first':_0xb886f4(0x1c3)},'date':{'$first':_0xb886f4(0x1c2)},'from_warehouse':{'$first':_0xb886f4(0x1e6)},'to_warehouse':{'$first':_0xb886f4(0x14a)},'from_room_name':{'$addToSet':_0xb886f4(0x173)},'to_room_name':{'$addToSet':_0xb886f4(0x16b)},'finalize':{'$first':_0xb886f4(0x1b6)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x215df1[0x0][_0xb886f4(0x142)]=='English\x20(US)')var _0x1639af=users[_0xb886f4(0x16e)];else{if(_0x215df1[0x0][_0xb886f4(0x142)]==_0xb886f4(0x17e))var _0x1639af=users['Hindi'];else{if(_0x215df1[0x0][_0xb886f4(0x142)]=='German')var _0x1639af=users['German'];else{if(_0x215df1[0x0][_0xb886f4(0x142)]==_0xb886f4(0x1c4))var _0x1639af=users[_0xb886f4(0x1c4)];else{if(_0x215df1[0x0][_0xb886f4(0x142)]==_0xb886f4(0x1af))var _0x1639af=users['French'];else{if(_0x215df1[0x0][_0xb886f4(0x142)]==_0xb886f4(0x138))var _0x1639af=users[_0xb886f4(0x16c)];else{if(_0x215df1[0x0][_0xb886f4(0x142)]=='Chinese')var _0x1639af=users['Chinese'];else{if(_0x215df1[0x0][_0xb886f4(0x142)]==_0xb886f4(0x171))var _0x1639af=users['Arabic'];}}}}}}}_0x5de09e['render'](_0xb886f4(0x1a8),{'success':_0x1c81dc[_0xb886f4(0x1bf)](_0xb886f4(0x1a0)),'errors':_0x1c81dc[_0xb886f4(0x1bf)](_0xb886f4(0x144)),'role':_0x3ee06f,'profile':_0xf69b56,'master_shop':_0x215df1,'transfer':_0xa8e9f2,'language':_0x1639af});}catch(_0x1ee743){console[_0xb886f4(0x164)](_0x1ee743);}});async function getRandom8DigitNumber(){var _0x586369=a0_0x4e2127;const _0x4649ad=0x989680,_0x243b47=0x5f5e0ff,_0x4bee75=Math['floor'](Math['random']()*(_0x243b47-_0x4649ad+0x1))+_0x4649ad;var _0x2eeed4;const _0x5e1918=await transfers_finished[_0x586369(0x152)]({'invoice':_0x586369(0x1f8)+_0x4bee75});return _0x5e1918&&_0x5e1918['length']>0x0?_0x2eeed4='TRFF-'+_0x4bee75:_0x2eeed4=_0x586369(0x1f8)+_0x4bee75,_0x2eeed4;}router[a0_0x4e2127(0x1be)](a0_0x4e2127(0x1b7),auth,async(_0x93471c,_0x33c707)=>{var _0x3f12b4=a0_0x4e2127;try{const {username:_0x4f2768,email:_0x456d7d,role:_0xeaa07a}=_0x93471c[_0x3f12b4(0x17b)],_0x106f9b=_0x93471c['user'],_0x56f43f=await profile[_0x3f12b4(0x152)]({'email':_0x106f9b[_0x3f12b4(0x197)]}),_0x829dcf=await master_shop[_0x3f12b4(0x1d5)]();let _0x941537;if(_0x106f9b[_0x3f12b4(0x1e9)]==_0x3f12b4(0x1a7)){const _0x2fae47=await staff[_0x3f12b4(0x152)]({'email':_0x106f9b[_0x3f12b4(0x197)]});_0x941537=await warehouse['aggregate']([{'$match':{'status':_0x3f12b4(0x18e),'name':_0x2fae47[_0x3f12b4(0x17d)],'warehouse_category':_0x3f12b4(0x172),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x3f12b4(0x1f9),'name':{'$first':_0x3f12b4(0x1f9)}}}]);}else _0x941537=await warehouse[_0x3f12b4(0x1b8)]([{'$match':{'status':_0x3f12b4(0x18e),'warehouse_category':_0x3f12b4(0x172),'name':{'$ne':_0x3f12b4(0x155)}}},{'$group':{'_id':_0x3f12b4(0x1f9),'name':{'$first':'$name'}}}]);const _0x41dd88=await transfers_finished[_0x3f12b4(0x1d5)]({}),_0x560f10=_0x41dd88['length']+0x1,_0x46f642=_0x3f12b4(0x1f8)+_0x560f10[_0x3f12b4(0x1ac)]()[_0x3f12b4(0x139)](0x5,'0');if(_0x829dcf[0x0]['language']==_0x3f12b4(0x185))var _0x108aa8=users[_0x3f12b4(0x16e)];else{if(_0x829dcf[0x0]['language']==_0x3f12b4(0x17e))var _0x108aa8=users[_0x3f12b4(0x17e)];else{if(_0x829dcf[0x0][_0x3f12b4(0x142)]=='German')var _0x108aa8=users[_0x3f12b4(0x1b2)];else{if(_0x829dcf[0x0][_0x3f12b4(0x142)]==_0x3f12b4(0x1c4))var _0x108aa8=users[_0x3f12b4(0x1c4)];else{if(_0x829dcf[0x0][_0x3f12b4(0x142)]==_0x3f12b4(0x1af))var _0x108aa8=users['French'];else{if(_0x829dcf[0x0][_0x3f12b4(0x142)]==_0x3f12b4(0x138))var _0x108aa8=users[_0x3f12b4(0x16c)];else{if(_0x829dcf[0x0][_0x3f12b4(0x142)]==_0x3f12b4(0x1c8))var _0x108aa8=users[_0x3f12b4(0x1c8)];else{if(_0x829dcf[0x0]['language']==_0x3f12b4(0x171))var _0x108aa8=users[_0x3f12b4(0x1aa)];}}}}}}}const _0x5de33a=getRandom8DigitNumber();_0x5de33a[_0x3f12b4(0x18a)](_0x127520=>{var _0x1a32cc=_0x3f12b4;_0x33c707['render'](_0x1a32cc(0x1e5),{'success':_0x93471c['flash']('success'),'errors':_0x93471c['flash']('errors'),'role':_0x106f9b,'profile':_0x56f43f,'master_shop':_0x829dcf,'warehouse':_0x941537,'language':_0x108aa8,'invoice':_0x127520});})[_0x3f12b4(0x154)](_0x45eb26=>{var _0x4e4a16=_0x3f12b4;_0x93471c['flash'](_0x4e4a16(0x144),_0x4e4a16(0x1a1)),_0x33c707['redirect'](_0x4e4a16(0x183));});}catch(_0x5ee9e3){console[_0x3f12b4(0x164)](_0x5ee9e3);}}),router['post'](a0_0x4e2127(0x1b7),auth,async(_0x53475a,_0x4b36b9)=>{var _0x539d40=a0_0x4e2127;try{const {date:_0x24cf39,from_warehouse:_0x28aff8,FromRoom_name:_0x282018,to_warehouse:_0x3543e9,ToRoom_name:_0x42d6e3,prod_name:_0x3591fb,from_prod_qty:_0xb57af3,from_prod_level:_0x2b9d0b,from_prod_isle:_0x3f0ca1,from_prod_pallet:_0x1a536c,to_prod_qty:_0xe0ccbb,to_prod_level:_0x11d96a,to_prod_isle:_0xbee6c7,to_prod_pallet:_0x139328,primary_code:_0x1b8291,secondary_code:_0x3e7260,product_code3:_0x5f5863,note:_0x104a1a,MaxStocks_data2:_0x1febca,invoice:_0x41d6de,expiry_date:_0x44b6b6}=_0x53475a['body'];if(typeof _0x3591fb==_0x539d40(0x192))var _0x4a8190=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1cb)]],_0x375ea6=[_0x53475a['body']['from_prod_qty']],_0x501919=[_0x53475a['body'][_0x539d40(0x18d)]],_0x1ce6d7=[_0x53475a[_0x539d40(0x1ba)]['New_Qty_Converted']],_0x499aee=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x150)]],_0x10f74f=[_0x53475a['body'][_0x539d40(0x1ae)]],_0x417390=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x169)]],_0x51be7a=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1e1)]],_0x3363f7=[_0x53475a['body'][_0x539d40(0x203)]],_0x3c44db=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1dc)]],_0x520924=[_0x53475a['body'][_0x539d40(0x189)]],_0x5a508d=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1d3)]],_0xf1ffc4=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1b0)]],_0x18246d=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x200)]],_0x5dab1c=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1c5)]],_0x4e0c18=[_0x53475a[_0x539d40(0x1ba)]['maxPerUnit']],_0xb15dfb=[_0x53475a['body'][_0x539d40(0x199)]],_0x52fd6c=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x14b)]],_0x3cf45e=[_0x53475a['body'][_0x539d40(0x1cf)]],_0x186335=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x163)]],_0x5289d8=[_0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1f2)]];else var _0x4a8190=[..._0x53475a[_0x539d40(0x1ba)]['prod_name']],_0x375ea6=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x14f)]],_0x501919=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x18d)]],_0x1ce6d7=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x140)]],_0x499aee=[..._0x53475a['body'][_0x539d40(0x150)]],_0x10f74f=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1ae)]],_0x417390=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x169)]],_0x51be7a=[..._0x53475a['body'][_0x539d40(0x1e1)]],_0x3363f7=[..._0x53475a[_0x539d40(0x1ba)]['MaxStocks_data2']],_0x3c44db=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1dc)]],_0x520924=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x189)]],_0x5a508d=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1d3)]],_0xf1ffc4=[..._0x53475a['body']['expiry_date']],_0x18246d=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x200)]],_0x5dab1c=[..._0x53475a['body'][_0x539d40(0x1c5)]],_0x4e0c18=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1f1)]],_0xb15dfb=[..._0x53475a['body'][_0x539d40(0x199)]],_0x52fd6c=[..._0x53475a['body'][_0x539d40(0x14b)]],_0x3cf45e=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1cf)]],_0x186335=[..._0x53475a['body'][_0x539d40(0x163)]],_0x5289d8=[..._0x53475a[_0x539d40(0x1ba)][_0x539d40(0x1f2)]];const _0x487c9a=_0x4a8190[_0x539d40(0x161)](_0x43b57f=>{return _0x43b57f={'product_name':_0x43b57f};});_0x375ea6['forEach']((_0x354cf3,_0x18df56)=>{_0x487c9a[_0x18df56]['from_quantity']=_0x354cf3;}),_0x501919[_0x539d40(0x1de)]((_0x457836,_0x4fe614)=>{_0x487c9a[_0x4fe614]['from_bay']=_0x457836;}),_0x186335[_0x539d40(0x1de)]((_0x598e55,_0x5c0bd1)=>{var _0x16d219=_0x539d40;_0x487c9a[_0x5c0bd1][_0x16d219(0x163)]=_0x598e55;}),_0x5289d8[_0x539d40(0x1de)]((_0x3db7fe,_0x311e16)=>{_0x487c9a[_0x311e16]['To_invoice']=_0x3db7fe;}),_0x1ce6d7[_0x539d40(0x1de)]((_0x5d7e27,_0x4a8eb7)=>{var _0x172eba=_0x539d40;_0x487c9a[_0x4a8eb7][_0x172eba(0x15a)]=_0x5d7e27;}),_0x499aee[_0x539d40(0x1de)]((_0x187582,_0x157060)=>{var _0x1b40e7=_0x539d40;_0x487c9a[_0x157060][_0x1b40e7(0x15d)]=_0x187582;}),_0x10f74f[_0x539d40(0x1de)]((_0x4ccb84,_0x19d4a5)=>{var _0x3485cb=_0x539d40;_0x487c9a[_0x19d4a5][_0x3485cb(0x1ae)]=_0x4ccb84;}),_0x417390[_0x539d40(0x1de)]((_0x24c7ea,_0x539344)=>{_0x487c9a[_0x539344]['secondary_code']=_0x24c7ea;}),_0x51be7a[_0x539d40(0x1de)]((_0x2916a4,_0x3a762c)=>{_0x487c9a[_0x3a762c]['product_code']=_0x2916a4;}),_0x3363f7[_0x539d40(0x1de)]((_0x194a61,_0x26fd5f)=>{var _0x2b6436=_0x539d40;_0x487c9a[_0x26fd5f][_0x2b6436(0x1ca)]=_0x194a61;}),_0x3c44db['forEach']((_0x1260c8,_0x2a6862)=>{var _0x511937=_0x539d40;_0x487c9a[_0x2a6862][_0x511937(0x159)]=_0x1260c8;}),_0x520924[_0x539d40(0x1de)]((_0x23550d,_0x1279b8)=>{var _0x3d18b7=_0x539d40;_0x487c9a[_0x1279b8][_0x3d18b7(0x189)]=_0x23550d;}),_0x5a508d['forEach']((_0x4ebab2,_0x3fb8ea)=>{var _0x149666=_0x539d40;_0x487c9a[_0x3fb8ea][_0x149666(0x1d3)]=_0x4ebab2;}),_0xf1ffc4[_0x539d40(0x1de)]((_0x4cc2c6,_0x58feea)=>{var _0x24e550=_0x539d40;_0x487c9a[_0x58feea][_0x24e550(0x1b0)]=_0x4cc2c6;}),_0x18246d[_0x539d40(0x1de)]((_0x4efec4,_0x3f30ed)=>{var _0x519324=_0x539d40;_0x487c9a[_0x3f30ed][_0x519324(0x151)]=_0x4efec4;}),_0x5dab1c['forEach']((_0x5f2670,_0x435534)=>{var _0x1adaad=_0x539d40;_0x487c9a[_0x435534][_0x1adaad(0x1ca)]=_0x5f2670;}),_0x4e0c18[_0x539d40(0x1de)]((_0x2a5dc9,_0x5f1392)=>{var _0x35041b=_0x539d40;_0x487c9a[_0x5f1392][_0x35041b(0x1f1)]=_0x2a5dc9;}),_0xb15dfb[_0x539d40(0x1de)]((_0x1f5b6e,_0x4d77cc)=>{_0x487c9a[_0x4d77cc]['prod_cat']=_0x1f5b6e;}),_0x52fd6c[_0x539d40(0x1de)]((_0x53a0c5,_0x42c316)=>{var _0xf55468=_0x539d40;_0x487c9a[_0x42c316][_0xf55468(0x129)]=_0x53a0c5;}),_0x3cf45e[_0x539d40(0x1de)]((_0xb492ac,_0x2a6a82)=>{var _0x2eb5e4=_0x539d40;_0x487c9a[_0x2a6a82][_0x2eb5e4(0x1c0)]=_0xb492ac;});const _0x54c625=_0x487c9a['filter'](_0x5ad8ff=>_0x5ad8ff[_0x539d40(0x15a)]!=='0'&&_0x5ad8ff[_0x539d40(0x15a)]!==''||_0x5ad8ff[_0x539d40(0x1b3)]!=='0'&&_0x5ad8ff[_0x539d40(0x1b3)]!=='');var _0x4b2b99=0x0;_0x54c625[_0x539d40(0x1de)](_0x1b7d06=>{var _0x384a13=_0x539d40;parseInt(_0x1b7d06[_0x384a13(0x1ff)])<parseInt(_0x1b7d06[_0x384a13(0x15a)])&&_0x4b2b99++;});if(_0x4b2b99!=0x0)return _0x53475a[_0x539d40(0x1bf)](_0x539d40(0x144),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x4b36b9[_0x539d40(0x12c)]('back');const _0x376d9f=new transfers_finished({'date':_0x24cf39,'from_warehouse':_0x28aff8,'to_warehouse':_0x3543e9,'product':_0x54c625,'note':_0x104a1a,'invoice':_0x41d6de}),_0x26a314=await _0x376d9f[_0x539d40(0x1fe)]();_0x53475a[_0x539d40(0x1bf)](_0x539d40(0x1a0),_0x539d40(0x184)),_0x4b36b9[_0x539d40(0x12c)]('/transfer_finished/preview/'+_0x26a314[_0x539d40(0x180)]);}catch(_0x54b805){console['log'](_0x54b805),_0x4b36b9[_0x539d40(0x175)](0xc8)[_0x539d40(0x1d8)]({'errorMessage':_0x54b805[_0x539d40(0x16a)]});}}),router[a0_0x4e2127(0x1be)](a0_0x4e2127(0x1bb),auth,async(_0x56b6a5,_0x2a7c7f)=>{var _0x1e8617=a0_0x4e2127;try{const {username:_0x234ae9,email:_0x540d4d,role:_0x2049ee}=_0x56b6a5['user'],_0x4efbc0=_0x56b6a5['user'],_0x435adb=await profile['findOne']({'email':_0x4efbc0[_0x1e8617(0x197)]}),_0x1ce1f9=await master_shop['find'](),_0xdc20f0=await transfers_finished[_0x1e8617(0x14e)](_0x56b6a5[_0x1e8617(0x12e)]['id']);let _0x1cc534;if(_0x4efbc0[_0x1e8617(0x1e9)]==_0x1e8617(0x1a7)){const _0x55c442=await staff['findOne']({'email':_0x4efbc0[_0x1e8617(0x197)]});_0x1cc534=await warehouse['find']({'status':_0x1e8617(0x18e),'name':_0x55c442[_0x1e8617(0x17d)],'warehouse_category':'Finished\x20Goods'});}else _0x1cc534=await warehouse[_0x1e8617(0x1d5)]({'status':_0x1e8617(0x18e),'warehouse_category':_0x1e8617(0x172)});const _0x33034b=await warehouse['aggregate']([{'$match':{'name':_0xdc20f0[_0x1e8617(0x13a)],'warehouse_category':_0x1e8617(0x172)}},{'$unwind':_0x1e8617(0x1c9)},{'$group':{'_id':_0x1e8617(0x19f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1e8617(0x1e8)},'bay':{'$first':_0x1e8617(0x168)},'bin':{'$first':_0x1e8617(0x13e)},'type':{'$first':_0x1e8617(0x191)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1e8617(0x137)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1e8617(0x1bc)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1e8617(0x1bd)},'expiry_date':{'$first':_0x1e8617(0x1fb)},'production_date':{'$first':_0x1e8617(0x1f4)},'room':{'$first':_0x1e8617(0x187)},'warehoue_name':{'$first':'$name'}}}]),_0xf01f4f=await product[_0x1e8617(0x1d5)]({});if(_0x1ce1f9[0x0]['language']==_0x1e8617(0x185)){var _0x501780=users[_0x1e8617(0x16e)];console[_0x1e8617(0x164)](_0x501780);}else{if(_0x1ce1f9[0x0][_0x1e8617(0x142)]==_0x1e8617(0x17e))var _0x501780=users[_0x1e8617(0x17e)];else{if(_0x1ce1f9[0x0]['language']==_0x1e8617(0x1b2))var _0x501780=users[_0x1e8617(0x1b2)];else{if(_0x1ce1f9[0x0][_0x1e8617(0x142)]=='Spanish')var _0x501780=users[_0x1e8617(0x1c4)];else{if(_0x1ce1f9[0x0][_0x1e8617(0x142)]=='French')var _0x501780=users[_0x1e8617(0x1af)];else{if(_0x1ce1f9[0x0][_0x1e8617(0x142)]==_0x1e8617(0x138))var _0x501780=users['Portuguese'];else{if(_0x1ce1f9[0x0][_0x1e8617(0x142)]==_0x1e8617(0x1c8))var _0x501780=users[_0x1e8617(0x1c8)];else{if(_0x1ce1f9[0x0][_0x1e8617(0x142)]==_0x1e8617(0x171))var _0x501780=users['Arabic'];}}}}}}}_0x2a7c7f[_0x1e8617(0x1b9)](_0x1e8617(0x158),{'success':_0x56b6a5[_0x1e8617(0x1bf)]('success'),'errors':_0x56b6a5[_0x1e8617(0x1bf)](_0x1e8617(0x144)),'role':_0x4efbc0,'profile':_0x435adb,'master_shop':_0x1ce1f9,'warehouse':_0x1cc534,'transfer':_0xdc20f0,'stock':_0x33034b,'unit':_0xf01f4f,'language':_0x501780});}catch(_0x1cdc8e){console[_0x1e8617(0x164)](_0x1cdc8e);}}),router[a0_0x4e2127(0x1f3)]('/preview/:id',auth,async(_0x56e468,_0x22c349)=>{var _0x6c9ae4=a0_0x4e2127;try{const {invoice:_0x434c03,from_warehouse:_0x44c0a6,FromRoom_name:_0x166812,to_warehouse:_0x44554d,ToRoom_name:_0xbecc29}=_0x56e468[_0x6c9ae4(0x1ba)],_0x26fc25=await transfers_finished[_0x6c9ae4(0x14e)](_0x56e468['params']['id']),_0x1e1cb9=_0x26fc25['product'][_0x6c9ae4(0x161)](async _0x18a373=>{var _0x39d0e2=_0x6c9ae4;if(_0x18a373['to_quantity']>0x0){var _0x212b7e=await warehouse[_0x39d0e2(0x152)]({'name':_0x44c0a6,'room':_0x18a373[_0x39d0e2(0x129)],'warehouse_category':'Finished\x20Goods'});const _0x54cf03=_0x212b7e[_0x39d0e2(0x16f)][_0x39d0e2(0x161)](_0x516db2=>{var _0x5ad0cf=_0x39d0e2;_0x516db2[_0x5ad0cf(0x165)]==_0x18a373[_0x5ad0cf(0x165)]&&_0x516db2['bay']==_0x18a373[_0x5ad0cf(0x130)]&&_0x516db2[_0x5ad0cf(0x1b0)]==_0x18a373[_0x5ad0cf(0x1b0)]&&_0x516db2['production_date']==_0x18a373[_0x5ad0cf(0x151)]&&_0x516db2[_0x5ad0cf(0x1d3)]==_0x18a373[_0x5ad0cf(0x1d3)]&&_0x516db2[_0x5ad0cf(0x16d)]==_0x18a373['from_invoice']&&(_0x516db2['product_stock']=_0x516db2['product_stock']-_0x18a373[_0x5ad0cf(0x15a)]);});}return _0x212b7e;});Promise[_0x6c9ae4(0x15e)](_0x1e1cb9)['then'](async _0x4f4385=>{var _0x44d592=_0x6c9ae4;try{for(const _0x4b22d9 of _0x4f4385){await _0x4b22d9[_0x44d592(0x1fe)]();}const _0x35915d=_0x26fc25[_0x44d592(0x178)][_0x44d592(0x161)](async _0x2690ab=>{var _0x35cfab=_0x44d592,_0x57d6a8=await warehouse[_0x35cfab(0x152)]({'name':_0x44554d,'room':_0x2690ab[_0x35cfab(0x1c0)]});if(_0x2690ab[_0x35cfab(0x15a)]>0x0){var _0xb3dd3b=0x0;const _0x59e9fa=_0x57d6a8[_0x35cfab(0x16f)][_0x35cfab(0x161)](_0x5f30ae=>{var _0x1b5931=_0x35cfab;_0x5f30ae[_0x1b5931(0x165)]==_0x2690ab[_0x1b5931(0x165)]&&_0x5f30ae['bay']==_0x2690ab[_0x1b5931(0x15d)]&&_0x5f30ae['expiry_date']==_0x2690ab[_0x1b5931(0x1b0)]&&_0x5f30ae[_0x1b5931(0x151)]==_0x2690ab[_0x1b5931(0x151)]&&_0x5f30ae[_0x1b5931(0x1d3)]==_0x2690ab['batch_code']&&_0x5f30ae['invoice']==_0x2690ab[_0x1b5931(0x1ea)]&&(_0x5f30ae['product_stock']=_0x5f30ae['product_stock']+_0x2690ab[_0x1b5931(0x15a)],_0xb3dd3b++);});_0xb3dd3b=='0'&&(_0x57d6a8[_0x35cfab(0x16f)]=_0x57d6a8[_0x35cfab(0x16f)]['concat']({'product_name':_0x2690ab[_0x35cfab(0x165)],'product_stock':_0x2690ab['to_quantity'],'bay':_0x2690ab[_0x35cfab(0x15d)],'product_code':_0x2690ab[_0x35cfab(0x1d7)],'primary_code':_0x2690ab[_0x35cfab(0x1ae)],'secondary_code':_0x2690ab[_0x35cfab(0x169)],'expiry_date':_0x2690ab[_0x35cfab(0x1b0)],'production_date':_0x2690ab[_0x35cfab(0x151)],'maxProducts':_0x2690ab[_0x35cfab(0x1ca)],'batch_code':_0x2690ab['batch_code'],'secondary_unit':_0x2690ab[_0x35cfab(0x189)],'unit':_0x2690ab['unit'],'maxProducts':_0x2690ab[_0x35cfab(0x1ca)],'maxPerUnit':_0x2690ab['maxPerUnit'],'invoice':_0x2690ab[_0x35cfab(0x1ea)]}));}return _0x57d6a8;});Promise['all'](_0x35915d)[_0x44d592(0x18a)](async _0xd4eb9b=>{var _0x205acf=_0x44d592;try{for(const _0x39f01c of _0xd4eb9b){await warehouse[_0x205acf(0x13c)]({'_id':_0x39f01c[_0x205acf(0x180)]},{'$addToSet':{'product_details':{'$each':_0x39f01c[_0x205acf(0x16f)]}}});}_0x26fc25['finalize']=_0x205acf(0x13d);const _0x1ccc35=await _0x26fc25[_0x205acf(0x1fe)](),_0x121e5b=await master_shop[_0x205acf(0x1d5)](),_0xf696bf=await email_settings['findOne'](),_0x571761=await supervisor_settings[_0x205acf(0x1d5)]();var _0x4fcec2=_0x26fc25[_0x205acf(0x178)],_0x574166='',_0x3dcbd2;for(_0x3dcbd2 in _0x4fcec2){var _0x4a5fc4='FG';_0x26fc25['to_warehouse']==_0x205acf(0x132)&&(_0x4a5fc4='DG'),_0x574166+=_0x205acf(0x128)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fcec2[_0x3dcbd2][_0x205acf(0x165)]+_0x205acf(0x13b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fcec2[_0x3dcbd2][_0x205acf(0x1d7)]+_0x205acf(0x13b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fcec2[_0x3dcbd2]['to_quantity']+_0x205acf(0x13b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fcec2[_0x3dcbd2]['unit']+_0x205acf(0x13b)+_0x205acf(0x1a2)+_0x4fcec2[_0x3dcbd2][_0x205acf(0x189)]+_0x205acf(0x13b)+_0x205acf(0x1a2)+_0x26fc25[_0x205acf(0x146)]+'</td>'+_0x205acf(0x1a2)+_0x4fcec2[_0x3dcbd2][_0x205acf(0x1c0)]+_0x205acf(0x13b)+_0x205acf(0x1a2)+_0x4a5fc4+_0x4fcec2[_0x3dcbd2][_0x205acf(0x15d)]+_0x205acf(0x13b)+_0x205acf(0x1eb);}let _0xb3334=nodemailer[_0x205acf(0x188)]({'host':_0xf696bf['host'],'port':Number(_0xf696bf[_0x205acf(0x1a5)]),'secure':![],'auth':{'user':_0xf696bf[_0x205acf(0x197)],'pass':_0xf696bf[_0x205acf(0x145)]}}),_0x324de6={'from':_0xf696bf[_0x205acf(0x197)],'to':_0x571761[0x0][_0x205acf(0x147)],'subject':'Transfer\x20Mail','attachments':[{'filename':_0x205acf(0x18f),'path':__dirname+_0x205acf(0x1fd)+_0x205acf(0x170)+_0x121e5b[0x0][_0x205acf(0x126)],'cid':'logo'}],'html':_0x205acf(0x1f7)+_0x205acf(0x141)+_0x205acf(0x181)+_0x205acf(0x1a4)+_0x205acf(0x1a9)+_0x205acf(0x1a4)+_0x205acf(0x17c)+'</div>'+'<div>'+_0x205acf(0x205)+_0x121e5b[0x0][_0x205acf(0x1da)]+_0x205acf(0x1b4)+_0x205acf(0x1ef)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x205acf(0x1a4)+_0x205acf(0x1b5)+'\x20Order\x20Number\x20:\x20'+_0x26fc25[_0x205acf(0x16d)]+'\x20'+_0x205acf(0x166)+_0x205acf(0x179)+_0x26fc25[_0x205acf(0x167)]+'\x20'+'</span>'+_0x205acf(0x1ab)+'</div>'+_0x205acf(0x193)+_0x205acf(0x14d)+_0x205acf(0x128)+_0x205acf(0x198)+_0x205acf(0x156)+_0x205acf(0x15f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x205acf(0x1ad)+_0x205acf(0x12d)+_0x205acf(0x1f6)+_0x205acf(0x1eb)+_0x205acf(0x133)+_0x205acf(0x1e2)+'\x20'+_0x574166+'\x20'+_0x205acf(0x17f)+_0x205acf(0x1b1)+_0x205acf(0x1a4)+'<strong>\x20Regards\x20</strong>'+_0x205acf(0x1a3)+_0x121e5b[0x0][_0x205acf(0x1da)]+_0x205acf(0x1ab)+_0x205acf(0x1ef)+_0x205acf(0x1ef)+_0x205acf(0x1e4)};_0xb3334[_0x205acf(0x202)](_0x324de6,function(_0x5e0897,_0x43d5e5){var _0x572bad=_0x205acf;_0x5e0897?(console[_0x572bad(0x164)](_0x5e0897),console[_0x572bad(0x164)](_0x572bad(0x19e))):console['log'](_0x572bad(0x1d6));}),_0x56e468[_0x205acf(0x1bf)](_0x205acf(0x1a0),_0x205acf(0x1d2)),_0x22c349[_0x205acf(0x12c)](_0x205acf(0x1c6)+_0x1ccc35[_0x205acf(0x180)]);}catch(_0x5bdb24){console[_0x205acf(0x15b)](_0x5bdb24),_0x22c349[_0x205acf(0x175)](0x1f4)[_0x205acf(0x1d8)]({'error':_0x205acf(0x19a)});}})['catch'](_0x58b780=>{var _0x1e039a=_0x44d592;console[_0x1e039a(0x15b)](_0x58b780),_0x22c349[_0x1e039a(0x175)](0x1f4)[_0x1e039a(0x1d8)]({'error':_0x1e039a(0x14c)});});}catch(_0xd439aa){console[_0x44d592(0x15b)](_0xd439aa),_0x22c349[_0x44d592(0x175)](0x1f4)[_0x44d592(0x1d8)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x6c9ae4(0x154)](_0x377772=>{var _0x550a8c=_0x6c9ae4;console[_0x550a8c(0x15b)](_0x377772),_0x22c349[_0x550a8c(0x175)](0x1f4)[_0x550a8c(0x1d8)]({'error':'An\x20error\x20occurred.'});});}catch(_0x28c18f){_0x22c349['json']({'message':_0x28c18f[_0x6c9ae4(0x16a)]});}});function BayBinSelected(_0x51ac83,_0x20ee22){var _0x198215=a0_0x4e2127,_0x3fc52a=[];let _0x263176=[];var _0xb5f110=[];if(_0x51ac83==_0x198215(0x132)){switch(_0x20ee22){case'Rack\x201':_0x3fc52a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x198215(0x136):_0x3fc52a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xb5f110=['DG'];}else{if(_0x51ac83==_0x198215(0x149)){switch(_0x20ee22){case'Rack\x201':_0x3fc52a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x198215(0x136):_0x3fc52a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xb5f110=['FG'];}}return{'levels':_0x3fc52a,'identify':_0xb5f110};}router[a0_0x4e2127(0x1be)]('/view/:id',auth,async(_0xfff18d,_0x272d00)=>{var _0x382cb5=a0_0x4e2127;try{const {username:_0x1cc725,email:_0x2e85f8,role:_0xdf3b8e}=_0xfff18d[_0x382cb5(0x17b)],_0x20e2f2=_0xfff18d[_0x382cb5(0x17b)],_0xd8b43b=await profile[_0x382cb5(0x152)]({'email':_0x20e2f2[_0x382cb5(0x197)]}),_0xd6a339=await master_shop[_0x382cb5(0x1d5)](),_0xfba025=await transfers_finished[_0x382cb5(0x14e)](_0xfff18d[_0x382cb5(0x12e)]['id']);let _0x2fb35e=new Date(_0xfba025['expiry_date']),_0xd0f9e3=('0'+_0x2fb35e[_0x382cb5(0x19d)]())[_0x382cb5(0x131)](-0x2),_0x3a2817=('0'+(_0x2fb35e['getMonth']()+0x1))[_0x382cb5(0x131)](-0x2),_0x2e9c47=_0x2fb35e[_0x382cb5(0x143)](),_0x3a1517=_0x2e9c47+'-'+_0x3a2817+'-'+_0xd0f9e3,_0x5dd379;if(_0x20e2f2[_0x382cb5(0x1e9)]==_0x382cb5(0x1a7)){const _0x590ae5=await staff[_0x382cb5(0x152)]({'email':_0x20e2f2['email']});_0x5dd379=await warehouse[_0x382cb5(0x1d5)]({'status':_0x382cb5(0x18e),'name':_0x590ae5[_0x382cb5(0x17d)],'warehouse_category':_0x382cb5(0x172)});}else _0x5dd379=await warehouse[_0x382cb5(0x1d5)]({'status':_0x382cb5(0x18e),'warehouse_category':_0x382cb5(0x172)});const _0x32955a=await warehouse['aggregate']([{'$match':{'name':_0xfba025[_0x382cb5(0x13a)],'room':_0xfba025[_0x382cb5(0x162)]}},{'$unwind':_0x382cb5(0x1c9)},{'$group':{'_id':_0x382cb5(0x19f),'name':{'$first':_0x382cb5(0x1d1)},'product_stock':{'$first':_0x382cb5(0x1e8)},'bay':{'$first':_0x382cb5(0x168)},'bin':{'$first':_0x382cb5(0x13e)},'type':{'$first':_0x382cb5(0x191)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x382cb5(0x137)},'secondary_code':{'$first':_0x382cb5(0x12a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x382cb5(0x13f)},'rack':{'$first':'$product_details.rack'}}}]);var _0x45d04c=[0x1,0x2,0x3,0x4],_0x2e61a9=['A','B','C','D','E','F','G','H','I','J'],_0x29374e=[_0x382cb5(0x19b),_0x382cb5(0x134)];const _0x194d90=await product[_0x382cb5(0x1d5)]({}),_0xe6c0d=BayBinSelected(_0xfba025[_0x382cb5(0x146)],_0xfba025[_0x382cb5(0x1ed)]);if(_0xd6a339[0x0][_0x382cb5(0x142)]==_0x382cb5(0x185)){var _0x1d2791=users[_0x382cb5(0x16e)];console[_0x382cb5(0x164)](_0x1d2791);}else{if(_0xd6a339[0x0][_0x382cb5(0x142)]==_0x382cb5(0x17e))var _0x1d2791=users[_0x382cb5(0x17e)];else{if(_0xd6a339[0x0]['language']=='German')var _0x1d2791=users[_0x382cb5(0x1b2)];else{if(_0xd6a339[0x0][_0x382cb5(0x142)]=='Spanish')var _0x1d2791=users['Spanish'];else{if(_0xd6a339[0x0][_0x382cb5(0x142)]==_0x382cb5(0x1af))var _0x1d2791=users[_0x382cb5(0x1af)];else{if(_0xd6a339[0x0][_0x382cb5(0x142)]==_0x382cb5(0x138))var _0x1d2791=users[_0x382cb5(0x16c)];else{if(_0xd6a339[0x0][_0x382cb5(0x142)]==_0x382cb5(0x1c8))var _0x1d2791=users[_0x382cb5(0x1c8)];else{if(_0xd6a339[0x0]['language']==_0x382cb5(0x171))var _0x1d2791=users[_0x382cb5(0x1aa)];}}}}}}}_0x272d00[_0x382cb5(0x1b9)]('edit_transfer_finished',{'success':_0xfff18d['flash']('success'),'errors':_0xfff18d['flash'](_0x382cb5(0x144)),'role':_0x20e2f2,'profile':_0xd8b43b,'master_shop':_0xd6a339,'warehouse':_0x5dd379,'transfer':_0xfba025,'stock':_0x32955a,'unit':_0x194d90,'language':_0x1d2791,'levels':_0x45d04c,'Isle':_0x2e61a9,'rooms_data':_0x29374e,'ed_fullDate':_0x3a1517,'dataSelected':_0xe6c0d});}catch(_0x3709f9){console[_0x382cb5(0x164)](_0x3709f9);}}),router['post'](a0_0x4e2127(0x160),auth,async(_0x1e7a5d,_0x3d74d7)=>{var _0x2ccd93=a0_0x4e2127;try{const _0x564e9f=_0x1e7a5d['params']['id'];console[_0x2ccd93(0x164)](_0x1e7a5d[_0x2ccd93(0x1ba)]);const _0x532e35=await transfers_finished[_0x2ccd93(0x14e)](_0x564e9f);console[_0x2ccd93(0x164)](_0x2ccd93(0x1e7),_0x532e35);const {date:_0x152f9d,from_warehouse:_0x2aa38b,FromRoom_name:_0x3eb03e,to_warehouse:_0x5ac271,ToRoom_name:_0x5e2628,prod_name:_0x594b4a,from_prod_qty:_0x48c489,from_prod_level:_0x135249,from_prod_isle:_0x5c0d21,from_prod_pallet:_0x46b0c8,to_prod_qty:_0x1dd46d,to_prod_level:_0x494fb2,to_prod_isle:_0x556497,to_prod_pallet:_0x264070,primary_code:_0x2adebf,secondary_code:_0x2d51ed,product_code3:_0x10384b,note:_0x5b2176,invoice:_0x597b52,expiry_date:_0x2c4c5f}=_0x1e7a5d[_0x2ccd93(0x1ba)];if(typeof _0x594b4a=='string')var _0x2bcf95=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1cb)]],_0x79c5f3=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x14f)]],_0x4583fb=[_0x1e7a5d[_0x2ccd93(0x1ba)]['from_prod_level']],_0x11813a=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1df)]],_0x2c69e9=[_0x1e7a5d[_0x2ccd93(0x1ba)]['to_prod_level']],_0x6a1f33=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1ae)]],_0x34c20d=[_0x1e7a5d[_0x2ccd93(0x1ba)]['secondary_code']],_0x2f063f=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1e1)]],_0x114647=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x203)]],_0x530fb8=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x159)]],_0x9e3cf7=[_0x1e7a5d[_0x2ccd93(0x1ba)]['secondary_unit']],_0x376d96=[_0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1d3)]],_0x23936f=[_0x1e7a5d[_0x2ccd93(0x1ba)]['expiry_date']];else var _0x2bcf95=[..._0x1e7a5d['body']['prod_name']],_0x79c5f3=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x14f)]],_0x4583fb=[..._0x1e7a5d['body'][_0x2ccd93(0x18d)]],_0x11813a=[..._0x1e7a5d[_0x2ccd93(0x1ba)]['to_prod_qty']],_0x2c69e9=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x150)]],_0x6a1f33=[..._0x1e7a5d[_0x2ccd93(0x1ba)]['primary_code']],_0x34c20d=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x169)]],_0x2f063f=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1e1)]],_0x114647=[..._0x1e7a5d[_0x2ccd93(0x1ba)]['MaxStocks_data2']],_0x530fb8=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x159)]],_0x9e3cf7=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x189)]],_0x376d96=[..._0x1e7a5d[_0x2ccd93(0x1ba)]['batch_code']],_0x23936f=[..._0x1e7a5d[_0x2ccd93(0x1ba)][_0x2ccd93(0x1b0)]];const _0x32d10f=_0x2bcf95[_0x2ccd93(0x161)](_0x12c483=>{return _0x12c483={'product_name':_0x12c483};});_0x79c5f3[_0x2ccd93(0x1de)]((_0x1de8a5,_0x108bb9)=>{var _0x212b31=_0x2ccd93;_0x32d10f[_0x108bb9][_0x212b31(0x1ff)]=_0x1de8a5;}),_0x4583fb[_0x2ccd93(0x1de)]((_0x25b073,_0x5e5197)=>{var _0x59383a=_0x2ccd93;_0x32d10f[_0x5e5197][_0x59383a(0x130)]=_0x25b073;}),_0x11813a[_0x2ccd93(0x1de)]((_0x3b0cb8,_0x4a9875)=>{var _0x44f1eb=_0x2ccd93;_0x32d10f[_0x4a9875][_0x44f1eb(0x15a)]=_0x3b0cb8;}),_0x2c69e9[_0x2ccd93(0x1de)]((_0x4c1797,_0x333f23)=>{_0x32d10f[_0x333f23]['to_bay']=_0x4c1797;}),_0x6a1f33[_0x2ccd93(0x1de)]((_0x1ffe9b,_0x3c9d3c)=>{var _0xa50005=_0x2ccd93;_0x32d10f[_0x3c9d3c][_0xa50005(0x1ae)]=_0x1ffe9b;}),_0x34c20d['forEach']((_0x3779b9,_0x498281)=>{var _0x131a41=_0x2ccd93;_0x32d10f[_0x498281][_0x131a41(0x169)]=_0x3779b9;}),_0x2f063f[_0x2ccd93(0x1de)]((_0x2397b1,_0x3524e0)=>{_0x32d10f[_0x3524e0]['product_code']=_0x2397b1;}),_0x114647[_0x2ccd93(0x1de)]((_0x19a6fa,_0x101bfb)=>{var _0x42f451=_0x2ccd93;_0x32d10f[_0x101bfb][_0x42f451(0x1ca)]=_0x19a6fa;}),_0x530fb8[_0x2ccd93(0x1de)]((_0x1bff60,_0x2b4582)=>{_0x32d10f[_0x2b4582]['unit']=_0x1bff60;}),_0x9e3cf7[_0x2ccd93(0x1de)]((_0x1999a4,_0x59957c)=>{var _0x3f226f=_0x2ccd93;_0x32d10f[_0x59957c][_0x3f226f(0x189)]=_0x1999a4;}),_0x376d96[_0x2ccd93(0x1de)]((_0xb898fd,_0x1fa62c)=>{_0x32d10f[_0x1fa62c]['batch_code']=_0xb898fd;}),_0x23936f[_0x2ccd93(0x1de)]((_0x556e7e,_0x5bb45f)=>{var _0x432b30=_0x2ccd93;_0x32d10f[_0x5bb45f][_0x432b30(0x1b0)]=_0x556e7e;});const _0x23b2ff=_0x32d10f[_0x2ccd93(0x153)](_0x5fe18f=>_0x5fe18f[_0x2ccd93(0x15a)]!=='0'&&_0x5fe18f[_0x2ccd93(0x15a)]!==''||_0x5fe18f[_0x2ccd93(0x1b3)]!=='0'&&_0x5fe18f[_0x2ccd93(0x1b3)]!=='');var _0x3aecec=0x0;_0x23b2ff['forEach'](_0x17cc31=>{var _0x1e13b3=_0x2ccd93;parseInt(_0x17cc31[_0x1e13b3(0x1ff)])<parseInt(_0x17cc31[_0x1e13b3(0x15a)])&&_0x3aecec++;});if(_0x3aecec!=0x0)return _0x1e7a5d['flash'](_0x2ccd93(0x144),'Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty'),_0x3d74d7[_0x2ccd93(0x12c)](_0x2ccd93(0x176));const _0x186b49=await warehouse['findOne']({'name':_0x532e35['from_warehouse'],'room':_0x532e35['from_room']});_0x532e35[_0x2ccd93(0x178)][_0x2ccd93(0x1de)](_0x1f88dd=>{var _0x53a063=_0x2ccd93;if(_0x1f88dd[_0x53a063(0x15a)]>0x0){const _0x420421=_0x186b49[_0x53a063(0x16f)][_0x53a063(0x161)](_0x27a3dc=>{var _0x5eb396=_0x53a063;_0x27a3dc['product_name']==_0x1f88dd[_0x5eb396(0x165)]&&_0x27a3dc[_0x5eb396(0x1d0)]==_0x1f88dd[_0x5eb396(0x130)]&&(_0x27a3dc[_0x5eb396(0x1cc)]=parseInt(_0x27a3dc[_0x5eb396(0x1cc)])+parseInt(_0x1f88dd[_0x5eb396(0x15a)]));});}}),await _0x186b49[_0x2ccd93(0x1fe)]();const _0x940cab=await warehouse[_0x2ccd93(0x152)]({'name':_0x532e35[_0x2ccd93(0x146)],'room':_0x532e35[_0x2ccd93(0x1ed)]});_0x532e35[_0x2ccd93(0x178)][_0x2ccd93(0x1de)](_0x134c1b=>{var _0x5eb683=_0x2ccd93;if(_0x134c1b[_0x5eb683(0x15a)]>0x0){const _0x3f8999=_0x940cab[_0x5eb683(0x16f)]['map'](_0x1f8ae9=>{var _0x43e23b=_0x5eb683;_0x1f8ae9[_0x43e23b(0x165)]==_0x134c1b[_0x43e23b(0x165)]&&_0x1f8ae9[_0x43e23b(0x1d0)]==_0x134c1b[_0x43e23b(0x15d)]&&(_0x1f8ae9[_0x43e23b(0x1cc)]=parseInt(_0x1f8ae9[_0x43e23b(0x1cc)])-parseInt(_0x134c1b[_0x43e23b(0x15a)]));});}}),await _0x940cab[_0x2ccd93(0x1fe)](),_0x532e35[_0x2ccd93(0x167)]=_0x152f9d,_0x532e35[_0x2ccd93(0x13a)]=_0x2aa38b,_0x532e35['to_warehouse']=_0x5ac271,_0x532e35['product']=_0x23b2ff,_0x532e35[_0x2ccd93(0x201)]=_0x5b2176,_0x532e35[_0x2ccd93(0x16d)]=_0x597b52;const _0x77f28f=await _0x532e35['save'](),_0x2ed0ce=await warehouse[_0x2ccd93(0x152)]({'name':_0x2aa38b,'room':_0x3eb03e});_0x77f28f[_0x2ccd93(0x178)][_0x2ccd93(0x1de)](_0x2df742=>{var _0x7e05f8=_0x2ccd93;if(_0x2df742[_0x7e05f8(0x15a)]>0x0){const _0x259fc7=_0x2ed0ce[_0x7e05f8(0x16f)]['map'](_0x300ac1=>{var _0x38b680=_0x7e05f8;_0x300ac1['product_name']==_0x2df742[_0x38b680(0x165)]&&_0x300ac1['bay']==_0x2df742[_0x38b680(0x130)]&&(_0x300ac1[_0x38b680(0x1cc)]=parseInt(_0x300ac1[_0x38b680(0x1cc)])-parseInt(_0x2df742[_0x38b680(0x15a)]));});}}),await _0x2ed0ce[_0x2ccd93(0x1fe)]();const _0x146479=await warehouse['findOne']({'name':_0x5ac271,'room':_0x5e2628});_0x77f28f['product'][_0x2ccd93(0x1de)](_0x4421a9=>{var _0x52ca82=_0x2ccd93;if(_0x4421a9[_0x52ca82(0x15a)]>0x0){var _0x40f7e3=0x0;const _0x35a0c0=_0x146479[_0x52ca82(0x16f)]['map'](_0x5eeb34=>{var _0xc498ec=_0x52ca82;_0x5eeb34[_0xc498ec(0x165)]==_0x4421a9[_0xc498ec(0x165)]&&_0x5eeb34[_0xc498ec(0x1d0)]==_0x4421a9[_0xc498ec(0x15d)]&&(_0x5eeb34[_0xc498ec(0x1cc)]=parseInt(_0x5eeb34[_0xc498ec(0x1cc)])+parseInt(_0x4421a9[_0xc498ec(0x15a)]),_0x40f7e3++);});_0x40f7e3=='0'&&(_0x146479[_0x52ca82(0x16f)]=_0x146479[_0x52ca82(0x16f)][_0x52ca82(0x1e0)]({'product_name':_0x4421a9[_0x52ca82(0x165)],'product_stock':_0x4421a9[_0x52ca82(0x15a)],'bay':_0x4421a9[_0x52ca82(0x15d)],'product_code':_0x4421a9[_0x52ca82(0x1d7)],'primary_code':_0x4421a9['primary_code'],'secondary_code':_0x4421a9[_0x52ca82(0x169)],'maxProducts':_0x4421a9[_0x52ca82(0x1ca)]}));}}),await _0x146479[_0x2ccd93(0x1fe)](),_0x1e7a5d['flash'](_0x2ccd93(0x1a0),_0x2ccd93(0x1ec)),_0x3d74d7['redirect'](_0x2ccd93(0x1db));}catch(_0x490403){console[_0x2ccd93(0x164)](_0x490403);}}),router[a0_0x4e2127(0x1f3)](a0_0x4e2127(0x18b),async(_0x17239e,_0x111e3e)=>{var _0x28e092=a0_0x4e2127;const {FromWareHouse:_0x4d6dfe,FromRoom:_0x283da4,ToWarehouse:_0x1e49e1,ToRoom:_0x3c121d,primary_code:_0x12f72f,Roomslist:_0x5bf1b3}=_0x17239e[_0x28e092(0x1ba)],_0x3cbed0=_0x5bf1b3[_0x28e092(0x1cd)](','),_0xd4d9a0=[];async function _0x3fac2e(_0x4f70ea){var _0x4e5a76=_0x28e092;const _0x502767=await warehouse[_0x4e5a76(0x1b8)]([{'$match':{'name':_0x4d6dfe,'room':_0x4f70ea}},{'$unwind':_0x4e5a76(0x1c9)},{'$match':{'product_details.primary_code':_0x12f72f}},{'$group':{'_id':_0x4e5a76(0x19f),'name':{'$first':'$product_details.product_name'},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4e5a76(0x1bc)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x4e5a76(0x13e)},'type':{'$first':_0x4e5a76(0x191)},'pallet':{'$first':_0x4e5a76(0x1fa)},'unit':{'$first':_0x4e5a76(0x1d4)},'secondary_unit':{'$first':_0x4e5a76(0x1a6)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4e5a76(0x1bd)},'expiry_date':{'$first':_0x4e5a76(0x1fb)},'production_date':{'$first':_0x4e5a76(0x1f4)},'batch_code':{'$first':_0x4e5a76(0x1f0)},'maxPerUnit':{'$first':_0x4e5a76(0x186)},'roomNamed':{'$first':_0x4e5a76(0x187)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x4e5a76(0x1f5)}}}]),_0x3ca24d=await warehouse[_0x4e5a76(0x1b8)]([{'$match':{'name':_0x4d6dfe,'room':_0x4f70ea}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x12f72f}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4e5a76(0x1d1)},'instock':{'$first':_0x4e5a76(0x1e8)},'primary_code':{'$first':_0x4e5a76(0x137)},'secondary_code':{'$first':_0x4e5a76(0x12a)},'product_code':{'$first':_0x4e5a76(0x1bc)},'level':{'$first':_0x4e5a76(0x168)},'isle':{'$first':_0x4e5a76(0x13e)},'type':{'$first':_0x4e5a76(0x191)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x4e5a76(0x1d4)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4e5a76(0x1bd)},'expiry_date':{'$first':_0x4e5a76(0x1fb)},'production_date':{'$first':_0x4e5a76(0x1f4)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x4e5a76(0x187)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x4e5a76(0x1f5)}}}]);if(_0x502767[_0x4e5a76(0x1ce)]>0x0)_0xd4d9a0[_0x4e5a76(0x190)](_0x502767);else _0x3ca24d[_0x4e5a76(0x1ce)]>0x0&&_0xd4d9a0[_0x4e5a76(0x190)](_0x3ca24d);}const _0x1b56e6=_0x3cbed0[_0x28e092(0x161)](_0x19d8b8=>_0x3fac2e(_0x19d8b8));await Promise[_0x28e092(0x15e)](_0x1b56e6),_0x111e3e[_0x28e092(0x1d8)](_0xd4d9a0);}),router['post'](a0_0x4e2127(0x17a),async(_0x1eef96,_0x268b8f)=>{var _0x441196=a0_0x4e2127;try{const {FromWareHouse:_0x12b5df,FromRoom:_0x51e520,ToWarehouse:_0xccb3ab,ToRoom:_0x3c2b46,secondary_code:_0x3bcce1}=_0x1eef96['body'],_0x5c8575=await warehouse[_0x441196(0x1b8)]([{'$match':{'name':_0x12b5df}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3bcce1}},{'$group':{'_id':_0x441196(0x19f),'name':{'$first':_0x441196(0x1d1)},'primary_code':{'$first':_0x441196(0x137)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x441196(0x1bc)},'instock':{'$first':_0x441196(0x1e8)},'warehouse':{'$first':_0x441196(0x1f9)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x441196(0x12b)},'pallet':{'$first':_0x441196(0x195)},'maxProducts':{'$first':_0x441196(0x1dd)},'unit':{'$first':_0x441196(0x1d4)},'expiry_date':{'$first':_0x441196(0x1fb)},'production_date':{'$first':_0x441196(0x1f4)}}}]);_0x268b8f['status'](0xc8)[_0x441196(0x1d8)](_0x5c8575);}catch(_0x300e57){_0x268b8f[_0x441196(0x175)](0x194)[_0x441196(0x1d8)]({'message':_0x300e57[_0x441196(0x16a)]});}}),router['post'](a0_0x4e2127(0x19c),async(_0x70f379,_0xc5eeb3)=>{var _0xfe3f0f=a0_0x4e2127;try{const {FromWareHouse:_0x174728,FromRoom:_0x66661d,ToWarehouse:_0x1ac9ed,ToRoom:_0x5009e9,product_code:_0x3f6f27}=_0x70f379[_0xfe3f0f(0x1ba)],_0x30a426=await warehouse[_0xfe3f0f(0x1b8)]([{'$match':{'name':_0x174728}},{'$unwind':_0xfe3f0f(0x1c9)},{'$match':{'product_details.product_code':_0x3f6f27}},{'$group':{'_id':_0xfe3f0f(0x19f),'name':{'$first':_0xfe3f0f(0x1d1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xfe3f0f(0x12a)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0xfe3f0f(0x1e8)},'warehouse':{'$first':_0xfe3f0f(0x1f9)},'level':{'$first':_0xfe3f0f(0x1e3)},'isle':{'$first':_0xfe3f0f(0x12b)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0xfe3f0f(0x1dd)},'unit':{'$first':_0xfe3f0f(0x1d4)}}}]);_0xc5eeb3[_0xfe3f0f(0x175)](0xc8)[_0xfe3f0f(0x1d8)](_0x30a426);}catch(_0xbc2cd7){_0xc5eeb3[_0xfe3f0f(0x175)](0x194)[_0xfe3f0f(0x1d8)]({'message':_0xbc2cd7[_0xfe3f0f(0x16a)]});}}),router['post'](a0_0x4e2127(0x148),async(_0x3b5ecf,_0x47cde4)=>{var _0x3dfb5f=a0_0x4e2127;const {productCode:_0x90e11a,bay:_0x488a42,warehouses:_0x458db5,room:_0x4801d6}=_0x3b5ecf[_0x3dfb5f(0x1ba)];console['log'](_0x3b5ecf[_0x3dfb5f(0x1ba)]);try{const _0x22ca13=await warehouse[_0x3dfb5f(0x1b8)]([{'$match':{'name':_0x458db5,'room':_0x4801d6}},{'$unwind':_0x3dfb5f(0x1c9)},{'$match':{'product_details.bay':parseInt(_0x488a42)}},{'$group':{'_id':_0x3dfb5f(0x19f),'name':{'$first':_0x3dfb5f(0x1d1)},'product_stock':{'$first':_0x3dfb5f(0x1e8)},'bay':{'$first':_0x3dfb5f(0x168)},'maxProducts':{'$first':_0x3dfb5f(0x1dd)}}}]);_0x47cde4['status'](0xc8)['json'](_0x22ca13);}catch(_0x13c2be){_0x47cde4[_0x3dfb5f(0x175)](0x194)[_0x3dfb5f(0x1d8)]({'message':_0x13c2be[_0x3dfb5f(0x16a)]});}}),module[a0_0x4e2127(0x1fc)]=router;