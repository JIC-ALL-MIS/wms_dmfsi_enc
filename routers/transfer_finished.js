var a0_0x13706c=a0_0x4586;(function(_0xf82e51,_0x557ba0){var _0x34bb8e=a0_0x4586,_0x3c34ca=_0xf82e51();while(!![]){try{var _0x186f7c=-parseInt(_0x34bb8e(0x15d))/0x1+-parseInt(_0x34bb8e(0x12a))/0x2*(parseInt(_0x34bb8e(0x1dd))/0x3)+parseInt(_0x34bb8e(0x1ad))/0x4*(-parseInt(_0x34bb8e(0x1e7))/0x5)+parseInt(_0x34bb8e(0x1ea))/0x6*(parseInt(_0x34bb8e(0x1ac))/0x7)+parseInt(_0x34bb8e(0x1cb))/0x8+-parseInt(_0x34bb8e(0x1eb))/0x9*(parseInt(_0x34bb8e(0x17e))/0xa)+parseInt(_0x34bb8e(0x186))/0xb*(parseInt(_0x34bb8e(0x141))/0xc);if(_0x186f7c===_0x557ba0)break;else _0x3c34ca['push'](_0x3c34ca['shift']());}catch(_0x4c45e0){_0x3c34ca['push'](_0x3c34ca['shift']());}}}(a0_0x11fc,0x1e59c));const express=require(a0_0x13706c(0x190)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x13706c(0x16a)),auth=require(a0_0x13706c(0x197)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x13706c(0x1ed));router[a0_0x13706c(0x1c9)](a0_0x13706c(0x17c),auth,async(_0x2fd8a7,_0xaa7d6f)=>{var _0x461ca1=a0_0x13706c;try{const {username:_0x30c6aa,email:_0x432aaf,role:_0x239bd7}=_0x2fd8a7[_0x461ca1(0x1c5)],_0x3268d3=_0x2fd8a7[_0x461ca1(0x1c5)],_0x530cfc=await profile[_0x461ca1(0x19b)]({'email':_0x3268d3[_0x461ca1(0x1af)]}),_0xb25d1b=await master_shop[_0x461ca1(0x14a)]();let _0x1bffba;if(_0x3268d3[_0x461ca1(0x1c0)]==_0x461ca1(0x1d5)){const _0x5abc11=await staff[_0x461ca1(0x19b)]({'email':_0x3268d3['email']});_0x1bffba=await transfers_finished[_0x461ca1(0x14a)]({'from_warehouse':_0x5abc11[_0x461ca1(0x1d7)]});}else _0x1bffba=await transfers_finished[_0x461ca1(0x19d)]([{'$unwind':_0x461ca1(0x135)},{'$group':{'_id':_0x461ca1(0x170),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'from_warehouse':{'$first':_0x461ca1(0x126)},'to_warehouse':{'$first':_0x461ca1(0x1f5)},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x461ca1(0x12e)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0xb25d1b[0x0][_0x461ca1(0x173)]==_0x461ca1(0x1f3))var _0x2b1d40=users['English'];else{if(_0xb25d1b[0x0]['language']==_0x461ca1(0x1bb))var _0x2b1d40=users[_0x461ca1(0x1bb)];else{if(_0xb25d1b[0x0][_0x461ca1(0x173)]==_0x461ca1(0x138))var _0x2b1d40=users[_0x461ca1(0x138)];else{if(_0xb25d1b[0x0][_0x461ca1(0x173)]==_0x461ca1(0x1b5))var _0x2b1d40=users[_0x461ca1(0x1b5)];else{if(_0xb25d1b[0x0][_0x461ca1(0x173)]==_0x461ca1(0x1a2))var _0x2b1d40=users[_0x461ca1(0x1a2)];else{if(_0xb25d1b[0x0][_0x461ca1(0x173)]==_0x461ca1(0x176))var _0x2b1d40=users[_0x461ca1(0x19a)];else{if(_0xb25d1b[0x0][_0x461ca1(0x173)]==_0x461ca1(0x1a3))var _0x2b1d40=users[_0x461ca1(0x1a3)];else{if(_0xb25d1b[0x0][_0x461ca1(0x173)]=='Arabic\x20(ae)')var _0x2b1d40=users[_0x461ca1(0x1e5)];}}}}}}}_0xaa7d6f[_0x461ca1(0x167)](_0x461ca1(0x193),{'success':_0x2fd8a7[_0x461ca1(0x178)](_0x461ca1(0x180)),'errors':_0x2fd8a7['flash'](_0x461ca1(0x152)),'role':_0x3268d3,'profile':_0x530cfc,'master_shop':_0xb25d1b,'transfer':_0x1bffba,'language':_0x2b1d40});}catch(_0x18dfad){console[_0x461ca1(0x147)](_0x18dfad);}});async function getRandom8DigitNumber(){var _0x4e4f4d=a0_0x13706c;const _0x41a620=0x989680,_0x17e9b7=0x5f5e0ff,_0xe53d8a=Math[_0x4e4f4d(0x125)](Math[_0x4e4f4d(0x15c)]()*(_0x17e9b7-_0x41a620+0x1))+_0x41a620;var _0x14869b;const _0x30f442=await transfers_finished[_0x4e4f4d(0x19b)]({'invoice':_0x4e4f4d(0x185)+_0xe53d8a});return _0x30f442&&_0x30f442['length']>0x0?_0x14869b='TRFF-'+_0xe53d8a:_0x14869b=_0x4e4f4d(0x185)+_0xe53d8a,_0x14869b;}function a0_0x4586(_0x8ab511,_0x4d290e){var _0x11fcd4=a0_0x11fc();return a0_0x4586=function(_0x4586c3,_0x419e8a){_0x4586c3=_0x4586c3-0x122;var _0x26ebbc=_0x11fcd4[_0x4586c3];return _0x26ebbc;},a0_0x4586(_0x8ab511,_0x4d290e);}router[a0_0x13706c(0x1c9)](a0_0x13706c(0x1f8),auth,async(_0x190c01,_0x214c47)=>{var _0x12a9d2=a0_0x13706c;try{const {username:_0x279655,email:_0x507db4,role:_0x26d963}=_0x190c01[_0x12a9d2(0x1c5)],_0x1a037a=_0x190c01[_0x12a9d2(0x1c5)],_0x7c1232=await profile[_0x12a9d2(0x19b)]({'email':_0x1a037a[_0x12a9d2(0x1af)]}),_0x2ec3d9=await master_shop[_0x12a9d2(0x14a)]();let _0x227708;if(_0x1a037a[_0x12a9d2(0x1c0)]==_0x12a9d2(0x1d5)){const _0x42f002=await staff[_0x12a9d2(0x19b)]({'email':_0x1a037a['email']});_0x227708=await warehouse[_0x12a9d2(0x19d)]([{'$match':{'status':'Enabled','name':_0x42f002[_0x12a9d2(0x1d7)],'warehouse_category':_0x12a9d2(0x1c7),'name':{'$ne':_0x12a9d2(0x1c2)}}},{'$group':{'_id':'$name','name':{'$first':_0x12a9d2(0x1ce)}}}]);}else _0x227708=await warehouse[_0x12a9d2(0x19d)]([{'$match':{'status':'Enabled','warehouse_category':_0x12a9d2(0x1c7),'name':{'$ne':_0x12a9d2(0x1c2)}}},{'$group':{'_id':_0x12a9d2(0x1ce),'name':{'$first':_0x12a9d2(0x1ce)}}}]);const _0x55401f=await transfers_finished[_0x12a9d2(0x14a)]({}),_0x430ebf=_0x55401f[_0x12a9d2(0x1b7)]+0x1,_0x4739a4=_0x12a9d2(0x185)+_0x430ebf['toString']()[_0x12a9d2(0x189)](0x5,'0');if(_0x2ec3d9[0x0]['language']==_0x12a9d2(0x1f3))var _0x47718c=users[_0x12a9d2(0x1e3)];else{if(_0x2ec3d9[0x0][_0x12a9d2(0x173)]==_0x12a9d2(0x1bb))var _0x47718c=users['Hindi'];else{if(_0x2ec3d9[0x0][_0x12a9d2(0x173)]==_0x12a9d2(0x138))var _0x47718c=users[_0x12a9d2(0x138)];else{if(_0x2ec3d9[0x0]['language']==_0x12a9d2(0x1b5))var _0x47718c=users[_0x12a9d2(0x1b5)];else{if(_0x2ec3d9[0x0][_0x12a9d2(0x173)]==_0x12a9d2(0x1a2))var _0x47718c=users[_0x12a9d2(0x1a2)];else{if(_0x2ec3d9[0x0][_0x12a9d2(0x173)]==_0x12a9d2(0x176))var _0x47718c=users[_0x12a9d2(0x19a)];else{if(_0x2ec3d9[0x0][_0x12a9d2(0x173)]==_0x12a9d2(0x1a3))var _0x47718c=users[_0x12a9d2(0x1a3)];else{if(_0x2ec3d9[0x0]['language']==_0x12a9d2(0x139))var _0x47718c=users[_0x12a9d2(0x1e5)];}}}}}}}const _0x3c618a=getRandom8DigitNumber();_0x3c618a[_0x12a9d2(0x196)](_0x4cffad=>{var _0x49ff2b=_0x12a9d2;_0x214c47[_0x49ff2b(0x167)](_0x49ff2b(0x159),{'success':_0x190c01[_0x49ff2b(0x178)](_0x49ff2b(0x180)),'errors':_0x190c01['flash'](_0x49ff2b(0x152)),'role':_0x1a037a,'profile':_0x7c1232,'master_shop':_0x2ec3d9,'warehouse':_0x227708,'language':_0x47718c,'invoice':_0x4cffad});})['catch'](_0x5828f1=>{var _0x495b74=_0x12a9d2;_0x190c01[_0x495b74(0x178)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x214c47[_0x495b74(0x1f7)](_0x495b74(0x146));});}catch(_0xe765e0){console[_0x12a9d2(0x147)](_0xe765e0);}}),router[a0_0x13706c(0x1b3)](a0_0x13706c(0x1f8),auth,async(_0x4d1cc5,_0x5ac128)=>{var _0x370de7=a0_0x13706c;try{const {date:_0x5bc5ff,from_warehouse:_0x5bbc90,FromRoom_name:_0x3281c1,to_warehouse:_0x5867a0,ToRoom_name:_0x50c3b1,prod_name:_0x13106e,from_prod_qty:_0x367016,from_prod_level:_0xd75b19,from_prod_isle:_0x50e3b1,from_prod_pallet:_0x427ede,to_prod_qty:_0xa488bc,to_prod_level:_0x1d0f5a,to_prod_isle:_0x2d15f2,to_prod_pallet:_0xbb64dd,primary_code:_0x4a9471,secondary_code:_0x3682c8,product_code3:_0x5c93c1,note:_0xc6868,MaxStocks_data2:_0x51fd5a,invoice:_0x5c9e5c,expiry_date:_0x561bdc}=_0x4d1cc5[_0x370de7(0x1d0)];if(typeof _0x13106e==_0x370de7(0x156))var _0x124b1c=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x151)]],_0x46f51f=[_0x4d1cc5['body'][_0x370de7(0x179)]],_0x130f66=[_0x4d1cc5[_0x370de7(0x1d0)]['from_prod_level']],_0x9e0306=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x12f)]],_0x1b6b14=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13d)]],_0x3bd058=[_0x4d1cc5[_0x370de7(0x1d0)]['primary_code']],_0x2442ed=[_0x4d1cc5[_0x370de7(0x1d0)]['secondary_code']],_0x1bc105=[_0x4d1cc5['body']['product_code3']],_0x227ddd=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x130)]],_0x509677=[_0x4d1cc5[_0x370de7(0x1d0)]['primary_unit']],_0x3db227=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x1d8)]],_0x24b57e=[_0x4d1cc5[_0x370de7(0x1d0)]['batch_code']],_0x552017=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x171)]],_0x76f455=[_0x4d1cc5['body']['product_date']],_0x40dd5f=[_0x4d1cc5['body']['MaxStocks_data']],_0x559356=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x14f)]],_0x250d66=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x1da)]],_0xa4b9ab=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x14c)]],_0x28f5c3=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x122)]],_0xdf146e=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13e)]],_0x5d93af=[_0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13a)]];else var _0x124b1c=[..._0x4d1cc5['body'][_0x370de7(0x151)]],_0x46f51f=[..._0x4d1cc5[_0x370de7(0x1d0)]['from_prod_qty']],_0x130f66=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x149)]],_0x9e0306=[..._0x4d1cc5['body'][_0x370de7(0x12f)]],_0x1b6b14=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13d)]],_0x3bd058=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13f)]],_0x2442ed=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x1fa)]],_0x1bc105=[..._0x4d1cc5['body']['product_code3']],_0x227ddd=[..._0x4d1cc5['body'][_0x370de7(0x130)]],_0x509677=[..._0x4d1cc5[_0x370de7(0x1d0)]['primary_unit']],_0x3db227=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x1d8)]],_0x24b57e=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x163)]],_0x552017=[..._0x4d1cc5['body'][_0x370de7(0x171)]],_0x76f455=[..._0x4d1cc5[_0x370de7(0x1d0)]['product_date']],_0x40dd5f=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x1ae)]],_0x559356=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x14f)]],_0x250d66=[..._0x4d1cc5['body'][_0x370de7(0x1da)]],_0xa4b9ab=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x14c)]],_0x28f5c3=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x122)]],_0xdf146e=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13e)]],_0x5d93af=[..._0x4d1cc5[_0x370de7(0x1d0)][_0x370de7(0x13a)]];const _0x5f035a=_0x124b1c[_0x370de7(0x1cf)](_0x11caf6=>{return _0x11caf6={'product_name':_0x11caf6};});_0x46f51f[_0x370de7(0x153)]((_0x193b9a,_0x2de62d)=>{var _0x5599a0=_0x370de7;_0x5f035a[_0x2de62d][_0x5599a0(0x12b)]=_0x193b9a;}),_0x130f66[_0x370de7(0x153)]((_0x38f22c,_0x4261a5)=>{var _0x173d06=_0x370de7;_0x5f035a[_0x4261a5][_0x173d06(0x192)]=_0x38f22c;}),_0xdf146e[_0x370de7(0x153)]((_0x2ade2a,_0x38217c)=>{var _0x21962c=_0x370de7;_0x5f035a[_0x38217c][_0x21962c(0x13e)]=_0x2ade2a;}),_0x5d93af['forEach']((_0x4df581,_0x1c74a0)=>{var _0x3cbc85=_0x370de7;_0x5f035a[_0x1c74a0][_0x3cbc85(0x137)]=_0x4df581;}),_0x9e0306[_0x370de7(0x153)]((_0x5d1297,_0x11c63d)=>{var _0x4c5702=_0x370de7;_0x5f035a[_0x11c63d][_0x4c5702(0x15f)]=_0x5d1297;}),_0x1b6b14['forEach']((_0x1b0532,_0x52bda0)=>{var _0x2823e6=_0x370de7;_0x5f035a[_0x52bda0][_0x2823e6(0x161)]=_0x1b0532;}),_0x3bd058[_0x370de7(0x153)]((_0x4751dd,_0x4d136e)=>{var _0xc0047c=_0x370de7;_0x5f035a[_0x4d136e][_0xc0047c(0x13f)]=_0x4751dd;}),_0x2442ed[_0x370de7(0x153)]((_0x2b8933,_0x1696fd)=>{var _0x23bd91=_0x370de7;_0x5f035a[_0x1696fd][_0x23bd91(0x1fa)]=_0x2b8933;}),_0x1bc105[_0x370de7(0x153)]((_0x1429d9,_0x1175fa)=>{var _0xdfa62a=_0x370de7;_0x5f035a[_0x1175fa][_0xdfa62a(0x1d9)]=_0x1429d9;}),_0x227ddd[_0x370de7(0x153)]((_0x2cfc6d,_0x313b75)=>{var _0x28b124=_0x370de7;_0x5f035a[_0x313b75][_0x28b124(0x1be)]=_0x2cfc6d;}),_0x509677[_0x370de7(0x153)]((_0x46879f,_0x5cdd4a)=>{var _0x23aa20=_0x370de7;_0x5f035a[_0x5cdd4a][_0x23aa20(0x1aa)]=_0x46879f;}),_0x3db227[_0x370de7(0x153)]((_0x4472c4,_0x24a249)=>{var _0x18464b=_0x370de7;_0x5f035a[_0x24a249][_0x18464b(0x1d8)]=_0x4472c4;}),_0x24b57e[_0x370de7(0x153)]((_0x17db68,_0x15025d)=>{var _0x334066=_0x370de7;_0x5f035a[_0x15025d][_0x334066(0x163)]=_0x17db68;}),_0x552017[_0x370de7(0x153)]((_0x1846fd,_0x19736c)=>{_0x5f035a[_0x19736c]['expiry_date']=_0x1846fd;}),_0x76f455[_0x370de7(0x153)]((_0x26f913,_0x30c565)=>{_0x5f035a[_0x30c565]['production_date']=_0x26f913;}),_0x40dd5f['forEach']((_0x6f9922,_0x571001)=>{var _0x50551f=_0x370de7;_0x5f035a[_0x571001][_0x50551f(0x1be)]=_0x6f9922;}),_0x559356[_0x370de7(0x153)]((_0x1768c7,_0x41483c)=>{var _0x29512b=_0x370de7;_0x5f035a[_0x41483c][_0x29512b(0x14f)]=_0x1768c7;}),_0x250d66['forEach']((_0x40aa43,_0x2a87ed)=>{var _0x5812ae=_0x370de7;_0x5f035a[_0x2a87ed][_0x5812ae(0x1da)]=_0x40aa43;}),_0xa4b9ab[_0x370de7(0x153)]((_0x510352,_0x41ad84)=>{var _0x29fb31=_0x370de7;_0x5f035a[_0x41ad84][_0x29fb31(0x168)]=_0x510352;}),_0x28f5c3['forEach']((_0x26589e,_0x146f86)=>{_0x5f035a[_0x146f86]['to_room_name']=_0x26589e;});const _0xc670e2=_0x5f035a['filter'](_0x355b9c=>_0x355b9c[_0x370de7(0x15f)]!=='0'&&_0x355b9c['to_quantity']!==''||_0x355b9c[_0x370de7(0x194)]!=='0'&&_0x355b9c[_0x370de7(0x194)]!=='');var _0x555b91=0x0;_0xc670e2[_0x370de7(0x153)](_0x4e4774=>{var _0x229f79=_0x370de7;parseInt(_0x4e4774[_0x229f79(0x12b)])<parseInt(_0x4e4774['to_quantity'])&&_0x555b91++;});if(_0x555b91!=0x0)return _0x4d1cc5['flash'](_0x370de7(0x152),_0x370de7(0x1a9)),_0x5ac128[_0x370de7(0x1f7)]('back');const _0xa2ce9e=new transfers_finished({'date':_0x5bc5ff,'from_warehouse':_0x5bbc90,'to_warehouse':_0x5867a0,'product':_0xc670e2,'note':_0xc6868,'invoice':_0x5c9e5c}),_0x2ea3d6=await _0xa2ce9e[_0x370de7(0x150)]();_0x4d1cc5[_0x370de7(0x178)](_0x370de7(0x180),_0x370de7(0x131)),_0x5ac128[_0x370de7(0x1f7)](_0x370de7(0x1f1)+_0x2ea3d6['_id']);}catch(_0x57c2e2){console[_0x370de7(0x147)](_0x57c2e2),_0x5ac128[_0x370de7(0x123)](0xc8)['json']({'errorMessage':_0x57c2e2[_0x370de7(0x1a0)]});}}),router[a0_0x13706c(0x1c9)](a0_0x13706c(0x160),auth,async(_0x304b29,_0x51faca)=>{var _0x10de97=a0_0x13706c;try{const {username:_0x31262d,email:_0x436061,role:_0x2d627c}=_0x304b29['user'],_0x5421de=_0x304b29[_0x10de97(0x1c5)],_0x2ad078=await profile['findOne']({'email':_0x5421de[_0x10de97(0x1af)]}),_0x19bd1d=await master_shop[_0x10de97(0x14a)](),_0x234189=await transfers_finished[_0x10de97(0x1b0)](_0x304b29['params']['id']);let _0xc5a246;if(_0x5421de['role']==_0x10de97(0x1d5)){const _0x531cf1=await staff['findOne']({'email':_0x5421de[_0x10de97(0x1af)]});_0xc5a246=await warehouse[_0x10de97(0x14a)]({'status':_0x10de97(0x1ab),'name':_0x531cf1['warehouse'],'warehouse_category':'Finished\x20Goods'});}else _0xc5a246=await warehouse['find']({'status':_0x10de97(0x1ab),'warehouse_category':_0x10de97(0x1c7)});const _0x44a12f=await warehouse['aggregate']([{'$match':{'name':_0x234189[_0x10de97(0x140)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x10de97(0x127)},{'$group':{'_id':_0x10de97(0x13c),'name':{'$first':_0x10de97(0x1e6)},'product_stock':{'$first':_0x10de97(0x1bd)},'bay':{'$first':_0x10de97(0x1d1)},'bin':{'$first':_0x10de97(0x17b)},'type':{'$first':_0x10de97(0x124)},'floorlevel':{'$first':_0x10de97(0x199)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10de97(0x16d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x10de97(0x1df)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x10de97(0x1ec)},'room':{'$first':_0x10de97(0x142)},'warehoue_name':{'$first':'$name'}}}]),_0x2bb84a=await product[_0x10de97(0x14a)]({});if(_0x19bd1d[0x0]['language']==_0x10de97(0x1f3)){var _0x4b6be3=users[_0x10de97(0x1e3)];console[_0x10de97(0x147)](_0x4b6be3);}else{if(_0x19bd1d[0x0][_0x10de97(0x173)]==_0x10de97(0x1bb))var _0x4b6be3=users['Hindi'];else{if(_0x19bd1d[0x0]['language']==_0x10de97(0x138))var _0x4b6be3=users[_0x10de97(0x138)];else{if(_0x19bd1d[0x0]['language']=='Spanish')var _0x4b6be3=users[_0x10de97(0x1b5)];else{if(_0x19bd1d[0x0][_0x10de97(0x173)]==_0x10de97(0x1a2))var _0x4b6be3=users[_0x10de97(0x1a2)];else{if(_0x19bd1d[0x0][_0x10de97(0x173)]==_0x10de97(0x176))var _0x4b6be3=users[_0x10de97(0x19a)];else{if(_0x19bd1d[0x0][_0x10de97(0x173)]==_0x10de97(0x1a3))var _0x4b6be3=users[_0x10de97(0x1a3)];else{if(_0x19bd1d[0x0][_0x10de97(0x173)]==_0x10de97(0x139))var _0x4b6be3=users['Arabic'];}}}}}}}_0x51faca[_0x10de97(0x167)](_0x10de97(0x16b),{'success':_0x304b29[_0x10de97(0x178)]('success'),'errors':_0x304b29[_0x10de97(0x178)](_0x10de97(0x152)),'role':_0x5421de,'profile':_0x2ad078,'master_shop':_0x19bd1d,'warehouse':_0xc5a246,'transfer':_0x234189,'stock':_0x44a12f,'unit':_0x2bb84a,'language':_0x4b6be3});}catch(_0x11352d){console['log'](_0x11352d);}}),router[a0_0x13706c(0x1b3)]('/preview/:id',auth,async(_0x38e157,_0x135aef)=>{var _0x212d33=a0_0x13706c;try{const {invoice:_0x3847f1,from_warehouse:_0x434bc5,FromRoom_name:_0x2a9abf,to_warehouse:_0x309e5e,ToRoom_name:_0x2b957d}=_0x38e157[_0x212d33(0x1d0)],_0x558931=await transfers_finished[_0x212d33(0x1b0)](_0x38e157[_0x212d33(0x1a4)]['id']),_0x28b9f2=_0x558931['product'][_0x212d33(0x1cf)](async _0x3402e5=>{var _0x1a103e=_0x212d33;if(_0x3402e5[_0x1a103e(0x15f)]>0x0){var _0x5b11fc=await warehouse[_0x1a103e(0x19b)]({'name':_0x434bc5,'room':_0x3402e5[_0x1a103e(0x168)],'warehouse_category':_0x1a103e(0x1c7)});const _0x2c11e3=_0x5b11fc[_0x1a103e(0x15a)][_0x1a103e(0x1cf)](_0x341990=>{var _0x30b5ec=_0x1a103e;_0x341990[_0x30b5ec(0x1ee)]==_0x3402e5[_0x30b5ec(0x1ee)]&&_0x341990[_0x30b5ec(0x1e8)]==_0x3402e5[_0x30b5ec(0x192)]&&_0x341990[_0x30b5ec(0x171)]==_0x3402e5[_0x30b5ec(0x171)]&&_0x341990[_0x30b5ec(0x1d4)]==_0x3402e5[_0x30b5ec(0x1d4)]&&_0x341990[_0x30b5ec(0x163)]==_0x3402e5[_0x30b5ec(0x163)]&&_0x341990[_0x30b5ec(0x18a)]==_0x3402e5[_0x30b5ec(0x13e)]&&(_0x341990[_0x30b5ec(0x1de)]=_0x341990['product_stock']-_0x3402e5[_0x30b5ec(0x15f)]);});}return _0x5b11fc;});Promise['all'](_0x28b9f2)[_0x212d33(0x196)](async _0x131ed2=>{var _0x5d78bf=_0x212d33;try{for(const _0x399c3d of _0x131ed2){await _0x399c3d[_0x5d78bf(0x150)]();}const _0x3368ff=_0x558931[_0x5d78bf(0x1f2)][_0x5d78bf(0x1cf)](async _0x2b24b6=>{var _0x15f059=_0x5d78bf,_0x5979d2=await warehouse[_0x15f059(0x19b)]({'name':_0x309e5e,'room':_0x2b24b6['to_room_name']});if(_0x2b24b6[_0x15f059(0x15f)]>0x0){var _0x214d6f=0x0;const _0x2e4455=_0x5979d2[_0x15f059(0x15a)][_0x15f059(0x1cf)](_0x1ce017=>{var _0x26f85d=_0x15f059;_0x1ce017[_0x26f85d(0x1ee)]==_0x2b24b6['product_name']&&_0x1ce017[_0x26f85d(0x1e8)]==_0x2b24b6[_0x26f85d(0x161)]&&_0x1ce017[_0x26f85d(0x171)]==_0x2b24b6[_0x26f85d(0x171)]&&_0x1ce017[_0x26f85d(0x1d4)]==_0x2b24b6[_0x26f85d(0x1d4)]&&_0x1ce017[_0x26f85d(0x163)]==_0x2b24b6[_0x26f85d(0x163)]&&_0x1ce017[_0x26f85d(0x18a)]==_0x2b24b6[_0x26f85d(0x137)]&&(_0x1ce017[_0x26f85d(0x1de)]=_0x1ce017[_0x26f85d(0x1de)]+_0x2b24b6[_0x26f85d(0x15f)],_0x214d6f++);});_0x214d6f=='0'&&(_0x5979d2[_0x15f059(0x15a)]=_0x5979d2[_0x15f059(0x15a)][_0x15f059(0x1e9)]({'product_name':_0x2b24b6[_0x15f059(0x1ee)],'product_stock':_0x2b24b6[_0x15f059(0x15f)],'bay':_0x2b24b6[_0x15f059(0x161)],'product_code':_0x2b24b6[_0x15f059(0x1d9)],'primary_code':_0x2b24b6[_0x15f059(0x13f)],'secondary_code':_0x2b24b6[_0x15f059(0x1fa)],'expiry_date':_0x2b24b6[_0x15f059(0x171)],'production_date':_0x2b24b6[_0x15f059(0x1d4)],'maxProducts':_0x2b24b6[_0x15f059(0x1be)],'batch_code':_0x2b24b6['batch_code'],'secondary_unit':_0x2b24b6[_0x15f059(0x1d8)],'unit':_0x2b24b6[_0x15f059(0x1aa)],'maxProducts':_0x2b24b6[_0x15f059(0x1be)],'maxPerUnit':_0x2b24b6[_0x15f059(0x14f)],'invoice':_0x2b24b6[_0x15f059(0x137)]}));}return _0x5979d2;});Promise[_0x5d78bf(0x133)](_0x3368ff)[_0x5d78bf(0x196)](async _0x586e2f=>{var _0x134ec3=_0x5d78bf;try{for(const _0x54c9c9 of _0x586e2f){await warehouse[_0x134ec3(0x148)]({'_id':_0x54c9c9[_0x134ec3(0x13b)]},{'$addToSet':{'product_details':{'$each':_0x54c9c9[_0x134ec3(0x15a)]}}});}_0x558931[_0x134ec3(0x1c8)]=_0x134ec3(0x143);const _0xe3728c=await _0x558931[_0x134ec3(0x150)](),_0x867926=await master_shop[_0x134ec3(0x14a)](),_0x28ddfb=await email_settings[_0x134ec3(0x19b)](),_0x2cedc8=await supervisor_settings[_0x134ec3(0x14a)]();var _0x335d26=_0x558931[_0x134ec3(0x1f2)],_0x1e2bb2='',_0x3a1026;for(_0x3a1026 in _0x335d26){var _0x47aa4b='FG';_0x558931['to_warehouse']=='DRY\x20GOODS'&&(_0x47aa4b='DG'),_0x1e2bb2+=_0x134ec3(0x1cd)+_0x134ec3(0x1b4)+_0x335d26[_0x3a1026][_0x134ec3(0x1ee)]+_0x134ec3(0x19c)+_0x134ec3(0x1b4)+_0x335d26[_0x3a1026][_0x134ec3(0x1d9)]+_0x134ec3(0x19c)+_0x134ec3(0x1b4)+_0x335d26[_0x3a1026][_0x134ec3(0x15f)]+_0x134ec3(0x19c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x335d26[_0x3a1026][_0x134ec3(0x1aa)]+_0x134ec3(0x19c)+_0x134ec3(0x1b4)+_0x335d26[_0x3a1026][_0x134ec3(0x1d8)]+'</td>'+_0x134ec3(0x1b4)+_0x558931[_0x134ec3(0x1e2)]+'</td>'+_0x134ec3(0x1b4)+_0x335d26[_0x3a1026]['to_room_name']+_0x134ec3(0x19c)+_0x134ec3(0x1b4)+_0x47aa4b+_0x335d26[_0x3a1026][_0x134ec3(0x161)]+_0x134ec3(0x19c)+'</tr>';}let _0x71d902=nodemailer['createTransport']({'host':_0x28ddfb[_0x134ec3(0x1b9)],'port':Number(_0x28ddfb[_0x134ec3(0x1b6)]),'secure':![],'auth':{'user':_0x28ddfb[_0x134ec3(0x1af)],'pass':_0x28ddfb[_0x134ec3(0x1f9)]}}),_0x5a61c4={'from':_0x28ddfb[_0x134ec3(0x1af)],'to':_0x2cedc8[0x0][_0x134ec3(0x1cc)],'subject':_0x134ec3(0x181),'attachments':[{'filename':'Logo.png','path':__dirname+_0x134ec3(0x198)+'/upload/'+_0x867926[0x0][_0x134ec3(0x19f)],'cid':_0x134ec3(0x1d6)}],'html':_0x134ec3(0x1ef)+'<html><head><title></title>'+_0x134ec3(0x134)+'<div>'+_0x134ec3(0x191)+'<div>'+_0x134ec3(0x17a)+_0x134ec3(0x1ca)+_0x134ec3(0x1b8)+'<h2>\x20'+_0x867926[0x0][_0x134ec3(0x18b)]+_0x134ec3(0x1bf)+_0x134ec3(0x1ca)+_0x134ec3(0x1ca)+_0x134ec3(0x1b2)+_0x134ec3(0x1b8)+_0x134ec3(0x12d)+_0x134ec3(0x164)+_0x558931[_0x134ec3(0x18a)]+'\x20'+_0x134ec3(0x16c)+_0x134ec3(0x18e)+_0x558931[_0x134ec3(0x1d3)]+'\x20'+_0x134ec3(0x19e)+_0x134ec3(0x157)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x134ec3(0x1e1)+_0x134ec3(0x1cd)+_0x134ec3(0x15b)+_0x134ec3(0x1c6)+_0x134ec3(0x16e)+_0x134ec3(0x1c4)+_0x134ec3(0x1bc)+_0x134ec3(0x182)+_0x134ec3(0x1f6)+_0x134ec3(0x169)+_0x134ec3(0x175)+_0x134ec3(0x184)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1e2bb2+'\x20'+'</tbody>'+_0x134ec3(0x1a8)+'<div>'+_0x134ec3(0x165)+'<h5>'+_0x867926[0x0][_0x134ec3(0x18b)]+_0x134ec3(0x157)+_0x134ec3(0x1ca)+_0x134ec3(0x1ca)+_0x134ec3(0x18f)};_0x71d902[_0x134ec3(0x174)](_0x5a61c4,function(_0x496858,_0x300edb){var _0x553909=_0x134ec3;_0x496858?(console[_0x553909(0x147)](_0x496858),console[_0x553909(0x147)](_0x553909(0x1c1))):console['log'](_0x553909(0x1d2));}),_0x38e157['flash'](_0x134ec3(0x180),_0x134ec3(0x14b)),_0x135aef[_0x134ec3(0x1f7)]('/picking_list/PDF_transfer/'+_0xe3728c['_id']);}catch(_0x4a6aeb){console[_0x134ec3(0x14e)](_0x4a6aeb),_0x135aef[_0x134ec3(0x123)](0x1f4)[_0x134ec3(0x129)]({'error':_0x134ec3(0x1e0)});}})['catch'](_0x3f6ed8=>{var _0x861642=_0x5d78bf;console[_0x861642(0x14e)](_0x3f6ed8),_0x135aef['status'](0x1f4)[_0x861642(0x129)]({'error':_0x861642(0x187)});});}catch(_0x34f275){console[_0x5d78bf(0x14e)](_0x34f275),_0x135aef[_0x5d78bf(0x123)](0x1f4)[_0x5d78bf(0x129)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x212d33(0x12c)](_0x2d855b=>{var _0x50ba2e=_0x212d33;console[_0x50ba2e(0x14e)](_0x2d855b),_0x135aef[_0x50ba2e(0x123)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0xd683fc){_0x135aef[_0x212d33(0x129)]({'message':_0xd683fc[_0x212d33(0x1a0)]});}});function BayBinSelected(_0x1d046e,_0x397c8f){var _0x149c25=a0_0x13706c,_0xc7b7b7=[];let _0x1e4251=[];var _0x26e709=[];if(_0x1d046e=='DRY\x20GOODS'){switch(_0x397c8f){case _0x149c25(0x136):_0xc7b7b7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case'Rack\x202':_0xc7b7b7=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x26e709=['DG'];}else{if(_0x1d046e==_0x149c25(0x1dc)){switch(_0x397c8f){case _0x149c25(0x136):_0xc7b7b7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x149c25(0x1a6):_0xc7b7b7=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x26e709=['FG'];}}return{'levels':_0xc7b7b7,'identify':_0x26e709};}router[a0_0x13706c(0x1c9)](a0_0x13706c(0x17f),auth,async(_0x2f0842,_0x4dde4f)=>{var _0x445707=a0_0x13706c;try{const {username:_0x14d0c7,email:_0x5dfd11,role:_0x5ba271}=_0x2f0842[_0x445707(0x1c5)],_0x5c216e=_0x2f0842[_0x445707(0x1c5)],_0x1de4a1=await profile[_0x445707(0x19b)]({'email':_0x5c216e['email']}),_0x387fa1=await master_shop[_0x445707(0x14a)](),_0x3a5eb4=await transfers_finished[_0x445707(0x1b0)](_0x2f0842[_0x445707(0x1a4)]['id']);let _0x5b51f3=new Date(_0x3a5eb4[_0x445707(0x171)]),_0x146bc4=('0'+_0x5b51f3[_0x445707(0x183)]())[_0x445707(0x166)](-0x2),_0x122e0e=('0'+(_0x5b51f3[_0x445707(0x162)]()+0x1))[_0x445707(0x166)](-0x2),_0x3c1c9a=_0x5b51f3[_0x445707(0x132)](),_0xfc01fa=_0x3c1c9a+'-'+_0x122e0e+'-'+_0x146bc4,_0x4746f9;if(_0x5c216e[_0x445707(0x1c0)]==_0x445707(0x1d5)){const _0x2db4c7=await staff['findOne']({'email':_0x5c216e['email']});_0x4746f9=await warehouse[_0x445707(0x14a)]({'status':_0x445707(0x1ab),'name':_0x2db4c7[_0x445707(0x1d7)],'warehouse_category':_0x445707(0x1c7)});}else _0x4746f9=await warehouse[_0x445707(0x14a)]({'status':_0x445707(0x1ab),'warehouse_category':_0x445707(0x1c7)});const _0x441f46=await warehouse[_0x445707(0x19d)]([{'$match':{'name':_0x3a5eb4[_0x445707(0x140)],'room':_0x3a5eb4[_0x445707(0x14d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x445707(0x13c),'name':{'$first':_0x445707(0x1e6)},'product_stock':{'$first':_0x445707(0x1bd)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x445707(0x17b)},'type':{'$first':_0x445707(0x124)},'floorlevel':{'$first':_0x445707(0x199)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x445707(0x16d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x445707(0x1df)},'rack':{'$first':_0x445707(0x128)}}}]);var _0x481e5e=[0x1,0x2,0x3,0x4],_0x5d7c9d=['A','B','C','D','E','F','G','H','I','J'],_0x2ae138=[_0x445707(0x154),_0x445707(0x1db)];const _0x153fa9=await product[_0x445707(0x14a)]({}),_0x4f2224=BayBinSelected(_0x3a5eb4[_0x445707(0x1e2)],_0x3a5eb4[_0x445707(0x15e)]);if(_0x387fa1[0x0]['language']==_0x445707(0x1f3)){var _0x1cf7f2=users['English'];console[_0x445707(0x147)](_0x1cf7f2);}else{if(_0x387fa1[0x0][_0x445707(0x173)]==_0x445707(0x1bb))var _0x1cf7f2=users[_0x445707(0x1bb)];else{if(_0x387fa1[0x0][_0x445707(0x173)]==_0x445707(0x138))var _0x1cf7f2=users[_0x445707(0x138)];else{if(_0x387fa1[0x0]['language']==_0x445707(0x1b5))var _0x1cf7f2=users[_0x445707(0x1b5)];else{if(_0x387fa1[0x0][_0x445707(0x173)]==_0x445707(0x1a2))var _0x1cf7f2=users['French'];else{if(_0x387fa1[0x0][_0x445707(0x173)]==_0x445707(0x176))var _0x1cf7f2=users['Portuguese'];else{if(_0x387fa1[0x0][_0x445707(0x173)]==_0x445707(0x1a3))var _0x1cf7f2=users[_0x445707(0x1a3)];else{if(_0x387fa1[0x0][_0x445707(0x173)]=='Arabic\x20(ae)')var _0x1cf7f2=users[_0x445707(0x1e5)];}}}}}}}_0x4dde4f[_0x445707(0x167)](_0x445707(0x1f0),{'success':_0x2f0842[_0x445707(0x178)](_0x445707(0x180)),'errors':_0x2f0842[_0x445707(0x178)](_0x445707(0x152)),'role':_0x5c216e,'profile':_0x1de4a1,'master_shop':_0x387fa1,'warehouse':_0x4746f9,'transfer':_0x3a5eb4,'stock':_0x441f46,'unit':_0x153fa9,'language':_0x1cf7f2,'levels':_0x481e5e,'Isle':_0x5d7c9d,'rooms_data':_0x2ae138,'ed_fullDate':_0xfc01fa,'dataSelected':_0x4f2224});}catch(_0xf44776){console['log'](_0xf44776);}}),router[a0_0x13706c(0x1b3)](a0_0x13706c(0x17f),auth,async(_0x7d4906,_0x38120d)=>{var _0x16bd7b=a0_0x13706c;try{const _0x30b00d=_0x7d4906[_0x16bd7b(0x1a4)]['id'];console[_0x16bd7b(0x147)](_0x7d4906['body']);const _0x466ab8=await transfers_finished['findById'](_0x30b00d);console[_0x16bd7b(0x147)](_0x16bd7b(0x18c),_0x466ab8);const {date:_0x2aeeae,from_warehouse:_0x2caf02,FromRoom_name:_0x1ab771,to_warehouse:_0x50dd08,ToRoom_name:_0x4cc1d1,prod_name:_0x1073d0,from_prod_qty:_0x554d64,from_prod_level:_0x769b46,from_prod_isle:_0x170497,from_prod_pallet:_0x317575,to_prod_qty:_0x29e174,to_prod_level:_0x187a2c,to_prod_isle:_0x2bc85e,to_prod_pallet:_0x298b82,primary_code:_0x3e1644,secondary_code:_0x107dba,product_code3:_0x1ed508,note:_0x58faa7,invoice:_0x42e217,expiry_date:_0x14f9e6}=_0x7d4906[_0x16bd7b(0x1d0)];if(typeof _0x1073d0=='string')var _0xcd829a=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x151)]],_0x1a5eb9=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x179)]],_0x19489d=[_0x7d4906[_0x16bd7b(0x1d0)]['from_prod_level']],_0x523c46=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x17d)]],_0x2d9af4=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x13d)]],_0x37c057=[_0x7d4906[_0x16bd7b(0x1d0)]['primary_code']],_0x104248=[_0x7d4906['body'][_0x16bd7b(0x1fa)]],_0x2e588a=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x144)]],_0x474a85=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x130)]],_0x59e6b1=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x1aa)]],_0x41de98=[_0x7d4906['body'][_0x16bd7b(0x1d8)]],_0x12c2b6=[_0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x163)]],_0x1cfe57=[_0x7d4906['body'][_0x16bd7b(0x171)]];else var _0xcd829a=[..._0x7d4906[_0x16bd7b(0x1d0)]['prod_name']],_0x1a5eb9=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x179)]],_0x19489d=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x149)]],_0x523c46=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x17d)]],_0x2d9af4=[..._0x7d4906['body'][_0x16bd7b(0x13d)]],_0x37c057=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x13f)]],_0x104248=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x1fa)]],_0x2e588a=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x144)]],_0x474a85=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x130)]],_0x59e6b1=[..._0x7d4906[_0x16bd7b(0x1d0)]['unit']],_0x41de98=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x1d8)]],_0x12c2b6=[..._0x7d4906[_0x16bd7b(0x1d0)][_0x16bd7b(0x163)]],_0x1cfe57=[..._0x7d4906[_0x16bd7b(0x1d0)]['expiry_date']];const _0xb3678=_0xcd829a[_0x16bd7b(0x1cf)](_0xa74d54=>{return _0xa74d54={'product_name':_0xa74d54};});_0x1a5eb9[_0x16bd7b(0x153)]((_0x97d0da,_0x49d741)=>{var _0x52cbd6=_0x16bd7b;_0xb3678[_0x49d741][_0x52cbd6(0x12b)]=_0x97d0da;}),_0x19489d[_0x16bd7b(0x153)]((_0x5d700c,_0x59fb9d)=>{var _0x251bed=_0x16bd7b;_0xb3678[_0x59fb9d][_0x251bed(0x192)]=_0x5d700c;}),_0x523c46[_0x16bd7b(0x153)]((_0x4ef726,_0x507c14)=>{var _0x4ca071=_0x16bd7b;_0xb3678[_0x507c14][_0x4ca071(0x15f)]=_0x4ef726;}),_0x2d9af4[_0x16bd7b(0x153)]((_0xe92bb5,_0x5bde96)=>{_0xb3678[_0x5bde96]['to_bay']=_0xe92bb5;}),_0x37c057[_0x16bd7b(0x153)]((_0x2f745f,_0x503464)=>{var _0xa5f351=_0x16bd7b;_0xb3678[_0x503464][_0xa5f351(0x13f)]=_0x2f745f;}),_0x104248[_0x16bd7b(0x153)]((_0x26a497,_0x4205e3)=>{var _0x183795=_0x16bd7b;_0xb3678[_0x4205e3][_0x183795(0x1fa)]=_0x26a497;}),_0x2e588a[_0x16bd7b(0x153)]((_0xf8fb60,_0x1dcee7)=>{var _0x32a80f=_0x16bd7b;_0xb3678[_0x1dcee7][_0x32a80f(0x1d9)]=_0xf8fb60;}),_0x474a85[_0x16bd7b(0x153)]((_0x50e6dd,_0xabab2)=>{var _0x478682=_0x16bd7b;_0xb3678[_0xabab2][_0x478682(0x1be)]=_0x50e6dd;}),_0x59e6b1[_0x16bd7b(0x153)]((_0x18bf36,_0x39a959)=>{var _0x2f65c4=_0x16bd7b;_0xb3678[_0x39a959][_0x2f65c4(0x1aa)]=_0x18bf36;}),_0x41de98['forEach']((_0x3fb226,_0x5f5609)=>{var _0x94b2c9=_0x16bd7b;_0xb3678[_0x5f5609][_0x94b2c9(0x1d8)]=_0x3fb226;}),_0x12c2b6[_0x16bd7b(0x153)]((_0x2b4e02,_0x3c2c89)=>{var _0x33ac26=_0x16bd7b;_0xb3678[_0x3c2c89][_0x33ac26(0x163)]=_0x2b4e02;}),_0x1cfe57['forEach']((_0x1b4bb2,_0x1fbcc2)=>{var _0x20702b=_0x16bd7b;_0xb3678[_0x1fbcc2][_0x20702b(0x171)]=_0x1b4bb2;});const _0x1f5a21=_0xb3678['filter'](_0x1f10ea=>_0x1f10ea['to_quantity']!=='0'&&_0x1f10ea[_0x16bd7b(0x15f)]!==''||_0x1f10ea[_0x16bd7b(0x194)]!=='0'&&_0x1f10ea[_0x16bd7b(0x194)]!=='');var _0x2fcee3=0x0;_0x1f5a21['forEach'](_0x5195c2=>{var _0xf620d1=_0x16bd7b;parseInt(_0x5195c2['from_quantity'])<parseInt(_0x5195c2[_0xf620d1(0x15f)])&&_0x2fcee3++;});if(_0x2fcee3!=0x0)return _0x7d4906[_0x16bd7b(0x178)]('errors',_0x16bd7b(0x1a9)),_0x38120d['redirect'](_0x16bd7b(0x195));const _0x4e78a3=await warehouse[_0x16bd7b(0x19b)]({'name':_0x466ab8[_0x16bd7b(0x140)],'room':_0x466ab8['from_room']});_0x466ab8[_0x16bd7b(0x1f2)][_0x16bd7b(0x153)](_0x2060bf=>{var _0x1c751e=_0x16bd7b;if(_0x2060bf['to_quantity']>0x0){const _0xdf32b1=_0x4e78a3[_0x1c751e(0x15a)][_0x1c751e(0x1cf)](_0x124afb=>{var _0x23c347=_0x1c751e;_0x124afb[_0x23c347(0x1ee)]==_0x2060bf[_0x23c347(0x1ee)]&&_0x124afb[_0x23c347(0x1e8)]==_0x2060bf[_0x23c347(0x192)]&&(_0x124afb[_0x23c347(0x1de)]=parseInt(_0x124afb[_0x23c347(0x1de)])+parseInt(_0x2060bf['to_quantity']));});}}),await _0x4e78a3[_0x16bd7b(0x150)]();const _0x459998=await warehouse[_0x16bd7b(0x19b)]({'name':_0x466ab8[_0x16bd7b(0x1e2)],'room':_0x466ab8['to_room']});_0x466ab8[_0x16bd7b(0x1f2)][_0x16bd7b(0x153)](_0x4c156c=>{var _0x434518=_0x16bd7b;if(_0x4c156c[_0x434518(0x15f)]>0x0){const _0x41e7da=_0x459998[_0x434518(0x15a)][_0x434518(0x1cf)](_0x343c49=>{var _0x41617f=_0x434518;_0x343c49[_0x41617f(0x1ee)]==_0x4c156c[_0x41617f(0x1ee)]&&_0x343c49[_0x41617f(0x1e8)]==_0x4c156c[_0x41617f(0x161)]&&(_0x343c49['product_stock']=parseInt(_0x343c49['product_stock'])-parseInt(_0x4c156c[_0x41617f(0x15f)]));});}}),await _0x459998[_0x16bd7b(0x150)](),_0x466ab8[_0x16bd7b(0x1d3)]=_0x2aeeae,_0x466ab8[_0x16bd7b(0x140)]=_0x2caf02,_0x466ab8[_0x16bd7b(0x1e2)]=_0x50dd08,_0x466ab8['product']=_0x1f5a21,_0x466ab8['note']=_0x58faa7,_0x466ab8[_0x16bd7b(0x18a)]=_0x42e217;const _0x5db063=await _0x466ab8['save'](),_0x5a1e0a=await warehouse[_0x16bd7b(0x19b)]({'name':_0x2caf02,'room':_0x1ab771});_0x5db063[_0x16bd7b(0x1f2)]['forEach'](_0x291f0e=>{var _0x4278d4=_0x16bd7b;if(_0x291f0e[_0x4278d4(0x15f)]>0x0){const _0x3e724c=_0x5a1e0a[_0x4278d4(0x15a)][_0x4278d4(0x1cf)](_0x3f0c33=>{var _0xc2abc2=_0x4278d4;_0x3f0c33[_0xc2abc2(0x1ee)]==_0x291f0e[_0xc2abc2(0x1ee)]&&_0x3f0c33[_0xc2abc2(0x1e8)]==_0x291f0e['from_bay']&&(_0x3f0c33[_0xc2abc2(0x1de)]=parseInt(_0x3f0c33[_0xc2abc2(0x1de)])-parseInt(_0x291f0e['to_quantity']));});}}),await _0x5a1e0a[_0x16bd7b(0x150)]();const _0x3f7fff=await warehouse['findOne']({'name':_0x50dd08,'room':_0x4cc1d1});_0x5db063[_0x16bd7b(0x1f2)]['forEach'](_0x1e65f6=>{var _0x4ea6b2=_0x16bd7b;if(_0x1e65f6[_0x4ea6b2(0x15f)]>0x0){var _0x36ac43=0x0;const _0x12a52c=_0x3f7fff[_0x4ea6b2(0x15a)][_0x4ea6b2(0x1cf)](_0x1eb3de=>{var _0x2de1af=_0x4ea6b2;_0x1eb3de[_0x2de1af(0x1ee)]==_0x1e65f6['product_name']&&_0x1eb3de[_0x2de1af(0x1e8)]==_0x1e65f6[_0x2de1af(0x161)]&&(_0x1eb3de['product_stock']=parseInt(_0x1eb3de[_0x2de1af(0x1de)])+parseInt(_0x1e65f6[_0x2de1af(0x15f)]),_0x36ac43++);});_0x36ac43=='0'&&(_0x3f7fff[_0x4ea6b2(0x15a)]=_0x3f7fff[_0x4ea6b2(0x15a)][_0x4ea6b2(0x1e9)]({'product_name':_0x1e65f6[_0x4ea6b2(0x1ee)],'product_stock':_0x1e65f6[_0x4ea6b2(0x15f)],'bay':_0x1e65f6[_0x4ea6b2(0x161)],'product_code':_0x1e65f6[_0x4ea6b2(0x1d9)],'primary_code':_0x1e65f6[_0x4ea6b2(0x13f)],'secondary_code':_0x1e65f6[_0x4ea6b2(0x1fa)],'maxProducts':_0x1e65f6[_0x4ea6b2(0x1be)]}));}}),await _0x3f7fff[_0x16bd7b(0x150)](),_0x7d4906['flash'](_0x16bd7b(0x180),_0x16bd7b(0x16f)),_0x38120d[_0x16bd7b(0x1f7)](_0x16bd7b(0x1ba));}catch(_0x2db871){console['log'](_0x2db871);}}),router[a0_0x13706c(0x1b3)](a0_0x13706c(0x172),async(_0x5b5600,_0x3139d)=>{var _0x3a809e=a0_0x13706c;const {FromWareHouse:_0x13332c,FromRoom:_0x12f93e,ToWarehouse:_0x3d4443,ToRoom:_0x2458f5,primary_code:_0x2856b4,Roomslist:_0x353a92}=_0x5b5600[_0x3a809e(0x1d0)],_0x236951=_0x353a92['split'](','),_0x21a758=[];async function _0x51c57e(_0x20958b){var _0x359828=_0x3a809e;const _0x4f7328=await warehouse[_0x359828(0x19d)]([{'$match':{'name':_0x13332c,'room':_0x20958b}},{'$unwind':_0x359828(0x127)},{'$match':{'product_details.primary_code':_0x2856b4}},{'$group':{'_id':_0x359828(0x13c),'name':{'$first':_0x359828(0x1e6)},'instock':{'$first':_0x359828(0x1bd)},'primary_code':{'$first':_0x359828(0x145)},'secondary_code':{'$first':_0x359828(0x16d)},'product_code':{'$first':_0x359828(0x158)},'level':{'$first':_0x359828(0x1d1)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x359828(0x199)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x359828(0x1a1)},'storage':{'$first':_0x359828(0x1df)},'rack':{'$first':_0x359828(0x128)},'expiry_date':{'$first':_0x359828(0x1b1)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x359828(0x1a5)},'maxPerUnit':{'$first':_0x359828(0x177)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x359828(0x1a7)}}}]),_0x17ea42=await warehouse[_0x359828(0x19d)]([{'$match':{'name':_0x13332c,'room':_0x20958b}},{'$unwind':_0x359828(0x127)},{'$match':{'product_details.secondary_code':_0x2856b4}},{'$group':{'_id':_0x359828(0x13c),'name':{'$first':_0x359828(0x1e6)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x359828(0x145)},'secondary_code':{'$first':_0x359828(0x16d)},'product_code':{'$first':_0x359828(0x158)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x359828(0x17b)},'type':{'$first':_0x359828(0x124)},'pallet':{'$first':_0x359828(0x199)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x359828(0x1a1)},'storage':{'$first':_0x359828(0x1df)},'rack':{'$first':_0x359828(0x128)},'expiry_date':{'$first':_0x359828(0x1b1)},'production_date':{'$first':_0x359828(0x1ec)},'batch_code':{'$first':_0x359828(0x1a5)},'maxPerUnit':{'$first':_0x359828(0x177)},'roomNamed':{'$first':_0x359828(0x142)},'prod_cat':{'$first':'S'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x4f7328[_0x359828(0x1b7)]>0x0)_0x21a758['push'](_0x4f7328);else _0x17ea42[_0x359828(0x1b7)]>0x0&&_0x21a758[_0x359828(0x188)](_0x17ea42);}const _0x130436=_0x236951[_0x3a809e(0x1cf)](_0x509a44=>_0x51c57e(_0x509a44));await Promise[_0x3a809e(0x133)](_0x130436),_0x3139d[_0x3a809e(0x129)](_0x21a758);}),router['post']('/barcode_scanner2',async(_0x344e22,_0x11e601)=>{var _0xdc40f4=a0_0x13706c;try{const {FromWareHouse:_0x3dc5d1,FromRoom:_0x41e9e1,ToWarehouse:_0x35fb38,ToRoom:_0x130478,secondary_code:_0x2ff974}=_0x344e22[_0xdc40f4(0x1d0)],_0x25d84f=await warehouse['aggregate']([{'$match':{'name':_0x3dc5d1}},{'$unwind':_0xdc40f4(0x127)},{'$match':{'product_details.secondary_code':_0x2ff974}},{'$group':{'_id':_0xdc40f4(0x13c),'name':{'$first':_0xdc40f4(0x1e6)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':_0xdc40f4(0x1ce)},'level':{'$first':_0xdc40f4(0x18d)},'isle':{'$first':_0xdc40f4(0x155)},'pallet':{'$first':_0xdc40f4(0x1e4)},'maxProducts':{'$first':_0xdc40f4(0x1c3)},'unit':{'$first':_0xdc40f4(0x1f4)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0xdc40f4(0x1ec)}}}]);_0x11e601['status'](0xc8)['json'](_0x25d84f);}catch(_0x228b97){_0x11e601[_0xdc40f4(0x123)](0x194)['json']({'message':_0x228b97[_0xdc40f4(0x1a0)]});}}),router[a0_0x13706c(0x1b3)]('/barcode_scanner3',async(_0xe0a5c9,_0x290900)=>{var _0x2b1051=a0_0x13706c;try{const {FromWareHouse:_0x1730c2,FromRoom:_0x3779c7,ToWarehouse:_0x32b5d8,ToRoom:_0x45e93f,product_code:_0x38266a}=_0xe0a5c9[_0x2b1051(0x1d0)],_0x2de1ea=await warehouse['aggregate']([{'$match':{'name':_0x1730c2}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x38266a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2b1051(0x1e6)},'primary_code':{'$first':_0x2b1051(0x145)},'secondary_code':{'$first':_0x2b1051(0x16d)},'product_code':{'$first':_0x2b1051(0x158)},'instock':{'$first':_0x2b1051(0x1bd)},'warehouse':{'$first':_0x2b1051(0x1ce)},'level':{'$first':_0x2b1051(0x18d)},'isle':{'$first':_0x2b1051(0x155)},'pallet':{'$first':_0x2b1051(0x1e4)},'maxProducts':{'$first':_0x2b1051(0x1c3)},'unit':{'$first':_0x2b1051(0x1f4)}}}]);_0x290900[_0x2b1051(0x123)](0xc8)[_0x2b1051(0x129)](_0x2de1ea);}catch(_0x1b0314){_0x290900[_0x2b1051(0x123)](0x194)['json']({'message':_0x1b0314[_0x2b1051(0x1a0)]});}}),router[a0_0x13706c(0x1b3)]('/CheckingWarehouse',async(_0x5d3b76,_0x56388c)=>{var _0x3f32ee=a0_0x13706c;const {productCode:_0x1e06d4,bay:_0x58b702,warehouses:_0x476869,room:_0x3a0471}=_0x5d3b76[_0x3f32ee(0x1d0)];console['log'](_0x5d3b76[_0x3f32ee(0x1d0)]);try{const _0x4e2cc5=await warehouse[_0x3f32ee(0x19d)]([{'$match':{'name':_0x476869,'room':_0x3a0471}},{'$unwind':_0x3f32ee(0x127)},{'$match':{'product_details.bay':parseInt(_0x58b702)}},{'$group':{'_id':_0x3f32ee(0x13c),'name':{'$first':_0x3f32ee(0x1e6)},'product_stock':{'$first':_0x3f32ee(0x1bd)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x3f32ee(0x1c3)}}}]);_0x56388c[_0x3f32ee(0x123)](0xc8)['json'](_0x4e2cc5);}catch(_0x51dcd2){_0x56388c[_0x3f32ee(0x123)](0x194)[_0x3f32ee(0x129)]({'message':_0x51dcd2[_0x3f32ee(0x1a0)]});}}),module['exports']=router;function a0_0x11fc(){var _0x1c12d7=['ToRoomAssigned','status','$product_details.type','floor','$from_warehouse','$product_details','$product_details.rack','json','62LrgoUx','from_quantity','catch','<h5\x20style=\x22text-align:\x20left;\x22>','$product.to_room_name','New_Qty_Converted','MaxStocks_data2','Product\x20Transfer\x20successfully','getFullYear','all','</head><body>','$product','Rack\x201','To_invoice','German','Arabic\x20(ae)','to_invoice','_id','$product_details._id','to_prod_level','from_invoice','primary_code','from_warehouse','1843944sNAADY','$room','True','product_code3','$product_details.primary_code','/transfer/view','log','updateOne','from_prod_level','find','Transfer\x20Finalize\x20Successfully','RoomAssigned','from_room','error','maxPerUnit','save','prod_name','errors','forEach','Ambient','$product_details.isle','string','</h5>','$product_details.product_code','add_transfer_finished','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','random','110626hyJdnf','to_room','to_quantity','/preview/:id','to_bay','getMonth','batch_code','\x20Order\x20Number\x20:\x20','<strong>\x20Regards\x20</strong>','slice','render','from_room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../models/all_models','edit_transfer_finished_view','<span\x20style=\x22float:\x20right;\x22>','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Transfer\x20Edit\x20Successfully','$_id','expiry_date','/barcode_scanner','language','sendMail','</tr>','Portuguese\x20(BR)','$product_details.maxPerUnit','flash','from_prod_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.bin','/view','to_prod_qty','988710OARNhw','/view/:id','success','Transfer\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','getDate','</thead>','TRFF-','11NGiuTI','An\x20error\x20occurred.','push','padStart','invoice','site_title','transfer_data','$product_details.level','\x20Order\x20Date\x20:\x20','</body></html>','express','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','from_bay','transfer_finished','to_floorlevel','back','then','../middleware/auth','/../public','$product_details.floorlevel','Portuguese','findOne','</td>','aggregate','</span>','image','message','$product_details.secondary_unit','French','Chinese','params','$product_details.batch_code','Rack\x202','$product_details.invoice','</table>','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','unit','Enabled','623IiHyof','4WXaSRi','MaxStocks_data','email','findById','$product_details.expiry_date','<hr\x20class=\x22my-3\x22>','post','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Spanish','port','length','<div>','host','/transfer_finished/view','Hindi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.product_stock','maxProducts','\x20</h2>','role','Error\x20Occurs','QA\x20Warehouse','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Finished\x20Goods','finalize','get','</div>','1899000PkrFAD','FGSEmail','<tr>','$name','map','body','$product_details.bay','Email\x20sent\x20successfully','date','production_date','staff','logo','warehouse','secondary_unit','product_code','prod_cat','Enclosed','FROZEN\x20GOODS','21720VzWBun','product_stock','$product_details.storage','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','to_warehouse','English','$product_details.pallet','Arabic','$product_details.product_name','383665vfHrmR','bay','concat','16446yelYqW','9nGRMqE','$product_details.production_date','nodemailer','product_name','<!DOCTYPE\x20html>','edit_transfer_finished','/transfer_finished/preview/','product','English\x20(US)','$product_details.unit','$to_warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','redirect','/view/add_transfer','password','secondary_code'];a0_0x11fc=function(){return _0x1c12d7;};return a0_0x11fc();}