var a0_0x6ce855=a0_0x26e9;(function(_0xa60e65,_0x1af02e){var _0x1de818=a0_0x26e9,_0x3bd2d1=_0xa60e65();while(!![]){try{var _0x469dda=-parseInt(_0x1de818(0xd1))/0x1+parseInt(_0x1de818(0xcd))/0x2+parseInt(_0x1de818(0x17d))/0x3+-parseInt(_0x1de818(0x109))/0x4*(parseInt(_0x1de818(0x125))/0x5)+-parseInt(_0x1de818(0x16f))/0x6*(parseInt(_0x1de818(0x110))/0x7)+-parseInt(_0x1de818(0xdc))/0x8*(parseInt(_0x1de818(0xca))/0x9)+parseInt(_0x1de818(0xc2))/0xa;if(_0x469dda===_0x1af02e)break;else _0x3bd2d1['push'](_0x3bd2d1['shift']());}catch(_0x2a926b){_0x3bd2d1['push'](_0x3bd2d1['shift']());}}}(a0_0x2e49,0x41767));const express=require('express'),app=express(),router=express[a0_0x6ce855(0xd6)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),users=require(a0_0x6ce855(0x145)),nodemailer=require('nodemailer');router[a0_0x6ce855(0x13a)](a0_0x6ce855(0x143),auth,async(_0x13b276,_0x5a12fc)=>{var _0x1ef4d3=a0_0x6ce855;try{const {username:_0x1c4ceb,email:_0xa4de00,role:_0x4b47d9}=_0x13b276[_0x1ef4d3(0x149)],_0x41cfac=_0x13b276[_0x1ef4d3(0x149)],_0x160744=await profile[_0x1ef4d3(0x12b)]({'email':_0x41cfac['email']}),_0xe1f318=await master_shop[_0x1ef4d3(0x16c)]();let _0x3e3bc6;if(_0x41cfac[_0x1ef4d3(0xfd)]==_0x1ef4d3(0x102)){const _0x5f46bb=await staff['findOne']({'email':_0x41cfac[_0x1ef4d3(0x14b)]});_0x3e3bc6=await transfers_finished[_0x1ef4d3(0x16c)]({'from_warehouse':_0x5f46bb['warehouse']});}else _0x3e3bc6=await transfers_finished[_0x1ef4d3(0x18a)]([{'$unwind':'$product'},{'$group':{'_id':_0x1ef4d3(0x154),'invoice':{'$first':'$invoice'},'date':{'$first':_0x1ef4d3(0x12d)},'from_warehouse':{'$first':_0x1ef4d3(0xf6)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':'$product.to_room_name'},'finalize':{'$first':_0x1ef4d3(0xce)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0xe1f318[0x0]['language']=='English\x20(US)')var _0x4b51aa=users[_0x1ef4d3(0x16d)];else{if(_0xe1f318[0x0][_0x1ef4d3(0xe3)]==_0x1ef4d3(0xd5))var _0x4b51aa=users[_0x1ef4d3(0xd5)];else{if(_0xe1f318[0x0][_0x1ef4d3(0xe3)]==_0x1ef4d3(0x107))var _0x4b51aa=users[_0x1ef4d3(0x107)];else{if(_0xe1f318[0x0]['language']==_0x1ef4d3(0x183))var _0x4b51aa=users[_0x1ef4d3(0x183)];else{if(_0xe1f318[0x0][_0x1ef4d3(0xe3)]==_0x1ef4d3(0x138))var _0x4b51aa=users[_0x1ef4d3(0x138)];else{if(_0xe1f318[0x0][_0x1ef4d3(0xe3)]==_0x1ef4d3(0x131))var _0x4b51aa=users[_0x1ef4d3(0xf8)];else{if(_0xe1f318[0x0][_0x1ef4d3(0xe3)]==_0x1ef4d3(0xd7))var _0x4b51aa=users[_0x1ef4d3(0xd7)];else{if(_0xe1f318[0x0][_0x1ef4d3(0xe3)]=='Arabic\x20(ae)')var _0x4b51aa=users[_0x1ef4d3(0x165)];}}}}}}}_0x5a12fc[_0x1ef4d3(0x122)](_0x1ef4d3(0x119),{'success':_0x13b276['flash']('success'),'errors':_0x13b276[_0x1ef4d3(0x11b)](_0x1ef4d3(0x118)),'role':_0x41cfac,'profile':_0x160744,'master_shop':_0xe1f318,'transfer':_0x3e3bc6,'language':_0x4b51aa});}catch(_0x5a8048){console[_0x1ef4d3(0x11d)](_0x5a8048);}});async function getRandom8DigitNumber(){var _0x2b315f=a0_0x6ce855;const _0xc12bb8=0x989680,_0x4fff12=0x5f5e0ff,_0x399fac=Math[_0x2b315f(0x112)](Math[_0x2b315f(0x177)]()*(_0x4fff12-_0xc12bb8+0x1))+_0xc12bb8;var _0x102c47;const _0x225c89=await transfers_finished['findOne']({'invoice':_0x2b315f(0xdb)+_0x399fac});return _0x225c89&&_0x225c89['length']>0x0?_0x102c47=_0x2b315f(0xdb)+_0x399fac:_0x102c47=_0x2b315f(0xdb)+_0x399fac,_0x102c47;}function a0_0x2e49(){var _0x6cb1fb=['$name','find','English','</head><body>','6UAFxOY','to_prod_level','Transfer\x20Mail','</div>','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details._id','</td>','message','random','product_code3','</h5>','$room','json','product_code','87147qWIVgX','to_floorlevel','prod_cat','</tr>','product_details','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Spanish','/transfer/view','to_quantity','add_transfer_finished','Finished\x20Goods','$product_details.unit','$product_details.product_stock','aggregate','Transfer\x20Edit\x20Successfully','$product_details.batch_code','createTransport','from_bay','Enabled','$product_details.bay','$product_details.production_date','Email\x20sent\x20successfully','RoomAssigned','$product_details.product_name','unit','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$product_details.secondary_code','from_warehouse','product_stock','finalize','<html><head><title></title>','product_name','redirect','13402360QWGTsr','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','updateOne','</tbody>','from_invoice','bay','$product_details.invoice','3807nUMEHi','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</thead>','15694XUvPuQ','$finalize','True','QA\x20Warehouse','83290jnYtQA','back','note','findById','Hindi','Router','Chinese','prod_name','$product_details.level','batch_code','TRFF-','3872AVEUPj','error','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details','<strong>\x20Regards\x20</strong>','Rack\x201','language','$product_details.secondary_unit','DRY\x20GOODS','Logo.png','from_room','$product_details.product_code','FGSEmail','product','Arabic\x20(ae)','$product_details.primary_code','transfer_data','$product_details.maxPerUnit','save','split','from_quantity','$product_details.isle','concat','<table\x20style=\x22width:\x20100%\x20!important;\x22>','expiry_date','$from_warehouse','push','Portuguese','MaxStocks_data','$product_details.rack','/transfer_finished/view','/transfer_finished/preview/','role','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','length','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','staff','/preview/:id','to_warehouse','host','primary_unit','German','status','244KOkxki','\x20Order\x20Number\x20:\x20','FROZEN\x20GOODS','To_invoice','<!DOCTYPE\x20html>','Enclosed','\x20Order\x20Date\x20:\x20','2809919AxwwVv','/picking_list/PDF_transfer/','floor','<h2>\x20','site_title','Ambient','to_bay','Rack\x202','errors','transfer_finished','primary_code','flash','maxProducts','log','English\x20(US)','invoice','port','product_date','render','warehouse','There\x27s\x20a\x20error\x20in\x20this\x20transaction','34390NsNiMq','$product_details.storage','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','slice','findOne','from_prod_qty','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','production_date','$product_details.pallet','Portuguese\x20(BR)','to_invoice','<div>','/barcode_scanner2','toString','An\x20error\x20occurred\x20while\x20saving\x20data.','secondary_unit','French','/../public','get','_id','/CheckingWarehouse','$product_details.expiry_date','ToRoomAssigned','body','/view/:id','maxPerUnit','Error\x20Occurs','/view','getMonth','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','to_room_name','to_prod_qty','user','$product_details.type','email','params','success','Transfer\x20Finalize\x20Successfully','padStart','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','sendMail','string','$_id','/barcode_scanner3','post','then','MaxStocks_data2','filter','to_room','<tr>','edit_transfer_finished_view','$product_details.bin','An\x20error\x20occurred.','</span>','secondary_code','from_room_name','from_prod_level','Product\x20Transfer\x20successfully','$product_details.maxProducts','Arabic','<h5>','$product_details.floorlevel','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','New_Qty_Converted','<hr\x20class=\x22my-3\x22>'];a0_0x2e49=function(){return _0x6cb1fb;};return a0_0x2e49();}function a0_0x26e9(_0x1122b6,_0x334f44){var _0x2e497b=a0_0x2e49();return a0_0x26e9=function(_0x26e999,_0x2d47a0){_0x26e999=_0x26e999-0xb0;var _0x25fc32=_0x2e497b[_0x26e999];return _0x25fc32;},a0_0x26e9(_0x1122b6,_0x334f44);}router[a0_0x6ce855(0x13a)]('/view/add_transfer',auth,async(_0x27bdd9,_0x5ec0b4)=>{var _0xbed30f=a0_0x6ce855;try{const {username:_0x1fac18,email:_0x231985,role:_0x4f260f}=_0x27bdd9[_0xbed30f(0x149)],_0x2fb5cb=_0x27bdd9[_0xbed30f(0x149)],_0x4c5914=await profile[_0xbed30f(0x12b)]({'email':_0x2fb5cb[_0xbed30f(0x14b)]}),_0x5c5fee=await master_shop['find']();let _0x58b655;if(_0x2fb5cb[_0xbed30f(0xfd)]==_0xbed30f(0x102)){const _0x35c456=await staff[_0xbed30f(0x12b)]({'email':_0x2fb5cb[_0xbed30f(0x14b)]});_0x58b655=await warehouse[_0xbed30f(0x18a)]([{'$match':{'status':_0xbed30f(0xb3),'name':_0x35c456[_0xbed30f(0x123)],'warehouse_category':_0xbed30f(0x187),'name':{'$ne':_0xbed30f(0xd0)}}},{'$group':{'_id':_0xbed30f(0x16b),'name':{'$first':_0xbed30f(0x16b)}}}]);}else _0x58b655=await warehouse['aggregate']([{'$match':{'status':_0xbed30f(0xb3),'warehouse_category':_0xbed30f(0x187),'name':{'$ne':_0xbed30f(0xd0)}}},{'$group':{'_id':'$name','name':{'$first':_0xbed30f(0x16b)}}}]);const _0x336806=await transfers_finished[_0xbed30f(0x16c)]({}),_0xd1141d=_0x336806[_0xbed30f(0x100)]+0x1,_0x46b550=_0xbed30f(0xdb)+_0xd1141d[_0xbed30f(0x135)]()[_0xbed30f(0x14f)](0x5,'0');if(_0x5c5fee[0x0]['language']==_0xbed30f(0x11e))var _0x221736=users[_0xbed30f(0x16d)];else{if(_0x5c5fee[0x0]['language']==_0xbed30f(0xd5))var _0x221736=users['Hindi'];else{if(_0x5c5fee[0x0][_0xbed30f(0xe3)]==_0xbed30f(0x107))var _0x221736=users['German'];else{if(_0x5c5fee[0x0][_0xbed30f(0xe3)]==_0xbed30f(0x183))var _0x221736=users[_0xbed30f(0x183)];else{if(_0x5c5fee[0x0][_0xbed30f(0xe3)]==_0xbed30f(0x138))var _0x221736=users['French'];else{if(_0x5c5fee[0x0][_0xbed30f(0xe3)]==_0xbed30f(0x131))var _0x221736=users[_0xbed30f(0xf8)];else{if(_0x5c5fee[0x0][_0xbed30f(0xe3)]=='Chinese')var _0x221736=users['Chinese'];else{if(_0x5c5fee[0x0][_0xbed30f(0xe3)]==_0xbed30f(0xeb))var _0x221736=users['Arabic'];}}}}}}}const _0x564520=getRandom8DigitNumber();_0x564520['then'](_0x4e1116=>{var _0x1d3125=_0xbed30f;_0x5ec0b4['render'](_0x1d3125(0x186),{'success':_0x27bdd9[_0x1d3125(0x11b)](_0x1d3125(0x14d)),'errors':_0x27bdd9[_0x1d3125(0x11b)](_0x1d3125(0x118)),'role':_0x2fb5cb,'profile':_0x4c5914,'master_shop':_0x5c5fee,'warehouse':_0x58b655,'language':_0x221736,'invoice':_0x4e1116});})['catch'](_0x2e5993=>{var _0x4e4e1e=_0xbed30f;_0x27bdd9[_0x4e4e1e(0x11b)](_0x4e4e1e(0x118),_0x4e4e1e(0x124)),_0x5ec0b4[_0x4e4e1e(0xc1)](_0x4e4e1e(0x184));});}catch(_0x34eb44){console[_0xbed30f(0x11d)](_0x34eb44);}}),router['post']('/view/add_transfer',auth,async(_0x1bf45b,_0x4fcdc8)=>{var _0x19a6c4=a0_0x6ce855;try{const {date:_0x444661,from_warehouse:_0x5d3bf0,FromRoom_name:_0x5056e7,to_warehouse:_0x95c9db,ToRoom_name:_0x27de0e,prod_name:_0x185d83,from_prod_qty:_0x401fe6,from_prod_level:_0x124961,from_prod_isle:_0xd1302e,from_prod_pallet:_0x5a5e2e,to_prod_qty:_0x2e5293,to_prod_level:_0x122c5a,to_prod_isle:_0x487a3a,to_prod_pallet:_0x1a915f,primary_code:_0x17f221,secondary_code:_0x479d9a,product_code3:_0x5390d2,note:_0x441e44,MaxStocks_data2:_0x4bd2a6,invoice:_0x12bbd6,expiry_date:_0x243852}=_0x1bf45b[_0x19a6c4(0x13f)];if(typeof _0x185d83==_0x19a6c4(0x153))var _0x577400=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0xd8)]],_0x442bfe=[_0x1bf45b[_0x19a6c4(0x13f)]['from_prod_qty']],_0x16d278=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x162)]],_0x1476f1=[_0x1bf45b['body'][_0x19a6c4(0x169)]],_0x568b66=[_0x1bf45b[_0x19a6c4(0x13f)]['to_prod_level']],_0x23bdf8=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x11a)]],_0xf5c046=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x160)]],_0x1c2f4a=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x178)]],_0xe48e67=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x158)]],_0x3c61eb=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x106)]],_0x30c2e1=[_0x1bf45b['body'][_0x19a6c4(0x137)]],_0x5d3944=[_0x1bf45b[_0x19a6c4(0x13f)]['batch_code']],_0x819743=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0xf5)]],_0x523edd=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x121)]],_0x47f329=[_0x1bf45b['body'][_0x19a6c4(0xf9)]],_0x49ceef=[_0x1bf45b[_0x19a6c4(0x13f)]['maxPerUnit']],_0x3af03b=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x17f)]],_0x728566=[_0x1bf45b['body'][_0x19a6c4(0xb7)]],_0x501101=[_0x1bf45b['body'][_0x19a6c4(0x13e)]],_0x3c74a8=[_0x1bf45b['body'][_0x19a6c4(0xc7)]],_0x4defc2=[_0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x132)]];else var _0x577400=[..._0x1bf45b[_0x19a6c4(0x13f)]['prod_name']],_0x442bfe=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x12c)]],_0x16d278=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x162)]],_0x1476f1=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x169)]],_0x568b66=[..._0x1bf45b['body'][_0x19a6c4(0x170)]],_0x23bdf8=[..._0x1bf45b[_0x19a6c4(0x13f)]['primary_code']],_0xf5c046=[..._0x1bf45b[_0x19a6c4(0x13f)]['secondary_code']],_0x1c2f4a=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x178)]],_0xe48e67=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x158)]],_0x3c61eb=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x106)]],_0x30c2e1=[..._0x1bf45b['body'][_0x19a6c4(0x137)]],_0x5d3944=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0xda)]],_0x819743=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0xf5)]],_0x523edd=[..._0x1bf45b[_0x19a6c4(0x13f)]['product_date']],_0x47f329=[..._0x1bf45b[_0x19a6c4(0x13f)]['MaxStocks_data']],_0x49ceef=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x141)]],_0x3af03b=[..._0x1bf45b[_0x19a6c4(0x13f)][_0x19a6c4(0x17f)]],_0x728566=[..._0x1bf45b['body'][_0x19a6c4(0xb7)]],_0x501101=[..._0x1bf45b[_0x19a6c4(0x13f)]['ToRoomAssigned']],_0x3c74a8=[..._0x1bf45b['body']['from_invoice']],_0x4defc2=[..._0x1bf45b['body'][_0x19a6c4(0x132)]];const _0x4b1643=_0x577400[_0x19a6c4(0x150)](_0xdfb9=>{return _0xdfb9={'product_name':_0xdfb9};});_0x442bfe[_0x19a6c4(0xc3)]((_0x360525,_0x418fd1)=>{var _0x1a0d4f=_0x19a6c4;_0x4b1643[_0x418fd1][_0x1a0d4f(0xf1)]=_0x360525;}),_0x16d278[_0x19a6c4(0xc3)]((_0xc3c241,_0x8edf93)=>{var _0x34e226=_0x19a6c4;_0x4b1643[_0x8edf93][_0x34e226(0xb2)]=_0xc3c241;}),_0x3c74a8[_0x19a6c4(0xc3)]((_0x427baa,_0xee312)=>{_0x4b1643[_0xee312]['from_invoice']=_0x427baa;}),_0x4defc2[_0x19a6c4(0xc3)]((_0x21e471,_0x24091f)=>{var _0xa4b304=_0x19a6c4;_0x4b1643[_0x24091f][_0xa4b304(0x10c)]=_0x21e471;}),_0x1476f1[_0x19a6c4(0xc3)]((_0x5f22e3,_0xc3055d)=>{var _0x13e0c2=_0x19a6c4;_0x4b1643[_0xc3055d][_0x13e0c2(0x185)]=_0x5f22e3;}),_0x568b66[_0x19a6c4(0xc3)]((_0x5528a7,_0x3b82c2)=>{var _0x284629=_0x19a6c4;_0x4b1643[_0x3b82c2][_0x284629(0x116)]=_0x5528a7;}),_0x23bdf8[_0x19a6c4(0xc3)]((_0x1ca171,_0xf78da4)=>{var _0x2a93d1=_0x19a6c4;_0x4b1643[_0xf78da4][_0x2a93d1(0x11a)]=_0x1ca171;}),_0xf5c046[_0x19a6c4(0xc3)]((_0x52d257,_0xf36a24)=>{_0x4b1643[_0xf36a24]['secondary_code']=_0x52d257;}),_0x1c2f4a[_0x19a6c4(0xc3)]((_0xe8100,_0x509bc3)=>{var _0x25aa24=_0x19a6c4;_0x4b1643[_0x509bc3][_0x25aa24(0x17c)]=_0xe8100;}),_0xe48e67[_0x19a6c4(0xc3)]((_0x2e0847,_0x87f870)=>{var _0x9330fd=_0x19a6c4;_0x4b1643[_0x87f870][_0x9330fd(0x11c)]=_0x2e0847;}),_0x3c61eb[_0x19a6c4(0xc3)]((_0x3ff0b8,_0x4f2636)=>{_0x4b1643[_0x4f2636]['unit']=_0x3ff0b8;}),_0x30c2e1[_0x19a6c4(0xc3)]((_0x3b7ea8,_0x20b687)=>{var _0x591dd4=_0x19a6c4;_0x4b1643[_0x20b687][_0x591dd4(0x137)]=_0x3b7ea8;}),_0x5d3944[_0x19a6c4(0xc3)]((_0x3ad8fb,_0x17dd1b)=>{var _0x491390=_0x19a6c4;_0x4b1643[_0x17dd1b][_0x491390(0xda)]=_0x3ad8fb;}),_0x819743['forEach']((_0x81c716,_0x2cda2d)=>{var _0x4872c=_0x19a6c4;_0x4b1643[_0x2cda2d][_0x4872c(0xf5)]=_0x81c716;}),_0x523edd[_0x19a6c4(0xc3)]((_0x47b9f1,_0x4aeca1)=>{var _0x33a6fb=_0x19a6c4;_0x4b1643[_0x4aeca1][_0x33a6fb(0x12f)]=_0x47b9f1;}),_0x47f329[_0x19a6c4(0xc3)]((_0x4868ef,_0x1f5074)=>{_0x4b1643[_0x1f5074]['maxProducts']=_0x4868ef;}),_0x49ceef[_0x19a6c4(0xc3)]((_0x210eba,_0x10b4c8)=>{var _0x1fdb4f=_0x19a6c4;_0x4b1643[_0x10b4c8][_0x1fdb4f(0x141)]=_0x210eba;}),_0x3af03b[_0x19a6c4(0xc3)]((_0x35bd15,_0x437301)=>{_0x4b1643[_0x437301]['prod_cat']=_0x35bd15;}),_0x728566[_0x19a6c4(0xc3)]((_0x56dd5f,_0x13442c)=>{var _0x47164e=_0x19a6c4;_0x4b1643[_0x13442c][_0x47164e(0x161)]=_0x56dd5f;}),_0x501101[_0x19a6c4(0xc3)]((_0x2aa023,_0x1f4da5)=>{var _0xf94d35=_0x19a6c4;_0x4b1643[_0x1f4da5][_0xf94d35(0x147)]=_0x2aa023;});const _0x293b1f=_0x4b1643[_0x19a6c4(0x159)](_0x25735a=>_0x25735a[_0x19a6c4(0x185)]!=='0'&&_0x25735a[_0x19a6c4(0x185)]!==''||_0x25735a['to_floorlevel']!=='0'&&_0x25735a[_0x19a6c4(0x17e)]!=='');var _0x2ffb3f=0x0;_0x293b1f['forEach'](_0x64e486=>{var _0x5c46b7=_0x19a6c4;parseInt(_0x64e486[_0x5c46b7(0xf1)])<parseInt(_0x64e486[_0x5c46b7(0x185)])&&_0x2ffb3f++;});if(_0x2ffb3f!=0x0)return _0x1bf45b['flash']('errors',_0x19a6c4(0xba)),_0x4fcdc8[_0x19a6c4(0xc1)](_0x19a6c4(0xd2));const _0x3e6ad6=new transfers_finished({'date':_0x444661,'from_warehouse':_0x5d3bf0,'to_warehouse':_0x95c9db,'product':_0x293b1f,'note':_0x441e44,'invoice':_0x12bbd6}),_0x2ef568=await _0x3e6ad6[_0x19a6c4(0xef)]();_0x1bf45b['flash']('success',_0x19a6c4(0x163)),_0x4fcdc8[_0x19a6c4(0xc1)](_0x19a6c4(0xfc)+_0x2ef568[_0x19a6c4(0x13b)]);}catch(_0x21cf95){console[_0x19a6c4(0x11d)](_0x21cf95),_0x4fcdc8[_0x19a6c4(0x108)](0xc8)['json']({'errorMessage':_0x21cf95[_0x19a6c4(0x176)]});}}),router[a0_0x6ce855(0x13a)](a0_0x6ce855(0x103),auth,async(_0x2cb988,_0x4952fc)=>{var _0x34687d=a0_0x6ce855;try{const {username:_0x2f8c33,email:_0x30d752,role:_0x58ee79}=_0x2cb988['user'],_0x36b90c=_0x2cb988['user'],_0x5dd71a=await profile[_0x34687d(0x12b)]({'email':_0x36b90c[_0x34687d(0x14b)]}),_0x257a77=await master_shop[_0x34687d(0x16c)](),_0x22c51b=await transfers_finished[_0x34687d(0xd4)](_0x2cb988[_0x34687d(0x14c)]['id']);let _0x257d83;if(_0x36b90c['role']==_0x34687d(0x102)){const _0x5b5c81=await staff['findOne']({'email':_0x36b90c['email']});_0x257d83=await warehouse['find']({'status':_0x34687d(0xb3),'name':_0x5b5c81['warehouse'],'warehouse_category':_0x34687d(0x187)});}else _0x257d83=await warehouse[_0x34687d(0x16c)]({'status':_0x34687d(0xb3),'warehouse_category':_0x34687d(0x187)});const _0x42b405=await warehouse[_0x34687d(0x18a)]([{'$match':{'name':_0x22c51b[_0x34687d(0xbc)],'warehouse_category':_0x34687d(0x187)}},{'$unwind':_0x34687d(0xe0)},{'$group':{'_id':_0x34687d(0x174),'name':{'$first':_0x34687d(0xb8)},'product_stock':{'$first':_0x34687d(0x189)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x34687d(0x14a)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x34687d(0xbb)},'product_code':{'$first':_0x34687d(0xe8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x34687d(0xfa)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x34687d(0xb5)},'room':{'$first':'$room'},'warehoue_name':{'$first':_0x34687d(0x16b)}}}]),_0x19ff03=await product[_0x34687d(0x16c)]({});if(_0x257a77[0x0]['language']==_0x34687d(0x11e)){var _0x3c0bda=users[_0x34687d(0x16d)];console[_0x34687d(0x11d)](_0x3c0bda);}else{if(_0x257a77[0x0][_0x34687d(0xe3)]==_0x34687d(0xd5))var _0x3c0bda=users[_0x34687d(0xd5)];else{if(_0x257a77[0x0][_0x34687d(0xe3)]==_0x34687d(0x107))var _0x3c0bda=users['German'];else{if(_0x257a77[0x0][_0x34687d(0xe3)]==_0x34687d(0x183))var _0x3c0bda=users[_0x34687d(0x183)];else{if(_0x257a77[0x0][_0x34687d(0xe3)]==_0x34687d(0x138))var _0x3c0bda=users[_0x34687d(0x138)];else{if(_0x257a77[0x0][_0x34687d(0xe3)]=='Portuguese\x20(BR)')var _0x3c0bda=users['Portuguese'];else{if(_0x257a77[0x0]['language']==_0x34687d(0xd7))var _0x3c0bda=users['Chinese'];else{if(_0x257a77[0x0]['language']==_0x34687d(0xeb))var _0x3c0bda=users[_0x34687d(0x165)];}}}}}}}_0x4952fc['render'](_0x34687d(0x15c),{'success':_0x2cb988[_0x34687d(0x11b)](_0x34687d(0x14d)),'errors':_0x2cb988[_0x34687d(0x11b)]('errors'),'role':_0x36b90c,'profile':_0x5dd71a,'master_shop':_0x257a77,'warehouse':_0x257d83,'transfer':_0x22c51b,'stock':_0x42b405,'unit':_0x19ff03,'language':_0x3c0bda});}catch(_0x4e24eb){console[_0x34687d(0x11d)](_0x4e24eb);}}),router['post'](a0_0x6ce855(0x103),auth,async(_0x3bdd81,_0x35d870)=>{var _0x2bb809=a0_0x6ce855;try{const {invoice:_0x416a9a,from_warehouse:_0x256b28,FromRoom_name:_0x3385f7,to_warehouse:_0x973d0e,ToRoom_name:_0x1f7b7f}=_0x3bdd81[_0x2bb809(0x13f)],_0x50e4ae=await transfers_finished[_0x2bb809(0xd4)](_0x3bdd81['params']['id']),_0x1acfe1=_0x50e4ae['product'][_0x2bb809(0x150)](async _0x250199=>{var _0x2e2e6d=_0x2bb809;if(_0x250199[_0x2e2e6d(0x185)]>0x0){var _0x408099=await warehouse[_0x2e2e6d(0x12b)]({'name':_0x256b28,'room':_0x250199[_0x2e2e6d(0x161)],'warehouse_category':_0x2e2e6d(0x187)});const _0x2001d3=_0x408099[_0x2e2e6d(0x181)][_0x2e2e6d(0x150)](_0x39c6db=>{var _0x2a45a5=_0x2e2e6d;_0x39c6db[_0x2a45a5(0xc0)]==_0x250199['product_name']&&_0x39c6db[_0x2a45a5(0xc8)]==_0x250199['from_bay']&&_0x39c6db[_0x2a45a5(0xf5)]==_0x250199[_0x2a45a5(0xf5)]&&_0x39c6db[_0x2a45a5(0x12f)]==_0x250199[_0x2a45a5(0x12f)]&&_0x39c6db[_0x2a45a5(0xda)]==_0x250199['batch_code']&&_0x39c6db[_0x2a45a5(0x11f)]==_0x250199['from_invoice']&&(_0x39c6db[_0x2a45a5(0xbd)]=_0x39c6db['product_stock']-_0x250199[_0x2a45a5(0x185)]);});}return _0x408099;});Promise['all'](_0x1acfe1)['then'](async _0x4d4601=>{var _0x1e7101=_0x2bb809;try{for(const _0x4bed5d of _0x4d4601){await _0x4bed5d[_0x1e7101(0xef)]();}const _0x2347cf=_0x50e4ae[_0x1e7101(0xea)][_0x1e7101(0x150)](async _0x103892=>{var _0x3c3dbd=_0x1e7101,_0x5a68c2=await warehouse[_0x3c3dbd(0x12b)]({'name':_0x973d0e,'room':_0x103892[_0x3c3dbd(0x147)]});if(_0x103892[_0x3c3dbd(0x185)]>0x0){var _0x1b4f77=0x0;const _0x1765ef=_0x5a68c2['product_details'][_0x3c3dbd(0x150)](_0xcc55df=>{var _0xbd55b4=_0x3c3dbd;_0xcc55df['product_name']==_0x103892[_0xbd55b4(0xc0)]&&_0xcc55df[_0xbd55b4(0xc8)]==_0x103892[_0xbd55b4(0x116)]&&_0xcc55df[_0xbd55b4(0xf5)]==_0x103892[_0xbd55b4(0xf5)]&&_0xcc55df['production_date']==_0x103892[_0xbd55b4(0x12f)]&&_0xcc55df[_0xbd55b4(0xda)]==_0x103892[_0xbd55b4(0xda)]&&_0xcc55df['invoice']==_0x103892[_0xbd55b4(0x10c)]&&(_0xcc55df['product_stock']=_0xcc55df[_0xbd55b4(0xbd)]+_0x103892[_0xbd55b4(0x185)],_0x1b4f77++);});_0x1b4f77=='0'&&(_0x5a68c2[_0x3c3dbd(0x181)]=_0x5a68c2[_0x3c3dbd(0x181)][_0x3c3dbd(0xf3)]({'product_name':_0x103892[_0x3c3dbd(0xc0)],'product_stock':_0x103892[_0x3c3dbd(0x185)],'bay':_0x103892[_0x3c3dbd(0x116)],'product_code':_0x103892[_0x3c3dbd(0x17c)],'primary_code':_0x103892[_0x3c3dbd(0x11a)],'secondary_code':_0x103892[_0x3c3dbd(0x160)],'expiry_date':_0x103892['expiry_date'],'production_date':_0x103892[_0x3c3dbd(0x12f)],'maxProducts':_0x103892[_0x3c3dbd(0x11c)],'batch_code':_0x103892[_0x3c3dbd(0xda)],'secondary_unit':_0x103892[_0x3c3dbd(0x137)],'unit':_0x103892[_0x3c3dbd(0xb9)],'maxProducts':_0x103892[_0x3c3dbd(0x11c)],'maxPerUnit':_0x103892[_0x3c3dbd(0x141)],'invoice':_0x103892['To_invoice']}));}return _0x5a68c2;});Promise['all'](_0x2347cf)[_0x1e7101(0x157)](async _0x29cad9=>{var _0x109aca=_0x1e7101;try{for(const _0x4a3fd1 of _0x29cad9){await warehouse[_0x109aca(0xc5)]({'_id':_0x4a3fd1[_0x109aca(0x13b)]},{'$addToSet':{'product_details':{'$each':_0x4a3fd1['product_details']}}});}_0x50e4ae[_0x109aca(0xbe)]=_0x109aca(0xcf);const _0x48b9ce=await _0x50e4ae['save'](),_0x524e27=await master_shop[_0x109aca(0x16c)](),_0x2c6de8=await email_settings[_0x109aca(0x12b)](),_0x4a2df2=await supervisor_settings['find']();var _0x176010=_0x50e4ae[_0x109aca(0xea)],_0x500cac='',_0x50f3be;for(_0x50f3be in _0x176010){var _0x1c12f8='FG';_0x50e4ae[_0x109aca(0x104)]==_0x109aca(0xe5)&&(_0x1c12f8='DG'),_0x500cac+=_0x109aca(0x15b)+_0x109aca(0x129)+_0x176010[_0x50f3be][_0x109aca(0xc0)]+'</td>'+_0x109aca(0x129)+_0x176010[_0x50f3be][_0x109aca(0x17c)]+_0x109aca(0x175)+_0x109aca(0x129)+_0x176010[_0x50f3be][_0x109aca(0x185)]+_0x109aca(0x175)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x176010[_0x50f3be][_0x109aca(0xb9)]+_0x109aca(0x175)+_0x109aca(0x129)+_0x176010[_0x50f3be][_0x109aca(0x137)]+_0x109aca(0x175)+_0x109aca(0x129)+_0x50e4ae[_0x109aca(0x104)]+_0x109aca(0x175)+_0x109aca(0x129)+_0x176010[_0x50f3be][_0x109aca(0x147)]+_0x109aca(0x175)+_0x109aca(0x129)+_0x1c12f8+_0x176010[_0x50f3be]['to_bay']+_0x109aca(0x175)+_0x109aca(0x180);}let _0x5890d8=nodemailer[_0x109aca(0xb1)]({'host':_0x2c6de8[_0x109aca(0x105)],'port':Number(_0x2c6de8[_0x109aca(0x120)]),'secure':![],'auth':{'user':_0x2c6de8[_0x109aca(0x14b)],'pass':_0x2c6de8['password']}}),_0x3e68ab={'from':_0x2c6de8[_0x109aca(0x14b)],'to':_0x4a2df2[0x0][_0x109aca(0xe9)],'subject':_0x109aca(0x171),'attachments':[{'filename':_0x109aca(0xe6),'path':__dirname+_0x109aca(0x139)+_0x109aca(0xde)+_0x524e27[0x0]['image'],'cid':'logo'}],'html':_0x109aca(0x10d)+_0x109aca(0xbf)+_0x109aca(0x16e)+'<div>'+_0x109aca(0xcb)+_0x109aca(0x133)+_0x109aca(0x101)+_0x109aca(0x172)+'<div>'+_0x109aca(0x113)+_0x524e27[0x0][_0x109aca(0x114)]+_0x109aca(0xfe)+_0x109aca(0x172)+_0x109aca(0x172)+_0x109aca(0x16a)+_0x109aca(0x133)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x109aca(0x10a)+_0x50e4ae[_0x109aca(0x11f)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x109aca(0x10f)+_0x50e4ae['date']+'\x20'+_0x109aca(0x15f)+_0x109aca(0x179)+_0x109aca(0x172)+_0x109aca(0xf4)+_0x109aca(0x182)+'<tr>'+_0x109aca(0x12e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x109aca(0x151)+_0x109aca(0x128)+_0x109aca(0xff)+_0x109aca(0xdf)+_0x109aca(0x146)+_0x109aca(0xc4)+'</tr>'+_0x109aca(0xcc)+_0x109aca(0x173)+'\x20'+_0x500cac+'\x20'+_0x109aca(0xc6)+'</table>'+_0x109aca(0x133)+_0x109aca(0xe1)+_0x109aca(0x166)+_0x524e27[0x0][_0x109aca(0x114)]+_0x109aca(0x179)+'</div>'+_0x109aca(0x172)+'</body></html>'};_0x5890d8[_0x109aca(0x152)](_0x3e68ab,function(_0x24f260,_0x19857d){var _0x54847b=_0x109aca;_0x24f260?(console['log'](_0x24f260),console['log'](_0x54847b(0x142))):console[_0x54847b(0x11d)](_0x54847b(0xb6));}),_0x3bdd81[_0x109aca(0x11b)]('success',_0x109aca(0x14e)),_0x35d870['redirect'](_0x109aca(0x111)+_0x48b9ce[_0x109aca(0x13b)]);}catch(_0x445b6d){console['error'](_0x445b6d),_0x35d870[_0x109aca(0x108)](0x1f4)['json']({'error':_0x109aca(0x168)});}})['catch'](_0x276b29=>{var _0x279f6e=_0x1e7101;console[_0x279f6e(0xdd)](_0x276b29),_0x35d870[_0x279f6e(0x108)](0x1f4)['json']({'error':_0x279f6e(0x15e)});});}catch(_0x366976){console[_0x1e7101(0xdd)](_0x366976),_0x35d870['status'](0x1f4)['json']({'error':_0x1e7101(0x136)});}})[_0x2bb809(0x127)](_0x575625=>{var _0x42d42d=_0x2bb809;console[_0x42d42d(0xdd)](_0x575625),_0x35d870[_0x42d42d(0x108)](0x1f4)['json']({'error':_0x42d42d(0x15e)});});}catch(_0x469258){_0x35d870[_0x2bb809(0x17b)]({'message':_0x469258[_0x2bb809(0x176)]});}});function BayBinSelected(_0x1a49ab,_0x27a4f7){var _0x200fe7=a0_0x6ce855,_0x43b91a=[];let _0x5dd701=[];var _0x5dad81=[];if(_0x1a49ab==_0x200fe7(0xe5)){switch(_0x27a4f7){case _0x200fe7(0xe2):_0x43b91a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x200fe7(0x117):_0x43b91a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x5dad81=['DG'];}else{if(_0x1a49ab==_0x200fe7(0x10b)){switch(_0x27a4f7){case'Rack\x201':_0x43b91a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x43b91a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x5dad81=['FG'];}}return{'levels':_0x43b91a,'identify':_0x5dad81};}router[a0_0x6ce855(0x13a)](a0_0x6ce855(0x140),auth,async(_0x230201,_0xcb617c)=>{var _0x1ce703=a0_0x6ce855;try{const {username:_0x4401d6,email:_0x5ecb7f,role:_0x27a0e1}=_0x230201[_0x1ce703(0x149)],_0xaeb0ca=_0x230201['user'],_0x5ec3f3=await profile[_0x1ce703(0x12b)]({'email':_0xaeb0ca[_0x1ce703(0x14b)]}),_0x5b02af=await master_shop[_0x1ce703(0x16c)](),_0x39ce8a=await transfers_finished[_0x1ce703(0xd4)](_0x230201['params']['id']);let _0x1eba21=new Date(_0x39ce8a[_0x1ce703(0xf5)]),_0x43489b=('0'+_0x1eba21['getDate']())['slice'](-0x2),_0x3f6ea7=('0'+(_0x1eba21[_0x1ce703(0x144)]()+0x1))[_0x1ce703(0x12a)](-0x2),_0x27addf=_0x1eba21['getFullYear'](),_0x23f8d0=_0x27addf+'-'+_0x3f6ea7+'-'+_0x43489b,_0x209344;if(_0xaeb0ca[_0x1ce703(0xfd)]==_0x1ce703(0x102)){const _0x5cbba2=await staff[_0x1ce703(0x12b)]({'email':_0xaeb0ca[_0x1ce703(0x14b)]});_0x209344=await warehouse[_0x1ce703(0x16c)]({'status':_0x1ce703(0xb3),'name':_0x5cbba2['warehouse'],'warehouse_category':_0x1ce703(0x187)});}else _0x209344=await warehouse[_0x1ce703(0x16c)]({'status':_0x1ce703(0xb3),'warehouse_category':_0x1ce703(0x187)});const _0x3f13b5=await warehouse[_0x1ce703(0x18a)]([{'$match':{'name':_0x39ce8a[_0x1ce703(0xbc)],'room':_0x39ce8a[_0x1ce703(0xe7)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1ce703(0x174),'name':{'$first':_0x1ce703(0xb8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1ce703(0xb4)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1ce703(0x14a)},'floorlevel':{'$first':_0x1ce703(0x167)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1ce703(0xbb)},'product_code':{'$first':_0x1ce703(0xe8)},'storage':{'$first':_0x1ce703(0x126)},'rack':{'$first':_0x1ce703(0xfa)}}}]);var _0xe87b80=[0x1,0x2,0x3,0x4],_0x5e53cf=['A','B','C','D','E','F','G','H','I','J'],_0x5a1f31=[_0x1ce703(0x115),_0x1ce703(0x10e)];const _0x1100ee=await product['find']({}),_0x5d32e3=BayBinSelected(_0x39ce8a['to_warehouse'],_0x39ce8a[_0x1ce703(0x15a)]);if(_0x5b02af[0x0][_0x1ce703(0xe3)]=='English\x20(US)'){var _0x489c03=users[_0x1ce703(0x16d)];console[_0x1ce703(0x11d)](_0x489c03);}else{if(_0x5b02af[0x0][_0x1ce703(0xe3)]=='Hindi')var _0x489c03=users[_0x1ce703(0xd5)];else{if(_0x5b02af[0x0][_0x1ce703(0xe3)]==_0x1ce703(0x107))var _0x489c03=users[_0x1ce703(0x107)];else{if(_0x5b02af[0x0]['language']==_0x1ce703(0x183))var _0x489c03=users[_0x1ce703(0x183)];else{if(_0x5b02af[0x0][_0x1ce703(0xe3)]==_0x1ce703(0x138))var _0x489c03=users[_0x1ce703(0x138)];else{if(_0x5b02af[0x0][_0x1ce703(0xe3)]==_0x1ce703(0x131))var _0x489c03=users[_0x1ce703(0xf8)];else{if(_0x5b02af[0x0][_0x1ce703(0xe3)]==_0x1ce703(0xd7))var _0x489c03=users[_0x1ce703(0xd7)];else{if(_0x5b02af[0x0][_0x1ce703(0xe3)]==_0x1ce703(0xeb))var _0x489c03=users[_0x1ce703(0x165)];}}}}}}}_0xcb617c['render']('edit_transfer_finished',{'success':_0x230201[_0x1ce703(0x11b)](_0x1ce703(0x14d)),'errors':_0x230201[_0x1ce703(0x11b)](_0x1ce703(0x118)),'role':_0xaeb0ca,'profile':_0x5ec3f3,'master_shop':_0x5b02af,'warehouse':_0x209344,'transfer':_0x39ce8a,'stock':_0x3f13b5,'unit':_0x1100ee,'language':_0x489c03,'levels':_0xe87b80,'Isle':_0x5e53cf,'rooms_data':_0x5a1f31,'ed_fullDate':_0x23f8d0,'dataSelected':_0x5d32e3});}catch(_0x435521){console[_0x1ce703(0x11d)](_0x435521);}}),router['post']('/view/:id',auth,async(_0x98eba1,_0x297ba4)=>{var _0x1e938b=a0_0x6ce855;try{const _0x110039=_0x98eba1[_0x1e938b(0x14c)]['id'];console[_0x1e938b(0x11d)](_0x98eba1['body']);const _0x2c24c1=await transfers_finished[_0x1e938b(0xd4)](_0x110039);console[_0x1e938b(0x11d)](_0x1e938b(0xed),_0x2c24c1);const {date:_0x3036c4,from_warehouse:_0x1d94d0,FromRoom_name:_0x275409,to_warehouse:_0x36fa9f,ToRoom_name:_0xe7a52c,prod_name:_0x5519f6,from_prod_qty:_0x2474ff,from_prod_level:_0x413010,from_prod_isle:_0x269b29,from_prod_pallet:_0x53f12f,to_prod_qty:_0x1a7075,to_prod_level:_0x3c85f5,to_prod_isle:_0x84469f,to_prod_pallet:_0x430952,primary_code:_0x50ace4,secondary_code:_0x335f07,product_code3:_0x51dcf6,note:_0x26ea93,invoice:_0x4d1fe5,expiry_date:_0x5b55d7}=_0x98eba1[_0x1e938b(0x13f)];if(typeof _0x5519f6==_0x1e938b(0x153))var _0x53d2b8=[_0x98eba1[_0x1e938b(0x13f)]['prod_name']],_0x3a79a4=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x12c)]],_0x485f94=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x162)]],_0x3d7b0f=[_0x98eba1[_0x1e938b(0x13f)]['to_prod_qty']],_0x38a96a=[_0x98eba1[_0x1e938b(0x13f)]['to_prod_level']],_0x4f4463=[_0x98eba1['body']['primary_code']],_0x158265=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x160)]],_0x3a988c=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x178)]],_0x4adfce=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x158)]],_0x3aed6a=[_0x98eba1[_0x1e938b(0x13f)]['unit']],_0x4f117f=[_0x98eba1['body'][_0x1e938b(0x137)]],_0x4b46ee=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0xda)]],_0x50e8ed=[_0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0xf5)]];else var _0x53d2b8=[..._0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0xd8)]],_0x3a79a4=[..._0x98eba1['body'][_0x1e938b(0x12c)]],_0x485f94=[..._0x98eba1[_0x1e938b(0x13f)]['from_prod_level']],_0x3d7b0f=[..._0x98eba1['body'][_0x1e938b(0x148)]],_0x38a96a=[..._0x98eba1[_0x1e938b(0x13f)]['to_prod_level']],_0x4f4463=[..._0x98eba1['body'][_0x1e938b(0x11a)]],_0x158265=[..._0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x160)]],_0x3a988c=[..._0x98eba1['body'][_0x1e938b(0x178)]],_0x4adfce=[..._0x98eba1[_0x1e938b(0x13f)][_0x1e938b(0x158)]],_0x3aed6a=[..._0x98eba1['body'][_0x1e938b(0xb9)]],_0x4f117f=[..._0x98eba1[_0x1e938b(0x13f)]['secondary_unit']],_0x4b46ee=[..._0x98eba1['body'][_0x1e938b(0xda)]],_0x50e8ed=[..._0x98eba1['body'][_0x1e938b(0xf5)]];const _0x163d2e=_0x53d2b8[_0x1e938b(0x150)](_0x20f441=>{return _0x20f441={'product_name':_0x20f441};});_0x3a79a4[_0x1e938b(0xc3)]((_0x125db2,_0x37f628)=>{var _0x336e1b=_0x1e938b;_0x163d2e[_0x37f628][_0x336e1b(0xf1)]=_0x125db2;}),_0x485f94[_0x1e938b(0xc3)]((_0x4f7278,_0x55e02a)=>{var _0xb3c78b=_0x1e938b;_0x163d2e[_0x55e02a][_0xb3c78b(0xb2)]=_0x4f7278;}),_0x3d7b0f[_0x1e938b(0xc3)]((_0x49b82f,_0x1e37d8)=>{var _0x5cc6f1=_0x1e938b;_0x163d2e[_0x1e37d8][_0x5cc6f1(0x185)]=_0x49b82f;}),_0x38a96a[_0x1e938b(0xc3)]((_0x1d0923,_0xc0cc7a)=>{var _0x2e7fb0=_0x1e938b;_0x163d2e[_0xc0cc7a][_0x2e7fb0(0x116)]=_0x1d0923;}),_0x4f4463[_0x1e938b(0xc3)]((_0x37a843,_0x198bf1)=>{var _0x2eb2fb=_0x1e938b;_0x163d2e[_0x198bf1][_0x2eb2fb(0x11a)]=_0x37a843;}),_0x158265[_0x1e938b(0xc3)]((_0x10b960,_0x3e2497)=>{var _0x4b1c6b=_0x1e938b;_0x163d2e[_0x3e2497][_0x4b1c6b(0x160)]=_0x10b960;}),_0x3a988c[_0x1e938b(0xc3)]((_0x554cd7,_0x790084)=>{var _0x5622b9=_0x1e938b;_0x163d2e[_0x790084][_0x5622b9(0x17c)]=_0x554cd7;}),_0x4adfce[_0x1e938b(0xc3)]((_0x4cf247,_0x38df59)=>{var _0x21aa8f=_0x1e938b;_0x163d2e[_0x38df59][_0x21aa8f(0x11c)]=_0x4cf247;}),_0x3aed6a[_0x1e938b(0xc3)]((_0x311a3b,_0x4e1ef0)=>{var _0x3b3689=_0x1e938b;_0x163d2e[_0x4e1ef0][_0x3b3689(0xb9)]=_0x311a3b;}),_0x4f117f[_0x1e938b(0xc3)]((_0xa8056a,_0x4c5a7d)=>{var _0x485113=_0x1e938b;_0x163d2e[_0x4c5a7d][_0x485113(0x137)]=_0xa8056a;}),_0x4b46ee[_0x1e938b(0xc3)]((_0x28680d,_0x31c1ce)=>{var _0xff0de8=_0x1e938b;_0x163d2e[_0x31c1ce][_0xff0de8(0xda)]=_0x28680d;}),_0x50e8ed[_0x1e938b(0xc3)]((_0x3d0dc7,_0x55c3e0)=>{var _0x55f2e5=_0x1e938b;_0x163d2e[_0x55c3e0][_0x55f2e5(0xf5)]=_0x3d0dc7;});const _0x5d55c8=_0x163d2e[_0x1e938b(0x159)](_0x4955de=>_0x4955de[_0x1e938b(0x185)]!=='0'&&_0x4955de['to_quantity']!==''||_0x4955de[_0x1e938b(0x17e)]!=='0'&&_0x4955de[_0x1e938b(0x17e)]!=='');var _0x2c1ed9=0x0;_0x5d55c8[_0x1e938b(0xc3)](_0x2794d2=>{var _0x3663ff=_0x1e938b;parseInt(_0x2794d2[_0x3663ff(0xf1)])<parseInt(_0x2794d2['to_quantity'])&&_0x2c1ed9++;});if(_0x2c1ed9!=0x0)return _0x98eba1[_0x1e938b(0x11b)]('errors',_0x1e938b(0xba)),_0x297ba4['redirect']('back');const _0x38b489=await warehouse[_0x1e938b(0x12b)]({'name':_0x2c24c1['from_warehouse'],'room':_0x2c24c1[_0x1e938b(0xe7)]});_0x2c24c1[_0x1e938b(0xea)][_0x1e938b(0xc3)](_0x1da69c=>{var _0x39212e=_0x1e938b;if(_0x1da69c[_0x39212e(0x185)]>0x0){const _0x3cadd8=_0x38b489[_0x39212e(0x181)][_0x39212e(0x150)](_0x120910=>{var _0x1fdd97=_0x39212e;_0x120910['product_name']==_0x1da69c['product_name']&&_0x120910[_0x1fdd97(0xc8)]==_0x1da69c[_0x1fdd97(0xb2)]&&(_0x120910['product_stock']=parseInt(_0x120910[_0x1fdd97(0xbd)])+parseInt(_0x1da69c[_0x1fdd97(0x185)]));});}}),await _0x38b489[_0x1e938b(0xef)]();const _0x4ea8ee=await warehouse[_0x1e938b(0x12b)]({'name':_0x2c24c1[_0x1e938b(0x104)],'room':_0x2c24c1['to_room']});_0x2c24c1['product']['forEach'](_0x481e2b=>{var _0x3befcd=_0x1e938b;if(_0x481e2b['to_quantity']>0x0){const _0x416460=_0x4ea8ee[_0x3befcd(0x181)][_0x3befcd(0x150)](_0x531e9f=>{var _0x2c9872=_0x3befcd;_0x531e9f['product_name']==_0x481e2b[_0x2c9872(0xc0)]&&_0x531e9f[_0x2c9872(0xc8)]==_0x481e2b[_0x2c9872(0x116)]&&(_0x531e9f[_0x2c9872(0xbd)]=parseInt(_0x531e9f['product_stock'])-parseInt(_0x481e2b[_0x2c9872(0x185)]));});}}),await _0x4ea8ee[_0x1e938b(0xef)](),_0x2c24c1['date']=_0x3036c4,_0x2c24c1[_0x1e938b(0xbc)]=_0x1d94d0,_0x2c24c1[_0x1e938b(0x104)]=_0x36fa9f,_0x2c24c1[_0x1e938b(0xea)]=_0x5d55c8,_0x2c24c1[_0x1e938b(0xd3)]=_0x26ea93,_0x2c24c1[_0x1e938b(0x11f)]=_0x4d1fe5;const _0x58bb99=await _0x2c24c1[_0x1e938b(0xef)](),_0x4dd68b=await warehouse['findOne']({'name':_0x1d94d0,'room':_0x275409});_0x58bb99[_0x1e938b(0xea)][_0x1e938b(0xc3)](_0x2d99bc=>{var _0x25f3af=_0x1e938b;if(_0x2d99bc[_0x25f3af(0x185)]>0x0){const _0x811d4e=_0x4dd68b[_0x25f3af(0x181)][_0x25f3af(0x150)](_0x604e67=>{var _0x59f7fd=_0x25f3af;_0x604e67[_0x59f7fd(0xc0)]==_0x2d99bc[_0x59f7fd(0xc0)]&&_0x604e67[_0x59f7fd(0xc8)]==_0x2d99bc[_0x59f7fd(0xb2)]&&(_0x604e67[_0x59f7fd(0xbd)]=parseInt(_0x604e67['product_stock'])-parseInt(_0x2d99bc['to_quantity']));});}}),await _0x4dd68b[_0x1e938b(0xef)]();const _0x5e6fe0=await warehouse['findOne']({'name':_0x36fa9f,'room':_0xe7a52c});_0x58bb99['product'][_0x1e938b(0xc3)](_0x74e033=>{var _0x7d0ac0=_0x1e938b;if(_0x74e033['to_quantity']>0x0){var _0x24e4f7=0x0;const _0x450d0f=_0x5e6fe0[_0x7d0ac0(0x181)][_0x7d0ac0(0x150)](_0x1dc7ef=>{var _0x11b8d7=_0x7d0ac0;_0x1dc7ef[_0x11b8d7(0xc0)]==_0x74e033[_0x11b8d7(0xc0)]&&_0x1dc7ef[_0x11b8d7(0xc8)]==_0x74e033[_0x11b8d7(0x116)]&&(_0x1dc7ef[_0x11b8d7(0xbd)]=parseInt(_0x1dc7ef[_0x11b8d7(0xbd)])+parseInt(_0x74e033[_0x11b8d7(0x185)]),_0x24e4f7++);});_0x24e4f7=='0'&&(_0x5e6fe0[_0x7d0ac0(0x181)]=_0x5e6fe0[_0x7d0ac0(0x181)]['concat']({'product_name':_0x74e033[_0x7d0ac0(0xc0)],'product_stock':_0x74e033['to_quantity'],'bay':_0x74e033['to_bay'],'product_code':_0x74e033[_0x7d0ac0(0x17c)],'primary_code':_0x74e033[_0x7d0ac0(0x11a)],'secondary_code':_0x74e033[_0x7d0ac0(0x160)],'maxProducts':_0x74e033[_0x7d0ac0(0x11c)]}));}}),await _0x5e6fe0[_0x1e938b(0xef)](),_0x98eba1[_0x1e938b(0x11b)](_0x1e938b(0x14d),_0x1e938b(0x18b)),_0x297ba4[_0x1e938b(0xc1)](_0x1e938b(0xfb));}catch(_0x4f9ff9){console[_0x1e938b(0x11d)](_0x4f9ff9);}}),router['post']('/barcode_scanner',async(_0x40cef2,_0x3949fd)=>{var _0x37964a=a0_0x6ce855;const {FromWareHouse:_0x457626,FromRoom:_0x118110,ToWarehouse:_0x575d95,ToRoom:_0x549137,primary_code:_0x5285ee,Roomslist:_0x4edd9d}=_0x40cef2['body'],_0x327380=_0x4edd9d[_0x37964a(0xf0)](','),_0x309531=[];async function _0x5edbcc(_0x4ace05){var _0x40f51c=_0x37964a;const _0x4b4bca=await warehouse[_0x40f51c(0x18a)]([{'$match':{'name':_0x457626,'room':_0x4ace05}},{'$unwind':_0x40f51c(0xe0)},{'$match':{'product_details.primary_code':_0x5285ee}},{'$group':{'_id':_0x40f51c(0x174),'name':{'$first':_0x40f51c(0xb8)},'instock':{'$first':_0x40f51c(0x189)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x40f51c(0xbb)},'product_code':{'$first':_0x40f51c(0xe8)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x40f51c(0x15d)},'type':{'$first':_0x40f51c(0x14a)},'pallet':{'$first':_0x40f51c(0x167)},'unit':{'$first':_0x40f51c(0x188)},'secondary_unit':{'$first':_0x40f51c(0xe4)},'storage':{'$first':_0x40f51c(0x126)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x40f51c(0xb5)},'batch_code':{'$first':_0x40f51c(0xb0)},'maxPerUnit':{'$first':_0x40f51c(0xee)},'roomNamed':{'$first':'$room'},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x3ad40f=await warehouse[_0x40f51c(0x18a)]([{'$match':{'name':_0x457626,'room':_0x4ace05}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x5285ee}},{'$group':{'_id':_0x40f51c(0x174),'name':{'$first':_0x40f51c(0xb8)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x40f51c(0xec)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x40f51c(0xe8)},'level':{'$first':_0x40f51c(0xb4)},'isle':{'$first':_0x40f51c(0x15d)},'type':{'$first':_0x40f51c(0x14a)},'pallet':{'$first':_0x40f51c(0x167)},'unit':{'$first':_0x40f51c(0x188)},'secondary_unit':{'$first':_0x40f51c(0xe4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x40f51c(0xb5)},'batch_code':{'$first':_0x40f51c(0xb0)},'maxPerUnit':{'$first':_0x40f51c(0xee)},'roomNamed':{'$first':_0x40f51c(0x17a)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x40f51c(0xc9)}}}]);if(_0x4b4bca[_0x40f51c(0x100)]>0x0)_0x309531[_0x40f51c(0xf7)](_0x4b4bca);else _0x3ad40f[_0x40f51c(0x100)]>0x0&&_0x309531[_0x40f51c(0xf7)](_0x3ad40f);}const _0x4746b5=_0x327380[_0x37964a(0x150)](_0x1d0c9a=>_0x5edbcc(_0x1d0c9a));await Promise['all'](_0x4746b5),_0x3949fd[_0x37964a(0x17b)](_0x309531);}),router[a0_0x6ce855(0x156)](a0_0x6ce855(0x134),async(_0x9146bc,_0x5b7eb6)=>{var _0x268e8d=a0_0x6ce855;try{const {FromWareHouse:_0xb619ea,FromRoom:_0x56ce74,ToWarehouse:_0x2b5c13,ToRoom:_0x423c05,secondary_code:_0xfc7b29}=_0x9146bc[_0x268e8d(0x13f)],_0x288696=await warehouse[_0x268e8d(0x18a)]([{'$match':{'name':_0xb619ea}},{'$unwind':_0x268e8d(0xe0)},{'$match':{'product_details.secondary_code':_0xfc7b29}},{'$group':{'_id':_0x268e8d(0x174),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x268e8d(0xec)},'secondary_code':{'$first':_0x268e8d(0xbb)},'product_code':{'$first':_0x268e8d(0xe8)},'instock':{'$first':'$product_details.product_stock'},'warehouse':{'$first':'$name'},'level':{'$first':_0x268e8d(0xd9)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x268e8d(0x130)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x268e8d(0x188)},'expiry_date':{'$first':_0x268e8d(0x13d)},'production_date':{'$first':_0x268e8d(0xb5)}}}]);_0x5b7eb6[_0x268e8d(0x108)](0xc8)[_0x268e8d(0x17b)](_0x288696);}catch(_0x516461){_0x5b7eb6[_0x268e8d(0x108)](0x194)[_0x268e8d(0x17b)]({'message':_0x516461[_0x268e8d(0x176)]});}}),router[a0_0x6ce855(0x156)](a0_0x6ce855(0x155),async(_0x57c372,_0x5ce9a1)=>{var _0x4d1fe7=a0_0x6ce855;try{const {FromWareHouse:_0x527bb6,FromRoom:_0x318309,ToWarehouse:_0x4e6f3e,ToRoom:_0x14b52d,product_code:_0x159c41}=_0x57c372['body'],_0x4e8221=await warehouse[_0x4d1fe7(0x18a)]([{'$match':{'name':_0x527bb6}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x159c41}},{'$group':{'_id':_0x4d1fe7(0x174),'name':{'$first':'$product_details.product_name'},'primary_code':{'$first':_0x4d1fe7(0xec)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x4d1fe7(0x189)},'warehouse':{'$first':_0x4d1fe7(0x16b)},'level':{'$first':_0x4d1fe7(0xd9)},'isle':{'$first':_0x4d1fe7(0xf2)},'pallet':{'$first':_0x4d1fe7(0x130)},'maxProducts':{'$first':_0x4d1fe7(0x164)},'unit':{'$first':_0x4d1fe7(0x188)}}}]);_0x5ce9a1[_0x4d1fe7(0x108)](0xc8)[_0x4d1fe7(0x17b)](_0x4e8221);}catch(_0x2c547c){_0x5ce9a1[_0x4d1fe7(0x108)](0x194)[_0x4d1fe7(0x17b)]({'message':_0x2c547c[_0x4d1fe7(0x176)]});}}),router[a0_0x6ce855(0x156)](a0_0x6ce855(0x13c),async(_0x38489c,_0x3e7c3c)=>{var _0x1b63f8=a0_0x6ce855;const {productCode:_0x2c2b76,bay:_0x17cafa,warehouses:_0x5b79b1,room:_0x478ae6}=_0x38489c[_0x1b63f8(0x13f)];console['log'](_0x38489c[_0x1b63f8(0x13f)]);try{const _0x2e382b=await warehouse['aggregate']([{'$match':{'name':_0x5b79b1,'room':_0x478ae6}},{'$unwind':_0x1b63f8(0xe0)},{'$match':{'product_details.bay':parseInt(_0x17cafa)}},{'$group':{'_id':_0x1b63f8(0x174),'name':{'$first':_0x1b63f8(0xb8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1b63f8(0xb4)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3e7c3c[_0x1b63f8(0x108)](0xc8)[_0x1b63f8(0x17b)](_0x2e382b);}catch(_0x5243ec){_0x3e7c3c[_0x1b63f8(0x108)](0x194)[_0x1b63f8(0x17b)]({'message':_0x5243ec['message']});}}),module['exports']=router;