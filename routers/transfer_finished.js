var a0_0x383b8c=a0_0x46ec;(function(_0x4e8758,_0x3c1b36){var _0x3f43cf=a0_0x46ec,_0x7de97b=_0x4e8758();while(!![]){try{var _0x4292ae=-parseInt(_0x3f43cf(0x17a))/0x1*(parseInt(_0x3f43cf(0x159))/0x2)+parseInt(_0x3f43cf(0x1b5))/0x3+parseInt(_0x3f43cf(0x204))/0x4+parseInt(_0x3f43cf(0x1c8))/0x5+-parseInt(_0x3f43cf(0x15b))/0x6+parseInt(_0x3f43cf(0x1fe))/0x7+-parseInt(_0x3f43cf(0x1c2))/0x8;if(_0x4292ae===_0x3c1b36)break;else _0x7de97b['push'](_0x7de97b['shift']());}catch(_0x15ed4e){_0x7de97b['push'](_0x7de97b['shift']());}}}(a0_0x4cd9,0x68c31));function a0_0x4cd9(){var _0x3d5152=['$product_details.pallet','date','English','Enclosed','invoice','French','back','errors','Portuguese\x20(BR)','Transfer\x20Mail','to_warehouse','$product_details.invoice','to_prod_qty','ToRoomAssigned','Rack\x202','../middleware/auth','aggregate','then','/barcode_scanner','primary_code','transfer_data','edit_transfer_finished','$invoice','/barcode_scanner3','English\x20(US)','$name','</td>','push','find','exports','New_Qty_Converted','810670IDiVhv','all','1889142iezVbC','to_invoice','length','bay','maxProducts','warehouse','abs','to_prod_level','/transfer_finished/preview/','body','$_id','email','production_date','Router','error','$product_details.bay','$from_warehouse','$product_details.production_date','TRFF-','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.maxPerUnit','/transfer_finished/view','$product_details.type','Product\x20Transfer\x20successfully','max','<!DOCTYPE\x20html>','$product.to_room_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','language','<strong>\x20Regards\x20</strong>','1ZDFbFK','success','here2','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Enabled','sendMail','staff','add_transfer_finished','$product_details.batch_code','product','</thead>','unit','Logo.png','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<html><head><title></title>','getMonth','product_date','nodemailer','</table>','role','Portuguese','forEach','createTransport','$date','Hindi','id_transaction','redirect','$product_details.bin','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','QA\x20Warehouse','findById','Ambient','message','image','$product','$product_details._id','log','$product_details.expiry_date','Arabic\x20(ae)','\x20Order\x20Number\x20:\x20','Transfer\x20Finalize\x20Successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.level','site_title','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','from_quantity','Transfer\x20Edit\x20Successfully','_id','json','filter','to_quantity','prod_cat','map','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','</tbody>','primary_unit','maxPerUnit','665535VBQMQP','$product_details.isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','German','$product_details.secondary_unit','Rack\x201','undefined','/transfer/view','/view/add_transfer','product_name','catch','<hr\x20class=\x22my-3\x22>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','4631488FJkWeF','<table\x20style=\x22width:\x20100%\x20!important;\x22>','from_bay','$product_details.product_stock','$finalize','\x20<>\x20','2028330taLWuB','status','$product_details.storage','from_room_name','/upload/','RoomAssigned','$product_details.secondary_code','from_prod_level','here1','FROZEN\x20GOODS','from_prod_qty','</tr>','slice','$product_details.primary_code','<h5\x20style=\x22text-align:\x20left;\x22>','from_warehouse','params','prod_name','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','findOne','product_code3','FGSEmail','To_invoice','DRY\x20GOODS','padStart','concat','Chinese','user','split','to_room','\x20</h2>','</head><body>','$room','batch_code','\x20Order\x20Date\x20:\x20','MaxStocks_data2','An\x20error\x20occurred\x20while\x20saving\x20data.','get','</div>','to_floorlevel','$product_details.floorlevel','expiry_date','../public/language/languages.json','from_invoice','/view','$product_details.rack','Finished\x20Goods','render','secondary_code','/view/:id','<tr>','MaxStocks_data','<span\x20style=\x22float:\x20right;\x22>','2069039qkvAeb','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','to_bay','$product_details.maxProducts','Arabic','3220580QOKEax','updateOne','product_details','$product_details','$product_details.unit','product_code','$product_details.product_name','Error\x20Occurs','from_room','transfer_finished','to_room_name','secondary_unit','/preview/:id','string','</h5>','True','$product_details.product_code','<div>','note','flash','Spanish','post','express','</body></html>'];a0_0x4cd9=function(){return _0x3d5152;};return a0_0x4cd9();}const express=require(a0_0x383b8c(0x21a)),app=express(),router=express[a0_0x383b8c(0x168)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x383b8c(0x22b)),users=require(a0_0x383b8c(0x1f3)),nodemailer=require(a0_0x383b8c(0x18b));router[a0_0x383b8c(0x1ee)](a0_0x383b8c(0x1f5),auth,async(_0x4cd053,_0x21d391)=>{var _0x2299fb=a0_0x383b8c;try{const {username:_0x44153f,email:_0x42e602,role:_0x3379fc}=_0x4cd053['user'],_0x105dc9=_0x4cd053[_0x2299fb(0x1e4)],_0x4a34f0=await profile['findOne']({'email':_0x105dc9[_0x2299fb(0x166)]}),_0x33ac35=await master_shop[_0x2299fb(0x238)]();let _0x4abee6;if(_0x105dc9['role']==_0x2299fb(0x180)){const _0x4816bd=await staff['findOne']({'email':_0x105dc9[_0x2299fb(0x166)]});_0x4abee6=await transfers_finished[_0x2299fb(0x238)]({'from_warehouse':_0x4816bd[_0x2299fb(0x160)]});}else _0x4abee6=await transfers_finished['aggregate']([{'$unwind':_0x2299fb(0x19c)},{'$group':{'_id':_0x2299fb(0x165),'invoice':{'$first':_0x2299fb(0x232)},'date':{'$first':_0x2299fb(0x191)},'from_warehouse':{'$first':_0x2299fb(0x16b)},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':'$product.from_room_name'},'to_room_name':{'$addToSet':_0x2299fb(0x176)},'finalize':{'$first':_0x2299fb(0x1c6)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x33ac35[0x0][_0x2299fb(0x178)]==_0x2299fb(0x234))var _0x4596c9=users[_0x2299fb(0x21e)];else{if(_0x33ac35[0x0]['language']==_0x2299fb(0x192))var _0x4596c9=users[_0x2299fb(0x192)];else{if(_0x33ac35[0x0][_0x2299fb(0x178)]==_0x2299fb(0x1b8))var _0x4596c9=users['German'];else{if(_0x33ac35[0x0][_0x2299fb(0x178)]==_0x2299fb(0x218))var _0x4596c9=users['Spanish'];else{if(_0x33ac35[0x0][_0x2299fb(0x178)]==_0x2299fb(0x221))var _0x4596c9=users[_0x2299fb(0x221)];else{if(_0x33ac35[0x0][_0x2299fb(0x178)]==_0x2299fb(0x224))var _0x4596c9=users[_0x2299fb(0x18e)];else{if(_0x33ac35[0x0]['language']=='Chinese')var _0x4596c9=users[_0x2299fb(0x1e3)];else{if(_0x33ac35[0x0][_0x2299fb(0x178)]==_0x2299fb(0x1a0))var _0x4596c9=users[_0x2299fb(0x203)];}}}}}}}_0x21d391[_0x2299fb(0x1f8)](_0x2299fb(0x20d),{'success':_0x4cd053[_0x2299fb(0x217)](_0x2299fb(0x17b)),'errors':_0x4cd053[_0x2299fb(0x217)](_0x2299fb(0x223)),'role':_0x105dc9,'profile':_0x4a34f0,'master_shop':_0x33ac35,'transfer':_0x4abee6,'language':_0x4596c9});}catch(_0x2a9dbe){console[_0x2299fb(0x19e)](_0x2a9dbe);}});async function getRandom8DigitNumber(){var _0x1ef331=a0_0x383b8c;const _0x33a2f2=0x989680,_0x41ac02=0x5f5e0ff,_0x22ad8b=Math['floor'](Math['random']()*(_0x41ac02-_0x33a2f2+0x1))+_0x33a2f2;var _0x44cbcb;const _0x32eb99=await transfers_finished[_0x1ef331(0x1dc)]({'invoice':_0x1ef331(0x16d)+_0x22ad8b});return _0x32eb99&&_0x32eb99[_0x1ef331(0x15d)]>0x0?_0x44cbcb=_0x1ef331(0x16d)+_0x22ad8b:_0x44cbcb='TRFF-'+_0x22ad8b,_0x44cbcb;}router[a0_0x383b8c(0x1ee)](a0_0x383b8c(0x1bd),auth,async(_0x24ef2f,_0xe03af4)=>{var _0x11b124=a0_0x383b8c;try{const {username:_0x36adc4,email:_0x1653aa,role:_0x3f0426}=_0x24ef2f[_0x11b124(0x1e4)],_0xa289cb=_0x24ef2f[_0x11b124(0x1e4)],_0xc5820b=await profile['findOne']({'email':_0xa289cb['email']}),_0x2e3fe1=await master_shop[_0x11b124(0x238)]();let _0x39f7a4;if(_0xa289cb['role']==_0x11b124(0x180)){const _0xcc090=await staff[_0x11b124(0x1dc)]({'email':_0xa289cb[_0x11b124(0x166)]});_0x39f7a4=await warehouse[_0x11b124(0x22c)]([{'$match':{'status':_0x11b124(0x17e),'name':_0xcc090[_0x11b124(0x160)],'warehouse_category':_0x11b124(0x1f7),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x11b124(0x235),'name':{'$first':_0x11b124(0x235)}}}]);}else _0x39f7a4=await warehouse[_0x11b124(0x22c)]([{'$match':{'status':_0x11b124(0x17e),'warehouse_category':_0x11b124(0x1f7),'name':{'$ne':_0x11b124(0x197)}}},{'$group':{'_id':_0x11b124(0x235),'name':{'$first':'$name'}}}]);const _0x50291a=await transfers_finished[_0x11b124(0x238)]({}),_0x47a092=_0x50291a[_0x11b124(0x15d)]+0x1,_0x1d890e=_0x11b124(0x16d)+_0x47a092['toString']()[_0x11b124(0x1e1)](0x5,'0');if(_0x2e3fe1[0x0][_0x11b124(0x178)]==_0x11b124(0x234))var _0x4e1c55=users['English'];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]=='Hindi')var _0x4e1c55=users[_0x11b124(0x192)];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]==_0x11b124(0x1b8))var _0x4e1c55=users['German'];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]==_0x11b124(0x218))var _0x4e1c55=users['Spanish'];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]=='French')var _0x4e1c55=users['French'];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]=='Portuguese\x20(BR)')var _0x4e1c55=users[_0x11b124(0x18e)];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]==_0x11b124(0x1e3))var _0x4e1c55=users[_0x11b124(0x1e3)];else{if(_0x2e3fe1[0x0][_0x11b124(0x178)]==_0x11b124(0x1a0))var _0x4e1c55=users[_0x11b124(0x203)];}}}}}}}const _0x2066fd=getRandom8DigitNumber();_0x2066fd[_0x11b124(0x22d)](_0x5c1f2c=>{var _0x4e2f1d=_0x11b124;_0xe03af4['render'](_0x4e2f1d(0x181),{'success':_0x24ef2f['flash'](_0x4e2f1d(0x17b)),'errors':_0x24ef2f[_0x4e2f1d(0x217)](_0x4e2f1d(0x223)),'role':_0xa289cb,'profile':_0xc5820b,'master_shop':_0x2e3fe1,'warehouse':_0x39f7a4,'language':_0x4e1c55,'invoice':_0x5c1f2c});})[_0x11b124(0x1bf)](_0x3ef530=>{var _0xb1a8f3=_0x11b124;_0x24ef2f[_0xb1a8f3(0x217)](_0xb1a8f3(0x223),_0xb1a8f3(0x187)),_0xe03af4[_0xb1a8f3(0x194)](_0xb1a8f3(0x1bc));});}catch(_0x52a929){console[_0x11b124(0x19e)](_0x52a929);}}),router['post'](a0_0x383b8c(0x1bd),auth,async(_0x1d0c3b,_0xb3902f)=>{var _0x10c573=a0_0x383b8c;try{const {date:_0x42305e,from_warehouse:_0x5529b6,FromRoom_name:_0x1de3b1,to_warehouse:_0xb11983,ToRoom_name:_0x3a75b9,prod_name:_0x2740cd,from_prod_qty:_0x490f9e,from_prod_level:_0x3bd0b3,from_prod_isle:_0x40a9e6,from_prod_pallet:_0x46cc83,to_prod_qty:_0x29b3b8,to_prod_level:_0x42ab28,to_prod_isle:_0x58c213,to_prod_pallet:_0x4cad09,primary_code:_0x90a968,secondary_code:_0x2bb937,product_code3:_0x36d7a3,note:_0x1e9aa1,MaxStocks_data2:_0x2f8333,invoice:_0x4233fc,expiry_date:_0x2111ef}=_0x1d0c3b[_0x10c573(0x164)];if(typeof _0x2740cd==_0x10c573(0x211))var _0x389372=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1d9)]],_0x3c2e40=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1d2)]],_0x14f927=[_0x1d0c3b['body']['from_prod_level']],_0x93293d=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x158)]],_0x12e0f7=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x162)]],_0x2f9ece=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x22f)]],_0x5a591d=[_0x1d0c3b[_0x10c573(0x164)]['secondary_code']],_0x4e4585=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1dd)]],_0x3b40e4=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1ec)]],_0x4a7743=[_0x1d0c3b['body'][_0x10c573(0x1b3)]],_0x5aae25=[_0x1d0c3b['body'][_0x10c573(0x20f)]],_0x1dc638=[_0x1d0c3b[_0x10c573(0x164)]['batch_code']],_0x17658d=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1f2)]],_0x141512=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x18a)]],_0x256f1d=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1fc)]],_0x374f8a=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1b4)]],_0x373adb=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1af)]],_0x1d2d73=[_0x1d0c3b['body'][_0x10c573(0x1cd)]],_0x2a49dc=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x229)]],_0x1a89cc=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1f4)]],_0x5bcb8b=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x15c)]],_0x5868b3=[_0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x193)]];else var _0x389372=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1d9)]],_0x3c2e40=[..._0x1d0c3b['body'][_0x10c573(0x1d2)]],_0x14f927=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1cf)]],_0x93293d=[..._0x1d0c3b['body'][_0x10c573(0x158)]],_0x12e0f7=[..._0x1d0c3b[_0x10c573(0x164)]['to_prod_level']],_0x2f9ece=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x22f)]],_0x5a591d=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1f9)]],_0x4e4585=[..._0x1d0c3b[_0x10c573(0x164)]['product_code3']],_0x3b40e4=[..._0x1d0c3b['body']['MaxStocks_data2']],_0x4a7743=[..._0x1d0c3b[_0x10c573(0x164)]['primary_unit']],_0x5aae25=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x20f)]],_0x1dc638=[..._0x1d0c3b['body'][_0x10c573(0x1ea)]],_0x17658d=[..._0x1d0c3b['body'][_0x10c573(0x1f2)]],_0x141512=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x18a)]],_0x256f1d=[..._0x1d0c3b['body'][_0x10c573(0x1fc)]],_0x374f8a=[..._0x1d0c3b[_0x10c573(0x164)]['maxPerUnit']],_0x373adb=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x1af)]],_0x1d2d73=[..._0x1d0c3b[_0x10c573(0x164)]['RoomAssigned']],_0x2a49dc=[..._0x1d0c3b[_0x10c573(0x164)][_0x10c573(0x229)]],_0x1a89cc=[..._0x1d0c3b[_0x10c573(0x164)]['from_invoice']],_0x5bcb8b=[..._0x1d0c3b['body'][_0x10c573(0x15c)]],_0x5868b3=[..._0x1d0c3b['body'][_0x10c573(0x193)]];const _0x516b97=_0x389372[_0x10c573(0x1b0)](_0x1c6736=>{return _0x1c6736={'product_name':_0x1c6736};});_0x3c2e40[_0x10c573(0x18f)]((_0x267968,_0x5d7c77)=>{var _0x363887=_0x10c573;_0x516b97[_0x5d7c77][_0x363887(0x1a9)]=_0x267968;}),_0x14f927[_0x10c573(0x18f)]((_0x136d46,_0x45c0ed)=>{_0x516b97[_0x45c0ed]['from_bay']=_0x136d46;}),_0x5868b3['forEach']((_0x49d51d,_0x4018d4)=>{var _0x175ad3=_0x10c573;_0x516b97[_0x4018d4][_0x175ad3(0x193)]=_0x49d51d;}),_0x1a89cc[_0x10c573(0x18f)]((_0x3171c6,_0x53276f)=>{var _0x2b671e=_0x10c573;_0x516b97[_0x53276f][_0x2b671e(0x1f4)]=_0x3171c6;}),_0x5bcb8b[_0x10c573(0x18f)]((_0xd45c2e,_0x35acc5)=>{_0x516b97[_0x35acc5]['To_invoice']=_0xd45c2e;}),_0x93293d[_0x10c573(0x18f)]((_0x5d921a,_0x3d4c66)=>{_0x516b97[_0x3d4c66]['to_quantity']=_0x5d921a;}),_0x12e0f7['forEach']((_0x24bc01,_0x463eb3)=>{var _0x56432d=_0x10c573;_0x516b97[_0x463eb3][_0x56432d(0x201)]=_0x24bc01;}),_0x2f9ece[_0x10c573(0x18f)]((_0x544b40,_0x12a157)=>{_0x516b97[_0x12a157]['primary_code']=_0x544b40;}),_0x5a591d[_0x10c573(0x18f)]((_0x3addaa,_0x161bbf)=>{var _0x208d38=_0x10c573;_0x516b97[_0x161bbf][_0x208d38(0x1f9)]=_0x3addaa;}),_0x4e4585['forEach']((_0x54c32e,_0x34b6b1)=>{var _0x5b4ed5=_0x10c573;_0x516b97[_0x34b6b1][_0x5b4ed5(0x209)]=_0x54c32e;}),_0x3b40e4[_0x10c573(0x18f)]((_0x21848c,_0x23c30a)=>{var _0x41aa73=_0x10c573;_0x516b97[_0x23c30a][_0x41aa73(0x15f)]=_0x21848c;}),_0x4a7743[_0x10c573(0x18f)]((_0x4735dc,_0x5ad843)=>{var _0x53caa4=_0x10c573;_0x516b97[_0x5ad843][_0x53caa4(0x185)]=_0x4735dc;}),_0x5aae25[_0x10c573(0x18f)]((_0x44cf35,_0x9deed0)=>{var _0x340fa7=_0x10c573;_0x516b97[_0x9deed0][_0x340fa7(0x20f)]=_0x44cf35;}),_0x1dc638['forEach']((_0x12d814,_0x23a8aa)=>{_0x516b97[_0x23a8aa]['batch_code']=_0x12d814;}),_0x17658d[_0x10c573(0x18f)]((_0x3707db,_0x5b154a)=>{var _0x1a447f=_0x10c573;_0x516b97[_0x5b154a][_0x1a447f(0x1f2)]=_0x3707db;}),_0x141512['forEach']((_0x1cb797,_0x30d8ba)=>{var _0x3a4b90=_0x10c573;_0x516b97[_0x30d8ba][_0x3a4b90(0x167)]=_0x1cb797;}),_0x256f1d['forEach']((_0x1bc5b0,_0x15bc53)=>{var _0x13c46f=_0x10c573;_0x516b97[_0x15bc53][_0x13c46f(0x15f)]=_0x1bc5b0;}),_0x374f8a[_0x10c573(0x18f)]((_0x4bdc73,_0x198ef9)=>{var _0x1561b4=_0x10c573;_0x516b97[_0x198ef9][_0x1561b4(0x1b4)]=_0x4bdc73;}),_0x373adb[_0x10c573(0x18f)]((_0x567e88,_0x2e9d6e)=>{_0x516b97[_0x2e9d6e]['prod_cat']=_0x567e88;}),_0x1d2d73[_0x10c573(0x18f)]((_0x5318b4,_0x281928)=>{var _0x59191a=_0x10c573;_0x516b97[_0x281928][_0x59191a(0x1cb)]=_0x5318b4;}),_0x2a49dc['forEach']((_0xa9753e,_0xf97fc)=>{var _0x1f0918=_0x10c573;_0x516b97[_0xf97fc][_0x1f0918(0x20e)]=_0xa9753e;});const _0x20369a=_0x516b97[_0x10c573(0x1ad)](_0x3eec49=>_0x3eec49[_0x10c573(0x1ae)]!=='0'&&_0x3eec49[_0x10c573(0x1ae)]!==''||_0x3eec49[_0x10c573(0x1f0)]!=='0'&&_0x3eec49[_0x10c573(0x1f0)]!=='');var _0x17d3e7=0x0;_0x20369a[_0x10c573(0x18f)](_0x3a2fba=>{var _0x53c59e=_0x10c573;parseInt(_0x3a2fba[_0x53c59e(0x1a9)])<parseInt(_0x3a2fba[_0x53c59e(0x1ae)])&&_0x17d3e7++;});if(_0x17d3e7!=0x0)return _0x1d0c3b[_0x10c573(0x217)](_0x10c573(0x223),_0x10c573(0x1b1)),_0xb3902f['redirect'](_0x10c573(0x222));const _0x328618=new transfers_finished({'date':_0x42305e,'from_warehouse':_0x5529b6,'to_warehouse':_0xb11983,'product':_0x20369a,'note':_0x1e9aa1,'invoice':_0x4233fc}),_0x4efc76=await _0x328618[_0x10c573(0x1a4)]();_0x1d0c3b[_0x10c573(0x217)](_0x10c573(0x17b),_0x10c573(0x173)),_0xb3902f[_0x10c573(0x194)](_0x10c573(0x163)+_0x4efc76['_id']);}catch(_0x493fed){console['log'](_0x493fed),_0xb3902f[_0x10c573(0x1c9)](0xc8)[_0x10c573(0x1ac)]({'errorMessage':_0x493fed[_0x10c573(0x19a)]});}}),router['get'](a0_0x383b8c(0x210),auth,async(_0x27e96a,_0x4faf3c)=>{var _0x408ccd=a0_0x383b8c;try{const {username:_0x15b7c6,email:_0x24da91,role:_0x4bf06e}=_0x27e96a['user'],_0x378bd6=_0x27e96a['user'],_0x40ca67=await profile[_0x408ccd(0x1dc)]({'email':_0x378bd6[_0x408ccd(0x166)]}),_0x583116=await master_shop[_0x408ccd(0x238)](),_0x42b8d8=await transfers_finished['findById'](_0x27e96a[_0x408ccd(0x1d8)]['id']);let _0x4b507f;if(_0x378bd6[_0x408ccd(0x18d)]=='staff'){const _0x12d596=await staff[_0x408ccd(0x1dc)]({'email':_0x378bd6['email']});_0x4b507f=await warehouse['find']({'status':_0x408ccd(0x17e),'name':_0x12d596[_0x408ccd(0x160)],'warehouse_category':_0x408ccd(0x1f7)});}else _0x4b507f=await warehouse[_0x408ccd(0x238)]({'status':_0x408ccd(0x17e),'warehouse_category':'Finished\x20Goods'});const _0xc170dc=await warehouse[_0x408ccd(0x22c)]([{'$match':{'name':_0x42b8d8['from_warehouse'],'warehouse_category':_0x408ccd(0x1f7)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x408ccd(0x19d),'name':{'$first':_0x408ccd(0x20a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x408ccd(0x16a)},'bin':{'$first':_0x408ccd(0x195)},'type':{'$first':_0x408ccd(0x172)},'floorlevel':{'$first':_0x408ccd(0x1f1)},'primary_code':{'$first':_0x408ccd(0x1d5)},'secondary_code':{'$first':_0x408ccd(0x1ce)},'product_code':{'$first':_0x408ccd(0x214)},'storage':{'$first':_0x408ccd(0x1ca)},'rack':{'$first':_0x408ccd(0x1f6)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x408ccd(0x16c)},'room':{'$first':'$room'},'warehoue_name':{'$first':'$name'}}}]),_0xba4c2d=await product[_0x408ccd(0x238)]({});if(_0x583116[0x0][_0x408ccd(0x178)]==_0x408ccd(0x234)){var _0x52f36d=users[_0x408ccd(0x21e)];console[_0x408ccd(0x19e)](_0x52f36d);}else{if(_0x583116[0x0][_0x408ccd(0x178)]==_0x408ccd(0x192))var _0x52f36d=users['Hindi'];else{if(_0x583116[0x0][_0x408ccd(0x178)]==_0x408ccd(0x1b8))var _0x52f36d=users['German'];else{if(_0x583116[0x0]['language']==_0x408ccd(0x218))var _0x52f36d=users[_0x408ccd(0x218)];else{if(_0x583116[0x0][_0x408ccd(0x178)]==_0x408ccd(0x221))var _0x52f36d=users[_0x408ccd(0x221)];else{if(_0x583116[0x0]['language']=='Portuguese\x20(BR)')var _0x52f36d=users[_0x408ccd(0x18e)];else{if(_0x583116[0x0][_0x408ccd(0x178)]==_0x408ccd(0x1e3))var _0x52f36d=users[_0x408ccd(0x1e3)];else{if(_0x583116[0x0]['language']=='Arabic\x20(ae)')var _0x52f36d=users[_0x408ccd(0x203)];}}}}}}}_0x4faf3c['render']('edit_transfer_finished_view',{'success':_0x27e96a[_0x408ccd(0x217)](_0x408ccd(0x17b)),'errors':_0x27e96a[_0x408ccd(0x217)]('errors'),'role':_0x378bd6,'profile':_0x40ca67,'master_shop':_0x583116,'warehouse':_0x4b507f,'transfer':_0x42b8d8,'stock':_0xc170dc,'unit':_0xba4c2d,'language':_0x52f36d});}catch(_0x26d46e){console[_0x408ccd(0x19e)](_0x26d46e);}}),router[a0_0x383b8c(0x219)](a0_0x383b8c(0x210),auth,async(_0x26a06d,_0xa87856)=>{var _0x40c389=a0_0x383b8c;try{const {invoice:_0x4db21b,from_warehouse:_0x378687,FromRoom_name:_0x3886a5,to_warehouse:_0x21b4c3,ToRoom_name:_0x51d6d1}=_0x26a06d[_0x40c389(0x164)],_0x38db06=await transfers_finished['findById'](_0x26a06d[_0x40c389(0x1d8)]['id']),_0x1973fd=_0x38db06['product']['map'](async _0x42b60e=>{var _0x4d1e09=_0x40c389;if(_0x42b60e[_0x4d1e09(0x1ae)]>0x0){var _0x4724e3=await warehouse[_0x4d1e09(0x1dc)]({'name':_0x378687,'room':_0x42b60e[_0x4d1e09(0x1cb)],'warehouse_category':_0x4d1e09(0x1f7)});const _0x1a95cb=_0x4724e3['product_details']['map'](_0x59c5f7=>{var _0x56441b=_0x4d1e09;_0x59c5f7['product_name']==_0x42b60e[_0x56441b(0x1be)]&&_0x59c5f7[_0x56441b(0x15e)]==_0x42b60e[_0x56441b(0x1c4)]&&_0x59c5f7[_0x56441b(0x1f2)]==_0x42b60e[_0x56441b(0x1f2)]&&_0x59c5f7['production_date']==_0x42b60e[_0x56441b(0x167)]&&_0x59c5f7[_0x56441b(0x1ea)]==_0x42b60e[_0x56441b(0x1ea)]&&_0x59c5f7[_0x56441b(0x220)]==_0x42b60e['from_invoice']&&(console[_0x56441b(0x19e)](_0x56441b(0x1d0),_0x59c5f7[_0x56441b(0x1da)]),typeof _0x42b60e[_0x56441b(0x193)]==_0x56441b(0x1bb)?_0x59c5f7[_0x56441b(0x1da)]=Math[_0x56441b(0x174)](0x0,Math[_0x56441b(0x161)](_0x59c5f7['product_stock'])-Math['abs'](_0x42b60e[_0x56441b(0x1ae)])):_0x59c5f7['product_stock']=Math[_0x56441b(0x174)](0x0,Math['abs'](_0x59c5f7['product_stock'])-Math[_0x56441b(0x161)](_0x42b60e[_0x56441b(0x1ae)])));});}return _0x4724e3;});Promise[_0x40c389(0x15a)](_0x1973fd)[_0x40c389(0x22d)](async _0x110bd4=>{var _0x49d8da=_0x40c389;try{for(const _0x98cbb1 of _0x110bd4){await _0x98cbb1[_0x49d8da(0x1a4)]();}const _0x4ec8e8=_0x38db06[_0x49d8da(0x183)][_0x49d8da(0x1b0)](async _0x4ede01=>{var _0x2e4a2d=_0x49d8da,_0x3ba93d=await warehouse[_0x2e4a2d(0x1dc)]({'name':_0x21b4c3,'room':_0x4ede01[_0x2e4a2d(0x20e)]});if(_0x4ede01[_0x2e4a2d(0x1ae)]>0x0){var _0x25e290=0x0;const _0x338538=_0x3ba93d[_0x2e4a2d(0x206)][_0x2e4a2d(0x1b0)](_0x3044be=>{var _0x133db7=_0x2e4a2d;_0x3044be['product_name']==_0x4ede01['product_name']&&_0x3044be['bay']==_0x4ede01[_0x133db7(0x201)]&&_0x3044be[_0x133db7(0x1f2)]==_0x4ede01[_0x133db7(0x1f2)]&&_0x3044be[_0x133db7(0x167)]==_0x4ede01[_0x133db7(0x167)]&&_0x3044be[_0x133db7(0x1ea)]==_0x4ede01[_0x133db7(0x1ea)]&&_0x3044be[_0x133db7(0x220)]==_0x4ede01[_0x133db7(0x1df)]&&(typeof _0x4ede01['id_transaction']==_0x133db7(0x1bb)?(console[_0x133db7(0x19e)](_0x133db7(0x17c),_0x3044be[_0x133db7(0x1da)]+_0x133db7(0x1c7)+_0x3044be[_0x133db7(0x1ab)]+'\x20<=>\x20'+Math[_0x133db7(0x161)](_0x3044be['product_stock'])+Math[_0x133db7(0x161)](_0x4ede01['to_quantity'])),_0x3044be[_0x133db7(0x1da)]=Math['abs'](_0x3044be[_0x133db7(0x1da)])+Math[_0x133db7(0x161)](_0x4ede01[_0x133db7(0x1ae)])):_0x3044be[_0x133db7(0x1da)]=Math['abs'](_0x3044be[_0x133db7(0x1da)])+Math['abs'](_0x4ede01[_0x133db7(0x1ae)]),_0x25e290++);});_0x25e290=='0'&&(_0x3ba93d['product_details']=_0x3ba93d[_0x2e4a2d(0x206)][_0x2e4a2d(0x1e2)]({'product_name':_0x4ede01[_0x2e4a2d(0x1be)],'product_stock':_0x4ede01[_0x2e4a2d(0x1ae)],'bay':_0x4ede01[_0x2e4a2d(0x201)],'product_code':_0x4ede01['product_code'],'primary_code':_0x4ede01[_0x2e4a2d(0x22f)],'secondary_code':_0x4ede01[_0x2e4a2d(0x1f9)],'expiry_date':_0x4ede01[_0x2e4a2d(0x1f2)],'production_date':_0x4ede01[_0x2e4a2d(0x167)],'maxProducts':_0x4ede01[_0x2e4a2d(0x15f)],'batch_code':_0x4ede01['batch_code'],'secondary_unit':_0x4ede01[_0x2e4a2d(0x20f)],'unit':_0x4ede01[_0x2e4a2d(0x185)],'maxProducts':_0x4ede01[_0x2e4a2d(0x15f)],'maxPerUnit':_0x4ede01[_0x2e4a2d(0x1b4)],'invoice':_0x4ede01[_0x2e4a2d(0x1df)]}));}return _0x3ba93d;});Promise[_0x49d8da(0x15a)](_0x4ec8e8)[_0x49d8da(0x22d)](async _0x4ba7be=>{var _0x3b7c76=_0x49d8da;try{for(const _0x5937c3 of _0x4ba7be){await warehouse[_0x3b7c76(0x205)]({'_id':_0x5937c3[_0x3b7c76(0x1ab)]},{'$addToSet':{'product_details':{'$each':_0x5937c3[_0x3b7c76(0x206)]}}});}_0x38db06['finalize']=_0x3b7c76(0x213);const _0x512030=await _0x38db06['save'](),_0xa78ea9=await master_shop['find'](),_0x4baeeb=await email_settings[_0x3b7c76(0x1dc)](),_0x2d7861=await supervisor_settings[_0x3b7c76(0x238)]();var _0x4fc8f4=_0x38db06[_0x3b7c76(0x183)],_0x416816='',_0x395f71;for(_0x395f71 in _0x4fc8f4){var _0x57371c='FG';_0x38db06[_0x3b7c76(0x226)]=='DRY\x20GOODS'&&(_0x57371c='DG'),_0x416816+=_0x3b7c76(0x1fb)+_0x3b7c76(0x1a8)+_0x4fc8f4[_0x395f71]['product_name']+_0x3b7c76(0x236)+_0x3b7c76(0x1a8)+_0x4fc8f4[_0x395f71][_0x3b7c76(0x209)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4fc8f4[_0x395f71][_0x3b7c76(0x1ae)]+_0x3b7c76(0x236)+_0x3b7c76(0x1a8)+_0x4fc8f4[_0x395f71][_0x3b7c76(0x185)]+_0x3b7c76(0x236)+_0x3b7c76(0x1a8)+_0x4fc8f4[_0x395f71][_0x3b7c76(0x20f)]+_0x3b7c76(0x236)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x38db06[_0x3b7c76(0x226)]+_0x3b7c76(0x236)+_0x3b7c76(0x1a8)+_0x4fc8f4[_0x395f71][_0x3b7c76(0x20e)]+_0x3b7c76(0x236)+_0x3b7c76(0x1a8)+_0x57371c+_0x4fc8f4[_0x395f71]['to_bay']+_0x3b7c76(0x236)+_0x3b7c76(0x1d3);}let _0x54df83=nodemailer[_0x3b7c76(0x190)]({'host':_0x4baeeb['host'],'port':Number(_0x4baeeb['port']),'secure':![],'auth':{'user':_0x4baeeb[_0x3b7c76(0x166)],'pass':_0x4baeeb['password']}}),_0x3064dd={'from':_0x4baeeb[_0x3b7c76(0x166)],'to':_0x2d7861[0x0][_0x3b7c76(0x1de)],'subject':_0x3b7c76(0x225),'attachments':[{'filename':_0x3b7c76(0x186),'path':__dirname+'/../public'+_0x3b7c76(0x1cc)+_0xa78ea9[0x0][_0x3b7c76(0x19b)],'cid':'logo'}],'html':_0x3b7c76(0x175)+_0x3b7c76(0x188)+_0x3b7c76(0x1e8)+'<div>'+_0x3b7c76(0x177)+'<div>'+_0x3b7c76(0x196)+'</div>'+_0x3b7c76(0x215)+'<h2>\x20'+_0xa78ea9[0x0]['site_title']+_0x3b7c76(0x1e7)+'</div>'+_0x3b7c76(0x1ef)+_0x3b7c76(0x1c0)+'<div>'+_0x3b7c76(0x1d6)+_0x3b7c76(0x1a1)+_0x38db06[_0x3b7c76(0x220)]+'\x20'+_0x3b7c76(0x1fd)+_0x3b7c76(0x1eb)+_0x38db06[_0x3b7c76(0x21d)]+'\x20'+'</span>'+_0x3b7c76(0x212)+'</div>'+_0x3b7c76(0x1c3)+_0x3b7c76(0x1a3)+_0x3b7c76(0x1fb)+_0x3b7c76(0x16f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x3b7c76(0x200)+_0x3b7c76(0x1a5)+_0x3b7c76(0x17d)+_0x3b7c76(0x1db)+_0x3b7c76(0x1b7)+_0x3b7c76(0x1d3)+_0x3b7c76(0x184)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x416816+'\x20'+_0x3b7c76(0x1b2)+_0x3b7c76(0x18c)+_0x3b7c76(0x215)+_0x3b7c76(0x179)+'<h5>'+_0xa78ea9[0x0][_0x3b7c76(0x1a7)]+'</h5>'+_0x3b7c76(0x1ef)+_0x3b7c76(0x1ef)+_0x3b7c76(0x21b)};_0x54df83[_0x3b7c76(0x17f)](_0x3064dd,function(_0x5f25ae,_0x1710ef){var _0x148773=_0x3b7c76;_0x5f25ae?(console[_0x148773(0x19e)](_0x5f25ae),console[_0x148773(0x19e)](_0x148773(0x20b))):console[_0x148773(0x19e)]('Email\x20sent\x20successfully');}),_0x26a06d[_0x3b7c76(0x217)]('success',_0x3b7c76(0x1a2)),_0xa87856['redirect']('/picking_list/PDF_transfer/'+_0x512030[_0x3b7c76(0x1ab)]);}catch(_0x3bef37){console[_0x3b7c76(0x169)](_0x3bef37),_0xa87856[_0x3b7c76(0x1c9)](0x1f4)[_0x3b7c76(0x1ac)]({'error':_0x3b7c76(0x1c1)});}})['catch'](_0x4d1a52=>{var _0x52f5cd=_0x49d8da;console['error'](_0x4d1a52),_0xa87856[_0x52f5cd(0x1c9)](0x1f4)[_0x52f5cd(0x1ac)]({'error':_0x52f5cd(0x16e)});});}catch(_0x1d5196){console['error'](_0x1d5196),_0xa87856[_0x49d8da(0x1c9)](0x1f4)[_0x49d8da(0x1ac)]({'error':_0x49d8da(0x1ed)});}})['catch'](_0x3d646b=>{var _0x53e15b=_0x40c389;console[_0x53e15b(0x169)](_0x3d646b),_0xa87856[_0x53e15b(0x1c9)](0x1f4)[_0x53e15b(0x1ac)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3a9401){_0xa87856[_0x40c389(0x1ac)]({'message':_0x3a9401['message']});}});function a0_0x46ec(_0x2a556e,_0x12373f){var _0x4cd955=a0_0x4cd9();return a0_0x46ec=function(_0x46ecae,_0x26c690){_0x46ecae=_0x46ecae-0x158;var _0x10d9f6=_0x4cd955[_0x46ecae];return _0x10d9f6;},a0_0x46ec(_0x2a556e,_0x12373f);}function BayBinSelected(_0x266d0a,_0x1824da){var _0x373907=a0_0x383b8c,_0x638a2a=[];let _0x1e5167=[];var _0x573343=[];if(_0x266d0a==_0x373907(0x1e0)){switch(_0x1824da){case _0x373907(0x1ba):_0x638a2a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x373907(0x22a):_0x638a2a=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x573343=['DG'];}else{if(_0x266d0a==_0x373907(0x1d1)){switch(_0x1824da){case'Rack\x201':_0x638a2a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x373907(0x22a):_0x638a2a=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x573343=['FG'];}}return{'levels':_0x638a2a,'identify':_0x573343};}router['get']('/view/:id',auth,async(_0x270da6,_0x2a57f5)=>{var _0x424ff0=a0_0x383b8c;try{const {username:_0x51fe20,email:_0x384f52,role:_0x18a272}=_0x270da6['user'],_0x23fcc0=_0x270da6['user'],_0x5dd891=await profile[_0x424ff0(0x1dc)]({'email':_0x23fcc0[_0x424ff0(0x166)]}),_0x22f129=await master_shop[_0x424ff0(0x238)](),_0x25c78a=await transfers_finished[_0x424ff0(0x198)](_0x270da6[_0x424ff0(0x1d8)]['id']);let _0x294908=new Date(_0x25c78a[_0x424ff0(0x1f2)]),_0x38a8bf=('0'+_0x294908['getDate']())[_0x424ff0(0x1d4)](-0x2),_0x534033=('0'+(_0x294908[_0x424ff0(0x189)]()+0x1))[_0x424ff0(0x1d4)](-0x2),_0x32e71e=_0x294908[_0x424ff0(0x1ff)](),_0x470fec=_0x32e71e+'-'+_0x534033+'-'+_0x38a8bf,_0x1126f2;if(_0x23fcc0[_0x424ff0(0x18d)]==_0x424ff0(0x180)){const _0x4defab=await staff[_0x424ff0(0x1dc)]({'email':_0x23fcc0[_0x424ff0(0x166)]});_0x1126f2=await warehouse[_0x424ff0(0x238)]({'status':'Enabled','name':_0x4defab[_0x424ff0(0x160)],'warehouse_category':_0x424ff0(0x1f7)});}else _0x1126f2=await warehouse[_0x424ff0(0x238)]({'status':'Enabled','warehouse_category':_0x424ff0(0x1f7)});const _0x43bd62=await warehouse[_0x424ff0(0x22c)]([{'$match':{'name':_0x25c78a[_0x424ff0(0x1d7)],'room':_0x25c78a[_0x424ff0(0x20c)]}},{'$unwind':_0x424ff0(0x207)},{'$group':{'_id':_0x424ff0(0x19d),'name':{'$first':_0x424ff0(0x20a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x424ff0(0x16a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x424ff0(0x172)},'floorlevel':{'$first':_0x424ff0(0x1f1)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x424ff0(0x214)},'storage':{'$first':_0x424ff0(0x1ca)},'rack':{'$first':'$product_details.rack'}}}]);var _0x3166b8=[0x1,0x2,0x3,0x4],_0x50266a=['A','B','C','D','E','F','G','H','I','J'],_0x45ccfa=[_0x424ff0(0x199),_0x424ff0(0x21f)];const _0x2c5815=await product[_0x424ff0(0x238)]({}),_0x57472e=BayBinSelected(_0x25c78a[_0x424ff0(0x226)],_0x25c78a[_0x424ff0(0x1e6)]);if(_0x22f129[0x0][_0x424ff0(0x178)]=='English\x20(US)'){var _0x537802=users['English'];console['log'](_0x537802);}else{if(_0x22f129[0x0][_0x424ff0(0x178)]==_0x424ff0(0x192))var _0x537802=users[_0x424ff0(0x192)];else{if(_0x22f129[0x0][_0x424ff0(0x178)]==_0x424ff0(0x1b8))var _0x537802=users['German'];else{if(_0x22f129[0x0][_0x424ff0(0x178)]==_0x424ff0(0x218))var _0x537802=users[_0x424ff0(0x218)];else{if(_0x22f129[0x0]['language']==_0x424ff0(0x221))var _0x537802=users[_0x424ff0(0x221)];else{if(_0x22f129[0x0]['language']==_0x424ff0(0x224))var _0x537802=users[_0x424ff0(0x18e)];else{if(_0x22f129[0x0][_0x424ff0(0x178)]=='Chinese')var _0x537802=users[_0x424ff0(0x1e3)];else{if(_0x22f129[0x0][_0x424ff0(0x178)]=='Arabic\x20(ae)')var _0x537802=users[_0x424ff0(0x203)];}}}}}}}_0x2a57f5[_0x424ff0(0x1f8)](_0x424ff0(0x231),{'success':_0x270da6[_0x424ff0(0x217)](_0x424ff0(0x17b)),'errors':_0x270da6[_0x424ff0(0x217)]('errors'),'role':_0x23fcc0,'profile':_0x5dd891,'master_shop':_0x22f129,'warehouse':_0x1126f2,'transfer':_0x25c78a,'stock':_0x43bd62,'unit':_0x2c5815,'language':_0x537802,'levels':_0x3166b8,'Isle':_0x50266a,'rooms_data':_0x45ccfa,'ed_fullDate':_0x470fec,'dataSelected':_0x57472e});}catch(_0x3f152e){console['log'](_0x3f152e);}}),router['post'](a0_0x383b8c(0x1fa),auth,async(_0x10cfdd,_0x305117)=>{var _0x3a5a28=a0_0x383b8c;try{const _0x1d8334=_0x10cfdd[_0x3a5a28(0x1d8)]['id'];console[_0x3a5a28(0x19e)](_0x10cfdd[_0x3a5a28(0x164)]);const _0x60fb36=await transfers_finished['findById'](_0x1d8334);console[_0x3a5a28(0x19e)](_0x3a5a28(0x230),_0x60fb36);const {date:_0x427602,from_warehouse:_0x12f633,FromRoom_name:_0x3f4184,to_warehouse:_0x241463,ToRoom_name:_0x386191,prod_name:_0x1dd10e,from_prod_qty:_0x1e2864,from_prod_level:_0x2e74cc,from_prod_isle:_0x4671fa,from_prod_pallet:_0x3c2dd4,to_prod_qty:_0x1e5bcb,to_prod_level:_0x11c650,to_prod_isle:_0x148c15,to_prod_pallet:_0x69ae48,primary_code:_0x510405,secondary_code:_0x257d81,product_code3:_0x224645,note:_0x388963,invoice:_0x174cec,expiry_date:_0x53eeb2}=_0x10cfdd['body'];if(typeof _0x1dd10e==_0x3a5a28(0x211))var _0x509de8=[_0x10cfdd['body']['prod_name']],_0x1a157d=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1d2)]],_0x156307=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1cf)]],_0x16a692=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x228)]],_0x38ce88=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x162)]],_0x412405=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x22f)]],_0x1ed88f=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1f9)]],_0x25edd6=[_0x10cfdd[_0x3a5a28(0x164)]['product_code3']],_0x388bed=[_0x10cfdd[_0x3a5a28(0x164)]['MaxStocks_data2']],_0x45614d=[_0x10cfdd['body'][_0x3a5a28(0x185)]],_0x2ec970=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x20f)]],_0x52e491=[_0x10cfdd['body'][_0x3a5a28(0x1ea)]],_0x595400=[_0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1f2)]];else var _0x509de8=[..._0x10cfdd[_0x3a5a28(0x164)]['prod_name']],_0x1a157d=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1d2)]],_0x156307=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1cf)]],_0x16a692=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x228)]],_0x38ce88=[..._0x10cfdd['body'][_0x3a5a28(0x162)]],_0x412405=[..._0x10cfdd['body'][_0x3a5a28(0x22f)]],_0x1ed88f=[..._0x10cfdd[_0x3a5a28(0x164)]['secondary_code']],_0x25edd6=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1dd)]],_0x388bed=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1ec)]],_0x45614d=[..._0x10cfdd['body'][_0x3a5a28(0x185)]],_0x2ec970=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x20f)]],_0x52e491=[..._0x10cfdd[_0x3a5a28(0x164)][_0x3a5a28(0x1ea)]],_0x595400=[..._0x10cfdd['body'][_0x3a5a28(0x1f2)]];const _0x1b62bd=_0x509de8[_0x3a5a28(0x1b0)](_0x271d88=>{return _0x271d88={'product_name':_0x271d88};});_0x1a157d[_0x3a5a28(0x18f)]((_0x1c1c0e,_0x2ae0b1)=>{_0x1b62bd[_0x2ae0b1]['from_quantity']=_0x1c1c0e;}),_0x156307[_0x3a5a28(0x18f)]((_0x829536,_0x47d70a)=>{var _0x19b65a=_0x3a5a28;_0x1b62bd[_0x47d70a][_0x19b65a(0x1c4)]=_0x829536;}),_0x16a692['forEach']((_0x4ed814,_0x324267)=>{_0x1b62bd[_0x324267]['to_quantity']=_0x4ed814;}),_0x38ce88['forEach']((_0x497d8f,_0x5c3570)=>{_0x1b62bd[_0x5c3570]['to_bay']=_0x497d8f;}),_0x412405[_0x3a5a28(0x18f)]((_0x30333e,_0x2f7de9)=>{var _0x55dca9=_0x3a5a28;_0x1b62bd[_0x2f7de9][_0x55dca9(0x22f)]=_0x30333e;}),_0x1ed88f[_0x3a5a28(0x18f)]((_0x3146ab,_0x116afd)=>{var _0xd365da=_0x3a5a28;_0x1b62bd[_0x116afd][_0xd365da(0x1f9)]=_0x3146ab;}),_0x25edd6[_0x3a5a28(0x18f)]((_0x5182bf,_0x418c84)=>{var _0x4fabe4=_0x3a5a28;_0x1b62bd[_0x418c84][_0x4fabe4(0x209)]=_0x5182bf;}),_0x388bed['forEach']((_0x23559f,_0x159ed7)=>{var _0x275249=_0x3a5a28;_0x1b62bd[_0x159ed7][_0x275249(0x15f)]=_0x23559f;}),_0x45614d[_0x3a5a28(0x18f)]((_0xe4cc88,_0x2acfc2)=>{var _0x199942=_0x3a5a28;_0x1b62bd[_0x2acfc2][_0x199942(0x185)]=_0xe4cc88;}),_0x2ec970[_0x3a5a28(0x18f)]((_0x116093,_0x4a742d)=>{var _0x2c3cae=_0x3a5a28;_0x1b62bd[_0x4a742d][_0x2c3cae(0x20f)]=_0x116093;}),_0x52e491[_0x3a5a28(0x18f)]((_0xcace0e,_0x17f33e)=>{_0x1b62bd[_0x17f33e]['batch_code']=_0xcace0e;}),_0x595400['forEach']((_0x31ea1a,_0x1e6486)=>{_0x1b62bd[_0x1e6486]['expiry_date']=_0x31ea1a;});const _0x4c42a6=_0x1b62bd[_0x3a5a28(0x1ad)](_0x16f26e=>_0x16f26e['to_quantity']!=='0'&&_0x16f26e[_0x3a5a28(0x1ae)]!==''||_0x16f26e[_0x3a5a28(0x1f0)]!=='0'&&_0x16f26e[_0x3a5a28(0x1f0)]!=='');var _0x35b29b=0x0;_0x4c42a6[_0x3a5a28(0x18f)](_0x45ef9e=>{var _0xec65da=_0x3a5a28;parseInt(_0x45ef9e['from_quantity'])<parseInt(_0x45ef9e[_0xec65da(0x1ae)])&&_0x35b29b++;});if(_0x35b29b!=0x0)return _0x10cfdd[_0x3a5a28(0x217)](_0x3a5a28(0x223),_0x3a5a28(0x1b1)),_0x305117[_0x3a5a28(0x194)](_0x3a5a28(0x222));const _0xc24110=await warehouse['findOne']({'name':_0x60fb36['from_warehouse'],'room':_0x60fb36[_0x3a5a28(0x20c)]});_0x60fb36[_0x3a5a28(0x183)][_0x3a5a28(0x18f)](_0x5ddef6=>{var _0x4f939d=_0x3a5a28;if(_0x5ddef6[_0x4f939d(0x1ae)]>0x0){const _0x2d9d25=_0xc24110['product_details'][_0x4f939d(0x1b0)](_0x1c9dc8=>{var _0x5165af=_0x4f939d;_0x1c9dc8[_0x5165af(0x1be)]==_0x5ddef6[_0x5165af(0x1be)]&&_0x1c9dc8[_0x5165af(0x15e)]==_0x5ddef6[_0x5165af(0x1c4)]&&(_0x1c9dc8[_0x5165af(0x1da)]=parseInt(_0x1c9dc8['product_stock'])+parseInt(_0x5ddef6[_0x5165af(0x1ae)]));});}}),await _0xc24110[_0x3a5a28(0x1a4)]();const _0x3fea11=await warehouse[_0x3a5a28(0x1dc)]({'name':_0x60fb36[_0x3a5a28(0x226)],'room':_0x60fb36['to_room']});_0x60fb36['product'][_0x3a5a28(0x18f)](_0xec1512=>{var _0x4c189e=_0x3a5a28;if(_0xec1512[_0x4c189e(0x1ae)]>0x0){const _0x4bca5e=_0x3fea11[_0x4c189e(0x206)][_0x4c189e(0x1b0)](_0x53df10=>{var _0x1276ff=_0x4c189e;_0x53df10['product_name']==_0xec1512['product_name']&&_0x53df10[_0x1276ff(0x15e)]==_0xec1512[_0x1276ff(0x201)]&&(_0x53df10[_0x1276ff(0x1da)]=parseInt(_0x53df10[_0x1276ff(0x1da)])-parseInt(_0xec1512[_0x1276ff(0x1ae)]));});}}),await _0x3fea11[_0x3a5a28(0x1a4)](),_0x60fb36[_0x3a5a28(0x21d)]=_0x427602,_0x60fb36[_0x3a5a28(0x1d7)]=_0x12f633,_0x60fb36['to_warehouse']=_0x241463,_0x60fb36[_0x3a5a28(0x183)]=_0x4c42a6,_0x60fb36[_0x3a5a28(0x216)]=_0x388963,_0x60fb36[_0x3a5a28(0x220)]=_0x174cec;const _0x293a8a=await _0x60fb36[_0x3a5a28(0x1a4)](),_0x1c6a4=await warehouse[_0x3a5a28(0x1dc)]({'name':_0x12f633,'room':_0x3f4184});_0x293a8a[_0x3a5a28(0x183)][_0x3a5a28(0x18f)](_0x3a3fe6=>{var _0x1006ce=_0x3a5a28;if(_0x3a3fe6[_0x1006ce(0x1ae)]>0x0){const _0x45d987=_0x1c6a4[_0x1006ce(0x206)][_0x1006ce(0x1b0)](_0x4e7c1f=>{var _0x43f9b4=_0x1006ce;_0x4e7c1f[_0x43f9b4(0x1be)]==_0x3a3fe6[_0x43f9b4(0x1be)]&&_0x4e7c1f[_0x43f9b4(0x15e)]==_0x3a3fe6[_0x43f9b4(0x1c4)]&&(_0x4e7c1f[_0x43f9b4(0x1da)]=parseInt(_0x4e7c1f['product_stock'])-parseInt(_0x3a3fe6[_0x43f9b4(0x1ae)]));});}}),await _0x1c6a4['save']();const _0x2df15d=await warehouse['findOne']({'name':_0x241463,'room':_0x386191});_0x293a8a['product']['forEach'](_0x2e884e=>{var _0x4d3170=_0x3a5a28;if(_0x2e884e[_0x4d3170(0x1ae)]>0x0){var _0x19c799=0x0;const _0x2a2b8f=_0x2df15d[_0x4d3170(0x206)][_0x4d3170(0x1b0)](_0x34e097=>{var _0xf691fc=_0x4d3170;_0x34e097[_0xf691fc(0x1be)]==_0x2e884e[_0xf691fc(0x1be)]&&_0x34e097[_0xf691fc(0x15e)]==_0x2e884e[_0xf691fc(0x201)]&&(_0x34e097[_0xf691fc(0x1da)]=parseInt(_0x34e097['product_stock'])+parseInt(_0x2e884e[_0xf691fc(0x1ae)]),_0x19c799++);});_0x19c799=='0'&&(_0x2df15d['product_details']=_0x2df15d['product_details'][_0x4d3170(0x1e2)]({'product_name':_0x2e884e[_0x4d3170(0x1be)],'product_stock':_0x2e884e[_0x4d3170(0x1ae)],'bay':_0x2e884e[_0x4d3170(0x201)],'product_code':_0x2e884e['product_code'],'primary_code':_0x2e884e[_0x4d3170(0x22f)],'secondary_code':_0x2e884e['secondary_code'],'maxProducts':_0x2e884e[_0x4d3170(0x15f)]}));}}),await _0x2df15d[_0x3a5a28(0x1a4)](),_0x10cfdd[_0x3a5a28(0x217)](_0x3a5a28(0x17b),_0x3a5a28(0x1aa)),_0x305117[_0x3a5a28(0x194)](_0x3a5a28(0x171));}catch(_0x58db8d){console[_0x3a5a28(0x19e)](_0x58db8d);}}),router['post'](a0_0x383b8c(0x22e),async(_0x3770dd,_0x2ebd16)=>{var _0x54dac3=a0_0x383b8c;const {FromWareHouse:_0x424ddb,FromRoom:_0x17f093,ToWarehouse:_0x444405,ToRoom:_0x196982,primary_code:_0x279407,Roomslist:_0x1c80d9}=_0x3770dd[_0x54dac3(0x164)],_0xec96a1=_0x1c80d9[_0x54dac3(0x1e5)](','),_0x4ac4e0=[];async function _0x4fb9a8(_0x56f9f2){var _0x24eace=_0x54dac3;const _0x19e946=await warehouse[_0x24eace(0x22c)]([{'$match':{'name':_0x424ddb,'room':_0x56f9f2}},{'$unwind':_0x24eace(0x207)},{'$match':{'product_details.primary_code':_0x279407}},{'$group':{'_id':_0x24eace(0x19d),'name':{'$first':'$product_details.product_name'},'instock':{'$first':_0x24eace(0x1c5)},'primary_code':{'$first':_0x24eace(0x1d5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x24eace(0x214)},'level':{'$first':_0x24eace(0x16a)},'isle':{'$first':_0x24eace(0x195)},'type':{'$first':_0x24eace(0x172)},'pallet':{'$first':_0x24eace(0x1f1)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x24eace(0x1b9)},'storage':{'$first':_0x24eace(0x1ca)},'rack':{'$first':_0x24eace(0x1f6)},'expiry_date':{'$first':_0x24eace(0x19f)},'production_date':{'$first':_0x24eace(0x16c)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x24eace(0x170)},'roomNamed':{'$first':_0x24eace(0x1e9)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4971b0=await warehouse[_0x24eace(0x22c)]([{'$match':{'name':_0x424ddb,'room':_0x56f9f2}},{'$unwind':_0x24eace(0x207)},{'$match':{'product_details.secondary_code':_0x279407}},{'$group':{'_id':_0x24eace(0x19d),'name':{'$first':_0x24eace(0x20a)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x24eace(0x1d5)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x24eace(0x214)},'level':{'$first':_0x24eace(0x16a)},'isle':{'$first':_0x24eace(0x195)},'type':{'$first':_0x24eace(0x172)},'pallet':{'$first':_0x24eace(0x1f1)},'unit':{'$first':_0x24eace(0x208)},'secondary_unit':{'$first':_0x24eace(0x1b9)},'storage':{'$first':_0x24eace(0x1ca)},'rack':{'$first':_0x24eace(0x1f6)},'expiry_date':{'$first':_0x24eace(0x19f)},'production_date':{'$first':_0x24eace(0x16c)},'batch_code':{'$first':_0x24eace(0x182)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x24eace(0x1e9)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x24eace(0x227)}}}]);if(_0x19e946[_0x24eace(0x15d)]>0x0)_0x4ac4e0[_0x24eace(0x237)](_0x19e946);else _0x4971b0[_0x24eace(0x15d)]>0x0&&_0x4ac4e0[_0x24eace(0x237)](_0x4971b0);}const _0x3aae33=_0xec96a1[_0x54dac3(0x1b0)](_0x145698=>_0x4fb9a8(_0x145698));await Promise[_0x54dac3(0x15a)](_0x3aae33),_0x2ebd16[_0x54dac3(0x1ac)](_0x4ac4e0);}),router[a0_0x383b8c(0x219)]('/barcode_scanner2',async(_0x5cc247,_0x5c1dd5)=>{var _0x4bef13=a0_0x383b8c;try{const {FromWareHouse:_0x123cff,FromRoom:_0x45dccf,ToWarehouse:_0x572fec,ToRoom:_0x2ec601,secondary_code:_0x850792}=_0x5cc247[_0x4bef13(0x164)],_0x1187e2=await warehouse[_0x4bef13(0x22c)]([{'$match':{'name':_0x123cff}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x850792}},{'$group':{'_id':_0x4bef13(0x19d),'name':{'$first':_0x4bef13(0x20a)},'primary_code':{'$first':_0x4bef13(0x1d5)},'secondary_code':{'$first':_0x4bef13(0x1ce)},'product_code':{'$first':_0x4bef13(0x214)},'instock':{'$first':_0x4bef13(0x1c5)},'warehouse':{'$first':_0x4bef13(0x235)},'level':{'$first':_0x4bef13(0x1a6)},'isle':{'$first':_0x4bef13(0x1b6)},'pallet':{'$first':_0x4bef13(0x21c)},'maxProducts':{'$first':'$product_details.maxProducts'},'unit':{'$first':_0x4bef13(0x208)},'expiry_date':{'$first':_0x4bef13(0x19f)},'production_date':{'$first':_0x4bef13(0x16c)}}}]);_0x5c1dd5[_0x4bef13(0x1c9)](0xc8)[_0x4bef13(0x1ac)](_0x1187e2);}catch(_0x1463e2){_0x5c1dd5['status'](0x194)['json']({'message':_0x1463e2[_0x4bef13(0x19a)]});}}),router[a0_0x383b8c(0x219)](a0_0x383b8c(0x233),async(_0x23c66d,_0x45a120)=>{var _0x4c98f9=a0_0x383b8c;try{const {FromWareHouse:_0x205687,FromRoom:_0x10d616,ToWarehouse:_0x3786ff,ToRoom:_0x3a4922,product_code:_0x2a3da7}=_0x23c66d[_0x4c98f9(0x164)],_0x39ed54=await warehouse[_0x4c98f9(0x22c)]([{'$match':{'name':_0x205687}},{'$unwind':_0x4c98f9(0x207)},{'$match':{'product_details.product_code':_0x2a3da7}},{'$group':{'_id':_0x4c98f9(0x19d),'name':{'$first':_0x4c98f9(0x20a)},'primary_code':{'$first':_0x4c98f9(0x1d5)},'secondary_code':{'$first':_0x4c98f9(0x1ce)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x4c98f9(0x1c5)},'warehouse':{'$first':_0x4c98f9(0x235)},'level':{'$first':_0x4c98f9(0x1a6)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4c98f9(0x21c)},'maxProducts':{'$first':_0x4c98f9(0x202)},'unit':{'$first':_0x4c98f9(0x208)}}}]);_0x45a120['status'](0xc8)[_0x4c98f9(0x1ac)](_0x39ed54);}catch(_0x5b4774){_0x45a120[_0x4c98f9(0x1c9)](0x194)[_0x4c98f9(0x1ac)]({'message':_0x5b4774[_0x4c98f9(0x19a)]});}}),router['post']('/CheckingWarehouse',async(_0x1be709,_0x5af26e)=>{var _0x11d269=a0_0x383b8c;const {productCode:_0x2a93e8,bay:_0x4c18cb,warehouses:_0x3eac8b,room:_0x506bbd}=_0x1be709[_0x11d269(0x164)];console['log'](_0x1be709[_0x11d269(0x164)]);try{const _0x7d8c92=await warehouse[_0x11d269(0x22c)]([{'$match':{'name':_0x3eac8b,'room':_0x506bbd}},{'$unwind':_0x11d269(0x207)},{'$match':{'product_details.bay':parseInt(_0x4c18cb)}},{'$group':{'_id':_0x11d269(0x19d),'name':{'$first':_0x11d269(0x20a)},'product_stock':{'$first':_0x11d269(0x1c5)},'bay':{'$first':_0x11d269(0x16a)},'maxProducts':{'$first':_0x11d269(0x202)}}}]);_0x5af26e['status'](0xc8)[_0x11d269(0x1ac)](_0x7d8c92);}catch(_0x12c3e4){_0x5af26e['status'](0x194)[_0x11d269(0x1ac)]({'message':_0x12c3e4['message']});}}),module[a0_0x383b8c(0x239)]=router;