var a0_0x17acd9=a0_0x44a2;(function(_0x1036e9,_0x524214){var _0x11bf52=a0_0x44a2,_0x2c9af1=_0x1036e9();while(!![]){try{var _0x156c50=-parseInt(_0x11bf52(0x1eb))/0x1*(parseInt(_0x11bf52(0x185))/0x2)+parseInt(_0x11bf52(0x154))/0x3*(-parseInt(_0x11bf52(0x1df))/0x4)+-parseInt(_0x11bf52(0x193))/0x5*(-parseInt(_0x11bf52(0x168))/0x6)+-parseInt(_0x11bf52(0x1a6))/0x7+parseInt(_0x11bf52(0x1fc))/0x8+-parseInt(_0x11bf52(0x229))/0x9+parseInt(_0x11bf52(0x206))/0xa;if(_0x156c50===_0x524214)break;else _0x2c9af1['push'](_0x2c9af1['shift']());}catch(_0x54f498){_0x2c9af1['push'](_0x2c9af1['shift']());}}}(a0_0x43d4,0x2674b));const express=require('express'),app=express(),router=express[a0_0x17acd9(0x1ea)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x17acd9(0x1c2)),auth=require(a0_0x17acd9(0x15f)),users=require(a0_0x17acd9(0x222)),nodemailer=require(a0_0x17acd9(0x16e));function a0_0x44a2(_0x286d9b,_0x3481aa){var _0x43d438=a0_0x43d4();return a0_0x44a2=function(_0x44a25a,_0x95d2e3){_0x44a25a=_0x44a25a-0x153;var _0x4c2bba=_0x43d438[_0x44a25a];return _0x4c2bba;},a0_0x44a2(_0x286d9b,_0x3481aa);}router[a0_0x17acd9(0x1c7)](a0_0x17acd9(0x183),auth,async(_0x4c79a4,_0x200abc)=>{var _0x3b7f6c=a0_0x17acd9;try{const {username:_0x3daa97,email:_0x2c7b43,role:_0xa768b}=_0x4c79a4[_0x3b7f6c(0x182)],_0x3e35e3=_0x4c79a4[_0x3b7f6c(0x182)],_0x170a2b=await profile[_0x3b7f6c(0x1a2)]({'email':_0x3e35e3[_0x3b7f6c(0x158)]}),_0x115ad3=await master_shop[_0x3b7f6c(0x1a0)]();let _0x2f3dc1;if(_0x3e35e3[_0x3b7f6c(0x217)]==_0x3b7f6c(0x21e)){const _0x315521=await staff[_0x3b7f6c(0x1a2)]({'email':_0x3e35e3[_0x3b7f6c(0x158)]});_0x2f3dc1=await transfers_finished[_0x3b7f6c(0x1a0)]({'from_warehouse':_0x315521[_0x3b7f6c(0x1a9)]});}else _0x2f3dc1=await transfers_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x3b7f6c(0x1db),'invoice':{'$first':_0x3b7f6c(0x1a7)},'date':{'$first':_0x3b7f6c(0x19d)},'from_warehouse':{'$first':_0x3b7f6c(0x1f1)},'to_warehouse':{'$first':_0x3b7f6c(0x18e)},'from_room_name':{'$addToSet':_0x3b7f6c(0x1ab)},'to_room_name':{'$addToSet':_0x3b7f6c(0x175)},'finalize':{'$first':_0x3b7f6c(0x1d2)}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]=='English\x20(US)')var _0x59b8b4=users[_0x3b7f6c(0x1ad)];else{if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]==_0x3b7f6c(0x190))var _0x59b8b4=users['Hindi'];else{if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]==_0x3b7f6c(0x171))var _0x59b8b4=users[_0x3b7f6c(0x171)];else{if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]==_0x3b7f6c(0x1c0))var _0x59b8b4=users[_0x3b7f6c(0x1c0)];else{if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]==_0x3b7f6c(0x1b3))var _0x59b8b4=users[_0x3b7f6c(0x1b3)];else{if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]==_0x3b7f6c(0x17b))var _0x59b8b4=users[_0x3b7f6c(0x172)];else{if(_0x115ad3[0x0][_0x3b7f6c(0x16b)]=='Chinese')var _0x59b8b4=users['Chinese'];else{if(_0x115ad3[0x0]['language']=='Arabic\x20(ae)')var _0x59b8b4=users[_0x3b7f6c(0x1fb)];}}}}}}}_0x200abc[_0x3b7f6c(0x214)](_0x3b7f6c(0x1d6),{'success':_0x4c79a4[_0x3b7f6c(0x18b)]('success'),'errors':_0x4c79a4['flash'](_0x3b7f6c(0x1a8)),'role':_0x3e35e3,'profile':_0x170a2b,'master_shop':_0x115ad3,'transfer':_0x2f3dc1,'language':_0x59b8b4});}catch(_0x37e656){console['log'](_0x37e656);}});function a0_0x43d4(){var _0x5ea354=['nodemailer','filter','primary_code','German','Portuguese','json','id_transaction','$product.to_room_name','to_invoice','RoomAssigned','$product_details.bay','edit_transfer_finished','\x20<=>\x20','Portuguese\x20(BR)','maxProducts','from_invoice','$product_details.product_stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</tbody>','ToRoomAssigned','user','/view','logo','8546yNlAWh','/view/add_transfer','<tr>','post','/preview/:id','To_invoice','flash','Error\x20Occurs','DRY\x20GOODS','$to_warehouse','$product_details._id','Hindi','/CheckingWarehouse','findById','1184945piNHuB','from_quantity','map','Transfer\x20Mail','push','$product_details.bin','random','<html><head><title></title>','site_title','padStart','$date','product_details','prod_name','find','from_room_name','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.secondary_unit','here1','1388086cVjvnJ','$invoice','errors','warehouse','from_prod_qty','$product.from_room_name','\x20Order\x20Number\x20:\x20','English','$product_details.type','secondary_unit','Rack\x201','/upload/','save','French','/../public','transfer_data','$product_details.maxPerUnit','_id','maxPerUnit','Transfer\x20Edit\x20Successfully','An\x20error\x20occurred\x20while\x20saving\x20data.','to_room','New_Qty_Converted','here2','</td>','createTransport','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','../models/all_models','to_prod_qty','to_bay','$room','FGSEmail','get','params','forEach','</span>','invoice','product','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','$name','sendMail','updateOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$finalize','$product_details.pallet','$product_details.maxProducts','secondary_code','transfer_finished','status','batch_code','$product_details.rack','product_code','$_id','/view/:id','exports','$product_details.storage','178392TEsCTM','expiry_date','</body></html>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','back','Arabic\x20(ae)','$product_details.floorlevel','unit','$product_details.production_date','split','concat','Router','38tmjyiu','success','$product_details.product_code','</thead>','</h5>','$product_details','$from_warehouse','$product_details.expiry_date','bay','date','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Chinese','product_code3','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','to_prod_level','Arabic','145136jSHpXZ','Finished\x20Goods','to_warehouse','prod_cat','host','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','production_date','QA\x20Warehouse','finalize','</div>','4999990xwXvwR','to_floorlevel','$product_details.unit','to_room_name','English\x20(US)','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.batch_code','log','from_bay','message','all','slice','/barcode_scanner','redirect','render','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','role','abs','product_name','$product_details.product_name','undefined','</tr>','An\x20error\x20occurred.','staff','product_date','product_stock','body','../public/language/languages.json','from_room','add_transfer_finished','toString','$product_details.secondary_code','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','1731105VRhQBC','<div>','Logo.png','to_quantity','MaxStocks_data','TRFF-','3elUvUC','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','email','from_warehouse','/transfer_finished/view','catch','error','getMonth','then','../middleware/auth','/transfer/view','from_prod_level','Rack\x202','/picking_list/PDF_transfer/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.invoice','$product_details.primary_code','Enabled','6Cntaxn','MaxStocks_data2','$product_details.level','language','Transfer\x20Finalize\x20Successfully','max'];a0_0x43d4=function(){return _0x5ea354;};return a0_0x43d4();}async function getRandom8DigitNumber(){var _0x1a5c06=a0_0x17acd9;const _0x4ae190=0x989680,_0x3d3973=0x5f5e0ff,_0x4455c9=Math[_0x1a5c06(0x227)](Math[_0x1a5c06(0x199)]()*(_0x3d3973-_0x4ae190+0x1))+_0x4ae190;var _0x39cf89;const _0x562ad8=await transfers_finished[_0x1a5c06(0x1a2)]({'invoice':_0x1a5c06(0x153)+_0x4455c9});return _0x562ad8&&_0x562ad8['length']>0x0?_0x39cf89=_0x1a5c06(0x153)+_0x4455c9:_0x39cf89='TRFF-'+_0x4455c9,_0x39cf89;}router['get'](a0_0x17acd9(0x186),auth,async(_0x1e8aa7,_0x5d3041)=>{var _0x12413d=a0_0x17acd9;try{const {username:_0x1f575d,email:_0x67d4b0,role:_0x109ae9}=_0x1e8aa7[_0x12413d(0x182)],_0x47c978=_0x1e8aa7['user'],_0x589c87=await profile['findOne']({'email':_0x47c978[_0x12413d(0x158)]}),_0x166a35=await master_shop[_0x12413d(0x1a0)]();let _0x2016b7;if(_0x47c978[_0x12413d(0x217)]=='staff'){const _0x1d9db1=await staff[_0x12413d(0x1a2)]({'email':_0x47c978['email']});_0x2016b7=await warehouse[_0x12413d(0x1f5)]([{'$match':{'status':_0x12413d(0x167),'name':_0x1d9db1[_0x12413d(0x1a9)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x2016b7=await warehouse[_0x12413d(0x1f5)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x12413d(0x203)}}},{'$group':{'_id':'$name','name':{'$first':_0x12413d(0x1ce)}}}]);const _0x15ff40=await transfers_finished[_0x12413d(0x1a0)]({}),_0x15158b=_0x15ff40[_0x12413d(0x156)]+0x1,_0xf36204=_0x12413d(0x153)+_0x15158b[_0x12413d(0x225)]()[_0x12413d(0x19c)](0x5,'0');if(_0x166a35[0x0][_0x12413d(0x16b)]=='English\x20(US)')var _0x470c7e=users[_0x12413d(0x1ad)];else{if(_0x166a35[0x0][_0x12413d(0x16b)]==_0x12413d(0x190))var _0x470c7e=users[_0x12413d(0x190)];else{if(_0x166a35[0x0][_0x12413d(0x16b)]==_0x12413d(0x171))var _0x470c7e=users[_0x12413d(0x171)];else{if(_0x166a35[0x0][_0x12413d(0x16b)]==_0x12413d(0x1c0))var _0x470c7e=users['Spanish'];else{if(_0x166a35[0x0]['language']==_0x12413d(0x1b3))var _0x470c7e=users[_0x12413d(0x1b3)];else{if(_0x166a35[0x0]['language']==_0x12413d(0x17b))var _0x470c7e=users[_0x12413d(0x172)];else{if(_0x166a35[0x0][_0x12413d(0x16b)]==_0x12413d(0x1f7))var _0x470c7e=users[_0x12413d(0x1f7)];else{if(_0x166a35[0x0]['language']==_0x12413d(0x1e4))var _0x470c7e=users[_0x12413d(0x1fb)];}}}}}}}const _0x23a198=getRandom8DigitNumber();_0x23a198[_0x12413d(0x15e)](_0x39d822=>{var _0xcff253=_0x12413d;_0x5d3041[_0xcff253(0x214)](_0xcff253(0x224),{'success':_0x1e8aa7[_0xcff253(0x18b)](_0xcff253(0x1ec)),'errors':_0x1e8aa7[_0xcff253(0x18b)]('errors'),'role':_0x47c978,'profile':_0x589c87,'master_shop':_0x166a35,'warehouse':_0x2016b7,'language':_0x470c7e,'invoice':_0x39d822});})[_0x12413d(0x15b)](_0x502347=>{var _0x955f4c=_0x12413d;_0x1e8aa7[_0x955f4c(0x18b)](_0x955f4c(0x1a8),_0x955f4c(0x1e2)),_0x5d3041[_0x955f4c(0x213)](_0x955f4c(0x160));});}catch(_0x222ed4){console[_0x12413d(0x20d)](_0x222ed4);}}),router['post'](a0_0x17acd9(0x186),auth,async(_0x336b62,_0x2078ab)=>{var _0x1321eb=a0_0x17acd9;try{const {date:_0x239f4c,from_warehouse:_0x5c91a8,FromRoom_name:_0x252435,to_warehouse:_0x41d0a0,ToRoom_name:_0x5bc081,prod_name:_0x616258,from_prod_qty:_0x5b5852,from_prod_level:_0x517cd4,from_prod_isle:_0x554053,from_prod_pallet:_0x11c49d,to_prod_qty:_0x58016b,to_prod_level:_0x44ca1c,to_prod_isle:_0x557fae,to_prod_pallet:_0x839b36,primary_code:_0x321361,secondary_code:_0x581873,product_code3:_0x4a4224,note:_0x4a65c8,MaxStocks_data2:_0x5ee2cc,invoice:_0x21d81c,expiry_date:_0x7a261d}=_0x336b62[_0x1321eb(0x221)];if(typeof _0x616258=='string')var _0x22db81=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x19f)]],_0x52ea5e=[_0x336b62[_0x1321eb(0x221)]['from_prod_qty']],_0x50f4a8=[_0x336b62['body']['from_prod_level']],_0x4c3c1a=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1bc)]],_0x2cd997=[_0x336b62[_0x1321eb(0x221)]['to_prod_level']],_0x1f49bc=[_0x336b62['body']['primary_code']],_0x152e09=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1d5)]],_0x48ac91=[_0x336b62['body']['product_code3']],_0x4d93bd=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x169)]],_0x29b4b5=[_0x336b62['body']['primary_unit']],_0x5d4a8b=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1af)]],_0x49cf9c=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1d8)]],_0x472d4f=[_0x336b62['body'][_0x1321eb(0x1e0)]],_0x26b515=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x21f)]],_0x346cc9=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x22d)]],_0x32d521=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1b8)]],_0x4f5c6a=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1ff)]],_0x18e513=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x177)]],_0x54578b=[_0x336b62[_0x1321eb(0x221)]['ToRoomAssigned']],_0x193367=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x17d)]],_0x2f2e1c=[_0x336b62[_0x1321eb(0x221)]['to_invoice']],_0x45174a=[_0x336b62[_0x1321eb(0x221)][_0x1321eb(0x174)]];else var _0x22db81=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x19f)]],_0x52ea5e=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1aa)]],_0x50f4a8=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x161)]],_0x4c3c1a=[..._0x336b62[_0x1321eb(0x221)]['New_Qty_Converted']],_0x2cd997=[..._0x336b62[_0x1321eb(0x221)]['to_prod_level']],_0x1f49bc=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x170)]],_0x152e09=[..._0x336b62[_0x1321eb(0x221)]['secondary_code']],_0x48ac91=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1f8)]],_0x4d93bd=[..._0x336b62[_0x1321eb(0x221)]['MaxStocks_data2']],_0x29b4b5=[..._0x336b62[_0x1321eb(0x221)]['primary_unit']],_0x5d4a8b=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1af)]],_0x49cf9c=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1d8)]],_0x472d4f=[..._0x336b62['body'][_0x1321eb(0x1e0)]],_0x26b515=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x21f)]],_0x346cc9=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x22d)]],_0x32d521=[..._0x336b62['body'][_0x1321eb(0x1b8)]],_0x4f5c6a=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x1ff)]],_0x18e513=[..._0x336b62['body']['RoomAssigned']],_0x54578b=[..._0x336b62['body'][_0x1321eb(0x181)]],_0x193367=[..._0x336b62[_0x1321eb(0x221)]['from_invoice']],_0x2f2e1c=[..._0x336b62[_0x1321eb(0x221)][_0x1321eb(0x176)]],_0x45174a=[..._0x336b62[_0x1321eb(0x221)]['id_transaction']];const _0x293f9c=_0x22db81['map'](_0x502065=>{return _0x502065={'product_name':_0x502065};});_0x52ea5e[_0x1321eb(0x1c9)]((_0xbd85e0,_0xe011db)=>{var _0xfe976=_0x1321eb;_0x293f9c[_0xe011db][_0xfe976(0x194)]=_0xbd85e0;}),_0x50f4a8[_0x1321eb(0x1c9)]((_0x502191,_0x368ff1)=>{var _0x2e102a=_0x1321eb;_0x293f9c[_0x368ff1][_0x2e102a(0x20e)]=_0x502191;}),_0x45174a[_0x1321eb(0x1c9)]((_0x3a4863,_0x23fc03)=>{_0x293f9c[_0x23fc03]['id_transaction']=_0x3a4863;}),_0x193367['forEach']((_0x8d134,_0x45b6f0)=>{_0x293f9c[_0x45b6f0]['from_invoice']=_0x8d134;}),_0x2f2e1c['forEach']((_0x5281d2,_0x204900)=>{var _0x4f3e85=_0x1321eb;_0x293f9c[_0x204900][_0x4f3e85(0x18a)]=_0x5281d2;}),_0x4c3c1a[_0x1321eb(0x1c9)]((_0x1865e6,_0x161dbb)=>{_0x293f9c[_0x161dbb]['to_quantity']=_0x1865e6;}),_0x2cd997['forEach']((_0x395e13,_0x3da82d)=>{var _0x2458c8=_0x1321eb;_0x293f9c[_0x3da82d][_0x2458c8(0x1c4)]=_0x395e13;}),_0x1f49bc['forEach']((_0x10332d,_0x4e666f)=>{var _0x22d638=_0x1321eb;_0x293f9c[_0x4e666f][_0x22d638(0x170)]=_0x10332d;}),_0x152e09[_0x1321eb(0x1c9)]((_0x19ec57,_0x3dfbcc)=>{var _0x454e50=_0x1321eb;_0x293f9c[_0x3dfbcc][_0x454e50(0x1d5)]=_0x19ec57;}),_0x48ac91[_0x1321eb(0x1c9)]((_0x69ace8,_0x1a4f24)=>{var _0x57f2c0=_0x1321eb;_0x293f9c[_0x1a4f24][_0x57f2c0(0x1da)]=_0x69ace8;}),_0x4d93bd[_0x1321eb(0x1c9)]((_0x50b86f,_0x1aeff0)=>{var _0x5e03b9=_0x1321eb;_0x293f9c[_0x1aeff0][_0x5e03b9(0x17c)]=_0x50b86f;}),_0x29b4b5[_0x1321eb(0x1c9)]((_0x281ecb,_0xf32ffb)=>{var _0x53c5b3=_0x1321eb;_0x293f9c[_0xf32ffb][_0x53c5b3(0x1e6)]=_0x281ecb;}),_0x5d4a8b[_0x1321eb(0x1c9)]((_0x20b27b,_0x123f9d)=>{_0x293f9c[_0x123f9d]['secondary_unit']=_0x20b27b;}),_0x49cf9c[_0x1321eb(0x1c9)]((_0x22d1e2,_0x3f8f67)=>{var _0x54b404=_0x1321eb;_0x293f9c[_0x3f8f67][_0x54b404(0x1d8)]=_0x22d1e2;}),_0x472d4f[_0x1321eb(0x1c9)]((_0x806897,_0x15642b)=>{var _0x4f71f0=_0x1321eb;_0x293f9c[_0x15642b][_0x4f71f0(0x1e0)]=_0x806897;}),_0x26b515[_0x1321eb(0x1c9)]((_0x207f8b,_0x15e281)=>{var _0x3fb969=_0x1321eb;_0x293f9c[_0x15e281][_0x3fb969(0x202)]=_0x207f8b;}),_0x346cc9[_0x1321eb(0x1c9)]((_0x1dbc68,_0x2c0be1)=>{var _0x216adc=_0x1321eb;_0x293f9c[_0x2c0be1][_0x216adc(0x17c)]=_0x1dbc68;}),_0x32d521['forEach']((_0x247657,_0x44c9d0)=>{var _0xefc02b=_0x1321eb;_0x293f9c[_0x44c9d0][_0xefc02b(0x1b8)]=_0x247657;}),_0x4f5c6a['forEach']((_0x3474e5,_0x26cc45)=>{_0x293f9c[_0x26cc45]['prod_cat']=_0x3474e5;}),_0x18e513[_0x1321eb(0x1c9)]((_0x493c61,_0x3f79aa)=>{var _0x5c590d=_0x1321eb;_0x293f9c[_0x3f79aa][_0x5c590d(0x1a1)]=_0x493c61;}),_0x54578b[_0x1321eb(0x1c9)]((_0xa9762c,_0x4dacae)=>{_0x293f9c[_0x4dacae]['to_room_name']=_0xa9762c;});const _0x5e8d8f=_0x293f9c[_0x1321eb(0x16f)](_0x33ec44=>_0x33ec44['to_quantity']!=='0'&&_0x33ec44['to_quantity']!==''||_0x33ec44[_0x1321eb(0x207)]!=='0'&&_0x33ec44['to_floorlevel']!=='');var _0x4a3516=0x0;_0x5e8d8f[_0x1321eb(0x1c9)](_0x2267df=>{var _0x2f0805=_0x1321eb;parseInt(_0x2267df['from_quantity'])<parseInt(_0x2267df[_0x2f0805(0x22c)])&&_0x4a3516++;});if(_0x4a3516!=0x0)return _0x336b62[_0x1321eb(0x18b)](_0x1321eb(0x1a8),_0x1321eb(0x1cd)),_0x2078ab[_0x1321eb(0x213)](_0x1321eb(0x1e3));const _0x29b7bb=new transfers_finished({'date':_0x239f4c,'from_warehouse':_0x5c91a8,'to_warehouse':_0x41d0a0,'product':_0x5e8d8f,'note':_0x4a65c8,'invoice':_0x21d81c}),_0x3c3ef9=await _0x29b7bb[_0x1321eb(0x1b2)]();_0x336b62[_0x1321eb(0x18b)](_0x1321eb(0x1ec),'Product\x20Transfer\x20successfully'),_0x2078ab['redirect']('/transfer_finished/preview/'+_0x3c3ef9['_id']);}catch(_0xaa2dc4){console[_0x1321eb(0x20d)](_0xaa2dc4),_0x2078ab[_0x1321eb(0x1d7)](0xc8)[_0x1321eb(0x173)]({'errorMessage':_0xaa2dc4[_0x1321eb(0x20f)]});}}),router[a0_0x17acd9(0x1c7)](a0_0x17acd9(0x189),auth,async(_0x4664a1,_0x7bf484)=>{var _0x33a644=a0_0x17acd9;try{const {username:_0x5add4f,email:_0x5a39ad,role:_0x5ca053}=_0x4664a1['user'],_0x43dad9=_0x4664a1['user'],_0x14abb2=await profile[_0x33a644(0x1a2)]({'email':_0x43dad9[_0x33a644(0x158)]}),_0x44f2d2=await master_shop[_0x33a644(0x1a0)](),_0x20de35=await transfers_finished[_0x33a644(0x192)](_0x4664a1[_0x33a644(0x1c8)]['id']);let _0x310f6f;if(_0x43dad9['role']=='staff'){const _0x3bddeb=await staff['findOne']({'email':_0x43dad9[_0x33a644(0x158)]});_0x310f6f=await warehouse[_0x33a644(0x1a0)]({'status':_0x33a644(0x167),'name':_0x3bddeb['warehouse'],'warehouse_category':_0x33a644(0x1fd)});}else _0x310f6f=await warehouse[_0x33a644(0x1a0)]({'status':_0x33a644(0x167),'warehouse_category':'Finished\x20Goods'});const _0x44096a=await warehouse[_0x33a644(0x1f5)]([{'$match':{'name':_0x20de35[_0x33a644(0x159)],'warehouse_category':_0x33a644(0x1fd)}},{'$unwind':_0x33a644(0x1f0)},{'$group':{'_id':_0x33a644(0x18f),'name':{'$first':_0x33a644(0x21a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x33a644(0x178)},'bin':{'$first':_0x33a644(0x198)},'type':{'$first':_0x33a644(0x1ae)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x33a644(0x166)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x33a644(0x1ed)},'storage':{'$first':_0x33a644(0x1de)},'rack':{'$first':_0x33a644(0x1d9)},'expiry_date':{'$first':_0x33a644(0x1f2)},'production_date':{'$first':_0x33a644(0x1e7)},'room':{'$first':_0x33a644(0x1c5)},'warehoue_name':{'$first':_0x33a644(0x1ce)}}}]),_0x139143=await product[_0x33a644(0x1a0)]({});if(_0x44f2d2[0x0][_0x33a644(0x16b)]==_0x33a644(0x20a)){var _0x12bf00=users[_0x33a644(0x1ad)];console['log'](_0x12bf00);}else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]=='Hindi')var _0x12bf00=users[_0x33a644(0x190)];else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]=='German')var _0x12bf00=users['German'];else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]==_0x33a644(0x1c0))var _0x12bf00=users[_0x33a644(0x1c0)];else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]==_0x33a644(0x1b3))var _0x12bf00=users['French'];else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]==_0x33a644(0x17b))var _0x12bf00=users['Portuguese'];else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]=='Chinese')var _0x12bf00=users['Chinese'];else{if(_0x44f2d2[0x0][_0x33a644(0x16b)]==_0x33a644(0x1e4))var _0x12bf00=users['Arabic'];}}}}}}}_0x7bf484[_0x33a644(0x214)]('edit_transfer_finished_view',{'success':_0x4664a1[_0x33a644(0x18b)](_0x33a644(0x1ec)),'errors':_0x4664a1[_0x33a644(0x18b)](_0x33a644(0x1a8)),'role':_0x43dad9,'profile':_0x14abb2,'master_shop':_0x44f2d2,'warehouse':_0x310f6f,'transfer':_0x20de35,'stock':_0x44096a,'unit':_0x139143,'language':_0x12bf00});}catch(_0x541d41){console['log'](_0x541d41);}}),router[a0_0x17acd9(0x188)](a0_0x17acd9(0x189),auth,async(_0x35129d,_0xdd1133)=>{var _0x13d368=a0_0x17acd9;try{const {invoice:_0x410116,from_warehouse:_0x43f5ce,FromRoom_name:_0x4a7029,to_warehouse:_0x56d982,ToRoom_name:_0x433d27}=_0x35129d[_0x13d368(0x221)],_0x5aa479=await transfers_finished[_0x13d368(0x192)](_0x35129d[_0x13d368(0x1c8)]['id']),_0x5cf899=_0x5aa479['product'][_0x13d368(0x195)](async _0x120ed6=>{var _0x291f02=_0x13d368;if(_0x120ed6[_0x291f02(0x22c)]>0x0){var _0x3a9f37=await warehouse[_0x291f02(0x1a2)]({'name':_0x43f5ce,'room':_0x120ed6[_0x291f02(0x1a1)],'warehouse_category':_0x291f02(0x1fd)});const _0x5365d5=_0x3a9f37[_0x291f02(0x19e)][_0x291f02(0x195)](_0x32f886=>{var _0xe182b1=_0x291f02;_0x32f886['product_name']==_0x120ed6[_0xe182b1(0x219)]&&_0x32f886[_0xe182b1(0x1f3)]==_0x120ed6[_0xe182b1(0x20e)]&&_0x32f886[_0xe182b1(0x1e0)]==_0x120ed6[_0xe182b1(0x1e0)]&&_0x32f886[_0xe182b1(0x202)]==_0x120ed6[_0xe182b1(0x202)]&&_0x32f886[_0xe182b1(0x1d8)]==_0x120ed6['batch_code']&&_0x32f886[_0xe182b1(0x1cb)]==_0x120ed6[_0xe182b1(0x17d)]&&(console[_0xe182b1(0x20d)](_0xe182b1(0x1a5),_0x32f886[_0xe182b1(0x220)]),typeof _0x120ed6['id_transaction']=='undefined'?_0x32f886[_0xe182b1(0x220)]=Math[_0xe182b1(0x16d)](0x0,Math[_0xe182b1(0x218)](_0x32f886[_0xe182b1(0x220)])-Math[_0xe182b1(0x218)](_0x120ed6['to_quantity'])):_0x32f886[_0xe182b1(0x220)]=Math[_0xe182b1(0x16d)](0x0,Math[_0xe182b1(0x218)](_0x32f886[_0xe182b1(0x220)])-Math['abs'](_0x120ed6[_0xe182b1(0x22c)])));});}return _0x3a9f37;});Promise[_0x13d368(0x210)](_0x5cf899)[_0x13d368(0x15e)](async _0x228d5f=>{var _0x33f8d8=_0x13d368;try{for(const _0x4c9481 of _0x228d5f){await _0x4c9481[_0x33f8d8(0x1b2)]();}const _0x4bfa75=_0x5aa479[_0x33f8d8(0x1cc)][_0x33f8d8(0x195)](async _0xacd111=>{var _0x29b0e8=_0x33f8d8,_0x5c2358=await warehouse['findOne']({'name':_0x56d982,'room':_0xacd111[_0x29b0e8(0x209)]});if(_0xacd111['to_quantity']>0x0){var _0x4cd331=0x0;const _0x1a747=_0x5c2358['product_details']['map'](_0x3da1bb=>{var _0x13a904=_0x29b0e8;_0x3da1bb[_0x13a904(0x219)]==_0xacd111[_0x13a904(0x219)]&&_0x3da1bb[_0x13a904(0x1f3)]==_0xacd111[_0x13a904(0x1c4)]&&_0x3da1bb[_0x13a904(0x1e0)]==_0xacd111[_0x13a904(0x1e0)]&&_0x3da1bb[_0x13a904(0x202)]==_0xacd111[_0x13a904(0x202)]&&_0x3da1bb['batch_code']==_0xacd111[_0x13a904(0x1d8)]&&_0x3da1bb[_0x13a904(0x1cb)]==_0xacd111[_0x13a904(0x18a)]&&(typeof _0xacd111[_0x13a904(0x174)]==_0x13a904(0x21b)?(console['log'](_0x13a904(0x1bd),_0x3da1bb[_0x13a904(0x220)]+'\x20<>\x20'+_0x3da1bb[_0x13a904(0x1b7)]+_0x13a904(0x17a)+Math[_0x13a904(0x218)](_0x3da1bb[_0x13a904(0x220)])+Math[_0x13a904(0x218)](_0xacd111[_0x13a904(0x22c)])),_0x3da1bb['product_stock']=Math[_0x13a904(0x218)](_0x3da1bb['product_stock'])+Math[_0x13a904(0x218)](_0xacd111[_0x13a904(0x22c)])):_0x3da1bb['product_stock']=Math['abs'](_0x3da1bb['product_stock'])+Math[_0x13a904(0x218)](_0xacd111[_0x13a904(0x22c)]),_0x4cd331++);});_0x4cd331=='0'&&(_0x5c2358[_0x29b0e8(0x19e)]=_0x5c2358[_0x29b0e8(0x19e)][_0x29b0e8(0x1e9)]({'product_name':_0xacd111[_0x29b0e8(0x219)],'product_stock':_0xacd111[_0x29b0e8(0x22c)],'bay':_0xacd111['to_bay'],'product_code':_0xacd111[_0x29b0e8(0x1da)],'primary_code':_0xacd111[_0x29b0e8(0x170)],'secondary_code':_0xacd111[_0x29b0e8(0x1d5)],'expiry_date':_0xacd111['expiry_date'],'production_date':_0xacd111['production_date'],'maxProducts':_0xacd111[_0x29b0e8(0x17c)],'batch_code':_0xacd111[_0x29b0e8(0x1d8)],'secondary_unit':_0xacd111[_0x29b0e8(0x1af)],'unit':_0xacd111[_0x29b0e8(0x1e6)],'maxProducts':_0xacd111['maxProducts'],'maxPerUnit':_0xacd111['maxPerUnit'],'invoice':_0xacd111[_0x29b0e8(0x18a)]}));}return _0x5c2358;});Promise['all'](_0x4bfa75)['then'](async _0xad2bbb=>{var _0x270438=_0x33f8d8;try{for(const _0x126360 of _0xad2bbb){await warehouse[_0x270438(0x1d0)]({'_id':_0x126360[_0x270438(0x1b7)]},{'$addToSet':{'product_details':{'$each':_0x126360[_0x270438(0x19e)]}}});}_0x5aa479[_0x270438(0x204)]='True';const _0x2c6cdf=await _0x5aa479['save'](),_0x44fe57=await master_shop[_0x270438(0x1a0)](),_0x2e2c05=await email_settings[_0x270438(0x1a2)](),_0x5a859b=await supervisor_settings[_0x270438(0x1a0)]();var _0x2a6199=_0x5aa479[_0x270438(0x1cc)],_0x343c8f='',_0x2558b2;for(_0x2558b2 in _0x2a6199){var _0xf21681='FG';_0x5aa479['to_warehouse']==_0x270438(0x18d)&&(_0xf21681='DG'),_0x343c8f+='<tr>'+_0x270438(0x17f)+_0x2a6199[_0x2558b2]['product_name']+_0x270438(0x1be)+_0x270438(0x17f)+_0x2a6199[_0x2558b2][_0x270438(0x1da)]+_0x270438(0x1be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a6199[_0x2558b2]['to_quantity']+_0x270438(0x1be)+_0x270438(0x17f)+_0x2a6199[_0x2558b2][_0x270438(0x1e6)]+_0x270438(0x1be)+_0x270438(0x17f)+_0x2a6199[_0x2558b2][_0x270438(0x1af)]+_0x270438(0x1be)+_0x270438(0x17f)+_0x5aa479[_0x270438(0x1fe)]+_0x270438(0x1be)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2a6199[_0x2558b2][_0x270438(0x209)]+_0x270438(0x1be)+_0x270438(0x17f)+_0xf21681+_0x2a6199[_0x2558b2][_0x270438(0x1c4)]+_0x270438(0x1be)+_0x270438(0x21c);}let _0x14c30b=nodemailer[_0x270438(0x1bf)]({'host':_0x2e2c05[_0x270438(0x200)],'port':Number(_0x2e2c05['port']),'secure':![],'auth':{'user':_0x2e2c05[_0x270438(0x158)],'pass':_0x2e2c05['password']}}),_0x3f3e6c={'from':_0x2e2c05[_0x270438(0x158)],'to':_0x5a859b[0x0][_0x270438(0x1c6)],'subject':_0x270438(0x196),'attachments':[{'filename':_0x270438(0x22b),'path':__dirname+_0x270438(0x1b4)+_0x270438(0x1b1)+_0x44fe57[0x0]['image'],'cid':_0x270438(0x184)}],'html':'<!DOCTYPE\x20html>'+_0x270438(0x19a)+'</head><body>'+_0x270438(0x22a)+_0x270438(0x201)+_0x270438(0x22a)+_0x270438(0x216)+_0x270438(0x205)+_0x270438(0x22a)+'<h2>\x20'+_0x44fe57[0x0][_0x270438(0x19b)]+'\x20</h2>'+_0x270438(0x205)+_0x270438(0x205)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x270438(0x1ac)+_0x5aa479[_0x270438(0x1cb)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x5aa479['date']+'\x20'+_0x270438(0x1ca)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x270438(0x215)+_0x270438(0x187)+_0x270438(0x164)+_0x270438(0x1d1)+_0x270438(0x155)+_0x270438(0x157)+_0x270438(0x1a3)+_0x270438(0x228)+_0x270438(0x1c1)+_0x270438(0x1f6)+_0x270438(0x21c)+_0x270438(0x1ee)+_0x270438(0x20b)+'\x20'+_0x343c8f+'\x20'+_0x270438(0x180)+'</table>'+_0x270438(0x22a)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x44fe57[0x0][_0x270438(0x19b)]+_0x270438(0x1ef)+_0x270438(0x205)+'</div>'+_0x270438(0x1e1)};_0x14c30b[_0x270438(0x1cf)](_0x3f3e6c,function(_0x43e208,_0x327b00){var _0x1cc29b=_0x270438;_0x43e208?(console[_0x1cc29b(0x20d)](_0x43e208),console[_0x1cc29b(0x20d)](_0x1cc29b(0x18c))):console['log']('Email\x20sent\x20successfully');}),_0x35129d[_0x270438(0x18b)](_0x270438(0x1ec),_0x270438(0x16c)),_0xdd1133['redirect'](_0x270438(0x163)+_0x2c6cdf[_0x270438(0x1b7)]);}catch(_0x3c75f4){console[_0x270438(0x15c)](_0x3c75f4),_0xdd1133[_0x270438(0x1d7)](0x1f4)[_0x270438(0x173)]({'error':_0x270438(0x1f9)});}})[_0x33f8d8(0x15b)](_0x694870=>{var _0x32163a=_0x33f8d8;console['error'](_0x694870),_0xdd1133[_0x32163a(0x1d7)](0x1f4)[_0x32163a(0x173)]({'error':_0x32163a(0x21d)});});}catch(_0x173ddb){console[_0x33f8d8(0x15c)](_0x173ddb),_0xdd1133['status'](0x1f4)[_0x33f8d8(0x173)]({'error':_0x33f8d8(0x1ba)});}})[_0x13d368(0x15b)](_0x41c2b3=>{var _0x235f2e=_0x13d368;console[_0x235f2e(0x15c)](_0x41c2b3),_0xdd1133[_0x235f2e(0x1d7)](0x1f4)[_0x235f2e(0x173)]({'error':'An\x20error\x20occurred.'});});}catch(_0x227918){_0xdd1133[_0x13d368(0x173)]({'message':_0x227918[_0x13d368(0x20f)]});}});function BayBinSelected(_0x478c93,_0x37e18f){var _0x1fb5b1=a0_0x17acd9,_0x36e9e6=[];let _0x4a28d=[];var _0x4c7e5a=[];if(_0x478c93=='DRY\x20GOODS'){switch(_0x37e18f){case _0x1fb5b1(0x1b0):_0x36e9e6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x1fb5b1(0x162):_0x36e9e6=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0x4c7e5a=['DG'];}else{if(_0x478c93=='FROZEN\x20GOODS'){switch(_0x37e18f){case'Rack\x201':_0x36e9e6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case'Rack\x202':_0x36e9e6=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0x4c7e5a=['FG'];}}return{'levels':_0x36e9e6,'identify':_0x4c7e5a};}router[a0_0x17acd9(0x1c7)](a0_0x17acd9(0x1dc),auth,async(_0x10cee2,_0x2c2391)=>{var _0x5dba7a=a0_0x17acd9;try{const {username:_0x52a5ad,email:_0x3bb10a,role:_0x40399a}=_0x10cee2[_0x5dba7a(0x182)],_0xc93b24=_0x10cee2[_0x5dba7a(0x182)],_0x4ea6c9=await profile[_0x5dba7a(0x1a2)]({'email':_0xc93b24[_0x5dba7a(0x158)]}),_0x19f773=await master_shop[_0x5dba7a(0x1a0)](),_0x54e50a=await transfers_finished[_0x5dba7a(0x192)](_0x10cee2[_0x5dba7a(0x1c8)]['id']);let _0x2d8fd2=new Date(_0x54e50a['expiry_date']),_0x1d6bee=('0'+_0x2d8fd2['getDate']())[_0x5dba7a(0x211)](-0x2),_0x5a8df0=('0'+(_0x2d8fd2[_0x5dba7a(0x15d)]()+0x1))[_0x5dba7a(0x211)](-0x2),_0x4375f5=_0x2d8fd2['getFullYear'](),_0xc996=_0x4375f5+'-'+_0x5a8df0+'-'+_0x1d6bee,_0x122ebc;if(_0xc93b24[_0x5dba7a(0x217)]==_0x5dba7a(0x21e)){const _0x23c7e6=await staff['findOne']({'email':_0xc93b24[_0x5dba7a(0x158)]});_0x122ebc=await warehouse[_0x5dba7a(0x1a0)]({'status':'Enabled','name':_0x23c7e6[_0x5dba7a(0x1a9)],'warehouse_category':_0x5dba7a(0x1fd)});}else _0x122ebc=await warehouse['find']({'status':_0x5dba7a(0x167),'warehouse_category':'Finished\x20Goods'});const _0x7fa020=await warehouse[_0x5dba7a(0x1f5)]([{'$match':{'name':_0x54e50a[_0x5dba7a(0x159)],'room':_0x54e50a[_0x5dba7a(0x223)]}},{'$unwind':_0x5dba7a(0x1f0)},{'$group':{'_id':_0x5dba7a(0x18f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5dba7a(0x17e)},'bay':{'$first':_0x5dba7a(0x178)},'bin':{'$first':_0x5dba7a(0x198)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5dba7a(0x226)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5dba7a(0x1de)},'rack':{'$first':_0x5dba7a(0x1d9)}}}]);var _0x574414=[0x1,0x2,0x3,0x4],_0x56e9d1=['A','B','C','D','E','F','G','H','I','J'],_0x13f07e=['Ambient','Enclosed'];const _0xe3f114=await product[_0x5dba7a(0x1a0)]({}),_0x4debf1=BayBinSelected(_0x54e50a[_0x5dba7a(0x1fe)],_0x54e50a[_0x5dba7a(0x1bb)]);if(_0x19f773[0x0]['language']==_0x5dba7a(0x20a)){var _0x1500cc=users[_0x5dba7a(0x1ad)];console[_0x5dba7a(0x20d)](_0x1500cc);}else{if(_0x19f773[0x0][_0x5dba7a(0x16b)]==_0x5dba7a(0x190))var _0x1500cc=users[_0x5dba7a(0x190)];else{if(_0x19f773[0x0][_0x5dba7a(0x16b)]==_0x5dba7a(0x171))var _0x1500cc=users['German'];else{if(_0x19f773[0x0][_0x5dba7a(0x16b)]==_0x5dba7a(0x1c0))var _0x1500cc=users[_0x5dba7a(0x1c0)];else{if(_0x19f773[0x0][_0x5dba7a(0x16b)]==_0x5dba7a(0x1b3))var _0x1500cc=users['French'];else{if(_0x19f773[0x0]['language']==_0x5dba7a(0x17b))var _0x1500cc=users[_0x5dba7a(0x172)];else{if(_0x19f773[0x0][_0x5dba7a(0x16b)]==_0x5dba7a(0x1f7))var _0x1500cc=users[_0x5dba7a(0x1f7)];else{if(_0x19f773[0x0][_0x5dba7a(0x16b)]==_0x5dba7a(0x1e4))var _0x1500cc=users[_0x5dba7a(0x1fb)];}}}}}}}_0x2c2391['render'](_0x5dba7a(0x179),{'success':_0x10cee2[_0x5dba7a(0x18b)](_0x5dba7a(0x1ec)),'errors':_0x10cee2[_0x5dba7a(0x18b)](_0x5dba7a(0x1a8)),'role':_0xc93b24,'profile':_0x4ea6c9,'master_shop':_0x19f773,'warehouse':_0x122ebc,'transfer':_0x54e50a,'stock':_0x7fa020,'unit':_0xe3f114,'language':_0x1500cc,'levels':_0x574414,'Isle':_0x56e9d1,'rooms_data':_0x13f07e,'ed_fullDate':_0xc996,'dataSelected':_0x4debf1});}catch(_0x4edd22){console[_0x5dba7a(0x20d)](_0x4edd22);}}),router['post'](a0_0x17acd9(0x1dc),auth,async(_0x310647,_0x2b33df)=>{var _0x22772a=a0_0x17acd9;try{const _0xf602cb=_0x310647[_0x22772a(0x1c8)]['id'];console[_0x22772a(0x20d)](_0x310647[_0x22772a(0x221)]);const _0x641846=await transfers_finished[_0x22772a(0x192)](_0xf602cb);console[_0x22772a(0x20d)](_0x22772a(0x1b5),_0x641846);const {date:_0x394c78,from_warehouse:_0x461192,FromRoom_name:_0x8cb423,to_warehouse:_0x4a2fd2,ToRoom_name:_0x341730,prod_name:_0x48ce2b,from_prod_qty:_0x123585,from_prod_level:_0x29421f,from_prod_isle:_0x1beca8,from_prod_pallet:_0x5bc41d,to_prod_qty:_0x48a058,to_prod_level:_0x3af5ed,to_prod_isle:_0x446211,to_prod_pallet:_0x51d661,primary_code:_0x171305,secondary_code:_0x1b0537,product_code3:_0x5800cc,note:_0x203afa,invoice:_0x566e3d,expiry_date:_0x46fff2}=_0x310647[_0x22772a(0x221)];if(typeof _0x48ce2b=='string')var _0x518b91=[_0x310647[_0x22772a(0x221)]['prod_name']],_0x307d44=[_0x310647[_0x22772a(0x221)]['from_prod_qty']],_0x78ae58=[_0x310647[_0x22772a(0x221)][_0x22772a(0x161)]],_0x37eff1=[_0x310647[_0x22772a(0x221)]['to_prod_qty']],_0x3fbc2a=[_0x310647['body'][_0x22772a(0x1fa)]],_0x25ac0e=[_0x310647[_0x22772a(0x221)][_0x22772a(0x170)]],_0x2afa90=[_0x310647['body'][_0x22772a(0x1d5)]],_0x1e6661=[_0x310647[_0x22772a(0x221)][_0x22772a(0x1f8)]],_0xbe9dac=[_0x310647['body'][_0x22772a(0x169)]],_0x135ba7=[_0x310647[_0x22772a(0x221)][_0x22772a(0x1e6)]],_0x273e31=[_0x310647[_0x22772a(0x221)][_0x22772a(0x1af)]],_0x4e7c7b=[_0x310647[_0x22772a(0x221)][_0x22772a(0x1d8)]],_0x251793=[_0x310647['body'][_0x22772a(0x1e0)]];else var _0x518b91=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x19f)]],_0x307d44=[..._0x310647['body']['from_prod_qty']],_0x78ae58=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x161)]],_0x37eff1=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x1c3)]],_0x3fbc2a=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x1fa)]],_0x25ac0e=[..._0x310647['body'][_0x22772a(0x170)]],_0x2afa90=[..._0x310647[_0x22772a(0x221)]['secondary_code']],_0x1e6661=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x1f8)]],_0xbe9dac=[..._0x310647['body'][_0x22772a(0x169)]],_0x135ba7=[..._0x310647[_0x22772a(0x221)]['unit']],_0x273e31=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x1af)]],_0x4e7c7b=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x1d8)]],_0x251793=[..._0x310647[_0x22772a(0x221)][_0x22772a(0x1e0)]];const _0x5e73b5=_0x518b91[_0x22772a(0x195)](_0x39bee8=>{return _0x39bee8={'product_name':_0x39bee8};});_0x307d44[_0x22772a(0x1c9)]((_0x43b7d2,_0x17f5a0)=>{var _0x16c424=_0x22772a;_0x5e73b5[_0x17f5a0][_0x16c424(0x194)]=_0x43b7d2;}),_0x78ae58['forEach']((_0x44304f,_0x788ce2)=>{var _0x2e425d=_0x22772a;_0x5e73b5[_0x788ce2][_0x2e425d(0x20e)]=_0x44304f;}),_0x37eff1['forEach']((_0x2a9088,_0x183298)=>{var _0x1c9a27=_0x22772a;_0x5e73b5[_0x183298][_0x1c9a27(0x22c)]=_0x2a9088;}),_0x3fbc2a['forEach']((_0x5e5cbe,_0x265114)=>{var _0x3f643e=_0x22772a;_0x5e73b5[_0x265114][_0x3f643e(0x1c4)]=_0x5e5cbe;}),_0x25ac0e['forEach']((_0x347644,_0x1771a9)=>{var _0x30b8a3=_0x22772a;_0x5e73b5[_0x1771a9][_0x30b8a3(0x170)]=_0x347644;}),_0x2afa90[_0x22772a(0x1c9)]((_0x1a9b82,_0x20eebe)=>{var _0x1c8fc9=_0x22772a;_0x5e73b5[_0x20eebe][_0x1c8fc9(0x1d5)]=_0x1a9b82;}),_0x1e6661['forEach']((_0x5705b1,_0x1284ec)=>{var _0x3b0e9b=_0x22772a;_0x5e73b5[_0x1284ec][_0x3b0e9b(0x1da)]=_0x5705b1;}),_0xbe9dac[_0x22772a(0x1c9)]((_0x95485c,_0x315ba5)=>{var _0x3ded7d=_0x22772a;_0x5e73b5[_0x315ba5][_0x3ded7d(0x17c)]=_0x95485c;}),_0x135ba7[_0x22772a(0x1c9)]((_0x33bd64,_0x4cc642)=>{var _0x59eec2=_0x22772a;_0x5e73b5[_0x4cc642][_0x59eec2(0x1e6)]=_0x33bd64;}),_0x273e31[_0x22772a(0x1c9)]((_0x31bf99,_0x146124)=>{var _0x5ac568=_0x22772a;_0x5e73b5[_0x146124][_0x5ac568(0x1af)]=_0x31bf99;}),_0x4e7c7b[_0x22772a(0x1c9)]((_0x8216aa,_0x3de688)=>{var _0x34078e=_0x22772a;_0x5e73b5[_0x3de688][_0x34078e(0x1d8)]=_0x8216aa;}),_0x251793['forEach']((_0x58b612,_0x1d0e92)=>{var _0x236499=_0x22772a;_0x5e73b5[_0x1d0e92][_0x236499(0x1e0)]=_0x58b612;});const _0x34fbc9=_0x5e73b5[_0x22772a(0x16f)](_0x33fd55=>_0x33fd55[_0x22772a(0x22c)]!=='0'&&_0x33fd55[_0x22772a(0x22c)]!==''||_0x33fd55['to_floorlevel']!=='0'&&_0x33fd55[_0x22772a(0x207)]!=='');var _0x1644a6=0x0;_0x34fbc9[_0x22772a(0x1c9)](_0x1d3e84=>{var _0x175ad9=_0x22772a;parseInt(_0x1d3e84[_0x175ad9(0x194)])<parseInt(_0x1d3e84[_0x175ad9(0x22c)])&&_0x1644a6++;});if(_0x1644a6!=0x0)return _0x310647[_0x22772a(0x18b)](_0x22772a(0x1a8),_0x22772a(0x1cd)),_0x2b33df[_0x22772a(0x213)](_0x22772a(0x1e3));const _0x3d5ee2=await warehouse[_0x22772a(0x1a2)]({'name':_0x641846[_0x22772a(0x159)],'room':_0x641846[_0x22772a(0x223)]});_0x641846[_0x22772a(0x1cc)][_0x22772a(0x1c9)](_0x4d088c=>{var _0x1e6564=_0x22772a;if(_0x4d088c[_0x1e6564(0x22c)]>0x0){const _0xae8b0=_0x3d5ee2[_0x1e6564(0x19e)][_0x1e6564(0x195)](_0x5687f2=>{var _0x1e3f3c=_0x1e6564;_0x5687f2[_0x1e3f3c(0x219)]==_0x4d088c['product_name']&&_0x5687f2['bay']==_0x4d088c[_0x1e3f3c(0x20e)]&&(_0x5687f2[_0x1e3f3c(0x220)]=parseInt(_0x5687f2['product_stock'])+parseInt(_0x4d088c[_0x1e3f3c(0x22c)]));});}}),await _0x3d5ee2[_0x22772a(0x1b2)]();const _0x214cce=await warehouse[_0x22772a(0x1a2)]({'name':_0x641846['to_warehouse'],'room':_0x641846[_0x22772a(0x1bb)]});_0x641846[_0x22772a(0x1cc)][_0x22772a(0x1c9)](_0x427642=>{var _0x3f4a4e=_0x22772a;if(_0x427642['to_quantity']>0x0){const _0x4b7420=_0x214cce[_0x3f4a4e(0x19e)][_0x3f4a4e(0x195)](_0x4da00c=>{var _0x23862b=_0x3f4a4e;_0x4da00c[_0x23862b(0x219)]==_0x427642[_0x23862b(0x219)]&&_0x4da00c['bay']==_0x427642[_0x23862b(0x1c4)]&&(_0x4da00c[_0x23862b(0x220)]=parseInt(_0x4da00c[_0x23862b(0x220)])-parseInt(_0x427642[_0x23862b(0x22c)]));});}}),await _0x214cce[_0x22772a(0x1b2)](),_0x641846[_0x22772a(0x1f4)]=_0x394c78,_0x641846[_0x22772a(0x159)]=_0x461192,_0x641846[_0x22772a(0x1fe)]=_0x4a2fd2,_0x641846[_0x22772a(0x1cc)]=_0x34fbc9,_0x641846['note']=_0x203afa,_0x641846[_0x22772a(0x1cb)]=_0x566e3d;const _0x5c3636=await _0x641846[_0x22772a(0x1b2)](),_0x35b2d8=await warehouse[_0x22772a(0x1a2)]({'name':_0x461192,'room':_0x8cb423});_0x5c3636[_0x22772a(0x1cc)][_0x22772a(0x1c9)](_0x3be75c=>{var _0x1bb057=_0x22772a;if(_0x3be75c[_0x1bb057(0x22c)]>0x0){const _0x4db78f=_0x35b2d8['product_details'][_0x1bb057(0x195)](_0x39e37d=>{var _0x384111=_0x1bb057;_0x39e37d[_0x384111(0x219)]==_0x3be75c[_0x384111(0x219)]&&_0x39e37d[_0x384111(0x1f3)]==_0x3be75c[_0x384111(0x20e)]&&(_0x39e37d[_0x384111(0x220)]=parseInt(_0x39e37d[_0x384111(0x220)])-parseInt(_0x3be75c[_0x384111(0x22c)]));});}}),await _0x35b2d8[_0x22772a(0x1b2)]();const _0x36bd99=await warehouse['findOne']({'name':_0x4a2fd2,'room':_0x341730});_0x5c3636[_0x22772a(0x1cc)][_0x22772a(0x1c9)](_0x457585=>{var _0x3da676=_0x22772a;if(_0x457585[_0x3da676(0x22c)]>0x0){var _0x3265c7=0x0;const _0x230926=_0x36bd99[_0x3da676(0x19e)][_0x3da676(0x195)](_0x1f68e8=>{var _0x4ab201=_0x3da676;_0x1f68e8[_0x4ab201(0x219)]==_0x457585[_0x4ab201(0x219)]&&_0x1f68e8[_0x4ab201(0x1f3)]==_0x457585['to_bay']&&(_0x1f68e8['product_stock']=parseInt(_0x1f68e8[_0x4ab201(0x220)])+parseInt(_0x457585[_0x4ab201(0x22c)]),_0x3265c7++);});_0x3265c7=='0'&&(_0x36bd99[_0x3da676(0x19e)]=_0x36bd99[_0x3da676(0x19e)]['concat']({'product_name':_0x457585[_0x3da676(0x219)],'product_stock':_0x457585[_0x3da676(0x22c)],'bay':_0x457585[_0x3da676(0x1c4)],'product_code':_0x457585[_0x3da676(0x1da)],'primary_code':_0x457585['primary_code'],'secondary_code':_0x457585[_0x3da676(0x1d5)],'maxProducts':_0x457585[_0x3da676(0x17c)]}));}}),await _0x36bd99['save'](),_0x310647[_0x22772a(0x18b)](_0x22772a(0x1ec),_0x22772a(0x1b9)),_0x2b33df[_0x22772a(0x213)](_0x22772a(0x15a));}catch(_0x53ee85){console[_0x22772a(0x20d)](_0x53ee85);}}),router[a0_0x17acd9(0x188)](a0_0x17acd9(0x212),async(_0x400652,_0x1dcf02)=>{var _0xa5a30f=a0_0x17acd9;const {FromWareHouse:_0x144bf8,FromRoom:_0x36c20f,ToWarehouse:_0x4fa7c1,ToRoom:_0x121bdd,primary_code:_0xe6cf8a,Roomslist:_0x185f2e}=_0x400652[_0xa5a30f(0x221)],_0x3c3fa5=_0x185f2e[_0xa5a30f(0x1e8)](','),_0x1f987c=[];async function _0x436f3e(_0x40b7cc){var _0xfb2f35=_0xa5a30f;const _0x40e379=await warehouse[_0xfb2f35(0x1f5)]([{'$match':{'name':_0x144bf8,'room':_0x40b7cc}},{'$unwind':_0xfb2f35(0x1f0)},{'$match':{'product_details.primary_code':_0xe6cf8a}},{'$group':{'_id':_0xfb2f35(0x18f),'name':{'$first':_0xfb2f35(0x21a)},'instock':{'$first':_0xfb2f35(0x17e)},'primary_code':{'$first':_0xfb2f35(0x166)},'secondary_code':{'$first':_0xfb2f35(0x226)},'product_code':{'$first':_0xfb2f35(0x1ed)},'level':{'$first':_0xfb2f35(0x178)},'isle':{'$first':_0xfb2f35(0x198)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xfb2f35(0x1e5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xfb2f35(0x1a4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xfb2f35(0x1d9)},'expiry_date':{'$first':_0xfb2f35(0x1f2)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0xfb2f35(0x1b6)},'roomNamed':{'$first':_0xfb2f35(0x1c5)},'prod_cat':{'$first':'P'},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2d9daf=await warehouse['aggregate']([{'$match':{'name':_0x144bf8,'room':_0x40b7cc}},{'$unwind':_0xfb2f35(0x1f0)},{'$match':{'product_details.secondary_code':_0xe6cf8a}},{'$group':{'_id':_0xfb2f35(0x18f),'name':{'$first':_0xfb2f35(0x21a)},'instock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xfb2f35(0x178)},'isle':{'$first':_0xfb2f35(0x198)},'type':{'$first':_0xfb2f35(0x1ae)},'pallet':{'$first':_0xfb2f35(0x1e5)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xfb2f35(0x1a4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xfb2f35(0x1f2)},'production_date':{'$first':_0xfb2f35(0x1e7)},'batch_code':{'$first':_0xfb2f35(0x20c)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0xfb2f35(0x1c5)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0xfb2f35(0x165)}}}]);if(_0x40e379[_0xfb2f35(0x156)]>0x0)_0x1f987c[_0xfb2f35(0x197)](_0x40e379);else _0x2d9daf[_0xfb2f35(0x156)]>0x0&&_0x1f987c[_0xfb2f35(0x197)](_0x2d9daf);}const _0x36cb5f=_0x3c3fa5[_0xa5a30f(0x195)](_0x5ec3be=>_0x436f3e(_0x5ec3be));await Promise[_0xa5a30f(0x210)](_0x36cb5f),_0x1dcf02[_0xa5a30f(0x173)](_0x1f987c);}),router['post']('/barcode_scanner2',async(_0x3104aa,_0x2a6cd5)=>{var _0x31c9cc=a0_0x17acd9;try{const {FromWareHouse:_0xfac1e,FromRoom:_0x129bfa,ToWarehouse:_0x51842d,ToRoom:_0x759c4f,secondary_code:_0x3642e4}=_0x3104aa[_0x31c9cc(0x221)],_0x1e5b3f=await warehouse[_0x31c9cc(0x1f5)]([{'$match':{'name':_0xfac1e}},{'$unwind':_0x31c9cc(0x1f0)},{'$match':{'product_details.secondary_code':_0x3642e4}},{'$group':{'_id':_0x31c9cc(0x18f),'name':{'$first':_0x31c9cc(0x21a)},'primary_code':{'$first':_0x31c9cc(0x166)},'secondary_code':{'$first':_0x31c9cc(0x226)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x31c9cc(0x17e)},'warehouse':{'$first':_0x31c9cc(0x1ce)},'level':{'$first':_0x31c9cc(0x16a)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x31c9cc(0x1d3)},'maxProducts':{'$first':_0x31c9cc(0x1d4)},'unit':{'$first':_0x31c9cc(0x208)},'expiry_date':{'$first':_0x31c9cc(0x1f2)},'production_date':{'$first':_0x31c9cc(0x1e7)}}}]);_0x2a6cd5[_0x31c9cc(0x1d7)](0xc8)[_0x31c9cc(0x173)](_0x1e5b3f);}catch(_0x1560e9){_0x2a6cd5[_0x31c9cc(0x1d7)](0x194)[_0x31c9cc(0x173)]({'message':_0x1560e9[_0x31c9cc(0x20f)]});}}),router[a0_0x17acd9(0x188)]('/barcode_scanner3',async(_0x3b2fc1,_0x33de49)=>{var _0x38b664=a0_0x17acd9;try{const {FromWareHouse:_0x2a357c,FromRoom:_0x13fc7d,ToWarehouse:_0x5a8955,ToRoom:_0x1931bd,product_code:_0x37b368}=_0x3b2fc1[_0x38b664(0x221)],_0x134c56=await warehouse[_0x38b664(0x1f5)]([{'$match':{'name':_0x2a357c}},{'$unwind':_0x38b664(0x1f0)},{'$match':{'product_details.product_code':_0x37b368}},{'$group':{'_id':_0x38b664(0x18f),'name':{'$first':_0x38b664(0x21a)},'primary_code':{'$first':_0x38b664(0x166)},'secondary_code':{'$first':_0x38b664(0x226)},'product_code':{'$first':_0x38b664(0x1ed)},'instock':{'$first':_0x38b664(0x17e)},'warehouse':{'$first':_0x38b664(0x1ce)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x38b664(0x1d3)},'maxProducts':{'$first':_0x38b664(0x1d4)},'unit':{'$first':'$product_details.unit'}}}]);_0x33de49['status'](0xc8)[_0x38b664(0x173)](_0x134c56);}catch(_0x5ee08f){_0x33de49[_0x38b664(0x1d7)](0x194)[_0x38b664(0x173)]({'message':_0x5ee08f[_0x38b664(0x20f)]});}}),router[a0_0x17acd9(0x188)](a0_0x17acd9(0x191),async(_0x55247,_0x5a859a)=>{var _0x4687d9=a0_0x17acd9;const {productCode:_0x4e0184,bay:_0x4c4e84,warehouses:_0x46cc87,room:_0xc97687}=_0x55247[_0x4687d9(0x221)];console['log'](_0x55247[_0x4687d9(0x221)]);try{const _0x134094=await warehouse[_0x4687d9(0x1f5)]([{'$match':{'name':_0x46cc87,'room':_0xc97687}},{'$unwind':_0x4687d9(0x1f0)},{'$match':{'product_details.bay':parseInt(_0x4c4e84)}},{'$group':{'_id':_0x4687d9(0x18f),'name':{'$first':_0x4687d9(0x21a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4687d9(0x178)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x5a859a[_0x4687d9(0x1d7)](0xc8)['json'](_0x134094);}catch(_0xe20f98){_0x5a859a[_0x4687d9(0x1d7)](0x194)[_0x4687d9(0x173)]({'message':_0xe20f98[_0x4687d9(0x20f)]});}}),module[a0_0x17acd9(0x1dd)]=router;