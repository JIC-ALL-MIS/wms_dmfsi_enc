var a0_0x5989aa=a0_0x5de2;(function(_0x28f4d6,_0x4f3f9b){var _0x33834e=a0_0x5de2,_0x42c7bd=_0x28f4d6();while(!![]){try{var _0x207e22=parseInt(_0x33834e(0x2c9))/0x1+parseInt(_0x33834e(0x2b0))/0x2+parseInt(_0x33834e(0x27d))/0x3+-parseInt(_0x33834e(0x231))/0x4+-parseInt(_0x33834e(0x219))/0x5+-parseInt(_0x33834e(0x249))/0x6+parseInt(_0x33834e(0x22e))/0x7*(parseInt(_0x33834e(0x214))/0x8);if(_0x207e22===_0x4f3f9b)break;else _0x42c7bd['push'](_0x42c7bd['shift']());}catch(_0x1c2d1c){_0x42c7bd['push'](_0x42c7bd['shift']());}}}(a0_0x2bc8,0x968d2));const express=require(a0_0x5989aa(0x23d)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,sales,sales_return,suppliers_payment,customer_payment,transfers,transfers_finished,email_settings,supervisor_settings}=require(a0_0x5989aa(0x238)),auth=require('../middleware/auth'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x5989aa(0x1fc));router[a0_0x5989aa(0x2be)]('/view',auth,async(_0x156f15,_0x55a59f)=>{var _0x137ad1=a0_0x5989aa;try{const {username:_0x1e0c2b,email:_0x438cec,role:_0x564ef3}=_0x156f15['user'],_0x57de98=_0x156f15[_0x137ad1(0x23c)],_0x2d0794=await profile[_0x137ad1(0x259)]({'email':_0x57de98[_0x137ad1(0x239)]}),_0x3b40a3=await master_shop['find']();let _0x57d375;if(_0x57de98['role']==_0x137ad1(0x267)){const _0x3053a9=await staff[_0x137ad1(0x259)]({'email':_0x57de98[_0x137ad1(0x239)]});_0x57d375=await transfers_finished[_0x137ad1(0x25f)]({'from_warehouse':_0x3053a9['warehouse']});}else _0x57d375=await transfers_finished['aggregate']([{'$unwind':_0x137ad1(0x203)},{'$group':{'_id':'$_id','invoice':{'$first':_0x137ad1(0x252)},'date':{'$first':_0x137ad1(0x225)},'from_warehouse':{'$first':'$from_warehouse'},'to_warehouse':{'$first':'$to_warehouse'},'from_room_name':{'$addToSet':_0x137ad1(0x2ce)},'to_room_name':{'$addToSet':_0x137ad1(0x26d)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'date':0x1,'from_warehouse':0x1,'to_warehouse':0x1,'from_room_name':0x1,'to_room_name':0x1,'finalize':0x1}}]);if(_0x3b40a3[0x0][_0x137ad1(0x28c)]=='English\x20(US)')var _0x2b58d=users['English'];else{if(_0x3b40a3[0x0][_0x137ad1(0x28c)]=='Hindi')var _0x2b58d=users['Hindi'];else{if(_0x3b40a3[0x0][_0x137ad1(0x28c)]==_0x137ad1(0x2cd))var _0x2b58d=users[_0x137ad1(0x2cd)];else{if(_0x3b40a3[0x0]['language']==_0x137ad1(0x2b2))var _0x2b58d=users['Spanish'];else{if(_0x3b40a3[0x0][_0x137ad1(0x28c)]==_0x137ad1(0x2bf))var _0x2b58d=users[_0x137ad1(0x2bf)];else{if(_0x3b40a3[0x0]['language']==_0x137ad1(0x253))var _0x2b58d=users[_0x137ad1(0x261)];else{if(_0x3b40a3[0x0][_0x137ad1(0x28c)]=='Chinese')var _0x2b58d=users[_0x137ad1(0x246)];else{if(_0x3b40a3[0x0]['language']==_0x137ad1(0x221))var _0x2b58d=users['Arabic'];}}}}}}}_0x55a59f[_0x137ad1(0x289)]('transfer_finished',{'success':_0x156f15[_0x137ad1(0x2a7)]('success'),'errors':_0x156f15[_0x137ad1(0x2a7)](_0x137ad1(0x218)),'role':_0x57de98,'profile':_0x2d0794,'master_shop':_0x3b40a3,'transfer':_0x57d375,'language':_0x2b58d});}catch(_0x4ab69b){console['log'](_0x4ab69b);}});function a0_0x2bc8(){var _0x48bc11=['QA\x20Warehouse','$product_details.storage','$product_details.rack','1157803XdFDZE','bay','finalize','</h5>','German','$product.from_room_name','image','DRY\x20GOODS','$product_details.expiry_date','product_code3','host','filter','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','aggregate','string','$product_details.floorlevel','note','nodemailer','Hindi','product_name','from_room_name','<!DOCTYPE\x20html>','$product_details.type','/transfer/view','$product','role','New_Qty_Converted','length','Transfer\x20Finalize\x20Successfully','success','to_prod_level','catch','</td>','</div>','Transfer\x20Mail','abs','$product_details.secondary_unit','invoice','/barcode_scanner2','An\x20error\x20occurred.','$product_details.unit','344inNerg','id_transaction','expiry_date','/transfer_finished/view','errors','272110AzPHMQ','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.batch_code','warehouse','$product_details.pallet','$product_details','Product\x20Transfer\x20successfully','Arabic\x20(ae)','Must\x20not\x20be\x20greater\x20than\x20stock\x20Qty','status','here2','$date','message','json','/barcode_scanner','To_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','to_quantity','forEach','post','89957XGiRoQ','unit','product','1938028qyCAmg','primary_unit','to_invoice','<html><head><title></title>','edit_transfer_finished_view','Transfer\x20Edit\x20Successfully','$product_details.bin','../models/all_models','email','Error\x20Occurs','product_details','user','express','to_bay','then','<tbody\x20style=\x22text-align:\x20center;\x22>','push','from_bay','$product_details.product_code','/view/:id','\x20<=>\x20','Chinese','ToRoomAssigned','here1','6247776znVRBX','$name','site_title','product_code','$product_details.product_stock','<h2>\x20','$product_details.level','production_date','exports','$invoice','Portuguese\x20(BR)','/../public','from_invoice','<h5>','getMonth','to_prod_qty','findOne','<hr\x20class=\x22my-3\x22>','logo','</tr>','/picking_list/PDF_transfer/','/barcode_scanner3','find','Finished\x20Goods','Portuguese','</body></html>','prod_cat','$product_details.primary_code','TRFF-','$product_details._id','staff','to_floorlevel','English','to_warehouse','Ambient','secondary_unit','$product.to_room_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','English\x20(US)','<div>','</tbody>','To\x20An\x20error\x20occurred\x20while\x20saving\x20data.','from_quantity','$product_details.secondary_code','from_prod_level','$product_details.invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.bay','from_warehouse','password','port','map','1271616SbapzK','concat','MaxStocks_data2','findById','createTransport','MaxStocks_data','/upload/','</span>','getFullYear','slice','secondary_code','$product_details.product_name','render','body','max','language','Logo.png','padStart','random','\x20Order\x20Date\x20:\x20','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20<>\x20','$product_details.maxPerUnit','edit_transfer_finished','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_date','</head><body>','True','Rack\x202','save','<tr>','Enabled','primary_code','$product_details.production_date','undefined','</table>','add_transfer_finished','RoomAssigned','all','toString','prod_name','params','flash','Rack\x201','to_room_name','from_prod_qty','Enclosed','</thead>','log','product_stock','$product_details.isle','125230VZYNgS','FROZEN\x20GOODS','Spanish','_id','batch_code','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/preview/:id','from_room','to_room','error','maxPerUnit','<h5\x20style=\x22text-align:\x20left;\x22>','updateOne','get','French','$room','maxProducts','date','Arabic','transfer_data','redirect'];a0_0x2bc8=function(){return _0x48bc11;};return a0_0x2bc8();}function a0_0x5de2(_0x3c3c26,_0x2f2f98){var _0x2bc888=a0_0x2bc8();return a0_0x5de2=function(_0x5de2c4,_0x3cb334){_0x5de2c4=_0x5de2c4-0x1f4;var _0x44c299=_0x2bc888[_0x5de2c4];return _0x44c299;},a0_0x5de2(_0x3c3c26,_0x2f2f98);}async function getRandom8DigitNumber(){var _0xf6426c=a0_0x5989aa;const _0x19ff04=0x989680,_0x97e7=0x5f5e0ff,_0xfd60f0=Math[_0xf6426c(0x21a)](Math[_0xf6426c(0x28f)]()*(_0x97e7-_0x19ff04+0x1))+_0x19ff04;var _0x266632;const _0x47ae2b=await transfers_finished[_0xf6426c(0x259)]({'invoice':'TRFF-'+_0xfd60f0});return _0x47ae2b&&_0x47ae2b['length']>0x0?_0x266632=_0xf6426c(0x265)+_0xfd60f0:_0x266632=_0xf6426c(0x265)+_0xfd60f0,_0x266632;}router[a0_0x5989aa(0x2be)]('/view/add_transfer',auth,async(_0x2bd467,_0x46f582)=>{var _0x42a850=a0_0x5989aa;try{const {username:_0x440ca2,email:_0x4af3c8,role:_0x2aa091}=_0x2bd467[_0x42a850(0x23c)],_0xb59018=_0x2bd467[_0x42a850(0x23c)],_0x44c5d7=await profile['findOne']({'email':_0xb59018[_0x42a850(0x239)]}),_0x4626a3=await master_shop[_0x42a850(0x25f)]();let _0x39406e;if(_0xb59018[_0x42a850(0x204)]==_0x42a850(0x267)){const _0x356e83=await staff[_0x42a850(0x259)]({'email':_0xb59018[_0x42a850(0x239)]});_0x39406e=await warehouse[_0x42a850(0x1f8)]([{'$match':{'status':_0x42a850(0x29c),'name':_0x356e83[_0x42a850(0x21d)],'warehouse_category':_0x42a850(0x260),'name':{'$ne':_0x42a850(0x2c6)}}},{'$group':{'_id':_0x42a850(0x24a),'name':{'$first':'$name'}}}]);}else _0x39406e=await warehouse[_0x42a850(0x1f8)]([{'$match':{'status':_0x42a850(0x29c),'warehouse_category':_0x42a850(0x260),'name':{'$ne':_0x42a850(0x2c6)}}},{'$group':{'_id':_0x42a850(0x24a),'name':{'$first':_0x42a850(0x24a)}}}]);const _0x2361a9=await transfers_finished['find']({}),_0xc19141=_0x2361a9[_0x42a850(0x206)]+0x1,_0x5ec743=_0x42a850(0x265)+_0xc19141[_0x42a850(0x2a4)]()[_0x42a850(0x28e)](0x5,'0');if(_0x4626a3[0x0][_0x42a850(0x28c)]==_0x42a850(0x26f))var _0x13c776=users[_0x42a850(0x269)];else{if(_0x4626a3[0x0][_0x42a850(0x28c)]==_0x42a850(0x1fd))var _0x13c776=users[_0x42a850(0x1fd)];else{if(_0x4626a3[0x0][_0x42a850(0x28c)]==_0x42a850(0x2cd))var _0x13c776=users[_0x42a850(0x2cd)];else{if(_0x4626a3[0x0]['language']==_0x42a850(0x2b2))var _0x13c776=users[_0x42a850(0x2b2)];else{if(_0x4626a3[0x0][_0x42a850(0x28c)]==_0x42a850(0x2bf))var _0x13c776=users[_0x42a850(0x2bf)];else{if(_0x4626a3[0x0][_0x42a850(0x28c)]==_0x42a850(0x253))var _0x13c776=users['Portuguese'];else{if(_0x4626a3[0x0][_0x42a850(0x28c)]==_0x42a850(0x246))var _0x13c776=users[_0x42a850(0x246)];else{if(_0x4626a3[0x0][_0x42a850(0x28c)]=='Arabic\x20(ae)')var _0x13c776=users[_0x42a850(0x2c3)];}}}}}}}const _0x5754af=getRandom8DigitNumber();_0x5754af[_0x42a850(0x23f)](_0xdce15f=>{var _0x185ba7=_0x42a850;_0x46f582[_0x185ba7(0x289)](_0x185ba7(0x2a1),{'success':_0x2bd467['flash']('success'),'errors':_0x2bd467[_0x185ba7(0x2a7)](_0x185ba7(0x218)),'role':_0xb59018,'profile':_0x44c5d7,'master_shop':_0x4626a3,'warehouse':_0x39406e,'language':_0x13c776,'invoice':_0xdce15f});})[_0x42a850(0x20a)](_0x15864c=>{var _0x49d16a=_0x42a850;_0x2bd467[_0x49d16a(0x2a7)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x46f582[_0x49d16a(0x2c5)](_0x49d16a(0x202));});}catch(_0x4873d5){console[_0x42a850(0x2ad)](_0x4873d5);}}),router[a0_0x5989aa(0x22d)]('/view/add_transfer',auth,async(_0x1f35fe,_0x429436)=>{var _0x1abcd1=a0_0x5989aa;try{const {date:_0x2a4605,from_warehouse:_0x542235,FromRoom_name:_0xfc54ca,to_warehouse:_0x360525,ToRoom_name:_0x227399,prod_name:_0x3be6d7,from_prod_qty:_0x116a95,from_prod_level:_0x54118d,from_prod_isle:_0x1fac37,from_prod_pallet:_0x58d1dc,to_prod_qty:_0xe36f08,to_prod_level:_0x144f13,to_prod_isle:_0x5bdf22,to_prod_pallet:_0x324a6d,primary_code:_0x871ac1,secondary_code:_0x569a91,product_code3:_0x4740f4,note:_0x100297,MaxStocks_data2:_0x2c7591,invoice:_0x4c63e9,expiry_date:_0xaec196}=_0x1f35fe[_0x1abcd1(0x28a)];if(typeof _0x3be6d7==_0x1abcd1(0x1f9))var _0x23599f=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2a5)]],_0x2355aa=[_0x1f35fe['body'][_0x1abcd1(0x2aa)]],_0x35cf99=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x275)]],_0x535327=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x205)]],_0x5fcc5=[_0x1f35fe['body']['to_prod_level']],_0x214d7a=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x29d)]],_0x4a80dc=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x287)]],_0x54c521=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2d2)]],_0x158f17=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x27f)]],_0x5841f6=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x232)]],_0x25e9fe=[_0x1f35fe['body']['secondary_unit']],_0x7dfdca=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2b4)]],_0xbcfd22=[_0x1f35fe['body'][_0x1abcd1(0x216)]],_0x8cc2e=[_0x1f35fe[_0x1abcd1(0x28a)]['product_date']],_0x3ee503=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x282)]],_0x1711fe=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2bb)]],_0x40388a=[_0x1f35fe['body'][_0x1abcd1(0x263)]],_0xee8a8d=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2a2)]],_0x513e0d=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x247)]],_0x335407=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x255)]],_0xd76612=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x233)]],_0xb0c6a5=[_0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x215)]];else var _0x23599f=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2a5)]],_0x2355aa=[..._0x1f35fe['body'][_0x1abcd1(0x2aa)]],_0x35cf99=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x275)]],_0x535327=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x205)]],_0x5fcc5=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x209)]],_0x214d7a=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x29d)]],_0x4a80dc=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x287)]],_0x54c521=[..._0x1f35fe['body']['product_code3']],_0x158f17=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x27f)]],_0x5841f6=[..._0x1f35fe[_0x1abcd1(0x28a)]['primary_unit']],_0x25e9fe=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x26c)]],_0x7dfdca=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x2b4)]],_0xbcfd22=[..._0x1f35fe[_0x1abcd1(0x28a)]['expiry_date']],_0x8cc2e=[..._0x1f35fe['body'][_0x1abcd1(0x296)]],_0x3ee503=[..._0x1f35fe['body'][_0x1abcd1(0x282)]],_0x1711fe=[..._0x1f35fe['body'][_0x1abcd1(0x2bb)]],_0x40388a=[..._0x1f35fe[_0x1abcd1(0x28a)][_0x1abcd1(0x263)]],_0xee8a8d=[..._0x1f35fe['body'][_0x1abcd1(0x2a2)]],_0x513e0d=[..._0x1f35fe['body'][_0x1abcd1(0x247)]],_0x335407=[..._0x1f35fe[_0x1abcd1(0x28a)]['from_invoice']],_0xd76612=[..._0x1f35fe['body'][_0x1abcd1(0x233)]],_0xb0c6a5=[..._0x1f35fe[_0x1abcd1(0x28a)]['id_transaction']];const _0x3ace90=_0x23599f[_0x1abcd1(0x27c)](_0x17e02a=>{return _0x17e02a={'product_name':_0x17e02a};});_0x2355aa[_0x1abcd1(0x22c)]((_0x27ed12,_0x4cdb14)=>{var _0x25edc8=_0x1abcd1;_0x3ace90[_0x4cdb14][_0x25edc8(0x273)]=_0x27ed12;}),_0x35cf99[_0x1abcd1(0x22c)]((_0x40c8c8,_0xcebce6)=>{_0x3ace90[_0xcebce6]['from_bay']=_0x40c8c8;}),_0xb0c6a5[_0x1abcd1(0x22c)]((_0x41a656,_0x387a3e)=>{var _0x1f141c=_0x1abcd1;_0x3ace90[_0x387a3e][_0x1f141c(0x215)]=_0x41a656;}),_0x335407[_0x1abcd1(0x22c)]((_0x35496b,_0x286a46)=>{var _0x26baa6=_0x1abcd1;_0x3ace90[_0x286a46][_0x26baa6(0x255)]=_0x35496b;}),_0xd76612['forEach']((_0x5e5478,_0x4e3a48)=>{_0x3ace90[_0x4e3a48]['To_invoice']=_0x5e5478;}),_0x535327['forEach']((_0x3061fa,_0x4ab312)=>{_0x3ace90[_0x4ab312]['to_quantity']=_0x3061fa;}),_0x5fcc5['forEach']((_0x5682ef,_0x2ee296)=>{var _0x48c126=_0x1abcd1;_0x3ace90[_0x2ee296][_0x48c126(0x23e)]=_0x5682ef;}),_0x214d7a[_0x1abcd1(0x22c)]((_0x52bf6b,_0x1b58ff)=>{var _0x4523a7=_0x1abcd1;_0x3ace90[_0x1b58ff][_0x4523a7(0x29d)]=_0x52bf6b;}),_0x4a80dc[_0x1abcd1(0x22c)]((_0x3a8fec,_0x35eda9)=>{var _0x5e6cb9=_0x1abcd1;_0x3ace90[_0x35eda9][_0x5e6cb9(0x287)]=_0x3a8fec;}),_0x54c521[_0x1abcd1(0x22c)]((_0x24ff2b,_0x1872b8)=>{_0x3ace90[_0x1872b8]['product_code']=_0x24ff2b;}),_0x158f17[_0x1abcd1(0x22c)]((_0x56a455,_0x4c74c6)=>{var _0x4abc50=_0x1abcd1;_0x3ace90[_0x4c74c6][_0x4abc50(0x2c1)]=_0x56a455;}),_0x5841f6[_0x1abcd1(0x22c)]((_0x42a291,_0x378950)=>{_0x3ace90[_0x378950]['unit']=_0x42a291;}),_0x25e9fe['forEach']((_0x25268e,_0x2cacb4)=>{var _0xf0f9a6=_0x1abcd1;_0x3ace90[_0x2cacb4][_0xf0f9a6(0x26c)]=_0x25268e;}),_0x7dfdca['forEach']((_0x8bee3a,_0x43968d)=>{_0x3ace90[_0x43968d]['batch_code']=_0x8bee3a;}),_0xbcfd22[_0x1abcd1(0x22c)]((_0x3bd66b,_0x2b486d)=>{var _0x882321=_0x1abcd1;_0x3ace90[_0x2b486d][_0x882321(0x216)]=_0x3bd66b;}),_0x8cc2e[_0x1abcd1(0x22c)]((_0x34a4e7,_0x5a68b8)=>{var _0x217b0a=_0x1abcd1;_0x3ace90[_0x5a68b8][_0x217b0a(0x250)]=_0x34a4e7;}),_0x3ee503[_0x1abcd1(0x22c)]((_0x4a74ef,_0x29dcc1)=>{var _0x1bb7cf=_0x1abcd1;_0x3ace90[_0x29dcc1][_0x1bb7cf(0x2c1)]=_0x4a74ef;}),_0x1711fe[_0x1abcd1(0x22c)]((_0x2fe802,_0xa44da2)=>{var _0x4cfa15=_0x1abcd1;_0x3ace90[_0xa44da2][_0x4cfa15(0x2bb)]=_0x2fe802;}),_0x40388a[_0x1abcd1(0x22c)]((_0x1b00ce,_0x5aac9a)=>{var _0x37edcf=_0x1abcd1;_0x3ace90[_0x5aac9a][_0x37edcf(0x263)]=_0x1b00ce;}),_0xee8a8d[_0x1abcd1(0x22c)]((_0x20b5cc,_0x23c611)=>{var _0x3f83d0=_0x1abcd1;_0x3ace90[_0x23c611][_0x3f83d0(0x1ff)]=_0x20b5cc;}),_0x513e0d['forEach']((_0x47065e,_0x3dda28)=>{var _0x177a7f=_0x1abcd1;_0x3ace90[_0x3dda28][_0x177a7f(0x2a9)]=_0x47065e;});const _0x4cfeca=_0x3ace90[_0x1abcd1(0x1f5)](_0x37e273=>_0x37e273[_0x1abcd1(0x22b)]!=='0'&&_0x37e273[_0x1abcd1(0x22b)]!==''||_0x37e273[_0x1abcd1(0x268)]!=='0'&&_0x37e273[_0x1abcd1(0x268)]!=='');var _0x3d65e2=0x0;_0x4cfeca[_0x1abcd1(0x22c)](_0x16c156=>{var _0x47380f=_0x1abcd1;parseInt(_0x16c156[_0x47380f(0x273)])<parseInt(_0x16c156[_0x47380f(0x22b)])&&_0x3d65e2++;});if(_0x3d65e2!=0x0)return _0x1f35fe[_0x1abcd1(0x2a7)](_0x1abcd1(0x218),_0x1abcd1(0x222)),_0x429436[_0x1abcd1(0x2c5)]('back');const _0x3a9c7b=new transfers_finished({'date':_0x2a4605,'from_warehouse':_0x542235,'to_warehouse':_0x360525,'product':_0x4cfeca,'note':_0x100297,'invoice':_0x4c63e9}),_0x3ab22f=await _0x3a9c7b[_0x1abcd1(0x29a)]();_0x1f35fe[_0x1abcd1(0x2a7)](_0x1abcd1(0x208),_0x1abcd1(0x220)),_0x429436[_0x1abcd1(0x2c5)]('/transfer_finished/preview/'+_0x3ab22f[_0x1abcd1(0x2b3)]);}catch(_0x59cebf){console[_0x1abcd1(0x2ad)](_0x59cebf),_0x429436['status'](0xc8)[_0x1abcd1(0x227)]({'errorMessage':_0x59cebf['message']});}}),router[a0_0x5989aa(0x2be)](a0_0x5989aa(0x2b7),auth,async(_0x22966c,_0x2296cf)=>{var _0x4cfbca=a0_0x5989aa;try{const {username:_0x3f0ec5,email:_0x249dcc,role:_0x41d9a3}=_0x22966c['user'],_0x246ac4=_0x22966c['user'],_0x5ad2d3=await profile[_0x4cfbca(0x259)]({'email':_0x246ac4[_0x4cfbca(0x239)]}),_0x1f0dee=await master_shop[_0x4cfbca(0x25f)](),_0x1039cc=await transfers_finished[_0x4cfbca(0x280)](_0x22966c[_0x4cfbca(0x2a6)]['id']);let _0x15db99;if(_0x246ac4[_0x4cfbca(0x204)]==_0x4cfbca(0x267)){const _0x4268d5=await staff[_0x4cfbca(0x259)]({'email':_0x246ac4[_0x4cfbca(0x239)]});_0x15db99=await warehouse[_0x4cfbca(0x25f)]({'status':_0x4cfbca(0x29c),'name':_0x4268d5[_0x4cfbca(0x21d)],'warehouse_category':_0x4cfbca(0x260)});}else _0x15db99=await warehouse[_0x4cfbca(0x25f)]({'status':_0x4cfbca(0x29c),'warehouse_category':_0x4cfbca(0x260)});const _0x3d36a0=await warehouse['aggregate']([{'$match':{'name':_0x1039cc['from_warehouse'],'warehouse_category':_0x4cfbca(0x260)}},{'$unwind':_0x4cfbca(0x21f)},{'$group':{'_id':_0x4cfbca(0x266),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4cfbca(0x24d)},'bay':{'$first':_0x4cfbca(0x278)},'bin':{'$first':_0x4cfbca(0x237)},'type':{'$first':_0x4cfbca(0x201)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4cfbca(0x264)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4cfbca(0x243)},'storage':{'$first':_0x4cfbca(0x2c7)},'rack':{'$first':_0x4cfbca(0x2c8)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'room':{'$first':_0x4cfbca(0x2c0)},'warehoue_name':{'$first':_0x4cfbca(0x24a)}}}]),_0x2ddd80=await product[_0x4cfbca(0x25f)]({});if(_0x1f0dee[0x0]['language']=='English\x20(US)'){var _0x2a6086=users[_0x4cfbca(0x269)];console['log'](_0x2a6086);}else{if(_0x1f0dee[0x0][_0x4cfbca(0x28c)]=='Hindi')var _0x2a6086=users[_0x4cfbca(0x1fd)];else{if(_0x1f0dee[0x0][_0x4cfbca(0x28c)]=='German')var _0x2a6086=users[_0x4cfbca(0x2cd)];else{if(_0x1f0dee[0x0][_0x4cfbca(0x28c)]=='Spanish')var _0x2a6086=users['Spanish'];else{if(_0x1f0dee[0x0]['language']==_0x4cfbca(0x2bf))var _0x2a6086=users[_0x4cfbca(0x2bf)];else{if(_0x1f0dee[0x0][_0x4cfbca(0x28c)]==_0x4cfbca(0x253))var _0x2a6086=users[_0x4cfbca(0x261)];else{if(_0x1f0dee[0x0][_0x4cfbca(0x28c)]==_0x4cfbca(0x246))var _0x2a6086=users[_0x4cfbca(0x246)];else{if(_0x1f0dee[0x0][_0x4cfbca(0x28c)]==_0x4cfbca(0x221))var _0x2a6086=users['Arabic'];}}}}}}}_0x2296cf[_0x4cfbca(0x289)](_0x4cfbca(0x235),{'success':_0x22966c[_0x4cfbca(0x2a7)](_0x4cfbca(0x208)),'errors':_0x22966c[_0x4cfbca(0x2a7)](_0x4cfbca(0x218)),'role':_0x246ac4,'profile':_0x5ad2d3,'master_shop':_0x1f0dee,'warehouse':_0x15db99,'transfer':_0x1039cc,'stock':_0x3d36a0,'unit':_0x2ddd80,'language':_0x2a6086});}catch(_0x452712){console[_0x4cfbca(0x2ad)](_0x452712);}}),router[a0_0x5989aa(0x22d)]('/preview/:id',auth,async(_0x14143b,_0x1338cb)=>{var _0x58dc2c=a0_0x5989aa;try{const {invoice:_0x1fcf03,from_warehouse:_0x4e6f5a,FromRoom_name:_0x37e8e7,to_warehouse:_0xc4c0e5,ToRoom_name:_0x125967}=_0x14143b[_0x58dc2c(0x28a)],_0x2a1547=await transfers_finished[_0x58dc2c(0x280)](_0x14143b[_0x58dc2c(0x2a6)]['id']),_0x41db25=_0x2a1547['product'][_0x58dc2c(0x27c)](async _0xc29e34=>{var _0x333a04=_0x58dc2c;if(_0xc29e34[_0x333a04(0x22b)]>0x0){var _0x441a53=await warehouse[_0x333a04(0x259)]({'name':_0x4e6f5a,'room':_0xc29e34[_0x333a04(0x1ff)],'warehouse_category':_0x333a04(0x260)});const _0x529b5a=_0x441a53[_0x333a04(0x23b)][_0x333a04(0x27c)](_0x58d0d4=>{var _0x2a122e=_0x333a04;_0x58d0d4[_0x2a122e(0x1fe)]==_0xc29e34[_0x2a122e(0x1fe)]&&_0x58d0d4[_0x2a122e(0x2ca)]==_0xc29e34[_0x2a122e(0x242)]&&_0x58d0d4[_0x2a122e(0x216)]==_0xc29e34[_0x2a122e(0x216)]&&_0x58d0d4[_0x2a122e(0x250)]==_0xc29e34['production_date']&&_0x58d0d4[_0x2a122e(0x2b4)]==_0xc29e34[_0x2a122e(0x2b4)]&&_0x58d0d4[_0x2a122e(0x210)]==_0xc29e34['from_invoice']&&(console['log'](_0x2a122e(0x248),_0x58d0d4['product_stock']),typeof _0xc29e34[_0x2a122e(0x215)]==_0x2a122e(0x29f)?_0x58d0d4[_0x2a122e(0x2ae)]=Math[_0x2a122e(0x28b)](0x0,Math[_0x2a122e(0x20e)](_0x58d0d4[_0x2a122e(0x2ae)])-Math[_0x2a122e(0x20e)](_0xc29e34[_0x2a122e(0x22b)])):_0x58d0d4[_0x2a122e(0x2ae)]=Math[_0x2a122e(0x28b)](0x0,Math['abs'](_0x58d0d4['product_stock'])-Math[_0x2a122e(0x20e)](_0xc29e34[_0x2a122e(0x22b)])));});}return _0x441a53;});Promise[_0x58dc2c(0x2a3)](_0x41db25)[_0x58dc2c(0x23f)](async _0x375ffe=>{var _0x5a3437=_0x58dc2c;try{for(const _0x48ee86 of _0x375ffe){await _0x48ee86['save']();}const _0x290d85=_0x2a1547[_0x5a3437(0x230)][_0x5a3437(0x27c)](async _0x511e56=>{var _0x46c45c=_0x5a3437,_0x113dd5=await warehouse[_0x46c45c(0x259)]({'name':_0xc4c0e5,'room':_0x511e56[_0x46c45c(0x2a9)]});if(_0x511e56['to_quantity']>0x0){var _0x5c99dc=0x0;const _0x1daf8a=_0x113dd5['product_details'][_0x46c45c(0x27c)](_0x370950=>{var _0x504d96=_0x46c45c;_0x370950[_0x504d96(0x1fe)]==_0x511e56[_0x504d96(0x1fe)]&&_0x370950['bay']==_0x511e56['to_bay']&&_0x370950['expiry_date']==_0x511e56[_0x504d96(0x216)]&&_0x370950['production_date']==_0x511e56[_0x504d96(0x250)]&&_0x370950[_0x504d96(0x2b4)]==_0x511e56['batch_code']&&_0x370950[_0x504d96(0x210)]==_0x511e56[_0x504d96(0x229)]&&(typeof _0x511e56[_0x504d96(0x215)]==_0x504d96(0x29f)?(console[_0x504d96(0x2ad)](_0x504d96(0x224),_0x370950['product_stock']+_0x504d96(0x292)+_0x370950[_0x504d96(0x2b3)]+_0x504d96(0x245)+Math[_0x504d96(0x20e)](_0x370950[_0x504d96(0x2ae)])+Math[_0x504d96(0x20e)](_0x511e56[_0x504d96(0x22b)])),_0x370950[_0x504d96(0x2ae)]=Math['abs'](_0x370950[_0x504d96(0x2ae)])+Math[_0x504d96(0x20e)](_0x511e56[_0x504d96(0x22b)])):_0x370950['product_stock']=Math[_0x504d96(0x20e)](_0x370950[_0x504d96(0x2ae)])+Math[_0x504d96(0x20e)](_0x511e56[_0x504d96(0x22b)]),_0x5c99dc++);});_0x5c99dc=='0'&&(_0x113dd5['product_details']=_0x113dd5[_0x46c45c(0x23b)][_0x46c45c(0x27e)]({'product_name':_0x511e56[_0x46c45c(0x1fe)],'product_stock':_0x511e56['to_quantity'],'bay':_0x511e56[_0x46c45c(0x23e)],'product_code':_0x511e56[_0x46c45c(0x24c)],'primary_code':_0x511e56['primary_code'],'secondary_code':_0x511e56[_0x46c45c(0x287)],'expiry_date':_0x511e56[_0x46c45c(0x216)],'production_date':_0x511e56[_0x46c45c(0x250)],'maxProducts':_0x511e56[_0x46c45c(0x2c1)],'batch_code':_0x511e56[_0x46c45c(0x2b4)],'secondary_unit':_0x511e56[_0x46c45c(0x26c)],'unit':_0x511e56['unit'],'maxProducts':_0x511e56[_0x46c45c(0x2c1)],'maxPerUnit':_0x511e56[_0x46c45c(0x2bb)],'invoice':_0x511e56[_0x46c45c(0x229)]}));}return _0x113dd5;});Promise['all'](_0x290d85)['then'](async _0x354d4f=>{var _0x1f5c29=_0x5a3437;try{for(const _0x508bc7 of _0x354d4f){await warehouse[_0x1f5c29(0x2bd)]({'_id':_0x508bc7['_id']},{'$addToSet':{'product_details':{'$each':_0x508bc7[_0x1f5c29(0x23b)]}}});}_0x2a1547[_0x1f5c29(0x2cb)]=_0x1f5c29(0x298);const _0xd2de8e=await _0x2a1547['save'](),_0x50242c=await master_shop[_0x1f5c29(0x25f)](),_0x4a1e97=await email_settings['findOne'](),_0x3243bb=await supervisor_settings[_0x1f5c29(0x25f)]();var _0x222a5d=_0x2a1547['product'],_0x50d88b='',_0x36d369;for(_0x36d369 in _0x222a5d){var _0x15488d='FG';_0x2a1547['to_warehouse']==_0x1f5c29(0x2d0)&&(_0x15488d='DG'),_0x50d88b+=_0x1f5c29(0x29b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x222a5d[_0x36d369][_0x1f5c29(0x1fe)]+_0x1f5c29(0x20b)+_0x1f5c29(0x291)+_0x222a5d[_0x36d369]['product_code']+'</td>'+_0x1f5c29(0x291)+_0x222a5d[_0x36d369]['to_quantity']+_0x1f5c29(0x20b)+_0x1f5c29(0x291)+_0x222a5d[_0x36d369]['unit']+_0x1f5c29(0x20b)+_0x1f5c29(0x291)+_0x222a5d[_0x36d369][_0x1f5c29(0x26c)]+'</td>'+_0x1f5c29(0x291)+_0x2a1547[_0x1f5c29(0x26a)]+_0x1f5c29(0x20b)+_0x1f5c29(0x291)+_0x222a5d[_0x36d369][_0x1f5c29(0x2a9)]+_0x1f5c29(0x20b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x15488d+_0x222a5d[_0x36d369][_0x1f5c29(0x23e)]+_0x1f5c29(0x20b)+'</tr>';}let _0x4fd678=nodemailer[_0x1f5c29(0x281)]({'host':_0x4a1e97[_0x1f5c29(0x1f4)],'port':Number(_0x4a1e97[_0x1f5c29(0x27b)]),'secure':![],'auth':{'user':_0x4a1e97[_0x1f5c29(0x239)],'pass':_0x4a1e97[_0x1f5c29(0x27a)]}}),_0x167c44={'from':_0x4a1e97[_0x1f5c29(0x239)],'to':_0x3243bb[0x0]['FGSEmail'],'subject':_0x1f5c29(0x20d),'attachments':[{'filename':_0x1f5c29(0x28d),'path':__dirname+_0x1f5c29(0x254)+_0x1f5c29(0x283)+_0x50242c[0x0][_0x1f5c29(0x2cf)],'cid':_0x1f5c29(0x25b)}],'html':_0x1f5c29(0x200)+_0x1f5c29(0x234)+_0x1f5c29(0x297)+_0x1f5c29(0x270)+_0x1f5c29(0x277)+_0x1f5c29(0x270)+_0x1f5c29(0x26e)+'</div>'+'<div>'+_0x1f5c29(0x24e)+_0x50242c[0x0][_0x1f5c29(0x24b)]+'\x20</h2>'+_0x1f5c29(0x20c)+_0x1f5c29(0x20c)+_0x1f5c29(0x25a)+_0x1f5c29(0x270)+_0x1f5c29(0x2bc)+'\x20Order\x20Number\x20:\x20'+_0x2a1547[_0x1f5c29(0x210)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1f5c29(0x290)+_0x2a1547[_0x1f5c29(0x2c2)]+'\x20'+_0x1f5c29(0x284)+'</h5>'+_0x1f5c29(0x20c)+_0x1f5c29(0x295)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1f5c29(0x29b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1f5c29(0x21b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1f5c29(0x2b6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1f5c29(0x22a)+_0x1f5c29(0x1f7)+_0x1f5c29(0x25c)+_0x1f5c29(0x2ac)+_0x1f5c29(0x240)+'\x20'+_0x50d88b+'\x20'+_0x1f5c29(0x271)+_0x1f5c29(0x2a0)+_0x1f5c29(0x270)+_0x1f5c29(0x2b5)+_0x1f5c29(0x256)+_0x50242c[0x0][_0x1f5c29(0x24b)]+_0x1f5c29(0x2cc)+'</div>'+'</div>'+_0x1f5c29(0x262)};_0x4fd678['sendMail'](_0x167c44,function(_0x5879fc,_0x148ff1){var _0x15f3b9=_0x1f5c29;_0x5879fc?(console[_0x15f3b9(0x2ad)](_0x5879fc),console[_0x15f3b9(0x2ad)](_0x15f3b9(0x23a))):console[_0x15f3b9(0x2ad)]('Email\x20sent\x20successfully');}),_0x14143b[_0x1f5c29(0x2a7)](_0x1f5c29(0x208),_0x1f5c29(0x207)),_0x1338cb[_0x1f5c29(0x2c5)](_0x1f5c29(0x25d)+_0xd2de8e[_0x1f5c29(0x2b3)]);}catch(_0x5aa137){console['error'](_0x5aa137),_0x1338cb[_0x1f5c29(0x223)](0x1f4)[_0x1f5c29(0x227)]({'error':_0x1f5c29(0x272)});}})[_0x5a3437(0x20a)](_0x474b90=>{var _0x577e6e=_0x5a3437;console['error'](_0x474b90),_0x1338cb[_0x577e6e(0x223)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x47b6f8){console[_0x5a3437(0x2ba)](_0x47b6f8),_0x1338cb[_0x5a3437(0x223)](0x1f4)[_0x5a3437(0x227)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x4e7a4f=>{var _0xfcb896=_0x58dc2c;console['error'](_0x4e7a4f),_0x1338cb[_0xfcb896(0x223)](0x1f4)[_0xfcb896(0x227)]({'error':_0xfcb896(0x212)});});}catch(_0x193bc4){_0x1338cb['json']({'message':_0x193bc4['message']});}});function BayBinSelected(_0x303dfa,_0x2acb8f){var _0x4633d4=a0_0x5989aa,_0x3382fa=[];let _0xbf85a2=[];var _0xbd8e79=[];if(_0x303dfa=='DRY\x20GOODS'){switch(_0x2acb8f){case _0x4633d4(0x2a8):_0x3382fa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10];break;case _0x4633d4(0x299):_0x3382fa=[0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0x20];break;}_0xbd8e79=['DG'];}else{if(_0x303dfa==_0x4633d4(0x2b1)){switch(_0x2acb8f){case _0x4633d4(0x2a8):_0x3382fa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9];break;case _0x4633d4(0x299):_0x3382fa=[0xa,0xb,0xc,0xd,0xe,0xf,0x10,0x11,0x12];break;}_0xbd8e79=['FG'];}}return{'levels':_0x3382fa,'identify':_0xbd8e79};}router[a0_0x5989aa(0x2be)](a0_0x5989aa(0x244),auth,async(_0x492a01,_0x367f1f)=>{var _0x203221=a0_0x5989aa;try{const {username:_0x43df1c,email:_0x463976,role:_0x19c070}=_0x492a01['user'],_0xe0bcf9=_0x492a01[_0x203221(0x23c)],_0x39825e=await profile['findOne']({'email':_0xe0bcf9[_0x203221(0x239)]}),_0x512de1=await master_shop[_0x203221(0x25f)](),_0x1eb4b2=await transfers_finished[_0x203221(0x280)](_0x492a01[_0x203221(0x2a6)]['id']);let _0x2819a7=new Date(_0x1eb4b2[_0x203221(0x216)]),_0xa5575a=('0'+_0x2819a7['getDate']())[_0x203221(0x286)](-0x2),_0xc8f1e=('0'+(_0x2819a7[_0x203221(0x257)]()+0x1))[_0x203221(0x286)](-0x2),_0x42231c=_0x2819a7[_0x203221(0x285)](),_0x293e3f=_0x42231c+'-'+_0xc8f1e+'-'+_0xa5575a,_0x1d5c81;if(_0xe0bcf9[_0x203221(0x204)]=='staff'){const _0x2beda8=await staff[_0x203221(0x259)]({'email':_0xe0bcf9[_0x203221(0x239)]});_0x1d5c81=await warehouse['find']({'status':_0x203221(0x29c),'name':_0x2beda8[_0x203221(0x21d)],'warehouse_category':_0x203221(0x260)});}else _0x1d5c81=await warehouse[_0x203221(0x25f)]({'status':'Enabled','warehouse_category':_0x203221(0x260)});const _0x5dd4a7=await warehouse[_0x203221(0x1f8)]([{'$match':{'name':_0x1eb4b2[_0x203221(0x279)],'room':_0x1eb4b2[_0x203221(0x2b8)]}},{'$unwind':_0x203221(0x21f)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x203221(0x278)},'bin':{'$first':_0x203221(0x237)},'type':{'$first':_0x203221(0x201)},'floorlevel':{'$first':_0x203221(0x1fa)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x203221(0x274)},'product_code':{'$first':_0x203221(0x243)},'storage':{'$first':_0x203221(0x2c7)},'rack':{'$first':_0x203221(0x2c8)}}}]);var _0x1860c0=[0x1,0x2,0x3,0x4],_0x136587=['A','B','C','D','E','F','G','H','I','J'],_0x3e8d48=[_0x203221(0x26b),_0x203221(0x2ab)];const _0x5b9841=await product['find']({}),_0x3e16fd=BayBinSelected(_0x1eb4b2[_0x203221(0x26a)],_0x1eb4b2[_0x203221(0x2b9)]);if(_0x512de1[0x0][_0x203221(0x28c)]==_0x203221(0x26f)){var _0x5e2dc3=users[_0x203221(0x269)];console[_0x203221(0x2ad)](_0x5e2dc3);}else{if(_0x512de1[0x0]['language']=='Hindi')var _0x5e2dc3=users[_0x203221(0x1fd)];else{if(_0x512de1[0x0][_0x203221(0x28c)]==_0x203221(0x2cd))var _0x5e2dc3=users[_0x203221(0x2cd)];else{if(_0x512de1[0x0][_0x203221(0x28c)]==_0x203221(0x2b2))var _0x5e2dc3=users['Spanish'];else{if(_0x512de1[0x0][_0x203221(0x28c)]==_0x203221(0x2bf))var _0x5e2dc3=users[_0x203221(0x2bf)];else{if(_0x512de1[0x0]['language']==_0x203221(0x253))var _0x5e2dc3=users[_0x203221(0x261)];else{if(_0x512de1[0x0][_0x203221(0x28c)]==_0x203221(0x246))var _0x5e2dc3=users[_0x203221(0x246)];else{if(_0x512de1[0x0][_0x203221(0x28c)]==_0x203221(0x221))var _0x5e2dc3=users[_0x203221(0x2c3)];}}}}}}}_0x367f1f[_0x203221(0x289)](_0x203221(0x294),{'success':_0x492a01[_0x203221(0x2a7)](_0x203221(0x208)),'errors':_0x492a01[_0x203221(0x2a7)](_0x203221(0x218)),'role':_0xe0bcf9,'profile':_0x39825e,'master_shop':_0x512de1,'warehouse':_0x1d5c81,'transfer':_0x1eb4b2,'stock':_0x5dd4a7,'unit':_0x5b9841,'language':_0x5e2dc3,'levels':_0x1860c0,'Isle':_0x136587,'rooms_data':_0x3e8d48,'ed_fullDate':_0x293e3f,'dataSelected':_0x3e16fd});}catch(_0x5b9252){console[_0x203221(0x2ad)](_0x5b9252);}}),router[a0_0x5989aa(0x22d)](a0_0x5989aa(0x244),auth,async(_0x10eb4b,_0x54b614)=>{var _0x249d57=a0_0x5989aa;try{const _0x324283=_0x10eb4b['params']['id'];console[_0x249d57(0x2ad)](_0x10eb4b['body']);const _0x92a4c7=await transfers_finished['findById'](_0x324283);console[_0x249d57(0x2ad)](_0x249d57(0x2c4),_0x92a4c7);const {date:_0x511f46,from_warehouse:_0x2359ca,FromRoom_name:_0x20e307,to_warehouse:_0x51137e,ToRoom_name:_0xe5ec6a,prod_name:_0x3c009a,from_prod_qty:_0x40d94d,from_prod_level:_0x2216fd,from_prod_isle:_0x269c99,from_prod_pallet:_0x24cc25,to_prod_qty:_0x332cf5,to_prod_level:_0x16c4f7,to_prod_isle:_0x291433,to_prod_pallet:_0x58a959,primary_code:_0x292789,secondary_code:_0x17ddaf,product_code3:_0x12d327,note:_0x354497,invoice:_0x12c8f4,expiry_date:_0x2f771c}=_0x10eb4b[_0x249d57(0x28a)];if(typeof _0x3c009a==_0x249d57(0x1f9))var _0x15ed5f=[_0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x2a5)]],_0x2e3bfb=[_0x10eb4b['body'][_0x249d57(0x2aa)]],_0x5737a5=[_0x10eb4b['body'][_0x249d57(0x275)]],_0x56aa2f=[_0x10eb4b['body'][_0x249d57(0x258)]],_0x53f756=[_0x10eb4b['body'][_0x249d57(0x209)]],_0x538e8c=[_0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x29d)]],_0x1b60c2=[_0x10eb4b[_0x249d57(0x28a)]['secondary_code']],_0x29a297=[_0x10eb4b['body']['product_code3']],_0x215537=[_0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x27f)]],_0xf6da0b=[_0x10eb4b['body'][_0x249d57(0x22f)]],_0x52cbbe=[_0x10eb4b['body'][_0x249d57(0x26c)]],_0x3299a7=[_0x10eb4b['body']['batch_code']],_0x22d57d=[_0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x216)]];else var _0x15ed5f=[..._0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x2a5)]],_0x2e3bfb=[..._0x10eb4b['body'][_0x249d57(0x2aa)]],_0x5737a5=[..._0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x275)]],_0x56aa2f=[..._0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x258)]],_0x53f756=[..._0x10eb4b[_0x249d57(0x28a)]['to_prod_level']],_0x538e8c=[..._0x10eb4b[_0x249d57(0x28a)]['primary_code']],_0x1b60c2=[..._0x10eb4b[_0x249d57(0x28a)]['secondary_code']],_0x29a297=[..._0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x2d2)]],_0x215537=[..._0x10eb4b[_0x249d57(0x28a)]['MaxStocks_data2']],_0xf6da0b=[..._0x10eb4b[_0x249d57(0x28a)]['unit']],_0x52cbbe=[..._0x10eb4b['body'][_0x249d57(0x26c)]],_0x3299a7=[..._0x10eb4b['body'][_0x249d57(0x2b4)]],_0x22d57d=[..._0x10eb4b[_0x249d57(0x28a)][_0x249d57(0x216)]];const _0x3a9436=_0x15ed5f[_0x249d57(0x27c)](_0x3d7fbc=>{return _0x3d7fbc={'product_name':_0x3d7fbc};});_0x2e3bfb[_0x249d57(0x22c)]((_0x287af8,_0x7e5776)=>{var _0x1a76d2=_0x249d57;_0x3a9436[_0x7e5776][_0x1a76d2(0x273)]=_0x287af8;}),_0x5737a5['forEach']((_0x3c7ded,_0x15873c)=>{var _0x4e2788=_0x249d57;_0x3a9436[_0x15873c][_0x4e2788(0x242)]=_0x3c7ded;}),_0x56aa2f[_0x249d57(0x22c)]((_0x266e3b,_0x4d6b45)=>{var _0x300ba7=_0x249d57;_0x3a9436[_0x4d6b45][_0x300ba7(0x22b)]=_0x266e3b;}),_0x53f756[_0x249d57(0x22c)]((_0x14d262,_0x225419)=>{var _0x2c977b=_0x249d57;_0x3a9436[_0x225419][_0x2c977b(0x23e)]=_0x14d262;}),_0x538e8c[_0x249d57(0x22c)]((_0x303225,_0x245848)=>{var _0x2e1f82=_0x249d57;_0x3a9436[_0x245848][_0x2e1f82(0x29d)]=_0x303225;}),_0x1b60c2[_0x249d57(0x22c)]((_0x4e8a6d,_0x1d7a01)=>{var _0x132fe3=_0x249d57;_0x3a9436[_0x1d7a01][_0x132fe3(0x287)]=_0x4e8a6d;}),_0x29a297[_0x249d57(0x22c)]((_0x310191,_0x42b848)=>{var _0x4ff47b=_0x249d57;_0x3a9436[_0x42b848][_0x4ff47b(0x24c)]=_0x310191;}),_0x215537[_0x249d57(0x22c)]((_0x12a79f,_0x2a7fc8)=>{var _0x435565=_0x249d57;_0x3a9436[_0x2a7fc8][_0x435565(0x2c1)]=_0x12a79f;}),_0xf6da0b[_0x249d57(0x22c)]((_0x2d21d9,_0x5982fa)=>{var _0x1c2c0b=_0x249d57;_0x3a9436[_0x5982fa][_0x1c2c0b(0x22f)]=_0x2d21d9;}),_0x52cbbe[_0x249d57(0x22c)]((_0x594eab,_0x2114c2)=>{var _0x1375e6=_0x249d57;_0x3a9436[_0x2114c2][_0x1375e6(0x26c)]=_0x594eab;}),_0x3299a7[_0x249d57(0x22c)]((_0x862d24,_0x18434b)=>{_0x3a9436[_0x18434b]['batch_code']=_0x862d24;}),_0x22d57d[_0x249d57(0x22c)]((_0x31311c,_0x12b073)=>{var _0x2fe953=_0x249d57;_0x3a9436[_0x12b073][_0x2fe953(0x216)]=_0x31311c;});const _0x5f3a43=_0x3a9436[_0x249d57(0x1f5)](_0x2f0779=>_0x2f0779[_0x249d57(0x22b)]!=='0'&&_0x2f0779[_0x249d57(0x22b)]!==''||_0x2f0779[_0x249d57(0x268)]!=='0'&&_0x2f0779[_0x249d57(0x268)]!=='');var _0x2b1cce=0x0;_0x5f3a43[_0x249d57(0x22c)](_0x2cffc5=>{var _0x386b24=_0x249d57;parseInt(_0x2cffc5[_0x386b24(0x273)])<parseInt(_0x2cffc5['to_quantity'])&&_0x2b1cce++;});if(_0x2b1cce!=0x0)return _0x10eb4b['flash']('errors',_0x249d57(0x222)),_0x54b614[_0x249d57(0x2c5)]('back');const _0x52c955=await warehouse[_0x249d57(0x259)]({'name':_0x92a4c7[_0x249d57(0x279)],'room':_0x92a4c7[_0x249d57(0x2b8)]});_0x92a4c7[_0x249d57(0x230)][_0x249d57(0x22c)](_0x139fe3=>{if(_0x139fe3['to_quantity']>0x0){const _0x503839=_0x52c955['product_details']['map'](_0x36e655=>{var _0x3901b1=a0_0x5de2;_0x36e655[_0x3901b1(0x1fe)]==_0x139fe3[_0x3901b1(0x1fe)]&&_0x36e655[_0x3901b1(0x2ca)]==_0x139fe3[_0x3901b1(0x242)]&&(_0x36e655[_0x3901b1(0x2ae)]=parseInt(_0x36e655[_0x3901b1(0x2ae)])+parseInt(_0x139fe3[_0x3901b1(0x22b)]));});}}),await _0x52c955[_0x249d57(0x29a)]();const _0x213281=await warehouse[_0x249d57(0x259)]({'name':_0x92a4c7[_0x249d57(0x26a)],'room':_0x92a4c7[_0x249d57(0x2b9)]});_0x92a4c7[_0x249d57(0x230)][_0x249d57(0x22c)](_0x3fc795=>{var _0x26f6de=_0x249d57;if(_0x3fc795['to_quantity']>0x0){const _0x339669=_0x213281[_0x26f6de(0x23b)]['map'](_0x22395e=>{var _0x2feeb9=_0x26f6de;_0x22395e['product_name']==_0x3fc795[_0x2feeb9(0x1fe)]&&_0x22395e['bay']==_0x3fc795[_0x2feeb9(0x23e)]&&(_0x22395e[_0x2feeb9(0x2ae)]=parseInt(_0x22395e[_0x2feeb9(0x2ae)])-parseInt(_0x3fc795[_0x2feeb9(0x22b)]));});}}),await _0x213281['save'](),_0x92a4c7[_0x249d57(0x2c2)]=_0x511f46,_0x92a4c7[_0x249d57(0x279)]=_0x2359ca,_0x92a4c7[_0x249d57(0x26a)]=_0x51137e,_0x92a4c7[_0x249d57(0x230)]=_0x5f3a43,_0x92a4c7[_0x249d57(0x1fb)]=_0x354497,_0x92a4c7[_0x249d57(0x210)]=_0x12c8f4;const _0x53a4d2=await _0x92a4c7['save'](),_0x5114a2=await warehouse['findOne']({'name':_0x2359ca,'room':_0x20e307});_0x53a4d2[_0x249d57(0x230)][_0x249d57(0x22c)](_0x407533=>{var _0x22b5f8=_0x249d57;if(_0x407533[_0x22b5f8(0x22b)]>0x0){const _0x150ff4=_0x5114a2[_0x22b5f8(0x23b)][_0x22b5f8(0x27c)](_0xfd2c06=>{var _0x103c9f=_0x22b5f8;_0xfd2c06[_0x103c9f(0x1fe)]==_0x407533[_0x103c9f(0x1fe)]&&_0xfd2c06[_0x103c9f(0x2ca)]==_0x407533['from_bay']&&(_0xfd2c06[_0x103c9f(0x2ae)]=parseInt(_0xfd2c06[_0x103c9f(0x2ae)])-parseInt(_0x407533[_0x103c9f(0x22b)]));});}}),await _0x5114a2[_0x249d57(0x29a)]();const _0x66102a=await warehouse['findOne']({'name':_0x51137e,'room':_0xe5ec6a});_0x53a4d2['product'][_0x249d57(0x22c)](_0x2effb3=>{var _0x1dbe52=_0x249d57;if(_0x2effb3[_0x1dbe52(0x22b)]>0x0){var _0x39ed2b=0x0;const _0x3bd43e=_0x66102a[_0x1dbe52(0x23b)][_0x1dbe52(0x27c)](_0xbeb65d=>{var _0x4eaffb=_0x1dbe52;_0xbeb65d['product_name']==_0x2effb3[_0x4eaffb(0x1fe)]&&_0xbeb65d['bay']==_0x2effb3[_0x4eaffb(0x23e)]&&(_0xbeb65d['product_stock']=parseInt(_0xbeb65d[_0x4eaffb(0x2ae)])+parseInt(_0x2effb3['to_quantity']),_0x39ed2b++);});_0x39ed2b=='0'&&(_0x66102a[_0x1dbe52(0x23b)]=_0x66102a[_0x1dbe52(0x23b)][_0x1dbe52(0x27e)]({'product_name':_0x2effb3[_0x1dbe52(0x1fe)],'product_stock':_0x2effb3['to_quantity'],'bay':_0x2effb3['to_bay'],'product_code':_0x2effb3['product_code'],'primary_code':_0x2effb3[_0x1dbe52(0x29d)],'secondary_code':_0x2effb3[_0x1dbe52(0x287)],'maxProducts':_0x2effb3[_0x1dbe52(0x2c1)]}));}}),await _0x66102a['save'](),_0x10eb4b['flash'](_0x249d57(0x208),_0x249d57(0x236)),_0x54b614['redirect'](_0x249d57(0x217));}catch(_0x4d7631){console[_0x249d57(0x2ad)](_0x4d7631);}}),router[a0_0x5989aa(0x22d)](a0_0x5989aa(0x228),async(_0x192dbe,_0x2fdc4c)=>{var _0x5e9e0e=a0_0x5989aa;const {FromWareHouse:_0x2de8a1,FromRoom:_0x4e8bdc,ToWarehouse:_0x543f9b,ToRoom:_0x845c23,primary_code:_0x1a11a3,Roomslist:_0x8f9515}=_0x192dbe[_0x5e9e0e(0x28a)],_0x2294b8=_0x8f9515['split'](','),_0x18625e=[];async function _0xf55efc(_0x1473a7){var _0x1f3f9a=_0x5e9e0e;const _0x4ad556=await warehouse[_0x1f3f9a(0x1f8)]([{'$match':{'name':_0x2de8a1,'room':_0x1473a7}},{'$unwind':_0x1f3f9a(0x21f)},{'$match':{'product_details.primary_code':_0x1a11a3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1f3f9a(0x288)},'instock':{'$first':_0x1f3f9a(0x24d)},'primary_code':{'$first':_0x1f3f9a(0x264)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1f3f9a(0x243)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1f3f9a(0x237)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1f3f9a(0x1fa)},'unit':{'$first':_0x1f3f9a(0x213)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1f3f9a(0x2c7)},'rack':{'$first':_0x1f3f9a(0x2c8)},'expiry_date':{'$first':_0x1f3f9a(0x2d1)},'production_date':{'$first':_0x1f3f9a(0x29e)},'batch_code':{'$first':_0x1f3f9a(0x21c)},'maxPerUnit':{'$first':_0x1f3f9a(0x293)},'roomNamed':{'$first':_0x1f3f9a(0x2c0)},'prod_cat':{'$first':'P'},'invoice':{'$first':_0x1f3f9a(0x276)}}}]),_0x1c16bc=await warehouse[_0x1f3f9a(0x1f8)]([{'$match':{'name':_0x2de8a1,'room':_0x1473a7}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1a11a3}},{'$group':{'_id':_0x1f3f9a(0x266),'name':{'$first':_0x1f3f9a(0x288)},'instock':{'$first':_0x1f3f9a(0x24d)},'primary_code':{'$first':_0x1f3f9a(0x264)},'secondary_code':{'$first':_0x1f3f9a(0x274)},'product_code':{'$first':_0x1f3f9a(0x243)},'level':{'$first':_0x1f3f9a(0x278)},'isle':{'$first':_0x1f3f9a(0x237)},'type':{'$first':_0x1f3f9a(0x201)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1f3f9a(0x213)},'secondary_unit':{'$first':_0x1f3f9a(0x20f)},'storage':{'$first':_0x1f3f9a(0x2c7)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1f3f9a(0x2d1)},'production_date':{'$first':_0x1f3f9a(0x29e)},'batch_code':{'$first':_0x1f3f9a(0x21c)},'maxPerUnit':{'$first':_0x1f3f9a(0x293)},'roomNamed':{'$first':_0x1f3f9a(0x2c0)},'prod_cat':{'$first':'S'},'invoice':{'$first':_0x1f3f9a(0x276)}}}]);if(_0x4ad556['length']>0x0)_0x18625e[_0x1f3f9a(0x241)](_0x4ad556);else _0x1c16bc[_0x1f3f9a(0x206)]>0x0&&_0x18625e['push'](_0x1c16bc);}const _0x569374=_0x2294b8['map'](_0x5887f2=>_0xf55efc(_0x5887f2));await Promise['all'](_0x569374),_0x2fdc4c[_0x5e9e0e(0x227)](_0x18625e);}),router['post'](a0_0x5989aa(0x211),async(_0x3cd96a,_0x4a477d)=>{var _0x2199d3=a0_0x5989aa;try{const {FromWareHouse:_0x3d25d5,FromRoom:_0x5947e1,ToWarehouse:_0x1e99e4,ToRoom:_0x18124a,secondary_code:_0x4bcd1a}=_0x3cd96a[_0x2199d3(0x28a)],_0x1f0aae=await warehouse['aggregate']([{'$match':{'name':_0x3d25d5}},{'$unwind':_0x2199d3(0x21f)},{'$match':{'product_details.secondary_code':_0x4bcd1a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2199d3(0x288)},'primary_code':{'$first':_0x2199d3(0x264)},'secondary_code':{'$first':_0x2199d3(0x274)},'product_code':{'$first':'$product_details.product_code'},'instock':{'$first':_0x2199d3(0x24d)},'warehouse':{'$first':_0x2199d3(0x24a)},'level':{'$first':_0x2199d3(0x24f)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x2199d3(0x21e)},'maxProducts':{'$first':_0x2199d3(0x1f6)},'unit':{'$first':_0x2199d3(0x213)},'expiry_date':{'$first':_0x2199d3(0x2d1)},'production_date':{'$first':_0x2199d3(0x29e)}}}]);_0x4a477d['status'](0xc8)[_0x2199d3(0x227)](_0x1f0aae);}catch(_0x55a7ac){_0x4a477d[_0x2199d3(0x223)](0x194)[_0x2199d3(0x227)]({'message':_0x55a7ac['message']});}}),router['post'](a0_0x5989aa(0x25e),async(_0x58cc07,_0x467bf2)=>{var _0x533ea7=a0_0x5989aa;try{const {FromWareHouse:_0x3e6ffa,FromRoom:_0x5f2fa9,ToWarehouse:_0x42b529,ToRoom:_0x2decb1,product_code:_0x3ecadd}=_0x58cc07[_0x533ea7(0x28a)],_0x1086cc=await warehouse[_0x533ea7(0x1f8)]([{'$match':{'name':_0x3e6ffa}},{'$unwind':'$product_details'},{'$match':{'product_details.product_code':_0x3ecadd}},{'$group':{'_id':_0x533ea7(0x266),'name':{'$first':_0x533ea7(0x288)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x533ea7(0x274)},'product_code':{'$first':_0x533ea7(0x243)},'instock':{'$first':_0x533ea7(0x24d)},'warehouse':{'$first':'$name'},'level':{'$first':_0x533ea7(0x24f)},'isle':{'$first':_0x533ea7(0x2af)},'pallet':{'$first':_0x533ea7(0x21e)},'maxProducts':{'$first':_0x533ea7(0x1f6)},'unit':{'$first':_0x533ea7(0x213)}}}]);_0x467bf2[_0x533ea7(0x223)](0xc8)[_0x533ea7(0x227)](_0x1086cc);}catch(_0x22032e){_0x467bf2[_0x533ea7(0x223)](0x194)['json']({'message':_0x22032e[_0x533ea7(0x226)]});}}),router[a0_0x5989aa(0x22d)]('/CheckingWarehouse',async(_0x29373c,_0x49e345)=>{var _0x9ee10a=a0_0x5989aa;const {productCode:_0x589159,bay:_0x19d12f,warehouses:_0x4d2c93,room:_0x1eb381}=_0x29373c[_0x9ee10a(0x28a)];console[_0x9ee10a(0x2ad)](_0x29373c['body']);try{const _0x535df3=await warehouse[_0x9ee10a(0x1f8)]([{'$match':{'name':_0x4d2c93,'room':_0x1eb381}},{'$unwind':_0x9ee10a(0x21f)},{'$match':{'product_details.bay':parseInt(_0x19d12f)}},{'$group':{'_id':_0x9ee10a(0x266),'name':{'$first':_0x9ee10a(0x288)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x9ee10a(0x1f6)}}}]);_0x49e345['status'](0xc8)[_0x9ee10a(0x227)](_0x535df3);}catch(_0x44d74d){_0x49e345[_0x9ee10a(0x223)](0x194)[_0x9ee10a(0x227)]({'message':_0x44d74d[_0x9ee10a(0x226)]});}}),module[a0_0x5989aa(0x251)]=router;