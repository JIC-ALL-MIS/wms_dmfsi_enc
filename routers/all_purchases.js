var a0_0x471c08=a0_0x4fa8;(function(_0x3a0f53,_0x326e56){var _0x248213=a0_0x4fa8,_0x30b478=_0x3a0f53();while(!![]){try{var _0x4dec7d=parseInt(_0x248213(0x18f))/0x1+parseInt(_0x248213(0x19c))/0x2*(-parseInt(_0x248213(0xf7))/0x3)+parseInt(_0x248213(0x10b))/0x4+parseInt(_0x248213(0x176))/0x5+-parseInt(_0x248213(0x158))/0x6*(parseInt(_0x248213(0x15d))/0x7)+parseInt(_0x248213(0x1ca))/0x8*(parseInt(_0x248213(0xfd))/0x9)+parseInt(_0x248213(0x167))/0xa;if(_0x4dec7d===_0x326e56)break;else _0x30b478['push'](_0x30b478['shift']());}catch(_0x41879c){_0x30b478['push'](_0x30b478['shift']());}}}(a0_0x3335,0x5cf80));const express=require(a0_0x471c08(0x113)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x471c08(0xf9)),auth=require(a0_0x471c08(0x1aa)),nodemailer=require(a0_0x471c08(0x1e8));var ejs=require('ejs');function a0_0x4fa8(_0x41e331,_0x31888d){var _0x333578=a0_0x3335();return a0_0x4fa8=function(_0x4fa864,_0x4445b3){_0x4fa864=_0x4fa864-0xe7;var _0x26de2d=_0x333578[_0x4fa864];return _0x26de2d;},a0_0x4fa8(_0x41e331,_0x31888d);}const path=require(a0_0x471c08(0x1e4)),users=require('../public/language/languages.json');router[a0_0x471c08(0x156)](a0_0x471c08(0x1b9),auth,async(_0x323bf8,_0x5605de)=>{var _0x191a85=a0_0x471c08;try{const {username:_0x3afa08,email:_0x392f66,role:_0x43f7a8}=_0x323bf8[_0x191a85(0x15a)],_0x4ed1b3=_0x323bf8['user'],_0x290400=await profile[_0x191a85(0x174)]({'email':_0x4ed1b3[_0x191a85(0x109)]}),_0x5f1e75=await staff['findOne']({'email':_0x4ed1b3['email']});if(_0x4ed1b3[_0x191a85(0xeb)]==_0x191a85(0x1c0)){const _0x3a56e4=await staff[_0x191a85(0x174)]({'email':_0x4ed1b3[_0x191a85(0x109)]});}const _0x275e97=await master_shop[_0x191a85(0x17b)]();let _0x504364;if(_0x4ed1b3[_0x191a85(0xeb)]=='staff'){const _0x41ef7c=await staff[_0x191a85(0x174)]({'email':_0x4ed1b3[_0x191a85(0x109)]});_0x504364=await purchases[_0x191a85(0x1f0)]([{'$match':{'warehouse_name':_0x41ef7c[_0x191a85(0x1b4)]}},{'$lookup':{'from':'suppliers','localField':_0x191a85(0xfb),'foreignField':_0x191a85(0x1ec),'as':_0x191a85(0x141)}},{'$unwind':_0x191a85(0x112)},{'$unwind':_0x191a85(0xfc)},{'$group':{'_id':_0x191a85(0x11c),'invoice':{'$first':_0x191a85(0x140)},'suppliers':{'$first':_0x191a85(0x170)},'date':{'$first':_0x191a85(0x204)},'warehouse_name':{'$first':_0x191a85(0x1f4)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x191a85(0x17d)},'due_amount':{'$first':_0x191a85(0x14b)},'return_data':{'$first':_0x191a85(0x152)},'batch_code':{'$first':_0x191a85(0x1d1)},'expiry_date':{'$first':_0x191a85(0x150)},'suppliers_docs':{'$first':_0x191a85(0x112)},'total_product_quantity':{'$sum':_0x191a85(0x1b3)},'level':{'$addToSet':_0x191a85(0x1f7)},'isle':{'$addToSet':_0x191a85(0x1a3)},'type':{'$addToSet':_0x191a85(0x1d3)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x504364=await purchases[_0x191a85(0x1f0)]([{'$lookup':{'from':'suppliers','localField':_0x191a85(0xfb),'foreignField':_0x191a85(0x1ec),'as':_0x191a85(0x141)}},{'$unwind':_0x191a85(0x112)},{'$unwind':_0x191a85(0xfc)},{'$group':{'_id':_0x191a85(0x11c),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x191a85(0x170)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x191a85(0x1f4)},'room':{'$addToSet':_0x191a85(0x102)},'product':{'$push':_0x191a85(0xfc)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x191a85(0x152)},'batch_code':{'$first':_0x191a85(0x1d1)},'expiry_date':{'$first':_0x191a85(0x150)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x191a85(0x1f7)},'isle':{'$addToSet':_0x191a85(0x1a3)},'type':{'$addToSet':_0x191a85(0x1d3)},'floorlevel':{'$addToSet':_0x191a85(0x110)},'finalize':{'$first':_0x191a85(0x139)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x275e97[0x0][_0x191a85(0x11f)]==_0x191a85(0xf4)){var _0x346d83=users[_0x191a85(0x1a5)];console[_0x191a85(0x127)](_0x346d83);}else{if(_0x275e97[0x0]['language']==_0x191a85(0x135))var _0x346d83=users[_0x191a85(0x135)];else{if(_0x275e97[0x0][_0x191a85(0x11f)]=='German')var _0x346d83=users[_0x191a85(0xf1)];else{if(_0x275e97[0x0][_0x191a85(0x11f)]=='Spanish')var _0x346d83=users['Spanish'];else{if(_0x275e97[0x0][_0x191a85(0x11f)]==_0x191a85(0x19b))var _0x346d83=users[_0x191a85(0x19b)];else{if(_0x275e97[0x0][_0x191a85(0x11f)]=='Portuguese\x20(BR)')var _0x346d83=users[_0x191a85(0x142)];else{if(_0x275e97[0x0][_0x191a85(0x11f)]=='Chinese')var _0x346d83=users[_0x191a85(0x1e7)];else{if(_0x275e97[0x0]['language']==_0x191a85(0x1fd))var _0x346d83=users[_0x191a85(0x16b)];}}}}}}}_0x5605de[_0x191a85(0x1cf)]('all_purchases',{'success':_0x323bf8[_0x191a85(0x179)](_0x191a85(0x1fc)),'errors':_0x323bf8[_0x191a85(0x179)](_0x191a85(0x1d5)),'purchases':_0x504364,'role':_0x4ed1b3,'profile':_0x290400,'master_shop':_0x275e97,'language':_0x346d83});}catch(_0x491b0d){console[_0x191a85(0x127)](_0x191a85(0x1ba),_0x491b0d),_0x5605de[_0x191a85(0x178)](0xc8)[_0x191a85(0x1c4)]({'message':_0x491b0d['message']});}});function a0_0x3335(){var _0x13f1f5=['map','<div>','type','types','<html><head><title></title>','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.bay','path','rack','/view/:id','Chinese','nodemailer','room','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','name','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.secondary_code','<span\x20style=\x22float:\x20right;\x22>','aggregate','/view/return_purchase/:id','/preview/:id','$maxStocks','$warehouse_name','product_stock','/all_purchases/view','$product.bay','filter','toString','delivery_date','/view/add_purchases/:id','success','Arabic\x20(ae)','add\x20post','/CheckingWarehouse','$product_details.maxProducts','abs','Rack\x20F','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$date','$unit','product_name','Rack\x20A','$secondary_unit','forEach','</div>','/invoice/:id','getFullYear','</h5>','$product_details.isle','Sales\x20Update\x20successfully','role','isle','params','due_amount','$product_details._id','Enabled','German','Rack\x20B','<tr>','English\x20(US)','expiry_date','Spanish','75PwYAtl','purchase\x20data\x20update\x20successfully','../models/all_models','Rack\x20D','suppliers','$product','36xQazZY','$name','product_details','here','\x20<>\x20','$product.room_name','Raw\x20Materials','product_list','foreach\x20newproduct','secondary_code_hide','primary_code_hide','deliverycode','email','site_title','2165740veRqNA','primary_code','</thead>','$product_code','maxperunit','$product.floorlevel','port','$suppliers_docs','express','prod_secondunit','Enclosed','product_code_hide','concat','</table>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','delivery_code','product_cat','$_id','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','language','Shelves','note','purchase_invoice','padStart','rak','$product_details.storage','room_name','log','master','alertQTY','$alertquantity','$maxProdPerUnit','prod_unit','$product_details.expiry_date','/view/add_purchases','INC-','\x20Order\x20Date\x20:\x20','prod_pallet','secondary_code','return_product','back','Hindi','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Return\x20Goods','return_data','$finalize','JO_number','prod_isle','prod_code','$product_details.primary_code','Rack\x20C','Email\x20sent\x20successfully','$invoice','suppliers_docs','Portuguese','Portuguese\x20(BR)','paid_amount','Purchase\x20Return\x20Mail','gmail','exports','findById','bin','floorlevel','$due_amount','$product_details.floorlevel','getDate','then','currency','$expiry_date','prod_name','$return_data','all','bay','invoice','get','amount','853914qZaiAY','Paid\x20For\x20Purchase','user','Logo.png','stock_data','21iaZJsA','prod_qty','prod_invoice','$product_details.product_stock','host','</span>','<strong>\x20Regards\x20</strong>','batch_code','save','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','574200jJxlig','edit_purchases','Purchase\x20data\x20added\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','body','/all_purchases/view/','stock_quantity','$suppliers','purchase_quantity','<!DOCTYPE\x20html>','maxStocks','findOne','push','68100fPIWgN','<hr\x20class=\x22my-3\x22>','status','flash','</head><body>','find','all_purchases_barcode','$paid_amount','</td>','post','</body></html>','/upload/','$product_details.bin','quantity','$product_details.rack','product','prod_Qty','storage','</tbody>','production_date','pallet','MaxStocks_data','add_purchases','image','actual_qty','147167ArnHff','sendMail','currency_placement','<tbody\x20style=\x22text-align:\x20center;\x22>','Receiving\x20Area','logo','catch','True','return_purchase','product_code','Purchase\x20Mail','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','French','31826FpCyIy','Rack\x20E','COLD\x20STORAGE','RoomAssign','prod_primunit','stocks','$product_details','$product.bin','redirect','English','$category','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$secondary_code','../middleware/auth','floor','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_code','return_qty','<h2>\x20','/barcode/:id','Level','$product.quantity','warehouse','string','$product_details.level','</tr>','$brand','/view','table\x20page','getMonth','/../public','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchases\x20item\x20return\x20successfull','\x20</h2>','staff','date','error','actual_uom','json','prod_cat','$product_details.type','\x20<\x20wew\x20>\x20','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Floor','891880MgRyoX','random','standard_unit','level','warehouse_name','render','prod_level','$batch_code','length','$product.type','max_product_unit','errors','suppliers_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Ambient','slice','message','$product_details.pallet','$primary_code'];a0_0x3335=function(){return _0x13f1f5;};return a0_0x3335();}function BayBinSelected(_0x3fb7e9,_0x2f1787){var _0x54e03c=a0_0x471c08,_0x3a5b05=[],_0x525f4f=[],_0x2349f1=[],_0x22ea67=[],_0x5f2f6b=[],_0x3272ed=[];let _0x5e82f9=[];if(_0x3fb7e9=='DRY\x20STORAGE')switch(_0x2f1787){case _0x54e03c(0x207):_0x3a5b05=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x525f4f=[0x1,0x2],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=[_0x54e03c(0x1b2),'Floor'],_0x5f2f6b=['D'],_0x3272ed=['A'];break;case _0x54e03c(0xf2):_0x3a5b05=[0x6,0x5,0x4,0x3,0x2,0x1],_0x525f4f=[0x1,0x2],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=[_0x54e03c(0x1b2),_0x54e03c(0x1c9)],_0x5f2f6b=['D'],_0x3272ed=['B'];break;case _0x54e03c(0x120):_0x3a5b05=[0x0],_0x525f4f=[0x0],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=['Floor'],_0x5f2f6b=['D'],_0x3272ed=['S'];break;case _0x54e03c(0x193):_0x3a5b05=[0x0],_0x525f4f=[0x0],_0x22ea67=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2349f1=[_0x54e03c(0x1c9)],_0x5f2f6b=['D'],_0x3272ed=['R'];break;}else{if(_0x3fb7e9==_0x54e03c(0x19e))switch(_0x2f1787){case _0x54e03c(0x207):_0x3a5b05=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x525f4f=['B','F'],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=[_0x54e03c(0x1b2),'Floor'],_0x5f2f6b=['C'],_0x3272ed=['A'];break;case'Rack\x20B':_0x3a5b05=[0x5,0x4,0x3,0x2,0x1],_0x525f4f=['F','B','S'],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=[_0x54e03c(0x1b2),_0x54e03c(0x1c9)],_0x5f2f6b=['C'],_0x3272ed=['B'];break;case _0x54e03c(0x13e):_0x3a5b05=[0x1,0x2,0x3,0x4,0x5],_0x525f4f=['B','F','S'],_0x22ea67=[0x5,0x4,0x3,0x2,0x1],_0x2349f1=[_0x54e03c(0x1b2),_0x54e03c(0x1c9)],_0x5f2f6b=['C'],_0x3272ed=['C'];break;case _0x54e03c(0xfa):_0x3a5b05=[0x5,0x4,0x3,0x2,0x1],_0x525f4f=['F','B','S'],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=[_0x54e03c(0x1b2),'Floor'],_0x5f2f6b=['C'],_0x3272ed=['D'];break;case _0x54e03c(0x19d):_0x3a5b05=[0x4,0x3,0x2,0x1],_0x525f4f=[0x1,0x2],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=['Level','Floor'],_0x5f2f6b=['C'],_0x3272ed=['E'];break;case _0x54e03c(0x202):_0x3a5b05=[0x1,0x2,0x3],_0x525f4f=[0x1,0x2],_0x22ea67=[0x1,0x2,0x3,0x4,0x5],_0x2349f1=[_0x54e03c(0x1b2)],_0x5f2f6b=['C'],_0x3272ed=['F'];break;}}return{'levels':_0x3a5b05,'Isle':_0x525f4f,'rack':_0x22ea67,'type':_0x2349f1,'storage':_0x5f2f6b,'rak':_0x3272ed};}async function getRandom8DigitNumber(){var _0x33b6c1=a0_0x471c08;const _0x469a8b=0x989680,_0x12ade2=0x5f5e0ff,_0x2343b1=Math[_0x33b6c1(0x1ab)](Math[_0x33b6c1(0x1cb)]()*(_0x12ade2-_0x469a8b+0x1))+_0x469a8b;var _0x107edd;const _0x2c9afe=await purchases['findOne']({'invoice':_0x33b6c1(0x12f)+_0x2343b1});return _0x2c9afe&&_0x2c9afe[_0x33b6c1(0x1d2)]>0x0?_0x107edd='INC-'+_0x2343b1:_0x107edd=_0x33b6c1(0x12f)+_0x2343b1,_0x107edd;}router[a0_0x471c08(0x156)](a0_0x471c08(0x12e),auth,async(_0x316a17,_0x4cbb1a)=>{var _0x22384e=a0_0x471c08;try{const {username:_0x199057,email:_0x584058,role:_0x25a09c}=_0x316a17[_0x22384e(0x15a)],_0x8aa7bd=_0x316a17[_0x22384e(0x15a)],_0x423d40=await profile[_0x22384e(0x174)]({'email':_0x8aa7bd[_0x22384e(0x109)]}),_0x373605=await master_shop[_0x22384e(0x17b)](),_0x3075b9=await staff[_0x22384e(0x174)]({'email':_0x8aa7bd['email']}),_0x2f1238=await suppliers[_0x22384e(0x17b)]({});let _0x58a25e;if(_0x8aa7bd[_0x22384e(0xeb)]==_0x22384e(0x1c0)){const _0x2b071b=await staff[_0x22384e(0x174)]({'email':_0x8aa7bd['email']});_0x58a25e=await warehouse['aggregate']([{'$match':{'status':_0x22384e(0xf0),'name':_0x2b071b[_0x22384e(0x1b4)],'warehouse_category':_0x22384e(0x103),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x22384e(0xfe),'name':{'$first':_0x22384e(0xfe)}}}]);}else _0x58a25e=await warehouse[_0x22384e(0x1f0)]([{'$match':{'status':_0x22384e(0xf0),'warehouse_category':_0x22384e(0x103),'name':{'$ne':_0x22384e(0x137)}}},{'$group':{'_id':_0x22384e(0xfe),'name':{'$first':'$name'}}}]);const _0xc123bc=await product['find']({}),_0x5cc8f2=await warehouse[_0x22384e(0x17b)]({'status':_0x22384e(0xf0)}),_0x5412f0=await purchases[_0x22384e(0x17b)]({}),_0x42ce30=_0x5412f0['length']+0x1,_0x4d4d00='INC-'+_0x42ce30[_0x22384e(0x1f9)]()[_0x22384e(0x123)](0x5,'0');var _0x4e5718=[_0x22384e(0x1d8),_0x22384e(0x115)];if(_0x373605[0x0][_0x22384e(0x11f)]==_0x22384e(0xf4))var _0x16f303=users[_0x22384e(0x1a5)];else{if(_0x373605[0x0]['language']==_0x22384e(0x135))var _0x16f303=users[_0x22384e(0x135)];else{if(_0x373605[0x0]['language']=='German')var _0x16f303=users[_0x22384e(0xf1)];else{if(_0x373605[0x0]['language']=='Spanish')var _0x16f303=users['Spanish'];else{if(_0x373605[0x0][_0x22384e(0x11f)]==_0x22384e(0x19b))var _0x16f303=users[_0x22384e(0x19b)];else{if(_0x373605[0x0][_0x22384e(0x11f)]==_0x22384e(0x143))var _0x16f303=users[_0x22384e(0x142)];else{if(_0x373605[0x0]['language']==_0x22384e(0x1e7))var _0x16f303=users[_0x22384e(0x1e7)];else{if(_0x373605[0x0][_0x22384e(0x11f)]==_0x22384e(0x1fd))var _0x16f303=users[_0x22384e(0x16b)];}}}}}}}const _0x3c623c=getRandom8DigitNumber();_0x3c623c[_0x22384e(0x14e)](_0x562f9e=>{var _0x4dd159=_0x22384e;_0x4cbb1a[_0x4dd159(0x1cf)](_0x4dd159(0x18c),{'success':_0x316a17['flash'](_0x4dd159(0x1fc)),'errors':_0x316a17[_0x4dd159(0x179)](_0x4dd159(0x1d5)),'role':_0x8aa7bd,'profile':_0x423d40,'suppliers':_0x2f1238,'warehouse':_0x58a25e,'product':_0xc123bc,'invoice':_0x562f9e,'master_shop':_0x373605,'language':_0x16f303,'find_data':_0x5cc8f2,'rooms_data':_0x4e5718});})[_0x22384e(0x195)](_0x4a6729=>{var _0x115a6d=_0x22384e;_0x316a17['flash'](_0x115a6d(0x1d5),_0x115a6d(0x1c8)),_0x4cbb1a[_0x115a6d(0x1a4)](_0x115a6d(0x1f6));});}catch(_0x37d48e){console['log'](_0x37d48e);}}),router[a0_0x471c08(0x156)](a0_0x471c08(0x1fb),auth,async(_0x195dd3,_0x478498)=>{var _0x5987bf=a0_0x471c08;try{const _0x502d56=_0x195dd3[_0x5987bf(0xed)]['id'];console['log'](_0x502d56);const _0x38f58c=await master_shop['find']();console['log'](_0x5987bf(0x128),_0x38f58c);const _0x208df8=await product[_0x5987bf(0x174)]({'name':_0x502d56});console['log']('product',_0x208df8),_0x478498[_0x5987bf(0x178)](0xc8)[_0x5987bf(0x1c4)]({'product_data':_0x208df8,'master':_0x38f58c});}catch(_0x97cf8d){console[_0x5987bf(0x127)]('add_purchases\x20error',_0x97cf8d);}}),router[a0_0x471c08(0x17f)](a0_0x471c08(0x12e),auth,async(_0x381bc7,_0x253171)=>{var _0x39683c=a0_0x471c08;try{const {invoice:_0x471faf,date:_0x27ce8b,warehouse_name:_0xbe0e6e,prod_name:_0x28bb19,prod_code:_0x4ad9a3,prod_qty:_0x37ab06,prod_unit:_0xa57802,prod_secondunit:_0x4b8a4f,prod_level:_0x12743a,prod_isle:_0x48b4ea,prod_pallet:_0x5c5f29,note:_0x3d854e,expiry_date:_0x53cebb,batch_code:_0xc410fc,payable:_0x103b0a,due_amount:_0x496c94,Room_name:_0x26f034,primary_code:_0x1d83d2,secondary_code:_0x37231f,MaxStocks_data:_0x510be6,PO_number:_0xae3d74,SCRN:_0x217d52,JO_number:_0x5ab37c}=_0x381bc7['body'];if(typeof _0x28bb19=='string')var _0x590c4e=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x151)]],_0x47f0d6=[_0x381bc7[_0x39683c(0x16d)]['prod_code']],_0x3a4079=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x186)]],_0x1ada33=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x1a0)]],_0x2bb275=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x114)]],_0x24a12c=[_0x381bc7['body'][_0x39683c(0x1d0)]],_0x3c30b1=[_0x381bc7[_0x39683c(0x16d)]['primary_code']],_0x121443=[_0x381bc7['body'][_0x39683c(0x132)]],_0x50c0a2=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x18b)]],_0x3b5af6=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x164)]],_0x1d9941=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0xf5)]],_0x55323a=[_0x381bc7['body']['max_product_unit']],_0x431df8=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x129)]],_0x2c4ca7=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x189)]],_0x217321=[_0x381bc7['body'][_0x39683c(0x1c5)]],_0x5981f8=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x19f)]],_0x3968bd=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x108)]],_0x5ee554=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x15f)]],_0x336bca=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x18e)]],_0x524f25=[_0x381bc7[_0x39683c(0x16d)][_0x39683c(0x1c3)]];else var _0x590c4e=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x151)]],_0x47f0d6=[..._0x381bc7['body'][_0x39683c(0x13c)]],_0x3a4079=[..._0x381bc7['body'][_0x39683c(0x186)]],_0x1ada33=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x1a0)]],_0x2bb275=[..._0x381bc7['body'][_0x39683c(0x114)]],_0x24a12c=[..._0x381bc7[_0x39683c(0x16d)]['prod_level']],_0x3c30b1=[..._0x381bc7['body'][_0x39683c(0x10c)]],_0x121443=[..._0x381bc7[_0x39683c(0x16d)]['secondary_code']],_0x50c0a2=[..._0x381bc7['body'][_0x39683c(0x18b)]],_0x3b5af6=[..._0x381bc7['body'][_0x39683c(0x164)]],_0x1d9941=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0xf5)]],_0x55323a=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x1d4)]],_0x431df8=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x129)]],_0x2c4ca7=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x189)]],_0x217321=[..._0x381bc7[_0x39683c(0x16d)]['prod_cat']],_0x5981f8=[..._0x381bc7['body']['RoomAssign']],_0x3968bd=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x108)]],_0x5ee554=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x15f)]],_0x336bca=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x18e)]],_0x524f25=[..._0x381bc7[_0x39683c(0x16d)][_0x39683c(0x1c3)]];const _0x3ca600=_0x590c4e[_0x39683c(0x1dd)](_0x3d9176=>{return _0x3d9176={'product_name':_0x3d9176};});_0x336bca[_0x39683c(0x209)]((_0x3944d4,_0x5c1e07)=>{var _0x48782c=_0x39683c;_0x3ca600[_0x5c1e07]['actual_qty']=Math[_0x48782c(0x201)](_0x3944d4);}),_0x524f25['forEach']((_0x5a5d09,_0x35bd38)=>{var _0x170051=_0x39683c;_0x3ca600[_0x35bd38][_0x170051(0x1c3)]=_0x5a5d09;}),_0x47f0d6[_0x39683c(0x209)]((_0x31c2db,_0x37214d)=>{_0x3ca600[_0x37214d]['product_code']=_0x31c2db;}),_0x3a4079[_0x39683c(0x209)]((_0x17d96e,_0x25bef0)=>{var _0x4dc8f2=_0x39683c;_0x3ca600[_0x25bef0]['quantity']=Math[_0x4dc8f2(0x201)](_0x17d96e);}),_0x1ada33[_0x39683c(0x209)]((_0x446f9b,_0x426d17)=>{_0x3ca600[_0x426d17]['standard_unit']=_0x446f9b;}),_0x2bb275[_0x39683c(0x209)]((_0x463242,_0x1cd7b7)=>{var _0x25cb75=_0x39683c;_0x3ca600[_0x1cd7b7][_0x25cb75(0x11d)]=_0x463242;}),_0x24a12c[_0x39683c(0x209)]((_0x17682b,_0x9ed446)=>{var _0x2e7009=_0x39683c;_0x5981f8[_0x2e7009(0x209)]((_0x14f8e6,_0x579f57)=>{var _0x11c6db=_0x2e7009;if(_0x14f8e6==_0x11c6db(0x193)&&_0x9ed446==_0x579f57){console[_0x11c6db(0x127)](_0x14f8e6+_0x11c6db(0x1c7)+_0x9ed446+_0x11c6db(0x101)+_0x579f57+_0x11c6db(0x101)+_0x17682b);var _0x421d83=_0x17682b['slice'](0x3);_0x3ca600[_0x9ed446][_0x11c6db(0x187)]=_0x17682b[0x0],_0x3ca600[_0x9ed446][_0x11c6db(0x1e5)]=_0x17682b[0x1],_0x3ca600[_0x9ed446]['bay']=0x0,_0x3ca600[_0x9ed446][_0x11c6db(0x149)]=0x0,_0x3ca600[_0x9ed446][_0x11c6db(0x1df)]=_0x11c6db(0x1c9),_0x3ca600[_0x9ed446][_0x11c6db(0x14a)]=_0x421d83;}else{if(_0x14f8e6==_0x11c6db(0x120)&&_0x9ed446==_0x579f57){var _0x421d83=_0x17682b['slice'](0x3);_0x3ca600[_0x9ed446][_0x11c6db(0x187)]=_0x17682b[0x0],_0x3ca600[_0x9ed446][_0x11c6db(0x1e5)]=_0x17682b[0x1],_0x3ca600[_0x9ed446][_0x11c6db(0x154)]=0x0,_0x3ca600[_0x9ed446][_0x11c6db(0x149)]=0x0,_0x3ca600[_0x9ed446]['type']=_0x11c6db(0x1c9),_0x3ca600[_0x9ed446][_0x11c6db(0x14a)]=_0x17682b[0x5];}else{if(_0x9ed446==_0x579f57){if(_0x17682b[0x0]=='A'&&_0x17682b[0x1]=='L'&&_0x17682b[0x2]=='L')console[_0x11c6db(0x127)](_0x14f8e6+_0x11c6db(0x101)+_0x9ed446+'\x20<>\x20'+_0x579f57+_0x11c6db(0x101)+_0x17682b+_0x11c6db(0x100)),_0x3ca600[_0x9ed446][_0x11c6db(0x187)]=_0x17682b[0x0],_0x3ca600[_0x9ed446][_0x11c6db(0x1e5)]=_0x17682b[0x1],_0x3ca600[_0x9ed446][_0x11c6db(0x154)]=0x0,_0x3ca600[_0x9ed446]['bin']=0x0,_0x3ca600[_0x9ed446][_0x11c6db(0x1df)]=_0x11c6db(0x1c9),_0x3ca600[_0x9ed446]['floorlevel']=_0x17682b[0x3];else{var _0x5084ca;if(_0x17682b[0x4]=='L')_0x5084ca='Level';else _0x17682b[0x4]=='F'&&(_0x5084ca=_0x11c6db(0x1c9));_0x3ca600[_0x9ed446][_0x11c6db(0x187)]=_0x17682b[0x0],_0x3ca600[_0x9ed446][_0x11c6db(0x1e5)]=_0x17682b[0x1],_0x3ca600[_0x9ed446][_0x11c6db(0x154)]=_0x17682b[0x2],_0x3ca600[_0x9ed446]['bin']=_0x17682b[0x3],_0x3ca600[_0x9ed446][_0x11c6db(0x1df)]=_0x5084ca,_0x3ca600[_0x9ed446]['floorlevel']=_0x17682b[0x5];}}}}});}),_0x3c30b1[_0x39683c(0x209)]((_0x14adab,_0x3aefb2)=>{_0x3ca600[_0x3aefb2]['primary_code']=_0x14adab;}),_0x121443[_0x39683c(0x209)]((_0x4636a6,_0x1b5f66)=>{var _0x5f07dd=_0x39683c;_0x3ca600[_0x1b5f66][_0x5f07dd(0x132)]=_0x4636a6;}),_0x50c0a2[_0x39683c(0x209)]((_0x5138ea,_0x14b9dc)=>{_0x3ca600[_0x14b9dc]['maxStocks']=_0x5138ea;}),_0x3b5af6[_0x39683c(0x209)]((_0x139107,_0x7bfd62)=>{var _0x377923=_0x39683c;_0x3ca600[_0x7bfd62][_0x377923(0x164)]=_0x139107;}),_0x1d9941[_0x39683c(0x209)]((_0x508b77,_0x83e847)=>{var _0x4a3b51=_0x39683c;_0x3ca600[_0x83e847][_0x4a3b51(0xf5)]=_0x508b77;}),_0x55323a[_0x39683c(0x209)]((_0x5b9781,_0x55adff)=>{var _0x195619=_0x39683c;_0x3ca600[_0x55adff][_0x195619(0x10f)]=_0x5b9781;}),_0x431df8[_0x39683c(0x209)]((_0x34e4eb,_0x4e9b84)=>{var _0x4b8112=_0x39683c;_0x3ca600[_0x4e9b84][_0x4b8112(0x129)]=_0x34e4eb;}),_0x2c4ca7['forEach']((_0x5c700b,_0x568498)=>{var _0x273ecc=_0x39683c;_0x3ca600[_0x568498][_0x273ecc(0x189)]=_0x5c700b;}),_0x217321[_0x39683c(0x209)]((_0x19c46d,_0x537afa)=>{_0x3ca600[_0x537afa]['product_cat']=_0x19c46d;}),_0x5981f8['forEach']((_0x28587b,_0x34aa1c)=>{var _0x2cb6b3=_0x39683c;_0x3ca600[_0x34aa1c][_0x2cb6b3(0x126)]=_0x28587b;}),_0x3968bd['forEach']((_0x57903d,_0xe93491)=>{_0x3ca600[_0xe93491]['delivery_code']=_0x57903d;}),_0x5ee554['forEach']((_0x2dd128,_0x43d58f)=>{var _0x134a38=_0x39683c;_0x3ca600[_0x43d58f][_0x134a38(0x155)]=_0x2dd128;});const _0x201e03=_0x5981f8[_0x39683c(0x1dd)](_0xd47a7c=>{return _0xd47a7c={'room_name':_0xd47a7c};}),_0x3f0955=_0x3ca600[_0x39683c(0x1f8)](_0x114264=>_0x114264[_0x39683c(0x183)]!=='0'&&_0x114264[_0x39683c(0x183)]!==''),_0x22864f=new purchases({'invoice':_0x471faf,'suppliers':_0x381bc7[_0x39683c(0x16d)][_0x39683c(0xfb)],'date':_0x27ce8b,'warehouse_name':_0xbe0e6e,'product':_0x3f0955,'note':_0x3d854e,'due_amount':_0x496c94,'POnumber':_0xae3d74,'SCRN':_0x217d52,'JO_number':_0x5ab37c,'roomList':_0x201e03}),_0x5782a8=await _0x22864f['save'](),_0x35dc61=await purchases['findOne']({'invoice':_0x471faf}),_0x356018=_0x35dc61[_0x39683c(0x185)][_0x39683c(0x1dd)](async _0x576b1f=>{var _0x533d97=_0x39683c,_0x5cf304=await warehouse[_0x533d97(0x174)]({'name':_0xbe0e6e,'room':_0x576b1f[_0x533d97(0x126)]}),_0x51af70=0x0;return _0x5cf304[_0x533d97(0xff)][_0x533d97(0x209)](_0x48271a=>{var _0x4df104=_0x533d97;_0x48271a['product_name']==_0x576b1f['product_name']&&_0x48271a[_0x4df104(0x14a)]==_0x576b1f[_0x4df104(0x14a)]&&_0x48271a[_0x4df104(0x1df)]==_0x576b1f['type']&&_0x48271a[_0x4df104(0x149)]==_0x576b1f[_0x4df104(0x149)]&&_0x48271a[_0x4df104(0x154)]==_0x576b1f[_0x4df104(0x154)]&&_0x48271a['rack']==_0x576b1f[_0x4df104(0x1e5)]&&_0x48271a[_0x4df104(0x187)]==_0x576b1f['storage']&&_0x48271a['expiry_date']==_0x576b1f[_0x4df104(0xf5)]&&_0x48271a[_0x4df104(0x164)]==_0x576b1f[_0x4df104(0x164)]&&_0x48271a[_0x4df104(0x189)]==_0x576b1f[_0x4df104(0x189)]&&_0x48271a['invoice']==_0x35dc61['invoice']&&(_0x48271a[_0x4df104(0x1f5)]+=Math[_0x4df104(0x201)](_0x576b1f['quantity']),_0x51af70++);}),_0x51af70===0x0&&_0x5cf304[_0x533d97(0xff)][_0x533d97(0x175)]({'product_name':_0x576b1f['product_name'],'product_stock':Math[_0x533d97(0x201)](_0x576b1f['quantity']),'primary_code':_0x576b1f[_0x533d97(0x10c)],'secondary_code':_0x576b1f[_0x533d97(0x132)],'product_code':_0x576b1f['product_code'],'storage':_0x576b1f[_0x533d97(0x187)],'rack':_0x576b1f[_0x533d97(0x1e5)],'bay':_0x576b1f[_0x533d97(0x154)],'bin':_0x576b1f['bin'],'type':_0x576b1f[_0x533d97(0x1df)],'floorlevel':_0x576b1f[_0x533d97(0x14a)],'maxProducts':_0x576b1f[_0x533d97(0x173)],'unit':_0x576b1f[_0x533d97(0x1cc)],'secondary_unit':_0x576b1f['secondary_unit'],'expiry_date':_0x576b1f[_0x533d97(0xf5)],'maxPerUnit':_0x576b1f[_0x533d97(0x10f)],'batch_code':_0x576b1f['batch_code'],'alertQTY':_0x576b1f[_0x533d97(0x129)],'production_date':_0x576b1f[_0x533d97(0x189)],'product_cat':_0x576b1f[_0x533d97(0x11b)],'invoice':_0x576b1f[_0x533d97(0x155)],'actual_qty':Math[_0x533d97(0x201)](_0x576b1f['actual_qty']),'actual_uom':_0x576b1f[_0x533d97(0x1c3)]}),_0x5cf304;});Promise[_0x39683c(0x153)](_0x356018)[_0x39683c(0x14e)](async _0x19ba74=>{var _0x5b2373=_0x39683c;try{for(const _0x14a25e of _0x19ba74){await _0x14a25e[_0x5b2373(0x165)]();}const _0x10cf96=await master_shop[_0x5b2373(0x17b)](),_0x70a81e=await email_settings['findOne'](),_0x3e210d=await supervisor_settings['find']();var _0x319cc8=_0x35dc61[_0x5b2373(0x185)],_0x47106e='',_0x6ecb27;for(_0x6ecb27 in _0x319cc8){_0x47106e+=_0x5b2373(0xf3)+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x206)]+_0x5b2373(0x17e)+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x198)]+_0x5b2373(0x17e)+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x183)]+_0x5b2373(0x17e)+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x1cc)]+'</td>'+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x11d)]+_0x5b2373(0x17e)+_0x5b2373(0x136)+_0x35dc61[_0x5b2373(0x1ce)]+_0x5b2373(0x17e)+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x126)]+_0x5b2373(0x17e)+_0x5b2373(0x136)+_0x319cc8[_0x6ecb27][_0x5b2373(0x187)]+_0x319cc8[_0x6ecb27]['rack']+_0x319cc8[_0x6ecb27][_0x5b2373(0x154)]+_0x319cc8[_0x6ecb27][_0x5b2373(0x149)]+_0x319cc8[_0x6ecb27][_0x5b2373(0x1df)][0x0]+_0x319cc8[_0x6ecb27][_0x5b2373(0x14a)]+_0x5b2373(0x17e),_0x5b2373(0x1b7);}let _0xdd6a41=nodemailer['createTransport']({'host':_0x70a81e[_0x5b2373(0x161)],'port':Number(_0x70a81e[_0x5b2373(0x111)]),'secure':![],'auth':{'user':_0x70a81e[_0x5b2373(0x109)],'pass':_0x70a81e['password']}}),_0x3268e4={'from':_0x70a81e[_0x5b2373(0x109)],'to':_0x3e210d[0x0]['RMSEmail'],'subject':_0x5b2373(0x199),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5b2373(0x1bc)+_0x5b2373(0x181)+_0x10cf96[0x0][_0x5b2373(0x18d)],'cid':_0x5b2373(0x194)}],'html':_0x5b2373(0x172)+'<html><head><title></title>'+_0x5b2373(0x17a)+_0x5b2373(0x1de)+_0x5b2373(0x19a)+'<div>'+_0x5b2373(0x166)+_0x5b2373(0x20a)+_0x5b2373(0x1de)+_0x5b2373(0x1b0)+_0x10cf96[0x0][_0x5b2373(0x10a)]+_0x5b2373(0x1bf)+_0x5b2373(0x20a)+_0x5b2373(0x20a)+'<hr\x20class=\x22my-3\x22>'+_0x5b2373(0x1de)+_0x5b2373(0x1e2)+_0x5b2373(0x1a7)+_0x35dc61[_0x5b2373(0x155)]+'\x20'+_0x5b2373(0x1ef)+_0x5b2373(0x130)+_0x35dc61[_0x5b2373(0x1c1)]+'\x20'+_0x5b2373(0x162)+'</h5>'+'</div>'+_0x5b2373(0x1bd)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5b2373(0xf3)+_0x5b2373(0x1a8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5b2373(0x1d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5b2373(0x16a)+_0x5b2373(0x16c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5b2373(0x11e)+_0x5b2373(0x1b7)+_0x5b2373(0x10d)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x47106e+'\x20'+_0x5b2373(0x188)+_0x5b2373(0x118)+_0x5b2373(0x1de)+_0x5b2373(0x163)+'<h5>'+_0x10cf96[0x0]['site_title']+_0x5b2373(0xe8)+'</div>'+'</div>'+_0x5b2373(0x180)};_0xdd6a41[_0x5b2373(0x190)](_0x3268e4,function(_0x344d0b,_0x55fe28){var _0x43771c=_0x5b2373;_0x344d0b?(console[_0x43771c(0x127)](_0x344d0b),console[_0x43771c(0x127)]('Error\x20Occurs')):console[_0x43771c(0x127)](_0x43771c(0x13f));}),_0x381bc7[_0x5b2373(0x179)](_0x5b2373(0x1fc),_0x5b2373(0x169)),_0x253171[_0x5b2373(0x1a4)](_0x5b2373(0x16e));}catch(_0x416d5b){console['error'](_0x416d5b),_0x253171[_0x5b2373(0x178)](0x1f4)[_0x5b2373(0x1c4)]({'error':_0x5b2373(0x1ed)});}})[_0x39683c(0x195)](_0x3a837e=>{var _0x171082=_0x39683c;console[_0x171082(0x1c2)](_0x3a837e),_0x253171['status'](0x1f4)['json']({'error':_0x171082(0x1ac)});});}catch(_0x50d48a){console[_0x39683c(0x127)](_0x50d48a);}}),router['get'](a0_0x471c08(0x1f2),auth,async(_0x35a711,_0x406ea7)=>{var _0x471d7f=a0_0x471c08;try{const {username:_0x189cc6,email:_0x4dd32c,role:_0x2afb3c}=_0x35a711[_0x471d7f(0x15a)],_0x1385dd=_0x35a711[_0x471d7f(0x15a)],_0x37b816=await profile['findOne']({'email':_0x1385dd[_0x471d7f(0x109)]}),_0x24ec2b=await master_shop[_0x471d7f(0x17b)](),_0x2455e4=_0x35a711[_0x471d7f(0xed)]['id'],_0x27660d=await purchases[_0x471d7f(0x148)](_0x2455e4),_0x3f406d=await warehouse[_0x471d7f(0x1f0)]([{'$match':{'name':_0x27660d['warehouse_name'],'room':_0x27660d[_0x471d7f(0x1e9)]}},{'$unwind':_0x471d7f(0x1a2)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x471d7f(0x160)},'bay':{'$first':_0x471d7f(0x1e3)},'bin':{'$first':_0x471d7f(0x182)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x471d7f(0x14c)},'primary_code':{'$first':_0x471d7f(0x13d)},'secondary_code':{'$first':_0x471d7f(0x1ee)},'product_code':{'$first':_0x471d7f(0x1ae)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x471d7f(0x184)},'expiry_date':{'$first':_0x471d7f(0x12d)}}}]),_0x11eb60=await customer[_0x471d7f(0x17b)]({});let _0x4733bd;if(_0x1385dd[_0x471d7f(0xeb)]==_0x471d7f(0x1c0)){const _0x42733f=await staff[_0x471d7f(0x174)]({'email':_0x1385dd[_0x471d7f(0x109)]});_0x4733bd=await warehouse['aggregate']([{'$match':{'status':_0x471d7f(0xf0),'name':_0x42733f[_0x471d7f(0x1b4)]}},{'$group':{'_id':_0x471d7f(0xfe),'name':{'$first':_0x471d7f(0xfe)}}}]);}else _0x4733bd=await warehouse[_0x471d7f(0x1f0)]([{'$match':{'status':_0x471d7f(0xf0)}},{'$group':{'_id':_0x471d7f(0xfe),'name':{'$first':'$name'}}}]);const _0xafdff5=await product['find']({}),_0x4e2164=await suppliers[_0x471d7f(0x17b)]({}),_0x54be03=BayBinSelected(_0x27660d[_0x471d7f(0x1ce)],_0x27660d['room']);if(_0x24ec2b[0x0][_0x471d7f(0x11f)]==_0x471d7f(0xf4)){var _0xcfd7a6=users['English'];console[_0x471d7f(0x127)](_0xcfd7a6);}else{if(_0x24ec2b[0x0][_0x471d7f(0x11f)]==_0x471d7f(0x135))var _0xcfd7a6=users['Hindi'];else{if(_0x24ec2b[0x0][_0x471d7f(0x11f)]==_0x471d7f(0xf1))var _0xcfd7a6=users['German'];else{if(_0x24ec2b[0x0]['language']==_0x471d7f(0xf6))var _0xcfd7a6=users[_0x471d7f(0xf6)];else{if(_0x24ec2b[0x0]['language']==_0x471d7f(0x19b))var _0xcfd7a6=users[_0x471d7f(0x19b)];else{if(_0x24ec2b[0x0]['language']==_0x471d7f(0x143))var _0xcfd7a6=users[_0x471d7f(0x142)];else{if(_0x24ec2b[0x0][_0x471d7f(0x11f)]==_0x471d7f(0x1e7))var _0xcfd7a6=users[_0x471d7f(0x1e7)];else{if(_0x24ec2b[0x0][_0x471d7f(0x11f)]=='Arabic\x20(ae)')var _0xcfd7a6=users[_0x471d7f(0x16b)];}}}}}}}_0x406ea7['render']('edit_purchases_view',{'success':_0x35a711[_0x471d7f(0x179)](_0x471d7f(0x1fc)),'errors':_0x35a711['flash'](_0x471d7f(0x1d5)),'role':_0x1385dd,'profile':_0x37b816,'customer':_0x11eb60,'warehouse':_0x4733bd,'product':_0x3f406d,'user':_0x27660d,'master_shop':_0x24ec2b,'unit':_0xafdff5,'language':_0xcfd7a6,'suppliers':_0x4e2164,'dataSelected':_0x54be03});}catch(_0x25a2ac){console[_0x471d7f(0x127)](_0x25a2ac);}}),router['post']('/preview/:id',auth,async(_0x4f9adf,_0xb7b769)=>{var _0x4bb4cd=a0_0x471c08;try{const _0x1d306e=_0x4f9adf[_0x4bb4cd(0xed)]['id'],{invoice:_0x220e2e,warehouse_name:_0x2383c0,Room_name:_0x2f9093}=_0x4f9adf[_0x4bb4cd(0x16d)],_0x4f84d0=await warehouse[_0x4bb4cd(0x174)]({'name':_0x2383c0,'room':_0x2f9093}),_0x5d55c8=await purchases[_0x4bb4cd(0x174)]({'invoice':_0x220e2e});_0x5d55c8[_0x4bb4cd(0x185)][_0x4bb4cd(0x209)](_0x152993=>{var _0x2ecb3c=_0x4bb4cd,_0x4ff24e=0x0;const _0x3b7a7e=_0x4f84d0[_0x2ecb3c(0xff)][_0x2ecb3c(0x1dd)](_0x366ea4=>{var _0x249088=_0x2ecb3c;_0x366ea4[_0x249088(0x206)]==_0x152993['product_name']&&_0x366ea4[_0x249088(0x14a)]==_0x152993[_0x249088(0x14a)]&&_0x366ea4[_0x249088(0x1df)]==_0x152993[_0x249088(0x1df)]&&_0x366ea4[_0x249088(0x149)]==_0x152993[_0x249088(0x149)]&&_0x366ea4[_0x249088(0x154)]==_0x152993[_0x249088(0x154)]&&_0x366ea4[_0x249088(0x1e5)]==_0x152993[_0x249088(0x1e5)]&&_0x366ea4['storage']==_0x152993[_0x249088(0x187)]&&_0x366ea4[_0x249088(0xf5)]==_0x152993[_0x249088(0xf5)]&&_0x366ea4[_0x249088(0x164)]==_0x152993[_0x249088(0x164)]&&_0x366ea4['production_date']==_0x152993[_0x249088(0x189)]&&_0x366ea4[_0x249088(0x1fa)]==_0x152993[_0x249088(0x1fa)]&&_0x366ea4['delivery_code']==_0x152993[_0x249088(0x11a)]&&(_0x366ea4[_0x249088(0x1f5)]=parseInt(_0x366ea4['product_stock'])+parseInt(_0x152993['quantity']),_0x4ff24e++);});_0x4ff24e=='0'&&(_0x4f84d0['product_details']=_0x4f84d0[_0x2ecb3c(0xff)][_0x2ecb3c(0x117)]({'product_name':_0x152993['product_name'],'product_stock':_0x152993['quantity'],'primary_code':_0x152993['primary_code'],'secondary_code':_0x152993[_0x2ecb3c(0x132)],'product_code':_0x152993[_0x2ecb3c(0x198)],'storage':_0x152993['storage'],'rack':_0x152993[_0x2ecb3c(0x1e5)],'bay':_0x152993[_0x2ecb3c(0x154)],'bin':_0x152993[_0x2ecb3c(0x149)],'type':_0x152993[_0x2ecb3c(0x1df)],'floorlevel':_0x152993[_0x2ecb3c(0x14a)],'maxProducts':_0x152993[_0x2ecb3c(0x173)],'unit':_0x152993['standard_unit'],'secondary_unit':_0x152993[_0x2ecb3c(0x11d)],'expiry_date':_0x152993[_0x2ecb3c(0xf5)],'maxPerUnit':_0x152993[_0x2ecb3c(0x10f)],'batch_code':_0x152993[_0x2ecb3c(0x164)],'alertQTY':_0x152993[_0x2ecb3c(0x129)],'production_date':_0x152993[_0x2ecb3c(0x189)],'delivery_date':_0x152993[_0x2ecb3c(0x1fa)],'delivery_code':_0x152993[_0x2ecb3c(0x11a)]}));}),await _0x4f84d0[_0x4bb4cd(0x165)](),_0x5d55c8['finalize']=_0x4bb4cd(0x196);const _0x1eda4f=await _0x5d55c8[_0x4bb4cd(0x165)]();_0x4f9adf[_0x4bb4cd(0x179)](_0x4bb4cd(0x1fc),_0x4bb4cd(0xea)),_0xb7b769[_0x4bb4cd(0x1a4)]('/all_purchases/view');}catch(_0x329f9d){console[_0x4bb4cd(0x127)](_0x329f9d);}}),router['get'](a0_0x471c08(0x1e6),auth,async(_0x132d44,_0x40c94f)=>{var _0x11a6f9=a0_0x471c08;try{const {username:_0x2c8b79,email:_0x416b92,role:_0x1c77da}=_0x132d44[_0x11a6f9(0x15a)],_0x194d5d=_0x132d44[_0x11a6f9(0x15a)],_0x46f7e9=await profile['findOne']({'email':_0x194d5d['email']}),_0x3f5ea0=await master_shop[_0x11a6f9(0x17b)](),_0x3c3c9d=_0x132d44[_0x11a6f9(0xed)]['id'],_0x4734ba=await purchases[_0x11a6f9(0x148)](_0x3c3c9d),_0x5d3063=await suppliers[_0x11a6f9(0x17b)]({});let _0x504812;if(_0x194d5d[_0x11a6f9(0xeb)]==_0x11a6f9(0x1c0)){const _0x578cb4=await staff[_0x11a6f9(0x174)]({'email':_0x194d5d[_0x11a6f9(0x109)]});_0x504812=await warehouse[_0x11a6f9(0x17b)]({'status':_0x11a6f9(0xf0),'name':_0x578cb4[_0x11a6f9(0x1b4)],'warehouse_category':_0x11a6f9(0x103)});}else _0x504812=await warehouse[_0x11a6f9(0x1f0)]([{'$match':{'status':_0x11a6f9(0xf0),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x11a6f9(0xfe),'name':{'$first':_0x11a6f9(0xfe)}}}]);const _0x392c1f=await product[_0x11a6f9(0x17b)]({}),_0x397b36=BayBinSelected(_0x4734ba[_0x11a6f9(0x1ce)],_0x4734ba[_0x11a6f9(0x1e9)]);let _0x337989=new Date(_0x4734ba['expiry_date']),_0x330f8=('0'+_0x337989[_0x11a6f9(0x14d)]())['slice'](-0x2),_0x3ac6c4=('0'+(_0x337989[_0x11a6f9(0x1bb)]()+0x1))[_0x11a6f9(0x1d9)](-0x2),_0x23f798=_0x337989[_0x11a6f9(0xe7)](),_0x3cbf3d=_0x23f798+'-'+_0x3ac6c4+'-'+_0x330f8;if(_0x3f5ea0[0x0][_0x11a6f9(0x11f)]==_0x11a6f9(0xf4)){var _0x5b0b9c=users[_0x11a6f9(0x1a5)];console[_0x11a6f9(0x127)](_0x5b0b9c);}else{if(_0x3f5ea0[0x0][_0x11a6f9(0x11f)]==_0x11a6f9(0x135))var _0x5b0b9c=users[_0x11a6f9(0x135)];else{if(_0x3f5ea0[0x0]['language']=='German')var _0x5b0b9c=users[_0x11a6f9(0xf1)];else{if(_0x3f5ea0[0x0]['language']==_0x11a6f9(0xf6))var _0x5b0b9c=users[_0x11a6f9(0xf6)];else{if(_0x3f5ea0[0x0]['language']=='French')var _0x5b0b9c=users[_0x11a6f9(0x19b)];else{if(_0x3f5ea0[0x0][_0x11a6f9(0x11f)]=='Portuguese\x20(BR)')var _0x5b0b9c=users[_0x11a6f9(0x142)];else{if(_0x3f5ea0[0x0][_0x11a6f9(0x11f)]=='Chinese')var _0x5b0b9c=users['Chinese'];else{if(_0x3f5ea0[0x0][_0x11a6f9(0x11f)]==_0x11a6f9(0x1fd))var _0x5b0b9c=users['Arabic'];}}}}}}}_0x40c94f['render'](_0x11a6f9(0x168),{'success':_0x132d44['flash'](_0x11a6f9(0x1fc)),'errors':_0x132d44[_0x11a6f9(0x179)](_0x11a6f9(0x1d5)),'role':_0x194d5d,'profile':_0x46f7e9,'purchases':_0x4734ba,'suppliers':_0x5d3063,'warehouse':_0x504812,'product':_0x392c1f,'master_shop':_0x3f5ea0,'language':_0x5b0b9c,'ed_fullDate':_0x3cbf3d,'dataSelected':_0x397b36});}catch(_0x1de934){console[_0x11a6f9(0x127)](_0x1de934);}}),router[a0_0x471c08(0x17f)](a0_0x471c08(0x1e6),auth,async(_0x28d2b6,_0x42a598)=>{var _0x4aade3=a0_0x471c08;try{const _0x263031=_0x28d2b6[_0x4aade3(0xed)]['id'],_0x110431=await purchases['findOne']({'_id':_0x28d2b6[_0x4aade3(0xed)]['id']}),_0x404013=await warehouse[_0x4aade3(0x174)]({'name':_0x110431['warehouse_name'],'room':_0x110431['room']});_0x110431['product'][_0x4aade3(0x209)](_0x4f5518=>{var _0x167ba6=_0x4aade3;const _0x2ce1e5=_0x404013[_0x167ba6(0xff)][_0x167ba6(0x1dd)](_0x3b4d14=>{var _0x5be54a=_0x167ba6;_0x3b4d14['product_name']==_0x4f5518[_0x5be54a(0x206)]&&_0x3b4d14[_0x5be54a(0x14a)]==_0x4f5518[_0x5be54a(0x14a)]&&_0x3b4d14[_0x5be54a(0x1df)]==_0x4f5518[_0x5be54a(0x1df)]&&_0x3b4d14[_0x5be54a(0x149)]==_0x4f5518['bin']&&_0x3b4d14[_0x5be54a(0x154)]==_0x4f5518[_0x5be54a(0x154)]&&_0x3b4d14[_0x5be54a(0x1e5)]==_0x4f5518[_0x5be54a(0x1e5)]&&_0x3b4d14[_0x5be54a(0x187)]==_0x4f5518[_0x5be54a(0x187)]&&(_0x3b4d14[_0x5be54a(0x1f5)]=parseInt(_0x3b4d14[_0x5be54a(0x1f5)])-parseInt(_0x4f5518['quantity']));});}),await _0x404013[_0x4aade3(0x165)]();const {invoice:_0x1d9b4a,suppliers:_0x4205ff,date:_0x5b82c2,warehouse_name:_0x37de15,prod_name:_0x1b0d66,prod_code:_0xd0197a,prod_qty:_0x1053bc,prod_unit:_0x3581a2,prod_secondunit:_0x624a3d,prod_level:_0x340080,prod_isle:_0x5ebe6a,prod_pallet:_0x17a4fa,note:_0xe1cca1,expiry_date:_0x5c73e5,batch_code:_0xb954ab,paid_amount:_0x29d46b,due_amount:_0x445935,Room_name:_0x423df7,primary_code:_0x1b8d10,secondary_code:_0x3ff2ab,PO_number:_0x3b7afb,JO_number:_0x2ef046}=_0x28d2b6[_0x4aade3(0x16d)];if(typeof _0x1b0d66==_0x4aade3(0x1b5))var _0x460d66=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x151)]],_0x14638d=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x13c)]],_0x3f16fe=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x15e)]],_0x5b75b7=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x12c)]],_0x3c37a4=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x114)]],_0x3126ca=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x1d0)]],_0x575da1=[_0x28d2b6['body'][_0x4aade3(0x13b)]],_0x1691ef=[_0x28d2b6['body'][_0x4aade3(0x131)]],_0x2dd31e=[_0x28d2b6['body'][_0x4aade3(0x10c)]],_0x1318e7=[_0x28d2b6['body'][_0x4aade3(0x132)]],_0x1143c2=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x18b)]],_0x391bbc=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x164)]],_0xdb0aab=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0xf5)]],_0x4e5a40=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x187)]],_0x3ffd48=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x124)]],_0x16c091=[_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x1df)]];else var _0x460d66=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x151)]],_0x14638d=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x13c)]],_0x3f16fe=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x15e)]],_0x5b75b7=[..._0x28d2b6['body'][_0x4aade3(0x12c)]],_0x3c37a4=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x114)]],_0x3126ca=[..._0x28d2b6['body'][_0x4aade3(0x1d0)]],_0x575da1=[..._0x28d2b6[_0x4aade3(0x16d)]['prod_isle']],_0x1691ef=[..._0x28d2b6[_0x4aade3(0x16d)]['prod_pallet']],_0x2dd31e=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x10c)]],_0x1318e7=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x132)]],_0x1143c2=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x18b)]],_0x391bbc=[..._0x28d2b6['body']['batch_code']],_0xdb0aab=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0xf5)]],_0x4e5a40=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x187)]],_0x3ffd48=[..._0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x124)]],_0x16c091=[..._0x28d2b6['body'][_0x4aade3(0x1df)]];const _0x171b5a=_0x460d66[_0x4aade3(0x1dd)](_0x3bd059=>{return _0x3bd059={'product_name':_0x3bd059};});_0x14638d[_0x4aade3(0x209)]((_0x48bc72,_0x193a77)=>{var _0x63901a=_0x4aade3;_0x171b5a[_0x193a77][_0x63901a(0x198)]=_0x48bc72;}),_0x3f16fe[_0x4aade3(0x209)]((_0x245304,_0x1cf89d)=>{_0x171b5a[_0x1cf89d]['quantity']=_0x245304;}),_0x5b75b7[_0x4aade3(0x209)]((_0x23a677,_0x353084)=>{var _0x48c548=_0x4aade3;_0x171b5a[_0x353084][_0x48c548(0x1cc)]=_0x23a677;}),_0x3c37a4[_0x4aade3(0x209)]((_0x18a2bd,_0x926465)=>{var _0x41aaba=_0x4aade3;_0x171b5a[_0x926465][_0x41aaba(0x11d)]=_0x18a2bd;}),_0x3126ca['forEach']((_0x1ed81b,_0x3445ef)=>{var _0x20c3a0=_0x4aade3;_0x171b5a[_0x3445ef][_0x20c3a0(0x154)]=_0x1ed81b;}),_0x575da1['forEach']((_0x34f6b8,_0x193952)=>{_0x171b5a[_0x193952]['bin']=_0x34f6b8;}),_0x1691ef[_0x4aade3(0x209)]((_0x2e140c,_0x510b5b)=>{var _0x5a5181=_0x4aade3;_0x171b5a[_0x510b5b][_0x5a5181(0x14a)]=_0x2e140c;}),_0x2dd31e[_0x4aade3(0x209)]((_0x5a0e62,_0x51d7df)=>{var _0x5621a7=_0x4aade3;_0x171b5a[_0x51d7df][_0x5621a7(0x10c)]=_0x5a0e62;}),_0x1318e7['forEach']((_0x46e3c0,_0x4f9ae2)=>{_0x171b5a[_0x4f9ae2]['secondary_code']=_0x46e3c0;}),_0x1143c2[_0x4aade3(0x209)]((_0x6a2c04,_0x2b2060)=>{var _0x190608=_0x4aade3;_0x171b5a[_0x2b2060][_0x190608(0x173)]=_0x6a2c04;}),_0x391bbc[_0x4aade3(0x209)]((_0x25d4bb,_0x36e0a8)=>{var _0x55c169=_0x4aade3;_0x171b5a[_0x36e0a8][_0x55c169(0x164)]=_0x25d4bb;}),_0xdb0aab['forEach']((_0x5a7e91,_0x5c10a5)=>{_0x171b5a[_0x5c10a5]['expiry_date']=_0x5a7e91;}),_0x16c091[_0x4aade3(0x209)]((_0x4a5280,_0x1b17e2)=>{_0x171b5a[_0x1b17e2]['type']=_0x4a5280;}),_0x4e5a40[_0x4aade3(0x209)]((_0x4ab188,_0x28d6ae)=>{var _0x249953=_0x4aade3;_0x171b5a[_0x28d6ae][_0x249953(0x187)]=_0x4ab188;}),_0x3ffd48['forEach']((_0x41cd4d,_0x3e7a2c)=>{_0x171b5a[_0x3e7a2c]['rack']=_0x41cd4d;});const _0x143b8d=_0x171b5a[_0x4aade3(0x1f8)](_0x50a110=>_0x50a110[_0x4aade3(0x183)]!=='0'&&_0x50a110[_0x4aade3(0x183)]!=='');_0x110431[_0x4aade3(0x155)]=_0x1d9b4a,_0x110431[_0x4aade3(0xfb)]=_0x4205ff,_0x110431[_0x4aade3(0x1c1)]=_0x5b82c2,_0x110431['warehouse_name']=_0x37de15,_0x110431[_0x4aade3(0x185)]=_0x143b8d,_0x110431[_0x4aade3(0x121)]=_0xe1cca1,_0x110431[_0x4aade3(0x144)]=_0x29d46b,_0x110431[_0x4aade3(0xee)]=_0x445935,_0x110431[_0x4aade3(0x1e9)]=_0x423df7,_0x110431['POnumber']=_0x3b7afb,_0x110431[_0x4aade3(0x13a)]=_0x2ef046;const _0x529fb3=await _0x110431[_0x4aade3(0x165)](),_0x2fd205=await warehouse[_0x4aade3(0x174)]({'name':_0x28d2b6[_0x4aade3(0x16d)]['warehouse_name'],'room':_0x28d2b6[_0x4aade3(0x16d)]['Room_name']});_0x110431['product']['forEach'](_0x14fc13=>{var _0x132c31=_0x4aade3,_0x10981f=0x0;const _0x360e45=_0x2fd205[_0x132c31(0xff)]['map'](_0x1cf54d=>{var _0x13b907=_0x132c31;_0x1cf54d[_0x13b907(0x206)]==_0x14fc13[_0x13b907(0x206)]&&_0x1cf54d[_0x13b907(0x14a)]==_0x14fc13[_0x13b907(0x14a)]&&_0x1cf54d[_0x13b907(0x1df)]==_0x14fc13[_0x13b907(0x1df)]&&_0x1cf54d['bin']==_0x14fc13[_0x13b907(0x149)]&&_0x1cf54d[_0x13b907(0x154)]==_0x14fc13[_0x13b907(0x154)]&&_0x1cf54d['rack']==_0x14fc13[_0x13b907(0x1e5)]&&_0x1cf54d[_0x13b907(0x187)]==_0x14fc13[_0x13b907(0x187)]&&(_0x1cf54d[_0x13b907(0x1f5)]=parseInt(_0x1cf54d[_0x13b907(0x1f5)])+parseInt(_0x14fc13[_0x13b907(0x183)]),_0x10981f++);});_0x10981f=='0'&&(_0x2fd205[_0x132c31(0xff)]=_0x2fd205[_0x132c31(0xff)][_0x132c31(0x117)]({'product_name':_0x14fc13[_0x132c31(0x206)],'product_stock':_0x14fc13[_0x132c31(0x183)],'primary_code':_0x14fc13[_0x132c31(0x10c)],'secondary_code':_0x14fc13['secondary_code'],'product_code':_0x14fc13['product_code'],'storage':_0x14fc13[_0x132c31(0x187)],'rack':_0x14fc13['rack'],'bay':_0x14fc13['bay'],'bin':_0x14fc13[_0x132c31(0x149)],'type':_0x14fc13[_0x132c31(0x1df)],'floorlevel':_0x14fc13[_0x132c31(0x14a)],'maxProducts':_0x14fc13[_0x132c31(0x173)],'unit':_0x14fc13[_0x132c31(0x1cc)],'secondary_unit':_0x14fc13['secondary_unit'],'expiry_date':_0x14fc13[_0x132c31(0xf5)]}));}),await _0x2fd205[_0x4aade3(0x165)]();const _0x22792e=await s_payment_data[_0x4aade3(0x174)]({'invoice':_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x155)]});if(_0x22792e===null){}else console[_0x4aade3(0x127)](_0x4aade3(0xfb),_0x22792e,_0x28d2b6[_0x4aade3(0x16d)][_0x4aade3(0x155)]),_0x22792e['suppliers']=_0x28d2b6['body'][_0x4aade3(0xfb)],await _0x22792e[_0x4aade3(0x165)]();_0x28d2b6['flash'](_0x4aade3(0x1fc),_0x4aade3(0xf8)),_0x42a598[_0x4aade3(0x1a4)](_0x4aade3(0x1f6));}catch(_0x564dd6){console[_0x4aade3(0x127)](_0x564dd6);}}),router[a0_0x471c08(0x17f)]('/give_payment/:id',auth,async(_0x4ade36,_0x3c7dfe)=>{var _0x175435=a0_0x471c08;try{const _0x1391e3=_0x4ade36[_0x175435(0xed)]['id'],{invoice:_0x205561,suppliers:_0x37b35b,payable:_0x528d4b,due_amount:_0x478b23}=_0x4ade36[_0x175435(0x16d)],_0x218925=await purchases[_0x175435(0x148)](_0x1391e3);var _0x2c362f=_0x528d4b-_0x478b23;_0x218925[_0x175435(0x144)]=parseFloat(_0x218925[_0x175435(0x144)])+parseFloat(_0x478b23),_0x218925[_0x175435(0xee)]=_0x2c362f;const _0x3cbd85=await _0x218925[_0x175435(0x165)]();console[_0x175435(0x127)](_0x3cbd85);const _0x3789f0=await s_payment_data[_0x175435(0x174)]({'invoice':_0x205561});_0x3789f0[_0x175435(0x157)]=_0x2c362f,await _0x3789f0[_0x175435(0x165)]();let _0xa9e5dc=new Date(),_0x2194ed=('0'+_0xa9e5dc['getDate']())[_0x175435(0x1d9)](-0x2),_0x4f2898=('0'+(_0xa9e5dc[_0x175435(0x1bb)]()+0x1))['slice'](-0x2),_0x259a0b=_0xa9e5dc[_0x175435(0xe7)](),_0x400ae9=_0x259a0b+'-'+_0x4f2898+'-'+_0x2194ed;const _0x2589fc=new suppliers_payment({'invoice':_0x205561,'date':_0x259a0b+'-'+_0x4f2898+'-'+_0x2194ed,'suppliers':_0x37b35b,'reason':_0x175435(0x159),'amount':_0x478b23}),_0x16dfd2=await _0x2589fc[_0x175435(0x165)]();_0x4ade36[_0x175435(0x179)](_0x175435(0x1fc),'payment\x20successfull'),_0x3c7dfe[_0x175435(0x1a4)](_0x175435(0x1f6));}catch(_0x2e902e){console[_0x175435(0x127)](_0x2e902e);}}),router['get'](a0_0x471c08(0x20b),auth,async(_0x2c2cbe,_0x11a678)=>{var _0x54c5af=a0_0x471c08;try{const {username:_0x5d4416,email:_0x254e37,role:_0x313816}=_0x2c2cbe[_0x54c5af(0x15a)],_0x2fda52=_0x2c2cbe['user'],_0x4ffb30=await profile[_0x54c5af(0x174)]({'email':_0x2fda52['email']}),_0x13dd07=await master_shop[_0x54c5af(0x17b)]();console[_0x54c5af(0x127)](_0x54c5af(0x128),_0x13dd07);const _0x1a8d19=_0x2c2cbe[_0x54c5af(0xed)]['id'],_0xc34305=await purchases['findById'](_0x1a8d19);console[_0x54c5af(0x127)](_0xc34305);const _0x166417=await suppliers[_0x54c5af(0x174)]({'name':_0xc34305[_0x54c5af(0xfb)]});console[_0x54c5af(0x127)](_0x166417);if(_0x13dd07[0x0][_0x54c5af(0x11f)]==_0x54c5af(0xf4)){var _0x482991=users['English'];console['log'](_0x482991);}else{if(_0x13dd07[0x0][_0x54c5af(0x11f)]==_0x54c5af(0x135))var _0x482991=users[_0x54c5af(0x135)];else{if(_0x13dd07[0x0][_0x54c5af(0x11f)]==_0x54c5af(0xf1))var _0x482991=users[_0x54c5af(0xf1)];else{if(_0x13dd07[0x0][_0x54c5af(0x11f)]==_0x54c5af(0xf6))var _0x482991=users['Spanish'];else{if(_0x13dd07[0x0]['language']==_0x54c5af(0x19b))var _0x482991=users['French'];else{if(_0x13dd07[0x0][_0x54c5af(0x11f)]=='Portuguese\x20(BR)')var _0x482991=users['Portuguese'];else{if(_0x13dd07[0x0][_0x54c5af(0x11f)]==_0x54c5af(0x1e7))var _0x482991=users[_0x54c5af(0x1e7)];else{if(_0x13dd07[0x0][_0x54c5af(0x11f)]==_0x54c5af(0x1fd))var _0x482991=users[_0x54c5af(0x16b)];}}}}}}}_0x11a678['render'](_0x54c5af(0x122),{'success':_0x2c2cbe['flash']('success'),'errors':_0x2c2cbe['flash'](_0x54c5af(0x1d5)),'role':_0x2fda52,'profile':_0x4ffb30,'master_shop':_0x13dd07,'supplier':_0x166417,'purchase':_0xc34305,'language':_0x482991});}catch(_0x53784e){console[_0x54c5af(0x127)](_0x53784e);}}),router[a0_0x471c08(0x156)](a0_0x471c08(0x1f1),auth,async(_0x50bd06,_0x45272b)=>{var _0x5d6279=a0_0x471c08;try{const {username:_0x349174,email:_0x1f281b,role:_0x28018b}=_0x50bd06[_0x5d6279(0x15a)],_0x2e458a=_0x50bd06[_0x5d6279(0x15a)],_0x2322a6=await profile[_0x5d6279(0x174)]({'email':_0x2e458a[_0x5d6279(0x109)]}),_0x3325da=await master_shop['find']();console[_0x5d6279(0x127)](_0x5d6279(0x128),_0x3325da);const _0x27d769=_0x50bd06[_0x5d6279(0xed)]['id'];console['log'](_0x27d769);const _0x1b55ea=await purchases['findById'](_0x27d769);console[_0x5d6279(0x127)]('user_id',_0x1b55ea);const _0x3534d3=await product['find']({}),_0x135ddb=await warehouse['aggregate']([{'$match':{'name':_0x1b55ea[_0x5d6279(0x1ce)],'room':_0x1b55ea['room'],'warehouse_category':_0x5d6279(0x103)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5d6279(0xef),'name':{'$first':_0x5d6279(0x1ea)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5d6279(0x1e3)},'bin':{'$first':_0x5d6279(0x182)},'type':{'$first':_0x5d6279(0x1c6)},'floorlevel':{'$first':_0x5d6279(0x14c)},'primary_code':{'$first':_0x5d6279(0x13d)},'secondary_code':{'$first':_0x5d6279(0x1ee)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5d6279(0x125)},'rack':{'$first':_0x5d6279(0x184)}}}]);warehouse_data=await warehouse[_0x5d6279(0x1f0)]([{'$match':{'status':_0x5d6279(0xf0),'name':_0x5d6279(0x137),'warehouse_category':_0x5d6279(0x103)}},{'$group':{'_id':_0x5d6279(0xfe),'name':{'$first':_0x5d6279(0xfe)}}},{'$sort':{'name':0x1}}]),console[_0x5d6279(0x127)](_0x5d6279(0x15c),_0x135ddb);if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0xf4)){var _0x41111e=users[_0x5d6279(0x1a5)];console[_0x5d6279(0x127)](_0x41111e);}else{if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0x135))var _0x41111e=users[_0x5d6279(0x135)];else{if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0xf1))var _0x41111e=users['German'];else{if(_0x3325da[0x0]['language']==_0x5d6279(0xf6))var _0x41111e=users[_0x5d6279(0xf6)];else{if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0x19b))var _0x41111e=users[_0x5d6279(0x19b)];else{if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0x143))var _0x41111e=users[_0x5d6279(0x142)];else{if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0x1e7))var _0x41111e=users[_0x5d6279(0x1e7)];else{if(_0x3325da[0x0][_0x5d6279(0x11f)]==_0x5d6279(0x1fd))var _0x41111e=users['Arabic'];}}}}}}}_0x45272b[_0x5d6279(0x1cf)](_0x5d6279(0x197),{'success':_0x50bd06['flash']('success'),'errors':_0x50bd06[_0x5d6279(0x179)](_0x5d6279(0x1d5)),'role':_0x2e458a,'profile':_0x2322a6,'user':_0x1b55ea,'stock':_0x135ddb,'master_shop':_0x3325da,'product':_0x3534d3,'language':_0x41111e,'warehouse':warehouse_data});}catch(_0x2aebde){console[_0x5d6279(0x127)](_0x2aebde);}}),router['post'](a0_0x471c08(0x1f1),auth,async(_0x4c9967,_0x2b0288)=>{var _0xb37a1c=a0_0x471c08;try{const {invoice:_0x28fce0,date:_0x4f021e,warehouse_name:_0x58f681,Room_name:_0x369078,product_name:_0x49f481,purchase_quantity:_0x28fd57,stocks:_0x1b12de,return_qty:_0x35481d,note:_0x3a1106,level:_0x529158,isle:_0x96097c,pallet:_0xf6c947,to_warehouse_name:_0x16ad40,to_Room_name:_0x3e1444}=_0x4c9967[_0xb37a1c(0x16d)],_0xd5796b=await purchases[_0xb37a1c(0x174)]({'_id':_0x4c9967[_0xb37a1c(0xed)]['id']}),_0x38facb=await warehouse['findOne']({'name':_0x58f681,'room':_0x369078});if(typeof _0x49f481=='string')var _0x53f368=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x206)]],_0x800873=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x171)]],_0x42b962=[_0x4c9967[_0xb37a1c(0x16d)]['stocks']],_0x5cb73b=[_0x4c9967[_0xb37a1c(0x16d)]['return_qty']],_0x306877=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x1cd)]],_0xcebda9=[_0x4c9967['body'][_0xb37a1c(0xec)]],_0x7c5217=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x18a)]],_0x3e52dc=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x1e0)]],_0x265464=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x116)]],_0x3cf46e=[_0x4c9967['body'][_0xb37a1c(0x107)]],_0xd0ab6b=[_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x106)]];else var _0x53f368=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x206)]],_0x800873=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x171)]],_0x42b962=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x1a1)]],_0x5cb73b=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x1af)]],_0x306877=[..._0x4c9967[_0xb37a1c(0x16d)]['level']],_0xcebda9=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0xec)]],_0x7c5217=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x18a)]],_0x3e52dc=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x1e0)]],_0x265464=[..._0x4c9967['body'][_0xb37a1c(0x116)]],_0x3cf46e=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x107)]],_0xd0ab6b=[..._0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0x106)]];const _0x2d8fed=_0x53f368['map'](_0x1f2ed7=>{return _0x1f2ed7={'product_name':_0x1f2ed7};});_0x800873[_0xb37a1c(0x209)]((_0x1c2b59,_0x29bec7)=>{var _0x2ba3b1=_0xb37a1c;_0x2d8fed[_0x29bec7][_0x2ba3b1(0x171)]=_0x1c2b59;}),_0x42b962[_0xb37a1c(0x209)]((_0x1b2964,_0x49d62e)=>{var _0x3ebca=_0xb37a1c;_0x2d8fed[_0x49d62e][_0x3ebca(0x16f)]=_0x1b2964;}),_0x5cb73b[_0xb37a1c(0x209)]((_0x2c3234,_0x3587a6)=>{var _0x3a07fd=_0xb37a1c;_0x2d8fed[_0x3587a6][_0x3a07fd(0x1af)]=_0x2c3234;}),_0x306877['forEach']((_0x5df321,_0x31092b)=>{_0x2d8fed[_0x31092b]['bay']=_0x5df321;}),_0xcebda9[_0xb37a1c(0x209)]((_0x5f0a71,_0x57e3c7)=>{var _0x1003ae=_0xb37a1c;_0x2d8fed[_0x57e3c7][_0x1003ae(0x149)]=_0x5f0a71;}),_0x7c5217[_0xb37a1c(0x209)]((_0x9e7957,_0x210afb)=>{var _0x180798=_0xb37a1c;_0x2d8fed[_0x210afb][_0x180798(0x14a)]=_0x9e7957;}),_0x3e52dc[_0xb37a1c(0x209)]((_0x36de37,_0x5bdccb)=>{var _0x1ab2e7=_0xb37a1c;_0x2d8fed[_0x5bdccb][_0x1ab2e7(0x1df)]=_0x36de37;}),_0x265464[_0xb37a1c(0x209)]((_0xfca60f,_0x2a6443)=>{var _0x351446=_0xb37a1c;_0x2d8fed[_0x2a6443][_0x351446(0x198)]=_0xfca60f;}),_0x3cf46e[_0xb37a1c(0x209)]((_0x5d6b3e,_0x42d251)=>{_0x2d8fed[_0x42d251]['primary_code']=_0x5d6b3e;}),_0xd0ab6b['forEach']((_0x4d8060,_0x2060c0)=>{var _0x523625=_0xb37a1c;_0x2d8fed[_0x2060c0][_0x523625(0x132)]=_0x4d8060;}),_0xd5796b[_0xb37a1c(0x185)]['forEach'](_0x4d200a=>{var _0x141763=_0xb37a1c;const _0x359307=_0x38facb[_0x141763(0xff)][_0x141763(0x1dd)](_0x90e918=>{var _0x412c18=_0x141763;_0x90e918['product_name']==_0x4d200a[_0x412c18(0x206)]&&_0x90e918[_0x412c18(0x14a)]==_0x4d200a[_0x412c18(0x14a)]&&_0x90e918['type']==_0x4d200a[_0x412c18(0x1df)]&&_0x90e918[_0x412c18(0x149)]==_0x4d200a['bin']&&_0x90e918[_0x412c18(0x154)]==_0x4d200a['bay']&&_0x90e918[_0x412c18(0x1e5)]==_0x4d200a[_0x412c18(0x1e5)]&&_0x90e918['storage']==_0x4d200a[_0x412c18(0x187)]&&(console['log'](parseInt(_0x90e918['product_stock'])+_0x412c18(0x101)+parseInt(_0x4d200a[_0x412c18(0x183)])),_0x90e918['product_stock']=parseInt(_0x90e918[_0x412c18(0x1f5)])+parseInt(_0x4d200a[_0x412c18(0x183)]));});}),await _0x38facb['save']();const _0x510351=_0x2d8fed[_0xb37a1c(0x1f8)](_0x247acf=>_0x247acf['return_qty']!=='0'&&_0x247acf[_0xb37a1c(0x1af)]!=='');var _0x25afab=0x0;_0x510351[_0xb37a1c(0x209)](_0x528be6=>{var _0x115c0c=_0xb37a1c;console[_0x115c0c(0x127)](_0x115c0c(0x105),_0x528be6),(parseInt(_0x528be6[_0x115c0c(0x171)])<parseInt(_0x528be6[_0x115c0c(0x1af)])||parseInt(_0x528be6[_0x115c0c(0x16f)])<parseInt(_0x528be6[_0x115c0c(0x1af)]))&&_0x25afab++;});if(_0x25afab!=0x0)return _0x4c9967[_0xb37a1c(0x179)]('errors',_0xb37a1c(0x119)),_0x2b0288[_0xb37a1c(0x1a4)](_0xb37a1c(0x134));const _0xe7e04f=new purchases_return({'invoice':_0x28fce0,'suppliers':_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0xfb)],'date':_0x4f021e,'warehouse_name':_0x58f681,'return_product':_0x510351,'note':_0x3a1106,'room':_0x369078,'to_warehouse_name':_0x16ad40,'to_room':_0x3e1444}),_0x23b659=await _0xe7e04f[_0xb37a1c(0x165)]();console[_0xb37a1c(0x127)](_0xe7e04f);const _0x1b1749=await purchases_return[_0xb37a1c(0x174)]({'invoice':_0x28fce0}),_0x4f7ab2=await warehouse['findOne']({'name':_0x16ad40,'room':_0x3e1444});_0x1b1749[_0xb37a1c(0x133)][_0xb37a1c(0x209)](_0x3b2c99=>{var _0x3f9505=_0xb37a1c,_0x580fb7=0x0;const _0x53ca4d=_0x4f7ab2[_0x3f9505(0xff)]['map'](_0x43ef9d=>{var _0x3ae00d=_0x3f9505;_0x43ef9d[_0x3ae00d(0x206)]==_0x3b2c99[_0x3ae00d(0x206)]&&_0x43ef9d[_0x3ae00d(0x14a)]==_0x3b2c99[_0x3ae00d(0x14a)]&&_0x43ef9d[_0x3ae00d(0x1df)]==_0x3b2c99[_0x3ae00d(0x1df)]&&_0x43ef9d[_0x3ae00d(0x149)]==_0x3b2c99[_0x3ae00d(0x149)]&&_0x43ef9d['bay']==_0x3b2c99[_0x3ae00d(0x154)]&&(_0x43ef9d['product_stock']=parseInt(_0x43ef9d[_0x3ae00d(0x1f5)])-parseInt(_0x3b2c99[_0x3ae00d(0x1af)]),_0x580fb7++);});_0x580fb7=='0'&&(_0x4f7ab2[_0x3f9505(0xff)]=_0x4f7ab2['product_details'][_0x3f9505(0x117)]({'product_name':_0x3b2c99[_0x3f9505(0x206)],'product_stock':_0x3b2c99['return_qty'],'primary_code':_0x3b2c99[_0x3f9505(0x10c)],'secondary_code':_0x3b2c99[_0x3f9505(0x132)],'product_code':_0x3b2c99[_0x3f9505(0x198)],'storage':_0x3b2c99['storage'],'rack':_0x3b2c99[_0x3f9505(0x1e5)],'bay':_0x3b2c99['bay'],'bin':_0x3b2c99['bin'],'type':_0x3b2c99[_0x3f9505(0x1df)],'floorlevel':_0x3b2c99[_0x3f9505(0x14a)],'maxProducts':_0x3b2c99[_0x3f9505(0x173)],'unit':_0x3b2c99[_0x3f9505(0x1cc)],'secondary_unit':_0x3b2c99[_0x3f9505(0x11d)],'expiry_date':_0x3b2c99['expiry_date']}));}),await _0x4f7ab2[_0xb37a1c(0x165)]();const _0x50b9eb=await purchases[_0xb37a1c(0x174)]({'invoice':_0x28fce0});_0x50b9eb[_0xb37a1c(0x138)]=_0xb37a1c(0x196);const _0x7c8da4=await _0x50b9eb[_0xb37a1c(0x165)](),_0x5258dd=new s_payment_data({'invoice':_0x28fce0,'suppliers':_0x4c9967[_0xb37a1c(0x16d)][_0xb37a1c(0xfb)],'reason':'Purchase\x20Return'});await _0x5258dd[_0xb37a1c(0x165)]();const _0x5ddddc=await master_shop[_0xb37a1c(0x17b)]();console[_0xb37a1c(0x127)](_0xb37a1c(0x1fe),_0x5ddddc[0x0][_0xb37a1c(0x18d)]);const _0x569cf2=await email_settings['findOne'](),_0x5df80f=await suppliers[_0xb37a1c(0x174)]({'name':_0x4c9967[_0xb37a1c(0x16d)]['suppliers']});console[_0xb37a1c(0x127)](_0xb37a1c(0x1d6),_0x5df80f);_0x5ddddc[0x0][_0xb37a1c(0x191)]==0x1?(right_currency=_0x5ddddc[0x0][_0xb37a1c(0x14f)],left_currency=''):(right_currency='',left_currency=_0x5ddddc[0x0][_0xb37a1c(0x14f)]);var _0x44159b=_0x53f368,_0x4bdd2b=_0x5cb73b,_0x491dfb='',_0x659f82;for(_0x659f82 in _0x44159b){_0x491dfb+=_0xb37a1c(0xf3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44159b[_0x659f82]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bdd2b[_0x659f82]+_0xb37a1c(0x17e)+_0xb37a1c(0x1b7);}console['log'](_0xb37a1c(0x104),_0x491dfb);let _0x479936=nodemailer['createTransport']({'service':_0xb37a1c(0x146),'auth':{'user':_0x569cf2[_0xb37a1c(0x109)],'pass':_0x569cf2['password']}}),_0x110ff8={'from':_0x569cf2[_0xb37a1c(0x109)],'to':_0x5df80f[_0xb37a1c(0x109)],'subject':_0xb37a1c(0x145),'attachments':[{'filename':_0xb37a1c(0x15b),'path':__dirname+_0xb37a1c(0x1bc)+'/upload/'+_0x5ddddc[0x0][_0xb37a1c(0x18d)],'cid':_0xb37a1c(0x194)}],'html':'<!DOCTYPE\x20html>'+_0xb37a1c(0x1e1)+_0xb37a1c(0x17a)+_0xb37a1c(0x1de)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xb37a1c(0x1de)+_0xb37a1c(0x166)+_0xb37a1c(0x20a)+_0xb37a1c(0x1de)+'<h2>\x20'+_0x5ddddc[0x0][_0xb37a1c(0x10a)]+'\x20</h2>'+_0xb37a1c(0x20a)+'</div>'+_0xb37a1c(0x177)+_0xb37a1c(0x1de)+_0xb37a1c(0x1e2)+_0xb37a1c(0x1a7)+_0x28fce0+'\x20'+_0xb37a1c(0x1ef)+_0xb37a1c(0x130)+_0x4f021e+'\x20'+_0xb37a1c(0x162)+_0xb37a1c(0xe8)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xb37a1c(0xf3)+_0xb37a1c(0x1a8)+_0xb37a1c(0x1ad)+_0xb37a1c(0x1eb)+_0xb37a1c(0x203)+_0xb37a1c(0x1b7)+'</thead>'+_0xb37a1c(0x192)+'\x20'+_0x491dfb+'\x20'+_0xb37a1c(0x188)+_0xb37a1c(0x118)+'<div>'+_0xb37a1c(0x163)+'<h5>'+_0x5ddddc[0x0]['site_title']+_0xb37a1c(0xe8)+_0xb37a1c(0x20a)+'</div>'+_0xb37a1c(0x180)};_0x479936[_0xb37a1c(0x190)](_0x110ff8,function(_0x4a6827,_0x350c4a){var _0x36cf1c=_0xb37a1c;_0x4a6827?(console[_0x36cf1c(0x127)](_0x4a6827),console[_0x36cf1c(0x127)]('Error\x20Occurs')):console[_0x36cf1c(0x127)]('Email\x20sent\x20successfully');}),_0x4c9967[_0xb37a1c(0x179)](_0xb37a1c(0x1fc),_0xb37a1c(0x1be)),_0x2b0288[_0xb37a1c(0x1a4)](_0xb37a1c(0x1f6));}catch(_0x287a67){console[_0xb37a1c(0x127)](_0x287a67),_0x2b0288[_0xb37a1c(0x178)](0xc8)['json']({'message':_0x287a67[_0xb37a1c(0x1da)]});}}),router['get'](a0_0x471c08(0x1b1),auth,async(_0x1521b7,_0xcf724f)=>{var _0xd7963b=a0_0x471c08;try{const {username:_0x1873d9,email:_0x50f273,role:_0x3c0aca}=_0x1521b7[_0xd7963b(0x15a)],_0x4359af=_0x1521b7[_0xd7963b(0x15a)],_0x196d74=await profile['findOne']({'email':_0x4359af[_0xd7963b(0x109)]}),_0x55ddae=await master_shop[_0xd7963b(0x17b)](),_0x233129=_0x1521b7[_0xd7963b(0xed)]['id'],_0x602aff=await purchases[_0xd7963b(0x148)](_0x233129);if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0xf4))var _0x42a73c=users[_0xd7963b(0x1a5)];else{if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0x135))var _0x42a73c=users['Hindi'];else{if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0xf1))var _0x42a73c=users[_0xd7963b(0xf1)];else{if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0xf6))var _0x42a73c=users['Spanish'];else{if(_0x55ddae[0x0]['language']==_0xd7963b(0x19b))var _0x42a73c=users[_0xd7963b(0x19b)];else{if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0x143))var _0x42a73c=users[_0xd7963b(0x142)];else{if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0x1e7))var _0x42a73c=users[_0xd7963b(0x1e7)];else{if(_0x55ddae[0x0][_0xd7963b(0x11f)]==_0xd7963b(0x1fd))var _0x42a73c=users['Arabic'];}}}}}}}_0xcf724f['render'](_0xd7963b(0x17c),{'success':_0x1521b7[_0xd7963b(0x179)](_0xd7963b(0x1fc)),'errors':_0x1521b7[_0xd7963b(0x179)]('errors'),'role':_0x4359af,'profile':_0x196d74,'alldata':_0x602aff,'master_shop':_0x55ddae,'language':_0x42a73c}),console[_0xd7963b(0x127)](alldata);}catch(_0x496d32){console[_0xd7963b(0x127)](_0x496d32);}}),router['post']('/barcode_scanner',async(_0x5d08cd,_0x160dfb)=>{var _0x5dfd04=a0_0x471c08;const {product_code:_0x42bde0}=_0x5d08cd[_0x5dfd04(0x16d)];var _0x49d381;const _0x5ebfbf=await product[_0x5dfd04(0x1f0)]([{'$match':{'primary_code':_0x42bde0,'product_category':_0x5dfd04(0x103)}},{'$group':{'_id':_0x5dfd04(0x11c),'name':{'$first':'$name'},'category':{'$first':_0x5dfd04(0x1a6)},'brand':{'$first':_0x5dfd04(0x1b8)},'unit':{'$first':_0x5dfd04(0x205)},'alertquantity':{'$first':_0x5dfd04(0x12a)},'product_code':{'$first':_0x5dfd04(0x10e)},'primary_code':{'$first':_0x5dfd04(0x1dc)},'secondary_code':{'$first':_0x5dfd04(0x1a9)},'maxStocks':{'$first':_0x5dfd04(0x1f3)},'maxProdPerUnit':{'$first':_0x5dfd04(0x12b)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5dfd04(0x208)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3c3210=await product['aggregate']([{'$match':{'secondary_code':_0x42bde0,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x5dfd04(0xfe)},'category':{'$first':'$category'},'brand':{'$first':_0x5dfd04(0x1b8)},'unit':{'$first':_0x5dfd04(0x205)},'alertquantity':{'$first':_0x5dfd04(0x12a)},'product_code':{'$first':_0x5dfd04(0x10e)},'primary_code':{'$first':_0x5dfd04(0x1dc)},'secondary_code':{'$first':_0x5dfd04(0x1a9)},'maxStocks':{'$first':_0x5dfd04(0x1f3)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5dfd04(0x208)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5ebfbf[_0x5dfd04(0x1d2)]>0x0)_0x49d381=_0x5ebfbf;else _0x3c3210[_0x5dfd04(0x1d2)]>0x0&&(_0x49d381=_0x3c3210);_0x160dfb[_0x5dfd04(0x1c4)](_0x49d381);}),router[a0_0x471c08(0x17f)](a0_0x471c08(0x1ff),async(_0x2e9005,_0x1ab603)=>{var _0x27336b=a0_0x471c08;const {primaryCode:_0x3673b1,secondaryCode:_0x11db4e,productCode:_0x405abc,bay:_0x3e59ad,bin:_0x12a27a,types:_0x1d3218,pallet:_0x15d2cf,warehouses:_0xc08595,room:_0x474aef}=_0x2e9005[_0x27336b(0x16d)];console[_0x27336b(0x127)](_0x2e9005[_0x27336b(0x16d)]);try{const _0x265ad1=await warehouse[_0x27336b(0x1f0)]([{'$match':{'name':_0xc08595,'room':_0x474aef}},{'$unwind':_0x27336b(0x1a2)},{'$match':{'product_details.bay':_0x3e59ad,'product_details.bin':_0x12a27a,'product_details.type':_0x1d3218}},{'$group':{'_id':_0x27336b(0xef),'name':{'$first':_0x27336b(0x1ea)},'product_stock':{'$first':_0x27336b(0x160)},'level':{'$first':_0x27336b(0x1b6)},'isle':{'$first':_0x27336b(0xe9)},'pallet':{'$first':_0x27336b(0x1db)},'maxProducts':{'$first':_0x27336b(0x200)}}}]);_0x1ab603[_0x27336b(0x178)](0xc8)[_0x27336b(0x1c4)](_0x265ad1);}catch(_0x35df68){_0x1ab603[_0x27336b(0x178)](0x194)[_0x27336b(0x1c4)]({'message':_0x35df68['message']});}}),module[a0_0x471c08(0x147)]=router;