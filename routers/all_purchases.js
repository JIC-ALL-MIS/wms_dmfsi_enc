function a0_0x2289(){var _0x44b568=['$product_details.product_name','purchase_invoice','$secondary_code','render','Purchase\x20Return','Chinese','product_stock','stock_data','Spanish','$product_details.storage','$invoice','staff','logo','Rack\x20E','$date','/view','prod_name','$product.bin','</body></html>','prod_Qty','<hr\x20class=\x22my-3\x22>','type','string','port','add_purchases\x20error','role','prod_pallet','return_product','standard_unit','error','all_purchases','</thead>','product_code_hide','bay','find','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$batch_code','<tbody\x20style=\x22text-align:\x20center;\x22>','errors','user_id','findById','<!DOCTYPE\x20html>','secondary_code','prod_isle','$category','/view/add_purchases/:id','currency','Arabic','expiry_date','../public/language/languages.json','currency_placement','catch','Arabic\x20(ae)','prod_level','Level','INC-','$return_data','prod_primunit','Logo.png','filter','gmail','Email\x20sent\x20successfully','random','actual_uom','express','Rack\x20D','JO_number','room_name','due_amount','Receiving\x20Area','Purchase\x20Mail','<div>','ejs','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','getMonth','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','rack','/view/add_purchases','toString','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','image','Floor','invoice','\x20<>\x20','321851QzZHty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</td>','$unit','True','stocks','status','/view/return_purchase/:id','maxperunit','maxStocks','body','Enabled','English\x20(US)','delivery_code','$product_details.bay','Return\x20Goods','$expiry_date','</tr>','<h5\x20style=\x22text-align:\x20left;\x22>','<span\x20style=\x22float:\x20right;\x22>','prod_secondunit','</h5>','$secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','rak','</head><body>','language','production_date','/CheckingWarehouse','suppliers_docs','quantity','alertQTY','/barcode_scanner','Shelves','Purchase\x20Return\x20Mail','1815996bzigyh','344838GedxEV','RoomAssign','</tbody>','findOne','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','getFullYear','warehouse_name','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$room','$product.bay','/../public','2691531cFvhGC','\x20Order\x20Date\x20:\x20','$paid_amount','282816GszBJL','$product_details.level','pallet','createTransport','redirect','product','purchase\x20data\x20update\x20successfully','warehouse','batch_code','secondary_unit','path','An\x20error\x20occurred.','$product_details.pallet','forEach','product_cat','Ambient','note','floor','2qHBLFy','date','amount','Rack\x20B','$product_details.product_stock','log','$warehouse_name','Purchase\x20data\x20added\x20successfully','primary_code','$maxProdPerUnit','sendMail','get','json','post','prod_unit','$due_amount','/all_purchases/view','level','length','all','storage','$note','$product.floorlevel','delivery_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','floorlevel','product_details','name','$product_details.product_code','slice','host','return_purchase','$suppliers','prod_code','16PEMYuV','concat','\x20</h2>','aggregate','$product_details','isle','password','$product_details._id','$product.quantity','message','$product_code','<h5>','<strong>\x20Regards\x20</strong>','$product_details.type','nodemailer','Error\x20Occurs','Rack\x20A','$_id','save','Portuguese','flash','$brand','Sales\x20Update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','foreach\x20newproduct','primary_code_hide','params','German','add\x20post','then','$maxStocks','deliverycode','all_purchases_barcode','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','../middleware/auth','types','product_code','249270ngnIqP','RMSEmail','padStart','\x20Order\x20Number\x20:\x20','edit_purchases_view','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','abs','$product_details.expiry_date','$product','/view/:id','stock_quantity','purchase_quantity','prod_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','COLD\x20STORAGE','</span>','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Hindi','138348SqzHYz','<tr>','/invoice/:id','English','bin','suppliers_data','email','actual_qty','French','$product.type','$product_details.primary_code','table\x20page','Enclosed','$product_details.rack','<h2>\x20','Room_name','/upload/','success','return_qty','here','max_product_unit','Paid\x20For\x20Purchase','$suppliers_docs','$alertquantity','prod_invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$primary_code','$product_details.bin','Rack\x20F','Portuguese\x20(BR)','$product_details.secondary_code','master','prod_qty','paid_amount','room','MaxStocks_data','</div>','suppliers','$product_details.maxProducts','secondary_code_hide','map','user','getDate','$finalize','site_title'];a0_0x2289=function(){return _0x44b568;};return a0_0x2289();}var a0_0x536f1a=a0_0x4bc9;(function(_0x301448,_0x2b677e){var _0x420d46=a0_0x4bc9,_0x22cf0e=_0x301448();while(!![]){try{var _0x2557fd=parseInt(_0x420d46(0x25a))/0x1*(-parseInt(_0x420d46(0x17c))/0x2)+parseInt(_0x420d46(0x16a))/0x3+-parseInt(_0x420d46(0x1d6))/0x4+parseInt(_0x420d46(0x1c3))/0x5+parseInt(_0x420d46(0x15a))/0x6+-parseInt(_0x420d46(0x159))/0x7+parseInt(_0x420d46(0x19e))/0x8*(parseInt(_0x420d46(0x167))/0x9);if(_0x2557fd===_0x2b677e)break;else _0x22cf0e['push'](_0x22cf0e['shift']());}catch(_0x3f6720){_0x22cf0e['push'](_0x22cf0e['shift']());}}}(a0_0x2289,0x2ce2b));const express=require(a0_0x536f1a(0x244)),app=express(),router=express[a0_0x536f1a(0x226)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x536f1a(0x1c0)),nodemailer=require(a0_0x536f1a(0x1ac));var ejs=require(a0_0x536f1a(0x24c));const path=require(a0_0x536f1a(0x174)),users=require(a0_0x536f1a(0x235));router[a0_0x536f1a(0x187)](a0_0x536f1a(0x212),auth,async(_0x294ae2,_0x24ae46)=>{var _0x580c7f=a0_0x536f1a;try{const {username:_0x1d170d,email:_0x424f64,role:_0x21b23b}=_0x294ae2['user'],_0x2cccf2=_0x294ae2[_0x580c7f(0x1ff)],_0x5760d0=await profile[_0x580c7f(0x15d)]({'email':_0x2cccf2['email']}),_0x54ec50=await staff[_0x580c7f(0x15d)]({'email':_0x2cccf2[_0x580c7f(0x1dc)]});if(_0x2cccf2[_0x580c7f(0x21c)]=='staff'){const _0x1b43a8=await staff[_0x580c7f(0x15d)]({'email':_0x2cccf2[_0x580c7f(0x1dc)]});}const _0xca50b9=await master_shop['find']();let _0x55856f;if(_0x2cccf2[_0x580c7f(0x21c)]==_0x580c7f(0x20e)){const _0x3afbfe=await staff[_0x580c7f(0x15d)]({'email':_0x2cccf2[_0x580c7f(0x1dc)]});_0x55856f=await purchases[_0x580c7f(0x1a1)]([{'$match':{'warehouse_name':_0x3afbfe[_0x580c7f(0x171)]}},{'$lookup':{'from':_0x580c7f(0x1fb),'localField':_0x580c7f(0x1fb),'foreignField':_0x580c7f(0x197),'as':'suppliers_docs'}},{'$unwind':_0x580c7f(0x1ec)},{'$unwind':_0x580c7f(0x1cb)},{'$group':{'_id':'$_id','invoice':{'$first':_0x580c7f(0x20d)},'suppliers':{'$first':_0x580c7f(0x19c)},'date':{'$first':_0x580c7f(0x211)},'warehouse_name':{'$first':_0x580c7f(0x182)},'room':{'$first':_0x580c7f(0x164)},'product':{'$push':_0x580c7f(0x1cb)},'note':{'$first':_0x580c7f(0x191)},'paid_amount':{'$first':_0x580c7f(0x169)},'due_amount':{'$first':_0x580c7f(0x18b)},'return_data':{'$first':_0x580c7f(0x23c)},'batch_code':{'$first':_0x580c7f(0x228)},'expiry_date':{'$first':_0x580c7f(0x146)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x580c7f(0x214)},'type':{'$addToSet':_0x580c7f(0x1df)},'floorlevel':{'$addToSet':_0x580c7f(0x192)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x55856f=await purchases['aggregate']([{'$lookup':{'from':'suppliers','localField':_0x580c7f(0x1fb),'foreignField':_0x580c7f(0x197),'as':_0x580c7f(0x153)}},{'$unwind':_0x580c7f(0x1ec)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x580c7f(0x20d)},'suppliers':{'$first':_0x580c7f(0x19c)},'date':{'$first':_0x580c7f(0x211)},'warehouse_name':{'$first':_0x580c7f(0x182)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x580c7f(0x1cb)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x580c7f(0x169)},'due_amount':{'$first':_0x580c7f(0x18b)},'return_data':{'$first':_0x580c7f(0x23c)},'batch_code':{'$first':_0x580c7f(0x228)},'expiry_date':{'$first':_0x580c7f(0x146)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x580c7f(0x1a6)},'level':{'$addToSet':_0x580c7f(0x165)},'isle':{'$addToSet':_0x580c7f(0x214)},'type':{'$addToSet':_0x580c7f(0x1df)},'floorlevel':{'$addToSet':_0x580c7f(0x192)},'finalize':{'$first':_0x580c7f(0x201)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xca50b9[0x0][_0x580c7f(0x150)]=='English\x20(US)'){var _0x3b758a=users[_0x580c7f(0x1d9)];console[_0x580c7f(0x181)](_0x3b758a);}else{if(_0xca50b9[0x0]['language']==_0x580c7f(0x1d5))var _0x3b758a=users['Hindi'];else{if(_0xca50b9[0x0]['language']==_0x580c7f(0x1b9))var _0x3b758a=users[_0x580c7f(0x1b9)];else{if(_0xca50b9[0x0][_0x580c7f(0x150)]==_0x580c7f(0x20b))var _0x3b758a=users[_0x580c7f(0x20b)];else{if(_0xca50b9[0x0][_0x580c7f(0x150)]==_0x580c7f(0x1de))var _0x3b758a=users[_0x580c7f(0x1de)];else{if(_0xca50b9[0x0][_0x580c7f(0x150)]==_0x580c7f(0x1f3))var _0x3b758a=users['Portuguese'];else{if(_0xca50b9[0x0]['language']==_0x580c7f(0x208))var _0x3b758a=users[_0x580c7f(0x208)];else{if(_0xca50b9[0x0][_0x580c7f(0x150)]==_0x580c7f(0x238))var _0x3b758a=users['Arabic'];}}}}}}}_0x24ae46[_0x580c7f(0x206)](_0x580c7f(0x221),{'success':_0x294ae2[_0x580c7f(0x1b2)](_0x580c7f(0x1e7)),'errors':_0x294ae2[_0x580c7f(0x1b2)](_0x580c7f(0x22a)),'purchases':_0x55856f,'role':_0x2cccf2,'profile':_0x5760d0,'master_shop':_0xca50b9,'language':_0x3b758a});}catch(_0x40c401){console[_0x580c7f(0x181)](_0x580c7f(0x1e1),_0x40c401),_0x24ae46[_0x580c7f(0x13c)](0xc8)[_0x580c7f(0x188)]({'message':_0x40c401[_0x580c7f(0x1a7)]});}});function a0_0x4bc9(_0x436abf,_0xb6e5bb){var _0x228942=a0_0x2289();return a0_0x4bc9=function(_0x4bc93b,_0x4afae9){_0x4bc93b=_0x4bc93b-0x13c;var _0x20dc7d=_0x228942[_0x4bc93b];return _0x20dc7d;},a0_0x4bc9(_0x436abf,_0xb6e5bb);}function BayBinSelected(_0x474fb2,_0x153fe5){var _0x4543ab=a0_0x536f1a,_0x272364=[],_0x5d07fb=[],_0x265279=[],_0x1a1c13=[],_0x3e7a86=[],_0x5a8971=[];let _0x371d30=[];if(_0x474fb2=='DRY\x20STORAGE')switch(_0x153fe5){case _0x4543ab(0x1ae):_0x272364=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5d07fb=[0x1,0x2],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=[_0x4543ab(0x23a),_0x4543ab(0x257)],_0x3e7a86=['D'],_0x5a8971=['A'];break;case'Rack\x20B':_0x272364=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5d07fb=[0x1,0x2],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=[_0x4543ab(0x23a),_0x4543ab(0x257)],_0x3e7a86=['D'],_0x5a8971=['B'];break;case _0x4543ab(0x157):_0x272364=[0x0],_0x5d07fb=[0x0],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=['Floor'],_0x3e7a86=['D'],_0x5a8971=['S'];break;case _0x4543ab(0x249):_0x272364=[0x0],_0x5d07fb=[0x0],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x265279=['Floor'],_0x3e7a86=['D'],_0x5a8971=['R'];break;}else{if(_0x474fb2==_0x4543ab(0x1d1))switch(_0x153fe5){case _0x4543ab(0x1ae):_0x272364=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5d07fb=['B','F'],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=[_0x4543ab(0x23a),_0x4543ab(0x257)],_0x3e7a86=['C'],_0x5a8971=['A'];break;case _0x4543ab(0x17f):_0x272364=[0x5,0x4,0x3,0x2,0x1],_0x5d07fb=['F','B','S'],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=['Level',_0x4543ab(0x257)],_0x3e7a86=['C'],_0x5a8971=['B'];break;case'Rack\x20C':_0x272364=[0x1,0x2,0x3,0x4,0x5],_0x5d07fb=['B','F','S'],_0x1a1c13=[0x5,0x4,0x3,0x2,0x1],_0x265279=[_0x4543ab(0x23a),_0x4543ab(0x257)],_0x3e7a86=['C'],_0x5a8971=['C'];break;case _0x4543ab(0x245):_0x272364=[0x5,0x4,0x3,0x2,0x1],_0x5d07fb=['F','B','S'],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=[_0x4543ab(0x23a),_0x4543ab(0x257)],_0x3e7a86=['C'],_0x5a8971=['D'];break;case _0x4543ab(0x210):_0x272364=[0x4,0x3,0x2,0x1],_0x5d07fb=[0x1,0x2],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=[_0x4543ab(0x23a),'Floor'],_0x3e7a86=['C'],_0x5a8971=['E'];break;case _0x4543ab(0x1f2):_0x272364=[0x1,0x2,0x3],_0x5d07fb=[0x1,0x2],_0x1a1c13=[0x1,0x2,0x3,0x4,0x5],_0x265279=[_0x4543ab(0x23a)],_0x3e7a86=['C'],_0x5a8971=['F'];break;}}return{'levels':_0x272364,'Isle':_0x5d07fb,'rack':_0x1a1c13,'type':_0x265279,'storage':_0x3e7a86,'rak':_0x5a8971};}async function getRandom8DigitNumber(){var _0xa76dc=a0_0x536f1a;const _0x46bf09=0x989680,_0x56e5ad=0x5f5e0ff,_0x13fcf2=Math[_0xa76dc(0x17b)](Math[_0xa76dc(0x242)]()*(_0x56e5ad-_0x46bf09+0x1))+_0x46bf09;var _0x4e37b3;const _0x1fce04=await purchases[_0xa76dc(0x15d)]({'invoice':'INC-'+_0x13fcf2});return _0x1fce04&&_0x1fce04[_0xa76dc(0x18e)]>0x0?_0x4e37b3=_0xa76dc(0x23b)+_0x13fcf2:_0x4e37b3=_0xa76dc(0x23b)+_0x13fcf2,_0x4e37b3;}router[a0_0x536f1a(0x187)]('/view/add_purchases',auth,async(_0x5cc188,_0x5484d7)=>{var _0x16a9cd=a0_0x536f1a;try{const {username:_0x4ea7b4,email:_0x22a5e0,role:_0x350ed5}=_0x5cc188[_0x16a9cd(0x1ff)],_0x275e5d=_0x5cc188[_0x16a9cd(0x1ff)],_0x58d253=await profile[_0x16a9cd(0x15d)]({'email':_0x275e5d[_0x16a9cd(0x1dc)]}),_0x4a4b30=await master_shop['find'](),_0x29f2a9=await staff[_0x16a9cd(0x15d)]({'email':_0x275e5d[_0x16a9cd(0x1dc)]}),_0x5ac05e=await suppliers[_0x16a9cd(0x225)]({});let _0x328e59;if(_0x275e5d[_0x16a9cd(0x21c)]==_0x16a9cd(0x20e)){const _0x3faaaa=await staff[_0x16a9cd(0x15d)]({'email':_0x275e5d[_0x16a9cd(0x1dc)]});_0x328e59=await warehouse['aggregate']([{'$match':{'status':_0x16a9cd(0x141),'name':_0x3faaaa[_0x16a9cd(0x171)],'warehouse_category':_0x16a9cd(0x15e),'name':{'$ne':_0x16a9cd(0x145)}}},{'$group':{'_id':_0x16a9cd(0x162),'name':{'$first':_0x16a9cd(0x162)}}}]);}else _0x328e59=await warehouse[_0x16a9cd(0x1a1)]([{'$match':{'status':_0x16a9cd(0x141),'warehouse_category':_0x16a9cd(0x15e),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x16a9cd(0x162),'name':{'$first':'$name'}}}]);const _0x270d65=await product[_0x16a9cd(0x225)]({}),_0x1534e9=await warehouse[_0x16a9cd(0x225)]({'status':_0x16a9cd(0x141)}),_0x34d655=await purchases['find']({}),_0x307a77=_0x34d655[_0x16a9cd(0x18e)]+0x1,_0xbb3cd2=_0x16a9cd(0x23b)+_0x307a77[_0x16a9cd(0x254)]()[_0x16a9cd(0x1c5)](0x5,'0');var _0x43dd6f=[_0x16a9cd(0x179),_0x16a9cd(0x1e2)];if(_0x4a4b30[0x0]['language']==_0x16a9cd(0x142))var _0xc6f42c=users[_0x16a9cd(0x1d9)];else{if(_0x4a4b30[0x0][_0x16a9cd(0x150)]==_0x16a9cd(0x1d5))var _0xc6f42c=users['Hindi'];else{if(_0x4a4b30[0x0]['language']=='German')var _0xc6f42c=users[_0x16a9cd(0x1b9)];else{if(_0x4a4b30[0x0][_0x16a9cd(0x150)]==_0x16a9cd(0x20b))var _0xc6f42c=users[_0x16a9cd(0x20b)];else{if(_0x4a4b30[0x0][_0x16a9cd(0x150)]==_0x16a9cd(0x1de))var _0xc6f42c=users[_0x16a9cd(0x1de)];else{if(_0x4a4b30[0x0][_0x16a9cd(0x150)]=='Portuguese\x20(BR)')var _0xc6f42c=users[_0x16a9cd(0x1b1)];else{if(_0x4a4b30[0x0][_0x16a9cd(0x150)]==_0x16a9cd(0x208))var _0xc6f42c=users[_0x16a9cd(0x208)];else{if(_0x4a4b30[0x0][_0x16a9cd(0x150)]==_0x16a9cd(0x238))var _0xc6f42c=users['Arabic'];}}}}}}}const _0x51b42b=getRandom8DigitNumber();_0x51b42b[_0x16a9cd(0x1bb)](_0x11b3d8=>{var _0x2b0500=_0x16a9cd;_0x5484d7[_0x2b0500(0x206)]('add_purchases',{'success':_0x5cc188[_0x2b0500(0x1b2)](_0x2b0500(0x1e7)),'errors':_0x5cc188[_0x2b0500(0x1b2)]('errors'),'role':_0x275e5d,'profile':_0x58d253,'suppliers':_0x5ac05e,'warehouse':_0x328e59,'product':_0x270d65,'invoice':_0x11b3d8,'master_shop':_0x4a4b30,'language':_0xc6f42c,'find_data':_0x1534e9,'rooms_data':_0x43dd6f});})[_0x16a9cd(0x237)](_0xf640ed=>{var _0x333571=_0x16a9cd;_0x5cc188[_0x333571(0x1b2)](_0x333571(0x22a),_0x333571(0x250)),_0x5484d7[_0x333571(0x16e)](_0x333571(0x18c));});}catch(_0x54245e){console[_0x16a9cd(0x181)](_0x54245e);}}),router[a0_0x536f1a(0x187)](a0_0x536f1a(0x231),auth,async(_0x37228f,_0x33cad7)=>{var _0x5c5c7b=a0_0x536f1a;try{const _0x43b5e7=_0x37228f[_0x5c5c7b(0x1b8)]['id'];console['log'](_0x43b5e7);const _0x322ee6=await master_shop[_0x5c5c7b(0x225)]();console[_0x5c5c7b(0x181)](_0x5c5c7b(0x1f5),_0x322ee6);const _0xb206e2=await product[_0x5c5c7b(0x15d)]({'name':_0x43b5e7});console['log'](_0x5c5c7b(0x16f),_0xb206e2),_0x33cad7['status'](0xc8)[_0x5c5c7b(0x188)]({'product_data':_0xb206e2,'master':_0x322ee6});}catch(_0x4d534b){console[_0x5c5c7b(0x181)](_0x5c5c7b(0x21b),_0x4d534b);}}),router[a0_0x536f1a(0x189)](a0_0x536f1a(0x253),auth,async(_0x6d89d3,_0x14ccf2)=>{var _0x3f9366=a0_0x536f1a;try{const {invoice:_0x2fc92a,date:_0x14ecec,warehouse_name:_0x871d41,prod_name:_0x3963a2,prod_code:_0x5421b7,prod_qty:_0x2fcc42,prod_unit:_0x51a986,prod_secondunit:_0x4da669,prod_level:_0x496ad3,prod_isle:_0x2b886a,prod_pallet:_0x53359d,note:_0x44ea34,expiry_date:_0x4e7546,batch_code:_0x107691,payable:_0x1ae94e,due_amount:_0x55fd6e,Room_name:_0x5e263a,primary_code:_0x245aea,secondary_code:_0x230bfc,MaxStocks_data:_0x2a24d3,PO_number:_0x5b6b60,SCRN:_0x275c6b,JO_number:_0x26a6bf}=_0x6d89d3['body'];if(typeof _0x3963a2==_0x3f9366(0x219))var _0x203693=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x213)]],_0x11cc3d=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x19d)]],_0x2886dd=[_0x6d89d3['body'][_0x3f9366(0x216)]],_0x58e009=[_0x6d89d3['body'][_0x3f9366(0x23d)]],_0x44dec0=[_0x6d89d3[_0x3f9366(0x140)]['prod_secondunit']],_0x2983c3=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x239)]],_0x2b9bda=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x184)]],_0x161ae9=[_0x6d89d3['body'][_0x3f9366(0x22e)]],_0x3f00dd=[_0x6d89d3['body'][_0x3f9366(0x1f9)]],_0x2541d7=[_0x6d89d3[_0x3f9366(0x140)]['batch_code']],_0x3beb48=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x234)]],_0x57e92e=[_0x6d89d3['body'][_0x3f9366(0x1ea)]],_0x18a116=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x155)]],_0x56470d=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x151)]],_0x4ed0d2=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1cf)]],_0x5059a4=[_0x6d89d3['body'][_0x3f9366(0x15b)]],_0x4f031b=[_0x6d89d3['body'][_0x3f9366(0x1bd)]],_0x3c3b0f=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1ee)]],_0x4ab7ff=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1dd)]],_0x401326=[_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x243)]];else var _0x203693=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x213)]],_0x11cc3d=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x19d)]],_0x2886dd=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x216)]],_0x58e009=[..._0x6d89d3[_0x3f9366(0x140)]['prod_primunit']],_0x44dec0=[..._0x6d89d3['body'][_0x3f9366(0x14a)]],_0x2983c3=[..._0x6d89d3[_0x3f9366(0x140)]['prod_level']],_0x2b9bda=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x184)]],_0x161ae9=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x22e)]],_0x3f00dd=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1f9)]],_0x2541d7=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x172)]],_0x3beb48=[..._0x6d89d3['body']['expiry_date']],_0x57e92e=[..._0x6d89d3[_0x3f9366(0x140)]['max_product_unit']],_0x18a116=[..._0x6d89d3['body'][_0x3f9366(0x155)]],_0x56470d=[..._0x6d89d3[_0x3f9366(0x140)]['production_date']],_0x4ed0d2=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1cf)]],_0x5059a4=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x15b)]],_0x4f031b=[..._0x6d89d3[_0x3f9366(0x140)]['deliverycode']],_0x3c3b0f=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1ee)]],_0x4ab7ff=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1dd)]],_0x401326=[..._0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x243)]];const _0xc63e46=_0x203693[_0x3f9366(0x1fe)](_0x1bf7e3=>{return _0x1bf7e3={'product_name':_0x1bf7e3};});_0x4ab7ff[_0x3f9366(0x177)]((_0x5ea3f3,_0x1236d1)=>{var _0x40aa78=_0x3f9366;_0xc63e46[_0x1236d1][_0x40aa78(0x1dd)]=Math[_0x40aa78(0x1c9)](_0x5ea3f3);}),_0x401326[_0x3f9366(0x177)]((_0x4fe237,_0x4120c9)=>{var _0x5db085=_0x3f9366;_0xc63e46[_0x4120c9][_0x5db085(0x243)]=_0x4fe237;}),_0x11cc3d[_0x3f9366(0x177)]((_0x2392f0,_0x15862d)=>{var _0x2705e2=_0x3f9366;_0xc63e46[_0x15862d][_0x2705e2(0x1c2)]=_0x2392f0;}),_0x2886dd[_0x3f9366(0x177)]((_0x4cc15b,_0x7aac19)=>{var _0x526976=_0x3f9366;_0xc63e46[_0x7aac19][_0x526976(0x154)]=Math['abs'](_0x4cc15b);}),_0x58e009[_0x3f9366(0x177)]((_0x562c5a,_0x251fa4)=>{_0xc63e46[_0x251fa4]['standard_unit']=_0x562c5a;}),_0x44dec0['forEach']((_0x471bae,_0x199996)=>{var _0x1bfacb=_0x3f9366;_0xc63e46[_0x199996][_0x1bfacb(0x173)]=_0x471bae;}),_0x2983c3[_0x3f9366(0x177)]((_0x2aa5b5,_0x4a4ceb)=>{var _0x261627=_0x3f9366;_0x5059a4[_0x261627(0x177)]((_0x2acc88,_0x4ec449)=>{var _0x59c917=_0x261627;if(_0x2acc88==_0x59c917(0x249)&&_0x4a4ceb==_0x4ec449){console[_0x59c917(0x181)](_0x2acc88+'\x20<\x20wew\x20>\x20'+_0x4a4ceb+_0x59c917(0x259)+_0x4ec449+'\x20<>\x20'+_0x2aa5b5);var _0x1f600c=_0x2aa5b5['slice'](0x3);_0xc63e46[_0x4a4ceb][_0x59c917(0x190)]=_0x2aa5b5[0x0],_0xc63e46[_0x4a4ceb][_0x59c917(0x252)]=_0x2aa5b5[0x1],_0xc63e46[_0x4a4ceb][_0x59c917(0x224)]=0x0,_0xc63e46[_0x4a4ceb][_0x59c917(0x1da)]=0x0,_0xc63e46[_0x4a4ceb][_0x59c917(0x218)]='Floor',_0xc63e46[_0x4a4ceb][_0x59c917(0x195)]=_0x1f600c;}else{if(_0x2acc88=='Shelves'&&_0x4a4ceb==_0x4ec449){var _0x1f600c=_0x2aa5b5['slice'](0x3);_0xc63e46[_0x4a4ceb][_0x59c917(0x190)]=_0x2aa5b5[0x0],_0xc63e46[_0x4a4ceb][_0x59c917(0x252)]=_0x2aa5b5[0x1],_0xc63e46[_0x4a4ceb][_0x59c917(0x224)]=0x0,_0xc63e46[_0x4a4ceb]['bin']=0x0,_0xc63e46[_0x4a4ceb]['type']=_0x59c917(0x257),_0xc63e46[_0x4a4ceb]['floorlevel']=_0x2aa5b5[0x5];}else{if(_0x4a4ceb==_0x4ec449){if(_0x2aa5b5[0x0]=='A'&&_0x2aa5b5[0x1]=='L'&&_0x2aa5b5[0x2]=='L')console['log'](_0x2acc88+_0x59c917(0x259)+_0x4a4ceb+_0x59c917(0x259)+_0x4ec449+_0x59c917(0x259)+_0x2aa5b5+_0x59c917(0x1e9)),_0xc63e46[_0x4a4ceb][_0x59c917(0x190)]=_0x2aa5b5[0x0],_0xc63e46[_0x4a4ceb][_0x59c917(0x252)]=_0x2aa5b5[0x1],_0xc63e46[_0x4a4ceb]['bay']=0x0,_0xc63e46[_0x4a4ceb][_0x59c917(0x1da)]=0x0,_0xc63e46[_0x4a4ceb]['type']='Floor',_0xc63e46[_0x4a4ceb]['floorlevel']=_0x2aa5b5[0x3];else{var _0x4207cc;if(_0x2aa5b5[0x4]=='L')_0x4207cc=_0x59c917(0x23a);else _0x2aa5b5[0x4]=='F'&&(_0x4207cc='Floor');_0xc63e46[_0x4a4ceb][_0x59c917(0x190)]=_0x2aa5b5[0x0],_0xc63e46[_0x4a4ceb][_0x59c917(0x252)]=_0x2aa5b5[0x1],_0xc63e46[_0x4a4ceb]['bay']=_0x2aa5b5[0x2],_0xc63e46[_0x4a4ceb]['bin']=_0x2aa5b5[0x3],_0xc63e46[_0x4a4ceb][_0x59c917(0x218)]=_0x4207cc,_0xc63e46[_0x4a4ceb][_0x59c917(0x195)]=_0x2aa5b5[0x5];}}}}});}),_0x2b9bda['forEach']((_0x2ac4a4,_0x3ee013)=>{_0xc63e46[_0x3ee013]['primary_code']=_0x2ac4a4;}),_0x161ae9[_0x3f9366(0x177)]((_0x3590d6,_0x42ea75)=>{var _0x8a7784=_0x3f9366;_0xc63e46[_0x42ea75][_0x8a7784(0x22e)]=_0x3590d6;}),_0x3f00dd[_0x3f9366(0x177)]((_0x36842a,_0x19c461)=>{var _0x50dfa0=_0x3f9366;_0xc63e46[_0x19c461][_0x50dfa0(0x13f)]=_0x36842a;}),_0x2541d7[_0x3f9366(0x177)]((_0x196589,_0x4105c3)=>{var _0x50d344=_0x3f9366;_0xc63e46[_0x4105c3][_0x50d344(0x172)]=_0x196589;}),_0x3beb48[_0x3f9366(0x177)]((_0x53b2f8,_0xbc7176)=>{var _0x3c4788=_0x3f9366;_0xc63e46[_0xbc7176][_0x3c4788(0x234)]=_0x53b2f8;}),_0x57e92e[_0x3f9366(0x177)]((_0x42dbc1,_0x53c2fa)=>{_0xc63e46[_0x53c2fa]['maxperunit']=_0x42dbc1;}),_0x18a116[_0x3f9366(0x177)]((_0x17162e,_0x1dc93f)=>{var _0x4d10ca=_0x3f9366;_0xc63e46[_0x1dc93f][_0x4d10ca(0x155)]=_0x17162e;}),_0x56470d[_0x3f9366(0x177)]((_0x13751,_0x1288d6)=>{var _0x32f1e5=_0x3f9366;_0xc63e46[_0x1288d6][_0x32f1e5(0x151)]=_0x13751;}),_0x4ed0d2[_0x3f9366(0x177)]((_0x253f80,_0x136d1c)=>{var _0x1d0fbb=_0x3f9366;_0xc63e46[_0x136d1c][_0x1d0fbb(0x178)]=_0x253f80;}),_0x5059a4[_0x3f9366(0x177)]((_0x58c3eb,_0x5a63c6)=>{_0xc63e46[_0x5a63c6]['room_name']=_0x58c3eb;}),_0x4f031b[_0x3f9366(0x177)]((_0x17734d,_0x48671d)=>{_0xc63e46[_0x48671d]['delivery_code']=_0x17734d;}),_0x3c3b0f['forEach']((_0x4b1ef5,_0x519ba6)=>{var _0x5ab76a=_0x3f9366;_0xc63e46[_0x519ba6][_0x5ab76a(0x258)]=_0x4b1ef5;});const _0x1d0240=_0x5059a4[_0x3f9366(0x1fe)](_0x2d22a3=>{return _0x2d22a3={'room_name':_0x2d22a3};}),_0x356ebb=_0xc63e46[_0x3f9366(0x23f)](_0x30519=>_0x30519[_0x3f9366(0x154)]!=='0'&&_0x30519[_0x3f9366(0x154)]!==''),_0x313219=new purchases({'invoice':_0x2fc92a,'suppliers':_0x6d89d3[_0x3f9366(0x140)][_0x3f9366(0x1fb)],'date':_0x14ecec,'warehouse_name':_0x871d41,'product':_0x356ebb,'note':_0x44ea34,'due_amount':_0x55fd6e,'POnumber':_0x5b6b60,'SCRN':_0x275c6b,'JO_number':_0x26a6bf,'roomList':_0x1d0240}),_0x556f9b=await _0x313219['save'](),_0x24f805=await purchases[_0x3f9366(0x15d)]({'invoice':_0x2fc92a}),_0x5b6094=_0x24f805['product'][_0x3f9366(0x1fe)](async _0x57c5b8=>{var _0x38f4d7=_0x3f9366,_0x3ee7ff=await warehouse[_0x38f4d7(0x15d)]({'name':_0x871d41,'room':_0x57c5b8['room_name']}),_0xec9d02=0x0;return _0x3ee7ff['product_details'][_0x38f4d7(0x177)](_0x57a2d2=>{var _0x4673ec=_0x38f4d7;_0x57a2d2[_0x4673ec(0x24d)]==_0x57c5b8[_0x4673ec(0x24d)]&&_0x57a2d2[_0x4673ec(0x195)]==_0x57c5b8[_0x4673ec(0x195)]&&_0x57a2d2['type']==_0x57c5b8['type']&&_0x57a2d2[_0x4673ec(0x1da)]==_0x57c5b8['bin']&&_0x57a2d2[_0x4673ec(0x224)]==_0x57c5b8[_0x4673ec(0x224)]&&_0x57a2d2['rack']==_0x57c5b8[_0x4673ec(0x252)]&&_0x57a2d2[_0x4673ec(0x190)]==_0x57c5b8[_0x4673ec(0x190)]&&_0x57a2d2[_0x4673ec(0x234)]==_0x57c5b8['expiry_date']&&_0x57a2d2[_0x4673ec(0x172)]==_0x57c5b8['batch_code']&&_0x57a2d2['production_date']==_0x57c5b8[_0x4673ec(0x151)]&&_0x57a2d2[_0x4673ec(0x258)]==_0x24f805[_0x4673ec(0x258)]&&(_0x57a2d2[_0x4673ec(0x209)]+=Math[_0x4673ec(0x1c9)](_0x57c5b8['quantity']),_0xec9d02++);}),_0xec9d02===0x0&&_0x3ee7ff[_0x38f4d7(0x196)]['push']({'product_name':_0x57c5b8[_0x38f4d7(0x24d)],'product_stock':Math[_0x38f4d7(0x1c9)](_0x57c5b8[_0x38f4d7(0x154)]),'primary_code':_0x57c5b8[_0x38f4d7(0x184)],'secondary_code':_0x57c5b8[_0x38f4d7(0x22e)],'product_code':_0x57c5b8['product_code'],'storage':_0x57c5b8[_0x38f4d7(0x190)],'rack':_0x57c5b8[_0x38f4d7(0x252)],'bay':_0x57c5b8[_0x38f4d7(0x224)],'bin':_0x57c5b8['bin'],'type':_0x57c5b8[_0x38f4d7(0x218)],'floorlevel':_0x57c5b8[_0x38f4d7(0x195)],'maxProducts':_0x57c5b8[_0x38f4d7(0x13f)],'unit':_0x57c5b8[_0x38f4d7(0x21f)],'secondary_unit':_0x57c5b8[_0x38f4d7(0x173)],'expiry_date':_0x57c5b8[_0x38f4d7(0x234)],'maxPerUnit':_0x57c5b8[_0x38f4d7(0x13e)],'batch_code':_0x57c5b8[_0x38f4d7(0x172)],'alertQTY':_0x57c5b8[_0x38f4d7(0x155)],'production_date':_0x57c5b8[_0x38f4d7(0x151)],'product_cat':_0x57c5b8[_0x38f4d7(0x178)],'invoice':_0x57c5b8[_0x38f4d7(0x258)],'actual_qty':Math[_0x38f4d7(0x1c9)](_0x57c5b8[_0x38f4d7(0x1dd)]),'actual_uom':_0x57c5b8[_0x38f4d7(0x243)]}),_0x3ee7ff;});Promise[_0x3f9366(0x18f)](_0x5b6094)[_0x3f9366(0x1bb)](async _0x58c803=>{var _0x1fa895=_0x3f9366;try{for(const _0x4dac5c of _0x58c803){await _0x4dac5c['save']();}const _0x2dc032=await master_shop[_0x1fa895(0x225)](),_0x327edf=await email_settings[_0x1fa895(0x15d)](),_0xb8fe15=await supervisor_settings[_0x1fa895(0x225)]();var _0x1e4d56=_0x24f805[_0x1fa895(0x16f)],_0x53ddf5='',_0x1278dc;for(_0x1278dc in _0x1e4d56){_0x53ddf5+=_0x1fa895(0x1d7)+_0x1fa895(0x255)+_0x1e4d56[_0x1278dc]['product_name']+_0x1fa895(0x25d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e4d56[_0x1278dc][_0x1fa895(0x1c2)]+'</td>'+_0x1fa895(0x255)+_0x1e4d56[_0x1278dc][_0x1fa895(0x154)]+_0x1fa895(0x25d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e4d56[_0x1278dc]['standard_unit']+_0x1fa895(0x25d)+_0x1fa895(0x255)+_0x1e4d56[_0x1278dc][_0x1fa895(0x173)]+_0x1fa895(0x25d)+_0x1fa895(0x255)+_0x24f805[_0x1fa895(0x161)]+_0x1fa895(0x25d)+_0x1fa895(0x255)+_0x1e4d56[_0x1278dc][_0x1fa895(0x247)]+_0x1fa895(0x25d)+_0x1fa895(0x255)+_0x1e4d56[_0x1278dc][_0x1fa895(0x190)]+_0x1e4d56[_0x1278dc]['rack']+_0x1e4d56[_0x1278dc]['bay']+_0x1e4d56[_0x1278dc][_0x1fa895(0x1da)]+_0x1e4d56[_0x1278dc][_0x1fa895(0x218)][0x0]+_0x1e4d56[_0x1278dc][_0x1fa895(0x195)]+_0x1fa895(0x25d),_0x1fa895(0x147);}let _0x58f818=nodemailer[_0x1fa895(0x16d)]({'host':_0x327edf[_0x1fa895(0x19a)],'port':Number(_0x327edf[_0x1fa895(0x21a)]),'secure':![],'auth':{'user':_0x327edf['email'],'pass':_0x327edf[_0x1fa895(0x1a4)]}}),_0x240190={'from':_0x327edf['email'],'to':_0xb8fe15[0x0][_0x1fa895(0x1c4)],'subject':_0x1fa895(0x24a),'attachments':[{'filename':_0x1fa895(0x23e),'path':__dirname+_0x1fa895(0x166)+_0x1fa895(0x1e6)+_0x2dc032[0x0][_0x1fa895(0x256)],'cid':_0x1fa895(0x20f)}],'html':_0x1fa895(0x22d)+'<html><head><title></title>'+_0x1fa895(0x14f)+'<div>'+_0x1fa895(0x25c)+_0x1fa895(0x24b)+_0x1fa895(0x1ef)+_0x1fa895(0x1fa)+_0x1fa895(0x24b)+_0x1fa895(0x1e4)+_0x2dc032[0x0]['site_title']+_0x1fa895(0x1a0)+_0x1fa895(0x1fa)+_0x1fa895(0x1fa)+_0x1fa895(0x217)+_0x1fa895(0x24b)+_0x1fa895(0x148)+'\x20Order\x20Number\x20:\x20'+_0x24f805['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1fa895(0x168)+_0x24f805[_0x1fa895(0x17d)]+'\x20'+_0x1fa895(0x1d2)+_0x1fa895(0x14b)+'</div>'+_0x1fa895(0x25b)+_0x1fa895(0x1bf)+'<tr>'+_0x1fa895(0x1d4)+_0x1fa895(0x1d0)+_0x1fa895(0x194)+_0x1fa895(0x163)+_0x1fa895(0x227)+_0x1fa895(0x14d)+_0x1fa895(0x24e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1fa895(0x147)+_0x1fa895(0x222)+_0x1fa895(0x229)+'\x20'+_0x53ddf5+'\x20'+_0x1fa895(0x15c)+'</table>'+_0x1fa895(0x24b)+_0x1fa895(0x1aa)+_0x1fa895(0x1a9)+_0x2dc032[0x0][_0x1fa895(0x202)]+_0x1fa895(0x14b)+_0x1fa895(0x1fa)+_0x1fa895(0x1fa)+_0x1fa895(0x215)};_0x58f818['sendMail'](_0x240190,function(_0x5570a2,_0x32d308){var _0x44d7ca=_0x1fa895;_0x5570a2?(console[_0x44d7ca(0x181)](_0x5570a2),console[_0x44d7ca(0x181)]('Error\x20Occurs')):console[_0x44d7ca(0x181)](_0x44d7ca(0x241));}),_0x6d89d3['flash'](_0x1fa895(0x1e7),_0x1fa895(0x183)),_0x14ccf2[_0x1fa895(0x16e)]('/all_purchases/view/');}catch(_0x2b8283){console['error'](_0x2b8283),_0x14ccf2['status'](0x1f4)[_0x1fa895(0x188)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3f9366(0x237)](_0x28813b=>{var _0x5ad45a=_0x3f9366;console[_0x5ad45a(0x220)](_0x28813b),_0x14ccf2[_0x5ad45a(0x13c)](0x1f4)[_0x5ad45a(0x188)]({'error':_0x5ad45a(0x175)});});}catch(_0x2c9424){console[_0x3f9366(0x181)](_0x2c9424);}}),router['get']('/preview/:id',auth,async(_0x18319a,_0x17749d)=>{var _0x5cb5fd=a0_0x536f1a;try{const {username:_0x4b2aec,email:_0x3b0ef5,role:_0x379239}=_0x18319a[_0x5cb5fd(0x1ff)],_0x55c888=_0x18319a['user'],_0x30715b=await profile[_0x5cb5fd(0x15d)]({'email':_0x55c888[_0x5cb5fd(0x1dc)]}),_0x78cb5=await master_shop[_0x5cb5fd(0x225)](),_0x3735aa=_0x18319a[_0x5cb5fd(0x1b8)]['id'],_0x571e61=await purchases[_0x5cb5fd(0x22c)](_0x3735aa),_0x35f7ce=await warehouse[_0x5cb5fd(0x1a1)]([{'$match':{'name':_0x571e61[_0x5cb5fd(0x161)],'room':_0x571e61[_0x5cb5fd(0x1f8)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5cb5fd(0x1a5),'name':{'$first':_0x5cb5fd(0x203)},'product_stock':{'$first':_0x5cb5fd(0x180)},'bay':{'$first':_0x5cb5fd(0x144)},'bin':{'$first':_0x5cb5fd(0x1f1)},'type':{'$first':_0x5cb5fd(0x1ab)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5cb5fd(0x1e0)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5cb5fd(0x198)},'storage':{'$first':_0x5cb5fd(0x20c)},'rack':{'$first':_0x5cb5fd(0x1e3)},'expiry_date':{'$first':_0x5cb5fd(0x1ca)}}}]),_0x2fff85=await customer[_0x5cb5fd(0x225)]({});let _0x1cd10e;if(_0x55c888['role']==_0x5cb5fd(0x20e)){const _0x312167=await staff[_0x5cb5fd(0x15d)]({'email':_0x55c888['email']});_0x1cd10e=await warehouse[_0x5cb5fd(0x1a1)]([{'$match':{'status':'Enabled','name':_0x312167['warehouse']}},{'$group':{'_id':_0x5cb5fd(0x162),'name':{'$first':_0x5cb5fd(0x162)}}}]);}else _0x1cd10e=await warehouse[_0x5cb5fd(0x1a1)]([{'$match':{'status':_0x5cb5fd(0x141)}},{'$group':{'_id':_0x5cb5fd(0x162),'name':{'$first':'$name'}}}]);const _0x239c7c=await product[_0x5cb5fd(0x225)]({}),_0x5cdf58=await suppliers[_0x5cb5fd(0x225)]({}),_0x47244e=BayBinSelected(_0x571e61['warehouse_name'],_0x571e61[_0x5cb5fd(0x1f8)]);if(_0x78cb5[0x0][_0x5cb5fd(0x150)]==_0x5cb5fd(0x142)){var _0x419765=users['English'];console[_0x5cb5fd(0x181)](_0x419765);}else{if(_0x78cb5[0x0][_0x5cb5fd(0x150)]==_0x5cb5fd(0x1d5))var _0x419765=users[_0x5cb5fd(0x1d5)];else{if(_0x78cb5[0x0][_0x5cb5fd(0x150)]==_0x5cb5fd(0x1b9))var _0x419765=users[_0x5cb5fd(0x1b9)];else{if(_0x78cb5[0x0]['language']==_0x5cb5fd(0x20b))var _0x419765=users[_0x5cb5fd(0x20b)];else{if(_0x78cb5[0x0][_0x5cb5fd(0x150)]=='French')var _0x419765=users[_0x5cb5fd(0x1de)];else{if(_0x78cb5[0x0]['language']==_0x5cb5fd(0x1f3))var _0x419765=users[_0x5cb5fd(0x1b1)];else{if(_0x78cb5[0x0][_0x5cb5fd(0x150)]==_0x5cb5fd(0x208))var _0x419765=users[_0x5cb5fd(0x208)];else{if(_0x78cb5[0x0][_0x5cb5fd(0x150)]==_0x5cb5fd(0x238))var _0x419765=users[_0x5cb5fd(0x233)];}}}}}}}_0x17749d[_0x5cb5fd(0x206)](_0x5cb5fd(0x1c7),{'success':_0x18319a[_0x5cb5fd(0x1b2)]('success'),'errors':_0x18319a['flash'](_0x5cb5fd(0x22a)),'role':_0x55c888,'profile':_0x30715b,'customer':_0x2fff85,'warehouse':_0x1cd10e,'product':_0x35f7ce,'user':_0x571e61,'master_shop':_0x78cb5,'unit':_0x239c7c,'language':_0x419765,'suppliers':_0x5cdf58,'dataSelected':_0x47244e});}catch(_0x13ef4b){console[_0x5cb5fd(0x181)](_0x13ef4b);}}),router['post']('/preview/:id',auth,async(_0x3a49de,_0x24f819)=>{var _0x3e2431=a0_0x536f1a;try{const _0xc6edd3=_0x3a49de['params']['id'],{invoice:_0xf6c140,warehouse_name:_0x2e7235,Room_name:_0x353c79}=_0x3a49de[_0x3e2431(0x140)],_0x5940e3=await warehouse[_0x3e2431(0x15d)]({'name':_0x2e7235,'room':_0x353c79}),_0x55268f=await purchases[_0x3e2431(0x15d)]({'invoice':_0xf6c140});_0x55268f[_0x3e2431(0x16f)][_0x3e2431(0x177)](_0x4346ba=>{var _0x3f1dab=_0x3e2431,_0x1fcb9b=0x0;const _0x3347f4=_0x5940e3['product_details'][_0x3f1dab(0x1fe)](_0x4b578f=>{var _0x19a54a=_0x3f1dab;_0x4b578f[_0x19a54a(0x24d)]==_0x4346ba['product_name']&&_0x4b578f[_0x19a54a(0x195)]==_0x4346ba[_0x19a54a(0x195)]&&_0x4b578f['type']==_0x4346ba[_0x19a54a(0x218)]&&_0x4b578f['bin']==_0x4346ba[_0x19a54a(0x1da)]&&_0x4b578f[_0x19a54a(0x224)]==_0x4346ba[_0x19a54a(0x224)]&&_0x4b578f[_0x19a54a(0x252)]==_0x4346ba[_0x19a54a(0x252)]&&_0x4b578f['storage']==_0x4346ba[_0x19a54a(0x190)]&&_0x4b578f[_0x19a54a(0x234)]==_0x4346ba[_0x19a54a(0x234)]&&_0x4b578f[_0x19a54a(0x172)]==_0x4346ba[_0x19a54a(0x172)]&&_0x4b578f[_0x19a54a(0x151)]==_0x4346ba['production_date']&&_0x4b578f[_0x19a54a(0x193)]==_0x4346ba['delivery_date']&&_0x4b578f[_0x19a54a(0x143)]==_0x4346ba[_0x19a54a(0x143)]&&(_0x4b578f[_0x19a54a(0x209)]=parseInt(_0x4b578f[_0x19a54a(0x209)])+parseInt(_0x4346ba[_0x19a54a(0x154)]),_0x1fcb9b++);});_0x1fcb9b=='0'&&(_0x5940e3[_0x3f1dab(0x196)]=_0x5940e3[_0x3f1dab(0x196)][_0x3f1dab(0x19f)]({'product_name':_0x4346ba['product_name'],'product_stock':_0x4346ba[_0x3f1dab(0x154)],'primary_code':_0x4346ba['primary_code'],'secondary_code':_0x4346ba[_0x3f1dab(0x22e)],'product_code':_0x4346ba[_0x3f1dab(0x1c2)],'storage':_0x4346ba[_0x3f1dab(0x190)],'rack':_0x4346ba[_0x3f1dab(0x252)],'bay':_0x4346ba['bay'],'bin':_0x4346ba[_0x3f1dab(0x1da)],'type':_0x4346ba[_0x3f1dab(0x218)],'floorlevel':_0x4346ba[_0x3f1dab(0x195)],'maxProducts':_0x4346ba[_0x3f1dab(0x13f)],'unit':_0x4346ba['standard_unit'],'secondary_unit':_0x4346ba['secondary_unit'],'expiry_date':_0x4346ba[_0x3f1dab(0x234)],'maxPerUnit':_0x4346ba['maxperunit'],'batch_code':_0x4346ba['batch_code'],'alertQTY':_0x4346ba[_0x3f1dab(0x155)],'production_date':_0x4346ba[_0x3f1dab(0x151)],'delivery_date':_0x4346ba[_0x3f1dab(0x193)],'delivery_code':_0x4346ba[_0x3f1dab(0x143)]}));}),await _0x5940e3[_0x3e2431(0x1b0)](),_0x55268f['finalize']=_0x3e2431(0x25f);const _0xaead87=await _0x55268f[_0x3e2431(0x1b0)]();_0x3a49de[_0x3e2431(0x1b2)](_0x3e2431(0x1e7),_0x3e2431(0x1b4)),_0x24f819[_0x3e2431(0x16e)](_0x3e2431(0x18c));}catch(_0x3a4e53){console[_0x3e2431(0x181)](_0x3a4e53);}}),router[a0_0x536f1a(0x187)](a0_0x536f1a(0x1cc),auth,async(_0x1fec55,_0x532b8f)=>{var _0x2f2daa=a0_0x536f1a;try{const {username:_0x5b6e6f,email:_0x5732ee,role:_0x553bca}=_0x1fec55[_0x2f2daa(0x1ff)],_0x44ef17=_0x1fec55['user'],_0x4986b3=await profile[_0x2f2daa(0x15d)]({'email':_0x44ef17['email']}),_0x789f87=await master_shop[_0x2f2daa(0x225)](),_0x516366=_0x1fec55['params']['id'],_0x42ac21=await purchases['findById'](_0x516366),_0x35c126=await suppliers['find']({});let _0x55717e;if(_0x44ef17[_0x2f2daa(0x21c)]==_0x2f2daa(0x20e)){const _0x1c8211=await staff[_0x2f2daa(0x15d)]({'email':_0x44ef17[_0x2f2daa(0x1dc)]});_0x55717e=await warehouse[_0x2f2daa(0x225)]({'status':'Enabled','name':_0x1c8211[_0x2f2daa(0x171)],'warehouse_category':_0x2f2daa(0x15e)});}else _0x55717e=await warehouse[_0x2f2daa(0x1a1)]([{'$match':{'status':_0x2f2daa(0x141),'warehouse_category':_0x2f2daa(0x15e)}},{'$group':{'_id':_0x2f2daa(0x162),'name':{'$first':'$name'}}}]);const _0x29e64c=await product[_0x2f2daa(0x225)]({}),_0x56807b=BayBinSelected(_0x42ac21[_0x2f2daa(0x161)],_0x42ac21[_0x2f2daa(0x1f8)]);let _0x546f52=new Date(_0x42ac21[_0x2f2daa(0x234)]),_0x3953d4=('0'+_0x546f52[_0x2f2daa(0x200)]())[_0x2f2daa(0x199)](-0x2),_0x333a64=('0'+(_0x546f52[_0x2f2daa(0x24f)]()+0x1))['slice'](-0x2),_0x1f5d45=_0x546f52['getFullYear'](),_0x2db8bf=_0x1f5d45+'-'+_0x333a64+'-'+_0x3953d4;if(_0x789f87[0x0][_0x2f2daa(0x150)]=='English\x20(US)'){var _0xc771d6=users[_0x2f2daa(0x1d9)];console[_0x2f2daa(0x181)](_0xc771d6);}else{if(_0x789f87[0x0][_0x2f2daa(0x150)]==_0x2f2daa(0x1d5))var _0xc771d6=users[_0x2f2daa(0x1d5)];else{if(_0x789f87[0x0][_0x2f2daa(0x150)]==_0x2f2daa(0x1b9))var _0xc771d6=users[_0x2f2daa(0x1b9)];else{if(_0x789f87[0x0][_0x2f2daa(0x150)]==_0x2f2daa(0x20b))var _0xc771d6=users[_0x2f2daa(0x20b)];else{if(_0x789f87[0x0][_0x2f2daa(0x150)]==_0x2f2daa(0x1de))var _0xc771d6=users['French'];else{if(_0x789f87[0x0][_0x2f2daa(0x150)]=='Portuguese\x20(BR)')var _0xc771d6=users['Portuguese'];else{if(_0x789f87[0x0][_0x2f2daa(0x150)]==_0x2f2daa(0x208))var _0xc771d6=users[_0x2f2daa(0x208)];else{if(_0x789f87[0x0][_0x2f2daa(0x150)]==_0x2f2daa(0x238))var _0xc771d6=users['Arabic'];}}}}}}}_0x532b8f[_0x2f2daa(0x206)]('edit_purchases',{'success':_0x1fec55[_0x2f2daa(0x1b2)](_0x2f2daa(0x1e7)),'errors':_0x1fec55[_0x2f2daa(0x1b2)](_0x2f2daa(0x22a)),'role':_0x44ef17,'profile':_0x4986b3,'purchases':_0x42ac21,'suppliers':_0x35c126,'warehouse':_0x55717e,'product':_0x29e64c,'master_shop':_0x789f87,'language':_0xc771d6,'ed_fullDate':_0x2db8bf,'dataSelected':_0x56807b});}catch(_0x29182b){console[_0x2f2daa(0x181)](_0x29182b);}}),router[a0_0x536f1a(0x189)](a0_0x536f1a(0x1cc),auth,async(_0x934633,_0x4782f8)=>{var _0x2d1a3e=a0_0x536f1a;try{const _0x5762e1=_0x934633[_0x2d1a3e(0x1b8)]['id'],_0x46317a=await purchases['findOne']({'_id':_0x934633[_0x2d1a3e(0x1b8)]['id']}),_0x53a4a6=await warehouse[_0x2d1a3e(0x15d)]({'name':_0x46317a['warehouse_name'],'room':_0x46317a[_0x2d1a3e(0x1f8)]});_0x46317a[_0x2d1a3e(0x16f)]['forEach'](_0x206044=>{var _0x58c339=_0x2d1a3e;const _0x29d06c=_0x53a4a6[_0x58c339(0x196)][_0x58c339(0x1fe)](_0x3eabfb=>{var _0x182b70=_0x58c339;_0x3eabfb[_0x182b70(0x24d)]==_0x206044['product_name']&&_0x3eabfb['floorlevel']==_0x206044[_0x182b70(0x195)]&&_0x3eabfb[_0x182b70(0x218)]==_0x206044[_0x182b70(0x218)]&&_0x3eabfb[_0x182b70(0x1da)]==_0x206044[_0x182b70(0x1da)]&&_0x3eabfb[_0x182b70(0x224)]==_0x206044[_0x182b70(0x224)]&&_0x3eabfb['rack']==_0x206044[_0x182b70(0x252)]&&_0x3eabfb[_0x182b70(0x190)]==_0x206044['storage']&&(_0x3eabfb[_0x182b70(0x209)]=parseInt(_0x3eabfb[_0x182b70(0x209)])-parseInt(_0x206044[_0x182b70(0x154)]));});}),await _0x53a4a6[_0x2d1a3e(0x1b0)]();const {invoice:_0x323dd8,suppliers:_0x336c42,date:_0x2abab1,warehouse_name:_0x22cf1d,prod_name:_0x47fdb1,prod_code:_0x24b1e6,prod_qty:_0x1b903a,prod_unit:_0x3a4991,prod_secondunit:_0xd66d73,prod_level:_0x390ad2,prod_isle:_0x43f380,prod_pallet:_0xa6bbf6,note:_0xeaf1d4,expiry_date:_0x487d0a,batch_code:_0x17bc97,paid_amount:_0x467fbf,due_amount:_0x4bb4ee,Room_name:_0x255fbb,primary_code:_0x918beb,secondary_code:_0x16c43a,PO_number:_0x5d861,JO_number:_0x3756f7}=_0x934633['body'];if(typeof _0x47fdb1==_0x2d1a3e(0x219))var _0x1d6146=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x213)]],_0x3409b8=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x19d)]],_0x3890ce=[_0x934633[_0x2d1a3e(0x140)]['prod_qty']],_0x461c06=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x18a)]],_0x94ef51=[_0x934633[_0x2d1a3e(0x140)]['prod_secondunit']],_0x31b6c9=[_0x934633['body']['prod_level']],_0x183b68=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x22f)]],_0x207cab=[_0x934633[_0x2d1a3e(0x140)]['prod_pallet']],_0x19dee2=[_0x934633[_0x2d1a3e(0x140)]['primary_code']],_0x26ca6f=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x22e)]],_0x7e8266=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x1f9)]],_0x584d02=[_0x934633['body'][_0x2d1a3e(0x172)]],_0x139f66=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x234)]],_0x408580=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x190)]],_0x229a23=[_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x14e)]],_0x3a4c16=[_0x934633['body'][_0x2d1a3e(0x218)]];else var _0x1d6146=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x213)]],_0x3409b8=[..._0x934633['body'][_0x2d1a3e(0x19d)]],_0x3890ce=[..._0x934633['body'][_0x2d1a3e(0x1f6)]],_0x461c06=[..._0x934633[_0x2d1a3e(0x140)]['prod_unit']],_0x94ef51=[..._0x934633['body']['prod_secondunit']],_0x31b6c9=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x239)]],_0x183b68=[..._0x934633['body'][_0x2d1a3e(0x22f)]],_0x207cab=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x21d)]],_0x19dee2=[..._0x934633[_0x2d1a3e(0x140)]['primary_code']],_0x26ca6f=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x22e)]],_0x7e8266=[..._0x934633[_0x2d1a3e(0x140)]['MaxStocks_data']],_0x584d02=[..._0x934633['body'][_0x2d1a3e(0x172)]],_0x139f66=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x234)]],_0x408580=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x190)]],_0x229a23=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x14e)]],_0x3a4c16=[..._0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x218)]];const _0x49484d=_0x1d6146['map'](_0x5a73ee=>{return _0x5a73ee={'product_name':_0x5a73ee};});_0x3409b8['forEach']((_0x135509,_0x3ab90d)=>{var _0x412f1b=_0x2d1a3e;_0x49484d[_0x3ab90d][_0x412f1b(0x1c2)]=_0x135509;}),_0x3890ce[_0x2d1a3e(0x177)]((_0x555f24,_0xd4a50c)=>{var _0xb2b75d=_0x2d1a3e;_0x49484d[_0xd4a50c][_0xb2b75d(0x154)]=_0x555f24;}),_0x461c06[_0x2d1a3e(0x177)]((_0x390776,_0x18c0d8)=>{var _0x53ab2=_0x2d1a3e;_0x49484d[_0x18c0d8][_0x53ab2(0x21f)]=_0x390776;}),_0x94ef51[_0x2d1a3e(0x177)]((_0x5d304f,_0x116f0f)=>{var _0x2d9462=_0x2d1a3e;_0x49484d[_0x116f0f][_0x2d9462(0x173)]=_0x5d304f;}),_0x31b6c9['forEach']((_0x2de342,_0x437b49)=>{var _0x1bcc4e=_0x2d1a3e;_0x49484d[_0x437b49][_0x1bcc4e(0x224)]=_0x2de342;}),_0x183b68['forEach']((_0x2efe87,_0x265a77)=>{var _0x4bc684=_0x2d1a3e;_0x49484d[_0x265a77][_0x4bc684(0x1da)]=_0x2efe87;}),_0x207cab[_0x2d1a3e(0x177)]((_0x1d4bde,_0x599b91)=>{var _0x210fb0=_0x2d1a3e;_0x49484d[_0x599b91][_0x210fb0(0x195)]=_0x1d4bde;}),_0x19dee2[_0x2d1a3e(0x177)]((_0x6b19d1,_0x1ff1c7)=>{var _0x573158=_0x2d1a3e;_0x49484d[_0x1ff1c7][_0x573158(0x184)]=_0x6b19d1;}),_0x26ca6f[_0x2d1a3e(0x177)]((_0x23bb90,_0x4fe1f2)=>{var _0x5b0a14=_0x2d1a3e;_0x49484d[_0x4fe1f2][_0x5b0a14(0x22e)]=_0x23bb90;}),_0x7e8266['forEach']((_0x169eb2,_0x230b0a)=>{var _0x12f624=_0x2d1a3e;_0x49484d[_0x230b0a][_0x12f624(0x13f)]=_0x169eb2;}),_0x584d02[_0x2d1a3e(0x177)]((_0xc810e8,_0x3a6e10)=>{_0x49484d[_0x3a6e10]['batch_code']=_0xc810e8;}),_0x139f66['forEach']((_0x3534d1,_0x85b1e8)=>{var _0x1a7ca4=_0x2d1a3e;_0x49484d[_0x85b1e8][_0x1a7ca4(0x234)]=_0x3534d1;}),_0x3a4c16[_0x2d1a3e(0x177)]((_0xd088da,_0x598732)=>{var _0x35b246=_0x2d1a3e;_0x49484d[_0x598732][_0x35b246(0x218)]=_0xd088da;}),_0x408580['forEach']((_0x31020c,_0x231491)=>{var _0x8366aa=_0x2d1a3e;_0x49484d[_0x231491][_0x8366aa(0x190)]=_0x31020c;}),_0x229a23[_0x2d1a3e(0x177)]((_0x24576e,_0x5ef19b)=>{_0x49484d[_0x5ef19b]['rack']=_0x24576e;});const _0x37c7cd=_0x49484d[_0x2d1a3e(0x23f)](_0x5ffe3c=>_0x5ffe3c['quantity']!=='0'&&_0x5ffe3c['quantity']!=='');_0x46317a[_0x2d1a3e(0x258)]=_0x323dd8,_0x46317a['suppliers']=_0x336c42,_0x46317a['date']=_0x2abab1,_0x46317a[_0x2d1a3e(0x161)]=_0x22cf1d,_0x46317a[_0x2d1a3e(0x16f)]=_0x37c7cd,_0x46317a[_0x2d1a3e(0x17a)]=_0xeaf1d4,_0x46317a[_0x2d1a3e(0x1f7)]=_0x467fbf,_0x46317a[_0x2d1a3e(0x248)]=_0x4bb4ee,_0x46317a[_0x2d1a3e(0x1f8)]=_0x255fbb,_0x46317a['POnumber']=_0x5d861,_0x46317a[_0x2d1a3e(0x246)]=_0x3756f7;const _0x3cad50=await _0x46317a[_0x2d1a3e(0x1b0)](),_0x2b0e17=await warehouse[_0x2d1a3e(0x15d)]({'name':_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x161)],'room':_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x1e5)]});_0x46317a[_0x2d1a3e(0x16f)]['forEach'](_0x9ba875=>{var _0x5b2b44=_0x2d1a3e,_0x5ead6d=0x0;const _0x1d84fa=_0x2b0e17['product_details']['map'](_0x3778d1=>{var _0x30720f=a0_0x4bc9;_0x3778d1[_0x30720f(0x24d)]==_0x9ba875[_0x30720f(0x24d)]&&_0x3778d1[_0x30720f(0x195)]==_0x9ba875[_0x30720f(0x195)]&&_0x3778d1[_0x30720f(0x218)]==_0x9ba875[_0x30720f(0x218)]&&_0x3778d1[_0x30720f(0x1da)]==_0x9ba875[_0x30720f(0x1da)]&&_0x3778d1[_0x30720f(0x224)]==_0x9ba875[_0x30720f(0x224)]&&_0x3778d1['rack']==_0x9ba875[_0x30720f(0x252)]&&_0x3778d1[_0x30720f(0x190)]==_0x9ba875[_0x30720f(0x190)]&&(_0x3778d1['product_stock']=parseInt(_0x3778d1['product_stock'])+parseInt(_0x9ba875[_0x30720f(0x154)]),_0x5ead6d++);});_0x5ead6d=='0'&&(_0x2b0e17[_0x5b2b44(0x196)]=_0x2b0e17[_0x5b2b44(0x196)][_0x5b2b44(0x19f)]({'product_name':_0x9ba875[_0x5b2b44(0x24d)],'product_stock':_0x9ba875['quantity'],'primary_code':_0x9ba875[_0x5b2b44(0x184)],'secondary_code':_0x9ba875[_0x5b2b44(0x22e)],'product_code':_0x9ba875['product_code'],'storage':_0x9ba875[_0x5b2b44(0x190)],'rack':_0x9ba875['rack'],'bay':_0x9ba875['bay'],'bin':_0x9ba875[_0x5b2b44(0x1da)],'type':_0x9ba875[_0x5b2b44(0x218)],'floorlevel':_0x9ba875[_0x5b2b44(0x195)],'maxProducts':_0x9ba875[_0x5b2b44(0x13f)],'unit':_0x9ba875['standard_unit'],'secondary_unit':_0x9ba875['secondary_unit'],'expiry_date':_0x9ba875[_0x5b2b44(0x234)]}));}),await _0x2b0e17[_0x2d1a3e(0x1b0)]();const _0x5a1ed1=await s_payment_data[_0x2d1a3e(0x15d)]({'invoice':_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x258)]});if(_0x5a1ed1===null){}else console['log'](_0x2d1a3e(0x1fb),_0x5a1ed1,_0x934633[_0x2d1a3e(0x140)]['invoice']),_0x5a1ed1[_0x2d1a3e(0x1fb)]=_0x934633[_0x2d1a3e(0x140)][_0x2d1a3e(0x1fb)],await _0x5a1ed1[_0x2d1a3e(0x1b0)]();_0x934633[_0x2d1a3e(0x1b2)](_0x2d1a3e(0x1e7),_0x2d1a3e(0x170)),_0x4782f8[_0x2d1a3e(0x16e)](_0x2d1a3e(0x18c));}catch(_0x383872){console[_0x2d1a3e(0x181)](_0x383872);}}),router['post']('/give_payment/:id',auth,async(_0x4a5282,_0x1f1efd)=>{var _0x41938f=a0_0x536f1a;try{const _0x1e7e31=_0x4a5282['params']['id'],{invoice:_0x176a4f,suppliers:_0x3379be,payable:_0x28da30,due_amount:_0x2523f7}=_0x4a5282[_0x41938f(0x140)],_0x10d430=await purchases[_0x41938f(0x22c)](_0x1e7e31);var _0x22a37f=_0x28da30-_0x2523f7;_0x10d430[_0x41938f(0x1f7)]=parseFloat(_0x10d430[_0x41938f(0x1f7)])+parseFloat(_0x2523f7),_0x10d430[_0x41938f(0x248)]=_0x22a37f;const _0x537a82=await _0x10d430[_0x41938f(0x1b0)]();console[_0x41938f(0x181)](_0x537a82);const _0x45afc8=await s_payment_data[_0x41938f(0x15d)]({'invoice':_0x176a4f});_0x45afc8[_0x41938f(0x17e)]=_0x22a37f,await _0x45afc8[_0x41938f(0x1b0)]();let _0x3a5c0d=new Date(),_0x5a7bdc=('0'+_0x3a5c0d[_0x41938f(0x200)]())['slice'](-0x2),_0x542d6f=('0'+(_0x3a5c0d[_0x41938f(0x24f)]()+0x1))[_0x41938f(0x199)](-0x2),_0x11b3ff=_0x3a5c0d[_0x41938f(0x160)](),_0x3df41a=_0x11b3ff+'-'+_0x542d6f+'-'+_0x5a7bdc;const _0x4d3e72=new suppliers_payment({'invoice':_0x176a4f,'date':_0x11b3ff+'-'+_0x542d6f+'-'+_0x5a7bdc,'suppliers':_0x3379be,'reason':_0x41938f(0x1eb),'amount':_0x2523f7}),_0x5a7b0d=await _0x4d3e72[_0x41938f(0x1b0)]();_0x4a5282[_0x41938f(0x1b2)](_0x41938f(0x1e7),'payment\x20successfull'),_0x1f1efd[_0x41938f(0x16e)](_0x41938f(0x18c));}catch(_0x14d732){console['log'](_0x14d732);}}),router[a0_0x536f1a(0x187)](a0_0x536f1a(0x1d8),auth,async(_0xa0ddc0,_0x5b98e5)=>{var _0x21e20d=a0_0x536f1a;try{const {username:_0xe19d89,email:_0x3ec52c,role:_0x35919b}=_0xa0ddc0[_0x21e20d(0x1ff)],_0x4825e1=_0xa0ddc0[_0x21e20d(0x1ff)],_0x56e8a5=await profile[_0x21e20d(0x15d)]({'email':_0x4825e1[_0x21e20d(0x1dc)]}),_0x35ff01=await master_shop[_0x21e20d(0x225)]();console[_0x21e20d(0x181)](_0x21e20d(0x1f5),_0x35ff01);const _0x444856=_0xa0ddc0[_0x21e20d(0x1b8)]['id'],_0x14661d=await purchases['findById'](_0x444856);console[_0x21e20d(0x181)](_0x14661d);const _0x81389a=await suppliers[_0x21e20d(0x15d)]({'name':_0x14661d[_0x21e20d(0x1fb)]});console[_0x21e20d(0x181)](_0x81389a);if(_0x35ff01[0x0][_0x21e20d(0x150)]==_0x21e20d(0x142)){var _0x5ab912=users[_0x21e20d(0x1d9)];console['log'](_0x5ab912);}else{if(_0x35ff01[0x0][_0x21e20d(0x150)]==_0x21e20d(0x1d5))var _0x5ab912=users[_0x21e20d(0x1d5)];else{if(_0x35ff01[0x0][_0x21e20d(0x150)]=='German')var _0x5ab912=users[_0x21e20d(0x1b9)];else{if(_0x35ff01[0x0]['language']=='Spanish')var _0x5ab912=users['Spanish'];else{if(_0x35ff01[0x0]['language']==_0x21e20d(0x1de))var _0x5ab912=users[_0x21e20d(0x1de)];else{if(_0x35ff01[0x0][_0x21e20d(0x150)]==_0x21e20d(0x1f3))var _0x5ab912=users['Portuguese'];else{if(_0x35ff01[0x0][_0x21e20d(0x150)]==_0x21e20d(0x208))var _0x5ab912=users[_0x21e20d(0x208)];else{if(_0x35ff01[0x0][_0x21e20d(0x150)]==_0x21e20d(0x238))var _0x5ab912=users[_0x21e20d(0x233)];}}}}}}}_0x5b98e5['render'](_0x21e20d(0x204),{'success':_0xa0ddc0['flash'](_0x21e20d(0x1e7)),'errors':_0xa0ddc0[_0x21e20d(0x1b2)](_0x21e20d(0x22a)),'role':_0x4825e1,'profile':_0x56e8a5,'master_shop':_0x35ff01,'supplier':_0x81389a,'purchase':_0x14661d,'language':_0x5ab912});}catch(_0x33e9db){console['log'](_0x33e9db);}}),router[a0_0x536f1a(0x187)]('/view/return_purchase/:id',auth,async(_0x5bd816,_0x1e84cd)=>{var _0x39b42f=a0_0x536f1a;try{const {username:_0x309d16,email:_0x38722b,role:_0x518847}=_0x5bd816[_0x39b42f(0x1ff)],_0x5276f9=_0x5bd816[_0x39b42f(0x1ff)],_0x3eb049=await profile[_0x39b42f(0x15d)]({'email':_0x5276f9[_0x39b42f(0x1dc)]}),_0x16bc0b=await master_shop['find']();console[_0x39b42f(0x181)](_0x39b42f(0x1f5),_0x16bc0b);const _0x3e1d59=_0x5bd816['params']['id'];console[_0x39b42f(0x181)](_0x3e1d59);const _0x3b6284=await purchases[_0x39b42f(0x22c)](_0x3e1d59);console['log'](_0x39b42f(0x22b),_0x3b6284);const _0x43b77e=await product['find']({}),_0x38d26f=await warehouse[_0x39b42f(0x1a1)]([{'$match':{'name':_0x3b6284[_0x39b42f(0x161)],'room':_0x3b6284[_0x39b42f(0x1f8)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x39b42f(0x1a5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x39b42f(0x180)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x39b42f(0x1f1)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x39b42f(0x1d3)},'primary_code':{'$first':_0x39b42f(0x1e0)},'secondary_code':{'$first':_0x39b42f(0x1f4)},'product_code':{'$first':_0x39b42f(0x198)},'storage':{'$first':_0x39b42f(0x20c)},'rack':{'$first':_0x39b42f(0x1e3)}}}]);warehouse_data=await warehouse[_0x39b42f(0x1a1)]([{'$match':{'status':_0x39b42f(0x141),'name':_0x39b42f(0x145),'warehouse_category':_0x39b42f(0x15e)}},{'$group':{'_id':'$name','name':{'$first':_0x39b42f(0x162)}}},{'$sort':{'name':0x1}}]),console['log'](_0x39b42f(0x20a),_0x38d26f);if(_0x16bc0b[0x0]['language']=='English\x20(US)'){var _0xde086e=users['English'];console['log'](_0xde086e);}else{if(_0x16bc0b[0x0][_0x39b42f(0x150)]==_0x39b42f(0x1d5))var _0xde086e=users[_0x39b42f(0x1d5)];else{if(_0x16bc0b[0x0][_0x39b42f(0x150)]==_0x39b42f(0x1b9))var _0xde086e=users[_0x39b42f(0x1b9)];else{if(_0x16bc0b[0x0][_0x39b42f(0x150)]==_0x39b42f(0x20b))var _0xde086e=users[_0x39b42f(0x20b)];else{if(_0x16bc0b[0x0][_0x39b42f(0x150)]=='French')var _0xde086e=users[_0x39b42f(0x1de)];else{if(_0x16bc0b[0x0]['language']==_0x39b42f(0x1f3))var _0xde086e=users[_0x39b42f(0x1b1)];else{if(_0x16bc0b[0x0][_0x39b42f(0x150)]=='Chinese')var _0xde086e=users[_0x39b42f(0x208)];else{if(_0x16bc0b[0x0][_0x39b42f(0x150)]==_0x39b42f(0x238))var _0xde086e=users[_0x39b42f(0x233)];}}}}}}}_0x1e84cd['render'](_0x39b42f(0x19b),{'success':_0x5bd816[_0x39b42f(0x1b2)]('success'),'errors':_0x5bd816['flash']('errors'),'role':_0x5276f9,'profile':_0x3eb049,'user':_0x3b6284,'stock':_0x38d26f,'master_shop':_0x16bc0b,'product':_0x43b77e,'language':_0xde086e,'warehouse':warehouse_data});}catch(_0x3d4f2a){console[_0x39b42f(0x181)](_0x3d4f2a);}}),router[a0_0x536f1a(0x189)](a0_0x536f1a(0x13d),auth,async(_0x59d8f1,_0x290fa8)=>{var _0x3146c1=a0_0x536f1a;try{const {invoice:_0x1fb38f,date:_0x30ff8d,warehouse_name:_0x3ba007,Room_name:_0x5b33ed,product_name:_0x1aed7c,purchase_quantity:_0xefc398,stocks:_0x513ce0,return_qty:_0xabcc16,note:_0x3b6315,level:_0x47a52c,isle:_0x49d12b,pallet:_0x3088f0,to_warehouse_name:_0x318c06,to_Room_name:_0x18633b}=_0x59d8f1[_0x3146c1(0x140)],_0x15c225=await purchases[_0x3146c1(0x15d)]({'_id':_0x59d8f1[_0x3146c1(0x1b8)]['id']}),_0x356004=await warehouse['findOne']({'name':_0x3ba007,'room':_0x5b33ed});if(typeof _0x1aed7c==_0x3146c1(0x219))var _0x31b298=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x24d)]],_0x43d85b=[_0x59d8f1[_0x3146c1(0x140)]['purchase_quantity']],_0x2b7584=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x260)]],_0x13b3b0=[_0x59d8f1['body'][_0x3146c1(0x1e8)]],_0x9ff44d=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x18d)]],_0x4d9a78=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1a3)]],_0x19e37b=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x16c)]],_0xa83714=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1c1)]],_0x141a44=[_0x59d8f1[_0x3146c1(0x140)]['product_code_hide']],_0x3b9a2c=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1b7)]],_0x554ed1=[_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1fd)]];else var _0x31b298=[..._0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x24d)]],_0x43d85b=[..._0x59d8f1[_0x3146c1(0x140)]['purchase_quantity']],_0x2b7584=[..._0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x260)]],_0x13b3b0=[..._0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1e8)]],_0x9ff44d=[..._0x59d8f1['body'][_0x3146c1(0x18d)]],_0x4d9a78=[..._0x59d8f1['body']['isle']],_0x19e37b=[..._0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x16c)]],_0xa83714=[..._0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1c1)]],_0x141a44=[..._0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x223)]],_0x3b9a2c=[..._0x59d8f1['body'][_0x3146c1(0x1b7)]],_0x554ed1=[..._0x59d8f1['body'][_0x3146c1(0x1fd)]];const _0x49c354=_0x31b298[_0x3146c1(0x1fe)](_0x2f59de=>{return _0x2f59de={'product_name':_0x2f59de};});_0x43d85b[_0x3146c1(0x177)]((_0x24882f,_0x18c9b6)=>{var _0x38ede1=_0x3146c1;_0x49c354[_0x18c9b6][_0x38ede1(0x1ce)]=_0x24882f;}),_0x2b7584[_0x3146c1(0x177)]((_0x192ddd,_0x370728)=>{_0x49c354[_0x370728]['stock_quantity']=_0x192ddd;}),_0x13b3b0[_0x3146c1(0x177)]((_0x340dce,_0x5373e4)=>{_0x49c354[_0x5373e4]['return_qty']=_0x340dce;}),_0x9ff44d[_0x3146c1(0x177)]((_0x23be3d,_0xb5809c)=>{var _0x182a3d=_0x3146c1;_0x49c354[_0xb5809c][_0x182a3d(0x224)]=_0x23be3d;}),_0x4d9a78[_0x3146c1(0x177)]((_0x31cbd3,_0x258e16)=>{_0x49c354[_0x258e16]['bin']=_0x31cbd3;}),_0x19e37b[_0x3146c1(0x177)]((_0x50494d,_0x27255f)=>{var _0x31b0e0=_0x3146c1;_0x49c354[_0x27255f][_0x31b0e0(0x195)]=_0x50494d;}),_0xa83714[_0x3146c1(0x177)]((_0x36852e,_0x20b80b)=>{var _0x366161=_0x3146c1;_0x49c354[_0x20b80b][_0x366161(0x218)]=_0x36852e;}),_0x141a44['forEach']((_0x2e99e1,_0x14624e)=>{var _0xc34395=_0x3146c1;_0x49c354[_0x14624e][_0xc34395(0x1c2)]=_0x2e99e1;}),_0x3b9a2c[_0x3146c1(0x177)]((_0x4c959d,_0x39d8bc)=>{_0x49c354[_0x39d8bc]['primary_code']=_0x4c959d;}),_0x554ed1[_0x3146c1(0x177)]((_0x3b6552,_0x245897)=>{_0x49c354[_0x245897]['secondary_code']=_0x3b6552;}),_0x15c225['product'][_0x3146c1(0x177)](_0x264ddc=>{var _0x164667=_0x3146c1;const _0x1f1983=_0x356004[_0x164667(0x196)][_0x164667(0x1fe)](_0x2b3e20=>{var _0x59561a=_0x164667;_0x2b3e20['product_name']==_0x264ddc[_0x59561a(0x24d)]&&_0x2b3e20['floorlevel']==_0x264ddc[_0x59561a(0x195)]&&_0x2b3e20[_0x59561a(0x218)]==_0x264ddc[_0x59561a(0x218)]&&_0x2b3e20[_0x59561a(0x1da)]==_0x264ddc['bin']&&_0x2b3e20['bay']==_0x264ddc[_0x59561a(0x224)]&&_0x2b3e20[_0x59561a(0x252)]==_0x264ddc[_0x59561a(0x252)]&&_0x2b3e20[_0x59561a(0x190)]==_0x264ddc[_0x59561a(0x190)]&&(console[_0x59561a(0x181)](parseInt(_0x2b3e20['product_stock'])+_0x59561a(0x259)+parseInt(_0x264ddc[_0x59561a(0x154)])),_0x2b3e20[_0x59561a(0x209)]=parseInt(_0x2b3e20[_0x59561a(0x209)])+parseInt(_0x264ddc[_0x59561a(0x154)]));});}),await _0x356004[_0x3146c1(0x1b0)]();const _0xd3cb5f=_0x49c354[_0x3146c1(0x23f)](_0x291e02=>_0x291e02[_0x3146c1(0x1e8)]!=='0'&&_0x291e02[_0x3146c1(0x1e8)]!=='');var _0x4e1c5a=0x0;_0xd3cb5f[_0x3146c1(0x177)](_0x598d7c=>{var _0x4130af=_0x3146c1;console[_0x4130af(0x181)](_0x4130af(0x1b6),_0x598d7c),(parseInt(_0x598d7c['purchase_quantity'])<parseInt(_0x598d7c[_0x4130af(0x1e8)])||parseInt(_0x598d7c[_0x4130af(0x1cd)])<parseInt(_0x598d7c[_0x4130af(0x1e8)]))&&_0x4e1c5a++;});if(_0x4e1c5a!=0x0)return _0x59d8f1['flash'](_0x3146c1(0x22a),_0x3146c1(0x1c8)),_0x290fa8[_0x3146c1(0x16e)]('back');const _0x24b7c6=new purchases_return({'invoice':_0x1fb38f,'suppliers':_0x59d8f1[_0x3146c1(0x140)]['suppliers'],'date':_0x30ff8d,'warehouse_name':_0x3ba007,'return_product':_0xd3cb5f,'note':_0x3b6315,'room':_0x5b33ed,'to_warehouse_name':_0x318c06,'to_room':_0x18633b}),_0x37b1ea=await _0x24b7c6['save']();console[_0x3146c1(0x181)](_0x24b7c6);const _0x244c95=await purchases_return[_0x3146c1(0x15d)]({'invoice':_0x1fb38f}),_0x31d8bc=await warehouse[_0x3146c1(0x15d)]({'name':_0x318c06,'room':_0x18633b});_0x244c95[_0x3146c1(0x21e)][_0x3146c1(0x177)](_0x2b62e3=>{var _0x11f746=_0x3146c1,_0x42675a=0x0;const _0x1be87b=_0x31d8bc[_0x11f746(0x196)][_0x11f746(0x1fe)](_0x1d3145=>{var _0x3a5246=_0x11f746;_0x1d3145['product_name']==_0x2b62e3[_0x3a5246(0x24d)]&&_0x1d3145[_0x3a5246(0x195)]==_0x2b62e3[_0x3a5246(0x195)]&&_0x1d3145[_0x3a5246(0x218)]==_0x2b62e3['type']&&_0x1d3145[_0x3a5246(0x1da)]==_0x2b62e3['bin']&&_0x1d3145[_0x3a5246(0x224)]==_0x2b62e3['bay']&&(_0x1d3145[_0x3a5246(0x209)]=parseInt(_0x1d3145['product_stock'])-parseInt(_0x2b62e3[_0x3a5246(0x1e8)]),_0x42675a++);});_0x42675a=='0'&&(_0x31d8bc['product_details']=_0x31d8bc['product_details']['concat']({'product_name':_0x2b62e3['product_name'],'product_stock':_0x2b62e3[_0x11f746(0x1e8)],'primary_code':_0x2b62e3['primary_code'],'secondary_code':_0x2b62e3['secondary_code'],'product_code':_0x2b62e3[_0x11f746(0x1c2)],'storage':_0x2b62e3['storage'],'rack':_0x2b62e3[_0x11f746(0x252)],'bay':_0x2b62e3[_0x11f746(0x224)],'bin':_0x2b62e3[_0x11f746(0x1da)],'type':_0x2b62e3[_0x11f746(0x218)],'floorlevel':_0x2b62e3[_0x11f746(0x195)],'maxProducts':_0x2b62e3[_0x11f746(0x13f)],'unit':_0x2b62e3[_0x11f746(0x21f)],'secondary_unit':_0x2b62e3['secondary_unit'],'expiry_date':_0x2b62e3[_0x11f746(0x234)]}));}),await _0x31d8bc[_0x3146c1(0x1b0)]();const _0x354e5c=await purchases[_0x3146c1(0x15d)]({'invoice':_0x1fb38f});_0x354e5c['return_data']=_0x3146c1(0x25f);const _0x5494dc=await _0x354e5c[_0x3146c1(0x1b0)](),_0x340e4b=new s_payment_data({'invoice':_0x1fb38f,'suppliers':_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1fb)],'reason':_0x3146c1(0x207)});await _0x340e4b[_0x3146c1(0x1b0)]();const _0x5b7ecf=await master_shop[_0x3146c1(0x225)]();console[_0x3146c1(0x181)](_0x3146c1(0x1ba),_0x5b7ecf[0x0]['image']);const _0x48f995=await email_settings[_0x3146c1(0x15d)](),_0x52de5f=await suppliers[_0x3146c1(0x15d)]({'name':_0x59d8f1[_0x3146c1(0x140)][_0x3146c1(0x1fb)]});console[_0x3146c1(0x181)](_0x3146c1(0x1db),_0x52de5f);_0x5b7ecf[0x0][_0x3146c1(0x236)]==0x1?(right_currency=_0x5b7ecf[0x0][_0x3146c1(0x232)],left_currency=''):(right_currency='',left_currency=_0x5b7ecf[0x0][_0x3146c1(0x232)]);var _0x2c09bd=_0x31b298,_0xdac1e7=_0x13b3b0,_0x5bc7db='',_0x123e46;for(_0x123e46 in _0x2c09bd){_0x5bc7db+=_0x3146c1(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c09bd[_0x123e46]+'</td>'+_0x3146c1(0x255)+_0xdac1e7[_0x123e46]+_0x3146c1(0x25d)+'</tr>';}console[_0x3146c1(0x181)]('product_list',_0x5bc7db);let _0x48906a=nodemailer[_0x3146c1(0x16d)]({'service':_0x3146c1(0x240),'auth':{'user':_0x48f995[_0x3146c1(0x1dc)],'pass':_0x48f995[_0x3146c1(0x1a4)]}}),_0x14d33c={'from':_0x48f995['email'],'to':_0x52de5f[_0x3146c1(0x1dc)],'subject':_0x3146c1(0x158),'attachments':[{'filename':_0x3146c1(0x23e),'path':__dirname+'/../public'+_0x3146c1(0x1e6)+_0x5b7ecf[0x0][_0x3146c1(0x256)],'cid':_0x3146c1(0x20f)}],'html':_0x3146c1(0x22d)+'<html><head><title></title>'+_0x3146c1(0x14f)+_0x3146c1(0x24b)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x3146c1(0x1ef)+_0x3146c1(0x1fa)+'<div>'+'<h2>\x20'+_0x5b7ecf[0x0][_0x3146c1(0x202)]+_0x3146c1(0x1a0)+_0x3146c1(0x1fa)+_0x3146c1(0x1fa)+_0x3146c1(0x217)+_0x3146c1(0x24b)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3146c1(0x1c6)+_0x1fb38f+'\x20'+_0x3146c1(0x149)+_0x3146c1(0x168)+_0x30ff8d+'\x20'+_0x3146c1(0x1d2)+_0x3146c1(0x14b)+_0x3146c1(0x1fa)+_0x3146c1(0x25b)+_0x3146c1(0x1bf)+'<tr>'+_0x3146c1(0x1d4)+_0x3146c1(0x251)+_0x3146c1(0x15f)+_0x3146c1(0x1b5)+_0x3146c1(0x147)+_0x3146c1(0x222)+_0x3146c1(0x229)+'\x20'+_0x5bc7db+'\x20'+_0x3146c1(0x15c)+'</table>'+_0x3146c1(0x24b)+_0x3146c1(0x1aa)+'<h5>'+_0x5b7ecf[0x0][_0x3146c1(0x202)]+_0x3146c1(0x14b)+'</div>'+_0x3146c1(0x1fa)+_0x3146c1(0x215)};_0x48906a[_0x3146c1(0x186)](_0x14d33c,function(_0x563ced,_0xbe8689){var _0x1aa6a1=_0x3146c1;_0x563ced?(console['log'](_0x563ced),console['log'](_0x1aa6a1(0x1ad))):console[_0x1aa6a1(0x181)](_0x1aa6a1(0x241));}),_0x59d8f1[_0x3146c1(0x1b2)](_0x3146c1(0x1e7),'purchases\x20item\x20return\x20successfull'),_0x290fa8[_0x3146c1(0x16e)](_0x3146c1(0x18c));}catch(_0x10b0b9){console[_0x3146c1(0x181)](_0x10b0b9),_0x290fa8['status'](0xc8)[_0x3146c1(0x188)]({'message':_0x10b0b9[_0x3146c1(0x1a7)]});}}),router['get']('/barcode/:id',auth,async(_0x1b9861,_0x15f9de)=>{var _0x279a56=a0_0x536f1a;try{const {username:_0xc1682a,email:_0x3c73ef,role:_0x43ba2a}=_0x1b9861[_0x279a56(0x1ff)],_0x155d63=_0x1b9861[_0x279a56(0x1ff)],_0xd290be=await profile[_0x279a56(0x15d)]({'email':_0x155d63[_0x279a56(0x1dc)]}),_0x241de4=await master_shop[_0x279a56(0x225)](),_0x226d8e=_0x1b9861[_0x279a56(0x1b8)]['id'],_0x220710=await purchases[_0x279a56(0x22c)](_0x226d8e);if(_0x241de4[0x0][_0x279a56(0x150)]==_0x279a56(0x142))var _0x5ccfd0=users[_0x279a56(0x1d9)];else{if(_0x241de4[0x0][_0x279a56(0x150)]=='Hindi')var _0x5ccfd0=users[_0x279a56(0x1d5)];else{if(_0x241de4[0x0][_0x279a56(0x150)]=='German')var _0x5ccfd0=users[_0x279a56(0x1b9)];else{if(_0x241de4[0x0][_0x279a56(0x150)]==_0x279a56(0x20b))var _0x5ccfd0=users['Spanish'];else{if(_0x241de4[0x0][_0x279a56(0x150)]==_0x279a56(0x1de))var _0x5ccfd0=users[_0x279a56(0x1de)];else{if(_0x241de4[0x0]['language']==_0x279a56(0x1f3))var _0x5ccfd0=users[_0x279a56(0x1b1)];else{if(_0x241de4[0x0][_0x279a56(0x150)]=='Chinese')var _0x5ccfd0=users[_0x279a56(0x208)];else{if(_0x241de4[0x0][_0x279a56(0x150)]==_0x279a56(0x238))var _0x5ccfd0=users[_0x279a56(0x233)];}}}}}}}_0x15f9de[_0x279a56(0x206)](_0x279a56(0x1be),{'success':_0x1b9861[_0x279a56(0x1b2)](_0x279a56(0x1e7)),'errors':_0x1b9861[_0x279a56(0x1b2)]('errors'),'role':_0x155d63,'profile':_0xd290be,'alldata':_0x220710,'master_shop':_0x241de4,'language':_0x5ccfd0}),console[_0x279a56(0x181)](alldata);}catch(_0x1535a1){console[_0x279a56(0x181)](_0x1535a1);}}),router[a0_0x536f1a(0x189)](a0_0x536f1a(0x156),async(_0x4b9aef,_0x41d1e8)=>{var _0x2cef7b=a0_0x536f1a;const {product_code:_0x4de29b}=_0x4b9aef[_0x2cef7b(0x140)];var _0x9e8de0;const _0xa18c3d=await product[_0x2cef7b(0x1a1)]([{'$match':{'primary_code':_0x4de29b,'product_category':_0x2cef7b(0x15e)}},{'$group':{'_id':_0x2cef7b(0x1af),'name':{'$first':'$name'},'category':{'$first':_0x2cef7b(0x230)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2cef7b(0x25e)},'alertquantity':{'$first':_0x2cef7b(0x1ed)},'product_code':{'$first':_0x2cef7b(0x1a8)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2cef7b(0x205)},'maxStocks':{'$first':_0x2cef7b(0x1bc)},'maxProdPerUnit':{'$first':_0x2cef7b(0x185)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2cef7b(0x14c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1b985e=await product['aggregate']([{'$match':{'secondary_code':_0x4de29b,'product_category':_0x2cef7b(0x15e)}},{'$group':{'_id':'$_id','name':{'$first':_0x2cef7b(0x162)},'category':{'$first':_0x2cef7b(0x230)},'brand':{'$first':_0x2cef7b(0x1b3)},'unit':{'$first':_0x2cef7b(0x25e)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2cef7b(0x1a8)},'primary_code':{'$first':_0x2cef7b(0x1f0)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2cef7b(0x1bc)},'maxProdPerUnit':{'$first':_0x2cef7b(0x185)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2cef7b(0x14c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xa18c3d[_0x2cef7b(0x18e)]>0x0)_0x9e8de0=_0xa18c3d;else _0x1b985e[_0x2cef7b(0x18e)]>0x0&&(_0x9e8de0=_0x1b985e);_0x41d1e8[_0x2cef7b(0x188)](_0x9e8de0);}),router[a0_0x536f1a(0x189)](a0_0x536f1a(0x152),async(_0x439023,_0x5109d4)=>{var _0x221ab0=a0_0x536f1a;const {primaryCode:_0x33e6ab,secondaryCode:_0x42045b,productCode:_0x256397,bay:_0x256a8b,bin:_0x5ac02e,types:_0x16f9eb,pallet:_0x1a3ea1,warehouses:_0x2f328a,room:_0x385206}=_0x439023[_0x221ab0(0x140)];console['log'](_0x439023['body']);try{const _0x1ced54=await warehouse[_0x221ab0(0x1a1)]([{'$match':{'name':_0x2f328a,'room':_0x385206}},{'$unwind':_0x221ab0(0x1a2)},{'$match':{'product_details.bay':_0x256a8b,'product_details.bin':_0x5ac02e,'product_details.type':_0x16f9eb}},{'$group':{'_id':_0x221ab0(0x1a5),'name':{'$first':_0x221ab0(0x203)},'product_stock':{'$first':_0x221ab0(0x180)},'level':{'$first':_0x221ab0(0x16b)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x221ab0(0x176)},'maxProducts':{'$first':_0x221ab0(0x1fc)}}}]);_0x5109d4['status'](0xc8)[_0x221ab0(0x188)](_0x1ced54);}catch(_0x90514a){_0x5109d4[_0x221ab0(0x13c)](0x194)['json']({'message':_0x90514a['message']});}}),module['exports']=router;