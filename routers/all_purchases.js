var a0_0x38f7e9=a0_0x4921;(function(_0x3c8a7d,_0x5ec108){var _0x2d056e=a0_0x4921,_0x191c78=_0x3c8a7d();while(!![]){try{var _0x507f80=-parseInt(_0x2d056e(0x1f8))/0x1*(-parseInt(_0x2d056e(0x281))/0x2)+-parseInt(_0x2d056e(0x1df))/0x3*(-parseInt(_0x2d056e(0x213))/0x4)+parseInt(_0x2d056e(0x272))/0x5*(parseInt(_0x2d056e(0x244))/0x6)+-parseInt(_0x2d056e(0x16f))/0x7*(parseInt(_0x2d056e(0x1aa))/0x8)+parseInt(_0x2d056e(0x17d))/0x9+parseInt(_0x2d056e(0x23a))/0xa*(parseInt(_0x2d056e(0x200))/0xb)+parseInt(_0x2d056e(0x1a3))/0xc*(-parseInt(_0x2d056e(0x22e))/0xd);if(_0x507f80===_0x5ec108)break;else _0x191c78['push'](_0x191c78['shift']());}catch(_0x14a8dd){_0x191c78['push'](_0x191c78['shift']());}}}(a0_0x5a92,0x5e7e6));const express=require(a0_0x38f7e9(0x22c)),app=express(),router=express[a0_0x38f7e9(0x17a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x38f7e9(0x199)),auth=require(a0_0x38f7e9(0x185)),nodemailer=require(a0_0x38f7e9(0x231));function a0_0x4921(_0x473172,_0xe0bb23){var _0x5a92b2=a0_0x5a92();return a0_0x4921=function(_0x49214a,_0x1f5fcd){_0x49214a=_0x49214a-0x167;var _0x3f6442=_0x5a92b2[_0x49214a];return _0x3f6442;},a0_0x4921(_0x473172,_0xe0bb23);}var ejs=require(a0_0x38f7e9(0x284));const path=require('path'),users=require(a0_0x38f7e9(0x1bc));router[a0_0x38f7e9(0x263)](a0_0x38f7e9(0x248),auth,async(_0x499191,_0x3a0184)=>{var _0x1e272a=a0_0x38f7e9;try{const {username:_0xb77f3c,email:_0x3da33b,role:_0x2d3d37}=_0x499191[_0x1e272a(0x1ac)],_0x2956d1=_0x499191[_0x1e272a(0x1ac)],_0x44ded7=await profile['findOne']({'email':_0x2956d1['email']}),_0x40b3b8=await staff[_0x1e272a(0x1d9)]({'email':_0x2956d1[_0x1e272a(0x266)]});if(_0x2956d1['role']==_0x1e272a(0x20f)){const _0x2fed8b=await staff[_0x1e272a(0x1d9)]({'email':_0x2956d1['email']});}const _0x528ad4=await master_shop[_0x1e272a(0x172)]();let _0x107698;if(_0x2956d1['role']==_0x1e272a(0x20f)){const _0x5f990b=await staff[_0x1e272a(0x1d9)]({'email':_0x2956d1['email']});_0x107698=await purchases[_0x1e272a(0x173)]([{'$match':{'warehouse_name':_0x5f990b[_0x1e272a(0x1e2)]}},{'$lookup':{'from':_0x1e272a(0x1f2),'localField':_0x1e272a(0x1f2),'foreignField':_0x1e272a(0x24e),'as':_0x1e272a(0x25e)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x1e272a(0x208),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x1e272a(0x1a5)},'warehouse_name':{'$first':_0x1e272a(0x186)},'room':{'$first':_0x1e272a(0x23b)},'product':{'$push':_0x1e272a(0x18a)},'note':{'$first':_0x1e272a(0x203)},'paid_amount':{'$first':_0x1e272a(0x22d)},'due_amount':{'$first':_0x1e272a(0x267)},'return_data':{'$first':_0x1e272a(0x19d)},'batch_code':{'$first':_0x1e272a(0x1e0)},'expiry_date':{'$first':_0x1e272a(0x1a7)},'suppliers_docs':{'$first':_0x1e272a(0x246)},'total_product_quantity':{'$sum':_0x1e272a(0x1e4)},'level':{'$addToSet':_0x1e272a(0x18e)},'isle':{'$addToSet':_0x1e272a(0x24d)},'type':{'$addToSet':_0x1e272a(0x193)},'floorlevel':{'$addToSet':_0x1e272a(0x289)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x107698=await purchases[_0x1e272a(0x173)]([{'$lookup':{'from':_0x1e272a(0x1f2),'localField':_0x1e272a(0x1f2),'foreignField':_0x1e272a(0x24e),'as':_0x1e272a(0x25e)}},{'$unwind':_0x1e272a(0x246)},{'$unwind':_0x1e272a(0x18a)},{'$group':{'_id':_0x1e272a(0x208),'invoice':{'$first':_0x1e272a(0x285)},'suppliers':{'$first':_0x1e272a(0x26d)},'date':{'$first':_0x1e272a(0x1a5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x1e272a(0x24a)},'product':{'$push':_0x1e272a(0x18a)},'note':{'$first':_0x1e272a(0x203)},'paid_amount':{'$first':_0x1e272a(0x22d)},'due_amount':{'$first':_0x1e272a(0x267)},'return_data':{'$first':_0x1e272a(0x19d)},'batch_code':{'$first':_0x1e272a(0x1e0)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1e272a(0x246)},'total_product_quantity':{'$sum':_0x1e272a(0x1e4)},'level':{'$addToSet':_0x1e272a(0x18e)},'isle':{'$addToSet':_0x1e272a(0x24d)},'type':{'$addToSet':_0x1e272a(0x193)},'floorlevel':{'$addToSet':_0x1e272a(0x289)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x528ad4[0x0][_0x1e272a(0x264)]==_0x1e272a(0x192)){var _0x31c8fc=users[_0x1e272a(0x1d7)];console[_0x1e272a(0x1f0)](_0x31c8fc);}else{if(_0x528ad4[0x0][_0x1e272a(0x264)]=='Hindi')var _0x31c8fc=users[_0x1e272a(0x237)];else{if(_0x528ad4[0x0][_0x1e272a(0x264)]==_0x1e272a(0x1fb))var _0x31c8fc=users[_0x1e272a(0x1fb)];else{if(_0x528ad4[0x0][_0x1e272a(0x264)]==_0x1e272a(0x184))var _0x31c8fc=users[_0x1e272a(0x184)];else{if(_0x528ad4[0x0]['language']==_0x1e272a(0x250))var _0x31c8fc=users[_0x1e272a(0x250)];else{if(_0x528ad4[0x0][_0x1e272a(0x264)]=='Portuguese\x20(BR)')var _0x31c8fc=users[_0x1e272a(0x182)];else{if(_0x528ad4[0x0]['language']=='Chinese')var _0x31c8fc=users['Chinese'];else{if(_0x528ad4[0x0][_0x1e272a(0x264)]==_0x1e272a(0x223))var _0x31c8fc=users[_0x1e272a(0x19c)];}}}}}}}_0x3a0184[_0x1e272a(0x25b)]('all_purchases',{'success':_0x499191[_0x1e272a(0x1d4)](_0x1e272a(0x1f9)),'errors':_0x499191[_0x1e272a(0x1d4)](_0x1e272a(0x243)),'purchases':_0x107698,'role':_0x2956d1,'profile':_0x44ded7,'master_shop':_0x528ad4,'language':_0x31c8fc});}catch(_0x3ab98d){console['log']('table\x20page',_0x3ab98d),_0x3a0184[_0x1e272a(0x197)](0xc8)['json']({'message':_0x3ab98d['message']});}});function a0_0x5a92(){var _0x5c0e33=['$suppliers_docs','product_name','/view','<h5\x20style=\x22text-align:\x20left;\x22>','$product.room_name','getDate','body','$product.bin','name','abs','French','slice','$product_details.expiry_date','finalize','Rack\x20B','isle','</tbody>','Error\x20Occurs','secondary_code_hide','prod_name','$brand','render','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','suppliers_docs','$product_details.floorlevel','edit_purchases_view','prod_secondunit','gmail','get','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','email','$due_amount','$product_details.product_stock','map','add\x20post','site_title','<strong>\x20Regards\x20</strong>','$suppliers','redirect','prod_cat','Logo.png','Chinese','155PFVCMK','prod_isle','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$maxStocks','max_product_unit','filter','$product_details.bin','production_date','room','prod_level','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','post','252872ASYnhs','actual_uom','Rack\x20C','ejs','$invoice','padStart','storage','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product.floorlevel','exports','prod_primunit','$alertquantity','types','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','room_name','$product_details.type','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_code','4809GwlrFL','$product_details.isle','primary_code','find','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/../public','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','\x20Order\x20Number\x20:\x20','Purchase\x20Mail','Router','toString','stock_data','6583977VYcfLY','prod_invoice','$product_details.level','error','JO_number','Portuguese','maxStocks','Spanish','../middleware/auth','$warehouse_name','floorlevel','role','$product_code','$product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','pallet','json','$product.bay','deliverycode','</tr>','length','English\x20(US)','$product.type','return_purchase','purchases\x20item\x20return\x20successfull','\x20<>\x20','status','add_purchases','../models/all_models','Rack\x20E','product_list','Arabic','$return_data','all','currency','<!DOCTYPE\x20html>','params','$secondary_unit','12gtXtnU','product_cat','$date','delivery_date','$expiry_date','</table>','MaxStocks_data','8648SiBZUR','warehouse_name','user','True','prod_qty','An\x20error\x20occurred\x20while\x20saving\x20data.','<html><head><title></title>','message','concat','all_purchases_barcode','user_id','\x20<\x20wew\x20>\x20','string','$product_details.pallet','$primary_code','$product_details.product_code','port','return_data','../public/language/languages.json','Paid\x20For\x20Purchase','/all_purchases/view/','</thead>','</div>','maxperunit','$product_details.secondary_code','floor','Raw\x20Materials','prod_Qty','quantity','RMSEmail','expiry_date','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/view/return_purchase/:id','image','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','master','<tbody\x20style=\x22text-align:\x20center;\x22>','rak','$product_details','Sales\x20Update\x20successfully','save','flash','here','note','English','Purchase\x20Return\x20Mail','findOne','logo','An\x20error\x20occurred.','<div>','paid_amount','Purchase\x20data\x20added\x20successfully','123IhzRpg','$batch_code','/preview/:id','warehouse','\x20Order\x20Date\x20:\x20','$product.quantity','product_code','Room_name','then','Receiving\x20Area','Return\x20Goods','stocks','secondary_code','<hr\x20class=\x22my-3\x22>','push','random','$category','log','</body></html>','suppliers','INC-','</td>','/barcode/:id','$unit','stock_quantity','4XYBNCR','success','password','German','bay','standard_unit','\x20</h2>','/all_purchases/view','6193319QhsvfC','COLD\x20STORAGE','Email\x20sent\x20successfully','$note','alertQTY','getFullYear','getMonth','/view/:id','$_id','/upload/','edit_purchases','amount','Ambient','primary_code_hide','$product_details.bay','staff','/view/add_purchases/:id','type','Level','27372GCgvzk','/invoice/:id','due_amount','</h5>','back','$product_details.product_name','$name','$product_details.storage','return_qty','add_purchases\x20error','product','POnumber','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$maxProdPerUnit','batch_code','Enabled','Arabic\x20(ae)','delivery_code','purchase_quantity','Portuguese\x20(BR)','$secondary_code','date','Shelves','actual_qty','host','express','$paid_amount','16562793KnEXsk','level','</span>','nodemailer','findById','Floor','/view/add_purchases','<tr>','product_details','Hindi','forEach','rack','10UqTOLQ','$room','$product_details._id','sendMail','prod_unit','payment\x20successfull','bin','<h2>\x20','secondary_unit','errors','62490iUcQBA','$product_details.primary_code'];a0_0x5a92=function(){return _0x5c0e33;};return a0_0x5a92();}function BayBinSelected(_0x4e04c9,_0x38b5e1){var _0x37439e=a0_0x38f7e9,_0x3a013f=[],_0x1dfc1d=[],_0x2e37b9=[],_0x27bf5d=[],_0x446640=[],_0x2143bd=[];let _0x49d45f=[];if(_0x4e04c9=='DRY\x20STORAGE')switch(_0x38b5e1){case'Rack\x20A':_0x3a013f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1dfc1d=[0x1,0x2],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212),_0x37439e(0x233)],_0x446640=['D'],_0x2143bd=['A'];break;case'Rack\x20B':_0x3a013f=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1dfc1d=[0x1,0x2],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212),_0x37439e(0x233)],_0x446640=['D'],_0x2143bd=['B'];break;case'Shelves':_0x3a013f=[0x0],_0x1dfc1d=[0x0],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=['Floor'],_0x446640=['D'],_0x2143bd=['S'];break;case _0x37439e(0x1e8):_0x3a013f=[0x0],_0x1dfc1d=[0x0],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2e37b9=[_0x37439e(0x233)],_0x446640=['D'],_0x2143bd=['R'];break;}else{if(_0x4e04c9==_0x37439e(0x201))switch(_0x38b5e1){case'Rack\x20A':_0x3a013f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1dfc1d=['B','F'],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212),'Floor'],_0x446640=['C'],_0x2143bd=['A'];break;case _0x37439e(0x254):_0x3a013f=[0x5,0x4,0x3,0x2,0x1],_0x1dfc1d=['F','B','S'],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212),_0x37439e(0x233)],_0x446640=['C'],_0x2143bd=['B'];break;case _0x37439e(0x283):_0x3a013f=[0x1,0x2,0x3,0x4,0x5],_0x1dfc1d=['B','F','S'],_0x27bf5d=[0x5,0x4,0x3,0x2,0x1],_0x2e37b9=['Level',_0x37439e(0x233)],_0x446640=['C'],_0x2143bd=['C'];break;case'Rack\x20D':_0x3a013f=[0x5,0x4,0x3,0x2,0x1],_0x1dfc1d=['F','B','S'],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212),_0x37439e(0x233)],_0x446640=['C'],_0x2143bd=['D'];break;case _0x37439e(0x19a):_0x3a013f=[0x4,0x3,0x2,0x1],_0x1dfc1d=[0x1,0x2],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212),'Floor'],_0x446640=['C'],_0x2143bd=['E'];break;case'Rack\x20F':_0x3a013f=[0x1,0x2,0x3],_0x1dfc1d=[0x1,0x2],_0x27bf5d=[0x1,0x2,0x3,0x4,0x5],_0x2e37b9=[_0x37439e(0x212)],_0x446640=['C'],_0x2143bd=['F'];break;}}return{'levels':_0x3a013f,'Isle':_0x1dfc1d,'rack':_0x27bf5d,'type':_0x2e37b9,'storage':_0x446640,'rak':_0x2143bd};}async function getRandom8DigitNumber(){var _0x41d3db=a0_0x38f7e9;const _0x565ea9=0x989680,_0x2e2416=0x5f5e0ff,_0x32a6a8=Math[_0x41d3db(0x1c3)](Math[_0x41d3db(0x1ee)]()*(_0x2e2416-_0x565ea9+0x1))+_0x565ea9;var _0x5ef1a3;const _0x2dd225=await purchases[_0x41d3db(0x1d9)]({'invoice':'INC-'+_0x32a6a8});return _0x2dd225&&_0x2dd225[_0x41d3db(0x191)]>0x0?_0x5ef1a3=_0x41d3db(0x1f3)+_0x32a6a8:_0x5ef1a3=_0x41d3db(0x1f3)+_0x32a6a8,_0x5ef1a3;}router[a0_0x38f7e9(0x263)]('/view/add_purchases',auth,async(_0x269579,_0x2a253d)=>{var _0xc0160a=a0_0x38f7e9;try{const {username:_0x1aa7be,email:_0xb31ca0,role:_0x2e5f99}=_0x269579[_0xc0160a(0x1ac)],_0x30ef66=_0x269579['user'],_0x2d3357=await profile['findOne']({'email':_0x30ef66[_0xc0160a(0x266)]}),_0x2bb4c5=await master_shop['find'](),_0x11cf84=await staff[_0xc0160a(0x1d9)]({'email':_0x30ef66['email']}),_0x51cbfa=await suppliers[_0xc0160a(0x172)]({});let _0xf9133f;if(_0x30ef66[_0xc0160a(0x188)]==_0xc0160a(0x20f)){const _0x203cea=await staff[_0xc0160a(0x1d9)]({'email':_0x30ef66[_0xc0160a(0x266)]});_0xf9133f=await warehouse['aggregate']([{'$match':{'status':_0xc0160a(0x222),'name':_0x203cea[_0xc0160a(0x1e2)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xc0160a(0x1e9)}}},{'$group':{'_id':_0xc0160a(0x219),'name':{'$first':_0xc0160a(0x219)}}}]);}else _0xf9133f=await warehouse['aggregate']([{'$match':{'status':_0xc0160a(0x222),'warehouse_category':_0xc0160a(0x1c4),'name':{'$ne':_0xc0160a(0x1e9)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x445013=await product[_0xc0160a(0x172)]({}),_0x349ab1=await warehouse[_0xc0160a(0x172)]({'status':_0xc0160a(0x222)}),_0x5e9c05=await purchases['find']({}),_0x577e4e=_0x5e9c05['length']+0x1,_0x1efe47=_0xc0160a(0x1f3)+_0x577e4e[_0xc0160a(0x17b)]()[_0xc0160a(0x286)](0x5,'0');var _0x40f5fd=[_0xc0160a(0x20c),'Enclosed'];if(_0x2bb4c5[0x0]['language']==_0xc0160a(0x192))var _0x358fc1=users[_0xc0160a(0x1d7)];else{if(_0x2bb4c5[0x0]['language']==_0xc0160a(0x237))var _0x358fc1=users['Hindi'];else{if(_0x2bb4c5[0x0][_0xc0160a(0x264)]==_0xc0160a(0x1fb))var _0x358fc1=users[_0xc0160a(0x1fb)];else{if(_0x2bb4c5[0x0]['language']==_0xc0160a(0x184))var _0x358fc1=users[_0xc0160a(0x184)];else{if(_0x2bb4c5[0x0][_0xc0160a(0x264)]==_0xc0160a(0x250))var _0x358fc1=users['French'];else{if(_0x2bb4c5[0x0]['language']==_0xc0160a(0x226))var _0x358fc1=users[_0xc0160a(0x182)];else{if(_0x2bb4c5[0x0][_0xc0160a(0x264)]==_0xc0160a(0x271))var _0x358fc1=users['Chinese'];else{if(_0x2bb4c5[0x0][_0xc0160a(0x264)]==_0xc0160a(0x223))var _0x358fc1=users[_0xc0160a(0x19c)];}}}}}}}const _0x5e564f=getRandom8DigitNumber();_0x5e564f['then'](_0x4ef392=>{var _0x5f3089=_0xc0160a;_0x2a253d[_0x5f3089(0x25b)](_0x5f3089(0x198),{'success':_0x269579[_0x5f3089(0x1d4)]('success'),'errors':_0x269579[_0x5f3089(0x1d4)](_0x5f3089(0x243)),'role':_0x30ef66,'profile':_0x2d3357,'suppliers':_0x51cbfa,'warehouse':_0xf9133f,'product':_0x445013,'invoice':_0x4ef392,'master_shop':_0x2bb4c5,'language':_0x358fc1,'find_data':_0x349ab1,'rooms_data':_0x40f5fd});})['catch'](_0x3b49f2=>{var _0x1acac7=_0xc0160a;_0x269579[_0x1acac7(0x1d4)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x2a253d[_0x1acac7(0x26e)]('/all_purchases/view');});}catch(_0x15185e){console[_0xc0160a(0x1f0)](_0x15185e);}}),router[a0_0x38f7e9(0x263)](a0_0x38f7e9(0x210),auth,async(_0x8ca5bc,_0x420767)=>{var _0x15d1be=a0_0x38f7e9;try{const _0x16d33c=_0x8ca5bc[_0x15d1be(0x1a1)]['id'];console[_0x15d1be(0x1f0)](_0x16d33c);const _0x5d7bb2=await master_shop[_0x15d1be(0x172)]();console['log'](_0x15d1be(0x1ce),_0x5d7bb2);const _0xb47e4b=await product[_0x15d1be(0x1d9)]({'name':_0x16d33c});console[_0x15d1be(0x1f0)](_0x15d1be(0x21d),_0xb47e4b),_0x420767[_0x15d1be(0x197)](0xc8)[_0x15d1be(0x18d)]({'product_data':_0xb47e4b,'master':_0x5d7bb2});}catch(_0x3f0568){console[_0x15d1be(0x1f0)](_0x15d1be(0x21c),_0x3f0568);}}),router[a0_0x38f7e9(0x280)](a0_0x38f7e9(0x234),auth,async(_0x1d2ba9,_0xc68528)=>{var _0x57ad3e=a0_0x38f7e9;try{const {invoice:_0x323466,date:_0x340586,warehouse_name:_0x1a78cd,prod_name:_0x576630,prod_code:_0x211b0b,prod_qty:_0x4ddecd,prod_unit:_0x4c8688,prod_secondunit:_0x3073f6,prod_level:_0x21e91f,prod_isle:_0x4fa437,prod_pallet:_0x43bde0,note:_0x5f047e,expiry_date:_0x815e7f,batch_code:_0x91e1db,payable:_0x4f3f07,due_amount:_0x23670a,Room_name:_0x3455ec,primary_code:_0x1f4857,secondary_code:_0x1d7559,MaxStocks_data:_0x2bbcfc,PO_number:_0x459d57,SCRN:_0x2225f4,JO_number:_0x1dace4}=_0x1d2ba9[_0x57ad3e(0x24c)];if(typeof _0x576630==_0x57ad3e(0x1b6))var _0x55c9ab=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x259)]],_0x4faa4b=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x16e)]],_0xef59d1=[_0x1d2ba9['body'][_0x57ad3e(0x1c5)]],_0x3985f4=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x28b)]],_0x5e80a5=[_0x1d2ba9[_0x57ad3e(0x24c)]['prod_secondunit']],_0x224449=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x27d)]],_0x583bd9=[_0x1d2ba9[_0x57ad3e(0x24c)]['primary_code']],_0x5cee15=[_0x1d2ba9['body'][_0x57ad3e(0x1eb)]],_0x3d5649=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x1a9)]],_0x48a37f=[_0x1d2ba9['body'][_0x57ad3e(0x221)]],_0x26b82d=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x1c8)]],_0x51c4c6=[_0x1d2ba9['body'][_0x57ad3e(0x278)]],_0x2024d0=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x204)]],_0x53e45e=[_0x1d2ba9[_0x57ad3e(0x24c)]['production_date']],_0x3e8d74=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x26f)]],_0x190aa8=[_0x1d2ba9['body']['RoomAssign']],_0x2c3ac0=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x18f)]],_0x3b7aba=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x17e)]],_0x28b441=[_0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x22a)]],_0x347245=[_0x1d2ba9['body'][_0x57ad3e(0x282)]];else var _0x55c9ab=[..._0x1d2ba9[_0x57ad3e(0x24c)]['prod_name']],_0x4faa4b=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x16e)]],_0xef59d1=[..._0x1d2ba9['body']['prod_Qty']],_0x3985f4=[..._0x1d2ba9[_0x57ad3e(0x24c)]['prod_primunit']],_0x5e80a5=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x261)]],_0x224449=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x27d)]],_0x583bd9=[..._0x1d2ba9[_0x57ad3e(0x24c)]['primary_code']],_0x5cee15=[..._0x1d2ba9['body'][_0x57ad3e(0x1eb)]],_0x3d5649=[..._0x1d2ba9[_0x57ad3e(0x24c)]['MaxStocks_data']],_0x48a37f=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x221)]],_0x26b82d=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x1c8)]],_0x51c4c6=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x278)]],_0x2024d0=[..._0x1d2ba9['body']['alertQTY']],_0x53e45e=[..._0x1d2ba9['body'][_0x57ad3e(0x27b)]],_0x3e8d74=[..._0x1d2ba9['body'][_0x57ad3e(0x26f)]],_0x190aa8=[..._0x1d2ba9[_0x57ad3e(0x24c)]['RoomAssign']],_0x2c3ac0=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x18f)]],_0x3b7aba=[..._0x1d2ba9[_0x57ad3e(0x24c)][_0x57ad3e(0x17e)]],_0x28b441=[..._0x1d2ba9['body'][_0x57ad3e(0x22a)]],_0x347245=[..._0x1d2ba9['body'][_0x57ad3e(0x282)]];const _0x564e49=_0x55c9ab[_0x57ad3e(0x269)](_0x42ac43=>{return _0x42ac43={'product_name':_0x42ac43};});_0x28b441[_0x57ad3e(0x238)]((_0x17c781,_0x18fc58)=>{var _0xb095e2=_0x57ad3e;_0x564e49[_0x18fc58][_0xb095e2(0x22a)]=Math[_0xb095e2(0x24f)](_0x17c781);}),_0x347245[_0x57ad3e(0x238)]((_0x53d006,_0x5926d8)=>{var _0x3008a0=_0x57ad3e;_0x564e49[_0x5926d8][_0x3008a0(0x282)]=_0x53d006;}),_0x4faa4b[_0x57ad3e(0x238)]((_0x520ee5,_0x2aa704)=>{var _0x5f1eb3=_0x57ad3e;_0x564e49[_0x2aa704][_0x5f1eb3(0x1e5)]=_0x520ee5;}),_0xef59d1[_0x57ad3e(0x238)]((_0x2b6cd2,_0xe5a3e4)=>{var _0x30e393=_0x57ad3e;_0x564e49[_0xe5a3e4]['quantity']=Math[_0x30e393(0x24f)](_0x2b6cd2);}),_0x3985f4[_0x57ad3e(0x238)]((_0x24f7e2,_0x4c3b13)=>{_0x564e49[_0x4c3b13]['standard_unit']=_0x24f7e2;}),_0x5e80a5['forEach']((_0x15ce46,_0x13852c)=>{var _0x4e8206=_0x57ad3e;_0x564e49[_0x13852c][_0x4e8206(0x242)]=_0x15ce46;}),_0x224449[_0x57ad3e(0x238)]((_0x555d11,_0x32edf6)=>{var _0x577fb2=_0x57ad3e;_0x190aa8[_0x577fb2(0x238)]((_0x5596c1,_0x4dd2d2)=>{var _0x243015=_0x577fb2;if(_0x5596c1==_0x243015(0x1e8)&&_0x32edf6==_0x4dd2d2){console[_0x243015(0x1f0)](_0x5596c1+_0x243015(0x1b5)+_0x32edf6+_0x243015(0x196)+_0x4dd2d2+'\x20<>\x20'+_0x555d11);var _0x24557e=_0x555d11['slice'](0x3);_0x564e49[_0x32edf6][_0x243015(0x287)]=_0x555d11[0x0],_0x564e49[_0x32edf6][_0x243015(0x239)]=_0x555d11[0x1],_0x564e49[_0x32edf6][_0x243015(0x1fc)]=0x0,_0x564e49[_0x32edf6]['bin']=0x0,_0x564e49[_0x32edf6][_0x243015(0x211)]='Floor',_0x564e49[_0x32edf6][_0x243015(0x187)]=_0x24557e;}else{if(_0x5596c1==_0x243015(0x229)&&_0x32edf6==_0x4dd2d2){var _0x24557e=_0x555d11[_0x243015(0x251)](0x3);_0x564e49[_0x32edf6][_0x243015(0x287)]=_0x555d11[0x0],_0x564e49[_0x32edf6][_0x243015(0x239)]=_0x555d11[0x1],_0x564e49[_0x32edf6][_0x243015(0x1fc)]=0x0,_0x564e49[_0x32edf6]['bin']=0x0,_0x564e49[_0x32edf6]['type']=_0x243015(0x233),_0x564e49[_0x32edf6][_0x243015(0x187)]=_0x555d11[0x5];}else{if(_0x32edf6==_0x4dd2d2){if(_0x555d11[0x0]=='A'&&_0x555d11[0x1]=='L'&&_0x555d11[0x2]=='L')console[_0x243015(0x1f0)](_0x5596c1+'\x20<>\x20'+_0x32edf6+_0x243015(0x196)+_0x4dd2d2+_0x243015(0x196)+_0x555d11+_0x243015(0x1d5)),_0x564e49[_0x32edf6][_0x243015(0x287)]=_0x555d11[0x0],_0x564e49[_0x32edf6][_0x243015(0x239)]=_0x555d11[0x1],_0x564e49[_0x32edf6][_0x243015(0x1fc)]=0x0,_0x564e49[_0x32edf6][_0x243015(0x240)]=0x0,_0x564e49[_0x32edf6][_0x243015(0x211)]=_0x243015(0x233),_0x564e49[_0x32edf6][_0x243015(0x187)]=_0x555d11[0x3];else{var _0x48a622;if(_0x555d11[0x4]=='L')_0x48a622=_0x243015(0x212);else _0x555d11[0x4]=='F'&&(_0x48a622='Floor');_0x564e49[_0x32edf6]['storage']=_0x555d11[0x0],_0x564e49[_0x32edf6][_0x243015(0x239)]=_0x555d11[0x1],_0x564e49[_0x32edf6]['bay']=_0x555d11[0x2],_0x564e49[_0x32edf6][_0x243015(0x240)]=_0x555d11[0x3],_0x564e49[_0x32edf6][_0x243015(0x211)]=_0x48a622,_0x564e49[_0x32edf6][_0x243015(0x187)]=_0x555d11[0x5];}}}}});}),_0x583bd9[_0x57ad3e(0x238)]((_0x48af68,_0x401c9a)=>{var _0x2b1c7b=_0x57ad3e;_0x564e49[_0x401c9a][_0x2b1c7b(0x171)]=_0x48af68;}),_0x5cee15[_0x57ad3e(0x238)]((_0x1af6b0,_0x17ca9c)=>{_0x564e49[_0x17ca9c]['secondary_code']=_0x1af6b0;}),_0x3d5649[_0x57ad3e(0x238)]((_0x26f90d,_0x3ce5c7)=>{var _0x251ee3=_0x57ad3e;_0x564e49[_0x3ce5c7][_0x251ee3(0x183)]=_0x26f90d;}),_0x48a37f[_0x57ad3e(0x238)]((_0x340eed,_0x4a819d)=>{var _0xe3fe1c=_0x57ad3e;_0x564e49[_0x4a819d][_0xe3fe1c(0x221)]=_0x340eed;}),_0x26b82d['forEach']((_0x5a758b,_0x20141e)=>{var _0x3472f8=_0x57ad3e;_0x564e49[_0x20141e][_0x3472f8(0x1c8)]=_0x5a758b;}),_0x51c4c6['forEach']((_0xb73a9c,_0x4962f4)=>{var _0x3fa29e=_0x57ad3e;_0x564e49[_0x4962f4][_0x3fa29e(0x1c1)]=_0xb73a9c;}),_0x2024d0['forEach']((_0x5a18de,_0x5bdd63)=>{var _0x2635a9=_0x57ad3e;_0x564e49[_0x5bdd63][_0x2635a9(0x204)]=_0x5a18de;}),_0x53e45e[_0x57ad3e(0x238)]((_0x28123e,_0x59b3f1)=>{_0x564e49[_0x59b3f1]['production_date']=_0x28123e;}),_0x3e8d74[_0x57ad3e(0x238)]((_0x5e82b9,_0x706932)=>{var _0x5147b9=_0x57ad3e;_0x564e49[_0x706932][_0x5147b9(0x1a4)]=_0x5e82b9;}),_0x190aa8[_0x57ad3e(0x238)]((_0x1aa054,_0x49e5a5)=>{var _0xd70a1d=_0x57ad3e;_0x564e49[_0x49e5a5][_0xd70a1d(0x16a)]=_0x1aa054;}),_0x2c3ac0[_0x57ad3e(0x238)]((_0x1b9bb2,_0x3747cd)=>{var _0x597bb8=_0x57ad3e;_0x564e49[_0x3747cd][_0x597bb8(0x224)]=_0x1b9bb2;}),_0x3b7aba[_0x57ad3e(0x238)]((_0x47e83f,_0x22362a)=>{var _0x519bfc=_0x57ad3e;_0x564e49[_0x22362a][_0x519bfc(0x16c)]=_0x47e83f;});const _0x2814b5=_0x190aa8['map'](_0x2787d2=>{return _0x2787d2={'room_name':_0x2787d2};}),_0x5180cd=_0x564e49[_0x57ad3e(0x279)](_0x3b506a=>_0x3b506a[_0x57ad3e(0x1c6)]!=='0'&&_0x3b506a[_0x57ad3e(0x1c6)]!==''),_0x3b6668=new purchases({'invoice':_0x323466,'suppliers':_0x1d2ba9['body'][_0x57ad3e(0x1f2)],'date':_0x340586,'warehouse_name':_0x1a78cd,'product':_0x5180cd,'note':_0x5f047e,'due_amount':_0x23670a,'POnumber':_0x459d57,'SCRN':_0x2225f4,'JO_number':_0x1dace4,'roomList':_0x2814b5}),_0xd7dd8b=await _0x3b6668[_0x57ad3e(0x1d3)](),_0x15b62b=await purchases[_0x57ad3e(0x1d9)]({'invoice':_0x323466}),_0x4ebb76=_0x15b62b[_0x57ad3e(0x21d)][_0x57ad3e(0x269)](async _0x598654=>{var _0x17e222=_0x57ad3e,_0x1d87be=await warehouse[_0x17e222(0x1d9)]({'name':_0x1a78cd,'room':_0x598654['room_name']}),_0x34ca9b=0x0;return _0x1d87be[_0x17e222(0x236)]['forEach'](_0x592cec=>{var _0x294001=_0x17e222;_0x592cec['product_name']==_0x598654[_0x294001(0x247)]&&_0x592cec[_0x294001(0x187)]==_0x598654[_0x294001(0x187)]&&_0x592cec[_0x294001(0x211)]==_0x598654[_0x294001(0x211)]&&_0x592cec[_0x294001(0x240)]==_0x598654['bin']&&_0x592cec[_0x294001(0x1fc)]==_0x598654['bay']&&_0x592cec[_0x294001(0x239)]==_0x598654[_0x294001(0x239)]&&_0x592cec['storage']==_0x598654['storage']&&_0x592cec[_0x294001(0x1c8)]==_0x598654[_0x294001(0x1c8)]&&_0x592cec['batch_code']==_0x598654['batch_code']&&_0x592cec['production_date']==_0x598654[_0x294001(0x27b)]&&_0x592cec[_0x294001(0x16c)]==_0x15b62b[_0x294001(0x16c)]&&(_0x592cec[_0x294001(0x1cc)]+=Math[_0x294001(0x24f)](_0x598654[_0x294001(0x1c6)]),_0x34ca9b++);}),_0x34ca9b===0x0&&_0x1d87be[_0x17e222(0x236)][_0x17e222(0x1ed)]({'product_name':_0x598654[_0x17e222(0x247)],'product_stock':Math['abs'](_0x598654[_0x17e222(0x1c6)]),'primary_code':_0x598654[_0x17e222(0x171)],'secondary_code':_0x598654[_0x17e222(0x1eb)],'product_code':_0x598654['product_code'],'storage':_0x598654[_0x17e222(0x287)],'rack':_0x598654['rack'],'bay':_0x598654[_0x17e222(0x1fc)],'bin':_0x598654[_0x17e222(0x240)],'type':_0x598654[_0x17e222(0x211)],'floorlevel':_0x598654['floorlevel'],'maxProducts':_0x598654[_0x17e222(0x183)],'unit':_0x598654[_0x17e222(0x1fd)],'secondary_unit':_0x598654[_0x17e222(0x242)],'expiry_date':_0x598654[_0x17e222(0x1c8)],'maxPerUnit':_0x598654[_0x17e222(0x1c1)],'batch_code':_0x598654[_0x17e222(0x221)],'alertQTY':_0x598654[_0x17e222(0x204)],'production_date':_0x598654[_0x17e222(0x27b)],'product_cat':_0x598654[_0x17e222(0x1a4)],'invoice':_0x598654[_0x17e222(0x16c)],'actual_qty':Math['abs'](_0x598654[_0x17e222(0x22a)]),'actual_uom':_0x598654[_0x17e222(0x282)]}),_0x1d87be;});Promise[_0x57ad3e(0x19e)](_0x4ebb76)[_0x57ad3e(0x1e7)](async _0x5a15ce=>{var _0x52b120=_0x57ad3e;try{for(const _0x1bc531 of _0x5a15ce){await _0x1bc531[_0x52b120(0x1d3)]();}const _0x29eef8=await master_shop[_0x52b120(0x172)](),_0x2a8f8b=await email_settings[_0x52b120(0x1d9)](),_0x2829d1=await supervisor_settings['find']();var _0x39cc65=_0x15b62b[_0x52b120(0x21d)],_0x2aca68='',_0x30367d;for(_0x30367d in _0x39cc65){_0x2aca68+='<tr>'+_0x52b120(0x21f)+_0x39cc65[_0x30367d]['product_name']+'</td>'+_0x52b120(0x21f)+_0x39cc65[_0x30367d][_0x52b120(0x1e5)]+_0x52b120(0x1f4)+_0x52b120(0x21f)+_0x39cc65[_0x30367d][_0x52b120(0x1c6)]+'</td>'+_0x52b120(0x21f)+_0x39cc65[_0x30367d]['standard_unit']+_0x52b120(0x1f4)+_0x52b120(0x21f)+_0x39cc65[_0x30367d][_0x52b120(0x242)]+_0x52b120(0x1f4)+_0x52b120(0x21f)+_0x15b62b[_0x52b120(0x1ab)]+'</td>'+_0x52b120(0x21f)+_0x39cc65[_0x30367d][_0x52b120(0x16a)]+_0x52b120(0x1f4)+_0x52b120(0x21f)+_0x39cc65[_0x30367d][_0x52b120(0x287)]+_0x39cc65[_0x30367d][_0x52b120(0x239)]+_0x39cc65[_0x30367d][_0x52b120(0x1fc)]+_0x39cc65[_0x30367d]['bin']+_0x39cc65[_0x30367d]['type'][0x0]+_0x39cc65[_0x30367d][_0x52b120(0x187)]+_0x52b120(0x1f4),_0x52b120(0x190);}let _0x15b36e=nodemailer[_0x52b120(0x275)]({'host':_0x2a8f8b[_0x52b120(0x22b)],'port':Number(_0x2a8f8b[_0x52b120(0x1ba)]),'secure':![],'auth':{'user':_0x2a8f8b[_0x52b120(0x266)],'pass':_0x2a8f8b[_0x52b120(0x1fa)]}}),_0x5eb03d={'from':_0x2a8f8b[_0x52b120(0x266)],'to':_0x2829d1[0x0][_0x52b120(0x1c7)],'subject':_0x52b120(0x179),'attachments':[{'filename':_0x52b120(0x270),'path':__dirname+_0x52b120(0x175)+'/upload/'+_0x29eef8[0x0][_0x52b120(0x1cb)],'cid':_0x52b120(0x1da)}],'html':_0x52b120(0x1a0)+_0x52b120(0x1b0)+_0x52b120(0x27e)+_0x52b120(0x1dc)+_0x52b120(0x176)+_0x52b120(0x1dc)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x52b120(0x241)+_0x29eef8[0x0]['site_title']+_0x52b120(0x1fe)+_0x52b120(0x1c0)+'</div>'+_0x52b120(0x1ec)+_0x52b120(0x1dc)+_0x52b120(0x249)+_0x52b120(0x178)+_0x15b62b[_0x52b120(0x16c)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x15b62b[_0x52b120(0x228)]+'\x20'+_0x52b120(0x230)+_0x52b120(0x216)+_0x52b120(0x1c0)+_0x52b120(0x288)+_0x52b120(0x1c9)+_0x52b120(0x235)+_0x52b120(0x174)+_0x52b120(0x27f)+_0x52b120(0x169)+_0x52b120(0x265)+_0x52b120(0x177)+_0x52b120(0x276)+_0x52b120(0x25d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x52b120(0x1cf)+'\x20'+_0x2aca68+'\x20'+_0x52b120(0x256)+_0x52b120(0x1a8)+_0x52b120(0x1dc)+_0x52b120(0x26c)+'<h5>'+_0x29eef8[0x0][_0x52b120(0x26b)]+_0x52b120(0x216)+'</div>'+_0x52b120(0x1c0)+_0x52b120(0x1f1)};_0x15b36e[_0x52b120(0x23d)](_0x5eb03d,function(_0x4ce1d0,_0x426a93){var _0x489289=_0x52b120;_0x4ce1d0?(console[_0x489289(0x1f0)](_0x4ce1d0),console[_0x489289(0x1f0)](_0x489289(0x257))):console[_0x489289(0x1f0)](_0x489289(0x202));}),_0x1d2ba9['flash'](_0x52b120(0x1f9),_0x52b120(0x1de)),_0xc68528[_0x52b120(0x26e)](_0x52b120(0x1be));}catch(_0x38500d){console[_0x52b120(0x180)](_0x38500d),_0xc68528[_0x52b120(0x197)](0x1f4)['json']({'error':_0x52b120(0x1af)});}})['catch'](_0x28c8ff=>{var _0x38a111=_0x57ad3e;console[_0x38a111(0x180)](_0x28c8ff),_0xc68528[_0x38a111(0x197)](0x1f4)[_0x38a111(0x18d)]({'error':_0x38a111(0x1db)});});}catch(_0x1ead9b){console[_0x57ad3e(0x1f0)](_0x1ead9b);}}),router[a0_0x38f7e9(0x263)](a0_0x38f7e9(0x1e1),auth,async(_0x2b9701,_0xd47be1)=>{var _0x3b2704=a0_0x38f7e9;try{const {username:_0x5af9c7,email:_0x25da37,role:_0x213aef}=_0x2b9701[_0x3b2704(0x1ac)],_0x1d37e6=_0x2b9701[_0x3b2704(0x1ac)],_0x566e49=await profile[_0x3b2704(0x1d9)]({'email':_0x1d37e6[_0x3b2704(0x266)]}),_0x3f9cb7=await master_shop[_0x3b2704(0x172)](),_0x5f367f=_0x2b9701['params']['id'],_0x98e012=await purchases[_0x3b2704(0x232)](_0x5f367f),_0x48cb0d=await warehouse['aggregate']([{'$match':{'name':_0x98e012[_0x3b2704(0x1ab)],'room':_0x98e012[_0x3b2704(0x27c)]}},{'$unwind':_0x3b2704(0x1d1)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3b2704(0x218)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3b2704(0x20e)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3b2704(0x16b)},'floorlevel':{'$first':_0x3b2704(0x25f)},'primary_code':{'$first':_0x3b2704(0x245)},'secondary_code':{'$first':_0x3b2704(0x1c2)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3b2704(0x21a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3b2704(0x252)}}}]),_0x233640=await customer['find']({});let _0x163605;if(_0x1d37e6['role']==_0x3b2704(0x20f)){const _0x3aa10d=await staff[_0x3b2704(0x1d9)]({'email':_0x1d37e6['email']});_0x163605=await warehouse[_0x3b2704(0x173)]([{'$match':{'status':_0x3b2704(0x222),'name':_0x3aa10d[_0x3b2704(0x1e2)]}},{'$group':{'_id':_0x3b2704(0x219),'name':{'$first':_0x3b2704(0x219)}}}]);}else _0x163605=await warehouse[_0x3b2704(0x173)]([{'$match':{'status':_0x3b2704(0x222)}},{'$group':{'_id':_0x3b2704(0x219),'name':{'$first':_0x3b2704(0x219)}}}]);const _0x302c4e=await product[_0x3b2704(0x172)]({}),_0xcfa953=await suppliers['find']({}),_0x3318dc=BayBinSelected(_0x98e012[_0x3b2704(0x1ab)],_0x98e012[_0x3b2704(0x27c)]);if(_0x3f9cb7[0x0][_0x3b2704(0x264)]==_0x3b2704(0x192)){var _0x4a328a=users[_0x3b2704(0x1d7)];console[_0x3b2704(0x1f0)](_0x4a328a);}else{if(_0x3f9cb7[0x0][_0x3b2704(0x264)]=='Hindi')var _0x4a328a=users[_0x3b2704(0x237)];else{if(_0x3f9cb7[0x0]['language']==_0x3b2704(0x1fb))var _0x4a328a=users[_0x3b2704(0x1fb)];else{if(_0x3f9cb7[0x0]['language']==_0x3b2704(0x184))var _0x4a328a=users[_0x3b2704(0x184)];else{if(_0x3f9cb7[0x0][_0x3b2704(0x264)]==_0x3b2704(0x250))var _0x4a328a=users[_0x3b2704(0x250)];else{if(_0x3f9cb7[0x0]['language']==_0x3b2704(0x226))var _0x4a328a=users[_0x3b2704(0x182)];else{if(_0x3f9cb7[0x0][_0x3b2704(0x264)]==_0x3b2704(0x271))var _0x4a328a=users[_0x3b2704(0x271)];else{if(_0x3f9cb7[0x0]['language']==_0x3b2704(0x223))var _0x4a328a=users[_0x3b2704(0x19c)];}}}}}}}_0xd47be1[_0x3b2704(0x25b)](_0x3b2704(0x260),{'success':_0x2b9701[_0x3b2704(0x1d4)](_0x3b2704(0x1f9)),'errors':_0x2b9701[_0x3b2704(0x1d4)](_0x3b2704(0x243)),'role':_0x1d37e6,'profile':_0x566e49,'customer':_0x233640,'warehouse':_0x163605,'product':_0x48cb0d,'user':_0x98e012,'master_shop':_0x3f9cb7,'unit':_0x302c4e,'language':_0x4a328a,'suppliers':_0xcfa953,'dataSelected':_0x3318dc});}catch(_0x19acaf){console[_0x3b2704(0x1f0)](_0x19acaf);}}),router[a0_0x38f7e9(0x280)](a0_0x38f7e9(0x1e1),auth,async(_0x33c8ef,_0x41f42d)=>{var _0x1a9e73=a0_0x38f7e9;try{const _0x28600c=_0x33c8ef['params']['id'],{invoice:_0x243397,warehouse_name:_0x449dab,Room_name:_0xc23a1f}=_0x33c8ef[_0x1a9e73(0x24c)],_0x113cfe=await warehouse[_0x1a9e73(0x1d9)]({'name':_0x449dab,'room':_0xc23a1f}),_0x13d412=await purchases['findOne']({'invoice':_0x243397});_0x13d412[_0x1a9e73(0x21d)][_0x1a9e73(0x238)](_0x248cdd=>{var _0x10bd54=_0x1a9e73,_0x38d33e=0x0;const _0x1c5c44=_0x113cfe['product_details'][_0x10bd54(0x269)](_0x50be84=>{var _0x490870=_0x10bd54;_0x50be84['product_name']==_0x248cdd['product_name']&&_0x50be84['floorlevel']==_0x248cdd[_0x490870(0x187)]&&_0x50be84[_0x490870(0x211)]==_0x248cdd[_0x490870(0x211)]&&_0x50be84[_0x490870(0x240)]==_0x248cdd[_0x490870(0x240)]&&_0x50be84[_0x490870(0x1fc)]==_0x248cdd['bay']&&_0x50be84[_0x490870(0x239)]==_0x248cdd[_0x490870(0x239)]&&_0x50be84['storage']==_0x248cdd[_0x490870(0x287)]&&_0x50be84['expiry_date']==_0x248cdd[_0x490870(0x1c8)]&&_0x50be84['batch_code']==_0x248cdd[_0x490870(0x221)]&&_0x50be84[_0x490870(0x27b)]==_0x248cdd[_0x490870(0x27b)]&&_0x50be84[_0x490870(0x1a6)]==_0x248cdd[_0x490870(0x1a6)]&&_0x50be84[_0x490870(0x224)]==_0x248cdd[_0x490870(0x224)]&&(_0x50be84[_0x490870(0x1cc)]=parseInt(_0x50be84[_0x490870(0x1cc)])+parseInt(_0x248cdd['quantity']),_0x38d33e++);});_0x38d33e=='0'&&(_0x113cfe[_0x10bd54(0x236)]=_0x113cfe[_0x10bd54(0x236)][_0x10bd54(0x1b2)]({'product_name':_0x248cdd['product_name'],'product_stock':_0x248cdd[_0x10bd54(0x1c6)],'primary_code':_0x248cdd[_0x10bd54(0x171)],'secondary_code':_0x248cdd[_0x10bd54(0x1eb)],'product_code':_0x248cdd[_0x10bd54(0x1e5)],'storage':_0x248cdd[_0x10bd54(0x287)],'rack':_0x248cdd[_0x10bd54(0x239)],'bay':_0x248cdd[_0x10bd54(0x1fc)],'bin':_0x248cdd[_0x10bd54(0x240)],'type':_0x248cdd['type'],'floorlevel':_0x248cdd[_0x10bd54(0x187)],'maxProducts':_0x248cdd[_0x10bd54(0x183)],'unit':_0x248cdd[_0x10bd54(0x1fd)],'secondary_unit':_0x248cdd['secondary_unit'],'expiry_date':_0x248cdd[_0x10bd54(0x1c8)],'maxPerUnit':_0x248cdd[_0x10bd54(0x1c1)],'batch_code':_0x248cdd['batch_code'],'alertQTY':_0x248cdd[_0x10bd54(0x204)],'production_date':_0x248cdd[_0x10bd54(0x27b)],'delivery_date':_0x248cdd[_0x10bd54(0x1a6)],'delivery_code':_0x248cdd[_0x10bd54(0x224)]}));}),await _0x113cfe[_0x1a9e73(0x1d3)](),_0x13d412[_0x1a9e73(0x253)]=_0x1a9e73(0x1ad);const _0x2ef91e=await _0x13d412[_0x1a9e73(0x1d3)]();_0x33c8ef[_0x1a9e73(0x1d4)](_0x1a9e73(0x1f9),_0x1a9e73(0x1d2)),_0x41f42d['redirect']('/all_purchases/view');}catch(_0x4bda34){console[_0x1a9e73(0x1f0)](_0x4bda34);}}),router[a0_0x38f7e9(0x263)]('/view/:id',auth,async(_0x47aab8,_0x305b87)=>{var _0x22fefb=a0_0x38f7e9;try{const {username:_0x574f84,email:_0xc35e22,role:_0x51896e}=_0x47aab8['user'],_0x38c4bf=_0x47aab8['user'],_0x4f3d48=await profile[_0x22fefb(0x1d9)]({'email':_0x38c4bf[_0x22fefb(0x266)]}),_0x25a03c=await master_shop[_0x22fefb(0x172)](),_0x2af5b8=_0x47aab8[_0x22fefb(0x1a1)]['id'],_0x30f456=await purchases[_0x22fefb(0x232)](_0x2af5b8),_0x5b9546=await suppliers[_0x22fefb(0x172)]({});let _0x2a7347;if(_0x38c4bf[_0x22fefb(0x188)]==_0x22fefb(0x20f)){const _0x2d645c=await staff['findOne']({'email':_0x38c4bf[_0x22fefb(0x266)]});_0x2a7347=await warehouse[_0x22fefb(0x172)]({'status':'Enabled','name':_0x2d645c[_0x22fefb(0x1e2)],'warehouse_category':_0x22fefb(0x1c4)});}else _0x2a7347=await warehouse[_0x22fefb(0x173)]([{'$match':{'status':_0x22fefb(0x222),'warehouse_category':_0x22fefb(0x1c4)}},{'$group':{'_id':_0x22fefb(0x219),'name':{'$first':'$name'}}}]);const _0x56ae50=await product['find']({}),_0x21f4c5=BayBinSelected(_0x30f456[_0x22fefb(0x1ab)],_0x30f456[_0x22fefb(0x27c)]);let _0x5cafbc=new Date(_0x30f456[_0x22fefb(0x1c8)]),_0x2b47da=('0'+_0x5cafbc[_0x22fefb(0x24b)]())['slice'](-0x2),_0x351850=('0'+(_0x5cafbc[_0x22fefb(0x206)]()+0x1))[_0x22fefb(0x251)](-0x2),_0x152269=_0x5cafbc['getFullYear'](),_0x16def7=_0x152269+'-'+_0x351850+'-'+_0x2b47da;if(_0x25a03c[0x0][_0x22fefb(0x264)]=='English\x20(US)'){var _0x474681=users['English'];console['log'](_0x474681);}else{if(_0x25a03c[0x0][_0x22fefb(0x264)]==_0x22fefb(0x237))var _0x474681=users[_0x22fefb(0x237)];else{if(_0x25a03c[0x0][_0x22fefb(0x264)]=='German')var _0x474681=users[_0x22fefb(0x1fb)];else{if(_0x25a03c[0x0][_0x22fefb(0x264)]=='Spanish')var _0x474681=users[_0x22fefb(0x184)];else{if(_0x25a03c[0x0][_0x22fefb(0x264)]==_0x22fefb(0x250))var _0x474681=users[_0x22fefb(0x250)];else{if(_0x25a03c[0x0]['language']=='Portuguese\x20(BR)')var _0x474681=users[_0x22fefb(0x182)];else{if(_0x25a03c[0x0][_0x22fefb(0x264)]==_0x22fefb(0x271))var _0x474681=users[_0x22fefb(0x271)];else{if(_0x25a03c[0x0]['language']=='Arabic\x20(ae)')var _0x474681=users[_0x22fefb(0x19c)];}}}}}}}_0x305b87[_0x22fefb(0x25b)](_0x22fefb(0x20a),{'success':_0x47aab8[_0x22fefb(0x1d4)](_0x22fefb(0x1f9)),'errors':_0x47aab8[_0x22fefb(0x1d4)](_0x22fefb(0x243)),'role':_0x38c4bf,'profile':_0x4f3d48,'purchases':_0x30f456,'suppliers':_0x5b9546,'warehouse':_0x2a7347,'product':_0x56ae50,'master_shop':_0x25a03c,'language':_0x474681,'ed_fullDate':_0x16def7,'dataSelected':_0x21f4c5});}catch(_0x1d1297){console[_0x22fefb(0x1f0)](_0x1d1297);}}),router[a0_0x38f7e9(0x280)](a0_0x38f7e9(0x207),auth,async(_0x14ba34,_0x5e330a)=>{var _0x1b1091=a0_0x38f7e9;try{const _0x2e7041=_0x14ba34[_0x1b1091(0x1a1)]['id'],_0x4f9fc8=await purchases[_0x1b1091(0x1d9)]({'_id':_0x14ba34[_0x1b1091(0x1a1)]['id']}),_0x1b67ae=await warehouse[_0x1b1091(0x1d9)]({'name':_0x4f9fc8[_0x1b1091(0x1ab)],'room':_0x4f9fc8[_0x1b1091(0x27c)]});_0x4f9fc8['product']['forEach'](_0x5b0934=>{var _0x108274=_0x1b1091;const _0x62c02d=_0x1b67ae[_0x108274(0x236)]['map'](_0x4e3dde=>{var _0x2d2e49=_0x108274;_0x4e3dde['product_name']==_0x5b0934['product_name']&&_0x4e3dde[_0x2d2e49(0x187)]==_0x5b0934[_0x2d2e49(0x187)]&&_0x4e3dde[_0x2d2e49(0x211)]==_0x5b0934['type']&&_0x4e3dde['bin']==_0x5b0934[_0x2d2e49(0x240)]&&_0x4e3dde[_0x2d2e49(0x1fc)]==_0x5b0934[_0x2d2e49(0x1fc)]&&_0x4e3dde[_0x2d2e49(0x239)]==_0x5b0934[_0x2d2e49(0x239)]&&_0x4e3dde['storage']==_0x5b0934[_0x2d2e49(0x287)]&&(_0x4e3dde[_0x2d2e49(0x1cc)]=parseInt(_0x4e3dde[_0x2d2e49(0x1cc)])-parseInt(_0x5b0934[_0x2d2e49(0x1c6)]));});}),await _0x1b67ae['save']();const {invoice:_0x29d324,suppliers:_0xc481f,date:_0x5c5470,warehouse_name:_0x22f878,prod_name:_0x1d5638,prod_code:_0x14e5d2,prod_qty:_0x294418,prod_unit:_0x58d62a,prod_secondunit:_0x5442ba,prod_level:_0x4dfc05,prod_isle:_0x22555d,prod_pallet:_0x1f6c43,note:_0x29bf40,expiry_date:_0x580e15,batch_code:_0x14d21b,paid_amount:_0x30b9f8,due_amount:_0x1d17b8,Room_name:_0x1cdff1,primary_code:_0xab84ef,secondary_code:_0x42db1d,PO_number:_0x1e6dec,JO_number:_0x4ca8e9}=_0x14ba34[_0x1b1091(0x24c)];if(typeof _0x1d5638=='string')var _0x5d4faf=[_0x14ba34['body']['prod_name']],_0x47bc55=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x16e)]],_0x3abdbe=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x1ae)]],_0x54303f=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x23e)]],_0x31cde6=[_0x14ba34[_0x1b1091(0x24c)]['prod_secondunit']],_0x327ecf=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x27d)]],_0x6053f0=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x273)]],_0x26c03a=[_0x14ba34[_0x1b1091(0x24c)]['prod_pallet']],_0x35f857=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x171)]],_0x4d9b64=[_0x14ba34['body'][_0x1b1091(0x1eb)]],_0x14b414=[_0x14ba34[_0x1b1091(0x24c)]['MaxStocks_data']],_0x1ffc7a=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x221)]],_0x2533cb=[_0x14ba34['body'][_0x1b1091(0x1c8)]],_0x4e1d69=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x287)]],_0x538704=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x1d0)]],_0x401335=[_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x211)]];else var _0x5d4faf=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x259)]],_0x47bc55=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x16e)]],_0x3abdbe=[..._0x14ba34['body'][_0x1b1091(0x1ae)]],_0x54303f=[..._0x14ba34[_0x1b1091(0x24c)]['prod_unit']],_0x31cde6=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x261)]],_0x327ecf=[..._0x14ba34[_0x1b1091(0x24c)]['prod_level']],_0x6053f0=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x273)]],_0x26c03a=[..._0x14ba34[_0x1b1091(0x24c)]['prod_pallet']],_0x35f857=[..._0x14ba34[_0x1b1091(0x24c)]['primary_code']],_0x4d9b64=[..._0x14ba34['body']['secondary_code']],_0x14b414=[..._0x14ba34['body']['MaxStocks_data']],_0x1ffc7a=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x221)]],_0x2533cb=[..._0x14ba34[_0x1b1091(0x24c)]['expiry_date']],_0x4e1d69=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x287)]],_0x538704=[..._0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x1d0)]],_0x401335=[..._0x14ba34[_0x1b1091(0x24c)]['type']];const _0x152cfa=_0x5d4faf[_0x1b1091(0x269)](_0x136491=>{return _0x136491={'product_name':_0x136491};});_0x47bc55[_0x1b1091(0x238)]((_0x56e415,_0x257572)=>{var _0xeeded7=_0x1b1091;_0x152cfa[_0x257572][_0xeeded7(0x1e5)]=_0x56e415;}),_0x3abdbe['forEach']((_0x4d2611,_0x55a0ac)=>{var _0x5761bc=_0x1b1091;_0x152cfa[_0x55a0ac][_0x5761bc(0x1c6)]=_0x4d2611;}),_0x54303f[_0x1b1091(0x238)]((_0x1236f3,_0x1fadd8)=>{var _0x1ab8be=_0x1b1091;_0x152cfa[_0x1fadd8][_0x1ab8be(0x1fd)]=_0x1236f3;}),_0x31cde6[_0x1b1091(0x238)]((_0x2fb28a,_0x12fe3d)=>{_0x152cfa[_0x12fe3d]['secondary_unit']=_0x2fb28a;}),_0x327ecf['forEach']((_0x559aeb,_0x3cee14)=>{var _0x14be1b=_0x1b1091;_0x152cfa[_0x3cee14][_0x14be1b(0x1fc)]=_0x559aeb;}),_0x6053f0[_0x1b1091(0x238)]((_0x5a1a79,_0x2f9034)=>{var _0x5285f9=_0x1b1091;_0x152cfa[_0x2f9034][_0x5285f9(0x240)]=_0x5a1a79;}),_0x26c03a[_0x1b1091(0x238)]((_0x1da841,_0x3d926e)=>{_0x152cfa[_0x3d926e]['floorlevel']=_0x1da841;}),_0x35f857[_0x1b1091(0x238)]((_0x4dda45,_0x50ec17)=>{var _0x40551b=_0x1b1091;_0x152cfa[_0x50ec17][_0x40551b(0x171)]=_0x4dda45;}),_0x4d9b64[_0x1b1091(0x238)]((_0x183c8e,_0x3c80dd)=>{var _0x271b17=_0x1b1091;_0x152cfa[_0x3c80dd][_0x271b17(0x1eb)]=_0x183c8e;}),_0x14b414[_0x1b1091(0x238)]((_0x3e0eb7,_0x71516e)=>{var _0x1669fd=_0x1b1091;_0x152cfa[_0x71516e][_0x1669fd(0x183)]=_0x3e0eb7;}),_0x1ffc7a[_0x1b1091(0x238)]((_0x4cad16,_0x36f7ca)=>{var _0xeb394f=_0x1b1091;_0x152cfa[_0x36f7ca][_0xeb394f(0x221)]=_0x4cad16;}),_0x2533cb[_0x1b1091(0x238)]((_0x391ce0,_0xc72e22)=>{var _0x4f0852=_0x1b1091;_0x152cfa[_0xc72e22][_0x4f0852(0x1c8)]=_0x391ce0;}),_0x401335[_0x1b1091(0x238)]((_0x1c6ae0,_0x1218dc)=>{var _0x5ed031=_0x1b1091;_0x152cfa[_0x1218dc][_0x5ed031(0x211)]=_0x1c6ae0;}),_0x4e1d69[_0x1b1091(0x238)]((_0x591826,_0x29bcc)=>{var _0x3024ba=_0x1b1091;_0x152cfa[_0x29bcc][_0x3024ba(0x287)]=_0x591826;}),_0x538704[_0x1b1091(0x238)]((_0x28d3d9,_0x5d05b0)=>{var _0x3d9686=_0x1b1091;_0x152cfa[_0x5d05b0][_0x3d9686(0x239)]=_0x28d3d9;});const _0x2c7751=_0x152cfa[_0x1b1091(0x279)](_0x295c6c=>_0x295c6c[_0x1b1091(0x1c6)]!=='0'&&_0x295c6c[_0x1b1091(0x1c6)]!=='');_0x4f9fc8[_0x1b1091(0x16c)]=_0x29d324,_0x4f9fc8['suppliers']=_0xc481f,_0x4f9fc8[_0x1b1091(0x228)]=_0x5c5470,_0x4f9fc8[_0x1b1091(0x1ab)]=_0x22f878,_0x4f9fc8[_0x1b1091(0x21d)]=_0x2c7751,_0x4f9fc8[_0x1b1091(0x1d6)]=_0x29bf40,_0x4f9fc8[_0x1b1091(0x1dd)]=_0x30b9f8,_0x4f9fc8[_0x1b1091(0x215)]=_0x1d17b8,_0x4f9fc8['room']=_0x1cdff1,_0x4f9fc8[_0x1b1091(0x21e)]=_0x1e6dec,_0x4f9fc8[_0x1b1091(0x181)]=_0x4ca8e9;const _0xcc0a42=await _0x4f9fc8[_0x1b1091(0x1d3)](),_0x4ead5a=await warehouse['findOne']({'name':_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x1ab)],'room':_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x1e6)]});_0x4f9fc8[_0x1b1091(0x21d)][_0x1b1091(0x238)](_0x5e577d=>{var _0x230bbc=_0x1b1091,_0x5b1ae6=0x0;const _0x516de0=_0x4ead5a['product_details'][_0x230bbc(0x269)](_0x5669e8=>{var _0xc9e1f7=_0x230bbc;_0x5669e8['product_name']==_0x5e577d['product_name']&&_0x5669e8[_0xc9e1f7(0x187)]==_0x5e577d[_0xc9e1f7(0x187)]&&_0x5669e8[_0xc9e1f7(0x211)]==_0x5e577d[_0xc9e1f7(0x211)]&&_0x5669e8[_0xc9e1f7(0x240)]==_0x5e577d[_0xc9e1f7(0x240)]&&_0x5669e8[_0xc9e1f7(0x1fc)]==_0x5e577d[_0xc9e1f7(0x1fc)]&&_0x5669e8[_0xc9e1f7(0x239)]==_0x5e577d[_0xc9e1f7(0x239)]&&_0x5669e8[_0xc9e1f7(0x287)]==_0x5e577d['storage']&&(_0x5669e8[_0xc9e1f7(0x1cc)]=parseInt(_0x5669e8[_0xc9e1f7(0x1cc)])+parseInt(_0x5e577d[_0xc9e1f7(0x1c6)]),_0x5b1ae6++);});_0x5b1ae6=='0'&&(_0x4ead5a[_0x230bbc(0x236)]=_0x4ead5a['product_details']['concat']({'product_name':_0x5e577d[_0x230bbc(0x247)],'product_stock':_0x5e577d[_0x230bbc(0x1c6)],'primary_code':_0x5e577d[_0x230bbc(0x171)],'secondary_code':_0x5e577d[_0x230bbc(0x1eb)],'product_code':_0x5e577d['product_code'],'storage':_0x5e577d[_0x230bbc(0x287)],'rack':_0x5e577d[_0x230bbc(0x239)],'bay':_0x5e577d['bay'],'bin':_0x5e577d[_0x230bbc(0x240)],'type':_0x5e577d[_0x230bbc(0x211)],'floorlevel':_0x5e577d[_0x230bbc(0x187)],'maxProducts':_0x5e577d[_0x230bbc(0x183)],'unit':_0x5e577d[_0x230bbc(0x1fd)],'secondary_unit':_0x5e577d[_0x230bbc(0x242)],'expiry_date':_0x5e577d[_0x230bbc(0x1c8)]}));}),await _0x4ead5a[_0x1b1091(0x1d3)]();const _0x5c1a73=await s_payment_data[_0x1b1091(0x1d9)]({'invoice':_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x16c)]});if(_0x5c1a73===null){}else console['log'](_0x1b1091(0x1f2),_0x5c1a73,_0x14ba34['body']['invoice']),_0x5c1a73[_0x1b1091(0x1f2)]=_0x14ba34[_0x1b1091(0x24c)][_0x1b1091(0x1f2)],await _0x5c1a73[_0x1b1091(0x1d3)]();_0x14ba34[_0x1b1091(0x1d4)](_0x1b1091(0x1f9),'purchase\x20data\x20update\x20successfully'),_0x5e330a[_0x1b1091(0x26e)](_0x1b1091(0x1ff));}catch(_0x47292c){console[_0x1b1091(0x1f0)](_0x47292c);}}),router['post']('/give_payment/:id',auth,async(_0x2d90ed,_0x3394bc)=>{var _0x57deab=a0_0x38f7e9;try{const _0x5624f0=_0x2d90ed['params']['id'],{invoice:_0x7579d0,suppliers:_0x3bea7b,payable:_0x3b6e9d,due_amount:_0x5377da}=_0x2d90ed[_0x57deab(0x24c)],_0x2fc688=await purchases[_0x57deab(0x232)](_0x5624f0);var _0x45b25d=_0x3b6e9d-_0x5377da;_0x2fc688[_0x57deab(0x1dd)]=parseFloat(_0x2fc688[_0x57deab(0x1dd)])+parseFloat(_0x5377da),_0x2fc688[_0x57deab(0x215)]=_0x45b25d;const _0x553ec7=await _0x2fc688[_0x57deab(0x1d3)]();console['log'](_0x553ec7);const _0x6f8b6c=await s_payment_data[_0x57deab(0x1d9)]({'invoice':_0x7579d0});_0x6f8b6c[_0x57deab(0x20b)]=_0x45b25d,await _0x6f8b6c['save']();let _0x16e205=new Date(),_0x11c4c1=('0'+_0x16e205[_0x57deab(0x24b)]())[_0x57deab(0x251)](-0x2),_0x1b945b=('0'+(_0x16e205[_0x57deab(0x206)]()+0x1))[_0x57deab(0x251)](-0x2),_0xd7b866=_0x16e205[_0x57deab(0x205)](),_0x5dc5cc=_0xd7b866+'-'+_0x1b945b+'-'+_0x11c4c1;const _0x28a0ba=new suppliers_payment({'invoice':_0x7579d0,'date':_0xd7b866+'-'+_0x1b945b+'-'+_0x11c4c1,'suppliers':_0x3bea7b,'reason':_0x57deab(0x1bd),'amount':_0x5377da}),_0x337b9d=await _0x28a0ba['save']();_0x2d90ed[_0x57deab(0x1d4)](_0x57deab(0x1f9),_0x57deab(0x23f)),_0x3394bc[_0x57deab(0x26e)](_0x57deab(0x1ff));}catch(_0x26872f){console[_0x57deab(0x1f0)](_0x26872f);}}),router[a0_0x38f7e9(0x263)](a0_0x38f7e9(0x214),auth,async(_0x4c360e,_0x4e46bb)=>{var _0x44e595=a0_0x38f7e9;try{const {username:_0x5844cd,email:_0x5f1671,role:_0x1da040}=_0x4c360e['user'],_0x498d8b=_0x4c360e[_0x44e595(0x1ac)],_0x2838e8=await profile[_0x44e595(0x1d9)]({'email':_0x498d8b[_0x44e595(0x266)]}),_0x149a50=await master_shop[_0x44e595(0x172)]();console['log'](_0x44e595(0x1ce),_0x149a50);const _0x13f357=_0x4c360e['params']['id'],_0x3f4709=await purchases[_0x44e595(0x232)](_0x13f357);console['log'](_0x3f4709);const _0x3516d7=await suppliers['findOne']({'name':_0x3f4709[_0x44e595(0x1f2)]});console['log'](_0x3516d7);if(_0x149a50[0x0][_0x44e595(0x264)]==_0x44e595(0x192)){var _0x298806=users[_0x44e595(0x1d7)];console[_0x44e595(0x1f0)](_0x298806);}else{if(_0x149a50[0x0]['language']==_0x44e595(0x237))var _0x298806=users[_0x44e595(0x237)];else{if(_0x149a50[0x0]['language']==_0x44e595(0x1fb))var _0x298806=users['German'];else{if(_0x149a50[0x0][_0x44e595(0x264)]=='Spanish')var _0x298806=users['Spanish'];else{if(_0x149a50[0x0]['language']==_0x44e595(0x250))var _0x298806=users[_0x44e595(0x250)];else{if(_0x149a50[0x0][_0x44e595(0x264)]==_0x44e595(0x226))var _0x298806=users['Portuguese'];else{if(_0x149a50[0x0][_0x44e595(0x264)]==_0x44e595(0x271))var _0x298806=users[_0x44e595(0x271)];else{if(_0x149a50[0x0][_0x44e595(0x264)]==_0x44e595(0x223))var _0x298806=users[_0x44e595(0x19c)];}}}}}}}_0x4e46bb['render']('purchase_invoice',{'success':_0x4c360e[_0x44e595(0x1d4)](_0x44e595(0x1f9)),'errors':_0x4c360e[_0x44e595(0x1d4)](_0x44e595(0x243)),'role':_0x498d8b,'profile':_0x2838e8,'master_shop':_0x149a50,'supplier':_0x3516d7,'purchase':_0x3f4709,'language':_0x298806});}catch(_0x26e734){console[_0x44e595(0x1f0)](_0x26e734);}}),router[a0_0x38f7e9(0x263)]('/view/return_purchase/:id',auth,async(_0x38d340,_0x3b3626)=>{var _0x5aeb5f=a0_0x38f7e9;try{const {username:_0x91c439,email:_0xc5d52c,role:_0x3779aa}=_0x38d340[_0x5aeb5f(0x1ac)],_0xabd628=_0x38d340[_0x5aeb5f(0x1ac)],_0x46e0a6=await profile[_0x5aeb5f(0x1d9)]({'email':_0xabd628[_0x5aeb5f(0x266)]}),_0x568e98=await master_shop[_0x5aeb5f(0x172)]();console['log']('master',_0x568e98);const _0x3da406=_0x38d340[_0x5aeb5f(0x1a1)]['id'];console[_0x5aeb5f(0x1f0)](_0x3da406);const _0x45f717=await purchases[_0x5aeb5f(0x232)](_0x3da406);console[_0x5aeb5f(0x1f0)](_0x5aeb5f(0x1b4),_0x45f717);const _0x562e41=await product[_0x5aeb5f(0x172)]({}),_0x91055=await warehouse['aggregate']([{'$match':{'name':_0x45f717['warehouse_name'],'room':_0x45f717[_0x5aeb5f(0x27c)],'warehouse_category':_0x5aeb5f(0x1c4)}},{'$unwind':_0x5aeb5f(0x1d1)},{'$group':{'_id':_0x5aeb5f(0x23c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5aeb5f(0x268)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5aeb5f(0x27a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5aeb5f(0x25f)},'primary_code':{'$first':_0x5aeb5f(0x245)},'secondary_code':{'$first':_0x5aeb5f(0x1c2)},'product_code':{'$first':_0x5aeb5f(0x1b9)},'storage':{'$first':_0x5aeb5f(0x21a)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x5aeb5f(0x173)]([{'$match':{'status':_0x5aeb5f(0x222),'name':_0x5aeb5f(0x1e9),'warehouse_category':_0x5aeb5f(0x1c4)}},{'$group':{'_id':_0x5aeb5f(0x219),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x5aeb5f(0x1f0)](_0x5aeb5f(0x17c),_0x91055);if(_0x568e98[0x0][_0x5aeb5f(0x264)]=='English\x20(US)'){var _0x4239b9=users['English'];console['log'](_0x4239b9);}else{if(_0x568e98[0x0][_0x5aeb5f(0x264)]=='Hindi')var _0x4239b9=users[_0x5aeb5f(0x237)];else{if(_0x568e98[0x0]['language']==_0x5aeb5f(0x1fb))var _0x4239b9=users['German'];else{if(_0x568e98[0x0][_0x5aeb5f(0x264)]==_0x5aeb5f(0x184))var _0x4239b9=users['Spanish'];else{if(_0x568e98[0x0][_0x5aeb5f(0x264)]==_0x5aeb5f(0x250))var _0x4239b9=users[_0x5aeb5f(0x250)];else{if(_0x568e98[0x0][_0x5aeb5f(0x264)]=='Portuguese\x20(BR)')var _0x4239b9=users[_0x5aeb5f(0x182)];else{if(_0x568e98[0x0]['language']=='Chinese')var _0x4239b9=users[_0x5aeb5f(0x271)];else{if(_0x568e98[0x0][_0x5aeb5f(0x264)]==_0x5aeb5f(0x223))var _0x4239b9=users[_0x5aeb5f(0x19c)];}}}}}}}_0x3b3626[_0x5aeb5f(0x25b)](_0x5aeb5f(0x194),{'success':_0x38d340[_0x5aeb5f(0x1d4)](_0x5aeb5f(0x1f9)),'errors':_0x38d340[_0x5aeb5f(0x1d4)](_0x5aeb5f(0x243)),'role':_0xabd628,'profile':_0x46e0a6,'user':_0x45f717,'stock':_0x91055,'master_shop':_0x568e98,'product':_0x562e41,'language':_0x4239b9,'warehouse':warehouse_data});}catch(_0x58542d){console[_0x5aeb5f(0x1f0)](_0x58542d);}}),router[a0_0x38f7e9(0x280)](a0_0x38f7e9(0x1ca),auth,async(_0x347d90,_0x62c6c4)=>{var _0x483b6f=a0_0x38f7e9;try{const {invoice:_0x2538ca,date:_0x267e49,warehouse_name:_0x30b857,Room_name:_0x4e4653,product_name:_0x35f270,purchase_quantity:_0x138167,stocks:_0x49de9c,return_qty:_0x3bd0c3,note:_0x320ec4,level:_0xb39413,isle:_0x275d85,pallet:_0x555080,to_warehouse_name:_0x4ce418,to_Room_name:_0x3b3116}=_0x347d90[_0x483b6f(0x24c)],_0x1e21ba=await purchases[_0x483b6f(0x1d9)]({'_id':_0x347d90[_0x483b6f(0x1a1)]['id']}),_0x3c9a2f=await warehouse['findOne']({'name':_0x30b857,'room':_0x4e4653});if(typeof _0x35f270==_0x483b6f(0x1b6))var _0x3bf2b5=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x247)]],_0xca57fd=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x225)]],_0x489be1=[_0x347d90['body']['stocks']],_0x1acde2=[_0x347d90[_0x483b6f(0x24c)]['return_qty']],_0x16d954=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x22f)]],_0x439adf=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x255)]],_0x5b170e=[_0x347d90['body'][_0x483b6f(0x18c)]],_0x3c74e3=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x168)]],_0x22150a=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x25c)]],_0xbaf54c=[_0x347d90['body'][_0x483b6f(0x20d)]],_0x32192a=[_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x258)]];else var _0x3bf2b5=[..._0x347d90[_0x483b6f(0x24c)]['product_name']],_0xca57fd=[..._0x347d90['body'][_0x483b6f(0x225)]],_0x489be1=[..._0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x1ea)]],_0x1acde2=[..._0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x21b)]],_0x16d954=[..._0x347d90[_0x483b6f(0x24c)]['level']],_0x439adf=[..._0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x255)]],_0x5b170e=[..._0x347d90['body'][_0x483b6f(0x18c)]],_0x3c74e3=[..._0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x168)]],_0x22150a=[..._0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x25c)]],_0xbaf54c=[..._0x347d90[_0x483b6f(0x24c)]['primary_code_hide']],_0x32192a=[..._0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x258)]];const _0x3d6725=_0x3bf2b5[_0x483b6f(0x269)](_0x2cf721=>{return _0x2cf721={'product_name':_0x2cf721};});_0xca57fd['forEach']((_0x50c425,_0x5e7925)=>{_0x3d6725[_0x5e7925]['purchase_quantity']=_0x50c425;}),_0x489be1[_0x483b6f(0x238)]((_0x1adfca,_0x3da61c)=>{var _0x2ac7a7=_0x483b6f;_0x3d6725[_0x3da61c][_0x2ac7a7(0x1f7)]=_0x1adfca;}),_0x1acde2[_0x483b6f(0x238)]((_0x1c2116,_0x3072d7)=>{var _0x1988ec=_0x483b6f;_0x3d6725[_0x3072d7][_0x1988ec(0x21b)]=_0x1c2116;}),_0x16d954['forEach']((_0x5dd411,_0x4ff966)=>{var _0x3e88fb=_0x483b6f;_0x3d6725[_0x4ff966][_0x3e88fb(0x1fc)]=_0x5dd411;}),_0x439adf[_0x483b6f(0x238)]((_0x2b7cc1,_0x1c5b75)=>{var _0x2da558=_0x483b6f;_0x3d6725[_0x1c5b75][_0x2da558(0x240)]=_0x2b7cc1;}),_0x5b170e[_0x483b6f(0x238)]((_0x7a7e8a,_0x1abcb8)=>{_0x3d6725[_0x1abcb8]['floorlevel']=_0x7a7e8a;}),_0x3c74e3[_0x483b6f(0x238)]((_0x591d66,_0x33021c)=>{_0x3d6725[_0x33021c]['type']=_0x591d66;}),_0x22150a[_0x483b6f(0x238)]((_0x3daebb,_0xc185d7)=>{var _0x1a30a0=_0x483b6f;_0x3d6725[_0xc185d7][_0x1a30a0(0x1e5)]=_0x3daebb;}),_0xbaf54c['forEach']((_0x27c11a,_0x59b7da)=>{var _0x1fd484=_0x483b6f;_0x3d6725[_0x59b7da][_0x1fd484(0x171)]=_0x27c11a;}),_0x32192a['forEach']((_0x5e232b,_0x179a48)=>{var _0x129ccc=_0x483b6f;_0x3d6725[_0x179a48][_0x129ccc(0x1eb)]=_0x5e232b;}),_0x1e21ba[_0x483b6f(0x21d)][_0x483b6f(0x238)](_0x24c98d=>{const _0x5756b5=_0x3c9a2f['product_details']['map'](_0x14aa9b=>{var _0x392181=a0_0x4921;_0x14aa9b[_0x392181(0x247)]==_0x24c98d[_0x392181(0x247)]&&_0x14aa9b[_0x392181(0x187)]==_0x24c98d[_0x392181(0x187)]&&_0x14aa9b[_0x392181(0x211)]==_0x24c98d[_0x392181(0x211)]&&_0x14aa9b[_0x392181(0x240)]==_0x24c98d[_0x392181(0x240)]&&_0x14aa9b[_0x392181(0x1fc)]==_0x24c98d['bay']&&_0x14aa9b[_0x392181(0x239)]==_0x24c98d[_0x392181(0x239)]&&_0x14aa9b['storage']==_0x24c98d[_0x392181(0x287)]&&(console[_0x392181(0x1f0)](parseInt(_0x14aa9b[_0x392181(0x1cc)])+_0x392181(0x196)+parseInt(_0x24c98d[_0x392181(0x1c6)])),_0x14aa9b['product_stock']=parseInt(_0x14aa9b['product_stock'])+parseInt(_0x24c98d[_0x392181(0x1c6)]));});}),await _0x3c9a2f[_0x483b6f(0x1d3)]();const _0x3359f9=_0x3d6725['filter'](_0x15450b=>_0x15450b[_0x483b6f(0x21b)]!=='0'&&_0x15450b[_0x483b6f(0x21b)]!=='');var _0x2864bd=0x0;_0x3359f9[_0x483b6f(0x238)](_0x1a0e96=>{var _0x47c446=_0x483b6f;console['log']('foreach\x20newproduct',_0x1a0e96),(parseInt(_0x1a0e96['purchase_quantity'])<parseInt(_0x1a0e96['return_qty'])||parseInt(_0x1a0e96[_0x47c446(0x1f7)])<parseInt(_0x1a0e96[_0x47c446(0x21b)]))&&_0x2864bd++;});if(_0x2864bd!=0x0)return _0x347d90[_0x483b6f(0x1d4)]('errors',_0x483b6f(0x274)),_0x62c6c4[_0x483b6f(0x26e)](_0x483b6f(0x217));const _0x3b614d=new purchases_return({'invoice':_0x2538ca,'suppliers':_0x347d90['body'][_0x483b6f(0x1f2)],'date':_0x267e49,'warehouse_name':_0x30b857,'return_product':_0x3359f9,'note':_0x320ec4,'room':_0x4e4653,'to_warehouse_name':_0x4ce418,'to_room':_0x3b3116}),_0x713168=await _0x3b614d[_0x483b6f(0x1d3)]();console[_0x483b6f(0x1f0)](_0x3b614d);const _0x56125f=await purchases_return[_0x483b6f(0x1d9)]({'invoice':_0x2538ca}),_0x32d7cd=await warehouse[_0x483b6f(0x1d9)]({'name':_0x4ce418,'room':_0x3b3116});_0x56125f['return_product'][_0x483b6f(0x238)](_0x2660da=>{var _0x594500=_0x483b6f,_0x2805ea=0x0;const _0x4b77ad=_0x32d7cd[_0x594500(0x236)]['map'](_0xe28964=>{var _0x3a5199=_0x594500;_0xe28964['product_name']==_0x2660da[_0x3a5199(0x247)]&&_0xe28964[_0x3a5199(0x187)]==_0x2660da[_0x3a5199(0x187)]&&_0xe28964[_0x3a5199(0x211)]==_0x2660da[_0x3a5199(0x211)]&&_0xe28964[_0x3a5199(0x240)]==_0x2660da[_0x3a5199(0x240)]&&_0xe28964[_0x3a5199(0x1fc)]==_0x2660da[_0x3a5199(0x1fc)]&&(_0xe28964[_0x3a5199(0x1cc)]=parseInt(_0xe28964[_0x3a5199(0x1cc)])-parseInt(_0x2660da[_0x3a5199(0x21b)]),_0x2805ea++);});_0x2805ea=='0'&&(_0x32d7cd[_0x594500(0x236)]=_0x32d7cd[_0x594500(0x236)]['concat']({'product_name':_0x2660da['product_name'],'product_stock':_0x2660da[_0x594500(0x21b)],'primary_code':_0x2660da[_0x594500(0x171)],'secondary_code':_0x2660da[_0x594500(0x1eb)],'product_code':_0x2660da[_0x594500(0x1e5)],'storage':_0x2660da[_0x594500(0x287)],'rack':_0x2660da[_0x594500(0x239)],'bay':_0x2660da[_0x594500(0x1fc)],'bin':_0x2660da['bin'],'type':_0x2660da[_0x594500(0x211)],'floorlevel':_0x2660da[_0x594500(0x187)],'maxProducts':_0x2660da['maxStocks'],'unit':_0x2660da['standard_unit'],'secondary_unit':_0x2660da[_0x594500(0x242)],'expiry_date':_0x2660da['expiry_date']}));}),await _0x32d7cd[_0x483b6f(0x1d3)]();const _0x52a6f1=await purchases[_0x483b6f(0x1d9)]({'invoice':_0x2538ca});_0x52a6f1[_0x483b6f(0x1bb)]=_0x483b6f(0x1ad);const _0x3d74fd=await _0x52a6f1[_0x483b6f(0x1d3)](),_0x2cb88e=new s_payment_data({'invoice':_0x2538ca,'suppliers':_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x1f2)],'reason':'Purchase\x20Return'});await _0x2cb88e['save']();const _0x11b1d3=await master_shop[_0x483b6f(0x172)]();console[_0x483b6f(0x1f0)](_0x483b6f(0x26a),_0x11b1d3[0x0][_0x483b6f(0x1cb)]);const _0x24bee1=await email_settings[_0x483b6f(0x1d9)](),_0x7fcdcd=await suppliers['findOne']({'name':_0x347d90[_0x483b6f(0x24c)][_0x483b6f(0x1f2)]});console['log']('suppliers_data',_0x7fcdcd);_0x11b1d3[0x0]['currency_placement']==0x1?(right_currency=_0x11b1d3[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x11b1d3[0x0][_0x483b6f(0x19f)]);var _0x3c9d07=_0x3bf2b5,_0x2db1c1=_0x1acde2,_0x439bc3='',_0x3ea5a5;for(_0x3ea5a5 in _0x3c9d07){_0x439bc3+=_0x483b6f(0x235)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3c9d07[_0x3ea5a5]+_0x483b6f(0x1f4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2db1c1[_0x3ea5a5]+'</td>'+'</tr>';}console[_0x483b6f(0x1f0)](_0x483b6f(0x19b),_0x439bc3);let _0x2eb3d3=nodemailer[_0x483b6f(0x275)]({'service':_0x483b6f(0x262),'auth':{'user':_0x24bee1['email'],'pass':_0x24bee1[_0x483b6f(0x1fa)]}}),_0x4540ba={'from':_0x24bee1[_0x483b6f(0x266)],'to':_0x7fcdcd[_0x483b6f(0x266)],'subject':_0x483b6f(0x1d8),'attachments':[{'filename':_0x483b6f(0x270),'path':__dirname+'/../public'+_0x483b6f(0x209)+_0x11b1d3[0x0][_0x483b6f(0x1cb)],'cid':'logo'}],'html':_0x483b6f(0x1a0)+_0x483b6f(0x1b0)+_0x483b6f(0x27e)+_0x483b6f(0x1dc)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x483b6f(0x18b)+'</div>'+_0x483b6f(0x1dc)+_0x483b6f(0x241)+_0x11b1d3[0x0]['site_title']+_0x483b6f(0x1fe)+_0x483b6f(0x1c0)+_0x483b6f(0x1c0)+_0x483b6f(0x1ec)+'<div>'+_0x483b6f(0x249)+_0x483b6f(0x178)+_0x2538ca+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x483b6f(0x1e3)+_0x267e49+'\x20'+'</span>'+'</h5>'+_0x483b6f(0x1c0)+_0x483b6f(0x288)+_0x483b6f(0x1c9)+_0x483b6f(0x235)+_0x483b6f(0x174)+_0x483b6f(0x16d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x483b6f(0x1cd)+_0x483b6f(0x190)+_0x483b6f(0x1bf)+_0x483b6f(0x1cf)+'\x20'+_0x439bc3+'\x20'+_0x483b6f(0x256)+_0x483b6f(0x1a8)+_0x483b6f(0x1dc)+_0x483b6f(0x26c)+'<h5>'+_0x11b1d3[0x0][_0x483b6f(0x26b)]+_0x483b6f(0x216)+_0x483b6f(0x1c0)+_0x483b6f(0x1c0)+_0x483b6f(0x1f1)};_0x2eb3d3['sendMail'](_0x4540ba,function(_0x4577e1,_0x4c647f){var _0x34e81b=_0x483b6f;_0x4577e1?(console[_0x34e81b(0x1f0)](_0x4577e1),console['log'](_0x34e81b(0x257))):console['log'](_0x34e81b(0x202));}),_0x347d90[_0x483b6f(0x1d4)](_0x483b6f(0x1f9),_0x483b6f(0x195)),_0x62c6c4[_0x483b6f(0x26e)]('/all_purchases/view');}catch(_0x3c1860){console[_0x483b6f(0x1f0)](_0x3c1860),_0x62c6c4['status'](0xc8)[_0x483b6f(0x18d)]({'message':_0x3c1860[_0x483b6f(0x1b1)]});}}),router[a0_0x38f7e9(0x263)](a0_0x38f7e9(0x1f5),auth,async(_0x4c585b,_0x2e769c)=>{var _0x45488b=a0_0x38f7e9;try{const {username:_0x34ea7c,email:_0x41e7dd,role:_0xb44d97}=_0x4c585b[_0x45488b(0x1ac)],_0x342e6b=_0x4c585b[_0x45488b(0x1ac)],_0x188b68=await profile['findOne']({'email':_0x342e6b[_0x45488b(0x266)]}),_0x4a3010=await master_shop['find'](),_0x1ae5b8=_0x4c585b[_0x45488b(0x1a1)]['id'],_0x1a6833=await purchases[_0x45488b(0x232)](_0x1ae5b8);if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x192))var _0x4e28c4=users[_0x45488b(0x1d7)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x237))var _0x4e28c4=users[_0x45488b(0x237)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x1fb))var _0x4e28c4=users[_0x45488b(0x1fb)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x184))var _0x4e28c4=users[_0x45488b(0x184)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]=='French')var _0x4e28c4=users[_0x45488b(0x250)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x226))var _0x4e28c4=users[_0x45488b(0x182)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x271))var _0x4e28c4=users[_0x45488b(0x271)];else{if(_0x4a3010[0x0][_0x45488b(0x264)]==_0x45488b(0x223))var _0x4e28c4=users[_0x45488b(0x19c)];}}}}}}}_0x2e769c[_0x45488b(0x25b)](_0x45488b(0x1b3),{'success':_0x4c585b['flash']('success'),'errors':_0x4c585b[_0x45488b(0x1d4)](_0x45488b(0x243)),'role':_0x342e6b,'profile':_0x188b68,'alldata':_0x1a6833,'master_shop':_0x4a3010,'language':_0x4e28c4}),console['log'](alldata);}catch(_0x63c7fb){console[_0x45488b(0x1f0)](_0x63c7fb);}}),router[a0_0x38f7e9(0x280)]('/barcode_scanner',async(_0x3c5208,_0x2b2028)=>{var _0x1f3a9f=a0_0x38f7e9;const {product_code:_0x1d13e9}=_0x3c5208[_0x1f3a9f(0x24c)];var _0x2f1b50;const _0x35741f=await product[_0x1f3a9f(0x173)]([{'$match':{'primary_code':_0x1d13e9,'product_category':_0x1f3a9f(0x1c4)}},{'$group':{'_id':_0x1f3a9f(0x208),'name':{'$first':_0x1f3a9f(0x219)},'category':{'$first':_0x1f3a9f(0x1ef)},'brand':{'$first':_0x1f3a9f(0x25a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x1f3a9f(0x189)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x1f3a9f(0x227)},'maxStocks':{'$first':_0x1f3a9f(0x277)},'maxProdPerUnit':{'$first':_0x1f3a9f(0x220)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x74cdf6=await product[_0x1f3a9f(0x173)]([{'$match':{'secondary_code':_0x1d13e9,'product_category':_0x1f3a9f(0x1c4)}},{'$group':{'_id':_0x1f3a9f(0x208),'name':{'$first':_0x1f3a9f(0x219)},'category':{'$first':'$category'},'brand':{'$first':_0x1f3a9f(0x25a)},'unit':{'$first':_0x1f3a9f(0x1f6)},'alertquantity':{'$first':_0x1f3a9f(0x167)},'product_code':{'$first':_0x1f3a9f(0x189)},'primary_code':{'$first':_0x1f3a9f(0x1b8)},'secondary_code':{'$first':_0x1f3a9f(0x227)},'maxStocks':{'$first':_0x1f3a9f(0x277)},'maxProdPerUnit':{'$first':_0x1f3a9f(0x220)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1f3a9f(0x1a2)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x35741f[_0x1f3a9f(0x191)]>0x0)_0x2f1b50=_0x35741f;else _0x74cdf6['length']>0x0&&(_0x2f1b50=_0x74cdf6);_0x2b2028['json'](_0x2f1b50);}),router[a0_0x38f7e9(0x280)]('/CheckingWarehouse',async(_0x5c7a14,_0x38cedb)=>{var _0x406504=a0_0x38f7e9;const {primaryCode:_0x1736b0,secondaryCode:_0x4d2679,productCode:_0x23fb9d,bay:_0x5675a3,bin:_0x5a159d,types:_0x2d0ae7,pallet:_0x1dfab2,warehouses:_0xd754ed,room:_0x4cf6b5}=_0x5c7a14['body'];console[_0x406504(0x1f0)](_0x5c7a14['body']);try{const _0x3089ea=await warehouse[_0x406504(0x173)]([{'$match':{'name':_0xd754ed,'room':_0x4cf6b5}},{'$unwind':_0x406504(0x1d1)},{'$match':{'product_details.bay':_0x5675a3,'product_details.bin':_0x5a159d,'product_details.type':_0x2d0ae7}},{'$group':{'_id':_0x406504(0x23c),'name':{'$first':_0x406504(0x218)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x406504(0x17f)},'isle':{'$first':_0x406504(0x170)},'pallet':{'$first':_0x406504(0x1b7)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x38cedb['status'](0xc8)[_0x406504(0x18d)](_0x3089ea);}catch(_0x2e4a9d){_0x38cedb[_0x406504(0x197)](0x194)[_0x406504(0x18d)]({'message':_0x2e4a9d['message']});}}),module[a0_0x38f7e9(0x28a)]=router;