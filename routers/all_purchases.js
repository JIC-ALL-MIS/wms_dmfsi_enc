var a0_0x3ee093=a0_0x3da0;(function(_0x354899,_0x422c52){var _0x58b6c8=a0_0x3da0,_0x41db06=_0x354899();while(!![]){try{var _0xefe4de=-parseInt(_0x58b6c8(0x304))/0x1*(parseInt(_0x58b6c8(0x22b))/0x2)+parseInt(_0x58b6c8(0x30e))/0x3*(parseInt(_0x58b6c8(0x271))/0x4)+parseInt(_0x58b6c8(0x31c))/0x5*(-parseInt(_0x58b6c8(0x22e))/0x6)+parseInt(_0x58b6c8(0x1f9))/0x7+-parseInt(_0x58b6c8(0x2c8))/0x8*(-parseInt(_0x58b6c8(0x303))/0x9)+-parseInt(_0x58b6c8(0x268))/0xa*(-parseInt(_0x58b6c8(0x234))/0xb)+parseInt(_0x58b6c8(0x240))/0xc*(-parseInt(_0x58b6c8(0x215))/0xd);if(_0xefe4de===_0x422c52)break;else _0x41db06['push'](_0x41db06['shift']());}catch(_0x144c9a){_0x41db06['push'](_0x41db06['shift']());}}}(a0_0x2fbe,0x6d526));const express=require(a0_0x3ee093(0x284)),app=express(),router=express[a0_0x3ee093(0x229)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x3ee093(0x28e));function a0_0x3da0(_0x53d290,_0x1eadae){var _0x2fbe49=a0_0x2fbe();return a0_0x3da0=function(_0x3da0d4,_0x3b6b16){_0x3da0d4=_0x3da0d4-0x1f3;var _0x379f73=_0x2fbe49[_0x3da0d4];return _0x379f73;},a0_0x3da0(_0x53d290,_0x1eadae);}var ejs=require(a0_0x3ee093(0x2c6));function a0_0x2fbe(){var _0x3d4f7c=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','stocks','log','93TWLZhB','</tr>','Rack\x20F','$product.bin','Purchase\x20Return\x20Mail','product_details','/all_purchases/view','$brand','Receiving\x20Area','prod_name','standard_unit','$batch_code','image','/invoice/:id','237980aDAutI','$category','length','Return\x20Goods','edit_purchases','password','secondary_unit','edit_purchases_view','delivery_date','3879078lNxrKV','max_product_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','gmail','$product_details.product_stock','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','purchases\x20item\x20return\x20successfull','$product_details.product_name','An\x20error\x20occurred.','Purchase\x20Mail','Arabic','pallet','suppliers','$note','$date','types','language','expiry_date','getDate','prod_invoice','$product_details','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','actual_uom','English','2016157AltAOz','toString','/CheckingWarehouse','$product_details.rack','forEach','success','$primary_code','$product.floorlevel','finalize','secondary_code_hide','findOne','\x20</h2>','/view','createTransport','currency_placement','</h5>','note','$product_details.type','get','Logo.png','Router','prod_pallet','977806HKarIR','purchase_quantity','secondary_code','42KwAKps','user','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$unit','<div>','Hindi','44AlfgEX','German','</body></html>','/preview/:id','$paid_amount','quantity','due_amount','user_id','</td>','then','/all_purchases/view/','status','84nTXsKk','Spanish','Email\x20sent\x20successfully','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','flash','/barcode_scanner','<span\x20style=\x22float:\x20right;\x22>','Shelves','Floor','$secondary_unit','filter','../public/language/languages.json','product_code','room_name','$suppliers_docs','delivery_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','name','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$_id','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','True','suppliers_data','random','French','deliverydate','Arabic\x20(ae)','abs','\x20Order\x20Number\x20:\x20','return_purchase','prod_qty','prod_Qty','body','redirect','add_purchases\x20error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$alertquantity','Rack\x20E','1296160IQUnhb','$product_code','/give_payment/:id','find','invoice','stock_data','prod_isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</span>','82508APSwEW','prod_secondunit','$product_details.bin','Raw\x20Materials','Room_name','<tbody\x20style=\x22text-align:\x20center;\x22>','all','params','Portuguese','An\x20error\x20occurred\x20while\x20saving\x20data.','concat','product_cat','slice','maxperunit','batch_code','/view/add_purchases/:id','/barcode/:id','error','getFullYear','express','sendMail','$name','prod_code','prod_level','back','<h5>','</table>','product_code_hide','$product_details.secondary_code','nodemailer','</div>','$product','storage','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','RoomAssign','room','\x20<\x20wew\x20>\x20','add\x20post','type','Rack\x20A','return_product','warehouse','map','Rack\x20B','foreach\x20newproduct','bin','email','$product_details.level','product','Sales\x20Update\x20successfully','<tr>','push','stock_quantity','</head><body>','Chinese','$product_details._id','Error\x20Occurs','post','product_list','prod_cat','$product_details.floorlevel','path','save','<h2>\x20','<html><head><title></title>','$product.bay','return_data','bay','level','floor','/view/return_purchase/:id','Level','aggregate','/view/:id','$product.type','$product_details.primary_code','string','primary_code_hide','suppliers_docs','catch','all_purchases_barcode','actual_qty','Portuguese\x20(BR)','staff','currency','ejs','\x20<>\x20','68632ljVyJo','json','Purchase\x20data\x20added\x20successfully','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$expiry_date','production_date','prod_unit','<strong>\x20Regards\x20</strong>','Ambient','product_stock','English\x20(US)','Rack\x20C','getMonth','$return_data','COLD\x20STORAGE','message','$secondary_code','prod_primunit','date_data','Enabled','/../public','$maxStocks','master','floorlevel','findById','<hr\x20class=\x22my-3\x22>','POnumber','JO_number','isle','amount','product_name','return_qty','padStart','port','rack','rak','\x20Order\x20Date\x20:\x20','warehouse_name','paid_amount','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','INC-','$maxProdPerUnit','Enclosed','/view/add_purchases','role','site_title','$product_details.pallet','$due_amount','$product.room_name','</thead>','$product_details.isle','<!DOCTYPE\x20html>','/upload/','here','logo','$product.quantity','primary_code','deliverycode','MaxStocks_data','675TZtsid','1VAgUTo','table\x20page','all_purchases','$product_details.product_code','alertQTY','date','maxStocks'];a0_0x2fbe=function(){return _0x3d4f7c;};return a0_0x2fbe();}const path=require(a0_0x3ee093(0x2ae)),users=require(a0_0x3ee093(0x24b));router[a0_0x3ee093(0x227)](a0_0x3ee093(0x221),auth,async(_0x1c4f5c,_0xa01746)=>{var _0x45a4e5=a0_0x3ee093;try{const {username:_0x4716f4,email:_0x351ac2,role:_0x45fdab}=_0x1c4f5c[_0x45a4e5(0x22f)],_0xa3fb51=_0x1c4f5c[_0x45a4e5(0x22f)],_0x106737=await profile[_0x45a4e5(0x21f)]({'email':_0xa3fb51[_0x45a4e5(0x29f)]}),_0x3d0aea=await staff[_0x45a4e5(0x21f)]({'email':_0xa3fb51[_0x45a4e5(0x29f)]});if(_0xa3fb51[_0x45a4e5(0x2f4)]==_0x45a4e5(0x2c4)){const _0x47fe1c=await staff[_0x45a4e5(0x21f)]({'email':_0xa3fb51[_0x45a4e5(0x29f)]});}const _0x41ad6c=await master_shop[_0x45a4e5(0x26b)]();let _0x3d18fb;if(_0xa3fb51[_0x45a4e5(0x2f4)]=='staff'){const _0x1c387f=await staff[_0x45a4e5(0x21f)]({'email':_0xa3fb51['email']});_0x3d18fb=await purchases[_0x45a4e5(0x2b9)]([{'$match':{'warehouse_name':_0x1c387f[_0x45a4e5(0x29a)]}},{'$lookup':{'from':_0x45a4e5(0x209),'localField':_0x45a4e5(0x209),'foreignField':_0x45a4e5(0x251),'as':_0x45a4e5(0x2bf)}},{'$unwind':_0x45a4e5(0x24e)},{'$unwind':_0x45a4e5(0x290)},{'$group':{'_id':_0x45a4e5(0x254),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x45a4e5(0x20b)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x45a4e5(0x290)},'note':{'$first':_0x45a4e5(0x20a)},'paid_amount':{'$first':_0x45a4e5(0x238)},'due_amount':{'$first':_0x45a4e5(0x2f7)},'return_data':{'$first':_0x45a4e5(0x2d5)},'batch_code':{'$first':_0x45a4e5(0x319)},'expiry_date':{'$first':_0x45a4e5(0x2cc)},'suppliers_docs':{'$first':_0x45a4e5(0x24e)},'total_product_quantity':{'$sum':_0x45a4e5(0x2ff)},'level':{'$addToSet':_0x45a4e5(0x2b2)},'isle':{'$addToSet':_0x45a4e5(0x311)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x45a4e5(0x21c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3d18fb=await purchases[_0x45a4e5(0x2b9)]([{'$lookup':{'from':'suppliers','localField':_0x45a4e5(0x209),'foreignField':_0x45a4e5(0x251),'as':_0x45a4e5(0x2bf)}},{'$unwind':_0x45a4e5(0x24e)},{'$unwind':_0x45a4e5(0x290)},{'$group':{'_id':_0x45a4e5(0x254),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x45a4e5(0x255)},'room':{'$addToSet':_0x45a4e5(0x2f8)},'product':{'$push':_0x45a4e5(0x290)},'note':{'$first':_0x45a4e5(0x20a)},'paid_amount':{'$first':_0x45a4e5(0x238)},'due_amount':{'$first':_0x45a4e5(0x2f7)},'return_data':{'$first':_0x45a4e5(0x2d5)},'batch_code':{'$first':_0x45a4e5(0x319)},'expiry_date':{'$first':_0x45a4e5(0x2cc)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x45a4e5(0x2b2)},'isle':{'$addToSet':_0x45a4e5(0x311)},'type':{'$addToSet':_0x45a4e5(0x2bb)},'floorlevel':{'$addToSet':_0x45a4e5(0x21c)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]==_0x45a4e5(0x2d2)){var _0x21b86f=users[_0x45a4e5(0x214)];console['log'](_0x21b86f);}else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]==_0x45a4e5(0x233))var _0x21b86f=users['Hindi'];else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]=='German')var _0x21b86f=users[_0x45a4e5(0x235)];else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]==_0x45a4e5(0x241))var _0x21b86f=users[_0x45a4e5(0x241)];else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]=='French')var _0x21b86f=users[_0x45a4e5(0x25a)];else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]==_0x45a4e5(0x2c3))var _0x21b86f=users['Portuguese'];else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]==_0x45a4e5(0x2a7))var _0x21b86f=users[_0x45a4e5(0x2a7)];else{if(_0x41ad6c[0x0][_0x45a4e5(0x20d)]==_0x45a4e5(0x25c))var _0x21b86f=users['Arabic'];}}}}}}}_0xa01746[_0x45a4e5(0x1fc)](_0x45a4e5(0x306),{'success':_0x1c4f5c['flash'](_0x45a4e5(0x21a)),'errors':_0x1c4f5c[_0x45a4e5(0x244)]('errors'),'purchases':_0x3d18fb,'role':_0xa3fb51,'profile':_0x106737,'master_shop':_0x41ad6c,'language':_0x21b86f});}catch(_0x132c74){console[_0x45a4e5(0x30d)](_0x45a4e5(0x305),_0x132c74),_0xa01746[_0x45a4e5(0x23f)](0xc8)[_0x45a4e5(0x2c9)]({'message':_0x132c74[_0x45a4e5(0x2d7)]});}});function BayBinSelected(_0x4e8aeb,_0x5ed527){var _0x5d7dc1=a0_0x3ee093,_0x26a6f5=[],_0xb3add0=[],_0x983299=[],_0x3cd946=[],_0x4406c2=[],_0x40600d=[];let _0x4f61ff=[];if(_0x4e8aeb=='DRY\x20STORAGE')switch(_0x5ed527){case _0x5d7dc1(0x298):_0x26a6f5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xb3add0=[0x1,0x2],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=['Level',_0x5d7dc1(0x248)],_0x4406c2=['D'],_0x40600d=['A'];break;case _0x5d7dc1(0x29c):_0x26a6f5=[0x6,0x5,0x4,0x3,0x2,0x1],_0xb3add0=[0x1,0x2],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=['Level','Floor'],_0x4406c2=['D'],_0x40600d=['B'];break;case'Shelves':_0x26a6f5=[0x0],_0xb3add0=[0x0],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=[_0x5d7dc1(0x248)],_0x4406c2=['D'],_0x40600d=['S'];break;case _0x5d7dc1(0x316):_0x26a6f5=[0x0],_0xb3add0=[0x0],_0x3cd946=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x983299=[_0x5d7dc1(0x248)],_0x4406c2=['D'],_0x40600d=['R'];break;}else{if(_0x4e8aeb==_0x5d7dc1(0x2d6))switch(_0x5ed527){case _0x5d7dc1(0x298):_0x26a6f5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xb3add0=['B','F'],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=[_0x5d7dc1(0x2b8),'Floor'],_0x4406c2=['C'],_0x40600d=['A'];break;case'Rack\x20B':_0x26a6f5=[0x5,0x4,0x3,0x2,0x1],_0xb3add0=['F','B','S'],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=[_0x5d7dc1(0x2b8),'Floor'],_0x4406c2=['C'],_0x40600d=['B'];break;case _0x5d7dc1(0x2d3):_0x26a6f5=[0x1,0x2,0x3,0x4,0x5],_0xb3add0=['B','F','S'],_0x3cd946=[0x5,0x4,0x3,0x2,0x1],_0x983299=[_0x5d7dc1(0x2b8),'Floor'],_0x4406c2=['C'],_0x40600d=['C'];break;case'Rack\x20D':_0x26a6f5=[0x5,0x4,0x3,0x2,0x1],_0xb3add0=['F','B','S'],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=[_0x5d7dc1(0x2b8),_0x5d7dc1(0x248)],_0x4406c2=['C'],_0x40600d=['D'];break;case _0x5d7dc1(0x267):_0x26a6f5=[0x4,0x3,0x2,0x1],_0xb3add0=[0x1,0x2],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=[_0x5d7dc1(0x2b8),_0x5d7dc1(0x248)],_0x4406c2=['C'],_0x40600d=['E'];break;case _0x5d7dc1(0x310):_0x26a6f5=[0x1,0x2,0x3],_0xb3add0=[0x1,0x2],_0x3cd946=[0x1,0x2,0x3,0x4,0x5],_0x983299=[_0x5d7dc1(0x2b8)],_0x4406c2=['C'],_0x40600d=['F'];break;}}return{'levels':_0x26a6f5,'Isle':_0xb3add0,'rack':_0x3cd946,'type':_0x983299,'storage':_0x4406c2,'rak':_0x40600d};}async function getRandom8DigitNumber(){var _0x19c8ba=a0_0x3ee093;const _0x49b79d=0x989680,_0x506a28=0x5f5e0ff,_0x3ab1c7=Math[_0x19c8ba(0x2b6)](Math[_0x19c8ba(0x259)]()*(_0x506a28-_0x49b79d+0x1))+_0x49b79d;var _0x196bee;const _0x42b068=await purchases[_0x19c8ba(0x21f)]({'invoice':_0x19c8ba(0x2f0)+_0x3ab1c7});return _0x42b068&&_0x42b068[_0x19c8ba(0x31e)]>0x0?_0x196bee=_0x19c8ba(0x2f0)+_0x3ab1c7:_0x196bee=_0x19c8ba(0x2f0)+_0x3ab1c7,_0x196bee;}router['get'](a0_0x3ee093(0x2f3),auth,async(_0x3be6e5,_0x17bb9a)=>{var _0x26788f=a0_0x3ee093;try{const {username:_0x27cf97,email:_0x1ba761,role:_0x228f34}=_0x3be6e5[_0x26788f(0x22f)],_0x13a03b=_0x3be6e5[_0x26788f(0x22f)],_0x2d21ed=await profile['findOne']({'email':_0x13a03b[_0x26788f(0x29f)]}),_0x4ee5f1=await master_shop['find'](),_0x2dc520=await staff[_0x26788f(0x21f)]({'email':_0x13a03b['email']}),_0x50431c=await suppliers['find']({});let _0x27db33;if(_0x13a03b[_0x26788f(0x2f4)]==_0x26788f(0x2c4)){const _0x149b9e=await staff[_0x26788f(0x21f)]({'email':_0x13a03b[_0x26788f(0x29f)]});_0x27db33=await warehouse[_0x26788f(0x2b9)]([{'$match':{'status':_0x26788f(0x2db),'name':_0x149b9e[_0x26788f(0x29a)],'warehouse_category':_0x26788f(0x274),'name':{'$ne':_0x26788f(0x1f3)}}},{'$group':{'_id':_0x26788f(0x286),'name':{'$first':_0x26788f(0x286)}}}]);}else _0x27db33=await warehouse[_0x26788f(0x2b9)]([{'$match':{'status':_0x26788f(0x2db),'warehouse_category':_0x26788f(0x274),'name':{'$ne':_0x26788f(0x1f3)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x775efa=await product[_0x26788f(0x26b)]({}),_0x3830e5=await warehouse['find']({'status':'Enabled'}),_0x316246=await purchases[_0x26788f(0x26b)]({}),_0x5475ed=_0x316246['length']+0x1,_0x28ddef=_0x26788f(0x2f0)+_0x5475ed[_0x26788f(0x216)]()[_0x26788f(0x2e8)](0x5,'0');var _0x237d71=[_0x26788f(0x2d0),_0x26788f(0x2f2)];if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x2d2))var _0x5a5590=users[_0x26788f(0x214)];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x233))var _0x5a5590=users['Hindi'];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x235))var _0x5a5590=users[_0x26788f(0x235)];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x241))var _0x5a5590=users[_0x26788f(0x241)];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x25a))var _0x5a5590=users[_0x26788f(0x25a)];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x2c3))var _0x5a5590=users[_0x26788f(0x279)];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x2a7))var _0x5a5590=users[_0x26788f(0x2a7)];else{if(_0x4ee5f1[0x0][_0x26788f(0x20d)]==_0x26788f(0x25c))var _0x5a5590=users['Arabic'];}}}}}}}const _0x55a1bc=getRandom8DigitNumber();_0x55a1bc[_0x26788f(0x23d)](_0x4d3e44=>{var _0x3a1785=_0x26788f;_0x17bb9a[_0x3a1785(0x1fc)]('add_purchases',{'success':_0x3be6e5[_0x3a1785(0x244)](_0x3a1785(0x21a)),'errors':_0x3be6e5[_0x3a1785(0x244)](_0x3a1785(0x252)),'role':_0x13a03b,'profile':_0x2d21ed,'suppliers':_0x50431c,'warehouse':_0x27db33,'product':_0x775efa,'invoice':_0x4d3e44,'master_shop':_0x4ee5f1,'language':_0x5a5590,'find_data':_0x3830e5,'rooms_data':_0x237d71});})[_0x26788f(0x2c0)](_0x4a1d4c=>{var _0x5ba8cc=_0x26788f;_0x3be6e5['flash']('errors',_0x5ba8cc(0x2cb)),_0x17bb9a[_0x5ba8cc(0x263)](_0x5ba8cc(0x314));});}catch(_0x66e15c){console[_0x26788f(0x30d)](_0x66e15c);}}),router['get'](a0_0x3ee093(0x280),auth,async(_0x583859,_0x31d2c2)=>{var _0x3dace5=a0_0x3ee093;try{const _0xfbc7a1=_0x583859[_0x3dace5(0x278)]['id'];console['log'](_0xfbc7a1);const _0x428b7c=await master_shop[_0x3dace5(0x26b)]();console[_0x3dace5(0x30d)](_0x3dace5(0x2de),_0x428b7c);const _0x49160d=await product[_0x3dace5(0x21f)]({'name':_0xfbc7a1});console['log'](_0x3dace5(0x2a1),_0x49160d),_0x31d2c2['status'](0xc8)[_0x3dace5(0x2c9)]({'product_data':_0x49160d,'master':_0x428b7c});}catch(_0x211490){console['log'](_0x3dace5(0x264),_0x211490);}}),router[a0_0x3ee093(0x2aa)]('/view/add_purchases',auth,async(_0x3535e7,_0xf995f5)=>{var _0x473c8d=a0_0x3ee093;try{const {invoice:_0x51c619,date:_0x47a64f,warehouse_name:_0x2d0fab,prod_name:_0x43b1dd,prod_code:_0x5d3a83,prod_qty:_0x2d9a9b,prod_unit:_0x4b14a1,prod_secondunit:_0x428390,prod_level:_0x1230b7,prod_isle:_0x2f9cd3,prod_pallet:_0x311171,note:_0x23e2ee,expiry_date:_0xdac47f,batch_code:_0x5f1091,payable:_0x500e11,due_amount:_0x563997,Room_name:_0x9fc1ad,primary_code:_0x355079,secondary_code:_0x4c84d6,MaxStocks_data:_0x5950cc,PO_number:_0x5f22c6,SCRN:_0x5077cb,JO_number:_0x11c315}=_0x3535e7[_0x473c8d(0x262)];if(typeof _0x43b1dd==_0x473c8d(0x2bd))var _0x596b3e=[_0x3535e7[_0x473c8d(0x262)]['prod_name']],_0x58be02=[_0x3535e7['body'][_0x473c8d(0x287)]],_0x210f5f=[_0x3535e7[_0x473c8d(0x262)]['prod_Qty']],_0x29bea8=[_0x3535e7['body'][_0x473c8d(0x2d9)]],_0x22b6f4=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x272)]],_0x30b2ca=[_0x3535e7['body'][_0x473c8d(0x288)]],_0x2229bb=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x300)]],_0x964f9e=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x22d)]],_0x2800c8=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x302)]],_0x4097dc=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x27f)]],_0x3a4c44=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x20e)]],_0x3db92a=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x1fa)]],_0x5b1d52=[_0x3535e7[_0x473c8d(0x262)]['alertQTY']],_0x3ca561=[_0x3535e7['body']['production_date']],_0x52efae=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x2ac)]],_0x2ec8b6=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x293)]],_0x28627f=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x301)]],_0xd4841=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x210)]],_0x16b4aa=[_0x3535e7[_0x473c8d(0x262)]['actual_qty']],_0x5b9919=[_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x213)]],_0x558a2d=[_0x3535e7['body'][_0x473c8d(0x25b)]];else var _0x596b3e=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x317)]],_0x58be02=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x287)]],_0x210f5f=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x261)]],_0x29bea8=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x2d9)]],_0x22b6f4=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x272)]],_0x30b2ca=[..._0x3535e7[_0x473c8d(0x262)]['prod_level']],_0x2229bb=[..._0x3535e7['body']['primary_code']],_0x964f9e=[..._0x3535e7['body'][_0x473c8d(0x22d)]],_0x2800c8=[..._0x3535e7[_0x473c8d(0x262)]['MaxStocks_data']],_0x4097dc=[..._0x3535e7['body'][_0x473c8d(0x27f)]],_0x3a4c44=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x20e)]],_0x3db92a=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x1fa)]],_0x5b1d52=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x308)]],_0x3ca561=[..._0x3535e7[_0x473c8d(0x262)]['production_date']],_0x52efae=[..._0x3535e7['body'][_0x473c8d(0x2ac)]],_0x2ec8b6=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x293)]],_0x28627f=[..._0x3535e7[_0x473c8d(0x262)]['deliverycode']],_0xd4841=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x210)]],_0x16b4aa=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x2c2)]],_0x5b9919=[..._0x3535e7['body'][_0x473c8d(0x213)]],_0x558a2d=[..._0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x25b)]];const _0x472896=_0x596b3e['map'](_0x1afeee=>{return _0x1afeee={'product_name':_0x1afeee};});_0x16b4aa[_0x473c8d(0x219)]((_0x2cebe9,_0x557514)=>{var _0x40a562=_0x473c8d;_0x472896[_0x557514][_0x40a562(0x2c2)]=Math[_0x40a562(0x25d)](_0x2cebe9);}),_0x5b9919['forEach']((_0x2e1ddb,_0x53e0dc)=>{var _0x4080d7=_0x473c8d;_0x472896[_0x53e0dc][_0x4080d7(0x213)]=_0x2e1ddb;}),_0x58be02[_0x473c8d(0x219)]((_0x32e36b,_0x146ca8)=>{var _0x4df054=_0x473c8d;_0x472896[_0x146ca8][_0x4df054(0x24c)]=_0x32e36b,_0x472896[_0x146ca8][_0x4df054(0x2da)]=_0x47a64f;}),_0x210f5f[_0x473c8d(0x219)]((_0x1f06b5,_0x12cbee)=>{var _0x21b4b3=_0x473c8d;_0x472896[_0x12cbee][_0x21b4b3(0x239)]=Math[_0x21b4b3(0x25d)](_0x1f06b5);}),_0x29bea8[_0x473c8d(0x219)]((_0x25f409,_0x1ed170)=>{var _0x3f8aa8=_0x473c8d;_0x472896[_0x1ed170][_0x3f8aa8(0x318)]=_0x25f409;}),_0x22b6f4[_0x473c8d(0x219)]((_0x2f3fd4,_0x385457)=>{var _0x42983e=_0x473c8d;_0x472896[_0x385457][_0x42983e(0x1f6)]=_0x2f3fd4;}),_0x30b2ca[_0x473c8d(0x219)]((_0x4183be,_0x25c34a)=>{_0x2ec8b6['forEach']((_0x3b29a7,_0x158748)=>{var _0x28f837=a0_0x3da0;if(_0x3b29a7=='Receiving\x20Area'&&_0x25c34a==_0x158748){console[_0x28f837(0x30d)](_0x3b29a7+_0x28f837(0x295)+_0x25c34a+_0x28f837(0x2c7)+_0x158748+_0x28f837(0x2c7)+_0x4183be);var _0xaea679=_0x4183be['slice'](0x3);_0x472896[_0x25c34a][_0x28f837(0x291)]=_0x4183be[0x0],_0x472896[_0x25c34a][_0x28f837(0x2ea)]=_0x4183be[0x1],_0x472896[_0x25c34a][_0x28f837(0x2b4)]=0x0,_0x472896[_0x25c34a][_0x28f837(0x29e)]=0x0,_0x472896[_0x25c34a][_0x28f837(0x297)]=_0x28f837(0x248),_0x472896[_0x25c34a]['floorlevel']=_0xaea679;}else{if(_0x3b29a7==_0x28f837(0x247)&&_0x25c34a==_0x158748){var _0xaea679=_0x4183be[_0x28f837(0x27d)](0x3);_0x472896[_0x25c34a][_0x28f837(0x291)]=_0x4183be[0x0],_0x472896[_0x25c34a][_0x28f837(0x2ea)]=_0x4183be[0x1],_0x472896[_0x25c34a][_0x28f837(0x2b4)]=0x0,_0x472896[_0x25c34a][_0x28f837(0x29e)]=0x0,_0x472896[_0x25c34a][_0x28f837(0x297)]=_0x28f837(0x248),_0x472896[_0x25c34a][_0x28f837(0x2df)]=_0x4183be[0x5];}else{if(_0x25c34a==_0x158748){if(_0x4183be[0x0]=='A'&&_0x4183be[0x1]=='L'&&_0x4183be[0x2]=='L')console[_0x28f837(0x30d)](_0x3b29a7+'\x20<>\x20'+_0x25c34a+_0x28f837(0x2c7)+_0x158748+_0x28f837(0x2c7)+_0x4183be+_0x28f837(0x2fd)),_0x472896[_0x25c34a]['storage']=_0x4183be[0x0],_0x472896[_0x25c34a][_0x28f837(0x2ea)]=_0x4183be[0x1],_0x472896[_0x25c34a]['bay']=0x0,_0x472896[_0x25c34a]['bin']=0x0,_0x472896[_0x25c34a][_0x28f837(0x297)]=_0x28f837(0x248),_0x472896[_0x25c34a][_0x28f837(0x2df)]=_0x4183be[0x3];else{var _0x174c0a;if(_0x4183be[0x4]=='L')_0x174c0a='Level';else _0x4183be[0x4]=='F'&&(_0x174c0a=_0x28f837(0x248));_0x472896[_0x25c34a][_0x28f837(0x291)]=_0x4183be[0x0],_0x472896[_0x25c34a][_0x28f837(0x2ea)]=_0x4183be[0x1],_0x472896[_0x25c34a][_0x28f837(0x2b4)]=_0x4183be[0x2],_0x472896[_0x25c34a][_0x28f837(0x29e)]=_0x4183be[0x3],_0x472896[_0x25c34a]['type']=_0x174c0a,_0x472896[_0x25c34a][_0x28f837(0x2df)]=_0x4183be[0x5];}}}}});}),_0x2229bb[_0x473c8d(0x219)]((_0x4c7790,_0x1ad926)=>{var _0x4f97b8=_0x473c8d;_0x472896[_0x1ad926][_0x4f97b8(0x300)]=_0x4c7790;}),_0x964f9e['forEach']((_0x10148b,_0x428948)=>{var _0x2c13d3=_0x473c8d;_0x472896[_0x428948][_0x2c13d3(0x22d)]=_0x10148b;}),_0x2800c8[_0x473c8d(0x219)]((_0x4f8751,_0x3002d9)=>{_0x472896[_0x3002d9]['maxStocks']=_0x4f8751;}),_0x4097dc['forEach']((_0x34a3b1,_0x14f72b)=>{var _0x300bc2=_0x473c8d;_0x472896[_0x14f72b][_0x300bc2(0x27f)]=_0x34a3b1;}),_0x3a4c44[_0x473c8d(0x219)]((_0x59de6d,_0x468bf1)=>{var _0x872b5e=_0x473c8d;_0x472896[_0x468bf1][_0x872b5e(0x20e)]=_0x59de6d;}),_0x3db92a[_0x473c8d(0x219)]((_0x5d3d40,_0xd58d10)=>{var _0x5f3a5c=_0x473c8d;_0x472896[_0xd58d10][_0x5f3a5c(0x27e)]=_0x5d3d40;}),_0x5b1d52['forEach']((_0x1aa9cf,_0xa741be)=>{var _0x59a618=_0x473c8d;_0x472896[_0xa741be][_0x59a618(0x308)]=_0x1aa9cf;}),_0x3ca561[_0x473c8d(0x219)]((_0x5610a0,_0x49ce87)=>{var _0x51a526=_0x473c8d;_0x472896[_0x49ce87][_0x51a526(0x2cd)]=_0x5610a0;}),_0x52efae[_0x473c8d(0x219)]((_0x159cbe,_0x15f04d)=>{var _0x27b125=_0x473c8d;_0x472896[_0x15f04d][_0x27b125(0x27c)]=_0x159cbe;}),_0x2ec8b6[_0x473c8d(0x219)]((_0x2de242,_0xfb59b2)=>{_0x472896[_0xfb59b2]['room_name']=_0x2de242;}),_0x558a2d['forEach']((_0x2ff05c,_0x33f7a6)=>{var _0x1fefff=_0x473c8d;_0x472896[_0x33f7a6][_0x1fefff(0x1f8)]=_0x2ff05c;}),_0x28627f[_0x473c8d(0x219)]((_0x32d61f,_0x5cef1a)=>{_0x472896[_0x5cef1a]['delivery_code']=_0x32d61f;}),_0xd4841[_0x473c8d(0x219)]((_0x2c1be5,_0xe29440)=>{var _0x4037f9=_0x473c8d;_0x472896[_0xe29440][_0x4037f9(0x26c)]=_0x2c1be5;});const _0x571db3=_0x2ec8b6[_0x473c8d(0x29b)](_0x3faa5e=>{return _0x3faa5e={'room_name':_0x3faa5e};}),_0x105e21=_0x472896[_0x473c8d(0x24a)](_0x21da95=>_0x21da95[_0x473c8d(0x239)]!=='0'&&_0x21da95[_0x473c8d(0x239)]!==''),_0x3438a4=new purchases({'invoice':_0x51c619,'suppliers':_0x3535e7[_0x473c8d(0x262)][_0x473c8d(0x209)],'date':_0x47a64f,'warehouse_name':_0x2d0fab,'product':_0x105e21,'note':_0x23e2ee,'due_amount':_0x563997,'POnumber':_0x5f22c6,'SCRN':_0x5077cb,'JO_number':_0x11c315,'roomList':_0x571db3}),_0x24c961=await _0x3438a4['save'](),_0x48ac2b=await purchases[_0x473c8d(0x21f)]({'invoice':_0x51c619}),_0x5eb70c=_0x48ac2b[_0x473c8d(0x2a1)][_0x473c8d(0x29b)](async _0x294305=>{var _0x3ba4fc=_0x473c8d,_0x3f6297=await warehouse['findOne']({'name':_0x2d0fab,'room':_0x294305[_0x3ba4fc(0x24d)]}),_0x35fb36=0x0;return _0x3f6297[_0x3ba4fc(0x313)]['forEach'](_0x1a86d5=>{var _0x52b877=_0x3ba4fc;_0x1a86d5['product_name']==_0x294305[_0x52b877(0x2e6)]&&_0x1a86d5[_0x52b877(0x2df)]==_0x294305['floorlevel']&&_0x1a86d5[_0x52b877(0x297)]==_0x294305[_0x52b877(0x297)]&&_0x1a86d5[_0x52b877(0x29e)]==_0x294305[_0x52b877(0x29e)]&&_0x1a86d5[_0x52b877(0x2b4)]==_0x294305[_0x52b877(0x2b4)]&&_0x1a86d5[_0x52b877(0x2ea)]==_0x294305['rack']&&_0x1a86d5[_0x52b877(0x291)]==_0x294305['storage']&&_0x1a86d5['expiry_date']==_0x294305[_0x52b877(0x20e)]&&_0x1a86d5[_0x52b877(0x27f)]==_0x294305['batch_code']&&_0x1a86d5[_0x52b877(0x2cd)]==_0x294305[_0x52b877(0x2cd)]&&_0x1a86d5['invoice']==_0x48ac2b[_0x52b877(0x26c)]&&(_0x1a86d5['product_stock']+=Math[_0x52b877(0x25d)](_0x294305['quantity']),_0x35fb36++);}),_0x35fb36===0x0&&_0x3f6297[_0x3ba4fc(0x313)][_0x3ba4fc(0x2a4)]({'product_name':_0x294305[_0x3ba4fc(0x2e6)],'product_stock':Math[_0x3ba4fc(0x25d)](_0x294305[_0x3ba4fc(0x239)]),'primary_code':_0x294305[_0x3ba4fc(0x300)],'secondary_code':_0x294305[_0x3ba4fc(0x22d)],'product_code':_0x294305[_0x3ba4fc(0x24c)],'storage':_0x294305[_0x3ba4fc(0x291)],'rack':_0x294305[_0x3ba4fc(0x2ea)],'bay':_0x294305[_0x3ba4fc(0x2b4)],'bin':_0x294305[_0x3ba4fc(0x29e)],'type':_0x294305[_0x3ba4fc(0x297)],'floorlevel':_0x294305[_0x3ba4fc(0x2df)],'maxProducts':_0x294305[_0x3ba4fc(0x30a)],'unit':_0x294305['standard_unit'],'secondary_unit':_0x294305[_0x3ba4fc(0x1f6)],'expiry_date':_0x294305[_0x3ba4fc(0x20e)],'maxPerUnit':_0x294305['maxperunit'],'batch_code':_0x294305['batch_code'],'alertQTY':_0x294305[_0x3ba4fc(0x308)],'production_date':_0x294305[_0x3ba4fc(0x2cd)],'product_cat':_0x294305[_0x3ba4fc(0x27c)],'invoice':_0x294305['invoice'],'actual_qty':Math['abs'](_0x294305[_0x3ba4fc(0x2c2)]),'actual_uom':_0x294305[_0x3ba4fc(0x213)],'delivery_date':_0x294305[_0x3ba4fc(0x1f8)],'delivery_code':_0x294305[_0x3ba4fc(0x24f)]}),_0x3f6297;});Promise[_0x473c8d(0x277)](_0x5eb70c)[_0x473c8d(0x23d)](async _0x5e63d4=>{var _0x201179=_0x473c8d;try{for(const _0x47f478 of _0x5e63d4){await _0x47f478[_0x201179(0x2af)]();}const _0x3beb60=await master_shop['find'](),_0x4555a6=await email_settings[_0x201179(0x21f)](),_0x20d3b4=await supervisor_settings['find']();var _0x34ead5=_0x48ac2b[_0x201179(0x2a1)],_0x23647e='',_0x47e28e;for(_0x47e28e in _0x34ead5){_0x23647e+=_0x201179(0x2a3)+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x2e6)]+_0x201179(0x23c)+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x24c)]+_0x201179(0x23c)+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x239)]+'</td>'+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x318)]+_0x201179(0x23c)+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x1f6)]+_0x201179(0x23c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48ac2b[_0x201179(0x2ed)]+_0x201179(0x23c)+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x24d)]+_0x201179(0x23c)+_0x201179(0x292)+_0x34ead5[_0x47e28e][_0x201179(0x291)]+_0x34ead5[_0x47e28e]['rack']+_0x34ead5[_0x47e28e][_0x201179(0x2b4)]+_0x34ead5[_0x47e28e][_0x201179(0x29e)]+_0x34ead5[_0x47e28e][_0x201179(0x297)][0x0]+_0x34ead5[_0x47e28e]['floorlevel']+_0x201179(0x23c),_0x201179(0x30f);}let _0x4ed8ab=nodemailer[_0x201179(0x222)]({'host':_0x4555a6['host'],'port':Number(_0x4555a6[_0x201179(0x2e9)]),'secure':![],'auth':{'user':_0x4555a6[_0x201179(0x29f)],'pass':_0x4555a6['password']}}),_0x2291bc={'from':_0x4555a6[_0x201179(0x29f)],'to':_0x20d3b4[0x0]['RMSEmail'],'subject':_0x201179(0x206),'attachments':[{'filename':_0x201179(0x228),'path':__dirname+'/../public'+_0x201179(0x2fc)+_0x3beb60[0x0][_0x201179(0x31a)],'cid':_0x201179(0x2fe)}],'html':_0x201179(0x2fb)+_0x201179(0x2b1)+_0x201179(0x2a6)+_0x201179(0x232)+_0x201179(0x212)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+_0x201179(0x2b0)+_0x3beb60[0x0]['site_title']+'\x20</h2>'+_0x201179(0x28f)+'</div>'+_0x201179(0x2e1)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x201179(0x25e)+_0x48ac2b['invoice']+'\x20'+_0x201179(0x246)+'\x20Order\x20Date\x20:\x20'+_0x48ac2b[_0x201179(0x309)]+'\x20'+_0x201179(0x270)+_0x201179(0x224)+_0x201179(0x28f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x201179(0x2a3)+_0x201179(0x256)+_0x201179(0x1fd)+_0x201179(0x202)+_0x201179(0x30b)+_0x201179(0x265)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x201179(0x26f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x201179(0x30f)+_0x201179(0x2f9)+_0x201179(0x276)+'\x20'+_0x23647e+'\x20'+'</tbody>'+_0x201179(0x28b)+_0x201179(0x232)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3beb60[0x0]['site_title']+_0x201179(0x224)+_0x201179(0x28f)+_0x201179(0x28f)+_0x201179(0x236)};_0x4ed8ab[_0x201179(0x285)](_0x2291bc,function(_0x1c8b85,_0x222fea){var _0x471468=_0x201179;_0x1c8b85?(console['log'](_0x1c8b85),console[_0x471468(0x30d)](_0x471468(0x2a9))):console[_0x471468(0x30d)]('Email\x20sent\x20successfully');}),_0x3535e7[_0x201179(0x244)]('success',_0x201179(0x2ca)),_0xf995f5[_0x201179(0x263)](_0x201179(0x23e));}catch(_0x594a07){console['error'](_0x594a07),_0xf995f5[_0x201179(0x23f)](0x1f4)['json']({'error':_0x201179(0x27a)});}})[_0x473c8d(0x2c0)](_0x439740=>{var _0x541bec=_0x473c8d;console[_0x541bec(0x282)](_0x439740),_0xf995f5[_0x541bec(0x23f)](0x1f4)['json']({'error':_0x541bec(0x205)});});}catch(_0x4e1121){console[_0x473c8d(0x30d)](_0x4e1121);}}),router[a0_0x3ee093(0x227)](a0_0x3ee093(0x237),auth,async(_0x59bb78,_0x1c3774)=>{var _0x988cde=a0_0x3ee093;try{const {username:_0x5f24b6,email:_0x16a888,role:_0x21ef9f}=_0x59bb78[_0x988cde(0x22f)],_0x62f876=_0x59bb78['user'],_0x2e58f9=await profile['findOne']({'email':_0x62f876[_0x988cde(0x29f)]}),_0x11bee1=await master_shop[_0x988cde(0x26b)](),_0x19537c=_0x59bb78[_0x988cde(0x278)]['id'],_0x5a1d52=await purchases[_0x988cde(0x2e0)](_0x19537c),_0x4cbab1=await warehouse[_0x988cde(0x2b9)]([{'$match':{'name':_0x5a1d52[_0x988cde(0x2ed)],'room':_0x5a1d52[_0x988cde(0x294)]}},{'$unwind':_0x988cde(0x211)},{'$group':{'_id':_0x988cde(0x2a8),'name':{'$first':_0x988cde(0x204)},'product_stock':{'$first':_0x988cde(0x1ff)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x988cde(0x273)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x988cde(0x2ad)},'primary_code':{'$first':_0x988cde(0x2bc)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x988cde(0x307)},'storage':{'$first':_0x988cde(0x201)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x186ec9=await customer['find']({});let _0xdd5088;if(_0x62f876['role']==_0x988cde(0x2c4)){const _0x4a4c1d=await staff['findOne']({'email':_0x62f876[_0x988cde(0x29f)]});_0xdd5088=await warehouse['aggregate']([{'$match':{'status':_0x988cde(0x2db),'name':_0x4a4c1d[_0x988cde(0x29a)]}},{'$group':{'_id':_0x988cde(0x286),'name':{'$first':_0x988cde(0x286)}}}]);}else _0xdd5088=await warehouse[_0x988cde(0x2b9)]([{'$match':{'status':_0x988cde(0x2db)}},{'$group':{'_id':_0x988cde(0x286),'name':{'$first':_0x988cde(0x286)}}}]);const _0x5180d2=await product[_0x988cde(0x26b)]({}),_0x3c8684=await suppliers[_0x988cde(0x26b)]({}),_0xe2380c=BayBinSelected(_0x5a1d52['warehouse_name'],_0x5a1d52[_0x988cde(0x294)]);if(_0x11bee1[0x0][_0x988cde(0x20d)]=='English\x20(US)'){var _0x17364d=users[_0x988cde(0x214)];console[_0x988cde(0x30d)](_0x17364d);}else{if(_0x11bee1[0x0][_0x988cde(0x20d)]=='Hindi')var _0x17364d=users[_0x988cde(0x233)];else{if(_0x11bee1[0x0]['language']==_0x988cde(0x235))var _0x17364d=users[_0x988cde(0x235)];else{if(_0x11bee1[0x0][_0x988cde(0x20d)]=='Spanish')var _0x17364d=users[_0x988cde(0x241)];else{if(_0x11bee1[0x0]['language']==_0x988cde(0x25a))var _0x17364d=users[_0x988cde(0x25a)];else{if(_0x11bee1[0x0][_0x988cde(0x20d)]=='Portuguese\x20(BR)')var _0x17364d=users[_0x988cde(0x279)];else{if(_0x11bee1[0x0][_0x988cde(0x20d)]==_0x988cde(0x2a7))var _0x17364d=users[_0x988cde(0x2a7)];else{if(_0x11bee1[0x0][_0x988cde(0x20d)]=='Arabic\x20(ae)')var _0x17364d=users[_0x988cde(0x207)];}}}}}}}_0x1c3774['render'](_0x988cde(0x1f7),{'success':_0x59bb78[_0x988cde(0x244)](_0x988cde(0x21a)),'errors':_0x59bb78['flash'](_0x988cde(0x252)),'role':_0x62f876,'profile':_0x2e58f9,'customer':_0x186ec9,'warehouse':_0xdd5088,'product':_0x4cbab1,'user':_0x5a1d52,'master_shop':_0x11bee1,'unit':_0x5180d2,'language':_0x17364d,'suppliers':_0x3c8684,'dataSelected':_0xe2380c});}catch(_0x2dd989){console['log'](_0x2dd989);}}),router['post']('/preview/:id',auth,async(_0x24bde0,_0x5220c1)=>{var _0x49b258=a0_0x3ee093;try{const _0x31fb38=_0x24bde0[_0x49b258(0x278)]['id'],{invoice:_0x3decc5,warehouse_name:_0x2a5d47,Room_name:_0x341c93}=_0x24bde0[_0x49b258(0x262)],_0x3fe6b5=await warehouse[_0x49b258(0x21f)]({'name':_0x2a5d47,'room':_0x341c93}),_0x31b855=await purchases['findOne']({'invoice':_0x3decc5});_0x31b855[_0x49b258(0x2a1)][_0x49b258(0x219)](_0x2e854f=>{var _0x5e8106=_0x49b258,_0x24de88=0x0;const _0x475bce=_0x3fe6b5['product_details'][_0x5e8106(0x29b)](_0x252e1a=>{var _0x2595f2=_0x5e8106;_0x252e1a['product_name']==_0x2e854f[_0x2595f2(0x2e6)]&&_0x252e1a[_0x2595f2(0x2df)]==_0x2e854f[_0x2595f2(0x2df)]&&_0x252e1a[_0x2595f2(0x297)]==_0x2e854f['type']&&_0x252e1a[_0x2595f2(0x29e)]==_0x2e854f[_0x2595f2(0x29e)]&&_0x252e1a[_0x2595f2(0x2b4)]==_0x2e854f[_0x2595f2(0x2b4)]&&_0x252e1a['rack']==_0x2e854f[_0x2595f2(0x2ea)]&&_0x252e1a[_0x2595f2(0x291)]==_0x2e854f[_0x2595f2(0x291)]&&_0x252e1a[_0x2595f2(0x20e)]==_0x2e854f['expiry_date']&&_0x252e1a[_0x2595f2(0x27f)]==_0x2e854f[_0x2595f2(0x27f)]&&_0x252e1a[_0x2595f2(0x2cd)]==_0x2e854f['production_date']&&_0x252e1a[_0x2595f2(0x1f8)]==_0x2e854f[_0x2595f2(0x1f8)]&&_0x252e1a[_0x2595f2(0x24f)]==_0x2e854f['delivery_code']&&(_0x252e1a['product_stock']=parseInt(_0x252e1a['product_stock'])+parseInt(_0x2e854f['quantity']),_0x24de88++);});_0x24de88=='0'&&(_0x3fe6b5['product_details']=_0x3fe6b5[_0x5e8106(0x313)][_0x5e8106(0x27b)]({'product_name':_0x2e854f[_0x5e8106(0x2e6)],'product_stock':_0x2e854f[_0x5e8106(0x239)],'primary_code':_0x2e854f[_0x5e8106(0x300)],'secondary_code':_0x2e854f[_0x5e8106(0x22d)],'product_code':_0x2e854f[_0x5e8106(0x24c)],'storage':_0x2e854f['storage'],'rack':_0x2e854f[_0x5e8106(0x2ea)],'bay':_0x2e854f[_0x5e8106(0x2b4)],'bin':_0x2e854f['bin'],'type':_0x2e854f['type'],'floorlevel':_0x2e854f[_0x5e8106(0x2df)],'maxProducts':_0x2e854f[_0x5e8106(0x30a)],'unit':_0x2e854f[_0x5e8106(0x318)],'secondary_unit':_0x2e854f['secondary_unit'],'expiry_date':_0x2e854f[_0x5e8106(0x20e)],'maxPerUnit':_0x2e854f[_0x5e8106(0x27e)],'batch_code':_0x2e854f[_0x5e8106(0x27f)],'alertQTY':_0x2e854f[_0x5e8106(0x308)],'production_date':_0x2e854f['production_date'],'delivery_date':_0x2e854f[_0x5e8106(0x1f8)],'delivery_code':_0x2e854f[_0x5e8106(0x24f)]}));}),await _0x3fe6b5['save'](),_0x31b855[_0x49b258(0x21d)]=_0x49b258(0x257);const _0x24af3c=await _0x31b855[_0x49b258(0x2af)]();_0x24bde0[_0x49b258(0x244)](_0x49b258(0x21a),_0x49b258(0x2a2)),_0x5220c1[_0x49b258(0x263)]('/all_purchases/view');}catch(_0x1bd53d){console['log'](_0x1bd53d);}}),router[a0_0x3ee093(0x227)](a0_0x3ee093(0x2ba),auth,async(_0x384a4a,_0x42898c)=>{var _0x20626e=a0_0x3ee093;try{const {username:_0x3d0eaf,email:_0x3ad859,role:_0x200472}=_0x384a4a[_0x20626e(0x22f)],_0x5436c4=_0x384a4a[_0x20626e(0x22f)],_0x46d1e3=await profile['findOne']({'email':_0x5436c4[_0x20626e(0x29f)]}),_0x3f8227=await master_shop[_0x20626e(0x26b)](),_0x22ba4f=_0x384a4a[_0x20626e(0x278)]['id'],_0x22df49=await purchases[_0x20626e(0x2e0)](_0x22ba4f),_0x5a3ffd=await suppliers['find']({});let _0x50748a;if(_0x5436c4['role']==_0x20626e(0x2c4)){const _0x345043=await staff['findOne']({'email':_0x5436c4['email']});_0x50748a=await warehouse[_0x20626e(0x26b)]({'status':'Enabled','name':_0x345043[_0x20626e(0x29a)],'warehouse_category':'Raw\x20Materials'});}else _0x50748a=await warehouse['aggregate']([{'$match':{'status':_0x20626e(0x2db),'warehouse_category':_0x20626e(0x274)}},{'$group':{'_id':_0x20626e(0x286),'name':{'$first':_0x20626e(0x286)}}}]);const _0x529da9=await product['find']({}),_0x163c24=BayBinSelected(_0x22df49[_0x20626e(0x2ed)],_0x22df49['room']);let _0x5e958d=new Date(_0x22df49[_0x20626e(0x20e)]),_0x2554ef=('0'+_0x5e958d[_0x20626e(0x20f)]())['slice'](-0x2),_0x29c57e=('0'+(_0x5e958d[_0x20626e(0x2d4)]()+0x1))[_0x20626e(0x27d)](-0x2),_0xa4b6f0=_0x5e958d['getFullYear'](),_0x4f5516=_0xa4b6f0+'-'+_0x29c57e+'-'+_0x2554ef;if(_0x3f8227[0x0]['language']==_0x20626e(0x2d2)){var _0x10153b=users[_0x20626e(0x214)];console['log'](_0x10153b);}else{if(_0x3f8227[0x0]['language']==_0x20626e(0x233))var _0x10153b=users[_0x20626e(0x233)];else{if(_0x3f8227[0x0][_0x20626e(0x20d)]==_0x20626e(0x235))var _0x10153b=users[_0x20626e(0x235)];else{if(_0x3f8227[0x0][_0x20626e(0x20d)]==_0x20626e(0x241))var _0x10153b=users[_0x20626e(0x241)];else{if(_0x3f8227[0x0][_0x20626e(0x20d)]=='French')var _0x10153b=users[_0x20626e(0x25a)];else{if(_0x3f8227[0x0][_0x20626e(0x20d)]=='Portuguese\x20(BR)')var _0x10153b=users[_0x20626e(0x279)];else{if(_0x3f8227[0x0][_0x20626e(0x20d)]==_0x20626e(0x2a7))var _0x10153b=users[_0x20626e(0x2a7)];else{if(_0x3f8227[0x0][_0x20626e(0x20d)]==_0x20626e(0x25c))var _0x10153b=users[_0x20626e(0x207)];}}}}}}}_0x42898c['render'](_0x20626e(0x1f4),{'success':_0x384a4a['flash'](_0x20626e(0x21a)),'errors':_0x384a4a[_0x20626e(0x244)](_0x20626e(0x252)),'role':_0x5436c4,'profile':_0x46d1e3,'purchases':_0x22df49,'suppliers':_0x5a3ffd,'warehouse':_0x50748a,'product':_0x529da9,'master_shop':_0x3f8227,'language':_0x10153b,'ed_fullDate':_0x4f5516,'dataSelected':_0x163c24});}catch(_0x35ed40){console[_0x20626e(0x30d)](_0x35ed40);}}),router[a0_0x3ee093(0x2aa)]('/view/:id',auth,async(_0x50a90a,_0xc6ab1c)=>{var _0x1af6a2=a0_0x3ee093;try{const _0x8237d4=_0x50a90a[_0x1af6a2(0x278)]['id'],_0x2a36db=await purchases[_0x1af6a2(0x21f)]({'_id':_0x50a90a[_0x1af6a2(0x278)]['id']}),_0x3b8302=await warehouse[_0x1af6a2(0x21f)]({'name':_0x2a36db[_0x1af6a2(0x2ed)],'room':_0x2a36db[_0x1af6a2(0x294)]});_0x2a36db[_0x1af6a2(0x2a1)][_0x1af6a2(0x219)](_0x9e74b4=>{var _0xd93367=_0x1af6a2;const _0x56e4ec=_0x3b8302[_0xd93367(0x313)][_0xd93367(0x29b)](_0x503159=>{var _0x32e3c1=_0xd93367;_0x503159[_0x32e3c1(0x2e6)]==_0x9e74b4[_0x32e3c1(0x2e6)]&&_0x503159[_0x32e3c1(0x2df)]==_0x9e74b4['floorlevel']&&_0x503159['type']==_0x9e74b4[_0x32e3c1(0x297)]&&_0x503159[_0x32e3c1(0x29e)]==_0x9e74b4[_0x32e3c1(0x29e)]&&_0x503159[_0x32e3c1(0x2b4)]==_0x9e74b4[_0x32e3c1(0x2b4)]&&_0x503159['rack']==_0x9e74b4[_0x32e3c1(0x2ea)]&&_0x503159[_0x32e3c1(0x291)]==_0x9e74b4['storage']&&(_0x503159[_0x32e3c1(0x2d1)]=parseInt(_0x503159['product_stock'])-parseInt(_0x9e74b4[_0x32e3c1(0x239)]));});}),await _0x3b8302[_0x1af6a2(0x2af)]();const {invoice:_0x53ed8f,suppliers:_0x5690f8,date:_0x4cda8b,warehouse_name:_0xbf56c2,prod_name:_0x2aa94a,prod_code:_0x2c0469,prod_qty:_0x1bb625,prod_unit:_0x42c7df,prod_secondunit:_0x12d40b,prod_level:_0x36432f,prod_isle:_0x3264e8,prod_pallet:_0x1d8193,note:_0x4ee3fa,expiry_date:_0x25ab8c,batch_code:_0x5482a1,paid_amount:_0x51a8db,due_amount:_0x520776,Room_name:_0x115da2,primary_code:_0x377471,secondary_code:_0x30b6c3,PO_number:_0x1f7013,JO_number:_0xf98e93}=_0x50a90a[_0x1af6a2(0x262)];if(typeof _0x2aa94a=='string')var _0x27bee4=[_0x50a90a['body'][_0x1af6a2(0x317)]],_0x3db32b=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x287)]],_0x18f3b2=[_0x50a90a['body'][_0x1af6a2(0x260)]],_0xb82c17=[_0x50a90a['body'][_0x1af6a2(0x2ce)]],_0x5db9b3=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x272)]],_0x11295c=[_0x50a90a[_0x1af6a2(0x262)]['prod_level']],_0x1867c2=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x26e)]],_0x26e486=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x22a)]],_0x34bf47=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x300)]],_0x298533=[_0x50a90a['body'][_0x1af6a2(0x22d)]],_0x4f489e=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x302)]],_0x2d7a60=[_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x27f)]],_0x58c6e3=[_0x50a90a[_0x1af6a2(0x262)]['expiry_date']],_0x39f164=[_0x50a90a[_0x1af6a2(0x262)]['storage']],_0x38d6dd=[_0x50a90a[_0x1af6a2(0x262)]['rak']],_0x443464=[_0x50a90a['body']['type']];else var _0x27bee4=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x317)]],_0x3db32b=[..._0x50a90a[_0x1af6a2(0x262)]['prod_code']],_0x18f3b2=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x260)]],_0xb82c17=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x2ce)]],_0x5db9b3=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x272)]],_0x11295c=[..._0x50a90a['body'][_0x1af6a2(0x288)]],_0x1867c2=[..._0x50a90a['body'][_0x1af6a2(0x26e)]],_0x26e486=[..._0x50a90a['body']['prod_pallet']],_0x34bf47=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x300)]],_0x298533=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x22d)]],_0x4f489e=[..._0x50a90a['body'][_0x1af6a2(0x302)]],_0x2d7a60=[..._0x50a90a['body'][_0x1af6a2(0x27f)]],_0x58c6e3=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x20e)]],_0x39f164=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x291)]],_0x38d6dd=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x2eb)]],_0x443464=[..._0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x297)]];const _0x8e9e43=_0x27bee4[_0x1af6a2(0x29b)](_0x1022eb=>{return _0x1022eb={'product_name':_0x1022eb};});_0x3db32b[_0x1af6a2(0x219)]((_0xd599fd,_0x163477)=>{_0x8e9e43[_0x163477]['product_code']=_0xd599fd;}),_0x18f3b2[_0x1af6a2(0x219)]((_0x3bcc9d,_0x38dd68)=>{var _0x5a13fb=_0x1af6a2;_0x8e9e43[_0x38dd68][_0x5a13fb(0x239)]=_0x3bcc9d;}),_0xb82c17[_0x1af6a2(0x219)]((_0x3b6de8,_0xea33c8)=>{_0x8e9e43[_0xea33c8]['standard_unit']=_0x3b6de8;}),_0x5db9b3[_0x1af6a2(0x219)]((_0x4de71a,_0x2f8eba)=>{_0x8e9e43[_0x2f8eba]['secondary_unit']=_0x4de71a;}),_0x11295c[_0x1af6a2(0x219)]((_0x45f681,_0x35cd38)=>{var _0x32932e=_0x1af6a2;_0x8e9e43[_0x35cd38][_0x32932e(0x2b4)]=_0x45f681;}),_0x1867c2['forEach']((_0x1fd371,_0x50ef91)=>{_0x8e9e43[_0x50ef91]['bin']=_0x1fd371;}),_0x26e486[_0x1af6a2(0x219)]((_0x2e77bd,_0x473967)=>{_0x8e9e43[_0x473967]['floorlevel']=_0x2e77bd;}),_0x34bf47[_0x1af6a2(0x219)]((_0xca4c7e,_0x25c954)=>{var _0x178714=_0x1af6a2;_0x8e9e43[_0x25c954][_0x178714(0x300)]=_0xca4c7e;}),_0x298533[_0x1af6a2(0x219)]((_0x4901f2,_0x1dc811)=>{_0x8e9e43[_0x1dc811]['secondary_code']=_0x4901f2;}),_0x4f489e[_0x1af6a2(0x219)]((_0x42906b,_0x58090f)=>{var _0x1560c8=_0x1af6a2;_0x8e9e43[_0x58090f][_0x1560c8(0x30a)]=_0x42906b;}),_0x2d7a60[_0x1af6a2(0x219)]((_0x116008,_0x42f51e)=>{var _0x319837=_0x1af6a2;_0x8e9e43[_0x42f51e][_0x319837(0x27f)]=_0x116008;}),_0x58c6e3[_0x1af6a2(0x219)]((_0x5ce9af,_0x59f218)=>{_0x8e9e43[_0x59f218]['expiry_date']=_0x5ce9af;}),_0x443464[_0x1af6a2(0x219)]((_0x479b8f,_0x5320de)=>{_0x8e9e43[_0x5320de]['type']=_0x479b8f;}),_0x39f164[_0x1af6a2(0x219)]((_0x5523dc,_0x15d9f8)=>{var _0x5a26d0=_0x1af6a2;_0x8e9e43[_0x15d9f8][_0x5a26d0(0x291)]=_0x5523dc;}),_0x38d6dd[_0x1af6a2(0x219)]((_0x18d39c,_0x5bd990)=>{var _0x3405b9=_0x1af6a2;_0x8e9e43[_0x5bd990][_0x3405b9(0x2ea)]=_0x18d39c;});const _0x2136eb=_0x8e9e43[_0x1af6a2(0x24a)](_0xff4477=>_0xff4477[_0x1af6a2(0x239)]!=='0'&&_0xff4477[_0x1af6a2(0x239)]!=='');_0x2a36db['invoice']=_0x53ed8f,_0x2a36db[_0x1af6a2(0x209)]=_0x5690f8,_0x2a36db[_0x1af6a2(0x309)]=_0x4cda8b,_0x2a36db['warehouse_name']=_0xbf56c2,_0x2a36db[_0x1af6a2(0x2a1)]=_0x2136eb,_0x2a36db[_0x1af6a2(0x225)]=_0x4ee3fa,_0x2a36db[_0x1af6a2(0x2ee)]=_0x51a8db,_0x2a36db[_0x1af6a2(0x23a)]=_0x520776,_0x2a36db[_0x1af6a2(0x294)]=_0x115da2,_0x2a36db[_0x1af6a2(0x2e2)]=_0x1f7013,_0x2a36db[_0x1af6a2(0x2e3)]=_0xf98e93;const _0xa69bef=await _0x2a36db[_0x1af6a2(0x2af)](),_0x549ac3=await warehouse['findOne']({'name':_0x50a90a[_0x1af6a2(0x262)]['warehouse_name'],'room':_0x50a90a[_0x1af6a2(0x262)][_0x1af6a2(0x275)]});_0x2a36db[_0x1af6a2(0x2a1)][_0x1af6a2(0x219)](_0x5633d1=>{var _0x18a00d=_0x1af6a2,_0x353d96=0x0;const _0x598f51=_0x549ac3['product_details']['map'](_0x2ff254=>{var _0x2c9b1e=a0_0x3da0;_0x2ff254['product_name']==_0x5633d1['product_name']&&_0x2ff254[_0x2c9b1e(0x2df)]==_0x5633d1[_0x2c9b1e(0x2df)]&&_0x2ff254[_0x2c9b1e(0x297)]==_0x5633d1['type']&&_0x2ff254[_0x2c9b1e(0x29e)]==_0x5633d1[_0x2c9b1e(0x29e)]&&_0x2ff254[_0x2c9b1e(0x2b4)]==_0x5633d1[_0x2c9b1e(0x2b4)]&&_0x2ff254[_0x2c9b1e(0x2ea)]==_0x5633d1[_0x2c9b1e(0x2ea)]&&_0x2ff254[_0x2c9b1e(0x291)]==_0x5633d1[_0x2c9b1e(0x291)]&&(_0x2ff254[_0x2c9b1e(0x2d1)]=parseInt(_0x2ff254['product_stock'])+parseInt(_0x5633d1['quantity']),_0x353d96++);});_0x353d96=='0'&&(_0x549ac3[_0x18a00d(0x313)]=_0x549ac3[_0x18a00d(0x313)][_0x18a00d(0x27b)]({'product_name':_0x5633d1[_0x18a00d(0x2e6)],'product_stock':_0x5633d1[_0x18a00d(0x239)],'primary_code':_0x5633d1['primary_code'],'secondary_code':_0x5633d1['secondary_code'],'product_code':_0x5633d1[_0x18a00d(0x24c)],'storage':_0x5633d1[_0x18a00d(0x291)],'rack':_0x5633d1[_0x18a00d(0x2ea)],'bay':_0x5633d1[_0x18a00d(0x2b4)],'bin':_0x5633d1['bin'],'type':_0x5633d1[_0x18a00d(0x297)],'floorlevel':_0x5633d1[_0x18a00d(0x2df)],'maxProducts':_0x5633d1[_0x18a00d(0x30a)],'unit':_0x5633d1['standard_unit'],'secondary_unit':_0x5633d1[_0x18a00d(0x1f6)],'expiry_date':_0x5633d1[_0x18a00d(0x20e)]}));}),await _0x549ac3[_0x1af6a2(0x2af)]();const _0x1b3bb7=await s_payment_data[_0x1af6a2(0x21f)]({'invoice':_0x50a90a[_0x1af6a2(0x262)]['invoice']});if(_0x1b3bb7===null){}else console['log']('suppliers',_0x1b3bb7,_0x50a90a[_0x1af6a2(0x262)]['invoice']),_0x1b3bb7[_0x1af6a2(0x209)]=_0x50a90a[_0x1af6a2(0x262)]['suppliers'],await _0x1b3bb7[_0x1af6a2(0x2af)]();_0x50a90a[_0x1af6a2(0x244)]('success','purchase\x20data\x20update\x20successfully'),_0xc6ab1c[_0x1af6a2(0x263)](_0x1af6a2(0x314));}catch(_0x5a6503){console[_0x1af6a2(0x30d)](_0x5a6503);}}),router[a0_0x3ee093(0x2aa)](a0_0x3ee093(0x26a),auth,async(_0x1d9677,_0x2b7592)=>{var _0x658495=a0_0x3ee093;try{const _0x2bfc8f=_0x1d9677[_0x658495(0x278)]['id'],{invoice:_0x44abd5,suppliers:_0x40c407,payable:_0x31220b,due_amount:_0x448221}=_0x1d9677['body'],_0x50ebe9=await purchases[_0x658495(0x2e0)](_0x2bfc8f);var _0x1e8f83=_0x31220b-_0x448221;_0x50ebe9[_0x658495(0x2ee)]=parseFloat(_0x50ebe9[_0x658495(0x2ee)])+parseFloat(_0x448221),_0x50ebe9[_0x658495(0x23a)]=_0x1e8f83;const _0xdfd620=await _0x50ebe9['save']();console[_0x658495(0x30d)](_0xdfd620);const _0x5e8697=await s_payment_data[_0x658495(0x21f)]({'invoice':_0x44abd5});_0x5e8697[_0x658495(0x2e5)]=_0x1e8f83,await _0x5e8697[_0x658495(0x2af)]();let _0x3ea87b=new Date(),_0x2cb062=('0'+_0x3ea87b[_0x658495(0x20f)]())['slice'](-0x2),_0x2a956b=('0'+(_0x3ea87b[_0x658495(0x2d4)]()+0x1))[_0x658495(0x27d)](-0x2),_0x4bed18=_0x3ea87b[_0x658495(0x283)](),_0xcbf804=_0x4bed18+'-'+_0x2a956b+'-'+_0x2cb062;const _0x4a8de6=new suppliers_payment({'invoice':_0x44abd5,'date':_0x4bed18+'-'+_0x2a956b+'-'+_0x2cb062,'suppliers':_0x40c407,'reason':'Paid\x20For\x20Purchase','amount':_0x448221}),_0x4c7f95=await _0x4a8de6[_0x658495(0x2af)]();_0x1d9677[_0x658495(0x244)](_0x658495(0x21a),'payment\x20successfull'),_0x2b7592['redirect']('/all_purchases/view');}catch(_0x4d26e2){console[_0x658495(0x30d)](_0x4d26e2);}}),router[a0_0x3ee093(0x227)](a0_0x3ee093(0x31b),auth,async(_0x3e9766,_0x2d4da4)=>{var _0x4dd675=a0_0x3ee093;try{const {username:_0x1a331f,email:_0x5b0d17,role:_0x505a87}=_0x3e9766['user'],_0x3949b9=_0x3e9766[_0x4dd675(0x22f)],_0x3e0ea8=await profile['findOne']({'email':_0x3949b9[_0x4dd675(0x29f)]}),_0x4098f0=await master_shop['find']();console[_0x4dd675(0x30d)](_0x4dd675(0x2de),_0x4098f0);const _0x39ac24=_0x3e9766[_0x4dd675(0x278)]['id'],_0x1b579f=await purchases[_0x4dd675(0x2e0)](_0x39ac24);console[_0x4dd675(0x30d)](_0x1b579f);const _0x16e5d5=await suppliers[_0x4dd675(0x21f)]({'name':_0x1b579f[_0x4dd675(0x209)]});console[_0x4dd675(0x30d)](_0x16e5d5);if(_0x4098f0[0x0][_0x4dd675(0x20d)]==_0x4dd675(0x2d2)){var _0x5711b4=users[_0x4dd675(0x214)];console[_0x4dd675(0x30d)](_0x5711b4);}else{if(_0x4098f0[0x0][_0x4dd675(0x20d)]=='Hindi')var _0x5711b4=users[_0x4dd675(0x233)];else{if(_0x4098f0[0x0][_0x4dd675(0x20d)]==_0x4dd675(0x235))var _0x5711b4=users[_0x4dd675(0x235)];else{if(_0x4098f0[0x0][_0x4dd675(0x20d)]==_0x4dd675(0x241))var _0x5711b4=users['Spanish'];else{if(_0x4098f0[0x0][_0x4dd675(0x20d)]=='French')var _0x5711b4=users[_0x4dd675(0x25a)];else{if(_0x4098f0[0x0][_0x4dd675(0x20d)]==_0x4dd675(0x2c3))var _0x5711b4=users[_0x4dd675(0x279)];else{if(_0x4098f0[0x0]['language']==_0x4dd675(0x2a7))var _0x5711b4=users[_0x4dd675(0x2a7)];else{if(_0x4098f0[0x0][_0x4dd675(0x20d)]==_0x4dd675(0x25c))var _0x5711b4=users[_0x4dd675(0x207)];}}}}}}}_0x2d4da4[_0x4dd675(0x1fc)]('purchase_invoice',{'success':_0x3e9766[_0x4dd675(0x244)]('success'),'errors':_0x3e9766[_0x4dd675(0x244)](_0x4dd675(0x252)),'role':_0x3949b9,'profile':_0x3e0ea8,'master_shop':_0x4098f0,'supplier':_0x16e5d5,'purchase':_0x1b579f,'language':_0x5711b4});}catch(_0x1a4bcb){console['log'](_0x1a4bcb);}}),router[a0_0x3ee093(0x227)](a0_0x3ee093(0x2b7),auth,async(_0xa98a3f,_0x28febe)=>{var _0x33b6a1=a0_0x3ee093;try{const {username:_0x8c3767,email:_0x26d7df,role:_0x340947}=_0xa98a3f[_0x33b6a1(0x22f)],_0x3a587c=_0xa98a3f[_0x33b6a1(0x22f)],_0x1dbb3f=await profile[_0x33b6a1(0x21f)]({'email':_0x3a587c['email']}),_0x27f082=await master_shop['find']();console[_0x33b6a1(0x30d)](_0x33b6a1(0x2de),_0x27f082);const _0x4ebba2=_0xa98a3f[_0x33b6a1(0x278)]['id'];console['log'](_0x4ebba2);const _0x18de68=await purchases[_0x33b6a1(0x2e0)](_0x4ebba2);console[_0x33b6a1(0x30d)](_0x33b6a1(0x23b),_0x18de68);const _0x47bf15=await product[_0x33b6a1(0x26b)]({}),_0x458ac3=await warehouse[_0x33b6a1(0x2b9)]([{'$match':{'name':_0x18de68['warehouse_name'],'room':_0x18de68[_0x33b6a1(0x294)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x33b6a1(0x211)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x33b6a1(0x204)},'product_stock':{'$first':_0x33b6a1(0x1ff)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x33b6a1(0x273)},'type':{'$first':_0x33b6a1(0x226)},'floorlevel':{'$first':_0x33b6a1(0x2ad)},'primary_code':{'$first':_0x33b6a1(0x2bc)},'secondary_code':{'$first':_0x33b6a1(0x28d)},'product_code':{'$first':_0x33b6a1(0x307)},'storage':{'$first':_0x33b6a1(0x201)},'rack':{'$first':_0x33b6a1(0x218)}}}]);warehouse_data=await warehouse[_0x33b6a1(0x2b9)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x33b6a1(0x274)}},{'$group':{'_id':_0x33b6a1(0x286),'name':{'$first':_0x33b6a1(0x286)}}},{'$sort':{'name':0x1}}]),console[_0x33b6a1(0x30d)](_0x33b6a1(0x26d),_0x458ac3);if(_0x27f082[0x0]['language']=='English\x20(US)'){var _0x4735b4=users[_0x33b6a1(0x214)];console[_0x33b6a1(0x30d)](_0x4735b4);}else{if(_0x27f082[0x0]['language']==_0x33b6a1(0x233))var _0x4735b4=users[_0x33b6a1(0x233)];else{if(_0x27f082[0x0][_0x33b6a1(0x20d)]==_0x33b6a1(0x235))var _0x4735b4=users[_0x33b6a1(0x235)];else{if(_0x27f082[0x0]['language']==_0x33b6a1(0x241))var _0x4735b4=users[_0x33b6a1(0x241)];else{if(_0x27f082[0x0][_0x33b6a1(0x20d)]==_0x33b6a1(0x25a))var _0x4735b4=users[_0x33b6a1(0x25a)];else{if(_0x27f082[0x0][_0x33b6a1(0x20d)]==_0x33b6a1(0x2c3))var _0x4735b4=users[_0x33b6a1(0x279)];else{if(_0x27f082[0x0][_0x33b6a1(0x20d)]==_0x33b6a1(0x2a7))var _0x4735b4=users[_0x33b6a1(0x2a7)];else{if(_0x27f082[0x0]['language']==_0x33b6a1(0x25c))var _0x4735b4=users[_0x33b6a1(0x207)];}}}}}}}_0x28febe[_0x33b6a1(0x1fc)](_0x33b6a1(0x25f),{'success':_0xa98a3f[_0x33b6a1(0x244)]('success'),'errors':_0xa98a3f[_0x33b6a1(0x244)](_0x33b6a1(0x252)),'role':_0x3a587c,'profile':_0x1dbb3f,'user':_0x18de68,'stock':_0x458ac3,'master_shop':_0x27f082,'product':_0x47bf15,'language':_0x4735b4,'warehouse':warehouse_data});}catch(_0x26e336){console[_0x33b6a1(0x30d)](_0x26e336);}}),router[a0_0x3ee093(0x2aa)](a0_0x3ee093(0x2b7),auth,async(_0x2314bb,_0x4f09d2)=>{var _0x47c84c=a0_0x3ee093;try{const {invoice:_0x5ebec1,date:_0x4fb82e,warehouse_name:_0x4e6b27,Room_name:_0x34df76,product_name:_0x18cbc2,purchase_quantity:_0x484d07,stocks:_0x3aa644,return_qty:_0x51b247,note:_0x35d0a0,level:_0x590537,isle:_0x2659f6,pallet:_0x3e0ad2,to_warehouse_name:_0x3e1a66,to_Room_name:_0x29b231}=_0x2314bb['body'],_0x598d9d=await purchases['findOne']({'_id':_0x2314bb[_0x47c84c(0x278)]['id']}),_0x180c09=await warehouse[_0x47c84c(0x21f)]({'name':_0x4e6b27,'room':_0x34df76});if(typeof _0x18cbc2==_0x47c84c(0x2bd))var _0x1fa8c9=[_0x2314bb['body']['product_name']],_0x5d5964=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x22c)]],_0x390317=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x30c)]],_0x447259=[_0x2314bb['body'][_0x47c84c(0x2e7)]],_0x24bbac=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x2b5)]],_0x5e505b=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x2e4)]],_0x51d4ed=[_0x2314bb['body']['pallet']],_0xf57706=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x20c)]],_0x1e0581=[_0x2314bb[_0x47c84c(0x262)]['product_code_hide']],_0x484b73=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x2be)]],_0x135c0f=[_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x21e)]];else var _0x1fa8c9=[..._0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x2e6)]],_0x5d5964=[..._0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x22c)]],_0x390317=[..._0x2314bb[_0x47c84c(0x262)]['stocks']],_0x447259=[..._0x2314bb[_0x47c84c(0x262)]['return_qty']],_0x24bbac=[..._0x2314bb['body'][_0x47c84c(0x2b5)]],_0x5e505b=[..._0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x2e4)]],_0x51d4ed=[..._0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x208)]],_0xf57706=[..._0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x20c)]],_0x1e0581=[..._0x2314bb['body'][_0x47c84c(0x28c)]],_0x484b73=[..._0x2314bb[_0x47c84c(0x262)]['primary_code_hide']],_0x135c0f=[..._0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x21e)]];const _0x16665c=_0x1fa8c9[_0x47c84c(0x29b)](_0x5f14c6=>{return _0x5f14c6={'product_name':_0x5f14c6};});_0x5d5964['forEach']((_0x2e653d,_0x3c7f9a)=>{_0x16665c[_0x3c7f9a]['purchase_quantity']=_0x2e653d;}),_0x390317['forEach']((_0x30350f,_0x1d48f5)=>{var _0x3af4b2=_0x47c84c;_0x16665c[_0x1d48f5][_0x3af4b2(0x2a5)]=_0x30350f;}),_0x447259[_0x47c84c(0x219)]((_0x2ff9a0,_0x4fb993)=>{var _0x2f8301=_0x47c84c;_0x16665c[_0x4fb993][_0x2f8301(0x2e7)]=_0x2ff9a0;}),_0x24bbac[_0x47c84c(0x219)]((_0x17a00c,_0x2a4ecc)=>{var _0x1565a3=_0x47c84c;_0x16665c[_0x2a4ecc][_0x1565a3(0x2b4)]=_0x17a00c;}),_0x5e505b['forEach']((_0x54075a,_0x30e21a)=>{_0x16665c[_0x30e21a]['bin']=_0x54075a;}),_0x51d4ed[_0x47c84c(0x219)]((_0x12c55d,_0xbb3dbe)=>{var _0x719446=_0x47c84c;_0x16665c[_0xbb3dbe][_0x719446(0x2df)]=_0x12c55d;}),_0xf57706['forEach']((_0x29e024,_0x17a392)=>{var _0xc5d34=_0x47c84c;_0x16665c[_0x17a392][_0xc5d34(0x297)]=_0x29e024;}),_0x1e0581[_0x47c84c(0x219)]((_0x243100,_0x496637)=>{_0x16665c[_0x496637]['product_code']=_0x243100;}),_0x484b73[_0x47c84c(0x219)]((_0x352b8b,_0x1dd624)=>{_0x16665c[_0x1dd624]['primary_code']=_0x352b8b;}),_0x135c0f['forEach']((_0x50fac8,_0x3d26a2)=>{var _0x3ca04b=_0x47c84c;_0x16665c[_0x3d26a2][_0x3ca04b(0x22d)]=_0x50fac8;}),_0x598d9d[_0x47c84c(0x2a1)][_0x47c84c(0x219)](_0x82ccec=>{var _0x4fc1f1=_0x47c84c;const _0x4964c2=_0x180c09[_0x4fc1f1(0x313)][_0x4fc1f1(0x29b)](_0x41f7bc=>{var _0x4367ab=_0x4fc1f1;_0x41f7bc[_0x4367ab(0x2e6)]==_0x82ccec[_0x4367ab(0x2e6)]&&_0x41f7bc['floorlevel']==_0x82ccec[_0x4367ab(0x2df)]&&_0x41f7bc['type']==_0x82ccec[_0x4367ab(0x297)]&&_0x41f7bc['bin']==_0x82ccec['bin']&&_0x41f7bc[_0x4367ab(0x2b4)]==_0x82ccec[_0x4367ab(0x2b4)]&&_0x41f7bc[_0x4367ab(0x2ea)]==_0x82ccec[_0x4367ab(0x2ea)]&&_0x41f7bc[_0x4367ab(0x291)]==_0x82ccec[_0x4367ab(0x291)]&&(console['log'](parseInt(_0x41f7bc['product_stock'])+_0x4367ab(0x2c7)+parseInt(_0x82ccec[_0x4367ab(0x239)])),_0x41f7bc[_0x4367ab(0x2d1)]=parseInt(_0x41f7bc[_0x4367ab(0x2d1)])+parseInt(_0x82ccec[_0x4367ab(0x239)]));});}),await _0x180c09[_0x47c84c(0x2af)]();const _0x252531=_0x16665c[_0x47c84c(0x24a)](_0x407545=>_0x407545['return_qty']!=='0'&&_0x407545[_0x47c84c(0x2e7)]!=='');var _0x2f6935=0x0;_0x252531[_0x47c84c(0x219)](_0xb3e494=>{var _0x14dafc=_0x47c84c;console[_0x14dafc(0x30d)](_0x14dafc(0x29d),_0xb3e494),(parseInt(_0xb3e494[_0x14dafc(0x22c)])<parseInt(_0xb3e494[_0x14dafc(0x2e7)])||parseInt(_0xb3e494[_0x14dafc(0x2a5)])<parseInt(_0xb3e494[_0x14dafc(0x2e7)]))&&_0x2f6935++;});if(_0x2f6935!=0x0)return _0x2314bb[_0x47c84c(0x244)](_0x47c84c(0x252),_0x47c84c(0x243)),_0x4f09d2['redirect'](_0x47c84c(0x289));const _0x49341b=new purchases_return({'invoice':_0x5ebec1,'suppliers':_0x2314bb[_0x47c84c(0x262)]['suppliers'],'date':_0x4fb82e,'warehouse_name':_0x4e6b27,'return_product':_0x252531,'note':_0x35d0a0,'room':_0x34df76,'to_warehouse_name':_0x3e1a66,'to_room':_0x29b231}),_0x21097d=await _0x49341b[_0x47c84c(0x2af)]();console[_0x47c84c(0x30d)](_0x49341b);const _0x333044=await purchases_return[_0x47c84c(0x21f)]({'invoice':_0x5ebec1}),_0x2a650b=await warehouse['findOne']({'name':_0x3e1a66,'room':_0x29b231});_0x333044[_0x47c84c(0x299)]['forEach'](_0x379f01=>{var _0xeae23a=_0x47c84c,_0x1bcf07=0x0;const _0x23b3f9=_0x2a650b['product_details'][_0xeae23a(0x29b)](_0x104cd6=>{var _0x584323=_0xeae23a;_0x104cd6[_0x584323(0x2e6)]==_0x379f01[_0x584323(0x2e6)]&&_0x104cd6[_0x584323(0x2df)]==_0x379f01[_0x584323(0x2df)]&&_0x104cd6[_0x584323(0x297)]==_0x379f01[_0x584323(0x297)]&&_0x104cd6['bin']==_0x379f01[_0x584323(0x29e)]&&_0x104cd6['bay']==_0x379f01[_0x584323(0x2b4)]&&(_0x104cd6[_0x584323(0x2d1)]=parseInt(_0x104cd6['product_stock'])-parseInt(_0x379f01[_0x584323(0x2e7)]),_0x1bcf07++);});_0x1bcf07=='0'&&(_0x2a650b[_0xeae23a(0x313)]=_0x2a650b['product_details'][_0xeae23a(0x27b)]({'product_name':_0x379f01[_0xeae23a(0x2e6)],'product_stock':_0x379f01['return_qty'],'primary_code':_0x379f01[_0xeae23a(0x300)],'secondary_code':_0x379f01[_0xeae23a(0x22d)],'product_code':_0x379f01[_0xeae23a(0x24c)],'storage':_0x379f01['storage'],'rack':_0x379f01[_0xeae23a(0x2ea)],'bay':_0x379f01[_0xeae23a(0x2b4)],'bin':_0x379f01[_0xeae23a(0x29e)],'type':_0x379f01[_0xeae23a(0x297)],'floorlevel':_0x379f01[_0xeae23a(0x2df)],'maxProducts':_0x379f01['maxStocks'],'unit':_0x379f01[_0xeae23a(0x318)],'secondary_unit':_0x379f01[_0xeae23a(0x1f6)],'expiry_date':_0x379f01[_0xeae23a(0x20e)]}));}),await _0x2a650b[_0x47c84c(0x2af)]();const _0x42027c=await purchases['findOne']({'invoice':_0x5ebec1});_0x42027c[_0x47c84c(0x2b3)]='True';const _0x3e7b7e=await _0x42027c[_0x47c84c(0x2af)](),_0x1ad9d5=new s_payment_data({'invoice':_0x5ebec1,'suppliers':_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x209)],'reason':'Purchase\x20Return'});await _0x1ad9d5['save']();const _0x3d7a72=await master_shop[_0x47c84c(0x26b)]();console[_0x47c84c(0x30d)](_0x47c84c(0x296),_0x3d7a72[0x0][_0x47c84c(0x31a)]);const _0x27ce94=await email_settings['findOne'](),_0x3aa593=await suppliers[_0x47c84c(0x21f)]({'name':_0x2314bb[_0x47c84c(0x262)][_0x47c84c(0x209)]});console[_0x47c84c(0x30d)](_0x47c84c(0x258),_0x3aa593);_0x3d7a72[0x0][_0x47c84c(0x223)]==0x1?(right_currency=_0x3d7a72[0x0][_0x47c84c(0x2c5)],left_currency=''):(right_currency='',left_currency=_0x3d7a72[0x0]['currency']);var _0x13d9e8=_0x1fa8c9,_0x57307d=_0x447259,_0x2f4d0d='',_0x21425e;for(_0x21425e in _0x13d9e8){_0x2f4d0d+=_0x47c84c(0x2a3)+_0x47c84c(0x292)+_0x13d9e8[_0x21425e]+_0x47c84c(0x23c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x57307d[_0x21425e]+'</td>'+_0x47c84c(0x30f);}console[_0x47c84c(0x30d)](_0x47c84c(0x2ab),_0x2f4d0d);let _0x1787cb=nodemailer[_0x47c84c(0x222)]({'service':_0x47c84c(0x1fe),'auth':{'user':_0x27ce94[_0x47c84c(0x29f)],'pass':_0x27ce94[_0x47c84c(0x1f5)]}}),_0x4144b7={'from':_0x27ce94[_0x47c84c(0x29f)],'to':_0x3aa593['email'],'subject':_0x47c84c(0x312),'attachments':[{'filename':'Logo.png','path':__dirname+_0x47c84c(0x2dc)+_0x47c84c(0x2fc)+_0x3d7a72[0x0][_0x47c84c(0x31a)],'cid':_0x47c84c(0x2fe)}],'html':'<!DOCTYPE\x20html>'+_0x47c84c(0x2b1)+_0x47c84c(0x2a6)+_0x47c84c(0x232)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x47c84c(0x232)+_0x47c84c(0x230)+_0x47c84c(0x28f)+_0x47c84c(0x232)+_0x47c84c(0x2b0)+_0x3d7a72[0x0]['site_title']+_0x47c84c(0x220)+'</div>'+'</div>'+_0x47c84c(0x2e1)+_0x47c84c(0x232)+_0x47c84c(0x200)+_0x47c84c(0x25e)+_0x5ebec1+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x47c84c(0x2ec)+_0x4fb82e+'\x20'+_0x47c84c(0x270)+_0x47c84c(0x224)+'</div>'+_0x47c84c(0x250)+_0x47c84c(0x2ef)+_0x47c84c(0x2a3)+_0x47c84c(0x256)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x47c84c(0x1fb)+_0x47c84c(0x253)+_0x47c84c(0x30f)+_0x47c84c(0x2f9)+_0x47c84c(0x276)+'\x20'+_0x2f4d0d+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x47c84c(0x2cf)+_0x47c84c(0x28a)+_0x3d7a72[0x0][_0x47c84c(0x2f5)]+'</h5>'+_0x47c84c(0x28f)+_0x47c84c(0x28f)+_0x47c84c(0x236)};_0x1787cb[_0x47c84c(0x285)](_0x4144b7,function(_0x5b04f1,_0x4aa678){var _0x355fd8=_0x47c84c;_0x5b04f1?(console[_0x355fd8(0x30d)](_0x5b04f1),console[_0x355fd8(0x30d)]('Error\x20Occurs')):console[_0x355fd8(0x30d)](_0x355fd8(0x242));}),_0x2314bb[_0x47c84c(0x244)](_0x47c84c(0x21a),_0x47c84c(0x203)),_0x4f09d2[_0x47c84c(0x263)](_0x47c84c(0x314));}catch(_0x2004fe){console[_0x47c84c(0x30d)](_0x2004fe),_0x4f09d2[_0x47c84c(0x23f)](0xc8)[_0x47c84c(0x2c9)]({'message':_0x2004fe[_0x47c84c(0x2d7)]});}}),router[a0_0x3ee093(0x227)](a0_0x3ee093(0x281),auth,async(_0x4e6f59,_0xac6d61)=>{var _0x4d4741=a0_0x3ee093;try{const {username:_0x4e6215,email:_0x240976,role:_0x291d4f}=_0x4e6f59[_0x4d4741(0x22f)],_0x32d8d3=_0x4e6f59[_0x4d4741(0x22f)],_0x1e2d44=await profile[_0x4d4741(0x21f)]({'email':_0x32d8d3[_0x4d4741(0x29f)]}),_0x414574=await master_shop[_0x4d4741(0x26b)](),_0x4e92e1=_0x4e6f59[_0x4d4741(0x278)]['id'],_0x2c6b26=await purchases[_0x4d4741(0x2e0)](_0x4e92e1);if(_0x414574[0x0]['language']=='English\x20(US)')var _0x47edf2=users[_0x4d4741(0x214)];else{if(_0x414574[0x0][_0x4d4741(0x20d)]==_0x4d4741(0x233))var _0x47edf2=users['Hindi'];else{if(_0x414574[0x0]['language']==_0x4d4741(0x235))var _0x47edf2=users[_0x4d4741(0x235)];else{if(_0x414574[0x0]['language']==_0x4d4741(0x241))var _0x47edf2=users[_0x4d4741(0x241)];else{if(_0x414574[0x0][_0x4d4741(0x20d)]==_0x4d4741(0x25a))var _0x47edf2=users['French'];else{if(_0x414574[0x0]['language']==_0x4d4741(0x2c3))var _0x47edf2=users[_0x4d4741(0x279)];else{if(_0x414574[0x0]['language']==_0x4d4741(0x2a7))var _0x47edf2=users[_0x4d4741(0x2a7)];else{if(_0x414574[0x0][_0x4d4741(0x20d)]=='Arabic\x20(ae)')var _0x47edf2=users[_0x4d4741(0x207)];}}}}}}}_0xac6d61[_0x4d4741(0x1fc)](_0x4d4741(0x2c1),{'success':_0x4e6f59[_0x4d4741(0x244)](_0x4d4741(0x21a)),'errors':_0x4e6f59['flash'](_0x4d4741(0x252)),'role':_0x32d8d3,'profile':_0x1e2d44,'alldata':_0x2c6b26,'master_shop':_0x414574,'language':_0x47edf2}),console['log'](alldata);}catch(_0x48ea05){console['log'](_0x48ea05);}}),router[a0_0x3ee093(0x2aa)](a0_0x3ee093(0x245),async(_0xabdcfe,_0x3f81ad)=>{var _0x2db1ff=a0_0x3ee093;const {product_code:_0x1f5850}=_0xabdcfe[_0x2db1ff(0x262)];var _0x1606f4;const _0x20f8aa=await product['aggregate']([{'$match':{'primary_code':_0x1f5850,'product_category':_0x2db1ff(0x274)}},{'$group':{'_id':_0x2db1ff(0x254),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x2db1ff(0x315)},'unit':{'$first':_0x2db1ff(0x231)},'alertquantity':{'$first':_0x2db1ff(0x266)},'product_code':{'$first':_0x2db1ff(0x269)},'primary_code':{'$first':_0x2db1ff(0x21b)},'secondary_code':{'$first':_0x2db1ff(0x2d8)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2db1ff(0x2f1)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2db1ff(0x249)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5e9079=await product[_0x2db1ff(0x2b9)]([{'$match':{'secondary_code':_0x1f5850,'product_category':_0x2db1ff(0x274)}},{'$group':{'_id':_0x2db1ff(0x254),'name':{'$first':_0x2db1ff(0x286)},'category':{'$first':_0x2db1ff(0x31d)},'brand':{'$first':_0x2db1ff(0x315)},'unit':{'$first':_0x2db1ff(0x231)},'alertquantity':{'$first':_0x2db1ff(0x266)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2db1ff(0x21b)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2db1ff(0x2dd)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2db1ff(0x249)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x20f8aa[_0x2db1ff(0x31e)]>0x0)_0x1606f4=_0x20f8aa;else _0x5e9079['length']>0x0&&(_0x1606f4=_0x5e9079);_0x3f81ad[_0x2db1ff(0x2c9)](_0x1606f4);}),router[a0_0x3ee093(0x2aa)](a0_0x3ee093(0x217),async(_0x1a4f3a,_0x3847b6)=>{var _0x182bcb=a0_0x3ee093;const {primaryCode:_0x15ae5f,secondaryCode:_0x53274b,productCode:_0x389003,bay:_0x306552,bin:_0xebdd32,types:_0x34ffd7,pallet:_0x387fda,warehouses:_0x3281a5,room:_0x491352}=_0x1a4f3a[_0x182bcb(0x262)];console[_0x182bcb(0x30d)](_0x1a4f3a[_0x182bcb(0x262)]);try{const _0x45816f=await warehouse[_0x182bcb(0x2b9)]([{'$match':{'name':_0x3281a5,'room':_0x491352}},{'$unwind':_0x182bcb(0x211)},{'$match':{'product_details.bay':_0x306552,'product_details.bin':_0xebdd32,'product_details.type':_0x34ffd7}},{'$group':{'_id':_0x182bcb(0x2a8),'name':{'$first':_0x182bcb(0x204)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x182bcb(0x2a0)},'isle':{'$first':_0x182bcb(0x2fa)},'pallet':{'$first':_0x182bcb(0x2f6)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3847b6[_0x182bcb(0x23f)](0xc8)[_0x182bcb(0x2c9)](_0x45816f);}catch(_0x529fdc){_0x3847b6[_0x182bcb(0x23f)](0x194)[_0x182bcb(0x2c9)]({'message':_0x529fdc['message']});}}),module['exports']=router;