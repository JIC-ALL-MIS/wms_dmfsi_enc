var a0_0x571e72=a0_0x36b6;(function(_0x2f59f0,_0x616f38){var _0x1a173d=a0_0x36b6,_0x20998d=_0x2f59f0();while(!![]){try{var _0x29f7ea=parseInt(_0x1a173d(0x1e1))/0x1*(-parseInt(_0x1a173d(0x163))/0x2)+-parseInt(_0x1a173d(0x157))/0x3*(-parseInt(_0x1a173d(0x15b))/0x4)+parseInt(_0x1a173d(0x162))/0x5*(parseInt(_0x1a173d(0x140))/0x6)+-parseInt(_0x1a173d(0x1c0))/0x7*(parseInt(_0x1a173d(0x17d))/0x8)+-parseInt(_0x1a173d(0x113))/0x9*(parseInt(_0x1a173d(0x19e))/0xa)+-parseInt(_0x1a173d(0x10e))/0xb*(-parseInt(_0x1a173d(0x16b))/0xc)+-parseInt(_0x1a173d(0x1c6))/0xd*(-parseInt(_0x1a173d(0x177))/0xe);if(_0x29f7ea===_0x616f38)break;else _0x20998d['push'](_0x20998d['shift']());}catch(_0x1c29f6){_0x20998d['push'](_0x20998d['shift']());}}}(a0_0x1344,0x93934));const express=require(a0_0x571e72(0xde)),app=express(),router=express[a0_0x571e72(0xfa)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x571e72(0x172));var ejs=require('ejs');const path=require(a0_0x571e72(0xe1)),users=require(a0_0x571e72(0x137));function a0_0x1344(){var _0x1af7a4=['Rack\x20A','paid_amount','$product_details.product_code','2344DzvbQz','gmail','$batch_code','deliverycode','$room','Purchase\x20Return','purchase_invoice','purchase_quantity','\x20<\x20wew\x20>\x20','/../public','$finalize','/upload/','Purchase\x20Mail','prod_primunit','</div>','INC-','warehouse','language','$product.type','findOne','Sales\x20Update\x20successfully','forEach','</h5>','$product_details.primary_code','slice','payment\x20successfull','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/give_payment/:id','<span\x20style=\x22float:\x20right;\x22>','add_purchases\x20error','$product_details.floorlevel','isle','quantity','416410uLEmqs','Enclosed','Spanish','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','aggregate','amount','Error\x20Occurs','COLD\x20STORAGE','$product_details.level','prod_isle','push','Hindi','role','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.maxProducts','Rack\x20E','$product.floorlevel','$due_amount','image','<h5\x20style=\x22text-align:\x20left;\x22>','Chinese','<h2>\x20','prod_secondunit','MaxStocks_data','room_name','</head><body>','</span>','Return\x20Goods','exports','success','sendMail','16709rwomaa','abs','$suppliers_docs','POnumber','Logo.png','primary_code_hide','42796psUhrX','German','$unit','French','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.type','concat','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_list','Ambient','True','prod_invoice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$name','pallet','findById','<!DOCTYPE\x20html>','stocks','RMSEmail','$product_details.storage','Paid\x20For\x20Purchase','/view/add_purchases','product_name','$paid_amount','Receiving\x20Area','$maxProdPerUnit','8eBaoaQ','Arabic','</body></html>','map','$product_details.product_stock','log','toString','product_cat','types','/all_purchases/view','save','Rack\x20C','redirect','<strong>\x20Regards\x20</strong>','$expiry_date','$secondary_code','product_stock','Floor','$product_details.pallet','$product_details.rack','then','invoice','$product_details.isle','/view/add_purchases/:id','\x20<>\x20','$date','purchase\x20data\x20update\x20successfully','$secondary_unit','createTransport','floor','random','maxStocks','bin','getDate','express','RoomAssign','prod_level','path','product_details','string','Room_name','all','status','return_data','add\x20post','add_purchases','secondary_code_hide','There\x27s\x20a\x20error\x20in\x20this\x20transaction','stock_data','$product_details.bay','rak','delivery_date','\x20</h2>','$product_details._id','Rack\x20D','</tr>','$category','params','</td>','level','<div>','all_purchases','Router','warehouse_name','user','</tbody>','product_code','note','find','$product_details.secondary_code','Arabic\x20(ae)','</thead>','English','\x20Order\x20Number\x20:\x20','here','$brand','Purchase\x20Return\x20Mail','$product.bay','$note','foreach\x20newproduct','$product_code','production_date','55WJfqAd','staff','Portuguese','$suppliers','alertQTY','81wVYypP','flash','/view/return_purchase/:id','product_code_hide','batch_code','padStart','Rack\x20B','<html><head><title></title>','render','Portuguese\x20(BR)','stock_quantity','back','<tbody\x20style=\x22text-align:\x20center;\x22>','date','catch','Raw\x20Materials','Email\x20sent\x20successfully','$alertquantity','primary_code','maxperunit','prod_unit','$warehouse_name','$product','return_qty','message','/all_purchases/view/','secondary_unit','rack','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_name','Enabled','site_title','An\x20error\x20occurred.','name','getFullYear','suppliers','../public/language/languages.json','error','post','user_id','English\x20(US)','prod_cat','currency','errors','JO_number','708GjdppA','actual_qty','logo','$primary_code','body','DRY\x20STORAGE','/view/:id','edit_purchases_view','actual_uom','password','room','$product.quantity','prod_code','<h5>','Level','<hr\x20class=\x22my-3\x22>','delivery_code','filter','standard_unit','return_purchase','prod_name','/preview/:id','<tr>','116421WAxtpC','\x20Order\x20Date\x20:\x20','length','$maxStocks','48AKijHT','storage','$product_details','$product_details.bin','json','secondary_code','$return_data','37265uporWY','204322vTrrwR','prod_pallet','getMonth','bay','/view','expiry_date','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','873576clMqqf','email','</table>','edit_purchases','master','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','nodemailer','An\x20error\x20occurred\x20while\x20saving\x20data.','type','$invoice','$_id','3346QYuXua','$product.bin','get'];a0_0x1344=function(){return _0x1af7a4;};return a0_0x1344();}router[a0_0x571e72(0x179)](a0_0x571e72(0x167),auth,async(_0x55cce5,_0x17967b)=>{var _0x3a9419=a0_0x571e72;try{const {username:_0x166aff,email:_0x31bdd7,role:_0x5d9661}=_0x55cce5[_0x3a9419(0xfc)],_0x11afa3=_0x55cce5[_0x3a9419(0xfc)],_0xb1186f=await profile[_0x3a9419(0x190)]({'email':_0x11afa3[_0x3a9419(0x16c)]}),_0x307aed=await staff[_0x3a9419(0x190)]({'email':_0x11afa3['email']});if(_0x11afa3[_0x3a9419(0x1ab)]==_0x3a9419(0x10f)){const _0x5ab45b=await staff[_0x3a9419(0x190)]({'email':_0x11afa3[_0x3a9419(0x16c)]});}const _0x369e12=await master_shop['find']();let _0x3307cb;if(_0x11afa3[_0x3a9419(0x1ab)]==_0x3a9419(0x10f)){const _0x1b1d25=await staff[_0x3a9419(0x190)]({'email':_0x11afa3[_0x3a9419(0x16c)]});_0x3307cb=await purchases[_0x3a9419(0x1a3)]([{'$match':{'warehouse_name':_0x1b1d25[_0x3a9419(0x18d)]}},{'$lookup':{'from':_0x3a9419(0x136),'localField':_0x3a9419(0x136),'foreignField':_0x3a9419(0x134),'as':'suppliers_docs'}},{'$unwind':_0x3a9419(0x1c2)},{'$unwind':_0x3a9419(0x129)},{'$group':{'_id':_0x3a9419(0x176),'invoice':{'$first':_0x3a9419(0x175)},'suppliers':{'$first':_0x3a9419(0x111)},'date':{'$first':_0x3a9419(0xd5)},'warehouse_name':{'$first':_0x3a9419(0x128)},'room':{'$first':_0x3a9419(0x181)},'product':{'$push':'$product'},'note':{'$first':_0x3a9419(0x10a)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3a9419(0x161)},'batch_code':{'$first':_0x3a9419(0x17f)},'expiry_date':{'$first':_0x3a9419(0x1ef)},'suppliers_docs':{'$first':_0x3a9419(0x1c2)},'total_product_quantity':{'$sum':_0x3a9419(0x14b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3a9419(0x178)},'type':{'$addToSet':_0x3a9419(0x18f)},'floorlevel':{'$addToSet':_0x3a9419(0x1b1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3307cb=await purchases['aggregate']([{'$lookup':{'from':_0x3a9419(0x136),'localField':_0x3a9419(0x136),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x3a9419(0x129)},{'$group':{'_id':_0x3a9419(0x176),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3a9419(0xd5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3a9419(0x129)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3a9419(0x1de)},'due_amount':{'$first':_0x3a9419(0x1b2)},'return_data':{'$first':_0x3a9419(0x161)},'batch_code':{'$first':_0x3a9419(0x17f)},'expiry_date':{'$first':_0x3a9419(0x1ef)},'suppliers_docs':{'$first':_0x3a9419(0x1c2)},'total_product_quantity':{'$sum':_0x3a9419(0x14b)},'level':{'$addToSet':_0x3a9419(0x109)},'isle':{'$addToSet':_0x3a9419(0x178)},'type':{'$addToSet':_0x3a9419(0x18f)},'floorlevel':{'$addToSet':_0x3a9419(0x1b1)},'finalize':{'$first':_0x3a9419(0x187)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x369e12[0x0][_0x3a9419(0x18e)]==_0x3a9419(0x13b)){var _0x227ece=users[_0x3a9419(0x104)];console[_0x3a9419(0x1e6)](_0x227ece);}else{if(_0x369e12[0x0][_0x3a9419(0x18e)]=='Hindi')var _0x227ece=users[_0x3a9419(0x1aa)];else{if(_0x369e12[0x0][_0x3a9419(0x18e)]==_0x3a9419(0x1c7))var _0x227ece=users['German'];else{if(_0x369e12[0x0][_0x3a9419(0x18e)]==_0x3a9419(0x1a0))var _0x227ece=users[_0x3a9419(0x1a0)];else{if(_0x369e12[0x0][_0x3a9419(0x18e)]==_0x3a9419(0x1c9))var _0x227ece=users[_0x3a9419(0x1c9)];else{if(_0x369e12[0x0][_0x3a9419(0x18e)]==_0x3a9419(0x11c))var _0x227ece=users['Portuguese'];else{if(_0x369e12[0x0]['language']=='Chinese')var _0x227ece=users[_0x3a9419(0x1b5)];else{if(_0x369e12[0x0][_0x3a9419(0x18e)]==_0x3a9419(0x102))var _0x227ece=users[_0x3a9419(0x1e2)];}}}}}}}_0x17967b[_0x3a9419(0x11b)](_0x3a9419(0xf9),{'success':_0x55cce5[_0x3a9419(0x114)](_0x3a9419(0x1be)),'errors':_0x55cce5['flash'](_0x3a9419(0x13e)),'purchases':_0x3307cb,'role':_0x11afa3,'profile':_0xb1186f,'master_shop':_0x369e12,'language':_0x227ece});}catch(_0x52adb9){console[_0x3a9419(0x1e6)]('table\x20page',_0x52adb9),_0x17967b['status'](0xc8)[_0x3a9419(0x15f)]({'message':_0x52adb9[_0x3a9419(0x12b)]});}});function BayBinSelected(_0x8caf57,_0xd989c9){var _0x2102a9=a0_0x571e72,_0x8b7fec=[],_0x4b76a0=[],_0x4cd29d=[],_0x367fc7=[],_0x387487=[],_0x5aae5b=[];let _0x25b253=[];if(_0x8caf57==_0x2102a9(0x145))switch(_0xd989c9){case'Rack\x20A':_0x8b7fec=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4b76a0=[0x1,0x2],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e),_0x2102a9(0x1f2)],_0x387487=['D'],_0x5aae5b=['A'];break;case _0x2102a9(0x119):_0x8b7fec=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4b76a0=[0x1,0x2],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e),_0x2102a9(0x1f2)],_0x387487=['D'],_0x5aae5b=['B'];break;case'Shelves':_0x8b7fec=[0x0],_0x4b76a0=[0x0],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=['Floor'],_0x387487=['D'],_0x5aae5b=['S'];break;case _0x2102a9(0x1df):_0x8b7fec=[0x0],_0x4b76a0=[0x0],_0x367fc7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4cd29d=[_0x2102a9(0x1f2)],_0x387487=['D'],_0x5aae5b=['R'];break;}else{if(_0x8caf57==_0x2102a9(0x1a6))switch(_0xd989c9){case _0x2102a9(0x17a):_0x8b7fec=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4b76a0=['B','F'],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e),_0x2102a9(0x1f2)],_0x387487=['C'],_0x5aae5b=['A'];break;case'Rack\x20B':_0x8b7fec=[0x5,0x4,0x3,0x2,0x1],_0x4b76a0=['F','B','S'],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e),'Floor'],_0x387487=['C'],_0x5aae5b=['B'];break;case _0x2102a9(0x1ec):_0x8b7fec=[0x1,0x2,0x3,0x4,0x5],_0x4b76a0=['B','F','S'],_0x367fc7=[0x5,0x4,0x3,0x2,0x1],_0x4cd29d=[_0x2102a9(0x14e),_0x2102a9(0x1f2)],_0x387487=['C'],_0x5aae5b=['C'];break;case _0x2102a9(0xf2):_0x8b7fec=[0x5,0x4,0x3,0x2,0x1],_0x4b76a0=['F','B','S'],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e),_0x2102a9(0x1f2)],_0x387487=['C'],_0x5aae5b=['D'];break;case _0x2102a9(0x1b0):_0x8b7fec=[0x4,0x3,0x2,0x1],_0x4b76a0=[0x1,0x2],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e),'Floor'],_0x387487=['C'],_0x5aae5b=['E'];break;case'Rack\x20F':_0x8b7fec=[0x1,0x2,0x3],_0x4b76a0=[0x1,0x2],_0x367fc7=[0x1,0x2,0x3,0x4,0x5],_0x4cd29d=[_0x2102a9(0x14e)],_0x387487=['C'],_0x5aae5b=['F'];break;}}return{'levels':_0x8b7fec,'Isle':_0x4b76a0,'rack':_0x367fc7,'type':_0x4cd29d,'storage':_0x387487,'rak':_0x5aae5b};}async function getRandom8DigitNumber(){var _0x25b157=a0_0x571e72;const _0x31c165=0x989680,_0x1b23e7=0x5f5e0ff,_0x1bd6ea=Math[_0x25b157(0xd9)](Math[_0x25b157(0xda)]()*(_0x1b23e7-_0x31c165+0x1))+_0x31c165;var _0x368866;const _0x54d489=await purchases[_0x25b157(0x190)]({'invoice':'INC-'+_0x1bd6ea});return _0x54d489&&_0x54d489[_0x25b157(0x159)]>0x0?_0x368866=_0x25b157(0x18c)+_0x1bd6ea:_0x368866=_0x25b157(0x18c)+_0x1bd6ea,_0x368866;}function a0_0x36b6(_0x1ebc9a,_0x56e3bf){var _0x13442d=a0_0x1344();return a0_0x36b6=function(_0x36b62d,_0x343c07){_0x36b62d=_0x36b62d-0xd3;var _0x21130a=_0x13442d[_0x36b62d];return _0x21130a;},a0_0x36b6(_0x1ebc9a,_0x56e3bf);}router[a0_0x571e72(0x179)](a0_0x571e72(0x1dc),auth,async(_0x23c2a1,_0x3bd2bc)=>{var _0x3f462a=a0_0x571e72;try{const {username:_0x3f2b4d,email:_0xff7d43,role:_0x37b795}=_0x23c2a1['user'],_0x39152e=_0x23c2a1[_0x3f462a(0xfc)],_0x3e6f93=await profile[_0x3f462a(0x190)]({'email':_0x39152e['email']}),_0x1e419b=await master_shop['find'](),_0x5f0c61=await staff['findOne']({'email':_0x39152e[_0x3f462a(0x16c)]}),_0x4a057b=await suppliers[_0x3f462a(0x100)]({});let _0x4635f8;if(_0x39152e[_0x3f462a(0x1ab)]==_0x3f462a(0x10f)){const _0x4e8277=await staff[_0x3f462a(0x190)]({'email':_0x39152e[_0x3f462a(0x16c)]});_0x4635f8=await warehouse[_0x3f462a(0x1a3)]([{'$match':{'status':_0x3f462a(0x131),'name':_0x4e8277['warehouse'],'warehouse_category':_0x3f462a(0x122),'name':{'$ne':_0x3f462a(0x1bc)}}},{'$group':{'_id':_0x3f462a(0x1d4),'name':{'$first':'$name'}}}]);}else _0x4635f8=await warehouse[_0x3f462a(0x1a3)]([{'$match':{'status':_0x3f462a(0x131),'warehouse_category':_0x3f462a(0x122),'name':{'$ne':_0x3f462a(0x1bc)}}},{'$group':{'_id':_0x3f462a(0x1d4),'name':{'$first':_0x3f462a(0x1d4)}}}]);const _0x27544b=await product['find']({}),_0x41febe=await warehouse[_0x3f462a(0x100)]({'status':_0x3f462a(0x131)}),_0x5a4aff=await purchases['find']({}),_0x241492=_0x5a4aff[_0x3f462a(0x159)]+0x1,_0x20d88a='INC-'+_0x241492[_0x3f462a(0x1e7)]()[_0x3f462a(0x118)](0x5,'0');var _0x2aab5c=[_0x3f462a(0x1d0),_0x3f462a(0x19f)];if(_0x1e419b[0x0]['language']=='English\x20(US)')var _0x4ee856=users[_0x3f462a(0x104)];else{if(_0x1e419b[0x0][_0x3f462a(0x18e)]==_0x3f462a(0x1aa))var _0x4ee856=users['Hindi'];else{if(_0x1e419b[0x0][_0x3f462a(0x18e)]==_0x3f462a(0x1c7))var _0x4ee856=users[_0x3f462a(0x1c7)];else{if(_0x1e419b[0x0][_0x3f462a(0x18e)]==_0x3f462a(0x1a0))var _0x4ee856=users[_0x3f462a(0x1a0)];else{if(_0x1e419b[0x0]['language']==_0x3f462a(0x1c9))var _0x4ee856=users[_0x3f462a(0x1c9)];else{if(_0x1e419b[0x0]['language']==_0x3f462a(0x11c))var _0x4ee856=users[_0x3f462a(0x110)];else{if(_0x1e419b[0x0][_0x3f462a(0x18e)]=='Chinese')var _0x4ee856=users[_0x3f462a(0x1b5)];else{if(_0x1e419b[0x0][_0x3f462a(0x18e)]==_0x3f462a(0x102))var _0x4ee856=users[_0x3f462a(0x1e2)];}}}}}}}const _0x285c5e=getRandom8DigitNumber();_0x285c5e[_0x3f462a(0x1f5)](_0x1f994c=>{var _0x4dc738=_0x3f462a;_0x3bd2bc[_0x4dc738(0x11b)](_0x4dc738(0xe9),{'success':_0x23c2a1[_0x4dc738(0x114)](_0x4dc738(0x1be)),'errors':_0x23c2a1[_0x4dc738(0x114)]('errors'),'role':_0x39152e,'profile':_0x3e6f93,'suppliers':_0x4a057b,'warehouse':_0x4635f8,'product':_0x27544b,'invoice':_0x1f994c,'master_shop':_0x1e419b,'language':_0x4ee856,'find_data':_0x41febe,'rooms_data':_0x2aab5c});})[_0x3f462a(0x121)](_0x305163=>{var _0xab8595=_0x3f462a;_0x23c2a1[_0xab8595(0x114)](_0xab8595(0x13e),_0xab8595(0xeb)),_0x3bd2bc[_0xab8595(0x1ed)](_0xab8595(0x1ea));});}catch(_0x10d2a5){console[_0x3f462a(0x1e6)](_0x10d2a5);}}),router[a0_0x571e72(0x179)](a0_0x571e72(0xd3),auth,async(_0x2948af,_0x53b712)=>{var _0x5cce2c=a0_0x571e72;try{const _0x5d314c=_0x2948af[_0x5cce2c(0xf5)]['id'];console[_0x5cce2c(0x1e6)](_0x5d314c);const _0x27e99=await master_shop[_0x5cce2c(0x100)]();console['log']('master',_0x27e99);const _0x5f3ca0=await product[_0x5cce2c(0x190)]({'name':_0x5d314c});console['log'](_0x5cce2c(0x170),_0x5f3ca0),_0x53b712['status'](0xc8)['json']({'product_data':_0x5f3ca0,'master':_0x27e99});}catch(_0x1c36d8){console['log'](_0x5cce2c(0x19a),_0x1c36d8);}}),router[a0_0x571e72(0x139)](a0_0x571e72(0x1dc),auth,async(_0x293648,_0x251e85)=>{var _0x59fc24=a0_0x571e72;try{const {invoice:_0x2994c7,date:_0xd612fc,warehouse_name:_0x39d6c7,prod_name:_0x167d02,prod_code:_0x1b9242,prod_qty:_0x1dc81e,prod_unit:_0x1888ac,prod_secondunit:_0x28a953,prod_level:_0x2cac71,prod_isle:_0x328947,prod_pallet:_0x43e007,note:_0x298613,expiry_date:_0x44bfd6,batch_code:_0x55f421,payable:_0x2db080,due_amount:_0x221c9c,Room_name:_0x119d9c,primary_code:_0x430364,secondary_code:_0x5b9d6b,MaxStocks_data:_0xe6cf8c,PO_number:_0xb16c18,SCRN:_0x2c9248,JO_number:_0x11e910}=_0x293648[_0x59fc24(0x144)];if(typeof _0x167d02==_0x59fc24(0xe3))var _0x38ae77=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x154)]],_0x4b4cc0=[_0x293648['body'][_0x59fc24(0x14c)]],_0x13624e=[_0x293648[_0x59fc24(0x144)]['prod_Qty']],_0x1d4798=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x18a)]],_0x44afc9=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x1b7)]],_0x29dbb6=[_0x293648[_0x59fc24(0x144)]['prod_level']],_0x235232=[_0x293648['body'][_0x59fc24(0x125)]],_0x448a89=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x160)]],_0x8ed41=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x1b8)]],_0x321b63=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x117)]],_0x32b399=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x168)]],_0x5b9558=[_0x293648[_0x59fc24(0x144)]['max_product_unit']],_0x1e3e1a=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x112)]],_0x902714=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x10d)]],_0x4bd22c=[_0x293648[_0x59fc24(0x144)]['prod_cat']],_0x1efd79=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0xdf)]],_0x4039f5=[_0x293648['body']['deliverycode']],_0xacbc3=[_0x293648[_0x59fc24(0x144)]['prod_invoice']],_0xa0d354=[_0x293648[_0x59fc24(0x144)]['actual_qty']],_0x21e6c5=[_0x293648[_0x59fc24(0x144)][_0x59fc24(0x148)]];else var _0x38ae77=[..._0x293648[_0x59fc24(0x144)]['prod_name']],_0x4b4cc0=[..._0x293648[_0x59fc24(0x144)]['prod_code']],_0x13624e=[..._0x293648[_0x59fc24(0x144)]['prod_Qty']],_0x1d4798=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x18a)]],_0x44afc9=[..._0x293648[_0x59fc24(0x144)]['prod_secondunit']],_0x29dbb6=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0xe0)]],_0x235232=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x125)]],_0x448a89=[..._0x293648[_0x59fc24(0x144)]['secondary_code']],_0x8ed41=[..._0x293648[_0x59fc24(0x144)]['MaxStocks_data']],_0x321b63=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x117)]],_0x32b399=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x168)]],_0x5b9558=[..._0x293648['body']['max_product_unit']],_0x1e3e1a=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x112)]],_0x902714=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x10d)]],_0x4bd22c=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x13c)]],_0x1efd79=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0xdf)]],_0x4039f5=[..._0x293648['body'][_0x59fc24(0x180)]],_0xacbc3=[..._0x293648['body'][_0x59fc24(0x1d2)]],_0xa0d354=[..._0x293648[_0x59fc24(0x144)]['actual_qty']],_0x21e6c5=[..._0x293648[_0x59fc24(0x144)][_0x59fc24(0x148)]];const _0x434c9d=_0x38ae77[_0x59fc24(0x1e4)](_0x5d2acc=>{return _0x5d2acc={'product_name':_0x5d2acc};});_0xa0d354[_0x59fc24(0x192)]((_0x2f1029,_0x503878)=>{var _0xa79f9b=_0x59fc24;_0x434c9d[_0x503878][_0xa79f9b(0x141)]=Math[_0xa79f9b(0x1c1)](_0x2f1029);}),_0x21e6c5[_0x59fc24(0x192)]((_0x19abc1,_0x5b113e)=>{var _0x12c203=_0x59fc24;_0x434c9d[_0x5b113e][_0x12c203(0x148)]=_0x19abc1;}),_0x4b4cc0[_0x59fc24(0x192)]((_0x10898a,_0x2fef9d)=>{var _0x1f9d9d=_0x59fc24;_0x434c9d[_0x2fef9d][_0x1f9d9d(0xfe)]=_0x10898a;}),_0x13624e[_0x59fc24(0x192)]((_0x3ce2a5,_0x3b675e)=>{var _0x501304=_0x59fc24;_0x434c9d[_0x3b675e][_0x501304(0x19d)]=Math['abs'](_0x3ce2a5);}),_0x1d4798[_0x59fc24(0x192)]((_0x4ac8b5,_0x3c0171)=>{var _0x178549=_0x59fc24;_0x434c9d[_0x3c0171][_0x178549(0x152)]=_0x4ac8b5;}),_0x44afc9['forEach']((_0x2c63df,_0x1420d3)=>{var _0x3f3018=_0x59fc24;_0x434c9d[_0x1420d3][_0x3f3018(0x12d)]=_0x2c63df;}),_0x29dbb6['forEach']((_0x4d7da4,_0x346b8e)=>{var _0x4b6b15=_0x59fc24;_0x1efd79[_0x4b6b15(0x192)]((_0xf6f60f,_0x11d918)=>{var _0x230bbc=_0x4b6b15;if(_0xf6f60f==_0x230bbc(0x1df)&&_0x346b8e==_0x11d918){console[_0x230bbc(0x1e6)](_0xf6f60f+_0x230bbc(0x185)+_0x346b8e+_0x230bbc(0xd4)+_0x11d918+_0x230bbc(0xd4)+_0x4d7da4);var _0x201b3a=_0x4d7da4[_0x230bbc(0x195)](0x3);_0x434c9d[_0x346b8e][_0x230bbc(0x15c)]=_0x4d7da4[0x0],_0x434c9d[_0x346b8e][_0x230bbc(0x12e)]=_0x4d7da4[0x1],_0x434c9d[_0x346b8e][_0x230bbc(0x166)]=0x0,_0x434c9d[_0x346b8e][_0x230bbc(0xdc)]=0x0,_0x434c9d[_0x346b8e][_0x230bbc(0x174)]=_0x230bbc(0x1f2),_0x434c9d[_0x346b8e]['floorlevel']=_0x201b3a;}else{if(_0xf6f60f==_0x230bbc(0x169)&&_0x346b8e==_0x11d918){var _0x201b3a=_0x4d7da4[_0x230bbc(0x195)](0x3);_0x434c9d[_0x346b8e][_0x230bbc(0x15c)]=_0x4d7da4[0x0],_0x434c9d[_0x346b8e][_0x230bbc(0x12e)]=_0x4d7da4[0x1],_0x434c9d[_0x346b8e]['bay']=0x0,_0x434c9d[_0x346b8e][_0x230bbc(0xdc)]=0x0,_0x434c9d[_0x346b8e]['type']=_0x230bbc(0x1f2),_0x434c9d[_0x346b8e][_0x230bbc(0x1ac)]=_0x4d7da4[0x5];}else{if(_0x346b8e==_0x11d918){if(_0x4d7da4[0x0]=='A'&&_0x4d7da4[0x1]=='L'&&_0x4d7da4[0x2]=='L')console['log'](_0xf6f60f+_0x230bbc(0xd4)+_0x346b8e+_0x230bbc(0xd4)+_0x11d918+_0x230bbc(0xd4)+_0x4d7da4+_0x230bbc(0x106)),_0x434c9d[_0x346b8e][_0x230bbc(0x15c)]=_0x4d7da4[0x0],_0x434c9d[_0x346b8e]['rack']=_0x4d7da4[0x1],_0x434c9d[_0x346b8e][_0x230bbc(0x166)]=0x0,_0x434c9d[_0x346b8e][_0x230bbc(0xdc)]=0x0,_0x434c9d[_0x346b8e]['type']='Floor',_0x434c9d[_0x346b8e][_0x230bbc(0x1ac)]=_0x4d7da4[0x3];else{var _0x5672c5;if(_0x4d7da4[0x4]=='L')_0x5672c5=_0x230bbc(0x14e);else _0x4d7da4[0x4]=='F'&&(_0x5672c5=_0x230bbc(0x1f2));_0x434c9d[_0x346b8e][_0x230bbc(0x15c)]=_0x4d7da4[0x0],_0x434c9d[_0x346b8e]['rack']=_0x4d7da4[0x1],_0x434c9d[_0x346b8e][_0x230bbc(0x166)]=_0x4d7da4[0x2],_0x434c9d[_0x346b8e][_0x230bbc(0xdc)]=_0x4d7da4[0x3],_0x434c9d[_0x346b8e][_0x230bbc(0x174)]=_0x5672c5,_0x434c9d[_0x346b8e]['floorlevel']=_0x4d7da4[0x5];}}}}});}),_0x235232['forEach']((_0x266148,_0x4d9634)=>{var _0x1d5261=_0x59fc24;_0x434c9d[_0x4d9634][_0x1d5261(0x125)]=_0x266148;}),_0x448a89['forEach']((_0x3ae654,_0x45127b)=>{_0x434c9d[_0x45127b]['secondary_code']=_0x3ae654;}),_0x8ed41[_0x59fc24(0x192)]((_0x272184,_0x51e9b2)=>{var _0x1e0ae9=_0x59fc24;_0x434c9d[_0x51e9b2][_0x1e0ae9(0xdb)]=_0x272184;}),_0x321b63[_0x59fc24(0x192)]((_0x40aaff,_0x59199c)=>{var _0x23c785=_0x59fc24;_0x434c9d[_0x59199c][_0x23c785(0x117)]=_0x40aaff;}),_0x32b399['forEach']((_0x1724d3,_0x904101)=>{var _0x3436fa=_0x59fc24;_0x434c9d[_0x904101][_0x3436fa(0x168)]=_0x1724d3;}),_0x5b9558[_0x59fc24(0x192)]((_0x1e4b71,_0x244adc)=>{var _0x229449=_0x59fc24;_0x434c9d[_0x244adc][_0x229449(0x126)]=_0x1e4b71;}),_0x1e3e1a[_0x59fc24(0x192)]((_0x45fa76,_0x5df8c7)=>{var _0x104367=_0x59fc24;_0x434c9d[_0x5df8c7][_0x104367(0x112)]=_0x45fa76;}),_0x902714['forEach']((_0x442e73,_0x16b150)=>{var _0x9721f4=_0x59fc24;_0x434c9d[_0x16b150][_0x9721f4(0x10d)]=_0x442e73;}),_0x4bd22c[_0x59fc24(0x192)]((_0x18e4ad,_0x358759)=>{var _0x5902e6=_0x59fc24;_0x434c9d[_0x358759][_0x5902e6(0x1e8)]=_0x18e4ad;}),_0x1efd79['forEach']((_0x21988b,_0x413dd5)=>{var _0xff3b94=_0x59fc24;_0x434c9d[_0x413dd5][_0xff3b94(0x1b9)]=_0x21988b;}),_0x4039f5[_0x59fc24(0x192)]((_0x37ab33,_0x50ec01)=>{var _0x2ebc03=_0x59fc24;_0x434c9d[_0x50ec01][_0x2ebc03(0x150)]=_0x37ab33;}),_0xacbc3[_0x59fc24(0x192)]((_0x2da5aa,_0x15e263)=>{_0x434c9d[_0x15e263]['invoice']=_0x2da5aa;});const _0x4cdcc1=_0x1efd79[_0x59fc24(0x1e4)](_0x4c86ea=>{return _0x4c86ea={'room_name':_0x4c86ea};}),_0xadd09=_0x434c9d[_0x59fc24(0x151)](_0x8b3632=>_0x8b3632[_0x59fc24(0x19d)]!=='0'&&_0x8b3632[_0x59fc24(0x19d)]!==''),_0x5b82d4=new purchases({'invoice':_0x2994c7,'suppliers':_0x293648[_0x59fc24(0x144)][_0x59fc24(0x136)],'date':_0xd612fc,'warehouse_name':_0x39d6c7,'product':_0xadd09,'note':_0x298613,'due_amount':_0x221c9c,'POnumber':_0xb16c18,'SCRN':_0x2c9248,'JO_number':_0x11e910,'roomList':_0x4cdcc1}),_0x4f8ae6=await _0x5b82d4[_0x59fc24(0x1eb)](),_0x32c7dd=await purchases['findOne']({'invoice':_0x2994c7}),_0x2d25d7=_0x32c7dd[_0x59fc24(0x170)]['map'](async _0x1df384=>{var _0x1ea552=_0x59fc24,_0x41be79=await warehouse['findOne']({'name':_0x39d6c7,'room':_0x1df384[_0x1ea552(0x1b9)]}),_0x36989e=0x0;return _0x41be79[_0x1ea552(0xe2)][_0x1ea552(0x192)](_0x47986a=>{var _0x54d49e=_0x1ea552;_0x47986a[_0x54d49e(0x1dd)]==_0x1df384[_0x54d49e(0x1dd)]&&_0x47986a[_0x54d49e(0x1ac)]==_0x1df384[_0x54d49e(0x1ac)]&&_0x47986a[_0x54d49e(0x174)]==_0x1df384[_0x54d49e(0x174)]&&_0x47986a[_0x54d49e(0xdc)]==_0x1df384[_0x54d49e(0xdc)]&&_0x47986a[_0x54d49e(0x166)]==_0x1df384[_0x54d49e(0x166)]&&_0x47986a[_0x54d49e(0x12e)]==_0x1df384[_0x54d49e(0x12e)]&&_0x47986a[_0x54d49e(0x15c)]==_0x1df384[_0x54d49e(0x15c)]&&_0x47986a[_0x54d49e(0x168)]==_0x1df384['expiry_date']&&_0x47986a[_0x54d49e(0x117)]==_0x1df384['batch_code']&&_0x47986a[_0x54d49e(0x10d)]==_0x1df384[_0x54d49e(0x10d)]&&_0x47986a[_0x54d49e(0x1f6)]==_0x32c7dd[_0x54d49e(0x1f6)]&&(_0x47986a[_0x54d49e(0x1f1)]+=Math[_0x54d49e(0x1c1)](_0x1df384[_0x54d49e(0x19d)]),_0x36989e++);}),_0x36989e===0x0&&_0x41be79[_0x1ea552(0xe2)][_0x1ea552(0x1a9)]({'product_name':_0x1df384[_0x1ea552(0x1dd)],'product_stock':Math['abs'](_0x1df384[_0x1ea552(0x19d)]),'primary_code':_0x1df384[_0x1ea552(0x125)],'secondary_code':_0x1df384['secondary_code'],'product_code':_0x1df384[_0x1ea552(0xfe)],'storage':_0x1df384['storage'],'rack':_0x1df384[_0x1ea552(0x12e)],'bay':_0x1df384['bay'],'bin':_0x1df384[_0x1ea552(0xdc)],'type':_0x1df384[_0x1ea552(0x174)],'floorlevel':_0x1df384[_0x1ea552(0x1ac)],'maxProducts':_0x1df384[_0x1ea552(0xdb)],'unit':_0x1df384[_0x1ea552(0x152)],'secondary_unit':_0x1df384[_0x1ea552(0x12d)],'expiry_date':_0x1df384['expiry_date'],'maxPerUnit':_0x1df384['maxperunit'],'batch_code':_0x1df384[_0x1ea552(0x117)],'alertQTY':_0x1df384[_0x1ea552(0x112)],'production_date':_0x1df384[_0x1ea552(0x10d)],'product_cat':_0x1df384[_0x1ea552(0x1e8)],'invoice':_0x1df384['invoice'],'actual_qty':Math[_0x1ea552(0x1c1)](_0x1df384[_0x1ea552(0x141)]),'actual_uom':_0x1df384['actual_uom']}),_0x41be79;});Promise[_0x59fc24(0xe5)](_0x2d25d7)['then'](async _0xc2943e=>{var _0x196a17=_0x59fc24;try{for(const _0x345a65 of _0xc2943e){await _0x345a65['save']();}const _0x2f3bdd=await master_shop['find'](),_0x5dd222=await email_settings[_0x196a17(0x190)](),_0xe0aec6=await supervisor_settings[_0x196a17(0x100)]();var _0x44eac5=_0x32c7dd[_0x196a17(0x170)],_0x25ab38='',_0x2037c8;for(_0x2037c8 in _0x44eac5){_0x25ab38+=_0x196a17(0x156)+_0x196a17(0x12f)+_0x44eac5[_0x2037c8]['product_name']+_0x196a17(0xf6)+_0x196a17(0x12f)+_0x44eac5[_0x2037c8][_0x196a17(0xfe)]+_0x196a17(0xf6)+_0x196a17(0x12f)+_0x44eac5[_0x2037c8][_0x196a17(0x19d)]+_0x196a17(0xf6)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44eac5[_0x2037c8][_0x196a17(0x152)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x44eac5[_0x2037c8][_0x196a17(0x12d)]+_0x196a17(0xf6)+_0x196a17(0x12f)+_0x32c7dd[_0x196a17(0xfb)]+_0x196a17(0xf6)+_0x196a17(0x12f)+_0x44eac5[_0x2037c8][_0x196a17(0x1b9)]+_0x196a17(0xf6)+_0x196a17(0x12f)+_0x44eac5[_0x2037c8][_0x196a17(0x15c)]+_0x44eac5[_0x2037c8]['rack']+_0x44eac5[_0x2037c8][_0x196a17(0x166)]+_0x44eac5[_0x2037c8][_0x196a17(0xdc)]+_0x44eac5[_0x2037c8][_0x196a17(0x174)][0x0]+_0x44eac5[_0x2037c8][_0x196a17(0x1ac)]+_0x196a17(0xf6),_0x196a17(0xf3);}let _0x3e5e0d=nodemailer['createTransport']({'host':_0x5dd222['host'],'port':Number(_0x5dd222['port']),'secure':![],'auth':{'user':_0x5dd222[_0x196a17(0x16c)],'pass':_0x5dd222[_0x196a17(0x149)]}}),_0x4c2b61={'from':_0x5dd222[_0x196a17(0x16c)],'to':_0xe0aec6[0x0][_0x196a17(0x1d9)],'subject':_0x196a17(0x189),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x196a17(0x188)+_0x2f3bdd[0x0][_0x196a17(0x1b3)],'cid':_0x196a17(0x142)}],'html':_0x196a17(0x1d7)+_0x196a17(0x11a)+_0x196a17(0x1ba)+_0x196a17(0xf8)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x196a17(0xf8)+_0x196a17(0x1ca)+'</div>'+_0x196a17(0xf8)+_0x196a17(0x1b6)+_0x2f3bdd[0x0]['site_title']+_0x196a17(0xf0)+_0x196a17(0x18b)+_0x196a17(0x18b)+_0x196a17(0x14f)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x196a17(0x105)+_0x32c7dd['invoice']+'\x20'+_0x196a17(0x199)+'\x20Order\x20Date\x20:\x20'+_0x32c7dd[_0x196a17(0x120)]+'\x20'+_0x196a17(0x1bb)+_0x196a17(0x193)+'</div>'+_0x196a17(0x197)+_0x196a17(0x1d3)+_0x196a17(0x156)+_0x196a17(0x171)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x196a17(0x1ae)+_0x196a17(0x1cb)+_0x196a17(0x1a2)+_0x196a17(0xf3)+_0x196a17(0x103)+_0x196a17(0x11f)+'\x20'+_0x25ab38+'\x20'+'</tbody>'+_0x196a17(0x16d)+_0x196a17(0xf8)+'<strong>\x20Regards\x20</strong>'+_0x196a17(0x14d)+_0x2f3bdd[0x0][_0x196a17(0x132)]+_0x196a17(0x193)+_0x196a17(0x18b)+_0x196a17(0x18b)+_0x196a17(0x1e3)};_0x3e5e0d[_0x196a17(0x1bf)](_0x4c2b61,function(_0x12d83d,_0x44fe3e){var _0x3e23e2=_0x196a17;_0x12d83d?(console[_0x3e23e2(0x1e6)](_0x12d83d),console[_0x3e23e2(0x1e6)](_0x3e23e2(0x1a5))):console[_0x3e23e2(0x1e6)](_0x3e23e2(0x123));}),_0x293648[_0x196a17(0x114)](_0x196a17(0x1be),'Purchase\x20data\x20added\x20successfully'),_0x251e85[_0x196a17(0x1ed)](_0x196a17(0x12c));}catch(_0x4a99d2){console[_0x196a17(0x138)](_0x4a99d2),_0x251e85['status'](0x1f4)[_0x196a17(0x15f)]({'error':_0x196a17(0x173)});}})['catch'](_0x56e8e9=>{var _0x14a5b4=_0x59fc24;console[_0x14a5b4(0x138)](_0x56e8e9),_0x251e85[_0x14a5b4(0xe6)](0x1f4)[_0x14a5b4(0x15f)]({'error':_0x14a5b4(0x133)});});}catch(_0x54f1cd){console[_0x59fc24(0x1e6)](_0x54f1cd);}}),router['get'](a0_0x571e72(0x155),auth,async(_0x4cca03,_0x177e23)=>{var _0xf86cc=a0_0x571e72;try{const {username:_0x918d65,email:_0x141aaa,role:_0x4e7b1c}=_0x4cca03['user'],_0x4b6b38=_0x4cca03[_0xf86cc(0xfc)],_0x2a7d32=await profile[_0xf86cc(0x190)]({'email':_0x4b6b38['email']}),_0x341946=await master_shop[_0xf86cc(0x100)](),_0x476580=_0x4cca03['params']['id'],_0x4d9e4f=await purchases[_0xf86cc(0x1d6)](_0x476580),_0x39481d=await warehouse[_0xf86cc(0x1a3)]([{'$match':{'name':_0x4d9e4f[_0xf86cc(0xfb)],'room':_0x4d9e4f[_0xf86cc(0x14a)]}},{'$unwind':_0xf86cc(0x15d)},{'$group':{'_id':_0xf86cc(0xf1),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xf86cc(0x1e5)},'bay':{'$first':_0xf86cc(0xed)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xf86cc(0x1cc)},'floorlevel':{'$first':_0xf86cc(0x19b)},'primary_code':{'$first':_0xf86cc(0x194)},'secondary_code':{'$first':_0xf86cc(0x101)},'product_code':{'$first':_0xf86cc(0x17c)},'storage':{'$first':_0xf86cc(0x1da)},'rack':{'$first':_0xf86cc(0x1f4)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x33cc54=await customer[_0xf86cc(0x100)]({});let _0x42ee65;if(_0x4b6b38[_0xf86cc(0x1ab)]==_0xf86cc(0x10f)){const _0x4ffb38=await staff[_0xf86cc(0x190)]({'email':_0x4b6b38['email']});_0x42ee65=await warehouse[_0xf86cc(0x1a3)]([{'$match':{'status':_0xf86cc(0x131),'name':_0x4ffb38[_0xf86cc(0x18d)]}},{'$group':{'_id':_0xf86cc(0x1d4),'name':{'$first':_0xf86cc(0x1d4)}}}]);}else _0x42ee65=await warehouse[_0xf86cc(0x1a3)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xf86cc(0x1d4),'name':{'$first':'$name'}}}]);const _0x1b536e=await product['find']({}),_0x114354=await suppliers[_0xf86cc(0x100)]({}),_0x575228=BayBinSelected(_0x4d9e4f['warehouse_name'],_0x4d9e4f[_0xf86cc(0x14a)]);if(_0x341946[0x0]['language']==_0xf86cc(0x13b)){var _0x5b596a=users[_0xf86cc(0x104)];console[_0xf86cc(0x1e6)](_0x5b596a);}else{if(_0x341946[0x0][_0xf86cc(0x18e)]==_0xf86cc(0x1aa))var _0x5b596a=users[_0xf86cc(0x1aa)];else{if(_0x341946[0x0][_0xf86cc(0x18e)]==_0xf86cc(0x1c7))var _0x5b596a=users[_0xf86cc(0x1c7)];else{if(_0x341946[0x0]['language']==_0xf86cc(0x1a0))var _0x5b596a=users[_0xf86cc(0x1a0)];else{if(_0x341946[0x0][_0xf86cc(0x18e)]==_0xf86cc(0x1c9))var _0x5b596a=users[_0xf86cc(0x1c9)];else{if(_0x341946[0x0][_0xf86cc(0x18e)]==_0xf86cc(0x11c))var _0x5b596a=users['Portuguese'];else{if(_0x341946[0x0][_0xf86cc(0x18e)]==_0xf86cc(0x1b5))var _0x5b596a=users['Chinese'];else{if(_0x341946[0x0][_0xf86cc(0x18e)]==_0xf86cc(0x102))var _0x5b596a=users['Arabic'];}}}}}}}_0x177e23[_0xf86cc(0x11b)](_0xf86cc(0x147),{'success':_0x4cca03[_0xf86cc(0x114)]('success'),'errors':_0x4cca03[_0xf86cc(0x114)](_0xf86cc(0x13e)),'role':_0x4b6b38,'profile':_0x2a7d32,'customer':_0x33cc54,'warehouse':_0x42ee65,'product':_0x39481d,'user':_0x4d9e4f,'master_shop':_0x341946,'unit':_0x1b536e,'language':_0x5b596a,'suppliers':_0x114354,'dataSelected':_0x575228});}catch(_0x4f0df6){console[_0xf86cc(0x1e6)](_0x4f0df6);}}),router['post'](a0_0x571e72(0x155),auth,async(_0x236d50,_0x2d25e3)=>{var _0x499810=a0_0x571e72;try{const _0x22700e=_0x236d50[_0x499810(0xf5)]['id'],{invoice:_0x40ba0e,warehouse_name:_0x3f8948,Room_name:_0x1625f0}=_0x236d50[_0x499810(0x144)],_0x22a2ba=await warehouse[_0x499810(0x190)]({'name':_0x3f8948,'room':_0x1625f0}),_0x3910eb=await purchases['findOne']({'invoice':_0x40ba0e});_0x3910eb['product']['forEach'](_0x45d93d=>{var _0x14f5bc=_0x499810,_0x2b05b6=0x0;const _0x3dbc94=_0x22a2ba[_0x14f5bc(0xe2)]['map'](_0x50d25e=>{var _0x466c44=_0x14f5bc;_0x50d25e[_0x466c44(0x1dd)]==_0x45d93d['product_name']&&_0x50d25e[_0x466c44(0x1ac)]==_0x45d93d[_0x466c44(0x1ac)]&&_0x50d25e[_0x466c44(0x174)]==_0x45d93d[_0x466c44(0x174)]&&_0x50d25e[_0x466c44(0xdc)]==_0x45d93d['bin']&&_0x50d25e[_0x466c44(0x166)]==_0x45d93d[_0x466c44(0x166)]&&_0x50d25e['rack']==_0x45d93d['rack']&&_0x50d25e[_0x466c44(0x15c)]==_0x45d93d['storage']&&_0x50d25e['expiry_date']==_0x45d93d['expiry_date']&&_0x50d25e['batch_code']==_0x45d93d[_0x466c44(0x117)]&&_0x50d25e[_0x466c44(0x10d)]==_0x45d93d[_0x466c44(0x10d)]&&_0x50d25e[_0x466c44(0xef)]==_0x45d93d['delivery_date']&&_0x50d25e[_0x466c44(0x150)]==_0x45d93d[_0x466c44(0x150)]&&(_0x50d25e[_0x466c44(0x1f1)]=parseInt(_0x50d25e[_0x466c44(0x1f1)])+parseInt(_0x45d93d[_0x466c44(0x19d)]),_0x2b05b6++);});_0x2b05b6=='0'&&(_0x22a2ba[_0x14f5bc(0xe2)]=_0x22a2ba['product_details']['concat']({'product_name':_0x45d93d[_0x14f5bc(0x1dd)],'product_stock':_0x45d93d[_0x14f5bc(0x19d)],'primary_code':_0x45d93d[_0x14f5bc(0x125)],'secondary_code':_0x45d93d[_0x14f5bc(0x160)],'product_code':_0x45d93d[_0x14f5bc(0xfe)],'storage':_0x45d93d[_0x14f5bc(0x15c)],'rack':_0x45d93d[_0x14f5bc(0x12e)],'bay':_0x45d93d[_0x14f5bc(0x166)],'bin':_0x45d93d[_0x14f5bc(0xdc)],'type':_0x45d93d['type'],'floorlevel':_0x45d93d['floorlevel'],'maxProducts':_0x45d93d[_0x14f5bc(0xdb)],'unit':_0x45d93d['standard_unit'],'secondary_unit':_0x45d93d[_0x14f5bc(0x12d)],'expiry_date':_0x45d93d['expiry_date'],'maxPerUnit':_0x45d93d[_0x14f5bc(0x126)],'batch_code':_0x45d93d['batch_code'],'alertQTY':_0x45d93d[_0x14f5bc(0x112)],'production_date':_0x45d93d[_0x14f5bc(0x10d)],'delivery_date':_0x45d93d['delivery_date'],'delivery_code':_0x45d93d['delivery_code']}));}),await _0x22a2ba['save'](),_0x3910eb['finalize']=_0x499810(0x1d1);const _0x4762e3=await _0x3910eb[_0x499810(0x1eb)]();_0x236d50[_0x499810(0x114)](_0x499810(0x1be),_0x499810(0x191)),_0x2d25e3['redirect'](_0x499810(0x1ea));}catch(_0x19bf78){console[_0x499810(0x1e6)](_0x19bf78);}}),router[a0_0x571e72(0x179)](a0_0x571e72(0x146),auth,async(_0x4e82a7,_0x4a8fcb)=>{var _0x51dcc4=a0_0x571e72;try{const {username:_0x3280a8,email:_0x5ddb44,role:_0x5c0c37}=_0x4e82a7[_0x51dcc4(0xfc)],_0x564d41=_0x4e82a7[_0x51dcc4(0xfc)],_0x479c5b=await profile['findOne']({'email':_0x564d41[_0x51dcc4(0x16c)]}),_0x17ddb5=await master_shop[_0x51dcc4(0x100)](),_0x4b2fe6=_0x4e82a7[_0x51dcc4(0xf5)]['id'],_0x26f4e2=await purchases[_0x51dcc4(0x1d6)](_0x4b2fe6),_0x28c56f=await suppliers[_0x51dcc4(0x100)]({});let _0x28a7e8;if(_0x564d41[_0x51dcc4(0x1ab)]==_0x51dcc4(0x10f)){const _0x4c3452=await staff[_0x51dcc4(0x190)]({'email':_0x564d41[_0x51dcc4(0x16c)]});_0x28a7e8=await warehouse['find']({'status':_0x51dcc4(0x131),'name':_0x4c3452['warehouse'],'warehouse_category':_0x51dcc4(0x122)});}else _0x28a7e8=await warehouse[_0x51dcc4(0x1a3)]([{'$match':{'status':_0x51dcc4(0x131),'warehouse_category':_0x51dcc4(0x122)}},{'$group':{'_id':_0x51dcc4(0x1d4),'name':{'$first':_0x51dcc4(0x1d4)}}}]);const _0x13995f=await product['find']({}),_0xa7c69c=BayBinSelected(_0x26f4e2[_0x51dcc4(0xfb)],_0x26f4e2[_0x51dcc4(0x14a)]);let _0xca097d=new Date(_0x26f4e2['expiry_date']),_0x3793b2=('0'+_0xca097d[_0x51dcc4(0xdd)]())[_0x51dcc4(0x195)](-0x2),_0x51bc9b=('0'+(_0xca097d[_0x51dcc4(0x165)]()+0x1))[_0x51dcc4(0x195)](-0x2),_0xa04e26=_0xca097d[_0x51dcc4(0x135)](),_0x264d80=_0xa04e26+'-'+_0x51bc9b+'-'+_0x3793b2;if(_0x17ddb5[0x0]['language']==_0x51dcc4(0x13b)){var _0x2f86ce=users[_0x51dcc4(0x104)];console['log'](_0x2f86ce);}else{if(_0x17ddb5[0x0]['language']==_0x51dcc4(0x1aa))var _0x2f86ce=users['Hindi'];else{if(_0x17ddb5[0x0][_0x51dcc4(0x18e)]=='German')var _0x2f86ce=users['German'];else{if(_0x17ddb5[0x0][_0x51dcc4(0x18e)]==_0x51dcc4(0x1a0))var _0x2f86ce=users[_0x51dcc4(0x1a0)];else{if(_0x17ddb5[0x0][_0x51dcc4(0x18e)]==_0x51dcc4(0x1c9))var _0x2f86ce=users[_0x51dcc4(0x1c9)];else{if(_0x17ddb5[0x0][_0x51dcc4(0x18e)]=='Portuguese\x20(BR)')var _0x2f86ce=users[_0x51dcc4(0x110)];else{if(_0x17ddb5[0x0][_0x51dcc4(0x18e)]==_0x51dcc4(0x1b5))var _0x2f86ce=users[_0x51dcc4(0x1b5)];else{if(_0x17ddb5[0x0]['language']=='Arabic\x20(ae)')var _0x2f86ce=users['Arabic'];}}}}}}}_0x4a8fcb[_0x51dcc4(0x11b)](_0x51dcc4(0x16e),{'success':_0x4e82a7['flash']('success'),'errors':_0x4e82a7[_0x51dcc4(0x114)]('errors'),'role':_0x564d41,'profile':_0x479c5b,'purchases':_0x26f4e2,'suppliers':_0x28c56f,'warehouse':_0x28a7e8,'product':_0x13995f,'master_shop':_0x17ddb5,'language':_0x2f86ce,'ed_fullDate':_0x264d80,'dataSelected':_0xa7c69c});}catch(_0x2d0059){console[_0x51dcc4(0x1e6)](_0x2d0059);}}),router[a0_0x571e72(0x139)]('/view/:id',auth,async(_0xa2dd77,_0x28d65b)=>{var _0x30412a=a0_0x571e72;try{const _0x4a1efa=_0xa2dd77[_0x30412a(0xf5)]['id'],_0x34e2d7=await purchases[_0x30412a(0x190)]({'_id':_0xa2dd77[_0x30412a(0xf5)]['id']}),_0x176fab=await warehouse[_0x30412a(0x190)]({'name':_0x34e2d7[_0x30412a(0xfb)],'room':_0x34e2d7[_0x30412a(0x14a)]});_0x34e2d7[_0x30412a(0x170)][_0x30412a(0x192)](_0xc8fc75=>{var _0x420292=_0x30412a;const _0x185cf8=_0x176fab[_0x420292(0xe2)][_0x420292(0x1e4)](_0xba0e15=>{var _0x24d993=_0x420292;_0xba0e15[_0x24d993(0x1dd)]==_0xc8fc75['product_name']&&_0xba0e15[_0x24d993(0x1ac)]==_0xc8fc75[_0x24d993(0x1ac)]&&_0xba0e15[_0x24d993(0x174)]==_0xc8fc75[_0x24d993(0x174)]&&_0xba0e15[_0x24d993(0xdc)]==_0xc8fc75['bin']&&_0xba0e15['bay']==_0xc8fc75[_0x24d993(0x166)]&&_0xba0e15[_0x24d993(0x12e)]==_0xc8fc75[_0x24d993(0x12e)]&&_0xba0e15[_0x24d993(0x15c)]==_0xc8fc75['storage']&&(_0xba0e15[_0x24d993(0x1f1)]=parseInt(_0xba0e15[_0x24d993(0x1f1)])-parseInt(_0xc8fc75[_0x24d993(0x19d)]));});}),await _0x176fab[_0x30412a(0x1eb)]();const {invoice:_0x45ab62,suppliers:_0x1c43ca,date:_0xb1058c,warehouse_name:_0x375ed4,prod_name:_0x6e0a7c,prod_code:_0x28fb4d,prod_qty:_0x306fb1,prod_unit:_0x229305,prod_secondunit:_0x172272,prod_level:_0x51a39d,prod_isle:_0x3a0850,prod_pallet:_0x25a775,note:_0x43ee6c,expiry_date:_0x14915a,batch_code:_0x4178b0,paid_amount:_0x2fdb82,due_amount:_0x1c9d87,Room_name:_0x47c09b,primary_code:_0x733234,secondary_code:_0x5a73be,PO_number:_0x2acdad,JO_number:_0x2ed2d3}=_0xa2dd77[_0x30412a(0x144)];if(typeof _0x6e0a7c=='string')var _0x1e7161=[_0xa2dd77['body']['prod_name']],_0x2b704d=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x14c)]],_0x4ae11b=[_0xa2dd77['body']['prod_qty']],_0x29de62=[_0xa2dd77['body'][_0x30412a(0x127)]],_0x4a026a=[_0xa2dd77[_0x30412a(0x144)]['prod_secondunit']],_0x345176=[_0xa2dd77['body'][_0x30412a(0xe0)]],_0x2face9=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x1a8)]],_0x3afe55=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x164)]],_0x209847=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x125)]],_0x246ec8=[_0xa2dd77['body']['secondary_code']],_0xc93864=[_0xa2dd77['body'][_0x30412a(0x1b8)]],_0x11fdc3=[_0xa2dd77['body'][_0x30412a(0x117)]],_0x5ca8e2=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x168)]],_0x408298=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x15c)]],_0x2deccd=[_0xa2dd77[_0x30412a(0x144)]['rak']],_0x215fed=[_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x174)]];else var _0x1e7161=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x154)]],_0x2b704d=[..._0xa2dd77['body'][_0x30412a(0x14c)]],_0x4ae11b=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x1a1)]],_0x29de62=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x127)]],_0x4a026a=[..._0xa2dd77['body'][_0x30412a(0x1b7)]],_0x345176=[..._0xa2dd77[_0x30412a(0x144)]['prod_level']],_0x2face9=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x1a8)]],_0x3afe55=[..._0xa2dd77['body'][_0x30412a(0x164)]],_0x209847=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x125)]],_0x246ec8=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x160)]],_0xc93864=[..._0xa2dd77[_0x30412a(0x144)]['MaxStocks_data']],_0x11fdc3=[..._0xa2dd77[_0x30412a(0x144)]['batch_code']],_0x5ca8e2=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x168)]],_0x408298=[..._0xa2dd77[_0x30412a(0x144)]['storage']],_0x2deccd=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0xee)]],_0x215fed=[..._0xa2dd77[_0x30412a(0x144)][_0x30412a(0x174)]];const _0x508ad4=_0x1e7161['map'](_0x587d35=>{return _0x587d35={'product_name':_0x587d35};});_0x2b704d[_0x30412a(0x192)]((_0x5b03b0,_0x581ac5)=>{var _0xbdb857=_0x30412a;_0x508ad4[_0x581ac5][_0xbdb857(0xfe)]=_0x5b03b0;}),_0x4ae11b['forEach']((_0x5969ab,_0xdd8220)=>{_0x508ad4[_0xdd8220]['quantity']=_0x5969ab;}),_0x29de62['forEach']((_0x575fb2,_0x30e697)=>{_0x508ad4[_0x30e697]['standard_unit']=_0x575fb2;}),_0x4a026a[_0x30412a(0x192)]((_0x17c540,_0x2d0bdf)=>{var _0x4d15ec=_0x30412a;_0x508ad4[_0x2d0bdf][_0x4d15ec(0x12d)]=_0x17c540;}),_0x345176[_0x30412a(0x192)]((_0x4d1ab4,_0x48a538)=>{var _0x11144e=_0x30412a;_0x508ad4[_0x48a538][_0x11144e(0x166)]=_0x4d1ab4;}),_0x2face9[_0x30412a(0x192)]((_0x19924c,_0x37fc85)=>{_0x508ad4[_0x37fc85]['bin']=_0x19924c;}),_0x3afe55[_0x30412a(0x192)]((_0x155c47,_0x54feda)=>{var _0x35bb46=_0x30412a;_0x508ad4[_0x54feda][_0x35bb46(0x1ac)]=_0x155c47;}),_0x209847[_0x30412a(0x192)]((_0x17b1f2,_0x166a25)=>{var _0x293968=_0x30412a;_0x508ad4[_0x166a25][_0x293968(0x125)]=_0x17b1f2;}),_0x246ec8['forEach']((_0xfeb6af,_0x901d7a)=>{var _0x219400=_0x30412a;_0x508ad4[_0x901d7a][_0x219400(0x160)]=_0xfeb6af;}),_0xc93864[_0x30412a(0x192)]((_0x4f6f5c,_0x48fe2c)=>{var _0x24e41c=_0x30412a;_0x508ad4[_0x48fe2c][_0x24e41c(0xdb)]=_0x4f6f5c;}),_0x11fdc3[_0x30412a(0x192)]((_0x1f494f,_0x240552)=>{_0x508ad4[_0x240552]['batch_code']=_0x1f494f;}),_0x5ca8e2[_0x30412a(0x192)]((_0x25d179,_0x40d6f6)=>{var _0x291955=_0x30412a;_0x508ad4[_0x40d6f6][_0x291955(0x168)]=_0x25d179;}),_0x215fed['forEach']((_0x704ec8,_0x23303a)=>{var _0x14152e=_0x30412a;_0x508ad4[_0x23303a][_0x14152e(0x174)]=_0x704ec8;}),_0x408298['forEach']((_0x275ea0,_0x471077)=>{var _0x154c23=_0x30412a;_0x508ad4[_0x471077][_0x154c23(0x15c)]=_0x275ea0;}),_0x2deccd['forEach']((_0x1c7c6f,_0x328435)=>{var _0xe4b14f=_0x30412a;_0x508ad4[_0x328435][_0xe4b14f(0x12e)]=_0x1c7c6f;});const _0x3717ae=_0x508ad4[_0x30412a(0x151)](_0x339644=>_0x339644[_0x30412a(0x19d)]!=='0'&&_0x339644[_0x30412a(0x19d)]!=='');_0x34e2d7['invoice']=_0x45ab62,_0x34e2d7[_0x30412a(0x136)]=_0x1c43ca,_0x34e2d7[_0x30412a(0x120)]=_0xb1058c,_0x34e2d7[_0x30412a(0xfb)]=_0x375ed4,_0x34e2d7['product']=_0x3717ae,_0x34e2d7[_0x30412a(0xff)]=_0x43ee6c,_0x34e2d7['paid_amount']=_0x2fdb82,_0x34e2d7['due_amount']=_0x1c9d87,_0x34e2d7[_0x30412a(0x14a)]=_0x47c09b,_0x34e2d7[_0x30412a(0x1c3)]=_0x2acdad,_0x34e2d7[_0x30412a(0x13f)]=_0x2ed2d3;const _0xfa4a1b=await _0x34e2d7['save'](),_0x7f69da=await warehouse[_0x30412a(0x190)]({'name':_0xa2dd77[_0x30412a(0x144)]['warehouse_name'],'room':_0xa2dd77[_0x30412a(0x144)][_0x30412a(0xe4)]});_0x34e2d7[_0x30412a(0x170)][_0x30412a(0x192)](_0x31d195=>{var _0x24834b=_0x30412a,_0x41e250=0x0;const _0x24a3f3=_0x7f69da['product_details'][_0x24834b(0x1e4)](_0x1412da=>{var _0x46a6ac=_0x24834b;_0x1412da['product_name']==_0x31d195[_0x46a6ac(0x1dd)]&&_0x1412da['floorlevel']==_0x31d195[_0x46a6ac(0x1ac)]&&_0x1412da[_0x46a6ac(0x174)]==_0x31d195[_0x46a6ac(0x174)]&&_0x1412da[_0x46a6ac(0xdc)]==_0x31d195[_0x46a6ac(0xdc)]&&_0x1412da[_0x46a6ac(0x166)]==_0x31d195['bay']&&_0x1412da[_0x46a6ac(0x12e)]==_0x31d195[_0x46a6ac(0x12e)]&&_0x1412da[_0x46a6ac(0x15c)]==_0x31d195[_0x46a6ac(0x15c)]&&(_0x1412da[_0x46a6ac(0x1f1)]=parseInt(_0x1412da['product_stock'])+parseInt(_0x31d195[_0x46a6ac(0x19d)]),_0x41e250++);});_0x41e250=='0'&&(_0x7f69da[_0x24834b(0xe2)]=_0x7f69da[_0x24834b(0xe2)][_0x24834b(0x1cd)]({'product_name':_0x31d195[_0x24834b(0x1dd)],'product_stock':_0x31d195[_0x24834b(0x19d)],'primary_code':_0x31d195[_0x24834b(0x125)],'secondary_code':_0x31d195['secondary_code'],'product_code':_0x31d195['product_code'],'storage':_0x31d195[_0x24834b(0x15c)],'rack':_0x31d195['rack'],'bay':_0x31d195[_0x24834b(0x166)],'bin':_0x31d195['bin'],'type':_0x31d195[_0x24834b(0x174)],'floorlevel':_0x31d195[_0x24834b(0x1ac)],'maxProducts':_0x31d195[_0x24834b(0xdb)],'unit':_0x31d195['standard_unit'],'secondary_unit':_0x31d195[_0x24834b(0x12d)],'expiry_date':_0x31d195[_0x24834b(0x168)]}));}),await _0x7f69da[_0x30412a(0x1eb)]();const _0x1e7a81=await s_payment_data[_0x30412a(0x190)]({'invoice':_0xa2dd77[_0x30412a(0x144)][_0x30412a(0x1f6)]});if(_0x1e7a81===null){}else console['log']('suppliers',_0x1e7a81,_0xa2dd77['body'][_0x30412a(0x1f6)]),_0x1e7a81[_0x30412a(0x136)]=_0xa2dd77[_0x30412a(0x144)]['suppliers'],await _0x1e7a81[_0x30412a(0x1eb)]();_0xa2dd77[_0x30412a(0x114)]('success',_0x30412a(0xd6)),_0x28d65b[_0x30412a(0x1ed)](_0x30412a(0x1ea));}catch(_0x2e5652){console[_0x30412a(0x1e6)](_0x2e5652);}}),router[a0_0x571e72(0x139)](a0_0x571e72(0x198),auth,async(_0x216575,_0x567983)=>{var _0x18b80a=a0_0x571e72;try{const _0x339e6b=_0x216575['params']['id'],{invoice:_0x21af92,suppliers:_0xa1f16,payable:_0x18e426,due_amount:_0x4ea45c}=_0x216575[_0x18b80a(0x144)],_0x272751=await purchases[_0x18b80a(0x1d6)](_0x339e6b);var _0xe71b54=_0x18e426-_0x4ea45c;_0x272751[_0x18b80a(0x17b)]=parseFloat(_0x272751[_0x18b80a(0x17b)])+parseFloat(_0x4ea45c),_0x272751['due_amount']=_0xe71b54;const _0x31cb8d=await _0x272751[_0x18b80a(0x1eb)]();console[_0x18b80a(0x1e6)](_0x31cb8d);const _0x121e03=await s_payment_data[_0x18b80a(0x190)]({'invoice':_0x21af92});_0x121e03[_0x18b80a(0x1a4)]=_0xe71b54,await _0x121e03[_0x18b80a(0x1eb)]();let _0x4277bb=new Date(),_0xd0d515=('0'+_0x4277bb['getDate']())[_0x18b80a(0x195)](-0x2),_0x3c5e51=('0'+(_0x4277bb[_0x18b80a(0x165)]()+0x1))[_0x18b80a(0x195)](-0x2),_0x334bbe=_0x4277bb[_0x18b80a(0x135)](),_0x1b7673=_0x334bbe+'-'+_0x3c5e51+'-'+_0xd0d515;const _0x5c4324=new suppliers_payment({'invoice':_0x21af92,'date':_0x334bbe+'-'+_0x3c5e51+'-'+_0xd0d515,'suppliers':_0xa1f16,'reason':_0x18b80a(0x1db),'amount':_0x4ea45c}),_0x4fa755=await _0x5c4324[_0x18b80a(0x1eb)]();_0x216575[_0x18b80a(0x114)](_0x18b80a(0x1be),_0x18b80a(0x196)),_0x567983[_0x18b80a(0x1ed)](_0x18b80a(0x1ea));}catch(_0x3a767e){console['log'](_0x3a767e);}}),router[a0_0x571e72(0x179)]('/invoice/:id',auth,async(_0x29d146,_0x48a6cf)=>{var _0x261d11=a0_0x571e72;try{const {username:_0x32cb86,email:_0x236d28,role:_0x43b516}=_0x29d146['user'],_0x38b35e=_0x29d146[_0x261d11(0xfc)],_0x2252d1=await profile[_0x261d11(0x190)]({'email':_0x38b35e[_0x261d11(0x16c)]}),_0x250f82=await master_shop[_0x261d11(0x100)]();console[_0x261d11(0x1e6)](_0x261d11(0x16f),_0x250f82);const _0x284866=_0x29d146[_0x261d11(0xf5)]['id'],_0x5266b3=await purchases[_0x261d11(0x1d6)](_0x284866);console[_0x261d11(0x1e6)](_0x5266b3);const _0x1c11d6=await suppliers[_0x261d11(0x190)]({'name':_0x5266b3['suppliers']});console[_0x261d11(0x1e6)](_0x1c11d6);if(_0x250f82[0x0]['language']==_0x261d11(0x13b)){var _0x71041b=users[_0x261d11(0x104)];console[_0x261d11(0x1e6)](_0x71041b);}else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x1aa))var _0x71041b=users[_0x261d11(0x1aa)];else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x1c7))var _0x71041b=users['German'];else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x1a0))var _0x71041b=users[_0x261d11(0x1a0)];else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x1c9))var _0x71041b=users[_0x261d11(0x1c9)];else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x11c))var _0x71041b=users[_0x261d11(0x110)];else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x1b5))var _0x71041b=users[_0x261d11(0x1b5)];else{if(_0x250f82[0x0][_0x261d11(0x18e)]==_0x261d11(0x102))var _0x71041b=users[_0x261d11(0x1e2)];}}}}}}}_0x48a6cf['render'](_0x261d11(0x183),{'success':_0x29d146[_0x261d11(0x114)](_0x261d11(0x1be)),'errors':_0x29d146['flash'](_0x261d11(0x13e)),'role':_0x38b35e,'profile':_0x2252d1,'master_shop':_0x250f82,'supplier':_0x1c11d6,'purchase':_0x5266b3,'language':_0x71041b});}catch(_0x62dbc5){console[_0x261d11(0x1e6)](_0x62dbc5);}}),router['get'](a0_0x571e72(0x115),auth,async(_0x531352,_0x4ed54f)=>{var _0x3e66df=a0_0x571e72;try{const {username:_0x5df62e,email:_0x2d42ff,role:_0x3b4c3d}=_0x531352[_0x3e66df(0xfc)],_0x410f11=_0x531352[_0x3e66df(0xfc)],_0x5e28e1=await profile[_0x3e66df(0x190)]({'email':_0x410f11[_0x3e66df(0x16c)]}),_0x35de09=await master_shop[_0x3e66df(0x100)]();console[_0x3e66df(0x1e6)]('master',_0x35de09);const _0x5f270e=_0x531352['params']['id'];console['log'](_0x5f270e);const _0x1b5eca=await purchases[_0x3e66df(0x1d6)](_0x5f270e);console[_0x3e66df(0x1e6)](_0x3e66df(0x13a),_0x1b5eca);const _0x310f61=await product[_0x3e66df(0x100)]({}),_0x5e8924=await warehouse[_0x3e66df(0x1a3)]([{'$match':{'name':_0x1b5eca[_0x3e66df(0xfb)],'room':_0x1b5eca[_0x3e66df(0x14a)],'warehouse_category':_0x3e66df(0x122)}},{'$unwind':_0x3e66df(0x15d)},{'$group':{'_id':_0x3e66df(0xf1),'name':{'$first':_0x3e66df(0x130)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3e66df(0xed)},'bin':{'$first':_0x3e66df(0x15e)},'type':{'$first':_0x3e66df(0x1cc)},'floorlevel':{'$first':_0x3e66df(0x19b)},'primary_code':{'$first':_0x3e66df(0x194)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3e66df(0x1f4)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x3e66df(0x122)}},{'$group':{'_id':_0x3e66df(0x1d4),'name':{'$first':_0x3e66df(0x1d4)}}},{'$sort':{'name':0x1}}]),console['log'](_0x3e66df(0xec),_0x5e8924);if(_0x35de09[0x0][_0x3e66df(0x18e)]=='English\x20(US)'){var _0x37f5ef=users['English'];console[_0x3e66df(0x1e6)](_0x37f5ef);}else{if(_0x35de09[0x0][_0x3e66df(0x18e)]=='Hindi')var _0x37f5ef=users['Hindi'];else{if(_0x35de09[0x0][_0x3e66df(0x18e)]==_0x3e66df(0x1c7))var _0x37f5ef=users[_0x3e66df(0x1c7)];else{if(_0x35de09[0x0][_0x3e66df(0x18e)]==_0x3e66df(0x1a0))var _0x37f5ef=users[_0x3e66df(0x1a0)];else{if(_0x35de09[0x0][_0x3e66df(0x18e)]==_0x3e66df(0x1c9))var _0x37f5ef=users['French'];else{if(_0x35de09[0x0]['language']==_0x3e66df(0x11c))var _0x37f5ef=users[_0x3e66df(0x110)];else{if(_0x35de09[0x0][_0x3e66df(0x18e)]==_0x3e66df(0x1b5))var _0x37f5ef=users[_0x3e66df(0x1b5)];else{if(_0x35de09[0x0][_0x3e66df(0x18e)]=='Arabic\x20(ae)')var _0x37f5ef=users['Arabic'];}}}}}}}_0x4ed54f[_0x3e66df(0x11b)](_0x3e66df(0x153),{'success':_0x531352[_0x3e66df(0x114)](_0x3e66df(0x1be)),'errors':_0x531352['flash'](_0x3e66df(0x13e)),'role':_0x410f11,'profile':_0x5e28e1,'user':_0x1b5eca,'stock':_0x5e8924,'master_shop':_0x35de09,'product':_0x310f61,'language':_0x37f5ef,'warehouse':warehouse_data});}catch(_0x10b7dd){console[_0x3e66df(0x1e6)](_0x10b7dd);}}),router[a0_0x571e72(0x139)]('/view/return_purchase/:id',auth,async(_0x48b5f1,_0x16415a)=>{var _0x41a144=a0_0x571e72;try{const {invoice:_0x255a6b,date:_0x1fdd0d,warehouse_name:_0x4842b4,Room_name:_0x16d997,product_name:_0x2667da,purchase_quantity:_0x3c7f45,stocks:_0x1a089f,return_qty:_0x574e1b,note:_0x5c5a0d,level:_0x4fbebd,isle:_0x164b39,pallet:_0x1025bc,to_warehouse_name:_0x5ea847,to_Room_name:_0x38751c}=_0x48b5f1[_0x41a144(0x144)],_0x1a1520=await purchases[_0x41a144(0x190)]({'_id':_0x48b5f1['params']['id']}),_0x4f9311=await warehouse[_0x41a144(0x190)]({'name':_0x4842b4,'room':_0x16d997});if(typeof _0x2667da=='string')var _0x45b721=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1dd)]],_0x21f4fd=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x184)]],_0x35d033=[_0x48b5f1['body'][_0x41a144(0x1d8)]],_0x89fcb4=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x12a)]],_0x3aee9e=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0xf7)]],_0x129e2b=[_0x48b5f1[_0x41a144(0x144)]['isle']],_0x217379=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1d5)]],_0x57ef03=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1e9)]],_0x32cd17=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x116)]],_0x78976e=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1c5)]],_0x8ebd08=[_0x48b5f1[_0x41a144(0x144)][_0x41a144(0xea)]];else var _0x45b721=[..._0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1dd)]],_0x21f4fd=[..._0x48b5f1[_0x41a144(0x144)]['purchase_quantity']],_0x35d033=[..._0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1d8)]],_0x89fcb4=[..._0x48b5f1[_0x41a144(0x144)][_0x41a144(0x12a)]],_0x3aee9e=[..._0x48b5f1[_0x41a144(0x144)][_0x41a144(0xf7)]],_0x129e2b=[..._0x48b5f1['body'][_0x41a144(0x19c)]],_0x217379=[..._0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1d5)]],_0x57ef03=[..._0x48b5f1[_0x41a144(0x144)][_0x41a144(0x1e9)]],_0x32cd17=[..._0x48b5f1[_0x41a144(0x144)]['product_code_hide']],_0x78976e=[..._0x48b5f1['body'][_0x41a144(0x1c5)]],_0x8ebd08=[..._0x48b5f1['body'][_0x41a144(0xea)]];const _0x49b8b1=_0x45b721[_0x41a144(0x1e4)](_0x401727=>{return _0x401727={'product_name':_0x401727};});_0x21f4fd[_0x41a144(0x192)]((_0x178e54,_0x4e5a9e)=>{var _0x46d00f=_0x41a144;_0x49b8b1[_0x4e5a9e][_0x46d00f(0x184)]=_0x178e54;}),_0x35d033[_0x41a144(0x192)]((_0x41cbc9,_0x5c606d)=>{_0x49b8b1[_0x5c606d]['stock_quantity']=_0x41cbc9;}),_0x89fcb4['forEach']((_0x107f93,_0xce0782)=>{var _0x77ca3a=_0x41a144;_0x49b8b1[_0xce0782][_0x77ca3a(0x12a)]=_0x107f93;}),_0x3aee9e[_0x41a144(0x192)]((_0x18e0da,_0x3db9c7)=>{_0x49b8b1[_0x3db9c7]['bay']=_0x18e0da;}),_0x129e2b[_0x41a144(0x192)]((_0x3126ae,_0x3385d7)=>{var _0x587686=_0x41a144;_0x49b8b1[_0x3385d7][_0x587686(0xdc)]=_0x3126ae;}),_0x217379[_0x41a144(0x192)]((_0x22267b,_0x55de1a)=>{_0x49b8b1[_0x55de1a]['floorlevel']=_0x22267b;}),_0x57ef03[_0x41a144(0x192)]((_0x5a4461,_0xf8454e)=>{var _0x24de6b=_0x41a144;_0x49b8b1[_0xf8454e][_0x24de6b(0x174)]=_0x5a4461;}),_0x32cd17[_0x41a144(0x192)]((_0x2fe6c3,_0x14633d)=>{var _0x38e791=_0x41a144;_0x49b8b1[_0x14633d][_0x38e791(0xfe)]=_0x2fe6c3;}),_0x78976e['forEach']((_0x186815,_0x2fe426)=>{var _0x46e563=_0x41a144;_0x49b8b1[_0x2fe426][_0x46e563(0x125)]=_0x186815;}),_0x8ebd08[_0x41a144(0x192)]((_0x4bda0a,_0xeb85af)=>{var _0x330005=_0x41a144;_0x49b8b1[_0xeb85af][_0x330005(0x160)]=_0x4bda0a;}),_0x1a1520['product']['forEach'](_0x4bebe2=>{const _0x10a591=_0x4f9311['product_details']['map'](_0x3f6777=>{var _0x482aab=a0_0x36b6;_0x3f6777[_0x482aab(0x1dd)]==_0x4bebe2[_0x482aab(0x1dd)]&&_0x3f6777[_0x482aab(0x1ac)]==_0x4bebe2[_0x482aab(0x1ac)]&&_0x3f6777[_0x482aab(0x174)]==_0x4bebe2['type']&&_0x3f6777[_0x482aab(0xdc)]==_0x4bebe2[_0x482aab(0xdc)]&&_0x3f6777['bay']==_0x4bebe2[_0x482aab(0x166)]&&_0x3f6777[_0x482aab(0x12e)]==_0x4bebe2['rack']&&_0x3f6777[_0x482aab(0x15c)]==_0x4bebe2[_0x482aab(0x15c)]&&(console['log'](parseInt(_0x3f6777[_0x482aab(0x1f1)])+'\x20<>\x20'+parseInt(_0x4bebe2['quantity'])),_0x3f6777[_0x482aab(0x1f1)]=parseInt(_0x3f6777[_0x482aab(0x1f1)])+parseInt(_0x4bebe2[_0x482aab(0x19d)]));});}),await _0x4f9311['save']();const _0x28bc00=_0x49b8b1[_0x41a144(0x151)](_0x475d6c=>_0x475d6c['return_qty']!=='0'&&_0x475d6c[_0x41a144(0x12a)]!=='');var _0x582c92=0x0;_0x28bc00[_0x41a144(0x192)](_0x11af4a=>{var _0x5c770d=_0x41a144;console[_0x5c770d(0x1e6)](_0x5c770d(0x10b),_0x11af4a),(parseInt(_0x11af4a['purchase_quantity'])<parseInt(_0x11af4a[_0x5c770d(0x12a)])||parseInt(_0x11af4a[_0x5c770d(0x11d)])<parseInt(_0x11af4a[_0x5c770d(0x12a)]))&&_0x582c92++;});if(_0x582c92!=0x0)return _0x48b5f1[_0x41a144(0x114)](_0x41a144(0x13e),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x16415a[_0x41a144(0x1ed)](_0x41a144(0x11e));const _0x372aa3=new purchases_return({'invoice':_0x255a6b,'suppliers':_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x136)],'date':_0x1fdd0d,'warehouse_name':_0x4842b4,'return_product':_0x28bc00,'note':_0x5c5a0d,'room':_0x16d997,'to_warehouse_name':_0x5ea847,'to_room':_0x38751c}),_0x1a63ee=await _0x372aa3[_0x41a144(0x1eb)]();console[_0x41a144(0x1e6)](_0x372aa3);const _0x19e867=await purchases_return[_0x41a144(0x190)]({'invoice':_0x255a6b}),_0x1a2f15=await warehouse['findOne']({'name':_0x5ea847,'room':_0x38751c});_0x19e867['return_product'][_0x41a144(0x192)](_0x1eec1a=>{var _0x1d9670=_0x41a144,_0xa3c52d=0x0;const _0xda610a=_0x1a2f15['product_details'][_0x1d9670(0x1e4)](_0x2d9d50=>{var _0x3d5e44=_0x1d9670;_0x2d9d50[_0x3d5e44(0x1dd)]==_0x1eec1a[_0x3d5e44(0x1dd)]&&_0x2d9d50['floorlevel']==_0x1eec1a[_0x3d5e44(0x1ac)]&&_0x2d9d50['type']==_0x1eec1a[_0x3d5e44(0x174)]&&_0x2d9d50[_0x3d5e44(0xdc)]==_0x1eec1a['bin']&&_0x2d9d50[_0x3d5e44(0x166)]==_0x1eec1a['bay']&&(_0x2d9d50[_0x3d5e44(0x1f1)]=parseInt(_0x2d9d50[_0x3d5e44(0x1f1)])-parseInt(_0x1eec1a[_0x3d5e44(0x12a)]),_0xa3c52d++);});_0xa3c52d=='0'&&(_0x1a2f15['product_details']=_0x1a2f15[_0x1d9670(0xe2)]['concat']({'product_name':_0x1eec1a[_0x1d9670(0x1dd)],'product_stock':_0x1eec1a['return_qty'],'primary_code':_0x1eec1a[_0x1d9670(0x125)],'secondary_code':_0x1eec1a[_0x1d9670(0x160)],'product_code':_0x1eec1a[_0x1d9670(0xfe)],'storage':_0x1eec1a['storage'],'rack':_0x1eec1a[_0x1d9670(0x12e)],'bay':_0x1eec1a[_0x1d9670(0x166)],'bin':_0x1eec1a[_0x1d9670(0xdc)],'type':_0x1eec1a[_0x1d9670(0x174)],'floorlevel':_0x1eec1a['floorlevel'],'maxProducts':_0x1eec1a[_0x1d9670(0xdb)],'unit':_0x1eec1a[_0x1d9670(0x152)],'secondary_unit':_0x1eec1a['secondary_unit'],'expiry_date':_0x1eec1a['expiry_date']}));}),await _0x1a2f15[_0x41a144(0x1eb)]();const _0x456b65=await purchases['findOne']({'invoice':_0x255a6b});_0x456b65[_0x41a144(0xe7)]=_0x41a144(0x1d1);const _0x1dd789=await _0x456b65[_0x41a144(0x1eb)](),_0x2fc01d=new s_payment_data({'invoice':_0x255a6b,'suppliers':_0x48b5f1['body'][_0x41a144(0x136)],'reason':_0x41a144(0x182)});await _0x2fc01d[_0x41a144(0x1eb)]();const _0x181985=await master_shop[_0x41a144(0x100)]();console['log'](_0x41a144(0xe8),_0x181985[0x0][_0x41a144(0x1b3)]);const _0x2cf28a=await email_settings[_0x41a144(0x190)](),_0x58e4d9=await suppliers['findOne']({'name':_0x48b5f1[_0x41a144(0x144)][_0x41a144(0x136)]});console['log']('suppliers_data',_0x58e4d9);_0x181985[0x0]['currency_placement']==0x1?(right_currency=_0x181985[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x181985[0x0][_0x41a144(0x13d)]);var _0x24c097=_0x45b721,_0x113971=_0x89fcb4,_0x7cfcf4='',_0x2b61c6;for(_0x2b61c6 in _0x24c097){_0x7cfcf4+=_0x41a144(0x156)+_0x41a144(0x12f)+_0x24c097[_0x2b61c6]+_0x41a144(0xf6)+_0x41a144(0x12f)+_0x113971[_0x2b61c6]+_0x41a144(0xf6)+_0x41a144(0xf3);}console[_0x41a144(0x1e6)](_0x41a144(0x1cf),_0x7cfcf4);let _0x38a88f=nodemailer[_0x41a144(0xd8)]({'service':_0x41a144(0x17e),'auth':{'user':_0x2cf28a[_0x41a144(0x16c)],'pass':_0x2cf28a[_0x41a144(0x149)]}}),_0x40c89c={'from':_0x2cf28a[_0x41a144(0x16c)],'to':_0x58e4d9[_0x41a144(0x16c)],'subject':_0x41a144(0x108),'attachments':[{'filename':_0x41a144(0x1c4),'path':__dirname+_0x41a144(0x186)+'/upload/'+_0x181985[0x0][_0x41a144(0x1b3)],'cid':_0x41a144(0x142)}],'html':_0x41a144(0x1d7)+'<html><head><title></title>'+_0x41a144(0x1ba)+_0x41a144(0xf8)+_0x41a144(0x1ce)+'<div>'+_0x41a144(0x1ca)+_0x41a144(0x18b)+_0x41a144(0xf8)+_0x41a144(0x1b6)+_0x181985[0x0]['site_title']+_0x41a144(0xf0)+_0x41a144(0x18b)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x41a144(0xf8)+_0x41a144(0x1b4)+_0x41a144(0x105)+_0x255a6b+'\x20'+_0x41a144(0x199)+_0x41a144(0x158)+_0x1fdd0d+'\x20'+_0x41a144(0x1bb)+_0x41a144(0x193)+_0x41a144(0x18b)+_0x41a144(0x197)+_0x41a144(0x1d3)+_0x41a144(0x156)+_0x41a144(0x171)+_0x41a144(0x1ad)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x41a144(0x16a)+_0x41a144(0xf3)+_0x41a144(0x103)+_0x41a144(0x11f)+'\x20'+_0x7cfcf4+'\x20'+_0x41a144(0xfd)+_0x41a144(0x16d)+'<div>'+_0x41a144(0x1ee)+_0x41a144(0x14d)+_0x181985[0x0][_0x41a144(0x132)]+_0x41a144(0x193)+_0x41a144(0x18b)+'</div>'+'</body></html>'};_0x38a88f[_0x41a144(0x1bf)](_0x40c89c,function(_0x4c59a1,_0x59a377){var _0x3f595b=_0x41a144;_0x4c59a1?(console[_0x3f595b(0x1e6)](_0x4c59a1),console[_0x3f595b(0x1e6)](_0x3f595b(0x1a5))):console[_0x3f595b(0x1e6)](_0x3f595b(0x123));}),_0x48b5f1[_0x41a144(0x114)]('success','purchases\x20item\x20return\x20successfull'),_0x16415a[_0x41a144(0x1ed)](_0x41a144(0x1ea));}catch(_0x225d24){console[_0x41a144(0x1e6)](_0x225d24),_0x16415a[_0x41a144(0xe6)](0xc8)['json']({'message':_0x225d24[_0x41a144(0x12b)]});}}),router[a0_0x571e72(0x179)]('/barcode/:id',auth,async(_0x43d261,_0x5b70f6)=>{var _0x42de55=a0_0x571e72;try{const {username:_0x4acb2a,email:_0x33ca52,role:_0x1662a9}=_0x43d261[_0x42de55(0xfc)],_0x4b4f99=_0x43d261[_0x42de55(0xfc)],_0x2e91cb=await profile[_0x42de55(0x190)]({'email':_0x4b4f99[_0x42de55(0x16c)]}),_0x12a287=await master_shop['find'](),_0x29580b=_0x43d261['params']['id'],_0x4fa6e1=await purchases[_0x42de55(0x1d6)](_0x29580b);if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x13b))var _0x58886a=users[_0x42de55(0x104)];else{if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x1aa))var _0x58886a=users['Hindi'];else{if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x1c7))var _0x58886a=users[_0x42de55(0x1c7)];else{if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x1a0))var _0x58886a=users['Spanish'];else{if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x1c9))var _0x58886a=users[_0x42de55(0x1c9)];else{if(_0x12a287[0x0][_0x42de55(0x18e)]=='Portuguese\x20(BR)')var _0x58886a=users[_0x42de55(0x110)];else{if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x1b5))var _0x58886a=users[_0x42de55(0x1b5)];else{if(_0x12a287[0x0][_0x42de55(0x18e)]==_0x42de55(0x102))var _0x58886a=users[_0x42de55(0x1e2)];}}}}}}}_0x5b70f6[_0x42de55(0x11b)]('all_purchases_barcode',{'success':_0x43d261['flash']('success'),'errors':_0x43d261['flash'](_0x42de55(0x13e)),'role':_0x4b4f99,'profile':_0x2e91cb,'alldata':_0x4fa6e1,'master_shop':_0x12a287,'language':_0x58886a}),console['log'](alldata);}catch(_0x3ffc7f){console[_0x42de55(0x1e6)](_0x3ffc7f);}}),router[a0_0x571e72(0x139)]('/barcode_scanner',async(_0x28a378,_0x5801b8)=>{var _0x373231=a0_0x571e72;const {product_code:_0x150d44}=_0x28a378['body'];var _0x31f360;const _0x2ae1d0=await product[_0x373231(0x1a3)]([{'$match':{'primary_code':_0x150d44,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x373231(0x176),'name':{'$first':_0x373231(0x1d4)},'category':{'$first':_0x373231(0xf4)},'brand':{'$first':_0x373231(0x107)},'unit':{'$first':_0x373231(0x1c8)},'alertquantity':{'$first':_0x373231(0x124)},'product_code':{'$first':_0x373231(0x10c)},'primary_code':{'$first':_0x373231(0x143)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x373231(0x1e0)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x373231(0xd7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x29e788=await product[_0x373231(0x1a3)]([{'$match':{'secondary_code':_0x150d44,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x373231(0x1d4)},'category':{'$first':_0x373231(0xf4)},'brand':{'$first':_0x373231(0x107)},'unit':{'$first':_0x373231(0x1c8)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x373231(0x10c)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x373231(0x1f0)},'maxStocks':{'$first':_0x373231(0x15a)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x373231(0xd7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2ae1d0[_0x373231(0x159)]>0x0)_0x31f360=_0x2ae1d0;else _0x29e788[_0x373231(0x159)]>0x0&&(_0x31f360=_0x29e788);_0x5801b8[_0x373231(0x15f)](_0x31f360);}),router['post']('/CheckingWarehouse',async(_0x113304,_0xda02f8)=>{var _0x31e2ca=a0_0x571e72;const {primaryCode:_0x464430,secondaryCode:_0x109541,productCode:_0x523191,bay:_0x3bc0b6,bin:_0x36bdf6,types:_0x5fee90,pallet:_0x189e8e,warehouses:_0x51d291,room:_0x329158}=_0x113304['body'];console[_0x31e2ca(0x1e6)](_0x113304[_0x31e2ca(0x144)]);try{const _0x498e55=await warehouse[_0x31e2ca(0x1a3)]([{'$match':{'name':_0x51d291,'room':_0x329158}},{'$unwind':_0x31e2ca(0x15d)},{'$match':{'product_details.bay':_0x3bc0b6,'product_details.bin':_0x36bdf6,'product_details.type':_0x5fee90}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x31e2ca(0x130)},'product_stock':{'$first':_0x31e2ca(0x1e5)},'level':{'$first':_0x31e2ca(0x1a7)},'isle':{'$first':_0x31e2ca(0x1f7)},'pallet':{'$first':_0x31e2ca(0x1f3)},'maxProducts':{'$first':_0x31e2ca(0x1af)}}}]);_0xda02f8[_0x31e2ca(0xe6)](0xc8)['json'](_0x498e55);}catch(_0x4941ba){_0xda02f8[_0x31e2ca(0xe6)](0x194)['json']({'message':_0x4941ba[_0x31e2ca(0x12b)]});}}),module[a0_0x571e72(0x1bd)]=router;