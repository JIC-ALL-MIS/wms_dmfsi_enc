var a0_0x20d45f=a0_0x2053;(function(_0x18a4e6,_0x92e436){var _0x460ddd=a0_0x2053,_0x40b9b1=_0x18a4e6();while(!![]){try{var _0x573ebf=parseInt(_0x460ddd(0xed))/0x1+-parseInt(_0x460ddd(0x13e))/0x2+-parseInt(_0x460ddd(0x13d))/0x3*(-parseInt(_0x460ddd(0x140))/0x4)+parseInt(_0x460ddd(0x18d))/0x5+parseInt(_0x460ddd(0x131))/0x6*(-parseInt(_0x460ddd(0x119))/0x7)+-parseInt(_0x460ddd(0xdc))/0x8*(-parseInt(_0x460ddd(0x156))/0x9)+-parseInt(_0x460ddd(0x136))/0xa;if(_0x573ebf===_0x92e436)break;else _0x40b9b1['push'](_0x40b9b1['shift']());}catch(_0x37358e){_0x40b9b1['push'](_0x40b9b1['shift']());}}}(a0_0x6f5c,0xb6acb));const express=require(a0_0x20d45f(0x137)),app=express(),router=express[a0_0x20d45f(0x19a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x20d45f(0xd8)),auth=require(a0_0x20d45f(0x14d)),nodemailer=require('nodemailer');var ejs=require('ejs');const path=require(a0_0x20d45f(0xf4)),users=require('../public/language/languages.json');router[a0_0x20d45f(0xe2)](a0_0x20d45f(0x1c5),auth,async(_0x4bcf15,_0x2fae33)=>{var _0x45b39e=a0_0x20d45f;try{const {username:_0x149663,email:_0x4e9a63,role:_0x58420a}=_0x4bcf15[_0x45b39e(0x171)],_0x11558f=_0x4bcf15[_0x45b39e(0x171)],_0x548501=await profile[_0x45b39e(0x135)]({'email':_0x11558f[_0x45b39e(0xac)]}),_0x38a068=await staff[_0x45b39e(0x135)]({'email':_0x11558f[_0x45b39e(0xac)]});if(_0x11558f[_0x45b39e(0x187)]=='staff'){const _0x5126b0=await staff[_0x45b39e(0x135)]({'email':_0x11558f['email']});}const _0x1aafea=await master_shop[_0x45b39e(0x106)]();let _0xf719ed;if(_0x11558f[_0x45b39e(0x187)]==_0x45b39e(0x1b3)){const _0x401ba1=await staff[_0x45b39e(0x135)]({'email':_0x11558f[_0x45b39e(0xac)]});_0xf719ed=await purchases[_0x45b39e(0x11b)]([{'$match':{'warehouse_name':_0x401ba1['warehouse']}},{'$lookup':{'from':_0x45b39e(0x18b),'localField':_0x45b39e(0x18b),'foreignField':_0x45b39e(0x184),'as':_0x45b39e(0x121)}},{'$unwind':_0x45b39e(0x16e)},{'$unwind':_0x45b39e(0x17f)},{'$group':{'_id':_0x45b39e(0x18c),'invoice':{'$first':_0x45b39e(0x1c8)},'suppliers':{'$first':_0x45b39e(0x15b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x45b39e(0x17e)},'room':{'$first':_0x45b39e(0xef)},'product':{'$push':_0x45b39e(0x17f)},'note':{'$first':_0x45b39e(0xd2)},'paid_amount':{'$first':_0x45b39e(0x10e)},'due_amount':{'$first':_0x45b39e(0x179)},'return_data':{'$first':_0x45b39e(0x19d)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x45b39e(0x123)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x45b39e(0x1af)},'level':{'$addToSet':_0x45b39e(0x1c6)},'isle':{'$addToSet':_0x45b39e(0x15e)},'type':{'$addToSet':_0x45b39e(0x162)},'floorlevel':{'$addToSet':_0x45b39e(0xc2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xf719ed=await purchases['aggregate']([{'$lookup':{'from':_0x45b39e(0x18b),'localField':_0x45b39e(0x18b),'foreignField':_0x45b39e(0x184),'as':_0x45b39e(0x121)}},{'$unwind':_0x45b39e(0x16e)},{'$unwind':_0x45b39e(0x17f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x45b39e(0x1c8)},'suppliers':{'$first':_0x45b39e(0x15b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x45b39e(0x17e)},'room':{'$addToSet':_0x45b39e(0x1c9)},'product':{'$push':_0x45b39e(0x17f)},'note':{'$first':_0x45b39e(0xd2)},'paid_amount':{'$first':_0x45b39e(0x10e)},'due_amount':{'$first':_0x45b39e(0x179)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x45b39e(0xe1)},'expiry_date':{'$first':_0x45b39e(0x123)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x45b39e(0x1af)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x45b39e(0x15e)},'type':{'$addToSet':_0x45b39e(0x162)},'floorlevel':{'$addToSet':_0x45b39e(0xc2)},'finalize':{'$first':_0x45b39e(0x1b4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1aafea[0x0][_0x45b39e(0x1b2)]==_0x45b39e(0x142)){var _0x2080d9=users[_0x45b39e(0x155)];console['log'](_0x2080d9);}else{if(_0x1aafea[0x0]['language']==_0x45b39e(0x150))var _0x2080d9=users['Hindi'];else{if(_0x1aafea[0x0][_0x45b39e(0x1b2)]==_0x45b39e(0xdd))var _0x2080d9=users[_0x45b39e(0xdd)];else{if(_0x1aafea[0x0][_0x45b39e(0x1b2)]==_0x45b39e(0x10b))var _0x2080d9=users[_0x45b39e(0x10b)];else{if(_0x1aafea[0x0][_0x45b39e(0x1b2)]==_0x45b39e(0x158))var _0x2080d9=users[_0x45b39e(0x158)];else{if(_0x1aafea[0x0][_0x45b39e(0x1b2)]==_0x45b39e(0xc5))var _0x2080d9=users[_0x45b39e(0xe6)];else{if(_0x1aafea[0x0]['language']==_0x45b39e(0xd0))var _0x2080d9=users[_0x45b39e(0xd0)];else{if(_0x1aafea[0x0]['language']==_0x45b39e(0x12e))var _0x2080d9=users[_0x45b39e(0x154)];}}}}}}}_0x2fae33[_0x45b39e(0x125)](_0x45b39e(0x181),{'success':_0x4bcf15[_0x45b39e(0x175)](_0x45b39e(0x194)),'errors':_0x4bcf15['flash']('errors'),'purchases':_0xf719ed,'role':_0x11558f,'profile':_0x548501,'master_shop':_0x1aafea,'language':_0x2080d9});}catch(_0x4ef819){console[_0x45b39e(0x169)](_0x45b39e(0x1bf),_0x4ef819),_0x2fae33[_0x45b39e(0x1b5)](0xc8)[_0x45b39e(0xde)]({'message':_0x4ef819[_0x45b39e(0x1bd)]});}});function BayBinSelected(_0x3c858e,_0x570df2){var _0x348155=a0_0x20d45f,_0x7bcbda=[],_0x1aa151=[],_0xb89232=[],_0xa77c97=[],_0x2a10fe=[],_0x31105e=[];let _0x1e3c22=[];if(_0x3c858e==_0x348155(0x178))switch(_0x570df2){case _0x348155(0x1be):_0x7bcbda=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1aa151=[0x1,0x2],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c),_0x348155(0x10a)],_0x2a10fe=['D'],_0x31105e=['A'];break;case _0x348155(0x1a3):_0x7bcbda=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1aa151=[0x1,0x2],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c),_0x348155(0x10a)],_0x2a10fe=['D'],_0x31105e=['B'];break;case _0x348155(0x14b):_0x7bcbda=[0x0],_0x1aa151=[0x0],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x10a)],_0x2a10fe=['D'],_0x31105e=['S'];break;case _0x348155(0xca):_0x7bcbda=[0x0],_0x1aa151=[0x0],_0xa77c97=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xb89232=['Floor'],_0x2a10fe=['D'],_0x31105e=['R'];break;}else{if(_0x3c858e=='COLD\x20STORAGE')switch(_0x570df2){case'Rack\x20A':_0x7bcbda=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1aa151=['B','F'],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c),_0x348155(0x10a)],_0x2a10fe=['C'],_0x31105e=['A'];break;case _0x348155(0x1a3):_0x7bcbda=[0x5,0x4,0x3,0x2,0x1],_0x1aa151=['F','B','S'],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c),'Floor'],_0x2a10fe=['C'],_0x31105e=['B'];break;case _0x348155(0x1b8):_0x7bcbda=[0x1,0x2,0x3,0x4,0x5],_0x1aa151=['B','F','S'],_0xa77c97=[0x5,0x4,0x3,0x2,0x1],_0xb89232=[_0x348155(0x12c),'Floor'],_0x2a10fe=['C'],_0x31105e=['C'];break;case _0x348155(0x12a):_0x7bcbda=[0x5,0x4,0x3,0x2,0x1],_0x1aa151=['F','B','S'],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c),'Floor'],_0x2a10fe=['C'],_0x31105e=['D'];break;case _0x348155(0x165):_0x7bcbda=[0x4,0x3,0x2,0x1],_0x1aa151=[0x1,0x2],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c),_0x348155(0x10a)],_0x2a10fe=['C'],_0x31105e=['E'];break;case _0x348155(0x148):_0x7bcbda=[0x1,0x2,0x3],_0x1aa151=[0x1,0x2],_0xa77c97=[0x1,0x2,0x3,0x4,0x5],_0xb89232=[_0x348155(0x12c)],_0x2a10fe=['C'],_0x31105e=['F'];break;}}return{'levels':_0x7bcbda,'Isle':_0x1aa151,'rack':_0xa77c97,'type':_0xb89232,'storage':_0x2a10fe,'rak':_0x31105e};}async function getRandom8DigitNumber(){var _0x28209c=a0_0x20d45f;const _0x1d7923=0x989680,_0x15cab4=0x5f5e0ff,_0x4ca670=Math[_0x28209c(0xb2)](Math['random']()*(_0x15cab4-_0x1d7923+0x1))+_0x1d7923;var _0x239089;const _0x17f273=await purchases[_0x28209c(0x135)]({'invoice':'INC-'+_0x4ca670});return _0x17f273&&_0x17f273[_0x28209c(0xee)]>0x0?_0x239089='INC-'+_0x4ca670:_0x239089=_0x28209c(0xfc)+_0x4ca670,_0x239089;}function a0_0x2053(_0x247530,_0x1dd423){var _0x6f5c=a0_0x6f5c();return a0_0x2053=function(_0x2053f1,_0x2cd3b1){_0x2053f1=_0x2053f1-0xaa;var _0x3e512c=_0x6f5c[_0x2053f1];return _0x3e512c;},a0_0x2053(_0x247530,_0x1dd423);}function a0_0x6f5c(){var _0x271630=['currency','/../public','primary_code','/view/:id','$alertquantity','657107EaiZjb','length','$room','error','product_details','</body></html>','foreach\x20newproduct','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','toString','maxStocks','RMSEmail','$secondary_code','Enclosed','$product_details.secondary_code','INC-','back','/view/return_purchase/:id','product_stock','abs','due_amount','\x20<>\x20','here','catch','then','find','</h5>','$primary_code','<tr>','Floor','Spanish','Enabled','edit_purchases_view','$paid_amount','prod_unit','$product_details.storage','quantity','prod_code','deliverycode','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/all_purchases/view/','save','actual_qty','password','7frPXXQ','$name','aggregate','$brand','pallet','/upload/','$product_details.product_code','delivery_date','suppliers_docs','host','$expiry_date','gmail','render','bin','filter','date','Logo.png','Rack\x20D','forEach','Level','body','Arabic\x20(ae)','$product_details.bin','$maxProdPerUnit','5253960JJCtlS','$product_code','errors','$product_details.maxProducts','findOne','18587230HuRWiO','express','product_name','image','invoice','rak','prod_name','9597BZvzfA','1570384hEprfF','product','1188qIFXUJ','$product_details._id','English\x20(US)','level','floorlevel','add_purchases\x20error','$product_details','$unit','Rack\x20F','getDate','alertQTY','Shelves','string','../middleware/auth','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Hindi','logo','standard_unit','site_title','Arabic','English','36TZIczI','prod_primunit','French','<span\x20style=\x22float:\x20right;\x22>','</td>','$suppliers','$product_details.pallet','prod_cat','$product.bin','params','$product_details.bay','$product_details.product_name','$product.type','POnumber','Error\x20Occurs','Rack\x20E','\x20Order\x20Number\x20:\x20','/view/add_purchases','/barcode/:id','log','Ambient','Purchase\x20Return','room','isle','$suppliers_docs','storage','$secondary_unit','user','maxperunit','prod_invoice','paid_amount','flash','<tbody\x20style=\x22text-align:\x20center;\x22>','add_purchases','DRY\x20STORAGE','$due_amount','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','getMonth','stocks','getFullYear','$warehouse_name','$product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','all_purchases','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.floorlevel','name','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<h2>\x20','role','add\x20post','$product_details.rack','port','suppliers','$_id','6781860FNqlwS','\x20Order\x20Date\x20:\x20','redirect','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<html><head><title></title>','$category','success','/view/add_purchases/:id','product_list','Paid\x20For\x20Purchase','product_cat','</thead>','Router','user_id','warehouse_name','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','sendMail','RoomAssign','padStart','Sales\x20Update\x20successfully','Rack\x20B','stock_quantity','JO_number','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','return_product','secondary_code_hide','$product_details.product_stock','product_code_hide','secondary_code','Purchase\x20data\x20added\x20successfully','Purchase\x20Return\x20Mail','$product.quantity','prod_level','Purchase\x20Mail','language','staff','$finalize','status','concat','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Rack\x20C','return_qty','rack','slice','warehouse','message','Rack\x20A','table\x20page','post','/give_payment/:id','prod_pallet','product_code','primary_code_hide','/view','$product.bay','prod_qty','$invoice','$product.room_name','purchase_quantity','findById','</div>','Email\x20sent\x20successfully','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','email','</tr>','secondary_unit','purchase_invoice','return_purchase','max_product_unit','floor','/CheckingWarehouse','</tbody>','prod_Qty','note','/invoice/:id','<!DOCTYPE\x20html>','<strong>\x20Regards\x20</strong>','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','delivery_code','<h5>','purchase\x20data\x20update\x20successfully','purchases\x20item\x20return\x20successfull','Return\x20Goods','$product.floorlevel','master','True','Portuguese\x20(BR)','Raw\x20Materials','/all_purchases/view','<div>','type','Receiving\x20Area','actual_uom','</head><body>','$product_details.isle','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Chinese','/barcode_scanner','$note','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','MaxStocks_data','payment\x20successfull','stock_data','../models/all_models','edit_purchases','createTransport','</table>','2608456OrEZXM','German','json','map','</span>','$batch_code','get','bay','expiry_date','batch_code','Portuguese','\x20<\x20wew\x20>\x20'];a0_0x6f5c=function(){return _0x271630;};return a0_0x6f5c();}router[a0_0x20d45f(0xe2)]('/view/add_purchases',auth,async(_0x3d1be4,_0x339211)=>{var _0x5a10a8=a0_0x20d45f;try{const {username:_0x35a1ab,email:_0xb1f897,role:_0x1710d8}=_0x3d1be4[_0x5a10a8(0x171)],_0x5d5e39=_0x3d1be4['user'],_0x1eeb43=await profile[_0x5a10a8(0x135)]({'email':_0x5d5e39[_0x5a10a8(0xac)]}),_0x5bb184=await master_shop[_0x5a10a8(0x106)](),_0x5366ba=await staff[_0x5a10a8(0x135)]({'email':_0x5d5e39[_0x5a10a8(0xac)]}),_0x3b7ef8=await suppliers[_0x5a10a8(0x106)]({});let _0x420766;if(_0x5d5e39[_0x5a10a8(0x187)]==_0x5a10a8(0x1b3)){const _0x247662=await staff[_0x5a10a8(0x135)]({'email':_0x5d5e39[_0x5a10a8(0xac)]});_0x420766=await warehouse[_0x5a10a8(0x11b)]([{'$match':{'status':_0x5a10a8(0x10c),'name':_0x247662[_0x5a10a8(0x1bc)],'warehouse_category':_0x5a10a8(0xc6),'name':{'$ne':_0x5a10a8(0xc1)}}},{'$group':{'_id':_0x5a10a8(0x11a),'name':{'$first':_0x5a10a8(0x11a)}}}]);}else _0x420766=await warehouse[_0x5a10a8(0x11b)]([{'$match':{'status':'Enabled','warehouse_category':_0x5a10a8(0xc6),'name':{'$ne':_0x5a10a8(0xc1)}}},{'$group':{'_id':'$name','name':{'$first':_0x5a10a8(0x11a)}}}]);const _0x13b496=await product[_0x5a10a8(0x106)]({}),_0x2ffd48=await warehouse[_0x5a10a8(0x106)]({'status':_0x5a10a8(0x10c)}),_0x23ebd0=await purchases[_0x5a10a8(0x106)]({}),_0x1be890=_0x23ebd0[_0x5a10a8(0xee)]+0x1,_0x5a2edd=_0x5a10a8(0xfc)+_0x1be890[_0x5a10a8(0xf6)]()[_0x5a10a8(0x1a1)](0x5,'0');var _0xc15637=[_0x5a10a8(0x16a),_0x5a10a8(0xfa)];if(_0x5bb184[0x0][_0x5a10a8(0x1b2)]==_0x5a10a8(0x142))var _0xb7a5c=users[_0x5a10a8(0x155)];else{if(_0x5bb184[0x0]['language']==_0x5a10a8(0x150))var _0xb7a5c=users['Hindi'];else{if(_0x5bb184[0x0]['language']=='German')var _0xb7a5c=users['German'];else{if(_0x5bb184[0x0][_0x5a10a8(0x1b2)]==_0x5a10a8(0x10b))var _0xb7a5c=users['Spanish'];else{if(_0x5bb184[0x0][_0x5a10a8(0x1b2)]==_0x5a10a8(0x158))var _0xb7a5c=users['French'];else{if(_0x5bb184[0x0]['language']==_0x5a10a8(0xc5))var _0xb7a5c=users['Portuguese'];else{if(_0x5bb184[0x0][_0x5a10a8(0x1b2)]==_0x5a10a8(0xd0))var _0xb7a5c=users[_0x5a10a8(0xd0)];else{if(_0x5bb184[0x0]['language']==_0x5a10a8(0x12e))var _0xb7a5c=users['Arabic'];}}}}}}}const _0x487ba3=getRandom8DigitNumber();_0x487ba3[_0x5a10a8(0x105)](_0x4312f3=>{var _0x1e8bfa=_0x5a10a8;_0x339211[_0x1e8bfa(0x125)](_0x1e8bfa(0x177),{'success':_0x3d1be4['flash'](_0x1e8bfa(0x194)),'errors':_0x3d1be4['flash']('errors'),'role':_0x5d5e39,'profile':_0x1eeb43,'suppliers':_0x3b7ef8,'warehouse':_0x420766,'product':_0x13b496,'invoice':_0x4312f3,'master_shop':_0x5bb184,'language':_0xb7a5c,'find_data':_0x2ffd48,'rooms_data':_0xc15637});})[_0x5a10a8(0x104)](_0x3345d0=>{var _0x5cc53c=_0x5a10a8;_0x3d1be4[_0x5cc53c(0x175)]('errors',_0x5cc53c(0xd4)),_0x339211[_0x5cc53c(0x18f)](_0x5cc53c(0xc7));});}catch(_0x2d1526){console['log'](_0x2d1526);}}),router[a0_0x20d45f(0xe2)](a0_0x20d45f(0x195),auth,async(_0x33bf8a,_0x5769cf)=>{var _0x29668e=a0_0x20d45f;try{const _0x1b5b8d=_0x33bf8a['params']['id'];console[_0x29668e(0x169)](_0x1b5b8d);const _0x53d687=await master_shop['find']();console[_0x29668e(0x169)](_0x29668e(0xc3),_0x53d687);const _0x10845b=await product[_0x29668e(0x135)]({'name':_0x1b5b8d});console[_0x29668e(0x169)]('product',_0x10845b),_0x5769cf['status'](0xc8)['json']({'product_data':_0x10845b,'master':_0x53d687});}catch(_0xaa080d){console[_0x29668e(0x169)](_0x29668e(0x145),_0xaa080d);}}),router[a0_0x20d45f(0x1c0)](a0_0x20d45f(0x167),auth,async(_0xbf248f,_0x27f3da)=>{var _0x266833=a0_0x20d45f;try{const {invoice:_0x2f7a39,date:_0x731524,warehouse_name:_0xdf0405,prod_name:_0x2246cc,prod_code:_0x587ab1,prod_qty:_0x47ed6e,prod_unit:_0x87eff2,prod_secondunit:_0x2282ac,prod_level:_0xc94849,prod_isle:_0x39f8a4,prod_pallet:_0x491927,note:_0x1aa79e,expiry_date:_0x5edc2e,batch_code:_0x3c396f,payable:_0x5dadf8,due_amount:_0x9875b2,Room_name:_0x3019cd,primary_code:_0xc4719d,secondary_code:_0x4bbf18,MaxStocks_data:_0x3de56b,PO_number:_0x4c27d1,SCRN:_0x4ecbf1,JO_number:_0x51d677}=_0xbf248f['body'];if(typeof _0x2246cc==_0x266833(0x14c))var _0x49aeee=[_0xbf248f[_0x266833(0x12d)]['prod_name']],_0x41c704=[_0xbf248f[_0x266833(0x12d)]['prod_code']],_0x173f14=[_0xbf248f[_0x266833(0x12d)]['prod_Qty']],_0x29b447=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x157)]],_0x19c468=[_0xbf248f['body']['prod_secondunit']],_0x3f806b=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x1b0)]],_0x3c114c=[_0xbf248f[_0x266833(0x12d)][_0x266833(0xea)]],_0x36ab25=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x1ac)]],_0x509f6d=[_0xbf248f[_0x266833(0x12d)]['MaxStocks_data']],_0x3088b8=[_0xbf248f[_0x266833(0x12d)][_0x266833(0xe5)]],_0xee2e6b=[_0xbf248f['body'][_0x266833(0xe4)]],_0x2ee88d=[_0xbf248f[_0x266833(0x12d)][_0x266833(0xb1)]],_0x101c80=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x14a)]],_0x557b41=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x14e)]],_0x1c831a=[_0xbf248f[_0x266833(0x12d)]['prod_cat']],_0x38cf99=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x1a0)]],_0x35c9a8=[_0xbf248f[_0x266833(0x12d)]['deliverycode']],_0x4e4255=[_0xbf248f[_0x266833(0x12d)]['prod_invoice']],_0xc50530=[_0xbf248f[_0x266833(0x12d)][_0x266833(0x117)]],_0x1254b7=[_0xbf248f[_0x266833(0x12d)]['actual_uom']];else var _0x49aeee=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0x13c)]],_0x41c704=[..._0xbf248f[_0x266833(0x12d)]['prod_code']],_0x173f14=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0xb5)]],_0x29b447=[..._0xbf248f['body']['prod_primunit']],_0x19c468=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0xba)]],_0x3f806b=[..._0xbf248f[_0x266833(0x12d)]['prod_level']],_0x3c114c=[..._0xbf248f['body'][_0x266833(0xea)]],_0x36ab25=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0x1ac)]],_0x509f6d=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0xd5)]],_0x3088b8=[..._0xbf248f['body'][_0x266833(0xe5)]],_0xee2e6b=[..._0xbf248f['body'][_0x266833(0xe4)]],_0x2ee88d=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0xb1)]],_0x101c80=[..._0xbf248f['body'][_0x266833(0x14a)]],_0x557b41=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0x14e)]],_0x1c831a=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0x15d)]],_0x38cf99=[..._0xbf248f[_0x266833(0x12d)]['RoomAssign']],_0x35c9a8=[..._0xbf248f['body'][_0x266833(0x113)]],_0x4e4255=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0x173)]],_0xc50530=[..._0xbf248f['body'][_0x266833(0x117)]],_0x1254b7=[..._0xbf248f[_0x266833(0x12d)][_0x266833(0xcb)]];const _0x100e9d=_0x49aeee[_0x266833(0xdf)](_0x370e60=>{return _0x370e60={'product_name':_0x370e60};});_0xc50530[_0x266833(0x12b)]((_0x49fdef,_0x587879)=>{var _0x50c4d3=_0x266833;_0x100e9d[_0x587879]['actual_qty']=Math[_0x50c4d3(0x100)](_0x49fdef);}),_0x1254b7[_0x266833(0x12b)]((_0x2f1b61,_0x1b20f7)=>{_0x100e9d[_0x1b20f7]['actual_uom']=_0x2f1b61;}),_0x41c704[_0x266833(0x12b)]((_0x22d3d3,_0x1f2c1e)=>{var _0x14099d=_0x266833;_0x100e9d[_0x1f2c1e][_0x14099d(0x1c3)]=_0x22d3d3;}),_0x173f14['forEach']((_0xf2814,_0x57a309)=>{_0x100e9d[_0x57a309]['quantity']=Math['abs'](_0xf2814);}),_0x29b447[_0x266833(0x12b)]((_0x4c1e41,_0x31a70b)=>{_0x100e9d[_0x31a70b]['standard_unit']=_0x4c1e41;}),_0x19c468[_0x266833(0x12b)]((_0x562db9,_0x58939e)=>{var _0x180dde=_0x266833;_0x100e9d[_0x58939e][_0x180dde(0xae)]=_0x562db9;}),_0x3f806b[_0x266833(0x12b)]((_0x5cf1ea,_0x30cc46)=>{var _0x44e8ab=_0x266833;_0x38cf99[_0x44e8ab(0x12b)]((_0x38cda3,_0x5e84fe)=>{var _0x50ba20=_0x44e8ab;if(_0x38cda3=='Receiving\x20Area'&&_0x30cc46==_0x5e84fe){console['log'](_0x38cda3+_0x50ba20(0xe7)+_0x30cc46+'\x20<>\x20'+_0x5e84fe+_0x50ba20(0x102)+_0x5cf1ea);var _0x43afe1=_0x5cf1ea['slice'](0x3);_0x100e9d[_0x30cc46][_0x50ba20(0x16f)]=_0x5cf1ea[0x0],_0x100e9d[_0x30cc46][_0x50ba20(0x1ba)]=_0x5cf1ea[0x1],_0x100e9d[_0x30cc46][_0x50ba20(0xe3)]=0x0,_0x100e9d[_0x30cc46][_0x50ba20(0x126)]=0x0,_0x100e9d[_0x30cc46][_0x50ba20(0xc9)]='Floor',_0x100e9d[_0x30cc46]['floorlevel']=_0x43afe1;}else{if(_0x38cda3==_0x50ba20(0x14b)&&_0x30cc46==_0x5e84fe){var _0x43afe1=_0x5cf1ea[_0x50ba20(0x1bb)](0x3);_0x100e9d[_0x30cc46]['storage']=_0x5cf1ea[0x0],_0x100e9d[_0x30cc46][_0x50ba20(0x1ba)]=_0x5cf1ea[0x1],_0x100e9d[_0x30cc46][_0x50ba20(0xe3)]=0x0,_0x100e9d[_0x30cc46][_0x50ba20(0x126)]=0x0,_0x100e9d[_0x30cc46][_0x50ba20(0xc9)]=_0x50ba20(0x10a),_0x100e9d[_0x30cc46]['floorlevel']=_0x5cf1ea[0x5];}else{if(_0x30cc46==_0x5e84fe){if(_0x5cf1ea[0x0]=='A'&&_0x5cf1ea[0x1]=='L'&&_0x5cf1ea[0x2]=='L')console['log'](_0x38cda3+'\x20<>\x20'+_0x30cc46+'\x20<>\x20'+_0x5e84fe+_0x50ba20(0x102)+_0x5cf1ea+_0x50ba20(0x103)),_0x100e9d[_0x30cc46][_0x50ba20(0x16f)]=_0x5cf1ea[0x0],_0x100e9d[_0x30cc46]['rack']=_0x5cf1ea[0x1],_0x100e9d[_0x30cc46][_0x50ba20(0xe3)]=0x0,_0x100e9d[_0x30cc46][_0x50ba20(0x126)]=0x0,_0x100e9d[_0x30cc46]['type']=_0x50ba20(0x10a),_0x100e9d[_0x30cc46][_0x50ba20(0x144)]=_0x5cf1ea[0x3];else{var _0x440867;if(_0x5cf1ea[0x4]=='L')_0x440867=_0x50ba20(0x12c);else _0x5cf1ea[0x4]=='F'&&(_0x440867=_0x50ba20(0x10a));_0x100e9d[_0x30cc46][_0x50ba20(0x16f)]=_0x5cf1ea[0x0],_0x100e9d[_0x30cc46][_0x50ba20(0x1ba)]=_0x5cf1ea[0x1],_0x100e9d[_0x30cc46]['bay']=_0x5cf1ea[0x2],_0x100e9d[_0x30cc46][_0x50ba20(0x126)]=_0x5cf1ea[0x3],_0x100e9d[_0x30cc46]['type']=_0x440867,_0x100e9d[_0x30cc46][_0x50ba20(0x144)]=_0x5cf1ea[0x5];}}}}});}),_0x3c114c[_0x266833(0x12b)]((_0x50871a,_0x26140d)=>{var _0x2734d6=_0x266833;_0x100e9d[_0x26140d][_0x2734d6(0xea)]=_0x50871a;}),_0x36ab25['forEach']((_0x15f161,_0x39304d)=>{var _0x1686ef=_0x266833;_0x100e9d[_0x39304d][_0x1686ef(0x1ac)]=_0x15f161;}),_0x509f6d[_0x266833(0x12b)]((_0x4bd965,_0x19f888)=>{var _0x4d4b51=_0x266833;_0x100e9d[_0x19f888][_0x4d4b51(0xf7)]=_0x4bd965;}),_0x3088b8[_0x266833(0x12b)]((_0x551029,_0x2ecde1)=>{_0x100e9d[_0x2ecde1]['batch_code']=_0x551029;}),_0xee2e6b[_0x266833(0x12b)]((_0x26bcfe,_0x436a24)=>{var _0x4d80b7=_0x266833;_0x100e9d[_0x436a24][_0x4d80b7(0xe4)]=_0x26bcfe;}),_0x2ee88d[_0x266833(0x12b)]((_0x1cde8f,_0x3935a5)=>{var _0xec7ca1=_0x266833;_0x100e9d[_0x3935a5][_0xec7ca1(0x172)]=_0x1cde8f;}),_0x101c80[_0x266833(0x12b)]((_0x51ed55,_0x42fcd6)=>{var _0x44008=_0x266833;_0x100e9d[_0x42fcd6][_0x44008(0x14a)]=_0x51ed55;}),_0x557b41['forEach']((_0x5bb8fb,_0x191a65)=>{var _0x398b87=_0x266833;_0x100e9d[_0x191a65][_0x398b87(0x14e)]=_0x5bb8fb;}),_0x1c831a[_0x266833(0x12b)]((_0x34bc2a,_0x175510)=>{var _0xac136e=_0x266833;_0x100e9d[_0x175510][_0xac136e(0x198)]=_0x34bc2a;}),_0x38cf99['forEach']((_0x2e2a48,_0xed2712)=>{_0x100e9d[_0xed2712]['room_name']=_0x2e2a48;}),_0x35c9a8[_0x266833(0x12b)]((_0x455ce3,_0x511292)=>{var _0x52a375=_0x266833;_0x100e9d[_0x511292][_0x52a375(0xbd)]=_0x455ce3;}),_0x4e4255['forEach']((_0x4359f7,_0x92acee)=>{var _0x27765d=_0x266833;_0x100e9d[_0x92acee][_0x27765d(0x13a)]=_0x4359f7;});const _0xf4f88e=_0x38cf99['map'](_0x454f86=>{return _0x454f86={'room_name':_0x454f86};}),_0x4cf7b2=_0x100e9d[_0x266833(0x127)](_0x2d82ff=>_0x2d82ff['quantity']!=='0'&&_0x2d82ff['quantity']!==''),_0x459e18=new purchases({'invoice':_0x2f7a39,'suppliers':_0xbf248f[_0x266833(0x12d)][_0x266833(0x18b)],'date':_0x731524,'warehouse_name':_0xdf0405,'product':_0x4cf7b2,'note':_0x1aa79e,'due_amount':_0x9875b2,'POnumber':_0x4c27d1,'SCRN':_0x4ecbf1,'JO_number':_0x51d677,'roomList':_0xf4f88e}),_0x59cf83=await _0x459e18[_0x266833(0x116)](),_0x4f1698=await purchases[_0x266833(0x135)]({'invoice':_0x2f7a39}),_0x199b2c=_0x4f1698[_0x266833(0x13f)][_0x266833(0xdf)](async _0x79c34b=>{var _0x1e10ae=_0x266833,_0x18c39c=await warehouse[_0x1e10ae(0x135)]({'name':_0xdf0405,'room':_0x79c34b['room_name']}),_0x4ead08=0x0;return _0x18c39c[_0x1e10ae(0xf1)][_0x1e10ae(0x12b)](_0x32948e=>{var _0x44c322=_0x1e10ae;_0x32948e['product_name']==_0x79c34b[_0x44c322(0x138)]&&_0x32948e[_0x44c322(0x144)]==_0x79c34b[_0x44c322(0x144)]&&_0x32948e[_0x44c322(0xc9)]==_0x79c34b[_0x44c322(0xc9)]&&_0x32948e['bin']==_0x79c34b[_0x44c322(0x126)]&&_0x32948e[_0x44c322(0xe3)]==_0x79c34b[_0x44c322(0xe3)]&&_0x32948e[_0x44c322(0x1ba)]==_0x79c34b['rack']&&_0x32948e[_0x44c322(0x16f)]==_0x79c34b[_0x44c322(0x16f)]&&_0x32948e[_0x44c322(0xe4)]==_0x79c34b[_0x44c322(0xe4)]&&_0x32948e[_0x44c322(0xe5)]==_0x79c34b[_0x44c322(0xe5)]&&_0x32948e[_0x44c322(0x14e)]==_0x79c34b[_0x44c322(0x14e)]&&_0x32948e[_0x44c322(0x13a)]==_0x4f1698[_0x44c322(0x13a)]&&(_0x32948e[_0x44c322(0xff)]+=Math['abs'](_0x79c34b[_0x44c322(0x111)]),_0x4ead08++);}),_0x4ead08===0x0&&_0x18c39c[_0x1e10ae(0xf1)]['push']({'product_name':_0x79c34b[_0x1e10ae(0x138)],'product_stock':Math[_0x1e10ae(0x100)](_0x79c34b[_0x1e10ae(0x111)]),'primary_code':_0x79c34b['primary_code'],'secondary_code':_0x79c34b[_0x1e10ae(0x1ac)],'product_code':_0x79c34b['product_code'],'storage':_0x79c34b[_0x1e10ae(0x16f)],'rack':_0x79c34b[_0x1e10ae(0x1ba)],'bay':_0x79c34b[_0x1e10ae(0xe3)],'bin':_0x79c34b['bin'],'type':_0x79c34b['type'],'floorlevel':_0x79c34b[_0x1e10ae(0x144)],'maxProducts':_0x79c34b[_0x1e10ae(0xf7)],'unit':_0x79c34b['standard_unit'],'secondary_unit':_0x79c34b[_0x1e10ae(0xae)],'expiry_date':_0x79c34b['expiry_date'],'maxPerUnit':_0x79c34b[_0x1e10ae(0x172)],'batch_code':_0x79c34b[_0x1e10ae(0xe5)],'alertQTY':_0x79c34b[_0x1e10ae(0x14a)],'production_date':_0x79c34b[_0x1e10ae(0x14e)],'product_cat':_0x79c34b[_0x1e10ae(0x198)],'invoice':_0x79c34b[_0x1e10ae(0x13a)],'actual_qty':Math['abs'](_0x79c34b['actual_qty']),'actual_uom':_0x79c34b[_0x1e10ae(0xcb)]}),_0x18c39c;});Promise['all'](_0x199b2c)[_0x266833(0x105)](async _0x14cb54=>{var _0x256c68=_0x266833;try{for(const _0x3b55da of _0x14cb54){await _0x3b55da[_0x256c68(0x116)]();}const _0x3cf2c7=await master_shop['find'](),_0xe881f2=await email_settings[_0x256c68(0x135)](),_0x122aa6=await supervisor_settings['find']();var _0x214488=_0x4f1698[_0x256c68(0x13f)],_0x4a4f56='',_0x4e8f51;for(_0x4e8f51 in _0x214488){_0x4a4f56+=_0x256c68(0x109)+_0x256c68(0xd3)+_0x214488[_0x4e8f51][_0x256c68(0x138)]+_0x256c68(0x15a)+_0x256c68(0xd3)+_0x214488[_0x4e8f51][_0x256c68(0x1c3)]+'</td>'+_0x256c68(0xd3)+_0x214488[_0x4e8f51][_0x256c68(0x111)]+_0x256c68(0x15a)+_0x256c68(0xd3)+_0x214488[_0x4e8f51][_0x256c68(0x152)]+_0x256c68(0x15a)+_0x256c68(0xd3)+_0x214488[_0x4e8f51]['secondary_unit']+'</td>'+_0x256c68(0xd3)+_0x4f1698[_0x256c68(0x19c)]+_0x256c68(0x15a)+_0x256c68(0xd3)+_0x214488[_0x4e8f51]['room_name']+_0x256c68(0x15a)+_0x256c68(0xd3)+_0x214488[_0x4e8f51][_0x256c68(0x16f)]+_0x214488[_0x4e8f51][_0x256c68(0x1ba)]+_0x214488[_0x4e8f51][_0x256c68(0xe3)]+_0x214488[_0x4e8f51][_0x256c68(0x126)]+_0x214488[_0x4e8f51][_0x256c68(0xc9)][0x0]+_0x214488[_0x4e8f51][_0x256c68(0x144)]+_0x256c68(0x15a),_0x256c68(0xad);}let _0x4bdb85=nodemailer[_0x256c68(0xda)]({'host':_0xe881f2[_0x256c68(0x122)],'port':Number(_0xe881f2[_0x256c68(0x18a)]),'secure':![],'auth':{'user':_0xe881f2['email'],'pass':_0xe881f2[_0x256c68(0x118)]}}),_0x3177e3={'from':_0xe881f2[_0x256c68(0xac)],'to':_0x122aa6[0x0][_0x256c68(0xf8)],'subject':_0x256c68(0x1b1),'attachments':[{'filename':'Logo.png','path':__dirname+_0x256c68(0xe9)+_0x256c68(0x11e)+_0x3cf2c7[0x0]['image'],'cid':_0x256c68(0x151)}],'html':'<!DOCTYPE\x20html>'+_0x256c68(0x192)+_0x256c68(0xcc)+_0x256c68(0xc8)+_0x256c68(0x17a)+_0x256c68(0xc8)+_0x256c68(0x114)+'</div>'+_0x256c68(0xc8)+_0x256c68(0x186)+_0x3cf2c7[0x0]['site_title']+'\x20</h2>'+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x256c68(0xc8)+_0x256c68(0xbc)+'\x20Order\x20Number\x20:\x20'+_0x4f1698[_0x256c68(0x13a)]+'\x20'+_0x256c68(0x159)+_0x256c68(0x18e)+_0x4f1698[_0x256c68(0x128)]+'\x20'+_0x256c68(0xe0)+_0x256c68(0x107)+_0x256c68(0x1cc)+_0x256c68(0x182)+_0x256c68(0x1b7)+_0x256c68(0x109)+_0x256c68(0x19e)+_0x256c68(0x180)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x256c68(0xab)+_0x256c68(0x191)+_0x256c68(0x1a7)+_0x256c68(0x14f)+_0x256c68(0xf5)+_0x256c68(0xad)+_0x256c68(0x199)+_0x256c68(0x176)+'\x20'+_0x4a4f56+'\x20'+_0x256c68(0xb4)+_0x256c68(0xdb)+'<div>'+_0x256c68(0xb9)+_0x256c68(0xbe)+_0x3cf2c7[0x0][_0x256c68(0x153)]+_0x256c68(0x107)+_0x256c68(0x1cc)+_0x256c68(0x1cc)+_0x256c68(0xf2)};_0x4bdb85[_0x256c68(0x19f)](_0x3177e3,function(_0x2ab205,_0x34320f){var _0x51eef5=_0x256c68;_0x2ab205?(console['log'](_0x2ab205),console[_0x51eef5(0x169)](_0x51eef5(0x164))):console[_0x51eef5(0x169)](_0x51eef5(0x1cd));}),_0xbf248f[_0x256c68(0x175)](_0x256c68(0x194),_0x256c68(0x1ad)),_0x27f3da[_0x256c68(0x18f)](_0x256c68(0x115));}catch(_0x1b5b1c){console[_0x256c68(0xf0)](_0x1b5b1c),_0x27f3da[_0x256c68(0x1b5)](0x1f4)[_0x256c68(0xde)]({'error':_0x256c68(0xce)});}})[_0x266833(0x104)](_0x151f1d=>{var _0x49b5b0=_0x266833;console[_0x49b5b0(0xf0)](_0x151f1d),_0x27f3da[_0x49b5b0(0x1b5)](0x1f4)[_0x49b5b0(0xde)]({'error':'An\x20error\x20occurred.'});});}catch(_0x506f7c){console[_0x266833(0x169)](_0x506f7c);}}),router['get']('/preview/:id',auth,async(_0x32eca6,_0x1d5d27)=>{var _0x24134f=a0_0x20d45f;try{const {username:_0x402586,email:_0x3afb9b,role:_0x2d3dc4}=_0x32eca6[_0x24134f(0x171)],_0x230979=_0x32eca6[_0x24134f(0x171)],_0x48809f=await profile[_0x24134f(0x135)]({'email':_0x230979[_0x24134f(0xac)]}),_0x4e49ee=await master_shop['find'](),_0x50bf81=_0x32eca6['params']['id'],_0x4016c7=await purchases[_0x24134f(0x1cb)](_0x50bf81),_0x5c5c38=await warehouse[_0x24134f(0x11b)]([{'$match':{'name':_0x4016c7[_0x24134f(0x19c)],'room':_0x4016c7[_0x24134f(0x16c)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x24134f(0x141),'name':{'$first':_0x24134f(0x161)},'product_stock':{'$first':_0x24134f(0x1aa)},'bay':{'$first':_0x24134f(0x160)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x24134f(0x190)},'floorlevel':{'$first':_0x24134f(0x183)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x24134f(0xfb)},'product_code':{'$first':_0x24134f(0x11f)},'storage':{'$first':_0x24134f(0x110)},'rack':{'$first':_0x24134f(0x189)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x3dd37a=await customer[_0x24134f(0x106)]({});let _0x1b32a1;if(_0x230979['role']==_0x24134f(0x1b3)){const _0x179997=await staff[_0x24134f(0x135)]({'email':_0x230979[_0x24134f(0xac)]});_0x1b32a1=await warehouse[_0x24134f(0x11b)]([{'$match':{'status':_0x24134f(0x10c),'name':_0x179997[_0x24134f(0x1bc)]}},{'$group':{'_id':_0x24134f(0x11a),'name':{'$first':_0x24134f(0x11a)}}}]);}else _0x1b32a1=await warehouse['aggregate']([{'$match':{'status':_0x24134f(0x10c)}},{'$group':{'_id':_0x24134f(0x11a),'name':{'$first':_0x24134f(0x11a)}}}]);const _0x40cec2=await product[_0x24134f(0x106)]({}),_0x158f6e=await suppliers[_0x24134f(0x106)]({}),_0x15d0a3=BayBinSelected(_0x4016c7[_0x24134f(0x19c)],_0x4016c7[_0x24134f(0x16c)]);if(_0x4e49ee[0x0][_0x24134f(0x1b2)]==_0x24134f(0x142)){var _0x318dab=users['English'];console[_0x24134f(0x169)](_0x318dab);}else{if(_0x4e49ee[0x0]['language']==_0x24134f(0x150))var _0x318dab=users[_0x24134f(0x150)];else{if(_0x4e49ee[0x0][_0x24134f(0x1b2)]==_0x24134f(0xdd))var _0x318dab=users[_0x24134f(0xdd)];else{if(_0x4e49ee[0x0]['language']==_0x24134f(0x10b))var _0x318dab=users[_0x24134f(0x10b)];else{if(_0x4e49ee[0x0]['language']=='French')var _0x318dab=users[_0x24134f(0x158)];else{if(_0x4e49ee[0x0][_0x24134f(0x1b2)]=='Portuguese\x20(BR)')var _0x318dab=users[_0x24134f(0xe6)];else{if(_0x4e49ee[0x0][_0x24134f(0x1b2)]==_0x24134f(0xd0))var _0x318dab=users['Chinese'];else{if(_0x4e49ee[0x0][_0x24134f(0x1b2)]==_0x24134f(0x12e))var _0x318dab=users['Arabic'];}}}}}}}_0x1d5d27[_0x24134f(0x125)](_0x24134f(0x10d),{'success':_0x32eca6['flash'](_0x24134f(0x194)),'errors':_0x32eca6[_0x24134f(0x175)](_0x24134f(0x133)),'role':_0x230979,'profile':_0x48809f,'customer':_0x3dd37a,'warehouse':_0x1b32a1,'product':_0x5c5c38,'user':_0x4016c7,'master_shop':_0x4e49ee,'unit':_0x40cec2,'language':_0x318dab,'suppliers':_0x158f6e,'dataSelected':_0x15d0a3});}catch(_0x514501){console[_0x24134f(0x169)](_0x514501);}}),router['post'](a0_0x20d45f(0xaa),auth,async(_0x27eee1,_0x57f707)=>{var _0x5d832a=a0_0x20d45f;try{const _0x40a631=_0x27eee1['params']['id'],{invoice:_0x1f6c71,warehouse_name:_0x3a744c,Room_name:_0x2c5425}=_0x27eee1[_0x5d832a(0x12d)],_0x1e5d93=await warehouse[_0x5d832a(0x135)]({'name':_0x3a744c,'room':_0x2c5425}),_0x9f7ae5=await purchases[_0x5d832a(0x135)]({'invoice':_0x1f6c71});_0x9f7ae5[_0x5d832a(0x13f)][_0x5d832a(0x12b)](_0xb1881b=>{var _0x30be48=_0x5d832a,_0x334bd7=0x0;const _0x9a1bdd=_0x1e5d93[_0x30be48(0xf1)]['map'](_0x2c66f3=>{var _0x33b322=_0x30be48;_0x2c66f3['product_name']==_0xb1881b['product_name']&&_0x2c66f3[_0x33b322(0x144)]==_0xb1881b[_0x33b322(0x144)]&&_0x2c66f3[_0x33b322(0xc9)]==_0xb1881b[_0x33b322(0xc9)]&&_0x2c66f3[_0x33b322(0x126)]==_0xb1881b['bin']&&_0x2c66f3[_0x33b322(0xe3)]==_0xb1881b[_0x33b322(0xe3)]&&_0x2c66f3[_0x33b322(0x1ba)]==_0xb1881b[_0x33b322(0x1ba)]&&_0x2c66f3[_0x33b322(0x16f)]==_0xb1881b[_0x33b322(0x16f)]&&_0x2c66f3[_0x33b322(0xe4)]==_0xb1881b[_0x33b322(0xe4)]&&_0x2c66f3[_0x33b322(0xe5)]==_0xb1881b['batch_code']&&_0x2c66f3[_0x33b322(0x14e)]==_0xb1881b[_0x33b322(0x14e)]&&_0x2c66f3[_0x33b322(0x120)]==_0xb1881b['delivery_date']&&_0x2c66f3[_0x33b322(0xbd)]==_0xb1881b['delivery_code']&&(_0x2c66f3[_0x33b322(0xff)]=parseInt(_0x2c66f3[_0x33b322(0xff)])+parseInt(_0xb1881b[_0x33b322(0x111)]),_0x334bd7++);});_0x334bd7=='0'&&(_0x1e5d93['product_details']=_0x1e5d93[_0x30be48(0xf1)][_0x30be48(0x1b6)]({'product_name':_0xb1881b['product_name'],'product_stock':_0xb1881b['quantity'],'primary_code':_0xb1881b[_0x30be48(0xea)],'secondary_code':_0xb1881b[_0x30be48(0x1ac)],'product_code':_0xb1881b[_0x30be48(0x1c3)],'storage':_0xb1881b['storage'],'rack':_0xb1881b['rack'],'bay':_0xb1881b[_0x30be48(0xe3)],'bin':_0xb1881b[_0x30be48(0x126)],'type':_0xb1881b[_0x30be48(0xc9)],'floorlevel':_0xb1881b[_0x30be48(0x144)],'maxProducts':_0xb1881b[_0x30be48(0xf7)],'unit':_0xb1881b[_0x30be48(0x152)],'secondary_unit':_0xb1881b[_0x30be48(0xae)],'expiry_date':_0xb1881b[_0x30be48(0xe4)],'maxPerUnit':_0xb1881b[_0x30be48(0x172)],'batch_code':_0xb1881b[_0x30be48(0xe5)],'alertQTY':_0xb1881b[_0x30be48(0x14a)],'production_date':_0xb1881b[_0x30be48(0x14e)],'delivery_date':_0xb1881b[_0x30be48(0x120)],'delivery_code':_0xb1881b[_0x30be48(0xbd)]}));}),await _0x1e5d93['save'](),_0x9f7ae5['finalize']=_0x5d832a(0xc4);const _0xec5baa=await _0x9f7ae5[_0x5d832a(0x116)]();_0x27eee1[_0x5d832a(0x175)](_0x5d832a(0x194),_0x5d832a(0x1a2)),_0x57f707['redirect']('/all_purchases/view');}catch(_0x5c08f0){console['log'](_0x5c08f0);}}),router[a0_0x20d45f(0xe2)]('/view/:id',auth,async(_0x8e9b83,_0x2b18c7)=>{var _0x5eb53c=a0_0x20d45f;try{const {username:_0x418d87,email:_0x18b27c,role:_0x54d2ee}=_0x8e9b83['user'],_0x4f358d=_0x8e9b83[_0x5eb53c(0x171)],_0xda0e1a=await profile[_0x5eb53c(0x135)]({'email':_0x4f358d[_0x5eb53c(0xac)]}),_0x549b85=await master_shop['find'](),_0x20f50c=_0x8e9b83[_0x5eb53c(0x15f)]['id'],_0x7c9ac=await purchases[_0x5eb53c(0x1cb)](_0x20f50c),_0x3bd649=await suppliers[_0x5eb53c(0x106)]({});let _0x2a9da2;if(_0x4f358d['role']=='staff'){const _0x6f4139=await staff[_0x5eb53c(0x135)]({'email':_0x4f358d[_0x5eb53c(0xac)]});_0x2a9da2=await warehouse[_0x5eb53c(0x106)]({'status':_0x5eb53c(0x10c),'name':_0x6f4139[_0x5eb53c(0x1bc)],'warehouse_category':_0x5eb53c(0xc6)});}else _0x2a9da2=await warehouse[_0x5eb53c(0x11b)]([{'$match':{'status':_0x5eb53c(0x10c),'warehouse_category':_0x5eb53c(0xc6)}},{'$group':{'_id':_0x5eb53c(0x11a),'name':{'$first':_0x5eb53c(0x11a)}}}]);const _0x3ebab8=await product[_0x5eb53c(0x106)]({}),_0x454709=BayBinSelected(_0x7c9ac[_0x5eb53c(0x19c)],_0x7c9ac['room']);let _0xf47e0d=new Date(_0x7c9ac[_0x5eb53c(0xe4)]),_0x57453a=('0'+_0xf47e0d[_0x5eb53c(0x149)]())['slice'](-0x2),_0x408152=('0'+(_0xf47e0d[_0x5eb53c(0x17b)]()+0x1))[_0x5eb53c(0x1bb)](-0x2),_0x443de2=_0xf47e0d[_0x5eb53c(0x17d)](),_0x57a3a7=_0x443de2+'-'+_0x408152+'-'+_0x57453a;if(_0x549b85[0x0][_0x5eb53c(0x1b2)]==_0x5eb53c(0x142)){var _0x234edf=users[_0x5eb53c(0x155)];console[_0x5eb53c(0x169)](_0x234edf);}else{if(_0x549b85[0x0]['language']==_0x5eb53c(0x150))var _0x234edf=users[_0x5eb53c(0x150)];else{if(_0x549b85[0x0][_0x5eb53c(0x1b2)]==_0x5eb53c(0xdd))var _0x234edf=users['German'];else{if(_0x549b85[0x0][_0x5eb53c(0x1b2)]==_0x5eb53c(0x10b))var _0x234edf=users['Spanish'];else{if(_0x549b85[0x0][_0x5eb53c(0x1b2)]==_0x5eb53c(0x158))var _0x234edf=users['French'];else{if(_0x549b85[0x0][_0x5eb53c(0x1b2)]==_0x5eb53c(0xc5))var _0x234edf=users[_0x5eb53c(0xe6)];else{if(_0x549b85[0x0]['language']=='Chinese')var _0x234edf=users[_0x5eb53c(0xd0)];else{if(_0x549b85[0x0][_0x5eb53c(0x1b2)]=='Arabic\x20(ae)')var _0x234edf=users[_0x5eb53c(0x154)];}}}}}}}_0x2b18c7[_0x5eb53c(0x125)](_0x5eb53c(0xd9),{'success':_0x8e9b83[_0x5eb53c(0x175)](_0x5eb53c(0x194)),'errors':_0x8e9b83[_0x5eb53c(0x175)](_0x5eb53c(0x133)),'role':_0x4f358d,'profile':_0xda0e1a,'purchases':_0x7c9ac,'suppliers':_0x3bd649,'warehouse':_0x2a9da2,'product':_0x3ebab8,'master_shop':_0x549b85,'language':_0x234edf,'ed_fullDate':_0x57a3a7,'dataSelected':_0x454709});}catch(_0x2c7a69){console[_0x5eb53c(0x169)](_0x2c7a69);}}),router[a0_0x20d45f(0x1c0)](a0_0x20d45f(0xeb),auth,async(_0x203dbe,_0x83f8f5)=>{var _0xd9055b=a0_0x20d45f;try{const _0x55d2a8=_0x203dbe[_0xd9055b(0x15f)]['id'],_0x149aa2=await purchases[_0xd9055b(0x135)]({'_id':_0x203dbe[_0xd9055b(0x15f)]['id']}),_0x372c45=await warehouse['findOne']({'name':_0x149aa2[_0xd9055b(0x19c)],'room':_0x149aa2['room']});_0x149aa2[_0xd9055b(0x13f)][_0xd9055b(0x12b)](_0x4a1499=>{var _0x1fe529=_0xd9055b;const _0xdd2c68=_0x372c45[_0x1fe529(0xf1)][_0x1fe529(0xdf)](_0x44df4b=>{var _0x4bd63e=_0x1fe529;_0x44df4b['product_name']==_0x4a1499[_0x4bd63e(0x138)]&&_0x44df4b[_0x4bd63e(0x144)]==_0x4a1499[_0x4bd63e(0x144)]&&_0x44df4b[_0x4bd63e(0xc9)]==_0x4a1499[_0x4bd63e(0xc9)]&&_0x44df4b[_0x4bd63e(0x126)]==_0x4a1499[_0x4bd63e(0x126)]&&_0x44df4b[_0x4bd63e(0xe3)]==_0x4a1499['bay']&&_0x44df4b[_0x4bd63e(0x1ba)]==_0x4a1499[_0x4bd63e(0x1ba)]&&_0x44df4b[_0x4bd63e(0x16f)]==_0x4a1499[_0x4bd63e(0x16f)]&&(_0x44df4b[_0x4bd63e(0xff)]=parseInt(_0x44df4b['product_stock'])-parseInt(_0x4a1499[_0x4bd63e(0x111)]));});}),await _0x372c45[_0xd9055b(0x116)]();const {invoice:_0xc77c70,suppliers:_0x2f229c,date:_0xbf9331,warehouse_name:_0xfe63cf,prod_name:_0x55729e,prod_code:_0x203edc,prod_qty:_0xbb523d,prod_unit:_0x5267c6,prod_secondunit:_0x535d9d,prod_level:_0x295e92,prod_isle:_0x2e97d7,prod_pallet:_0xf24672,note:_0x17f507,expiry_date:_0x2ea0d2,batch_code:_0x14ed10,paid_amount:_0x488b6b,due_amount:_0x2af899,Room_name:_0x5686d4,primary_code:_0x267d0f,secondary_code:_0x355115,PO_number:_0x17eb2f,JO_number:_0x33b24d}=_0x203dbe[_0xd9055b(0x12d)];if(typeof _0x55729e==_0xd9055b(0x14c))var _0x2df50f=[_0x203dbe['body']['prod_name']],_0x3458a9=[_0x203dbe[_0xd9055b(0x12d)]['prod_code']],_0x256fa6=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x1c7)]],_0x2389de=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x10f)]],_0x4ed275=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xba)]],_0x4b7eb8=[_0x203dbe['body'][_0xd9055b(0x1b0)]],_0x1cc79f=[_0x203dbe[_0xd9055b(0x12d)]['prod_isle']],_0x5673fc=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x1c2)]],_0x15bdb7=[_0x203dbe[_0xd9055b(0x12d)]['primary_code']],_0x3284f=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x1ac)]],_0x243ff9=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xd5)]],_0x19b1bb=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xe5)]],_0x565957=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xe4)]],_0x6d8252=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x16f)]],_0xbbf94c=[_0x203dbe[_0xd9055b(0x12d)]['rak']],_0xbf3b51=[_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xc9)]];else var _0x2df50f=[..._0x203dbe[_0xd9055b(0x12d)]['prod_name']],_0x3458a9=[..._0x203dbe['body'][_0xd9055b(0x112)]],_0x256fa6=[..._0x203dbe['body'][_0xd9055b(0x1c7)]],_0x2389de=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x10f)]],_0x4ed275=[..._0x203dbe['body']['prod_secondunit']],_0x4b7eb8=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x1b0)]],_0x1cc79f=[..._0x203dbe[_0xd9055b(0x12d)]['prod_isle']],_0x5673fc=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x1c2)]],_0x15bdb7=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xea)]],_0x3284f=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x1ac)]],_0x243ff9=[..._0x203dbe['body'][_0xd9055b(0xd5)]],_0x19b1bb=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xe5)]],_0x565957=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xe4)]],_0x6d8252=[..._0x203dbe[_0xd9055b(0x12d)]['storage']],_0xbbf94c=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x13b)]],_0xbf3b51=[..._0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0xc9)]];const _0x2a69c9=_0x2df50f[_0xd9055b(0xdf)](_0x532728=>{return _0x532728={'product_name':_0x532728};});_0x3458a9['forEach']((_0x37b904,_0x37ad76)=>{var _0x2705db=_0xd9055b;_0x2a69c9[_0x37ad76][_0x2705db(0x1c3)]=_0x37b904;}),_0x256fa6[_0xd9055b(0x12b)]((_0x49a23f,_0xa2d844)=>{var _0x3e19b6=_0xd9055b;_0x2a69c9[_0xa2d844][_0x3e19b6(0x111)]=_0x49a23f;}),_0x2389de[_0xd9055b(0x12b)]((_0x4fb877,_0x34db1e)=>{var _0xcc4a24=_0xd9055b;_0x2a69c9[_0x34db1e][_0xcc4a24(0x152)]=_0x4fb877;}),_0x4ed275[_0xd9055b(0x12b)]((_0x46a3df,_0x14808b)=>{_0x2a69c9[_0x14808b]['secondary_unit']=_0x46a3df;}),_0x4b7eb8['forEach']((_0x298be9,_0x4d740b)=>{var _0x21fc27=_0xd9055b;_0x2a69c9[_0x4d740b][_0x21fc27(0xe3)]=_0x298be9;}),_0x1cc79f[_0xd9055b(0x12b)]((_0x4ea03c,_0x121cc1)=>{var _0x151d2f=_0xd9055b;_0x2a69c9[_0x121cc1][_0x151d2f(0x126)]=_0x4ea03c;}),_0x5673fc[_0xd9055b(0x12b)]((_0x4811ec,_0x151027)=>{var _0x285e72=_0xd9055b;_0x2a69c9[_0x151027][_0x285e72(0x144)]=_0x4811ec;}),_0x15bdb7[_0xd9055b(0x12b)]((_0x199e5a,_0x1d6e39)=>{var _0x517da7=_0xd9055b;_0x2a69c9[_0x1d6e39][_0x517da7(0xea)]=_0x199e5a;}),_0x3284f[_0xd9055b(0x12b)]((_0x5aa571,_0x48d5ff)=>{var _0x3c12df=_0xd9055b;_0x2a69c9[_0x48d5ff][_0x3c12df(0x1ac)]=_0x5aa571;}),_0x243ff9['forEach']((_0x33276a,_0xa037c5)=>{var _0x1e0f36=_0xd9055b;_0x2a69c9[_0xa037c5][_0x1e0f36(0xf7)]=_0x33276a;}),_0x19b1bb[_0xd9055b(0x12b)]((_0x5e8e70,_0x31ef95)=>{var _0x31bd73=_0xd9055b;_0x2a69c9[_0x31ef95][_0x31bd73(0xe5)]=_0x5e8e70;}),_0x565957['forEach']((_0x2c2f3c,_0x1d4e69)=>{_0x2a69c9[_0x1d4e69]['expiry_date']=_0x2c2f3c;}),_0xbf3b51[_0xd9055b(0x12b)]((_0x30c19a,_0x47c32c)=>{_0x2a69c9[_0x47c32c]['type']=_0x30c19a;}),_0x6d8252[_0xd9055b(0x12b)]((_0xd591b,_0x5ae8f2)=>{_0x2a69c9[_0x5ae8f2]['storage']=_0xd591b;}),_0xbbf94c[_0xd9055b(0x12b)]((_0x4901a4,_0x3045ff)=>{var _0x451522=_0xd9055b;_0x2a69c9[_0x3045ff][_0x451522(0x1ba)]=_0x4901a4;});const _0x3096eb=_0x2a69c9[_0xd9055b(0x127)](_0x23ade8=>_0x23ade8[_0xd9055b(0x111)]!=='0'&&_0x23ade8['quantity']!=='');_0x149aa2[_0xd9055b(0x13a)]=_0xc77c70,_0x149aa2[_0xd9055b(0x18b)]=_0x2f229c,_0x149aa2['date']=_0xbf9331,_0x149aa2[_0xd9055b(0x19c)]=_0xfe63cf,_0x149aa2[_0xd9055b(0x13f)]=_0x3096eb,_0x149aa2[_0xd9055b(0xb6)]=_0x17f507,_0x149aa2['paid_amount']=_0x488b6b,_0x149aa2[_0xd9055b(0x101)]=_0x2af899,_0x149aa2[_0xd9055b(0x16c)]=_0x5686d4,_0x149aa2[_0xd9055b(0x163)]=_0x17eb2f,_0x149aa2[_0xd9055b(0x1a5)]=_0x33b24d;const _0x50111b=await _0x149aa2['save'](),_0x1cd0e6=await warehouse['findOne']({'name':_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x19c)],'room':_0x203dbe['body']['Room_name']});_0x149aa2['product'][_0xd9055b(0x12b)](_0x449b91=>{var _0x3463cb=_0xd9055b,_0x5ace7f=0x0;const _0x18a66d=_0x1cd0e6[_0x3463cb(0xf1)][_0x3463cb(0xdf)](_0x3e8318=>{var _0x13d4fd=_0x3463cb;_0x3e8318[_0x13d4fd(0x138)]==_0x449b91[_0x13d4fd(0x138)]&&_0x3e8318[_0x13d4fd(0x144)]==_0x449b91[_0x13d4fd(0x144)]&&_0x3e8318['type']==_0x449b91['type']&&_0x3e8318[_0x13d4fd(0x126)]==_0x449b91[_0x13d4fd(0x126)]&&_0x3e8318[_0x13d4fd(0xe3)]==_0x449b91['bay']&&_0x3e8318[_0x13d4fd(0x1ba)]==_0x449b91[_0x13d4fd(0x1ba)]&&_0x3e8318[_0x13d4fd(0x16f)]==_0x449b91[_0x13d4fd(0x16f)]&&(_0x3e8318[_0x13d4fd(0xff)]=parseInt(_0x3e8318[_0x13d4fd(0xff)])+parseInt(_0x449b91[_0x13d4fd(0x111)]),_0x5ace7f++);});_0x5ace7f=='0'&&(_0x1cd0e6[_0x3463cb(0xf1)]=_0x1cd0e6[_0x3463cb(0xf1)][_0x3463cb(0x1b6)]({'product_name':_0x449b91[_0x3463cb(0x138)],'product_stock':_0x449b91['quantity'],'primary_code':_0x449b91[_0x3463cb(0xea)],'secondary_code':_0x449b91[_0x3463cb(0x1ac)],'product_code':_0x449b91['product_code'],'storage':_0x449b91[_0x3463cb(0x16f)],'rack':_0x449b91[_0x3463cb(0x1ba)],'bay':_0x449b91[_0x3463cb(0xe3)],'bin':_0x449b91[_0x3463cb(0x126)],'type':_0x449b91['type'],'floorlevel':_0x449b91[_0x3463cb(0x144)],'maxProducts':_0x449b91['maxStocks'],'unit':_0x449b91[_0x3463cb(0x152)],'secondary_unit':_0x449b91[_0x3463cb(0xae)],'expiry_date':_0x449b91[_0x3463cb(0xe4)]}));}),await _0x1cd0e6['save']();const _0x55fa25=await s_payment_data['findOne']({'invoice':_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x13a)]});if(_0x55fa25===null){}else console[_0xd9055b(0x169)](_0xd9055b(0x18b),_0x55fa25,_0x203dbe[_0xd9055b(0x12d)]['invoice']),_0x55fa25['suppliers']=_0x203dbe[_0xd9055b(0x12d)][_0xd9055b(0x18b)],await _0x55fa25[_0xd9055b(0x116)]();_0x203dbe[_0xd9055b(0x175)](_0xd9055b(0x194),_0xd9055b(0xbf)),_0x83f8f5['redirect'](_0xd9055b(0xc7));}catch(_0x157a6e){console[_0xd9055b(0x169)](_0x157a6e);}}),router[a0_0x20d45f(0x1c0)](a0_0x20d45f(0x1c1),auth,async(_0x708b41,_0x565ce3)=>{var _0x1a3ee4=a0_0x20d45f;try{const _0x5e2c50=_0x708b41[_0x1a3ee4(0x15f)]['id'],{invoice:_0x134248,suppliers:_0x4a09fc,payable:_0x41ce2b,due_amount:_0x509638}=_0x708b41[_0x1a3ee4(0x12d)],_0x223421=await purchases[_0x1a3ee4(0x1cb)](_0x5e2c50);var _0x36be07=_0x41ce2b-_0x509638;_0x223421[_0x1a3ee4(0x174)]=parseFloat(_0x223421[_0x1a3ee4(0x174)])+parseFloat(_0x509638),_0x223421['due_amount']=_0x36be07;const _0x5d3f02=await _0x223421[_0x1a3ee4(0x116)]();console['log'](_0x5d3f02);const _0x52e990=await s_payment_data['findOne']({'invoice':_0x134248});_0x52e990[_0x1a3ee4(0x1a6)]=_0x36be07,await _0x52e990[_0x1a3ee4(0x116)]();let _0x42201a=new Date(),_0x3b360b=('0'+_0x42201a[_0x1a3ee4(0x149)]())[_0x1a3ee4(0x1bb)](-0x2),_0x5212bf=('0'+(_0x42201a[_0x1a3ee4(0x17b)]()+0x1))[_0x1a3ee4(0x1bb)](-0x2),_0x3a8250=_0x42201a['getFullYear'](),_0x507393=_0x3a8250+'-'+_0x5212bf+'-'+_0x3b360b;const _0x3753d3=new suppliers_payment({'invoice':_0x134248,'date':_0x3a8250+'-'+_0x5212bf+'-'+_0x3b360b,'suppliers':_0x4a09fc,'reason':_0x1a3ee4(0x197),'amount':_0x509638}),_0x1997ec=await _0x3753d3[_0x1a3ee4(0x116)]();_0x708b41[_0x1a3ee4(0x175)](_0x1a3ee4(0x194),_0x1a3ee4(0xd6)),_0x565ce3[_0x1a3ee4(0x18f)](_0x1a3ee4(0xc7));}catch(_0x11b70e){console[_0x1a3ee4(0x169)](_0x11b70e);}}),router['get'](a0_0x20d45f(0xb7),auth,async(_0x1f99c2,_0x33168a)=>{var _0x426fa6=a0_0x20d45f;try{const {username:_0x30ca92,email:_0x5142a0,role:_0x353dbf}=_0x1f99c2[_0x426fa6(0x171)],_0x3443c3=_0x1f99c2[_0x426fa6(0x171)],_0x101f1b=await profile['findOne']({'email':_0x3443c3[_0x426fa6(0xac)]}),_0x183531=await master_shop[_0x426fa6(0x106)]();console['log'](_0x426fa6(0xc3),_0x183531);const _0x366228=_0x1f99c2[_0x426fa6(0x15f)]['id'],_0x448893=await purchases[_0x426fa6(0x1cb)](_0x366228);console[_0x426fa6(0x169)](_0x448893);const _0xba66f0=await suppliers[_0x426fa6(0x135)]({'name':_0x448893[_0x426fa6(0x18b)]});console[_0x426fa6(0x169)](_0xba66f0);if(_0x183531[0x0][_0x426fa6(0x1b2)]==_0x426fa6(0x142)){var _0x186a99=users[_0x426fa6(0x155)];console[_0x426fa6(0x169)](_0x186a99);}else{if(_0x183531[0x0][_0x426fa6(0x1b2)]==_0x426fa6(0x150))var _0x186a99=users['Hindi'];else{if(_0x183531[0x0][_0x426fa6(0x1b2)]==_0x426fa6(0xdd))var _0x186a99=users['German'];else{if(_0x183531[0x0]['language']==_0x426fa6(0x10b))var _0x186a99=users[_0x426fa6(0x10b)];else{if(_0x183531[0x0][_0x426fa6(0x1b2)]==_0x426fa6(0x158))var _0x186a99=users[_0x426fa6(0x158)];else{if(_0x183531[0x0][_0x426fa6(0x1b2)]=='Portuguese\x20(BR)')var _0x186a99=users[_0x426fa6(0xe6)];else{if(_0x183531[0x0][_0x426fa6(0x1b2)]=='Chinese')var _0x186a99=users['Chinese'];else{if(_0x183531[0x0][_0x426fa6(0x1b2)]==_0x426fa6(0x12e))var _0x186a99=users[_0x426fa6(0x154)];}}}}}}}_0x33168a[_0x426fa6(0x125)](_0x426fa6(0xaf),{'success':_0x1f99c2['flash']('success'),'errors':_0x1f99c2['flash'](_0x426fa6(0x133)),'role':_0x3443c3,'profile':_0x101f1b,'master_shop':_0x183531,'supplier':_0xba66f0,'purchase':_0x448893,'language':_0x186a99});}catch(_0x5e5375){console[_0x426fa6(0x169)](_0x5e5375);}}),router[a0_0x20d45f(0xe2)](a0_0x20d45f(0xfe),auth,async(_0x5c5a17,_0x160e0d)=>{var _0x5bf341=a0_0x20d45f;try{const {username:_0xb42a34,email:_0x435d62,role:_0x12183f}=_0x5c5a17['user'],_0x2aac97=_0x5c5a17[_0x5bf341(0x171)],_0x1d29e3=await profile[_0x5bf341(0x135)]({'email':_0x2aac97[_0x5bf341(0xac)]}),_0x4d86cc=await master_shop['find']();console[_0x5bf341(0x169)](_0x5bf341(0xc3),_0x4d86cc);const _0x308a7b=_0x5c5a17[_0x5bf341(0x15f)]['id'];console[_0x5bf341(0x169)](_0x308a7b);const _0x23a64b=await purchases[_0x5bf341(0x1cb)](_0x308a7b);console[_0x5bf341(0x169)](_0x5bf341(0x19b),_0x23a64b);const _0x2d2090=await product['find']({}),_0x3d078e=await warehouse['aggregate']([{'$match':{'name':_0x23a64b[_0x5bf341(0x19c)],'room':_0x23a64b['room'],'warehouse_category':_0x5bf341(0xc6)}},{'$unwind':_0x5bf341(0x146)},{'$group':{'_id':_0x5bf341(0x141),'name':{'$first':_0x5bf341(0x161)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5bf341(0x12f)},'type':{'$first':_0x5bf341(0x190)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5bf341(0xfb)},'product_code':{'$first':_0x5bf341(0x11f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x5bf341(0x11b)]([{'$match':{'status':_0x5bf341(0x10c),'name':'Return\x20Goods','warehouse_category':_0x5bf341(0xc6)}},{'$group':{'_id':'$name','name':{'$first':_0x5bf341(0x11a)}}},{'$sort':{'name':0x1}}]),console[_0x5bf341(0x169)](_0x5bf341(0xd7),_0x3d078e);if(_0x4d86cc[0x0]['language']==_0x5bf341(0x142)){var _0x33b100=users['English'];console[_0x5bf341(0x169)](_0x33b100);}else{if(_0x4d86cc[0x0]['language']=='Hindi')var _0x33b100=users[_0x5bf341(0x150)];else{if(_0x4d86cc[0x0][_0x5bf341(0x1b2)]==_0x5bf341(0xdd))var _0x33b100=users[_0x5bf341(0xdd)];else{if(_0x4d86cc[0x0][_0x5bf341(0x1b2)]==_0x5bf341(0x10b))var _0x33b100=users[_0x5bf341(0x10b)];else{if(_0x4d86cc[0x0][_0x5bf341(0x1b2)]==_0x5bf341(0x158))var _0x33b100=users[_0x5bf341(0x158)];else{if(_0x4d86cc[0x0]['language']==_0x5bf341(0xc5))var _0x33b100=users[_0x5bf341(0xe6)];else{if(_0x4d86cc[0x0][_0x5bf341(0x1b2)]==_0x5bf341(0xd0))var _0x33b100=users[_0x5bf341(0xd0)];else{if(_0x4d86cc[0x0]['language']==_0x5bf341(0x12e))var _0x33b100=users[_0x5bf341(0x154)];}}}}}}}_0x160e0d[_0x5bf341(0x125)](_0x5bf341(0xb0),{'success':_0x5c5a17[_0x5bf341(0x175)]('success'),'errors':_0x5c5a17[_0x5bf341(0x175)](_0x5bf341(0x133)),'role':_0x2aac97,'profile':_0x1d29e3,'user':_0x23a64b,'stock':_0x3d078e,'master_shop':_0x4d86cc,'product':_0x2d2090,'language':_0x33b100,'warehouse':warehouse_data});}catch(_0xa3d335){console['log'](_0xa3d335);}}),router[a0_0x20d45f(0x1c0)]('/view/return_purchase/:id',auth,async(_0x529d0b,_0x4d4615)=>{var _0x5cf89e=a0_0x20d45f;try{const {invoice:_0x389330,date:_0x135093,warehouse_name:_0x368823,Room_name:_0x2c3869,product_name:_0x142117,purchase_quantity:_0x2440c0,stocks:_0x32e787,return_qty:_0x96a6d9,note:_0x462b7b,level:_0x57f95d,isle:_0x33078c,pallet:_0x2e97e7,to_warehouse_name:_0x5bb2c3,to_Room_name:_0x51703f}=_0x529d0b[_0x5cf89e(0x12d)],_0x33eaa0=await purchases[_0x5cf89e(0x135)]({'_id':_0x529d0b[_0x5cf89e(0x15f)]['id']}),_0x5c31d5=await warehouse[_0x5cf89e(0x135)]({'name':_0x368823,'room':_0x2c3869});if(typeof _0x142117==_0x5cf89e(0x14c))var _0x42fbf9=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x138)]],_0x3dc994=[_0x529d0b[_0x5cf89e(0x12d)]['purchase_quantity']],_0x399b76=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x17c)]],_0x192a36=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1b9)]],_0xaf4741=[_0x529d0b[_0x5cf89e(0x12d)]['level']],_0x3ad41b=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x16d)]],_0x40501e=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x11d)]],_0x113027=[_0x529d0b[_0x5cf89e(0x12d)]['types']],_0x1798b4=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1ab)]],_0x2e31b8=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1c4)]],_0x3cacbb=[_0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1a9)]];else var _0x42fbf9=[..._0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x138)]],_0x3dc994=[..._0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1ca)]],_0x399b76=[..._0x529d0b['body'][_0x5cf89e(0x17c)]],_0x192a36=[..._0x529d0b['body'][_0x5cf89e(0x1b9)]],_0xaf4741=[..._0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x143)]],_0x3ad41b=[..._0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x16d)]],_0x40501e=[..._0x529d0b['body'][_0x5cf89e(0x11d)]],_0x113027=[..._0x529d0b[_0x5cf89e(0x12d)]['types']],_0x1798b4=[..._0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1ab)]],_0x2e31b8=[..._0x529d0b[_0x5cf89e(0x12d)][_0x5cf89e(0x1c4)]],_0x3cacbb=[..._0x529d0b['body']['secondary_code_hide']];const _0x5de76c=_0x42fbf9[_0x5cf89e(0xdf)](_0x3ec84f=>{return _0x3ec84f={'product_name':_0x3ec84f};});_0x3dc994[_0x5cf89e(0x12b)]((_0xca1d75,_0x457448)=>{var _0x2c65cc=_0x5cf89e;_0x5de76c[_0x457448][_0x2c65cc(0x1ca)]=_0xca1d75;}),_0x399b76[_0x5cf89e(0x12b)]((_0x342e26,_0x29e10d)=>{var _0x4d3971=_0x5cf89e;_0x5de76c[_0x29e10d][_0x4d3971(0x1a4)]=_0x342e26;}),_0x192a36[_0x5cf89e(0x12b)]((_0x4199fb,_0x23d230)=>{var _0x2684df=_0x5cf89e;_0x5de76c[_0x23d230][_0x2684df(0x1b9)]=_0x4199fb;}),_0xaf4741[_0x5cf89e(0x12b)]((_0x811b6f,_0x161749)=>{_0x5de76c[_0x161749]['bay']=_0x811b6f;}),_0x3ad41b[_0x5cf89e(0x12b)]((_0x5517dc,_0x447a9e)=>{var _0x5e6a8d=_0x5cf89e;_0x5de76c[_0x447a9e][_0x5e6a8d(0x126)]=_0x5517dc;}),_0x40501e[_0x5cf89e(0x12b)]((_0x4f9e60,_0x37f138)=>{_0x5de76c[_0x37f138]['floorlevel']=_0x4f9e60;}),_0x113027[_0x5cf89e(0x12b)]((_0x45ae4e,_0x1e7591)=>{var _0x828ca1=_0x5cf89e;_0x5de76c[_0x1e7591][_0x828ca1(0xc9)]=_0x45ae4e;}),_0x1798b4[_0x5cf89e(0x12b)]((_0x3f97e3,_0x2d546e)=>{var _0x28f700=_0x5cf89e;_0x5de76c[_0x2d546e][_0x28f700(0x1c3)]=_0x3f97e3;}),_0x2e31b8[_0x5cf89e(0x12b)]((_0x493bea,_0x4e3afe)=>{var _0x3c2ca2=_0x5cf89e;_0x5de76c[_0x4e3afe][_0x3c2ca2(0xea)]=_0x493bea;}),_0x3cacbb[_0x5cf89e(0x12b)]((_0x59d32c,_0x45b92e)=>{_0x5de76c[_0x45b92e]['secondary_code']=_0x59d32c;}),_0x33eaa0[_0x5cf89e(0x13f)][_0x5cf89e(0x12b)](_0x1778c0=>{var _0x185706=_0x5cf89e;const _0x2aa837=_0x5c31d5[_0x185706(0xf1)]['map'](_0x5c3326=>{var _0xa2534=_0x185706;_0x5c3326[_0xa2534(0x138)]==_0x1778c0[_0xa2534(0x138)]&&_0x5c3326[_0xa2534(0x144)]==_0x1778c0[_0xa2534(0x144)]&&_0x5c3326[_0xa2534(0xc9)]==_0x1778c0['type']&&_0x5c3326[_0xa2534(0x126)]==_0x1778c0[_0xa2534(0x126)]&&_0x5c3326[_0xa2534(0xe3)]==_0x1778c0[_0xa2534(0xe3)]&&_0x5c3326[_0xa2534(0x1ba)]==_0x1778c0[_0xa2534(0x1ba)]&&_0x5c3326[_0xa2534(0x16f)]==_0x1778c0[_0xa2534(0x16f)]&&(console[_0xa2534(0x169)](parseInt(_0x5c3326['product_stock'])+_0xa2534(0x102)+parseInt(_0x1778c0[_0xa2534(0x111)])),_0x5c3326['product_stock']=parseInt(_0x5c3326[_0xa2534(0xff)])+parseInt(_0x1778c0[_0xa2534(0x111)]));});}),await _0x5c31d5['save']();const _0x31ab7d=_0x5de76c[_0x5cf89e(0x127)](_0x5b3ae5=>_0x5b3ae5['return_qty']!=='0'&&_0x5b3ae5[_0x5cf89e(0x1b9)]!=='');var _0x1c036a=0x0;_0x31ab7d['forEach'](_0x24d886=>{var _0x24134e=_0x5cf89e;console[_0x24134e(0x169)](_0x24134e(0xf3),_0x24d886),(parseInt(_0x24d886[_0x24134e(0x1ca)])<parseInt(_0x24d886[_0x24134e(0x1b9)])||parseInt(_0x24d886[_0x24134e(0x1a4)])<parseInt(_0x24d886['return_qty']))&&_0x1c036a++;});if(_0x1c036a!=0x0)return _0x529d0b[_0x5cf89e(0x175)](_0x5cf89e(0x133),_0x5cf89e(0x185)),_0x4d4615[_0x5cf89e(0x18f)](_0x5cf89e(0xfd));const _0x5b41c4=new purchases_return({'invoice':_0x389330,'suppliers':_0x529d0b['body'][_0x5cf89e(0x18b)],'date':_0x135093,'warehouse_name':_0x368823,'return_product':_0x31ab7d,'note':_0x462b7b,'room':_0x2c3869,'to_warehouse_name':_0x5bb2c3,'to_room':_0x51703f}),_0x1385ff=await _0x5b41c4['save']();console[_0x5cf89e(0x169)](_0x5b41c4);const _0x9c1a3a=await purchases_return[_0x5cf89e(0x135)]({'invoice':_0x389330}),_0x32596a=await warehouse['findOne']({'name':_0x5bb2c3,'room':_0x51703f});_0x9c1a3a[_0x5cf89e(0x1a8)]['forEach'](_0x1e0093=>{var _0x23847a=_0x5cf89e,_0x16c8ff=0x0;const _0x19ded7=_0x32596a['product_details']['map'](_0x2114cd=>{var _0xebb6f0=a0_0x2053;_0x2114cd[_0xebb6f0(0x138)]==_0x1e0093['product_name']&&_0x2114cd[_0xebb6f0(0x144)]==_0x1e0093[_0xebb6f0(0x144)]&&_0x2114cd[_0xebb6f0(0xc9)]==_0x1e0093[_0xebb6f0(0xc9)]&&_0x2114cd[_0xebb6f0(0x126)]==_0x1e0093['bin']&&_0x2114cd[_0xebb6f0(0xe3)]==_0x1e0093[_0xebb6f0(0xe3)]&&(_0x2114cd[_0xebb6f0(0xff)]=parseInt(_0x2114cd[_0xebb6f0(0xff)])-parseInt(_0x1e0093[_0xebb6f0(0x1b9)]),_0x16c8ff++);});_0x16c8ff=='0'&&(_0x32596a[_0x23847a(0xf1)]=_0x32596a['product_details']['concat']({'product_name':_0x1e0093['product_name'],'product_stock':_0x1e0093[_0x23847a(0x1b9)],'primary_code':_0x1e0093[_0x23847a(0xea)],'secondary_code':_0x1e0093['secondary_code'],'product_code':_0x1e0093[_0x23847a(0x1c3)],'storage':_0x1e0093[_0x23847a(0x16f)],'rack':_0x1e0093['rack'],'bay':_0x1e0093[_0x23847a(0xe3)],'bin':_0x1e0093[_0x23847a(0x126)],'type':_0x1e0093['type'],'floorlevel':_0x1e0093[_0x23847a(0x144)],'maxProducts':_0x1e0093['maxStocks'],'unit':_0x1e0093['standard_unit'],'secondary_unit':_0x1e0093['secondary_unit'],'expiry_date':_0x1e0093[_0x23847a(0xe4)]}));}),await _0x32596a[_0x5cf89e(0x116)]();const _0x3f07ee=await purchases[_0x5cf89e(0x135)]({'invoice':_0x389330});_0x3f07ee['return_data']='True';const _0x121c36=await _0x3f07ee[_0x5cf89e(0x116)](),_0x164c50=new s_payment_data({'invoice':_0x389330,'suppliers':_0x529d0b['body']['suppliers'],'reason':_0x5cf89e(0x16b)});await _0x164c50[_0x5cf89e(0x116)]();const _0x15c30a=await master_shop['find']();console['log'](_0x5cf89e(0x188),_0x15c30a[0x0][_0x5cf89e(0x139)]);const _0x29d810=await email_settings['findOne'](),_0x53fdd2=await suppliers[_0x5cf89e(0x135)]({'name':_0x529d0b['body'][_0x5cf89e(0x18b)]});console[_0x5cf89e(0x169)]('suppliers_data',_0x53fdd2);_0x15c30a[0x0]['currency_placement']==0x1?(right_currency=_0x15c30a[0x0][_0x5cf89e(0xe8)],left_currency=''):(right_currency='',left_currency=_0x15c30a[0x0][_0x5cf89e(0xe8)]);var _0x216d77=_0x42fbf9,_0x565c9b=_0x192a36,_0x3b111d='',_0x25970d;for(_0x25970d in _0x216d77){_0x3b111d+=_0x5cf89e(0x109)+_0x5cf89e(0xd3)+_0x216d77[_0x25970d]+_0x5cf89e(0x15a)+_0x5cf89e(0xd3)+_0x565c9b[_0x25970d]+_0x5cf89e(0x15a)+'</tr>';}console['log'](_0x5cf89e(0x196),_0x3b111d);let _0x18701f=nodemailer[_0x5cf89e(0xda)]({'service':_0x5cf89e(0x124),'auth':{'user':_0x29d810['email'],'pass':_0x29d810[_0x5cf89e(0x118)]}}),_0x2c5f44={'from':_0x29d810[_0x5cf89e(0xac)],'to':_0x53fdd2[_0x5cf89e(0xac)],'subject':_0x5cf89e(0x1ae),'attachments':[{'filename':_0x5cf89e(0x129),'path':__dirname+_0x5cf89e(0xe9)+'/upload/'+_0x15c30a[0x0][_0x5cf89e(0x139)],'cid':'logo'}],'html':_0x5cf89e(0xb8)+'<html><head><title></title>'+_0x5cf89e(0xcc)+_0x5cf89e(0xc8)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5cf89e(0xc8)+_0x5cf89e(0x114)+'</div>'+_0x5cf89e(0xc8)+'<h2>\x20'+_0x15c30a[0x0][_0x5cf89e(0x153)]+'\x20</h2>'+_0x5cf89e(0x1cc)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5cf89e(0x166)+_0x389330+'\x20'+_0x5cf89e(0x159)+_0x5cf89e(0x18e)+_0x135093+'\x20'+_0x5cf89e(0xe0)+_0x5cf89e(0x107)+'</div>'+_0x5cf89e(0x182)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5cf89e(0x109)+_0x5cf89e(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5cf89e(0xbb)+_0x5cf89e(0xcf)+_0x5cf89e(0xad)+'</thead>'+_0x5cf89e(0x176)+'\x20'+_0x3b111d+'\x20'+_0x5cf89e(0xb4)+_0x5cf89e(0xdb)+_0x5cf89e(0xc8)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x15c30a[0x0][_0x5cf89e(0x153)]+_0x5cf89e(0x107)+'</div>'+_0x5cf89e(0x1cc)+_0x5cf89e(0xf2)};_0x18701f[_0x5cf89e(0x19f)](_0x2c5f44,function(_0x577ff8,_0x497b3a){var _0x93a584=_0x5cf89e;_0x577ff8?(console[_0x93a584(0x169)](_0x577ff8),console[_0x93a584(0x169)](_0x93a584(0x164))):console[_0x93a584(0x169)](_0x93a584(0x1cd));}),_0x529d0b['flash'](_0x5cf89e(0x194),_0x5cf89e(0xc0)),_0x4d4615[_0x5cf89e(0x18f)](_0x5cf89e(0xc7));}catch(_0x312bd2){console[_0x5cf89e(0x169)](_0x312bd2),_0x4d4615[_0x5cf89e(0x1b5)](0xc8)[_0x5cf89e(0xde)]({'message':_0x312bd2[_0x5cf89e(0x1bd)]});}}),router['get'](a0_0x20d45f(0x168),auth,async(_0x4b5b0b,_0x3b32c6)=>{var _0x1a5de0=a0_0x20d45f;try{const {username:_0x4dcd81,email:_0x212542,role:_0x49fc4a}=_0x4b5b0b[_0x1a5de0(0x171)],_0x3db9af=_0x4b5b0b['user'],_0x16cae0=await profile[_0x1a5de0(0x135)]({'email':_0x3db9af['email']}),_0x21ff3d=await master_shop['find'](),_0x23522d=_0x4b5b0b[_0x1a5de0(0x15f)]['id'],_0x5d5b60=await purchases[_0x1a5de0(0x1cb)](_0x23522d);if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]==_0x1a5de0(0x142))var _0x4516de=users[_0x1a5de0(0x155)];else{if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]=='Hindi')var _0x4516de=users[_0x1a5de0(0x150)];else{if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]==_0x1a5de0(0xdd))var _0x4516de=users[_0x1a5de0(0xdd)];else{if(_0x21ff3d[0x0]['language']=='Spanish')var _0x4516de=users[_0x1a5de0(0x10b)];else{if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]==_0x1a5de0(0x158))var _0x4516de=users[_0x1a5de0(0x158)];else{if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]==_0x1a5de0(0xc5))var _0x4516de=users[_0x1a5de0(0xe6)];else{if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]=='Chinese')var _0x4516de=users[_0x1a5de0(0xd0)];else{if(_0x21ff3d[0x0][_0x1a5de0(0x1b2)]=='Arabic\x20(ae)')var _0x4516de=users[_0x1a5de0(0x154)];}}}}}}}_0x3b32c6[_0x1a5de0(0x125)]('all_purchases_barcode',{'success':_0x4b5b0b[_0x1a5de0(0x175)]('success'),'errors':_0x4b5b0b[_0x1a5de0(0x175)](_0x1a5de0(0x133)),'role':_0x3db9af,'profile':_0x16cae0,'alldata':_0x5d5b60,'master_shop':_0x21ff3d,'language':_0x4516de}),console[_0x1a5de0(0x169)](alldata);}catch(_0x6f9b25){console[_0x1a5de0(0x169)](_0x6f9b25);}}),router['post'](a0_0x20d45f(0xd1),async(_0x515b69,_0x5a126f)=>{var _0xb298cd=a0_0x20d45f;const {product_code:_0x2fd6c5}=_0x515b69[_0xb298cd(0x12d)];var _0xefa53e;const _0x241731=await product[_0xb298cd(0x11b)]([{'$match':{'primary_code':_0x2fd6c5,'product_category':_0xb298cd(0xc6)}},{'$group':{'_id':_0xb298cd(0x18c),'name':{'$first':'$name'},'category':{'$first':_0xb298cd(0x193)},'brand':{'$first':_0xb298cd(0x11c)},'unit':{'$first':_0xb298cd(0x147)},'alertquantity':{'$first':_0xb298cd(0xec)},'product_code':{'$first':_0xb298cd(0x132)},'primary_code':{'$first':_0xb298cd(0x108)},'secondary_code':{'$first':_0xb298cd(0xf9)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0xb298cd(0x130)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xb298cd(0x170)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5bc3b0=await product['aggregate']([{'$match':{'secondary_code':_0x2fd6c5,'product_category':_0xb298cd(0xc6)}},{'$group':{'_id':_0xb298cd(0x18c),'name':{'$first':'$name'},'category':{'$first':_0xb298cd(0x193)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0xb298cd(0xec)},'product_code':{'$first':_0xb298cd(0x132)},'primary_code':{'$first':_0xb298cd(0x108)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xb298cd(0x170)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x241731[_0xb298cd(0xee)]>0x0)_0xefa53e=_0x241731;else _0x5bc3b0[_0xb298cd(0xee)]>0x0&&(_0xefa53e=_0x5bc3b0);_0x5a126f[_0xb298cd(0xde)](_0xefa53e);}),router[a0_0x20d45f(0x1c0)](a0_0x20d45f(0xb3),async(_0x45fd7d,_0x3dc460)=>{var _0x174ce5=a0_0x20d45f;const {primaryCode:_0x377016,secondaryCode:_0x461746,productCode:_0x345424,bay:_0xb6566b,bin:_0x1195bf,types:_0x513914,pallet:_0x593aeb,warehouses:_0x20b6c8,room:_0x1d0340}=_0x45fd7d['body'];console[_0x174ce5(0x169)](_0x45fd7d[_0x174ce5(0x12d)]);try{const _0xb0d3ac=await warehouse[_0x174ce5(0x11b)]([{'$match':{'name':_0x20b6c8,'room':_0x1d0340}},{'$unwind':_0x174ce5(0x146)},{'$match':{'product_details.bay':_0xb6566b,'product_details.bin':_0x1195bf,'product_details.type':_0x513914}},{'$group':{'_id':_0x174ce5(0x141),'name':{'$first':_0x174ce5(0x161)},'product_stock':{'$first':_0x174ce5(0x1aa)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x174ce5(0xcd)},'pallet':{'$first':_0x174ce5(0x15c)},'maxProducts':{'$first':_0x174ce5(0x134)}}}]);_0x3dc460[_0x174ce5(0x1b5)](0xc8)['json'](_0xb0d3ac);}catch(_0x22202b){_0x3dc460[_0x174ce5(0x1b5)](0x194)[_0x174ce5(0xde)]({'message':_0x22202b[_0x174ce5(0x1bd)]});}}),module['exports']=router;