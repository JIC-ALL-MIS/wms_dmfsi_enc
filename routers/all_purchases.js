function a0_0x27e5(_0x160f85,_0x2779e2){var _0x1320c3=a0_0x1320();return a0_0x27e5=function(_0x27e5a8,_0x23a827){_0x27e5a8=_0x27e5a8-0x154;var _0x58ece1=_0x1320c3[_0x27e5a8];return _0x58ece1;},a0_0x27e5(_0x160f85,_0x2779e2);}var a0_0x5c2930=a0_0x27e5;(function(_0x259fb1,_0x24221b){var _0x2a2017=a0_0x27e5,_0x5b4b0e=_0x259fb1();while(!![]){try{var _0x488c6f=parseInt(_0x2a2017(0x19f))/0x1*(-parseInt(_0x2a2017(0x191))/0x2)+parseInt(_0x2a2017(0x17c))/0x3*(-parseInt(_0x2a2017(0x1da))/0x4)+parseInt(_0x2a2017(0x1dc))/0x5+-parseInt(_0x2a2017(0x18e))/0x6*(parseInt(_0x2a2017(0x1a1))/0x7)+parseInt(_0x2a2017(0x250))/0x8*(-parseInt(_0x2a2017(0x1d1))/0x9)+parseInt(_0x2a2017(0x204))/0xa*(-parseInt(_0x2a2017(0x176))/0xb)+parseInt(_0x2a2017(0x1af))/0xc*(parseInt(_0x2a2017(0x275))/0xd);if(_0x488c6f===_0x24221b)break;else _0x5b4b0e['push'](_0x5b4b0e['shift']());}catch(_0x343c3e){_0x5b4b0e['push'](_0x5b4b0e['shift']());}}}(a0_0x1320,0xd171c));function a0_0x1320(){var _0x1d6388=['save','French','prod_isle','40550lhqqBO','all_purchases','product_list','/give_payment/:id','flash','Arabic','$unit','Sales\x20Update\x20successfully','product_name','actual_qty','$primary_code','pallet','purchase\x20data\x20update\x20successfully','express','due_amount','product_cat','Portuguese','all_purchases_barcode','actual_uom','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','currency','level','add\x20post','$product_code','room_name','toString','deliverycode','<div>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Hindi','\x20Order\x20Number\x20:\x20','$product_details.isle','Shelves','$batch_code','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','alertQTY','get','$product_details.expiry_date','language','Receiving\x20Area','user','status','Arabic\x20(ae)','$finalize','Rack\x20D','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$maxProdPerUnit','$secondary_code','../models/all_models','suppliers','catch','findOne','/view/:id','English','$_id','maxStocks','sendMail','forEach','prod_name','Logo.png','<strong>\x20Regards\x20</strong>','then','image','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_primunit','bin','$product_details','$maxStocks','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getMonth','redirect','primary_code_hide','</div>','19216RuvKak','map','prod_secondunit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','master','/view/add_purchases/:id','$product.quantity','product','room','RoomAssign','$product_details.bay','\x20<>\x20','</tbody>','Purchase\x20Mail','$name','delivery_code','aggregate','email','/CheckingWarehouse','expiry_date','rack','$product_details.maxProducts','$product','Rack\x20C','$product_details.product_name','JO_number','$product_details.bin','errors','standard_unit','purchase_quantity','getFullYear','/barcode/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product.bay','</tr>','$expiry_date','find','35858602RQcjJZ','paid_amount','Raw\x20Materials','$product.type','error','site_title','\x20</h2>','$due_amount','date','$product_details.type','primary_code','$brand','/preview/:id','Rack\x20F','createTransport','return_purchase','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Chinese','gmail','/view','json','secondary_code_hide','../middleware/auth','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.primary_code','delivery_date','Email\x20sent\x20successfully','</h5>','rak','../public/language/languages.json','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stock_quantity','$paid_amount','$product_details._id','2288yAHehh','exports','currency_placement','True','max_product_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','444471wAkKXk','types','/view/return_purchase/:id','</head><body>','Portuguese\x20(BR)','product_code','prod_pallet','prod_qty','$room','abs','isle','<h5>','\x20Order\x20Date\x20:\x20','</span>','product_details','Purchase\x20Return\x20Mail','$product_details.storage','Return\x20Goods','228dVYbBp','MaxStocks_data','stocks','22rlecUJ','$invoice','$secondary_unit','\x20<\x20wew\x20>\x20','path','$category','COLD\x20STORAGE','success','$product_details.product_stock','German','production_date','post','floorlevel','amount','18013igRwGC','prod_level','212660lEGXbn','edit_purchases','random','role','<tr>','$alertquantity','return_product','log','length','</thead>','Room_name','prod_code','ejs','/view/add_purchases','12fBVbeP','Error\x20Occurs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Paid\x20For\x20Purchase','product_stock','add_purchases\x20error','type','params','Purchase\x20data\x20added\x20successfully','<!DOCTYPE\x20html>','Level','storage','$product_details.level','message','body','padStart','logo','prod_unit','user_id','return_qty','<h5\x20style=\x22text-align:\x20left;\x22>','warehouse','<span\x20style=\x22float:\x20right;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_invoice','An\x20error\x20occurred.','return_data','Ambient','secondary_code','/upload/','Router','port','2619UwAVCB','push','$product.bin','<hr\x20class=\x22my-3\x22>','$suppliers','finalize','edit_purchases_view','suppliers_data','batch_code','16umKgHW','prod_Qty','7935815XkIPmx','$date','$return_data','</body></html>','back','$product_details.floorlevel','password','string','note','purchase_invoice','/all_purchases/view/','$product_details.secondary_code','product_code_hide','Enabled','$product_details.rack','INC-','$product.floorlevel','Floor','$suppliers_docs','staff','secondary_unit','POnumber','suppliers_docs','invoice','/invoice/:id','/all_purchases/view','Rack\x20B','findById','render','warehouse_name','filter','slice','Enclosed','$product_details.product_code','bay','concat','foreach\x20newproduct'];a0_0x1320=function(){return _0x1d6388;};return a0_0x1320();}const express=require(a0_0x5c2930(0x211)),app=express(),router=express[a0_0x5c2930(0x1cf)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x5c2930(0x236)),auth=require(a0_0x5c2930(0x167)),nodemailer=require('nodemailer');var ejs=require(a0_0x5c2930(0x1ad));const path=require(a0_0x5c2930(0x195)),users=require(a0_0x5c2930(0x170));router[a0_0x5c2930(0x22a)](a0_0x5c2930(0x164),auth,async(_0x1c1bee,_0x336c9c)=>{var _0x3d43ea=a0_0x5c2930;try{const {username:_0x9bb743,email:_0x342057,role:_0x51e9ab}=_0x1c1bee[_0x3d43ea(0x22e)],_0x233927=_0x1c1bee[_0x3d43ea(0x22e)],_0x5deda2=await profile['findOne']({'email':_0x233927[_0x3d43ea(0x261)]}),_0x32c91f=await staff['findOne']({'email':_0x233927[_0x3d43ea(0x261)]});if(_0x233927[_0x3d43ea(0x1a4)]==_0x3d43ea(0x1ef)){const _0x58e573=await staff[_0x3d43ea(0x239)]({'email':_0x233927[_0x3d43ea(0x261)]});}const _0x3cb458=await master_shop['find']();let _0x1bbc32;if(_0x233927[_0x3d43ea(0x1a4)]==_0x3d43ea(0x1ef)){const _0x1d28c3=await staff['findOne']({'email':_0x233927[_0x3d43ea(0x261)]});_0x1bbc32=await purchases[_0x3d43ea(0x260)]([{'$match':{'warehouse_name':_0x1d28c3[_0x3d43ea(0x1c6)]}},{'$lookup':{'from':_0x3d43ea(0x237),'localField':_0x3d43ea(0x237),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x3d43ea(0x1ee)},{'$unwind':_0x3d43ea(0x266)},{'$group':{'_id':_0x3d43ea(0x23c),'invoice':{'$first':_0x3d43ea(0x192)},'suppliers':{'$first':_0x3d43ea(0x1d5)},'date':{'$first':_0x3d43ea(0x1dd)},'warehouse_name':{'$first':_0x3d43ea(0x168)},'room':{'$first':_0x3d43ea(0x184)},'product':{'$push':_0x3d43ea(0x266)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3d43ea(0x174)},'due_amount':{'$first':_0x3d43ea(0x157)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x3d43ea(0x226)},'expiry_date':{'$first':_0x3d43ea(0x273)},'suppliers_docs':{'$first':_0x3d43ea(0x1ee)},'total_product_quantity':{'$sum':_0x3d43ea(0x256)},'level':{'$addToSet':_0x3d43ea(0x271)},'isle':{'$addToSet':_0x3d43ea(0x1d3)},'type':{'$addToSet':_0x3d43ea(0x278)},'floorlevel':{'$addToSet':_0x3d43ea(0x1ec)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1bbc32=await purchases[_0x3d43ea(0x260)]([{'$lookup':{'from':_0x3d43ea(0x237),'localField':_0x3d43ea(0x237),'foreignField':'name','as':_0x3d43ea(0x1f2)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x3d43ea(0x266)},{'$group':{'_id':_0x3d43ea(0x23c),'invoice':{'$first':_0x3d43ea(0x192)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3d43ea(0x168)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3d43ea(0x266)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3d43ea(0x174)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3d43ea(0x1de)},'batch_code':{'$first':_0x3d43ea(0x226)},'expiry_date':{'$first':_0x3d43ea(0x273)},'suppliers_docs':{'$first':_0x3d43ea(0x1ee)},'total_product_quantity':{'$sum':_0x3d43ea(0x256)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3d43ea(0x1d3)},'type':{'$addToSet':_0x3d43ea(0x278)},'floorlevel':{'$addToSet':_0x3d43ea(0x1ec)},'finalize':{'$first':_0x3d43ea(0x231)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x3cb458[0x0][_0x3d43ea(0x22c)]==_0x3d43ea(0x217)){var _0x350c75=users[_0x3d43ea(0x23b)];console[_0x3d43ea(0x1a8)](_0x350c75);}else{if(_0x3cb458[0x0][_0x3d43ea(0x22c)]=='Hindi')var _0x350c75=users['Hindi'];else{if(_0x3cb458[0x0][_0x3d43ea(0x22c)]=='German')var _0x350c75=users[_0x3d43ea(0x19a)];else{if(_0x3cb458[0x0][_0x3d43ea(0x22c)]==_0x3d43ea(0x227))var _0x350c75=users['Spanish'];else{if(_0x3cb458[0x0][_0x3d43ea(0x22c)]==_0x3d43ea(0x202))var _0x350c75=users[_0x3d43ea(0x202)];else{if(_0x3cb458[0x0][_0x3d43ea(0x22c)]=='Portuguese\x20(BR)')var _0x350c75=users[_0x3d43ea(0x214)];else{if(_0x3cb458[0x0]['language']==_0x3d43ea(0x162))var _0x350c75=users[_0x3d43ea(0x162)];else{if(_0x3cb458[0x0][_0x3d43ea(0x22c)]=='Arabic\x20(ae)')var _0x350c75=users['Arabic'];}}}}}}}_0x336c9c[_0x3d43ea(0x1f8)](_0x3d43ea(0x205),{'success':_0x1c1bee['flash'](_0x3d43ea(0x198)),'errors':_0x1c1bee[_0x3d43ea(0x208)](_0x3d43ea(0x26b)),'purchases':_0x1bbc32,'role':_0x233927,'profile':_0x5deda2,'master_shop':_0x3cb458,'language':_0x350c75});}catch(_0x57acb6){console[_0x3d43ea(0x1a8)]('table\x20page',_0x57acb6),_0x336c9c[_0x3d43ea(0x22f)](0xc8)['json']({'message':_0x57acb6[_0x3d43ea(0x1be)]});}});function BayBinSelected(_0x52a43f,_0x280c06){var _0x14fc03=a0_0x5c2930,_0x4e37b8=[],_0x44f22b=[],_0x48512f=[],_0x2013ef=[],_0x26aa84=[],_0x2df8b9=[];let _0x4c0e1d=[];if(_0x52a43f=='DRY\x20STORAGE')switch(_0x280c06){case'Rack\x20A':_0x4e37b8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x44f22b=[0x1,0x2],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=[_0x14fc03(0x1bb),_0x14fc03(0x1ed)],_0x26aa84=['D'],_0x2df8b9=['A'];break;case'Rack\x20B':_0x4e37b8=[0x6,0x5,0x4,0x3,0x2,0x1],_0x44f22b=[0x1,0x2],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=[_0x14fc03(0x1bb),_0x14fc03(0x1ed)],_0x26aa84=['D'],_0x2df8b9=['B'];break;case _0x14fc03(0x225):_0x4e37b8=[0x0],_0x44f22b=[0x0],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=[_0x14fc03(0x1ed)],_0x26aa84=['D'],_0x2df8b9=['S'];break;case _0x14fc03(0x22d):_0x4e37b8=[0x0],_0x44f22b=[0x0],_0x2013ef=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x48512f=[_0x14fc03(0x1ed)],_0x26aa84=['D'],_0x2df8b9=['R'];break;}else{if(_0x52a43f==_0x14fc03(0x197))switch(_0x280c06){case'Rack\x20A':_0x4e37b8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x44f22b=['B','F'],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=[_0x14fc03(0x1bb),_0x14fc03(0x1ed)],_0x26aa84=['C'],_0x2df8b9=['A'];break;case _0x14fc03(0x1f6):_0x4e37b8=[0x5,0x4,0x3,0x2,0x1],_0x44f22b=['F','B','S'],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=['Level',_0x14fc03(0x1ed)],_0x26aa84=['C'],_0x2df8b9=['B'];break;case _0x14fc03(0x267):_0x4e37b8=[0x1,0x2,0x3,0x4,0x5],_0x44f22b=['B','F','S'],_0x2013ef=[0x5,0x4,0x3,0x2,0x1],_0x48512f=[_0x14fc03(0x1bb),'Floor'],_0x26aa84=['C'],_0x2df8b9=['C'];break;case _0x14fc03(0x232):_0x4e37b8=[0x5,0x4,0x3,0x2,0x1],_0x44f22b=['F','B','S'],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=[_0x14fc03(0x1bb),_0x14fc03(0x1ed)],_0x26aa84=['C'],_0x2df8b9=['D'];break;case'Rack\x20E':_0x4e37b8=[0x4,0x3,0x2,0x1],_0x44f22b=[0x1,0x2],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=[_0x14fc03(0x1bb),'Floor'],_0x26aa84=['C'],_0x2df8b9=['E'];break;case _0x14fc03(0x15d):_0x4e37b8=[0x1,0x2,0x3],_0x44f22b=[0x1,0x2],_0x2013ef=[0x1,0x2,0x3,0x4,0x5],_0x48512f=['Level'],_0x26aa84=['C'],_0x2df8b9=['F'];break;}}return{'levels':_0x4e37b8,'Isle':_0x44f22b,'rack':_0x2013ef,'type':_0x48512f,'storage':_0x26aa84,'rak':_0x2df8b9};}async function getRandom8DigitNumber(){var _0x266ce1=a0_0x5c2930;const _0x1e14c9=0x989680,_0x14794f=0x5f5e0ff,_0x525bd1=Math['floor'](Math[_0x266ce1(0x1a3)]()*(_0x14794f-_0x1e14c9+0x1))+_0x1e14c9;var _0x14cb1e;const _0x3c2b55=await purchases[_0x266ce1(0x239)]({'invoice':_0x266ce1(0x1eb)+_0x525bd1});return _0x3c2b55&&_0x3c2b55['length']>0x0?_0x14cb1e=_0x266ce1(0x1eb)+_0x525bd1:_0x14cb1e=_0x266ce1(0x1eb)+_0x525bd1,_0x14cb1e;}router[a0_0x5c2930(0x22a)](a0_0x5c2930(0x1ae),auth,async(_0x3e415a,_0x181cb3)=>{var _0x2c18df=a0_0x5c2930;try{const {username:_0x22a337,email:_0x472d4c,role:_0xb1056}=_0x3e415a[_0x2c18df(0x22e)],_0x42928d=_0x3e415a[_0x2c18df(0x22e)],_0x195356=await profile[_0x2c18df(0x239)]({'email':_0x42928d['email']}),_0x2e5f8b=await master_shop[_0x2c18df(0x274)](),_0x542107=await staff[_0x2c18df(0x239)]({'email':_0x42928d[_0x2c18df(0x261)]}),_0xfbb3c6=await suppliers[_0x2c18df(0x274)]({});let _0x4e64b8;if(_0x42928d[_0x2c18df(0x1a4)]==_0x2c18df(0x1ef)){const _0x32f9d7=await staff[_0x2c18df(0x239)]({'email':_0x42928d[_0x2c18df(0x261)]});_0x4e64b8=await warehouse[_0x2c18df(0x260)]([{'$match':{'status':'Enabled','name':_0x32f9d7[_0x2c18df(0x1c6)],'warehouse_category':_0x2c18df(0x277),'name':{'$ne':_0x2c18df(0x18d)}}},{'$group':{'_id':_0x2c18df(0x25e),'name':{'$first':_0x2c18df(0x25e)}}}]);}else _0x4e64b8=await warehouse[_0x2c18df(0x260)]([{'$match':{'status':'Enabled','warehouse_category':_0x2c18df(0x277),'name':{'$ne':_0x2c18df(0x18d)}}},{'$group':{'_id':'$name','name':{'$first':_0x2c18df(0x25e)}}}]);const _0x47ceae=await product[_0x2c18df(0x274)]({}),_0x250aef=await warehouse[_0x2c18df(0x274)]({'status':_0x2c18df(0x1e9)}),_0x4f999d=await purchases['find']({}),_0x377910=_0x4f999d[_0x2c18df(0x1a9)]+0x1,_0x49a729=_0x2c18df(0x1eb)+_0x377910[_0x2c18df(0x21e)]()[_0x2c18df(0x1c0)](0x5,'0');var _0x808729=[_0x2c18df(0x1cc),_0x2c18df(0x1fc)];if(_0x2e5f8b[0x0][_0x2c18df(0x22c)]==_0x2c18df(0x217))var _0x1021cc=users['English'];else{if(_0x2e5f8b[0x0][_0x2c18df(0x22c)]==_0x2c18df(0x222))var _0x1021cc=users['Hindi'];else{if(_0x2e5f8b[0x0][_0x2c18df(0x22c)]==_0x2c18df(0x19a))var _0x1021cc=users[_0x2c18df(0x19a)];else{if(_0x2e5f8b[0x0]['language']=='Spanish')var _0x1021cc=users['Spanish'];else{if(_0x2e5f8b[0x0]['language']==_0x2c18df(0x202))var _0x1021cc=users[_0x2c18df(0x202)];else{if(_0x2e5f8b[0x0]['language']==_0x2c18df(0x180))var _0x1021cc=users[_0x2c18df(0x214)];else{if(_0x2e5f8b[0x0][_0x2c18df(0x22c)]=='Chinese')var _0x1021cc=users[_0x2c18df(0x162)];else{if(_0x2e5f8b[0x0][_0x2c18df(0x22c)]=='Arabic\x20(ae)')var _0x1021cc=users[_0x2c18df(0x209)];}}}}}}}const _0x2203ee=getRandom8DigitNumber();_0x2203ee['then'](_0x41e7b=>{var _0x303b27=_0x2c18df;_0x181cb3['render']('add_purchases',{'success':_0x3e415a[_0x303b27(0x208)](_0x303b27(0x198)),'errors':_0x3e415a['flash']('errors'),'role':_0x42928d,'profile':_0x195356,'suppliers':_0xfbb3c6,'warehouse':_0x4e64b8,'product':_0x47ceae,'invoice':_0x41e7b,'master_shop':_0x2e5f8b,'language':_0x1021cc,'find_data':_0x250aef,'rooms_data':_0x808729});})[_0x2c18df(0x238)](_0xb04a38=>{var _0x56dea6=_0x2c18df;_0x3e415a[_0x56dea6(0x208)]('errors',_0x56dea6(0x1b1)),_0x181cb3[_0x56dea6(0x24d)](_0x56dea6(0x1f5));});}catch(_0xa85124){console['log'](_0xa85124);}}),router[a0_0x5c2930(0x22a)](a0_0x5c2930(0x255),auth,async(_0x12b0f4,_0x232a2f)=>{var _0x4b3bbd=a0_0x5c2930;try{const _0x14be96=_0x12b0f4[_0x4b3bbd(0x1b8)]['id'];console[_0x4b3bbd(0x1a8)](_0x14be96);const _0x2e6efc=await master_shop[_0x4b3bbd(0x274)]();console['log'](_0x4b3bbd(0x254),_0x2e6efc);const _0x52a7ba=await product[_0x4b3bbd(0x239)]({'name':_0x14be96});console[_0x4b3bbd(0x1a8)](_0x4b3bbd(0x257),_0x52a7ba),_0x232a2f[_0x4b3bbd(0x22f)](0xc8)[_0x4b3bbd(0x165)]({'product_data':_0x52a7ba,'master':_0x2e6efc});}catch(_0x3e5903){console[_0x4b3bbd(0x1a8)](_0x4b3bbd(0x1b6),_0x3e5903);}}),router[a0_0x5c2930(0x19c)](a0_0x5c2930(0x1ae),auth,async(_0x3ba43a,_0x59ae2c)=>{var _0x40d94e=a0_0x5c2930;try{const {invoice:_0x3bf6d0,date:_0x54ca69,warehouse_name:_0x3cc259,prod_name:_0x43856d,prod_code:_0x37f7e4,prod_qty:_0x196757,prod_unit:_0x323f84,prod_secondunit:_0x21f26c,prod_level:_0x379e50,prod_isle:_0x1c6793,prod_pallet:_0x483bd9,note:_0x253d5f,expiry_date:_0x35df7a,batch_code:_0x19e196,payable:_0xa30112,due_amount:_0x22d461,Room_name:_0x541ef2,primary_code:_0x4018e8,secondary_code:_0x13c3e5,MaxStocks_data:_0x7984ec,PO_number:_0x3b672b,SCRN:_0x3de7ea,JO_number:_0x4d8a9f}=_0x3ba43a[_0x40d94e(0x1bf)];if(typeof _0x43856d==_0x40d94e(0x1e3))var _0x9b089a=[_0x3ba43a['body'][_0x40d94e(0x240)]],_0x1b8f49=[_0x3ba43a['body'][_0x40d94e(0x1ac)]],_0x4d33d0=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1db)]],_0x260aac=[_0x3ba43a['body'][_0x40d94e(0x247)]],_0x352dc7=[_0x3ba43a['body'][_0x40d94e(0x252)]],_0x1197b2=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1a0)]],_0x2ef489=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x15a)]],_0x2335d1=[_0x3ba43a['body'][_0x40d94e(0x1cd)]],_0x6590bb=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x18f)]],_0x4e2402=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1d9)]],_0x53b978=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x263)]],_0x592740=[_0x3ba43a['body']['max_product_unit']],_0x31acfc=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x229)]],_0x2c6042=[_0x3ba43a[_0x40d94e(0x1bf)]['production_date']],_0xc69283=[_0x3ba43a['body']['prod_cat']],_0x688f22=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x259)]],_0x19dd18=[_0x3ba43a['body']['deliverycode']],_0x2d3381=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1c9)]],_0xd0eec5=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x20d)]],_0x4c8f5b=[_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x216)]];else var _0x9b089a=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x240)]],_0x1b8f49=[..._0x3ba43a['body'][_0x40d94e(0x1ac)]],_0x4d33d0=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1db)]],_0x260aac=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x247)]],_0x352dc7=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x252)]],_0x1197b2=[..._0x3ba43a[_0x40d94e(0x1bf)]['prod_level']],_0x2ef489=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x15a)]],_0x2335d1=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1cd)]],_0x6590bb=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x18f)]],_0x4e2402=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1d9)]],_0x53b978=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x263)]],_0x592740=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x17a)]],_0x31acfc=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x229)]],_0x2c6042=[..._0x3ba43a[_0x40d94e(0x1bf)]['production_date']],_0xc69283=[..._0x3ba43a[_0x40d94e(0x1bf)]['prod_cat']],_0x688f22=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x259)]],_0x19dd18=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x21f)]],_0x2d3381=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x1c9)]],_0xd0eec5=[..._0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x20d)]],_0x4c8f5b=[..._0x3ba43a['body'][_0x40d94e(0x216)]];const _0x298f6e=_0x9b089a[_0x40d94e(0x251)](_0x1f36a9=>{return _0x1f36a9={'product_name':_0x1f36a9};});_0xd0eec5[_0x40d94e(0x23f)]((_0x55891f,_0x2d6f0d)=>{var _0x16c690=_0x40d94e;_0x298f6e[_0x2d6f0d][_0x16c690(0x20d)]=Math[_0x16c690(0x185)](_0x55891f);}),_0x4c8f5b['forEach']((_0x58adc5,_0x282a92)=>{var _0x30b0e6=_0x40d94e;_0x298f6e[_0x282a92][_0x30b0e6(0x216)]=_0x58adc5;}),_0x1b8f49[_0x40d94e(0x23f)]((_0x49947b,_0x4ad0f6)=>{var _0x309cf7=_0x40d94e;_0x298f6e[_0x4ad0f6][_0x309cf7(0x181)]=_0x49947b;}),_0x4d33d0[_0x40d94e(0x23f)]((_0x16e55e,_0x5c85dd)=>{var _0x311960=_0x40d94e;_0x298f6e[_0x5c85dd][_0x311960(0x171)]=Math[_0x311960(0x185)](_0x16e55e);}),_0x260aac[_0x40d94e(0x23f)]((_0x47f852,_0x5bd6ae)=>{_0x298f6e[_0x5bd6ae]['standard_unit']=_0x47f852;}),_0x352dc7[_0x40d94e(0x23f)]((_0x3cf77a,_0x171617)=>{_0x298f6e[_0x171617]['secondary_unit']=_0x3cf77a;}),_0x1197b2['forEach']((_0x5e05ac,_0x49ed12)=>{var _0x2c6019=_0x40d94e;_0x688f22[_0x2c6019(0x23f)]((_0xe48467,_0x4f4c91)=>{var _0x399d19=_0x2c6019;if(_0xe48467==_0x399d19(0x22d)&&_0x49ed12==_0x4f4c91){console['log'](_0xe48467+_0x399d19(0x194)+_0x49ed12+_0x399d19(0x25b)+_0x4f4c91+'\x20<>\x20'+_0x5e05ac);var _0x10588f=_0x5e05ac[_0x399d19(0x1fb)](0x3);_0x298f6e[_0x49ed12][_0x399d19(0x1bc)]=_0x5e05ac[0x0],_0x298f6e[_0x49ed12]['rack']=_0x5e05ac[0x1],_0x298f6e[_0x49ed12]['bay']=0x0,_0x298f6e[_0x49ed12][_0x399d19(0x248)]=0x0,_0x298f6e[_0x49ed12][_0x399d19(0x1b7)]=_0x399d19(0x1ed),_0x298f6e[_0x49ed12][_0x399d19(0x19d)]=_0x10588f;}else{if(_0xe48467==_0x399d19(0x225)&&_0x49ed12==_0x4f4c91){var _0x10588f=_0x5e05ac[_0x399d19(0x1fb)](0x3);_0x298f6e[_0x49ed12][_0x399d19(0x1bc)]=_0x5e05ac[0x0],_0x298f6e[_0x49ed12][_0x399d19(0x264)]=_0x5e05ac[0x1],_0x298f6e[_0x49ed12]['bay']=0x0,_0x298f6e[_0x49ed12][_0x399d19(0x248)]=0x0,_0x298f6e[_0x49ed12]['type']='Floor',_0x298f6e[_0x49ed12][_0x399d19(0x19d)]=_0x5e05ac[0x5];}else{if(_0x49ed12==_0x4f4c91){if(_0x5e05ac[0x0]=='A'&&_0x5e05ac[0x1]=='L'&&_0x5e05ac[0x2]=='L')console[_0x399d19(0x1a8)](_0xe48467+_0x399d19(0x25b)+_0x49ed12+'\x20<>\x20'+_0x4f4c91+_0x399d19(0x25b)+_0x5e05ac+'here'),_0x298f6e[_0x49ed12]['storage']=_0x5e05ac[0x0],_0x298f6e[_0x49ed12][_0x399d19(0x264)]=_0x5e05ac[0x1],_0x298f6e[_0x49ed12][_0x399d19(0x1fe)]=0x0,_0x298f6e[_0x49ed12]['bin']=0x0,_0x298f6e[_0x49ed12][_0x399d19(0x1b7)]='Floor',_0x298f6e[_0x49ed12][_0x399d19(0x19d)]=_0x5e05ac[0x3];else{var _0x461008;if(_0x5e05ac[0x4]=='L')_0x461008=_0x399d19(0x1bb);else _0x5e05ac[0x4]=='F'&&(_0x461008=_0x399d19(0x1ed));_0x298f6e[_0x49ed12][_0x399d19(0x1bc)]=_0x5e05ac[0x0],_0x298f6e[_0x49ed12][_0x399d19(0x264)]=_0x5e05ac[0x1],_0x298f6e[_0x49ed12][_0x399d19(0x1fe)]=_0x5e05ac[0x2],_0x298f6e[_0x49ed12]['bin']=_0x5e05ac[0x3],_0x298f6e[_0x49ed12][_0x399d19(0x1b7)]=_0x461008,_0x298f6e[_0x49ed12][_0x399d19(0x19d)]=_0x5e05ac[0x5];}}}}});}),_0x2ef489[_0x40d94e(0x23f)]((_0x95d571,_0x3cd0d3)=>{_0x298f6e[_0x3cd0d3]['primary_code']=_0x95d571;}),_0x2335d1[_0x40d94e(0x23f)]((_0x1dfa54,_0x3d5fa1)=>{_0x298f6e[_0x3d5fa1]['secondary_code']=_0x1dfa54;}),_0x6590bb['forEach']((_0x514b17,_0x39b6e5)=>{var _0x1e0494=_0x40d94e;_0x298f6e[_0x39b6e5][_0x1e0494(0x23d)]=_0x514b17;}),_0x4e2402['forEach']((_0x5d7d35,_0x41fdd6)=>{_0x298f6e[_0x41fdd6]['batch_code']=_0x5d7d35;}),_0x53b978[_0x40d94e(0x23f)]((_0x10fc7d,_0x1a8181)=>{var _0x1e8cc7=_0x40d94e;_0x298f6e[_0x1a8181][_0x1e8cc7(0x263)]=_0x10fc7d;}),_0x592740[_0x40d94e(0x23f)]((_0x38a188,_0x5b4a6e)=>{_0x298f6e[_0x5b4a6e]['maxperunit']=_0x38a188;}),_0x31acfc[_0x40d94e(0x23f)]((_0x16481b,_0x35f703)=>{_0x298f6e[_0x35f703]['alertQTY']=_0x16481b;}),_0x2c6042[_0x40d94e(0x23f)]((_0x2acd18,_0x3a8024)=>{_0x298f6e[_0x3a8024]['production_date']=_0x2acd18;}),_0xc69283['forEach']((_0x529d10,_0x7378e8)=>{_0x298f6e[_0x7378e8]['product_cat']=_0x529d10;}),_0x688f22['forEach']((_0x526e56,_0x4ea23e)=>{_0x298f6e[_0x4ea23e]['room_name']=_0x526e56;}),_0x19dd18['forEach']((_0x20de19,_0x1c3569)=>{var _0x5d3753=_0x40d94e;_0x298f6e[_0x1c3569][_0x5d3753(0x25f)]=_0x20de19;}),_0x2d3381[_0x40d94e(0x23f)]((_0x1816ca,_0x6b754f)=>{_0x298f6e[_0x6b754f]['invoice']=_0x1816ca;});const _0x417a20=_0x688f22['map'](_0x331e6f=>{return _0x331e6f={'room_name':_0x331e6f};}),_0x2b0077=_0x298f6e[_0x40d94e(0x1fa)](_0x3cc0eb=>_0x3cc0eb[_0x40d94e(0x171)]!=='0'&&_0x3cc0eb[_0x40d94e(0x171)]!==''),_0x207f99=new purchases({'invoice':_0x3bf6d0,'suppliers':_0x3ba43a[_0x40d94e(0x1bf)][_0x40d94e(0x237)],'date':_0x54ca69,'warehouse_name':_0x3cc259,'product':_0x2b0077,'note':_0x253d5f,'due_amount':_0x22d461,'POnumber':_0x3b672b,'SCRN':_0x3de7ea,'JO_number':_0x4d8a9f,'roomList':_0x417a20}),_0x1928ac=await _0x207f99['save'](),_0x5a57f3=await purchases[_0x40d94e(0x239)]({'invoice':_0x3bf6d0}),_0x5a721a=_0x5a57f3[_0x40d94e(0x257)][_0x40d94e(0x251)](async _0x993355=>{var _0x4fef34=_0x40d94e,_0x33bd0d=await warehouse[_0x4fef34(0x239)]({'name':_0x3cc259,'room':_0x993355['room_name']}),_0x5820c3=0x0;return _0x33bd0d[_0x4fef34(0x18a)][_0x4fef34(0x23f)](_0x2b125c=>{var _0x2d9054=_0x4fef34;_0x2b125c[_0x2d9054(0x20c)]==_0x993355['product_name']&&_0x2b125c['floorlevel']==_0x993355[_0x2d9054(0x19d)]&&_0x2b125c[_0x2d9054(0x1b7)]==_0x993355['type']&&_0x2b125c[_0x2d9054(0x248)]==_0x993355[_0x2d9054(0x248)]&&_0x2b125c['bay']==_0x993355[_0x2d9054(0x1fe)]&&_0x2b125c[_0x2d9054(0x264)]==_0x993355[_0x2d9054(0x264)]&&_0x2b125c[_0x2d9054(0x1bc)]==_0x993355[_0x2d9054(0x1bc)]&&_0x2b125c['expiry_date']==_0x993355[_0x2d9054(0x263)]&&_0x2b125c[_0x2d9054(0x1d9)]==_0x993355[_0x2d9054(0x1d9)]&&_0x2b125c[_0x2d9054(0x19b)]==_0x993355[_0x2d9054(0x19b)]&&_0x2b125c['invoice']==_0x5a57f3[_0x2d9054(0x1f3)]&&(_0x2b125c[_0x2d9054(0x1b5)]+=Math[_0x2d9054(0x185)](_0x993355['quantity']),_0x5820c3++);}),_0x5820c3===0x0&&_0x33bd0d[_0x4fef34(0x18a)][_0x4fef34(0x1d2)]({'product_name':_0x993355[_0x4fef34(0x20c)],'product_stock':Math[_0x4fef34(0x185)](_0x993355[_0x4fef34(0x171)]),'primary_code':_0x993355[_0x4fef34(0x15a)],'secondary_code':_0x993355['secondary_code'],'product_code':_0x993355[_0x4fef34(0x181)],'storage':_0x993355[_0x4fef34(0x1bc)],'rack':_0x993355['rack'],'bay':_0x993355['bay'],'bin':_0x993355[_0x4fef34(0x248)],'type':_0x993355[_0x4fef34(0x1b7)],'floorlevel':_0x993355['floorlevel'],'maxProducts':_0x993355[_0x4fef34(0x23d)],'unit':_0x993355[_0x4fef34(0x26c)],'secondary_unit':_0x993355[_0x4fef34(0x1f0)],'expiry_date':_0x993355[_0x4fef34(0x263)],'maxPerUnit':_0x993355['maxperunit'],'batch_code':_0x993355[_0x4fef34(0x1d9)],'alertQTY':_0x993355[_0x4fef34(0x229)],'production_date':_0x993355[_0x4fef34(0x19b)],'product_cat':_0x993355[_0x4fef34(0x213)],'invoice':_0x993355[_0x4fef34(0x1f3)],'actual_qty':Math['abs'](_0x993355[_0x4fef34(0x20d)]),'actual_uom':_0x993355[_0x4fef34(0x216)]}),_0x33bd0d;});Promise['all'](_0x5a721a)[_0x40d94e(0x243)](async _0x2de4f7=>{var _0x2d3f54=_0x40d94e;try{for(const _0x4a2f0f of _0x2de4f7){await _0x4a2f0f[_0x2d3f54(0x201)]();}const _0xf70ffb=await master_shop[_0x2d3f54(0x274)](),_0x282c0f=await email_settings[_0x2d3f54(0x239)](),_0x420131=await supervisor_settings[_0x2d3f54(0x274)]();var _0x5928f8=_0x5a57f3[_0x2d3f54(0x257)],_0x43ed9c='',_0x4fa383;for(_0x4fa383 in _0x5928f8){_0x43ed9c+='<tr>'+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383]['product_name']+'</td>'+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383][_0x2d3f54(0x181)]+'</td>'+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383]['quantity']+_0x2d3f54(0x1b2)+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383][_0x2d3f54(0x26c)]+_0x2d3f54(0x1b2)+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383]['secondary_unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5a57f3[_0x2d3f54(0x1f9)]+_0x2d3f54(0x1b2)+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383][_0x2d3f54(0x21d)]+_0x2d3f54(0x1b2)+_0x2d3f54(0x253)+_0x5928f8[_0x4fa383][_0x2d3f54(0x1bc)]+_0x5928f8[_0x4fa383][_0x2d3f54(0x264)]+_0x5928f8[_0x4fa383][_0x2d3f54(0x1fe)]+_0x5928f8[_0x4fa383]['bin']+_0x5928f8[_0x4fa383]['type'][0x0]+_0x5928f8[_0x4fa383][_0x2d3f54(0x19d)]+_0x2d3f54(0x1b2),_0x2d3f54(0x272);}let _0x4c8cf8=nodemailer[_0x2d3f54(0x15e)]({'host':_0x282c0f['host'],'port':Number(_0x282c0f[_0x2d3f54(0x1d0)]),'secure':![],'auth':{'user':_0x282c0f[_0x2d3f54(0x261)],'pass':_0x282c0f[_0x2d3f54(0x1e2)]}}),_0x36d06b={'from':_0x282c0f['email'],'to':_0x420131[0x0][_0x2d3f54(0x160)],'subject':_0x2d3f54(0x25d),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x2d3f54(0x1ce)+_0xf70ffb[0x0][_0x2d3f54(0x244)],'cid':_0x2d3f54(0x1c1)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x2d3f54(0x17f)+'<div>'+_0x2d3f54(0x1c8)+'<div>'+_0x2d3f54(0x24b)+'</div>'+'<div>'+'<h2>\x20'+_0xf70ffb[0x0][_0x2d3f54(0x155)]+_0x2d3f54(0x156)+'</div>'+_0x2d3f54(0x24f)+_0x2d3f54(0x1d4)+_0x2d3f54(0x220)+_0x2d3f54(0x1c5)+_0x2d3f54(0x223)+_0x5a57f3['invoice']+'\x20'+_0x2d3f54(0x1c7)+'\x20Order\x20Date\x20:\x20'+_0x5a57f3[_0x2d3f54(0x158)]+'\x20'+'</span>'+'</h5>'+_0x2d3f54(0x24f)+_0x2d3f54(0x270)+_0x2d3f54(0x221)+_0x2d3f54(0x1a5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2d3f54(0x1b3)+_0x2d3f54(0x16a)+_0x2d3f54(0x161)+_0x2d3f54(0x246)+_0x2d3f54(0x218)+_0x2d3f54(0x228)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x2d3f54(0x272)+_0x2d3f54(0x1aa)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x43ed9c+'\x20'+_0x2d3f54(0x25c)+'</table>'+_0x2d3f54(0x220)+_0x2d3f54(0x242)+_0x2d3f54(0x187)+_0xf70ffb[0x0][_0x2d3f54(0x155)]+_0x2d3f54(0x16e)+_0x2d3f54(0x24f)+'</div>'+_0x2d3f54(0x1df)};_0x4c8cf8[_0x2d3f54(0x23e)](_0x36d06b,function(_0x227de4,_0x1b9f3d){var _0x36f381=_0x2d3f54;_0x227de4?(console[_0x36f381(0x1a8)](_0x227de4),console[_0x36f381(0x1a8)]('Error\x20Occurs')):console['log'](_0x36f381(0x16d));}),_0x3ba43a[_0x2d3f54(0x208)](_0x2d3f54(0x198),_0x2d3f54(0x1b9)),_0x59ae2c[_0x2d3f54(0x24d)](_0x2d3f54(0x1e6));}catch(_0x252c8b){console[_0x2d3f54(0x154)](_0x252c8b),_0x59ae2c[_0x2d3f54(0x22f)](0x1f4)[_0x2d3f54(0x165)]({'error':_0x2d3f54(0x17b)});}})[_0x40d94e(0x238)](_0x3cda0a=>{var _0x1d13ed=_0x40d94e;console[_0x1d13ed(0x154)](_0x3cda0a),_0x59ae2c[_0x1d13ed(0x22f)](0x1f4)[_0x1d13ed(0x165)]({'error':_0x1d13ed(0x1ca)});});}catch(_0x57330b){console[_0x40d94e(0x1a8)](_0x57330b);}}),router['get'](a0_0x5c2930(0x15c),auth,async(_0x1d48b0,_0x214bf7)=>{var _0x16f41c=a0_0x5c2930;try{const {username:_0x3aa656,email:_0x1b5767,role:_0x2a2206}=_0x1d48b0['user'],_0x40ee8e=_0x1d48b0[_0x16f41c(0x22e)],_0x265538=await profile[_0x16f41c(0x239)]({'email':_0x40ee8e[_0x16f41c(0x261)]}),_0x1e9e6b=await master_shop[_0x16f41c(0x274)](),_0x369115=_0x1d48b0['params']['id'],_0x1f2dec=await purchases[_0x16f41c(0x1f7)](_0x369115),_0x1787a7=await warehouse[_0x16f41c(0x260)]([{'$match':{'name':_0x1f2dec['warehouse_name'],'room':_0x1f2dec[_0x16f41c(0x258)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x16f41c(0x175),'name':{'$first':_0x16f41c(0x268)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x16f41c(0x25a)},'bin':{'$first':_0x16f41c(0x26a)},'type':{'$first':_0x16f41c(0x159)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x16f41c(0x16b)},'secondary_code':{'$first':_0x16f41c(0x1e7)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x16f41c(0x18c)},'rack':{'$first':_0x16f41c(0x1ea)},'expiry_date':{'$first':_0x16f41c(0x22b)}}}]),_0x343e7e=await customer[_0x16f41c(0x274)]({});let _0x269e10;if(_0x40ee8e[_0x16f41c(0x1a4)]==_0x16f41c(0x1ef)){const _0x47f52e=await staff[_0x16f41c(0x239)]({'email':_0x40ee8e[_0x16f41c(0x261)]});_0x269e10=await warehouse[_0x16f41c(0x260)]([{'$match':{'status':_0x16f41c(0x1e9),'name':_0x47f52e['warehouse']}},{'$group':{'_id':_0x16f41c(0x25e),'name':{'$first':_0x16f41c(0x25e)}}}]);}else _0x269e10=await warehouse[_0x16f41c(0x260)]([{'$match':{'status':_0x16f41c(0x1e9)}},{'$group':{'_id':_0x16f41c(0x25e),'name':{'$first':_0x16f41c(0x25e)}}}]);const _0x2ed593=await product['find']({}),_0x2c4511=await suppliers[_0x16f41c(0x274)]({}),_0x19de76=BayBinSelected(_0x1f2dec['warehouse_name'],_0x1f2dec[_0x16f41c(0x258)]);if(_0x1e9e6b[0x0][_0x16f41c(0x22c)]==_0x16f41c(0x217)){var _0x256773=users[_0x16f41c(0x23b)];console[_0x16f41c(0x1a8)](_0x256773);}else{if(_0x1e9e6b[0x0][_0x16f41c(0x22c)]==_0x16f41c(0x222))var _0x256773=users[_0x16f41c(0x222)];else{if(_0x1e9e6b[0x0][_0x16f41c(0x22c)]==_0x16f41c(0x19a))var _0x256773=users[_0x16f41c(0x19a)];else{if(_0x1e9e6b[0x0][_0x16f41c(0x22c)]=='Spanish')var _0x256773=users[_0x16f41c(0x227)];else{if(_0x1e9e6b[0x0]['language']=='French')var _0x256773=users['French'];else{if(_0x1e9e6b[0x0][_0x16f41c(0x22c)]==_0x16f41c(0x180))var _0x256773=users[_0x16f41c(0x214)];else{if(_0x1e9e6b[0x0]['language']==_0x16f41c(0x162))var _0x256773=users['Chinese'];else{if(_0x1e9e6b[0x0][_0x16f41c(0x22c)]==_0x16f41c(0x230))var _0x256773=users[_0x16f41c(0x209)];}}}}}}}_0x214bf7[_0x16f41c(0x1f8)](_0x16f41c(0x1d7),{'success':_0x1d48b0[_0x16f41c(0x208)](_0x16f41c(0x198)),'errors':_0x1d48b0['flash'](_0x16f41c(0x26b)),'role':_0x40ee8e,'profile':_0x265538,'customer':_0x343e7e,'warehouse':_0x269e10,'product':_0x1787a7,'user':_0x1f2dec,'master_shop':_0x1e9e6b,'unit':_0x2ed593,'language':_0x256773,'suppliers':_0x2c4511,'dataSelected':_0x19de76});}catch(_0x1c452e){console['log'](_0x1c452e);}}),router[a0_0x5c2930(0x19c)]('/preview/:id',auth,async(_0xb9e5b7,_0x144940)=>{var _0x3c5b82=a0_0x5c2930;try{const _0x3996fb=_0xb9e5b7[_0x3c5b82(0x1b8)]['id'],{invoice:_0xe29302,warehouse_name:_0x3b2c86,Room_name:_0x2b7d1e}=_0xb9e5b7[_0x3c5b82(0x1bf)],_0x1e3249=await warehouse['findOne']({'name':_0x3b2c86,'room':_0x2b7d1e}),_0x189875=await purchases[_0x3c5b82(0x239)]({'invoice':_0xe29302});_0x189875[_0x3c5b82(0x257)][_0x3c5b82(0x23f)](_0x3a4c8d=>{var _0x4dc222=_0x3c5b82,_0x2994ff=0x0;const _0x28a895=_0x1e3249[_0x4dc222(0x18a)][_0x4dc222(0x251)](_0x379541=>{var _0x40c5c8=_0x4dc222;_0x379541[_0x40c5c8(0x20c)]==_0x3a4c8d[_0x40c5c8(0x20c)]&&_0x379541[_0x40c5c8(0x19d)]==_0x3a4c8d['floorlevel']&&_0x379541[_0x40c5c8(0x1b7)]==_0x3a4c8d[_0x40c5c8(0x1b7)]&&_0x379541[_0x40c5c8(0x248)]==_0x3a4c8d[_0x40c5c8(0x248)]&&_0x379541[_0x40c5c8(0x1fe)]==_0x3a4c8d[_0x40c5c8(0x1fe)]&&_0x379541[_0x40c5c8(0x264)]==_0x3a4c8d[_0x40c5c8(0x264)]&&_0x379541['storage']==_0x3a4c8d[_0x40c5c8(0x1bc)]&&_0x379541['expiry_date']==_0x3a4c8d['expiry_date']&&_0x379541[_0x40c5c8(0x1d9)]==_0x3a4c8d[_0x40c5c8(0x1d9)]&&_0x379541[_0x40c5c8(0x19b)]==_0x3a4c8d['production_date']&&_0x379541[_0x40c5c8(0x16c)]==_0x3a4c8d[_0x40c5c8(0x16c)]&&_0x379541[_0x40c5c8(0x25f)]==_0x3a4c8d['delivery_code']&&(_0x379541['product_stock']=parseInt(_0x379541['product_stock'])+parseInt(_0x3a4c8d[_0x40c5c8(0x171)]),_0x2994ff++);});_0x2994ff=='0'&&(_0x1e3249[_0x4dc222(0x18a)]=_0x1e3249['product_details'][_0x4dc222(0x1ff)]({'product_name':_0x3a4c8d[_0x4dc222(0x20c)],'product_stock':_0x3a4c8d[_0x4dc222(0x171)],'primary_code':_0x3a4c8d[_0x4dc222(0x15a)],'secondary_code':_0x3a4c8d['secondary_code'],'product_code':_0x3a4c8d['product_code'],'storage':_0x3a4c8d[_0x4dc222(0x1bc)],'rack':_0x3a4c8d[_0x4dc222(0x264)],'bay':_0x3a4c8d[_0x4dc222(0x1fe)],'bin':_0x3a4c8d['bin'],'type':_0x3a4c8d[_0x4dc222(0x1b7)],'floorlevel':_0x3a4c8d[_0x4dc222(0x19d)],'maxProducts':_0x3a4c8d['maxStocks'],'unit':_0x3a4c8d[_0x4dc222(0x26c)],'secondary_unit':_0x3a4c8d[_0x4dc222(0x1f0)],'expiry_date':_0x3a4c8d[_0x4dc222(0x263)],'maxPerUnit':_0x3a4c8d['maxperunit'],'batch_code':_0x3a4c8d[_0x4dc222(0x1d9)],'alertQTY':_0x3a4c8d[_0x4dc222(0x229)],'production_date':_0x3a4c8d[_0x4dc222(0x19b)],'delivery_date':_0x3a4c8d['delivery_date'],'delivery_code':_0x3a4c8d[_0x4dc222(0x25f)]}));}),await _0x1e3249[_0x3c5b82(0x201)](),_0x189875[_0x3c5b82(0x1d6)]=_0x3c5b82(0x179);const _0xf20f55=await _0x189875[_0x3c5b82(0x201)]();_0xb9e5b7['flash'](_0x3c5b82(0x198),_0x3c5b82(0x20b)),_0x144940[_0x3c5b82(0x24d)](_0x3c5b82(0x1f5));}catch(_0x45bc17){console['log'](_0x45bc17);}}),router[a0_0x5c2930(0x22a)](a0_0x5c2930(0x23a),auth,async(_0x203a5b,_0x2540c7)=>{var _0x4c27e2=a0_0x5c2930;try{const {username:_0x59a138,email:_0x28a787,role:_0x38021c}=_0x203a5b[_0x4c27e2(0x22e)],_0x2f717f=_0x203a5b[_0x4c27e2(0x22e)],_0x16056e=await profile['findOne']({'email':_0x2f717f[_0x4c27e2(0x261)]}),_0x4bb107=await master_shop['find'](),_0x169f5f=_0x203a5b['params']['id'],_0x1410cc=await purchases[_0x4c27e2(0x1f7)](_0x169f5f),_0xd5409d=await suppliers[_0x4c27e2(0x274)]({});let _0xd7c5bf;if(_0x2f717f['role']==_0x4c27e2(0x1ef)){const _0x4293c0=await staff[_0x4c27e2(0x239)]({'email':_0x2f717f[_0x4c27e2(0x261)]});_0xd7c5bf=await warehouse[_0x4c27e2(0x274)]({'status':_0x4c27e2(0x1e9),'name':_0x4293c0[_0x4c27e2(0x1c6)],'warehouse_category':_0x4c27e2(0x277)});}else _0xd7c5bf=await warehouse[_0x4c27e2(0x260)]([{'$match':{'status':_0x4c27e2(0x1e9),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4c27e2(0x25e),'name':{'$first':_0x4c27e2(0x25e)}}}]);const _0x45a064=await product['find']({}),_0x633b3e=BayBinSelected(_0x1410cc[_0x4c27e2(0x1f9)],_0x1410cc[_0x4c27e2(0x258)]);let _0x22a534=new Date(_0x1410cc[_0x4c27e2(0x263)]),_0x52360d=('0'+_0x22a534['getDate']())[_0x4c27e2(0x1fb)](-0x2),_0x4eb52f=('0'+(_0x22a534[_0x4c27e2(0x24c)]()+0x1))[_0x4c27e2(0x1fb)](-0x2),_0x263836=_0x22a534[_0x4c27e2(0x26e)](),_0x354f32=_0x263836+'-'+_0x4eb52f+'-'+_0x52360d;if(_0x4bb107[0x0][_0x4c27e2(0x22c)]==_0x4c27e2(0x217)){var _0x360b0b=users[_0x4c27e2(0x23b)];console[_0x4c27e2(0x1a8)](_0x360b0b);}else{if(_0x4bb107[0x0]['language']==_0x4c27e2(0x222))var _0x360b0b=users[_0x4c27e2(0x222)];else{if(_0x4bb107[0x0][_0x4c27e2(0x22c)]==_0x4c27e2(0x19a))var _0x360b0b=users[_0x4c27e2(0x19a)];else{if(_0x4bb107[0x0][_0x4c27e2(0x22c)]=='Spanish')var _0x360b0b=users[_0x4c27e2(0x227)];else{if(_0x4bb107[0x0][_0x4c27e2(0x22c)]==_0x4c27e2(0x202))var _0x360b0b=users['French'];else{if(_0x4bb107[0x0][_0x4c27e2(0x22c)]==_0x4c27e2(0x180))var _0x360b0b=users['Portuguese'];else{if(_0x4bb107[0x0]['language']==_0x4c27e2(0x162))var _0x360b0b=users[_0x4c27e2(0x162)];else{if(_0x4bb107[0x0][_0x4c27e2(0x22c)]=='Arabic\x20(ae)')var _0x360b0b=users[_0x4c27e2(0x209)];}}}}}}}_0x2540c7[_0x4c27e2(0x1f8)](_0x4c27e2(0x1a2),{'success':_0x203a5b['flash'](_0x4c27e2(0x198)),'errors':_0x203a5b['flash']('errors'),'role':_0x2f717f,'profile':_0x16056e,'purchases':_0x1410cc,'suppliers':_0xd5409d,'warehouse':_0xd7c5bf,'product':_0x45a064,'master_shop':_0x4bb107,'language':_0x360b0b,'ed_fullDate':_0x354f32,'dataSelected':_0x633b3e});}catch(_0x153ded){console[_0x4c27e2(0x1a8)](_0x153ded);}}),router[a0_0x5c2930(0x19c)](a0_0x5c2930(0x23a),auth,async(_0x4f834b,_0x12ba15)=>{var _0x1e4d9c=a0_0x5c2930;try{const _0x5359bb=_0x4f834b[_0x1e4d9c(0x1b8)]['id'],_0x156d99=await purchases[_0x1e4d9c(0x239)]({'_id':_0x4f834b[_0x1e4d9c(0x1b8)]['id']}),_0x3d9d50=await warehouse[_0x1e4d9c(0x239)]({'name':_0x156d99[_0x1e4d9c(0x1f9)],'room':_0x156d99['room']});_0x156d99[_0x1e4d9c(0x257)][_0x1e4d9c(0x23f)](_0x439205=>{var _0x211fb7=_0x1e4d9c;const _0x5e3729=_0x3d9d50['product_details'][_0x211fb7(0x251)](_0x3a5f9a=>{var _0x4e9cc3=_0x211fb7;_0x3a5f9a[_0x4e9cc3(0x20c)]==_0x439205[_0x4e9cc3(0x20c)]&&_0x3a5f9a[_0x4e9cc3(0x19d)]==_0x439205[_0x4e9cc3(0x19d)]&&_0x3a5f9a['type']==_0x439205[_0x4e9cc3(0x1b7)]&&_0x3a5f9a[_0x4e9cc3(0x248)]==_0x439205[_0x4e9cc3(0x248)]&&_0x3a5f9a['bay']==_0x439205['bay']&&_0x3a5f9a['rack']==_0x439205['rack']&&_0x3a5f9a[_0x4e9cc3(0x1bc)]==_0x439205['storage']&&(_0x3a5f9a['product_stock']=parseInt(_0x3a5f9a['product_stock'])-parseInt(_0x439205[_0x4e9cc3(0x171)]));});}),await _0x3d9d50[_0x1e4d9c(0x201)]();const {invoice:_0x78921b,suppliers:_0x22ea3f,date:_0x2abf71,warehouse_name:_0x57c315,prod_name:_0x5c3630,prod_code:_0x591ddf,prod_qty:_0x57f022,prod_unit:_0x5d917d,prod_secondunit:_0x23e084,prod_level:_0x3970e2,prod_isle:_0x45786f,prod_pallet:_0x293949,note:_0x1ac7bd,expiry_date:_0x2e714a,batch_code:_0x238a5d,paid_amount:_0x456311,due_amount:_0x108f26,Room_name:_0xdf9f64,primary_code:_0x1d924e,secondary_code:_0x30f888,PO_number:_0x5b7915,JO_number:_0x5e09c2}=_0x4f834b[_0x1e4d9c(0x1bf)];if(typeof _0x5c3630==_0x1e4d9c(0x1e3))var _0x1bbbd2=[_0x4f834b[_0x1e4d9c(0x1bf)]['prod_name']],_0x6c5def=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1ac)]],_0x2a7895=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x183)]],_0x2babc2=[_0x4f834b['body'][_0x1e4d9c(0x1c2)]],_0x1252e1=[_0x4f834b['body'][_0x1e4d9c(0x252)]],_0x3d4191=[_0x4f834b['body'][_0x1e4d9c(0x1a0)]],_0xf808a4=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x203)]],_0x3a268d=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x182)]],_0x39476f=[_0x4f834b['body'][_0x1e4d9c(0x15a)]],_0x4b102f=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1cd)]],_0x23cf50=[_0x4f834b['body'][_0x1e4d9c(0x18f)]],_0x2362df=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1d9)]],_0x39ec83=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x263)]],_0x36fce8=[_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1bc)]],_0x3e5103=[_0x4f834b['body'][_0x1e4d9c(0x16f)]],_0x38d57e=[_0x4f834b[_0x1e4d9c(0x1bf)]['type']];else var _0x1bbbd2=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x240)]],_0x6c5def=[..._0x4f834b[_0x1e4d9c(0x1bf)]['prod_code']],_0x2a7895=[..._0x4f834b[_0x1e4d9c(0x1bf)]['prod_qty']],_0x2babc2=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1c2)]],_0x1252e1=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x252)]],_0x3d4191=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1a0)]],_0xf808a4=[..._0x4f834b[_0x1e4d9c(0x1bf)]['prod_isle']],_0x3a268d=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x182)]],_0x39476f=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x15a)]],_0x4b102f=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1cd)]],_0x23cf50=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x18f)]],_0x2362df=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1d9)]],_0x39ec83=[..._0x4f834b['body'][_0x1e4d9c(0x263)]],_0x36fce8=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1bc)]],_0x3e5103=[..._0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x16f)]],_0x38d57e=[..._0x4f834b[_0x1e4d9c(0x1bf)]['type']];const _0x41d6ee=_0x1bbbd2[_0x1e4d9c(0x251)](_0x4feb07=>{return _0x4feb07={'product_name':_0x4feb07};});_0x6c5def['forEach']((_0x502d80,_0x1d403c)=>{var _0x496a3a=_0x1e4d9c;_0x41d6ee[_0x1d403c][_0x496a3a(0x181)]=_0x502d80;}),_0x2a7895[_0x1e4d9c(0x23f)]((_0x117da4,_0x581ada)=>{var _0x12d340=_0x1e4d9c;_0x41d6ee[_0x581ada][_0x12d340(0x171)]=_0x117da4;}),_0x2babc2[_0x1e4d9c(0x23f)]((_0x3212e6,_0x7fa868)=>{var _0x1bc472=_0x1e4d9c;_0x41d6ee[_0x7fa868][_0x1bc472(0x26c)]=_0x3212e6;}),_0x1252e1[_0x1e4d9c(0x23f)]((_0x400cad,_0x461d74)=>{var _0xb212a0=_0x1e4d9c;_0x41d6ee[_0x461d74][_0xb212a0(0x1f0)]=_0x400cad;}),_0x3d4191['forEach']((_0xf25a35,_0x482c31)=>{_0x41d6ee[_0x482c31]['bay']=_0xf25a35;}),_0xf808a4[_0x1e4d9c(0x23f)]((_0x187cbb,_0x2fe61f)=>{var _0x129562=_0x1e4d9c;_0x41d6ee[_0x2fe61f][_0x129562(0x248)]=_0x187cbb;}),_0x3a268d[_0x1e4d9c(0x23f)]((_0x5acd46,_0x455289)=>{var _0x30c5e0=_0x1e4d9c;_0x41d6ee[_0x455289][_0x30c5e0(0x19d)]=_0x5acd46;}),_0x39476f[_0x1e4d9c(0x23f)]((_0x8f5075,_0x5496b7)=>{var _0xe221a0=_0x1e4d9c;_0x41d6ee[_0x5496b7][_0xe221a0(0x15a)]=_0x8f5075;}),_0x4b102f[_0x1e4d9c(0x23f)]((_0x126446,_0x301094)=>{var _0x1bd20f=_0x1e4d9c;_0x41d6ee[_0x301094][_0x1bd20f(0x1cd)]=_0x126446;}),_0x23cf50[_0x1e4d9c(0x23f)]((_0x10fb44,_0x3d3b12)=>{var _0x2598f5=_0x1e4d9c;_0x41d6ee[_0x3d3b12][_0x2598f5(0x23d)]=_0x10fb44;}),_0x2362df['forEach']((_0x155e44,_0x1c8ca8)=>{var _0x287697=_0x1e4d9c;_0x41d6ee[_0x1c8ca8][_0x287697(0x1d9)]=_0x155e44;}),_0x39ec83[_0x1e4d9c(0x23f)]((_0xde05ac,_0x64806e)=>{var _0x319fe2=_0x1e4d9c;_0x41d6ee[_0x64806e][_0x319fe2(0x263)]=_0xde05ac;}),_0x38d57e[_0x1e4d9c(0x23f)]((_0x18ae13,_0x2f42b6)=>{var _0x2f7939=_0x1e4d9c;_0x41d6ee[_0x2f42b6][_0x2f7939(0x1b7)]=_0x18ae13;}),_0x36fce8['forEach']((_0x5db20f,_0x37676d)=>{var _0xee53e1=_0x1e4d9c;_0x41d6ee[_0x37676d][_0xee53e1(0x1bc)]=_0x5db20f;}),_0x3e5103[_0x1e4d9c(0x23f)]((_0x338326,_0x15c026)=>{var _0x44ed22=_0x1e4d9c;_0x41d6ee[_0x15c026][_0x44ed22(0x264)]=_0x338326;});const _0x1d5d87=_0x41d6ee[_0x1e4d9c(0x1fa)](_0x31c5db=>_0x31c5db['quantity']!=='0'&&_0x31c5db['quantity']!=='');_0x156d99['invoice']=_0x78921b,_0x156d99['suppliers']=_0x22ea3f,_0x156d99[_0x1e4d9c(0x158)]=_0x2abf71,_0x156d99[_0x1e4d9c(0x1f9)]=_0x57c315,_0x156d99[_0x1e4d9c(0x257)]=_0x1d5d87,_0x156d99[_0x1e4d9c(0x1e4)]=_0x1ac7bd,_0x156d99[_0x1e4d9c(0x276)]=_0x456311,_0x156d99[_0x1e4d9c(0x212)]=_0x108f26,_0x156d99[_0x1e4d9c(0x258)]=_0xdf9f64,_0x156d99[_0x1e4d9c(0x1f1)]=_0x5b7915,_0x156d99[_0x1e4d9c(0x269)]=_0x5e09c2;const _0x4716f5=await _0x156d99['save'](),_0x2c60fa=await warehouse[_0x1e4d9c(0x239)]({'name':_0x4f834b[_0x1e4d9c(0x1bf)]['warehouse_name'],'room':_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1ab)]});_0x156d99[_0x1e4d9c(0x257)]['forEach'](_0x12aa2a=>{var _0x1b98fc=_0x1e4d9c,_0x254ef6=0x0;const _0x4a4ea6=_0x2c60fa[_0x1b98fc(0x18a)]['map'](_0x255db9=>{var _0x5ae098=_0x1b98fc;_0x255db9[_0x5ae098(0x20c)]==_0x12aa2a[_0x5ae098(0x20c)]&&_0x255db9[_0x5ae098(0x19d)]==_0x12aa2a[_0x5ae098(0x19d)]&&_0x255db9[_0x5ae098(0x1b7)]==_0x12aa2a[_0x5ae098(0x1b7)]&&_0x255db9[_0x5ae098(0x248)]==_0x12aa2a[_0x5ae098(0x248)]&&_0x255db9['bay']==_0x12aa2a[_0x5ae098(0x1fe)]&&_0x255db9[_0x5ae098(0x264)]==_0x12aa2a['rack']&&_0x255db9[_0x5ae098(0x1bc)]==_0x12aa2a['storage']&&(_0x255db9[_0x5ae098(0x1b5)]=parseInt(_0x255db9['product_stock'])+parseInt(_0x12aa2a[_0x5ae098(0x171)]),_0x254ef6++);});_0x254ef6=='0'&&(_0x2c60fa[_0x1b98fc(0x18a)]=_0x2c60fa[_0x1b98fc(0x18a)][_0x1b98fc(0x1ff)]({'product_name':_0x12aa2a[_0x1b98fc(0x20c)],'product_stock':_0x12aa2a[_0x1b98fc(0x171)],'primary_code':_0x12aa2a[_0x1b98fc(0x15a)],'secondary_code':_0x12aa2a['secondary_code'],'product_code':_0x12aa2a[_0x1b98fc(0x181)],'storage':_0x12aa2a['storage'],'rack':_0x12aa2a[_0x1b98fc(0x264)],'bay':_0x12aa2a[_0x1b98fc(0x1fe)],'bin':_0x12aa2a['bin'],'type':_0x12aa2a[_0x1b98fc(0x1b7)],'floorlevel':_0x12aa2a[_0x1b98fc(0x19d)],'maxProducts':_0x12aa2a[_0x1b98fc(0x23d)],'unit':_0x12aa2a[_0x1b98fc(0x26c)],'secondary_unit':_0x12aa2a[_0x1b98fc(0x1f0)],'expiry_date':_0x12aa2a[_0x1b98fc(0x263)]}));}),await _0x2c60fa[_0x1e4d9c(0x201)]();const _0x5689ba=await s_payment_data[_0x1e4d9c(0x239)]({'invoice':_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1f3)]});if(_0x5689ba===null){}else console[_0x1e4d9c(0x1a8)](_0x1e4d9c(0x237),_0x5689ba,_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x1f3)]),_0x5689ba[_0x1e4d9c(0x237)]=_0x4f834b[_0x1e4d9c(0x1bf)][_0x1e4d9c(0x237)],await _0x5689ba['save']();_0x4f834b[_0x1e4d9c(0x208)](_0x1e4d9c(0x198),_0x1e4d9c(0x210)),_0x12ba15[_0x1e4d9c(0x24d)]('/all_purchases/view');}catch(_0x4940f9){console[_0x1e4d9c(0x1a8)](_0x4940f9);}}),router['post'](a0_0x5c2930(0x207),auth,async(_0x1cc620,_0x362e9a)=>{var _0x5645d3=a0_0x5c2930;try{const _0xb4c0b0=_0x1cc620[_0x5645d3(0x1b8)]['id'],{invoice:_0x262734,suppliers:_0x5a1459,payable:_0x29778d,due_amount:_0x10ea84}=_0x1cc620[_0x5645d3(0x1bf)],_0x4cf3d5=await purchases[_0x5645d3(0x1f7)](_0xb4c0b0);var _0x37fa52=_0x29778d-_0x10ea84;_0x4cf3d5[_0x5645d3(0x276)]=parseFloat(_0x4cf3d5[_0x5645d3(0x276)])+parseFloat(_0x10ea84),_0x4cf3d5[_0x5645d3(0x212)]=_0x37fa52;const _0x213457=await _0x4cf3d5[_0x5645d3(0x201)]();console[_0x5645d3(0x1a8)](_0x213457);const _0x2179f2=await s_payment_data[_0x5645d3(0x239)]({'invoice':_0x262734});_0x2179f2[_0x5645d3(0x19e)]=_0x37fa52,await _0x2179f2['save']();let _0x27073c=new Date(),_0x185f66=('0'+_0x27073c['getDate']())[_0x5645d3(0x1fb)](-0x2),_0x42d482=('0'+(_0x27073c['getMonth']()+0x1))['slice'](-0x2),_0x49ce89=_0x27073c[_0x5645d3(0x26e)](),_0x316431=_0x49ce89+'-'+_0x42d482+'-'+_0x185f66;const _0x337360=new suppliers_payment({'invoice':_0x262734,'date':_0x49ce89+'-'+_0x42d482+'-'+_0x185f66,'suppliers':_0x5a1459,'reason':_0x5645d3(0x1b4),'amount':_0x10ea84}),_0x54c247=await _0x337360[_0x5645d3(0x201)]();_0x1cc620[_0x5645d3(0x208)](_0x5645d3(0x198),'payment\x20successfull'),_0x362e9a[_0x5645d3(0x24d)](_0x5645d3(0x1f5));}catch(_0x413f57){console['log'](_0x413f57);}}),router[a0_0x5c2930(0x22a)](a0_0x5c2930(0x1f4),auth,async(_0xe1d983,_0x2e5d26)=>{var _0x49df93=a0_0x5c2930;try{const {username:_0x40da2f,email:_0x1630c5,role:_0x485067}=_0xe1d983['user'],_0x45db43=_0xe1d983[_0x49df93(0x22e)],_0x35e346=await profile[_0x49df93(0x239)]({'email':_0x45db43[_0x49df93(0x261)]}),_0x45fe16=await master_shop['find']();console['log'](_0x49df93(0x254),_0x45fe16);const _0x528fa2=_0xe1d983[_0x49df93(0x1b8)]['id'],_0x5538b0=await purchases[_0x49df93(0x1f7)](_0x528fa2);console[_0x49df93(0x1a8)](_0x5538b0);const _0xbf9fb3=await suppliers[_0x49df93(0x239)]({'name':_0x5538b0[_0x49df93(0x237)]});console['log'](_0xbf9fb3);if(_0x45fe16[0x0][_0x49df93(0x22c)]==_0x49df93(0x217)){var _0x2096cc=users['English'];console[_0x49df93(0x1a8)](_0x2096cc);}else{if(_0x45fe16[0x0]['language']==_0x49df93(0x222))var _0x2096cc=users[_0x49df93(0x222)];else{if(_0x45fe16[0x0][_0x49df93(0x22c)]==_0x49df93(0x19a))var _0x2096cc=users[_0x49df93(0x19a)];else{if(_0x45fe16[0x0][_0x49df93(0x22c)]==_0x49df93(0x227))var _0x2096cc=users[_0x49df93(0x227)];else{if(_0x45fe16[0x0][_0x49df93(0x22c)]=='French')var _0x2096cc=users[_0x49df93(0x202)];else{if(_0x45fe16[0x0][_0x49df93(0x22c)]==_0x49df93(0x180))var _0x2096cc=users['Portuguese'];else{if(_0x45fe16[0x0]['language']==_0x49df93(0x162))var _0x2096cc=users[_0x49df93(0x162)];else{if(_0x45fe16[0x0][_0x49df93(0x22c)]==_0x49df93(0x230))var _0x2096cc=users['Arabic'];}}}}}}}_0x2e5d26[_0x49df93(0x1f8)](_0x49df93(0x1e5),{'success':_0xe1d983[_0x49df93(0x208)]('success'),'errors':_0xe1d983[_0x49df93(0x208)](_0x49df93(0x26b)),'role':_0x45db43,'profile':_0x35e346,'master_shop':_0x45fe16,'supplier':_0xbf9fb3,'purchase':_0x5538b0,'language':_0x2096cc});}catch(_0x5d7554){console[_0x49df93(0x1a8)](_0x5d7554);}}),router[a0_0x5c2930(0x22a)]('/view/return_purchase/:id',auth,async(_0x4362c3,_0x5e76e9)=>{var _0x1b2b7a=a0_0x5c2930;try{const {username:_0x105bc7,email:_0x59d1e1,role:_0x58e249}=_0x4362c3[_0x1b2b7a(0x22e)],_0x3eb034=_0x4362c3[_0x1b2b7a(0x22e)],_0x4a2fe1=await profile[_0x1b2b7a(0x239)]({'email':_0x3eb034[_0x1b2b7a(0x261)]}),_0x51d328=await master_shop[_0x1b2b7a(0x274)]();console[_0x1b2b7a(0x1a8)](_0x1b2b7a(0x254),_0x51d328);const _0x4c25da=_0x4362c3[_0x1b2b7a(0x1b8)]['id'];console[_0x1b2b7a(0x1a8)](_0x4c25da);const _0x507480=await purchases[_0x1b2b7a(0x1f7)](_0x4c25da);console['log'](_0x1b2b7a(0x1c3),_0x507480);const _0x1d6e22=await product[_0x1b2b7a(0x274)]({}),_0x37a648=await warehouse['aggregate']([{'$match':{'name':_0x507480[_0x1b2b7a(0x1f9)],'room':_0x507480[_0x1b2b7a(0x258)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x1b2b7a(0x249)},{'$group':{'_id':_0x1b2b7a(0x175),'name':{'$first':_0x1b2b7a(0x268)},'product_stock':{'$first':_0x1b2b7a(0x199)},'bay':{'$first':_0x1b2b7a(0x25a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1b2b7a(0x159)},'floorlevel':{'$first':_0x1b2b7a(0x1e1)},'primary_code':{'$first':_0x1b2b7a(0x16b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1b2b7a(0x1fd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1b2b7a(0x1ea)}}}]);warehouse_data=await warehouse[_0x1b2b7a(0x260)]([{'$match':{'status':_0x1b2b7a(0x1e9),'name':'Return\x20Goods','warehouse_category':_0x1b2b7a(0x277)}},{'$group':{'_id':_0x1b2b7a(0x25e),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0x37a648);if(_0x51d328[0x0][_0x1b2b7a(0x22c)]==_0x1b2b7a(0x217)){var _0xb15878=users['English'];console[_0x1b2b7a(0x1a8)](_0xb15878);}else{if(_0x51d328[0x0][_0x1b2b7a(0x22c)]=='Hindi')var _0xb15878=users[_0x1b2b7a(0x222)];else{if(_0x51d328[0x0][_0x1b2b7a(0x22c)]=='German')var _0xb15878=users[_0x1b2b7a(0x19a)];else{if(_0x51d328[0x0]['language']==_0x1b2b7a(0x227))var _0xb15878=users['Spanish'];else{if(_0x51d328[0x0][_0x1b2b7a(0x22c)]=='French')var _0xb15878=users['French'];else{if(_0x51d328[0x0][_0x1b2b7a(0x22c)]=='Portuguese\x20(BR)')var _0xb15878=users['Portuguese'];else{if(_0x51d328[0x0][_0x1b2b7a(0x22c)]=='Chinese')var _0xb15878=users['Chinese'];else{if(_0x51d328[0x0]['language']==_0x1b2b7a(0x230))var _0xb15878=users[_0x1b2b7a(0x209)];}}}}}}}_0x5e76e9[_0x1b2b7a(0x1f8)](_0x1b2b7a(0x15f),{'success':_0x4362c3['flash'](_0x1b2b7a(0x198)),'errors':_0x4362c3[_0x1b2b7a(0x208)](_0x1b2b7a(0x26b)),'role':_0x3eb034,'profile':_0x4a2fe1,'user':_0x507480,'stock':_0x37a648,'master_shop':_0x51d328,'product':_0x1d6e22,'language':_0xb15878,'warehouse':warehouse_data});}catch(_0x4b54b8){console[_0x1b2b7a(0x1a8)](_0x4b54b8);}}),router[a0_0x5c2930(0x19c)](a0_0x5c2930(0x17e),auth,async(_0xaff9b4,_0x342c0f)=>{var _0x44e09e=a0_0x5c2930;try{const {invoice:_0x4a9130,date:_0x4ac546,warehouse_name:_0x1652ed,Room_name:_0x20026e,product_name:_0x3afc89,purchase_quantity:_0x3c710f,stocks:_0x460323,return_qty:_0x54ec1c,note:_0x12092d,level:_0x5f32a7,isle:_0x362d5a,pallet:_0x47e60e,to_warehouse_name:_0xb8ac92,to_Room_name:_0x2194ef}=_0xaff9b4['body'],_0x3f2540=await purchases[_0x44e09e(0x239)]({'_id':_0xaff9b4[_0x44e09e(0x1b8)]['id']}),_0x4f25ed=await warehouse[_0x44e09e(0x239)]({'name':_0x1652ed,'room':_0x20026e});if(typeof _0x3afc89==_0x44e09e(0x1e3))var _0x496bb7=[_0xaff9b4['body'][_0x44e09e(0x20c)]],_0x1fa540=[_0xaff9b4['body']['purchase_quantity']],_0x3a6c2c=[_0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x190)]],_0x1b3d0f=[_0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x1c4)]],_0x3f3a11=[_0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x21a)]],_0x1c7f02=[_0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x186)]],_0x141ee7=[_0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x20f)]],_0x40fab2=[_0xaff9b4['body'][_0x44e09e(0x17d)]],_0x4ac070=[_0xaff9b4['body']['product_code_hide']],_0x3f06bd=[_0xaff9b4[_0x44e09e(0x1bf)]['primary_code_hide']],_0x262e41=[_0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x166)]];else var _0x496bb7=[..._0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x20c)]],_0x1fa540=[..._0xaff9b4[_0x44e09e(0x1bf)]['purchase_quantity']],_0x3a6c2c=[..._0xaff9b4['body'][_0x44e09e(0x190)]],_0x1b3d0f=[..._0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x1c4)]],_0x3f3a11=[..._0xaff9b4[_0x44e09e(0x1bf)]['level']],_0x1c7f02=[..._0xaff9b4['body']['isle']],_0x141ee7=[..._0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x20f)]],_0x40fab2=[..._0xaff9b4[_0x44e09e(0x1bf)][_0x44e09e(0x17d)]],_0x4ac070=[..._0xaff9b4['body'][_0x44e09e(0x1e8)]],_0x3f06bd=[..._0xaff9b4['body'][_0x44e09e(0x24e)]],_0x262e41=[..._0xaff9b4['body']['secondary_code_hide']];const _0x1e2903=_0x496bb7['map'](_0x35a7bc=>{return _0x35a7bc={'product_name':_0x35a7bc};});_0x1fa540[_0x44e09e(0x23f)]((_0x4153e9,_0x28221b)=>{_0x1e2903[_0x28221b]['purchase_quantity']=_0x4153e9;}),_0x3a6c2c[_0x44e09e(0x23f)]((_0x199782,_0x25acb3)=>{var _0x457d67=_0x44e09e;_0x1e2903[_0x25acb3][_0x457d67(0x173)]=_0x199782;}),_0x1b3d0f['forEach']((_0x19683d,_0x205e8d)=>{var _0x2ce96d=_0x44e09e;_0x1e2903[_0x205e8d][_0x2ce96d(0x1c4)]=_0x19683d;}),_0x3f3a11[_0x44e09e(0x23f)]((_0x390841,_0x13dad5)=>{var _0x1b034=_0x44e09e;_0x1e2903[_0x13dad5][_0x1b034(0x1fe)]=_0x390841;}),_0x1c7f02[_0x44e09e(0x23f)]((_0x4b153b,_0x55b6a1)=>{var _0x288ab9=_0x44e09e;_0x1e2903[_0x55b6a1][_0x288ab9(0x248)]=_0x4b153b;}),_0x141ee7[_0x44e09e(0x23f)]((_0x547754,_0x3c7f87)=>{var _0x18d794=_0x44e09e;_0x1e2903[_0x3c7f87][_0x18d794(0x19d)]=_0x547754;}),_0x40fab2[_0x44e09e(0x23f)]((_0x705863,_0x1490d8)=>{var _0x4389cc=_0x44e09e;_0x1e2903[_0x1490d8][_0x4389cc(0x1b7)]=_0x705863;}),_0x4ac070[_0x44e09e(0x23f)]((_0x150821,_0x1034fa)=>{var _0x5bafc4=_0x44e09e;_0x1e2903[_0x1034fa][_0x5bafc4(0x181)]=_0x150821;}),_0x3f06bd['forEach']((_0x521810,_0x142da3)=>{_0x1e2903[_0x142da3]['primary_code']=_0x521810;}),_0x262e41['forEach']((_0x76c656,_0x48637f)=>{var _0x46cf05=_0x44e09e;_0x1e2903[_0x48637f][_0x46cf05(0x1cd)]=_0x76c656;}),_0x3f2540[_0x44e09e(0x257)]['forEach'](_0x372328=>{var _0x17e274=_0x44e09e;const _0x2ad31c=_0x4f25ed[_0x17e274(0x18a)][_0x17e274(0x251)](_0x54e22a=>{var _0x559144=_0x17e274;_0x54e22a[_0x559144(0x20c)]==_0x372328[_0x559144(0x20c)]&&_0x54e22a[_0x559144(0x19d)]==_0x372328[_0x559144(0x19d)]&&_0x54e22a[_0x559144(0x1b7)]==_0x372328[_0x559144(0x1b7)]&&_0x54e22a[_0x559144(0x248)]==_0x372328['bin']&&_0x54e22a[_0x559144(0x1fe)]==_0x372328[_0x559144(0x1fe)]&&_0x54e22a[_0x559144(0x264)]==_0x372328[_0x559144(0x264)]&&_0x54e22a[_0x559144(0x1bc)]==_0x372328[_0x559144(0x1bc)]&&(console[_0x559144(0x1a8)](parseInt(_0x54e22a[_0x559144(0x1b5)])+_0x559144(0x25b)+parseInt(_0x372328[_0x559144(0x171)])),_0x54e22a[_0x559144(0x1b5)]=parseInt(_0x54e22a['product_stock'])+parseInt(_0x372328[_0x559144(0x171)]));});}),await _0x4f25ed[_0x44e09e(0x201)]();const _0x3a2c16=_0x1e2903[_0x44e09e(0x1fa)](_0xa6e450=>_0xa6e450[_0x44e09e(0x1c4)]!=='0'&&_0xa6e450[_0x44e09e(0x1c4)]!=='');var _0x448cc2=0x0;_0x3a2c16['forEach'](_0x58b4e3=>{var _0x463fcf=_0x44e09e;console[_0x463fcf(0x1a8)](_0x463fcf(0x200),_0x58b4e3),(parseInt(_0x58b4e3[_0x463fcf(0x26d)])<parseInt(_0x58b4e3[_0x463fcf(0x1c4)])||parseInt(_0x58b4e3[_0x463fcf(0x173)])<parseInt(_0x58b4e3[_0x463fcf(0x1c4)]))&&_0x448cc2++;});if(_0x448cc2!=0x0)return _0xaff9b4[_0x44e09e(0x208)](_0x44e09e(0x26b),_0x44e09e(0x233)),_0x342c0f['redirect'](_0x44e09e(0x1e0));const _0x285f6a=new purchases_return({'invoice':_0x4a9130,'suppliers':_0xaff9b4['body'][_0x44e09e(0x237)],'date':_0x4ac546,'warehouse_name':_0x1652ed,'return_product':_0x3a2c16,'note':_0x12092d,'room':_0x20026e,'to_warehouse_name':_0xb8ac92,'to_room':_0x2194ef}),_0xd0fe72=await _0x285f6a[_0x44e09e(0x201)]();console[_0x44e09e(0x1a8)](_0x285f6a);const _0x2038ba=await purchases_return[_0x44e09e(0x239)]({'invoice':_0x4a9130}),_0x24da77=await warehouse['findOne']({'name':_0xb8ac92,'room':_0x2194ef});_0x2038ba[_0x44e09e(0x1a7)][_0x44e09e(0x23f)](_0x713848=>{var _0x48f5f7=_0x44e09e,_0x373200=0x0;const _0x27ae91=_0x24da77[_0x48f5f7(0x18a)][_0x48f5f7(0x251)](_0x45799a=>{var _0x284009=_0x48f5f7;_0x45799a[_0x284009(0x20c)]==_0x713848[_0x284009(0x20c)]&&_0x45799a[_0x284009(0x19d)]==_0x713848[_0x284009(0x19d)]&&_0x45799a[_0x284009(0x1b7)]==_0x713848[_0x284009(0x1b7)]&&_0x45799a[_0x284009(0x248)]==_0x713848[_0x284009(0x248)]&&_0x45799a[_0x284009(0x1fe)]==_0x713848[_0x284009(0x1fe)]&&(_0x45799a[_0x284009(0x1b5)]=parseInt(_0x45799a['product_stock'])-parseInt(_0x713848[_0x284009(0x1c4)]),_0x373200++);});_0x373200=='0'&&(_0x24da77[_0x48f5f7(0x18a)]=_0x24da77['product_details']['concat']({'product_name':_0x713848[_0x48f5f7(0x20c)],'product_stock':_0x713848[_0x48f5f7(0x1c4)],'primary_code':_0x713848[_0x48f5f7(0x15a)],'secondary_code':_0x713848[_0x48f5f7(0x1cd)],'product_code':_0x713848[_0x48f5f7(0x181)],'storage':_0x713848['storage'],'rack':_0x713848[_0x48f5f7(0x264)],'bay':_0x713848[_0x48f5f7(0x1fe)],'bin':_0x713848[_0x48f5f7(0x248)],'type':_0x713848[_0x48f5f7(0x1b7)],'floorlevel':_0x713848[_0x48f5f7(0x19d)],'maxProducts':_0x713848['maxStocks'],'unit':_0x713848['standard_unit'],'secondary_unit':_0x713848[_0x48f5f7(0x1f0)],'expiry_date':_0x713848[_0x48f5f7(0x263)]}));}),await _0x24da77['save']();const _0x58a028=await purchases['findOne']({'invoice':_0x4a9130});_0x58a028[_0x44e09e(0x1cb)]='True';const _0x57a67f=await _0x58a028['save'](),_0x3c6e5e=new s_payment_data({'invoice':_0x4a9130,'suppliers':_0xaff9b4['body'][_0x44e09e(0x237)],'reason':'Purchase\x20Return'});await _0x3c6e5e['save']();const _0x3c3c44=await master_shop[_0x44e09e(0x274)]();console['log'](_0x44e09e(0x21b),_0x3c3c44[0x0]['image']);const _0x2ea7ba=await email_settings[_0x44e09e(0x239)](),_0x9a2615=await suppliers[_0x44e09e(0x239)]({'name':_0xaff9b4[_0x44e09e(0x1bf)]['suppliers']});console['log'](_0x44e09e(0x1d8),_0x9a2615);_0x3c3c44[0x0][_0x44e09e(0x178)]==0x1?(right_currency=_0x3c3c44[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3c3c44[0x0][_0x44e09e(0x219)]);var _0x1d3de6=_0x496bb7,_0xab0780=_0x1b3d0f,_0x5ab69e='',_0x31e78b;for(_0x31e78b in _0x1d3de6){_0x5ab69e+=_0x44e09e(0x1a5)+_0x44e09e(0x253)+_0x1d3de6[_0x31e78b]+_0x44e09e(0x1b2)+_0x44e09e(0x253)+_0xab0780[_0x31e78b]+_0x44e09e(0x1b2)+'</tr>';}console[_0x44e09e(0x1a8)](_0x44e09e(0x206),_0x5ab69e);let _0x4512a3=nodemailer[_0x44e09e(0x15e)]({'service':_0x44e09e(0x163),'auth':{'user':_0x2ea7ba[_0x44e09e(0x261)],'pass':_0x2ea7ba[_0x44e09e(0x1e2)]}}),_0x441394={'from':_0x2ea7ba[_0x44e09e(0x261)],'to':_0x9a2615['email'],'subject':_0x44e09e(0x18b),'attachments':[{'filename':_0x44e09e(0x241),'path':__dirname+'/../public'+_0x44e09e(0x1ce)+_0x3c3c44[0x0]['image'],'cid':'logo'}],'html':_0x44e09e(0x1ba)+'<html><head><title></title>'+_0x44e09e(0x17f)+_0x44e09e(0x220)+_0x44e09e(0x1c8)+_0x44e09e(0x220)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x44e09e(0x24f)+_0x44e09e(0x220)+'<h2>\x20'+_0x3c3c44[0x0]['site_title']+_0x44e09e(0x156)+_0x44e09e(0x24f)+_0x44e09e(0x24f)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x44e09e(0x223)+_0x4a9130+'\x20'+_0x44e09e(0x1c7)+_0x44e09e(0x188)+_0x4ac546+'\x20'+_0x44e09e(0x189)+_0x44e09e(0x16e)+_0x44e09e(0x24f)+_0x44e09e(0x270)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x44e09e(0x169)+_0x44e09e(0x172)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x44e09e(0x272)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5ab69e+'\x20'+_0x44e09e(0x25c)+'</table>'+_0x44e09e(0x220)+_0x44e09e(0x242)+_0x44e09e(0x187)+_0x3c3c44[0x0]['site_title']+'</h5>'+_0x44e09e(0x24f)+_0x44e09e(0x24f)+_0x44e09e(0x1df)};_0x4512a3['sendMail'](_0x441394,function(_0x12ffa1,_0x57f6ae){var _0x29110f=_0x44e09e;_0x12ffa1?(console[_0x29110f(0x1a8)](_0x12ffa1),console[_0x29110f(0x1a8)](_0x29110f(0x1b0))):console['log'](_0x29110f(0x16d));}),_0xaff9b4['flash'](_0x44e09e(0x198),'purchases\x20item\x20return\x20successfull'),_0x342c0f[_0x44e09e(0x24d)](_0x44e09e(0x1f5));}catch(_0x296061){console[_0x44e09e(0x1a8)](_0x296061),_0x342c0f['status'](0xc8)['json']({'message':_0x296061[_0x44e09e(0x1be)]});}}),router['get'](a0_0x5c2930(0x26f),auth,async(_0x574c0,_0x987034)=>{var _0x1bbaba=a0_0x5c2930;try{const {username:_0x22a7ec,email:_0x4078f4,role:_0x14f40b}=_0x574c0['user'],_0x69ed72=_0x574c0[_0x1bbaba(0x22e)],_0x10d762=await profile['findOne']({'email':_0x69ed72[_0x1bbaba(0x261)]}),_0x536603=await master_shop[_0x1bbaba(0x274)](),_0x4b9a0f=_0x574c0[_0x1bbaba(0x1b8)]['id'],_0xe79876=await purchases['findById'](_0x4b9a0f);if(_0x536603[0x0][_0x1bbaba(0x22c)]==_0x1bbaba(0x217))var _0x1d876a=users[_0x1bbaba(0x23b)];else{if(_0x536603[0x0]['language']=='Hindi')var _0x1d876a=users[_0x1bbaba(0x222)];else{if(_0x536603[0x0][_0x1bbaba(0x22c)]==_0x1bbaba(0x19a))var _0x1d876a=users[_0x1bbaba(0x19a)];else{if(_0x536603[0x0]['language']==_0x1bbaba(0x227))var _0x1d876a=users[_0x1bbaba(0x227)];else{if(_0x536603[0x0][_0x1bbaba(0x22c)]==_0x1bbaba(0x202))var _0x1d876a=users[_0x1bbaba(0x202)];else{if(_0x536603[0x0]['language']=='Portuguese\x20(BR)')var _0x1d876a=users[_0x1bbaba(0x214)];else{if(_0x536603[0x0]['language']==_0x1bbaba(0x162))var _0x1d876a=users[_0x1bbaba(0x162)];else{if(_0x536603[0x0]['language']==_0x1bbaba(0x230))var _0x1d876a=users[_0x1bbaba(0x209)];}}}}}}}_0x987034[_0x1bbaba(0x1f8)](_0x1bbaba(0x215),{'success':_0x574c0[_0x1bbaba(0x208)](_0x1bbaba(0x198)),'errors':_0x574c0['flash'](_0x1bbaba(0x26b)),'role':_0x69ed72,'profile':_0x10d762,'alldata':_0xe79876,'master_shop':_0x536603,'language':_0x1d876a}),console[_0x1bbaba(0x1a8)](alldata);}catch(_0x2adf7c){console[_0x1bbaba(0x1a8)](_0x2adf7c);}}),router['post'](a0_0x5c2930(0x245),async(_0x3ab363,_0x4da313)=>{var _0x4ab1ae=a0_0x5c2930;const {product_code:_0x3498a9}=_0x3ab363[_0x4ab1ae(0x1bf)];var _0x13b0a5;const _0x1539a7=await product[_0x4ab1ae(0x260)]([{'$match':{'primary_code':_0x3498a9,'product_category':_0x4ab1ae(0x277)}},{'$group':{'_id':_0x4ab1ae(0x23c),'name':{'$first':_0x4ab1ae(0x25e)},'category':{'$first':_0x4ab1ae(0x196)},'brand':{'$first':_0x4ab1ae(0x15b)},'unit':{'$first':_0x4ab1ae(0x20a)},'alertquantity':{'$first':_0x4ab1ae(0x1a6)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x4ab1ae(0x20e)},'secondary_code':{'$first':_0x4ab1ae(0x235)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4ab1ae(0x234)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4ab1ae(0x193)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x53eaf9=await product['aggregate']([{'$match':{'secondary_code':_0x3498a9,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4ab1ae(0x23c),'name':{'$first':_0x4ab1ae(0x25e)},'category':{'$first':'$category'},'brand':{'$first':_0x4ab1ae(0x15b)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x4ab1ae(0x21c)},'primary_code':{'$first':_0x4ab1ae(0x20e)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4ab1ae(0x24a)},'maxProdPerUnit':{'$first':_0x4ab1ae(0x234)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4ab1ae(0x193)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1539a7[_0x4ab1ae(0x1a9)]>0x0)_0x13b0a5=_0x1539a7;else _0x53eaf9[_0x4ab1ae(0x1a9)]>0x0&&(_0x13b0a5=_0x53eaf9);_0x4da313[_0x4ab1ae(0x165)](_0x13b0a5);}),router[a0_0x5c2930(0x19c)](a0_0x5c2930(0x262),async(_0x10fda3,_0x5d6c84)=>{var _0x4d454a=a0_0x5c2930;const {primaryCode:_0x2947f2,secondaryCode:_0x2773ce,productCode:_0x330c34,bay:_0x17e26d,bin:_0x3babd2,types:_0x43f34c,pallet:_0x490819,warehouses:_0x10e542,room:_0x33e17a}=_0x10fda3[_0x4d454a(0x1bf)];console[_0x4d454a(0x1a8)](_0x10fda3[_0x4d454a(0x1bf)]);try{const _0x19c013=await warehouse[_0x4d454a(0x260)]([{'$match':{'name':_0x10e542,'room':_0x33e17a}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x17e26d,'product_details.bin':_0x3babd2,'product_details.type':_0x43f34c}},{'$group':{'_id':_0x4d454a(0x175),'name':{'$first':_0x4d454a(0x268)},'product_stock':{'$first':_0x4d454a(0x199)},'level':{'$first':_0x4d454a(0x1bd)},'isle':{'$first':_0x4d454a(0x224)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x4d454a(0x265)}}}]);_0x5d6c84[_0x4d454a(0x22f)](0xc8)[_0x4d454a(0x165)](_0x19c013);}catch(_0x453b7e){_0x5d6c84[_0x4d454a(0x22f)](0x194)['json']({'message':_0x453b7e['message']});}}),module[a0_0x5c2930(0x177)]=router;