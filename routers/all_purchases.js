var a0_0xa8e186=a0_0x3bde;(function(_0x2ab1b7,_0x2f454c){var _0x17eb86=a0_0x3bde,_0x5da4a4=_0x2ab1b7();while(!![]){try{var _0xc1767=parseInt(_0x17eb86(0x25b))/0x1+-parseInt(_0x17eb86(0x19c))/0x2+-parseInt(_0x17eb86(0x1fe))/0x3*(-parseInt(_0x17eb86(0x18d))/0x4)+-parseInt(_0x17eb86(0x18e))/0x5+parseInt(_0x17eb86(0x1a2))/0x6+-parseInt(_0x17eb86(0x1f9))/0x7+-parseInt(_0x17eb86(0x251))/0x8*(parseInt(_0x17eb86(0x23e))/0x9);if(_0xc1767===_0x2f454c)break;else _0x5da4a4['push'](_0x5da4a4['shift']());}catch(_0x1f7a82){_0x5da4a4['push'](_0x5da4a4['shift']());}}}(a0_0x4983,0xa9aee));const express=require(a0_0xa8e186(0x1a5)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xa8e186(0x288)),auth=require(a0_0xa8e186(0x27c)),nodemailer=require(a0_0xa8e186(0x1dc));function a0_0x4983(){var _0x526f16=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_level','production_date','flash','$product.room_name','/all_purchases/view','error','Level','INC-','Portuguese\x20(BR)','$suppliers','$product_details.product_name','prod_secondunit','</span>','product_cat','Paid\x20For\x20Purchase','</thead>','post','Rack\x20A','</h5>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','string','product_name','$product_code','An\x20error\x20occurred\x20while\x20saving\x20data.','4564462WkeyXZ','product','warehouse_name','../public/language/languages.json','<strong>\x20Regards\x20</strong>','3Zyzpxs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','maxStocks','RoomAssign','<html><head><title></title>','logo','\x20<>\x20','prod_unit','prod_isle','return_qty','stock_quantity','Purchase\x20data\x20added\x20successfully','table\x20page','secondary_code_hide','</div>','language','pallet','Chinese','Rack\x20F','$product_details.product_code','abs','map','/view/add_purchases/:id','room','room_name','</table>','then','$suppliers_docs','$product_details.product_stock','push','Portuguese','<h5\x20style=\x22text-align:\x20left;\x22>','$paid_amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Error\x20Occurs','English','product_details','/barcode_scanner','$warehouse_name','get','$product_details.isle','role','Hindi','Rack\x20E','getMonth','French','actual_uom','$product_details.expiry_date','Floor','prod_code','name','<hr\x20class=\x22my-3\x22>','params','prod_qty','<tr>','$name','$room','image','$product_details.primary_code','back','batch_code','actual_qty','paid_amount','add_purchases','25461AcWRXz','success','render','findOne','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','expiry_date','$product_details._id','forEach','Email\x20sent\x20successfully','True','currency_placement','secondary_unit','storage','$product_details.secondary_code','/invoice/:id','$product_details.rack','$category','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','616grlKTw','</body></html>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details','/view/add_purchases','$note','prod_pallet','save','all','Logo.png','120643HXpYFl','DRY\x20STORAGE','</head><body>','types','$product_details.level','master','edit_purchases','$product.type','deliverycode','$product_details.maxProducts','$product.bay','$product_details.floorlevel','$primary_code','<h2>\x20','/view/:id','primary_code','</td>','slice','/upload/','Rack\x20B','max_product_unit','standard_unit','all_purchases_barcode','user_id','redirect','German','suppliers_docs','Purchase\x20Mail','due_amount','rack','product_stock','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_primunit','../middleware/auth','JO_number','suppliers_data','/CheckingWarehouse','quantity','user','Enabled','</tr>','date','stocks','json','Return\x20Goods','../models/all_models','$maxProdPerUnit','currency','prod_cat','English\x20(US)','$product_details.storage','random','secondary_code','add_purchases\x20error','purchase_invoice','product_code_hide','port','filter','/all_purchases/view/','Ambient','type','findById','createTransport','warehouse','suppliers','gmail','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','alertQTY','\x20Order\x20Number\x20:\x20','/preview/:id','return_product','$product_details.bin','bin','$due_amount','Purchase\x20Return','RMSEmail','$batch_code','<!DOCTYPE\x20html>','aggregate','catch','finalize','stock_data','$alertquantity','bay','product_code','5508868ZvTtgC','2422690loGaZy','\x20</h2>','$invoice','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','concat','Enclosed','purchase_quantity','floorlevel','site_title','edit_purchases_view','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','here','199640LcvclV','Rack\x20D','message','$brand','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Shelves','3908514HnDdtJ','length','invoice','express','status','body','<div>','email','getFullYear','$product.floorlevel','find','$maxStocks','/view','$secondary_unit','primary_code_hide','<h5>','$product.bin','delivery_code','$finalize','host','$return_data','Raw\x20Materials','MaxStocks_data','Purchase\x20Return\x20Mail','return_purchase','exports','padStart','/give_payment/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','path','$unit','Arabic\x20(ae)','$product','getDate','password','prod_Qty','delivery_date','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','isle','/view/return_purchase/:id','$secondary_code','maxperunit','$_id','prod_name','log','</tbody>','$product_details.bay','purchases\x20item\x20return\x20successfull','return_data','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<span\x20style=\x22float:\x20right;\x22>','Sales\x20Update\x20successfully','$date','floor','$expiry_date','nodemailer','Spanish','An\x20error\x20occurred.','Arabic'];a0_0x4983=function(){return _0x526f16;};return a0_0x4983();}var ejs=require('ejs');const path=require(a0_0xa8e186(0x1bf)),users=require(a0_0xa8e186(0x1fc));function a0_0x3bde(_0xec3f52,_0x306ec2){var _0x49837c=a0_0x4983();return a0_0x3bde=function(_0x3bdec7,_0x2b6abb){_0x3bdec7=_0x3bdec7-0x175;var _0x4ca58f=_0x49837c[_0x3bdec7];return _0x4ca58f;},a0_0x3bde(_0xec3f52,_0x306ec2);}router[a0_0xa8e186(0x225)](a0_0xa8e186(0x1ae),auth,async(_0x2f40b4,_0x284fbf)=>{var _0x5b2b0a=a0_0xa8e186;try{const {username:_0x59511c,email:_0x550a66,role:_0x4cef4c}=_0x2f40b4[_0x5b2b0a(0x281)],_0x5a06ab=_0x2f40b4[_0x5b2b0a(0x281)],_0x2ae1c2=await profile['findOne']({'email':_0x5a06ab[_0x5b2b0a(0x1a9)]}),_0x5b2a23=await staff[_0x5b2b0a(0x241)]({'email':_0x5a06ab['email']});if(_0x5a06ab[_0x5b2b0a(0x227)]=='staff'){const _0x4e3ab5=await staff[_0x5b2b0a(0x241)]({'email':_0x5a06ab['email']});}const _0x7da187=await master_shop[_0x5b2b0a(0x1ac)]();let _0x3cd21d;if(_0x5a06ab[_0x5b2b0a(0x227)]=='staff'){const _0xd60a82=await staff[_0x5b2b0a(0x241)]({'email':_0x5a06ab[_0x5b2b0a(0x1a9)]});_0x3cd21d=await purchases[_0x5b2b0a(0x186)]([{'$match':{'warehouse_name':_0xd60a82[_0x5b2b0a(0x176)]}},{'$lookup':{'from':'suppliers','localField':_0x5b2b0a(0x177),'foreignField':_0x5b2b0a(0x230),'as':_0x5b2b0a(0x275)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x5b2b0a(0x1cd),'invoice':{'$first':_0x5b2b0a(0x190)},'suppliers':{'$first':_0x5b2b0a(0x1ea)},'date':{'$first':_0x5b2b0a(0x1d9)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x5b2b0a(0x236)},'product':{'$push':_0x5b2b0a(0x1c2)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5b2b0a(0x21e)},'due_amount':{'$first':_0x5b2b0a(0x181)},'return_data':{'$first':_0x5b2b0a(0x1b6)},'batch_code':{'$first':_0x5b2b0a(0x184)},'expiry_date':{'$first':_0x5b2b0a(0x1db)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x5b2b0a(0x265)},'isle':{'$addToSet':_0x5b2b0a(0x1b2)},'type':{'$addToSet':_0x5b2b0a(0x262)},'floorlevel':{'$addToSet':_0x5b2b0a(0x1ab)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3cd21d=await purchases[_0x5b2b0a(0x186)]([{'$lookup':{'from':_0x5b2b0a(0x177),'localField':_0x5b2b0a(0x177),'foreignField':_0x5b2b0a(0x230),'as':'suppliers_docs'}},{'$unwind':_0x5b2b0a(0x219)},{'$unwind':_0x5b2b0a(0x1c2)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5b2b0a(0x190)},'suppliers':{'$first':_0x5b2b0a(0x1ea)},'date':{'$first':_0x5b2b0a(0x1d9)},'warehouse_name':{'$first':_0x5b2b0a(0x224)},'room':{'$addToSet':_0x5b2b0a(0x1e4)},'product':{'$push':'$product'},'note':{'$first':_0x5b2b0a(0x256)},'paid_amount':{'$first':_0x5b2b0a(0x21e)},'due_amount':{'$first':_0x5b2b0a(0x181)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5b2b0a(0x184)},'expiry_date':{'$first':_0x5b2b0a(0x1db)},'suppliers_docs':{'$first':_0x5b2b0a(0x219)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x5b2b0a(0x1b2)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x5b2b0a(0x1ab)},'finalize':{'$first':_0x5b2b0a(0x1b4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x7da187[0x0][_0x5b2b0a(0x20d)]==_0x5b2b0a(0x28c)){var _0x42ca05=users[_0x5b2b0a(0x221)];console['log'](_0x42ca05);}else{if(_0x7da187[0x0]['language']==_0x5b2b0a(0x228))var _0x42ca05=users[_0x5b2b0a(0x228)];else{if(_0x7da187[0x0][_0x5b2b0a(0x20d)]==_0x5b2b0a(0x274))var _0x42ca05=users[_0x5b2b0a(0x274)];else{if(_0x7da187[0x0][_0x5b2b0a(0x20d)]=='Spanish')var _0x42ca05=users[_0x5b2b0a(0x1dd)];else{if(_0x7da187[0x0]['language']=='French')var _0x42ca05=users[_0x5b2b0a(0x22b)];else{if(_0x7da187[0x0][_0x5b2b0a(0x20d)]=='Portuguese\x20(BR)')var _0x42ca05=users['Portuguese'];else{if(_0x7da187[0x0]['language']==_0x5b2b0a(0x20f))var _0x42ca05=users['Chinese'];else{if(_0x7da187[0x0]['language']==_0x5b2b0a(0x1c1))var _0x42ca05=users['Arabic'];}}}}}}}_0x284fbf[_0x5b2b0a(0x240)]('all_purchases',{'success':_0x2f40b4['flash'](_0x5b2b0a(0x23f)),'errors':_0x2f40b4[_0x5b2b0a(0x1e3)]('errors'),'purchases':_0x3cd21d,'role':_0x5a06ab,'profile':_0x2ae1c2,'master_shop':_0x7da187,'language':_0x42ca05});}catch(_0x590a19){console['log'](_0x5b2b0a(0x20a),_0x590a19),_0x284fbf[_0x5b2b0a(0x1a6)](0xc8)[_0x5b2b0a(0x286)]({'message':_0x590a19[_0x5b2b0a(0x19e)]});}});function BayBinSelected(_0x13bc7b,_0x38f105){var _0x3e81b9=a0_0xa8e186,_0x77a8df=[],_0x492384=[],_0x4db14b=[],_0x1bed50=[],_0x35496a=[],_0x468895=[];let _0x2eddb3=[];if(_0x13bc7b==_0x3e81b9(0x25c))switch(_0x38f105){case _0x3e81b9(0x1f2):_0x77a8df=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x492384=[0x1,0x2],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7),_0x3e81b9(0x22e)],_0x35496a=['D'],_0x468895=['A'];break;case _0x3e81b9(0x26e):_0x77a8df=[0x6,0x5,0x4,0x3,0x2,0x1],_0x492384=[0x1,0x2],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7),_0x3e81b9(0x22e)],_0x35496a=['D'],_0x468895=['B'];break;case _0x3e81b9(0x1a1):_0x77a8df=[0x0],_0x492384=[0x0],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x22e)],_0x35496a=['D'],_0x468895=['S'];break;case'Receiving\x20Area':_0x77a8df=[0x0],_0x492384=[0x0],_0x1bed50=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4db14b=[_0x3e81b9(0x22e)],_0x35496a=['D'],_0x468895=['R'];break;}else{if(_0x13bc7b=='COLD\x20STORAGE')switch(_0x38f105){case _0x3e81b9(0x1f2):_0x77a8df=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x492384=['B','F'],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7),'Floor'],_0x35496a=['C'],_0x468895=['A'];break;case'Rack\x20B':_0x77a8df=[0x5,0x4,0x3,0x2,0x1],_0x492384=['F','B','S'],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7),_0x3e81b9(0x22e)],_0x35496a=['C'],_0x468895=['B'];break;case'Rack\x20C':_0x77a8df=[0x1,0x2,0x3,0x4,0x5],_0x492384=['B','F','S'],_0x1bed50=[0x5,0x4,0x3,0x2,0x1],_0x4db14b=[_0x3e81b9(0x1e7),'Floor'],_0x35496a=['C'],_0x468895=['C'];break;case _0x3e81b9(0x19d):_0x77a8df=[0x5,0x4,0x3,0x2,0x1],_0x492384=['F','B','S'],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7),'Floor'],_0x35496a=['C'],_0x468895=['D'];break;case _0x3e81b9(0x229):_0x77a8df=[0x4,0x3,0x2,0x1],_0x492384=[0x1,0x2],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7),_0x3e81b9(0x22e)],_0x35496a=['C'],_0x468895=['E'];break;case _0x3e81b9(0x210):_0x77a8df=[0x1,0x2,0x3],_0x492384=[0x1,0x2],_0x1bed50=[0x1,0x2,0x3,0x4,0x5],_0x4db14b=[_0x3e81b9(0x1e7)],_0x35496a=['C'],_0x468895=['F'];break;}}return{'levels':_0x77a8df,'Isle':_0x492384,'rack':_0x1bed50,'type':_0x4db14b,'storage':_0x35496a,'rak':_0x468895};}async function getRandom8DigitNumber(){var _0x7e3b1a=a0_0xa8e186;const _0x24e282=0x989680,_0x8df562=0x5f5e0ff,_0x902d0d=Math[_0x7e3b1a(0x1da)](Math[_0x7e3b1a(0x28e)]()*(_0x8df562-_0x24e282+0x1))+_0x24e282;var _0x3a6a9f;const _0x4deedf=await purchases[_0x7e3b1a(0x241)]({'invoice':'INC-'+_0x902d0d});return _0x4deedf&&_0x4deedf[_0x7e3b1a(0x1a3)]>0x0?_0x3a6a9f=_0x7e3b1a(0x1e8)+_0x902d0d:_0x3a6a9f='INC-'+_0x902d0d,_0x3a6a9f;}router['get'](a0_0xa8e186(0x255),auth,async(_0xba8415,_0x13b56e)=>{var _0x5ec1bd=a0_0xa8e186;try{const {username:_0x3289a6,email:_0xa7a4f,role:_0x33753b}=_0xba8415[_0x5ec1bd(0x281)],_0x3550a3=_0xba8415[_0x5ec1bd(0x281)],_0x511356=await profile[_0x5ec1bd(0x241)]({'email':_0x3550a3['email']}),_0xdfb46a=await master_shop[_0x5ec1bd(0x1ac)](),_0x166314=await staff[_0x5ec1bd(0x241)]({'email':_0x3550a3[_0x5ec1bd(0x1a9)]}),_0x2b284c=await suppliers[_0x5ec1bd(0x1ac)]({});let _0x13053f;if(_0x3550a3[_0x5ec1bd(0x227)]=='staff'){const _0x1ea798=await staff['findOne']({'email':_0x3550a3[_0x5ec1bd(0x1a9)]});_0x13053f=await warehouse['aggregate']([{'$match':{'status':_0x5ec1bd(0x282),'name':_0x1ea798[_0x5ec1bd(0x176)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x5ec1bd(0x287)}}},{'$group':{'_id':'$name','name':{'$first':_0x5ec1bd(0x235)}}}]);}else _0x13053f=await warehouse['aggregate']([{'$match':{'status':_0x5ec1bd(0x282),'warehouse_category':_0x5ec1bd(0x1b7),'name':{'$ne':_0x5ec1bd(0x287)}}},{'$group':{'_id':'$name','name':{'$first':_0x5ec1bd(0x235)}}}]);const _0x223145=await product[_0x5ec1bd(0x1ac)]({}),_0x190bba=await warehouse[_0x5ec1bd(0x1ac)]({'status':_0x5ec1bd(0x282)}),_0xc9c534=await purchases[_0x5ec1bd(0x1ac)]({}),_0x263df2=_0xc9c534[_0x5ec1bd(0x1a3)]+0x1,_0x1ab407='INC-'+_0x263df2['toString']()[_0x5ec1bd(0x1bc)](0x5,'0');var _0xee095a=[_0x5ec1bd(0x296),_0x5ec1bd(0x194)];if(_0xdfb46a[0x0]['language']==_0x5ec1bd(0x28c))var _0x2647cd=users[_0x5ec1bd(0x221)];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]==_0x5ec1bd(0x228))var _0x2647cd=users[_0x5ec1bd(0x228)];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]==_0x5ec1bd(0x274))var _0x2647cd=users[_0x5ec1bd(0x274)];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]==_0x5ec1bd(0x1dd))var _0x2647cd=users[_0x5ec1bd(0x1dd)];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]=='French')var _0x2647cd=users[_0x5ec1bd(0x22b)];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]==_0x5ec1bd(0x1e9))var _0x2647cd=users[_0x5ec1bd(0x21c)];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]=='Chinese')var _0x2647cd=users['Chinese'];else{if(_0xdfb46a[0x0][_0x5ec1bd(0x20d)]=='Arabic\x20(ae)')var _0x2647cd=users['Arabic'];}}}}}}}const _0x32edbf=getRandom8DigitNumber();_0x32edbf[_0x5ec1bd(0x218)](_0x2b059f=>{var _0x4342e3=_0x5ec1bd;_0x13b56e[_0x4342e3(0x240)](_0x4342e3(0x23d),{'success':_0xba8415[_0x4342e3(0x1e3)](_0x4342e3(0x23f)),'errors':_0xba8415[_0x4342e3(0x1e3)](_0x4342e3(0x179)),'role':_0x3550a3,'profile':_0x511356,'suppliers':_0x2b284c,'warehouse':_0x13053f,'product':_0x223145,'invoice':_0x2b059f,'master_shop':_0xdfb46a,'language':_0x2647cd,'find_data':_0x190bba,'rooms_data':_0xee095a});})['catch'](_0x1469af=>{var _0x4680df=_0x5ec1bd;_0xba8415['flash'](_0x4680df(0x179),_0x4680df(0x253)),_0x13b56e[_0x4680df(0x273)]('/all_purchases/view');});}catch(_0x31f57f){console[_0x5ec1bd(0x1cf)](_0x31f57f);}}),router[a0_0xa8e186(0x225)](a0_0xa8e186(0x214),auth,async(_0x54f070,_0x296cbc)=>{var _0x18d7ad=a0_0xa8e186;try{const _0x233265=_0x54f070[_0x18d7ad(0x232)]['id'];console[_0x18d7ad(0x1cf)](_0x233265);const _0x197f4e=await master_shop['find']();console[_0x18d7ad(0x1cf)](_0x18d7ad(0x260),_0x197f4e);const _0x8bc2b0=await product[_0x18d7ad(0x241)]({'name':_0x233265});console[_0x18d7ad(0x1cf)](_0x18d7ad(0x1fa),_0x8bc2b0),_0x296cbc[_0x18d7ad(0x1a6)](0xc8)['json']({'product_data':_0x8bc2b0,'master':_0x197f4e});}catch(_0x4fa23c){console['log'](_0x18d7ad(0x290),_0x4fa23c);}}),router[a0_0xa8e186(0x1f1)](a0_0xa8e186(0x255),auth,async(_0xb63efa,_0x39309f)=>{var _0x115921=a0_0xa8e186;try{const {invoice:_0x517283,date:_0x4e528c,warehouse_name:_0xd4dd0a,prod_name:_0x4ff9f5,prod_code:_0x385b25,prod_qty:_0x4634a9,prod_unit:_0x5862c1,prod_secondunit:_0x5429b9,prod_level:_0x54d782,prod_isle:_0x386780,prod_pallet:_0xd02f2b,note:_0x2ce4c8,expiry_date:_0x510b01,batch_code:_0x5783c3,payable:_0x420ce4,due_amount:_0xf0e37a,Room_name:_0x1d66fd,primary_code:_0x1a0c23,secondary_code:_0x29604d,MaxStocks_data:_0xaff66f,PO_number:_0x4b2d76,SCRN:_0x5a2fe7,JO_number:_0x2e3c7d}=_0xb63efa[_0x115921(0x1a7)];if(typeof _0x4ff9f5==_0x115921(0x1f5))var _0xfe479d=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x1ce)]],_0x1afa43=[_0xb63efa['body'][_0x115921(0x22f)]],_0x1adf9f=[_0xb63efa[_0x115921(0x1a7)]['prod_Qty']],_0x13a6ae=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x27b)]],_0xa89872=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x1ec)]],_0xbc1e80=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x1e1)]],_0x1c1360=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x26a)]],_0x378fe7=[_0xb63efa[_0x115921(0x1a7)]['secondary_code']],_0x4bebe4=[_0xb63efa[_0x115921(0x1a7)]['MaxStocks_data']],_0x311a82=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x23a)]],_0x17382f=[_0xb63efa['body'][_0x115921(0x244)]],_0x3ac56d=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x26f)]],_0x4508a1=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x17b)]],_0x159448=[_0xb63efa[_0x115921(0x1a7)]['production_date']],_0x5b1a48=[_0xb63efa[_0x115921(0x1a7)]['prod_cat']],_0x12c1aa=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x201)]],_0x3c71b6=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x263)]],_0x3c17d8=[_0xb63efa[_0x115921(0x1a7)]['prod_invoice']],_0xbd0a04=[_0xb63efa[_0x115921(0x1a7)]['actual_qty']],_0x1a6b2c=[_0xb63efa[_0x115921(0x1a7)][_0x115921(0x22c)]];else var _0xfe479d=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x1ce)]],_0x1afa43=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x22f)]],_0x1adf9f=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x1c5)]],_0x13a6ae=[..._0xb63efa[_0x115921(0x1a7)]['prod_primunit']],_0xa89872=[..._0xb63efa[_0x115921(0x1a7)]['prod_secondunit']],_0xbc1e80=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x1e1)]],_0x1c1360=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x26a)]],_0x378fe7=[..._0xb63efa['body']['secondary_code']],_0x4bebe4=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x1b8)]],_0x311a82=[..._0xb63efa['body']['batch_code']],_0x17382f=[..._0xb63efa[_0x115921(0x1a7)]['expiry_date']],_0x3ac56d=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x26f)]],_0x4508a1=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x17b)]],_0x159448=[..._0xb63efa['body'][_0x115921(0x1e2)]],_0x5b1a48=[..._0xb63efa['body'][_0x115921(0x28b)]],_0x12c1aa=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x201)]],_0x3c71b6=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x263)]],_0x3c17d8=[..._0xb63efa[_0x115921(0x1a7)]['prod_invoice']],_0xbd0a04=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x23b)]],_0x1a6b2c=[..._0xb63efa[_0x115921(0x1a7)][_0x115921(0x22c)]];const _0x46ea68=_0xfe479d['map'](_0x2b5ac5=>{return _0x2b5ac5={'product_name':_0x2b5ac5};});_0xbd0a04[_0x115921(0x246)]((_0x1745c0,_0xf890a1)=>{var _0x4c6f54=_0x115921;_0x46ea68[_0xf890a1][_0x4c6f54(0x23b)]=Math['abs'](_0x1745c0);}),_0x1a6b2c[_0x115921(0x246)]((_0x145ba1,_0x1cd2c9)=>{_0x46ea68[_0x1cd2c9]['actual_uom']=_0x145ba1;}),_0x1afa43[_0x115921(0x246)]((_0x39e244,_0x15bf8a)=>{var _0x5e8b32=_0x115921;_0x46ea68[_0x15bf8a][_0x5e8b32(0x18c)]=_0x39e244;}),_0x1adf9f[_0x115921(0x246)]((_0x474cae,_0x279750)=>{var _0x3a782d=_0x115921;_0x46ea68[_0x279750][_0x3a782d(0x280)]=Math[_0x3a782d(0x212)](_0x474cae);}),_0x13a6ae[_0x115921(0x246)]((_0x36d474,_0x260f50)=>{var _0xab3803=_0x115921;_0x46ea68[_0x260f50][_0xab3803(0x270)]=_0x36d474;}),_0xa89872[_0x115921(0x246)]((_0x427ee9,_0xd8ebbb)=>{var _0x2c842b=_0x115921;_0x46ea68[_0xd8ebbb][_0x2c842b(0x24a)]=_0x427ee9;}),_0xbc1e80[_0x115921(0x246)]((_0x5dbfb6,_0x5378ec)=>{var _0x1a2b73=_0x115921;_0x12c1aa[_0x1a2b73(0x246)]((_0x1b31ad,_0x4034ff)=>{var _0x2ee0eb=_0x1a2b73;if(_0x1b31ad=='Receiving\x20Area'&&_0x5378ec==_0x4034ff){console[_0x2ee0eb(0x1cf)](_0x1b31ad+'\x20<\x20wew\x20>\x20'+_0x5378ec+_0x2ee0eb(0x204)+_0x4034ff+_0x2ee0eb(0x204)+_0x5dbfb6);var _0x1d58a2=_0x5dbfb6['slice'](0x3);_0x46ea68[_0x5378ec][_0x2ee0eb(0x24b)]=_0x5dbfb6[0x0],_0x46ea68[_0x5378ec][_0x2ee0eb(0x278)]=_0x5dbfb6[0x1],_0x46ea68[_0x5378ec][_0x2ee0eb(0x18b)]=0x0,_0x46ea68[_0x5378ec]['bin']=0x0,_0x46ea68[_0x5378ec][_0x2ee0eb(0x297)]=_0x2ee0eb(0x22e),_0x46ea68[_0x5378ec]['floorlevel']=_0x1d58a2;}else{if(_0x1b31ad==_0x2ee0eb(0x1a1)&&_0x5378ec==_0x4034ff){var _0x1d58a2=_0x5dbfb6[_0x2ee0eb(0x26c)](0x3);_0x46ea68[_0x5378ec][_0x2ee0eb(0x24b)]=_0x5dbfb6[0x0],_0x46ea68[_0x5378ec][_0x2ee0eb(0x278)]=_0x5dbfb6[0x1],_0x46ea68[_0x5378ec][_0x2ee0eb(0x18b)]=0x0,_0x46ea68[_0x5378ec]['bin']=0x0,_0x46ea68[_0x5378ec][_0x2ee0eb(0x297)]=_0x2ee0eb(0x22e),_0x46ea68[_0x5378ec]['floorlevel']=_0x5dbfb6[0x5];}else{if(_0x5378ec==_0x4034ff){if(_0x5dbfb6[0x0]=='A'&&_0x5dbfb6[0x1]=='L'&&_0x5dbfb6[0x2]=='L')console[_0x2ee0eb(0x1cf)](_0x1b31ad+_0x2ee0eb(0x204)+_0x5378ec+_0x2ee0eb(0x204)+_0x4034ff+_0x2ee0eb(0x204)+_0x5dbfb6+_0x2ee0eb(0x19b)),_0x46ea68[_0x5378ec]['storage']=_0x5dbfb6[0x0],_0x46ea68[_0x5378ec][_0x2ee0eb(0x278)]=_0x5dbfb6[0x1],_0x46ea68[_0x5378ec][_0x2ee0eb(0x18b)]=0x0,_0x46ea68[_0x5378ec]['bin']=0x0,_0x46ea68[_0x5378ec][_0x2ee0eb(0x297)]=_0x2ee0eb(0x22e),_0x46ea68[_0x5378ec][_0x2ee0eb(0x196)]=_0x5dbfb6[0x3];else{var _0x58d783;if(_0x5dbfb6[0x4]=='L')_0x58d783=_0x2ee0eb(0x1e7);else _0x5dbfb6[0x4]=='F'&&(_0x58d783=_0x2ee0eb(0x22e));_0x46ea68[_0x5378ec][_0x2ee0eb(0x24b)]=_0x5dbfb6[0x0],_0x46ea68[_0x5378ec]['rack']=_0x5dbfb6[0x1],_0x46ea68[_0x5378ec]['bay']=_0x5dbfb6[0x2],_0x46ea68[_0x5378ec][_0x2ee0eb(0x180)]=_0x5dbfb6[0x3],_0x46ea68[_0x5378ec][_0x2ee0eb(0x297)]=_0x58d783,_0x46ea68[_0x5378ec][_0x2ee0eb(0x196)]=_0x5dbfb6[0x5];}}}}});}),_0x1c1360['forEach']((_0x2ee5db,_0x48107d)=>{_0x46ea68[_0x48107d]['primary_code']=_0x2ee5db;}),_0x378fe7[_0x115921(0x246)]((_0x4504a9,_0x11ac9e)=>{_0x46ea68[_0x11ac9e]['secondary_code']=_0x4504a9;}),_0x4bebe4[_0x115921(0x246)]((_0x224722,_0x2091f1)=>{_0x46ea68[_0x2091f1]['maxStocks']=_0x224722;}),_0x311a82[_0x115921(0x246)]((_0x16f5d9,_0x3ffd0d)=>{var _0x349546=_0x115921;_0x46ea68[_0x3ffd0d][_0x349546(0x23a)]=_0x16f5d9;}),_0x17382f[_0x115921(0x246)]((_0x2efcdd,_0x328c64)=>{var _0x22f54e=_0x115921;_0x46ea68[_0x328c64][_0x22f54e(0x244)]=_0x2efcdd;}),_0x3ac56d[_0x115921(0x246)]((_0x44c550,_0x5dfa78)=>{var _0x1e676c=_0x115921;_0x46ea68[_0x5dfa78][_0x1e676c(0x1cc)]=_0x44c550;}),_0x4508a1['forEach']((_0x11bc16,_0x27320c)=>{var _0x549f45=_0x115921;_0x46ea68[_0x27320c][_0x549f45(0x17b)]=_0x11bc16;}),_0x159448[_0x115921(0x246)]((_0x3b91e5,_0x7842fc)=>{var _0x27f8a3=_0x115921;_0x46ea68[_0x7842fc][_0x27f8a3(0x1e2)]=_0x3b91e5;}),_0x5b1a48[_0x115921(0x246)]((_0x54994a,_0xf1768b)=>{var _0x57376d=_0x115921;_0x46ea68[_0xf1768b][_0x57376d(0x1ee)]=_0x54994a;}),_0x12c1aa[_0x115921(0x246)]((_0x151a69,_0x338538)=>{var _0x3f4fc7=_0x115921;_0x46ea68[_0x338538][_0x3f4fc7(0x216)]=_0x151a69;}),_0x3c71b6[_0x115921(0x246)]((_0x4694fc,_0x58ed60)=>{var _0x467aef=_0x115921;_0x46ea68[_0x58ed60][_0x467aef(0x1b3)]=_0x4694fc;}),_0x3c17d8[_0x115921(0x246)]((_0x2160ca,_0x163680)=>{var _0x3e3f82=_0x115921;_0x46ea68[_0x163680][_0x3e3f82(0x1a4)]=_0x2160ca;});const _0x459030=_0x12c1aa[_0x115921(0x213)](_0x1809dc=>{return _0x1809dc={'room_name':_0x1809dc};}),_0x210ce3=_0x46ea68[_0x115921(0x294)](_0x7f1166=>_0x7f1166[_0x115921(0x280)]!=='0'&&_0x7f1166[_0x115921(0x280)]!==''),_0x547910=new purchases({'invoice':_0x517283,'suppliers':_0xb63efa['body'][_0x115921(0x177)],'date':_0x4e528c,'warehouse_name':_0xd4dd0a,'product':_0x210ce3,'note':_0x2ce4c8,'due_amount':_0xf0e37a,'POnumber':_0x4b2d76,'SCRN':_0x5a2fe7,'JO_number':_0x2e3c7d,'roomList':_0x459030}),_0x28ded7=await _0x547910[_0x115921(0x258)](),_0x23cc9e=await purchases[_0x115921(0x241)]({'invoice':_0x517283}),_0x58f752=_0x23cc9e[_0x115921(0x1fa)][_0x115921(0x213)](async _0x57ac33=>{var _0x491138=_0x115921,_0x52912c=await warehouse[_0x491138(0x241)]({'name':_0xd4dd0a,'room':_0x57ac33['room_name']}),_0x595166=0x0;return _0x52912c[_0x491138(0x222)][_0x491138(0x246)](_0x477eb7=>{var _0x21b28c=_0x491138;_0x477eb7[_0x21b28c(0x1f6)]==_0x57ac33[_0x21b28c(0x1f6)]&&_0x477eb7[_0x21b28c(0x196)]==_0x57ac33[_0x21b28c(0x196)]&&_0x477eb7[_0x21b28c(0x297)]==_0x57ac33['type']&&_0x477eb7[_0x21b28c(0x180)]==_0x57ac33[_0x21b28c(0x180)]&&_0x477eb7[_0x21b28c(0x18b)]==_0x57ac33[_0x21b28c(0x18b)]&&_0x477eb7[_0x21b28c(0x278)]==_0x57ac33[_0x21b28c(0x278)]&&_0x477eb7[_0x21b28c(0x24b)]==_0x57ac33[_0x21b28c(0x24b)]&&_0x477eb7[_0x21b28c(0x244)]==_0x57ac33[_0x21b28c(0x244)]&&_0x477eb7[_0x21b28c(0x23a)]==_0x57ac33[_0x21b28c(0x23a)]&&_0x477eb7[_0x21b28c(0x1e2)]==_0x57ac33[_0x21b28c(0x1e2)]&&_0x477eb7[_0x21b28c(0x1a4)]==_0x23cc9e[_0x21b28c(0x1a4)]&&(_0x477eb7[_0x21b28c(0x279)]+=Math[_0x21b28c(0x212)](_0x57ac33[_0x21b28c(0x280)]),_0x595166++);}),_0x595166===0x0&&_0x52912c['product_details'][_0x491138(0x21b)]({'product_name':_0x57ac33[_0x491138(0x1f6)],'product_stock':Math['abs'](_0x57ac33[_0x491138(0x280)]),'primary_code':_0x57ac33[_0x491138(0x26a)],'secondary_code':_0x57ac33[_0x491138(0x28f)],'product_code':_0x57ac33['product_code'],'storage':_0x57ac33['storage'],'rack':_0x57ac33[_0x491138(0x278)],'bay':_0x57ac33[_0x491138(0x18b)],'bin':_0x57ac33[_0x491138(0x180)],'type':_0x57ac33['type'],'floorlevel':_0x57ac33[_0x491138(0x196)],'maxProducts':_0x57ac33['maxStocks'],'unit':_0x57ac33['standard_unit'],'secondary_unit':_0x57ac33[_0x491138(0x24a)],'expiry_date':_0x57ac33[_0x491138(0x244)],'maxPerUnit':_0x57ac33[_0x491138(0x1cc)],'batch_code':_0x57ac33[_0x491138(0x23a)],'alertQTY':_0x57ac33[_0x491138(0x17b)],'production_date':_0x57ac33[_0x491138(0x1e2)],'product_cat':_0x57ac33[_0x491138(0x1ee)],'invoice':_0x57ac33[_0x491138(0x1a4)],'actual_qty':Math['abs'](_0x57ac33[_0x491138(0x23b)]),'actual_uom':_0x57ac33[_0x491138(0x22c)]}),_0x52912c;});Promise[_0x115921(0x259)](_0x58f752)[_0x115921(0x218)](async _0x5c19ec=>{var _0x417967=_0x115921;try{for(const _0x5802ff of _0x5c19ec){await _0x5802ff[_0x417967(0x258)]();}const _0x579090=await master_shop[_0x417967(0x1ac)](),_0x1df034=await email_settings[_0x417967(0x241)](),_0x573861=await supervisor_settings[_0x417967(0x1ac)]();var _0x2dfca8=_0x23cc9e[_0x417967(0x1fa)],_0x35fc5d='',_0x400b07;for(_0x400b07 in _0x2dfca8){_0x35fc5d+=_0x417967(0x234)+_0x417967(0x242)+_0x2dfca8[_0x400b07][_0x417967(0x1f6)]+_0x417967(0x26b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2dfca8[_0x400b07][_0x417967(0x18c)]+_0x417967(0x26b)+_0x417967(0x242)+_0x2dfca8[_0x400b07][_0x417967(0x280)]+_0x417967(0x26b)+_0x417967(0x242)+_0x2dfca8[_0x400b07][_0x417967(0x270)]+'</td>'+_0x417967(0x242)+_0x2dfca8[_0x400b07][_0x417967(0x24a)]+_0x417967(0x26b)+_0x417967(0x242)+_0x23cc9e[_0x417967(0x1fb)]+_0x417967(0x26b)+_0x417967(0x242)+_0x2dfca8[_0x400b07]['room_name']+_0x417967(0x26b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2dfca8[_0x400b07]['storage']+_0x2dfca8[_0x400b07][_0x417967(0x278)]+_0x2dfca8[_0x400b07][_0x417967(0x18b)]+_0x2dfca8[_0x400b07][_0x417967(0x180)]+_0x2dfca8[_0x400b07]['type'][0x0]+_0x2dfca8[_0x400b07][_0x417967(0x196)]+_0x417967(0x26b),_0x417967(0x283);}let _0x4c5daa=nodemailer[_0x417967(0x175)]({'host':_0x1df034[_0x417967(0x1b5)],'port':Number(_0x1df034[_0x417967(0x293)]),'secure':![],'auth':{'user':_0x1df034['email'],'pass':_0x1df034[_0x417967(0x1c4)]}}),_0x346273={'from':_0x1df034[_0x417967(0x1a9)],'to':_0x573861[0x0][_0x417967(0x183)],'subject':_0x417967(0x276),'attachments':[{'filename':_0x417967(0x25a),'path':__dirname+_0x417967(0x199)+_0x417967(0x26d)+_0x579090[0x0][_0x417967(0x237)],'cid':_0x417967(0x203)}],'html':_0x417967(0x185)+_0x417967(0x202)+_0x417967(0x25d)+'<div>'+_0x417967(0x243)+'<div>'+_0x417967(0x1f4)+'</div>'+_0x417967(0x1a8)+_0x417967(0x268)+_0x579090[0x0][_0x417967(0x197)]+_0x417967(0x18f)+_0x417967(0x20c)+'</div>'+_0x417967(0x231)+_0x417967(0x1a8)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x417967(0x17c)+_0x23cc9e[_0x417967(0x1a4)]+'\x20'+_0x417967(0x1d7)+_0x417967(0x1d4)+_0x23cc9e[_0x417967(0x284)]+'\x20'+'</span>'+_0x417967(0x1f3)+_0x417967(0x20c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x417967(0x1be)+_0x417967(0x234)+_0x417967(0x1e0)+_0x417967(0x19a)+_0x417967(0x1d5)+_0x417967(0x17a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x417967(0x1d6)+_0x417967(0x1c8)+_0x417967(0x192)+_0x417967(0x283)+_0x417967(0x1f0)+_0x417967(0x27a)+'\x20'+_0x35fc5d+'\x20'+_0x417967(0x1d0)+'</table>'+_0x417967(0x1a8)+_0x417967(0x1fd)+'<h5>'+_0x579090[0x0][_0x417967(0x197)]+_0x417967(0x1f3)+'</div>'+_0x417967(0x20c)+_0x417967(0x252)};_0x4c5daa['sendMail'](_0x346273,function(_0xc5d379,_0x5dff31){var _0x3d9003=_0x417967;_0xc5d379?(console['log'](_0xc5d379),console[_0x3d9003(0x1cf)](_0x3d9003(0x220))):console[_0x3d9003(0x1cf)](_0x3d9003(0x247));}),_0xb63efa[_0x417967(0x1e3)]('success',_0x417967(0x209)),_0x39309f[_0x417967(0x273)](_0x417967(0x295));}catch(_0x26bb79){console[_0x417967(0x1e6)](_0x26bb79),_0x39309f[_0x417967(0x1a6)](0x1f4)[_0x417967(0x286)]({'error':_0x417967(0x1f8)});}})[_0x115921(0x187)](_0x335c13=>{var _0x46412e=_0x115921;console['error'](_0x335c13),_0x39309f[_0x46412e(0x1a6)](0x1f4)[_0x46412e(0x286)]({'error':_0x46412e(0x1de)});});}catch(_0xb0eb38){console[_0x115921(0x1cf)](_0xb0eb38);}}),router['get']('/preview/:id',auth,async(_0x1fb16a,_0x47590d)=>{var _0xc7113e=a0_0xa8e186;try{const {username:_0x24d062,email:_0x192ed9,role:_0x144d99}=_0x1fb16a['user'],_0x4f5096=_0x1fb16a['user'],_0x218f4e=await profile[_0xc7113e(0x241)]({'email':_0x4f5096[_0xc7113e(0x1a9)]}),_0x2e20fb=await master_shop[_0xc7113e(0x1ac)](),_0x48a32a=_0x1fb16a['params']['id'],_0x46d40b=await purchases[_0xc7113e(0x298)](_0x48a32a),_0x717709=await warehouse['aggregate']([{'$match':{'name':_0x46d40b['warehouse_name'],'room':_0x46d40b[_0xc7113e(0x215)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xc7113e(0x245),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xc7113e(0x21a)},'bay':{'$first':_0xc7113e(0x1d1)},'bin':{'$first':_0xc7113e(0x17f)},'type':{'$first':_0xc7113e(0x191)},'floorlevel':{'$first':_0xc7113e(0x266)},'primary_code':{'$first':_0xc7113e(0x238)},'secondary_code':{'$first':_0xc7113e(0x24c)},'product_code':{'$first':_0xc7113e(0x211)},'storage':{'$first':_0xc7113e(0x28d)},'rack':{'$first':_0xc7113e(0x24e)},'expiry_date':{'$first':_0xc7113e(0x22d)}}}]),_0x2ab476=await customer['find']({});let _0x344227;if(_0x4f5096[_0xc7113e(0x227)]=='staff'){const _0x2ff60f=await staff[_0xc7113e(0x241)]({'email':_0x4f5096['email']});_0x344227=await warehouse['aggregate']([{'$match':{'status':_0xc7113e(0x282),'name':_0x2ff60f[_0xc7113e(0x176)]}},{'$group':{'_id':_0xc7113e(0x235),'name':{'$first':_0xc7113e(0x235)}}}]);}else _0x344227=await warehouse[_0xc7113e(0x186)]([{'$match':{'status':_0xc7113e(0x282)}},{'$group':{'_id':_0xc7113e(0x235),'name':{'$first':_0xc7113e(0x235)}}}]);const _0x3569c5=await product[_0xc7113e(0x1ac)]({}),_0x29d228=await suppliers[_0xc7113e(0x1ac)]({}),_0x560755=BayBinSelected(_0x46d40b[_0xc7113e(0x1fb)],_0x46d40b[_0xc7113e(0x215)]);if(_0x2e20fb[0x0][_0xc7113e(0x20d)]==_0xc7113e(0x28c)){var _0x5e8114=users[_0xc7113e(0x221)];console[_0xc7113e(0x1cf)](_0x5e8114);}else{if(_0x2e20fb[0x0]['language']==_0xc7113e(0x228))var _0x5e8114=users['Hindi'];else{if(_0x2e20fb[0x0][_0xc7113e(0x20d)]=='German')var _0x5e8114=users[_0xc7113e(0x274)];else{if(_0x2e20fb[0x0][_0xc7113e(0x20d)]=='Spanish')var _0x5e8114=users[_0xc7113e(0x1dd)];else{if(_0x2e20fb[0x0][_0xc7113e(0x20d)]==_0xc7113e(0x22b))var _0x5e8114=users['French'];else{if(_0x2e20fb[0x0][_0xc7113e(0x20d)]==_0xc7113e(0x1e9))var _0x5e8114=users[_0xc7113e(0x21c)];else{if(_0x2e20fb[0x0]['language']==_0xc7113e(0x20f))var _0x5e8114=users[_0xc7113e(0x20f)];else{if(_0x2e20fb[0x0][_0xc7113e(0x20d)]==_0xc7113e(0x1c1))var _0x5e8114=users[_0xc7113e(0x1df)];}}}}}}}_0x47590d[_0xc7113e(0x240)](_0xc7113e(0x198),{'success':_0x1fb16a[_0xc7113e(0x1e3)]('success'),'errors':_0x1fb16a[_0xc7113e(0x1e3)](_0xc7113e(0x179)),'role':_0x4f5096,'profile':_0x218f4e,'customer':_0x2ab476,'warehouse':_0x344227,'product':_0x717709,'user':_0x46d40b,'master_shop':_0x2e20fb,'unit':_0x3569c5,'language':_0x5e8114,'suppliers':_0x29d228,'dataSelected':_0x560755});}catch(_0x4d6837){console[_0xc7113e(0x1cf)](_0x4d6837);}}),router['post'](a0_0xa8e186(0x17d),auth,async(_0x2a8215,_0x333329)=>{var _0x370e03=a0_0xa8e186;try{const _0xcbcabf=_0x2a8215['params']['id'],{invoice:_0x4cb9ec,warehouse_name:_0x26f39f,Room_name:_0x5860ac}=_0x2a8215[_0x370e03(0x1a7)],_0x6148bb=await warehouse[_0x370e03(0x241)]({'name':_0x26f39f,'room':_0x5860ac}),_0x299e48=await purchases[_0x370e03(0x241)]({'invoice':_0x4cb9ec});_0x299e48['product'][_0x370e03(0x246)](_0x3f49a3=>{var _0x16dfcc=_0x370e03,_0x3dd67f=0x0;const _0x16b734=_0x6148bb[_0x16dfcc(0x222)]['map'](_0x217b40=>{var _0x2d344a=_0x16dfcc;_0x217b40[_0x2d344a(0x1f6)]==_0x3f49a3[_0x2d344a(0x1f6)]&&_0x217b40[_0x2d344a(0x196)]==_0x3f49a3[_0x2d344a(0x196)]&&_0x217b40[_0x2d344a(0x297)]==_0x3f49a3['type']&&_0x217b40['bin']==_0x3f49a3['bin']&&_0x217b40[_0x2d344a(0x18b)]==_0x3f49a3[_0x2d344a(0x18b)]&&_0x217b40[_0x2d344a(0x278)]==_0x3f49a3['rack']&&_0x217b40['storage']==_0x3f49a3[_0x2d344a(0x24b)]&&_0x217b40[_0x2d344a(0x244)]==_0x3f49a3[_0x2d344a(0x244)]&&_0x217b40['batch_code']==_0x3f49a3[_0x2d344a(0x23a)]&&_0x217b40[_0x2d344a(0x1e2)]==_0x3f49a3[_0x2d344a(0x1e2)]&&_0x217b40['delivery_date']==_0x3f49a3[_0x2d344a(0x1c6)]&&_0x217b40[_0x2d344a(0x1b3)]==_0x3f49a3['delivery_code']&&(_0x217b40[_0x2d344a(0x279)]=parseInt(_0x217b40[_0x2d344a(0x279)])+parseInt(_0x3f49a3[_0x2d344a(0x280)]),_0x3dd67f++);});_0x3dd67f=='0'&&(_0x6148bb[_0x16dfcc(0x222)]=_0x6148bb[_0x16dfcc(0x222)]['concat']({'product_name':_0x3f49a3[_0x16dfcc(0x1f6)],'product_stock':_0x3f49a3['quantity'],'primary_code':_0x3f49a3['primary_code'],'secondary_code':_0x3f49a3[_0x16dfcc(0x28f)],'product_code':_0x3f49a3[_0x16dfcc(0x18c)],'storage':_0x3f49a3[_0x16dfcc(0x24b)],'rack':_0x3f49a3[_0x16dfcc(0x278)],'bay':_0x3f49a3[_0x16dfcc(0x18b)],'bin':_0x3f49a3[_0x16dfcc(0x180)],'type':_0x3f49a3[_0x16dfcc(0x297)],'floorlevel':_0x3f49a3[_0x16dfcc(0x196)],'maxProducts':_0x3f49a3['maxStocks'],'unit':_0x3f49a3[_0x16dfcc(0x270)],'secondary_unit':_0x3f49a3[_0x16dfcc(0x24a)],'expiry_date':_0x3f49a3['expiry_date'],'maxPerUnit':_0x3f49a3[_0x16dfcc(0x1cc)],'batch_code':_0x3f49a3['batch_code'],'alertQTY':_0x3f49a3['alertQTY'],'production_date':_0x3f49a3[_0x16dfcc(0x1e2)],'delivery_date':_0x3f49a3[_0x16dfcc(0x1c6)],'delivery_code':_0x3f49a3[_0x16dfcc(0x1b3)]}));}),await _0x6148bb[_0x370e03(0x258)](),_0x299e48[_0x370e03(0x188)]=_0x370e03(0x248);const _0x20cb91=await _0x299e48['save']();_0x2a8215[_0x370e03(0x1e3)]('success',_0x370e03(0x1d8)),_0x333329[_0x370e03(0x273)](_0x370e03(0x1e5));}catch(_0x3a39c7){console[_0x370e03(0x1cf)](_0x3a39c7);}}),router[a0_0xa8e186(0x225)](a0_0xa8e186(0x269),auth,async(_0x4bd030,_0xe1bf29)=>{var _0x340fcd=a0_0xa8e186;try{const {username:_0x58afd7,email:_0x33e5fc,role:_0x343def}=_0x4bd030[_0x340fcd(0x281)],_0x165511=_0x4bd030[_0x340fcd(0x281)],_0xbab0d8=await profile[_0x340fcd(0x241)]({'email':_0x165511['email']}),_0x275510=await master_shop['find'](),_0x9e0bf7=_0x4bd030[_0x340fcd(0x232)]['id'],_0x356d42=await purchases['findById'](_0x9e0bf7),_0x1bc36e=await suppliers[_0x340fcd(0x1ac)]({});let _0x113460;if(_0x165511['role']=='staff'){const _0x401312=await staff['findOne']({'email':_0x165511[_0x340fcd(0x1a9)]});_0x113460=await warehouse[_0x340fcd(0x1ac)]({'status':_0x340fcd(0x282),'name':_0x401312[_0x340fcd(0x176)],'warehouse_category':_0x340fcd(0x1b7)});}else _0x113460=await warehouse[_0x340fcd(0x186)]([{'$match':{'status':_0x340fcd(0x282),'warehouse_category':_0x340fcd(0x1b7)}},{'$group':{'_id':'$name','name':{'$first':_0x340fcd(0x235)}}}]);const _0x1f28f7=await product[_0x340fcd(0x1ac)]({}),_0x48b297=BayBinSelected(_0x356d42['warehouse_name'],_0x356d42[_0x340fcd(0x215)]);let _0x3d6697=new Date(_0x356d42[_0x340fcd(0x244)]),_0x22a0fe=('0'+_0x3d6697['getDate']())['slice'](-0x2),_0x532eca=('0'+(_0x3d6697[_0x340fcd(0x22a)]()+0x1))[_0x340fcd(0x26c)](-0x2),_0x43908f=_0x3d6697[_0x340fcd(0x1aa)](),_0x1bb23e=_0x43908f+'-'+_0x532eca+'-'+_0x22a0fe;if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x28c)){var _0x57b80b=users[_0x340fcd(0x221)];console[_0x340fcd(0x1cf)](_0x57b80b);}else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x228))var _0x57b80b=users[_0x340fcd(0x228)];else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x274))var _0x57b80b=users[_0x340fcd(0x274)];else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x1dd))var _0x57b80b=users[_0x340fcd(0x1dd)];else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x22b))var _0x57b80b=users[_0x340fcd(0x22b)];else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x1e9))var _0x57b80b=users[_0x340fcd(0x21c)];else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x20f))var _0x57b80b=users['Chinese'];else{if(_0x275510[0x0][_0x340fcd(0x20d)]==_0x340fcd(0x1c1))var _0x57b80b=users[_0x340fcd(0x1df)];}}}}}}}_0xe1bf29[_0x340fcd(0x240)](_0x340fcd(0x261),{'success':_0x4bd030['flash'](_0x340fcd(0x23f)),'errors':_0x4bd030[_0x340fcd(0x1e3)]('errors'),'role':_0x165511,'profile':_0xbab0d8,'purchases':_0x356d42,'suppliers':_0x1bc36e,'warehouse':_0x113460,'product':_0x1f28f7,'master_shop':_0x275510,'language':_0x57b80b,'ed_fullDate':_0x1bb23e,'dataSelected':_0x48b297});}catch(_0x109da8){console[_0x340fcd(0x1cf)](_0x109da8);}}),router[a0_0xa8e186(0x1f1)](a0_0xa8e186(0x269),auth,async(_0x4c4649,_0x5a4523)=>{var _0x3af2e2=a0_0xa8e186;try{const _0x3070f2=_0x4c4649['params']['id'],_0x21b5d4=await purchases[_0x3af2e2(0x241)]({'_id':_0x4c4649[_0x3af2e2(0x232)]['id']}),_0xa6c6eb=await warehouse[_0x3af2e2(0x241)]({'name':_0x21b5d4['warehouse_name'],'room':_0x21b5d4[_0x3af2e2(0x215)]});_0x21b5d4['product']['forEach'](_0xa9c3c=>{var _0x5d3b76=_0x3af2e2;const _0x58ace1=_0xa6c6eb[_0x5d3b76(0x222)]['map'](_0x2fc0e1=>{var _0x26606c=_0x5d3b76;_0x2fc0e1[_0x26606c(0x1f6)]==_0xa9c3c[_0x26606c(0x1f6)]&&_0x2fc0e1['floorlevel']==_0xa9c3c[_0x26606c(0x196)]&&_0x2fc0e1[_0x26606c(0x297)]==_0xa9c3c[_0x26606c(0x297)]&&_0x2fc0e1[_0x26606c(0x180)]==_0xa9c3c[_0x26606c(0x180)]&&_0x2fc0e1['bay']==_0xa9c3c[_0x26606c(0x18b)]&&_0x2fc0e1[_0x26606c(0x278)]==_0xa9c3c[_0x26606c(0x278)]&&_0x2fc0e1[_0x26606c(0x24b)]==_0xa9c3c['storage']&&(_0x2fc0e1[_0x26606c(0x279)]=parseInt(_0x2fc0e1[_0x26606c(0x279)])-parseInt(_0xa9c3c[_0x26606c(0x280)]));});}),await _0xa6c6eb[_0x3af2e2(0x258)]();const {invoice:_0x4a97dd,suppliers:_0x108275,date:_0x1ed11e,warehouse_name:_0x239647,prod_name:_0x43eca5,prod_code:_0x4f0758,prod_qty:_0x495903,prod_unit:_0xdbca76,prod_secondunit:_0x58eb9b,prod_level:_0x2f1792,prod_isle:_0x1d72f0,prod_pallet:_0x1f51e8,note:_0xad9e69,expiry_date:_0x4a89a5,batch_code:_0x16b645,paid_amount:_0x5dba4d,due_amount:_0x19561f,Room_name:_0x3f95b3,primary_code:_0x549134,secondary_code:_0x4a943d,PO_number:_0x1f73a7,JO_number:_0x4052fe}=_0x4c4649['body'];if(typeof _0x43eca5==_0x3af2e2(0x1f5))var _0x4b5d3c=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x1ce)]],_0x283ef7=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x22f)]],_0x4f6266=[_0x4c4649[_0x3af2e2(0x1a7)]['prod_qty']],_0x393f5e=[_0x4c4649['body'][_0x3af2e2(0x205)]],_0x7aeb47=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x1ec)]],_0x2b3a98=[_0x4c4649['body'][_0x3af2e2(0x1e1)]],_0x34d385=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x206)]],_0x5a7fd6=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x257)]],_0x44cc6f=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x26a)]],_0x517701=[_0x4c4649[_0x3af2e2(0x1a7)]['secondary_code']],_0x3388df=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x1b8)]],_0x23cc3c=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x23a)]],_0x27658b=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x244)]],_0x54d90d=[_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x24b)]],_0x52f0d3=[_0x4c4649[_0x3af2e2(0x1a7)]['rak']],_0x5eff87=[_0x4c4649[_0x3af2e2(0x1a7)]['type']];else var _0x4b5d3c=[..._0x4c4649[_0x3af2e2(0x1a7)]['prod_name']],_0x283ef7=[..._0x4c4649['body'][_0x3af2e2(0x22f)]],_0x4f6266=[..._0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x233)]],_0x393f5e=[..._0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x205)]],_0x7aeb47=[..._0x4c4649[_0x3af2e2(0x1a7)]['prod_secondunit']],_0x2b3a98=[..._0x4c4649['body'][_0x3af2e2(0x1e1)]],_0x34d385=[..._0x4c4649['body'][_0x3af2e2(0x206)]],_0x5a7fd6=[..._0x4c4649['body'][_0x3af2e2(0x257)]],_0x44cc6f=[..._0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x26a)]],_0x517701=[..._0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x28f)]],_0x3388df=[..._0x4c4649['body'][_0x3af2e2(0x1b8)]],_0x23cc3c=[..._0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x23a)]],_0x27658b=[..._0x4c4649['body'][_0x3af2e2(0x244)]],_0x54d90d=[..._0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x24b)]],_0x52f0d3=[..._0x4c4649[_0x3af2e2(0x1a7)]['rak']],_0x5eff87=[..._0x4c4649['body'][_0x3af2e2(0x297)]];const _0x3510d1=_0x4b5d3c['map'](_0x16314c=>{return _0x16314c={'product_name':_0x16314c};});_0x283ef7['forEach']((_0x3e6314,_0x34d811)=>{var _0x1b6c06=_0x3af2e2;_0x3510d1[_0x34d811][_0x1b6c06(0x18c)]=_0x3e6314;}),_0x4f6266[_0x3af2e2(0x246)]((_0x19744d,_0x121ae7)=>{var _0x373699=_0x3af2e2;_0x3510d1[_0x121ae7][_0x373699(0x280)]=_0x19744d;}),_0x393f5e['forEach']((_0x1ca33a,_0x4de7b0)=>{var _0x399f0d=_0x3af2e2;_0x3510d1[_0x4de7b0][_0x399f0d(0x270)]=_0x1ca33a;}),_0x7aeb47[_0x3af2e2(0x246)]((_0xd6df4d,_0x4a99e3)=>{var _0x2fbeb4=_0x3af2e2;_0x3510d1[_0x4a99e3][_0x2fbeb4(0x24a)]=_0xd6df4d;}),_0x2b3a98[_0x3af2e2(0x246)]((_0x12f461,_0x502da7)=>{_0x3510d1[_0x502da7]['bay']=_0x12f461;}),_0x34d385[_0x3af2e2(0x246)]((_0x4e6afe,_0xf31dde)=>{_0x3510d1[_0xf31dde]['bin']=_0x4e6afe;}),_0x5a7fd6['forEach']((_0x2db1cf,_0x1825ca)=>{var _0x5c7357=_0x3af2e2;_0x3510d1[_0x1825ca][_0x5c7357(0x196)]=_0x2db1cf;}),_0x44cc6f[_0x3af2e2(0x246)]((_0x4212d2,_0xd41fb3)=>{var _0x3195a7=_0x3af2e2;_0x3510d1[_0xd41fb3][_0x3195a7(0x26a)]=_0x4212d2;}),_0x517701[_0x3af2e2(0x246)]((_0x1779e8,_0x558f9b)=>{_0x3510d1[_0x558f9b]['secondary_code']=_0x1779e8;}),_0x3388df['forEach']((_0x36f7b1,_0x268d50)=>{var _0x377999=_0x3af2e2;_0x3510d1[_0x268d50][_0x377999(0x200)]=_0x36f7b1;}),_0x23cc3c['forEach']((_0x5c03b0,_0x29730b)=>{var _0x4fe3ea=_0x3af2e2;_0x3510d1[_0x29730b][_0x4fe3ea(0x23a)]=_0x5c03b0;}),_0x27658b[_0x3af2e2(0x246)]((_0x1ad8d1,_0x5e6363)=>{_0x3510d1[_0x5e6363]['expiry_date']=_0x1ad8d1;}),_0x5eff87[_0x3af2e2(0x246)]((_0x10db80,_0x14b778)=>{_0x3510d1[_0x14b778]['type']=_0x10db80;}),_0x54d90d[_0x3af2e2(0x246)]((_0x452adb,_0x503645)=>{var _0x590a6a=_0x3af2e2;_0x3510d1[_0x503645][_0x590a6a(0x24b)]=_0x452adb;}),_0x52f0d3[_0x3af2e2(0x246)]((_0x22e8e4,_0x4179a7)=>{var _0x35560f=_0x3af2e2;_0x3510d1[_0x4179a7][_0x35560f(0x278)]=_0x22e8e4;});const _0x2012db=_0x3510d1[_0x3af2e2(0x294)](_0x1bf2b5=>_0x1bf2b5[_0x3af2e2(0x280)]!=='0'&&_0x1bf2b5[_0x3af2e2(0x280)]!=='');_0x21b5d4['invoice']=_0x4a97dd,_0x21b5d4['suppliers']=_0x108275,_0x21b5d4[_0x3af2e2(0x284)]=_0x1ed11e,_0x21b5d4[_0x3af2e2(0x1fb)]=_0x239647,_0x21b5d4['product']=_0x2012db,_0x21b5d4['note']=_0xad9e69,_0x21b5d4['paid_amount']=_0x5dba4d,_0x21b5d4[_0x3af2e2(0x277)]=_0x19561f,_0x21b5d4['room']=_0x3f95b3,_0x21b5d4['POnumber']=_0x1f73a7,_0x21b5d4[_0x3af2e2(0x27d)]=_0x4052fe;const _0x84ec64=await _0x21b5d4[_0x3af2e2(0x258)](),_0x1e839b=await warehouse['findOne']({'name':_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x1fb)],'room':_0x4c4649[_0x3af2e2(0x1a7)]['Room_name']});_0x21b5d4['product'][_0x3af2e2(0x246)](_0x2eb9cc=>{var _0x1bb532=_0x3af2e2,_0x3973e4=0x0;const _0x2c7e11=_0x1e839b[_0x1bb532(0x222)][_0x1bb532(0x213)](_0x1469a8=>{var _0x2601e0=_0x1bb532;_0x1469a8[_0x2601e0(0x1f6)]==_0x2eb9cc[_0x2601e0(0x1f6)]&&_0x1469a8[_0x2601e0(0x196)]==_0x2eb9cc[_0x2601e0(0x196)]&&_0x1469a8[_0x2601e0(0x297)]==_0x2eb9cc[_0x2601e0(0x297)]&&_0x1469a8['bin']==_0x2eb9cc[_0x2601e0(0x180)]&&_0x1469a8[_0x2601e0(0x18b)]==_0x2eb9cc[_0x2601e0(0x18b)]&&_0x1469a8[_0x2601e0(0x278)]==_0x2eb9cc[_0x2601e0(0x278)]&&_0x1469a8[_0x2601e0(0x24b)]==_0x2eb9cc['storage']&&(_0x1469a8[_0x2601e0(0x279)]=parseInt(_0x1469a8[_0x2601e0(0x279)])+parseInt(_0x2eb9cc['quantity']),_0x3973e4++);});_0x3973e4=='0'&&(_0x1e839b[_0x1bb532(0x222)]=_0x1e839b[_0x1bb532(0x222)][_0x1bb532(0x193)]({'product_name':_0x2eb9cc[_0x1bb532(0x1f6)],'product_stock':_0x2eb9cc[_0x1bb532(0x280)],'primary_code':_0x2eb9cc[_0x1bb532(0x26a)],'secondary_code':_0x2eb9cc[_0x1bb532(0x28f)],'product_code':_0x2eb9cc[_0x1bb532(0x18c)],'storage':_0x2eb9cc['storage'],'rack':_0x2eb9cc['rack'],'bay':_0x2eb9cc[_0x1bb532(0x18b)],'bin':_0x2eb9cc[_0x1bb532(0x180)],'type':_0x2eb9cc[_0x1bb532(0x297)],'floorlevel':_0x2eb9cc['floorlevel'],'maxProducts':_0x2eb9cc[_0x1bb532(0x200)],'unit':_0x2eb9cc[_0x1bb532(0x270)],'secondary_unit':_0x2eb9cc[_0x1bb532(0x24a)],'expiry_date':_0x2eb9cc[_0x1bb532(0x244)]}));}),await _0x1e839b['save']();const _0x5804b1=await s_payment_data[_0x3af2e2(0x241)]({'invoice':_0x4c4649[_0x3af2e2(0x1a7)][_0x3af2e2(0x1a4)]});if(_0x5804b1===null){}else console[_0x3af2e2(0x1cf)](_0x3af2e2(0x177),_0x5804b1,_0x4c4649[_0x3af2e2(0x1a7)]['invoice']),_0x5804b1[_0x3af2e2(0x177)]=_0x4c4649[_0x3af2e2(0x1a7)]['suppliers'],await _0x5804b1['save']();_0x4c4649[_0x3af2e2(0x1e3)]('success','purchase\x20data\x20update\x20successfully'),_0x5a4523[_0x3af2e2(0x273)](_0x3af2e2(0x1e5));}catch(_0x37525a){console[_0x3af2e2(0x1cf)](_0x37525a);}}),router[a0_0xa8e186(0x1f1)](a0_0xa8e186(0x1bd),auth,async(_0x4ba753,_0x52b090)=>{var _0x3f3d2e=a0_0xa8e186;try{const _0x1db7c9=_0x4ba753['params']['id'],{invoice:_0x1df817,suppliers:_0x5e3ce4,payable:_0x3902e0,due_amount:_0x45a3ec}=_0x4ba753[_0x3f3d2e(0x1a7)],_0x98464e=await purchases[_0x3f3d2e(0x298)](_0x1db7c9);var _0x189ed=_0x3902e0-_0x45a3ec;_0x98464e[_0x3f3d2e(0x23c)]=parseFloat(_0x98464e[_0x3f3d2e(0x23c)])+parseFloat(_0x45a3ec),_0x98464e['due_amount']=_0x189ed;const _0x563a68=await _0x98464e['save']();console[_0x3f3d2e(0x1cf)](_0x563a68);const _0x5a4fec=await s_payment_data[_0x3f3d2e(0x241)]({'invoice':_0x1df817});_0x5a4fec['amount']=_0x189ed,await _0x5a4fec[_0x3f3d2e(0x258)]();let _0x2b174a=new Date(),_0x30a1aa=('0'+_0x2b174a[_0x3f3d2e(0x1c3)]())[_0x3f3d2e(0x26c)](-0x2),_0x1ed72d=('0'+(_0x2b174a[_0x3f3d2e(0x22a)]()+0x1))['slice'](-0x2),_0x7124b3=_0x2b174a[_0x3f3d2e(0x1aa)](),_0x3bdc0f=_0x7124b3+'-'+_0x1ed72d+'-'+_0x30a1aa;const _0xa7e26d=new suppliers_payment({'invoice':_0x1df817,'date':_0x7124b3+'-'+_0x1ed72d+'-'+_0x30a1aa,'suppliers':_0x5e3ce4,'reason':_0x3f3d2e(0x1ef),'amount':_0x45a3ec}),_0x429734=await _0xa7e26d['save']();_0x4ba753['flash'](_0x3f3d2e(0x23f),'payment\x20successfull'),_0x52b090[_0x3f3d2e(0x273)](_0x3f3d2e(0x1e5));}catch(_0x25841e){console['log'](_0x25841e);}}),router['get'](a0_0xa8e186(0x24d),auth,async(_0x4fcc19,_0x4633be)=>{var _0x22778c=a0_0xa8e186;try{const {username:_0xb42933,email:_0x1b4c21,role:_0xdc04f1}=_0x4fcc19[_0x22778c(0x281)],_0x4e04f=_0x4fcc19[_0x22778c(0x281)],_0x1d0ab7=await profile[_0x22778c(0x241)]({'email':_0x4e04f[_0x22778c(0x1a9)]}),_0x268dcc=await master_shop[_0x22778c(0x1ac)]();console[_0x22778c(0x1cf)](_0x22778c(0x260),_0x268dcc);const _0xf9ee60=_0x4fcc19[_0x22778c(0x232)]['id'],_0x3f5198=await purchases[_0x22778c(0x298)](_0xf9ee60);console[_0x22778c(0x1cf)](_0x3f5198);const _0x96c702=await suppliers[_0x22778c(0x241)]({'name':_0x3f5198[_0x22778c(0x177)]});console['log'](_0x96c702);if(_0x268dcc[0x0]['language']=='English\x20(US)'){var _0xd61800=users[_0x22778c(0x221)];console[_0x22778c(0x1cf)](_0xd61800);}else{if(_0x268dcc[0x0][_0x22778c(0x20d)]==_0x22778c(0x228))var _0xd61800=users['Hindi'];else{if(_0x268dcc[0x0]['language']==_0x22778c(0x274))var _0xd61800=users[_0x22778c(0x274)];else{if(_0x268dcc[0x0][_0x22778c(0x20d)]==_0x22778c(0x1dd))var _0xd61800=users[_0x22778c(0x1dd)];else{if(_0x268dcc[0x0]['language']==_0x22778c(0x22b))var _0xd61800=users[_0x22778c(0x22b)];else{if(_0x268dcc[0x0][_0x22778c(0x20d)]==_0x22778c(0x1e9))var _0xd61800=users[_0x22778c(0x21c)];else{if(_0x268dcc[0x0]['language']==_0x22778c(0x20f))var _0xd61800=users[_0x22778c(0x20f)];else{if(_0x268dcc[0x0]['language']==_0x22778c(0x1c1))var _0xd61800=users[_0x22778c(0x1df)];}}}}}}}_0x4633be['render'](_0x22778c(0x291),{'success':_0x4fcc19['flash'](_0x22778c(0x23f)),'errors':_0x4fcc19['flash'](_0x22778c(0x179)),'role':_0x4e04f,'profile':_0x1d0ab7,'master_shop':_0x268dcc,'supplier':_0x96c702,'purchase':_0x3f5198,'language':_0xd61800});}catch(_0x421256){console[_0x22778c(0x1cf)](_0x421256);}}),router[a0_0xa8e186(0x225)](a0_0xa8e186(0x1ca),auth,async(_0x15a966,_0x1872c1)=>{var _0x545d26=a0_0xa8e186;try{const {username:_0xd6e655,email:_0x25efa5,role:_0x3448a5}=_0x15a966[_0x545d26(0x281)],_0x5a2aa0=_0x15a966[_0x545d26(0x281)],_0x2e79fa=await profile[_0x545d26(0x241)]({'email':_0x5a2aa0[_0x545d26(0x1a9)]}),_0x4c199a=await master_shop[_0x545d26(0x1ac)]();console[_0x545d26(0x1cf)](_0x545d26(0x260),_0x4c199a);const _0x3c61b0=_0x15a966['params']['id'];console[_0x545d26(0x1cf)](_0x3c61b0);const _0x24e9ee=await purchases['findById'](_0x3c61b0);console['log'](_0x545d26(0x272),_0x24e9ee);const _0x28259d=await product[_0x545d26(0x1ac)]({}),_0x50c375=await warehouse['aggregate']([{'$match':{'name':_0x24e9ee[_0x545d26(0x1fb)],'room':_0x24e9ee[_0x545d26(0x215)],'warehouse_category':_0x545d26(0x1b7)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x545d26(0x1eb)},'product_stock':{'$first':_0x545d26(0x21a)},'bay':{'$first':_0x545d26(0x1d1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x545d26(0x191)},'floorlevel':{'$first':_0x545d26(0x266)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x545d26(0x24c)},'product_code':{'$first':_0x545d26(0x211)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x545d26(0x24e)}}}]);warehouse_data=await warehouse[_0x545d26(0x186)]([{'$match':{'status':'Enabled','name':_0x545d26(0x287),'warehouse_category':_0x545d26(0x1b7)}},{'$group':{'_id':_0x545d26(0x235),'name':{'$first':_0x545d26(0x235)}}},{'$sort':{'name':0x1}}]),console['log'](_0x545d26(0x189),_0x50c375);if(_0x4c199a[0x0][_0x545d26(0x20d)]==_0x545d26(0x28c)){var _0x427f68=users['English'];console[_0x545d26(0x1cf)](_0x427f68);}else{if(_0x4c199a[0x0]['language']==_0x545d26(0x228))var _0x427f68=users['Hindi'];else{if(_0x4c199a[0x0][_0x545d26(0x20d)]==_0x545d26(0x274))var _0x427f68=users[_0x545d26(0x274)];else{if(_0x4c199a[0x0]['language']==_0x545d26(0x1dd))var _0x427f68=users[_0x545d26(0x1dd)];else{if(_0x4c199a[0x0][_0x545d26(0x20d)]==_0x545d26(0x22b))var _0x427f68=users['French'];else{if(_0x4c199a[0x0]['language']==_0x545d26(0x1e9))var _0x427f68=users['Portuguese'];else{if(_0x4c199a[0x0][_0x545d26(0x20d)]==_0x545d26(0x20f))var _0x427f68=users[_0x545d26(0x20f)];else{if(_0x4c199a[0x0][_0x545d26(0x20d)]==_0x545d26(0x1c1))var _0x427f68=users[_0x545d26(0x1df)];}}}}}}}_0x1872c1[_0x545d26(0x240)](_0x545d26(0x1ba),{'success':_0x15a966[_0x545d26(0x1e3)]('success'),'errors':_0x15a966['flash'](_0x545d26(0x179)),'role':_0x5a2aa0,'profile':_0x2e79fa,'user':_0x24e9ee,'stock':_0x50c375,'master_shop':_0x4c199a,'product':_0x28259d,'language':_0x427f68,'warehouse':warehouse_data});}catch(_0x412147){console['log'](_0x412147);}}),router[a0_0xa8e186(0x1f1)]('/view/return_purchase/:id',auth,async(_0x482d11,_0x357366)=>{var _0x535321=a0_0xa8e186;try{const {invoice:_0x4e7990,date:_0x40fef3,warehouse_name:_0x2bae1f,Room_name:_0x5cc259,product_name:_0x360007,purchase_quantity:_0x340186,stocks:_0x2e0be0,return_qty:_0x26ab87,note:_0x327ced,level:_0x3f89db,isle:_0x1401b2,pallet:_0x1c168d,to_warehouse_name:_0x406a68,to_Room_name:_0xc6d572}=_0x482d11[_0x535321(0x1a7)],_0x29f1c7=await purchases[_0x535321(0x241)]({'_id':_0x482d11[_0x535321(0x232)]['id']}),_0x5f05f0=await warehouse[_0x535321(0x241)]({'name':_0x2bae1f,'room':_0x5cc259});if(typeof _0x360007==_0x535321(0x1f5))var _0x1c96b8=[_0x482d11[_0x535321(0x1a7)]['product_name']],_0x2365ad=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x195)]],_0x44e5aa=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x285)]],_0x5f2f06=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x207)]],_0x404f18=[_0x482d11[_0x535321(0x1a7)]['level']],_0x2cf768=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x1c9)]],_0x561f2d=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x20e)]],_0x75bcc5=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x25e)]],_0x271dd7=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x292)]],_0x4c5c94=[_0x482d11[_0x535321(0x1a7)][_0x535321(0x1b0)]],_0x3d2d47=[_0x482d11['body'][_0x535321(0x20b)]];else var _0x1c96b8=[..._0x482d11['body']['product_name']],_0x2365ad=[..._0x482d11[_0x535321(0x1a7)]['purchase_quantity']],_0x44e5aa=[..._0x482d11[_0x535321(0x1a7)][_0x535321(0x285)]],_0x5f2f06=[..._0x482d11[_0x535321(0x1a7)][_0x535321(0x207)]],_0x404f18=[..._0x482d11[_0x535321(0x1a7)]['level']],_0x2cf768=[..._0x482d11[_0x535321(0x1a7)]['isle']],_0x561f2d=[..._0x482d11[_0x535321(0x1a7)][_0x535321(0x20e)]],_0x75bcc5=[..._0x482d11[_0x535321(0x1a7)][_0x535321(0x25e)]],_0x271dd7=[..._0x482d11['body']['product_code_hide']],_0x4c5c94=[..._0x482d11[_0x535321(0x1a7)][_0x535321(0x1b0)]],_0x3d2d47=[..._0x482d11[_0x535321(0x1a7)][_0x535321(0x20b)]];const _0x1c3031=_0x1c96b8['map'](_0x4e7c11=>{return _0x4e7c11={'product_name':_0x4e7c11};});_0x2365ad[_0x535321(0x246)]((_0x25ac20,_0x276f64)=>{var _0x39a32f=_0x535321;_0x1c3031[_0x276f64][_0x39a32f(0x195)]=_0x25ac20;}),_0x44e5aa['forEach']((_0x1303f0,_0x457f71)=>{var _0x4057e1=_0x535321;_0x1c3031[_0x457f71][_0x4057e1(0x208)]=_0x1303f0;}),_0x5f2f06[_0x535321(0x246)]((_0x51b040,_0x2497c1)=>{var _0x50fa0b=_0x535321;_0x1c3031[_0x2497c1][_0x50fa0b(0x207)]=_0x51b040;}),_0x404f18[_0x535321(0x246)]((_0x184a8a,_0x247bba)=>{var _0x1cc595=_0x535321;_0x1c3031[_0x247bba][_0x1cc595(0x18b)]=_0x184a8a;}),_0x2cf768[_0x535321(0x246)]((_0x5d0a0b,_0x762a18)=>{var _0x19afb3=_0x535321;_0x1c3031[_0x762a18][_0x19afb3(0x180)]=_0x5d0a0b;}),_0x561f2d[_0x535321(0x246)]((_0x2c87de,_0x338010)=>{var _0x2f7247=_0x535321;_0x1c3031[_0x338010][_0x2f7247(0x196)]=_0x2c87de;}),_0x75bcc5[_0x535321(0x246)]((_0x2abbba,_0x4cc649)=>{var _0x4b3ea1=_0x535321;_0x1c3031[_0x4cc649][_0x4b3ea1(0x297)]=_0x2abbba;}),_0x271dd7['forEach']((_0x245285,_0x287ba6)=>{var _0xbb6304=_0x535321;_0x1c3031[_0x287ba6][_0xbb6304(0x18c)]=_0x245285;}),_0x4c5c94[_0x535321(0x246)]((_0x45bc28,_0x3db82e)=>{var _0x351b6c=_0x535321;_0x1c3031[_0x3db82e][_0x351b6c(0x26a)]=_0x45bc28;}),_0x3d2d47[_0x535321(0x246)]((_0x5b4323,_0x3f4448)=>{_0x1c3031[_0x3f4448]['secondary_code']=_0x5b4323;}),_0x29f1c7[_0x535321(0x1fa)][_0x535321(0x246)](_0x4139bf=>{var _0x288779=_0x535321;const _0x55782d=_0x5f05f0['product_details'][_0x288779(0x213)](_0x26fa17=>{var _0x1bee2e=_0x288779;_0x26fa17[_0x1bee2e(0x1f6)]==_0x4139bf[_0x1bee2e(0x1f6)]&&_0x26fa17['floorlevel']==_0x4139bf[_0x1bee2e(0x196)]&&_0x26fa17[_0x1bee2e(0x297)]==_0x4139bf[_0x1bee2e(0x297)]&&_0x26fa17[_0x1bee2e(0x180)]==_0x4139bf[_0x1bee2e(0x180)]&&_0x26fa17[_0x1bee2e(0x18b)]==_0x4139bf['bay']&&_0x26fa17[_0x1bee2e(0x278)]==_0x4139bf[_0x1bee2e(0x278)]&&_0x26fa17[_0x1bee2e(0x24b)]==_0x4139bf[_0x1bee2e(0x24b)]&&(console[_0x1bee2e(0x1cf)](parseInt(_0x26fa17[_0x1bee2e(0x279)])+_0x1bee2e(0x204)+parseInt(_0x4139bf['quantity'])),_0x26fa17[_0x1bee2e(0x279)]=parseInt(_0x26fa17[_0x1bee2e(0x279)])+parseInt(_0x4139bf['quantity']));});}),await _0x5f05f0[_0x535321(0x258)]();const _0x1ec75d=_0x1c3031['filter'](_0x253b94=>_0x253b94[_0x535321(0x207)]!=='0'&&_0x253b94[_0x535321(0x207)]!=='');var _0x32cf22=0x0;_0x1ec75d[_0x535321(0x246)](_0x13edc6=>{var _0x262750=_0x535321;console['log']('foreach\x20newproduct',_0x13edc6),(parseInt(_0x13edc6[_0x262750(0x195)])<parseInt(_0x13edc6[_0x262750(0x207)])||parseInt(_0x13edc6[_0x262750(0x208)])<parseInt(_0x13edc6[_0x262750(0x207)]))&&_0x32cf22++;});if(_0x32cf22!=0x0)return _0x482d11[_0x535321(0x1e3)](_0x535321(0x179),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x357366[_0x535321(0x273)](_0x535321(0x239));const _0x3e6886=new purchases_return({'invoice':_0x4e7990,'suppliers':_0x482d11[_0x535321(0x1a7)][_0x535321(0x177)],'date':_0x40fef3,'warehouse_name':_0x2bae1f,'return_product':_0x1ec75d,'note':_0x327ced,'room':_0x5cc259,'to_warehouse_name':_0x406a68,'to_room':_0xc6d572}),_0x2c8588=await _0x3e6886[_0x535321(0x258)]();console[_0x535321(0x1cf)](_0x3e6886);const _0x145bbe=await purchases_return[_0x535321(0x241)]({'invoice':_0x4e7990}),_0xa7a5c0=await warehouse[_0x535321(0x241)]({'name':_0x406a68,'room':_0xc6d572});_0x145bbe[_0x535321(0x17e)][_0x535321(0x246)](_0x4ff301=>{var _0x2dee5f=_0x535321,_0x40182a=0x0;const _0x1d162a=_0xa7a5c0[_0x2dee5f(0x222)][_0x2dee5f(0x213)](_0xf08b50=>{var _0x731246=_0x2dee5f;_0xf08b50[_0x731246(0x1f6)]==_0x4ff301[_0x731246(0x1f6)]&&_0xf08b50[_0x731246(0x196)]==_0x4ff301[_0x731246(0x196)]&&_0xf08b50[_0x731246(0x297)]==_0x4ff301[_0x731246(0x297)]&&_0xf08b50['bin']==_0x4ff301[_0x731246(0x180)]&&_0xf08b50[_0x731246(0x18b)]==_0x4ff301['bay']&&(_0xf08b50[_0x731246(0x279)]=parseInt(_0xf08b50[_0x731246(0x279)])-parseInt(_0x4ff301[_0x731246(0x207)]),_0x40182a++);});_0x40182a=='0'&&(_0xa7a5c0['product_details']=_0xa7a5c0[_0x2dee5f(0x222)][_0x2dee5f(0x193)]({'product_name':_0x4ff301['product_name'],'product_stock':_0x4ff301['return_qty'],'primary_code':_0x4ff301[_0x2dee5f(0x26a)],'secondary_code':_0x4ff301[_0x2dee5f(0x28f)],'product_code':_0x4ff301[_0x2dee5f(0x18c)],'storage':_0x4ff301[_0x2dee5f(0x24b)],'rack':_0x4ff301[_0x2dee5f(0x278)],'bay':_0x4ff301[_0x2dee5f(0x18b)],'bin':_0x4ff301[_0x2dee5f(0x180)],'type':_0x4ff301[_0x2dee5f(0x297)],'floorlevel':_0x4ff301[_0x2dee5f(0x196)],'maxProducts':_0x4ff301[_0x2dee5f(0x200)],'unit':_0x4ff301[_0x2dee5f(0x270)],'secondary_unit':_0x4ff301[_0x2dee5f(0x24a)],'expiry_date':_0x4ff301[_0x2dee5f(0x244)]}));}),await _0xa7a5c0[_0x535321(0x258)]();const _0x542066=await purchases[_0x535321(0x241)]({'invoice':_0x4e7990});_0x542066[_0x535321(0x1d3)]='True';const _0x47753c=await _0x542066[_0x535321(0x258)](),_0x517282=new s_payment_data({'invoice':_0x4e7990,'suppliers':_0x482d11[_0x535321(0x1a7)][_0x535321(0x177)],'reason':_0x535321(0x182)});await _0x517282[_0x535321(0x258)]();const _0x41ff04=await master_shop[_0x535321(0x1ac)]();console['log']('add\x20post',_0x41ff04[0x0][_0x535321(0x237)]);const _0xb32fd8=await email_settings['findOne'](),_0x451976=await suppliers['findOne']({'name':_0x482d11['body'][_0x535321(0x177)]});console[_0x535321(0x1cf)](_0x535321(0x27e),_0x451976);_0x41ff04[0x0][_0x535321(0x249)]==0x1?(right_currency=_0x41ff04[0x0][_0x535321(0x28a)],left_currency=''):(right_currency='',left_currency=_0x41ff04[0x0][_0x535321(0x28a)]);var _0x9066fe=_0x1c96b8,_0x4bcc85=_0x5f2f06,_0x38bc7f='',_0x4bf17c;for(_0x4bf17c in _0x9066fe){_0x38bc7f+=_0x535321(0x234)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x9066fe[_0x4bf17c]+_0x535321(0x26b)+_0x535321(0x242)+_0x4bcc85[_0x4bf17c]+'</td>'+'</tr>';}console['log'](_0x535321(0x1c7),_0x38bc7f);let _0x13f3fc=nodemailer[_0x535321(0x175)]({'service':_0x535321(0x178),'auth':{'user':_0xb32fd8[_0x535321(0x1a9)],'pass':_0xb32fd8[_0x535321(0x1c4)]}}),_0x2cb8f9={'from':_0xb32fd8[_0x535321(0x1a9)],'to':_0x451976[_0x535321(0x1a9)],'subject':_0x535321(0x1b9),'attachments':[{'filename':_0x535321(0x25a),'path':__dirname+_0x535321(0x199)+_0x535321(0x26d)+_0x41ff04[0x0][_0x535321(0x237)],'cid':_0x535321(0x203)}],'html':'<!DOCTYPE\x20html>'+_0x535321(0x202)+'</head><body>'+_0x535321(0x1a8)+_0x535321(0x243)+_0x535321(0x1a8)+_0x535321(0x1f4)+_0x535321(0x20c)+'<div>'+_0x535321(0x268)+_0x41ff04[0x0]['site_title']+_0x535321(0x18f)+_0x535321(0x20c)+_0x535321(0x20c)+_0x535321(0x231)+_0x535321(0x1a8)+_0x535321(0x21d)+'\x20Order\x20Number\x20:\x20'+_0x4e7990+'\x20'+_0x535321(0x1d7)+_0x535321(0x1d4)+_0x40fef3+'\x20'+_0x535321(0x1ed)+_0x535321(0x1f3)+_0x535321(0x20c)+_0x535321(0x21f)+_0x535321(0x1be)+'<tr>'+_0x535321(0x1e0)+_0x535321(0x1ff)+_0x535321(0x250)+_0x535321(0x1a0)+_0x535321(0x283)+_0x535321(0x1f0)+_0x535321(0x27a)+'\x20'+_0x38bc7f+'\x20'+'</tbody>'+_0x535321(0x217)+'<div>'+_0x535321(0x1fd)+_0x535321(0x1b1)+_0x41ff04[0x0][_0x535321(0x197)]+_0x535321(0x1f3)+_0x535321(0x20c)+'</div>'+_0x535321(0x252)};_0x13f3fc['sendMail'](_0x2cb8f9,function(_0x347cce,_0x3702ad){var _0x18cb08=_0x535321;_0x347cce?(console[_0x18cb08(0x1cf)](_0x347cce),console[_0x18cb08(0x1cf)](_0x18cb08(0x220))):console[_0x18cb08(0x1cf)](_0x18cb08(0x247));}),_0x482d11['flash'](_0x535321(0x23f),_0x535321(0x1d2)),_0x357366['redirect'](_0x535321(0x1e5));}catch(_0x155c66){console['log'](_0x155c66),_0x357366[_0x535321(0x1a6)](0xc8)['json']({'message':_0x155c66['message']});}}),router[a0_0xa8e186(0x225)]('/barcode/:id',auth,async(_0x36ebb7,_0x3c0738)=>{var _0x3dc8fd=a0_0xa8e186;try{const {username:_0x311b06,email:_0x353b79,role:_0x4f8e59}=_0x36ebb7[_0x3dc8fd(0x281)],_0x38528e=_0x36ebb7['user'],_0x278a2d=await profile[_0x3dc8fd(0x241)]({'email':_0x38528e[_0x3dc8fd(0x1a9)]}),_0x5e0798=await master_shop[_0x3dc8fd(0x1ac)](),_0x4b06dd=_0x36ebb7[_0x3dc8fd(0x232)]['id'],_0x4505ba=await purchases['findById'](_0x4b06dd);if(_0x5e0798[0x0]['language']=='English\x20(US)')var _0x50888e=users[_0x3dc8fd(0x221)];else{if(_0x5e0798[0x0][_0x3dc8fd(0x20d)]=='Hindi')var _0x50888e=users[_0x3dc8fd(0x228)];else{if(_0x5e0798[0x0][_0x3dc8fd(0x20d)]==_0x3dc8fd(0x274))var _0x50888e=users[_0x3dc8fd(0x274)];else{if(_0x5e0798[0x0][_0x3dc8fd(0x20d)]==_0x3dc8fd(0x1dd))var _0x50888e=users[_0x3dc8fd(0x1dd)];else{if(_0x5e0798[0x0]['language']==_0x3dc8fd(0x22b))var _0x50888e=users[_0x3dc8fd(0x22b)];else{if(_0x5e0798[0x0]['language']=='Portuguese\x20(BR)')var _0x50888e=users['Portuguese'];else{if(_0x5e0798[0x0]['language']==_0x3dc8fd(0x20f))var _0x50888e=users[_0x3dc8fd(0x20f)];else{if(_0x5e0798[0x0][_0x3dc8fd(0x20d)]=='Arabic\x20(ae)')var _0x50888e=users[_0x3dc8fd(0x1df)];}}}}}}}_0x3c0738['render'](_0x3dc8fd(0x271),{'success':_0x36ebb7['flash']('success'),'errors':_0x36ebb7['flash'](_0x3dc8fd(0x179)),'role':_0x38528e,'profile':_0x278a2d,'alldata':_0x4505ba,'master_shop':_0x5e0798,'language':_0x50888e}),console[_0x3dc8fd(0x1cf)](alldata);}catch(_0x28af48){console[_0x3dc8fd(0x1cf)](_0x28af48);}}),router[a0_0xa8e186(0x1f1)](a0_0xa8e186(0x223),async(_0x879faa,_0x5c2732)=>{var _0x2e9dd8=a0_0xa8e186;const {product_code:_0x479431}=_0x879faa[_0x2e9dd8(0x1a7)];var _0x32d8d6;const _0x1d78e4=await product['aggregate']([{'$match':{'primary_code':_0x479431,'product_category':_0x2e9dd8(0x1b7)}},{'$group':{'_id':'$_id','name':{'$first':_0x2e9dd8(0x235)},'category':{'$first':_0x2e9dd8(0x24f)},'brand':{'$first':_0x2e9dd8(0x19f)},'unit':{'$first':_0x2e9dd8(0x1c0)},'alertquantity':{'$first':_0x2e9dd8(0x18a)},'product_code':{'$first':_0x2e9dd8(0x1f7)},'primary_code':{'$first':_0x2e9dd8(0x267)},'secondary_code':{'$first':_0x2e9dd8(0x1cb)},'maxStocks':{'$first':_0x2e9dd8(0x1ad)},'maxProdPerUnit':{'$first':_0x2e9dd8(0x289)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2e9dd8(0x1af)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x27757b=await product['aggregate']([{'$match':{'secondary_code':_0x479431,'product_category':_0x2e9dd8(0x1b7)}},{'$group':{'_id':_0x2e9dd8(0x1cd),'name':{'$first':'$name'},'category':{'$first':_0x2e9dd8(0x24f)},'brand':{'$first':_0x2e9dd8(0x19f)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x2e9dd8(0x18a)},'product_code':{'$first':_0x2e9dd8(0x1f7)},'primary_code':{'$first':_0x2e9dd8(0x267)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2e9dd8(0x289)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1d78e4[_0x2e9dd8(0x1a3)]>0x0)_0x32d8d6=_0x1d78e4;else _0x27757b[_0x2e9dd8(0x1a3)]>0x0&&(_0x32d8d6=_0x27757b);_0x5c2732[_0x2e9dd8(0x286)](_0x32d8d6);}),router[a0_0xa8e186(0x1f1)](a0_0xa8e186(0x27f),async(_0x3b617d,_0x3c77dd)=>{var _0x20f911=a0_0xa8e186;const {primaryCode:_0x3f6b4b,secondaryCode:_0x1b0c04,productCode:_0x92ba9a,bay:_0x5550e0,bin:_0x35551f,types:_0x178bcf,pallet:_0x4257b2,warehouses:_0x38f9c8,room:_0x21d14a}=_0x3b617d['body'];console['log'](_0x3b617d[_0x20f911(0x1a7)]);try{const _0x19bb14=await warehouse[_0x20f911(0x186)]([{'$match':{'name':_0x38f9c8,'room':_0x21d14a}},{'$unwind':_0x20f911(0x254)},{'$match':{'product_details.bay':_0x5550e0,'product_details.bin':_0x35551f,'product_details.type':_0x178bcf}},{'$group':{'_id':_0x20f911(0x245),'name':{'$first':_0x20f911(0x1eb)},'product_stock':{'$first':_0x20f911(0x21a)},'level':{'$first':_0x20f911(0x25f)},'isle':{'$first':_0x20f911(0x226)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x20f911(0x264)}}}]);_0x3c77dd[_0x20f911(0x1a6)](0xc8)[_0x20f911(0x286)](_0x19bb14);}catch(_0x2021dd){_0x3c77dd[_0x20f911(0x1a6)](0x194)[_0x20f911(0x286)]({'message':_0x2021dd['message']});}}),module[a0_0xa8e186(0x1bb)]=router;