var a0_0x463ef1=a0_0x1e7f;(function(_0x1337bc,_0x46a349){var _0x91e9cb=a0_0x1e7f,_0x180b21=_0x1337bc();while(!![]){try{var _0xde25cb=parseInt(_0x91e9cb(0x170))/0x1+-parseInt(_0x91e9cb(0xab))/0x2*(-parseInt(_0x91e9cb(0xe5))/0x3)+-parseInt(_0x91e9cb(0xed))/0x4+-parseInt(_0x91e9cb(0xb5))/0x5*(-parseInt(_0x91e9cb(0xbd))/0x6)+-parseInt(_0x91e9cb(0xe4))/0x7*(parseInt(_0x91e9cb(0x104))/0x8)+-parseInt(_0x91e9cb(0x11d))/0x9*(-parseInt(_0x91e9cb(0x13f))/0xa)+-parseInt(_0x91e9cb(0x1aa))/0xb*(parseInt(_0x91e9cb(0x18c))/0xc);if(_0xde25cb===_0x46a349)break;else _0x180b21['push'](_0x180b21['shift']());}catch(_0x5a74ec){_0x180b21['push'](_0x180b21['shift']());}}}(a0_0x3faa,0x26b15));const express=require(a0_0x463ef1(0x182)),app=express(),router=express[a0_0x463ef1(0xc5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require('nodemailer');function a0_0x1e7f(_0x376ae7,_0x55e1d5){var _0x3faa27=a0_0x3faa();return a0_0x1e7f=function(_0x1e7f18,_0x18f563){_0x1e7f18=_0x1e7f18-0xa7;var _0xb88b20=_0x3faa27[_0x1e7f18];return _0xb88b20;},a0_0x1e7f(_0x376ae7,_0x55e1d5);}var ejs=require(a0_0x463ef1(0x1a4));const path=require(a0_0x463ef1(0x173)),users=require(a0_0x463ef1(0x1c1));router[a0_0x463ef1(0x16c)](a0_0x463ef1(0xb4),auth,async(_0x6e48f2,_0x518b22)=>{var _0x5ed915=a0_0x463ef1;try{const {username:_0x25f195,email:_0x39e817,role:_0x3e4edf}=_0x6e48f2[_0x5ed915(0xb3)],_0x39eb35=_0x6e48f2[_0x5ed915(0xb3)],_0x1a22f9=await profile[_0x5ed915(0xc6)]({'email':_0x39eb35['email']}),_0xae3ef2=await staff[_0x5ed915(0xc6)]({'email':_0x39eb35[_0x5ed915(0x15b)]});if(_0x39eb35[_0x5ed915(0x11e)]==_0x5ed915(0x125)){const _0x3b3054=await staff['findOne']({'email':_0x39eb35[_0x5ed915(0x15b)]});}const _0x2edfb3=await master_shop[_0x5ed915(0x19d)]();let _0x513c25;if(_0x39eb35['role']=='staff'){const _0x2e9875=await staff[_0x5ed915(0xc6)]({'email':_0x39eb35[_0x5ed915(0x15b)]});_0x513c25=await purchases[_0x5ed915(0x175)]([{'$match':{'warehouse_name':_0x2e9875['warehouse']}},{'$lookup':{'from':_0x5ed915(0x10b),'localField':'suppliers','foreignField':'name','as':_0x5ed915(0x1c4)}},{'$unwind':_0x5ed915(0xd2)},{'$unwind':_0x5ed915(0x101)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5ed915(0x112)},'suppliers':{'$first':_0x5ed915(0x142)},'date':{'$first':_0x5ed915(0x199)},'warehouse_name':{'$first':_0x5ed915(0x148)},'room':{'$first':_0x5ed915(0x154)},'product':{'$push':_0x5ed915(0x101)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5ed915(0x1a8)},'due_amount':{'$first':_0x5ed915(0x1a7)},'return_data':{'$first':_0x5ed915(0x114)},'batch_code':{'$first':_0x5ed915(0xfd)},'expiry_date':{'$first':_0x5ed915(0x1c5)},'suppliers_docs':{'$first':_0x5ed915(0xd2)},'total_product_quantity':{'$sum':_0x5ed915(0x156)},'level':{'$addToSet':_0x5ed915(0xb8)},'isle':{'$addToSet':_0x5ed915(0xaf)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x513c25=await purchases['aggregate']([{'$lookup':{'from':_0x5ed915(0x10b),'localField':_0x5ed915(0x10b),'foreignField':_0x5ed915(0x139),'as':_0x5ed915(0x1c4)}},{'$unwind':_0x5ed915(0xd2)},{'$unwind':_0x5ed915(0x101)},{'$group':{'_id':_0x5ed915(0x1bb),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x5ed915(0x142)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5ed915(0x148)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x5ed915(0xf5)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x5ed915(0x114)},'batch_code':{'$first':_0x5ed915(0xfd)},'expiry_date':{'$first':_0x5ed915(0x1c5)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x5ed915(0x156)},'level':{'$addToSet':_0x5ed915(0xb8)},'isle':{'$addToSet':_0x5ed915(0xaf)},'type':{'$addToSet':_0x5ed915(0x13c)},'floorlevel':{'$addToSet':_0x5ed915(0xb6)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2edfb3[0x0][_0x5ed915(0x149)]==_0x5ed915(0x178)){var _0x396f43=users[_0x5ed915(0xb2)];console[_0x5ed915(0x1c0)](_0x396f43);}else{if(_0x2edfb3[0x0][_0x5ed915(0x149)]=='Hindi')var _0x396f43=users[_0x5ed915(0x190)];else{if(_0x2edfb3[0x0]['language']==_0x5ed915(0x169))var _0x396f43=users[_0x5ed915(0x169)];else{if(_0x2edfb3[0x0]['language']==_0x5ed915(0x111))var _0x396f43=users[_0x5ed915(0x111)];else{if(_0x2edfb3[0x0][_0x5ed915(0x149)]==_0x5ed915(0x16b))var _0x396f43=users[_0x5ed915(0x16b)];else{if(_0x2edfb3[0x0]['language']==_0x5ed915(0x164))var _0x396f43=users[_0x5ed915(0x1a0)];else{if(_0x2edfb3[0x0][_0x5ed915(0x149)]==_0x5ed915(0xf9))var _0x396f43=users[_0x5ed915(0xf9)];else{if(_0x2edfb3[0x0][_0x5ed915(0x149)]=='Arabic\x20(ae)')var _0x396f43=users[_0x5ed915(0x121)];}}}}}}}_0x518b22[_0x5ed915(0xe3)](_0x5ed915(0x16f),{'success':_0x6e48f2[_0x5ed915(0x1c3)](_0x5ed915(0x161)),'errors':_0x6e48f2[_0x5ed915(0x1c3)](_0x5ed915(0x179)),'purchases':_0x513c25,'role':_0x39eb35,'profile':_0x1a22f9,'master_shop':_0x2edfb3,'language':_0x396f43});}catch(_0x43c179){console[_0x5ed915(0x1c0)](_0x5ed915(0x167),_0x43c179),_0x518b22['status'](0xc8)[_0x5ed915(0x1af)]({'message':_0x43c179[_0x5ed915(0x13d)]});}});function BayBinSelected(_0xe01ed0,_0x18011d){var _0x3d5d7e=a0_0x463ef1,_0x1943f7=[],_0x4543d6=[],_0x3f3ad0=[],_0x5c4c8a=[],_0x59d815=[],_0x732b4=[];let _0xe73d7f=[];if(_0xe01ed0==_0x3d5d7e(0xf6))switch(_0x18011d){case _0x3d5d7e(0x134):_0x1943f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4543d6=[0x1,0x2],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=[_0x3d5d7e(0x192),_0x3d5d7e(0x135)],_0x59d815=['D'],_0x732b4=['A'];break;case _0x3d5d7e(0x15a):_0x1943f7=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4543d6=[0x1,0x2],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=['Level',_0x3d5d7e(0x135)],_0x59d815=['D'],_0x732b4=['B'];break;case _0x3d5d7e(0x115):_0x1943f7=[0x0],_0x4543d6=[0x0],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=[_0x3d5d7e(0x135)],_0x59d815=['D'],_0x732b4=['S'];break;case'Receiving\x20Area':_0x1943f7=[0x0],_0x4543d6=[0x0],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3f3ad0=[_0x3d5d7e(0x135)],_0x59d815=['D'],_0x732b4=['R'];break;}else{if(_0xe01ed0==_0x3d5d7e(0x10d))switch(_0x18011d){case _0x3d5d7e(0x134):_0x1943f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4543d6=['B','F'],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=['Level','Floor'],_0x59d815=['C'],_0x732b4=['A'];break;case _0x3d5d7e(0x15a):_0x1943f7=[0x5,0x4,0x3,0x2,0x1],_0x4543d6=['F','B','S'],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=[_0x3d5d7e(0x192),_0x3d5d7e(0x135)],_0x59d815=['C'],_0x732b4=['B'];break;case _0x3d5d7e(0x14d):_0x1943f7=[0x1,0x2,0x3,0x4,0x5],_0x4543d6=['B','F','S'],_0x5c4c8a=[0x5,0x4,0x3,0x2,0x1],_0x3f3ad0=[_0x3d5d7e(0x192),'Floor'],_0x59d815=['C'],_0x732b4=['C'];break;case'Rack\x20D':_0x1943f7=[0x5,0x4,0x3,0x2,0x1],_0x4543d6=['F','B','S'],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=['Level',_0x3d5d7e(0x135)],_0x59d815=['C'],_0x732b4=['D'];break;case _0x3d5d7e(0xd1):_0x1943f7=[0x4,0x3,0x2,0x1],_0x4543d6=[0x1,0x2],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=['Level','Floor'],_0x59d815=['C'],_0x732b4=['E'];break;case _0x3d5d7e(0x128):_0x1943f7=[0x1,0x2,0x3],_0x4543d6=[0x1,0x2],_0x5c4c8a=[0x1,0x2,0x3,0x4,0x5],_0x3f3ad0=[_0x3d5d7e(0x192)],_0x59d815=['C'],_0x732b4=['F'];break;}}return{'levels':_0x1943f7,'Isle':_0x4543d6,'rack':_0x5c4c8a,'type':_0x3f3ad0,'storage':_0x59d815,'rak':_0x732b4};}function a0_0x3faa(){var _0x20f44f=['logo','Rack\x20A','Floor','$maxProdPerUnit','RoomAssign','</thead>','name','True','prod_code','$product.type','message','master','50jOlGWo','/barcode_scanner','MaxStocks_data','$suppliers','redirect','$product_details.bin','\x20Order\x20Number\x20:\x20','password','/give_payment/:id','$warehouse_name','language','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','product_code_hide','POnumber','Rack\x20C','$product_details.product_code','forEach','error','return_product','secondary_code','Purchase\x20Return','$room','map','$product.quantity','RMSEmail','actual_uom','/view/return_purchase/:id','Rack\x20B','email','exports','$primary_code','back','JO_number','all','success','Ambient','bay','Portuguese\x20(BR)','date','$product_details.type','table\x20page','$product_details.product_name','German','\x20<>\x20','French','get','/view/:id','$product_details','all_purchases','101318nDTAUg','An\x20error\x20occurred\x20while\x20saving\x20data.','purchase\x20data\x20update\x20successfully','path','prod_isle','aggregate','/view/add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','English\x20(US)','errors','prod_pallet','all_purchases_barcode','pallet','production_date','add_purchases\x20error','primary_code_hide','Sales\x20Update\x20successfully','product_name','express','purchase_invoice','image','types','maxperunit','slice','currency','$product_details.pallet','Purchase\x20Mail','createTransport','168JLMXrz','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','foreach\x20newproduct','params','Hindi','prod_primunit','Level','catch','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Return\x20Goods','sendMail','$brand','$date','</h5>','$product_details.floorlevel','warehouse','find','$product_details.storage','</tr>','Portuguese','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','note','$product_code','ejs','Logo.png','/all_purchases/view/','$due_amount','$paid_amount','concat','26642XDogTl','product_details','gmail','INC-','<span\x20style=\x22float:\x20right;\x22>','json','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$alertquantity','</tbody>','$maxStocks','storage','<table\x20style=\x22width:\x20100%\x20!important;\x22>','\x20</h2>','prod_Qty','</body></html>','secondary_unit','bin','$_id','edit_purchases','/upload/','<hr\x20class=\x22my-3\x22>','rak','log','../public/language/languages.json','amount','flash','suppliers_docs','$expiry_date','<strong>\x20Regards\x20</strong>','$product_details.primary_code','<div>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','warehouse_name','28mAvbPZ','<h5>','getMonth','$product_details.isle','$product.bin','finalize','/preview/:id','English','user','/view','107305MnPhHu','$product.floorlevel','$product_details.bay','$product.bay','product_code','prod_secondunit','Paid\x20For\x20Purchase','padStart','42OtJWig','There\x27s\x20a\x20error\x20in\x20this\x20transaction','secondary_code_hide','product','max_product_unit','<tr>','$secondary_unit','Purchase\x20data\x20added\x20successfully','Router','findOne','due_amount','<tbody\x20style=\x22text-align:\x20center;\x22>','floorlevel','push','prod_level','paid_amount','primary_code','prod_cat','Enabled','then','Rack\x20E','$suppliers_docs','product_stock','alertQTY','toString','delivery_date','$name','room','/all_purchases/view','$product_details.secondary_code','$product_details._id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<html><head><title></title>','post','filter','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','delivery_code','render','1976310jGdhWm','26454NCZwdz','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<h2>\x20','expiry_date','Receiving\x20Area','</head><body>','prod_invoice','125116HwVESK','rack','maxStocks','length','Error\x20Occurs','host','$category','findById','$note','DRY\x20STORAGE','return_qty','$product_details.rack','Chinese','deliverycode','Email\x20sent\x20successfully','$unit','$batch_code','site_title','purchase_quantity','<h5\x20style=\x22text-align:\x20left;\x22>','$product','stock_quantity','prod_unit','8wylAKP','$secondary_code','string','Enclosed','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','stock_data','suppliers','save','COLD\x20STORAGE','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_name','/../public','Spanish','$invoice','abs','$return_data','Shelves','status','return_data','invoice','\x20Order\x20Date\x20:\x20','/invoice/:id','</div>','actual_qty','235809SpDslk','role','<!DOCTYPE\x20html>','stocks','Arabic','batch_code','$product_details.maxProducts','</span>','staff','Arabic\x20(ae)','product_cat','Rack\x20F','suppliers_data','prod_qty','</table>','level','/CheckingWarehouse','$product_details.product_stock','quantity','body','standard_unit','type'];a0_0x3faa=function(){return _0x20f44f;};return a0_0x3faa();}async function getRandom8DigitNumber(){var _0x4bb533=a0_0x463ef1;const _0x33fca3=0x989680,_0x2a9a91=0x5f5e0ff,_0x4f9be1=Math['floor'](Math['random']()*(_0x2a9a91-_0x33fca3+0x1))+_0x33fca3;var _0x45aff6;const _0x1e0aff=await purchases[_0x4bb533(0xc6)]({'invoice':'INC-'+_0x4f9be1});return _0x1e0aff&&_0x1e0aff[_0x4bb533(0xf0)]>0x0?_0x45aff6=_0x4bb533(0x1ad)+_0x4f9be1:_0x45aff6=_0x4bb533(0x1ad)+_0x4f9be1,_0x45aff6;}router['get'](a0_0x463ef1(0x176),auth,async(_0x3c3725,_0x334a5e)=>{var _0x2075cc=a0_0x463ef1;try{const {username:_0x4b2f83,email:_0x215935,role:_0x15a559}=_0x3c3725[_0x2075cc(0xb3)],_0x30dc71=_0x3c3725['user'],_0xe07af=await profile[_0x2075cc(0xc6)]({'email':_0x30dc71[_0x2075cc(0x15b)]}),_0x54d186=await master_shop['find'](),_0x3b3981=await staff['findOne']({'email':_0x30dc71[_0x2075cc(0x15b)]}),_0x31a3c9=await suppliers[_0x2075cc(0x19d)]({});let _0x44ebc6;if(_0x30dc71[_0x2075cc(0x11e)]==_0x2075cc(0x125)){const _0x16b891=await staff[_0x2075cc(0xc6)]({'email':_0x30dc71[_0x2075cc(0x15b)]});_0x44ebc6=await warehouse['aggregate']([{'$match':{'status':_0x2075cc(0xcf),'name':_0x16b891['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2075cc(0x196)}}},{'$group':{'_id':'$name','name':{'$first':_0x2075cc(0xd7)}}}]);}else _0x44ebc6=await warehouse['aggregate']([{'$match':{'status':_0x2075cc(0xcf),'warehouse_category':_0x2075cc(0x194),'name':{'$ne':_0x2075cc(0x196)}}},{'$group':{'_id':_0x2075cc(0xd7),'name':{'$first':_0x2075cc(0xd7)}}}]);const _0x3c0552=await product[_0x2075cc(0x19d)]({}),_0x52bfe9=await warehouse[_0x2075cc(0x19d)]({'status':_0x2075cc(0xcf)}),_0x706f58=await purchases[_0x2075cc(0x19d)]({}),_0x253b9f=_0x706f58[_0x2075cc(0xf0)]+0x1,_0x26ced0=_0x2075cc(0x1ad)+_0x253b9f[_0x2075cc(0xd5)]()[_0x2075cc(0xbc)](0x5,'0');var _0x1cbdf2=[_0x2075cc(0x162),_0x2075cc(0x107)];if(_0x54d186[0x0][_0x2075cc(0x149)]==_0x2075cc(0x178))var _0x18c43a=users['English'];else{if(_0x54d186[0x0]['language']==_0x2075cc(0x190))var _0x18c43a=users['Hindi'];else{if(_0x54d186[0x0][_0x2075cc(0x149)]==_0x2075cc(0x169))var _0x18c43a=users[_0x2075cc(0x169)];else{if(_0x54d186[0x0][_0x2075cc(0x149)]=='Spanish')var _0x18c43a=users[_0x2075cc(0x111)];else{if(_0x54d186[0x0][_0x2075cc(0x149)]=='French')var _0x18c43a=users[_0x2075cc(0x16b)];else{if(_0x54d186[0x0][_0x2075cc(0x149)]==_0x2075cc(0x164))var _0x18c43a=users[_0x2075cc(0x1a0)];else{if(_0x54d186[0x0]['language']==_0x2075cc(0xf9))var _0x18c43a=users['Chinese'];else{if(_0x54d186[0x0]['language']==_0x2075cc(0x126))var _0x18c43a=users[_0x2075cc(0x121)];}}}}}}}const _0x239d05=getRandom8DigitNumber();_0x239d05[_0x2075cc(0xd0)](_0x1a9d97=>{var _0x461e03=_0x2075cc;_0x334a5e[_0x461e03(0xe3)]('add_purchases',{'success':_0x3c3725[_0x461e03(0x1c3)]('success'),'errors':_0x3c3725[_0x461e03(0x1c3)](_0x461e03(0x179)),'role':_0x30dc71,'profile':_0xe07af,'suppliers':_0x31a3c9,'warehouse':_0x44ebc6,'product':_0x3c0552,'invoice':_0x1a9d97,'master_shop':_0x54d186,'language':_0x18c43a,'find_data':_0x52bfe9,'rooms_data':_0x1cbdf2});})['catch'](_0x29da5f=>{var _0x2e4147=_0x2075cc;_0x3c3725[_0x2e4147(0x1c3)]('errors',_0x2e4147(0xbe)),_0x334a5e[_0x2e4147(0x143)](_0x2e4147(0xd9));});}catch(_0x320883){console['log'](_0x320883);}}),router[a0_0x463ef1(0x16c)]('/view/add_purchases/:id',auth,async(_0x5b1e07,_0x11f21f)=>{var _0x4457d7=a0_0x463ef1;try{const _0xe989cd=_0x5b1e07[_0x4457d7(0x18f)]['id'];console[_0x4457d7(0x1c0)](_0xe989cd);const _0x464bde=await master_shop[_0x4457d7(0x19d)]();console[_0x4457d7(0x1c0)](_0x4457d7(0x13e),_0x464bde);const _0x87ccd6=await product[_0x4457d7(0xc6)]({'name':_0xe989cd});console[_0x4457d7(0x1c0)](_0x4457d7(0xc0),_0x87ccd6),_0x11f21f[_0x4457d7(0x116)](0xc8)[_0x4457d7(0x1af)]({'product_data':_0x87ccd6,'master':_0x464bde});}catch(_0x3479be){console[_0x4457d7(0x1c0)](_0x4457d7(0x17e),_0x3479be);}}),router[a0_0x463ef1(0xde)]('/view/add_purchases',auth,async(_0x7dc0e,_0x4cbf54)=>{var _0x4a278=a0_0x463ef1;try{const {invoice:_0xf183af,date:_0x418a02,warehouse_name:_0x5ed0d8,prod_name:_0x4f83a8,prod_code:_0x5ea765,prod_qty:_0x173fb5,prod_unit:_0x3c339b,prod_secondunit:_0x2b74db,prod_level:_0x4f2bc4,prod_isle:_0x4286b7,prod_pallet:_0x819e07,note:_0x427d0c,expiry_date:_0x27eac2,batch_code:_0xab88fd,payable:_0x1df4e1,due_amount:_0x84766c,Room_name:_0xb82225,primary_code:_0x5bbc1c,secondary_code:_0x50a6ad,MaxStocks_data:_0x3dd91b,PO_number:_0xfe91a8,SCRN:_0x4f4ba0,JO_number:_0xba2098}=_0x7dc0e[_0x4a278(0x130)];if(typeof _0x4f83a8=='string')var _0x378e17=[_0x7dc0e['body'][_0x4a278(0x10f)]],_0x556955=[_0x7dc0e['body'][_0x4a278(0x13b)]],_0x585c87=[_0x7dc0e[_0x4a278(0x130)]['prod_Qty']],_0x239f3d=[_0x7dc0e['body']['prod_primunit']],_0x168e7e=[_0x7dc0e[_0x4a278(0x130)][_0x4a278(0xba)]],_0x2bbd73=[_0x7dc0e['body'][_0x4a278(0xcb)]],_0x193eeb=[_0x7dc0e['body'][_0x4a278(0xcd)]],_0x3e70db=[_0x7dc0e['body'][_0x4a278(0x152)]],_0x27c1b2=[_0x7dc0e['body']['MaxStocks_data']],_0x12cba3=[_0x7dc0e['body'][_0x4a278(0x122)]],_0x5547d6=[_0x7dc0e['body'][_0x4a278(0xe9)]],_0x3c278a=[_0x7dc0e[_0x4a278(0x130)][_0x4a278(0xc1)]],_0x58c8fa=[_0x7dc0e[_0x4a278(0x130)][_0x4a278(0xd4)]],_0x3d4dcf=[_0x7dc0e[_0x4a278(0x130)][_0x4a278(0x17d)]],_0x3dad97=[_0x7dc0e[_0x4a278(0x130)]['prod_cat']],_0x306e6b=[_0x7dc0e['body']['RoomAssign']],_0x34c914=[_0x7dc0e[_0x4a278(0x130)]['deliverycode']],_0x44bab8=[_0x7dc0e[_0x4a278(0x130)][_0x4a278(0xec)]],_0x20c46d=[_0x7dc0e[_0x4a278(0x130)][_0x4a278(0x11c)]],_0x42e2fe=[_0x7dc0e['body'][_0x4a278(0x158)]];else var _0x378e17=[..._0x7dc0e['body'][_0x4a278(0x10f)]],_0x556955=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x13b)]],_0x585c87=[..._0x7dc0e['body'][_0x4a278(0x1b7)]],_0x239f3d=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x191)]],_0x168e7e=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xba)]],_0x2bbd73=[..._0x7dc0e['body'][_0x4a278(0xcb)]],_0x193eeb=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xcd)]],_0x3e70db=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x152)]],_0x27c1b2=[..._0x7dc0e[_0x4a278(0x130)]['MaxStocks_data']],_0x12cba3=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x122)]],_0x5547d6=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xe9)]],_0x3c278a=[..._0x7dc0e['body']['max_product_unit']],_0x58c8fa=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xd4)]],_0x3d4dcf=[..._0x7dc0e['body'][_0x4a278(0x17d)]],_0x3dad97=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xce)]],_0x306e6b=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x137)]],_0x34c914=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xfa)]],_0x44bab8=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0xec)]],_0x20c46d=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x11c)]],_0x42e2fe=[..._0x7dc0e[_0x4a278(0x130)][_0x4a278(0x158)]];const _0x371b1d=_0x378e17['map'](_0x5974e3=>{return _0x5974e3={'product_name':_0x5974e3};});_0x20c46d[_0x4a278(0x14f)]((_0x3ec8e7,_0x180ff7)=>{var _0x59c4cb=_0x4a278;_0x371b1d[_0x180ff7][_0x59c4cb(0x11c)]=Math['abs'](_0x3ec8e7);}),_0x42e2fe[_0x4a278(0x14f)]((_0x45c7dd,_0xe251a8)=>{_0x371b1d[_0xe251a8]['actual_uom']=_0x45c7dd;}),_0x556955[_0x4a278(0x14f)]((_0x7d2fa6,_0x3c1a6b)=>{var _0x5de358=_0x4a278;_0x371b1d[_0x3c1a6b][_0x5de358(0xb9)]=_0x7d2fa6;}),_0x585c87[_0x4a278(0x14f)]((_0x152aa7,_0x54896b)=>{var _0x13be11=_0x4a278;_0x371b1d[_0x54896b]['quantity']=Math[_0x13be11(0x113)](_0x152aa7);}),_0x239f3d[_0x4a278(0x14f)]((_0x506d82,_0x390c58)=>{var _0x19b5de=_0x4a278;_0x371b1d[_0x390c58][_0x19b5de(0x131)]=_0x506d82;}),_0x168e7e['forEach']((_0x1cb758,_0x4224a3)=>{_0x371b1d[_0x4224a3]['secondary_unit']=_0x1cb758;}),_0x2bbd73[_0x4a278(0x14f)]((_0x3e70d3,_0x1e4485)=>{_0x306e6b['forEach']((_0x3740db,_0x3ad989)=>{var _0x5ee2bc=a0_0x1e7f;if(_0x3740db==_0x5ee2bc(0xea)&&_0x1e4485==_0x3ad989){console[_0x5ee2bc(0x1c0)](_0x3740db+'\x20<\x20wew\x20>\x20'+_0x1e4485+_0x5ee2bc(0x16a)+_0x3ad989+_0x5ee2bc(0x16a)+_0x3e70d3);var _0x11c27a=_0x3e70d3[_0x5ee2bc(0x187)](0x3);_0x371b1d[_0x1e4485][_0x5ee2bc(0x1b4)]=_0x3e70d3[0x0],_0x371b1d[_0x1e4485][_0x5ee2bc(0xee)]=_0x3e70d3[0x1],_0x371b1d[_0x1e4485]['bay']=0x0,_0x371b1d[_0x1e4485][_0x5ee2bc(0x1ba)]=0x0,_0x371b1d[_0x1e4485][_0x5ee2bc(0x132)]=_0x5ee2bc(0x135),_0x371b1d[_0x1e4485][_0x5ee2bc(0xc9)]=_0x11c27a;}else{if(_0x3740db=='Shelves'&&_0x1e4485==_0x3ad989){var _0x11c27a=_0x3e70d3[_0x5ee2bc(0x187)](0x3);_0x371b1d[_0x1e4485]['storage']=_0x3e70d3[0x0],_0x371b1d[_0x1e4485]['rack']=_0x3e70d3[0x1],_0x371b1d[_0x1e4485][_0x5ee2bc(0x163)]=0x0,_0x371b1d[_0x1e4485][_0x5ee2bc(0x1ba)]=0x0,_0x371b1d[_0x1e4485][_0x5ee2bc(0x132)]=_0x5ee2bc(0x135),_0x371b1d[_0x1e4485]['floorlevel']=_0x3e70d3[0x5];}else{if(_0x1e4485==_0x3ad989){var _0x2f16f4;if(_0x3e70d3[0x4]=='L')_0x2f16f4=_0x5ee2bc(0x192);else _0x3e70d3[0x4]=='F'&&(_0x2f16f4=_0x5ee2bc(0x135));_0x371b1d[_0x1e4485]['storage']=_0x3e70d3[0x0],_0x371b1d[_0x1e4485][_0x5ee2bc(0xee)]=_0x3e70d3[0x1],_0x371b1d[_0x1e4485][_0x5ee2bc(0x163)]=_0x3e70d3[0x2],_0x371b1d[_0x1e4485]['bin']=_0x3e70d3[0x3],_0x371b1d[_0x1e4485][_0x5ee2bc(0x132)]=_0x2f16f4,_0x371b1d[_0x1e4485][_0x5ee2bc(0xc9)]=_0x3e70d3[0x5];}}}});}),_0x193eeb[_0x4a278(0x14f)]((_0x1bc405,_0x523e3a)=>{var _0x298832=_0x4a278;_0x371b1d[_0x523e3a][_0x298832(0xcd)]=_0x1bc405;}),_0x3e70db[_0x4a278(0x14f)]((_0x5b97ff,_0x1c01d7)=>{var _0x33e051=_0x4a278;_0x371b1d[_0x1c01d7][_0x33e051(0x152)]=_0x5b97ff;}),_0x27c1b2[_0x4a278(0x14f)]((_0x5e28aa,_0x5424a8)=>{var _0x4738d5=_0x4a278;_0x371b1d[_0x5424a8][_0x4738d5(0xef)]=_0x5e28aa;}),_0x12cba3[_0x4a278(0x14f)]((_0x45c739,_0xbed155)=>{var _0x114d83=_0x4a278;_0x371b1d[_0xbed155][_0x114d83(0x122)]=_0x45c739;}),_0x5547d6[_0x4a278(0x14f)]((_0x1ca169,_0x582e01)=>{_0x371b1d[_0x582e01]['expiry_date']=_0x1ca169;}),_0x3c278a[_0x4a278(0x14f)]((_0x5ce28d,_0x4274d0)=>{var _0x383c25=_0x4a278;_0x371b1d[_0x4274d0][_0x383c25(0x186)]=_0x5ce28d;}),_0x58c8fa[_0x4a278(0x14f)]((_0xb44b4b,_0x5e6457)=>{_0x371b1d[_0x5e6457]['alertQTY']=_0xb44b4b;}),_0x3d4dcf[_0x4a278(0x14f)]((_0x3ebe7a,_0x3cb5b4)=>{var _0x43bd77=_0x4a278;_0x371b1d[_0x3cb5b4][_0x43bd77(0x17d)]=_0x3ebe7a;}),_0x3dad97[_0x4a278(0x14f)]((_0x521ae2,_0x4984a1)=>{var _0x1ba416=_0x4a278;_0x371b1d[_0x4984a1][_0x1ba416(0x127)]=_0x521ae2;}),_0x306e6b[_0x4a278(0x14f)]((_0x5592ea,_0x384da0)=>{_0x371b1d[_0x384da0]['room_name']=_0x5592ea;}),_0x34c914[_0x4a278(0x14f)]((_0x293c19,_0x261e1c)=>{var _0x58bd52=_0x4a278;_0x371b1d[_0x261e1c][_0x58bd52(0xe2)]=_0x293c19;}),_0x44bab8['forEach']((_0x7e4fd6,_0x44642d)=>{var _0x58ad83=_0x4a278;_0x371b1d[_0x44642d][_0x58ad83(0x118)]=_0x7e4fd6;});const _0x3cfb15=_0x306e6b[_0x4a278(0x155)](_0x256fd8=>{return _0x256fd8={'room_name':_0x256fd8};}),_0x535513=_0x371b1d[_0x4a278(0xdf)](_0x1c642b=>_0x1c642b[_0x4a278(0x12f)]!=='0'&&_0x1c642b[_0x4a278(0x12f)]!==''),_0x1273fd=new purchases({'invoice':_0xf183af,'suppliers':_0x7dc0e[_0x4a278(0x130)][_0x4a278(0x10b)],'date':_0x418a02,'warehouse_name':_0x5ed0d8,'product':_0x535513,'note':_0x427d0c,'due_amount':_0x84766c,'POnumber':_0xfe91a8,'SCRN':_0x4f4ba0,'JO_number':_0xba2098,'roomList':_0x3cfb15}),_0x40428c=await _0x1273fd['save'](),_0x1a7e10=await purchases['findOne']({'invoice':_0xf183af}),_0x59ff1c=_0x1a7e10[_0x4a278(0xc0)][_0x4a278(0x155)](async _0x53b662=>{var _0x50984d=_0x4a278,_0x3128ee=await warehouse[_0x50984d(0xc6)]({'name':_0x5ed0d8,'room':_0x53b662[_0x50984d(0x108)]}),_0x954886=0x0;return _0x3128ee[_0x50984d(0x1ab)][_0x50984d(0x14f)](_0x1cdacc=>{var _0x3acfc5=_0x50984d;_0x1cdacc[_0x3acfc5(0x181)]==_0x53b662[_0x3acfc5(0x181)]&&_0x1cdacc['floorlevel']==_0x53b662[_0x3acfc5(0xc9)]&&_0x1cdacc[_0x3acfc5(0x132)]==_0x53b662[_0x3acfc5(0x132)]&&_0x1cdacc[_0x3acfc5(0x1ba)]==_0x53b662['bin']&&_0x1cdacc[_0x3acfc5(0x163)]==_0x53b662[_0x3acfc5(0x163)]&&_0x1cdacc['rack']==_0x53b662['rack']&&_0x1cdacc[_0x3acfc5(0x1b4)]==_0x53b662[_0x3acfc5(0x1b4)]&&_0x1cdacc[_0x3acfc5(0xe9)]==_0x53b662['expiry_date']&&_0x1cdacc[_0x3acfc5(0x122)]==_0x53b662[_0x3acfc5(0x122)]&&_0x1cdacc[_0x3acfc5(0x17d)]==_0x53b662['production_date']&&_0x1cdacc[_0x3acfc5(0x118)]==_0x1a7e10[_0x3acfc5(0x118)]&&(_0x1cdacc[_0x3acfc5(0xd3)]+=Math[_0x3acfc5(0x113)](_0x53b662[_0x3acfc5(0x12f)]),_0x954886++);}),_0x954886===0x0&&_0x3128ee[_0x50984d(0x1ab)][_0x50984d(0xca)]({'product_name':_0x53b662['product_name'],'product_stock':Math[_0x50984d(0x113)](_0x53b662[_0x50984d(0x12f)]),'primary_code':_0x53b662[_0x50984d(0xcd)],'secondary_code':_0x53b662[_0x50984d(0x152)],'product_code':_0x53b662[_0x50984d(0xb9)],'storage':_0x53b662[_0x50984d(0x1b4)],'rack':_0x53b662['rack'],'bay':_0x53b662[_0x50984d(0x163)],'bin':_0x53b662['bin'],'type':_0x53b662[_0x50984d(0x132)],'floorlevel':_0x53b662[_0x50984d(0xc9)],'maxProducts':_0x53b662['maxStocks'],'unit':_0x53b662['standard_unit'],'secondary_unit':_0x53b662['secondary_unit'],'expiry_date':_0x53b662['expiry_date'],'maxPerUnit':_0x53b662['maxperunit'],'batch_code':_0x53b662[_0x50984d(0x122)],'alertQTY':_0x53b662['alertQTY'],'production_date':_0x53b662[_0x50984d(0x17d)],'product_cat':_0x53b662['product_cat'],'invoice':_0x53b662[_0x50984d(0x118)],'actual_qty':Math[_0x50984d(0x113)](_0x53b662[_0x50984d(0x11c)]),'actual_uom':_0x53b662[_0x50984d(0x158)]}),_0x3128ee;});Promise[_0x4a278(0x160)](_0x59ff1c)['then'](async _0x15d341=>{var _0x593dbf=_0x4a278;try{for(const _0x3cc178 of _0x15d341){await _0x3cc178[_0x593dbf(0x10c)]();}const _0x3db179=await master_shop[_0x593dbf(0x19d)](),_0xc46504=await email_settings[_0x593dbf(0xc6)](),_0x6c8b52=await supervisor_settings[_0x593dbf(0x19d)]();var _0x289d82=_0x1a7e10[_0x593dbf(0xc0)],_0x543698='',_0x35d4d3;for(_0x35d4d3 in _0x289d82){_0x543698+=_0x593dbf(0xc2)+_0x593dbf(0xdc)+_0x289d82[_0x35d4d3][_0x593dbf(0x181)]+_0x593dbf(0xe0)+_0x593dbf(0xdc)+_0x289d82[_0x35d4d3][_0x593dbf(0xb9)]+'</td>'+_0x593dbf(0xdc)+_0x289d82[_0x35d4d3]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x289d82[_0x35d4d3][_0x593dbf(0x131)]+_0x593dbf(0xe0)+_0x593dbf(0xdc)+_0x289d82[_0x35d4d3]['secondary_unit']+_0x593dbf(0xe0)+_0x593dbf(0xdc)+_0x1a7e10[_0x593dbf(0xaa)]+'</td>'+_0x593dbf(0xdc)+_0x289d82[_0x35d4d3][_0x593dbf(0x108)]+_0x593dbf(0xe0)+_0x593dbf(0xdc)+_0x289d82[_0x35d4d3]['storage']+_0x289d82[_0x35d4d3][_0x593dbf(0xee)]+_0x289d82[_0x35d4d3][_0x593dbf(0x163)]+_0x289d82[_0x35d4d3][_0x593dbf(0x1ba)]+_0x289d82[_0x35d4d3]['type'][0x0]+_0x289d82[_0x35d4d3][_0x593dbf(0xc9)]+_0x593dbf(0xe0),_0x593dbf(0x19f);}let _0x3ac35e=nodemailer[_0x593dbf(0x18b)]({'host':_0xc46504[_0x593dbf(0xf2)],'port':Number(_0xc46504['port']),'secure':![],'auth':{'user':_0xc46504['email'],'pass':_0xc46504[_0x593dbf(0x146)]}}),_0x629afa={'from':_0xc46504['email'],'to':_0x6c8b52[0x0][_0x593dbf(0x157)],'subject':_0x593dbf(0x18a),'attachments':[{'filename':_0x593dbf(0x1a5),'path':__dirname+_0x593dbf(0x110)+_0x593dbf(0x1bd)+_0x3db179[0x0]['image'],'cid':_0x593dbf(0x133)}],'html':'<!DOCTYPE\x20html>'+_0x593dbf(0xdd)+'</head><body>'+'<div>'+_0x593dbf(0xa9)+'<div>'+_0x593dbf(0x1a1)+_0x593dbf(0x11b)+'<div>'+_0x593dbf(0xe8)+_0x3db179[0x0][_0x593dbf(0xfe)]+'\x20</h2>'+'</div>'+'</div>'+_0x593dbf(0x1be)+_0x593dbf(0xa8)+_0x593dbf(0x100)+'\x20Order\x20Number\x20:\x20'+_0x1a7e10[_0x593dbf(0x118)]+'\x20'+_0x593dbf(0x1ae)+_0x593dbf(0x119)+_0x1a7e10[_0x593dbf(0x165)]+'\x20'+_0x593dbf(0x124)+'</h5>'+_0x593dbf(0x11b)+_0x593dbf(0x1b5)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x593dbf(0xc2)+_0x593dbf(0xe6)+_0x593dbf(0x10e)+_0x593dbf(0x18d)+_0x593dbf(0xe7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x593dbf(0x109)+_0x593dbf(0xe1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x593dbf(0xc8)+'\x20'+_0x543698+'\x20'+_0x593dbf(0x1b2)+_0x593dbf(0x12b)+_0x593dbf(0xa8)+_0x593dbf(0x1c6)+_0x593dbf(0xac)+_0x3db179[0x0][_0x593dbf(0xfe)]+_0x593dbf(0x19a)+_0x593dbf(0x11b)+'</div>'+_0x593dbf(0x1b8)};_0x3ac35e['sendMail'](_0x629afa,function(_0x591226,_0x1be3b9){var _0x268e9d=_0x593dbf;_0x591226?(console[_0x268e9d(0x1c0)](_0x591226),console['log'](_0x268e9d(0xf1))):console[_0x268e9d(0x1c0)](_0x268e9d(0xfb));}),_0x7dc0e[_0x593dbf(0x1c3)](_0x593dbf(0x161),_0x593dbf(0xc4)),_0x4cbf54[_0x593dbf(0x143)](_0x593dbf(0x1a6));}catch(_0x513ecb){console[_0x593dbf(0x150)](_0x513ecb),_0x4cbf54[_0x593dbf(0x116)](0x1f4)['json']({'error':_0x593dbf(0x171)});}})[_0x4a278(0x193)](_0x53def0=>{var _0x138805=_0x4a278;console['error'](_0x53def0),_0x4cbf54[_0x138805(0x116)](0x1f4)[_0x138805(0x1af)]({'error':'An\x20error\x20occurred.'});});}catch(_0x19b29d){console[_0x4a278(0x1c0)](_0x19b29d);}}),router[a0_0x463ef1(0x16c)]('/preview/:id',auth,async(_0x43320a,_0x287ef2)=>{var _0x292ef2=a0_0x463ef1;try{const {username:_0x195756,email:_0x32de73,role:_0x2c5611}=_0x43320a[_0x292ef2(0xb3)],_0x5605d0=_0x43320a[_0x292ef2(0xb3)],_0x24ffa6=await profile['findOne']({'email':_0x5605d0[_0x292ef2(0x15b)]}),_0x66f807=await master_shop[_0x292ef2(0x19d)](),_0x2efd3c=_0x43320a[_0x292ef2(0x18f)]['id'],_0xe9560d=await purchases['findById'](_0x2efd3c),_0x1fda21=await warehouse['aggregate']([{'$match':{'name':_0xe9560d[_0x292ef2(0xaa)],'room':_0xe9560d[_0x292ef2(0xd8)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x292ef2(0x168)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x292ef2(0x144)},'type':{'$first':_0x292ef2(0x166)},'floorlevel':{'$first':_0x292ef2(0x19b)},'primary_code':{'$first':_0x292ef2(0xa7)},'secondary_code':{'$first':_0x292ef2(0xda)},'product_code':{'$first':_0x292ef2(0x14e)},'storage':{'$first':_0x292ef2(0x19e)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x3e16f6=await customer[_0x292ef2(0x19d)]({});let _0x2b3c53;if(_0x5605d0[_0x292ef2(0x11e)]==_0x292ef2(0x125)){const _0x36bc3e=await staff[_0x292ef2(0xc6)]({'email':_0x5605d0['email']});_0x2b3c53=await warehouse[_0x292ef2(0x175)]([{'$match':{'status':'Enabled','name':_0x36bc3e[_0x292ef2(0x19c)]}},{'$group':{'_id':_0x292ef2(0xd7),'name':{'$first':_0x292ef2(0xd7)}}}]);}else _0x2b3c53=await warehouse['aggregate']([{'$match':{'status':_0x292ef2(0xcf)}},{'$group':{'_id':_0x292ef2(0xd7),'name':{'$first':'$name'}}}]);const _0x308e8e=await product[_0x292ef2(0x19d)]({}),_0x417193=await suppliers[_0x292ef2(0x19d)]({}),_0x141019=BayBinSelected(_0xe9560d['warehouse_name'],_0xe9560d[_0x292ef2(0xd8)]);if(_0x66f807[0x0][_0x292ef2(0x149)]==_0x292ef2(0x178)){var _0x4a09eb=users['English'];console['log'](_0x4a09eb);}else{if(_0x66f807[0x0][_0x292ef2(0x149)]=='Hindi')var _0x4a09eb=users[_0x292ef2(0x190)];else{if(_0x66f807[0x0][_0x292ef2(0x149)]==_0x292ef2(0x169))var _0x4a09eb=users[_0x292ef2(0x169)];else{if(_0x66f807[0x0][_0x292ef2(0x149)]==_0x292ef2(0x111))var _0x4a09eb=users[_0x292ef2(0x111)];else{if(_0x66f807[0x0][_0x292ef2(0x149)]==_0x292ef2(0x16b))var _0x4a09eb=users[_0x292ef2(0x16b)];else{if(_0x66f807[0x0]['language']==_0x292ef2(0x164))var _0x4a09eb=users[_0x292ef2(0x1a0)];else{if(_0x66f807[0x0]['language']==_0x292ef2(0xf9))var _0x4a09eb=users[_0x292ef2(0xf9)];else{if(_0x66f807[0x0][_0x292ef2(0x149)]=='Arabic\x20(ae)')var _0x4a09eb=users['Arabic'];}}}}}}}_0x287ef2[_0x292ef2(0xe3)]('edit_purchases_view',{'success':_0x43320a[_0x292ef2(0x1c3)](_0x292ef2(0x161)),'errors':_0x43320a[_0x292ef2(0x1c3)](_0x292ef2(0x179)),'role':_0x5605d0,'profile':_0x24ffa6,'customer':_0x3e16f6,'warehouse':_0x2b3c53,'product':_0x1fda21,'user':_0xe9560d,'master_shop':_0x66f807,'unit':_0x308e8e,'language':_0x4a09eb,'suppliers':_0x417193,'dataSelected':_0x141019});}catch(_0x586234){console[_0x292ef2(0x1c0)](_0x586234);}}),router[a0_0x463ef1(0xde)](a0_0x463ef1(0xb1),auth,async(_0x8ffbce,_0x1074b2)=>{var _0xbb81=a0_0x463ef1;try{const _0x56e2df=_0x8ffbce['params']['id'],{invoice:_0x126110,warehouse_name:_0x4fe7d6,Room_name:_0xee8b03}=_0x8ffbce[_0xbb81(0x130)],_0x486ae0=await warehouse[_0xbb81(0xc6)]({'name':_0x4fe7d6,'room':_0xee8b03}),_0x5c06d3=await purchases[_0xbb81(0xc6)]({'invoice':_0x126110});_0x5c06d3[_0xbb81(0xc0)][_0xbb81(0x14f)](_0x396bce=>{var _0x286e39=_0xbb81,_0x207ea7=0x0;const _0xa5bfcf=_0x486ae0[_0x286e39(0x1ab)]['map'](_0x1b9f67=>{var _0x4debe9=_0x286e39;_0x1b9f67[_0x4debe9(0x181)]==_0x396bce[_0x4debe9(0x181)]&&_0x1b9f67['floorlevel']==_0x396bce['floorlevel']&&_0x1b9f67[_0x4debe9(0x132)]==_0x396bce[_0x4debe9(0x132)]&&_0x1b9f67[_0x4debe9(0x1ba)]==_0x396bce['bin']&&_0x1b9f67[_0x4debe9(0x163)]==_0x396bce['bay']&&_0x1b9f67['rack']==_0x396bce['rack']&&_0x1b9f67[_0x4debe9(0x1b4)]==_0x396bce[_0x4debe9(0x1b4)]&&_0x1b9f67[_0x4debe9(0xe9)]==_0x396bce[_0x4debe9(0xe9)]&&_0x1b9f67[_0x4debe9(0x122)]==_0x396bce['batch_code']&&_0x1b9f67['production_date']==_0x396bce[_0x4debe9(0x17d)]&&_0x1b9f67[_0x4debe9(0xd6)]==_0x396bce[_0x4debe9(0xd6)]&&_0x1b9f67[_0x4debe9(0xe2)]==_0x396bce[_0x4debe9(0xe2)]&&(_0x1b9f67[_0x4debe9(0xd3)]=parseInt(_0x1b9f67[_0x4debe9(0xd3)])+parseInt(_0x396bce[_0x4debe9(0x12f)]),_0x207ea7++);});_0x207ea7=='0'&&(_0x486ae0[_0x286e39(0x1ab)]=_0x486ae0[_0x286e39(0x1ab)][_0x286e39(0x1a9)]({'product_name':_0x396bce[_0x286e39(0x181)],'product_stock':_0x396bce[_0x286e39(0x12f)],'primary_code':_0x396bce['primary_code'],'secondary_code':_0x396bce[_0x286e39(0x152)],'product_code':_0x396bce[_0x286e39(0xb9)],'storage':_0x396bce[_0x286e39(0x1b4)],'rack':_0x396bce[_0x286e39(0xee)],'bay':_0x396bce[_0x286e39(0x163)],'bin':_0x396bce[_0x286e39(0x1ba)],'type':_0x396bce[_0x286e39(0x132)],'floorlevel':_0x396bce[_0x286e39(0xc9)],'maxProducts':_0x396bce[_0x286e39(0xef)],'unit':_0x396bce[_0x286e39(0x131)],'secondary_unit':_0x396bce[_0x286e39(0x1b9)],'expiry_date':_0x396bce[_0x286e39(0xe9)],'maxPerUnit':_0x396bce[_0x286e39(0x186)],'batch_code':_0x396bce['batch_code'],'alertQTY':_0x396bce[_0x286e39(0xd4)],'production_date':_0x396bce[_0x286e39(0x17d)],'delivery_date':_0x396bce[_0x286e39(0xd6)],'delivery_code':_0x396bce[_0x286e39(0xe2)]}));}),await _0x486ae0[_0xbb81(0x10c)](),_0x5c06d3[_0xbb81(0xb0)]=_0xbb81(0x13a);const _0x1bb5b8=await _0x5c06d3[_0xbb81(0x10c)]();_0x8ffbce[_0xbb81(0x1c3)]('success',_0xbb81(0x180)),_0x1074b2[_0xbb81(0x143)](_0xbb81(0xd9));}catch(_0x323573){console['log'](_0x323573);}}),router['get'](a0_0x463ef1(0x16d),auth,async(_0x45977d,_0x5f88b3)=>{var _0x299170=a0_0x463ef1;try{const {username:_0x20d254,email:_0x12906e,role:_0x4f44f5}=_0x45977d['user'],_0x50a40d=_0x45977d[_0x299170(0xb3)],_0x26dbea=await profile[_0x299170(0xc6)]({'email':_0x50a40d[_0x299170(0x15b)]}),_0x14a9f7=await master_shop[_0x299170(0x19d)](),_0x561820=_0x45977d[_0x299170(0x18f)]['id'],_0x54ce8f=await purchases[_0x299170(0xf4)](_0x561820),_0x25ea90=await suppliers[_0x299170(0x19d)]({});let _0x223004;if(_0x50a40d['role']==_0x299170(0x125)){const _0x189f4d=await staff[_0x299170(0xc6)]({'email':_0x50a40d[_0x299170(0x15b)]});_0x223004=await warehouse[_0x299170(0x19d)]({'status':'Enabled','name':_0x189f4d[_0x299170(0x19c)],'warehouse_category':_0x299170(0x194)});}else _0x223004=await warehouse[_0x299170(0x175)]([{'$match':{'status':_0x299170(0xcf),'warehouse_category':_0x299170(0x194)}},{'$group':{'_id':_0x299170(0xd7),'name':{'$first':_0x299170(0xd7)}}}]);const _0x3e0f14=await product[_0x299170(0x19d)]({}),_0x574cb4=BayBinSelected(_0x54ce8f[_0x299170(0xaa)],_0x54ce8f[_0x299170(0xd8)]);let _0x415b8a=new Date(_0x54ce8f[_0x299170(0xe9)]),_0xa715c=('0'+_0x415b8a['getDate']())[_0x299170(0x187)](-0x2),_0x46c706=('0'+(_0x415b8a['getMonth']()+0x1))['slice'](-0x2),_0x292762=_0x415b8a['getFullYear'](),_0x577e14=_0x292762+'-'+_0x46c706+'-'+_0xa715c;if(_0x14a9f7[0x0]['language']=='English\x20(US)'){var _0x29b026=users[_0x299170(0xb2)];console[_0x299170(0x1c0)](_0x29b026);}else{if(_0x14a9f7[0x0]['language']=='Hindi')var _0x29b026=users[_0x299170(0x190)];else{if(_0x14a9f7[0x0][_0x299170(0x149)]==_0x299170(0x169))var _0x29b026=users[_0x299170(0x169)];else{if(_0x14a9f7[0x0][_0x299170(0x149)]=='Spanish')var _0x29b026=users[_0x299170(0x111)];else{if(_0x14a9f7[0x0][_0x299170(0x149)]==_0x299170(0x16b))var _0x29b026=users['French'];else{if(_0x14a9f7[0x0][_0x299170(0x149)]==_0x299170(0x164))var _0x29b026=users[_0x299170(0x1a0)];else{if(_0x14a9f7[0x0]['language']=='Chinese')var _0x29b026=users[_0x299170(0xf9)];else{if(_0x14a9f7[0x0][_0x299170(0x149)]==_0x299170(0x126))var _0x29b026=users[_0x299170(0x121)];}}}}}}}_0x5f88b3[_0x299170(0xe3)](_0x299170(0x1bc),{'success':_0x45977d['flash'](_0x299170(0x161)),'errors':_0x45977d[_0x299170(0x1c3)](_0x299170(0x179)),'role':_0x50a40d,'profile':_0x26dbea,'purchases':_0x54ce8f,'suppliers':_0x25ea90,'warehouse':_0x223004,'product':_0x3e0f14,'master_shop':_0x14a9f7,'language':_0x29b026,'ed_fullDate':_0x577e14,'dataSelected':_0x574cb4});}catch(_0x4ac0b2){console[_0x299170(0x1c0)](_0x4ac0b2);}}),router['post'](a0_0x463ef1(0x16d),auth,async(_0x28155e,_0x59214d)=>{var _0x2b53b0=a0_0x463ef1;try{const _0x5e90f5=_0x28155e[_0x2b53b0(0x18f)]['id'],_0x4a9c4d=await purchases[_0x2b53b0(0xc6)]({'_id':_0x28155e[_0x2b53b0(0x18f)]['id']}),_0x3df081=await warehouse[_0x2b53b0(0xc6)]({'name':_0x4a9c4d[_0x2b53b0(0xaa)],'room':_0x4a9c4d[_0x2b53b0(0xd8)]});_0x4a9c4d[_0x2b53b0(0xc0)][_0x2b53b0(0x14f)](_0x30b67e=>{var _0x313db2=_0x2b53b0;const _0x405543=_0x3df081[_0x313db2(0x1ab)][_0x313db2(0x155)](_0x3e8fc4=>{var _0x1e3881=_0x313db2;_0x3e8fc4['product_name']==_0x30b67e[_0x1e3881(0x181)]&&_0x3e8fc4[_0x1e3881(0xc9)]==_0x30b67e[_0x1e3881(0xc9)]&&_0x3e8fc4[_0x1e3881(0x132)]==_0x30b67e[_0x1e3881(0x132)]&&_0x3e8fc4[_0x1e3881(0x1ba)]==_0x30b67e[_0x1e3881(0x1ba)]&&_0x3e8fc4['bay']==_0x30b67e['bay']&&_0x3e8fc4['rack']==_0x30b67e[_0x1e3881(0xee)]&&_0x3e8fc4[_0x1e3881(0x1b4)]==_0x30b67e['storage']&&(_0x3e8fc4[_0x1e3881(0xd3)]=parseInt(_0x3e8fc4[_0x1e3881(0xd3)])-parseInt(_0x30b67e[_0x1e3881(0x12f)]));});}),await _0x3df081[_0x2b53b0(0x10c)]();const {invoice:_0x362f26,suppliers:_0x115a76,date:_0x11211d,warehouse_name:_0x30c23a,prod_name:_0x46bae0,prod_code:_0x58692d,prod_qty:_0x3ae9b4,prod_unit:_0x88c1db,prod_secondunit:_0x66895a,prod_level:_0x3760bb,prod_isle:_0x45e1c6,prod_pallet:_0x5e35e0,note:_0x311161,expiry_date:_0xa35c8,batch_code:_0x5f3b58,paid_amount:_0x36f6a0,due_amount:_0x4899df,Room_name:_0x3570fb,primary_code:_0x30bea8,secondary_code:_0x3158a5,PO_number:_0x34c09c,JO_number:_0x19c1c2}=_0x28155e['body'];if(typeof _0x46bae0==_0x2b53b0(0x106))var _0x58ab82=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x10f)]],_0x3e9f99=[_0x28155e[_0x2b53b0(0x130)]['prod_code']],_0x2cb9d6=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x12a)]],_0x451ec6=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x103)]],_0x83aa81=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0xba)]],_0x34fbe8=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0xcb)]],_0x31a59d=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x174)]],_0x21aaee=[_0x28155e['body'][_0x2b53b0(0x17a)]],_0x2a6ed0=[_0x28155e['body']['primary_code']],_0x3bcb5d=[_0x28155e['body'][_0x2b53b0(0x152)]],_0x184822=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x141)]],_0x3240df=[_0x28155e['body'][_0x2b53b0(0x122)]],_0x4855ff=[_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0xe9)]],_0x10266c=[_0x28155e['body'][_0x2b53b0(0x1b4)]],_0x24cfbd=[_0x28155e['body'][_0x2b53b0(0x1bf)]],_0x5b11b6=[_0x28155e['body'][_0x2b53b0(0x132)]];else var _0x58ab82=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x10f)]],_0x3e9f99=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x13b)]],_0x2cb9d6=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x12a)]],_0x451ec6=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x103)]],_0x83aa81=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0xba)]],_0x34fbe8=[..._0x28155e[_0x2b53b0(0x130)]['prod_level']],_0x31a59d=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x174)]],_0x21aaee=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x17a)]],_0x2a6ed0=[..._0x28155e[_0x2b53b0(0x130)]['primary_code']],_0x3bcb5d=[..._0x28155e[_0x2b53b0(0x130)]['secondary_code']],_0x184822=[..._0x28155e[_0x2b53b0(0x130)]['MaxStocks_data']],_0x3240df=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x122)]],_0x4855ff=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0xe9)]],_0x10266c=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x1b4)]],_0x24cfbd=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x1bf)]],_0x5b11b6=[..._0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x132)]];const _0x1b287b=_0x58ab82['map'](_0x38f6f8=>{return _0x38f6f8={'product_name':_0x38f6f8};});_0x3e9f99[_0x2b53b0(0x14f)]((_0x1c8038,_0x14aebb)=>{var _0x1b3bf5=_0x2b53b0;_0x1b287b[_0x14aebb][_0x1b3bf5(0xb9)]=_0x1c8038;}),_0x2cb9d6[_0x2b53b0(0x14f)]((_0x1ac8ac,_0x51b917)=>{var _0x2fb74a=_0x2b53b0;_0x1b287b[_0x51b917][_0x2fb74a(0x12f)]=_0x1ac8ac;}),_0x451ec6[_0x2b53b0(0x14f)]((_0x505d39,_0x3c4c07)=>{var _0x45802c=_0x2b53b0;_0x1b287b[_0x3c4c07][_0x45802c(0x131)]=_0x505d39;}),_0x83aa81[_0x2b53b0(0x14f)]((_0x51c9ce,_0x2a42ba)=>{var _0x2a8b44=_0x2b53b0;_0x1b287b[_0x2a42ba][_0x2a8b44(0x1b9)]=_0x51c9ce;}),_0x34fbe8['forEach']((_0x3d93a9,_0x290034)=>{var _0x5d5f54=_0x2b53b0;_0x1b287b[_0x290034][_0x5d5f54(0x163)]=_0x3d93a9;}),_0x31a59d['forEach']((_0x5cf08b,_0xe77e68)=>{_0x1b287b[_0xe77e68]['bin']=_0x5cf08b;}),_0x21aaee[_0x2b53b0(0x14f)]((_0xbc7798,_0x58a23d)=>{var _0x508baa=_0x2b53b0;_0x1b287b[_0x58a23d][_0x508baa(0xc9)]=_0xbc7798;}),_0x2a6ed0[_0x2b53b0(0x14f)]((_0x5e1024,_0x197e39)=>{var _0x3f31ba=_0x2b53b0;_0x1b287b[_0x197e39][_0x3f31ba(0xcd)]=_0x5e1024;}),_0x3bcb5d[_0x2b53b0(0x14f)]((_0x95d017,_0x4552a0)=>{var _0x33111a=_0x2b53b0;_0x1b287b[_0x4552a0][_0x33111a(0x152)]=_0x95d017;}),_0x184822['forEach']((_0x364212,_0x4a3f66)=>{var _0x382e92=_0x2b53b0;_0x1b287b[_0x4a3f66][_0x382e92(0xef)]=_0x364212;}),_0x3240df[_0x2b53b0(0x14f)]((_0x536822,_0x3ed3c2)=>{var _0x402ba7=_0x2b53b0;_0x1b287b[_0x3ed3c2][_0x402ba7(0x122)]=_0x536822;}),_0x4855ff['forEach']((_0x36c218,_0x394632)=>{_0x1b287b[_0x394632]['expiry_date']=_0x36c218;}),_0x5b11b6[_0x2b53b0(0x14f)]((_0x959b19,_0x326bcd)=>{var _0x3e396a=_0x2b53b0;_0x1b287b[_0x326bcd][_0x3e396a(0x132)]=_0x959b19;}),_0x10266c[_0x2b53b0(0x14f)]((_0x207768,_0x4ab6c4)=>{var _0x13b242=_0x2b53b0;_0x1b287b[_0x4ab6c4][_0x13b242(0x1b4)]=_0x207768;}),_0x24cfbd[_0x2b53b0(0x14f)]((_0x330657,_0xa465b4)=>{var _0x33d91c=_0x2b53b0;_0x1b287b[_0xa465b4][_0x33d91c(0xee)]=_0x330657;});const _0x504b7b=_0x1b287b[_0x2b53b0(0xdf)](_0x13ad92=>_0x13ad92[_0x2b53b0(0x12f)]!=='0'&&_0x13ad92[_0x2b53b0(0x12f)]!=='');_0x4a9c4d[_0x2b53b0(0x118)]=_0x362f26,_0x4a9c4d[_0x2b53b0(0x10b)]=_0x115a76,_0x4a9c4d['date']=_0x11211d,_0x4a9c4d[_0x2b53b0(0xaa)]=_0x30c23a,_0x4a9c4d['product']=_0x504b7b,_0x4a9c4d[_0x2b53b0(0x1a2)]=_0x311161,_0x4a9c4d[_0x2b53b0(0xcc)]=_0x36f6a0,_0x4a9c4d[_0x2b53b0(0xc7)]=_0x4899df,_0x4a9c4d['room']=_0x3570fb,_0x4a9c4d[_0x2b53b0(0x14c)]=_0x34c09c,_0x4a9c4d[_0x2b53b0(0x15f)]=_0x19c1c2;const _0x3e158f=await _0x4a9c4d[_0x2b53b0(0x10c)](),_0x460275=await warehouse[_0x2b53b0(0xc6)]({'name':_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0xaa)],'room':_0x28155e[_0x2b53b0(0x130)]['Room_name']});_0x4a9c4d[_0x2b53b0(0xc0)][_0x2b53b0(0x14f)](_0x20b7ed=>{var _0x46b349=_0x2b53b0,_0x1770ed=0x0;const _0x17da2f=_0x460275[_0x46b349(0x1ab)]['map'](_0x2f100b=>{var _0x154a50=_0x46b349;_0x2f100b[_0x154a50(0x181)]==_0x20b7ed[_0x154a50(0x181)]&&_0x2f100b[_0x154a50(0xc9)]==_0x20b7ed[_0x154a50(0xc9)]&&_0x2f100b[_0x154a50(0x132)]==_0x20b7ed[_0x154a50(0x132)]&&_0x2f100b['bin']==_0x20b7ed[_0x154a50(0x1ba)]&&_0x2f100b[_0x154a50(0x163)]==_0x20b7ed[_0x154a50(0x163)]&&_0x2f100b[_0x154a50(0xee)]==_0x20b7ed[_0x154a50(0xee)]&&_0x2f100b[_0x154a50(0x1b4)]==_0x20b7ed['storage']&&(_0x2f100b[_0x154a50(0xd3)]=parseInt(_0x2f100b[_0x154a50(0xd3)])+parseInt(_0x20b7ed['quantity']),_0x1770ed++);});_0x1770ed=='0'&&(_0x460275['product_details']=_0x460275[_0x46b349(0x1ab)][_0x46b349(0x1a9)]({'product_name':_0x20b7ed[_0x46b349(0x181)],'product_stock':_0x20b7ed['quantity'],'primary_code':_0x20b7ed[_0x46b349(0xcd)],'secondary_code':_0x20b7ed[_0x46b349(0x152)],'product_code':_0x20b7ed[_0x46b349(0xb9)],'storage':_0x20b7ed[_0x46b349(0x1b4)],'rack':_0x20b7ed['rack'],'bay':_0x20b7ed['bay'],'bin':_0x20b7ed['bin'],'type':_0x20b7ed['type'],'floorlevel':_0x20b7ed['floorlevel'],'maxProducts':_0x20b7ed[_0x46b349(0xef)],'unit':_0x20b7ed[_0x46b349(0x131)],'secondary_unit':_0x20b7ed[_0x46b349(0x1b9)],'expiry_date':_0x20b7ed[_0x46b349(0xe9)]}));}),await _0x460275['save']();const _0xa73d66=await s_payment_data[_0x2b53b0(0xc6)]({'invoice':_0x28155e[_0x2b53b0(0x130)][_0x2b53b0(0x118)]});if(_0xa73d66===null){}else console['log']('suppliers',_0xa73d66,_0x28155e['body']['invoice']),_0xa73d66[_0x2b53b0(0x10b)]=_0x28155e['body'][_0x2b53b0(0x10b)],await _0xa73d66[_0x2b53b0(0x10c)]();_0x28155e[_0x2b53b0(0x1c3)](_0x2b53b0(0x161),_0x2b53b0(0x172)),_0x59214d[_0x2b53b0(0x143)](_0x2b53b0(0xd9));}catch(_0x1a2838){console[_0x2b53b0(0x1c0)](_0x1a2838);}}),router[a0_0x463ef1(0xde)](a0_0x463ef1(0x147),auth,async(_0x101c8d,_0x4617ed)=>{var _0xf933cd=a0_0x463ef1;try{const _0x22d909=_0x101c8d['params']['id'],{invoice:_0x1c45c1,suppliers:_0x2f6c9d,payable:_0x3c369f,due_amount:_0x278d68}=_0x101c8d[_0xf933cd(0x130)],_0xb74b6d=await purchases[_0xf933cd(0xf4)](_0x22d909);var _0x27883d=_0x3c369f-_0x278d68;_0xb74b6d['paid_amount']=parseFloat(_0xb74b6d[_0xf933cd(0xcc)])+parseFloat(_0x278d68),_0xb74b6d[_0xf933cd(0xc7)]=_0x27883d;const _0x1811ee=await _0xb74b6d[_0xf933cd(0x10c)]();console[_0xf933cd(0x1c0)](_0x1811ee);const _0x59be6c=await s_payment_data[_0xf933cd(0xc6)]({'invoice':_0x1c45c1});_0x59be6c[_0xf933cd(0x1c2)]=_0x27883d,await _0x59be6c[_0xf933cd(0x10c)]();let _0x5260d2=new Date(),_0x50fa5e=('0'+_0x5260d2['getDate']())[_0xf933cd(0x187)](-0x2),_0x2b2eab=('0'+(_0x5260d2[_0xf933cd(0xad)]()+0x1))[_0xf933cd(0x187)](-0x2),_0x5878ac=_0x5260d2['getFullYear'](),_0x2a7c4f=_0x5878ac+'-'+_0x2b2eab+'-'+_0x50fa5e;const _0x37b51f=new suppliers_payment({'invoice':_0x1c45c1,'date':_0x5878ac+'-'+_0x2b2eab+'-'+_0x50fa5e,'suppliers':_0x2f6c9d,'reason':_0xf933cd(0xbb),'amount':_0x278d68}),_0x4ffcc4=await _0x37b51f[_0xf933cd(0x10c)]();_0x101c8d[_0xf933cd(0x1c3)](_0xf933cd(0x161),'payment\x20successfull'),_0x4617ed['redirect'](_0xf933cd(0xd9));}catch(_0xe73ca0){console[_0xf933cd(0x1c0)](_0xe73ca0);}}),router[a0_0x463ef1(0x16c)](a0_0x463ef1(0x11a),auth,async(_0xfb48c5,_0x105350)=>{var _0xd310ae=a0_0x463ef1;try{const {username:_0x3a42df,email:_0x3345d9,role:_0x129c87}=_0xfb48c5[_0xd310ae(0xb3)],_0x5f1eda=_0xfb48c5['user'],_0x3ca693=await profile['findOne']({'email':_0x5f1eda[_0xd310ae(0x15b)]}),_0x98b09c=await master_shop[_0xd310ae(0x19d)]();console[_0xd310ae(0x1c0)](_0xd310ae(0x13e),_0x98b09c);const _0x45d307=_0xfb48c5[_0xd310ae(0x18f)]['id'],_0x266fef=await purchases[_0xd310ae(0xf4)](_0x45d307);console[_0xd310ae(0x1c0)](_0x266fef);const _0x1aabf5=await suppliers[_0xd310ae(0xc6)]({'name':_0x266fef[_0xd310ae(0x10b)]});console[_0xd310ae(0x1c0)](_0x1aabf5);if(_0x98b09c[0x0]['language']==_0xd310ae(0x178)){var _0x58a899=users[_0xd310ae(0xb2)];console[_0xd310ae(0x1c0)](_0x58a899);}else{if(_0x98b09c[0x0][_0xd310ae(0x149)]==_0xd310ae(0x190))var _0x58a899=users[_0xd310ae(0x190)];else{if(_0x98b09c[0x0][_0xd310ae(0x149)]=='German')var _0x58a899=users[_0xd310ae(0x169)];else{if(_0x98b09c[0x0][_0xd310ae(0x149)]==_0xd310ae(0x111))var _0x58a899=users[_0xd310ae(0x111)];else{if(_0x98b09c[0x0][_0xd310ae(0x149)]==_0xd310ae(0x16b))var _0x58a899=users[_0xd310ae(0x16b)];else{if(_0x98b09c[0x0]['language']==_0xd310ae(0x164))var _0x58a899=users['Portuguese'];else{if(_0x98b09c[0x0][_0xd310ae(0x149)]==_0xd310ae(0xf9))var _0x58a899=users[_0xd310ae(0xf9)];else{if(_0x98b09c[0x0][_0xd310ae(0x149)]==_0xd310ae(0x126))var _0x58a899=users[_0xd310ae(0x121)];}}}}}}}_0x105350['render'](_0xd310ae(0x183),{'success':_0xfb48c5[_0xd310ae(0x1c3)]('success'),'errors':_0xfb48c5[_0xd310ae(0x1c3)](_0xd310ae(0x179)),'role':_0x5f1eda,'profile':_0x3ca693,'master_shop':_0x98b09c,'supplier':_0x1aabf5,'purchase':_0x266fef,'language':_0x58a899});}catch(_0x790399){console[_0xd310ae(0x1c0)](_0x790399);}}),router[a0_0x463ef1(0x16c)]('/view/return_purchase/:id',auth,async(_0x37e3e3,_0x518e17)=>{var _0x592622=a0_0x463ef1;try{const {username:_0x2f32bd,email:_0x1d6e19,role:_0x5352df}=_0x37e3e3[_0x592622(0xb3)],_0x29906b=_0x37e3e3[_0x592622(0xb3)],_0x42ca31=await profile['findOne']({'email':_0x29906b['email']}),_0x52e777=await master_shop['find']();console['log'](_0x592622(0x13e),_0x52e777);const _0x4890d0=_0x37e3e3[_0x592622(0x18f)]['id'];console[_0x592622(0x1c0)](_0x4890d0);const _0x44a31f=await purchases['findById'](_0x4890d0);console[_0x592622(0x1c0)]('user_id',_0x44a31f);const _0x5bf69b=await product[_0x592622(0x19d)]({}),_0x310615=await warehouse['aggregate']([{'$match':{'name':_0x44a31f[_0x592622(0xaa)],'room':_0x44a31f['room'],'warehouse_category':_0x592622(0x194)}},{'$unwind':_0x592622(0x16e)},{'$group':{'_id':_0x592622(0xdb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x592622(0x12e)},'bay':{'$first':_0x592622(0xb7)},'bin':{'$first':_0x592622(0x144)},'type':{'$first':_0x592622(0x166)},'floorlevel':{'$first':_0x592622(0x19b)},'primary_code':{'$first':_0x592622(0xa7)},'secondary_code':{'$first':_0x592622(0xda)},'product_code':{'$first':_0x592622(0x14e)},'storage':{'$first':_0x592622(0x19e)},'rack':{'$first':_0x592622(0xf8)}}}]);warehouse_data=await warehouse[_0x592622(0x175)]([{'$match':{'status':_0x592622(0xcf),'name':_0x592622(0x196),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x592622(0xd7),'name':{'$first':_0x592622(0xd7)}}},{'$sort':{'name':0x1}}]),console[_0x592622(0x1c0)](_0x592622(0x10a),_0x310615);if(_0x52e777[0x0][_0x592622(0x149)]=='English\x20(US)'){var _0x35c53a=users['English'];console['log'](_0x35c53a);}else{if(_0x52e777[0x0][_0x592622(0x149)]==_0x592622(0x190))var _0x35c53a=users[_0x592622(0x190)];else{if(_0x52e777[0x0]['language']==_0x592622(0x169))var _0x35c53a=users['German'];else{if(_0x52e777[0x0][_0x592622(0x149)]==_0x592622(0x111))var _0x35c53a=users[_0x592622(0x111)];else{if(_0x52e777[0x0][_0x592622(0x149)]==_0x592622(0x16b))var _0x35c53a=users[_0x592622(0x16b)];else{if(_0x52e777[0x0]['language']==_0x592622(0x164))var _0x35c53a=users[_0x592622(0x1a0)];else{if(_0x52e777[0x0][_0x592622(0x149)]==_0x592622(0xf9))var _0x35c53a=users['Chinese'];else{if(_0x52e777[0x0][_0x592622(0x149)]=='Arabic\x20(ae)')var _0x35c53a=users[_0x592622(0x121)];}}}}}}}_0x518e17['render']('return_purchase',{'success':_0x37e3e3[_0x592622(0x1c3)](_0x592622(0x161)),'errors':_0x37e3e3[_0x592622(0x1c3)](_0x592622(0x179)),'role':_0x29906b,'profile':_0x42ca31,'user':_0x44a31f,'stock':_0x310615,'master_shop':_0x52e777,'product':_0x5bf69b,'language':_0x35c53a,'warehouse':warehouse_data});}catch(_0x1ba5f8){console['log'](_0x1ba5f8);}}),router[a0_0x463ef1(0xde)](a0_0x463ef1(0x159),auth,async(_0x934b83,_0x534c75)=>{var _0x38e67a=a0_0x463ef1;try{const {invoice:_0x1d7890,date:_0x560aef,warehouse_name:_0x1f0f17,Room_name:_0x12fa78,product_name:_0x5d012d,purchase_quantity:_0x73f54e,stocks:_0x163efd,return_qty:_0x36a75,note:_0x4573e5,level:_0x33b66e,isle:_0x182e6b,pallet:_0x44f423,to_warehouse_name:_0x474965,to_Room_name:_0xdc1c44}=_0x934b83[_0x38e67a(0x130)],_0x4dfd0d=await purchases[_0x38e67a(0xc6)]({'_id':_0x934b83[_0x38e67a(0x18f)]['id']}),_0x561c86=await warehouse[_0x38e67a(0xc6)]({'name':_0x1f0f17,'room':_0x12fa78});if(typeof _0x5d012d=='string')var _0x6bf081=[_0x934b83[_0x38e67a(0x130)]['product_name']],_0x5a4d77=[_0x934b83[_0x38e67a(0x130)][_0x38e67a(0xff)]],_0x1741af=[_0x934b83[_0x38e67a(0x130)][_0x38e67a(0x120)]],_0xb4fd83=[_0x934b83[_0x38e67a(0x130)][_0x38e67a(0xf7)]],_0x2a4d2b=[_0x934b83[_0x38e67a(0x130)][_0x38e67a(0x12c)]],_0x2d85b8=[_0x934b83[_0x38e67a(0x130)]['isle']],_0x9b2fed=[_0x934b83['body'][_0x38e67a(0x17c)]],_0x13f496=[_0x934b83[_0x38e67a(0x130)]['types']],_0x590e6f=[_0x934b83[_0x38e67a(0x130)][_0x38e67a(0x14b)]],_0x5120e1=[_0x934b83[_0x38e67a(0x130)][_0x38e67a(0x17f)]],_0x3dd519=[_0x934b83['body']['secondary_code_hide']];else var _0x6bf081=[..._0x934b83[_0x38e67a(0x130)][_0x38e67a(0x181)]],_0x5a4d77=[..._0x934b83['body'][_0x38e67a(0xff)]],_0x1741af=[..._0x934b83[_0x38e67a(0x130)]['stocks']],_0xb4fd83=[..._0x934b83[_0x38e67a(0x130)][_0x38e67a(0xf7)]],_0x2a4d2b=[..._0x934b83[_0x38e67a(0x130)][_0x38e67a(0x12c)]],_0x2d85b8=[..._0x934b83['body']['isle']],_0x9b2fed=[..._0x934b83[_0x38e67a(0x130)][_0x38e67a(0x17c)]],_0x13f496=[..._0x934b83[_0x38e67a(0x130)][_0x38e67a(0x185)]],_0x590e6f=[..._0x934b83[_0x38e67a(0x130)]['product_code_hide']],_0x5120e1=[..._0x934b83[_0x38e67a(0x130)]['primary_code_hide']],_0x3dd519=[..._0x934b83[_0x38e67a(0x130)][_0x38e67a(0xbf)]];const _0x425a23=_0x6bf081[_0x38e67a(0x155)](_0x3e984e=>{return _0x3e984e={'product_name':_0x3e984e};});_0x5a4d77['forEach']((_0x1de2bf,_0x46f6a3)=>{var _0x1f5590=_0x38e67a;_0x425a23[_0x46f6a3][_0x1f5590(0xff)]=_0x1de2bf;}),_0x1741af['forEach']((_0x4f368c,_0x483302)=>{var _0x2e1743=_0x38e67a;_0x425a23[_0x483302][_0x2e1743(0x102)]=_0x4f368c;}),_0xb4fd83[_0x38e67a(0x14f)]((_0x8b85e4,_0x527809)=>{var _0x283ad1=_0x38e67a;_0x425a23[_0x527809][_0x283ad1(0xf7)]=_0x8b85e4;}),_0x2a4d2b[_0x38e67a(0x14f)]((_0x1a7f01,_0x4c71bf)=>{var _0x439d41=_0x38e67a;_0x425a23[_0x4c71bf][_0x439d41(0x163)]=_0x1a7f01;}),_0x2d85b8[_0x38e67a(0x14f)]((_0x582a26,_0x1a1871)=>{var _0x1a61c9=_0x38e67a;_0x425a23[_0x1a1871][_0x1a61c9(0x1ba)]=_0x582a26;}),_0x9b2fed['forEach']((_0xf20228,_0x522636)=>{var _0x65e5e2=_0x38e67a;_0x425a23[_0x522636][_0x65e5e2(0xc9)]=_0xf20228;}),_0x13f496[_0x38e67a(0x14f)]((_0x8cf327,_0x2e25b9)=>{var _0x2c8a5a=_0x38e67a;_0x425a23[_0x2e25b9][_0x2c8a5a(0x132)]=_0x8cf327;}),_0x590e6f[_0x38e67a(0x14f)]((_0x15ef4b,_0x11ca05)=>{var _0x53e5fd=_0x38e67a;_0x425a23[_0x11ca05][_0x53e5fd(0xb9)]=_0x15ef4b;}),_0x5120e1[_0x38e67a(0x14f)]((_0x12e023,_0x4d69ee)=>{var _0x2e8075=_0x38e67a;_0x425a23[_0x4d69ee][_0x2e8075(0xcd)]=_0x12e023;}),_0x3dd519[_0x38e67a(0x14f)]((_0x370d65,_0x2b0642)=>{_0x425a23[_0x2b0642]['secondary_code']=_0x370d65;}),_0x4dfd0d[_0x38e67a(0xc0)][_0x38e67a(0x14f)](_0x5a268f=>{var _0x52be3c=_0x38e67a;const _0x17e3b5=_0x561c86[_0x52be3c(0x1ab)][_0x52be3c(0x155)](_0xd03cf6=>{var _0x5c6be4=_0x52be3c;_0xd03cf6[_0x5c6be4(0x181)]==_0x5a268f[_0x5c6be4(0x181)]&&_0xd03cf6['floorlevel']==_0x5a268f[_0x5c6be4(0xc9)]&&_0xd03cf6[_0x5c6be4(0x132)]==_0x5a268f[_0x5c6be4(0x132)]&&_0xd03cf6[_0x5c6be4(0x1ba)]==_0x5a268f[_0x5c6be4(0x1ba)]&&_0xd03cf6[_0x5c6be4(0x163)]==_0x5a268f[_0x5c6be4(0x163)]&&_0xd03cf6[_0x5c6be4(0xee)]==_0x5a268f['rack']&&_0xd03cf6['storage']==_0x5a268f[_0x5c6be4(0x1b4)]&&(console[_0x5c6be4(0x1c0)](parseInt(_0xd03cf6[_0x5c6be4(0xd3)])+_0x5c6be4(0x16a)+parseInt(_0x5a268f[_0x5c6be4(0x12f)])),_0xd03cf6[_0x5c6be4(0xd3)]=parseInt(_0xd03cf6[_0x5c6be4(0xd3)])+parseInt(_0x5a268f[_0x5c6be4(0x12f)]));});}),await _0x561c86[_0x38e67a(0x10c)]();const _0x1eb8a2=_0x425a23[_0x38e67a(0xdf)](_0x5f2e7=>_0x5f2e7[_0x38e67a(0xf7)]!=='0'&&_0x5f2e7['return_qty']!=='');var _0x1dc182=0x0;_0x1eb8a2['forEach'](_0x1fe981=>{var _0x40fa95=_0x38e67a;console[_0x40fa95(0x1c0)](_0x40fa95(0x18e),_0x1fe981),(parseInt(_0x1fe981[_0x40fa95(0xff)])<parseInt(_0x1fe981[_0x40fa95(0xf7)])||parseInt(_0x1fe981['stock_quantity'])<parseInt(_0x1fe981[_0x40fa95(0xf7)]))&&_0x1dc182++;});if(_0x1dc182!=0x0)return _0x934b83[_0x38e67a(0x1c3)](_0x38e67a(0x179),_0x38e67a(0x14a)),_0x534c75[_0x38e67a(0x143)](_0x38e67a(0x15e));const _0x3bf5ea=new purchases_return({'invoice':_0x1d7890,'suppliers':_0x934b83['body'][_0x38e67a(0x10b)],'date':_0x560aef,'warehouse_name':_0x1f0f17,'return_product':_0x1eb8a2,'note':_0x4573e5,'room':_0x12fa78,'to_warehouse_name':_0x474965,'to_room':_0xdc1c44}),_0x197367=await _0x3bf5ea['save']();console[_0x38e67a(0x1c0)](_0x3bf5ea);const _0x36dec8=await purchases_return['findOne']({'invoice':_0x1d7890}),_0x3c1ecc=await warehouse[_0x38e67a(0xc6)]({'name':_0x474965,'room':_0xdc1c44});_0x36dec8[_0x38e67a(0x151)]['forEach'](_0x45f98a=>{var _0x1c01db=_0x38e67a,_0x3822ef=0x0;const _0x38799a=_0x3c1ecc[_0x1c01db(0x1ab)][_0x1c01db(0x155)](_0x4f171c=>{var _0x35a48d=_0x1c01db;_0x4f171c[_0x35a48d(0x181)]==_0x45f98a['product_name']&&_0x4f171c[_0x35a48d(0xc9)]==_0x45f98a['floorlevel']&&_0x4f171c[_0x35a48d(0x132)]==_0x45f98a[_0x35a48d(0x132)]&&_0x4f171c[_0x35a48d(0x1ba)]==_0x45f98a[_0x35a48d(0x1ba)]&&_0x4f171c['bay']==_0x45f98a['bay']&&(_0x4f171c[_0x35a48d(0xd3)]=parseInt(_0x4f171c[_0x35a48d(0xd3)])-parseInt(_0x45f98a[_0x35a48d(0xf7)]),_0x3822ef++);});_0x3822ef=='0'&&(_0x3c1ecc['product_details']=_0x3c1ecc['product_details'][_0x1c01db(0x1a9)]({'product_name':_0x45f98a[_0x1c01db(0x181)],'product_stock':_0x45f98a[_0x1c01db(0xf7)],'primary_code':_0x45f98a[_0x1c01db(0xcd)],'secondary_code':_0x45f98a[_0x1c01db(0x152)],'product_code':_0x45f98a[_0x1c01db(0xb9)],'storage':_0x45f98a[_0x1c01db(0x1b4)],'rack':_0x45f98a[_0x1c01db(0xee)],'bay':_0x45f98a['bay'],'bin':_0x45f98a[_0x1c01db(0x1ba)],'type':_0x45f98a[_0x1c01db(0x132)],'floorlevel':_0x45f98a[_0x1c01db(0xc9)],'maxProducts':_0x45f98a[_0x1c01db(0xef)],'unit':_0x45f98a[_0x1c01db(0x131)],'secondary_unit':_0x45f98a[_0x1c01db(0x1b9)],'expiry_date':_0x45f98a[_0x1c01db(0xe9)]}));}),await _0x3c1ecc[_0x38e67a(0x10c)]();const _0x1bd10c=await purchases['findOne']({'invoice':_0x1d7890});_0x1bd10c[_0x38e67a(0x117)]=_0x38e67a(0x13a);const _0x115cf1=await _0x1bd10c['save'](),_0x5dfbe4=new s_payment_data({'invoice':_0x1d7890,'suppliers':_0x934b83['body']['suppliers'],'reason':_0x38e67a(0x153)});await _0x5dfbe4[_0x38e67a(0x10c)]();const _0x3bdd56=await master_shop['find']();console['log']('add\x20post',_0x3bdd56[0x0][_0x38e67a(0x184)]);const _0x15627c=await email_settings[_0x38e67a(0xc6)](),_0x2ae0ee=await suppliers[_0x38e67a(0xc6)]({'name':_0x934b83[_0x38e67a(0x130)][_0x38e67a(0x10b)]});console[_0x38e67a(0x1c0)](_0x38e67a(0x129),_0x2ae0ee);_0x3bdd56[0x0]['currency_placement']==0x1?(right_currency=_0x3bdd56[0x0][_0x38e67a(0x188)],left_currency=''):(right_currency='',left_currency=_0x3bdd56[0x0][_0x38e67a(0x188)]);var _0x1f5f2e=_0x6bf081,_0x3dff68=_0xb4fd83,_0x1c5337='',_0x1a5ca5;for(_0x1a5ca5 in _0x1f5f2e){_0x1c5337+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f5f2e[_0x1a5ca5]+'</td>'+_0x38e67a(0xdc)+_0x3dff68[_0x1a5ca5]+_0x38e67a(0xe0)+_0x38e67a(0x19f);}console['log']('product_list',_0x1c5337);let _0x46ff9c=nodemailer[_0x38e67a(0x18b)]({'service':_0x38e67a(0x1ac),'auth':{'user':_0x15627c[_0x38e67a(0x15b)],'pass':_0x15627c[_0x38e67a(0x146)]}}),_0x5603a8={'from':_0x15627c['email'],'to':_0x2ae0ee[_0x38e67a(0x15b)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x38e67a(0x1a5),'path':__dirname+_0x38e67a(0x110)+_0x38e67a(0x1bd)+_0x3bdd56[0x0]['image'],'cid':'logo'}],'html':_0x38e67a(0x11f)+_0x38e67a(0xdd)+_0x38e67a(0xeb)+_0x38e67a(0xa8)+_0x38e67a(0xa9)+_0x38e67a(0xa8)+_0x38e67a(0x1a1)+_0x38e67a(0x11b)+_0x38e67a(0xa8)+_0x38e67a(0xe8)+_0x3bdd56[0x0][_0x38e67a(0xfe)]+_0x38e67a(0x1b6)+_0x38e67a(0x11b)+_0x38e67a(0x11b)+_0x38e67a(0x1be)+'<div>'+_0x38e67a(0x100)+_0x38e67a(0x145)+_0x1d7890+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x38e67a(0x119)+_0x560aef+'\x20'+_0x38e67a(0x124)+_0x38e67a(0x19a)+_0x38e67a(0x11b)+_0x38e67a(0x1b5)+_0x38e67a(0x1b0)+_0x38e67a(0xc2)+_0x38e67a(0xe6)+_0x38e67a(0x195)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x38e67a(0x177)+_0x38e67a(0x19f)+_0x38e67a(0x138)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1c5337+'\x20'+'</tbody>'+_0x38e67a(0x12b)+_0x38e67a(0xa8)+_0x38e67a(0x1c6)+_0x38e67a(0xac)+_0x3bdd56[0x0]['site_title']+_0x38e67a(0x19a)+_0x38e67a(0x11b)+_0x38e67a(0x11b)+_0x38e67a(0x1b8)};_0x46ff9c[_0x38e67a(0x197)](_0x5603a8,function(_0x55fe09,_0x11e1f2){var _0xe9a6e0=_0x38e67a;_0x55fe09?(console[_0xe9a6e0(0x1c0)](_0x55fe09),console[_0xe9a6e0(0x1c0)](_0xe9a6e0(0xf1))):console['log']('Email\x20sent\x20successfully');}),_0x934b83[_0x38e67a(0x1c3)](_0x38e67a(0x161),'purchases\x20item\x20return\x20successfull'),_0x534c75[_0x38e67a(0x143)](_0x38e67a(0xd9));}catch(_0x13a891){console[_0x38e67a(0x1c0)](_0x13a891),_0x534c75[_0x38e67a(0x116)](0xc8)[_0x38e67a(0x1af)]({'message':_0x13a891[_0x38e67a(0x13d)]});}}),router[a0_0x463ef1(0x16c)]('/barcode/:id',auth,async(_0x393d4b,_0x4977e4)=>{var _0x2dd16c=a0_0x463ef1;try{const {username:_0x125f7d,email:_0x1856f1,role:_0x4f5480}=_0x393d4b[_0x2dd16c(0xb3)],_0x29e24a=_0x393d4b[_0x2dd16c(0xb3)],_0x3d9beb=await profile['findOne']({'email':_0x29e24a[_0x2dd16c(0x15b)]}),_0x2e249c=await master_shop[_0x2dd16c(0x19d)](),_0x12c6a1=_0x393d4b['params']['id'],_0x1a96a3=await purchases[_0x2dd16c(0xf4)](_0x12c6a1);if(_0x2e249c[0x0]['language']==_0x2dd16c(0x178))var _0x197848=users[_0x2dd16c(0xb2)];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]==_0x2dd16c(0x190))var _0x197848=users[_0x2dd16c(0x190)];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]==_0x2dd16c(0x169))var _0x197848=users[_0x2dd16c(0x169)];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]=='Spanish')var _0x197848=users['Spanish'];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]==_0x2dd16c(0x16b))var _0x197848=users[_0x2dd16c(0x16b)];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]==_0x2dd16c(0x164))var _0x197848=users[_0x2dd16c(0x1a0)];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]==_0x2dd16c(0xf9))var _0x197848=users['Chinese'];else{if(_0x2e249c[0x0][_0x2dd16c(0x149)]==_0x2dd16c(0x126))var _0x197848=users[_0x2dd16c(0x121)];}}}}}}}_0x4977e4[_0x2dd16c(0xe3)](_0x2dd16c(0x17b),{'success':_0x393d4b[_0x2dd16c(0x1c3)]('success'),'errors':_0x393d4b[_0x2dd16c(0x1c3)](_0x2dd16c(0x179)),'role':_0x29e24a,'profile':_0x3d9beb,'alldata':_0x1a96a3,'master_shop':_0x2e249c,'language':_0x197848}),console[_0x2dd16c(0x1c0)](alldata);}catch(_0x4e3ba3){console[_0x2dd16c(0x1c0)](_0x4e3ba3);}}),router[a0_0x463ef1(0xde)](a0_0x463ef1(0x140),async(_0x224eae,_0x5843ad)=>{var _0x5c112b=a0_0x463ef1;const {product_code:_0x1b4123}=_0x224eae[_0x5c112b(0x130)];var _0x124b1b;const _0x8c6d26=await product[_0x5c112b(0x175)]([{'$match':{'primary_code':_0x1b4123,'product_category':_0x5c112b(0x194)}},{'$group':{'_id':'$_id','name':{'$first':_0x5c112b(0xd7)},'category':{'$first':_0x5c112b(0xf3)},'brand':{'$first':_0x5c112b(0x198)},'unit':{'$first':_0x5c112b(0xfc)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5c112b(0x1a3)},'primary_code':{'$first':_0x5c112b(0x15d)},'secondary_code':{'$first':_0x5c112b(0x105)},'maxStocks':{'$first':_0x5c112b(0x1b3)},'maxProdPerUnit':{'$first':_0x5c112b(0x136)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5c112b(0xc3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2db635=await product[_0x5c112b(0x175)]([{'$match':{'secondary_code':_0x1b4123,'product_category':_0x5c112b(0x194)}},{'$group':{'_id':'$_id','name':{'$first':_0x5c112b(0xd7)},'category':{'$first':'$category'},'brand':{'$first':_0x5c112b(0x198)},'unit':{'$first':_0x5c112b(0xfc)},'alertquantity':{'$first':_0x5c112b(0x1b1)},'product_code':{'$first':_0x5c112b(0x1a3)},'primary_code':{'$first':_0x5c112b(0x15d)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x5c112b(0x1b3)},'maxProdPerUnit':{'$first':_0x5c112b(0x136)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5c112b(0xc3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x8c6d26[_0x5c112b(0xf0)]>0x0)_0x124b1b=_0x8c6d26;else _0x2db635['length']>0x0&&(_0x124b1b=_0x2db635);_0x5843ad[_0x5c112b(0x1af)](_0x124b1b);}),router[a0_0x463ef1(0xde)](a0_0x463ef1(0x12d),async(_0xabb477,_0x5f80fa)=>{var _0x5bb395=a0_0x463ef1;const {primaryCode:_0x53d387,secondaryCode:_0x1ae5fe,productCode:_0x5d9861,bay:_0x502b00,bin:_0x59877b,types:_0x12253d,pallet:_0x3517a7,warehouses:_0x3b2d31,room:_0x2435e2}=_0xabb477[_0x5bb395(0x130)];console['log'](_0xabb477[_0x5bb395(0x130)]);try{const _0x2b3c5f=await warehouse[_0x5bb395(0x175)]([{'$match':{'name':_0x3b2d31,'room':_0x2435e2}},{'$unwind':_0x5bb395(0x16e)},{'$match':{'product_details.bay':_0x502b00,'product_details.bin':_0x59877b,'product_details.type':_0x12253d}},{'$group':{'_id':_0x5bb395(0xdb),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5bb395(0x12e)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x5bb395(0xae)},'pallet':{'$first':_0x5bb395(0x189)},'maxProducts':{'$first':_0x5bb395(0x123)}}}]);_0x5f80fa['status'](0xc8)['json'](_0x2b3c5f);}catch(_0x2906b0){_0x5f80fa[_0x5bb395(0x116)](0x194)['json']({'message':_0x2906b0['message']});}}),module[a0_0x463ef1(0x15c)]=router;