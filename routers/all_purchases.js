function a0_0x3cde(){var _0x3eb367=['prod_name','<!DOCTYPE\x20html>','toString','aggregate','primary_code_hide','$product_details._id','$product_details.product_code','<h5>','Sales\x20Update\x20successfully','staff','nodemailer','Purchase\x20data\x20added\x20successfully','product_cat','findOne','Logo.png','product_details','secondary_unit','</table>','$product_details.type','prod_level','all','Hindi','125730BrDIyL','floor','419294rzTRSr','get','maxperunit','Floor','max_product_unit','</h5>','Purchase\x20Mail','Raw\x20Materials','payment\x20successfull','primary_code','string','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/../public','French','image','save','/view/add_purchases','prod_Qty','$batch_code','/barcode/:id','/view/return_purchase/:id','stock_quantity','$product_details.level','prod_cat','getMonth','$product_details.bin','Portuguese\x20(BR)','prod_invoice','English\x20(US)','$product','due_amount','15908bCgwvh','expiry_date','find','390894QMdwBZ','catch','Enabled','</head><body>','table\x20page','edit_purchases_view','Portuguese','$alertquantity','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','push','room','../middleware/auth','<h5\x20style=\x22text-align:\x20left;\x22>','date','\x20Order\x20Number\x20:\x20','$suppliers','json','/preview/:id','An\x20error\x20occurred.','Shelves','error','return_purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','user','$secondary_code','Arabic','actual_qty','English','Room_name','$suppliers_docs','Rack\x20E','concat','/give_payment/:id','prod_secondunit','3151868FQZDZE','<tbody\x20style=\x22text-align:\x20center;\x22>','Purchase\x20Return','Receiving\x20Area','$maxStocks','add_purchases','Rack\x20C','\x20</h2>','slice','edit_purchases','secondary_code','$product.type','pallet','$product_details.isle','return_data','storage','forEach','$product_details','$unit','bin','then','here','Router','Level','$product_details.secondary_code','</td>','log','$primary_code','suppliers_data','4797104oXALSj','logo','110fClAAB','delivery_date','True','prod_qty','product_code','<span\x20style=\x22float:\x20right;\x22>','findById','finalize','Chinese','prod_isle','prod_pallet','exports','product','DRY\x20STORAGE','Purchase\x20Return\x20Mail','deliverycode','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','status','$date','</tbody>','filter','role','Ambient','Rack\x20D','delivery_code','$secondary_unit','type','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Return\x20Goods','return_product','<html><head><title></title>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.quantity','stocks','master','Error\x20Occurs','../models/all_models','purchase\x20data\x20update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Rack\x20B','RMSEmail','purchase_quantity','$product_details.floorlevel','/all_purchases/view','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','note','Rack\x20A','product_name','redirect','$_id','stock_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','getDate','gmail','invoice','user_id','\x20<>\x20','\x20Order\x20Date\x20:\x20','$product_details.primary_code','German','</thead>','$product_details.product_name','message','Arabic\x20(ae)','$product.floorlevel','add\x20post','$invoice','<div>','$product.bay','post','20BVQWyn','INC-','</div>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Rack\x20F','Email\x20sent\x20successfully','product_stock','$paid_amount','<tr>','$note','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers','paid_amount','add_purchases\x20error','body','room_name','<strong>\x20Regards\x20</strong>','getFullYear','abs','MaxStocks_data','alertQTY','../public/language/languages.json','warehouse','sendMail','</tr>','rak','deliverydate','7433844FcdzlV','COLD\x20STORAGE','random','flash','633XEEHPr','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','JO_number','params','7WhsTiq','currency','rack','site_title','success','/view/:id','$product_details.rack','bay','$return_data','email','errors','padStart','batch_code','product_code_hide','Spanish','warehouse_name','ejs','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$name','all_purchases','/barcode_scanner','/all_purchases/view/','quantity','<h2>\x20','$product_details.product_stock','level','Paid\x20For\x20Purchase','prod_code','prod_unit','<hr\x20class=\x22my-3\x22>','$maxProdPerUnit','/invoice/:id','$product_details.expiry_date','actual_uom','maxStocks','floorlevel','language','secondary_code_hide','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$warehouse_name','types','$product.bin','render','standard_unit','$category','port','/upload/','</span>','back','password','express','$due_amount','return_qty','</body></html>','POnumber','/view','name','$product.room_name','production_date'];a0_0x3cde=function(){return _0x3eb367;};return a0_0x3cde();}var a0_0x118c6b=a0_0x237b;(function(_0x5a48ac,_0x3502ea){var _0xedc254=a0_0x237b,_0x296dcc=_0x5a48ac();while(!![]){try{var _0x1aac6b=-parseInt(_0xedc254(0x20a))/0x1+parseInt(_0xedc254(0x251))/0x2+parseInt(_0xedc254(0x1b3))/0x3*(-parseInt(_0xedc254(0x22a))/0x4)+-parseInt(_0xedc254(0x193))/0x5*(-parseInt(_0xedc254(0x22d))/0x6)+parseInt(_0xedc254(0x1b7))/0x7*(-parseInt(_0xedc254(0x26e))/0x8)+parseInt(_0xedc254(0x208))/0x9*(parseInt(_0xedc254(0x270))/0xa)+parseInt(_0xedc254(0x1af))/0xb;if(_0x1aac6b===_0x3502ea)break;else _0x296dcc['push'](_0x296dcc['shift']());}catch(_0x532aa4){_0x296dcc['push'](_0x296dcc['shift']());}}}(a0_0x3cde,0xc53f5));const express=require(a0_0x118c6b(0x1e9)),app=express(),router=express[a0_0x118c6b(0x267)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x118c6b(0x170)),auth=require(a0_0x118c6b(0x239)),nodemailer=require(a0_0x118c6b(0x1fc));var ejs=require(a0_0x118c6b(0x1c7));const path=require(a0_0x118c6b(0x215)),users=require(a0_0x118c6b(0x1a9));router['get'](a0_0x118c6b(0x1ee),auth,async(_0x3a0077,_0x29e888)=>{var _0x111a98=a0_0x118c6b;try{const {username:_0x11bad0,email:_0x8bc964,role:_0x1da71a}=_0x3a0077['user'],_0x4e8ef2=_0x3a0077[_0x111a98(0x246)],_0x28bf4a=await profile['findOne']({'email':_0x4e8ef2['email']}),_0x3f2ae7=await staff[_0x111a98(0x1ff)]({'email':_0x4e8ef2[_0x111a98(0x1c0)]});if(_0x4e8ef2[_0x111a98(0x160)]==_0x111a98(0x1fb)){const _0x5c0fe3=await staff[_0x111a98(0x1ff)]({'email':_0x4e8ef2[_0x111a98(0x1c0)]});}const _0xdc7685=await master_shop[_0x111a98(0x22c)]();let _0x2dfd1c;if(_0x4e8ef2['role']==_0x111a98(0x1fb)){const _0x3efcb4=await staff['findOne']({'email':_0x4e8ef2[_0x111a98(0x1c0)]});_0x2dfd1c=await purchases[_0x111a98(0x1f5)]([{'$match':{'warehouse_name':_0x3efcb4[_0x111a98(0x1aa)]}},{'$lookup':{'from':_0x111a98(0x19f),'localField':_0x111a98(0x19f),'foreignField':_0x111a98(0x1ef),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x111a98(0x17e),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x111a98(0x23d)},'date':{'$first':_0x111a98(0x15d)},'warehouse_name':{'$first':_0x111a98(0x1de)},'room':{'$first':'$room'},'product':{'$push':_0x111a98(0x228)},'note':{'$first':_0x111a98(0x19d)},'paid_amount':{'$first':_0x111a98(0x19b)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x111a98(0x21d)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x111a98(0x16c)},'level':{'$addToSet':_0x111a98(0x191)},'isle':{'$addToSet':_0x111a98(0x1e0)},'type':{'$addToSet':_0x111a98(0x25c)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2dfd1c=await purchases[_0x111a98(0x1f5)]([{'$lookup':{'from':'suppliers','localField':_0x111a98(0x19f),'foreignField':_0x111a98(0x1ef),'as':'suppliers_docs'}},{'$unwind':_0x111a98(0x24c)},{'$unwind':_0x111a98(0x228)},{'$group':{'_id':_0x111a98(0x17e),'invoice':{'$first':_0x111a98(0x18f)},'suppliers':{'$first':_0x111a98(0x23d)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x111a98(0x1de)},'room':{'$addToSet':_0x111a98(0x1f0)},'product':{'$push':'$product'},'note':{'$first':_0x111a98(0x19d)},'paid_amount':{'$first':_0x111a98(0x19b)},'due_amount':{'$first':_0x111a98(0x1ea)},'return_data':{'$first':_0x111a98(0x1bf)},'batch_code':{'$first':_0x111a98(0x21d)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x111a98(0x24c)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x111a98(0x191)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x111a98(0x25c)},'floorlevel':{'$addToSet':_0x111a98(0x18d)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xdc7685[0x0][_0x111a98(0x1db)]==_0x111a98(0x227)){var _0x502885=users[_0x111a98(0x24a)];console[_0x111a98(0x26b)](_0x502885);}else{if(_0xdc7685[0x0][_0x111a98(0x1db)]==_0x111a98(0x207))var _0x502885=users[_0x111a98(0x207)];else{if(_0xdc7685[0x0]['language']==_0x111a98(0x188))var _0x502885=users['German'];else{if(_0xdc7685[0x0]['language']==_0x111a98(0x1c5))var _0x502885=users[_0x111a98(0x1c5)];else{if(_0xdc7685[0x0][_0x111a98(0x1db)]=='French')var _0x502885=users[_0x111a98(0x218)];else{if(_0xdc7685[0x0][_0x111a98(0x1db)]=='Portuguese\x20(BR)')var _0x502885=users[_0x111a98(0x233)];else{if(_0xdc7685[0x0]['language']==_0x111a98(0x151))var _0x502885=users['Chinese'];else{if(_0xdc7685[0x0][_0x111a98(0x1db)]==_0x111a98(0x18c))var _0x502885=users[_0x111a98(0x248)];}}}}}}}_0x29e888[_0x111a98(0x1e1)](_0x111a98(0x1ca),{'success':_0x3a0077[_0x111a98(0x1b2)](_0x111a98(0x1bb)),'errors':_0x3a0077['flash'](_0x111a98(0x1c1)),'purchases':_0x2dfd1c,'role':_0x4e8ef2,'profile':_0x28bf4a,'master_shop':_0xdc7685,'language':_0x502885});}catch(_0x3a163d){console[_0x111a98(0x26b)](_0x111a98(0x231),_0x3a163d),_0x29e888['status'](0xc8)[_0x111a98(0x23e)]({'message':_0x3a163d[_0x111a98(0x18b)]});}});function BayBinSelected(_0x3cc75f,_0x3eb8a9){var _0x1eda3d=a0_0x118c6b,_0x3a0d63=[],_0x393fc1=[],_0x2a8451=[],_0x1a42a6=[],_0x1adb78=[],_0x3d3be6=[];let _0x34bf0f=[];if(_0x3cc75f==_0x1eda3d(0x156))switch(_0x3eb8a9){case _0x1eda3d(0x17b):_0x3a0d63=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x393fc1=[0x1,0x2],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=['Level',_0x1eda3d(0x20d)],_0x1adb78=['D'],_0x3d3be6=['A'];break;case _0x1eda3d(0x173):_0x3a0d63=[0x6,0x5,0x4,0x3,0x2,0x1],_0x393fc1=[0x1,0x2],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=['Level',_0x1eda3d(0x20d)],_0x1adb78=['D'],_0x3d3be6=['B'];break;case _0x1eda3d(0x241):_0x3a0d63=[0x0],_0x393fc1=[0x0],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=[_0x1eda3d(0x20d)],_0x1adb78=['D'],_0x3d3be6=['S'];break;case _0x1eda3d(0x254):_0x3a0d63=[0x0],_0x393fc1=[0x0],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2a8451=['Floor'],_0x1adb78=['D'],_0x3d3be6=['R'];break;}else{if(_0x3cc75f==_0x1eda3d(0x1b0))switch(_0x3eb8a9){case'Rack\x20A':_0x3a0d63=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x393fc1=['B','F'],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=[_0x1eda3d(0x268),_0x1eda3d(0x20d)],_0x1adb78=['C'],_0x3d3be6=['A'];break;case'Rack\x20B':_0x3a0d63=[0x5,0x4,0x3,0x2,0x1],_0x393fc1=['F','B','S'],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=[_0x1eda3d(0x268),'Floor'],_0x1adb78=['C'],_0x3d3be6=['B'];break;case _0x1eda3d(0x257):_0x3a0d63=[0x1,0x2,0x3,0x4,0x5],_0x393fc1=['B','F','S'],_0x1a42a6=[0x5,0x4,0x3,0x2,0x1],_0x2a8451=[_0x1eda3d(0x268),_0x1eda3d(0x20d)],_0x1adb78=['C'],_0x3d3be6=['C'];break;case _0x1eda3d(0x162):_0x3a0d63=[0x5,0x4,0x3,0x2,0x1],_0x393fc1=['F','B','S'],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=[_0x1eda3d(0x268),'Floor'],_0x1adb78=['C'],_0x3d3be6=['D'];break;case _0x1eda3d(0x24d):_0x3a0d63=[0x4,0x3,0x2,0x1],_0x393fc1=[0x1,0x2],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=[_0x1eda3d(0x268),'Floor'],_0x1adb78=['C'],_0x3d3be6=['E'];break;case _0x1eda3d(0x198):_0x3a0d63=[0x1,0x2,0x3],_0x393fc1=[0x1,0x2],_0x1a42a6=[0x1,0x2,0x3,0x4,0x5],_0x2a8451=['Level'],_0x1adb78=['C'],_0x3d3be6=['F'];break;}}return{'levels':_0x3a0d63,'Isle':_0x393fc1,'rack':_0x1a42a6,'type':_0x2a8451,'storage':_0x1adb78,'rak':_0x3d3be6};}async function getRandom8DigitNumber(){var _0x2d60c2=a0_0x118c6b;const _0x5cae64=0x989680,_0x4d6a86=0x5f5e0ff,_0xdca0a4=Math[_0x2d60c2(0x209)](Math[_0x2d60c2(0x1b1)]()*(_0x4d6a86-_0x5cae64+0x1))+_0x5cae64;var _0xbebe36;const _0x5b3707=await purchases['findOne']({'invoice':_0x2d60c2(0x194)+_0xdca0a4});return _0x5b3707&&_0x5b3707[_0x2d60c2(0x235)]>0x0?_0xbebe36=_0x2d60c2(0x194)+_0xdca0a4:_0xbebe36=_0x2d60c2(0x194)+_0xdca0a4,_0xbebe36;}function a0_0x237b(_0x5ec8e8,_0x5d8464){var _0x3cde94=a0_0x3cde();return a0_0x237b=function(_0x237b94,_0x2694fb){_0x237b94=_0x237b94-0x14c;var _0x530dea=_0x3cde94[_0x237b94];return _0x530dea;},a0_0x237b(_0x5ec8e8,_0x5d8464);}router[a0_0x118c6b(0x20b)](a0_0x118c6b(0x21b),auth,async(_0x48228c,_0x257cc1)=>{var _0x2e9b1b=a0_0x118c6b;try{const {username:_0x1161af,email:_0x14c1d2,role:_0x9b27ff}=_0x48228c['user'],_0x46538d=_0x48228c[_0x2e9b1b(0x246)],_0x321f3d=await profile[_0x2e9b1b(0x1ff)]({'email':_0x46538d[_0x2e9b1b(0x1c0)]}),_0x3508c5=await master_shop[_0x2e9b1b(0x22c)](),_0xf25f18=await staff['findOne']({'email':_0x46538d[_0x2e9b1b(0x1c0)]}),_0x3a8fb2=await suppliers[_0x2e9b1b(0x22c)]({});let _0xa42fbe;if(_0x46538d[_0x2e9b1b(0x160)]==_0x2e9b1b(0x1fb)){const _0x28f9ea=await staff[_0x2e9b1b(0x1ff)]({'email':_0x46538d['email']});_0xa42fbe=await warehouse[_0x2e9b1b(0x1f5)]([{'$match':{'status':_0x2e9b1b(0x22f),'name':_0x28f9ea[_0x2e9b1b(0x1aa)],'warehouse_category':_0x2e9b1b(0x211),'name':{'$ne':_0x2e9b1b(0x168)}}},{'$group':{'_id':_0x2e9b1b(0x1c9),'name':{'$first':_0x2e9b1b(0x1c9)}}}]);}else _0xa42fbe=await warehouse[_0x2e9b1b(0x1f5)]([{'$match':{'status':_0x2e9b1b(0x22f),'warehouse_category':_0x2e9b1b(0x211),'name':{'$ne':_0x2e9b1b(0x168)}}},{'$group':{'_id':'$name','name':{'$first':_0x2e9b1b(0x1c9)}}}]);const _0x64fb10=await product[_0x2e9b1b(0x22c)]({}),_0x3f5367=await warehouse['find']({'status':_0x2e9b1b(0x22f)}),_0x52d170=await purchases[_0x2e9b1b(0x22c)]({}),_0x532291=_0x52d170[_0x2e9b1b(0x235)]+0x1,_0x48ad6b=_0x2e9b1b(0x194)+_0x532291[_0x2e9b1b(0x1f4)]()[_0x2e9b1b(0x1c2)](0x5,'0');var _0x2a71dc=[_0x2e9b1b(0x161),'Enclosed'];if(_0x3508c5[0x0]['language']==_0x2e9b1b(0x227))var _0x4e4fa1=users[_0x2e9b1b(0x24a)];else{if(_0x3508c5[0x0][_0x2e9b1b(0x1db)]=='Hindi')var _0x4e4fa1=users[_0x2e9b1b(0x207)];else{if(_0x3508c5[0x0]['language']==_0x2e9b1b(0x188))var _0x4e4fa1=users[_0x2e9b1b(0x188)];else{if(_0x3508c5[0x0][_0x2e9b1b(0x1db)]==_0x2e9b1b(0x1c5))var _0x4e4fa1=users[_0x2e9b1b(0x1c5)];else{if(_0x3508c5[0x0][_0x2e9b1b(0x1db)]==_0x2e9b1b(0x218))var _0x4e4fa1=users[_0x2e9b1b(0x218)];else{if(_0x3508c5[0x0][_0x2e9b1b(0x1db)]=='Portuguese\x20(BR)')var _0x4e4fa1=users[_0x2e9b1b(0x233)];else{if(_0x3508c5[0x0][_0x2e9b1b(0x1db)]==_0x2e9b1b(0x151))var _0x4e4fa1=users['Chinese'];else{if(_0x3508c5[0x0][_0x2e9b1b(0x1db)]==_0x2e9b1b(0x18c))var _0x4e4fa1=users[_0x2e9b1b(0x248)];}}}}}}}const _0x46b10f=getRandom8DigitNumber();_0x46b10f[_0x2e9b1b(0x265)](_0x46a057=>{var _0x20f59d=_0x2e9b1b;_0x257cc1['render'](_0x20f59d(0x256),{'success':_0x48228c[_0x20f59d(0x1b2)]('success'),'errors':_0x48228c[_0x20f59d(0x1b2)](_0x20f59d(0x1c1)),'role':_0x46538d,'profile':_0x321f3d,'suppliers':_0x3a8fb2,'warehouse':_0xa42fbe,'product':_0x64fb10,'invoice':_0x46a057,'master_shop':_0x3508c5,'language':_0x4e4fa1,'find_data':_0x3f5367,'rooms_data':_0x2a71dc});})['catch'](_0xf9446e=>{var _0x11d8be=_0x2e9b1b;_0x48228c['flash'](_0x11d8be(0x1c1),_0x11d8be(0x1c8)),_0x257cc1['redirect']('/all_purchases/view');});}catch(_0x5a1266){console[_0x2e9b1b(0x26b)](_0x5a1266);}}),router[a0_0x118c6b(0x20b)]('/view/add_purchases/:id',auth,async(_0x1347c3,_0x495afc)=>{var _0x5ec356=a0_0x118c6b;try{const _0x2d7a19=_0x1347c3[_0x5ec356(0x1b6)]['id'];console[_0x5ec356(0x26b)](_0x2d7a19);const _0x330b15=await master_shop[_0x5ec356(0x22c)]();console[_0x5ec356(0x26b)](_0x5ec356(0x16e),_0x330b15);const _0xe015b0=await product[_0x5ec356(0x1ff)]({'name':_0x2d7a19});console[_0x5ec356(0x26b)]('product',_0xe015b0),_0x495afc[_0x5ec356(0x15c)](0xc8)['json']({'product_data':_0xe015b0,'master':_0x330b15});}catch(_0x505de6){console[_0x5ec356(0x26b)](_0x5ec356(0x1a1),_0x505de6);}}),router['post'](a0_0x118c6b(0x21b),auth,async(_0x284911,_0x50b188)=>{var _0x28174f=a0_0x118c6b;try{const {invoice:_0x4bee7d,date:_0x5f982c,warehouse_name:_0x4b256e,prod_name:_0x4c5983,prod_code:_0x2cf1bf,prod_qty:_0x1b73af,prod_unit:_0x4edcb,prod_secondunit:_0x3dfdf2,prod_level:_0x11c686,prod_isle:_0x57346d,prod_pallet:_0x3ed451,note:_0x52e4d2,expiry_date:_0x4d1949,batch_code:_0x386e35,payable:_0x2ae7cb,due_amount:_0x4a2cb2,Room_name:_0x634376,primary_code:_0x3b1f67,secondary_code:_0x4a82ea,MaxStocks_data:_0x5bcd06,PO_number:_0xa4f41b,SCRN:_0x94276d,JO_number:_0x18ff47}=_0x284911[_0x28174f(0x1a2)];if(typeof _0x4c5983==_0x28174f(0x214))var _0x543819=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x1f2)]],_0x2e8db8=[_0x284911[_0x28174f(0x1a2)]['prod_code']],_0x329de3=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x21c)]],_0x1868e3=[_0x284911[_0x28174f(0x1a2)]['prod_primunit']],_0x2b43b6=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x250)]],_0x1b5c61=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x205)]],_0x2761a2=[_0x284911[_0x28174f(0x1a2)]['primary_code']],_0x91b8e8=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x25b)]],_0xd55b40=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x1a7)]],_0x325fa7=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x1c3)]],_0x316390=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x22b)]],_0x425b8d=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x20e)]],_0x2c5e41=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x1a8)]],_0x4a2dab=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x1f1)]],_0x4e01ca=[_0x284911['body'][_0x28174f(0x222)]],_0x4ac454=[_0x284911[_0x28174f(0x1a2)]['RoomAssign']],_0x26d8d5=[_0x284911['body'][_0x28174f(0x158)]],_0x2281a1=[_0x284911['body'][_0x28174f(0x226)]],_0x1305bf=[_0x284911['body'][_0x28174f(0x249)]],_0x37eb86=[_0x284911[_0x28174f(0x1a2)][_0x28174f(0x1d8)]],_0x9d51c9=[_0x284911[_0x28174f(0x1a2)]['deliverydate']];else var _0x543819=[..._0x284911[_0x28174f(0x1a2)]['prod_name']],_0x2e8db8=[..._0x284911['body']['prod_code']],_0x329de3=[..._0x284911['body'][_0x28174f(0x21c)]],_0x1868e3=[..._0x284911[_0x28174f(0x1a2)]['prod_primunit']],_0x2b43b6=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x250)]],_0x1b5c61=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x205)]],_0x2761a2=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x213)]],_0x91b8e8=[..._0x284911[_0x28174f(0x1a2)]['secondary_code']],_0xd55b40=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x1a7)]],_0x325fa7=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x1c3)]],_0x316390=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x22b)]],_0x425b8d=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x20e)]],_0x2c5e41=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x1a8)]],_0x4a2dab=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x1f1)]],_0x4e01ca=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x222)]],_0x4ac454=[..._0x284911[_0x28174f(0x1a2)]['RoomAssign']],_0x26d8d5=[..._0x284911[_0x28174f(0x1a2)]['deliverycode']],_0x2281a1=[..._0x284911[_0x28174f(0x1a2)]['prod_invoice']],_0x1305bf=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x249)]],_0x37eb86=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x1d8)]],_0x9d51c9=[..._0x284911[_0x28174f(0x1a2)][_0x28174f(0x1ae)]];const _0x1cc49e=_0x543819[_0x28174f(0x166)](_0x125a5e=>{return _0x125a5e={'product_name':_0x125a5e};});_0x1305bf['forEach']((_0x54e26b,_0x4b997c)=>{var _0x2db4e3=_0x28174f;_0x1cc49e[_0x4b997c][_0x2db4e3(0x249)]=Math[_0x2db4e3(0x1a6)](_0x54e26b);}),_0x37eb86['forEach']((_0x2ceca2,_0x19f748)=>{var _0x4eb5b6=_0x28174f;_0x1cc49e[_0x19f748][_0x4eb5b6(0x1d8)]=_0x2ceca2;}),_0x2e8db8[_0x28174f(0x261)]((_0x1cc114,_0x2df8bc)=>{var _0xea6e9c=_0x28174f;_0x1cc49e[_0x2df8bc][_0xea6e9c(0x14d)]=_0x1cc114,_0x1cc49e[_0x2df8bc]['date_data']=_0x5f982c;}),_0x329de3[_0x28174f(0x261)]((_0x37dec9,_0x44949a)=>{var _0x38cefb=_0x28174f;_0x1cc49e[_0x44949a][_0x38cefb(0x1cd)]=Math[_0x38cefb(0x1a6)](_0x37dec9);}),_0x1868e3[_0x28174f(0x261)]((_0x143679,_0x18a2c2)=>{var _0x28cb9c=_0x28174f;_0x1cc49e[_0x18a2c2][_0x28cb9c(0x1e2)]=_0x143679;}),_0x2b43b6[_0x28174f(0x261)]((_0x3fef73,_0x4bcd73)=>{var _0x1c90ad=_0x28174f;_0x1cc49e[_0x4bcd73][_0x1c90ad(0x202)]=_0x3fef73;}),_0x1b5c61['forEach']((_0x4ced56,_0x39f8b3)=>{_0x4ac454['forEach']((_0x56905b,_0x2b71a7)=>{var _0x1d4ce7=a0_0x237b;if(_0x56905b==_0x1d4ce7(0x254)&&_0x39f8b3==_0x2b71a7){console[_0x1d4ce7(0x26b)](_0x56905b+'\x20<\x20wew\x20>\x20'+_0x39f8b3+_0x1d4ce7(0x185)+_0x2b71a7+_0x1d4ce7(0x185)+_0x4ced56);var _0x31a3a0=_0x4ced56[_0x1d4ce7(0x259)](0x3);_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x260)]=_0x4ced56[0x0],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1b9)]=_0x4ced56[0x1],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1be)]=0x0,_0x1cc49e[_0x39f8b3]['bin']=0x0,_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x165)]=_0x1d4ce7(0x20d),_0x1cc49e[_0x39f8b3]['floorlevel']=_0x31a3a0;}else{if(_0x56905b==_0x1d4ce7(0x241)&&_0x39f8b3==_0x2b71a7){var _0x31a3a0=_0x4ced56[_0x1d4ce7(0x259)](0x3);_0x1cc49e[_0x39f8b3]['storage']=_0x4ced56[0x0],_0x1cc49e[_0x39f8b3]['rack']=_0x4ced56[0x1],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1be)]=0x0,_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x264)]=0x0,_0x1cc49e[_0x39f8b3]['type']=_0x1d4ce7(0x20d),_0x1cc49e[_0x39f8b3]['floorlevel']=_0x4ced56[0x5];}else{if(_0x39f8b3==_0x2b71a7){if(_0x4ced56[0x0]=='A'&&_0x4ced56[0x1]=='L'&&_0x4ced56[0x2]=='L')console['log'](_0x56905b+_0x1d4ce7(0x185)+_0x39f8b3+_0x1d4ce7(0x185)+_0x2b71a7+_0x1d4ce7(0x185)+_0x4ced56+_0x1d4ce7(0x266)),_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x260)]=_0x4ced56[0x0],_0x1cc49e[_0x39f8b3]['rack']=_0x4ced56[0x1],_0x1cc49e[_0x39f8b3]['bay']=0x0,_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x264)]=0x0,_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x165)]=_0x1d4ce7(0x20d),_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1da)]=_0x4ced56[0x3];else{var _0x414b08;if(_0x4ced56[0x4]=='L')_0x414b08=_0x1d4ce7(0x268);else _0x4ced56[0x4]=='F'&&(_0x414b08='Floor');_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x260)]=_0x4ced56[0x0],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1b9)]=_0x4ced56[0x1],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1be)]=_0x4ced56[0x2],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x264)]=_0x4ced56[0x3],_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x165)]=_0x414b08,_0x1cc49e[_0x39f8b3][_0x1d4ce7(0x1da)]=_0x4ced56[0x5];}}}}});}),_0x2761a2[_0x28174f(0x261)]((_0x59d571,_0x1cc24c)=>{var _0x4dbea9=_0x28174f;_0x1cc49e[_0x1cc24c][_0x4dbea9(0x213)]=_0x59d571;}),_0x91b8e8[_0x28174f(0x261)]((_0x271b6a,_0x291c7e)=>{var _0x1d4acf=_0x28174f;_0x1cc49e[_0x291c7e][_0x1d4acf(0x25b)]=_0x271b6a;}),_0xd55b40[_0x28174f(0x261)]((_0x323ebc,_0x802262)=>{_0x1cc49e[_0x802262]['maxStocks']=_0x323ebc;}),_0x325fa7[_0x28174f(0x261)]((_0x23020e,_0xc9fcc0)=>{var _0x33c31f=_0x28174f;_0x1cc49e[_0xc9fcc0][_0x33c31f(0x1c3)]=_0x23020e;}),_0x316390[_0x28174f(0x261)]((_0x2425ad,_0x2bb8e6)=>{var _0x5d1cf1=_0x28174f;_0x1cc49e[_0x2bb8e6][_0x5d1cf1(0x22b)]=_0x2425ad;}),_0x425b8d[_0x28174f(0x261)]((_0x52be6c,_0x2d56fa)=>{var _0x1f55b0=_0x28174f;_0x1cc49e[_0x2d56fa][_0x1f55b0(0x20c)]=_0x52be6c;}),_0x2c5e41[_0x28174f(0x261)]((_0x1ca091,_0x355ae5)=>{_0x1cc49e[_0x355ae5]['alertQTY']=_0x1ca091;}),_0x4a2dab[_0x28174f(0x261)]((_0x1dda5b,_0x224fa9)=>{var _0x4c8ccb=_0x28174f;_0x1cc49e[_0x224fa9][_0x4c8ccb(0x1f1)]=_0x1dda5b;}),_0x4e01ca['forEach']((_0x776bdf,_0x39a5d3)=>{var _0x454adb=_0x28174f;_0x1cc49e[_0x39a5d3][_0x454adb(0x1fe)]=_0x776bdf;}),_0x4ac454[_0x28174f(0x261)]((_0x58fd9b,_0x422f7b)=>{var _0x292d7e=_0x28174f;_0x1cc49e[_0x422f7b][_0x292d7e(0x1a3)]=_0x58fd9b;}),_0x9d51c9[_0x28174f(0x261)]((_0x6fc542,_0x3ea73f)=>{_0x1cc49e[_0x3ea73f]['delivery_date']=_0x6fc542;}),_0x26d8d5['forEach']((_0x5ece0c,_0x29c019)=>{var _0x470622=_0x28174f;_0x1cc49e[_0x29c019][_0x470622(0x163)]=_0x5ece0c;}),_0x2281a1['forEach']((_0x205f96,_0x376f55)=>{var _0x517dbc=_0x28174f;_0x1cc49e[_0x376f55][_0x517dbc(0x183)]=_0x205f96;});const _0xf35cd2=_0x4ac454[_0x28174f(0x166)](_0x1b89c1=>{return _0x1b89c1={'room_name':_0x1b89c1};}),_0x1402b0=_0x1cc49e[_0x28174f(0x15f)](_0x53e5d5=>_0x53e5d5[_0x28174f(0x1cd)]!=='0'&&_0x53e5d5[_0x28174f(0x1cd)]!==''),_0x30e945=new purchases({'invoice':_0x4bee7d,'suppliers':_0x284911[_0x28174f(0x1a2)][_0x28174f(0x19f)],'date':_0x5f982c,'warehouse_name':_0x4b256e,'product':_0x1402b0,'note':_0x52e4d2,'due_amount':_0x4a2cb2,'POnumber':_0xa4f41b,'SCRN':_0x94276d,'JO_number':_0x18ff47,'roomList':_0xf35cd2}),_0x315fa0=await _0x30e945[_0x28174f(0x21a)](),_0x132214=await purchases[_0x28174f(0x1ff)]({'invoice':_0x4bee7d}),_0x4e8536=_0x132214['product'][_0x28174f(0x166)](async _0x2e4e79=>{var _0x1b0215=_0x28174f,_0x18bcf8=await warehouse[_0x1b0215(0x1ff)]({'name':_0x4b256e,'room':_0x2e4e79[_0x1b0215(0x1a3)]}),_0x162f3b=0x0;return _0x18bcf8[_0x1b0215(0x201)][_0x1b0215(0x261)](_0x4e488d=>{var _0xabc6f6=_0x1b0215;_0x4e488d['product_name']==_0x2e4e79[_0xabc6f6(0x17c)]&&_0x4e488d[_0xabc6f6(0x1da)]==_0x2e4e79[_0xabc6f6(0x1da)]&&_0x4e488d[_0xabc6f6(0x165)]==_0x2e4e79[_0xabc6f6(0x165)]&&_0x4e488d[_0xabc6f6(0x264)]==_0x2e4e79[_0xabc6f6(0x264)]&&_0x4e488d[_0xabc6f6(0x1be)]==_0x2e4e79['bay']&&_0x4e488d['rack']==_0x2e4e79[_0xabc6f6(0x1b9)]&&_0x4e488d['storage']==_0x2e4e79[_0xabc6f6(0x260)]&&_0x4e488d[_0xabc6f6(0x22b)]==_0x2e4e79[_0xabc6f6(0x22b)]&&_0x4e488d['batch_code']==_0x2e4e79[_0xabc6f6(0x1c3)]&&_0x4e488d[_0xabc6f6(0x1f1)]==_0x2e4e79[_0xabc6f6(0x1f1)]&&_0x4e488d[_0xabc6f6(0x183)]==_0x132214[_0xabc6f6(0x183)]&&(_0x4e488d[_0xabc6f6(0x19a)]+=Math[_0xabc6f6(0x1a6)](_0x2e4e79[_0xabc6f6(0x1cd)]),_0x162f3b++);}),_0x162f3b===0x0&&_0x18bcf8[_0x1b0215(0x201)][_0x1b0215(0x237)]({'product_name':_0x2e4e79[_0x1b0215(0x17c)],'product_stock':Math[_0x1b0215(0x1a6)](_0x2e4e79[_0x1b0215(0x1cd)]),'primary_code':_0x2e4e79[_0x1b0215(0x213)],'secondary_code':_0x2e4e79[_0x1b0215(0x25b)],'product_code':_0x2e4e79[_0x1b0215(0x14d)],'storage':_0x2e4e79[_0x1b0215(0x260)],'rack':_0x2e4e79['rack'],'bay':_0x2e4e79[_0x1b0215(0x1be)],'bin':_0x2e4e79['bin'],'type':_0x2e4e79['type'],'floorlevel':_0x2e4e79[_0x1b0215(0x1da)],'maxProducts':_0x2e4e79['maxStocks'],'unit':_0x2e4e79[_0x1b0215(0x1e2)],'secondary_unit':_0x2e4e79['secondary_unit'],'expiry_date':_0x2e4e79[_0x1b0215(0x22b)],'maxPerUnit':_0x2e4e79[_0x1b0215(0x20c)],'batch_code':_0x2e4e79['batch_code'],'alertQTY':_0x2e4e79[_0x1b0215(0x1a8)],'production_date':_0x2e4e79[_0x1b0215(0x1f1)],'product_cat':_0x2e4e79[_0x1b0215(0x1fe)],'invoice':_0x2e4e79[_0x1b0215(0x183)],'actual_qty':Math[_0x1b0215(0x1a6)](_0x2e4e79[_0x1b0215(0x249)]),'actual_uom':_0x2e4e79[_0x1b0215(0x1d8)],'delivery_date':_0x2e4e79[_0x1b0215(0x271)],'delivery_code':_0x2e4e79[_0x1b0215(0x163)]}),_0x18bcf8;});Promise[_0x28174f(0x206)](_0x4e8536)[_0x28174f(0x265)](async _0x3a2daa=>{var _0x477197=_0x28174f;try{for(const _0xd176a1 of _0x3a2daa){await _0xd176a1['save']();}const _0x45a8d8=await master_shop[_0x477197(0x22c)](),_0x371d1e=await email_settings[_0x477197(0x1ff)](),_0xe3ebe1=await supervisor_settings[_0x477197(0x22c)]();var _0x51e0e7=_0x132214[_0x477197(0x155)],_0x2162d7='',_0x31485e;for(_0x31485e in _0x51e0e7){_0x2162d7+=_0x477197(0x19c)+_0x477197(0x16b)+_0x51e0e7[_0x31485e][_0x477197(0x17c)]+_0x477197(0x26a)+_0x477197(0x16b)+_0x51e0e7[_0x31485e][_0x477197(0x14d)]+_0x477197(0x26a)+_0x477197(0x16b)+_0x51e0e7[_0x31485e][_0x477197(0x1cd)]+_0x477197(0x26a)+_0x477197(0x16b)+_0x51e0e7[_0x31485e][_0x477197(0x1e2)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x51e0e7[_0x31485e][_0x477197(0x202)]+_0x477197(0x26a)+_0x477197(0x16b)+_0x132214[_0x477197(0x1c6)]+_0x477197(0x26a)+_0x477197(0x16b)+_0x51e0e7[_0x31485e][_0x477197(0x1a3)]+_0x477197(0x26a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x51e0e7[_0x31485e]['storage']+_0x51e0e7[_0x31485e]['rack']+_0x51e0e7[_0x31485e]['bay']+_0x51e0e7[_0x31485e][_0x477197(0x264)]+_0x51e0e7[_0x31485e]['type'][0x0]+_0x51e0e7[_0x31485e][_0x477197(0x1da)]+_0x477197(0x26a),_0x477197(0x1ac);}let _0x1d9388=nodemailer[_0x477197(0x159)]({'host':_0x371d1e['host'],'port':Number(_0x371d1e[_0x477197(0x1e4)]),'secure':![],'auth':{'user':_0x371d1e[_0x477197(0x1c0)],'pass':_0x371d1e[_0x477197(0x1e8)]}}),_0x4663b9={'from':_0x371d1e[_0x477197(0x1c0)],'to':_0xe3ebe1[0x0][_0x477197(0x174)],'subject':_0x477197(0x210),'attachments':[{'filename':_0x477197(0x200),'path':__dirname+_0x477197(0x217)+_0x477197(0x1e5)+_0x45a8d8[0x0][_0x477197(0x219)],'cid':_0x477197(0x26f)}],'html':'<!DOCTYPE\x20html>'+_0x477197(0x16a)+_0x477197(0x230)+'<div>'+_0x477197(0x1b4)+'<div>'+_0x477197(0x196)+'</div>'+'<div>'+_0x477197(0x1ce)+_0x45a8d8[0x0][_0x477197(0x1ba)]+'\x20</h2>'+_0x477197(0x195)+_0x477197(0x195)+_0x477197(0x1d4)+_0x477197(0x190)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x132214[_0x477197(0x183)]+'\x20'+_0x477197(0x14e)+_0x477197(0x186)+_0x132214[_0x477197(0x23b)]+'\x20'+_0x477197(0x1e6)+_0x477197(0x20f)+_0x477197(0x195)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x477197(0x19e)+_0x477197(0x19c)+_0x477197(0x172)+_0x477197(0x245)+_0x477197(0x216)+_0x477197(0x15b)+_0x477197(0x244)+_0x477197(0x167)+_0x477197(0x197)+_0x477197(0x179)+_0x477197(0x1ac)+_0x477197(0x189)+_0x477197(0x252)+'\x20'+_0x2162d7+'\x20'+_0x477197(0x15e)+_0x477197(0x203)+'<div>'+_0x477197(0x1a4)+_0x477197(0x1f9)+_0x45a8d8[0x0][_0x477197(0x1ba)]+_0x477197(0x20f)+_0x477197(0x195)+_0x477197(0x195)+_0x477197(0x1ec)};_0x1d9388[_0x477197(0x1ab)](_0x4663b9,function(_0x2a8454,_0x2c700a){var _0x1bc2dc=_0x477197;_0x2a8454?(console['log'](_0x2a8454),console[_0x1bc2dc(0x26b)](_0x1bc2dc(0x16f))):console[_0x1bc2dc(0x26b)](_0x1bc2dc(0x199));}),_0x284911[_0x477197(0x1b2)](_0x477197(0x1bb),_0x477197(0x1fd)),_0x50b188[_0x477197(0x17d)](_0x477197(0x1cc));}catch(_0x3c3382){console['error'](_0x3c3382),_0x50b188['status'](0x1f4)[_0x477197(0x23e)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x28174f(0x22e)](_0x1c40f5=>{var _0x1d4c80=_0x28174f;console[_0x1d4c80(0x242)](_0x1c40f5),_0x50b188[_0x1d4c80(0x15c)](0x1f4)[_0x1d4c80(0x23e)]({'error':_0x1d4c80(0x240)});});}catch(_0x4f98fa){console['log'](_0x4f98fa);}}),router[a0_0x118c6b(0x20b)](a0_0x118c6b(0x23f),auth,async(_0x1f1fce,_0x999edc)=>{var _0x4a4e01=a0_0x118c6b;try{const {username:_0x2c93f6,email:_0x39acff,role:_0x39d38f}=_0x1f1fce[_0x4a4e01(0x246)],_0x30cf5f=_0x1f1fce[_0x4a4e01(0x246)],_0x2e41b6=await profile[_0x4a4e01(0x1ff)]({'email':_0x30cf5f[_0x4a4e01(0x1c0)]}),_0x1e0e3c=await master_shop[_0x4a4e01(0x22c)](),_0xdc4bc4=_0x1f1fce[_0x4a4e01(0x1b6)]['id'],_0x21fef6=await purchases['findById'](_0xdc4bc4),_0x18db4d=await warehouse[_0x4a4e01(0x1f5)]([{'$match':{'name':_0x21fef6['warehouse_name'],'room':_0x21fef6['room']}},{'$unwind':_0x4a4e01(0x262)},{'$group':{'_id':_0x4a4e01(0x1f7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4a4e01(0x1cf)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4a4e01(0x224)},'type':{'$first':_0x4a4e01(0x204)},'floorlevel':{'$first':_0x4a4e01(0x176)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4a4e01(0x269)},'product_code':{'$first':_0x4a4e01(0x1f8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4a4e01(0x1bd)},'expiry_date':{'$first':_0x4a4e01(0x1d7)}}}]),_0x596cfd=await customer[_0x4a4e01(0x22c)]({});let _0x3e26d3;if(_0x30cf5f[_0x4a4e01(0x160)]==_0x4a4e01(0x1fb)){const _0x50847d=await staff[_0x4a4e01(0x1ff)]({'email':_0x30cf5f[_0x4a4e01(0x1c0)]});_0x3e26d3=await warehouse['aggregate']([{'$match':{'status':_0x4a4e01(0x22f),'name':_0x50847d[_0x4a4e01(0x1aa)]}},{'$group':{'_id':_0x4a4e01(0x1c9),'name':{'$first':'$name'}}}]);}else _0x3e26d3=await warehouse['aggregate']([{'$match':{'status':_0x4a4e01(0x22f)}},{'$group':{'_id':_0x4a4e01(0x1c9),'name':{'$first':_0x4a4e01(0x1c9)}}}]);const _0x3c0ce6=await product[_0x4a4e01(0x22c)]({}),_0x7c8657=await suppliers[_0x4a4e01(0x22c)]({}),_0x696922=BayBinSelected(_0x21fef6[_0x4a4e01(0x1c6)],_0x21fef6[_0x4a4e01(0x238)]);if(_0x1e0e3c[0x0]['language']==_0x4a4e01(0x227)){var _0x1d4d60=users[_0x4a4e01(0x24a)];console['log'](_0x1d4d60);}else{if(_0x1e0e3c[0x0][_0x4a4e01(0x1db)]==_0x4a4e01(0x207))var _0x1d4d60=users[_0x4a4e01(0x207)];else{if(_0x1e0e3c[0x0][_0x4a4e01(0x1db)]=='German')var _0x1d4d60=users[_0x4a4e01(0x188)];else{if(_0x1e0e3c[0x0][_0x4a4e01(0x1db)]==_0x4a4e01(0x1c5))var _0x1d4d60=users[_0x4a4e01(0x1c5)];else{if(_0x1e0e3c[0x0][_0x4a4e01(0x1db)]=='French')var _0x1d4d60=users[_0x4a4e01(0x218)];else{if(_0x1e0e3c[0x0]['language']==_0x4a4e01(0x225))var _0x1d4d60=users['Portuguese'];else{if(_0x1e0e3c[0x0][_0x4a4e01(0x1db)]==_0x4a4e01(0x151))var _0x1d4d60=users['Chinese'];else{if(_0x1e0e3c[0x0]['language']=='Arabic\x20(ae)')var _0x1d4d60=users[_0x4a4e01(0x248)];}}}}}}}_0x999edc[_0x4a4e01(0x1e1)](_0x4a4e01(0x232),{'success':_0x1f1fce[_0x4a4e01(0x1b2)](_0x4a4e01(0x1bb)),'errors':_0x1f1fce[_0x4a4e01(0x1b2)]('errors'),'role':_0x30cf5f,'profile':_0x2e41b6,'customer':_0x596cfd,'warehouse':_0x3e26d3,'product':_0x18db4d,'user':_0x21fef6,'master_shop':_0x1e0e3c,'unit':_0x3c0ce6,'language':_0x1d4d60,'suppliers':_0x7c8657,'dataSelected':_0x696922});}catch(_0x10bec2){console['log'](_0x10bec2);}}),router[a0_0x118c6b(0x192)](a0_0x118c6b(0x23f),auth,async(_0x364efb,_0x4f0345)=>{var _0x5551ed=a0_0x118c6b;try{const _0x2bab35=_0x364efb[_0x5551ed(0x1b6)]['id'],{invoice:_0x5ca324,warehouse_name:_0x1fa9e9,Room_name:_0x5435e6}=_0x364efb[_0x5551ed(0x1a2)],_0x6d1fd6=await warehouse[_0x5551ed(0x1ff)]({'name':_0x1fa9e9,'room':_0x5435e6}),_0xf654bc=await purchases[_0x5551ed(0x1ff)]({'invoice':_0x5ca324});_0xf654bc[_0x5551ed(0x155)][_0x5551ed(0x261)](_0x92db28=>{var _0xf81cba=_0x5551ed,_0x43eea7=0x0;const _0x56a1bd=_0x6d1fd6[_0xf81cba(0x201)][_0xf81cba(0x166)](_0x157bec=>{var _0x7c8a94=_0xf81cba;_0x157bec[_0x7c8a94(0x17c)]==_0x92db28[_0x7c8a94(0x17c)]&&_0x157bec['floorlevel']==_0x92db28[_0x7c8a94(0x1da)]&&_0x157bec['type']==_0x92db28[_0x7c8a94(0x165)]&&_0x157bec[_0x7c8a94(0x264)]==_0x92db28[_0x7c8a94(0x264)]&&_0x157bec[_0x7c8a94(0x1be)]==_0x92db28[_0x7c8a94(0x1be)]&&_0x157bec[_0x7c8a94(0x1b9)]==_0x92db28[_0x7c8a94(0x1b9)]&&_0x157bec[_0x7c8a94(0x260)]==_0x92db28[_0x7c8a94(0x260)]&&_0x157bec[_0x7c8a94(0x22b)]==_0x92db28[_0x7c8a94(0x22b)]&&_0x157bec[_0x7c8a94(0x1c3)]==_0x92db28[_0x7c8a94(0x1c3)]&&_0x157bec[_0x7c8a94(0x1f1)]==_0x92db28['production_date']&&_0x157bec[_0x7c8a94(0x271)]==_0x92db28[_0x7c8a94(0x271)]&&_0x157bec[_0x7c8a94(0x163)]==_0x92db28['delivery_code']&&(_0x157bec['product_stock']=parseInt(_0x157bec['product_stock'])+parseInt(_0x92db28[_0x7c8a94(0x1cd)]),_0x43eea7++);});_0x43eea7=='0'&&(_0x6d1fd6[_0xf81cba(0x201)]=_0x6d1fd6[_0xf81cba(0x201)][_0xf81cba(0x24e)]({'product_name':_0x92db28[_0xf81cba(0x17c)],'product_stock':_0x92db28[_0xf81cba(0x1cd)],'primary_code':_0x92db28['primary_code'],'secondary_code':_0x92db28[_0xf81cba(0x25b)],'product_code':_0x92db28[_0xf81cba(0x14d)],'storage':_0x92db28['storage'],'rack':_0x92db28[_0xf81cba(0x1b9)],'bay':_0x92db28['bay'],'bin':_0x92db28[_0xf81cba(0x264)],'type':_0x92db28[_0xf81cba(0x165)],'floorlevel':_0x92db28[_0xf81cba(0x1da)],'maxProducts':_0x92db28[_0xf81cba(0x1d9)],'unit':_0x92db28['standard_unit'],'secondary_unit':_0x92db28['secondary_unit'],'expiry_date':_0x92db28['expiry_date'],'maxPerUnit':_0x92db28[_0xf81cba(0x20c)],'batch_code':_0x92db28[_0xf81cba(0x1c3)],'alertQTY':_0x92db28[_0xf81cba(0x1a8)],'production_date':_0x92db28[_0xf81cba(0x1f1)],'delivery_date':_0x92db28[_0xf81cba(0x271)],'delivery_code':_0x92db28[_0xf81cba(0x163)]}));}),await _0x6d1fd6[_0x5551ed(0x21a)](),_0xf654bc[_0x5551ed(0x150)]=_0x5551ed(0x272);const _0x23bc38=await _0xf654bc[_0x5551ed(0x21a)]();_0x364efb[_0x5551ed(0x1b2)](_0x5551ed(0x1bb),_0x5551ed(0x1fa)),_0x4f0345['redirect']('/all_purchases/view');}catch(_0x53f53a){console[_0x5551ed(0x26b)](_0x53f53a);}}),router['get'](a0_0x118c6b(0x1bc),auth,async(_0x2a223e,_0x2b2f58)=>{var _0x99442b=a0_0x118c6b;try{const {username:_0x2aa429,email:_0x5eed81,role:_0x596b61}=_0x2a223e['user'],_0x32fd96=_0x2a223e[_0x99442b(0x246)],_0x1eaac9=await profile[_0x99442b(0x1ff)]({'email':_0x32fd96[_0x99442b(0x1c0)]}),_0x7a8dde=await master_shop[_0x99442b(0x22c)](),_0x888a37=_0x2a223e[_0x99442b(0x1b6)]['id'],_0x3174ce=await purchases['findById'](_0x888a37),_0x50a743=await suppliers[_0x99442b(0x22c)]({});let _0x45ed2f;if(_0x32fd96[_0x99442b(0x160)]==_0x99442b(0x1fb)){const _0x430a4e=await staff['findOne']({'email':_0x32fd96[_0x99442b(0x1c0)]});_0x45ed2f=await warehouse[_0x99442b(0x22c)]({'status':_0x99442b(0x22f),'name':_0x430a4e['warehouse'],'warehouse_category':_0x99442b(0x211)});}else _0x45ed2f=await warehouse['aggregate']([{'$match':{'status':_0x99442b(0x22f),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x99442b(0x1c9)}}}]);const _0x33811d=await product[_0x99442b(0x22c)]({}),_0x2dd3df=BayBinSelected(_0x3174ce[_0x99442b(0x1c6)],_0x3174ce['room']);let _0x1c2674=new Date(_0x3174ce[_0x99442b(0x22b)]),_0xdc66a8=('0'+_0x1c2674[_0x99442b(0x181)]())['slice'](-0x2),_0x3b0e5c=('0'+(_0x1c2674[_0x99442b(0x223)]()+0x1))[_0x99442b(0x259)](-0x2),_0x4402c0=_0x1c2674[_0x99442b(0x1a5)](),_0x43e9da=_0x4402c0+'-'+_0x3b0e5c+'-'+_0xdc66a8;if(_0x7a8dde[0x0][_0x99442b(0x1db)]==_0x99442b(0x227)){var _0x559cce=users[_0x99442b(0x24a)];console[_0x99442b(0x26b)](_0x559cce);}else{if(_0x7a8dde[0x0][_0x99442b(0x1db)]==_0x99442b(0x207))var _0x559cce=users['Hindi'];else{if(_0x7a8dde[0x0][_0x99442b(0x1db)]=='German')var _0x559cce=users[_0x99442b(0x188)];else{if(_0x7a8dde[0x0][_0x99442b(0x1db)]==_0x99442b(0x1c5))var _0x559cce=users[_0x99442b(0x1c5)];else{if(_0x7a8dde[0x0][_0x99442b(0x1db)]=='French')var _0x559cce=users['French'];else{if(_0x7a8dde[0x0][_0x99442b(0x1db)]==_0x99442b(0x225))var _0x559cce=users[_0x99442b(0x233)];else{if(_0x7a8dde[0x0][_0x99442b(0x1db)]==_0x99442b(0x151))var _0x559cce=users[_0x99442b(0x151)];else{if(_0x7a8dde[0x0]['language']==_0x99442b(0x18c))var _0x559cce=users[_0x99442b(0x248)];}}}}}}}_0x2b2f58['render'](_0x99442b(0x25a),{'success':_0x2a223e['flash'](_0x99442b(0x1bb)),'errors':_0x2a223e[_0x99442b(0x1b2)](_0x99442b(0x1c1)),'role':_0x32fd96,'profile':_0x1eaac9,'purchases':_0x3174ce,'suppliers':_0x50a743,'warehouse':_0x45ed2f,'product':_0x33811d,'master_shop':_0x7a8dde,'language':_0x559cce,'ed_fullDate':_0x43e9da,'dataSelected':_0x2dd3df});}catch(_0x42efd4){console['log'](_0x42efd4);}}),router[a0_0x118c6b(0x192)](a0_0x118c6b(0x1bc),auth,async(_0x430915,_0x4083f5)=>{var _0x4e57b2=a0_0x118c6b;try{const _0x19aa54=_0x430915[_0x4e57b2(0x1b6)]['id'],_0x2e0891=await purchases[_0x4e57b2(0x1ff)]({'_id':_0x430915[_0x4e57b2(0x1b6)]['id']}),_0x311ec7=await warehouse[_0x4e57b2(0x1ff)]({'name':_0x2e0891[_0x4e57b2(0x1c6)],'room':_0x2e0891[_0x4e57b2(0x238)]});_0x2e0891['product']['forEach'](_0x58f415=>{var _0x3bce6e=_0x4e57b2;const _0x1b50d6=_0x311ec7[_0x3bce6e(0x201)][_0x3bce6e(0x166)](_0xa08de1=>{var _0x137f05=_0x3bce6e;_0xa08de1[_0x137f05(0x17c)]==_0x58f415[_0x137f05(0x17c)]&&_0xa08de1[_0x137f05(0x1da)]==_0x58f415['floorlevel']&&_0xa08de1[_0x137f05(0x165)]==_0x58f415['type']&&_0xa08de1['bin']==_0x58f415[_0x137f05(0x264)]&&_0xa08de1[_0x137f05(0x1be)]==_0x58f415[_0x137f05(0x1be)]&&_0xa08de1['rack']==_0x58f415[_0x137f05(0x1b9)]&&_0xa08de1['storage']==_0x58f415[_0x137f05(0x260)]&&(_0xa08de1[_0x137f05(0x19a)]=parseInt(_0xa08de1[_0x137f05(0x19a)])-parseInt(_0x58f415['quantity']));});}),await _0x311ec7[_0x4e57b2(0x21a)]();const {invoice:_0x3bec24,suppliers:_0x1d1777,date:_0x318c8e,warehouse_name:_0x761533,prod_name:_0x1b0b93,prod_code:_0x20b542,prod_qty:_0x53d627,prod_unit:_0x4d53ed,prod_secondunit:_0x3f381c,prod_level:_0x20fa53,prod_isle:_0x463a50,prod_pallet:_0x56998f,note:_0x167f7,expiry_date:_0x1f38cc,batch_code:_0x4e2afc,paid_amount:_0x583bbc,due_amount:_0x539862,Room_name:_0x2945bf,primary_code:_0x50acdb,secondary_code:_0x4fd3ef,PO_number:_0x26b9cf,JO_number:_0x3df998}=_0x430915[_0x4e57b2(0x1a2)];if(typeof _0x1b0b93==_0x4e57b2(0x214))var _0x5c5905=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1f2)]],_0x47a81e=[_0x430915['body'][_0x4e57b2(0x1d2)]],_0x7dc855=[_0x430915['body'][_0x4e57b2(0x14c)]],_0x772db2=[_0x430915[_0x4e57b2(0x1a2)]['prod_unit']],_0x356fe1=[_0x430915[_0x4e57b2(0x1a2)]['prod_secondunit']],_0xd6ad2f=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x205)]],_0x20c03d=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x152)]],_0x228c3a=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x153)]],_0x40383f=[_0x430915['body']['primary_code']],_0x3593e8=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x25b)]],_0x319b0b=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1a7)]],_0x5154a5=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1c3)]],_0x2952e4=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x22b)]],_0x4fcd2e=[_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x260)]],_0x591a62=[_0x430915['body'][_0x4e57b2(0x1ad)]],_0x57f185=[_0x430915['body'][_0x4e57b2(0x165)]];else var _0x5c5905=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1f2)]],_0x47a81e=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1d2)]],_0x7dc855=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x14c)]],_0x772db2=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1d3)]],_0x356fe1=[..._0x430915[_0x4e57b2(0x1a2)]['prod_secondunit']],_0xd6ad2f=[..._0x430915['body'][_0x4e57b2(0x205)]],_0x20c03d=[..._0x430915['body'][_0x4e57b2(0x152)]],_0x228c3a=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x153)]],_0x40383f=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x213)]],_0x3593e8=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x25b)]],_0x319b0b=[..._0x430915[_0x4e57b2(0x1a2)]['MaxStocks_data']],_0x5154a5=[..._0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1c3)]],_0x2952e4=[..._0x430915[_0x4e57b2(0x1a2)]['expiry_date']],_0x4fcd2e=[..._0x430915[_0x4e57b2(0x1a2)]['storage']],_0x591a62=[..._0x430915[_0x4e57b2(0x1a2)]['rak']],_0x57f185=[..._0x430915[_0x4e57b2(0x1a2)]['type']];const _0x4fe76e=_0x5c5905[_0x4e57b2(0x166)](_0x45a4e1=>{return _0x45a4e1={'product_name':_0x45a4e1};});_0x47a81e[_0x4e57b2(0x261)]((_0x37df04,_0x1fc2f2)=>{var _0x438c4a=_0x4e57b2;_0x4fe76e[_0x1fc2f2][_0x438c4a(0x14d)]=_0x37df04;}),_0x7dc855[_0x4e57b2(0x261)]((_0x3336ba,_0x55c4f2)=>{_0x4fe76e[_0x55c4f2]['quantity']=_0x3336ba;}),_0x772db2[_0x4e57b2(0x261)]((_0xb9d276,_0x512993)=>{var _0x14319a=_0x4e57b2;_0x4fe76e[_0x512993][_0x14319a(0x1e2)]=_0xb9d276;}),_0x356fe1[_0x4e57b2(0x261)]((_0x3e386d,_0x189938)=>{_0x4fe76e[_0x189938]['secondary_unit']=_0x3e386d;}),_0xd6ad2f['forEach']((_0x343aab,_0x34f3b2)=>{var _0x4c450f=_0x4e57b2;_0x4fe76e[_0x34f3b2][_0x4c450f(0x1be)]=_0x343aab;}),_0x20c03d[_0x4e57b2(0x261)]((_0x43d33f,_0x238c8d)=>{var _0x2d6fee=_0x4e57b2;_0x4fe76e[_0x238c8d][_0x2d6fee(0x264)]=_0x43d33f;}),_0x228c3a['forEach']((_0x4b025a,_0x55af74)=>{var _0x4d6fce=_0x4e57b2;_0x4fe76e[_0x55af74][_0x4d6fce(0x1da)]=_0x4b025a;}),_0x40383f[_0x4e57b2(0x261)]((_0x5c9a9b,_0x346860)=>{var _0xe4df9e=_0x4e57b2;_0x4fe76e[_0x346860][_0xe4df9e(0x213)]=_0x5c9a9b;}),_0x3593e8[_0x4e57b2(0x261)]((_0xaea889,_0xb40ed4)=>{var _0xbcb1e=_0x4e57b2;_0x4fe76e[_0xb40ed4][_0xbcb1e(0x25b)]=_0xaea889;}),_0x319b0b['forEach']((_0x8ab162,_0x1d012b)=>{var _0xf9a22e=_0x4e57b2;_0x4fe76e[_0x1d012b][_0xf9a22e(0x1d9)]=_0x8ab162;}),_0x5154a5[_0x4e57b2(0x261)]((_0x1a4172,_0x23ed20)=>{var _0x14e192=_0x4e57b2;_0x4fe76e[_0x23ed20][_0x14e192(0x1c3)]=_0x1a4172;}),_0x2952e4['forEach']((_0x19253f,_0x16bbbb)=>{_0x4fe76e[_0x16bbbb]['expiry_date']=_0x19253f;}),_0x57f185[_0x4e57b2(0x261)]((_0x3f163b,_0x3717d1)=>{var _0x5753d5=_0x4e57b2;_0x4fe76e[_0x3717d1][_0x5753d5(0x165)]=_0x3f163b;}),_0x4fcd2e[_0x4e57b2(0x261)]((_0x31345c,_0x2dbde0)=>{var _0x3584d9=_0x4e57b2;_0x4fe76e[_0x2dbde0][_0x3584d9(0x260)]=_0x31345c;}),_0x591a62['forEach']((_0x4c2a6e,_0x20b8a3)=>{_0x4fe76e[_0x20b8a3]['rack']=_0x4c2a6e;});const _0x51e864=_0x4fe76e[_0x4e57b2(0x15f)](_0x1e7282=>_0x1e7282[_0x4e57b2(0x1cd)]!=='0'&&_0x1e7282['quantity']!=='');_0x2e0891[_0x4e57b2(0x183)]=_0x3bec24,_0x2e0891[_0x4e57b2(0x19f)]=_0x1d1777,_0x2e0891[_0x4e57b2(0x23b)]=_0x318c8e,_0x2e0891[_0x4e57b2(0x1c6)]=_0x761533,_0x2e0891['product']=_0x51e864,_0x2e0891[_0x4e57b2(0x17a)]=_0x167f7,_0x2e0891['paid_amount']=_0x583bbc,_0x2e0891[_0x4e57b2(0x229)]=_0x539862,_0x2e0891[_0x4e57b2(0x238)]=_0x2945bf,_0x2e0891[_0x4e57b2(0x1ed)]=_0x26b9cf,_0x2e0891[_0x4e57b2(0x1b5)]=_0x3df998;const _0xdfb71b=await _0x2e0891['save'](),_0x483f5f=await warehouse[_0x4e57b2(0x1ff)]({'name':_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x1c6)],'room':_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x24b)]});_0x2e0891[_0x4e57b2(0x155)][_0x4e57b2(0x261)](_0x2acb07=>{var _0x2ba273=_0x4e57b2,_0x3a45a6=0x0;const _0xbdc8d5=_0x483f5f[_0x2ba273(0x201)][_0x2ba273(0x166)](_0x27a5f4=>{var _0xa4032f=_0x2ba273;_0x27a5f4[_0xa4032f(0x17c)]==_0x2acb07[_0xa4032f(0x17c)]&&_0x27a5f4[_0xa4032f(0x1da)]==_0x2acb07[_0xa4032f(0x1da)]&&_0x27a5f4[_0xa4032f(0x165)]==_0x2acb07[_0xa4032f(0x165)]&&_0x27a5f4[_0xa4032f(0x264)]==_0x2acb07['bin']&&_0x27a5f4[_0xa4032f(0x1be)]==_0x2acb07[_0xa4032f(0x1be)]&&_0x27a5f4[_0xa4032f(0x1b9)]==_0x2acb07[_0xa4032f(0x1b9)]&&_0x27a5f4[_0xa4032f(0x260)]==_0x2acb07[_0xa4032f(0x260)]&&(_0x27a5f4[_0xa4032f(0x19a)]=parseInt(_0x27a5f4[_0xa4032f(0x19a)])+parseInt(_0x2acb07[_0xa4032f(0x1cd)]),_0x3a45a6++);});_0x3a45a6=='0'&&(_0x483f5f[_0x2ba273(0x201)]=_0x483f5f[_0x2ba273(0x201)]['concat']({'product_name':_0x2acb07[_0x2ba273(0x17c)],'product_stock':_0x2acb07[_0x2ba273(0x1cd)],'primary_code':_0x2acb07['primary_code'],'secondary_code':_0x2acb07[_0x2ba273(0x25b)],'product_code':_0x2acb07[_0x2ba273(0x14d)],'storage':_0x2acb07[_0x2ba273(0x260)],'rack':_0x2acb07[_0x2ba273(0x1b9)],'bay':_0x2acb07[_0x2ba273(0x1be)],'bin':_0x2acb07[_0x2ba273(0x264)],'type':_0x2acb07['type'],'floorlevel':_0x2acb07[_0x2ba273(0x1da)],'maxProducts':_0x2acb07[_0x2ba273(0x1d9)],'unit':_0x2acb07['standard_unit'],'secondary_unit':_0x2acb07[_0x2ba273(0x202)],'expiry_date':_0x2acb07['expiry_date']}));}),await _0x483f5f[_0x4e57b2(0x21a)]();const _0x2ca983=await s_payment_data[_0x4e57b2(0x1ff)]({'invoice':_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x183)]});if(_0x2ca983===null){}else console[_0x4e57b2(0x26b)]('suppliers',_0x2ca983,_0x430915['body'][_0x4e57b2(0x183)]),_0x2ca983[_0x4e57b2(0x19f)]=_0x430915[_0x4e57b2(0x1a2)][_0x4e57b2(0x19f)],await _0x2ca983[_0x4e57b2(0x21a)]();_0x430915[_0x4e57b2(0x1b2)](_0x4e57b2(0x1bb),_0x4e57b2(0x171)),_0x4083f5['redirect'](_0x4e57b2(0x177));}catch(_0x264baa){console['log'](_0x264baa);}}),router[a0_0x118c6b(0x192)](a0_0x118c6b(0x24f),auth,async(_0x4de6f3,_0x48b692)=>{var _0x16683c=a0_0x118c6b;try{const _0x52984c=_0x4de6f3['params']['id'],{invoice:_0x20b295,suppliers:_0x1274c5,payable:_0x984e4c,due_amount:_0x48e2f0}=_0x4de6f3[_0x16683c(0x1a2)],_0x4bbaa4=await purchases[_0x16683c(0x14f)](_0x52984c);var _0x3c637e=_0x984e4c-_0x48e2f0;_0x4bbaa4['paid_amount']=parseFloat(_0x4bbaa4[_0x16683c(0x1a0)])+parseFloat(_0x48e2f0),_0x4bbaa4[_0x16683c(0x229)]=_0x3c637e;const _0x51ef3a=await _0x4bbaa4[_0x16683c(0x21a)]();console['log'](_0x51ef3a);const _0x2c53aa=await s_payment_data['findOne']({'invoice':_0x20b295});_0x2c53aa['amount']=_0x3c637e,await _0x2c53aa['save']();let _0x3eb159=new Date(),_0x2f2bbf=('0'+_0x3eb159[_0x16683c(0x181)]())['slice'](-0x2),_0x158928=('0'+(_0x3eb159[_0x16683c(0x223)]()+0x1))[_0x16683c(0x259)](-0x2),_0x2d0f0f=_0x3eb159[_0x16683c(0x1a5)](),_0x4cd249=_0x2d0f0f+'-'+_0x158928+'-'+_0x2f2bbf;const _0x40dddb=new suppliers_payment({'invoice':_0x20b295,'date':_0x2d0f0f+'-'+_0x158928+'-'+_0x2f2bbf,'suppliers':_0x1274c5,'reason':_0x16683c(0x1d1),'amount':_0x48e2f0}),_0x3eb83e=await _0x40dddb[_0x16683c(0x21a)]();_0x4de6f3['flash'](_0x16683c(0x1bb),_0x16683c(0x212)),_0x48b692['redirect'](_0x16683c(0x177));}catch(_0x5f598a){console[_0x16683c(0x26b)](_0x5f598a);}}),router[a0_0x118c6b(0x20b)](a0_0x118c6b(0x1d6),auth,async(_0x1d71dc,_0xcf3f13)=>{var _0x349aee=a0_0x118c6b;try{const {username:_0x35ec80,email:_0x26e14b,role:_0x3309ea}=_0x1d71dc['user'],_0x4420e0=_0x1d71dc[_0x349aee(0x246)],_0x156419=await profile[_0x349aee(0x1ff)]({'email':_0x4420e0[_0x349aee(0x1c0)]}),_0x3248b0=await master_shop[_0x349aee(0x22c)]();console[_0x349aee(0x26b)](_0x349aee(0x16e),_0x3248b0);const _0x320d8a=_0x1d71dc[_0x349aee(0x1b6)]['id'],_0x16220f=await purchases[_0x349aee(0x14f)](_0x320d8a);console['log'](_0x16220f);const _0x37a692=await suppliers[_0x349aee(0x1ff)]({'name':_0x16220f['suppliers']});console[_0x349aee(0x26b)](_0x37a692);if(_0x3248b0[0x0][_0x349aee(0x1db)]==_0x349aee(0x227)){var _0x1363bf=users[_0x349aee(0x24a)];console[_0x349aee(0x26b)](_0x1363bf);}else{if(_0x3248b0[0x0]['language']==_0x349aee(0x207))var _0x1363bf=users[_0x349aee(0x207)];else{if(_0x3248b0[0x0][_0x349aee(0x1db)]==_0x349aee(0x188))var _0x1363bf=users[_0x349aee(0x188)];else{if(_0x3248b0[0x0][_0x349aee(0x1db)]==_0x349aee(0x1c5))var _0x1363bf=users[_0x349aee(0x1c5)];else{if(_0x3248b0[0x0]['language']==_0x349aee(0x218))var _0x1363bf=users['French'];else{if(_0x3248b0[0x0]['language']==_0x349aee(0x225))var _0x1363bf=users[_0x349aee(0x233)];else{if(_0x3248b0[0x0][_0x349aee(0x1db)]==_0x349aee(0x151))var _0x1363bf=users[_0x349aee(0x151)];else{if(_0x3248b0[0x0]['language']==_0x349aee(0x18c))var _0x1363bf=users['Arabic'];}}}}}}}_0xcf3f13[_0x349aee(0x1e1)]('purchase_invoice',{'success':_0x1d71dc['flash'](_0x349aee(0x1bb)),'errors':_0x1d71dc[_0x349aee(0x1b2)]('errors'),'role':_0x4420e0,'profile':_0x156419,'master_shop':_0x3248b0,'supplier':_0x37a692,'purchase':_0x16220f,'language':_0x1363bf});}catch(_0x1ea6bd){console[_0x349aee(0x26b)](_0x1ea6bd);}}),router['get'](a0_0x118c6b(0x21f),auth,async(_0x4831f7,_0x102b91)=>{var _0x50bd57=a0_0x118c6b;try{const {username:_0x9087fe,email:_0x30d97f,role:_0x93135}=_0x4831f7[_0x50bd57(0x246)],_0x1f1daf=_0x4831f7[_0x50bd57(0x246)],_0x9f8190=await profile[_0x50bd57(0x1ff)]({'email':_0x1f1daf[_0x50bd57(0x1c0)]}),_0x12a3e6=await master_shop[_0x50bd57(0x22c)]();console[_0x50bd57(0x26b)]('master',_0x12a3e6);const _0x588b3a=_0x4831f7[_0x50bd57(0x1b6)]['id'];console[_0x50bd57(0x26b)](_0x588b3a);const _0x396ded=await purchases[_0x50bd57(0x14f)](_0x588b3a);console['log'](_0x50bd57(0x184),_0x396ded);const _0x2bf999=await product['find']({}),_0x468e81=await warehouse[_0x50bd57(0x1f5)]([{'$match':{'name':_0x396ded[_0x50bd57(0x1c6)],'room':_0x396ded[_0x50bd57(0x238)],'warehouse_category':_0x50bd57(0x211)}},{'$unwind':_0x50bd57(0x262)},{'$group':{'_id':_0x50bd57(0x1f7),'name':{'$first':_0x50bd57(0x18a)},'product_stock':{'$first':_0x50bd57(0x1cf)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x50bd57(0x224)},'type':{'$first':_0x50bd57(0x204)},'floorlevel':{'$first':_0x50bd57(0x176)},'primary_code':{'$first':_0x50bd57(0x187)},'secondary_code':{'$first':_0x50bd57(0x269)},'product_code':{'$first':_0x50bd57(0x1f8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x50bd57(0x1bd)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x50bd57(0x22f),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x50bd57(0x1c9),'name':{'$first':_0x50bd57(0x1c9)}}},{'$sort':{'name':0x1}}]),console[_0x50bd57(0x26b)](_0x50bd57(0x17f),_0x468e81);if(_0x12a3e6[0x0][_0x50bd57(0x1db)]==_0x50bd57(0x227)){var _0x1010e9=users[_0x50bd57(0x24a)];console[_0x50bd57(0x26b)](_0x1010e9);}else{if(_0x12a3e6[0x0][_0x50bd57(0x1db)]==_0x50bd57(0x207))var _0x1010e9=users['Hindi'];else{if(_0x12a3e6[0x0]['language']=='German')var _0x1010e9=users[_0x50bd57(0x188)];else{if(_0x12a3e6[0x0][_0x50bd57(0x1db)]==_0x50bd57(0x1c5))var _0x1010e9=users[_0x50bd57(0x1c5)];else{if(_0x12a3e6[0x0]['language']=='French')var _0x1010e9=users[_0x50bd57(0x218)];else{if(_0x12a3e6[0x0][_0x50bd57(0x1db)]==_0x50bd57(0x225))var _0x1010e9=users[_0x50bd57(0x233)];else{if(_0x12a3e6[0x0][_0x50bd57(0x1db)]==_0x50bd57(0x151))var _0x1010e9=users[_0x50bd57(0x151)];else{if(_0x12a3e6[0x0]['language']==_0x50bd57(0x18c))var _0x1010e9=users['Arabic'];}}}}}}}_0x102b91[_0x50bd57(0x1e1)](_0x50bd57(0x243),{'success':_0x4831f7[_0x50bd57(0x1b2)](_0x50bd57(0x1bb)),'errors':_0x4831f7[_0x50bd57(0x1b2)](_0x50bd57(0x1c1)),'role':_0x1f1daf,'profile':_0x9f8190,'user':_0x396ded,'stock':_0x468e81,'master_shop':_0x12a3e6,'product':_0x2bf999,'language':_0x1010e9,'warehouse':warehouse_data});}catch(_0x3039df){console['log'](_0x3039df);}}),router[a0_0x118c6b(0x192)](a0_0x118c6b(0x21f),auth,async(_0x52b50b,_0x4a372c)=>{var _0x1b2fe0=a0_0x118c6b;try{const {invoice:_0x4e28c0,date:_0x5bbfb8,warehouse_name:_0x1f8003,Room_name:_0x2794c6,product_name:_0x46f0b4,purchase_quantity:_0x3c1173,stocks:_0x3b341f,return_qty:_0x4b6bdd,note:_0x161f7c,level:_0x3887ea,isle:_0x5c2489,pallet:_0x24640c,to_warehouse_name:_0x3bfd1d,to_Room_name:_0x322499}=_0x52b50b[_0x1b2fe0(0x1a2)],_0x2e1ada=await purchases['findOne']({'_id':_0x52b50b[_0x1b2fe0(0x1b6)]['id']}),_0x1db336=await warehouse[_0x1b2fe0(0x1ff)]({'name':_0x1f8003,'room':_0x2794c6});if(typeof _0x46f0b4=='string')var _0x229693=[_0x52b50b['body'][_0x1b2fe0(0x17c)]],_0x7677cc=[_0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x175)]],_0x442a3c=[_0x52b50b['body'][_0x1b2fe0(0x16d)]],_0xf24351=[_0x52b50b['body']['return_qty']],_0x2f533f=[_0x52b50b['body'][_0x1b2fe0(0x1d0)]],_0x33ec66=[_0x52b50b[_0x1b2fe0(0x1a2)]['isle']],_0x433640=[_0x52b50b[_0x1b2fe0(0x1a2)]['pallet']],_0x57a136=[_0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1df)]],_0x4d398f=[_0x52b50b['body']['product_code_hide']],_0x12ca64=[_0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1f6)]],_0x5cb052=[_0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1dc)]];else var _0x229693=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x17c)]],_0x7677cc=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x175)]],_0x442a3c=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x16d)]],_0xf24351=[..._0x52b50b['body'][_0x1b2fe0(0x1eb)]],_0x2f533f=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1d0)]],_0x33ec66=[..._0x52b50b[_0x1b2fe0(0x1a2)]['isle']],_0x433640=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x25d)]],_0x57a136=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1df)]],_0x4d398f=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1c4)]],_0x12ca64=[..._0x52b50b[_0x1b2fe0(0x1a2)]['primary_code_hide']],_0x5cb052=[..._0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x1dc)]];const _0x23c462=_0x229693['map'](_0x36f3bd=>{return _0x36f3bd={'product_name':_0x36f3bd};});_0x7677cc[_0x1b2fe0(0x261)]((_0x5726a0,_0x4d7c37)=>{var _0x471c59=_0x1b2fe0;_0x23c462[_0x4d7c37][_0x471c59(0x175)]=_0x5726a0;}),_0x442a3c[_0x1b2fe0(0x261)]((_0xa61adc,_0x2cdd03)=>{var _0x4e85c7=_0x1b2fe0;_0x23c462[_0x2cdd03][_0x4e85c7(0x220)]=_0xa61adc;}),_0xf24351['forEach']((_0x2cc22e,_0x568733)=>{_0x23c462[_0x568733]['return_qty']=_0x2cc22e;}),_0x2f533f[_0x1b2fe0(0x261)]((_0x30ebc4,_0x4d2cf8)=>{var _0x58a596=_0x1b2fe0;_0x23c462[_0x4d2cf8][_0x58a596(0x1be)]=_0x30ebc4;}),_0x33ec66[_0x1b2fe0(0x261)]((_0x5d9017,_0x544e90)=>{var _0x2332ce=_0x1b2fe0;_0x23c462[_0x544e90][_0x2332ce(0x264)]=_0x5d9017;}),_0x433640['forEach']((_0xc70f1c,_0xe90878)=>{var _0xebacb2=_0x1b2fe0;_0x23c462[_0xe90878][_0xebacb2(0x1da)]=_0xc70f1c;}),_0x57a136[_0x1b2fe0(0x261)]((_0x518a73,_0x4810ff)=>{var _0x84211e=_0x1b2fe0;_0x23c462[_0x4810ff][_0x84211e(0x165)]=_0x518a73;}),_0x4d398f['forEach']((_0xc28fa6,_0x4b2cca)=>{_0x23c462[_0x4b2cca]['product_code']=_0xc28fa6;}),_0x12ca64['forEach']((_0x4a4ccd,_0x310055)=>{var _0x44d77f=_0x1b2fe0;_0x23c462[_0x310055][_0x44d77f(0x213)]=_0x4a4ccd;}),_0x5cb052[_0x1b2fe0(0x261)]((_0x44a988,_0x2f3801)=>{var _0x4c679e=_0x1b2fe0;_0x23c462[_0x2f3801][_0x4c679e(0x25b)]=_0x44a988;}),_0x2e1ada['product'][_0x1b2fe0(0x261)](_0x3ef730=>{var _0x2e9713=_0x1b2fe0;const _0x54f7d3=_0x1db336[_0x2e9713(0x201)][_0x2e9713(0x166)](_0x430ff9=>{var _0x148cf6=_0x2e9713;_0x430ff9[_0x148cf6(0x17c)]==_0x3ef730[_0x148cf6(0x17c)]&&_0x430ff9[_0x148cf6(0x1da)]==_0x3ef730[_0x148cf6(0x1da)]&&_0x430ff9['type']==_0x3ef730[_0x148cf6(0x165)]&&_0x430ff9[_0x148cf6(0x264)]==_0x3ef730[_0x148cf6(0x264)]&&_0x430ff9[_0x148cf6(0x1be)]==_0x3ef730[_0x148cf6(0x1be)]&&_0x430ff9[_0x148cf6(0x1b9)]==_0x3ef730[_0x148cf6(0x1b9)]&&_0x430ff9[_0x148cf6(0x260)]==_0x3ef730[_0x148cf6(0x260)]&&(console[_0x148cf6(0x26b)](parseInt(_0x430ff9['product_stock'])+'\x20<>\x20'+parseInt(_0x3ef730['quantity'])),_0x430ff9['product_stock']=parseInt(_0x430ff9[_0x148cf6(0x19a)])+parseInt(_0x3ef730[_0x148cf6(0x1cd)]));});}),await _0x1db336[_0x1b2fe0(0x21a)]();const _0xfffe6b=_0x23c462[_0x1b2fe0(0x15f)](_0x29b3cf=>_0x29b3cf['return_qty']!=='0'&&_0x29b3cf[_0x1b2fe0(0x1eb)]!=='');var _0x1e11fe=0x0;_0xfffe6b['forEach'](_0x115bfc=>{var _0x5ee26e=_0x1b2fe0;console[_0x5ee26e(0x26b)]('foreach\x20newproduct',_0x115bfc),(parseInt(_0x115bfc['purchase_quantity'])<parseInt(_0x115bfc[_0x5ee26e(0x1eb)])||parseInt(_0x115bfc[_0x5ee26e(0x220)])<parseInt(_0x115bfc[_0x5ee26e(0x1eb)]))&&_0x1e11fe++;});if(_0x1e11fe!=0x0)return _0x52b50b['flash'](_0x1b2fe0(0x1c1),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4a372c[_0x1b2fe0(0x17d)](_0x1b2fe0(0x1e7));const _0x577897=new purchases_return({'invoice':_0x4e28c0,'suppliers':_0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x19f)],'date':_0x5bbfb8,'warehouse_name':_0x1f8003,'return_product':_0xfffe6b,'note':_0x161f7c,'room':_0x2794c6,'to_warehouse_name':_0x3bfd1d,'to_room':_0x322499}),_0x4bb3f8=await _0x577897[_0x1b2fe0(0x21a)]();console[_0x1b2fe0(0x26b)](_0x577897);const _0x2deb46=await purchases_return[_0x1b2fe0(0x1ff)]({'invoice':_0x4e28c0}),_0xdbeb26=await warehouse[_0x1b2fe0(0x1ff)]({'name':_0x3bfd1d,'room':_0x322499});_0x2deb46[_0x1b2fe0(0x169)][_0x1b2fe0(0x261)](_0x3eecf1=>{var _0x3587e4=_0x1b2fe0,_0x1dc40f=0x0;const _0x4cfed9=_0xdbeb26['product_details'][_0x3587e4(0x166)](_0x3b0666=>{var _0x299a02=_0x3587e4;_0x3b0666[_0x299a02(0x17c)]==_0x3eecf1[_0x299a02(0x17c)]&&_0x3b0666[_0x299a02(0x1da)]==_0x3eecf1[_0x299a02(0x1da)]&&_0x3b0666['type']==_0x3eecf1[_0x299a02(0x165)]&&_0x3b0666['bin']==_0x3eecf1['bin']&&_0x3b0666[_0x299a02(0x1be)]==_0x3eecf1[_0x299a02(0x1be)]&&(_0x3b0666[_0x299a02(0x19a)]=parseInt(_0x3b0666[_0x299a02(0x19a)])-parseInt(_0x3eecf1[_0x299a02(0x1eb)]),_0x1dc40f++);});_0x1dc40f=='0'&&(_0xdbeb26['product_details']=_0xdbeb26[_0x3587e4(0x201)]['concat']({'product_name':_0x3eecf1[_0x3587e4(0x17c)],'product_stock':_0x3eecf1[_0x3587e4(0x1eb)],'primary_code':_0x3eecf1[_0x3587e4(0x213)],'secondary_code':_0x3eecf1[_0x3587e4(0x25b)],'product_code':_0x3eecf1['product_code'],'storage':_0x3eecf1[_0x3587e4(0x260)],'rack':_0x3eecf1['rack'],'bay':_0x3eecf1[_0x3587e4(0x1be)],'bin':_0x3eecf1[_0x3587e4(0x264)],'type':_0x3eecf1['type'],'floorlevel':_0x3eecf1[_0x3587e4(0x1da)],'maxProducts':_0x3eecf1['maxStocks'],'unit':_0x3eecf1[_0x3587e4(0x1e2)],'secondary_unit':_0x3eecf1[_0x3587e4(0x202)],'expiry_date':_0x3eecf1[_0x3587e4(0x22b)]}));}),await _0xdbeb26['save']();const _0x5ac5a5=await purchases[_0x1b2fe0(0x1ff)]({'invoice':_0x4e28c0});_0x5ac5a5[_0x1b2fe0(0x25f)]=_0x1b2fe0(0x272);const _0x292a65=await _0x5ac5a5[_0x1b2fe0(0x21a)](),_0x138f0e=new s_payment_data({'invoice':_0x4e28c0,'suppliers':_0x52b50b['body'][_0x1b2fe0(0x19f)],'reason':_0x1b2fe0(0x253)});await _0x138f0e[_0x1b2fe0(0x21a)]();const _0x72acb7=await master_shop[_0x1b2fe0(0x22c)]();console[_0x1b2fe0(0x26b)](_0x1b2fe0(0x18e),_0x72acb7[0x0]['image']);const _0x15b5d2=await email_settings[_0x1b2fe0(0x1ff)](),_0x5149a0=await suppliers['findOne']({'name':_0x52b50b[_0x1b2fe0(0x1a2)][_0x1b2fe0(0x19f)]});console['log'](_0x1b2fe0(0x26d),_0x5149a0);_0x72acb7[0x0]['currency_placement']==0x1?(right_currency=_0x72acb7[0x0][_0x1b2fe0(0x1b8)],left_currency=''):(right_currency='',left_currency=_0x72acb7[0x0][_0x1b2fe0(0x1b8)]);var _0x2e62c9=_0x229693,_0x499141=_0xf24351,_0x34f350='',_0x4e24ce;for(_0x4e24ce in _0x2e62c9){_0x34f350+=_0x1b2fe0(0x19c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e62c9[_0x4e24ce]+_0x1b2fe0(0x26a)+_0x1b2fe0(0x16b)+_0x499141[_0x4e24ce]+_0x1b2fe0(0x26a)+_0x1b2fe0(0x1ac);}console[_0x1b2fe0(0x26b)]('product_list',_0x34f350);let _0xa0df48=nodemailer[_0x1b2fe0(0x159)]({'service':_0x1b2fe0(0x182),'auth':{'user':_0x15b5d2['email'],'pass':_0x15b5d2[_0x1b2fe0(0x1e8)]}}),_0x1a4fc9={'from':_0x15b5d2['email'],'to':_0x5149a0[_0x1b2fe0(0x1c0)],'subject':_0x1b2fe0(0x157),'attachments':[{'filename':_0x1b2fe0(0x200),'path':__dirname+'/../public'+_0x1b2fe0(0x1e5)+_0x72acb7[0x0][_0x1b2fe0(0x219)],'cid':_0x1b2fe0(0x26f)}],'html':_0x1b2fe0(0x1f3)+_0x1b2fe0(0x16a)+_0x1b2fe0(0x230)+'<div>'+_0x1b2fe0(0x1b4)+_0x1b2fe0(0x190)+_0x1b2fe0(0x196)+_0x1b2fe0(0x195)+'<div>'+_0x1b2fe0(0x1ce)+_0x72acb7[0x0][_0x1b2fe0(0x1ba)]+_0x1b2fe0(0x258)+_0x1b2fe0(0x195)+_0x1b2fe0(0x195)+'<hr\x20class=\x22my-3\x22>'+_0x1b2fe0(0x190)+_0x1b2fe0(0x23a)+_0x1b2fe0(0x23c)+_0x4e28c0+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1b2fe0(0x186)+_0x5bbfb8+'\x20'+_0x1b2fe0(0x1e6)+_0x1b2fe0(0x20f)+_0x1b2fe0(0x195)+_0x1b2fe0(0x1dd)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1b2fe0(0x236)+_0x1b2fe0(0x180)+_0x1b2fe0(0x15a)+_0x1b2fe0(0x1ac)+_0x1b2fe0(0x189)+_0x1b2fe0(0x252)+'\x20'+_0x34f350+'\x20'+_0x1b2fe0(0x15e)+_0x1b2fe0(0x203)+_0x1b2fe0(0x190)+'<strong>\x20Regards\x20</strong>'+_0x1b2fe0(0x1f9)+_0x72acb7[0x0][_0x1b2fe0(0x1ba)]+_0x1b2fe0(0x20f)+_0x1b2fe0(0x195)+_0x1b2fe0(0x195)+_0x1b2fe0(0x1ec)};_0xa0df48[_0x1b2fe0(0x1ab)](_0x1a4fc9,function(_0x51b7d6,_0x394d30){var _0x2c9897=_0x1b2fe0;_0x51b7d6?(console[_0x2c9897(0x26b)](_0x51b7d6),console[_0x2c9897(0x26b)](_0x2c9897(0x16f))):console[_0x2c9897(0x26b)](_0x2c9897(0x199));}),_0x52b50b[_0x1b2fe0(0x1b2)]('success','purchases\x20item\x20return\x20successfull'),_0x4a372c[_0x1b2fe0(0x17d)](_0x1b2fe0(0x177));}catch(_0x3e266d){console[_0x1b2fe0(0x26b)](_0x3e266d),_0x4a372c[_0x1b2fe0(0x15c)](0xc8)['json']({'message':_0x3e266d['message']});}}),router[a0_0x118c6b(0x20b)](a0_0x118c6b(0x21e),auth,async(_0x286ad6,_0x5448b3)=>{var _0x4309ac=a0_0x118c6b;try{const {username:_0x109065,email:_0x1d4247,role:_0x3fd32e}=_0x286ad6[_0x4309ac(0x246)],_0x16766c=_0x286ad6[_0x4309ac(0x246)],_0x50db6c=await profile[_0x4309ac(0x1ff)]({'email':_0x16766c[_0x4309ac(0x1c0)]}),_0x28e3cf=await master_shop[_0x4309ac(0x22c)](),_0x5a8509=_0x286ad6['params']['id'],_0x56f3c7=await purchases[_0x4309ac(0x14f)](_0x5a8509);if(_0x28e3cf[0x0][_0x4309ac(0x1db)]==_0x4309ac(0x227))var _0x38eb5f=users['English'];else{if(_0x28e3cf[0x0]['language']==_0x4309ac(0x207))var _0x38eb5f=users[_0x4309ac(0x207)];else{if(_0x28e3cf[0x0][_0x4309ac(0x1db)]=='German')var _0x38eb5f=users[_0x4309ac(0x188)];else{if(_0x28e3cf[0x0][_0x4309ac(0x1db)]==_0x4309ac(0x1c5))var _0x38eb5f=users['Spanish'];else{if(_0x28e3cf[0x0][_0x4309ac(0x1db)]==_0x4309ac(0x218))var _0x38eb5f=users[_0x4309ac(0x218)];else{if(_0x28e3cf[0x0][_0x4309ac(0x1db)]==_0x4309ac(0x225))var _0x38eb5f=users['Portuguese'];else{if(_0x28e3cf[0x0][_0x4309ac(0x1db)]==_0x4309ac(0x151))var _0x38eb5f=users[_0x4309ac(0x151)];else{if(_0x28e3cf[0x0]['language']==_0x4309ac(0x18c))var _0x38eb5f=users[_0x4309ac(0x248)];}}}}}}}_0x5448b3[_0x4309ac(0x1e1)]('all_purchases_barcode',{'success':_0x286ad6[_0x4309ac(0x1b2)](_0x4309ac(0x1bb)),'errors':_0x286ad6[_0x4309ac(0x1b2)](_0x4309ac(0x1c1)),'role':_0x16766c,'profile':_0x50db6c,'alldata':_0x56f3c7,'master_shop':_0x28e3cf,'language':_0x38eb5f}),console[_0x4309ac(0x26b)](alldata);}catch(_0x3f86f9){console[_0x4309ac(0x26b)](_0x3f86f9);}}),router[a0_0x118c6b(0x192)](a0_0x118c6b(0x1cb),async(_0x1fb214,_0x4deb04)=>{var _0x1b53be=a0_0x118c6b;const {product_code:_0x113c1c}=_0x1fb214[_0x1b53be(0x1a2)];var _0x7990bb;const _0x1c90bd=await product['aggregate']([{'$match':{'primary_code':_0x113c1c,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x1b53be(0x1c9)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x1b53be(0x263)},'alertquantity':{'$first':_0x1b53be(0x234)},'product_code':{'$first':_0x1b53be(0x178)},'primary_code':{'$first':_0x1b53be(0x26c)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1b53be(0x255)},'maxProdPerUnit':{'$first':_0x1b53be(0x1d5)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3b052e=await product[_0x1b53be(0x1f5)]([{'$match':{'secondary_code':_0x113c1c,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1b53be(0x17e),'name':{'$first':_0x1b53be(0x1c9)},'category':{'$first':_0x1b53be(0x1e3)},'brand':{'$first':'$brand'},'unit':{'$first':_0x1b53be(0x263)},'alertquantity':{'$first':_0x1b53be(0x234)},'product_code':{'$first':_0x1b53be(0x178)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x1b53be(0x247)},'maxStocks':{'$first':_0x1b53be(0x255)},'maxProdPerUnit':{'$first':_0x1b53be(0x1d5)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1b53be(0x164)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1c90bd[_0x1b53be(0x235)]>0x0)_0x7990bb=_0x1c90bd;else _0x3b052e[_0x1b53be(0x235)]>0x0&&(_0x7990bb=_0x3b052e);_0x4deb04[_0x1b53be(0x23e)](_0x7990bb);}),router[a0_0x118c6b(0x192)]('/CheckingWarehouse',async(_0x580006,_0x3230f7)=>{var _0x2719c5=a0_0x118c6b;const {primaryCode:_0x3f65df,secondaryCode:_0x111562,productCode:_0x1e8d15,bay:_0x45b041,bin:_0x168a99,types:_0x31f050,pallet:_0xec45ea,warehouses:_0x3a3279,room:_0x253e72}=_0x580006['body'];console[_0x2719c5(0x26b)](_0x580006[_0x2719c5(0x1a2)]);try{const _0x109521=await warehouse[_0x2719c5(0x1f5)]([{'$match':{'name':_0x3a3279,'room':_0x253e72}},{'$unwind':_0x2719c5(0x262)},{'$match':{'product_details.bay':_0x45b041,'product_details.bin':_0x168a99,'product_details.type':_0x31f050}},{'$group':{'_id':_0x2719c5(0x1f7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2719c5(0x1cf)},'level':{'$first':_0x2719c5(0x221)},'isle':{'$first':_0x2719c5(0x25e)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3230f7[_0x2719c5(0x15c)](0xc8)[_0x2719c5(0x23e)](_0x109521);}catch(_0x57cc11){_0x3230f7[_0x2719c5(0x15c)](0x194)[_0x2719c5(0x23e)]({'message':_0x57cc11[_0x2719c5(0x18b)]});}}),module[a0_0x118c6b(0x154)]=router;