function a0_0x2993(){var _0x975dae=['exports','An\x20error\x20occurred.','invoice','$suppliers','$product_details.floorlevel','English\x20(US)','date_data','Logo.png','getDate','get','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','prod_isle','port','findById','getFullYear','/upload/','suppliers','$_id','14583VjjGvd','error','prod_pallet','$product_details.bin','product_cat','secondary_code','stock_quantity','Receiving\x20Area','json','$product_code','standard_unit','$expiry_date','floorlevel','$product.bin','prod_qty','product_details','actual_qty','add_purchases','<h5\x20style=\x22text-align:\x20left;\x22>','$maxStocks','JO_number','$invoice','Paid\x20For\x20Purchase','abs','role','Enabled','20272CZZBzV','warehouse','German','$return_data','<span\x20style=\x22float:\x20right;\x22>','<hr\x20class=\x22my-3\x22>','$paid_amount','Return\x20Goods','actual_uom','/all_purchases/view','prod_Qty','/barcode/:id','delivery_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_code','getMonth','$batch_code','room','DRY\x20STORAGE','Hindi','/view/:id','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product.quantity','/barcode_scanner','$product_details.storage','$product_details.product_stock','$warehouse_name','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','gmail','forEach','due_amount','batch_code','product_stock','logo','slice','/give_payment/:id','../middleware/auth','max_product_unit','\x20<>\x20','</tbody>','INC-','push','POnumber','bin','maxperunit','prod_level','prod_primunit','product_list','edit_purchases_view','concat','$name','product_code_hide','$product_details.isle','user_id','prod_cat','return_purchase','save','<html><head><title></title>','$product_details.level','Purchase\x20data\x20added\x20successfully','Ambient','Purchase\x20Return','language','currency','Portuguese\x20(BR)','purchase\x20data\x20update\x20successfully','Portuguese','date','Shelves','pallet','497779GJtTJR','paid_amount','delivery_date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','flash','</td>','currency_placement','<table\x20style=\x22width:\x20100%\x20!important;\x22>','storage','/../public','\x20Order\x20Number\x20:\x20','Floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','here','room_name','post','$secondary_unit','password','secondary_unit','log','name','deliverydate','primary_code','17115ClDAcM','$secondary_code','/view/add_purchases','Error\x20Occurs','Chinese','True','Arabic\x20(ae)','expiry_date','412HOQmfw','add\x20post','prod_secondunit','</span>','<h5>','$category','Email\x20sent\x20successfully','prod_invoice','return_qty','random','findOne','$product_details','$product_details.product_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','back','length','<tbody\x20style=\x22text-align:\x20center;\x22>','product_name','Rack\x20B','$product_details._id','return_product','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','rack','<!DOCTYPE\x20html>','find','catch','success','rak','prod_unit','add_purchases\x20error','all_purchases','3010860VYAgTE','$product_details.rack','$product.type','Level','</thead>','type','filter','132300RSGiSA','Enclosed','$alertquantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','3639726zZOUES','MaxStocks_data','product_code','../public/language/languages.json','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.bay','$date','../models/all_models','deliverycode','suppliers_docs','<tr>','types','email','/preview/:id','string','product','image','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','RMSEmail','$primary_code','prod_name','params','quantity','$product.room_name','note','/view','$product','106CjaILz','message','maxStocks','$product_details.pallet','sendMail','isle','Raw\x20Materials','redirect','French','$product.bay','RoomAssign','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','body','toString','then','purchase_quantity','$maxProdPerUnit','nodemailer','primary_code_hide','Spanish','render','Arabic','$room','$note','/CheckingWarehouse','$product_details.type','</div>','/view/return_purchase/:id','warehouse_name','/view/add_purchases/:id','stocks','host','purchase_invoice','$due_amount','<strong>\x20Regards\x20</strong>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','map','edit_purchases','</table>','bay','secondary_code_hide','table\x20page','</tr>','user','site_title','\x20</h2>','$product_details.maxProducts','$product_details.product_name','createTransport','stock_data','errors','alertQTY','$unit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','status','</h5>','Purchase\x20Return\x20Mail','express','suppliers_data','master','padStart','$product_details.primary_code','<h2>\x20','Rack\x20D','<div>','$suppliers_docs','Rack\x20A','production_date','level'];a0_0x2993=function(){return _0x975dae;};return a0_0x2993();}var a0_0x2c46bb=a0_0x4e7f;(function(_0x4f2651,_0x8ade07){var _0x412328=a0_0x4e7f,_0x56cb57=_0x4f2651();while(!![]){try{var _0x2c4915=-parseInt(_0x412328(0x11b))/0x1+-parseInt(_0x412328(0x182))/0x2*(-parseInt(_0x412328(0xb9))/0x3)+-parseInt(_0x412328(0x13a))/0x4*(parseInt(_0x412328(0x132))/0x5)+parseInt(_0x412328(0x15a))/0x6+-parseInt(_0x412328(0x161))/0x7+-parseInt(_0x412328(0xd3))/0x8+parseInt(_0x412328(0x165))/0x9;if(_0x2c4915===_0x8ade07)break;else _0x56cb57['push'](_0x56cb57['shift']());}catch(_0x15633a){_0x56cb57['push'](_0x56cb57['shift']());}}}(a0_0x2993,0x474eb));const express=require(a0_0x2c46bb(0x9a)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2c46bb(0x16d)),auth=require(a0_0x2c46bb(0xf9)),nodemailer=require(a0_0x2c46bb(0x193));var ejs=require('ejs');const path=require('path'),users=require(a0_0x2c46bb(0x168));router[a0_0x2c46bb(0xaf)](a0_0x2c46bb(0x180),auth,async(_0x27295f,_0x4baeb0)=>{var _0x58d5e2=a0_0x2c46bb;try{const {username:_0x33a3d8,email:_0x23094c,role:_0x555ce0}=_0x27295f['user'],_0x233a15=_0x27295f[_0x58d5e2(0x1ad)],_0x5b1d80=await profile['findOne']({'email':_0x233a15[_0x58d5e2(0x172)]}),_0x511858=await staff[_0x58d5e2(0x144)]({'email':_0x233a15['email']});if(_0x233a15['role']==_0x58d5e2(0xb0)){const _0x565030=await staff['findOne']({'email':_0x233a15['email']});}const _0x121a5a=await master_shop[_0x58d5e2(0x153)]();let _0x351e29;if(_0x233a15[_0x58d5e2(0xd1)]==_0x58d5e2(0xb0)){const _0x25f1f4=await staff[_0x58d5e2(0x144)]({'email':_0x233a15['email']});_0x351e29=await purchases[_0x58d5e2(0x14f)]([{'$match':{'warehouse_name':_0x25f1f4[_0x58d5e2(0xd4)]}},{'$lookup':{'from':'suppliers','localField':_0x58d5e2(0xb7),'foreignField':_0x58d5e2(0x12f),'as':_0x58d5e2(0x16f)}},{'$unwind':_0x58d5e2(0xa2)},{'$unwind':'$product'},{'$group':{'_id':_0x58d5e2(0xb8),'invoice':{'$first':_0x58d5e2(0xce)},'suppliers':{'$first':_0x58d5e2(0xa9)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x58d5e2(0xee)},'room':{'$first':_0x58d5e2(0x198)},'product':{'$push':_0x58d5e2(0x181)},'note':{'$first':_0x58d5e2(0x199)},'paid_amount':{'$first':_0x58d5e2(0xd9)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x58d5e2(0xd6)},'batch_code':{'$first':_0x58d5e2(0xe3)},'expiry_date':{'$first':_0x58d5e2(0xc4)},'suppliers_docs':{'$first':_0x58d5e2(0xa2)},'total_product_quantity':{'$sum':_0x58d5e2(0xea)},'level':{'$addToSet':_0x58d5e2(0x18b)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x58d5e2(0x15c)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x351e29=await purchases['aggregate']([{'$lookup':{'from':_0x58d5e2(0xb7),'localField':_0x58d5e2(0xb7),'foreignField':_0x58d5e2(0x12f),'as':_0x58d5e2(0x16f)}},{'$unwind':_0x58d5e2(0xa2)},{'$unwind':_0x58d5e2(0x181)},{'$group':{'_id':'$_id','invoice':{'$first':_0x58d5e2(0xce)},'suppliers':{'$first':_0x58d5e2(0xa9)},'date':{'$first':_0x58d5e2(0x16c)},'warehouse_name':{'$first':_0x58d5e2(0xee)},'room':{'$addToSet':_0x58d5e2(0x17e)},'product':{'$push':_0x58d5e2(0x181)},'note':{'$first':_0x58d5e2(0x199)},'paid_amount':{'$first':_0x58d5e2(0xd9)},'due_amount':{'$first':_0x58d5e2(0x1a3)},'return_data':{'$first':_0x58d5e2(0xd6)},'batch_code':{'$first':_0x58d5e2(0xe3)},'expiry_date':{'$first':_0x58d5e2(0xc4)},'suppliers_docs':{'$first':_0x58d5e2(0xa2)},'total_product_quantity':{'$sum':_0x58d5e2(0xea)},'level':{'$addToSet':_0x58d5e2(0x18b)},'isle':{'$addToSet':_0x58d5e2(0xc6)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x121a5a[0x0][_0x58d5e2(0x113)]==_0x58d5e2(0xab)){var _0x53a679=users[_0x58d5e2(0x169)];console[_0x58d5e2(0x12e)](_0x53a679);}else{if(_0x121a5a[0x0][_0x58d5e2(0x113)]==_0x58d5e2(0xe6))var _0x53a679=users[_0x58d5e2(0xe6)];else{if(_0x121a5a[0x0][_0x58d5e2(0x113)]==_0x58d5e2(0xd5))var _0x53a679=users[_0x58d5e2(0xd5)];else{if(_0x121a5a[0x0][_0x58d5e2(0x113)]==_0x58d5e2(0x195))var _0x53a679=users[_0x58d5e2(0x195)];else{if(_0x121a5a[0x0]['language']==_0x58d5e2(0x18a))var _0x53a679=users['French'];else{if(_0x121a5a[0x0][_0x58d5e2(0x113)]==_0x58d5e2(0x115))var _0x53a679=users[_0x58d5e2(0x117)];else{if(_0x121a5a[0x0][_0x58d5e2(0x113)]==_0x58d5e2(0x136))var _0x53a679=users[_0x58d5e2(0x136)];else{if(_0x121a5a[0x0][_0x58d5e2(0x113)]=='Arabic\x20(ae)')var _0x53a679=users[_0x58d5e2(0x197)];}}}}}}}_0x4baeb0['render'](_0x58d5e2(0x159),{'success':_0x27295f['flash'](_0x58d5e2(0x155)),'errors':_0x27295f[_0x58d5e2(0x11f)]('errors'),'purchases':_0x351e29,'role':_0x233a15,'profile':_0x5b1d80,'master_shop':_0x121a5a,'language':_0x53a679});}catch(_0x15f86f){console['log'](_0x58d5e2(0x1ab),_0x15f86f),_0x4baeb0['status'](0xc8)[_0x58d5e2(0xc1)]({'message':_0x15f86f[_0x58d5e2(0x183)]});}});function BayBinSelected(_0x1c3759,_0xf66ec3){var _0x2c2c08=a0_0x2c46bb,_0x67ee30=[],_0x5ea1f3=[],_0x21cb0a=[],_0x34a5b1=[],_0x2f3eb0=[],_0x2c5738=[];let _0x44888a=[];if(_0x1c3759==_0x2c2c08(0xe5))switch(_0xf66ec3){case _0x2c2c08(0xa3):_0x67ee30=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5ea1f3=[0x1,0x2],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=['Level','Floor'],_0x2f3eb0=['D'],_0x2c5738=['A'];break;case _0x2c2c08(0x14c):_0x67ee30=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5ea1f3=[0x1,0x2],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=[_0x2c2c08(0x15d),_0x2c2c08(0x126)],_0x2f3eb0=['D'],_0x2c5738=['B'];break;case _0x2c2c08(0x119):_0x67ee30=[0x0],_0x5ea1f3=[0x0],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=[_0x2c2c08(0x126)],_0x2f3eb0=['D'],_0x2c5738=['S'];break;case _0x2c2c08(0xc0):_0x67ee30=[0x0],_0x5ea1f3=[0x0],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x21cb0a=[_0x2c2c08(0x126)],_0x2f3eb0=['D'],_0x2c5738=['R'];break;}else{if(_0x1c3759=='COLD\x20STORAGE')switch(_0xf66ec3){case _0x2c2c08(0xa3):_0x67ee30=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5ea1f3=['B','F'],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=[_0x2c2c08(0x15d),_0x2c2c08(0x126)],_0x2f3eb0=['C'],_0x2c5738=['A'];break;case _0x2c2c08(0x14c):_0x67ee30=[0x5,0x4,0x3,0x2,0x1],_0x5ea1f3=['F','B','S'],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=[_0x2c2c08(0x15d),_0x2c2c08(0x126)],_0x2f3eb0=['C'],_0x2c5738=['B'];break;case'Rack\x20C':_0x67ee30=[0x1,0x2,0x3,0x4,0x5],_0x5ea1f3=['B','F','S'],_0x34a5b1=[0x5,0x4,0x3,0x2,0x1],_0x21cb0a=[_0x2c2c08(0x15d),'Floor'],_0x2f3eb0=['C'],_0x2c5738=['C'];break;case _0x2c2c08(0xa0):_0x67ee30=[0x5,0x4,0x3,0x2,0x1],_0x5ea1f3=['F','B','S'],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=[_0x2c2c08(0x15d),_0x2c2c08(0x126)],_0x2f3eb0=['C'],_0x2c5738=['D'];break;case'Rack\x20E':_0x67ee30=[0x4,0x3,0x2,0x1],_0x5ea1f3=[0x1,0x2],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=['Level',_0x2c2c08(0x126)],_0x2f3eb0=['C'],_0x2c5738=['E'];break;case'Rack\x20F':_0x67ee30=[0x1,0x2,0x3],_0x5ea1f3=[0x1,0x2],_0x34a5b1=[0x1,0x2,0x3,0x4,0x5],_0x21cb0a=[_0x2c2c08(0x15d)],_0x2f3eb0=['C'],_0x2c5738=['F'];break;}}return{'levels':_0x67ee30,'Isle':_0x5ea1f3,'rack':_0x34a5b1,'type':_0x21cb0a,'storage':_0x2f3eb0,'rak':_0x2c5738};}async function getRandom8DigitNumber(){var _0x4198ad=a0_0x2c46bb;const _0xd35e96=0x989680,_0x16b8e1=0x5f5e0ff,_0x4cac0f=Math['floor'](Math[_0x4198ad(0x143)]()*(_0x16b8e1-_0xd35e96+0x1))+_0xd35e96;var _0x60bde4;const _0x55f690=await purchases[_0x4198ad(0x144)]({'invoice':_0x4198ad(0xfd)+_0x4cac0f});return _0x55f690&&_0x55f690[_0x4198ad(0x149)]>0x0?_0x60bde4=_0x4198ad(0xfd)+_0x4cac0f:_0x60bde4='INC-'+_0x4cac0f,_0x60bde4;}function a0_0x4e7f(_0xd5f216,_0x28287b){var _0x29935a=a0_0x2993();return a0_0x4e7f=function(_0x4e7f1c,_0x253525){_0x4e7f1c=_0x4e7f1c-0x96;var _0x8c97b1=_0x29935a[_0x4e7f1c];return _0x8c97b1;},a0_0x4e7f(_0xd5f216,_0x28287b);}router[a0_0x2c46bb(0xaf)](a0_0x2c46bb(0x134),auth,async(_0x4021b0,_0x1130eb)=>{var _0x187c00=a0_0x2c46bb;try{const {username:_0xf2373e,email:_0x41139d,role:_0x28991d}=_0x4021b0[_0x187c00(0x1ad)],_0x4d2ce1=_0x4021b0[_0x187c00(0x1ad)],_0xa78fc5=await profile[_0x187c00(0x144)]({'email':_0x4d2ce1[_0x187c00(0x172)]}),_0x8bf247=await master_shop[_0x187c00(0x153)](),_0x498a1c=await staff[_0x187c00(0x144)]({'email':_0x4d2ce1[_0x187c00(0x172)]}),_0x1eb1d7=await suppliers[_0x187c00(0x153)]({});let _0x151c6f;if(_0x4d2ce1['role']==_0x187c00(0xb0)){const _0x1705dc=await staff[_0x187c00(0x144)]({'email':_0x4d2ce1['email']});_0x151c6f=await warehouse[_0x187c00(0x14f)]([{'$match':{'status':_0x187c00(0xd2),'name':_0x1705dc[_0x187c00(0xd4)],'warehouse_category':_0x187c00(0x188),'name':{'$ne':_0x187c00(0xda)}}},{'$group':{'_id':_0x187c00(0x107),'name':{'$first':'$name'}}}]);}else _0x151c6f=await warehouse[_0x187c00(0x14f)]([{'$match':{'status':_0x187c00(0xd2),'warehouse_category':_0x187c00(0x188),'name':{'$ne':_0x187c00(0xda)}}},{'$group':{'_id':_0x187c00(0x107),'name':{'$first':_0x187c00(0x107)}}}]);const _0x41bc4a=await product['find']({}),_0x1a27ef=await warehouse['find']({'status':_0x187c00(0xd2)}),_0x41668f=await purchases[_0x187c00(0x153)]({}),_0x474c53=_0x41668f[_0x187c00(0x149)]+0x1,_0x3bb7b5=_0x187c00(0xfd)+_0x474c53[_0x187c00(0x18f)]()[_0x187c00(0x9d)](0x5,'0');var _0x37011e=[_0x187c00(0x111),_0x187c00(0x162)];if(_0x8bf247[0x0][_0x187c00(0x113)]==_0x187c00(0xab))var _0x52632e=users['English'];else{if(_0x8bf247[0x0][_0x187c00(0x113)]==_0x187c00(0xe6))var _0x52632e=users[_0x187c00(0xe6)];else{if(_0x8bf247[0x0][_0x187c00(0x113)]=='German')var _0x52632e=users['German'];else{if(_0x8bf247[0x0]['language']=='Spanish')var _0x52632e=users[_0x187c00(0x195)];else{if(_0x8bf247[0x0][_0x187c00(0x113)]=='French')var _0x52632e=users['French'];else{if(_0x8bf247[0x0][_0x187c00(0x113)]==_0x187c00(0x115))var _0x52632e=users[_0x187c00(0x117)];else{if(_0x8bf247[0x0][_0x187c00(0x113)]=='Chinese')var _0x52632e=users[_0x187c00(0x136)];else{if(_0x8bf247[0x0]['language']==_0x187c00(0x138))var _0x52632e=users[_0x187c00(0x197)];}}}}}}}const _0x1f0d11=getRandom8DigitNumber();_0x1f0d11[_0x187c00(0x190)](_0x4dba41=>{var _0x3d4160=_0x187c00;_0x1130eb[_0x3d4160(0x196)](_0x3d4160(0xca),{'success':_0x4021b0[_0x3d4160(0x11f)](_0x3d4160(0x155)),'errors':_0x4021b0[_0x3d4160(0x11f)](_0x3d4160(0x1b4)),'role':_0x4d2ce1,'profile':_0xa78fc5,'suppliers':_0x1eb1d7,'warehouse':_0x151c6f,'product':_0x41bc4a,'invoice':_0x4dba41,'master_shop':_0x8bf247,'language':_0x52632e,'find_data':_0x1a27ef,'rooms_data':_0x37011e});})[_0x187c00(0x154)](_0x4c97b1=>{var _0x519002=_0x187c00;_0x4021b0[_0x519002(0x11f)](_0x519002(0x1b4),_0x519002(0x11e)),_0x1130eb[_0x519002(0x189)](_0x519002(0xdc));});}catch(_0x177706){console['log'](_0x177706);}}),router[a0_0x2c46bb(0xaf)](a0_0x2c46bb(0x19f),auth,async(_0x97f66b,_0x1eb23a)=>{var _0x283550=a0_0x2c46bb;try{const _0x56e1a2=_0x97f66b[_0x283550(0x17c)]['id'];console[_0x283550(0x12e)](_0x56e1a2);const _0xec7621=await master_shop[_0x283550(0x153)]();console[_0x283550(0x12e)](_0x283550(0x9c),_0xec7621);const _0x1a3c80=await product['findOne']({'name':_0x56e1a2});console[_0x283550(0x12e)](_0x283550(0x175),_0x1a3c80),_0x1eb23a['status'](0xc8)['json']({'product_data':_0x1a3c80,'master':_0xec7621});}catch(_0x3ece76){console[_0x283550(0x12e)](_0x283550(0x158),_0x3ece76);}}),router['post']('/view/add_purchases',auth,async(_0xe0d033,_0x420849)=>{var _0x33f865=a0_0x2c46bb;try{const {invoice:_0x292fc7,date:_0x2d2ecb,warehouse_name:_0x522d9b,prod_name:_0x47f578,prod_code:_0x5af91d,prod_qty:_0x1a23cf,prod_unit:_0x191765,prod_secondunit:_0x3df689,prod_level:_0x55c05e,prod_isle:_0x110827,prod_pallet:_0x429548,note:_0x182d1f,expiry_date:_0x8653cc,batch_code:_0x8e98a6,payable:_0x445a4f,due_amount:_0x489b37,Room_name:_0x425068,primary_code:_0xff2dcf,secondary_code:_0x49aefc,MaxStocks_data:_0x4dbb44,PO_number:_0x416fa4,SCRN:_0x4d0e78,JO_number:_0x22331a}=_0xe0d033[_0x33f865(0x18e)];if(typeof _0x47f578==_0x33f865(0x174))var _0x49d7c0=[_0xe0d033['body'][_0x33f865(0x17b)]],_0xcea6a4=[_0xe0d033['body'][_0x33f865(0xe1)]],_0x5bc429=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0xdd)]],_0x593d7b=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0x103)]],_0x1ae4ff=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0x13c)]],_0x8395a2=[_0xe0d033['body'][_0x33f865(0x102)]],_0x4c53be=[_0xe0d033['body'][_0x33f865(0x131)]],_0x52f175=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0xbe)]],_0x2d92ec=[_0xe0d033[_0x33f865(0x18e)]['MaxStocks_data']],_0x5a9ebb=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0xf4)]],_0x3ca125=[_0xe0d033['body'][_0x33f865(0x139)]],_0x3ba12a=[_0xe0d033['body'][_0x33f865(0xfa)]],_0x462c5a=[_0xe0d033[_0x33f865(0x18e)]['alertQTY']],_0x4ccc5a=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0xa4)]],_0x56e132=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0x10b)]],_0xcc4bef=[_0xe0d033['body'][_0x33f865(0x18c)]],_0x53c476=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0x16e)]],_0x568b5a=[_0xe0d033[_0x33f865(0x18e)][_0x33f865(0x141)]],_0xaf3639=[_0xe0d033[_0x33f865(0x18e)]['actual_qty']],_0x30ff3f=[_0xe0d033[_0x33f865(0x18e)]['actual_uom']],_0x14b71e=[_0xe0d033['body'][_0x33f865(0x130)]];else var _0x49d7c0=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x17b)]],_0xcea6a4=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0xe1)]],_0x5bc429=[..._0xe0d033['body'][_0x33f865(0xdd)]],_0x593d7b=[..._0xe0d033['body'][_0x33f865(0x103)]],_0x1ae4ff=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x13c)]],_0x8395a2=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x102)]],_0x4c53be=[..._0xe0d033['body']['primary_code']],_0x52f175=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0xbe)]],_0x2d92ec=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x166)]],_0x5a9ebb=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0xf4)]],_0x3ca125=[..._0xe0d033['body'][_0x33f865(0x139)]],_0x3ba12a=[..._0xe0d033['body'][_0x33f865(0xfa)]],_0x462c5a=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x1b5)]],_0x4ccc5a=[..._0xe0d033[_0x33f865(0x18e)]['production_date']],_0x56e132=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x10b)]],_0xcc4bef=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x18c)]],_0x53c476=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x16e)]],_0x568b5a=[..._0xe0d033['body'][_0x33f865(0x141)]],_0xaf3639=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0xc9)]],_0x30ff3f=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0xdb)]],_0x14b71e=[..._0xe0d033[_0x33f865(0x18e)][_0x33f865(0x130)]];const _0x2800fe=_0x49d7c0['map'](_0x187327=>{return _0x187327={'product_name':_0x187327};});_0xaf3639[_0x33f865(0xf2)]((_0x29a40b,_0x58a291)=>{var _0x25bbae=_0x33f865;_0x2800fe[_0x58a291][_0x25bbae(0xc9)]=Math[_0x25bbae(0xd0)](_0x29a40b);}),_0x30ff3f[_0x33f865(0xf2)]((_0xac6ea6,_0x2cfb36)=>{var _0xee49b5=_0x33f865;_0x2800fe[_0x2cfb36][_0xee49b5(0xdb)]=_0xac6ea6;}),_0xcea6a4[_0x33f865(0xf2)]((_0x5d74dc,_0x538c2f)=>{var _0x48b88a=_0x33f865;_0x2800fe[_0x538c2f]['product_code']=_0x5d74dc,_0x2800fe[_0x538c2f][_0x48b88a(0xac)]=_0x2d2ecb;}),_0x5bc429[_0x33f865(0xf2)]((_0x2d1ad4,_0x250be9)=>{var _0x556923=_0x33f865;_0x2800fe[_0x250be9][_0x556923(0x17d)]=Math[_0x556923(0xd0)](_0x2d1ad4);}),_0x593d7b['forEach']((_0x4b9d34,_0x4c8d83)=>{var _0x22bd15=_0x33f865;_0x2800fe[_0x4c8d83][_0x22bd15(0xc3)]=_0x4b9d34;}),_0x1ae4ff[_0x33f865(0xf2)]((_0x53b40f,_0x42c370)=>{var _0x1face3=_0x33f865;_0x2800fe[_0x42c370][_0x1face3(0x12d)]=_0x53b40f;}),_0x8395a2[_0x33f865(0xf2)]((_0x1a2dd9,_0x2b5922)=>{var _0x376f17=_0x33f865;_0xcc4bef[_0x376f17(0xf2)]((_0x3ba3dd,_0x49d0d8)=>{var _0x94b465=_0x376f17;if(_0x3ba3dd==_0x94b465(0xc0)&&_0x2b5922==_0x49d0d8){console[_0x94b465(0x12e)](_0x3ba3dd+'\x20<\x20wew\x20>\x20'+_0x2b5922+_0x94b465(0xfb)+_0x49d0d8+_0x94b465(0xfb)+_0x1a2dd9);var _0x44a36a=_0x1a2dd9['slice'](0x3);_0x2800fe[_0x2b5922][_0x94b465(0x123)]=_0x1a2dd9[0x0],_0x2800fe[_0x2b5922][_0x94b465(0x151)]=_0x1a2dd9[0x1],_0x2800fe[_0x2b5922][_0x94b465(0x1a9)]=0x0,_0x2800fe[_0x2b5922][_0x94b465(0x100)]=0x0,_0x2800fe[_0x2b5922][_0x94b465(0x15f)]=_0x94b465(0x126),_0x2800fe[_0x2b5922][_0x94b465(0xc5)]=_0x44a36a;}else{if(_0x3ba3dd==_0x94b465(0x119)&&_0x2b5922==_0x49d0d8){var _0x44a36a=_0x1a2dd9[_0x94b465(0xf7)](0x3);_0x2800fe[_0x2b5922][_0x94b465(0x123)]=_0x1a2dd9[0x0],_0x2800fe[_0x2b5922]['rack']=_0x1a2dd9[0x1],_0x2800fe[_0x2b5922][_0x94b465(0x1a9)]=0x0,_0x2800fe[_0x2b5922]['bin']=0x0,_0x2800fe[_0x2b5922][_0x94b465(0x15f)]=_0x94b465(0x126),_0x2800fe[_0x2b5922][_0x94b465(0xc5)]=_0x1a2dd9[0x5];}else{if(_0x2b5922==_0x49d0d8){if(_0x1a2dd9[0x0]=='A'&&_0x1a2dd9[0x1]=='L'&&_0x1a2dd9[0x2]=='L')console['log'](_0x3ba3dd+_0x94b465(0xfb)+_0x2b5922+'\x20<>\x20'+_0x49d0d8+_0x94b465(0xfb)+_0x1a2dd9+_0x94b465(0x128)),_0x2800fe[_0x2b5922][_0x94b465(0x123)]=_0x1a2dd9[0x0],_0x2800fe[_0x2b5922][_0x94b465(0x151)]=_0x1a2dd9[0x1],_0x2800fe[_0x2b5922][_0x94b465(0x1a9)]=0x0,_0x2800fe[_0x2b5922][_0x94b465(0x100)]=0x0,_0x2800fe[_0x2b5922]['type']=_0x94b465(0x126),_0x2800fe[_0x2b5922][_0x94b465(0xc5)]=_0x1a2dd9[0x3];else{var _0x569a24;if(_0x1a2dd9[0x4]=='L')_0x569a24=_0x94b465(0x15d);else _0x1a2dd9[0x4]=='F'&&(_0x569a24=_0x94b465(0x126));_0x2800fe[_0x2b5922][_0x94b465(0x123)]=_0x1a2dd9[0x0],_0x2800fe[_0x2b5922][_0x94b465(0x151)]=_0x1a2dd9[0x1],_0x2800fe[_0x2b5922][_0x94b465(0x1a9)]=_0x1a2dd9[0x2],_0x2800fe[_0x2b5922][_0x94b465(0x100)]=_0x1a2dd9[0x3],_0x2800fe[_0x2b5922][_0x94b465(0x15f)]=_0x569a24,_0x2800fe[_0x2b5922][_0x94b465(0xc5)]=_0x1a2dd9[0x5];}}}}});}),_0x4c53be[_0x33f865(0xf2)]((_0x288461,_0x26e4b6)=>{var _0x5c7496=_0x33f865;_0x2800fe[_0x26e4b6][_0x5c7496(0x131)]=_0x288461;}),_0x52f175[_0x33f865(0xf2)]((_0xbb1429,_0x1491ba)=>{_0x2800fe[_0x1491ba]['secondary_code']=_0xbb1429;}),_0x2d92ec[_0x33f865(0xf2)]((_0x56cc8a,_0x31fbde)=>{_0x2800fe[_0x31fbde]['maxStocks']=_0x56cc8a;}),_0x5a9ebb[_0x33f865(0xf2)]((_0x26caa6,_0x34a750)=>{_0x2800fe[_0x34a750]['batch_code']=_0x26caa6;}),_0x3ca125[_0x33f865(0xf2)]((_0x1ee80e,_0x1f8dfe)=>{var _0x1e72e3=_0x33f865;_0x2800fe[_0x1f8dfe][_0x1e72e3(0x139)]=_0x1ee80e;}),_0x3ba12a[_0x33f865(0xf2)]((_0x523f30,_0x3d50f9)=>{_0x2800fe[_0x3d50f9]['maxperunit']=_0x523f30;}),_0x462c5a[_0x33f865(0xf2)]((_0x3c27c9,_0x525132)=>{var _0x2d6559=_0x33f865;_0x2800fe[_0x525132][_0x2d6559(0x1b5)]=_0x3c27c9;}),_0x4ccc5a['forEach']((_0x12c02f,_0x56afbf)=>{_0x2800fe[_0x56afbf]['production_date']=_0x12c02f;}),_0x56e132[_0x33f865(0xf2)]((_0x3f62af,_0x29ac04)=>{var _0x4632ce=_0x33f865;_0x2800fe[_0x29ac04][_0x4632ce(0xbd)]=_0x3f62af;}),_0xcc4bef[_0x33f865(0xf2)]((_0xa70877,_0x1e6c47)=>{var _0xcf66fc=_0x33f865;_0x2800fe[_0x1e6c47][_0xcf66fc(0x129)]=_0xa70877;}),_0x14b71e['forEach']((_0xb6ee14,_0x1f96da)=>{var _0x4bef2f=_0x33f865;_0x2800fe[_0x1f96da][_0x4bef2f(0x11d)]=_0xb6ee14;}),_0x53c476[_0x33f865(0xf2)]((_0x27d655,_0x325d0c)=>{var _0xf95307=_0x33f865;_0x2800fe[_0x325d0c][_0xf95307(0xdf)]=_0x27d655;}),_0x568b5a[_0x33f865(0xf2)]((_0x144ec9,_0x4458e3)=>{var _0x1bc1b9=_0x33f865;_0x2800fe[_0x4458e3][_0x1bc1b9(0xa8)]=_0x144ec9;});const _0x13000f=_0xcc4bef[_0x33f865(0x1a6)](_0x36fcdd=>{return _0x36fcdd={'room_name':_0x36fcdd};}),_0x1bf9ec=_0x2800fe[_0x33f865(0x160)](_0x3aac99=>_0x3aac99[_0x33f865(0x17d)]!=='0'&&_0x3aac99[_0x33f865(0x17d)]!==''),_0x155c9e=new purchases({'invoice':_0x292fc7,'suppliers':_0xe0d033[_0x33f865(0x18e)]['suppliers'],'date':_0x2d2ecb,'warehouse_name':_0x522d9b,'product':_0x1bf9ec,'note':_0x182d1f,'due_amount':_0x489b37,'POnumber':_0x416fa4,'SCRN':_0x4d0e78,'JO_number':_0x22331a,'roomList':_0x13000f}),_0x1fd01e=await _0x155c9e[_0x33f865(0x10d)](),_0x2c5b39=await purchases['findOne']({'invoice':_0x292fc7}),_0x5bcfc0=_0x2c5b39[_0x33f865(0x175)]['map'](async _0xc68cc1=>{var _0x4518ba=_0x33f865,_0x12f72c=await warehouse['findOne']({'name':_0x522d9b,'room':_0xc68cc1[_0x4518ba(0x129)]}),_0x27b4ef=0x0;return _0x12f72c['product_details']['forEach'](_0x5bbb2d=>{var _0x2b06b5=_0x4518ba;_0x5bbb2d['product_name']==_0xc68cc1[_0x2b06b5(0x14b)]&&_0x5bbb2d[_0x2b06b5(0xc5)]==_0xc68cc1[_0x2b06b5(0xc5)]&&_0x5bbb2d[_0x2b06b5(0x15f)]==_0xc68cc1[_0x2b06b5(0x15f)]&&_0x5bbb2d['bin']==_0xc68cc1[_0x2b06b5(0x100)]&&_0x5bbb2d[_0x2b06b5(0x1a9)]==_0xc68cc1[_0x2b06b5(0x1a9)]&&_0x5bbb2d[_0x2b06b5(0x151)]==_0xc68cc1[_0x2b06b5(0x151)]&&_0x5bbb2d['storage']==_0xc68cc1[_0x2b06b5(0x123)]&&_0x5bbb2d[_0x2b06b5(0x139)]==_0xc68cc1[_0x2b06b5(0x139)]&&_0x5bbb2d[_0x2b06b5(0xf4)]==_0xc68cc1[_0x2b06b5(0xf4)]&&_0x5bbb2d[_0x2b06b5(0xa4)]==_0xc68cc1[_0x2b06b5(0xa4)]&&_0x5bbb2d[_0x2b06b5(0xa8)]==_0x2c5b39[_0x2b06b5(0xa8)]&&(_0x5bbb2d['product_stock']+=Math[_0x2b06b5(0xd0)](_0xc68cc1['quantity']),_0x27b4ef++);}),_0x27b4ef===0x0&&_0x12f72c[_0x4518ba(0xc8)][_0x4518ba(0xfe)]({'product_name':_0xc68cc1['product_name'],'product_stock':Math[_0x4518ba(0xd0)](_0xc68cc1[_0x4518ba(0x17d)]),'primary_code':_0xc68cc1[_0x4518ba(0x131)],'secondary_code':_0xc68cc1[_0x4518ba(0xbe)],'product_code':_0xc68cc1[_0x4518ba(0x167)],'storage':_0xc68cc1[_0x4518ba(0x123)],'rack':_0xc68cc1[_0x4518ba(0x151)],'bay':_0xc68cc1[_0x4518ba(0x1a9)],'bin':_0xc68cc1['bin'],'type':_0xc68cc1[_0x4518ba(0x15f)],'floorlevel':_0xc68cc1[_0x4518ba(0xc5)],'maxProducts':_0xc68cc1[_0x4518ba(0x184)],'unit':_0xc68cc1[_0x4518ba(0xc3)],'secondary_unit':_0xc68cc1[_0x4518ba(0x12d)],'expiry_date':_0xc68cc1[_0x4518ba(0x139)],'maxPerUnit':_0xc68cc1[_0x4518ba(0x101)],'batch_code':_0xc68cc1[_0x4518ba(0xf4)],'alertQTY':_0xc68cc1['alertQTY'],'production_date':_0xc68cc1[_0x4518ba(0xa4)],'product_cat':_0xc68cc1['product_cat'],'invoice':_0xc68cc1['invoice'],'actual_qty':Math['abs'](_0xc68cc1[_0x4518ba(0xc9)]),'actual_uom':_0xc68cc1[_0x4518ba(0xdb)],'delivery_date':_0xc68cc1[_0x4518ba(0x11d)],'delivery_code':_0xc68cc1[_0x4518ba(0xdf)]}),_0x12f72c;});Promise['all'](_0x5bcfc0)[_0x33f865(0x190)](async _0x474b64=>{var _0x3ea697=_0x33f865;try{for(const _0x5e51a7 of _0x474b64){await _0x5e51a7[_0x3ea697(0x10d)]();}const _0x5d04ba=await master_shop[_0x3ea697(0x153)](),_0x5189d1=await email_settings['findOne'](),_0x576538=await supervisor_settings[_0x3ea697(0x153)]();var _0x3a79e2=_0x2c5b39[_0x3ea697(0x175)],_0x40a1b7='',_0x49d002;for(_0x49d002 in _0x3a79e2){_0x40a1b7+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a79e2[_0x49d002][_0x3ea697(0x14b)]+_0x3ea697(0x120)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a79e2[_0x49d002][_0x3ea697(0x167)]+'</td>'+_0x3ea697(0x1a5)+_0x3a79e2[_0x49d002]['quantity']+_0x3ea697(0x120)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a79e2[_0x49d002][_0x3ea697(0xc3)]+_0x3ea697(0x120)+_0x3ea697(0x1a5)+_0x3a79e2[_0x49d002][_0x3ea697(0x12d)]+_0x3ea697(0x120)+_0x3ea697(0x1a5)+_0x2c5b39[_0x3ea697(0x19e)]+_0x3ea697(0x120)+_0x3ea697(0x1a5)+_0x3a79e2[_0x49d002][_0x3ea697(0x129)]+_0x3ea697(0x120)+_0x3ea697(0x1a5)+_0x3a79e2[_0x49d002]['storage']+_0x3a79e2[_0x49d002][_0x3ea697(0x151)]+_0x3a79e2[_0x49d002][_0x3ea697(0x1a9)]+_0x3a79e2[_0x49d002][_0x3ea697(0x100)]+_0x3a79e2[_0x49d002][_0x3ea697(0x15f)][0x0]+_0x3a79e2[_0x49d002][_0x3ea697(0xc5)]+_0x3ea697(0x120),_0x3ea697(0x1ac);}let _0x386824=nodemailer[_0x3ea697(0x1b2)]({'host':_0x5189d1[_0x3ea697(0x1a1)],'port':Number(_0x5189d1[_0x3ea697(0xb3)]),'secure':![],'auth':{'user':_0x5189d1[_0x3ea697(0x172)],'pass':_0x5189d1['password']}}),_0x3b650d={'from':_0x5189d1[_0x3ea697(0x172)],'to':_0x576538[0x0][_0x3ea697(0x179)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x3ea697(0xad),'path':__dirname+_0x3ea697(0x124)+'/upload/'+_0x5d04ba[0x0][_0x3ea697(0x176)],'cid':_0x3ea697(0xf6)}],'html':_0x3ea697(0x152)+'<html><head><title></title>'+'</head><body>'+_0x3ea697(0xa1)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x3ea697(0xa1)+_0x3ea697(0xe0)+_0x3ea697(0x19c)+_0x3ea697(0xa1)+_0x3ea697(0x9f)+_0x5d04ba[0x0][_0x3ea697(0x1ae)]+_0x3ea697(0x1af)+_0x3ea697(0x19c)+_0x3ea697(0x19c)+'<hr\x20class=\x22my-3\x22>'+_0x3ea697(0xa1)+_0x3ea697(0xcb)+_0x3ea697(0x125)+_0x2c5b39[_0x3ea697(0xa8)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2c5b39['date']+'\x20'+_0x3ea697(0x13d)+_0x3ea697(0x98)+'</div>'+_0x3ea697(0x122)+_0x3ea697(0x96)+'<tr>'+_0x3ea697(0x127)+_0x3ea697(0x18d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x3ea697(0xe9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3ea697(0xb1)+_0x3ea697(0xf0)+_0x3ea697(0x16a)+_0x3ea697(0x1ac)+_0x3ea697(0x15e)+_0x3ea697(0x14a)+'\x20'+_0x40a1b7+'\x20'+_0x3ea697(0xfc)+_0x3ea697(0x1a8)+_0x3ea697(0xa1)+_0x3ea697(0x1a4)+'<h5>'+_0x5d04ba[0x0][_0x3ea697(0x1ae)]+_0x3ea697(0x98)+_0x3ea697(0x19c)+'</div>'+'</body></html>'};_0x386824[_0x3ea697(0x186)](_0x3b650d,function(_0x3ca5de,_0x414d47){var _0x243dcc=_0x3ea697;_0x3ca5de?(console[_0x243dcc(0x12e)](_0x3ca5de),console[_0x243dcc(0x12e)]('Error\x20Occurs')):console[_0x243dcc(0x12e)](_0x243dcc(0x140));}),_0xe0d033['flash'](_0x3ea697(0x155),_0x3ea697(0x110)),_0x420849[_0x3ea697(0x189)]('/all_purchases/view/');}catch(_0x38e46e){console[_0x3ea697(0xba)](_0x38e46e),_0x420849[_0x3ea697(0x97)](0x1f4)[_0x3ea697(0xc1)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x33f865(0x154)](_0x3a31b2=>{var _0x22c28c=_0x33f865;console[_0x22c28c(0xba)](_0x3a31b2),_0x420849[_0x22c28c(0x97)](0x1f4)[_0x22c28c(0xc1)]({'error':_0x22c28c(0xa7)});});}catch(_0x338002){console[_0x33f865(0x12e)](_0x338002);}}),router[a0_0x2c46bb(0xaf)](a0_0x2c46bb(0x173),auth,async(_0x28296b,_0x2b23d2)=>{var _0x35d519=a0_0x2c46bb;try{const {username:_0x5f4fbf,email:_0x1e1fe1,role:_0xe5078f}=_0x28296b[_0x35d519(0x1ad)],_0x78c15e=_0x28296b['user'],_0x3570e0=await profile[_0x35d519(0x144)]({'email':_0x78c15e['email']}),_0x3bb365=await master_shop[_0x35d519(0x153)](),_0x285b33=_0x28296b['params']['id'],_0x4932e4=await purchases[_0x35d519(0xb4)](_0x285b33),_0x21a1b4=await warehouse[_0x35d519(0x14f)]([{'$match':{'name':_0x4932e4[_0x35d519(0x19e)],'room':_0x4932e4[_0x35d519(0xe4)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x35d519(0x14d),'name':{'$first':_0x35d519(0x1b1)},'product_stock':{'$first':_0x35d519(0xed)},'bay':{'$first':_0x35d519(0x16b)},'bin':{'$first':_0x35d519(0xbc)},'type':{'$first':_0x35d519(0x19b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x35d519(0xe8)},'product_code':{'$first':_0x35d519(0x146)},'storage':{'$first':_0x35d519(0xec)},'rack':{'$first':_0x35d519(0x15b)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x4cf63e=await customer[_0x35d519(0x153)]({});let _0x3b20ae;if(_0x78c15e[_0x35d519(0xd1)]==_0x35d519(0xb0)){const _0x11c9c3=await staff[_0x35d519(0x144)]({'email':_0x78c15e[_0x35d519(0x172)]});_0x3b20ae=await warehouse[_0x35d519(0x14f)]([{'$match':{'status':_0x35d519(0xd2),'name':_0x11c9c3['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x35d519(0x107)}}}]);}else _0x3b20ae=await warehouse[_0x35d519(0x14f)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x35d519(0x107),'name':{'$first':_0x35d519(0x107)}}}]);const _0x1ca5f5=await product[_0x35d519(0x153)]({}),_0x511828=await suppliers['find']({}),_0x102c5a=BayBinSelected(_0x4932e4['warehouse_name'],_0x4932e4['room']);if(_0x3bb365[0x0]['language']==_0x35d519(0xab)){var _0x549b18=users[_0x35d519(0x169)];console[_0x35d519(0x12e)](_0x549b18);}else{if(_0x3bb365[0x0]['language']==_0x35d519(0xe6))var _0x549b18=users[_0x35d519(0xe6)];else{if(_0x3bb365[0x0]['language']==_0x35d519(0xd5))var _0x549b18=users[_0x35d519(0xd5)];else{if(_0x3bb365[0x0][_0x35d519(0x113)]==_0x35d519(0x195))var _0x549b18=users['Spanish'];else{if(_0x3bb365[0x0][_0x35d519(0x113)]=='French')var _0x549b18=users[_0x35d519(0x18a)];else{if(_0x3bb365[0x0][_0x35d519(0x113)]==_0x35d519(0x115))var _0x549b18=users[_0x35d519(0x117)];else{if(_0x3bb365[0x0][_0x35d519(0x113)]=='Chinese')var _0x549b18=users[_0x35d519(0x136)];else{if(_0x3bb365[0x0]['language']==_0x35d519(0x138))var _0x549b18=users['Arabic'];}}}}}}}_0x2b23d2['render'](_0x35d519(0x105),{'success':_0x28296b[_0x35d519(0x11f)](_0x35d519(0x155)),'errors':_0x28296b[_0x35d519(0x11f)](_0x35d519(0x1b4)),'role':_0x78c15e,'profile':_0x3570e0,'customer':_0x4cf63e,'warehouse':_0x3b20ae,'product':_0x21a1b4,'user':_0x4932e4,'master_shop':_0x3bb365,'unit':_0x1ca5f5,'language':_0x549b18,'suppliers':_0x511828,'dataSelected':_0x102c5a});}catch(_0x368d63){console[_0x35d519(0x12e)](_0x368d63);}}),router[a0_0x2c46bb(0x12a)](a0_0x2c46bb(0x173),auth,async(_0x388ec7,_0x28f8b8)=>{var _0x2d2779=a0_0x2c46bb;try{const _0x192d16=_0x388ec7[_0x2d2779(0x17c)]['id'],{invoice:_0xbe62e,warehouse_name:_0x4ff948,Room_name:_0x3687ce}=_0x388ec7[_0x2d2779(0x18e)],_0x8c70e3=await warehouse[_0x2d2779(0x144)]({'name':_0x4ff948,'room':_0x3687ce}),_0x66ca96=await purchases[_0x2d2779(0x144)]({'invoice':_0xbe62e});_0x66ca96['product'][_0x2d2779(0xf2)](_0x2236da=>{var _0xef11f3=_0x2d2779,_0x4f1fb0=0x0;const _0x599c1f=_0x8c70e3[_0xef11f3(0xc8)][_0xef11f3(0x1a6)](_0x458410=>{var _0x225dcc=_0xef11f3;_0x458410[_0x225dcc(0x14b)]==_0x2236da[_0x225dcc(0x14b)]&&_0x458410[_0x225dcc(0xc5)]==_0x2236da[_0x225dcc(0xc5)]&&_0x458410[_0x225dcc(0x15f)]==_0x2236da[_0x225dcc(0x15f)]&&_0x458410['bin']==_0x2236da[_0x225dcc(0x100)]&&_0x458410[_0x225dcc(0x1a9)]==_0x2236da[_0x225dcc(0x1a9)]&&_0x458410[_0x225dcc(0x151)]==_0x2236da[_0x225dcc(0x151)]&&_0x458410[_0x225dcc(0x123)]==_0x2236da[_0x225dcc(0x123)]&&_0x458410[_0x225dcc(0x139)]==_0x2236da[_0x225dcc(0x139)]&&_0x458410[_0x225dcc(0xf4)]==_0x2236da['batch_code']&&_0x458410[_0x225dcc(0xa4)]==_0x2236da[_0x225dcc(0xa4)]&&_0x458410[_0x225dcc(0x11d)]==_0x2236da[_0x225dcc(0x11d)]&&_0x458410[_0x225dcc(0xdf)]==_0x2236da['delivery_code']&&(_0x458410[_0x225dcc(0xf5)]=parseInt(_0x458410[_0x225dcc(0xf5)])+parseInt(_0x2236da[_0x225dcc(0x17d)]),_0x4f1fb0++);});_0x4f1fb0=='0'&&(_0x8c70e3[_0xef11f3(0xc8)]=_0x8c70e3[_0xef11f3(0xc8)][_0xef11f3(0x106)]({'product_name':_0x2236da[_0xef11f3(0x14b)],'product_stock':_0x2236da[_0xef11f3(0x17d)],'primary_code':_0x2236da[_0xef11f3(0x131)],'secondary_code':_0x2236da[_0xef11f3(0xbe)],'product_code':_0x2236da['product_code'],'storage':_0x2236da['storage'],'rack':_0x2236da[_0xef11f3(0x151)],'bay':_0x2236da[_0xef11f3(0x1a9)],'bin':_0x2236da[_0xef11f3(0x100)],'type':_0x2236da[_0xef11f3(0x15f)],'floorlevel':_0x2236da['floorlevel'],'maxProducts':_0x2236da['maxStocks'],'unit':_0x2236da[_0xef11f3(0xc3)],'secondary_unit':_0x2236da['secondary_unit'],'expiry_date':_0x2236da[_0xef11f3(0x139)],'maxPerUnit':_0x2236da[_0xef11f3(0x101)],'batch_code':_0x2236da[_0xef11f3(0xf4)],'alertQTY':_0x2236da[_0xef11f3(0x1b5)],'production_date':_0x2236da['production_date'],'delivery_date':_0x2236da['delivery_date'],'delivery_code':_0x2236da[_0xef11f3(0xdf)]}));}),await _0x8c70e3['save'](),_0x66ca96['finalize']='True';const _0x235115=await _0x66ca96[_0x2d2779(0x10d)]();_0x388ec7[_0x2d2779(0x11f)]('success','Sales\x20Update\x20successfully'),_0x28f8b8[_0x2d2779(0x189)](_0x2d2779(0xdc));}catch(_0x29564b){console[_0x2d2779(0x12e)](_0x29564b);}}),router[a0_0x2c46bb(0xaf)](a0_0x2c46bb(0xe7),auth,async(_0x28bfe6,_0x5ac630)=>{var _0xc0e3a4=a0_0x2c46bb;try{const {username:_0x26ccbf,email:_0x11780a,role:_0x3ea281}=_0x28bfe6['user'],_0x52145a=_0x28bfe6['user'],_0x56d6ea=await profile[_0xc0e3a4(0x144)]({'email':_0x52145a[_0xc0e3a4(0x172)]}),_0x2dadc7=await master_shop[_0xc0e3a4(0x153)](),_0x23efb8=_0x28bfe6[_0xc0e3a4(0x17c)]['id'],_0x3883eb=await purchases[_0xc0e3a4(0xb4)](_0x23efb8),_0x2921f7=await suppliers[_0xc0e3a4(0x153)]({});let _0x559d59;if(_0x52145a[_0xc0e3a4(0xd1)]=='staff'){const _0x51f27d=await staff['findOne']({'email':_0x52145a[_0xc0e3a4(0x172)]});_0x559d59=await warehouse[_0xc0e3a4(0x153)]({'status':_0xc0e3a4(0xd2),'name':_0x51f27d[_0xc0e3a4(0xd4)],'warehouse_category':_0xc0e3a4(0x188)});}else _0x559d59=await warehouse[_0xc0e3a4(0x14f)]([{'$match':{'status':'Enabled','warehouse_category':_0xc0e3a4(0x188)}},{'$group':{'_id':'$name','name':{'$first':_0xc0e3a4(0x107)}}}]);const _0x5c5e14=await product[_0xc0e3a4(0x153)]({}),_0x5843ad=BayBinSelected(_0x3883eb[_0xc0e3a4(0x19e)],_0x3883eb[_0xc0e3a4(0xe4)]);let _0x55c641=new Date(_0x3883eb[_0xc0e3a4(0x139)]),_0x54faad=('0'+_0x55c641[_0xc0e3a4(0xae)]())['slice'](-0x2),_0x2abc09=('0'+(_0x55c641[_0xc0e3a4(0xe2)]()+0x1))[_0xc0e3a4(0xf7)](-0x2),_0x2843e5=_0x55c641[_0xc0e3a4(0xb5)](),_0x46e9e6=_0x2843e5+'-'+_0x2abc09+'-'+_0x54faad;if(_0x2dadc7[0x0]['language']==_0xc0e3a4(0xab)){var _0x40c565=users[_0xc0e3a4(0x169)];console[_0xc0e3a4(0x12e)](_0x40c565);}else{if(_0x2dadc7[0x0][_0xc0e3a4(0x113)]=='Hindi')var _0x40c565=users['Hindi'];else{if(_0x2dadc7[0x0][_0xc0e3a4(0x113)]==_0xc0e3a4(0xd5))var _0x40c565=users[_0xc0e3a4(0xd5)];else{if(_0x2dadc7[0x0][_0xc0e3a4(0x113)]=='Spanish')var _0x40c565=users[_0xc0e3a4(0x195)];else{if(_0x2dadc7[0x0][_0xc0e3a4(0x113)]=='French')var _0x40c565=users[_0xc0e3a4(0x18a)];else{if(_0x2dadc7[0x0]['language']=='Portuguese\x20(BR)')var _0x40c565=users[_0xc0e3a4(0x117)];else{if(_0x2dadc7[0x0][_0xc0e3a4(0x113)]==_0xc0e3a4(0x136))var _0x40c565=users['Chinese'];else{if(_0x2dadc7[0x0][_0xc0e3a4(0x113)]=='Arabic\x20(ae)')var _0x40c565=users[_0xc0e3a4(0x197)];}}}}}}}_0x5ac630[_0xc0e3a4(0x196)](_0xc0e3a4(0x1a7),{'success':_0x28bfe6[_0xc0e3a4(0x11f)](_0xc0e3a4(0x155)),'errors':_0x28bfe6[_0xc0e3a4(0x11f)](_0xc0e3a4(0x1b4)),'role':_0x52145a,'profile':_0x56d6ea,'purchases':_0x3883eb,'suppliers':_0x2921f7,'warehouse':_0x559d59,'product':_0x5c5e14,'master_shop':_0x2dadc7,'language':_0x40c565,'ed_fullDate':_0x46e9e6,'dataSelected':_0x5843ad});}catch(_0x586b0b){console[_0xc0e3a4(0x12e)](_0x586b0b);}}),router[a0_0x2c46bb(0x12a)](a0_0x2c46bb(0xe7),auth,async(_0xed568f,_0x5d6d45)=>{var _0x426ee1=a0_0x2c46bb;try{const _0x493efb=_0xed568f[_0x426ee1(0x17c)]['id'],_0xba1dec=await purchases[_0x426ee1(0x144)]({'_id':_0xed568f[_0x426ee1(0x17c)]['id']}),_0x38cf6c=await warehouse['findOne']({'name':_0xba1dec[_0x426ee1(0x19e)],'room':_0xba1dec[_0x426ee1(0xe4)]});_0xba1dec[_0x426ee1(0x175)][_0x426ee1(0xf2)](_0x56dac7=>{var _0x508f85=_0x426ee1;const _0x1d9f69=_0x38cf6c['product_details'][_0x508f85(0x1a6)](_0x5d6bb5=>{var _0x2a4d3f=_0x508f85;_0x5d6bb5[_0x2a4d3f(0x14b)]==_0x56dac7['product_name']&&_0x5d6bb5[_0x2a4d3f(0xc5)]==_0x56dac7[_0x2a4d3f(0xc5)]&&_0x5d6bb5['type']==_0x56dac7[_0x2a4d3f(0x15f)]&&_0x5d6bb5['bin']==_0x56dac7[_0x2a4d3f(0x100)]&&_0x5d6bb5[_0x2a4d3f(0x1a9)]==_0x56dac7[_0x2a4d3f(0x1a9)]&&_0x5d6bb5[_0x2a4d3f(0x151)]==_0x56dac7[_0x2a4d3f(0x151)]&&_0x5d6bb5[_0x2a4d3f(0x123)]==_0x56dac7[_0x2a4d3f(0x123)]&&(_0x5d6bb5[_0x2a4d3f(0xf5)]=parseInt(_0x5d6bb5[_0x2a4d3f(0xf5)])-parseInt(_0x56dac7['quantity']));});}),await _0x38cf6c[_0x426ee1(0x10d)]();const {invoice:_0x3c4d0f,suppliers:_0x30b664,date:_0x4d4b47,warehouse_name:_0x361d95,prod_name:_0x544702,prod_code:_0x87471b,prod_qty:_0x13665d,prod_unit:_0x2f56f4,prod_secondunit:_0x2f329f,prod_level:_0x1849d1,prod_isle:_0x282e09,prod_pallet:_0x519fba,note:_0x1a9840,expiry_date:_0x12f506,batch_code:_0x508ea6,paid_amount:_0x1ef424,due_amount:_0x328702,Room_name:_0xe39896,primary_code:_0x3c0f90,secondary_code:_0xcc8c86,PO_number:_0x52b19c,JO_number:_0x2f7a9c}=_0xed568f[_0x426ee1(0x18e)];if(typeof _0x544702==_0x426ee1(0x174))var _0x2bf812=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x17b)]],_0x25c574=[_0xed568f['body']['prod_code']],_0x57f471=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xc7)]],_0x3f2caf=[_0xed568f['body'][_0x426ee1(0x157)]],_0x1b4ab0=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x13c)]],_0x3dc7aa=[_0xed568f['body'][_0x426ee1(0x102)]],_0x3d29f5=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xb2)]],_0x22e796=[_0xed568f[_0x426ee1(0x18e)]['prod_pallet']],_0x1b49a1=[_0xed568f['body'][_0x426ee1(0x131)]],_0x1dd584=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xbe)]],_0x253208=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x166)]],_0x355b2d=[_0xed568f[_0x426ee1(0x18e)]['batch_code']],_0xd3e5b1=[_0xed568f['body']['expiry_date']],_0x28f5a3=[_0xed568f['body'][_0x426ee1(0x123)]],_0x1f51f6=[_0xed568f['body'][_0x426ee1(0x156)]],_0x15e402=[_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x15f)]];else var _0x2bf812=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x17b)]],_0x25c574=[..._0xed568f['body'][_0x426ee1(0xe1)]],_0x57f471=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xc7)]],_0x3f2caf=[..._0xed568f['body'][_0x426ee1(0x157)]],_0x1b4ab0=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x13c)]],_0x3dc7aa=[..._0xed568f[_0x426ee1(0x18e)]['prod_level']],_0x3d29f5=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xb2)]],_0x22e796=[..._0xed568f['body'][_0x426ee1(0xbb)]],_0x1b49a1=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x131)]],_0x1dd584=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xbe)]],_0x253208=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x166)]],_0x355b2d=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xf4)]],_0xd3e5b1=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x139)]],_0x28f5a3=[..._0xed568f[_0x426ee1(0x18e)]['storage']],_0x1f51f6=[..._0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x156)]],_0x15e402=[..._0xed568f[_0x426ee1(0x18e)]['type']];const _0x7c3fd=_0x2bf812[_0x426ee1(0x1a6)](_0x4875d1=>{return _0x4875d1={'product_name':_0x4875d1};});_0x25c574[_0x426ee1(0xf2)]((_0x117ebc,_0x1c55fe)=>{var _0x24451c=_0x426ee1;_0x7c3fd[_0x1c55fe][_0x24451c(0x167)]=_0x117ebc;}),_0x57f471[_0x426ee1(0xf2)]((_0x769d7,_0x441114)=>{_0x7c3fd[_0x441114]['quantity']=_0x769d7;}),_0x3f2caf[_0x426ee1(0xf2)]((_0xa04e6c,_0x3026c3)=>{var _0xbff36a=_0x426ee1;_0x7c3fd[_0x3026c3][_0xbff36a(0xc3)]=_0xa04e6c;}),_0x1b4ab0['forEach']((_0x226085,_0x1c6e6a)=>{var _0x416f60=_0x426ee1;_0x7c3fd[_0x1c6e6a][_0x416f60(0x12d)]=_0x226085;}),_0x3dc7aa[_0x426ee1(0xf2)]((_0x17034b,_0x3b5013)=>{var _0x58673c=_0x426ee1;_0x7c3fd[_0x3b5013][_0x58673c(0x1a9)]=_0x17034b;}),_0x3d29f5[_0x426ee1(0xf2)]((_0x14c5df,_0x24401d)=>{var _0x305887=_0x426ee1;_0x7c3fd[_0x24401d][_0x305887(0x100)]=_0x14c5df;}),_0x22e796[_0x426ee1(0xf2)]((_0x4b4bc6,_0x33f69d)=>{_0x7c3fd[_0x33f69d]['floorlevel']=_0x4b4bc6;}),_0x1b49a1[_0x426ee1(0xf2)]((_0x9c0f27,_0x4762db)=>{_0x7c3fd[_0x4762db]['primary_code']=_0x9c0f27;}),_0x1dd584[_0x426ee1(0xf2)]((_0x5bbcfc,_0x589dfc)=>{var _0x262466=_0x426ee1;_0x7c3fd[_0x589dfc][_0x262466(0xbe)]=_0x5bbcfc;}),_0x253208['forEach']((_0x236a55,_0x5a8dff)=>{var _0x47b62a=_0x426ee1;_0x7c3fd[_0x5a8dff][_0x47b62a(0x184)]=_0x236a55;}),_0x355b2d[_0x426ee1(0xf2)]((_0x3dbb1d,_0x1cad81)=>{var _0x218105=_0x426ee1;_0x7c3fd[_0x1cad81][_0x218105(0xf4)]=_0x3dbb1d;}),_0xd3e5b1[_0x426ee1(0xf2)]((_0x396c6b,_0x3ac4db)=>{var _0x2bd6a6=_0x426ee1;_0x7c3fd[_0x3ac4db][_0x2bd6a6(0x139)]=_0x396c6b;}),_0x15e402[_0x426ee1(0xf2)]((_0x99a45,_0x183fad)=>{var _0x3e4699=_0x426ee1;_0x7c3fd[_0x183fad][_0x3e4699(0x15f)]=_0x99a45;}),_0x28f5a3[_0x426ee1(0xf2)]((_0x7cbe3f,_0x565cbc)=>{var _0x38c946=_0x426ee1;_0x7c3fd[_0x565cbc][_0x38c946(0x123)]=_0x7cbe3f;}),_0x1f51f6[_0x426ee1(0xf2)]((_0x2354b1,_0x20e47f)=>{var _0xe4cd95=_0x426ee1;_0x7c3fd[_0x20e47f][_0xe4cd95(0x151)]=_0x2354b1;});const _0xd6c7e1=_0x7c3fd['filter'](_0x191d1d=>_0x191d1d['quantity']!=='0'&&_0x191d1d[_0x426ee1(0x17d)]!=='');_0xba1dec[_0x426ee1(0xa8)]=_0x3c4d0f,_0xba1dec[_0x426ee1(0xb7)]=_0x30b664,_0xba1dec[_0x426ee1(0x118)]=_0x4d4b47,_0xba1dec[_0x426ee1(0x19e)]=_0x361d95,_0xba1dec[_0x426ee1(0x175)]=_0xd6c7e1,_0xba1dec[_0x426ee1(0x17f)]=_0x1a9840,_0xba1dec['paid_amount']=_0x1ef424,_0xba1dec[_0x426ee1(0xf3)]=_0x328702,_0xba1dec[_0x426ee1(0xe4)]=_0xe39896,_0xba1dec[_0x426ee1(0xff)]=_0x52b19c,_0xba1dec[_0x426ee1(0xcd)]=_0x2f7a9c;const _0x9e67c4=await _0xba1dec[_0x426ee1(0x10d)](),_0x227d85=await warehouse[_0x426ee1(0x144)]({'name':_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0x19e)],'room':_0xed568f[_0x426ee1(0x18e)]['Room_name']});_0xba1dec['product'][_0x426ee1(0xf2)](_0x464b35=>{var _0x3b4307=_0x426ee1,_0x244707=0x0;const _0x5ced51=_0x227d85[_0x3b4307(0xc8)][_0x3b4307(0x1a6)](_0x34625e=>{var _0xc0f6f5=_0x3b4307;_0x34625e[_0xc0f6f5(0x14b)]==_0x464b35['product_name']&&_0x34625e[_0xc0f6f5(0xc5)]==_0x464b35['floorlevel']&&_0x34625e[_0xc0f6f5(0x15f)]==_0x464b35[_0xc0f6f5(0x15f)]&&_0x34625e[_0xc0f6f5(0x100)]==_0x464b35['bin']&&_0x34625e[_0xc0f6f5(0x1a9)]==_0x464b35[_0xc0f6f5(0x1a9)]&&_0x34625e[_0xc0f6f5(0x151)]==_0x464b35[_0xc0f6f5(0x151)]&&_0x34625e[_0xc0f6f5(0x123)]==_0x464b35[_0xc0f6f5(0x123)]&&(_0x34625e['product_stock']=parseInt(_0x34625e[_0xc0f6f5(0xf5)])+parseInt(_0x464b35[_0xc0f6f5(0x17d)]),_0x244707++);});_0x244707=='0'&&(_0x227d85[_0x3b4307(0xc8)]=_0x227d85['product_details'][_0x3b4307(0x106)]({'product_name':_0x464b35['product_name'],'product_stock':_0x464b35[_0x3b4307(0x17d)],'primary_code':_0x464b35['primary_code'],'secondary_code':_0x464b35[_0x3b4307(0xbe)],'product_code':_0x464b35[_0x3b4307(0x167)],'storage':_0x464b35[_0x3b4307(0x123)],'rack':_0x464b35['rack'],'bay':_0x464b35[_0x3b4307(0x1a9)],'bin':_0x464b35['bin'],'type':_0x464b35[_0x3b4307(0x15f)],'floorlevel':_0x464b35[_0x3b4307(0xc5)],'maxProducts':_0x464b35[_0x3b4307(0x184)],'unit':_0x464b35[_0x3b4307(0xc3)],'secondary_unit':_0x464b35[_0x3b4307(0x12d)],'expiry_date':_0x464b35[_0x3b4307(0x139)]}));}),await _0x227d85[_0x426ee1(0x10d)]();const _0x598983=await s_payment_data[_0x426ee1(0x144)]({'invoice':_0xed568f[_0x426ee1(0x18e)]['invoice']});if(_0x598983===null){}else console[_0x426ee1(0x12e)](_0x426ee1(0xb7),_0x598983,_0xed568f[_0x426ee1(0x18e)]['invoice']),_0x598983['suppliers']=_0xed568f[_0x426ee1(0x18e)][_0x426ee1(0xb7)],await _0x598983[_0x426ee1(0x10d)]();_0xed568f[_0x426ee1(0x11f)](_0x426ee1(0x155),_0x426ee1(0x116)),_0x5d6d45['redirect'](_0x426ee1(0xdc));}catch(_0x2976ff){console['log'](_0x2976ff);}}),router[a0_0x2c46bb(0x12a)](a0_0x2c46bb(0xf8),auth,async(_0x527cc2,_0x153204)=>{var _0x386a42=a0_0x2c46bb;try{const _0x57aa5d=_0x527cc2[_0x386a42(0x17c)]['id'],{invoice:_0x3eaa3a,suppliers:_0x23ddc5,payable:_0x22c3ac,due_amount:_0x3635d6}=_0x527cc2[_0x386a42(0x18e)],_0x56e044=await purchases[_0x386a42(0xb4)](_0x57aa5d);var _0x1f8ff9=_0x22c3ac-_0x3635d6;_0x56e044[_0x386a42(0x11c)]=parseFloat(_0x56e044['paid_amount'])+parseFloat(_0x3635d6),_0x56e044['due_amount']=_0x1f8ff9;const _0x5edcbd=await _0x56e044[_0x386a42(0x10d)]();console['log'](_0x5edcbd);const _0x3ebeeb=await s_payment_data['findOne']({'invoice':_0x3eaa3a});_0x3ebeeb[_0x386a42(0x177)]=_0x1f8ff9,await _0x3ebeeb[_0x386a42(0x10d)]();let _0x5983d0=new Date(),_0x24b2bd=('0'+_0x5983d0['getDate']())[_0x386a42(0xf7)](-0x2),_0x234eea=('0'+(_0x5983d0[_0x386a42(0xe2)]()+0x1))[_0x386a42(0xf7)](-0x2),_0x2d4f21=_0x5983d0['getFullYear'](),_0x29d88e=_0x2d4f21+'-'+_0x234eea+'-'+_0x24b2bd;const _0x5ca152=new suppliers_payment({'invoice':_0x3eaa3a,'date':_0x2d4f21+'-'+_0x234eea+'-'+_0x24b2bd,'suppliers':_0x23ddc5,'reason':_0x386a42(0xcf),'amount':_0x3635d6}),_0x368ae0=await _0x5ca152['save']();_0x527cc2[_0x386a42(0x11f)]('success','payment\x20successfull'),_0x153204[_0x386a42(0x189)](_0x386a42(0xdc));}catch(_0x24a042){console[_0x386a42(0x12e)](_0x24a042);}}),router[a0_0x2c46bb(0xaf)]('/invoice/:id',auth,async(_0x196963,_0xb4ed13)=>{var _0x54f524=a0_0x2c46bb;try{const {username:_0xd38f3d,email:_0x25be4f,role:_0x1dd76c}=_0x196963['user'],_0x429d3e=_0x196963[_0x54f524(0x1ad)],_0x14670a=await profile[_0x54f524(0x144)]({'email':_0x429d3e[_0x54f524(0x172)]}),_0x991de1=await master_shop['find']();console[_0x54f524(0x12e)](_0x54f524(0x9c),_0x991de1);const _0x187bca=_0x196963[_0x54f524(0x17c)]['id'],_0x5f55cd=await purchases['findById'](_0x187bca);console[_0x54f524(0x12e)](_0x5f55cd);const _0x5bd91c=await suppliers[_0x54f524(0x144)]({'name':_0x5f55cd[_0x54f524(0xb7)]});console[_0x54f524(0x12e)](_0x5bd91c);if(_0x991de1[0x0]['language']==_0x54f524(0xab)){var _0x5e061b=users[_0x54f524(0x169)];console[_0x54f524(0x12e)](_0x5e061b);}else{if(_0x991de1[0x0][_0x54f524(0x113)]==_0x54f524(0xe6))var _0x5e061b=users[_0x54f524(0xe6)];else{if(_0x991de1[0x0][_0x54f524(0x113)]=='German')var _0x5e061b=users[_0x54f524(0xd5)];else{if(_0x991de1[0x0][_0x54f524(0x113)]==_0x54f524(0x195))var _0x5e061b=users[_0x54f524(0x195)];else{if(_0x991de1[0x0][_0x54f524(0x113)]==_0x54f524(0x18a))var _0x5e061b=users[_0x54f524(0x18a)];else{if(_0x991de1[0x0]['language']==_0x54f524(0x115))var _0x5e061b=users[_0x54f524(0x117)];else{if(_0x991de1[0x0][_0x54f524(0x113)]=='Chinese')var _0x5e061b=users['Chinese'];else{if(_0x991de1[0x0][_0x54f524(0x113)]==_0x54f524(0x138))var _0x5e061b=users[_0x54f524(0x197)];}}}}}}}_0xb4ed13[_0x54f524(0x196)](_0x54f524(0x1a2),{'success':_0x196963[_0x54f524(0x11f)](_0x54f524(0x155)),'errors':_0x196963['flash']('errors'),'role':_0x429d3e,'profile':_0x14670a,'master_shop':_0x991de1,'supplier':_0x5bd91c,'purchase':_0x5f55cd,'language':_0x5e061b});}catch(_0x35cec0){console[_0x54f524(0x12e)](_0x35cec0);}}),router['get'](a0_0x2c46bb(0x19d),auth,async(_0x188d28,_0x493833)=>{var _0x527183=a0_0x2c46bb;try{const {username:_0x1047a5,email:_0x2822a7,role:_0x238136}=_0x188d28[_0x527183(0x1ad)],_0x11aa5f=_0x188d28['user'],_0x4df8a7=await profile[_0x527183(0x144)]({'email':_0x11aa5f[_0x527183(0x172)]}),_0x1e397a=await master_shop[_0x527183(0x153)]();console[_0x527183(0x12e)](_0x527183(0x9c),_0x1e397a);const _0x2a7683=_0x188d28['params']['id'];console[_0x527183(0x12e)](_0x2a7683);const _0x426c22=await purchases[_0x527183(0xb4)](_0x2a7683);console[_0x527183(0x12e)](_0x527183(0x10a),_0x426c22);const _0x3d977c=await product['find']({}),_0x5e60a6=await warehouse[_0x527183(0x14f)]([{'$match':{'name':_0x426c22['warehouse_name'],'room':_0x426c22[_0x527183(0xe4)],'warehouse_category':_0x527183(0x188)}},{'$unwind':_0x527183(0x145)},{'$group':{'_id':_0x527183(0x14d),'name':{'$first':_0x527183(0x1b1)},'product_stock':{'$first':_0x527183(0xed)},'bay':{'$first':_0x527183(0x16b)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x527183(0x19b)},'floorlevel':{'$first':_0x527183(0xaa)},'primary_code':{'$first':_0x527183(0x9e)},'secondary_code':{'$first':_0x527183(0xe8)},'product_code':{'$first':_0x527183(0x146)},'storage':{'$first':_0x527183(0xec)},'rack':{'$first':_0x527183(0x15b)}}}]);warehouse_data=await warehouse[_0x527183(0x14f)]([{'$match':{'status':_0x527183(0xd2),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x527183(0x107),'name':{'$first':_0x527183(0x107)}}},{'$sort':{'name':0x1}}]),console[_0x527183(0x12e)](_0x527183(0x1b3),_0x5e60a6);if(_0x1e397a[0x0][_0x527183(0x113)]=='English\x20(US)'){var _0x16b0b7=users[_0x527183(0x169)];console['log'](_0x16b0b7);}else{if(_0x1e397a[0x0][_0x527183(0x113)]==_0x527183(0xe6))var _0x16b0b7=users[_0x527183(0xe6)];else{if(_0x1e397a[0x0][_0x527183(0x113)]==_0x527183(0xd5))var _0x16b0b7=users['German'];else{if(_0x1e397a[0x0][_0x527183(0x113)]=='Spanish')var _0x16b0b7=users[_0x527183(0x195)];else{if(_0x1e397a[0x0][_0x527183(0x113)]==_0x527183(0x18a))var _0x16b0b7=users[_0x527183(0x18a)];else{if(_0x1e397a[0x0][_0x527183(0x113)]==_0x527183(0x115))var _0x16b0b7=users[_0x527183(0x117)];else{if(_0x1e397a[0x0][_0x527183(0x113)]==_0x527183(0x136))var _0x16b0b7=users[_0x527183(0x136)];else{if(_0x1e397a[0x0][_0x527183(0x113)]=='Arabic\x20(ae)')var _0x16b0b7=users[_0x527183(0x197)];}}}}}}}_0x493833[_0x527183(0x196)](_0x527183(0x10c),{'success':_0x188d28['flash'](_0x527183(0x155)),'errors':_0x188d28[_0x527183(0x11f)](_0x527183(0x1b4)),'role':_0x11aa5f,'profile':_0x4df8a7,'user':_0x426c22,'stock':_0x5e60a6,'master_shop':_0x1e397a,'product':_0x3d977c,'language':_0x16b0b7,'warehouse':warehouse_data});}catch(_0x3d35b7){console[_0x527183(0x12e)](_0x3d35b7);}}),router['post'](a0_0x2c46bb(0x19d),auth,async(_0x2ebf15,_0x3c15dd)=>{var _0x4fa195=a0_0x2c46bb;try{const {invoice:_0x1900e2,date:_0x83d79a,warehouse_name:_0x5ece41,Room_name:_0x1703d5,product_name:_0x2e6b24,purchase_quantity:_0x1aeea1,stocks:_0x7a9174,return_qty:_0x523789,note:_0x1c36af,level:_0x2cbdec,isle:_0x154270,pallet:_0x9f0811,to_warehouse_name:_0x180087,to_Room_name:_0x2e9839}=_0x2ebf15[_0x4fa195(0x18e)],_0x296ff3=await purchases[_0x4fa195(0x144)]({'_id':_0x2ebf15[_0x4fa195(0x17c)]['id']}),_0x3cfce1=await warehouse[_0x4fa195(0x144)]({'name':_0x5ece41,'room':_0x1703d5});if(typeof _0x2e6b24==_0x4fa195(0x174))var _0x56c963=[_0x2ebf15[_0x4fa195(0x18e)]['product_name']],_0x396635=[_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x191)]],_0x43fc6d=[_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x1a0)]],_0x14c2d8=[_0x2ebf15['body'][_0x4fa195(0x142)]],_0x1cb898=[_0x2ebf15['body'][_0x4fa195(0xa5)]],_0x592b93=[_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x187)]],_0x2b5de5=[_0x2ebf15[_0x4fa195(0x18e)]['pallet']],_0x294b3e=[_0x2ebf15['body'][_0x4fa195(0x171)]],_0x72d0b0=[_0x2ebf15[_0x4fa195(0x18e)]['product_code_hide']],_0x208ee3=[_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x194)]],_0x104c25=[_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x1aa)]];else var _0x56c963=[..._0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x14b)]],_0x396635=[..._0x2ebf15['body'][_0x4fa195(0x191)]],_0x43fc6d=[..._0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x1a0)]],_0x14c2d8=[..._0x2ebf15['body'][_0x4fa195(0x142)]],_0x1cb898=[..._0x2ebf15['body']['level']],_0x592b93=[..._0x2ebf15['body'][_0x4fa195(0x187)]],_0x2b5de5=[..._0x2ebf15['body'][_0x4fa195(0x11a)]],_0x294b3e=[..._0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x171)]],_0x72d0b0=[..._0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x108)]],_0x208ee3=[..._0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0x194)]],_0x104c25=[..._0x2ebf15['body'][_0x4fa195(0x1aa)]];const _0x261b4d=_0x56c963[_0x4fa195(0x1a6)](_0x3eeb80=>{return _0x3eeb80={'product_name':_0x3eeb80};});_0x396635[_0x4fa195(0xf2)]((_0x444a10,_0x116c85)=>{var _0x58f168=_0x4fa195;_0x261b4d[_0x116c85][_0x58f168(0x191)]=_0x444a10;}),_0x43fc6d['forEach']((_0x281de8,_0x393ece)=>{var _0x50d068=_0x4fa195;_0x261b4d[_0x393ece][_0x50d068(0xbf)]=_0x281de8;}),_0x14c2d8[_0x4fa195(0xf2)]((_0xbc9ec2,_0x4e5224)=>{var _0x1ecad1=_0x4fa195;_0x261b4d[_0x4e5224][_0x1ecad1(0x142)]=_0xbc9ec2;}),_0x1cb898['forEach']((_0xfcdfc0,_0x153e4f)=>{_0x261b4d[_0x153e4f]['bay']=_0xfcdfc0;}),_0x592b93[_0x4fa195(0xf2)]((_0x249e05,_0x2e597f)=>{var _0x420259=_0x4fa195;_0x261b4d[_0x2e597f][_0x420259(0x100)]=_0x249e05;}),_0x2b5de5['forEach']((_0x5d83b6,_0x3506c6)=>{var _0x594e72=_0x4fa195;_0x261b4d[_0x3506c6][_0x594e72(0xc5)]=_0x5d83b6;}),_0x294b3e[_0x4fa195(0xf2)]((_0x450803,_0x127b50)=>{_0x261b4d[_0x127b50]['type']=_0x450803;}),_0x72d0b0[_0x4fa195(0xf2)]((_0x255bcf,_0x4e3bd5)=>{var _0x1c81fe=_0x4fa195;_0x261b4d[_0x4e3bd5][_0x1c81fe(0x167)]=_0x255bcf;}),_0x208ee3[_0x4fa195(0xf2)]((_0x44f803,_0x570e70)=>{var _0x1c7fa6=_0x4fa195;_0x261b4d[_0x570e70][_0x1c7fa6(0x131)]=_0x44f803;}),_0x104c25[_0x4fa195(0xf2)]((_0x3dbada,_0x58f526)=>{var _0x2f0354=_0x4fa195;_0x261b4d[_0x58f526][_0x2f0354(0xbe)]=_0x3dbada;}),_0x296ff3[_0x4fa195(0x175)]['forEach'](_0x41c5fe=>{var _0x16b1f2=_0x4fa195;const _0x2cd0c2=_0x3cfce1[_0x16b1f2(0xc8)]['map'](_0x36da77=>{var _0x2fc013=_0x16b1f2;_0x36da77[_0x2fc013(0x14b)]==_0x41c5fe[_0x2fc013(0x14b)]&&_0x36da77[_0x2fc013(0xc5)]==_0x41c5fe[_0x2fc013(0xc5)]&&_0x36da77[_0x2fc013(0x15f)]==_0x41c5fe['type']&&_0x36da77['bin']==_0x41c5fe[_0x2fc013(0x100)]&&_0x36da77['bay']==_0x41c5fe[_0x2fc013(0x1a9)]&&_0x36da77[_0x2fc013(0x151)]==_0x41c5fe[_0x2fc013(0x151)]&&_0x36da77['storage']==_0x41c5fe[_0x2fc013(0x123)]&&(console[_0x2fc013(0x12e)](parseInt(_0x36da77[_0x2fc013(0xf5)])+_0x2fc013(0xfb)+parseInt(_0x41c5fe[_0x2fc013(0x17d)])),_0x36da77[_0x2fc013(0xf5)]=parseInt(_0x36da77[_0x2fc013(0xf5)])+parseInt(_0x41c5fe[_0x2fc013(0x17d)]));});}),await _0x3cfce1['save']();const _0x59e8e0=_0x261b4d[_0x4fa195(0x160)](_0x4342ae=>_0x4342ae[_0x4fa195(0x142)]!=='0'&&_0x4342ae[_0x4fa195(0x142)]!=='');var _0x4372b0=0x0;_0x59e8e0[_0x4fa195(0xf2)](_0x5856e5=>{var _0x10f5ff=_0x4fa195;console[_0x10f5ff(0x12e)]('foreach\x20newproduct',_0x5856e5),(parseInt(_0x5856e5[_0x10f5ff(0x191)])<parseInt(_0x5856e5[_0x10f5ff(0x142)])||parseInt(_0x5856e5[_0x10f5ff(0xbf)])<parseInt(_0x5856e5[_0x10f5ff(0x142)]))&&_0x4372b0++;});if(_0x4372b0!=0x0)return _0x2ebf15[_0x4fa195(0x11f)](_0x4fa195(0x1b4),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3c15dd[_0x4fa195(0x189)](_0x4fa195(0x148));const _0xccbfac=new purchases_return({'invoice':_0x1900e2,'suppliers':_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0xb7)],'date':_0x83d79a,'warehouse_name':_0x5ece41,'return_product':_0x59e8e0,'note':_0x1c36af,'room':_0x1703d5,'to_warehouse_name':_0x180087,'to_room':_0x2e9839}),_0xe19b2d=await _0xccbfac[_0x4fa195(0x10d)]();console[_0x4fa195(0x12e)](_0xccbfac);const _0x1c85c1=await purchases_return['findOne']({'invoice':_0x1900e2}),_0x4416fc=await warehouse[_0x4fa195(0x144)]({'name':_0x180087,'room':_0x2e9839});_0x1c85c1[_0x4fa195(0x14e)]['forEach'](_0x4097a1=>{var _0x37ad61=_0x4fa195,_0x3364e6=0x0;const _0x2a1331=_0x4416fc[_0x37ad61(0xc8)]['map'](_0x21a6bd=>{var _0x4bc7d5=_0x37ad61;_0x21a6bd[_0x4bc7d5(0x14b)]==_0x4097a1[_0x4bc7d5(0x14b)]&&_0x21a6bd['floorlevel']==_0x4097a1[_0x4bc7d5(0xc5)]&&_0x21a6bd['type']==_0x4097a1[_0x4bc7d5(0x15f)]&&_0x21a6bd[_0x4bc7d5(0x100)]==_0x4097a1['bin']&&_0x21a6bd[_0x4bc7d5(0x1a9)]==_0x4097a1[_0x4bc7d5(0x1a9)]&&(_0x21a6bd['product_stock']=parseInt(_0x21a6bd[_0x4bc7d5(0xf5)])-parseInt(_0x4097a1[_0x4bc7d5(0x142)]),_0x3364e6++);});_0x3364e6=='0'&&(_0x4416fc['product_details']=_0x4416fc[_0x37ad61(0xc8)][_0x37ad61(0x106)]({'product_name':_0x4097a1['product_name'],'product_stock':_0x4097a1[_0x37ad61(0x142)],'primary_code':_0x4097a1[_0x37ad61(0x131)],'secondary_code':_0x4097a1['secondary_code'],'product_code':_0x4097a1[_0x37ad61(0x167)],'storage':_0x4097a1['storage'],'rack':_0x4097a1[_0x37ad61(0x151)],'bay':_0x4097a1['bay'],'bin':_0x4097a1['bin'],'type':_0x4097a1[_0x37ad61(0x15f)],'floorlevel':_0x4097a1[_0x37ad61(0xc5)],'maxProducts':_0x4097a1[_0x37ad61(0x184)],'unit':_0x4097a1[_0x37ad61(0xc3)],'secondary_unit':_0x4097a1['secondary_unit'],'expiry_date':_0x4097a1[_0x37ad61(0x139)]}));}),await _0x4416fc[_0x4fa195(0x10d)]();const _0x36f79c=await purchases[_0x4fa195(0x144)]({'invoice':_0x1900e2});_0x36f79c['return_data']=_0x4fa195(0x137);const _0x333a03=await _0x36f79c[_0x4fa195(0x10d)](),_0xfcef62=new s_payment_data({'invoice':_0x1900e2,'suppliers':_0x2ebf15['body']['suppliers'],'reason':_0x4fa195(0x112)});await _0xfcef62[_0x4fa195(0x10d)]();const _0x4f865d=await master_shop[_0x4fa195(0x153)]();console['log'](_0x4fa195(0x13b),_0x4f865d[0x0][_0x4fa195(0x176)]);const _0x409412=await email_settings['findOne'](),_0x407953=await suppliers['findOne']({'name':_0x2ebf15[_0x4fa195(0x18e)][_0x4fa195(0xb7)]});console[_0x4fa195(0x12e)](_0x4fa195(0x9b),_0x407953);_0x4f865d[0x0][_0x4fa195(0x121)]==0x1?(right_currency=_0x4f865d[0x0][_0x4fa195(0x114)],left_currency=''):(right_currency='',left_currency=_0x4f865d[0x0]['currency']);var _0x45bef2=_0x56c963,_0x2af55b=_0x14c2d8,_0x444c88='',_0x50e017;for(_0x50e017 in _0x45bef2){_0x444c88+=_0x4fa195(0x170)+_0x4fa195(0x1a5)+_0x45bef2[_0x50e017]+'</td>'+_0x4fa195(0x1a5)+_0x2af55b[_0x50e017]+_0x4fa195(0x120)+'</tr>';}console[_0x4fa195(0x12e)](_0x4fa195(0x104),_0x444c88);let _0x1247ef=nodemailer[_0x4fa195(0x1b2)]({'service':_0x4fa195(0xf1),'auth':{'user':_0x409412[_0x4fa195(0x172)],'pass':_0x409412[_0x4fa195(0x12c)]}}),_0x533594={'from':_0x409412[_0x4fa195(0x172)],'to':_0x407953[_0x4fa195(0x172)],'subject':_0x4fa195(0x99),'attachments':[{'filename':_0x4fa195(0xad),'path':__dirname+_0x4fa195(0x124)+_0x4fa195(0xb6)+_0x4f865d[0x0]['image'],'cid':_0x4fa195(0xf6)}],'html':'<!DOCTYPE\x20html>'+_0x4fa195(0x10e)+'</head><body>'+'<div>'+_0x4fa195(0x147)+_0x4fa195(0xa1)+_0x4fa195(0xe0)+_0x4fa195(0x19c)+'<div>'+'<h2>\x20'+_0x4f865d[0x0]['site_title']+_0x4fa195(0x1af)+_0x4fa195(0x19c)+'</div>'+_0x4fa195(0xd8)+_0x4fa195(0xa1)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4fa195(0x125)+_0x1900e2+'\x20'+_0x4fa195(0xd7)+_0x4fa195(0xef)+_0x83d79a+'\x20'+_0x4fa195(0x13d)+_0x4fa195(0x98)+_0x4fa195(0x19c)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4fa195(0x96)+_0x4fa195(0x170)+_0x4fa195(0x127)+_0x4fa195(0x164)+_0x4fa195(0x178)+_0x4fa195(0x150)+_0x4fa195(0x1ac)+_0x4fa195(0x15e)+_0x4fa195(0x14a)+'\x20'+_0x444c88+'\x20'+_0x4fa195(0xfc)+_0x4fa195(0x1a8)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x4fa195(0x13e)+_0x4f865d[0x0]['site_title']+_0x4fa195(0x98)+_0x4fa195(0x19c)+_0x4fa195(0x19c)+'</body></html>'};_0x1247ef['sendMail'](_0x533594,function(_0x373834,_0xf26c61){var _0x51487f=_0x4fa195;_0x373834?(console[_0x51487f(0x12e)](_0x373834),console[_0x51487f(0x12e)](_0x51487f(0x135))):console[_0x51487f(0x12e)]('Email\x20sent\x20successfully');}),_0x2ebf15['flash'](_0x4fa195(0x155),'purchases\x20item\x20return\x20successfull'),_0x3c15dd[_0x4fa195(0x189)](_0x4fa195(0xdc));}catch(_0x354a56){console['log'](_0x354a56),_0x3c15dd['status'](0xc8)['json']({'message':_0x354a56['message']});}}),router[a0_0x2c46bb(0xaf)](a0_0x2c46bb(0xde),auth,async(_0x21bdaa,_0x16841d)=>{var _0x3c8397=a0_0x2c46bb;try{const {username:_0xeab5b2,email:_0x59ebe7,role:_0x16729f}=_0x21bdaa[_0x3c8397(0x1ad)],_0x311310=_0x21bdaa[_0x3c8397(0x1ad)],_0x563158=await profile[_0x3c8397(0x144)]({'email':_0x311310[_0x3c8397(0x172)]}),_0x3d0ce9=await master_shop[_0x3c8397(0x153)](),_0x17cb7b=_0x21bdaa[_0x3c8397(0x17c)]['id'],_0x4429c8=await purchases[_0x3c8397(0xb4)](_0x17cb7b);if(_0x3d0ce9[0x0][_0x3c8397(0x113)]=='English\x20(US)')var _0x145899=users['English'];else{if(_0x3d0ce9[0x0]['language']==_0x3c8397(0xe6))var _0x145899=users[_0x3c8397(0xe6)];else{if(_0x3d0ce9[0x0][_0x3c8397(0x113)]==_0x3c8397(0xd5))var _0x145899=users['German'];else{if(_0x3d0ce9[0x0][_0x3c8397(0x113)]==_0x3c8397(0x195))var _0x145899=users[_0x3c8397(0x195)];else{if(_0x3d0ce9[0x0]['language']==_0x3c8397(0x18a))var _0x145899=users['French'];else{if(_0x3d0ce9[0x0]['language']==_0x3c8397(0x115))var _0x145899=users[_0x3c8397(0x117)];else{if(_0x3d0ce9[0x0][_0x3c8397(0x113)]=='Chinese')var _0x145899=users['Chinese'];else{if(_0x3d0ce9[0x0][_0x3c8397(0x113)]==_0x3c8397(0x138))var _0x145899=users['Arabic'];}}}}}}}_0x16841d[_0x3c8397(0x196)]('all_purchases_barcode',{'success':_0x21bdaa[_0x3c8397(0x11f)](_0x3c8397(0x155)),'errors':_0x21bdaa[_0x3c8397(0x11f)](_0x3c8397(0x1b4)),'role':_0x311310,'profile':_0x563158,'alldata':_0x4429c8,'master_shop':_0x3d0ce9,'language':_0x145899}),console[_0x3c8397(0x12e)](alldata);}catch(_0x532be1){console[_0x3c8397(0x12e)](_0x532be1);}}),router[a0_0x2c46bb(0x12a)](a0_0x2c46bb(0xeb),async(_0x14bdb2,_0x3d4f99)=>{var _0x487471=a0_0x2c46bb;const {product_code:_0x426aef}=_0x14bdb2[_0x487471(0x18e)];var _0x19f2c2;const _0x199689=await product[_0x487471(0x14f)]([{'$match':{'primary_code':_0x426aef,'product_category':_0x487471(0x188)}},{'$group':{'_id':_0x487471(0xb8),'name':{'$first':'$name'},'category':{'$first':_0x487471(0x13f)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x487471(0x163)},'product_code':{'$first':_0x487471(0xc2)},'primary_code':{'$first':_0x487471(0x17a)},'secondary_code':{'$first':_0x487471(0x133)},'maxStocks':{'$first':_0x487471(0xcc)},'maxProdPerUnit':{'$first':_0x487471(0x192)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x487471(0x12b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4dec41=await product[_0x487471(0x14f)]([{'$match':{'secondary_code':_0x426aef,'product_category':_0x487471(0x188)}},{'$group':{'_id':_0x487471(0xb8),'name':{'$first':_0x487471(0x107)},'category':{'$first':_0x487471(0x13f)},'brand':{'$first':'$brand'},'unit':{'$first':_0x487471(0x1b6)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x487471(0xc2)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x487471(0xcc)},'maxProdPerUnit':{'$first':_0x487471(0x192)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x487471(0x12b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x199689[_0x487471(0x149)]>0x0)_0x19f2c2=_0x199689;else _0x4dec41[_0x487471(0x149)]>0x0&&(_0x19f2c2=_0x4dec41);_0x3d4f99[_0x487471(0xc1)](_0x19f2c2);}),router[a0_0x2c46bb(0x12a)](a0_0x2c46bb(0x19a),async(_0x4b118d,_0x5eb437)=>{var _0x4b27eb=a0_0x2c46bb;const {primaryCode:_0x3f23c6,secondaryCode:_0x2efde8,productCode:_0x564939,bay:_0x2e7f03,bin:_0x55d0ad,types:_0x3986b9,pallet:_0x3492a5,warehouses:_0x57cd4e,room:_0x4acbf2}=_0x4b118d['body'];console[_0x4b27eb(0x12e)](_0x4b118d[_0x4b27eb(0x18e)]);try{const _0x579140=await warehouse[_0x4b27eb(0x14f)]([{'$match':{'name':_0x57cd4e,'room':_0x4acbf2}},{'$unwind':_0x4b27eb(0x145)},{'$match':{'product_details.bay':_0x2e7f03,'product_details.bin':_0x55d0ad,'product_details.type':_0x3986b9}},{'$group':{'_id':_0x4b27eb(0x14d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4b27eb(0xed)},'level':{'$first':_0x4b27eb(0x10f)},'isle':{'$first':_0x4b27eb(0x109)},'pallet':{'$first':_0x4b27eb(0x185)},'maxProducts':{'$first':_0x4b27eb(0x1b0)}}}]);_0x5eb437[_0x4b27eb(0x97)](0xc8)[_0x4b27eb(0xc1)](_0x579140);}catch(_0x1aecc6){_0x5eb437[_0x4b27eb(0x97)](0x194)[_0x4b27eb(0xc1)]({'message':_0x1aecc6['message']});}}),module[a0_0x2c46bb(0xa6)]=router;