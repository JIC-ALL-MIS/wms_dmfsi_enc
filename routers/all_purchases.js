var a0_0x37dad0=a0_0x1ee5;(function(_0x22d725,_0x13774){var _0x2be0e2=a0_0x1ee5,_0x379238=_0x22d725();while(!![]){try{var _0x5c964d=-parseInt(_0x2be0e2(0x1b8))/0x1+-parseInt(_0x2be0e2(0x1c4))/0x2+parseInt(_0x2be0e2(0x1d2))/0x3+parseInt(_0x2be0e2(0x1c2))/0x4+-parseInt(_0x2be0e2(0x1a4))/0x5+parseInt(_0x2be0e2(0x186))/0x6*(-parseInt(_0x2be0e2(0x237))/0x7)+parseInt(_0x2be0e2(0x165))/0x8*(parseInt(_0x2be0e2(0x211))/0x9);if(_0x5c964d===_0x13774)break;else _0x379238['push'](_0x379238['shift']());}catch(_0x42afa1){_0x379238['push'](_0x379238['shift']());}}}(a0_0x18d5,0x27f47));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x37dad0(0x203)),auth=require('../middleware/auth'),nodemailer=require(a0_0x37dad0(0x242));var ejs=require('ejs');function a0_0x1ee5(_0x2bacc3,_0x36c347){var _0x18d5d4=a0_0x18d5();return a0_0x1ee5=function(_0x1ee521,_0x44d8b9){_0x1ee521=_0x1ee521-0x12a;var _0x4d73e1=_0x18d5d4[_0x1ee521];return _0x4d73e1;},a0_0x1ee5(_0x2bacc3,_0x36c347);}const path=require(a0_0x37dad0(0x184)),users=require(a0_0x37dad0(0x169));router[a0_0x37dad0(0x233)](a0_0x37dad0(0x171),auth,async(_0x1c1eff,_0x1ce54f)=>{var _0x11ebdf=a0_0x37dad0;try{const {username:_0x22f318,email:_0x51c472,role:_0x4ee6ee}=_0x1c1eff[_0x11ebdf(0x143)],_0x309878=_0x1c1eff[_0x11ebdf(0x143)],_0x565899=await profile[_0x11ebdf(0x183)]({'email':_0x309878[_0x11ebdf(0x12b)]}),_0x4bbc50=await staff[_0x11ebdf(0x183)]({'email':_0x309878['email']});if(_0x309878[_0x11ebdf(0x19b)]=='staff'){const _0x45571f=await staff['findOne']({'email':_0x309878[_0x11ebdf(0x12b)]});}const _0x37fa48=await master_shop[_0x11ebdf(0x164)]();let _0x268d7a;if(_0x309878[_0x11ebdf(0x19b)]==_0x11ebdf(0x162)){const _0xfa6b03=await staff['findOne']({'email':_0x309878[_0x11ebdf(0x12b)]});_0x268d7a=await purchases[_0x11ebdf(0x230)]([{'$match':{'warehouse_name':_0xfa6b03[_0x11ebdf(0x14d)]}},{'$lookup':{'from':_0x11ebdf(0x1d9),'localField':_0x11ebdf(0x1d9),'foreignField':'name','as':_0x11ebdf(0x23f)}},{'$unwind':_0x11ebdf(0x181)},{'$unwind':_0x11ebdf(0x1e1)},{'$group':{'_id':_0x11ebdf(0x15a),'invoice':{'$first':_0x11ebdf(0x218)},'suppliers':{'$first':_0x11ebdf(0x232)},'date':{'$first':_0x11ebdf(0x156)},'warehouse_name':{'$first':_0x11ebdf(0x1b6)},'room':{'$first':_0x11ebdf(0x18e)},'product':{'$push':_0x11ebdf(0x1e1)},'note':{'$first':_0x11ebdf(0x1a2)},'paid_amount':{'$first':_0x11ebdf(0x155)},'due_amount':{'$first':_0x11ebdf(0x160)},'return_data':{'$first':_0x11ebdf(0x13f)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x11ebdf(0x1d4)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x11ebdf(0x14e)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x11ebdf(0x177)},'type':{'$addToSet':_0x11ebdf(0x1ba)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x268d7a=await purchases[_0x11ebdf(0x230)]([{'$lookup':{'from':_0x11ebdf(0x1d9),'localField':_0x11ebdf(0x1d9),'foreignField':_0x11ebdf(0x1e9),'as':'suppliers_docs'}},{'$unwind':_0x11ebdf(0x181)},{'$unwind':_0x11ebdf(0x1e1)},{'$group':{'_id':_0x11ebdf(0x15a),'invoice':{'$first':_0x11ebdf(0x218)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x11ebdf(0x156)},'warehouse_name':{'$first':_0x11ebdf(0x1b6)},'room':{'$addToSet':_0x11ebdf(0x12a)},'product':{'$push':_0x11ebdf(0x1e1)},'note':{'$first':_0x11ebdf(0x1a2)},'paid_amount':{'$first':_0x11ebdf(0x155)},'due_amount':{'$first':_0x11ebdf(0x160)},'return_data':{'$first':_0x11ebdf(0x13f)},'batch_code':{'$first':_0x11ebdf(0x170)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x11ebdf(0x181)},'total_product_quantity':{'$sum':_0x11ebdf(0x14e)},'level':{'$addToSet':_0x11ebdf(0x216)},'isle':{'$addToSet':_0x11ebdf(0x177)},'type':{'$addToSet':_0x11ebdf(0x1ba)},'floorlevel':{'$addToSet':_0x11ebdf(0x1cd)},'finalize':{'$first':_0x11ebdf(0x190)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x37fa48[0x0][_0x11ebdf(0x199)]=='English\x20(US)'){var _0x134b6f=users[_0x11ebdf(0x138)];console[_0x11ebdf(0x1bf)](_0x134b6f);}else{if(_0x37fa48[0x0][_0x11ebdf(0x199)]==_0x11ebdf(0x141))var _0x134b6f=users['Hindi'];else{if(_0x37fa48[0x0]['language']=='German')var _0x134b6f=users[_0x11ebdf(0x20a)];else{if(_0x37fa48[0x0]['language']==_0x11ebdf(0x15e))var _0x134b6f=users[_0x11ebdf(0x15e)];else{if(_0x37fa48[0x0][_0x11ebdf(0x199)]==_0x11ebdf(0x132))var _0x134b6f=users['French'];else{if(_0x37fa48[0x0][_0x11ebdf(0x199)]==_0x11ebdf(0x207))var _0x134b6f=users[_0x11ebdf(0x1a1)];else{if(_0x37fa48[0x0][_0x11ebdf(0x199)]==_0x11ebdf(0x1dc))var _0x134b6f=users[_0x11ebdf(0x1dc)];else{if(_0x37fa48[0x0][_0x11ebdf(0x199)]==_0x11ebdf(0x154))var _0x134b6f=users['Arabic'];}}}}}}}_0x1ce54f['render']('all_purchases',{'success':_0x1c1eff['flash'](_0x11ebdf(0x19a)),'errors':_0x1c1eff[_0x11ebdf(0x1bb)]('errors'),'purchases':_0x268d7a,'role':_0x309878,'profile':_0x565899,'master_shop':_0x37fa48,'language':_0x134b6f});}catch(_0x2d1607){console['log'](_0x11ebdf(0x178),_0x2d1607),_0x1ce54f[_0x11ebdf(0x1db)](0xc8)[_0x11ebdf(0x23c)]({'message':_0x2d1607[_0x11ebdf(0x21e)]});}});function a0_0x18d5(){var _0x256ee0=['language','success','role','/view/add_purchases','<table\x20style=\x22width:\x20100%\x20!important;\x22>','rack','batch_code','types','Portuguese','$note','bin','1595110GZrpms','push','$maxProdPerUnit','/upload/','RMSEmail','createTransport','exports','\x20<>\x20','paid_amount','type','$product_details.bay','currency','quantity','</h5>','abs','Purchase\x20data\x20added\x20successfully','level','$product_code','$warehouse_name','/all_purchases/view','151459GKAgsi','slice','$product.type','flash','site_title','$brand','$product_details.product_code','log','$product_details.level','prod_invoice','621404juNSkr','Logo.png','449362psDklq','purchase_invoice','$unit','master','\x20Order\x20Date\x20:\x20','$name','<h5>','prod_Qty','prod_cat','$product.floorlevel','</tr>','forEach','currency_placement','secondary_code','361185PELkSU','prod_code','$expiry_date','password','Rack\x20A','catch','$product_details.primary_code','suppliers','here','status','Chinese','port','secondary_code_hide','floorlevel','prod_pallet','$product','product_code_hide','Enabled','$alertquantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','primary_code_hide','Floor','room','name','getMonth','prod_name','production_date','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Purchase\x20Return\x20Mail','findById','amount','due_amount','params','True','Rack\x20F','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','getDate','<div>','storage','$product_details.pallet','Enclosed','Paid\x20For\x20Purchase','$product_details.rack','</head><body>','return_qty','bay','image','map','</span>','../models/all_models','/all_purchases/view/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','add_purchases\x20error','Portuguese\x20(BR)','product_list','<html><head><title></title>','German','Receiving\x20Area','pallet','prod_qty','<strong>\x20Regards\x20</strong>','warehouse_name','add\x20post','5608242dapQHO','Email\x20sent\x20successfully','expiry_date','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.bay','/view/return_purchase/:id','$invoice','</body></html>','save','prod_unit','product_details','Rack\x20B','message','prod_isle','stock_data','Ambient','max_product_unit','Level','concat','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/invoice/:id','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.storage','$product_details.product_name','return_data','</tbody>','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<tr>','aggregate','An\x20error\x20occurred.','$suppliers','get','Rack\x20E','invoice','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','280469ybFsNp','<span\x20style=\x22float:\x20right;\x22>','RoomAssign','return_purchase','gmail','json','prod_primunit','errors','suppliers_docs','Purchase\x20Mail','<!DOCTYPE\x20html>','nodemailer','$product.room_name','email','JO_number','foreach\x20newproduct','purchase_quantity','Room_name','</table>','English\x20(US)','French','$secondary_unit','<h5\x20style=\x22text-align:\x20left;\x22>','maxperunit','then','$secondary_code','English','filter','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','body','Error\x20Occurs','Arabic','length','$return_data','\x20</h2>','Hindi','sendMail','user','secondary_unit','DRY\x20STORAGE','standard_unit','delivery_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','alertQTY','Rack\x20D','COLD\x20STORAGE','warehouse','$product.quantity','delivery_code','rak','$product_details','user_id','/view/add_purchases/:id','Arabic\x20(ae)','$paid_amount','$date','$product_details.expiry_date','actual_qty','$product_details.product_stock','$_id','logo','</thead>','/give_payment/:id','Spanish','post','$due_amount','primary_code','staff','/../public','find','8RrvFBf','edit_purchases','getFullYear','string','../public/language/languages.json','prod_level','/preview/:id','$product_details.floorlevel','error','prod_secondunit','INC-','$batch_code','/view','room_name','$maxStocks','</td>','Shelves','$product_details.type','$product.bin','table\x20page','<hr\x20class=\x22my-3\x22>','</div>','redirect','maxStocks','product_stock','product_name','actual_uom','$category','$suppliers_docs','product_cat','findOne','path','Sales\x20Update\x20successfully','6hiTyoa','product','purchases\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_code','floor','stock_quantity','Return\x20Goods','$room','$product_details.maxProducts','$finalize','MaxStocks_data','date','Raw\x20Materials','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','render','purchase\x20data\x20update\x20successfully','<tbody\x20style=\x22text-align:\x20center;\x22>'];a0_0x18d5=function(){return _0x256ee0;};return a0_0x18d5();}function BayBinSelected(_0x32200e,_0x510add){var _0x950769=a0_0x37dad0,_0x1fe8f3=[],_0x3c0ee5=[],_0x4a5572=[],_0x328ef7=[],_0x3b3f8e=[],_0x354e3f=[];let _0xe5a87f=[];if(_0x32200e==_0x950769(0x145))switch(_0x510add){case _0x950769(0x1d6):_0x1fe8f3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x3c0ee5=[0x1,0x2],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=[_0x950769(0x223),_0x950769(0x1e7)],_0x3b3f8e=['D'],_0x354e3f=['A'];break;case _0x950769(0x21d):_0x1fe8f3=[0x6,0x5,0x4,0x3,0x2,0x1],_0x3c0ee5=[0x1,0x2],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=[_0x950769(0x223),_0x950769(0x1e7)],_0x3b3f8e=['D'],_0x354e3f=['B'];break;case _0x950769(0x175):_0x1fe8f3=[0x0],_0x3c0ee5=[0x0],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=[_0x950769(0x1e7)],_0x3b3f8e=['D'],_0x354e3f=['S'];break;case _0x950769(0x20b):_0x1fe8f3=[0x0],_0x3c0ee5=[0x0],_0x328ef7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4a5572=[_0x950769(0x1e7)],_0x3b3f8e=['D'],_0x354e3f=['R'];break;}else{if(_0x32200e==_0x950769(0x14c))switch(_0x510add){case _0x950769(0x1d6):_0x1fe8f3=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x3c0ee5=['B','F'],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=[_0x950769(0x223),_0x950769(0x1e7)],_0x3b3f8e=['C'],_0x354e3f=['A'];break;case _0x950769(0x21d):_0x1fe8f3=[0x5,0x4,0x3,0x2,0x1],_0x3c0ee5=['F','B','S'],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=['Level',_0x950769(0x1e7)],_0x3b3f8e=['C'],_0x354e3f=['B'];break;case'Rack\x20C':_0x1fe8f3=[0x1,0x2,0x3,0x4,0x5],_0x3c0ee5=['B','F','S'],_0x328ef7=[0x5,0x4,0x3,0x2,0x1],_0x4a5572=[_0x950769(0x223),'Floor'],_0x3b3f8e=['C'],_0x354e3f=['C'];break;case _0x950769(0x14b):_0x1fe8f3=[0x5,0x4,0x3,0x2,0x1],_0x3c0ee5=['F','B','S'],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=['Level','Floor'],_0x3b3f8e=['C'],_0x354e3f=['D'];break;case _0x950769(0x234):_0x1fe8f3=[0x4,0x3,0x2,0x1],_0x3c0ee5=[0x1,0x2],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=[_0x950769(0x223),_0x950769(0x1e7)],_0x3b3f8e=['C'],_0x354e3f=['E'];break;case _0x950769(0x1f4):_0x1fe8f3=[0x1,0x2,0x3],_0x3c0ee5=[0x1,0x2],_0x328ef7=[0x1,0x2,0x3,0x4,0x5],_0x4a5572=['Level'],_0x3b3f8e=['C'],_0x354e3f=['F'];break;}}return{'levels':_0x1fe8f3,'Isle':_0x3c0ee5,'rack':_0x328ef7,'type':_0x4a5572,'storage':_0x3b3f8e,'rak':_0x354e3f};}async function getRandom8DigitNumber(){var _0x34166c=a0_0x37dad0;const _0x515d75=0x989680,_0x21d6d1=0x5f5e0ff,_0x3b94e6=Math[_0x34166c(0x18b)](Math['random']()*(_0x21d6d1-_0x515d75+0x1))+_0x515d75;var _0x481db2;const _0x330b5c=await purchases[_0x34166c(0x183)]({'invoice':'INC-'+_0x3b94e6});return _0x330b5c&&_0x330b5c[_0x34166c(0x13e)]>0x0?_0x481db2=_0x34166c(0x16f)+_0x3b94e6:_0x481db2=_0x34166c(0x16f)+_0x3b94e6,_0x481db2;}router['get']('/view/add_purchases',auth,async(_0x30a985,_0x5d9f42)=>{var _0x3b1b38=a0_0x37dad0;try{const {username:_0x193080,email:_0x5213ba,role:_0x380e50}=_0x30a985[_0x3b1b38(0x143)],_0x22a1ff=_0x30a985['user'],_0xa8455=await profile[_0x3b1b38(0x183)]({'email':_0x22a1ff[_0x3b1b38(0x12b)]}),_0xe8f18c=await master_shop[_0x3b1b38(0x164)](),_0x16f760=await staff[_0x3b1b38(0x183)]({'email':_0x22a1ff[_0x3b1b38(0x12b)]}),_0x25c0e2=await suppliers[_0x3b1b38(0x164)]({});let _0xe4b6cd;if(_0x22a1ff[_0x3b1b38(0x19b)]=='staff'){const _0x1f9fb7=await staff[_0x3b1b38(0x183)]({'email':_0x22a1ff['email']});_0xe4b6cd=await warehouse[_0x3b1b38(0x230)]([{'$match':{'status':_0x3b1b38(0x1e3),'name':_0x1f9fb7[_0x3b1b38(0x14d)],'warehouse_category':_0x3b1b38(0x193),'name':{'$ne':_0x3b1b38(0x18d)}}},{'$group':{'_id':_0x3b1b38(0x1c9),'name':{'$first':_0x3b1b38(0x1c9)}}}]);}else _0xe4b6cd=await warehouse[_0x3b1b38(0x230)]([{'$match':{'status':_0x3b1b38(0x1e3),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x3b1b38(0x1c9)}}}]);const _0x143545=await product[_0x3b1b38(0x164)]({}),_0x2f0a6c=await warehouse[_0x3b1b38(0x164)]({'status':_0x3b1b38(0x1e3)}),_0x1eb8f3=await purchases[_0x3b1b38(0x164)]({}),_0x2014bc=_0x1eb8f3[_0x3b1b38(0x13e)]+0x1,_0x4bb9ea=_0x3b1b38(0x16f)+_0x2014bc['toString']()['padStart'](0x5,'0');var _0x2bb441=[_0x3b1b38(0x221),_0x3b1b38(0x1fa)];if(_0xe8f18c[0x0][_0x3b1b38(0x199)]==_0x3b1b38(0x131))var _0x5088cd=users[_0x3b1b38(0x138)];else{if(_0xe8f18c[0x0]['language']==_0x3b1b38(0x141))var _0x5088cd=users[_0x3b1b38(0x141)];else{if(_0xe8f18c[0x0][_0x3b1b38(0x199)]=='German')var _0x5088cd=users[_0x3b1b38(0x20a)];else{if(_0xe8f18c[0x0][_0x3b1b38(0x199)]=='Spanish')var _0x5088cd=users[_0x3b1b38(0x15e)];else{if(_0xe8f18c[0x0]['language']==_0x3b1b38(0x132))var _0x5088cd=users[_0x3b1b38(0x132)];else{if(_0xe8f18c[0x0][_0x3b1b38(0x199)]==_0x3b1b38(0x207))var _0x5088cd=users['Portuguese'];else{if(_0xe8f18c[0x0]['language']==_0x3b1b38(0x1dc))var _0x5088cd=users[_0x3b1b38(0x1dc)];else{if(_0xe8f18c[0x0][_0x3b1b38(0x199)]==_0x3b1b38(0x154))var _0x5088cd=users[_0x3b1b38(0x13d)];}}}}}}}const _0x3add00=getRandom8DigitNumber();_0x3add00[_0x3b1b38(0x136)](_0x349f7f=>{var _0x336c7a=_0x3b1b38;_0x5d9f42[_0x336c7a(0x196)]('add_purchases',{'success':_0x30a985[_0x336c7a(0x1bb)]('success'),'errors':_0x30a985['flash'](_0x336c7a(0x23e)),'role':_0x22a1ff,'profile':_0xa8455,'suppliers':_0x25c0e2,'warehouse':_0xe4b6cd,'product':_0x143545,'invoice':_0x349f7f,'master_shop':_0xe8f18c,'language':_0x5088cd,'find_data':_0x2f0a6c,'rooms_data':_0x2bb441});})[_0x3b1b38(0x1d7)](_0x3ab9fd=>{var _0x895615=_0x3b1b38;_0x30a985['flash'](_0x895615(0x23e),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5d9f42[_0x895615(0x17b)]('/all_purchases/view');});}catch(_0x5c9184){console[_0x3b1b38(0x1bf)](_0x5c9184);}}),router['get'](a0_0x37dad0(0x153),auth,async(_0x477889,_0x29e8e8)=>{var _0x3f7329=a0_0x37dad0;try{const _0x7a5cd6=_0x477889['params']['id'];console[_0x3f7329(0x1bf)](_0x7a5cd6);const _0x37a0b3=await master_shop[_0x3f7329(0x164)]();console[_0x3f7329(0x1bf)](_0x3f7329(0x1c7),_0x37a0b3);const _0x4878d2=await product[_0x3f7329(0x183)]({'name':_0x7a5cd6});console[_0x3f7329(0x1bf)](_0x3f7329(0x187),_0x4878d2),_0x29e8e8['status'](0xc8)[_0x3f7329(0x23c)]({'product_data':_0x4878d2,'master':_0x37a0b3});}catch(_0x15a2de){console[_0x3f7329(0x1bf)](_0x3f7329(0x206),_0x15a2de);}}),router[a0_0x37dad0(0x15f)](a0_0x37dad0(0x19c),auth,async(_0x4048b3,_0x3efd24)=>{var _0x16fd63=a0_0x37dad0;try{const {invoice:_0x1da7ed,date:_0x113f2c,warehouse_name:_0x2b53dc,prod_name:_0x51d2aa,prod_code:_0x24797f,prod_qty:_0x487044,prod_unit:_0x400260,prod_secondunit:_0x37673a,prod_level:_0x34a9c5,prod_isle:_0x93143b,prod_pallet:_0xab3515,note:_0x1e1c47,expiry_date:_0x4dddaf,batch_code:_0x340307,payable:_0xd2776c,due_amount:_0x166787,Room_name:_0x14cea4,primary_code:_0x396013,secondary_code:_0x2c9d09,MaxStocks_data:_0x15ce01,PO_number:_0x438180,SCRN:_0x34f14d,JO_number:_0x454d15}=_0x4048b3[_0x16fd63(0x13b)];if(typeof _0x51d2aa=='string')var _0x2c0473=[_0x4048b3[_0x16fd63(0x13b)]['prod_name']],_0x177b38=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1d3)]],_0x25f00d=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1cb)]],_0xcad03b=[_0x4048b3['body'][_0x16fd63(0x23d)]],_0x1bc5cc=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x16e)]],_0xe8ca18=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x16a)]],_0x171974=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x161)]],_0x3a31cf=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1d1)]],_0x7de076=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x191)]],_0xe45f72=[_0x4048b3['body']['batch_code']],_0x56fdae=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x213)]],_0x1a1883=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x222)]],_0x5befaf=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x14a)]],_0x19ab1f=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1ec)]],_0x26f613=[_0x4048b3[_0x16fd63(0x13b)]['prod_cat']],_0x4d959d=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x239)]],_0x4be005=[_0x4048b3[_0x16fd63(0x13b)]['deliverycode']],_0x409bce=[_0x4048b3['body']['prod_invoice']],_0x445f2a=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x158)]],_0x4cbdab=[_0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x17f)]];else var _0x2c0473=[..._0x4048b3['body'][_0x16fd63(0x1eb)]],_0x177b38=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1d3)]],_0x25f00d=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1cb)]],_0xcad03b=[..._0x4048b3[_0x16fd63(0x13b)]['prod_primunit']],_0x1bc5cc=[..._0x4048b3[_0x16fd63(0x13b)]['prod_secondunit']],_0xe8ca18=[..._0x4048b3[_0x16fd63(0x13b)]['prod_level']],_0x171974=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x161)]],_0x3a31cf=[..._0x4048b3['body'][_0x16fd63(0x1d1)]],_0x7de076=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x191)]],_0xe45f72=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x19f)]],_0x56fdae=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x213)]],_0x1a1883=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x222)]],_0x5befaf=[..._0x4048b3['body'][_0x16fd63(0x14a)]],_0x19ab1f=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1ec)]],_0x26f613=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x1cc)]],_0x4d959d=[..._0x4048b3['body']['RoomAssign']],_0x4be005=[..._0x4048b3[_0x16fd63(0x13b)]['deliverycode']],_0x409bce=[..._0x4048b3['body'][_0x16fd63(0x1c1)]],_0x445f2a=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x158)]],_0x4cbdab=[..._0x4048b3[_0x16fd63(0x13b)][_0x16fd63(0x17f)]];const _0x5dcb94=_0x2c0473['map'](_0x590ecd=>{return _0x590ecd={'product_name':_0x590ecd};});_0x445f2a[_0x16fd63(0x1cf)]((_0x179bf6,_0x317577)=>{var _0x398a2e=_0x16fd63;_0x5dcb94[_0x317577][_0x398a2e(0x158)]=Math[_0x398a2e(0x1b2)](_0x179bf6);}),_0x4cbdab['forEach']((_0x1d08b9,_0x478ac6)=>{var _0x542f05=_0x16fd63;_0x5dcb94[_0x478ac6][_0x542f05(0x17f)]=_0x1d08b9;}),_0x177b38['forEach']((_0x275bf5,_0x43c530)=>{var _0x5d9424=_0x16fd63;_0x5dcb94[_0x43c530][_0x5d9424(0x18a)]=_0x275bf5;}),_0x25f00d[_0x16fd63(0x1cf)]((_0x16e4d9,_0x314c83)=>{var _0x5e0362=_0x16fd63;_0x5dcb94[_0x314c83][_0x5e0362(0x1b0)]=Math[_0x5e0362(0x1b2)](_0x16e4d9);}),_0xcad03b[_0x16fd63(0x1cf)]((_0x133bc5,_0x373c55)=>{_0x5dcb94[_0x373c55]['standard_unit']=_0x133bc5;}),_0x1bc5cc['forEach']((_0x548646,_0x403cd4)=>{var _0x5851c4=_0x16fd63;_0x5dcb94[_0x403cd4][_0x5851c4(0x144)]=_0x548646;}),_0xe8ca18['forEach']((_0x331ef3,_0x29ab3b)=>{var _0x330cc9=_0x16fd63;_0x4d959d[_0x330cc9(0x1cf)]((_0x322a8f,_0x5aac83)=>{var _0x4b2700=_0x330cc9;if(_0x322a8f==_0x4b2700(0x20b)&&_0x29ab3b==_0x5aac83){console[_0x4b2700(0x1bf)](_0x322a8f+'\x20<\x20wew\x20>\x20'+_0x29ab3b+_0x4b2700(0x1ab)+_0x5aac83+_0x4b2700(0x1ab)+_0x331ef3);var _0x2fd048=_0x331ef3[_0x4b2700(0x1b9)](0x3);_0x5dcb94[_0x29ab3b][_0x4b2700(0x1f8)]=_0x331ef3[0x0],_0x5dcb94[_0x29ab3b]['rack']=_0x331ef3[0x1],_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ff)]=0x0,_0x5dcb94[_0x29ab3b][_0x4b2700(0x1a3)]=0x0,_0x5dcb94[_0x29ab3b]['type']=_0x4b2700(0x1e7),_0x5dcb94[_0x29ab3b]['floorlevel']=_0x2fd048;}else{if(_0x322a8f==_0x4b2700(0x175)&&_0x29ab3b==_0x5aac83){var _0x2fd048=_0x331ef3['slice'](0x3);_0x5dcb94[_0x29ab3b][_0x4b2700(0x1f8)]=_0x331ef3[0x0],_0x5dcb94[_0x29ab3b][_0x4b2700(0x19e)]=_0x331ef3[0x1],_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ff)]=0x0,_0x5dcb94[_0x29ab3b][_0x4b2700(0x1a3)]=0x0,_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ad)]=_0x4b2700(0x1e7),_0x5dcb94[_0x29ab3b]['floorlevel']=_0x331ef3[0x5];}else{if(_0x29ab3b==_0x5aac83){if(_0x331ef3[0x0]=='A'&&_0x331ef3[0x1]=='L'&&_0x331ef3[0x2]=='L')console[_0x4b2700(0x1bf)](_0x322a8f+_0x4b2700(0x1ab)+_0x29ab3b+_0x4b2700(0x1ab)+_0x5aac83+_0x4b2700(0x1ab)+_0x331ef3+_0x4b2700(0x1da)),_0x5dcb94[_0x29ab3b][_0x4b2700(0x1f8)]=_0x331ef3[0x0],_0x5dcb94[_0x29ab3b][_0x4b2700(0x19e)]=_0x331ef3[0x1],_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ff)]=0x0,_0x5dcb94[_0x29ab3b]['bin']=0x0,_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ad)]='Floor',_0x5dcb94[_0x29ab3b][_0x4b2700(0x1df)]=_0x331ef3[0x3];else{var _0x2cddfa;if(_0x331ef3[0x4]=='L')_0x2cddfa=_0x4b2700(0x223);else _0x331ef3[0x4]=='F'&&(_0x2cddfa='Floor');_0x5dcb94[_0x29ab3b][_0x4b2700(0x1f8)]=_0x331ef3[0x0],_0x5dcb94[_0x29ab3b][_0x4b2700(0x19e)]=_0x331ef3[0x1],_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ff)]=_0x331ef3[0x2],_0x5dcb94[_0x29ab3b][_0x4b2700(0x1a3)]=_0x331ef3[0x3],_0x5dcb94[_0x29ab3b][_0x4b2700(0x1ad)]=_0x2cddfa,_0x5dcb94[_0x29ab3b][_0x4b2700(0x1df)]=_0x331ef3[0x5];}}}}});}),_0x171974[_0x16fd63(0x1cf)]((_0x1fa8b7,_0x515efb)=>{_0x5dcb94[_0x515efb]['primary_code']=_0x1fa8b7;}),_0x3a31cf[_0x16fd63(0x1cf)]((_0x454f41,_0x5bf048)=>{var _0xc3c2a8=_0x16fd63;_0x5dcb94[_0x5bf048][_0xc3c2a8(0x1d1)]=_0x454f41;}),_0x7de076[_0x16fd63(0x1cf)]((_0x38ad98,_0x12d85d)=>{var _0x467f05=_0x16fd63;_0x5dcb94[_0x12d85d][_0x467f05(0x17c)]=_0x38ad98;}),_0xe45f72[_0x16fd63(0x1cf)]((_0x123fd2,_0xd49425)=>{var _0x42e9b1=_0x16fd63;_0x5dcb94[_0xd49425][_0x42e9b1(0x19f)]=_0x123fd2;}),_0x56fdae[_0x16fd63(0x1cf)]((_0xf61014,_0x157ab6)=>{var _0x5a2f8a=_0x16fd63;_0x5dcb94[_0x157ab6][_0x5a2f8a(0x213)]=_0xf61014;}),_0x1a1883[_0x16fd63(0x1cf)]((_0x52c06c,_0x295baa)=>{var _0x1e95bc=_0x16fd63;_0x5dcb94[_0x295baa][_0x1e95bc(0x135)]=_0x52c06c;}),_0x5befaf['forEach']((_0x5ab2f9,_0x1b87dd)=>{var _0x3a94e1=_0x16fd63;_0x5dcb94[_0x1b87dd][_0x3a94e1(0x14a)]=_0x5ab2f9;}),_0x19ab1f[_0x16fd63(0x1cf)]((_0x289909,_0x463a9c)=>{var _0x555f8c=_0x16fd63;_0x5dcb94[_0x463a9c][_0x555f8c(0x1ec)]=_0x289909;}),_0x26f613['forEach']((_0xd01f4f,_0x296397)=>{var _0x217472=_0x16fd63;_0x5dcb94[_0x296397][_0x217472(0x182)]=_0xd01f4f;}),_0x4d959d[_0x16fd63(0x1cf)]((_0x2bdc0e,_0x3abede)=>{_0x5dcb94[_0x3abede]['room_name']=_0x2bdc0e;}),_0x4be005['forEach']((_0x25bbec,_0x330407)=>{_0x5dcb94[_0x330407]['delivery_code']=_0x25bbec;}),_0x409bce[_0x16fd63(0x1cf)]((_0xaed02e,_0x3cb705)=>{var _0xc59778=_0x16fd63;_0x5dcb94[_0x3cb705][_0xc59778(0x235)]=_0xaed02e;});const _0x20568a=_0x4d959d[_0x16fd63(0x201)](_0x70fadb=>{return _0x70fadb={'room_name':_0x70fadb};}),_0x6ccd21=_0x5dcb94[_0x16fd63(0x139)](_0x33f090=>_0x33f090['quantity']!=='0'&&_0x33f090[_0x16fd63(0x1b0)]!==''),_0x4eb80d=new purchases({'invoice':_0x1da7ed,'suppliers':_0x4048b3[_0x16fd63(0x13b)]['suppliers'],'date':_0x113f2c,'warehouse_name':_0x2b53dc,'product':_0x6ccd21,'note':_0x1e1c47,'due_amount':_0x166787,'POnumber':_0x438180,'SCRN':_0x34f14d,'JO_number':_0x454d15,'roomList':_0x20568a}),_0x4c77d8=await _0x4eb80d['save'](),_0x4fbe49=await purchases[_0x16fd63(0x183)]({'invoice':_0x1da7ed}),_0x4bdca1=_0x4fbe49[_0x16fd63(0x187)][_0x16fd63(0x201)](async _0x3f5203=>{var _0x5da583=_0x16fd63,_0x146095=await warehouse[_0x5da583(0x183)]({'name':_0x2b53dc,'room':_0x3f5203['room_name']}),_0x18728f=0x0;return _0x146095[_0x5da583(0x21c)]['forEach'](_0x2a1147=>{var _0x30e7fe=_0x5da583;_0x2a1147['product_name']==_0x3f5203['product_name']&&_0x2a1147[_0x30e7fe(0x1df)]==_0x3f5203[_0x30e7fe(0x1df)]&&_0x2a1147[_0x30e7fe(0x1ad)]==_0x3f5203[_0x30e7fe(0x1ad)]&&_0x2a1147[_0x30e7fe(0x1a3)]==_0x3f5203[_0x30e7fe(0x1a3)]&&_0x2a1147[_0x30e7fe(0x1ff)]==_0x3f5203[_0x30e7fe(0x1ff)]&&_0x2a1147[_0x30e7fe(0x19e)]==_0x3f5203[_0x30e7fe(0x19e)]&&_0x2a1147[_0x30e7fe(0x1f8)]==_0x3f5203[_0x30e7fe(0x1f8)]&&_0x2a1147['expiry_date']==_0x3f5203[_0x30e7fe(0x213)]&&_0x2a1147['batch_code']==_0x3f5203['batch_code']&&_0x2a1147[_0x30e7fe(0x1ec)]==_0x3f5203[_0x30e7fe(0x1ec)]&&_0x2a1147[_0x30e7fe(0x235)]==_0x4fbe49[_0x30e7fe(0x235)]&&(_0x2a1147[_0x30e7fe(0x17d)]+=Math[_0x30e7fe(0x1b2)](_0x3f5203[_0x30e7fe(0x1b0)]),_0x18728f++);}),_0x18728f===0x0&&_0x146095[_0x5da583(0x21c)][_0x5da583(0x1a5)]({'product_name':_0x3f5203[_0x5da583(0x17e)],'product_stock':Math['abs'](_0x3f5203[_0x5da583(0x1b0)]),'primary_code':_0x3f5203['primary_code'],'secondary_code':_0x3f5203[_0x5da583(0x1d1)],'product_code':_0x3f5203[_0x5da583(0x18a)],'storage':_0x3f5203[_0x5da583(0x1f8)],'rack':_0x3f5203['rack'],'bay':_0x3f5203[_0x5da583(0x1ff)],'bin':_0x3f5203[_0x5da583(0x1a3)],'type':_0x3f5203['type'],'floorlevel':_0x3f5203['floorlevel'],'maxProducts':_0x3f5203[_0x5da583(0x17c)],'unit':_0x3f5203[_0x5da583(0x146)],'secondary_unit':_0x3f5203[_0x5da583(0x144)],'expiry_date':_0x3f5203[_0x5da583(0x213)],'maxPerUnit':_0x3f5203[_0x5da583(0x135)],'batch_code':_0x3f5203[_0x5da583(0x19f)],'alertQTY':_0x3f5203[_0x5da583(0x14a)],'production_date':_0x3f5203[_0x5da583(0x1ec)],'product_cat':_0x3f5203[_0x5da583(0x182)],'invoice':_0x3f5203[_0x5da583(0x235)],'actual_qty':Math[_0x5da583(0x1b2)](_0x3f5203[_0x5da583(0x158)]),'actual_uom':_0x3f5203['actual_uom']}),_0x146095;});Promise['all'](_0x4bdca1)['then'](async _0x3f43a6=>{var _0x36d40e=_0x16fd63;try{for(const _0x4c330a of _0x3f43a6){await _0x4c330a['save']();}const _0x5a37b5=await master_shop['find'](),_0x11a929=await email_settings[_0x36d40e(0x183)](),_0x5e5b6a=await supervisor_settings[_0x36d40e(0x164)]();var _0x309fb3=_0x4fbe49['product'],_0x45f923='',_0x1065fe;for(_0x1065fe in _0x309fb3){_0x45f923+=_0x36d40e(0x22f)+_0x36d40e(0x225)+_0x309fb3[_0x1065fe][_0x36d40e(0x17e)]+_0x36d40e(0x174)+_0x36d40e(0x225)+_0x309fb3[_0x1065fe][_0x36d40e(0x18a)]+'</td>'+_0x36d40e(0x225)+_0x309fb3[_0x1065fe][_0x36d40e(0x1b0)]+'</td>'+_0x36d40e(0x225)+_0x309fb3[_0x1065fe][_0x36d40e(0x146)]+_0x36d40e(0x174)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x309fb3[_0x1065fe][_0x36d40e(0x144)]+_0x36d40e(0x174)+_0x36d40e(0x225)+_0x4fbe49[_0x36d40e(0x20f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x309fb3[_0x1065fe][_0x36d40e(0x172)]+_0x36d40e(0x174)+_0x36d40e(0x225)+_0x309fb3[_0x1065fe][_0x36d40e(0x1f8)]+_0x309fb3[_0x1065fe][_0x36d40e(0x19e)]+_0x309fb3[_0x1065fe]['bay']+_0x309fb3[_0x1065fe][_0x36d40e(0x1a3)]+_0x309fb3[_0x1065fe]['type'][0x0]+_0x309fb3[_0x1065fe][_0x36d40e(0x1df)]+'</td>',_0x36d40e(0x1ce);}let _0x180127=nodemailer[_0x36d40e(0x1a9)]({'host':_0x11a929['host'],'port':Number(_0x11a929[_0x36d40e(0x1dd)]),'secure':![],'auth':{'user':_0x11a929[_0x36d40e(0x12b)],'pass':_0x11a929['password']}}),_0x45ffcc={'from':_0x11a929['email'],'to':_0x5e5b6a[0x0][_0x36d40e(0x1a8)],'subject':_0x36d40e(0x240),'attachments':[{'filename':_0x36d40e(0x1c3),'path':__dirname+_0x36d40e(0x163)+_0x36d40e(0x1a7)+_0x5a37b5[0x0][_0x36d40e(0x200)],'cid':_0x36d40e(0x15b)}],'html':_0x36d40e(0x241)+'<html><head><title></title>'+_0x36d40e(0x1fd)+_0x36d40e(0x1f7)+_0x36d40e(0x13a)+_0x36d40e(0x1f7)+_0x36d40e(0x236)+_0x36d40e(0x17a)+_0x36d40e(0x1f7)+'<h2>\x20'+_0x5a37b5[0x0][_0x36d40e(0x1bc)]+_0x36d40e(0x140)+_0x36d40e(0x17a)+_0x36d40e(0x17a)+_0x36d40e(0x179)+_0x36d40e(0x1f7)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x4fbe49['invoice']+'\x20'+_0x36d40e(0x238)+_0x36d40e(0x1c8)+_0x4fbe49[_0x36d40e(0x192)]+'\x20'+_0x36d40e(0x202)+_0x36d40e(0x1b1)+'</div>'+_0x36d40e(0x19d)+_0x36d40e(0x149)+_0x36d40e(0x22f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x36d40e(0x228)+_0x36d40e(0x1f5)+_0x36d40e(0x205)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x36d40e(0x148)+_0x36d40e(0x1e5)+_0x36d40e(0x1ce)+_0x36d40e(0x15c)+_0x36d40e(0x198)+'\x20'+_0x45f923+'\x20'+'</tbody>'+_0x36d40e(0x130)+'<div>'+_0x36d40e(0x20e)+_0x36d40e(0x1ca)+_0x5a37b5[0x0][_0x36d40e(0x1bc)]+_0x36d40e(0x1b1)+_0x36d40e(0x17a)+_0x36d40e(0x17a)+_0x36d40e(0x219)};_0x180127[_0x36d40e(0x142)](_0x45ffcc,function(_0x69f274,_0x2fb8c4){var _0x2c5322=_0x36d40e;_0x69f274?(console[_0x2c5322(0x1bf)](_0x69f274),console['log'](_0x2c5322(0x13c))):console[_0x2c5322(0x1bf)](_0x2c5322(0x212));}),_0x4048b3[_0x36d40e(0x1bb)](_0x36d40e(0x19a),_0x36d40e(0x1b3)),_0x3efd24[_0x36d40e(0x17b)](_0x36d40e(0x204));}catch(_0x224d4c){console[_0x36d40e(0x16d)](_0x224d4c),_0x3efd24[_0x36d40e(0x1db)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x16fd63(0x1d7)](_0x12a330=>{var _0x8e5fce=_0x16fd63;console[_0x8e5fce(0x16d)](_0x12a330),_0x3efd24[_0x8e5fce(0x1db)](0x1f4)[_0x8e5fce(0x23c)]({'error':_0x8e5fce(0x231)});});}catch(_0x2802a0){console[_0x16fd63(0x1bf)](_0x2802a0);}}),router['get']('/preview/:id',auth,async(_0x3fa825,_0x2ecc32)=>{var _0xddd06d=a0_0x37dad0;try{const {username:_0x4f8286,email:_0x20589b,role:_0x34a9cd}=_0x3fa825[_0xddd06d(0x143)],_0x4ead65=_0x3fa825[_0xddd06d(0x143)],_0x380fdc=await profile[_0xddd06d(0x183)]({'email':_0x4ead65['email']}),_0x60da7e=await master_shop[_0xddd06d(0x164)](),_0x4d5a58=_0x3fa825[_0xddd06d(0x1f2)]['id'],_0x1d6e2d=await purchases[_0xddd06d(0x1ef)](_0x4d5a58),_0x1e77c1=await warehouse[_0xddd06d(0x230)]([{'$match':{'name':_0x1d6e2d[_0xddd06d(0x20f)],'room':_0x1d6e2d[_0xddd06d(0x1e8)]}},{'$unwind':_0xddd06d(0x151)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xddd06d(0x159)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xddd06d(0x176)},'floorlevel':{'$first':_0xddd06d(0x16c)},'primary_code':{'$first':_0xddd06d(0x1d8)},'secondary_code':{'$first':_0xddd06d(0x214)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xddd06d(0x229)},'rack':{'$first':_0xddd06d(0x1fc)},'expiry_date':{'$first':_0xddd06d(0x157)}}}]),_0x4ad41d=await customer[_0xddd06d(0x164)]({});let _0x3cfc5b;if(_0x4ead65[_0xddd06d(0x19b)]==_0xddd06d(0x162)){const _0x579a6e=await staff[_0xddd06d(0x183)]({'email':_0x4ead65['email']});_0x3cfc5b=await warehouse['aggregate']([{'$match':{'status':_0xddd06d(0x1e3),'name':_0x579a6e[_0xddd06d(0x14d)]}},{'$group':{'_id':_0xddd06d(0x1c9),'name':{'$first':_0xddd06d(0x1c9)}}}]);}else _0x3cfc5b=await warehouse[_0xddd06d(0x230)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xddd06d(0x1c9),'name':{'$first':'$name'}}}]);const _0x5d769e=await product['find']({}),_0x5d94c8=await suppliers[_0xddd06d(0x164)]({}),_0x4b28d4=BayBinSelected(_0x1d6e2d[_0xddd06d(0x20f)],_0x1d6e2d[_0xddd06d(0x1e8)]);if(_0x60da7e[0x0][_0xddd06d(0x199)]==_0xddd06d(0x131)){var _0x47c072=users[_0xddd06d(0x138)];console['log'](_0x47c072);}else{if(_0x60da7e[0x0][_0xddd06d(0x199)]=='Hindi')var _0x47c072=users[_0xddd06d(0x141)];else{if(_0x60da7e[0x0]['language']==_0xddd06d(0x20a))var _0x47c072=users[_0xddd06d(0x20a)];else{if(_0x60da7e[0x0][_0xddd06d(0x199)]=='Spanish')var _0x47c072=users['Spanish'];else{if(_0x60da7e[0x0][_0xddd06d(0x199)]==_0xddd06d(0x132))var _0x47c072=users[_0xddd06d(0x132)];else{if(_0x60da7e[0x0][_0xddd06d(0x199)]==_0xddd06d(0x207))var _0x47c072=users[_0xddd06d(0x1a1)];else{if(_0x60da7e[0x0]['language']=='Chinese')var _0x47c072=users[_0xddd06d(0x1dc)];else{if(_0x60da7e[0x0][_0xddd06d(0x199)]==_0xddd06d(0x154))var _0x47c072=users[_0xddd06d(0x13d)];}}}}}}}_0x2ecc32[_0xddd06d(0x196)]('edit_purchases_view',{'success':_0x3fa825[_0xddd06d(0x1bb)](_0xddd06d(0x19a)),'errors':_0x3fa825['flash']('errors'),'role':_0x4ead65,'profile':_0x380fdc,'customer':_0x4ad41d,'warehouse':_0x3cfc5b,'product':_0x1e77c1,'user':_0x1d6e2d,'master_shop':_0x60da7e,'unit':_0x5d769e,'language':_0x47c072,'suppliers':_0x5d94c8,'dataSelected':_0x4b28d4});}catch(_0x176472){console[_0xddd06d(0x1bf)](_0x176472);}}),router[a0_0x37dad0(0x15f)](a0_0x37dad0(0x16b),auth,async(_0x5f5ca0,_0x2d92be)=>{var _0x21523b=a0_0x37dad0;try{const _0x270639=_0x5f5ca0[_0x21523b(0x1f2)]['id'],{invoice:_0xad231d,warehouse_name:_0x254193,Room_name:_0x2e97e9}=_0x5f5ca0[_0x21523b(0x13b)],_0x7eb6a0=await warehouse[_0x21523b(0x183)]({'name':_0x254193,'room':_0x2e97e9}),_0x103e79=await purchases[_0x21523b(0x183)]({'invoice':_0xad231d});_0x103e79[_0x21523b(0x187)][_0x21523b(0x1cf)](_0x162410=>{var _0x1c019b=_0x21523b,_0x270bf0=0x0;const _0xea5961=_0x7eb6a0[_0x1c019b(0x21c)]['map'](_0x4951df=>{var _0x22ec04=_0x1c019b;_0x4951df['product_name']==_0x162410[_0x22ec04(0x17e)]&&_0x4951df[_0x22ec04(0x1df)]==_0x162410[_0x22ec04(0x1df)]&&_0x4951df[_0x22ec04(0x1ad)]==_0x162410['type']&&_0x4951df[_0x22ec04(0x1a3)]==_0x162410[_0x22ec04(0x1a3)]&&_0x4951df[_0x22ec04(0x1ff)]==_0x162410[_0x22ec04(0x1ff)]&&_0x4951df['rack']==_0x162410[_0x22ec04(0x19e)]&&_0x4951df[_0x22ec04(0x1f8)]==_0x162410['storage']&&_0x4951df[_0x22ec04(0x213)]==_0x162410[_0x22ec04(0x213)]&&_0x4951df[_0x22ec04(0x19f)]==_0x162410[_0x22ec04(0x19f)]&&_0x4951df[_0x22ec04(0x1ec)]==_0x162410[_0x22ec04(0x1ec)]&&_0x4951df[_0x22ec04(0x147)]==_0x162410[_0x22ec04(0x147)]&&_0x4951df[_0x22ec04(0x14f)]==_0x162410[_0x22ec04(0x14f)]&&(_0x4951df[_0x22ec04(0x17d)]=parseInt(_0x4951df['product_stock'])+parseInt(_0x162410[_0x22ec04(0x1b0)]),_0x270bf0++);});_0x270bf0=='0'&&(_0x7eb6a0['product_details']=_0x7eb6a0[_0x1c019b(0x21c)][_0x1c019b(0x224)]({'product_name':_0x162410['product_name'],'product_stock':_0x162410[_0x1c019b(0x1b0)],'primary_code':_0x162410[_0x1c019b(0x161)],'secondary_code':_0x162410[_0x1c019b(0x1d1)],'product_code':_0x162410['product_code'],'storage':_0x162410[_0x1c019b(0x1f8)],'rack':_0x162410['rack'],'bay':_0x162410['bay'],'bin':_0x162410['bin'],'type':_0x162410[_0x1c019b(0x1ad)],'floorlevel':_0x162410[_0x1c019b(0x1df)],'maxProducts':_0x162410[_0x1c019b(0x17c)],'unit':_0x162410[_0x1c019b(0x146)],'secondary_unit':_0x162410[_0x1c019b(0x144)],'expiry_date':_0x162410['expiry_date'],'maxPerUnit':_0x162410['maxperunit'],'batch_code':_0x162410[_0x1c019b(0x19f)],'alertQTY':_0x162410['alertQTY'],'production_date':_0x162410['production_date'],'delivery_date':_0x162410[_0x1c019b(0x147)],'delivery_code':_0x162410[_0x1c019b(0x14f)]}));}),await _0x7eb6a0[_0x21523b(0x21a)](),_0x103e79['finalize']=_0x21523b(0x1f3);const _0x2101b5=await _0x103e79[_0x21523b(0x21a)]();_0x5f5ca0[_0x21523b(0x1bb)](_0x21523b(0x19a),_0x21523b(0x185)),_0x2d92be['redirect']('/all_purchases/view');}catch(_0x396264){console[_0x21523b(0x1bf)](_0x396264);}}),router[a0_0x37dad0(0x233)](a0_0x37dad0(0x194),auth,async(_0x1eb44c,_0x5d2975)=>{var _0x186844=a0_0x37dad0;try{const {username:_0x4284c9,email:_0x498f52,role:_0x3e85b8}=_0x1eb44c[_0x186844(0x143)],_0x548f6a=_0x1eb44c['user'],_0xb7edf0=await profile[_0x186844(0x183)]({'email':_0x548f6a['email']}),_0x570cd0=await master_shop[_0x186844(0x164)](),_0x4916a2=_0x1eb44c['params']['id'],_0x452564=await purchases[_0x186844(0x1ef)](_0x4916a2),_0x1e0927=await suppliers[_0x186844(0x164)]({});let _0xc63864;if(_0x548f6a['role']==_0x186844(0x162)){const _0x22401e=await staff[_0x186844(0x183)]({'email':_0x548f6a['email']});_0xc63864=await warehouse[_0x186844(0x164)]({'status':_0x186844(0x1e3),'name':_0x22401e[_0x186844(0x14d)],'warehouse_category':_0x186844(0x193)});}else _0xc63864=await warehouse[_0x186844(0x230)]([{'$match':{'status':'Enabled','warehouse_category':_0x186844(0x193)}},{'$group':{'_id':_0x186844(0x1c9),'name':{'$first':'$name'}}}]);const _0x19fcb4=await product[_0x186844(0x164)]({}),_0x5ec6e3=BayBinSelected(_0x452564[_0x186844(0x20f)],_0x452564[_0x186844(0x1e8)]);let _0x3c65cd=new Date(_0x452564[_0x186844(0x213)]),_0x3f7eae=('0'+_0x3c65cd[_0x186844(0x1f6)]())[_0x186844(0x1b9)](-0x2),_0x3d1bc2=('0'+(_0x3c65cd[_0x186844(0x1ea)]()+0x1))['slice'](-0x2),_0x53f2da=_0x3c65cd[_0x186844(0x167)](),_0x4ceeb8=_0x53f2da+'-'+_0x3d1bc2+'-'+_0x3f7eae;if(_0x570cd0[0x0][_0x186844(0x199)]=='English\x20(US)'){var _0xeab0cf=users[_0x186844(0x138)];console['log'](_0xeab0cf);}else{if(_0x570cd0[0x0][_0x186844(0x199)]==_0x186844(0x141))var _0xeab0cf=users[_0x186844(0x141)];else{if(_0x570cd0[0x0][_0x186844(0x199)]=='German')var _0xeab0cf=users[_0x186844(0x20a)];else{if(_0x570cd0[0x0][_0x186844(0x199)]==_0x186844(0x15e))var _0xeab0cf=users['Spanish'];else{if(_0x570cd0[0x0][_0x186844(0x199)]=='French')var _0xeab0cf=users[_0x186844(0x132)];else{if(_0x570cd0[0x0]['language']==_0x186844(0x207))var _0xeab0cf=users['Portuguese'];else{if(_0x570cd0[0x0][_0x186844(0x199)]==_0x186844(0x1dc))var _0xeab0cf=users['Chinese'];else{if(_0x570cd0[0x0][_0x186844(0x199)]==_0x186844(0x154))var _0xeab0cf=users[_0x186844(0x13d)];}}}}}}}_0x5d2975[_0x186844(0x196)](_0x186844(0x166),{'success':_0x1eb44c[_0x186844(0x1bb)]('success'),'errors':_0x1eb44c[_0x186844(0x1bb)](_0x186844(0x23e)),'role':_0x548f6a,'profile':_0xb7edf0,'purchases':_0x452564,'suppliers':_0x1e0927,'warehouse':_0xc63864,'product':_0x19fcb4,'master_shop':_0x570cd0,'language':_0xeab0cf,'ed_fullDate':_0x4ceeb8,'dataSelected':_0x5ec6e3});}catch(_0x27dab7){console[_0x186844(0x1bf)](_0x27dab7);}}),router[a0_0x37dad0(0x15f)](a0_0x37dad0(0x194),auth,async(_0x16def9,_0x1b69f3)=>{var _0x4902fc=a0_0x37dad0;try{const _0x5b6045=_0x16def9[_0x4902fc(0x1f2)]['id'],_0x1b533f=await purchases[_0x4902fc(0x183)]({'_id':_0x16def9[_0x4902fc(0x1f2)]['id']}),_0x15b825=await warehouse[_0x4902fc(0x183)]({'name':_0x1b533f['warehouse_name'],'room':_0x1b533f[_0x4902fc(0x1e8)]});_0x1b533f[_0x4902fc(0x187)][_0x4902fc(0x1cf)](_0x1dabb0=>{var _0x2044df=_0x4902fc;const _0x34979a=_0x15b825[_0x2044df(0x21c)][_0x2044df(0x201)](_0x39139f=>{var _0x5caace=_0x2044df;_0x39139f['product_name']==_0x1dabb0[_0x5caace(0x17e)]&&_0x39139f[_0x5caace(0x1df)]==_0x1dabb0[_0x5caace(0x1df)]&&_0x39139f[_0x5caace(0x1ad)]==_0x1dabb0[_0x5caace(0x1ad)]&&_0x39139f[_0x5caace(0x1a3)]==_0x1dabb0['bin']&&_0x39139f[_0x5caace(0x1ff)]==_0x1dabb0[_0x5caace(0x1ff)]&&_0x39139f[_0x5caace(0x19e)]==_0x1dabb0[_0x5caace(0x19e)]&&_0x39139f[_0x5caace(0x1f8)]==_0x1dabb0[_0x5caace(0x1f8)]&&(_0x39139f[_0x5caace(0x17d)]=parseInt(_0x39139f[_0x5caace(0x17d)])-parseInt(_0x1dabb0[_0x5caace(0x1b0)]));});}),await _0x15b825[_0x4902fc(0x21a)]();const {invoice:_0x4598cc,suppliers:_0x1770f2,date:_0x4833af,warehouse_name:_0x279c33,prod_name:_0x2a478d,prod_code:_0x2ef3f8,prod_qty:_0xf96873,prod_unit:_0xa41b0b,prod_secondunit:_0x2ddf40,prod_level:_0x30b394,prod_isle:_0x2e31cf,prod_pallet:_0x98b5ac,note:_0xafce58,expiry_date:_0x2e775b,batch_code:_0x2bad18,paid_amount:_0x26e765,due_amount:_0x2419a9,Room_name:_0x5691cd,primary_code:_0x5cf18d,secondary_code:_0x204c9b,PO_number:_0x4546c9,JO_number:_0x1da078}=_0x16def9[_0x4902fc(0x13b)];if(typeof _0x2a478d==_0x4902fc(0x168))var _0x5d3acd=[_0x16def9['body'][_0x4902fc(0x1eb)]],_0x3ee4a5=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x1d3)]],_0x5b6911=[_0x16def9[_0x4902fc(0x13b)]['prod_qty']],_0x49971b=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x21b)]],_0x54f1aa=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x16e)]],_0x565f0a=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x16a)]],_0x34d8f9=[_0x16def9[_0x4902fc(0x13b)]['prod_isle']],_0x593571=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x1e0)]],_0x1eef3b=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x161)]],_0x24077e=[_0x16def9['body']['secondary_code']],_0x42ecb2=[_0x16def9['body'][_0x4902fc(0x191)]],_0x1e584d=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x19f)]],_0x4152c8=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x213)]],_0x14b067=[_0x16def9['body']['storage']],_0x40d05f=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x150)]],_0x5b9bcd=[_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x1ad)]];else var _0x5d3acd=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x1eb)]],_0x3ee4a5=[..._0x16def9['body'][_0x4902fc(0x1d3)]],_0x5b6911=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x20d)]],_0x49971b=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x21b)]],_0x54f1aa=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x16e)]],_0x565f0a=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x16a)]],_0x34d8f9=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x21f)]],_0x593571=[..._0x16def9['body'][_0x4902fc(0x1e0)]],_0x1eef3b=[..._0x16def9['body']['primary_code']],_0x24077e=[..._0x16def9[_0x4902fc(0x13b)]['secondary_code']],_0x42ecb2=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x191)]],_0x1e584d=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x19f)]],_0x4152c8=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x213)]],_0x14b067=[..._0x16def9['body'][_0x4902fc(0x1f8)]],_0x40d05f=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x150)]],_0x5b9bcd=[..._0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x1ad)]];const _0x120634=_0x5d3acd[_0x4902fc(0x201)](_0x2a6565=>{return _0x2a6565={'product_name':_0x2a6565};});_0x3ee4a5[_0x4902fc(0x1cf)]((_0xfa39bf,_0x389027)=>{var _0x2de22e=_0x4902fc;_0x120634[_0x389027][_0x2de22e(0x18a)]=_0xfa39bf;}),_0x5b6911[_0x4902fc(0x1cf)]((_0x499e59,_0x321c39)=>{var _0x1bbe95=_0x4902fc;_0x120634[_0x321c39][_0x1bbe95(0x1b0)]=_0x499e59;}),_0x49971b[_0x4902fc(0x1cf)]((_0x3d9ba0,_0x345bbf)=>{var _0x8bae81=_0x4902fc;_0x120634[_0x345bbf][_0x8bae81(0x146)]=_0x3d9ba0;}),_0x54f1aa['forEach']((_0x1e8d29,_0x53279a)=>{_0x120634[_0x53279a]['secondary_unit']=_0x1e8d29;}),_0x565f0a['forEach']((_0x22928f,_0x334c23)=>{var _0x242144=_0x4902fc;_0x120634[_0x334c23][_0x242144(0x1ff)]=_0x22928f;}),_0x34d8f9[_0x4902fc(0x1cf)]((_0x437e48,_0xa3b2a3)=>{var _0x5ce073=_0x4902fc;_0x120634[_0xa3b2a3][_0x5ce073(0x1a3)]=_0x437e48;}),_0x593571[_0x4902fc(0x1cf)]((_0x322b9e,_0x867c12)=>{var _0x2f6f44=_0x4902fc;_0x120634[_0x867c12][_0x2f6f44(0x1df)]=_0x322b9e;}),_0x1eef3b[_0x4902fc(0x1cf)]((_0x54823f,_0x306516)=>{var _0x84110c=_0x4902fc;_0x120634[_0x306516][_0x84110c(0x161)]=_0x54823f;}),_0x24077e[_0x4902fc(0x1cf)]((_0xf6740c,_0x3ab2c9)=>{_0x120634[_0x3ab2c9]['secondary_code']=_0xf6740c;}),_0x42ecb2[_0x4902fc(0x1cf)]((_0x13f8b2,_0x29beea)=>{var _0x9f0627=_0x4902fc;_0x120634[_0x29beea][_0x9f0627(0x17c)]=_0x13f8b2;}),_0x1e584d[_0x4902fc(0x1cf)]((_0x3e38f3,_0x160736)=>{var _0x176c4e=_0x4902fc;_0x120634[_0x160736][_0x176c4e(0x19f)]=_0x3e38f3;}),_0x4152c8[_0x4902fc(0x1cf)]((_0x110d63,_0x3d2a05)=>{var _0x181aa3=_0x4902fc;_0x120634[_0x3d2a05][_0x181aa3(0x213)]=_0x110d63;}),_0x5b9bcd[_0x4902fc(0x1cf)]((_0x54520d,_0x1c0767)=>{var _0x56cc8e=_0x4902fc;_0x120634[_0x1c0767][_0x56cc8e(0x1ad)]=_0x54520d;}),_0x14b067[_0x4902fc(0x1cf)]((_0x27f019,_0x27c074)=>{_0x120634[_0x27c074]['storage']=_0x27f019;}),_0x40d05f[_0x4902fc(0x1cf)]((_0x30951e,_0x676e43)=>{_0x120634[_0x676e43]['rack']=_0x30951e;});const _0x157157=_0x120634[_0x4902fc(0x139)](_0x55927b=>_0x55927b['quantity']!=='0'&&_0x55927b[_0x4902fc(0x1b0)]!=='');_0x1b533f[_0x4902fc(0x235)]=_0x4598cc,_0x1b533f[_0x4902fc(0x1d9)]=_0x1770f2,_0x1b533f[_0x4902fc(0x192)]=_0x4833af,_0x1b533f[_0x4902fc(0x20f)]=_0x279c33,_0x1b533f[_0x4902fc(0x187)]=_0x157157,_0x1b533f['note']=_0xafce58,_0x1b533f['paid_amount']=_0x26e765,_0x1b533f[_0x4902fc(0x1f1)]=_0x2419a9,_0x1b533f[_0x4902fc(0x1e8)]=_0x5691cd,_0x1b533f['POnumber']=_0x4546c9,_0x1b533f[_0x4902fc(0x12c)]=_0x1da078;const _0x3d9f19=await _0x1b533f['save'](),_0x385557=await warehouse['findOne']({'name':_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x20f)],'room':_0x16def9['body'][_0x4902fc(0x12f)]});_0x1b533f['product']['forEach'](_0x10b91e=>{var _0xafa92f=_0x4902fc,_0x266106=0x0;const _0x5559dc=_0x385557[_0xafa92f(0x21c)]['map'](_0x1363a5=>{var _0x33a17c=_0xafa92f;_0x1363a5[_0x33a17c(0x17e)]==_0x10b91e[_0x33a17c(0x17e)]&&_0x1363a5[_0x33a17c(0x1df)]==_0x10b91e['floorlevel']&&_0x1363a5[_0x33a17c(0x1ad)]==_0x10b91e[_0x33a17c(0x1ad)]&&_0x1363a5[_0x33a17c(0x1a3)]==_0x10b91e[_0x33a17c(0x1a3)]&&_0x1363a5[_0x33a17c(0x1ff)]==_0x10b91e[_0x33a17c(0x1ff)]&&_0x1363a5[_0x33a17c(0x19e)]==_0x10b91e[_0x33a17c(0x19e)]&&_0x1363a5[_0x33a17c(0x1f8)]==_0x10b91e[_0x33a17c(0x1f8)]&&(_0x1363a5[_0x33a17c(0x17d)]=parseInt(_0x1363a5['product_stock'])+parseInt(_0x10b91e['quantity']),_0x266106++);});_0x266106=='0'&&(_0x385557[_0xafa92f(0x21c)]=_0x385557[_0xafa92f(0x21c)][_0xafa92f(0x224)]({'product_name':_0x10b91e[_0xafa92f(0x17e)],'product_stock':_0x10b91e[_0xafa92f(0x1b0)],'primary_code':_0x10b91e[_0xafa92f(0x161)],'secondary_code':_0x10b91e['secondary_code'],'product_code':_0x10b91e[_0xafa92f(0x18a)],'storage':_0x10b91e['storage'],'rack':_0x10b91e['rack'],'bay':_0x10b91e[_0xafa92f(0x1ff)],'bin':_0x10b91e[_0xafa92f(0x1a3)],'type':_0x10b91e[_0xafa92f(0x1ad)],'floorlevel':_0x10b91e['floorlevel'],'maxProducts':_0x10b91e[_0xafa92f(0x17c)],'unit':_0x10b91e[_0xafa92f(0x146)],'secondary_unit':_0x10b91e[_0xafa92f(0x144)],'expiry_date':_0x10b91e[_0xafa92f(0x213)]}));}),await _0x385557[_0x4902fc(0x21a)]();const _0x2ad1e5=await s_payment_data[_0x4902fc(0x183)]({'invoice':_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x235)]});if(_0x2ad1e5===null){}else console['log'](_0x4902fc(0x1d9),_0x2ad1e5,_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x235)]),_0x2ad1e5[_0x4902fc(0x1d9)]=_0x16def9[_0x4902fc(0x13b)][_0x4902fc(0x1d9)],await _0x2ad1e5[_0x4902fc(0x21a)]();_0x16def9['flash'](_0x4902fc(0x19a),_0x4902fc(0x197)),_0x1b69f3[_0x4902fc(0x17b)](_0x4902fc(0x1b7));}catch(_0x52ea89){console[_0x4902fc(0x1bf)](_0x52ea89);}}),router[a0_0x37dad0(0x15f)](a0_0x37dad0(0x15d),auth,async(_0x4e22c7,_0x2a117d)=>{var _0x16a6ef=a0_0x37dad0;try{const _0x36a619=_0x4e22c7[_0x16a6ef(0x1f2)]['id'],{invoice:_0x215c58,suppliers:_0x4d148e,payable:_0x2cae45,due_amount:_0x4dc1fc}=_0x4e22c7[_0x16a6ef(0x13b)],_0x10ba7a=await purchases['findById'](_0x36a619);var _0xe903fb=_0x2cae45-_0x4dc1fc;_0x10ba7a[_0x16a6ef(0x1ac)]=parseFloat(_0x10ba7a[_0x16a6ef(0x1ac)])+parseFloat(_0x4dc1fc),_0x10ba7a[_0x16a6ef(0x1f1)]=_0xe903fb;const _0x344c52=await _0x10ba7a[_0x16a6ef(0x21a)]();console['log'](_0x344c52);const _0x3e78db=await s_payment_data[_0x16a6ef(0x183)]({'invoice':_0x215c58});_0x3e78db[_0x16a6ef(0x1f0)]=_0xe903fb,await _0x3e78db[_0x16a6ef(0x21a)]();let _0x3ad000=new Date(),_0x3e9529=('0'+_0x3ad000[_0x16a6ef(0x1f6)]())[_0x16a6ef(0x1b9)](-0x2),_0xbbae1c=('0'+(_0x3ad000[_0x16a6ef(0x1ea)]()+0x1))[_0x16a6ef(0x1b9)](-0x2),_0x4fdcc9=_0x3ad000[_0x16a6ef(0x167)](),_0x3dc001=_0x4fdcc9+'-'+_0xbbae1c+'-'+_0x3e9529;const _0x5bb5da=new suppliers_payment({'invoice':_0x215c58,'date':_0x4fdcc9+'-'+_0xbbae1c+'-'+_0x3e9529,'suppliers':_0x4d148e,'reason':_0x16a6ef(0x1fb),'amount':_0x4dc1fc}),_0x2bbf62=await _0x5bb5da['save']();_0x4e22c7[_0x16a6ef(0x1bb)](_0x16a6ef(0x19a),'payment\x20successfull'),_0x2a117d[_0x16a6ef(0x17b)](_0x16a6ef(0x1b7));}catch(_0x5db622){console[_0x16a6ef(0x1bf)](_0x5db622);}}),router['get'](a0_0x37dad0(0x226),auth,async(_0x5aa02c,_0x57def3)=>{var _0x254018=a0_0x37dad0;try{const {username:_0x5ec8ca,email:_0x59e803,role:_0x356db0}=_0x5aa02c[_0x254018(0x143)],_0x2d544e=_0x5aa02c[_0x254018(0x143)],_0x4a27b6=await profile[_0x254018(0x183)]({'email':_0x2d544e[_0x254018(0x12b)]}),_0x52c1ff=await master_shop[_0x254018(0x164)]();console[_0x254018(0x1bf)]('master',_0x52c1ff);const _0x1448be=_0x5aa02c[_0x254018(0x1f2)]['id'],_0x28ef33=await purchases[_0x254018(0x1ef)](_0x1448be);console[_0x254018(0x1bf)](_0x28ef33);const _0xfa051c=await suppliers['findOne']({'name':_0x28ef33[_0x254018(0x1d9)]});console[_0x254018(0x1bf)](_0xfa051c);if(_0x52c1ff[0x0][_0x254018(0x199)]==_0x254018(0x131)){var _0x5afe40=users[_0x254018(0x138)];console[_0x254018(0x1bf)](_0x5afe40);}else{if(_0x52c1ff[0x0][_0x254018(0x199)]=='Hindi')var _0x5afe40=users['Hindi'];else{if(_0x52c1ff[0x0][_0x254018(0x199)]==_0x254018(0x20a))var _0x5afe40=users['German'];else{if(_0x52c1ff[0x0][_0x254018(0x199)]==_0x254018(0x15e))var _0x5afe40=users[_0x254018(0x15e)];else{if(_0x52c1ff[0x0][_0x254018(0x199)]==_0x254018(0x132))var _0x5afe40=users[_0x254018(0x132)];else{if(_0x52c1ff[0x0]['language']==_0x254018(0x207))var _0x5afe40=users[_0x254018(0x1a1)];else{if(_0x52c1ff[0x0]['language']==_0x254018(0x1dc))var _0x5afe40=users[_0x254018(0x1dc)];else{if(_0x52c1ff[0x0]['language']==_0x254018(0x154))var _0x5afe40=users[_0x254018(0x13d)];}}}}}}}_0x57def3[_0x254018(0x196)](_0x254018(0x1c5),{'success':_0x5aa02c['flash'](_0x254018(0x19a)),'errors':_0x5aa02c[_0x254018(0x1bb)](_0x254018(0x23e)),'role':_0x2d544e,'profile':_0x4a27b6,'master_shop':_0x52c1ff,'supplier':_0xfa051c,'purchase':_0x28ef33,'language':_0x5afe40});}catch(_0x274705){console[_0x254018(0x1bf)](_0x274705);}}),router['get'](a0_0x37dad0(0x217),auth,async(_0x5425ae,_0x3a8834)=>{var _0x13253d=a0_0x37dad0;try{const {username:_0x180ebf,email:_0x5138f1,role:_0x5f4213}=_0x5425ae['user'],_0x244065=_0x5425ae[_0x13253d(0x143)],_0x2407ff=await profile[_0x13253d(0x183)]({'email':_0x244065[_0x13253d(0x12b)]}),_0x5c3db5=await master_shop['find']();console[_0x13253d(0x1bf)](_0x13253d(0x1c7),_0x5c3db5);const _0xc2f399=_0x5425ae[_0x13253d(0x1f2)]['id'];console[_0x13253d(0x1bf)](_0xc2f399);const _0x346f9e=await purchases[_0x13253d(0x1ef)](_0xc2f399);console[_0x13253d(0x1bf)](_0x13253d(0x152),_0x346f9e);const _0x25c958=await product['find']({}),_0x424a22=await warehouse[_0x13253d(0x230)]([{'$match':{'name':_0x346f9e['warehouse_name'],'room':_0x346f9e['room'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x13253d(0x151)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x13253d(0x22a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x13253d(0x1ae)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x13253d(0x176)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x13253d(0x214)},'product_code':{'$first':_0x13253d(0x1be)},'storage':{'$first':_0x13253d(0x229)},'rack':{'$first':_0x13253d(0x1fc)}}}]);warehouse_data=await warehouse[_0x13253d(0x230)]([{'$match':{'status':_0x13253d(0x1e3),'name':'Return\x20Goods','warehouse_category':_0x13253d(0x193)}},{'$group':{'_id':_0x13253d(0x1c9),'name':{'$first':_0x13253d(0x1c9)}}},{'$sort':{'name':0x1}}]),console[_0x13253d(0x1bf)](_0x13253d(0x220),_0x424a22);if(_0x5c3db5[0x0][_0x13253d(0x199)]==_0x13253d(0x131)){var _0x426c1c=users[_0x13253d(0x138)];console['log'](_0x426c1c);}else{if(_0x5c3db5[0x0]['language']==_0x13253d(0x141))var _0x426c1c=users[_0x13253d(0x141)];else{if(_0x5c3db5[0x0][_0x13253d(0x199)]==_0x13253d(0x20a))var _0x426c1c=users[_0x13253d(0x20a)];else{if(_0x5c3db5[0x0][_0x13253d(0x199)]==_0x13253d(0x15e))var _0x426c1c=users[_0x13253d(0x15e)];else{if(_0x5c3db5[0x0][_0x13253d(0x199)]==_0x13253d(0x132))var _0x426c1c=users['French'];else{if(_0x5c3db5[0x0][_0x13253d(0x199)]==_0x13253d(0x207))var _0x426c1c=users[_0x13253d(0x1a1)];else{if(_0x5c3db5[0x0][_0x13253d(0x199)]=='Chinese')var _0x426c1c=users[_0x13253d(0x1dc)];else{if(_0x5c3db5[0x0][_0x13253d(0x199)]==_0x13253d(0x154))var _0x426c1c=users[_0x13253d(0x13d)];}}}}}}}_0x3a8834[_0x13253d(0x196)](_0x13253d(0x23a),{'success':_0x5425ae[_0x13253d(0x1bb)](_0x13253d(0x19a)),'errors':_0x5425ae[_0x13253d(0x1bb)](_0x13253d(0x23e)),'role':_0x244065,'profile':_0x2407ff,'user':_0x346f9e,'stock':_0x424a22,'master_shop':_0x5c3db5,'product':_0x25c958,'language':_0x426c1c,'warehouse':warehouse_data});}catch(_0x115c53){console[_0x13253d(0x1bf)](_0x115c53);}}),router[a0_0x37dad0(0x15f)](a0_0x37dad0(0x217),auth,async(_0x1663fd,_0x974a3b)=>{var _0x345571=a0_0x37dad0;try{const {invoice:_0x222da6,date:_0x16ee74,warehouse_name:_0x1edcc5,Room_name:_0x2f9db9,product_name:_0xc8acd0,purchase_quantity:_0x3cdc70,stocks:_0x352ad7,return_qty:_0x7d0222,note:_0x3c078d,level:_0x45cb46,isle:_0x3b6d5e,pallet:_0xd35b3f,to_warehouse_name:_0x3385ca,to_Room_name:_0x219c2c}=_0x1663fd[_0x345571(0x13b)],_0x438be3=await purchases['findOne']({'_id':_0x1663fd[_0x345571(0x1f2)]['id']}),_0x4bd46a=await warehouse['findOne']({'name':_0x1edcc5,'room':_0x2f9db9});if(typeof _0xc8acd0==_0x345571(0x168))var _0x2e7a36=[_0x1663fd['body']['product_name']],_0x1c1fb8=[_0x1663fd[_0x345571(0x13b)][_0x345571(0x12e)]],_0x1378bd=[_0x1663fd[_0x345571(0x13b)]['stocks']],_0x46c074=[_0x1663fd[_0x345571(0x13b)][_0x345571(0x1fe)]],_0x352095=[_0x1663fd[_0x345571(0x13b)][_0x345571(0x1b4)]],_0x507cf9=[_0x1663fd[_0x345571(0x13b)]['isle']],_0x3fd710=[_0x1663fd[_0x345571(0x13b)][_0x345571(0x20c)]],_0x3d068b=[_0x1663fd['body'][_0x345571(0x1a0)]],_0x34e645=[_0x1663fd[_0x345571(0x13b)][_0x345571(0x1e2)]],_0x5f11d1=[_0x1663fd[_0x345571(0x13b)][_0x345571(0x1e6)]],_0x18f6f9=[_0x1663fd[_0x345571(0x13b)]['secondary_code_hide']];else var _0x2e7a36=[..._0x1663fd[_0x345571(0x13b)][_0x345571(0x17e)]],_0x1c1fb8=[..._0x1663fd[_0x345571(0x13b)]['purchase_quantity']],_0x1378bd=[..._0x1663fd[_0x345571(0x13b)]['stocks']],_0x46c074=[..._0x1663fd[_0x345571(0x13b)][_0x345571(0x1fe)]],_0x352095=[..._0x1663fd['body']['level']],_0x507cf9=[..._0x1663fd[_0x345571(0x13b)]['isle']],_0x3fd710=[..._0x1663fd[_0x345571(0x13b)][_0x345571(0x20c)]],_0x3d068b=[..._0x1663fd[_0x345571(0x13b)]['types']],_0x34e645=[..._0x1663fd[_0x345571(0x13b)][_0x345571(0x1e2)]],_0x5f11d1=[..._0x1663fd[_0x345571(0x13b)][_0x345571(0x1e6)]],_0x18f6f9=[..._0x1663fd['body'][_0x345571(0x1de)]];const _0x3279b0=_0x2e7a36[_0x345571(0x201)](_0x1f44eb=>{return _0x1f44eb={'product_name':_0x1f44eb};});_0x1c1fb8[_0x345571(0x1cf)]((_0x4e6ddb,_0x4f097e)=>{var _0x239873=_0x345571;_0x3279b0[_0x4f097e][_0x239873(0x12e)]=_0x4e6ddb;}),_0x1378bd[_0x345571(0x1cf)]((_0x5bd6f5,_0x536db9)=>{_0x3279b0[_0x536db9]['stock_quantity']=_0x5bd6f5;}),_0x46c074['forEach']((_0x479083,_0x2b63dd)=>{var _0x46ef83=_0x345571;_0x3279b0[_0x2b63dd][_0x46ef83(0x1fe)]=_0x479083;}),_0x352095[_0x345571(0x1cf)]((_0x1524ed,_0x52c50b)=>{var _0x2cb652=_0x345571;_0x3279b0[_0x52c50b][_0x2cb652(0x1ff)]=_0x1524ed;}),_0x507cf9['forEach']((_0x144fc3,_0x258bb4)=>{var _0x44ff6f=_0x345571;_0x3279b0[_0x258bb4][_0x44ff6f(0x1a3)]=_0x144fc3;}),_0x3fd710[_0x345571(0x1cf)]((_0x3a60a6,_0x4ed06d)=>{var _0x49b46b=_0x345571;_0x3279b0[_0x4ed06d][_0x49b46b(0x1df)]=_0x3a60a6;}),_0x3d068b['forEach']((_0x25cb3e,_0x5cf9d8)=>{var _0x528c77=_0x345571;_0x3279b0[_0x5cf9d8][_0x528c77(0x1ad)]=_0x25cb3e;}),_0x34e645[_0x345571(0x1cf)]((_0x39e192,_0x52c9f9)=>{var _0x135480=_0x345571;_0x3279b0[_0x52c9f9][_0x135480(0x18a)]=_0x39e192;}),_0x5f11d1[_0x345571(0x1cf)]((_0x3ebe93,_0x4252ef)=>{var _0x5b5d5e=_0x345571;_0x3279b0[_0x4252ef][_0x5b5d5e(0x161)]=_0x3ebe93;}),_0x18f6f9[_0x345571(0x1cf)]((_0xedef7c,_0x520b18)=>{var _0x5dd0e5=_0x345571;_0x3279b0[_0x520b18][_0x5dd0e5(0x1d1)]=_0xedef7c;}),_0x438be3['product']['forEach'](_0x5af856=>{var _0x52d816=_0x345571;const _0x3ac0ad=_0x4bd46a['product_details'][_0x52d816(0x201)](_0x368b00=>{var _0x198a58=_0x52d816;_0x368b00[_0x198a58(0x17e)]==_0x5af856[_0x198a58(0x17e)]&&_0x368b00[_0x198a58(0x1df)]==_0x5af856[_0x198a58(0x1df)]&&_0x368b00['type']==_0x5af856[_0x198a58(0x1ad)]&&_0x368b00['bin']==_0x5af856[_0x198a58(0x1a3)]&&_0x368b00['bay']==_0x5af856[_0x198a58(0x1ff)]&&_0x368b00[_0x198a58(0x19e)]==_0x5af856[_0x198a58(0x19e)]&&_0x368b00[_0x198a58(0x1f8)]==_0x5af856[_0x198a58(0x1f8)]&&(console[_0x198a58(0x1bf)](parseInt(_0x368b00['product_stock'])+'\x20<>\x20'+parseInt(_0x5af856[_0x198a58(0x1b0)])),_0x368b00[_0x198a58(0x17d)]=parseInt(_0x368b00['product_stock'])+parseInt(_0x5af856[_0x198a58(0x1b0)]));});}),await _0x4bd46a[_0x345571(0x21a)]();const _0x1f31fe=_0x3279b0[_0x345571(0x139)](_0xeff52f=>_0xeff52f[_0x345571(0x1fe)]!=='0'&&_0xeff52f[_0x345571(0x1fe)]!=='');var _0x5ea068=0x0;_0x1f31fe['forEach'](_0x5679f4=>{var _0x3f0bd0=_0x345571;console['log'](_0x3f0bd0(0x12d),_0x5679f4),(parseInt(_0x5679f4[_0x3f0bd0(0x12e)])<parseInt(_0x5679f4[_0x3f0bd0(0x1fe)])||parseInt(_0x5679f4[_0x3f0bd0(0x18c)])<parseInt(_0x5679f4[_0x3f0bd0(0x1fe)]))&&_0x5ea068++;});if(_0x5ea068!=0x0)return _0x1663fd['flash'](_0x345571(0x23e),_0x345571(0x1ed)),_0x974a3b[_0x345571(0x17b)]('back');const _0x2a69d1=new purchases_return({'invoice':_0x222da6,'suppliers':_0x1663fd[_0x345571(0x13b)][_0x345571(0x1d9)],'date':_0x16ee74,'warehouse_name':_0x1edcc5,'return_product':_0x1f31fe,'note':_0x3c078d,'room':_0x2f9db9,'to_warehouse_name':_0x3385ca,'to_room':_0x219c2c}),_0x3a4644=await _0x2a69d1[_0x345571(0x21a)]();console[_0x345571(0x1bf)](_0x2a69d1);const _0xce5f70=await purchases_return['findOne']({'invoice':_0x222da6}),_0x55b05a=await warehouse[_0x345571(0x183)]({'name':_0x3385ca,'room':_0x219c2c});_0xce5f70['return_product'][_0x345571(0x1cf)](_0x8eb6f1=>{var _0x4547e9=_0x345571,_0xf78ef=0x0;const _0x26fd96=_0x55b05a[_0x4547e9(0x21c)][_0x4547e9(0x201)](_0x4b00af=>{var _0x5068f6=_0x4547e9;_0x4b00af[_0x5068f6(0x17e)]==_0x8eb6f1['product_name']&&_0x4b00af[_0x5068f6(0x1df)]==_0x8eb6f1['floorlevel']&&_0x4b00af[_0x5068f6(0x1ad)]==_0x8eb6f1['type']&&_0x4b00af[_0x5068f6(0x1a3)]==_0x8eb6f1[_0x5068f6(0x1a3)]&&_0x4b00af[_0x5068f6(0x1ff)]==_0x8eb6f1['bay']&&(_0x4b00af[_0x5068f6(0x17d)]=parseInt(_0x4b00af[_0x5068f6(0x17d)])-parseInt(_0x8eb6f1[_0x5068f6(0x1fe)]),_0xf78ef++);});_0xf78ef=='0'&&(_0x55b05a[_0x4547e9(0x21c)]=_0x55b05a[_0x4547e9(0x21c)][_0x4547e9(0x224)]({'product_name':_0x8eb6f1['product_name'],'product_stock':_0x8eb6f1[_0x4547e9(0x1fe)],'primary_code':_0x8eb6f1[_0x4547e9(0x161)],'secondary_code':_0x8eb6f1[_0x4547e9(0x1d1)],'product_code':_0x8eb6f1['product_code'],'storage':_0x8eb6f1[_0x4547e9(0x1f8)],'rack':_0x8eb6f1[_0x4547e9(0x19e)],'bay':_0x8eb6f1['bay'],'bin':_0x8eb6f1[_0x4547e9(0x1a3)],'type':_0x8eb6f1[_0x4547e9(0x1ad)],'floorlevel':_0x8eb6f1[_0x4547e9(0x1df)],'maxProducts':_0x8eb6f1[_0x4547e9(0x17c)],'unit':_0x8eb6f1[_0x4547e9(0x146)],'secondary_unit':_0x8eb6f1[_0x4547e9(0x144)],'expiry_date':_0x8eb6f1[_0x4547e9(0x213)]}));}),await _0x55b05a['save']();const _0x5afef7=await purchases[_0x345571(0x183)]({'invoice':_0x222da6});_0x5afef7[_0x345571(0x22b)]='True';const _0x4c2e62=await _0x5afef7[_0x345571(0x21a)](),_0x585413=new s_payment_data({'invoice':_0x222da6,'suppliers':_0x1663fd[_0x345571(0x13b)][_0x345571(0x1d9)],'reason':'Purchase\x20Return'});await _0x585413[_0x345571(0x21a)]();const _0x250051=await master_shop[_0x345571(0x164)]();console[_0x345571(0x1bf)](_0x345571(0x210),_0x250051[0x0]['image']);const _0xe5dcf7=await email_settings['findOne'](),_0x3ef494=await suppliers[_0x345571(0x183)]({'name':_0x1663fd['body'][_0x345571(0x1d9)]});console[_0x345571(0x1bf)]('suppliers_data',_0x3ef494);_0x250051[0x0][_0x345571(0x1d0)]==0x1?(right_currency=_0x250051[0x0][_0x345571(0x1af)],left_currency=''):(right_currency='',left_currency=_0x250051[0x0][_0x345571(0x1af)]);var _0x15a5bd=_0x2e7a36,_0x3f4eaf=_0x46c074,_0x11a9f8='',_0x23b250;for(_0x23b250 in _0x15a5bd){_0x11a9f8+='<tr>'+_0x345571(0x225)+_0x15a5bd[_0x23b250]+'</td>'+_0x345571(0x225)+_0x3f4eaf[_0x23b250]+_0x345571(0x174)+_0x345571(0x1ce);}console[_0x345571(0x1bf)](_0x345571(0x208),_0x11a9f8);let _0x14c2ee=nodemailer[_0x345571(0x1a9)]({'service':_0x345571(0x23b),'auth':{'user':_0xe5dcf7[_0x345571(0x12b)],'pass':_0xe5dcf7[_0x345571(0x1d5)]}}),_0x5bad20={'from':_0xe5dcf7[_0x345571(0x12b)],'to':_0x3ef494[_0x345571(0x12b)],'subject':_0x345571(0x1ee),'attachments':[{'filename':_0x345571(0x1c3),'path':__dirname+_0x345571(0x163)+'/upload/'+_0x250051[0x0]['image'],'cid':_0x345571(0x15b)}],'html':_0x345571(0x241)+_0x345571(0x209)+'</head><body>'+_0x345571(0x1f7)+_0x345571(0x13a)+_0x345571(0x1f7)+_0x345571(0x236)+_0x345571(0x17a)+_0x345571(0x1f7)+'<h2>\x20'+_0x250051[0x0][_0x345571(0x1bc)]+'\x20</h2>'+_0x345571(0x17a)+_0x345571(0x17a)+_0x345571(0x179)+'<div>'+_0x345571(0x134)+'\x20Order\x20Number\x20:\x20'+_0x222da6+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x345571(0x1c8)+_0x16ee74+'\x20'+'</span>'+_0x345571(0x1b1)+_0x345571(0x17a)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x345571(0x149)+_0x345571(0x22f)+_0x345571(0x189)+_0x345571(0x195)+_0x345571(0x215)+_0x345571(0x22e)+_0x345571(0x1ce)+_0x345571(0x15c)+_0x345571(0x198)+'\x20'+_0x11a9f8+'\x20'+_0x345571(0x22c)+_0x345571(0x130)+_0x345571(0x1f7)+_0x345571(0x20e)+_0x345571(0x1ca)+_0x250051[0x0][_0x345571(0x1bc)]+_0x345571(0x1b1)+_0x345571(0x17a)+_0x345571(0x17a)+'</body></html>'};_0x14c2ee['sendMail'](_0x5bad20,function(_0x1d48fd,_0x52eb89){var _0x45bf73=_0x345571;_0x1d48fd?(console[_0x45bf73(0x1bf)](_0x1d48fd),console[_0x45bf73(0x1bf)](_0x45bf73(0x13c))):console[_0x45bf73(0x1bf)](_0x45bf73(0x212));}),_0x1663fd[_0x345571(0x1bb)](_0x345571(0x19a),_0x345571(0x188)),_0x974a3b[_0x345571(0x17b)](_0x345571(0x1b7));}catch(_0x4287fb){console[_0x345571(0x1bf)](_0x4287fb),_0x974a3b[_0x345571(0x1db)](0xc8)[_0x345571(0x23c)]({'message':_0x4287fb[_0x345571(0x21e)]});}}),router[a0_0x37dad0(0x233)](a0_0x37dad0(0x22d),auth,async(_0x58c6e4,_0x5bbddb)=>{var _0x354bbb=a0_0x37dad0;try{const {username:_0x34854c,email:_0xd1a19a,role:_0xe61b46}=_0x58c6e4[_0x354bbb(0x143)],_0x2421cc=_0x58c6e4[_0x354bbb(0x143)],_0x47e7a8=await profile['findOne']({'email':_0x2421cc[_0x354bbb(0x12b)]}),_0x3222e9=await master_shop[_0x354bbb(0x164)](),_0x3b959d=_0x58c6e4[_0x354bbb(0x1f2)]['id'],_0x378198=await purchases['findById'](_0x3b959d);if(_0x3222e9[0x0]['language']==_0x354bbb(0x131))var _0x549565=users[_0x354bbb(0x138)];else{if(_0x3222e9[0x0]['language']=='Hindi')var _0x549565=users[_0x354bbb(0x141)];else{if(_0x3222e9[0x0][_0x354bbb(0x199)]==_0x354bbb(0x20a))var _0x549565=users['German'];else{if(_0x3222e9[0x0][_0x354bbb(0x199)]=='Spanish')var _0x549565=users['Spanish'];else{if(_0x3222e9[0x0][_0x354bbb(0x199)]==_0x354bbb(0x132))var _0x549565=users[_0x354bbb(0x132)];else{if(_0x3222e9[0x0][_0x354bbb(0x199)]=='Portuguese\x20(BR)')var _0x549565=users[_0x354bbb(0x1a1)];else{if(_0x3222e9[0x0][_0x354bbb(0x199)]==_0x354bbb(0x1dc))var _0x549565=users[_0x354bbb(0x1dc)];else{if(_0x3222e9[0x0][_0x354bbb(0x199)]=='Arabic\x20(ae)')var _0x549565=users[_0x354bbb(0x13d)];}}}}}}}_0x5bbddb[_0x354bbb(0x196)]('all_purchases_barcode',{'success':_0x58c6e4[_0x354bbb(0x1bb)](_0x354bbb(0x19a)),'errors':_0x58c6e4[_0x354bbb(0x1bb)]('errors'),'role':_0x2421cc,'profile':_0x47e7a8,'alldata':_0x378198,'master_shop':_0x3222e9,'language':_0x549565}),console[_0x354bbb(0x1bf)](alldata);}catch(_0x48e719){console[_0x354bbb(0x1bf)](_0x48e719);}}),router[a0_0x37dad0(0x15f)]('/barcode_scanner',async(_0x368a52,_0x5b5c06)=>{var _0x3cc473=a0_0x37dad0;const {product_code:_0x275afb}=_0x368a52[_0x3cc473(0x13b)];var _0x39aa43;const _0x57d9e0=await product[_0x3cc473(0x230)]([{'$match':{'primary_code':_0x275afb,'product_category':_0x3cc473(0x193)}},{'$group':{'_id':_0x3cc473(0x15a),'name':{'$first':_0x3cc473(0x1c9)},'category':{'$first':_0x3cc473(0x180)},'brand':{'$first':_0x3cc473(0x1bd)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x3cc473(0x1e4)},'product_code':{'$first':_0x3cc473(0x1b5)},'primary_code':{'$first':_0x3cc473(0x227)},'secondary_code':{'$first':_0x3cc473(0x137)},'maxStocks':{'$first':_0x3cc473(0x173)},'maxProdPerUnit':{'$first':_0x3cc473(0x1a6)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3cc473(0x133)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1e0d3a=await product[_0x3cc473(0x230)]([{'$match':{'secondary_code':_0x275afb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3cc473(0x15a),'name':{'$first':_0x3cc473(0x1c9)},'category':{'$first':_0x3cc473(0x180)},'brand':{'$first':_0x3cc473(0x1bd)},'unit':{'$first':_0x3cc473(0x1c6)},'alertquantity':{'$first':_0x3cc473(0x1e4)},'product_code':{'$first':_0x3cc473(0x1b5)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3cc473(0x137)},'maxStocks':{'$first':_0x3cc473(0x173)},'maxProdPerUnit':{'$first':_0x3cc473(0x1a6)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3cc473(0x133)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x57d9e0[_0x3cc473(0x13e)]>0x0)_0x39aa43=_0x57d9e0;else _0x1e0d3a[_0x3cc473(0x13e)]>0x0&&(_0x39aa43=_0x1e0d3a);_0x5b5c06[_0x3cc473(0x23c)](_0x39aa43);}),router['post']('/CheckingWarehouse',async(_0x589268,_0x3a6440)=>{var _0x590917=a0_0x37dad0;const {primaryCode:_0x5471b0,secondaryCode:_0xbc6c6b,productCode:_0x10e8ad,bay:_0x3f05b3,bin:_0x1e900d,types:_0x3a36c3,pallet:_0x58ae8a,warehouses:_0x491c43,room:_0x30d6cd}=_0x589268[_0x590917(0x13b)];console[_0x590917(0x1bf)](_0x589268['body']);try{const _0x3d5d57=await warehouse['aggregate']([{'$match':{'name':_0x491c43,'room':_0x30d6cd}},{'$unwind':_0x590917(0x151)},{'$match':{'product_details.bay':_0x3f05b3,'product_details.bin':_0x1e900d,'product_details.type':_0x3a36c3}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x590917(0x22a)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x590917(0x1c0)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x590917(0x1f9)},'maxProducts':{'$first':_0x590917(0x18f)}}}]);_0x3a6440[_0x590917(0x1db)](0xc8)[_0x590917(0x23c)](_0x3d5d57);}catch(_0x3775a8){_0x3a6440[_0x590917(0x1db)](0x194)[_0x590917(0x23c)]({'message':_0x3775a8[_0x590917(0x21e)]});}}),module[a0_0x37dad0(0x1aa)]=router;