var a0_0x1a7251=a0_0x1453;(function(_0x145c3c,_0x547f16){var _0x123b29=a0_0x1453,_0x4ee041=_0x145c3c();while(!![]){try{var _0xd140c4=-parseInt(_0x123b29(0x184))/0x1+-parseInt(_0x123b29(0x14f))/0x2*(-parseInt(_0x123b29(0x1d4))/0x3)+-parseInt(_0x123b29(0x17b))/0x4*(-parseInt(_0x123b29(0x1e1))/0x5)+-parseInt(_0x123b29(0x115))/0x6*(-parseInt(_0x123b29(0x14c))/0x7)+-parseInt(_0x123b29(0xe7))/0x8+parseInt(_0x123b29(0x1eb))/0x9+-parseInt(_0x123b29(0x1c5))/0xa*(parseInt(_0x123b29(0x18b))/0xb);if(_0xd140c4===_0x547f16)break;else _0x4ee041['push'](_0x4ee041['shift']());}catch(_0x34f539){_0x4ee041['push'](_0x4ee041['shift']());}}}(a0_0x437e,0x7572f));const express=require(a0_0x1a7251(0xd6)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1a7251(0x143)),auth=require(a0_0x1a7251(0x1b0)),nodemailer=require(a0_0x1a7251(0x1a6));var ejs=require('ejs');function a0_0x437e(){var _0x5f4f63=['delivery_code','5918AeNCmH','$product_details.floorlevel','$product_details.isle','INC-','$product_details.product_code','suppliers_docs','$secondary_unit','</td>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','password','warehouse_name','Arabic','product_stock','Chinese','Logo.png','Arabic\x20(ae)','random','Error\x20Occurs','purchase_quantity','$due_amount','stock_data','Hindi','secondary_unit','/barcode_scanner','date','render','prod_Qty','nodemailer','Level','German','status','success','Floor','storage','paid_amount','$product_details.maxProducts','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','../middleware/auth','English\x20(US)','slice','<h2>\x20','$paid_amount','standard_unit','/upload/','product_details','types','Rack\x20D','maxStocks','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','get','<span\x20style=\x22float:\x20right;\x22>','prod_secondunit','$product','suppliers','expiry_date','../public/language/languages.json','RoomAssign','production_date','16150hPlCKf','/invoice/:id','$batch_code','product_code','/preview/:id','Receiving\x20Area','\x20<\x20wew\x20>\x20','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','floorlevel','$room','True','POnumber','$product.type','MaxStocks_data','</div>','1979400mbvStr','add_purchases\x20error','Enclosed','<h5>','error','Portuguese','secondary_code_hide','back','$alertquantity','room','$product_details.storage','$note','all','113660XdqANN','pallet','edit_purchases','stocks','Sales\x20Update\x20successfully','email','Return\x20Goods','</head><body>','$expiry_date','$product_code','5744862UFapgB','currency','gmail','$product_details.bay','$suppliers','$name','$product_details.bin','post','product_name','<h5\x20style=\x22text-align:\x20left;\x22>','</span>','prod_code','express','/all_purchases/view','$product_details.type','prod_cat','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','rak','invoice','aggregate','JO_number','An\x20error\x20occurred\x20while\x20saving\x20data.','Spanish','<hr\x20class=\x22my-3\x22>','<strong>\x20Regards\x20</strong>','secondary_code','save','There\x27s\x20a\x20error\x20in\x20this\x20transaction','329872jJrGFY','stock_quantity','/CheckingWarehouse','sendMail','image','foreach\x20newproduct','toString','$product_details.product_name','\x20Order\x20Date\x20:\x20','findById','prod_primunit','$product_details.level','Rack\x20B','product_code_hide','product_cat','getMonth','Enabled','Rack\x20F','edit_purchases_view','getDate','level','$primary_code','\x20<>\x20','role','actual_qty','quantity','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Rack\x20A','$warehouse_name','$product_details.rack','length','return_product','concat','host','$brand','type','forEach','$maxProdPerUnit','$product_details.pallet','/view/add_purchases','bay','createTransport','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Portuguese\x20(BR)','1560ILDqlg','$secondary_code','/barcode/:id','/view/add_purchases/:id','/view','product_list','logo','prod_level','<tr>','$maxStocks','$unit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','max_product_unit','delivery_date','/view/return_purchase/:id','batch_code','map','bin','$product_details._id','suppliers_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','note','prod_name','product','maxperunit','primary_code_hide','actual_uom','Paid\x20For\x20Purchase','push','purchases\x20item\x20return\x20successfull','Purchase\x20Mail','find','French','$product.floorlevel','master','table\x20page','deliverycode','prod_unit','</thead>','body','</table>','all_purchases_barcode','prod_invoice','user_id','isle','English','../models/all_models','deliverydate','prod_pallet','return_qty','port','warehouse','Raw\x20Materials','Purchase\x20Return\x20Mail','$date','11585LzAIcW','$product_details','$product_details.primary_code','2UqVYRR','log','payment\x20successfull','<tbody\x20style=\x22text-align:\x20center;\x22>','amount','$product_details.expiry_date','alertQTY','here','abs','$_id','$suppliers_docs','then','</tr>','purchase\x20data\x20update\x20successfully','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','add\x20post','staff','errors','findOne','room_name','/../public','Email\x20sent\x20successfully','string','return_data','Purchase\x20data\x20added\x20successfully','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','rack','language','user','$product_details.product_stock','$product.bin','$category','due_amount','padStart','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','COLD\x20STORAGE','message','</h5>','prod_isle','\x20Order\x20Number\x20:\x20','redirect','$finalize','76wbFjvD','$product.bay','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','params','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','An\x20error\x20occurred.','</tbody>','\x20</h2>','769151GtqDvF','$return_data','DRY\x20STORAGE','primary_code','<div>','floor'];a0_0x437e=function(){return _0x5f4f63;};return a0_0x437e();}function a0_0x1453(_0x22c25d,_0x1bb214){var _0x437e4c=a0_0x437e();return a0_0x1453=function(_0x145302,_0x59f8ab){_0x145302=_0x145302-0xd0;var _0xf69b8d=_0x437e4c[_0x145302];return _0xf69b8d;},a0_0x1453(_0x22c25d,_0x1bb214);}const path=require('path'),users=require(a0_0x1a7251(0x1c2));router[a0_0x1a7251(0x1bc)](a0_0x1a7251(0x119),auth,async(_0x74a8b6,_0x405e35)=>{var _0x451213=a0_0x1a7251;try{const {username:_0x23a0e1,email:_0x2cf582,role:_0x175296}=_0x74a8b6[_0x451213(0x16d)],_0x39c5c3=_0x74a8b6['user'],_0x2ec6dc=await profile['findOne']({'email':_0x39c5c3[_0x451213(0x1e6)]}),_0x50a44f=await staff[_0x451213(0x162)]({'email':_0x39c5c3[_0x451213(0x1e6)]});if(_0x39c5c3[_0x451213(0xfe)]=='staff'){const _0x522040=await staff[_0x451213(0x162)]({'email':_0x39c5c3['email']});}const _0x53a483=await master_shop[_0x451213(0x134)]();let _0x5c96aa;if(_0x39c5c3['role']==_0x451213(0x160)){const _0xac6b50=await staff['findOne']({'email':_0x39c5c3[_0x451213(0x1e6)]});_0x5c96aa=await purchases[_0x451213(0xde)]([{'$match':{'warehouse_name':_0xac6b50[_0x451213(0x148)]}},{'$lookup':{'from':'suppliers','localField':_0x451213(0x1c0),'foreignField':'name','as':_0x451213(0x190)}},{'$unwind':_0x451213(0x159)},{'$unwind':'$product'},{'$group':{'_id':_0x451213(0x158),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x451213(0x14b)},'warehouse_name':{'$first':_0x451213(0x104)},'room':{'$first':_0x451213(0x1ce)},'product':{'$push':'$product'},'note':{'$first':_0x451213(0x1df)},'paid_amount':{'$first':_0x451213(0x1b4)},'due_amount':{'$first':_0x451213(0x19e)},'return_data':{'$first':_0x451213(0x185)},'batch_code':{'$first':_0x451213(0x1c7)},'expiry_date':{'$first':_0x451213(0x1e9)},'suppliers_docs':{'$first':_0x451213(0x159)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x451213(0x17c)},'isle':{'$addToSet':_0x451213(0x16f)},'type':{'$addToSet':_0x451213(0x1d1)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5c96aa=await purchases['aggregate']([{'$lookup':{'from':'suppliers','localField':_0x451213(0x1c0),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x451213(0x159)},{'$unwind':_0x451213(0x1bf)},{'$group':{'_id':_0x451213(0x158),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x451213(0x1ef)},'date':{'$first':_0x451213(0x14b)},'warehouse_name':{'$first':_0x451213(0x104)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x451213(0x1bf)},'note':{'$first':_0x451213(0x1df)},'paid_amount':{'$first':_0x451213(0x1b4)},'due_amount':{'$first':_0x451213(0x19e)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x451213(0x1c7)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x451213(0x159)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x451213(0x17c)},'isle':{'$addToSet':_0x451213(0x16f)},'type':{'$addToSet':_0x451213(0x1d1)},'floorlevel':{'$addToSet':_0x451213(0x136)},'finalize':{'$first':_0x451213(0x17a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x53a483[0x0]['language']==_0x451213(0x1b1)){var _0x2d1813=users[_0x451213(0x142)];console[_0x451213(0x150)](_0x2d1813);}else{if(_0x53a483[0x0][_0x451213(0x16c)]==_0x451213(0x1a0))var _0x2d1813=users[_0x451213(0x1a0)];else{if(_0x53a483[0x0]['language']=='German')var _0x2d1813=users['German'];else{if(_0x53a483[0x0]['language']==_0x451213(0xe1))var _0x2d1813=users[_0x451213(0xe1)];else{if(_0x53a483[0x0][_0x451213(0x16c)]==_0x451213(0x135))var _0x2d1813=users['French'];else{if(_0x53a483[0x0]['language']==_0x451213(0x114))var _0x2d1813=users['Portuguese'];else{if(_0x53a483[0x0][_0x451213(0x16c)]==_0x451213(0x198))var _0x2d1813=users['Chinese'];else{if(_0x53a483[0x0][_0x451213(0x16c)]==_0x451213(0x19a))var _0x2d1813=users['Arabic'];}}}}}}}_0x405e35[_0x451213(0x1a4)]('all_purchases',{'success':_0x74a8b6[_0x451213(0x112)](_0x451213(0x1aa)),'errors':_0x74a8b6['flash'](_0x451213(0x161)),'purchases':_0x5c96aa,'role':_0x39c5c3,'profile':_0x2ec6dc,'master_shop':_0x53a483,'language':_0x2d1813});}catch(_0x38116b){console[_0x451213(0x150)](_0x451213(0x138),_0x38116b),_0x405e35[_0x451213(0x1a9)](0xc8)[_0x451213(0x169)]({'message':_0x38116b[_0x451213(0x175)]});}});function BayBinSelected(_0x1900b1,_0x2d950d){var _0x250399=a0_0x1a7251,_0x34732f=[],_0x1b3d19=[],_0x1c5d3b=[],_0x44a20f=[],_0xe63090=[],_0x58543b=[];let _0x382641=[];if(_0x1900b1==_0x250399(0x186))switch(_0x2d950d){case _0x250399(0x103):_0x34732f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1b3d19=[0x1,0x2],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=[_0x250399(0x1a7),_0x250399(0x1ab)],_0xe63090=['D'],_0x58543b=['A'];break;case _0x250399(0xf3):_0x34732f=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1b3d19=[0x1,0x2],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=[_0x250399(0x1a7),'Floor'],_0xe63090=['D'],_0x58543b=['B'];break;case'Shelves':_0x34732f=[0x0],_0x1b3d19=[0x0],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=[_0x250399(0x1ab)],_0xe63090=['D'],_0x58543b=['S'];break;case'Receiving\x20Area':_0x34732f=[0x0],_0x1b3d19=[0x0],_0x44a20f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1c5d3b=[_0x250399(0x1ab)],_0xe63090=['D'],_0x58543b=['R'];break;}else{if(_0x1900b1==_0x250399(0x174))switch(_0x2d950d){case _0x250399(0x103):_0x34732f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1b3d19=['B','F'],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=['Level',_0x250399(0x1ab)],_0xe63090=['C'],_0x58543b=['A'];break;case _0x250399(0xf3):_0x34732f=[0x5,0x4,0x3,0x2,0x1],_0x1b3d19=['F','B','S'],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=[_0x250399(0x1a7),_0x250399(0x1ab)],_0xe63090=['C'],_0x58543b=['B'];break;case'Rack\x20C':_0x34732f=[0x1,0x2,0x3,0x4,0x5],_0x1b3d19=['B','F','S'],_0x44a20f=[0x5,0x4,0x3,0x2,0x1],_0x1c5d3b=[_0x250399(0x1a7),'Floor'],_0xe63090=['C'],_0x58543b=['C'];break;case _0x250399(0x1b9):_0x34732f=[0x5,0x4,0x3,0x2,0x1],_0x1b3d19=['F','B','S'],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=['Level',_0x250399(0x1ab)],_0xe63090=['C'],_0x58543b=['D'];break;case'Rack\x20E':_0x34732f=[0x4,0x3,0x2,0x1],_0x1b3d19=[0x1,0x2],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=['Level',_0x250399(0x1ab)],_0xe63090=['C'],_0x58543b=['E'];break;case _0x250399(0xf8):_0x34732f=[0x1,0x2,0x3],_0x1b3d19=[0x1,0x2],_0x44a20f=[0x1,0x2,0x3,0x4,0x5],_0x1c5d3b=['Level'],_0xe63090=['C'],_0x58543b=['F'];break;}}return{'levels':_0x34732f,'Isle':_0x1b3d19,'rack':_0x44a20f,'type':_0x1c5d3b,'storage':_0xe63090,'rak':_0x58543b};}async function getRandom8DigitNumber(){var _0x3a27b9=a0_0x1a7251;const _0x14f792=0x989680,_0x56f9b3=0x5f5e0ff,_0x4be082=Math[_0x3a27b9(0x189)](Math[_0x3a27b9(0x19b)]()*(_0x56f9b3-_0x14f792+0x1))+_0x14f792;var _0x538bb2;const _0x224dd0=await purchases[_0x3a27b9(0x162)]({'invoice':_0x3a27b9(0x18e)+_0x4be082});return _0x224dd0&&_0x224dd0[_0x3a27b9(0x106)]>0x0?_0x538bb2=_0x3a27b9(0x18e)+_0x4be082:_0x538bb2='INC-'+_0x4be082,_0x538bb2;}router[a0_0x1a7251(0x1bc)](a0_0x1a7251(0x10f),auth,async(_0x2465f1,_0x678958)=>{var _0x4da46b=a0_0x1a7251;try{const {username:_0x3391f0,email:_0x565320,role:_0x49b8e1}=_0x2465f1[_0x4da46b(0x16d)],_0x41c3d8=_0x2465f1[_0x4da46b(0x16d)],_0x42aed1=await profile[_0x4da46b(0x162)]({'email':_0x41c3d8[_0x4da46b(0x1e6)]}),_0x4c84e3=await master_shop[_0x4da46b(0x134)](),_0x50d0c7=await staff[_0x4da46b(0x162)]({'email':_0x41c3d8['email']}),_0x1bc81e=await suppliers[_0x4da46b(0x134)]({});let _0xcb24b6;if(_0x41c3d8[_0x4da46b(0xfe)]=='staff'){const _0x4d4d0a=await staff[_0x4da46b(0x162)]({'email':_0x41c3d8[_0x4da46b(0x1e6)]});_0xcb24b6=await warehouse['aggregate']([{'$match':{'status':_0x4da46b(0xf7),'name':_0x4d4d0a['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x4da46b(0x1f0),'name':{'$first':'$name'}}}]);}else _0xcb24b6=await warehouse[_0x4da46b(0xde)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x4da46b(0x1e7)}}},{'$group':{'_id':_0x4da46b(0x1f0),'name':{'$first':_0x4da46b(0x1f0)}}}]);const _0x35bc83=await product[_0x4da46b(0x134)]({}),_0x545b27=await warehouse[_0x4da46b(0x134)]({'status':_0x4da46b(0xf7)}),_0x169006=await purchases['find']({}),_0x15233b=_0x169006[_0x4da46b(0x106)]+0x1,_0x5f574a=_0x4da46b(0x18e)+_0x15233b[_0x4da46b(0xed)]()[_0x4da46b(0x172)](0x5,'0');var _0x5bc344=['Ambient',_0x4da46b(0x1d6)];if(_0x4c84e3[0x0][_0x4da46b(0x16c)]==_0x4da46b(0x1b1))var _0x22458d=users[_0x4da46b(0x142)];else{if(_0x4c84e3[0x0][_0x4da46b(0x16c)]==_0x4da46b(0x1a0))var _0x22458d=users[_0x4da46b(0x1a0)];else{if(_0x4c84e3[0x0][_0x4da46b(0x16c)]==_0x4da46b(0x1a8))var _0x22458d=users['German'];else{if(_0x4c84e3[0x0][_0x4da46b(0x16c)]==_0x4da46b(0xe1))var _0x22458d=users['Spanish'];else{if(_0x4c84e3[0x0]['language']==_0x4da46b(0x135))var _0x22458d=users[_0x4da46b(0x135)];else{if(_0x4c84e3[0x0][_0x4da46b(0x16c)]=='Portuguese\x20(BR)')var _0x22458d=users[_0x4da46b(0x1d9)];else{if(_0x4c84e3[0x0][_0x4da46b(0x16c)]==_0x4da46b(0x198))var _0x22458d=users[_0x4da46b(0x198)];else{if(_0x4c84e3[0x0]['language']=='Arabic\x20(ae)')var _0x22458d=users[_0x4da46b(0x196)];}}}}}}}const _0x20b7ef=getRandom8DigitNumber();_0x20b7ef[_0x4da46b(0x15a)](_0x2bb843=>{var _0x35cc17=_0x4da46b;_0x678958[_0x35cc17(0x1a4)]('add_purchases',{'success':_0x2465f1[_0x35cc17(0x112)]('success'),'errors':_0x2465f1['flash'](_0x35cc17(0x161)),'role':_0x41c3d8,'profile':_0x42aed1,'suppliers':_0x1bc81e,'warehouse':_0xcb24b6,'product':_0x35bc83,'invoice':_0x2bb843,'master_shop':_0x4c84e3,'language':_0x22458d,'find_data':_0x545b27,'rooms_data':_0x5bc344});})['catch'](_0x4deab7=>{var _0x3b7cc5=_0x4da46b;_0x2465f1[_0x3b7cc5(0x112)](_0x3b7cc5(0x161),_0x3b7cc5(0xe6)),_0x678958[_0x3b7cc5(0x179)](_0x3b7cc5(0xd7));});}catch(_0x506d6b){console[_0x4da46b(0x150)](_0x506d6b);}}),router[a0_0x1a7251(0x1bc)](a0_0x1a7251(0x118),auth,async(_0x1cf49d,_0x5e2223)=>{var _0x35fa43=a0_0x1a7251;try{const _0x26f39e=_0x1cf49d['params']['id'];console[_0x35fa43(0x150)](_0x26f39e);const _0x6db3d8=await master_shop[_0x35fa43(0x134)]();console['log'](_0x35fa43(0x137),_0x6db3d8);const _0x57da56=await product[_0x35fa43(0x162)]({'name':_0x26f39e});console[_0x35fa43(0x150)]('product',_0x57da56),_0x5e2223[_0x35fa43(0x1a9)](0xc8)[_0x35fa43(0x169)]({'product_data':_0x57da56,'master':_0x6db3d8});}catch(_0x154ac0){console['log'](_0x35fa43(0x1d5),_0x154ac0);}}),router[a0_0x1a7251(0xd1)](a0_0x1a7251(0x10f),auth,async(_0x52ed27,_0x4c3d97)=>{var _0x3c36aa=a0_0x1a7251;try{const {invoice:_0x162086,date:_0x569ec6,warehouse_name:_0x5b3be2,prod_name:_0x4c1667,prod_code:_0x2f65cc,prod_qty:_0x11153b,prod_unit:_0xe3306f,prod_secondunit:_0x59c73a,prod_level:_0x4e3d09,prod_isle:_0x323d80,prod_pallet:_0x57c3b5,note:_0x3c7f87,expiry_date:_0x3765d5,batch_code:_0x194c54,payable:_0x38e058,due_amount:_0x1fc708,Room_name:_0x54d86f,primary_code:_0x9879b8,secondary_code:_0xd5c01c,MaxStocks_data:_0x3c0733,PO_number:_0x4e41e3,SCRN:_0x41b78a,JO_number:_0x584221}=_0x52ed27[_0x3c36aa(0x13c)];if(typeof _0x4c1667==_0x3c36aa(0x166))var _0x46bfd4=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x12b)]],_0x4ea40c=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xd5)]],_0x733035=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1a5)]],_0x335c92=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xf1)]],_0x58e819=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1be)]],_0x135e83=[_0x52ed27['body'][_0x3c36aa(0x11c)]],_0x5ceff0=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x187)]],_0x5b6026=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xe4)]],_0x4a861b=[_0x52ed27['body'][_0x3c36aa(0x1d2)]],_0x3c9267=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x124)]],_0x497a37=[_0x52ed27['body'][_0x3c36aa(0x1c1)]],_0x11f2b0=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x121)]],_0xc072cb=[_0x52ed27['body'][_0x3c36aa(0x155)]],_0x588d09=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1c4)]],_0x1028c0=[_0x52ed27['body'][_0x3c36aa(0xd9)]],_0x20a1b4=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1c3)]],_0x2f0a4e=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x139)]],_0x3ae028=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x13f)]],_0x3b3bc9=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xff)]],_0x2b110e=[_0x52ed27['body'][_0x3c36aa(0x12f)]],_0x4dcce3=[_0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x144)]];else var _0x46bfd4=[..._0x52ed27[_0x3c36aa(0x13c)]['prod_name']],_0x4ea40c=[..._0x52ed27[_0x3c36aa(0x13c)]['prod_code']],_0x733035=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1a5)]],_0x335c92=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xf1)]],_0x58e819=[..._0x52ed27[_0x3c36aa(0x13c)]['prod_secondunit']],_0x135e83=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x11c)]],_0x5ceff0=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x187)]],_0x5b6026=[..._0x52ed27[_0x3c36aa(0x13c)]['secondary_code']],_0x4a861b=[..._0x52ed27['body'][_0x3c36aa(0x1d2)]],_0x3c9267=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x124)]],_0x497a37=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1c1)]],_0x11f2b0=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x121)]],_0xc072cb=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x155)]],_0x588d09=[..._0x52ed27['body'][_0x3c36aa(0x1c4)]],_0x1028c0=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xd9)]],_0x20a1b4=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x1c3)]],_0x2f0a4e=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x139)]],_0x3ae028=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x13f)]],_0x3b3bc9=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0xff)]],_0x2b110e=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x12f)]],_0x4dcce3=[..._0x52ed27[_0x3c36aa(0x13c)][_0x3c36aa(0x144)]];const _0x21205b=_0x46bfd4[_0x3c36aa(0x125)](_0x3961cd=>{return _0x3961cd={'product_name':_0x3961cd};});_0x3b3bc9[_0x3c36aa(0x10c)]((_0xef03a7,_0x21494c)=>{var _0x2828a7=_0x3c36aa;_0x21205b[_0x21494c][_0x2828a7(0xff)]=Math['abs'](_0xef03a7);}),_0x2b110e[_0x3c36aa(0x10c)]((_0x61d902,_0x517b55)=>{var _0x18d306=_0x3c36aa;_0x21205b[_0x517b55][_0x18d306(0x12f)]=_0x61d902;}),_0x4ea40c[_0x3c36aa(0x10c)]((_0x14f01a,_0x213bc9)=>{var _0xfd15f5=_0x3c36aa;_0x21205b[_0x213bc9][_0xfd15f5(0x1c8)]=_0x14f01a,_0x21205b[_0x213bc9]['date_data']=_0x569ec6;}),_0x733035[_0x3c36aa(0x10c)]((_0x252a9d,_0x273b29)=>{var _0x17c137=_0x3c36aa;_0x21205b[_0x273b29][_0x17c137(0x100)]=Math['abs'](_0x252a9d);}),_0x335c92[_0x3c36aa(0x10c)]((_0x1ec0af,_0x1b920b)=>{var _0x21d3e7=_0x3c36aa;_0x21205b[_0x1b920b][_0x21d3e7(0x1b5)]=_0x1ec0af;}),_0x58e819[_0x3c36aa(0x10c)]((_0x151272,_0x48f2cf)=>{var _0x526ffe=_0x3c36aa;_0x21205b[_0x48f2cf][_0x526ffe(0x1a1)]=_0x151272;}),_0x135e83[_0x3c36aa(0x10c)]((_0x4e55b1,_0x4a32ec)=>{var _0x2e060c=_0x3c36aa;_0x20a1b4[_0x2e060c(0x10c)]((_0x217b18,_0x320441)=>{var _0x546646=_0x2e060c;if(_0x217b18==_0x546646(0x1ca)&&_0x4a32ec==_0x320441){console[_0x546646(0x150)](_0x217b18+_0x546646(0x1cb)+_0x4a32ec+_0x546646(0xfd)+_0x320441+'\x20<>\x20'+_0x4e55b1);var _0x28c4db=_0x4e55b1[_0x546646(0x1b2)](0x3);_0x21205b[_0x4a32ec][_0x546646(0x1ac)]=_0x4e55b1[0x0],_0x21205b[_0x4a32ec][_0x546646(0x16b)]=_0x4e55b1[0x1],_0x21205b[_0x4a32ec][_0x546646(0x110)]=0x0,_0x21205b[_0x4a32ec][_0x546646(0x126)]=0x0,_0x21205b[_0x4a32ec]['type']=_0x546646(0x1ab),_0x21205b[_0x4a32ec][_0x546646(0x1cd)]=_0x28c4db;}else{if(_0x217b18=='Shelves'&&_0x4a32ec==_0x320441){var _0x28c4db=_0x4e55b1[_0x546646(0x1b2)](0x3);_0x21205b[_0x4a32ec]['storage']=_0x4e55b1[0x0],_0x21205b[_0x4a32ec]['rack']=_0x4e55b1[0x1],_0x21205b[_0x4a32ec][_0x546646(0x110)]=0x0,_0x21205b[_0x4a32ec][_0x546646(0x126)]=0x0,_0x21205b[_0x4a32ec]['type']='Floor',_0x21205b[_0x4a32ec][_0x546646(0x1cd)]=_0x4e55b1[0x5];}else{if(_0x4a32ec==_0x320441){if(_0x4e55b1[0x0]=='A'&&_0x4e55b1[0x1]=='L'&&_0x4e55b1[0x2]=='L')console[_0x546646(0x150)](_0x217b18+'\x20<>\x20'+_0x4a32ec+_0x546646(0xfd)+_0x320441+_0x546646(0xfd)+_0x4e55b1+_0x546646(0x156)),_0x21205b[_0x4a32ec]['storage']=_0x4e55b1[0x0],_0x21205b[_0x4a32ec][_0x546646(0x16b)]=_0x4e55b1[0x1],_0x21205b[_0x4a32ec][_0x546646(0x110)]=0x0,_0x21205b[_0x4a32ec][_0x546646(0x126)]=0x0,_0x21205b[_0x4a32ec][_0x546646(0x10b)]='Floor',_0x21205b[_0x4a32ec][_0x546646(0x1cd)]=_0x4e55b1[0x3];else{var _0x581e08;if(_0x4e55b1[0x4]=='L')_0x581e08=_0x546646(0x1a7);else _0x4e55b1[0x4]=='F'&&(_0x581e08=_0x546646(0x1ab));_0x21205b[_0x4a32ec]['storage']=_0x4e55b1[0x0],_0x21205b[_0x4a32ec]['rack']=_0x4e55b1[0x1],_0x21205b[_0x4a32ec][_0x546646(0x110)]=_0x4e55b1[0x2],_0x21205b[_0x4a32ec][_0x546646(0x126)]=_0x4e55b1[0x3],_0x21205b[_0x4a32ec][_0x546646(0x10b)]=_0x581e08,_0x21205b[_0x4a32ec]['floorlevel']=_0x4e55b1[0x5];}}}}});}),_0x5ceff0[_0x3c36aa(0x10c)]((_0x33e1c0,_0x475dd1)=>{var _0x11ac1e=_0x3c36aa;_0x21205b[_0x475dd1][_0x11ac1e(0x187)]=_0x33e1c0;}),_0x5b6026[_0x3c36aa(0x10c)]((_0x2ba787,_0x101587)=>{var _0x2cbcb1=_0x3c36aa;_0x21205b[_0x101587][_0x2cbcb1(0xe4)]=_0x2ba787;}),_0x4a861b[_0x3c36aa(0x10c)]((_0x502d8d,_0xd0129d)=>{var _0x4ea7fa=_0x3c36aa;_0x21205b[_0xd0129d][_0x4ea7fa(0x1ba)]=_0x502d8d;}),_0x3c9267[_0x3c36aa(0x10c)]((_0x27d320,_0x33c74e)=>{_0x21205b[_0x33c74e]['batch_code']=_0x27d320;}),_0x497a37[_0x3c36aa(0x10c)]((_0x463101,_0x55c0f2)=>{var _0x5d9cac=_0x3c36aa;_0x21205b[_0x55c0f2][_0x5d9cac(0x1c1)]=_0x463101;}),_0x11f2b0['forEach']((_0x127746,_0x5ef08f)=>{var _0x44ac53=_0x3c36aa;_0x21205b[_0x5ef08f][_0x44ac53(0x12d)]=_0x127746;}),_0xc072cb[_0x3c36aa(0x10c)]((_0x56665e,_0x9de691)=>{_0x21205b[_0x9de691]['alertQTY']=_0x56665e;}),_0x588d09[_0x3c36aa(0x10c)]((_0x3155f8,_0x1679a9)=>{var _0x1eee0f=_0x3c36aa;_0x21205b[_0x1679a9][_0x1eee0f(0x1c4)]=_0x3155f8;}),_0x1028c0[_0x3c36aa(0x10c)]((_0x44f71d,_0x345e29)=>{var _0x2d34ad=_0x3c36aa;_0x21205b[_0x345e29][_0x2d34ad(0xf5)]=_0x44f71d;}),_0x20a1b4[_0x3c36aa(0x10c)]((_0x1c8805,_0x28f31b)=>{_0x21205b[_0x28f31b]['room_name']=_0x1c8805;}),_0x4dcce3[_0x3c36aa(0x10c)]((_0x552dab,_0x197935)=>{var _0x3eb4fb=_0x3c36aa;_0x21205b[_0x197935][_0x3eb4fb(0x122)]=_0x552dab;}),_0x2f0a4e[_0x3c36aa(0x10c)]((_0x219896,_0x43fb36)=>{var _0xd51904=_0x3c36aa;_0x21205b[_0x43fb36][_0xd51904(0x18a)]=_0x219896;}),_0x3ae028['forEach']((_0x4e9f64,_0x47501a)=>{var _0x69566e=_0x3c36aa;_0x21205b[_0x47501a][_0x69566e(0xdd)]=_0x4e9f64;});const _0x11859a=_0x20a1b4[_0x3c36aa(0x125)](_0x4512fc=>{return _0x4512fc={'room_name':_0x4512fc};}),_0x16f29b=_0x21205b[_0x3c36aa(0x15d)](_0x5031b7=>_0x5031b7[_0x3c36aa(0x100)]!=='0'&&_0x5031b7['quantity']!==''),_0x48373f=new purchases({'invoice':_0x162086,'suppliers':_0x52ed27[_0x3c36aa(0x13c)]['suppliers'],'date':_0x569ec6,'warehouse_name':_0x5b3be2,'product':_0x16f29b,'note':_0x3c7f87,'due_amount':_0x1fc708,'POnumber':_0x4e41e3,'SCRN':_0x41b78a,'JO_number':_0x584221,'roomList':_0x11859a}),_0x1af050=await _0x48373f[_0x3c36aa(0xe5)](),_0x378a01=await purchases[_0x3c36aa(0x162)]({'invoice':_0x162086}),_0x2b570c=_0x378a01['product'][_0x3c36aa(0x125)](async _0x1f24d8=>{var _0x432c07=_0x3c36aa,_0x5d6303=await warehouse[_0x432c07(0x162)]({'name':_0x5b3be2,'room':_0x1f24d8[_0x432c07(0x163)]}),_0x418ecb=0x0;return _0x5d6303['product_details'][_0x432c07(0x10c)](_0x2b3417=>{var _0x5450e1=_0x432c07;_0x2b3417[_0x5450e1(0xd2)]==_0x1f24d8['product_name']&&_0x2b3417[_0x5450e1(0x1cd)]==_0x1f24d8[_0x5450e1(0x1cd)]&&_0x2b3417[_0x5450e1(0x10b)]==_0x1f24d8[_0x5450e1(0x10b)]&&_0x2b3417[_0x5450e1(0x126)]==_0x1f24d8[_0x5450e1(0x126)]&&_0x2b3417[_0x5450e1(0x110)]==_0x1f24d8[_0x5450e1(0x110)]&&_0x2b3417['rack']==_0x1f24d8[_0x5450e1(0x16b)]&&_0x2b3417[_0x5450e1(0x1ac)]==_0x1f24d8[_0x5450e1(0x1ac)]&&_0x2b3417[_0x5450e1(0x1c1)]==_0x1f24d8['expiry_date']&&_0x2b3417[_0x5450e1(0x124)]==_0x1f24d8[_0x5450e1(0x124)]&&_0x2b3417['production_date']==_0x1f24d8[_0x5450e1(0x1c4)]&&_0x2b3417[_0x5450e1(0xdd)]==_0x378a01['invoice']&&(_0x2b3417[_0x5450e1(0x197)]+=Math['abs'](_0x1f24d8[_0x5450e1(0x100)]),_0x418ecb++);}),_0x418ecb===0x0&&_0x5d6303[_0x432c07(0x1b7)][_0x432c07(0x131)]({'product_name':_0x1f24d8[_0x432c07(0xd2)],'product_stock':Math['abs'](_0x1f24d8[_0x432c07(0x100)]),'primary_code':_0x1f24d8[_0x432c07(0x187)],'secondary_code':_0x1f24d8[_0x432c07(0xe4)],'product_code':_0x1f24d8[_0x432c07(0x1c8)],'storage':_0x1f24d8[_0x432c07(0x1ac)],'rack':_0x1f24d8[_0x432c07(0x16b)],'bay':_0x1f24d8[_0x432c07(0x110)],'bin':_0x1f24d8[_0x432c07(0x126)],'type':_0x1f24d8[_0x432c07(0x10b)],'floorlevel':_0x1f24d8[_0x432c07(0x1cd)],'maxProducts':_0x1f24d8[_0x432c07(0x1ba)],'unit':_0x1f24d8[_0x432c07(0x1b5)],'secondary_unit':_0x1f24d8[_0x432c07(0x1a1)],'expiry_date':_0x1f24d8[_0x432c07(0x1c1)],'maxPerUnit':_0x1f24d8[_0x432c07(0x12d)],'batch_code':_0x1f24d8['batch_code'],'alertQTY':_0x1f24d8['alertQTY'],'production_date':_0x1f24d8[_0x432c07(0x1c4)],'product_cat':_0x1f24d8['product_cat'],'invoice':_0x1f24d8[_0x432c07(0xdd)],'actual_qty':Math[_0x432c07(0x157)](_0x1f24d8[_0x432c07(0xff)]),'actual_uom':_0x1f24d8[_0x432c07(0x12f)],'delivery_date':_0x1f24d8[_0x432c07(0x122)],'delivery_code':_0x1f24d8['delivery_code']}),_0x5d6303;});Promise[_0x3c36aa(0x1e0)](_0x2b570c)['then'](async _0x28c2f3=>{var _0x1956f3=_0x3c36aa;try{for(const _0x156450 of _0x28c2f3){await _0x156450[_0x1956f3(0xe5)]();}const _0x2a3336=await master_shop[_0x1956f3(0x134)](),_0x35d902=await email_settings[_0x1956f3(0x162)](),_0x3343df=await supervisor_settings[_0x1956f3(0x134)]();var _0x2d74fb=_0x378a01[_0x1956f3(0x12c)],_0x18b37a='',_0x5b9551;for(_0x5b9551 in _0x2d74fb){_0x18b37a+=_0x1956f3(0x11d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d74fb[_0x5b9551][_0x1956f3(0xd2)]+_0x1956f3(0x192)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d74fb[_0x5b9551][_0x1956f3(0x1c8)]+'</td>'+_0x1956f3(0x17d)+_0x2d74fb[_0x5b9551]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d74fb[_0x5b9551][_0x1956f3(0x1b5)]+_0x1956f3(0x192)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2d74fb[_0x5b9551][_0x1956f3(0x1a1)]+'</td>'+_0x1956f3(0x17d)+_0x378a01[_0x1956f3(0x195)]+'</td>'+_0x1956f3(0x17d)+_0x2d74fb[_0x5b9551]['room_name']+_0x1956f3(0x192)+_0x1956f3(0x17d)+_0x2d74fb[_0x5b9551]['storage']+_0x2d74fb[_0x5b9551][_0x1956f3(0x16b)]+_0x2d74fb[_0x5b9551][_0x1956f3(0x110)]+_0x2d74fb[_0x5b9551][_0x1956f3(0x126)]+_0x2d74fb[_0x5b9551]['type'][0x0]+_0x2d74fb[_0x5b9551]['floorlevel']+'</td>',_0x1956f3(0x15b);}let _0x3229a1=nodemailer['createTransport']({'host':_0x35d902[_0x1956f3(0x109)],'port':Number(_0x35d902[_0x1956f3(0x147)]),'secure':![],'auth':{'user':_0x35d902[_0x1956f3(0x1e6)],'pass':_0x35d902[_0x1956f3(0x194)]}}),_0x2dd710={'from':_0x35d902[_0x1956f3(0x1e6)],'to':_0x3343df[0x0]['RMSEmail'],'subject':_0x1956f3(0x133),'attachments':[{'filename':_0x1956f3(0x199),'path':__dirname+_0x1956f3(0x164)+_0x1956f3(0x1b6)+_0x2a3336[0x0][_0x1956f3(0xeb)],'cid':_0x1956f3(0x11b)}],'html':_0x1956f3(0x17f)+'<html><head><title></title>'+_0x1956f3(0x1e8)+_0x1956f3(0x188)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1956f3(0x188)+_0x1956f3(0x1af)+'</div>'+_0x1956f3(0x188)+_0x1956f3(0x1b3)+_0x2a3336[0x0]['site_title']+_0x1956f3(0x183)+_0x1956f3(0x1d3)+_0x1956f3(0x1d3)+_0x1956f3(0xe2)+_0x1956f3(0x188)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1956f3(0x178)+_0x378a01[_0x1956f3(0xdd)]+'\x20'+_0x1956f3(0x1bd)+_0x1956f3(0xef)+_0x378a01[_0x1956f3(0x1a3)]+'\x20'+_0x1956f3(0xd4)+_0x1956f3(0x176)+_0x1956f3(0x1d3)+_0x1956f3(0x120)+_0x1956f3(0x1bb)+'<tr>'+_0x1956f3(0x102)+_0x1956f3(0x113)+_0x1956f3(0xdb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1956f3(0x180)+_0x1956f3(0x173)+_0x1956f3(0x15e)+_0x1956f3(0x15b)+_0x1956f3(0x13b)+_0x1956f3(0x152)+'\x20'+_0x18b37a+'\x20'+'</tbody>'+_0x1956f3(0x13d)+_0x1956f3(0x188)+_0x1956f3(0xe3)+'<h5>'+_0x2a3336[0x0][_0x1956f3(0xda)]+_0x1956f3(0x176)+_0x1956f3(0x1d3)+_0x1956f3(0x1d3)+'</body></html>'};_0x3229a1[_0x1956f3(0xea)](_0x2dd710,function(_0x4b73ef,_0x56c2c9){var _0x25063c=_0x1956f3;_0x4b73ef?(console[_0x25063c(0x150)](_0x4b73ef),console[_0x25063c(0x150)](_0x25063c(0x19c))):console[_0x25063c(0x150)](_0x25063c(0x165));}),_0x52ed27[_0x1956f3(0x112)](_0x1956f3(0x1aa),_0x1956f3(0x168)),_0x4c3d97[_0x1956f3(0x179)]('/all_purchases/view/');}catch(_0x2f5d83){console['error'](_0x2f5d83),_0x4c3d97[_0x1956f3(0x1a9)](0x1f4)[_0x1956f3(0x169)]({'error':_0x1956f3(0xe0)});}})['catch'](_0x438895=>{var _0x1f0183=_0x3c36aa;console[_0x1f0183(0x1d8)](_0x438895),_0x4c3d97[_0x1f0183(0x1a9)](0x1f4)['json']({'error':_0x1f0183(0x181)});});}catch(_0x1111fd){console[_0x3c36aa(0x150)](_0x1111fd);}}),router[a0_0x1a7251(0x1bc)](a0_0x1a7251(0x1c9),auth,async(_0x4acbe6,_0x131bf2)=>{var _0x5edc3b=a0_0x1a7251;try{const {username:_0x5e2c97,email:_0x1536b7,role:_0x2dfade}=_0x4acbe6[_0x5edc3b(0x16d)],_0x497412=_0x4acbe6[_0x5edc3b(0x16d)],_0x220ac4=await profile[_0x5edc3b(0x162)]({'email':_0x497412[_0x5edc3b(0x1e6)]}),_0x49e02b=await master_shop[_0x5edc3b(0x134)](),_0x276c89=_0x4acbe6['params']['id'],_0xc9783a=await purchases['findById'](_0x276c89),_0x2b6d68=await warehouse[_0x5edc3b(0xde)]([{'$match':{'name':_0xc9783a[_0x5edc3b(0x195)],'room':_0xc9783a['room']}},{'$unwind':_0x5edc3b(0x14d)},{'$group':{'_id':_0x5edc3b(0x127),'name':{'$first':_0x5edc3b(0xee)},'product_stock':{'$first':_0x5edc3b(0x16e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5edc3b(0xd0)},'type':{'$first':_0x5edc3b(0xd8)},'floorlevel':{'$first':_0x5edc3b(0x18c)},'primary_code':{'$first':_0x5edc3b(0x14e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5edc3b(0x18f)},'storage':{'$first':_0x5edc3b(0x1de)},'rack':{'$first':_0x5edc3b(0x105)},'expiry_date':{'$first':_0x5edc3b(0x154)}}}]),_0x2a410b=await customer[_0x5edc3b(0x134)]({});let _0x1484ae;if(_0x497412[_0x5edc3b(0xfe)]==_0x5edc3b(0x160)){const _0x3cf302=await staff[_0x5edc3b(0x162)]({'email':_0x497412[_0x5edc3b(0x1e6)]});_0x1484ae=await warehouse[_0x5edc3b(0xde)]([{'$match':{'status':_0x5edc3b(0xf7),'name':_0x3cf302[_0x5edc3b(0x148)]}},{'$group':{'_id':_0x5edc3b(0x1f0),'name':{'$first':'$name'}}}]);}else _0x1484ae=await warehouse['aggregate']([{'$match':{'status':_0x5edc3b(0xf7)}},{'$group':{'_id':_0x5edc3b(0x1f0),'name':{'$first':_0x5edc3b(0x1f0)}}}]);const _0x1d0489=await product[_0x5edc3b(0x134)]({}),_0x222b94=await suppliers[_0x5edc3b(0x134)]({}),_0x2268eb=BayBinSelected(_0xc9783a['warehouse_name'],_0xc9783a['room']);if(_0x49e02b[0x0]['language']==_0x5edc3b(0x1b1)){var _0x2e8c20=users['English'];console[_0x5edc3b(0x150)](_0x2e8c20);}else{if(_0x49e02b[0x0][_0x5edc3b(0x16c)]==_0x5edc3b(0x1a0))var _0x2e8c20=users[_0x5edc3b(0x1a0)];else{if(_0x49e02b[0x0][_0x5edc3b(0x16c)]==_0x5edc3b(0x1a8))var _0x2e8c20=users[_0x5edc3b(0x1a8)];else{if(_0x49e02b[0x0][_0x5edc3b(0x16c)]=='Spanish')var _0x2e8c20=users[_0x5edc3b(0xe1)];else{if(_0x49e02b[0x0]['language']==_0x5edc3b(0x135))var _0x2e8c20=users[_0x5edc3b(0x135)];else{if(_0x49e02b[0x0][_0x5edc3b(0x16c)]==_0x5edc3b(0x114))var _0x2e8c20=users[_0x5edc3b(0x1d9)];else{if(_0x49e02b[0x0]['language']==_0x5edc3b(0x198))var _0x2e8c20=users['Chinese'];else{if(_0x49e02b[0x0]['language']==_0x5edc3b(0x19a))var _0x2e8c20=users[_0x5edc3b(0x196)];}}}}}}}_0x131bf2[_0x5edc3b(0x1a4)](_0x5edc3b(0xf9),{'success':_0x4acbe6[_0x5edc3b(0x112)](_0x5edc3b(0x1aa)),'errors':_0x4acbe6['flash'](_0x5edc3b(0x161)),'role':_0x497412,'profile':_0x220ac4,'customer':_0x2a410b,'warehouse':_0x1484ae,'product':_0x2b6d68,'user':_0xc9783a,'master_shop':_0x49e02b,'unit':_0x1d0489,'language':_0x2e8c20,'suppliers':_0x222b94,'dataSelected':_0x2268eb});}catch(_0x27b9cb){console[_0x5edc3b(0x150)](_0x27b9cb);}}),router[a0_0x1a7251(0xd1)](a0_0x1a7251(0x1c9),auth,async(_0x57f875,_0x2b9eca)=>{var _0x44c7df=a0_0x1a7251;try{const _0x2062ff=_0x57f875['params']['id'],{invoice:_0x4d4131,warehouse_name:_0xe62b38,Room_name:_0x25aadc}=_0x57f875[_0x44c7df(0x13c)],_0x498c72=await warehouse['findOne']({'name':_0xe62b38,'room':_0x25aadc}),_0x347d1b=await purchases[_0x44c7df(0x162)]({'invoice':_0x4d4131});_0x347d1b[_0x44c7df(0x12c)][_0x44c7df(0x10c)](_0x2f818a=>{var _0x502b43=_0x44c7df,_0x2cdc07=0x0;const _0x45048d=_0x498c72['product_details'][_0x502b43(0x125)](_0x26bacb=>{var _0x13c6cd=_0x502b43;_0x26bacb[_0x13c6cd(0xd2)]==_0x2f818a[_0x13c6cd(0xd2)]&&_0x26bacb[_0x13c6cd(0x1cd)]==_0x2f818a[_0x13c6cd(0x1cd)]&&_0x26bacb[_0x13c6cd(0x10b)]==_0x2f818a[_0x13c6cd(0x10b)]&&_0x26bacb[_0x13c6cd(0x126)]==_0x2f818a[_0x13c6cd(0x126)]&&_0x26bacb[_0x13c6cd(0x110)]==_0x2f818a[_0x13c6cd(0x110)]&&_0x26bacb[_0x13c6cd(0x16b)]==_0x2f818a['rack']&&_0x26bacb['storage']==_0x2f818a[_0x13c6cd(0x1ac)]&&_0x26bacb[_0x13c6cd(0x1c1)]==_0x2f818a[_0x13c6cd(0x1c1)]&&_0x26bacb['batch_code']==_0x2f818a['batch_code']&&_0x26bacb['production_date']==_0x2f818a['production_date']&&_0x26bacb['delivery_date']==_0x2f818a['delivery_date']&&_0x26bacb[_0x13c6cd(0x18a)]==_0x2f818a[_0x13c6cd(0x18a)]&&(_0x26bacb['product_stock']=parseInt(_0x26bacb[_0x13c6cd(0x197)])+parseInt(_0x2f818a[_0x13c6cd(0x100)]),_0x2cdc07++);});_0x2cdc07=='0'&&(_0x498c72[_0x502b43(0x1b7)]=_0x498c72[_0x502b43(0x1b7)][_0x502b43(0x108)]({'product_name':_0x2f818a['product_name'],'product_stock':_0x2f818a[_0x502b43(0x100)],'primary_code':_0x2f818a[_0x502b43(0x187)],'secondary_code':_0x2f818a[_0x502b43(0xe4)],'product_code':_0x2f818a[_0x502b43(0x1c8)],'storage':_0x2f818a[_0x502b43(0x1ac)],'rack':_0x2f818a[_0x502b43(0x16b)],'bay':_0x2f818a[_0x502b43(0x110)],'bin':_0x2f818a[_0x502b43(0x126)],'type':_0x2f818a[_0x502b43(0x10b)],'floorlevel':_0x2f818a[_0x502b43(0x1cd)],'maxProducts':_0x2f818a[_0x502b43(0x1ba)],'unit':_0x2f818a[_0x502b43(0x1b5)],'secondary_unit':_0x2f818a[_0x502b43(0x1a1)],'expiry_date':_0x2f818a[_0x502b43(0x1c1)],'maxPerUnit':_0x2f818a['maxperunit'],'batch_code':_0x2f818a[_0x502b43(0x124)],'alertQTY':_0x2f818a[_0x502b43(0x155)],'production_date':_0x2f818a['production_date'],'delivery_date':_0x2f818a[_0x502b43(0x122)],'delivery_code':_0x2f818a[_0x502b43(0x18a)]}));}),await _0x498c72[_0x44c7df(0xe5)](),_0x347d1b['finalize']=_0x44c7df(0x1cf);const _0x5107dc=await _0x347d1b[_0x44c7df(0xe5)]();_0x57f875[_0x44c7df(0x112)](_0x44c7df(0x1aa),_0x44c7df(0x1e5)),_0x2b9eca[_0x44c7df(0x179)](_0x44c7df(0xd7));}catch(_0x134f7c){console[_0x44c7df(0x150)](_0x134f7c);}}),router[a0_0x1a7251(0x1bc)]('/view/:id',auth,async(_0x12ee5e,_0xe8b99e)=>{var _0x2480d8=a0_0x1a7251;try{const {username:_0x3b9cbf,email:_0x16a49c,role:_0x5a0f6d}=_0x12ee5e[_0x2480d8(0x16d)],_0x3fced6=_0x12ee5e['user'],_0x1c79df=await profile[_0x2480d8(0x162)]({'email':_0x3fced6[_0x2480d8(0x1e6)]}),_0x3fb049=await master_shop[_0x2480d8(0x134)](),_0x41ed6e=_0x12ee5e[_0x2480d8(0x17e)]['id'],_0x5233b8=await purchases[_0x2480d8(0xf0)](_0x41ed6e),_0x2e9bbf=await suppliers['find']({});let _0x4a73d2;if(_0x3fced6['role']==_0x2480d8(0x160)){const _0x59534c=await staff['findOne']({'email':_0x3fced6['email']});_0x4a73d2=await warehouse[_0x2480d8(0x134)]({'status':'Enabled','name':_0x59534c[_0x2480d8(0x148)],'warehouse_category':'Raw\x20Materials'});}else _0x4a73d2=await warehouse['aggregate']([{'$match':{'status':_0x2480d8(0xf7),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x42cfcc=await product[_0x2480d8(0x134)]({}),_0x2eaa01=BayBinSelected(_0x5233b8['warehouse_name'],_0x5233b8[_0x2480d8(0x1dd)]);let _0x24994e=new Date(_0x5233b8[_0x2480d8(0x1c1)]),_0x1bae77=('0'+_0x24994e[_0x2480d8(0xfa)]())['slice'](-0x2),_0x3edbab=('0'+(_0x24994e[_0x2480d8(0xf6)]()+0x1))['slice'](-0x2),_0x4be0cf=_0x24994e['getFullYear'](),_0xdd6151=_0x4be0cf+'-'+_0x3edbab+'-'+_0x1bae77;if(_0x3fb049[0x0][_0x2480d8(0x16c)]=='English\x20(US)'){var _0xc3fe15=users[_0x2480d8(0x142)];console[_0x2480d8(0x150)](_0xc3fe15);}else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]==_0x2480d8(0x1a0))var _0xc3fe15=users[_0x2480d8(0x1a0)];else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]=='German')var _0xc3fe15=users['German'];else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]==_0x2480d8(0xe1))var _0xc3fe15=users[_0x2480d8(0xe1)];else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]=='French')var _0xc3fe15=users['French'];else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]=='Portuguese\x20(BR)')var _0xc3fe15=users[_0x2480d8(0x1d9)];else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]==_0x2480d8(0x198))var _0xc3fe15=users[_0x2480d8(0x198)];else{if(_0x3fb049[0x0][_0x2480d8(0x16c)]==_0x2480d8(0x19a))var _0xc3fe15=users[_0x2480d8(0x196)];}}}}}}}_0xe8b99e[_0x2480d8(0x1a4)](_0x2480d8(0x1e3),{'success':_0x12ee5e[_0x2480d8(0x112)](_0x2480d8(0x1aa)),'errors':_0x12ee5e['flash'](_0x2480d8(0x161)),'role':_0x3fced6,'profile':_0x1c79df,'purchases':_0x5233b8,'suppliers':_0x2e9bbf,'warehouse':_0x4a73d2,'product':_0x42cfcc,'master_shop':_0x3fb049,'language':_0xc3fe15,'ed_fullDate':_0xdd6151,'dataSelected':_0x2eaa01});}catch(_0x20a2f9){console['log'](_0x20a2f9);}}),router['post']('/view/:id',auth,async(_0x4d450a,_0x43da19)=>{var _0x57cd9e=a0_0x1a7251;try{const _0x41c52e=_0x4d450a[_0x57cd9e(0x17e)]['id'],_0x299538=await purchases[_0x57cd9e(0x162)]({'_id':_0x4d450a[_0x57cd9e(0x17e)]['id']}),_0x3cadad=await warehouse[_0x57cd9e(0x162)]({'name':_0x299538['warehouse_name'],'room':_0x299538[_0x57cd9e(0x1dd)]});_0x299538[_0x57cd9e(0x12c)][_0x57cd9e(0x10c)](_0x3d57d3=>{var _0x1fb69f=_0x57cd9e;const _0x30f0af=_0x3cadad[_0x1fb69f(0x1b7)][_0x1fb69f(0x125)](_0x473b77=>{var _0x47e72c=_0x1fb69f;_0x473b77['product_name']==_0x3d57d3[_0x47e72c(0xd2)]&&_0x473b77['floorlevel']==_0x3d57d3[_0x47e72c(0x1cd)]&&_0x473b77['type']==_0x3d57d3['type']&&_0x473b77[_0x47e72c(0x126)]==_0x3d57d3[_0x47e72c(0x126)]&&_0x473b77[_0x47e72c(0x110)]==_0x3d57d3[_0x47e72c(0x110)]&&_0x473b77[_0x47e72c(0x16b)]==_0x3d57d3[_0x47e72c(0x16b)]&&_0x473b77[_0x47e72c(0x1ac)]==_0x3d57d3['storage']&&(_0x473b77[_0x47e72c(0x197)]=parseInt(_0x473b77[_0x47e72c(0x197)])-parseInt(_0x3d57d3[_0x47e72c(0x100)]));});}),await _0x3cadad['save']();const {invoice:_0xb458e7,suppliers:_0x50e6db,date:_0x5a2941,warehouse_name:_0x5d35f3,prod_name:_0x114b71,prod_code:_0x922aa6,prod_qty:_0x2d2147,prod_unit:_0x13ebea,prod_secondunit:_0x1d0978,prod_level:_0x2b7117,prod_isle:_0xe1df96,prod_pallet:_0x115ca4,note:_0x4a2746,expiry_date:_0x44c6a3,batch_code:_0x55a2cd,paid_amount:_0x5cee75,due_amount:_0x457493,Room_name:_0x243db9,primary_code:_0x4549b7,secondary_code:_0x198aa5,PO_number:_0x577a93,JO_number:_0x18a568}=_0x4d450a[_0x57cd9e(0x13c)];if(typeof _0x114b71=='string')var _0x1d0feb=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x12b)]],_0x5bfe6d=[_0x4d450a[_0x57cd9e(0x13c)]['prod_code']],_0x55dfa7=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x101)]],_0x4168cb=[_0x4d450a['body'][_0x57cd9e(0x13a)]],_0x24fe97=[_0x4d450a['body'][_0x57cd9e(0x1be)]],_0x25f94d=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x11c)]],_0x404c5f=[_0x4d450a[_0x57cd9e(0x13c)]['prod_isle']],_0x2cdcbb=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x145)]],_0x18ada3=[_0x4d450a[_0x57cd9e(0x13c)]['primary_code']],_0x509b5e=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0xe4)]],_0x1297a1=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x1d2)]],_0x2d021d=[_0x4d450a['body'][_0x57cd9e(0x124)]],_0x481f60=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x1c1)]],_0x9dd28=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x1ac)]],_0xb2a388=[_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0xdc)]],_0x50eb0f=[_0x4d450a[_0x57cd9e(0x13c)]['type']];else var _0x1d0feb=[..._0x4d450a['body']['prod_name']],_0x5bfe6d=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0xd5)]],_0x55dfa7=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x101)]],_0x4168cb=[..._0x4d450a[_0x57cd9e(0x13c)]['prod_unit']],_0x24fe97=[..._0x4d450a['body'][_0x57cd9e(0x1be)]],_0x25f94d=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x11c)]],_0x404c5f=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x177)]],_0x2cdcbb=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x145)]],_0x18ada3=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x187)]],_0x509b5e=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0xe4)]],_0x1297a1=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x1d2)]],_0x2d021d=[..._0x4d450a[_0x57cd9e(0x13c)]['batch_code']],_0x481f60=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x1c1)]],_0x9dd28=[..._0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0x1ac)]],_0xb2a388=[..._0x4d450a[_0x57cd9e(0x13c)]['rak']],_0x50eb0f=[..._0x4d450a[_0x57cd9e(0x13c)]['type']];const _0x1a95fc=_0x1d0feb[_0x57cd9e(0x125)](_0x109cd3=>{return _0x109cd3={'product_name':_0x109cd3};});_0x5bfe6d[_0x57cd9e(0x10c)]((_0x29f69d,_0x5cf5ca)=>{var _0x49c14e=_0x57cd9e;_0x1a95fc[_0x5cf5ca][_0x49c14e(0x1c8)]=_0x29f69d;}),_0x55dfa7['forEach']((_0x44d8ab,_0xe21790)=>{var _0x2e32cc=_0x57cd9e;_0x1a95fc[_0xe21790][_0x2e32cc(0x100)]=_0x44d8ab;}),_0x4168cb['forEach']((_0x40599d,_0x181a7c)=>{var _0x33bd6a=_0x57cd9e;_0x1a95fc[_0x181a7c][_0x33bd6a(0x1b5)]=_0x40599d;}),_0x24fe97[_0x57cd9e(0x10c)]((_0x41b4e6,_0x5ae52c)=>{var _0x2c4f4a=_0x57cd9e;_0x1a95fc[_0x5ae52c][_0x2c4f4a(0x1a1)]=_0x41b4e6;}),_0x25f94d[_0x57cd9e(0x10c)]((_0x56628e,_0x93d887)=>{var _0x4f3ee2=_0x57cd9e;_0x1a95fc[_0x93d887][_0x4f3ee2(0x110)]=_0x56628e;}),_0x404c5f[_0x57cd9e(0x10c)]((_0x30fe09,_0x12ed8f)=>{var _0x56ce63=_0x57cd9e;_0x1a95fc[_0x12ed8f][_0x56ce63(0x126)]=_0x30fe09;}),_0x2cdcbb[_0x57cd9e(0x10c)]((_0x43e4ee,_0x32641a)=>{_0x1a95fc[_0x32641a]['floorlevel']=_0x43e4ee;}),_0x18ada3['forEach']((_0x499fcb,_0x3629de)=>{var _0x5ea71d=_0x57cd9e;_0x1a95fc[_0x3629de][_0x5ea71d(0x187)]=_0x499fcb;}),_0x509b5e['forEach']((_0x441d00,_0x29c27c)=>{var _0x1366db=_0x57cd9e;_0x1a95fc[_0x29c27c][_0x1366db(0xe4)]=_0x441d00;}),_0x1297a1[_0x57cd9e(0x10c)]((_0x37dcd6,_0x172060)=>{var _0x30ff53=_0x57cd9e;_0x1a95fc[_0x172060][_0x30ff53(0x1ba)]=_0x37dcd6;}),_0x2d021d[_0x57cd9e(0x10c)]((_0x530de4,_0x48b635)=>{_0x1a95fc[_0x48b635]['batch_code']=_0x530de4;}),_0x481f60[_0x57cd9e(0x10c)]((_0x3a751f,_0x4e2e47)=>{var _0x1d573d=_0x57cd9e;_0x1a95fc[_0x4e2e47][_0x1d573d(0x1c1)]=_0x3a751f;}),_0x50eb0f['forEach']((_0x54277c,_0x5c0a04)=>{var _0x50b536=_0x57cd9e;_0x1a95fc[_0x5c0a04][_0x50b536(0x10b)]=_0x54277c;}),_0x9dd28[_0x57cd9e(0x10c)]((_0x3f50f4,_0x2d29df)=>{var _0x183907=_0x57cd9e;_0x1a95fc[_0x2d29df][_0x183907(0x1ac)]=_0x3f50f4;}),_0xb2a388[_0x57cd9e(0x10c)]((_0x36a4cd,_0x52dd03)=>{_0x1a95fc[_0x52dd03]['rack']=_0x36a4cd;});const _0xb82490=_0x1a95fc[_0x57cd9e(0x15d)](_0x315932=>_0x315932[_0x57cd9e(0x100)]!=='0'&&_0x315932[_0x57cd9e(0x100)]!=='');_0x299538[_0x57cd9e(0xdd)]=_0xb458e7,_0x299538['suppliers']=_0x50e6db,_0x299538[_0x57cd9e(0x1a3)]=_0x5a2941,_0x299538[_0x57cd9e(0x195)]=_0x5d35f3,_0x299538[_0x57cd9e(0x12c)]=_0xb82490,_0x299538[_0x57cd9e(0x12a)]=_0x4a2746,_0x299538['paid_amount']=_0x5cee75,_0x299538[_0x57cd9e(0x171)]=_0x457493,_0x299538[_0x57cd9e(0x1dd)]=_0x243db9,_0x299538[_0x57cd9e(0x1d0)]=_0x577a93,_0x299538[_0x57cd9e(0xdf)]=_0x18a568;const _0x26ba37=await _0x299538['save'](),_0x566cd0=await warehouse[_0x57cd9e(0x162)]({'name':_0x4d450a[_0x57cd9e(0x13c)]['warehouse_name'],'room':_0x4d450a['body']['Room_name']});_0x299538[_0x57cd9e(0x12c)][_0x57cd9e(0x10c)](_0x8c3029=>{var _0x29c1b6=_0x57cd9e,_0x37b0c5=0x0;const _0x44bae2=_0x566cd0[_0x29c1b6(0x1b7)][_0x29c1b6(0x125)](_0x140708=>{var _0x1b4608=_0x29c1b6;_0x140708[_0x1b4608(0xd2)]==_0x8c3029[_0x1b4608(0xd2)]&&_0x140708['floorlevel']==_0x8c3029[_0x1b4608(0x1cd)]&&_0x140708[_0x1b4608(0x10b)]==_0x8c3029[_0x1b4608(0x10b)]&&_0x140708['bin']==_0x8c3029[_0x1b4608(0x126)]&&_0x140708[_0x1b4608(0x110)]==_0x8c3029[_0x1b4608(0x110)]&&_0x140708[_0x1b4608(0x16b)]==_0x8c3029[_0x1b4608(0x16b)]&&_0x140708['storage']==_0x8c3029['storage']&&(_0x140708[_0x1b4608(0x197)]=parseInt(_0x140708['product_stock'])+parseInt(_0x8c3029['quantity']),_0x37b0c5++);});_0x37b0c5=='0'&&(_0x566cd0['product_details']=_0x566cd0[_0x29c1b6(0x1b7)]['concat']({'product_name':_0x8c3029[_0x29c1b6(0xd2)],'product_stock':_0x8c3029[_0x29c1b6(0x100)],'primary_code':_0x8c3029[_0x29c1b6(0x187)],'secondary_code':_0x8c3029['secondary_code'],'product_code':_0x8c3029['product_code'],'storage':_0x8c3029['storage'],'rack':_0x8c3029[_0x29c1b6(0x16b)],'bay':_0x8c3029[_0x29c1b6(0x110)],'bin':_0x8c3029[_0x29c1b6(0x126)],'type':_0x8c3029[_0x29c1b6(0x10b)],'floorlevel':_0x8c3029[_0x29c1b6(0x1cd)],'maxProducts':_0x8c3029[_0x29c1b6(0x1ba)],'unit':_0x8c3029[_0x29c1b6(0x1b5)],'secondary_unit':_0x8c3029['secondary_unit'],'expiry_date':_0x8c3029[_0x29c1b6(0x1c1)]}));}),await _0x566cd0['save']();const _0x301ac4=await s_payment_data[_0x57cd9e(0x162)]({'invoice':_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0xdd)]});if(_0x301ac4===null){}else console['log'](_0x57cd9e(0x1c0),_0x301ac4,_0x4d450a[_0x57cd9e(0x13c)][_0x57cd9e(0xdd)]),_0x301ac4[_0x57cd9e(0x1c0)]=_0x4d450a['body']['suppliers'],await _0x301ac4[_0x57cd9e(0xe5)]();_0x4d450a[_0x57cd9e(0x112)](_0x57cd9e(0x1aa),_0x57cd9e(0x15c)),_0x43da19[_0x57cd9e(0x179)]('/all_purchases/view');}catch(_0x52f229){console[_0x57cd9e(0x150)](_0x52f229);}}),router[a0_0x1a7251(0xd1)]('/give_payment/:id',auth,async(_0x39a40e,_0x485231)=>{var _0x57c5dc=a0_0x1a7251;try{const _0x4ac7c9=_0x39a40e[_0x57c5dc(0x17e)]['id'],{invoice:_0x49eed5,suppliers:_0x58b183,payable:_0x237f92,due_amount:_0x113c78}=_0x39a40e['body'],_0x8d24df=await purchases[_0x57c5dc(0xf0)](_0x4ac7c9);var _0x1cbd52=_0x237f92-_0x113c78;_0x8d24df[_0x57c5dc(0x1ad)]=parseFloat(_0x8d24df[_0x57c5dc(0x1ad)])+parseFloat(_0x113c78),_0x8d24df[_0x57c5dc(0x171)]=_0x1cbd52;const _0x51441e=await _0x8d24df[_0x57c5dc(0xe5)]();console['log'](_0x51441e);const _0x5cbbc0=await s_payment_data[_0x57c5dc(0x162)]({'invoice':_0x49eed5});_0x5cbbc0[_0x57c5dc(0x153)]=_0x1cbd52,await _0x5cbbc0[_0x57c5dc(0xe5)]();let _0x474321=new Date(),_0x156ea3=('0'+_0x474321['getDate']())[_0x57c5dc(0x1b2)](-0x2),_0x321e9f=('0'+(_0x474321['getMonth']()+0x1))['slice'](-0x2),_0x5e99ea=_0x474321['getFullYear'](),_0x529b19=_0x5e99ea+'-'+_0x321e9f+'-'+_0x156ea3;const _0x38e560=new suppliers_payment({'invoice':_0x49eed5,'date':_0x5e99ea+'-'+_0x321e9f+'-'+_0x156ea3,'suppliers':_0x58b183,'reason':_0x57c5dc(0x130),'amount':_0x113c78}),_0x133dab=await _0x38e560['save']();_0x39a40e[_0x57c5dc(0x112)](_0x57c5dc(0x1aa),_0x57c5dc(0x151)),_0x485231['redirect'](_0x57c5dc(0xd7));}catch(_0x5c1997){console[_0x57c5dc(0x150)](_0x5c1997);}}),router[a0_0x1a7251(0x1bc)](a0_0x1a7251(0x1c6),auth,async(_0x213a27,_0x25887e)=>{var _0x1ceb43=a0_0x1a7251;try{const {username:_0x103b46,email:_0x22179d,role:_0x303bac}=_0x213a27['user'],_0x48cc06=_0x213a27[_0x1ceb43(0x16d)],_0x5232f=await profile[_0x1ceb43(0x162)]({'email':_0x48cc06[_0x1ceb43(0x1e6)]}),_0x4c7da1=await master_shop[_0x1ceb43(0x134)]();console['log'](_0x1ceb43(0x137),_0x4c7da1);const _0x568614=_0x213a27['params']['id'],_0x5e9a8d=await purchases[_0x1ceb43(0xf0)](_0x568614);console['log'](_0x5e9a8d);const _0xc7063=await suppliers[_0x1ceb43(0x162)]({'name':_0x5e9a8d[_0x1ceb43(0x1c0)]});console[_0x1ceb43(0x150)](_0xc7063);if(_0x4c7da1[0x0][_0x1ceb43(0x16c)]==_0x1ceb43(0x1b1)){var _0x1ebf50=users['English'];console[_0x1ceb43(0x150)](_0x1ebf50);}else{if(_0x4c7da1[0x0][_0x1ceb43(0x16c)]=='Hindi')var _0x1ebf50=users[_0x1ceb43(0x1a0)];else{if(_0x4c7da1[0x0]['language']==_0x1ceb43(0x1a8))var _0x1ebf50=users[_0x1ceb43(0x1a8)];else{if(_0x4c7da1[0x0][_0x1ceb43(0x16c)]=='Spanish')var _0x1ebf50=users[_0x1ceb43(0xe1)];else{if(_0x4c7da1[0x0][_0x1ceb43(0x16c)]==_0x1ceb43(0x135))var _0x1ebf50=users[_0x1ceb43(0x135)];else{if(_0x4c7da1[0x0]['language']==_0x1ceb43(0x114))var _0x1ebf50=users[_0x1ceb43(0x1d9)];else{if(_0x4c7da1[0x0][_0x1ceb43(0x16c)]=='Chinese')var _0x1ebf50=users[_0x1ceb43(0x198)];else{if(_0x4c7da1[0x0][_0x1ceb43(0x16c)]==_0x1ceb43(0x19a))var _0x1ebf50=users[_0x1ceb43(0x196)];}}}}}}}_0x25887e[_0x1ceb43(0x1a4)]('purchase_invoice',{'success':_0x213a27[_0x1ceb43(0x112)](_0x1ceb43(0x1aa)),'errors':_0x213a27[_0x1ceb43(0x112)](_0x1ceb43(0x161)),'role':_0x48cc06,'profile':_0x5232f,'master_shop':_0x4c7da1,'supplier':_0xc7063,'purchase':_0x5e9a8d,'language':_0x1ebf50});}catch(_0x11cf05){console['log'](_0x11cf05);}}),router[a0_0x1a7251(0x1bc)](a0_0x1a7251(0x123),auth,async(_0x4b1ead,_0xb0c3ee)=>{var _0x43f8f0=a0_0x1a7251;try{const {username:_0x2ec19c,email:_0x31526a,role:_0x3b83e8}=_0x4b1ead['user'],_0x5a2887=_0x4b1ead['user'],_0x44ba22=await profile['findOne']({'email':_0x5a2887[_0x43f8f0(0x1e6)]}),_0x3a7f00=await master_shop[_0x43f8f0(0x134)]();console[_0x43f8f0(0x150)]('master',_0x3a7f00);const _0x490816=_0x4b1ead[_0x43f8f0(0x17e)]['id'];console[_0x43f8f0(0x150)](_0x490816);const _0x56ab81=await purchases['findById'](_0x490816);console[_0x43f8f0(0x150)](_0x43f8f0(0x140),_0x56ab81);const _0x200332=await product[_0x43f8f0(0x134)]({}),_0x277d97=await warehouse[_0x43f8f0(0xde)]([{'$match':{'name':_0x56ab81[_0x43f8f0(0x195)],'room':_0x56ab81['room'],'warehouse_category':_0x43f8f0(0x149)}},{'$unwind':_0x43f8f0(0x14d)},{'$group':{'_id':_0x43f8f0(0x127),'name':{'$first':_0x43f8f0(0xee)},'product_stock':{'$first':_0x43f8f0(0x16e)},'bay':{'$first':_0x43f8f0(0x1ee)},'bin':{'$first':_0x43f8f0(0xd0)},'type':{'$first':_0x43f8f0(0xd8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x43f8f0(0x14e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x43f8f0(0x18f)},'storage':{'$first':_0x43f8f0(0x1de)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x43f8f0(0xde)]([{'$match':{'status':_0x43f8f0(0xf7),'name':_0x43f8f0(0x1e7),'warehouse_category':_0x43f8f0(0x149)}},{'$group':{'_id':_0x43f8f0(0x1f0),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x43f8f0(0x19f),_0x277d97);if(_0x3a7f00[0x0]['language']=='English\x20(US)'){var _0x45e3aa=users[_0x43f8f0(0x142)];console['log'](_0x45e3aa);}else{if(_0x3a7f00[0x0][_0x43f8f0(0x16c)]==_0x43f8f0(0x1a0))var _0x45e3aa=users[_0x43f8f0(0x1a0)];else{if(_0x3a7f00[0x0][_0x43f8f0(0x16c)]==_0x43f8f0(0x1a8))var _0x45e3aa=users[_0x43f8f0(0x1a8)];else{if(_0x3a7f00[0x0][_0x43f8f0(0x16c)]==_0x43f8f0(0xe1))var _0x45e3aa=users[_0x43f8f0(0xe1)];else{if(_0x3a7f00[0x0][_0x43f8f0(0x16c)]==_0x43f8f0(0x135))var _0x45e3aa=users[_0x43f8f0(0x135)];else{if(_0x3a7f00[0x0]['language']==_0x43f8f0(0x114))var _0x45e3aa=users['Portuguese'];else{if(_0x3a7f00[0x0][_0x43f8f0(0x16c)]==_0x43f8f0(0x198))var _0x45e3aa=users[_0x43f8f0(0x198)];else{if(_0x3a7f00[0x0]['language']=='Arabic\x20(ae)')var _0x45e3aa=users[_0x43f8f0(0x196)];}}}}}}}_0xb0c3ee[_0x43f8f0(0x1a4)]('return_purchase',{'success':_0x4b1ead[_0x43f8f0(0x112)]('success'),'errors':_0x4b1ead[_0x43f8f0(0x112)](_0x43f8f0(0x161)),'role':_0x5a2887,'profile':_0x44ba22,'user':_0x56ab81,'stock':_0x277d97,'master_shop':_0x3a7f00,'product':_0x200332,'language':_0x45e3aa,'warehouse':warehouse_data});}catch(_0x10f232){console['log'](_0x10f232);}}),router['post'](a0_0x1a7251(0x123),auth,async(_0x144f05,_0x34b632)=>{var _0x3ed336=a0_0x1a7251;try{const {invoice:_0x108fe2,date:_0x1716f8,warehouse_name:_0x1c4cf2,Room_name:_0x108918,product_name:_0x2b9429,purchase_quantity:_0x1a0481,stocks:_0x3b847b,return_qty:_0x39ad7a,note:_0x5f0c19,level:_0x41b03d,isle:_0x54a046,pallet:_0x38fabd,to_warehouse_name:_0x40a5d7,to_Room_name:_0x574c5b}=_0x144f05['body'],_0x3f7cbb=await purchases[_0x3ed336(0x162)]({'_id':_0x144f05[_0x3ed336(0x17e)]['id']}),_0x2ad065=await warehouse[_0x3ed336(0x162)]({'name':_0x1c4cf2,'room':_0x108918});if(typeof _0x2b9429==_0x3ed336(0x166))var _0x4955b0=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0xd2)]],_0x1fc3e3=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x19d)]],_0xe83381=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1e4)]],_0x509cec=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x146)]],_0x1dfa60=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0xfb)]],_0xdb5c8f=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x141)]],_0x11b2e6=[_0x144f05['body']['pallet']],_0x11c5ff=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1b8)]],_0x523571=[_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0xf4)]],_0x55a888=[_0x144f05['body'][_0x3ed336(0x12e)]],_0x37f611=[_0x144f05[_0x3ed336(0x13c)]['secondary_code_hide']];else var _0x4955b0=[..._0x144f05[_0x3ed336(0x13c)]['product_name']],_0x1fc3e3=[..._0x144f05[_0x3ed336(0x13c)]['purchase_quantity']],_0xe83381=[..._0x144f05['body']['stocks']],_0x509cec=[..._0x144f05['body'][_0x3ed336(0x146)]],_0x1dfa60=[..._0x144f05[_0x3ed336(0x13c)][_0x3ed336(0xfb)]],_0xdb5c8f=[..._0x144f05['body'][_0x3ed336(0x141)]],_0x11b2e6=[..._0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1e2)]],_0x11c5ff=[..._0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1b8)]],_0x523571=[..._0x144f05[_0x3ed336(0x13c)][_0x3ed336(0xf4)]],_0x55a888=[..._0x144f05[_0x3ed336(0x13c)]['primary_code_hide']],_0x37f611=[..._0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1da)]];const _0x5f29f7=_0x4955b0[_0x3ed336(0x125)](_0x2a275d=>{return _0x2a275d={'product_name':_0x2a275d};});_0x1fc3e3[_0x3ed336(0x10c)]((_0x44061b,_0x440d22)=>{_0x5f29f7[_0x440d22]['purchase_quantity']=_0x44061b;}),_0xe83381['forEach']((_0x1792ca,_0xcc03bc)=>{var _0x4ff7ee=_0x3ed336;_0x5f29f7[_0xcc03bc][_0x4ff7ee(0xe8)]=_0x1792ca;}),_0x509cec[_0x3ed336(0x10c)]((_0x5746ed,_0x416fce)=>{var _0x1fa632=_0x3ed336;_0x5f29f7[_0x416fce][_0x1fa632(0x146)]=_0x5746ed;}),_0x1dfa60[_0x3ed336(0x10c)]((_0x3e7b85,_0x42245e)=>{var _0x5b0bff=_0x3ed336;_0x5f29f7[_0x42245e][_0x5b0bff(0x110)]=_0x3e7b85;}),_0xdb5c8f[_0x3ed336(0x10c)]((_0x44edfd,_0x463802)=>{var _0x1d51b0=_0x3ed336;_0x5f29f7[_0x463802][_0x1d51b0(0x126)]=_0x44edfd;}),_0x11b2e6['forEach']((_0xd1a0f3,_0x11b725)=>{var _0x21625e=_0x3ed336;_0x5f29f7[_0x11b725][_0x21625e(0x1cd)]=_0xd1a0f3;}),_0x11c5ff[_0x3ed336(0x10c)]((_0x4ae8c3,_0x288719)=>{var _0x5e23fb=_0x3ed336;_0x5f29f7[_0x288719][_0x5e23fb(0x10b)]=_0x4ae8c3;}),_0x523571['forEach']((_0xbe6adb,_0x51f5f5)=>{var _0x34c251=_0x3ed336;_0x5f29f7[_0x51f5f5][_0x34c251(0x1c8)]=_0xbe6adb;}),_0x55a888[_0x3ed336(0x10c)]((_0x52af28,_0x3f855a)=>{var _0x580b3f=_0x3ed336;_0x5f29f7[_0x3f855a][_0x580b3f(0x187)]=_0x52af28;}),_0x37f611['forEach']((_0x21bcc9,_0x34b8fa)=>{var _0x1a2fea=_0x3ed336;_0x5f29f7[_0x34b8fa][_0x1a2fea(0xe4)]=_0x21bcc9;}),_0x3f7cbb['product'][_0x3ed336(0x10c)](_0xad4e12=>{var _0x57c0b2=_0x3ed336;const _0xfe42cc=_0x2ad065[_0x57c0b2(0x1b7)][_0x57c0b2(0x125)](_0x2260dc=>{var _0x1b3437=_0x57c0b2;_0x2260dc[_0x1b3437(0xd2)]==_0xad4e12[_0x1b3437(0xd2)]&&_0x2260dc[_0x1b3437(0x1cd)]==_0xad4e12[_0x1b3437(0x1cd)]&&_0x2260dc[_0x1b3437(0x10b)]==_0xad4e12[_0x1b3437(0x10b)]&&_0x2260dc[_0x1b3437(0x126)]==_0xad4e12[_0x1b3437(0x126)]&&_0x2260dc[_0x1b3437(0x110)]==_0xad4e12['bay']&&_0x2260dc[_0x1b3437(0x16b)]==_0xad4e12[_0x1b3437(0x16b)]&&_0x2260dc['storage']==_0xad4e12[_0x1b3437(0x1ac)]&&(console[_0x1b3437(0x150)](parseInt(_0x2260dc[_0x1b3437(0x197)])+_0x1b3437(0xfd)+parseInt(_0xad4e12[_0x1b3437(0x100)])),_0x2260dc[_0x1b3437(0x197)]=parseInt(_0x2260dc[_0x1b3437(0x197)])+parseInt(_0xad4e12[_0x1b3437(0x100)]));});}),await _0x2ad065['save']();const _0x1c4605=_0x5f29f7['filter'](_0x2d55cc=>_0x2d55cc[_0x3ed336(0x146)]!=='0'&&_0x2d55cc[_0x3ed336(0x146)]!=='');var _0x46d2e8=0x0;_0x1c4605[_0x3ed336(0x10c)](_0x55fa00=>{var _0x4b34a2=_0x3ed336;console[_0x4b34a2(0x150)](_0x4b34a2(0xec),_0x55fa00),(parseInt(_0x55fa00[_0x4b34a2(0x19d)])<parseInt(_0x55fa00['return_qty'])||parseInt(_0x55fa00['stock_quantity'])<parseInt(_0x55fa00[_0x4b34a2(0x146)]))&&_0x46d2e8++;});if(_0x46d2e8!=0x0)return _0x144f05[_0x3ed336(0x112)]('errors',_0x3ed336(0x1cc)),_0x34b632['redirect'](_0x3ed336(0x1db));const _0x385cd0=new purchases_return({'invoice':_0x108fe2,'suppliers':_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1c0)],'date':_0x1716f8,'warehouse_name':_0x1c4cf2,'return_product':_0x1c4605,'note':_0x5f0c19,'room':_0x108918,'to_warehouse_name':_0x40a5d7,'to_room':_0x574c5b}),_0xa0c3c6=await _0x385cd0['save']();console['log'](_0x385cd0);const _0x4ae041=await purchases_return[_0x3ed336(0x162)]({'invoice':_0x108fe2}),_0x239e7e=await warehouse['findOne']({'name':_0x40a5d7,'room':_0x574c5b});_0x4ae041[_0x3ed336(0x107)][_0x3ed336(0x10c)](_0x521d1d=>{var _0x8fed8e=_0x3ed336,_0x7978e9=0x0;const _0x53ed8a=_0x239e7e[_0x8fed8e(0x1b7)][_0x8fed8e(0x125)](_0x17f8e5=>{var _0x3268fb=_0x8fed8e;_0x17f8e5[_0x3268fb(0xd2)]==_0x521d1d[_0x3268fb(0xd2)]&&_0x17f8e5[_0x3268fb(0x1cd)]==_0x521d1d['floorlevel']&&_0x17f8e5['type']==_0x521d1d[_0x3268fb(0x10b)]&&_0x17f8e5['bin']==_0x521d1d[_0x3268fb(0x126)]&&_0x17f8e5[_0x3268fb(0x110)]==_0x521d1d[_0x3268fb(0x110)]&&(_0x17f8e5[_0x3268fb(0x197)]=parseInt(_0x17f8e5[_0x3268fb(0x197)])-parseInt(_0x521d1d[_0x3268fb(0x146)]),_0x7978e9++);});_0x7978e9=='0'&&(_0x239e7e[_0x8fed8e(0x1b7)]=_0x239e7e[_0x8fed8e(0x1b7)][_0x8fed8e(0x108)]({'product_name':_0x521d1d[_0x8fed8e(0xd2)],'product_stock':_0x521d1d[_0x8fed8e(0x146)],'primary_code':_0x521d1d[_0x8fed8e(0x187)],'secondary_code':_0x521d1d[_0x8fed8e(0xe4)],'product_code':_0x521d1d[_0x8fed8e(0x1c8)],'storage':_0x521d1d[_0x8fed8e(0x1ac)],'rack':_0x521d1d[_0x8fed8e(0x16b)],'bay':_0x521d1d[_0x8fed8e(0x110)],'bin':_0x521d1d[_0x8fed8e(0x126)],'type':_0x521d1d[_0x8fed8e(0x10b)],'floorlevel':_0x521d1d[_0x8fed8e(0x1cd)],'maxProducts':_0x521d1d[_0x8fed8e(0x1ba)],'unit':_0x521d1d[_0x8fed8e(0x1b5)],'secondary_unit':_0x521d1d[_0x8fed8e(0x1a1)],'expiry_date':_0x521d1d[_0x8fed8e(0x1c1)]}));}),await _0x239e7e[_0x3ed336(0xe5)]();const _0x17236e=await purchases['findOne']({'invoice':_0x108fe2});_0x17236e[_0x3ed336(0x167)]=_0x3ed336(0x1cf);const _0x2a0d0f=await _0x17236e['save'](),_0x3f746e=new s_payment_data({'invoice':_0x108fe2,'suppliers':_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1c0)],'reason':'Purchase\x20Return'});await _0x3f746e[_0x3ed336(0xe5)]();const _0x52abed=await master_shop['find']();console['log'](_0x3ed336(0x15f),_0x52abed[0x0][_0x3ed336(0xeb)]);const _0x13ae1d=await email_settings[_0x3ed336(0x162)](),_0x3c0d00=await suppliers[_0x3ed336(0x162)]({'name':_0x144f05[_0x3ed336(0x13c)][_0x3ed336(0x1c0)]});console['log'](_0x3ed336(0x128),_0x3c0d00);_0x52abed[0x0]['currency_placement']==0x1?(right_currency=_0x52abed[0x0][_0x3ed336(0x1ec)],left_currency=''):(right_currency='',left_currency=_0x52abed[0x0][_0x3ed336(0x1ec)]);var _0x3d021c=_0x4955b0,_0x43b961=_0x509cec,_0x5c9b96='',_0x192634;for(_0x192634 in _0x3d021c){_0x5c9b96+=_0x3ed336(0x11d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d021c[_0x192634]+_0x3ed336(0x192)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x43b961[_0x192634]+_0x3ed336(0x192)+_0x3ed336(0x15b);}console[_0x3ed336(0x150)](_0x3ed336(0x11a),_0x5c9b96);let _0x4aa580=nodemailer[_0x3ed336(0x111)]({'service':_0x3ed336(0x1ed),'auth':{'user':_0x13ae1d['email'],'pass':_0x13ae1d['password']}}),_0x4a6cb9={'from':_0x13ae1d[_0x3ed336(0x1e6)],'to':_0x3c0d00[_0x3ed336(0x1e6)],'subject':_0x3ed336(0x14a),'attachments':[{'filename':_0x3ed336(0x199),'path':__dirname+_0x3ed336(0x164)+_0x3ed336(0x1b6)+_0x52abed[0x0][_0x3ed336(0xeb)],'cid':_0x3ed336(0x11b)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x3ed336(0x1e8)+'<div>'+_0x3ed336(0x193)+'<div>'+_0x3ed336(0x1af)+'</div>'+_0x3ed336(0x188)+_0x3ed336(0x1b3)+_0x52abed[0x0]['site_title']+_0x3ed336(0x183)+_0x3ed336(0x1d3)+_0x3ed336(0x1d3)+_0x3ed336(0xe2)+_0x3ed336(0x188)+_0x3ed336(0xd3)+_0x3ed336(0x178)+_0x108fe2+'\x20'+_0x3ed336(0x1bd)+_0x3ed336(0xef)+_0x1716f8+'\x20'+_0x3ed336(0xd4)+_0x3ed336(0x176)+_0x3ed336(0x1d3)+_0x3ed336(0x120)+_0x3ed336(0x1bb)+_0x3ed336(0x11d)+_0x3ed336(0x102)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3ed336(0x16a)+_0x3ed336(0x129)+_0x3ed336(0x15b)+'</thead>'+_0x3ed336(0x152)+'\x20'+_0x5c9b96+'\x20'+_0x3ed336(0x182)+_0x3ed336(0x13d)+_0x3ed336(0x188)+'<strong>\x20Regards\x20</strong>'+_0x3ed336(0x1d7)+_0x52abed[0x0][_0x3ed336(0xda)]+_0x3ed336(0x176)+_0x3ed336(0x1d3)+'</div>'+'</body></html>'};_0x4aa580[_0x3ed336(0xea)](_0x4a6cb9,function(_0x1f1f22,_0x137550){var _0x276742=_0x3ed336;_0x1f1f22?(console['log'](_0x1f1f22),console[_0x276742(0x150)](_0x276742(0x19c))):console[_0x276742(0x150)](_0x276742(0x165));}),_0x144f05[_0x3ed336(0x112)]('success',_0x3ed336(0x132)),_0x34b632['redirect'](_0x3ed336(0xd7));}catch(_0x59f03c){console['log'](_0x59f03c),_0x34b632['status'](0xc8)[_0x3ed336(0x169)]({'message':_0x59f03c[_0x3ed336(0x175)]});}}),router['get'](a0_0x1a7251(0x117),auth,async(_0x2dd18c,_0xa3b526)=>{var _0x21e7cd=a0_0x1a7251;try{const {username:_0x1c78c8,email:_0x2d015b,role:_0x316180}=_0x2dd18c[_0x21e7cd(0x16d)],_0x4cec28=_0x2dd18c[_0x21e7cd(0x16d)],_0x410a87=await profile[_0x21e7cd(0x162)]({'email':_0x4cec28['email']}),_0x1831a4=await master_shop[_0x21e7cd(0x134)](),_0x33bb74=_0x2dd18c[_0x21e7cd(0x17e)]['id'],_0x718b56=await purchases[_0x21e7cd(0xf0)](_0x33bb74);if(_0x1831a4[0x0][_0x21e7cd(0x16c)]=='English\x20(US)')var _0x42b54e=users['English'];else{if(_0x1831a4[0x0][_0x21e7cd(0x16c)]==_0x21e7cd(0x1a0))var _0x42b54e=users[_0x21e7cd(0x1a0)];else{if(_0x1831a4[0x0]['language']==_0x21e7cd(0x1a8))var _0x42b54e=users[_0x21e7cd(0x1a8)];else{if(_0x1831a4[0x0][_0x21e7cd(0x16c)]==_0x21e7cd(0xe1))var _0x42b54e=users[_0x21e7cd(0xe1)];else{if(_0x1831a4[0x0][_0x21e7cd(0x16c)]==_0x21e7cd(0x135))var _0x42b54e=users[_0x21e7cd(0x135)];else{if(_0x1831a4[0x0][_0x21e7cd(0x16c)]==_0x21e7cd(0x114))var _0x42b54e=users[_0x21e7cd(0x1d9)];else{if(_0x1831a4[0x0][_0x21e7cd(0x16c)]=='Chinese')var _0x42b54e=users[_0x21e7cd(0x198)];else{if(_0x1831a4[0x0][_0x21e7cd(0x16c)]=='Arabic\x20(ae)')var _0x42b54e=users['Arabic'];}}}}}}}_0xa3b526[_0x21e7cd(0x1a4)](_0x21e7cd(0x13e),{'success':_0x2dd18c[_0x21e7cd(0x112)](_0x21e7cd(0x1aa)),'errors':_0x2dd18c[_0x21e7cd(0x112)](_0x21e7cd(0x161)),'role':_0x4cec28,'profile':_0x410a87,'alldata':_0x718b56,'master_shop':_0x1831a4,'language':_0x42b54e}),console[_0x21e7cd(0x150)](alldata);}catch(_0x56e1d1){console['log'](_0x56e1d1);}}),router[a0_0x1a7251(0xd1)](a0_0x1a7251(0x1a2),async(_0x1ab3c4,_0x36e05a)=>{var _0x277c71=a0_0x1a7251;const {product_code:_0x521c52}=_0x1ab3c4[_0x277c71(0x13c)];var _0x3e3342;const _0x1bacdd=await product[_0x277c71(0xde)]([{'$match':{'primary_code':_0x521c52,'product_category':_0x277c71(0x149)}},{'$group':{'_id':_0x277c71(0x158),'name':{'$first':_0x277c71(0x1f0)},'category':{'$first':_0x277c71(0x170)},'brand':{'$first':_0x277c71(0x10a)},'unit':{'$first':_0x277c71(0x11f)},'alertquantity':{'$first':_0x277c71(0x1dc)},'product_code':{'$first':_0x277c71(0x1ea)},'primary_code':{'$first':_0x277c71(0xfc)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x277c71(0x11e)},'maxProdPerUnit':{'$first':_0x277c71(0x10d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x277c71(0x191)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x136611=await product[_0x277c71(0xde)]([{'$match':{'secondary_code':_0x521c52,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x277c71(0x158),'name':{'$first':_0x277c71(0x1f0)},'category':{'$first':_0x277c71(0x170)},'brand':{'$first':_0x277c71(0x10a)},'unit':{'$first':_0x277c71(0x11f)},'alertquantity':{'$first':_0x277c71(0x1dc)},'product_code':{'$first':_0x277c71(0x1ea)},'primary_code':{'$first':_0x277c71(0xfc)},'secondary_code':{'$first':_0x277c71(0x116)},'maxStocks':{'$first':_0x277c71(0x11e)},'maxProdPerUnit':{'$first':_0x277c71(0x10d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1bacdd[_0x277c71(0x106)]>0x0)_0x3e3342=_0x1bacdd;else _0x136611[_0x277c71(0x106)]>0x0&&(_0x3e3342=_0x136611);_0x36e05a[_0x277c71(0x169)](_0x3e3342);}),router[a0_0x1a7251(0xd1)](a0_0x1a7251(0xe9),async(_0x2bba0d,_0x12de4d)=>{var _0x5a41e8=a0_0x1a7251;const {primaryCode:_0x494e2e,secondaryCode:_0x35074f,productCode:_0x27b5e9,bay:_0x2f9a2a,bin:_0x47def4,types:_0x316ffa,pallet:_0x5c2cee,warehouses:_0x62f132,room:_0x544b8a}=_0x2bba0d['body'];console['log'](_0x2bba0d[_0x5a41e8(0x13c)]);try{const _0x38b325=await warehouse[_0x5a41e8(0xde)]([{'$match':{'name':_0x62f132,'room':_0x544b8a}},{'$unwind':_0x5a41e8(0x14d)},{'$match':{'product_details.bay':_0x2f9a2a,'product_details.bin':_0x47def4,'product_details.type':_0x316ffa}},{'$group':{'_id':_0x5a41e8(0x127),'name':{'$first':_0x5a41e8(0xee)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x5a41e8(0xf2)},'isle':{'$first':_0x5a41e8(0x18d)},'pallet':{'$first':_0x5a41e8(0x10e)},'maxProducts':{'$first':_0x5a41e8(0x1ae)}}}]);_0x12de4d[_0x5a41e8(0x1a9)](0xc8)[_0x5a41e8(0x169)](_0x38b325);}catch(_0x1ea36b){_0x12de4d['status'](0x194)[_0x5a41e8(0x169)]({'message':_0x1ea36b['message']});}}),module['exports']=router;