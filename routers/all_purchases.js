var a0_0x4eccf9=a0_0x4a0c;function a0_0x4a0c(_0x475fb3,_0xfb0a1f){var _0x2729bb=a0_0x2729();return a0_0x4a0c=function(_0x4a0c80,_0x1ae5d3){_0x4a0c80=_0x4a0c80-0x161;var _0x3137aa=_0x2729bb[_0x4a0c80];return _0x3137aa;},a0_0x4a0c(_0x475fb3,_0xfb0a1f);}function a0_0x2729(){var _0x16d41b=['English\x20(US)','edit_purchases','$product_details.secondary_code','Enclosed','</head><body>','/view/:id','product','pallet','return_purchase','$product_details.storage','Rack\x20B','1434662Xiyyul','<table\x20style=\x22width:\x20100%\x20!important;\x22>','port','$product_details.bay','user','all','/../public','suppliers','Sales\x20Update\x20successfully','purchases\x20item\x20return\x20successfull','due_amount','</h5>','quantity','product_list','add\x20post','$secondary_unit','Portuguese','Purchase\x20Return\x20Mail','/all_purchases/view','/view/add_purchases','exports','2402448BkQfpK','post','<html><head><title></title>','MaxStocks_data','paid_amount','rak','Rack\x20D','prod_qty','prod_cat','4976802LqVsKc','$product.bay','True','$product.bin','Ambient','/barcode/:id','ejs','</td>','<div>','<strong>\x20Regards\x20</strong>','delivery_code','$return_data','Spanish','standard_unit','$name','</span>','product_code_hide','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_isle','get','rack','$invoice','Enabled','$finalize','prod_Qty','stocks','Rack\x20E','getDate','edit_purchases_view','German','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','maxperunit','level','gmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</thead>','find','<hr\x20class=\x22my-3\x22>','foreach\x20newproduct','/upload/','</tr>','random','<tr>','prod_secondunit','suppliers_docs','\x20Order\x20Date\x20:\x20','log','path','8065825fHuJCE','JO_number','flash','length','\x20</h2>','sendMail','then','Email\x20sent\x20successfully','product_code','<!DOCTYPE\x20html>','Error\x20Occurs','return_product','language','product_stock','success','</table>','production_date','all_purchases','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','concat','Raw\x20Materials','all_purchases_barcode','map','floorlevel','password','<h5>','type','purchase_quantity','$product.type','name','product_details','Return\x20Goods','English','expiry_date','Arabic','Logo.png','$product_code','$due_amount','bay','role','render','findOne','$product_details','$suppliers','$product.floorlevel','Shelves','deliverycode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Arabic\x20(ae)','warehouse','amount','DRY\x20STORAGE','params','$suppliers_docs','</body></html>','$warehouse_name','Floor','$maxProdPerUnit','Rack\x20A','$product_details._id','Hindi','add_purchases','Level','secondary_unit','Paid\x20For\x20Purchase','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','json','getMonth','purchase\x20data\x20update\x20successfully','createTransport','$product_details.type','body','$expiry_date','alertQTY','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','add_purchases\x20error','catch','$maxStocks','$product_details.level','$secondary_code','email','return_data','$unit','</div>','warehouse_name','3984408ESiYBH','return_qty','/invoice/:id','room_name','$paid_amount','$product_details.isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','French','prod_code','<h5\x20style=\x22text-align:\x20left;\x22>','prod_primunit','message','$note','suppliers_data','Rack\x20C','$product_details.product_stock','$primary_code','site_title','225358BfpoTT','max_product_unit','toString','actual_qty','batch_code','product_cat','nodemailer','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','35cuhdoW','invoice','$brand','date','RoomAssign','aggregate','$product','$product_details.expiry_date','INC-','prod_level','padStart','Chinese','primary_code_hide','filter','stock_quantity','prod_pallet','Rack\x20F','image','<span\x20style=\x22float:\x20right;\x22>','delivery_date','secondary_code_hide','errors','An\x20error\x20occurred.','$product_details.rack','forEach','/view/return_purchase/:id','storage','currency','bin','staff','\x20<>\x20','../models/all_models','room','Purchase\x20Mail','../public/language/languages.json','isle','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','string','$product_details.floorlevel','status','master','redirect','abs','primary_code','Portuguese\x20(BR)','maxStocks','$product_details.product_code','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','product_name','/CheckingWarehouse','note','1984902BbIOWY','COLD\x20STORAGE','\x20Order\x20Number\x20:\x20','prod_name','$product_details.primary_code','Receiving\x20Area','$batch_code','finalize','$product.quantity','secondary_code','/all_purchases/view/','actual_uom','error','floor','purchase_invoice','<h2>\x20','$room','findById','logo','save','table\x20page','types'];a0_0x2729=function(){return _0x16d41b;};return a0_0x2729();}(function(_0x323139,_0xa0ad7c){var _0x2cf474=a0_0x4a0c,_0x3ac156=_0x323139();while(!![]){try{var _0x1d2369=-parseInt(_0x2cf474(0x238))/0x1+-parseInt(_0x2cf474(0x1d9))/0x2+parseInt(_0x2cf474(0x256))/0x3+parseInt(_0x2cf474(0x1c5))/0x4+-parseInt(_0x2cf474(0x16f))/0x5+-parseInt(_0x2cf474(0x217))/0x6*(-parseInt(_0x2cf474(0x1e2))/0x7)+-parseInt(_0x2cf474(0x24d))/0x8;if(_0x1d2369===_0xa0ad7c)break;else _0x3ac156['push'](_0x3ac156['shift']());}catch(_0x297bac){_0x3ac156['push'](_0x3ac156['shift']());}}}(a0_0x2729,0xcf1b5));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x4eccf9(0x201)),auth=require('../middleware/auth'),nodemailer=require(a0_0x4eccf9(0x1df));var ejs=require(a0_0x4eccf9(0x25c));const path=require(a0_0x4eccf9(0x16e)),users=require(a0_0x4eccf9(0x204));router[a0_0x4eccf9(0x269)]('/view',auth,async(_0x48672c,_0x1ede7d)=>{var _0x155e66=a0_0x4eccf9;try{const {username:_0x1c2cbc,email:_0x58bd9d,role:_0x2e6456}=_0x48672c[_0x155e66(0x23c)],_0x5a528f=_0x48672c['user'],_0x39adb4=await profile[_0x155e66(0x199)]({'email':_0x5a528f['email']}),_0xc24053=await staff['findOne']({'email':_0x5a528f[_0x155e66(0x1c0)]});if(_0x5a528f[_0x155e66(0x197)]==_0x155e66(0x1ff)){const _0x3a1ea3=await staff['findOne']({'email':_0x5a528f[_0x155e66(0x1c0)]});}const _0x3f166b=await master_shop[_0x155e66(0x163)]();let _0x1d20b2;if(_0x5a528f[_0x155e66(0x197)]==_0x155e66(0x1ff)){const _0x2823ef=await staff[_0x155e66(0x199)]({'email':_0x5a528f[_0x155e66(0x1c0)]});_0x1d20b2=await purchases[_0x155e66(0x1e7)]([{'$match':{'warehouse_name':_0x2823ef[_0x155e66(0x1a1)]}},{'$lookup':{'from':_0x155e66(0x23f),'localField':_0x155e66(0x23f),'foreignField':_0x155e66(0x18d),'as':'suppliers_docs'}},{'$unwind':_0x155e66(0x1a5)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x155e66(0x1a7)},'room':{'$first':_0x155e66(0x227)},'product':{'$push':_0x155e66(0x1e8)},'note':{'$first':_0x155e66(0x1d3)},'paid_amount':{'$first':_0x155e66(0x1c9)},'due_amount':{'$first':_0x155e66(0x195)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x155e66(0x21d)},'expiry_date':{'$first':_0x155e66(0x1b8)},'suppliers_docs':{'$first':_0x155e66(0x1a5)},'total_product_quantity':{'$sum':_0x155e66(0x21f)},'level':{'$addToSet':_0x155e66(0x257)},'isle':{'$addToSet':_0x155e66(0x259)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x155e66(0x19c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1d20b2=await purchases[_0x155e66(0x1e7)]([{'$lookup':{'from':_0x155e66(0x23f),'localField':_0x155e66(0x23f),'foreignField':_0x155e66(0x18d),'as':_0x155e66(0x16b)}},{'$unwind':_0x155e66(0x1a5)},{'$unwind':_0x155e66(0x1e8)},{'$group':{'_id':'$_id','invoice':{'$first':_0x155e66(0x26b)},'suppliers':{'$first':_0x155e66(0x19b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x155e66(0x1a7)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x155e66(0x1e8)},'note':{'$first':_0x155e66(0x1d3)},'paid_amount':{'$first':_0x155e66(0x1c9)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x155e66(0x261)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x155e66(0x1b8)},'suppliers_docs':{'$first':_0x155e66(0x1a5)},'total_product_quantity':{'$sum':_0x155e66(0x21f)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x155e66(0x18c)},'floorlevel':{'$addToSet':_0x155e66(0x19c)},'finalize':{'$first':_0x155e66(0x26d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x3f166b[0x0][_0x155e66(0x17b)]=='English\x20(US)'){var _0x4e72e8=users[_0x155e66(0x190)];console[_0x155e66(0x16d)](_0x4e72e8);}else{if(_0x3f166b[0x0][_0x155e66(0x17b)]==_0x155e66(0x1ac))var _0x4e72e8=users[_0x155e66(0x1ac)];else{if(_0x3f166b[0x0][_0x155e66(0x17b)]==_0x155e66(0x273))var _0x4e72e8=users['German'];else{if(_0x3f166b[0x0][_0x155e66(0x17b)]==_0x155e66(0x262))var _0x4e72e8=users[_0x155e66(0x262)];else{if(_0x3f166b[0x0][_0x155e66(0x17b)]==_0x155e66(0x1ce))var _0x4e72e8=users[_0x155e66(0x1ce)];else{if(_0x3f166b[0x0][_0x155e66(0x17b)]==_0x155e66(0x20e))var _0x4e72e8=users[_0x155e66(0x248)];else{if(_0x3f166b[0x0][_0x155e66(0x17b)]==_0x155e66(0x1ed))var _0x4e72e8=users[_0x155e66(0x1ed)];else{if(_0x3f166b[0x0][_0x155e66(0x17b)]=='Arabic\x20(ae)')var _0x4e72e8=users[_0x155e66(0x192)];}}}}}}}_0x1ede7d[_0x155e66(0x198)](_0x155e66(0x180),{'success':_0x48672c[_0x155e66(0x171)](_0x155e66(0x17d)),'errors':_0x48672c[_0x155e66(0x171)]('errors'),'purchases':_0x1d20b2,'role':_0x5a528f,'profile':_0x39adb4,'master_shop':_0x3f166b,'language':_0x4e72e8});}catch(_0x46b33e){console['log'](_0x155e66(0x22b),_0x46b33e),_0x1ede7d[_0x155e66(0x209)](0xc8)[_0x155e66(0x1b2)]({'message':_0x46b33e[_0x155e66(0x1d2)]});}});function BayBinSelected(_0x4258df,_0xd47d96){var _0x596655=a0_0x4eccf9,_0x585846=[],_0x371370=[],_0x24c27e=[],_0x1a26ce=[],_0x5a22cf=[],_0x11fb37=[];let _0x493b27=[];if(_0x4258df==_0x596655(0x1a3))switch(_0xd47d96){case'Rack\x20A':_0x585846=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x371370=[0x1,0x2],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1ae),_0x596655(0x1a8)],_0x5a22cf=['D'],_0x11fb37=['A'];break;case'Rack\x20B':_0x585846=[0x6,0x5,0x4,0x3,0x2,0x1],_0x371370=[0x1,0x2],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1ae),_0x596655(0x1a8)],_0x5a22cf=['D'],_0x11fb37=['B'];break;case _0x596655(0x19d):_0x585846=[0x0],_0x371370=[0x0],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1a8)],_0x5a22cf=['D'],_0x11fb37=['S'];break;case _0x596655(0x21c):_0x585846=[0x0],_0x371370=[0x0],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x24c27e=[_0x596655(0x1a8)],_0x5a22cf=['D'],_0x11fb37=['R'];break;}else{if(_0x4258df==_0x596655(0x218))switch(_0xd47d96){case _0x596655(0x1aa):_0x585846=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x371370=['B','F'],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1ae),'Floor'],_0x5a22cf=['C'],_0x11fb37=['A'];break;case _0x596655(0x237):_0x585846=[0x5,0x4,0x3,0x2,0x1],_0x371370=['F','B','S'],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1ae),_0x596655(0x1a8)],_0x5a22cf=['C'],_0x11fb37=['B'];break;case _0x596655(0x1d5):_0x585846=[0x1,0x2,0x3,0x4,0x5],_0x371370=['B','F','S'],_0x1a26ce=[0x5,0x4,0x3,0x2,0x1],_0x24c27e=[_0x596655(0x1ae),_0x596655(0x1a8)],_0x5a22cf=['C'],_0x11fb37=['C'];break;case _0x596655(0x253):_0x585846=[0x5,0x4,0x3,0x2,0x1],_0x371370=['F','B','S'],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=['Level',_0x596655(0x1a8)],_0x5a22cf=['C'],_0x11fb37=['D'];break;case _0x596655(0x270):_0x585846=[0x4,0x3,0x2,0x1],_0x371370=[0x1,0x2],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1ae),'Floor'],_0x5a22cf=['C'],_0x11fb37=['E'];break;case _0x596655(0x1f2):_0x585846=[0x1,0x2,0x3],_0x371370=[0x1,0x2],_0x1a26ce=[0x1,0x2,0x3,0x4,0x5],_0x24c27e=[_0x596655(0x1ae)],_0x5a22cf=['C'],_0x11fb37=['F'];break;}}return{'levels':_0x585846,'Isle':_0x371370,'rack':_0x1a26ce,'type':_0x24c27e,'storage':_0x5a22cf,'rak':_0x11fb37};}async function getRandom8DigitNumber(){var _0x3b16f7=a0_0x4eccf9;const _0x48e0ee=0x989680,_0xb49634=0x5f5e0ff,_0x496107=Math[_0x3b16f7(0x224)](Math[_0x3b16f7(0x168)]()*(_0xb49634-_0x48e0ee+0x1))+_0x48e0ee;var _0x3d6def;const _0x5adbe4=await purchases[_0x3b16f7(0x199)]({'invoice':_0x3b16f7(0x1ea)+_0x496107});return _0x5adbe4&&_0x5adbe4[_0x3b16f7(0x172)]>0x0?_0x3d6def='INC-'+_0x496107:_0x3d6def=_0x3b16f7(0x1ea)+_0x496107,_0x3d6def;}router[a0_0x4eccf9(0x269)](a0_0x4eccf9(0x24b),auth,async(_0x2f972f,_0x394f85)=>{var _0x57ff41=a0_0x4eccf9;try{const {username:_0x186af1,email:_0x475cd2,role:_0x1fe301}=_0x2f972f['user'],_0x1eb7df=_0x2f972f[_0x57ff41(0x23c)],_0x3adbcc=await profile[_0x57ff41(0x199)]({'email':_0x1eb7df[_0x57ff41(0x1c0)]}),_0x10214d=await master_shop[_0x57ff41(0x163)](),_0x47aa0b=await staff[_0x57ff41(0x199)]({'email':_0x1eb7df[_0x57ff41(0x1c0)]}),_0x34a543=await suppliers[_0x57ff41(0x163)]({});let _0x36153a;if(_0x1eb7df[_0x57ff41(0x197)]=='staff'){const _0x15c4eb=await staff[_0x57ff41(0x199)]({'email':_0x1eb7df[_0x57ff41(0x1c0)]});_0x36153a=await warehouse[_0x57ff41(0x1e7)]([{'$match':{'status':'Enabled','name':_0x15c4eb[_0x57ff41(0x1a1)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x57ff41(0x264)}}}]);}else _0x36153a=await warehouse[_0x57ff41(0x1e7)]([{'$match':{'status':'Enabled','warehouse_category':_0x57ff41(0x184),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x57ff41(0x264)}}}]);const _0x1b62fd=await product[_0x57ff41(0x163)]({}),_0x134809=await warehouse[_0x57ff41(0x163)]({'status':_0x57ff41(0x26c)}),_0x1d56d1=await purchases[_0x57ff41(0x163)]({}),_0x39d9a4=_0x1d56d1[_0x57ff41(0x172)]+0x1,_0x411ec9=_0x57ff41(0x1ea)+_0x39d9a4[_0x57ff41(0x1db)]()[_0x57ff41(0x1ec)](0x5,'0');var _0x173651=[_0x57ff41(0x25a),_0x57ff41(0x230)];if(_0x10214d[0x0][_0x57ff41(0x17b)]==_0x57ff41(0x22d))var _0x210cee=users[_0x57ff41(0x190)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]==_0x57ff41(0x1ac))var _0x210cee=users[_0x57ff41(0x1ac)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]==_0x57ff41(0x273))var _0x210cee=users[_0x57ff41(0x273)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]==_0x57ff41(0x262))var _0x210cee=users[_0x57ff41(0x262)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]=='French')var _0x210cee=users[_0x57ff41(0x1ce)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]=='Portuguese\x20(BR)')var _0x210cee=users[_0x57ff41(0x248)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]=='Chinese')var _0x210cee=users[_0x57ff41(0x1ed)];else{if(_0x10214d[0x0][_0x57ff41(0x17b)]==_0x57ff41(0x1a0))var _0x210cee=users['Arabic'];}}}}}}}const _0xa4ce9a=getRandom8DigitNumber();_0xa4ce9a[_0x57ff41(0x175)](_0x49114f=>{var _0x2fd75c=_0x57ff41;_0x394f85[_0x2fd75c(0x198)](_0x2fd75c(0x1ad),{'success':_0x2f972f[_0x2fd75c(0x171)]('success'),'errors':_0x2f972f[_0x2fd75c(0x171)]('errors'),'role':_0x1eb7df,'profile':_0x3adbcc,'suppliers':_0x34a543,'warehouse':_0x36153a,'product':_0x1b62fd,'invoice':_0x49114f,'master_shop':_0x10214d,'language':_0x210cee,'find_data':_0x134809,'rooms_data':_0x173651});})['catch'](_0x43137d=>{var _0x410713=_0x57ff41;_0x2f972f[_0x410713(0x171)](_0x410713(0x1f7),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x394f85[_0x410713(0x20b)]('/all_purchases/view');});}catch(_0x2f1450){console['log'](_0x2f1450);}}),router[a0_0x4eccf9(0x269)]('/view/add_purchases/:id',auth,async(_0x467778,_0x4a092b)=>{var _0x36d725=a0_0x4eccf9;try{const _0x43c734=_0x467778[_0x36d725(0x1a4)]['id'];console[_0x36d725(0x16d)](_0x43c734);const _0x20397d=await master_shop[_0x36d725(0x163)]();console[_0x36d725(0x16d)](_0x36d725(0x20a),_0x20397d);const _0x2938df=await product[_0x36d725(0x199)]({'name':_0x43c734});console['log']('product',_0x2938df),_0x4a092b[_0x36d725(0x209)](0xc8)[_0x36d725(0x1b2)]({'product_data':_0x2938df,'master':_0x20397d});}catch(_0x4bf7a0){console[_0x36d725(0x16d)](_0x36d725(0x1bb),_0x4bf7a0);}}),router[a0_0x4eccf9(0x24e)](a0_0x4eccf9(0x24b),auth,async(_0x4b45b9,_0x1b1e60)=>{var _0x25058c=a0_0x4eccf9;try{const {invoice:_0x397c3b,date:_0x1675e8,warehouse_name:_0x4708ea,prod_name:_0x1d3870,prod_code:_0x3298e1,prod_qty:_0x9807e0,prod_unit:_0x3d2f50,prod_secondunit:_0x3d9bcb,prod_level:_0x2d7a6e,prod_isle:_0x47d137,prod_pallet:_0x229816,note:_0x38a84b,expiry_date:_0x2d9554,batch_code:_0x1a3a80,payable:_0x54d98d,due_amount:_0x4893ed,Room_name:_0x157825,primary_code:_0x6ff13e,secondary_code:_0x5e48e6,MaxStocks_data:_0x3a5c7f,PO_number:_0x348d61,SCRN:_0x12e0b6,JO_number:_0x4694fd}=_0x4b45b9['body'];if(typeof _0x1d3870=='string')var _0x5f57b4=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x21a)]],_0x5061bd=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1cf)]],_0x2b749a=[_0x4b45b9['body']['prod_Qty']],_0x29b106=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1d1)]],_0x461527=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x16a)]],_0x9d0d03=[_0x4b45b9[_0x25058c(0x1b7)]['prod_level']],_0x4be89a=[_0x4b45b9['body'][_0x25058c(0x20d)]],_0x3aa8e1=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x220)]],_0x3cbffa=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x250)]],_0x595287=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1dd)]],_0x554b40=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x191)]],_0x3bb01d=[_0x4b45b9['body'][_0x25058c(0x1da)]],_0x8ec994=[_0x4b45b9['body'][_0x25058c(0x1b9)]],_0x26c56b=[_0x4b45b9[_0x25058c(0x1b7)]['production_date']],_0x3a9d26=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x255)]],_0x2c6bed=[_0x4b45b9['body'][_0x25058c(0x1e6)]],_0x2add17=[_0x4b45b9[_0x25058c(0x1b7)]['deliverycode']],_0x11640e=[_0x4b45b9['body'][_0x25058c(0x181)]],_0xb73428=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1dc)]],_0x1c7245=[_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x222)]];else var _0x5f57b4=[..._0x4b45b9['body'][_0x25058c(0x21a)]],_0x5061bd=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1cf)]],_0x2b749a=[..._0x4b45b9['body'][_0x25058c(0x26e)]],_0x29b106=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1d1)]],_0x461527=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x16a)]],_0x9d0d03=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1eb)]],_0x4be89a=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x20d)]],_0x3aa8e1=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x220)]],_0x3cbffa=[..._0x4b45b9['body'][_0x25058c(0x250)]],_0x595287=[..._0x4b45b9[_0x25058c(0x1b7)]['batch_code']],_0x554b40=[..._0x4b45b9[_0x25058c(0x1b7)]['expiry_date']],_0x3bb01d=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1da)]],_0x8ec994=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1b9)]],_0x26c56b=[..._0x4b45b9['body'][_0x25058c(0x17f)]],_0x3a9d26=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x255)]],_0x2c6bed=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x1e6)]],_0x2add17=[..._0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x19e)]],_0x11640e=[..._0x4b45b9[_0x25058c(0x1b7)]['prod_invoice']],_0xb73428=[..._0x4b45b9['body'][_0x25058c(0x1dc)]],_0x1c7245=[..._0x4b45b9['body'][_0x25058c(0x222)]];const _0x10b2ba=_0x5f57b4[_0x25058c(0x186)](_0x3b62a6=>{return _0x3b62a6={'product_name':_0x3b62a6};});_0xb73428[_0x25058c(0x1fa)]((_0x37d99f,_0x3e4fcf)=>{var _0x503c5f=_0x25058c;_0x10b2ba[_0x3e4fcf]['actual_qty']=Math[_0x503c5f(0x20c)](_0x37d99f);}),_0x1c7245[_0x25058c(0x1fa)]((_0x40600f,_0xcbce0)=>{var _0x2b347e=_0x25058c;_0x10b2ba[_0xcbce0][_0x2b347e(0x222)]=_0x40600f;}),_0x5061bd[_0x25058c(0x1fa)]((_0x5ef57e,_0x160645)=>{var _0x160f4d=_0x25058c;_0x10b2ba[_0x160645][_0x160f4d(0x177)]=_0x5ef57e;}),_0x2b749a['forEach']((_0x340e53,_0x5d8667)=>{var _0x4222b5=_0x25058c;_0x10b2ba[_0x5d8667][_0x4222b5(0x244)]=Math[_0x4222b5(0x20c)](_0x340e53);}),_0x29b106[_0x25058c(0x1fa)]((_0x23fd38,_0x197f0e)=>{var _0x30b179=_0x25058c;_0x10b2ba[_0x197f0e][_0x30b179(0x263)]=_0x23fd38;}),_0x461527['forEach']((_0x34b7e0,_0x16d7ce)=>{var _0x13ca3d=_0x25058c;_0x10b2ba[_0x16d7ce][_0x13ca3d(0x1af)]=_0x34b7e0;}),_0x9d0d03[_0x25058c(0x1fa)]((_0x522bb5,_0x3c7dfe)=>{var _0x149ff9=_0x25058c;_0x2c6bed[_0x149ff9(0x1fa)]((_0x305b4c,_0x1f706a)=>{var _0x5eed79=_0x149ff9;if(_0x305b4c==_0x5eed79(0x21c)&&_0x3c7dfe==_0x1f706a){console[_0x5eed79(0x16d)](_0x305b4c+'\x20<\x20wew\x20>\x20'+_0x3c7dfe+_0x5eed79(0x200)+_0x1f706a+_0x5eed79(0x200)+_0x522bb5);var _0x223a35=_0x522bb5['slice'](0x3);_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fc)]=_0x522bb5[0x0],_0x10b2ba[_0x3c7dfe]['rack']=_0x522bb5[0x1],_0x10b2ba[_0x3c7dfe]['bay']=0x0,_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fe)]=0x0,_0x10b2ba[_0x3c7dfe][_0x5eed79(0x18a)]=_0x5eed79(0x1a8),_0x10b2ba[_0x3c7dfe]['floorlevel']=_0x223a35;}else{if(_0x305b4c==_0x5eed79(0x19d)&&_0x3c7dfe==_0x1f706a){var _0x223a35=_0x522bb5[_0x5eed79(0x274)](0x3);_0x10b2ba[_0x3c7dfe]['storage']=_0x522bb5[0x0],_0x10b2ba[_0x3c7dfe]['rack']=_0x522bb5[0x1],_0x10b2ba[_0x3c7dfe][_0x5eed79(0x196)]=0x0,_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fe)]=0x0,_0x10b2ba[_0x3c7dfe][_0x5eed79(0x18a)]=_0x5eed79(0x1a8),_0x10b2ba[_0x3c7dfe][_0x5eed79(0x187)]=_0x522bb5[0x5];}else{if(_0x3c7dfe==_0x1f706a){if(_0x522bb5[0x0]=='A'&&_0x522bb5[0x1]=='L'&&_0x522bb5[0x2]=='L')console['log'](_0x305b4c+'\x20<>\x20'+_0x3c7dfe+_0x5eed79(0x200)+_0x1f706a+'\x20<>\x20'+_0x522bb5+'here'),_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fc)]=_0x522bb5[0x0],_0x10b2ba[_0x3c7dfe][_0x5eed79(0x26a)]=_0x522bb5[0x1],_0x10b2ba[_0x3c7dfe][_0x5eed79(0x196)]=0x0,_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fe)]=0x0,_0x10b2ba[_0x3c7dfe][_0x5eed79(0x18a)]=_0x5eed79(0x1a8),_0x10b2ba[_0x3c7dfe][_0x5eed79(0x187)]=_0x522bb5[0x3];else{var _0x1d812c;if(_0x522bb5[0x4]=='L')_0x1d812c=_0x5eed79(0x1ae);else _0x522bb5[0x4]=='F'&&(_0x1d812c='Floor');_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fc)]=_0x522bb5[0x0],_0x10b2ba[_0x3c7dfe]['rack']=_0x522bb5[0x1],_0x10b2ba[_0x3c7dfe][_0x5eed79(0x196)]=_0x522bb5[0x2],_0x10b2ba[_0x3c7dfe][_0x5eed79(0x1fe)]=_0x522bb5[0x3],_0x10b2ba[_0x3c7dfe]['type']=_0x1d812c,_0x10b2ba[_0x3c7dfe]['floorlevel']=_0x522bb5[0x5];}}}}});}),_0x4be89a[_0x25058c(0x1fa)]((_0x16d9f7,_0x3702c6)=>{var _0x4febf9=_0x25058c;_0x10b2ba[_0x3702c6][_0x4febf9(0x20d)]=_0x16d9f7;}),_0x3aa8e1['forEach']((_0xa5516d,_0x544621)=>{var _0x33577f=_0x25058c;_0x10b2ba[_0x544621][_0x33577f(0x220)]=_0xa5516d;}),_0x3cbffa['forEach']((_0x5c3719,_0x3d2dae)=>{var _0x17a72b=_0x25058c;_0x10b2ba[_0x3d2dae][_0x17a72b(0x20f)]=_0x5c3719;}),_0x595287['forEach']((_0x2ba4e8,_0x29ea10)=>{var _0x2d6160=_0x25058c;_0x10b2ba[_0x29ea10][_0x2d6160(0x1dd)]=_0x2ba4e8;}),_0x554b40[_0x25058c(0x1fa)]((_0x7c28ad,_0x4644af)=>{var _0x1f0445=_0x25058c;_0x10b2ba[_0x4644af][_0x1f0445(0x191)]=_0x7c28ad;}),_0x3bb01d[_0x25058c(0x1fa)]((_0x2bcb60,_0x25275f)=>{_0x10b2ba[_0x25275f]['maxperunit']=_0x2bcb60;}),_0x8ec994[_0x25058c(0x1fa)]((_0x385c6d,_0x3a232a)=>{var _0x31ec58=_0x25058c;_0x10b2ba[_0x3a232a][_0x31ec58(0x1b9)]=_0x385c6d;}),_0x26c56b['forEach']((_0x12ca9a,_0x54f669)=>{var _0x4708c7=_0x25058c;_0x10b2ba[_0x54f669][_0x4708c7(0x17f)]=_0x12ca9a;}),_0x3a9d26[_0x25058c(0x1fa)]((_0x435ea6,_0x2fba56)=>{var _0x1dc92b=_0x25058c;_0x10b2ba[_0x2fba56][_0x1dc92b(0x1de)]=_0x435ea6;}),_0x2c6bed[_0x25058c(0x1fa)]((_0x128b54,_0x2e16c8)=>{var _0x4fc5df=_0x25058c;_0x10b2ba[_0x2e16c8][_0x4fc5df(0x1c8)]=_0x128b54;}),_0x2add17[_0x25058c(0x1fa)]((_0x102d5c,_0x225372)=>{var _0x2a19e3=_0x25058c;_0x10b2ba[_0x225372][_0x2a19e3(0x260)]=_0x102d5c;}),_0x11640e['forEach']((_0x254b5a,_0x2bea51)=>{var _0x254e17=_0x25058c;_0x10b2ba[_0x2bea51][_0x254e17(0x1e3)]=_0x254b5a;});const _0x3200d7=_0x2c6bed[_0x25058c(0x186)](_0x505a85=>{return _0x505a85={'room_name':_0x505a85};}),_0x457ec6=_0x10b2ba[_0x25058c(0x1ef)](_0x3b669e=>_0x3b669e[_0x25058c(0x244)]!=='0'&&_0x3b669e[_0x25058c(0x244)]!==''),_0x3689db=new purchases({'invoice':_0x397c3b,'suppliers':_0x4b45b9[_0x25058c(0x1b7)][_0x25058c(0x23f)],'date':_0x1675e8,'warehouse_name':_0x4708ea,'product':_0x457ec6,'note':_0x38a84b,'due_amount':_0x4893ed,'POnumber':_0x348d61,'SCRN':_0x12e0b6,'JO_number':_0x4694fd,'roomList':_0x3200d7}),_0x4a567b=await _0x3689db[_0x25058c(0x22a)](),_0x1890a7=await purchases[_0x25058c(0x199)]({'invoice':_0x397c3b}),_0x2fdd4b=_0x1890a7[_0x25058c(0x233)][_0x25058c(0x186)](async _0x2f39f6=>{var _0x361aee=_0x25058c,_0x1b203f=await warehouse['findOne']({'name':_0x4708ea,'room':_0x2f39f6['room_name']}),_0x1be0d8=0x0;return _0x1b203f[_0x361aee(0x18e)][_0x361aee(0x1fa)](_0x378152=>{var _0xb97d1b=_0x361aee;_0x378152[_0xb97d1b(0x214)]==_0x2f39f6['product_name']&&_0x378152[_0xb97d1b(0x187)]==_0x2f39f6['floorlevel']&&_0x378152['type']==_0x2f39f6[_0xb97d1b(0x18a)]&&_0x378152[_0xb97d1b(0x1fe)]==_0x2f39f6[_0xb97d1b(0x1fe)]&&_0x378152[_0xb97d1b(0x196)]==_0x2f39f6[_0xb97d1b(0x196)]&&_0x378152[_0xb97d1b(0x26a)]==_0x2f39f6[_0xb97d1b(0x26a)]&&_0x378152[_0xb97d1b(0x1fc)]==_0x2f39f6[_0xb97d1b(0x1fc)]&&_0x378152[_0xb97d1b(0x191)]==_0x2f39f6[_0xb97d1b(0x191)]&&_0x378152[_0xb97d1b(0x1dd)]==_0x2f39f6[_0xb97d1b(0x1dd)]&&_0x378152['production_date']==_0x2f39f6[_0xb97d1b(0x17f)]&&_0x378152['invoice']==_0x1890a7[_0xb97d1b(0x1e3)]&&(_0x378152[_0xb97d1b(0x17c)]+=Math['abs'](_0x2f39f6[_0xb97d1b(0x244)]),_0x1be0d8++);}),_0x1be0d8===0x0&&_0x1b203f[_0x361aee(0x18e)]['push']({'product_name':_0x2f39f6[_0x361aee(0x214)],'product_stock':Math['abs'](_0x2f39f6[_0x361aee(0x244)]),'primary_code':_0x2f39f6[_0x361aee(0x20d)],'secondary_code':_0x2f39f6['secondary_code'],'product_code':_0x2f39f6[_0x361aee(0x177)],'storage':_0x2f39f6[_0x361aee(0x1fc)],'rack':_0x2f39f6['rack'],'bay':_0x2f39f6[_0x361aee(0x196)],'bin':_0x2f39f6[_0x361aee(0x1fe)],'type':_0x2f39f6[_0x361aee(0x18a)],'floorlevel':_0x2f39f6[_0x361aee(0x187)],'maxProducts':_0x2f39f6['maxStocks'],'unit':_0x2f39f6[_0x361aee(0x263)],'secondary_unit':_0x2f39f6[_0x361aee(0x1af)],'expiry_date':_0x2f39f6[_0x361aee(0x191)],'maxPerUnit':_0x2f39f6[_0x361aee(0x276)],'batch_code':_0x2f39f6['batch_code'],'alertQTY':_0x2f39f6[_0x361aee(0x1b9)],'production_date':_0x2f39f6[_0x361aee(0x17f)],'product_cat':_0x2f39f6[_0x361aee(0x1de)],'invoice':_0x2f39f6[_0x361aee(0x1e3)],'actual_qty':Math[_0x361aee(0x20c)](_0x2f39f6[_0x361aee(0x1dc)]),'actual_uom':_0x2f39f6['actual_uom']}),_0x1b203f;});Promise[_0x25058c(0x23d)](_0x2fdd4b)[_0x25058c(0x175)](async _0x25c09f=>{var _0x1a7268=_0x25058c;try{for(const _0x108cf4 of _0x25c09f){await _0x108cf4[_0x1a7268(0x22a)]();}const _0xe7e7c2=await master_shop[_0x1a7268(0x163)](),_0x3ae7a5=await email_settings[_0x1a7268(0x199)](),_0x478195=await supervisor_settings[_0x1a7268(0x163)]();var _0x336b14=_0x1890a7[_0x1a7268(0x233)],_0x157130='',_0x91d76;for(_0x91d76 in _0x336b14){_0x157130+='<tr>'+_0x1a7268(0x267)+_0x336b14[_0x91d76][_0x1a7268(0x214)]+_0x1a7268(0x25d)+_0x1a7268(0x267)+_0x336b14[_0x91d76][_0x1a7268(0x177)]+_0x1a7268(0x25d)+_0x1a7268(0x267)+_0x336b14[_0x91d76][_0x1a7268(0x244)]+_0x1a7268(0x25d)+_0x1a7268(0x267)+_0x336b14[_0x91d76][_0x1a7268(0x263)]+_0x1a7268(0x25d)+_0x1a7268(0x267)+_0x336b14[_0x91d76][_0x1a7268(0x1af)]+_0x1a7268(0x25d)+_0x1a7268(0x267)+_0x1890a7['warehouse_name']+_0x1a7268(0x25d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x336b14[_0x91d76][_0x1a7268(0x1c8)]+_0x1a7268(0x25d)+_0x1a7268(0x267)+_0x336b14[_0x91d76][_0x1a7268(0x1fc)]+_0x336b14[_0x91d76][_0x1a7268(0x26a)]+_0x336b14[_0x91d76][_0x1a7268(0x196)]+_0x336b14[_0x91d76][_0x1a7268(0x1fe)]+_0x336b14[_0x91d76]['type'][0x0]+_0x336b14[_0x91d76]['floorlevel']+'</td>',_0x1a7268(0x167);}let _0x3ddd8c=nodemailer[_0x1a7268(0x1b5)]({'host':_0x3ae7a5['host'],'port':Number(_0x3ae7a5[_0x1a7268(0x23a)]),'secure':![],'auth':{'user':_0x3ae7a5[_0x1a7268(0x1c0)],'pass':_0x3ae7a5['password']}}),_0x5cc2a9={'from':_0x3ae7a5[_0x1a7268(0x1c0)],'to':_0x478195[0x0]['RMSEmail'],'subject':_0x1a7268(0x203),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x1a7268(0x166)+_0xe7e7c2[0x0][_0x1a7268(0x1f3)],'cid':_0x1a7268(0x229)}],'html':_0x1a7268(0x178)+'<html><head><title></title>'+_0x1a7268(0x231)+_0x1a7268(0x25e)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1a7268(0x25e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x1a7268(0x1c3)+_0x1a7268(0x25e)+'<h2>\x20'+_0xe7e7c2[0x0][_0x1a7268(0x1d8)]+_0x1a7268(0x173)+'</div>'+_0x1a7268(0x1c3)+_0x1a7268(0x164)+_0x1a7268(0x25e)+_0x1a7268(0x1d0)+_0x1a7268(0x219)+_0x1890a7[_0x1a7268(0x1e3)]+'\x20'+_0x1a7268(0x1f4)+'\x20Order\x20Date\x20:\x20'+_0x1890a7['date']+'\x20'+_0x1a7268(0x265)+_0x1a7268(0x243)+_0x1a7268(0x1c3)+_0x1a7268(0x239)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1a7268(0x169)+_0x1a7268(0x1cd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1a7268(0x1cb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x1a7268(0x275)+_0x1a7268(0x19f)+_0x1a7268(0x161)+_0x1a7268(0x1e1)+_0x1a7268(0x167)+_0x1a7268(0x162)+_0x1a7268(0x213)+'\x20'+_0x157130+'\x20'+'</tbody>'+_0x1a7268(0x17e)+_0x1a7268(0x25e)+_0x1a7268(0x25f)+_0x1a7268(0x189)+_0xe7e7c2[0x0][_0x1a7268(0x1d8)]+_0x1a7268(0x243)+_0x1a7268(0x1c3)+_0x1a7268(0x1c3)+_0x1a7268(0x1a6)};_0x3ddd8c[_0x1a7268(0x174)](_0x5cc2a9,function(_0x1c081b,_0x24cce2){var _0x5cc04f=_0x1a7268;_0x1c081b?(console[_0x5cc04f(0x16d)](_0x1c081b),console[_0x5cc04f(0x16d)](_0x5cc04f(0x179))):console['log'](_0x5cc04f(0x176));}),_0x4b45b9[_0x1a7268(0x171)](_0x1a7268(0x17d),'Purchase\x20data\x20added\x20successfully'),_0x1b1e60[_0x1a7268(0x20b)](_0x1a7268(0x221));}catch(_0x50bba9){console[_0x1a7268(0x223)](_0x50bba9),_0x1b1e60['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x25058c(0x1bc)](_0x2a32b1=>{var _0x56a1b9=_0x25058c;console[_0x56a1b9(0x223)](_0x2a32b1),_0x1b1e60[_0x56a1b9(0x209)](0x1f4)[_0x56a1b9(0x1b2)]({'error':_0x56a1b9(0x1f8)});});}catch(_0x397534){console[_0x25058c(0x16d)](_0x397534);}}),router[a0_0x4eccf9(0x269)]('/preview/:id',auth,async(_0x49230b,_0xdc7ad1)=>{var _0x46869d=a0_0x4eccf9;try{const {username:_0x27cd1c,email:_0x1e948e,role:_0x5d0f7f}=_0x49230b[_0x46869d(0x23c)],_0x4e98dc=_0x49230b[_0x46869d(0x23c)],_0x1c84a4=await profile[_0x46869d(0x199)]({'email':_0x4e98dc['email']}),_0x32ceb8=await master_shop[_0x46869d(0x163)](),_0x1afdc9=_0x49230b['params']['id'],_0x13b50a=await purchases['findById'](_0x1afdc9),_0x4cb6b5=await warehouse[_0x46869d(0x1e7)]([{'$match':{'name':_0x13b50a[_0x46869d(0x1c4)],'room':_0x13b50a['room']}},{'$unwind':_0x46869d(0x19a)},{'$group':{'_id':_0x46869d(0x1ab),'name':{'$first':_0x46869d(0x1cc)},'product_stock':{'$first':_0x46869d(0x1d6)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x46869d(0x211)},'type':{'$first':_0x46869d(0x1b6)},'floorlevel':{'$first':_0x46869d(0x208)},'primary_code':{'$first':_0x46869d(0x21b)},'secondary_code':{'$first':_0x46869d(0x22f)},'product_code':{'$first':_0x46869d(0x210)},'storage':{'$first':_0x46869d(0x236)},'rack':{'$first':_0x46869d(0x1f9)},'expiry_date':{'$first':_0x46869d(0x1e9)}}}]),_0x2fc78c=await customer[_0x46869d(0x163)]({});let _0x2499d0;if(_0x4e98dc[_0x46869d(0x197)]==_0x46869d(0x1ff)){const _0x3ec84c=await staff[_0x46869d(0x199)]({'email':_0x4e98dc[_0x46869d(0x1c0)]});_0x2499d0=await warehouse[_0x46869d(0x1e7)]([{'$match':{'status':_0x46869d(0x26c),'name':_0x3ec84c['warehouse']}},{'$group':{'_id':_0x46869d(0x264),'name':{'$first':_0x46869d(0x264)}}}]);}else _0x2499d0=await warehouse['aggregate']([{'$match':{'status':_0x46869d(0x26c)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x5a7497=await product[_0x46869d(0x163)]({}),_0x218a8a=await suppliers[_0x46869d(0x163)]({}),_0x5be7b6=BayBinSelected(_0x13b50a[_0x46869d(0x1c4)],_0x13b50a[_0x46869d(0x202)]);if(_0x32ceb8[0x0][_0x46869d(0x17b)]=='English\x20(US)'){var _0x2e0c25=users[_0x46869d(0x190)];console[_0x46869d(0x16d)](_0x2e0c25);}else{if(_0x32ceb8[0x0][_0x46869d(0x17b)]==_0x46869d(0x1ac))var _0x2e0c25=users['Hindi'];else{if(_0x32ceb8[0x0]['language']==_0x46869d(0x273))var _0x2e0c25=users[_0x46869d(0x273)];else{if(_0x32ceb8[0x0]['language']==_0x46869d(0x262))var _0x2e0c25=users['Spanish'];else{if(_0x32ceb8[0x0][_0x46869d(0x17b)]==_0x46869d(0x1ce))var _0x2e0c25=users[_0x46869d(0x1ce)];else{if(_0x32ceb8[0x0][_0x46869d(0x17b)]==_0x46869d(0x20e))var _0x2e0c25=users[_0x46869d(0x248)];else{if(_0x32ceb8[0x0][_0x46869d(0x17b)]==_0x46869d(0x1ed))var _0x2e0c25=users[_0x46869d(0x1ed)];else{if(_0x32ceb8[0x0][_0x46869d(0x17b)]==_0x46869d(0x1a0))var _0x2e0c25=users['Arabic'];}}}}}}}_0xdc7ad1[_0x46869d(0x198)](_0x46869d(0x272),{'success':_0x49230b[_0x46869d(0x171)](_0x46869d(0x17d)),'errors':_0x49230b[_0x46869d(0x171)](_0x46869d(0x1f7)),'role':_0x4e98dc,'profile':_0x1c84a4,'customer':_0x2fc78c,'warehouse':_0x2499d0,'product':_0x4cb6b5,'user':_0x13b50a,'master_shop':_0x32ceb8,'unit':_0x5a7497,'language':_0x2e0c25,'suppliers':_0x218a8a,'dataSelected':_0x5be7b6});}catch(_0x214e0a){console['log'](_0x214e0a);}}),router[a0_0x4eccf9(0x24e)]('/preview/:id',auth,async(_0x458d64,_0x2871d2)=>{var _0x1cd890=a0_0x4eccf9;try{const _0x459f33=_0x458d64['params']['id'],{invoice:_0xe9af8c,warehouse_name:_0x288ad4,Room_name:_0x2646bd}=_0x458d64[_0x1cd890(0x1b7)],_0x1de4c8=await warehouse[_0x1cd890(0x199)]({'name':_0x288ad4,'room':_0x2646bd}),_0x3e09db=await purchases['findOne']({'invoice':_0xe9af8c});_0x3e09db[_0x1cd890(0x233)][_0x1cd890(0x1fa)](_0x526f80=>{var _0x379f76=_0x1cd890,_0x1bf33c=0x0;const _0xb6ce5b=_0x1de4c8[_0x379f76(0x18e)][_0x379f76(0x186)](_0xb048ce=>{var _0x2cd968=_0x379f76;_0xb048ce[_0x2cd968(0x214)]==_0x526f80[_0x2cd968(0x214)]&&_0xb048ce['floorlevel']==_0x526f80[_0x2cd968(0x187)]&&_0xb048ce[_0x2cd968(0x18a)]==_0x526f80[_0x2cd968(0x18a)]&&_0xb048ce[_0x2cd968(0x1fe)]==_0x526f80[_0x2cd968(0x1fe)]&&_0xb048ce[_0x2cd968(0x196)]==_0x526f80[_0x2cd968(0x196)]&&_0xb048ce['rack']==_0x526f80['rack']&&_0xb048ce[_0x2cd968(0x1fc)]==_0x526f80[_0x2cd968(0x1fc)]&&_0xb048ce['expiry_date']==_0x526f80['expiry_date']&&_0xb048ce[_0x2cd968(0x1dd)]==_0x526f80[_0x2cd968(0x1dd)]&&_0xb048ce[_0x2cd968(0x17f)]==_0x526f80[_0x2cd968(0x17f)]&&_0xb048ce['delivery_date']==_0x526f80[_0x2cd968(0x1f5)]&&_0xb048ce['delivery_code']==_0x526f80[_0x2cd968(0x260)]&&(_0xb048ce[_0x2cd968(0x17c)]=parseInt(_0xb048ce[_0x2cd968(0x17c)])+parseInt(_0x526f80[_0x2cd968(0x244)]),_0x1bf33c++);});_0x1bf33c=='0'&&(_0x1de4c8[_0x379f76(0x18e)]=_0x1de4c8[_0x379f76(0x18e)][_0x379f76(0x183)]({'product_name':_0x526f80['product_name'],'product_stock':_0x526f80[_0x379f76(0x244)],'primary_code':_0x526f80[_0x379f76(0x20d)],'secondary_code':_0x526f80[_0x379f76(0x220)],'product_code':_0x526f80[_0x379f76(0x177)],'storage':_0x526f80[_0x379f76(0x1fc)],'rack':_0x526f80[_0x379f76(0x26a)],'bay':_0x526f80[_0x379f76(0x196)],'bin':_0x526f80[_0x379f76(0x1fe)],'type':_0x526f80[_0x379f76(0x18a)],'floorlevel':_0x526f80[_0x379f76(0x187)],'maxProducts':_0x526f80['maxStocks'],'unit':_0x526f80[_0x379f76(0x263)],'secondary_unit':_0x526f80['secondary_unit'],'expiry_date':_0x526f80[_0x379f76(0x191)],'maxPerUnit':_0x526f80[_0x379f76(0x276)],'batch_code':_0x526f80[_0x379f76(0x1dd)],'alertQTY':_0x526f80[_0x379f76(0x1b9)],'production_date':_0x526f80['production_date'],'delivery_date':_0x526f80[_0x379f76(0x1f5)],'delivery_code':_0x526f80['delivery_code']}));}),await _0x1de4c8[_0x1cd890(0x22a)](),_0x3e09db[_0x1cd890(0x21e)]=_0x1cd890(0x258);const _0x4d1f9c=await _0x3e09db[_0x1cd890(0x22a)]();_0x458d64[_0x1cd890(0x171)]('success',_0x1cd890(0x240)),_0x2871d2['redirect']('/all_purchases/view');}catch(_0x2f1172){console[_0x1cd890(0x16d)](_0x2f1172);}}),router[a0_0x4eccf9(0x269)](a0_0x4eccf9(0x232),auth,async(_0x1d9aa7,_0x5dfb8f)=>{var _0x16aeb3=a0_0x4eccf9;try{const {username:_0x234f1c,email:_0x230fa7,role:_0x90cf0d}=_0x1d9aa7[_0x16aeb3(0x23c)],_0x15f394=_0x1d9aa7['user'],_0x621896=await profile['findOne']({'email':_0x15f394[_0x16aeb3(0x1c0)]}),_0x3705d9=await master_shop[_0x16aeb3(0x163)](),_0x5655fc=_0x1d9aa7[_0x16aeb3(0x1a4)]['id'],_0x4c6fbf=await purchases['findById'](_0x5655fc),_0x59f399=await suppliers[_0x16aeb3(0x163)]({});let _0x260c6e;if(_0x15f394['role']==_0x16aeb3(0x1ff)){const _0x4c6a6=await staff['findOne']({'email':_0x15f394[_0x16aeb3(0x1c0)]});_0x260c6e=await warehouse[_0x16aeb3(0x163)]({'status':_0x16aeb3(0x26c),'name':_0x4c6a6[_0x16aeb3(0x1a1)],'warehouse_category':_0x16aeb3(0x184)});}else _0x260c6e=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x16aeb3(0x184)}},{'$group':{'_id':_0x16aeb3(0x264),'name':{'$first':_0x16aeb3(0x264)}}}]);const _0x10cdeb=await product['find']({}),_0xb8c514=BayBinSelected(_0x4c6fbf['warehouse_name'],_0x4c6fbf[_0x16aeb3(0x202)]);let _0x54229a=new Date(_0x4c6fbf[_0x16aeb3(0x191)]),_0x994c9d=('0'+_0x54229a[_0x16aeb3(0x271)]())[_0x16aeb3(0x274)](-0x2),_0x178e55=('0'+(_0x54229a[_0x16aeb3(0x1b3)]()+0x1))[_0x16aeb3(0x274)](-0x2),_0x21b983=_0x54229a['getFullYear'](),_0x23915e=_0x21b983+'-'+_0x178e55+'-'+_0x994c9d;if(_0x3705d9[0x0][_0x16aeb3(0x17b)]==_0x16aeb3(0x22d)){var _0x2b566b=users['English'];console[_0x16aeb3(0x16d)](_0x2b566b);}else{if(_0x3705d9[0x0]['language']=='Hindi')var _0x2b566b=users[_0x16aeb3(0x1ac)];else{if(_0x3705d9[0x0][_0x16aeb3(0x17b)]==_0x16aeb3(0x273))var _0x2b566b=users[_0x16aeb3(0x273)];else{if(_0x3705d9[0x0]['language']=='Spanish')var _0x2b566b=users[_0x16aeb3(0x262)];else{if(_0x3705d9[0x0][_0x16aeb3(0x17b)]==_0x16aeb3(0x1ce))var _0x2b566b=users['French'];else{if(_0x3705d9[0x0][_0x16aeb3(0x17b)]==_0x16aeb3(0x20e))var _0x2b566b=users['Portuguese'];else{if(_0x3705d9[0x0]['language']==_0x16aeb3(0x1ed))var _0x2b566b=users['Chinese'];else{if(_0x3705d9[0x0][_0x16aeb3(0x17b)]==_0x16aeb3(0x1a0))var _0x2b566b=users['Arabic'];}}}}}}}_0x5dfb8f[_0x16aeb3(0x198)](_0x16aeb3(0x22e),{'success':_0x1d9aa7[_0x16aeb3(0x171)](_0x16aeb3(0x17d)),'errors':_0x1d9aa7[_0x16aeb3(0x171)](_0x16aeb3(0x1f7)),'role':_0x15f394,'profile':_0x621896,'purchases':_0x4c6fbf,'suppliers':_0x59f399,'warehouse':_0x260c6e,'product':_0x10cdeb,'master_shop':_0x3705d9,'language':_0x2b566b,'ed_fullDate':_0x23915e,'dataSelected':_0xb8c514});}catch(_0x183d8b){console['log'](_0x183d8b);}}),router['post']('/view/:id',auth,async(_0x1d4f9c,_0x7ef983)=>{var _0x30e9dd=a0_0x4eccf9;try{const _0x19100d=_0x1d4f9c[_0x30e9dd(0x1a4)]['id'],_0x16918f=await purchases[_0x30e9dd(0x199)]({'_id':_0x1d4f9c[_0x30e9dd(0x1a4)]['id']}),_0x2dd4d0=await warehouse[_0x30e9dd(0x199)]({'name':_0x16918f[_0x30e9dd(0x1c4)],'room':_0x16918f[_0x30e9dd(0x202)]});_0x16918f[_0x30e9dd(0x233)]['forEach'](_0x1527d3=>{var _0x4ac5c8=_0x30e9dd;const _0x575227=_0x2dd4d0['product_details'][_0x4ac5c8(0x186)](_0x5cf2ae=>{var _0x27a68a=_0x4ac5c8;_0x5cf2ae[_0x27a68a(0x214)]==_0x1527d3[_0x27a68a(0x214)]&&_0x5cf2ae[_0x27a68a(0x187)]==_0x1527d3['floorlevel']&&_0x5cf2ae[_0x27a68a(0x18a)]==_0x1527d3[_0x27a68a(0x18a)]&&_0x5cf2ae[_0x27a68a(0x1fe)]==_0x1527d3[_0x27a68a(0x1fe)]&&_0x5cf2ae['bay']==_0x1527d3[_0x27a68a(0x196)]&&_0x5cf2ae[_0x27a68a(0x26a)]==_0x1527d3[_0x27a68a(0x26a)]&&_0x5cf2ae[_0x27a68a(0x1fc)]==_0x1527d3['storage']&&(_0x5cf2ae[_0x27a68a(0x17c)]=parseInt(_0x5cf2ae[_0x27a68a(0x17c)])-parseInt(_0x1527d3['quantity']));});}),await _0x2dd4d0[_0x30e9dd(0x22a)]();const {invoice:_0x5bec36,suppliers:_0x454ea0,date:_0x155b63,warehouse_name:_0x5585d4,prod_name:_0x6e8c58,prod_code:_0x530383,prod_qty:_0x38b2ef,prod_unit:_0x2e0682,prod_secondunit:_0x19cbcc,prod_level:_0x36b3c8,prod_isle:_0x60dcd9,prod_pallet:_0x7404a5,note:_0x40b4c8,expiry_date:_0x537f2b,batch_code:_0x593eb4,paid_amount:_0x174af8,due_amount:_0xd81106,Room_name:_0x3a65a8,primary_code:_0x1c37bf,secondary_code:_0x3edc92,PO_number:_0x395eea,JO_number:_0x4df9e1}=_0x1d4f9c['body'];if(typeof _0x6e8c58==_0x30e9dd(0x207))var _0xb40e41=[_0x1d4f9c[_0x30e9dd(0x1b7)]['prod_name']],_0x57b17f=[_0x1d4f9c[_0x30e9dd(0x1b7)]['prod_code']],_0x5791cd=[_0x1d4f9c['body'][_0x30e9dd(0x254)]],_0x2a64b8=[_0x1d4f9c[_0x30e9dd(0x1b7)]['prod_unit']],_0x39f786=[_0x1d4f9c[_0x30e9dd(0x1b7)]['prod_secondunit']],_0x478621=[_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1eb)]],_0x1e7853=[_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x268)]],_0x44c5d6=[_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1f1)]],_0x1aba54=[_0x1d4f9c[_0x30e9dd(0x1b7)]['primary_code']],_0x5f1189=[_0x1d4f9c[_0x30e9dd(0x1b7)]['secondary_code']],_0x3f69ad=[_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x250)]],_0x3e917d=[_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1dd)]],_0x280ba1=[_0x1d4f9c['body']['expiry_date']],_0x1760bd=[_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1fc)]],_0x1a6ffc=[_0x1d4f9c['body'][_0x30e9dd(0x252)]],_0x51e545=[_0x1d4f9c[_0x30e9dd(0x1b7)]['type']];else var _0xb40e41=[..._0x1d4f9c['body']['prod_name']],_0x57b17f=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1cf)]],_0x5791cd=[..._0x1d4f9c[_0x30e9dd(0x1b7)]['prod_qty']],_0x2a64b8=[..._0x1d4f9c[_0x30e9dd(0x1b7)]['prod_unit']],_0x39f786=[..._0x1d4f9c[_0x30e9dd(0x1b7)]['prod_secondunit']],_0x478621=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1eb)]],_0x1e7853=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x268)]],_0x44c5d6=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1f1)]],_0x1aba54=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x20d)]],_0x5f1189=[..._0x1d4f9c[_0x30e9dd(0x1b7)]['secondary_code']],_0x3f69ad=[..._0x1d4f9c['body'][_0x30e9dd(0x250)]],_0x3e917d=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1dd)]],_0x280ba1=[..._0x1d4f9c['body'][_0x30e9dd(0x191)]],_0x1760bd=[..._0x1d4f9c['body'][_0x30e9dd(0x1fc)]],_0x1a6ffc=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x252)]],_0x51e545=[..._0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x18a)]];const _0x9d2630=_0xb40e41[_0x30e9dd(0x186)](_0x30305a=>{return _0x30305a={'product_name':_0x30305a};});_0x57b17f[_0x30e9dd(0x1fa)]((_0x510996,_0x27eba6)=>{var _0x3cc489=_0x30e9dd;_0x9d2630[_0x27eba6][_0x3cc489(0x177)]=_0x510996;}),_0x5791cd[_0x30e9dd(0x1fa)]((_0x1a0243,_0xaf8fc1)=>{_0x9d2630[_0xaf8fc1]['quantity']=_0x1a0243;}),_0x2a64b8[_0x30e9dd(0x1fa)]((_0x3880c6,_0x3687e8)=>{_0x9d2630[_0x3687e8]['standard_unit']=_0x3880c6;}),_0x39f786[_0x30e9dd(0x1fa)]((_0x4829aa,_0x4b4623)=>{var _0x532ae0=_0x30e9dd;_0x9d2630[_0x4b4623][_0x532ae0(0x1af)]=_0x4829aa;}),_0x478621[_0x30e9dd(0x1fa)]((_0x578c85,_0x58b862)=>{var _0x169d7d=_0x30e9dd;_0x9d2630[_0x58b862][_0x169d7d(0x196)]=_0x578c85;}),_0x1e7853[_0x30e9dd(0x1fa)]((_0x5b471c,_0x2057ec)=>{var _0x3275f4=_0x30e9dd;_0x9d2630[_0x2057ec][_0x3275f4(0x1fe)]=_0x5b471c;}),_0x44c5d6[_0x30e9dd(0x1fa)]((_0x2f8ecd,_0x17ca6a)=>{var _0x59c55f=_0x30e9dd;_0x9d2630[_0x17ca6a][_0x59c55f(0x187)]=_0x2f8ecd;}),_0x1aba54['forEach']((_0x43a477,_0x3bdebe)=>{var _0x1d3a76=_0x30e9dd;_0x9d2630[_0x3bdebe][_0x1d3a76(0x20d)]=_0x43a477;}),_0x5f1189[_0x30e9dd(0x1fa)]((_0x1894e2,_0x422faa)=>{var _0x568750=_0x30e9dd;_0x9d2630[_0x422faa][_0x568750(0x220)]=_0x1894e2;}),_0x3f69ad[_0x30e9dd(0x1fa)]((_0x13fc42,_0x1d446c)=>{_0x9d2630[_0x1d446c]['maxStocks']=_0x13fc42;}),_0x3e917d[_0x30e9dd(0x1fa)]((_0x326052,_0x3de7d3)=>{var _0x5e53d5=_0x30e9dd;_0x9d2630[_0x3de7d3][_0x5e53d5(0x1dd)]=_0x326052;}),_0x280ba1[_0x30e9dd(0x1fa)]((_0x1c7640,_0x4bccc9)=>{var _0x1a8118=_0x30e9dd;_0x9d2630[_0x4bccc9][_0x1a8118(0x191)]=_0x1c7640;}),_0x51e545['forEach']((_0x2d7626,_0x13d56c)=>{var _0x5d05e0=_0x30e9dd;_0x9d2630[_0x13d56c][_0x5d05e0(0x18a)]=_0x2d7626;}),_0x1760bd[_0x30e9dd(0x1fa)]((_0x5d0346,_0x5e6543)=>{_0x9d2630[_0x5e6543]['storage']=_0x5d0346;}),_0x1a6ffc[_0x30e9dd(0x1fa)]((_0x5adbf0,_0x295977)=>{var _0x15feb6=_0x30e9dd;_0x9d2630[_0x295977][_0x15feb6(0x26a)]=_0x5adbf0;});const _0x2e0b44=_0x9d2630[_0x30e9dd(0x1ef)](_0x769afe=>_0x769afe[_0x30e9dd(0x244)]!=='0'&&_0x769afe[_0x30e9dd(0x244)]!=='');_0x16918f[_0x30e9dd(0x1e3)]=_0x5bec36,_0x16918f[_0x30e9dd(0x23f)]=_0x454ea0,_0x16918f[_0x30e9dd(0x1e5)]=_0x155b63,_0x16918f[_0x30e9dd(0x1c4)]=_0x5585d4,_0x16918f[_0x30e9dd(0x233)]=_0x2e0b44,_0x16918f[_0x30e9dd(0x216)]=_0x40b4c8,_0x16918f[_0x30e9dd(0x251)]=_0x174af8,_0x16918f[_0x30e9dd(0x242)]=_0xd81106,_0x16918f['room']=_0x3a65a8,_0x16918f['POnumber']=_0x395eea,_0x16918f[_0x30e9dd(0x170)]=_0x4df9e1;const _0x549bf0=await _0x16918f[_0x30e9dd(0x22a)](),_0x4f0a6e=await warehouse[_0x30e9dd(0x199)]({'name':_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1c4)],'room':_0x1d4f9c[_0x30e9dd(0x1b7)]['Room_name']});_0x16918f[_0x30e9dd(0x233)]['forEach'](_0x5ed308=>{var _0x22974c=_0x30e9dd,_0x46edb7=0x0;const _0x1a4204=_0x4f0a6e['product_details'][_0x22974c(0x186)](_0x4ca347=>{var _0x392ab5=_0x22974c;_0x4ca347['product_name']==_0x5ed308['product_name']&&_0x4ca347[_0x392ab5(0x187)]==_0x5ed308[_0x392ab5(0x187)]&&_0x4ca347[_0x392ab5(0x18a)]==_0x5ed308[_0x392ab5(0x18a)]&&_0x4ca347['bin']==_0x5ed308[_0x392ab5(0x1fe)]&&_0x4ca347[_0x392ab5(0x196)]==_0x5ed308[_0x392ab5(0x196)]&&_0x4ca347['rack']==_0x5ed308['rack']&&_0x4ca347['storage']==_0x5ed308[_0x392ab5(0x1fc)]&&(_0x4ca347['product_stock']=parseInt(_0x4ca347[_0x392ab5(0x17c)])+parseInt(_0x5ed308['quantity']),_0x46edb7++);});_0x46edb7=='0'&&(_0x4f0a6e[_0x22974c(0x18e)]=_0x4f0a6e['product_details'][_0x22974c(0x183)]({'product_name':_0x5ed308['product_name'],'product_stock':_0x5ed308[_0x22974c(0x244)],'primary_code':_0x5ed308[_0x22974c(0x20d)],'secondary_code':_0x5ed308[_0x22974c(0x220)],'product_code':_0x5ed308['product_code'],'storage':_0x5ed308[_0x22974c(0x1fc)],'rack':_0x5ed308[_0x22974c(0x26a)],'bay':_0x5ed308['bay'],'bin':_0x5ed308[_0x22974c(0x1fe)],'type':_0x5ed308[_0x22974c(0x18a)],'floorlevel':_0x5ed308[_0x22974c(0x187)],'maxProducts':_0x5ed308[_0x22974c(0x20f)],'unit':_0x5ed308[_0x22974c(0x263)],'secondary_unit':_0x5ed308[_0x22974c(0x1af)],'expiry_date':_0x5ed308['expiry_date']}));}),await _0x4f0a6e['save']();const _0xfe0f89=await s_payment_data[_0x30e9dd(0x199)]({'invoice':_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x1e3)]});if(_0xfe0f89===null){}else console[_0x30e9dd(0x16d)](_0x30e9dd(0x23f),_0xfe0f89,_0x1d4f9c['body']['invoice']),_0xfe0f89['suppliers']=_0x1d4f9c[_0x30e9dd(0x1b7)][_0x30e9dd(0x23f)],await _0xfe0f89[_0x30e9dd(0x22a)]();_0x1d4f9c[_0x30e9dd(0x171)](_0x30e9dd(0x17d),_0x30e9dd(0x1b4)),_0x7ef983['redirect'](_0x30e9dd(0x24a));}catch(_0x3fc9f6){console['log'](_0x3fc9f6);}}),router[a0_0x4eccf9(0x24e)]('/give_payment/:id',auth,async(_0x433240,_0x5396ef)=>{var _0x123297=a0_0x4eccf9;try{const _0x2dc9e6=_0x433240[_0x123297(0x1a4)]['id'],{invoice:_0x313a72,suppliers:_0x4b6b25,payable:_0x191b6c,due_amount:_0x4d84fc}=_0x433240['body'],_0x1b55a9=await purchases[_0x123297(0x228)](_0x2dc9e6);var _0x1f4371=_0x191b6c-_0x4d84fc;_0x1b55a9[_0x123297(0x251)]=parseFloat(_0x1b55a9[_0x123297(0x251)])+parseFloat(_0x4d84fc),_0x1b55a9[_0x123297(0x242)]=_0x1f4371;const _0xc86ca5=await _0x1b55a9[_0x123297(0x22a)]();console[_0x123297(0x16d)](_0xc86ca5);const _0x56cade=await s_payment_data[_0x123297(0x199)]({'invoice':_0x313a72});_0x56cade[_0x123297(0x1a2)]=_0x1f4371,await _0x56cade[_0x123297(0x22a)]();let _0x1a510a=new Date(),_0x3f26a4=('0'+_0x1a510a[_0x123297(0x271)]())[_0x123297(0x274)](-0x2),_0x4ca23c=('0'+(_0x1a510a['getMonth']()+0x1))['slice'](-0x2),_0x9631ae=_0x1a510a['getFullYear'](),_0x240300=_0x9631ae+'-'+_0x4ca23c+'-'+_0x3f26a4;const _0x46b8c1=new suppliers_payment({'invoice':_0x313a72,'date':_0x9631ae+'-'+_0x4ca23c+'-'+_0x3f26a4,'suppliers':_0x4b6b25,'reason':_0x123297(0x1b0),'amount':_0x4d84fc}),_0x3cdc3b=await _0x46b8c1[_0x123297(0x22a)]();_0x433240[_0x123297(0x171)](_0x123297(0x17d),'payment\x20successfull'),_0x5396ef[_0x123297(0x20b)]('/all_purchases/view');}catch(_0x518b9c){console[_0x123297(0x16d)](_0x518b9c);}}),router[a0_0x4eccf9(0x269)](a0_0x4eccf9(0x1c7),auth,async(_0x3011c2,_0x20cb42)=>{var _0x5b134e=a0_0x4eccf9;try{const {username:_0x8b6c58,email:_0x233796,role:_0x18fac6}=_0x3011c2[_0x5b134e(0x23c)],_0x4195e4=_0x3011c2['user'],_0x1815ee=await profile[_0x5b134e(0x199)]({'email':_0x4195e4[_0x5b134e(0x1c0)]}),_0xb64b05=await master_shop[_0x5b134e(0x163)]();console['log'](_0x5b134e(0x20a),_0xb64b05);const _0x5d7b2a=_0x3011c2['params']['id'],_0x33271f=await purchases[_0x5b134e(0x228)](_0x5d7b2a);console['log'](_0x33271f);const _0x55f272=await suppliers['findOne']({'name':_0x33271f[_0x5b134e(0x23f)]});console[_0x5b134e(0x16d)](_0x55f272);if(_0xb64b05[0x0][_0x5b134e(0x17b)]==_0x5b134e(0x22d)){var _0x5bb754=users['English'];console['log'](_0x5bb754);}else{if(_0xb64b05[0x0][_0x5b134e(0x17b)]==_0x5b134e(0x1ac))var _0x5bb754=users[_0x5b134e(0x1ac)];else{if(_0xb64b05[0x0][_0x5b134e(0x17b)]==_0x5b134e(0x273))var _0x5bb754=users[_0x5b134e(0x273)];else{if(_0xb64b05[0x0]['language']==_0x5b134e(0x262))var _0x5bb754=users[_0x5b134e(0x262)];else{if(_0xb64b05[0x0][_0x5b134e(0x17b)]=='French')var _0x5bb754=users['French'];else{if(_0xb64b05[0x0][_0x5b134e(0x17b)]==_0x5b134e(0x20e))var _0x5bb754=users[_0x5b134e(0x248)];else{if(_0xb64b05[0x0]['language']=='Chinese')var _0x5bb754=users[_0x5b134e(0x1ed)];else{if(_0xb64b05[0x0][_0x5b134e(0x17b)]=='Arabic\x20(ae)')var _0x5bb754=users[_0x5b134e(0x192)];}}}}}}}_0x20cb42['render'](_0x5b134e(0x225),{'success':_0x3011c2['flash'](_0x5b134e(0x17d)),'errors':_0x3011c2[_0x5b134e(0x171)](_0x5b134e(0x1f7)),'role':_0x4195e4,'profile':_0x1815ee,'master_shop':_0xb64b05,'supplier':_0x55f272,'purchase':_0x33271f,'language':_0x5bb754});}catch(_0x1ea415){console[_0x5b134e(0x16d)](_0x1ea415);}}),router['get'](a0_0x4eccf9(0x1fb),auth,async(_0xd0c159,_0x5a5050)=>{var _0x47a7d3=a0_0x4eccf9;try{const {username:_0x54029b,email:_0x4c08fc,role:_0x1be5d3}=_0xd0c159[_0x47a7d3(0x23c)],_0x318542=_0xd0c159[_0x47a7d3(0x23c)],_0x48360d=await profile[_0x47a7d3(0x199)]({'email':_0x318542['email']}),_0x401474=await master_shop['find']();console[_0x47a7d3(0x16d)](_0x47a7d3(0x20a),_0x401474);const _0x5ad4d7=_0xd0c159[_0x47a7d3(0x1a4)]['id'];console[_0x47a7d3(0x16d)](_0x5ad4d7);const _0x124fcd=await purchases[_0x47a7d3(0x228)](_0x5ad4d7);console['log']('user_id',_0x124fcd);const _0x4a80f1=await product[_0x47a7d3(0x163)]({}),_0x568d06=await warehouse[_0x47a7d3(0x1e7)]([{'$match':{'name':_0x124fcd['warehouse_name'],'room':_0x124fcd[_0x47a7d3(0x202)],'warehouse_category':_0x47a7d3(0x184)}},{'$unwind':_0x47a7d3(0x19a)},{'$group':{'_id':_0x47a7d3(0x1ab),'name':{'$first':_0x47a7d3(0x1cc)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x47a7d3(0x23b)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x47a7d3(0x1b6)},'floorlevel':{'$first':_0x47a7d3(0x208)},'primary_code':{'$first':_0x47a7d3(0x21b)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x47a7d3(0x236)},'rack':{'$first':_0x47a7d3(0x1f9)}}}]);warehouse_data=await warehouse[_0x47a7d3(0x1e7)]([{'$match':{'status':_0x47a7d3(0x26c),'name':_0x47a7d3(0x18f),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x47a7d3(0x264),'name':{'$first':_0x47a7d3(0x264)}}},{'$sort':{'name':0x1}}]),console[_0x47a7d3(0x16d)]('stock_data',_0x568d06);if(_0x401474[0x0]['language']==_0x47a7d3(0x22d)){var _0x56d4f0=users['English'];console[_0x47a7d3(0x16d)](_0x56d4f0);}else{if(_0x401474[0x0][_0x47a7d3(0x17b)]==_0x47a7d3(0x1ac))var _0x56d4f0=users['Hindi'];else{if(_0x401474[0x0][_0x47a7d3(0x17b)]==_0x47a7d3(0x273))var _0x56d4f0=users[_0x47a7d3(0x273)];else{if(_0x401474[0x0][_0x47a7d3(0x17b)]==_0x47a7d3(0x262))var _0x56d4f0=users[_0x47a7d3(0x262)];else{if(_0x401474[0x0][_0x47a7d3(0x17b)]==_0x47a7d3(0x1ce))var _0x56d4f0=users[_0x47a7d3(0x1ce)];else{if(_0x401474[0x0][_0x47a7d3(0x17b)]==_0x47a7d3(0x20e))var _0x56d4f0=users[_0x47a7d3(0x248)];else{if(_0x401474[0x0]['language']=='Chinese')var _0x56d4f0=users[_0x47a7d3(0x1ed)];else{if(_0x401474[0x0][_0x47a7d3(0x17b)]==_0x47a7d3(0x1a0))var _0x56d4f0=users[_0x47a7d3(0x192)];}}}}}}}_0x5a5050['render'](_0x47a7d3(0x235),{'success':_0xd0c159[_0x47a7d3(0x171)](_0x47a7d3(0x17d)),'errors':_0xd0c159[_0x47a7d3(0x171)](_0x47a7d3(0x1f7)),'role':_0x318542,'profile':_0x48360d,'user':_0x124fcd,'stock':_0x568d06,'master_shop':_0x401474,'product':_0x4a80f1,'language':_0x56d4f0,'warehouse':warehouse_data});}catch(_0x31c56a){console[_0x47a7d3(0x16d)](_0x31c56a);}}),router[a0_0x4eccf9(0x24e)]('/view/return_purchase/:id',auth,async(_0x66be1,_0x395191)=>{var _0x4601c2=a0_0x4eccf9;try{const {invoice:_0x22a181,date:_0x21ca38,warehouse_name:_0xcff80e,Room_name:_0x18a51f,product_name:_0x2c5da9,purchase_quantity:_0x57710c,stocks:_0x10ec04,return_qty:_0x2f30f8,note:_0x4f26f9,level:_0x101d58,isle:_0x13cb8f,pallet:_0x1a9601,to_warehouse_name:_0x42df63,to_Room_name:_0x19a7e0}=_0x66be1[_0x4601c2(0x1b7)],_0x5b53b1=await purchases[_0x4601c2(0x199)]({'_id':_0x66be1[_0x4601c2(0x1a4)]['id']}),_0x50be30=await warehouse[_0x4601c2(0x199)]({'name':_0xcff80e,'room':_0x18a51f});if(typeof _0x2c5da9=='string')var _0x2b263c=[_0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x214)]],_0x6a9f5c=[_0x66be1['body']['purchase_quantity']],_0x1a9044=[_0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x26f)]],_0x117f2f=[_0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x1c6)]],_0x1171cb=[_0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x277)]],_0x4ea2fd=[_0x66be1['body']['isle']],_0x595768=[_0x66be1[_0x4601c2(0x1b7)]['pallet']],_0x4e6d6b=[_0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x22c)]],_0x538ee7=[_0x66be1['body'][_0x4601c2(0x266)]],_0x3c8046=[_0x66be1['body'][_0x4601c2(0x1ee)]],_0x469e8b=[_0x66be1['body'][_0x4601c2(0x1f6)]];else var _0x2b263c=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x214)]],_0x6a9f5c=[..._0x66be1[_0x4601c2(0x1b7)]['purchase_quantity']],_0x1a9044=[..._0x66be1[_0x4601c2(0x1b7)]['stocks']],_0x117f2f=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x1c6)]],_0x1171cb=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x277)]],_0x4ea2fd=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x205)]],_0x595768=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x234)]],_0x4e6d6b=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x22c)]],_0x538ee7=[..._0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x266)]],_0x3c8046=[..._0x66be1['body'][_0x4601c2(0x1ee)]],_0x469e8b=[..._0x66be1[_0x4601c2(0x1b7)]['secondary_code_hide']];const _0x2a1dbe=_0x2b263c[_0x4601c2(0x186)](_0x4bb1e3=>{return _0x4bb1e3={'product_name':_0x4bb1e3};});_0x6a9f5c[_0x4601c2(0x1fa)]((_0x2baa74,_0x289d43)=>{var _0x2ef174=_0x4601c2;_0x2a1dbe[_0x289d43][_0x2ef174(0x18b)]=_0x2baa74;}),_0x1a9044[_0x4601c2(0x1fa)]((_0x4c8d23,_0x58f61c)=>{var _0x266360=_0x4601c2;_0x2a1dbe[_0x58f61c][_0x266360(0x1f0)]=_0x4c8d23;}),_0x117f2f[_0x4601c2(0x1fa)]((_0x4afef5,_0xfa4a54)=>{var _0x4d8580=_0x4601c2;_0x2a1dbe[_0xfa4a54][_0x4d8580(0x1c6)]=_0x4afef5;}),_0x1171cb[_0x4601c2(0x1fa)]((_0x4d0e3e,_0x53489e)=>{var _0x373989=_0x4601c2;_0x2a1dbe[_0x53489e][_0x373989(0x196)]=_0x4d0e3e;}),_0x4ea2fd[_0x4601c2(0x1fa)]((_0x518796,_0x43d495)=>{var _0x479781=_0x4601c2;_0x2a1dbe[_0x43d495][_0x479781(0x1fe)]=_0x518796;}),_0x595768[_0x4601c2(0x1fa)]((_0xd7f28b,_0x4a2e46)=>{var _0x5eacd7=_0x4601c2;_0x2a1dbe[_0x4a2e46][_0x5eacd7(0x187)]=_0xd7f28b;}),_0x4e6d6b[_0x4601c2(0x1fa)]((_0x552822,_0x3bdac1)=>{var _0x231747=_0x4601c2;_0x2a1dbe[_0x3bdac1][_0x231747(0x18a)]=_0x552822;}),_0x538ee7[_0x4601c2(0x1fa)]((_0x9787ea,_0x4032e6)=>{var _0x54386e=_0x4601c2;_0x2a1dbe[_0x4032e6][_0x54386e(0x177)]=_0x9787ea;}),_0x3c8046[_0x4601c2(0x1fa)]((_0x1c9de5,_0x597e8b)=>{var _0x286f19=_0x4601c2;_0x2a1dbe[_0x597e8b][_0x286f19(0x20d)]=_0x1c9de5;}),_0x469e8b[_0x4601c2(0x1fa)]((_0x17314e,_0x343768)=>{var _0x565c7a=_0x4601c2;_0x2a1dbe[_0x343768][_0x565c7a(0x220)]=_0x17314e;}),_0x5b53b1['product']['forEach'](_0x2bbd29=>{var _0x4b566a=_0x4601c2;const _0x4490dd=_0x50be30[_0x4b566a(0x18e)][_0x4b566a(0x186)](_0x2742c1=>{var _0x410c0f=_0x4b566a;_0x2742c1[_0x410c0f(0x214)]==_0x2bbd29[_0x410c0f(0x214)]&&_0x2742c1[_0x410c0f(0x187)]==_0x2bbd29['floorlevel']&&_0x2742c1[_0x410c0f(0x18a)]==_0x2bbd29[_0x410c0f(0x18a)]&&_0x2742c1[_0x410c0f(0x1fe)]==_0x2bbd29['bin']&&_0x2742c1[_0x410c0f(0x196)]==_0x2bbd29[_0x410c0f(0x196)]&&_0x2742c1[_0x410c0f(0x26a)]==_0x2bbd29['rack']&&_0x2742c1['storage']==_0x2bbd29[_0x410c0f(0x1fc)]&&(console[_0x410c0f(0x16d)](parseInt(_0x2742c1[_0x410c0f(0x17c)])+_0x410c0f(0x200)+parseInt(_0x2bbd29[_0x410c0f(0x244)])),_0x2742c1[_0x410c0f(0x17c)]=parseInt(_0x2742c1[_0x410c0f(0x17c)])+parseInt(_0x2bbd29[_0x410c0f(0x244)]));});}),await _0x50be30[_0x4601c2(0x22a)]();const _0x134c35=_0x2a1dbe['filter'](_0x15dce7=>_0x15dce7[_0x4601c2(0x1c6)]!=='0'&&_0x15dce7['return_qty']!=='');var _0x3b7049=0x0;_0x134c35[_0x4601c2(0x1fa)](_0x171dbc=>{var _0x5b16ea=_0x4601c2;console[_0x5b16ea(0x16d)](_0x5b16ea(0x165),_0x171dbc),(parseInt(_0x171dbc[_0x5b16ea(0x18b)])<parseInt(_0x171dbc[_0x5b16ea(0x1c6)])||parseInt(_0x171dbc['stock_quantity'])<parseInt(_0x171dbc['return_qty']))&&_0x3b7049++;});if(_0x3b7049!=0x0)return _0x66be1['flash'](_0x4601c2(0x1f7),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x395191[_0x4601c2(0x20b)]('back');const _0x460a87=new purchases_return({'invoice':_0x22a181,'suppliers':_0x66be1[_0x4601c2(0x1b7)][_0x4601c2(0x23f)],'date':_0x21ca38,'warehouse_name':_0xcff80e,'return_product':_0x134c35,'note':_0x4f26f9,'room':_0x18a51f,'to_warehouse_name':_0x42df63,'to_room':_0x19a7e0}),_0x8133d5=await _0x460a87[_0x4601c2(0x22a)]();console[_0x4601c2(0x16d)](_0x460a87);const _0x305461=await purchases_return[_0x4601c2(0x199)]({'invoice':_0x22a181}),_0x4165e8=await warehouse[_0x4601c2(0x199)]({'name':_0x42df63,'room':_0x19a7e0});_0x305461[_0x4601c2(0x17a)][_0x4601c2(0x1fa)](_0x24a0c8=>{var _0x4400b9=_0x4601c2,_0x3e31dc=0x0;const _0x241f75=_0x4165e8[_0x4400b9(0x18e)][_0x4400b9(0x186)](_0xf737cb=>{var _0x74a63c=_0x4400b9;_0xf737cb['product_name']==_0x24a0c8['product_name']&&_0xf737cb[_0x74a63c(0x187)]==_0x24a0c8[_0x74a63c(0x187)]&&_0xf737cb[_0x74a63c(0x18a)]==_0x24a0c8[_0x74a63c(0x18a)]&&_0xf737cb[_0x74a63c(0x1fe)]==_0x24a0c8[_0x74a63c(0x1fe)]&&_0xf737cb[_0x74a63c(0x196)]==_0x24a0c8['bay']&&(_0xf737cb[_0x74a63c(0x17c)]=parseInt(_0xf737cb[_0x74a63c(0x17c)])-parseInt(_0x24a0c8[_0x74a63c(0x1c6)]),_0x3e31dc++);});_0x3e31dc=='0'&&(_0x4165e8['product_details']=_0x4165e8['product_details'][_0x4400b9(0x183)]({'product_name':_0x24a0c8[_0x4400b9(0x214)],'product_stock':_0x24a0c8[_0x4400b9(0x1c6)],'primary_code':_0x24a0c8[_0x4400b9(0x20d)],'secondary_code':_0x24a0c8[_0x4400b9(0x220)],'product_code':_0x24a0c8['product_code'],'storage':_0x24a0c8['storage'],'rack':_0x24a0c8[_0x4400b9(0x26a)],'bay':_0x24a0c8['bay'],'bin':_0x24a0c8[_0x4400b9(0x1fe)],'type':_0x24a0c8[_0x4400b9(0x18a)],'floorlevel':_0x24a0c8['floorlevel'],'maxProducts':_0x24a0c8[_0x4400b9(0x20f)],'unit':_0x24a0c8[_0x4400b9(0x263)],'secondary_unit':_0x24a0c8[_0x4400b9(0x1af)],'expiry_date':_0x24a0c8[_0x4400b9(0x191)]}));}),await _0x4165e8[_0x4601c2(0x22a)]();const _0x3f4dfd=await purchases[_0x4601c2(0x199)]({'invoice':_0x22a181});_0x3f4dfd[_0x4601c2(0x1c1)]='True';const _0x462c2e=await _0x3f4dfd[_0x4601c2(0x22a)](),_0x504890=new s_payment_data({'invoice':_0x22a181,'suppliers':_0x66be1[_0x4601c2(0x1b7)]['suppliers'],'reason':'Purchase\x20Return'});await _0x504890[_0x4601c2(0x22a)]();const _0x211dda=await master_shop['find']();console['log'](_0x4601c2(0x246),_0x211dda[0x0]['image']);const _0x429c58=await email_settings[_0x4601c2(0x199)](),_0x183761=await suppliers[_0x4601c2(0x199)]({'name':_0x66be1[_0x4601c2(0x1b7)]['suppliers']});console[_0x4601c2(0x16d)](_0x4601c2(0x1d4),_0x183761);_0x211dda[0x0]['currency_placement']==0x1?(right_currency=_0x211dda[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x211dda[0x0][_0x4601c2(0x1fd)]);var _0x5bed54=_0x2b263c,_0x5ece3a=_0x117f2f,_0xa873b2='',_0x175667;for(_0x175667 in _0x5bed54){_0xa873b2+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5bed54[_0x175667]+_0x4601c2(0x25d)+_0x4601c2(0x267)+_0x5ece3a[_0x175667]+_0x4601c2(0x25d)+'</tr>';}console[_0x4601c2(0x16d)](_0x4601c2(0x245),_0xa873b2);let _0xf5f65e=nodemailer['createTransport']({'service':_0x4601c2(0x278),'auth':{'user':_0x429c58[_0x4601c2(0x1c0)],'pass':_0x429c58[_0x4601c2(0x188)]}}),_0x5e3fa1={'from':_0x429c58[_0x4601c2(0x1c0)],'to':_0x183761[_0x4601c2(0x1c0)],'subject':_0x4601c2(0x249),'attachments':[{'filename':_0x4601c2(0x193),'path':__dirname+_0x4601c2(0x23e)+_0x4601c2(0x166)+_0x211dda[0x0]['image'],'cid':_0x4601c2(0x229)}],'html':'<!DOCTYPE\x20html>'+_0x4601c2(0x24f)+_0x4601c2(0x231)+'<div>'+_0x4601c2(0x1b1)+_0x4601c2(0x25e)+_0x4601c2(0x206)+'</div>'+_0x4601c2(0x25e)+_0x4601c2(0x226)+_0x211dda[0x0][_0x4601c2(0x1d8)]+_0x4601c2(0x173)+_0x4601c2(0x1c3)+'</div>'+_0x4601c2(0x164)+'<div>'+_0x4601c2(0x1d0)+'\x20Order\x20Number\x20:\x20'+_0x22a181+'\x20'+_0x4601c2(0x1f4)+_0x4601c2(0x16c)+_0x21ca38+'\x20'+_0x4601c2(0x265)+_0x4601c2(0x243)+'</div>'+_0x4601c2(0x239)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4601c2(0x169)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x4601c2(0x1ba)+_0x4601c2(0x182)+_0x4601c2(0x212)+_0x4601c2(0x167)+'</thead>'+_0x4601c2(0x213)+'\x20'+_0xa873b2+'\x20'+'</tbody>'+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x4601c2(0x189)+_0x211dda[0x0][_0x4601c2(0x1d8)]+'</h5>'+_0x4601c2(0x1c3)+_0x4601c2(0x1c3)+'</body></html>'};_0xf5f65e[_0x4601c2(0x174)](_0x5e3fa1,function(_0x5c3275,_0x5d745d){var _0x3c60d4=_0x4601c2;_0x5c3275?(console[_0x3c60d4(0x16d)](_0x5c3275),console['log']('Error\x20Occurs')):console[_0x3c60d4(0x16d)](_0x3c60d4(0x176));}),_0x66be1[_0x4601c2(0x171)](_0x4601c2(0x17d),_0x4601c2(0x241)),_0x395191['redirect']('/all_purchases/view');}catch(_0x3fe83a){console[_0x4601c2(0x16d)](_0x3fe83a),_0x395191['status'](0xc8)[_0x4601c2(0x1b2)]({'message':_0x3fe83a[_0x4601c2(0x1d2)]});}}),router[a0_0x4eccf9(0x269)](a0_0x4eccf9(0x25b),auth,async(_0x5ea865,_0x27647e)=>{var _0x1f07b5=a0_0x4eccf9;try{const {username:_0x8e5597,email:_0x27f7e5,role:_0x51b859}=_0x5ea865[_0x1f07b5(0x23c)],_0x1b36af=_0x5ea865['user'],_0x9b1fdb=await profile['findOne']({'email':_0x1b36af[_0x1f07b5(0x1c0)]}),_0x1bf41a=await master_shop[_0x1f07b5(0x163)](),_0x457900=_0x5ea865[_0x1f07b5(0x1a4)]['id'],_0x7d9340=await purchases[_0x1f07b5(0x228)](_0x457900);if(_0x1bf41a[0x0][_0x1f07b5(0x17b)]==_0x1f07b5(0x22d))var _0x421da8=users[_0x1f07b5(0x190)];else{if(_0x1bf41a[0x0][_0x1f07b5(0x17b)]==_0x1f07b5(0x1ac))var _0x421da8=users[_0x1f07b5(0x1ac)];else{if(_0x1bf41a[0x0][_0x1f07b5(0x17b)]==_0x1f07b5(0x273))var _0x421da8=users[_0x1f07b5(0x273)];else{if(_0x1bf41a[0x0]['language']==_0x1f07b5(0x262))var _0x421da8=users[_0x1f07b5(0x262)];else{if(_0x1bf41a[0x0][_0x1f07b5(0x17b)]==_0x1f07b5(0x1ce))var _0x421da8=users[_0x1f07b5(0x1ce)];else{if(_0x1bf41a[0x0]['language']==_0x1f07b5(0x20e))var _0x421da8=users[_0x1f07b5(0x248)];else{if(_0x1bf41a[0x0][_0x1f07b5(0x17b)]=='Chinese')var _0x421da8=users[_0x1f07b5(0x1ed)];else{if(_0x1bf41a[0x0][_0x1f07b5(0x17b)]==_0x1f07b5(0x1a0))var _0x421da8=users['Arabic'];}}}}}}}_0x27647e[_0x1f07b5(0x198)](_0x1f07b5(0x185),{'success':_0x5ea865['flash']('success'),'errors':_0x5ea865[_0x1f07b5(0x171)](_0x1f07b5(0x1f7)),'role':_0x1b36af,'profile':_0x9b1fdb,'alldata':_0x7d9340,'master_shop':_0x1bf41a,'language':_0x421da8}),console[_0x1f07b5(0x16d)](alldata);}catch(_0x40c705){console['log'](_0x40c705);}}),router[a0_0x4eccf9(0x24e)]('/barcode_scanner',async(_0x39a681,_0x4c15f2)=>{var _0x29d40b=a0_0x4eccf9;const {product_code:_0x2c5299}=_0x39a681[_0x29d40b(0x1b7)];var _0x3ebfde;const _0x43bec9=await product[_0x29d40b(0x1e7)]([{'$match':{'primary_code':_0x2c5299,'product_category':_0x29d40b(0x184)}},{'$group':{'_id':_0x29d40b(0x1e0),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x29d40b(0x1e4)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x29d40b(0x1d7)},'secondary_code':{'$first':_0x29d40b(0x1bf)},'maxStocks':{'$first':_0x29d40b(0x1bd)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x29d40b(0x247)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3b4c60=await product[_0x29d40b(0x1e7)]([{'$match':{'secondary_code':_0x2c5299,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x29d40b(0x264)},'category':{'$first':'$category'},'brand':{'$first':_0x29d40b(0x1e4)},'unit':{'$first':_0x29d40b(0x1c2)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x29d40b(0x194)},'primary_code':{'$first':_0x29d40b(0x1d7)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x29d40b(0x1bd)},'maxProdPerUnit':{'$first':_0x29d40b(0x1a9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x29d40b(0x247)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x43bec9[_0x29d40b(0x172)]>0x0)_0x3ebfde=_0x43bec9;else _0x3b4c60[_0x29d40b(0x172)]>0x0&&(_0x3ebfde=_0x3b4c60);_0x4c15f2[_0x29d40b(0x1b2)](_0x3ebfde);}),router[a0_0x4eccf9(0x24e)](a0_0x4eccf9(0x215),async(_0x314ea2,_0x557860)=>{var _0x9a1321=a0_0x4eccf9;const {primaryCode:_0x357fe8,secondaryCode:_0x3c6d88,productCode:_0x559aba,bay:_0xc83db3,bin:_0x29aeac,types:_0x471217,pallet:_0x61f24b,warehouses:_0x4b8530,room:_0x1c6f8f}=_0x314ea2[_0x9a1321(0x1b7)];console['log'](_0x314ea2[_0x9a1321(0x1b7)]);try{const _0x2f8685=await warehouse[_0x9a1321(0x1e7)]([{'$match':{'name':_0x4b8530,'room':_0x1c6f8f}},{'$unwind':_0x9a1321(0x19a)},{'$match':{'product_details.bay':_0xc83db3,'product_details.bin':_0x29aeac,'product_details.type':_0x471217}},{'$group':{'_id':_0x9a1321(0x1ab),'name':{'$first':_0x9a1321(0x1cc)},'product_stock':{'$first':_0x9a1321(0x1d6)},'level':{'$first':_0x9a1321(0x1be)},'isle':{'$first':_0x9a1321(0x1ca)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x557860['status'](0xc8)[_0x9a1321(0x1b2)](_0x2f8685);}catch(_0x6cec63){_0x557860[_0x9a1321(0x209)](0x194)[_0x9a1321(0x1b2)]({'message':_0x6cec63[_0x9a1321(0x1d2)]});}}),module[a0_0x4eccf9(0x24c)]=router;