var a0_0x48bae8=a0_0x1c90;(function(_0x1b0e89,_0x3a9a07){var _0x17c8be=a0_0x1c90,_0x1715f2=_0x1b0e89();while(!![]){try{var _0x31cf61=-parseInt(_0x17c8be(0x148))/0x1+-parseInt(_0x17c8be(0x135))/0x2*(-parseInt(_0x17c8be(0x1fa))/0x3)+parseInt(_0x17c8be(0x183))/0x4+parseInt(_0x17c8be(0x1c7))/0x5*(parseInt(_0x17c8be(0x12e))/0x6)+-parseInt(_0x17c8be(0x1f1))/0x7*(parseInt(_0x17c8be(0x156))/0x8)+-parseInt(_0x17c8be(0x223))/0x9*(-parseInt(_0x17c8be(0x23e))/0xa)+-parseInt(_0x17c8be(0x1ce))/0xb*(parseInt(_0x17c8be(0x16e))/0xc);if(_0x31cf61===_0x3a9a07)break;else _0x1715f2['push'](_0x1715f2['shift']());}catch(_0x5975a0){_0x1715f2['push'](_0x1715f2['shift']());}}}(a0_0x3d7b,0x2ad99));const express=require('express'),app=express(),router=express[a0_0x48bae8(0x18d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x48bae8(0x1e8)),auth=require(a0_0x48bae8(0x14a)),nodemailer=require('nodemailer');var ejs=require('ejs');function a0_0x3d7b(){var _0x135d0e=['$_id','here','password','$product.quantity','Purchase\x20data\x20added\x20successfully','sendMail','$invoice','Spanish','/all_purchases/view','8ftlswR','user_id','/view/:id','$batch_code','room','purchase_quantity','English\x20(US)','$product_details.storage','<!DOCTYPE\x20html>','json','primary_code_hide','amount','<div>','$product_details.primary_code','status','RoomAssign','types','secondary_code_hide','$expiry_date','$brand','/view/return_purchase/:id','$product_details.secondary_code','add_purchases','actual_uom','56976kuMoCL','due_amount','/upload/','email','Shelves','note','all_purchases_barcode','payment\x20successfull','product_code_hide','master','$primary_code','max_product_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','findOne','prod_unit','</tbody>','Portuguese\x20(BR)','padStart','random','Chinese','secondary_unit','1137876XkECYV','$secondary_unit','finalize','Purchase\x20Return','</thead>','$product_details.bin','site_title','user','$product_details.level','suppliers_data','Router','delivery_code','Hindi','exports','$product','purchase_invoice','quantity','$date','primary_code','log','getMonth','Portuguese','$product_details.expiry_date','../public/language/languages.json','COLD\x20STORAGE','maxStocks','True','$suppliers','product_details','get','Arabic','standard_unit','$unit','paid_amount','gmail','delivery_date','add_purchases\x20error','$product_code','prod_secondunit','/view/add_purchases','/all_purchases/view/','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','rack','batch_code','/CheckingWarehouse','German','add\x20post','<tr>','expiry_date','stocks','all_purchases','Raw\x20Materials','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','staff','$paid_amount','product_name','image','level','maxperunit','<hr\x20class=\x22my-3\x22>','French','storage','getDate','port','$room','Error\x20Occurs','5TsTGaT','product_code','currency','isle','$product_details.maxProducts','push','secondary_code','693xsucqE','/invoice/:id','findById','$category','/../public','Enclosed','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','warehouse_name','suppliers_docs','$product_details.bay','$product_details.product_stock','deliverycode','/barcode_scanner','production_date','error','return_product','logo','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchase\x20data\x20update\x20successfully','$return_data','Purchase\x20Return\x20Mail','$alertquantity','invoice','prod_invoice','then','$product.bin','../models/all_models','suppliers','</div>','map','prod_name','product_stock','prod_level','room_name','find','2432297fomZSX','DRY\x20STORAGE','purchases\x20item\x20return\x20successfull','filter','createTransport','return_qty','return_data','Rack\x20B','actual_qty','96573IegQod','length','</head><body>','$product_details.product_code','Ambient','prod_qty','name','</body></html>','$product_details.rack','MaxStocks_data','string','role','product_cat','type','pallet','Rack\x20E','\x20</h2>','$product_details.isle','\x20Order\x20Number\x20:\x20','redirect','<strong>\x20Regards\x20</strong>','prod_code','Return\x20Goods','params','Arabic\x20(ae)','product','warehouse','</h5>','edit_purchases','Purchase\x20Mail','slice','Enabled','save','prod_Qty','<h5>','concat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','</table>','$product_details.floorlevel','$maxProdPerUnit','$warehouse_name','9wHRwZy','Receiving\x20Area','prod_pallet','success','flash','post','all','\x20Order\x20Date\x20:\x20','$suppliers_docs','<h2>\x20','$note','path','$product.type','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Level','stock_data','Rack\x20D','INC-','$name','<tbody\x20style=\x22text-align:\x20center;\x22>','/view','\x20<>\x20','</td>','</span>','return_purchase','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','1382560rhONOc','forEach','/preview/:id','stock_quantity','</tr>','date','Rack\x20A','bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Floor','$secondary_code','prod_isle','floorlevel','/view/add_purchases/:id','1336488gIOSVh','body','getFullYear','prod_cat','floor','$product_details._id','<h5\x20style=\x22text-align:\x20left;\x22>','18cNFDbh','aggregate','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$maxStocks','render','alertQTY','Email\x20sent\x20successfully','abs','/barcode/:id','$product_details.product_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','language','<span\x20style=\x22float:\x20right;\x22>','$product.bay','catch','bay','/give_payment/:id','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','113084gFYQwV','message','../middleware/auth','errors','$product.floorlevel'];a0_0x3d7b=function(){return _0x135d0e;};return a0_0x3d7b();}function a0_0x1c90(_0x273bc4,_0xdd69b4){var _0x3d7b10=a0_0x3d7b();return a0_0x1c90=function(_0x1c907c,_0x20fd02){_0x1c907c=_0x1c907c-0x124;var _0x3a9165=_0x3d7b10[_0x1c907c];return _0x3a9165;},a0_0x1c90(_0x273bc4,_0xdd69b4);}const path=require(a0_0x48bae8(0x22e)),users=require(a0_0x48bae8(0x19a));router[a0_0x48bae8(0x1a0)](a0_0x48bae8(0x237),auth,async(_0x5ed070,_0x2e0bf1)=>{var _0x3c20a1=a0_0x48bae8;try{const {username:_0x52f687,email:_0x2337c8,role:_0x71db64}=_0x5ed070[_0x3c20a1(0x18a)],_0xa6e691=_0x5ed070['user'],_0x54256c=await profile['findOne']({'email':_0xa6e691[_0x3c20a1(0x171)]}),_0x235c98=await staff['findOne']({'email':_0xa6e691[_0x3c20a1(0x171)]});if(_0xa6e691[_0x3c20a1(0x205)]=='staff'){const _0xbeb418=await staff[_0x3c20a1(0x17b)]({'email':_0xa6e691[_0x3c20a1(0x171)]});}const _0x49b406=await master_shop[_0x3c20a1(0x1f0)]();let _0x5ddfe5;if(_0xa6e691[_0x3c20a1(0x205)]==_0x3c20a1(0x1ba)){const _0x771f28=await staff[_0x3c20a1(0x17b)]({'email':_0xa6e691[_0x3c20a1(0x171)]});_0x5ddfe5=await purchases[_0x3c20a1(0x136)]([{'$match':{'warehouse_name':_0x771f28['warehouse']}},{'$lookup':{'from':_0x3c20a1(0x1e9),'localField':_0x3c20a1(0x1e9),'foreignField':'name','as':_0x3c20a1(0x1d6)}},{'$unwind':_0x3c20a1(0x22b)},{'$unwind':_0x3c20a1(0x191)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x3c20a1(0x19e)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x3c20a1(0x222)},'room':{'$first':_0x3c20a1(0x1c5)},'product':{'$push':_0x3c20a1(0x191)},'note':{'$first':_0x3c20a1(0x22d)},'paid_amount':{'$first':_0x3c20a1(0x1bb)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3c20a1(0x1e1)},'batch_code':{'$first':_0x3c20a1(0x159)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x3c20a1(0x150)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3c20a1(0x1e7)},'type':{'$addToSet':_0x3c20a1(0x22f)},'floorlevel':{'$addToSet':_0x3c20a1(0x14c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5ddfe5=await purchases['aggregate']([{'$lookup':{'from':_0x3c20a1(0x1e9),'localField':_0x3c20a1(0x1e9),'foreignField':_0x3c20a1(0x200),'as':'suppliers_docs'}},{'$unwind':_0x3c20a1(0x22b)},{'$unwind':'$product'},{'$group':{'_id':_0x3c20a1(0x14d),'invoice':{'$first':_0x3c20a1(0x153)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3c20a1(0x194)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3c20a1(0x191)},'note':{'$first':_0x3c20a1(0x22d)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3c20a1(0x1e1)},'batch_code':{'$first':_0x3c20a1(0x159)},'expiry_date':{'$first':_0x3c20a1(0x168)},'suppliers_docs':{'$first':_0x3c20a1(0x22b)},'total_product_quantity':{'$sum':_0x3c20a1(0x150)},'level':{'$addToSet':_0x3c20a1(0x143)},'isle':{'$addToSet':_0x3c20a1(0x1e7)},'type':{'$addToSet':_0x3c20a1(0x22f)},'floorlevel':{'$addToSet':_0x3c20a1(0x14c)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x49b406[0x0][_0x3c20a1(0x141)]==_0x3c20a1(0x15c)){var _0x231ff7=users[_0x3c20a1(0x1ac)];console['log'](_0x231ff7);}else{if(_0x49b406[0x0]['language']==_0x3c20a1(0x18f))var _0x231ff7=users[_0x3c20a1(0x18f)];else{if(_0x49b406[0x0][_0x3c20a1(0x141)]==_0x3c20a1(0x1b1))var _0x231ff7=users[_0x3c20a1(0x1b1)];else{if(_0x49b406[0x0][_0x3c20a1(0x141)]=='Spanish')var _0x231ff7=users[_0x3c20a1(0x154)];else{if(_0x49b406[0x0][_0x3c20a1(0x141)]==_0x3c20a1(0x1c1))var _0x231ff7=users[_0x3c20a1(0x1c1)];else{if(_0x49b406[0x0][_0x3c20a1(0x141)]==_0x3c20a1(0x17e))var _0x231ff7=users[_0x3c20a1(0x198)];else{if(_0x49b406[0x0][_0x3c20a1(0x141)]==_0x3c20a1(0x181))var _0x231ff7=users[_0x3c20a1(0x181)];else{if(_0x49b406[0x0]['language']==_0x3c20a1(0x212))var _0x231ff7=users[_0x3c20a1(0x1a1)];}}}}}}}_0x2e0bf1[_0x3c20a1(0x139)](_0x3c20a1(0x1b6),{'success':_0x5ed070['flash'](_0x3c20a1(0x226)),'errors':_0x5ed070['flash']('errors'),'purchases':_0x5ddfe5,'role':_0xa6e691,'profile':_0x54256c,'master_shop':_0x49b406,'language':_0x231ff7});}catch(_0xffa3b0){console[_0x3c20a1(0x196)]('table\x20page',_0xffa3b0),_0x2e0bf1[_0x3c20a1(0x164)](0xc8)[_0x3c20a1(0x15f)]({'message':_0xffa3b0['message']});}});function BayBinSelected(_0x76cc3a,_0x2773bc){var _0x39c32c=a0_0x48bae8,_0x5e4dc0=[],_0x94315a=[],_0x36b7f3=[],_0x4e3a3c=[],_0x52f9ca=[],_0x440aff=[];let _0x5e2a9f=[];if(_0x76cc3a==_0x39c32c(0x1f2))switch(_0x2773bc){case _0x39c32c(0x126):_0x5e4dc0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x94315a=[0x1,0x2],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=[_0x39c32c(0x231),_0x39c32c(0x129)],_0x52f9ca=['D'],_0x440aff=['A'];break;case _0x39c32c(0x1f8):_0x5e4dc0=[0x6,0x5,0x4,0x3,0x2,0x1],_0x94315a=[0x1,0x2],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=[_0x39c32c(0x231),'Floor'],_0x52f9ca=['D'],_0x440aff=['B'];break;case _0x39c32c(0x172):_0x5e4dc0=[0x0],_0x94315a=[0x0],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=['Floor'],_0x52f9ca=['D'],_0x440aff=['S'];break;case _0x39c32c(0x224):_0x5e4dc0=[0x0],_0x94315a=[0x0],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x36b7f3=[_0x39c32c(0x129)],_0x52f9ca=['D'],_0x440aff=['R'];break;}else{if(_0x76cc3a==_0x39c32c(0x19b))switch(_0x2773bc){case _0x39c32c(0x126):_0x5e4dc0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x94315a=['B','F'],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=[_0x39c32c(0x231),_0x39c32c(0x129)],_0x52f9ca=['C'],_0x440aff=['A'];break;case _0x39c32c(0x1f8):_0x5e4dc0=[0x5,0x4,0x3,0x2,0x1],_0x94315a=['F','B','S'],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=['Level',_0x39c32c(0x129)],_0x52f9ca=['C'],_0x440aff=['B'];break;case'Rack\x20C':_0x5e4dc0=[0x1,0x2,0x3,0x4,0x5],_0x94315a=['B','F','S'],_0x4e3a3c=[0x5,0x4,0x3,0x2,0x1],_0x36b7f3=[_0x39c32c(0x231),_0x39c32c(0x129)],_0x52f9ca=['C'],_0x440aff=['C'];break;case _0x39c32c(0x233):_0x5e4dc0=[0x5,0x4,0x3,0x2,0x1],_0x94315a=['F','B','S'],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=['Level','Floor'],_0x52f9ca=['C'],_0x440aff=['D'];break;case _0x39c32c(0x209):_0x5e4dc0=[0x4,0x3,0x2,0x1],_0x94315a=[0x1,0x2],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=[_0x39c32c(0x231),'Floor'],_0x52f9ca=['C'],_0x440aff=['E'];break;case'Rack\x20F':_0x5e4dc0=[0x1,0x2,0x3],_0x94315a=[0x1,0x2],_0x4e3a3c=[0x1,0x2,0x3,0x4,0x5],_0x36b7f3=[_0x39c32c(0x231)],_0x52f9ca=['C'],_0x440aff=['F'];break;}}return{'levels':_0x5e4dc0,'Isle':_0x94315a,'rack':_0x4e3a3c,'type':_0x36b7f3,'storage':_0x52f9ca,'rak':_0x440aff};}async function getRandom8DigitNumber(){var _0x5abe05=a0_0x48bae8;const _0x488bca=0x989680,_0x5ce27d=0x5f5e0ff,_0x59efa9=Math[_0x5abe05(0x132)](Math[_0x5abe05(0x180)]()*(_0x5ce27d-_0x488bca+0x1))+_0x488bca;var _0x3dae26;const _0x14da7d=await purchases[_0x5abe05(0x17b)]({'invoice':'INC-'+_0x59efa9});return _0x14da7d&&_0x14da7d['length']>0x0?_0x3dae26=_0x5abe05(0x234)+_0x59efa9:_0x3dae26=_0x5abe05(0x234)+_0x59efa9,_0x3dae26;}router[a0_0x48bae8(0x1a0)](a0_0x48bae8(0x1aa),auth,async(_0x1737a0,_0x27e443)=>{var _0x3ac6ea=a0_0x48bae8;try{const {username:_0x213f60,email:_0x3b8bd9,role:_0x377201}=_0x1737a0['user'],_0x58c22f=_0x1737a0[_0x3ac6ea(0x18a)],_0x594ae2=await profile[_0x3ac6ea(0x17b)]({'email':_0x58c22f[_0x3ac6ea(0x171)]}),_0x202b7b=await master_shop[_0x3ac6ea(0x1f0)](),_0x4aa448=await staff[_0x3ac6ea(0x17b)]({'email':_0x58c22f[_0x3ac6ea(0x171)]}),_0x56e556=await suppliers[_0x3ac6ea(0x1f0)]({});let _0x51274e;if(_0x58c22f[_0x3ac6ea(0x205)]==_0x3ac6ea(0x1ba)){const _0x119290=await staff[_0x3ac6ea(0x17b)]({'email':_0x58c22f[_0x3ac6ea(0x171)]});_0x51274e=await warehouse[_0x3ac6ea(0x136)]([{'$match':{'status':_0x3ac6ea(0x219),'name':_0x119290['warehouse'],'warehouse_category':_0x3ac6ea(0x1b7),'name':{'$ne':_0x3ac6ea(0x210)}}},{'$group':{'_id':_0x3ac6ea(0x235),'name':{'$first':_0x3ac6ea(0x235)}}}]);}else _0x51274e=await warehouse[_0x3ac6ea(0x136)]([{'$match':{'status':'Enabled','warehouse_category':_0x3ac6ea(0x1b7),'name':{'$ne':_0x3ac6ea(0x210)}}},{'$group':{'_id':_0x3ac6ea(0x235),'name':{'$first':_0x3ac6ea(0x235)}}}]);const _0x392403=await product['find']({}),_0x234259=await warehouse['find']({'status':'Enabled'}),_0x238c7e=await purchases[_0x3ac6ea(0x1f0)]({}),_0x3f8689=_0x238c7e[_0x3ac6ea(0x1fb)]+0x1,_0x4dbb51=_0x3ac6ea(0x234)+_0x3f8689['toString']()[_0x3ac6ea(0x17f)](0x5,'0');var _0x2a0e39=[_0x3ac6ea(0x1fe),_0x3ac6ea(0x1d3)];if(_0x202b7b[0x0][_0x3ac6ea(0x141)]=='English\x20(US)')var _0x51d375=users[_0x3ac6ea(0x1ac)];else{if(_0x202b7b[0x0]['language']==_0x3ac6ea(0x18f))var _0x51d375=users[_0x3ac6ea(0x18f)];else{if(_0x202b7b[0x0][_0x3ac6ea(0x141)]==_0x3ac6ea(0x1b1))var _0x51d375=users[_0x3ac6ea(0x1b1)];else{if(_0x202b7b[0x0][_0x3ac6ea(0x141)]==_0x3ac6ea(0x154))var _0x51d375=users[_0x3ac6ea(0x154)];else{if(_0x202b7b[0x0]['language']=='French')var _0x51d375=users[_0x3ac6ea(0x1c1)];else{if(_0x202b7b[0x0][_0x3ac6ea(0x141)]==_0x3ac6ea(0x17e))var _0x51d375=users[_0x3ac6ea(0x198)];else{if(_0x202b7b[0x0][_0x3ac6ea(0x141)]==_0x3ac6ea(0x181))var _0x51d375=users['Chinese'];else{if(_0x202b7b[0x0][_0x3ac6ea(0x141)]==_0x3ac6ea(0x212))var _0x51d375=users[_0x3ac6ea(0x1a1)];}}}}}}}const _0x44c151=getRandom8DigitNumber();_0x44c151[_0x3ac6ea(0x1e6)](_0x6ae14e=>{var _0x1ca1e8=_0x3ac6ea;_0x27e443[_0x1ca1e8(0x139)](_0x1ca1e8(0x16c),{'success':_0x1737a0['flash']('success'),'errors':_0x1737a0['flash'](_0x1ca1e8(0x14b)),'role':_0x58c22f,'profile':_0x594ae2,'suppliers':_0x56e556,'warehouse':_0x51274e,'product':_0x392403,'invoice':_0x6ae14e,'master_shop':_0x202b7b,'language':_0x51d375,'find_data':_0x234259,'rooms_data':_0x2a0e39});})[_0x3ac6ea(0x144)](_0x5d979e=>{var _0x5b856c=_0x3ac6ea;_0x1737a0[_0x5b856c(0x227)](_0x5b856c(0x14b),_0x5b856c(0x137)),_0x27e443['redirect'](_0x5b856c(0x155));});}catch(_0x4e2021){console[_0x3ac6ea(0x196)](_0x4e2021);}}),router['get'](a0_0x48bae8(0x12d),auth,async(_0x5ce92b,_0x43f308)=>{var _0x1b72e9=a0_0x48bae8;try{const _0x334e04=_0x5ce92b[_0x1b72e9(0x211)]['id'];console['log'](_0x334e04);const _0x1320aa=await master_shop[_0x1b72e9(0x1f0)]();console[_0x1b72e9(0x196)](_0x1b72e9(0x177),_0x1320aa);const _0x426aab=await product[_0x1b72e9(0x17b)]({'name':_0x334e04});console[_0x1b72e9(0x196)]('product',_0x426aab),_0x43f308[_0x1b72e9(0x164)](0xc8)['json']({'product_data':_0x426aab,'master':_0x1320aa});}catch(_0xda0776){console[_0x1b72e9(0x196)](_0x1b72e9(0x1a7),_0xda0776);}}),router[a0_0x48bae8(0x228)]('/view/add_purchases',auth,async(_0x1f573f,_0xf2a2aa)=>{var _0x255c2a=a0_0x48bae8;try{const {invoice:_0x2f2bc8,date:_0x41fee1,warehouse_name:_0x20f7c8,prod_name:_0x315a39,prod_code:_0x2a24fe,prod_qty:_0x3373db,prod_unit:_0x54c33b,prod_secondunit:_0x50c170,prod_level:_0x3bffed,prod_isle:_0x3eca09,prod_pallet:_0x20e4b7,note:_0x281ba9,expiry_date:_0x1c679b,batch_code:_0x3685b9,payable:_0x13dc2d,due_amount:_0x1b39e2,Room_name:_0x195e0c,primary_code:_0x3b2efa,secondary_code:_0x24b2d5,MaxStocks_data:_0x4346d2,PO_number:_0x14e093,SCRN:_0x2dba07,JO_number:_0x5124ab}=_0x1f573f[_0x255c2a(0x12f)];if(typeof _0x315a39=='string')var _0x2faab0=[_0x1f573f[_0x255c2a(0x12f)]['prod_name']],_0x3a687c=[_0x1f573f[_0x255c2a(0x12f)]['prod_code']],_0x8ac382=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x21b)]],_0x27423b=[_0x1f573f[_0x255c2a(0x12f)]['prod_primunit']],_0x4f5793=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1a9)]],_0x577787=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1ee)]],_0x72966e=[_0x1f573f['body'][_0x255c2a(0x195)]],_0x1f09be=[_0x1f573f[_0x255c2a(0x12f)]['secondary_code']],_0x57025f=[_0x1f573f['body'][_0x255c2a(0x203)]],_0x13d9c3=[_0x1f573f['body']['batch_code']],_0x298af6=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1b4)]],_0x3bc93b=[_0x1f573f['body']['max_product_unit']],_0x501485=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x13a)]],_0x347d14=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1db)]],_0x5d6733=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x131)]],_0x5e8af6=[_0x1f573f['body'][_0x255c2a(0x165)]],_0x1a64f5=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1d9)]],_0x24a106=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1e5)]],_0x28aff0=[_0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1f9)]],_0x4421d1=[_0x1f573f[_0x255c2a(0x12f)]['actual_uom']];else var _0x2faab0=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1ec)]],_0x3a687c=[..._0x1f573f['body']['prod_code']],_0x8ac382=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x21b)]],_0x27423b=[..._0x1f573f[_0x255c2a(0x12f)]['prod_primunit']],_0x4f5793=[..._0x1f573f['body']['prod_secondunit']],_0x577787=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1ee)]],_0x72966e=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x195)]],_0x1f09be=[..._0x1f573f['body'][_0x255c2a(0x1cd)]],_0x57025f=[..._0x1f573f['body'][_0x255c2a(0x203)]],_0x13d9c3=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1af)]],_0x298af6=[..._0x1f573f['body']['expiry_date']],_0x3bc93b=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x179)]],_0x501485=[..._0x1f573f['body'][_0x255c2a(0x13a)]],_0x347d14=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1db)]],_0x5d6733=[..._0x1f573f[_0x255c2a(0x12f)]['prod_cat']],_0x5e8af6=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x165)]],_0x1a64f5=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x1d9)]],_0x24a106=[..._0x1f573f['body'][_0x255c2a(0x1e5)]],_0x28aff0=[..._0x1f573f['body'][_0x255c2a(0x1f9)]],_0x4421d1=[..._0x1f573f[_0x255c2a(0x12f)][_0x255c2a(0x16d)]];const _0x42cf36=_0x2faab0['map'](_0x55ee7e=>{return _0x55ee7e={'product_name':_0x55ee7e};});_0x28aff0[_0x255c2a(0x23f)]((_0x4e0bcc,_0x4e68a1)=>{var _0x309ac5=_0x255c2a;_0x42cf36[_0x4e68a1][_0x309ac5(0x1f9)]=Math[_0x309ac5(0x13c)](_0x4e0bcc);}),_0x4421d1['forEach']((_0x5097e8,_0x5a21ee)=>{var _0x4591cc=_0x255c2a;_0x42cf36[_0x5a21ee][_0x4591cc(0x16d)]=_0x5097e8;}),_0x3a687c[_0x255c2a(0x23f)]((_0x621fbf,_0x2522d8)=>{var _0x34d10f=_0x255c2a;_0x42cf36[_0x2522d8][_0x34d10f(0x1c8)]=_0x621fbf;}),_0x8ac382[_0x255c2a(0x23f)]((_0xc2273c,_0x59f2f4)=>{var _0x4cc4cc=_0x255c2a;_0x42cf36[_0x59f2f4][_0x4cc4cc(0x193)]=Math[_0x4cc4cc(0x13c)](_0xc2273c);}),_0x27423b['forEach']((_0x435e39,_0x33b190)=>{var _0x2295dc=_0x255c2a;_0x42cf36[_0x33b190][_0x2295dc(0x1a2)]=_0x435e39;}),_0x4f5793['forEach']((_0xf05bf0,_0x44f443)=>{var _0x34622e=_0x255c2a;_0x42cf36[_0x44f443][_0x34622e(0x182)]=_0xf05bf0;}),_0x577787[_0x255c2a(0x23f)]((_0x5e3b5b,_0x1c2443)=>{var _0x47487c=_0x255c2a;_0x5e8af6[_0x47487c(0x23f)]((_0xa1c67,_0x35421c)=>{var _0x120e50=_0x47487c;if(_0xa1c67==_0x120e50(0x224)&&_0x1c2443==_0x35421c){console[_0x120e50(0x196)](_0xa1c67+'\x20<\x20wew\x20>\x20'+_0x1c2443+'\x20<>\x20'+_0x35421c+_0x120e50(0x238)+_0x5e3b5b);var _0x42570f=_0x5e3b5b[_0x120e50(0x218)](0x3);_0x42cf36[_0x1c2443]['storage']=_0x5e3b5b[0x0],_0x42cf36[_0x1c2443][_0x120e50(0x1ae)]=_0x5e3b5b[0x1],_0x42cf36[_0x1c2443][_0x120e50(0x145)]=0x0,_0x42cf36[_0x1c2443][_0x120e50(0x127)]=0x0,_0x42cf36[_0x1c2443]['type']=_0x120e50(0x129),_0x42cf36[_0x1c2443][_0x120e50(0x12c)]=_0x42570f;}else{if(_0xa1c67==_0x120e50(0x172)&&_0x1c2443==_0x35421c){var _0x42570f=_0x5e3b5b[_0x120e50(0x218)](0x3);_0x42cf36[_0x1c2443][_0x120e50(0x1c2)]=_0x5e3b5b[0x0],_0x42cf36[_0x1c2443][_0x120e50(0x1ae)]=_0x5e3b5b[0x1],_0x42cf36[_0x1c2443][_0x120e50(0x145)]=0x0,_0x42cf36[_0x1c2443]['bin']=0x0,_0x42cf36[_0x1c2443][_0x120e50(0x207)]=_0x120e50(0x129),_0x42cf36[_0x1c2443][_0x120e50(0x12c)]=_0x5e3b5b[0x5];}else{if(_0x1c2443==_0x35421c){if(_0x5e3b5b[0x0]=='A'&&_0x5e3b5b[0x1]=='L'&&_0x5e3b5b[0x2]=='L')console[_0x120e50(0x196)](_0xa1c67+_0x120e50(0x238)+_0x1c2443+'\x20<>\x20'+_0x35421c+_0x120e50(0x238)+_0x5e3b5b+_0x120e50(0x14e)),_0x42cf36[_0x1c2443][_0x120e50(0x1c2)]=_0x5e3b5b[0x0],_0x42cf36[_0x1c2443][_0x120e50(0x1ae)]=_0x5e3b5b[0x1],_0x42cf36[_0x1c2443][_0x120e50(0x145)]=0x0,_0x42cf36[_0x1c2443][_0x120e50(0x127)]=0x0,_0x42cf36[_0x1c2443][_0x120e50(0x207)]=_0x120e50(0x129),_0x42cf36[_0x1c2443][_0x120e50(0x12c)]=_0x5e3b5b[0x3];else{var _0x4bc117;if(_0x5e3b5b[0x4]=='L')_0x4bc117=_0x120e50(0x231);else _0x5e3b5b[0x4]=='F'&&(_0x4bc117=_0x120e50(0x129));_0x42cf36[_0x1c2443][_0x120e50(0x1c2)]=_0x5e3b5b[0x0],_0x42cf36[_0x1c2443][_0x120e50(0x1ae)]=_0x5e3b5b[0x1],_0x42cf36[_0x1c2443]['bay']=_0x5e3b5b[0x2],_0x42cf36[_0x1c2443][_0x120e50(0x127)]=_0x5e3b5b[0x3],_0x42cf36[_0x1c2443]['type']=_0x4bc117,_0x42cf36[_0x1c2443][_0x120e50(0x12c)]=_0x5e3b5b[0x5];}}}}});}),_0x72966e[_0x255c2a(0x23f)]((_0xd2f704,_0x1b8842)=>{var _0x325236=_0x255c2a;_0x42cf36[_0x1b8842][_0x325236(0x195)]=_0xd2f704;}),_0x1f09be[_0x255c2a(0x23f)]((_0x103520,_0x98ff35)=>{var _0x4f9c8a=_0x255c2a;_0x42cf36[_0x98ff35][_0x4f9c8a(0x1cd)]=_0x103520;}),_0x57025f[_0x255c2a(0x23f)]((_0x457342,_0x4a6ba0)=>{var _0x27d790=_0x255c2a;_0x42cf36[_0x4a6ba0][_0x27d790(0x19c)]=_0x457342;}),_0x13d9c3[_0x255c2a(0x23f)]((_0x18d0a1,_0x44ef23)=>{var _0x947788=_0x255c2a;_0x42cf36[_0x44ef23][_0x947788(0x1af)]=_0x18d0a1;}),_0x298af6[_0x255c2a(0x23f)]((_0x1ba0bd,_0x5cdd07)=>{var _0x18f6e8=_0x255c2a;_0x42cf36[_0x5cdd07][_0x18f6e8(0x1b4)]=_0x1ba0bd;}),_0x3bc93b['forEach']((_0x287435,_0x2a1bcb)=>{var _0x555f8e=_0x255c2a;_0x42cf36[_0x2a1bcb][_0x555f8e(0x1bf)]=_0x287435;}),_0x501485['forEach']((_0x3f6b0c,_0x21eb86)=>{var _0x2f114a=_0x255c2a;_0x42cf36[_0x21eb86][_0x2f114a(0x13a)]=_0x3f6b0c;}),_0x347d14[_0x255c2a(0x23f)]((_0x5f216b,_0x4bce14)=>{var _0x18c8d2=_0x255c2a;_0x42cf36[_0x4bce14][_0x18c8d2(0x1db)]=_0x5f216b;}),_0x5d6733[_0x255c2a(0x23f)]((_0x517d9c,_0x32d3cb)=>{_0x42cf36[_0x32d3cb]['product_cat']=_0x517d9c;}),_0x5e8af6[_0x255c2a(0x23f)]((_0x37eb8d,_0x24685d)=>{_0x42cf36[_0x24685d]['room_name']=_0x37eb8d;}),_0x1a64f5[_0x255c2a(0x23f)]((_0x4939f2,_0x4f5061)=>{var _0x56e151=_0x255c2a;_0x42cf36[_0x4f5061][_0x56e151(0x18e)]=_0x4939f2;}),_0x24a106[_0x255c2a(0x23f)]((_0x150ebb,_0x517b57)=>{var _0x1dd6cb=_0x255c2a;_0x42cf36[_0x517b57][_0x1dd6cb(0x1e4)]=_0x150ebb;});const _0x23d794=_0x5e8af6[_0x255c2a(0x1eb)](_0x1eccab=>{return _0x1eccab={'room_name':_0x1eccab};}),_0x1c1fc2=_0x42cf36[_0x255c2a(0x1f4)](_0x1807f5=>_0x1807f5[_0x255c2a(0x193)]!=='0'&&_0x1807f5[_0x255c2a(0x193)]!==''),_0x5b6a2f=new purchases({'invoice':_0x2f2bc8,'suppliers':_0x1f573f['body'][_0x255c2a(0x1e9)],'date':_0x41fee1,'warehouse_name':_0x20f7c8,'product':_0x1c1fc2,'note':_0x281ba9,'due_amount':_0x1b39e2,'POnumber':_0x14e093,'SCRN':_0x2dba07,'JO_number':_0x5124ab,'roomList':_0x23d794}),_0x5d19c9=await _0x5b6a2f[_0x255c2a(0x21a)](),_0x35c217=await purchases['findOne']({'invoice':_0x2f2bc8}),_0x19498d=_0x35c217[_0x255c2a(0x213)][_0x255c2a(0x1eb)](async _0x96ed2e=>{var _0x591158=_0x255c2a,_0xfb9b18=await warehouse['findOne']({'name':_0x20f7c8,'room':_0x96ed2e['room_name']}),_0x203c60=0x0;return _0xfb9b18[_0x591158(0x19f)]['forEach'](_0x33faa7=>{var _0x5ebd05=_0x591158;_0x33faa7[_0x5ebd05(0x1bc)]==_0x96ed2e[_0x5ebd05(0x1bc)]&&_0x33faa7[_0x5ebd05(0x12c)]==_0x96ed2e[_0x5ebd05(0x12c)]&&_0x33faa7[_0x5ebd05(0x207)]==_0x96ed2e['type']&&_0x33faa7[_0x5ebd05(0x127)]==_0x96ed2e['bin']&&_0x33faa7[_0x5ebd05(0x145)]==_0x96ed2e[_0x5ebd05(0x145)]&&_0x33faa7['rack']==_0x96ed2e['rack']&&_0x33faa7[_0x5ebd05(0x1c2)]==_0x96ed2e[_0x5ebd05(0x1c2)]&&_0x33faa7[_0x5ebd05(0x1b4)]==_0x96ed2e['expiry_date']&&_0x33faa7[_0x5ebd05(0x1af)]==_0x96ed2e['batch_code']&&_0x33faa7[_0x5ebd05(0x1db)]==_0x96ed2e[_0x5ebd05(0x1db)]&&_0x33faa7[_0x5ebd05(0x1e4)]==_0x35c217[_0x5ebd05(0x1e4)]&&(_0x33faa7[_0x5ebd05(0x1ed)]+=Math[_0x5ebd05(0x13c)](_0x96ed2e[_0x5ebd05(0x193)]),_0x203c60++);}),_0x203c60===0x0&&_0xfb9b18['product_details'][_0x591158(0x1cc)]({'product_name':_0x96ed2e[_0x591158(0x1bc)],'product_stock':Math[_0x591158(0x13c)](_0x96ed2e[_0x591158(0x193)]),'primary_code':_0x96ed2e[_0x591158(0x195)],'secondary_code':_0x96ed2e[_0x591158(0x1cd)],'product_code':_0x96ed2e[_0x591158(0x1c8)],'storage':_0x96ed2e[_0x591158(0x1c2)],'rack':_0x96ed2e[_0x591158(0x1ae)],'bay':_0x96ed2e['bay'],'bin':_0x96ed2e[_0x591158(0x127)],'type':_0x96ed2e[_0x591158(0x207)],'floorlevel':_0x96ed2e[_0x591158(0x12c)],'maxProducts':_0x96ed2e[_0x591158(0x19c)],'unit':_0x96ed2e[_0x591158(0x1a2)],'secondary_unit':_0x96ed2e[_0x591158(0x182)],'expiry_date':_0x96ed2e[_0x591158(0x1b4)],'maxPerUnit':_0x96ed2e[_0x591158(0x1bf)],'batch_code':_0x96ed2e[_0x591158(0x1af)],'alertQTY':_0x96ed2e['alertQTY'],'production_date':_0x96ed2e['production_date'],'product_cat':_0x96ed2e[_0x591158(0x206)],'invoice':_0x96ed2e[_0x591158(0x1e4)],'actual_qty':Math[_0x591158(0x13c)](_0x96ed2e[_0x591158(0x1f9)]),'actual_uom':_0x96ed2e[_0x591158(0x16d)]}),_0xfb9b18;});Promise[_0x255c2a(0x229)](_0x19498d)[_0x255c2a(0x1e6)](async _0x214ea1=>{var _0x2a4f25=_0x255c2a;try{for(const _0x591356 of _0x214ea1){await _0x591356[_0x2a4f25(0x21a)]();}const _0x1f133c=await master_shop[_0x2a4f25(0x1f0)](),_0x3e15ef=await email_settings[_0x2a4f25(0x17b)](),_0x104fe0=await supervisor_settings[_0x2a4f25(0x1f0)]();var _0x4c1cd4=_0x35c217[_0x2a4f25(0x213)],_0x14bfe4='',_0x2352bf;for(_0x2352bf in _0x4c1cd4){_0x14bfe4+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c1cd4[_0x2352bf]['product_name']+_0x2a4f25(0x239)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c1cd4[_0x2352bf]['product_code']+'</td>'+_0x2a4f25(0x1d4)+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x193)]+_0x2a4f25(0x239)+_0x2a4f25(0x1d4)+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x1a2)]+_0x2a4f25(0x239)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x182)]+_0x2a4f25(0x239)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35c217[_0x2a4f25(0x1d5)]+'</td>'+_0x2a4f25(0x1d4)+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x1ef)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x1c2)]+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x1ae)]+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x145)]+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x127)]+_0x4c1cd4[_0x2352bf][_0x2a4f25(0x207)][0x0]+_0x4c1cd4[_0x2352bf]['floorlevel']+'</td>',_0x2a4f25(0x124);}let _0x2e3763=nodemailer[_0x2a4f25(0x1f5)]({'host':_0x3e15ef['host'],'port':Number(_0x3e15ef[_0x2a4f25(0x1c4)]),'secure':![],'auth':{'user':_0x3e15ef[_0x2a4f25(0x171)],'pass':_0x3e15ef[_0x2a4f25(0x14f)]}}),_0x3c2c59={'from':_0x3e15ef[_0x2a4f25(0x171)],'to':_0x104fe0[0x0]['RMSEmail'],'subject':_0x2a4f25(0x217),'attachments':[{'filename':_0x2a4f25(0x23c),'path':__dirname+_0x2a4f25(0x1d2)+_0x2a4f25(0x170)+_0x1f133c[0x0][_0x2a4f25(0x1bd)],'cid':_0x2a4f25(0x1de)}],'html':_0x2a4f25(0x15e)+'<html><head><title></title>'+_0x2a4f25(0x1fc)+'<div>'+_0x2a4f25(0x140)+_0x2a4f25(0x162)+_0x2a4f25(0x13f)+_0x2a4f25(0x1ea)+'<div>'+_0x2a4f25(0x22c)+_0x1f133c[0x0]['site_title']+_0x2a4f25(0x20a)+_0x2a4f25(0x1ea)+'</div>'+_0x2a4f25(0x1c0)+_0x2a4f25(0x162)+_0x2a4f25(0x134)+_0x2a4f25(0x20c)+_0x35c217[_0x2a4f25(0x1e4)]+'\x20'+_0x2a4f25(0x142)+_0x2a4f25(0x22a)+_0x35c217[_0x2a4f25(0x125)]+'\x20'+_0x2a4f25(0x23a)+'</h5>'+_0x2a4f25(0x1ea)+_0x2a4f25(0x1df)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2a4f25(0x1b3)+_0x2a4f25(0x1ad)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x2a4f25(0x23d)+_0x2a4f25(0x1b9)+'</tr>'+'</thead>'+_0x2a4f25(0x236)+'\x20'+_0x14bfe4+'\x20'+_0x2a4f25(0x17d)+_0x2a4f25(0x21f)+'<div>'+_0x2a4f25(0x20e)+_0x2a4f25(0x21c)+_0x1f133c[0x0][_0x2a4f25(0x189)]+_0x2a4f25(0x215)+_0x2a4f25(0x1ea)+_0x2a4f25(0x1ea)+_0x2a4f25(0x201)};_0x2e3763[_0x2a4f25(0x152)](_0x3c2c59,function(_0x13ba02,_0x43545a){var _0xb92309=_0x2a4f25;_0x13ba02?(console['log'](_0x13ba02),console[_0xb92309(0x196)](_0xb92309(0x1c6))):console[_0xb92309(0x196)](_0xb92309(0x13b));}),_0x1f573f[_0x2a4f25(0x227)](_0x2a4f25(0x226),_0x2a4f25(0x151)),_0xf2a2aa[_0x2a4f25(0x20d)](_0x2a4f25(0x1ab));}catch(_0x737de9){console[_0x2a4f25(0x1dc)](_0x737de9),_0xf2a2aa[_0x2a4f25(0x164)](0x1f4)[_0x2a4f25(0x15f)]({'error':_0x2a4f25(0x17a)});}})[_0x255c2a(0x144)](_0x489b71=>{var _0x49e0ce=_0x255c2a;console[_0x49e0ce(0x1dc)](_0x489b71),_0xf2a2aa[_0x49e0ce(0x164)](0x1f4)['json']({'error':_0x49e0ce(0x1b8)});});}catch(_0x1c253f){console[_0x255c2a(0x196)](_0x1c253f);}}),router['get'](a0_0x48bae8(0x240),auth,async(_0xddea00,_0x3ea37e)=>{var _0x258882=a0_0x48bae8;try{const {username:_0x49a5fb,email:_0x4bffa9,role:_0x27b5b3}=_0xddea00['user'],_0x43793a=_0xddea00[_0x258882(0x18a)],_0x107621=await profile[_0x258882(0x17b)]({'email':_0x43793a[_0x258882(0x171)]}),_0x161c6e=await master_shop[_0x258882(0x1f0)](),_0x236148=_0xddea00[_0x258882(0x211)]['id'],_0x3c820a=await purchases[_0x258882(0x1d0)](_0x236148),_0xf8786c=await warehouse[_0x258882(0x136)]([{'$match':{'name':_0x3c820a[_0x258882(0x1d5)],'room':_0x3c820a[_0x258882(0x15a)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x258882(0x133),'name':{'$first':_0x258882(0x13e)},'product_stock':{'$first':_0x258882(0x1d8)},'bay':{'$first':_0x258882(0x1d7)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x258882(0x163)},'secondary_code':{'$first':_0x258882(0x16b)},'product_code':{'$first':_0x258882(0x1fd)},'storage':{'$first':_0x258882(0x15d)},'rack':{'$first':_0x258882(0x202)},'expiry_date':{'$first':_0x258882(0x199)}}}]),_0x6509e7=await customer[_0x258882(0x1f0)]({});let _0xb24c05;if(_0x43793a[_0x258882(0x205)]==_0x258882(0x1ba)){const _0x584bba=await staff['findOne']({'email':_0x43793a['email']});_0xb24c05=await warehouse[_0x258882(0x136)]([{'$match':{'status':'Enabled','name':_0x584bba[_0x258882(0x214)]}},{'$group':{'_id':_0x258882(0x235),'name':{'$first':_0x258882(0x235)}}}]);}else _0xb24c05=await warehouse[_0x258882(0x136)]([{'$match':{'status':_0x258882(0x219)}},{'$group':{'_id':_0x258882(0x235),'name':{'$first':_0x258882(0x235)}}}]);const _0x1e87b4=await product[_0x258882(0x1f0)]({}),_0x9e205a=await suppliers[_0x258882(0x1f0)]({}),_0x4d0e67=BayBinSelected(_0x3c820a[_0x258882(0x1d5)],_0x3c820a['room']);if(_0x161c6e[0x0][_0x258882(0x141)]==_0x258882(0x15c)){var _0x59664c=users['English'];console[_0x258882(0x196)](_0x59664c);}else{if(_0x161c6e[0x0]['language']=='Hindi')var _0x59664c=users[_0x258882(0x18f)];else{if(_0x161c6e[0x0][_0x258882(0x141)]==_0x258882(0x1b1))var _0x59664c=users[_0x258882(0x1b1)];else{if(_0x161c6e[0x0][_0x258882(0x141)]==_0x258882(0x154))var _0x59664c=users[_0x258882(0x154)];else{if(_0x161c6e[0x0][_0x258882(0x141)]==_0x258882(0x1c1))var _0x59664c=users[_0x258882(0x1c1)];else{if(_0x161c6e[0x0][_0x258882(0x141)]==_0x258882(0x17e))var _0x59664c=users[_0x258882(0x198)];else{if(_0x161c6e[0x0][_0x258882(0x141)]=='Chinese')var _0x59664c=users[_0x258882(0x181)];else{if(_0x161c6e[0x0][_0x258882(0x141)]=='Arabic\x20(ae)')var _0x59664c=users['Arabic'];}}}}}}}_0x3ea37e[_0x258882(0x139)]('edit_purchases_view',{'success':_0xddea00['flash'](_0x258882(0x226)),'errors':_0xddea00['flash'](_0x258882(0x14b)),'role':_0x43793a,'profile':_0x107621,'customer':_0x6509e7,'warehouse':_0xb24c05,'product':_0xf8786c,'user':_0x3c820a,'master_shop':_0x161c6e,'unit':_0x1e87b4,'language':_0x59664c,'suppliers':_0x9e205a,'dataSelected':_0x4d0e67});}catch(_0x553bfa){console['log'](_0x553bfa);}}),router[a0_0x48bae8(0x228)]('/preview/:id',auth,async(_0x4e16eb,_0x121e01)=>{var _0x3e7e0d=a0_0x48bae8;try{const _0x33ecc9=_0x4e16eb[_0x3e7e0d(0x211)]['id'],{invoice:_0x457faf,warehouse_name:_0x41a2dd,Room_name:_0x5e9396}=_0x4e16eb[_0x3e7e0d(0x12f)],_0x1f771f=await warehouse[_0x3e7e0d(0x17b)]({'name':_0x41a2dd,'room':_0x5e9396}),_0xcc8898=await purchases[_0x3e7e0d(0x17b)]({'invoice':_0x457faf});_0xcc8898[_0x3e7e0d(0x213)][_0x3e7e0d(0x23f)](_0x36cbd8=>{var _0x4e088d=_0x3e7e0d,_0x12b464=0x0;const _0x22472b=_0x1f771f[_0x4e088d(0x19f)]['map'](_0x256472=>{var _0xb93aca=_0x4e088d;_0x256472[_0xb93aca(0x1bc)]==_0x36cbd8['product_name']&&_0x256472[_0xb93aca(0x12c)]==_0x36cbd8[_0xb93aca(0x12c)]&&_0x256472[_0xb93aca(0x207)]==_0x36cbd8[_0xb93aca(0x207)]&&_0x256472[_0xb93aca(0x127)]==_0x36cbd8[_0xb93aca(0x127)]&&_0x256472['bay']==_0x36cbd8['bay']&&_0x256472[_0xb93aca(0x1ae)]==_0x36cbd8[_0xb93aca(0x1ae)]&&_0x256472[_0xb93aca(0x1c2)]==_0x36cbd8[_0xb93aca(0x1c2)]&&_0x256472['expiry_date']==_0x36cbd8['expiry_date']&&_0x256472[_0xb93aca(0x1af)]==_0x36cbd8[_0xb93aca(0x1af)]&&_0x256472[_0xb93aca(0x1db)]==_0x36cbd8[_0xb93aca(0x1db)]&&_0x256472[_0xb93aca(0x1a6)]==_0x36cbd8[_0xb93aca(0x1a6)]&&_0x256472[_0xb93aca(0x18e)]==_0x36cbd8[_0xb93aca(0x18e)]&&(_0x256472['product_stock']=parseInt(_0x256472[_0xb93aca(0x1ed)])+parseInt(_0x36cbd8['quantity']),_0x12b464++);});_0x12b464=='0'&&(_0x1f771f[_0x4e088d(0x19f)]=_0x1f771f[_0x4e088d(0x19f)][_0x4e088d(0x21d)]({'product_name':_0x36cbd8[_0x4e088d(0x1bc)],'product_stock':_0x36cbd8[_0x4e088d(0x193)],'primary_code':_0x36cbd8['primary_code'],'secondary_code':_0x36cbd8[_0x4e088d(0x1cd)],'product_code':_0x36cbd8['product_code'],'storage':_0x36cbd8[_0x4e088d(0x1c2)],'rack':_0x36cbd8[_0x4e088d(0x1ae)],'bay':_0x36cbd8['bay'],'bin':_0x36cbd8[_0x4e088d(0x127)],'type':_0x36cbd8[_0x4e088d(0x207)],'floorlevel':_0x36cbd8[_0x4e088d(0x12c)],'maxProducts':_0x36cbd8[_0x4e088d(0x19c)],'unit':_0x36cbd8[_0x4e088d(0x1a2)],'secondary_unit':_0x36cbd8['secondary_unit'],'expiry_date':_0x36cbd8[_0x4e088d(0x1b4)],'maxPerUnit':_0x36cbd8[_0x4e088d(0x1bf)],'batch_code':_0x36cbd8[_0x4e088d(0x1af)],'alertQTY':_0x36cbd8[_0x4e088d(0x13a)],'production_date':_0x36cbd8[_0x4e088d(0x1db)],'delivery_date':_0x36cbd8[_0x4e088d(0x1a6)],'delivery_code':_0x36cbd8[_0x4e088d(0x18e)]}));}),await _0x1f771f[_0x3e7e0d(0x21a)](),_0xcc8898[_0x3e7e0d(0x185)]='True';const _0x503064=await _0xcc8898[_0x3e7e0d(0x21a)]();_0x4e16eb[_0x3e7e0d(0x227)](_0x3e7e0d(0x226),'Sales\x20Update\x20successfully'),_0x121e01['redirect'](_0x3e7e0d(0x155));}catch(_0x25ea0c){console[_0x3e7e0d(0x196)](_0x25ea0c);}}),router[a0_0x48bae8(0x1a0)]('/view/:id',auth,async(_0x4b1a22,_0x598074)=>{var _0x40f2d7=a0_0x48bae8;try{const {username:_0x592b0a,email:_0x557cb3,role:_0x38a572}=_0x4b1a22[_0x40f2d7(0x18a)],_0x35888e=_0x4b1a22[_0x40f2d7(0x18a)],_0x1e59a6=await profile[_0x40f2d7(0x17b)]({'email':_0x35888e[_0x40f2d7(0x171)]}),_0x4965ef=await master_shop['find'](),_0x5b9d3a=_0x4b1a22['params']['id'],_0x6f915=await purchases[_0x40f2d7(0x1d0)](_0x5b9d3a),_0x2b53c3=await suppliers[_0x40f2d7(0x1f0)]({});let _0x3b4f62;if(_0x35888e[_0x40f2d7(0x205)]==_0x40f2d7(0x1ba)){const _0x54cdf8=await staff[_0x40f2d7(0x17b)]({'email':_0x35888e[_0x40f2d7(0x171)]});_0x3b4f62=await warehouse[_0x40f2d7(0x1f0)]({'status':'Enabled','name':_0x54cdf8[_0x40f2d7(0x214)],'warehouse_category':_0x40f2d7(0x1b7)});}else _0x3b4f62=await warehouse[_0x40f2d7(0x136)]([{'$match':{'status':'Enabled','warehouse_category':_0x40f2d7(0x1b7)}},{'$group':{'_id':_0x40f2d7(0x235),'name':{'$first':_0x40f2d7(0x235)}}}]);const _0xf6c9a2=await product[_0x40f2d7(0x1f0)]({}),_0x48ce38=BayBinSelected(_0x6f915[_0x40f2d7(0x1d5)],_0x6f915['room']);let _0x35b92c=new Date(_0x6f915[_0x40f2d7(0x1b4)]),_0x4ab25e=('0'+_0x35b92c[_0x40f2d7(0x1c3)]())[_0x40f2d7(0x218)](-0x2),_0xb8f2d5=('0'+(_0x35b92c['getMonth']()+0x1))[_0x40f2d7(0x218)](-0x2),_0x4a8af7=_0x35b92c[_0x40f2d7(0x130)](),_0x3e8145=_0x4a8af7+'-'+_0xb8f2d5+'-'+_0x4ab25e;if(_0x4965ef[0x0][_0x40f2d7(0x141)]==_0x40f2d7(0x15c)){var _0x54cea2=users['English'];console[_0x40f2d7(0x196)](_0x54cea2);}else{if(_0x4965ef[0x0][_0x40f2d7(0x141)]==_0x40f2d7(0x18f))var _0x54cea2=users['Hindi'];else{if(_0x4965ef[0x0][_0x40f2d7(0x141)]==_0x40f2d7(0x1b1))var _0x54cea2=users[_0x40f2d7(0x1b1)];else{if(_0x4965ef[0x0][_0x40f2d7(0x141)]=='Spanish')var _0x54cea2=users[_0x40f2d7(0x154)];else{if(_0x4965ef[0x0]['language']==_0x40f2d7(0x1c1))var _0x54cea2=users[_0x40f2d7(0x1c1)];else{if(_0x4965ef[0x0][_0x40f2d7(0x141)]==_0x40f2d7(0x17e))var _0x54cea2=users['Portuguese'];else{if(_0x4965ef[0x0][_0x40f2d7(0x141)]==_0x40f2d7(0x181))var _0x54cea2=users['Chinese'];else{if(_0x4965ef[0x0][_0x40f2d7(0x141)]==_0x40f2d7(0x212))var _0x54cea2=users[_0x40f2d7(0x1a1)];}}}}}}}_0x598074[_0x40f2d7(0x139)](_0x40f2d7(0x216),{'success':_0x4b1a22[_0x40f2d7(0x227)](_0x40f2d7(0x226)),'errors':_0x4b1a22[_0x40f2d7(0x227)](_0x40f2d7(0x14b)),'role':_0x35888e,'profile':_0x1e59a6,'purchases':_0x6f915,'suppliers':_0x2b53c3,'warehouse':_0x3b4f62,'product':_0xf6c9a2,'master_shop':_0x4965ef,'language':_0x54cea2,'ed_fullDate':_0x3e8145,'dataSelected':_0x48ce38});}catch(_0x2b01ae){console[_0x40f2d7(0x196)](_0x2b01ae);}}),router[a0_0x48bae8(0x228)](a0_0x48bae8(0x158),auth,async(_0x52d592,_0x3572cb)=>{var _0x29b59c=a0_0x48bae8;try{const _0x43c65a=_0x52d592[_0x29b59c(0x211)]['id'],_0x403cfc=await purchases[_0x29b59c(0x17b)]({'_id':_0x52d592['params']['id']}),_0x46eb18=await warehouse['findOne']({'name':_0x403cfc[_0x29b59c(0x1d5)],'room':_0x403cfc[_0x29b59c(0x15a)]});_0x403cfc['product']['forEach'](_0x1bfb85=>{var _0x5502ad=_0x29b59c;const _0x58cd2b=_0x46eb18['product_details'][_0x5502ad(0x1eb)](_0x35e57e=>{var _0xf51fc2=_0x5502ad;_0x35e57e['product_name']==_0x1bfb85[_0xf51fc2(0x1bc)]&&_0x35e57e[_0xf51fc2(0x12c)]==_0x1bfb85[_0xf51fc2(0x12c)]&&_0x35e57e[_0xf51fc2(0x207)]==_0x1bfb85[_0xf51fc2(0x207)]&&_0x35e57e[_0xf51fc2(0x127)]==_0x1bfb85[_0xf51fc2(0x127)]&&_0x35e57e['bay']==_0x1bfb85['bay']&&_0x35e57e['rack']==_0x1bfb85[_0xf51fc2(0x1ae)]&&_0x35e57e[_0xf51fc2(0x1c2)]==_0x1bfb85[_0xf51fc2(0x1c2)]&&(_0x35e57e[_0xf51fc2(0x1ed)]=parseInt(_0x35e57e['product_stock'])-parseInt(_0x1bfb85[_0xf51fc2(0x193)]));});}),await _0x46eb18[_0x29b59c(0x21a)]();const {invoice:_0x1669de,suppliers:_0x225f1d,date:_0x51ac7a,warehouse_name:_0x228b3d,prod_name:_0x1dea47,prod_code:_0x6367e5,prod_qty:_0x1ef3e3,prod_unit:_0x3acbb9,prod_secondunit:_0x286584,prod_level:_0x2fc9d6,prod_isle:_0x263b05,prod_pallet:_0x8b6af3,note:_0x250ed5,expiry_date:_0x454b58,batch_code:_0x4f4c99,paid_amount:_0x9b72dd,due_amount:_0x323849,Room_name:_0x37c91e,primary_code:_0x48f2b9,secondary_code:_0x673e20,PO_number:_0x584b62,JO_number:_0x4434f1}=_0x52d592[_0x29b59c(0x12f)];if(typeof _0x1dea47==_0x29b59c(0x204))var _0x10bfbe=[_0x52d592['body'][_0x29b59c(0x1ec)]],_0x3729ac=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x20f)]],_0x551ab9=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1ff)]],_0x11b3c3=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x17c)]],_0x2da1be=[_0x52d592['body']['prod_secondunit']],_0x3361e8=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1ee)]],_0x51758b=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x12b)]],_0x3b3360=[_0x52d592['body'][_0x29b59c(0x225)]],_0x3207d4=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x195)]],_0x3899f9=[_0x52d592['body'][_0x29b59c(0x1cd)]],_0x1e418d=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x203)]],_0x5a4614=[_0x52d592[_0x29b59c(0x12f)]['batch_code']],_0x5d8f86=[_0x52d592['body'][_0x29b59c(0x1b4)]],_0x7e894a=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1c2)]],_0x5be834=[_0x52d592[_0x29b59c(0x12f)]['rak']],_0x4b6f07=[_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x207)]];else var _0x10bfbe=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1ec)]],_0x3729ac=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x20f)]],_0x551ab9=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1ff)]],_0x11b3c3=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x17c)]],_0x2da1be=[..._0x52d592['body'][_0x29b59c(0x1a9)]],_0x3361e8=[..._0x52d592['body'][_0x29b59c(0x1ee)]],_0x51758b=[..._0x52d592['body']['prod_isle']],_0x3b3360=[..._0x52d592['body'][_0x29b59c(0x225)]],_0x3207d4=[..._0x52d592[_0x29b59c(0x12f)]['primary_code']],_0x3899f9=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1cd)]],_0x1e418d=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x203)]],_0x5a4614=[..._0x52d592['body'][_0x29b59c(0x1af)]],_0x5d8f86=[..._0x52d592['body'][_0x29b59c(0x1b4)]],_0x7e894a=[..._0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1c2)]],_0x5be834=[..._0x52d592[_0x29b59c(0x12f)]['rak']],_0x4b6f07=[..._0x52d592['body'][_0x29b59c(0x207)]];const _0xdf27b8=_0x10bfbe[_0x29b59c(0x1eb)](_0x442a8a=>{return _0x442a8a={'product_name':_0x442a8a};});_0x3729ac[_0x29b59c(0x23f)]((_0x576650,_0x5472a0)=>{var _0xdd76b4=_0x29b59c;_0xdf27b8[_0x5472a0][_0xdd76b4(0x1c8)]=_0x576650;}),_0x551ab9[_0x29b59c(0x23f)]((_0x59edc1,_0x4f1614)=>{var _0x323b8b=_0x29b59c;_0xdf27b8[_0x4f1614][_0x323b8b(0x193)]=_0x59edc1;}),_0x11b3c3['forEach']((_0x286e38,_0xf3b1bf)=>{var _0x5046b6=_0x29b59c;_0xdf27b8[_0xf3b1bf][_0x5046b6(0x1a2)]=_0x286e38;}),_0x2da1be['forEach']((_0x561786,_0x4bc7fb)=>{_0xdf27b8[_0x4bc7fb]['secondary_unit']=_0x561786;}),_0x3361e8[_0x29b59c(0x23f)]((_0x7007d0,_0x10b403)=>{var _0xaf2f8f=_0x29b59c;_0xdf27b8[_0x10b403][_0xaf2f8f(0x145)]=_0x7007d0;}),_0x51758b[_0x29b59c(0x23f)]((_0x3878f9,_0xc2f232)=>{var _0x3697ec=_0x29b59c;_0xdf27b8[_0xc2f232][_0x3697ec(0x127)]=_0x3878f9;}),_0x3b3360[_0x29b59c(0x23f)]((_0x50aaee,_0x54034b)=>{var _0xe6af92=_0x29b59c;_0xdf27b8[_0x54034b][_0xe6af92(0x12c)]=_0x50aaee;}),_0x3207d4[_0x29b59c(0x23f)]((_0x27b2d3,_0x27d92e)=>{_0xdf27b8[_0x27d92e]['primary_code']=_0x27b2d3;}),_0x3899f9[_0x29b59c(0x23f)]((_0x158f43,_0x55d8fe)=>{var _0x399062=_0x29b59c;_0xdf27b8[_0x55d8fe][_0x399062(0x1cd)]=_0x158f43;}),_0x1e418d[_0x29b59c(0x23f)]((_0x1e9f6a,_0x3af93a)=>{_0xdf27b8[_0x3af93a]['maxStocks']=_0x1e9f6a;}),_0x5a4614[_0x29b59c(0x23f)]((_0x5c4f10,_0x56a49c)=>{var _0x3d421a=_0x29b59c;_0xdf27b8[_0x56a49c][_0x3d421a(0x1af)]=_0x5c4f10;}),_0x5d8f86[_0x29b59c(0x23f)]((_0x1439b8,_0x13ac66)=>{_0xdf27b8[_0x13ac66]['expiry_date']=_0x1439b8;}),_0x4b6f07[_0x29b59c(0x23f)]((_0x1427fd,_0x2cfe88)=>{var _0x4e3fc2=_0x29b59c;_0xdf27b8[_0x2cfe88][_0x4e3fc2(0x207)]=_0x1427fd;}),_0x7e894a[_0x29b59c(0x23f)]((_0x1b459e,_0x33fecd)=>{_0xdf27b8[_0x33fecd]['storage']=_0x1b459e;}),_0x5be834[_0x29b59c(0x23f)]((_0x1aa703,_0x449dcd)=>{_0xdf27b8[_0x449dcd]['rack']=_0x1aa703;});const _0x3cd53d=_0xdf27b8[_0x29b59c(0x1f4)](_0x17cfb1=>_0x17cfb1['quantity']!=='0'&&_0x17cfb1['quantity']!=='');_0x403cfc['invoice']=_0x1669de,_0x403cfc[_0x29b59c(0x1e9)]=_0x225f1d,_0x403cfc[_0x29b59c(0x125)]=_0x51ac7a,_0x403cfc[_0x29b59c(0x1d5)]=_0x228b3d,_0x403cfc[_0x29b59c(0x213)]=_0x3cd53d,_0x403cfc[_0x29b59c(0x173)]=_0x250ed5,_0x403cfc[_0x29b59c(0x1a4)]=_0x9b72dd,_0x403cfc[_0x29b59c(0x16f)]=_0x323849,_0x403cfc[_0x29b59c(0x15a)]=_0x37c91e,_0x403cfc['POnumber']=_0x584b62,_0x403cfc['JO_number']=_0x4434f1;const _0x514491=await _0x403cfc[_0x29b59c(0x21a)](),_0x3c318c=await warehouse[_0x29b59c(0x17b)]({'name':_0x52d592['body'][_0x29b59c(0x1d5)],'room':_0x52d592[_0x29b59c(0x12f)]['Room_name']});_0x403cfc['product'][_0x29b59c(0x23f)](_0x3783a4=>{var _0x928f5=_0x29b59c,_0x16ff5c=0x0;const _0x5f12a3=_0x3c318c['product_details']['map'](_0x515bc5=>{var _0x58c062=a0_0x1c90;_0x515bc5[_0x58c062(0x1bc)]==_0x3783a4['product_name']&&_0x515bc5['floorlevel']==_0x3783a4[_0x58c062(0x12c)]&&_0x515bc5[_0x58c062(0x207)]==_0x3783a4['type']&&_0x515bc5['bin']==_0x3783a4[_0x58c062(0x127)]&&_0x515bc5['bay']==_0x3783a4[_0x58c062(0x145)]&&_0x515bc5['rack']==_0x3783a4[_0x58c062(0x1ae)]&&_0x515bc5[_0x58c062(0x1c2)]==_0x3783a4[_0x58c062(0x1c2)]&&(_0x515bc5[_0x58c062(0x1ed)]=parseInt(_0x515bc5[_0x58c062(0x1ed)])+parseInt(_0x3783a4[_0x58c062(0x193)]),_0x16ff5c++);});_0x16ff5c=='0'&&(_0x3c318c[_0x928f5(0x19f)]=_0x3c318c['product_details']['concat']({'product_name':_0x3783a4[_0x928f5(0x1bc)],'product_stock':_0x3783a4[_0x928f5(0x193)],'primary_code':_0x3783a4[_0x928f5(0x195)],'secondary_code':_0x3783a4[_0x928f5(0x1cd)],'product_code':_0x3783a4[_0x928f5(0x1c8)],'storage':_0x3783a4['storage'],'rack':_0x3783a4[_0x928f5(0x1ae)],'bay':_0x3783a4[_0x928f5(0x145)],'bin':_0x3783a4[_0x928f5(0x127)],'type':_0x3783a4[_0x928f5(0x207)],'floorlevel':_0x3783a4[_0x928f5(0x12c)],'maxProducts':_0x3783a4[_0x928f5(0x19c)],'unit':_0x3783a4[_0x928f5(0x1a2)],'secondary_unit':_0x3783a4['secondary_unit'],'expiry_date':_0x3783a4[_0x928f5(0x1b4)]}));}),await _0x3c318c[_0x29b59c(0x21a)]();const _0x5595c3=await s_payment_data[_0x29b59c(0x17b)]({'invoice':_0x52d592[_0x29b59c(0x12f)][_0x29b59c(0x1e4)]});if(_0x5595c3===null){}else console[_0x29b59c(0x196)](_0x29b59c(0x1e9),_0x5595c3,_0x52d592['body'][_0x29b59c(0x1e4)]),_0x5595c3['suppliers']=_0x52d592[_0x29b59c(0x12f)]['suppliers'],await _0x5595c3['save']();_0x52d592['flash']('success',_0x29b59c(0x1e0)),_0x3572cb[_0x29b59c(0x20d)](_0x29b59c(0x155));}catch(_0x2da25d){console[_0x29b59c(0x196)](_0x2da25d);}}),router[a0_0x48bae8(0x228)](a0_0x48bae8(0x146),auth,async(_0x6ae10f,_0x82c20b)=>{var _0x560e29=a0_0x48bae8;try{const _0x480f83=_0x6ae10f[_0x560e29(0x211)]['id'],{invoice:_0x1d033a,suppliers:_0x1da58e,payable:_0x203519,due_amount:_0x576899}=_0x6ae10f[_0x560e29(0x12f)],_0x3e155d=await purchases[_0x560e29(0x1d0)](_0x480f83);var _0x16c4f8=_0x203519-_0x576899;_0x3e155d[_0x560e29(0x1a4)]=parseFloat(_0x3e155d['paid_amount'])+parseFloat(_0x576899),_0x3e155d[_0x560e29(0x16f)]=_0x16c4f8;const _0x42f309=await _0x3e155d[_0x560e29(0x21a)]();console[_0x560e29(0x196)](_0x42f309);const _0x3f0ff8=await s_payment_data[_0x560e29(0x17b)]({'invoice':_0x1d033a});_0x3f0ff8[_0x560e29(0x161)]=_0x16c4f8,await _0x3f0ff8[_0x560e29(0x21a)]();let _0x4b71a5=new Date(),_0x273d9a=('0'+_0x4b71a5['getDate']())['slice'](-0x2),_0x53a13b=('0'+(_0x4b71a5[_0x560e29(0x197)]()+0x1))['slice'](-0x2),_0x4e5711=_0x4b71a5[_0x560e29(0x130)](),_0x198d22=_0x4e5711+'-'+_0x53a13b+'-'+_0x273d9a;const _0x26ffd4=new suppliers_payment({'invoice':_0x1d033a,'date':_0x4e5711+'-'+_0x53a13b+'-'+_0x273d9a,'suppliers':_0x1da58e,'reason':'Paid\x20For\x20Purchase','amount':_0x576899}),_0x614afa=await _0x26ffd4[_0x560e29(0x21a)]();_0x6ae10f[_0x560e29(0x227)](_0x560e29(0x226),_0x560e29(0x175)),_0x82c20b[_0x560e29(0x20d)]('/all_purchases/view');}catch(_0x2b4a03){console[_0x560e29(0x196)](_0x2b4a03);}}),router[a0_0x48bae8(0x1a0)](a0_0x48bae8(0x1cf),auth,async(_0x4c765a,_0x5ceac6)=>{var _0x5f250d=a0_0x48bae8;try{const {username:_0x55fc22,email:_0xf07bb3,role:_0x538075}=_0x4c765a[_0x5f250d(0x18a)],_0x4f2181=_0x4c765a['user'],_0x1b3aa9=await profile[_0x5f250d(0x17b)]({'email':_0x4f2181[_0x5f250d(0x171)]}),_0x2ea670=await master_shop['find']();console['log'](_0x5f250d(0x177),_0x2ea670);const _0x36a730=_0x4c765a['params']['id'],_0x2cf278=await purchases[_0x5f250d(0x1d0)](_0x36a730);console[_0x5f250d(0x196)](_0x2cf278);const _0x1b2409=await suppliers[_0x5f250d(0x17b)]({'name':_0x2cf278[_0x5f250d(0x1e9)]});console['log'](_0x1b2409);if(_0x2ea670[0x0][_0x5f250d(0x141)]==_0x5f250d(0x15c)){var _0x5de2a2=users[_0x5f250d(0x1ac)];console[_0x5f250d(0x196)](_0x5de2a2);}else{if(_0x2ea670[0x0][_0x5f250d(0x141)]==_0x5f250d(0x18f))var _0x5de2a2=users['Hindi'];else{if(_0x2ea670[0x0][_0x5f250d(0x141)]==_0x5f250d(0x1b1))var _0x5de2a2=users[_0x5f250d(0x1b1)];else{if(_0x2ea670[0x0][_0x5f250d(0x141)]==_0x5f250d(0x154))var _0x5de2a2=users['Spanish'];else{if(_0x2ea670[0x0][_0x5f250d(0x141)]==_0x5f250d(0x1c1))var _0x5de2a2=users[_0x5f250d(0x1c1)];else{if(_0x2ea670[0x0]['language']==_0x5f250d(0x17e))var _0x5de2a2=users[_0x5f250d(0x198)];else{if(_0x2ea670[0x0]['language']=='Chinese')var _0x5de2a2=users[_0x5f250d(0x181)];else{if(_0x2ea670[0x0][_0x5f250d(0x141)]==_0x5f250d(0x212))var _0x5de2a2=users[_0x5f250d(0x1a1)];}}}}}}}_0x5ceac6[_0x5f250d(0x139)](_0x5f250d(0x192),{'success':_0x4c765a[_0x5f250d(0x227)](_0x5f250d(0x226)),'errors':_0x4c765a['flash'](_0x5f250d(0x14b)),'role':_0x4f2181,'profile':_0x1b3aa9,'master_shop':_0x2ea670,'supplier':_0x1b2409,'purchase':_0x2cf278,'language':_0x5de2a2});}catch(_0x2b2f0a){console[_0x5f250d(0x196)](_0x2b2f0a);}}),router[a0_0x48bae8(0x1a0)](a0_0x48bae8(0x16a),auth,async(_0x53b178,_0x33b863)=>{var _0x10048e=a0_0x48bae8;try{const {username:_0x3ae890,email:_0x440e5c,role:_0x40559e}=_0x53b178[_0x10048e(0x18a)],_0x4f4089=_0x53b178['user'],_0x331293=await profile[_0x10048e(0x17b)]({'email':_0x4f4089[_0x10048e(0x171)]}),_0xa276dd=await master_shop[_0x10048e(0x1f0)]();console['log'](_0x10048e(0x177),_0xa276dd);const _0x4d406e=_0x53b178[_0x10048e(0x211)]['id'];console[_0x10048e(0x196)](_0x4d406e);const _0x1451e7=await purchases[_0x10048e(0x1d0)](_0x4d406e);console[_0x10048e(0x196)](_0x10048e(0x157),_0x1451e7);const _0x5ab4be=await product['find']({}),_0x9edf1d=await warehouse[_0x10048e(0x136)]([{'$match':{'name':_0x1451e7[_0x10048e(0x1d5)],'room':_0x1451e7[_0x10048e(0x15a)],'warehouse_category':_0x10048e(0x1b7)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x10048e(0x133),'name':{'$first':_0x10048e(0x13e)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x10048e(0x188)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x10048e(0x220)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x10048e(0x16b)},'product_code':{'$first':_0x10048e(0x1fd)},'storage':{'$first':_0x10048e(0x15d)},'rack':{'$first':_0x10048e(0x202)}}}]);warehouse_data=await warehouse[_0x10048e(0x136)]([{'$match':{'status':_0x10048e(0x219),'name':'Return\x20Goods','warehouse_category':_0x10048e(0x1b7)}},{'$group':{'_id':_0x10048e(0x235),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x10048e(0x196)](_0x10048e(0x232),_0x9edf1d);if(_0xa276dd[0x0][_0x10048e(0x141)]==_0x10048e(0x15c)){var _0x2eacf3=users[_0x10048e(0x1ac)];console[_0x10048e(0x196)](_0x2eacf3);}else{if(_0xa276dd[0x0][_0x10048e(0x141)]=='Hindi')var _0x2eacf3=users[_0x10048e(0x18f)];else{if(_0xa276dd[0x0][_0x10048e(0x141)]=='German')var _0x2eacf3=users[_0x10048e(0x1b1)];else{if(_0xa276dd[0x0][_0x10048e(0x141)]==_0x10048e(0x154))var _0x2eacf3=users[_0x10048e(0x154)];else{if(_0xa276dd[0x0][_0x10048e(0x141)]==_0x10048e(0x1c1))var _0x2eacf3=users[_0x10048e(0x1c1)];else{if(_0xa276dd[0x0][_0x10048e(0x141)]=='Portuguese\x20(BR)')var _0x2eacf3=users[_0x10048e(0x198)];else{if(_0xa276dd[0x0][_0x10048e(0x141)]==_0x10048e(0x181))var _0x2eacf3=users[_0x10048e(0x181)];else{if(_0xa276dd[0x0][_0x10048e(0x141)]=='Arabic\x20(ae)')var _0x2eacf3=users['Arabic'];}}}}}}}_0x33b863[_0x10048e(0x139)](_0x10048e(0x23b),{'success':_0x53b178[_0x10048e(0x227)]('success'),'errors':_0x53b178[_0x10048e(0x227)]('errors'),'role':_0x4f4089,'profile':_0x331293,'user':_0x1451e7,'stock':_0x9edf1d,'master_shop':_0xa276dd,'product':_0x5ab4be,'language':_0x2eacf3,'warehouse':warehouse_data});}catch(_0x5a13f7){console[_0x10048e(0x196)](_0x5a13f7);}}),router['post'](a0_0x48bae8(0x16a),auth,async(_0xa7b568,_0x1f999a)=>{var _0x2da244=a0_0x48bae8;try{const {invoice:_0x52d616,date:_0x256d19,warehouse_name:_0x109279,Room_name:_0x52a1b9,product_name:_0x5802a8,purchase_quantity:_0x47d118,stocks:_0x3b7615,return_qty:_0x5e9e18,note:_0x5d1bc5,level:_0x2aa278,isle:_0x2f55c0,pallet:_0x83508,to_warehouse_name:_0x4998e8,to_Room_name:_0x4da2ca}=_0xa7b568[_0x2da244(0x12f)],_0x29e8ab=await purchases[_0x2da244(0x17b)]({'_id':_0xa7b568['params']['id']}),_0x9c80f4=await warehouse[_0x2da244(0x17b)]({'name':_0x109279,'room':_0x52a1b9});if(typeof _0x5802a8==_0x2da244(0x204))var _0x4472e6=[_0xa7b568['body']['product_name']],_0x2c59f5=[_0xa7b568['body'][_0x2da244(0x15b)]],_0x281650=[_0xa7b568[_0x2da244(0x12f)]['stocks']],_0x397189=[_0xa7b568[_0x2da244(0x12f)][_0x2da244(0x1f6)]],_0x2d4ed1=[_0xa7b568[_0x2da244(0x12f)][_0x2da244(0x1be)]],_0x3450d7=[_0xa7b568['body'][_0x2da244(0x1ca)]],_0x38dc37=[_0xa7b568[_0x2da244(0x12f)][_0x2da244(0x208)]],_0xe86c4c=[_0xa7b568[_0x2da244(0x12f)][_0x2da244(0x166)]],_0xc57b5b=[_0xa7b568[_0x2da244(0x12f)]['product_code_hide']],_0xafc3c5=[_0xa7b568[_0x2da244(0x12f)][_0x2da244(0x160)]],_0x153d23=[_0xa7b568['body']['secondary_code_hide']];else var _0x4472e6=[..._0xa7b568[_0x2da244(0x12f)]['product_name']],_0x2c59f5=[..._0xa7b568[_0x2da244(0x12f)]['purchase_quantity']],_0x281650=[..._0xa7b568['body'][_0x2da244(0x1b5)]],_0x397189=[..._0xa7b568['body'][_0x2da244(0x1f6)]],_0x2d4ed1=[..._0xa7b568[_0x2da244(0x12f)][_0x2da244(0x1be)]],_0x3450d7=[..._0xa7b568[_0x2da244(0x12f)][_0x2da244(0x1ca)]],_0x38dc37=[..._0xa7b568[_0x2da244(0x12f)][_0x2da244(0x208)]],_0xe86c4c=[..._0xa7b568['body']['types']],_0xc57b5b=[..._0xa7b568['body'][_0x2da244(0x176)]],_0xafc3c5=[..._0xa7b568[_0x2da244(0x12f)][_0x2da244(0x160)]],_0x153d23=[..._0xa7b568[_0x2da244(0x12f)][_0x2da244(0x167)]];const _0x463f28=_0x4472e6[_0x2da244(0x1eb)](_0x2f8375=>{return _0x2f8375={'product_name':_0x2f8375};});_0x2c59f5['forEach']((_0x3d5e4c,_0x5c0506)=>{var _0x5e63c7=_0x2da244;_0x463f28[_0x5c0506][_0x5e63c7(0x15b)]=_0x3d5e4c;}),_0x281650[_0x2da244(0x23f)]((_0x320265,_0x587857)=>{_0x463f28[_0x587857]['stock_quantity']=_0x320265;}),_0x397189[_0x2da244(0x23f)]((_0x8bc540,_0xab176a)=>{_0x463f28[_0xab176a]['return_qty']=_0x8bc540;}),_0x2d4ed1[_0x2da244(0x23f)]((_0x2d0448,_0x2f54ec)=>{_0x463f28[_0x2f54ec]['bay']=_0x2d0448;}),_0x3450d7['forEach']((_0x3847dc,_0x1802a8)=>{var _0x3a820c=_0x2da244;_0x463f28[_0x1802a8][_0x3a820c(0x127)]=_0x3847dc;}),_0x38dc37[_0x2da244(0x23f)]((_0x14f1aa,_0x25e0e4)=>{var _0x35b70c=_0x2da244;_0x463f28[_0x25e0e4][_0x35b70c(0x12c)]=_0x14f1aa;}),_0xe86c4c[_0x2da244(0x23f)]((_0x2368d8,_0x48312f)=>{var _0x34ed95=_0x2da244;_0x463f28[_0x48312f][_0x34ed95(0x207)]=_0x2368d8;}),_0xc57b5b[_0x2da244(0x23f)]((_0x580a92,_0x40ad8b)=>{_0x463f28[_0x40ad8b]['product_code']=_0x580a92;}),_0xafc3c5['forEach']((_0x309eb2,_0x27b162)=>{var _0x4d1966=_0x2da244;_0x463f28[_0x27b162][_0x4d1966(0x195)]=_0x309eb2;}),_0x153d23[_0x2da244(0x23f)]((_0x1479ae,_0x259b55)=>{var _0x47dec5=_0x2da244;_0x463f28[_0x259b55][_0x47dec5(0x1cd)]=_0x1479ae;}),_0x29e8ab[_0x2da244(0x213)][_0x2da244(0x23f)](_0x57f218=>{var _0x27bdd2=_0x2da244;const _0x345be8=_0x9c80f4[_0x27bdd2(0x19f)][_0x27bdd2(0x1eb)](_0x50348c=>{var _0x39758e=_0x27bdd2;_0x50348c['product_name']==_0x57f218[_0x39758e(0x1bc)]&&_0x50348c[_0x39758e(0x12c)]==_0x57f218['floorlevel']&&_0x50348c[_0x39758e(0x207)]==_0x57f218[_0x39758e(0x207)]&&_0x50348c['bin']==_0x57f218[_0x39758e(0x127)]&&_0x50348c['bay']==_0x57f218[_0x39758e(0x145)]&&_0x50348c[_0x39758e(0x1ae)]==_0x57f218[_0x39758e(0x1ae)]&&_0x50348c[_0x39758e(0x1c2)]==_0x57f218[_0x39758e(0x1c2)]&&(console['log'](parseInt(_0x50348c[_0x39758e(0x1ed)])+_0x39758e(0x238)+parseInt(_0x57f218['quantity'])),_0x50348c[_0x39758e(0x1ed)]=parseInt(_0x50348c[_0x39758e(0x1ed)])+parseInt(_0x57f218[_0x39758e(0x193)]));});}),await _0x9c80f4['save']();const _0x520c8e=_0x463f28[_0x2da244(0x1f4)](_0x32b004=>_0x32b004[_0x2da244(0x1f6)]!=='0'&&_0x32b004[_0x2da244(0x1f6)]!=='');var _0x14386e=0x0;_0x520c8e['forEach'](_0x1fa004=>{var _0x3c0c9a=_0x2da244;console[_0x3c0c9a(0x196)]('foreach\x20newproduct',_0x1fa004),(parseInt(_0x1fa004[_0x3c0c9a(0x15b)])<parseInt(_0x1fa004[_0x3c0c9a(0x1f6)])||parseInt(_0x1fa004[_0x3c0c9a(0x241)])<parseInt(_0x1fa004[_0x3c0c9a(0x1f6)]))&&_0x14386e++;});if(_0x14386e!=0x0)return _0xa7b568[_0x2da244(0x227)]('errors',_0x2da244(0x147)),_0x1f999a[_0x2da244(0x20d)]('back');const _0x3205e2=new purchases_return({'invoice':_0x52d616,'suppliers':_0xa7b568[_0x2da244(0x12f)]['suppliers'],'date':_0x256d19,'warehouse_name':_0x109279,'return_product':_0x520c8e,'note':_0x5d1bc5,'room':_0x52a1b9,'to_warehouse_name':_0x4998e8,'to_room':_0x4da2ca}),_0x4d8de6=await _0x3205e2[_0x2da244(0x21a)]();console[_0x2da244(0x196)](_0x3205e2);const _0xff3910=await purchases_return[_0x2da244(0x17b)]({'invoice':_0x52d616}),_0x4b81c2=await warehouse[_0x2da244(0x17b)]({'name':_0x4998e8,'room':_0x4da2ca});_0xff3910[_0x2da244(0x1dd)][_0x2da244(0x23f)](_0x2601da=>{var _0x3df032=_0x2da244,_0x235f4b=0x0;const _0x59c875=_0x4b81c2[_0x3df032(0x19f)][_0x3df032(0x1eb)](_0x46d02f=>{var _0x37b623=_0x3df032;_0x46d02f[_0x37b623(0x1bc)]==_0x2601da[_0x37b623(0x1bc)]&&_0x46d02f[_0x37b623(0x12c)]==_0x2601da['floorlevel']&&_0x46d02f[_0x37b623(0x207)]==_0x2601da[_0x37b623(0x207)]&&_0x46d02f[_0x37b623(0x127)]==_0x2601da['bin']&&_0x46d02f[_0x37b623(0x145)]==_0x2601da[_0x37b623(0x145)]&&(_0x46d02f[_0x37b623(0x1ed)]=parseInt(_0x46d02f['product_stock'])-parseInt(_0x2601da[_0x37b623(0x1f6)]),_0x235f4b++);});_0x235f4b=='0'&&(_0x4b81c2['product_details']=_0x4b81c2[_0x3df032(0x19f)]['concat']({'product_name':_0x2601da[_0x3df032(0x1bc)],'product_stock':_0x2601da[_0x3df032(0x1f6)],'primary_code':_0x2601da[_0x3df032(0x195)],'secondary_code':_0x2601da[_0x3df032(0x1cd)],'product_code':_0x2601da[_0x3df032(0x1c8)],'storage':_0x2601da[_0x3df032(0x1c2)],'rack':_0x2601da[_0x3df032(0x1ae)],'bay':_0x2601da[_0x3df032(0x145)],'bin':_0x2601da['bin'],'type':_0x2601da[_0x3df032(0x207)],'floorlevel':_0x2601da['floorlevel'],'maxProducts':_0x2601da[_0x3df032(0x19c)],'unit':_0x2601da['standard_unit'],'secondary_unit':_0x2601da[_0x3df032(0x182)],'expiry_date':_0x2601da[_0x3df032(0x1b4)]}));}),await _0x4b81c2[_0x2da244(0x21a)]();const _0x48c9e7=await purchases[_0x2da244(0x17b)]({'invoice':_0x52d616});_0x48c9e7[_0x2da244(0x1f7)]=_0x2da244(0x19d);const _0x41a208=await _0x48c9e7[_0x2da244(0x21a)](),_0x38bdda=new s_payment_data({'invoice':_0x52d616,'suppliers':_0xa7b568[_0x2da244(0x12f)][_0x2da244(0x1e9)],'reason':_0x2da244(0x186)});await _0x38bdda[_0x2da244(0x21a)]();const _0x316386=await master_shop[_0x2da244(0x1f0)]();console[_0x2da244(0x196)](_0x2da244(0x1b2),_0x316386[0x0][_0x2da244(0x1bd)]);const _0x3e73a1=await email_settings['findOne'](),_0x4a9f05=await suppliers[_0x2da244(0x17b)]({'name':_0xa7b568['body'][_0x2da244(0x1e9)]});console[_0x2da244(0x196)](_0x2da244(0x18c),_0x4a9f05);_0x316386[0x0]['currency_placement']==0x1?(right_currency=_0x316386[0x0][_0x2da244(0x1c9)],left_currency=''):(right_currency='',left_currency=_0x316386[0x0][_0x2da244(0x1c9)]);var _0xbd2e70=_0x4472e6,_0x14d350=_0x397189,_0xe4425e='',_0x51486c;for(_0x51486c in _0xbd2e70){_0xe4425e+='<tr>'+_0x2da244(0x1d4)+_0xbd2e70[_0x51486c]+_0x2da244(0x239)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x14d350[_0x51486c]+_0x2da244(0x239)+'</tr>';}console[_0x2da244(0x196)]('product_list',_0xe4425e);let _0x248525=nodemailer[_0x2da244(0x1f5)]({'service':_0x2da244(0x1a5),'auth':{'user':_0x3e73a1[_0x2da244(0x171)],'pass':_0x3e73a1[_0x2da244(0x14f)]}}),_0x34862f={'from':_0x3e73a1['email'],'to':_0x4a9f05[_0x2da244(0x171)],'subject':_0x2da244(0x1e2),'attachments':[{'filename':_0x2da244(0x23c),'path':__dirname+_0x2da244(0x1d2)+_0x2da244(0x170)+_0x316386[0x0][_0x2da244(0x1bd)],'cid':_0x2da244(0x1de)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x2da244(0x1fc)+_0x2da244(0x162)+_0x2da244(0x140)+_0x2da244(0x162)+_0x2da244(0x13f)+_0x2da244(0x1ea)+_0x2da244(0x162)+_0x2da244(0x22c)+_0x316386[0x0][_0x2da244(0x189)]+'\x20</h2>'+_0x2da244(0x1ea)+_0x2da244(0x1ea)+_0x2da244(0x1c0)+_0x2da244(0x162)+_0x2da244(0x134)+_0x2da244(0x20c)+_0x52d616+'\x20'+_0x2da244(0x142)+'\x20Order\x20Date\x20:\x20'+_0x256d19+'\x20'+_0x2da244(0x23a)+_0x2da244(0x215)+_0x2da244(0x1ea)+_0x2da244(0x1df)+_0x2da244(0x230)+_0x2da244(0x1b3)+_0x2da244(0x1ad)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x2da244(0x128)+_0x2da244(0x21e)+_0x2da244(0x124)+_0x2da244(0x187)+_0x2da244(0x236)+'\x20'+_0xe4425e+'\x20'+_0x2da244(0x17d)+_0x2da244(0x21f)+_0x2da244(0x162)+'<strong>\x20Regards\x20</strong>'+_0x2da244(0x21c)+_0x316386[0x0][_0x2da244(0x189)]+_0x2da244(0x215)+_0x2da244(0x1ea)+_0x2da244(0x1ea)+_0x2da244(0x201)};_0x248525['sendMail'](_0x34862f,function(_0x43a9a7,_0x4b8077){var _0xfa5c8b=_0x2da244;_0x43a9a7?(console[_0xfa5c8b(0x196)](_0x43a9a7),console[_0xfa5c8b(0x196)](_0xfa5c8b(0x1c6))):console[_0xfa5c8b(0x196)](_0xfa5c8b(0x13b));}),_0xa7b568['flash']('success',_0x2da244(0x1f3)),_0x1f999a[_0x2da244(0x20d)](_0x2da244(0x155));}catch(_0x36aea9){console[_0x2da244(0x196)](_0x36aea9),_0x1f999a[_0x2da244(0x164)](0xc8)[_0x2da244(0x15f)]({'message':_0x36aea9[_0x2da244(0x149)]});}}),router[a0_0x48bae8(0x1a0)](a0_0x48bae8(0x13d),auth,async(_0xedfae0,_0x1741bc)=>{var _0x333600=a0_0x48bae8;try{const {username:_0x19dd04,email:_0x4bad52,role:_0x259ab9}=_0xedfae0[_0x333600(0x18a)],_0x5befbf=_0xedfae0[_0x333600(0x18a)],_0x5afe52=await profile[_0x333600(0x17b)]({'email':_0x5befbf[_0x333600(0x171)]}),_0x474c3d=await master_shop[_0x333600(0x1f0)](),_0x213d0f=_0xedfae0[_0x333600(0x211)]['id'],_0x585eb4=await purchases['findById'](_0x213d0f);if(_0x474c3d[0x0]['language']==_0x333600(0x15c))var _0x281253=users['English'];else{if(_0x474c3d[0x0][_0x333600(0x141)]=='Hindi')var _0x281253=users[_0x333600(0x18f)];else{if(_0x474c3d[0x0][_0x333600(0x141)]=='German')var _0x281253=users[_0x333600(0x1b1)];else{if(_0x474c3d[0x0][_0x333600(0x141)]==_0x333600(0x154))var _0x281253=users[_0x333600(0x154)];else{if(_0x474c3d[0x0][_0x333600(0x141)]==_0x333600(0x1c1))var _0x281253=users['French'];else{if(_0x474c3d[0x0]['language']=='Portuguese\x20(BR)')var _0x281253=users['Portuguese'];else{if(_0x474c3d[0x0][_0x333600(0x141)]=='Chinese')var _0x281253=users[_0x333600(0x181)];else{if(_0x474c3d[0x0][_0x333600(0x141)]==_0x333600(0x212))var _0x281253=users['Arabic'];}}}}}}}_0x1741bc[_0x333600(0x139)](_0x333600(0x174),{'success':_0xedfae0['flash']('success'),'errors':_0xedfae0[_0x333600(0x227)](_0x333600(0x14b)),'role':_0x5befbf,'profile':_0x5afe52,'alldata':_0x585eb4,'master_shop':_0x474c3d,'language':_0x281253}),console[_0x333600(0x196)](alldata);}catch(_0x54171f){console[_0x333600(0x196)](_0x54171f);}}),router[a0_0x48bae8(0x228)](a0_0x48bae8(0x1da),async(_0x49400d,_0x3f15af)=>{var _0xbbd495=a0_0x48bae8;const {product_code:_0x44ca80}=_0x49400d['body'];var _0x103969;const _0x53a73d=await product['aggregate']([{'$match':{'primary_code':_0x44ca80,'product_category':_0xbbd495(0x1b7)}},{'$group':{'_id':_0xbbd495(0x14d),'name':{'$first':'$name'},'category':{'$first':_0xbbd495(0x1d1)},'brand':{'$first':_0xbbd495(0x169)},'unit':{'$first':_0xbbd495(0x1a3)},'alertquantity':{'$first':_0xbbd495(0x1e3)},'product_code':{'$first':_0xbbd495(0x1a8)},'primary_code':{'$first':_0xbbd495(0x178)},'secondary_code':{'$first':_0xbbd495(0x12a)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0xbbd495(0x221)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xbbd495(0x184)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5a9e4a=await product['aggregate']([{'$match':{'secondary_code':_0x44ca80,'product_category':_0xbbd495(0x1b7)}},{'$group':{'_id':_0xbbd495(0x14d),'name':{'$first':_0xbbd495(0x235)},'category':{'$first':'$category'},'brand':{'$first':_0xbbd495(0x169)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0xbbd495(0x1e3)},'product_code':{'$first':_0xbbd495(0x1a8)},'primary_code':{'$first':_0xbbd495(0x178)},'secondary_code':{'$first':_0xbbd495(0x12a)},'maxStocks':{'$first':_0xbbd495(0x138)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xbbd495(0x184)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x53a73d[_0xbbd495(0x1fb)]>0x0)_0x103969=_0x53a73d;else _0x5a9e4a[_0xbbd495(0x1fb)]>0x0&&(_0x103969=_0x5a9e4a);_0x3f15af[_0xbbd495(0x15f)](_0x103969);}),router['post'](a0_0x48bae8(0x1b0),async(_0x417470,_0x5c76fc)=>{var _0x4f9d02=a0_0x48bae8;const {primaryCode:_0x217d3b,secondaryCode:_0x46797f,productCode:_0x594d05,bay:_0x5e80c3,bin:_0x189604,types:_0x585d37,pallet:_0x1b80ae,warehouses:_0x335e5a,room:_0x32aa85}=_0x417470[_0x4f9d02(0x12f)];console['log'](_0x417470['body']);try{const _0x43b54f=await warehouse['aggregate']([{'$match':{'name':_0x335e5a,'room':_0x32aa85}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x5e80c3,'product_details.bin':_0x189604,'product_details.type':_0x585d37}},{'$group':{'_id':_0x4f9d02(0x133),'name':{'$first':_0x4f9d02(0x13e)},'product_stock':{'$first':_0x4f9d02(0x1d8)},'level':{'$first':_0x4f9d02(0x18b)},'isle':{'$first':_0x4f9d02(0x20b)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x4f9d02(0x1cb)}}}]);_0x5c76fc[_0x4f9d02(0x164)](0xc8)[_0x4f9d02(0x15f)](_0x43b54f);}catch(_0x2d236c){_0x5c76fc['status'](0x194)['json']({'message':_0x2d236c['message']});}}),module[a0_0x48bae8(0x190)]=router;