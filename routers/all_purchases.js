var a0_0x697a60=a0_0x8086;function a0_0x8086(_0x548e1b,_0x5c17bd){var _0x175958=a0_0x1759();return a0_0x8086=function(_0x808667,_0x3bfbe2){_0x808667=_0x808667-0x1ec;var _0xb22c96=_0x175958[_0x808667];return _0xb22c96;},a0_0x8086(_0x548e1b,_0x5c17bd);}(function(_0xc5bcda,_0x383143){var _0x1f4f70=a0_0x8086,_0x4b5eec=_0xc5bcda();while(!![]){try{var _0x52e448=parseInt(_0x1f4f70(0x240))/0x1+parseInt(_0x1f4f70(0x279))/0x2*(-parseInt(_0x1f4f70(0x239))/0x3)+parseInt(_0x1f4f70(0x200))/0x4+parseInt(_0x1f4f70(0x23b))/0x5*(-parseInt(_0x1f4f70(0x242))/0x6)+parseInt(_0x1f4f70(0x26c))/0x7*(-parseInt(_0x1f4f70(0x2f2))/0x8)+-parseInt(_0x1f4f70(0x243))/0x9+parseInt(_0x1f4f70(0x2ad))/0xa;if(_0x52e448===_0x383143)break;else _0x4b5eec['push'](_0x4b5eec['shift']());}catch(_0x50160d){_0x4b5eec['push'](_0x4b5eec['shift']());}}}(a0_0x1759,0x3e446));function a0_0x1759(){var _0x56dccb=['purchase_invoice','abs','$product_details.floorlevel','Chinese','Return\x20Goods','</body></html>','40352JZyIrW','stock_quantity','error','flash','all','quantity','$invoice','prod_isle','suppliers_data','<tr>','/upload/','$finalize','due_amount','$primary_code','$maxStocks','prod_qty','image','redirect','<h2>\x20','$product.quantity','<h5>','INC-','\x20Order\x20Number\x20:\x20','Email\x20sent\x20successfully','True','errors','warehouse','secondary_code','product_code','then','\x20<\x20wew\x20>\x20','$product_details.product_name','table\x20page','prod_cat','standard_unit','bin','bay','</head><body>','nodemailer','concat','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details','/all_purchases/view','$product.floorlevel','email','length','</tbody>','2024136NeyMbL','type','level','save','isle','Portuguese','get','getFullYear','post','</td>','</thead>','/preview/:id','JO_number','product_name','$product_details.bay','$secondary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','$product.bay','floorlevel','$paid_amount','floor','here','$_id','user','catch','prod_code','pallet','amount','Floor','</table>','secondary_unit','add\x20post','prod_secondunit','Enabled','sendMail','alertQTY','/view/add_purchases','Purchase\x20Return','\x20<>\x20','Arabic\x20(ae)','<h5\x20style=\x22text-align:\x20left;\x22>','push','stocks','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.secondary_code','maxperunit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','DRY\x20STORAGE','body','$expiry_date','Rack\x20D','warehouse_name','Rack\x20F','MaxStocks_data','/view/return_purchase/:id','An\x20error\x20occurred.','249BNEIiY','return_data','15bLlmHO','actual_qty','suppliers','expiry_date','Rack\x20A','203866lGVhaO','$return_data','462246pcTvap','2518740tKBScE','room_name','$name','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','maxStocks','primary_code_hide','/../public','status','/barcode_scanner','path','random','Purchase\x20Return\x20Mail','$product_details.level','Purchase\x20data\x20added\x20successfully','</tr>','deliverycode','/view/add_purchases/:id','site_title','$due_amount','product_code_hide','all_purchases_barcode','logo','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Ambient','log','map','$product_details.rack','storage','paid_amount','$date','message','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<hr\x20class=\x22my-3\x22>','exports','Room_name','Portuguese\x20(BR)','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/CheckingWarehouse','287bzefzk','</div>','types','Paid\x20For\x20Purchase','host','Arabic','staff','RMSEmail','date_data','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','../middleware/auth','/view','Error\x20Occurs','8826VhhHvd','<strong>\x20Regards\x20</strong>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','RoomAssign','../public/language/languages.json','$brand','role','render','German','Enclosed','return_qty','Purchase\x20Mail','POnumber','$category','delivery_date','$product_details.expiry_date','Receiving\x20Area','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$warehouse_name','prod_unit','find','prod_pallet','<!DOCTYPE\x20html>','createTransport','/view/:id','slice','English','rack','Raw\x20Materials','prod_invoice','language','invoice','product_cat','getDate','French','delivery_code','product','purchase_quantity','primary_code','$suppliers_docs','max_product_unit','$alertquantity','currency','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','edit_purchases_view','$secondary_unit','Router','success','English\x20(US)','$note','/barcode/:id','6292120OquOBR','COLD\x20STORAGE','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','actual_uom','Level','production_date','password','currency_placement','<span\x20style=\x22float:\x20right;\x22>','name','/invoice/:id','$product_details._id','Rack\x20C','port','back','prod_Qty','<div>','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</h5>','$room','$product.type','return_purchase','$product_code','/give_payment/:id','date','$product.bin','</span>','Rack\x20B','getMonth','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','prod_level','product_stock','$unit','$product','room','product_details','findById','params','$product.room_name','secondary_code_hide','$suppliers','finalize','add_purchases','suppliers_docs','$product_details.type','\x20</h2>','$batch_code','master','string','Hindi','$product_details.product_stock','Spanish','$product_details.bin','note','prod_primunit','aggregate','$product_details.product_code','rak','filter','stock_data','Logo.png'];a0_0x1759=function(){return _0x56dccb;};return a0_0x1759();}const express=require('express'),app=express(),router=express[a0_0x697a60(0x2a8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x697a60(0x276)),nodemailer=require(a0_0x697a60(0x1f7));var ejs=require('ejs');const path=require(a0_0x697a60(0x24d)),users=require(a0_0x697a60(0x27d));router[a0_0x697a60(0x206)](a0_0x697a60(0x277),auth,async(_0x247d2e,_0x59f99a)=>{var _0x5a8ec3=a0_0x697a60;try{const {username:_0x215913,email:_0x520b34,role:_0x1d3b96}=_0x247d2e[_0x5a8ec3(0x217)],_0x4eb48b=_0x247d2e[_0x5a8ec3(0x217)],_0x5549c8=await profile[_0x5a8ec3(0x2be)]({'email':_0x4eb48b[_0x5a8ec3(0x1fd)]}),_0x40d14d=await staff[_0x5a8ec3(0x2be)]({'email':_0x4eb48b[_0x5a8ec3(0x1fd)]});if(_0x4eb48b[_0x5a8ec3(0x27f)]==_0x5a8ec3(0x272)){const _0x5159ed=await staff[_0x5a8ec3(0x2be)]({'email':_0x4eb48b['email']});}const _0x291355=await master_shop[_0x5a8ec3(0x28e)]();let _0x466c0e;if(_0x4eb48b[_0x5a8ec3(0x27f)]==_0x5a8ec3(0x272)){const _0x2379e9=await staff['findOne']({'email':_0x4eb48b['email']});_0x466c0e=await purchases[_0x5a8ec3(0x2e6)]([{'$match':{'warehouse_name':_0x2379e9['warehouse']}},{'$lookup':{'from':'suppliers','localField':_0x5a8ec3(0x23d),'foreignField':_0x5a8ec3(0x2b6),'as':_0x5a8ec3(0x2da)}},{'$unwind':_0x5a8ec3(0x2a1)},{'$unwind':_0x5a8ec3(0x2d0)},{'$group':{'_id':_0x5a8ec3(0x216),'invoice':{'$first':_0x5a8ec3(0x2f8)},'suppliers':{'$first':_0x5a8ec3(0x2d7)},'date':{'$first':_0x5a8ec3(0x262)},'warehouse_name':{'$first':_0x5a8ec3(0x28c)},'room':{'$first':_0x5a8ec3(0x2c1)},'product':{'$push':_0x5a8ec3(0x2d0)},'note':{'$first':_0x5a8ec3(0x2ab)},'paid_amount':{'$first':_0x5a8ec3(0x213)},'due_amount':{'$first':_0x5a8ec3(0x256)},'return_data':{'$first':_0x5a8ec3(0x241)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x5a8ec3(0x2a1)},'total_product_quantity':{'$sum':_0x5a8ec3(0x305)},'level':{'$addToSet':_0x5a8ec3(0x211)},'isle':{'$addToSet':_0x5a8ec3(0x2c7)},'type':{'$addToSet':_0x5a8ec3(0x2c2)},'floorlevel':{'$addToSet':_0x5a8ec3(0x1fc)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x466c0e=await purchases['aggregate']([{'$lookup':{'from':_0x5a8ec3(0x23d),'localField':_0x5a8ec3(0x23d),'foreignField':_0x5a8ec3(0x2b6),'as':'suppliers_docs'}},{'$unwind':_0x5a8ec3(0x2a1)},{'$unwind':_0x5a8ec3(0x2d0)},{'$group':{'_id':_0x5a8ec3(0x216),'invoice':{'$first':_0x5a8ec3(0x2f8)},'suppliers':{'$first':_0x5a8ec3(0x2d7)},'date':{'$first':_0x5a8ec3(0x262)},'warehouse_name':{'$first':_0x5a8ec3(0x28c)},'room':{'$addToSet':_0x5a8ec3(0x2d5)},'product':{'$push':_0x5a8ec3(0x2d0)},'note':{'$first':_0x5a8ec3(0x2ab)},'paid_amount':{'$first':_0x5a8ec3(0x213)},'due_amount':{'$first':_0x5a8ec3(0x256)},'return_data':{'$first':_0x5a8ec3(0x241)},'batch_code':{'$first':_0x5a8ec3(0x2dd)},'expiry_date':{'$first':_0x5a8ec3(0x232)},'suppliers_docs':{'$first':_0x5a8ec3(0x2a1)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x5a8ec3(0x211)},'isle':{'$addToSet':_0x5a8ec3(0x2c7)},'type':{'$addToSet':_0x5a8ec3(0x2c2)},'floorlevel':{'$addToSet':_0x5a8ec3(0x1fc)},'finalize':{'$first':_0x5a8ec3(0x2fd)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x291355[0x0][_0x5a8ec3(0x298)]=='English\x20(US)'){var _0x2b37bb=users['English'];console[_0x5a8ec3(0x25d)](_0x2b37bb);}else{if(_0x291355[0x0][_0x5a8ec3(0x298)]==_0x5a8ec3(0x2e0))var _0x2b37bb=users[_0x5a8ec3(0x2e0)];else{if(_0x291355[0x0]['language']==_0x5a8ec3(0x281))var _0x2b37bb=users[_0x5a8ec3(0x281)];else{if(_0x291355[0x0][_0x5a8ec3(0x298)]==_0x5a8ec3(0x2e2))var _0x2b37bb=users[_0x5a8ec3(0x2e2)];else{if(_0x291355[0x0][_0x5a8ec3(0x298)]==_0x5a8ec3(0x29c))var _0x2b37bb=users[_0x5a8ec3(0x29c)];else{if(_0x291355[0x0][_0x5a8ec3(0x298)]==_0x5a8ec3(0x268))var _0x2b37bb=users[_0x5a8ec3(0x205)];else{if(_0x291355[0x0][_0x5a8ec3(0x298)]==_0x5a8ec3(0x2ef))var _0x2b37bb=users['Chinese'];else{if(_0x291355[0x0][_0x5a8ec3(0x298)]==_0x5a8ec3(0x227))var _0x2b37bb=users['Arabic'];}}}}}}}_0x59f99a[_0x5a8ec3(0x280)]('all_purchases',{'success':_0x247d2e['flash'](_0x5a8ec3(0x2a9)),'errors':_0x247d2e['flash'](_0x5a8ec3(0x30b)),'purchases':_0x466c0e,'role':_0x4eb48b,'profile':_0x5549c8,'master_shop':_0x291355,'language':_0x2b37bb});}catch(_0x55eecb){console[_0x5a8ec3(0x25d)](_0x5a8ec3(0x1f1),_0x55eecb),_0x59f99a['status'](0xc8)[_0x5a8ec3(0x28a)]({'message':_0x55eecb[_0x5a8ec3(0x263)]});}});function BayBinSelected(_0x49e23f,_0x4f4bd6){var _0xd26c4c=a0_0x697a60,_0x10631b=[],_0x381183=[],_0x310b33=[],_0x19a938=[],_0x588407=[],_0xd85222=[];let _0x228b01=[];if(_0x49e23f==_0xd26c4c(0x230))switch(_0x4f4bd6){case _0xd26c4c(0x23f):_0x10631b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x381183=[0x1,0x2],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=['Level',_0xd26c4c(0x21c)],_0x588407=['D'],_0xd85222=['A'];break;case _0xd26c4c(0x2c9):_0x10631b=[0x6,0x5,0x4,0x3,0x2,0x1],_0x381183=[0x1,0x2],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=[_0xd26c4c(0x2b1),'Floor'],_0x588407=['D'],_0xd85222=['B'];break;case _0xd26c4c(0x2cb):_0x10631b=[0x0],_0x381183=[0x0],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=['Floor'],_0x588407=['D'],_0xd85222=['S'];break;case _0xd26c4c(0x289):_0x10631b=[0x0],_0x381183=[0x0],_0x19a938=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x310b33=[_0xd26c4c(0x21c)],_0x588407=['D'],_0xd85222=['R'];break;}else{if(_0x49e23f==_0xd26c4c(0x2ae))switch(_0x4f4bd6){case _0xd26c4c(0x23f):_0x10631b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x381183=['B','F'],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=[_0xd26c4c(0x2b1),_0xd26c4c(0x21c)],_0x588407=['C'],_0xd85222=['A'];break;case _0xd26c4c(0x2c9):_0x10631b=[0x5,0x4,0x3,0x2,0x1],_0x381183=['F','B','S'],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=['Level',_0xd26c4c(0x21c)],_0x588407=['C'],_0xd85222=['B'];break;case _0xd26c4c(0x2b9):_0x10631b=[0x1,0x2,0x3,0x4,0x5],_0x381183=['B','F','S'],_0x19a938=[0x5,0x4,0x3,0x2,0x1],_0x310b33=['Level',_0xd26c4c(0x21c)],_0x588407=['C'],_0xd85222=['C'];break;case _0xd26c4c(0x233):_0x10631b=[0x5,0x4,0x3,0x2,0x1],_0x381183=['F','B','S'],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=['Level',_0xd26c4c(0x21c)],_0x588407=['C'],_0xd85222=['D'];break;case'Rack\x20E':_0x10631b=[0x4,0x3,0x2,0x1],_0x381183=[0x1,0x2],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=[_0xd26c4c(0x2b1),'Floor'],_0x588407=['C'],_0xd85222=['E'];break;case _0xd26c4c(0x235):_0x10631b=[0x1,0x2,0x3],_0x381183=[0x1,0x2],_0x19a938=[0x1,0x2,0x3,0x4,0x5],_0x310b33=[_0xd26c4c(0x2b1)],_0x588407=['C'],_0xd85222=['F'];break;}}return{'levels':_0x10631b,'Isle':_0x381183,'rack':_0x19a938,'type':_0x310b33,'storage':_0x588407,'rak':_0xd85222};}async function getRandom8DigitNumber(){var _0xda05f4=a0_0x697a60;const _0x4b3e35=0x989680,_0x233918=0x5f5e0ff,_0x201ec5=Math[_0xda05f4(0x214)](Math[_0xda05f4(0x24e)]()*(_0x233918-_0x4b3e35+0x1))+_0x4b3e35;var _0x329d3a;const _0x2361ec=await purchases['findOne']({'invoice':'INC-'+_0x201ec5});return _0x2361ec&&_0x2361ec[_0xda05f4(0x1fe)]>0x0?_0x329d3a=_0xda05f4(0x307)+_0x201ec5:_0x329d3a='INC-'+_0x201ec5,_0x329d3a;}router[a0_0x697a60(0x206)]('/view/add_purchases',auth,async(_0x2dac1c,_0x49bfc7)=>{var _0x2b9c03=a0_0x697a60;try{const {username:_0x2d0837,email:_0x375f59,role:_0x1660af}=_0x2dac1c[_0x2b9c03(0x217)],_0x1ac4cd=_0x2dac1c[_0x2b9c03(0x217)],_0x471fef=await profile[_0x2b9c03(0x2be)]({'email':_0x1ac4cd[_0x2b9c03(0x1fd)]}),_0x491ec0=await master_shop['find'](),_0x2b9a45=await staff[_0x2b9c03(0x2be)]({'email':_0x1ac4cd['email']}),_0x3948bc=await suppliers['find']({});let _0x51098e;if(_0x1ac4cd[_0x2b9c03(0x27f)]==_0x2b9c03(0x272)){const _0x511dd8=await staff[_0x2b9c03(0x2be)]({'email':_0x1ac4cd[_0x2b9c03(0x1fd)]});_0x51098e=await warehouse['aggregate']([{'$match':{'status':_0x2b9c03(0x221),'name':_0x511dd8[_0x2b9c03(0x30c)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2b9c03(0x2f0)}}},{'$group':{'_id':_0x2b9c03(0x245),'name':{'$first':_0x2b9c03(0x245)}}}]);}else _0x51098e=await warehouse['aggregate']([{'$match':{'status':_0x2b9c03(0x221),'warehouse_category':_0x2b9c03(0x296),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2b9c03(0x245),'name':{'$first':_0x2b9c03(0x245)}}}]);const _0x3b7ec0=await product['find']({}),_0x19f727=await warehouse['find']({'status':_0x2b9c03(0x221)}),_0x1c651f=await purchases[_0x2b9c03(0x28e)]({}),_0x652ba0=_0x1c651f[_0x2b9c03(0x1fe)]+0x1,_0x2410d2=_0x2b9c03(0x307)+_0x652ba0['toString']()['padStart'](0x5,'0');var _0x2dcd4a=[_0x2b9c03(0x25c),_0x2b9c03(0x282)];if(_0x491ec0[0x0][_0x2b9c03(0x298)]==_0x2b9c03(0x2aa))var _0x4a2b3f=users[_0x2b9c03(0x294)];else{if(_0x491ec0[0x0][_0x2b9c03(0x298)]==_0x2b9c03(0x2e0))var _0x4a2b3f=users['Hindi'];else{if(_0x491ec0[0x0][_0x2b9c03(0x298)]==_0x2b9c03(0x281))var _0x4a2b3f=users[_0x2b9c03(0x281)];else{if(_0x491ec0[0x0]['language']=='Spanish')var _0x4a2b3f=users['Spanish'];else{if(_0x491ec0[0x0]['language']=='French')var _0x4a2b3f=users[_0x2b9c03(0x29c)];else{if(_0x491ec0[0x0][_0x2b9c03(0x298)]==_0x2b9c03(0x268))var _0x4a2b3f=users['Portuguese'];else{if(_0x491ec0[0x0][_0x2b9c03(0x298)]==_0x2b9c03(0x2ef))var _0x4a2b3f=users['Chinese'];else{if(_0x491ec0[0x0][_0x2b9c03(0x298)]=='Arabic\x20(ae)')var _0x4a2b3f=users[_0x2b9c03(0x271)];}}}}}}}const _0x5c86fc=getRandom8DigitNumber();_0x5c86fc[_0x2b9c03(0x1ee)](_0x30f668=>{var _0x52e267=_0x2b9c03;_0x49bfc7['render'](_0x52e267(0x2d9),{'success':_0x2dac1c['flash']('success'),'errors':_0x2dac1c[_0x52e267(0x2f5)](_0x52e267(0x30b)),'role':_0x1ac4cd,'profile':_0x471fef,'suppliers':_0x3948bc,'warehouse':_0x51098e,'product':_0x3b7ec0,'invoice':_0x30f668,'master_shop':_0x491ec0,'language':_0x4a2b3f,'find_data':_0x19f727,'rooms_data':_0x2dcd4a});})['catch'](_0x400b96=>{var _0x3bfd0e=_0x2b9c03;_0x2dac1c['flash'](_0x3bfd0e(0x30b),_0x3bfd0e(0x1f9)),_0x49bfc7[_0x3bfd0e(0x303)](_0x3bfd0e(0x1fb));});}catch(_0x4f8bf4){console[_0x2b9c03(0x25d)](_0x4f8bf4);}}),router[a0_0x697a60(0x206)](a0_0x697a60(0x254),auth,async(_0x18bc33,_0x581a52)=>{var _0x46c43c=a0_0x697a60;try{const _0x5b544a=_0x18bc33['params']['id'];console['log'](_0x5b544a);const _0x2363e8=await master_shop['find']();console[_0x46c43c(0x25d)](_0x46c43c(0x2de),_0x2363e8);const _0xfb59f0=await product[_0x46c43c(0x2be)]({'name':_0x5b544a});console[_0x46c43c(0x25d)]('product',_0xfb59f0),_0x581a52[_0x46c43c(0x24b)](0xc8)[_0x46c43c(0x28a)]({'product_data':_0xfb59f0,'master':_0x2363e8});}catch(_0x25de40){console['log']('add_purchases\x20error',_0x25de40);}}),router[a0_0x697a60(0x208)](a0_0x697a60(0x224),auth,async(_0x22da29,_0x586bd8)=>{var _0x3503d4=a0_0x697a60;try{const {invoice:_0x429069,date:_0xcdee48,warehouse_name:_0x35569a,prod_name:_0x6e2b2f,prod_code:_0x2acd76,prod_qty:_0xcaab9c,prod_unit:_0x192821,prod_secondunit:_0x4545dc,prod_level:_0x1b2448,prod_isle:_0x230c38,prod_pallet:_0x38f566,note:_0x1aaa79,expiry_date:_0x1157da,batch_code:_0x3b9cbb,payable:_0xf63cc1,due_amount:_0x8e2365,Room_name:_0x18ed4f,primary_code:_0x2ff6a5,secondary_code:_0x5ca6ca,MaxStocks_data:_0x2c010c,PO_number:_0x276d58,SCRN:_0x248e1b,JO_number:_0x1bc1b2}=_0x22da29[_0x3503d4(0x231)];if(typeof _0x6e2b2f==_0x3503d4(0x2df))var _0xe823a3=[_0x22da29['body'][_0x3503d4(0x269)]],_0xb89b4e=[_0x22da29['body'][_0x3503d4(0x219)]],_0x402573=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2bc)]],_0x16c97e=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2e5)]],_0x299c86=[_0x22da29['body']['prod_secondunit']],_0x29b290=[_0x22da29[_0x3503d4(0x231)]['prod_level']],_0x37f33d=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2a0)]],_0x638d99=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x1ec)]],_0x38c997=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x236)]],_0x62eac5=[_0x22da29['body']['batch_code']],_0x1059a3=[_0x22da29[_0x3503d4(0x231)]['expiry_date']],_0x30089f=[_0x22da29['body']['max_product_unit']],_0x1c904a=[_0x22da29[_0x3503d4(0x231)]['alertQTY']],_0x2c83ab=[_0x22da29['body']['production_date']],_0x3a3702=[_0x22da29[_0x3503d4(0x231)]['prod_cat']],_0x2b3e3b=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x27c)]],_0x12a938=[_0x22da29[_0x3503d4(0x231)]['deliverycode']],_0x2f9dae=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x297)]],_0x439fbf=[_0x22da29[_0x3503d4(0x231)]['actual_qty']],_0x18d9a9=[_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2b0)]];else var _0xe823a3=[..._0x22da29['body'][_0x3503d4(0x269)]],_0xb89b4e=[..._0x22da29[_0x3503d4(0x231)]['prod_code']],_0x402573=[..._0x22da29['body'][_0x3503d4(0x2bc)]],_0x16c97e=[..._0x22da29['body'][_0x3503d4(0x2e5)]],_0x299c86=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x220)]],_0x29b290=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2cd)]],_0x37f33d=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2a0)]],_0x638d99=[..._0x22da29['body'][_0x3503d4(0x1ec)]],_0x38c997=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x236)]],_0x62eac5=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x22b)]],_0x1059a3=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x23e)]],_0x30089f=[..._0x22da29['body'][_0x3503d4(0x2a2)]],_0x1c904a=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x223)]],_0x2c83ab=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2b2)]],_0x3a3702=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x1f2)]],_0x2b3e3b=[..._0x22da29[_0x3503d4(0x231)]['RoomAssign']],_0x12a938=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x253)]],_0x2f9dae=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x297)]],_0x439fbf=[..._0x22da29['body']['actual_qty']],_0x18d9a9=[..._0x22da29[_0x3503d4(0x231)][_0x3503d4(0x2b0)]];const _0x1eb0bb=_0xe823a3['map'](_0x4ffad7=>{return _0x4ffad7={'product_name':_0x4ffad7};});_0x439fbf[_0x3503d4(0x25a)]((_0x40f1f6,_0x584aec)=>{var _0x2e6a05=_0x3503d4;_0x1eb0bb[_0x584aec][_0x2e6a05(0x23c)]=Math['abs'](_0x40f1f6);}),_0x18d9a9['forEach']((_0x912dcf,_0x19d6f0)=>{var _0x526919=_0x3503d4;_0x1eb0bb[_0x19d6f0][_0x526919(0x2b0)]=_0x912dcf;}),_0xb89b4e['forEach']((_0x572d77,_0x2ac9f8)=>{var _0x194a95=_0x3503d4;_0x1eb0bb[_0x2ac9f8][_0x194a95(0x1ed)]=_0x572d77,_0x1eb0bb[_0x2ac9f8][_0x194a95(0x274)]=_0xcdee48;}),_0x402573[_0x3503d4(0x25a)]((_0x54cca0,_0x479dba)=>{var _0x21fa4b=_0x3503d4;_0x1eb0bb[_0x479dba][_0x21fa4b(0x2f7)]=Math['abs'](_0x54cca0);}),_0x16c97e[_0x3503d4(0x25a)]((_0x50e0bf,_0x9f51ab)=>{var _0x192424=_0x3503d4;_0x1eb0bb[_0x9f51ab][_0x192424(0x1f3)]=_0x50e0bf;}),_0x299c86[_0x3503d4(0x25a)]((_0x43b5a4,_0x5f0d3f)=>{var _0x4ba2c6=_0x3503d4;_0x1eb0bb[_0x5f0d3f][_0x4ba2c6(0x21e)]=_0x43b5a4;}),_0x29b290[_0x3503d4(0x25a)]((_0x2c0625,_0x18a475)=>{var _0x2cf91e=_0x3503d4;_0x2b3e3b[_0x2cf91e(0x25a)]((_0x3c7bd2,_0x1ec5fe)=>{var _0x52b00a=_0x2cf91e;if(_0x3c7bd2==_0x52b00a(0x289)&&_0x18a475==_0x1ec5fe){console[_0x52b00a(0x25d)](_0x3c7bd2+_0x52b00a(0x1ef)+_0x18a475+'\x20<>\x20'+_0x1ec5fe+_0x52b00a(0x226)+_0x2c0625);var _0x1b46e3=_0x2c0625[_0x52b00a(0x293)](0x3);_0x1eb0bb[_0x18a475]['storage']=_0x2c0625[0x0],_0x1eb0bb[_0x18a475][_0x52b00a(0x295)]=_0x2c0625[0x1],_0x1eb0bb[_0x18a475][_0x52b00a(0x1f5)]=0x0,_0x1eb0bb[_0x18a475][_0x52b00a(0x1f4)]=0x0,_0x1eb0bb[_0x18a475][_0x52b00a(0x201)]=_0x52b00a(0x21c),_0x1eb0bb[_0x18a475]['floorlevel']=_0x1b46e3;}else{if(_0x3c7bd2==_0x52b00a(0x2cb)&&_0x18a475==_0x1ec5fe){var _0x1b46e3=_0x2c0625['slice'](0x3);_0x1eb0bb[_0x18a475]['storage']=_0x2c0625[0x0],_0x1eb0bb[_0x18a475][_0x52b00a(0x295)]=_0x2c0625[0x1],_0x1eb0bb[_0x18a475][_0x52b00a(0x1f5)]=0x0,_0x1eb0bb[_0x18a475]['bin']=0x0,_0x1eb0bb[_0x18a475]['type']=_0x52b00a(0x21c),_0x1eb0bb[_0x18a475][_0x52b00a(0x212)]=_0x2c0625[0x5];}else{if(_0x18a475==_0x1ec5fe){if(_0x2c0625[0x0]=='A'&&_0x2c0625[0x1]=='L'&&_0x2c0625[0x2]=='L')console[_0x52b00a(0x25d)](_0x3c7bd2+_0x52b00a(0x226)+_0x18a475+_0x52b00a(0x226)+_0x1ec5fe+_0x52b00a(0x226)+_0x2c0625+_0x52b00a(0x215)),_0x1eb0bb[_0x18a475][_0x52b00a(0x260)]=_0x2c0625[0x0],_0x1eb0bb[_0x18a475][_0x52b00a(0x295)]=_0x2c0625[0x1],_0x1eb0bb[_0x18a475]['bay']=0x0,_0x1eb0bb[_0x18a475][_0x52b00a(0x1f4)]=0x0,_0x1eb0bb[_0x18a475]['type']=_0x52b00a(0x21c),_0x1eb0bb[_0x18a475]['floorlevel']=_0x2c0625[0x3];else{var _0x19ca36;if(_0x2c0625[0x4]=='L')_0x19ca36=_0x52b00a(0x2b1);else _0x2c0625[0x4]=='F'&&(_0x19ca36=_0x52b00a(0x21c));_0x1eb0bb[_0x18a475][_0x52b00a(0x260)]=_0x2c0625[0x0],_0x1eb0bb[_0x18a475][_0x52b00a(0x295)]=_0x2c0625[0x1],_0x1eb0bb[_0x18a475][_0x52b00a(0x1f5)]=_0x2c0625[0x2],_0x1eb0bb[_0x18a475]['bin']=_0x2c0625[0x3],_0x1eb0bb[_0x18a475][_0x52b00a(0x201)]=_0x19ca36,_0x1eb0bb[_0x18a475]['floorlevel']=_0x2c0625[0x5];}}}}});}),_0x37f33d[_0x3503d4(0x25a)]((_0x3313ed,_0x321b53)=>{var _0x3a4caf=_0x3503d4;_0x1eb0bb[_0x321b53][_0x3a4caf(0x2a0)]=_0x3313ed;}),_0x638d99['forEach']((_0x26d2c7,_0x3bdf17)=>{var _0x5cc44a=_0x3503d4;_0x1eb0bb[_0x3bdf17][_0x5cc44a(0x1ec)]=_0x26d2c7;}),_0x38c997[_0x3503d4(0x25a)]((_0x492ddf,_0x56c545)=>{var _0x35f367=_0x3503d4;_0x1eb0bb[_0x56c545][_0x35f367(0x248)]=_0x492ddf;}),_0x62eac5[_0x3503d4(0x25a)]((_0x309eda,_0x3e225e)=>{var _0x1d406f=_0x3503d4;_0x1eb0bb[_0x3e225e][_0x1d406f(0x22b)]=_0x309eda;}),_0x1059a3[_0x3503d4(0x25a)]((_0x4ea1c,_0x365bc0)=>{var _0x200e3b=_0x3503d4;_0x1eb0bb[_0x365bc0][_0x200e3b(0x23e)]=_0x4ea1c;}),_0x30089f['forEach']((_0x5b60b4,_0x33b116)=>{_0x1eb0bb[_0x33b116]['maxperunit']=_0x5b60b4;}),_0x1c904a[_0x3503d4(0x25a)]((_0x4a89d3,_0xadfc36)=>{_0x1eb0bb[_0xadfc36]['alertQTY']=_0x4a89d3;}),_0x2c83ab['forEach']((_0x254dde,_0x5b6d0b)=>{var _0x151bdb=_0x3503d4;_0x1eb0bb[_0x5b6d0b][_0x151bdb(0x2b2)]=_0x254dde;}),_0x3a3702[_0x3503d4(0x25a)]((_0x19d4a2,_0x4c7344)=>{var _0x37c0a6=_0x3503d4;_0x1eb0bb[_0x4c7344][_0x37c0a6(0x29a)]=_0x19d4a2;}),_0x2b3e3b['forEach']((_0x25f13,_0x4e30e8)=>{var _0x50c4c0=_0x3503d4;_0x1eb0bb[_0x4e30e8][_0x50c4c0(0x244)]=_0x25f13;}),_0x12a938[_0x3503d4(0x25a)]((_0x19862b,_0x245ee5)=>{var _0x545e7c=_0x3503d4;_0x1eb0bb[_0x245ee5][_0x545e7c(0x29d)]=_0x19862b;}),_0x2f9dae['forEach']((_0x25eb90,_0x3679c2)=>{_0x1eb0bb[_0x3679c2]['invoice']=_0x25eb90;});const _0x2952a9=_0x2b3e3b['map'](_0x2172f8=>{return _0x2172f8={'room_name':_0x2172f8};}),_0x372b35=_0x1eb0bb['filter'](_0x8ffd3a=>_0x8ffd3a[_0x3503d4(0x2f7)]!=='0'&&_0x8ffd3a[_0x3503d4(0x2f7)]!==''),_0x417db4=new purchases({'invoice':_0x429069,'suppliers':_0x22da29[_0x3503d4(0x231)][_0x3503d4(0x23d)],'date':_0xcdee48,'warehouse_name':_0x35569a,'product':_0x372b35,'note':_0x1aaa79,'due_amount':_0x8e2365,'POnumber':_0x276d58,'SCRN':_0x248e1b,'JO_number':_0x1bc1b2,'roomList':_0x2952a9}),_0xddc5bc=await _0x417db4['save'](),_0x55eb1a=await purchases['findOne']({'invoice':_0x429069}),_0x1305d4=_0x55eb1a[_0x3503d4(0x29e)]['map'](async _0xd97504=>{var _0x3c6bec=_0x3503d4,_0x47d778=await warehouse['findOne']({'name':_0x35569a,'room':_0xd97504[_0x3c6bec(0x244)]}),_0x11cd01=0x0;return _0x47d778['product_details'][_0x3c6bec(0x25a)](_0x24ef90=>{var _0x4a6856=_0x3c6bec;_0x24ef90[_0x4a6856(0x20d)]==_0xd97504['product_name']&&_0x24ef90['floorlevel']==_0xd97504['floorlevel']&&_0x24ef90['type']==_0xd97504[_0x4a6856(0x201)]&&_0x24ef90['bin']==_0xd97504[_0x4a6856(0x1f4)]&&_0x24ef90[_0x4a6856(0x1f5)]==_0xd97504[_0x4a6856(0x1f5)]&&_0x24ef90[_0x4a6856(0x295)]==_0xd97504[_0x4a6856(0x295)]&&_0x24ef90['storage']==_0xd97504[_0x4a6856(0x260)]&&_0x24ef90['expiry_date']==_0xd97504['expiry_date']&&_0x24ef90['batch_code']==_0xd97504['batch_code']&&_0x24ef90[_0x4a6856(0x2b2)]==_0xd97504[_0x4a6856(0x2b2)]&&_0x24ef90[_0x4a6856(0x299)]==_0x55eb1a['invoice']&&(_0x24ef90[_0x4a6856(0x2ce)]+=Math['abs'](_0xd97504[_0x4a6856(0x2f7)]),_0x11cd01++);}),_0x11cd01===0x0&&_0x47d778[_0x3c6bec(0x2d2)][_0x3c6bec(0x229)]({'product_name':_0xd97504['product_name'],'product_stock':Math['abs'](_0xd97504[_0x3c6bec(0x2f7)]),'primary_code':_0xd97504[_0x3c6bec(0x2a0)],'secondary_code':_0xd97504[_0x3c6bec(0x1ec)],'product_code':_0xd97504[_0x3c6bec(0x1ed)],'storage':_0xd97504[_0x3c6bec(0x260)],'rack':_0xd97504['rack'],'bay':_0xd97504[_0x3c6bec(0x1f5)],'bin':_0xd97504['bin'],'type':_0xd97504['type'],'floorlevel':_0xd97504['floorlevel'],'maxProducts':_0xd97504[_0x3c6bec(0x248)],'unit':_0xd97504[_0x3c6bec(0x1f3)],'secondary_unit':_0xd97504['secondary_unit'],'expiry_date':_0xd97504['expiry_date'],'maxPerUnit':_0xd97504[_0x3c6bec(0x22e)],'batch_code':_0xd97504[_0x3c6bec(0x22b)],'alertQTY':_0xd97504[_0x3c6bec(0x223)],'production_date':_0xd97504['production_date'],'product_cat':_0xd97504[_0x3c6bec(0x29a)],'invoice':_0xd97504[_0x3c6bec(0x299)],'actual_qty':Math[_0x3c6bec(0x2ed)](_0xd97504[_0x3c6bec(0x23c)]),'actual_uom':_0xd97504[_0x3c6bec(0x2b0)]}),_0x47d778;});Promise[_0x3503d4(0x2f6)](_0x1305d4)[_0x3503d4(0x1ee)](async _0x48d47b=>{var _0x445a03=_0x3503d4;try{for(const _0x2e2c17 of _0x48d47b){await _0x2e2c17[_0x445a03(0x203)]();}const _0x319b40=await master_shop['find'](),_0x3135c0=await email_settings[_0x445a03(0x2be)](),_0x51e9b0=await supervisor_settings['find']();var _0x1f4c73=_0x55eb1a[_0x445a03(0x29e)],_0x896b63='',_0x6b3534;for(_0x6b3534 in _0x1f4c73){_0x896b63+=_0x445a03(0x2fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f4c73[_0x6b3534][_0x445a03(0x20d)]+_0x445a03(0x209)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f4c73[_0x6b3534]['product_code']+_0x445a03(0x209)+_0x445a03(0x22f)+_0x1f4c73[_0x6b3534][_0x445a03(0x2f7)]+_0x445a03(0x209)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f4c73[_0x6b3534]['standard_unit']+_0x445a03(0x209)+_0x445a03(0x22f)+_0x1f4c73[_0x6b3534][_0x445a03(0x21e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x55eb1a['warehouse_name']+_0x445a03(0x209)+_0x445a03(0x22f)+_0x1f4c73[_0x6b3534]['room_name']+_0x445a03(0x209)+_0x445a03(0x22f)+_0x1f4c73[_0x6b3534]['storage']+_0x1f4c73[_0x6b3534][_0x445a03(0x295)]+_0x1f4c73[_0x6b3534][_0x445a03(0x1f5)]+_0x1f4c73[_0x6b3534][_0x445a03(0x1f4)]+_0x1f4c73[_0x6b3534][_0x445a03(0x201)][0x0]+_0x1f4c73[_0x6b3534]['floorlevel']+_0x445a03(0x209),'</tr>';}let _0x422d77=nodemailer['createTransport']({'host':_0x3135c0[_0x445a03(0x270)],'port':Number(_0x3135c0[_0x445a03(0x2ba)]),'secure':![],'auth':{'user':_0x3135c0[_0x445a03(0x1fd)],'pass':_0x3135c0['password']}}),_0x1dbd57={'from':_0x3135c0[_0x445a03(0x1fd)],'to':_0x51e9b0[0x0][_0x445a03(0x273)],'subject':_0x445a03(0x284),'attachments':[{'filename':_0x445a03(0x2eb),'path':__dirname+'/../public'+'/upload/'+_0x319b40[0x0][_0x445a03(0x302)],'cid':_0x445a03(0x259)}],'html':_0x445a03(0x290)+'<html><head><title></title>'+'</head><body>'+_0x445a03(0x2bd)+_0x445a03(0x2a5)+'<div>'+_0x445a03(0x264)+'</div>'+'<div>'+_0x445a03(0x304)+_0x319b40[0x0][_0x445a03(0x255)]+_0x445a03(0x2dc)+_0x445a03(0x26d)+_0x445a03(0x26d)+_0x445a03(0x265)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x445a03(0x308)+_0x55eb1a[_0x445a03(0x299)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x55eb1a[_0x445a03(0x2c6)]+'\x20'+_0x445a03(0x2c8)+'</h5>'+_0x445a03(0x26d)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x445a03(0x27b)+_0x445a03(0x2fb)+_0x445a03(0x25b)+_0x445a03(0x26a)+_0x445a03(0x2bf)+_0x445a03(0x28b)+_0x445a03(0x247)+_0x445a03(0x2af)+_0x445a03(0x2cc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x445a03(0x252)+'</thead>'+_0x445a03(0x210)+'\x20'+_0x896b63+'\x20'+_0x445a03(0x1ff)+_0x445a03(0x21d)+'<div>'+_0x445a03(0x27a)+_0x445a03(0x306)+_0x319b40[0x0][_0x445a03(0x255)]+_0x445a03(0x2c0)+_0x445a03(0x26d)+_0x445a03(0x26d)+_0x445a03(0x2f1)};_0x422d77[_0x445a03(0x222)](_0x1dbd57,function(_0x3f5f37,_0x11a49d){var _0x3f523d=_0x445a03;_0x3f5f37?(console['log'](_0x3f5f37),console[_0x3f523d(0x25d)](_0x3f523d(0x278))):console[_0x3f523d(0x25d)](_0x3f523d(0x309));}),_0x22da29[_0x445a03(0x2f5)]('success',_0x445a03(0x251)),_0x586bd8['redirect']('/all_purchases/view/');}catch(_0x2b0b7f){console[_0x445a03(0x2f4)](_0x2b0b7f),_0x586bd8[_0x445a03(0x24b)](0x1f4)[_0x445a03(0x28a)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3503d4(0x218)](_0x5769ea=>{var _0x1cb5bc=_0x3503d4;console['error'](_0x5769ea),_0x586bd8[_0x1cb5bc(0x24b)](0x1f4)['json']({'error':_0x1cb5bc(0x238)});});}catch(_0x55d8d7){console[_0x3503d4(0x25d)](_0x55d8d7);}}),router[a0_0x697a60(0x206)](a0_0x697a60(0x20b),auth,async(_0x536039,_0x273764)=>{var _0x233403=a0_0x697a60;try{const {username:_0x15df1b,email:_0x445308,role:_0x2885bf}=_0x536039['user'],_0x166618=_0x536039[_0x233403(0x217)],_0x57f188=await profile[_0x233403(0x2be)]({'email':_0x166618[_0x233403(0x1fd)]}),_0x4fba4=await master_shop['find'](),_0x54830c=_0x536039[_0x233403(0x2d4)]['id'],_0x478e4b=await purchases[_0x233403(0x2d3)](_0x54830c),_0x12c21e=await warehouse[_0x233403(0x2e6)]([{'$match':{'name':_0x478e4b[_0x233403(0x234)],'room':_0x478e4b[_0x233403(0x2d1)]}},{'$unwind':_0x233403(0x1fa)},{'$group':{'_id':_0x233403(0x2b8),'name':{'$first':_0x233403(0x1f0)},'product_stock':{'$first':_0x233403(0x2e1)},'bay':{'$first':_0x233403(0x20e)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x233403(0x22d)},'product_code':{'$first':_0x233403(0x2e7)},'storage':{'$first':_0x233403(0x246)},'rack':{'$first':_0x233403(0x25f)},'expiry_date':{'$first':_0x233403(0x288)}}}]),_0x387227=await customer['find']({});let _0x435273;if(_0x166618[_0x233403(0x27f)]==_0x233403(0x272)){const _0x413b1d=await staff[_0x233403(0x2be)]({'email':_0x166618[_0x233403(0x1fd)]});_0x435273=await warehouse['aggregate']([{'$match':{'status':_0x233403(0x221),'name':_0x413b1d[_0x233403(0x30c)]}},{'$group':{'_id':'$name','name':{'$first':_0x233403(0x245)}}}]);}else _0x435273=await warehouse[_0x233403(0x2e6)]([{'$match':{'status':_0x233403(0x221)}},{'$group':{'_id':_0x233403(0x245),'name':{'$first':'$name'}}}]);const _0x2851bc=await product[_0x233403(0x28e)]({}),_0x56da11=await suppliers[_0x233403(0x28e)]({}),_0x2d2bb4=BayBinSelected(_0x478e4b[_0x233403(0x234)],_0x478e4b[_0x233403(0x2d1)]);if(_0x4fba4[0x0]['language']==_0x233403(0x2aa)){var _0x113d85=users[_0x233403(0x294)];console[_0x233403(0x25d)](_0x113d85);}else{if(_0x4fba4[0x0]['language']=='Hindi')var _0x113d85=users['Hindi'];else{if(_0x4fba4[0x0][_0x233403(0x298)]==_0x233403(0x281))var _0x113d85=users[_0x233403(0x281)];else{if(_0x4fba4[0x0]['language']==_0x233403(0x2e2))var _0x113d85=users[_0x233403(0x2e2)];else{if(_0x4fba4[0x0][_0x233403(0x298)]=='French')var _0x113d85=users[_0x233403(0x29c)];else{if(_0x4fba4[0x0]['language']==_0x233403(0x268))var _0x113d85=users['Portuguese'];else{if(_0x4fba4[0x0][_0x233403(0x298)]==_0x233403(0x2ef))var _0x113d85=users['Chinese'];else{if(_0x4fba4[0x0][_0x233403(0x298)]==_0x233403(0x227))var _0x113d85=users['Arabic'];}}}}}}}_0x273764['render'](_0x233403(0x2a6),{'success':_0x536039[_0x233403(0x2f5)](_0x233403(0x2a9)),'errors':_0x536039['flash']('errors'),'role':_0x166618,'profile':_0x57f188,'customer':_0x387227,'warehouse':_0x435273,'product':_0x12c21e,'user':_0x478e4b,'master_shop':_0x4fba4,'unit':_0x2851bc,'language':_0x113d85,'suppliers':_0x56da11,'dataSelected':_0x2d2bb4});}catch(_0x38e833){console[_0x233403(0x25d)](_0x38e833);}}),router[a0_0x697a60(0x208)](a0_0x697a60(0x20b),auth,async(_0x24ebba,_0x162e90)=>{var _0x2ca2e0=a0_0x697a60;try{const _0x4a986b=_0x24ebba[_0x2ca2e0(0x2d4)]['id'],{invoice:_0x4dcfff,warehouse_name:_0x504761,Room_name:_0x3cb133}=_0x24ebba[_0x2ca2e0(0x231)],_0x582d0f=await warehouse[_0x2ca2e0(0x2be)]({'name':_0x504761,'room':_0x3cb133}),_0x55528f=await purchases[_0x2ca2e0(0x2be)]({'invoice':_0x4dcfff});_0x55528f[_0x2ca2e0(0x29e)][_0x2ca2e0(0x25a)](_0x870c92=>{var _0x377c97=_0x2ca2e0,_0x3366e1=0x0;const _0x3ef447=_0x582d0f[_0x377c97(0x2d2)]['map'](_0x585bed=>{var _0x564eee=_0x377c97;_0x585bed[_0x564eee(0x20d)]==_0x870c92['product_name']&&_0x585bed[_0x564eee(0x212)]==_0x870c92['floorlevel']&&_0x585bed[_0x564eee(0x201)]==_0x870c92[_0x564eee(0x201)]&&_0x585bed[_0x564eee(0x1f4)]==_0x870c92[_0x564eee(0x1f4)]&&_0x585bed[_0x564eee(0x1f5)]==_0x870c92[_0x564eee(0x1f5)]&&_0x585bed[_0x564eee(0x295)]==_0x870c92[_0x564eee(0x295)]&&_0x585bed[_0x564eee(0x260)]==_0x870c92[_0x564eee(0x260)]&&_0x585bed[_0x564eee(0x23e)]==_0x870c92['expiry_date']&&_0x585bed[_0x564eee(0x22b)]==_0x870c92[_0x564eee(0x22b)]&&_0x585bed[_0x564eee(0x2b2)]==_0x870c92['production_date']&&_0x585bed[_0x564eee(0x287)]==_0x870c92['delivery_date']&&_0x585bed[_0x564eee(0x29d)]==_0x870c92[_0x564eee(0x29d)]&&(_0x585bed['product_stock']=parseInt(_0x585bed[_0x564eee(0x2ce)])+parseInt(_0x870c92[_0x564eee(0x2f7)]),_0x3366e1++);});_0x3366e1=='0'&&(_0x582d0f[_0x377c97(0x2d2)]=_0x582d0f['product_details']['concat']({'product_name':_0x870c92[_0x377c97(0x20d)],'product_stock':_0x870c92[_0x377c97(0x2f7)],'primary_code':_0x870c92['primary_code'],'secondary_code':_0x870c92[_0x377c97(0x1ec)],'product_code':_0x870c92[_0x377c97(0x1ed)],'storage':_0x870c92['storage'],'rack':_0x870c92[_0x377c97(0x295)],'bay':_0x870c92['bay'],'bin':_0x870c92[_0x377c97(0x1f4)],'type':_0x870c92[_0x377c97(0x201)],'floorlevel':_0x870c92[_0x377c97(0x212)],'maxProducts':_0x870c92[_0x377c97(0x248)],'unit':_0x870c92[_0x377c97(0x1f3)],'secondary_unit':_0x870c92[_0x377c97(0x21e)],'expiry_date':_0x870c92[_0x377c97(0x23e)],'maxPerUnit':_0x870c92[_0x377c97(0x22e)],'batch_code':_0x870c92[_0x377c97(0x22b)],'alertQTY':_0x870c92['alertQTY'],'production_date':_0x870c92[_0x377c97(0x2b2)],'delivery_date':_0x870c92[_0x377c97(0x287)],'delivery_code':_0x870c92[_0x377c97(0x29d)]}));}),await _0x582d0f[_0x2ca2e0(0x203)](),_0x55528f[_0x2ca2e0(0x2d8)]=_0x2ca2e0(0x30a);const _0x268b9b=await _0x55528f[_0x2ca2e0(0x203)]();_0x24ebba[_0x2ca2e0(0x2f5)]('success','Sales\x20Update\x20successfully'),_0x162e90[_0x2ca2e0(0x303)]('/all_purchases/view');}catch(_0x5e7721){console[_0x2ca2e0(0x25d)](_0x5e7721);}}),router[a0_0x697a60(0x206)](a0_0x697a60(0x292),auth,async(_0x4feff2,_0x598f7b)=>{var _0x2591c5=a0_0x697a60;try{const {username:_0x35984b,email:_0x3ac368,role:_0x324006}=_0x4feff2[_0x2591c5(0x217)],_0x448c90=_0x4feff2[_0x2591c5(0x217)],_0x3f0b47=await profile[_0x2591c5(0x2be)]({'email':_0x448c90[_0x2591c5(0x1fd)]}),_0x23d8d4=await master_shop[_0x2591c5(0x28e)](),_0x4b35c9=_0x4feff2[_0x2591c5(0x2d4)]['id'],_0x15eb5e=await purchases[_0x2591c5(0x2d3)](_0x4b35c9),_0x244633=await suppliers[_0x2591c5(0x28e)]({});let _0x2548e2;if(_0x448c90[_0x2591c5(0x27f)]==_0x2591c5(0x272)){const _0x332e06=await staff[_0x2591c5(0x2be)]({'email':_0x448c90['email']});_0x2548e2=await warehouse[_0x2591c5(0x28e)]({'status':'Enabled','name':_0x332e06[_0x2591c5(0x30c)],'warehouse_category':_0x2591c5(0x296)});}else _0x2548e2=await warehouse['aggregate']([{'$match':{'status':_0x2591c5(0x221),'warehouse_category':_0x2591c5(0x296)}},{'$group':{'_id':_0x2591c5(0x245),'name':{'$first':_0x2591c5(0x245)}}}]);const _0x2ee9a2=await product['find']({}),_0x4870a7=BayBinSelected(_0x15eb5e[_0x2591c5(0x234)],_0x15eb5e[_0x2591c5(0x2d1)]);let _0x3dd17d=new Date(_0x15eb5e[_0x2591c5(0x23e)]),_0xfc457b=('0'+_0x3dd17d[_0x2591c5(0x29b)]())[_0x2591c5(0x293)](-0x2),_0x40a18b=('0'+(_0x3dd17d[_0x2591c5(0x2ca)]()+0x1))[_0x2591c5(0x293)](-0x2),_0x573df3=_0x3dd17d[_0x2591c5(0x207)](),_0x56e11e=_0x573df3+'-'+_0x40a18b+'-'+_0xfc457b;if(_0x23d8d4[0x0][_0x2591c5(0x298)]==_0x2591c5(0x2aa)){var _0x535dc5=users[_0x2591c5(0x294)];console[_0x2591c5(0x25d)](_0x535dc5);}else{if(_0x23d8d4[0x0]['language']==_0x2591c5(0x2e0))var _0x535dc5=users[_0x2591c5(0x2e0)];else{if(_0x23d8d4[0x0]['language']==_0x2591c5(0x281))var _0x535dc5=users[_0x2591c5(0x281)];else{if(_0x23d8d4[0x0][_0x2591c5(0x298)]==_0x2591c5(0x2e2))var _0x535dc5=users[_0x2591c5(0x2e2)];else{if(_0x23d8d4[0x0]['language']==_0x2591c5(0x29c))var _0x535dc5=users[_0x2591c5(0x29c)];else{if(_0x23d8d4[0x0][_0x2591c5(0x298)]==_0x2591c5(0x268))var _0x535dc5=users[_0x2591c5(0x205)];else{if(_0x23d8d4[0x0][_0x2591c5(0x298)]==_0x2591c5(0x2ef))var _0x535dc5=users[_0x2591c5(0x2ef)];else{if(_0x23d8d4[0x0][_0x2591c5(0x298)]=='Arabic\x20(ae)')var _0x535dc5=users[_0x2591c5(0x271)];}}}}}}}_0x598f7b['render']('edit_purchases',{'success':_0x4feff2['flash'](_0x2591c5(0x2a9)),'errors':_0x4feff2[_0x2591c5(0x2f5)](_0x2591c5(0x30b)),'role':_0x448c90,'profile':_0x3f0b47,'purchases':_0x15eb5e,'suppliers':_0x244633,'warehouse':_0x2548e2,'product':_0x2ee9a2,'master_shop':_0x23d8d4,'language':_0x535dc5,'ed_fullDate':_0x56e11e,'dataSelected':_0x4870a7});}catch(_0x3aafca){console['log'](_0x3aafca);}}),router['post'](a0_0x697a60(0x292),auth,async(_0x45b453,_0x1e2a48)=>{var _0xc79429=a0_0x697a60;try{const _0x207a23=_0x45b453[_0xc79429(0x2d4)]['id'],_0x242ab=await purchases[_0xc79429(0x2be)]({'_id':_0x45b453['params']['id']}),_0x6dfeaa=await warehouse[_0xc79429(0x2be)]({'name':_0x242ab['warehouse_name'],'room':_0x242ab[_0xc79429(0x2d1)]});_0x242ab[_0xc79429(0x29e)][_0xc79429(0x25a)](_0x13f219=>{var _0x5f3e27=_0xc79429;const _0x4f3d15=_0x6dfeaa[_0x5f3e27(0x2d2)][_0x5f3e27(0x25e)](_0xcc99c9=>{var _0x7a4248=_0x5f3e27;_0xcc99c9[_0x7a4248(0x20d)]==_0x13f219[_0x7a4248(0x20d)]&&_0xcc99c9['floorlevel']==_0x13f219[_0x7a4248(0x212)]&&_0xcc99c9[_0x7a4248(0x201)]==_0x13f219[_0x7a4248(0x201)]&&_0xcc99c9['bin']==_0x13f219[_0x7a4248(0x1f4)]&&_0xcc99c9[_0x7a4248(0x1f5)]==_0x13f219['bay']&&_0xcc99c9[_0x7a4248(0x295)]==_0x13f219[_0x7a4248(0x295)]&&_0xcc99c9['storage']==_0x13f219[_0x7a4248(0x260)]&&(_0xcc99c9[_0x7a4248(0x2ce)]=parseInt(_0xcc99c9[_0x7a4248(0x2ce)])-parseInt(_0x13f219['quantity']));});}),await _0x6dfeaa[_0xc79429(0x203)]();const {invoice:_0x3e39f,suppliers:_0x383fe0,date:_0x1865c7,warehouse_name:_0x3e28a3,prod_name:_0x72f64e,prod_code:_0x5cb959,prod_qty:_0x5039d8,prod_unit:_0x1d2856,prod_secondunit:_0x5e9358,prod_level:_0x3a31f2,prod_isle:_0x3abb5e,prod_pallet:_0x4155b0,note:_0x2534ad,expiry_date:_0xc225a,batch_code:_0x242a74,paid_amount:_0x125a0c,due_amount:_0x5e9229,Room_name:_0x267c0d,primary_code:_0x205a70,secondary_code:_0x376b98,PO_number:_0x1fa53d,JO_number:_0x196792}=_0x45b453['body'];if(typeof _0x72f64e=='string')var _0x5ece39=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x269)]],_0x3c154b=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x219)]],_0x3f59cc=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x301)]],_0x424481=[_0x45b453['body'][_0xc79429(0x28d)]],_0xc1a274=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x220)]],_0x3e35a6=[_0x45b453['body'][_0xc79429(0x2cd)]],_0x453bef=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x2f9)]],_0x3f7a6b=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x28f)]],_0x318f20=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x2a0)]],_0x17560b=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x1ec)]],_0x5e3d19=[_0x45b453['body']['MaxStocks_data']],_0x1dbbde=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x22b)]],_0x23428d=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x23e)]],_0xb4a4cd=[_0x45b453[_0xc79429(0x231)]['storage']],_0xc75c24=[_0x45b453[_0xc79429(0x231)]['rak']],_0x488382=[_0x45b453[_0xc79429(0x231)][_0xc79429(0x201)]];else var _0x5ece39=[..._0x45b453['body'][_0xc79429(0x269)]],_0x3c154b=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x219)]],_0x3f59cc=[..._0x45b453['body'][_0xc79429(0x301)]],_0x424481=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x28d)]],_0xc1a274=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x220)]],_0x3e35a6=[..._0x45b453['body'][_0xc79429(0x2cd)]],_0x453bef=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x2f9)]],_0x3f7a6b=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x28f)]],_0x318f20=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x2a0)]],_0x17560b=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x1ec)]],_0x5e3d19=[..._0x45b453['body'][_0xc79429(0x236)]],_0x1dbbde=[..._0x45b453[_0xc79429(0x231)]['batch_code']],_0x23428d=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x23e)]],_0xb4a4cd=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x260)]],_0xc75c24=[..._0x45b453[_0xc79429(0x231)][_0xc79429(0x2e8)]],_0x488382=[..._0x45b453[_0xc79429(0x231)]['type']];const _0x43661d=_0x5ece39[_0xc79429(0x25e)](_0x4873fe=>{return _0x4873fe={'product_name':_0x4873fe};});_0x3c154b[_0xc79429(0x25a)]((_0x271bac,_0x1a45c8)=>{var _0x2d9b66=_0xc79429;_0x43661d[_0x1a45c8][_0x2d9b66(0x1ed)]=_0x271bac;}),_0x3f59cc[_0xc79429(0x25a)]((_0x22bc64,_0x33c65a)=>{var _0x28a319=_0xc79429;_0x43661d[_0x33c65a][_0x28a319(0x2f7)]=_0x22bc64;}),_0x424481[_0xc79429(0x25a)]((_0x5427b4,_0x70e89f)=>{var _0xfb7ba8=_0xc79429;_0x43661d[_0x70e89f][_0xfb7ba8(0x1f3)]=_0x5427b4;}),_0xc1a274[_0xc79429(0x25a)]((_0x5598b5,_0x416a52)=>{var _0x1a1284=_0xc79429;_0x43661d[_0x416a52][_0x1a1284(0x21e)]=_0x5598b5;}),_0x3e35a6[_0xc79429(0x25a)]((_0x578f22,_0x363dff)=>{var _0x3f41f6=_0xc79429;_0x43661d[_0x363dff][_0x3f41f6(0x1f5)]=_0x578f22;}),_0x453bef[_0xc79429(0x25a)]((_0x5bd54c,_0x53e55c)=>{_0x43661d[_0x53e55c]['bin']=_0x5bd54c;}),_0x3f7a6b['forEach']((_0x47a6b7,_0x47d02d)=>{var _0x125262=_0xc79429;_0x43661d[_0x47d02d][_0x125262(0x212)]=_0x47a6b7;}),_0x318f20[_0xc79429(0x25a)]((_0x48d15e,_0x31b025)=>{var _0x3007ba=_0xc79429;_0x43661d[_0x31b025][_0x3007ba(0x2a0)]=_0x48d15e;}),_0x17560b[_0xc79429(0x25a)]((_0x59b47a,_0x451be1)=>{var _0x4207f6=_0xc79429;_0x43661d[_0x451be1][_0x4207f6(0x1ec)]=_0x59b47a;}),_0x5e3d19['forEach']((_0xa16fc5,_0x20be58)=>{var _0x522ec6=_0xc79429;_0x43661d[_0x20be58][_0x522ec6(0x248)]=_0xa16fc5;}),_0x1dbbde[_0xc79429(0x25a)]((_0x523966,_0x195a46)=>{var _0x161570=_0xc79429;_0x43661d[_0x195a46][_0x161570(0x22b)]=_0x523966;}),_0x23428d[_0xc79429(0x25a)]((_0x44dfbb,_0x5792af)=>{var _0x1c6831=_0xc79429;_0x43661d[_0x5792af][_0x1c6831(0x23e)]=_0x44dfbb;}),_0x488382['forEach']((_0x5c1ec1,_0x2af8e5)=>{var _0x1bfc51=_0xc79429;_0x43661d[_0x2af8e5][_0x1bfc51(0x201)]=_0x5c1ec1;}),_0xb4a4cd[_0xc79429(0x25a)]((_0x2b5c86,_0x55f366)=>{var _0x4fa2d9=_0xc79429;_0x43661d[_0x55f366][_0x4fa2d9(0x260)]=_0x2b5c86;}),_0xc75c24[_0xc79429(0x25a)]((_0x1f0981,_0x35d5f2)=>{var _0x5d3701=_0xc79429;_0x43661d[_0x35d5f2][_0x5d3701(0x295)]=_0x1f0981;});const _0x1a8e7a=_0x43661d[_0xc79429(0x2e9)](_0x47f366=>_0x47f366[_0xc79429(0x2f7)]!=='0'&&_0x47f366['quantity']!=='');_0x242ab[_0xc79429(0x299)]=_0x3e39f,_0x242ab['suppliers']=_0x383fe0,_0x242ab['date']=_0x1865c7,_0x242ab['warehouse_name']=_0x3e28a3,_0x242ab[_0xc79429(0x29e)]=_0x1a8e7a,_0x242ab[_0xc79429(0x2e4)]=_0x2534ad,_0x242ab[_0xc79429(0x261)]=_0x125a0c,_0x242ab[_0xc79429(0x2fe)]=_0x5e9229,_0x242ab['room']=_0x267c0d,_0x242ab[_0xc79429(0x285)]=_0x1fa53d,_0x242ab[_0xc79429(0x20c)]=_0x196792;const _0x58e9ed=await _0x242ab[_0xc79429(0x203)](),_0x4dda60=await warehouse['findOne']({'name':_0x45b453['body'][_0xc79429(0x234)],'room':_0x45b453[_0xc79429(0x231)][_0xc79429(0x267)]});_0x242ab['product'][_0xc79429(0x25a)](_0x3d8e28=>{var _0x474e9a=_0xc79429,_0x34689f=0x0;const _0x1e92a9=_0x4dda60['product_details']['map'](_0x16c82c=>{var _0x246f63=a0_0x8086;_0x16c82c[_0x246f63(0x20d)]==_0x3d8e28[_0x246f63(0x20d)]&&_0x16c82c[_0x246f63(0x212)]==_0x3d8e28['floorlevel']&&_0x16c82c['type']==_0x3d8e28[_0x246f63(0x201)]&&_0x16c82c[_0x246f63(0x1f4)]==_0x3d8e28[_0x246f63(0x1f4)]&&_0x16c82c[_0x246f63(0x1f5)]==_0x3d8e28['bay']&&_0x16c82c[_0x246f63(0x295)]==_0x3d8e28['rack']&&_0x16c82c[_0x246f63(0x260)]==_0x3d8e28['storage']&&(_0x16c82c[_0x246f63(0x2ce)]=parseInt(_0x16c82c['product_stock'])+parseInt(_0x3d8e28[_0x246f63(0x2f7)]),_0x34689f++);});_0x34689f=='0'&&(_0x4dda60[_0x474e9a(0x2d2)]=_0x4dda60[_0x474e9a(0x2d2)]['concat']({'product_name':_0x3d8e28[_0x474e9a(0x20d)],'product_stock':_0x3d8e28[_0x474e9a(0x2f7)],'primary_code':_0x3d8e28[_0x474e9a(0x2a0)],'secondary_code':_0x3d8e28['secondary_code'],'product_code':_0x3d8e28[_0x474e9a(0x1ed)],'storage':_0x3d8e28[_0x474e9a(0x260)],'rack':_0x3d8e28[_0x474e9a(0x295)],'bay':_0x3d8e28[_0x474e9a(0x1f5)],'bin':_0x3d8e28[_0x474e9a(0x1f4)],'type':_0x3d8e28[_0x474e9a(0x201)],'floorlevel':_0x3d8e28[_0x474e9a(0x212)],'maxProducts':_0x3d8e28[_0x474e9a(0x248)],'unit':_0x3d8e28[_0x474e9a(0x1f3)],'secondary_unit':_0x3d8e28['secondary_unit'],'expiry_date':_0x3d8e28['expiry_date']}));}),await _0x4dda60[_0xc79429(0x203)]();const _0x1a7680=await s_payment_data[_0xc79429(0x2be)]({'invoice':_0x45b453[_0xc79429(0x231)][_0xc79429(0x299)]});if(_0x1a7680===null){}else console[_0xc79429(0x25d)]('suppliers',_0x1a7680,_0x45b453[_0xc79429(0x231)][_0xc79429(0x299)]),_0x1a7680['suppliers']=_0x45b453[_0xc79429(0x231)][_0xc79429(0x23d)],await _0x1a7680[_0xc79429(0x203)]();_0x45b453[_0xc79429(0x2f5)](_0xc79429(0x2a9),'purchase\x20data\x20update\x20successfully'),_0x1e2a48[_0xc79429(0x303)](_0xc79429(0x1fb));}catch(_0x52c0df){console['log'](_0x52c0df);}}),router[a0_0x697a60(0x208)](a0_0x697a60(0x2c5),auth,async(_0x4cda2e,_0x4e765e)=>{var _0x2a8abb=a0_0x697a60;try{const _0x59bd69=_0x4cda2e[_0x2a8abb(0x2d4)]['id'],{invoice:_0x5d0f0a,suppliers:_0x3daa52,payable:_0x17f83b,due_amount:_0x937722}=_0x4cda2e[_0x2a8abb(0x231)],_0x17d6b6=await purchases[_0x2a8abb(0x2d3)](_0x59bd69);var _0x59af50=_0x17f83b-_0x937722;_0x17d6b6[_0x2a8abb(0x261)]=parseFloat(_0x17d6b6[_0x2a8abb(0x261)])+parseFloat(_0x937722),_0x17d6b6[_0x2a8abb(0x2fe)]=_0x59af50;const _0x56c5b1=await _0x17d6b6[_0x2a8abb(0x203)]();console['log'](_0x56c5b1);const _0x147a47=await s_payment_data[_0x2a8abb(0x2be)]({'invoice':_0x5d0f0a});_0x147a47[_0x2a8abb(0x21b)]=_0x59af50,await _0x147a47[_0x2a8abb(0x203)]();let _0x59fe47=new Date(),_0x102d1f=('0'+_0x59fe47[_0x2a8abb(0x29b)]())[_0x2a8abb(0x293)](-0x2),_0x1464bf=('0'+(_0x59fe47[_0x2a8abb(0x2ca)]()+0x1))[_0x2a8abb(0x293)](-0x2),_0x24c411=_0x59fe47[_0x2a8abb(0x207)](),_0x376f94=_0x24c411+'-'+_0x1464bf+'-'+_0x102d1f;const _0x3bec37=new suppliers_payment({'invoice':_0x5d0f0a,'date':_0x24c411+'-'+_0x1464bf+'-'+_0x102d1f,'suppliers':_0x3daa52,'reason':_0x2a8abb(0x26f),'amount':_0x937722}),_0x3450da=await _0x3bec37[_0x2a8abb(0x203)]();_0x4cda2e[_0x2a8abb(0x2f5)](_0x2a8abb(0x2a9),'payment\x20successfull'),_0x4e765e[_0x2a8abb(0x303)](_0x2a8abb(0x1fb));}catch(_0x369f7e){console[_0x2a8abb(0x25d)](_0x369f7e);}}),router[a0_0x697a60(0x206)](a0_0x697a60(0x2b7),auth,async(_0x23c288,_0x159710)=>{var _0xb6aeb1=a0_0x697a60;try{const {username:_0x15c5d4,email:_0x4bca76,role:_0x46a61c}=_0x23c288[_0xb6aeb1(0x217)],_0x8d038b=_0x23c288['user'],_0x50e4fb=await profile[_0xb6aeb1(0x2be)]({'email':_0x8d038b[_0xb6aeb1(0x1fd)]}),_0x948448=await master_shop['find']();console[_0xb6aeb1(0x25d)]('master',_0x948448);const _0x13bd0b=_0x23c288[_0xb6aeb1(0x2d4)]['id'],_0x4346e2=await purchases['findById'](_0x13bd0b);console['log'](_0x4346e2);const _0x29acee=await suppliers['findOne']({'name':_0x4346e2['suppliers']});console[_0xb6aeb1(0x25d)](_0x29acee);if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x2aa)){var _0x542b0=users[_0xb6aeb1(0x294)];console[_0xb6aeb1(0x25d)](_0x542b0);}else{if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x2e0))var _0x542b0=users[_0xb6aeb1(0x2e0)];else{if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x281))var _0x542b0=users[_0xb6aeb1(0x281)];else{if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x2e2))var _0x542b0=users[_0xb6aeb1(0x2e2)];else{if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x29c))var _0x542b0=users[_0xb6aeb1(0x29c)];else{if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x268))var _0x542b0=users['Portuguese'];else{if(_0x948448[0x0][_0xb6aeb1(0x298)]==_0xb6aeb1(0x2ef))var _0x542b0=users['Chinese'];else{if(_0x948448[0x0][_0xb6aeb1(0x298)]=='Arabic\x20(ae)')var _0x542b0=users[_0xb6aeb1(0x271)];}}}}}}}_0x159710[_0xb6aeb1(0x280)](_0xb6aeb1(0x2ec),{'success':_0x23c288[_0xb6aeb1(0x2f5)]('success'),'errors':_0x23c288[_0xb6aeb1(0x2f5)]('errors'),'role':_0x8d038b,'profile':_0x50e4fb,'master_shop':_0x948448,'supplier':_0x29acee,'purchase':_0x4346e2,'language':_0x542b0});}catch(_0x53c5f9){console['log'](_0x53c5f9);}}),router[a0_0x697a60(0x206)](a0_0x697a60(0x237),auth,async(_0x2edb48,_0x1a4550)=>{var _0x1068d4=a0_0x697a60;try{const {username:_0x5462af,email:_0x5a66e7,role:_0x44c070}=_0x2edb48[_0x1068d4(0x217)],_0x48f7f7=_0x2edb48[_0x1068d4(0x217)],_0x3d26c2=await profile[_0x1068d4(0x2be)]({'email':_0x48f7f7[_0x1068d4(0x1fd)]}),_0x7700d9=await master_shop['find']();console[_0x1068d4(0x25d)](_0x1068d4(0x2de),_0x7700d9);const _0x5e003e=_0x2edb48[_0x1068d4(0x2d4)]['id'];console[_0x1068d4(0x25d)](_0x5e003e);const _0x364e1d=await purchases[_0x1068d4(0x2d3)](_0x5e003e);console[_0x1068d4(0x25d)]('user_id',_0x364e1d);const _0x268068=await product[_0x1068d4(0x28e)]({}),_0x2b0e50=await warehouse[_0x1068d4(0x2e6)]([{'$match':{'name':_0x364e1d['warehouse_name'],'room':_0x364e1d[_0x1068d4(0x2d1)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1068d4(0x1f0)},'product_stock':{'$first':_0x1068d4(0x2e1)},'bay':{'$first':_0x1068d4(0x20e)},'bin':{'$first':_0x1068d4(0x2e3)},'type':{'$first':_0x1068d4(0x2db)},'floorlevel':{'$first':_0x1068d4(0x2ee)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1068d4(0x2e7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1068d4(0x25f)}}}]);warehouse_data=await warehouse[_0x1068d4(0x2e6)]([{'$match':{'status':_0x1068d4(0x221),'name':_0x1068d4(0x2f0),'warehouse_category':_0x1068d4(0x296)}},{'$group':{'_id':_0x1068d4(0x245),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x1068d4(0x25d)](_0x1068d4(0x2ea),_0x2b0e50);if(_0x7700d9[0x0][_0x1068d4(0x298)]==_0x1068d4(0x2aa)){var _0x47c168=users[_0x1068d4(0x294)];console['log'](_0x47c168);}else{if(_0x7700d9[0x0][_0x1068d4(0x298)]=='Hindi')var _0x47c168=users['Hindi'];else{if(_0x7700d9[0x0]['language']==_0x1068d4(0x281))var _0x47c168=users[_0x1068d4(0x281)];else{if(_0x7700d9[0x0][_0x1068d4(0x298)]=='Spanish')var _0x47c168=users[_0x1068d4(0x2e2)];else{if(_0x7700d9[0x0][_0x1068d4(0x298)]==_0x1068d4(0x29c))var _0x47c168=users[_0x1068d4(0x29c)];else{if(_0x7700d9[0x0][_0x1068d4(0x298)]==_0x1068d4(0x268))var _0x47c168=users[_0x1068d4(0x205)];else{if(_0x7700d9[0x0][_0x1068d4(0x298)]==_0x1068d4(0x2ef))var _0x47c168=users[_0x1068d4(0x2ef)];else{if(_0x7700d9[0x0][_0x1068d4(0x298)]=='Arabic\x20(ae)')var _0x47c168=users[_0x1068d4(0x271)];}}}}}}}_0x1a4550[_0x1068d4(0x280)](_0x1068d4(0x2c3),{'success':_0x2edb48['flash'](_0x1068d4(0x2a9)),'errors':_0x2edb48[_0x1068d4(0x2f5)]('errors'),'role':_0x48f7f7,'profile':_0x3d26c2,'user':_0x364e1d,'stock':_0x2b0e50,'master_shop':_0x7700d9,'product':_0x268068,'language':_0x47c168,'warehouse':warehouse_data});}catch(_0x5f3626){console[_0x1068d4(0x25d)](_0x5f3626);}}),router[a0_0x697a60(0x208)]('/view/return_purchase/:id',auth,async(_0x47c562,_0x4d25eb)=>{var _0x3bbdab=a0_0x697a60;try{const {invoice:_0x526d5b,date:_0x4d34fa,warehouse_name:_0x483a8c,Room_name:_0x397765,product_name:_0xbfc26b,purchase_quantity:_0x583bdc,stocks:_0x5a6650,return_qty:_0x42f592,note:_0x3fde52,level:_0x581d51,isle:_0xd016de,pallet:_0x98abf9,to_warehouse_name:_0x5265b5,to_Room_name:_0x4b07c6}=_0x47c562[_0x3bbdab(0x231)],_0x1e4447=await purchases['findOne']({'_id':_0x47c562[_0x3bbdab(0x2d4)]['id']}),_0x4d3d7=await warehouse[_0x3bbdab(0x2be)]({'name':_0x483a8c,'room':_0x397765});if(typeof _0xbfc26b==_0x3bbdab(0x2df))var _0x8e43f4=[_0x47c562[_0x3bbdab(0x231)]['product_name']],_0x17c490=[_0x47c562['body']['purchase_quantity']],_0x39c722=[_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x22a)]],_0x563acd=[_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x283)]],_0x1077e4=[_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x202)]],_0x168097=[_0x47c562[_0x3bbdab(0x231)]['isle']],_0x285d36=[_0x47c562[_0x3bbdab(0x231)]['pallet']],_0x2681bc=[_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x26e)]],_0x51eb68=[_0x47c562['body'][_0x3bbdab(0x257)]],_0x5d1bb8=[_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x249)]],_0x1fdd7a=[_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x2d6)]];else var _0x8e43f4=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x20d)]],_0x17c490=[..._0x47c562['body'][_0x3bbdab(0x29f)]],_0x39c722=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x22a)]],_0x563acd=[..._0x47c562[_0x3bbdab(0x231)]['return_qty']],_0x1077e4=[..._0x47c562['body'][_0x3bbdab(0x202)]],_0x168097=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x204)]],_0x285d36=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x21a)]],_0x2681bc=[..._0x47c562['body']['types']],_0x51eb68=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x257)]],_0x5d1bb8=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x249)]],_0x1fdd7a=[..._0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x2d6)]];const _0x3da4a5=_0x8e43f4[_0x3bbdab(0x25e)](_0x2c8b32=>{return _0x2c8b32={'product_name':_0x2c8b32};});_0x17c490['forEach']((_0x4dec0a,_0x31a666)=>{var _0x4c79ee=_0x3bbdab;_0x3da4a5[_0x31a666][_0x4c79ee(0x29f)]=_0x4dec0a;}),_0x39c722[_0x3bbdab(0x25a)]((_0x41d114,_0x1ee41d)=>{var _0x5435dd=_0x3bbdab;_0x3da4a5[_0x1ee41d][_0x5435dd(0x2f3)]=_0x41d114;}),_0x563acd[_0x3bbdab(0x25a)]((_0x3cce50,_0x359b1b)=>{var _0x528e03=_0x3bbdab;_0x3da4a5[_0x359b1b][_0x528e03(0x283)]=_0x3cce50;}),_0x1077e4[_0x3bbdab(0x25a)]((_0x3268c0,_0x52029e)=>{var _0x10f074=_0x3bbdab;_0x3da4a5[_0x52029e][_0x10f074(0x1f5)]=_0x3268c0;}),_0x168097[_0x3bbdab(0x25a)]((_0x36f9e4,_0x3060ec)=>{_0x3da4a5[_0x3060ec]['bin']=_0x36f9e4;}),_0x285d36[_0x3bbdab(0x25a)]((_0x1ad033,_0x1cf7c3)=>{var _0x51a5e4=_0x3bbdab;_0x3da4a5[_0x1cf7c3][_0x51a5e4(0x212)]=_0x1ad033;}),_0x2681bc[_0x3bbdab(0x25a)]((_0x3377fb,_0x5be9df)=>{_0x3da4a5[_0x5be9df]['type']=_0x3377fb;}),_0x51eb68[_0x3bbdab(0x25a)]((_0x4697be,_0x3e0e14)=>{_0x3da4a5[_0x3e0e14]['product_code']=_0x4697be;}),_0x5d1bb8[_0x3bbdab(0x25a)]((_0x29ec2b,_0x196aa3)=>{var _0x3387a1=_0x3bbdab;_0x3da4a5[_0x196aa3][_0x3387a1(0x2a0)]=_0x29ec2b;}),_0x1fdd7a[_0x3bbdab(0x25a)]((_0x3acb51,_0x5a689c)=>{var _0x3443a7=_0x3bbdab;_0x3da4a5[_0x5a689c][_0x3443a7(0x1ec)]=_0x3acb51;}),_0x1e4447['product'][_0x3bbdab(0x25a)](_0x4f24be=>{var _0x2063b9=_0x3bbdab;const _0x3734f2=_0x4d3d7[_0x2063b9(0x2d2)]['map'](_0x57a9c1=>{var _0x567f6a=_0x2063b9;_0x57a9c1[_0x567f6a(0x20d)]==_0x4f24be[_0x567f6a(0x20d)]&&_0x57a9c1[_0x567f6a(0x212)]==_0x4f24be[_0x567f6a(0x212)]&&_0x57a9c1[_0x567f6a(0x201)]==_0x4f24be['type']&&_0x57a9c1[_0x567f6a(0x1f4)]==_0x4f24be[_0x567f6a(0x1f4)]&&_0x57a9c1[_0x567f6a(0x1f5)]==_0x4f24be[_0x567f6a(0x1f5)]&&_0x57a9c1['rack']==_0x4f24be[_0x567f6a(0x295)]&&_0x57a9c1[_0x567f6a(0x260)]==_0x4f24be[_0x567f6a(0x260)]&&(console[_0x567f6a(0x25d)](parseInt(_0x57a9c1[_0x567f6a(0x2ce)])+'\x20<>\x20'+parseInt(_0x4f24be[_0x567f6a(0x2f7)])),_0x57a9c1[_0x567f6a(0x2ce)]=parseInt(_0x57a9c1[_0x567f6a(0x2ce)])+parseInt(_0x4f24be['quantity']));});}),await _0x4d3d7[_0x3bbdab(0x203)]();const _0x2b433c=_0x3da4a5[_0x3bbdab(0x2e9)](_0x12ea6d=>_0x12ea6d[_0x3bbdab(0x283)]!=='0'&&_0x12ea6d[_0x3bbdab(0x283)]!=='');var _0x120c9e=0x0;_0x2b433c[_0x3bbdab(0x25a)](_0x205452=>{var _0x248eaa=_0x3bbdab;console[_0x248eaa(0x25d)]('foreach\x20newproduct',_0x205452),(parseInt(_0x205452[_0x248eaa(0x29f)])<parseInt(_0x205452[_0x248eaa(0x283)])||parseInt(_0x205452[_0x248eaa(0x2f3)])<parseInt(_0x205452['return_qty']))&&_0x120c9e++;});if(_0x120c9e!=0x0)return _0x47c562[_0x3bbdab(0x2f5)](_0x3bbdab(0x30b),_0x3bbdab(0x275)),_0x4d25eb[_0x3bbdab(0x303)](_0x3bbdab(0x2bb));const _0x54732e=new purchases_return({'invoice':_0x526d5b,'suppliers':_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x23d)],'date':_0x4d34fa,'warehouse_name':_0x483a8c,'return_product':_0x2b433c,'note':_0x3fde52,'room':_0x397765,'to_warehouse_name':_0x5265b5,'to_room':_0x4b07c6}),_0x47cc70=await _0x54732e[_0x3bbdab(0x203)]();console[_0x3bbdab(0x25d)](_0x54732e);const _0x5a11e4=await purchases_return[_0x3bbdab(0x2be)]({'invoice':_0x526d5b}),_0x2dc6af=await warehouse[_0x3bbdab(0x2be)]({'name':_0x5265b5,'room':_0x4b07c6});_0x5a11e4['return_product'][_0x3bbdab(0x25a)](_0xb1d529=>{var _0x13928f=_0x3bbdab,_0x1e88af=0x0;const _0x2e6aa0=_0x2dc6af['product_details'][_0x13928f(0x25e)](_0x2df5dc=>{var _0x287cd9=_0x13928f;_0x2df5dc[_0x287cd9(0x20d)]==_0xb1d529[_0x287cd9(0x20d)]&&_0x2df5dc['floorlevel']==_0xb1d529[_0x287cd9(0x212)]&&_0x2df5dc[_0x287cd9(0x201)]==_0xb1d529[_0x287cd9(0x201)]&&_0x2df5dc['bin']==_0xb1d529[_0x287cd9(0x1f4)]&&_0x2df5dc[_0x287cd9(0x1f5)]==_0xb1d529[_0x287cd9(0x1f5)]&&(_0x2df5dc[_0x287cd9(0x2ce)]=parseInt(_0x2df5dc['product_stock'])-parseInt(_0xb1d529[_0x287cd9(0x283)]),_0x1e88af++);});_0x1e88af=='0'&&(_0x2dc6af[_0x13928f(0x2d2)]=_0x2dc6af[_0x13928f(0x2d2)][_0x13928f(0x1f8)]({'product_name':_0xb1d529[_0x13928f(0x20d)],'product_stock':_0xb1d529[_0x13928f(0x283)],'primary_code':_0xb1d529['primary_code'],'secondary_code':_0xb1d529[_0x13928f(0x1ec)],'product_code':_0xb1d529['product_code'],'storage':_0xb1d529['storage'],'rack':_0xb1d529[_0x13928f(0x295)],'bay':_0xb1d529[_0x13928f(0x1f5)],'bin':_0xb1d529[_0x13928f(0x1f4)],'type':_0xb1d529[_0x13928f(0x201)],'floorlevel':_0xb1d529['floorlevel'],'maxProducts':_0xb1d529['maxStocks'],'unit':_0xb1d529[_0x13928f(0x1f3)],'secondary_unit':_0xb1d529['secondary_unit'],'expiry_date':_0xb1d529[_0x13928f(0x23e)]}));}),await _0x2dc6af[_0x3bbdab(0x203)]();const _0x2c042d=await purchases[_0x3bbdab(0x2be)]({'invoice':_0x526d5b});_0x2c042d[_0x3bbdab(0x23a)]=_0x3bbdab(0x30a);const _0x2b970f=await _0x2c042d['save'](),_0x4177a7=new s_payment_data({'invoice':_0x526d5b,'suppliers':_0x47c562['body'][_0x3bbdab(0x23d)],'reason':_0x3bbdab(0x225)});await _0x4177a7[_0x3bbdab(0x203)]();const _0x185cdb=await master_shop[_0x3bbdab(0x28e)]();console[_0x3bbdab(0x25d)](_0x3bbdab(0x21f),_0x185cdb[0x0][_0x3bbdab(0x302)]);const _0x3fb22b=await email_settings[_0x3bbdab(0x2be)](),_0x42803c=await suppliers[_0x3bbdab(0x2be)]({'name':_0x47c562[_0x3bbdab(0x231)][_0x3bbdab(0x23d)]});console['log'](_0x3bbdab(0x2fa),_0x42803c);_0x185cdb[0x0][_0x3bbdab(0x2b4)]==0x1?(right_currency=_0x185cdb[0x0][_0x3bbdab(0x2a4)],left_currency=''):(right_currency='',left_currency=_0x185cdb[0x0][_0x3bbdab(0x2a4)]);var _0xdc81c1=_0x8e43f4,_0x4837d4=_0x563acd,_0x180efd='',_0x5b28cc;for(_0x5b28cc in _0xdc81c1){_0x180efd+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xdc81c1[_0x5b28cc]+_0x3bbdab(0x209)+_0x3bbdab(0x22f)+_0x4837d4[_0x5b28cc]+'</td>'+'</tr>';}console[_0x3bbdab(0x25d)]('product_list',_0x180efd);let _0xb82ea3=nodemailer[_0x3bbdab(0x291)]({'service':'gmail','auth':{'user':_0x3fb22b[_0x3bbdab(0x1fd)],'pass':_0x3fb22b[_0x3bbdab(0x2b3)]}}),_0x48f35e={'from':_0x3fb22b[_0x3bbdab(0x1fd)],'to':_0x42803c[_0x3bbdab(0x1fd)],'subject':_0x3bbdab(0x24f),'attachments':[{'filename':_0x3bbdab(0x2eb),'path':__dirname+_0x3bbdab(0x24a)+_0x3bbdab(0x2fc)+_0x185cdb[0x0][_0x3bbdab(0x302)],'cid':_0x3bbdab(0x259)}],'html':_0x3bbdab(0x290)+'<html><head><title></title>'+_0x3bbdab(0x1f6)+_0x3bbdab(0x2bd)+_0x3bbdab(0x2a5)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3bbdab(0x26d)+_0x3bbdab(0x2bd)+'<h2>\x20'+_0x185cdb[0x0][_0x3bbdab(0x255)]+_0x3bbdab(0x2dc)+_0x3bbdab(0x26d)+'</div>'+_0x3bbdab(0x265)+'<div>'+_0x3bbdab(0x228)+_0x3bbdab(0x308)+_0x526d5b+'\x20'+_0x3bbdab(0x2b5)+'\x20Order\x20Date\x20:\x20'+_0x4d34fa+'\x20'+_0x3bbdab(0x2c8)+_0x3bbdab(0x2c0)+_0x3bbdab(0x26d)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3bbdab(0x27b)+'<tr>'+_0x3bbdab(0x25b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3bbdab(0x22c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x3bbdab(0x252)+_0x3bbdab(0x20a)+_0x3bbdab(0x210)+'\x20'+_0x180efd+'\x20'+_0x3bbdab(0x1ff)+_0x3bbdab(0x21d)+_0x3bbdab(0x2bd)+_0x3bbdab(0x27a)+'<h5>'+_0x185cdb[0x0]['site_title']+_0x3bbdab(0x2c0)+_0x3bbdab(0x26d)+_0x3bbdab(0x26d)+_0x3bbdab(0x2f1)};_0xb82ea3[_0x3bbdab(0x222)](_0x48f35e,function(_0x2bde61,_0x573657){var _0x7be470=_0x3bbdab;_0x2bde61?(console[_0x7be470(0x25d)](_0x2bde61),console[_0x7be470(0x25d)](_0x7be470(0x278))):console['log']('Email\x20sent\x20successfully');}),_0x47c562[_0x3bbdab(0x2f5)](_0x3bbdab(0x2a9),'purchases\x20item\x20return\x20successfull'),_0x4d25eb['redirect']('/all_purchases/view');}catch(_0x3bdc84){console[_0x3bbdab(0x25d)](_0x3bdc84),_0x4d25eb['status'](0xc8)[_0x3bbdab(0x28a)]({'message':_0x3bdc84[_0x3bbdab(0x263)]});}}),router['get'](a0_0x697a60(0x2ac),auth,async(_0x357776,_0x4c51f1)=>{var _0x4a2d7c=a0_0x697a60;try{const {username:_0x307bb8,email:_0x3f1808,role:_0xd1c397}=_0x357776[_0x4a2d7c(0x217)],_0x1f893f=_0x357776['user'],_0x3c276a=await profile[_0x4a2d7c(0x2be)]({'email':_0x1f893f[_0x4a2d7c(0x1fd)]}),_0x280db7=await master_shop['find'](),_0x853313=_0x357776[_0x4a2d7c(0x2d4)]['id'],_0x3d11b5=await purchases[_0x4a2d7c(0x2d3)](_0x853313);if(_0x280db7[0x0]['language']==_0x4a2d7c(0x2aa))var _0x517028=users['English'];else{if(_0x280db7[0x0][_0x4a2d7c(0x298)]=='Hindi')var _0x517028=users[_0x4a2d7c(0x2e0)];else{if(_0x280db7[0x0][_0x4a2d7c(0x298)]==_0x4a2d7c(0x281))var _0x517028=users[_0x4a2d7c(0x281)];else{if(_0x280db7[0x0]['language']==_0x4a2d7c(0x2e2))var _0x517028=users['Spanish'];else{if(_0x280db7[0x0][_0x4a2d7c(0x298)]==_0x4a2d7c(0x29c))var _0x517028=users['French'];else{if(_0x280db7[0x0][_0x4a2d7c(0x298)]==_0x4a2d7c(0x268))var _0x517028=users[_0x4a2d7c(0x205)];else{if(_0x280db7[0x0][_0x4a2d7c(0x298)]==_0x4a2d7c(0x2ef))var _0x517028=users[_0x4a2d7c(0x2ef)];else{if(_0x280db7[0x0]['language']=='Arabic\x20(ae)')var _0x517028=users[_0x4a2d7c(0x271)];}}}}}}}_0x4c51f1[_0x4a2d7c(0x280)](_0x4a2d7c(0x258),{'success':_0x357776[_0x4a2d7c(0x2f5)](_0x4a2d7c(0x2a9)),'errors':_0x357776[_0x4a2d7c(0x2f5)](_0x4a2d7c(0x30b)),'role':_0x1f893f,'profile':_0x3c276a,'alldata':_0x3d11b5,'master_shop':_0x280db7,'language':_0x517028}),console[_0x4a2d7c(0x25d)](alldata);}catch(_0x2857ff){console['log'](_0x2857ff);}}),router[a0_0x697a60(0x208)](a0_0x697a60(0x24c),async(_0x1b4cca,_0x3a04c5)=>{var _0x40b48b=a0_0x697a60;const {product_code:_0x41c17b}=_0x1b4cca[_0x40b48b(0x231)];var _0x1ce9c2;const _0x2f18e3=await product['aggregate']([{'$match':{'primary_code':_0x41c17b,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x40b48b(0x216),'name':{'$first':_0x40b48b(0x245)},'category':{'$first':_0x40b48b(0x286)},'brand':{'$first':_0x40b48b(0x27e)},'unit':{'$first':_0x40b48b(0x2cf)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x40b48b(0x2c4)},'primary_code':{'$first':_0x40b48b(0x2ff)},'secondary_code':{'$first':_0x40b48b(0x20f)},'maxStocks':{'$first':_0x40b48b(0x300)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x8e2b6b=await product[_0x40b48b(0x2e6)]([{'$match':{'secondary_code':_0x41c17b,'product_category':_0x40b48b(0x296)}},{'$group':{'_id':_0x40b48b(0x216),'name':{'$first':_0x40b48b(0x245)},'category':{'$first':_0x40b48b(0x286)},'brand':{'$first':_0x40b48b(0x27e)},'unit':{'$first':_0x40b48b(0x2cf)},'alertquantity':{'$first':_0x40b48b(0x2a3)},'product_code':{'$first':_0x40b48b(0x2c4)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x40b48b(0x20f)},'maxStocks':{'$first':_0x40b48b(0x300)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x40b48b(0x2a7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2f18e3['length']>0x0)_0x1ce9c2=_0x2f18e3;else _0x8e2b6b[_0x40b48b(0x1fe)]>0x0&&(_0x1ce9c2=_0x8e2b6b);_0x3a04c5['json'](_0x1ce9c2);}),router['post'](a0_0x697a60(0x26b),async(_0x5104d9,_0x12cea2)=>{var _0x1cd657=a0_0x697a60;const {primaryCode:_0x78a62d,secondaryCode:_0x3dd8a4,productCode:_0x2e6d30,bay:_0x14a72f,bin:_0xca8620,types:_0x2cb669,pallet:_0xa4f34e,warehouses:_0x38ce47,room:_0x373441}=_0x5104d9[_0x1cd657(0x231)];console[_0x1cd657(0x25d)](_0x5104d9[_0x1cd657(0x231)]);try{const _0x5d2b14=await warehouse['aggregate']([{'$match':{'name':_0x38ce47,'room':_0x373441}},{'$unwind':_0x1cd657(0x1fa)},{'$match':{'product_details.bay':_0x14a72f,'product_details.bin':_0xca8620,'product_details.type':_0x2cb669}},{'$group':{'_id':_0x1cd657(0x2b8),'name':{'$first':_0x1cd657(0x1f0)},'product_stock':{'$first':_0x1cd657(0x2e1)},'level':{'$first':_0x1cd657(0x250)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x12cea2[_0x1cd657(0x24b)](0xc8)[_0x1cd657(0x28a)](_0x5d2b14);}catch(_0xd55a43){_0x12cea2[_0x1cd657(0x24b)](0x194)[_0x1cd657(0x28a)]({'message':_0xd55a43['message']});}}),module[a0_0x697a60(0x266)]=router;