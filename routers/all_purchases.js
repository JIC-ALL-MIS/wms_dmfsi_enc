var a0_0x5e92ae=a0_0x1ed9;(function(_0x329f88,_0x47b9a8){var _0x278830=a0_0x1ed9,_0x44a797=_0x329f88();while(!![]){try{var _0x3a5934=parseInt(_0x278830(0x14b))/0x1*(parseInt(_0x278830(0x108))/0x2)+parseInt(_0x278830(0x103))/0x3+-parseInt(_0x278830(0x150))/0x4+-parseInt(_0x278830(0x1ca))/0x5+-parseInt(_0x278830(0x1ae))/0x6*(parseInt(_0x278830(0x1ac))/0x7)+-parseInt(_0x278830(0x16f))/0x8*(-parseInt(_0x278830(0x123))/0x9)+parseInt(_0x278830(0x14e))/0xa;if(_0x3a5934===_0x47b9a8)break;else _0x44a797['push'](_0x44a797['shift']());}catch(_0x407624){_0x44a797['push'](_0x44a797['shift']());}}}(a0_0x6146,0x679a4));const express=require(a0_0x5e92ae(0x205)),app=express(),router=express[a0_0x5e92ae(0x157)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x5e92ae(0x120)),auth=require('../middleware/auth'),nodemailer=require(a0_0x5e92ae(0xf8));var ejs=require(a0_0x5e92ae(0x15f));const path=require(a0_0x5e92ae(0x1cf)),users=require(a0_0x5e92ae(0x14c));router['get']('/view',auth,async(_0x2028ac,_0x41a783)=>{var _0x129783=a0_0x5e92ae;try{const {username:_0x176f87,email:_0x20fdec,role:_0x16a015}=_0x2028ac['user'],_0x5a66e1=_0x2028ac[_0x129783(0x10b)],_0x19edd2=await profile['findOne']({'email':_0x5a66e1[_0x129783(0x191)]}),_0x9fe291=await staff[_0x129783(0x18f)]({'email':_0x5a66e1[_0x129783(0x191)]});if(_0x5a66e1['role']==_0x129783(0x165)){const _0xaecd86=await staff[_0x129783(0x18f)]({'email':_0x5a66e1[_0x129783(0x191)]});}const _0x3a1cc4=await master_shop['find']();let _0x950890;if(_0x5a66e1['role']=='staff'){const _0x53cbbc=await staff[_0x129783(0x18f)]({'email':_0x5a66e1[_0x129783(0x191)]});_0x950890=await purchases['aggregate']([{'$match':{'warehouse_name':_0x53cbbc[_0x129783(0x166)]}},{'$lookup':{'from':_0x129783(0x1b9),'localField':_0x129783(0x1b9),'foreignField':_0x129783(0x1c0),'as':_0x129783(0x1e3)}},{'$unwind':_0x129783(0x148)},{'$unwind':_0x129783(0x1cc)},{'$group':{'_id':_0x129783(0x1ee),'invoice':{'$first':_0x129783(0x1f2)},'suppliers':{'$first':_0x129783(0x1e0)},'date':{'$first':_0x129783(0x116)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x129783(0x1cc)},'note':{'$first':_0x129783(0x10f)},'paid_amount':{'$first':_0x129783(0x17a)},'due_amount':{'$first':_0x129783(0x188)},'return_data':{'$first':_0x129783(0x1d2)},'batch_code':{'$first':_0x129783(0x1b8)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x129783(0x148)},'total_product_quantity':{'$sum':_0x129783(0x11a)},'level':{'$addToSet':_0x129783(0x192)},'isle':{'$addToSet':_0x129783(0x1fe)},'type':{'$addToSet':_0x129783(0x146)},'floorlevel':{'$addToSet':_0x129783(0x209)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x950890=await purchases[_0x129783(0x1ba)]([{'$lookup':{'from':_0x129783(0x1b9),'localField':_0x129783(0x1b9),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x129783(0x148)},{'$unwind':_0x129783(0x1cc)},{'$group':{'_id':_0x129783(0x1ee),'invoice':{'$first':_0x129783(0x1f2)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x129783(0x116)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x129783(0x1cc)},'note':{'$first':_0x129783(0x10f)},'paid_amount':{'$first':_0x129783(0x17a)},'due_amount':{'$first':_0x129783(0x188)},'return_data':{'$first':_0x129783(0x1d2)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x129783(0x13c)},'suppliers_docs':{'$first':_0x129783(0x148)},'total_product_quantity':{'$sum':_0x129783(0x11a)},'level':{'$addToSet':_0x129783(0x192)},'isle':{'$addToSet':_0x129783(0x1fe)},'type':{'$addToSet':_0x129783(0x146)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x129783(0x1d9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x3a1cc4[0x0][_0x129783(0x184)]==_0x129783(0x12e)){var _0x26aa20=users[_0x129783(0x1a3)];console[_0x129783(0x1f8)](_0x26aa20);}else{if(_0x3a1cc4[0x0][_0x129783(0x184)]==_0x129783(0x1de))var _0x26aa20=users[_0x129783(0x1de)];else{if(_0x3a1cc4[0x0][_0x129783(0x184)]==_0x129783(0x16b))var _0x26aa20=users[_0x129783(0x16b)];else{if(_0x3a1cc4[0x0][_0x129783(0x184)]==_0x129783(0x1ec))var _0x26aa20=users['Spanish'];else{if(_0x3a1cc4[0x0][_0x129783(0x184)]=='French')var _0x26aa20=users[_0x129783(0xed)];else{if(_0x3a1cc4[0x0][_0x129783(0x184)]=='Portuguese\x20(BR)')var _0x26aa20=users[_0x129783(0x1e9)];else{if(_0x3a1cc4[0x0][_0x129783(0x184)]==_0x129783(0x128))var _0x26aa20=users['Chinese'];else{if(_0x3a1cc4[0x0][_0x129783(0x184)]==_0x129783(0x1c8))var _0x26aa20=users[_0x129783(0x1f7)];}}}}}}}_0x41a783[_0x129783(0x14d)](_0x129783(0x129),{'success':_0x2028ac[_0x129783(0x105)](_0x129783(0x1bd)),'errors':_0x2028ac[_0x129783(0x105)]('errors'),'purchases':_0x950890,'role':_0x5a66e1,'profile':_0x19edd2,'master_shop':_0x3a1cc4,'language':_0x26aa20});}catch(_0x3fa836){console[_0x129783(0x1f8)]('table\x20page',_0x3fa836),_0x41a783[_0x129783(0x190)](0xc8)[_0x129783(0x174)]({'message':_0x3fa836[_0x129783(0xee)]});}});function BayBinSelected(_0xd409c4,_0x22a394){var _0x2fcfa4=a0_0x5e92ae,_0x4a56ab=[],_0x54497d=[],_0x481e5e=[],_0x455983=[],_0x116fb5=[],_0x242234=[];let _0x139f6f=[];if(_0xd409c4==_0x2fcfa4(0x1d6))switch(_0x22a394){case _0x2fcfa4(0x1dd):_0x4a56ab=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x54497d=[0x1,0x2],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=['Level',_0x2fcfa4(0x100)],_0x116fb5=['D'],_0x242234=['A'];break;case _0x2fcfa4(0x1e5):_0x4a56ab=[0x6,0x5,0x4,0x3,0x2,0x1],_0x54497d=[0x1,0x2],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=[_0x2fcfa4(0x182),_0x2fcfa4(0x100)],_0x116fb5=['D'],_0x242234=['B'];break;case _0x2fcfa4(0x119):_0x4a56ab=[0x0],_0x54497d=[0x0],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=['Floor'],_0x116fb5=['D'],_0x242234=['S'];break;case'Receiving\x20Area':_0x4a56ab=[0x0],_0x54497d=[0x0],_0x455983=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x481e5e=[_0x2fcfa4(0x100)],_0x116fb5=['D'],_0x242234=['R'];break;}else{if(_0xd409c4==_0x2fcfa4(0x12d))switch(_0x22a394){case'Rack\x20A':_0x4a56ab=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x54497d=['B','F'],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=[_0x2fcfa4(0x182),_0x2fcfa4(0x100)],_0x116fb5=['C'],_0x242234=['A'];break;case'Rack\x20B':_0x4a56ab=[0x5,0x4,0x3,0x2,0x1],_0x54497d=['F','B','S'],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=[_0x2fcfa4(0x182),'Floor'],_0x116fb5=['C'],_0x242234=['B'];break;case _0x2fcfa4(0x12a):_0x4a56ab=[0x1,0x2,0x3,0x4,0x5],_0x54497d=['B','F','S'],_0x455983=[0x5,0x4,0x3,0x2,0x1],_0x481e5e=[_0x2fcfa4(0x182),'Floor'],_0x116fb5=['C'],_0x242234=['C'];break;case _0x2fcfa4(0x16a):_0x4a56ab=[0x5,0x4,0x3,0x2,0x1],_0x54497d=['F','B','S'],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=[_0x2fcfa4(0x182),_0x2fcfa4(0x100)],_0x116fb5=['C'],_0x242234=['D'];break;case _0x2fcfa4(0x18d):_0x4a56ab=[0x4,0x3,0x2,0x1],_0x54497d=[0x1,0x2],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=['Level',_0x2fcfa4(0x100)],_0x116fb5=['C'],_0x242234=['E'];break;case _0x2fcfa4(0x1ce):_0x4a56ab=[0x1,0x2,0x3],_0x54497d=[0x1,0x2],_0x455983=[0x1,0x2,0x3,0x4,0x5],_0x481e5e=[_0x2fcfa4(0x182)],_0x116fb5=['C'],_0x242234=['F'];break;}}return{'levels':_0x4a56ab,'Isle':_0x54497d,'rack':_0x455983,'type':_0x481e5e,'storage':_0x116fb5,'rak':_0x242234};}async function getRandom8DigitNumber(){var _0x2e9c17=a0_0x5e92ae;const _0x3d67d2=0x989680,_0x56ea28=0x5f5e0ff,_0x4ec415=Math['floor'](Math[_0x2e9c17(0xf2)]()*(_0x56ea28-_0x3d67d2+0x1))+_0x3d67d2;var _0x56b1b8;const _0x47d476=await purchases[_0x2e9c17(0x18f)]({'invoice':_0x2e9c17(0x1b5)+_0x4ec415});return _0x47d476&&_0x47d476[_0x2e9c17(0x1eb)]>0x0?_0x56b1b8=_0x2e9c17(0x1b5)+_0x4ec415:_0x56b1b8=_0x2e9c17(0x1b5)+_0x4ec415,_0x56b1b8;}function a0_0x6146(){var _0x33ff22=['gmail','$product.type','delivery_code','$suppliers_docs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</td>','1bveNYY','../public/language/languages.json','render','4645240CaRWmr','$product_details.pallet','2698856reeAql','POnumber','/view/:id','</tr>','$primary_code','</thead>','abs','Router','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</div>','purchase\x20data\x20update\x20successfully','push','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','floorlevel','ejs','prod_primunit','<div>','host','maxStocks','<tr>','staff','warehouse','types','Paid\x20For\x20Purchase','forEach','Rack\x20D','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','prod_Qty','product_cat','3170584TVRwua','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','RMSEmail','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$alertquantity','json','user_id','/view/return_purchase/:id','$product_details.rack','product_details','alertQTY','$paid_amount','password','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Sales\x20Update\x20successfully','all_purchases_barcode','role','An\x20error\x20occurred\x20while\x20saving\x20data.','return_data','Level','image','language','prod_name','stocks','/give_payment/:id','$due_amount','rack','Portuguese\x20(BR)','primary_code_hide','/view/add_purchases','Rack\x20E','$product_details.product_stock','findOne','status','email','$product.bay','Logo.png','<!DOCTYPE\x20html>','add_purchases\x20error','\x20</h2>','Return\x20Goods','$product_details.level','An\x20error\x20occurred.','save','return_product','RoomAssign','logo','$name','standard_unit','prod_pallet','$product_details.type','/invoice/:id','English','/barcode_scanner','$product_code','batch_code','</head><body>','product_code','prod_cat','find','return_qty','12131BxVfVR','errors','1572pgGcLk','warehouse_name','level','product_name','<hr\x20class=\x22my-3\x22>','$secondary_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','INC-','finalize','site_title','$batch_code','suppliers','aggregate','$secondary_unit','$product_details.bay','success','prod_invoice','$product_details._id','name','filter','/all_purchases/view','due_amount','stock_data','Raw\x20Materials','$product_details.isle','$product_details.product_name','Arabic\x20(ae)','</tbody>','2196460NXICNE','</body></html>','$product','</table>','Rack\x20F','path','bin','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$return_data','prod_unit','isle','paid_amount','DRY\x20STORAGE','$maxStocks','getMonth','$finalize','<tbody\x20style=\x22text-align:\x20center;\x22>','master','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Rack\x20A','Hindi','foreach\x20newproduct','$suppliers','purchases\x20item\x20return\x20successfull','suppliers_data','suppliers_docs','$product_details.secondary_code','Rack\x20B','Purchase\x20Return','prod_qty','Room_name','Portuguese','<h2>\x20','length','Spanish','$product_details.primary_code','$_id','/barcode/:id','$maxProdPerUnit','Enabled','$invoice','deliverycode','rak','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','getFullYear','Arabic','log','get','pallet','maxperunit','True','invoice','$product.bin','prod_level','/../public','expiry_date','secondary_code_hide','prod_isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','express','actual_uom','\x20Order\x20Number\x20:\x20','createTransport','$product.floorlevel','purchase_quantity','production_date','French','message','</h5>','map','body','random','<span\x20style=\x22float:\x20right;\x22>','MaxStocks_data','/upload/','purchase_invoice','product_code_hide','nodemailer','max_product_unit','bay','delivery_date','post','actual_qty','type','redirect','Floor','\x20<\x20wew\x20>\x20','quantity','719100UqHhIP','$product_details.maxProducts','flash','params','prod_code','991076KvRMcG','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','amount','user','currency','findById','/view/add_purchases/:id','$note','</span>','date','$product_details','secondary_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Email\x20sent\x20successfully','$date','primary_code','back','Shelves','$product.quantity','string','then','product_stock','return_purchase','<strong>\x20Regards\x20</strong>','../models/all_models','add\x20post','$brand','18BmBMAd','<html><head><title></title>','concat','room_name','getDate','Chinese','all_purchases','Rack\x20C','<h5>','catch','COLD\x20STORAGE','English\x20(US)','$product_details.product_code','edit_purchases_view','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room','stock_quantity','Enclosed','Ambient','Purchase\x20Return\x20Mail','product','secondary_unit','<h5\x20style=\x22text-align:\x20left;\x22>','\x20Order\x20Date\x20:\x20','$expiry_date','storage','$product_details.floorlevel','error','/preview/:id','prod_secondunit','$product_details.bin','sendMail','$product_details.storage'];a0_0x6146=function(){return _0x33ff22;};return a0_0x6146();}function a0_0x1ed9(_0x1d7b71,_0x198514){var _0x614638=a0_0x6146();return a0_0x1ed9=function(_0x1ed9b9,_0x58fa9c){_0x1ed9b9=_0x1ed9b9-0xeb;var _0x146dbd=_0x614638[_0x1ed9b9];return _0x146dbd;},a0_0x1ed9(_0x1d7b71,_0x198514);}router[a0_0x5e92ae(0x1f9)](a0_0x5e92ae(0x18c),auth,async(_0x534fae,_0x401f0c)=>{var _0x5c164e=a0_0x5e92ae;try{const {username:_0x41d57b,email:_0xb895d8,role:_0x1f5d49}=_0x534fae[_0x5c164e(0x10b)],_0x39dcdc=_0x534fae[_0x5c164e(0x10b)],_0x295e6c=await profile['findOne']({'email':_0x39dcdc['email']}),_0x1de137=await master_shop[_0x5c164e(0x1aa)](),_0x17a342=await staff[_0x5c164e(0x18f)]({'email':_0x39dcdc[_0x5c164e(0x191)]}),_0x46ffe4=await suppliers['find']({});let _0x3a8457;if(_0x39dcdc['role']==_0x5c164e(0x165)){const _0x38ab58=await staff[_0x5c164e(0x18f)]({'email':_0x39dcdc[_0x5c164e(0x191)]});_0x3a8457=await warehouse['aggregate']([{'$match':{'status':_0x5c164e(0x1f1),'name':_0x38ab58[_0x5c164e(0x166)],'warehouse_category':_0x5c164e(0x1c5),'name':{'$ne':_0x5c164e(0x197)}}},{'$group':{'_id':_0x5c164e(0x19e),'name':{'$first':_0x5c164e(0x19e)}}}]);}else _0x3a8457=await warehouse[_0x5c164e(0x1ba)]([{'$match':{'status':_0x5c164e(0x1f1),'warehouse_category':_0x5c164e(0x1c5),'name':{'$ne':_0x5c164e(0x197)}}},{'$group':{'_id':_0x5c164e(0x19e),'name':{'$first':_0x5c164e(0x19e)}}}]);const _0x4d212c=await product[_0x5c164e(0x1aa)]({}),_0x1994f6=await warehouse['find']({'status':_0x5c164e(0x1f1)}),_0x428cd4=await purchases[_0x5c164e(0x1aa)]({}),_0x49ddc5=_0x428cd4[_0x5c164e(0x1eb)]+0x1,_0x4b2247=_0x5c164e(0x1b5)+_0x49ddc5['toString']()['padStart'](0x5,'0');var _0x50d33b=[_0x5c164e(0x136),_0x5c164e(0x135)];if(_0x1de137[0x0][_0x5c164e(0x184)]==_0x5c164e(0x12e))var _0x3d841a=users[_0x5c164e(0x1a3)];else{if(_0x1de137[0x0][_0x5c164e(0x184)]==_0x5c164e(0x1de))var _0x3d841a=users[_0x5c164e(0x1de)];else{if(_0x1de137[0x0][_0x5c164e(0x184)]==_0x5c164e(0x16b))var _0x3d841a=users[_0x5c164e(0x16b)];else{if(_0x1de137[0x0][_0x5c164e(0x184)]==_0x5c164e(0x1ec))var _0x3d841a=users[_0x5c164e(0x1ec)];else{if(_0x1de137[0x0]['language']=='French')var _0x3d841a=users[_0x5c164e(0xed)];else{if(_0x1de137[0x0][_0x5c164e(0x184)]==_0x5c164e(0x18a))var _0x3d841a=users['Portuguese'];else{if(_0x1de137[0x0][_0x5c164e(0x184)]==_0x5c164e(0x128))var _0x3d841a=users[_0x5c164e(0x128)];else{if(_0x1de137[0x0][_0x5c164e(0x184)]=='Arabic\x20(ae)')var _0x3d841a=users[_0x5c164e(0x1f7)];}}}}}}}const _0x2f40d5=getRandom8DigitNumber();_0x2f40d5['then'](_0x570ccb=>{var _0x327bec=_0x5c164e;_0x401f0c['render']('add_purchases',{'success':_0x534fae[_0x327bec(0x105)](_0x327bec(0x1bd)),'errors':_0x534fae['flash'](_0x327bec(0x1ad)),'role':_0x39dcdc,'profile':_0x295e6c,'suppliers':_0x46ffe4,'warehouse':_0x3a8457,'product':_0x4d212c,'invoice':_0x570ccb,'master_shop':_0x1de137,'language':_0x3d841a,'find_data':_0x1994f6,'rooms_data':_0x50d33b});})['catch'](_0x2d1a04=>{var _0x402321=_0x5c164e;_0x534fae[_0x402321(0x105)](_0x402321(0x1ad),_0x402321(0x1d1)),_0x401f0c['redirect'](_0x402321(0x1c2));});}catch(_0x45c900){console[_0x5c164e(0x1f8)](_0x45c900);}}),router[a0_0x5e92ae(0x1f9)](a0_0x5e92ae(0x10e),auth,async(_0x17267a,_0x3d9932)=>{var _0x364bf8=a0_0x5e92ae;try{const _0x577cd9=_0x17267a['params']['id'];console[_0x364bf8(0x1f8)](_0x577cd9);const _0x33bca5=await master_shop[_0x364bf8(0x1aa)]();console[_0x364bf8(0x1f8)](_0x364bf8(0x1db),_0x33bca5);const _0x44ccb9=await product[_0x364bf8(0x18f)]({'name':_0x577cd9});console['log'](_0x364bf8(0x138),_0x44ccb9),_0x3d9932['status'](0xc8)['json']({'product_data':_0x44ccb9,'master':_0x33bca5});}catch(_0x4412f7){console['log'](_0x364bf8(0x195),_0x4412f7);}}),router['post'](a0_0x5e92ae(0x18c),auth,async(_0x1be603,_0x2c8402)=>{var _0x3919a8=a0_0x5e92ae;try{const {invoice:_0x45c4d4,date:_0x5e6d7e,warehouse_name:_0xe1fdcc,prod_name:_0x4337ac,prod_code:_0x3fd604,prod_qty:_0x2dc23b,prod_unit:_0x1f65c3,prod_secondunit:_0x2587c7,prod_level:_0x519cfd,prod_isle:_0x1c3b6b,prod_pallet:_0x232f62,note:_0x4687a6,expiry_date:_0x1cf56c,batch_code:_0x40887e,payable:_0x261e15,due_amount:_0x5f3192,Room_name:_0xde4e7f,primary_code:_0x30da0c,secondary_code:_0x5bd1df,MaxStocks_data:_0x227326,PO_number:_0x111e67,SCRN:_0x5c9c90,JO_number:_0x487599}=_0x1be603[_0x3919a8(0xf1)];if(typeof _0x4337ac==_0x3919a8(0x11b))var _0x32167a=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x185)]],_0x148ea4=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x107)]],_0xd6beb4=[_0x1be603['body']['prod_Qty']],_0x10c541=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x160)]],_0xd68d18=[_0x1be603['body'][_0x3919a8(0x141)]],_0x12b8a5=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1ff)]],_0x1f0552=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x117)]],_0xed59a1=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x113)]],_0x1ef91c=[_0x1be603['body'][_0x3919a8(0xf4)]],_0x13e73c=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1a6)]],_0x246734=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x201)]],_0x275175=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0xf9)]],_0x25dfce=[_0x1be603['body']['alertQTY']],_0x21fd6f=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0xec)]],_0x339b73=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1a9)]],_0x4509e1=[_0x1be603['body'][_0x3919a8(0x19c)]],_0x21f9b5=[_0x1be603['body']['deliverycode']],_0x1c2996=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1be)]],_0x5344a5=[_0x1be603['body'][_0x3919a8(0xfd)]],_0x492c2c=[_0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x206)]];else var _0x32167a=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x185)]],_0x148ea4=[..._0x1be603['body']['prod_code']],_0xd6beb4=[..._0x1be603['body'][_0x3919a8(0x16d)]],_0x10c541=[..._0x1be603['body'][_0x3919a8(0x160)]],_0xd68d18=[..._0x1be603['body']['prod_secondunit']],_0x12b8a5=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1ff)]],_0x1f0552=[..._0x1be603[_0x3919a8(0xf1)]['primary_code']],_0xed59a1=[..._0x1be603['body'][_0x3919a8(0x113)]],_0x1ef91c=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0xf4)]],_0x13e73c=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1a6)]],_0x246734=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x201)]],_0x275175=[..._0x1be603['body'][_0x3919a8(0xf9)]],_0x25dfce=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x179)]],_0x21fd6f=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0xec)]],_0x339b73=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1a9)]],_0x4509e1=[..._0x1be603['body'][_0x3919a8(0x19c)]],_0x21f9b5=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x1f3)]],_0x1c2996=[..._0x1be603['body']['prod_invoice']],_0x5344a5=[..._0x1be603['body']['actual_qty']],_0x492c2c=[..._0x1be603[_0x3919a8(0xf1)][_0x3919a8(0x206)]];const _0x4767fe=_0x32167a[_0x3919a8(0xf0)](_0x46e5=>{return _0x46e5={'product_name':_0x46e5};});_0x5344a5['forEach']((_0x31019a,_0x23de25)=>{var _0x1398bb=_0x3919a8;_0x4767fe[_0x23de25][_0x1398bb(0xfd)]=Math[_0x1398bb(0x156)](_0x31019a);}),_0x492c2c[_0x3919a8(0x169)]((_0xc9efdc,_0x1bd863)=>{var _0x3bb624=_0x3919a8;_0x4767fe[_0x1bd863][_0x3bb624(0x206)]=_0xc9efdc;}),_0x148ea4['forEach']((_0x43d3bd,_0x4c8407)=>{var _0xe0d6a7=_0x3919a8;_0x4767fe[_0x4c8407][_0xe0d6a7(0x1a8)]=_0x43d3bd;}),_0xd6beb4[_0x3919a8(0x169)]((_0x1c1e42,_0x3bf1ef)=>{var _0x579209=_0x3919a8;_0x4767fe[_0x3bf1ef]['quantity']=Math[_0x579209(0x156)](_0x1c1e42);}),_0x10c541['forEach']((_0x1a1ac2,_0x427990)=>{var _0x169eb9=_0x3919a8;_0x4767fe[_0x427990][_0x169eb9(0x19f)]=_0x1a1ac2;}),_0xd68d18['forEach']((_0x2af062,_0x2ee303)=>{var _0x42c9ec=_0x3919a8;_0x4767fe[_0x2ee303][_0x42c9ec(0x139)]=_0x2af062;}),_0x12b8a5[_0x3919a8(0x169)]((_0xdac351,_0xa64277)=>{var _0x20f8cd=_0x3919a8;_0x4509e1[_0x20f8cd(0x169)]((_0x41557e,_0x33356d)=>{var _0x3d95e4=_0x20f8cd;if(_0x41557e=='Receiving\x20Area'&&_0xa64277==_0x33356d){console[_0x3d95e4(0x1f8)](_0x41557e+_0x3d95e4(0x101)+_0xa64277+'\x20<>\x20'+_0x33356d+'\x20<>\x20'+_0xdac351);var _0x178c6d=_0xdac351['slice'](0x3);_0x4767fe[_0xa64277][_0x3d95e4(0x13d)]=_0xdac351[0x0],_0x4767fe[_0xa64277][_0x3d95e4(0x189)]=_0xdac351[0x1],_0x4767fe[_0xa64277][_0x3d95e4(0xfa)]=0x0,_0x4767fe[_0xa64277][_0x3d95e4(0x1d0)]=0x0,_0x4767fe[_0xa64277]['type']=_0x3d95e4(0x100),_0x4767fe[_0xa64277][_0x3d95e4(0x15e)]=_0x178c6d;}else{if(_0x41557e==_0x3d95e4(0x119)&&_0xa64277==_0x33356d){var _0x178c6d=_0xdac351[_0x3d95e4(0x158)](0x3);_0x4767fe[_0xa64277][_0x3d95e4(0x13d)]=_0xdac351[0x0],_0x4767fe[_0xa64277][_0x3d95e4(0x189)]=_0xdac351[0x1],_0x4767fe[_0xa64277][_0x3d95e4(0xfa)]=0x0,_0x4767fe[_0xa64277][_0x3d95e4(0x1d0)]=0x0,_0x4767fe[_0xa64277]['type']=_0x3d95e4(0x100),_0x4767fe[_0xa64277]['floorlevel']=_0xdac351[0x5];}else{if(_0xa64277==_0x33356d){var _0x27eec7;if(_0xdac351[0x4]=='L')_0x27eec7=_0x3d95e4(0x182);else _0xdac351[0x4]=='F'&&(_0x27eec7='Floor');_0x4767fe[_0xa64277][_0x3d95e4(0x13d)]=_0xdac351[0x0],_0x4767fe[_0xa64277][_0x3d95e4(0x189)]=_0xdac351[0x1],_0x4767fe[_0xa64277][_0x3d95e4(0xfa)]=_0xdac351[0x2],_0x4767fe[_0xa64277]['bin']=_0xdac351[0x3],_0x4767fe[_0xa64277][_0x3d95e4(0xfe)]=_0x27eec7,_0x4767fe[_0xa64277][_0x3d95e4(0x15e)]=_0xdac351[0x5];}}}});}),_0x1f0552['forEach']((_0x5a6b0d,_0x134f99)=>{var _0x52ce8e=_0x3919a8;_0x4767fe[_0x134f99][_0x52ce8e(0x117)]=_0x5a6b0d;}),_0xed59a1[_0x3919a8(0x169)]((_0x130bcd,_0x4d1aea)=>{_0x4767fe[_0x4d1aea]['secondary_code']=_0x130bcd;}),_0x1ef91c[_0x3919a8(0x169)]((_0x2faacb,_0x372901)=>{var _0x5f27d0=_0x3919a8;_0x4767fe[_0x372901][_0x5f27d0(0x163)]=_0x2faacb;}),_0x13e73c[_0x3919a8(0x169)]((_0x365a03,_0x514f98)=>{var _0x49b0c0=_0x3919a8;_0x4767fe[_0x514f98][_0x49b0c0(0x1a6)]=_0x365a03;}),_0x246734[_0x3919a8(0x169)]((_0x3ef52a,_0x4df62d)=>{_0x4767fe[_0x4df62d]['expiry_date']=_0x3ef52a;}),_0x275175[_0x3919a8(0x169)]((_0x8cf912,_0x1f468e)=>{var _0x5c4c4e=_0x3919a8;_0x4767fe[_0x1f468e][_0x5c4c4e(0x1fb)]=_0x8cf912;}),_0x25dfce[_0x3919a8(0x169)]((_0xaaffb7,_0x51a8e6)=>{var _0x423c04=_0x3919a8;_0x4767fe[_0x51a8e6][_0x423c04(0x179)]=_0xaaffb7;}),_0x21fd6f[_0x3919a8(0x169)]((_0x554a96,_0x219ce0)=>{var _0x1d349b=_0x3919a8;_0x4767fe[_0x219ce0][_0x1d349b(0xec)]=_0x554a96;}),_0x339b73[_0x3919a8(0x169)]((_0x13ccca,_0x2920cf)=>{var _0x12de17=_0x3919a8;_0x4767fe[_0x2920cf][_0x12de17(0x16e)]=_0x13ccca;}),_0x4509e1[_0x3919a8(0x169)]((_0xf1b78a,_0xb00636)=>{var _0x484be9=_0x3919a8;_0x4767fe[_0xb00636][_0x484be9(0x126)]=_0xf1b78a;}),_0x21f9b5[_0x3919a8(0x169)]((_0x55d70d,_0x243bb2)=>{var _0x403fa1=_0x3919a8;_0x4767fe[_0x243bb2][_0x403fa1(0x147)]=_0x55d70d;}),_0x1c2996[_0x3919a8(0x169)]((_0x79443d,_0x5cf3d8)=>{var _0x1e22de=_0x3919a8;_0x4767fe[_0x5cf3d8][_0x1e22de(0x1fd)]=_0x79443d;});const _0x29af5b=_0x4509e1[_0x3919a8(0xf0)](_0x2ca29c=>{return _0x2ca29c={'room_name':_0x2ca29c};}),_0x1d26cb=_0x4767fe['filter'](_0x1dcc4d=>_0x1dcc4d[_0x3919a8(0x102)]!=='0'&&_0x1dcc4d[_0x3919a8(0x102)]!==''),_0x5cdadd=new purchases({'invoice':_0x45c4d4,'suppliers':_0x1be603[_0x3919a8(0xf1)]['suppliers'],'date':_0x5e6d7e,'warehouse_name':_0xe1fdcc,'product':_0x1d26cb,'note':_0x4687a6,'due_amount':_0x5f3192,'POnumber':_0x111e67,'SCRN':_0x5c9c90,'JO_number':_0x487599,'roomList':_0x29af5b}),_0x1aa822=await _0x5cdadd[_0x3919a8(0x19a)](),_0x5d932a=await purchases['findOne']({'invoice':_0x45c4d4}),_0x4c21f7=_0x5d932a[_0x3919a8(0x138)][_0x3919a8(0xf0)](async _0x562eb6=>{var _0x2a4ccc=_0x3919a8,_0xbca0b5=await warehouse[_0x2a4ccc(0x18f)]({'name':_0xe1fdcc,'room':_0x562eb6[_0x2a4ccc(0x126)]}),_0x2b5165=0x0;return _0xbca0b5[_0x2a4ccc(0x178)][_0x2a4ccc(0x169)](_0x5d3ef3=>{var _0x38d79c=_0x2a4ccc;_0x5d3ef3[_0x38d79c(0x1b1)]==_0x562eb6[_0x38d79c(0x1b1)]&&_0x5d3ef3[_0x38d79c(0x15e)]==_0x562eb6[_0x38d79c(0x15e)]&&_0x5d3ef3['type']==_0x562eb6[_0x38d79c(0xfe)]&&_0x5d3ef3[_0x38d79c(0x1d0)]==_0x562eb6[_0x38d79c(0x1d0)]&&_0x5d3ef3[_0x38d79c(0xfa)]==_0x562eb6[_0x38d79c(0xfa)]&&_0x5d3ef3['rack']==_0x562eb6['rack']&&_0x5d3ef3['storage']==_0x562eb6[_0x38d79c(0x13d)]&&_0x5d3ef3[_0x38d79c(0x201)]==_0x562eb6[_0x38d79c(0x201)]&&_0x5d3ef3[_0x38d79c(0x1a6)]==_0x562eb6[_0x38d79c(0x1a6)]&&_0x5d3ef3['production_date']==_0x562eb6[_0x38d79c(0xec)]&&_0x5d3ef3[_0x38d79c(0x1fd)]==_0x5d932a[_0x38d79c(0x1fd)]&&(_0x5d3ef3['product_stock']+=Math[_0x38d79c(0x156)](_0x562eb6['quantity']),_0x2b5165++);}),_0x2b5165===0x0&&_0xbca0b5[_0x2a4ccc(0x178)][_0x2a4ccc(0x15c)]({'product_name':_0x562eb6['product_name'],'product_stock':Math[_0x2a4ccc(0x156)](_0x562eb6[_0x2a4ccc(0x102)]),'primary_code':_0x562eb6['primary_code'],'secondary_code':_0x562eb6['secondary_code'],'product_code':_0x562eb6[_0x2a4ccc(0x1a8)],'storage':_0x562eb6[_0x2a4ccc(0x13d)],'rack':_0x562eb6['rack'],'bay':_0x562eb6['bay'],'bin':_0x562eb6[_0x2a4ccc(0x1d0)],'type':_0x562eb6['type'],'floorlevel':_0x562eb6['floorlevel'],'maxProducts':_0x562eb6[_0x2a4ccc(0x163)],'unit':_0x562eb6[_0x2a4ccc(0x19f)],'secondary_unit':_0x562eb6['secondary_unit'],'expiry_date':_0x562eb6[_0x2a4ccc(0x201)],'maxPerUnit':_0x562eb6[_0x2a4ccc(0x1fb)],'batch_code':_0x562eb6[_0x2a4ccc(0x1a6)],'alertQTY':_0x562eb6[_0x2a4ccc(0x179)],'production_date':_0x562eb6['production_date'],'product_cat':_0x562eb6[_0x2a4ccc(0x16e)],'invoice':_0x562eb6[_0x2a4ccc(0x1fd)],'actual_qty':Math[_0x2a4ccc(0x156)](_0x562eb6['actual_qty']),'actual_uom':_0x562eb6[_0x2a4ccc(0x206)]}),_0xbca0b5;});Promise[_0x3919a8(0x131)](_0x4c21f7)[_0x3919a8(0x11c)](async _0x39862d=>{var _0x329333=_0x3919a8;try{for(const _0x469820 of _0x39862d){await _0x469820[_0x329333(0x19a)]();}const _0x1b3f7f=await master_shop[_0x329333(0x1aa)](),_0x3422f0=await email_settings[_0x329333(0x18f)](),_0x418b05=await supervisor_settings[_0x329333(0x1aa)]();var _0x444ed7=_0x5d932a[_0x329333(0x138)],_0x3387bd='',_0x5b8394;for(_0x5b8394 in _0x444ed7){_0x3387bd+=_0x329333(0x164)+_0x329333(0x1dc)+_0x444ed7[_0x5b8394][_0x329333(0x1b1)]+_0x329333(0x14a)+_0x329333(0x1dc)+_0x444ed7[_0x5b8394]['product_code']+'</td>'+_0x329333(0x1dc)+_0x444ed7[_0x5b8394]['quantity']+_0x329333(0x14a)+_0x329333(0x1dc)+_0x444ed7[_0x5b8394][_0x329333(0x19f)]+_0x329333(0x14a)+_0x329333(0x1dc)+_0x444ed7[_0x5b8394][_0x329333(0x139)]+_0x329333(0x14a)+_0x329333(0x1dc)+_0x5d932a['warehouse_name']+_0x329333(0x14a)+_0x329333(0x1dc)+_0x444ed7[_0x5b8394][_0x329333(0x126)]+_0x329333(0x14a)+_0x329333(0x1dc)+_0x444ed7[_0x5b8394][_0x329333(0x13d)]+_0x444ed7[_0x5b8394][_0x329333(0x189)]+_0x444ed7[_0x5b8394][_0x329333(0xfa)]+_0x444ed7[_0x5b8394][_0x329333(0x1d0)]+_0x444ed7[_0x5b8394][_0x329333(0xfe)][0x0]+_0x444ed7[_0x5b8394]['floorlevel']+_0x329333(0x14a),_0x329333(0x153);}let _0x488857=nodemailer[_0x329333(0x208)]({'host':_0x3422f0[_0x329333(0x162)],'port':Number(_0x3422f0['port']),'secure':![],'auth':{'user':_0x3422f0[_0x329333(0x191)],'pass':_0x3422f0[_0x329333(0x17b)]}}),_0x209540={'from':_0x3422f0[_0x329333(0x191)],'to':_0x418b05[0x0][_0x329333(0x171)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x329333(0x193),'path':__dirname+_0x329333(0x200)+_0x329333(0xf5)+_0x1b3f7f[0x0][_0x329333(0x183)],'cid':_0x329333(0x19d)}],'html':_0x329333(0x194)+_0x329333(0x124)+_0x329333(0x1a7)+_0x329333(0x161)+_0x329333(0x15d)+_0x329333(0x161)+_0x329333(0x114)+'</div>'+_0x329333(0x161)+_0x329333(0x1ea)+_0x1b3f7f[0x0][_0x329333(0x1b7)]+'\x20</h2>'+_0x329333(0x15a)+_0x329333(0x15a)+_0x329333(0x1b2)+_0x329333(0x161)+_0x329333(0x13a)+_0x329333(0x207)+_0x5d932a[_0x329333(0x1fd)]+'\x20'+_0x329333(0xf3)+_0x329333(0x13b)+_0x5d932a[_0x329333(0x111)]+'\x20'+_0x329333(0x110)+_0x329333(0xef)+_0x329333(0x15a)+_0x329333(0x172)+_0x329333(0x1b4)+'<tr>'+_0x329333(0x1f5)+_0x329333(0x149)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x329333(0x159)+_0x329333(0x132)+_0x329333(0x170)+_0x329333(0x204)+_0x329333(0x16c)+_0x329333(0x153)+'</thead>'+_0x329333(0x1da)+'\x20'+_0x3387bd+'\x20'+_0x329333(0x1c9)+_0x329333(0x1cd)+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x329333(0x12b)+_0x1b3f7f[0x0]['site_title']+_0x329333(0xef)+_0x329333(0x15a)+_0x329333(0x15a)+_0x329333(0x1cb)};_0x488857[_0x329333(0x143)](_0x209540,function(_0x597b49,_0x3d26e0){var _0xc25389=_0x329333;_0x597b49?(console[_0xc25389(0x1f8)](_0x597b49),console[_0xc25389(0x1f8)]('Error\x20Occurs')):console[_0xc25389(0x1f8)]('Email\x20sent\x20successfully');}),_0x1be603[_0x329333(0x105)](_0x329333(0x1bd),'Purchase\x20data\x20added\x20successfully'),_0x2c8402[_0x329333(0xff)]('/all_purchases/view/');}catch(_0x3a1e41){console[_0x329333(0x13f)](_0x3a1e41),_0x2c8402['status'](0x1f4)['json']({'error':_0x329333(0x180)});}})[_0x3919a8(0x12c)](_0x3114c3=>{var _0x363498=_0x3919a8;console[_0x363498(0x13f)](_0x3114c3),_0x2c8402['status'](0x1f4)['json']({'error':_0x363498(0x199)});});}catch(_0x1f071f){console['log'](_0x1f071f);}}),router[a0_0x5e92ae(0x1f9)](a0_0x5e92ae(0x140),auth,async(_0x17280e,_0x28f4e9)=>{var _0x3f34cc=a0_0x5e92ae;try{const {username:_0x64555c,email:_0x396c9d,role:_0x4545d7}=_0x17280e[_0x3f34cc(0x10b)],_0x221a69=_0x17280e['user'],_0x5e3912=await profile[_0x3f34cc(0x18f)]({'email':_0x221a69[_0x3f34cc(0x191)]}),_0xa4c04e=await master_shop[_0x3f34cc(0x1aa)](),_0x2bbda0=_0x17280e[_0x3f34cc(0x106)]['id'],_0x19ea2d=await purchases[_0x3f34cc(0x10d)](_0x2bbda0),_0x4a1d02=await warehouse[_0x3f34cc(0x1ba)]([{'$match':{'name':_0x19ea2d['warehouse_name'],'room':_0x19ea2d[_0x3f34cc(0x133)]}},{'$unwind':_0x3f34cc(0x112)},{'$group':{'_id':_0x3f34cc(0x1bf),'name':{'$first':_0x3f34cc(0x1c7)},'product_stock':{'$first':_0x3f34cc(0x18e)},'bay':{'$first':_0x3f34cc(0x1bc)},'bin':{'$first':_0x3f34cc(0x142)},'type':{'$first':_0x3f34cc(0x1a1)},'floorlevel':{'$first':_0x3f34cc(0x13e)},'primary_code':{'$first':_0x3f34cc(0x1ed)},'secondary_code':{'$first':_0x3f34cc(0x1e4)},'product_code':{'$first':_0x3f34cc(0x12f)},'storage':{'$first':_0x3f34cc(0x144)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x516307=await customer[_0x3f34cc(0x1aa)]({});let _0xd94dba;if(_0x221a69[_0x3f34cc(0x17f)]==_0x3f34cc(0x165)){const _0x301e0b=await staff[_0x3f34cc(0x18f)]({'email':_0x221a69[_0x3f34cc(0x191)]});_0xd94dba=await warehouse['aggregate']([{'$match':{'status':_0x3f34cc(0x1f1),'name':_0x301e0b[_0x3f34cc(0x166)]}},{'$group':{'_id':_0x3f34cc(0x19e),'name':{'$first':_0x3f34cc(0x19e)}}}]);}else _0xd94dba=await warehouse['aggregate']([{'$match':{'status':_0x3f34cc(0x1f1)}},{'$group':{'_id':_0x3f34cc(0x19e),'name':{'$first':_0x3f34cc(0x19e)}}}]);const _0x2b2276=await product[_0x3f34cc(0x1aa)]({}),_0x4fc256=await suppliers['find']({}),_0x4c21af=BayBinSelected(_0x19ea2d[_0x3f34cc(0x1af)],_0x19ea2d[_0x3f34cc(0x133)]);if(_0xa4c04e[0x0]['language']==_0x3f34cc(0x12e)){var _0x5a9839=users[_0x3f34cc(0x1a3)];console[_0x3f34cc(0x1f8)](_0x5a9839);}else{if(_0xa4c04e[0x0][_0x3f34cc(0x184)]==_0x3f34cc(0x1de))var _0x5a9839=users[_0x3f34cc(0x1de)];else{if(_0xa4c04e[0x0]['language']==_0x3f34cc(0x16b))var _0x5a9839=users[_0x3f34cc(0x16b)];else{if(_0xa4c04e[0x0][_0x3f34cc(0x184)]==_0x3f34cc(0x1ec))var _0x5a9839=users[_0x3f34cc(0x1ec)];else{if(_0xa4c04e[0x0][_0x3f34cc(0x184)]==_0x3f34cc(0xed))var _0x5a9839=users[_0x3f34cc(0xed)];else{if(_0xa4c04e[0x0][_0x3f34cc(0x184)]=='Portuguese\x20(BR)')var _0x5a9839=users[_0x3f34cc(0x1e9)];else{if(_0xa4c04e[0x0][_0x3f34cc(0x184)]==_0x3f34cc(0x128))var _0x5a9839=users[_0x3f34cc(0x128)];else{if(_0xa4c04e[0x0][_0x3f34cc(0x184)]==_0x3f34cc(0x1c8))var _0x5a9839=users[_0x3f34cc(0x1f7)];}}}}}}}_0x28f4e9[_0x3f34cc(0x14d)](_0x3f34cc(0x130),{'success':_0x17280e[_0x3f34cc(0x105)](_0x3f34cc(0x1bd)),'errors':_0x17280e[_0x3f34cc(0x105)](_0x3f34cc(0x1ad)),'role':_0x221a69,'profile':_0x5e3912,'customer':_0x516307,'warehouse':_0xd94dba,'product':_0x4a1d02,'user':_0x19ea2d,'master_shop':_0xa4c04e,'unit':_0x2b2276,'language':_0x5a9839,'suppliers':_0x4fc256,'dataSelected':_0x4c21af});}catch(_0x25fefa){console[_0x3f34cc(0x1f8)](_0x25fefa);}}),router[a0_0x5e92ae(0xfc)](a0_0x5e92ae(0x140),auth,async(_0x4307bc,_0x1a4239)=>{var _0x2108ad=a0_0x5e92ae;try{const _0x373c11=_0x4307bc[_0x2108ad(0x106)]['id'],{invoice:_0x20522a,warehouse_name:_0x321938,Room_name:_0x4ab19a}=_0x4307bc[_0x2108ad(0xf1)],_0x382b3c=await warehouse[_0x2108ad(0x18f)]({'name':_0x321938,'room':_0x4ab19a}),_0xc06031=await purchases[_0x2108ad(0x18f)]({'invoice':_0x20522a});_0xc06031[_0x2108ad(0x138)][_0x2108ad(0x169)](_0x626f38=>{var _0x42d668=_0x2108ad,_0x31b1f7=0x0;const _0x4b3ec2=_0x382b3c[_0x42d668(0x178)][_0x42d668(0xf0)](_0x17a9cc=>{var _0x266bf5=_0x42d668;_0x17a9cc['product_name']==_0x626f38[_0x266bf5(0x1b1)]&&_0x17a9cc[_0x266bf5(0x15e)]==_0x626f38[_0x266bf5(0x15e)]&&_0x17a9cc[_0x266bf5(0xfe)]==_0x626f38[_0x266bf5(0xfe)]&&_0x17a9cc[_0x266bf5(0x1d0)]==_0x626f38[_0x266bf5(0x1d0)]&&_0x17a9cc['bay']==_0x626f38[_0x266bf5(0xfa)]&&_0x17a9cc[_0x266bf5(0x189)]==_0x626f38[_0x266bf5(0x189)]&&_0x17a9cc[_0x266bf5(0x13d)]==_0x626f38['storage']&&_0x17a9cc[_0x266bf5(0x201)]==_0x626f38[_0x266bf5(0x201)]&&_0x17a9cc[_0x266bf5(0x1a6)]==_0x626f38[_0x266bf5(0x1a6)]&&_0x17a9cc[_0x266bf5(0xec)]==_0x626f38[_0x266bf5(0xec)]&&_0x17a9cc['delivery_date']==_0x626f38[_0x266bf5(0xfb)]&&_0x17a9cc['delivery_code']==_0x626f38[_0x266bf5(0x147)]&&(_0x17a9cc['product_stock']=parseInt(_0x17a9cc[_0x266bf5(0x11d)])+parseInt(_0x626f38['quantity']),_0x31b1f7++);});_0x31b1f7=='0'&&(_0x382b3c['product_details']=_0x382b3c[_0x42d668(0x178)][_0x42d668(0x125)]({'product_name':_0x626f38[_0x42d668(0x1b1)],'product_stock':_0x626f38[_0x42d668(0x102)],'primary_code':_0x626f38['primary_code'],'secondary_code':_0x626f38[_0x42d668(0x113)],'product_code':_0x626f38[_0x42d668(0x1a8)],'storage':_0x626f38['storage'],'rack':_0x626f38[_0x42d668(0x189)],'bay':_0x626f38[_0x42d668(0xfa)],'bin':_0x626f38['bin'],'type':_0x626f38[_0x42d668(0xfe)],'floorlevel':_0x626f38[_0x42d668(0x15e)],'maxProducts':_0x626f38[_0x42d668(0x163)],'unit':_0x626f38[_0x42d668(0x19f)],'secondary_unit':_0x626f38[_0x42d668(0x139)],'expiry_date':_0x626f38[_0x42d668(0x201)],'maxPerUnit':_0x626f38[_0x42d668(0x1fb)],'batch_code':_0x626f38[_0x42d668(0x1a6)],'alertQTY':_0x626f38[_0x42d668(0x179)],'production_date':_0x626f38[_0x42d668(0xec)],'delivery_date':_0x626f38[_0x42d668(0xfb)],'delivery_code':_0x626f38[_0x42d668(0x147)]}));}),await _0x382b3c[_0x2108ad(0x19a)](),_0xc06031[_0x2108ad(0x1b6)]=_0x2108ad(0x1fc);const _0x4673a4=await _0xc06031[_0x2108ad(0x19a)]();_0x4307bc[_0x2108ad(0x105)](_0x2108ad(0x1bd),_0x2108ad(0x17d)),_0x1a4239[_0x2108ad(0xff)](_0x2108ad(0x1c2));}catch(_0x47f1cb){console['log'](_0x47f1cb);}}),router['get'](a0_0x5e92ae(0x152),auth,async(_0x3cad01,_0x4d9d95)=>{var _0x46c1a5=a0_0x5e92ae;try{const {username:_0xb2133a,email:_0x311a60,role:_0xf2107d}=_0x3cad01[_0x46c1a5(0x10b)],_0x35677e=_0x3cad01[_0x46c1a5(0x10b)],_0xce9e53=await profile[_0x46c1a5(0x18f)]({'email':_0x35677e[_0x46c1a5(0x191)]}),_0x5b2a28=await master_shop[_0x46c1a5(0x1aa)](),_0xcda4ec=_0x3cad01[_0x46c1a5(0x106)]['id'],_0x376d9e=await purchases[_0x46c1a5(0x10d)](_0xcda4ec),_0x751c0f=await suppliers['find']({});let _0x456297;if(_0x35677e['role']==_0x46c1a5(0x165)){const _0x578ab2=await staff[_0x46c1a5(0x18f)]({'email':_0x35677e['email']});_0x456297=await warehouse['find']({'status':_0x46c1a5(0x1f1),'name':_0x578ab2[_0x46c1a5(0x166)],'warehouse_category':'Raw\x20Materials'});}else _0x456297=await warehouse[_0x46c1a5(0x1ba)]([{'$match':{'status':'Enabled','warehouse_category':_0x46c1a5(0x1c5)}},{'$group':{'_id':_0x46c1a5(0x19e),'name':{'$first':_0x46c1a5(0x19e)}}}]);const _0x4b34b9=await product[_0x46c1a5(0x1aa)]({}),_0x88790d=BayBinSelected(_0x376d9e['warehouse_name'],_0x376d9e['room']);let _0x37d801=new Date(_0x376d9e[_0x46c1a5(0x201)]),_0x374dff=('0'+_0x37d801[_0x46c1a5(0x127)]())[_0x46c1a5(0x158)](-0x2),_0x2542cf=('0'+(_0x37d801[_0x46c1a5(0x1d8)]()+0x1))[_0x46c1a5(0x158)](-0x2),_0x283da5=_0x37d801[_0x46c1a5(0x1f6)](),_0x57d17c=_0x283da5+'-'+_0x2542cf+'-'+_0x374dff;if(_0x5b2a28[0x0][_0x46c1a5(0x184)]==_0x46c1a5(0x12e)){var _0x418dd3=users[_0x46c1a5(0x1a3)];console[_0x46c1a5(0x1f8)](_0x418dd3);}else{if(_0x5b2a28[0x0]['language']==_0x46c1a5(0x1de))var _0x418dd3=users[_0x46c1a5(0x1de)];else{if(_0x5b2a28[0x0][_0x46c1a5(0x184)]=='German')var _0x418dd3=users['German'];else{if(_0x5b2a28[0x0][_0x46c1a5(0x184)]==_0x46c1a5(0x1ec))var _0x418dd3=users[_0x46c1a5(0x1ec)];else{if(_0x5b2a28[0x0][_0x46c1a5(0x184)]==_0x46c1a5(0xed))var _0x418dd3=users['French'];else{if(_0x5b2a28[0x0]['language']=='Portuguese\x20(BR)')var _0x418dd3=users[_0x46c1a5(0x1e9)];else{if(_0x5b2a28[0x0][_0x46c1a5(0x184)]=='Chinese')var _0x418dd3=users[_0x46c1a5(0x128)];else{if(_0x5b2a28[0x0][_0x46c1a5(0x184)]==_0x46c1a5(0x1c8))var _0x418dd3=users[_0x46c1a5(0x1f7)];}}}}}}}_0x4d9d95[_0x46c1a5(0x14d)]('edit_purchases',{'success':_0x3cad01[_0x46c1a5(0x105)](_0x46c1a5(0x1bd)),'errors':_0x3cad01[_0x46c1a5(0x105)]('errors'),'role':_0x35677e,'profile':_0xce9e53,'purchases':_0x376d9e,'suppliers':_0x751c0f,'warehouse':_0x456297,'product':_0x4b34b9,'master_shop':_0x5b2a28,'language':_0x418dd3,'ed_fullDate':_0x57d17c,'dataSelected':_0x88790d});}catch(_0x24184d){console[_0x46c1a5(0x1f8)](_0x24184d);}}),router[a0_0x5e92ae(0xfc)]('/view/:id',auth,async(_0x3d5559,_0x378362)=>{var _0x44112f=a0_0x5e92ae;try{const _0x55793b=_0x3d5559[_0x44112f(0x106)]['id'],_0x335966=await purchases[_0x44112f(0x18f)]({'_id':_0x3d5559[_0x44112f(0x106)]['id']}),_0x18b6de=await warehouse[_0x44112f(0x18f)]({'name':_0x335966[_0x44112f(0x1af)],'room':_0x335966[_0x44112f(0x133)]});_0x335966['product']['forEach'](_0x19e897=>{var _0x4d9867=_0x44112f;const _0x1b06f5=_0x18b6de[_0x4d9867(0x178)][_0x4d9867(0xf0)](_0x5e36f6=>{var _0x3c9e56=_0x4d9867;_0x5e36f6[_0x3c9e56(0x1b1)]==_0x19e897['product_name']&&_0x5e36f6[_0x3c9e56(0x15e)]==_0x19e897[_0x3c9e56(0x15e)]&&_0x5e36f6[_0x3c9e56(0xfe)]==_0x19e897[_0x3c9e56(0xfe)]&&_0x5e36f6[_0x3c9e56(0x1d0)]==_0x19e897[_0x3c9e56(0x1d0)]&&_0x5e36f6['bay']==_0x19e897[_0x3c9e56(0xfa)]&&_0x5e36f6[_0x3c9e56(0x189)]==_0x19e897[_0x3c9e56(0x189)]&&_0x5e36f6['storage']==_0x19e897[_0x3c9e56(0x13d)]&&(_0x5e36f6[_0x3c9e56(0x11d)]=parseInt(_0x5e36f6[_0x3c9e56(0x11d)])-parseInt(_0x19e897[_0x3c9e56(0x102)]));});}),await _0x18b6de['save']();const {invoice:_0x221ac5,suppliers:_0x2e4af0,date:_0x27beea,warehouse_name:_0x52a1ed,prod_name:_0x41cd52,prod_code:_0x55f76c,prod_qty:_0x468cac,prod_unit:_0x31b1e6,prod_secondunit:_0x154ad4,prod_level:_0x240ac2,prod_isle:_0x463bcd,prod_pallet:_0x32c464,note:_0x3bc857,expiry_date:_0x5bfba4,batch_code:_0x1d978a,paid_amount:_0x49b0a8,due_amount:_0x5b27fc,Room_name:_0x3a9c2b,primary_code:_0x153752,secondary_code:_0x56ca1e,PO_number:_0x15fc22,JO_number:_0x1c2b30}=_0x3d5559[_0x44112f(0xf1)];if(typeof _0x41cd52==_0x44112f(0x11b))var _0xfb581=[_0x3d5559[_0x44112f(0xf1)]['prod_name']],_0x31b331=[_0x3d5559['body'][_0x44112f(0x107)]],_0x47ffd6=[_0x3d5559['body'][_0x44112f(0x1e7)]],_0x460fbe=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1d3)]],_0x2db9d0=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x141)]],_0x3b24e1=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1ff)]],_0x4551f9=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x203)]],_0xfaf4d7=[_0x3d5559[_0x44112f(0xf1)]['prod_pallet']],_0x1d5bcf=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x117)]],_0x31b0ac=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x113)]],_0x4862db=[_0x3d5559[_0x44112f(0xf1)]['MaxStocks_data']],_0x5461d0=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1a6)]],_0xa2c722=[_0x3d5559['body']['expiry_date']],_0x436d1a=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x13d)]],_0x5b7d1a=[_0x3d5559['body'][_0x44112f(0x1f4)]],_0xef72d4=[_0x3d5559[_0x44112f(0xf1)][_0x44112f(0xfe)]];else var _0xfb581=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x185)]],_0x31b331=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x107)]],_0x47ffd6=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1e7)]],_0x460fbe=[..._0x3d5559[_0x44112f(0xf1)]['prod_unit']],_0x2db9d0=[..._0x3d5559[_0x44112f(0xf1)]['prod_secondunit']],_0x3b24e1=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1ff)]],_0x4551f9=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x203)]],_0xfaf4d7=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1a0)]],_0x1d5bcf=[..._0x3d5559[_0x44112f(0xf1)]['primary_code']],_0x31b0ac=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x113)]],_0x4862db=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0xf4)]],_0x5461d0=[..._0x3d5559['body'][_0x44112f(0x1a6)]],_0xa2c722=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0x201)]],_0x436d1a=[..._0x3d5559['body'][_0x44112f(0x13d)]],_0x5b7d1a=[..._0x3d5559['body'][_0x44112f(0x1f4)]],_0xef72d4=[..._0x3d5559[_0x44112f(0xf1)][_0x44112f(0xfe)]];const _0xb59ad8=_0xfb581[_0x44112f(0xf0)](_0xd297c1=>{return _0xd297c1={'product_name':_0xd297c1};});_0x31b331[_0x44112f(0x169)]((_0x596ec7,_0x32e75f)=>{var _0x5429d1=_0x44112f;_0xb59ad8[_0x32e75f][_0x5429d1(0x1a8)]=_0x596ec7;}),_0x47ffd6[_0x44112f(0x169)]((_0x33cf8a,_0x240f58)=>{_0xb59ad8[_0x240f58]['quantity']=_0x33cf8a;}),_0x460fbe[_0x44112f(0x169)]((_0x28195c,_0x2e1964)=>{var _0x37a337=_0x44112f;_0xb59ad8[_0x2e1964][_0x37a337(0x19f)]=_0x28195c;}),_0x2db9d0[_0x44112f(0x169)]((_0x5ac195,_0x32d794)=>{_0xb59ad8[_0x32d794]['secondary_unit']=_0x5ac195;}),_0x3b24e1[_0x44112f(0x169)]((_0x50ea04,_0x196cca)=>{_0xb59ad8[_0x196cca]['bay']=_0x50ea04;}),_0x4551f9['forEach']((_0x5032eb,_0xab37fc)=>{var _0x334731=_0x44112f;_0xb59ad8[_0xab37fc][_0x334731(0x1d0)]=_0x5032eb;}),_0xfaf4d7[_0x44112f(0x169)]((_0x34a3eb,_0x5d9afa)=>{var _0xccc90c=_0x44112f;_0xb59ad8[_0x5d9afa][_0xccc90c(0x15e)]=_0x34a3eb;}),_0x1d5bcf[_0x44112f(0x169)]((_0x3a2c00,_0x336c89)=>{_0xb59ad8[_0x336c89]['primary_code']=_0x3a2c00;}),_0x31b0ac['forEach']((_0x29c221,_0x1a5eeb)=>{var _0x1bed3b=_0x44112f;_0xb59ad8[_0x1a5eeb][_0x1bed3b(0x113)]=_0x29c221;}),_0x4862db[_0x44112f(0x169)]((_0x2efebe,_0x130697)=>{var _0x4c3749=_0x44112f;_0xb59ad8[_0x130697][_0x4c3749(0x163)]=_0x2efebe;}),_0x5461d0[_0x44112f(0x169)]((_0x5bf868,_0x513626)=>{var _0x1b4c46=_0x44112f;_0xb59ad8[_0x513626][_0x1b4c46(0x1a6)]=_0x5bf868;}),_0xa2c722[_0x44112f(0x169)]((_0x44e767,_0x507611)=>{var _0x21f214=_0x44112f;_0xb59ad8[_0x507611][_0x21f214(0x201)]=_0x44e767;}),_0xef72d4[_0x44112f(0x169)]((_0x143bd7,_0xe5fe7e)=>{var _0x4d94ab=_0x44112f;_0xb59ad8[_0xe5fe7e][_0x4d94ab(0xfe)]=_0x143bd7;}),_0x436d1a['forEach']((_0x139568,_0x12fca1)=>{var _0xc0f03b=_0x44112f;_0xb59ad8[_0x12fca1][_0xc0f03b(0x13d)]=_0x139568;}),_0x5b7d1a[_0x44112f(0x169)]((_0xdb809b,_0x232b6c)=>{var _0x449dee=_0x44112f;_0xb59ad8[_0x232b6c][_0x449dee(0x189)]=_0xdb809b;});const _0x1d1dde=_0xb59ad8[_0x44112f(0x1c1)](_0x13dede=>_0x13dede[_0x44112f(0x102)]!=='0'&&_0x13dede[_0x44112f(0x102)]!=='');_0x335966[_0x44112f(0x1fd)]=_0x221ac5,_0x335966['suppliers']=_0x2e4af0,_0x335966[_0x44112f(0x111)]=_0x27beea,_0x335966['warehouse_name']=_0x52a1ed,_0x335966['product']=_0x1d1dde,_0x335966['note']=_0x3bc857,_0x335966['paid_amount']=_0x49b0a8,_0x335966[_0x44112f(0x1c3)]=_0x5b27fc,_0x335966[_0x44112f(0x133)]=_0x3a9c2b,_0x335966[_0x44112f(0x151)]=_0x15fc22,_0x335966['JO_number']=_0x1c2b30;const _0x11b69b=await _0x335966['save'](),_0x4b3144=await warehouse[_0x44112f(0x18f)]({'name':_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1af)],'room':_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1e8)]});_0x335966[_0x44112f(0x138)][_0x44112f(0x169)](_0x2bf856=>{var _0x566a0b=_0x44112f,_0x5c626f=0x0;const _0x5d74ff=_0x4b3144[_0x566a0b(0x178)][_0x566a0b(0xf0)](_0x3a26bc=>{var _0x2d7c2a=_0x566a0b;_0x3a26bc['product_name']==_0x2bf856[_0x2d7c2a(0x1b1)]&&_0x3a26bc[_0x2d7c2a(0x15e)]==_0x2bf856['floorlevel']&&_0x3a26bc[_0x2d7c2a(0xfe)]==_0x2bf856['type']&&_0x3a26bc[_0x2d7c2a(0x1d0)]==_0x2bf856[_0x2d7c2a(0x1d0)]&&_0x3a26bc['bay']==_0x2bf856[_0x2d7c2a(0xfa)]&&_0x3a26bc[_0x2d7c2a(0x189)]==_0x2bf856[_0x2d7c2a(0x189)]&&_0x3a26bc[_0x2d7c2a(0x13d)]==_0x2bf856[_0x2d7c2a(0x13d)]&&(_0x3a26bc[_0x2d7c2a(0x11d)]=parseInt(_0x3a26bc[_0x2d7c2a(0x11d)])+parseInt(_0x2bf856[_0x2d7c2a(0x102)]),_0x5c626f++);});_0x5c626f=='0'&&(_0x4b3144[_0x566a0b(0x178)]=_0x4b3144[_0x566a0b(0x178)][_0x566a0b(0x125)]({'product_name':_0x2bf856[_0x566a0b(0x1b1)],'product_stock':_0x2bf856[_0x566a0b(0x102)],'primary_code':_0x2bf856[_0x566a0b(0x117)],'secondary_code':_0x2bf856[_0x566a0b(0x113)],'product_code':_0x2bf856[_0x566a0b(0x1a8)],'storage':_0x2bf856[_0x566a0b(0x13d)],'rack':_0x2bf856[_0x566a0b(0x189)],'bay':_0x2bf856[_0x566a0b(0xfa)],'bin':_0x2bf856[_0x566a0b(0x1d0)],'type':_0x2bf856['type'],'floorlevel':_0x2bf856[_0x566a0b(0x15e)],'maxProducts':_0x2bf856[_0x566a0b(0x163)],'unit':_0x2bf856[_0x566a0b(0x19f)],'secondary_unit':_0x2bf856['secondary_unit'],'expiry_date':_0x2bf856[_0x566a0b(0x201)]}));}),await _0x4b3144[_0x44112f(0x19a)]();const _0x3e3359=await s_payment_data[_0x44112f(0x18f)]({'invoice':_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1fd)]});if(_0x3e3359===null){}else console[_0x44112f(0x1f8)]('suppliers',_0x3e3359,_0x3d5559[_0x44112f(0xf1)][_0x44112f(0x1fd)]),_0x3e3359['suppliers']=_0x3d5559['body']['suppliers'],await _0x3e3359[_0x44112f(0x19a)]();_0x3d5559[_0x44112f(0x105)](_0x44112f(0x1bd),_0x44112f(0x15b)),_0x378362[_0x44112f(0xff)](_0x44112f(0x1c2));}catch(_0x253aec){console[_0x44112f(0x1f8)](_0x253aec);}}),router[a0_0x5e92ae(0xfc)](a0_0x5e92ae(0x187),auth,async(_0x461d49,_0x5825c1)=>{var _0x1d2720=a0_0x5e92ae;try{const _0x55bca7=_0x461d49[_0x1d2720(0x106)]['id'],{invoice:_0x187f59,suppliers:_0x4f01ec,payable:_0x4adaaf,due_amount:_0x455e99}=_0x461d49[_0x1d2720(0xf1)],_0x5e1780=await purchases['findById'](_0x55bca7);var _0x282680=_0x4adaaf-_0x455e99;_0x5e1780[_0x1d2720(0x1d5)]=parseFloat(_0x5e1780[_0x1d2720(0x1d5)])+parseFloat(_0x455e99),_0x5e1780[_0x1d2720(0x1c3)]=_0x282680;const _0x52d235=await _0x5e1780[_0x1d2720(0x19a)]();console[_0x1d2720(0x1f8)](_0x52d235);const _0x57ebcd=await s_payment_data['findOne']({'invoice':_0x187f59});_0x57ebcd[_0x1d2720(0x10a)]=_0x282680,await _0x57ebcd[_0x1d2720(0x19a)]();let _0x2257ff=new Date(),_0x3577d5=('0'+_0x2257ff[_0x1d2720(0x127)]())[_0x1d2720(0x158)](-0x2),_0x1a1f89=('0'+(_0x2257ff[_0x1d2720(0x1d8)]()+0x1))[_0x1d2720(0x158)](-0x2),_0x5516ea=_0x2257ff[_0x1d2720(0x1f6)](),_0x5360a6=_0x5516ea+'-'+_0x1a1f89+'-'+_0x3577d5;const _0x3b0afb=new suppliers_payment({'invoice':_0x187f59,'date':_0x5516ea+'-'+_0x1a1f89+'-'+_0x3577d5,'suppliers':_0x4f01ec,'reason':_0x1d2720(0x168),'amount':_0x455e99}),_0x39133a=await _0x3b0afb['save']();_0x461d49[_0x1d2720(0x105)]('success','payment\x20successfull'),_0x5825c1[_0x1d2720(0xff)]('/all_purchases/view');}catch(_0xc7c55c){console[_0x1d2720(0x1f8)](_0xc7c55c);}}),router[a0_0x5e92ae(0x1f9)](a0_0x5e92ae(0x1a2),auth,async(_0x5ad962,_0x508e4a)=>{var _0x3f9c3d=a0_0x5e92ae;try{const {username:_0x15c95b,email:_0x4b5bf5,role:_0x34b74d}=_0x5ad962[_0x3f9c3d(0x10b)],_0x2dd6ce=_0x5ad962['user'],_0x5333ce=await profile[_0x3f9c3d(0x18f)]({'email':_0x2dd6ce[_0x3f9c3d(0x191)]}),_0x2521a0=await master_shop[_0x3f9c3d(0x1aa)]();console['log'](_0x3f9c3d(0x1db),_0x2521a0);const _0x3ea436=_0x5ad962[_0x3f9c3d(0x106)]['id'],_0x5df2cc=await purchases['findById'](_0x3ea436);console[_0x3f9c3d(0x1f8)](_0x5df2cc);const _0x29f06b=await suppliers[_0x3f9c3d(0x18f)]({'name':_0x5df2cc[_0x3f9c3d(0x1b9)]});console[_0x3f9c3d(0x1f8)](_0x29f06b);if(_0x2521a0[0x0][_0x3f9c3d(0x184)]==_0x3f9c3d(0x12e)){var _0x28ce62=users[_0x3f9c3d(0x1a3)];console[_0x3f9c3d(0x1f8)](_0x28ce62);}else{if(_0x2521a0[0x0][_0x3f9c3d(0x184)]==_0x3f9c3d(0x1de))var _0x28ce62=users[_0x3f9c3d(0x1de)];else{if(_0x2521a0[0x0][_0x3f9c3d(0x184)]==_0x3f9c3d(0x16b))var _0x28ce62=users[_0x3f9c3d(0x16b)];else{if(_0x2521a0[0x0][_0x3f9c3d(0x184)]=='Spanish')var _0x28ce62=users[_0x3f9c3d(0x1ec)];else{if(_0x2521a0[0x0][_0x3f9c3d(0x184)]==_0x3f9c3d(0xed))var _0x28ce62=users[_0x3f9c3d(0xed)];else{if(_0x2521a0[0x0][_0x3f9c3d(0x184)]=='Portuguese\x20(BR)')var _0x28ce62=users[_0x3f9c3d(0x1e9)];else{if(_0x2521a0[0x0]['language']==_0x3f9c3d(0x128))var _0x28ce62=users[_0x3f9c3d(0x128)];else{if(_0x2521a0[0x0][_0x3f9c3d(0x184)]=='Arabic\x20(ae)')var _0x28ce62=users[_0x3f9c3d(0x1f7)];}}}}}}}_0x508e4a[_0x3f9c3d(0x14d)](_0x3f9c3d(0xf6),{'success':_0x5ad962[_0x3f9c3d(0x105)]('success'),'errors':_0x5ad962[_0x3f9c3d(0x105)]('errors'),'role':_0x2dd6ce,'profile':_0x5333ce,'master_shop':_0x2521a0,'supplier':_0x29f06b,'purchase':_0x5df2cc,'language':_0x28ce62});}catch(_0x2e99e2){console[_0x3f9c3d(0x1f8)](_0x2e99e2);}}),router[a0_0x5e92ae(0x1f9)](a0_0x5e92ae(0x176),auth,async(_0x195baa,_0x59ba63)=>{var _0x482067=a0_0x5e92ae;try{const {username:_0x359308,email:_0x52f02d,role:_0x4000c8}=_0x195baa[_0x482067(0x10b)],_0x6bff27=_0x195baa[_0x482067(0x10b)],_0x12022e=await profile[_0x482067(0x18f)]({'email':_0x6bff27[_0x482067(0x191)]}),_0x581ef7=await master_shop['find']();console[_0x482067(0x1f8)](_0x482067(0x1db),_0x581ef7);const _0x1e0bed=_0x195baa[_0x482067(0x106)]['id'];console[_0x482067(0x1f8)](_0x1e0bed);const _0x52abaa=await purchases[_0x482067(0x10d)](_0x1e0bed);console[_0x482067(0x1f8)](_0x482067(0x175),_0x52abaa);const _0x4944de=await product[_0x482067(0x1aa)]({}),_0x51619f=await warehouse[_0x482067(0x1ba)]([{'$match':{'name':_0x52abaa[_0x482067(0x1af)],'room':_0x52abaa[_0x482067(0x133)],'warehouse_category':_0x482067(0x1c5)}},{'$unwind':_0x482067(0x112)},{'$group':{'_id':_0x482067(0x1bf),'name':{'$first':_0x482067(0x1c7)},'product_stock':{'$first':_0x482067(0x18e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x482067(0x1a1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x482067(0x1ed)},'secondary_code':{'$first':_0x482067(0x1e4)},'product_code':{'$first':_0x482067(0x12f)},'storage':{'$first':_0x482067(0x144)},'rack':{'$first':_0x482067(0x177)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x482067(0x197),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x482067(0x19e),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x482067(0x1f8)](_0x482067(0x1c4),_0x51619f);if(_0x581ef7[0x0][_0x482067(0x184)]==_0x482067(0x12e)){var _0x1ee303=users[_0x482067(0x1a3)];console['log'](_0x1ee303);}else{if(_0x581ef7[0x0][_0x482067(0x184)]==_0x482067(0x1de))var _0x1ee303=users[_0x482067(0x1de)];else{if(_0x581ef7[0x0]['language']=='German')var _0x1ee303=users[_0x482067(0x16b)];else{if(_0x581ef7[0x0][_0x482067(0x184)]==_0x482067(0x1ec))var _0x1ee303=users['Spanish'];else{if(_0x581ef7[0x0]['language']==_0x482067(0xed))var _0x1ee303=users['French'];else{if(_0x581ef7[0x0][_0x482067(0x184)]==_0x482067(0x18a))var _0x1ee303=users[_0x482067(0x1e9)];else{if(_0x581ef7[0x0][_0x482067(0x184)]==_0x482067(0x128))var _0x1ee303=users[_0x482067(0x128)];else{if(_0x581ef7[0x0][_0x482067(0x184)]==_0x482067(0x1c8))var _0x1ee303=users[_0x482067(0x1f7)];}}}}}}}_0x59ba63['render'](_0x482067(0x11e),{'success':_0x195baa[_0x482067(0x105)](_0x482067(0x1bd)),'errors':_0x195baa[_0x482067(0x105)]('errors'),'role':_0x6bff27,'profile':_0x12022e,'user':_0x52abaa,'stock':_0x51619f,'master_shop':_0x581ef7,'product':_0x4944de,'language':_0x1ee303,'warehouse':warehouse_data});}catch(_0x409651){console[_0x482067(0x1f8)](_0x409651);}}),router[a0_0x5e92ae(0xfc)]('/view/return_purchase/:id',auth,async(_0x3a0158,_0x3e13c2)=>{var _0x370460=a0_0x5e92ae;try{const {invoice:_0x24b4a3,date:_0x32f266,warehouse_name:_0x5c4f9a,Room_name:_0x1be300,product_name:_0x168262,purchase_quantity:_0x267de5,stocks:_0x1f6084,return_qty:_0x209720,note:_0x2fca0c,level:_0x18bec6,isle:_0x3761c4,pallet:_0x1c9e99,to_warehouse_name:_0x55ee23,to_Room_name:_0x46dcdd}=_0x3a0158['body'],_0x577a96=await purchases[_0x370460(0x18f)]({'_id':_0x3a0158[_0x370460(0x106)]['id']}),_0x447247=await warehouse['findOne']({'name':_0x5c4f9a,'room':_0x1be300});if(typeof _0x168262==_0x370460(0x11b))var _0x16da1c=[_0x3a0158[_0x370460(0xf1)]['product_name']],_0x33f8ae=[_0x3a0158['body'][_0x370460(0xeb)]],_0x45c859=[_0x3a0158[_0x370460(0xf1)][_0x370460(0x186)]],_0xc23eaa=[_0x3a0158['body'][_0x370460(0x1ab)]],_0x356620=[_0x3a0158[_0x370460(0xf1)][_0x370460(0x1b0)]],_0x3c23f5=[_0x3a0158[_0x370460(0xf1)][_0x370460(0x1d4)]],_0x43aaf0=[_0x3a0158['body'][_0x370460(0x1fa)]],_0x46abfc=[_0x3a0158[_0x370460(0xf1)][_0x370460(0x167)]],_0x1a6ff9=[_0x3a0158[_0x370460(0xf1)][_0x370460(0xf7)]],_0x44d8f8=[_0x3a0158[_0x370460(0xf1)][_0x370460(0x18b)]],_0x429595=[_0x3a0158[_0x370460(0xf1)][_0x370460(0x202)]];else var _0x16da1c=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x1b1)]],_0x33f8ae=[..._0x3a0158[_0x370460(0xf1)]['purchase_quantity']],_0x45c859=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x186)]],_0xc23eaa=[..._0x3a0158[_0x370460(0xf1)]['return_qty']],_0x356620=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x1b0)]],_0x3c23f5=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x1d4)]],_0x43aaf0=[..._0x3a0158['body'][_0x370460(0x1fa)]],_0x46abfc=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x167)]],_0x1a6ff9=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0xf7)]],_0x44d8f8=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x18b)]],_0x429595=[..._0x3a0158[_0x370460(0xf1)][_0x370460(0x202)]];const _0x20718d=_0x16da1c[_0x370460(0xf0)](_0x5b7a94=>{return _0x5b7a94={'product_name':_0x5b7a94};});_0x33f8ae[_0x370460(0x169)]((_0x1a8375,_0x4c1b8a)=>{_0x20718d[_0x4c1b8a]['purchase_quantity']=_0x1a8375;}),_0x45c859[_0x370460(0x169)]((_0x2e143a,_0x4bc595)=>{var _0x42bb82=_0x370460;_0x20718d[_0x4bc595][_0x42bb82(0x134)]=_0x2e143a;}),_0xc23eaa[_0x370460(0x169)]((_0x15af04,_0xac8322)=>{_0x20718d[_0xac8322]['return_qty']=_0x15af04;}),_0x356620[_0x370460(0x169)]((_0x248a78,_0x5ada65)=>{_0x20718d[_0x5ada65]['bay']=_0x248a78;}),_0x3c23f5[_0x370460(0x169)]((_0x1435b4,_0x420b4a)=>{var _0x587651=_0x370460;_0x20718d[_0x420b4a][_0x587651(0x1d0)]=_0x1435b4;}),_0x43aaf0[_0x370460(0x169)]((_0x40ff11,_0x3ed23e)=>{var _0x4bf86f=_0x370460;_0x20718d[_0x3ed23e][_0x4bf86f(0x15e)]=_0x40ff11;}),_0x46abfc[_0x370460(0x169)]((_0xaa67e7,_0x39fa7f)=>{_0x20718d[_0x39fa7f]['type']=_0xaa67e7;}),_0x1a6ff9[_0x370460(0x169)]((_0x228c2c,_0x195cfa)=>{var _0x18ee11=_0x370460;_0x20718d[_0x195cfa][_0x18ee11(0x1a8)]=_0x228c2c;}),_0x44d8f8['forEach']((_0xef0f12,_0x54d900)=>{var _0x235edc=_0x370460;_0x20718d[_0x54d900][_0x235edc(0x117)]=_0xef0f12;}),_0x429595[_0x370460(0x169)]((_0x48f46f,_0x4d614c)=>{var _0x26cecc=_0x370460;_0x20718d[_0x4d614c][_0x26cecc(0x113)]=_0x48f46f;}),_0x577a96[_0x370460(0x138)][_0x370460(0x169)](_0x5981a4=>{var _0x52bf47=_0x370460;const _0x5e3250=_0x447247[_0x52bf47(0x178)][_0x52bf47(0xf0)](_0x133394=>{var _0x379c33=_0x52bf47;_0x133394[_0x379c33(0x1b1)]==_0x5981a4['product_name']&&_0x133394[_0x379c33(0x15e)]==_0x5981a4['floorlevel']&&_0x133394['type']==_0x5981a4['type']&&_0x133394[_0x379c33(0x1d0)]==_0x5981a4[_0x379c33(0x1d0)]&&_0x133394[_0x379c33(0xfa)]==_0x5981a4[_0x379c33(0xfa)]&&_0x133394[_0x379c33(0x189)]==_0x5981a4[_0x379c33(0x189)]&&_0x133394[_0x379c33(0x13d)]==_0x5981a4[_0x379c33(0x13d)]&&(console[_0x379c33(0x1f8)](parseInt(_0x133394['product_stock'])+'\x20<>\x20'+parseInt(_0x5981a4[_0x379c33(0x102)])),_0x133394[_0x379c33(0x11d)]=parseInt(_0x133394[_0x379c33(0x11d)])+parseInt(_0x5981a4[_0x379c33(0x102)]));});}),await _0x447247[_0x370460(0x19a)]();const _0x22679f=_0x20718d['filter'](_0x231cf9=>_0x231cf9[_0x370460(0x1ab)]!=='0'&&_0x231cf9[_0x370460(0x1ab)]!=='');var _0x2fa363=0x0;_0x22679f[_0x370460(0x169)](_0x161838=>{var _0x33d73c=_0x370460;console['log'](_0x33d73c(0x1df),_0x161838),(parseInt(_0x161838[_0x33d73c(0xeb)])<parseInt(_0x161838[_0x33d73c(0x1ab)])||parseInt(_0x161838['stock_quantity'])<parseInt(_0x161838[_0x33d73c(0x1ab)]))&&_0x2fa363++;});if(_0x2fa363!=0x0)return _0x3a0158['flash'](_0x370460(0x1ad),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3e13c2[_0x370460(0xff)](_0x370460(0x118));const _0x36a045=new purchases_return({'invoice':_0x24b4a3,'suppliers':_0x3a0158['body']['suppliers'],'date':_0x32f266,'warehouse_name':_0x5c4f9a,'return_product':_0x22679f,'note':_0x2fca0c,'room':_0x1be300,'to_warehouse_name':_0x55ee23,'to_room':_0x46dcdd}),_0x27b252=await _0x36a045[_0x370460(0x19a)]();console[_0x370460(0x1f8)](_0x36a045);const _0x2b4cd5=await purchases_return['findOne']({'invoice':_0x24b4a3}),_0x25ed18=await warehouse[_0x370460(0x18f)]({'name':_0x55ee23,'room':_0x46dcdd});_0x2b4cd5[_0x370460(0x19b)][_0x370460(0x169)](_0x33310e=>{var _0x614740=_0x370460,_0x3bb9ec=0x0;const _0x53db35=_0x25ed18[_0x614740(0x178)]['map'](_0x2f0f19=>{var _0x447cba=_0x614740;_0x2f0f19[_0x447cba(0x1b1)]==_0x33310e[_0x447cba(0x1b1)]&&_0x2f0f19['floorlevel']==_0x33310e[_0x447cba(0x15e)]&&_0x2f0f19[_0x447cba(0xfe)]==_0x33310e[_0x447cba(0xfe)]&&_0x2f0f19[_0x447cba(0x1d0)]==_0x33310e[_0x447cba(0x1d0)]&&_0x2f0f19['bay']==_0x33310e[_0x447cba(0xfa)]&&(_0x2f0f19[_0x447cba(0x11d)]=parseInt(_0x2f0f19[_0x447cba(0x11d)])-parseInt(_0x33310e[_0x447cba(0x1ab)]),_0x3bb9ec++);});_0x3bb9ec=='0'&&(_0x25ed18[_0x614740(0x178)]=_0x25ed18[_0x614740(0x178)]['concat']({'product_name':_0x33310e[_0x614740(0x1b1)],'product_stock':_0x33310e[_0x614740(0x1ab)],'primary_code':_0x33310e[_0x614740(0x117)],'secondary_code':_0x33310e[_0x614740(0x113)],'product_code':_0x33310e['product_code'],'storage':_0x33310e[_0x614740(0x13d)],'rack':_0x33310e[_0x614740(0x189)],'bay':_0x33310e[_0x614740(0xfa)],'bin':_0x33310e[_0x614740(0x1d0)],'type':_0x33310e[_0x614740(0xfe)],'floorlevel':_0x33310e[_0x614740(0x15e)],'maxProducts':_0x33310e['maxStocks'],'unit':_0x33310e['standard_unit'],'secondary_unit':_0x33310e[_0x614740(0x139)],'expiry_date':_0x33310e[_0x614740(0x201)]}));}),await _0x25ed18['save']();const _0x57f3b6=await purchases[_0x370460(0x18f)]({'invoice':_0x24b4a3});_0x57f3b6[_0x370460(0x181)]='True';const _0x4869ca=await _0x57f3b6[_0x370460(0x19a)](),_0x11e91a=new s_payment_data({'invoice':_0x24b4a3,'suppliers':_0x3a0158[_0x370460(0xf1)]['suppliers'],'reason':_0x370460(0x1e6)});await _0x11e91a[_0x370460(0x19a)]();const _0x4211a4=await master_shop[_0x370460(0x1aa)]();console[_0x370460(0x1f8)](_0x370460(0x121),_0x4211a4[0x0][_0x370460(0x183)]);const _0x393f61=await email_settings[_0x370460(0x18f)](),_0x583852=await suppliers[_0x370460(0x18f)]({'name':_0x3a0158[_0x370460(0xf1)][_0x370460(0x1b9)]});console[_0x370460(0x1f8)](_0x370460(0x1e2),_0x583852);_0x4211a4[0x0]['currency_placement']==0x1?(right_currency=_0x4211a4[0x0][_0x370460(0x10c)],left_currency=''):(right_currency='',left_currency=_0x4211a4[0x0][_0x370460(0x10c)]);var _0x4b9e65=_0x16da1c,_0x139827=_0xc23eaa,_0x3649d5='',_0xbaf972;for(_0xbaf972 in _0x4b9e65){_0x3649d5+=_0x370460(0x164)+_0x370460(0x1dc)+_0x4b9e65[_0xbaf972]+_0x370460(0x14a)+_0x370460(0x1dc)+_0x139827[_0xbaf972]+_0x370460(0x14a)+'</tr>';}console['log']('product_list',_0x3649d5);let _0x503a8f=nodemailer[_0x370460(0x208)]({'service':_0x370460(0x145),'auth':{'user':_0x393f61['email'],'pass':_0x393f61[_0x370460(0x17b)]}}),_0x11dd2d={'from':_0x393f61[_0x370460(0x191)],'to':_0x583852[_0x370460(0x191)],'subject':_0x370460(0x137),'attachments':[{'filename':_0x370460(0x193),'path':__dirname+_0x370460(0x200)+_0x370460(0xf5)+_0x4211a4[0x0][_0x370460(0x183)],'cid':_0x370460(0x19d)}],'html':'<!DOCTYPE\x20html>'+_0x370460(0x124)+_0x370460(0x1a7)+_0x370460(0x161)+_0x370460(0x15d)+_0x370460(0x161)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x370460(0x15a)+_0x370460(0x161)+_0x370460(0x1ea)+_0x4211a4[0x0][_0x370460(0x1b7)]+_0x370460(0x196)+_0x370460(0x15a)+_0x370460(0x15a)+_0x370460(0x1b2)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x24b4a3+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x370460(0x13b)+_0x32f266+'\x20'+'</span>'+_0x370460(0xef)+_0x370460(0x15a)+_0x370460(0x172)+_0x370460(0x1b4)+_0x370460(0x164)+_0x370460(0x1f5)+_0x370460(0x109)+_0x370460(0x17c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x370460(0x153)+_0x370460(0x155)+_0x370460(0x1da)+'\x20'+_0x3649d5+'\x20'+_0x370460(0x1c9)+'</table>'+_0x370460(0x161)+_0x370460(0x11f)+_0x370460(0x12b)+_0x4211a4[0x0]['site_title']+_0x370460(0xef)+_0x370460(0x15a)+_0x370460(0x15a)+_0x370460(0x1cb)};_0x503a8f['sendMail'](_0x11dd2d,function(_0x39dd70,_0x21d62f){var _0x23807b=_0x370460;_0x39dd70?(console[_0x23807b(0x1f8)](_0x39dd70),console[_0x23807b(0x1f8)]('Error\x20Occurs')):console[_0x23807b(0x1f8)](_0x23807b(0x115));}),_0x3a0158[_0x370460(0x105)](_0x370460(0x1bd),_0x370460(0x1e1)),_0x3e13c2[_0x370460(0xff)](_0x370460(0x1c2));}catch(_0x3741c3){console['log'](_0x3741c3),_0x3e13c2[_0x370460(0x190)](0xc8)[_0x370460(0x174)]({'message':_0x3741c3[_0x370460(0xee)]});}}),router['get'](a0_0x5e92ae(0x1ef),auth,async(_0x5afdff,_0x16a5b5)=>{var _0xf1e909=a0_0x5e92ae;try{const {username:_0x419994,email:_0xd2c5dd,role:_0x3156ff}=_0x5afdff[_0xf1e909(0x10b)],_0x43a893=_0x5afdff[_0xf1e909(0x10b)],_0x2d5a1e=await profile[_0xf1e909(0x18f)]({'email':_0x43a893[_0xf1e909(0x191)]}),_0x4b0660=await master_shop[_0xf1e909(0x1aa)](),_0x28feee=_0x5afdff[_0xf1e909(0x106)]['id'],_0x29523a=await purchases[_0xf1e909(0x10d)](_0x28feee);if(_0x4b0660[0x0][_0xf1e909(0x184)]==_0xf1e909(0x12e))var _0x352e00=users[_0xf1e909(0x1a3)];else{if(_0x4b0660[0x0]['language']==_0xf1e909(0x1de))var _0x352e00=users['Hindi'];else{if(_0x4b0660[0x0][_0xf1e909(0x184)]==_0xf1e909(0x16b))var _0x352e00=users['German'];else{if(_0x4b0660[0x0][_0xf1e909(0x184)]==_0xf1e909(0x1ec))var _0x352e00=users[_0xf1e909(0x1ec)];else{if(_0x4b0660[0x0][_0xf1e909(0x184)]=='French')var _0x352e00=users[_0xf1e909(0xed)];else{if(_0x4b0660[0x0][_0xf1e909(0x184)]==_0xf1e909(0x18a))var _0x352e00=users[_0xf1e909(0x1e9)];else{if(_0x4b0660[0x0][_0xf1e909(0x184)]=='Chinese')var _0x352e00=users[_0xf1e909(0x128)];else{if(_0x4b0660[0x0][_0xf1e909(0x184)]==_0xf1e909(0x1c8))var _0x352e00=users[_0xf1e909(0x1f7)];}}}}}}}_0x16a5b5[_0xf1e909(0x14d)](_0xf1e909(0x17e),{'success':_0x5afdff[_0xf1e909(0x105)](_0xf1e909(0x1bd)),'errors':_0x5afdff[_0xf1e909(0x105)](_0xf1e909(0x1ad)),'role':_0x43a893,'profile':_0x2d5a1e,'alldata':_0x29523a,'master_shop':_0x4b0660,'language':_0x352e00}),console[_0xf1e909(0x1f8)](alldata);}catch(_0xb71de1){console[_0xf1e909(0x1f8)](_0xb71de1);}}),router[a0_0x5e92ae(0xfc)](a0_0x5e92ae(0x1a4),async(_0x464183,_0x16fc25)=>{var _0x20b384=a0_0x5e92ae;const {product_code:_0x5a0d32}=_0x464183[_0x20b384(0xf1)];var _0xb6bbdf;const _0x3db43a=await product[_0x20b384(0x1ba)]([{'$match':{'primary_code':_0x5a0d32,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x20b384(0x1ee),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x20b384(0x173)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x20b384(0x154)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x20b384(0x1d7)},'maxProdPerUnit':{'$first':_0x20b384(0x1f0)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x25b9be=await product[_0x20b384(0x1ba)]([{'$match':{'secondary_code':_0x5a0d32,'product_category':_0x20b384(0x1c5)}},{'$group':{'_id':'$_id','name':{'$first':_0x20b384(0x19e)},'category':{'$first':'$category'},'brand':{'$first':_0x20b384(0x122)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x20b384(0x1a5)},'primary_code':{'$first':_0x20b384(0x154)},'secondary_code':{'$first':_0x20b384(0x1b3)},'maxStocks':{'$first':_0x20b384(0x1d7)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x20b384(0x1bb)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3db43a[_0x20b384(0x1eb)]>0x0)_0xb6bbdf=_0x3db43a;else _0x25b9be['length']>0x0&&(_0xb6bbdf=_0x25b9be);_0x16fc25[_0x20b384(0x174)](_0xb6bbdf);}),router['post']('/CheckingWarehouse',async(_0x40da0b,_0x23e8c4)=>{var _0x12852e=a0_0x5e92ae;const {primaryCode:_0x3d354a,secondaryCode:_0x427e7f,productCode:_0x2fe980,bay:_0x137b86,bin:_0x577efd,types:_0xbdfc2e,pallet:_0x2697aa,warehouses:_0x295273,room:_0x1905c3}=_0x40da0b['body'];console['log'](_0x40da0b['body']);try{const _0x679ff4=await warehouse['aggregate']([{'$match':{'name':_0x295273,'room':_0x1905c3}},{'$unwind':_0x12852e(0x112)},{'$match':{'product_details.bay':_0x137b86,'product_details.bin':_0x577efd,'product_details.type':_0xbdfc2e}},{'$group':{'_id':_0x12852e(0x1bf),'name':{'$first':_0x12852e(0x1c7)},'product_stock':{'$first':_0x12852e(0x18e)},'level':{'$first':_0x12852e(0x198)},'isle':{'$first':_0x12852e(0x1c6)},'pallet':{'$first':_0x12852e(0x14f)},'maxProducts':{'$first':_0x12852e(0x104)}}}]);_0x23e8c4[_0x12852e(0x190)](0xc8)[_0x12852e(0x174)](_0x679ff4);}catch(_0x1e0ba0){_0x23e8c4[_0x12852e(0x190)](0x194)[_0x12852e(0x174)]({'message':_0x1e0ba0[_0x12852e(0xee)]});}}),module['exports']=router;