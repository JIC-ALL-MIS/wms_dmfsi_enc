function a0_0x4830(_0x288ca2,_0x5c609f){var _0x281583=a0_0x2815();return a0_0x4830=function(_0x4830e8,_0x31bd06){_0x4830e8=_0x4830e8-0x1eb;var _0x1da636=_0x281583[_0x4830e8];return _0x1da636;},a0_0x4830(_0x288ca2,_0x5c609f);}var a0_0x2c8f8a=a0_0x4830;(function(_0xbee1c4,_0x415722){var _0xe8d4b=a0_0x4830,_0x4efac9=_0xbee1c4();while(!![]){try{var _0x2ee19c=parseInt(_0xe8d4b(0x1ff))/0x1+parseInt(_0xe8d4b(0x27c))/0x2*(parseInt(_0xe8d4b(0x1fa))/0x3)+parseInt(_0xe8d4b(0x1f1))/0x4+parseInt(_0xe8d4b(0x211))/0x5*(-parseInt(_0xe8d4b(0x26d))/0x6)+parseInt(_0xe8d4b(0x2b0))/0x7+parseInt(_0xe8d4b(0x1eb))/0x8+-parseInt(_0xe8d4b(0x24d))/0x9;if(_0x2ee19c===_0x415722)break;else _0x4efac9['push'](_0x4efac9['shift']());}catch(_0x2e881d){_0x4efac9['push'](_0x4efac9['shift']());}}}(a0_0x2815,0x33fd5));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2c8f8a(0x2e4)),auth=require(a0_0x2c8f8a(0x30a)),nodemailer=require(a0_0x2c8f8a(0x25d));var ejs=require(a0_0x2c8f8a(0x1fe));const path=require('path'),users=require(a0_0x2c8f8a(0x26e));function a0_0x2815(){var _0x22b0df=['$secondary_code','$return_data','An\x20error\x20occurred\x20while\x20saving\x20data.','getDate','purchase_invoice','user','33430rUrKSB','$product_details.floorlevel','save','prod_invoice','/../public','createTransport','secondary_unit','user_id','Sales\x20Update\x20successfully','There\x27s\x20a\x20error\x20in\x20this\x20transaction','French','$_id','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','suppliers','Floor','abs','warehouse','$category','Arabic\x20(ae)','post','Enclosed','prod_name','$date','error','product','$secondary_unit','product_stock','\x20</h2>','Hindi','$product_details._id','string','logo','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_Qty','$product_details.expiry_date','$maxProdPerUnit','sendMail','warehouse_name','quantity','add_purchases','Enabled','$maxStocks','prod_code','map','return_data','params','$product_details.rack','Room_name','<tbody\x20style=\x22text-align:\x20center;\x22>','staff','/view','/invoice/:id','Chinese','purchases\x20item\x20return\x20successfull','deliverycode','return_product','site_title','5991444Rvzzqq','RMSEmail','batch_code','stocks','Raw\x20Materials','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','MaxStocks_data','findById','$product_code','filter','<html><head><title></title>','errors','\x20Order\x20Date\x20:\x20','Receiving\x20Area','secondary_code_hide','nodemailer','all','$product_details.secondary_code','purchase_quantity','$suppliers','edit_purchases','maxperunit','$product_details.bay','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','</head><body>','stock_data','image','type','rack','Paid\x20For\x20Purchase','102kNwFCR','../public/language/languages.json','$product_details.primary_code','product_code_hide','</div>','$alertquantity','suppliers_docs','email','purchase\x20data\x20update\x20successfully','JO_number','$product_details.maxProducts','/barcode_scanner','$room','$paid_amount','/give_payment/:id','18672bCQxEV','</body></html>','$due_amount','prod_pallet','success','prod_cat','aggregate','floor','return_qty','$note','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','standard_unit','Rack\x20E','Email\x20sent\x20successfully','product_details','Level','find','slice','role','host','/view/add_purchases','<tr>','status','$product.bay','<span\x20style=\x22float:\x20right;\x22>','prod_level','room','$product_details.storage','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/barcode/:id','</thead>','$product_details','port','concat','<h2>\x20','product_cat','$product_details.product_name','$warehouse_name','types','prod_isle','rak','<hr\x20class=\x22my-3\x22>','$product_details.isle','forEach','Return\x20Goods','prod_primunit','get','getFullYear','/upload/','2448019VlYanf','Purchase\x20data\x20added\x20successfully','$product_details.pallet','storage','Rack\x20D','</tr>','level','$product.type','stock_quantity','True','currency_placement','Ambient','edit_purchases_view','secondary_code','product_code','/all_purchases/view/','language','isle','redirect','</tbody>','<strong>\x20Regards\x20</strong>','</h5>','$unit','</table>','<h5\x20style=\x22text-align:\x20left;\x22>','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/view/add_purchases/:id','date','$suppliers_docs','$invoice','push','\x20<\x20wew\x20>\x20','production_date','$product','paid_amount','$product.room_name','</td>','return_purchase','$batch_code','\x20<>\x20','length','$product_details.product_stock','Rack\x20C','room_name','random','$product.floorlevel','Logo.png','$finalize','$product_details.product_code','<h5>','body','../models/all_models','json','German','actual_qty','invoice','bin','prod_qty','$product.bin','gmail','here','maxStocks','due_amount','Spanish','alertQTY','message','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','getMonth','English','English\x20(US)','$product_details.type','pallet','INC-','then','Portuguese\x20(BR)','<!DOCTYPE\x20html>','product_name','password','primary_code','Portuguese','name','payment\x20successfull','delivery_code','delivery_date','$expiry_date','Shelves','$name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<div>','../middleware/auth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_secondunit','Purchase\x20Return\x20Mail','all_purchases_barcode','1323128yTNkWt','primary_code_hide','$product.quantity','Rack\x20B','Purchase\x20Mail','bay','210312gLAvKF','max_product_unit','actual_uom','back','add_purchases\x20error','</span>','Rack\x20A','catch','expiry_date','42uDelGS','flash','RoomAssign','render','ejs','293937AYrjkJ','foreach\x20newproduct','/all_purchases/view','table\x20page','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','all_purchases','$primary_code','POnumber','/view/return_purchase/:id','$product_details.level','<thead\x20style=\x22width:\x20100%\x20!important;\x22>'];a0_0x2815=function(){return _0x22b0df;};return a0_0x2815();}router[a0_0x2c8f8a(0x2ad)](a0_0x2c8f8a(0x246),auth,async(_0x369631,_0x1e33e9)=>{var _0x2d3790=a0_0x2c8f8a;try{const {username:_0x2600e3,email:_0x274e82,role:_0x50f524}=_0x369631[_0x2d3790(0x210)],_0xaf149=_0x369631['user'],_0x5f3bb7=await profile[_0x2d3790(0x2c9)]({'email':_0xaf149[_0x2d3790(0x274)]}),_0x15b0d9=await staff['findOne']({'email':_0xaf149[_0x2d3790(0x274)]});if(_0xaf149[_0x2d3790(0x290)]==_0x2d3790(0x245)){const _0x3f53db=await staff['findOne']({'email':_0xaf149['email']});}const _0x1cc0a1=await master_shop[_0x2d3790(0x28e)]();let _0x4e5a66;if(_0xaf149['role']==_0x2d3790(0x245)){const _0x6f01fe=await staff['findOne']({'email':_0xaf149[_0x2d3790(0x274)]});_0x4e5a66=await purchases['aggregate']([{'$match':{'warehouse_name':_0x6f01fe[_0x2d3790(0x222)]}},{'$lookup':{'from':_0x2d3790(0x21f),'localField':'suppliers','foreignField':_0x2d3790(0x301),'as':_0x2d3790(0x273)}},{'$unwind':_0x2d3790(0x2cd)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2d3790(0x2ce)},'suppliers':{'$first':_0x2d3790(0x261)},'date':{'$first':_0x2d3790(0x228)},'warehouse_name':{'$first':_0x2d3790(0x2a4)},'room':{'$first':_0x2d3790(0x279)},'product':{'$push':_0x2d3790(0x2d2)},'note':{'$first':_0x2d3790(0x285)},'paid_amount':{'$first':_0x2d3790(0x27a)},'due_amount':{'$first':_0x2d3790(0x27e)},'return_data':{'$first':_0x2d3790(0x20c)},'batch_code':{'$first':_0x2d3790(0x2d7)},'expiry_date':{'$first':_0x2d3790(0x305)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x2d3790(0x1ed)},'level':{'$addToSet':_0x2d3790(0x295)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2d3790(0x2b7)},'floorlevel':{'$addToSet':_0x2d3790(0x2de)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4e5a66=await purchases[_0x2d3790(0x282)]([{'$lookup':{'from':_0x2d3790(0x21f),'localField':_0x2d3790(0x21f),'foreignField':_0x2d3790(0x301),'as':_0x2d3790(0x273)}},{'$unwind':_0x2d3790(0x2cd)},{'$unwind':_0x2d3790(0x2d2)},{'$group':{'_id':_0x2d3790(0x21c),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x2d3790(0x261)},'date':{'$first':_0x2d3790(0x228)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x2d3790(0x2d4)},'product':{'$push':_0x2d3790(0x2d2)},'note':{'$first':_0x2d3790(0x285)},'paid_amount':{'$first':_0x2d3790(0x27a)},'due_amount':{'$first':_0x2d3790(0x27e)},'return_data':{'$first':_0x2d3790(0x20c)},'batch_code':{'$first':_0x2d3790(0x2d7)},'expiry_date':{'$first':_0x2d3790(0x305)},'suppliers_docs':{'$first':_0x2d3790(0x2cd)},'total_product_quantity':{'$sum':_0x2d3790(0x1ed)},'level':{'$addToSet':_0x2d3790(0x295)},'isle':{'$addToSet':_0x2d3790(0x2eb)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x2d3790(0x2de)},'finalize':{'$first':_0x2d3790(0x2e0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]==_0x2d3790(0x2f6)){var _0x57415b=users['English'];console[_0x2d3790(0x286)](_0x57415b);}else{if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]==_0x2d3790(0x22e))var _0x57415b=users['Hindi'];else{if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]=='German')var _0x57415b=users[_0x2d3790(0x2e6)];else{if(_0x1cc0a1[0x0]['language']=='Spanish')var _0x57415b=users[_0x2d3790(0x2f0)];else{if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]=='French')var _0x57415b=users[_0x2d3790(0x21b)];else{if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]==_0x2d3790(0x2fb))var _0x57415b=users['Portuguese'];else{if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]==_0x2d3790(0x248))var _0x57415b=users[_0x2d3790(0x248)];else{if(_0x1cc0a1[0x0][_0x2d3790(0x2c0)]==_0x2d3790(0x224))var _0x57415b=users['Arabic'];}}}}}}}_0x1e33e9[_0x2d3790(0x1fd)](_0x2d3790(0x205),{'success':_0x369631[_0x2d3790(0x1fb)](_0x2d3790(0x280)),'errors':_0x369631['flash'](_0x2d3790(0x259)),'purchases':_0x4e5a66,'role':_0xaf149,'profile':_0x5f3bb7,'master_shop':_0x1cc0a1,'language':_0x57415b});}catch(_0x124bc0){console[_0x2d3790(0x286)](_0x2d3790(0x202),_0x124bc0),_0x1e33e9[_0x2d3790(0x294)](0xc8)[_0x2d3790(0x2e5)]({'message':_0x124bc0['message']});}});function BayBinSelected(_0xcfa060,_0x4e1b98){var _0x438156=a0_0x2c8f8a,_0x5e693f=[],_0x458749=[],_0x729b05=[],_0x4b9029=[],_0x7ce888=[],_0x490c74=[];let _0x55f3a0=[];if(_0xcfa060=='DRY\x20STORAGE')switch(_0x4e1b98){case'Rack\x20A':_0x5e693f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x458749=[0x1,0x2],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x28d),_0x438156(0x220)],_0x7ce888=['D'],_0x490c74=['A'];break;case _0x438156(0x1ee):_0x5e693f=[0x6,0x5,0x4,0x3,0x2,0x1],_0x458749=[0x1,0x2],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x28d),_0x438156(0x220)],_0x7ce888=['D'],_0x490c74=['B'];break;case _0x438156(0x306):_0x5e693f=[0x0],_0x458749=[0x0],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x220)],_0x7ce888=['D'],_0x490c74=['S'];break;case _0x438156(0x25b):_0x5e693f=[0x0],_0x458749=[0x0],_0x4b9029=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x729b05=[_0x438156(0x220)],_0x7ce888=['D'],_0x490c74=['R'];break;}else{if(_0xcfa060=='COLD\x20STORAGE')switch(_0x4e1b98){case _0x438156(0x1f7):_0x5e693f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x458749=['B','F'],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x28d),'Floor'],_0x7ce888=['C'],_0x490c74=['A'];break;case _0x438156(0x1ee):_0x5e693f=[0x5,0x4,0x3,0x2,0x1],_0x458749=['F','B','S'],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=['Level','Floor'],_0x7ce888=['C'],_0x490c74=['B'];break;case _0x438156(0x2db):_0x5e693f=[0x1,0x2,0x3,0x4,0x5],_0x458749=['B','F','S'],_0x4b9029=[0x5,0x4,0x3,0x2,0x1],_0x729b05=[_0x438156(0x28d),_0x438156(0x220)],_0x7ce888=['C'],_0x490c74=['C'];break;case _0x438156(0x2b4):_0x5e693f=[0x5,0x4,0x3,0x2,0x1],_0x458749=['F','B','S'],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x28d),_0x438156(0x220)],_0x7ce888=['C'],_0x490c74=['D'];break;case _0x438156(0x28a):_0x5e693f=[0x4,0x3,0x2,0x1],_0x458749=[0x1,0x2],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x28d),_0x438156(0x220)],_0x7ce888=['C'],_0x490c74=['E'];break;case'Rack\x20F':_0x5e693f=[0x1,0x2,0x3],_0x458749=[0x1,0x2],_0x4b9029=[0x1,0x2,0x3,0x4,0x5],_0x729b05=[_0x438156(0x28d)],_0x7ce888=['C'],_0x490c74=['F'];break;}}return{'levels':_0x5e693f,'Isle':_0x458749,'rack':_0x4b9029,'type':_0x729b05,'storage':_0x7ce888,'rak':_0x490c74};}async function getRandom8DigitNumber(){var _0xae3618=a0_0x2c8f8a;const _0x2ad29b=0x989680,_0x3d1221=0x5f5e0ff,_0x33bd22=Math[_0xae3618(0x283)](Math[_0xae3618(0x2dd)]()*(_0x3d1221-_0x2ad29b+0x1))+_0x2ad29b;var _0x52f487;const _0xa71c7e=await purchases[_0xae3618(0x2c9)]({'invoice':_0xae3618(0x2f9)+_0x33bd22});return _0xa71c7e&&_0xa71c7e[_0xae3618(0x2d9)]>0x0?_0x52f487=_0xae3618(0x2f9)+_0x33bd22:_0x52f487=_0xae3618(0x2f9)+_0x33bd22,_0x52f487;}router[a0_0x2c8f8a(0x2ad)](a0_0x2c8f8a(0x292),auth,async(_0x1e778c,_0x4e517c)=>{var _0x42e4ea=a0_0x2c8f8a;try{const {username:_0x217521,email:_0x5f0b4d,role:_0x4e7ccb}=_0x1e778c[_0x42e4ea(0x210)],_0x2c88fa=_0x1e778c[_0x42e4ea(0x210)],_0x5afc78=await profile[_0x42e4ea(0x2c9)]({'email':_0x2c88fa['email']}),_0x32f8cb=await master_shop[_0x42e4ea(0x28e)](),_0x20e815=await staff[_0x42e4ea(0x2c9)]({'email':_0x2c88fa[_0x42e4ea(0x274)]}),_0x535701=await suppliers['find']({});let _0x95aa5c;if(_0x2c88fa['role']==_0x42e4ea(0x245)){const _0x31b6d8=await staff[_0x42e4ea(0x2c9)]({'email':_0x2c88fa[_0x42e4ea(0x274)]});_0x95aa5c=await warehouse[_0x42e4ea(0x282)]([{'$match':{'status':'Enabled','name':_0x31b6d8[_0x42e4ea(0x222)],'warehouse_category':_0x42e4ea(0x251),'name':{'$ne':_0x42e4ea(0x2ab)}}},{'$group':{'_id':_0x42e4ea(0x307),'name':{'$first':'$name'}}}]);}else _0x95aa5c=await warehouse[_0x42e4ea(0x282)]([{'$match':{'status':'Enabled','warehouse_category':_0x42e4ea(0x251),'name':{'$ne':_0x42e4ea(0x2ab)}}},{'$group':{'_id':_0x42e4ea(0x307),'name':{'$first':_0x42e4ea(0x307)}}}]);const _0x35b984=await product['find']({}),_0xf73a51=await warehouse['find']({'status':'Enabled'}),_0x1b322d=await purchases['find']({}),_0x499e39=_0x1b322d['length']+0x1,_0x5f4a03=_0x42e4ea(0x2f9)+_0x499e39['toString']()['padStart'](0x5,'0');var _0x2c0f7c=[_0x42e4ea(0x2bb),_0x42e4ea(0x226)];if(_0x32f8cb[0x0]['language']==_0x42e4ea(0x2f6))var _0x3f38ee=users[_0x42e4ea(0x2f5)];else{if(_0x32f8cb[0x0][_0x42e4ea(0x2c0)]==_0x42e4ea(0x22e))var _0x3f38ee=users[_0x42e4ea(0x22e)];else{if(_0x32f8cb[0x0][_0x42e4ea(0x2c0)]==_0x42e4ea(0x2e6))var _0x3f38ee=users[_0x42e4ea(0x2e6)];else{if(_0x32f8cb[0x0][_0x42e4ea(0x2c0)]==_0x42e4ea(0x2f0))var _0x3f38ee=users[_0x42e4ea(0x2f0)];else{if(_0x32f8cb[0x0][_0x42e4ea(0x2c0)]=='French')var _0x3f38ee=users[_0x42e4ea(0x21b)];else{if(_0x32f8cb[0x0][_0x42e4ea(0x2c0)]==_0x42e4ea(0x2fb))var _0x3f38ee=users[_0x42e4ea(0x300)];else{if(_0x32f8cb[0x0]['language']=='Chinese')var _0x3f38ee=users[_0x42e4ea(0x248)];else{if(_0x32f8cb[0x0][_0x42e4ea(0x2c0)]==_0x42e4ea(0x224))var _0x3f38ee=users[_0x42e4ea(0x29a)];}}}}}}}const _0x10b118=getRandom8DigitNumber();_0x10b118[_0x42e4ea(0x2fa)](_0x4f7cb3=>{var _0x220332=_0x42e4ea;_0x4e517c[_0x220332(0x1fd)](_0x220332(0x23b),{'success':_0x1e778c[_0x220332(0x1fb)]('success'),'errors':_0x1e778c[_0x220332(0x1fb)](_0x220332(0x259)),'role':_0x2c88fa,'profile':_0x5afc78,'suppliers':_0x535701,'warehouse':_0x95aa5c,'product':_0x35b984,'invoice':_0x4f7cb3,'master_shop':_0x32f8cb,'language':_0x3f38ee,'find_data':_0xf73a51,'rooms_data':_0x2c0f7c});})[_0x42e4ea(0x1f8)](_0xeac1f5=>{var _0x385a1e=_0x42e4ea;_0x1e778c[_0x385a1e(0x1fb)]('errors',_0x385a1e(0x21a)),_0x4e517c[_0x385a1e(0x2c2)]('/all_purchases/view');});}catch(_0x10497b){console[_0x42e4ea(0x286)](_0x10497b);}}),router[a0_0x2c8f8a(0x2ad)](a0_0x2c8f8a(0x2cb),auth,async(_0x2ced57,_0x34923d)=>{var _0x2efb1a=a0_0x2c8f8a;try{const _0x5be063=_0x2ced57[_0x2efb1a(0x241)]['id'];console[_0x2efb1a(0x286)](_0x5be063);const _0x59a97d=await master_shop['find']();console[_0x2efb1a(0x286)](_0x2efb1a(0x21d),_0x59a97d);const _0x269f89=await product['findOne']({'name':_0x5be063});console[_0x2efb1a(0x286)](_0x2efb1a(0x22a),_0x269f89),_0x34923d[_0x2efb1a(0x294)](0xc8)[_0x2efb1a(0x2e5)]({'product_data':_0x269f89,'master':_0x59a97d});}catch(_0x527995){console[_0x2efb1a(0x286)](_0x2efb1a(0x1f5),_0x527995);}}),router[a0_0x2c8f8a(0x225)](a0_0x2c8f8a(0x292),auth,async(_0x171dd4,_0x9a0a61)=>{var _0x5257b3=a0_0x2c8f8a;try{const {invoice:_0x28e61a,date:_0x5c1bd9,warehouse_name:_0x59325b,prod_name:_0x275485,prod_code:_0x144017,prod_qty:_0x83ba67,prod_unit:_0x36db3c,prod_secondunit:_0x5892a9,prod_level:_0x5ba8aa,prod_isle:_0x58251b,prod_pallet:_0x1c5384,note:_0x58839c,expiry_date:_0xc11b30,batch_code:_0x466472,payable:_0x2b8e3a,due_amount:_0x207363,Room_name:_0x3f513a,primary_code:_0x1bcc54,secondary_code:_0x474e00,MaxStocks_data:_0x53ed56,PO_number:_0x53b527,SCRN:_0x4b7496,JO_number:_0xbb6680}=_0x171dd4[_0x5257b3(0x2e3)];if(typeof _0x275485==_0x5257b3(0x230))var _0x2aea15=[_0x171dd4['body'][_0x5257b3(0x227)]],_0x5b90fc=[_0x171dd4['body'][_0x5257b3(0x23e)]],_0x46bed2=[_0x171dd4['body'][_0x5257b3(0x235)]],_0x482f1e=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2ac)]],_0x4931f4=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x30c)]],_0x4c7e04=[_0x171dd4['body']['prod_level']],_0x35b8f5=[_0x171dd4[_0x5257b3(0x2e3)]['primary_code']],_0x34ccb8=[_0x171dd4[_0x5257b3(0x2e3)]['secondary_code']],_0x43d27c=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x254)]],_0x3f6c5c=[_0x171dd4[_0x5257b3(0x2e3)]['batch_code']],_0x78b2bc=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x1f9)]],_0x4127dc=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x1f2)]],_0x42f2b4=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2f1)]],_0xf43177=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2d1)]],_0x4c3765=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x281)]],_0x393d6c=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x1fc)]],_0x48fb77=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x24a)]],_0x539f62=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x214)]],_0x2c5a85=[_0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2e7)]],_0x272ce9=[_0x171dd4['body']['actual_uom']];else var _0x2aea15=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x227)]],_0x5b90fc=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x23e)]],_0x46bed2=[..._0x171dd4['body'][_0x5257b3(0x235)]],_0x482f1e=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2ac)]],_0x4931f4=[..._0x171dd4['body'][_0x5257b3(0x30c)]],_0x4c7e04=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x297)]],_0x35b8f5=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2ff)]],_0x34ccb8=[..._0x171dd4[_0x5257b3(0x2e3)]['secondary_code']],_0x43d27c=[..._0x171dd4[_0x5257b3(0x2e3)]['MaxStocks_data']],_0x3f6c5c=[..._0x171dd4['body'][_0x5257b3(0x24f)]],_0x78b2bc=[..._0x171dd4[_0x5257b3(0x2e3)]['expiry_date']],_0x4127dc=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x1f2)]],_0x42f2b4=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2f1)]],_0xf43177=[..._0x171dd4['body'][_0x5257b3(0x2d1)]],_0x4c3765=[..._0x171dd4[_0x5257b3(0x2e3)]['prod_cat']],_0x393d6c=[..._0x171dd4['body'][_0x5257b3(0x1fc)]],_0x48fb77=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x24a)]],_0x539f62=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x214)]],_0x2c5a85=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x2e7)]],_0x272ce9=[..._0x171dd4[_0x5257b3(0x2e3)][_0x5257b3(0x1f3)]];const _0x45ac9b=_0x2aea15[_0x5257b3(0x23f)](_0x29d0a3=>{return _0x29d0a3={'product_name':_0x29d0a3};});_0x2c5a85[_0x5257b3(0x2aa)]((_0x44c038,_0x43c3ee)=>{var _0x1d3e3d=_0x5257b3;_0x45ac9b[_0x43c3ee][_0x1d3e3d(0x2e7)]=Math[_0x1d3e3d(0x221)](_0x44c038);}),_0x272ce9['forEach']((_0x4bb2c0,_0x17dac3)=>{var _0x21cebb=_0x5257b3;_0x45ac9b[_0x17dac3][_0x21cebb(0x1f3)]=_0x4bb2c0;}),_0x5b90fc[_0x5257b3(0x2aa)]((_0x42afb5,_0x4d997f)=>{_0x45ac9b[_0x4d997f]['product_code']=_0x42afb5;}),_0x46bed2[_0x5257b3(0x2aa)]((_0x447fe1,_0x51fc3b)=>{var _0x4d15d5=_0x5257b3;_0x45ac9b[_0x51fc3b][_0x4d15d5(0x23a)]=Math[_0x4d15d5(0x221)](_0x447fe1);}),_0x482f1e['forEach']((_0x5e14d1,_0x2c9760)=>{var _0xa26899=_0x5257b3;_0x45ac9b[_0x2c9760][_0xa26899(0x289)]=_0x5e14d1;}),_0x4931f4[_0x5257b3(0x2aa)]((_0x4c57a4,_0x4d4c00)=>{var _0x5b5fa3=_0x5257b3;_0x45ac9b[_0x4d4c00][_0x5b5fa3(0x217)]=_0x4c57a4;}),_0x4c7e04[_0x5257b3(0x2aa)]((_0x4c9ea9,_0x31e881)=>{var _0x262a00=_0x5257b3;_0x393d6c[_0x262a00(0x2aa)]((_0x17daaf,_0x19f607)=>{var _0x19d312=_0x262a00;if(_0x17daaf==_0x19d312(0x25b)&&_0x31e881==_0x19f607){console[_0x19d312(0x286)](_0x17daaf+_0x19d312(0x2d0)+_0x31e881+_0x19d312(0x2d8)+_0x19f607+_0x19d312(0x2d8)+_0x4c9ea9);var _0x2b3204=_0x4c9ea9[_0x19d312(0x28f)](0x3);_0x45ac9b[_0x31e881][_0x19d312(0x2b3)]=_0x4c9ea9[0x0],_0x45ac9b[_0x31e881][_0x19d312(0x26b)]=_0x4c9ea9[0x1],_0x45ac9b[_0x31e881][_0x19d312(0x1f0)]=0x0,_0x45ac9b[_0x31e881][_0x19d312(0x2e9)]=0x0,_0x45ac9b[_0x31e881]['type']=_0x19d312(0x220),_0x45ac9b[_0x31e881][_0x19d312(0x252)]=_0x2b3204;}else{if(_0x17daaf==_0x19d312(0x306)&&_0x31e881==_0x19f607){var _0x2b3204=_0x4c9ea9['slice'](0x3);_0x45ac9b[_0x31e881]['storage']=_0x4c9ea9[0x0],_0x45ac9b[_0x31e881][_0x19d312(0x26b)]=_0x4c9ea9[0x1],_0x45ac9b[_0x31e881][_0x19d312(0x1f0)]=0x0,_0x45ac9b[_0x31e881][_0x19d312(0x2e9)]=0x0,_0x45ac9b[_0x31e881][_0x19d312(0x26a)]=_0x19d312(0x220),_0x45ac9b[_0x31e881][_0x19d312(0x252)]=_0x4c9ea9[0x5];}else{if(_0x31e881==_0x19f607){if(_0x4c9ea9[0x0]=='A'&&_0x4c9ea9[0x1]=='L'&&_0x4c9ea9[0x2]=='L')console[_0x19d312(0x286)](_0x17daaf+_0x19d312(0x2d8)+_0x31e881+_0x19d312(0x2d8)+_0x19f607+'\x20<>\x20'+_0x4c9ea9+_0x19d312(0x2ed)),_0x45ac9b[_0x31e881]['storage']=_0x4c9ea9[0x0],_0x45ac9b[_0x31e881][_0x19d312(0x26b)]=_0x4c9ea9[0x1],_0x45ac9b[_0x31e881][_0x19d312(0x1f0)]=0x0,_0x45ac9b[_0x31e881][_0x19d312(0x2e9)]=0x0,_0x45ac9b[_0x31e881]['type']=_0x19d312(0x220),_0x45ac9b[_0x31e881]['floorlevel']=_0x4c9ea9[0x3];else{var _0x342324;if(_0x4c9ea9[0x4]=='L')_0x342324='Level';else _0x4c9ea9[0x4]=='F'&&(_0x342324=_0x19d312(0x220));_0x45ac9b[_0x31e881][_0x19d312(0x2b3)]=_0x4c9ea9[0x0],_0x45ac9b[_0x31e881][_0x19d312(0x26b)]=_0x4c9ea9[0x1],_0x45ac9b[_0x31e881][_0x19d312(0x1f0)]=_0x4c9ea9[0x2],_0x45ac9b[_0x31e881]['bin']=_0x4c9ea9[0x3],_0x45ac9b[_0x31e881]['type']=_0x342324,_0x45ac9b[_0x31e881][_0x19d312(0x252)]=_0x4c9ea9[0x5];}}}}});}),_0x35b8f5[_0x5257b3(0x2aa)]((_0x497add,_0x58d1d)=>{var _0x13d630=_0x5257b3;_0x45ac9b[_0x58d1d][_0x13d630(0x2ff)]=_0x497add;}),_0x34ccb8[_0x5257b3(0x2aa)]((_0x4ab7a0,_0x4d8f1a)=>{_0x45ac9b[_0x4d8f1a]['secondary_code']=_0x4ab7a0;}),_0x43d27c[_0x5257b3(0x2aa)]((_0x48767f,_0x91dd83)=>{var _0x1a2819=_0x5257b3;_0x45ac9b[_0x91dd83][_0x1a2819(0x2ee)]=_0x48767f;}),_0x3f6c5c[_0x5257b3(0x2aa)]((_0xf01bd8,_0x43fa6a)=>{var _0x4e14aa=_0x5257b3;_0x45ac9b[_0x43fa6a][_0x4e14aa(0x24f)]=_0xf01bd8;}),_0x78b2bc[_0x5257b3(0x2aa)]((_0x4923e5,_0x273217)=>{var _0x30abb0=_0x5257b3;_0x45ac9b[_0x273217][_0x30abb0(0x1f9)]=_0x4923e5;}),_0x4127dc[_0x5257b3(0x2aa)]((_0x5b069c,_0x5cf2c7)=>{_0x45ac9b[_0x5cf2c7]['maxperunit']=_0x5b069c;}),_0x42f2b4[_0x5257b3(0x2aa)]((_0xf1805f,_0x28ae5d)=>{var _0x40137d=_0x5257b3;_0x45ac9b[_0x28ae5d][_0x40137d(0x2f1)]=_0xf1805f;}),_0xf43177[_0x5257b3(0x2aa)]((_0x286f0f,_0xba0d0c)=>{var _0xaecbf=_0x5257b3;_0x45ac9b[_0xba0d0c][_0xaecbf(0x2d1)]=_0x286f0f;}),_0x4c3765[_0x5257b3(0x2aa)]((_0x5f3151,_0x171738)=>{var _0xeeeba3=_0x5257b3;_0x45ac9b[_0x171738][_0xeeeba3(0x2a2)]=_0x5f3151;}),_0x393d6c[_0x5257b3(0x2aa)]((_0x49f48b,_0x624195)=>{var _0x495b24=_0x5257b3;_0x45ac9b[_0x624195][_0x495b24(0x2dc)]=_0x49f48b;}),_0x48fb77[_0x5257b3(0x2aa)]((_0x5140c2,_0x2269d0)=>{var _0xb5b6a7=_0x5257b3;_0x45ac9b[_0x2269d0][_0xb5b6a7(0x303)]=_0x5140c2;}),_0x539f62[_0x5257b3(0x2aa)]((_0x42bec7,_0x2ae955)=>{var _0xcd63ca=_0x5257b3;_0x45ac9b[_0x2ae955][_0xcd63ca(0x2e8)]=_0x42bec7;});const _0x596421=_0x393d6c['map'](_0x44d6d9=>{return _0x44d6d9={'room_name':_0x44d6d9};}),_0x527d12=_0x45ac9b[_0x5257b3(0x257)](_0x2451f7=>_0x2451f7['quantity']!=='0'&&_0x2451f7[_0x5257b3(0x23a)]!==''),_0x15a23d=new purchases({'invoice':_0x28e61a,'suppliers':_0x171dd4['body'][_0x5257b3(0x21f)],'date':_0x5c1bd9,'warehouse_name':_0x59325b,'product':_0x527d12,'note':_0x58839c,'due_amount':_0x207363,'POnumber':_0x53b527,'SCRN':_0x4b7496,'JO_number':_0xbb6680,'roomList':_0x596421}),_0x1d935a=await _0x15a23d[_0x5257b3(0x213)](),_0x5be505=await purchases[_0x5257b3(0x2c9)]({'invoice':_0x28e61a}),_0xdf72ea=_0x5be505[_0x5257b3(0x22a)][_0x5257b3(0x23f)](async _0x46e35b=>{var _0x55159e=_0x5257b3,_0x5eb586=await warehouse[_0x55159e(0x2c9)]({'name':_0x59325b,'room':_0x46e35b[_0x55159e(0x2dc)]}),_0x59f6c7=0x0;return _0x5eb586[_0x55159e(0x28c)]['forEach'](_0x4a7e91=>{var _0x219797=_0x55159e;_0x4a7e91['product_name']==_0x46e35b['product_name']&&_0x4a7e91['floorlevel']==_0x46e35b[_0x219797(0x252)]&&_0x4a7e91['type']==_0x46e35b['type']&&_0x4a7e91['bin']==_0x46e35b['bin']&&_0x4a7e91[_0x219797(0x1f0)]==_0x46e35b[_0x219797(0x1f0)]&&_0x4a7e91[_0x219797(0x26b)]==_0x46e35b[_0x219797(0x26b)]&&_0x4a7e91['storage']==_0x46e35b['storage']&&_0x4a7e91[_0x219797(0x1f9)]==_0x46e35b['expiry_date']&&_0x4a7e91[_0x219797(0x24f)]==_0x46e35b[_0x219797(0x24f)]&&_0x4a7e91[_0x219797(0x2d1)]==_0x46e35b[_0x219797(0x2d1)]&&_0x4a7e91[_0x219797(0x2e8)]==_0x5be505[_0x219797(0x2e8)]&&(_0x4a7e91[_0x219797(0x22c)]+=Math['abs'](_0x46e35b[_0x219797(0x23a)]),_0x59f6c7++);}),_0x59f6c7===0x0&&_0x5eb586[_0x55159e(0x28c)][_0x55159e(0x2cf)]({'product_name':_0x46e35b[_0x55159e(0x2fd)],'product_stock':Math[_0x55159e(0x221)](_0x46e35b[_0x55159e(0x23a)]),'primary_code':_0x46e35b['primary_code'],'secondary_code':_0x46e35b['secondary_code'],'product_code':_0x46e35b['product_code'],'storage':_0x46e35b[_0x55159e(0x2b3)],'rack':_0x46e35b[_0x55159e(0x26b)],'bay':_0x46e35b[_0x55159e(0x1f0)],'bin':_0x46e35b[_0x55159e(0x2e9)],'type':_0x46e35b[_0x55159e(0x26a)],'floorlevel':_0x46e35b[_0x55159e(0x252)],'maxProducts':_0x46e35b[_0x55159e(0x2ee)],'unit':_0x46e35b[_0x55159e(0x289)],'secondary_unit':_0x46e35b[_0x55159e(0x217)],'expiry_date':_0x46e35b['expiry_date'],'maxPerUnit':_0x46e35b[_0x55159e(0x263)],'batch_code':_0x46e35b[_0x55159e(0x24f)],'alertQTY':_0x46e35b[_0x55159e(0x2f1)],'production_date':_0x46e35b[_0x55159e(0x2d1)],'product_cat':_0x46e35b[_0x55159e(0x2a2)],'invoice':_0x46e35b[_0x55159e(0x2e8)],'actual_qty':Math[_0x55159e(0x221)](_0x46e35b[_0x55159e(0x2e7)]),'actual_uom':_0x46e35b[_0x55159e(0x1f3)]}),_0x5eb586;});Promise[_0x5257b3(0x25e)](_0xdf72ea)['then'](async _0x5b290b=>{var _0x1fc6fc=_0x5257b3;try{for(const _0x3ccccb of _0x5b290b){await _0x3ccccb[_0x1fc6fc(0x213)]();}const _0x5c4a52=await master_shop[_0x1fc6fc(0x28e)](),_0x3d7aff=await email_settings[_0x1fc6fc(0x2c9)](),_0x2ef6b3=await supervisor_settings[_0x1fc6fc(0x28e)]();var _0x1f3c7b=_0x5be505['product'],_0xde818c='',_0x5b7eae;for(_0x5b7eae in _0x1f3c7b){_0xde818c+=_0x1fc6fc(0x293)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f3c7b[_0x5b7eae]['product_name']+_0x1fc6fc(0x2d5)+_0x1fc6fc(0x308)+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x2be)]+_0x1fc6fc(0x2d5)+_0x1fc6fc(0x308)+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x23a)]+_0x1fc6fc(0x2d5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x289)]+_0x1fc6fc(0x2d5)+_0x1fc6fc(0x308)+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x217)]+'</td>'+_0x1fc6fc(0x308)+_0x5be505[_0x1fc6fc(0x239)]+_0x1fc6fc(0x2d5)+_0x1fc6fc(0x308)+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x2dc)]+_0x1fc6fc(0x2d5)+_0x1fc6fc(0x308)+_0x1f3c7b[_0x5b7eae]['storage']+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x26b)]+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x1f0)]+_0x1f3c7b[_0x5b7eae]['bin']+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x26a)][0x0]+_0x1f3c7b[_0x5b7eae][_0x1fc6fc(0x252)]+_0x1fc6fc(0x2d5),_0x1fc6fc(0x2b5);}let _0x31322d=nodemailer[_0x1fc6fc(0x216)]({'host':_0x3d7aff[_0x1fc6fc(0x291)],'port':Number(_0x3d7aff[_0x1fc6fc(0x29f)]),'secure':![],'auth':{'user':_0x3d7aff[_0x1fc6fc(0x274)],'pass':_0x3d7aff[_0x1fc6fc(0x2fe)]}}),_0x3b5f99={'from':_0x3d7aff['email'],'to':_0x2ef6b3[0x0][_0x1fc6fc(0x24e)],'subject':_0x1fc6fc(0x1ef),'attachments':[{'filename':_0x1fc6fc(0x2df),'path':__dirname+_0x1fc6fc(0x215)+'/upload/'+_0x5c4a52[0x0][_0x1fc6fc(0x269)],'cid':'logo'}],'html':_0x1fc6fc(0x2fc)+_0x1fc6fc(0x258)+_0x1fc6fc(0x267)+_0x1fc6fc(0x309)+_0x1fc6fc(0x234)+'<div>'+_0x1fc6fc(0x2f3)+_0x1fc6fc(0x271)+'<div>'+'<h2>\x20'+_0x5c4a52[0x0][_0x1fc6fc(0x24c)]+_0x1fc6fc(0x22d)+_0x1fc6fc(0x271)+_0x1fc6fc(0x271)+_0x1fc6fc(0x2a8)+_0x1fc6fc(0x309)+_0x1fc6fc(0x2c8)+'\x20Order\x20Number\x20:\x20'+_0x5be505['invoice']+'\x20'+_0x1fc6fc(0x296)+_0x1fc6fc(0x25a)+_0x5be505[_0x1fc6fc(0x2cc)]+'\x20'+_0x1fc6fc(0x1f6)+_0x1fc6fc(0x2c5)+'</div>'+_0x1fc6fc(0x232)+_0x1fc6fc(0x20a)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1fc6fc(0x253)+_0x1fc6fc(0x287)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1fc6fc(0x29b)+_0x1fc6fc(0x288)+_0x1fc6fc(0x204)+_0x1fc6fc(0x2b5)+_0x1fc6fc(0x29d)+_0x1fc6fc(0x244)+'\x20'+_0xde818c+'\x20'+'</tbody>'+_0x1fc6fc(0x2c7)+_0x1fc6fc(0x309)+_0x1fc6fc(0x2c4)+_0x1fc6fc(0x2e2)+_0x5c4a52[0x0][_0x1fc6fc(0x24c)]+_0x1fc6fc(0x2c5)+'</div>'+_0x1fc6fc(0x271)+'</body></html>'};_0x31322d[_0x1fc6fc(0x238)](_0x3b5f99,function(_0x103b2f,_0x23bb5e){var _0x4f8ead=_0x1fc6fc;_0x103b2f?(console[_0x4f8ead(0x286)](_0x103b2f),console['log']('Error\x20Occurs')):console[_0x4f8ead(0x286)](_0x4f8ead(0x28b));}),_0x171dd4[_0x1fc6fc(0x1fb)](_0x1fc6fc(0x280),_0x1fc6fc(0x2b1)),_0x9a0a61[_0x1fc6fc(0x2c2)](_0x1fc6fc(0x2bf));}catch(_0x223cd8){console[_0x1fc6fc(0x229)](_0x223cd8),_0x9a0a61[_0x1fc6fc(0x294)](0x1f4)['json']({'error':_0x1fc6fc(0x20d)});}})[_0x5257b3(0x1f8)](_0x1c4def=>{var _0x1aff41=_0x5257b3;console[_0x1aff41(0x229)](_0x1c4def),_0x9a0a61[_0x1aff41(0x294)](0x1f4)[_0x1aff41(0x2e5)]({'error':'An\x20error\x20occurred.'});});}catch(_0x36bc4e){console[_0x5257b3(0x286)](_0x36bc4e);}}),router[a0_0x2c8f8a(0x2ad)]('/preview/:id',auth,async(_0x4b4cac,_0x51bb2e)=>{var _0x599165=a0_0x2c8f8a;try{const {username:_0x179bc7,email:_0x2ba874,role:_0x463ecd}=_0x4b4cac[_0x599165(0x210)],_0x132afe=_0x4b4cac[_0x599165(0x210)],_0x5b0a2b=await profile[_0x599165(0x2c9)]({'email':_0x132afe['email']}),_0x4d983c=await master_shop[_0x599165(0x28e)](),_0x17bed0=_0x4b4cac['params']['id'],_0x250ec1=await purchases[_0x599165(0x255)](_0x17bed0),_0x15b129=await warehouse[_0x599165(0x282)]([{'$match':{'name':_0x250ec1[_0x599165(0x239)],'room':_0x250ec1[_0x599165(0x298)]}},{'$unwind':_0x599165(0x29e)},{'$group':{'_id':_0x599165(0x22f),'name':{'$first':_0x599165(0x2a3)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x599165(0x264)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x599165(0x2f7)},'floorlevel':{'$first':_0x599165(0x212)},'primary_code':{'$first':_0x599165(0x26f)},'secondary_code':{'$first':_0x599165(0x25f)},'product_code':{'$first':_0x599165(0x2e1)},'storage':{'$first':_0x599165(0x299)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x599165(0x236)}}}]),_0x5447f8=await customer[_0x599165(0x28e)]({});let _0x5dbdc6;if(_0x132afe[_0x599165(0x290)]=='staff'){const _0x312bfd=await staff[_0x599165(0x2c9)]({'email':_0x132afe[_0x599165(0x274)]});_0x5dbdc6=await warehouse[_0x599165(0x282)]([{'$match':{'status':_0x599165(0x23c),'name':_0x312bfd[_0x599165(0x222)]}},{'$group':{'_id':_0x599165(0x307),'name':{'$first':_0x599165(0x307)}}}]);}else _0x5dbdc6=await warehouse[_0x599165(0x282)]([{'$match':{'status':_0x599165(0x23c)}},{'$group':{'_id':'$name','name':{'$first':_0x599165(0x307)}}}]);const _0x4b49ab=await product['find']({}),_0x3a5987=await suppliers['find']({}),_0x51866f=BayBinSelected(_0x250ec1['warehouse_name'],_0x250ec1['room']);if(_0x4d983c[0x0][_0x599165(0x2c0)]==_0x599165(0x2f6)){var _0x35f6eb=users[_0x599165(0x2f5)];console[_0x599165(0x286)](_0x35f6eb);}else{if(_0x4d983c[0x0][_0x599165(0x2c0)]==_0x599165(0x22e))var _0x35f6eb=users[_0x599165(0x22e)];else{if(_0x4d983c[0x0][_0x599165(0x2c0)]==_0x599165(0x2e6))var _0x35f6eb=users[_0x599165(0x2e6)];else{if(_0x4d983c[0x0]['language']==_0x599165(0x2f0))var _0x35f6eb=users[_0x599165(0x2f0)];else{if(_0x4d983c[0x0][_0x599165(0x2c0)]==_0x599165(0x21b))var _0x35f6eb=users[_0x599165(0x21b)];else{if(_0x4d983c[0x0][_0x599165(0x2c0)]=='Portuguese\x20(BR)')var _0x35f6eb=users[_0x599165(0x300)];else{if(_0x4d983c[0x0]['language']==_0x599165(0x248))var _0x35f6eb=users[_0x599165(0x248)];else{if(_0x4d983c[0x0][_0x599165(0x2c0)]=='Arabic\x20(ae)')var _0x35f6eb=users['Arabic'];}}}}}}}_0x51bb2e[_0x599165(0x1fd)](_0x599165(0x2bc),{'success':_0x4b4cac[_0x599165(0x1fb)]('success'),'errors':_0x4b4cac[_0x599165(0x1fb)]('errors'),'role':_0x132afe,'profile':_0x5b0a2b,'customer':_0x5447f8,'warehouse':_0x5dbdc6,'product':_0x15b129,'user':_0x250ec1,'master_shop':_0x4d983c,'unit':_0x4b49ab,'language':_0x35f6eb,'suppliers':_0x3a5987,'dataSelected':_0x51866f});}catch(_0x35dfe4){console['log'](_0x35dfe4);}}),router[a0_0x2c8f8a(0x225)]('/preview/:id',auth,async(_0x366144,_0x3a2a9b)=>{var _0x33c8fd=a0_0x2c8f8a;try{const _0x4dbdd4=_0x366144['params']['id'],{invoice:_0xfc32c0,warehouse_name:_0x190c87,Room_name:_0x704009}=_0x366144[_0x33c8fd(0x2e3)],_0x155aef=await warehouse['findOne']({'name':_0x190c87,'room':_0x704009}),_0x2208f4=await purchases['findOne']({'invoice':_0xfc32c0});_0x2208f4[_0x33c8fd(0x22a)][_0x33c8fd(0x2aa)](_0xcbbbdf=>{var _0x24f313=_0x33c8fd,_0x57b1f2=0x0;const _0x5d663e=_0x155aef[_0x24f313(0x28c)][_0x24f313(0x23f)](_0x52b79e=>{var _0x453e93=_0x24f313;_0x52b79e[_0x453e93(0x2fd)]==_0xcbbbdf[_0x453e93(0x2fd)]&&_0x52b79e[_0x453e93(0x252)]==_0xcbbbdf['floorlevel']&&_0x52b79e[_0x453e93(0x26a)]==_0xcbbbdf[_0x453e93(0x26a)]&&_0x52b79e[_0x453e93(0x2e9)]==_0xcbbbdf[_0x453e93(0x2e9)]&&_0x52b79e[_0x453e93(0x1f0)]==_0xcbbbdf[_0x453e93(0x1f0)]&&_0x52b79e[_0x453e93(0x26b)]==_0xcbbbdf[_0x453e93(0x26b)]&&_0x52b79e[_0x453e93(0x2b3)]==_0xcbbbdf[_0x453e93(0x2b3)]&&_0x52b79e[_0x453e93(0x1f9)]==_0xcbbbdf[_0x453e93(0x1f9)]&&_0x52b79e[_0x453e93(0x24f)]==_0xcbbbdf['batch_code']&&_0x52b79e['production_date']==_0xcbbbdf[_0x453e93(0x2d1)]&&_0x52b79e[_0x453e93(0x304)]==_0xcbbbdf[_0x453e93(0x304)]&&_0x52b79e[_0x453e93(0x303)]==_0xcbbbdf[_0x453e93(0x303)]&&(_0x52b79e[_0x453e93(0x22c)]=parseInt(_0x52b79e['product_stock'])+parseInt(_0xcbbbdf['quantity']),_0x57b1f2++);});_0x57b1f2=='0'&&(_0x155aef[_0x24f313(0x28c)]=_0x155aef[_0x24f313(0x28c)]['concat']({'product_name':_0xcbbbdf[_0x24f313(0x2fd)],'product_stock':_0xcbbbdf[_0x24f313(0x23a)],'primary_code':_0xcbbbdf[_0x24f313(0x2ff)],'secondary_code':_0xcbbbdf[_0x24f313(0x2bd)],'product_code':_0xcbbbdf['product_code'],'storage':_0xcbbbdf['storage'],'rack':_0xcbbbdf[_0x24f313(0x26b)],'bay':_0xcbbbdf['bay'],'bin':_0xcbbbdf[_0x24f313(0x2e9)],'type':_0xcbbbdf['type'],'floorlevel':_0xcbbbdf[_0x24f313(0x252)],'maxProducts':_0xcbbbdf[_0x24f313(0x2ee)],'unit':_0xcbbbdf[_0x24f313(0x289)],'secondary_unit':_0xcbbbdf[_0x24f313(0x217)],'expiry_date':_0xcbbbdf['expiry_date'],'maxPerUnit':_0xcbbbdf['maxperunit'],'batch_code':_0xcbbbdf[_0x24f313(0x24f)],'alertQTY':_0xcbbbdf[_0x24f313(0x2f1)],'production_date':_0xcbbbdf[_0x24f313(0x2d1)],'delivery_date':_0xcbbbdf[_0x24f313(0x304)],'delivery_code':_0xcbbbdf[_0x24f313(0x303)]}));}),await _0x155aef['save'](),_0x2208f4['finalize']='True';const _0x254690=await _0x2208f4[_0x33c8fd(0x213)]();_0x366144[_0x33c8fd(0x1fb)](_0x33c8fd(0x280),_0x33c8fd(0x219)),_0x3a2a9b[_0x33c8fd(0x2c2)](_0x33c8fd(0x201));}catch(_0x355873){console[_0x33c8fd(0x286)](_0x355873);}}),router[a0_0x2c8f8a(0x2ad)]('/view/:id',auth,async(_0x3d0dfe,_0x50afd2)=>{var _0x5c02ce=a0_0x2c8f8a;try{const {username:_0x188c4a,email:_0x254448,role:_0xb03c95}=_0x3d0dfe[_0x5c02ce(0x210)],_0x5c5c2e=_0x3d0dfe['user'],_0x1ef7fb=await profile[_0x5c02ce(0x2c9)]({'email':_0x5c5c2e[_0x5c02ce(0x274)]}),_0x3c3f53=await master_shop[_0x5c02ce(0x28e)](),_0x5c8b84=_0x3d0dfe['params']['id'],_0x3bba8b=await purchases[_0x5c02ce(0x255)](_0x5c8b84),_0x245e6e=await suppliers[_0x5c02ce(0x28e)]({});let _0x264a91;if(_0x5c5c2e[_0x5c02ce(0x290)]==_0x5c02ce(0x245)){const _0x1a8112=await staff['findOne']({'email':_0x5c5c2e[_0x5c02ce(0x274)]});_0x264a91=await warehouse['find']({'status':_0x5c02ce(0x23c),'name':_0x1a8112[_0x5c02ce(0x222)],'warehouse_category':'Raw\x20Materials'});}else _0x264a91=await warehouse['aggregate']([{'$match':{'status':_0x5c02ce(0x23c),'warehouse_category':_0x5c02ce(0x251)}},{'$group':{'_id':_0x5c02ce(0x307),'name':{'$first':'$name'}}}]);const _0x196d51=await product[_0x5c02ce(0x28e)]({}),_0x367b88=BayBinSelected(_0x3bba8b['warehouse_name'],_0x3bba8b[_0x5c02ce(0x298)]);let _0x141f1a=new Date(_0x3bba8b[_0x5c02ce(0x1f9)]),_0x130406=('0'+_0x141f1a[_0x5c02ce(0x20e)]())[_0x5c02ce(0x28f)](-0x2),_0x551bf1=('0'+(_0x141f1a[_0x5c02ce(0x2f4)]()+0x1))['slice'](-0x2),_0xce5ef4=_0x141f1a[_0x5c02ce(0x2ae)](),_0x98dd44=_0xce5ef4+'-'+_0x551bf1+'-'+_0x130406;if(_0x3c3f53[0x0][_0x5c02ce(0x2c0)]==_0x5c02ce(0x2f6)){var _0x5af5cf=users['English'];console[_0x5c02ce(0x286)](_0x5af5cf);}else{if(_0x3c3f53[0x0][_0x5c02ce(0x2c0)]==_0x5c02ce(0x22e))var _0x5af5cf=users[_0x5c02ce(0x22e)];else{if(_0x3c3f53[0x0][_0x5c02ce(0x2c0)]==_0x5c02ce(0x2e6))var _0x5af5cf=users[_0x5c02ce(0x2e6)];else{if(_0x3c3f53[0x0]['language']==_0x5c02ce(0x2f0))var _0x5af5cf=users[_0x5c02ce(0x2f0)];else{if(_0x3c3f53[0x0][_0x5c02ce(0x2c0)]==_0x5c02ce(0x21b))var _0x5af5cf=users[_0x5c02ce(0x21b)];else{if(_0x3c3f53[0x0][_0x5c02ce(0x2c0)]=='Portuguese\x20(BR)')var _0x5af5cf=users['Portuguese'];else{if(_0x3c3f53[0x0][_0x5c02ce(0x2c0)]=='Chinese')var _0x5af5cf=users[_0x5c02ce(0x248)];else{if(_0x3c3f53[0x0]['language']==_0x5c02ce(0x224))var _0x5af5cf=users[_0x5c02ce(0x29a)];}}}}}}}_0x50afd2['render'](_0x5c02ce(0x262),{'success':_0x3d0dfe[_0x5c02ce(0x1fb)](_0x5c02ce(0x280)),'errors':_0x3d0dfe[_0x5c02ce(0x1fb)](_0x5c02ce(0x259)),'role':_0x5c5c2e,'profile':_0x1ef7fb,'purchases':_0x3bba8b,'suppliers':_0x245e6e,'warehouse':_0x264a91,'product':_0x196d51,'master_shop':_0x3c3f53,'language':_0x5af5cf,'ed_fullDate':_0x98dd44,'dataSelected':_0x367b88});}catch(_0x1900c1){console[_0x5c02ce(0x286)](_0x1900c1);}}),router[a0_0x2c8f8a(0x225)]('/view/:id',auth,async(_0x204db2,_0x18ea58)=>{var _0x5a1b5f=a0_0x2c8f8a;try{const _0x127c79=_0x204db2[_0x5a1b5f(0x241)]['id'],_0x22fbb0=await purchases[_0x5a1b5f(0x2c9)]({'_id':_0x204db2['params']['id']}),_0x1318f5=await warehouse['findOne']({'name':_0x22fbb0[_0x5a1b5f(0x239)],'room':_0x22fbb0[_0x5a1b5f(0x298)]});_0x22fbb0[_0x5a1b5f(0x22a)][_0x5a1b5f(0x2aa)](_0x3dfc1b=>{const _0x430c2e=_0x1318f5['product_details']['map'](_0x56215e=>{var _0x2ac08b=a0_0x4830;_0x56215e[_0x2ac08b(0x2fd)]==_0x3dfc1b['product_name']&&_0x56215e[_0x2ac08b(0x252)]==_0x3dfc1b[_0x2ac08b(0x252)]&&_0x56215e[_0x2ac08b(0x26a)]==_0x3dfc1b[_0x2ac08b(0x26a)]&&_0x56215e[_0x2ac08b(0x2e9)]==_0x3dfc1b[_0x2ac08b(0x2e9)]&&_0x56215e['bay']==_0x3dfc1b[_0x2ac08b(0x1f0)]&&_0x56215e[_0x2ac08b(0x26b)]==_0x3dfc1b[_0x2ac08b(0x26b)]&&_0x56215e[_0x2ac08b(0x2b3)]==_0x3dfc1b[_0x2ac08b(0x2b3)]&&(_0x56215e[_0x2ac08b(0x22c)]=parseInt(_0x56215e[_0x2ac08b(0x22c)])-parseInt(_0x3dfc1b[_0x2ac08b(0x23a)]));});}),await _0x1318f5['save']();const {invoice:_0x5a3da9,suppliers:_0x443836,date:_0x456404,warehouse_name:_0x238e63,prod_name:_0x154419,prod_code:_0x3d40bd,prod_qty:_0x3501de,prod_unit:_0x4456a6,prod_secondunit:_0x47e935,prod_level:_0xd33ee4,prod_isle:_0x1939b9,prod_pallet:_0x899cb8,note:_0x388570,expiry_date:_0x4b2602,batch_code:_0x137f52,paid_amount:_0xd32019,due_amount:_0x242375,Room_name:_0x310093,primary_code:_0x51d571,secondary_code:_0x531e2f,PO_number:_0x15512a,JO_number:_0x23fb31}=_0x204db2[_0x5a1b5f(0x2e3)];if(typeof _0x154419=='string')var _0x4e7378=[_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x227)]],_0x4cb1dd=[_0x204db2[_0x5a1b5f(0x2e3)]['prod_code']],_0x4ece07=[_0x204db2['body'][_0x5a1b5f(0x2ea)]],_0x49b463=[_0x204db2[_0x5a1b5f(0x2e3)]['prod_unit']],_0x3cc389=[_0x204db2['body']['prod_secondunit']],_0x39d6bc=[_0x204db2['body'][_0x5a1b5f(0x297)]],_0x25d938=[_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x2a6)]],_0x3c8c55=[_0x204db2['body']['prod_pallet']],_0x1544ce=[_0x204db2[_0x5a1b5f(0x2e3)]['primary_code']],_0x652777=[_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x2bd)]],_0x4440c3=[_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x254)]],_0x346e0c=[_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x24f)]],_0x404c96=[_0x204db2[_0x5a1b5f(0x2e3)]['expiry_date']],_0x4dd5e9=[_0x204db2[_0x5a1b5f(0x2e3)]['storage']],_0x293c02=[_0x204db2['body'][_0x5a1b5f(0x2a7)]],_0x4f6f1f=[_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x26a)]];else var _0x4e7378=[..._0x204db2['body']['prod_name']],_0x4cb1dd=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x23e)]],_0x4ece07=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x2ea)]],_0x49b463=[..._0x204db2['body']['prod_unit']],_0x3cc389=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x30c)]],_0x39d6bc=[..._0x204db2['body'][_0x5a1b5f(0x297)]],_0x25d938=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x2a6)]],_0x3c8c55=[..._0x204db2['body'][_0x5a1b5f(0x27f)]],_0x1544ce=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x2ff)]],_0x652777=[..._0x204db2['body'][_0x5a1b5f(0x2bd)]],_0x4440c3=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x254)]],_0x346e0c=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x24f)]],_0x404c96=[..._0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x1f9)]],_0x4dd5e9=[..._0x204db2['body']['storage']],_0x293c02=[..._0x204db2['body']['rak']],_0x4f6f1f=[..._0x204db2['body']['type']];const _0x1b2ed2=_0x4e7378['map'](_0x5783d2=>{return _0x5783d2={'product_name':_0x5783d2};});_0x4cb1dd['forEach']((_0x16c978,_0x181916)=>{var _0x3af012=_0x5a1b5f;_0x1b2ed2[_0x181916][_0x3af012(0x2be)]=_0x16c978;}),_0x4ece07[_0x5a1b5f(0x2aa)]((_0x4ea158,_0x2f68a8)=>{var _0xf50789=_0x5a1b5f;_0x1b2ed2[_0x2f68a8][_0xf50789(0x23a)]=_0x4ea158;}),_0x49b463[_0x5a1b5f(0x2aa)]((_0x226ccc,_0x133fca)=>{var _0x1cbf85=_0x5a1b5f;_0x1b2ed2[_0x133fca][_0x1cbf85(0x289)]=_0x226ccc;}),_0x3cc389[_0x5a1b5f(0x2aa)]((_0xee5d62,_0x26590f)=>{var _0x4dc1b9=_0x5a1b5f;_0x1b2ed2[_0x26590f][_0x4dc1b9(0x217)]=_0xee5d62;}),_0x39d6bc[_0x5a1b5f(0x2aa)]((_0x2eb551,_0x4378de)=>{var _0x5d1b6c=_0x5a1b5f;_0x1b2ed2[_0x4378de][_0x5d1b6c(0x1f0)]=_0x2eb551;}),_0x25d938[_0x5a1b5f(0x2aa)]((_0x76fcda,_0x43e7df)=>{var _0x507cce=_0x5a1b5f;_0x1b2ed2[_0x43e7df][_0x507cce(0x2e9)]=_0x76fcda;}),_0x3c8c55['forEach']((_0x365078,_0x5ec0be)=>{_0x1b2ed2[_0x5ec0be]['floorlevel']=_0x365078;}),_0x1544ce[_0x5a1b5f(0x2aa)]((_0x100392,_0x25d676)=>{var _0x13acfd=_0x5a1b5f;_0x1b2ed2[_0x25d676][_0x13acfd(0x2ff)]=_0x100392;}),_0x652777[_0x5a1b5f(0x2aa)]((_0x38c5e5,_0x3ed425)=>{var _0x593aa5=_0x5a1b5f;_0x1b2ed2[_0x3ed425][_0x593aa5(0x2bd)]=_0x38c5e5;}),_0x4440c3[_0x5a1b5f(0x2aa)]((_0x33cc30,_0x35f7b3)=>{var _0x6b35b6=_0x5a1b5f;_0x1b2ed2[_0x35f7b3][_0x6b35b6(0x2ee)]=_0x33cc30;}),_0x346e0c['forEach']((_0x463fdc,_0xab53a9)=>{var _0x321052=_0x5a1b5f;_0x1b2ed2[_0xab53a9][_0x321052(0x24f)]=_0x463fdc;}),_0x404c96[_0x5a1b5f(0x2aa)]((_0x57e7a2,_0x41bd79)=>{var _0x57693e=_0x5a1b5f;_0x1b2ed2[_0x41bd79][_0x57693e(0x1f9)]=_0x57e7a2;}),_0x4f6f1f[_0x5a1b5f(0x2aa)]((_0x217ff1,_0x4e1aca)=>{var _0x3f3cd7=_0x5a1b5f;_0x1b2ed2[_0x4e1aca][_0x3f3cd7(0x26a)]=_0x217ff1;}),_0x4dd5e9[_0x5a1b5f(0x2aa)]((_0x461d1f,_0x2117dd)=>{var _0x386c9a=_0x5a1b5f;_0x1b2ed2[_0x2117dd][_0x386c9a(0x2b3)]=_0x461d1f;}),_0x293c02['forEach']((_0x4b2a84,_0x104f04)=>{var _0x182343=_0x5a1b5f;_0x1b2ed2[_0x104f04][_0x182343(0x26b)]=_0x4b2a84;});const _0x19c04e=_0x1b2ed2[_0x5a1b5f(0x257)](_0x4b26e5=>_0x4b26e5['quantity']!=='0'&&_0x4b26e5['quantity']!=='');_0x22fbb0[_0x5a1b5f(0x2e8)]=_0x5a3da9,_0x22fbb0[_0x5a1b5f(0x21f)]=_0x443836,_0x22fbb0[_0x5a1b5f(0x2cc)]=_0x456404,_0x22fbb0[_0x5a1b5f(0x239)]=_0x238e63,_0x22fbb0[_0x5a1b5f(0x22a)]=_0x19c04e,_0x22fbb0['note']=_0x388570,_0x22fbb0['paid_amount']=_0xd32019,_0x22fbb0[_0x5a1b5f(0x2ef)]=_0x242375,_0x22fbb0[_0x5a1b5f(0x298)]=_0x310093,_0x22fbb0[_0x5a1b5f(0x207)]=_0x15512a,_0x22fbb0[_0x5a1b5f(0x276)]=_0x23fb31;const _0x4611ba=await _0x22fbb0['save'](),_0x20b4c4=await warehouse[_0x5a1b5f(0x2c9)]({'name':_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x239)],'room':_0x204db2['body'][_0x5a1b5f(0x243)]});_0x22fbb0[_0x5a1b5f(0x22a)][_0x5a1b5f(0x2aa)](_0x5dde01=>{var _0x33bf42=_0x5a1b5f,_0x34dca0=0x0;const _0x52dc6f=_0x20b4c4[_0x33bf42(0x28c)][_0x33bf42(0x23f)](_0x320c18=>{var _0x4e1db6=_0x33bf42;_0x320c18[_0x4e1db6(0x2fd)]==_0x5dde01['product_name']&&_0x320c18[_0x4e1db6(0x252)]==_0x5dde01[_0x4e1db6(0x252)]&&_0x320c18[_0x4e1db6(0x26a)]==_0x5dde01['type']&&_0x320c18[_0x4e1db6(0x2e9)]==_0x5dde01[_0x4e1db6(0x2e9)]&&_0x320c18[_0x4e1db6(0x1f0)]==_0x5dde01[_0x4e1db6(0x1f0)]&&_0x320c18['rack']==_0x5dde01[_0x4e1db6(0x26b)]&&_0x320c18['storage']==_0x5dde01['storage']&&(_0x320c18[_0x4e1db6(0x22c)]=parseInt(_0x320c18[_0x4e1db6(0x22c)])+parseInt(_0x5dde01[_0x4e1db6(0x23a)]),_0x34dca0++);});_0x34dca0=='0'&&(_0x20b4c4['product_details']=_0x20b4c4[_0x33bf42(0x28c)][_0x33bf42(0x2a0)]({'product_name':_0x5dde01[_0x33bf42(0x2fd)],'product_stock':_0x5dde01[_0x33bf42(0x23a)],'primary_code':_0x5dde01['primary_code'],'secondary_code':_0x5dde01['secondary_code'],'product_code':_0x5dde01['product_code'],'storage':_0x5dde01[_0x33bf42(0x2b3)],'rack':_0x5dde01[_0x33bf42(0x26b)],'bay':_0x5dde01[_0x33bf42(0x1f0)],'bin':_0x5dde01[_0x33bf42(0x2e9)],'type':_0x5dde01[_0x33bf42(0x26a)],'floorlevel':_0x5dde01['floorlevel'],'maxProducts':_0x5dde01['maxStocks'],'unit':_0x5dde01[_0x33bf42(0x289)],'secondary_unit':_0x5dde01[_0x33bf42(0x217)],'expiry_date':_0x5dde01['expiry_date']}));}),await _0x20b4c4[_0x5a1b5f(0x213)]();const _0x1ec48a=await s_payment_data[_0x5a1b5f(0x2c9)]({'invoice':_0x204db2['body'][_0x5a1b5f(0x2e8)]});if(_0x1ec48a===null){}else console[_0x5a1b5f(0x286)](_0x5a1b5f(0x21f),_0x1ec48a,_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x2e8)]),_0x1ec48a[_0x5a1b5f(0x21f)]=_0x204db2[_0x5a1b5f(0x2e3)][_0x5a1b5f(0x21f)],await _0x1ec48a[_0x5a1b5f(0x213)]();_0x204db2[_0x5a1b5f(0x1fb)](_0x5a1b5f(0x280),_0x5a1b5f(0x275)),_0x18ea58[_0x5a1b5f(0x2c2)](_0x5a1b5f(0x201));}catch(_0x75e54b){console['log'](_0x75e54b);}}),router[a0_0x2c8f8a(0x225)](a0_0x2c8f8a(0x27b),auth,async(_0x1fc80f,_0x3f23dd)=>{var _0x5c10ff=a0_0x2c8f8a;try{const _0x4c0231=_0x1fc80f[_0x5c10ff(0x241)]['id'],{invoice:_0x3228cb,suppliers:_0x1567c5,payable:_0x334ecc,due_amount:_0x3f31be}=_0x1fc80f['body'],_0x549270=await purchases[_0x5c10ff(0x255)](_0x4c0231);var _0x79e665=_0x334ecc-_0x3f31be;_0x549270[_0x5c10ff(0x2d3)]=parseFloat(_0x549270['paid_amount'])+parseFloat(_0x3f31be),_0x549270[_0x5c10ff(0x2ef)]=_0x79e665;const _0x17b68b=await _0x549270['save']();console[_0x5c10ff(0x286)](_0x17b68b);const _0x3f2405=await s_payment_data['findOne']({'invoice':_0x3228cb});_0x3f2405['amount']=_0x79e665,await _0x3f2405[_0x5c10ff(0x213)]();let _0x6c2a5a=new Date(),_0x1e1a65=('0'+_0x6c2a5a[_0x5c10ff(0x20e)]())[_0x5c10ff(0x28f)](-0x2),_0x1eba8d=('0'+(_0x6c2a5a[_0x5c10ff(0x2f4)]()+0x1))[_0x5c10ff(0x28f)](-0x2),_0x579d82=_0x6c2a5a[_0x5c10ff(0x2ae)](),_0x4e40aa=_0x579d82+'-'+_0x1eba8d+'-'+_0x1e1a65;const _0x334d83=new suppliers_payment({'invoice':_0x3228cb,'date':_0x579d82+'-'+_0x1eba8d+'-'+_0x1e1a65,'suppliers':_0x1567c5,'reason':_0x5c10ff(0x26c),'amount':_0x3f31be}),_0x3b558f=await _0x334d83[_0x5c10ff(0x213)]();_0x1fc80f[_0x5c10ff(0x1fb)]('success',_0x5c10ff(0x302)),_0x3f23dd[_0x5c10ff(0x2c2)]('/all_purchases/view');}catch(_0x56ccda){console[_0x5c10ff(0x286)](_0x56ccda);}}),router['get'](a0_0x2c8f8a(0x247),auth,async(_0x10bf30,_0x69694a)=>{var _0x49c9a6=a0_0x2c8f8a;try{const {username:_0x3dd7b0,email:_0x3c40a2,role:_0xa99ac4}=_0x10bf30[_0x49c9a6(0x210)],_0x6265ee=_0x10bf30['user'],_0x48545d=await profile[_0x49c9a6(0x2c9)]({'email':_0x6265ee[_0x49c9a6(0x274)]}),_0x45a3dc=await master_shop[_0x49c9a6(0x28e)]();console[_0x49c9a6(0x286)](_0x49c9a6(0x21d),_0x45a3dc);const _0x3da787=_0x10bf30[_0x49c9a6(0x241)]['id'],_0x90502d=await purchases[_0x49c9a6(0x255)](_0x3da787);console[_0x49c9a6(0x286)](_0x90502d);const _0x1f1480=await suppliers[_0x49c9a6(0x2c9)]({'name':_0x90502d[_0x49c9a6(0x21f)]});console['log'](_0x1f1480);if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]==_0x49c9a6(0x2f6)){var _0x1e8b12=users['English'];console[_0x49c9a6(0x286)](_0x1e8b12);}else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]==_0x49c9a6(0x22e))var _0x1e8b12=users[_0x49c9a6(0x22e)];else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]==_0x49c9a6(0x2e6))var _0x1e8b12=users['German'];else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]==_0x49c9a6(0x2f0))var _0x1e8b12=users[_0x49c9a6(0x2f0)];else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]=='French')var _0x1e8b12=users[_0x49c9a6(0x21b)];else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]=='Portuguese\x20(BR)')var _0x1e8b12=users[_0x49c9a6(0x300)];else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]==_0x49c9a6(0x248))var _0x1e8b12=users[_0x49c9a6(0x248)];else{if(_0x45a3dc[0x0][_0x49c9a6(0x2c0)]==_0x49c9a6(0x224))var _0x1e8b12=users[_0x49c9a6(0x29a)];}}}}}}}_0x69694a['render'](_0x49c9a6(0x20f),{'success':_0x10bf30['flash'](_0x49c9a6(0x280)),'errors':_0x10bf30[_0x49c9a6(0x1fb)](_0x49c9a6(0x259)),'role':_0x6265ee,'profile':_0x48545d,'master_shop':_0x45a3dc,'supplier':_0x1f1480,'purchase':_0x90502d,'language':_0x1e8b12});}catch(_0x13fc9c){console[_0x49c9a6(0x286)](_0x13fc9c);}}),router['get'](a0_0x2c8f8a(0x208),auth,async(_0x167d55,_0x128894)=>{var _0x265e81=a0_0x2c8f8a;try{const {username:_0x3cd966,email:_0x144649,role:_0x132e9f}=_0x167d55[_0x265e81(0x210)],_0x196181=_0x167d55[_0x265e81(0x210)],_0x5e7928=await profile[_0x265e81(0x2c9)]({'email':_0x196181['email']}),_0x11ccd8=await master_shop[_0x265e81(0x28e)]();console[_0x265e81(0x286)](_0x265e81(0x21d),_0x11ccd8);const _0x33f84e=_0x167d55[_0x265e81(0x241)]['id'];console[_0x265e81(0x286)](_0x33f84e);const _0x136276=await purchases[_0x265e81(0x255)](_0x33f84e);console[_0x265e81(0x286)](_0x265e81(0x218),_0x136276);const _0x161376=await product[_0x265e81(0x28e)]({}),_0x361253=await warehouse['aggregate']([{'$match':{'name':_0x136276[_0x265e81(0x239)],'room':_0x136276[_0x265e81(0x298)],'warehouse_category':_0x265e81(0x251)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x265e81(0x22f),'name':{'$first':_0x265e81(0x2a3)},'product_stock':{'$first':_0x265e81(0x2da)},'bay':{'$first':_0x265e81(0x264)},'bin':{'$first':_0x265e81(0x265)},'type':{'$first':_0x265e81(0x2f7)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x265e81(0x26f)},'secondary_code':{'$first':_0x265e81(0x25f)},'product_code':{'$first':_0x265e81(0x2e1)},'storage':{'$first':_0x265e81(0x299)},'rack':{'$first':_0x265e81(0x242)}}}]);warehouse_data=await warehouse[_0x265e81(0x282)]([{'$match':{'status':'Enabled','name':_0x265e81(0x2ab),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x265e81(0x307),'name':{'$first':_0x265e81(0x307)}}},{'$sort':{'name':0x1}}]),console[_0x265e81(0x286)](_0x265e81(0x268),_0x361253);if(_0x11ccd8[0x0][_0x265e81(0x2c0)]=='English\x20(US)'){var _0x57efff=users[_0x265e81(0x2f5)];console[_0x265e81(0x286)](_0x57efff);}else{if(_0x11ccd8[0x0][_0x265e81(0x2c0)]==_0x265e81(0x22e))var _0x57efff=users[_0x265e81(0x22e)];else{if(_0x11ccd8[0x0][_0x265e81(0x2c0)]=='German')var _0x57efff=users[_0x265e81(0x2e6)];else{if(_0x11ccd8[0x0][_0x265e81(0x2c0)]=='Spanish')var _0x57efff=users[_0x265e81(0x2f0)];else{if(_0x11ccd8[0x0]['language']==_0x265e81(0x21b))var _0x57efff=users[_0x265e81(0x21b)];else{if(_0x11ccd8[0x0][_0x265e81(0x2c0)]=='Portuguese\x20(BR)')var _0x57efff=users[_0x265e81(0x300)];else{if(_0x11ccd8[0x0][_0x265e81(0x2c0)]==_0x265e81(0x248))var _0x57efff=users[_0x265e81(0x248)];else{if(_0x11ccd8[0x0][_0x265e81(0x2c0)]==_0x265e81(0x224))var _0x57efff=users['Arabic'];}}}}}}}_0x128894[_0x265e81(0x1fd)](_0x265e81(0x2d6),{'success':_0x167d55[_0x265e81(0x1fb)](_0x265e81(0x280)),'errors':_0x167d55[_0x265e81(0x1fb)]('errors'),'role':_0x196181,'profile':_0x5e7928,'user':_0x136276,'stock':_0x361253,'master_shop':_0x11ccd8,'product':_0x161376,'language':_0x57efff,'warehouse':warehouse_data});}catch(_0x33f5a2){console[_0x265e81(0x286)](_0x33f5a2);}}),router[a0_0x2c8f8a(0x225)](a0_0x2c8f8a(0x208),auth,async(_0x241221,_0x5229b3)=>{var _0x6a7dcf=a0_0x2c8f8a;try{const {invoice:_0x4cdb8e,date:_0x244f45,warehouse_name:_0x49a827,Room_name:_0x1aca93,product_name:_0x431a14,purchase_quantity:_0x431bf4,stocks:_0x53439e,return_qty:_0x311bd8,note:_0x367d6f,level:_0x4a74e5,isle:_0x44641e,pallet:_0x1d3132,to_warehouse_name:_0x28d3cc,to_Room_name:_0x350e11}=_0x241221[_0x6a7dcf(0x2e3)],_0x56a87f=await purchases[_0x6a7dcf(0x2c9)]({'_id':_0x241221[_0x6a7dcf(0x241)]['id']}),_0x2293dc=await warehouse[_0x6a7dcf(0x2c9)]({'name':_0x49a827,'room':_0x1aca93});if(typeof _0x431a14==_0x6a7dcf(0x230))var _0x4e2044=[_0x241221[_0x6a7dcf(0x2e3)]['product_name']],_0x33b036=[_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x260)]],_0x4349fd=[_0x241221['body'][_0x6a7dcf(0x250)]],_0x24ec43=[_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x284)]],_0x4e9d1a=[_0x241221['body'][_0x6a7dcf(0x2b6)]],_0x57b500=[_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x2c1)]],_0x4112e6=[_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x2f8)]],_0x393525=[_0x241221['body'][_0x6a7dcf(0x2a5)]],_0x3fd611=[_0x241221['body'][_0x6a7dcf(0x270)]],_0x190e25=[_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x1ec)]],_0x3e8482=[_0x241221[_0x6a7dcf(0x2e3)]['secondary_code_hide']];else var _0x4e2044=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x2fd)]],_0x33b036=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x260)]],_0x4349fd=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x250)]],_0x24ec43=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x284)]],_0x4e9d1a=[..._0x241221[_0x6a7dcf(0x2e3)]['level']],_0x57b500=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x2c1)]],_0x4112e6=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x2f8)]],_0x393525=[..._0x241221['body']['types']],_0x3fd611=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x270)]],_0x190e25=[..._0x241221['body']['primary_code_hide']],_0x3e8482=[..._0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x25c)]];const _0x1e8b73=_0x4e2044[_0x6a7dcf(0x23f)](_0x45a04f=>{return _0x45a04f={'product_name':_0x45a04f};});_0x33b036['forEach']((_0x46e6e4,_0x3c4549)=>{var _0xee51fd=_0x6a7dcf;_0x1e8b73[_0x3c4549][_0xee51fd(0x260)]=_0x46e6e4;}),_0x4349fd[_0x6a7dcf(0x2aa)]((_0x5a9025,_0x259048)=>{var _0x2f6816=_0x6a7dcf;_0x1e8b73[_0x259048][_0x2f6816(0x2b8)]=_0x5a9025;}),_0x24ec43[_0x6a7dcf(0x2aa)]((_0x47a776,_0x55d60d)=>{var _0x42e398=_0x6a7dcf;_0x1e8b73[_0x55d60d][_0x42e398(0x284)]=_0x47a776;}),_0x4e9d1a[_0x6a7dcf(0x2aa)]((_0x4631d8,_0x5ce7c7)=>{_0x1e8b73[_0x5ce7c7]['bay']=_0x4631d8;}),_0x57b500[_0x6a7dcf(0x2aa)]((_0x450c07,_0x1f898e)=>{var _0x4abe74=_0x6a7dcf;_0x1e8b73[_0x1f898e][_0x4abe74(0x2e9)]=_0x450c07;}),_0x4112e6[_0x6a7dcf(0x2aa)]((_0x247ee8,_0x5cb875)=>{var _0x1c22c7=_0x6a7dcf;_0x1e8b73[_0x5cb875][_0x1c22c7(0x252)]=_0x247ee8;}),_0x393525[_0x6a7dcf(0x2aa)]((_0x501a3d,_0x1a3485)=>{var _0x33bd69=_0x6a7dcf;_0x1e8b73[_0x1a3485][_0x33bd69(0x26a)]=_0x501a3d;}),_0x3fd611['forEach']((_0x9fc931,_0x2dd1a5)=>{var _0x12e275=_0x6a7dcf;_0x1e8b73[_0x2dd1a5][_0x12e275(0x2be)]=_0x9fc931;}),_0x190e25['forEach']((_0x4a84d6,_0x492ca7)=>{var _0x1a4b6e=_0x6a7dcf;_0x1e8b73[_0x492ca7][_0x1a4b6e(0x2ff)]=_0x4a84d6;}),_0x3e8482[_0x6a7dcf(0x2aa)]((_0x44ba82,_0x22dc6d)=>{var _0x52225c=_0x6a7dcf;_0x1e8b73[_0x22dc6d][_0x52225c(0x2bd)]=_0x44ba82;}),_0x56a87f[_0x6a7dcf(0x22a)][_0x6a7dcf(0x2aa)](_0x1afdc2=>{var _0x4975b6=_0x6a7dcf;const _0x58d08f=_0x2293dc['product_details'][_0x4975b6(0x23f)](_0x164d89=>{var _0x314d30=_0x4975b6;_0x164d89[_0x314d30(0x2fd)]==_0x1afdc2[_0x314d30(0x2fd)]&&_0x164d89['floorlevel']==_0x1afdc2[_0x314d30(0x252)]&&_0x164d89[_0x314d30(0x26a)]==_0x1afdc2[_0x314d30(0x26a)]&&_0x164d89[_0x314d30(0x2e9)]==_0x1afdc2['bin']&&_0x164d89[_0x314d30(0x1f0)]==_0x1afdc2[_0x314d30(0x1f0)]&&_0x164d89[_0x314d30(0x26b)]==_0x1afdc2[_0x314d30(0x26b)]&&_0x164d89[_0x314d30(0x2b3)]==_0x1afdc2[_0x314d30(0x2b3)]&&(console[_0x314d30(0x286)](parseInt(_0x164d89[_0x314d30(0x22c)])+_0x314d30(0x2d8)+parseInt(_0x1afdc2[_0x314d30(0x23a)])),_0x164d89[_0x314d30(0x22c)]=parseInt(_0x164d89['product_stock'])+parseInt(_0x1afdc2[_0x314d30(0x23a)]));});}),await _0x2293dc[_0x6a7dcf(0x213)]();const _0x5280b5=_0x1e8b73['filter'](_0x4c3df7=>_0x4c3df7[_0x6a7dcf(0x284)]!=='0'&&_0x4c3df7['return_qty']!=='');var _0x10f3ad=0x0;_0x5280b5[_0x6a7dcf(0x2aa)](_0x5512ec=>{var _0x3da6ef=_0x6a7dcf;console[_0x3da6ef(0x286)](_0x3da6ef(0x200),_0x5512ec),(parseInt(_0x5512ec['purchase_quantity'])<parseInt(_0x5512ec[_0x3da6ef(0x284)])||parseInt(_0x5512ec[_0x3da6ef(0x2b8)])<parseInt(_0x5512ec[_0x3da6ef(0x284)]))&&_0x10f3ad++;});if(_0x10f3ad!=0x0)return _0x241221[_0x6a7dcf(0x1fb)]('errors',_0x6a7dcf(0x233)),_0x5229b3[_0x6a7dcf(0x2c2)](_0x6a7dcf(0x1f4));const _0x4c277b=new purchases_return({'invoice':_0x4cdb8e,'suppliers':_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x21f)],'date':_0x244f45,'warehouse_name':_0x49a827,'return_product':_0x5280b5,'note':_0x367d6f,'room':_0x1aca93,'to_warehouse_name':_0x28d3cc,'to_room':_0x350e11}),_0x441fd0=await _0x4c277b['save']();console[_0x6a7dcf(0x286)](_0x4c277b);const _0x2e9a81=await purchases_return[_0x6a7dcf(0x2c9)]({'invoice':_0x4cdb8e}),_0x2d8979=await warehouse[_0x6a7dcf(0x2c9)]({'name':_0x28d3cc,'room':_0x350e11});_0x2e9a81[_0x6a7dcf(0x24b)][_0x6a7dcf(0x2aa)](_0x2d2207=>{var _0x3e9208=_0x6a7dcf,_0x701434=0x0;const _0x5ebc0b=_0x2d8979[_0x3e9208(0x28c)][_0x3e9208(0x23f)](_0x379f4f=>{var _0x24cf8f=_0x3e9208;_0x379f4f[_0x24cf8f(0x2fd)]==_0x2d2207['product_name']&&_0x379f4f['floorlevel']==_0x2d2207[_0x24cf8f(0x252)]&&_0x379f4f[_0x24cf8f(0x26a)]==_0x2d2207[_0x24cf8f(0x26a)]&&_0x379f4f['bin']==_0x2d2207[_0x24cf8f(0x2e9)]&&_0x379f4f[_0x24cf8f(0x1f0)]==_0x2d2207['bay']&&(_0x379f4f['product_stock']=parseInt(_0x379f4f[_0x24cf8f(0x22c)])-parseInt(_0x2d2207['return_qty']),_0x701434++);});_0x701434=='0'&&(_0x2d8979[_0x3e9208(0x28c)]=_0x2d8979[_0x3e9208(0x28c)][_0x3e9208(0x2a0)]({'product_name':_0x2d2207[_0x3e9208(0x2fd)],'product_stock':_0x2d2207[_0x3e9208(0x284)],'primary_code':_0x2d2207['primary_code'],'secondary_code':_0x2d2207[_0x3e9208(0x2bd)],'product_code':_0x2d2207[_0x3e9208(0x2be)],'storage':_0x2d2207['storage'],'rack':_0x2d2207[_0x3e9208(0x26b)],'bay':_0x2d2207[_0x3e9208(0x1f0)],'bin':_0x2d2207[_0x3e9208(0x2e9)],'type':_0x2d2207[_0x3e9208(0x26a)],'floorlevel':_0x2d2207[_0x3e9208(0x252)],'maxProducts':_0x2d2207['maxStocks'],'unit':_0x2d2207[_0x3e9208(0x289)],'secondary_unit':_0x2d2207[_0x3e9208(0x217)],'expiry_date':_0x2d2207[_0x3e9208(0x1f9)]}));}),await _0x2d8979[_0x6a7dcf(0x213)]();const _0x454261=await purchases[_0x6a7dcf(0x2c9)]({'invoice':_0x4cdb8e});_0x454261[_0x6a7dcf(0x240)]=_0x6a7dcf(0x2b9);const _0x209597=await _0x454261['save'](),_0x1846f6=new s_payment_data({'invoice':_0x4cdb8e,'suppliers':_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x21f)],'reason':'Purchase\x20Return'});await _0x1846f6[_0x6a7dcf(0x213)]();const _0xbab96f=await master_shop['find']();console[_0x6a7dcf(0x286)]('add\x20post',_0xbab96f[0x0][_0x6a7dcf(0x269)]);const _0x3ec183=await email_settings['findOne'](),_0x196f44=await suppliers['findOne']({'name':_0x241221[_0x6a7dcf(0x2e3)][_0x6a7dcf(0x21f)]});console[_0x6a7dcf(0x286)]('suppliers_data',_0x196f44);_0xbab96f[0x0][_0x6a7dcf(0x2ba)]==0x1?(right_currency=_0xbab96f[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0xbab96f[0x0]['currency']);var _0x3a38f2=_0x4e2044,_0x4d3f0b=_0x24ec43,_0x471121='',_0x2bd9b5;for(_0x2bd9b5 in _0x3a38f2){_0x471121+='<tr>'+_0x6a7dcf(0x308)+_0x3a38f2[_0x2bd9b5]+_0x6a7dcf(0x2d5)+_0x6a7dcf(0x308)+_0x4d3f0b[_0x2bd9b5]+'</td>'+_0x6a7dcf(0x2b5);}console['log']('product_list',_0x471121);let _0x41d1fb=nodemailer[_0x6a7dcf(0x216)]({'service':_0x6a7dcf(0x2ec),'auth':{'user':_0x3ec183[_0x6a7dcf(0x274)],'pass':_0x3ec183[_0x6a7dcf(0x2fe)]}}),_0x37e043={'from':_0x3ec183['email'],'to':_0x196f44['email'],'subject':_0x6a7dcf(0x30d),'attachments':[{'filename':'Logo.png','path':__dirname+_0x6a7dcf(0x215)+_0x6a7dcf(0x2af)+_0xbab96f[0x0][_0x6a7dcf(0x269)],'cid':_0x6a7dcf(0x231)}],'html':_0x6a7dcf(0x2fc)+_0x6a7dcf(0x258)+_0x6a7dcf(0x267)+_0x6a7dcf(0x309)+_0x6a7dcf(0x234)+'<div>'+_0x6a7dcf(0x2f3)+_0x6a7dcf(0x271)+'<div>'+_0x6a7dcf(0x2a1)+_0xbab96f[0x0][_0x6a7dcf(0x24c)]+'\x20</h2>'+_0x6a7dcf(0x271)+_0x6a7dcf(0x271)+_0x6a7dcf(0x2a8)+_0x6a7dcf(0x309)+_0x6a7dcf(0x2c8)+'\x20Order\x20Number\x20:\x20'+_0x4cdb8e+'\x20'+_0x6a7dcf(0x296)+_0x6a7dcf(0x25a)+_0x244f45+'\x20'+_0x6a7dcf(0x1f6)+_0x6a7dcf(0x2c5)+'</div>'+_0x6a7dcf(0x232)+_0x6a7dcf(0x20a)+_0x6a7dcf(0x293)+_0x6a7dcf(0x21e)+_0x6a7dcf(0x2ca)+_0x6a7dcf(0x266)+_0x6a7dcf(0x30b)+_0x6a7dcf(0x2b5)+'</thead>'+_0x6a7dcf(0x244)+'\x20'+_0x471121+'\x20'+_0x6a7dcf(0x2c3)+_0x6a7dcf(0x2c7)+_0x6a7dcf(0x309)+_0x6a7dcf(0x2c4)+_0x6a7dcf(0x2e2)+_0xbab96f[0x0][_0x6a7dcf(0x24c)]+_0x6a7dcf(0x2c5)+_0x6a7dcf(0x271)+'</div>'+_0x6a7dcf(0x27d)};_0x41d1fb[_0x6a7dcf(0x238)](_0x37e043,function(_0x1415ec,_0x61db4f){var _0x5a2dcb=_0x6a7dcf;_0x1415ec?(console[_0x5a2dcb(0x286)](_0x1415ec),console['log'](_0x5a2dcb(0x203))):console[_0x5a2dcb(0x286)]('Email\x20sent\x20successfully');}),_0x241221[_0x6a7dcf(0x1fb)]('success',_0x6a7dcf(0x249)),_0x5229b3[_0x6a7dcf(0x2c2)](_0x6a7dcf(0x201));}catch(_0x2461c4){console[_0x6a7dcf(0x286)](_0x2461c4),_0x5229b3['status'](0xc8)[_0x6a7dcf(0x2e5)]({'message':_0x2461c4[_0x6a7dcf(0x2f2)]});}}),router['get'](a0_0x2c8f8a(0x29c),auth,async(_0x265315,_0x3ffe7d)=>{var _0x3a4a7d=a0_0x2c8f8a;try{const {username:_0x145f40,email:_0x475360,role:_0x3ef0c8}=_0x265315[_0x3a4a7d(0x210)],_0x57478d=_0x265315['user'],_0xced916=await profile[_0x3a4a7d(0x2c9)]({'email':_0x57478d['email']}),_0x4944f9=await master_shop['find'](),_0xc4f0d=_0x265315[_0x3a4a7d(0x241)]['id'],_0xc5896a=await purchases['findById'](_0xc4f0d);if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]==_0x3a4a7d(0x2f6))var _0x919a6c=users[_0x3a4a7d(0x2f5)];else{if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]=='Hindi')var _0x919a6c=users[_0x3a4a7d(0x22e)];else{if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]==_0x3a4a7d(0x2e6))var _0x919a6c=users[_0x3a4a7d(0x2e6)];else{if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]==_0x3a4a7d(0x2f0))var _0x919a6c=users[_0x3a4a7d(0x2f0)];else{if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]=='French')var _0x919a6c=users[_0x3a4a7d(0x21b)];else{if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]=='Portuguese\x20(BR)')var _0x919a6c=users[_0x3a4a7d(0x300)];else{if(_0x4944f9[0x0][_0x3a4a7d(0x2c0)]==_0x3a4a7d(0x248))var _0x919a6c=users['Chinese'];else{if(_0x4944f9[0x0]['language']==_0x3a4a7d(0x224))var _0x919a6c=users[_0x3a4a7d(0x29a)];}}}}}}}_0x3ffe7d['render'](_0x3a4a7d(0x30e),{'success':_0x265315['flash'](_0x3a4a7d(0x280)),'errors':_0x265315[_0x3a4a7d(0x1fb)]('errors'),'role':_0x57478d,'profile':_0xced916,'alldata':_0xc5896a,'master_shop':_0x4944f9,'language':_0x919a6c}),console['log'](alldata);}catch(_0x2857d6){console[_0x3a4a7d(0x286)](_0x2857d6);}}),router['post'](a0_0x2c8f8a(0x278),async(_0x19bc5f,_0x58e356)=>{var _0x25b3a3=a0_0x2c8f8a;const {product_code:_0x3c6dcb}=_0x19bc5f['body'];var _0x17884b;const _0x3eb91e=await product[_0x25b3a3(0x282)]([{'$match':{'primary_code':_0x3c6dcb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x25b3a3(0x21c),'name':{'$first':_0x25b3a3(0x307)},'category':{'$first':_0x25b3a3(0x223)},'brand':{'$first':'$brand'},'unit':{'$first':_0x25b3a3(0x2c6)},'alertquantity':{'$first':_0x25b3a3(0x272)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x25b3a3(0x206)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x25b3a3(0x23d)},'maxProdPerUnit':{'$first':_0x25b3a3(0x237)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x25b3a3(0x22b)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x458ac2=await product[_0x25b3a3(0x282)]([{'$match':{'secondary_code':_0x3c6dcb,'product_category':_0x25b3a3(0x251)}},{'$group':{'_id':'$_id','name':{'$first':_0x25b3a3(0x307)},'category':{'$first':_0x25b3a3(0x223)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x25b3a3(0x272)},'product_code':{'$first':_0x25b3a3(0x256)},'primary_code':{'$first':_0x25b3a3(0x206)},'secondary_code':{'$first':_0x25b3a3(0x20b)},'maxStocks':{'$first':_0x25b3a3(0x23d)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3eb91e[_0x25b3a3(0x2d9)]>0x0)_0x17884b=_0x3eb91e;else _0x458ac2[_0x25b3a3(0x2d9)]>0x0&&(_0x17884b=_0x458ac2);_0x58e356['json'](_0x17884b);}),router[a0_0x2c8f8a(0x225)]('/CheckingWarehouse',async(_0x342422,_0x13f495)=>{var _0x288c57=a0_0x2c8f8a;const {primaryCode:_0x450cd8,secondaryCode:_0x122adb,productCode:_0x30418a,bay:_0x13422c,bin:_0x163a47,types:_0x222708,pallet:_0x19a8f1,warehouses:_0x739c1b,room:_0x538ed0}=_0x342422[_0x288c57(0x2e3)];console['log'](_0x342422[_0x288c57(0x2e3)]);try{const _0xc9d256=await warehouse[_0x288c57(0x282)]([{'$match':{'name':_0x739c1b,'room':_0x538ed0}},{'$unwind':_0x288c57(0x29e)},{'$match':{'product_details.bay':_0x13422c,'product_details.bin':_0x163a47,'product_details.type':_0x222708}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x288c57(0x2a3)},'product_stock':{'$first':_0x288c57(0x2da)},'level':{'$first':_0x288c57(0x209)},'isle':{'$first':_0x288c57(0x2a9)},'pallet':{'$first':_0x288c57(0x2b2)},'maxProducts':{'$first':_0x288c57(0x277)}}}]);_0x13f495[_0x288c57(0x294)](0xc8)['json'](_0xc9d256);}catch(_0x1c73a3){_0x13f495[_0x288c57(0x294)](0x194)['json']({'message':_0x1c73a3[_0x288c57(0x2f2)]});}}),module['exports']=router;