var a0_0x43d5a0=a0_0x52e0;(function(_0x5ba157,_0x5021f3){var _0x2e56d3=a0_0x52e0,_0x1c245d=_0x5ba157();while(!![]){try{var _0x148590=parseInt(_0x2e56d3(0x1af))/0x1+-parseInt(_0x2e56d3(0x1c8))/0x2*(-parseInt(_0x2e56d3(0x22d))/0x3)+parseInt(_0x2e56d3(0x28c))/0x4*(parseInt(_0x2e56d3(0x23d))/0x5)+-parseInt(_0x2e56d3(0x288))/0x6+-parseInt(_0x2e56d3(0x191))/0x7+parseInt(_0x2e56d3(0x1d5))/0x8*(-parseInt(_0x2e56d3(0x1ab))/0x9)+-parseInt(_0x2e56d3(0x276))/0xa*(-parseInt(_0x2e56d3(0x216))/0xb);if(_0x148590===_0x5021f3)break;else _0x1c245d['push'](_0x1c245d['shift']());}catch(_0x7b5555){_0x1c245d['push'](_0x1c245d['shift']());}}}(a0_0x214e,0x608bf));function a0_0x52e0(_0x2a0ac3,_0x24b24f){var _0x214e4b=a0_0x214e();return a0_0x52e0=function(_0x52e074,_0x22d684){_0x52e074=_0x52e074-0x18b;var _0x36da75=_0x214e4b[_0x52e074];return _0x36da75;},a0_0x52e0(_0x2a0ac3,_0x24b24f);}const express=require(a0_0x43d5a0(0x2a2)),app=express(),router=express[a0_0x43d5a0(0x272)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x43d5a0(0x1a4)),auth=require(a0_0x43d5a0(0x193)),nodemailer=require(a0_0x43d5a0(0x225));var ejs=require(a0_0x43d5a0(0x27b));const path=require('path'),users=require('../public/language/languages.json');router[a0_0x43d5a0(0x203)](a0_0x43d5a0(0x259),auth,async(_0x434f59,_0x3a7e86)=>{var _0x35f782=a0_0x43d5a0;try{const {username:_0x274075,email:_0x30abea,role:_0x2ad714}=_0x434f59[_0x35f782(0x1ed)],_0x31091c=_0x434f59[_0x35f782(0x1ed)],_0x4fa05c=await profile['findOne']({'email':_0x31091c['email']}),_0x473ce6=await staff[_0x35f782(0x208)]({'email':_0x31091c[_0x35f782(0x253)]});if(_0x31091c[_0x35f782(0x210)]==_0x35f782(0x1de)){const _0x50ea00=await staff[_0x35f782(0x208)]({'email':_0x31091c[_0x35f782(0x253)]});}const _0x38bb31=await master_shop[_0x35f782(0x1d2)]();let _0x38c767;if(_0x31091c[_0x35f782(0x210)]=='staff'){const _0x58996a=await staff['findOne']({'email':_0x31091c[_0x35f782(0x253)]});_0x38c767=await purchases[_0x35f782(0x1f5)]([{'$match':{'warehouse_name':_0x58996a[_0x35f782(0x199)]}},{'$lookup':{'from':_0x35f782(0x1a8),'localField':_0x35f782(0x1a8),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x35f782(0x1f3)},{'$group':{'_id':_0x35f782(0x28a),'invoice':{'$first':_0x35f782(0x1d3)},'suppliers':{'$first':_0x35f782(0x19a)},'date':{'$first':_0x35f782(0x233)},'warehouse_name':{'$first':_0x35f782(0x1dc)},'room':{'$first':'$room'},'product':{'$push':_0x35f782(0x1f3)},'note':{'$first':_0x35f782(0x24a)},'paid_amount':{'$first':_0x35f782(0x1e1)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x35f782(0x1e5)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x35f782(0x1f8)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x35f782(0x282)},'isle':{'$addToSet':_0x35f782(0x1ce)},'type':{'$addToSet':_0x35f782(0x21c)},'floorlevel':{'$addToSet':_0x35f782(0x1b2)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x38c767=await purchases[_0x35f782(0x1f5)]([{'$lookup':{'from':_0x35f782(0x1a8),'localField':_0x35f782(0x1a8),'foreignField':_0x35f782(0x21f),'as':'suppliers_docs'}},{'$unwind':_0x35f782(0x1f8)},{'$unwind':_0x35f782(0x1f3)},{'$group':{'_id':_0x35f782(0x28a),'invoice':{'$first':_0x35f782(0x1d3)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x35f782(0x233)},'warehouse_name':{'$first':_0x35f782(0x1dc)},'room':{'$addToSet':_0x35f782(0x239)},'product':{'$push':_0x35f782(0x1f3)},'note':{'$first':_0x35f782(0x24a)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x35f782(0x29e)},'suppliers_docs':{'$first':_0x35f782(0x1f8)},'total_product_quantity':{'$sum':_0x35f782(0x228)},'level':{'$addToSet':_0x35f782(0x282)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x35f782(0x21c)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x38bb31[0x0][_0x35f782(0x1a5)]==_0x35f782(0x227)){var _0x4c0759=users[_0x35f782(0x28f)];console[_0x35f782(0x1fd)](_0x4c0759);}else{if(_0x38bb31[0x0]['language']==_0x35f782(0x1aa))var _0x4c0759=users[_0x35f782(0x1aa)];else{if(_0x38bb31[0x0][_0x35f782(0x1a5)]==_0x35f782(0x271))var _0x4c0759=users['German'];else{if(_0x38bb31[0x0][_0x35f782(0x1a5)]==_0x35f782(0x20a))var _0x4c0759=users[_0x35f782(0x20a)];else{if(_0x38bb31[0x0][_0x35f782(0x1a5)]=='French')var _0x4c0759=users[_0x35f782(0x1ff)];else{if(_0x38bb31[0x0][_0x35f782(0x1a5)]==_0x35f782(0x29f))var _0x4c0759=users[_0x35f782(0x200)];else{if(_0x38bb31[0x0][_0x35f782(0x1a5)]=='Chinese')var _0x4c0759=users[_0x35f782(0x297)];else{if(_0x38bb31[0x0]['language']=='Arabic\x20(ae)')var _0x4c0759=users[_0x35f782(0x289)];}}}}}}}_0x3a7e86[_0x35f782(0x245)](_0x35f782(0x1a3),{'success':_0x434f59[_0x35f782(0x195)](_0x35f782(0x265)),'errors':_0x434f59[_0x35f782(0x195)](_0x35f782(0x291)),'purchases':_0x38c767,'role':_0x31091c,'profile':_0x4fa05c,'master_shop':_0x38bb31,'language':_0x4c0759});}catch(_0x19dcdc){console[_0x35f782(0x1fd)](_0x35f782(0x274),_0x19dcdc),_0x3a7e86['status'](0xc8)['json']({'message':_0x19dcdc[_0x35f782(0x268)]});}});function BayBinSelected(_0x2e6ce4,_0x3de356){var _0xa6053c=a0_0x43d5a0,_0x15dc6a=[],_0x1cf185=[],_0x177a81=[],_0x16418c=[],_0x4dd474=[],_0x49bb30=[];let _0x33508d=[];if(_0x2e6ce4==_0xa6053c(0x22c))switch(_0x3de356){case'Rack\x20A':_0x15dc6a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1cf185=[0x1,0x2],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=[_0xa6053c(0x27d),'Floor'],_0x4dd474=['D'],_0x49bb30=['A'];break;case _0xa6053c(0x250):_0x15dc6a=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1cf185=[0x1,0x2],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=['Level',_0xa6053c(0x25a)],_0x4dd474=['D'],_0x49bb30=['B'];break;case'Shelves':_0x15dc6a=[0x0],_0x1cf185=[0x0],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=[_0xa6053c(0x25a)],_0x4dd474=['D'],_0x49bb30=['S'];break;case'Receiving\x20Area':_0x15dc6a=[0x0],_0x1cf185=[0x0],_0x16418c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x177a81=[_0xa6053c(0x25a)],_0x4dd474=['D'],_0x49bb30=['R'];break;}else{if(_0x2e6ce4==_0xa6053c(0x248))switch(_0x3de356){case _0xa6053c(0x1b8):_0x15dc6a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1cf185=['B','F'],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=[_0xa6053c(0x27d),_0xa6053c(0x25a)],_0x4dd474=['C'],_0x49bb30=['A'];break;case _0xa6053c(0x250):_0x15dc6a=[0x5,0x4,0x3,0x2,0x1],_0x1cf185=['F','B','S'],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=[_0xa6053c(0x27d),_0xa6053c(0x25a)],_0x4dd474=['C'],_0x49bb30=['B'];break;case _0xa6053c(0x19b):_0x15dc6a=[0x1,0x2,0x3,0x4,0x5],_0x1cf185=['B','F','S'],_0x16418c=[0x5,0x4,0x3,0x2,0x1],_0x177a81=[_0xa6053c(0x27d),_0xa6053c(0x25a)],_0x4dd474=['C'],_0x49bb30=['C'];break;case'Rack\x20D':_0x15dc6a=[0x5,0x4,0x3,0x2,0x1],_0x1cf185=['F','B','S'],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=[_0xa6053c(0x27d),_0xa6053c(0x25a)],_0x4dd474=['C'],_0x49bb30=['D'];break;case'Rack\x20E':_0x15dc6a=[0x4,0x3,0x2,0x1],_0x1cf185=[0x1,0x2],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=['Level',_0xa6053c(0x25a)],_0x4dd474=['C'],_0x49bb30=['E'];break;case'Rack\x20F':_0x15dc6a=[0x1,0x2,0x3],_0x1cf185=[0x1,0x2],_0x16418c=[0x1,0x2,0x3,0x4,0x5],_0x177a81=[_0xa6053c(0x27d)],_0x4dd474=['C'],_0x49bb30=['F'];break;}}return{'levels':_0x15dc6a,'Isle':_0x1cf185,'rack':_0x16418c,'type':_0x177a81,'storage':_0x4dd474,'rak':_0x49bb30};}async function getRandom8DigitNumber(){var _0x5569dd=a0_0x43d5a0;const _0x1a2391=0x989680,_0x56ec8c=0x5f5e0ff,_0x2e081e=Math[_0x5569dd(0x207)](Math[_0x5569dd(0x232)]()*(_0x56ec8c-_0x1a2391+0x1))+_0x1a2391;var _0x20d030;const _0x14df97=await purchases[_0x5569dd(0x208)]({'invoice':_0x5569dd(0x2a1)+_0x2e081e});return _0x14df97&&_0x14df97[_0x5569dd(0x190)]>0x0?_0x20d030=_0x5569dd(0x2a1)+_0x2e081e:_0x20d030=_0x5569dd(0x2a1)+_0x2e081e,_0x20d030;}function a0_0x214e(){var _0x41509e=['MaxStocks_data','/../public','floor','findOne','types','Spanish','$product_details.secondary_code','$product_details.product_code','</div>','/CheckingWarehouse','$alertquantity','role','add_purchases','foreach\x20newproduct','product','currency','storage','2006235IHjfBb','</body></html>','$unit','/view/:id','edit_purchases','Return\x20Goods','$product.type','finalize','<div>','name','Paid\x20For\x20Purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_details','</table>','master','nodemailer','delivery_code','English\x20(US)','$product.quantity','$product_details.bin','gmail','/give_payment/:id','DRY\x20STORAGE','3uxBOCI','Ambient','$primary_code','</tr>','<span\x20style=\x22float:\x20right;\x22>','random','$date','/upload/','$secondary_unit','return_product','quantity','Enabled','$product.room_name','body','Email\x20sent\x20successfully','isle','645KQVgMo','filter','$product_details.primary_code','prod_name','</span>','\x20</h2>','toString','logo','render','POnumber','/all_purchases/view','COLD\x20STORAGE','$product_details.product_stock','$note','$name','Room_name','getFullYear','<tr>','actual_uom','Rack\x20B','secondary_code','prod_cat','email','$product_details.floorlevel','invoice','return_data','$maxProdPerUnit','sendMail','/view','Floor','/barcode_scanner','RMSEmail','Receiving\x20Area','<hr\x20class=\x22my-3\x22>','room','prod_Qty','/view/return_purchase/:id','</head><body>','json','/view/add_purchases','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','rack','message','\x20Order\x20Number\x20:\x20','prod_isle','$maxStocks','save','$product_code','<html><head><title></title>','Logo.png','here','German','Router','purchase_quantity','table\x20page','prod_secondunit','10nOfpSo','product_stock','Error\x20Occurs','Sales\x20Update\x20successfully','<tbody\x20style=\x22text-align:\x20center;\x22>','ejs','Purchase\x20Return\x20Mail','Level','push','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details','catch','$product.bay','error','image','\x20<>\x20','user_id','prod_code','584850VNQnuC','Arabic','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','18468GgpGZd','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','all','English','actual_qty','errors','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','warehouse_name','primary_code_hide','<h5>','floorlevel','Chinese','$product_details.pallet','params','prod_unit','$product_details.rack','product_name','</h5>','$expiry_date','Portuguese\x20(BR)','string','INC-','express','$product_details.storage','abs','True','There\x27s\x20a\x20error\x20in\x20this\x20transaction','rak','/view/add_purchases/:id','length','1178450JAZEJt','status','../middleware/auth','delivery_date','flash','Purchase\x20data\x20added\x20successfully','$product_details._id','An\x20error\x20occurred.','warehouse','$suppliers','Rack\x20C','secondary_code_hide','batch_code','date','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/invoice/:id','all_purchases','../models/all_models','language','createTransport','standard_unit','suppliers','forEach','Hindi','63fmOAeF','site_title','$product_details.bay','redirect','609058rLGZqX','bay','prod_primunit','$product.floorlevel','$product_details.maxProducts','findById','$product_details.product_name','date_data','pallet','Rack\x20A','$brand','product_code_hide','room_name','product_code','maxperunit','all_purchases_barcode','post','secondary_unit','exports','expiry_date','prod_level','<!DOCTYPE\x20html>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','map','primary_code','103510gKgusJ','/preview/:id','product_cat','/all_purchases/view/','RoomAssign','alertQTY','$product.bin','prod_invoice','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','type','find','$invoice','slice','888584dCHiNb','getMonth','purchase_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Arabic\x20(ae)','</thead>','$product_details.isle','$warehouse_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','staff','prod_qty','bin','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','maxStocks','max_product_unit','$batch_code','Raw\x20Materials','then','\x20Order\x20Date\x20:\x20','$secondary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','deliverycode','return_purchase','user','prod_pallet','stock_quantity','production_date','JO_number','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product','<strong>\x20Regards\x20</strong>','aggregate','password','level','$suppliers_docs','port','concat','</td>','deliverydate','log','add_purchases\x20error','French','Portuguese','stocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','get','paid_amount'];a0_0x214e=function(){return _0x41509e;};return a0_0x214e();}router[a0_0x43d5a0(0x203)](a0_0x43d5a0(0x264),auth,async(_0x35a7ad,_0x61fc2f)=>{var _0x166134=a0_0x43d5a0;try{const {username:_0x446781,email:_0x32ad3e,role:_0x51fec6}=_0x35a7ad[_0x166134(0x1ed)],_0x3824bc=_0x35a7ad[_0x166134(0x1ed)],_0x519d96=await profile[_0x166134(0x208)]({'email':_0x3824bc[_0x166134(0x253)]}),_0x5620c8=await master_shop['find'](),_0x1cd3d7=await staff['findOne']({'email':_0x3824bc[_0x166134(0x253)]}),_0x389ec5=await suppliers[_0x166134(0x1d2)]({});let _0x1fdc1d;if(_0x3824bc[_0x166134(0x210)]==_0x166134(0x1de)){const _0x3bd2b1=await staff[_0x166134(0x208)]({'email':_0x3824bc[_0x166134(0x253)]});_0x1fdc1d=await warehouse[_0x166134(0x1f5)]([{'$match':{'status':'Enabled','name':_0x3bd2b1[_0x166134(0x199)],'warehouse_category':_0x166134(0x1e6),'name':{'$ne':_0x166134(0x21b)}}},{'$group':{'_id':_0x166134(0x24b),'name':{'$first':_0x166134(0x24b)}}}]);}else _0x1fdc1d=await warehouse[_0x166134(0x1f5)]([{'$match':{'status':_0x166134(0x238),'warehouse_category':_0x166134(0x1e6),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x166134(0x24b),'name':{'$first':'$name'}}}]);const _0x3f29d2=await product['find']({}),_0x1259b1=await warehouse[_0x166134(0x1d2)]({'status':_0x166134(0x238)}),_0x3d97d5=await purchases[_0x166134(0x1d2)]({}),_0x3ea4d2=_0x3d97d5[_0x166134(0x190)]+0x1,_0x3e0da0='INC-'+_0x3ea4d2[_0x166134(0x243)]()['padStart'](0x5,'0');var _0x5552a9=[_0x166134(0x22e),'Enclosed'];if(_0x5620c8[0x0][_0x166134(0x1a5)]==_0x166134(0x227))var _0x4985e9=users[_0x166134(0x28f)];else{if(_0x5620c8[0x0][_0x166134(0x1a5)]=='Hindi')var _0x4985e9=users['Hindi'];else{if(_0x5620c8[0x0][_0x166134(0x1a5)]==_0x166134(0x271))var _0x4985e9=users[_0x166134(0x271)];else{if(_0x5620c8[0x0][_0x166134(0x1a5)]==_0x166134(0x20a))var _0x4985e9=users[_0x166134(0x20a)];else{if(_0x5620c8[0x0][_0x166134(0x1a5)]==_0x166134(0x1ff))var _0x4985e9=users[_0x166134(0x1ff)];else{if(_0x5620c8[0x0][_0x166134(0x1a5)]=='Portuguese\x20(BR)')var _0x4985e9=users[_0x166134(0x200)];else{if(_0x5620c8[0x0][_0x166134(0x1a5)]=='Chinese')var _0x4985e9=users[_0x166134(0x297)];else{if(_0x5620c8[0x0]['language']==_0x166134(0x1d9))var _0x4985e9=users[_0x166134(0x289)];}}}}}}}const _0x2f9aed=getRandom8DigitNumber();_0x2f9aed['then'](_0x1505a6=>{var _0x586df7=_0x166134;_0x61fc2f[_0x586df7(0x245)](_0x586df7(0x211),{'success':_0x35a7ad[_0x586df7(0x195)](_0x586df7(0x265)),'errors':_0x35a7ad['flash'](_0x586df7(0x291)),'role':_0x3824bc,'profile':_0x519d96,'suppliers':_0x389ec5,'warehouse':_0x1fdc1d,'product':_0x3f29d2,'invoice':_0x1505a6,'master_shop':_0x5620c8,'language':_0x4985e9,'find_data':_0x1259b1,'rooms_data':_0x5552a9});})[_0x166134(0x281)](_0x22c714=>{var _0x25acfe=_0x166134;_0x35a7ad[_0x25acfe(0x195)](_0x25acfe(0x291),_0x25acfe(0x18d)),_0x61fc2f['redirect'](_0x25acfe(0x247));});}catch(_0x5327aa){console['log'](_0x5327aa);}}),router[a0_0x43d5a0(0x203)](a0_0x43d5a0(0x18f),auth,async(_0x13ff15,_0x386fc9)=>{var _0x2a9d4e=a0_0x43d5a0;try{const _0x17a7a5=_0x13ff15['params']['id'];console['log'](_0x17a7a5);const _0x1e9828=await master_shop[_0x2a9d4e(0x1d2)]();console[_0x2a9d4e(0x1fd)](_0x2a9d4e(0x224),_0x1e9828);const _0x243813=await product['findOne']({'name':_0x17a7a5});console['log'](_0x2a9d4e(0x213),_0x243813),_0x386fc9['status'](0xc8)[_0x2a9d4e(0x263)]({'product_data':_0x243813,'master':_0x1e9828});}catch(_0x51e5a5){console['log'](_0x2a9d4e(0x1fe),_0x51e5a5);}}),router[a0_0x43d5a0(0x1bf)](a0_0x43d5a0(0x264),auth,async(_0x471a1e,_0x242d54)=>{var _0x1ab6b6=a0_0x43d5a0;try{const {invoice:_0x549a41,date:_0x25558d,warehouse_name:_0x58d7de,prod_name:_0x5623b9,prod_code:_0xfa689d,prod_qty:_0x8b8335,prod_unit:_0x5e33b3,prod_secondunit:_0x129f52,prod_level:_0x3d2db3,prod_isle:_0x5dcab6,prod_pallet:_0x40e9ed,note:_0x5c8240,expiry_date:_0x2bf20d,batch_code:_0x1c208e,payable:_0x4fe4cc,due_amount:_0x1262b4,Room_name:_0x11fe00,primary_code:_0x36b0c5,secondary_code:_0x4c4419,MaxStocks_data:_0x5dce29,PO_number:_0x2115e5,SCRN:_0x2e6ee2,JO_number:_0xa3d2b3}=_0x471a1e['body'];if(typeof _0x5623b9=='string')var _0x57dc9a=[_0x471a1e['body'][_0x1ab6b6(0x240)]],_0x4799f9=[_0x471a1e[_0x1ab6b6(0x23a)]['prod_code']],_0x73a118=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x260)]],_0x2ee791=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1b1)]],_0x26c8b0=[_0x471a1e[_0x1ab6b6(0x23a)]['prod_secondunit']],_0x2b3b0c=[_0x471a1e[_0x1ab6b6(0x23a)]['prod_level']],_0x5a110d=[_0x471a1e[_0x1ab6b6(0x23a)]['primary_code']],_0x245983=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x251)]],_0x4c97a0=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x205)]],_0x3ca656=[_0x471a1e[_0x1ab6b6(0x23a)]['batch_code']],_0x47eab2=[_0x471a1e['body'][_0x1ab6b6(0x1c2)]],_0x488c31=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1e4)]],_0x279ca4=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1cd)]],_0x4eaf17=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1f0)]],_0x159687=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x252)]],_0x507698=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1cc)]],_0x1d5095=[_0x471a1e['body'][_0x1ab6b6(0x1eb)]],_0x171153=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1cf)]],_0x34fce5=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x290)]],_0x2dd14e=[_0x471a1e[_0x1ab6b6(0x23a)]['actual_uom']],_0x52e6e5=[_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1fc)]];else var _0x57dc9a=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x240)]],_0x4799f9=[..._0x471a1e[_0x1ab6b6(0x23a)]['prod_code']],_0x73a118=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x260)]],_0x2ee791=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1b1)]],_0x26c8b0=[..._0x471a1e['body']['prod_secondunit']],_0x2b3b0c=[..._0x471a1e['body'][_0x1ab6b6(0x1c3)]],_0x5a110d=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1c7)]],_0x245983=[..._0x471a1e['body']['secondary_code']],_0x4c97a0=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x205)]],_0x3ca656=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x19d)]],_0x47eab2=[..._0x471a1e[_0x1ab6b6(0x23a)]['expiry_date']],_0x488c31=[..._0x471a1e[_0x1ab6b6(0x23a)]['max_product_unit']],_0x279ca4=[..._0x471a1e['body'][_0x1ab6b6(0x1cd)]],_0x4eaf17=[..._0x471a1e['body'][_0x1ab6b6(0x1f0)]],_0x159687=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x252)]],_0x507698=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1cc)]],_0x1d5095=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1eb)]],_0x171153=[..._0x471a1e['body'][_0x1ab6b6(0x1cf)]],_0x34fce5=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x290)]],_0x2dd14e=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x24f)]],_0x52e6e5=[..._0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1fc)]];const _0x568027=_0x57dc9a[_0x1ab6b6(0x1c6)](_0x4e1c9f=>{return _0x4e1c9f={'product_name':_0x4e1c9f};});_0x34fce5['forEach']((_0x5700ce,_0x3b453e)=>{var _0x41dbeb=_0x1ab6b6;_0x568027[_0x3b453e][_0x41dbeb(0x290)]=Math[_0x41dbeb(0x18b)](_0x5700ce);}),_0x2dd14e[_0x1ab6b6(0x1a9)]((_0x123831,_0x224c51)=>{_0x568027[_0x224c51]['actual_uom']=_0x123831;}),_0x4799f9[_0x1ab6b6(0x1a9)]((_0x439959,_0xc9d4f)=>{var _0x4ddddf=_0x1ab6b6;_0x568027[_0xc9d4f]['product_code']=_0x439959,_0x568027[_0xc9d4f][_0x4ddddf(0x1b6)]=_0x25558d;}),_0x73a118[_0x1ab6b6(0x1a9)]((_0x5de5cc,_0x38565f)=>{var _0x306c8e=_0x1ab6b6;_0x568027[_0x38565f]['quantity']=Math[_0x306c8e(0x18b)](_0x5de5cc);}),_0x2ee791[_0x1ab6b6(0x1a9)]((_0x23d0b1,_0x1e6d9b)=>{var _0x33785f=_0x1ab6b6;_0x568027[_0x1e6d9b][_0x33785f(0x1a7)]=_0x23d0b1;}),_0x26c8b0[_0x1ab6b6(0x1a9)]((_0x11e114,_0x10057a)=>{var _0x507de7=_0x1ab6b6;_0x568027[_0x10057a][_0x507de7(0x1c0)]=_0x11e114;}),_0x2b3b0c['forEach']((_0x13f766,_0x2885ba)=>{_0x507698['forEach']((_0x5a595,_0x19ad7a)=>{var _0x1f764a=a0_0x52e0;if(_0x5a595==_0x1f764a(0x25d)&&_0x2885ba==_0x19ad7a){console[_0x1f764a(0x1fd)](_0x5a595+'\x20<\x20wew\x20>\x20'+_0x2885ba+_0x1f764a(0x285)+_0x19ad7a+_0x1f764a(0x285)+_0x13f766);var _0x4e39b2=_0x13f766['slice'](0x3);_0x568027[_0x2885ba][_0x1f764a(0x215)]=_0x13f766[0x0],_0x568027[_0x2885ba][_0x1f764a(0x267)]=_0x13f766[0x1],_0x568027[_0x2885ba]['bay']=0x0,_0x568027[_0x2885ba][_0x1f764a(0x1e0)]=0x0,_0x568027[_0x2885ba][_0x1f764a(0x1d1)]=_0x1f764a(0x25a),_0x568027[_0x2885ba]['floorlevel']=_0x4e39b2;}else{if(_0x5a595=='Shelves'&&_0x2885ba==_0x19ad7a){var _0x4e39b2=_0x13f766[_0x1f764a(0x1d4)](0x3);_0x568027[_0x2885ba][_0x1f764a(0x215)]=_0x13f766[0x0],_0x568027[_0x2885ba]['rack']=_0x13f766[0x1],_0x568027[_0x2885ba][_0x1f764a(0x1b0)]=0x0,_0x568027[_0x2885ba][_0x1f764a(0x1e0)]=0x0,_0x568027[_0x2885ba][_0x1f764a(0x1d1)]='Floor',_0x568027[_0x2885ba]['floorlevel']=_0x13f766[0x5];}else{if(_0x2885ba==_0x19ad7a){if(_0x13f766[0x0]=='A'&&_0x13f766[0x1]=='L'&&_0x13f766[0x2]=='L')console['log'](_0x5a595+_0x1f764a(0x285)+_0x2885ba+_0x1f764a(0x285)+_0x19ad7a+_0x1f764a(0x285)+_0x13f766+_0x1f764a(0x270)),_0x568027[_0x2885ba][_0x1f764a(0x215)]=_0x13f766[0x0],_0x568027[_0x2885ba]['rack']=_0x13f766[0x1],_0x568027[_0x2885ba][_0x1f764a(0x1b0)]=0x0,_0x568027[_0x2885ba][_0x1f764a(0x1e0)]=0x0,_0x568027[_0x2885ba][_0x1f764a(0x1d1)]='Floor',_0x568027[_0x2885ba][_0x1f764a(0x296)]=_0x13f766[0x3];else{var _0x230753;if(_0x13f766[0x4]=='L')_0x230753=_0x1f764a(0x27d);else _0x13f766[0x4]=='F'&&(_0x230753=_0x1f764a(0x25a));_0x568027[_0x2885ba][_0x1f764a(0x215)]=_0x13f766[0x0],_0x568027[_0x2885ba][_0x1f764a(0x267)]=_0x13f766[0x1],_0x568027[_0x2885ba]['bay']=_0x13f766[0x2],_0x568027[_0x2885ba][_0x1f764a(0x1e0)]=_0x13f766[0x3],_0x568027[_0x2885ba][_0x1f764a(0x1d1)]=_0x230753,_0x568027[_0x2885ba]['floorlevel']=_0x13f766[0x5];}}}}});}),_0x5a110d['forEach']((_0x26e84d,_0x3dc23a)=>{_0x568027[_0x3dc23a]['primary_code']=_0x26e84d;}),_0x245983[_0x1ab6b6(0x1a9)]((_0x4ad1a0,_0x5c684a)=>{var _0x1004df=_0x1ab6b6;_0x568027[_0x5c684a][_0x1004df(0x251)]=_0x4ad1a0;}),_0x4c97a0[_0x1ab6b6(0x1a9)]((_0x31c5a1,_0x23363b)=>{var _0x1837ca=_0x1ab6b6;_0x568027[_0x23363b][_0x1837ca(0x1e3)]=_0x31c5a1;}),_0x3ca656[_0x1ab6b6(0x1a9)]((_0x202780,_0x28cb72)=>{var _0x5b3143=_0x1ab6b6;_0x568027[_0x28cb72][_0x5b3143(0x19d)]=_0x202780;}),_0x47eab2[_0x1ab6b6(0x1a9)]((_0x22237f,_0xc4e0d8)=>{var _0x3f4a56=_0x1ab6b6;_0x568027[_0xc4e0d8][_0x3f4a56(0x1c2)]=_0x22237f;}),_0x488c31['forEach']((_0x6757f9,_0x5c111b)=>{var _0x584753=_0x1ab6b6;_0x568027[_0x5c111b][_0x584753(0x1bd)]=_0x6757f9;}),_0x279ca4[_0x1ab6b6(0x1a9)]((_0xe17079,_0x545c6e)=>{var _0x510704=_0x1ab6b6;_0x568027[_0x545c6e][_0x510704(0x1cd)]=_0xe17079;}),_0x4eaf17[_0x1ab6b6(0x1a9)]((_0x6e26bd,_0x326a58)=>{var _0x22b5c6=_0x1ab6b6;_0x568027[_0x326a58][_0x22b5c6(0x1f0)]=_0x6e26bd;}),_0x159687[_0x1ab6b6(0x1a9)]((_0x20316b,_0x103c68)=>{_0x568027[_0x103c68]['product_cat']=_0x20316b;}),_0x507698[_0x1ab6b6(0x1a9)]((_0x1ee45f,_0x56184d)=>{var _0x5ad330=_0x1ab6b6;_0x568027[_0x56184d][_0x5ad330(0x1bb)]=_0x1ee45f;}),_0x52e6e5[_0x1ab6b6(0x1a9)]((_0x5d2442,_0x1409b5)=>{_0x568027[_0x1409b5]['delivery_date']=_0x5d2442;}),_0x1d5095[_0x1ab6b6(0x1a9)]((_0x53acba,_0x21794c)=>{var _0x3c6bbf=_0x1ab6b6;_0x568027[_0x21794c][_0x3c6bbf(0x226)]=_0x53acba;}),_0x171153[_0x1ab6b6(0x1a9)]((_0x3732ce,_0x5f307f)=>{_0x568027[_0x5f307f]['invoice']=_0x3732ce;});const _0x2f9f4e=_0x507698[_0x1ab6b6(0x1c6)](_0x53cbf1=>{return _0x53cbf1={'room_name':_0x53cbf1};}),_0x4f5581=_0x568027[_0x1ab6b6(0x23e)](_0x30d0bc=>_0x30d0bc[_0x1ab6b6(0x237)]!=='0'&&_0x30d0bc[_0x1ab6b6(0x237)]!==''),_0x2417bd=new purchases({'invoice':_0x549a41,'suppliers':_0x471a1e[_0x1ab6b6(0x23a)][_0x1ab6b6(0x1a8)],'date':_0x25558d,'warehouse_name':_0x58d7de,'product':_0x4f5581,'note':_0x5c8240,'due_amount':_0x1262b4,'POnumber':_0x2115e5,'SCRN':_0x2e6ee2,'JO_number':_0xa3d2b3,'roomList':_0x2f9f4e}),_0x19d767=await _0x2417bd['save'](),_0x94e2a2=await purchases[_0x1ab6b6(0x208)]({'invoice':_0x549a41}),_0x12ab76=_0x94e2a2['product'][_0x1ab6b6(0x1c6)](async _0x548d5b=>{var _0x557d8b=_0x1ab6b6,_0x4963dc=await warehouse[_0x557d8b(0x208)]({'name':_0x58d7de,'room':_0x548d5b['room_name']}),_0x5ee0f1=0x0;return _0x4963dc[_0x557d8b(0x222)][_0x557d8b(0x1a9)](_0x49fc25=>{var _0x52a506=_0x557d8b;_0x49fc25['product_name']==_0x548d5b['product_name']&&_0x49fc25['floorlevel']==_0x548d5b[_0x52a506(0x296)]&&_0x49fc25[_0x52a506(0x1d1)]==_0x548d5b['type']&&_0x49fc25[_0x52a506(0x1e0)]==_0x548d5b[_0x52a506(0x1e0)]&&_0x49fc25['bay']==_0x548d5b[_0x52a506(0x1b0)]&&_0x49fc25[_0x52a506(0x267)]==_0x548d5b[_0x52a506(0x267)]&&_0x49fc25[_0x52a506(0x215)]==_0x548d5b[_0x52a506(0x215)]&&_0x49fc25[_0x52a506(0x1c2)]==_0x548d5b['expiry_date']&&_0x49fc25[_0x52a506(0x19d)]==_0x548d5b[_0x52a506(0x19d)]&&_0x49fc25[_0x52a506(0x1f0)]==_0x548d5b[_0x52a506(0x1f0)]&&_0x49fc25[_0x52a506(0x255)]==_0x94e2a2['invoice']&&(_0x49fc25[_0x52a506(0x277)]+=Math[_0x52a506(0x18b)](_0x548d5b[_0x52a506(0x237)]),_0x5ee0f1++);}),_0x5ee0f1===0x0&&_0x4963dc[_0x557d8b(0x222)][_0x557d8b(0x27e)]({'product_name':_0x548d5b[_0x557d8b(0x29c)],'product_stock':Math[_0x557d8b(0x18b)](_0x548d5b[_0x557d8b(0x237)]),'primary_code':_0x548d5b[_0x557d8b(0x1c7)],'secondary_code':_0x548d5b['secondary_code'],'product_code':_0x548d5b[_0x557d8b(0x1bc)],'storage':_0x548d5b[_0x557d8b(0x215)],'rack':_0x548d5b[_0x557d8b(0x267)],'bay':_0x548d5b['bay'],'bin':_0x548d5b[_0x557d8b(0x1e0)],'type':_0x548d5b[_0x557d8b(0x1d1)],'floorlevel':_0x548d5b['floorlevel'],'maxProducts':_0x548d5b[_0x557d8b(0x1e3)],'unit':_0x548d5b[_0x557d8b(0x1a7)],'secondary_unit':_0x548d5b[_0x557d8b(0x1c0)],'expiry_date':_0x548d5b['expiry_date'],'maxPerUnit':_0x548d5b[_0x557d8b(0x1bd)],'batch_code':_0x548d5b[_0x557d8b(0x19d)],'alertQTY':_0x548d5b['alertQTY'],'production_date':_0x548d5b[_0x557d8b(0x1f0)],'product_cat':_0x548d5b[_0x557d8b(0x1ca)],'invoice':_0x548d5b[_0x557d8b(0x255)],'actual_qty':Math[_0x557d8b(0x18b)](_0x548d5b[_0x557d8b(0x290)]),'actual_uom':_0x548d5b[_0x557d8b(0x24f)],'delivery_date':_0x548d5b['delivery_date'],'delivery_code':_0x548d5b[_0x557d8b(0x226)]}),_0x4963dc;});Promise[_0x1ab6b6(0x28e)](_0x12ab76)[_0x1ab6b6(0x1e7)](async _0x478bff=>{var _0x32abe=_0x1ab6b6;try{for(const _0xde707 of _0x478bff){await _0xde707[_0x32abe(0x26c)]();}const _0x45ca88=await master_shop[_0x32abe(0x1d2)](),_0x58ffbb=await email_settings[_0x32abe(0x208)](),_0x39eb70=await supervisor_settings['find']();var _0x3836b6=_0x94e2a2[_0x32abe(0x213)],_0x2f4c51='',_0x2d1db3;for(_0x2d1db3 in _0x3836b6){_0x2f4c51+=_0x32abe(0x24e)+_0x32abe(0x292)+_0x3836b6[_0x2d1db3]['product_name']+_0x32abe(0x1fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3836b6[_0x2d1db3][_0x32abe(0x1bc)]+'</td>'+_0x32abe(0x292)+_0x3836b6[_0x2d1db3][_0x32abe(0x237)]+'</td>'+_0x32abe(0x292)+_0x3836b6[_0x2d1db3][_0x32abe(0x1a7)]+_0x32abe(0x1fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3836b6[_0x2d1db3][_0x32abe(0x1c0)]+'</td>'+_0x32abe(0x292)+_0x94e2a2[_0x32abe(0x293)]+_0x32abe(0x1fb)+_0x32abe(0x292)+_0x3836b6[_0x2d1db3][_0x32abe(0x1bb)]+_0x32abe(0x1fb)+_0x32abe(0x292)+_0x3836b6[_0x2d1db3][_0x32abe(0x215)]+_0x3836b6[_0x2d1db3][_0x32abe(0x267)]+_0x3836b6[_0x2d1db3][_0x32abe(0x1b0)]+_0x3836b6[_0x2d1db3][_0x32abe(0x1e0)]+_0x3836b6[_0x2d1db3][_0x32abe(0x1d1)][0x0]+_0x3836b6[_0x2d1db3]['floorlevel']+_0x32abe(0x1fb),_0x32abe(0x230);}let _0x4c8b0f=nodemailer[_0x32abe(0x1a6)]({'host':_0x58ffbb['host'],'port':Number(_0x58ffbb[_0x32abe(0x1f9)]),'secure':![],'auth':{'user':_0x58ffbb[_0x32abe(0x253)],'pass':_0x58ffbb[_0x32abe(0x1f6)]}}),_0x2fa4be={'from':_0x58ffbb[_0x32abe(0x253)],'to':_0x39eb70[0x0][_0x32abe(0x25c)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x32abe(0x26f),'path':__dirname+_0x32abe(0x206)+_0x32abe(0x234)+_0x45ca88[0x0]['image'],'cid':_0x32abe(0x244)}],'html':'<!DOCTYPE\x20html>'+_0x32abe(0x26e)+'</head><body>'+'<div>'+_0x32abe(0x1dd)+_0x32abe(0x21e)+_0x32abe(0x1f2)+_0x32abe(0x20d)+_0x32abe(0x21e)+'<h2>\x20'+_0x45ca88[0x0]['site_title']+_0x32abe(0x242)+_0x32abe(0x20d)+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x32abe(0x27f)+_0x32abe(0x269)+_0x94e2a2[_0x32abe(0x255)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x32abe(0x1e8)+_0x94e2a2[_0x32abe(0x19e)]+'\x20'+_0x32abe(0x241)+_0x32abe(0x29d)+_0x32abe(0x20d)+_0x32abe(0x1c5)+_0x32abe(0x1a1)+'<tr>'+_0x32abe(0x1e2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x32abe(0x1a0)+_0x32abe(0x28b)+_0x32abe(0x266)+_0x32abe(0x221)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x32abe(0x230)+'</thead>'+_0x32abe(0x27a)+'\x20'+_0x2f4c51+'\x20'+'</tbody>'+'</table>'+_0x32abe(0x21e)+_0x32abe(0x1f4)+'<h5>'+_0x45ca88[0x0]['site_title']+_0x32abe(0x29d)+_0x32abe(0x20d)+'</div>'+_0x32abe(0x217)};_0x4c8b0f[_0x32abe(0x258)](_0x2fa4be,function(_0x1cfcfe,_0x28b819){var _0x4140fb=_0x32abe;_0x1cfcfe?(console['log'](_0x1cfcfe),console[_0x4140fb(0x1fd)](_0x4140fb(0x278))):console[_0x4140fb(0x1fd)]('Email\x20sent\x20successfully');}),_0x471a1e[_0x32abe(0x195)]('success',_0x32abe(0x196)),_0x242d54[_0x32abe(0x1ae)](_0x32abe(0x1cb));}catch(_0x12a7e1){console[_0x32abe(0x283)](_0x12a7e1),_0x242d54[_0x32abe(0x192)](0x1f4)['json']({'error':_0x32abe(0x1ea)});}})[_0x1ab6b6(0x281)](_0x15ebc3=>{var _0x1c8334=_0x1ab6b6;console[_0x1c8334(0x283)](_0x15ebc3),_0x242d54[_0x1c8334(0x192)](0x1f4)[_0x1c8334(0x263)]({'error':_0x1c8334(0x198)});});}catch(_0xa0809a){console[_0x1ab6b6(0x1fd)](_0xa0809a);}}),router[a0_0x43d5a0(0x203)](a0_0x43d5a0(0x1c9),auth,async(_0x210934,_0x36941d)=>{var _0x35024f=a0_0x43d5a0;try{const {username:_0x1970e3,email:_0x16b451,role:_0x1ee560}=_0x210934[_0x35024f(0x1ed)],_0x5d13ed=_0x210934[_0x35024f(0x1ed)],_0x5e9472=await profile[_0x35024f(0x208)]({'email':_0x5d13ed['email']}),_0x3fb1fd=await master_shop[_0x35024f(0x1d2)](),_0x288a06=_0x210934['params']['id'],_0x32a4f6=await purchases[_0x35024f(0x1b4)](_0x288a06),_0x331653=await warehouse['aggregate']([{'$match':{'name':_0x32a4f6['warehouse_name'],'room':_0x32a4f6[_0x35024f(0x25f)]}},{'$unwind':_0x35024f(0x280)},{'$group':{'_id':_0x35024f(0x197),'name':{'$first':_0x35024f(0x1b5)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x35024f(0x1ad)},'bin':{'$first':_0x35024f(0x229)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x35024f(0x254)},'primary_code':{'$first':_0x35024f(0x23f)},'secondary_code':{'$first':_0x35024f(0x20b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x35024f(0x2a3)},'rack':{'$first':_0x35024f(0x29b)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x5a733e=await customer[_0x35024f(0x1d2)]({});let _0x3ff974;if(_0x5d13ed[_0x35024f(0x210)]==_0x35024f(0x1de)){const _0xfdcf7c=await staff[_0x35024f(0x208)]({'email':_0x5d13ed[_0x35024f(0x253)]});_0x3ff974=await warehouse['aggregate']([{'$match':{'status':_0x35024f(0x238),'name':_0xfdcf7c[_0x35024f(0x199)]}},{'$group':{'_id':_0x35024f(0x24b),'name':{'$first':'$name'}}}]);}else _0x3ff974=await warehouse['aggregate']([{'$match':{'status':_0x35024f(0x238)}},{'$group':{'_id':'$name','name':{'$first':_0x35024f(0x24b)}}}]);const _0x452fa4=await product[_0x35024f(0x1d2)]({}),_0x4b743c=await suppliers[_0x35024f(0x1d2)]({}),_0x3baab3=BayBinSelected(_0x32a4f6['warehouse_name'],_0x32a4f6['room']);if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]==_0x35024f(0x227)){var _0x4d6edb=users['English'];console[_0x35024f(0x1fd)](_0x4d6edb);}else{if(_0x3fb1fd[0x0]['language']==_0x35024f(0x1aa))var _0x4d6edb=users['Hindi'];else{if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]==_0x35024f(0x271))var _0x4d6edb=users[_0x35024f(0x271)];else{if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]==_0x35024f(0x20a))var _0x4d6edb=users['Spanish'];else{if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]==_0x35024f(0x1ff))var _0x4d6edb=users['French'];else{if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]==_0x35024f(0x29f))var _0x4d6edb=users[_0x35024f(0x200)];else{if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]==_0x35024f(0x297))var _0x4d6edb=users['Chinese'];else{if(_0x3fb1fd[0x0][_0x35024f(0x1a5)]=='Arabic\x20(ae)')var _0x4d6edb=users[_0x35024f(0x289)];}}}}}}}_0x36941d[_0x35024f(0x245)]('edit_purchases_view',{'success':_0x210934[_0x35024f(0x195)](_0x35024f(0x265)),'errors':_0x210934[_0x35024f(0x195)]('errors'),'role':_0x5d13ed,'profile':_0x5e9472,'customer':_0x5a733e,'warehouse':_0x3ff974,'product':_0x331653,'user':_0x32a4f6,'master_shop':_0x3fb1fd,'unit':_0x452fa4,'language':_0x4d6edb,'suppliers':_0x4b743c,'dataSelected':_0x3baab3});}catch(_0x366fc0){console[_0x35024f(0x1fd)](_0x366fc0);}}),router['post'](a0_0x43d5a0(0x1c9),auth,async(_0x31bf24,_0x444165)=>{var _0x59a96f=a0_0x43d5a0;try{const _0x248f98=_0x31bf24['params']['id'],{invoice:_0x56276e,warehouse_name:_0x57a438,Room_name:_0x5e0735}=_0x31bf24[_0x59a96f(0x23a)],_0x534b0e=await warehouse[_0x59a96f(0x208)]({'name':_0x57a438,'room':_0x5e0735}),_0x54f89c=await purchases[_0x59a96f(0x208)]({'invoice':_0x56276e});_0x54f89c[_0x59a96f(0x213)]['forEach'](_0x5dd87e=>{var _0x48fea8=_0x59a96f,_0x3ab4ab=0x0;const _0x5a4f1d=_0x534b0e['product_details'][_0x48fea8(0x1c6)](_0x4e680a=>{var _0x574656=_0x48fea8;_0x4e680a[_0x574656(0x29c)]==_0x5dd87e['product_name']&&_0x4e680a[_0x574656(0x296)]==_0x5dd87e['floorlevel']&&_0x4e680a[_0x574656(0x1d1)]==_0x5dd87e[_0x574656(0x1d1)]&&_0x4e680a[_0x574656(0x1e0)]==_0x5dd87e[_0x574656(0x1e0)]&&_0x4e680a[_0x574656(0x1b0)]==_0x5dd87e[_0x574656(0x1b0)]&&_0x4e680a[_0x574656(0x267)]==_0x5dd87e[_0x574656(0x267)]&&_0x4e680a[_0x574656(0x215)]==_0x5dd87e['storage']&&_0x4e680a[_0x574656(0x1c2)]==_0x5dd87e[_0x574656(0x1c2)]&&_0x4e680a[_0x574656(0x19d)]==_0x5dd87e[_0x574656(0x19d)]&&_0x4e680a[_0x574656(0x1f0)]==_0x5dd87e[_0x574656(0x1f0)]&&_0x4e680a[_0x574656(0x194)]==_0x5dd87e[_0x574656(0x194)]&&_0x4e680a[_0x574656(0x226)]==_0x5dd87e[_0x574656(0x226)]&&(_0x4e680a['product_stock']=parseInt(_0x4e680a[_0x574656(0x277)])+parseInt(_0x5dd87e[_0x574656(0x237)]),_0x3ab4ab++);});_0x3ab4ab=='0'&&(_0x534b0e[_0x48fea8(0x222)]=_0x534b0e[_0x48fea8(0x222)][_0x48fea8(0x1fa)]({'product_name':_0x5dd87e[_0x48fea8(0x29c)],'product_stock':_0x5dd87e[_0x48fea8(0x237)],'primary_code':_0x5dd87e['primary_code'],'secondary_code':_0x5dd87e[_0x48fea8(0x251)],'product_code':_0x5dd87e['product_code'],'storage':_0x5dd87e[_0x48fea8(0x215)],'rack':_0x5dd87e[_0x48fea8(0x267)],'bay':_0x5dd87e['bay'],'bin':_0x5dd87e[_0x48fea8(0x1e0)],'type':_0x5dd87e[_0x48fea8(0x1d1)],'floorlevel':_0x5dd87e['floorlevel'],'maxProducts':_0x5dd87e[_0x48fea8(0x1e3)],'unit':_0x5dd87e[_0x48fea8(0x1a7)],'secondary_unit':_0x5dd87e[_0x48fea8(0x1c0)],'expiry_date':_0x5dd87e[_0x48fea8(0x1c2)],'maxPerUnit':_0x5dd87e[_0x48fea8(0x1bd)],'batch_code':_0x5dd87e[_0x48fea8(0x19d)],'alertQTY':_0x5dd87e[_0x48fea8(0x1cd)],'production_date':_0x5dd87e['production_date'],'delivery_date':_0x5dd87e[_0x48fea8(0x194)],'delivery_code':_0x5dd87e[_0x48fea8(0x226)]}));}),await _0x534b0e[_0x59a96f(0x26c)](),_0x54f89c[_0x59a96f(0x21d)]=_0x59a96f(0x18c);const _0x253775=await _0x54f89c[_0x59a96f(0x26c)]();_0x31bf24[_0x59a96f(0x195)](_0x59a96f(0x265),_0x59a96f(0x279)),_0x444165[_0x59a96f(0x1ae)]('/all_purchases/view');}catch(_0x72ff51){console['log'](_0x72ff51);}}),router[a0_0x43d5a0(0x203)](a0_0x43d5a0(0x219),auth,async(_0x1b6b02,_0x38b30d)=>{var _0x553da3=a0_0x43d5a0;try{const {username:_0x107d46,email:_0x5c68c7,role:_0xb281ec}=_0x1b6b02[_0x553da3(0x1ed)],_0x38c9bd=_0x1b6b02[_0x553da3(0x1ed)],_0x30d390=await profile[_0x553da3(0x208)]({'email':_0x38c9bd[_0x553da3(0x253)]}),_0x1ff0c3=await master_shop[_0x553da3(0x1d2)](),_0x380b5c=_0x1b6b02[_0x553da3(0x299)]['id'],_0x40bd36=await purchases[_0x553da3(0x1b4)](_0x380b5c),_0x25373b=await suppliers['find']({});let _0x9dad3d;if(_0x38c9bd['role']=='staff'){const _0x250bda=await staff['findOne']({'email':_0x38c9bd['email']});_0x9dad3d=await warehouse[_0x553da3(0x1d2)]({'status':_0x553da3(0x238),'name':_0x250bda['warehouse'],'warehouse_category':_0x553da3(0x1e6)});}else _0x9dad3d=await warehouse[_0x553da3(0x1f5)]([{'$match':{'status':'Enabled','warehouse_category':_0x553da3(0x1e6)}},{'$group':{'_id':_0x553da3(0x24b),'name':{'$first':_0x553da3(0x24b)}}}]);const _0x4c40f7=await product['find']({}),_0x1af2ef=BayBinSelected(_0x40bd36[_0x553da3(0x293)],_0x40bd36['room']);let _0x2a7b4e=new Date(_0x40bd36[_0x553da3(0x1c2)]),_0x36cb8e=('0'+_0x2a7b4e['getDate']())[_0x553da3(0x1d4)](-0x2),_0x26f973=('0'+(_0x2a7b4e['getMonth']()+0x1))[_0x553da3(0x1d4)](-0x2),_0x3f3efd=_0x2a7b4e[_0x553da3(0x24d)](),_0x3fa8c4=_0x3f3efd+'-'+_0x26f973+'-'+_0x36cb8e;if(_0x1ff0c3[0x0][_0x553da3(0x1a5)]==_0x553da3(0x227)){var _0x24a482=users[_0x553da3(0x28f)];console['log'](_0x24a482);}else{if(_0x1ff0c3[0x0][_0x553da3(0x1a5)]==_0x553da3(0x1aa))var _0x24a482=users['Hindi'];else{if(_0x1ff0c3[0x0][_0x553da3(0x1a5)]==_0x553da3(0x271))var _0x24a482=users[_0x553da3(0x271)];else{if(_0x1ff0c3[0x0][_0x553da3(0x1a5)]==_0x553da3(0x20a))var _0x24a482=users[_0x553da3(0x20a)];else{if(_0x1ff0c3[0x0][_0x553da3(0x1a5)]=='French')var _0x24a482=users['French'];else{if(_0x1ff0c3[0x0]['language']==_0x553da3(0x29f))var _0x24a482=users[_0x553da3(0x200)];else{if(_0x1ff0c3[0x0][_0x553da3(0x1a5)]==_0x553da3(0x297))var _0x24a482=users[_0x553da3(0x297)];else{if(_0x1ff0c3[0x0]['language']==_0x553da3(0x1d9))var _0x24a482=users['Arabic'];}}}}}}}_0x38b30d[_0x553da3(0x245)](_0x553da3(0x21a),{'success':_0x1b6b02['flash'](_0x553da3(0x265)),'errors':_0x1b6b02['flash'](_0x553da3(0x291)),'role':_0x38c9bd,'profile':_0x30d390,'purchases':_0x40bd36,'suppliers':_0x25373b,'warehouse':_0x9dad3d,'product':_0x4c40f7,'master_shop':_0x1ff0c3,'language':_0x24a482,'ed_fullDate':_0x3fa8c4,'dataSelected':_0x1af2ef});}catch(_0x49f283){console['log'](_0x49f283);}}),router[a0_0x43d5a0(0x1bf)](a0_0x43d5a0(0x219),auth,async(_0x5a467e,_0x4b9a67)=>{var _0x43a7c1=a0_0x43d5a0;try{const _0xf1f2e8=_0x5a467e[_0x43a7c1(0x299)]['id'],_0x2873e5=await purchases[_0x43a7c1(0x208)]({'_id':_0x5a467e[_0x43a7c1(0x299)]['id']}),_0x2ff990=await warehouse[_0x43a7c1(0x208)]({'name':_0x2873e5['warehouse_name'],'room':_0x2873e5[_0x43a7c1(0x25f)]});_0x2873e5[_0x43a7c1(0x213)][_0x43a7c1(0x1a9)](_0x2b2b2c=>{const _0x53d2c3=_0x2ff990['product_details']['map'](_0x486a56=>{var _0x1b81c9=a0_0x52e0;_0x486a56[_0x1b81c9(0x29c)]==_0x2b2b2c[_0x1b81c9(0x29c)]&&_0x486a56[_0x1b81c9(0x296)]==_0x2b2b2c[_0x1b81c9(0x296)]&&_0x486a56[_0x1b81c9(0x1d1)]==_0x2b2b2c[_0x1b81c9(0x1d1)]&&_0x486a56[_0x1b81c9(0x1e0)]==_0x2b2b2c[_0x1b81c9(0x1e0)]&&_0x486a56['bay']==_0x2b2b2c['bay']&&_0x486a56[_0x1b81c9(0x267)]==_0x2b2b2c[_0x1b81c9(0x267)]&&_0x486a56[_0x1b81c9(0x215)]==_0x2b2b2c[_0x1b81c9(0x215)]&&(_0x486a56[_0x1b81c9(0x277)]=parseInt(_0x486a56['product_stock'])-parseInt(_0x2b2b2c['quantity']));});}),await _0x2ff990[_0x43a7c1(0x26c)]();const {invoice:_0x4bd646,suppliers:_0x49f593,date:_0x17b769,warehouse_name:_0x164809,prod_name:_0x4463ab,prod_code:_0x567653,prod_qty:_0x1b1d07,prod_unit:_0x57c2d8,prod_secondunit:_0x14ec31,prod_level:_0x31ba3a,prod_isle:_0xe4d590,prod_pallet:_0x367742,note:_0x338922,expiry_date:_0x12e73c,batch_code:_0x104369,paid_amount:_0x4ce270,due_amount:_0x4e4333,Room_name:_0x2cc30b,primary_code:_0x86d0d6,secondary_code:_0x2b43b1,PO_number:_0x2a8cee,JO_number:_0x1c4c68}=_0x5a467e[_0x43a7c1(0x23a)];if(typeof _0x4463ab==_0x43a7c1(0x2a0))var _0x2d19ed=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x240)]],_0x44f7d0=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x287)]],_0x4f2326=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1df)]],_0x2c5b47=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x29a)]],_0x2af2ee=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x275)]],_0x514976=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1c3)]],_0x450040=[_0x5a467e[_0x43a7c1(0x23a)]['prod_isle']],_0x5cad14=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1ee)]],_0x3031ee=[_0x5a467e[_0x43a7c1(0x23a)]['primary_code']],_0xd8fdc7=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x251)]],_0x333cb2=[_0x5a467e['body']['MaxStocks_data']],_0x6071e7=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x19d)]],_0x5b7739=[_0x5a467e[_0x43a7c1(0x23a)]['expiry_date']],_0x2957eb=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x215)]],_0x39978b=[_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x18e)]],_0x30d80c=[_0x5a467e[_0x43a7c1(0x23a)]['type']];else var _0x2d19ed=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x240)]],_0x44f7d0=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x287)]],_0x4f2326=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1df)]],_0x2c5b47=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x29a)]],_0x2af2ee=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x275)]],_0x514976=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1c3)]],_0x450040=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x26a)]],_0x5cad14=[..._0x5a467e[_0x43a7c1(0x23a)]['prod_pallet']],_0x3031ee=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1c7)]],_0xd8fdc7=[..._0x5a467e['body'][_0x43a7c1(0x251)]],_0x333cb2=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x205)]],_0x6071e7=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x19d)]],_0x5b7739=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1c2)]],_0x2957eb=[..._0x5a467e[_0x43a7c1(0x23a)]['storage']],_0x39978b=[..._0x5a467e['body'][_0x43a7c1(0x18e)]],_0x30d80c=[..._0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1d1)]];const _0x382f3b=_0x2d19ed[_0x43a7c1(0x1c6)](_0x2e3f99=>{return _0x2e3f99={'product_name':_0x2e3f99};});_0x44f7d0[_0x43a7c1(0x1a9)]((_0x3bc503,_0x28232e)=>{var _0x2c02e0=_0x43a7c1;_0x382f3b[_0x28232e][_0x2c02e0(0x1bc)]=_0x3bc503;}),_0x4f2326[_0x43a7c1(0x1a9)]((_0x5a1c1b,_0x8e0c83)=>{var _0x56c681=_0x43a7c1;_0x382f3b[_0x8e0c83][_0x56c681(0x237)]=_0x5a1c1b;}),_0x2c5b47[_0x43a7c1(0x1a9)]((_0xcbb30e,_0x45f34f)=>{var _0x211680=_0x43a7c1;_0x382f3b[_0x45f34f][_0x211680(0x1a7)]=_0xcbb30e;}),_0x2af2ee['forEach']((_0x124ad5,_0x22c7d7)=>{var _0x50d912=_0x43a7c1;_0x382f3b[_0x22c7d7][_0x50d912(0x1c0)]=_0x124ad5;}),_0x514976[_0x43a7c1(0x1a9)]((_0xee3edb,_0x5c7e8f)=>{var _0x5c2482=_0x43a7c1;_0x382f3b[_0x5c7e8f][_0x5c2482(0x1b0)]=_0xee3edb;}),_0x450040[_0x43a7c1(0x1a9)]((_0x1e1c48,_0x3a4803)=>{var _0x3178a9=_0x43a7c1;_0x382f3b[_0x3a4803][_0x3178a9(0x1e0)]=_0x1e1c48;}),_0x5cad14[_0x43a7c1(0x1a9)]((_0x51e151,_0x375851)=>{_0x382f3b[_0x375851]['floorlevel']=_0x51e151;}),_0x3031ee['forEach']((_0x15d4e5,_0xe53abb)=>{var _0x3ed4bc=_0x43a7c1;_0x382f3b[_0xe53abb][_0x3ed4bc(0x1c7)]=_0x15d4e5;}),_0xd8fdc7[_0x43a7c1(0x1a9)]((_0x424832,_0x5acccf)=>{var _0x1f8d3e=_0x43a7c1;_0x382f3b[_0x5acccf][_0x1f8d3e(0x251)]=_0x424832;}),_0x333cb2[_0x43a7c1(0x1a9)]((_0x316bc9,_0x6b81df)=>{_0x382f3b[_0x6b81df]['maxStocks']=_0x316bc9;}),_0x6071e7['forEach']((_0x1aa15c,_0x31b3f5)=>{var _0x47c849=_0x43a7c1;_0x382f3b[_0x31b3f5][_0x47c849(0x19d)]=_0x1aa15c;}),_0x5b7739[_0x43a7c1(0x1a9)]((_0x21042d,_0x53c0f0)=>{_0x382f3b[_0x53c0f0]['expiry_date']=_0x21042d;}),_0x30d80c[_0x43a7c1(0x1a9)]((_0xd2fde7,_0x61aa31)=>{var _0x449eca=_0x43a7c1;_0x382f3b[_0x61aa31][_0x449eca(0x1d1)]=_0xd2fde7;}),_0x2957eb[_0x43a7c1(0x1a9)]((_0x1cc114,_0x3f212a)=>{var _0x1c1d83=_0x43a7c1;_0x382f3b[_0x3f212a][_0x1c1d83(0x215)]=_0x1cc114;}),_0x39978b[_0x43a7c1(0x1a9)]((_0xf5433f,_0x3ee819)=>{var _0x1b6056=_0x43a7c1;_0x382f3b[_0x3ee819][_0x1b6056(0x267)]=_0xf5433f;});const _0x491a53=_0x382f3b[_0x43a7c1(0x23e)](_0xd92da5=>_0xd92da5['quantity']!=='0'&&_0xd92da5[_0x43a7c1(0x237)]!=='');_0x2873e5['invoice']=_0x4bd646,_0x2873e5[_0x43a7c1(0x1a8)]=_0x49f593,_0x2873e5[_0x43a7c1(0x19e)]=_0x17b769,_0x2873e5[_0x43a7c1(0x293)]=_0x164809,_0x2873e5[_0x43a7c1(0x213)]=_0x491a53,_0x2873e5['note']=_0x338922,_0x2873e5[_0x43a7c1(0x204)]=_0x4ce270,_0x2873e5['due_amount']=_0x4e4333,_0x2873e5[_0x43a7c1(0x25f)]=_0x2cc30b,_0x2873e5[_0x43a7c1(0x246)]=_0x2a8cee,_0x2873e5[_0x43a7c1(0x1f1)]=_0x1c4c68;const _0x3472b2=await _0x2873e5[_0x43a7c1(0x26c)](),_0x12b62c=await warehouse[_0x43a7c1(0x208)]({'name':_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x293)],'room':_0x5a467e['body'][_0x43a7c1(0x24c)]});_0x2873e5[_0x43a7c1(0x213)][_0x43a7c1(0x1a9)](_0xc276e3=>{var _0x21c2fc=_0x43a7c1,_0x949dc3=0x0;const _0x36eda=_0x12b62c['product_details'][_0x21c2fc(0x1c6)](_0x36ef58=>{var _0x49d112=_0x21c2fc;_0x36ef58[_0x49d112(0x29c)]==_0xc276e3['product_name']&&_0x36ef58[_0x49d112(0x296)]==_0xc276e3['floorlevel']&&_0x36ef58[_0x49d112(0x1d1)]==_0xc276e3['type']&&_0x36ef58['bin']==_0xc276e3['bin']&&_0x36ef58[_0x49d112(0x1b0)]==_0xc276e3['bay']&&_0x36ef58[_0x49d112(0x267)]==_0xc276e3[_0x49d112(0x267)]&&_0x36ef58[_0x49d112(0x215)]==_0xc276e3[_0x49d112(0x215)]&&(_0x36ef58[_0x49d112(0x277)]=parseInt(_0x36ef58[_0x49d112(0x277)])+parseInt(_0xc276e3[_0x49d112(0x237)]),_0x949dc3++);});_0x949dc3=='0'&&(_0x12b62c[_0x21c2fc(0x222)]=_0x12b62c[_0x21c2fc(0x222)][_0x21c2fc(0x1fa)]({'product_name':_0xc276e3[_0x21c2fc(0x29c)],'product_stock':_0xc276e3[_0x21c2fc(0x237)],'primary_code':_0xc276e3[_0x21c2fc(0x1c7)],'secondary_code':_0xc276e3[_0x21c2fc(0x251)],'product_code':_0xc276e3[_0x21c2fc(0x1bc)],'storage':_0xc276e3[_0x21c2fc(0x215)],'rack':_0xc276e3[_0x21c2fc(0x267)],'bay':_0xc276e3[_0x21c2fc(0x1b0)],'bin':_0xc276e3[_0x21c2fc(0x1e0)],'type':_0xc276e3['type'],'floorlevel':_0xc276e3[_0x21c2fc(0x296)],'maxProducts':_0xc276e3[_0x21c2fc(0x1e3)],'unit':_0xc276e3[_0x21c2fc(0x1a7)],'secondary_unit':_0xc276e3[_0x21c2fc(0x1c0)],'expiry_date':_0xc276e3[_0x21c2fc(0x1c2)]}));}),await _0x12b62c[_0x43a7c1(0x26c)]();const _0x5c4bc1=await s_payment_data[_0x43a7c1(0x208)]({'invoice':_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x255)]});if(_0x5c4bc1===null){}else console['log'](_0x43a7c1(0x1a8),_0x5c4bc1,_0x5a467e['body'][_0x43a7c1(0x255)]),_0x5c4bc1[_0x43a7c1(0x1a8)]=_0x5a467e[_0x43a7c1(0x23a)][_0x43a7c1(0x1a8)],await _0x5c4bc1['save']();_0x5a467e[_0x43a7c1(0x195)](_0x43a7c1(0x265),'purchase\x20data\x20update\x20successfully'),_0x4b9a67[_0x43a7c1(0x1ae)](_0x43a7c1(0x247));}catch(_0x347a7a){console[_0x43a7c1(0x1fd)](_0x347a7a);}}),router[a0_0x43d5a0(0x1bf)](a0_0x43d5a0(0x22b),auth,async(_0x5c36b8,_0x5ce311)=>{var _0x32e0a4=a0_0x43d5a0;try{const _0x4416fa=_0x5c36b8[_0x32e0a4(0x299)]['id'],{invoice:_0x15a03d,suppliers:_0x51b09e,payable:_0x9d6998,due_amount:_0x42e323}=_0x5c36b8['body'],_0x46a11f=await purchases[_0x32e0a4(0x1b4)](_0x4416fa);var _0x537535=_0x9d6998-_0x42e323;_0x46a11f[_0x32e0a4(0x204)]=parseFloat(_0x46a11f[_0x32e0a4(0x204)])+parseFloat(_0x42e323),_0x46a11f['due_amount']=_0x537535;const _0x2342f2=await _0x46a11f[_0x32e0a4(0x26c)]();console[_0x32e0a4(0x1fd)](_0x2342f2);const _0x42695d=await s_payment_data[_0x32e0a4(0x208)]({'invoice':_0x15a03d});_0x42695d['amount']=_0x537535,await _0x42695d[_0x32e0a4(0x26c)]();let _0x413438=new Date(),_0x428b0c=('0'+_0x413438['getDate']())[_0x32e0a4(0x1d4)](-0x2),_0x32015e=('0'+(_0x413438[_0x32e0a4(0x1d6)]()+0x1))[_0x32e0a4(0x1d4)](-0x2),_0x9f8a9d=_0x413438[_0x32e0a4(0x24d)](),_0x24fc2e=_0x9f8a9d+'-'+_0x32015e+'-'+_0x428b0c;const _0x2b8b3b=new suppliers_payment({'invoice':_0x15a03d,'date':_0x9f8a9d+'-'+_0x32015e+'-'+_0x428b0c,'suppliers':_0x51b09e,'reason':_0x32e0a4(0x220),'amount':_0x42e323}),_0x2827d7=await _0x2b8b3b[_0x32e0a4(0x26c)]();_0x5c36b8[_0x32e0a4(0x195)](_0x32e0a4(0x265),'payment\x20successfull'),_0x5ce311[_0x32e0a4(0x1ae)](_0x32e0a4(0x247));}catch(_0x358ea7){console[_0x32e0a4(0x1fd)](_0x358ea7);}}),router[a0_0x43d5a0(0x203)](a0_0x43d5a0(0x1a2),auth,async(_0x20b3d2,_0x5cf747)=>{var _0x7ae2d7=a0_0x43d5a0;try{const {username:_0x133941,email:_0x4799d9,role:_0x57e677}=_0x20b3d2[_0x7ae2d7(0x1ed)],_0x2ddccd=_0x20b3d2['user'],_0x4b4b94=await profile[_0x7ae2d7(0x208)]({'email':_0x2ddccd[_0x7ae2d7(0x253)]}),_0xed82ed=await master_shop[_0x7ae2d7(0x1d2)]();console[_0x7ae2d7(0x1fd)](_0x7ae2d7(0x224),_0xed82ed);const _0x41c0ab=_0x20b3d2[_0x7ae2d7(0x299)]['id'],_0xff3d2f=await purchases[_0x7ae2d7(0x1b4)](_0x41c0ab);console[_0x7ae2d7(0x1fd)](_0xff3d2f);const _0x57a634=await suppliers[_0x7ae2d7(0x208)]({'name':_0xff3d2f[_0x7ae2d7(0x1a8)]});console[_0x7ae2d7(0x1fd)](_0x57a634);if(_0xed82ed[0x0]['language']==_0x7ae2d7(0x227)){var _0x1bf18f=users['English'];console['log'](_0x1bf18f);}else{if(_0xed82ed[0x0][_0x7ae2d7(0x1a5)]==_0x7ae2d7(0x1aa))var _0x1bf18f=users[_0x7ae2d7(0x1aa)];else{if(_0xed82ed[0x0]['language']==_0x7ae2d7(0x271))var _0x1bf18f=users['German'];else{if(_0xed82ed[0x0][_0x7ae2d7(0x1a5)]==_0x7ae2d7(0x20a))var _0x1bf18f=users[_0x7ae2d7(0x20a)];else{if(_0xed82ed[0x0][_0x7ae2d7(0x1a5)]==_0x7ae2d7(0x1ff))var _0x1bf18f=users[_0x7ae2d7(0x1ff)];else{if(_0xed82ed[0x0][_0x7ae2d7(0x1a5)]==_0x7ae2d7(0x29f))var _0x1bf18f=users[_0x7ae2d7(0x200)];else{if(_0xed82ed[0x0][_0x7ae2d7(0x1a5)]==_0x7ae2d7(0x297))var _0x1bf18f=users[_0x7ae2d7(0x297)];else{if(_0xed82ed[0x0]['language']=='Arabic\x20(ae)')var _0x1bf18f=users[_0x7ae2d7(0x289)];}}}}}}}_0x5cf747[_0x7ae2d7(0x245)](_0x7ae2d7(0x1d7),{'success':_0x20b3d2['flash'](_0x7ae2d7(0x265)),'errors':_0x20b3d2[_0x7ae2d7(0x195)](_0x7ae2d7(0x291)),'role':_0x2ddccd,'profile':_0x4b4b94,'master_shop':_0xed82ed,'supplier':_0x57a634,'purchase':_0xff3d2f,'language':_0x1bf18f});}catch(_0x4706bc){console[_0x7ae2d7(0x1fd)](_0x4706bc);}}),router['get'](a0_0x43d5a0(0x261),auth,async(_0x4bb7fa,_0x5de054)=>{var _0x2d393a=a0_0x43d5a0;try{const {username:_0x293757,email:_0x18679e,role:_0x212a96}=_0x4bb7fa[_0x2d393a(0x1ed)],_0x502ef8=_0x4bb7fa['user'],_0x2aa8d1=await profile[_0x2d393a(0x208)]({'email':_0x502ef8[_0x2d393a(0x253)]}),_0x3bd9f3=await master_shop[_0x2d393a(0x1d2)]();console[_0x2d393a(0x1fd)](_0x2d393a(0x224),_0x3bd9f3);const _0xc119b7=_0x4bb7fa[_0x2d393a(0x299)]['id'];console[_0x2d393a(0x1fd)](_0xc119b7);const _0x5cb3f3=await purchases['findById'](_0xc119b7);console['log'](_0x2d393a(0x286),_0x5cb3f3);const _0x2929d0=await product['find']({}),_0xfa4a15=await warehouse[_0x2d393a(0x1f5)]([{'$match':{'name':_0x5cb3f3[_0x2d393a(0x293)],'room':_0x5cb3f3[_0x2d393a(0x25f)],'warehouse_category':_0x2d393a(0x1e6)}},{'$unwind':_0x2d393a(0x280)},{'$group':{'_id':_0x2d393a(0x197),'name':{'$first':_0x2d393a(0x1b5)},'product_stock':{'$first':_0x2d393a(0x249)},'bay':{'$first':_0x2d393a(0x1ad)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2d393a(0x254)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2d393a(0x20b)},'product_code':{'$first':_0x2d393a(0x20c)},'storage':{'$first':_0x2d393a(0x2a3)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x2d393a(0x1f5)]([{'$match':{'status':_0x2d393a(0x238),'name':_0x2d393a(0x21b),'warehouse_category':_0x2d393a(0x1e6)}},{'$group':{'_id':_0x2d393a(0x24b),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0xfa4a15);if(_0x3bd9f3[0x0][_0x2d393a(0x1a5)]=='English\x20(US)'){var _0x58556d=users[_0x2d393a(0x28f)];console[_0x2d393a(0x1fd)](_0x58556d);}else{if(_0x3bd9f3[0x0]['language']=='Hindi')var _0x58556d=users['Hindi'];else{if(_0x3bd9f3[0x0][_0x2d393a(0x1a5)]==_0x2d393a(0x271))var _0x58556d=users[_0x2d393a(0x271)];else{if(_0x3bd9f3[0x0][_0x2d393a(0x1a5)]==_0x2d393a(0x20a))var _0x58556d=users[_0x2d393a(0x20a)];else{if(_0x3bd9f3[0x0]['language']==_0x2d393a(0x1ff))var _0x58556d=users[_0x2d393a(0x1ff)];else{if(_0x3bd9f3[0x0][_0x2d393a(0x1a5)]==_0x2d393a(0x29f))var _0x58556d=users[_0x2d393a(0x200)];else{if(_0x3bd9f3[0x0][_0x2d393a(0x1a5)]=='Chinese')var _0x58556d=users[_0x2d393a(0x297)];else{if(_0x3bd9f3[0x0][_0x2d393a(0x1a5)]==_0x2d393a(0x1d9))var _0x58556d=users['Arabic'];}}}}}}}_0x5de054[_0x2d393a(0x245)](_0x2d393a(0x1ec),{'success':_0x4bb7fa[_0x2d393a(0x195)](_0x2d393a(0x265)),'errors':_0x4bb7fa[_0x2d393a(0x195)]('errors'),'role':_0x502ef8,'profile':_0x2aa8d1,'user':_0x5cb3f3,'stock':_0xfa4a15,'master_shop':_0x3bd9f3,'product':_0x2929d0,'language':_0x58556d,'warehouse':warehouse_data});}catch(_0x34b0ce){console['log'](_0x34b0ce);}}),router[a0_0x43d5a0(0x1bf)]('/view/return_purchase/:id',auth,async(_0xf75b2,_0x2ecb01)=>{var _0x263899=a0_0x43d5a0;try{const {invoice:_0x422035,date:_0x4999c7,warehouse_name:_0x571670,Room_name:_0x191984,product_name:_0x47f877,purchase_quantity:_0x2af103,stocks:_0x2b8994,return_qty:_0x497671,note:_0x1df417,level:_0x1a63f7,isle:_0x14f89b,pallet:_0x54bda4,to_warehouse_name:_0x421a86,to_Room_name:_0xe230aa}=_0xf75b2['body'],_0x4650ec=await purchases[_0x263899(0x208)]({'_id':_0xf75b2[_0x263899(0x299)]['id']}),_0x5984af=await warehouse[_0x263899(0x208)]({'name':_0x571670,'room':_0x191984});if(typeof _0x47f877==_0x263899(0x2a0))var _0xc659fb=[_0xf75b2['body'][_0x263899(0x29c)]],_0x376845=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x273)]],_0x291bc2=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x201)]],_0x1a6fb6=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x19f)]],_0x15e9d=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x1f7)]],_0x19c66c=[_0xf75b2['body'][_0x263899(0x23c)]],_0x981e20=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x1b7)]],_0x10b227=[_0xf75b2[_0x263899(0x23a)]['types']],_0x25acd8=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x1ba)]],_0x20a1f0=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x294)]],_0x37c8bd=[_0xf75b2[_0x263899(0x23a)][_0x263899(0x19c)]];else var _0xc659fb=[..._0xf75b2['body'][_0x263899(0x29c)]],_0x376845=[..._0xf75b2['body']['purchase_quantity']],_0x291bc2=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x201)]],_0x1a6fb6=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x19f)]],_0x15e9d=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x1f7)]],_0x19c66c=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x23c)]],_0x981e20=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x1b7)]],_0x10b227=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x209)]],_0x25acd8=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x1ba)]],_0x20a1f0=[..._0xf75b2[_0x263899(0x23a)][_0x263899(0x294)]],_0x37c8bd=[..._0xf75b2[_0x263899(0x23a)]['secondary_code_hide']];const _0x109aa8=_0xc659fb[_0x263899(0x1c6)](_0x55b9f0=>{return _0x55b9f0={'product_name':_0x55b9f0};});_0x376845[_0x263899(0x1a9)]((_0x2d923a,_0x5d304c)=>{var _0x389aa7=_0x263899;_0x109aa8[_0x5d304c][_0x389aa7(0x273)]=_0x2d923a;}),_0x291bc2[_0x263899(0x1a9)]((_0x3ff97b,_0xc762f1)=>{var _0x24d9bf=_0x263899;_0x109aa8[_0xc762f1][_0x24d9bf(0x1ef)]=_0x3ff97b;}),_0x1a6fb6[_0x263899(0x1a9)]((_0x5dad58,_0x3ad1b3)=>{_0x109aa8[_0x3ad1b3]['return_qty']=_0x5dad58;}),_0x15e9d[_0x263899(0x1a9)]((_0x1cfd49,_0x474366)=>{var _0x2365a8=_0x263899;_0x109aa8[_0x474366][_0x2365a8(0x1b0)]=_0x1cfd49;}),_0x19c66c[_0x263899(0x1a9)]((_0x21823a,_0x583d29)=>{var _0x5da911=_0x263899;_0x109aa8[_0x583d29][_0x5da911(0x1e0)]=_0x21823a;}),_0x981e20[_0x263899(0x1a9)]((_0x3bb829,_0x24a759)=>{var _0x1756ea=_0x263899;_0x109aa8[_0x24a759][_0x1756ea(0x296)]=_0x3bb829;}),_0x10b227[_0x263899(0x1a9)]((_0x28c6e1,_0x403ef2)=>{var _0xb546c0=_0x263899;_0x109aa8[_0x403ef2][_0xb546c0(0x1d1)]=_0x28c6e1;}),_0x25acd8['forEach']((_0x246eba,_0x53932f)=>{var _0x44f6f0=_0x263899;_0x109aa8[_0x53932f][_0x44f6f0(0x1bc)]=_0x246eba;}),_0x20a1f0[_0x263899(0x1a9)]((_0x7c5695,_0x3659f1)=>{var _0x42053b=_0x263899;_0x109aa8[_0x3659f1][_0x42053b(0x1c7)]=_0x7c5695;}),_0x37c8bd['forEach']((_0x48bbf1,_0x4670dc)=>{var _0x3de217=_0x263899;_0x109aa8[_0x4670dc][_0x3de217(0x251)]=_0x48bbf1;}),_0x4650ec[_0x263899(0x213)][_0x263899(0x1a9)](_0x4e995f=>{const _0x76d619=_0x5984af['product_details']['map'](_0x8e3954=>{var _0x21915c=a0_0x52e0;_0x8e3954[_0x21915c(0x29c)]==_0x4e995f[_0x21915c(0x29c)]&&_0x8e3954[_0x21915c(0x296)]==_0x4e995f[_0x21915c(0x296)]&&_0x8e3954[_0x21915c(0x1d1)]==_0x4e995f[_0x21915c(0x1d1)]&&_0x8e3954['bin']==_0x4e995f[_0x21915c(0x1e0)]&&_0x8e3954[_0x21915c(0x1b0)]==_0x4e995f['bay']&&_0x8e3954[_0x21915c(0x267)]==_0x4e995f['rack']&&_0x8e3954[_0x21915c(0x215)]==_0x4e995f[_0x21915c(0x215)]&&(console['log'](parseInt(_0x8e3954['product_stock'])+_0x21915c(0x285)+parseInt(_0x4e995f[_0x21915c(0x237)])),_0x8e3954[_0x21915c(0x277)]=parseInt(_0x8e3954[_0x21915c(0x277)])+parseInt(_0x4e995f[_0x21915c(0x237)]));});}),await _0x5984af[_0x263899(0x26c)]();const _0x159534=_0x109aa8[_0x263899(0x23e)](_0x21153e=>_0x21153e[_0x263899(0x19f)]!=='0'&&_0x21153e[_0x263899(0x19f)]!=='');var _0x2acd76=0x0;_0x159534[_0x263899(0x1a9)](_0x2742fa=>{var _0x36c37d=_0x263899;console[_0x36c37d(0x1fd)](_0x36c37d(0x212),_0x2742fa),(parseInt(_0x2742fa['purchase_quantity'])<parseInt(_0x2742fa[_0x36c37d(0x19f)])||parseInt(_0x2742fa['stock_quantity'])<parseInt(_0x2742fa[_0x36c37d(0x19f)]))&&_0x2acd76++;});if(_0x2acd76!=0x0)return _0xf75b2['flash'](_0x263899(0x291),_0x263899(0x1d0)),_0x2ecb01[_0x263899(0x1ae)]('back');const _0x536813=new purchases_return({'invoice':_0x422035,'suppliers':_0xf75b2['body'][_0x263899(0x1a8)],'date':_0x4999c7,'warehouse_name':_0x571670,'return_product':_0x159534,'note':_0x1df417,'room':_0x191984,'to_warehouse_name':_0x421a86,'to_room':_0xe230aa}),_0x30fea5=await _0x536813[_0x263899(0x26c)]();console[_0x263899(0x1fd)](_0x536813);const _0xb1e856=await purchases_return[_0x263899(0x208)]({'invoice':_0x422035}),_0x22a983=await warehouse[_0x263899(0x208)]({'name':_0x421a86,'room':_0xe230aa});_0xb1e856[_0x263899(0x236)][_0x263899(0x1a9)](_0x25d07c=>{var _0x5ecdf7=_0x263899,_0x327a32=0x0;const _0x4c47a3=_0x22a983[_0x5ecdf7(0x222)]['map'](_0x577f33=>{var _0x39f115=_0x5ecdf7;_0x577f33[_0x39f115(0x29c)]==_0x25d07c[_0x39f115(0x29c)]&&_0x577f33[_0x39f115(0x296)]==_0x25d07c['floorlevel']&&_0x577f33[_0x39f115(0x1d1)]==_0x25d07c[_0x39f115(0x1d1)]&&_0x577f33[_0x39f115(0x1e0)]==_0x25d07c[_0x39f115(0x1e0)]&&_0x577f33[_0x39f115(0x1b0)]==_0x25d07c[_0x39f115(0x1b0)]&&(_0x577f33[_0x39f115(0x277)]=parseInt(_0x577f33[_0x39f115(0x277)])-parseInt(_0x25d07c[_0x39f115(0x19f)]),_0x327a32++);});_0x327a32=='0'&&(_0x22a983[_0x5ecdf7(0x222)]=_0x22a983['product_details'][_0x5ecdf7(0x1fa)]({'product_name':_0x25d07c['product_name'],'product_stock':_0x25d07c[_0x5ecdf7(0x19f)],'primary_code':_0x25d07c[_0x5ecdf7(0x1c7)],'secondary_code':_0x25d07c[_0x5ecdf7(0x251)],'product_code':_0x25d07c[_0x5ecdf7(0x1bc)],'storage':_0x25d07c['storage'],'rack':_0x25d07c[_0x5ecdf7(0x267)],'bay':_0x25d07c[_0x5ecdf7(0x1b0)],'bin':_0x25d07c['bin'],'type':_0x25d07c[_0x5ecdf7(0x1d1)],'floorlevel':_0x25d07c[_0x5ecdf7(0x296)],'maxProducts':_0x25d07c[_0x5ecdf7(0x1e3)],'unit':_0x25d07c['standard_unit'],'secondary_unit':_0x25d07c[_0x5ecdf7(0x1c0)],'expiry_date':_0x25d07c[_0x5ecdf7(0x1c2)]}));}),await _0x22a983[_0x263899(0x26c)]();const _0x561c61=await purchases[_0x263899(0x208)]({'invoice':_0x422035});_0x561c61[_0x263899(0x256)]=_0x263899(0x18c);const _0x38e1f5=await _0x561c61['save'](),_0x48f6a5=new s_payment_data({'invoice':_0x422035,'suppliers':_0xf75b2[_0x263899(0x23a)][_0x263899(0x1a8)],'reason':'Purchase\x20Return'});await _0x48f6a5['save']();const _0x4bfef4=await master_shop[_0x263899(0x1d2)]();console[_0x263899(0x1fd)]('add\x20post',_0x4bfef4[0x0][_0x263899(0x284)]);const _0x4e8d1a=await email_settings[_0x263899(0x208)](),_0x2bc4ff=await suppliers['findOne']({'name':_0xf75b2[_0x263899(0x23a)][_0x263899(0x1a8)]});console[_0x263899(0x1fd)]('suppliers_data',_0x2bc4ff);_0x4bfef4[0x0]['currency_placement']==0x1?(right_currency=_0x4bfef4[0x0][_0x263899(0x214)],left_currency=''):(right_currency='',left_currency=_0x4bfef4[0x0][_0x263899(0x214)]);var _0x5a8f64=_0xc659fb,_0x447204=_0x1a6fb6,_0x5b9bcd='',_0x48b5a2;for(_0x48b5a2 in _0x5a8f64){_0x5b9bcd+=_0x263899(0x24e)+_0x263899(0x292)+_0x5a8f64[_0x48b5a2]+_0x263899(0x1fb)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x447204[_0x48b5a2]+'</td>'+_0x263899(0x230);}console[_0x263899(0x1fd)]('product_list',_0x5b9bcd);let _0x1636ed=nodemailer[_0x263899(0x1a6)]({'service':_0x263899(0x22a),'auth':{'user':_0x4e8d1a[_0x263899(0x253)],'pass':_0x4e8d1a[_0x263899(0x1f6)]}}),_0x3db2f6={'from':_0x4e8d1a[_0x263899(0x253)],'to':_0x2bc4ff[_0x263899(0x253)],'subject':_0x263899(0x27c),'attachments':[{'filename':'Logo.png','path':__dirname+_0x263899(0x206)+_0x263899(0x234)+_0x4bfef4[0x0]['image'],'cid':'logo'}],'html':_0x263899(0x1c4)+_0x263899(0x26e)+_0x263899(0x262)+'<div>'+_0x263899(0x1dd)+_0x263899(0x21e)+_0x263899(0x1f2)+_0x263899(0x20d)+'<div>'+'<h2>\x20'+_0x4bfef4[0x0][_0x263899(0x1ac)]+_0x263899(0x242)+_0x263899(0x20d)+'</div>'+_0x263899(0x25e)+'<div>'+_0x263899(0x27f)+_0x263899(0x269)+_0x422035+'\x20'+_0x263899(0x231)+_0x263899(0x1e8)+_0x4999c7+'\x20'+_0x263899(0x241)+_0x263899(0x29d)+'</div>'+_0x263899(0x1c5)+_0x263899(0x1a1)+_0x263899(0x24e)+_0x263899(0x1e2)+_0x263899(0x1d8)+_0x263899(0x202)+_0x263899(0x28d)+_0x263899(0x230)+_0x263899(0x1da)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5b9bcd+'\x20'+'</tbody>'+_0x263899(0x223)+_0x263899(0x21e)+_0x263899(0x1f4)+_0x263899(0x295)+_0x4bfef4[0x0]['site_title']+'</h5>'+'</div>'+_0x263899(0x20d)+_0x263899(0x217)};_0x1636ed[_0x263899(0x258)](_0x3db2f6,function(_0x28ff44,_0x13bb31){var _0x333d1a=_0x263899;_0x28ff44?(console['log'](_0x28ff44),console[_0x333d1a(0x1fd)](_0x333d1a(0x278))):console[_0x333d1a(0x1fd)](_0x333d1a(0x23b));}),_0xf75b2[_0x263899(0x195)](_0x263899(0x265),'purchases\x20item\x20return\x20successfull'),_0x2ecb01[_0x263899(0x1ae)]('/all_purchases/view');}catch(_0x23763c){console[_0x263899(0x1fd)](_0x23763c),_0x2ecb01['status'](0xc8)[_0x263899(0x263)]({'message':_0x23763c['message']});}}),router['get']('/barcode/:id',auth,async(_0x1361c5,_0x61256e)=>{var _0x4597bf=a0_0x43d5a0;try{const {username:_0x1eab60,email:_0x537493,role:_0x4cb452}=_0x1361c5[_0x4597bf(0x1ed)],_0x5ac675=_0x1361c5[_0x4597bf(0x1ed)],_0x56e190=await profile[_0x4597bf(0x208)]({'email':_0x5ac675['email']}),_0x52b6d2=await master_shop[_0x4597bf(0x1d2)](),_0x395616=_0x1361c5[_0x4597bf(0x299)]['id'],_0xec2c9d=await purchases[_0x4597bf(0x1b4)](_0x395616);if(_0x52b6d2[0x0][_0x4597bf(0x1a5)]==_0x4597bf(0x227))var _0x313c68=users['English'];else{if(_0x52b6d2[0x0][_0x4597bf(0x1a5)]==_0x4597bf(0x1aa))var _0x313c68=users['Hindi'];else{if(_0x52b6d2[0x0]['language']==_0x4597bf(0x271))var _0x313c68=users['German'];else{if(_0x52b6d2[0x0]['language']==_0x4597bf(0x20a))var _0x313c68=users[_0x4597bf(0x20a)];else{if(_0x52b6d2[0x0][_0x4597bf(0x1a5)]=='French')var _0x313c68=users[_0x4597bf(0x1ff)];else{if(_0x52b6d2[0x0][_0x4597bf(0x1a5)]==_0x4597bf(0x29f))var _0x313c68=users[_0x4597bf(0x200)];else{if(_0x52b6d2[0x0][_0x4597bf(0x1a5)]==_0x4597bf(0x297))var _0x313c68=users[_0x4597bf(0x297)];else{if(_0x52b6d2[0x0][_0x4597bf(0x1a5)]==_0x4597bf(0x1d9))var _0x313c68=users[_0x4597bf(0x289)];}}}}}}}_0x61256e[_0x4597bf(0x245)](_0x4597bf(0x1be),{'success':_0x1361c5[_0x4597bf(0x195)](_0x4597bf(0x265)),'errors':_0x1361c5[_0x4597bf(0x195)](_0x4597bf(0x291)),'role':_0x5ac675,'profile':_0x56e190,'alldata':_0xec2c9d,'master_shop':_0x52b6d2,'language':_0x313c68}),console['log'](alldata);}catch(_0x7fc5ab){console['log'](_0x7fc5ab);}}),router[a0_0x43d5a0(0x1bf)](a0_0x43d5a0(0x25b),async(_0x21abfd,_0x41f5ce)=>{var _0x958b64=a0_0x43d5a0;const {product_code:_0x543168}=_0x21abfd[_0x958b64(0x23a)];var _0xaf8bae;const _0x482d97=await product[_0x958b64(0x1f5)]([{'$match':{'primary_code':_0x543168,'product_category':_0x958b64(0x1e6)}},{'$group':{'_id':_0x958b64(0x28a),'name':{'$first':_0x958b64(0x24b)},'category':{'$first':'$category'},'brand':{'$first':_0x958b64(0x1b9)},'unit':{'$first':_0x958b64(0x218)},'alertquantity':{'$first':_0x958b64(0x20f)},'product_code':{'$first':_0x958b64(0x26d)},'primary_code':{'$first':_0x958b64(0x22f)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x958b64(0x257)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x958b64(0x235)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xcd3d04=await product[_0x958b64(0x1f5)]([{'$match':{'secondary_code':_0x543168,'product_category':_0x958b64(0x1e6)}},{'$group':{'_id':_0x958b64(0x28a),'name':{'$first':_0x958b64(0x24b)},'category':{'$first':'$category'},'brand':{'$first':_0x958b64(0x1b9)},'unit':{'$first':_0x958b64(0x218)},'alertquantity':{'$first':_0x958b64(0x20f)},'product_code':{'$first':_0x958b64(0x26d)},'primary_code':{'$first':_0x958b64(0x22f)},'secondary_code':{'$first':_0x958b64(0x1e9)},'maxStocks':{'$first':_0x958b64(0x26b)},'maxProdPerUnit':{'$first':_0x958b64(0x257)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x958b64(0x235)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x482d97[_0x958b64(0x190)]>0x0)_0xaf8bae=_0x482d97;else _0xcd3d04['length']>0x0&&(_0xaf8bae=_0xcd3d04);_0x41f5ce[_0x958b64(0x263)](_0xaf8bae);}),router['post'](a0_0x43d5a0(0x20e),async(_0x6710f3,_0x29fcad)=>{var _0x1b24ad=a0_0x43d5a0;const {primaryCode:_0x31d36c,secondaryCode:_0x26a5f3,productCode:_0x174df7,bay:_0x39b12a,bin:_0x3a0fcd,types:_0x6ee3fd,pallet:_0x18a4e9,warehouses:_0x164650,room:_0x37b92f}=_0x6710f3[_0x1b24ad(0x23a)];console[_0x1b24ad(0x1fd)](_0x6710f3['body']);try{const _0x5c91ea=await warehouse[_0x1b24ad(0x1f5)]([{'$match':{'name':_0x164650,'room':_0x37b92f}},{'$unwind':_0x1b24ad(0x280)},{'$match':{'product_details.bay':_0x39b12a,'product_details.bin':_0x3a0fcd,'product_details.type':_0x6ee3fd}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1b24ad(0x1b5)},'product_stock':{'$first':_0x1b24ad(0x249)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x1b24ad(0x1db)},'pallet':{'$first':_0x1b24ad(0x298)},'maxProducts':{'$first':_0x1b24ad(0x1b3)}}}]);_0x29fcad['status'](0xc8)['json'](_0x5c91ea);}catch(_0x159240){_0x29fcad[_0x1b24ad(0x192)](0x194)[_0x1b24ad(0x263)]({'message':_0x159240[_0x1b24ad(0x268)]});}}),module[a0_0x43d5a0(0x1c1)]=router;