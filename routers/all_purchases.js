var a0_0x21da44=a0_0x3fd9;(function(_0x4ccb42,_0x1e1a74){var _0x205490=a0_0x3fd9,_0x64716=_0x4ccb42();while(!![]){try{var _0x5181cf=-parseInt(_0x205490(0x237))/0x1+parseInt(_0x205490(0x272))/0x2+parseInt(_0x205490(0x1f5))/0x3*(parseInt(_0x205490(0x27d))/0x4)+-parseInt(_0x205490(0x20f))/0x5*(-parseInt(_0x205490(0x267))/0x6)+parseInt(_0x205490(0x294))/0x7*(parseInt(_0x205490(0x27b))/0x8)+-parseInt(_0x205490(0x1cd))/0x9+-parseInt(_0x205490(0x287))/0xa;if(_0x5181cf===_0x1e1a74)break;else _0x64716['push'](_0x64716['shift']());}catch(_0x5313bc){_0x64716['push'](_0x64716['shift']());}}}(a0_0x580a,0x1b858));function a0_0x580a(){var _0x41cc67=['date','COLD\x20STORAGE','date_data','Spanish','Raw\x20Materials','$warehouse_name','product_cat','path','concat','<h2>\x20','$return_data','5otstyF','Receiving\x20Area','English','createTransport','language','$product_details.secondary_code','English\x20(US)','currency_placement','Rack\x20B','product_details','filter','isle','$batch_code','\x20<>\x20','due_amount','payment\x20successfull','type','password','Rack\x20F','pallet','<tr>','MaxStocks_data','all_purchases','ejs','findById','prod_level','/view/add_purchases/:id','maxStocks','../middleware/auth','purchases\x20item\x20return\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','batch_code','Hindi','/CheckingWarehouse','storage','/give_payment/:id','Ambient','room','maxperunit','log','24148RcJWZk','image','user','Error\x20Occurs','body','</span>','status','quantity','redirect','Paid\x20For\x20Purchase','table\x20page','Portuguese\x20(BR)','getMonth','purchase\x20data\x20update\x20successfully','$product_details.product_code','abs','prod_code','message','forEach','padStart','secondary_unit','/upload/','$room','return_purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','stock_quantity','errors','POnumber','$product_details','currency','$product_details.isle','actual_uom','suppliers_data','/all_purchases/view','$product_details.type','$maxProdPerUnit','</table>','JO_number','post','</head><body>','$suppliers_docs','product','product_code','room_name','bin','</div>','exports','$secondary_unit','237858wLzvHC','$unit','getFullYear','</tbody>','back','get','$invoice','product_code_hide','rack','$suppliers','$category','298390hfsJcm','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<strong>\x20Regards\x20</strong>','$secondary_code','map','Arabic\x20(ae)','Return\x20Goods','$product','purchase_quantity','616qqSNqQ','$product_details.pallet','908DlQeUa','success','<tbody\x20style=\x22text-align:\x20center;\x22>','primary_code','Chinese','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','\x20Order\x20Number\x20:\x20','json','suppliers_docs','1984390TEeQLk','primary_code_hide','paid_amount','$note','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_Qty','$product.bin','master','prod_unit','$product_details.bay','foreach\x20newproduct','amount','push','13811kkwckT','Portuguese','$product_details.rack','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','note','German','</h5>','expiry_date','prod_name','staff','<div>','logo','RoomAssign','purchase_invoice','add\x20post','save','then','edit_purchases','$date','return_product','$product_details.primary_code','params','product_stock','prod_primunit','</body></html>','alertQTY','Enclosed','warehouse_name','$product_details.storage','</td>','stocks','$product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/view/add_purchases','Email\x20sent\x20successfully','deliverycode','Purchase\x20Mail','render','email','$product_details.floorlevel','<h5>','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.product_stock','\x20</h2>','<!DOCTYPE\x20html>','<hr\x20class=\x22my-3\x22>','/view/:id','return_qty','prod_isle','<html><head><title></title>','sendMail','$name','$paid_amount','$product_details.bin','/barcode_scanner','all','express','Purchase\x20Return\x20Mail','Level','aggregate','Enabled','RMSEmail','prod_cat','site_title','findOne','../models/all_models','/all_purchases/view/','prod_pallet','$_id','DRY\x20STORAGE','floor','French','here','Shelves','$product.quantity','INC-','Rack\x20C','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$primary_code','Rack\x20D','Floor','Room_name','\x20<\x20wew\x20>\x20','/view/return_purchase/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','types','/../public','add_purchases\x20error','$product_details.product_name','$product.room_name','deliverydate','Logo.png','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','invoice','1901997EMWveN','</tr>','max_product_unit','prod_secondunit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','return_data','Rack\x20A','../public/language/languages.json','standard_unit','name','string','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product.bay','host','actual_qty','add_purchases','suppliers','level','/view','$maxStocks','Arabic','$expiry_date','delivery_date','random','secondary_code_hide','production_date','$product_details._id','$finalize','error','getDate','/barcode/:id','$brand','An\x20error\x20occurred\x20while\x20saving\x20data.','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','slice','\x20Order\x20Date\x20:\x20','Sales\x20Update\x20successfully','nodemailer','2721zDJQgO','product_name','/preview/:id','find','catch','prod_qty','delivery_code','flash','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','secondary_code','bay','length','warehouse','<span\x20style=\x22float:\x20right;\x22>'];a0_0x580a=function(){return _0x41cc67;};return a0_0x580a();}const express=require(a0_0x21da44(0x1a6)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x21da44(0x1af)),auth=require(a0_0x21da44(0x22b)),nodemailer=require(a0_0x21da44(0x1f4));var ejs=require(a0_0x21da44(0x226));const path=require(a0_0x21da44(0x20b)),users=require(a0_0x21da44(0x1d4));router[a0_0x21da44(0x26c)](a0_0x21da44(0x1df),auth,async(_0x2e924b,_0x54e676)=>{var _0x4797d6=a0_0x21da44;try{const {username:_0x149098,email:_0x571f59,role:_0x3dc0fe}=_0x2e924b['user'],_0x26ffae=_0x2e924b[_0x4797d6(0x239)],_0x2d717b=await profile[_0x4797d6(0x1ae)]({'email':_0x26ffae['email']}),_0x229a37=await staff[_0x4797d6(0x1ae)]({'email':_0x26ffae[_0x4797d6(0x193)]});if(_0x26ffae[_0x4797d6(0x196)]==_0x4797d6(0x29e)){const _0xb3f009=await staff[_0x4797d6(0x1ae)]({'email':_0x26ffae[_0x4797d6(0x193)]});}const _0xc6e73b=await master_shop[_0x4797d6(0x1f8)]();let _0x12fcb8;if(_0x26ffae['role']==_0x4797d6(0x29e)){const _0xaf9d24=await staff['findOne']({'email':_0x26ffae['email']});_0x12fcb8=await purchases[_0x4797d6(0x1a9)]([{'$match':{'warehouse_name':_0xaf9d24[_0x4797d6(0x202)]}},{'$lookup':{'from':_0x4797d6(0x1dd),'localField':_0x4797d6(0x1dd),'foreignField':_0x4797d6(0x1d6),'as':'suppliers_docs'}},{'$unwind':_0x4797d6(0x25f)},{'$unwind':_0x4797d6(0x279)},{'$group':{'_id':_0x4797d6(0x1b2),'invoice':{'$first':_0x4797d6(0x26d)},'suppliers':{'$first':_0x4797d6(0x270)},'date':{'$first':_0x4797d6(0x2a7)},'warehouse_name':{'$first':_0x4797d6(0x209)},'room':{'$first':_0x4797d6(0x24d)},'product':{'$push':'$product'},'note':{'$first':_0x4797d6(0x28a)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4797d6(0x21b)},'expiry_date':{'$first':_0x4797d6(0x1e2)},'suppliers_docs':{'$first':_0x4797d6(0x25f)},'total_product_quantity':{'$sum':_0x4797d6(0x1b8)},'level':{'$addToSet':_0x4797d6(0x1d9)},'isle':{'$addToSet':_0x4797d6(0x28d)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x12fcb8=await purchases['aggregate']([{'$lookup':{'from':_0x4797d6(0x1dd),'localField':_0x4797d6(0x1dd),'foreignField':_0x4797d6(0x1d6),'as':_0x4797d6(0x286)}},{'$unwind':_0x4797d6(0x25f)},{'$unwind':_0x4797d6(0x279)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4797d6(0x26d)},'suppliers':{'$first':_0x4797d6(0x270)},'date':{'$first':_0x4797d6(0x2a7)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x4797d6(0x1c8)},'product':{'$push':'$product'},'note':{'$first':_0x4797d6(0x28a)},'paid_amount':{'$first':_0x4797d6(0x1a2)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4797d6(0x20e)},'batch_code':{'$first':_0x4797d6(0x21b)},'expiry_date':{'$first':_0x4797d6(0x1e2)},'suppliers_docs':{'$first':_0x4797d6(0x25f)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x4797d6(0x1d9)},'isle':{'$addToSet':_0x4797d6(0x28d)},'type':{'$addToSet':_0x4797d6(0x18c)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x4797d6(0x1e8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xc6e73b[0x0][_0x4797d6(0x213)]=='English\x20(US)'){var _0x1cfdf3=users[_0x4797d6(0x211)];console['log'](_0x1cfdf3);}else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]==_0x4797d6(0x22f))var _0x1cfdf3=users[_0x4797d6(0x22f)];else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]==_0x4797d6(0x29a))var _0x1cfdf3=users[_0x4797d6(0x29a)];else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]==_0x4797d6(0x207))var _0x1cfdf3=users[_0x4797d6(0x207)];else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]=='French')var _0x1cfdf3=users[_0x4797d6(0x1b5)];else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]=='Portuguese\x20(BR)')var _0x1cfdf3=users['Portuguese'];else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]=='Chinese')var _0x1cfdf3=users[_0x4797d6(0x281)];else{if(_0xc6e73b[0x0][_0x4797d6(0x213)]==_0x4797d6(0x277))var _0x1cfdf3=users[_0x4797d6(0x1e1)];}}}}}}}_0x54e676[_0x4797d6(0x192)](_0x4797d6(0x225),{'success':_0x2e924b[_0x4797d6(0x1fc)]('success'),'errors':_0x2e924b[_0x4797d6(0x1fc)](_0x4797d6(0x251)),'purchases':_0x12fcb8,'role':_0x26ffae,'profile':_0x2d717b,'master_shop':_0xc6e73b,'language':_0x1cfdf3});}catch(_0x3c7517){console[_0x4797d6(0x236)](_0x4797d6(0x241),_0x3c7517),_0x54e676[_0x4797d6(0x23d)](0xc8)['json']({'message':_0x3c7517[_0x4797d6(0x248)]});}});function a0_0x3fd9(_0x4ba162,_0x2ed782){var _0x580a7d=a0_0x580a();return a0_0x3fd9=function(_0x3fd983,_0x2119cf){_0x3fd983=_0x3fd983-0x189;var _0x37b72e=_0x580a7d[_0x3fd983];return _0x37b72e;},a0_0x3fd9(_0x4ba162,_0x2ed782);}function BayBinSelected(_0x5d3321,_0x5272fe){var _0x8a3c84=a0_0x21da44,_0x2f4d3e=[],_0x52298b=[],_0x6101aa=[],_0x37c173=[],_0x15cadc=[],_0xb0fe8d=[];let _0x303030=[];if(_0x5d3321==_0x8a3c84(0x1b3))switch(_0x5272fe){case'Rack\x20A':_0x2f4d3e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x52298b=[0x1,0x2],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8),_0x8a3c84(0x1be)],_0x15cadc=['D'],_0xb0fe8d=['A'];break;case'Rack\x20B':_0x2f4d3e=[0x6,0x5,0x4,0x3,0x2,0x1],_0x52298b=[0x1,0x2],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8),_0x8a3c84(0x1be)],_0x15cadc=['D'],_0xb0fe8d=['B'];break;case _0x8a3c84(0x1b7):_0x2f4d3e=[0x0],_0x52298b=[0x0],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1be)],_0x15cadc=['D'],_0xb0fe8d=['S'];break;case _0x8a3c84(0x210):_0x2f4d3e=[0x0],_0x52298b=[0x0],_0x37c173=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x6101aa=[_0x8a3c84(0x1be)],_0x15cadc=['D'],_0xb0fe8d=['R'];break;}else{if(_0x5d3321==_0x8a3c84(0x205))switch(_0x5272fe){case _0x8a3c84(0x1d3):_0x2f4d3e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x52298b=['B','F'],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8),_0x8a3c84(0x1be)],_0x15cadc=['C'],_0xb0fe8d=['A'];break;case _0x8a3c84(0x217):_0x2f4d3e=[0x5,0x4,0x3,0x2,0x1],_0x52298b=['F','B','S'],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8),'Floor'],_0x15cadc=['C'],_0xb0fe8d=['B'];break;case _0x8a3c84(0x1ba):_0x2f4d3e=[0x1,0x2,0x3,0x4,0x5],_0x52298b=['B','F','S'],_0x37c173=[0x5,0x4,0x3,0x2,0x1],_0x6101aa=[_0x8a3c84(0x1a8),_0x8a3c84(0x1be)],_0x15cadc=['C'],_0xb0fe8d=['C'];break;case _0x8a3c84(0x1bd):_0x2f4d3e=[0x5,0x4,0x3,0x2,0x1],_0x52298b=['F','B','S'],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8),_0x8a3c84(0x1be)],_0x15cadc=['C'],_0xb0fe8d=['D'];break;case'Rack\x20E':_0x2f4d3e=[0x4,0x3,0x2,0x1],_0x52298b=[0x1,0x2],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8),'Floor'],_0x15cadc=['C'],_0xb0fe8d=['E'];break;case _0x8a3c84(0x221):_0x2f4d3e=[0x1,0x2,0x3],_0x52298b=[0x1,0x2],_0x37c173=[0x1,0x2,0x3,0x4,0x5],_0x6101aa=[_0x8a3c84(0x1a8)],_0x15cadc=['C'],_0xb0fe8d=['F'];break;}}return{'levels':_0x2f4d3e,'Isle':_0x52298b,'rack':_0x37c173,'type':_0x6101aa,'storage':_0x15cadc,'rak':_0xb0fe8d};}async function getRandom8DigitNumber(){var _0x187195=a0_0x21da44;const _0x3cb143=0x989680,_0x4007ff=0x5f5e0ff,_0x5eb027=Math[_0x187195(0x1b4)](Math[_0x187195(0x1e4)]()*(_0x4007ff-_0x3cb143+0x1))+_0x3cb143;var _0x50c5f3;const _0x418318=await purchases[_0x187195(0x1ae)]({'invoice':_0x187195(0x1b9)+_0x5eb027});return _0x418318&&_0x418318[_0x187195(0x201)]>0x0?_0x50c5f3=_0x187195(0x1b9)+_0x5eb027:_0x50c5f3='INC-'+_0x5eb027,_0x50c5f3;}router[a0_0x21da44(0x26c)]('/view/add_purchases',auth,async(_0x1f0090,_0x40a490)=>{var _0x36429f=a0_0x21da44;try{const {username:_0x1ba911,email:_0x46b541,role:_0x876fd3}=_0x1f0090[_0x36429f(0x239)],_0x51e061=_0x1f0090[_0x36429f(0x239)],_0x1d967b=await profile[_0x36429f(0x1ae)]({'email':_0x51e061[_0x36429f(0x193)]}),_0x5210ea=await master_shop['find'](),_0x5b686b=await staff['findOne']({'email':_0x51e061[_0x36429f(0x193)]}),_0x51afad=await suppliers['find']({});let _0x28cc7d;if(_0x51e061[_0x36429f(0x196)]=='staff'){const _0x3a0918=await staff[_0x36429f(0x1ae)]({'email':_0x51e061['email']});_0x28cc7d=await warehouse[_0x36429f(0x1a9)]([{'$match':{'status':_0x36429f(0x1aa),'name':_0x3a0918[_0x36429f(0x202)],'warehouse_category':_0x36429f(0x208),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x36429f(0x1a1),'name':{'$first':_0x36429f(0x1a1)}}}]);}else _0x28cc7d=await warehouse[_0x36429f(0x1a9)]([{'$match':{'status':'Enabled','warehouse_category':_0x36429f(0x208),'name':{'$ne':_0x36429f(0x278)}}},{'$group':{'_id':_0x36429f(0x1a1),'name':{'$first':_0x36429f(0x1a1)}}}]);const _0x220868=await product[_0x36429f(0x1f8)]({}),_0x370cf7=await warehouse[_0x36429f(0x1f8)]({'status':'Enabled'}),_0xa97def=await purchases[_0x36429f(0x1f8)]({}),_0x444209=_0xa97def[_0x36429f(0x201)]+0x1,_0x15cd2f=_0x36429f(0x1b9)+_0x444209['toString']()[_0x36429f(0x24a)](0x5,'0');var _0x516ddf=[_0x36429f(0x233),_0x36429f(0x2af)];if(_0x5210ea[0x0][_0x36429f(0x213)]=='English\x20(US)')var _0x22090b=users[_0x36429f(0x211)];else{if(_0x5210ea[0x0][_0x36429f(0x213)]==_0x36429f(0x22f))var _0x22090b=users[_0x36429f(0x22f)];else{if(_0x5210ea[0x0][_0x36429f(0x213)]==_0x36429f(0x29a))var _0x22090b=users[_0x36429f(0x29a)];else{if(_0x5210ea[0x0][_0x36429f(0x213)]==_0x36429f(0x207))var _0x22090b=users[_0x36429f(0x207)];else{if(_0x5210ea[0x0][_0x36429f(0x213)]==_0x36429f(0x1b5))var _0x22090b=users[_0x36429f(0x1b5)];else{if(_0x5210ea[0x0][_0x36429f(0x213)]==_0x36429f(0x242))var _0x22090b=users[_0x36429f(0x295)];else{if(_0x5210ea[0x0]['language']==_0x36429f(0x281))var _0x22090b=users[_0x36429f(0x281)];else{if(_0x5210ea[0x0]['language']=='Arabic\x20(ae)')var _0x22090b=users['Arabic'];}}}}}}}const _0x261029=getRandom8DigitNumber();_0x261029[_0x36429f(0x2a5)](_0x248cca=>{var _0x5bf854=_0x36429f;_0x40a490['render'](_0x5bf854(0x1dc),{'success':_0x1f0090[_0x5bf854(0x1fc)](_0x5bf854(0x27e)),'errors':_0x1f0090[_0x5bf854(0x1fc)]('errors'),'role':_0x51e061,'profile':_0x1d967b,'suppliers':_0x51afad,'warehouse':_0x28cc7d,'product':_0x220868,'invoice':_0x248cca,'master_shop':_0x5210ea,'language':_0x22090b,'find_data':_0x370cf7,'rooms_data':_0x516ddf});})[_0x36429f(0x1f9)](_0x593b56=>{var _0x991fc7=_0x36429f;_0x1f0090[_0x991fc7(0x1fc)](_0x991fc7(0x251),_0x991fc7(0x1d8)),_0x40a490[_0x991fc7(0x23f)]('/all_purchases/view');});}catch(_0x42900c){console['log'](_0x42900c);}}),router['get'](a0_0x21da44(0x229),auth,async(_0x4f8d3e,_0x337f1f)=>{var _0x4d946f=a0_0x21da44;try{const _0x3de1f8=_0x4f8d3e[_0x4d946f(0x2aa)]['id'];console[_0x4d946f(0x236)](_0x3de1f8);const _0x3fd848=await master_shop['find']();console[_0x4d946f(0x236)](_0x4d946f(0x28e),_0x3fd848);const _0x3d3dcb=await product[_0x4d946f(0x1ae)]({'name':_0x3de1f8});console['log']('product',_0x3d3dcb),_0x337f1f[_0x4d946f(0x23d)](0xc8)[_0x4d946f(0x285)]({'product_data':_0x3d3dcb,'master':_0x3fd848});}catch(_0x4ac9b4){console[_0x4d946f(0x236)](_0x4d946f(0x1c6),_0x4ac9b4);}}),router[a0_0x21da44(0x25d)](a0_0x21da44(0x18e),auth,async(_0x39fee8,_0x554a09)=>{var _0x24642a=a0_0x21da44;try{const {invoice:_0x435631,date:_0x4a2ce6,warehouse_name:_0x455802,prod_name:_0x4a0428,prod_code:_0x92302b,prod_qty:_0x4ad317,prod_unit:_0x431eb7,prod_secondunit:_0x222eff,prod_level:_0x36e397,prod_isle:_0x55cdf5,prod_pallet:_0x577234,note:_0x3974f2,expiry_date:_0x4ad5cf,batch_code:_0xe01a11,payable:_0xbfe040,due_amount:_0x1a3b03,Room_name:_0x3fb1bb,primary_code:_0x14dbb0,secondary_code:_0x4d2a7c,MaxStocks_data:_0x15c0b1,PO_number:_0x453161,SCRN:_0x1bb8e4,JO_number:_0x3b85ea}=_0x39fee8[_0x24642a(0x23b)];if(typeof _0x4a0428==_0x24642a(0x1d7))var _0x481dec=[_0x39fee8['body']['prod_name']],_0x36799b=[_0x39fee8[_0x24642a(0x23b)]['prod_code']],_0x3c724f=[_0x39fee8['body'][_0x24642a(0x28c)]],_0x112911=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x2ac)]],_0x1d8161=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1d0)]],_0x5b4b7d=[_0x39fee8['body'][_0x24642a(0x228)]],_0x108ea5=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x280)]],_0x2ee9c8=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1ff)]],_0x14f671=[_0x39fee8['body']['MaxStocks_data']],_0x467d09=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x22e)]],_0x5ed8fb=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x29c)]],_0x1b49dd=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1cf)]],_0x5a848a=[_0x39fee8['body'][_0x24642a(0x2ae)]],_0xe8259b=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1e6)]],_0x254b57=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1ac)]],_0x52dac1=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x2a1)]],_0x4aa9b3=[_0x39fee8['body'][_0x24642a(0x190)]],_0x170f7e=[_0x39fee8['body'][_0x24642a(0x297)]],_0x4db01d=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1db)]],_0x455fae=[_0x39fee8[_0x24642a(0x23b)]['actual_uom']],_0x94f1f=[_0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1c9)]];else var _0x481dec=[..._0x39fee8['body'][_0x24642a(0x29d)]],_0x36799b=[..._0x39fee8['body'][_0x24642a(0x247)]],_0x3c724f=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x28c)]],_0x112911=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x2ac)]],_0x1d8161=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1d0)]],_0x5b4b7d=[..._0x39fee8['body'][_0x24642a(0x228)]],_0x108ea5=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x280)]],_0x2ee9c8=[..._0x39fee8['body']['secondary_code']],_0x14f671=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x224)]],_0x467d09=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x22e)]],_0x5ed8fb=[..._0x39fee8['body'][_0x24642a(0x29c)]],_0x1b49dd=[..._0x39fee8[_0x24642a(0x23b)]['max_product_unit']],_0x5a848a=[..._0x39fee8['body']['alertQTY']],_0xe8259b=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1e6)]],_0x254b57=[..._0x39fee8['body'][_0x24642a(0x1ac)]],_0x52dac1=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x2a1)]],_0x4aa9b3=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x190)]],_0x170f7e=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x297)]],_0x4db01d=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1db)]],_0x455fae=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x256)]],_0x94f1f=[..._0x39fee8[_0x24642a(0x23b)][_0x24642a(0x1c9)]];const _0x2e6e59=_0x481dec[_0x24642a(0x276)](_0x53b732=>{return _0x53b732={'product_name':_0x53b732};});_0x4db01d['forEach']((_0x444f17,_0x5daf0b)=>{var _0x45333d=_0x24642a;_0x2e6e59[_0x5daf0b][_0x45333d(0x1db)]=Math[_0x45333d(0x246)](_0x444f17);}),_0x455fae[_0x24642a(0x249)]((_0x1edb3e,_0xbe5555)=>{var _0x2121f1=_0x24642a;_0x2e6e59[_0xbe5555][_0x2121f1(0x256)]=_0x1edb3e;}),_0x36799b['forEach']((_0x288985,_0x570199)=>{var _0x1130f3=_0x24642a;_0x2e6e59[_0x570199]['product_code']=_0x288985,_0x2e6e59[_0x570199][_0x1130f3(0x206)]=_0x4a2ce6;}),_0x3c724f['forEach']((_0x4d9fdb,_0x2f680d)=>{_0x2e6e59[_0x2f680d]['quantity']=Math['abs'](_0x4d9fdb);}),_0x112911[_0x24642a(0x249)]((_0x465657,_0x2af5a3)=>{_0x2e6e59[_0x2af5a3]['standard_unit']=_0x465657;}),_0x1d8161[_0x24642a(0x249)]((_0x55161c,_0x7c32d7)=>{_0x2e6e59[_0x7c32d7]['secondary_unit']=_0x55161c;}),_0x5b4b7d[_0x24642a(0x249)]((_0xce3fdd,_0x364539)=>{var _0x1413e5=_0x24642a;_0x52dac1[_0x1413e5(0x249)]((_0x8f1840,_0x18a0cc)=>{var _0x3de764=_0x1413e5;if(_0x8f1840=='Receiving\x20Area'&&_0x364539==_0x18a0cc){console['log'](_0x8f1840+_0x3de764(0x1c0)+_0x364539+'\x20<>\x20'+_0x18a0cc+_0x3de764(0x21c)+_0xce3fdd);var _0x2ebb08=_0xce3fdd['slice'](0x3);_0x2e6e59[_0x364539][_0x3de764(0x231)]=_0xce3fdd[0x0],_0x2e6e59[_0x364539]['rack']=_0xce3fdd[0x1],_0x2e6e59[_0x364539][_0x3de764(0x200)]=0x0,_0x2e6e59[_0x364539][_0x3de764(0x263)]=0x0,_0x2e6e59[_0x364539][_0x3de764(0x21f)]=_0x3de764(0x1be),_0x2e6e59[_0x364539][_0x3de764(0x282)]=_0x2ebb08;}else{if(_0x8f1840==_0x3de764(0x1b7)&&_0x364539==_0x18a0cc){var _0x2ebb08=_0xce3fdd['slice'](0x3);_0x2e6e59[_0x364539][_0x3de764(0x231)]=_0xce3fdd[0x0],_0x2e6e59[_0x364539][_0x3de764(0x26f)]=_0xce3fdd[0x1],_0x2e6e59[_0x364539][_0x3de764(0x200)]=0x0,_0x2e6e59[_0x364539][_0x3de764(0x263)]=0x0,_0x2e6e59[_0x364539][_0x3de764(0x21f)]=_0x3de764(0x1be),_0x2e6e59[_0x364539]['floorlevel']=_0xce3fdd[0x5];}else{if(_0x364539==_0x18a0cc){if(_0xce3fdd[0x0]=='A'&&_0xce3fdd[0x1]=='L'&&_0xce3fdd[0x2]=='L')console[_0x3de764(0x236)](_0x8f1840+_0x3de764(0x21c)+_0x364539+_0x3de764(0x21c)+_0x18a0cc+'\x20<>\x20'+_0xce3fdd+_0x3de764(0x1b6)),_0x2e6e59[_0x364539]['storage']=_0xce3fdd[0x0],_0x2e6e59[_0x364539][_0x3de764(0x26f)]=_0xce3fdd[0x1],_0x2e6e59[_0x364539]['bay']=0x0,_0x2e6e59[_0x364539][_0x3de764(0x263)]=0x0,_0x2e6e59[_0x364539][_0x3de764(0x21f)]=_0x3de764(0x1be),_0x2e6e59[_0x364539][_0x3de764(0x282)]=_0xce3fdd[0x3];else{var _0x304412;if(_0xce3fdd[0x4]=='L')_0x304412=_0x3de764(0x1a8);else _0xce3fdd[0x4]=='F'&&(_0x304412='Floor');_0x2e6e59[_0x364539][_0x3de764(0x231)]=_0xce3fdd[0x0],_0x2e6e59[_0x364539][_0x3de764(0x26f)]=_0xce3fdd[0x1],_0x2e6e59[_0x364539]['bay']=_0xce3fdd[0x2],_0x2e6e59[_0x364539][_0x3de764(0x263)]=_0xce3fdd[0x3],_0x2e6e59[_0x364539][_0x3de764(0x21f)]=_0x304412,_0x2e6e59[_0x364539][_0x3de764(0x282)]=_0xce3fdd[0x5];}}}}});}),_0x108ea5['forEach']((_0x2dce41,_0x275ef4)=>{var _0x292e70=_0x24642a;_0x2e6e59[_0x275ef4][_0x292e70(0x280)]=_0x2dce41;}),_0x2ee9c8['forEach']((_0x2c99e6,_0x1d9171)=>{var _0x349306=_0x24642a;_0x2e6e59[_0x1d9171][_0x349306(0x1ff)]=_0x2c99e6;}),_0x14f671[_0x24642a(0x249)]((_0x471298,_0x16f239)=>{_0x2e6e59[_0x16f239]['maxStocks']=_0x471298;}),_0x467d09[_0x24642a(0x249)]((_0x519342,_0x2c3764)=>{var _0x4fd551=_0x24642a;_0x2e6e59[_0x2c3764][_0x4fd551(0x22e)]=_0x519342;}),_0x5ed8fb[_0x24642a(0x249)]((_0x6fdf41,_0x3a39cb)=>{var _0x56116f=_0x24642a;_0x2e6e59[_0x3a39cb][_0x56116f(0x29c)]=_0x6fdf41;}),_0x1b49dd['forEach']((_0x122a16,_0x5c9b8f)=>{_0x2e6e59[_0x5c9b8f]['maxperunit']=_0x122a16;}),_0x5a848a['forEach']((_0x330fe3,_0x4adf8b)=>{var _0x47312a=_0x24642a;_0x2e6e59[_0x4adf8b][_0x47312a(0x2ae)]=_0x330fe3;}),_0xe8259b['forEach']((_0x13756c,_0x4ae5e8)=>{_0x2e6e59[_0x4ae5e8]['production_date']=_0x13756c;}),_0x254b57[_0x24642a(0x249)]((_0x1813ea,_0x23e4c6)=>{var _0x32e76e=_0x24642a;_0x2e6e59[_0x23e4c6][_0x32e76e(0x20a)]=_0x1813ea;}),_0x52dac1['forEach']((_0x424f47,_0x592bc1)=>{_0x2e6e59[_0x592bc1]['room_name']=_0x424f47;}),_0x94f1f[_0x24642a(0x249)]((_0x1bac96,_0x3538f4)=>{var _0x3efcf2=_0x24642a;_0x2e6e59[_0x3538f4][_0x3efcf2(0x1e3)]=_0x1bac96;}),_0x4aa9b3[_0x24642a(0x249)]((_0x3a3055,_0x1ecde9)=>{var _0x33a533=_0x24642a;_0x2e6e59[_0x1ecde9][_0x33a533(0x1fb)]=_0x3a3055;}),_0x170f7e[_0x24642a(0x249)]((_0x46999f,_0x2917d4)=>{_0x2e6e59[_0x2917d4]['invoice']=_0x46999f;});const _0x1638e1=_0x52dac1['map'](_0x2ce32a=>{return _0x2ce32a={'room_name':_0x2ce32a};}),_0x271667=_0x2e6e59[_0x24642a(0x219)](_0x19e7dd=>_0x19e7dd[_0x24642a(0x23e)]!=='0'&&_0x19e7dd[_0x24642a(0x23e)]!==''),_0x220f4b=new purchases({'invoice':_0x435631,'suppliers':_0x39fee8['body']['suppliers'],'date':_0x4a2ce6,'warehouse_name':_0x455802,'product':_0x271667,'note':_0x3974f2,'due_amount':_0x1a3b03,'POnumber':_0x453161,'SCRN':_0x1bb8e4,'JO_number':_0x3b85ea,'roomList':_0x1638e1}),_0x36cfa0=await _0x220f4b['save'](),_0x1610ba=await purchases[_0x24642a(0x1ae)]({'invoice':_0x435631}),_0x3060db=_0x1610ba[_0x24642a(0x260)][_0x24642a(0x276)](async _0xe51a4f=>{var _0x44f20e=_0x24642a,_0x54fd59=await warehouse[_0x44f20e(0x1ae)]({'name':_0x455802,'room':_0xe51a4f[_0x44f20e(0x262)]}),_0x1779c5=0x0;return _0x54fd59[_0x44f20e(0x218)][_0x44f20e(0x249)](_0x212a5a=>{var _0x5d448c=_0x44f20e;_0x212a5a['product_name']==_0xe51a4f[_0x5d448c(0x1f6)]&&_0x212a5a[_0x5d448c(0x282)]==_0xe51a4f[_0x5d448c(0x282)]&&_0x212a5a[_0x5d448c(0x21f)]==_0xe51a4f[_0x5d448c(0x21f)]&&_0x212a5a['bin']==_0xe51a4f[_0x5d448c(0x263)]&&_0x212a5a[_0x5d448c(0x200)]==_0xe51a4f[_0x5d448c(0x200)]&&_0x212a5a['rack']==_0xe51a4f[_0x5d448c(0x26f)]&&_0x212a5a[_0x5d448c(0x231)]==_0xe51a4f[_0x5d448c(0x231)]&&_0x212a5a['expiry_date']==_0xe51a4f[_0x5d448c(0x29c)]&&_0x212a5a[_0x5d448c(0x22e)]==_0xe51a4f[_0x5d448c(0x22e)]&&_0x212a5a[_0x5d448c(0x1e6)]==_0xe51a4f['production_date']&&_0x212a5a[_0x5d448c(0x1cc)]==_0x1610ba['invoice']&&(_0x212a5a[_0x5d448c(0x2ab)]+=Math[_0x5d448c(0x246)](_0xe51a4f[_0x5d448c(0x23e)]),_0x1779c5++);}),_0x1779c5===0x0&&_0x54fd59[_0x44f20e(0x218)][_0x44f20e(0x293)]({'product_name':_0xe51a4f[_0x44f20e(0x1f6)],'product_stock':Math[_0x44f20e(0x246)](_0xe51a4f['quantity']),'primary_code':_0xe51a4f[_0x44f20e(0x280)],'secondary_code':_0xe51a4f[_0x44f20e(0x1ff)],'product_code':_0xe51a4f[_0x44f20e(0x261)],'storage':_0xe51a4f[_0x44f20e(0x231)],'rack':_0xe51a4f[_0x44f20e(0x26f)],'bay':_0xe51a4f[_0x44f20e(0x200)],'bin':_0xe51a4f[_0x44f20e(0x263)],'type':_0xe51a4f[_0x44f20e(0x21f)],'floorlevel':_0xe51a4f[_0x44f20e(0x282)],'maxProducts':_0xe51a4f[_0x44f20e(0x22a)],'unit':_0xe51a4f['standard_unit'],'secondary_unit':_0xe51a4f[_0x44f20e(0x24b)],'expiry_date':_0xe51a4f[_0x44f20e(0x29c)],'maxPerUnit':_0xe51a4f[_0x44f20e(0x235)],'batch_code':_0xe51a4f[_0x44f20e(0x22e)],'alertQTY':_0xe51a4f['alertQTY'],'production_date':_0xe51a4f[_0x44f20e(0x1e6)],'product_cat':_0xe51a4f[_0x44f20e(0x20a)],'invoice':_0xe51a4f[_0x44f20e(0x1cc)],'actual_qty':Math[_0x44f20e(0x246)](_0xe51a4f[_0x44f20e(0x1db)]),'actual_uom':_0xe51a4f[_0x44f20e(0x256)],'delivery_date':_0xe51a4f[_0x44f20e(0x1e3)],'delivery_code':_0xe51a4f[_0x44f20e(0x1fb)]}),_0x54fd59;});Promise[_0x24642a(0x1a5)](_0x3060db)[_0x24642a(0x2a5)](async _0x41c34a=>{var _0x47074d=_0x24642a;try{for(const _0x2967a9 of _0x41c34a){await _0x2967a9[_0x47074d(0x2a4)]();}const _0x20f62f=await master_shop['find'](),_0x5121a2=await email_settings[_0x47074d(0x1ae)](),_0x41e889=await supervisor_settings[_0x47074d(0x1f8)]();var _0x4bd30b=_0x1610ba['product'],_0x198b46='',_0x1352aa;for(_0x1352aa in _0x4bd30b){_0x198b46+=_0x47074d(0x223)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bd30b[_0x1352aa][_0x47074d(0x1f6)]+'</td>'+_0x47074d(0x1d1)+_0x4bd30b[_0x1352aa][_0x47074d(0x261)]+_0x47074d(0x18a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bd30b[_0x1352aa]['quantity']+_0x47074d(0x18a)+_0x47074d(0x1d1)+_0x4bd30b[_0x1352aa][_0x47074d(0x1d5)]+_0x47074d(0x18a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bd30b[_0x1352aa][_0x47074d(0x24b)]+_0x47074d(0x18a)+_0x47074d(0x1d1)+_0x1610ba[_0x47074d(0x2b0)]+_0x47074d(0x18a)+_0x47074d(0x1d1)+_0x4bd30b[_0x1352aa][_0x47074d(0x262)]+_0x47074d(0x18a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4bd30b[_0x1352aa][_0x47074d(0x231)]+_0x4bd30b[_0x1352aa]['rack']+_0x4bd30b[_0x1352aa][_0x47074d(0x200)]+_0x4bd30b[_0x1352aa][_0x47074d(0x263)]+_0x4bd30b[_0x1352aa][_0x47074d(0x21f)][0x0]+_0x4bd30b[_0x1352aa][_0x47074d(0x282)]+_0x47074d(0x18a),_0x47074d(0x1ce);}let _0x49b017=nodemailer[_0x47074d(0x212)]({'host':_0x5121a2[_0x47074d(0x1da)],'port':Number(_0x5121a2['port']),'secure':![],'auth':{'user':_0x5121a2[_0x47074d(0x193)],'pass':_0x5121a2[_0x47074d(0x220)]}}),_0x2ddf0b={'from':_0x5121a2[_0x47074d(0x193)],'to':_0x41e889[0x0][_0x47074d(0x1ab)],'subject':_0x47074d(0x191),'attachments':[{'filename':_0x47074d(0x1ca),'path':__dirname+_0x47074d(0x1c5)+'/upload/'+_0x20f62f[0x0][_0x47074d(0x238)],'cid':_0x47074d(0x2a0)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x47074d(0x25e)+_0x47074d(0x29f)+_0x47074d(0x1c2)+_0x47074d(0x29f)+_0x47074d(0x1f0)+'</div>'+_0x47074d(0x29f)+_0x47074d(0x20d)+_0x20f62f[0x0][_0x47074d(0x1ad)]+_0x47074d(0x199)+_0x47074d(0x264)+'</div>'+_0x47074d(0x19b)+_0x47074d(0x29f)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x47074d(0x284)+_0x1610ba[_0x47074d(0x1cc)]+'\x20'+_0x47074d(0x203)+_0x47074d(0x1f2)+_0x1610ba['date']+'\x20'+_0x47074d(0x23c)+_0x47074d(0x29b)+_0x47074d(0x264)+_0x47074d(0x28b)+_0x47074d(0x1ee)+_0x47074d(0x223)+_0x47074d(0x1fe)+_0x47074d(0x24f)+_0x47074d(0x283)+_0x47074d(0x298)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x47074d(0x18d)+_0x47074d(0x1bb)+_0x47074d(0x273)+'</tr>'+'</thead>'+_0x47074d(0x27f)+'\x20'+_0x198b46+'\x20'+_0x47074d(0x26a)+_0x47074d(0x25b)+_0x47074d(0x29f)+'<strong>\x20Regards\x20</strong>'+_0x47074d(0x195)+_0x20f62f[0x0]['site_title']+'</h5>'+_0x47074d(0x264)+_0x47074d(0x264)+_0x47074d(0x2ad)};_0x49b017[_0x47074d(0x1a0)](_0x2ddf0b,function(_0x2d3a92,_0x5214e5){var _0x181f71=_0x47074d;_0x2d3a92?(console['log'](_0x2d3a92),console[_0x181f71(0x236)](_0x181f71(0x23a))):console[_0x181f71(0x236)](_0x181f71(0x18f));}),_0x39fee8[_0x47074d(0x1fc)](_0x47074d(0x27e),'Purchase\x20data\x20added\x20successfully'),_0x554a09[_0x47074d(0x23f)](_0x47074d(0x1b0));}catch(_0x2b2113){console[_0x47074d(0x1e9)](_0x2b2113),_0x554a09['status'](0x1f4)[_0x47074d(0x285)]({'error':_0x47074d(0x1ed)});}})[_0x24642a(0x1f9)](_0x57a8ef=>{var _0x4a3534=_0x24642a;console[_0x4a3534(0x1e9)](_0x57a8ef),_0x554a09[_0x4a3534(0x23d)](0x1f4)[_0x4a3534(0x285)]({'error':'An\x20error\x20occurred.'});});}catch(_0x1ef139){console['log'](_0x1ef139);}}),router[a0_0x21da44(0x26c)](a0_0x21da44(0x1f7),auth,async(_0x2f6783,_0x31b85a)=>{var _0x49cc09=a0_0x21da44;try{const {username:_0x50f36e,email:_0x5141bb,role:_0x11a5bf}=_0x2f6783['user'],_0x3bf4d7=_0x2f6783[_0x49cc09(0x239)],_0x35fe29=await profile[_0x49cc09(0x1ae)]({'email':_0x3bf4d7[_0x49cc09(0x193)]}),_0x4d18b1=await master_shop['find'](),_0x3cc12a=_0x2f6783[_0x49cc09(0x2aa)]['id'],_0x4c0446=await purchases['findById'](_0x3cc12a),_0x32328c=await warehouse['aggregate']([{'$match':{'name':_0x4c0446[_0x49cc09(0x2b0)],'room':_0x4c0446[_0x49cc09(0x234)]}},{'$unwind':_0x49cc09(0x253)},{'$group':{'_id':_0x49cc09(0x1e7),'name':{'$first':_0x49cc09(0x1c7)},'product_stock':{'$first':_0x49cc09(0x198)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x49cc09(0x259)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x49cc09(0x2a9)},'secondary_code':{'$first':_0x49cc09(0x214)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x49cc09(0x296)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x49c092=await customer[_0x49cc09(0x1f8)]({});let _0xedef1c;if(_0x3bf4d7[_0x49cc09(0x196)]==_0x49cc09(0x29e)){const _0x943c4a=await staff[_0x49cc09(0x1ae)]({'email':_0x3bf4d7[_0x49cc09(0x193)]});_0xedef1c=await warehouse[_0x49cc09(0x1a9)]([{'$match':{'status':_0x49cc09(0x1aa),'name':_0x943c4a[_0x49cc09(0x202)]}},{'$group':{'_id':_0x49cc09(0x1a1),'name':{'$first':_0x49cc09(0x1a1)}}}]);}else _0xedef1c=await warehouse[_0x49cc09(0x1a9)]([{'$match':{'status':_0x49cc09(0x1aa)}},{'$group':{'_id':_0x49cc09(0x1a1),'name':{'$first':_0x49cc09(0x1a1)}}}]);const _0x2899d3=await product['find']({}),_0x388725=await suppliers[_0x49cc09(0x1f8)]({}),_0x23f2d5=BayBinSelected(_0x4c0446[_0x49cc09(0x2b0)],_0x4c0446[_0x49cc09(0x234)]);if(_0x4d18b1[0x0][_0x49cc09(0x213)]==_0x49cc09(0x215)){var _0x25743c=users[_0x49cc09(0x211)];console[_0x49cc09(0x236)](_0x25743c);}else{if(_0x4d18b1[0x0]['language']==_0x49cc09(0x22f))var _0x25743c=users[_0x49cc09(0x22f)];else{if(_0x4d18b1[0x0][_0x49cc09(0x213)]==_0x49cc09(0x29a))var _0x25743c=users['German'];else{if(_0x4d18b1[0x0]['language']==_0x49cc09(0x207))var _0x25743c=users['Spanish'];else{if(_0x4d18b1[0x0]['language']=='French')var _0x25743c=users[_0x49cc09(0x1b5)];else{if(_0x4d18b1[0x0][_0x49cc09(0x213)]=='Portuguese\x20(BR)')var _0x25743c=users[_0x49cc09(0x295)];else{if(_0x4d18b1[0x0][_0x49cc09(0x213)]==_0x49cc09(0x281))var _0x25743c=users['Chinese'];else{if(_0x4d18b1[0x0]['language']==_0x49cc09(0x277))var _0x25743c=users[_0x49cc09(0x1e1)];}}}}}}}_0x31b85a['render']('edit_purchases_view',{'success':_0x2f6783[_0x49cc09(0x1fc)](_0x49cc09(0x27e)),'errors':_0x2f6783['flash'](_0x49cc09(0x251)),'role':_0x3bf4d7,'profile':_0x35fe29,'customer':_0x49c092,'warehouse':_0xedef1c,'product':_0x32328c,'user':_0x4c0446,'master_shop':_0x4d18b1,'unit':_0x2899d3,'language':_0x25743c,'suppliers':_0x388725,'dataSelected':_0x23f2d5});}catch(_0xf23fd2){console[_0x49cc09(0x236)](_0xf23fd2);}}),router['post'](a0_0x21da44(0x1f7),auth,async(_0x570a64,_0x33a6f7)=>{var _0x28267f=a0_0x21da44;try{const _0x41c324=_0x570a64['params']['id'],{invoice:_0x19ecbf,warehouse_name:_0x26b45f,Room_name:_0x42947f}=_0x570a64['body'],_0x1a8a09=await warehouse[_0x28267f(0x1ae)]({'name':_0x26b45f,'room':_0x42947f}),_0x1ce5e6=await purchases['findOne']({'invoice':_0x19ecbf});_0x1ce5e6[_0x28267f(0x260)]['forEach'](_0x3ac9b0=>{var _0x241203=_0x28267f,_0x148a03=0x0;const _0x418bd3=_0x1a8a09[_0x241203(0x218)][_0x241203(0x276)](_0x88966c=>{var _0x13cd3b=_0x241203;_0x88966c[_0x13cd3b(0x1f6)]==_0x3ac9b0[_0x13cd3b(0x1f6)]&&_0x88966c[_0x13cd3b(0x282)]==_0x3ac9b0['floorlevel']&&_0x88966c['type']==_0x3ac9b0[_0x13cd3b(0x21f)]&&_0x88966c[_0x13cd3b(0x263)]==_0x3ac9b0['bin']&&_0x88966c[_0x13cd3b(0x200)]==_0x3ac9b0['bay']&&_0x88966c[_0x13cd3b(0x26f)]==_0x3ac9b0[_0x13cd3b(0x26f)]&&_0x88966c[_0x13cd3b(0x231)]==_0x3ac9b0[_0x13cd3b(0x231)]&&_0x88966c[_0x13cd3b(0x29c)]==_0x3ac9b0[_0x13cd3b(0x29c)]&&_0x88966c[_0x13cd3b(0x22e)]==_0x3ac9b0[_0x13cd3b(0x22e)]&&_0x88966c[_0x13cd3b(0x1e6)]==_0x3ac9b0[_0x13cd3b(0x1e6)]&&_0x88966c[_0x13cd3b(0x1e3)]==_0x3ac9b0[_0x13cd3b(0x1e3)]&&_0x88966c[_0x13cd3b(0x1fb)]==_0x3ac9b0['delivery_code']&&(_0x88966c['product_stock']=parseInt(_0x88966c['product_stock'])+parseInt(_0x3ac9b0[_0x13cd3b(0x23e)]),_0x148a03++);});_0x148a03=='0'&&(_0x1a8a09[_0x241203(0x218)]=_0x1a8a09[_0x241203(0x218)][_0x241203(0x20c)]({'product_name':_0x3ac9b0[_0x241203(0x1f6)],'product_stock':_0x3ac9b0[_0x241203(0x23e)],'primary_code':_0x3ac9b0[_0x241203(0x280)],'secondary_code':_0x3ac9b0[_0x241203(0x1ff)],'product_code':_0x3ac9b0[_0x241203(0x261)],'storage':_0x3ac9b0['storage'],'rack':_0x3ac9b0['rack'],'bay':_0x3ac9b0[_0x241203(0x200)],'bin':_0x3ac9b0[_0x241203(0x263)],'type':_0x3ac9b0['type'],'floorlevel':_0x3ac9b0[_0x241203(0x282)],'maxProducts':_0x3ac9b0[_0x241203(0x22a)],'unit':_0x3ac9b0[_0x241203(0x1d5)],'secondary_unit':_0x3ac9b0[_0x241203(0x24b)],'expiry_date':_0x3ac9b0[_0x241203(0x29c)],'maxPerUnit':_0x3ac9b0['maxperunit'],'batch_code':_0x3ac9b0[_0x241203(0x22e)],'alertQTY':_0x3ac9b0['alertQTY'],'production_date':_0x3ac9b0['production_date'],'delivery_date':_0x3ac9b0['delivery_date'],'delivery_code':_0x3ac9b0['delivery_code']}));}),await _0x1a8a09[_0x28267f(0x2a4)](),_0x1ce5e6['finalize']=_0x28267f(0x1fd);const _0x34aebb=await _0x1ce5e6[_0x28267f(0x2a4)]();_0x570a64[_0x28267f(0x1fc)](_0x28267f(0x27e),_0x28267f(0x1f3)),_0x33a6f7[_0x28267f(0x23f)](_0x28267f(0x258));}catch(_0x8c3968){console[_0x28267f(0x236)](_0x8c3968);}}),router[a0_0x21da44(0x26c)]('/view/:id',auth,async(_0x4518b1,_0x31fe20)=>{var _0x2329c7=a0_0x21da44;try{const {username:_0x42666e,email:_0x27fbbe,role:_0x178e7c}=_0x4518b1['user'],_0x4a8e1a=_0x4518b1[_0x2329c7(0x239)],_0x8fbc0=await profile[_0x2329c7(0x1ae)]({'email':_0x4a8e1a[_0x2329c7(0x193)]}),_0x4b6050=await master_shop['find'](),_0xeb4ae4=_0x4518b1['params']['id'],_0x5268e4=await purchases[_0x2329c7(0x227)](_0xeb4ae4),_0xf687cd=await suppliers[_0x2329c7(0x1f8)]({});let _0x48807f;if(_0x4a8e1a[_0x2329c7(0x196)]=='staff'){const _0x25018d=await staff[_0x2329c7(0x1ae)]({'email':_0x4a8e1a[_0x2329c7(0x193)]});_0x48807f=await warehouse['find']({'status':'Enabled','name':_0x25018d[_0x2329c7(0x202)],'warehouse_category':_0x2329c7(0x208)});}else _0x48807f=await warehouse[_0x2329c7(0x1a9)]([{'$match':{'status':_0x2329c7(0x1aa),'warehouse_category':_0x2329c7(0x208)}},{'$group':{'_id':_0x2329c7(0x1a1),'name':{'$first':_0x2329c7(0x1a1)}}}]);const _0x4fedfd=await product['find']({}),_0xd5e6c6=BayBinSelected(_0x5268e4[_0x2329c7(0x2b0)],_0x5268e4[_0x2329c7(0x234)]);let _0x396ad4=new Date(_0x5268e4[_0x2329c7(0x29c)]),_0x27eb6a=('0'+_0x396ad4['getDate']())[_0x2329c7(0x1f1)](-0x2),_0x4f070c=('0'+(_0x396ad4['getMonth']()+0x1))[_0x2329c7(0x1f1)](-0x2),_0x1bb822=_0x396ad4[_0x2329c7(0x269)](),_0x1c011e=_0x1bb822+'-'+_0x4f070c+'-'+_0x27eb6a;if(_0x4b6050[0x0]['language']==_0x2329c7(0x215)){var _0x130a58=users['English'];console['log'](_0x130a58);}else{if(_0x4b6050[0x0][_0x2329c7(0x213)]=='Hindi')var _0x130a58=users[_0x2329c7(0x22f)];else{if(_0x4b6050[0x0][_0x2329c7(0x213)]==_0x2329c7(0x29a))var _0x130a58=users['German'];else{if(_0x4b6050[0x0][_0x2329c7(0x213)]==_0x2329c7(0x207))var _0x130a58=users['Spanish'];else{if(_0x4b6050[0x0][_0x2329c7(0x213)]==_0x2329c7(0x1b5))var _0x130a58=users['French'];else{if(_0x4b6050[0x0][_0x2329c7(0x213)]=='Portuguese\x20(BR)')var _0x130a58=users['Portuguese'];else{if(_0x4b6050[0x0]['language']=='Chinese')var _0x130a58=users[_0x2329c7(0x281)];else{if(_0x4b6050[0x0]['language']==_0x2329c7(0x277))var _0x130a58=users[_0x2329c7(0x1e1)];}}}}}}}_0x31fe20[_0x2329c7(0x192)](_0x2329c7(0x2a6),{'success':_0x4518b1[_0x2329c7(0x1fc)](_0x2329c7(0x27e)),'errors':_0x4518b1[_0x2329c7(0x1fc)](_0x2329c7(0x251)),'role':_0x4a8e1a,'profile':_0x8fbc0,'purchases':_0x5268e4,'suppliers':_0xf687cd,'warehouse':_0x48807f,'product':_0x4fedfd,'master_shop':_0x4b6050,'language':_0x130a58,'ed_fullDate':_0x1c011e,'dataSelected':_0xd5e6c6});}catch(_0x49601a){console[_0x2329c7(0x236)](_0x49601a);}}),router[a0_0x21da44(0x25d)](a0_0x21da44(0x19c),auth,async(_0x5992ee,_0x34403d)=>{var _0x693277=a0_0x21da44;try{const _0x35094d=_0x5992ee[_0x693277(0x2aa)]['id'],_0x4b08a5=await purchases['findOne']({'_id':_0x5992ee[_0x693277(0x2aa)]['id']}),_0xf8d105=await warehouse[_0x693277(0x1ae)]({'name':_0x4b08a5[_0x693277(0x2b0)],'room':_0x4b08a5['room']});_0x4b08a5['product'][_0x693277(0x249)](_0x2bd899=>{var _0x5f21d3=_0x693277;const _0x258e1e=_0xf8d105[_0x5f21d3(0x218)][_0x5f21d3(0x276)](_0x132b66=>{var _0x44394c=_0x5f21d3;_0x132b66[_0x44394c(0x1f6)]==_0x2bd899[_0x44394c(0x1f6)]&&_0x132b66[_0x44394c(0x282)]==_0x2bd899[_0x44394c(0x282)]&&_0x132b66[_0x44394c(0x21f)]==_0x2bd899[_0x44394c(0x21f)]&&_0x132b66[_0x44394c(0x263)]==_0x2bd899[_0x44394c(0x263)]&&_0x132b66['bay']==_0x2bd899[_0x44394c(0x200)]&&_0x132b66['rack']==_0x2bd899[_0x44394c(0x26f)]&&_0x132b66[_0x44394c(0x231)]==_0x2bd899[_0x44394c(0x231)]&&(_0x132b66[_0x44394c(0x2ab)]=parseInt(_0x132b66[_0x44394c(0x2ab)])-parseInt(_0x2bd899[_0x44394c(0x23e)]));});}),await _0xf8d105[_0x693277(0x2a4)]();const {invoice:_0x176e09,suppliers:_0x211ffa,date:_0x3d2381,warehouse_name:_0x5b4334,prod_name:_0xa79e87,prod_code:_0x3b9eca,prod_qty:_0x58f885,prod_unit:_0x34b669,prod_secondunit:_0x2671a9,prod_level:_0x14dd29,prod_isle:_0x304bd9,prod_pallet:_0x5892d4,note:_0x437a72,expiry_date:_0x184f68,batch_code:_0x2fd8d5,paid_amount:_0x44347c,due_amount:_0x2e135b,Room_name:_0x3bbc26,primary_code:_0x478738,secondary_code:_0x451718,PO_number:_0x1ae594,JO_number:_0x3a3bfe}=_0x5992ee[_0x693277(0x23b)];if(typeof _0xa79e87=='string')var _0x346402=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x29d)]],_0x170285=[_0x5992ee['body'][_0x693277(0x247)]],_0x15ac91=[_0x5992ee['body'][_0x693277(0x1fa)]],_0x3b451c=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x28f)]],_0x3ce59c=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x1d0)]],_0x540d38=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x228)]],_0x162948=[_0x5992ee[_0x693277(0x23b)]['prod_isle']],_0x3ed067=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x1b1)]],_0x5664d9=[_0x5992ee['body']['primary_code']],_0xf4605c=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x1ff)]],_0x3938d6=[_0x5992ee['body'][_0x693277(0x224)]],_0x42318e=[_0x5992ee['body']['batch_code']],_0x1103fb=[_0x5992ee['body'][_0x693277(0x29c)]],_0x333cea=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x231)]],_0x352658=[_0x5992ee[_0x693277(0x23b)]['rak']],_0x46e2b9=[_0x5992ee[_0x693277(0x23b)][_0x693277(0x21f)]];else var _0x346402=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x29d)]],_0x170285=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x247)]],_0x15ac91=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x1fa)]],_0x3b451c=[..._0x5992ee[_0x693277(0x23b)]['prod_unit']],_0x3ce59c=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x1d0)]],_0x540d38=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x228)]],_0x162948=[..._0x5992ee['body'][_0x693277(0x19e)]],_0x3ed067=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x1b1)]],_0x5664d9=[..._0x5992ee['body']['primary_code']],_0xf4605c=[..._0x5992ee['body']['secondary_code']],_0x3938d6=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x224)]],_0x42318e=[..._0x5992ee[_0x693277(0x23b)]['batch_code']],_0x1103fb=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x29c)]],_0x333cea=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x231)]],_0x352658=[..._0x5992ee[_0x693277(0x23b)]['rak']],_0x46e2b9=[..._0x5992ee[_0x693277(0x23b)][_0x693277(0x21f)]];const _0x1f925a=_0x346402[_0x693277(0x276)](_0x5d3fc1=>{return _0x5d3fc1={'product_name':_0x5d3fc1};});_0x170285[_0x693277(0x249)]((_0x1eb1b7,_0x4b2ceb)=>{var _0x25002f=_0x693277;_0x1f925a[_0x4b2ceb][_0x25002f(0x261)]=_0x1eb1b7;}),_0x15ac91['forEach']((_0x45e66b,_0x2f7573)=>{var _0x1e3117=_0x693277;_0x1f925a[_0x2f7573][_0x1e3117(0x23e)]=_0x45e66b;}),_0x3b451c[_0x693277(0x249)]((_0x5689ff,_0x36f874)=>{_0x1f925a[_0x36f874]['standard_unit']=_0x5689ff;}),_0x3ce59c[_0x693277(0x249)]((_0x490375,_0x5e4edb)=>{_0x1f925a[_0x5e4edb]['secondary_unit']=_0x490375;}),_0x540d38[_0x693277(0x249)]((_0x28151d,_0x27c2ff)=>{_0x1f925a[_0x27c2ff]['bay']=_0x28151d;}),_0x162948['forEach']((_0x5eba86,_0x23da91)=>{var _0x13cc77=_0x693277;_0x1f925a[_0x23da91][_0x13cc77(0x263)]=_0x5eba86;}),_0x3ed067['forEach']((_0x551d16,_0x212a4b)=>{var _0x239881=_0x693277;_0x1f925a[_0x212a4b][_0x239881(0x282)]=_0x551d16;}),_0x5664d9[_0x693277(0x249)]((_0x133cb0,_0x15e298)=>{_0x1f925a[_0x15e298]['primary_code']=_0x133cb0;}),_0xf4605c[_0x693277(0x249)]((_0x1dbb03,_0x12016a)=>{var _0x5e500e=_0x693277;_0x1f925a[_0x12016a][_0x5e500e(0x1ff)]=_0x1dbb03;}),_0x3938d6[_0x693277(0x249)]((_0x1a0711,_0x105c1b)=>{var _0x82bfab=_0x693277;_0x1f925a[_0x105c1b][_0x82bfab(0x22a)]=_0x1a0711;}),_0x42318e[_0x693277(0x249)]((_0x2c4dff,_0x1587fc)=>{var _0x12e7ae=_0x693277;_0x1f925a[_0x1587fc][_0x12e7ae(0x22e)]=_0x2c4dff;}),_0x1103fb['forEach']((_0x252df1,_0x1f167e)=>{var _0x18951c=_0x693277;_0x1f925a[_0x1f167e][_0x18951c(0x29c)]=_0x252df1;}),_0x46e2b9[_0x693277(0x249)]((_0x4fbcd2,_0xc6b9be)=>{var _0x1fc73b=_0x693277;_0x1f925a[_0xc6b9be][_0x1fc73b(0x21f)]=_0x4fbcd2;}),_0x333cea[_0x693277(0x249)]((_0xfd9302,_0x26542e)=>{_0x1f925a[_0x26542e]['storage']=_0xfd9302;}),_0x352658[_0x693277(0x249)]((_0x14b5c2,_0x41534e)=>{_0x1f925a[_0x41534e]['rack']=_0x14b5c2;});const _0x30ec5d=_0x1f925a[_0x693277(0x219)](_0x47fa9d=>_0x47fa9d['quantity']!=='0'&&_0x47fa9d[_0x693277(0x23e)]!=='');_0x4b08a5[_0x693277(0x1cc)]=_0x176e09,_0x4b08a5[_0x693277(0x1dd)]=_0x211ffa,_0x4b08a5[_0x693277(0x204)]=_0x3d2381,_0x4b08a5[_0x693277(0x2b0)]=_0x5b4334,_0x4b08a5[_0x693277(0x260)]=_0x30ec5d,_0x4b08a5[_0x693277(0x299)]=_0x437a72,_0x4b08a5[_0x693277(0x289)]=_0x44347c,_0x4b08a5[_0x693277(0x21d)]=_0x2e135b,_0x4b08a5[_0x693277(0x234)]=_0x3bbc26,_0x4b08a5[_0x693277(0x252)]=_0x1ae594,_0x4b08a5[_0x693277(0x25c)]=_0x3a3bfe;const _0x289393=await _0x4b08a5[_0x693277(0x2a4)](),_0x5cb67e=await warehouse[_0x693277(0x1ae)]({'name':_0x5992ee[_0x693277(0x23b)][_0x693277(0x2b0)],'room':_0x5992ee[_0x693277(0x23b)][_0x693277(0x1bf)]});_0x4b08a5[_0x693277(0x260)][_0x693277(0x249)](_0x26e789=>{var _0x419e97=_0x693277,_0x3b2388=0x0;const _0x1787d4=_0x5cb67e[_0x419e97(0x218)]['map'](_0x102ceb=>{var _0x5c7819=_0x419e97;_0x102ceb[_0x5c7819(0x1f6)]==_0x26e789['product_name']&&_0x102ceb['floorlevel']==_0x26e789[_0x5c7819(0x282)]&&_0x102ceb[_0x5c7819(0x21f)]==_0x26e789[_0x5c7819(0x21f)]&&_0x102ceb[_0x5c7819(0x263)]==_0x26e789[_0x5c7819(0x263)]&&_0x102ceb['bay']==_0x26e789[_0x5c7819(0x200)]&&_0x102ceb[_0x5c7819(0x26f)]==_0x26e789[_0x5c7819(0x26f)]&&_0x102ceb[_0x5c7819(0x231)]==_0x26e789[_0x5c7819(0x231)]&&(_0x102ceb['product_stock']=parseInt(_0x102ceb[_0x5c7819(0x2ab)])+parseInt(_0x26e789[_0x5c7819(0x23e)]),_0x3b2388++);});_0x3b2388=='0'&&(_0x5cb67e[_0x419e97(0x218)]=_0x5cb67e[_0x419e97(0x218)][_0x419e97(0x20c)]({'product_name':_0x26e789[_0x419e97(0x1f6)],'product_stock':_0x26e789[_0x419e97(0x23e)],'primary_code':_0x26e789['primary_code'],'secondary_code':_0x26e789['secondary_code'],'product_code':_0x26e789[_0x419e97(0x261)],'storage':_0x26e789[_0x419e97(0x231)],'rack':_0x26e789[_0x419e97(0x26f)],'bay':_0x26e789[_0x419e97(0x200)],'bin':_0x26e789['bin'],'type':_0x26e789[_0x419e97(0x21f)],'floorlevel':_0x26e789[_0x419e97(0x282)],'maxProducts':_0x26e789[_0x419e97(0x22a)],'unit':_0x26e789[_0x419e97(0x1d5)],'secondary_unit':_0x26e789[_0x419e97(0x24b)],'expiry_date':_0x26e789['expiry_date']}));}),await _0x5cb67e['save']();const _0x93846d=await s_payment_data[_0x693277(0x1ae)]({'invoice':_0x5992ee[_0x693277(0x23b)][_0x693277(0x1cc)]});if(_0x93846d===null){}else console[_0x693277(0x236)](_0x693277(0x1dd),_0x93846d,_0x5992ee[_0x693277(0x23b)][_0x693277(0x1cc)]),_0x93846d[_0x693277(0x1dd)]=_0x5992ee['body'][_0x693277(0x1dd)],await _0x93846d[_0x693277(0x2a4)]();_0x5992ee[_0x693277(0x1fc)](_0x693277(0x27e),_0x693277(0x244)),_0x34403d[_0x693277(0x23f)](_0x693277(0x258));}catch(_0x6a96c7){console[_0x693277(0x236)](_0x6a96c7);}}),router[a0_0x21da44(0x25d)](a0_0x21da44(0x232),auth,async(_0x29dec7,_0x5a5e33)=>{var _0x101479=a0_0x21da44;try{const _0x492514=_0x29dec7['params']['id'],{invoice:_0x51fdda,suppliers:_0x576c65,payable:_0x3a267f,due_amount:_0x1ce901}=_0x29dec7[_0x101479(0x23b)],_0x1b9a52=await purchases['findById'](_0x492514);var _0x22d82b=_0x3a267f-_0x1ce901;_0x1b9a52[_0x101479(0x289)]=parseFloat(_0x1b9a52[_0x101479(0x289)])+parseFloat(_0x1ce901),_0x1b9a52[_0x101479(0x21d)]=_0x22d82b;const _0x68a21=await _0x1b9a52[_0x101479(0x2a4)]();console['log'](_0x68a21);const _0x358a19=await s_payment_data['findOne']({'invoice':_0x51fdda});_0x358a19[_0x101479(0x292)]=_0x22d82b,await _0x358a19['save']();let _0x309d4d=new Date(),_0x5da45d=('0'+_0x309d4d[_0x101479(0x1ea)]())[_0x101479(0x1f1)](-0x2),_0x162201=('0'+(_0x309d4d[_0x101479(0x243)]()+0x1))['slice'](-0x2),_0x4e4368=_0x309d4d[_0x101479(0x269)](),_0x2a1346=_0x4e4368+'-'+_0x162201+'-'+_0x5da45d;const _0x3e87b9=new suppliers_payment({'invoice':_0x51fdda,'date':_0x4e4368+'-'+_0x162201+'-'+_0x5da45d,'suppliers':_0x576c65,'reason':_0x101479(0x240),'amount':_0x1ce901}),_0x560dbf=await _0x3e87b9[_0x101479(0x2a4)]();_0x29dec7[_0x101479(0x1fc)](_0x101479(0x27e),_0x101479(0x21e)),_0x5a5e33[_0x101479(0x23f)](_0x101479(0x258));}catch(_0x20d635){console['log'](_0x20d635);}}),router[a0_0x21da44(0x26c)]('/invoice/:id',auth,async(_0x67025a,_0x7d67df)=>{var _0x427f27=a0_0x21da44;try{const {username:_0x476dc3,email:_0x284ed3,role:_0x4a496f}=_0x67025a['user'],_0x236ea9=_0x67025a['user'],_0x1470ed=await profile[_0x427f27(0x1ae)]({'email':_0x236ea9['email']}),_0x574140=await master_shop[_0x427f27(0x1f8)]();console[_0x427f27(0x236)]('master',_0x574140);const _0x432d0b=_0x67025a[_0x427f27(0x2aa)]['id'],_0x96d9e2=await purchases[_0x427f27(0x227)](_0x432d0b);console[_0x427f27(0x236)](_0x96d9e2);const _0x16b2ee=await suppliers[_0x427f27(0x1ae)]({'name':_0x96d9e2['suppliers']});console[_0x427f27(0x236)](_0x16b2ee);if(_0x574140[0x0][_0x427f27(0x213)]=='English\x20(US)'){var _0x4bf980=users[_0x427f27(0x211)];console['log'](_0x4bf980);}else{if(_0x574140[0x0][_0x427f27(0x213)]==_0x427f27(0x22f))var _0x4bf980=users[_0x427f27(0x22f)];else{if(_0x574140[0x0][_0x427f27(0x213)]==_0x427f27(0x29a))var _0x4bf980=users[_0x427f27(0x29a)];else{if(_0x574140[0x0]['language']==_0x427f27(0x207))var _0x4bf980=users[_0x427f27(0x207)];else{if(_0x574140[0x0][_0x427f27(0x213)]==_0x427f27(0x1b5))var _0x4bf980=users[_0x427f27(0x1b5)];else{if(_0x574140[0x0][_0x427f27(0x213)]==_0x427f27(0x242))var _0x4bf980=users[_0x427f27(0x295)];else{if(_0x574140[0x0][_0x427f27(0x213)]=='Chinese')var _0x4bf980=users['Chinese'];else{if(_0x574140[0x0][_0x427f27(0x213)]==_0x427f27(0x277))var _0x4bf980=users[_0x427f27(0x1e1)];}}}}}}}_0x7d67df[_0x427f27(0x192)](_0x427f27(0x2a2),{'success':_0x67025a[_0x427f27(0x1fc)](_0x427f27(0x27e)),'errors':_0x67025a[_0x427f27(0x1fc)](_0x427f27(0x251)),'role':_0x236ea9,'profile':_0x1470ed,'master_shop':_0x574140,'supplier':_0x16b2ee,'purchase':_0x96d9e2,'language':_0x4bf980});}catch(_0x3a351a){console[_0x427f27(0x236)](_0x3a351a);}}),router[a0_0x21da44(0x26c)](a0_0x21da44(0x1c1),auth,async(_0x2ca790,_0x4fc4bd)=>{var _0x3ef637=a0_0x21da44;try{const {username:_0x3f2da8,email:_0x5419a5,role:_0x4e8e06}=_0x2ca790[_0x3ef637(0x239)],_0x3ccad6=_0x2ca790['user'],_0x5df1eb=await profile[_0x3ef637(0x1ae)]({'email':_0x3ccad6['email']}),_0x3f5389=await master_shop[_0x3ef637(0x1f8)]();console[_0x3ef637(0x236)](_0x3ef637(0x28e),_0x3f5389);const _0x1fe96c=_0x2ca790[_0x3ef637(0x2aa)]['id'];console['log'](_0x1fe96c);const _0x16ea24=await purchases[_0x3ef637(0x227)](_0x1fe96c);console['log']('user_id',_0x16ea24);const _0x3796f1=await product['find']({}),_0x93fdc=await warehouse[_0x3ef637(0x1a9)]([{'$match':{'name':_0x16ea24['warehouse_name'],'room':_0x16ea24[_0x3ef637(0x234)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x3ef637(0x253)},{'$group':{'_id':_0x3ef637(0x1e7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3ef637(0x198)},'bay':{'$first':_0x3ef637(0x290)},'bin':{'$first':_0x3ef637(0x1a3)},'type':{'$first':_0x3ef637(0x259)},'floorlevel':{'$first':_0x3ef637(0x194)},'primary_code':{'$first':_0x3ef637(0x2a9)},'secondary_code':{'$first':_0x3ef637(0x214)},'product_code':{'$first':_0x3ef637(0x245)},'storage':{'$first':_0x3ef637(0x189)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x3ef637(0x278),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3ef637(0x1a1),'name':{'$first':_0x3ef637(0x1a1)}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0x93fdc);if(_0x3f5389[0x0][_0x3ef637(0x213)]==_0x3ef637(0x215)){var _0x2dfa70=users[_0x3ef637(0x211)];console[_0x3ef637(0x236)](_0x2dfa70);}else{if(_0x3f5389[0x0][_0x3ef637(0x213)]==_0x3ef637(0x22f))var _0x2dfa70=users[_0x3ef637(0x22f)];else{if(_0x3f5389[0x0][_0x3ef637(0x213)]=='German')var _0x2dfa70=users['German'];else{if(_0x3f5389[0x0][_0x3ef637(0x213)]==_0x3ef637(0x207))var _0x2dfa70=users[_0x3ef637(0x207)];else{if(_0x3f5389[0x0][_0x3ef637(0x213)]==_0x3ef637(0x1b5))var _0x2dfa70=users[_0x3ef637(0x1b5)];else{if(_0x3f5389[0x0][_0x3ef637(0x213)]==_0x3ef637(0x242))var _0x2dfa70=users[_0x3ef637(0x295)];else{if(_0x3f5389[0x0][_0x3ef637(0x213)]=='Chinese')var _0x2dfa70=users[_0x3ef637(0x281)];else{if(_0x3f5389[0x0][_0x3ef637(0x213)]==_0x3ef637(0x277))var _0x2dfa70=users[_0x3ef637(0x1e1)];}}}}}}}_0x4fc4bd[_0x3ef637(0x192)](_0x3ef637(0x24e),{'success':_0x2ca790['flash'](_0x3ef637(0x27e)),'errors':_0x2ca790['flash'](_0x3ef637(0x251)),'role':_0x3ccad6,'profile':_0x5df1eb,'user':_0x16ea24,'stock':_0x93fdc,'master_shop':_0x3f5389,'product':_0x3796f1,'language':_0x2dfa70,'warehouse':warehouse_data});}catch(_0x15c1a6){console[_0x3ef637(0x236)](_0x15c1a6);}}),router['post'](a0_0x21da44(0x1c1),auth,async(_0xf1703b,_0x186fcb)=>{var _0x40fa5f=a0_0x21da44;try{const {invoice:_0x508863,date:_0x178c27,warehouse_name:_0x166d25,Room_name:_0x5c4637,product_name:_0x1bb3af,purchase_quantity:_0x14a996,stocks:_0x8cc23b,return_qty:_0x380510,note:_0x186953,level:_0x3927c4,isle:_0x59f2be,pallet:_0x151bbc,to_warehouse_name:_0x5c49e9,to_Room_name:_0x40cd73}=_0xf1703b['body'],_0xec026b=await purchases[_0x40fa5f(0x1ae)]({'_id':_0xf1703b['params']['id']}),_0x544f1e=await warehouse['findOne']({'name':_0x166d25,'room':_0x5c4637});if(typeof _0x1bb3af==_0x40fa5f(0x1d7))var _0x12aba0=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1f6)]],_0x572503=[_0xf1703b[_0x40fa5f(0x23b)]['purchase_quantity']],_0x55c9b7=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x18b)]],_0x581b4e=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x19d)]],_0x151047=[_0xf1703b['body'][_0x40fa5f(0x1de)]],_0x16500a=[_0xf1703b[_0x40fa5f(0x23b)]['isle']],_0x25a209=[_0xf1703b['body'][_0x40fa5f(0x222)]],_0x4a28ee=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1c4)]],_0x46e977=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x26e)]],_0x29d780=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x288)]],_0x2a89=[_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1e5)]];else var _0x12aba0=[..._0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1f6)]],_0x572503=[..._0xf1703b['body'][_0x40fa5f(0x27a)]],_0x55c9b7=[..._0xf1703b['body']['stocks']],_0x581b4e=[..._0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x19d)]],_0x151047=[..._0xf1703b['body'][_0x40fa5f(0x1de)]],_0x16500a=[..._0xf1703b['body'][_0x40fa5f(0x21a)]],_0x25a209=[..._0xf1703b['body']['pallet']],_0x4a28ee=[..._0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1c4)]],_0x46e977=[..._0xf1703b['body'][_0x40fa5f(0x26e)]],_0x29d780=[..._0xf1703b[_0x40fa5f(0x23b)]['primary_code_hide']],_0x2a89=[..._0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1e5)]];const _0x5afe22=_0x12aba0[_0x40fa5f(0x276)](_0x2ca9a2=>{return _0x2ca9a2={'product_name':_0x2ca9a2};});_0x572503[_0x40fa5f(0x249)]((_0x1b6667,_0x3385e6)=>{var _0x2b804e=_0x40fa5f;_0x5afe22[_0x3385e6][_0x2b804e(0x27a)]=_0x1b6667;}),_0x55c9b7[_0x40fa5f(0x249)]((_0x6c5309,_0x1510ea)=>{var _0x152734=_0x40fa5f;_0x5afe22[_0x1510ea][_0x152734(0x250)]=_0x6c5309;}),_0x581b4e[_0x40fa5f(0x249)]((_0x5506ed,_0x4ad91)=>{_0x5afe22[_0x4ad91]['return_qty']=_0x5506ed;}),_0x151047[_0x40fa5f(0x249)]((_0x4660b9,_0xdf4715)=>{var _0x21d531=_0x40fa5f;_0x5afe22[_0xdf4715][_0x21d531(0x200)]=_0x4660b9;}),_0x16500a['forEach']((_0x5aaf7b,_0x2cd421)=>{var _0x5a9176=_0x40fa5f;_0x5afe22[_0x2cd421][_0x5a9176(0x263)]=_0x5aaf7b;}),_0x25a209['forEach']((_0xbb9ed6,_0x1414c7)=>{var _0x3098e5=_0x40fa5f;_0x5afe22[_0x1414c7][_0x3098e5(0x282)]=_0xbb9ed6;}),_0x4a28ee[_0x40fa5f(0x249)]((_0x477a44,_0x54e243)=>{var _0x32c59a=_0x40fa5f;_0x5afe22[_0x54e243][_0x32c59a(0x21f)]=_0x477a44;}),_0x46e977[_0x40fa5f(0x249)]((_0x4b308b,_0x111840)=>{var _0x2853ae=_0x40fa5f;_0x5afe22[_0x111840][_0x2853ae(0x261)]=_0x4b308b;}),_0x29d780[_0x40fa5f(0x249)]((_0x256857,_0xfe4ec2)=>{var _0xdf33a4=_0x40fa5f;_0x5afe22[_0xfe4ec2][_0xdf33a4(0x280)]=_0x256857;}),_0x2a89['forEach']((_0xb1c1e8,_0x252787)=>{var _0x3cadb4=_0x40fa5f;_0x5afe22[_0x252787][_0x3cadb4(0x1ff)]=_0xb1c1e8;}),_0xec026b[_0x40fa5f(0x260)][_0x40fa5f(0x249)](_0x38ad44=>{var _0x34f24b=_0x40fa5f;const _0x337491=_0x544f1e[_0x34f24b(0x218)][_0x34f24b(0x276)](_0x43e602=>{var _0x3900a9=_0x34f24b;_0x43e602[_0x3900a9(0x1f6)]==_0x38ad44[_0x3900a9(0x1f6)]&&_0x43e602[_0x3900a9(0x282)]==_0x38ad44[_0x3900a9(0x282)]&&_0x43e602[_0x3900a9(0x21f)]==_0x38ad44[_0x3900a9(0x21f)]&&_0x43e602[_0x3900a9(0x263)]==_0x38ad44[_0x3900a9(0x263)]&&_0x43e602[_0x3900a9(0x200)]==_0x38ad44[_0x3900a9(0x200)]&&_0x43e602['rack']==_0x38ad44[_0x3900a9(0x26f)]&&_0x43e602[_0x3900a9(0x231)]==_0x38ad44[_0x3900a9(0x231)]&&(console[_0x3900a9(0x236)](parseInt(_0x43e602['product_stock'])+_0x3900a9(0x21c)+parseInt(_0x38ad44[_0x3900a9(0x23e)])),_0x43e602[_0x3900a9(0x2ab)]=parseInt(_0x43e602[_0x3900a9(0x2ab)])+parseInt(_0x38ad44[_0x3900a9(0x23e)]));});}),await _0x544f1e[_0x40fa5f(0x2a4)]();const _0x494041=_0x5afe22[_0x40fa5f(0x219)](_0x53f502=>_0x53f502[_0x40fa5f(0x19d)]!=='0'&&_0x53f502[_0x40fa5f(0x19d)]!=='');var _0x174986=0x0;_0x494041[_0x40fa5f(0x249)](_0xd0cd4f=>{var _0xf8f734=_0x40fa5f;console[_0xf8f734(0x236)](_0xf8f734(0x291),_0xd0cd4f),(parseInt(_0xd0cd4f['purchase_quantity'])<parseInt(_0xd0cd4f[_0xf8f734(0x19d)])||parseInt(_0xd0cd4f['stock_quantity'])<parseInt(_0xd0cd4f[_0xf8f734(0x19d)]))&&_0x174986++;});if(_0x174986!=0x0)return _0xf1703b[_0x40fa5f(0x1fc)](_0x40fa5f(0x251),_0x40fa5f(0x1cb)),_0x186fcb[_0x40fa5f(0x23f)](_0x40fa5f(0x26b));const _0x3110c5=new purchases_return({'invoice':_0x508863,'suppliers':_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1dd)],'date':_0x178c27,'warehouse_name':_0x166d25,'return_product':_0x494041,'note':_0x186953,'room':_0x5c4637,'to_warehouse_name':_0x5c49e9,'to_room':_0x40cd73}),_0x46c7e6=await _0x3110c5['save']();console['log'](_0x3110c5);const _0x27f6e1=await purchases_return[_0x40fa5f(0x1ae)]({'invoice':_0x508863}),_0x7e1cec=await warehouse[_0x40fa5f(0x1ae)]({'name':_0x5c49e9,'room':_0x40cd73});_0x27f6e1[_0x40fa5f(0x2a8)][_0x40fa5f(0x249)](_0x2ad570=>{var _0x4f5f1d=_0x40fa5f,_0x59e66d=0x0;const _0x34a5b9=_0x7e1cec[_0x4f5f1d(0x218)]['map'](_0x13252f=>{var _0x4e3b68=_0x4f5f1d;_0x13252f[_0x4e3b68(0x1f6)]==_0x2ad570[_0x4e3b68(0x1f6)]&&_0x13252f[_0x4e3b68(0x282)]==_0x2ad570[_0x4e3b68(0x282)]&&_0x13252f['type']==_0x2ad570[_0x4e3b68(0x21f)]&&_0x13252f[_0x4e3b68(0x263)]==_0x2ad570['bin']&&_0x13252f[_0x4e3b68(0x200)]==_0x2ad570['bay']&&(_0x13252f['product_stock']=parseInt(_0x13252f[_0x4e3b68(0x2ab)])-parseInt(_0x2ad570[_0x4e3b68(0x19d)]),_0x59e66d++);});_0x59e66d=='0'&&(_0x7e1cec[_0x4f5f1d(0x218)]=_0x7e1cec[_0x4f5f1d(0x218)][_0x4f5f1d(0x20c)]({'product_name':_0x2ad570[_0x4f5f1d(0x1f6)],'product_stock':_0x2ad570[_0x4f5f1d(0x19d)],'primary_code':_0x2ad570[_0x4f5f1d(0x280)],'secondary_code':_0x2ad570[_0x4f5f1d(0x1ff)],'product_code':_0x2ad570['product_code'],'storage':_0x2ad570[_0x4f5f1d(0x231)],'rack':_0x2ad570['rack'],'bay':_0x2ad570[_0x4f5f1d(0x200)],'bin':_0x2ad570[_0x4f5f1d(0x263)],'type':_0x2ad570['type'],'floorlevel':_0x2ad570[_0x4f5f1d(0x282)],'maxProducts':_0x2ad570[_0x4f5f1d(0x22a)],'unit':_0x2ad570[_0x4f5f1d(0x1d5)],'secondary_unit':_0x2ad570[_0x4f5f1d(0x24b)],'expiry_date':_0x2ad570[_0x4f5f1d(0x29c)]}));}),await _0x7e1cec['save']();const _0x4523ab=await purchases['findOne']({'invoice':_0x508863});_0x4523ab[_0x40fa5f(0x1d2)]='True';const _0x4a75a9=await _0x4523ab[_0x40fa5f(0x2a4)](),_0x2da4d5=new s_payment_data({'invoice':_0x508863,'suppliers':_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1dd)],'reason':'Purchase\x20Return'});await _0x2da4d5[_0x40fa5f(0x2a4)]();const _0x255194=await master_shop['find']();console['log'](_0x40fa5f(0x2a3),_0x255194[0x0]['image']);const _0x50a6c7=await email_settings[_0x40fa5f(0x1ae)](),_0x1d8743=await suppliers['findOne']({'name':_0xf1703b[_0x40fa5f(0x23b)][_0x40fa5f(0x1dd)]});console[_0x40fa5f(0x236)](_0x40fa5f(0x257),_0x1d8743);_0x255194[0x0][_0x40fa5f(0x216)]==0x1?(right_currency=_0x255194[0x0][_0x40fa5f(0x254)],left_currency=''):(right_currency='',left_currency=_0x255194[0x0][_0x40fa5f(0x254)]);var _0x758b1b=_0x12aba0,_0x3c788f=_0x581b4e,_0x2240e4='',_0x37bf43;for(_0x37bf43 in _0x758b1b){_0x2240e4+=_0x40fa5f(0x223)+_0x40fa5f(0x1d1)+_0x758b1b[_0x37bf43]+_0x40fa5f(0x18a)+_0x40fa5f(0x1d1)+_0x3c788f[_0x37bf43]+'</td>'+'</tr>';}console[_0x40fa5f(0x236)]('product_list',_0x2240e4);let _0x57b1f7=nodemailer[_0x40fa5f(0x212)]({'service':'gmail','auth':{'user':_0x50a6c7[_0x40fa5f(0x193)],'pass':_0x50a6c7[_0x40fa5f(0x220)]}}),_0x31a2e8={'from':_0x50a6c7['email'],'to':_0x1d8743[_0x40fa5f(0x193)],'subject':_0x40fa5f(0x1a7),'attachments':[{'filename':_0x40fa5f(0x1ca),'path':__dirname+_0x40fa5f(0x1c5)+_0x40fa5f(0x24c)+_0x255194[0x0]['image'],'cid':_0x40fa5f(0x2a0)}],'html':_0x40fa5f(0x19a)+_0x40fa5f(0x19f)+_0x40fa5f(0x25e)+'<div>'+_0x40fa5f(0x1c2)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x40fa5f(0x264)+_0x40fa5f(0x29f)+'<h2>\x20'+_0x255194[0x0][_0x40fa5f(0x1ad)]+_0x40fa5f(0x199)+_0x40fa5f(0x264)+_0x40fa5f(0x264)+_0x40fa5f(0x19b)+_0x40fa5f(0x29f)+_0x40fa5f(0x1c3)+_0x40fa5f(0x284)+_0x508863+'\x20'+_0x40fa5f(0x203)+_0x40fa5f(0x1f2)+_0x178c27+'\x20'+_0x40fa5f(0x23c)+_0x40fa5f(0x29b)+'</div>'+_0x40fa5f(0x28b)+_0x40fa5f(0x1ee)+_0x40fa5f(0x223)+_0x40fa5f(0x1fe)+_0x40fa5f(0x22d)+_0x40fa5f(0x197)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x40fa5f(0x1ce)+'</thead>'+_0x40fa5f(0x27f)+'\x20'+_0x2240e4+'\x20'+'</tbody>'+'</table>'+_0x40fa5f(0x29f)+_0x40fa5f(0x274)+_0x40fa5f(0x195)+_0x255194[0x0][_0x40fa5f(0x1ad)]+_0x40fa5f(0x29b)+'</div>'+'</div>'+_0x40fa5f(0x2ad)};_0x57b1f7[_0x40fa5f(0x1a0)](_0x31a2e8,function(_0x20578,_0x3c962d){var _0x38306d=_0x40fa5f;_0x20578?(console[_0x38306d(0x236)](_0x20578),console[_0x38306d(0x236)](_0x38306d(0x23a))):console[_0x38306d(0x236)]('Email\x20sent\x20successfully');}),_0xf1703b[_0x40fa5f(0x1fc)](_0x40fa5f(0x27e),_0x40fa5f(0x22c)),_0x186fcb[_0x40fa5f(0x23f)](_0x40fa5f(0x258));}catch(_0x5ed227){console[_0x40fa5f(0x236)](_0x5ed227),_0x186fcb[_0x40fa5f(0x23d)](0xc8)[_0x40fa5f(0x285)]({'message':_0x5ed227[_0x40fa5f(0x248)]});}}),router[a0_0x21da44(0x26c)](a0_0x21da44(0x1eb),auth,async(_0x596029,_0x58b0fb)=>{var _0x476bd7=a0_0x21da44;try{const {username:_0x1dfd6b,email:_0x3f6951,role:_0x561ec6}=_0x596029[_0x476bd7(0x239)],_0x1b8210=_0x596029[_0x476bd7(0x239)],_0x3139d8=await profile[_0x476bd7(0x1ae)]({'email':_0x1b8210[_0x476bd7(0x193)]}),_0x114512=await master_shop[_0x476bd7(0x1f8)](),_0x4bdf60=_0x596029[_0x476bd7(0x2aa)]['id'],_0x3b90d9=await purchases[_0x476bd7(0x227)](_0x4bdf60);if(_0x114512[0x0][_0x476bd7(0x213)]==_0x476bd7(0x215))var _0x360453=users['English'];else{if(_0x114512[0x0][_0x476bd7(0x213)]=='Hindi')var _0x360453=users[_0x476bd7(0x22f)];else{if(_0x114512[0x0][_0x476bd7(0x213)]=='German')var _0x360453=users['German'];else{if(_0x114512[0x0]['language']==_0x476bd7(0x207))var _0x360453=users[_0x476bd7(0x207)];else{if(_0x114512[0x0][_0x476bd7(0x213)]==_0x476bd7(0x1b5))var _0x360453=users[_0x476bd7(0x1b5)];else{if(_0x114512[0x0][_0x476bd7(0x213)]=='Portuguese\x20(BR)')var _0x360453=users[_0x476bd7(0x295)];else{if(_0x114512[0x0][_0x476bd7(0x213)]=='Chinese')var _0x360453=users[_0x476bd7(0x281)];else{if(_0x114512[0x0][_0x476bd7(0x213)]==_0x476bd7(0x277))var _0x360453=users['Arabic'];}}}}}}}_0x58b0fb[_0x476bd7(0x192)]('all_purchases_barcode',{'success':_0x596029[_0x476bd7(0x1fc)]('success'),'errors':_0x596029[_0x476bd7(0x1fc)]('errors'),'role':_0x1b8210,'profile':_0x3139d8,'alldata':_0x3b90d9,'master_shop':_0x114512,'language':_0x360453}),console[_0x476bd7(0x236)](alldata);}catch(_0x1670c1){console[_0x476bd7(0x236)](_0x1670c1);}}),router[a0_0x21da44(0x25d)](a0_0x21da44(0x1a4),async(_0x19fd44,_0x201d3d)=>{var _0x5054da=a0_0x21da44;const {product_code:_0xd335b}=_0x19fd44['body'];var _0x5403c3;const _0x5ab854=await product[_0x5054da(0x1a9)]([{'$match':{'primary_code':_0xd335b,'product_category':_0x5054da(0x208)}},{'$group':{'_id':_0x5054da(0x1b2),'name':{'$first':_0x5054da(0x1a1)},'category':{'$first':_0x5054da(0x271)},'brand':{'$first':_0x5054da(0x1ec)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5054da(0x1ef)},'primary_code':{'$first':_0x5054da(0x1bc)},'secondary_code':{'$first':_0x5054da(0x275)},'maxStocks':{'$first':_0x5054da(0x1e0)},'maxProdPerUnit':{'$first':_0x5054da(0x25a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5ea71b=await product['aggregate']([{'$match':{'secondary_code':_0xd335b,'product_category':_0x5054da(0x208)}},{'$group':{'_id':_0x5054da(0x1b2),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x5054da(0x1ec)},'unit':{'$first':_0x5054da(0x268)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5054da(0x1ef)},'primary_code':{'$first':_0x5054da(0x1bc)},'secondary_code':{'$first':_0x5054da(0x275)},'maxStocks':{'$first':_0x5054da(0x1e0)},'maxProdPerUnit':{'$first':_0x5054da(0x25a)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5054da(0x266)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5ab854[_0x5054da(0x201)]>0x0)_0x5403c3=_0x5ab854;else _0x5ea71b[_0x5054da(0x201)]>0x0&&(_0x5403c3=_0x5ea71b);_0x201d3d[_0x5054da(0x285)](_0x5403c3);}),router[a0_0x21da44(0x25d)](a0_0x21da44(0x230),async(_0x13efdf,_0x18772c)=>{var _0x50a98c=a0_0x21da44;const {primaryCode:_0x5fa0ec,secondaryCode:_0x503fe9,productCode:_0xd88113,bay:_0x1aad55,bin:_0x3839c4,types:_0x17b9dd,pallet:_0x329fa0,warehouses:_0x5ed967,room:_0x1364bc}=_0x13efdf[_0x50a98c(0x23b)];console[_0x50a98c(0x236)](_0x13efdf[_0x50a98c(0x23b)]);try{const _0xba4e91=await warehouse[_0x50a98c(0x1a9)]([{'$match':{'name':_0x5ed967,'room':_0x1364bc}},{'$unwind':_0x50a98c(0x253)},{'$match':{'product_details.bay':_0x1aad55,'product_details.bin':_0x3839c4,'product_details.type':_0x17b9dd}},{'$group':{'_id':_0x50a98c(0x1e7),'name':{'$first':_0x50a98c(0x1c7)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x50a98c(0x255)},'pallet':{'$first':_0x50a98c(0x27c)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x18772c['status'](0xc8)[_0x50a98c(0x285)](_0xba4e91);}catch(_0x497155){_0x18772c[_0x50a98c(0x23d)](0x194)[_0x50a98c(0x285)]({'message':_0x497155['message']});}}),module[a0_0x21da44(0x265)]=router;