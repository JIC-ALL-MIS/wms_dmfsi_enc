var a0_0x9c1edb=a0_0x45bc;function a0_0x45bc(_0x3e3e52,_0x10defc){var _0x559db9=a0_0x559d();return a0_0x45bc=function(_0x45bc75,_0x5c32a3){_0x45bc75=_0x45bc75-0xd5;var _0x337454=_0x559db9[_0x45bc75];return _0x337454;},a0_0x45bc(_0x3e3e52,_0x10defc);}(function(_0x1613c9,_0x1b2f26){var _0x329612=a0_0x45bc,_0x2689d9=_0x1613c9();while(!![]){try{var _0x81a81d=parseInt(_0x329612(0x185))/0x1+parseInt(_0x329612(0x1f0))/0x2*(parseInt(_0x329612(0xfa))/0x3)+parseInt(_0x329612(0x154))/0x4*(-parseInt(_0x329612(0x164))/0x5)+parseInt(_0x329612(0xf9))/0x6+-parseInt(_0x329612(0x144))/0x7*(-parseInt(_0x329612(0x187))/0x8)+parseInt(_0x329612(0xe0))/0x9+parseInt(_0x329612(0x18c))/0xa*(-parseInt(_0x329612(0x1aa))/0xb);if(_0x81a81d===_0x1b2f26)break;else _0x2689d9['push'](_0x2689d9['shift']());}catch(_0x526d4e){_0x2689d9['push'](_0x2689d9['shift']());}}}(a0_0x559d,0xcc7f3));const express=require(a0_0x9c1edb(0x181)),app=express(),router=express[a0_0x9c1edb(0x1a8)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x9c1edb(0x14a)),auth=require(a0_0x9c1edb(0x10f)),nodemailer=require(a0_0x9c1edb(0x14f));var ejs=require(a0_0x9c1edb(0xf8));const path=require(a0_0x9c1edb(0x12e)),users=require('../public/language/languages.json');router[a0_0x9c1edb(0xe7)]('/view',auth,async(_0x3e9f01,_0x5540a3)=>{var _0x47fad5=a0_0x9c1edb;try{const {username:_0x15476d,email:_0x5a8207,role:_0x3d0ab3}=_0x3e9f01[_0x47fad5(0x188)],_0x44dd6a=_0x3e9f01[_0x47fad5(0x188)],_0x3053ff=await profile[_0x47fad5(0x104)]({'email':_0x44dd6a[_0x47fad5(0x18e)]}),_0x6c6ef7=await staff['findOne']({'email':_0x44dd6a[_0x47fad5(0x18e)]});if(_0x44dd6a['role']==_0x47fad5(0x14c)){const _0x188f91=await staff[_0x47fad5(0x104)]({'email':_0x44dd6a[_0x47fad5(0x18e)]});}const _0x29cd31=await master_shop[_0x47fad5(0x1b1)]();let _0x36c801;if(_0x44dd6a['role']=='staff'){const _0x1ffc83=await staff['findOne']({'email':_0x44dd6a[_0x47fad5(0x18e)]});_0x36c801=await purchases[_0x47fad5(0xf1)]([{'$match':{'warehouse_name':_0x1ffc83[_0x47fad5(0x13e)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x47fad5(0x1ee),'as':_0x47fad5(0x160)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x47fad5(0x1e0)},{'$group':{'_id':_0x47fad5(0x140),'invoice':{'$first':_0x47fad5(0x1b9)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x47fad5(0x1ec)},'room':{'$first':'$room'},'product':{'$push':_0x47fad5(0x1e0)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x47fad5(0xd9)},'due_amount':{'$first':_0x47fad5(0x12c)},'return_data':{'$first':_0x47fad5(0xef)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x47fad5(0x149)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x47fad5(0x17f)},'isle':{'$addToSet':_0x47fad5(0x15a)},'type':{'$addToSet':_0x47fad5(0x1f2)},'floorlevel':{'$addToSet':_0x47fad5(0x10d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x36c801=await purchases[_0x47fad5(0xf1)]([{'$lookup':{'from':_0x47fad5(0x105),'localField':_0x47fad5(0x105),'foreignField':'name','as':_0x47fad5(0x160)}},{'$unwind':_0x47fad5(0x1da)},{'$unwind':_0x47fad5(0x1e0)},{'$group':{'_id':_0x47fad5(0x140),'invoice':{'$first':_0x47fad5(0x1b9)},'suppliers':{'$first':_0x47fad5(0x152)},'date':{'$first':_0x47fad5(0xed)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x47fad5(0x1e1)},'product':{'$push':_0x47fad5(0x1e0)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x47fad5(0xd9)},'due_amount':{'$first':_0x47fad5(0x12c)},'return_data':{'$first':_0x47fad5(0xef)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x47fad5(0x1da)},'total_product_quantity':{'$sum':_0x47fad5(0x19b)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x47fad5(0x15a)},'type':{'$addToSet':_0x47fad5(0x1f2)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x29cd31[0x0]['language']==_0x47fad5(0x162)){var _0x308613=users[_0x47fad5(0x15e)];console[_0x47fad5(0x1b7)](_0x308613);}else{if(_0x29cd31[0x0]['language']==_0x47fad5(0x1b0))var _0x308613=users['Hindi'];else{if(_0x29cd31[0x0]['language']==_0x47fad5(0xfc))var _0x308613=users[_0x47fad5(0xfc)];else{if(_0x29cd31[0x0][_0x47fad5(0x1a6)]==_0x47fad5(0x131))var _0x308613=users[_0x47fad5(0x131)];else{if(_0x29cd31[0x0][_0x47fad5(0x1a6)]=='French')var _0x308613=users['French'];else{if(_0x29cd31[0x0][_0x47fad5(0x1a6)]==_0x47fad5(0x177))var _0x308613=users[_0x47fad5(0x165)];else{if(_0x29cd31[0x0][_0x47fad5(0x1a6)]==_0x47fad5(0x148))var _0x308613=users[_0x47fad5(0x148)];else{if(_0x29cd31[0x0][_0x47fad5(0x1a6)]=='Arabic\x20(ae)')var _0x308613=users[_0x47fad5(0xd6)];}}}}}}}_0x5540a3['render'](_0x47fad5(0xd7),{'success':_0x3e9f01['flash'](_0x47fad5(0x199)),'errors':_0x3e9f01['flash'](_0x47fad5(0x174)),'purchases':_0x36c801,'role':_0x44dd6a,'profile':_0x3053ff,'master_shop':_0x29cd31,'language':_0x308613});}catch(_0x4c0bd7){console[_0x47fad5(0x1b7)](_0x47fad5(0x121),_0x4c0bd7),_0x5540a3['status'](0xc8)[_0x47fad5(0x142)]({'message':_0x4c0bd7['message']});}});function BayBinSelected(_0x43e1fa,_0x128452){var _0xe6622d=a0_0x9c1edb,_0x22d807=[],_0x379086=[],_0x101baf=[],_0x4c629f=[],_0x1f89c6=[],_0x217f13=[];let _0x35babc=[];if(_0x43e1fa==_0xe6622d(0xf3))switch(_0x128452){case _0xe6622d(0x15d):_0x22d807=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x379086=[0x1,0x2],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=[_0xe6622d(0xf2),_0xe6622d(0x14d)],_0x1f89c6=['D'],_0x217f13=['A'];break;case _0xe6622d(0x1de):_0x22d807=[0x6,0x5,0x4,0x3,0x2,0x1],_0x379086=[0x1,0x2],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=['Level',_0xe6622d(0x14d)],_0x1f89c6=['D'],_0x217f13=['B'];break;case _0xe6622d(0x123):_0x22d807=[0x0],_0x379086=[0x0],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=[_0xe6622d(0x14d)],_0x1f89c6=['D'],_0x217f13=['S'];break;case'Receiving\x20Area':_0x22d807=[0x0],_0x379086=[0x0],_0x4c629f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x101baf=[_0xe6622d(0x14d)],_0x1f89c6=['D'],_0x217f13=['R'];break;}else{if(_0x43e1fa=='COLD\x20STORAGE')switch(_0x128452){case'Rack\x20A':_0x22d807=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x379086=['B','F'],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=[_0xe6622d(0xf2),_0xe6622d(0x14d)],_0x1f89c6=['C'],_0x217f13=['A'];break;case _0xe6622d(0x1de):_0x22d807=[0x5,0x4,0x3,0x2,0x1],_0x379086=['F','B','S'],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=[_0xe6622d(0xf2),_0xe6622d(0x14d)],_0x1f89c6=['C'],_0x217f13=['B'];break;case'Rack\x20C':_0x22d807=[0x1,0x2,0x3,0x4,0x5],_0x379086=['B','F','S'],_0x4c629f=[0x5,0x4,0x3,0x2,0x1],_0x101baf=['Level','Floor'],_0x1f89c6=['C'],_0x217f13=['C'];break;case'Rack\x20D':_0x22d807=[0x5,0x4,0x3,0x2,0x1],_0x379086=['F','B','S'],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=['Level',_0xe6622d(0x14d)],_0x1f89c6=['C'],_0x217f13=['D'];break;case _0xe6622d(0x110):_0x22d807=[0x4,0x3,0x2,0x1],_0x379086=[0x1,0x2],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=[_0xe6622d(0xf2),_0xe6622d(0x14d)],_0x1f89c6=['C'],_0x217f13=['E'];break;case _0xe6622d(0x1b2):_0x22d807=[0x1,0x2,0x3],_0x379086=[0x1,0x2],_0x4c629f=[0x1,0x2,0x3,0x4,0x5],_0x101baf=[_0xe6622d(0xf2)],_0x1f89c6=['C'],_0x217f13=['F'];break;}}return{'levels':_0x22d807,'Isle':_0x379086,'rack':_0x4c629f,'type':_0x101baf,'storage':_0x1f89c6,'rak':_0x217f13};}async function getRandom8DigitNumber(){var _0x57cff4=a0_0x9c1edb;const _0x5a4bfd=0x989680,_0x141c80=0x5f5e0ff,_0x4fe6ba=Math[_0x57cff4(0x101)](Math[_0x57cff4(0x12f)]()*(_0x141c80-_0x5a4bfd+0x1))+_0x5a4bfd;var _0x26785a;const _0x1340da=await purchases['findOne']({'invoice':'INC-'+_0x4fe6ba});return _0x1340da&&_0x1340da[_0x57cff4(0x178)]>0x0?_0x26785a=_0x57cff4(0x137)+_0x4fe6ba:_0x26785a=_0x57cff4(0x137)+_0x4fe6ba,_0x26785a;}function a0_0x559d(){var _0x198cc0=['$alertquantity','createTransport','prod_qty','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','host','There\x27s\x20a\x20error\x20in\x20this\x20transaction','string','render','table\x20page','maxStocks','Shelves','purchase\x20data\x20update\x20successfully','payment\x20successfull','role','secondary_code','$maxProdPerUnit','catch','logo','prod_name','$due_amount','$product_details.secondary_code','path','random','return_product','Spanish','<h2>\x20','suppliers_data','findById','map','$product_details','INC-','\x20<>\x20','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','production_date','edit_purchases_view','/all_purchases/view/','Email\x20sent\x20successfully','warehouse','$product_details._id','$_id','all_purchases_barcode','json','<tbody\x20style=\x22text-align:\x20center;\x22>','7798413zhyDlf','</h5>','$product_details.product_stock','Purchase\x20data\x20added\x20successfully','Chinese','$expiry_date','../models/all_models','paid_amount','staff','Floor','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','nodemailer','Return\x20Goods','master','$suppliers','product_name','1524476mxjIDp','currency','storage','/invoice/:id','product_stock','purchase_invoice','$product.bin','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Rack\x20A','English','prod_pallet','suppliers_docs','</head><body>','English\x20(US)','room_name','5xRhOhI','Portuguese','primary_code','Ambient','secondary_unit','image','RMSEmail','delivery_date','/barcode/:id','<h5\x20style=\x22text-align:\x20left;\x22>','/barcode_scanner','JO_number','Arabic\x20(ae)','<html><head><title></title>','</table>','user_id','errors','<span\x20style=\x22float:\x20right;\x22>','/preview/:id','Portuguese\x20(BR)','length','purchases\x20item\x20return\x20successfull','$product_details.primary_code','Sales\x20Update\x20successfully','flash','redirect','</body></html>','$product.bay','stock_quantity','express','</span>','post','product_list','154853Zcnajb','/view/:id','8LYYgkQ','user','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.floorlevel','bin','119480CfxObV','$category','email','back','Error\x20Occurs','getDate','\x20</h2>','return_qty','standard_unit','$product_code','MaxStocks_data','<!DOCTYPE\x20html>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','success','floorlevel','$product.quantity','stock_data','rak','Logo.png','foreach\x20newproduct','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','port','bay','currency_placement','concat','here','language','expiry_date','Router','\x20Order\x20Number\x20:\x20','3344azwxyq','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_primunit','add\x20post','params','isle','Hindi','find','Rack\x20F','message','primary_code_hide','$secondary_code','/view/add_purchases','log','filter','$invoice','prod_isle','rack','/give_payment/:id','pallet','abs','delivery_code','Enclosed','due_amount','purchase_quantity','/CheckingWarehouse','max_product_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','save','push','$primary_code','type','deliverycode','maxperunit','$name','padStart','secondary_code_hide','$product_details.rack','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_name','Raw\x20Materials','forEach','</div>','warehouse_name','slice','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$suppliers_docs','<hr\x20class=\x22my-3\x22>','alertQTY','prod_level','Rack\x20B','$brand','$product','$product.room_name','French','amount','site_title','$maxStocks','then','</thead>','$product_details.storage','exports','<strong>\x20Regards\x20</strong>','status','$warehouse_name','$product_details.pallet','name','Enabled','178taOvuE','actual_uom','$product.type','/view/return_purchase/:id','Arabic','all_purchases','/all_purchases/view','$paid_amount','$product_details.maxProducts','</td>','prod_cat','POnumber','quantity','\x20Order\x20Date\x20:\x20','9718380DPyWhb','return_purchase','prod_code','product_cat','prod_invoice','batch_code','date','get','</tr>','password','Room_name','<tr>','stocks','$date','sendMail','$return_data','RoomAssign','aggregate','Level','DRY\x20STORAGE','$product_details.bin','/view/add_purchases/:id','level','product_code','ejs','6773568VhUxWZ','46290BwZVsn','actual_qty','German','add_purchases\x20error','room','body','getFullYear','floor','Purchase\x20Return','product_details','findOne','suppliers','An\x20error\x20occurred\x20while\x20saving\x20data.','Purchase\x20Return\x20Mail','product_code_hide','types','prod_unit','<div>','$secondary_unit','$product.floorlevel','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','../middleware/auth','Rack\x20E','$product_details.type','prod_Qty','True','add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','invoice','$unit'];a0_0x559d=function(){return _0x198cc0;};return a0_0x559d();}router[a0_0x9c1edb(0xe7)]('/view/add_purchases',auth,async(_0x36bd7e,_0x1c48f5)=>{var _0x2b7410=a0_0x9c1edb;try{const {username:_0x261ce6,email:_0x553fee,role:_0x4e8455}=_0x36bd7e[_0x2b7410(0x188)],_0x2ac0c2=_0x36bd7e[_0x2b7410(0x188)],_0x5ee198=await profile[_0x2b7410(0x104)]({'email':_0x2ac0c2[_0x2b7410(0x18e)]}),_0x5cefef=await master_shop[_0x2b7410(0x1b1)](),_0x5197b4=await staff[_0x2b7410(0x104)]({'email':_0x2ac0c2['email']}),_0x4443e9=await suppliers[_0x2b7410(0x1b1)]({});let _0x2220f4;if(_0x2ac0c2['role']==_0x2b7410(0x14c)){const _0x2441d7=await staff[_0x2b7410(0x104)]({'email':_0x2ac0c2[_0x2b7410(0x18e)]});_0x2220f4=await warehouse[_0x2b7410(0xf1)]([{'$match':{'status':_0x2b7410(0x1ef),'name':_0x2441d7[_0x2b7410(0x13e)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2b7410(0x150)}}},{'$group':{'_id':_0x2b7410(0x1cc),'name':{'$first':_0x2b7410(0x1cc)}}}]);}else _0x2220f4=await warehouse['aggregate']([{'$match':{'status':_0x2b7410(0x1ef),'warehouse_category':_0x2b7410(0x1d3),'name':{'$ne':_0x2b7410(0x150)}}},{'$group':{'_id':_0x2b7410(0x1cc),'name':{'$first':'$name'}}}]);const _0x7bb06d=await product[_0x2b7410(0x1b1)]({}),_0x22bb11=await warehouse['find']({'status':'Enabled'}),_0x2920b5=await purchases[_0x2b7410(0x1b1)]({}),_0x463995=_0x2920b5[_0x2b7410(0x178)]+0x1,_0x51537d='INC-'+_0x463995['toString']()[_0x2b7410(0x1cd)](0x5,'0');var _0x102c14=[_0x2b7410(0x167),_0x2b7410(0x1c0)];if(_0x5cefef[0x0][_0x2b7410(0x1a6)]==_0x2b7410(0x162))var _0x187a40=users[_0x2b7410(0x15e)];else{if(_0x5cefef[0x0]['language']=='Hindi')var _0x187a40=users[_0x2b7410(0x1b0)];else{if(_0x5cefef[0x0][_0x2b7410(0x1a6)]==_0x2b7410(0xfc))var _0x187a40=users[_0x2b7410(0xfc)];else{if(_0x5cefef[0x0][_0x2b7410(0x1a6)]==_0x2b7410(0x131))var _0x187a40=users['Spanish'];else{if(_0x5cefef[0x0][_0x2b7410(0x1a6)]==_0x2b7410(0x1e2))var _0x187a40=users[_0x2b7410(0x1e2)];else{if(_0x5cefef[0x0][_0x2b7410(0x1a6)]==_0x2b7410(0x177))var _0x187a40=users['Portuguese'];else{if(_0x5cefef[0x0][_0x2b7410(0x1a6)]==_0x2b7410(0x148))var _0x187a40=users[_0x2b7410(0x148)];else{if(_0x5cefef[0x0][_0x2b7410(0x1a6)]=='Arabic\x20(ae)')var _0x187a40=users[_0x2b7410(0xd6)];}}}}}}}const _0x2f0a00=getRandom8DigitNumber();_0x2f0a00['then'](_0x123df6=>{var _0x3e04ad=_0x2b7410;_0x1c48f5['render'](_0x3e04ad(0x114),{'success':_0x36bd7e[_0x3e04ad(0x17c)](_0x3e04ad(0x199)),'errors':_0x36bd7e['flash'](_0x3e04ad(0x174)),'role':_0x2ac0c2,'profile':_0x5ee198,'suppliers':_0x4443e9,'warehouse':_0x2220f4,'product':_0x7bb06d,'invoice':_0x123df6,'master_shop':_0x5cefef,'language':_0x187a40,'find_data':_0x22bb11,'rooms_data':_0x102c14});})[_0x2b7410(0x129)](_0x3ab43f=>{var _0x2655ef=_0x2b7410;_0x36bd7e['flash']('errors',_0x2655ef(0x11e)),_0x1c48f5[_0x2655ef(0x17d)](_0x2655ef(0xd8));});}catch(_0x2c8ac7){console['log'](_0x2c8ac7);}}),router[a0_0x9c1edb(0xe7)](a0_0x9c1edb(0xf5),auth,async(_0x39c675,_0x49a8ae)=>{var _0x46ab78=a0_0x9c1edb;try{const _0x2d6217=_0x39c675[_0x46ab78(0x1ae)]['id'];console[_0x46ab78(0x1b7)](_0x2d6217);const _0x4df7a4=await master_shop[_0x46ab78(0x1b1)]();console[_0x46ab78(0x1b7)](_0x46ab78(0x151),_0x4df7a4);const _0x26a7a5=await product[_0x46ab78(0x104)]({'name':_0x2d6217});console[_0x46ab78(0x1b7)]('product',_0x26a7a5),_0x49a8ae[_0x46ab78(0x1eb)](0xc8)[_0x46ab78(0x142)]({'product_data':_0x26a7a5,'master':_0x4df7a4});}catch(_0xc14aec){console[_0x46ab78(0x1b7)](_0x46ab78(0xfd),_0xc14aec);}}),router[a0_0x9c1edb(0x183)](a0_0x9c1edb(0x1b6),auth,async(_0x36984d,_0x4907e7)=>{var _0x5d8111=a0_0x9c1edb;try{const {invoice:_0x43303e,date:_0x27ec97,warehouse_name:_0xbae7e3,prod_name:_0x23c979,prod_code:_0x107c54,prod_qty:_0x355e91,prod_unit:_0x202ffb,prod_secondunit:_0x26ef51,prod_level:_0x6cb05c,prod_isle:_0x272770,prod_pallet:_0x31a789,note:_0x19af3a,expiry_date:_0x52b46c,batch_code:_0x4ad965,payable:_0x48625a,due_amount:_0x5367f3,Room_name:_0x6a6e77,primary_code:_0x52b1ce,secondary_code:_0x3e766a,MaxStocks_data:_0xcb3916,PO_number:_0x5eee22,SCRN:_0x3ac5d6,JO_number:_0x57bd97}=_0x36984d[_0x5d8111(0xff)];if(typeof _0x23c979==_0x5d8111(0x11f))var _0xb8d4d9=[_0x36984d['body'][_0x5d8111(0x12b)]],_0x1974ac=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0xe2)]],_0x14c43d=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x112)]],_0x272d96=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1ac)]],_0x209604=[_0x36984d[_0x5d8111(0xff)]['prod_secondunit']],_0x36aa7c=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1dd)]],_0x563f7a=[_0x36984d[_0x5d8111(0xff)]['primary_code']],_0x5c8574=[_0x36984d[_0x5d8111(0xff)]['secondary_code']],_0x9de70e=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x196)]],_0x155f3d=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0xe5)]],_0xb9ee3c=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1a7)]],_0x43af82=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1c4)]],_0x1e3fb2=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1dc)]],_0x473f10=[_0x36984d[_0x5d8111(0xff)]['production_date']],_0x43522f=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0xdc)]],_0xc27128=[_0x36984d[_0x5d8111(0xff)]['RoomAssign']],_0x253792=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1ca)]],_0x46c18e=[_0x36984d[_0x5d8111(0xff)][_0x5d8111(0xe4)]],_0x2fae3a=[_0x36984d['body']['actual_qty']],_0x12630d=[_0x36984d['body'][_0x5d8111(0x1f1)]];else var _0xb8d4d9=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x12b)]],_0x1974ac=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0xe2)]],_0x14c43d=[..._0x36984d[_0x5d8111(0xff)]['prod_Qty']],_0x272d96=[..._0x36984d[_0x5d8111(0xff)]['prod_primunit']],_0x209604=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1d0)]],_0x36aa7c=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1dd)]],_0x563f7a=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x166)]],_0x5c8574=[..._0x36984d[_0x5d8111(0xff)]['secondary_code']],_0x9de70e=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x196)]],_0x155f3d=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0xe5)]],_0xb9ee3c=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1a7)]],_0x43af82=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1c4)]],_0x1e3fb2=[..._0x36984d['body'][_0x5d8111(0x1dc)]],_0x473f10=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x13a)]],_0x43522f=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0xdc)]],_0xc27128=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0xf0)]],_0x253792=[..._0x36984d['body'][_0x5d8111(0x1ca)]],_0x46c18e=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0xe4)]],_0x2fae3a=[..._0x36984d['body'][_0x5d8111(0xfb)]],_0x12630d=[..._0x36984d[_0x5d8111(0xff)][_0x5d8111(0x1f1)]];const _0x3764c3=_0xb8d4d9[_0x5d8111(0x135)](_0x4220ae=>{return _0x4220ae={'product_name':_0x4220ae};});_0x2fae3a[_0x5d8111(0x1d4)]((_0x7bffdb,_0x274f26)=>{var _0x3c7977=_0x5d8111;_0x3764c3[_0x274f26][_0x3c7977(0xfb)]=Math['abs'](_0x7bffdb);}),_0x12630d['forEach']((_0x423cb6,_0x48f106)=>{var _0x272486=_0x5d8111;_0x3764c3[_0x48f106][_0x272486(0x1f1)]=_0x423cb6;}),_0x1974ac[_0x5d8111(0x1d4)]((_0x4ca108,_0x28ddda)=>{var _0x205c0f=_0x5d8111;_0x3764c3[_0x28ddda][_0x205c0f(0xf7)]=_0x4ca108;}),_0x14c43d[_0x5d8111(0x1d4)]((_0x2fd97b,_0x35557e)=>{var _0x429f70=_0x5d8111;_0x3764c3[_0x35557e][_0x429f70(0xde)]=Math['abs'](_0x2fd97b);}),_0x272d96['forEach']((_0x89bc67,_0x51d46b)=>{var _0x44289d=_0x5d8111;_0x3764c3[_0x51d46b][_0x44289d(0x194)]=_0x89bc67;}),_0x209604[_0x5d8111(0x1d4)]((_0x212a99,_0x2fdf57)=>{var _0x47daec=_0x5d8111;_0x3764c3[_0x2fdf57][_0x47daec(0x168)]=_0x212a99;}),_0x36aa7c[_0x5d8111(0x1d4)]((_0x1c1ddc,_0x4ee4b8)=>{var _0x54512c=_0x5d8111;_0xc27128[_0x54512c(0x1d4)]((_0x581efc,_0x301686)=>{var _0x46a217=_0x54512c;if(_0x581efc=='Receiving\x20Area'&&_0x4ee4b8==_0x301686){console[_0x46a217(0x1b7)](_0x581efc+'\x20<\x20wew\x20>\x20'+_0x4ee4b8+'\x20<>\x20'+_0x301686+_0x46a217(0x138)+_0x1c1ddc);var _0x3b8011=_0x1c1ddc[_0x46a217(0x1d7)](0x3);_0x3764c3[_0x4ee4b8][_0x46a217(0x156)]=_0x1c1ddc[0x0],_0x3764c3[_0x4ee4b8][_0x46a217(0x1bb)]=_0x1c1ddc[0x1],_0x3764c3[_0x4ee4b8]['bay']=0x0,_0x3764c3[_0x4ee4b8][_0x46a217(0x18b)]=0x0,_0x3764c3[_0x4ee4b8][_0x46a217(0x1c9)]=_0x46a217(0x14d),_0x3764c3[_0x4ee4b8][_0x46a217(0x19a)]=_0x3b8011;}else{if(_0x581efc=='Shelves'&&_0x4ee4b8==_0x301686){var _0x3b8011=_0x1c1ddc[_0x46a217(0x1d7)](0x3);_0x3764c3[_0x4ee4b8]['storage']=_0x1c1ddc[0x0],_0x3764c3[_0x4ee4b8][_0x46a217(0x1bb)]=_0x1c1ddc[0x1],_0x3764c3[_0x4ee4b8]['bay']=0x0,_0x3764c3[_0x4ee4b8][_0x46a217(0x18b)]=0x0,_0x3764c3[_0x4ee4b8]['type']=_0x46a217(0x14d),_0x3764c3[_0x4ee4b8][_0x46a217(0x19a)]=_0x1c1ddc[0x5];}else{if(_0x4ee4b8==_0x301686){if(_0x1c1ddc[0x0]=='A'&&_0x1c1ddc[0x1]=='L'&&_0x1c1ddc[0x2]=='L')console['log'](_0x581efc+'\x20<>\x20'+_0x4ee4b8+_0x46a217(0x138)+_0x301686+'\x20<>\x20'+_0x1c1ddc+_0x46a217(0x1a5)),_0x3764c3[_0x4ee4b8][_0x46a217(0x156)]=_0x1c1ddc[0x0],_0x3764c3[_0x4ee4b8][_0x46a217(0x1bb)]=_0x1c1ddc[0x1],_0x3764c3[_0x4ee4b8][_0x46a217(0x1a2)]=0x0,_0x3764c3[_0x4ee4b8][_0x46a217(0x18b)]=0x0,_0x3764c3[_0x4ee4b8][_0x46a217(0x1c9)]=_0x46a217(0x14d),_0x3764c3[_0x4ee4b8][_0x46a217(0x19a)]=_0x1c1ddc[0x3];else{var _0x5b2876;if(_0x1c1ddc[0x4]=='L')_0x5b2876=_0x46a217(0xf2);else _0x1c1ddc[0x4]=='F'&&(_0x5b2876=_0x46a217(0x14d));_0x3764c3[_0x4ee4b8][_0x46a217(0x156)]=_0x1c1ddc[0x0],_0x3764c3[_0x4ee4b8][_0x46a217(0x1bb)]=_0x1c1ddc[0x1],_0x3764c3[_0x4ee4b8][_0x46a217(0x1a2)]=_0x1c1ddc[0x2],_0x3764c3[_0x4ee4b8][_0x46a217(0x18b)]=_0x1c1ddc[0x3],_0x3764c3[_0x4ee4b8][_0x46a217(0x1c9)]=_0x5b2876,_0x3764c3[_0x4ee4b8][_0x46a217(0x19a)]=_0x1c1ddc[0x5];}}}}});}),_0x563f7a[_0x5d8111(0x1d4)]((_0x94ecd2,_0x459b92)=>{var _0x1002f1=_0x5d8111;_0x3764c3[_0x459b92][_0x1002f1(0x166)]=_0x94ecd2;}),_0x5c8574[_0x5d8111(0x1d4)]((_0x3c8750,_0x37d8f4)=>{_0x3764c3[_0x37d8f4]['secondary_code']=_0x3c8750;}),_0x9de70e['forEach']((_0x5a989b,_0x108a3a)=>{var _0x602e08=_0x5d8111;_0x3764c3[_0x108a3a][_0x602e08(0x122)]=_0x5a989b;}),_0x155f3d[_0x5d8111(0x1d4)]((_0x3d8f90,_0x21b88a)=>{var _0x161b9f=_0x5d8111;_0x3764c3[_0x21b88a][_0x161b9f(0xe5)]=_0x3d8f90;}),_0xb9ee3c[_0x5d8111(0x1d4)]((_0x31fecf,_0x28902f)=>{_0x3764c3[_0x28902f]['expiry_date']=_0x31fecf;}),_0x43af82[_0x5d8111(0x1d4)]((_0x5f04bc,_0xf3b488)=>{var _0x5dd9da=_0x5d8111;_0x3764c3[_0xf3b488][_0x5dd9da(0x1cb)]=_0x5f04bc;}),_0x1e3fb2['forEach']((_0x54df64,_0x3919ee)=>{var _0x51e52a=_0x5d8111;_0x3764c3[_0x3919ee][_0x51e52a(0x1dc)]=_0x54df64;}),_0x473f10[_0x5d8111(0x1d4)]((_0x1bb597,_0x339bcd)=>{var _0x27a44a=_0x5d8111;_0x3764c3[_0x339bcd][_0x27a44a(0x13a)]=_0x1bb597;}),_0x43522f[_0x5d8111(0x1d4)]((_0x33e3bd,_0xf46a73)=>{var _0x1cc25b=_0x5d8111;_0x3764c3[_0xf46a73][_0x1cc25b(0xe3)]=_0x33e3bd;}),_0xc27128[_0x5d8111(0x1d4)]((_0x378acf,_0x4e812d)=>{_0x3764c3[_0x4e812d]['room_name']=_0x378acf;}),_0x253792[_0x5d8111(0x1d4)]((_0x7a3ce4,_0xfaa45c)=>{_0x3764c3[_0xfaa45c]['delivery_code']=_0x7a3ce4;}),_0x46c18e[_0x5d8111(0x1d4)]((_0x19aa6d,_0x493487)=>{_0x3764c3[_0x493487]['invoice']=_0x19aa6d;});const _0x290ea6=_0xc27128['map'](_0x4e7875=>{return _0x4e7875={'room_name':_0x4e7875};}),_0x432bfd=_0x3764c3[_0x5d8111(0x1b8)](_0x107f09=>_0x107f09[_0x5d8111(0xde)]!=='0'&&_0x107f09[_0x5d8111(0xde)]!==''),_0x3f37c6=new purchases({'invoice':_0x43303e,'suppliers':_0x36984d[_0x5d8111(0xff)][_0x5d8111(0x105)],'date':_0x27ec97,'warehouse_name':_0xbae7e3,'product':_0x432bfd,'note':_0x19af3a,'due_amount':_0x5367f3,'POnumber':_0x5eee22,'SCRN':_0x3ac5d6,'JO_number':_0x57bd97,'roomList':_0x290ea6}),_0x59774d=await _0x3f37c6['save'](),_0x1c8cf8=await purchases['findOne']({'invoice':_0x43303e}),_0x1aff8d=_0x1c8cf8['product']['map'](async _0x36c157=>{var _0x149a7a=_0x5d8111,_0x2b1678=await warehouse[_0x149a7a(0x104)]({'name':_0xbae7e3,'room':_0x36c157[_0x149a7a(0x163)]}),_0x45503f=0x0;return _0x2b1678[_0x149a7a(0x103)][_0x149a7a(0x1d4)](_0x4ae671=>{var _0x2bd52c=_0x149a7a;_0x4ae671['product_name']==_0x36c157[_0x2bd52c(0x153)]&&_0x4ae671[_0x2bd52c(0x19a)]==_0x36c157['floorlevel']&&_0x4ae671[_0x2bd52c(0x1c9)]==_0x36c157[_0x2bd52c(0x1c9)]&&_0x4ae671[_0x2bd52c(0x18b)]==_0x36c157['bin']&&_0x4ae671[_0x2bd52c(0x1a2)]==_0x36c157[_0x2bd52c(0x1a2)]&&_0x4ae671[_0x2bd52c(0x1bb)]==_0x36c157[_0x2bd52c(0x1bb)]&&_0x4ae671[_0x2bd52c(0x156)]==_0x36c157[_0x2bd52c(0x156)]&&_0x4ae671['expiry_date']==_0x36c157[_0x2bd52c(0x1a7)]&&_0x4ae671[_0x2bd52c(0xe5)]==_0x36c157[_0x2bd52c(0xe5)]&&_0x4ae671[_0x2bd52c(0x13a)]==_0x36c157[_0x2bd52c(0x13a)]&&_0x4ae671['invoice']==_0x1c8cf8['invoice']&&(_0x4ae671[_0x2bd52c(0x158)]+=Math[_0x2bd52c(0x1be)](_0x36c157[_0x2bd52c(0xde)]),_0x45503f++);}),_0x45503f===0x0&&_0x2b1678[_0x149a7a(0x103)][_0x149a7a(0x1c7)]({'product_name':_0x36c157[_0x149a7a(0x153)],'product_stock':Math[_0x149a7a(0x1be)](_0x36c157[_0x149a7a(0xde)]),'primary_code':_0x36c157['primary_code'],'secondary_code':_0x36c157[_0x149a7a(0x127)],'product_code':_0x36c157[_0x149a7a(0xf7)],'storage':_0x36c157[_0x149a7a(0x156)],'rack':_0x36c157[_0x149a7a(0x1bb)],'bay':_0x36c157['bay'],'bin':_0x36c157[_0x149a7a(0x18b)],'type':_0x36c157[_0x149a7a(0x1c9)],'floorlevel':_0x36c157[_0x149a7a(0x19a)],'maxProducts':_0x36c157[_0x149a7a(0x122)],'unit':_0x36c157[_0x149a7a(0x194)],'secondary_unit':_0x36c157['secondary_unit'],'expiry_date':_0x36c157['expiry_date'],'maxPerUnit':_0x36c157[_0x149a7a(0x1cb)],'batch_code':_0x36c157[_0x149a7a(0xe5)],'alertQTY':_0x36c157[_0x149a7a(0x1dc)],'production_date':_0x36c157[_0x149a7a(0x13a)],'product_cat':_0x36c157[_0x149a7a(0xe3)],'invoice':_0x36c157[_0x149a7a(0x116)],'actual_qty':Math[_0x149a7a(0x1be)](_0x36c157[_0x149a7a(0xfb)]),'actual_uom':_0x36c157['actual_uom']}),_0x2b1678;});Promise['all'](_0x1aff8d)[_0x5d8111(0x1e6)](async _0x234b64=>{var _0x3453a=_0x5d8111;try{for(const _0x566a8d of _0x234b64){await _0x566a8d[_0x3453a(0x1c6)]();}const _0x254bdb=await master_shop[_0x3453a(0x1b1)](),_0x138801=await email_settings[_0x3453a(0x104)](),_0x389980=await supervisor_settings[_0x3453a(0x1b1)]();var _0x4d03d8=_0x1c8cf8[_0x3453a(0x1d8)],_0x41d771='',_0x118a40;for(_0x118a40 in _0x4d03d8){_0x41d771+=_0x3453a(0xeb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40][_0x3453a(0x153)]+_0x3453a(0xdb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40][_0x3453a(0xf7)]+_0x3453a(0xdb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40][_0x3453a(0xde)]+_0x3453a(0xdb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40]['standard_unit']+_0x3453a(0xdb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40][_0x3453a(0x168)]+'</td>'+_0x3453a(0x1a0)+_0x1c8cf8[_0x3453a(0x1d6)]+_0x3453a(0xdb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40][_0x3453a(0x163)]+_0x3453a(0xdb)+_0x3453a(0x1a0)+_0x4d03d8[_0x118a40]['storage']+_0x4d03d8[_0x118a40][_0x3453a(0x1bb)]+_0x4d03d8[_0x118a40]['bay']+_0x4d03d8[_0x118a40][_0x3453a(0x18b)]+_0x4d03d8[_0x118a40][_0x3453a(0x1c9)][0x0]+_0x4d03d8[_0x118a40][_0x3453a(0x19a)]+_0x3453a(0xdb),_0x3453a(0xe8);}let _0x47bc63=nodemailer[_0x3453a(0x119)]({'host':_0x138801[_0x3453a(0x11d)],'port':Number(_0x138801[_0x3453a(0x1a1)]),'secure':![],'auth':{'user':_0x138801[_0x3453a(0x18e)],'pass':_0x138801[_0x3453a(0xe9)]}}),_0x41499b={'from':_0x138801[_0x3453a(0x18e)],'to':_0x389980[0x0][_0x3453a(0x16a)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x3453a(0x19e),'path':__dirname+'/../public'+'/upload/'+_0x254bdb[0x0][_0x3453a(0x169)],'cid':_0x3453a(0x12a)}],'html':_0x3453a(0x197)+_0x3453a(0x171)+_0x3453a(0x161)+_0x3453a(0x10b)+_0x3453a(0x10e)+_0x3453a(0x10b)+_0x3453a(0x1ab)+'</div>'+_0x3453a(0x10b)+'<h2>\x20'+_0x254bdb[0x0]['site_title']+_0x3453a(0x192)+'</div>'+_0x3453a(0x1d5)+_0x3453a(0x1db)+_0x3453a(0x10b)+_0x3453a(0x16d)+_0x3453a(0x1a9)+_0x1c8cf8['invoice']+'\x20'+_0x3453a(0x175)+_0x3453a(0xdf)+_0x1c8cf8[_0x3453a(0xe6)]+'\x20'+_0x3453a(0x182)+'</h5>'+_0x3453a(0x1d5)+_0x3453a(0x198)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3453a(0xeb)+_0x3453a(0x115)+_0x3453a(0x1c5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3453a(0x189)+_0x3453a(0x15c)+_0x3453a(0x11c)+_0x3453a(0xe8)+_0x3453a(0x1e7)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x41d771+'\x20'+_0x3453a(0x11b)+'</table>'+'<div>'+_0x3453a(0x1ea)+'<h5>'+_0x254bdb[0x0][_0x3453a(0x1e4)]+'</h5>'+_0x3453a(0x1d5)+'</div>'+_0x3453a(0x17e)};_0x47bc63[_0x3453a(0xee)](_0x41499b,function(_0x36b407,_0x3556dd){var _0x474fd9=_0x3453a;_0x36b407?(console[_0x474fd9(0x1b7)](_0x36b407),console[_0x474fd9(0x1b7)]('Error\x20Occurs')):console['log'](_0x474fd9(0x13d));}),_0x36984d[_0x3453a(0x17c)](_0x3453a(0x199),_0x3453a(0x147)),_0x4907e7[_0x3453a(0x17d)](_0x3453a(0x13c));}catch(_0x1ca8c0){console['error'](_0x1ca8c0),_0x4907e7[_0x3453a(0x1eb)](0x1f4)[_0x3453a(0x142)]({'error':_0x3453a(0x106)});}})[_0x5d8111(0x129)](_0x178569=>{var _0x1038f8=_0x5d8111;console['error'](_0x178569),_0x4907e7[_0x1038f8(0x1eb)](0x1f4)[_0x1038f8(0x142)]({'error':'An\x20error\x20occurred.'});});}catch(_0x483a67){console['log'](_0x483a67);}}),router[a0_0x9c1edb(0xe7)](a0_0x9c1edb(0x176),auth,async(_0x4da688,_0x574a6d)=>{var _0x245141=a0_0x9c1edb;try{const {username:_0x1903d7,email:_0x4e76ca,role:_0x3cd65f}=_0x4da688['user'],_0x4ec2a4=_0x4da688[_0x245141(0x188)],_0x426f6e=await profile[_0x245141(0x104)]({'email':_0x4ec2a4[_0x245141(0x18e)]}),_0x237b3f=await master_shop['find'](),_0x5af7fe=_0x4da688[_0x245141(0x1ae)]['id'],_0x2f164f=await purchases[_0x245141(0x134)](_0x5af7fe),_0x16a7f9=await warehouse['aggregate']([{'$match':{'name':_0x2f164f[_0x245141(0x1d6)],'room':_0x2f164f[_0x245141(0xfe)]}},{'$unwind':_0x245141(0x136)},{'$group':{'_id':_0x245141(0x13f),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x245141(0x146)},'bay':{'$first':_0x245141(0x15b)},'bin':{'$first':_0x245141(0xf4)},'type':{'$first':_0x245141(0x111)},'floorlevel':{'$first':_0x245141(0x18a)},'primary_code':{'$first':_0x245141(0x17a)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x245141(0x1e8)},'rack':{'$first':_0x245141(0x1cf)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x41faa8=await customer[_0x245141(0x1b1)]({});let _0x30e1b6;if(_0x4ec2a4['role']==_0x245141(0x14c)){const _0x359b03=await staff[_0x245141(0x104)]({'email':_0x4ec2a4[_0x245141(0x18e)]});_0x30e1b6=await warehouse[_0x245141(0xf1)]([{'$match':{'status':_0x245141(0x1ef),'name':_0x359b03[_0x245141(0x13e)]}},{'$group':{'_id':_0x245141(0x1cc),'name':{'$first':'$name'}}}]);}else _0x30e1b6=await warehouse['aggregate']([{'$match':{'status':_0x245141(0x1ef)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x1253b3=await product[_0x245141(0x1b1)]({}),_0x2c0ff3=await suppliers[_0x245141(0x1b1)]({}),_0x126354=BayBinSelected(_0x2f164f['warehouse_name'],_0x2f164f[_0x245141(0xfe)]);if(_0x237b3f[0x0][_0x245141(0x1a6)]==_0x245141(0x162)){var _0x21f01a=users[_0x245141(0x15e)];console[_0x245141(0x1b7)](_0x21f01a);}else{if(_0x237b3f[0x0][_0x245141(0x1a6)]==_0x245141(0x1b0))var _0x21f01a=users[_0x245141(0x1b0)];else{if(_0x237b3f[0x0][_0x245141(0x1a6)]=='German')var _0x21f01a=users[_0x245141(0xfc)];else{if(_0x237b3f[0x0][_0x245141(0x1a6)]==_0x245141(0x131))var _0x21f01a=users[_0x245141(0x131)];else{if(_0x237b3f[0x0][_0x245141(0x1a6)]=='French')var _0x21f01a=users[_0x245141(0x1e2)];else{if(_0x237b3f[0x0]['language']==_0x245141(0x177))var _0x21f01a=users['Portuguese'];else{if(_0x237b3f[0x0]['language']=='Chinese')var _0x21f01a=users[_0x245141(0x148)];else{if(_0x237b3f[0x0]['language']=='Arabic\x20(ae)')var _0x21f01a=users['Arabic'];}}}}}}}_0x574a6d[_0x245141(0x120)](_0x245141(0x13b),{'success':_0x4da688[_0x245141(0x17c)](_0x245141(0x199)),'errors':_0x4da688[_0x245141(0x17c)](_0x245141(0x174)),'role':_0x4ec2a4,'profile':_0x426f6e,'customer':_0x41faa8,'warehouse':_0x30e1b6,'product':_0x16a7f9,'user':_0x2f164f,'master_shop':_0x237b3f,'unit':_0x1253b3,'language':_0x21f01a,'suppliers':_0x2c0ff3,'dataSelected':_0x126354});}catch(_0x1d2d67){console[_0x245141(0x1b7)](_0x1d2d67);}}),router[a0_0x9c1edb(0x183)](a0_0x9c1edb(0x176),auth,async(_0x1f1e64,_0x596722)=>{var _0x3980ea=a0_0x9c1edb;try{const _0x5e8b2b=_0x1f1e64[_0x3980ea(0x1ae)]['id'],{invoice:_0x5e9cf5,warehouse_name:_0x4955b9,Room_name:_0x44c7a1}=_0x1f1e64[_0x3980ea(0xff)],_0x550b2f=await warehouse['findOne']({'name':_0x4955b9,'room':_0x44c7a1}),_0x4915b8=await purchases[_0x3980ea(0x104)]({'invoice':_0x5e9cf5});_0x4915b8[_0x3980ea(0x1d8)][_0x3980ea(0x1d4)](_0xe8eb48=>{var _0x48d529=_0x3980ea,_0xf0a188=0x0;const _0x8a230f=_0x550b2f[_0x48d529(0x103)][_0x48d529(0x135)](_0x3918b5=>{var _0x4f498b=_0x48d529;_0x3918b5[_0x4f498b(0x153)]==_0xe8eb48['product_name']&&_0x3918b5['floorlevel']==_0xe8eb48[_0x4f498b(0x19a)]&&_0x3918b5[_0x4f498b(0x1c9)]==_0xe8eb48[_0x4f498b(0x1c9)]&&_0x3918b5[_0x4f498b(0x18b)]==_0xe8eb48['bin']&&_0x3918b5[_0x4f498b(0x1a2)]==_0xe8eb48[_0x4f498b(0x1a2)]&&_0x3918b5[_0x4f498b(0x1bb)]==_0xe8eb48[_0x4f498b(0x1bb)]&&_0x3918b5[_0x4f498b(0x156)]==_0xe8eb48[_0x4f498b(0x156)]&&_0x3918b5[_0x4f498b(0x1a7)]==_0xe8eb48[_0x4f498b(0x1a7)]&&_0x3918b5[_0x4f498b(0xe5)]==_0xe8eb48[_0x4f498b(0xe5)]&&_0x3918b5['production_date']==_0xe8eb48[_0x4f498b(0x13a)]&&_0x3918b5[_0x4f498b(0x16b)]==_0xe8eb48[_0x4f498b(0x16b)]&&_0x3918b5[_0x4f498b(0x1bf)]==_0xe8eb48[_0x4f498b(0x1bf)]&&(_0x3918b5[_0x4f498b(0x158)]=parseInt(_0x3918b5['product_stock'])+parseInt(_0xe8eb48[_0x4f498b(0xde)]),_0xf0a188++);});_0xf0a188=='0'&&(_0x550b2f[_0x48d529(0x103)]=_0x550b2f[_0x48d529(0x103)][_0x48d529(0x1a4)]({'product_name':_0xe8eb48['product_name'],'product_stock':_0xe8eb48[_0x48d529(0xde)],'primary_code':_0xe8eb48[_0x48d529(0x166)],'secondary_code':_0xe8eb48[_0x48d529(0x127)],'product_code':_0xe8eb48[_0x48d529(0xf7)],'storage':_0xe8eb48[_0x48d529(0x156)],'rack':_0xe8eb48[_0x48d529(0x1bb)],'bay':_0xe8eb48[_0x48d529(0x1a2)],'bin':_0xe8eb48[_0x48d529(0x18b)],'type':_0xe8eb48['type'],'floorlevel':_0xe8eb48[_0x48d529(0x19a)],'maxProducts':_0xe8eb48[_0x48d529(0x122)],'unit':_0xe8eb48['standard_unit'],'secondary_unit':_0xe8eb48[_0x48d529(0x168)],'expiry_date':_0xe8eb48[_0x48d529(0x1a7)],'maxPerUnit':_0xe8eb48[_0x48d529(0x1cb)],'batch_code':_0xe8eb48['batch_code'],'alertQTY':_0xe8eb48[_0x48d529(0x1dc)],'production_date':_0xe8eb48[_0x48d529(0x13a)],'delivery_date':_0xe8eb48[_0x48d529(0x16b)],'delivery_code':_0xe8eb48[_0x48d529(0x1bf)]}));}),await _0x550b2f[_0x3980ea(0x1c6)](),_0x4915b8['finalize']=_0x3980ea(0x113);const _0x1863b3=await _0x4915b8[_0x3980ea(0x1c6)]();_0x1f1e64[_0x3980ea(0x17c)]('success',_0x3980ea(0x17b)),_0x596722[_0x3980ea(0x17d)](_0x3980ea(0xd8));}catch(_0x44e76d){console[_0x3980ea(0x1b7)](_0x44e76d);}}),router[a0_0x9c1edb(0xe7)]('/view/:id',auth,async(_0x55ad53,_0xb1d0d5)=>{var _0x1a7914=a0_0x9c1edb;try{const {username:_0x2b38f1,email:_0x302e40,role:_0x4fbacf}=_0x55ad53[_0x1a7914(0x188)],_0x2b79fc=_0x55ad53[_0x1a7914(0x188)],_0x3255c4=await profile['findOne']({'email':_0x2b79fc[_0x1a7914(0x18e)]}),_0x345a35=await master_shop['find'](),_0xd255d7=_0x55ad53['params']['id'],_0x3b7f36=await purchases[_0x1a7914(0x134)](_0xd255d7),_0x151369=await suppliers['find']({});let _0x132583;if(_0x2b79fc[_0x1a7914(0x126)]==_0x1a7914(0x14c)){const _0x2284b1=await staff['findOne']({'email':_0x2b79fc[_0x1a7914(0x18e)]});_0x132583=await warehouse[_0x1a7914(0x1b1)]({'status':'Enabled','name':_0x2284b1['warehouse'],'warehouse_category':'Raw\x20Materials'});}else _0x132583=await warehouse[_0x1a7914(0xf1)]([{'$match':{'status':_0x1a7914(0x1ef),'warehouse_category':_0x1a7914(0x1d3)}},{'$group':{'_id':'$name','name':{'$first':_0x1a7914(0x1cc)}}}]);const _0x38928b=await product[_0x1a7914(0x1b1)]({}),_0x516449=BayBinSelected(_0x3b7f36[_0x1a7914(0x1d6)],_0x3b7f36[_0x1a7914(0xfe)]);let _0x47f90f=new Date(_0x3b7f36[_0x1a7914(0x1a7)]),_0x327412=('0'+_0x47f90f[_0x1a7914(0x191)]())[_0x1a7914(0x1d7)](-0x2),_0x54f296=('0'+(_0x47f90f['getMonth']()+0x1))[_0x1a7914(0x1d7)](-0x2),_0x4f8a19=_0x47f90f['getFullYear'](),_0x126831=_0x4f8a19+'-'+_0x54f296+'-'+_0x327412;if(_0x345a35[0x0][_0x1a7914(0x1a6)]==_0x1a7914(0x162)){var _0x1d769e=users[_0x1a7914(0x15e)];console[_0x1a7914(0x1b7)](_0x1d769e);}else{if(_0x345a35[0x0]['language']==_0x1a7914(0x1b0))var _0x1d769e=users[_0x1a7914(0x1b0)];else{if(_0x345a35[0x0][_0x1a7914(0x1a6)]==_0x1a7914(0xfc))var _0x1d769e=users['German'];else{if(_0x345a35[0x0][_0x1a7914(0x1a6)]==_0x1a7914(0x131))var _0x1d769e=users[_0x1a7914(0x131)];else{if(_0x345a35[0x0][_0x1a7914(0x1a6)]==_0x1a7914(0x1e2))var _0x1d769e=users[_0x1a7914(0x1e2)];else{if(_0x345a35[0x0][_0x1a7914(0x1a6)]==_0x1a7914(0x177))var _0x1d769e=users[_0x1a7914(0x165)];else{if(_0x345a35[0x0][_0x1a7914(0x1a6)]==_0x1a7914(0x148))var _0x1d769e=users[_0x1a7914(0x148)];else{if(_0x345a35[0x0]['language']==_0x1a7914(0x170))var _0x1d769e=users['Arabic'];}}}}}}}_0xb1d0d5[_0x1a7914(0x120)]('edit_purchases',{'success':_0x55ad53[_0x1a7914(0x17c)](_0x1a7914(0x199)),'errors':_0x55ad53[_0x1a7914(0x17c)](_0x1a7914(0x174)),'role':_0x2b79fc,'profile':_0x3255c4,'purchases':_0x3b7f36,'suppliers':_0x151369,'warehouse':_0x132583,'product':_0x38928b,'master_shop':_0x345a35,'language':_0x1d769e,'ed_fullDate':_0x126831,'dataSelected':_0x516449});}catch(_0x137fa9){console[_0x1a7914(0x1b7)](_0x137fa9);}}),router['post'](a0_0x9c1edb(0x186),auth,async(_0x32985a,_0x1a7acf)=>{var _0x17d44c=a0_0x9c1edb;try{const _0x10021a=_0x32985a[_0x17d44c(0x1ae)]['id'],_0x458b48=await purchases[_0x17d44c(0x104)]({'_id':_0x32985a['params']['id']}),_0x281364=await warehouse['findOne']({'name':_0x458b48['warehouse_name'],'room':_0x458b48['room']});_0x458b48['product']['forEach'](_0x39f754=>{var _0x41b684=_0x17d44c;const _0xec249e=_0x281364[_0x41b684(0x103)][_0x41b684(0x135)](_0x4334cd=>{var _0x48918f=_0x41b684;_0x4334cd[_0x48918f(0x153)]==_0x39f754[_0x48918f(0x153)]&&_0x4334cd[_0x48918f(0x19a)]==_0x39f754[_0x48918f(0x19a)]&&_0x4334cd[_0x48918f(0x1c9)]==_0x39f754[_0x48918f(0x1c9)]&&_0x4334cd['bin']==_0x39f754[_0x48918f(0x18b)]&&_0x4334cd['bay']==_0x39f754['bay']&&_0x4334cd['rack']==_0x39f754['rack']&&_0x4334cd[_0x48918f(0x156)]==_0x39f754[_0x48918f(0x156)]&&(_0x4334cd['product_stock']=parseInt(_0x4334cd[_0x48918f(0x158)])-parseInt(_0x39f754[_0x48918f(0xde)]));});}),await _0x281364['save']();const {invoice:_0x34edb7,suppliers:_0xb9b5a1,date:_0x90a0c,warehouse_name:_0x50e317,prod_name:_0x4ccc42,prod_code:_0x19cce0,prod_qty:_0x37be38,prod_unit:_0x50acf8,prod_secondunit:_0x209181,prod_level:_0x3c3cb5,prod_isle:_0x2b617d,prod_pallet:_0x1b6d8c,note:_0x58de15,expiry_date:_0x34972,batch_code:_0x5e7fca,paid_amount:_0x79441b,due_amount:_0x377812,Room_name:_0x32d982,primary_code:_0x3f78e7,secondary_code:_0x4068b6,PO_number:_0xe63aa4,JO_number:_0x502193}=_0x32985a[_0x17d44c(0xff)];if(typeof _0x4ccc42=='string')var _0x304cad=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x12b)]],_0x438b32=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0xe2)]],_0x2bda10=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x11a)]],_0x212be1=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x10a)]],_0x4bc49d=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x1d0)]],_0x4ed776=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x1dd)]],_0x5f31d4=[_0x32985a['body']['prod_isle']],_0xc39db6=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x15f)]],_0x483d46=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x166)]],_0x402710=[_0x32985a['body'][_0x17d44c(0x127)]],_0x540801=[_0x32985a['body'][_0x17d44c(0x196)]],_0x4cb941=[_0x32985a[_0x17d44c(0xff)]['batch_code']],_0x188226=[_0x32985a['body'][_0x17d44c(0x1a7)]],_0xb2c9e9=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x156)]],_0x43d551=[_0x32985a[_0x17d44c(0xff)]['rak']],_0x176d05=[_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x1c9)]];else var _0x304cad=[..._0x32985a[_0x17d44c(0xff)]['prod_name']],_0x438b32=[..._0x32985a[_0x17d44c(0xff)]['prod_code']],_0x2bda10=[..._0x32985a['body']['prod_qty']],_0x212be1=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x10a)]],_0x4bc49d=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x1d0)]],_0x4ed776=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x1dd)]],_0x5f31d4=[..._0x32985a['body'][_0x17d44c(0x1ba)]],_0xc39db6=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x15f)]],_0x483d46=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x166)]],_0x402710=[..._0x32985a['body'][_0x17d44c(0x127)]],_0x540801=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x196)]],_0x4cb941=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0xe5)]],_0x188226=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x1a7)]],_0xb2c9e9=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x156)]],_0x43d551=[..._0x32985a[_0x17d44c(0xff)][_0x17d44c(0x19d)]],_0x176d05=[..._0x32985a['body'][_0x17d44c(0x1c9)]];const _0x13e430=_0x304cad['map'](_0x3c9a9f=>{return _0x3c9a9f={'product_name':_0x3c9a9f};});_0x438b32[_0x17d44c(0x1d4)]((_0x14f357,_0x479c34)=>{var _0x33a496=_0x17d44c;_0x13e430[_0x479c34][_0x33a496(0xf7)]=_0x14f357;}),_0x2bda10[_0x17d44c(0x1d4)]((_0x196b47,_0x574b02)=>{var _0x38d3ff=_0x17d44c;_0x13e430[_0x574b02][_0x38d3ff(0xde)]=_0x196b47;}),_0x212be1[_0x17d44c(0x1d4)]((_0xb9de94,_0x5b1836)=>{var _0x238427=_0x17d44c;_0x13e430[_0x5b1836][_0x238427(0x194)]=_0xb9de94;}),_0x4bc49d['forEach']((_0xb8c8eb,_0x31eac6)=>{var _0x12524c=_0x17d44c;_0x13e430[_0x31eac6][_0x12524c(0x168)]=_0xb8c8eb;}),_0x4ed776[_0x17d44c(0x1d4)]((_0x3811ec,_0x2b6ad3)=>{var _0x385c6f=_0x17d44c;_0x13e430[_0x2b6ad3][_0x385c6f(0x1a2)]=_0x3811ec;}),_0x5f31d4[_0x17d44c(0x1d4)]((_0x49b3c9,_0x359003)=>{_0x13e430[_0x359003]['bin']=_0x49b3c9;}),_0xc39db6[_0x17d44c(0x1d4)]((_0x1a2c09,_0x160212)=>{_0x13e430[_0x160212]['floorlevel']=_0x1a2c09;}),_0x483d46[_0x17d44c(0x1d4)]((_0x41cf46,_0x4ad92a)=>{_0x13e430[_0x4ad92a]['primary_code']=_0x41cf46;}),_0x402710[_0x17d44c(0x1d4)]((_0xc4873f,_0x10c151)=>{var _0x3dc6fe=_0x17d44c;_0x13e430[_0x10c151][_0x3dc6fe(0x127)]=_0xc4873f;}),_0x540801[_0x17d44c(0x1d4)]((_0xa24f7f,_0x50606c)=>{var _0x43a7bf=_0x17d44c;_0x13e430[_0x50606c][_0x43a7bf(0x122)]=_0xa24f7f;}),_0x4cb941['forEach']((_0x474c6e,_0x40f9ab)=>{_0x13e430[_0x40f9ab]['batch_code']=_0x474c6e;}),_0x188226[_0x17d44c(0x1d4)]((_0x55eb30,_0x131f39)=>{_0x13e430[_0x131f39]['expiry_date']=_0x55eb30;}),_0x176d05['forEach']((_0x390a4e,_0x548b3d)=>{var _0x2c0b3f=_0x17d44c;_0x13e430[_0x548b3d][_0x2c0b3f(0x1c9)]=_0x390a4e;}),_0xb2c9e9[_0x17d44c(0x1d4)]((_0x110349,_0x217b6c)=>{var _0x34a0f7=_0x17d44c;_0x13e430[_0x217b6c][_0x34a0f7(0x156)]=_0x110349;}),_0x43d551['forEach']((_0x11cc13,_0x3d6683)=>{var _0x362f5b=_0x17d44c;_0x13e430[_0x3d6683][_0x362f5b(0x1bb)]=_0x11cc13;});const _0x35f068=_0x13e430['filter'](_0x400b05=>_0x400b05[_0x17d44c(0xde)]!=='0'&&_0x400b05[_0x17d44c(0xde)]!=='');_0x458b48[_0x17d44c(0x116)]=_0x34edb7,_0x458b48[_0x17d44c(0x105)]=_0xb9b5a1,_0x458b48[_0x17d44c(0xe6)]=_0x90a0c,_0x458b48[_0x17d44c(0x1d6)]=_0x50e317,_0x458b48['product']=_0x35f068,_0x458b48['note']=_0x58de15,_0x458b48['paid_amount']=_0x79441b,_0x458b48[_0x17d44c(0x1c1)]=_0x377812,_0x458b48[_0x17d44c(0xfe)]=_0x32d982,_0x458b48[_0x17d44c(0xdd)]=_0xe63aa4,_0x458b48[_0x17d44c(0x16f)]=_0x502193;const _0x25baf7=await _0x458b48[_0x17d44c(0x1c6)](),_0x1893c1=await warehouse['findOne']({'name':_0x32985a[_0x17d44c(0xff)]['warehouse_name'],'room':_0x32985a[_0x17d44c(0xff)][_0x17d44c(0xea)]});_0x458b48[_0x17d44c(0x1d8)][_0x17d44c(0x1d4)](_0x36bfc6=>{var _0x5b4127=_0x17d44c,_0x3f3993=0x0;const _0x4bf2c6=_0x1893c1[_0x5b4127(0x103)][_0x5b4127(0x135)](_0x388990=>{var _0x15be96=_0x5b4127;_0x388990[_0x15be96(0x153)]==_0x36bfc6['product_name']&&_0x388990[_0x15be96(0x19a)]==_0x36bfc6['floorlevel']&&_0x388990[_0x15be96(0x1c9)]==_0x36bfc6[_0x15be96(0x1c9)]&&_0x388990[_0x15be96(0x18b)]==_0x36bfc6[_0x15be96(0x18b)]&&_0x388990[_0x15be96(0x1a2)]==_0x36bfc6['bay']&&_0x388990[_0x15be96(0x1bb)]==_0x36bfc6[_0x15be96(0x1bb)]&&_0x388990[_0x15be96(0x156)]==_0x36bfc6[_0x15be96(0x156)]&&(_0x388990['product_stock']=parseInt(_0x388990[_0x15be96(0x158)])+parseInt(_0x36bfc6[_0x15be96(0xde)]),_0x3f3993++);});_0x3f3993=='0'&&(_0x1893c1[_0x5b4127(0x103)]=_0x1893c1[_0x5b4127(0x103)]['concat']({'product_name':_0x36bfc6[_0x5b4127(0x153)],'product_stock':_0x36bfc6['quantity'],'primary_code':_0x36bfc6[_0x5b4127(0x166)],'secondary_code':_0x36bfc6['secondary_code'],'product_code':_0x36bfc6[_0x5b4127(0xf7)],'storage':_0x36bfc6['storage'],'rack':_0x36bfc6[_0x5b4127(0x1bb)],'bay':_0x36bfc6['bay'],'bin':_0x36bfc6[_0x5b4127(0x18b)],'type':_0x36bfc6[_0x5b4127(0x1c9)],'floorlevel':_0x36bfc6[_0x5b4127(0x19a)],'maxProducts':_0x36bfc6[_0x5b4127(0x122)],'unit':_0x36bfc6[_0x5b4127(0x194)],'secondary_unit':_0x36bfc6[_0x5b4127(0x168)],'expiry_date':_0x36bfc6[_0x5b4127(0x1a7)]}));}),await _0x1893c1[_0x17d44c(0x1c6)]();const _0x4b37ad=await s_payment_data[_0x17d44c(0x104)]({'invoice':_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x116)]});if(_0x4b37ad===null){}else console[_0x17d44c(0x1b7)](_0x17d44c(0x105),_0x4b37ad,_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x116)]),_0x4b37ad[_0x17d44c(0x105)]=_0x32985a[_0x17d44c(0xff)][_0x17d44c(0x105)],await _0x4b37ad['save']();_0x32985a[_0x17d44c(0x17c)](_0x17d44c(0x199),_0x17d44c(0x124)),_0x1a7acf[_0x17d44c(0x17d)]('/all_purchases/view');}catch(_0x4b414a){console['log'](_0x4b414a);}}),router['post'](a0_0x9c1edb(0x1bc),auth,async(_0x4aa8aa,_0x3cb6e1)=>{var _0x31e867=a0_0x9c1edb;try{const _0x20de45=_0x4aa8aa['params']['id'],{invoice:_0x293efd,suppliers:_0x1185ee,payable:_0x3b0211,due_amount:_0x55c04c}=_0x4aa8aa[_0x31e867(0xff)],_0x49e66a=await purchases[_0x31e867(0x134)](_0x20de45);var _0x1738fd=_0x3b0211-_0x55c04c;_0x49e66a['paid_amount']=parseFloat(_0x49e66a[_0x31e867(0x14b)])+parseFloat(_0x55c04c),_0x49e66a[_0x31e867(0x1c1)]=_0x1738fd;const _0x280ffd=await _0x49e66a[_0x31e867(0x1c6)]();console[_0x31e867(0x1b7)](_0x280ffd);const _0x3a6ea7=await s_payment_data[_0x31e867(0x104)]({'invoice':_0x293efd});_0x3a6ea7[_0x31e867(0x1e3)]=_0x1738fd,await _0x3a6ea7[_0x31e867(0x1c6)]();let _0x57c082=new Date(),_0x40ed8c=('0'+_0x57c082['getDate']())[_0x31e867(0x1d7)](-0x2),_0x663fe2=('0'+(_0x57c082['getMonth']()+0x1))[_0x31e867(0x1d7)](-0x2),_0x43c6b5=_0x57c082[_0x31e867(0x100)](),_0x5a7bbd=_0x43c6b5+'-'+_0x663fe2+'-'+_0x40ed8c;const _0x22466f=new suppliers_payment({'invoice':_0x293efd,'date':_0x43c6b5+'-'+_0x663fe2+'-'+_0x40ed8c,'suppliers':_0x1185ee,'reason':'Paid\x20For\x20Purchase','amount':_0x55c04c}),_0x56f865=await _0x22466f[_0x31e867(0x1c6)]();_0x4aa8aa[_0x31e867(0x17c)]('success',_0x31e867(0x125)),_0x3cb6e1['redirect'](_0x31e867(0xd8));}catch(_0x3c7b68){console[_0x31e867(0x1b7)](_0x3c7b68);}}),router[a0_0x9c1edb(0xe7)](a0_0x9c1edb(0x157),auth,async(_0x1f3ea0,_0x4e17ac)=>{var _0xa6dca4=a0_0x9c1edb;try{const {username:_0x5b9f94,email:_0x4462a1,role:_0x52260c}=_0x1f3ea0[_0xa6dca4(0x188)],_0x29de05=_0x1f3ea0[_0xa6dca4(0x188)],_0x5267f=await profile[_0xa6dca4(0x104)]({'email':_0x29de05[_0xa6dca4(0x18e)]}),_0xf5d8d4=await master_shop['find']();console[_0xa6dca4(0x1b7)](_0xa6dca4(0x151),_0xf5d8d4);const _0x16e484=_0x1f3ea0[_0xa6dca4(0x1ae)]['id'],_0x479058=await purchases[_0xa6dca4(0x134)](_0x16e484);console[_0xa6dca4(0x1b7)](_0x479058);const _0x1cb45e=await suppliers['findOne']({'name':_0x479058['suppliers']});console['log'](_0x1cb45e);if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0x162)){var _0x55ae18=users[_0xa6dca4(0x15e)];console[_0xa6dca4(0x1b7)](_0x55ae18);}else{if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0x1b0))var _0x55ae18=users[_0xa6dca4(0x1b0)];else{if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0xfc))var _0x55ae18=users[_0xa6dca4(0xfc)];else{if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0x131))var _0x55ae18=users[_0xa6dca4(0x131)];else{if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0x1e2))var _0x55ae18=users[_0xa6dca4(0x1e2)];else{if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0x177))var _0x55ae18=users[_0xa6dca4(0x165)];else{if(_0xf5d8d4[0x0][_0xa6dca4(0x1a6)]==_0xa6dca4(0x148))var _0x55ae18=users[_0xa6dca4(0x148)];else{if(_0xf5d8d4[0x0]['language']==_0xa6dca4(0x170))var _0x55ae18=users['Arabic'];}}}}}}}_0x4e17ac['render'](_0xa6dca4(0x159),{'success':_0x1f3ea0[_0xa6dca4(0x17c)](_0xa6dca4(0x199)),'errors':_0x1f3ea0[_0xa6dca4(0x17c)](_0xa6dca4(0x174)),'role':_0x29de05,'profile':_0x5267f,'master_shop':_0xf5d8d4,'supplier':_0x1cb45e,'purchase':_0x479058,'language':_0x55ae18});}catch(_0x2a876f){console[_0xa6dca4(0x1b7)](_0x2a876f);}}),router['get']('/view/return_purchase/:id',auth,async(_0xe15c7c,_0x3c0c6f)=>{var _0x5889eb=a0_0x9c1edb;try{const {username:_0x35b730,email:_0x1c73db,role:_0x37071d}=_0xe15c7c[_0x5889eb(0x188)],_0x3b9d5c=_0xe15c7c['user'],_0x4e0915=await profile['findOne']({'email':_0x3b9d5c[_0x5889eb(0x18e)]}),_0x2a2a7c=await master_shop['find']();console[_0x5889eb(0x1b7)](_0x5889eb(0x151),_0x2a2a7c);const _0x58c816=_0xe15c7c[_0x5889eb(0x1ae)]['id'];console[_0x5889eb(0x1b7)](_0x58c816);const _0x581319=await purchases[_0x5889eb(0x134)](_0x58c816);console[_0x5889eb(0x1b7)](_0x5889eb(0x173),_0x581319);const _0x341835=await product[_0x5889eb(0x1b1)]({}),_0x5e6e30=await warehouse[_0x5889eb(0xf1)]([{'$match':{'name':_0x581319[_0x5889eb(0x1d6)],'room':_0x581319[_0x5889eb(0xfe)],'warehouse_category':_0x5889eb(0x1d3)}},{'$unwind':_0x5889eb(0x136)},{'$group':{'_id':_0x5889eb(0x13f),'name':{'$first':_0x5889eb(0x1d2)},'product_stock':{'$first':_0x5889eb(0x146)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5889eb(0xf4)},'type':{'$first':_0x5889eb(0x111)},'floorlevel':{'$first':_0x5889eb(0x18a)},'primary_code':{'$first':_0x5889eb(0x17a)},'secondary_code':{'$first':_0x5889eb(0x12d)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x5889eb(0xf1)]([{'$match':{'status':_0x5889eb(0x1ef),'name':'Return\x20Goods','warehouse_category':_0x5889eb(0x1d3)}},{'$group':{'_id':_0x5889eb(0x1cc),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x5889eb(0x1b7)](_0x5889eb(0x19c),_0x5e6e30);if(_0x2a2a7c[0x0]['language']==_0x5889eb(0x162)){var _0x5aa5aa=users[_0x5889eb(0x15e)];console[_0x5889eb(0x1b7)](_0x5aa5aa);}else{if(_0x2a2a7c[0x0][_0x5889eb(0x1a6)]==_0x5889eb(0x1b0))var _0x5aa5aa=users[_0x5889eb(0x1b0)];else{if(_0x2a2a7c[0x0]['language']==_0x5889eb(0xfc))var _0x5aa5aa=users[_0x5889eb(0xfc)];else{if(_0x2a2a7c[0x0][_0x5889eb(0x1a6)]=='Spanish')var _0x5aa5aa=users['Spanish'];else{if(_0x2a2a7c[0x0]['language']==_0x5889eb(0x1e2))var _0x5aa5aa=users[_0x5889eb(0x1e2)];else{if(_0x2a2a7c[0x0][_0x5889eb(0x1a6)]==_0x5889eb(0x177))var _0x5aa5aa=users[_0x5889eb(0x165)];else{if(_0x2a2a7c[0x0][_0x5889eb(0x1a6)]==_0x5889eb(0x148))var _0x5aa5aa=users[_0x5889eb(0x148)];else{if(_0x2a2a7c[0x0][_0x5889eb(0x1a6)]==_0x5889eb(0x170))var _0x5aa5aa=users[_0x5889eb(0xd6)];}}}}}}}_0x3c0c6f[_0x5889eb(0x120)](_0x5889eb(0xe1),{'success':_0xe15c7c[_0x5889eb(0x17c)]('success'),'errors':_0xe15c7c['flash'](_0x5889eb(0x174)),'role':_0x3b9d5c,'profile':_0x4e0915,'user':_0x581319,'stock':_0x5e6e30,'master_shop':_0x2a2a7c,'product':_0x341835,'language':_0x5aa5aa,'warehouse':warehouse_data});}catch(_0xbc9f8){console[_0x5889eb(0x1b7)](_0xbc9f8);}}),router[a0_0x9c1edb(0x183)](a0_0x9c1edb(0xd5),auth,async(_0x524778,_0x252998)=>{var _0x2ba2e2=a0_0x9c1edb;try{const {invoice:_0x2a25b9,date:_0x414d75,warehouse_name:_0x2ee65e,Room_name:_0x438c5d,product_name:_0x3d75b8,purchase_quantity:_0x21a0fd,stocks:_0xf73475,return_qty:_0x233699,note:_0x18b643,level:_0xc3e1a0,isle:_0x1b70c6,pallet:_0x8cda42,to_warehouse_name:_0x5de1a9,to_Room_name:_0x1d7d07}=_0x524778[_0x2ba2e2(0xff)],_0x5dac36=await purchases[_0x2ba2e2(0x104)]({'_id':_0x524778['params']['id']}),_0x3175e8=await warehouse[_0x2ba2e2(0x104)]({'name':_0x2ee65e,'room':_0x438c5d});if(typeof _0x3d75b8==_0x2ba2e2(0x11f))var _0x59c36d=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x153)]],_0x32cf42=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x1c2)]],_0xdc2931=[_0x524778[_0x2ba2e2(0xff)]['stocks']],_0x2b7b12=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x193)]],_0x58c409=[_0x524778[_0x2ba2e2(0xff)]['level']],_0xec1e09=[_0x524778['body'][_0x2ba2e2(0x1af)]],_0x4b540a=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x1bd)]],_0x2684a3=[_0x524778['body']['types']],_0x321c04=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x108)]],_0x321c87=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x1b4)]],_0x5acb8d=[_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x1ce)]];else var _0x59c36d=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x153)]],_0x32cf42=[..._0x524778['body'][_0x2ba2e2(0x1c2)]],_0xdc2931=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0xec)]],_0x2b7b12=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x193)]],_0x58c409=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0xf6)]],_0xec1e09=[..._0x524778['body'][_0x2ba2e2(0x1af)]],_0x4b540a=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x1bd)]],_0x2684a3=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x109)]],_0x321c04=[..._0x524778[_0x2ba2e2(0xff)]['product_code_hide']],_0x321c87=[..._0x524778['body'][_0x2ba2e2(0x1b4)]],_0x5acb8d=[..._0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x1ce)]];const _0x223d7d=_0x59c36d[_0x2ba2e2(0x135)](_0x3c86cf=>{return _0x3c86cf={'product_name':_0x3c86cf};});_0x32cf42['forEach']((_0xd50283,_0xc59665)=>{_0x223d7d[_0xc59665]['purchase_quantity']=_0xd50283;}),_0xdc2931[_0x2ba2e2(0x1d4)]((_0x1c02de,_0x2f817f)=>{_0x223d7d[_0x2f817f]['stock_quantity']=_0x1c02de;}),_0x2b7b12[_0x2ba2e2(0x1d4)]((_0xb32c37,_0x50c20f)=>{_0x223d7d[_0x50c20f]['return_qty']=_0xb32c37;}),_0x58c409[_0x2ba2e2(0x1d4)]((_0x2c288d,_0x5aec11)=>{var _0x207981=_0x2ba2e2;_0x223d7d[_0x5aec11][_0x207981(0x1a2)]=_0x2c288d;}),_0xec1e09[_0x2ba2e2(0x1d4)]((_0x31e767,_0x3b9dd2)=>{var _0x2a0cde=_0x2ba2e2;_0x223d7d[_0x3b9dd2][_0x2a0cde(0x18b)]=_0x31e767;}),_0x4b540a[_0x2ba2e2(0x1d4)]((_0x4c1f3b,_0x32599b)=>{var _0x1a0d9f=_0x2ba2e2;_0x223d7d[_0x32599b][_0x1a0d9f(0x19a)]=_0x4c1f3b;}),_0x2684a3[_0x2ba2e2(0x1d4)]((_0x50ac59,_0xd6bc4a)=>{_0x223d7d[_0xd6bc4a]['type']=_0x50ac59;}),_0x321c04['forEach']((_0x109994,_0x4022dd)=>{var _0x210eaf=_0x2ba2e2;_0x223d7d[_0x4022dd][_0x210eaf(0xf7)]=_0x109994;}),_0x321c87[_0x2ba2e2(0x1d4)]((_0x3a6b30,_0x49560c)=>{_0x223d7d[_0x49560c]['primary_code']=_0x3a6b30;}),_0x5acb8d[_0x2ba2e2(0x1d4)]((_0x34c5a7,_0x120407)=>{var _0x21dcd8=_0x2ba2e2;_0x223d7d[_0x120407][_0x21dcd8(0x127)]=_0x34c5a7;}),_0x5dac36['product'][_0x2ba2e2(0x1d4)](_0x4388ca=>{var _0x51045f=_0x2ba2e2;const _0x5eba00=_0x3175e8['product_details'][_0x51045f(0x135)](_0x410150=>{var _0x7cd840=_0x51045f;_0x410150[_0x7cd840(0x153)]==_0x4388ca[_0x7cd840(0x153)]&&_0x410150[_0x7cd840(0x19a)]==_0x4388ca['floorlevel']&&_0x410150[_0x7cd840(0x1c9)]==_0x4388ca[_0x7cd840(0x1c9)]&&_0x410150[_0x7cd840(0x18b)]==_0x4388ca['bin']&&_0x410150['bay']==_0x4388ca['bay']&&_0x410150['rack']==_0x4388ca[_0x7cd840(0x1bb)]&&_0x410150[_0x7cd840(0x156)]==_0x4388ca['storage']&&(console[_0x7cd840(0x1b7)](parseInt(_0x410150[_0x7cd840(0x158)])+_0x7cd840(0x138)+parseInt(_0x4388ca[_0x7cd840(0xde)])),_0x410150[_0x7cd840(0x158)]=parseInt(_0x410150[_0x7cd840(0x158)])+parseInt(_0x4388ca[_0x7cd840(0xde)]));});}),await _0x3175e8[_0x2ba2e2(0x1c6)]();const _0x415544=_0x223d7d[_0x2ba2e2(0x1b8)](_0x878864=>_0x878864[_0x2ba2e2(0x193)]!=='0'&&_0x878864['return_qty']!=='');var _0x43144f=0x0;_0x415544[_0x2ba2e2(0x1d4)](_0x33d366=>{var _0x481ef2=_0x2ba2e2;console['log'](_0x481ef2(0x19f),_0x33d366),(parseInt(_0x33d366[_0x481ef2(0x1c2)])<parseInt(_0x33d366[_0x481ef2(0x193)])||parseInt(_0x33d366[_0x481ef2(0x180)])<parseInt(_0x33d366['return_qty']))&&_0x43144f++;});if(_0x43144f!=0x0)return _0x524778[_0x2ba2e2(0x17c)](_0x2ba2e2(0x174),_0x2ba2e2(0x139)),_0x252998['redirect'](_0x2ba2e2(0x18f));const _0x2a4245=new purchases_return({'invoice':_0x2a25b9,'suppliers':_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x105)],'date':_0x414d75,'warehouse_name':_0x2ee65e,'return_product':_0x415544,'note':_0x18b643,'room':_0x438c5d,'to_warehouse_name':_0x5de1a9,'to_room':_0x1d7d07}),_0x492570=await _0x2a4245['save']();console[_0x2ba2e2(0x1b7)](_0x2a4245);const _0x386a5f=await purchases_return[_0x2ba2e2(0x104)]({'invoice':_0x2a25b9}),_0x281a77=await warehouse['findOne']({'name':_0x5de1a9,'room':_0x1d7d07});_0x386a5f[_0x2ba2e2(0x130)][_0x2ba2e2(0x1d4)](_0x296b06=>{var _0x3fa410=_0x2ba2e2,_0x1bcba9=0x0;const _0x49a93a=_0x281a77[_0x3fa410(0x103)][_0x3fa410(0x135)](_0x156ad3=>{var _0x28d6cd=_0x3fa410;_0x156ad3[_0x28d6cd(0x153)]==_0x296b06[_0x28d6cd(0x153)]&&_0x156ad3[_0x28d6cd(0x19a)]==_0x296b06[_0x28d6cd(0x19a)]&&_0x156ad3[_0x28d6cd(0x1c9)]==_0x296b06[_0x28d6cd(0x1c9)]&&_0x156ad3[_0x28d6cd(0x18b)]==_0x296b06[_0x28d6cd(0x18b)]&&_0x156ad3[_0x28d6cd(0x1a2)]==_0x296b06[_0x28d6cd(0x1a2)]&&(_0x156ad3[_0x28d6cd(0x158)]=parseInt(_0x156ad3[_0x28d6cd(0x158)])-parseInt(_0x296b06['return_qty']),_0x1bcba9++);});_0x1bcba9=='0'&&(_0x281a77[_0x3fa410(0x103)]=_0x281a77[_0x3fa410(0x103)]['concat']({'product_name':_0x296b06[_0x3fa410(0x153)],'product_stock':_0x296b06[_0x3fa410(0x193)],'primary_code':_0x296b06[_0x3fa410(0x166)],'secondary_code':_0x296b06[_0x3fa410(0x127)],'product_code':_0x296b06[_0x3fa410(0xf7)],'storage':_0x296b06[_0x3fa410(0x156)],'rack':_0x296b06[_0x3fa410(0x1bb)],'bay':_0x296b06[_0x3fa410(0x1a2)],'bin':_0x296b06['bin'],'type':_0x296b06['type'],'floorlevel':_0x296b06[_0x3fa410(0x19a)],'maxProducts':_0x296b06['maxStocks'],'unit':_0x296b06[_0x3fa410(0x194)],'secondary_unit':_0x296b06['secondary_unit'],'expiry_date':_0x296b06[_0x3fa410(0x1a7)]}));}),await _0x281a77[_0x2ba2e2(0x1c6)]();const _0x473132=await purchases[_0x2ba2e2(0x104)]({'invoice':_0x2a25b9});_0x473132['return_data']='True';const _0x4c37d4=await _0x473132['save'](),_0x3bc62b=new s_payment_data({'invoice':_0x2a25b9,'suppliers':_0x524778[_0x2ba2e2(0xff)][_0x2ba2e2(0x105)],'reason':_0x2ba2e2(0x102)});await _0x3bc62b['save']();const _0x38777c=await master_shop['find']();console[_0x2ba2e2(0x1b7)](_0x2ba2e2(0x1ad),_0x38777c[0x0][_0x2ba2e2(0x169)]);const _0x226a68=await email_settings[_0x2ba2e2(0x104)](),_0x93253=await suppliers['findOne']({'name':_0x524778[_0x2ba2e2(0xff)]['suppliers']});console[_0x2ba2e2(0x1b7)](_0x2ba2e2(0x133),_0x93253);_0x38777c[0x0][_0x2ba2e2(0x1a3)]==0x1?(right_currency=_0x38777c[0x0][_0x2ba2e2(0x155)],left_currency=''):(right_currency='',left_currency=_0x38777c[0x0][_0x2ba2e2(0x155)]);var _0x542686=_0x59c36d,_0x5cbed8=_0x2b7b12,_0x3708c2='',_0x3b128b;for(_0x3b128b in _0x542686){_0x3708c2+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x542686[_0x3b128b]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5cbed8[_0x3b128b]+_0x2ba2e2(0xdb)+_0x2ba2e2(0xe8);}console[_0x2ba2e2(0x1b7)](_0x2ba2e2(0x184),_0x3708c2);let _0x390357=nodemailer[_0x2ba2e2(0x119)]({'service':'gmail','auth':{'user':_0x226a68[_0x2ba2e2(0x18e)],'pass':_0x226a68[_0x2ba2e2(0xe9)]}}),_0x501078={'from':_0x226a68[_0x2ba2e2(0x18e)],'to':_0x93253['email'],'subject':_0x2ba2e2(0x107),'attachments':[{'filename':_0x2ba2e2(0x19e),'path':__dirname+'/../public'+'/upload/'+_0x38777c[0x0][_0x2ba2e2(0x169)],'cid':_0x2ba2e2(0x12a)}],'html':_0x2ba2e2(0x197)+_0x2ba2e2(0x171)+_0x2ba2e2(0x161)+'<div>'+_0x2ba2e2(0x10e)+_0x2ba2e2(0x10b)+_0x2ba2e2(0x1ab)+_0x2ba2e2(0x1d5)+'<div>'+_0x2ba2e2(0x132)+_0x38777c[0x0][_0x2ba2e2(0x1e4)]+'\x20</h2>'+_0x2ba2e2(0x1d5)+_0x2ba2e2(0x1d5)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x2ba2e2(0x16d)+'\x20Order\x20Number\x20:\x20'+_0x2a25b9+'\x20'+_0x2ba2e2(0x175)+_0x2ba2e2(0xdf)+_0x414d75+'\x20'+'</span>'+_0x2ba2e2(0x145)+_0x2ba2e2(0x1d5)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2ba2e2(0x14e)+_0x2ba2e2(0xeb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2ba2e2(0x1d1)+_0x2ba2e2(0x1d9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x2ba2e2(0x1e7)+_0x2ba2e2(0x143)+'\x20'+_0x3708c2+'\x20'+_0x2ba2e2(0x11b)+_0x2ba2e2(0x172)+_0x2ba2e2(0x10b)+_0x2ba2e2(0x1ea)+'<h5>'+_0x38777c[0x0]['site_title']+_0x2ba2e2(0x145)+_0x2ba2e2(0x1d5)+_0x2ba2e2(0x1d5)+_0x2ba2e2(0x17e)};_0x390357['sendMail'](_0x501078,function(_0x43eae0,_0x57a596){var _0x282dfa=_0x2ba2e2;_0x43eae0?(console[_0x282dfa(0x1b7)](_0x43eae0),console[_0x282dfa(0x1b7)](_0x282dfa(0x190))):console[_0x282dfa(0x1b7)]('Email\x20sent\x20successfully');}),_0x524778[_0x2ba2e2(0x17c)](_0x2ba2e2(0x199),_0x2ba2e2(0x179)),_0x252998[_0x2ba2e2(0x17d)]('/all_purchases/view');}catch(_0x37fcc2){console['log'](_0x37fcc2),_0x252998[_0x2ba2e2(0x1eb)](0xc8)['json']({'message':_0x37fcc2[_0x2ba2e2(0x1b3)]});}}),router['get'](a0_0x9c1edb(0x16c),auth,async(_0x57925c,_0x274d3f)=>{var _0x2b4929=a0_0x9c1edb;try{const {username:_0x26296c,email:_0x3db042,role:_0x575ef2}=_0x57925c[_0x2b4929(0x188)],_0x294a58=_0x57925c[_0x2b4929(0x188)],_0x5abc43=await profile[_0x2b4929(0x104)]({'email':_0x294a58[_0x2b4929(0x18e)]}),_0x334cf0=await master_shop['find'](),_0x266b51=_0x57925c[_0x2b4929(0x1ae)]['id'],_0x292a7b=await purchases[_0x2b4929(0x134)](_0x266b51);if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0x162))var _0x5c9775=users[_0x2b4929(0x15e)];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0x1b0))var _0x5c9775=users[_0x2b4929(0x1b0)];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0xfc))var _0x5c9775=users[_0x2b4929(0xfc)];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]=='Spanish')var _0x5c9775=users[_0x2b4929(0x131)];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0x1e2))var _0x5c9775=users['French'];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0x177))var _0x5c9775=users[_0x2b4929(0x165)];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0x148))var _0x5c9775=users['Chinese'];else{if(_0x334cf0[0x0][_0x2b4929(0x1a6)]==_0x2b4929(0x170))var _0x5c9775=users[_0x2b4929(0xd6)];}}}}}}}_0x274d3f['render'](_0x2b4929(0x141),{'success':_0x57925c[_0x2b4929(0x17c)](_0x2b4929(0x199)),'errors':_0x57925c['flash'](_0x2b4929(0x174)),'role':_0x294a58,'profile':_0x5abc43,'alldata':_0x292a7b,'master_shop':_0x334cf0,'language':_0x5c9775}),console['log'](alldata);}catch(_0x2a900a){console[_0x2b4929(0x1b7)](_0x2a900a);}}),router['post'](a0_0x9c1edb(0x16e),async(_0x25f814,_0x103466)=>{var _0x41e1a4=a0_0x9c1edb;const {product_code:_0x5c3d50}=_0x25f814[_0x41e1a4(0xff)];var _0x5b81e4;const _0x5760b9=await product[_0x41e1a4(0xf1)]([{'$match':{'primary_code':_0x5c3d50,'product_category':_0x41e1a4(0x1d3)}},{'$group':{'_id':_0x41e1a4(0x140),'name':{'$first':_0x41e1a4(0x1cc)},'category':{'$first':_0x41e1a4(0x18d)},'brand':{'$first':_0x41e1a4(0x1df)},'unit':{'$first':_0x41e1a4(0x117)},'alertquantity':{'$first':_0x41e1a4(0x118)},'product_code':{'$first':_0x41e1a4(0x195)},'primary_code':{'$first':_0x41e1a4(0x1c8)},'secondary_code':{'$first':_0x41e1a4(0x1b5)},'maxStocks':{'$first':_0x41e1a4(0x1e5)},'maxProdPerUnit':{'$first':_0x41e1a4(0x128)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x41e1a4(0x10c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xfdfa52=await product['aggregate']([{'$match':{'secondary_code':_0x5c3d50,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x41e1a4(0x140),'name':{'$first':_0x41e1a4(0x1cc)},'category':{'$first':_0x41e1a4(0x18d)},'brand':{'$first':_0x41e1a4(0x1df)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x41e1a4(0x118)},'product_code':{'$first':_0x41e1a4(0x195)},'primary_code':{'$first':_0x41e1a4(0x1c8)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x41e1a4(0x1e5)},'maxProdPerUnit':{'$first':_0x41e1a4(0x128)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x41e1a4(0x10c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5760b9[_0x41e1a4(0x178)]>0x0)_0x5b81e4=_0x5760b9;else _0xfdfa52[_0x41e1a4(0x178)]>0x0&&(_0x5b81e4=_0xfdfa52);_0x103466[_0x41e1a4(0x142)](_0x5b81e4);}),router[a0_0x9c1edb(0x183)](a0_0x9c1edb(0x1c3),async(_0x4048ef,_0x13d40c)=>{var _0x2037b9=a0_0x9c1edb;const {primaryCode:_0x343d70,secondaryCode:_0x2df5d4,productCode:_0xe63719,bay:_0x4302f3,bin:_0x17cf1e,types:_0x2321ae,pallet:_0x286df5,warehouses:_0x3d2322,room:_0x4b5df8}=_0x4048ef['body'];console[_0x2037b9(0x1b7)](_0x4048ef['body']);try{const _0x3d35f6=await warehouse['aggregate']([{'$match':{'name':_0x3d2322,'room':_0x4b5df8}},{'$unwind':_0x2037b9(0x136)},{'$match':{'product_details.bay':_0x4302f3,'product_details.bin':_0x17cf1e,'product_details.type':_0x2321ae}},{'$group':{'_id':_0x2037b9(0x13f),'name':{'$first':_0x2037b9(0x1d2)},'product_stock':{'$first':_0x2037b9(0x146)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x2037b9(0x1ed)},'maxProducts':{'$first':_0x2037b9(0xda)}}}]);_0x13d40c[_0x2037b9(0x1eb)](0xc8)['json'](_0x3d35f6);}catch(_0xb3369f){_0x13d40c[_0x2037b9(0x1eb)](0x194)[_0x2037b9(0x142)]({'message':_0xb3369f[_0x2037b9(0x1b3)]});}}),module[a0_0x9c1edb(0x1e9)]=router;