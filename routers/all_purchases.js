var a0_0x1245f7=a0_0x5702;(function(_0x40f0de,_0x47c539){var _0x2f75b2=a0_0x5702,_0x56088a=_0x40f0de();while(!![]){try{var _0x940c77=-parseInt(_0x2f75b2(0x1aa))/0x1+-parseInt(_0x2f75b2(0x144))/0x2+-parseInt(_0x2f75b2(0x141))/0x3+parseInt(_0x2f75b2(0xf5))/0x4*(-parseInt(_0x2f75b2(0x19c))/0x5)+parseInt(_0x2f75b2(0xc1))/0x6+parseInt(_0x2f75b2(0xbf))/0x7*(-parseInt(_0x2f75b2(0x106))/0x8)+parseInt(_0x2f75b2(0x97))/0x9;if(_0x940c77===_0x47c539)break;else _0x56088a['push'](_0x56088a['shift']());}catch(_0x49a328){_0x56088a['push'](_0x56088a['shift']());}}}(a0_0x2f52,0x6cd89));const express=require(a0_0x1245f7(0x94)),app=express(),router=express[a0_0x1245f7(0x11e)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1245f7(0xf8)),auth=require(a0_0x1245f7(0x12d)),nodemailer=require(a0_0x1245f7(0x117));var ejs=require(a0_0x1245f7(0xb8));function a0_0x2f52(){var _0x2532c0=['$note','$product_details.rack','params','$product_details.type','$product_details.isle','prod_unit','stock_quantity','$name','$date','product_stock','$product_details.bin','createTransport','port','find','date','366837uZarfs','deliverycode','/invoice/:id','1441196RtNWGf','bay','path','Rack\x20E','suppliers_data','maxperunit','$expiry_date','Arabic\x20(ae)','suppliers_docs','master','rack','/view/return_purchase/:id','$product.bin','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Sales\x20Update\x20successfully','return_product','here','types','prod_name','RMSEmail','$product','catch','maxStocks','alertQTY','success','Error\x20Occurs','</div>','Return\x20Goods','<hr\x20class=\x22my-3\x22>','</span>','</body></html>','user','<span\x20style=\x22float:\x20right;\x22>','product_list','isle','<h2>\x20','$secondary_unit','name','flash','Level','secondary_code_hide','getFullYear','getDate','errors','role','$product_details.floorlevel','redirect','Email\x20sent\x20successfully','\x20<\x20wew\x20>\x20','French','$product_details.expiry_date','../public/language/languages.json','Purchase\x20data\x20added\x20successfully','English\x20(US)','/CheckingWarehouse','POnumber','edit_purchases','$category','Spanish','product_name','paid_amount','/barcode_scanner','/view/:id','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','abs','Enabled','$product_details.bay','Floor','product_code','$batch_code','$return_data','$product_details.storage','host','email','$maxStocks','$paid_amount','warehouse','language','prod_secondunit','secondary_unit','purchase_quantity','length','$suppliers_docs','save','German','$due_amount','Ambient','295vbAdWQ','Purchase\x20Return','post','$product_details.maxProducts','then','$invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','log','\x20Order\x20Date\x20:\x20','json','$product.floorlevel','invoice','\x20</h2>','$_id','345904fIcYUn','<html><head><title></title>','max_product_unit','$unit','prod_Qty','Shelves','prod_primunit','back','express','Enclosed','$product.quantity','16820271LlhNhE','site_title','prod_cat','Chinese','<!DOCTYPE\x20html>','concat','primary_code_hide','prod_invoice','currency_placement','aggregate','product_details','prod_level','stock_data','<tbody\x20style=\x22text-align:\x20center;\x22>','message','prod_isle','\x20Order\x20Number\x20:\x20','prod_code','English','/all_purchases/view','password','pallet','rak','product_code_hide','/preview/:id','$primary_code','Rack\x20B','delivery_code','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','note','padStart','/upload/','ejs','room_name','map','status','$product_details._id','primary_code','$secondary_code','2393321zYlAgi','level','4404360YnTfei','$room','warehouse_name','type','<tr>','/give_payment/:id','product','quantity','$product_details.product_name','$product.type','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','production_date','Receiving\x20Area','string','due_amount','toString','findById','$suppliers','batch_code','</td>','MaxStocks_data','user_id','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','actual_uom','all_purchases_barcode','$product_details.product_code','<strong>\x20Regards\x20</strong>','/../public','$product_code','INC-','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','gmail','add_purchases','stocks','$maxProdPerUnit','<div>','findOne','actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','render','\x20<>\x20','/barcode/:id','An\x20error\x20occurred.','floor','filter','$product_details','</tbody>','slice','foreach\x20newproduct','42472FWPieM','</tr>','suppliers','../models/all_models','Logo.png','secondary_code','return_qty','$product_details.product_stock','product_cat','edit_purchases_view','body','Purchase\x20Return\x20Mail','</h5>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','currency','$finalize','</table>','8dJuuML','Paid\x20For\x20Purchase','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','forEach','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Rack\x20A','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','RoomAssign','$brand','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','True','logo','expiry_date','standard_unit','nodemailer','Portuguese\x20(BR)','prod_qty','$product_details.pallet','$alertquantity','$product_details.secondary_code','get','Router','Portuguese','/all_purchases/view/','<h5>','staff','error','<h5\x20style=\x22text-align:\x20left;\x22>','Raw\x20Materials','COLD\x20STORAGE','Arabic','storage','prod_pallet','bin','Hindi','floorlevel','../middleware/auth','/view/add_purchases','$product.bay','Rack\x20C','image'];a0_0x2f52=function(){return _0x2532c0;};return a0_0x2f52();}const path=require(a0_0x1245f7(0x146)),users=require(a0_0x1245f7(0x177));router['get']('/view',auth,async(_0x4d593f,_0x2420d1)=>{var _0x3e5515=a0_0x1245f7;try{const {username:_0x388587,email:_0x1fee1d,role:_0x488e23}=_0x4d593f[_0x3e5515(0x163)],_0x5b5f84=_0x4d593f[_0x3e5515(0x163)],_0x6ed36=await profile[_0x3e5515(0xe8)]({'email':_0x5b5f84['email']}),_0x1ee3e9=await staff['findOne']({'email':_0x5b5f84[_0x3e5515(0x18e)]});if(_0x5b5f84[_0x3e5515(0x170)]==_0x3e5515(0x122)){const _0x204ef7=await staff[_0x3e5515(0xe8)]({'email':_0x5b5f84[_0x3e5515(0x18e)]});}const _0x2d79a3=await master_shop[_0x3e5515(0x13f)]();let _0x5e68c2;if(_0x5b5f84[_0x3e5515(0x170)]==_0x3e5515(0x122)){const _0x4f2f38=await staff[_0x3e5515(0xe8)]({'email':_0x5b5f84[_0x3e5515(0x18e)]});_0x5e68c2=await purchases[_0x3e5515(0xa0)]([{'$match':{'warehouse_name':_0x4f2f38['warehouse']}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x3e5515(0x169),'as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x3e5515(0x158)},{'$group':{'_id':_0x3e5515(0x1a9),'invoice':{'$first':_0x3e5515(0x1a1)},'suppliers':{'$first':_0x3e5515(0xd3)},'date':{'$first':_0x3e5515(0x13a)},'warehouse_name':{'$first':_0x3e5515(0x111)},'room':{'$first':_0x3e5515(0xc2)},'product':{'$push':'$product'},'note':{'$first':_0x3e5515(0x132)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x3e5515(0x19a)},'return_data':{'$first':_0x3e5515(0x18b)},'batch_code':{'$first':_0x3e5515(0x18a)},'expiry_date':{'$first':_0x3e5515(0x14a)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x3e5515(0x96)},'level':{'$addToSet':_0x3e5515(0x12f)},'isle':{'$addToSet':_0x3e5515(0x150)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x3e5515(0x1a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5e68c2=await purchases[_0x3e5515(0xa0)]([{'$lookup':{'from':_0x3e5515(0xf7),'localField':_0x3e5515(0xf7),'foreignField':_0x3e5515(0x169),'as':_0x3e5515(0x14c)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x3e5515(0x1a9),'invoice':{'$first':_0x3e5515(0x1a1)},'suppliers':{'$first':_0x3e5515(0xd3)},'date':{'$first':_0x3e5515(0x13a)},'warehouse_name':{'$first':_0x3e5515(0x111)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x3e5515(0x158)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3e5515(0x190)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3e5515(0x18b)},'batch_code':{'$first':_0x3e5515(0x18a)},'expiry_date':{'$first':_0x3e5515(0x14a)},'suppliers_docs':{'$first':_0x3e5515(0x197)},'total_product_quantity':{'$sum':_0x3e5515(0x96)},'level':{'$addToSet':_0x3e5515(0x12f)},'isle':{'$addToSet':_0x3e5515(0x150)},'type':{'$addToSet':_0x3e5515(0xca)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x3e5515(0x104)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2d79a3[0x0][_0x3e5515(0x192)]=='English\x20(US)'){var _0x2d1de9=users[_0x3e5515(0xa9)];console[_0x3e5515(0x1a3)](_0x2d1de9);}else{if(_0x2d79a3[0x0]['language']=='Hindi')var _0x2d1de9=users[_0x3e5515(0x12b)];else{if(_0x2d79a3[0x0]['language']==_0x3e5515(0x199))var _0x2d1de9=users[_0x3e5515(0x199)];else{if(_0x2d79a3[0x0]['language']=='Spanish')var _0x2d1de9=users[_0x3e5515(0x17e)];else{if(_0x2d79a3[0x0][_0x3e5515(0x192)]==_0x3e5515(0x175))var _0x2d1de9=users[_0x3e5515(0x175)];else{if(_0x2d79a3[0x0][_0x3e5515(0x192)]==_0x3e5515(0x118))var _0x2d1de9=users[_0x3e5515(0x11f)];else{if(_0x2d79a3[0x0]['language']==_0x3e5515(0x9a))var _0x2d1de9=users[_0x3e5515(0x9a)];else{if(_0x2d79a3[0x0]['language']==_0x3e5515(0x14b))var _0x2d1de9=users[_0x3e5515(0x127)];}}}}}}}_0x2420d1['render']('all_purchases',{'success':_0x4d593f[_0x3e5515(0x16a)](_0x3e5515(0x15c)),'errors':_0x4d593f['flash'](_0x3e5515(0x16f)),'purchases':_0x5e68c2,'role':_0x5b5f84,'profile':_0x6ed36,'master_shop':_0x2d79a3,'language':_0x2d1de9});}catch(_0x823a6b){console[_0x3e5515(0x1a3)]('table\x20page',_0x823a6b),_0x2420d1['status'](0xc8)[_0x3e5515(0x1a5)]({'message':_0x823a6b[_0x3e5515(0xa5)]});}});function BayBinSelected(_0x4847b1,_0x3a58c4){var _0x2e7aa0=a0_0x1245f7,_0x310b08=[],_0x5235bb=[],_0x373774=[],_0x458e94=[],_0x267217=[],_0x2dbaeb=[];let _0x51bbd7=[];if(_0x4847b1=='DRY\x20STORAGE')switch(_0x3a58c4){case _0x2e7aa0(0x10c):_0x310b08=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5235bb=[0x1,0x2],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x16b),_0x2e7aa0(0x188)],_0x267217=['D'],_0x2dbaeb=['A'];break;case _0x2e7aa0(0xb1):_0x310b08=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5235bb=[0x1,0x2],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x16b),_0x2e7aa0(0x188)],_0x267217=['D'],_0x2dbaeb=['B'];break;case _0x2e7aa0(0x91):_0x310b08=[0x0],_0x5235bb=[0x0],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x188)],_0x267217=['D'],_0x2dbaeb=['S'];break;case _0x2e7aa0(0xce):_0x310b08=[0x0],_0x5235bb=[0x0],_0x458e94=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x373774=[_0x2e7aa0(0x188)],_0x267217=['D'],_0x2dbaeb=['R'];break;}else{if(_0x4847b1==_0x2e7aa0(0x126))switch(_0x3a58c4){case _0x2e7aa0(0x10c):_0x310b08=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5235bb=['B','F'],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x16b),_0x2e7aa0(0x188)],_0x267217=['C'],_0x2dbaeb=['A'];break;case _0x2e7aa0(0xb1):_0x310b08=[0x5,0x4,0x3,0x2,0x1],_0x5235bb=['F','B','S'],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x16b),_0x2e7aa0(0x188)],_0x267217=['C'],_0x2dbaeb=['B'];break;case _0x2e7aa0(0x130):_0x310b08=[0x1,0x2,0x3,0x4,0x5],_0x5235bb=['B','F','S'],_0x458e94=[0x5,0x4,0x3,0x2,0x1],_0x373774=[_0x2e7aa0(0x16b),'Floor'],_0x267217=['C'],_0x2dbaeb=['C'];break;case'Rack\x20D':_0x310b08=[0x5,0x4,0x3,0x2,0x1],_0x5235bb=['F','B','S'],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x16b),'Floor'],_0x267217=['C'],_0x2dbaeb=['D'];break;case _0x2e7aa0(0x147):_0x310b08=[0x4,0x3,0x2,0x1],_0x5235bb=[0x1,0x2],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=[_0x2e7aa0(0x16b),_0x2e7aa0(0x188)],_0x267217=['C'],_0x2dbaeb=['E'];break;case'Rack\x20F':_0x310b08=[0x1,0x2,0x3],_0x5235bb=[0x1,0x2],_0x458e94=[0x1,0x2,0x3,0x4,0x5],_0x373774=['Level'],_0x267217=['C'],_0x2dbaeb=['F'];break;}}return{'levels':_0x310b08,'Isle':_0x5235bb,'rack':_0x458e94,'type':_0x373774,'storage':_0x267217,'rak':_0x2dbaeb};}function a0_0x5702(_0x45ed51,_0x2235f5){var _0x2f525e=a0_0x2f52();return a0_0x5702=function(_0x570256,_0x41f011){_0x570256=_0x570256-0x8f;var _0x3e8124=_0x2f525e[_0x570256];return _0x3e8124;},a0_0x5702(_0x45ed51,_0x2235f5);}async function getRandom8DigitNumber(){var _0x53b8af=a0_0x1245f7;const _0x37964a=0x989680,_0x293b89=0x5f5e0ff,_0x7ec87f=Math[_0x53b8af(0xef)](Math['random']()*(_0x293b89-_0x37964a+0x1))+_0x37964a;var _0xa6f852;const _0x49e98f=await purchases[_0x53b8af(0xe8)]({'invoice':'INC-'+_0x7ec87f});return _0x49e98f&&_0x49e98f[_0x53b8af(0x196)]>0x0?_0xa6f852=_0x53b8af(0xe0)+_0x7ec87f:_0xa6f852=_0x53b8af(0xe0)+_0x7ec87f,_0xa6f852;}router[a0_0x1245f7(0x11d)](a0_0x1245f7(0x12e),auth,async(_0x48971a,_0x29ee61)=>{var _0x304972=a0_0x1245f7;try{const {username:_0x40a3f2,email:_0x5ed25e,role:_0x4dc47a}=_0x48971a[_0x304972(0x163)],_0x4b65ca=_0x48971a['user'],_0x343bd3=await profile[_0x304972(0xe8)]({'email':_0x4b65ca[_0x304972(0x18e)]}),_0x4572fa=await master_shop[_0x304972(0x13f)](),_0x36e15c=await staff[_0x304972(0xe8)]({'email':_0x4b65ca['email']}),_0x1720f3=await suppliers[_0x304972(0x13f)]({});let _0x4c5fa7;if(_0x4b65ca[_0x304972(0x170)]==_0x304972(0x122)){const _0x288ab7=await staff[_0x304972(0xe8)]({'email':_0x4b65ca['email']});_0x4c5fa7=await warehouse[_0x304972(0xa0)]([{'$match':{'status':_0x304972(0x186),'name':_0x288ab7['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x304972(0x15f)}}},{'$group':{'_id':_0x304972(0x139),'name':{'$first':_0x304972(0x139)}}}]);}else _0x4c5fa7=await warehouse[_0x304972(0xa0)]([{'$match':{'status':'Enabled','warehouse_category':_0x304972(0x125),'name':{'$ne':_0x304972(0x15f)}}},{'$group':{'_id':_0x304972(0x139),'name':{'$first':_0x304972(0x139)}}}]);const _0x46b610=await product['find']({}),_0x1e0218=await warehouse[_0x304972(0x13f)]({'status':_0x304972(0x186)}),_0xc4fad0=await purchases[_0x304972(0x13f)]({}),_0x2e02cc=_0xc4fad0[_0x304972(0x196)]+0x1,_0x1e0c31=_0x304972(0xe0)+_0x2e02cc[_0x304972(0xd1)]()[_0x304972(0xb6)](0x5,'0');var _0x1a69d8=[_0x304972(0x19b),_0x304972(0x95)];if(_0x4572fa[0x0][_0x304972(0x192)]=='English\x20(US)')var _0x1becb5=users[_0x304972(0xa9)];else{if(_0x4572fa[0x0][_0x304972(0x192)]=='Hindi')var _0x1becb5=users[_0x304972(0x12b)];else{if(_0x4572fa[0x0][_0x304972(0x192)]=='German')var _0x1becb5=users['German'];else{if(_0x4572fa[0x0][_0x304972(0x192)]==_0x304972(0x17e))var _0x1becb5=users[_0x304972(0x17e)];else{if(_0x4572fa[0x0]['language']==_0x304972(0x175))var _0x1becb5=users[_0x304972(0x175)];else{if(_0x4572fa[0x0][_0x304972(0x192)]==_0x304972(0x118))var _0x1becb5=users[_0x304972(0x11f)];else{if(_0x4572fa[0x0][_0x304972(0x192)]==_0x304972(0x9a))var _0x1becb5=users[_0x304972(0x9a)];else{if(_0x4572fa[0x0][_0x304972(0x192)]==_0x304972(0x14b))var _0x1becb5=users[_0x304972(0x127)];}}}}}}}const _0x4c214d=getRandom8DigitNumber();_0x4c214d[_0x304972(0x1a0)](_0x3d21b3=>{var _0x4ec5e9=_0x304972;_0x29ee61[_0x4ec5e9(0xeb)](_0x4ec5e9(0xe4),{'success':_0x48971a[_0x4ec5e9(0x16a)](_0x4ec5e9(0x15c)),'errors':_0x48971a[_0x4ec5e9(0x16a)]('errors'),'role':_0x4b65ca,'profile':_0x343bd3,'suppliers':_0x1720f3,'warehouse':_0x4c5fa7,'product':_0x46b610,'invoice':_0x3d21b3,'master_shop':_0x4572fa,'language':_0x1becb5,'find_data':_0x1e0218,'rooms_data':_0x1a69d8});})['catch'](_0x58cf75=>{var _0x202c8e=_0x304972;_0x48971a[_0x202c8e(0x16a)]('errors',_0x202c8e(0x10e)),_0x29ee61[_0x202c8e(0x172)]('/all_purchases/view');});}catch(_0x4de212){console[_0x304972(0x1a3)](_0x4de212);}}),router['get']('/view/add_purchases/:id',auth,async(_0x4efeb8,_0x47620d)=>{var _0x194b45=a0_0x1245f7;try{const _0x61c17e=_0x4efeb8[_0x194b45(0x134)]['id'];console[_0x194b45(0x1a3)](_0x61c17e);const _0x2a2149=await master_shop[_0x194b45(0x13f)]();console[_0x194b45(0x1a3)](_0x194b45(0x14d),_0x2a2149);const _0x30a573=await product[_0x194b45(0xe8)]({'name':_0x61c17e});console[_0x194b45(0x1a3)](_0x194b45(0xc7),_0x30a573),_0x47620d['status'](0xc8)[_0x194b45(0x1a5)]({'product_data':_0x30a573,'master':_0x2a2149});}catch(_0x3517a0){console[_0x194b45(0x1a3)]('add_purchases\x20error',_0x3517a0);}}),router['post'](a0_0x1245f7(0x12e),auth,async(_0x32b13e,_0x251477)=>{var _0x48e5a9=a0_0x1245f7;try{const {invoice:_0x31915,date:_0xe4a8da,warehouse_name:_0x26cfae,prod_name:_0x5059e7,prod_code:_0x49a28a,prod_qty:_0x3d0d62,prod_unit:_0x56a709,prod_secondunit:_0x5e242c,prod_level:_0x1e9f29,prod_isle:_0x116cb0,prod_pallet:_0x2dcf23,note:_0x180bd7,expiry_date:_0x179354,batch_code:_0x4bb470,payable:_0x4520b2,due_amount:_0x4e8551,Room_name:_0x348f08,primary_code:_0x329033,secondary_code:_0x29e149,MaxStocks_data:_0x435753,PO_number:_0x2dbb4d,SCRN:_0x423d4e,JO_number:_0x2fdfc6}=_0x32b13e[_0x48e5a9(0xff)];if(typeof _0x5059e7==_0x48e5a9(0xcf))var _0x4954b3=[_0x32b13e['body'][_0x48e5a9(0x156)]],_0x4d8c0e=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xa8)]],_0x49fd3a=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x90)]],_0x4d5255=[_0x32b13e['body'][_0x48e5a9(0x92)]],_0x7286c2=[_0x32b13e[_0x48e5a9(0xff)]['prod_secondunit']],_0x54b8bb=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xa2)]],_0x3996dd=[_0x32b13e['body'][_0x48e5a9(0xbd)]],_0x97b25f=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xfa)]],_0x32fcda=[_0x32b13e['body'][_0x48e5a9(0xd6)]],_0x257871=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xd4)]],_0x5f327c=[_0x32b13e['body']['expiry_date']],_0x80f528=[_0x32b13e[_0x48e5a9(0xff)]['max_product_unit']],_0x3c36bd=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x15b)]],_0x5140f6=[_0x32b13e[_0x48e5a9(0xff)]['production_date']],_0x2c869b=[_0x32b13e['body'][_0x48e5a9(0x99)]],_0x120acd=[_0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x10f)]],_0x52693a=[_0x32b13e['body'][_0x48e5a9(0x142)]],_0x5591c2=[_0x32b13e['body']['prod_invoice']],_0x23d158=[_0x32b13e[_0x48e5a9(0xff)]['actual_qty']],_0x135d39=[_0x32b13e[_0x48e5a9(0xff)]['actual_uom']];else var _0x4954b3=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x156)]],_0x4d8c0e=[..._0x32b13e['body'][_0x48e5a9(0xa8)]],_0x49fd3a=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x90)]],_0x4d5255=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x92)]],_0x7286c2=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x193)]],_0x54b8bb=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xa2)]],_0x3996dd=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xbd)]],_0x97b25f=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xfa)]],_0x32fcda=[..._0x32b13e['body'][_0x48e5a9(0xd6)]],_0x257871=[..._0x32b13e[_0x48e5a9(0xff)]['batch_code']],_0x5f327c=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x115)]],_0x80f528=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x1ac)]],_0x3c36bd=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x15b)]],_0x5140f6=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xcd)]],_0x2c869b=[..._0x32b13e['body'][_0x48e5a9(0x99)]],_0x120acd=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x10f)]],_0x52693a=[..._0x32b13e[_0x48e5a9(0xff)]['deliverycode']],_0x5591c2=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0x9e)]],_0x23d158=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xe9)]],_0x135d39=[..._0x32b13e[_0x48e5a9(0xff)][_0x48e5a9(0xda)]];const _0x2387be=_0x4954b3[_0x48e5a9(0xba)](_0x42aabe=>{return _0x42aabe={'product_name':_0x42aabe};});_0x23d158[_0x48e5a9(0x10a)]((_0x580f24,_0xbbc799)=>{var _0x372051=_0x48e5a9;_0x2387be[_0xbbc799][_0x372051(0xe9)]=Math[_0x372051(0x185)](_0x580f24);}),_0x135d39[_0x48e5a9(0x10a)]((_0x3f9c7f,_0x3d19b1)=>{var _0x53d418=_0x48e5a9;_0x2387be[_0x3d19b1][_0x53d418(0xda)]=_0x3f9c7f;}),_0x4d8c0e[_0x48e5a9(0x10a)]((_0x49e378,_0x5de6d5)=>{_0x2387be[_0x5de6d5]['product_code']=_0x49e378;}),_0x49fd3a[_0x48e5a9(0x10a)]((_0x142832,_0xfed63)=>{var _0x4257c5=_0x48e5a9;_0x2387be[_0xfed63][_0x4257c5(0xc8)]=Math[_0x4257c5(0x185)](_0x142832);}),_0x4d5255['forEach']((_0x326875,_0x230f3f)=>{var _0x20288e=_0x48e5a9;_0x2387be[_0x230f3f][_0x20288e(0x116)]=_0x326875;}),_0x7286c2[_0x48e5a9(0x10a)]((_0x24bb82,_0x387113)=>{var _0x28e229=_0x48e5a9;_0x2387be[_0x387113][_0x28e229(0x194)]=_0x24bb82;}),_0x54b8bb[_0x48e5a9(0x10a)]((_0x1971eb,_0x1f18e1)=>{var _0x1e46eb=_0x48e5a9;_0x120acd[_0x1e46eb(0x10a)]((_0x5a5e87,_0x5e2c95)=>{var _0x3a3ccb=_0x1e46eb;if(_0x5a5e87==_0x3a3ccb(0xce)&&_0x1f18e1==_0x5e2c95){console[_0x3a3ccb(0x1a3)](_0x5a5e87+_0x3a3ccb(0x174)+_0x1f18e1+_0x3a3ccb(0xec)+_0x5e2c95+_0x3a3ccb(0xec)+_0x1971eb);var _0x2b92c2=_0x1971eb[_0x3a3ccb(0xf3)](0x3);_0x2387be[_0x1f18e1][_0x3a3ccb(0x128)]=_0x1971eb[0x0],_0x2387be[_0x1f18e1][_0x3a3ccb(0x14e)]=_0x1971eb[0x1],_0x2387be[_0x1f18e1]['bay']=0x0,_0x2387be[_0x1f18e1]['bin']=0x0,_0x2387be[_0x1f18e1][_0x3a3ccb(0xc4)]=_0x3a3ccb(0x188),_0x2387be[_0x1f18e1][_0x3a3ccb(0x12c)]=_0x2b92c2;}else{if(_0x5a5e87==_0x3a3ccb(0x91)&&_0x1f18e1==_0x5e2c95){var _0x2b92c2=_0x1971eb[_0x3a3ccb(0xf3)](0x3);_0x2387be[_0x1f18e1][_0x3a3ccb(0x128)]=_0x1971eb[0x0],_0x2387be[_0x1f18e1][_0x3a3ccb(0x14e)]=_0x1971eb[0x1],_0x2387be[_0x1f18e1][_0x3a3ccb(0x145)]=0x0,_0x2387be[_0x1f18e1]['bin']=0x0,_0x2387be[_0x1f18e1][_0x3a3ccb(0xc4)]='Floor',_0x2387be[_0x1f18e1][_0x3a3ccb(0x12c)]=_0x1971eb[0x5];}else{if(_0x1f18e1==_0x5e2c95){if(_0x1971eb[0x0]=='A'&&_0x1971eb[0x1]=='L'&&_0x1971eb[0x2]=='L')console['log'](_0x5a5e87+'\x20<>\x20'+_0x1f18e1+_0x3a3ccb(0xec)+_0x5e2c95+'\x20<>\x20'+_0x1971eb+_0x3a3ccb(0x154)),_0x2387be[_0x1f18e1][_0x3a3ccb(0x128)]=_0x1971eb[0x0],_0x2387be[_0x1f18e1][_0x3a3ccb(0x14e)]=_0x1971eb[0x1],_0x2387be[_0x1f18e1][_0x3a3ccb(0x145)]=0x0,_0x2387be[_0x1f18e1][_0x3a3ccb(0x12a)]=0x0,_0x2387be[_0x1f18e1][_0x3a3ccb(0xc4)]=_0x3a3ccb(0x188),_0x2387be[_0x1f18e1]['floorlevel']=_0x1971eb[0x3];else{var _0x520332;if(_0x1971eb[0x4]=='L')_0x520332=_0x3a3ccb(0x16b);else _0x1971eb[0x4]=='F'&&(_0x520332=_0x3a3ccb(0x188));_0x2387be[_0x1f18e1]['storage']=_0x1971eb[0x0],_0x2387be[_0x1f18e1][_0x3a3ccb(0x14e)]=_0x1971eb[0x1],_0x2387be[_0x1f18e1][_0x3a3ccb(0x145)]=_0x1971eb[0x2],_0x2387be[_0x1f18e1]['bin']=_0x1971eb[0x3],_0x2387be[_0x1f18e1][_0x3a3ccb(0xc4)]=_0x520332,_0x2387be[_0x1f18e1][_0x3a3ccb(0x12c)]=_0x1971eb[0x5];}}}}});}),_0x3996dd[_0x48e5a9(0x10a)]((_0x4e6d0b,_0x396b93)=>{_0x2387be[_0x396b93]['primary_code']=_0x4e6d0b;}),_0x97b25f['forEach']((_0x26f70d,_0x12743c)=>{_0x2387be[_0x12743c]['secondary_code']=_0x26f70d;}),_0x32fcda['forEach']((_0x223451,_0x52015a)=>{_0x2387be[_0x52015a]['maxStocks']=_0x223451;}),_0x257871[_0x48e5a9(0x10a)]((_0x5e0de8,_0x3ec574)=>{var _0x591b0a=_0x48e5a9;_0x2387be[_0x3ec574][_0x591b0a(0xd4)]=_0x5e0de8;}),_0x5f327c[_0x48e5a9(0x10a)]((_0x32dea8,_0x3fb53d)=>{_0x2387be[_0x3fb53d]['expiry_date']=_0x32dea8;}),_0x80f528[_0x48e5a9(0x10a)]((_0x301d26,_0x510c22)=>{var _0x3f081b=_0x48e5a9;_0x2387be[_0x510c22][_0x3f081b(0x149)]=_0x301d26;}),_0x3c36bd[_0x48e5a9(0x10a)]((_0xd6a7a6,_0x1fa4bc)=>{var _0x1683a7=_0x48e5a9;_0x2387be[_0x1fa4bc][_0x1683a7(0x15b)]=_0xd6a7a6;}),_0x5140f6[_0x48e5a9(0x10a)]((_0xdddda,_0x36db93)=>{var _0x7c7f1=_0x48e5a9;_0x2387be[_0x36db93][_0x7c7f1(0xcd)]=_0xdddda;}),_0x2c869b[_0x48e5a9(0x10a)]((_0x4e8bef,_0x218ece)=>{var _0x57dc09=_0x48e5a9;_0x2387be[_0x218ece][_0x57dc09(0xfd)]=_0x4e8bef;}),_0x120acd[_0x48e5a9(0x10a)]((_0x22ea48,_0x4cf2e6)=>{var _0x3abc8b=_0x48e5a9;_0x2387be[_0x4cf2e6][_0x3abc8b(0xb9)]=_0x22ea48;}),_0x52693a[_0x48e5a9(0x10a)]((_0x2d73bd,_0x353b43)=>{var _0x1d353b=_0x48e5a9;_0x2387be[_0x353b43][_0x1d353b(0xb2)]=_0x2d73bd;}),_0x5591c2[_0x48e5a9(0x10a)]((_0x1a02e2,_0x1a078e)=>{_0x2387be[_0x1a078e]['invoice']=_0x1a02e2;});const _0x33bb13=_0x120acd[_0x48e5a9(0xba)](_0x549ab4=>{return _0x549ab4={'room_name':_0x549ab4};}),_0x270db5=_0x2387be[_0x48e5a9(0xf0)](_0x593f1d=>_0x593f1d['quantity']!=='0'&&_0x593f1d[_0x48e5a9(0xc8)]!==''),_0xe84661=new purchases({'invoice':_0x31915,'suppliers':_0x32b13e['body'][_0x48e5a9(0xf7)],'date':_0xe4a8da,'warehouse_name':_0x26cfae,'product':_0x270db5,'note':_0x180bd7,'due_amount':_0x4e8551,'POnumber':_0x2dbb4d,'SCRN':_0x423d4e,'JO_number':_0x2fdfc6,'roomList':_0x33bb13}),_0x41fcc2=await _0xe84661['save'](),_0x275fe1=await purchases[_0x48e5a9(0xe8)]({'invoice':_0x31915}),_0x3de918=_0x275fe1[_0x48e5a9(0xc7)][_0x48e5a9(0xba)](async _0x5be714=>{var _0x304b66=_0x48e5a9,_0x45b3a5=await warehouse[_0x304b66(0xe8)]({'name':_0x26cfae,'room':_0x5be714['room_name']}),_0x270ed0=0x0;return _0x45b3a5[_0x304b66(0xa1)][_0x304b66(0x10a)](_0x44521b=>{var _0x39cd27=_0x304b66;_0x44521b['product_name']==_0x5be714[_0x39cd27(0x17f)]&&_0x44521b[_0x39cd27(0x12c)]==_0x5be714[_0x39cd27(0x12c)]&&_0x44521b['type']==_0x5be714[_0x39cd27(0xc4)]&&_0x44521b['bin']==_0x5be714['bin']&&_0x44521b[_0x39cd27(0x145)]==_0x5be714[_0x39cd27(0x145)]&&_0x44521b[_0x39cd27(0x14e)]==_0x5be714[_0x39cd27(0x14e)]&&_0x44521b[_0x39cd27(0x128)]==_0x5be714['storage']&&_0x44521b[_0x39cd27(0x115)]==_0x5be714[_0x39cd27(0x115)]&&_0x44521b[_0x39cd27(0xd4)]==_0x5be714[_0x39cd27(0xd4)]&&_0x44521b['production_date']==_0x5be714['production_date']&&_0x44521b[_0x39cd27(0x1a7)]==_0x275fe1[_0x39cd27(0x1a7)]&&(_0x44521b[_0x39cd27(0x13b)]+=Math['abs'](_0x5be714[_0x39cd27(0xc8)]),_0x270ed0++);}),_0x270ed0===0x0&&_0x45b3a5['product_details']['push']({'product_name':_0x5be714[_0x304b66(0x17f)],'product_stock':Math[_0x304b66(0x185)](_0x5be714[_0x304b66(0xc8)]),'primary_code':_0x5be714[_0x304b66(0xbd)],'secondary_code':_0x5be714[_0x304b66(0xfa)],'product_code':_0x5be714[_0x304b66(0x189)],'storage':_0x5be714[_0x304b66(0x128)],'rack':_0x5be714['rack'],'bay':_0x5be714[_0x304b66(0x145)],'bin':_0x5be714['bin'],'type':_0x5be714[_0x304b66(0xc4)],'floorlevel':_0x5be714[_0x304b66(0x12c)],'maxProducts':_0x5be714[_0x304b66(0x15a)],'unit':_0x5be714[_0x304b66(0x116)],'secondary_unit':_0x5be714[_0x304b66(0x194)],'expiry_date':_0x5be714[_0x304b66(0x115)],'maxPerUnit':_0x5be714[_0x304b66(0x149)],'batch_code':_0x5be714[_0x304b66(0xd4)],'alertQTY':_0x5be714[_0x304b66(0x15b)],'production_date':_0x5be714[_0x304b66(0xcd)],'product_cat':_0x5be714[_0x304b66(0xfd)],'invoice':_0x5be714[_0x304b66(0x1a7)],'actual_qty':Math['abs'](_0x5be714[_0x304b66(0xe9)]),'actual_uom':_0x5be714[_0x304b66(0xda)]}),_0x45b3a5;});Promise['all'](_0x3de918)[_0x48e5a9(0x1a0)](async _0x41913f=>{var _0x416caa=_0x48e5a9;try{for(const _0x319e70 of _0x41913f){await _0x319e70[_0x416caa(0x198)]();}const _0x554a51=await master_shop[_0x416caa(0x13f)](),_0x3072b1=await email_settings[_0x416caa(0xe8)](),_0x1b2fd4=await supervisor_settings[_0x416caa(0x13f)]();var _0x3779b8=_0x275fe1[_0x416caa(0xc7)],_0x36f5cd='',_0x205b20;for(_0x205b20 in _0x3779b8){_0x36f5cd+=_0x416caa(0xc5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3779b8[_0x205b20]['product_name']+_0x416caa(0xd5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3779b8[_0x205b20]['product_code']+_0x416caa(0xd5)+_0x416caa(0xd8)+_0x3779b8[_0x205b20][_0x416caa(0xc8)]+_0x416caa(0xd5)+_0x416caa(0xd8)+_0x3779b8[_0x205b20]['standard_unit']+'</td>'+_0x416caa(0xd8)+_0x3779b8[_0x205b20]['secondary_unit']+_0x416caa(0xd5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x275fe1['warehouse_name']+_0x416caa(0xd5)+_0x416caa(0xd8)+_0x3779b8[_0x205b20][_0x416caa(0xb9)]+_0x416caa(0xd5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3779b8[_0x205b20][_0x416caa(0x128)]+_0x3779b8[_0x205b20][_0x416caa(0x14e)]+_0x3779b8[_0x205b20][_0x416caa(0x145)]+_0x3779b8[_0x205b20]['bin']+_0x3779b8[_0x205b20]['type'][0x0]+_0x3779b8[_0x205b20][_0x416caa(0x12c)]+_0x416caa(0xd5),_0x416caa(0xf6);}let _0x1fd3ea=nodemailer[_0x416caa(0x13d)]({'host':_0x3072b1[_0x416caa(0x18d)],'port':Number(_0x3072b1[_0x416caa(0x13e)]),'secure':![],'auth':{'user':_0x3072b1[_0x416caa(0x18e)],'pass':_0x3072b1[_0x416caa(0xab)]}}),_0x25a1cd={'from':_0x3072b1[_0x416caa(0x18e)],'to':_0x1b2fd4[0x0][_0x416caa(0x157)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x416caa(0xf9),'path':__dirname+_0x416caa(0xde)+'/upload/'+_0x554a51[0x0][_0x416caa(0x131)],'cid':_0x416caa(0x114)}],'html':'<!DOCTYPE\x20html>'+_0x416caa(0x1ab)+_0x416caa(0xcb)+_0x416caa(0xe7)+_0x416caa(0x1a2)+'<div>'+_0x416caa(0x102)+_0x416caa(0x15e)+_0x416caa(0xe7)+_0x416caa(0x167)+_0x554a51[0x0][_0x416caa(0x98)]+_0x416caa(0x1a8)+'</div>'+_0x416caa(0x15e)+_0x416caa(0x160)+_0x416caa(0xe7)+_0x416caa(0x124)+_0x416caa(0xa7)+_0x275fe1[_0x416caa(0x1a7)]+'\x20'+_0x416caa(0x164)+_0x416caa(0x1a4)+_0x275fe1[_0x416caa(0x140)]+'\x20'+'</span>'+'</h5>'+_0x416caa(0x15e)+_0x416caa(0xe1)+_0x416caa(0x151)+'<tr>'+_0x416caa(0xea)+_0x416caa(0x10b)+_0x416caa(0xb4)+_0x416caa(0x109)+_0x416caa(0xe2)+_0x416caa(0xd9)+_0x416caa(0x10d)+_0x416caa(0xcc)+'</tr>'+_0x416caa(0x183)+_0x416caa(0xa4)+'\x20'+_0x36f5cd+'\x20'+_0x416caa(0xf2)+_0x416caa(0x105)+_0x416caa(0xe7)+_0x416caa(0xdd)+_0x416caa(0x121)+_0x554a51[0x0][_0x416caa(0x98)]+_0x416caa(0x101)+_0x416caa(0x15e)+_0x416caa(0x15e)+_0x416caa(0x162)};_0x1fd3ea['sendMail'](_0x25a1cd,function(_0x205622,_0x5b1ec8){var _0x6cb89b=_0x416caa;_0x205622?(console[_0x6cb89b(0x1a3)](_0x205622),console['log'](_0x6cb89b(0x15d))):console[_0x6cb89b(0x1a3)](_0x6cb89b(0x173));}),_0x32b13e[_0x416caa(0x16a)](_0x416caa(0x15c),_0x416caa(0x178)),_0x251477[_0x416caa(0x172)](_0x416caa(0x120));}catch(_0x53bceb){console[_0x416caa(0x123)](_0x53bceb),_0x251477[_0x416caa(0xbb)](0x1f4)[_0x416caa(0x1a5)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x48e5a9(0x159)](_0x19588e=>{var _0x5567cd=_0x48e5a9;console[_0x5567cd(0x123)](_0x19588e),_0x251477[_0x5567cd(0xbb)](0x1f4)[_0x5567cd(0x1a5)]({'error':_0x5567cd(0xee)});});}catch(_0x663698){console[_0x48e5a9(0x1a3)](_0x663698);}}),router[a0_0x1245f7(0x11d)](a0_0x1245f7(0xaf),auth,async(_0x541686,_0x40e5c7)=>{var _0x5b15f1=a0_0x1245f7;try{const {username:_0x48206a,email:_0x24f768,role:_0x45d05b}=_0x541686[_0x5b15f1(0x163)],_0x376b5b=_0x541686[_0x5b15f1(0x163)],_0x5144dd=await profile[_0x5b15f1(0xe8)]({'email':_0x376b5b[_0x5b15f1(0x18e)]}),_0x13fbe0=await master_shop[_0x5b15f1(0x13f)](),_0x464f59=_0x541686[_0x5b15f1(0x134)]['id'],_0x2b1274=await purchases[_0x5b15f1(0xd2)](_0x464f59),_0x268818=await warehouse[_0x5b15f1(0xa0)]([{'$match':{'name':_0x2b1274[_0x5b15f1(0xc3)],'room':_0x2b1274[_0x5b15f1(0xb3)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5b15f1(0xbc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5b15f1(0xfc)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5b15f1(0x13c)},'type':{'$first':_0x5b15f1(0x135)},'floorlevel':{'$first':_0x5b15f1(0x171)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5b15f1(0x11c)},'product_code':{'$first':_0x5b15f1(0xdc)},'storage':{'$first':_0x5b15f1(0x18c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5b15f1(0x176)}}}]),_0x1b41cb=await customer['find']({});let _0x309445;if(_0x376b5b[_0x5b15f1(0x170)]=='staff'){const _0x10ce91=await staff[_0x5b15f1(0xe8)]({'email':_0x376b5b['email']});_0x309445=await warehouse[_0x5b15f1(0xa0)]([{'$match':{'status':_0x5b15f1(0x186),'name':_0x10ce91[_0x5b15f1(0x191)]}},{'$group':{'_id':_0x5b15f1(0x139),'name':{'$first':_0x5b15f1(0x139)}}}]);}else _0x309445=await warehouse[_0x5b15f1(0xa0)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x5b15f1(0x139),'name':{'$first':'$name'}}}]);const _0x2b6213=await product[_0x5b15f1(0x13f)]({}),_0x39c671=await suppliers[_0x5b15f1(0x13f)]({}),_0x2d7741=BayBinSelected(_0x2b1274[_0x5b15f1(0xc3)],_0x2b1274[_0x5b15f1(0xb3)]);if(_0x13fbe0[0x0][_0x5b15f1(0x192)]==_0x5b15f1(0x179)){var _0x5cb099=users['English'];console['log'](_0x5cb099);}else{if(_0x13fbe0[0x0][_0x5b15f1(0x192)]==_0x5b15f1(0x12b))var _0x5cb099=users[_0x5b15f1(0x12b)];else{if(_0x13fbe0[0x0][_0x5b15f1(0x192)]=='German')var _0x5cb099=users[_0x5b15f1(0x199)];else{if(_0x13fbe0[0x0][_0x5b15f1(0x192)]=='Spanish')var _0x5cb099=users[_0x5b15f1(0x17e)];else{if(_0x13fbe0[0x0]['language']=='French')var _0x5cb099=users[_0x5b15f1(0x175)];else{if(_0x13fbe0[0x0][_0x5b15f1(0x192)]==_0x5b15f1(0x118))var _0x5cb099=users[_0x5b15f1(0x11f)];else{if(_0x13fbe0[0x0][_0x5b15f1(0x192)]==_0x5b15f1(0x9a))var _0x5cb099=users['Chinese'];else{if(_0x13fbe0[0x0][_0x5b15f1(0x192)]==_0x5b15f1(0x14b))var _0x5cb099=users['Arabic'];}}}}}}}_0x40e5c7[_0x5b15f1(0xeb)](_0x5b15f1(0xfe),{'success':_0x541686['flash']('success'),'errors':_0x541686[_0x5b15f1(0x16a)](_0x5b15f1(0x16f)),'role':_0x376b5b,'profile':_0x5144dd,'customer':_0x1b41cb,'warehouse':_0x309445,'product':_0x268818,'user':_0x2b1274,'master_shop':_0x13fbe0,'unit':_0x2b6213,'language':_0x5cb099,'suppliers':_0x39c671,'dataSelected':_0x2d7741});}catch(_0x54586c){console[_0x5b15f1(0x1a3)](_0x54586c);}}),router[a0_0x1245f7(0x19e)]('/preview/:id',auth,async(_0x18b36e,_0x21838b)=>{var _0x4256d9=a0_0x1245f7;try{const _0x5c77d5=_0x18b36e[_0x4256d9(0x134)]['id'],{invoice:_0x2a35d5,warehouse_name:_0x76692c,Room_name:_0x507d87}=_0x18b36e[_0x4256d9(0xff)],_0x596ed9=await warehouse[_0x4256d9(0xe8)]({'name':_0x76692c,'room':_0x507d87}),_0x28856e=await purchases['findOne']({'invoice':_0x2a35d5});_0x28856e[_0x4256d9(0xc7)]['forEach'](_0x34ca77=>{var _0x5b5745=_0x4256d9,_0x4db00d=0x0;const _0x42a34f=_0x596ed9[_0x5b5745(0xa1)]['map'](_0x5b09e5=>{var _0x4387d4=_0x5b5745;_0x5b09e5['product_name']==_0x34ca77[_0x4387d4(0x17f)]&&_0x5b09e5[_0x4387d4(0x12c)]==_0x34ca77[_0x4387d4(0x12c)]&&_0x5b09e5[_0x4387d4(0xc4)]==_0x34ca77[_0x4387d4(0xc4)]&&_0x5b09e5[_0x4387d4(0x12a)]==_0x34ca77[_0x4387d4(0x12a)]&&_0x5b09e5[_0x4387d4(0x145)]==_0x34ca77[_0x4387d4(0x145)]&&_0x5b09e5[_0x4387d4(0x14e)]==_0x34ca77[_0x4387d4(0x14e)]&&_0x5b09e5[_0x4387d4(0x128)]==_0x34ca77['storage']&&_0x5b09e5[_0x4387d4(0x115)]==_0x34ca77[_0x4387d4(0x115)]&&_0x5b09e5[_0x4387d4(0xd4)]==_0x34ca77[_0x4387d4(0xd4)]&&_0x5b09e5[_0x4387d4(0xcd)]==_0x34ca77['production_date']&&_0x5b09e5['delivery_date']==_0x34ca77['delivery_date']&&_0x5b09e5[_0x4387d4(0xb2)]==_0x34ca77[_0x4387d4(0xb2)]&&(_0x5b09e5['product_stock']=parseInt(_0x5b09e5[_0x4387d4(0x13b)])+parseInt(_0x34ca77[_0x4387d4(0xc8)]),_0x4db00d++);});_0x4db00d=='0'&&(_0x596ed9[_0x5b5745(0xa1)]=_0x596ed9[_0x5b5745(0xa1)][_0x5b5745(0x9c)]({'product_name':_0x34ca77[_0x5b5745(0x17f)],'product_stock':_0x34ca77['quantity'],'primary_code':_0x34ca77['primary_code'],'secondary_code':_0x34ca77['secondary_code'],'product_code':_0x34ca77[_0x5b5745(0x189)],'storage':_0x34ca77[_0x5b5745(0x128)],'rack':_0x34ca77['rack'],'bay':_0x34ca77['bay'],'bin':_0x34ca77[_0x5b5745(0x12a)],'type':_0x34ca77[_0x5b5745(0xc4)],'floorlevel':_0x34ca77[_0x5b5745(0x12c)],'maxProducts':_0x34ca77[_0x5b5745(0x15a)],'unit':_0x34ca77['standard_unit'],'secondary_unit':_0x34ca77[_0x5b5745(0x194)],'expiry_date':_0x34ca77[_0x5b5745(0x115)],'maxPerUnit':_0x34ca77[_0x5b5745(0x149)],'batch_code':_0x34ca77[_0x5b5745(0xd4)],'alertQTY':_0x34ca77[_0x5b5745(0x15b)],'production_date':_0x34ca77[_0x5b5745(0xcd)],'delivery_date':_0x34ca77['delivery_date'],'delivery_code':_0x34ca77[_0x5b5745(0xb2)]}));}),await _0x596ed9[_0x4256d9(0x198)](),_0x28856e['finalize']=_0x4256d9(0x113);const _0x2602a7=await _0x28856e[_0x4256d9(0x198)]();_0x18b36e['flash'](_0x4256d9(0x15c),_0x4256d9(0x152)),_0x21838b[_0x4256d9(0x172)](_0x4256d9(0xaa));}catch(_0x514c0a){console[_0x4256d9(0x1a3)](_0x514c0a);}}),router[a0_0x1245f7(0x11d)](a0_0x1245f7(0x182),auth,async(_0x348f86,_0x469e2a)=>{var _0x1001a0=a0_0x1245f7;try{const {username:_0x260f6f,email:_0x32cc0e,role:_0x46a60f}=_0x348f86[_0x1001a0(0x163)],_0x49720c=_0x348f86[_0x1001a0(0x163)],_0x33cc0d=await profile['findOne']({'email':_0x49720c[_0x1001a0(0x18e)]}),_0x3d9f09=await master_shop['find'](),_0xe0a4=_0x348f86[_0x1001a0(0x134)]['id'],_0x3310aa=await purchases[_0x1001a0(0xd2)](_0xe0a4),_0x37fdef=await suppliers[_0x1001a0(0x13f)]({});let _0x5cf5c3;if(_0x49720c[_0x1001a0(0x170)]==_0x1001a0(0x122)){const _0x24b738=await staff[_0x1001a0(0xe8)]({'email':_0x49720c['email']});_0x5cf5c3=await warehouse[_0x1001a0(0x13f)]({'status':_0x1001a0(0x186),'name':_0x24b738['warehouse'],'warehouse_category':_0x1001a0(0x125)});}else _0x5cf5c3=await warehouse[_0x1001a0(0xa0)]([{'$match':{'status':_0x1001a0(0x186),'warehouse_category':_0x1001a0(0x125)}},{'$group':{'_id':_0x1001a0(0x139),'name':{'$first':_0x1001a0(0x139)}}}]);const _0x2c042c=await product[_0x1001a0(0x13f)]({}),_0x9267f4=BayBinSelected(_0x3310aa[_0x1001a0(0xc3)],_0x3310aa['room']);let _0x487752=new Date(_0x3310aa[_0x1001a0(0x115)]),_0xe9903c=('0'+_0x487752[_0x1001a0(0x16e)]())[_0x1001a0(0xf3)](-0x2),_0x39eefd=('0'+(_0x487752[_0x1001a0(0x108)]()+0x1))[_0x1001a0(0xf3)](-0x2),_0x48be99=_0x487752[_0x1001a0(0x16d)](),_0x1991fa=_0x48be99+'-'+_0x39eefd+'-'+_0xe9903c;if(_0x3d9f09[0x0][_0x1001a0(0x192)]==_0x1001a0(0x179)){var _0x61589e=users[_0x1001a0(0xa9)];console[_0x1001a0(0x1a3)](_0x61589e);}else{if(_0x3d9f09[0x0]['language']==_0x1001a0(0x12b))var _0x61589e=users['Hindi'];else{if(_0x3d9f09[0x0]['language']==_0x1001a0(0x199))var _0x61589e=users[_0x1001a0(0x199)];else{if(_0x3d9f09[0x0]['language']==_0x1001a0(0x17e))var _0x61589e=users[_0x1001a0(0x17e)];else{if(_0x3d9f09[0x0][_0x1001a0(0x192)]==_0x1001a0(0x175))var _0x61589e=users[_0x1001a0(0x175)];else{if(_0x3d9f09[0x0][_0x1001a0(0x192)]=='Portuguese\x20(BR)')var _0x61589e=users[_0x1001a0(0x11f)];else{if(_0x3d9f09[0x0][_0x1001a0(0x192)]==_0x1001a0(0x9a))var _0x61589e=users[_0x1001a0(0x9a)];else{if(_0x3d9f09[0x0][_0x1001a0(0x192)]==_0x1001a0(0x14b))var _0x61589e=users[_0x1001a0(0x127)];}}}}}}}_0x469e2a[_0x1001a0(0xeb)](_0x1001a0(0x17c),{'success':_0x348f86[_0x1001a0(0x16a)]('success'),'errors':_0x348f86[_0x1001a0(0x16a)](_0x1001a0(0x16f)),'role':_0x49720c,'profile':_0x33cc0d,'purchases':_0x3310aa,'suppliers':_0x37fdef,'warehouse':_0x5cf5c3,'product':_0x2c042c,'master_shop':_0x3d9f09,'language':_0x61589e,'ed_fullDate':_0x1991fa,'dataSelected':_0x9267f4});}catch(_0x4f94eb){console[_0x1001a0(0x1a3)](_0x4f94eb);}}),router['post']('/view/:id',auth,async(_0x2015a6,_0x3a1e40)=>{var _0x3a58fc=a0_0x1245f7;try{const _0x1481ee=_0x2015a6[_0x3a58fc(0x134)]['id'],_0x5502e9=await purchases[_0x3a58fc(0xe8)]({'_id':_0x2015a6['params']['id']}),_0xab5b03=await warehouse[_0x3a58fc(0xe8)]({'name':_0x5502e9['warehouse_name'],'room':_0x5502e9[_0x3a58fc(0xb3)]});_0x5502e9[_0x3a58fc(0xc7)][_0x3a58fc(0x10a)](_0x4c70e8=>{var _0x1152bd=_0x3a58fc;const _0x267454=_0xab5b03[_0x1152bd(0xa1)][_0x1152bd(0xba)](_0x1b574d=>{var _0x2f67d1=_0x1152bd;_0x1b574d[_0x2f67d1(0x17f)]==_0x4c70e8['product_name']&&_0x1b574d[_0x2f67d1(0x12c)]==_0x4c70e8['floorlevel']&&_0x1b574d['type']==_0x4c70e8[_0x2f67d1(0xc4)]&&_0x1b574d[_0x2f67d1(0x12a)]==_0x4c70e8[_0x2f67d1(0x12a)]&&_0x1b574d['bay']==_0x4c70e8[_0x2f67d1(0x145)]&&_0x1b574d['rack']==_0x4c70e8[_0x2f67d1(0x14e)]&&_0x1b574d[_0x2f67d1(0x128)]==_0x4c70e8['storage']&&(_0x1b574d['product_stock']=parseInt(_0x1b574d[_0x2f67d1(0x13b)])-parseInt(_0x4c70e8[_0x2f67d1(0xc8)]));});}),await _0xab5b03['save']();const {invoice:_0x1fad47,suppliers:_0x5b1400,date:_0x46681e,warehouse_name:_0x45d886,prod_name:_0x1ca4f0,prod_code:_0x1bae2a,prod_qty:_0x3f000d,prod_unit:_0xc960cd,prod_secondunit:_0x54d0e2,prod_level:_0x41efe4,prod_isle:_0x3c5225,prod_pallet:_0x26e6d4,note:_0x14d362,expiry_date:_0x409f64,batch_code:_0x274821,paid_amount:_0x1e384f,due_amount:_0x39d58a,Room_name:_0x4ac9ce,primary_code:_0x67185,secondary_code:_0x50cfed,PO_number:_0x4d5597,JO_number:_0x18a442}=_0x2015a6[_0x3a58fc(0xff)];if(typeof _0x1ca4f0==_0x3a58fc(0xcf))var _0x5cb80a=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x156)]],_0x2d245c=[_0x2015a6[_0x3a58fc(0xff)]['prod_code']],_0x268640=[_0x2015a6['body']['prod_qty']],_0x3f9e98=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x137)]],_0x2e7c34=[_0x2015a6['body'][_0x3a58fc(0x193)]],_0x21db41=[_0x2015a6[_0x3a58fc(0xff)]['prod_level']],_0x5f5dcd=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xa6)]],_0x3d1aa3=[_0x2015a6[_0x3a58fc(0xff)]['prod_pallet']],_0x4f69ed=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xbd)]],_0x12f389=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xfa)]],_0x2ddb7d=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xd6)]],_0x56a8ba=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xd4)]],_0x5e37fe=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x115)]],_0x2ab0bd=[_0x2015a6[_0x3a58fc(0xff)]['storage']],_0x451146=[_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xad)]],_0xe7fd48=[_0x2015a6[_0x3a58fc(0xff)]['type']];else var _0x5cb80a=[..._0x2015a6['body'][_0x3a58fc(0x156)]],_0x2d245c=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xa8)]],_0x268640=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x119)]],_0x3f9e98=[..._0x2015a6['body'][_0x3a58fc(0x137)]],_0x2e7c34=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x193)]],_0x21db41=[..._0x2015a6[_0x3a58fc(0xff)]['prod_level']],_0x5f5dcd=[..._0x2015a6[_0x3a58fc(0xff)]['prod_isle']],_0x3d1aa3=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x129)]],_0x4f69ed=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xbd)]],_0x12f389=[..._0x2015a6[_0x3a58fc(0xff)]['secondary_code']],_0x2ddb7d=[..._0x2015a6[_0x3a58fc(0xff)]['MaxStocks_data']],_0x56a8ba=[..._0x2015a6['body'][_0x3a58fc(0xd4)]],_0x5e37fe=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x115)]],_0x2ab0bd=[..._0x2015a6['body']['storage']],_0x451146=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xad)]],_0xe7fd48=[..._0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0xc4)]];const _0x1f321d=_0x5cb80a[_0x3a58fc(0xba)](_0x59b70a=>{return _0x59b70a={'product_name':_0x59b70a};});_0x2d245c['forEach']((_0x2d7a8a,_0x1c0c33)=>{var _0x41954e=_0x3a58fc;_0x1f321d[_0x1c0c33][_0x41954e(0x189)]=_0x2d7a8a;}),_0x268640[_0x3a58fc(0x10a)]((_0x25b8a5,_0x188a04)=>{_0x1f321d[_0x188a04]['quantity']=_0x25b8a5;}),_0x3f9e98['forEach']((_0x3126ce,_0x5b7518)=>{var _0x3e7eb1=_0x3a58fc;_0x1f321d[_0x5b7518][_0x3e7eb1(0x116)]=_0x3126ce;}),_0x2e7c34[_0x3a58fc(0x10a)]((_0x459a67,_0x172fea)=>{_0x1f321d[_0x172fea]['secondary_unit']=_0x459a67;}),_0x21db41[_0x3a58fc(0x10a)]((_0x4187d5,_0x2496c9)=>{var _0x31c267=_0x3a58fc;_0x1f321d[_0x2496c9][_0x31c267(0x145)]=_0x4187d5;}),_0x5f5dcd[_0x3a58fc(0x10a)]((_0x5bf9eb,_0x2a890d)=>{var _0x2de623=_0x3a58fc;_0x1f321d[_0x2a890d][_0x2de623(0x12a)]=_0x5bf9eb;}),_0x3d1aa3[_0x3a58fc(0x10a)]((_0x305f06,_0x3347b7)=>{_0x1f321d[_0x3347b7]['floorlevel']=_0x305f06;}),_0x4f69ed['forEach']((_0x389a51,_0x5248d2)=>{var _0x126740=_0x3a58fc;_0x1f321d[_0x5248d2][_0x126740(0xbd)]=_0x389a51;}),_0x12f389[_0x3a58fc(0x10a)]((_0x4bf971,_0x540661)=>{var _0x7d0e0f=_0x3a58fc;_0x1f321d[_0x540661][_0x7d0e0f(0xfa)]=_0x4bf971;}),_0x2ddb7d['forEach']((_0x285fb5,_0x2ec797)=>{_0x1f321d[_0x2ec797]['maxStocks']=_0x285fb5;}),_0x56a8ba[_0x3a58fc(0x10a)]((_0x1e1ac3,_0x3e0764)=>{var _0x3a5a96=_0x3a58fc;_0x1f321d[_0x3e0764][_0x3a5a96(0xd4)]=_0x1e1ac3;}),_0x5e37fe[_0x3a58fc(0x10a)]((_0x33bd33,_0x78ba42)=>{var _0xfc83b4=_0x3a58fc;_0x1f321d[_0x78ba42][_0xfc83b4(0x115)]=_0x33bd33;}),_0xe7fd48[_0x3a58fc(0x10a)]((_0x116317,_0x469806)=>{_0x1f321d[_0x469806]['type']=_0x116317;}),_0x2ab0bd['forEach']((_0x3d906e,_0x2c99a6)=>{var _0x5e3c13=_0x3a58fc;_0x1f321d[_0x2c99a6][_0x5e3c13(0x128)]=_0x3d906e;}),_0x451146['forEach']((_0x2f60a5,_0x559aea)=>{var _0x30b79f=_0x3a58fc;_0x1f321d[_0x559aea][_0x30b79f(0x14e)]=_0x2f60a5;});const _0x2bc2f8=_0x1f321d[_0x3a58fc(0xf0)](_0x5879e8=>_0x5879e8[_0x3a58fc(0xc8)]!=='0'&&_0x5879e8[_0x3a58fc(0xc8)]!=='');_0x5502e9['invoice']=_0x1fad47,_0x5502e9[_0x3a58fc(0xf7)]=_0x5b1400,_0x5502e9[_0x3a58fc(0x140)]=_0x46681e,_0x5502e9[_0x3a58fc(0xc3)]=_0x45d886,_0x5502e9[_0x3a58fc(0xc7)]=_0x2bc2f8,_0x5502e9[_0x3a58fc(0xb5)]=_0x14d362,_0x5502e9[_0x3a58fc(0x180)]=_0x1e384f,_0x5502e9[_0x3a58fc(0xd0)]=_0x39d58a,_0x5502e9['room']=_0x4ac9ce,_0x5502e9[_0x3a58fc(0x17b)]=_0x4d5597,_0x5502e9['JO_number']=_0x18a442;const _0xc1140d=await _0x5502e9['save'](),_0x1fd8b1=await warehouse['findOne']({'name':_0x2015a6['body'][_0x3a58fc(0xc3)],'room':_0x2015a6[_0x3a58fc(0xff)]['Room_name']});_0x5502e9[_0x3a58fc(0xc7)]['forEach'](_0x4f7832=>{var _0x3241b8=_0x3a58fc,_0x360050=0x0;const _0x220a8d=_0x1fd8b1[_0x3241b8(0xa1)][_0x3241b8(0xba)](_0x5567f9=>{var _0x35676b=_0x3241b8;_0x5567f9[_0x35676b(0x17f)]==_0x4f7832[_0x35676b(0x17f)]&&_0x5567f9[_0x35676b(0x12c)]==_0x4f7832[_0x35676b(0x12c)]&&_0x5567f9['type']==_0x4f7832['type']&&_0x5567f9[_0x35676b(0x12a)]==_0x4f7832[_0x35676b(0x12a)]&&_0x5567f9[_0x35676b(0x145)]==_0x4f7832[_0x35676b(0x145)]&&_0x5567f9['rack']==_0x4f7832['rack']&&_0x5567f9[_0x35676b(0x128)]==_0x4f7832[_0x35676b(0x128)]&&(_0x5567f9[_0x35676b(0x13b)]=parseInt(_0x5567f9['product_stock'])+parseInt(_0x4f7832[_0x35676b(0xc8)]),_0x360050++);});_0x360050=='0'&&(_0x1fd8b1[_0x3241b8(0xa1)]=_0x1fd8b1[_0x3241b8(0xa1)][_0x3241b8(0x9c)]({'product_name':_0x4f7832[_0x3241b8(0x17f)],'product_stock':_0x4f7832[_0x3241b8(0xc8)],'primary_code':_0x4f7832['primary_code'],'secondary_code':_0x4f7832['secondary_code'],'product_code':_0x4f7832['product_code'],'storage':_0x4f7832[_0x3241b8(0x128)],'rack':_0x4f7832[_0x3241b8(0x14e)],'bay':_0x4f7832[_0x3241b8(0x145)],'bin':_0x4f7832['bin'],'type':_0x4f7832['type'],'floorlevel':_0x4f7832['floorlevel'],'maxProducts':_0x4f7832['maxStocks'],'unit':_0x4f7832['standard_unit'],'secondary_unit':_0x4f7832[_0x3241b8(0x194)],'expiry_date':_0x4f7832['expiry_date']}));}),await _0x1fd8b1[_0x3a58fc(0x198)]();const _0x2fb489=await s_payment_data[_0x3a58fc(0xe8)]({'invoice':_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x1a7)]});if(_0x2fb489===null){}else console[_0x3a58fc(0x1a3)](_0x3a58fc(0xf7),_0x2fb489,_0x2015a6[_0x3a58fc(0xff)][_0x3a58fc(0x1a7)]),_0x2fb489['suppliers']=_0x2015a6[_0x3a58fc(0xff)]['suppliers'],await _0x2fb489[_0x3a58fc(0x198)]();_0x2015a6[_0x3a58fc(0x16a)](_0x3a58fc(0x15c),'purchase\x20data\x20update\x20successfully'),_0x3a1e40[_0x3a58fc(0x172)](_0x3a58fc(0xaa));}catch(_0xb02166){console[_0x3a58fc(0x1a3)](_0xb02166);}}),router['post'](a0_0x1245f7(0xc6),auth,async(_0x1aaf42,_0x5301cc)=>{var _0x561b8f=a0_0x1245f7;try{const _0x260c22=_0x1aaf42[_0x561b8f(0x134)]['id'],{invoice:_0x46aeb3,suppliers:_0x2722b6,payable:_0x165e73,due_amount:_0xd495c6}=_0x1aaf42['body'],_0x4ce824=await purchases[_0x561b8f(0xd2)](_0x260c22);var _0x3f724c=_0x165e73-_0xd495c6;_0x4ce824[_0x561b8f(0x180)]=parseFloat(_0x4ce824[_0x561b8f(0x180)])+parseFloat(_0xd495c6),_0x4ce824[_0x561b8f(0xd0)]=_0x3f724c;const _0x3597b3=await _0x4ce824[_0x561b8f(0x198)]();console[_0x561b8f(0x1a3)](_0x3597b3);const _0x5c053f=await s_payment_data[_0x561b8f(0xe8)]({'invoice':_0x46aeb3});_0x5c053f['amount']=_0x3f724c,await _0x5c053f[_0x561b8f(0x198)]();let _0x39da94=new Date(),_0x53d92c=('0'+_0x39da94[_0x561b8f(0x16e)]())[_0x561b8f(0xf3)](-0x2),_0x429c91=('0'+(_0x39da94[_0x561b8f(0x108)]()+0x1))['slice'](-0x2),_0x4a46e9=_0x39da94[_0x561b8f(0x16d)](),_0x12514f=_0x4a46e9+'-'+_0x429c91+'-'+_0x53d92c;const _0x31bf73=new suppliers_payment({'invoice':_0x46aeb3,'date':_0x4a46e9+'-'+_0x429c91+'-'+_0x53d92c,'suppliers':_0x2722b6,'reason':_0x561b8f(0x107),'amount':_0xd495c6}),_0xb7af3=await _0x31bf73['save']();_0x1aaf42[_0x561b8f(0x16a)](_0x561b8f(0x15c),'payment\x20successfull'),_0x5301cc[_0x561b8f(0x172)]('/all_purchases/view');}catch(_0x343418){console[_0x561b8f(0x1a3)](_0x343418);}}),router[a0_0x1245f7(0x11d)](a0_0x1245f7(0x143),auth,async(_0x35e6c0,_0x11467f)=>{var _0x462c39=a0_0x1245f7;try{const {username:_0x530373,email:_0x397ff8,role:_0x334959}=_0x35e6c0[_0x462c39(0x163)],_0xd6d3aa=_0x35e6c0[_0x462c39(0x163)],_0x5e925b=await profile[_0x462c39(0xe8)]({'email':_0xd6d3aa[_0x462c39(0x18e)]}),_0x349393=await master_shop['find']();console[_0x462c39(0x1a3)](_0x462c39(0x14d),_0x349393);const _0x180135=_0x35e6c0[_0x462c39(0x134)]['id'],_0x3ec7c5=await purchases[_0x462c39(0xd2)](_0x180135);console[_0x462c39(0x1a3)](_0x3ec7c5);const _0x3f5569=await suppliers['findOne']({'name':_0x3ec7c5['suppliers']});console[_0x462c39(0x1a3)](_0x3f5569);if(_0x349393[0x0]['language']==_0x462c39(0x179)){var _0x6e7483=users[_0x462c39(0xa9)];console[_0x462c39(0x1a3)](_0x6e7483);}else{if(_0x349393[0x0]['language']=='Hindi')var _0x6e7483=users[_0x462c39(0x12b)];else{if(_0x349393[0x0][_0x462c39(0x192)]==_0x462c39(0x199))var _0x6e7483=users[_0x462c39(0x199)];else{if(_0x349393[0x0][_0x462c39(0x192)]==_0x462c39(0x17e))var _0x6e7483=users[_0x462c39(0x17e)];else{if(_0x349393[0x0][_0x462c39(0x192)]==_0x462c39(0x175))var _0x6e7483=users[_0x462c39(0x175)];else{if(_0x349393[0x0][_0x462c39(0x192)]==_0x462c39(0x118))var _0x6e7483=users[_0x462c39(0x11f)];else{if(_0x349393[0x0]['language']==_0x462c39(0x9a))var _0x6e7483=users[_0x462c39(0x9a)];else{if(_0x349393[0x0][_0x462c39(0x192)]=='Arabic\x20(ae)')var _0x6e7483=users[_0x462c39(0x127)];}}}}}}}_0x11467f[_0x462c39(0xeb)]('purchase_invoice',{'success':_0x35e6c0[_0x462c39(0x16a)]('success'),'errors':_0x35e6c0[_0x462c39(0x16a)](_0x462c39(0x16f)),'role':_0xd6d3aa,'profile':_0x5e925b,'master_shop':_0x349393,'supplier':_0x3f5569,'purchase':_0x3ec7c5,'language':_0x6e7483});}catch(_0x250822){console[_0x462c39(0x1a3)](_0x250822);}}),router['get'](a0_0x1245f7(0x14f),auth,async(_0x3b1723,_0x5b05b3)=>{var _0xbb68c=a0_0x1245f7;try{const {username:_0x481320,email:_0x175f8a,role:_0x1161e3}=_0x3b1723[_0xbb68c(0x163)],_0x4276=_0x3b1723[_0xbb68c(0x163)],_0x57d2f8=await profile[_0xbb68c(0xe8)]({'email':_0x4276[_0xbb68c(0x18e)]}),_0x54de63=await master_shop[_0xbb68c(0x13f)]();console[_0xbb68c(0x1a3)](_0xbb68c(0x14d),_0x54de63);const _0xe3ad22=_0x3b1723['params']['id'];console[_0xbb68c(0x1a3)](_0xe3ad22);const _0x572aa2=await purchases['findById'](_0xe3ad22);console[_0xbb68c(0x1a3)](_0xbb68c(0xd7),_0x572aa2);const _0x277cc5=await product[_0xbb68c(0x13f)]({}),_0x288447=await warehouse[_0xbb68c(0xa0)]([{'$match':{'name':_0x572aa2[_0xbb68c(0xc3)],'room':_0x572aa2[_0xbb68c(0xb3)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0xbb68c(0xf1)},{'$group':{'_id':_0xbb68c(0xbc),'name':{'$first':_0xbb68c(0xc9)},'product_stock':{'$first':_0xbb68c(0xfc)},'bay':{'$first':_0xbb68c(0x187)},'bin':{'$first':_0xbb68c(0x13c)},'type':{'$first':_0xbb68c(0x135)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xbb68c(0x11c)},'product_code':{'$first':_0xbb68c(0xdc)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xbb68c(0x133)}}}]);warehouse_data=await warehouse[_0xbb68c(0xa0)]([{'$match':{'status':_0xbb68c(0x186),'name':_0xbb68c(0x15f),'warehouse_category':_0xbb68c(0x125)}},{'$group':{'_id':_0xbb68c(0x139),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0xbb68c(0x1a3)](_0xbb68c(0xa3),_0x288447);if(_0x54de63[0x0][_0xbb68c(0x192)]==_0xbb68c(0x179)){var _0x2e8724=users['English'];console[_0xbb68c(0x1a3)](_0x2e8724);}else{if(_0x54de63[0x0]['language']==_0xbb68c(0x12b))var _0x2e8724=users[_0xbb68c(0x12b)];else{if(_0x54de63[0x0]['language']==_0xbb68c(0x199))var _0x2e8724=users[_0xbb68c(0x199)];else{if(_0x54de63[0x0]['language']==_0xbb68c(0x17e))var _0x2e8724=users[_0xbb68c(0x17e)];else{if(_0x54de63[0x0][_0xbb68c(0x192)]==_0xbb68c(0x175))var _0x2e8724=users[_0xbb68c(0x175)];else{if(_0x54de63[0x0][_0xbb68c(0x192)]==_0xbb68c(0x118))var _0x2e8724=users[_0xbb68c(0x11f)];else{if(_0x54de63[0x0][_0xbb68c(0x192)]=='Chinese')var _0x2e8724=users[_0xbb68c(0x9a)];else{if(_0x54de63[0x0][_0xbb68c(0x192)]=='Arabic\x20(ae)')var _0x2e8724=users[_0xbb68c(0x127)];}}}}}}}_0x5b05b3[_0xbb68c(0xeb)]('return_purchase',{'success':_0x3b1723[_0xbb68c(0x16a)](_0xbb68c(0x15c)),'errors':_0x3b1723['flash'](_0xbb68c(0x16f)),'role':_0x4276,'profile':_0x57d2f8,'user':_0x572aa2,'stock':_0x288447,'master_shop':_0x54de63,'product':_0x277cc5,'language':_0x2e8724,'warehouse':warehouse_data});}catch(_0x32a98d){console[_0xbb68c(0x1a3)](_0x32a98d);}}),router[a0_0x1245f7(0x19e)](a0_0x1245f7(0x14f),auth,async(_0x8392ad,_0x40f7e3)=>{var _0x17a92c=a0_0x1245f7;try{const {invoice:_0x4a27e6,date:_0x424751,warehouse_name:_0x447f59,Room_name:_0xe7431e,product_name:_0x84aa87,purchase_quantity:_0x48529c,stocks:_0x5c149f,return_qty:_0x4b9667,note:_0x1bd3e0,level:_0x4dd6de,isle:_0x533762,pallet:_0x2ef6cc,to_warehouse_name:_0x3ec10a,to_Room_name:_0x5d658e}=_0x8392ad[_0x17a92c(0xff)],_0x5275fa=await purchases[_0x17a92c(0xe8)]({'_id':_0x8392ad[_0x17a92c(0x134)]['id']}),_0x24ce3b=await warehouse[_0x17a92c(0xe8)]({'name':_0x447f59,'room':_0xe7431e});if(typeof _0x84aa87==_0x17a92c(0xcf))var _0x211e81=[_0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x17f)]],_0x94979b=[_0x8392ad['body'][_0x17a92c(0x195)]],_0x378aff=[_0x8392ad[_0x17a92c(0xff)]['stocks']],_0x39b497=[_0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xfb)]],_0x46e262=[_0x8392ad[_0x17a92c(0xff)]['level']],_0x52445e=[_0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x166)]],_0x1e0336=[_0x8392ad[_0x17a92c(0xff)]['pallet']],_0x21a8b0=[_0x8392ad[_0x17a92c(0xff)]['types']],_0x9cc76c=[_0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xae)]],_0xe29ff5=[_0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x9d)]],_0xe2547b=[_0x8392ad['body'][_0x17a92c(0x16c)]];else var _0x211e81=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x17f)]],_0x94979b=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x195)]],_0x378aff=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xe5)]],_0x39b497=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xfb)]],_0x46e262=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xc0)]],_0x52445e=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x166)]],_0x1e0336=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xac)]],_0x21a8b0=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x155)]],_0x9cc76c=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0xae)]],_0xe29ff5=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x9d)]],_0xe2547b=[..._0x8392ad[_0x17a92c(0xff)][_0x17a92c(0x16c)]];const _0x25ca4c=_0x211e81[_0x17a92c(0xba)](_0x3b5d5b=>{return _0x3b5d5b={'product_name':_0x3b5d5b};});_0x94979b[_0x17a92c(0x10a)]((_0x47c5b2,_0x29443a)=>{_0x25ca4c[_0x29443a]['purchase_quantity']=_0x47c5b2;}),_0x378aff['forEach']((_0x466194,_0x1b5b0d)=>{_0x25ca4c[_0x1b5b0d]['stock_quantity']=_0x466194;}),_0x39b497[_0x17a92c(0x10a)]((_0x2790c7,_0x501438)=>{var _0x5cebf2=_0x17a92c;_0x25ca4c[_0x501438][_0x5cebf2(0xfb)]=_0x2790c7;}),_0x46e262['forEach']((_0x1518e8,_0x472194)=>{var _0xb4507d=_0x17a92c;_0x25ca4c[_0x472194][_0xb4507d(0x145)]=_0x1518e8;}),_0x52445e[_0x17a92c(0x10a)]((_0x39642b,_0x16ae74)=>{var _0x4238e0=_0x17a92c;_0x25ca4c[_0x16ae74][_0x4238e0(0x12a)]=_0x39642b;}),_0x1e0336['forEach']((_0x2d054e,_0x1b0bee)=>{_0x25ca4c[_0x1b0bee]['floorlevel']=_0x2d054e;}),_0x21a8b0['forEach']((_0x281684,_0x3fd440)=>{var _0x593219=_0x17a92c;_0x25ca4c[_0x3fd440][_0x593219(0xc4)]=_0x281684;}),_0x9cc76c['forEach']((_0x4e41df,_0x232c92)=>{var _0x48588b=_0x17a92c;_0x25ca4c[_0x232c92][_0x48588b(0x189)]=_0x4e41df;}),_0xe29ff5[_0x17a92c(0x10a)]((_0x10d057,_0x370a59)=>{_0x25ca4c[_0x370a59]['primary_code']=_0x10d057;}),_0xe2547b['forEach']((_0x3e9525,_0x559a50)=>{var _0x1daf62=_0x17a92c;_0x25ca4c[_0x559a50][_0x1daf62(0xfa)]=_0x3e9525;}),_0x5275fa[_0x17a92c(0xc7)][_0x17a92c(0x10a)](_0x5286ac=>{var _0x1068f0=_0x17a92c;const _0x39f5c0=_0x24ce3b[_0x1068f0(0xa1)][_0x1068f0(0xba)](_0x1b73bd=>{var _0x584dac=_0x1068f0;_0x1b73bd[_0x584dac(0x17f)]==_0x5286ac[_0x584dac(0x17f)]&&_0x1b73bd[_0x584dac(0x12c)]==_0x5286ac['floorlevel']&&_0x1b73bd[_0x584dac(0xc4)]==_0x5286ac[_0x584dac(0xc4)]&&_0x1b73bd[_0x584dac(0x12a)]==_0x5286ac[_0x584dac(0x12a)]&&_0x1b73bd['bay']==_0x5286ac[_0x584dac(0x145)]&&_0x1b73bd['rack']==_0x5286ac['rack']&&_0x1b73bd['storage']==_0x5286ac['storage']&&(console[_0x584dac(0x1a3)](parseInt(_0x1b73bd[_0x584dac(0x13b)])+_0x584dac(0xec)+parseInt(_0x5286ac['quantity'])),_0x1b73bd[_0x584dac(0x13b)]=parseInt(_0x1b73bd[_0x584dac(0x13b)])+parseInt(_0x5286ac[_0x584dac(0xc8)]));});}),await _0x24ce3b[_0x17a92c(0x198)]();const _0x46f184=_0x25ca4c[_0x17a92c(0xf0)](_0x1cc3d7=>_0x1cc3d7[_0x17a92c(0xfb)]!=='0'&&_0x1cc3d7[_0x17a92c(0xfb)]!=='');var _0x276d9d=0x0;_0x46f184[_0x17a92c(0x10a)](_0x253668=>{var _0x4e89a4=_0x17a92c;console[_0x4e89a4(0x1a3)](_0x4e89a4(0xf4),_0x253668),(parseInt(_0x253668[_0x4e89a4(0x195)])<parseInt(_0x253668[_0x4e89a4(0xfb)])||parseInt(_0x253668[_0x4e89a4(0x138)])<parseInt(_0x253668['return_qty']))&&_0x276d9d++;});if(_0x276d9d!=0x0)return _0x8392ad[_0x17a92c(0x16a)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x40f7e3[_0x17a92c(0x172)](_0x17a92c(0x93));const _0x55fee2=new purchases_return({'invoice':_0x4a27e6,'suppliers':_0x8392ad[_0x17a92c(0xff)]['suppliers'],'date':_0x424751,'warehouse_name':_0x447f59,'return_product':_0x46f184,'note':_0x1bd3e0,'room':_0xe7431e,'to_warehouse_name':_0x3ec10a,'to_room':_0x5d658e}),_0x5be44b=await _0x55fee2[_0x17a92c(0x198)]();console[_0x17a92c(0x1a3)](_0x55fee2);const _0x54c812=await purchases_return[_0x17a92c(0xe8)]({'invoice':_0x4a27e6}),_0x3e63d2=await warehouse['findOne']({'name':_0x3ec10a,'room':_0x5d658e});_0x54c812[_0x17a92c(0x153)][_0x17a92c(0x10a)](_0x11997a=>{var _0x3fbb41=_0x17a92c,_0x4896e6=0x0;const _0x23d2f2=_0x3e63d2[_0x3fbb41(0xa1)][_0x3fbb41(0xba)](_0x3fbfd0=>{var _0x429bfc=_0x3fbb41;_0x3fbfd0[_0x429bfc(0x17f)]==_0x11997a['product_name']&&_0x3fbfd0[_0x429bfc(0x12c)]==_0x11997a['floorlevel']&&_0x3fbfd0['type']==_0x11997a[_0x429bfc(0xc4)]&&_0x3fbfd0[_0x429bfc(0x12a)]==_0x11997a[_0x429bfc(0x12a)]&&_0x3fbfd0[_0x429bfc(0x145)]==_0x11997a[_0x429bfc(0x145)]&&(_0x3fbfd0[_0x429bfc(0x13b)]=parseInt(_0x3fbfd0[_0x429bfc(0x13b)])-parseInt(_0x11997a[_0x429bfc(0xfb)]),_0x4896e6++);});_0x4896e6=='0'&&(_0x3e63d2[_0x3fbb41(0xa1)]=_0x3e63d2[_0x3fbb41(0xa1)][_0x3fbb41(0x9c)]({'product_name':_0x11997a['product_name'],'product_stock':_0x11997a[_0x3fbb41(0xfb)],'primary_code':_0x11997a[_0x3fbb41(0xbd)],'secondary_code':_0x11997a[_0x3fbb41(0xfa)],'product_code':_0x11997a[_0x3fbb41(0x189)],'storage':_0x11997a['storage'],'rack':_0x11997a[_0x3fbb41(0x14e)],'bay':_0x11997a[_0x3fbb41(0x145)],'bin':_0x11997a[_0x3fbb41(0x12a)],'type':_0x11997a[_0x3fbb41(0xc4)],'floorlevel':_0x11997a[_0x3fbb41(0x12c)],'maxProducts':_0x11997a['maxStocks'],'unit':_0x11997a[_0x3fbb41(0x116)],'secondary_unit':_0x11997a['secondary_unit'],'expiry_date':_0x11997a['expiry_date']}));}),await _0x3e63d2[_0x17a92c(0x198)]();const _0x8702a6=await purchases[_0x17a92c(0xe8)]({'invoice':_0x4a27e6});_0x8702a6['return_data']='True';const _0x28a469=await _0x8702a6['save'](),_0x227c64=new s_payment_data({'invoice':_0x4a27e6,'suppliers':_0x8392ad[_0x17a92c(0xff)]['suppliers'],'reason':_0x17a92c(0x19d)});await _0x227c64[_0x17a92c(0x198)]();const _0x167810=await master_shop['find']();console[_0x17a92c(0x1a3)]('add\x20post',_0x167810[0x0][_0x17a92c(0x131)]);const _0x57242f=await email_settings[_0x17a92c(0xe8)](),_0x32e50c=await suppliers[_0x17a92c(0xe8)]({'name':_0x8392ad['body']['suppliers']});console[_0x17a92c(0x1a3)](_0x17a92c(0x148),_0x32e50c);_0x167810[0x0][_0x17a92c(0x9f)]==0x1?(right_currency=_0x167810[0x0][_0x17a92c(0x103)],left_currency=''):(right_currency='',left_currency=_0x167810[0x0][_0x17a92c(0x103)]);var _0x19c319=_0x211e81,_0x322c7d=_0x39b497,_0x784528='',_0x2be87e;for(_0x2be87e in _0x19c319){_0x784528+=_0x17a92c(0xc5)+_0x17a92c(0xd8)+_0x19c319[_0x2be87e]+_0x17a92c(0xd5)+_0x17a92c(0xd8)+_0x322c7d[_0x2be87e]+_0x17a92c(0xd5)+_0x17a92c(0xf6);}console[_0x17a92c(0x1a3)](_0x17a92c(0x165),_0x784528);let _0x2a9c8c=nodemailer[_0x17a92c(0x13d)]({'service':_0x17a92c(0xe3),'auth':{'user':_0x57242f[_0x17a92c(0x18e)],'pass':_0x57242f[_0x17a92c(0xab)]}}),_0xa22923={'from':_0x57242f[_0x17a92c(0x18e)],'to':_0x32e50c[_0x17a92c(0x18e)],'subject':_0x17a92c(0x100),'attachments':[{'filename':_0x17a92c(0xf9),'path':__dirname+_0x17a92c(0xde)+_0x17a92c(0xb7)+_0x167810[0x0][_0x17a92c(0x131)],'cid':'logo'}],'html':_0x17a92c(0x9b)+_0x17a92c(0x1ab)+_0x17a92c(0xcb)+'<div>'+_0x17a92c(0x1a2)+_0x17a92c(0xe7)+_0x17a92c(0x102)+'</div>'+_0x17a92c(0xe7)+_0x17a92c(0x167)+_0x167810[0x0][_0x17a92c(0x98)]+'\x20</h2>'+_0x17a92c(0x15e)+_0x17a92c(0x15e)+'<hr\x20class=\x22my-3\x22>'+_0x17a92c(0xe7)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x17a92c(0xa7)+_0x4a27e6+'\x20'+_0x17a92c(0x164)+_0x17a92c(0x1a4)+_0x424751+'\x20'+_0x17a92c(0x161)+_0x17a92c(0x101)+_0x17a92c(0x15e)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x17a92c(0x151)+_0x17a92c(0xc5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x17a92c(0x112)+_0x17a92c(0x184)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x17a92c(0x183)+_0x17a92c(0xa4)+'\x20'+_0x784528+'\x20'+_0x17a92c(0xf2)+_0x17a92c(0x105)+_0x17a92c(0xe7)+_0x17a92c(0xdd)+_0x17a92c(0x121)+_0x167810[0x0]['site_title']+'</h5>'+_0x17a92c(0x15e)+_0x17a92c(0x15e)+_0x17a92c(0x162)};_0x2a9c8c['sendMail'](_0xa22923,function(_0x375931,_0x8bda6a){var _0x289787=_0x17a92c;_0x375931?(console['log'](_0x375931),console[_0x289787(0x1a3)](_0x289787(0x15d))):console[_0x289787(0x1a3)](_0x289787(0x173));}),_0x8392ad[_0x17a92c(0x16a)](_0x17a92c(0x15c),'purchases\x20item\x20return\x20successfull'),_0x40f7e3['redirect'](_0x17a92c(0xaa));}catch(_0x352d45){console[_0x17a92c(0x1a3)](_0x352d45),_0x40f7e3[_0x17a92c(0xbb)](0xc8)[_0x17a92c(0x1a5)]({'message':_0x352d45[_0x17a92c(0xa5)]});}}),router[a0_0x1245f7(0x11d)](a0_0x1245f7(0xed),auth,async(_0x1f9b8e,_0x3ff4ea)=>{var _0x5fc466=a0_0x1245f7;try{const {username:_0x330602,email:_0x5f12ff,role:_0x3b3dea}=_0x1f9b8e[_0x5fc466(0x163)],_0x4d1cfd=_0x1f9b8e[_0x5fc466(0x163)],_0x57116b=await profile['findOne']({'email':_0x4d1cfd[_0x5fc466(0x18e)]}),_0xbd0e5e=await master_shop[_0x5fc466(0x13f)](),_0xeb81a8=_0x1f9b8e['params']['id'],_0x4cc3c9=await purchases[_0x5fc466(0xd2)](_0xeb81a8);if(_0xbd0e5e[0x0][_0x5fc466(0x192)]=='English\x20(US)')var _0x31c3f3=users[_0x5fc466(0xa9)];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]==_0x5fc466(0x12b))var _0x31c3f3=users[_0x5fc466(0x12b)];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]=='German')var _0x31c3f3=users[_0x5fc466(0x199)];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]==_0x5fc466(0x17e))var _0x31c3f3=users[_0x5fc466(0x17e)];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]=='French')var _0x31c3f3=users['French'];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]==_0x5fc466(0x118))var _0x31c3f3=users[_0x5fc466(0x11f)];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]==_0x5fc466(0x9a))var _0x31c3f3=users['Chinese'];else{if(_0xbd0e5e[0x0][_0x5fc466(0x192)]==_0x5fc466(0x14b))var _0x31c3f3=users['Arabic'];}}}}}}}_0x3ff4ea['render'](_0x5fc466(0xdb),{'success':_0x1f9b8e[_0x5fc466(0x16a)](_0x5fc466(0x15c)),'errors':_0x1f9b8e['flash'](_0x5fc466(0x16f)),'role':_0x4d1cfd,'profile':_0x57116b,'alldata':_0x4cc3c9,'master_shop':_0xbd0e5e,'language':_0x31c3f3}),console[_0x5fc466(0x1a3)](alldata);}catch(_0x3d3718){console[_0x5fc466(0x1a3)](_0x3d3718);}}),router[a0_0x1245f7(0x19e)](a0_0x1245f7(0x181),async(_0x451030,_0x51b467)=>{var _0x72b61=a0_0x1245f7;const {product_code:_0x4ed4ba}=_0x451030[_0x72b61(0xff)];var _0x74dfe2;const _0x270bc4=await product[_0x72b61(0xa0)]([{'$match':{'primary_code':_0x4ed4ba,'product_category':_0x72b61(0x125)}},{'$group':{'_id':_0x72b61(0x1a9),'name':{'$first':'$name'},'category':{'$first':_0x72b61(0x17d)},'brand':{'$first':_0x72b61(0x110)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x72b61(0x11b)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x72b61(0xb0)},'secondary_code':{'$first':_0x72b61(0xbe)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x72b61(0xe6)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x72b61(0x168)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x8424bc=await product[_0x72b61(0xa0)]([{'$match':{'secondary_code':_0x4ed4ba,'product_category':_0x72b61(0x125)}},{'$group':{'_id':_0x72b61(0x1a9),'name':{'$first':_0x72b61(0x139)},'category':{'$first':_0x72b61(0x17d)},'brand':{'$first':_0x72b61(0x110)},'unit':{'$first':_0x72b61(0x8f)},'alertquantity':{'$first':_0x72b61(0x11b)},'product_code':{'$first':_0x72b61(0xdf)},'primary_code':{'$first':_0x72b61(0xb0)},'secondary_code':{'$first':_0x72b61(0xbe)},'maxStocks':{'$first':_0x72b61(0x18f)},'maxProdPerUnit':{'$first':_0x72b61(0xe6)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x72b61(0x168)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x270bc4[_0x72b61(0x196)]>0x0)_0x74dfe2=_0x270bc4;else _0x8424bc['length']>0x0&&(_0x74dfe2=_0x8424bc);_0x51b467['json'](_0x74dfe2);}),router[a0_0x1245f7(0x19e)](a0_0x1245f7(0x17a),async(_0x2e34bd,_0x10b928)=>{var _0x31005c=a0_0x1245f7;const {primaryCode:_0x3bd5fb,secondaryCode:_0x4c90a4,productCode:_0x27a238,bay:_0x57f806,bin:_0x174ba4,types:_0xd68a6,pallet:_0x466ca3,warehouses:_0x72dc35,room:_0x36c700}=_0x2e34bd['body'];console[_0x31005c(0x1a3)](_0x2e34bd[_0x31005c(0xff)]);try{const _0x5de29f=await warehouse[_0x31005c(0xa0)]([{'$match':{'name':_0x72dc35,'room':_0x36c700}},{'$unwind':_0x31005c(0xf1)},{'$match':{'product_details.bay':_0x57f806,'product_details.bin':_0x174ba4,'product_details.type':_0xd68a6}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x31005c(0xc9)},'product_stock':{'$first':_0x31005c(0xfc)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x31005c(0x136)},'pallet':{'$first':_0x31005c(0x11a)},'maxProducts':{'$first':_0x31005c(0x19f)}}}]);_0x10b928[_0x31005c(0xbb)](0xc8)['json'](_0x5de29f);}catch(_0x18eec7){_0x10b928[_0x31005c(0xbb)](0x194)['json']({'message':_0x18eec7[_0x31005c(0xa5)]});}}),module['exports']=router;