var a0_0x32f878=a0_0x4b1e;(function(_0x271e02,_0x3f85f2){var _0x5a21f4=a0_0x4b1e,_0x381329=_0x271e02();while(!![]){try{var _0x48cba5=parseInt(_0x5a21f4(0x252))/0x1*(-parseInt(_0x5a21f4(0x1f0))/0x2)+parseInt(_0x5a21f4(0x204))/0x3+parseInt(_0x5a21f4(0x2c8))/0x4+parseInt(_0x5a21f4(0x25f))/0x5+-parseInt(_0x5a21f4(0x282))/0x6*(-parseInt(_0x5a21f4(0x24a))/0x7)+-parseInt(_0x5a21f4(0x1e7))/0x8+parseInt(_0x5a21f4(0x27e))/0x9;if(_0x48cba5===_0x3f85f2)break;else _0x381329['push'](_0x381329['shift']());}catch(_0x3cbb05){_0x381329['push'](_0x381329['shift']());}}}(a0_0x4139,0x76637));function a0_0x4b1e(_0x3f8425,_0xf30e2){var _0x4139a7=a0_0x4139();return a0_0x4b1e=function(_0x4b1e06,_0x2e937d){_0x4b1e06=_0x4b1e06-0x1b7;var _0x213f5f=_0x4139a7[_0x4b1e06];return _0x213f5f;},a0_0x4b1e(_0x3f8425,_0xf30e2);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x32f878(0x2a0)),auth=require(a0_0x32f878(0x2db)),nodemailer=require('nodemailer');var ejs=require(a0_0x32f878(0x2af));const path=require(a0_0x32f878(0x21c)),users=require('../public/language/languages.json');router[a0_0x32f878(0x1c0)](a0_0x32f878(0x2bb),auth,async(_0xcb09fe,_0x1c6611)=>{var _0x1b9d48=a0_0x32f878;try{const {username:_0x5efa80,email:_0x44c5c8,role:_0x461dd8}=_0xcb09fe[_0x1b9d48(0x26e)],_0x4d4497=_0xcb09fe['user'],_0x56cf92=await profile[_0x1b9d48(0x284)]({'email':_0x4d4497[_0x1b9d48(0x22f)]}),_0x49167b=await staff['findOne']({'email':_0x4d4497[_0x1b9d48(0x22f)]});if(_0x4d4497[_0x1b9d48(0x270)]==_0x1b9d48(0x1e5)){const _0x495fb7=await staff['findOne']({'email':_0x4d4497['email']});}const _0x15f3c6=await master_shop[_0x1b9d48(0x2c7)]();let _0x2086fb;if(_0x4d4497[_0x1b9d48(0x270)]=='staff'){const _0x33df24=await staff[_0x1b9d48(0x284)]({'email':_0x4d4497[_0x1b9d48(0x22f)]});_0x2086fb=await purchases['aggregate']([{'$match':{'warehouse_name':_0x33df24[_0x1b9d48(0x2cc)]}},{'$lookup':{'from':_0x1b9d48(0x21d),'localField':_0x1b9d48(0x21d),'foreignField':_0x1b9d48(0x25c),'as':_0x1b9d48(0x1cb)}},{'$unwind':_0x1b9d48(0x29e)},{'$unwind':_0x1b9d48(0x24b)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1b9d48(0x28c)},'suppliers':{'$first':_0x1b9d48(0x2d9)},'date':{'$first':_0x1b9d48(0x248)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1b9d48(0x203)},'product':{'$push':_0x1b9d48(0x24b)},'note':{'$first':_0x1b9d48(0x28d)},'paid_amount':{'$first':_0x1b9d48(0x28e)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x1b9d48(0x2c5)},'batch_code':{'$first':_0x1b9d48(0x1f4)},'expiry_date':{'$first':_0x1b9d48(0x2d0)},'suppliers_docs':{'$first':_0x1b9d48(0x29e)},'total_product_quantity':{'$sum':_0x1b9d48(0x28b)},'level':{'$addToSet':_0x1b9d48(0x1f1)},'isle':{'$addToSet':_0x1b9d48(0x257)},'type':{'$addToSet':_0x1b9d48(0x24c)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2086fb=await purchases[_0x1b9d48(0x224)]([{'$lookup':{'from':_0x1b9d48(0x21d),'localField':_0x1b9d48(0x21d),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x1b9d48(0x29e)},{'$unwind':_0x1b9d48(0x24b)},{'$group':{'_id':_0x1b9d48(0x20e),'invoice':{'$first':_0x1b9d48(0x28c)},'suppliers':{'$first':_0x1b9d48(0x2d9)},'date':{'$first':_0x1b9d48(0x248)},'warehouse_name':{'$first':_0x1b9d48(0x2ca)},'room':{'$addToSet':_0x1b9d48(0x1d0)},'product':{'$push':_0x1b9d48(0x24b)},'note':{'$first':_0x1b9d48(0x28d)},'paid_amount':{'$first':_0x1b9d48(0x28e)},'due_amount':{'$first':_0x1b9d48(0x286)},'return_data':{'$first':_0x1b9d48(0x2c5)},'batch_code':{'$first':_0x1b9d48(0x1f4)},'expiry_date':{'$first':_0x1b9d48(0x2d0)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1b9d48(0x28b)},'level':{'$addToSet':_0x1b9d48(0x1f1)},'isle':{'$addToSet':_0x1b9d48(0x257)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x1b9d48(0x23a)},'finalize':{'$first':_0x1b9d48(0x288)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x15f3c6[0x0][_0x1b9d48(0x29d)]==_0x1b9d48(0x1e4)){var _0x1c2b0b=users[_0x1b9d48(0x262)];console['log'](_0x1c2b0b);}else{if(_0x15f3c6[0x0][_0x1b9d48(0x29d)]==_0x1b9d48(0x2d6))var _0x1c2b0b=users[_0x1b9d48(0x2d6)];else{if(_0x15f3c6[0x0][_0x1b9d48(0x29d)]==_0x1b9d48(0x255))var _0x1c2b0b=users[_0x1b9d48(0x255)];else{if(_0x15f3c6[0x0][_0x1b9d48(0x29d)]==_0x1b9d48(0x1dd))var _0x1c2b0b=users[_0x1b9d48(0x1dd)];else{if(_0x15f3c6[0x0]['language']==_0x1b9d48(0x251))var _0x1c2b0b=users['French'];else{if(_0x15f3c6[0x0]['language']=='Portuguese\x20(BR)')var _0x1c2b0b=users[_0x1b9d48(0x1c3)];else{if(_0x15f3c6[0x0][_0x1b9d48(0x29d)]=='Chinese')var _0x1c2b0b=users[_0x1b9d48(0x2a8)];else{if(_0x15f3c6[0x0][_0x1b9d48(0x29d)]=='Arabic\x20(ae)')var _0x1c2b0b=users['Arabic'];}}}}}}}_0x1c6611[_0x1b9d48(0x1cc)](_0x1b9d48(0x212),{'success':_0xcb09fe['flash'](_0x1b9d48(0x1e9)),'errors':_0xcb09fe[_0x1b9d48(0x273)]('errors'),'purchases':_0x2086fb,'role':_0x4d4497,'profile':_0x56cf92,'master_shop':_0x15f3c6,'language':_0x1c2b0b});}catch(_0x4d2010){console['log'](_0x1b9d48(0x2a9),_0x4d2010),_0x1c6611[_0x1b9d48(0x253)](0xc8)['json']({'message':_0x4d2010[_0x1b9d48(0x250)]});}});function BayBinSelected(_0x33bece,_0x2fb74c){var _0x2b1cc9=a0_0x32f878,_0xe4d21=[],_0x258d01=[],_0x35b4cd=[],_0x5c1db7=[],_0x150319=[],_0x5dfca0=[];let _0x2eaf58=[];if(_0x33bece==_0x2b1cc9(0x2da))switch(_0x2fb74c){case _0x2b1cc9(0x296):_0xe4d21=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x258d01=[0x1,0x2],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x1e6),_0x2b1cc9(0x219)],_0x150319=['D'],_0x5dfca0=['A'];break;case _0x2b1cc9(0x1b9):_0xe4d21=[0x6,0x5,0x4,0x3,0x2,0x1],_0x258d01=[0x1,0x2],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x1e6),_0x2b1cc9(0x219)],_0x150319=['D'],_0x5dfca0=['B'];break;case'Shelves':_0xe4d21=[0x0],_0x258d01=[0x0],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x219)],_0x150319=['D'],_0x5dfca0=['S'];break;case'Receiving\x20Area':_0xe4d21=[0x0],_0x258d01=[0x0],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x35b4cd=[_0x2b1cc9(0x219)],_0x150319=['D'],_0x5dfca0=['R'];break;}else{if(_0x33bece==_0x2b1cc9(0x283))switch(_0x2fb74c){case'Rack\x20A':_0xe4d21=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x258d01=['B','F'],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=['Level',_0x2b1cc9(0x219)],_0x150319=['C'],_0x5dfca0=['A'];break;case'Rack\x20B':_0xe4d21=[0x5,0x4,0x3,0x2,0x1],_0x258d01=['F','B','S'],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x1e6),_0x2b1cc9(0x219)],_0x150319=['C'],_0x5dfca0=['B'];break;case _0x2b1cc9(0x25b):_0xe4d21=[0x1,0x2,0x3,0x4,0x5],_0x258d01=['B','F','S'],_0x5c1db7=[0x5,0x4,0x3,0x2,0x1],_0x35b4cd=[_0x2b1cc9(0x1e6),'Floor'],_0x150319=['C'],_0x5dfca0=['C'];break;case _0x2b1cc9(0x245):_0xe4d21=[0x5,0x4,0x3,0x2,0x1],_0x258d01=['F','B','S'],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x1e6),_0x2b1cc9(0x219)],_0x150319=['C'],_0x5dfca0=['D'];break;case _0x2b1cc9(0x1db):_0xe4d21=[0x4,0x3,0x2,0x1],_0x258d01=[0x1,0x2],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x1e6),_0x2b1cc9(0x219)],_0x150319=['C'],_0x5dfca0=['E'];break;case _0x2b1cc9(0x223):_0xe4d21=[0x1,0x2,0x3],_0x258d01=[0x1,0x2],_0x5c1db7=[0x1,0x2,0x3,0x4,0x5],_0x35b4cd=[_0x2b1cc9(0x1e6)],_0x150319=['C'],_0x5dfca0=['F'];break;}}return{'levels':_0xe4d21,'Isle':_0x258d01,'rack':_0x5c1db7,'type':_0x35b4cd,'storage':_0x150319,'rak':_0x5dfca0};}async function getRandom8DigitNumber(){var _0x4d42db=a0_0x32f878;const _0x734c42=0x989680,_0x299914=0x5f5e0ff,_0x190a86=Math[_0x4d42db(0x1bb)](Math[_0x4d42db(0x22b)]()*(_0x299914-_0x734c42+0x1))+_0x734c42;var _0xbe1a89;const _0x312b9d=await purchases[_0x4d42db(0x284)]({'invoice':_0x4d42db(0x228)+_0x190a86});return _0x312b9d&&_0x312b9d['length']>0x0?_0xbe1a89=_0x4d42db(0x228)+_0x190a86:_0xbe1a89=_0x4d42db(0x228)+_0x190a86,_0xbe1a89;}router[a0_0x32f878(0x1c0)](a0_0x32f878(0x202),auth,async(_0xcc2b6e,_0x1fef99)=>{var _0x147f3a=a0_0x32f878;try{const {username:_0x1650b8,email:_0x181976,role:_0x36da01}=_0xcc2b6e[_0x147f3a(0x26e)],_0x5538a1=_0xcc2b6e[_0x147f3a(0x26e)],_0x4811a4=await profile['findOne']({'email':_0x5538a1[_0x147f3a(0x22f)]}),_0x3894cc=await master_shop[_0x147f3a(0x2c7)](),_0x4642f5=await staff[_0x147f3a(0x284)]({'email':_0x5538a1[_0x147f3a(0x22f)]}),_0x339967=await suppliers[_0x147f3a(0x2c7)]({});let _0x8a0fd8;if(_0x5538a1[_0x147f3a(0x270)]=='staff'){const _0x5bf5c5=await staff['findOne']({'email':_0x5538a1['email']});_0x8a0fd8=await warehouse[_0x147f3a(0x224)]([{'$match':{'status':_0x147f3a(0x1c7),'name':_0x5bf5c5[_0x147f3a(0x2cc)],'warehouse_category':_0x147f3a(0x20b),'name':{'$ne':_0x147f3a(0x1ce)}}},{'$group':{'_id':'$name','name':{'$first':_0x147f3a(0x267)}}}]);}else _0x8a0fd8=await warehouse[_0x147f3a(0x224)]([{'$match':{'status':_0x147f3a(0x1c7),'warehouse_category':_0x147f3a(0x20b),'name':{'$ne':_0x147f3a(0x1ce)}}},{'$group':{'_id':_0x147f3a(0x267),'name':{'$first':_0x147f3a(0x267)}}}]);const _0x3c0b40=await product['find']({}),_0x236803=await warehouse[_0x147f3a(0x2c7)]({'status':_0x147f3a(0x1c7)}),_0xacbdb2=await purchases['find']({}),_0x26d133=_0xacbdb2[_0x147f3a(0x25e)]+0x1,_0x50e146='INC-'+_0x26d133['toString']()[_0x147f3a(0x293)](0x5,'0');var _0x43cc52=['Ambient',_0x147f3a(0x266)];if(_0x3894cc[0x0]['language']==_0x147f3a(0x1e4))var _0x34492a=users[_0x147f3a(0x262)];else{if(_0x3894cc[0x0][_0x147f3a(0x29d)]==_0x147f3a(0x2d6))var _0x34492a=users['Hindi'];else{if(_0x3894cc[0x0][_0x147f3a(0x29d)]==_0x147f3a(0x255))var _0x34492a=users['German'];else{if(_0x3894cc[0x0][_0x147f3a(0x29d)]=='Spanish')var _0x34492a=users[_0x147f3a(0x1dd)];else{if(_0x3894cc[0x0]['language']==_0x147f3a(0x251))var _0x34492a=users[_0x147f3a(0x251)];else{if(_0x3894cc[0x0]['language']==_0x147f3a(0x201))var _0x34492a=users[_0x147f3a(0x1c3)];else{if(_0x3894cc[0x0]['language']=='Chinese')var _0x34492a=users['Chinese'];else{if(_0x3894cc[0x0][_0x147f3a(0x29d)]=='Arabic\x20(ae)')var _0x34492a=users['Arabic'];}}}}}}}const _0x266f9=getRandom8DigitNumber();_0x266f9[_0x147f3a(0x1e3)](_0x567504=>{var _0x303f1e=_0x147f3a;_0x1fef99[_0x303f1e(0x1cc)](_0x303f1e(0x218),{'success':_0xcc2b6e[_0x303f1e(0x273)](_0x303f1e(0x1e9)),'errors':_0xcc2b6e[_0x303f1e(0x273)]('errors'),'role':_0x5538a1,'profile':_0x4811a4,'suppliers':_0x339967,'warehouse':_0x8a0fd8,'product':_0x3c0b40,'invoice':_0x567504,'master_shop':_0x3894cc,'language':_0x34492a,'find_data':_0x236803,'rooms_data':_0x43cc52});})['catch'](_0x3a6974=>{var _0x56a083=_0x147f3a;_0xcc2b6e['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x1fef99[_0x56a083(0x28a)](_0x56a083(0x1f8));});}catch(_0x266038){console[_0x147f3a(0x294)](_0x266038);}}),router[a0_0x32f878(0x1c0)](a0_0x32f878(0x2ba),auth,async(_0x126061,_0x43a486)=>{var _0x391524=a0_0x32f878;try{const _0x586478=_0x126061[_0x391524(0x269)]['id'];console['log'](_0x586478);const _0x14c2c9=await master_shop[_0x391524(0x2c7)]();console[_0x391524(0x294)](_0x391524(0x239),_0x14c2c9);const _0x3ba1fe=await product[_0x391524(0x284)]({'name':_0x586478});console[_0x391524(0x294)]('product',_0x3ba1fe),_0x43a486[_0x391524(0x253)](0xc8)[_0x391524(0x1ed)]({'product_data':_0x3ba1fe,'master':_0x14c2c9});}catch(_0x2cf912){console[_0x391524(0x294)](_0x391524(0x26b),_0x2cf912);}}),router[a0_0x32f878(0x217)](a0_0x32f878(0x202),auth,async(_0x5d27a9,_0x3c0139)=>{var _0x423903=a0_0x32f878;try{const {invoice:_0x3bdcbe,date:_0x2baebd,warehouse_name:_0x4f383b,prod_name:_0x427562,prod_code:_0x4d17a6,prod_qty:_0xa16085,prod_unit:_0x4ef889,prod_secondunit:_0x483b15,prod_level:_0x30b251,prod_isle:_0x56b926,prod_pallet:_0x253f56,note:_0xa3e08f,expiry_date:_0x5e4599,batch_code:_0x4e2f79,payable:_0x5a3b00,due_amount:_0x3aad2c,Room_name:_0x5865f5,primary_code:_0x4d2d69,secondary_code:_0x97d6bf,MaxStocks_data:_0x1b661a,PO_number:_0x13bb23,SCRN:_0x58affe,JO_number:_0x12584b}=_0x5d27a9[_0x423903(0x263)];if(typeof _0x427562==_0x423903(0x21b))var _0x5ba37c=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x229)]],_0x42cd5f=[_0x5d27a9['body'][_0x423903(0x26a)]],_0x12f80e=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x1eb)]],_0x407f41=[_0x5d27a9['body'][_0x423903(0x1bc)]],_0x3fa69a=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x232)]],_0x3a94f6=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x26d)]],_0x59af2f=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x206)]],_0x352f68=[_0x5d27a9[_0x423903(0x263)]['secondary_code']],_0x3ebd7c=[_0x5d27a9[_0x423903(0x263)]['MaxStocks_data']],_0x1e163b=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x2b3)]],_0x53cfe4=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x1c6)]],_0x463170=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x234)]],_0xbd5038=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x2ac)]],_0x527968=[_0x5d27a9['body'][_0x423903(0x275)]],_0x4624f2=[_0x5d27a9[_0x423903(0x263)]['prod_cat']],_0x31a85f=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x274)]],_0x537d37=[_0x5d27a9['body'][_0x423903(0x23d)]],_0x5edb09=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x2d7)]],_0xc04bb7=[_0x5d27a9[_0x423903(0x263)][_0x423903(0x2cf)]],_0x15a78a=[_0x5d27a9['body'][_0x423903(0x249)]];else var _0x5ba37c=[..._0x5d27a9[_0x423903(0x263)]['prod_name']],_0x42cd5f=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x26a)]],_0x12f80e=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x1eb)]],_0x407f41=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x1bc)]],_0x3fa69a=[..._0x5d27a9['body']['prod_secondunit']],_0x3a94f6=[..._0x5d27a9['body'][_0x423903(0x26d)]],_0x59af2f=[..._0x5d27a9['body'][_0x423903(0x206)]],_0x352f68=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x233)]],_0x3ebd7c=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x1df)]],_0x1e163b=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x2b3)]],_0x53cfe4=[..._0x5d27a9[_0x423903(0x263)]['expiry_date']],_0x463170=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x234)]],_0xbd5038=[..._0x5d27a9[_0x423903(0x263)]['alertQTY']],_0x527968=[..._0x5d27a9[_0x423903(0x263)]['production_date']],_0x4624f2=[..._0x5d27a9['body'][_0x423903(0x265)]],_0x31a85f=[..._0x5d27a9[_0x423903(0x263)]['RoomAssign']],_0x537d37=[..._0x5d27a9['body'][_0x423903(0x23d)]],_0x5edb09=[..._0x5d27a9['body'][_0x423903(0x2d7)]],_0xc04bb7=[..._0x5d27a9[_0x423903(0x263)][_0x423903(0x2cf)]],_0x15a78a=[..._0x5d27a9['body']['actual_uom']];const _0x4be379=_0x5ba37c[_0x423903(0x298)](_0x3b2eb2=>{return _0x3b2eb2={'product_name':_0x3b2eb2};});_0xc04bb7['forEach']((_0x10a9cd,_0x494fc6)=>{var _0x48a52d=_0x423903;_0x4be379[_0x494fc6]['actual_qty']=Math[_0x48a52d(0x28f)](_0x10a9cd);}),_0x15a78a[_0x423903(0x27f)]((_0x168775,_0x258183)=>{_0x4be379[_0x258183]['actual_uom']=_0x168775;}),_0x42cd5f[_0x423903(0x27f)]((_0x5a89da,_0x1b24c6)=>{_0x4be379[_0x1b24c6]['product_code']=_0x5a89da;}),_0x12f80e[_0x423903(0x27f)]((_0x58e900,_0x1d9582)=>{var _0x3eff21=_0x423903;_0x4be379[_0x1d9582][_0x3eff21(0x1f2)]=Math[_0x3eff21(0x28f)](_0x58e900);}),_0x407f41[_0x423903(0x27f)]((_0x1fc284,_0x14cfff)=>{var _0x1910bc=_0x423903;_0x4be379[_0x14cfff][_0x1910bc(0x29a)]=_0x1fc284;}),_0x3fa69a[_0x423903(0x27f)]((_0x4fbb8e,_0x5ee193)=>{_0x4be379[_0x5ee193]['secondary_unit']=_0x4fbb8e;}),_0x3a94f6[_0x423903(0x27f)]((_0x224f04,_0x2c4df5)=>{var _0x4a381a=_0x423903;_0x31a85f[_0x4a381a(0x27f)]((_0x48f608,_0x558959)=>{var _0xad7c14=_0x4a381a;if(_0x48f608==_0xad7c14(0x2b0)&&_0x2c4df5==_0x558959){console[_0xad7c14(0x294)](_0x48f608+_0xad7c14(0x1ff)+_0x2c4df5+_0xad7c14(0x1bd)+_0x558959+_0xad7c14(0x1bd)+_0x224f04);var _0x3607da=_0x224f04[_0xad7c14(0x2a5)](0x3);_0x4be379[_0x2c4df5][_0xad7c14(0x2cb)]=_0x224f04[0x0],_0x4be379[_0x2c4df5]['rack']=_0x224f04[0x1],_0x4be379[_0x2c4df5][_0xad7c14(0x2aa)]=0x0,_0x4be379[_0x2c4df5][_0xad7c14(0x2b8)]=0x0,_0x4be379[_0x2c4df5][_0xad7c14(0x1f5)]=_0xad7c14(0x219),_0x4be379[_0x2c4df5][_0xad7c14(0x292)]=_0x3607da;}else{if(_0x48f608==_0xad7c14(0x1de)&&_0x2c4df5==_0x558959){var _0x3607da=_0x224f04[_0xad7c14(0x2a5)](0x3);_0x4be379[_0x2c4df5][_0xad7c14(0x2cb)]=_0x224f04[0x0],_0x4be379[_0x2c4df5][_0xad7c14(0x1e2)]=_0x224f04[0x1],_0x4be379[_0x2c4df5]['bay']=0x0,_0x4be379[_0x2c4df5][_0xad7c14(0x2b8)]=0x0,_0x4be379[_0x2c4df5][_0xad7c14(0x1f5)]=_0xad7c14(0x219),_0x4be379[_0x2c4df5]['floorlevel']=_0x224f04[0x5];}else{if(_0x2c4df5==_0x558959){if(_0x224f04[0x0]=='A'&&_0x224f04[0x1]=='L'&&_0x224f04[0x2]=='L')console['log'](_0x48f608+'\x20<>\x20'+_0x2c4df5+_0xad7c14(0x1bd)+_0x558959+_0xad7c14(0x1bd)+_0x224f04+_0xad7c14(0x258)),_0x4be379[_0x2c4df5]['storage']=_0x224f04[0x0],_0x4be379[_0x2c4df5]['rack']=_0x224f04[0x1],_0x4be379[_0x2c4df5]['bay']=0x0,_0x4be379[_0x2c4df5][_0xad7c14(0x2b8)]=0x0,_0x4be379[_0x2c4df5][_0xad7c14(0x1f5)]=_0xad7c14(0x219),_0x4be379[_0x2c4df5][_0xad7c14(0x292)]=_0x224f04[0x3];else{var _0x5eec56;if(_0x224f04[0x4]=='L')_0x5eec56=_0xad7c14(0x1e6);else _0x224f04[0x4]=='F'&&(_0x5eec56=_0xad7c14(0x219));_0x4be379[_0x2c4df5][_0xad7c14(0x2cb)]=_0x224f04[0x0],_0x4be379[_0x2c4df5][_0xad7c14(0x1e2)]=_0x224f04[0x1],_0x4be379[_0x2c4df5]['bay']=_0x224f04[0x2],_0x4be379[_0x2c4df5]['bin']=_0x224f04[0x3],_0x4be379[_0x2c4df5][_0xad7c14(0x1f5)]=_0x5eec56,_0x4be379[_0x2c4df5]['floorlevel']=_0x224f04[0x5];}}}}});}),_0x59af2f['forEach']((_0x4b98b6,_0x55785c)=>{_0x4be379[_0x55785c]['primary_code']=_0x4b98b6;}),_0x352f68['forEach']((_0x3bbf9c,_0x51c242)=>{var _0x47b025=_0x423903;_0x4be379[_0x51c242][_0x47b025(0x233)]=_0x3bbf9c;}),_0x3ebd7c[_0x423903(0x27f)]((_0x313b52,_0x6767d2)=>{var _0x39ddfe=_0x423903;_0x4be379[_0x6767d2][_0x39ddfe(0x290)]=_0x313b52;}),_0x1e163b[_0x423903(0x27f)]((_0x3cac02,_0x496e50)=>{var _0x4ddf25=_0x423903;_0x4be379[_0x496e50][_0x4ddf25(0x2b3)]=_0x3cac02;}),_0x53cfe4['forEach']((_0x560558,_0x2147fb)=>{_0x4be379[_0x2147fb]['expiry_date']=_0x560558;}),_0x463170[_0x423903(0x27f)]((_0x37e521,_0x3c7ab6)=>{var _0xa6abfe=_0x423903;_0x4be379[_0x3c7ab6][_0xa6abfe(0x231)]=_0x37e521;}),_0xbd5038['forEach']((_0x16c0e5,_0x3682bd)=>{var _0x2523c5=_0x423903;_0x4be379[_0x3682bd][_0x2523c5(0x2ac)]=_0x16c0e5;}),_0x527968[_0x423903(0x27f)]((_0x3a500e,_0x462dda)=>{_0x4be379[_0x462dda]['production_date']=_0x3a500e;}),_0x4624f2['forEach']((_0x486bf4,_0x4b5b6e)=>{var _0x531792=_0x423903;_0x4be379[_0x4b5b6e][_0x531792(0x264)]=_0x486bf4;}),_0x31a85f['forEach']((_0x2f4e78,_0x4dffde)=>{var _0x8345e3=_0x423903;_0x4be379[_0x4dffde][_0x8345e3(0x2c3)]=_0x2f4e78;}),_0x537d37[_0x423903(0x27f)]((_0x3550ef,_0x4d1fd6)=>{_0x4be379[_0x4d1fd6]['delivery_code']=_0x3550ef;}),_0x5edb09[_0x423903(0x27f)]((_0x4db459,_0x3ca6b2)=>{var _0x214287=_0x423903;_0x4be379[_0x3ca6b2][_0x214287(0x278)]=_0x4db459;});const _0x25db24=_0x31a85f[_0x423903(0x298)](_0x1c8101=>{return _0x1c8101={'room_name':_0x1c8101};}),_0x41cccc=_0x4be379[_0x423903(0x2a3)](_0x535954=>_0x535954[_0x423903(0x1f2)]!=='0'&&_0x535954[_0x423903(0x1f2)]!==''),_0x2b3528=new purchases({'invoice':_0x3bdcbe,'suppliers':_0x5d27a9[_0x423903(0x263)][_0x423903(0x21d)],'date':_0x2baebd,'warehouse_name':_0x4f383b,'product':_0x41cccc,'note':_0xa3e08f,'due_amount':_0x3aad2c,'POnumber':_0x13bb23,'SCRN':_0x58affe,'JO_number':_0x12584b,'roomList':_0x25db24}),_0x2e1176=await _0x2b3528[_0x423903(0x207)](),_0x465fc5=await purchases[_0x423903(0x284)]({'invoice':_0x3bdcbe}),_0x2977cd=_0x465fc5[_0x423903(0x23c)][_0x423903(0x298)](async _0x3ef02f=>{var _0x14a4a6=_0x423903,_0x33d82d=await warehouse[_0x14a4a6(0x284)]({'name':_0x4f383b,'room':_0x3ef02f[_0x14a4a6(0x2c3)]}),_0x540248=0x0;return _0x33d82d[_0x14a4a6(0x1e8)][_0x14a4a6(0x27f)](_0x26874e=>{var _0x26195e=_0x14a4a6;_0x26874e[_0x26195e(0x1f6)]==_0x3ef02f[_0x26195e(0x1f6)]&&_0x26874e[_0x26195e(0x292)]==_0x3ef02f[_0x26195e(0x292)]&&_0x26874e[_0x26195e(0x1f5)]==_0x3ef02f[_0x26195e(0x1f5)]&&_0x26874e[_0x26195e(0x2b8)]==_0x3ef02f[_0x26195e(0x2b8)]&&_0x26874e[_0x26195e(0x2aa)]==_0x3ef02f[_0x26195e(0x2aa)]&&_0x26874e[_0x26195e(0x1e2)]==_0x3ef02f['rack']&&_0x26874e[_0x26195e(0x2cb)]==_0x3ef02f[_0x26195e(0x2cb)]&&_0x26874e[_0x26195e(0x1c6)]==_0x3ef02f[_0x26195e(0x1c6)]&&_0x26874e[_0x26195e(0x2b3)]==_0x3ef02f[_0x26195e(0x2b3)]&&_0x26874e[_0x26195e(0x275)]==_0x3ef02f[_0x26195e(0x275)]&&_0x26874e['invoice']==_0x465fc5[_0x26195e(0x278)]&&(_0x26874e[_0x26195e(0x1e1)]+=Math['abs'](_0x3ef02f[_0x26195e(0x1f2)]),_0x540248++);}),_0x540248===0x0&&_0x33d82d[_0x14a4a6(0x1e8)][_0x14a4a6(0x20f)]({'product_name':_0x3ef02f[_0x14a4a6(0x1f6)],'product_stock':Math[_0x14a4a6(0x28f)](_0x3ef02f[_0x14a4a6(0x1f2)]),'primary_code':_0x3ef02f[_0x14a4a6(0x206)],'secondary_code':_0x3ef02f[_0x14a4a6(0x233)],'product_code':_0x3ef02f[_0x14a4a6(0x2b1)],'storage':_0x3ef02f[_0x14a4a6(0x2cb)],'rack':_0x3ef02f[_0x14a4a6(0x1e2)],'bay':_0x3ef02f[_0x14a4a6(0x2aa)],'bin':_0x3ef02f['bin'],'type':_0x3ef02f[_0x14a4a6(0x1f5)],'floorlevel':_0x3ef02f[_0x14a4a6(0x292)],'maxProducts':_0x3ef02f['maxStocks'],'unit':_0x3ef02f[_0x14a4a6(0x29a)],'secondary_unit':_0x3ef02f[_0x14a4a6(0x1d1)],'expiry_date':_0x3ef02f[_0x14a4a6(0x1c6)],'maxPerUnit':_0x3ef02f[_0x14a4a6(0x231)],'batch_code':_0x3ef02f['batch_code'],'alertQTY':_0x3ef02f[_0x14a4a6(0x2ac)],'production_date':_0x3ef02f[_0x14a4a6(0x275)],'product_cat':_0x3ef02f[_0x14a4a6(0x264)],'invoice':_0x3ef02f['invoice'],'actual_qty':Math['abs'](_0x3ef02f[_0x14a4a6(0x2cf)]),'actual_uom':_0x3ef02f[_0x14a4a6(0x249)]}),_0x33d82d;});Promise['all'](_0x2977cd)[_0x423903(0x1e3)](async _0x5490ef=>{var _0xb61f69=_0x423903;try{for(const _0x1052ee of _0x5490ef){await _0x1052ee[_0xb61f69(0x207)]();}const _0x1d98bc=await master_shop[_0xb61f69(0x2c7)](),_0x183600=await email_settings[_0xb61f69(0x284)](),_0x543bcc=await supervisor_settings[_0xb61f69(0x2c7)]();var _0x17bf5f=_0x465fc5[_0xb61f69(0x23c)],_0x2da68b='',_0x450549;for(_0x450549 in _0x17bf5f){_0x2da68b+=_0xb61f69(0x1b7)+_0xb61f69(0x2c6)+_0x17bf5f[_0x450549][_0xb61f69(0x1f6)]+'</td>'+_0xb61f69(0x2c6)+_0x17bf5f[_0x450549][_0xb61f69(0x2b1)]+_0xb61f69(0x208)+_0xb61f69(0x2c6)+_0x17bf5f[_0x450549]['quantity']+_0xb61f69(0x208)+_0xb61f69(0x2c6)+_0x17bf5f[_0x450549]['standard_unit']+'</td>'+_0xb61f69(0x2c6)+_0x17bf5f[_0x450549][_0xb61f69(0x1d1)]+_0xb61f69(0x208)+_0xb61f69(0x2c6)+_0x465fc5[_0xb61f69(0x2cd)]+_0xb61f69(0x208)+_0xb61f69(0x2c6)+_0x17bf5f[_0x450549]['room_name']+_0xb61f69(0x208)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x17bf5f[_0x450549][_0xb61f69(0x2cb)]+_0x17bf5f[_0x450549][_0xb61f69(0x1e2)]+_0x17bf5f[_0x450549][_0xb61f69(0x2aa)]+_0x17bf5f[_0x450549]['bin']+_0x17bf5f[_0x450549][_0xb61f69(0x1f5)][0x0]+_0x17bf5f[_0x450549][_0xb61f69(0x292)]+'</td>',_0xb61f69(0x285);}let _0x76c044=nodemailer[_0xb61f69(0x2a7)]({'host':_0x183600[_0xb61f69(0x23b)],'port':Number(_0x183600[_0xb61f69(0x2d3)]),'secure':![],'auth':{'user':_0x183600[_0xb61f69(0x22f)],'pass':_0x183600[_0xb61f69(0x1f3)]}}),_0x33e590={'from':_0x183600[_0xb61f69(0x22f)],'to':_0x543bcc[0x0][_0xb61f69(0x1d9)],'subject':_0xb61f69(0x200),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0xb61f69(0x1c5)+_0x1d98bc[0x0][_0xb61f69(0x1cd)],'cid':'logo'}],'html':_0xb61f69(0x24d)+_0xb61f69(0x2c0)+'</head><body>'+_0xb61f69(0x260)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0xb61f69(0x27b)+_0xb61f69(0x1f9)+_0xb61f69(0x260)+_0xb61f69(0x1ef)+_0x1d98bc[0x0][_0xb61f69(0x259)]+_0xb61f69(0x1fd)+'</div>'+_0xb61f69(0x1f9)+_0xb61f69(0x1c4)+_0xb61f69(0x260)+_0xb61f69(0x242)+'\x20Order\x20Number\x20:\x20'+_0x465fc5[_0xb61f69(0x278)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xb61f69(0x241)+_0x465fc5[_0xb61f69(0x1d4)]+'\x20'+_0xb61f69(0x277)+'</h5>'+_0xb61f69(0x1f9)+_0xb61f69(0x1ca)+_0xb61f69(0x2d5)+_0xb61f69(0x1b7)+_0xb61f69(0x237)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0xb61f69(0x29b)+_0xb61f69(0x2c2)+_0xb61f69(0x214)+_0xb61f69(0x2ce)+_0xb61f69(0x2be)+_0xb61f69(0x220)+_0xb61f69(0x285)+'</thead>'+_0xb61f69(0x1fc)+'\x20'+_0x2da68b+'\x20'+_0xb61f69(0x213)+_0xb61f69(0x1d7)+'<div>'+_0xb61f69(0x25d)+'<h5>'+_0x1d98bc[0x0]['site_title']+_0xb61f69(0x21e)+_0xb61f69(0x1f9)+_0xb61f69(0x1f9)+_0xb61f69(0x2a2)};_0x76c044['sendMail'](_0x33e590,function(_0x531ed6,_0x5e61b4){var _0x4e510f=_0xb61f69;_0x531ed6?(console['log'](_0x531ed6),console[_0x4e510f(0x294)](_0x4e510f(0x2d4))):console['log']('Email\x20sent\x20successfully');}),_0x5d27a9[_0xb61f69(0x273)](_0xb61f69(0x1e9),_0xb61f69(0x22c)),_0x3c0139['redirect'](_0xb61f69(0x244));}catch(_0x1bd172){console[_0xb61f69(0x2a4)](_0x1bd172),_0x3c0139['status'](0x1f4)[_0xb61f69(0x1ed)]({'error':_0xb61f69(0x268)});}})[_0x423903(0x205)](_0x3b5248=>{var _0x2cabed=_0x423903;console[_0x2cabed(0x2a4)](_0x3b5248),_0x3c0139[_0x2cabed(0x253)](0x1f4)[_0x2cabed(0x1ed)]({'error':'An\x20error\x20occurred.'});});}catch(_0x6f9805){console['log'](_0x6f9805);}}),router[a0_0x32f878(0x1c0)](a0_0x32f878(0x21a),auth,async(_0x8a5af3,_0x1ee6ea)=>{var _0x3ac53e=a0_0x32f878;try{const {username:_0x2fbfe5,email:_0x7fe8cf,role:_0x49c3a0}=_0x8a5af3[_0x3ac53e(0x26e)],_0x4380d8=_0x8a5af3[_0x3ac53e(0x26e)],_0x211770=await profile[_0x3ac53e(0x284)]({'email':_0x4380d8['email']}),_0x554140=await master_shop[_0x3ac53e(0x2c7)](),_0x3d98ef=_0x8a5af3[_0x3ac53e(0x269)]['id'],_0x294228=await purchases[_0x3ac53e(0x26c)](_0x3d98ef),_0x554ae1=await warehouse[_0x3ac53e(0x224)]([{'$match':{'name':_0x294228[_0x3ac53e(0x2cd)],'room':_0x294228[_0x3ac53e(0x26f)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3ac53e(0x272),'name':{'$first':_0x3ac53e(0x22a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3ac53e(0x1fb)},'bin':{'$first':_0x3ac53e(0x20c)},'type':{'$first':_0x3ac53e(0x225)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3ac53e(0x1ee)},'secondary_code':{'$first':_0x3ac53e(0x271)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3ac53e(0x1fe)},'rack':{'$first':_0x3ac53e(0x2ae)},'expiry_date':{'$first':_0x3ac53e(0x1c8)}}}]),_0xcbb168=await customer[_0x3ac53e(0x2c7)]({});let _0x56d1c4;if(_0x4380d8[_0x3ac53e(0x270)]==_0x3ac53e(0x1e5)){const _0x161c6b=await staff[_0x3ac53e(0x284)]({'email':_0x4380d8[_0x3ac53e(0x22f)]});_0x56d1c4=await warehouse['aggregate']([{'$match':{'status':_0x3ac53e(0x1c7),'name':_0x161c6b[_0x3ac53e(0x2cc)]}},{'$group':{'_id':_0x3ac53e(0x267),'name':{'$first':'$name'}}}]);}else _0x56d1c4=await warehouse[_0x3ac53e(0x224)]([{'$match':{'status':_0x3ac53e(0x1c7)}},{'$group':{'_id':_0x3ac53e(0x267),'name':{'$first':_0x3ac53e(0x267)}}}]);const _0x1eb9ad=await product['find']({}),_0x3e17f1=await suppliers[_0x3ac53e(0x2c7)]({}),_0x4ba9ae=BayBinSelected(_0x294228[_0x3ac53e(0x2cd)],_0x294228[_0x3ac53e(0x26f)]);if(_0x554140[0x0][_0x3ac53e(0x29d)]==_0x3ac53e(0x1e4)){var _0x353e95=users[_0x3ac53e(0x262)];console[_0x3ac53e(0x294)](_0x353e95);}else{if(_0x554140[0x0][_0x3ac53e(0x29d)]==_0x3ac53e(0x2d6))var _0x353e95=users[_0x3ac53e(0x2d6)];else{if(_0x554140[0x0]['language']==_0x3ac53e(0x255))var _0x353e95=users[_0x3ac53e(0x255)];else{if(_0x554140[0x0][_0x3ac53e(0x29d)]==_0x3ac53e(0x1dd))var _0x353e95=users[_0x3ac53e(0x1dd)];else{if(_0x554140[0x0]['language']==_0x3ac53e(0x251))var _0x353e95=users[_0x3ac53e(0x251)];else{if(_0x554140[0x0][_0x3ac53e(0x29d)]==_0x3ac53e(0x201))var _0x353e95=users[_0x3ac53e(0x1c3)];else{if(_0x554140[0x0][_0x3ac53e(0x29d)]=='Chinese')var _0x353e95=users['Chinese'];else{if(_0x554140[0x0][_0x3ac53e(0x29d)]==_0x3ac53e(0x280))var _0x353e95=users[_0x3ac53e(0x1c2)];}}}}}}}_0x1ee6ea[_0x3ac53e(0x1cc)]('edit_purchases_view',{'success':_0x8a5af3['flash'](_0x3ac53e(0x1e9)),'errors':_0x8a5af3[_0x3ac53e(0x273)](_0x3ac53e(0x247)),'role':_0x4380d8,'profile':_0x211770,'customer':_0xcbb168,'warehouse':_0x56d1c4,'product':_0x554ae1,'user':_0x294228,'master_shop':_0x554140,'unit':_0x1eb9ad,'language':_0x353e95,'suppliers':_0x3e17f1,'dataSelected':_0x4ba9ae});}catch(_0x8c925f){console[_0x3ac53e(0x294)](_0x8c925f);}}),router[a0_0x32f878(0x217)](a0_0x32f878(0x21a),auth,async(_0x2d9764,_0x55d699)=>{var _0x665a11=a0_0x32f878;try{const _0xe70093=_0x2d9764[_0x665a11(0x269)]['id'],{invoice:_0x4ce2cc,warehouse_name:_0x3efeee,Room_name:_0x1f8b79}=_0x2d9764[_0x665a11(0x263)],_0x1456e2=await warehouse[_0x665a11(0x284)]({'name':_0x3efeee,'room':_0x1f8b79}),_0xe5ad2d=await purchases[_0x665a11(0x284)]({'invoice':_0x4ce2cc});_0xe5ad2d[_0x665a11(0x23c)][_0x665a11(0x27f)](_0x3b71bf=>{var _0x2fe6e5=_0x665a11,_0x31f6c3=0x0;const _0x531da0=_0x1456e2[_0x2fe6e5(0x1e8)]['map'](_0x3edada=>{var _0x21182f=_0x2fe6e5;_0x3edada[_0x21182f(0x1f6)]==_0x3b71bf[_0x21182f(0x1f6)]&&_0x3edada['floorlevel']==_0x3b71bf['floorlevel']&&_0x3edada['type']==_0x3b71bf[_0x21182f(0x1f5)]&&_0x3edada[_0x21182f(0x2b8)]==_0x3b71bf[_0x21182f(0x2b8)]&&_0x3edada['bay']==_0x3b71bf[_0x21182f(0x2aa)]&&_0x3edada[_0x21182f(0x1e2)]==_0x3b71bf[_0x21182f(0x1e2)]&&_0x3edada[_0x21182f(0x2cb)]==_0x3b71bf['storage']&&_0x3edada[_0x21182f(0x1c6)]==_0x3b71bf[_0x21182f(0x1c6)]&&_0x3edada['batch_code']==_0x3b71bf[_0x21182f(0x2b3)]&&_0x3edada['production_date']==_0x3b71bf[_0x21182f(0x275)]&&_0x3edada[_0x21182f(0x291)]==_0x3b71bf[_0x21182f(0x291)]&&_0x3edada[_0x21182f(0x281)]==_0x3b71bf[_0x21182f(0x281)]&&(_0x3edada[_0x21182f(0x1e1)]=parseInt(_0x3edada['product_stock'])+parseInt(_0x3b71bf[_0x21182f(0x1f2)]),_0x31f6c3++);});_0x31f6c3=='0'&&(_0x1456e2[_0x2fe6e5(0x1e8)]=_0x1456e2[_0x2fe6e5(0x1e8)]['concat']({'product_name':_0x3b71bf['product_name'],'product_stock':_0x3b71bf[_0x2fe6e5(0x1f2)],'primary_code':_0x3b71bf['primary_code'],'secondary_code':_0x3b71bf[_0x2fe6e5(0x233)],'product_code':_0x3b71bf[_0x2fe6e5(0x2b1)],'storage':_0x3b71bf['storage'],'rack':_0x3b71bf[_0x2fe6e5(0x1e2)],'bay':_0x3b71bf[_0x2fe6e5(0x2aa)],'bin':_0x3b71bf[_0x2fe6e5(0x2b8)],'type':_0x3b71bf[_0x2fe6e5(0x1f5)],'floorlevel':_0x3b71bf['floorlevel'],'maxProducts':_0x3b71bf[_0x2fe6e5(0x290)],'unit':_0x3b71bf[_0x2fe6e5(0x29a)],'secondary_unit':_0x3b71bf['secondary_unit'],'expiry_date':_0x3b71bf[_0x2fe6e5(0x1c6)],'maxPerUnit':_0x3b71bf['maxperunit'],'batch_code':_0x3b71bf[_0x2fe6e5(0x2b3)],'alertQTY':_0x3b71bf[_0x2fe6e5(0x2ac)],'production_date':_0x3b71bf[_0x2fe6e5(0x275)],'delivery_date':_0x3b71bf['delivery_date'],'delivery_code':_0x3b71bf['delivery_code']}));}),await _0x1456e2[_0x665a11(0x207)](),_0xe5ad2d[_0x665a11(0x21f)]=_0x665a11(0x2bf);const _0xd778c8=await _0xe5ad2d['save']();_0x2d9764[_0x665a11(0x273)](_0x665a11(0x1e9),_0x665a11(0x256)),_0x55d699[_0x665a11(0x28a)](_0x665a11(0x1f8));}catch(_0x58a549){console[_0x665a11(0x294)](_0x58a549);}}),router[a0_0x32f878(0x1c0)](a0_0x32f878(0x246),auth,async(_0x313463,_0x5db572)=>{var _0x3f73da=a0_0x32f878;try{const {username:_0x96e50e,email:_0x3dee61,role:_0x201dc2}=_0x313463['user'],_0x91d02c=_0x313463[_0x3f73da(0x26e)],_0x32d8bc=await profile[_0x3f73da(0x284)]({'email':_0x91d02c[_0x3f73da(0x22f)]}),_0x5e9bb4=await master_shop[_0x3f73da(0x2c7)](),_0x3af1d3=_0x313463[_0x3f73da(0x269)]['id'],_0x2e4044=await purchases['findById'](_0x3af1d3),_0x36dcaa=await suppliers[_0x3f73da(0x2c7)]({});let _0x59cbd7;if(_0x91d02c[_0x3f73da(0x270)]=='staff'){const _0x244dbc=await staff['findOne']({'email':_0x91d02c[_0x3f73da(0x22f)]});_0x59cbd7=await warehouse[_0x3f73da(0x2c7)]({'status':_0x3f73da(0x1c7),'name':_0x244dbc[_0x3f73da(0x2cc)],'warehouse_category':_0x3f73da(0x20b)});}else _0x59cbd7=await warehouse['aggregate']([{'$match':{'status':_0x3f73da(0x1c7),'warehouse_category':_0x3f73da(0x20b)}},{'$group':{'_id':_0x3f73da(0x267),'name':{'$first':_0x3f73da(0x267)}}}]);const _0x3e76aa=await product['find']({}),_0x1f7821=BayBinSelected(_0x2e4044[_0x3f73da(0x2cd)],_0x2e4044[_0x3f73da(0x26f)]);let _0x190a77=new Date(_0x2e4044[_0x3f73da(0x1c6)]),_0x3c9871=('0'+_0x190a77[_0x3f73da(0x1d5)]())[_0x3f73da(0x2a5)](-0x2),_0xd544bc=('0'+(_0x190a77[_0x3f73da(0x216)]()+0x1))['slice'](-0x2),_0x47c124=_0x190a77[_0x3f73da(0x289)](),_0x3b19a8=_0x47c124+'-'+_0xd544bc+'-'+_0x3c9871;if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x1e4)){var _0x59fcbd=users['English'];console[_0x3f73da(0x294)](_0x59fcbd);}else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]=='Hindi')var _0x59fcbd=users['Hindi'];else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x255))var _0x59fcbd=users['German'];else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x1dd))var _0x59fcbd=users[_0x3f73da(0x1dd)];else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x251))var _0x59fcbd=users[_0x3f73da(0x251)];else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x201))var _0x59fcbd=users[_0x3f73da(0x1c3)];else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x2a8))var _0x59fcbd=users[_0x3f73da(0x2a8)];else{if(_0x5e9bb4[0x0][_0x3f73da(0x29d)]==_0x3f73da(0x280))var _0x59fcbd=users[_0x3f73da(0x1c2)];}}}}}}}_0x5db572[_0x3f73da(0x1cc)]('edit_purchases',{'success':_0x313463[_0x3f73da(0x273)](_0x3f73da(0x1e9)),'errors':_0x313463[_0x3f73da(0x273)](_0x3f73da(0x247)),'role':_0x91d02c,'profile':_0x32d8bc,'purchases':_0x2e4044,'suppliers':_0x36dcaa,'warehouse':_0x59cbd7,'product':_0x3e76aa,'master_shop':_0x5e9bb4,'language':_0x59fcbd,'ed_fullDate':_0x3b19a8,'dataSelected':_0x1f7821});}catch(_0x352bdb){console[_0x3f73da(0x294)](_0x352bdb);}}),router[a0_0x32f878(0x217)]('/view/:id',auth,async(_0x45f51f,_0x341bc3)=>{var _0x193b1a=a0_0x32f878;try{const _0x18a249=_0x45f51f[_0x193b1a(0x269)]['id'],_0x1fff96=await purchases[_0x193b1a(0x284)]({'_id':_0x45f51f[_0x193b1a(0x269)]['id']}),_0x181249=await warehouse[_0x193b1a(0x284)]({'name':_0x1fff96[_0x193b1a(0x2cd)],'room':_0x1fff96[_0x193b1a(0x26f)]});_0x1fff96['product'][_0x193b1a(0x27f)](_0x518294=>{var _0x3c48a7=_0x193b1a;const _0x203132=_0x181249[_0x3c48a7(0x1e8)][_0x3c48a7(0x298)](_0x5ae23b=>{var _0x4bfa28=_0x3c48a7;_0x5ae23b[_0x4bfa28(0x1f6)]==_0x518294[_0x4bfa28(0x1f6)]&&_0x5ae23b[_0x4bfa28(0x292)]==_0x518294[_0x4bfa28(0x292)]&&_0x5ae23b[_0x4bfa28(0x1f5)]==_0x518294[_0x4bfa28(0x1f5)]&&_0x5ae23b['bin']==_0x518294['bin']&&_0x5ae23b[_0x4bfa28(0x2aa)]==_0x518294[_0x4bfa28(0x2aa)]&&_0x5ae23b[_0x4bfa28(0x1e2)]==_0x518294[_0x4bfa28(0x1e2)]&&_0x5ae23b[_0x4bfa28(0x2cb)]==_0x518294[_0x4bfa28(0x2cb)]&&(_0x5ae23b[_0x4bfa28(0x1e1)]=parseInt(_0x5ae23b['product_stock'])-parseInt(_0x518294[_0x4bfa28(0x1f2)]));});}),await _0x181249[_0x193b1a(0x207)]();const {invoice:_0x5287ca,suppliers:_0x392dea,date:_0x264bdd,warehouse_name:_0x1bfb5e,prod_name:_0x3e7735,prod_code:_0x3e7909,prod_qty:_0x2c0593,prod_unit:_0x1e74b3,prod_secondunit:_0x59e21f,prod_level:_0x137672,prod_isle:_0x396784,prod_pallet:_0x2c8287,note:_0x2ac5a1,expiry_date:_0x47d1e0,batch_code:_0xd860e1,paid_amount:_0x41d74a,due_amount:_0x4f6eab,Room_name:_0x1067ed,primary_code:_0x1b93e8,secondary_code:_0x4febab,PO_number:_0x13b7f8,JO_number:_0x5db72f}=_0x45f51f[_0x193b1a(0x263)];if(typeof _0x3e7735==_0x193b1a(0x21b))var _0x57bc39=[_0x45f51f['body'][_0x193b1a(0x229)]],_0xae68d2=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x26a)]],_0x4e72dd=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x226)]],_0x29524=[_0x45f51f['body'][_0x193b1a(0x1be)]],_0x1c34e9=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x232)]],_0x911192=[_0x45f51f[_0x193b1a(0x263)]['prod_level']],_0xfa32b2=[_0x45f51f['body'][_0x193b1a(0x222)]],_0x5d776b=[_0x45f51f['body'][_0x193b1a(0x276)]],_0x1b1003=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x206)]],_0xfaeee6=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x233)]],_0x45f0e4=[_0x45f51f['body'][_0x193b1a(0x1df)]],_0x3b5de1=[_0x45f51f['body'][_0x193b1a(0x2b3)]],_0x12d214=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x1c6)]],_0x46a84f=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x2cb)]],_0x57e294=[_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x1f7)]],_0x1e1843=[_0x45f51f[_0x193b1a(0x263)]['type']];else var _0x57bc39=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x229)]],_0xae68d2=[..._0x45f51f[_0x193b1a(0x263)]['prod_code']],_0x4e72dd=[..._0x45f51f['body'][_0x193b1a(0x226)]],_0x29524=[..._0x45f51f['body'][_0x193b1a(0x1be)]],_0x1c34e9=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x232)]],_0x911192=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x26d)]],_0xfa32b2=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x222)]],_0x5d776b=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x276)]],_0x1b1003=[..._0x45f51f['body'][_0x193b1a(0x206)]],_0xfaeee6=[..._0x45f51f['body'][_0x193b1a(0x233)]],_0x45f0e4=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x1df)]],_0x3b5de1=[..._0x45f51f[_0x193b1a(0x263)]['batch_code']],_0x12d214=[..._0x45f51f['body'][_0x193b1a(0x1c6)]],_0x46a84f=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x2cb)]],_0x57e294=[..._0x45f51f[_0x193b1a(0x263)]['rak']],_0x1e1843=[..._0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x1f5)]];const _0x3e05cd=_0x57bc39[_0x193b1a(0x298)](_0x59accd=>{return _0x59accd={'product_name':_0x59accd};});_0xae68d2[_0x193b1a(0x27f)]((_0x176780,_0x592cee)=>{var _0x8525eb=_0x193b1a;_0x3e05cd[_0x592cee][_0x8525eb(0x2b1)]=_0x176780;}),_0x4e72dd[_0x193b1a(0x27f)]((_0x342697,_0x358f76)=>{var _0x2424a1=_0x193b1a;_0x3e05cd[_0x358f76][_0x2424a1(0x1f2)]=_0x342697;}),_0x29524[_0x193b1a(0x27f)]((_0x555de8,_0x565395)=>{var _0x4d1cb9=_0x193b1a;_0x3e05cd[_0x565395][_0x4d1cb9(0x29a)]=_0x555de8;}),_0x1c34e9[_0x193b1a(0x27f)]((_0x5f50f5,_0x2bf773)=>{var _0x4833f0=_0x193b1a;_0x3e05cd[_0x2bf773][_0x4833f0(0x1d1)]=_0x5f50f5;}),_0x911192['forEach']((_0x2a298e,_0x12a9bf)=>{var _0x646a7b=_0x193b1a;_0x3e05cd[_0x12a9bf][_0x646a7b(0x2aa)]=_0x2a298e;}),_0xfa32b2['forEach']((_0x5457f6,_0x4601be)=>{var _0x5bb97f=_0x193b1a;_0x3e05cd[_0x4601be][_0x5bb97f(0x2b8)]=_0x5457f6;}),_0x5d776b[_0x193b1a(0x27f)]((_0x453b4d,_0x364326)=>{_0x3e05cd[_0x364326]['floorlevel']=_0x453b4d;}),_0x1b1003['forEach']((_0x21a567,_0x4513f9)=>{var _0x8548e8=_0x193b1a;_0x3e05cd[_0x4513f9][_0x8548e8(0x206)]=_0x21a567;}),_0xfaeee6[_0x193b1a(0x27f)]((_0x74cde8,_0x24f342)=>{var _0x948c92=_0x193b1a;_0x3e05cd[_0x24f342][_0x948c92(0x233)]=_0x74cde8;}),_0x45f0e4['forEach']((_0x47e59a,_0x142805)=>{var _0x4b43ef=_0x193b1a;_0x3e05cd[_0x142805][_0x4b43ef(0x290)]=_0x47e59a;}),_0x3b5de1[_0x193b1a(0x27f)]((_0xac25a,_0x4eee0a)=>{_0x3e05cd[_0x4eee0a]['batch_code']=_0xac25a;}),_0x12d214[_0x193b1a(0x27f)]((_0x14fc0c,_0x20cd30)=>{_0x3e05cd[_0x20cd30]['expiry_date']=_0x14fc0c;}),_0x1e1843[_0x193b1a(0x27f)]((_0x4cb905,_0x3b8629)=>{var _0x1c8b3f=_0x193b1a;_0x3e05cd[_0x3b8629][_0x1c8b3f(0x1f5)]=_0x4cb905;}),_0x46a84f[_0x193b1a(0x27f)]((_0x467942,_0x2f8378)=>{var _0x586d90=_0x193b1a;_0x3e05cd[_0x2f8378][_0x586d90(0x2cb)]=_0x467942;}),_0x57e294[_0x193b1a(0x27f)]((_0x27f2b7,_0xadee5)=>{var _0x141989=_0x193b1a;_0x3e05cd[_0xadee5][_0x141989(0x1e2)]=_0x27f2b7;});const _0x4480fe=_0x3e05cd[_0x193b1a(0x2a3)](_0x1ee143=>_0x1ee143[_0x193b1a(0x1f2)]!=='0'&&_0x1ee143[_0x193b1a(0x1f2)]!=='');_0x1fff96[_0x193b1a(0x278)]=_0x5287ca,_0x1fff96[_0x193b1a(0x21d)]=_0x392dea,_0x1fff96[_0x193b1a(0x1d4)]=_0x264bdd,_0x1fff96[_0x193b1a(0x2cd)]=_0x1bfb5e,_0x1fff96['product']=_0x4480fe,_0x1fff96[_0x193b1a(0x1ba)]=_0x2ac5a1,_0x1fff96['paid_amount']=_0x41d74a,_0x1fff96['due_amount']=_0x4f6eab,_0x1fff96[_0x193b1a(0x26f)]=_0x1067ed,_0x1fff96[_0x193b1a(0x227)]=_0x13b7f8,_0x1fff96['JO_number']=_0x5db72f;const _0x537fee=await _0x1fff96[_0x193b1a(0x207)](),_0xa439b9=await warehouse['findOne']({'name':_0x45f51f['body'][_0x193b1a(0x2cd)],'room':_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x295)]});_0x1fff96['product'][_0x193b1a(0x27f)](_0x1182f7=>{var _0x1bfe64=_0x193b1a,_0x218cc9=0x0;const _0x2c8726=_0xa439b9[_0x1bfe64(0x1e8)]['map'](_0x35c9f5=>{var _0x1db23a=_0x1bfe64;_0x35c9f5['product_name']==_0x1182f7[_0x1db23a(0x1f6)]&&_0x35c9f5[_0x1db23a(0x292)]==_0x1182f7[_0x1db23a(0x292)]&&_0x35c9f5[_0x1db23a(0x1f5)]==_0x1182f7[_0x1db23a(0x1f5)]&&_0x35c9f5['bin']==_0x1182f7['bin']&&_0x35c9f5[_0x1db23a(0x2aa)]==_0x1182f7[_0x1db23a(0x2aa)]&&_0x35c9f5[_0x1db23a(0x1e2)]==_0x1182f7['rack']&&_0x35c9f5[_0x1db23a(0x2cb)]==_0x1182f7[_0x1db23a(0x2cb)]&&(_0x35c9f5[_0x1db23a(0x1e1)]=parseInt(_0x35c9f5[_0x1db23a(0x1e1)])+parseInt(_0x1182f7[_0x1db23a(0x1f2)]),_0x218cc9++);});_0x218cc9=='0'&&(_0xa439b9[_0x1bfe64(0x1e8)]=_0xa439b9['product_details'][_0x1bfe64(0x24e)]({'product_name':_0x1182f7[_0x1bfe64(0x1f6)],'product_stock':_0x1182f7['quantity'],'primary_code':_0x1182f7[_0x1bfe64(0x206)],'secondary_code':_0x1182f7[_0x1bfe64(0x233)],'product_code':_0x1182f7[_0x1bfe64(0x2b1)],'storage':_0x1182f7['storage'],'rack':_0x1182f7[_0x1bfe64(0x1e2)],'bay':_0x1182f7[_0x1bfe64(0x2aa)],'bin':_0x1182f7[_0x1bfe64(0x2b8)],'type':_0x1182f7[_0x1bfe64(0x1f5)],'floorlevel':_0x1182f7[_0x1bfe64(0x292)],'maxProducts':_0x1182f7[_0x1bfe64(0x290)],'unit':_0x1182f7[_0x1bfe64(0x29a)],'secondary_unit':_0x1182f7['secondary_unit'],'expiry_date':_0x1182f7[_0x1bfe64(0x1c6)]}));}),await _0xa439b9[_0x193b1a(0x207)]();const _0x59c082=await s_payment_data['findOne']({'invoice':_0x45f51f[_0x193b1a(0x263)][_0x193b1a(0x278)]});if(_0x59c082===null){}else console[_0x193b1a(0x294)](_0x193b1a(0x21d),_0x59c082,_0x45f51f['body']['invoice']),_0x59c082[_0x193b1a(0x21d)]=_0x45f51f['body']['suppliers'],await _0x59c082[_0x193b1a(0x207)]();_0x45f51f[_0x193b1a(0x273)](_0x193b1a(0x1e9),_0x193b1a(0x2a1)),_0x341bc3[_0x193b1a(0x28a)](_0x193b1a(0x1f8));}catch(_0x1af0f9){console[_0x193b1a(0x294)](_0x1af0f9);}}),router[a0_0x32f878(0x217)](a0_0x32f878(0x297),auth,async(_0x38e8cd,_0x1dd43a)=>{var _0x5e3e60=a0_0x32f878;try{const _0x2bc99e=_0x38e8cd['params']['id'],{invoice:_0x48477e,suppliers:_0x4828e8,payable:_0x264bc0,due_amount:_0x41f3dc}=_0x38e8cd['body'],_0x1e2941=await purchases[_0x5e3e60(0x26c)](_0x2bc99e);var _0x491899=_0x264bc0-_0x41f3dc;_0x1e2941['paid_amount']=parseFloat(_0x1e2941[_0x5e3e60(0x2d1)])+parseFloat(_0x41f3dc),_0x1e2941[_0x5e3e60(0x22d)]=_0x491899;const _0x542bf9=await _0x1e2941[_0x5e3e60(0x207)]();console[_0x5e3e60(0x294)](_0x542bf9);const _0xa8dd9b=await s_payment_data[_0x5e3e60(0x284)]({'invoice':_0x48477e});_0xa8dd9b[_0x5e3e60(0x1ea)]=_0x491899,await _0xa8dd9b[_0x5e3e60(0x207)]();let _0x1b7acf=new Date(),_0x2c910e=('0'+_0x1b7acf['getDate']())[_0x5e3e60(0x2a5)](-0x2),_0x4d59eb=('0'+(_0x1b7acf[_0x5e3e60(0x216)]()+0x1))[_0x5e3e60(0x2a5)](-0x2),_0x4c6a05=_0x1b7acf[_0x5e3e60(0x289)](),_0x3e655e=_0x4c6a05+'-'+_0x4d59eb+'-'+_0x2c910e;const _0x1bc726=new suppliers_payment({'invoice':_0x48477e,'date':_0x4c6a05+'-'+_0x4d59eb+'-'+_0x2c910e,'suppliers':_0x4828e8,'reason':'Paid\x20For\x20Purchase','amount':_0x41f3dc}),_0x4c038c=await _0x1bc726['save']();_0x38e8cd['flash'](_0x5e3e60(0x1e9),_0x5e3e60(0x2b2)),_0x1dd43a[_0x5e3e60(0x28a)]('/all_purchases/view');}catch(_0x45bbdb){console[_0x5e3e60(0x294)](_0x45bbdb);}}),router['get'](a0_0x32f878(0x2c1),auth,async(_0x4791b7,_0x4b89c9)=>{var _0x56dffd=a0_0x32f878;try{const {username:_0x2de37d,email:_0x3d38b4,role:_0x3e2c71}=_0x4791b7['user'],_0x24658c=_0x4791b7['user'],_0x47a1f7=await profile['findOne']({'email':_0x24658c[_0x56dffd(0x22f)]}),_0x52788c=await master_shop['find']();console[_0x56dffd(0x294)](_0x56dffd(0x239),_0x52788c);const _0x10258a=_0x4791b7[_0x56dffd(0x269)]['id'],_0xd0ee32=await purchases[_0x56dffd(0x26c)](_0x10258a);console[_0x56dffd(0x294)](_0xd0ee32);const _0x3a0ccf=await suppliers[_0x56dffd(0x284)]({'name':_0xd0ee32['suppliers']});console[_0x56dffd(0x294)](_0x3a0ccf);if(_0x52788c[0x0][_0x56dffd(0x29d)]==_0x56dffd(0x1e4)){var _0x5ee702=users[_0x56dffd(0x262)];console[_0x56dffd(0x294)](_0x5ee702);}else{if(_0x52788c[0x0][_0x56dffd(0x29d)]==_0x56dffd(0x2d6))var _0x5ee702=users[_0x56dffd(0x2d6)];else{if(_0x52788c[0x0][_0x56dffd(0x29d)]==_0x56dffd(0x255))var _0x5ee702=users[_0x56dffd(0x255)];else{if(_0x52788c[0x0]['language']==_0x56dffd(0x1dd))var _0x5ee702=users[_0x56dffd(0x1dd)];else{if(_0x52788c[0x0]['language']==_0x56dffd(0x251))var _0x5ee702=users[_0x56dffd(0x251)];else{if(_0x52788c[0x0]['language']==_0x56dffd(0x201))var _0x5ee702=users['Portuguese'];else{if(_0x52788c[0x0][_0x56dffd(0x29d)]==_0x56dffd(0x2a8))var _0x5ee702=users[_0x56dffd(0x2a8)];else{if(_0x52788c[0x0][_0x56dffd(0x29d)]==_0x56dffd(0x280))var _0x5ee702=users[_0x56dffd(0x1c2)];}}}}}}}_0x4b89c9[_0x56dffd(0x1cc)]('purchase_invoice',{'success':_0x4791b7[_0x56dffd(0x273)](_0x56dffd(0x1e9)),'errors':_0x4791b7[_0x56dffd(0x273)](_0x56dffd(0x247)),'role':_0x24658c,'profile':_0x47a1f7,'master_shop':_0x52788c,'supplier':_0x3a0ccf,'purchase':_0xd0ee32,'language':_0x5ee702});}catch(_0x29040c){console[_0x56dffd(0x294)](_0x29040c);}}),router[a0_0x32f878(0x1c0)]('/view/return_purchase/:id',auth,async(_0x119c76,_0x268013)=>{var _0x182244=a0_0x32f878;try{const {username:_0x2829fe,email:_0x5dbf8b,role:_0x4af99d}=_0x119c76[_0x182244(0x26e)],_0x3dff7c=_0x119c76[_0x182244(0x26e)],_0x2d7ef2=await profile['findOne']({'email':_0x3dff7c[_0x182244(0x22f)]}),_0x21d896=await master_shop[_0x182244(0x2c7)]();console[_0x182244(0x294)](_0x182244(0x239),_0x21d896);const _0x592161=_0x119c76[_0x182244(0x269)]['id'];console[_0x182244(0x294)](_0x592161);const _0x42221e=await purchases[_0x182244(0x26c)](_0x592161);console['log'](_0x182244(0x287),_0x42221e);const _0x12a89a=await product[_0x182244(0x2c7)]({}),_0x14a996=await warehouse[_0x182244(0x224)]([{'$match':{'name':_0x42221e[_0x182244(0x2cd)],'room':_0x42221e[_0x182244(0x26f)],'warehouse_category':_0x182244(0x20b)}},{'$unwind':_0x182244(0x2bd)},{'$group':{'_id':_0x182244(0x272),'name':{'$first':_0x182244(0x22a)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x182244(0x1fb)},'bin':{'$first':_0x182244(0x20c)},'type':{'$first':_0x182244(0x225)},'floorlevel':{'$first':_0x182244(0x210)},'primary_code':{'$first':_0x182244(0x1ee)},'secondary_code':{'$first':_0x182244(0x271)},'product_code':{'$first':_0x182244(0x23f)},'storage':{'$first':_0x182244(0x1fe)},'rack':{'$first':_0x182244(0x2ae)}}}]);warehouse_data=await warehouse[_0x182244(0x224)]([{'$match':{'status':_0x182244(0x1c7),'name':_0x182244(0x1ce),'warehouse_category':_0x182244(0x20b)}},{'$group':{'_id':_0x182244(0x267),'name':{'$first':_0x182244(0x267)}}},{'$sort':{'name':0x1}}]),console[_0x182244(0x294)]('stock_data',_0x14a996);if(_0x21d896[0x0]['language']==_0x182244(0x1e4)){var _0x4fae0c=users['English'];console[_0x182244(0x294)](_0x4fae0c);}else{if(_0x21d896[0x0]['language']==_0x182244(0x2d6))var _0x4fae0c=users[_0x182244(0x2d6)];else{if(_0x21d896[0x0][_0x182244(0x29d)]==_0x182244(0x255))var _0x4fae0c=users[_0x182244(0x255)];else{if(_0x21d896[0x0][_0x182244(0x29d)]=='Spanish')var _0x4fae0c=users['Spanish'];else{if(_0x21d896[0x0][_0x182244(0x29d)]==_0x182244(0x251))var _0x4fae0c=users[_0x182244(0x251)];else{if(_0x21d896[0x0][_0x182244(0x29d)]==_0x182244(0x201))var _0x4fae0c=users[_0x182244(0x1c3)];else{if(_0x21d896[0x0][_0x182244(0x29d)]=='Chinese')var _0x4fae0c=users[_0x182244(0x2a8)];else{if(_0x21d896[0x0][_0x182244(0x29d)]=='Arabic\x20(ae)')var _0x4fae0c=users[_0x182244(0x1c2)];}}}}}}}_0x268013[_0x182244(0x1cc)](_0x182244(0x1d2),{'success':_0x119c76[_0x182244(0x273)]('success'),'errors':_0x119c76[_0x182244(0x273)](_0x182244(0x247)),'role':_0x3dff7c,'profile':_0x2d7ef2,'user':_0x42221e,'stock':_0x14a996,'master_shop':_0x21d896,'product':_0x12a89a,'language':_0x4fae0c,'warehouse':warehouse_data});}catch(_0x3dd3e1){console[_0x182244(0x294)](_0x3dd3e1);}}),router[a0_0x32f878(0x217)](a0_0x32f878(0x1e0),auth,async(_0x2ecb71,_0x104fab)=>{var _0xd9f421=a0_0x32f878;try{const {invoice:_0x1af9c6,date:_0x13fafc,warehouse_name:_0xdca91d,Room_name:_0x3721ea,product_name:_0x57ca9c,purchase_quantity:_0xc5eb2d,stocks:_0x72f5e9,return_qty:_0x254096,note:_0xb17242,level:_0x42b80f,isle:_0x2f1fa3,pallet:_0x5a676c,to_warehouse_name:_0x15652e,to_Room_name:_0x5924d2}=_0x2ecb71[_0xd9f421(0x263)],_0x1c98f1=await purchases[_0xd9f421(0x284)]({'_id':_0x2ecb71[_0xd9f421(0x269)]['id']}),_0x596b11=await warehouse[_0xd9f421(0x284)]({'name':_0xdca91d,'room':_0x3721ea});if(typeof _0x57ca9c==_0xd9f421(0x21b))var _0x32e41b=[_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x1f6)]],_0x9be1a1=[_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x1d6)]],_0xd93b15=[_0x2ecb71['body'][_0xd9f421(0x261)]],_0x16cb9e=[_0x2ecb71['body'][_0xd9f421(0x20a)]],_0x2035f6=[_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x243)]],_0x1cff5c=[_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x2b6)]],_0x53edc5=[_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x25a)]],_0x10328a=[_0x2ecb71['body'][_0xd9f421(0x2bc)]],_0x54e9f5=[_0x2ecb71['body'][_0xd9f421(0x27d)]],_0x573157=[_0x2ecb71['body']['primary_code_hide']],_0x11ce64=[_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x1cf)]];else var _0x32e41b=[..._0x2ecb71['body']['product_name']],_0x9be1a1=[..._0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x1d6)]],_0xd93b15=[..._0x2ecb71[_0xd9f421(0x263)]['stocks']],_0x16cb9e=[..._0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x20a)]],_0x2035f6=[..._0x2ecb71[_0xd9f421(0x263)]['level']],_0x1cff5c=[..._0x2ecb71['body']['isle']],_0x53edc5=[..._0x2ecb71['body'][_0xd9f421(0x25a)]],_0x10328a=[..._0x2ecb71['body']['types']],_0x54e9f5=[..._0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x27d)]],_0x573157=[..._0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x1ec)]],_0x11ce64=[..._0x2ecb71[_0xd9f421(0x263)]['secondary_code_hide']];const _0x3a86c3=_0x32e41b[_0xd9f421(0x298)](_0x3618f5=>{return _0x3618f5={'product_name':_0x3618f5};});_0x9be1a1[_0xd9f421(0x27f)]((_0x42cab7,_0x317218)=>{var _0x4c0c93=_0xd9f421;_0x3a86c3[_0x317218][_0x4c0c93(0x1d6)]=_0x42cab7;}),_0xd93b15[_0xd9f421(0x27f)]((_0x4fad4a,_0x69f521)=>{var _0x5e92e7=_0xd9f421;_0x3a86c3[_0x69f521][_0x5e92e7(0x279)]=_0x4fad4a;}),_0x16cb9e[_0xd9f421(0x27f)]((_0x3ca06e,_0x40550b)=>{var _0x3f487d=_0xd9f421;_0x3a86c3[_0x40550b][_0x3f487d(0x20a)]=_0x3ca06e;}),_0x2035f6[_0xd9f421(0x27f)]((_0x2fcfa1,_0x415fba)=>{var _0x5a1e82=_0xd9f421;_0x3a86c3[_0x415fba][_0x5a1e82(0x2aa)]=_0x2fcfa1;}),_0x1cff5c[_0xd9f421(0x27f)]((_0x5d0207,_0x3a6e69)=>{var _0x5dcd58=_0xd9f421;_0x3a86c3[_0x3a6e69][_0x5dcd58(0x2b8)]=_0x5d0207;}),_0x53edc5[_0xd9f421(0x27f)]((_0x5646cb,_0x34257e)=>{_0x3a86c3[_0x34257e]['floorlevel']=_0x5646cb;}),_0x10328a[_0xd9f421(0x27f)]((_0x28d121,_0x27c97e)=>{_0x3a86c3[_0x27c97e]['type']=_0x28d121;}),_0x54e9f5['forEach']((_0x589f90,_0x1e9a57)=>{var _0x1848a1=_0xd9f421;_0x3a86c3[_0x1e9a57][_0x1848a1(0x2b1)]=_0x589f90;}),_0x573157['forEach']((_0x48d77d,_0x2d15e2)=>{var _0x380783=_0xd9f421;_0x3a86c3[_0x2d15e2][_0x380783(0x206)]=_0x48d77d;}),_0x11ce64['forEach']((_0x1015af,_0x1e5077)=>{var _0x4ecd46=_0xd9f421;_0x3a86c3[_0x1e5077][_0x4ecd46(0x233)]=_0x1015af;}),_0x1c98f1[_0xd9f421(0x23c)][_0xd9f421(0x27f)](_0x4440fe=>{var _0x17ba5a=_0xd9f421;const _0x1a56e3=_0x596b11[_0x17ba5a(0x1e8)][_0x17ba5a(0x298)](_0x17a310=>{var _0x391059=_0x17ba5a;_0x17a310[_0x391059(0x1f6)]==_0x4440fe[_0x391059(0x1f6)]&&_0x17a310[_0x391059(0x292)]==_0x4440fe[_0x391059(0x292)]&&_0x17a310['type']==_0x4440fe[_0x391059(0x1f5)]&&_0x17a310[_0x391059(0x2b8)]==_0x4440fe[_0x391059(0x2b8)]&&_0x17a310['bay']==_0x4440fe['bay']&&_0x17a310[_0x391059(0x1e2)]==_0x4440fe['rack']&&_0x17a310[_0x391059(0x2cb)]==_0x4440fe[_0x391059(0x2cb)]&&(console['log'](parseInt(_0x17a310[_0x391059(0x1e1)])+_0x391059(0x1bd)+parseInt(_0x4440fe[_0x391059(0x1f2)])),_0x17a310[_0x391059(0x1e1)]=parseInt(_0x17a310[_0x391059(0x1e1)])+parseInt(_0x4440fe[_0x391059(0x1f2)]));});}),await _0x596b11[_0xd9f421(0x207)]();const _0x4d6a2a=_0x3a86c3[_0xd9f421(0x2a3)](_0x211efb=>_0x211efb[_0xd9f421(0x20a)]!=='0'&&_0x211efb['return_qty']!=='');var _0x32c804=0x0;_0x4d6a2a[_0xd9f421(0x27f)](_0x120e79=>{var _0x2ff294=_0xd9f421;console[_0x2ff294(0x294)]('foreach\x20newproduct',_0x120e79),(parseInt(_0x120e79[_0x2ff294(0x1d6)])<parseInt(_0x120e79['return_qty'])||parseInt(_0x120e79[_0x2ff294(0x279)])<parseInt(_0x120e79['return_qty']))&&_0x32c804++;});if(_0x32c804!=0x0)return _0x2ecb71[_0xd9f421(0x273)]('errors',_0xd9f421(0x2ad)),_0x104fab[_0xd9f421(0x28a)](_0xd9f421(0x1d3));const _0x1cde2b=new purchases_return({'invoice':_0x1af9c6,'suppliers':_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x21d)],'date':_0x13fafc,'warehouse_name':_0xdca91d,'return_product':_0x4d6a2a,'note':_0xb17242,'room':_0x3721ea,'to_warehouse_name':_0x15652e,'to_room':_0x5924d2}),_0x290104=await _0x1cde2b[_0xd9f421(0x207)]();console[_0xd9f421(0x294)](_0x1cde2b);const _0x4a9208=await purchases_return[_0xd9f421(0x284)]({'invoice':_0x1af9c6}),_0x18138f=await warehouse[_0xd9f421(0x284)]({'name':_0x15652e,'room':_0x5924d2});_0x4a9208[_0xd9f421(0x2d2)][_0xd9f421(0x27f)](_0x346460=>{var _0x1bbe9f=_0xd9f421,_0x4cde65=0x0;const _0x4f0d4c=_0x18138f[_0x1bbe9f(0x1e8)][_0x1bbe9f(0x298)](_0x3ebf8a=>{var _0x2105f5=_0x1bbe9f;_0x3ebf8a[_0x2105f5(0x1f6)]==_0x346460['product_name']&&_0x3ebf8a['floorlevel']==_0x346460[_0x2105f5(0x292)]&&_0x3ebf8a['type']==_0x346460[_0x2105f5(0x1f5)]&&_0x3ebf8a[_0x2105f5(0x2b8)]==_0x346460['bin']&&_0x3ebf8a[_0x2105f5(0x2aa)]==_0x346460[_0x2105f5(0x2aa)]&&(_0x3ebf8a['product_stock']=parseInt(_0x3ebf8a[_0x2105f5(0x1e1)])-parseInt(_0x346460[_0x2105f5(0x20a)]),_0x4cde65++);});_0x4cde65=='0'&&(_0x18138f['product_details']=_0x18138f['product_details']['concat']({'product_name':_0x346460[_0x1bbe9f(0x1f6)],'product_stock':_0x346460[_0x1bbe9f(0x20a)],'primary_code':_0x346460[_0x1bbe9f(0x206)],'secondary_code':_0x346460[_0x1bbe9f(0x233)],'product_code':_0x346460[_0x1bbe9f(0x2b1)],'storage':_0x346460[_0x1bbe9f(0x2cb)],'rack':_0x346460[_0x1bbe9f(0x1e2)],'bay':_0x346460[_0x1bbe9f(0x2aa)],'bin':_0x346460['bin'],'type':_0x346460[_0x1bbe9f(0x1f5)],'floorlevel':_0x346460[_0x1bbe9f(0x292)],'maxProducts':_0x346460['maxStocks'],'unit':_0x346460[_0x1bbe9f(0x29a)],'secondary_unit':_0x346460[_0x1bbe9f(0x1d1)],'expiry_date':_0x346460['expiry_date']}));}),await _0x18138f[_0xd9f421(0x207)]();const _0x2d049f=await purchases['findOne']({'invoice':_0x1af9c6});_0x2d049f[_0xd9f421(0x27a)]='True';const _0x2e567c=await _0x2d049f[_0xd9f421(0x207)](),_0x61125f=new s_payment_data({'invoice':_0x1af9c6,'suppliers':_0x2ecb71[_0xd9f421(0x263)][_0xd9f421(0x21d)],'reason':'Purchase\x20Return'});await _0x61125f['save']();const _0x39d643=await master_shop[_0xd9f421(0x2c7)]();console[_0xd9f421(0x294)]('add\x20post',_0x39d643[0x0][_0xd9f421(0x1cd)]);const _0xefb6e2=await email_settings[_0xd9f421(0x284)](),_0x2e0770=await suppliers[_0xd9f421(0x284)]({'name':_0x2ecb71['body'][_0xd9f421(0x21d)]});console[_0xd9f421(0x294)](_0xd9f421(0x236),_0x2e0770);_0x39d643[0x0][_0xd9f421(0x2a6)]==0x1?(right_currency=_0x39d643[0x0][_0xd9f421(0x230)],left_currency=''):(right_currency='',left_currency=_0x39d643[0x0][_0xd9f421(0x230)]);var _0x480b48=_0x32e41b,_0x27fec0=_0x16cb9e,_0x55502e='',_0x1f5514;for(_0x1f5514 in _0x480b48){_0x55502e+='<tr>'+_0xd9f421(0x2c6)+_0x480b48[_0x1f5514]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x27fec0[_0x1f5514]+_0xd9f421(0x208)+'</tr>';}console['log']('product_list',_0x55502e);let _0x340ff0=nodemailer['createTransport']({'service':_0xd9f421(0x2c4),'auth':{'user':_0xefb6e2[_0xd9f421(0x22f)],'pass':_0xefb6e2[_0xd9f421(0x1f3)]}}),_0x1b6f5f={'from':_0xefb6e2['email'],'to':_0x2e0770[_0xd9f421(0x22f)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0xd9f421(0x2b4),'path':__dirname+'/../public'+'/upload/'+_0x39d643[0x0][_0xd9f421(0x1cd)],'cid':_0xd9f421(0x211)}],'html':'<!DOCTYPE\x20html>'+_0xd9f421(0x2c0)+_0xd9f421(0x2b9)+_0xd9f421(0x260)+_0xd9f421(0x1da)+_0xd9f421(0x260)+_0xd9f421(0x27b)+_0xd9f421(0x1f9)+_0xd9f421(0x260)+_0xd9f421(0x1ef)+_0x39d643[0x0]['site_title']+_0xd9f421(0x1fd)+_0xd9f421(0x1f9)+_0xd9f421(0x1f9)+_0xd9f421(0x1c4)+_0xd9f421(0x260)+_0xd9f421(0x242)+'\x20Order\x20Number\x20:\x20'+_0x1af9c6+'\x20'+_0xd9f421(0x254)+'\x20Order\x20Date\x20:\x20'+_0x13fafc+'\x20'+_0xd9f421(0x277)+'</h5>'+_0xd9f421(0x1f9)+_0xd9f421(0x1ca)+_0xd9f421(0x2d5)+_0xd9f421(0x1b7)+_0xd9f421(0x237)+_0xd9f421(0x215)+_0xd9f421(0x2d8)+_0xd9f421(0x209)+_0xd9f421(0x285)+_0xd9f421(0x27c)+_0xd9f421(0x1fc)+'\x20'+_0x55502e+'\x20'+_0xd9f421(0x213)+_0xd9f421(0x1d7)+_0xd9f421(0x260)+_0xd9f421(0x25d)+_0xd9f421(0x1dc)+_0x39d643[0x0][_0xd9f421(0x259)]+_0xd9f421(0x21e)+'</div>'+_0xd9f421(0x1f9)+'</body></html>'};_0x340ff0[_0xd9f421(0x23e)](_0x1b6f5f,function(_0x93788e,_0x5c9f5e){var _0x2b1de0=_0xd9f421;_0x93788e?(console[_0x2b1de0(0x294)](_0x93788e),console[_0x2b1de0(0x294)](_0x2b1de0(0x2d4))):console[_0x2b1de0(0x294)](_0x2b1de0(0x2ab));}),_0x2ecb71[_0xd9f421(0x273)](_0xd9f421(0x1e9),_0xd9f421(0x221)),_0x104fab[_0xd9f421(0x28a)](_0xd9f421(0x1f8));}catch(_0x4cfa3b){console[_0xd9f421(0x294)](_0x4cfa3b),_0x104fab['status'](0xc8)[_0xd9f421(0x1ed)]({'message':_0x4cfa3b[_0xd9f421(0x250)]});}}),router[a0_0x32f878(0x1c0)]('/barcode/:id',auth,async(_0x42e74d,_0x3477fb)=>{var _0x2c27fd=a0_0x32f878;try{const {username:_0x2e88cb,email:_0x32f727,role:_0x2bab40}=_0x42e74d[_0x2c27fd(0x26e)],_0x14f508=_0x42e74d['user'],_0x1027ea=await profile[_0x2c27fd(0x284)]({'email':_0x14f508[_0x2c27fd(0x22f)]}),_0x4d2d7f=await master_shop[_0x2c27fd(0x2c7)](),_0x2c22d7=_0x42e74d[_0x2c27fd(0x269)]['id'],_0x33d6e5=await purchases[_0x2c27fd(0x26c)](_0x2c22d7);if(_0x4d2d7f[0x0][_0x2c27fd(0x29d)]==_0x2c27fd(0x1e4))var _0x34207b=users[_0x2c27fd(0x262)];else{if(_0x4d2d7f[0x0][_0x2c27fd(0x29d)]=='Hindi')var _0x34207b=users[_0x2c27fd(0x2d6)];else{if(_0x4d2d7f[0x0][_0x2c27fd(0x29d)]==_0x2c27fd(0x255))var _0x34207b=users[_0x2c27fd(0x255)];else{if(_0x4d2d7f[0x0][_0x2c27fd(0x29d)]==_0x2c27fd(0x1dd))var _0x34207b=users[_0x2c27fd(0x1dd)];else{if(_0x4d2d7f[0x0][_0x2c27fd(0x29d)]==_0x2c27fd(0x251))var _0x34207b=users['French'];else{if(_0x4d2d7f[0x0][_0x2c27fd(0x29d)]=='Portuguese\x20(BR)')var _0x34207b=users[_0x2c27fd(0x1c3)];else{if(_0x4d2d7f[0x0]['language']=='Chinese')var _0x34207b=users[_0x2c27fd(0x2a8)];else{if(_0x4d2d7f[0x0]['language']==_0x2c27fd(0x280))var _0x34207b=users[_0x2c27fd(0x1c2)];}}}}}}}_0x3477fb[_0x2c27fd(0x1cc)](_0x2c27fd(0x1b8),{'success':_0x42e74d[_0x2c27fd(0x273)](_0x2c27fd(0x1e9)),'errors':_0x42e74d[_0x2c27fd(0x273)](_0x2c27fd(0x247)),'role':_0x14f508,'profile':_0x1027ea,'alldata':_0x33d6e5,'master_shop':_0x4d2d7f,'language':_0x34207b}),console[_0x2c27fd(0x294)](alldata);}catch(_0x2da2ad){console[_0x2c27fd(0x294)](_0x2da2ad);}}),router['post'](a0_0x32f878(0x1c9),async(_0x1bcd9c,_0x3d6d4)=>{var _0x1052d8=a0_0x32f878;const {product_code:_0x952719}=_0x1bcd9c['body'];var _0x267df1;const _0x551fc=await product[_0x1052d8(0x224)]([{'$match':{'primary_code':_0x952719,'product_category':_0x1052d8(0x20b)}},{'$group':{'_id':'$_id','name':{'$first':_0x1052d8(0x267)},'category':{'$first':_0x1052d8(0x29c)},'brand':{'$first':_0x1052d8(0x20d)},'unit':{'$first':_0x1052d8(0x235)},'alertquantity':{'$first':_0x1052d8(0x2b5)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1052d8(0x24f)},'secondary_code':{'$first':_0x1052d8(0x238)},'maxStocks':{'$first':_0x1052d8(0x1fa)},'maxProdPerUnit':{'$first':_0x1052d8(0x299)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1052d8(0x1c1)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4ba4c0=await product['aggregate']([{'$match':{'secondary_code':_0x952719,'product_category':_0x1052d8(0x20b)}},{'$group':{'_id':_0x1052d8(0x20e),'name':{'$first':_0x1052d8(0x267)},'category':{'$first':_0x1052d8(0x29c)},'brand':{'$first':_0x1052d8(0x20d)},'unit':{'$first':_0x1052d8(0x235)},'alertquantity':{'$first':_0x1052d8(0x2b5)},'product_code':{'$first':_0x1052d8(0x1bf)},'primary_code':{'$first':_0x1052d8(0x24f)},'secondary_code':{'$first':_0x1052d8(0x238)},'maxStocks':{'$first':_0x1052d8(0x1fa)},'maxProdPerUnit':{'$first':_0x1052d8(0x299)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1052d8(0x1c1)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x551fc[_0x1052d8(0x25e)]>0x0)_0x267df1=_0x551fc;else _0x4ba4c0[_0x1052d8(0x25e)]>0x0&&(_0x267df1=_0x4ba4c0);_0x3d6d4[_0x1052d8(0x1ed)](_0x267df1);}),router[a0_0x32f878(0x217)](a0_0x32f878(0x1d8),async(_0x259514,_0x2742ab)=>{var _0x38dfd3=a0_0x32f878;const {primaryCode:_0x2db0f6,secondaryCode:_0xa7fdfd,productCode:_0x16eb5f,bay:_0x42889d,bin:_0x3a6225,types:_0x4d537c,pallet:_0xa0f58f,warehouses:_0x49b706,room:_0x4a09f5}=_0x259514[_0x38dfd3(0x263)];console[_0x38dfd3(0x294)](_0x259514[_0x38dfd3(0x263)]);try{const _0x1dd97e=await warehouse[_0x38dfd3(0x224)]([{'$match':{'name':_0x49b706,'room':_0x4a09f5}},{'$unwind':_0x38dfd3(0x2bd)},{'$match':{'product_details.bay':_0x42889d,'product_details.bin':_0x3a6225,'product_details.type':_0x4d537c}},{'$group':{'_id':_0x38dfd3(0x272),'name':{'$first':_0x38dfd3(0x22a)},'product_stock':{'$first':_0x38dfd3(0x2b7)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x38dfd3(0x240)},'pallet':{'$first':_0x38dfd3(0x29f)},'maxProducts':{'$first':_0x38dfd3(0x2c9)}}}]);_0x2742ab[_0x38dfd3(0x253)](0xc8)['json'](_0x1dd97e);}catch(_0x5e3006){_0x2742ab[_0x38dfd3(0x253)](0x194)[_0x38dfd3(0x1ed)]({'message':_0x5e3006[_0x38dfd3(0x250)]});}}),module[a0_0x32f878(0x22e)]=router;function a0_0x4139(){var _0x21283b=['sendMail','$product_details.product_code','$product_details.isle','\x20Order\x20Date\x20:\x20','<h5\x20style=\x22text-align:\x20left;\x22>','level','/all_purchases/view/','Rack\x20D','/view/:id','errors','$date','actual_uom','56oUdIbn','$product','$product.type','<!DOCTYPE\x20html>','concat','$primary_code','message','French','47PKaUeA','status','<span\x20style=\x22float:\x20right;\x22>','German','Sales\x20Update\x20successfully','$product.bin','here','site_title','pallet','Rack\x20C','name','<strong>\x20Regards\x20</strong>','length','1764970HgKWMK','<div>','stocks','English','body','product_cat','prod_cat','Enclosed','$name','An\x20error\x20occurred\x20while\x20saving\x20data.','params','prod_code','add_purchases\x20error','findById','prod_level','user','room','role','$product_details.secondary_code','$product_details._id','flash','RoomAssign','production_date','prod_pallet','</span>','invoice','stock_quantity','return_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</thead>','product_code_hide','2096622EKSZWM','forEach','Arabic\x20(ae)','delivery_code','407820gQjnWh','COLD\x20STORAGE','findOne','</tr>','$due_amount','user_id','$finalize','getFullYear','redirect','$product.quantity','$invoice','$note','$paid_amount','abs','maxStocks','delivery_date','floorlevel','padStart','log','Room_name','Rack\x20A','/give_payment/:id','map','$maxProdPerUnit','standard_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$category','language','$suppliers_docs','$product_details.pallet','../models/all_models','purchase\x20data\x20update\x20successfully','</body></html>','filter','error','slice','currency_placement','createTransport','Chinese','table\x20page','bay','Email\x20sent\x20successfully','alertQTY','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product_details.rack','ejs','Receiving\x20Area','product_code','payment\x20successfull','batch_code','Logo.png','$alertquantity','isle','$product_details.product_stock','bin','</head><body>','/view/add_purchases/:id','/view','types','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','True','<html><head><title></title>','/invoice/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','room_name','gmail','$return_data','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','find','346312txJVlD','$product_details.maxProducts','$warehouse_name','storage','warehouse','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','actual_qty','$expiry_date','paid_amount','return_product','port','Error\x20Occurs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Hindi','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$suppliers','DRY\x20STORAGE','../middleware/auth','<tr>','all_purchases_barcode','Rack\x20B','note','floor','prod_primunit','\x20<>\x20','prod_unit','$product_code','get','$secondary_unit','Arabic','Portuguese','<hr\x20class=\x22my-3\x22>','/upload/','expiry_date','Enabled','$product_details.expiry_date','/barcode_scanner','<table\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers_docs','render','image','Return\x20Goods','secondary_code_hide','$product.room_name','secondary_unit','return_purchase','back','date','getDate','purchase_quantity','</table>','/CheckingWarehouse','RMSEmail','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Rack\x20E','<h5>','Spanish','Shelves','MaxStocks_data','/view/return_purchase/:id','product_stock','rack','then','English\x20(US)','staff','Level','4092808ZRwagw','product_details','success','amount','prod_Qty','primary_code_hide','json','$product_details.primary_code','<h2>\x20','38314HNwKBi','$product.bay','quantity','password','$batch_code','type','product_name','rak','/all_purchases/view','</div>','$maxStocks','$product_details.bay','<tbody\x20style=\x22text-align:\x20center;\x22>','\x20</h2>','$product_details.storage','\x20<\x20wew\x20>\x20','Purchase\x20Mail','Portuguese\x20(BR)','/view/add_purchases','$room','2041827JWSDhG','catch','primary_code','save','</td>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','return_qty','Raw\x20Materials','$product_details.bin','$brand','$_id','push','$product_details.floorlevel','logo','all_purchases','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','getMonth','post','add_purchases','Floor','/preview/:id','string','path','suppliers','</h5>','finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','purchases\x20item\x20return\x20successfull','prod_isle','Rack\x20F','aggregate','$product_details.type','prod_qty','POnumber','INC-','prod_name','$product_details.product_name','random','Purchase\x20data\x20added\x20successfully','due_amount','exports','email','currency','maxperunit','prod_secondunit','secondary_code','max_product_unit','$unit','suppliers_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$secondary_code','master','$product.floorlevel','host','product','deliverycode'];a0_0x4139=function(){return _0x21283b;};return a0_0x4139();}