var a0_0x3bb1a7=a0_0xc1c9;function a0_0xc1c9(_0x4b28c2,_0x10ecf5){var _0x7f0d88=a0_0x7f0d();return a0_0xc1c9=function(_0xc1c9e7,_0x188ec8){_0xc1c9e7=_0xc1c9e7-0xd2;var _0x42fe59=_0x7f0d88[_0xc1c9e7];return _0x42fe59;},a0_0xc1c9(_0x4b28c2,_0x10ecf5);}(function(_0xe742a3,_0x5710e){var _0x2a1c93=a0_0xc1c9,_0x4cd3bb=_0xe742a3();while(!![]){try{var _0x172db3=parseInt(_0x2a1c93(0x1bd))/0x1*(-parseInt(_0x2a1c93(0x11d))/0x2)+parseInt(_0x2a1c93(0x1c2))/0x3+-parseInt(_0x2a1c93(0x151))/0x4*(parseInt(_0x2a1c93(0x107))/0x5)+-parseInt(_0x2a1c93(0x12e))/0x6*(-parseInt(_0x2a1c93(0x1ae))/0x7)+-parseInt(_0x2a1c93(0x123))/0x8+-parseInt(_0x2a1c93(0x11a))/0x9+-parseInt(_0x2a1c93(0x1b3))/0xa*(-parseInt(_0x2a1c93(0x1e0))/0xb);if(_0x172db3===_0x5710e)break;else _0x4cd3bb['push'](_0x4cd3bb['shift']());}catch(_0x3e76ae){_0x4cd3bb['push'](_0x4cd3bb['shift']());}}}(a0_0x7f0d,0x32bf0));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x3bb1a7(0xf6)),auth=require(a0_0x3bb1a7(0x150)),nodemailer=require(a0_0x3bb1a7(0x17f));var ejs=require(a0_0x3bb1a7(0x1bf));const path=require('path'),users=require(a0_0x3bb1a7(0x144));router[a0_0x3bb1a7(0x111)](a0_0x3bb1a7(0x1af),auth,async(_0x521eeb,_0x2f7fae)=>{var _0x54382a=a0_0x3bb1a7;try{const {username:_0x1b3ad4,email:_0x14080a,role:_0x3ebcfc}=_0x521eeb[_0x54382a(0x12f)],_0x13f24a=_0x521eeb['user'],_0x1d2b21=await profile[_0x54382a(0x10e)]({'email':_0x13f24a[_0x54382a(0x197)]}),_0x1cea6a=await staff[_0x54382a(0x10e)]({'email':_0x13f24a['email']});if(_0x13f24a[_0x54382a(0xd6)]==_0x54382a(0x108)){const _0x382d7e=await staff['findOne']({'email':_0x13f24a['email']});}const _0x512189=await master_shop['find']();let _0x3cbfb5;if(_0x13f24a[_0x54382a(0xd6)]=='staff'){const _0xde62c4=await staff[_0x54382a(0x10e)]({'email':_0x13f24a[_0x54382a(0x197)]});_0x3cbfb5=await purchases[_0x54382a(0xfa)]([{'$match':{'warehouse_name':_0xde62c4[_0x54382a(0xed)]}},{'$lookup':{'from':_0x54382a(0x14a),'localField':_0x54382a(0x14a),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x54382a(0x15c)},{'$unwind':_0x54382a(0x189)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x54382a(0x106)},'date':{'$first':_0x54382a(0x174)},'warehouse_name':{'$first':_0x54382a(0xe4)},'room':{'$first':_0x54382a(0x1c3)},'product':{'$push':_0x54382a(0x189)},'note':{'$first':_0x54382a(0x13b)},'paid_amount':{'$first':_0x54382a(0x110)},'due_amount':{'$first':_0x54382a(0x190)},'return_data':{'$first':_0x54382a(0x185)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x54382a(0x1be)},'suppliers_docs':{'$first':_0x54382a(0x15c)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x54382a(0x154)},'isle':{'$addToSet':_0x54382a(0x1b6)},'type':{'$addToSet':_0x54382a(0xd7)},'floorlevel':{'$addToSet':_0x54382a(0x14b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3cbfb5=await purchases['aggregate']([{'$lookup':{'from':_0x54382a(0x14a),'localField':_0x54382a(0x14a),'foreignField':_0x54382a(0xfb),'as':_0x54382a(0x145)}},{'$unwind':_0x54382a(0x15c)},{'$unwind':_0x54382a(0x189)},{'$group':{'_id':_0x54382a(0x135),'invoice':{'$first':_0x54382a(0x152)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x54382a(0x174)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x54382a(0x189)},'note':{'$first':_0x54382a(0x13b)},'paid_amount':{'$first':_0x54382a(0x110)},'due_amount':{'$first':_0x54382a(0x190)},'return_data':{'$first':_0x54382a(0x185)},'batch_code':{'$first':_0x54382a(0x1ce)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x54382a(0x15c)},'total_product_quantity':{'$sum':_0x54382a(0xf5)},'level':{'$addToSet':_0x54382a(0x154)},'isle':{'$addToSet':_0x54382a(0x1b6)},'type':{'$addToSet':_0x54382a(0xd7)},'floorlevel':{'$addToSet':_0x54382a(0x14b)},'finalize':{'$first':_0x54382a(0x18c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x512189[0x0][_0x54382a(0xdd)]==_0x54382a(0x159)){var _0x5685ee=users[_0x54382a(0x16a)];console[_0x54382a(0xef)](_0x5685ee);}else{if(_0x512189[0x0][_0x54382a(0xdd)]==_0x54382a(0xe5))var _0x5685ee=users['Hindi'];else{if(_0x512189[0x0][_0x54382a(0xdd)]==_0x54382a(0x1b4))var _0x5685ee=users[_0x54382a(0x1b4)];else{if(_0x512189[0x0][_0x54382a(0xdd)]==_0x54382a(0x1c9))var _0x5685ee=users[_0x54382a(0x1c9)];else{if(_0x512189[0x0][_0x54382a(0xdd)]=='French')var _0x5685ee=users['French'];else{if(_0x512189[0x0]['language']==_0x54382a(0x1cd))var _0x5685ee=users['Portuguese'];else{if(_0x512189[0x0][_0x54382a(0xdd)]=='Chinese')var _0x5685ee=users[_0x54382a(0x119)];else{if(_0x512189[0x0][_0x54382a(0xdd)]==_0x54382a(0x1ca))var _0x5685ee=users[_0x54382a(0x13d)];}}}}}}}_0x2f7fae[_0x54382a(0x1c7)]('all_purchases',{'success':_0x521eeb['flash'](_0x54382a(0x141)),'errors':_0x521eeb[_0x54382a(0xe7)](_0x54382a(0x172)),'purchases':_0x3cbfb5,'role':_0x13f24a,'profile':_0x1d2b21,'master_shop':_0x512189,'language':_0x5685ee});}catch(_0x1314b0){console['log']('table\x20page',_0x1314b0),_0x2f7fae[_0x54382a(0x175)](0xc8)['json']({'message':_0x1314b0[_0x54382a(0x153)]});}});function a0_0x7f0d(){var _0x494878=['/preview/:id','bay','Chinese','2802492SAJJpo','</td>','$product_details.bay','76fASyWF','invoice','add\x20post','/invoice/:id','Raw\x20Materials','Logo.png','2629080pswUeY','$maxProdPerUnit','$secondary_unit','prod_pallet','filter','map','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Level','body','delivery_date','/view/add_purchases','18gZYyTG','user','<!DOCTYPE\x20html>','<h5\x20style=\x22text-align:\x20left;\x22>','\x20<\x20wew\x20>\x20','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$_id','JO_number','</head><body>','rak','/upload/','product_details','$note','Room_name','Arabic','/CheckingWarehouse','/all_purchases/view','json','success','$product_details.secondary_code','foreach\x20newproduct','../public/language/languages.json','suppliers_docs','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','image','return_qty','push','suppliers','$product.floorlevel','alertQTY','find','/barcode/:id','$maxStocks','../middleware/auth','8EnpJWM','$invoice','message','$product.bay','deliverycode','RMSEmail','DRY\x20STORAGE','return_purchase','English\x20(US)','French','prod_invoice','$suppliers_docs','Enclosed','purchases\x20item\x20return\x20successfull','product_list','stock_quantity','actual_uom','rack','</tr>','purchase\x20data\x20update\x20successfully','floorlevel','actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','True','$product_details.primary_code','English','<html><head><title></title>','post','Enabled','Rack\x20B','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','params','errors','secondary_unit','$date','status','purchase_quantity','/../public','all','pallet','$product_details.type','$product_code','\x20</h2>','<hr\x20class=\x22my-3\x22>','\x20<>\x20','nodemailer','</h5>','Purchase\x20Return','slice','max_product_unit','$product_details.pallet','$return_data','error','Shelves','Floor','$product','amount','<h5>','$finalize','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Rack\x20F','stock_data','$due_amount','stocks','prod_level','prod_name','secondary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','payment\x20successfull','email','Paid\x20For\x20Purchase','prod_primunit','</thead>','level','prod_qty','prod_secondunit','product_code_hide','string','product_stock','\x20Order\x20Number\x20:\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$primary_code','Email\x20sent\x20successfully','$product_details.rack','return_data','paid_amount','Rack\x20A','storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','delivery_code','</div>','$product_details.storage','870569cCRGLI','/view','RoomAssign','product_name','site_title','3060740fqFmFL','German','</tbody>','$product.bin','room_name','isle','</span>','$product_details','$product_details.level','catch','605HXFTbr','$expiry_date','ejs','padStart','$alertquantity','617556etGiPv','$room','createTransport','warehouse_name','</table>','render','/barcode_scanner','Spanish','Arabic\x20(ae)','quantity','prod_Qty','Portuguese\x20(BR)','$batch_code','$product_details.isle','product_cat','Error\x20Occurs','length','<div>','<span\x20style=\x22float:\x20right;\x22>','type','forEach','production_date','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$brand','finalize','getMonth','$unit','$product_details.product_name','primary_code','$product_details.expiry_date','11rHeTKf','/all_purchases/view/','getDate','prod_isle','edit_purchases_view','primary_code_hide','$product_details.maxProducts','maxStocks','types','then','note','redirect','$product_details.floorlevel','MaxStocks_data','role','$product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view/add_purchases/:id','Return\x20Goods','due_amount','concat','language','bin','password','save','findById','exports','gmail','$warehouse_name','Hindi','product','flash','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.product_code','expiry_date','logo','warehouse','standard_unit','log','abs','Receiving\x20Area','prod_cat','$name','floor','$product.quantity','../models/all_models','An\x20error\x20occurred\x20while\x20saving\x20data.','edit_purchases','prod_unit','aggregate','name','POnumber','$secondary_code','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/view/return_purchase/:id','An\x20error\x20occurred.','$category','batch_code','master','room','$suppliers','35395LIIXxs','staff','prod_code','currency_placement','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.bin','maxperunit','findOne','Sales\x20Update\x20successfully','$paid_amount','get','currency','product_code','$product_details.product_stock','Purchase\x20Return\x20Mail','getFullYear'];a0_0x7f0d=function(){return _0x494878;};return a0_0x7f0d();}function BayBinSelected(_0x514467,_0x3d1bb7){var _0x58d7e5=a0_0x3bb1a7,_0x156f7b=[],_0x463f6e=[],_0x3f84c8=[],_0x475c65=[],_0x161212=[],_0x430161=[];let _0x7eac92=[];if(_0x514467==_0x58d7e5(0x157))switch(_0x3d1bb7){case _0x58d7e5(0x1a8):_0x156f7b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x463f6e=[0x1,0x2],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=[_0x58d7e5(0x12a),_0x58d7e5(0x188)],_0x161212=['D'],_0x430161=['A'];break;case _0x58d7e5(0x16e):_0x156f7b=[0x6,0x5,0x4,0x3,0x2,0x1],_0x463f6e=[0x1,0x2],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=[_0x58d7e5(0x12a),_0x58d7e5(0x188)],_0x161212=['D'],_0x430161=['B'];break;case _0x58d7e5(0x187):_0x156f7b=[0x0],_0x463f6e=[0x0],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=['Floor'],_0x161212=['D'],_0x430161=['S'];break;case'Receiving\x20Area':_0x156f7b=[0x0],_0x463f6e=[0x0],_0x475c65=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3f84c8=['Floor'],_0x161212=['D'],_0x430161=['R'];break;}else{if(_0x514467=='COLD\x20STORAGE')switch(_0x3d1bb7){case'Rack\x20A':_0x156f7b=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x463f6e=['B','F'],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=[_0x58d7e5(0x12a),_0x58d7e5(0x188)],_0x161212=['C'],_0x430161=['A'];break;case _0x58d7e5(0x16e):_0x156f7b=[0x5,0x4,0x3,0x2,0x1],_0x463f6e=['F','B','S'],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=['Level',_0x58d7e5(0x188)],_0x161212=['C'],_0x430161=['B'];break;case'Rack\x20C':_0x156f7b=[0x1,0x2,0x3,0x4,0x5],_0x463f6e=['B','F','S'],_0x475c65=[0x5,0x4,0x3,0x2,0x1],_0x3f84c8=[_0x58d7e5(0x12a),_0x58d7e5(0x188)],_0x161212=['C'],_0x430161=['C'];break;case'Rack\x20D':_0x156f7b=[0x5,0x4,0x3,0x2,0x1],_0x463f6e=['F','B','S'],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=[_0x58d7e5(0x12a),'Floor'],_0x161212=['C'],_0x430161=['D'];break;case'Rack\x20E':_0x156f7b=[0x4,0x3,0x2,0x1],_0x463f6e=[0x1,0x2],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=['Level',_0x58d7e5(0x188)],_0x161212=['C'],_0x430161=['E'];break;case _0x58d7e5(0x18e):_0x156f7b=[0x1,0x2,0x3],_0x463f6e=[0x1,0x2],_0x475c65=[0x1,0x2,0x3,0x4,0x5],_0x3f84c8=['Level'],_0x161212=['C'],_0x430161=['F'];break;}}return{'levels':_0x156f7b,'Isle':_0x463f6e,'rack':_0x475c65,'type':_0x3f84c8,'storage':_0x161212,'rak':_0x430161};}async function getRandom8DigitNumber(){var _0xdebf7b=a0_0x3bb1a7;const _0x5856b9=0x989680,_0x519eaf=0x5f5e0ff,_0x3550fb=Math[_0xdebf7b(0xf4)](Math['random']()*(_0x519eaf-_0x5856b9+0x1))+_0x5856b9;var _0x7eeffa;const _0x4de171=await purchases[_0xdebf7b(0x10e)]({'invoice':'INC-'+_0x3550fb});return _0x4de171&&_0x4de171['length']>0x0?_0x7eeffa='INC-'+_0x3550fb:_0x7eeffa='INC-'+_0x3550fb,_0x7eeffa;}router[a0_0x3bb1a7(0x111)](a0_0x3bb1a7(0x12d),auth,async(_0x33f8cd,_0xbd7b9b)=>{var _0x4d627e=a0_0x3bb1a7;try{const {username:_0x6e1b90,email:_0x5332c2,role:_0x2e86de}=_0x33f8cd['user'],_0x1a440a=_0x33f8cd['user'],_0x54901c=await profile[_0x4d627e(0x10e)]({'email':_0x1a440a['email']}),_0x497a38=await master_shop[_0x4d627e(0x14d)](),_0x26251a=await staff['findOne']({'email':_0x1a440a[_0x4d627e(0x197)]}),_0x5733c9=await suppliers[_0x4d627e(0x14d)]({});let _0x1004ca;if(_0x1a440a[_0x4d627e(0xd6)]==_0x4d627e(0x108)){const _0x4f37d5=await staff[_0x4d627e(0x10e)]({'email':_0x1a440a[_0x4d627e(0x197)]});_0x1004ca=await warehouse[_0x4d627e(0xfa)]([{'$match':{'status':_0x4d627e(0x16d),'name':_0x4f37d5[_0x4d627e(0xed)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x4d627e(0xf3)}}}]);}else _0x1004ca=await warehouse[_0x4d627e(0xfa)]([{'$match':{'status':'Enabled','warehouse_category':_0x4d627e(0x121),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x4ac9df=await product['find']({}),_0x4860f3=await warehouse['find']({'status':'Enabled'}),_0xdc4bcf=await purchases[_0x4d627e(0x14d)]({}),_0x702891=_0xdc4bcf[_0x4d627e(0x1d2)]+0x1,_0x4f8d3e='INC-'+_0x702891['toString']()[_0x4d627e(0x1c0)](0x5,'0');var _0x196055=['Ambient',_0x4d627e(0x15d)];if(_0x497a38[0x0][_0x4d627e(0xdd)]==_0x4d627e(0x159))var _0x2f2330=users[_0x4d627e(0x16a)];else{if(_0x497a38[0x0][_0x4d627e(0xdd)]=='Hindi')var _0x2f2330=users[_0x4d627e(0xe5)];else{if(_0x497a38[0x0]['language']==_0x4d627e(0x1b4))var _0x2f2330=users[_0x4d627e(0x1b4)];else{if(_0x497a38[0x0][_0x4d627e(0xdd)]==_0x4d627e(0x1c9))var _0x2f2330=users[_0x4d627e(0x1c9)];else{if(_0x497a38[0x0][_0x4d627e(0xdd)]==_0x4d627e(0x15a))var _0x2f2330=users[_0x4d627e(0x15a)];else{if(_0x497a38[0x0]['language']==_0x4d627e(0x1cd))var _0x2f2330=users['Portuguese'];else{if(_0x497a38[0x0]['language']==_0x4d627e(0x119))var _0x2f2330=users['Chinese'];else{if(_0x497a38[0x0][_0x4d627e(0xdd)]==_0x4d627e(0x1ca))var _0x2f2330=users[_0x4d627e(0x13d)];}}}}}}}const _0xdef79e=getRandom8DigitNumber();_0xdef79e['then'](_0x237681=>{var _0x33d7ef=_0x4d627e;_0xbd7b9b[_0x33d7ef(0x1c7)]('add_purchases',{'success':_0x33f8cd['flash'](_0x33d7ef(0x141)),'errors':_0x33f8cd[_0x33d7ef(0xe7)]('errors'),'role':_0x1a440a,'profile':_0x54901c,'suppliers':_0x5733c9,'warehouse':_0x1004ca,'product':_0x4ac9df,'invoice':_0x237681,'master_shop':_0x497a38,'language':_0x2f2330,'find_data':_0x4860f3,'rooms_data':_0x196055});})[_0x4d627e(0x1bc)](_0x7a61f4=>{var _0x3d3a40=_0x4d627e;_0x33f8cd['flash'](_0x3d3a40(0x172),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xbd7b9b['redirect']('/all_purchases/view');});}catch(_0x443c51){console['log'](_0x443c51);}}),router['get'](a0_0x3bb1a7(0xd9),auth,async(_0x5a82f3,_0x22449a)=>{var _0x34ec57=a0_0x3bb1a7;try{const _0x5af695=_0x5a82f3[_0x34ec57(0x171)]['id'];console[_0x34ec57(0xef)](_0x5af695);const _0x25f39f=await master_shop['find']();console[_0x34ec57(0xef)](_0x34ec57(0x104),_0x25f39f);const _0x108b79=await product['findOne']({'name':_0x5af695});console[_0x34ec57(0xef)](_0x34ec57(0xe6),_0x108b79),_0x22449a['status'](0xc8)[_0x34ec57(0x140)]({'product_data':_0x108b79,'master':_0x25f39f});}catch(_0x33107c){console[_0x34ec57(0xef)]('add_purchases\x20error',_0x33107c);}}),router[a0_0x3bb1a7(0x16c)](a0_0x3bb1a7(0x12d),auth,async(_0x253aab,_0x1b3d49)=>{var _0x104707=a0_0x3bb1a7;try{const {invoice:_0x2a32aa,date:_0x2c5fbc,warehouse_name:_0x2b3c9f,prod_name:_0x43a87a,prod_code:_0x5da59b,prod_qty:_0x406ffb,prod_unit:_0x50b00e,prod_secondunit:_0x571b65,prod_level:_0x3a540d,prod_isle:_0x38cd72,prod_pallet:_0x3a713d,note:_0x113ba0,expiry_date:_0x4f66a7,batch_code:_0x30d652,payable:_0x25e79d,due_amount:_0x3688c5,Room_name:_0x14f2ff,primary_code:_0x5e15b8,secondary_code:_0x4e5a7c,MaxStocks_data:_0x33a7d9,PO_number:_0x2b6b95,SCRN:_0x1e94cf,JO_number:_0x1435ea}=_0x253aab[_0x104707(0x12b)];if(typeof _0x43a87a==_0x104707(0x19f))var _0x2f86a3=[_0x253aab[_0x104707(0x12b)]['prod_name']],_0x36ca9c=[_0x253aab['body'][_0x104707(0x109)]],_0x3b5529=[_0x253aab[_0x104707(0x12b)][_0x104707(0x1cc)]],_0x5488de=[_0x253aab[_0x104707(0x12b)]['prod_primunit']],_0x577a27=[_0x253aab[_0x104707(0x12b)][_0x104707(0x19d)]],_0x38cbb9=[_0x253aab[_0x104707(0x12b)][_0x104707(0x192)]],_0x2e38ad=[_0x253aab['body'][_0x104707(0x1de)]],_0x212e89=[_0x253aab['body'][_0x104707(0x194)]],_0x1a21a0=[_0x253aab[_0x104707(0x12b)][_0x104707(0xd5)]],_0x5cab71=[_0x253aab[_0x104707(0x12b)][_0x104707(0x103)]],_0x5de61c=[_0x253aab[_0x104707(0x12b)][_0x104707(0xeb)]],_0x36bdb8=[_0x253aab[_0x104707(0x12b)][_0x104707(0x183)]],_0x91e154=[_0x253aab[_0x104707(0x12b)]['alertQTY']],_0x4b1385=[_0x253aab[_0x104707(0x12b)][_0x104707(0x1d7)]],_0x2cdbf1=[_0x253aab[_0x104707(0x12b)][_0x104707(0xf2)]],_0x35c57a=[_0x253aab[_0x104707(0x12b)][_0x104707(0x1b0)]],_0x442dbe=[_0x253aab[_0x104707(0x12b)][_0x104707(0x155)]],_0x42aec7=[_0x253aab[_0x104707(0x12b)][_0x104707(0x15b)]],_0x186ef2=[_0x253aab[_0x104707(0x12b)][_0x104707(0x166)]],_0x53d2a0=[_0x253aab[_0x104707(0x12b)][_0x104707(0x161)]];else var _0x2f86a3=[..._0x253aab['body'][_0x104707(0x193)]],_0x36ca9c=[..._0x253aab[_0x104707(0x12b)]['prod_code']],_0x3b5529=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x1cc)]],_0x5488de=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x199)]],_0x577a27=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x19d)]],_0x38cbb9=[..._0x253aab['body'][_0x104707(0x192)]],_0x2e38ad=[..._0x253aab[_0x104707(0x12b)]['primary_code']],_0x212e89=[..._0x253aab['body'][_0x104707(0x194)]],_0x1a21a0=[..._0x253aab[_0x104707(0x12b)][_0x104707(0xd5)]],_0x5cab71=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x103)]],_0x5de61c=[..._0x253aab[_0x104707(0x12b)][_0x104707(0xeb)]],_0x36bdb8=[..._0x253aab[_0x104707(0x12b)]['max_product_unit']],_0x91e154=[..._0x253aab['body'][_0x104707(0x14c)]],_0x4b1385=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x1d7)]],_0x2cdbf1=[..._0x253aab[_0x104707(0x12b)][_0x104707(0xf2)]],_0x35c57a=[..._0x253aab['body']['RoomAssign']],_0x442dbe=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x155)]],_0x42aec7=[..._0x253aab[_0x104707(0x12b)]['prod_invoice']],_0x186ef2=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x166)]],_0x53d2a0=[..._0x253aab[_0x104707(0x12b)][_0x104707(0x161)]];const _0xd1a8d1=_0x2f86a3[_0x104707(0x128)](_0x17af6a=>{return _0x17af6a={'product_name':_0x17af6a};});_0x186ef2[_0x104707(0x1d6)]((_0x5db130,_0x36a6fc)=>{var _0x4fb40d=_0x104707;_0xd1a8d1[_0x36a6fc]['actual_qty']=Math[_0x4fb40d(0xf0)](_0x5db130);}),_0x53d2a0[_0x104707(0x1d6)]((_0x53c6de,_0x14a787)=>{var _0x2cdca5=_0x104707;_0xd1a8d1[_0x14a787][_0x2cdca5(0x161)]=_0x53c6de;}),_0x36ca9c['forEach']((_0x3bd7cd,_0x214382)=>{var _0x151910=_0x104707;_0xd1a8d1[_0x214382][_0x151910(0x113)]=_0x3bd7cd;}),_0x3b5529[_0x104707(0x1d6)]((_0x7dd1da,_0x903cd4)=>{var _0x4b7105=_0x104707;_0xd1a8d1[_0x903cd4][_0x4b7105(0x1cb)]=Math[_0x4b7105(0xf0)](_0x7dd1da);}),_0x5488de[_0x104707(0x1d6)]((_0x27570a,_0x14d93f)=>{var _0x47e901=_0x104707;_0xd1a8d1[_0x14d93f][_0x47e901(0xee)]=_0x27570a;}),_0x577a27['forEach']((_0x23f9cd,_0x2e6abb)=>{var _0x107738=_0x104707;_0xd1a8d1[_0x2e6abb][_0x107738(0x173)]=_0x23f9cd;}),_0x38cbb9[_0x104707(0x1d6)]((_0x30bf0a,_0x518276)=>{_0x35c57a['forEach']((_0x1a834d,_0x5bd95f)=>{var _0x5e8308=a0_0xc1c9;if(_0x1a834d==_0x5e8308(0xf1)&&_0x518276==_0x5bd95f){console[_0x5e8308(0xef)](_0x1a834d+_0x5e8308(0x132)+_0x518276+'\x20<>\x20'+_0x5bd95f+_0x5e8308(0x17e)+_0x30bf0a);var _0x4fc9c4=_0x30bf0a[_0x5e8308(0x182)](0x3);_0xd1a8d1[_0x518276]['storage']=_0x30bf0a[0x0],_0xd1a8d1[_0x518276][_0x5e8308(0x162)]=_0x30bf0a[0x1],_0xd1a8d1[_0x518276][_0x5e8308(0x118)]=0x0,_0xd1a8d1[_0x518276][_0x5e8308(0xde)]=0x0,_0xd1a8d1[_0x518276][_0x5e8308(0x1d5)]=_0x5e8308(0x188),_0xd1a8d1[_0x518276][_0x5e8308(0x165)]=_0x4fc9c4;}else{if(_0x1a834d=='Shelves'&&_0x518276==_0x5bd95f){var _0x4fc9c4=_0x30bf0a['slice'](0x3);_0xd1a8d1[_0x518276][_0x5e8308(0x1a9)]=_0x30bf0a[0x0],_0xd1a8d1[_0x518276][_0x5e8308(0x162)]=_0x30bf0a[0x1],_0xd1a8d1[_0x518276][_0x5e8308(0x118)]=0x0,_0xd1a8d1[_0x518276][_0x5e8308(0xde)]=0x0,_0xd1a8d1[_0x518276]['type']=_0x5e8308(0x188),_0xd1a8d1[_0x518276][_0x5e8308(0x165)]=_0x30bf0a[0x5];}else{if(_0x518276==_0x5bd95f){var _0x3c6941;if(_0x30bf0a[0x4]=='L')_0x3c6941=_0x5e8308(0x12a);else _0x30bf0a[0x4]=='F'&&(_0x3c6941=_0x5e8308(0x188));_0xd1a8d1[_0x518276][_0x5e8308(0x1a9)]=_0x30bf0a[0x0],_0xd1a8d1[_0x518276]['rack']=_0x30bf0a[0x1],_0xd1a8d1[_0x518276]['bay']=_0x30bf0a[0x2],_0xd1a8d1[_0x518276][_0x5e8308(0xde)]=_0x30bf0a[0x3],_0xd1a8d1[_0x518276][_0x5e8308(0x1d5)]=_0x3c6941,_0xd1a8d1[_0x518276][_0x5e8308(0x165)]=_0x30bf0a[0x5];}}}});}),_0x2e38ad['forEach']((_0x310332,_0x50eaa7)=>{var _0x374414=_0x104707;_0xd1a8d1[_0x50eaa7][_0x374414(0x1de)]=_0x310332;}),_0x212e89[_0x104707(0x1d6)]((_0x583665,_0x5aad1e)=>{var _0x52c226=_0x104707;_0xd1a8d1[_0x5aad1e][_0x52c226(0x194)]=_0x583665;}),_0x1a21a0[_0x104707(0x1d6)]((_0x5de63c,_0x1b5a49)=>{var _0x50594f=_0x104707;_0xd1a8d1[_0x1b5a49][_0x50594f(0x1e7)]=_0x5de63c;}),_0x5cab71['forEach']((_0x1ce0b5,_0x3bea50)=>{var _0x35660c=_0x104707;_0xd1a8d1[_0x3bea50][_0x35660c(0x103)]=_0x1ce0b5;}),_0x5de61c[_0x104707(0x1d6)]((_0xb4d905,_0x362dca)=>{var _0x11356e=_0x104707;_0xd1a8d1[_0x362dca][_0x11356e(0xeb)]=_0xb4d905;}),_0x36bdb8[_0x104707(0x1d6)]((_0x3295d5,_0x3f56b4)=>{_0xd1a8d1[_0x3f56b4]['maxperunit']=_0x3295d5;}),_0x91e154[_0x104707(0x1d6)]((_0x3f1755,_0x20e89c)=>{var _0x442609=_0x104707;_0xd1a8d1[_0x20e89c][_0x442609(0x14c)]=_0x3f1755;}),_0x4b1385[_0x104707(0x1d6)]((_0x2b7ec9,_0x520cb0)=>{var _0x54705b=_0x104707;_0xd1a8d1[_0x520cb0][_0x54705b(0x1d7)]=_0x2b7ec9;}),_0x2cdbf1['forEach']((_0x5c8eea,_0x387ba9)=>{_0xd1a8d1[_0x387ba9]['product_cat']=_0x5c8eea;}),_0x35c57a[_0x104707(0x1d6)]((_0x2ff26c,_0x1b199d)=>{var _0x5eb71e=_0x104707;_0xd1a8d1[_0x1b199d][_0x5eb71e(0x1b7)]=_0x2ff26c;}),_0x442dbe[_0x104707(0x1d6)]((_0x1277a9,_0x523b6f)=>{var _0x5d080d=_0x104707;_0xd1a8d1[_0x523b6f][_0x5d080d(0x1ab)]=_0x1277a9;}),_0x42aec7[_0x104707(0x1d6)]((_0x21a3c2,_0x54f911)=>{_0xd1a8d1[_0x54f911]['invoice']=_0x21a3c2;});const _0xcb9323=_0x35c57a[_0x104707(0x128)](_0x36283=>{return _0x36283={'room_name':_0x36283};}),_0x17435f=_0xd1a8d1['filter'](_0x21343e=>_0x21343e[_0x104707(0x1cb)]!=='0'&&_0x21343e[_0x104707(0x1cb)]!==''),_0x5f30c9=new purchases({'invoice':_0x2a32aa,'suppliers':_0x253aab[_0x104707(0x12b)][_0x104707(0x14a)],'date':_0x2c5fbc,'warehouse_name':_0x2b3c9f,'product':_0x17435f,'note':_0x113ba0,'due_amount':_0x3688c5,'POnumber':_0x2b6b95,'SCRN':_0x1e94cf,'JO_number':_0x1435ea,'roomList':_0xcb9323}),_0x5e98c9=await _0x5f30c9[_0x104707(0xe0)](),_0x27ec03=await purchases[_0x104707(0x10e)]({'invoice':_0x2a32aa}),_0x341302=_0x27ec03[_0x104707(0xe6)][_0x104707(0x128)](async _0x57e378=>{var _0x860854=_0x104707,_0x113029=await warehouse['findOne']({'name':_0x2b3c9f,'room':_0x57e378[_0x860854(0x1b7)]}),_0x246653=0x0;return _0x113029[_0x860854(0x13a)][_0x860854(0x1d6)](_0x46f6ca=>{var _0x45cc95=_0x860854;_0x46f6ca[_0x45cc95(0x1b1)]==_0x57e378['product_name']&&_0x46f6ca[_0x45cc95(0x165)]==_0x57e378[_0x45cc95(0x165)]&&_0x46f6ca['type']==_0x57e378[_0x45cc95(0x1d5)]&&_0x46f6ca['bin']==_0x57e378[_0x45cc95(0xde)]&&_0x46f6ca[_0x45cc95(0x118)]==_0x57e378[_0x45cc95(0x118)]&&_0x46f6ca[_0x45cc95(0x162)]==_0x57e378[_0x45cc95(0x162)]&&_0x46f6ca['storage']==_0x57e378[_0x45cc95(0x1a9)]&&_0x46f6ca[_0x45cc95(0xeb)]==_0x57e378['expiry_date']&&_0x46f6ca['batch_code']==_0x57e378[_0x45cc95(0x103)]&&_0x46f6ca['production_date']==_0x57e378[_0x45cc95(0x1d7)]&&_0x46f6ca[_0x45cc95(0x11e)]==_0x27ec03[_0x45cc95(0x11e)]&&(_0x46f6ca['product_stock']+=Math[_0x45cc95(0xf0)](_0x57e378[_0x45cc95(0x1cb)]),_0x246653++);}),_0x246653===0x0&&_0x113029[_0x860854(0x13a)][_0x860854(0x149)]({'product_name':_0x57e378[_0x860854(0x1b1)],'product_stock':Math[_0x860854(0xf0)](_0x57e378[_0x860854(0x1cb)]),'primary_code':_0x57e378[_0x860854(0x1de)],'secondary_code':_0x57e378[_0x860854(0x194)],'product_code':_0x57e378[_0x860854(0x113)],'storage':_0x57e378[_0x860854(0x1a9)],'rack':_0x57e378[_0x860854(0x162)],'bay':_0x57e378[_0x860854(0x118)],'bin':_0x57e378[_0x860854(0xde)],'type':_0x57e378[_0x860854(0x1d5)],'floorlevel':_0x57e378[_0x860854(0x165)],'maxProducts':_0x57e378[_0x860854(0x1e7)],'unit':_0x57e378['standard_unit'],'secondary_unit':_0x57e378[_0x860854(0x173)],'expiry_date':_0x57e378['expiry_date'],'maxPerUnit':_0x57e378['maxperunit'],'batch_code':_0x57e378['batch_code'],'alertQTY':_0x57e378[_0x860854(0x14c)],'production_date':_0x57e378[_0x860854(0x1d7)],'product_cat':_0x57e378[_0x860854(0x1d0)],'invoice':_0x57e378[_0x860854(0x11e)],'actual_qty':Math['abs'](_0x57e378[_0x860854(0x166)]),'actual_uom':_0x57e378['actual_uom']}),_0x113029;});Promise[_0x104707(0x178)](_0x341302)[_0x104707(0x1e9)](async _0x53e882=>{var _0x45d60f=_0x104707;try{for(const _0x4739bf of _0x53e882){await _0x4739bf[_0x45d60f(0xe0)]();}const _0x325efb=await master_shop['find'](),_0x195524=await email_settings[_0x45d60f(0x10e)](),_0x1b6677=await supervisor_settings[_0x45d60f(0x14d)]();var _0x251dc2=_0x27ec03[_0x45d60f(0xe6)],_0xb84951='',_0x1fb509;for(_0x1fb509 in _0x251dc2){_0xb84951+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x251dc2[_0x1fb509][_0x45d60f(0x1b1)]+_0x45d60f(0x11b)+_0x45d60f(0x129)+_0x251dc2[_0x1fb509][_0x45d60f(0x113)]+_0x45d60f(0x11b)+_0x45d60f(0x129)+_0x251dc2[_0x1fb509][_0x45d60f(0x1cb)]+'</td>'+_0x45d60f(0x129)+_0x251dc2[_0x1fb509][_0x45d60f(0xee)]+_0x45d60f(0x11b)+_0x45d60f(0x129)+_0x251dc2[_0x1fb509][_0x45d60f(0x173)]+_0x45d60f(0x11b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x27ec03[_0x45d60f(0x1c5)]+'</td>'+_0x45d60f(0x129)+_0x251dc2[_0x1fb509][_0x45d60f(0x1b7)]+'</td>'+_0x45d60f(0x129)+_0x251dc2[_0x1fb509][_0x45d60f(0x1a9)]+_0x251dc2[_0x1fb509][_0x45d60f(0x162)]+_0x251dc2[_0x1fb509]['bay']+_0x251dc2[_0x1fb509][_0x45d60f(0xde)]+_0x251dc2[_0x1fb509]['type'][0x0]+_0x251dc2[_0x1fb509][_0x45d60f(0x165)]+'</td>',_0x45d60f(0x163);}let _0x2d41d0=nodemailer[_0x45d60f(0x1c4)]({'host':_0x195524['host'],'port':Number(_0x195524['port']),'secure':![],'auth':{'user':_0x195524[_0x45d60f(0x197)],'pass':_0x195524[_0x45d60f(0xdf)]}}),_0x4d49d3={'from':_0x195524[_0x45d60f(0x197)],'to':_0x1b6677[0x0][_0x45d60f(0x156)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x45d60f(0x139)+_0x325efb[0x0][_0x45d60f(0x147)],'cid':'logo'}],'html':_0x45d60f(0x130)+'<html><head><title></title>'+'</head><body>'+_0x45d60f(0x1d3)+_0x45d60f(0x146)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x45d60f(0x1ac)+_0x45d60f(0x1d3)+'<h2>\x20'+_0x325efb[0x0]['site_title']+_0x45d60f(0x17c)+_0x45d60f(0x1ac)+_0x45d60f(0x1ac)+_0x45d60f(0x17d)+'<div>'+_0x45d60f(0x131)+_0x45d60f(0x1a1)+_0x27ec03[_0x45d60f(0x11e)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x27ec03['date']+'\x20'+'</span>'+_0x45d60f(0x180)+_0x45d60f(0x1ac)+_0x45d60f(0x18d)+_0x45d60f(0x10b)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x45d60f(0x167)+_0x45d60f(0x1aa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x45d60f(0x134)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x45d60f(0x163)+_0x45d60f(0x19a)+_0x45d60f(0x195)+'\x20'+_0xb84951+'\x20'+_0x45d60f(0x1b5)+_0x45d60f(0x1c6)+_0x45d60f(0x1d3)+_0x45d60f(0x16f)+_0x45d60f(0x18b)+_0x325efb[0x0][_0x45d60f(0x1b2)]+_0x45d60f(0x180)+_0x45d60f(0x1ac)+_0x45d60f(0x1ac)+'</body></html>'};_0x2d41d0['sendMail'](_0x4d49d3,function(_0x293cc0,_0x2da855){var _0x48c607=_0x45d60f;_0x293cc0?(console['log'](_0x293cc0),console['log'](_0x48c607(0x1d1))):console[_0x48c607(0xef)](_0x48c607(0x1a4));}),_0x253aab[_0x45d60f(0xe7)](_0x45d60f(0x141),'Purchase\x20data\x20added\x20successfully'),_0x1b3d49[_0x45d60f(0xd3)](_0x45d60f(0x1e1));}catch(_0x57e720){console[_0x45d60f(0x186)](_0x57e720),_0x1b3d49[_0x45d60f(0x175)](0x1f4)[_0x45d60f(0x140)]({'error':_0x45d60f(0xf7)});}})['catch'](_0x200eb0=>{var _0x5644b8=_0x104707;console[_0x5644b8(0x186)](_0x200eb0),_0x1b3d49[_0x5644b8(0x175)](0x1f4)[_0x5644b8(0x140)]({'error':_0x5644b8(0x101)});});}catch(_0x5dfe4f){console[_0x104707(0xef)](_0x5dfe4f);}}),router[a0_0x3bb1a7(0x111)](a0_0x3bb1a7(0x117),auth,async(_0xa46a04,_0x49addb)=>{var _0x157172=a0_0x3bb1a7;try{const {username:_0x42ebd0,email:_0x6cda7a,role:_0x4464b6}=_0xa46a04[_0x157172(0x12f)],_0x29e776=_0xa46a04[_0x157172(0x12f)],_0xf503=await profile[_0x157172(0x10e)]({'email':_0x29e776[_0x157172(0x197)]}),_0x35b57f=await master_shop[_0x157172(0x14d)](),_0x7315e9=_0xa46a04[_0x157172(0x171)]['id'],_0x2c14f1=await purchases[_0x157172(0xe1)](_0x7315e9),_0xa336f9=await warehouse[_0x157172(0xfa)]([{'$match':{'name':_0x2c14f1[_0x157172(0x1c5)],'room':_0x2c14f1[_0x157172(0x105)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x157172(0xe8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x157172(0x114)},'bay':{'$first':_0x157172(0x11c)},'bin':{'$first':_0x157172(0x10c)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x157172(0xd4)},'primary_code':{'$first':_0x157172(0x169)},'secondary_code':{'$first':_0x157172(0x142)},'product_code':{'$first':_0x157172(0xea)},'storage':{'$first':_0x157172(0x1ad)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x157172(0x1df)}}}]),_0x50b4da=await customer['find']({});let _0x3ef689;if(_0x29e776['role']==_0x157172(0x108)){const _0x567e3a=await staff[_0x157172(0x10e)]({'email':_0x29e776['email']});_0x3ef689=await warehouse[_0x157172(0xfa)]([{'$match':{'status':_0x157172(0x16d),'name':_0x567e3a[_0x157172(0xed)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x3ef689=await warehouse[_0x157172(0xfa)]([{'$match':{'status':_0x157172(0x16d)}},{'$group':{'_id':_0x157172(0xf3),'name':{'$first':'$name'}}}]);const _0x1911f3=await product[_0x157172(0x14d)]({}),_0x4c6d06=await suppliers[_0x157172(0x14d)]({}),_0x5dcc20=BayBinSelected(_0x2c14f1['warehouse_name'],_0x2c14f1['room']);if(_0x35b57f[0x0][_0x157172(0xdd)]==_0x157172(0x159)){var _0x25ce33=users[_0x157172(0x16a)];console[_0x157172(0xef)](_0x25ce33);}else{if(_0x35b57f[0x0]['language']=='Hindi')var _0x25ce33=users['Hindi'];else{if(_0x35b57f[0x0][_0x157172(0xdd)]==_0x157172(0x1b4))var _0x25ce33=users[_0x157172(0x1b4)];else{if(_0x35b57f[0x0][_0x157172(0xdd)]==_0x157172(0x1c9))var _0x25ce33=users[_0x157172(0x1c9)];else{if(_0x35b57f[0x0][_0x157172(0xdd)]==_0x157172(0x15a))var _0x25ce33=users['French'];else{if(_0x35b57f[0x0]['language']==_0x157172(0x1cd))var _0x25ce33=users['Portuguese'];else{if(_0x35b57f[0x0][_0x157172(0xdd)]=='Chinese')var _0x25ce33=users[_0x157172(0x119)];else{if(_0x35b57f[0x0][_0x157172(0xdd)]==_0x157172(0x1ca))var _0x25ce33=users['Arabic'];}}}}}}}_0x49addb['render'](_0x157172(0x1e4),{'success':_0xa46a04[_0x157172(0xe7)](_0x157172(0x141)),'errors':_0xa46a04['flash'](_0x157172(0x172)),'role':_0x29e776,'profile':_0xf503,'customer':_0x50b4da,'warehouse':_0x3ef689,'product':_0xa336f9,'user':_0x2c14f1,'master_shop':_0x35b57f,'unit':_0x1911f3,'language':_0x25ce33,'suppliers':_0x4c6d06,'dataSelected':_0x5dcc20});}catch(_0x47c813){console[_0x157172(0xef)](_0x47c813);}}),router[a0_0x3bb1a7(0x16c)]('/preview/:id',auth,async(_0x3d50ce,_0x30d326)=>{var _0x49ba8=a0_0x3bb1a7;try{const _0x25bf18=_0x3d50ce[_0x49ba8(0x171)]['id'],{invoice:_0x1b2357,warehouse_name:_0x184e4b,Room_name:_0x49bd00}=_0x3d50ce[_0x49ba8(0x12b)],_0x314f2c=await warehouse['findOne']({'name':_0x184e4b,'room':_0x49bd00}),_0x1887cb=await purchases['findOne']({'invoice':_0x1b2357});_0x1887cb[_0x49ba8(0xe6)][_0x49ba8(0x1d6)](_0x558059=>{var _0x39163b=_0x49ba8,_0x313370=0x0;const _0x4bdd6b=_0x314f2c[_0x39163b(0x13a)][_0x39163b(0x128)](_0x11fc1a=>{var _0x1ebb25=_0x39163b;_0x11fc1a[_0x1ebb25(0x1b1)]==_0x558059[_0x1ebb25(0x1b1)]&&_0x11fc1a[_0x1ebb25(0x165)]==_0x558059[_0x1ebb25(0x165)]&&_0x11fc1a[_0x1ebb25(0x1d5)]==_0x558059[_0x1ebb25(0x1d5)]&&_0x11fc1a[_0x1ebb25(0xde)]==_0x558059[_0x1ebb25(0xde)]&&_0x11fc1a[_0x1ebb25(0x118)]==_0x558059[_0x1ebb25(0x118)]&&_0x11fc1a[_0x1ebb25(0x162)]==_0x558059[_0x1ebb25(0x162)]&&_0x11fc1a['storage']==_0x558059['storage']&&_0x11fc1a[_0x1ebb25(0xeb)]==_0x558059[_0x1ebb25(0xeb)]&&_0x11fc1a['batch_code']==_0x558059[_0x1ebb25(0x103)]&&_0x11fc1a[_0x1ebb25(0x1d7)]==_0x558059[_0x1ebb25(0x1d7)]&&_0x11fc1a[_0x1ebb25(0x12c)]==_0x558059['delivery_date']&&_0x11fc1a[_0x1ebb25(0x1ab)]==_0x558059['delivery_code']&&(_0x11fc1a[_0x1ebb25(0x1a0)]=parseInt(_0x11fc1a['product_stock'])+parseInt(_0x558059[_0x1ebb25(0x1cb)]),_0x313370++);});_0x313370=='0'&&(_0x314f2c[_0x39163b(0x13a)]=_0x314f2c['product_details'][_0x39163b(0xdc)]({'product_name':_0x558059[_0x39163b(0x1b1)],'product_stock':_0x558059[_0x39163b(0x1cb)],'primary_code':_0x558059[_0x39163b(0x1de)],'secondary_code':_0x558059['secondary_code'],'product_code':_0x558059[_0x39163b(0x113)],'storage':_0x558059[_0x39163b(0x1a9)],'rack':_0x558059[_0x39163b(0x162)],'bay':_0x558059[_0x39163b(0x118)],'bin':_0x558059[_0x39163b(0xde)],'type':_0x558059[_0x39163b(0x1d5)],'floorlevel':_0x558059['floorlevel'],'maxProducts':_0x558059[_0x39163b(0x1e7)],'unit':_0x558059[_0x39163b(0xee)],'secondary_unit':_0x558059[_0x39163b(0x173)],'expiry_date':_0x558059[_0x39163b(0xeb)],'maxPerUnit':_0x558059[_0x39163b(0x10d)],'batch_code':_0x558059[_0x39163b(0x103)],'alertQTY':_0x558059['alertQTY'],'production_date':_0x558059[_0x39163b(0x1d7)],'delivery_date':_0x558059[_0x39163b(0x12c)],'delivery_code':_0x558059['delivery_code']}));}),await _0x314f2c['save'](),_0x1887cb[_0x49ba8(0x1da)]='True';const _0x10f5d1=await _0x1887cb[_0x49ba8(0xe0)]();_0x3d50ce[_0x49ba8(0xe7)]('success',_0x49ba8(0x10f)),_0x30d326['redirect'](_0x49ba8(0x13f));}catch(_0x447458){console['log'](_0x447458);}}),router['get'](a0_0x3bb1a7(0x133),auth,async(_0x4d4408,_0x5d9c81)=>{var _0x59acfc=a0_0x3bb1a7;try{const {username:_0x3cc7b8,email:_0x54daeb,role:_0x16199f}=_0x4d4408['user'],_0xe70cfa=_0x4d4408[_0x59acfc(0x12f)],_0x58f632=await profile[_0x59acfc(0x10e)]({'email':_0xe70cfa[_0x59acfc(0x197)]}),_0x26fbc8=await master_shop[_0x59acfc(0x14d)](),_0x1a0202=_0x4d4408[_0x59acfc(0x171)]['id'],_0x18f767=await purchases[_0x59acfc(0xe1)](_0x1a0202),_0x4530de=await suppliers[_0x59acfc(0x14d)]({});let _0x41b54d;if(_0xe70cfa[_0x59acfc(0xd6)]==_0x59acfc(0x108)){const _0x2c3f78=await staff[_0x59acfc(0x10e)]({'email':_0xe70cfa[_0x59acfc(0x197)]});_0x41b54d=await warehouse[_0x59acfc(0x14d)]({'status':_0x59acfc(0x16d),'name':_0x2c3f78['warehouse'],'warehouse_category':_0x59acfc(0x121)});}else _0x41b54d=await warehouse[_0x59acfc(0xfa)]([{'$match':{'status':'Enabled','warehouse_category':_0x59acfc(0x121)}},{'$group':{'_id':_0x59acfc(0xf3),'name':{'$first':_0x59acfc(0xf3)}}}]);const _0xea2675=await product[_0x59acfc(0x14d)]({}),_0xf1369e=BayBinSelected(_0x18f767[_0x59acfc(0x1c5)],_0x18f767[_0x59acfc(0x105)]);let _0x2442e9=new Date(_0x18f767[_0x59acfc(0xeb)]),_0x302c4f=('0'+_0x2442e9[_0x59acfc(0x1e2)]())['slice'](-0x2),_0x10339e=('0'+(_0x2442e9[_0x59acfc(0x1db)]()+0x1))[_0x59acfc(0x182)](-0x2),_0x4cb7dd=_0x2442e9[_0x59acfc(0x116)](),_0x6f94d7=_0x4cb7dd+'-'+_0x10339e+'-'+_0x302c4f;if(_0x26fbc8[0x0][_0x59acfc(0xdd)]==_0x59acfc(0x159)){var _0x177e51=users['English'];console[_0x59acfc(0xef)](_0x177e51);}else{if(_0x26fbc8[0x0][_0x59acfc(0xdd)]==_0x59acfc(0xe5))var _0x177e51=users[_0x59acfc(0xe5)];else{if(_0x26fbc8[0x0]['language']==_0x59acfc(0x1b4))var _0x177e51=users[_0x59acfc(0x1b4)];else{if(_0x26fbc8[0x0][_0x59acfc(0xdd)]=='Spanish')var _0x177e51=users[_0x59acfc(0x1c9)];else{if(_0x26fbc8[0x0]['language']==_0x59acfc(0x15a))var _0x177e51=users[_0x59acfc(0x15a)];else{if(_0x26fbc8[0x0][_0x59acfc(0xdd)]==_0x59acfc(0x1cd))var _0x177e51=users['Portuguese'];else{if(_0x26fbc8[0x0][_0x59acfc(0xdd)]==_0x59acfc(0x119))var _0x177e51=users[_0x59acfc(0x119)];else{if(_0x26fbc8[0x0][_0x59acfc(0xdd)]=='Arabic\x20(ae)')var _0x177e51=users[_0x59acfc(0x13d)];}}}}}}}_0x5d9c81[_0x59acfc(0x1c7)](_0x59acfc(0xf8),{'success':_0x4d4408[_0x59acfc(0xe7)]('success'),'errors':_0x4d4408['flash'](_0x59acfc(0x172)),'role':_0xe70cfa,'profile':_0x58f632,'purchases':_0x18f767,'suppliers':_0x4530de,'warehouse':_0x41b54d,'product':_0xea2675,'master_shop':_0x26fbc8,'language':_0x177e51,'ed_fullDate':_0x6f94d7,'dataSelected':_0xf1369e});}catch(_0x44749a){console[_0x59acfc(0xef)](_0x44749a);}}),router[a0_0x3bb1a7(0x16c)](a0_0x3bb1a7(0x133),auth,async(_0x1480ab,_0x25fe51)=>{var _0x252633=a0_0x3bb1a7;try{const _0x3fb3f3=_0x1480ab[_0x252633(0x171)]['id'],_0x461a98=await purchases[_0x252633(0x10e)]({'_id':_0x1480ab[_0x252633(0x171)]['id']}),_0x2d04af=await warehouse[_0x252633(0x10e)]({'name':_0x461a98['warehouse_name'],'room':_0x461a98['room']});_0x461a98['product'][_0x252633(0x1d6)](_0x43ef71=>{var _0x40f0cf=_0x252633;const _0x4ce014=_0x2d04af[_0x40f0cf(0x13a)]['map'](_0xc0805e=>{var _0x14185e=_0x40f0cf;_0xc0805e[_0x14185e(0x1b1)]==_0x43ef71[_0x14185e(0x1b1)]&&_0xc0805e['floorlevel']==_0x43ef71[_0x14185e(0x165)]&&_0xc0805e[_0x14185e(0x1d5)]==_0x43ef71[_0x14185e(0x1d5)]&&_0xc0805e[_0x14185e(0xde)]==_0x43ef71[_0x14185e(0xde)]&&_0xc0805e[_0x14185e(0x118)]==_0x43ef71[_0x14185e(0x118)]&&_0xc0805e[_0x14185e(0x162)]==_0x43ef71[_0x14185e(0x162)]&&_0xc0805e[_0x14185e(0x1a9)]==_0x43ef71['storage']&&(_0xc0805e[_0x14185e(0x1a0)]=parseInt(_0xc0805e[_0x14185e(0x1a0)])-parseInt(_0x43ef71[_0x14185e(0x1cb)]));});}),await _0x2d04af['save']();const {invoice:_0x34b527,suppliers:_0x48f85f,date:_0x2e7696,warehouse_name:_0x11538d,prod_name:_0x2ae36f,prod_code:_0x4de0fe,prod_qty:_0x2a6001,prod_unit:_0x20ce2e,prod_secondunit:_0x170866,prod_level:_0x11fc4a,prod_isle:_0x299b5d,prod_pallet:_0x30a0f3,note:_0x25929a,expiry_date:_0x3063aa,batch_code:_0x290920,paid_amount:_0x320f16,due_amount:_0x337231,Room_name:_0x1c3d44,primary_code:_0xda82c9,secondary_code:_0x3981d8,PO_number:_0x181646,JO_number:_0x3a675c}=_0x1480ab[_0x252633(0x12b)];if(typeof _0x2ae36f==_0x252633(0x19f))var _0x4bd98e=[_0x1480ab[_0x252633(0x12b)]['prod_name']],_0xd42875=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x109)]],_0x7fed56=[_0x1480ab['body'][_0x252633(0x19c)]],_0x220424=[_0x1480ab['body']['prod_unit']],_0x584608=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x19d)]],_0x56c653=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x192)]],_0x1bc74e=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x1e3)]],_0x2f409e=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x126)]],_0x1141c9=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x1de)]],_0x649999=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x194)]],_0xa3a31b=[_0x1480ab[_0x252633(0x12b)][_0x252633(0xd5)]],_0x562a32=[_0x1480ab['body'][_0x252633(0x103)]],_0x211150=[_0x1480ab[_0x252633(0x12b)][_0x252633(0xeb)]],_0x188eb3=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x1a9)]],_0x150267=[_0x1480ab[_0x252633(0x12b)][_0x252633(0x138)]],_0x4fcc71=[_0x1480ab[_0x252633(0x12b)]['type']];else var _0x4bd98e=[..._0x1480ab['body'][_0x252633(0x193)]],_0xd42875=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x109)]],_0x7fed56=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x19c)]],_0x220424=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0xf9)]],_0x584608=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x19d)]],_0x56c653=[..._0x1480ab['body'][_0x252633(0x192)]],_0x1bc74e=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x1e3)]],_0x2f409e=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x126)]],_0x1141c9=[..._0x1480ab['body'][_0x252633(0x1de)]],_0x649999=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x194)]],_0xa3a31b=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0xd5)]],_0x562a32=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x103)]],_0x211150=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0xeb)]],_0x188eb3=[..._0x1480ab[_0x252633(0x12b)]['storage']],_0x150267=[..._0x1480ab[_0x252633(0x12b)][_0x252633(0x138)]],_0x4fcc71=[..._0x1480ab[_0x252633(0x12b)]['type']];const _0x7ac36a=_0x4bd98e[_0x252633(0x128)](_0x3c1238=>{return _0x3c1238={'product_name':_0x3c1238};});_0xd42875[_0x252633(0x1d6)]((_0x44e8bc,_0x3b4ffd)=>{var _0x499e40=_0x252633;_0x7ac36a[_0x3b4ffd][_0x499e40(0x113)]=_0x44e8bc;}),_0x7fed56['forEach']((_0xc76366,_0x4b3134)=>{var _0x58bced=_0x252633;_0x7ac36a[_0x4b3134][_0x58bced(0x1cb)]=_0xc76366;}),_0x220424[_0x252633(0x1d6)]((_0x4ced03,_0xfd2f72)=>{var _0x3adbf7=_0x252633;_0x7ac36a[_0xfd2f72][_0x3adbf7(0xee)]=_0x4ced03;}),_0x584608[_0x252633(0x1d6)]((_0x395e88,_0x331910)=>{var _0x3f6927=_0x252633;_0x7ac36a[_0x331910][_0x3f6927(0x173)]=_0x395e88;}),_0x56c653[_0x252633(0x1d6)]((_0x37a323,_0x21857b)=>{var _0x304e37=_0x252633;_0x7ac36a[_0x21857b][_0x304e37(0x118)]=_0x37a323;}),_0x1bc74e[_0x252633(0x1d6)]((_0x563720,_0x30a75e)=>{var _0x3fd194=_0x252633;_0x7ac36a[_0x30a75e][_0x3fd194(0xde)]=_0x563720;}),_0x2f409e[_0x252633(0x1d6)]((_0x5cf365,_0x22c90b)=>{var _0x3f7546=_0x252633;_0x7ac36a[_0x22c90b][_0x3f7546(0x165)]=_0x5cf365;}),_0x1141c9[_0x252633(0x1d6)]((_0x1ca54e,_0x3f5e35)=>{var _0xecca07=_0x252633;_0x7ac36a[_0x3f5e35][_0xecca07(0x1de)]=_0x1ca54e;}),_0x649999['forEach']((_0x4f93ce,_0x33d2bd)=>{_0x7ac36a[_0x33d2bd]['secondary_code']=_0x4f93ce;}),_0xa3a31b[_0x252633(0x1d6)]((_0x83d2f9,_0x4cfe18)=>{var _0x32f06e=_0x252633;_0x7ac36a[_0x4cfe18][_0x32f06e(0x1e7)]=_0x83d2f9;}),_0x562a32['forEach']((_0x37e321,_0x201f74)=>{var _0x4a2ba0=_0x252633;_0x7ac36a[_0x201f74][_0x4a2ba0(0x103)]=_0x37e321;}),_0x211150[_0x252633(0x1d6)]((_0x360585,_0x532e96)=>{var _0x259ea1=_0x252633;_0x7ac36a[_0x532e96][_0x259ea1(0xeb)]=_0x360585;}),_0x4fcc71['forEach']((_0x243026,_0x499110)=>{var _0x47b31d=_0x252633;_0x7ac36a[_0x499110][_0x47b31d(0x1d5)]=_0x243026;}),_0x188eb3[_0x252633(0x1d6)]((_0x3f5ea7,_0x51b025)=>{var _0x353096=_0x252633;_0x7ac36a[_0x51b025][_0x353096(0x1a9)]=_0x3f5ea7;}),_0x150267[_0x252633(0x1d6)]((_0x535425,_0x429ea3)=>{var _0x530b76=_0x252633;_0x7ac36a[_0x429ea3][_0x530b76(0x162)]=_0x535425;});const _0x3619be=_0x7ac36a[_0x252633(0x127)](_0x3f18aa=>_0x3f18aa[_0x252633(0x1cb)]!=='0'&&_0x3f18aa['quantity']!=='');_0x461a98['invoice']=_0x34b527,_0x461a98[_0x252633(0x14a)]=_0x48f85f,_0x461a98[_0x252633(0xfe)]=_0x2e7696,_0x461a98['warehouse_name']=_0x11538d,_0x461a98[_0x252633(0xe6)]=_0x3619be,_0x461a98[_0x252633(0xd2)]=_0x25929a,_0x461a98[_0x252633(0x1a7)]=_0x320f16,_0x461a98[_0x252633(0xdb)]=_0x337231,_0x461a98['room']=_0x1c3d44,_0x461a98[_0x252633(0xfc)]=_0x181646,_0x461a98[_0x252633(0x136)]=_0x3a675c;const _0x26ea16=await _0x461a98[_0x252633(0xe0)](),_0x198eeb=await warehouse[_0x252633(0x10e)]({'name':_0x1480ab[_0x252633(0x12b)][_0x252633(0x1c5)],'room':_0x1480ab[_0x252633(0x12b)][_0x252633(0x13c)]});_0x461a98[_0x252633(0xe6)][_0x252633(0x1d6)](_0x1e1773=>{var _0x5032fb=_0x252633,_0x3a5318=0x0;const _0x474995=_0x198eeb[_0x5032fb(0x13a)][_0x5032fb(0x128)](_0x36f233=>{var _0x5b3c99=_0x5032fb;_0x36f233['product_name']==_0x1e1773[_0x5b3c99(0x1b1)]&&_0x36f233['floorlevel']==_0x1e1773['floorlevel']&&_0x36f233[_0x5b3c99(0x1d5)]==_0x1e1773['type']&&_0x36f233[_0x5b3c99(0xde)]==_0x1e1773[_0x5b3c99(0xde)]&&_0x36f233[_0x5b3c99(0x118)]==_0x1e1773[_0x5b3c99(0x118)]&&_0x36f233['rack']==_0x1e1773[_0x5b3c99(0x162)]&&_0x36f233[_0x5b3c99(0x1a9)]==_0x1e1773['storage']&&(_0x36f233[_0x5b3c99(0x1a0)]=parseInt(_0x36f233['product_stock'])+parseInt(_0x1e1773[_0x5b3c99(0x1cb)]),_0x3a5318++);});_0x3a5318=='0'&&(_0x198eeb[_0x5032fb(0x13a)]=_0x198eeb[_0x5032fb(0x13a)][_0x5032fb(0xdc)]({'product_name':_0x1e1773['product_name'],'product_stock':_0x1e1773['quantity'],'primary_code':_0x1e1773[_0x5032fb(0x1de)],'secondary_code':_0x1e1773['secondary_code'],'product_code':_0x1e1773[_0x5032fb(0x113)],'storage':_0x1e1773[_0x5032fb(0x1a9)],'rack':_0x1e1773[_0x5032fb(0x162)],'bay':_0x1e1773['bay'],'bin':_0x1e1773['bin'],'type':_0x1e1773[_0x5032fb(0x1d5)],'floorlevel':_0x1e1773[_0x5032fb(0x165)],'maxProducts':_0x1e1773[_0x5032fb(0x1e7)],'unit':_0x1e1773['standard_unit'],'secondary_unit':_0x1e1773[_0x5032fb(0x173)],'expiry_date':_0x1e1773['expiry_date']}));}),await _0x198eeb['save']();const _0x1a4e64=await s_payment_data[_0x252633(0x10e)]({'invoice':_0x1480ab[_0x252633(0x12b)][_0x252633(0x11e)]});if(_0x1a4e64===null){}else console[_0x252633(0xef)](_0x252633(0x14a),_0x1a4e64,_0x1480ab['body']['invoice']),_0x1a4e64[_0x252633(0x14a)]=_0x1480ab[_0x252633(0x12b)][_0x252633(0x14a)],await _0x1a4e64[_0x252633(0xe0)]();_0x1480ab[_0x252633(0xe7)](_0x252633(0x141),_0x252633(0x164)),_0x25fe51[_0x252633(0xd3)](_0x252633(0x13f));}catch(_0x4827fd){console[_0x252633(0xef)](_0x4827fd);}}),router['post']('/give_payment/:id',auth,async(_0x3a4f3a,_0x588210)=>{var _0xf2cc9f=a0_0x3bb1a7;try{const _0x2f5bd3=_0x3a4f3a[_0xf2cc9f(0x171)]['id'],{invoice:_0x2b5c46,suppliers:_0x3356c8,payable:_0x2ef04f,due_amount:_0x4abdfd}=_0x3a4f3a[_0xf2cc9f(0x12b)],_0x3d2d2e=await purchases['findById'](_0x2f5bd3);var _0x43ac01=_0x2ef04f-_0x4abdfd;_0x3d2d2e['paid_amount']=parseFloat(_0x3d2d2e['paid_amount'])+parseFloat(_0x4abdfd),_0x3d2d2e[_0xf2cc9f(0xdb)]=_0x43ac01;const _0x3aa133=await _0x3d2d2e[_0xf2cc9f(0xe0)]();console['log'](_0x3aa133);const _0x54c07e=await s_payment_data[_0xf2cc9f(0x10e)]({'invoice':_0x2b5c46});_0x54c07e[_0xf2cc9f(0x18a)]=_0x43ac01,await _0x54c07e[_0xf2cc9f(0xe0)]();let _0x60514f=new Date(),_0x2f4ed4=('0'+_0x60514f['getDate']())[_0xf2cc9f(0x182)](-0x2),_0x146b56=('0'+(_0x60514f[_0xf2cc9f(0x1db)]()+0x1))[_0xf2cc9f(0x182)](-0x2),_0x15e590=_0x60514f['getFullYear'](),_0x4e7ac6=_0x15e590+'-'+_0x146b56+'-'+_0x2f4ed4;const _0x45cb53=new suppliers_payment({'invoice':_0x2b5c46,'date':_0x15e590+'-'+_0x146b56+'-'+_0x2f4ed4,'suppliers':_0x3356c8,'reason':_0xf2cc9f(0x198),'amount':_0x4abdfd}),_0x5d3189=await _0x45cb53[_0xf2cc9f(0xe0)]();_0x3a4f3a[_0xf2cc9f(0xe7)](_0xf2cc9f(0x141),_0xf2cc9f(0x196)),_0x588210[_0xf2cc9f(0xd3)](_0xf2cc9f(0x13f));}catch(_0x3cc74c){console[_0xf2cc9f(0xef)](_0x3cc74c);}}),router[a0_0x3bb1a7(0x111)](a0_0x3bb1a7(0x120),auth,async(_0x3e02f0,_0x4b13b1)=>{var _0x3a934e=a0_0x3bb1a7;try{const {username:_0x4d589d,email:_0x866ace,role:_0x20dea7}=_0x3e02f0['user'],_0x227730=_0x3e02f0[_0x3a934e(0x12f)],_0x2034db=await profile[_0x3a934e(0x10e)]({'email':_0x227730[_0x3a934e(0x197)]}),_0x43c73a=await master_shop[_0x3a934e(0x14d)]();console['log']('master',_0x43c73a);const _0x50d68b=_0x3e02f0['params']['id'],_0x1e40bb=await purchases[_0x3a934e(0xe1)](_0x50d68b);console['log'](_0x1e40bb);const _0x254afe=await suppliers['findOne']({'name':_0x1e40bb['suppliers']});console[_0x3a934e(0xef)](_0x254afe);if(_0x43c73a[0x0][_0x3a934e(0xdd)]==_0x3a934e(0x159)){var _0x56d948=users['English'];console[_0x3a934e(0xef)](_0x56d948);}else{if(_0x43c73a[0x0]['language']=='Hindi')var _0x56d948=users[_0x3a934e(0xe5)];else{if(_0x43c73a[0x0]['language']==_0x3a934e(0x1b4))var _0x56d948=users[_0x3a934e(0x1b4)];else{if(_0x43c73a[0x0][_0x3a934e(0xdd)]==_0x3a934e(0x1c9))var _0x56d948=users[_0x3a934e(0x1c9)];else{if(_0x43c73a[0x0]['language']==_0x3a934e(0x15a))var _0x56d948=users['French'];else{if(_0x43c73a[0x0]['language']=='Portuguese\x20(BR)')var _0x56d948=users['Portuguese'];else{if(_0x43c73a[0x0]['language']==_0x3a934e(0x119))var _0x56d948=users['Chinese'];else{if(_0x43c73a[0x0][_0x3a934e(0xdd)]=='Arabic\x20(ae)')var _0x56d948=users['Arabic'];}}}}}}}_0x4b13b1['render']('purchase_invoice',{'success':_0x3e02f0[_0x3a934e(0xe7)](_0x3a934e(0x141)),'errors':_0x3e02f0['flash'](_0x3a934e(0x172)),'role':_0x227730,'profile':_0x2034db,'master_shop':_0x43c73a,'supplier':_0x254afe,'purchase':_0x1e40bb,'language':_0x56d948});}catch(_0x2d3e80){console[_0x3a934e(0xef)](_0x2d3e80);}}),router[a0_0x3bb1a7(0x111)](a0_0x3bb1a7(0x100),auth,async(_0x5a5e96,_0x4d80b1)=>{var _0x7ad6fc=a0_0x3bb1a7;try{const {username:_0x13b245,email:_0xd542c0,role:_0x5c1dc1}=_0x5a5e96[_0x7ad6fc(0x12f)],_0x104189=_0x5a5e96['user'],_0xed6cdf=await profile['findOne']({'email':_0x104189[_0x7ad6fc(0x197)]}),_0x4bee3a=await master_shop[_0x7ad6fc(0x14d)]();console[_0x7ad6fc(0xef)]('master',_0x4bee3a);const _0x5ee17e=_0x5a5e96[_0x7ad6fc(0x171)]['id'];console[_0x7ad6fc(0xef)](_0x5ee17e);const _0xf53348=await purchases[_0x7ad6fc(0xe1)](_0x5ee17e);console[_0x7ad6fc(0xef)]('user_id',_0xf53348);const _0x5e9f96=await product[_0x7ad6fc(0x14d)]({}),_0x1a6c92=await warehouse['aggregate']([{'$match':{'name':_0xf53348[_0x7ad6fc(0x1c5)],'room':_0xf53348[_0x7ad6fc(0x105)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x7ad6fc(0x1ba)},{'$group':{'_id':_0x7ad6fc(0xe8),'name':{'$first':_0x7ad6fc(0x1dd)},'product_stock':{'$first':_0x7ad6fc(0x114)},'bay':{'$first':_0x7ad6fc(0x11c)},'bin':{'$first':_0x7ad6fc(0x10c)},'type':{'$first':_0x7ad6fc(0x17a)},'floorlevel':{'$first':_0x7ad6fc(0xd4)},'primary_code':{'$first':_0x7ad6fc(0x169)},'secondary_code':{'$first':_0x7ad6fc(0x142)},'product_code':{'$first':_0x7ad6fc(0xea)},'storage':{'$first':_0x7ad6fc(0x1ad)},'rack':{'$first':_0x7ad6fc(0x1a5)}}}]);warehouse_data=await warehouse[_0x7ad6fc(0xfa)]([{'$match':{'status':_0x7ad6fc(0x16d),'name':_0x7ad6fc(0xda),'warehouse_category':_0x7ad6fc(0x121)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log'](_0x7ad6fc(0x18f),_0x1a6c92);if(_0x4bee3a[0x0][_0x7ad6fc(0xdd)]==_0x7ad6fc(0x159)){var _0x1f8338=users[_0x7ad6fc(0x16a)];console['log'](_0x1f8338);}else{if(_0x4bee3a[0x0][_0x7ad6fc(0xdd)]==_0x7ad6fc(0xe5))var _0x1f8338=users[_0x7ad6fc(0xe5)];else{if(_0x4bee3a[0x0][_0x7ad6fc(0xdd)]==_0x7ad6fc(0x1b4))var _0x1f8338=users[_0x7ad6fc(0x1b4)];else{if(_0x4bee3a[0x0][_0x7ad6fc(0xdd)]==_0x7ad6fc(0x1c9))var _0x1f8338=users[_0x7ad6fc(0x1c9)];else{if(_0x4bee3a[0x0][_0x7ad6fc(0xdd)]==_0x7ad6fc(0x15a))var _0x1f8338=users[_0x7ad6fc(0x15a)];else{if(_0x4bee3a[0x0][_0x7ad6fc(0xdd)]=='Portuguese\x20(BR)')var _0x1f8338=users['Portuguese'];else{if(_0x4bee3a[0x0]['language']==_0x7ad6fc(0x119))var _0x1f8338=users[_0x7ad6fc(0x119)];else{if(_0x4bee3a[0x0]['language']==_0x7ad6fc(0x1ca))var _0x1f8338=users[_0x7ad6fc(0x13d)];}}}}}}}_0x4d80b1[_0x7ad6fc(0x1c7)](_0x7ad6fc(0x158),{'success':_0x5a5e96[_0x7ad6fc(0xe7)](_0x7ad6fc(0x141)),'errors':_0x5a5e96[_0x7ad6fc(0xe7)]('errors'),'role':_0x104189,'profile':_0xed6cdf,'user':_0xf53348,'stock':_0x1a6c92,'master_shop':_0x4bee3a,'product':_0x5e9f96,'language':_0x1f8338,'warehouse':warehouse_data});}catch(_0x4f02fe){console[_0x7ad6fc(0xef)](_0x4f02fe);}}),router[a0_0x3bb1a7(0x16c)](a0_0x3bb1a7(0x100),auth,async(_0x137ee5,_0x251caa)=>{var _0x5d9ef4=a0_0x3bb1a7;try{const {invoice:_0x2638e7,date:_0x122517,warehouse_name:_0x3324bb,Room_name:_0x427f2d,product_name:_0x1dccac,purchase_quantity:_0x4e8bdc,stocks:_0x5c717e,return_qty:_0x5ad1db,note:_0x35fa1b,level:_0x392f2c,isle:_0x274fb0,pallet:_0x32398d,to_warehouse_name:_0x37da5e,to_Room_name:_0x2cb9a8}=_0x137ee5['body'],_0x53afe1=await purchases[_0x5d9ef4(0x10e)]({'_id':_0x137ee5['params']['id']}),_0x35ceaa=await warehouse[_0x5d9ef4(0x10e)]({'name':_0x3324bb,'room':_0x427f2d});if(typeof _0x1dccac==_0x5d9ef4(0x19f))var _0x379d0e=[_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x1b1)]],_0x191353=[_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x176)]],_0x4bb5cd=[_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x191)]],_0x28d721=[_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x148)]],_0x5e71c1=[_0x137ee5[_0x5d9ef4(0x12b)]['level']],_0x1469ca=[_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x1b8)]],_0x3d2651=[_0x137ee5['body'][_0x5d9ef4(0x179)]],_0x51a9a1=[_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x1e8)]],_0x25d736=[_0x137ee5[_0x5d9ef4(0x12b)]['product_code_hide']],_0x11005d=[_0x137ee5[_0x5d9ef4(0x12b)]['primary_code_hide']],_0x3e563b=[_0x137ee5['body']['secondary_code_hide']];else var _0x379d0e=[..._0x137ee5[_0x5d9ef4(0x12b)]['product_name']],_0x191353=[..._0x137ee5['body']['purchase_quantity']],_0x4bb5cd=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x191)]],_0x28d721=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x148)]],_0x5e71c1=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x19b)]],_0x1469ca=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x1b8)]],_0x3d2651=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x179)]],_0x51a9a1=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x1e8)]],_0x25d736=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x19e)]],_0x11005d=[..._0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x1e5)]],_0x3e563b=[..._0x137ee5[_0x5d9ef4(0x12b)]['secondary_code_hide']];const _0x124aa5=_0x379d0e[_0x5d9ef4(0x128)](_0x2df923=>{return _0x2df923={'product_name':_0x2df923};});_0x191353[_0x5d9ef4(0x1d6)]((_0x3f60e7,_0x5adaa2)=>{_0x124aa5[_0x5adaa2]['purchase_quantity']=_0x3f60e7;}),_0x4bb5cd[_0x5d9ef4(0x1d6)]((_0x2c0813,_0x50d230)=>{var _0xa0592e=_0x5d9ef4;_0x124aa5[_0x50d230][_0xa0592e(0x160)]=_0x2c0813;}),_0x28d721['forEach']((_0x54b8d8,_0x10c200)=>{var _0x5b9f5=_0x5d9ef4;_0x124aa5[_0x10c200][_0x5b9f5(0x148)]=_0x54b8d8;}),_0x5e71c1[_0x5d9ef4(0x1d6)]((_0x1b0b90,_0x4cc416)=>{_0x124aa5[_0x4cc416]['bay']=_0x1b0b90;}),_0x1469ca[_0x5d9ef4(0x1d6)]((_0x596be1,_0x2a500a)=>{var _0x1c4bf3=_0x5d9ef4;_0x124aa5[_0x2a500a][_0x1c4bf3(0xde)]=_0x596be1;}),_0x3d2651[_0x5d9ef4(0x1d6)]((_0x47436c,_0x4f2519)=>{var _0x143f15=_0x5d9ef4;_0x124aa5[_0x4f2519][_0x143f15(0x165)]=_0x47436c;}),_0x51a9a1['forEach']((_0x3bcdea,_0x549e7f)=>{_0x124aa5[_0x549e7f]['type']=_0x3bcdea;}),_0x25d736['forEach']((_0xa25fb2,_0x23539b)=>{var _0x470a33=_0x5d9ef4;_0x124aa5[_0x23539b][_0x470a33(0x113)]=_0xa25fb2;}),_0x11005d[_0x5d9ef4(0x1d6)]((_0x47c596,_0x5e54d3)=>{_0x124aa5[_0x5e54d3]['primary_code']=_0x47c596;}),_0x3e563b[_0x5d9ef4(0x1d6)]((_0x38d759,_0x3d3f2e)=>{var _0x4c7868=_0x5d9ef4;_0x124aa5[_0x3d3f2e][_0x4c7868(0x194)]=_0x38d759;}),_0x53afe1[_0x5d9ef4(0xe6)][_0x5d9ef4(0x1d6)](_0x39d7db=>{var _0x36b031=_0x5d9ef4;const _0x2b9bc=_0x35ceaa[_0x36b031(0x13a)][_0x36b031(0x128)](_0x53b67a=>{var _0x4d6242=_0x36b031;_0x53b67a[_0x4d6242(0x1b1)]==_0x39d7db['product_name']&&_0x53b67a['floorlevel']==_0x39d7db[_0x4d6242(0x165)]&&_0x53b67a[_0x4d6242(0x1d5)]==_0x39d7db[_0x4d6242(0x1d5)]&&_0x53b67a[_0x4d6242(0xde)]==_0x39d7db[_0x4d6242(0xde)]&&_0x53b67a[_0x4d6242(0x118)]==_0x39d7db['bay']&&_0x53b67a['rack']==_0x39d7db[_0x4d6242(0x162)]&&_0x53b67a[_0x4d6242(0x1a9)]==_0x39d7db[_0x4d6242(0x1a9)]&&(console[_0x4d6242(0xef)](parseInt(_0x53b67a[_0x4d6242(0x1a0)])+'\x20<>\x20'+parseInt(_0x39d7db['quantity'])),_0x53b67a[_0x4d6242(0x1a0)]=parseInt(_0x53b67a[_0x4d6242(0x1a0)])+parseInt(_0x39d7db[_0x4d6242(0x1cb)]));});}),await _0x35ceaa['save']();const _0x527908=_0x124aa5[_0x5d9ef4(0x127)](_0x18b6c6=>_0x18b6c6[_0x5d9ef4(0x148)]!=='0'&&_0x18b6c6[_0x5d9ef4(0x148)]!=='');var _0xfd8ab9=0x0;_0x527908[_0x5d9ef4(0x1d6)](_0x1fb31=>{var _0x95c184=_0x5d9ef4;console['log'](_0x95c184(0x143),_0x1fb31),(parseInt(_0x1fb31[_0x95c184(0x176)])<parseInt(_0x1fb31['return_qty'])||parseInt(_0x1fb31[_0x95c184(0x160)])<parseInt(_0x1fb31[_0x95c184(0x148)]))&&_0xfd8ab9++;});if(_0xfd8ab9!=0x0)return _0x137ee5[_0x5d9ef4(0xe7)](_0x5d9ef4(0x172),_0x5d9ef4(0x1d8)),_0x251caa[_0x5d9ef4(0xd3)]('back');const _0x446d57=new purchases_return({'invoice':_0x2638e7,'suppliers':_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x14a)],'date':_0x122517,'warehouse_name':_0x3324bb,'return_product':_0x527908,'note':_0x35fa1b,'room':_0x427f2d,'to_warehouse_name':_0x37da5e,'to_room':_0x2cb9a8}),_0x5d9131=await _0x446d57[_0x5d9ef4(0xe0)]();console[_0x5d9ef4(0xef)](_0x446d57);const _0x5cc966=await purchases_return[_0x5d9ef4(0x10e)]({'invoice':_0x2638e7}),_0x96307=await warehouse[_0x5d9ef4(0x10e)]({'name':_0x37da5e,'room':_0x2cb9a8});_0x5cc966['return_product'][_0x5d9ef4(0x1d6)](_0x5ecf70=>{var _0x1e60ee=_0x5d9ef4,_0x2b695c=0x0;const _0x6ff760=_0x96307['product_details'][_0x1e60ee(0x128)](_0x53772c=>{var _0x5aa0d8=_0x1e60ee;_0x53772c[_0x5aa0d8(0x1b1)]==_0x5ecf70['product_name']&&_0x53772c[_0x5aa0d8(0x165)]==_0x5ecf70[_0x5aa0d8(0x165)]&&_0x53772c[_0x5aa0d8(0x1d5)]==_0x5ecf70[_0x5aa0d8(0x1d5)]&&_0x53772c[_0x5aa0d8(0xde)]==_0x5ecf70[_0x5aa0d8(0xde)]&&_0x53772c[_0x5aa0d8(0x118)]==_0x5ecf70[_0x5aa0d8(0x118)]&&(_0x53772c[_0x5aa0d8(0x1a0)]=parseInt(_0x53772c[_0x5aa0d8(0x1a0)])-parseInt(_0x5ecf70[_0x5aa0d8(0x148)]),_0x2b695c++);});_0x2b695c=='0'&&(_0x96307[_0x1e60ee(0x13a)]=_0x96307['product_details'][_0x1e60ee(0xdc)]({'product_name':_0x5ecf70['product_name'],'product_stock':_0x5ecf70[_0x1e60ee(0x148)],'primary_code':_0x5ecf70['primary_code'],'secondary_code':_0x5ecf70['secondary_code'],'product_code':_0x5ecf70[_0x1e60ee(0x113)],'storage':_0x5ecf70[_0x1e60ee(0x1a9)],'rack':_0x5ecf70[_0x1e60ee(0x162)],'bay':_0x5ecf70[_0x1e60ee(0x118)],'bin':_0x5ecf70[_0x1e60ee(0xde)],'type':_0x5ecf70[_0x1e60ee(0x1d5)],'floorlevel':_0x5ecf70[_0x1e60ee(0x165)],'maxProducts':_0x5ecf70['maxStocks'],'unit':_0x5ecf70[_0x1e60ee(0xee)],'secondary_unit':_0x5ecf70[_0x1e60ee(0x173)],'expiry_date':_0x5ecf70[_0x1e60ee(0xeb)]}));}),await _0x96307[_0x5d9ef4(0xe0)]();const _0x1e5b6a=await purchases['findOne']({'invoice':_0x2638e7});_0x1e5b6a[_0x5d9ef4(0x1a6)]=_0x5d9ef4(0x168);const _0x50c67f=await _0x1e5b6a[_0x5d9ef4(0xe0)](),_0x2f6646=new s_payment_data({'invoice':_0x2638e7,'suppliers':_0x137ee5['body'][_0x5d9ef4(0x14a)],'reason':_0x5d9ef4(0x181)});await _0x2f6646[_0x5d9ef4(0xe0)]();const _0x27b86f=await master_shop[_0x5d9ef4(0x14d)]();console[_0x5d9ef4(0xef)](_0x5d9ef4(0x11f),_0x27b86f[0x0][_0x5d9ef4(0x147)]);const _0xdd393f=await email_settings[_0x5d9ef4(0x10e)](),_0x131baf=await suppliers[_0x5d9ef4(0x10e)]({'name':_0x137ee5[_0x5d9ef4(0x12b)][_0x5d9ef4(0x14a)]});console[_0x5d9ef4(0xef)]('suppliers_data',_0x131baf);_0x27b86f[0x0][_0x5d9ef4(0x10a)]==0x1?(right_currency=_0x27b86f[0x0][_0x5d9ef4(0x112)],left_currency=''):(right_currency='',left_currency=_0x27b86f[0x0][_0x5d9ef4(0x112)]);var _0xaa1bd5=_0x379d0e,_0x43cba5=_0x28d721,_0x5bb50e='',_0x54669a;for(_0x54669a in _0xaa1bd5){_0x5bb50e+='<tr>'+_0x5d9ef4(0x129)+_0xaa1bd5[_0x54669a]+_0x5d9ef4(0x11b)+_0x5d9ef4(0x129)+_0x43cba5[_0x54669a]+_0x5d9ef4(0x11b)+_0x5d9ef4(0x163);}console[_0x5d9ef4(0xef)](_0x5d9ef4(0x15f),_0x5bb50e);let _0x3e1eae=nodemailer[_0x5d9ef4(0x1c4)]({'service':_0x5d9ef4(0xe3),'auth':{'user':_0xdd393f['email'],'pass':_0xdd393f[_0x5d9ef4(0xdf)]}}),_0x445a54={'from':_0xdd393f[_0x5d9ef4(0x197)],'to':_0x131baf[_0x5d9ef4(0x197)],'subject':_0x5d9ef4(0x115),'attachments':[{'filename':_0x5d9ef4(0x122),'path':__dirname+_0x5d9ef4(0x177)+_0x5d9ef4(0x139)+_0x27b86f[0x0][_0x5d9ef4(0x147)],'cid':_0x5d9ef4(0xec)}],'html':_0x5d9ef4(0x130)+_0x5d9ef4(0x16b)+_0x5d9ef4(0x137)+'<div>'+_0x5d9ef4(0x146)+'<div>'+_0x5d9ef4(0x1a2)+_0x5d9ef4(0x1ac)+_0x5d9ef4(0x1d3)+'<h2>\x20'+_0x27b86f[0x0]['site_title']+_0x5d9ef4(0x17c)+_0x5d9ef4(0x1ac)+_0x5d9ef4(0x1ac)+_0x5d9ef4(0x17d)+_0x5d9ef4(0x1d3)+_0x5d9ef4(0x131)+_0x5d9ef4(0x1a1)+_0x2638e7+'\x20'+_0x5d9ef4(0x1d4)+'\x20Order\x20Date\x20:\x20'+_0x122517+'\x20'+_0x5d9ef4(0x1b9)+_0x5d9ef4(0x180)+'</div>'+_0x5d9ef4(0x18d)+_0x5d9ef4(0x10b)+'<tr>'+_0x5d9ef4(0xd8)+_0x5d9ef4(0x170)+_0x5d9ef4(0xff)+_0x5d9ef4(0xe9)+_0x5d9ef4(0x163)+_0x5d9ef4(0x19a)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5bb50e+'\x20'+'</tbody>'+'</table>'+_0x5d9ef4(0x1d3)+_0x5d9ef4(0x16f)+_0x5d9ef4(0x18b)+_0x27b86f[0x0][_0x5d9ef4(0x1b2)]+_0x5d9ef4(0x180)+_0x5d9ef4(0x1ac)+'</div>'+'</body></html>'};_0x3e1eae['sendMail'](_0x445a54,function(_0x335cfa,_0x3d295d){var _0x46ef1b=_0x5d9ef4;_0x335cfa?(console[_0x46ef1b(0xef)](_0x335cfa),console['log']('Error\x20Occurs')):console['log'](_0x46ef1b(0x1a4));}),_0x137ee5[_0x5d9ef4(0xe7)](_0x5d9ef4(0x141),_0x5d9ef4(0x15e)),_0x251caa[_0x5d9ef4(0xd3)](_0x5d9ef4(0x13f));}catch(_0x5ec737){console[_0x5d9ef4(0xef)](_0x5ec737),_0x251caa['status'](0xc8)[_0x5d9ef4(0x140)]({'message':_0x5ec737['message']});}}),router[a0_0x3bb1a7(0x111)](a0_0x3bb1a7(0x14e),auth,async(_0x105e43,_0x8bc5f8)=>{var _0x356a5c=a0_0x3bb1a7;try{const {username:_0x8e8d86,email:_0x2bc44f,role:_0x28de88}=_0x105e43[_0x356a5c(0x12f)],_0xfdd5fe=_0x105e43[_0x356a5c(0x12f)],_0x5b37e8=await profile['findOne']({'email':_0xfdd5fe[_0x356a5c(0x197)]}),_0x547590=await master_shop[_0x356a5c(0x14d)](),_0x366510=_0x105e43[_0x356a5c(0x171)]['id'],_0x128ad2=await purchases[_0x356a5c(0xe1)](_0x366510);if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0x159))var _0x36df6e=users[_0x356a5c(0x16a)];else{if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0xe5))var _0x36df6e=users[_0x356a5c(0xe5)];else{if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0x1b4))var _0x36df6e=users['German'];else{if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0x1c9))var _0x36df6e=users[_0x356a5c(0x1c9)];else{if(_0x547590[0x0][_0x356a5c(0xdd)]=='French')var _0x36df6e=users['French'];else{if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0x1cd))var _0x36df6e=users['Portuguese'];else{if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0x119))var _0x36df6e=users['Chinese'];else{if(_0x547590[0x0][_0x356a5c(0xdd)]==_0x356a5c(0x1ca))var _0x36df6e=users[_0x356a5c(0x13d)];}}}}}}}_0x8bc5f8[_0x356a5c(0x1c7)]('all_purchases_barcode',{'success':_0x105e43['flash'](_0x356a5c(0x141)),'errors':_0x105e43[_0x356a5c(0xe7)]('errors'),'role':_0xfdd5fe,'profile':_0x5b37e8,'alldata':_0x128ad2,'master_shop':_0x547590,'language':_0x36df6e}),console[_0x356a5c(0xef)](alldata);}catch(_0x52154c){console[_0x356a5c(0xef)](_0x52154c);}}),router[a0_0x3bb1a7(0x16c)](a0_0x3bb1a7(0x1c8),async(_0x3ba221,_0x483f78)=>{var _0x37c799=a0_0x3bb1a7;const {product_code:_0x4483bb}=_0x3ba221[_0x37c799(0x12b)];var _0x52bb56;const _0x5bb166=await product[_0x37c799(0xfa)]([{'$match':{'primary_code':_0x4483bb,'product_category':_0x37c799(0x121)}},{'$group':{'_id':_0x37c799(0x135),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x37c799(0x1d9)},'unit':{'$first':_0x37c799(0x1dc)},'alertquantity':{'$first':_0x37c799(0x1c1)},'product_code':{'$first':_0x37c799(0x17b)},'primary_code':{'$first':_0x37c799(0x1a3)},'secondary_code':{'$first':_0x37c799(0xfd)},'maxStocks':{'$first':_0x37c799(0x14f)},'maxProdPerUnit':{'$first':_0x37c799(0x124)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5f56fc=await product['aggregate']([{'$match':{'secondary_code':_0x4483bb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x37c799(0xf3)},'category':{'$first':_0x37c799(0x102)},'brand':{'$first':'$brand'},'unit':{'$first':_0x37c799(0x1dc)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x37c799(0x17b)},'primary_code':{'$first':_0x37c799(0x1a3)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x37c799(0x14f)},'maxProdPerUnit':{'$first':_0x37c799(0x124)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x37c799(0x125)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5bb166[_0x37c799(0x1d2)]>0x0)_0x52bb56=_0x5bb166;else _0x5f56fc[_0x37c799(0x1d2)]>0x0&&(_0x52bb56=_0x5f56fc);_0x483f78[_0x37c799(0x140)](_0x52bb56);}),router['post'](a0_0x3bb1a7(0x13e),async(_0x1ca3a0,_0x175034)=>{var _0x24d725=a0_0x3bb1a7;const {primaryCode:_0x42ccd0,secondaryCode:_0x82b6d2,productCode:_0x3cf1cd,bay:_0xe539b7,bin:_0x513a42,types:_0x44f71d,pallet:_0x5b23c2,warehouses:_0x1f0b67,room:_0x64d76f}=_0x1ca3a0[_0x24d725(0x12b)];console[_0x24d725(0xef)](_0x1ca3a0[_0x24d725(0x12b)]);try{const _0x425366=await warehouse[_0x24d725(0xfa)]([{'$match':{'name':_0x1f0b67,'room':_0x64d76f}},{'$unwind':_0x24d725(0x1ba)},{'$match':{'product_details.bay':_0xe539b7,'product_details.bin':_0x513a42,'product_details.type':_0x44f71d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x24d725(0x1dd)},'product_stock':{'$first':_0x24d725(0x114)},'level':{'$first':_0x24d725(0x1bb)},'isle':{'$first':_0x24d725(0x1cf)},'pallet':{'$first':_0x24d725(0x184)},'maxProducts':{'$first':_0x24d725(0x1e6)}}}]);_0x175034[_0x24d725(0x175)](0xc8)[_0x24d725(0x140)](_0x425366);}catch(_0x25f020){_0x175034[_0x24d725(0x175)](0x194)[_0x24d725(0x140)]({'message':_0x25f020[_0x24d725(0x153)]});}}),module[a0_0x3bb1a7(0xe2)]=router;