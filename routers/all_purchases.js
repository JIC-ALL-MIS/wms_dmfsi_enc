var a0_0x4f8d35=a0_0x5cf7;function a0_0x12fb(){var _0x1115e6=['secondary_unit','get','/view','</table>','$maxStocks','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product.bay','filter','type','/give_payment/:id','$product_details.product_code','add_purchases','purchases\x20item\x20return\x20successfull','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','bay','Receiving\x20Area','$product_details.pallet','product_stock','prod_level','$maxProdPerUnit','Shelves','paid_amount','maxStocks','body','Email\x20sent\x20successfully','$suppliers_docs','padStart','$return_data','string','French','$product_details','prod_primunit','status','types','/barcode_scanner','Enclosed','<tr>','suppliers_docs','prod_qty','<span\x20style=\x22float:\x20right;\x22>','message','rak','2026604JZzbTk','currency','site_title','finalize','$product_details.expiry_date','deliverycode','/view/add_purchases/:id','<hr\x20class=\x22my-3\x22>','floorlevel','$product_details.floorlevel','$product_details.maxProducts','<h5>','primary_code_hide','findOne','prod_pallet','sendMail','all','$due_amount','product_name','prod_isle','then','findById','here','\x20<\x20wew\x20>\x20','/all_purchases/view','$product.floorlevel','role','return_data','production_date','secondary_code_hide','prod_Qty','../models/all_models','log','$product.type','Purchase\x20Mail','product_code','return_qty','slice','password','2008GrEgTx','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','purchase_quantity','level','product_list','</thead>','$product_details.isle','Rack\x20D','Enabled','save','redirect','6573FQxcGX','map','prod_secondunit','Portuguese','prod_invoice','/preview/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product','English\x20(US)','$primary_code','\x20Order\x20Date\x20:\x20','master','length','port','660zRnvJC','random','payment\x20successfull','<h2>\x20','find','256288RsGgZo','room','$_id','Spanish','$unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Floor','actual_qty','MaxStocks_data','name','purchase_invoice','<!DOCTYPE\x20html>','$name','flash','product_details','push','$batch_code','success','room_name','$product_details._id','/view/return_purchase/:id','DRY\x20STORAGE','suppliers','json','suppliers_data','forEach','currency_placement','error','641616bqylIJ','aggregate','Purchase\x20data\x20added\x20successfully','\x20Order\x20Number\x20:\x20','INC-','actual_uom','/view/:id','email','\x20<>\x20','</h5>','catch','POnumber','$suppliers','Router','prod_cat','errors','$product.bin','$note','invoice','add_purchases\x20error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','max_product_unit','/../public','JO_number','createTransport','Arabic\x20(ae)','COLD\x20STORAGE','table\x20page','$product_details.rack','ejs','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','note','date','<div>','$secondary_unit','46935wtvuNI','Hindi','Rack\x20A','<h5\x20style=\x22text-align:\x20left;\x22>','/barcode/:id','$expiry_date','all_purchases','An\x20error\x20occurred.','due_amount','standard_unit','885drRKSz','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','alertQTY','$product','$brand','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','params','getMonth','bin','rack','secondary_code','</td>','$product_details.level','product_code_hide','user','<html><head><title></title>','prod_code','</body></html>','product_cat','$secondary_code','abs','</tbody>','</div>','expiry_date','German','Portuguese\x20(BR)','warehouse_name','Room_name','\x20</h2>','/CheckingWarehouse','</tr>','language','/upload/','../public/language/languages.json','pallet','Sales\x20Update\x20successfully','$date','$product_details.storage','prod_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','warehouse','$paid_amount','Paid\x20For\x20Purchase','RoomAssign','render','primary_code','delivery_code','$product_details.bay','Error\x20Occurs','edit_purchases_view','Arabic','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.product_stock','$product_code','Rack\x20C','$product.quantity','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','143nOmTVt','image','$product_details.type','1806232nlbFyU','return_purchase','/view/add_purchases','RMSEmail','add\x20post','$room','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$alertquantity','Level','$product_details.bin','1476HXsdIp','amount','storage','<strong>\x20Regards\x20</strong>','prod_unit','$invoice','$product_details.secondary_code','getDate','path','Raw\x20Materials','English','$warehouse_name','$product_details.product_name','floor','concat','stock_quantity','True','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','all_purchases_barcode','</head><body>','$category','batch_code','Rack\x20B','$product_details.primary_code','../middleware/auth','10jARKGr','maxperunit','logo','post','return_product','staff'];a0_0x12fb=function(){return _0x1115e6;};return a0_0x12fb();}(function(_0x1f7571,_0x53cd2f){var _0x193050=a0_0x5cf7,_0x3735ee=_0x1f7571();while(!![]){try{var _0x66661f=parseInt(_0x193050(0xa9))/0x1+-parseInt(_0x193050(0x8b))/0x2*(-parseInt(_0x193050(0xf3))/0x3)+-parseInt(_0x193050(0x186))/0x4*(-parseInt(_0x193050(0x154))/0x5)+-parseInt(_0x193050(0x13a))/0x6*(-parseInt(_0x193050(0x96))/0x7)+-parseInt(_0x193050(0x130))/0x8+parseInt(_0x193050(0xe9))/0x9*(-parseInt(_0x193050(0xa4))/0xa)+-parseInt(_0x193050(0x12d))/0xb*(parseInt(_0x193050(0xc5))/0xc);if(_0x66661f===_0x53cd2f)break;else _0x3735ee['push'](_0x3735ee['shift']());}catch(_0x535a56){_0x3735ee['push'](_0x3735ee['shift']());}}}(a0_0x12fb,0x81cff));const express=require('express'),app=express(),router=express[a0_0x4f8d35(0xd2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x4f8d35(0x1a5)),auth=require(a0_0x4f8d35(0x153)),nodemailer=require('nodemailer');var ejs=require(a0_0x4f8d35(0xe2));function a0_0x5cf7(_0x53ca29,_0x455388){var _0x12fbb7=a0_0x12fb();return a0_0x5cf7=function(_0x5cf730,_0x224314){_0x5cf730=_0x5cf730-0x8a;var _0x175828=_0x12fbb7[_0x5cf730];return _0x175828;},a0_0x5cf7(_0x53ca29,_0x455388);}const path=require(a0_0x4f8d35(0x142)),users=require(a0_0x4f8d35(0x114));router[a0_0x4f8d35(0x15b)](a0_0x4f8d35(0x15c),auth,async(_0x41d79f,_0xde4037)=>{var _0x435703=a0_0x4f8d35;try{const {username:_0x22ad41,email:_0x2ce367,role:_0x4fe80e}=_0x41d79f[_0x435703(0x101)],_0x5383da=_0x41d79f[_0x435703(0x101)],_0x15a037=await profile[_0x435703(0x193)]({'email':_0x5383da[_0x435703(0xcc)]}),_0x4022ca=await staff['findOne']({'email':_0x5383da[_0x435703(0xcc)]});if(_0x5383da[_0x435703(0x1a0)]==_0x435703(0x159)){const _0x42e84d=await staff['findOne']({'email':_0x5383da[_0x435703(0xcc)]});}const _0x214f63=await master_shop[_0x435703(0xa8)]();let _0x46f064;if(_0x5383da['role']==_0x435703(0x159)){const _0x31d96d=await staff['findOne']({'email':_0x5383da['email']});_0x46f064=await purchases[_0x435703(0xc6)]([{'$match':{'warehouse_name':_0x31d96d['warehouse']}},{'$lookup':{'from':_0x435703(0xbf),'localField':_0x435703(0xbf),'foreignField':_0x435703(0xb2),'as':_0x435703(0x181)}},{'$unwind':_0x435703(0x175)},{'$unwind':'$product'},{'$group':{'_id':_0x435703(0xab),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x435703(0xd1)},'date':{'$first':_0x435703(0x117)},'warehouse_name':{'$first':_0x435703(0x145)},'room':{'$first':_0x435703(0x135)},'product':{'$push':_0x435703(0xf6)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x435703(0xb9)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x435703(0x175)},'total_product_quantity':{'$sum':_0x435703(0x12a)},'level':{'$addToSet':_0x435703(0x161)},'isle':{'$addToSet':_0x435703(0xd5)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x435703(0x19f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x46f064=await purchases[_0x435703(0xc6)]([{'$lookup':{'from':_0x435703(0xbf),'localField':_0x435703(0xbf),'foreignField':_0x435703(0xb2),'as':_0x435703(0x181)}},{'$unwind':_0x435703(0x175)},{'$unwind':_0x435703(0xf6)},{'$group':{'_id':_0x435703(0xab),'invoice':{'$first':_0x435703(0x13f)},'suppliers':{'$first':_0x435703(0xd1)},'date':{'$first':_0x435703(0x117)},'warehouse_name':{'$first':_0x435703(0x145)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x435703(0xf6)},'note':{'$first':_0x435703(0xd6)},'paid_amount':{'$first':_0x435703(0x11c)},'due_amount':{'$first':_0x435703(0x197)},'return_data':{'$first':_0x435703(0x177)},'batch_code':{'$first':_0x435703(0xb9)},'expiry_date':{'$first':_0x435703(0xee)},'suppliers_docs':{'$first':_0x435703(0x175)},'total_product_quantity':{'$sum':_0x435703(0x12a)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x435703(0xd5)},'type':{'$addToSet':_0x435703(0x1a7)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x214f63[0x0][_0x435703(0x112)]==_0x435703(0x9e)){var _0x491bed=users[_0x435703(0x144)];console['log'](_0x491bed);}else{if(_0x214f63[0x0][_0x435703(0x112)]=='Hindi')var _0x491bed=users['Hindi'];else{if(_0x214f63[0x0]['language']==_0x435703(0x10b))var _0x491bed=users[_0x435703(0x10b)];else{if(_0x214f63[0x0][_0x435703(0x112)]==_0x435703(0xac))var _0x491bed=users[_0x435703(0xac)];else{if(_0x214f63[0x0][_0x435703(0x112)]==_0x435703(0x179))var _0x491bed=users[_0x435703(0x179)];else{if(_0x214f63[0x0][_0x435703(0x112)]==_0x435703(0x10c))var _0x491bed=users[_0x435703(0x99)];else{if(_0x214f63[0x0]['language']==_0x435703(0x168))var _0x491bed=users[_0x435703(0x168)];else{if(_0x214f63[0x0][_0x435703(0x112)]==_0x435703(0xde))var _0x491bed=users[_0x435703(0x125)];}}}}}}}_0xde4037[_0x435703(0x11f)](_0x435703(0xef),{'success':_0x41d79f['flash'](_0x435703(0xba)),'errors':_0x41d79f[_0x435703(0xb6)](_0x435703(0xd4)),'purchases':_0x46f064,'role':_0x5383da,'profile':_0x15a037,'master_shop':_0x214f63,'language':_0x491bed});}catch(_0x268c4c){console['log'](_0x435703(0xe0),_0x268c4c),_0xde4037[_0x435703(0x17c)](0xc8)[_0x435703(0xc0)]({'message':_0x268c4c[_0x435703(0x184)]});}});function BayBinSelected(_0x4df69d,_0x4c3c4a){var _0x52de69=a0_0x4f8d35,_0xb85f1a=[],_0xe8f8cf=[],_0x10a345=[],_0x89b5f1=[],_0x3be65d=[],_0xb4c641=[];let _0x3415ce=[];if(_0x4df69d==_0x52de69(0xbe))switch(_0x4c3c4a){case _0x52de69(0xeb):_0xb85f1a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xe8f8cf=[0x1,0x2],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0x138),_0x52de69(0xaf)],_0x3be65d=['D'],_0xb4c641=['A'];break;case _0x52de69(0x151):_0xb85f1a=[0x6,0x5,0x4,0x3,0x2,0x1],_0xe8f8cf=[0x1,0x2],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0x138),'Floor'],_0x3be65d=['D'],_0xb4c641=['B'];break;case'Shelves':_0xb85f1a=[0x0],_0xe8f8cf=[0x0],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0xaf)],_0x3be65d=['D'],_0xb4c641=['S'];break;case _0x52de69(0x16b):_0xb85f1a=[0x0],_0xe8f8cf=[0x0],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x10a345=[_0x52de69(0xaf)],_0x3be65d=['D'],_0xb4c641=['R'];break;}else{if(_0x4df69d==_0x52de69(0xdf))switch(_0x4c3c4a){case _0x52de69(0xeb):_0xb85f1a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xe8f8cf=['B','F'],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0x138),_0x52de69(0xaf)],_0x3be65d=['C'],_0xb4c641=['A'];break;case'Rack\x20B':_0xb85f1a=[0x5,0x4,0x3,0x2,0x1],_0xe8f8cf=['F','B','S'],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0x138),_0x52de69(0xaf)],_0x3be65d=['C'],_0xb4c641=['B'];break;case _0x52de69(0x129):_0xb85f1a=[0x1,0x2,0x3,0x4,0x5],_0xe8f8cf=['B','F','S'],_0x89b5f1=[0x5,0x4,0x3,0x2,0x1],_0x10a345=[_0x52de69(0x138),_0x52de69(0xaf)],_0x3be65d=['C'],_0xb4c641=['C'];break;case _0x52de69(0x92):_0xb85f1a=[0x5,0x4,0x3,0x2,0x1],_0xe8f8cf=['F','B','S'],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=['Level',_0x52de69(0xaf)],_0x3be65d=['C'],_0xb4c641=['D'];break;case'Rack\x20E':_0xb85f1a=[0x4,0x3,0x2,0x1],_0xe8f8cf=[0x1,0x2],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0x138),_0x52de69(0xaf)],_0x3be65d=['C'],_0xb4c641=['E'];break;case'Rack\x20F':_0xb85f1a=[0x1,0x2,0x3],_0xe8f8cf=[0x1,0x2],_0x89b5f1=[0x1,0x2,0x3,0x4,0x5],_0x10a345=[_0x52de69(0x138)],_0x3be65d=['C'],_0xb4c641=['F'];break;}}return{'levels':_0xb85f1a,'Isle':_0xe8f8cf,'rack':_0x89b5f1,'type':_0x10a345,'storage':_0x3be65d,'rak':_0xb4c641};}async function getRandom8DigitNumber(){var _0x3bc7ab=a0_0x4f8d35;const _0x11cc50=0x989680,_0xcc384c=0x5f5e0ff,_0xc9e3cf=Math[_0x3bc7ab(0x147)](Math[_0x3bc7ab(0xa5)]()*(_0xcc384c-_0x11cc50+0x1))+_0x11cc50;var _0x4f6909;const _0x438fa9=await purchases['findOne']({'invoice':'INC-'+_0xc9e3cf});return _0x438fa9&&_0x438fa9[_0x3bc7ab(0xa2)]>0x0?_0x4f6909=_0x3bc7ab(0xc9)+_0xc9e3cf:_0x4f6909=_0x3bc7ab(0xc9)+_0xc9e3cf,_0x4f6909;}router[a0_0x4f8d35(0x15b)]('/view/add_purchases',auth,async(_0x595d49,_0x31e80b)=>{var _0x3b1dd3=a0_0x4f8d35;try{const {username:_0xfa504b,email:_0x5697a5,role:_0x5b735b}=_0x595d49['user'],_0x5d71a4=_0x595d49['user'],_0x39dcfd=await profile[_0x3b1dd3(0x193)]({'email':_0x5d71a4[_0x3b1dd3(0xcc)]}),_0x42c82c=await master_shop[_0x3b1dd3(0xa8)](),_0x20e0e0=await staff['findOne']({'email':_0x5d71a4[_0x3b1dd3(0xcc)]}),_0x198b83=await suppliers['find']({});let _0x55d399;if(_0x5d71a4[_0x3b1dd3(0x1a0)]=='staff'){const _0xaeec43=await staff[_0x3b1dd3(0x193)]({'email':_0x5d71a4['email']});_0x55d399=await warehouse[_0x3b1dd3(0xc6)]([{'$match':{'status':_0x3b1dd3(0x93),'name':_0xaeec43[_0x3b1dd3(0x11b)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3b1dd3(0x14b)}}},{'$group':{'_id':_0x3b1dd3(0xb5),'name':{'$first':'$name'}}}]);}else _0x55d399=await warehouse[_0x3b1dd3(0xc6)]([{'$match':{'status':_0x3b1dd3(0x93),'warehouse_category':_0x3b1dd3(0x143),'name':{'$ne':_0x3b1dd3(0x14b)}}},{'$group':{'_id':_0x3b1dd3(0xb5),'name':{'$first':_0x3b1dd3(0xb5)}}}]);const _0x507c79=await product[_0x3b1dd3(0xa8)]({}),_0xb30ed4=await warehouse[_0x3b1dd3(0xa8)]({'status':'Enabled'}),_0x40f2f7=await purchases[_0x3b1dd3(0xa8)]({}),_0xf5871d=_0x40f2f7['length']+0x1,_0xf2f87e=_0x3b1dd3(0xc9)+_0xf5871d['toString']()[_0x3b1dd3(0x176)](0x5,'0');var _0x2a0e6a=['Ambient',_0x3b1dd3(0x17f)];if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0x9e))var _0x40d735=users[_0x3b1dd3(0x144)];else{if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0xea))var _0x40d735=users[_0x3b1dd3(0xea)];else{if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0x10b))var _0x40d735=users['German'];else{if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0xac))var _0x40d735=users['Spanish'];else{if(_0x42c82c[0x0]['language']==_0x3b1dd3(0x179))var _0x40d735=users[_0x3b1dd3(0x179)];else{if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0x10c))var _0x40d735=users[_0x3b1dd3(0x99)];else{if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0x168))var _0x40d735=users['Chinese'];else{if(_0x42c82c[0x0][_0x3b1dd3(0x112)]==_0x3b1dd3(0xde))var _0x40d735=users[_0x3b1dd3(0x125)];}}}}}}}const _0x3a81a7=getRandom8DigitNumber();_0x3a81a7[_0x3b1dd3(0x19a)](_0x1a0f0e=>{var _0x4f8969=_0x3b1dd3;_0x31e80b[_0x4f8969(0x11f)](_0x4f8969(0x166),{'success':_0x595d49[_0x4f8969(0xb6)]('success'),'errors':_0x595d49[_0x4f8969(0xb6)]('errors'),'role':_0x5d71a4,'profile':_0x39dcfd,'suppliers':_0x198b83,'warehouse':_0x55d399,'product':_0x507c79,'invoice':_0x1a0f0e,'master_shop':_0x42c82c,'language':_0x40d735,'find_data':_0xb30ed4,'rooms_data':_0x2a0e6a});})[_0x3b1dd3(0xcf)](_0x4890f6=>{var _0x5395b7=_0x3b1dd3;_0x595d49[_0x5395b7(0xb6)](_0x5395b7(0xd4),_0x5395b7(0x136)),_0x31e80b[_0x5395b7(0x95)]('/all_purchases/view');});}catch(_0x1b1a66){console[_0x3b1dd3(0x1a6)](_0x1b1a66);}}),router[a0_0x4f8d35(0x15b)](a0_0x4f8d35(0x18c),auth,async(_0x47b7e8,_0x31eb68)=>{var _0x2b15e5=a0_0x4f8d35;try{const _0x58bbc5=_0x47b7e8[_0x2b15e5(0xf9)]['id'];console[_0x2b15e5(0x1a6)](_0x58bbc5);const _0x39931c=await master_shop[_0x2b15e5(0xa8)]();console[_0x2b15e5(0x1a6)](_0x2b15e5(0xa1),_0x39931c);const _0x3f5fc9=await product[_0x2b15e5(0x193)]({'name':_0x58bbc5});console[_0x2b15e5(0x1a6)](_0x2b15e5(0x9d),_0x3f5fc9),_0x31eb68[_0x2b15e5(0x17c)](0xc8)['json']({'product_data':_0x3f5fc9,'master':_0x39931c});}catch(_0x508dad){console[_0x2b15e5(0x1a6)](_0x2b15e5(0xd8),_0x508dad);}}),router[a0_0x4f8d35(0x157)](a0_0x4f8d35(0x132),auth,async(_0x45657f,_0x2cdb8b)=>{var _0x1dd0a2=a0_0x4f8d35;try{const {invoice:_0x31a032,date:_0x49228f,warehouse_name:_0x2e3dec,prod_name:_0x449960,prod_code:_0x29a745,prod_qty:_0x3cfc8b,prod_unit:_0xf12fa3,prod_secondunit:_0x3d7648,prod_level:_0x1750ed,prod_isle:_0x5e213e,prod_pallet:_0x391bf1,note:_0x48bd56,expiry_date:_0x553d1d,batch_code:_0x1e9164,payable:_0x90b976,due_amount:_0x1851bd,Room_name:_0x1e593a,primary_code:_0x58dbd4,secondary_code:_0xcdf91e,MaxStocks_data:_0x204b94,PO_number:_0x223f50,SCRN:_0x26e4e0,JO_number:_0x3a82e4}=_0x45657f[_0x1dd0a2(0x173)];if(typeof _0x449960=='string')var _0x3c7b98=[_0x45657f[_0x1dd0a2(0x173)]['prod_name']],_0x405c8f=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x103)]],_0x3f5abb=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x1a4)]],_0x16a00b=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x17b)]],_0x260d6=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x98)]],_0xe6ae5e=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x16e)]],_0x2ea0cd=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x120)]],_0x273955=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xfd)]],_0x267906=[_0x45657f[_0x1dd0a2(0x173)]['MaxStocks_data']],_0x58795f=[_0x45657f['body'][_0x1dd0a2(0x150)]],_0x2dbe3b=[_0x45657f[_0x1dd0a2(0x173)]['expiry_date']],_0x190794=[_0x45657f[_0x1dd0a2(0x173)]['max_product_unit']],_0x2861a5=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xf5)]],_0x406be7=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x1a2)]],_0x4777a7=[_0x45657f[_0x1dd0a2(0x173)]['prod_cat']],_0x2f1d96=[_0x45657f['body'][_0x1dd0a2(0x11e)]],_0x478e82=[_0x45657f['body'][_0x1dd0a2(0x18b)]],_0x32d082=[_0x45657f['body'][_0x1dd0a2(0x9a)]],_0x42bb86=[_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xb0)]],_0x3922e=[_0x45657f[_0x1dd0a2(0x173)]['actual_uom']];else var _0x3c7b98=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x119)]],_0x405c8f=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x103)]],_0x3f5abb=[..._0x45657f[_0x1dd0a2(0x173)]['prod_Qty']],_0x16a00b=[..._0x45657f['body'][_0x1dd0a2(0x17b)]],_0x260d6=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x98)]],_0xe6ae5e=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x16e)]],_0x2ea0cd=[..._0x45657f['body'][_0x1dd0a2(0x120)]],_0x273955=[..._0x45657f['body'][_0x1dd0a2(0xfd)]],_0x267906=[..._0x45657f['body'][_0x1dd0a2(0xb1)]],_0x58795f=[..._0x45657f['body'][_0x1dd0a2(0x150)]],_0x2dbe3b=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x10a)]],_0x190794=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xda)]],_0x2861a5=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xf5)]],_0x406be7=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x1a2)]],_0x4777a7=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xd3)]],_0x2f1d96=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x11e)]],_0x478e82=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x18b)]],_0x32d082=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0x9a)]],_0x42bb86=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xb0)]],_0x3922e=[..._0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xca)]];const _0x118806=_0x3c7b98['map'](_0x5dd81d=>{return _0x5dd81d={'product_name':_0x5dd81d};});_0x42bb86[_0x1dd0a2(0xc2)]((_0x42444e,_0x4434fb)=>{var _0x13f3ae=_0x1dd0a2;_0x118806[_0x4434fb][_0x13f3ae(0xb0)]=Math['abs'](_0x42444e);}),_0x3922e[_0x1dd0a2(0xc2)]((_0xaf0088,_0x503b67)=>{var _0x577069=_0x1dd0a2;_0x118806[_0x503b67][_0x577069(0xca)]=_0xaf0088;}),_0x405c8f[_0x1dd0a2(0xc2)]((_0x4caff0,_0x15a5f0)=>{var _0x1492df=_0x1dd0a2;_0x118806[_0x15a5f0][_0x1492df(0x1a9)]=_0x4caff0;}),_0x3f5abb[_0x1dd0a2(0xc2)]((_0x158457,_0xb3cf3f)=>{var _0x3c9df3=_0x1dd0a2;_0x118806[_0xb3cf3f][_0x3c9df3(0x15f)]=Math[_0x3c9df3(0x107)](_0x158457);}),_0x16a00b[_0x1dd0a2(0xc2)]((_0x25c569,_0x5b530b)=>{_0x118806[_0x5b530b]['standard_unit']=_0x25c569;}),_0x260d6['forEach']((_0x1b8ab6,_0x152ba3)=>{var _0x70fd56=_0x1dd0a2;_0x118806[_0x152ba3][_0x70fd56(0x15a)]=_0x1b8ab6;}),_0xe6ae5e[_0x1dd0a2(0xc2)]((_0x174c1d,_0x1b2451)=>{_0x2f1d96['forEach']((_0xaa2ff9,_0x14bde3)=>{var _0x339015=a0_0x5cf7;if(_0xaa2ff9==_0x339015(0x16b)&&_0x1b2451==_0x14bde3){console[_0x339015(0x1a6)](_0xaa2ff9+_0x339015(0x19d)+_0x1b2451+_0x339015(0xcd)+_0x14bde3+_0x339015(0xcd)+_0x174c1d);var _0x11e0cc=_0x174c1d[_0x339015(0x1ab)](0x3);_0x118806[_0x1b2451]['storage']=_0x174c1d[0x0],_0x118806[_0x1b2451]['rack']=_0x174c1d[0x1],_0x118806[_0x1b2451][_0x339015(0x16a)]=0x0,_0x118806[_0x1b2451][_0x339015(0xfb)]=0x0,_0x118806[_0x1b2451][_0x339015(0x163)]=_0x339015(0xaf),_0x118806[_0x1b2451][_0x339015(0x18e)]=_0x11e0cc;}else{if(_0xaa2ff9==_0x339015(0x170)&&_0x1b2451==_0x14bde3){var _0x11e0cc=_0x174c1d[_0x339015(0x1ab)](0x3);_0x118806[_0x1b2451][_0x339015(0x13c)]=_0x174c1d[0x0],_0x118806[_0x1b2451][_0x339015(0xfc)]=_0x174c1d[0x1],_0x118806[_0x1b2451][_0x339015(0x16a)]=0x0,_0x118806[_0x1b2451][_0x339015(0xfb)]=0x0,_0x118806[_0x1b2451]['type']=_0x339015(0xaf),_0x118806[_0x1b2451][_0x339015(0x18e)]=_0x174c1d[0x5];}else{if(_0x1b2451==_0x14bde3){if(_0x174c1d[0x0]=='A'&&_0x174c1d[0x1]=='L'&&_0x174c1d[0x2]=='L')console[_0x339015(0x1a6)](_0xaa2ff9+'\x20<>\x20'+_0x1b2451+'\x20<>\x20'+_0x14bde3+'\x20<>\x20'+_0x174c1d+_0x339015(0x19c)),_0x118806[_0x1b2451]['storage']=_0x174c1d[0x0],_0x118806[_0x1b2451][_0x339015(0xfc)]=_0x174c1d[0x1],_0x118806[_0x1b2451]['bay']=0x0,_0x118806[_0x1b2451]['bin']=0x0,_0x118806[_0x1b2451][_0x339015(0x163)]=_0x339015(0xaf),_0x118806[_0x1b2451][_0x339015(0x18e)]=_0x174c1d[0x3];else{var _0xe809b7;if(_0x174c1d[0x4]=='L')_0xe809b7=_0x339015(0x138);else _0x174c1d[0x4]=='F'&&(_0xe809b7=_0x339015(0xaf));_0x118806[_0x1b2451][_0x339015(0x13c)]=_0x174c1d[0x0],_0x118806[_0x1b2451][_0x339015(0xfc)]=_0x174c1d[0x1],_0x118806[_0x1b2451][_0x339015(0x16a)]=_0x174c1d[0x2],_0x118806[_0x1b2451]['bin']=_0x174c1d[0x3],_0x118806[_0x1b2451][_0x339015(0x163)]=_0xe809b7,_0x118806[_0x1b2451][_0x339015(0x18e)]=_0x174c1d[0x5];}}}}});}),_0x2ea0cd[_0x1dd0a2(0xc2)]((_0x4c21e7,_0x325326)=>{var _0x1e1575=_0x1dd0a2;_0x118806[_0x325326][_0x1e1575(0x120)]=_0x4c21e7;}),_0x273955[_0x1dd0a2(0xc2)]((_0x216b59,_0x2c8d9d)=>{var _0x2e8386=_0x1dd0a2;_0x118806[_0x2c8d9d][_0x2e8386(0xfd)]=_0x216b59;}),_0x267906[_0x1dd0a2(0xc2)]((_0xc8ae14,_0x55d92b)=>{var _0x14bad7=_0x1dd0a2;_0x118806[_0x55d92b][_0x14bad7(0x172)]=_0xc8ae14;}),_0x58795f[_0x1dd0a2(0xc2)]((_0x2d0e21,_0x44dc8f)=>{_0x118806[_0x44dc8f]['batch_code']=_0x2d0e21;}),_0x2dbe3b[_0x1dd0a2(0xc2)]((_0x15bc9b,_0x4afd80)=>{var _0x298833=_0x1dd0a2;_0x118806[_0x4afd80][_0x298833(0x10a)]=_0x15bc9b;}),_0x190794[_0x1dd0a2(0xc2)]((_0x2b7b9b,_0x3fcc18)=>{var _0x102279=_0x1dd0a2;_0x118806[_0x3fcc18][_0x102279(0x155)]=_0x2b7b9b;}),_0x2861a5[_0x1dd0a2(0xc2)]((_0x5d5602,_0x34accc)=>{var _0x1d43e2=_0x1dd0a2;_0x118806[_0x34accc][_0x1d43e2(0xf5)]=_0x5d5602;}),_0x406be7[_0x1dd0a2(0xc2)]((_0x3681f2,_0x4ab8d7)=>{var _0x4bbbf6=_0x1dd0a2;_0x118806[_0x4ab8d7][_0x4bbbf6(0x1a2)]=_0x3681f2;}),_0x4777a7['forEach']((_0xa62695,_0x42b8b5)=>{var _0x5dee63=_0x1dd0a2;_0x118806[_0x42b8b5][_0x5dee63(0x105)]=_0xa62695;}),_0x2f1d96[_0x1dd0a2(0xc2)]((_0x301158,_0x5a9f04)=>{var _0x4eda62=_0x1dd0a2;_0x118806[_0x5a9f04][_0x4eda62(0xbb)]=_0x301158;}),_0x478e82[_0x1dd0a2(0xc2)]((_0x1fb0c6,_0x3a59ad)=>{var _0xe88059=_0x1dd0a2;_0x118806[_0x3a59ad][_0xe88059(0x121)]=_0x1fb0c6;}),_0x32d082['forEach']((_0x41bb56,_0x553aac)=>{var _0x3dc021=_0x1dd0a2;_0x118806[_0x553aac][_0x3dc021(0xd7)]=_0x41bb56;});const _0xaf8469=_0x2f1d96['map'](_0x351c24=>{return _0x351c24={'room_name':_0x351c24};}),_0x5e34c3=_0x118806['filter'](_0x174ab5=>_0x174ab5[_0x1dd0a2(0x15f)]!=='0'&&_0x174ab5[_0x1dd0a2(0x15f)]!==''),_0x346ceb=new purchases({'invoice':_0x31a032,'suppliers':_0x45657f[_0x1dd0a2(0x173)][_0x1dd0a2(0xbf)],'date':_0x49228f,'warehouse_name':_0x2e3dec,'product':_0x5e34c3,'note':_0x48bd56,'due_amount':_0x1851bd,'POnumber':_0x223f50,'SCRN':_0x26e4e0,'JO_number':_0x3a82e4,'roomList':_0xaf8469}),_0x3ee912=await _0x346ceb[_0x1dd0a2(0x94)](),_0x3b5709=await purchases[_0x1dd0a2(0x193)]({'invoice':_0x31a032}),_0x4a25fd=_0x3b5709[_0x1dd0a2(0x9d)][_0x1dd0a2(0x97)](async _0x296ed4=>{var _0x18e132=_0x1dd0a2,_0x4c2c70=await warehouse[_0x18e132(0x193)]({'name':_0x2e3dec,'room':_0x296ed4[_0x18e132(0xbb)]}),_0x4e5b2b=0x0;return _0x4c2c70['product_details'][_0x18e132(0xc2)](_0x1c77af=>{var _0x11898a=_0x18e132;_0x1c77af['product_name']==_0x296ed4[_0x11898a(0x198)]&&_0x1c77af[_0x11898a(0x18e)]==_0x296ed4[_0x11898a(0x18e)]&&_0x1c77af[_0x11898a(0x163)]==_0x296ed4[_0x11898a(0x163)]&&_0x1c77af[_0x11898a(0xfb)]==_0x296ed4[_0x11898a(0xfb)]&&_0x1c77af[_0x11898a(0x16a)]==_0x296ed4[_0x11898a(0x16a)]&&_0x1c77af[_0x11898a(0xfc)]==_0x296ed4[_0x11898a(0xfc)]&&_0x1c77af[_0x11898a(0x13c)]==_0x296ed4[_0x11898a(0x13c)]&&_0x1c77af[_0x11898a(0x10a)]==_0x296ed4[_0x11898a(0x10a)]&&_0x1c77af[_0x11898a(0x150)]==_0x296ed4[_0x11898a(0x150)]&&_0x1c77af[_0x11898a(0x1a2)]==_0x296ed4[_0x11898a(0x1a2)]&&_0x1c77af[_0x11898a(0xd7)]==_0x3b5709[_0x11898a(0xd7)]&&(_0x1c77af[_0x11898a(0x16d)]+=Math['abs'](_0x296ed4[_0x11898a(0x15f)]),_0x4e5b2b++);}),_0x4e5b2b===0x0&&_0x4c2c70[_0x18e132(0xb7)][_0x18e132(0xb8)]({'product_name':_0x296ed4[_0x18e132(0x198)],'product_stock':Math[_0x18e132(0x107)](_0x296ed4[_0x18e132(0x15f)]),'primary_code':_0x296ed4['primary_code'],'secondary_code':_0x296ed4['secondary_code'],'product_code':_0x296ed4[_0x18e132(0x1a9)],'storage':_0x296ed4[_0x18e132(0x13c)],'rack':_0x296ed4['rack'],'bay':_0x296ed4[_0x18e132(0x16a)],'bin':_0x296ed4[_0x18e132(0xfb)],'type':_0x296ed4[_0x18e132(0x163)],'floorlevel':_0x296ed4['floorlevel'],'maxProducts':_0x296ed4[_0x18e132(0x172)],'unit':_0x296ed4[_0x18e132(0xf2)],'secondary_unit':_0x296ed4[_0x18e132(0x15a)],'expiry_date':_0x296ed4[_0x18e132(0x10a)],'maxPerUnit':_0x296ed4[_0x18e132(0x155)],'batch_code':_0x296ed4['batch_code'],'alertQTY':_0x296ed4[_0x18e132(0xf5)],'production_date':_0x296ed4[_0x18e132(0x1a2)],'product_cat':_0x296ed4['product_cat'],'invoice':_0x296ed4['invoice'],'actual_qty':Math[_0x18e132(0x107)](_0x296ed4[_0x18e132(0xb0)]),'actual_uom':_0x296ed4[_0x18e132(0xca)]}),_0x4c2c70;});Promise[_0x1dd0a2(0x196)](_0x4a25fd)['then'](async _0x21230b=>{var _0x1bab90=_0x1dd0a2;try{for(const _0x2651f9 of _0x21230b){await _0x2651f9['save']();}const _0x2d2c23=await master_shop[_0x1bab90(0xa8)](),_0x3bbe6d=await email_settings[_0x1bab90(0x193)](),_0x8b5fde=await supervisor_settings[_0x1bab90(0xa8)]();var _0x21849e=_0x3b5709[_0x1bab90(0x9d)],_0x4f5652='',_0x200bb7;for(_0x200bb7 in _0x21849e){_0x4f5652+='<tr>'+_0x1bab90(0x11a)+_0x21849e[_0x200bb7][_0x1bab90(0x198)]+_0x1bab90(0xfe)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x21849e[_0x200bb7][_0x1bab90(0x1a9)]+_0x1bab90(0xfe)+_0x1bab90(0x11a)+_0x21849e[_0x200bb7][_0x1bab90(0x15f)]+'</td>'+_0x1bab90(0x11a)+_0x21849e[_0x200bb7][_0x1bab90(0xf2)]+'</td>'+_0x1bab90(0x11a)+_0x21849e[_0x200bb7][_0x1bab90(0x15a)]+_0x1bab90(0xfe)+_0x1bab90(0x11a)+_0x3b5709[_0x1bab90(0x10d)]+'</td>'+_0x1bab90(0x11a)+_0x21849e[_0x200bb7][_0x1bab90(0xbb)]+_0x1bab90(0xfe)+_0x1bab90(0x11a)+_0x21849e[_0x200bb7][_0x1bab90(0x13c)]+_0x21849e[_0x200bb7]['rack']+_0x21849e[_0x200bb7][_0x1bab90(0x16a)]+_0x21849e[_0x200bb7][_0x1bab90(0xfb)]+_0x21849e[_0x200bb7][_0x1bab90(0x163)][0x0]+_0x21849e[_0x200bb7][_0x1bab90(0x18e)]+'</td>','</tr>';}let _0x491709=nodemailer[_0x1bab90(0xdd)]({'host':_0x3bbe6d['host'],'port':Number(_0x3bbe6d[_0x1bab90(0xa3)]),'secure':![],'auth':{'user':_0x3bbe6d['email'],'pass':_0x3bbe6d['password']}}),_0x1ab496={'from':_0x3bbe6d[_0x1bab90(0xcc)],'to':_0x8b5fde[0x0][_0x1bab90(0x133)],'subject':_0x1bab90(0x1a8),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1bab90(0xdb)+'/upload/'+_0x2d2c23[0x0][_0x1bab90(0x12e)],'cid':_0x1bab90(0x156)}],'html':_0x1bab90(0xb4)+_0x1bab90(0x102)+'</head><body>'+_0x1bab90(0xe7)+_0x1bab90(0x12b)+_0x1bab90(0xe7)+_0x1bab90(0x12c)+_0x1bab90(0x109)+_0x1bab90(0xe7)+'<h2>\x20'+_0x2d2c23[0x0][_0x1bab90(0x188)]+_0x1bab90(0x10f)+_0x1bab90(0x109)+_0x1bab90(0x109)+_0x1bab90(0x18d)+_0x1bab90(0xe7)+_0x1bab90(0xec)+'\x20Order\x20Number\x20:\x20'+_0x3b5709[_0x1bab90(0xd7)]+'\x20'+_0x1bab90(0x183)+_0x1bab90(0xa0)+_0x3b5709[_0x1bab90(0xe6)]+'\x20'+'</span>'+_0x1bab90(0xce)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1bab90(0xf4)+'<tr>'+_0x1bab90(0x169)+_0x1bab90(0x14c)+_0x1bab90(0xd9)+_0x1bab90(0x8c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1bab90(0xe4)+_0x1bab90(0xae)+_0x1bab90(0x111)+_0x1bab90(0x90)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4f5652+'\x20'+'</tbody>'+_0x1bab90(0x15d)+_0x1bab90(0xe7)+_0x1bab90(0x13d)+_0x1bab90(0x191)+_0x2d2c23[0x0]['site_title']+_0x1bab90(0xce)+_0x1bab90(0x109)+_0x1bab90(0x109)+_0x1bab90(0x104)};_0x491709[_0x1bab90(0x195)](_0x1ab496,function(_0x46071e,_0x7287c){var _0x156bcd=_0x1bab90;_0x46071e?(console['log'](_0x46071e),console[_0x156bcd(0x1a6)](_0x156bcd(0x123))):console[_0x156bcd(0x1a6)]('Email\x20sent\x20successfully');}),_0x45657f[_0x1bab90(0xb6)](_0x1bab90(0xba),_0x1bab90(0xc7)),_0x2cdb8b['redirect']('/all_purchases/view/');}catch(_0x13dba8){console[_0x1bab90(0xc4)](_0x13dba8),_0x2cdb8b[_0x1bab90(0x17c)](0x1f4)[_0x1bab90(0xc0)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x5000cc=>{var _0x5806a4=_0x1dd0a2;console[_0x5806a4(0xc4)](_0x5000cc),_0x2cdb8b['status'](0x1f4)[_0x5806a4(0xc0)]({'error':_0x5806a4(0xf0)});});}catch(_0x2b9c51){console[_0x1dd0a2(0x1a6)](_0x2b9c51);}}),router[a0_0x4f8d35(0x15b)](a0_0x4f8d35(0x9b),auth,async(_0x143a94,_0x5f2a0e)=>{var _0x299f80=a0_0x4f8d35;try{const {username:_0x5151ff,email:_0x3b580a,role:_0x3ec33e}=_0x143a94[_0x299f80(0x101)],_0x45e794=_0x143a94[_0x299f80(0x101)],_0x341eb0=await profile['findOne']({'email':_0x45e794[_0x299f80(0xcc)]}),_0x190b1c=await master_shop[_0x299f80(0xa8)](),_0x321e79=_0x143a94[_0x299f80(0xf9)]['id'],_0x7d0b16=await purchases[_0x299f80(0x19b)](_0x321e79),_0x111399=await warehouse[_0x299f80(0xc6)]([{'$match':{'name':_0x7d0b16[_0x299f80(0x10d)],'room':_0x7d0b16['room']}},{'$unwind':_0x299f80(0x17a)},{'$group':{'_id':_0x299f80(0xbc),'name':{'$first':_0x299f80(0x146)},'product_stock':{'$first':_0x299f80(0x127)},'bay':{'$first':_0x299f80(0x122)},'bin':{'$first':_0x299f80(0x139)},'type':{'$first':_0x299f80(0x12f)},'floorlevel':{'$first':_0x299f80(0x18f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x299f80(0x140)},'product_code':{'$first':_0x299f80(0x165)},'storage':{'$first':_0x299f80(0x118)},'rack':{'$first':_0x299f80(0xe1)},'expiry_date':{'$first':_0x299f80(0x18a)}}}]),_0x5d9593=await customer[_0x299f80(0xa8)]({});let _0x403817;if(_0x45e794[_0x299f80(0x1a0)]==_0x299f80(0x159)){const _0x458846=await staff[_0x299f80(0x193)]({'email':_0x45e794['email']});_0x403817=await warehouse[_0x299f80(0xc6)]([{'$match':{'status':_0x299f80(0x93),'name':_0x458846['warehouse']}},{'$group':{'_id':_0x299f80(0xb5),'name':{'$first':_0x299f80(0xb5)}}}]);}else _0x403817=await warehouse[_0x299f80(0xc6)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x299f80(0xb5),'name':{'$first':'$name'}}}]);const _0x225010=await product[_0x299f80(0xa8)]({}),_0x569083=await suppliers['find']({}),_0x3cb985=BayBinSelected(_0x7d0b16['warehouse_name'],_0x7d0b16[_0x299f80(0xaa)]);if(_0x190b1c[0x0][_0x299f80(0x112)]==_0x299f80(0x9e)){var _0x160809=users[_0x299f80(0x144)];console[_0x299f80(0x1a6)](_0x160809);}else{if(_0x190b1c[0x0][_0x299f80(0x112)]==_0x299f80(0xea))var _0x160809=users['Hindi'];else{if(_0x190b1c[0x0][_0x299f80(0x112)]==_0x299f80(0x10b))var _0x160809=users['German'];else{if(_0x190b1c[0x0][_0x299f80(0x112)]==_0x299f80(0xac))var _0x160809=users['Spanish'];else{if(_0x190b1c[0x0]['language']==_0x299f80(0x179))var _0x160809=users[_0x299f80(0x179)];else{if(_0x190b1c[0x0][_0x299f80(0x112)]==_0x299f80(0x10c))var _0x160809=users[_0x299f80(0x99)];else{if(_0x190b1c[0x0]['language']==_0x299f80(0x168))var _0x160809=users[_0x299f80(0x168)];else{if(_0x190b1c[0x0][_0x299f80(0x112)]=='Arabic\x20(ae)')var _0x160809=users[_0x299f80(0x125)];}}}}}}}_0x5f2a0e['render'](_0x299f80(0x124),{'success':_0x143a94[_0x299f80(0xb6)]('success'),'errors':_0x143a94[_0x299f80(0xb6)](_0x299f80(0xd4)),'role':_0x45e794,'profile':_0x341eb0,'customer':_0x5d9593,'warehouse':_0x403817,'product':_0x111399,'user':_0x7d0b16,'master_shop':_0x190b1c,'unit':_0x225010,'language':_0x160809,'suppliers':_0x569083,'dataSelected':_0x3cb985});}catch(_0x6409a4){console['log'](_0x6409a4);}}),router['post'](a0_0x4f8d35(0x9b),auth,async(_0x240585,_0xea1a15)=>{var _0x4506f5=a0_0x4f8d35;try{const _0x43eb03=_0x240585[_0x4506f5(0xf9)]['id'],{invoice:_0x450364,warehouse_name:_0x6caa6a,Room_name:_0x1cb1fa}=_0x240585[_0x4506f5(0x173)],_0x4ccec5=await warehouse[_0x4506f5(0x193)]({'name':_0x6caa6a,'room':_0x1cb1fa}),_0x92e21f=await purchases[_0x4506f5(0x193)]({'invoice':_0x450364});_0x92e21f['product']['forEach'](_0x561d0e=>{var _0xb4dee1=_0x4506f5,_0x457350=0x0;const _0x47f571=_0x4ccec5[_0xb4dee1(0xb7)][_0xb4dee1(0x97)](_0x554e67=>{var _0x3498af=_0xb4dee1;_0x554e67[_0x3498af(0x198)]==_0x561d0e[_0x3498af(0x198)]&&_0x554e67[_0x3498af(0x18e)]==_0x561d0e[_0x3498af(0x18e)]&&_0x554e67[_0x3498af(0x163)]==_0x561d0e[_0x3498af(0x163)]&&_0x554e67[_0x3498af(0xfb)]==_0x561d0e[_0x3498af(0xfb)]&&_0x554e67['bay']==_0x561d0e['bay']&&_0x554e67[_0x3498af(0xfc)]==_0x561d0e[_0x3498af(0xfc)]&&_0x554e67[_0x3498af(0x13c)]==_0x561d0e[_0x3498af(0x13c)]&&_0x554e67['expiry_date']==_0x561d0e[_0x3498af(0x10a)]&&_0x554e67[_0x3498af(0x150)]==_0x561d0e[_0x3498af(0x150)]&&_0x554e67[_0x3498af(0x1a2)]==_0x561d0e[_0x3498af(0x1a2)]&&_0x554e67['delivery_date']==_0x561d0e['delivery_date']&&_0x554e67[_0x3498af(0x121)]==_0x561d0e['delivery_code']&&(_0x554e67['product_stock']=parseInt(_0x554e67[_0x3498af(0x16d)])+parseInt(_0x561d0e['quantity']),_0x457350++);});_0x457350=='0'&&(_0x4ccec5[_0xb4dee1(0xb7)]=_0x4ccec5[_0xb4dee1(0xb7)][_0xb4dee1(0x148)]({'product_name':_0x561d0e[_0xb4dee1(0x198)],'product_stock':_0x561d0e[_0xb4dee1(0x15f)],'primary_code':_0x561d0e[_0xb4dee1(0x120)],'secondary_code':_0x561d0e[_0xb4dee1(0xfd)],'product_code':_0x561d0e[_0xb4dee1(0x1a9)],'storage':_0x561d0e[_0xb4dee1(0x13c)],'rack':_0x561d0e[_0xb4dee1(0xfc)],'bay':_0x561d0e[_0xb4dee1(0x16a)],'bin':_0x561d0e['bin'],'type':_0x561d0e[_0xb4dee1(0x163)],'floorlevel':_0x561d0e[_0xb4dee1(0x18e)],'maxProducts':_0x561d0e[_0xb4dee1(0x172)],'unit':_0x561d0e[_0xb4dee1(0xf2)],'secondary_unit':_0x561d0e[_0xb4dee1(0x15a)],'expiry_date':_0x561d0e[_0xb4dee1(0x10a)],'maxPerUnit':_0x561d0e[_0xb4dee1(0x155)],'batch_code':_0x561d0e[_0xb4dee1(0x150)],'alertQTY':_0x561d0e[_0xb4dee1(0xf5)],'production_date':_0x561d0e[_0xb4dee1(0x1a2)],'delivery_date':_0x561d0e['delivery_date'],'delivery_code':_0x561d0e[_0xb4dee1(0x121)]}));}),await _0x4ccec5['save'](),_0x92e21f[_0x4506f5(0x189)]='True';const _0x3ed26f=await _0x92e21f['save']();_0x240585[_0x4506f5(0xb6)](_0x4506f5(0xba),_0x4506f5(0x116)),_0xea1a15['redirect'](_0x4506f5(0x19e));}catch(_0x3c2e97){console[_0x4506f5(0x1a6)](_0x3c2e97);}}),router[a0_0x4f8d35(0x15b)](a0_0x4f8d35(0xcb),auth,async(_0x9c74da,_0x9eb866)=>{var _0x1e31fc=a0_0x4f8d35;try{const {username:_0x2db2e4,email:_0x10672a,role:_0x570bba}=_0x9c74da[_0x1e31fc(0x101)],_0x2b4317=_0x9c74da['user'],_0x2009b2=await profile[_0x1e31fc(0x193)]({'email':_0x2b4317[_0x1e31fc(0xcc)]}),_0x53333a=await master_shop['find'](),_0x18f253=_0x9c74da[_0x1e31fc(0xf9)]['id'],_0x287652=await purchases[_0x1e31fc(0x19b)](_0x18f253),_0x4e47d1=await suppliers[_0x1e31fc(0xa8)]({});let _0x2a5843;if(_0x2b4317[_0x1e31fc(0x1a0)]==_0x1e31fc(0x159)){const _0x51fee5=await staff[_0x1e31fc(0x193)]({'email':_0x2b4317[_0x1e31fc(0xcc)]});_0x2a5843=await warehouse['find']({'status':'Enabled','name':_0x51fee5['warehouse'],'warehouse_category':_0x1e31fc(0x143)});}else _0x2a5843=await warehouse[_0x1e31fc(0xc6)]([{'$match':{'status':'Enabled','warehouse_category':_0x1e31fc(0x143)}},{'$group':{'_id':_0x1e31fc(0xb5),'name':{'$first':_0x1e31fc(0xb5)}}}]);const _0x2be701=await product['find']({}),_0x359887=BayBinSelected(_0x287652[_0x1e31fc(0x10d)],_0x287652[_0x1e31fc(0xaa)]);let _0x5c0b60=new Date(_0x287652[_0x1e31fc(0x10a)]),_0x1867c3=('0'+_0x5c0b60[_0x1e31fc(0x141)]())[_0x1e31fc(0x1ab)](-0x2),_0x2093b3=('0'+(_0x5c0b60[_0x1e31fc(0xfa)]()+0x1))[_0x1e31fc(0x1ab)](-0x2),_0xb2a48a=_0x5c0b60[_0x1e31fc(0xe3)](),_0x3b150a=_0xb2a48a+'-'+_0x2093b3+'-'+_0x1867c3;if(_0x53333a[0x0][_0x1e31fc(0x112)]==_0x1e31fc(0x9e)){var _0x939a89=users['English'];console[_0x1e31fc(0x1a6)](_0x939a89);}else{if(_0x53333a[0x0][_0x1e31fc(0x112)]=='Hindi')var _0x939a89=users[_0x1e31fc(0xea)];else{if(_0x53333a[0x0][_0x1e31fc(0x112)]=='German')var _0x939a89=users[_0x1e31fc(0x10b)];else{if(_0x53333a[0x0][_0x1e31fc(0x112)]==_0x1e31fc(0xac))var _0x939a89=users[_0x1e31fc(0xac)];else{if(_0x53333a[0x0][_0x1e31fc(0x112)]=='French')var _0x939a89=users[_0x1e31fc(0x179)];else{if(_0x53333a[0x0][_0x1e31fc(0x112)]==_0x1e31fc(0x10c))var _0x939a89=users[_0x1e31fc(0x99)];else{if(_0x53333a[0x0][_0x1e31fc(0x112)]==_0x1e31fc(0x168))var _0x939a89=users[_0x1e31fc(0x168)];else{if(_0x53333a[0x0][_0x1e31fc(0x112)]==_0x1e31fc(0xde))var _0x939a89=users[_0x1e31fc(0x125)];}}}}}}}_0x9eb866[_0x1e31fc(0x11f)]('edit_purchases',{'success':_0x9c74da[_0x1e31fc(0xb6)](_0x1e31fc(0xba)),'errors':_0x9c74da['flash'](_0x1e31fc(0xd4)),'role':_0x2b4317,'profile':_0x2009b2,'purchases':_0x287652,'suppliers':_0x4e47d1,'warehouse':_0x2a5843,'product':_0x2be701,'master_shop':_0x53333a,'language':_0x939a89,'ed_fullDate':_0x3b150a,'dataSelected':_0x359887});}catch(_0x3506a8){console[_0x1e31fc(0x1a6)](_0x3506a8);}}),router[a0_0x4f8d35(0x157)]('/view/:id',auth,async(_0x54fff7,_0x197974)=>{var _0x546c04=a0_0x4f8d35;try{const _0x13c5b0=_0x54fff7[_0x546c04(0xf9)]['id'],_0x45439a=await purchases['findOne']({'_id':_0x54fff7['params']['id']}),_0x42533c=await warehouse[_0x546c04(0x193)]({'name':_0x45439a[_0x546c04(0x10d)],'room':_0x45439a[_0x546c04(0xaa)]});_0x45439a[_0x546c04(0x9d)][_0x546c04(0xc2)](_0x2e3492=>{var _0x55f75e=_0x546c04;const _0x3f31fe=_0x42533c[_0x55f75e(0xb7)][_0x55f75e(0x97)](_0x115501=>{var _0x515107=_0x55f75e;_0x115501['product_name']==_0x2e3492[_0x515107(0x198)]&&_0x115501[_0x515107(0x18e)]==_0x2e3492[_0x515107(0x18e)]&&_0x115501[_0x515107(0x163)]==_0x2e3492[_0x515107(0x163)]&&_0x115501['bin']==_0x2e3492[_0x515107(0xfb)]&&_0x115501[_0x515107(0x16a)]==_0x2e3492['bay']&&_0x115501[_0x515107(0xfc)]==_0x2e3492[_0x515107(0xfc)]&&_0x115501[_0x515107(0x13c)]==_0x2e3492[_0x515107(0x13c)]&&(_0x115501[_0x515107(0x16d)]=parseInt(_0x115501[_0x515107(0x16d)])-parseInt(_0x2e3492[_0x515107(0x15f)]));});}),await _0x42533c[_0x546c04(0x94)]();const {invoice:_0x2b2a0a,suppliers:_0x53068d,date:_0x3c252c,warehouse_name:_0x2e9d3e,prod_name:_0x53cee7,prod_code:_0x2a4019,prod_qty:_0x38a1b0,prod_unit:_0x5d0dca,prod_secondunit:_0x4b57ac,prod_level:_0x2e27fb,prod_isle:_0x25c641,prod_pallet:_0x43aaec,note:_0x1a0315,expiry_date:_0x395931,batch_code:_0x327497,paid_amount:_0x14ddc1,due_amount:_0x5d546d,Room_name:_0x5989ce,primary_code:_0x277620,secondary_code:_0x3c7328,PO_number:_0x344189,JO_number:_0x1d2c7f}=_0x54fff7['body'];if(typeof _0x53cee7=='string')var _0x54e8f1=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x119)]],_0x110fca=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x103)]],_0x21363a=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x182)]],_0x2a2e0c=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x13e)]],_0x5544c6=[_0x54fff7['body'][_0x546c04(0x98)]],_0xc18840=[_0x54fff7['body'][_0x546c04(0x16e)]],_0x3822d8=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x199)]],_0x425857=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x194)]],_0x52f08d=[_0x54fff7[_0x546c04(0x173)]['primary_code']],_0x43d56a=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0xfd)]],_0x5ef146=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0xb1)]],_0x456e60=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x150)]],_0x491502=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x10a)]],_0x4e5b5b=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x13c)]],_0x294901=[_0x54fff7[_0x546c04(0x173)][_0x546c04(0x185)]],_0x2669f3=[_0x54fff7['body'][_0x546c04(0x163)]];else var _0x54e8f1=[..._0x54fff7[_0x546c04(0x173)][_0x546c04(0x119)]],_0x110fca=[..._0x54fff7[_0x546c04(0x173)]['prod_code']],_0x21363a=[..._0x54fff7[_0x546c04(0x173)][_0x546c04(0x182)]],_0x2a2e0c=[..._0x54fff7['body'][_0x546c04(0x13e)]],_0x5544c6=[..._0x54fff7[_0x546c04(0x173)]['prod_secondunit']],_0xc18840=[..._0x54fff7[_0x546c04(0x173)][_0x546c04(0x16e)]],_0x3822d8=[..._0x54fff7['body'][_0x546c04(0x199)]],_0x425857=[..._0x54fff7['body'][_0x546c04(0x194)]],_0x52f08d=[..._0x54fff7[_0x546c04(0x173)]['primary_code']],_0x43d56a=[..._0x54fff7[_0x546c04(0x173)][_0x546c04(0xfd)]],_0x5ef146=[..._0x54fff7[_0x546c04(0x173)]['MaxStocks_data']],_0x456e60=[..._0x54fff7[_0x546c04(0x173)][_0x546c04(0x150)]],_0x491502=[..._0x54fff7[_0x546c04(0x173)][_0x546c04(0x10a)]],_0x4e5b5b=[..._0x54fff7[_0x546c04(0x173)]['storage']],_0x294901=[..._0x54fff7['body'][_0x546c04(0x185)]],_0x2669f3=[..._0x54fff7[_0x546c04(0x173)]['type']];const _0x5c0fda=_0x54e8f1[_0x546c04(0x97)](_0x577110=>{return _0x577110={'product_name':_0x577110};});_0x110fca['forEach']((_0x27eb6b,_0x3a2470)=>{var _0x3c1e81=_0x546c04;_0x5c0fda[_0x3a2470][_0x3c1e81(0x1a9)]=_0x27eb6b;}),_0x21363a[_0x546c04(0xc2)]((_0x813e82,_0x2d470c)=>{var _0x4a02df=_0x546c04;_0x5c0fda[_0x2d470c][_0x4a02df(0x15f)]=_0x813e82;}),_0x2a2e0c['forEach']((_0x590e82,_0x4df77b)=>{_0x5c0fda[_0x4df77b]['standard_unit']=_0x590e82;}),_0x5544c6[_0x546c04(0xc2)]((_0x3b891a,_0x43271a)=>{_0x5c0fda[_0x43271a]['secondary_unit']=_0x3b891a;}),_0xc18840[_0x546c04(0xc2)]((_0x37dd38,_0x33b974)=>{var _0xf1f8b4=_0x546c04;_0x5c0fda[_0x33b974][_0xf1f8b4(0x16a)]=_0x37dd38;}),_0x3822d8[_0x546c04(0xc2)]((_0x544cfb,_0x25ea3e)=>{_0x5c0fda[_0x25ea3e]['bin']=_0x544cfb;}),_0x425857[_0x546c04(0xc2)]((_0x54fa9c,_0x37ff5a)=>{var _0x4a8bb6=_0x546c04;_0x5c0fda[_0x37ff5a][_0x4a8bb6(0x18e)]=_0x54fa9c;}),_0x52f08d['forEach']((_0x8dbf8e,_0xef8253)=>{var _0x247375=_0x546c04;_0x5c0fda[_0xef8253][_0x247375(0x120)]=_0x8dbf8e;}),_0x43d56a[_0x546c04(0xc2)]((_0x496fcc,_0xa3d683)=>{var _0x57eac5=_0x546c04;_0x5c0fda[_0xa3d683][_0x57eac5(0xfd)]=_0x496fcc;}),_0x5ef146[_0x546c04(0xc2)]((_0x2d6d74,_0x74704c)=>{_0x5c0fda[_0x74704c]['maxStocks']=_0x2d6d74;}),_0x456e60['forEach']((_0x1e8650,_0x1899c3)=>{var _0x4233b9=_0x546c04;_0x5c0fda[_0x1899c3][_0x4233b9(0x150)]=_0x1e8650;}),_0x491502[_0x546c04(0xc2)]((_0x2f2bc3,_0x179de1)=>{_0x5c0fda[_0x179de1]['expiry_date']=_0x2f2bc3;}),_0x2669f3[_0x546c04(0xc2)]((_0x282871,_0x51815c)=>{_0x5c0fda[_0x51815c]['type']=_0x282871;}),_0x4e5b5b[_0x546c04(0xc2)]((_0x2a8e4a,_0x20e236)=>{var _0x38c2f2=_0x546c04;_0x5c0fda[_0x20e236][_0x38c2f2(0x13c)]=_0x2a8e4a;}),_0x294901['forEach']((_0x6a3e7f,_0x5b831b)=>{_0x5c0fda[_0x5b831b]['rack']=_0x6a3e7f;});const _0x345362=_0x5c0fda[_0x546c04(0x162)](_0x10fb37=>_0x10fb37['quantity']!=='0'&&_0x10fb37['quantity']!=='');_0x45439a[_0x546c04(0xd7)]=_0x2b2a0a,_0x45439a[_0x546c04(0xbf)]=_0x53068d,_0x45439a[_0x546c04(0xe6)]=_0x3c252c,_0x45439a[_0x546c04(0x10d)]=_0x2e9d3e,_0x45439a[_0x546c04(0x9d)]=_0x345362,_0x45439a[_0x546c04(0xe5)]=_0x1a0315,_0x45439a[_0x546c04(0x171)]=_0x14ddc1,_0x45439a[_0x546c04(0xf1)]=_0x5d546d,_0x45439a[_0x546c04(0xaa)]=_0x5989ce,_0x45439a[_0x546c04(0xd0)]=_0x344189,_0x45439a[_0x546c04(0xdc)]=_0x1d2c7f;const _0x2214f0=await _0x45439a[_0x546c04(0x94)](),_0x307236=await warehouse[_0x546c04(0x193)]({'name':_0x54fff7[_0x546c04(0x173)][_0x546c04(0x10d)],'room':_0x54fff7[_0x546c04(0x173)][_0x546c04(0x10e)]});_0x45439a[_0x546c04(0x9d)][_0x546c04(0xc2)](_0x3349c6=>{var _0x31c966=_0x546c04,_0x202561=0x0;const _0x50b557=_0x307236[_0x31c966(0xb7)][_0x31c966(0x97)](_0x1345bf=>{var _0xe1e78a=_0x31c966;_0x1345bf['product_name']==_0x3349c6[_0xe1e78a(0x198)]&&_0x1345bf['floorlevel']==_0x3349c6[_0xe1e78a(0x18e)]&&_0x1345bf[_0xe1e78a(0x163)]==_0x3349c6[_0xe1e78a(0x163)]&&_0x1345bf['bin']==_0x3349c6[_0xe1e78a(0xfb)]&&_0x1345bf[_0xe1e78a(0x16a)]==_0x3349c6[_0xe1e78a(0x16a)]&&_0x1345bf[_0xe1e78a(0xfc)]==_0x3349c6['rack']&&_0x1345bf[_0xe1e78a(0x13c)]==_0x3349c6[_0xe1e78a(0x13c)]&&(_0x1345bf[_0xe1e78a(0x16d)]=parseInt(_0x1345bf[_0xe1e78a(0x16d)])+parseInt(_0x3349c6['quantity']),_0x202561++);});_0x202561=='0'&&(_0x307236[_0x31c966(0xb7)]=_0x307236[_0x31c966(0xb7)][_0x31c966(0x148)]({'product_name':_0x3349c6[_0x31c966(0x198)],'product_stock':_0x3349c6[_0x31c966(0x15f)],'primary_code':_0x3349c6[_0x31c966(0x120)],'secondary_code':_0x3349c6[_0x31c966(0xfd)],'product_code':_0x3349c6[_0x31c966(0x1a9)],'storage':_0x3349c6[_0x31c966(0x13c)],'rack':_0x3349c6[_0x31c966(0xfc)],'bay':_0x3349c6['bay'],'bin':_0x3349c6[_0x31c966(0xfb)],'type':_0x3349c6[_0x31c966(0x163)],'floorlevel':_0x3349c6[_0x31c966(0x18e)],'maxProducts':_0x3349c6[_0x31c966(0x172)],'unit':_0x3349c6[_0x31c966(0xf2)],'secondary_unit':_0x3349c6[_0x31c966(0x15a)],'expiry_date':_0x3349c6['expiry_date']}));}),await _0x307236['save']();const _0x2cac89=await s_payment_data[_0x546c04(0x193)]({'invoice':_0x54fff7['body'][_0x546c04(0xd7)]});if(_0x2cac89===null){}else console[_0x546c04(0x1a6)](_0x546c04(0xbf),_0x2cac89,_0x54fff7[_0x546c04(0x173)][_0x546c04(0xd7)]),_0x2cac89[_0x546c04(0xbf)]=_0x54fff7['body'][_0x546c04(0xbf)],await _0x2cac89['save']();_0x54fff7[_0x546c04(0xb6)](_0x546c04(0xba),'purchase\x20data\x20update\x20successfully'),_0x197974['redirect'](_0x546c04(0x19e));}catch(_0x2819f6){console[_0x546c04(0x1a6)](_0x2819f6);}}),router[a0_0x4f8d35(0x157)](a0_0x4f8d35(0x164),auth,async(_0x232cce,_0x577507)=>{var _0x56d4a8=a0_0x4f8d35;try{const _0x3523a2=_0x232cce[_0x56d4a8(0xf9)]['id'],{invoice:_0x4d104a,suppliers:_0x338391,payable:_0x2d98a0,due_amount:_0x3236c4}=_0x232cce[_0x56d4a8(0x173)],_0x391a5a=await purchases[_0x56d4a8(0x19b)](_0x3523a2);var _0x4feaeb=_0x2d98a0-_0x3236c4;_0x391a5a[_0x56d4a8(0x171)]=parseFloat(_0x391a5a[_0x56d4a8(0x171)])+parseFloat(_0x3236c4),_0x391a5a[_0x56d4a8(0xf1)]=_0x4feaeb;const _0x59457f=await _0x391a5a['save']();console['log'](_0x59457f);const _0x2bbcd4=await s_payment_data['findOne']({'invoice':_0x4d104a});_0x2bbcd4[_0x56d4a8(0x13b)]=_0x4feaeb,await _0x2bbcd4[_0x56d4a8(0x94)]();let _0x1982bc=new Date(),_0x3d38d6=('0'+_0x1982bc['getDate']())[_0x56d4a8(0x1ab)](-0x2),_0x2b24a9=('0'+(_0x1982bc[_0x56d4a8(0xfa)]()+0x1))[_0x56d4a8(0x1ab)](-0x2),_0x418217=_0x1982bc[_0x56d4a8(0xe3)](),_0x561522=_0x418217+'-'+_0x2b24a9+'-'+_0x3d38d6;const _0x5eedbf=new suppliers_payment({'invoice':_0x4d104a,'date':_0x418217+'-'+_0x2b24a9+'-'+_0x3d38d6,'suppliers':_0x338391,'reason':_0x56d4a8(0x11d),'amount':_0x3236c4}),_0x391200=await _0x5eedbf[_0x56d4a8(0x94)]();_0x232cce['flash']('success',_0x56d4a8(0xa6)),_0x577507[_0x56d4a8(0x95)](_0x56d4a8(0x19e));}catch(_0x507fdf){console[_0x56d4a8(0x1a6)](_0x507fdf);}}),router['get']('/invoice/:id',auth,async(_0xc5a699,_0x4c3a3f)=>{var _0xa222c5=a0_0x4f8d35;try{const {username:_0x398510,email:_0x20740f,role:_0x512170}=_0xc5a699['user'],_0x4f3109=_0xc5a699[_0xa222c5(0x101)],_0x28f2fb=await profile[_0xa222c5(0x193)]({'email':_0x4f3109['email']}),_0x3b92e8=await master_shop[_0xa222c5(0xa8)]();console[_0xa222c5(0x1a6)](_0xa222c5(0xa1),_0x3b92e8);const _0x50f895=_0xc5a699['params']['id'],_0x58d341=await purchases[_0xa222c5(0x19b)](_0x50f895);console[_0xa222c5(0x1a6)](_0x58d341);const _0x2723c8=await suppliers[_0xa222c5(0x193)]({'name':_0x58d341['suppliers']});console['log'](_0x2723c8);if(_0x3b92e8[0x0][_0xa222c5(0x112)]==_0xa222c5(0x9e)){var _0x5a253f=users['English'];console[_0xa222c5(0x1a6)](_0x5a253f);}else{if(_0x3b92e8[0x0][_0xa222c5(0x112)]==_0xa222c5(0xea))var _0x5a253f=users[_0xa222c5(0xea)];else{if(_0x3b92e8[0x0]['language']==_0xa222c5(0x10b))var _0x5a253f=users[_0xa222c5(0x10b)];else{if(_0x3b92e8[0x0][_0xa222c5(0x112)]==_0xa222c5(0xac))var _0x5a253f=users[_0xa222c5(0xac)];else{if(_0x3b92e8[0x0][_0xa222c5(0x112)]=='French')var _0x5a253f=users[_0xa222c5(0x179)];else{if(_0x3b92e8[0x0][_0xa222c5(0x112)]==_0xa222c5(0x10c))var _0x5a253f=users[_0xa222c5(0x99)];else{if(_0x3b92e8[0x0][_0xa222c5(0x112)]=='Chinese')var _0x5a253f=users[_0xa222c5(0x168)];else{if(_0x3b92e8[0x0][_0xa222c5(0x112)]=='Arabic\x20(ae)')var _0x5a253f=users[_0xa222c5(0x125)];}}}}}}}_0x4c3a3f[_0xa222c5(0x11f)](_0xa222c5(0xb3),{'success':_0xc5a699[_0xa222c5(0xb6)](_0xa222c5(0xba)),'errors':_0xc5a699[_0xa222c5(0xb6)](_0xa222c5(0xd4)),'role':_0x4f3109,'profile':_0x28f2fb,'master_shop':_0x3b92e8,'supplier':_0x2723c8,'purchase':_0x58d341,'language':_0x5a253f});}catch(_0x45d0f1){console[_0xa222c5(0x1a6)](_0x45d0f1);}}),router[a0_0x4f8d35(0x15b)](a0_0x4f8d35(0xbd),auth,async(_0x530b6a,_0x431b86)=>{var _0x24345e=a0_0x4f8d35;try{const {username:_0x29841f,email:_0x4a4340,role:_0x3a8fed}=_0x530b6a[_0x24345e(0x101)],_0x441d46=_0x530b6a[_0x24345e(0x101)],_0x3920b7=await profile[_0x24345e(0x193)]({'email':_0x441d46['email']}),_0x53ba1d=await master_shop[_0x24345e(0xa8)]();console[_0x24345e(0x1a6)](_0x24345e(0xa1),_0x53ba1d);const _0x43552e=_0x530b6a[_0x24345e(0xf9)]['id'];console[_0x24345e(0x1a6)](_0x43552e);const _0x5861f5=await purchases['findById'](_0x43552e);console[_0x24345e(0x1a6)]('user_id',_0x5861f5);const _0x1694a0=await product[_0x24345e(0xa8)]({}),_0x585b48=await warehouse[_0x24345e(0xc6)]([{'$match':{'name':_0x5861f5[_0x24345e(0x10d)],'room':_0x5861f5[_0x24345e(0xaa)],'warehouse_category':_0x24345e(0x143)}},{'$unwind':_0x24345e(0x17a)},{'$group':{'_id':_0x24345e(0xbc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x24345e(0x12f)},'floorlevel':{'$first':_0x24345e(0x18f)},'primary_code':{'$first':_0x24345e(0x152)},'secondary_code':{'$first':_0x24345e(0x140)},'product_code':{'$first':_0x24345e(0x165)},'storage':{'$first':_0x24345e(0x118)},'rack':{'$first':_0x24345e(0xe1)}}}]);warehouse_data=await warehouse[_0x24345e(0xc6)]([{'$match':{'status':_0x24345e(0x93),'name':_0x24345e(0x14b),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x24345e(0xb5),'name':{'$first':_0x24345e(0xb5)}}},{'$sort':{'name':0x1}}]),console[_0x24345e(0x1a6)]('stock_data',_0x585b48);if(_0x53ba1d[0x0][_0x24345e(0x112)]=='English\x20(US)'){var _0x1a7622=users[_0x24345e(0x144)];console[_0x24345e(0x1a6)](_0x1a7622);}else{if(_0x53ba1d[0x0]['language']==_0x24345e(0xea))var _0x1a7622=users[_0x24345e(0xea)];else{if(_0x53ba1d[0x0][_0x24345e(0x112)]==_0x24345e(0x10b))var _0x1a7622=users['German'];else{if(_0x53ba1d[0x0][_0x24345e(0x112)]==_0x24345e(0xac))var _0x1a7622=users[_0x24345e(0xac)];else{if(_0x53ba1d[0x0]['language']==_0x24345e(0x179))var _0x1a7622=users[_0x24345e(0x179)];else{if(_0x53ba1d[0x0][_0x24345e(0x112)]==_0x24345e(0x10c))var _0x1a7622=users[_0x24345e(0x99)];else{if(_0x53ba1d[0x0][_0x24345e(0x112)]=='Chinese')var _0x1a7622=users[_0x24345e(0x168)];else{if(_0x53ba1d[0x0][_0x24345e(0x112)]==_0x24345e(0xde))var _0x1a7622=users[_0x24345e(0x125)];}}}}}}}_0x431b86[_0x24345e(0x11f)](_0x24345e(0x131),{'success':_0x530b6a['flash'](_0x24345e(0xba)),'errors':_0x530b6a['flash']('errors'),'role':_0x441d46,'profile':_0x3920b7,'user':_0x5861f5,'stock':_0x585b48,'master_shop':_0x53ba1d,'product':_0x1694a0,'language':_0x1a7622,'warehouse':warehouse_data});}catch(_0x921910){console['log'](_0x921910);}}),router[a0_0x4f8d35(0x157)](a0_0x4f8d35(0xbd),auth,async(_0x1607bb,_0x2d26d3)=>{var _0x4a2043=a0_0x4f8d35;try{const {invoice:_0x5a2cc0,date:_0x25b628,warehouse_name:_0xc2f933,Room_name:_0x207d99,product_name:_0x289ef2,purchase_quantity:_0xf83856,stocks:_0x1a8bc2,return_qty:_0x232d7e,note:_0x3d2bd3,level:_0x765b20,isle:_0x46dfcb,pallet:_0xa332aa,to_warehouse_name:_0x199db1,to_Room_name:_0x4a1d22}=_0x1607bb['body'],_0x41c8b2=await purchases[_0x4a2043(0x193)]({'_id':_0x1607bb[_0x4a2043(0xf9)]['id']}),_0x1de2aa=await warehouse['findOne']({'name':_0xc2f933,'room':_0x207d99});if(typeof _0x289ef2==_0x4a2043(0x178))var _0x5b4e8f=[_0x1607bb[_0x4a2043(0x173)]['product_name']],_0x6a8e5=[_0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x8d)]],_0xfbefff=[_0x1607bb[_0x4a2043(0x173)]['stocks']],_0x4ffefd=[_0x1607bb[_0x4a2043(0x173)]['return_qty']],_0x43289a=[_0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x8e)]],_0x495652=[_0x1607bb[_0x4a2043(0x173)]['isle']],_0x354a9c=[_0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x115)]],_0x1c5123=[_0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x17d)]],_0x22858c=[_0x1607bb[_0x4a2043(0x173)]['product_code_hide']],_0x1a89c8=[_0x1607bb['body'][_0x4a2043(0x192)]],_0x45d788=[_0x1607bb[_0x4a2043(0x173)]['secondary_code_hide']];else var _0x5b4e8f=[..._0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x198)]],_0x6a8e5=[..._0x1607bb[_0x4a2043(0x173)]['purchase_quantity']],_0xfbefff=[..._0x1607bb[_0x4a2043(0x173)]['stocks']],_0x4ffefd=[..._0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x1aa)]],_0x43289a=[..._0x1607bb['body'][_0x4a2043(0x8e)]],_0x495652=[..._0x1607bb['body']['isle']],_0x354a9c=[..._0x1607bb['body'][_0x4a2043(0x115)]],_0x1c5123=[..._0x1607bb[_0x4a2043(0x173)]['types']],_0x22858c=[..._0x1607bb['body'][_0x4a2043(0x100)]],_0x1a89c8=[..._0x1607bb[_0x4a2043(0x173)][_0x4a2043(0x192)]],_0x45d788=[..._0x1607bb['body'][_0x4a2043(0x1a3)]];const _0x5b9fbb=_0x5b4e8f[_0x4a2043(0x97)](_0xc02ea5=>{return _0xc02ea5={'product_name':_0xc02ea5};});_0x6a8e5[_0x4a2043(0xc2)]((_0x554fc0,_0x1351b5)=>{var _0x5c603e=_0x4a2043;_0x5b9fbb[_0x1351b5][_0x5c603e(0x8d)]=_0x554fc0;}),_0xfbefff['forEach']((_0x4102c2,_0x159115)=>{var _0x801924=_0x4a2043;_0x5b9fbb[_0x159115][_0x801924(0x149)]=_0x4102c2;}),_0x4ffefd[_0x4a2043(0xc2)]((_0x567686,_0x9ffe38)=>{_0x5b9fbb[_0x9ffe38]['return_qty']=_0x567686;}),_0x43289a[_0x4a2043(0xc2)]((_0xe45574,_0x2ffcff)=>{var _0x1ae6e6=_0x4a2043;_0x5b9fbb[_0x2ffcff][_0x1ae6e6(0x16a)]=_0xe45574;}),_0x495652[_0x4a2043(0xc2)]((_0x28db61,_0x50e258)=>{_0x5b9fbb[_0x50e258]['bin']=_0x28db61;}),_0x354a9c['forEach']((_0x2fb092,_0x1d46f2)=>{var _0x2fa16a=_0x4a2043;_0x5b9fbb[_0x1d46f2][_0x2fa16a(0x18e)]=_0x2fb092;}),_0x1c5123['forEach']((_0x183996,_0x3cf934)=>{_0x5b9fbb[_0x3cf934]['type']=_0x183996;}),_0x22858c[_0x4a2043(0xc2)]((_0x239a53,_0x2dbf4d)=>{var _0x190bf3=_0x4a2043;_0x5b9fbb[_0x2dbf4d][_0x190bf3(0x1a9)]=_0x239a53;}),_0x1a89c8[_0x4a2043(0xc2)]((_0x5c5445,_0x49f702)=>{var _0x508cf4=_0x4a2043;_0x5b9fbb[_0x49f702][_0x508cf4(0x120)]=_0x5c5445;}),_0x45d788['forEach']((_0x2f4421,_0x3d3721)=>{var _0x4a0610=_0x4a2043;_0x5b9fbb[_0x3d3721][_0x4a0610(0xfd)]=_0x2f4421;}),_0x41c8b2[_0x4a2043(0x9d)][_0x4a2043(0xc2)](_0x24378c=>{var _0x5c7d72=_0x4a2043;const _0x5906db=_0x1de2aa[_0x5c7d72(0xb7)][_0x5c7d72(0x97)](_0x609c6b=>{var _0x1f3863=_0x5c7d72;_0x609c6b[_0x1f3863(0x198)]==_0x24378c[_0x1f3863(0x198)]&&_0x609c6b[_0x1f3863(0x18e)]==_0x24378c[_0x1f3863(0x18e)]&&_0x609c6b[_0x1f3863(0x163)]==_0x24378c[_0x1f3863(0x163)]&&_0x609c6b[_0x1f3863(0xfb)]==_0x24378c[_0x1f3863(0xfb)]&&_0x609c6b[_0x1f3863(0x16a)]==_0x24378c[_0x1f3863(0x16a)]&&_0x609c6b[_0x1f3863(0xfc)]==_0x24378c['rack']&&_0x609c6b[_0x1f3863(0x13c)]==_0x24378c[_0x1f3863(0x13c)]&&(console['log'](parseInt(_0x609c6b[_0x1f3863(0x16d)])+_0x1f3863(0xcd)+parseInt(_0x24378c[_0x1f3863(0x15f)])),_0x609c6b['product_stock']=parseInt(_0x609c6b['product_stock'])+parseInt(_0x24378c[_0x1f3863(0x15f)]));});}),await _0x1de2aa['save']();const _0x34b5f4=_0x5b9fbb[_0x4a2043(0x162)](_0x2a3150=>_0x2a3150['return_qty']!=='0'&&_0x2a3150['return_qty']!=='');var _0x21e9b7=0x0;_0x34b5f4['forEach'](_0x27f2c0=>{var _0x21b2ed=_0x4a2043;console[_0x21b2ed(0x1a6)]('foreach\x20newproduct',_0x27f2c0),(parseInt(_0x27f2c0[_0x21b2ed(0x8d)])<parseInt(_0x27f2c0['return_qty'])||parseInt(_0x27f2c0[_0x21b2ed(0x149)])<parseInt(_0x27f2c0[_0x21b2ed(0x1aa)]))&&_0x21e9b7++;});if(_0x21e9b7!=0x0)return _0x1607bb['flash'](_0x4a2043(0xd4),_0x4a2043(0xf8)),_0x2d26d3[_0x4a2043(0x95)]('back');const _0x2e9baa=new purchases_return({'invoice':_0x5a2cc0,'suppliers':_0x1607bb['body'][_0x4a2043(0xbf)],'date':_0x25b628,'warehouse_name':_0xc2f933,'return_product':_0x34b5f4,'note':_0x3d2bd3,'room':_0x207d99,'to_warehouse_name':_0x199db1,'to_room':_0x4a1d22}),_0x352974=await _0x2e9baa[_0x4a2043(0x94)]();console[_0x4a2043(0x1a6)](_0x2e9baa);const _0x3d9fdb=await purchases_return[_0x4a2043(0x193)]({'invoice':_0x5a2cc0}),_0x1dc4fe=await warehouse[_0x4a2043(0x193)]({'name':_0x199db1,'room':_0x4a1d22});_0x3d9fdb[_0x4a2043(0x158)][_0x4a2043(0xc2)](_0xf453ce=>{var _0x2ce2d6=_0x4a2043,_0x299086=0x0;const _0x1ef0e6=_0x1dc4fe[_0x2ce2d6(0xb7)]['map'](_0x1440ba=>{var _0x2e6635=_0x2ce2d6;_0x1440ba[_0x2e6635(0x198)]==_0xf453ce['product_name']&&_0x1440ba[_0x2e6635(0x18e)]==_0xf453ce[_0x2e6635(0x18e)]&&_0x1440ba['type']==_0xf453ce['type']&&_0x1440ba[_0x2e6635(0xfb)]==_0xf453ce[_0x2e6635(0xfb)]&&_0x1440ba[_0x2e6635(0x16a)]==_0xf453ce[_0x2e6635(0x16a)]&&(_0x1440ba['product_stock']=parseInt(_0x1440ba[_0x2e6635(0x16d)])-parseInt(_0xf453ce[_0x2e6635(0x1aa)]),_0x299086++);});_0x299086=='0'&&(_0x1dc4fe[_0x2ce2d6(0xb7)]=_0x1dc4fe[_0x2ce2d6(0xb7)][_0x2ce2d6(0x148)]({'product_name':_0xf453ce[_0x2ce2d6(0x198)],'product_stock':_0xf453ce[_0x2ce2d6(0x1aa)],'primary_code':_0xf453ce[_0x2ce2d6(0x120)],'secondary_code':_0xf453ce[_0x2ce2d6(0xfd)],'product_code':_0xf453ce[_0x2ce2d6(0x1a9)],'storage':_0xf453ce[_0x2ce2d6(0x13c)],'rack':_0xf453ce[_0x2ce2d6(0xfc)],'bay':_0xf453ce[_0x2ce2d6(0x16a)],'bin':_0xf453ce[_0x2ce2d6(0xfb)],'type':_0xf453ce[_0x2ce2d6(0x163)],'floorlevel':_0xf453ce[_0x2ce2d6(0x18e)],'maxProducts':_0xf453ce['maxStocks'],'unit':_0xf453ce[_0x2ce2d6(0xf2)],'secondary_unit':_0xf453ce[_0x2ce2d6(0x15a)],'expiry_date':_0xf453ce[_0x2ce2d6(0x10a)]}));}),await _0x1dc4fe[_0x4a2043(0x94)]();const _0x179e44=await purchases[_0x4a2043(0x193)]({'invoice':_0x5a2cc0});_0x179e44[_0x4a2043(0x1a1)]=_0x4a2043(0x14a);const _0xa60a02=await _0x179e44[_0x4a2043(0x94)](),_0x32d7cb=new s_payment_data({'invoice':_0x5a2cc0,'suppliers':_0x1607bb['body'][_0x4a2043(0xbf)],'reason':'Purchase\x20Return'});await _0x32d7cb[_0x4a2043(0x94)]();const _0x7aa1ba=await master_shop[_0x4a2043(0xa8)]();console[_0x4a2043(0x1a6)](_0x4a2043(0x134),_0x7aa1ba[0x0]['image']);const _0xae52e=await email_settings[_0x4a2043(0x193)](),_0x2444e8=await suppliers[_0x4a2043(0x193)]({'name':_0x1607bb['body']['suppliers']});console[_0x4a2043(0x1a6)](_0x4a2043(0xc1),_0x2444e8);_0x7aa1ba[0x0][_0x4a2043(0xc3)]==0x1?(right_currency=_0x7aa1ba[0x0][_0x4a2043(0x187)],left_currency=''):(right_currency='',left_currency=_0x7aa1ba[0x0][_0x4a2043(0x187)]);var _0x406331=_0x5b4e8f,_0xd4efc8=_0x4ffefd,_0x4f55a7='',_0x281b41;for(_0x281b41 in _0x406331){_0x4f55a7+=_0x4a2043(0x180)+_0x4a2043(0x11a)+_0x406331[_0x281b41]+_0x4a2043(0xfe)+_0x4a2043(0x11a)+_0xd4efc8[_0x281b41]+'</td>'+_0x4a2043(0x111);}console['log'](_0x4a2043(0x8f),_0x4f55a7);let _0x52ae2f=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0xae52e[_0x4a2043(0xcc)],'pass':_0xae52e[_0x4a2043(0x8a)]}}),_0x26a6c8={'from':_0xae52e[_0x4a2043(0xcc)],'to':_0x2444e8[_0x4a2043(0xcc)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x4a2043(0xdb)+_0x4a2043(0x113)+_0x7aa1ba[0x0]['image'],'cid':_0x4a2043(0x156)}],'html':_0x4a2043(0xb4)+_0x4a2043(0x102)+_0x4a2043(0x14e)+_0x4a2043(0xe7)+_0x4a2043(0x12b)+_0x4a2043(0xe7)+_0x4a2043(0x12c)+_0x4a2043(0x109)+_0x4a2043(0xe7)+_0x4a2043(0xa7)+_0x7aa1ba[0x0][_0x4a2043(0x188)]+'\x20</h2>'+_0x4a2043(0x109)+_0x4a2043(0x109)+'<hr\x20class=\x22my-3\x22>'+_0x4a2043(0xe7)+_0x4a2043(0xec)+_0x4a2043(0xc8)+_0x5a2cc0+'\x20'+_0x4a2043(0x183)+_0x4a2043(0xa0)+_0x25b628+'\x20'+'</span>'+_0x4a2043(0xce)+_0x4a2043(0x109)+_0x4a2043(0x9c)+_0x4a2043(0xf4)+_0x4a2043(0x180)+_0x4a2043(0x169)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x4a2043(0x160)+_0x4a2043(0x111)+_0x4a2043(0x90)+_0x4a2043(0x126)+'\x20'+_0x4f55a7+'\x20'+_0x4a2043(0x108)+'</table>'+_0x4a2043(0xe7)+_0x4a2043(0x13d)+_0x4a2043(0x191)+_0x7aa1ba[0x0]['site_title']+_0x4a2043(0xce)+_0x4a2043(0x109)+_0x4a2043(0x109)+_0x4a2043(0x104)};_0x52ae2f[_0x4a2043(0x195)](_0x26a6c8,function(_0x558b4f,_0x2c7dc9){var _0x3135f8=_0x4a2043;_0x558b4f?(console['log'](_0x558b4f),console[_0x3135f8(0x1a6)](_0x3135f8(0x123))):console[_0x3135f8(0x1a6)](_0x3135f8(0x174));}),_0x1607bb[_0x4a2043(0xb6)](_0x4a2043(0xba),_0x4a2043(0x167)),_0x2d26d3['redirect']('/all_purchases/view');}catch(_0x2032da){console[_0x4a2043(0x1a6)](_0x2032da),_0x2d26d3['status'](0xc8)[_0x4a2043(0xc0)]({'message':_0x2032da[_0x4a2043(0x184)]});}}),router[a0_0x4f8d35(0x15b)](a0_0x4f8d35(0xed),auth,async(_0x12d40a,_0x9090c)=>{var _0xdf6cab=a0_0x4f8d35;try{const {username:_0x4bae15,email:_0x192d0d,role:_0x1ce1ff}=_0x12d40a[_0xdf6cab(0x101)],_0xb0b56f=_0x12d40a[_0xdf6cab(0x101)],_0x48c366=await profile[_0xdf6cab(0x193)]({'email':_0xb0b56f[_0xdf6cab(0xcc)]}),_0x15685b=await master_shop[_0xdf6cab(0xa8)](),_0x5bcf20=_0x12d40a[_0xdf6cab(0xf9)]['id'],_0x5d59e7=await purchases[_0xdf6cab(0x19b)](_0x5bcf20);if(_0x15685b[0x0][_0xdf6cab(0x112)]==_0xdf6cab(0x9e))var _0xce3746=users['English'];else{if(_0x15685b[0x0][_0xdf6cab(0x112)]==_0xdf6cab(0xea))var _0xce3746=users[_0xdf6cab(0xea)];else{if(_0x15685b[0x0][_0xdf6cab(0x112)]==_0xdf6cab(0x10b))var _0xce3746=users[_0xdf6cab(0x10b)];else{if(_0x15685b[0x0][_0xdf6cab(0x112)]==_0xdf6cab(0xac))var _0xce3746=users['Spanish'];else{if(_0x15685b[0x0]['language']==_0xdf6cab(0x179))var _0xce3746=users[_0xdf6cab(0x179)];else{if(_0x15685b[0x0]['language']==_0xdf6cab(0x10c))var _0xce3746=users[_0xdf6cab(0x99)];else{if(_0x15685b[0x0]['language']==_0xdf6cab(0x168))var _0xce3746=users[_0xdf6cab(0x168)];else{if(_0x15685b[0x0][_0xdf6cab(0x112)]==_0xdf6cab(0xde))var _0xce3746=users['Arabic'];}}}}}}}_0x9090c[_0xdf6cab(0x11f)](_0xdf6cab(0x14d),{'success':_0x12d40a[_0xdf6cab(0xb6)](_0xdf6cab(0xba)),'errors':_0x12d40a[_0xdf6cab(0xb6)](_0xdf6cab(0xd4)),'role':_0xb0b56f,'profile':_0x48c366,'alldata':_0x5d59e7,'master_shop':_0x15685b,'language':_0xce3746}),console[_0xdf6cab(0x1a6)](alldata);}catch(_0x4a21d6){console[_0xdf6cab(0x1a6)](_0x4a21d6);}}),router[a0_0x4f8d35(0x157)](a0_0x4f8d35(0x17e),async(_0x2bf747,_0x1d4031)=>{var _0x5f33d0=a0_0x4f8d35;const {product_code:_0x5ed265}=_0x2bf747['body'];var _0x276155;const _0xa0f82a=await product[_0x5f33d0(0xc6)]([{'$match':{'primary_code':_0x5ed265,'product_category':_0x5f33d0(0x143)}},{'$group':{'_id':_0x5f33d0(0xab),'name':{'$first':_0x5f33d0(0xb5)},'category':{'$first':_0x5f33d0(0x14f)},'brand':{'$first':_0x5f33d0(0xf7)},'unit':{'$first':_0x5f33d0(0xad)},'alertquantity':{'$first':_0x5f33d0(0x137)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5f33d0(0x9f)},'secondary_code':{'$first':_0x5f33d0(0x106)},'maxStocks':{'$first':_0x5f33d0(0x15e)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5f33d0(0xe8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x29e501=await product[_0x5f33d0(0xc6)]([{'$match':{'secondary_code':_0x5ed265,'product_category':_0x5f33d0(0x143)}},{'$group':{'_id':_0x5f33d0(0xab),'name':{'$first':_0x5f33d0(0xb5)},'category':{'$first':_0x5f33d0(0x14f)},'brand':{'$first':_0x5f33d0(0xf7)},'unit':{'$first':_0x5f33d0(0xad)},'alertquantity':{'$first':_0x5f33d0(0x137)},'product_code':{'$first':_0x5f33d0(0x128)},'primary_code':{'$first':_0x5f33d0(0x9f)},'secondary_code':{'$first':_0x5f33d0(0x106)},'maxStocks':{'$first':_0x5f33d0(0x15e)},'maxProdPerUnit':{'$first':_0x5f33d0(0x16f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5f33d0(0xe8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xa0f82a[_0x5f33d0(0xa2)]>0x0)_0x276155=_0xa0f82a;else _0x29e501['length']>0x0&&(_0x276155=_0x29e501);_0x1d4031[_0x5f33d0(0xc0)](_0x276155);}),router[a0_0x4f8d35(0x157)](a0_0x4f8d35(0x110),async(_0x114865,_0xdfbf0e)=>{var _0x824133=a0_0x4f8d35;const {primaryCode:_0x280069,secondaryCode:_0x502254,productCode:_0x4788ba,bay:_0x34ec1a,bin:_0x196123,types:_0x33ce92,pallet:_0x4b0d14,warehouses:_0x13382e,room:_0x5f0eaf}=_0x114865['body'];console[_0x824133(0x1a6)](_0x114865['body']);try{const _0x570c1a=await warehouse[_0x824133(0xc6)]([{'$match':{'name':_0x13382e,'room':_0x5f0eaf}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x34ec1a,'product_details.bin':_0x196123,'product_details.type':_0x33ce92}},{'$group':{'_id':_0x824133(0xbc),'name':{'$first':_0x824133(0x146)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x824133(0xff)},'isle':{'$first':_0x824133(0x91)},'pallet':{'$first':_0x824133(0x16c)},'maxProducts':{'$first':_0x824133(0x190)}}}]);_0xdfbf0e[_0x824133(0x17c)](0xc8)[_0x824133(0xc0)](_0x570c1a);}catch(_0x53676a){_0xdfbf0e[_0x824133(0x17c)](0x194)['json']({'message':_0x53676a[_0x824133(0x184)]});}}),module['exports']=router;