var a0_0x44936e=a0_0x3c30;(function(_0x4a38f8,_0x1a7e37){var _0x48ab01=a0_0x3c30,_0x39f1d0=_0x4a38f8();while(!![]){try{var _0x177177=-parseInt(_0x48ab01(0x279))/0x1+parseInt(_0x48ab01(0x29c))/0x2*(parseInt(_0x48ab01(0x287))/0x3)+-parseInt(_0x48ab01(0x1c7))/0x4*(-parseInt(_0x48ab01(0x1dd))/0x5)+-parseInt(_0x48ab01(0x22b))/0x6*(parseInt(_0x48ab01(0x20f))/0x7)+-parseInt(_0x48ab01(0x1e1))/0x8+parseInt(_0x48ab01(0x292))/0x9+parseInt(_0x48ab01(0x29b))/0xa*(-parseInt(_0x48ab01(0x2b8))/0xb);if(_0x177177===_0x1a7e37)break;else _0x39f1d0['push'](_0x39f1d0['shift']());}catch(_0x1b69fb){_0x39f1d0['push'](_0x39f1d0['shift']());}}}(a0_0x554b,0x20df6));const express=require(a0_0x44936e(0x231)),app=express(),router=express[a0_0x44936e(0x2a0)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x44936e(0x1e4)),auth=require(a0_0x44936e(0x26a)),nodemailer=require(a0_0x44936e(0x237));function a0_0x3c30(_0x9d89c3,_0x4813be){var _0x554b3b=a0_0x554b();return a0_0x3c30=function(_0x3c30a0,_0x5e029b){_0x3c30a0=_0x3c30a0-0x1b6;var _0x425f59=_0x554b3b[_0x3c30a0];return _0x425f59;},a0_0x3c30(_0x9d89c3,_0x4813be);}var ejs=require(a0_0x44936e(0x2c0));const path=require(a0_0x44936e(0x2b5)),users=require(a0_0x44936e(0x2b1));function a0_0x554b(){var _0x41f959=['filter','types','redirect','actual_uom','suppliers_docs','primary_code','abs','all_purchases_barcode','master','actual_qty','RMSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','date','Rack\x20A','date_data','$product_details.product_code','POnumber','/view/add_purchases','$product_details._id','getFullYear','240oDWHyK','log','<tbody\x20style=\x22text-align:\x20center;\x22>','aggregate','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_list','express','English\x20(US)','$suppliers','$date','save','prod_cat','nodemailer','foreach\x20newproduct','\x20<\x20wew\x20>\x20','$expiry_date','length','standard_unit','product_code','Portuguese\x20(BR)','/upload/','amount','storage','Error\x20Occurs','Email\x20sent\x20successfully','name','</div>','/preview/:id','product_stock','$batch_code','<span\x20style=\x22float:\x20right;\x22>','product_name','getMonth','$secondary_code','map','$primary_code','edit_purchases_view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Room_name','$product_details.primary_code','prod_pallet','Purchase\x20Return','$warehouse_name','Shelves','production_date','host','flash','Rack\x20B','INC-','get','image','isle','password','$paid_amount','table\x20page','catch','Rack\x20F','Sales\x20Update\x20successfully','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','site_title','prod_primunit','German','staff','../middleware/auth','/invoice/:id','paid_amount','random','json','rak','/all_purchases/view','email','/view','product_details','Purchase\x20Mail','post','rack','<h5>','back','29034GdtnLm','$product_details.product_stock','maxStocks','\x20Order\x20Date\x20:\x20','</thead>','createTransport','$product.bin','padStart','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</body></html>','Level','$product_details.storage','/../public','here','23988OfEMZD','$room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','note','</td>','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<!DOCTYPE\x20html>','return_qty','push','<hr\x20class=\x22my-3\x22>','1661049aOKIze','bin','<tr>','$_id','suppliers','currency_placement','level','$secondary_unit','/barcode_scanner','381770wqYzlc','36yilHJb','prod_invoice','purchase_invoice','deliverycode','Router','maxperunit','$product','/barcode/:id','prod_qty','$brand','<div>','all_purchases','render','Spanish','type','</span>','$product_details.rack','<strong>\x20Regards\x20</strong>','stock_data','English','$note','../public/language/languages.json','<h2>\x20','Raw\x20Materials','Receiving\x20Area','path','room','Rack\x20C','77dcvYSR','find','stocks','delivery_date','$unit','body','concat','$product_details.secondary_code','ejs','$alertquantity','$product.bay','True','Hindi','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Enabled','string','Chinese','logo','bay','due_amount','Ambient','DRY\x20STORAGE','gmail','$product_details.bay','</table>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','user','getDate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','batch_code','status','/CheckingWarehouse','prod_isle','<h5\x20style=\x22text-align:\x20left;\x22>','invoice','French','product_cat','findOne','$invoice','MaxStocks_data','Portuguese','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchases\x20item\x20return\x20successfull','prod_unit','user_id','RoomAssign','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','message','$product.floorlevel','product_code_hide','suppliers_data','currency','$product_details.isle','role','toString','132pzXcEV','forEach','\x20Order\x20Number\x20:\x20','$product_details.product_name','deliverydate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Rack\x20D','</tr>','$name','$maxStocks','errors','Return\x20Goods','</tbody>','secondary_code_hide','$product_details.type','Purchase\x20Return\x20Mail','$product.quantity','Floor','purchase_quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','product','$maxProdPerUnit','36485RaaRlR','secondary_unit','max_product_unit','warehouse','827288rHwdzg','Purchase\x20data\x20added\x20successfully','delivery_code','../models/all_models','\x20</h2>','$product_details.level','add_purchases','warehouse_name','alertQTY','prod_Qty','$product_code','$product_details.floorlevel','primary_code_hide','</h5>','then','Paid\x20For\x20Purchase','all','secondary_code','$category','Arabic','$finalize','add_purchases\x20error','$suppliers_docs','$product_details.maxProducts','error','/give_payment/:id','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.type','$due_amount','JO_number','finalize','success','/view/return_purchase/:id','params','language','expiry_date','prod_secondunit','quantity','slice','prod_name','\x20<>\x20','/view/:id','purchase\x20data\x20update\x20successfully','<html><head><title></title>','exports','6118DbBsXX','Arabic\x20(ae)','floorlevel','$product_details.pallet','/view/add_purchases/:id','COLD\x20STORAGE','$product_details','pallet'];a0_0x554b=function(){return _0x41f959;};return a0_0x554b();}router[a0_0x44936e(0x25c)](a0_0x44936e(0x272),auth,async(_0x31d0b6,_0x570d90)=>{var _0x33a6dc=a0_0x44936e;try{const {username:_0x3f3805,email:_0x24f25c,role:_0x5c6e22}=_0x31d0b6[_0x33a6dc(0x2d3)],_0x4d1d49=_0x31d0b6[_0x33a6dc(0x2d3)],_0x22a4f3=await profile[_0x33a6dc(0x2de)]({'email':_0x4d1d49[_0x33a6dc(0x271)]}),_0x9b8b0b=await staff[_0x33a6dc(0x2de)]({'email':_0x4d1d49[_0x33a6dc(0x271)]});if(_0x4d1d49[_0x33a6dc(0x1c5)]==_0x33a6dc(0x269)){const _0x28d58b=await staff['findOne']({'email':_0x4d1d49[_0x33a6dc(0x271)]});}const _0x3989de=await master_shop['find']();let _0x1447c0;if(_0x4d1d49[_0x33a6dc(0x1c5)]==_0x33a6dc(0x269)){const _0x3c3f19=await staff[_0x33a6dc(0x2de)]({'email':_0x4d1d49[_0x33a6dc(0x271)]});_0x1447c0=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3c3f19[_0x33a6dc(0x1e0)]}},{'$lookup':{'from':_0x33a6dc(0x296),'localField':'suppliers','foreignField':_0x33a6dc(0x244),'as':_0x33a6dc(0x21b)}},{'$unwind':_0x33a6dc(0x1f7)},{'$unwind':'$product'},{'$group':{'_id':_0x33a6dc(0x295),'invoice':{'$first':_0x33a6dc(0x1b6)},'suppliers':{'$first':_0x33a6dc(0x233)},'date':{'$first':_0x33a6dc(0x234)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x33a6dc(0x288)},'product':{'$push':_0x33a6dc(0x2a2)},'note':{'$first':_0x33a6dc(0x2b0)},'paid_amount':{'$first':_0x33a6dc(0x260)},'due_amount':{'$first':_0x33a6dc(0x1fe)},'return_data':{'$first':_0x33a6dc(0x1fb)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x33a6dc(0x23a)},'suppliers_docs':{'$first':_0x33a6dc(0x1f7)},'total_product_quantity':{'$sum':_0x33a6dc(0x1d7)},'level':{'$addToSet':_0x33a6dc(0x2c2)},'isle':{'$addToSet':_0x33a6dc(0x27f)},'type':{'$addToSet':_0x33a6dc(0x1fd)},'floorlevel':{'$addToSet':_0x33a6dc(0x1c0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1447c0=await purchases[_0x33a6dc(0x22e)]([{'$lookup':{'from':_0x33a6dc(0x296),'localField':_0x33a6dc(0x296),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x33a6dc(0x1b6)},'suppliers':{'$first':_0x33a6dc(0x233)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x33a6dc(0x255)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x33a6dc(0x2a2)},'note':{'$first':_0x33a6dc(0x2b0)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x33a6dc(0x1fe)},'return_data':{'$first':_0x33a6dc(0x1fb)},'batch_code':{'$first':_0x33a6dc(0x248)},'expiry_date':{'$first':_0x33a6dc(0x23a)},'suppliers_docs':{'$first':_0x33a6dc(0x1f7)},'total_product_quantity':{'$sum':_0x33a6dc(0x1d7)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x33a6dc(0x27f)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x33a6dc(0x1f5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x3989de[0x0]['language']==_0x33a6dc(0x232)){var _0x4ebc78=users[_0x33a6dc(0x2af)];console[_0x33a6dc(0x22c)](_0x4ebc78);}else{if(_0x3989de[0x0]['language']==_0x33a6dc(0x2c4))var _0x4ebc78=users[_0x33a6dc(0x2c4)];else{if(_0x3989de[0x0][_0x33a6dc(0x204)]==_0x33a6dc(0x268))var _0x4ebc78=users[_0x33a6dc(0x268)];else{if(_0x3989de[0x0][_0x33a6dc(0x204)]==_0x33a6dc(0x2a9))var _0x4ebc78=users['Spanish'];else{if(_0x3989de[0x0][_0x33a6dc(0x204)]==_0x33a6dc(0x2dc))var _0x4ebc78=users[_0x33a6dc(0x2dc)];else{if(_0x3989de[0x0][_0x33a6dc(0x204)]=='Portuguese\x20(BR)')var _0x4ebc78=users[_0x33a6dc(0x1b8)];else{if(_0x3989de[0x0][_0x33a6dc(0x204)]=='Chinese')var _0x4ebc78=users[_0x33a6dc(0x2c9)];else{if(_0x3989de[0x0]['language']==_0x33a6dc(0x210))var _0x4ebc78=users[_0x33a6dc(0x1f4)];}}}}}}}_0x570d90['render'](_0x33a6dc(0x2a7),{'success':_0x31d0b6['flash']('success'),'errors':_0x31d0b6[_0x33a6dc(0x259)](_0x33a6dc(0x1d1)),'purchases':_0x1447c0,'role':_0x4d1d49,'profile':_0x22a4f3,'master_shop':_0x3989de,'language':_0x4ebc78});}catch(_0x3a392e){console['log'](_0x33a6dc(0x261),_0x3a392e),_0x570d90[_0x33a6dc(0x2d7)](0xc8)['json']({'message':_0x3a392e[_0x33a6dc(0x1bf)]});}});function BayBinSelected(_0x3ccc1f,_0x57f511){var _0x3b1ac9=a0_0x44936e,_0x7791a0=[],_0xc8e562=[],_0x5e488d=[],_0x4c9ea2=[],_0x28f763=[],_0x192515=[];let _0x5c0f6a=[];if(_0x3ccc1f==_0x3b1ac9(0x2ce))switch(_0x57f511){case'Rack\x20A':_0x7791a0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xc8e562=[0x1,0x2],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x283),'Floor'],_0x28f763=['D'],_0x192515=['A'];break;case _0x3b1ac9(0x25a):_0x7791a0=[0x6,0x5,0x4,0x3,0x2,0x1],_0xc8e562=[0x1,0x2],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x283),_0x3b1ac9(0x1d8)],_0x28f763=['D'],_0x192515=['B'];break;case _0x3b1ac9(0x256):_0x7791a0=[0x0],_0xc8e562=[0x0],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x1d8)],_0x28f763=['D'],_0x192515=['S'];break;case _0x3b1ac9(0x2b4):_0x7791a0=[0x0],_0xc8e562=[0x0],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5e488d=[_0x3b1ac9(0x1d8)],_0x28f763=['D'],_0x192515=['R'];break;}else{if(_0x3ccc1f==_0x3b1ac9(0x214))switch(_0x57f511){case _0x3b1ac9(0x224):_0x7791a0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xc8e562=['B','F'],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x283),'Floor'],_0x28f763=['C'],_0x192515=['A'];break;case _0x3b1ac9(0x25a):_0x7791a0=[0x5,0x4,0x3,0x2,0x1],_0xc8e562=['F','B','S'],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x283),_0x3b1ac9(0x1d8)],_0x28f763=['C'],_0x192515=['B'];break;case _0x3b1ac9(0x2b7):_0x7791a0=[0x1,0x2,0x3,0x4,0x5],_0xc8e562=['B','F','S'],_0x4c9ea2=[0x5,0x4,0x3,0x2,0x1],_0x5e488d=[_0x3b1ac9(0x283),_0x3b1ac9(0x1d8)],_0x28f763=['C'],_0x192515=['C'];break;case _0x3b1ac9(0x1cd):_0x7791a0=[0x5,0x4,0x3,0x2,0x1],_0xc8e562=['F','B','S'],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=['Level',_0x3b1ac9(0x1d8)],_0x28f763=['C'],_0x192515=['D'];break;case'Rack\x20E':_0x7791a0=[0x4,0x3,0x2,0x1],_0xc8e562=[0x1,0x2],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x283),'Floor'],_0x28f763=['C'],_0x192515=['E'];break;case _0x3b1ac9(0x263):_0x7791a0=[0x1,0x2,0x3],_0xc8e562=[0x1,0x2],_0x4c9ea2=[0x1,0x2,0x3,0x4,0x5],_0x5e488d=[_0x3b1ac9(0x283)],_0x28f763=['C'],_0x192515=['F'];break;}}return{'levels':_0x7791a0,'Isle':_0xc8e562,'rack':_0x4c9ea2,'type':_0x5e488d,'storage':_0x28f763,'rak':_0x192515};}async function getRandom8DigitNumber(){var _0x22f7c8=a0_0x44936e;const _0x12dead=0x989680,_0x138de4=0x5f5e0ff,_0xa3087c=Math['floor'](Math[_0x22f7c8(0x26d)]()*(_0x138de4-_0x12dead+0x1))+_0x12dead;var _0x35d7db;const _0x4e9b4c=await purchases[_0x22f7c8(0x2de)]({'invoice':_0x22f7c8(0x25b)+_0xa3087c});return _0x4e9b4c&&_0x4e9b4c[_0x22f7c8(0x23b)]>0x0?_0x35d7db='INC-'+_0xa3087c:_0x35d7db='INC-'+_0xa3087c,_0x35d7db;}router[a0_0x44936e(0x25c)](a0_0x44936e(0x228),auth,async(_0x4fa7c6,_0x3aa404)=>{var _0x403649=a0_0x44936e;try{const {username:_0x5eb47c,email:_0x1b0536,role:_0x3e55d8}=_0x4fa7c6[_0x403649(0x2d3)],_0x553cd1=_0x4fa7c6[_0x403649(0x2d3)],_0x5ed8ca=await profile[_0x403649(0x2de)]({'email':_0x553cd1[_0x403649(0x271)]}),_0x422506=await master_shop[_0x403649(0x2b9)](),_0x54f6f1=await staff['findOne']({'email':_0x553cd1[_0x403649(0x271)]}),_0x46d617=await suppliers[_0x403649(0x2b9)]({});let _0x409f9d;if(_0x553cd1[_0x403649(0x1c5)]=='staff'){const _0x5ef49c=await staff[_0x403649(0x2de)]({'email':_0x553cd1[_0x403649(0x271)]});_0x409f9d=await warehouse[_0x403649(0x22e)]([{'$match':{'status':_0x403649(0x2c7),'name':_0x5ef49c[_0x403649(0x1e0)],'warehouse_category':_0x403649(0x2b3),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x403649(0x1cf),'name':{'$first':_0x403649(0x1cf)}}}]);}else _0x409f9d=await warehouse[_0x403649(0x22e)]([{'$match':{'status':_0x403649(0x2c7),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x403649(0x1d2)}}},{'$group':{'_id':_0x403649(0x1cf),'name':{'$first':_0x403649(0x1cf)}}}]);const _0x2a348e=await product[_0x403649(0x2b9)]({}),_0x1bb055=await warehouse[_0x403649(0x2b9)]({'status':_0x403649(0x2c7)}),_0x3722f9=await purchases['find']({}),_0x15d36c=_0x3722f9[_0x403649(0x23b)]+0x1,_0x212781=_0x403649(0x25b)+_0x15d36c[_0x403649(0x1c6)]()[_0x403649(0x280)](0x5,'0');var _0x35062a=[_0x403649(0x2cd),'Enclosed'];if(_0x422506[0x0][_0x403649(0x204)]=='English\x20(US)')var _0x577cd4=users[_0x403649(0x2af)];else{if(_0x422506[0x0][_0x403649(0x204)]=='Hindi')var _0x577cd4=users[_0x403649(0x2c4)];else{if(_0x422506[0x0][_0x403649(0x204)]==_0x403649(0x268))var _0x577cd4=users[_0x403649(0x268)];else{if(_0x422506[0x0]['language']==_0x403649(0x2a9))var _0x577cd4=users[_0x403649(0x2a9)];else{if(_0x422506[0x0][_0x403649(0x204)]==_0x403649(0x2dc))var _0x577cd4=users[_0x403649(0x2dc)];else{if(_0x422506[0x0][_0x403649(0x204)]==_0x403649(0x23e))var _0x577cd4=users[_0x403649(0x1b8)];else{if(_0x422506[0x0][_0x403649(0x204)]==_0x403649(0x2c9))var _0x577cd4=users[_0x403649(0x2c9)];else{if(_0x422506[0x0][_0x403649(0x204)]==_0x403649(0x210))var _0x577cd4=users['Arabic'];}}}}}}}const _0x240498=getRandom8DigitNumber();_0x240498[_0x403649(0x1ef)](_0x37c57b=>{var _0xb12792=_0x403649;_0x3aa404['render'](_0xb12792(0x1e7),{'success':_0x4fa7c6['flash'](_0xb12792(0x201)),'errors':_0x4fa7c6[_0xb12792(0x259)](_0xb12792(0x1d1)),'role':_0x553cd1,'profile':_0x5ed8ca,'suppliers':_0x46d617,'warehouse':_0x409f9d,'product':_0x2a348e,'invoice':_0x37c57b,'master_shop':_0x422506,'language':_0x577cd4,'find_data':_0x1bb055,'rooms_data':_0x35062a});})[_0x403649(0x262)](_0x5d6091=>{var _0x4622c9=_0x403649;_0x4fa7c6['flash'](_0x4622c9(0x1d1),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3aa404[_0x4622c9(0x219)](_0x4622c9(0x270));});}catch(_0x290a6a){console[_0x403649(0x22c)](_0x290a6a);}}),router[a0_0x44936e(0x25c)](a0_0x44936e(0x213),auth,async(_0x42be38,_0x3c2db7)=>{var _0x320c1=a0_0x44936e;try{const _0x2f3637=_0x42be38[_0x320c1(0x203)]['id'];console[_0x320c1(0x22c)](_0x2f3637);const _0x2c9540=await master_shop['find']();console[_0x320c1(0x22c)]('master',_0x2c9540);const _0x32fb66=await product[_0x320c1(0x2de)]({'name':_0x2f3637});console[_0x320c1(0x22c)](_0x320c1(0x1db),_0x32fb66),_0x3c2db7[_0x320c1(0x2d7)](0xc8)['json']({'product_data':_0x32fb66,'master':_0x2c9540});}catch(_0x445201){console[_0x320c1(0x22c)](_0x320c1(0x1f6),_0x445201);}}),router[a0_0x44936e(0x275)](a0_0x44936e(0x228),auth,async(_0x1df427,_0x59ea70)=>{var _0x1559dc=a0_0x44936e;try{const {invoice:_0x3fd5ad,date:_0x1a772e,warehouse_name:_0x3aeaaa,prod_name:_0x4152fa,prod_code:_0x5a9d13,prod_qty:_0x503c31,prod_unit:_0x525007,prod_secondunit:_0x991990,prod_level:_0x1bc28c,prod_isle:_0x1f4316,prod_pallet:_0x28d8b0,note:_0x22dafa,expiry_date:_0x4a9a8f,batch_code:_0x172e65,payable:_0x51423d,due_amount:_0x53a80c,Room_name:_0x2780a0,primary_code:_0x13a337,secondary_code:_0x540275,MaxStocks_data:_0xfbd7fe,PO_number:_0x445894,SCRN:_0x3a1c01,JO_number:_0x53848c}=_0x1df427[_0x1559dc(0x2bd)];if(typeof _0x4152fa==_0x1559dc(0x2c8))var _0x58a257=[_0x1df427[_0x1559dc(0x2bd)]['prod_name']],_0x413930=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x28c)]],_0x333311=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1ea)]],_0xdae860=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x267)]],_0x5a6e55=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x206)]],_0x4926f4=[_0x1df427[_0x1559dc(0x2bd)]['prod_level']],_0x3596e9=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x21c)]],_0xaf1e51=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1f2)]],_0x234b7f=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1b7)]],_0x444b83=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x2d6)]],_0x2f5feb=[_0x1df427[_0x1559dc(0x2bd)]['expiry_date']],_0x25bc44=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1df)]],_0x2c0efb=[_0x1df427[_0x1559dc(0x2bd)]['alertQTY']],_0x5c7e41=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x257)]],_0x42507d=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x236)]],_0x275494=[_0x1df427['body'][_0x1559dc(0x1bd)]],_0x53a463=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x29f)]],_0xd7fe92=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x29d)]],_0x41a21b=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x220)]],_0x3f4fc3=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x21a)]],_0x5a3505=[_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1cb)]];else var _0x58a257=[..._0x1df427['body'][_0x1559dc(0x209)]],_0x413930=[..._0x1df427[_0x1559dc(0x2bd)]['prod_code']],_0x333311=[..._0x1df427[_0x1559dc(0x2bd)]['prod_Qty']],_0xdae860=[..._0x1df427['body'][_0x1559dc(0x267)]],_0x5a6e55=[..._0x1df427[_0x1559dc(0x2bd)]['prod_secondunit']],_0x4926f4=[..._0x1df427[_0x1559dc(0x2bd)]['prod_level']],_0x3596e9=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x21c)]],_0xaf1e51=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1f2)]],_0x234b7f=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1b7)]],_0x444b83=[..._0x1df427[_0x1559dc(0x2bd)]['batch_code']],_0x2f5feb=[..._0x1df427['body'][_0x1559dc(0x205)]],_0x25bc44=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1df)]],_0x2c0efb=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1e9)]],_0x5c7e41=[..._0x1df427['body']['production_date']],_0x42507d=[..._0x1df427['body']['prod_cat']],_0x275494=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1bd)]],_0x53a463=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x29f)]],_0xd7fe92=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x29d)]],_0x41a21b=[..._0x1df427['body'][_0x1559dc(0x220)]],_0x3f4fc3=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x21a)]],_0x5a3505=[..._0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x1cb)]];const _0xd1806c=_0x58a257[_0x1559dc(0x24d)](_0xaa8f11=>{return _0xaa8f11={'product_name':_0xaa8f11};});_0x41a21b[_0x1559dc(0x1c8)]((_0x50d1c4,_0x1018e8)=>{var _0x194080=_0x1559dc;_0xd1806c[_0x1018e8][_0x194080(0x220)]=Math[_0x194080(0x21d)](_0x50d1c4);}),_0x3f4fc3['forEach']((_0x4e6de1,_0x4712a5)=>{var _0x11568e=_0x1559dc;_0xd1806c[_0x4712a5][_0x11568e(0x21a)]=_0x4e6de1;}),_0x413930[_0x1559dc(0x1c8)]((_0x4b6fcc,_0x487b63)=>{var _0xfda564=_0x1559dc;_0xd1806c[_0x487b63][_0xfda564(0x23d)]=_0x4b6fcc,_0xd1806c[_0x487b63][_0xfda564(0x225)]=_0x1a772e;}),_0x333311[_0x1559dc(0x1c8)]((_0x411550,_0x5fbca3)=>{var _0x51e709=_0x1559dc;_0xd1806c[_0x5fbca3][_0x51e709(0x207)]=Math['abs'](_0x411550);}),_0xdae860[_0x1559dc(0x1c8)]((_0x32c740,_0xb78aa0)=>{_0xd1806c[_0xb78aa0]['standard_unit']=_0x32c740;}),_0x5a6e55[_0x1559dc(0x1c8)]((_0x2ac922,_0x1c2a54)=>{var _0x564f29=_0x1559dc;_0xd1806c[_0x1c2a54][_0x564f29(0x1de)]=_0x2ac922;}),_0x4926f4[_0x1559dc(0x1c8)]((_0x46b99f,_0x1bedd5)=>{var _0x4eaa4e=_0x1559dc;_0x275494[_0x4eaa4e(0x1c8)]((_0x311922,_0x4a1a4f)=>{var _0x1f9de0=_0x4eaa4e;if(_0x311922==_0x1f9de0(0x2b4)&&_0x1bedd5==_0x4a1a4f){console[_0x1f9de0(0x22c)](_0x311922+_0x1f9de0(0x239)+_0x1bedd5+'\x20<>\x20'+_0x4a1a4f+_0x1f9de0(0x20a)+_0x46b99f);var _0x442974=_0x46b99f['slice'](0x3);_0xd1806c[_0x1bedd5][_0x1f9de0(0x241)]=_0x46b99f[0x0],_0xd1806c[_0x1bedd5][_0x1f9de0(0x276)]=_0x46b99f[0x1],_0xd1806c[_0x1bedd5][_0x1f9de0(0x2cb)]=0x0,_0xd1806c[_0x1bedd5][_0x1f9de0(0x293)]=0x0,_0xd1806c[_0x1bedd5][_0x1f9de0(0x2aa)]=_0x1f9de0(0x1d8),_0xd1806c[_0x1bedd5]['floorlevel']=_0x442974;}else{if(_0x311922=='Shelves'&&_0x1bedd5==_0x4a1a4f){var _0x442974=_0x46b99f[_0x1f9de0(0x208)](0x3);_0xd1806c[_0x1bedd5][_0x1f9de0(0x241)]=_0x46b99f[0x0],_0xd1806c[_0x1bedd5]['rack']=_0x46b99f[0x1],_0xd1806c[_0x1bedd5][_0x1f9de0(0x2cb)]=0x0,_0xd1806c[_0x1bedd5][_0x1f9de0(0x293)]=0x0,_0xd1806c[_0x1bedd5]['type']=_0x1f9de0(0x1d8),_0xd1806c[_0x1bedd5][_0x1f9de0(0x211)]=_0x46b99f[0x5];}else{if(_0x1bedd5==_0x4a1a4f){if(_0x46b99f[0x0]=='A'&&_0x46b99f[0x1]=='L'&&_0x46b99f[0x2]=='L')console[_0x1f9de0(0x22c)](_0x311922+_0x1f9de0(0x20a)+_0x1bedd5+_0x1f9de0(0x20a)+_0x4a1a4f+'\x20<>\x20'+_0x46b99f+_0x1f9de0(0x286)),_0xd1806c[_0x1bedd5][_0x1f9de0(0x241)]=_0x46b99f[0x0],_0xd1806c[_0x1bedd5][_0x1f9de0(0x276)]=_0x46b99f[0x1],_0xd1806c[_0x1bedd5]['bay']=0x0,_0xd1806c[_0x1bedd5][_0x1f9de0(0x293)]=0x0,_0xd1806c[_0x1bedd5][_0x1f9de0(0x2aa)]=_0x1f9de0(0x1d8),_0xd1806c[_0x1bedd5]['floorlevel']=_0x46b99f[0x3];else{var _0x2890c0;if(_0x46b99f[0x4]=='L')_0x2890c0='Level';else _0x46b99f[0x4]=='F'&&(_0x2890c0=_0x1f9de0(0x1d8));_0xd1806c[_0x1bedd5][_0x1f9de0(0x241)]=_0x46b99f[0x0],_0xd1806c[_0x1bedd5][_0x1f9de0(0x276)]=_0x46b99f[0x1],_0xd1806c[_0x1bedd5][_0x1f9de0(0x2cb)]=_0x46b99f[0x2],_0xd1806c[_0x1bedd5][_0x1f9de0(0x293)]=_0x46b99f[0x3],_0xd1806c[_0x1bedd5][_0x1f9de0(0x2aa)]=_0x2890c0,_0xd1806c[_0x1bedd5][_0x1f9de0(0x211)]=_0x46b99f[0x5];}}}}});}),_0x3596e9[_0x1559dc(0x1c8)]((_0x52f6f6,_0x5e677c)=>{_0xd1806c[_0x5e677c]['primary_code']=_0x52f6f6;}),_0xaf1e51['forEach']((_0x56531d,_0x1ee4cf)=>{var _0x1a8847=_0x1559dc;_0xd1806c[_0x1ee4cf][_0x1a8847(0x1f2)]=_0x56531d;}),_0x234b7f[_0x1559dc(0x1c8)]((_0x243d86,_0x4ecef9)=>{var _0x7e2bd3=_0x1559dc;_0xd1806c[_0x4ecef9][_0x7e2bd3(0x27b)]=_0x243d86;}),_0x444b83['forEach']((_0x44afe9,_0x55bfdf)=>{var _0x94deaf=_0x1559dc;_0xd1806c[_0x55bfdf][_0x94deaf(0x2d6)]=_0x44afe9;}),_0x2f5feb[_0x1559dc(0x1c8)]((_0x28dd6d,_0x21af46)=>{var _0x14f2ec=_0x1559dc;_0xd1806c[_0x21af46][_0x14f2ec(0x205)]=_0x28dd6d;}),_0x25bc44[_0x1559dc(0x1c8)]((_0x2a2c0d,_0x1bb21b)=>{var _0x3387c2=_0x1559dc;_0xd1806c[_0x1bb21b][_0x3387c2(0x2a1)]=_0x2a2c0d;}),_0x2c0efb['forEach']((_0x37c551,_0x8fb12d)=>{var _0x313cef=_0x1559dc;_0xd1806c[_0x8fb12d][_0x313cef(0x1e9)]=_0x37c551;}),_0x5c7e41[_0x1559dc(0x1c8)]((_0x388129,_0x113b27)=>{var _0x5bb8a0=_0x1559dc;_0xd1806c[_0x113b27][_0x5bb8a0(0x257)]=_0x388129;}),_0x42507d['forEach']((_0x290c3d,_0x32457a)=>{var _0x484f45=_0x1559dc;_0xd1806c[_0x32457a][_0x484f45(0x2dd)]=_0x290c3d;}),_0x275494['forEach']((_0x1e5d16,_0x1308cc)=>{_0xd1806c[_0x1308cc]['room_name']=_0x1e5d16;}),_0x5a3505['forEach']((_0x2e1804,_0x36ad44)=>{var _0x44fe97=_0x1559dc;_0xd1806c[_0x36ad44][_0x44fe97(0x2bb)]=_0x2e1804;}),_0x53a463[_0x1559dc(0x1c8)]((_0x201a28,_0x2fd38b)=>{var _0x45142c=_0x1559dc;_0xd1806c[_0x2fd38b][_0x45142c(0x1e3)]=_0x201a28;}),_0xd7fe92[_0x1559dc(0x1c8)]((_0x1f8fbb,_0x42f71b)=>{var _0x28476d=_0x1559dc;_0xd1806c[_0x42f71b][_0x28476d(0x2db)]=_0x1f8fbb;});const _0x2a3458=_0x275494[_0x1559dc(0x24d)](_0x19a29b=>{return _0x19a29b={'room_name':_0x19a29b};}),_0xe4bde8=_0xd1806c[_0x1559dc(0x217)](_0x2d654b=>_0x2d654b[_0x1559dc(0x207)]!=='0'&&_0x2d654b[_0x1559dc(0x207)]!==''),_0x2bc586=new purchases({'invoice':_0x3fd5ad,'suppliers':_0x1df427[_0x1559dc(0x2bd)][_0x1559dc(0x296)],'date':_0x1a772e,'warehouse_name':_0x3aeaaa,'product':_0xe4bde8,'note':_0x22dafa,'due_amount':_0x53a80c,'POnumber':_0x445894,'SCRN':_0x3a1c01,'JO_number':_0x53848c,'roomList':_0x2a3458}),_0x550dad=await _0x2bc586['save'](),_0x453d40=await purchases[_0x1559dc(0x2de)]({'invoice':_0x3fd5ad}),_0xdc61d7=_0x453d40[_0x1559dc(0x1db)][_0x1559dc(0x24d)](async _0xe2ab78=>{var _0x105be6=_0x1559dc,_0x429857=await warehouse['findOne']({'name':_0x3aeaaa,'room':_0xe2ab78['room_name']}),_0x2df24a=0x0;return _0x429857['product_details'][_0x105be6(0x1c8)](_0x4f050f=>{var _0x624dee=_0x105be6;_0x4f050f[_0x624dee(0x24a)]==_0xe2ab78[_0x624dee(0x24a)]&&_0x4f050f[_0x624dee(0x211)]==_0xe2ab78['floorlevel']&&_0x4f050f[_0x624dee(0x2aa)]==_0xe2ab78['type']&&_0x4f050f[_0x624dee(0x293)]==_0xe2ab78['bin']&&_0x4f050f[_0x624dee(0x2cb)]==_0xe2ab78[_0x624dee(0x2cb)]&&_0x4f050f[_0x624dee(0x276)]==_0xe2ab78[_0x624dee(0x276)]&&_0x4f050f['storage']==_0xe2ab78['storage']&&_0x4f050f[_0x624dee(0x205)]==_0xe2ab78[_0x624dee(0x205)]&&_0x4f050f['batch_code']==_0xe2ab78[_0x624dee(0x2d6)]&&_0x4f050f[_0x624dee(0x257)]==_0xe2ab78['production_date']&&_0x4f050f[_0x624dee(0x2db)]==_0x453d40[_0x624dee(0x2db)]&&(_0x4f050f['product_stock']+=Math[_0x624dee(0x21d)](_0xe2ab78[_0x624dee(0x207)]),_0x2df24a++);}),_0x2df24a===0x0&&_0x429857[_0x105be6(0x273)][_0x105be6(0x290)]({'product_name':_0xe2ab78[_0x105be6(0x24a)],'product_stock':Math['abs'](_0xe2ab78[_0x105be6(0x207)]),'primary_code':_0xe2ab78[_0x105be6(0x21c)],'secondary_code':_0xe2ab78[_0x105be6(0x1f2)],'product_code':_0xe2ab78[_0x105be6(0x23d)],'storage':_0xe2ab78[_0x105be6(0x241)],'rack':_0xe2ab78[_0x105be6(0x276)],'bay':_0xe2ab78[_0x105be6(0x2cb)],'bin':_0xe2ab78[_0x105be6(0x293)],'type':_0xe2ab78[_0x105be6(0x2aa)],'floorlevel':_0xe2ab78[_0x105be6(0x211)],'maxProducts':_0xe2ab78['maxStocks'],'unit':_0xe2ab78['standard_unit'],'secondary_unit':_0xe2ab78[_0x105be6(0x1de)],'expiry_date':_0xe2ab78[_0x105be6(0x205)],'maxPerUnit':_0xe2ab78['maxperunit'],'batch_code':_0xe2ab78['batch_code'],'alertQTY':_0xe2ab78[_0x105be6(0x1e9)],'production_date':_0xe2ab78['production_date'],'product_cat':_0xe2ab78['product_cat'],'invoice':_0xe2ab78[_0x105be6(0x2db)],'actual_qty':Math[_0x105be6(0x21d)](_0xe2ab78[_0x105be6(0x220)]),'actual_uom':_0xe2ab78[_0x105be6(0x21a)],'delivery_date':_0xe2ab78['delivery_date'],'delivery_code':_0xe2ab78[_0x105be6(0x1e3)]}),_0x429857;});Promise[_0x1559dc(0x1f1)](_0xdc61d7)[_0x1559dc(0x1ef)](async _0x40035a=>{var _0x5d3dae=_0x1559dc;try{for(const _0x3eee79 of _0x40035a){await _0x3eee79['save']();}const _0x9bd1ad=await master_shop[_0x5d3dae(0x2b9)](),_0x19ef7e=await email_settings[_0x5d3dae(0x2de)](),_0x373f32=await supervisor_settings[_0x5d3dae(0x2b9)]();var _0x30d648=_0x453d40[_0x5d3dae(0x1db)],_0xc82136='',_0x1e9dff;for(_0x1e9dff in _0x30d648){_0xc82136+=_0x5d3dae(0x294)+_0x5d3dae(0x265)+_0x30d648[_0x1e9dff][_0x5d3dae(0x24a)]+_0x5d3dae(0x28b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30d648[_0x1e9dff][_0x5d3dae(0x23d)]+_0x5d3dae(0x28b)+_0x5d3dae(0x265)+_0x30d648[_0x1e9dff]['quantity']+_0x5d3dae(0x28b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30d648[_0x1e9dff][_0x5d3dae(0x23c)]+_0x5d3dae(0x28b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x30d648[_0x1e9dff][_0x5d3dae(0x1de)]+'</td>'+_0x5d3dae(0x265)+_0x453d40['warehouse_name']+_0x5d3dae(0x28b)+_0x5d3dae(0x265)+_0x30d648[_0x1e9dff]['room_name']+'</td>'+_0x5d3dae(0x265)+_0x30d648[_0x1e9dff][_0x5d3dae(0x241)]+_0x30d648[_0x1e9dff][_0x5d3dae(0x276)]+_0x30d648[_0x1e9dff][_0x5d3dae(0x2cb)]+_0x30d648[_0x1e9dff]['bin']+_0x30d648[_0x1e9dff]['type'][0x0]+_0x30d648[_0x1e9dff][_0x5d3dae(0x211)]+'</td>',_0x5d3dae(0x1ce);}let _0x146716=nodemailer[_0x5d3dae(0x27e)]({'host':_0x19ef7e[_0x5d3dae(0x258)],'port':Number(_0x19ef7e['port']),'secure':![],'auth':{'user':_0x19ef7e[_0x5d3dae(0x271)],'pass':_0x19ef7e['password']}}),_0x2dbe5d={'from':_0x19ef7e[_0x5d3dae(0x271)],'to':_0x373f32[0x0][_0x5d3dae(0x221)],'subject':_0x5d3dae(0x274),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x5d3dae(0x23f)+_0x9bd1ad[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x5d3dae(0x2a6)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5d3dae(0x2a6)+_0x5d3dae(0x22f)+_0x5d3dae(0x245)+'<div>'+_0x5d3dae(0x2b2)+_0x9bd1ad[0x0][_0x5d3dae(0x266)]+_0x5d3dae(0x1e5)+_0x5d3dae(0x245)+_0x5d3dae(0x245)+_0x5d3dae(0x291)+_0x5d3dae(0x2a6)+_0x5d3dae(0x2da)+_0x5d3dae(0x1c9)+_0x453d40[_0x5d3dae(0x2db)]+'\x20'+_0x5d3dae(0x249)+'\x20Order\x20Date\x20:\x20'+_0x453d40[_0x5d3dae(0x223)]+'\x20'+_0x5d3dae(0x2ab)+_0x5d3dae(0x1ee)+_0x5d3dae(0x245)+_0x5d3dae(0x1b9)+_0x5d3dae(0x281)+'<tr>'+_0x5d3dae(0x1cc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x5d3dae(0x2d5)+_0x5d3dae(0x289)+_0x5d3dae(0x28d)+_0x5d3dae(0x2c6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5d3dae(0x1ce)+_0x5d3dae(0x27d)+_0x5d3dae(0x22d)+'\x20'+_0xc82136+'\x20'+_0x5d3dae(0x1d3)+_0x5d3dae(0x2d1)+'<div>'+_0x5d3dae(0x2ad)+_0x5d3dae(0x277)+_0x9bd1ad[0x0]['site_title']+_0x5d3dae(0x1ee)+_0x5d3dae(0x245)+'</div>'+_0x5d3dae(0x282)};_0x146716['sendMail'](_0x2dbe5d,function(_0x1ee0e8,_0x416298){var _0x4d7f85=_0x5d3dae;_0x1ee0e8?(console['log'](_0x1ee0e8),console[_0x4d7f85(0x22c)](_0x4d7f85(0x242))):console[_0x4d7f85(0x22c)]('Email\x20sent\x20successfully');}),_0x1df427[_0x5d3dae(0x259)](_0x5d3dae(0x201),_0x5d3dae(0x1e2)),_0x59ea70[_0x5d3dae(0x219)]('/all_purchases/view/');}catch(_0x16c52e){console[_0x5d3dae(0x1f9)](_0x16c52e),_0x59ea70[_0x5d3dae(0x2d7)](0x1f4)[_0x5d3dae(0x26e)]({'error':_0x5d3dae(0x1da)});}})[_0x1559dc(0x262)](_0x53e350=>{var _0x381dd1=_0x1559dc;console['error'](_0x53e350),_0x59ea70[_0x381dd1(0x2d7)](0x1f4)[_0x381dd1(0x26e)]({'error':'An\x20error\x20occurred.'});});}catch(_0x264a79){console[_0x1559dc(0x22c)](_0x264a79);}}),router['get'](a0_0x44936e(0x246),auth,async(_0xb05074,_0xdd4ed)=>{var _0x19b45a=a0_0x44936e;try{const {username:_0x19180a,email:_0x6dcaf9,role:_0x26a3fb}=_0xb05074[_0x19b45a(0x2d3)],_0x41e2d3=_0xb05074['user'],_0x76665b=await profile[_0x19b45a(0x2de)]({'email':_0x41e2d3[_0x19b45a(0x271)]}),_0x522d1c=await master_shop[_0x19b45a(0x2b9)](),_0x624f89=_0xb05074[_0x19b45a(0x203)]['id'],_0x329400=await purchases[_0x19b45a(0x2c5)](_0x624f89),_0x11b200=await warehouse[_0x19b45a(0x22e)]([{'$match':{'name':_0x329400[_0x19b45a(0x1e8)],'room':_0x329400[_0x19b45a(0x2b6)]}},{'$unwind':_0x19b45a(0x215)},{'$group':{'_id':_0x19b45a(0x229),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x19b45a(0x1d5)},'floorlevel':{'$first':_0x19b45a(0x1ec)},'primary_code':{'$first':_0x19b45a(0x252)},'secondary_code':{'$first':_0x19b45a(0x2bf)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x19b45a(0x284)},'rack':{'$first':_0x19b45a(0x2ac)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x344696=await customer['find']({});let _0x15a8eb;if(_0x41e2d3[_0x19b45a(0x1c5)]==_0x19b45a(0x269)){const _0x2dec93=await staff[_0x19b45a(0x2de)]({'email':_0x41e2d3[_0x19b45a(0x271)]});_0x15a8eb=await warehouse[_0x19b45a(0x22e)]([{'$match':{'status':_0x19b45a(0x2c7),'name':_0x2dec93[_0x19b45a(0x1e0)]}},{'$group':{'_id':'$name','name':{'$first':_0x19b45a(0x1cf)}}}]);}else _0x15a8eb=await warehouse[_0x19b45a(0x22e)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x19b45a(0x1cf),'name':{'$first':_0x19b45a(0x1cf)}}}]);const _0x41ef74=await product[_0x19b45a(0x2b9)]({}),_0x384b54=await suppliers[_0x19b45a(0x2b9)]({}),_0x4d91ba=BayBinSelected(_0x329400[_0x19b45a(0x1e8)],_0x329400[_0x19b45a(0x2b6)]);if(_0x522d1c[0x0]['language']==_0x19b45a(0x232)){var _0x3cc12a=users[_0x19b45a(0x2af)];console[_0x19b45a(0x22c)](_0x3cc12a);}else{if(_0x522d1c[0x0][_0x19b45a(0x204)]=='Hindi')var _0x3cc12a=users[_0x19b45a(0x2c4)];else{if(_0x522d1c[0x0][_0x19b45a(0x204)]=='German')var _0x3cc12a=users[_0x19b45a(0x268)];else{if(_0x522d1c[0x0]['language']=='Spanish')var _0x3cc12a=users['Spanish'];else{if(_0x522d1c[0x0][_0x19b45a(0x204)]==_0x19b45a(0x2dc))var _0x3cc12a=users['French'];else{if(_0x522d1c[0x0][_0x19b45a(0x204)]==_0x19b45a(0x23e))var _0x3cc12a=users[_0x19b45a(0x1b8)];else{if(_0x522d1c[0x0]['language']==_0x19b45a(0x2c9))var _0x3cc12a=users[_0x19b45a(0x2c9)];else{if(_0x522d1c[0x0][_0x19b45a(0x204)]==_0x19b45a(0x210))var _0x3cc12a=users[_0x19b45a(0x1f4)];}}}}}}}_0xdd4ed['render'](_0x19b45a(0x24f),{'success':_0xb05074[_0x19b45a(0x259)](_0x19b45a(0x201)),'errors':_0xb05074[_0x19b45a(0x259)](_0x19b45a(0x1d1)),'role':_0x41e2d3,'profile':_0x76665b,'customer':_0x344696,'warehouse':_0x15a8eb,'product':_0x11b200,'user':_0x329400,'master_shop':_0x522d1c,'unit':_0x41ef74,'language':_0x3cc12a,'suppliers':_0x384b54,'dataSelected':_0x4d91ba});}catch(_0x2506fe){console[_0x19b45a(0x22c)](_0x2506fe);}}),router[a0_0x44936e(0x275)]('/preview/:id',auth,async(_0x3995d1,_0x4b5c94)=>{var _0x230319=a0_0x44936e;try{const _0x4fed0b=_0x3995d1['params']['id'],{invoice:_0x43ba30,warehouse_name:_0x33b62e,Room_name:_0x5bbb26}=_0x3995d1[_0x230319(0x2bd)],_0x7dcb89=await warehouse[_0x230319(0x2de)]({'name':_0x33b62e,'room':_0x5bbb26}),_0x3ba410=await purchases[_0x230319(0x2de)]({'invoice':_0x43ba30});_0x3ba410[_0x230319(0x1db)][_0x230319(0x1c8)](_0x18f7f4=>{var _0x2deecb=_0x230319,_0x38fbbc=0x0;const _0x59cf60=_0x7dcb89[_0x2deecb(0x273)][_0x2deecb(0x24d)](_0x52d6ef=>{var _0x15e204=_0x2deecb;_0x52d6ef[_0x15e204(0x24a)]==_0x18f7f4[_0x15e204(0x24a)]&&_0x52d6ef[_0x15e204(0x211)]==_0x18f7f4[_0x15e204(0x211)]&&_0x52d6ef['type']==_0x18f7f4[_0x15e204(0x2aa)]&&_0x52d6ef[_0x15e204(0x293)]==_0x18f7f4[_0x15e204(0x293)]&&_0x52d6ef[_0x15e204(0x2cb)]==_0x18f7f4[_0x15e204(0x2cb)]&&_0x52d6ef[_0x15e204(0x276)]==_0x18f7f4[_0x15e204(0x276)]&&_0x52d6ef[_0x15e204(0x241)]==_0x18f7f4[_0x15e204(0x241)]&&_0x52d6ef['expiry_date']==_0x18f7f4[_0x15e204(0x205)]&&_0x52d6ef[_0x15e204(0x2d6)]==_0x18f7f4['batch_code']&&_0x52d6ef[_0x15e204(0x257)]==_0x18f7f4[_0x15e204(0x257)]&&_0x52d6ef[_0x15e204(0x2bb)]==_0x18f7f4[_0x15e204(0x2bb)]&&_0x52d6ef[_0x15e204(0x1e3)]==_0x18f7f4[_0x15e204(0x1e3)]&&(_0x52d6ef[_0x15e204(0x247)]=parseInt(_0x52d6ef[_0x15e204(0x247)])+parseInt(_0x18f7f4[_0x15e204(0x207)]),_0x38fbbc++);});_0x38fbbc=='0'&&(_0x7dcb89['product_details']=_0x7dcb89[_0x2deecb(0x273)]['concat']({'product_name':_0x18f7f4[_0x2deecb(0x24a)],'product_stock':_0x18f7f4[_0x2deecb(0x207)],'primary_code':_0x18f7f4[_0x2deecb(0x21c)],'secondary_code':_0x18f7f4[_0x2deecb(0x1f2)],'product_code':_0x18f7f4[_0x2deecb(0x23d)],'storage':_0x18f7f4[_0x2deecb(0x241)],'rack':_0x18f7f4[_0x2deecb(0x276)],'bay':_0x18f7f4['bay'],'bin':_0x18f7f4[_0x2deecb(0x293)],'type':_0x18f7f4[_0x2deecb(0x2aa)],'floorlevel':_0x18f7f4[_0x2deecb(0x211)],'maxProducts':_0x18f7f4['maxStocks'],'unit':_0x18f7f4[_0x2deecb(0x23c)],'secondary_unit':_0x18f7f4[_0x2deecb(0x1de)],'expiry_date':_0x18f7f4['expiry_date'],'maxPerUnit':_0x18f7f4[_0x2deecb(0x2a1)],'batch_code':_0x18f7f4[_0x2deecb(0x2d6)],'alertQTY':_0x18f7f4[_0x2deecb(0x1e9)],'production_date':_0x18f7f4['production_date'],'delivery_date':_0x18f7f4['delivery_date'],'delivery_code':_0x18f7f4[_0x2deecb(0x1e3)]}));}),await _0x7dcb89[_0x230319(0x235)](),_0x3ba410[_0x230319(0x200)]=_0x230319(0x2c3);const _0x4cebf7=await _0x3ba410['save']();_0x3995d1[_0x230319(0x259)]('success',_0x230319(0x264)),_0x4b5c94['redirect'](_0x230319(0x270));}catch(_0x3cad25){console[_0x230319(0x22c)](_0x3cad25);}}),router['get'](a0_0x44936e(0x20b),auth,async(_0x1f31d1,_0x3507b0)=>{var _0x1bd3f8=a0_0x44936e;try{const {username:_0x6611c8,email:_0x54c17a,role:_0x41426f}=_0x1f31d1[_0x1bd3f8(0x2d3)],_0x3f010b=_0x1f31d1['user'],_0x260ae5=await profile[_0x1bd3f8(0x2de)]({'email':_0x3f010b[_0x1bd3f8(0x271)]}),_0x37bc7a=await master_shop[_0x1bd3f8(0x2b9)](),_0x53cdce=_0x1f31d1[_0x1bd3f8(0x203)]['id'],_0x22dfa7=await purchases[_0x1bd3f8(0x2c5)](_0x53cdce),_0x3830c7=await suppliers[_0x1bd3f8(0x2b9)]({});let _0x323f4a;if(_0x3f010b[_0x1bd3f8(0x1c5)]==_0x1bd3f8(0x269)){const _0x1924a2=await staff[_0x1bd3f8(0x2de)]({'email':_0x3f010b[_0x1bd3f8(0x271)]});_0x323f4a=await warehouse[_0x1bd3f8(0x2b9)]({'status':_0x1bd3f8(0x2c7),'name':_0x1924a2[_0x1bd3f8(0x1e0)],'warehouse_category':_0x1bd3f8(0x2b3)});}else _0x323f4a=await warehouse['aggregate']([{'$match':{'status':_0x1bd3f8(0x2c7),'warehouse_category':_0x1bd3f8(0x2b3)}},{'$group':{'_id':_0x1bd3f8(0x1cf),'name':{'$first':_0x1bd3f8(0x1cf)}}}]);const _0x3b59c8=await product[_0x1bd3f8(0x2b9)]({}),_0x17fe57=BayBinSelected(_0x22dfa7[_0x1bd3f8(0x1e8)],_0x22dfa7[_0x1bd3f8(0x2b6)]);let _0x52a714=new Date(_0x22dfa7['expiry_date']),_0x49e0e6=('0'+_0x52a714[_0x1bd3f8(0x2d4)]())[_0x1bd3f8(0x208)](-0x2),_0x1ae78b=('0'+(_0x52a714[_0x1bd3f8(0x24b)]()+0x1))[_0x1bd3f8(0x208)](-0x2),_0x42d089=_0x52a714['getFullYear'](),_0x2926ad=_0x42d089+'-'+_0x1ae78b+'-'+_0x49e0e6;if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]==_0x1bd3f8(0x232)){var _0x359e59=users['English'];console['log'](_0x359e59);}else{if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]=='Hindi')var _0x359e59=users[_0x1bd3f8(0x2c4)];else{if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]==_0x1bd3f8(0x268))var _0x359e59=users[_0x1bd3f8(0x268)];else{if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]==_0x1bd3f8(0x2a9))var _0x359e59=users[_0x1bd3f8(0x2a9)];else{if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]=='French')var _0x359e59=users[_0x1bd3f8(0x2dc)];else{if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]==_0x1bd3f8(0x23e))var _0x359e59=users[_0x1bd3f8(0x1b8)];else{if(_0x37bc7a[0x0][_0x1bd3f8(0x204)]==_0x1bd3f8(0x2c9))var _0x359e59=users[_0x1bd3f8(0x2c9)];else{if(_0x37bc7a[0x0]['language']==_0x1bd3f8(0x210))var _0x359e59=users[_0x1bd3f8(0x1f4)];}}}}}}}_0x3507b0['render']('edit_purchases',{'success':_0x1f31d1[_0x1bd3f8(0x259)](_0x1bd3f8(0x201)),'errors':_0x1f31d1[_0x1bd3f8(0x259)]('errors'),'role':_0x3f010b,'profile':_0x260ae5,'purchases':_0x22dfa7,'suppliers':_0x3830c7,'warehouse':_0x323f4a,'product':_0x3b59c8,'master_shop':_0x37bc7a,'language':_0x359e59,'ed_fullDate':_0x2926ad,'dataSelected':_0x17fe57});}catch(_0x7fbaf2){console[_0x1bd3f8(0x22c)](_0x7fbaf2);}}),router[a0_0x44936e(0x275)]('/view/:id',auth,async(_0xa0de29,_0x2c8846)=>{var _0x282c7c=a0_0x44936e;try{const _0xa72d85=_0xa0de29[_0x282c7c(0x203)]['id'],_0x1a8140=await purchases['findOne']({'_id':_0xa0de29[_0x282c7c(0x203)]['id']}),_0x14676a=await warehouse['findOne']({'name':_0x1a8140[_0x282c7c(0x1e8)],'room':_0x1a8140[_0x282c7c(0x2b6)]});_0x1a8140[_0x282c7c(0x1db)][_0x282c7c(0x1c8)](_0xaa82f2=>{const _0x442bd0=_0x14676a['product_details']['map'](_0x127a41=>{var _0x38f2c7=a0_0x3c30;_0x127a41[_0x38f2c7(0x24a)]==_0xaa82f2[_0x38f2c7(0x24a)]&&_0x127a41['floorlevel']==_0xaa82f2['floorlevel']&&_0x127a41[_0x38f2c7(0x2aa)]==_0xaa82f2['type']&&_0x127a41['bin']==_0xaa82f2[_0x38f2c7(0x293)]&&_0x127a41[_0x38f2c7(0x2cb)]==_0xaa82f2[_0x38f2c7(0x2cb)]&&_0x127a41[_0x38f2c7(0x276)]==_0xaa82f2[_0x38f2c7(0x276)]&&_0x127a41[_0x38f2c7(0x241)]==_0xaa82f2[_0x38f2c7(0x241)]&&(_0x127a41['product_stock']=parseInt(_0x127a41[_0x38f2c7(0x247)])-parseInt(_0xaa82f2['quantity']));});}),await _0x14676a[_0x282c7c(0x235)]();const {invoice:_0x5ab9b5,suppliers:_0x44de46,date:_0x54ed33,warehouse_name:_0x185a0f,prod_name:_0x16e503,prod_code:_0x2c886f,prod_qty:_0x28f2af,prod_unit:_0xa1fd25,prod_secondunit:_0x40fb96,prod_level:_0x4b80cf,prod_isle:_0x2e9623,prod_pallet:_0xd0912,note:_0xd860de,expiry_date:_0x2f213e,batch_code:_0x263a66,paid_amount:_0x5aa440,due_amount:_0x4af7e6,Room_name:_0x151b90,primary_code:_0x44f085,secondary_code:_0x3e69fd,PO_number:_0x485f6e,JO_number:_0x5e2c1f}=_0xa0de29['body'];if(typeof _0x16e503==_0x282c7c(0x2c8))var _0x2ced70=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x209)]],_0x409cfd=[_0xa0de29[_0x282c7c(0x2bd)]['prod_code']],_0x20b8e1=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x2a4)]],_0x1dd97a=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x1bb)]],_0x2258e1=[_0xa0de29['body'][_0x282c7c(0x206)]],_0xeeafb5=[_0xa0de29[_0x282c7c(0x2bd)]['prod_level']],_0x3b5fb1=[_0xa0de29['body'][_0x282c7c(0x2d9)]],_0x2c269a=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x253)]],_0x119138=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x21c)]],_0x1b6728=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x1f2)]],_0x3084be=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x1b7)]],_0x5d4e6e=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x2d6)]],_0x38accd=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x205)]],_0x5e04ac=[_0xa0de29[_0x282c7c(0x2bd)]['storage']],_0x5ad7d8=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x26f)]],_0x584c33=[_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x2aa)]];else var _0x2ced70=[..._0xa0de29[_0x282c7c(0x2bd)]['prod_name']],_0x409cfd=[..._0xa0de29['body'][_0x282c7c(0x28c)]],_0x20b8e1=[..._0xa0de29[_0x282c7c(0x2bd)]['prod_qty']],_0x1dd97a=[..._0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x1bb)]],_0x2258e1=[..._0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x206)]],_0xeeafb5=[..._0xa0de29[_0x282c7c(0x2bd)]['prod_level']],_0x3b5fb1=[..._0xa0de29['body']['prod_isle']],_0x2c269a=[..._0xa0de29['body']['prod_pallet']],_0x119138=[..._0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x21c)]],_0x1b6728=[..._0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x1f2)]],_0x3084be=[..._0xa0de29[_0x282c7c(0x2bd)]['MaxStocks_data']],_0x5d4e6e=[..._0xa0de29[_0x282c7c(0x2bd)]['batch_code']],_0x38accd=[..._0xa0de29['body']['expiry_date']],_0x5e04ac=[..._0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x241)]],_0x5ad7d8=[..._0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x26f)]],_0x584c33=[..._0xa0de29['body'][_0x282c7c(0x2aa)]];const _0x56a5c7=_0x2ced70[_0x282c7c(0x24d)](_0x1152e9=>{return _0x1152e9={'product_name':_0x1152e9};});_0x409cfd[_0x282c7c(0x1c8)]((_0x2350f7,_0x20bccb)=>{var _0x216428=_0x282c7c;_0x56a5c7[_0x20bccb][_0x216428(0x23d)]=_0x2350f7;}),_0x20b8e1['forEach']((_0x456da4,_0x5182f1)=>{var _0x36d76f=_0x282c7c;_0x56a5c7[_0x5182f1][_0x36d76f(0x207)]=_0x456da4;}),_0x1dd97a[_0x282c7c(0x1c8)]((_0x1b8ccc,_0x287219)=>{var _0xaf8320=_0x282c7c;_0x56a5c7[_0x287219][_0xaf8320(0x23c)]=_0x1b8ccc;}),_0x2258e1['forEach']((_0x1c2d47,_0x28d377)=>{_0x56a5c7[_0x28d377]['secondary_unit']=_0x1c2d47;}),_0xeeafb5[_0x282c7c(0x1c8)]((_0x21f083,_0x19ece3)=>{var _0x1e845c=_0x282c7c;_0x56a5c7[_0x19ece3][_0x1e845c(0x2cb)]=_0x21f083;}),_0x3b5fb1[_0x282c7c(0x1c8)]((_0x313249,_0x43c3dc)=>{var _0x22b207=_0x282c7c;_0x56a5c7[_0x43c3dc][_0x22b207(0x293)]=_0x313249;}),_0x2c269a[_0x282c7c(0x1c8)]((_0x391717,_0x4615da)=>{_0x56a5c7[_0x4615da]['floorlevel']=_0x391717;}),_0x119138[_0x282c7c(0x1c8)]((_0x346f9d,_0x3ae126)=>{var _0xaff3cb=_0x282c7c;_0x56a5c7[_0x3ae126][_0xaff3cb(0x21c)]=_0x346f9d;}),_0x1b6728[_0x282c7c(0x1c8)]((_0x1082c1,_0xb382f2)=>{var _0x29a32b=_0x282c7c;_0x56a5c7[_0xb382f2][_0x29a32b(0x1f2)]=_0x1082c1;}),_0x3084be['forEach']((_0x565a94,_0x1d3ec6)=>{var _0x54c239=_0x282c7c;_0x56a5c7[_0x1d3ec6][_0x54c239(0x27b)]=_0x565a94;}),_0x5d4e6e['forEach']((_0x297aa8,_0x56ac30)=>{var _0x46897f=_0x282c7c;_0x56a5c7[_0x56ac30][_0x46897f(0x2d6)]=_0x297aa8;}),_0x38accd[_0x282c7c(0x1c8)]((_0x349b69,_0x2df13b)=>{var _0x1db349=_0x282c7c;_0x56a5c7[_0x2df13b][_0x1db349(0x205)]=_0x349b69;}),_0x584c33[_0x282c7c(0x1c8)]((_0x58b9f2,_0x1f0378)=>{_0x56a5c7[_0x1f0378]['type']=_0x58b9f2;}),_0x5e04ac[_0x282c7c(0x1c8)]((_0x23860c,_0x1857d1)=>{var _0x5f49c8=_0x282c7c;_0x56a5c7[_0x1857d1][_0x5f49c8(0x241)]=_0x23860c;}),_0x5ad7d8[_0x282c7c(0x1c8)]((_0x30c8c8,_0xba74b)=>{var _0x316a86=_0x282c7c;_0x56a5c7[_0xba74b][_0x316a86(0x276)]=_0x30c8c8;});const _0x2cdd19=_0x56a5c7[_0x282c7c(0x217)](_0x4ca921=>_0x4ca921[_0x282c7c(0x207)]!=='0'&&_0x4ca921[_0x282c7c(0x207)]!=='');_0x1a8140[_0x282c7c(0x2db)]=_0x5ab9b5,_0x1a8140[_0x282c7c(0x296)]=_0x44de46,_0x1a8140[_0x282c7c(0x223)]=_0x54ed33,_0x1a8140[_0x282c7c(0x1e8)]=_0x185a0f,_0x1a8140[_0x282c7c(0x1db)]=_0x2cdd19,_0x1a8140[_0x282c7c(0x28a)]=_0xd860de,_0x1a8140[_0x282c7c(0x26c)]=_0x5aa440,_0x1a8140[_0x282c7c(0x2cc)]=_0x4af7e6,_0x1a8140[_0x282c7c(0x2b6)]=_0x151b90,_0x1a8140[_0x282c7c(0x227)]=_0x485f6e,_0x1a8140[_0x282c7c(0x1ff)]=_0x5e2c1f;const _0x33dfd1=await _0x1a8140['save'](),_0x11c76a=await warehouse['findOne']({'name':_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x1e8)],'room':_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x251)]});_0x1a8140['product']['forEach'](_0x5d113f=>{var _0x390dfb=_0x282c7c,_0xaca1e5=0x0;const _0x137195=_0x11c76a['product_details'][_0x390dfb(0x24d)](_0x2ce2ee=>{var _0x48fd17=_0x390dfb;_0x2ce2ee[_0x48fd17(0x24a)]==_0x5d113f['product_name']&&_0x2ce2ee['floorlevel']==_0x5d113f[_0x48fd17(0x211)]&&_0x2ce2ee[_0x48fd17(0x2aa)]==_0x5d113f[_0x48fd17(0x2aa)]&&_0x2ce2ee[_0x48fd17(0x293)]==_0x5d113f[_0x48fd17(0x293)]&&_0x2ce2ee['bay']==_0x5d113f[_0x48fd17(0x2cb)]&&_0x2ce2ee[_0x48fd17(0x276)]==_0x5d113f[_0x48fd17(0x276)]&&_0x2ce2ee[_0x48fd17(0x241)]==_0x5d113f[_0x48fd17(0x241)]&&(_0x2ce2ee[_0x48fd17(0x247)]=parseInt(_0x2ce2ee[_0x48fd17(0x247)])+parseInt(_0x5d113f[_0x48fd17(0x207)]),_0xaca1e5++);});_0xaca1e5=='0'&&(_0x11c76a['product_details']=_0x11c76a[_0x390dfb(0x273)][_0x390dfb(0x2be)]({'product_name':_0x5d113f['product_name'],'product_stock':_0x5d113f[_0x390dfb(0x207)],'primary_code':_0x5d113f[_0x390dfb(0x21c)],'secondary_code':_0x5d113f['secondary_code'],'product_code':_0x5d113f[_0x390dfb(0x23d)],'storage':_0x5d113f['storage'],'rack':_0x5d113f[_0x390dfb(0x276)],'bay':_0x5d113f[_0x390dfb(0x2cb)],'bin':_0x5d113f[_0x390dfb(0x293)],'type':_0x5d113f[_0x390dfb(0x2aa)],'floorlevel':_0x5d113f[_0x390dfb(0x211)],'maxProducts':_0x5d113f['maxStocks'],'unit':_0x5d113f[_0x390dfb(0x23c)],'secondary_unit':_0x5d113f[_0x390dfb(0x1de)],'expiry_date':_0x5d113f[_0x390dfb(0x205)]}));}),await _0x11c76a[_0x282c7c(0x235)]();const _0x3ec775=await s_payment_data[_0x282c7c(0x2de)]({'invoice':_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x2db)]});if(_0x3ec775===null){}else console[_0x282c7c(0x22c)](_0x282c7c(0x296),_0x3ec775,_0xa0de29[_0x282c7c(0x2bd)][_0x282c7c(0x2db)]),_0x3ec775['suppliers']=_0xa0de29['body'][_0x282c7c(0x296)],await _0x3ec775[_0x282c7c(0x235)]();_0xa0de29[_0x282c7c(0x259)](_0x282c7c(0x201),_0x282c7c(0x20c)),_0x2c8846[_0x282c7c(0x219)](_0x282c7c(0x270));}catch(_0x344238){console['log'](_0x344238);}}),router[a0_0x44936e(0x275)](a0_0x44936e(0x1fa),auth,async(_0x1f4af5,_0x3ff503)=>{var _0x3bcc60=a0_0x44936e;try{const _0x545038=_0x1f4af5[_0x3bcc60(0x203)]['id'],{invoice:_0x5292ee,suppliers:_0x25085d,payable:_0x18460d,due_amount:_0x207223}=_0x1f4af5[_0x3bcc60(0x2bd)],_0x5683d2=await purchases[_0x3bcc60(0x2c5)](_0x545038);var _0x20ee11=_0x18460d-_0x207223;_0x5683d2['paid_amount']=parseFloat(_0x5683d2['paid_amount'])+parseFloat(_0x207223),_0x5683d2[_0x3bcc60(0x2cc)]=_0x20ee11;const _0x592822=await _0x5683d2[_0x3bcc60(0x235)]();console[_0x3bcc60(0x22c)](_0x592822);const _0x550e3e=await s_payment_data[_0x3bcc60(0x2de)]({'invoice':_0x5292ee});_0x550e3e[_0x3bcc60(0x240)]=_0x20ee11,await _0x550e3e[_0x3bcc60(0x235)]();let _0x31a28a=new Date(),_0x2834eb=('0'+_0x31a28a[_0x3bcc60(0x2d4)]())[_0x3bcc60(0x208)](-0x2),_0xd5d44f=('0'+(_0x31a28a[_0x3bcc60(0x24b)]()+0x1))[_0x3bcc60(0x208)](-0x2),_0xbc90ed=_0x31a28a[_0x3bcc60(0x22a)](),_0x5a514b=_0xbc90ed+'-'+_0xd5d44f+'-'+_0x2834eb;const _0x5ca9ea=new suppliers_payment({'invoice':_0x5292ee,'date':_0xbc90ed+'-'+_0xd5d44f+'-'+_0x2834eb,'suppliers':_0x25085d,'reason':_0x3bcc60(0x1f0),'amount':_0x207223}),_0x50a68f=await _0x5ca9ea[_0x3bcc60(0x235)]();_0x1f4af5[_0x3bcc60(0x259)](_0x3bcc60(0x201),'payment\x20successfull'),_0x3ff503['redirect'](_0x3bcc60(0x270));}catch(_0x4bd8b6){console[_0x3bcc60(0x22c)](_0x4bd8b6);}}),router['get'](a0_0x44936e(0x26b),auth,async(_0x31ec8e,_0x28fa8f)=>{var _0x30f6df=a0_0x44936e;try{const {username:_0x429446,email:_0x485153,role:_0x1db241}=_0x31ec8e[_0x30f6df(0x2d3)],_0x3c15a8=_0x31ec8e[_0x30f6df(0x2d3)],_0x5e2a98=await profile['findOne']({'email':_0x3c15a8[_0x30f6df(0x271)]}),_0x401a5b=await master_shop['find']();console[_0x30f6df(0x22c)](_0x30f6df(0x21f),_0x401a5b);const _0x4b0c0b=_0x31ec8e[_0x30f6df(0x203)]['id'],_0xb6d79c=await purchases['findById'](_0x4b0c0b);console[_0x30f6df(0x22c)](_0xb6d79c);const _0x1a3fcd=await suppliers[_0x30f6df(0x2de)]({'name':_0xb6d79c['suppliers']});console[_0x30f6df(0x22c)](_0x1a3fcd);if(_0x401a5b[0x0]['language']==_0x30f6df(0x232)){var _0x31451d=users[_0x30f6df(0x2af)];console[_0x30f6df(0x22c)](_0x31451d);}else{if(_0x401a5b[0x0][_0x30f6df(0x204)]==_0x30f6df(0x2c4))var _0x31451d=users['Hindi'];else{if(_0x401a5b[0x0][_0x30f6df(0x204)]==_0x30f6df(0x268))var _0x31451d=users[_0x30f6df(0x268)];else{if(_0x401a5b[0x0][_0x30f6df(0x204)]=='Spanish')var _0x31451d=users['Spanish'];else{if(_0x401a5b[0x0]['language']==_0x30f6df(0x2dc))var _0x31451d=users[_0x30f6df(0x2dc)];else{if(_0x401a5b[0x0][_0x30f6df(0x204)]=='Portuguese\x20(BR)')var _0x31451d=users[_0x30f6df(0x1b8)];else{if(_0x401a5b[0x0][_0x30f6df(0x204)]=='Chinese')var _0x31451d=users[_0x30f6df(0x2c9)];else{if(_0x401a5b[0x0][_0x30f6df(0x204)]==_0x30f6df(0x210))var _0x31451d=users[_0x30f6df(0x1f4)];}}}}}}}_0x28fa8f[_0x30f6df(0x2a8)](_0x30f6df(0x29e),{'success':_0x31ec8e[_0x30f6df(0x259)](_0x30f6df(0x201)),'errors':_0x31ec8e[_0x30f6df(0x259)]('errors'),'role':_0x3c15a8,'profile':_0x5e2a98,'master_shop':_0x401a5b,'supplier':_0x1a3fcd,'purchase':_0xb6d79c,'language':_0x31451d});}catch(_0xf4cfda){console[_0x30f6df(0x22c)](_0xf4cfda);}}),router[a0_0x44936e(0x25c)](a0_0x44936e(0x202),auth,async(_0x37280e,_0x173002)=>{var _0x20f3c0=a0_0x44936e;try{const {username:_0x492d87,email:_0x5a781a,role:_0x5be03c}=_0x37280e['user'],_0x2f86a4=_0x37280e[_0x20f3c0(0x2d3)],_0x57c07d=await profile[_0x20f3c0(0x2de)]({'email':_0x2f86a4[_0x20f3c0(0x271)]}),_0x4ab4e4=await master_shop[_0x20f3c0(0x2b9)]();console[_0x20f3c0(0x22c)](_0x20f3c0(0x21f),_0x4ab4e4);const _0x2f243f=_0x37280e['params']['id'];console[_0x20f3c0(0x22c)](_0x2f243f);const _0x5edb71=await purchases[_0x20f3c0(0x2c5)](_0x2f243f);console[_0x20f3c0(0x22c)](_0x20f3c0(0x1bc),_0x5edb71);const _0x4d2a5e=await product[_0x20f3c0(0x2b9)]({}),_0x1be3c4=await warehouse[_0x20f3c0(0x22e)]([{'$match':{'name':_0x5edb71[_0x20f3c0(0x1e8)],'room':_0x5edb71[_0x20f3c0(0x2b6)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':'$product_details'},{'$group':{'_id':_0x20f3c0(0x229),'name':{'$first':_0x20f3c0(0x1ca)},'product_stock':{'$first':_0x20f3c0(0x27a)},'bay':{'$first':_0x20f3c0(0x2d0)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x20f3c0(0x1d5)},'floorlevel':{'$first':_0x20f3c0(0x1ec)},'primary_code':{'$first':_0x20f3c0(0x252)},'secondary_code':{'$first':_0x20f3c0(0x2bf)},'product_code':{'$first':_0x20f3c0(0x226)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x20f3c0(0x22e)]([{'$match':{'status':_0x20f3c0(0x2c7),'name':_0x20f3c0(0x1d2),'warehouse_category':_0x20f3c0(0x2b3)}},{'$group':{'_id':'$name','name':{'$first':_0x20f3c0(0x1cf)}}},{'$sort':{'name':0x1}}]),console[_0x20f3c0(0x22c)](_0x20f3c0(0x2ae),_0x1be3c4);if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]==_0x20f3c0(0x232)){var _0x493749=users[_0x20f3c0(0x2af)];console['log'](_0x493749);}else{if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]==_0x20f3c0(0x2c4))var _0x493749=users[_0x20f3c0(0x2c4)];else{if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]==_0x20f3c0(0x268))var _0x493749=users[_0x20f3c0(0x268)];else{if(_0x4ab4e4[0x0]['language']==_0x20f3c0(0x2a9))var _0x493749=users['Spanish'];else{if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]==_0x20f3c0(0x2dc))var _0x493749=users['French'];else{if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]==_0x20f3c0(0x23e))var _0x493749=users['Portuguese'];else{if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]=='Chinese')var _0x493749=users[_0x20f3c0(0x2c9)];else{if(_0x4ab4e4[0x0][_0x20f3c0(0x204)]==_0x20f3c0(0x210))var _0x493749=users[_0x20f3c0(0x1f4)];}}}}}}}_0x173002[_0x20f3c0(0x2a8)]('return_purchase',{'success':_0x37280e[_0x20f3c0(0x259)](_0x20f3c0(0x201)),'errors':_0x37280e[_0x20f3c0(0x259)](_0x20f3c0(0x1d1)),'role':_0x2f86a4,'profile':_0x57c07d,'user':_0x5edb71,'stock':_0x1be3c4,'master_shop':_0x4ab4e4,'product':_0x4d2a5e,'language':_0x493749,'warehouse':warehouse_data});}catch(_0x553b71){console[_0x20f3c0(0x22c)](_0x553b71);}}),router[a0_0x44936e(0x275)](a0_0x44936e(0x202),auth,async(_0x37e27e,_0x594a07)=>{var _0x1c0ace=a0_0x44936e;try{const {invoice:_0x194066,date:_0x1e9a78,warehouse_name:_0x1bfe25,Room_name:_0x153117,product_name:_0x4d7a4f,purchase_quantity:_0x2f1397,stocks:_0x1de623,return_qty:_0x162ef0,note:_0x69a551,level:_0x485395,isle:_0x8c1f01,pallet:_0x257ccc,to_warehouse_name:_0xb5a34a,to_Room_name:_0x239caf}=_0x37e27e[_0x1c0ace(0x2bd)],_0x42db5c=await purchases[_0x1c0ace(0x2de)]({'_id':_0x37e27e[_0x1c0ace(0x203)]['id']}),_0x3e03ed=await warehouse[_0x1c0ace(0x2de)]({'name':_0x1bfe25,'room':_0x153117});if(typeof _0x4d7a4f==_0x1c0ace(0x2c8))var _0x4c2c5e=[_0x37e27e['body'][_0x1c0ace(0x24a)]],_0xf083c1=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x1d9)]],_0x1ee59f=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x2ba)]],_0x1cb6af=[_0x37e27e['body']['return_qty']],_0x3daf4c=[_0x37e27e[_0x1c0ace(0x2bd)]['level']],_0x24a316=[_0x37e27e['body']['isle']],_0x520a89=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x216)]],_0xf51a5=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x218)]],_0x397322=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x1c1)]],_0x3e4bfb=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x1ed)]],_0x51bceb=[_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x1d4)]];else var _0x4c2c5e=[..._0x37e27e[_0x1c0ace(0x2bd)]['product_name']],_0xf083c1=[..._0x37e27e['body']['purchase_quantity']],_0x1ee59f=[..._0x37e27e[_0x1c0ace(0x2bd)]['stocks']],_0x1cb6af=[..._0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x28f)]],_0x3daf4c=[..._0x37e27e['body'][_0x1c0ace(0x298)]],_0x24a316=[..._0x37e27e['body'][_0x1c0ace(0x25e)]],_0x520a89=[..._0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x216)]],_0xf51a5=[..._0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x218)]],_0x397322=[..._0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x1c1)]],_0x3e4bfb=[..._0x37e27e['body'][_0x1c0ace(0x1ed)]],_0x51bceb=[..._0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x1d4)]];const _0x596ade=_0x4c2c5e[_0x1c0ace(0x24d)](_0x27f947=>{return _0x27f947={'product_name':_0x27f947};});_0xf083c1[_0x1c0ace(0x1c8)]((_0x38422d,_0x444187)=>{var _0x11c83e=_0x1c0ace;_0x596ade[_0x444187][_0x11c83e(0x1d9)]=_0x38422d;}),_0x1ee59f[_0x1c0ace(0x1c8)]((_0x59a627,_0x40f261)=>{_0x596ade[_0x40f261]['stock_quantity']=_0x59a627;}),_0x1cb6af[_0x1c0ace(0x1c8)]((_0x30d3a1,_0x558100)=>{var _0x20f4d1=_0x1c0ace;_0x596ade[_0x558100][_0x20f4d1(0x28f)]=_0x30d3a1;}),_0x3daf4c[_0x1c0ace(0x1c8)]((_0x29149a,_0x3d8194)=>{_0x596ade[_0x3d8194]['bay']=_0x29149a;}),_0x24a316['forEach']((_0x3809aa,_0x3c37d1)=>{var _0x5836fc=_0x1c0ace;_0x596ade[_0x3c37d1][_0x5836fc(0x293)]=_0x3809aa;}),_0x520a89[_0x1c0ace(0x1c8)]((_0x2c21a7,_0x461620)=>{var _0x517517=_0x1c0ace;_0x596ade[_0x461620][_0x517517(0x211)]=_0x2c21a7;}),_0xf51a5[_0x1c0ace(0x1c8)]((_0x1bcf81,_0x5d9abf)=>{var _0x1d0b49=_0x1c0ace;_0x596ade[_0x5d9abf][_0x1d0b49(0x2aa)]=_0x1bcf81;}),_0x397322[_0x1c0ace(0x1c8)]((_0x4a81cd,_0x45969d)=>{var _0x4637e5=_0x1c0ace;_0x596ade[_0x45969d][_0x4637e5(0x23d)]=_0x4a81cd;}),_0x3e4bfb[_0x1c0ace(0x1c8)]((_0x163420,_0x4464ae)=>{var _0x21597d=_0x1c0ace;_0x596ade[_0x4464ae][_0x21597d(0x21c)]=_0x163420;}),_0x51bceb[_0x1c0ace(0x1c8)]((_0x455d2f,_0x11c4b8)=>{_0x596ade[_0x11c4b8]['secondary_code']=_0x455d2f;}),_0x42db5c[_0x1c0ace(0x1db)][_0x1c0ace(0x1c8)](_0x4c9023=>{var _0x43fc05=_0x1c0ace;const _0x111a19=_0x3e03ed['product_details'][_0x43fc05(0x24d)](_0xc215ee=>{var _0x466f7e=_0x43fc05;_0xc215ee[_0x466f7e(0x24a)]==_0x4c9023[_0x466f7e(0x24a)]&&_0xc215ee[_0x466f7e(0x211)]==_0x4c9023[_0x466f7e(0x211)]&&_0xc215ee[_0x466f7e(0x2aa)]==_0x4c9023[_0x466f7e(0x2aa)]&&_0xc215ee[_0x466f7e(0x293)]==_0x4c9023[_0x466f7e(0x293)]&&_0xc215ee[_0x466f7e(0x2cb)]==_0x4c9023['bay']&&_0xc215ee[_0x466f7e(0x276)]==_0x4c9023[_0x466f7e(0x276)]&&_0xc215ee['storage']==_0x4c9023[_0x466f7e(0x241)]&&(console[_0x466f7e(0x22c)](parseInt(_0xc215ee[_0x466f7e(0x247)])+_0x466f7e(0x20a)+parseInt(_0x4c9023[_0x466f7e(0x207)])),_0xc215ee[_0x466f7e(0x247)]=parseInt(_0xc215ee[_0x466f7e(0x247)])+parseInt(_0x4c9023[_0x466f7e(0x207)]));});}),await _0x3e03ed[_0x1c0ace(0x235)]();const _0xab64a6=_0x596ade[_0x1c0ace(0x217)](_0x346efb=>_0x346efb[_0x1c0ace(0x28f)]!=='0'&&_0x346efb[_0x1c0ace(0x28f)]!=='');var _0x3986c8=0x0;_0xab64a6['forEach'](_0x26ce04=>{var _0x3c03e4=_0x1c0ace;console['log'](_0x3c03e4(0x238),_0x26ce04),(parseInt(_0x26ce04['purchase_quantity'])<parseInt(_0x26ce04[_0x3c03e4(0x28f)])||parseInt(_0x26ce04['stock_quantity'])<parseInt(_0x26ce04[_0x3c03e4(0x28f)]))&&_0x3986c8++;});if(_0x3986c8!=0x0)return _0x37e27e[_0x1c0ace(0x259)](_0x1c0ace(0x1d1),_0x1c0ace(0x1be)),_0x594a07[_0x1c0ace(0x219)](_0x1c0ace(0x278));const _0x3de831=new purchases_return({'invoice':_0x194066,'suppliers':_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x296)],'date':_0x1e9a78,'warehouse_name':_0x1bfe25,'return_product':_0xab64a6,'note':_0x69a551,'room':_0x153117,'to_warehouse_name':_0xb5a34a,'to_room':_0x239caf}),_0xaff0a1=await _0x3de831[_0x1c0ace(0x235)]();console[_0x1c0ace(0x22c)](_0x3de831);const _0x1dd1ed=await purchases_return['findOne']({'invoice':_0x194066}),_0x1eef61=await warehouse[_0x1c0ace(0x2de)]({'name':_0xb5a34a,'room':_0x239caf});_0x1dd1ed['return_product'][_0x1c0ace(0x1c8)](_0x294abf=>{var _0x37795e=_0x1c0ace,_0x45e045=0x0;const _0x4c11be=_0x1eef61[_0x37795e(0x273)][_0x37795e(0x24d)](_0x927972=>{var _0x36cf2a=_0x37795e;_0x927972[_0x36cf2a(0x24a)]==_0x294abf[_0x36cf2a(0x24a)]&&_0x927972[_0x36cf2a(0x211)]==_0x294abf['floorlevel']&&_0x927972[_0x36cf2a(0x2aa)]==_0x294abf['type']&&_0x927972[_0x36cf2a(0x293)]==_0x294abf[_0x36cf2a(0x293)]&&_0x927972[_0x36cf2a(0x2cb)]==_0x294abf[_0x36cf2a(0x2cb)]&&(_0x927972[_0x36cf2a(0x247)]=parseInt(_0x927972['product_stock'])-parseInt(_0x294abf[_0x36cf2a(0x28f)]),_0x45e045++);});_0x45e045=='0'&&(_0x1eef61[_0x37795e(0x273)]=_0x1eef61[_0x37795e(0x273)][_0x37795e(0x2be)]({'product_name':_0x294abf[_0x37795e(0x24a)],'product_stock':_0x294abf[_0x37795e(0x28f)],'primary_code':_0x294abf[_0x37795e(0x21c)],'secondary_code':_0x294abf[_0x37795e(0x1f2)],'product_code':_0x294abf[_0x37795e(0x23d)],'storage':_0x294abf['storage'],'rack':_0x294abf[_0x37795e(0x276)],'bay':_0x294abf[_0x37795e(0x2cb)],'bin':_0x294abf[_0x37795e(0x293)],'type':_0x294abf[_0x37795e(0x2aa)],'floorlevel':_0x294abf[_0x37795e(0x211)],'maxProducts':_0x294abf[_0x37795e(0x27b)],'unit':_0x294abf[_0x37795e(0x23c)],'secondary_unit':_0x294abf['secondary_unit'],'expiry_date':_0x294abf[_0x37795e(0x205)]}));}),await _0x1eef61['save']();const _0x58c4a5=await purchases[_0x1c0ace(0x2de)]({'invoice':_0x194066});_0x58c4a5['return_data']=_0x1c0ace(0x2c3);const _0x494573=await _0x58c4a5[_0x1c0ace(0x235)](),_0x548688=new s_payment_data({'invoice':_0x194066,'suppliers':_0x37e27e['body'][_0x1c0ace(0x296)],'reason':_0x1c0ace(0x254)});await _0x548688[_0x1c0ace(0x235)]();const _0x240cb3=await master_shop[_0x1c0ace(0x2b9)]();console[_0x1c0ace(0x22c)]('add\x20post',_0x240cb3[0x0][_0x1c0ace(0x25d)]);const _0x443092=await email_settings[_0x1c0ace(0x2de)](),_0x2130ba=await suppliers[_0x1c0ace(0x2de)]({'name':_0x37e27e[_0x1c0ace(0x2bd)][_0x1c0ace(0x296)]});console[_0x1c0ace(0x22c)](_0x1c0ace(0x1c2),_0x2130ba);_0x240cb3[0x0][_0x1c0ace(0x297)]==0x1?(right_currency=_0x240cb3[0x0][_0x1c0ace(0x1c3)],left_currency=''):(right_currency='',left_currency=_0x240cb3[0x0][_0x1c0ace(0x1c3)]);var _0x14f47d=_0x4c2c5e,_0x493c06=_0x1cb6af,_0x5eb402='',_0x7e11cf;for(_0x7e11cf in _0x14f47d){_0x5eb402+=_0x1c0ace(0x294)+_0x1c0ace(0x265)+_0x14f47d[_0x7e11cf]+_0x1c0ace(0x28b)+_0x1c0ace(0x265)+_0x493c06[_0x7e11cf]+_0x1c0ace(0x28b)+'</tr>';}console[_0x1c0ace(0x22c)](_0x1c0ace(0x230),_0x5eb402);let _0x4ce2bf=nodemailer['createTransport']({'service':_0x1c0ace(0x2cf),'auth':{'user':_0x443092[_0x1c0ace(0x271)],'pass':_0x443092[_0x1c0ace(0x25f)]}}),_0xc3bc1a={'from':_0x443092[_0x1c0ace(0x271)],'to':_0x2130ba[_0x1c0ace(0x271)],'subject':_0x1c0ace(0x1d6),'attachments':[{'filename':'Logo.png','path':__dirname+_0x1c0ace(0x285)+_0x1c0ace(0x23f)+_0x240cb3[0x0][_0x1c0ace(0x25d)],'cid':_0x1c0ace(0x2ca)}],'html':_0x1c0ace(0x28e)+_0x1c0ace(0x20d)+'</head><body>'+_0x1c0ace(0x2a6)+_0x1c0ace(0x2d2)+_0x1c0ace(0x2a6)+_0x1c0ace(0x22f)+_0x1c0ace(0x245)+'<div>'+_0x1c0ace(0x2b2)+_0x240cb3[0x0][_0x1c0ace(0x266)]+'\x20</h2>'+_0x1c0ace(0x245)+'</div>'+_0x1c0ace(0x291)+_0x1c0ace(0x2a6)+_0x1c0ace(0x2da)+'\x20Order\x20Number\x20:\x20'+_0x194066+'\x20'+_0x1c0ace(0x249)+_0x1c0ace(0x27c)+_0x1e9a78+'\x20'+_0x1c0ace(0x2ab)+_0x1c0ace(0x1ee)+_0x1c0ace(0x245)+_0x1c0ace(0x1b9)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x1c0ace(0x1cc)+_0x1c0ace(0x222)+_0x1c0ace(0x1fc)+_0x1c0ace(0x250)+'</tr>'+_0x1c0ace(0x27d)+_0x1c0ace(0x22d)+'\x20'+_0x5eb402+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x1c0ace(0x2ad)+_0x1c0ace(0x277)+_0x240cb3[0x0][_0x1c0ace(0x266)]+'</h5>'+'</div>'+_0x1c0ace(0x245)+_0x1c0ace(0x282)};_0x4ce2bf['sendMail'](_0xc3bc1a,function(_0xd754f0,_0x455ccb){var _0x4713b4=_0x1c0ace;_0xd754f0?(console[_0x4713b4(0x22c)](_0xd754f0),console['log'](_0x4713b4(0x242))):console['log'](_0x4713b4(0x243));}),_0x37e27e[_0x1c0ace(0x259)](_0x1c0ace(0x201),_0x1c0ace(0x1ba)),_0x594a07[_0x1c0ace(0x219)](_0x1c0ace(0x270));}catch(_0x386227){console[_0x1c0ace(0x22c)](_0x386227),_0x594a07[_0x1c0ace(0x2d7)](0xc8)[_0x1c0ace(0x26e)]({'message':_0x386227['message']});}}),router[a0_0x44936e(0x25c)](a0_0x44936e(0x2a3),auth,async(_0x1102e0,_0xee81b9)=>{var _0x48b573=a0_0x44936e;try{const {username:_0x262ed2,email:_0x2e378a,role:_0x59bbcb}=_0x1102e0[_0x48b573(0x2d3)],_0x5820b4=_0x1102e0[_0x48b573(0x2d3)],_0xb25613=await profile[_0x48b573(0x2de)]({'email':_0x5820b4['email']}),_0x1bb6cf=await master_shop[_0x48b573(0x2b9)](),_0x1d0c5b=_0x1102e0[_0x48b573(0x203)]['id'],_0x33ce68=await purchases[_0x48b573(0x2c5)](_0x1d0c5b);if(_0x1bb6cf[0x0]['language']==_0x48b573(0x232))var _0x335733=users[_0x48b573(0x2af)];else{if(_0x1bb6cf[0x0][_0x48b573(0x204)]=='Hindi')var _0x335733=users[_0x48b573(0x2c4)];else{if(_0x1bb6cf[0x0][_0x48b573(0x204)]==_0x48b573(0x268))var _0x335733=users[_0x48b573(0x268)];else{if(_0x1bb6cf[0x0][_0x48b573(0x204)]==_0x48b573(0x2a9))var _0x335733=users[_0x48b573(0x2a9)];else{if(_0x1bb6cf[0x0][_0x48b573(0x204)]==_0x48b573(0x2dc))var _0x335733=users[_0x48b573(0x2dc)];else{if(_0x1bb6cf[0x0][_0x48b573(0x204)]==_0x48b573(0x23e))var _0x335733=users['Portuguese'];else{if(_0x1bb6cf[0x0][_0x48b573(0x204)]==_0x48b573(0x2c9))var _0x335733=users[_0x48b573(0x2c9)];else{if(_0x1bb6cf[0x0]['language']==_0x48b573(0x210))var _0x335733=users['Arabic'];}}}}}}}_0xee81b9['render'](_0x48b573(0x21e),{'success':_0x1102e0['flash'](_0x48b573(0x201)),'errors':_0x1102e0[_0x48b573(0x259)](_0x48b573(0x1d1)),'role':_0x5820b4,'profile':_0xb25613,'alldata':_0x33ce68,'master_shop':_0x1bb6cf,'language':_0x335733}),console[_0x48b573(0x22c)](alldata);}catch(_0xf90b31){console['log'](_0xf90b31);}}),router[a0_0x44936e(0x275)](a0_0x44936e(0x29a),async(_0xd723c9,_0xb16c3c)=>{var _0x370789=a0_0x44936e;const {product_code:_0x5b7d22}=_0xd723c9[_0x370789(0x2bd)];var _0x18d59f;const _0x4c6626=await product[_0x370789(0x22e)]([{'$match':{'primary_code':_0x5b7d22,'product_category':_0x370789(0x2b3)}},{'$group':{'_id':_0x370789(0x295),'name':{'$first':_0x370789(0x1cf)},'category':{'$first':_0x370789(0x1f3)},'brand':{'$first':_0x370789(0x2a5)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x370789(0x2c1)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x370789(0x24e)},'secondary_code':{'$first':_0x370789(0x24c)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x370789(0x1dc)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1c8383=await product['aggregate']([{'$match':{'secondary_code':_0x5b7d22,'product_category':_0x370789(0x2b3)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x370789(0x2a5)},'unit':{'$first':_0x370789(0x2bc)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x370789(0x1eb)},'primary_code':{'$first':_0x370789(0x24e)},'secondary_code':{'$first':_0x370789(0x24c)},'maxStocks':{'$first':_0x370789(0x1d0)},'maxProdPerUnit':{'$first':_0x370789(0x1dc)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x370789(0x299)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4c6626[_0x370789(0x23b)]>0x0)_0x18d59f=_0x4c6626;else _0x1c8383[_0x370789(0x23b)]>0x0&&(_0x18d59f=_0x1c8383);_0xb16c3c[_0x370789(0x26e)](_0x18d59f);}),router['post'](a0_0x44936e(0x2d8),async(_0x300213,_0x2659d3)=>{var _0x3bef5c=a0_0x44936e;const {primaryCode:_0x529a09,secondaryCode:_0x59bd65,productCode:_0x3ffbe0,bay:_0xc0a378,bin:_0x1eea52,types:_0x12fc47,pallet:_0x2a1594,warehouses:_0x554624,room:_0x731a65}=_0x300213[_0x3bef5c(0x2bd)];console[_0x3bef5c(0x22c)](_0x300213[_0x3bef5c(0x2bd)]);try{const _0x422674=await warehouse[_0x3bef5c(0x22e)]([{'$match':{'name':_0x554624,'room':_0x731a65}},{'$unwind':_0x3bef5c(0x215)},{'$match':{'product_details.bay':_0xc0a378,'product_details.bin':_0x1eea52,'product_details.type':_0x12fc47}},{'$group':{'_id':_0x3bef5c(0x229),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x3bef5c(0x1e6)},'isle':{'$first':_0x3bef5c(0x1c4)},'pallet':{'$first':_0x3bef5c(0x212)},'maxProducts':{'$first':_0x3bef5c(0x1f8)}}}]);_0x2659d3[_0x3bef5c(0x2d7)](0xc8)[_0x3bef5c(0x26e)](_0x422674);}catch(_0x957376){_0x2659d3[_0x3bef5c(0x2d7)](0x194)[_0x3bef5c(0x26e)]({'message':_0x957376[_0x3bef5c(0x1bf)]});}}),module[a0_0x44936e(0x20e)]=router;