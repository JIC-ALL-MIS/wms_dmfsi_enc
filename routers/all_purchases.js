var a0_0x7b03a0=a0_0x4d12;function a0_0x5d1d(){var _0x301c4a=['prod_code','prod_Qty','back','ejs','purchases\x20item\x20return\x20successfull','Floor','\x20<>\x20','</body></html>','map','</span>','<tr>','../models/all_models','</table>','65652atOeOb','staff','secondary_unit','rak','$alertquantity','Rack\x20A','Level','COLD\x20STORAGE','1183432vVHUBA','$invoice','product_code_hide','$product_details.secondary_code','$date','product_name','invoice','Enabled','errors','$product.bay','find','batch_code','INC-','$maxProdPerUnit','express','MaxStocks_data','suppliers_data','product_stock','production_date','$product','5686926EHucUp','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/view/add_purchases','json','purchase_quantity','getDate','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','padStart','maxStocks','secondary_code','catch','Sales\x20Update\x20successfully','$paid_amount','</div>','/invoice/:id','$return_data','return_purchase','email','Portuguese\x20(BR)','$_id','gmail','amount','\x20Order\x20Number\x20:\x20','table\x20page','room_name','prod_secondunit','<div>','<html><head><title></title>','$product_details.product_stock','error','Enclosed','$room','$product_details','password','save','\x20Order\x20Date\x20:\x20','then','4uLjwok','prod_primunit','type','payment\x20successfull','deliverycode','Error\x20Occurs','role','level','purchase_invoice','/view/return_purchase/:id','getFullYear','push','expiry_date','redirect','Chinese','5070208FhfkQS','site_title','$category','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','RMSEmail','port','German','$product.room_name','Shelves','suppliers','<!DOCTYPE\x20html>','$product_details._id','flash','return_data','primary_code','due_amount','logo','prod_pallet','product','/preview/:id','sendMail','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','English\x20(US)','bin','$product_details.floorlevel','forEach','Room_name','room','$secondary_code','render','secondary_code_hide','$warehouse_name','$secondary_unit','Rack\x20F','$product.bin','Email\x20sent\x20successfully','Ambient','pallet','prod_isle','Rack\x20B','<hr\x20class=\x22my-3\x22>','image','getMonth','/upload/','/CheckingWarehouse','<h2>\x20','/view/add_purchases/:id','$note','<h5\x20style=\x22text-align:\x20left;\x22>','bay','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','here','warehouse_name','product_list','primary_code_hide','storage','$maxStocks','<strong>\x20Regards\x20</strong>','English','DRY\x20STORAGE','post','max_product_unit','stock_quantity','string','prod_invoice','Rack\x20D','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchase\x20data\x20update\x20successfully','$suppliers','name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.level','abs','$product_details.primary_code','RoomAssign','Logo.png','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','host','rack','/all_purchases/view/','Hindi','success','<h5>','$expiry_date','standard_unit','$product_details.expiry_date','maxperunit','aggregate','Arabic','findOne','True','master','Purchase\x20Mail','findById','floor','/../public','$due_amount','\x20<\x20wew\x20>\x20','/view','status','delivery_code','$product_details.pallet','An\x20error\x20occurred\x20while\x20saving\x20data.','</thead>','prod_cat','Purchase\x20Return\x20Mail','note','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$primary_code','prod_level','finalize','</tbody>','$product.floorlevel','foreach\x20newproduct','add_purchases\x20error','date','$suppliers_docs','$unit','log','add_purchases','203869TQMIth','</h5>','length','user','warehouse','exports','Purchase\x20data\x20added\x20successfully','return_qty','$product_details.maxProducts','/all_purchases/view','language','/give_payment/:id','POnumber','isle','delivery_date','product_code','prod_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','concat','params','5366136TWapMA','user_id','/barcode_scanner','$product_details.product_name','get','prod_unit','</td>','types','random','$product_details.bay','JO_number','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','</head><body>','currency_placement','quantity','An\x20error\x20occurred.','../public/language/languages.json','$product_details.bin','createTransport','suppliers_docs','message','Purchase\x20Return','<span\x20style=\x22float:\x20right;\x22>','$product_details.storage','prod_name','$finalize','$product_details.rack','1652350AgkYQX','Portuguese','product_cat','\x20</h2>','French','edit_purchases_view','Return\x20Goods','$product.type','actual_qty','$product.quantity','nodemailer','$product_code','floorlevel','$brand','$product_details.product_code','Receiving\x20Area','actual_uom','Rack\x20C','Arabic\x20(ae)','Spanish','alertQTY','stocks','body','product_details'];a0_0x5d1d=function(){return _0x301c4a;};return a0_0x5d1d();}(function(_0x4ed896,_0x901e94){var _0x190398=a0_0x4d12,_0x43fe26=_0x4ed896();while(!![]){try{var _0x42ca0e=-parseInt(_0x190398(0x233))/0x1*(parseInt(_0x190398(0x2cd))/0x2)+-parseInt(_0x190398(0x288))/0x3+parseInt(_0x190398(0x290))/0x4+parseInt(_0x190398(0x263))/0x5+-parseInt(_0x190398(0x247))/0x6+parseInt(_0x190398(0x2a4))/0x7+parseInt(_0x190398(0x2dc))/0x8;if(_0x42ca0e===_0x901e94)break;else _0x43fe26['push'](_0x43fe26['shift']());}catch(_0x374efa){_0x43fe26['push'](_0x43fe26['shift']());}}}(a0_0x5d1d,0xb6c00));const express=require(a0_0x7b03a0(0x29e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x7b03a0(0x286)),auth=require('../middleware/auth'),nodemailer=require(a0_0x7b03a0(0x26d));var ejs=require(a0_0x7b03a0(0x27e));const path=require(a0_0x7b03a0(0x2a5)),users=require(a0_0x7b03a0(0x258));router['get'](a0_0x7b03a0(0x21d),auth,async(_0x27cf58,_0x4003bd)=>{var _0x13563e=a0_0x7b03a0;try{const {username:_0x76b826,email:_0x21859a,role:_0x3a045e}=_0x27cf58[_0x13563e(0x236)],_0x30abcf=_0x27cf58[_0x13563e(0x236)],_0x5157be=await profile['findOne']({'email':_0x30abcf['email']}),_0x516b66=await staff[_0x13563e(0x214)]({'email':_0x30abcf['email']});if(_0x30abcf[_0x13563e(0x2d3)]==_0x13563e(0x289)){const _0x505740=await staff[_0x13563e(0x214)]({'email':_0x30abcf['email']});}const _0x2dc78c=await master_shop[_0x13563e(0x29a)]();let _0x7e8c93;if(_0x30abcf[_0x13563e(0x2d3)]==_0x13563e(0x289)){const _0x294875=await staff[_0x13563e(0x214)]({'email':_0x30abcf['email']});_0x7e8c93=await purchases[_0x13563e(0x212)]([{'$match':{'warehouse_name':_0x294875[_0x13563e(0x237)]}},{'$lookup':{'from':_0x13563e(0x2e5),'localField':_0x13563e(0x2e5),'foreignField':'name','as':_0x13563e(0x25b)}},{'$unwind':_0x13563e(0x22f)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x13563e(0x291)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x13563e(0x294)},'warehouse_name':{'$first':_0x13563e(0x2fc)},'room':{'$first':_0x13563e(0x2c7)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x13563e(0x2b4)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x13563e(0x20e)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x13563e(0x26c)},'level':{'$addToSet':_0x13563e(0x299)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x13563e(0x26a)},'floorlevel':{'$addToSet':_0x13563e(0x22b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x7e8c93=await purchases[_0x13563e(0x212)]([{'$lookup':{'from':_0x13563e(0x2e5),'localField':_0x13563e(0x2e5),'foreignField':_0x13563e(0x1ff),'as':_0x13563e(0x25b)}},{'$unwind':_0x13563e(0x22f)},{'$unwind':_0x13563e(0x2a3)},{'$group':{'_id':_0x13563e(0x2bb),'invoice':{'$first':_0x13563e(0x291)},'suppliers':{'$first':_0x13563e(0x1fe)},'date':{'$first':_0x13563e(0x294)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x13563e(0x2e3)},'product':{'$push':_0x13563e(0x2a3)},'note':{'$first':_0x13563e(0x30c)},'paid_amount':{'$first':_0x13563e(0x2b4)},'due_amount':{'$first':_0x13563e(0x21b)},'return_data':{'$first':_0x13563e(0x2b7)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x13563e(0x20e)},'suppliers_docs':{'$first':_0x13563e(0x22f)},'total_product_quantity':{'$sum':_0x13563e(0x26c)},'level':{'$addToSet':_0x13563e(0x299)},'isle':{'$addToSet':_0x13563e(0x2ff)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x13563e(0x22b)},'finalize':{'$first':_0x13563e(0x261)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x2f3)){var _0x22b585=users[_0x13563e(0x1f4)];console[_0x13563e(0x231)](_0x22b585);}else{if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x20b))var _0x22b585=users[_0x13563e(0x20b)];else{if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x2e2))var _0x22b585=users[_0x13563e(0x2e2)];else{if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x276))var _0x22b585=users[_0x13563e(0x276)];else{if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x267))var _0x22b585=users[_0x13563e(0x267)];else{if(_0x2dc78c[0x0]['language']==_0x13563e(0x2ba))var _0x22b585=users['Portuguese'];else{if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x2db))var _0x22b585=users['Chinese'];else{if(_0x2dc78c[0x0][_0x13563e(0x23d)]==_0x13563e(0x275))var _0x22b585=users['Arabic'];}}}}}}}_0x4003bd[_0x13563e(0x2fa)]('all_purchases',{'success':_0x27cf58[_0x13563e(0x2e8)](_0x13563e(0x20c)),'errors':_0x27cf58[_0x13563e(0x2e8)](_0x13563e(0x298)),'purchases':_0x7e8c93,'role':_0x30abcf,'profile':_0x5157be,'master_shop':_0x2dc78c,'language':_0x22b585});}catch(_0x358255){console['log'](_0x13563e(0x2bf),_0x358255),_0x4003bd['status'](0xc8)[_0x13563e(0x2a8)]({'message':_0x358255['message']});}});function BayBinSelected(_0x1a82f3,_0x582e65){var _0x1aed52=a0_0x7b03a0,_0x2a37d9=[],_0x5cde2a=[],_0x316def=[],_0x57b2f0=[],_0x2306ca=[],_0x17cab4=[];let _0x2148ad=[];if(_0x1a82f3==_0x1aed52(0x1f5))switch(_0x582e65){case _0x1aed52(0x28d):_0x2a37d9=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5cde2a=[0x1,0x2],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=[_0x1aed52(0x28e),'Floor'],_0x2306ca=['D'],_0x17cab4=['A'];break;case _0x1aed52(0x304):_0x2a37d9=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5cde2a=[0x1,0x2],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=[_0x1aed52(0x28e),_0x1aed52(0x280)],_0x2306ca=['D'],_0x17cab4=['B'];break;case'Shelves':_0x2a37d9=[0x0],_0x5cde2a=[0x0],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=[_0x1aed52(0x280)],_0x2306ca=['D'],_0x17cab4=['S'];break;case _0x1aed52(0x272):_0x2a37d9=[0x0],_0x5cde2a=[0x0],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x316def=[_0x1aed52(0x280)],_0x2306ca=['D'],_0x17cab4=['R'];break;}else{if(_0x1a82f3==_0x1aed52(0x28f))switch(_0x582e65){case _0x1aed52(0x28d):_0x2a37d9=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5cde2a=['B','F'],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=[_0x1aed52(0x28e),_0x1aed52(0x280)],_0x2306ca=['C'],_0x17cab4=['A'];break;case _0x1aed52(0x304):_0x2a37d9=[0x5,0x4,0x3,0x2,0x1],_0x5cde2a=['F','B','S'],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=['Level',_0x1aed52(0x280)],_0x2306ca=['C'],_0x17cab4=['B'];break;case _0x1aed52(0x274):_0x2a37d9=[0x1,0x2,0x3,0x4,0x5],_0x5cde2a=['B','F','S'],_0x57b2f0=[0x5,0x4,0x3,0x2,0x1],_0x316def=[_0x1aed52(0x28e),_0x1aed52(0x280)],_0x2306ca=['C'],_0x17cab4=['C'];break;case _0x1aed52(0x1fb):_0x2a37d9=[0x5,0x4,0x3,0x2,0x1],_0x5cde2a=['F','B','S'],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=[_0x1aed52(0x28e),_0x1aed52(0x280)],_0x2306ca=['C'],_0x17cab4=['D'];break;case'Rack\x20E':_0x2a37d9=[0x4,0x3,0x2,0x1],_0x5cde2a=[0x1,0x2],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=[_0x1aed52(0x28e),_0x1aed52(0x280)],_0x2306ca=['C'],_0x17cab4=['E'];break;case _0x1aed52(0x2fe):_0x2a37d9=[0x1,0x2,0x3],_0x5cde2a=[0x1,0x2],_0x57b2f0=[0x1,0x2,0x3,0x4,0x5],_0x316def=['Level'],_0x2306ca=['C'],_0x17cab4=['F'];break;}}return{'levels':_0x2a37d9,'Isle':_0x5cde2a,'rack':_0x57b2f0,'type':_0x316def,'storage':_0x2306ca,'rak':_0x17cab4};}async function getRandom8DigitNumber(){var _0x3102e7=a0_0x7b03a0;const _0x3f63f8=0x989680,_0x42f5b1=0x5f5e0ff,_0x106e12=Math[_0x3102e7(0x219)](Math[_0x3102e7(0x24f)]()*(_0x42f5b1-_0x3f63f8+0x1))+_0x3f63f8;var _0x2bd2bf;const _0x4ada34=await purchases[_0x3102e7(0x214)]({'invoice':_0x3102e7(0x29c)+_0x106e12});return _0x4ada34&&_0x4ada34[_0x3102e7(0x235)]>0x0?_0x2bd2bf='INC-'+_0x106e12:_0x2bd2bf='INC-'+_0x106e12,_0x2bd2bf;}function a0_0x4d12(_0x2f13fa,_0x1eb60c){var _0x5d1d27=a0_0x5d1d();return a0_0x4d12=function(_0x4d12c9,_0x3b931e){_0x4d12c9=_0x4d12c9-0x1f3;var _0x274c1c=_0x5d1d27[_0x4d12c9];return _0x274c1c;},a0_0x4d12(_0x2f13fa,_0x1eb60c);}router['get'](a0_0x7b03a0(0x2a7),auth,async(_0x11dd68,_0x240a9f)=>{var _0x566cbb=a0_0x7b03a0;try{const {username:_0x1dee61,email:_0x5b7533,role:_0x449ce9}=_0x11dd68[_0x566cbb(0x236)],_0x50bedd=_0x11dd68['user'],_0x4e8823=await profile[_0x566cbb(0x214)]({'email':_0x50bedd[_0x566cbb(0x2b9)]}),_0x7959f0=await master_shop['find'](),_0x1c3bc0=await staff[_0x566cbb(0x214)]({'email':_0x50bedd['email']}),_0x44837a=await suppliers['find']({});let _0x3ae6a4;if(_0x50bedd[_0x566cbb(0x2d3)]==_0x566cbb(0x289)){const _0x4d7e26=await staff[_0x566cbb(0x214)]({'email':_0x50bedd[_0x566cbb(0x2b9)]});_0x3ae6a4=await warehouse[_0x566cbb(0x212)]([{'$match':{'status':_0x566cbb(0x297),'name':_0x4d7e26[_0x566cbb(0x237)],'warehouse_category':_0x566cbb(0x2ac),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x566cbb(0x2f1),'name':{'$first':_0x566cbb(0x2f1)}}}]);}else _0x3ae6a4=await warehouse[_0x566cbb(0x212)]([{'$match':{'status':'Enabled','warehouse_category':_0x566cbb(0x2ac),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x566cbb(0x2f1),'name':{'$first':'$name'}}}]);const _0x18e03d=await product[_0x566cbb(0x29a)]({}),_0x1438f2=await warehouse[_0x566cbb(0x29a)]({'status':_0x566cbb(0x297)}),_0x3f3c17=await purchases['find']({}),_0x3c5055=_0x3f3c17[_0x566cbb(0x235)]+0x1,_0x2be039=_0x566cbb(0x29c)+_0x3c5055['toString']()[_0x566cbb(0x2af)](0x5,'0');var _0x1406fa=[_0x566cbb(0x301),_0x566cbb(0x2c6)];if(_0x7959f0[0x0][_0x566cbb(0x23d)]=='English\x20(US)')var _0x131035=users[_0x566cbb(0x1f4)];else{if(_0x7959f0[0x0][_0x566cbb(0x23d)]==_0x566cbb(0x20b))var _0x131035=users['Hindi'];else{if(_0x7959f0[0x0][_0x566cbb(0x23d)]=='German')var _0x131035=users[_0x566cbb(0x2e2)];else{if(_0x7959f0[0x0][_0x566cbb(0x23d)]==_0x566cbb(0x276))var _0x131035=users[_0x566cbb(0x276)];else{if(_0x7959f0[0x0]['language']==_0x566cbb(0x267))var _0x131035=users[_0x566cbb(0x267)];else{if(_0x7959f0[0x0][_0x566cbb(0x23d)]==_0x566cbb(0x2ba))var _0x131035=users[_0x566cbb(0x264)];else{if(_0x7959f0[0x0][_0x566cbb(0x23d)]==_0x566cbb(0x2db))var _0x131035=users[_0x566cbb(0x2db)];else{if(_0x7959f0[0x0][_0x566cbb(0x23d)]=='Arabic\x20(ae)')var _0x131035=users[_0x566cbb(0x213)];}}}}}}}const _0x32f81d=getRandom8DigitNumber();_0x32f81d['then'](_0x2507d4=>{var _0x39c053=_0x566cbb;_0x240a9f['render'](_0x39c053(0x232),{'success':_0x11dd68[_0x39c053(0x2e8)](_0x39c053(0x20c)),'errors':_0x11dd68[_0x39c053(0x2e8)](_0x39c053(0x298)),'role':_0x50bedd,'profile':_0x4e8823,'suppliers':_0x44837a,'warehouse':_0x3ae6a4,'product':_0x18e03d,'invoice':_0x2507d4,'master_shop':_0x7959f0,'language':_0x131035,'find_data':_0x1438f2,'rooms_data':_0x1406fa});})[_0x566cbb(0x2b2)](_0x1f0f17=>{var _0x102189=_0x566cbb;_0x11dd68['flash'](_0x102189(0x298),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x240a9f[_0x102189(0x2da)](_0x102189(0x23c));});}catch(_0x1e2e01){console[_0x566cbb(0x231)](_0x1e2e01);}}),router['get'](a0_0x7b03a0(0x30b),auth,async(_0x108f37,_0x186522)=>{var _0xa5dd74=a0_0x7b03a0;try{const _0x3e271b=_0x108f37[_0xa5dd74(0x246)]['id'];console['log'](_0x3e271b);const _0x166e5a=await master_shop['find']();console[_0xa5dd74(0x231)]('master',_0x166e5a);const _0x443b95=await product[_0xa5dd74(0x214)]({'name':_0x3e271b});console['log'](_0xa5dd74(0x2ee),_0x443b95),_0x186522[_0xa5dd74(0x21e)](0xc8)[_0xa5dd74(0x2a8)]({'product_data':_0x443b95,'master':_0x166e5a});}catch(_0x5045da){console['log'](_0xa5dd74(0x22d),_0x5045da);}}),router[a0_0x7b03a0(0x1f6)]('/view/add_purchases',auth,async(_0xdaa700,_0x575da9)=>{var _0x3bad05=a0_0x7b03a0;try{const {invoice:_0x21c735,date:_0x3765c6,warehouse_name:_0x1bad36,prod_name:_0x376ce5,prod_code:_0x4bd46e,prod_qty:_0x37452f,prod_unit:_0x498fb5,prod_secondunit:_0x40a195,prod_level:_0x48bca5,prod_isle:_0x1602f0,prod_pallet:_0x570b2b,note:_0xa32853,expiry_date:_0x1f2c5b,batch_code:_0x2a923d,payable:_0x29829e,due_amount:_0x307cca,Room_name:_0x246b01,primary_code:_0x341199,secondary_code:_0x3e1452,MaxStocks_data:_0x1ca681,PO_number:_0x3bd69d,SCRN:_0x513094,JO_number:_0x3624f8}=_0xdaa700[_0x3bad05(0x279)];if(typeof _0x376ce5==_0x3bad05(0x1f9))var _0x156cff=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x260)]],_0xf8b950=[_0xdaa700[_0x3bad05(0x279)]['prod_code']],_0x20dd8e=[_0xdaa700['body'][_0x3bad05(0x27c)]],_0x4114a0=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2ce)]],_0x4ed3f8=[_0xdaa700[_0x3bad05(0x279)]['prod_secondunit']],_0x2efab8=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x228)]],_0x61d50e=[_0xdaa700[_0x3bad05(0x279)]['primary_code']],_0xe3e85c=[_0xdaa700['body'][_0x3bad05(0x2b1)]],_0x12f9cc=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x29f)]],_0x2b7323=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x29b)]],_0x2d2349=[_0xdaa700[_0x3bad05(0x279)]['expiry_date']],_0x2642e0=[_0xdaa700['body']['max_product_unit']],_0x42f2f4=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x277)]],_0x4d2d06=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2a2)]],_0x23147b=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x223)]],_0x1170bf=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x204)]],_0x28b045=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2d1)]],_0x446a5c=[_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x1fa)]],_0x440b47=[_0xdaa700['body'][_0x3bad05(0x26b)]],_0x1fb10a=[_0xdaa700[_0x3bad05(0x279)]['actual_uom']];else var _0x156cff=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x260)]],_0xf8b950=[..._0xdaa700['body'][_0x3bad05(0x27b)]],_0x20dd8e=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x27c)]],_0x4114a0=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2ce)]],_0x4ed3f8=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2c1)]],_0x2efab8=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x228)]],_0x61d50e=[..._0xdaa700[_0x3bad05(0x279)]['primary_code']],_0xe3e85c=[..._0xdaa700[_0x3bad05(0x279)]['secondary_code']],_0x12f9cc=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x29f)]],_0x2b7323=[..._0xdaa700[_0x3bad05(0x279)]['batch_code']],_0x2d2349=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2d9)]],_0x2642e0=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x1f7)]],_0x42f2f4=[..._0xdaa700[_0x3bad05(0x279)]['alertQTY']],_0x4d2d06=[..._0xdaa700['body'][_0x3bad05(0x2a2)]],_0x23147b=[..._0xdaa700[_0x3bad05(0x279)]['prod_cat']],_0x1170bf=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x204)]],_0x28b045=[..._0xdaa700[_0x3bad05(0x279)]['deliverycode']],_0x446a5c=[..._0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x1fa)]],_0x440b47=[..._0xdaa700[_0x3bad05(0x279)]['actual_qty']],_0x1fb10a=[..._0xdaa700['body']['actual_uom']];const _0x206799=_0x156cff['map'](_0x723a5e=>{return _0x723a5e={'product_name':_0x723a5e};});_0x440b47['forEach']((_0x3f16aa,_0x5da94e)=>{var _0x39bdec=_0x3bad05;_0x206799[_0x5da94e][_0x39bdec(0x26b)]=Math[_0x39bdec(0x202)](_0x3f16aa);}),_0x1fb10a[_0x3bad05(0x2f6)]((_0x1ebcee,_0x573bd0)=>{var _0x27d04f=_0x3bad05;_0x206799[_0x573bd0][_0x27d04f(0x273)]=_0x1ebcee;}),_0xf8b950[_0x3bad05(0x2f6)]((_0x2ad15b,_0x814dfe)=>{var _0x357dd3=_0x3bad05;_0x206799[_0x814dfe][_0x357dd3(0x242)]=_0x2ad15b;}),_0x20dd8e[_0x3bad05(0x2f6)]((_0x10a873,_0x1c2d38)=>{var _0x1bc710=_0x3bad05;_0x206799[_0x1c2d38][_0x1bc710(0x256)]=Math[_0x1bc710(0x202)](_0x10a873);}),_0x4114a0[_0x3bad05(0x2f6)]((_0xd9b6ee,_0x39f534)=>{var _0x411e0f=_0x3bad05;_0x206799[_0x39f534][_0x411e0f(0x20f)]=_0xd9b6ee;}),_0x4ed3f8['forEach']((_0xd8c7ff,_0x5c7cf8)=>{var _0x11f420=_0x3bad05;_0x206799[_0x5c7cf8][_0x11f420(0x28a)]=_0xd8c7ff;}),_0x2efab8[_0x3bad05(0x2f6)]((_0x1edd34,_0x84e852)=>{var _0x19216f=_0x3bad05;_0x1170bf[_0x19216f(0x2f6)]((_0x431184,_0x27a6f6)=>{var _0x277227=_0x19216f;if(_0x431184==_0x277227(0x272)&&_0x84e852==_0x27a6f6){console['log'](_0x431184+_0x277227(0x21c)+_0x84e852+'\x20<>\x20'+_0x27a6f6+_0x277227(0x281)+_0x1edd34);var _0x18f105=_0x1edd34['slice'](0x3);_0x206799[_0x84e852]['storage']=_0x1edd34[0x0],_0x206799[_0x84e852][_0x277227(0x209)]=_0x1edd34[0x1],_0x206799[_0x84e852][_0x277227(0x30e)]=0x0,_0x206799[_0x84e852][_0x277227(0x2f4)]=0x0,_0x206799[_0x84e852][_0x277227(0x2cf)]=_0x277227(0x280),_0x206799[_0x84e852][_0x277227(0x26f)]=_0x18f105;}else{if(_0x431184==_0x277227(0x2e4)&&_0x84e852==_0x27a6f6){var _0x18f105=_0x1edd34[_0x277227(0x30f)](0x3);_0x206799[_0x84e852][_0x277227(0x315)]=_0x1edd34[0x0],_0x206799[_0x84e852][_0x277227(0x209)]=_0x1edd34[0x1],_0x206799[_0x84e852][_0x277227(0x30e)]=0x0,_0x206799[_0x84e852][_0x277227(0x2f4)]=0x0,_0x206799[_0x84e852][_0x277227(0x2cf)]='Floor',_0x206799[_0x84e852][_0x277227(0x26f)]=_0x1edd34[0x5];}else{if(_0x84e852==_0x27a6f6){if(_0x1edd34[0x0]=='A'&&_0x1edd34[0x1]=='L'&&_0x1edd34[0x2]=='L')console[_0x277227(0x231)](_0x431184+'\x20<>\x20'+_0x84e852+'\x20<>\x20'+_0x27a6f6+_0x277227(0x281)+_0x1edd34+_0x277227(0x311)),_0x206799[_0x84e852][_0x277227(0x315)]=_0x1edd34[0x0],_0x206799[_0x84e852]['rack']=_0x1edd34[0x1],_0x206799[_0x84e852]['bay']=0x0,_0x206799[_0x84e852][_0x277227(0x2f4)]=0x0,_0x206799[_0x84e852][_0x277227(0x2cf)]=_0x277227(0x280),_0x206799[_0x84e852]['floorlevel']=_0x1edd34[0x3];else{var _0x1cbf57;if(_0x1edd34[0x4]=='L')_0x1cbf57=_0x277227(0x28e);else _0x1edd34[0x4]=='F'&&(_0x1cbf57=_0x277227(0x280));_0x206799[_0x84e852][_0x277227(0x315)]=_0x1edd34[0x0],_0x206799[_0x84e852]['rack']=_0x1edd34[0x1],_0x206799[_0x84e852][_0x277227(0x30e)]=_0x1edd34[0x2],_0x206799[_0x84e852][_0x277227(0x2f4)]=_0x1edd34[0x3],_0x206799[_0x84e852][_0x277227(0x2cf)]=_0x1cbf57,_0x206799[_0x84e852][_0x277227(0x26f)]=_0x1edd34[0x5];}}}}});}),_0x61d50e[_0x3bad05(0x2f6)]((_0x4f0bac,_0xe754e4)=>{_0x206799[_0xe754e4]['primary_code']=_0x4f0bac;}),_0xe3e85c[_0x3bad05(0x2f6)]((_0x353869,_0xade672)=>{_0x206799[_0xade672]['secondary_code']=_0x353869;}),_0x12f9cc[_0x3bad05(0x2f6)]((_0x30528d,_0x22ed8f)=>{var _0x15340b=_0x3bad05;_0x206799[_0x22ed8f][_0x15340b(0x2b0)]=_0x30528d;}),_0x2b7323[_0x3bad05(0x2f6)]((_0x322f74,_0x5c29a7)=>{var _0x315810=_0x3bad05;_0x206799[_0x5c29a7][_0x315810(0x29b)]=_0x322f74;}),_0x2d2349[_0x3bad05(0x2f6)]((_0x3b9592,_0x589d7d)=>{var _0x1641a9=_0x3bad05;_0x206799[_0x589d7d][_0x1641a9(0x2d9)]=_0x3b9592;}),_0x2642e0[_0x3bad05(0x2f6)]((_0x4850e6,_0x172296)=>{var _0x35e4f7=_0x3bad05;_0x206799[_0x172296][_0x35e4f7(0x211)]=_0x4850e6;}),_0x42f2f4[_0x3bad05(0x2f6)]((_0x1bd000,_0x247bb9)=>{var _0x2cba2c=_0x3bad05;_0x206799[_0x247bb9][_0x2cba2c(0x277)]=_0x1bd000;}),_0x4d2d06[_0x3bad05(0x2f6)]((_0x1b5ca0,_0x2a997a)=>{var _0x3c832c=_0x3bad05;_0x206799[_0x2a997a][_0x3c832c(0x2a2)]=_0x1b5ca0;}),_0x23147b[_0x3bad05(0x2f6)]((_0x3c49d8,_0x54f7bb)=>{var _0x515108=_0x3bad05;_0x206799[_0x54f7bb][_0x515108(0x265)]=_0x3c49d8;}),_0x1170bf['forEach']((_0x52c7ec,_0x5033fd)=>{var _0x59b7ca=_0x3bad05;_0x206799[_0x5033fd][_0x59b7ca(0x2c0)]=_0x52c7ec;}),_0x28b045['forEach']((_0x36395e,_0x488e11)=>{var _0x5197b4=_0x3bad05;_0x206799[_0x488e11][_0x5197b4(0x21f)]=_0x36395e;}),_0x446a5c[_0x3bad05(0x2f6)]((_0x3e5d68,_0x3f0bca)=>{_0x206799[_0x3f0bca]['invoice']=_0x3e5d68;});const _0x413b49=_0x1170bf[_0x3bad05(0x283)](_0x488526=>{return _0x488526={'room_name':_0x488526};}),_0x588320=_0x206799['filter'](_0xddb6da=>_0xddb6da[_0x3bad05(0x256)]!=='0'&&_0xddb6da[_0x3bad05(0x256)]!==''),_0x28376f=new purchases({'invoice':_0x21c735,'suppliers':_0xdaa700[_0x3bad05(0x279)][_0x3bad05(0x2e5)],'date':_0x3765c6,'warehouse_name':_0x1bad36,'product':_0x588320,'note':_0xa32853,'due_amount':_0x307cca,'POnumber':_0x3bd69d,'SCRN':_0x513094,'JO_number':_0x3624f8,'roomList':_0x413b49}),_0x40a7f2=await _0x28376f[_0x3bad05(0x2ca)](),_0x2d0bbf=await purchases[_0x3bad05(0x214)]({'invoice':_0x21c735}),_0x3608fd=_0x2d0bbf[_0x3bad05(0x2ee)]['map'](async _0x204a93=>{var _0x24d2e4=_0x3bad05,_0x20eb7a=await warehouse[_0x24d2e4(0x214)]({'name':_0x1bad36,'room':_0x204a93[_0x24d2e4(0x2c0)]}),_0x308343=0x0;return _0x20eb7a[_0x24d2e4(0x27a)][_0x24d2e4(0x2f6)](_0x501d55=>{var _0x514d11=_0x24d2e4;_0x501d55['product_name']==_0x204a93[_0x514d11(0x295)]&&_0x501d55[_0x514d11(0x26f)]==_0x204a93['floorlevel']&&_0x501d55[_0x514d11(0x2cf)]==_0x204a93[_0x514d11(0x2cf)]&&_0x501d55[_0x514d11(0x2f4)]==_0x204a93['bin']&&_0x501d55[_0x514d11(0x30e)]==_0x204a93[_0x514d11(0x30e)]&&_0x501d55['rack']==_0x204a93[_0x514d11(0x209)]&&_0x501d55[_0x514d11(0x315)]==_0x204a93[_0x514d11(0x315)]&&_0x501d55['expiry_date']==_0x204a93['expiry_date']&&_0x501d55[_0x514d11(0x29b)]==_0x204a93[_0x514d11(0x29b)]&&_0x501d55[_0x514d11(0x2a2)]==_0x204a93[_0x514d11(0x2a2)]&&_0x501d55['invoice']==_0x2d0bbf[_0x514d11(0x296)]&&(_0x501d55[_0x514d11(0x2a1)]+=Math['abs'](_0x204a93[_0x514d11(0x256)]),_0x308343++);}),_0x308343===0x0&&_0x20eb7a[_0x24d2e4(0x27a)][_0x24d2e4(0x2d8)]({'product_name':_0x204a93[_0x24d2e4(0x295)],'product_stock':Math[_0x24d2e4(0x202)](_0x204a93[_0x24d2e4(0x256)]),'primary_code':_0x204a93['primary_code'],'secondary_code':_0x204a93[_0x24d2e4(0x2b1)],'product_code':_0x204a93[_0x24d2e4(0x242)],'storage':_0x204a93['storage'],'rack':_0x204a93[_0x24d2e4(0x209)],'bay':_0x204a93[_0x24d2e4(0x30e)],'bin':_0x204a93[_0x24d2e4(0x2f4)],'type':_0x204a93[_0x24d2e4(0x2cf)],'floorlevel':_0x204a93[_0x24d2e4(0x26f)],'maxProducts':_0x204a93[_0x24d2e4(0x2b0)],'unit':_0x204a93[_0x24d2e4(0x20f)],'secondary_unit':_0x204a93[_0x24d2e4(0x28a)],'expiry_date':_0x204a93[_0x24d2e4(0x2d9)],'maxPerUnit':_0x204a93['maxperunit'],'batch_code':_0x204a93[_0x24d2e4(0x29b)],'alertQTY':_0x204a93[_0x24d2e4(0x277)],'production_date':_0x204a93[_0x24d2e4(0x2a2)],'product_cat':_0x204a93['product_cat'],'invoice':_0x204a93[_0x24d2e4(0x296)],'actual_qty':Math['abs'](_0x204a93[_0x24d2e4(0x26b)]),'actual_uom':_0x204a93['actual_uom']}),_0x20eb7a;});Promise['all'](_0x3608fd)[_0x3bad05(0x2cc)](async _0x4595d5=>{var _0x5eb8dd=_0x3bad05;try{for(const _0x2e45aa of _0x4595d5){await _0x2e45aa[_0x5eb8dd(0x2ca)]();}const _0x1fef7f=await master_shop[_0x5eb8dd(0x29a)](),_0x3e021a=await email_settings['findOne'](),_0x40c510=await supervisor_settings['find']();var _0x32fd84=_0x2d0bbf[_0x5eb8dd(0x2ee)],_0x5c9b7e='',_0x64daca;for(_0x64daca in _0x32fd84){_0x5c9b7e+=_0x5eb8dd(0x285)+_0x5eb8dd(0x200)+_0x32fd84[_0x64daca]['product_name']+'</td>'+_0x5eb8dd(0x200)+_0x32fd84[_0x64daca][_0x5eb8dd(0x242)]+'</td>'+_0x5eb8dd(0x200)+_0x32fd84[_0x64daca]['quantity']+_0x5eb8dd(0x24d)+_0x5eb8dd(0x200)+_0x32fd84[_0x64daca]['standard_unit']+_0x5eb8dd(0x24d)+_0x5eb8dd(0x200)+_0x32fd84[_0x64daca][_0x5eb8dd(0x28a)]+_0x5eb8dd(0x24d)+_0x5eb8dd(0x200)+_0x2d0bbf[_0x5eb8dd(0x312)]+_0x5eb8dd(0x24d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32fd84[_0x64daca]['room_name']+_0x5eb8dd(0x24d)+_0x5eb8dd(0x200)+_0x32fd84[_0x64daca][_0x5eb8dd(0x315)]+_0x32fd84[_0x64daca][_0x5eb8dd(0x209)]+_0x32fd84[_0x64daca][_0x5eb8dd(0x30e)]+_0x32fd84[_0x64daca][_0x5eb8dd(0x2f4)]+_0x32fd84[_0x64daca][_0x5eb8dd(0x2cf)][0x0]+_0x32fd84[_0x64daca]['floorlevel']+_0x5eb8dd(0x24d),_0x5eb8dd(0x206);}let _0x81ea0f=nodemailer[_0x5eb8dd(0x25a)]({'host':_0x3e021a[_0x5eb8dd(0x208)],'port':Number(_0x3e021a[_0x5eb8dd(0x2e1)]),'secure':![],'auth':{'user':_0x3e021a[_0x5eb8dd(0x2b9)],'pass':_0x3e021a[_0x5eb8dd(0x2c9)]}}),_0x25af9b={'from':_0x3e021a[_0x5eb8dd(0x2b9)],'to':_0x40c510[0x0][_0x5eb8dd(0x2e0)],'subject':_0x5eb8dd(0x217),'attachments':[{'filename':'Logo.png','path':__dirname+_0x5eb8dd(0x21a)+'/upload/'+_0x1fef7f[0x0][_0x5eb8dd(0x306)],'cid':_0x5eb8dd(0x2ec)}],'html':'<!DOCTYPE\x20html>'+_0x5eb8dd(0x2c3)+'</head><body>'+'<div>'+_0x5eb8dd(0x2ab)+_0x5eb8dd(0x2c2)+_0x5eb8dd(0x244)+'</div>'+_0x5eb8dd(0x2c2)+'<h2>\x20'+_0x1fef7f[0x0]['site_title']+_0x5eb8dd(0x266)+'</div>'+_0x5eb8dd(0x2b5)+_0x5eb8dd(0x305)+_0x5eb8dd(0x2c2)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5eb8dd(0x2be)+_0x2d0bbf[_0x5eb8dd(0x296)]+'\x20'+_0x5eb8dd(0x25e)+_0x5eb8dd(0x2cb)+_0x2d0bbf[_0x5eb8dd(0x22e)]+'\x20'+_0x5eb8dd(0x284)+_0x5eb8dd(0x234)+_0x5eb8dd(0x2b5)+_0x5eb8dd(0x1fc)+_0x5eb8dd(0x2ae)+_0x5eb8dd(0x285)+_0x5eb8dd(0x2f2)+_0x5eb8dd(0x207)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5eb8dd(0x2df)+_0x5eb8dd(0x226)+_0x5eb8dd(0x2ad)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5eb8dd(0x206)+_0x5eb8dd(0x222)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x5c9b7e+'\x20'+_0x5eb8dd(0x22a)+'</table>'+_0x5eb8dd(0x2c2)+_0x5eb8dd(0x1f3)+_0x5eb8dd(0x20d)+_0x1fef7f[0x0]['site_title']+_0x5eb8dd(0x234)+_0x5eb8dd(0x2b5)+_0x5eb8dd(0x2b5)+_0x5eb8dd(0x282)};_0x81ea0f[_0x5eb8dd(0x2f0)](_0x25af9b,function(_0x39a15d,_0x27ef5f){var _0x51059b=_0x5eb8dd;_0x39a15d?(console[_0x51059b(0x231)](_0x39a15d),console[_0x51059b(0x231)](_0x51059b(0x2d2))):console['log']('Email\x20sent\x20successfully');}),_0xdaa700[_0x5eb8dd(0x2e8)]('success',_0x5eb8dd(0x239)),_0x575da9[_0x5eb8dd(0x2da)](_0x5eb8dd(0x20a));}catch(_0x46e593){console['error'](_0x46e593),_0x575da9[_0x5eb8dd(0x21e)](0x1f4)[_0x5eb8dd(0x2a8)]({'error':_0x5eb8dd(0x221)});}})[_0x3bad05(0x2b2)](_0x5e7ac6=>{var _0x14669c=_0x3bad05;console[_0x14669c(0x2c5)](_0x5e7ac6),_0x575da9['status'](0x1f4)[_0x14669c(0x2a8)]({'error':_0x14669c(0x257)});});}catch(_0x24046a){console[_0x3bad05(0x231)](_0x24046a);}}),router['get'](a0_0x7b03a0(0x2ef),auth,async(_0x38cbd8,_0x28a9cc)=>{var _0x2181da=a0_0x7b03a0;try{const {username:_0xd6d45a,email:_0x297085,role:_0x58e582}=_0x38cbd8['user'],_0x1ffbe3=_0x38cbd8[_0x2181da(0x236)],_0x4019bf=await profile[_0x2181da(0x214)]({'email':_0x1ffbe3[_0x2181da(0x2b9)]}),_0x40969d=await master_shop[_0x2181da(0x29a)](),_0x8ad1e9=_0x38cbd8[_0x2181da(0x246)]['id'],_0x2e2b27=await purchases[_0x2181da(0x218)](_0x8ad1e9),_0x5d3d65=await warehouse[_0x2181da(0x212)]([{'$match':{'name':_0x2e2b27[_0x2181da(0x312)],'room':_0x2e2b27[_0x2181da(0x2f8)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2181da(0x24a)},'product_stock':{'$first':_0x2181da(0x2c4)},'bay':{'$first':_0x2181da(0x250)},'bin':{'$first':_0x2181da(0x259)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x2181da(0x2f5)},'primary_code':{'$first':_0x2181da(0x203)},'secondary_code':{'$first':_0x2181da(0x293)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2181da(0x210)}}}]),_0xdae3e9=await customer[_0x2181da(0x29a)]({});let _0x3b4917;if(_0x1ffbe3['role']==_0x2181da(0x289)){const _0x2e0549=await staff[_0x2181da(0x214)]({'email':_0x1ffbe3[_0x2181da(0x2b9)]});_0x3b4917=await warehouse['aggregate']([{'$match':{'status':_0x2181da(0x297),'name':_0x2e0549['warehouse']}},{'$group':{'_id':_0x2181da(0x2f1),'name':{'$first':_0x2181da(0x2f1)}}}]);}else _0x3b4917=await warehouse[_0x2181da(0x212)]([{'$match':{'status':_0x2181da(0x297)}},{'$group':{'_id':'$name','name':{'$first':_0x2181da(0x2f1)}}}]);const _0xc73aae=await product[_0x2181da(0x29a)]({}),_0x407311=await suppliers['find']({}),_0x37bd69=BayBinSelected(_0x2e2b27['warehouse_name'],_0x2e2b27[_0x2181da(0x2f8)]);if(_0x40969d[0x0][_0x2181da(0x23d)]==_0x2181da(0x2f3)){var _0x389362=users[_0x2181da(0x1f4)];console['log'](_0x389362);}else{if(_0x40969d[0x0][_0x2181da(0x23d)]==_0x2181da(0x20b))var _0x389362=users[_0x2181da(0x20b)];else{if(_0x40969d[0x0]['language']=='German')var _0x389362=users[_0x2181da(0x2e2)];else{if(_0x40969d[0x0][_0x2181da(0x23d)]==_0x2181da(0x276))var _0x389362=users[_0x2181da(0x276)];else{if(_0x40969d[0x0]['language']=='French')var _0x389362=users[_0x2181da(0x267)];else{if(_0x40969d[0x0]['language']==_0x2181da(0x2ba))var _0x389362=users['Portuguese'];else{if(_0x40969d[0x0][_0x2181da(0x23d)]==_0x2181da(0x2db))var _0x389362=users[_0x2181da(0x2db)];else{if(_0x40969d[0x0][_0x2181da(0x23d)]==_0x2181da(0x275))var _0x389362=users[_0x2181da(0x213)];}}}}}}}_0x28a9cc[_0x2181da(0x2fa)](_0x2181da(0x268),{'success':_0x38cbd8['flash'](_0x2181da(0x20c)),'errors':_0x38cbd8['flash'](_0x2181da(0x298)),'role':_0x1ffbe3,'profile':_0x4019bf,'customer':_0xdae3e9,'warehouse':_0x3b4917,'product':_0x5d3d65,'user':_0x2e2b27,'master_shop':_0x40969d,'unit':_0xc73aae,'language':_0x389362,'suppliers':_0x407311,'dataSelected':_0x37bd69});}catch(_0x4df9c9){console[_0x2181da(0x231)](_0x4df9c9);}}),router[a0_0x7b03a0(0x1f6)](a0_0x7b03a0(0x2ef),auth,async(_0x811f29,_0x25d892)=>{var _0x393ca7=a0_0x7b03a0;try{const _0x41ba44=_0x811f29['params']['id'],{invoice:_0x272ec7,warehouse_name:_0x2be522,Room_name:_0x3fc2ab}=_0x811f29['body'],_0x29e4db=await warehouse[_0x393ca7(0x214)]({'name':_0x2be522,'room':_0x3fc2ab}),_0x1abc93=await purchases[_0x393ca7(0x214)]({'invoice':_0x272ec7});_0x1abc93[_0x393ca7(0x2ee)][_0x393ca7(0x2f6)](_0x5b7fb5=>{var _0xf4e133=_0x393ca7,_0x28b7aa=0x0;const _0x42d20d=_0x29e4db['product_details'][_0xf4e133(0x283)](_0x4ed298=>{var _0x14242e=_0xf4e133;_0x4ed298[_0x14242e(0x295)]==_0x5b7fb5[_0x14242e(0x295)]&&_0x4ed298[_0x14242e(0x26f)]==_0x5b7fb5[_0x14242e(0x26f)]&&_0x4ed298[_0x14242e(0x2cf)]==_0x5b7fb5[_0x14242e(0x2cf)]&&_0x4ed298[_0x14242e(0x2f4)]==_0x5b7fb5['bin']&&_0x4ed298[_0x14242e(0x30e)]==_0x5b7fb5[_0x14242e(0x30e)]&&_0x4ed298[_0x14242e(0x209)]==_0x5b7fb5[_0x14242e(0x209)]&&_0x4ed298[_0x14242e(0x315)]==_0x5b7fb5[_0x14242e(0x315)]&&_0x4ed298[_0x14242e(0x2d9)]==_0x5b7fb5[_0x14242e(0x2d9)]&&_0x4ed298[_0x14242e(0x29b)]==_0x5b7fb5[_0x14242e(0x29b)]&&_0x4ed298[_0x14242e(0x2a2)]==_0x5b7fb5[_0x14242e(0x2a2)]&&_0x4ed298[_0x14242e(0x241)]==_0x5b7fb5['delivery_date']&&_0x4ed298[_0x14242e(0x21f)]==_0x5b7fb5[_0x14242e(0x21f)]&&(_0x4ed298[_0x14242e(0x2a1)]=parseInt(_0x4ed298[_0x14242e(0x2a1)])+parseInt(_0x5b7fb5['quantity']),_0x28b7aa++);});_0x28b7aa=='0'&&(_0x29e4db[_0xf4e133(0x27a)]=_0x29e4db[_0xf4e133(0x27a)]['concat']({'product_name':_0x5b7fb5[_0xf4e133(0x295)],'product_stock':_0x5b7fb5[_0xf4e133(0x256)],'primary_code':_0x5b7fb5[_0xf4e133(0x2ea)],'secondary_code':_0x5b7fb5[_0xf4e133(0x2b1)],'product_code':_0x5b7fb5[_0xf4e133(0x242)],'storage':_0x5b7fb5['storage'],'rack':_0x5b7fb5[_0xf4e133(0x209)],'bay':_0x5b7fb5[_0xf4e133(0x30e)],'bin':_0x5b7fb5[_0xf4e133(0x2f4)],'type':_0x5b7fb5['type'],'floorlevel':_0x5b7fb5[_0xf4e133(0x26f)],'maxProducts':_0x5b7fb5['maxStocks'],'unit':_0x5b7fb5[_0xf4e133(0x20f)],'secondary_unit':_0x5b7fb5['secondary_unit'],'expiry_date':_0x5b7fb5[_0xf4e133(0x2d9)],'maxPerUnit':_0x5b7fb5[_0xf4e133(0x211)],'batch_code':_0x5b7fb5[_0xf4e133(0x29b)],'alertQTY':_0x5b7fb5[_0xf4e133(0x277)],'production_date':_0x5b7fb5[_0xf4e133(0x2a2)],'delivery_date':_0x5b7fb5[_0xf4e133(0x241)],'delivery_code':_0x5b7fb5[_0xf4e133(0x21f)]}));}),await _0x29e4db[_0x393ca7(0x2ca)](),_0x1abc93[_0x393ca7(0x229)]='True';const _0x172895=await _0x1abc93['save']();_0x811f29['flash'](_0x393ca7(0x20c),_0x393ca7(0x2b3)),_0x25d892[_0x393ca7(0x2da)](_0x393ca7(0x23c));}catch(_0x577655){console[_0x393ca7(0x231)](_0x577655);}}),router['get']('/view/:id',auth,async(_0x552bda,_0x1c6c31)=>{var _0x48b907=a0_0x7b03a0;try{const {username:_0x45d573,email:_0x52e2d3,role:_0xbfa8ef}=_0x552bda[_0x48b907(0x236)],_0x375826=_0x552bda[_0x48b907(0x236)],_0x563799=await profile[_0x48b907(0x214)]({'email':_0x375826[_0x48b907(0x2b9)]}),_0x640c4b=await master_shop[_0x48b907(0x29a)](),_0x218efa=_0x552bda[_0x48b907(0x246)]['id'],_0x19942e=await purchases[_0x48b907(0x218)](_0x218efa),_0x1a719f=await suppliers['find']({});let _0x3a502a;if(_0x375826[_0x48b907(0x2d3)]==_0x48b907(0x289)){const _0x5414af=await staff[_0x48b907(0x214)]({'email':_0x375826[_0x48b907(0x2b9)]});_0x3a502a=await warehouse[_0x48b907(0x29a)]({'status':_0x48b907(0x297),'name':_0x5414af[_0x48b907(0x237)],'warehouse_category':_0x48b907(0x2ac)});}else _0x3a502a=await warehouse['aggregate']([{'$match':{'status':_0x48b907(0x297),'warehouse_category':_0x48b907(0x2ac)}},{'$group':{'_id':_0x48b907(0x2f1),'name':{'$first':_0x48b907(0x2f1)}}}]);const _0x14a72f=await product[_0x48b907(0x29a)]({}),_0x2c7269=BayBinSelected(_0x19942e[_0x48b907(0x312)],_0x19942e[_0x48b907(0x2f8)]);let _0x31ad92=new Date(_0x19942e[_0x48b907(0x2d9)]),_0x29f1d3=('0'+_0x31ad92['getDate']())['slice'](-0x2),_0x33ef4b=('0'+(_0x31ad92[_0x48b907(0x307)]()+0x1))['slice'](-0x2),_0x17012e=_0x31ad92['getFullYear'](),_0x2cf505=_0x17012e+'-'+_0x33ef4b+'-'+_0x29f1d3;if(_0x640c4b[0x0][_0x48b907(0x23d)]==_0x48b907(0x2f3)){var _0x3dce08=users[_0x48b907(0x1f4)];console[_0x48b907(0x231)](_0x3dce08);}else{if(_0x640c4b[0x0]['language']==_0x48b907(0x20b))var _0x3dce08=users[_0x48b907(0x20b)];else{if(_0x640c4b[0x0][_0x48b907(0x23d)]=='German')var _0x3dce08=users[_0x48b907(0x2e2)];else{if(_0x640c4b[0x0][_0x48b907(0x23d)]=='Spanish')var _0x3dce08=users[_0x48b907(0x276)];else{if(_0x640c4b[0x0]['language']=='French')var _0x3dce08=users[_0x48b907(0x267)];else{if(_0x640c4b[0x0]['language']==_0x48b907(0x2ba))var _0x3dce08=users[_0x48b907(0x264)];else{if(_0x640c4b[0x0][_0x48b907(0x23d)]=='Chinese')var _0x3dce08=users[_0x48b907(0x2db)];else{if(_0x640c4b[0x0][_0x48b907(0x23d)]==_0x48b907(0x275))var _0x3dce08=users[_0x48b907(0x213)];}}}}}}}_0x1c6c31[_0x48b907(0x2fa)]('edit_purchases',{'success':_0x552bda[_0x48b907(0x2e8)]('success'),'errors':_0x552bda[_0x48b907(0x2e8)](_0x48b907(0x298)),'role':_0x375826,'profile':_0x563799,'purchases':_0x19942e,'suppliers':_0x1a719f,'warehouse':_0x3a502a,'product':_0x14a72f,'master_shop':_0x640c4b,'language':_0x3dce08,'ed_fullDate':_0x2cf505,'dataSelected':_0x2c7269});}catch(_0x2a765a){console[_0x48b907(0x231)](_0x2a765a);}}),router[a0_0x7b03a0(0x1f6)]('/view/:id',auth,async(_0xc9a5ca,_0x3a25bf)=>{var _0x45ac42=a0_0x7b03a0;try{const _0x1aaa7d=_0xc9a5ca[_0x45ac42(0x246)]['id'],_0x5f583e=await purchases[_0x45ac42(0x214)]({'_id':_0xc9a5ca[_0x45ac42(0x246)]['id']}),_0x36ebd6=await warehouse[_0x45ac42(0x214)]({'name':_0x5f583e[_0x45ac42(0x312)],'room':_0x5f583e[_0x45ac42(0x2f8)]});_0x5f583e[_0x45ac42(0x2ee)][_0x45ac42(0x2f6)](_0xbed529=>{var _0xf125ba=_0x45ac42;const _0x286396=_0x36ebd6[_0xf125ba(0x27a)][_0xf125ba(0x283)](_0x239292=>{var _0x40f0f2=_0xf125ba;_0x239292[_0x40f0f2(0x295)]==_0xbed529[_0x40f0f2(0x295)]&&_0x239292['floorlevel']==_0xbed529[_0x40f0f2(0x26f)]&&_0x239292[_0x40f0f2(0x2cf)]==_0xbed529[_0x40f0f2(0x2cf)]&&_0x239292[_0x40f0f2(0x2f4)]==_0xbed529[_0x40f0f2(0x2f4)]&&_0x239292[_0x40f0f2(0x30e)]==_0xbed529[_0x40f0f2(0x30e)]&&_0x239292[_0x40f0f2(0x209)]==_0xbed529[_0x40f0f2(0x209)]&&_0x239292[_0x40f0f2(0x315)]==_0xbed529['storage']&&(_0x239292['product_stock']=parseInt(_0x239292[_0x40f0f2(0x2a1)])-parseInt(_0xbed529['quantity']));});}),await _0x36ebd6[_0x45ac42(0x2ca)]();const {invoice:_0x5ad94d,suppliers:_0x6ed006,date:_0x31bc3f,warehouse_name:_0x1cdbad,prod_name:_0x3f65ee,prod_code:_0x21b487,prod_qty:_0x483558,prod_unit:_0x277b37,prod_secondunit:_0x59562e,prod_level:_0x183e58,prod_isle:_0x3282ab,prod_pallet:_0x2e2277,note:_0xb0ab19,expiry_date:_0x24ab5a,batch_code:_0x14d542,paid_amount:_0x1b48b1,due_amount:_0x1747e7,Room_name:_0x3d0d30,primary_code:_0x2f6987,secondary_code:_0x13bc0f,PO_number:_0x5b8478,JO_number:_0x1c166f}=_0xc9a5ca[_0x45ac42(0x279)];if(typeof _0x3f65ee==_0x45ac42(0x1f9))var _0x51b3fc=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x260)]],_0x544605=[_0xc9a5ca['body']['prod_code']],_0x3b3057=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x243)]],_0x27a431=[_0xc9a5ca['body'][_0x45ac42(0x24c)]],_0x32f550=[_0xc9a5ca['body'][_0x45ac42(0x2c1)]],_0x28f16f=[_0xc9a5ca[_0x45ac42(0x279)]['prod_level']],_0x5ae9d2=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x303)]],_0x5f4e92=[_0xc9a5ca['body'][_0x45ac42(0x2ed)]],_0x535574=[_0xc9a5ca['body']['primary_code']],_0x5085ae=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x2b1)]],_0x122435=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x29f)]],_0x2ef29a=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x29b)]],_0x53d923=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x2d9)]],_0x593b31=[_0xc9a5ca[_0x45ac42(0x279)]['storage']],_0x329979=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x28b)]],_0xfab858=[_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x2cf)]];else var _0x51b3fc=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x260)]],_0x544605=[..._0xc9a5ca[_0x45ac42(0x279)]['prod_code']],_0x3b3057=[..._0xc9a5ca[_0x45ac42(0x279)]['prod_qty']],_0x27a431=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x24c)]],_0x32f550=[..._0xc9a5ca[_0x45ac42(0x279)]['prod_secondunit']],_0x28f16f=[..._0xc9a5ca[_0x45ac42(0x279)]['prod_level']],_0x5ae9d2=[..._0xc9a5ca['body'][_0x45ac42(0x303)]],_0x5f4e92=[..._0xc9a5ca['body']['prod_pallet']],_0x535574=[..._0xc9a5ca['body'][_0x45ac42(0x2ea)]],_0x5085ae=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x2b1)]],_0x122435=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x29f)]],_0x2ef29a=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x29b)]],_0x53d923=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x2d9)]],_0x593b31=[..._0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x315)]],_0x329979=[..._0xc9a5ca[_0x45ac42(0x279)]['rak']],_0xfab858=[..._0xc9a5ca[_0x45ac42(0x279)]['type']];const _0x10f4d4=_0x51b3fc['map'](_0x5ef134=>{return _0x5ef134={'product_name':_0x5ef134};});_0x544605['forEach']((_0x38bdb7,_0xfa3445)=>{_0x10f4d4[_0xfa3445]['product_code']=_0x38bdb7;}),_0x3b3057[_0x45ac42(0x2f6)]((_0x4cdc19,_0x40e11c)=>{var _0x37aa5a=_0x45ac42;_0x10f4d4[_0x40e11c][_0x37aa5a(0x256)]=_0x4cdc19;}),_0x27a431[_0x45ac42(0x2f6)]((_0x2b9176,_0x3b3649)=>{var _0x4b4225=_0x45ac42;_0x10f4d4[_0x3b3649][_0x4b4225(0x20f)]=_0x2b9176;}),_0x32f550[_0x45ac42(0x2f6)]((_0x5e28d5,_0x4b3bcf)=>{var _0x4a8996=_0x45ac42;_0x10f4d4[_0x4b3bcf][_0x4a8996(0x28a)]=_0x5e28d5;}),_0x28f16f[_0x45ac42(0x2f6)]((_0x194504,_0x5a34d3)=>{_0x10f4d4[_0x5a34d3]['bay']=_0x194504;}),_0x5ae9d2[_0x45ac42(0x2f6)]((_0x3e3b3d,_0x1486b0)=>{_0x10f4d4[_0x1486b0]['bin']=_0x3e3b3d;}),_0x5f4e92['forEach']((_0x262aa1,_0x4ff3f3)=>{var _0x5ed4a7=_0x45ac42;_0x10f4d4[_0x4ff3f3][_0x5ed4a7(0x26f)]=_0x262aa1;}),_0x535574['forEach']((_0x221146,_0x1a9dc0)=>{_0x10f4d4[_0x1a9dc0]['primary_code']=_0x221146;}),_0x5085ae[_0x45ac42(0x2f6)]((_0x1f2ce5,_0x214f27)=>{var _0x5c853e=_0x45ac42;_0x10f4d4[_0x214f27][_0x5c853e(0x2b1)]=_0x1f2ce5;}),_0x122435[_0x45ac42(0x2f6)]((_0x5b8070,_0xf149ff)=>{var _0x7614e2=_0x45ac42;_0x10f4d4[_0xf149ff][_0x7614e2(0x2b0)]=_0x5b8070;}),_0x2ef29a[_0x45ac42(0x2f6)]((_0x7a5d62,_0x1d9f1d)=>{var _0x4146eb=_0x45ac42;_0x10f4d4[_0x1d9f1d][_0x4146eb(0x29b)]=_0x7a5d62;}),_0x53d923[_0x45ac42(0x2f6)]((_0x41c51b,_0x39c6f4)=>{var _0x217121=_0x45ac42;_0x10f4d4[_0x39c6f4][_0x217121(0x2d9)]=_0x41c51b;}),_0xfab858['forEach']((_0x1acf0d,_0x3e09aa)=>{var _0x3ff6cc=_0x45ac42;_0x10f4d4[_0x3e09aa][_0x3ff6cc(0x2cf)]=_0x1acf0d;}),_0x593b31[_0x45ac42(0x2f6)]((_0x7c1ddb,_0x5356e5)=>{var _0x483d3f=_0x45ac42;_0x10f4d4[_0x5356e5][_0x483d3f(0x315)]=_0x7c1ddb;}),_0x329979[_0x45ac42(0x2f6)]((_0x8676d0,_0x387d72)=>{_0x10f4d4[_0x387d72]['rack']=_0x8676d0;});const _0x26601b=_0x10f4d4[_0x45ac42(0x252)](_0x11a418=>_0x11a418[_0x45ac42(0x256)]!=='0'&&_0x11a418[_0x45ac42(0x256)]!=='');_0x5f583e['invoice']=_0x5ad94d,_0x5f583e[_0x45ac42(0x2e5)]=_0x6ed006,_0x5f583e[_0x45ac42(0x22e)]=_0x31bc3f,_0x5f583e[_0x45ac42(0x312)]=_0x1cdbad,_0x5f583e['product']=_0x26601b,_0x5f583e[_0x45ac42(0x225)]=_0xb0ab19,_0x5f583e['paid_amount']=_0x1b48b1,_0x5f583e[_0x45ac42(0x2eb)]=_0x1747e7,_0x5f583e[_0x45ac42(0x2f8)]=_0x3d0d30,_0x5f583e[_0x45ac42(0x23f)]=_0x5b8478,_0x5f583e[_0x45ac42(0x251)]=_0x1c166f;const _0x47e658=await _0x5f583e[_0x45ac42(0x2ca)](),_0x227c0b=await warehouse[_0x45ac42(0x214)]({'name':_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x312)],'room':_0xc9a5ca['body'][_0x45ac42(0x2f7)]});_0x5f583e['product'][_0x45ac42(0x2f6)](_0x424ae8=>{var _0x3ce056=_0x45ac42,_0x1526d8=0x0;const _0x48deff=_0x227c0b[_0x3ce056(0x27a)][_0x3ce056(0x283)](_0x41f29f=>{var _0xfed68b=_0x3ce056;_0x41f29f[_0xfed68b(0x295)]==_0x424ae8[_0xfed68b(0x295)]&&_0x41f29f[_0xfed68b(0x26f)]==_0x424ae8[_0xfed68b(0x26f)]&&_0x41f29f[_0xfed68b(0x2cf)]==_0x424ae8[_0xfed68b(0x2cf)]&&_0x41f29f[_0xfed68b(0x2f4)]==_0x424ae8[_0xfed68b(0x2f4)]&&_0x41f29f[_0xfed68b(0x30e)]==_0x424ae8[_0xfed68b(0x30e)]&&_0x41f29f['rack']==_0x424ae8['rack']&&_0x41f29f[_0xfed68b(0x315)]==_0x424ae8[_0xfed68b(0x315)]&&(_0x41f29f[_0xfed68b(0x2a1)]=parseInt(_0x41f29f[_0xfed68b(0x2a1)])+parseInt(_0x424ae8[_0xfed68b(0x256)]),_0x1526d8++);});_0x1526d8=='0'&&(_0x227c0b['product_details']=_0x227c0b[_0x3ce056(0x27a)][_0x3ce056(0x245)]({'product_name':_0x424ae8[_0x3ce056(0x295)],'product_stock':_0x424ae8[_0x3ce056(0x256)],'primary_code':_0x424ae8[_0x3ce056(0x2ea)],'secondary_code':_0x424ae8[_0x3ce056(0x2b1)],'product_code':_0x424ae8[_0x3ce056(0x242)],'storage':_0x424ae8[_0x3ce056(0x315)],'rack':_0x424ae8[_0x3ce056(0x209)],'bay':_0x424ae8[_0x3ce056(0x30e)],'bin':_0x424ae8[_0x3ce056(0x2f4)],'type':_0x424ae8[_0x3ce056(0x2cf)],'floorlevel':_0x424ae8[_0x3ce056(0x26f)],'maxProducts':_0x424ae8[_0x3ce056(0x2b0)],'unit':_0x424ae8['standard_unit'],'secondary_unit':_0x424ae8['secondary_unit'],'expiry_date':_0x424ae8[_0x3ce056(0x2d9)]}));}),await _0x227c0b[_0x45ac42(0x2ca)]();const _0x5e356f=await s_payment_data[_0x45ac42(0x214)]({'invoice':_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x296)]});if(_0x5e356f===null){}else console[_0x45ac42(0x231)]('suppliers',_0x5e356f,_0xc9a5ca['body']['invoice']),_0x5e356f[_0x45ac42(0x2e5)]=_0xc9a5ca[_0x45ac42(0x279)][_0x45ac42(0x2e5)],await _0x5e356f[_0x45ac42(0x2ca)]();_0xc9a5ca[_0x45ac42(0x2e8)]('success',_0x45ac42(0x1fd)),_0x3a25bf[_0x45ac42(0x2da)](_0x45ac42(0x23c));}catch(_0x3de542){console['log'](_0x3de542);}}),router[a0_0x7b03a0(0x1f6)](a0_0x7b03a0(0x23e),auth,async(_0x3523e8,_0x303b20)=>{var _0x3f41ca=a0_0x7b03a0;try{const _0xa97a41=_0x3523e8['params']['id'],{invoice:_0x283745,suppliers:_0x119006,payable:_0x31ca3d,due_amount:_0x45db7d}=_0x3523e8[_0x3f41ca(0x279)],_0x4e1d8b=await purchases[_0x3f41ca(0x218)](_0xa97a41);var _0x991683=_0x31ca3d-_0x45db7d;_0x4e1d8b['paid_amount']=parseFloat(_0x4e1d8b['paid_amount'])+parseFloat(_0x45db7d),_0x4e1d8b[_0x3f41ca(0x2eb)]=_0x991683;const _0x1a1fc9=await _0x4e1d8b[_0x3f41ca(0x2ca)]();console[_0x3f41ca(0x231)](_0x1a1fc9);const _0x4d2dff=await s_payment_data[_0x3f41ca(0x214)]({'invoice':_0x283745});_0x4d2dff[_0x3f41ca(0x2bd)]=_0x991683,await _0x4d2dff[_0x3f41ca(0x2ca)]();let _0x1cd376=new Date(),_0x1caa36=('0'+_0x1cd376[_0x3f41ca(0x2aa)]())['slice'](-0x2),_0x2a4673=('0'+(_0x1cd376['getMonth']()+0x1))['slice'](-0x2),_0x5b7f6b=_0x1cd376[_0x3f41ca(0x2d7)](),_0x40e496=_0x5b7f6b+'-'+_0x2a4673+'-'+_0x1caa36;const _0x4723e2=new suppliers_payment({'invoice':_0x283745,'date':_0x5b7f6b+'-'+_0x2a4673+'-'+_0x1caa36,'suppliers':_0x119006,'reason':'Paid\x20For\x20Purchase','amount':_0x45db7d}),_0x4830b7=await _0x4723e2[_0x3f41ca(0x2ca)]();_0x3523e8['flash']('success',_0x3f41ca(0x2d0)),_0x303b20['redirect'](_0x3f41ca(0x23c));}catch(_0x549794){console[_0x3f41ca(0x231)](_0x549794);}}),router[a0_0x7b03a0(0x24b)](a0_0x7b03a0(0x2b6),auth,async(_0x5e0d04,_0xe5ae5d)=>{var _0x38788b=a0_0x7b03a0;try{const {username:_0x7a32bc,email:_0x13cfff,role:_0x15dd60}=_0x5e0d04[_0x38788b(0x236)],_0x527514=_0x5e0d04[_0x38788b(0x236)],_0x1a7b53=await profile[_0x38788b(0x214)]({'email':_0x527514[_0x38788b(0x2b9)]}),_0x29c1e7=await master_shop[_0x38788b(0x29a)]();console[_0x38788b(0x231)](_0x38788b(0x216),_0x29c1e7);const _0x4f3bd4=_0x5e0d04['params']['id'],_0x128e48=await purchases[_0x38788b(0x218)](_0x4f3bd4);console[_0x38788b(0x231)](_0x128e48);const _0x5ad9cc=await suppliers[_0x38788b(0x214)]({'name':_0x128e48[_0x38788b(0x2e5)]});console[_0x38788b(0x231)](_0x5ad9cc);if(_0x29c1e7[0x0][_0x38788b(0x23d)]=='English\x20(US)'){var _0x48004a=users['English'];console[_0x38788b(0x231)](_0x48004a);}else{if(_0x29c1e7[0x0][_0x38788b(0x23d)]==_0x38788b(0x20b))var _0x48004a=users[_0x38788b(0x20b)];else{if(_0x29c1e7[0x0][_0x38788b(0x23d)]==_0x38788b(0x2e2))var _0x48004a=users['German'];else{if(_0x29c1e7[0x0]['language']==_0x38788b(0x276))var _0x48004a=users[_0x38788b(0x276)];else{if(_0x29c1e7[0x0][_0x38788b(0x23d)]==_0x38788b(0x267))var _0x48004a=users[_0x38788b(0x267)];else{if(_0x29c1e7[0x0][_0x38788b(0x23d)]==_0x38788b(0x2ba))var _0x48004a=users[_0x38788b(0x264)];else{if(_0x29c1e7[0x0][_0x38788b(0x23d)]==_0x38788b(0x2db))var _0x48004a=users[_0x38788b(0x2db)];else{if(_0x29c1e7[0x0][_0x38788b(0x23d)]==_0x38788b(0x275))var _0x48004a=users[_0x38788b(0x213)];}}}}}}}_0xe5ae5d[_0x38788b(0x2fa)](_0x38788b(0x2d5),{'success':_0x5e0d04[_0x38788b(0x2e8)](_0x38788b(0x20c)),'errors':_0x5e0d04[_0x38788b(0x2e8)]('errors'),'role':_0x527514,'profile':_0x1a7b53,'master_shop':_0x29c1e7,'supplier':_0x5ad9cc,'purchase':_0x128e48,'language':_0x48004a});}catch(_0x3a0869){console[_0x38788b(0x231)](_0x3a0869);}}),router['get'](a0_0x7b03a0(0x2d6),auth,async(_0x2ceb84,_0x1ce618)=>{var _0x3718ab=a0_0x7b03a0;try{const {username:_0xbb700,email:_0x4664fd,role:_0x935b20}=_0x2ceb84['user'],_0x4ae74e=_0x2ceb84[_0x3718ab(0x236)],_0xc830c8=await profile[_0x3718ab(0x214)]({'email':_0x4ae74e['email']}),_0x375888=await master_shop[_0x3718ab(0x29a)]();console[_0x3718ab(0x231)](_0x3718ab(0x216),_0x375888);const _0x27b236=_0x2ceb84[_0x3718ab(0x246)]['id'];console[_0x3718ab(0x231)](_0x27b236);const _0x159cd8=await purchases[_0x3718ab(0x218)](_0x27b236);console[_0x3718ab(0x231)](_0x3718ab(0x248),_0x159cd8);const _0x2ef6a2=await product[_0x3718ab(0x29a)]({}),_0x5a8816=await warehouse[_0x3718ab(0x212)]([{'$match':{'name':_0x159cd8[_0x3718ab(0x312)],'room':_0x159cd8[_0x3718ab(0x2f8)],'warehouse_category':_0x3718ab(0x2ac)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3718ab(0x2e7),'name':{'$first':_0x3718ab(0x24a)},'product_stock':{'$first':_0x3718ab(0x2c4)},'bay':{'$first':_0x3718ab(0x250)},'bin':{'$first':_0x3718ab(0x259)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3718ab(0x2f5)},'primary_code':{'$first':_0x3718ab(0x203)},'secondary_code':{'$first':_0x3718ab(0x293)},'product_code':{'$first':_0x3718ab(0x271)},'storage':{'$first':_0x3718ab(0x25f)},'rack':{'$first':_0x3718ab(0x262)}}}]);warehouse_data=await warehouse[_0x3718ab(0x212)]([{'$match':{'status':'Enabled','name':_0x3718ab(0x269),'warehouse_category':_0x3718ab(0x2ac)}},{'$group':{'_id':_0x3718ab(0x2f1),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x3718ab(0x231)]('stock_data',_0x5a8816);if(_0x375888[0x0][_0x3718ab(0x23d)]==_0x3718ab(0x2f3)){var _0x52da08=users[_0x3718ab(0x1f4)];console[_0x3718ab(0x231)](_0x52da08);}else{if(_0x375888[0x0][_0x3718ab(0x23d)]==_0x3718ab(0x20b))var _0x52da08=users[_0x3718ab(0x20b)];else{if(_0x375888[0x0][_0x3718ab(0x23d)]==_0x3718ab(0x2e2))var _0x52da08=users['German'];else{if(_0x375888[0x0]['language']==_0x3718ab(0x276))var _0x52da08=users[_0x3718ab(0x276)];else{if(_0x375888[0x0][_0x3718ab(0x23d)]==_0x3718ab(0x267))var _0x52da08=users[_0x3718ab(0x267)];else{if(_0x375888[0x0][_0x3718ab(0x23d)]==_0x3718ab(0x2ba))var _0x52da08=users[_0x3718ab(0x264)];else{if(_0x375888[0x0][_0x3718ab(0x23d)]==_0x3718ab(0x2db))var _0x52da08=users['Chinese'];else{if(_0x375888[0x0][_0x3718ab(0x23d)]=='Arabic\x20(ae)')var _0x52da08=users[_0x3718ab(0x213)];}}}}}}}_0x1ce618[_0x3718ab(0x2fa)](_0x3718ab(0x2b8),{'success':_0x2ceb84['flash'](_0x3718ab(0x20c)),'errors':_0x2ceb84[_0x3718ab(0x2e8)](_0x3718ab(0x298)),'role':_0x4ae74e,'profile':_0xc830c8,'user':_0x159cd8,'stock':_0x5a8816,'master_shop':_0x375888,'product':_0x2ef6a2,'language':_0x52da08,'warehouse':warehouse_data});}catch(_0xcaace4){console['log'](_0xcaace4);}}),router[a0_0x7b03a0(0x1f6)](a0_0x7b03a0(0x2d6),auth,async(_0x5677bb,_0x3ecaa3)=>{var _0x17a781=a0_0x7b03a0;try{const {invoice:_0x3aea11,date:_0x288161,warehouse_name:_0xdaf294,Room_name:_0x1abf34,product_name:_0x585791,purchase_quantity:_0xaaff59,stocks:_0x3cd34e,return_qty:_0x2719fe,note:_0x2e6b22,level:_0x7443d4,isle:_0x2bbb13,pallet:_0x53b5d3,to_warehouse_name:_0x3c9880,to_Room_name:_0x321d11}=_0x5677bb[_0x17a781(0x279)],_0x10f7f0=await purchases[_0x17a781(0x214)]({'_id':_0x5677bb[_0x17a781(0x246)]['id']}),_0xa15a8c=await warehouse[_0x17a781(0x214)]({'name':_0xdaf294,'room':_0x1abf34});if(typeof _0x585791=='string')var _0x6e2eac=[_0x5677bb['body'][_0x17a781(0x295)]],_0x484df2=[_0x5677bb['body']['purchase_quantity']],_0x4609f6=[_0x5677bb['body'][_0x17a781(0x278)]],_0x15d8c4=[_0x5677bb[_0x17a781(0x279)][_0x17a781(0x23a)]],_0x5d56ac=[_0x5677bb[_0x17a781(0x279)][_0x17a781(0x2d4)]],_0x14eb5c=[_0x5677bb[_0x17a781(0x279)][_0x17a781(0x240)]],_0x4c7071=[_0x5677bb[_0x17a781(0x279)]['pallet']],_0x3d5a99=[_0x5677bb[_0x17a781(0x279)][_0x17a781(0x24e)]],_0x4daccd=[_0x5677bb[_0x17a781(0x279)]['product_code_hide']],_0x285732=[_0x5677bb[_0x17a781(0x279)][_0x17a781(0x314)]],_0xb65f9a=[_0x5677bb['body'][_0x17a781(0x2fb)]];else var _0x6e2eac=[..._0x5677bb[_0x17a781(0x279)][_0x17a781(0x295)]],_0x484df2=[..._0x5677bb['body'][_0x17a781(0x2a9)]],_0x4609f6=[..._0x5677bb['body'][_0x17a781(0x278)]],_0x15d8c4=[..._0x5677bb['body'][_0x17a781(0x23a)]],_0x5d56ac=[..._0x5677bb['body'][_0x17a781(0x2d4)]],_0x14eb5c=[..._0x5677bb[_0x17a781(0x279)][_0x17a781(0x240)]],_0x4c7071=[..._0x5677bb[_0x17a781(0x279)][_0x17a781(0x302)]],_0x3d5a99=[..._0x5677bb['body'][_0x17a781(0x24e)]],_0x4daccd=[..._0x5677bb[_0x17a781(0x279)][_0x17a781(0x292)]],_0x285732=[..._0x5677bb[_0x17a781(0x279)][_0x17a781(0x314)]],_0xb65f9a=[..._0x5677bb[_0x17a781(0x279)]['secondary_code_hide']];const _0x532638=_0x6e2eac['map'](_0x462aaf=>{return _0x462aaf={'product_name':_0x462aaf};});_0x484df2[_0x17a781(0x2f6)]((_0x30103d,_0x1f1cdb)=>{var _0x1e0b22=_0x17a781;_0x532638[_0x1f1cdb][_0x1e0b22(0x2a9)]=_0x30103d;}),_0x4609f6[_0x17a781(0x2f6)]((_0x45c807,_0x1c38eb)=>{var _0x35efb7=_0x17a781;_0x532638[_0x1c38eb][_0x35efb7(0x1f8)]=_0x45c807;}),_0x15d8c4[_0x17a781(0x2f6)]((_0x367739,_0x50e2e0)=>{var _0x2cec3b=_0x17a781;_0x532638[_0x50e2e0][_0x2cec3b(0x23a)]=_0x367739;}),_0x5d56ac[_0x17a781(0x2f6)]((_0x5a42b3,_0x19d6fc)=>{var _0x7d2a43=_0x17a781;_0x532638[_0x19d6fc][_0x7d2a43(0x30e)]=_0x5a42b3;}),_0x14eb5c[_0x17a781(0x2f6)]((_0x29a435,_0x5d025e)=>{_0x532638[_0x5d025e]['bin']=_0x29a435;}),_0x4c7071[_0x17a781(0x2f6)]((_0x372e35,_0xeffb56)=>{var _0x7ed8db=_0x17a781;_0x532638[_0xeffb56][_0x7ed8db(0x26f)]=_0x372e35;}),_0x3d5a99[_0x17a781(0x2f6)]((_0x11445d,_0x43f175)=>{var _0x48f2c4=_0x17a781;_0x532638[_0x43f175][_0x48f2c4(0x2cf)]=_0x11445d;}),_0x4daccd['forEach']((_0x5ec50e,_0x3c11bd)=>{var _0x303bb6=_0x17a781;_0x532638[_0x3c11bd][_0x303bb6(0x242)]=_0x5ec50e;}),_0x285732[_0x17a781(0x2f6)]((_0x354eaa,_0xc13e2c)=>{var _0x289c07=_0x17a781;_0x532638[_0xc13e2c][_0x289c07(0x2ea)]=_0x354eaa;}),_0xb65f9a['forEach']((_0xd0dbb4,_0x718dde)=>{var _0x5abdbe=_0x17a781;_0x532638[_0x718dde][_0x5abdbe(0x2b1)]=_0xd0dbb4;}),_0x10f7f0[_0x17a781(0x2ee)][_0x17a781(0x2f6)](_0x2a75c4=>{var _0x3fc1df=_0x17a781;const _0x4559a3=_0xa15a8c[_0x3fc1df(0x27a)]['map'](_0x1127a3=>{var _0x37693b=_0x3fc1df;_0x1127a3[_0x37693b(0x295)]==_0x2a75c4[_0x37693b(0x295)]&&_0x1127a3[_0x37693b(0x26f)]==_0x2a75c4[_0x37693b(0x26f)]&&_0x1127a3[_0x37693b(0x2cf)]==_0x2a75c4[_0x37693b(0x2cf)]&&_0x1127a3['bin']==_0x2a75c4[_0x37693b(0x2f4)]&&_0x1127a3[_0x37693b(0x30e)]==_0x2a75c4[_0x37693b(0x30e)]&&_0x1127a3[_0x37693b(0x209)]==_0x2a75c4[_0x37693b(0x209)]&&_0x1127a3[_0x37693b(0x315)]==_0x2a75c4[_0x37693b(0x315)]&&(console['log'](parseInt(_0x1127a3[_0x37693b(0x2a1)])+'\x20<>\x20'+parseInt(_0x2a75c4['quantity'])),_0x1127a3[_0x37693b(0x2a1)]=parseInt(_0x1127a3[_0x37693b(0x2a1)])+parseInt(_0x2a75c4['quantity']));});}),await _0xa15a8c[_0x17a781(0x2ca)]();const _0x1d8246=_0x532638[_0x17a781(0x252)](_0x29c7e9=>_0x29c7e9[_0x17a781(0x23a)]!=='0'&&_0x29c7e9[_0x17a781(0x23a)]!=='');var _0x4e6733=0x0;_0x1d8246[_0x17a781(0x2f6)](_0x5a301a=>{var _0x1ce6d6=_0x17a781;console['log'](_0x1ce6d6(0x22c),_0x5a301a),(parseInt(_0x5a301a['purchase_quantity'])<parseInt(_0x5a301a[_0x1ce6d6(0x23a)])||parseInt(_0x5a301a[_0x1ce6d6(0x1f8)])<parseInt(_0x5a301a[_0x1ce6d6(0x23a)]))&&_0x4e6733++;});if(_0x4e6733!=0x0)return _0x5677bb[_0x17a781(0x2e8)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3ecaa3[_0x17a781(0x2da)](_0x17a781(0x27d));const _0x472451=new purchases_return({'invoice':_0x3aea11,'suppliers':_0x5677bb[_0x17a781(0x279)]['suppliers'],'date':_0x288161,'warehouse_name':_0xdaf294,'return_product':_0x1d8246,'note':_0x2e6b22,'room':_0x1abf34,'to_warehouse_name':_0x3c9880,'to_room':_0x321d11}),_0x3ddae7=await _0x472451['save']();console[_0x17a781(0x231)](_0x472451);const _0x3ea0e8=await purchases_return[_0x17a781(0x214)]({'invoice':_0x3aea11}),_0x41da76=await warehouse[_0x17a781(0x214)]({'name':_0x3c9880,'room':_0x321d11});_0x3ea0e8['return_product']['forEach'](_0x5ec407=>{var _0x34cb01=_0x17a781,_0x22a274=0x0;const _0x15245d=_0x41da76[_0x34cb01(0x27a)]['map'](_0x4d4441=>{var _0x4c6a39=_0x34cb01;_0x4d4441[_0x4c6a39(0x295)]==_0x5ec407[_0x4c6a39(0x295)]&&_0x4d4441['floorlevel']==_0x5ec407['floorlevel']&&_0x4d4441[_0x4c6a39(0x2cf)]==_0x5ec407['type']&&_0x4d4441[_0x4c6a39(0x2f4)]==_0x5ec407[_0x4c6a39(0x2f4)]&&_0x4d4441['bay']==_0x5ec407[_0x4c6a39(0x30e)]&&(_0x4d4441[_0x4c6a39(0x2a1)]=parseInt(_0x4d4441[_0x4c6a39(0x2a1)])-parseInt(_0x5ec407['return_qty']),_0x22a274++);});_0x22a274=='0'&&(_0x41da76[_0x34cb01(0x27a)]=_0x41da76[_0x34cb01(0x27a)][_0x34cb01(0x245)]({'product_name':_0x5ec407[_0x34cb01(0x295)],'product_stock':_0x5ec407['return_qty'],'primary_code':_0x5ec407[_0x34cb01(0x2ea)],'secondary_code':_0x5ec407[_0x34cb01(0x2b1)],'product_code':_0x5ec407[_0x34cb01(0x242)],'storage':_0x5ec407[_0x34cb01(0x315)],'rack':_0x5ec407['rack'],'bay':_0x5ec407[_0x34cb01(0x30e)],'bin':_0x5ec407[_0x34cb01(0x2f4)],'type':_0x5ec407[_0x34cb01(0x2cf)],'floorlevel':_0x5ec407['floorlevel'],'maxProducts':_0x5ec407[_0x34cb01(0x2b0)],'unit':_0x5ec407[_0x34cb01(0x20f)],'secondary_unit':_0x5ec407[_0x34cb01(0x28a)],'expiry_date':_0x5ec407['expiry_date']}));}),await _0x41da76['save']();const _0x15ea3a=await purchases['findOne']({'invoice':_0x3aea11});_0x15ea3a[_0x17a781(0x2e9)]=_0x17a781(0x215);const _0x34f513=await _0x15ea3a[_0x17a781(0x2ca)](),_0x2459cd=new s_payment_data({'invoice':_0x3aea11,'suppliers':_0x5677bb['body'][_0x17a781(0x2e5)],'reason':_0x17a781(0x25d)});await _0x2459cd[_0x17a781(0x2ca)]();const _0x3ca88b=await master_shop['find']();console[_0x17a781(0x231)]('add\x20post',_0x3ca88b[0x0][_0x17a781(0x306)]);const _0x40ce6e=await email_settings[_0x17a781(0x214)](),_0x4c4f09=await suppliers[_0x17a781(0x214)]({'name':_0x5677bb[_0x17a781(0x279)][_0x17a781(0x2e5)]});console['log'](_0x17a781(0x2a0),_0x4c4f09);_0x3ca88b[0x0][_0x17a781(0x255)]==0x1?(right_currency=_0x3ca88b[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3ca88b[0x0]['currency']);var _0x4c4817=_0x6e2eac,_0x209ee4=_0x15d8c4,_0x52e3a1='',_0x2f9ff3;for(_0x2f9ff3 in _0x4c4817){_0x52e3a1+=_0x17a781(0x285)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c4817[_0x2f9ff3]+_0x17a781(0x24d)+_0x17a781(0x200)+_0x209ee4[_0x2f9ff3]+'</td>'+_0x17a781(0x206);}console['log'](_0x17a781(0x313),_0x52e3a1);let _0x3db004=nodemailer[_0x17a781(0x25a)]({'service':_0x17a781(0x2bc),'auth':{'user':_0x40ce6e[_0x17a781(0x2b9)],'pass':_0x40ce6e['password']}}),_0x4e9c03={'from':_0x40ce6e[_0x17a781(0x2b9)],'to':_0x4c4f09[_0x17a781(0x2b9)],'subject':_0x17a781(0x224),'attachments':[{'filename':_0x17a781(0x205),'path':__dirname+'/../public'+_0x17a781(0x308)+_0x3ca88b[0x0][_0x17a781(0x306)],'cid':_0x17a781(0x2ec)}],'html':_0x17a781(0x2e6)+_0x17a781(0x2c3)+_0x17a781(0x254)+_0x17a781(0x2c2)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x17a781(0x2c2)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x17a781(0x2b5)+'<div>'+_0x17a781(0x30a)+_0x3ca88b[0x0][_0x17a781(0x2dd)]+_0x17a781(0x266)+_0x17a781(0x2b5)+_0x17a781(0x2b5)+'<hr\x20class=\x22my-3\x22>'+_0x17a781(0x2c2)+_0x17a781(0x30d)+_0x17a781(0x2be)+_0x3aea11+'\x20'+_0x17a781(0x25e)+_0x17a781(0x2cb)+_0x288161+'\x20'+_0x17a781(0x284)+_0x17a781(0x234)+_0x17a781(0x2b5)+_0x17a781(0x1fc)+_0x17a781(0x2ae)+_0x17a781(0x285)+_0x17a781(0x2f2)+_0x17a781(0x2a6)+_0x17a781(0x253)+_0x17a781(0x310)+_0x17a781(0x206)+_0x17a781(0x222)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x52e3a1+'\x20'+_0x17a781(0x22a)+_0x17a781(0x287)+_0x17a781(0x2c2)+_0x17a781(0x1f3)+'<h5>'+_0x3ca88b[0x0][_0x17a781(0x2dd)]+_0x17a781(0x234)+_0x17a781(0x2b5)+_0x17a781(0x2b5)+_0x17a781(0x282)};_0x3db004['sendMail'](_0x4e9c03,function(_0x3a6d7e,_0x39bff3){var _0x1e295b=_0x17a781;_0x3a6d7e?(console[_0x1e295b(0x231)](_0x3a6d7e),console[_0x1e295b(0x231)]('Error\x20Occurs')):console[_0x1e295b(0x231)](_0x1e295b(0x300));}),_0x5677bb[_0x17a781(0x2e8)](_0x17a781(0x20c),_0x17a781(0x27f)),_0x3ecaa3[_0x17a781(0x2da)](_0x17a781(0x23c));}catch(_0xdbecf6){console[_0x17a781(0x231)](_0xdbecf6),_0x3ecaa3['status'](0xc8)[_0x17a781(0x2a8)]({'message':_0xdbecf6['message']});}}),router[a0_0x7b03a0(0x24b)]('/barcode/:id',auth,async(_0x2e7b9d,_0x2a1f46)=>{var _0x1e2350=a0_0x7b03a0;try{const {username:_0x28d443,email:_0x465814,role:_0x2ed2cf}=_0x2e7b9d[_0x1e2350(0x236)],_0x27e19e=_0x2e7b9d[_0x1e2350(0x236)],_0x3b9035=await profile[_0x1e2350(0x214)]({'email':_0x27e19e[_0x1e2350(0x2b9)]}),_0x5d4e3d=await master_shop[_0x1e2350(0x29a)](),_0x59bf40=_0x2e7b9d[_0x1e2350(0x246)]['id'],_0x16303c=await purchases[_0x1e2350(0x218)](_0x59bf40);if(_0x5d4e3d[0x0][_0x1e2350(0x23d)]==_0x1e2350(0x2f3))var _0x40ef94=users['English'];else{if(_0x5d4e3d[0x0][_0x1e2350(0x23d)]=='Hindi')var _0x40ef94=users['Hindi'];else{if(_0x5d4e3d[0x0][_0x1e2350(0x23d)]==_0x1e2350(0x2e2))var _0x40ef94=users[_0x1e2350(0x2e2)];else{if(_0x5d4e3d[0x0][_0x1e2350(0x23d)]==_0x1e2350(0x276))var _0x40ef94=users[_0x1e2350(0x276)];else{if(_0x5d4e3d[0x0]['language']==_0x1e2350(0x267))var _0x40ef94=users[_0x1e2350(0x267)];else{if(_0x5d4e3d[0x0][_0x1e2350(0x23d)]==_0x1e2350(0x2ba))var _0x40ef94=users['Portuguese'];else{if(_0x5d4e3d[0x0]['language']==_0x1e2350(0x2db))var _0x40ef94=users[_0x1e2350(0x2db)];else{if(_0x5d4e3d[0x0]['language']==_0x1e2350(0x275))var _0x40ef94=users[_0x1e2350(0x213)];}}}}}}}_0x2a1f46[_0x1e2350(0x2fa)]('all_purchases_barcode',{'success':_0x2e7b9d[_0x1e2350(0x2e8)](_0x1e2350(0x20c)),'errors':_0x2e7b9d[_0x1e2350(0x2e8)](_0x1e2350(0x298)),'role':_0x27e19e,'profile':_0x3b9035,'alldata':_0x16303c,'master_shop':_0x5d4e3d,'language':_0x40ef94}),console[_0x1e2350(0x231)](alldata);}catch(_0x2bff67){console[_0x1e2350(0x231)](_0x2bff67);}}),router[a0_0x7b03a0(0x1f6)](a0_0x7b03a0(0x249),async(_0x58859f,_0x1e6769)=>{var _0x4701a7=a0_0x7b03a0;const {product_code:_0x87dc91}=_0x58859f[_0x4701a7(0x279)];var _0x49646a;const _0xa43347=await product[_0x4701a7(0x212)]([{'$match':{'primary_code':_0x87dc91,'product_category':_0x4701a7(0x2ac)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x4701a7(0x2de)},'brand':{'$first':_0x4701a7(0x270)},'unit':{'$first':_0x4701a7(0x230)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x4701a7(0x26e)},'primary_code':{'$first':_0x4701a7(0x227)},'secondary_code':{'$first':_0x4701a7(0x2f9)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4701a7(0x29d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x210f97=await product[_0x4701a7(0x212)]([{'$match':{'secondary_code':_0x87dc91,'product_category':_0x4701a7(0x2ac)}},{'$group':{'_id':'$_id','name':{'$first':_0x4701a7(0x2f1)},'category':{'$first':'$category'},'brand':{'$first':_0x4701a7(0x270)},'unit':{'$first':_0x4701a7(0x230)},'alertquantity':{'$first':_0x4701a7(0x28c)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x4701a7(0x2f9)},'maxStocks':{'$first':_0x4701a7(0x316)},'maxProdPerUnit':{'$first':_0x4701a7(0x29d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4701a7(0x2fd)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xa43347['length']>0x0)_0x49646a=_0xa43347;else _0x210f97[_0x4701a7(0x235)]>0x0&&(_0x49646a=_0x210f97);_0x1e6769[_0x4701a7(0x2a8)](_0x49646a);}),router[a0_0x7b03a0(0x1f6)](a0_0x7b03a0(0x309),async(_0x1bd359,_0x2a0746)=>{var _0xb287=a0_0x7b03a0;const {primaryCode:_0x28f0eb,secondaryCode:_0x5c0162,productCode:_0x4d77ce,bay:_0x366794,bin:_0x3997fe,types:_0x3f7da2,pallet:_0x41ea9c,warehouses:_0x7f98dc,room:_0x2e5b28}=_0x1bd359['body'];console[_0xb287(0x231)](_0x1bd359[_0xb287(0x279)]);try{const _0x32d126=await warehouse['aggregate']([{'$match':{'name':_0x7f98dc,'room':_0x2e5b28}},{'$unwind':_0xb287(0x2c8)},{'$match':{'product_details.bay':_0x366794,'product_details.bin':_0x3997fe,'product_details.type':_0x3f7da2}},{'$group':{'_id':_0xb287(0x2e7),'name':{'$first':_0xb287(0x24a)},'product_stock':{'$first':_0xb287(0x2c4)},'level':{'$first':_0xb287(0x201)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0xb287(0x220)},'maxProducts':{'$first':_0xb287(0x23b)}}}]);_0x2a0746['status'](0xc8)[_0xb287(0x2a8)](_0x32d126);}catch(_0x3b5d28){_0x2a0746[_0xb287(0x21e)](0x194)[_0xb287(0x2a8)]({'message':_0x3b5d28[_0xb287(0x25c)]});}}),module[a0_0x7b03a0(0x238)]=router;