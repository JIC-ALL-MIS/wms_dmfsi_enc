var a0_0xfadd6a=a0_0x1dda;function a0_0x39ad(){var _0x5bff1c=['table\x20page','floorlevel','getMonth','maxperunit','</span>','sendMail','$product.room_name','$expiry_date','Purchase\x20Return\x20Mail','$secondary_unit','Rack\x20A','purchases\x20item\x20return\x20successfull','French','$product.type','paid_amount','path','rak','$finalize','/upload/','$room','<h5>','find','$product.quantity','types','ejs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','INC-','/view/:id','\x20Order\x20Number\x20:\x20','prod_code','$product_details.bay','invoice','slice','Logo.png','maxStocks','product_code','Purchase\x20Mail','storage','Error\x20Occurs','../models/all_models','Paid\x20For\x20Purchase','pallet','bay','payment\x20successfull','language','Spanish','$batch_code','user_id','room','product_list','/barcode/:id','21ZWgzDc','prod_pallet','24712220PBqZun','$product_details.storage','12KZTQCn','delivery_date','aggregate','secondary_code_hide','$product_details.product_name','\x20<\x20wew\x20>\x20','password','../middleware/auth','$paid_amount','user','currency','errors','/all_purchases/view','json','production_date','/invoice/:id','prod_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','product_code_hide','return_product','finalize','log','primary_code_hide','$product_details.bin','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','image','logo','currency_placement','success','all_purchases_barcode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','email','get','<span\x20style=\x22float:\x20right;\x22>','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','site_title','Hindi','$_id','message','/view/add_purchases','warehouse','suppliers','exports','standard_unit','$product_details','primary_code','alertQTY','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.level','all','actual_qty','$product','JO_number','suppliers_data','$product_details.rack','Ambient','createTransport','expiry_date','staff','RoomAssign','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$suppliers','Router','Level','847661aoQrDP','then','amount','Purchase\x20data\x20added\x20successfully','redirect','type','\x20Order\x20Date\x20:\x20','port','error','concat','actual_uom','</h5>','3727026NZccRO','product_cat','prod_primunit','$unit','params','True','Portuguese','prod_secondunit','toString','$alertquantity','prod_qty','<hr\x20class=\x22my-3\x22>','$product_details.pallet','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<h2>\x20','string','purchase_quantity','secondary_unit','Receiving\x20Area','\x20</h2>','$product_details.primary_code','$maxProdPerUnit','POnumber','</tr>','product_details','DRY\x20STORAGE','findById','Chinese','due_amount','COLD\x20STORAGE','RMSEmail','$product_code','<!DOCTYPE\x20html>','warehouse_name','all_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','bin','22PEWBXp','</body></html>','$warehouse_name','body','<h5\x20style=\x22text-align:\x20left;\x22>','</table>','Shelves','prod_Qty','<strong>\x20Regards\x20</strong>','MaxStocks_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','room_name','$product.bay','Rack\x20F','$due_amount','Arabic\x20(ae)','</head><body>','Floor','Portuguese\x20(BR)','<tr>','1992112ahQZQS','date','floor','max_product_unit','catch','batch_code','random','$brand','save','Rack\x20B','product_stock','add_purchases\x20error','$product.floorlevel','/../public','German','5536765VzfPoU','forEach','product','/view/add_purchases/:id','$name','master','</td>','nodemailer','flash','Raw\x20Materials','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$note','$product.bin','$product_details.secondary_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','purchase_invoice','$product_details.type','abs','length','prod_cat','Arabic','$product_details.isle','stocks','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','suppliers_docs','getDate','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','findOne','render','padStart','add\x20post','rack','\x20<>\x20','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details._id','$product_details.product_code','/view/return_purchase/:id','Sales\x20Update\x20successfully','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','return_qty','prod_level','level','Return\x20Goods','Enabled','back','product_name','map','name','Rack\x20E','prod_name','</div>','/all_purchases/view/','$maxStocks','</thead>','filter','post','<div>','isle','$return_data','$category','$product_details.product_stock','<html><head><title></title>','getFullYear','There\x27s\x20a\x20error\x20in\x20this\x20transaction','delivery_code','return_data','2422734REzNoA','$primary_code','Room_name','English\x20(US)','16BjXAFq','$invoice','$suppliers_docs','host','stock_data','529684zqFCGg','Rack\x20D','status','return_purchase','</tbody>','secondary_code','quantity'];a0_0x39ad=function(){return _0x5bff1c;};return a0_0x39ad();}(function(_0xccd64d,_0x5d014e){var _0x3f3ec2=a0_0x1dda,_0x2b9d1a=_0xccd64d();while(!![]){try{var _0x173daa=parseInt(_0x3f3ec2(0x2ac))/0x1+-parseInt(_0x3f3ec2(0x22c))/0x2*(-parseInt(_0x3f3ec2(0x26a))/0x3)+parseInt(_0x3f3ec2(0x1d0))/0x4+parseInt(_0x3f3ec2(0x1df))/0x5+-parseInt(_0x3f3ec2(0x223))/0x6*(-parseInt(_0x3f3ec2(0x266))/0x7)+-parseInt(_0x3f3ec2(0x227))/0x8*(-parseInt(_0x3f3ec2(0x2b8))/0x9)+parseInt(_0x3f3ec2(0x268))/0xa*(-parseInt(_0x3f3ec2(0x1bc))/0xb);if(_0x173daa===_0x5d014e)break;else _0x2b9d1a['push'](_0x2b9d1a['shift']());}catch(_0x2fc766){_0x2b9d1a['push'](_0x2b9d1a['shift']());}}}(a0_0x39ad,0x94d19));const express=require('express'),app=express(),router=express[a0_0xfadd6a(0x2aa)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xfadd6a(0x25a)),auth=require(a0_0xfadd6a(0x271)),nodemailer=require(a0_0xfadd6a(0x1e6));var ejs=require(a0_0xfadd6a(0x24b));const path=require(a0_0xfadd6a(0x242)),users=require('../public/language/languages.json');router[a0_0xfadd6a(0x28b)]('/view',auth,async(_0x44451d,_0x14238f)=>{var _0x11135d=a0_0xfadd6a;try{const {username:_0x16991d,email:_0x17cafd,role:_0x1b74bf}=_0x44451d['user'],_0x32c9c0=_0x44451d[_0x11135d(0x273)],_0x2d7216=await profile[_0x11135d(0x1fa)]({'email':_0x32c9c0[_0x11135d(0x28a)]}),_0x237818=await staff[_0x11135d(0x1fa)]({'email':_0x32c9c0[_0x11135d(0x28a)]});if(_0x32c9c0[_0x11135d(0x206)]=='staff'){const _0x1d89ba=await staff[_0x11135d(0x1fa)]({'email':_0x32c9c0[_0x11135d(0x28a)]});}const _0xe5bd29=await master_shop[_0x11135d(0x248)]();let _0x56c7b6;if(_0x32c9c0[_0x11135d(0x206)]=='staff'){const _0x59431d=await staff['findOne']({'email':_0x32c9c0[_0x11135d(0x28a)]});_0x56c7b6=await purchases['aggregate']([{'$match':{'warehouse_name':_0x59431d[_0x11135d(0x294)]}},{'$lookup':{'from':'suppliers','localField':_0x11135d(0x295),'foreignField':_0x11135d(0x210),'as':'suppliers_docs'}},{'$unwind':_0x11135d(0x229)},{'$unwind':_0x11135d(0x29f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x11135d(0x228)},'suppliers':{'$first':_0x11135d(0x2a9)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x11135d(0x1be)},'room':{'$first':_0x11135d(0x246)},'product':{'$push':_0x11135d(0x29f)},'note':{'$first':_0x11135d(0x1ea)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x11135d(0x1ca)},'return_data':{'$first':_0x11135d(0x21b)},'batch_code':{'$first':_0x11135d(0x261)},'expiry_date':{'$first':_0x11135d(0x23a)},'suppliers_docs':{'$first':_0x11135d(0x229)},'total_product_quantity':{'$sum':_0x11135d(0x249)},'level':{'$addToSet':_0x11135d(0x1c8)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x11135d(0x240)},'floorlevel':{'$addToSet':_0x11135d(0x1dc)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x56c7b6=await purchases[_0x11135d(0x26c)]([{'$lookup':{'from':_0x11135d(0x295),'localField':_0x11135d(0x295),'foreignField':'name','as':_0x11135d(0x1f7)}},{'$unwind':_0x11135d(0x229)},{'$unwind':_0x11135d(0x29f)},{'$group':{'_id':_0x11135d(0x291),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x11135d(0x1be)},'room':{'$addToSet':_0x11135d(0x239)},'product':{'$push':_0x11135d(0x29f)},'note':{'$first':_0x11135d(0x1ea)},'paid_amount':{'$first':_0x11135d(0x272)},'due_amount':{'$first':_0x11135d(0x1ca)},'return_data':{'$first':_0x11135d(0x21b)},'batch_code':{'$first':_0x11135d(0x261)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x11135d(0x229)},'total_product_quantity':{'$sum':_0x11135d(0x249)},'level':{'$addToSet':_0x11135d(0x1c8)},'isle':{'$addToSet':_0x11135d(0x1eb)},'type':{'$addToSet':_0x11135d(0x240)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x11135d(0x244)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xe5bd29[0x0][_0x11135d(0x25f)]=='English\x20(US)'){var _0x5a7e2e=users['English'];console['log'](_0x5a7e2e);}else{if(_0xe5bd29[0x0][_0x11135d(0x25f)]=='Hindi')var _0x5a7e2e=users[_0x11135d(0x290)];else{if(_0xe5bd29[0x0][_0x11135d(0x25f)]==_0x11135d(0x1de))var _0x5a7e2e=users['German'];else{if(_0xe5bd29[0x0]['language']=='Spanish')var _0x5a7e2e=users['Spanish'];else{if(_0xe5bd29[0x0][_0x11135d(0x25f)]=='French')var _0x5a7e2e=users['French'];else{if(_0xe5bd29[0x0][_0x11135d(0x25f)]==_0x11135d(0x1ce))var _0x5a7e2e=users['Portuguese'];else{if(_0xe5bd29[0x0][_0x11135d(0x25f)]==_0x11135d(0x1b2))var _0x5a7e2e=users[_0x11135d(0x1b2)];else{if(_0xe5bd29[0x0]['language']==_0x11135d(0x1cb))var _0x5a7e2e=users[_0x11135d(0x1f3)];}}}}}}}_0x14238f[_0x11135d(0x1fb)](_0x11135d(0x1b9),{'success':_0x44451d[_0x11135d(0x1e7)]('success'),'errors':_0x44451d['flash'](_0x11135d(0x275)),'purchases':_0x56c7b6,'role':_0x32c9c0,'profile':_0x2d7216,'master_shop':_0xe5bd29,'language':_0x5a7e2e});}catch(_0xcf496){console['log'](_0x11135d(0x233),_0xcf496),_0x14238f[_0x11135d(0x22e)](0xc8)[_0x11135d(0x277)]({'message':_0xcf496['message']});}});function BayBinSelected(_0x30511c,_0x54570f){var _0x5af0e0=a0_0xfadd6a,_0x2bacc1=[],_0x45048d=[],_0x2a9695=[],_0x13293a=[],_0x57d18a=[],_0x4b39cf=[];let _0x56d100=[];if(_0x30511c==_0x5af0e0(0x1b0))switch(_0x54570f){case'Rack\x20A':_0x2bacc1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x45048d=[0x1,0x2],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=[_0x5af0e0(0x2ab),_0x5af0e0(0x1cd)],_0x57d18a=['D'],_0x4b39cf=['A'];break;case _0x5af0e0(0x1d9):_0x2bacc1=[0x6,0x5,0x4,0x3,0x2,0x1],_0x45048d=[0x1,0x2],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=[_0x5af0e0(0x2ab),_0x5af0e0(0x1cd)],_0x57d18a=['D'],_0x4b39cf=['B'];break;case _0x5af0e0(0x1c2):_0x2bacc1=[0x0],_0x45048d=[0x0],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=[_0x5af0e0(0x1cd)],_0x57d18a=['D'],_0x4b39cf=['S'];break;case _0x5af0e0(0x2cb):_0x2bacc1=[0x0],_0x45048d=[0x0],_0x13293a=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2a9695=[_0x5af0e0(0x1cd)],_0x57d18a=['D'],_0x4b39cf=['R'];break;}else{if(_0x30511c==_0x5af0e0(0x1b4))switch(_0x54570f){case _0x5af0e0(0x23d):_0x2bacc1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x45048d=['B','F'],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=['Level',_0x5af0e0(0x1cd)],_0x57d18a=['C'],_0x4b39cf=['A'];break;case _0x5af0e0(0x1d9):_0x2bacc1=[0x5,0x4,0x3,0x2,0x1],_0x45048d=['F','B','S'],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=[_0x5af0e0(0x2ab),_0x5af0e0(0x1cd)],_0x57d18a=['C'],_0x4b39cf=['B'];break;case'Rack\x20C':_0x2bacc1=[0x1,0x2,0x3,0x4,0x5],_0x45048d=['B','F','S'],_0x13293a=[0x5,0x4,0x3,0x2,0x1],_0x2a9695=['Level',_0x5af0e0(0x1cd)],_0x57d18a=['C'],_0x4b39cf=['C'];break;case _0x5af0e0(0x22d):_0x2bacc1=[0x5,0x4,0x3,0x2,0x1],_0x45048d=['F','B','S'],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=[_0x5af0e0(0x2ab),_0x5af0e0(0x1cd)],_0x57d18a=['C'],_0x4b39cf=['D'];break;case _0x5af0e0(0x211):_0x2bacc1=[0x4,0x3,0x2,0x1],_0x45048d=[0x1,0x2],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=['Level',_0x5af0e0(0x1cd)],_0x57d18a=['C'],_0x4b39cf=['E'];break;case _0x5af0e0(0x1c9):_0x2bacc1=[0x1,0x2,0x3],_0x45048d=[0x1,0x2],_0x13293a=[0x1,0x2,0x3,0x4,0x5],_0x2a9695=[_0x5af0e0(0x2ab)],_0x57d18a=['C'],_0x4b39cf=['F'];break;}}return{'levels':_0x2bacc1,'Isle':_0x45048d,'rack':_0x13293a,'type':_0x2a9695,'storage':_0x57d18a,'rak':_0x4b39cf};}function a0_0x1dda(_0x8047b0,_0x407493){var _0x39adc6=a0_0x39ad();return a0_0x1dda=function(_0x1dda22,_0x425862){_0x1dda22=_0x1dda22-0x1ad;var _0x1d3d25=_0x39adc6[_0x1dda22];return _0x1d3d25;},a0_0x1dda(_0x8047b0,_0x407493);}async function getRandom8DigitNumber(){var _0x51bbdf=a0_0xfadd6a;const _0x520c50=0x989680,_0x23a130=0x5f5e0ff,_0x24ed2d=Math[_0x51bbdf(0x1d2)](Math[_0x51bbdf(0x1d6)]()*(_0x23a130-_0x520c50+0x1))+_0x520c50;var _0x48026d;const _0x4ab3e0=await purchases[_0x51bbdf(0x1fa)]({'invoice':_0x51bbdf(0x24d)+_0x24ed2d});return _0x4ab3e0&&_0x4ab3e0[_0x51bbdf(0x1f1)]>0x0?_0x48026d=_0x51bbdf(0x24d)+_0x24ed2d:_0x48026d='INC-'+_0x24ed2d,_0x48026d;}router['get']('/view/add_purchases',auth,async(_0x30bb5f,_0x4e5b8c)=>{var _0x4a3517=a0_0xfadd6a;try{const {username:_0x5e2c86,email:_0x1f4cb1,role:_0x55ae26}=_0x30bb5f['user'],_0x14f365=_0x30bb5f['user'],_0x61c7bc=await profile['findOne']({'email':_0x14f365['email']}),_0x408933=await master_shop[_0x4a3517(0x248)](),_0x55254b=await staff[_0x4a3517(0x1fa)]({'email':_0x14f365['email']}),_0x31f6b5=await suppliers[_0x4a3517(0x248)]({});let _0x5e4310;if(_0x14f365[_0x4a3517(0x206)]==_0x4a3517(0x2a6)){const _0x9ff63f=await staff[_0x4a3517(0x1fa)]({'email':_0x14f365[_0x4a3517(0x28a)]});_0x5e4310=await warehouse[_0x4a3517(0x26c)]([{'$match':{'status':_0x4a3517(0x20c),'name':_0x9ff63f[_0x4a3517(0x294)],'warehouse_category':_0x4a3517(0x1e8),'name':{'$ne':_0x4a3517(0x20b)}}},{'$group':{'_id':_0x4a3517(0x1e3),'name':{'$first':_0x4a3517(0x1e3)}}}]);}else _0x5e4310=await warehouse['aggregate']([{'$match':{'status':_0x4a3517(0x20c),'warehouse_category':_0x4a3517(0x1e8),'name':{'$ne':_0x4a3517(0x20b)}}},{'$group':{'_id':_0x4a3517(0x1e3),'name':{'$first':_0x4a3517(0x1e3)}}}]);const _0x3e54b5=await product[_0x4a3517(0x248)]({}),_0x11f687=await warehouse[_0x4a3517(0x248)]({'status':_0x4a3517(0x20c)}),_0x25398e=await purchases[_0x4a3517(0x248)]({}),_0x4c6443=_0x25398e[_0x4a3517(0x1f1)]+0x1,_0x409292='INC-'+_0x4c6443[_0x4a3517(0x2c0)]()[_0x4a3517(0x1fc)](0x5,'0');var _0x56fb06=[_0x4a3517(0x2a3),'Enclosed'];if(_0x408933[0x0][_0x4a3517(0x25f)]==_0x4a3517(0x226))var _0x48fdd3=users[_0x4a3517(0x2c5)];else{if(_0x408933[0x0]['language']==_0x4a3517(0x290))var _0x48fdd3=users[_0x4a3517(0x290)];else{if(_0x408933[0x0]['language']=='German')var _0x48fdd3=users[_0x4a3517(0x1de)];else{if(_0x408933[0x0]['language']=='Spanish')var _0x48fdd3=users[_0x4a3517(0x260)];else{if(_0x408933[0x0][_0x4a3517(0x25f)]==_0x4a3517(0x23f))var _0x48fdd3=users[_0x4a3517(0x23f)];else{if(_0x408933[0x0]['language']==_0x4a3517(0x1ce))var _0x48fdd3=users[_0x4a3517(0x2be)];else{if(_0x408933[0x0][_0x4a3517(0x25f)]=='Chinese')var _0x48fdd3=users[_0x4a3517(0x1b2)];else{if(_0x408933[0x0]['language']=='Arabic\x20(ae)')var _0x48fdd3=users['Arabic'];}}}}}}}const _0xccdde6=getRandom8DigitNumber();_0xccdde6[_0x4a3517(0x2ad)](_0x43f30b=>{var _0x3d2e1a=_0x4a3517;_0x4e5b8c[_0x3d2e1a(0x1fb)]('add_purchases',{'success':_0x30bb5f[_0x3d2e1a(0x1e7)]('success'),'errors':_0x30bb5f[_0x3d2e1a(0x1e7)](_0x3d2e1a(0x275)),'role':_0x14f365,'profile':_0x61c7bc,'suppliers':_0x31f6b5,'warehouse':_0x5e4310,'product':_0x3e54b5,'invoice':_0x43f30b,'master_shop':_0x408933,'language':_0x48fdd3,'find_data':_0x11f687,'rooms_data':_0x56fb06});})[_0x4a3517(0x1d4)](_0x528b3c=>{var _0x1955f2=_0x4a3517;_0x30bb5f[_0x1955f2(0x1e7)](_0x1955f2(0x275),_0x1955f2(0x220)),_0x4e5b8c['redirect'](_0x1955f2(0x276));});}catch(_0x58295d){console[_0x4a3517(0x27f)](_0x58295d);}}),router[a0_0xfadd6a(0x28b)](a0_0xfadd6a(0x1e2),auth,async(_0x30ed99,_0xd646a2)=>{var _0x5d1adb=a0_0xfadd6a;try{const _0x40b03e=_0x30ed99[_0x5d1adb(0x2bc)]['id'];console[_0x5d1adb(0x27f)](_0x40b03e);const _0x1c4a01=await master_shop['find']();console[_0x5d1adb(0x27f)]('master',_0x1c4a01);const _0x485701=await product[_0x5d1adb(0x1fa)]({'name':_0x40b03e});console[_0x5d1adb(0x27f)]('product',_0x485701),_0xd646a2[_0x5d1adb(0x22e)](0xc8)[_0x5d1adb(0x277)]({'product_data':_0x485701,'master':_0x1c4a01});}catch(_0x1cb979){console[_0x5d1adb(0x27f)](_0x5d1adb(0x1db),_0x1cb979);}}),router[a0_0xfadd6a(0x218)](a0_0xfadd6a(0x293),auth,async(_0x2d7e83,_0x593eea)=>{var _0x43cfbd=a0_0xfadd6a;try{const {invoice:_0x25286b,date:_0x37381c,warehouse_name:_0x2e9ad2,prod_name:_0x21beec,prod_code:_0x24cb15,prod_qty:_0x389d81,prod_unit:_0x411700,prod_secondunit:_0x47a8fa,prod_level:_0x421bb0,prod_isle:_0x13518f,prod_pallet:_0x1ae340,note:_0x455fc7,expiry_date:_0x57ed4d,batch_code:_0x264378,payable:_0x2dc4cb,due_amount:_0x2ae373,Room_name:_0x2da02b,primary_code:_0x4315e3,secondary_code:_0x20734c,MaxStocks_data:_0x3194d8,PO_number:_0x3297a6,SCRN:_0x2f3ffb,JO_number:_0x47b58e}=_0x2d7e83['body'];if(typeof _0x21beec==_0x43cfbd(0x2c8))var _0x2a4c28=[_0x2d7e83['body'][_0x43cfbd(0x212)]],_0x1fe70f=[_0x2d7e83['body']['prod_code']],_0x3249f8=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1c3)]],_0x2a0ab8=[_0x2d7e83['body'][_0x43cfbd(0x2ba)]],_0x4d1541=[_0x2d7e83['body']['prod_secondunit']],_0x1dac93=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x209)]],_0xb7db01=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x299)]],_0x471787=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x231)]],_0x390949=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1c5)]],_0x13817a=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1d5)]],_0x25aa17=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x2a5)]],_0x562860=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1d3)]],_0x45ec16=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x29a)]],_0x1d0522=[_0x2d7e83[_0x43cfbd(0x1bf)]['production_date']],_0x3391b5=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1f2)]],_0x50f70d=[_0x2d7e83[_0x43cfbd(0x1bf)]['RoomAssign']],_0x2dcb85=[_0x2d7e83[_0x43cfbd(0x1bf)]['deliverycode']],_0x3e93bb=[_0x2d7e83[_0x43cfbd(0x1bf)]['prod_invoice']],_0x11a3f5=[_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x29e)]],_0x36dcf6=[_0x2d7e83['body'][_0x43cfbd(0x2b6)]];else var _0x2a4c28=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x212)]],_0x1fe70f=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x250)]],_0x3249f8=[..._0x2d7e83['body'][_0x43cfbd(0x1c3)]],_0x2a0ab8=[..._0x2d7e83['body']['prod_primunit']],_0x4d1541=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x2bf)]],_0x1dac93=[..._0x2d7e83[_0x43cfbd(0x1bf)]['prod_level']],_0xb7db01=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x299)]],_0x471787=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x231)]],_0x390949=[..._0x2d7e83['body'][_0x43cfbd(0x1c5)]],_0x13817a=[..._0x2d7e83['body'][_0x43cfbd(0x1d5)]],_0x25aa17=[..._0x2d7e83['body'][_0x43cfbd(0x2a5)]],_0x562860=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1d3)]],_0x45ec16=[..._0x2d7e83['body'][_0x43cfbd(0x29a)]],_0x1d0522=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x278)]],_0x3391b5=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x1f2)]],_0x50f70d=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x2a7)]],_0x2dcb85=[..._0x2d7e83['body']['deliverycode']],_0x3e93bb=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x27a)]],_0x11a3f5=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x29e)]],_0x36dcf6=[..._0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x2b6)]];const _0x1042b2=_0x2a4c28[_0x43cfbd(0x20f)](_0x3bfc50=>{return _0x3bfc50={'product_name':_0x3bfc50};});_0x11a3f5[_0x43cfbd(0x1e0)]((_0x1c1f78,_0x3756de)=>{var _0xcc9994=_0x43cfbd;_0x1042b2[_0x3756de]['actual_qty']=Math[_0xcc9994(0x1f0)](_0x1c1f78);}),_0x36dcf6['forEach']((_0x1a410e,_0x347f33)=>{_0x1042b2[_0x347f33]['actual_uom']=_0x1a410e;}),_0x1fe70f[_0x43cfbd(0x1e0)]((_0x879af8,_0x261261)=>{var _0x1f7af7=_0x43cfbd;_0x1042b2[_0x261261][_0x1f7af7(0x256)]=_0x879af8;}),_0x3249f8[_0x43cfbd(0x1e0)]((_0x3ed8c4,_0x18357b)=>{var _0x274a6e=_0x43cfbd;_0x1042b2[_0x18357b][_0x274a6e(0x232)]=Math['abs'](_0x3ed8c4);}),_0x2a0ab8['forEach']((_0x2fe267,_0x44d0a5)=>{var _0xa251cf=_0x43cfbd;_0x1042b2[_0x44d0a5][_0xa251cf(0x297)]=_0x2fe267;}),_0x4d1541['forEach']((_0x3ba69f,_0x1ea19a)=>{var _0x312764=_0x43cfbd;_0x1042b2[_0x1ea19a][_0x312764(0x2ca)]=_0x3ba69f;}),_0x1dac93[_0x43cfbd(0x1e0)]((_0x4b29a1,_0x24140c)=>{var _0x41f565=_0x43cfbd;_0x50f70d[_0x41f565(0x1e0)]((_0xd263e,_0x52b810)=>{var _0x4fe89e=_0x41f565;if(_0xd263e==_0x4fe89e(0x2cb)&&_0x24140c==_0x52b810){console[_0x4fe89e(0x27f)](_0xd263e+_0x4fe89e(0x26f)+_0x24140c+_0x4fe89e(0x1ff)+_0x52b810+_0x4fe89e(0x1ff)+_0x4b29a1);var _0x112abc=_0x4b29a1[_0x4fe89e(0x253)](0x3);_0x1042b2[_0x24140c][_0x4fe89e(0x258)]=_0x4b29a1[0x0],_0x1042b2[_0x24140c][_0x4fe89e(0x1fe)]=_0x4b29a1[0x1],_0x1042b2[_0x24140c][_0x4fe89e(0x25d)]=0x0,_0x1042b2[_0x24140c][_0x4fe89e(0x1bb)]=0x0,_0x1042b2[_0x24140c][_0x4fe89e(0x2b1)]=_0x4fe89e(0x1cd),_0x1042b2[_0x24140c][_0x4fe89e(0x234)]=_0x112abc;}else{if(_0xd263e=='Shelves'&&_0x24140c==_0x52b810){var _0x112abc=_0x4b29a1['slice'](0x3);_0x1042b2[_0x24140c][_0x4fe89e(0x258)]=_0x4b29a1[0x0],_0x1042b2[_0x24140c][_0x4fe89e(0x1fe)]=_0x4b29a1[0x1],_0x1042b2[_0x24140c][_0x4fe89e(0x25d)]=0x0,_0x1042b2[_0x24140c][_0x4fe89e(0x1bb)]=0x0,_0x1042b2[_0x24140c]['type']=_0x4fe89e(0x1cd),_0x1042b2[_0x24140c][_0x4fe89e(0x234)]=_0x4b29a1[0x5];}else{if(_0x24140c==_0x52b810){if(_0x4b29a1[0x0]=='A'&&_0x4b29a1[0x1]=='L'&&_0x4b29a1[0x2]=='L')console[_0x4fe89e(0x27f)](_0xd263e+_0x4fe89e(0x1ff)+_0x24140c+_0x4fe89e(0x1ff)+_0x52b810+_0x4fe89e(0x1ff)+_0x4b29a1+'here'),_0x1042b2[_0x24140c][_0x4fe89e(0x258)]=_0x4b29a1[0x0],_0x1042b2[_0x24140c][_0x4fe89e(0x1fe)]=_0x4b29a1[0x1],_0x1042b2[_0x24140c][_0x4fe89e(0x25d)]=0x0,_0x1042b2[_0x24140c][_0x4fe89e(0x1bb)]=0x0,_0x1042b2[_0x24140c][_0x4fe89e(0x2b1)]='Floor',_0x1042b2[_0x24140c][_0x4fe89e(0x234)]=_0x4b29a1[0x3];else{var _0x4f4b3e;if(_0x4b29a1[0x4]=='L')_0x4f4b3e=_0x4fe89e(0x2ab);else _0x4b29a1[0x4]=='F'&&(_0x4f4b3e='Floor');_0x1042b2[_0x24140c][_0x4fe89e(0x258)]=_0x4b29a1[0x0],_0x1042b2[_0x24140c][_0x4fe89e(0x1fe)]=_0x4b29a1[0x1],_0x1042b2[_0x24140c][_0x4fe89e(0x25d)]=_0x4b29a1[0x2],_0x1042b2[_0x24140c][_0x4fe89e(0x1bb)]=_0x4b29a1[0x3],_0x1042b2[_0x24140c]['type']=_0x4f4b3e,_0x1042b2[_0x24140c][_0x4fe89e(0x234)]=_0x4b29a1[0x5];}}}}});}),_0xb7db01[_0x43cfbd(0x1e0)]((_0x58bbd6,_0x367a47)=>{var _0x3be3d3=_0x43cfbd;_0x1042b2[_0x367a47][_0x3be3d3(0x299)]=_0x58bbd6;}),_0x471787[_0x43cfbd(0x1e0)]((_0x5ac6ac,_0x1e23a3)=>{var _0x556be6=_0x43cfbd;_0x1042b2[_0x1e23a3][_0x556be6(0x231)]=_0x5ac6ac;}),_0x390949['forEach']((_0x3e6f0b,_0x8639de)=>{var _0xd76950=_0x43cfbd;_0x1042b2[_0x8639de][_0xd76950(0x255)]=_0x3e6f0b;}),_0x13817a['forEach']((_0x23335a,_0xde0d1d)=>{var _0x314874=_0x43cfbd;_0x1042b2[_0xde0d1d][_0x314874(0x1d5)]=_0x23335a;}),_0x25aa17[_0x43cfbd(0x1e0)]((_0x10513b,_0x39b5e5)=>{_0x1042b2[_0x39b5e5]['expiry_date']=_0x10513b;}),_0x562860[_0x43cfbd(0x1e0)]((_0x5bb20e,_0x27dfcb)=>{_0x1042b2[_0x27dfcb]['maxperunit']=_0x5bb20e;}),_0x45ec16[_0x43cfbd(0x1e0)]((_0x204204,_0x41955a)=>{_0x1042b2[_0x41955a]['alertQTY']=_0x204204;}),_0x1d0522[_0x43cfbd(0x1e0)]((_0x31b5ac,_0x5b7102)=>{var _0x1945c2=_0x43cfbd;_0x1042b2[_0x5b7102][_0x1945c2(0x278)]=_0x31b5ac;}),_0x3391b5[_0x43cfbd(0x1e0)]((_0x270e29,_0x143761)=>{var _0x2f387a=_0x43cfbd;_0x1042b2[_0x143761][_0x2f387a(0x2b9)]=_0x270e29;}),_0x50f70d[_0x43cfbd(0x1e0)]((_0x94fcd6,_0x386307)=>{var _0x517e73=_0x43cfbd;_0x1042b2[_0x386307][_0x517e73(0x1c7)]=_0x94fcd6;}),_0x2dcb85[_0x43cfbd(0x1e0)]((_0x52c7b1,_0xac423e)=>{var _0x57152f=_0x43cfbd;_0x1042b2[_0xac423e][_0x57152f(0x221)]=_0x52c7b1;}),_0x3e93bb[_0x43cfbd(0x1e0)]((_0x573ab3,_0x554eb3)=>{_0x1042b2[_0x554eb3]['invoice']=_0x573ab3;});const _0x6ba949=_0x50f70d[_0x43cfbd(0x20f)](_0x5cea3c=>{return _0x5cea3c={'room_name':_0x5cea3c};}),_0x1540a8=_0x1042b2[_0x43cfbd(0x217)](_0x1ce5e7=>_0x1ce5e7[_0x43cfbd(0x232)]!=='0'&&_0x1ce5e7[_0x43cfbd(0x232)]!==''),_0x3a2233=new purchases({'invoice':_0x25286b,'suppliers':_0x2d7e83[_0x43cfbd(0x1bf)][_0x43cfbd(0x295)],'date':_0x37381c,'warehouse_name':_0x2e9ad2,'product':_0x1540a8,'note':_0x455fc7,'due_amount':_0x2ae373,'POnumber':_0x3297a6,'SCRN':_0x2f3ffb,'JO_number':_0x47b58e,'roomList':_0x6ba949}),_0x4771fe=await _0x3a2233[_0x43cfbd(0x1d8)](),_0x3a0949=await purchases[_0x43cfbd(0x1fa)]({'invoice':_0x25286b}),_0x2684d7=_0x3a0949[_0x43cfbd(0x1e1)][_0x43cfbd(0x20f)](async _0x122d7c=>{var _0x4fb22d=_0x43cfbd,_0xf78300=await warehouse[_0x4fb22d(0x1fa)]({'name':_0x2e9ad2,'room':_0x122d7c[_0x4fb22d(0x1c7)]}),_0xd797ef=0x0;return _0xf78300[_0x4fb22d(0x1af)][_0x4fb22d(0x1e0)](_0x4944c3=>{var _0x24ad22=_0x4fb22d;_0x4944c3[_0x24ad22(0x20e)]==_0x122d7c[_0x24ad22(0x20e)]&&_0x4944c3[_0x24ad22(0x234)]==_0x122d7c[_0x24ad22(0x234)]&&_0x4944c3[_0x24ad22(0x2b1)]==_0x122d7c[_0x24ad22(0x2b1)]&&_0x4944c3[_0x24ad22(0x1bb)]==_0x122d7c[_0x24ad22(0x1bb)]&&_0x4944c3[_0x24ad22(0x25d)]==_0x122d7c[_0x24ad22(0x25d)]&&_0x4944c3[_0x24ad22(0x1fe)]==_0x122d7c[_0x24ad22(0x1fe)]&&_0x4944c3[_0x24ad22(0x258)]==_0x122d7c['storage']&&_0x4944c3[_0x24ad22(0x2a5)]==_0x122d7c['expiry_date']&&_0x4944c3['batch_code']==_0x122d7c['batch_code']&&_0x4944c3[_0x24ad22(0x278)]==_0x122d7c[_0x24ad22(0x278)]&&_0x4944c3[_0x24ad22(0x252)]==_0x3a0949['invoice']&&(_0x4944c3[_0x24ad22(0x1da)]+=Math[_0x24ad22(0x1f0)](_0x122d7c['quantity']),_0xd797ef++);}),_0xd797ef===0x0&&_0xf78300['product_details']['push']({'product_name':_0x122d7c[_0x4fb22d(0x20e)],'product_stock':Math['abs'](_0x122d7c['quantity']),'primary_code':_0x122d7c['primary_code'],'secondary_code':_0x122d7c['secondary_code'],'product_code':_0x122d7c[_0x4fb22d(0x256)],'storage':_0x122d7c['storage'],'rack':_0x122d7c[_0x4fb22d(0x1fe)],'bay':_0x122d7c['bay'],'bin':_0x122d7c['bin'],'type':_0x122d7c[_0x4fb22d(0x2b1)],'floorlevel':_0x122d7c[_0x4fb22d(0x234)],'maxProducts':_0x122d7c[_0x4fb22d(0x255)],'unit':_0x122d7c[_0x4fb22d(0x297)],'secondary_unit':_0x122d7c[_0x4fb22d(0x2ca)],'expiry_date':_0x122d7c[_0x4fb22d(0x2a5)],'maxPerUnit':_0x122d7c[_0x4fb22d(0x236)],'batch_code':_0x122d7c[_0x4fb22d(0x1d5)],'alertQTY':_0x122d7c['alertQTY'],'production_date':_0x122d7c[_0x4fb22d(0x278)],'product_cat':_0x122d7c[_0x4fb22d(0x2b9)],'invoice':_0x122d7c[_0x4fb22d(0x252)],'actual_qty':Math[_0x4fb22d(0x1f0)](_0x122d7c[_0x4fb22d(0x29e)]),'actual_uom':_0x122d7c['actual_uom']}),_0xf78300;});Promise[_0x43cfbd(0x29d)](_0x2684d7)['then'](async _0x53cad4=>{var _0x10c771=_0x43cfbd;try{for(const _0x3296d8 of _0x53cad4){await _0x3296d8[_0x10c771(0x1d8)]();}const _0x140e24=await master_shop[_0x10c771(0x248)](),_0x3588e9=await email_settings['findOne'](),_0x2736d1=await supervisor_settings[_0x10c771(0x248)]();var _0x591c8e=_0x3a0949[_0x10c771(0x1e1)],_0x463d57='',_0x293657;for(_0x293657 in _0x591c8e){_0x463d57+=_0x10c771(0x1cf)+_0x10c771(0x1f6)+_0x591c8e[_0x293657]['product_name']+_0x10c771(0x1e5)+_0x10c771(0x1f6)+_0x591c8e[_0x293657][_0x10c771(0x256)]+_0x10c771(0x1e5)+_0x10c771(0x1f6)+_0x591c8e[_0x293657]['quantity']+'</td>'+_0x10c771(0x1f6)+_0x591c8e[_0x293657][_0x10c771(0x297)]+'</td>'+_0x10c771(0x1f6)+_0x591c8e[_0x293657][_0x10c771(0x2ca)]+_0x10c771(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a0949[_0x10c771(0x1b8)]+_0x10c771(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x591c8e[_0x293657][_0x10c771(0x1c7)]+'</td>'+_0x10c771(0x1f6)+_0x591c8e[_0x293657]['storage']+_0x591c8e[_0x293657][_0x10c771(0x1fe)]+_0x591c8e[_0x293657]['bay']+_0x591c8e[_0x293657][_0x10c771(0x1bb)]+_0x591c8e[_0x293657][_0x10c771(0x2b1)][0x0]+_0x591c8e[_0x293657][_0x10c771(0x234)]+_0x10c771(0x1e5),_0x10c771(0x1ae);}let _0x2461d6=nodemailer[_0x10c771(0x2a4)]({'host':_0x3588e9[_0x10c771(0x22a)],'port':Number(_0x3588e9[_0x10c771(0x2b3)]),'secure':![],'auth':{'user':_0x3588e9[_0x10c771(0x28a)],'pass':_0x3588e9['password']}}),_0x14bf4e={'from':_0x3588e9['email'],'to':_0x2736d1[0x0][_0x10c771(0x1b5)],'subject':_0x10c771(0x257),'attachments':[{'filename':_0x10c771(0x254),'path':__dirname+_0x10c771(0x1dd)+_0x10c771(0x245)+_0x140e24[0x0][_0x10c771(0x284)],'cid':_0x10c771(0x285)}],'html':_0x10c771(0x1b7)+_0x10c771(0x21e)+'</head><body>'+_0x10c771(0x219)+_0x10c771(0x1f9)+_0x10c771(0x219)+_0x10c771(0x1ed)+_0x10c771(0x213)+_0x10c771(0x219)+_0x10c771(0x2c7)+_0x140e24[0x0]['site_title']+_0x10c771(0x2cc)+_0x10c771(0x213)+_0x10c771(0x213)+_0x10c771(0x2c3)+_0x10c771(0x219)+_0x10c771(0x1c0)+_0x10c771(0x24f)+_0x3a0949[_0x10c771(0x252)]+'\x20'+_0x10c771(0x28c)+_0x10c771(0x2b2)+_0x3a0949[_0x10c771(0x1d1)]+'\x20'+_0x10c771(0x237)+'</h5>'+_0x10c771(0x213)+_0x10c771(0x1e9)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x10c771(0x1cf)+_0x10c771(0x289)+_0x10c771(0x29b)+_0x10c771(0x27b)+_0x10c771(0x28e)+_0x10c771(0x2c6)+_0x10c771(0x1ba)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x10c771(0x283)+_0x10c771(0x1ae)+_0x10c771(0x216)+_0x10c771(0x282)+'\x20'+_0x463d57+'\x20'+_0x10c771(0x230)+_0x10c771(0x1c1)+'<div>'+_0x10c771(0x1c4)+_0x10c771(0x247)+_0x140e24[0x0][_0x10c771(0x28f)]+_0x10c771(0x2b7)+_0x10c771(0x213)+_0x10c771(0x213)+_0x10c771(0x1bd)};_0x2461d6[_0x10c771(0x238)](_0x14bf4e,function(_0x2b428a,_0x5b9218){var _0xe6f6b5=_0x10c771;_0x2b428a?(console['log'](_0x2b428a),console[_0xe6f6b5(0x27f)](_0xe6f6b5(0x259))):console['log']('Email\x20sent\x20successfully');}),_0x2d7e83[_0x10c771(0x1e7)]('success',_0x10c771(0x2af)),_0x593eea['redirect'](_0x10c771(0x214));}catch(_0x4ecca9){console['error'](_0x4ecca9),_0x593eea['status'](0x1f4)[_0x10c771(0x277)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x43cfbd(0x1d4)](_0x417966=>{var _0x3db04f=_0x43cfbd;console[_0x3db04f(0x2b4)](_0x417966),_0x593eea[_0x3db04f(0x22e)](0x1f4)[_0x3db04f(0x277)]({'error':'An\x20error\x20occurred.'});});}catch(_0x273b9c){console['log'](_0x273b9c);}}),router['get']('/preview/:id',auth,async(_0x2c5533,_0x22fe3c)=>{var _0x2ff031=a0_0xfadd6a;try{const {username:_0x14ce37,email:_0x4095ae,role:_0x5784dc}=_0x2c5533['user'],_0x116ff8=_0x2c5533[_0x2ff031(0x273)],_0x23530b=await profile['findOne']({'email':_0x116ff8['email']}),_0x14e171=await master_shop[_0x2ff031(0x248)](),_0x38c6f7=_0x2c5533[_0x2ff031(0x2bc)]['id'],_0x58fea9=await purchases[_0x2ff031(0x1b1)](_0x38c6f7),_0xd3e26e=await warehouse[_0x2ff031(0x26c)]([{'$match':{'name':_0x58fea9[_0x2ff031(0x1b8)],'room':_0x58fea9[_0x2ff031(0x263)]}},{'$unwind':_0x2ff031(0x298)},{'$group':{'_id':_0x2ff031(0x202),'name':{'$first':_0x2ff031(0x26e)},'product_stock':{'$first':_0x2ff031(0x21d)},'bay':{'$first':_0x2ff031(0x251)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x2ff031(0x1ef)},'floorlevel':{'$first':_0x2ff031(0x200)},'primary_code':{'$first':_0x2ff031(0x2cd)},'secondary_code':{'$first':_0x2ff031(0x1ec)},'product_code':{'$first':_0x2ff031(0x203)},'storage':{'$first':_0x2ff031(0x269)},'rack':{'$first':_0x2ff031(0x2a2)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x2d5aea=await customer[_0x2ff031(0x248)]({});let _0x27d9ff;if(_0x116ff8[_0x2ff031(0x206)]=='staff'){const _0x5cabef=await staff[_0x2ff031(0x1fa)]({'email':_0x116ff8[_0x2ff031(0x28a)]});_0x27d9ff=await warehouse['aggregate']([{'$match':{'status':_0x2ff031(0x20c),'name':_0x5cabef[_0x2ff031(0x294)]}},{'$group':{'_id':_0x2ff031(0x1e3),'name':{'$first':_0x2ff031(0x1e3)}}}]);}else _0x27d9ff=await warehouse[_0x2ff031(0x26c)]([{'$match':{'status':_0x2ff031(0x20c)}},{'$group':{'_id':_0x2ff031(0x1e3),'name':{'$first':_0x2ff031(0x1e3)}}}]);const _0x1e7b43=await product['find']({}),_0x44e5cc=await suppliers[_0x2ff031(0x248)]({}),_0x553f7d=BayBinSelected(_0x58fea9['warehouse_name'],_0x58fea9[_0x2ff031(0x263)]);if(_0x14e171[0x0][_0x2ff031(0x25f)]==_0x2ff031(0x226)){var _0x1bf0a4=users['English'];console['log'](_0x1bf0a4);}else{if(_0x14e171[0x0][_0x2ff031(0x25f)]==_0x2ff031(0x290))var _0x1bf0a4=users[_0x2ff031(0x290)];else{if(_0x14e171[0x0]['language']=='German')var _0x1bf0a4=users[_0x2ff031(0x1de)];else{if(_0x14e171[0x0][_0x2ff031(0x25f)]==_0x2ff031(0x260))var _0x1bf0a4=users[_0x2ff031(0x260)];else{if(_0x14e171[0x0][_0x2ff031(0x25f)]==_0x2ff031(0x23f))var _0x1bf0a4=users['French'];else{if(_0x14e171[0x0][_0x2ff031(0x25f)]==_0x2ff031(0x1ce))var _0x1bf0a4=users[_0x2ff031(0x2be)];else{if(_0x14e171[0x0]['language']==_0x2ff031(0x1b2))var _0x1bf0a4=users['Chinese'];else{if(_0x14e171[0x0][_0x2ff031(0x25f)]==_0x2ff031(0x1cb))var _0x1bf0a4=users['Arabic'];}}}}}}}_0x22fe3c['render']('edit_purchases_view',{'success':_0x2c5533[_0x2ff031(0x1e7)]('success'),'errors':_0x2c5533[_0x2ff031(0x1e7)](_0x2ff031(0x275)),'role':_0x116ff8,'profile':_0x23530b,'customer':_0x2d5aea,'warehouse':_0x27d9ff,'product':_0xd3e26e,'user':_0x58fea9,'master_shop':_0x14e171,'unit':_0x1e7b43,'language':_0x1bf0a4,'suppliers':_0x44e5cc,'dataSelected':_0x553f7d});}catch(_0x2cd427){console[_0x2ff031(0x27f)](_0x2cd427);}}),router[a0_0xfadd6a(0x218)]('/preview/:id',auth,async(_0x12e559,_0x49834e)=>{var _0x3c6fdf=a0_0xfadd6a;try{const _0x40dbad=_0x12e559[_0x3c6fdf(0x2bc)]['id'],{invoice:_0x4c87db,warehouse_name:_0xbc4ece,Room_name:_0x27ac8d}=_0x12e559[_0x3c6fdf(0x1bf)],_0x3f966d=await warehouse[_0x3c6fdf(0x1fa)]({'name':_0xbc4ece,'room':_0x27ac8d}),_0x16e85f=await purchases[_0x3c6fdf(0x1fa)]({'invoice':_0x4c87db});_0x16e85f[_0x3c6fdf(0x1e1)]['forEach'](_0x5b2ca0=>{var _0x4291cb=_0x3c6fdf,_0x144234=0x0;const _0x35d9c9=_0x3f966d[_0x4291cb(0x1af)]['map'](_0x4f97ac=>{var _0x4c42ec=_0x4291cb;_0x4f97ac[_0x4c42ec(0x20e)]==_0x5b2ca0[_0x4c42ec(0x20e)]&&_0x4f97ac[_0x4c42ec(0x234)]==_0x5b2ca0[_0x4c42ec(0x234)]&&_0x4f97ac[_0x4c42ec(0x2b1)]==_0x5b2ca0[_0x4c42ec(0x2b1)]&&_0x4f97ac[_0x4c42ec(0x1bb)]==_0x5b2ca0[_0x4c42ec(0x1bb)]&&_0x4f97ac[_0x4c42ec(0x25d)]==_0x5b2ca0[_0x4c42ec(0x25d)]&&_0x4f97ac[_0x4c42ec(0x1fe)]==_0x5b2ca0[_0x4c42ec(0x1fe)]&&_0x4f97ac[_0x4c42ec(0x258)]==_0x5b2ca0['storage']&&_0x4f97ac[_0x4c42ec(0x2a5)]==_0x5b2ca0[_0x4c42ec(0x2a5)]&&_0x4f97ac[_0x4c42ec(0x1d5)]==_0x5b2ca0[_0x4c42ec(0x1d5)]&&_0x4f97ac['production_date']==_0x5b2ca0[_0x4c42ec(0x278)]&&_0x4f97ac[_0x4c42ec(0x26b)]==_0x5b2ca0[_0x4c42ec(0x26b)]&&_0x4f97ac[_0x4c42ec(0x221)]==_0x5b2ca0[_0x4c42ec(0x221)]&&(_0x4f97ac['product_stock']=parseInt(_0x4f97ac[_0x4c42ec(0x1da)])+parseInt(_0x5b2ca0[_0x4c42ec(0x232)]),_0x144234++);});_0x144234=='0'&&(_0x3f966d[_0x4291cb(0x1af)]=_0x3f966d['product_details'][_0x4291cb(0x2b5)]({'product_name':_0x5b2ca0['product_name'],'product_stock':_0x5b2ca0[_0x4291cb(0x232)],'primary_code':_0x5b2ca0[_0x4291cb(0x299)],'secondary_code':_0x5b2ca0[_0x4291cb(0x231)],'product_code':_0x5b2ca0[_0x4291cb(0x256)],'storage':_0x5b2ca0['storage'],'rack':_0x5b2ca0[_0x4291cb(0x1fe)],'bay':_0x5b2ca0[_0x4291cb(0x25d)],'bin':_0x5b2ca0[_0x4291cb(0x1bb)],'type':_0x5b2ca0[_0x4291cb(0x2b1)],'floorlevel':_0x5b2ca0[_0x4291cb(0x234)],'maxProducts':_0x5b2ca0[_0x4291cb(0x255)],'unit':_0x5b2ca0[_0x4291cb(0x297)],'secondary_unit':_0x5b2ca0[_0x4291cb(0x2ca)],'expiry_date':_0x5b2ca0[_0x4291cb(0x2a5)],'maxPerUnit':_0x5b2ca0[_0x4291cb(0x236)],'batch_code':_0x5b2ca0['batch_code'],'alertQTY':_0x5b2ca0[_0x4291cb(0x29a)],'production_date':_0x5b2ca0[_0x4291cb(0x278)],'delivery_date':_0x5b2ca0[_0x4291cb(0x26b)],'delivery_code':_0x5b2ca0[_0x4291cb(0x221)]}));}),await _0x3f966d[_0x3c6fdf(0x1d8)](),_0x16e85f[_0x3c6fdf(0x27e)]=_0x3c6fdf(0x2bd);const _0x11e168=await _0x16e85f[_0x3c6fdf(0x1d8)]();_0x12e559['flash'](_0x3c6fdf(0x287),_0x3c6fdf(0x205)),_0x49834e[_0x3c6fdf(0x2b0)](_0x3c6fdf(0x276));}catch(_0x5283d8){console[_0x3c6fdf(0x27f)](_0x5283d8);}}),router['get'](a0_0xfadd6a(0x24e),auth,async(_0x12305f,_0x49fa2e)=>{var _0x1be586=a0_0xfadd6a;try{const {username:_0x503908,email:_0x1548c4,role:_0x12875c}=_0x12305f[_0x1be586(0x273)],_0x32e9f9=_0x12305f[_0x1be586(0x273)],_0x527de1=await profile[_0x1be586(0x1fa)]({'email':_0x32e9f9[_0x1be586(0x28a)]}),_0x3f71f1=await master_shop[_0x1be586(0x248)](),_0x4d8f2b=_0x12305f[_0x1be586(0x2bc)]['id'],_0x41ad3d=await purchases[_0x1be586(0x1b1)](_0x4d8f2b),_0x4a37b8=await suppliers[_0x1be586(0x248)]({});let _0x2a797a;if(_0x32e9f9['role']=='staff'){const _0x12e993=await staff[_0x1be586(0x1fa)]({'email':_0x32e9f9[_0x1be586(0x28a)]});_0x2a797a=await warehouse[_0x1be586(0x248)]({'status':'Enabled','name':_0x12e993[_0x1be586(0x294)],'warehouse_category':'Raw\x20Materials'});}else _0x2a797a=await warehouse['aggregate']([{'$match':{'status':_0x1be586(0x20c),'warehouse_category':_0x1be586(0x1e8)}},{'$group':{'_id':_0x1be586(0x1e3),'name':{'$first':_0x1be586(0x1e3)}}}]);const _0x4c2441=await product[_0x1be586(0x248)]({}),_0x3f9b04=BayBinSelected(_0x41ad3d[_0x1be586(0x1b8)],_0x41ad3d[_0x1be586(0x263)]);let _0x1561cc=new Date(_0x41ad3d[_0x1be586(0x2a5)]),_0x1f2999=('0'+_0x1561cc[_0x1be586(0x1f8)]())[_0x1be586(0x253)](-0x2),_0x4b509e=('0'+(_0x1561cc[_0x1be586(0x235)]()+0x1))[_0x1be586(0x253)](-0x2),_0x226b50=_0x1561cc[_0x1be586(0x21f)](),_0x5ab04e=_0x226b50+'-'+_0x4b509e+'-'+_0x1f2999;if(_0x3f71f1[0x0][_0x1be586(0x25f)]=='English\x20(US)'){var _0x462c7e=users[_0x1be586(0x2c5)];console[_0x1be586(0x27f)](_0x462c7e);}else{if(_0x3f71f1[0x0][_0x1be586(0x25f)]==_0x1be586(0x290))var _0x462c7e=users['Hindi'];else{if(_0x3f71f1[0x0]['language']==_0x1be586(0x1de))var _0x462c7e=users[_0x1be586(0x1de)];else{if(_0x3f71f1[0x0]['language']==_0x1be586(0x260))var _0x462c7e=users[_0x1be586(0x260)];else{if(_0x3f71f1[0x0][_0x1be586(0x25f)]==_0x1be586(0x23f))var _0x462c7e=users[_0x1be586(0x23f)];else{if(_0x3f71f1[0x0][_0x1be586(0x25f)]==_0x1be586(0x1ce))var _0x462c7e=users['Portuguese'];else{if(_0x3f71f1[0x0][_0x1be586(0x25f)]==_0x1be586(0x1b2))var _0x462c7e=users[_0x1be586(0x1b2)];else{if(_0x3f71f1[0x0][_0x1be586(0x25f)]==_0x1be586(0x1cb))var _0x462c7e=users[_0x1be586(0x1f3)];}}}}}}}_0x49fa2e[_0x1be586(0x1fb)]('edit_purchases',{'success':_0x12305f[_0x1be586(0x1e7)](_0x1be586(0x287)),'errors':_0x12305f[_0x1be586(0x1e7)](_0x1be586(0x275)),'role':_0x32e9f9,'profile':_0x527de1,'purchases':_0x41ad3d,'suppliers':_0x4a37b8,'warehouse':_0x2a797a,'product':_0x4c2441,'master_shop':_0x3f71f1,'language':_0x462c7e,'ed_fullDate':_0x5ab04e,'dataSelected':_0x3f9b04});}catch(_0x1d4e5d){console[_0x1be586(0x27f)](_0x1d4e5d);}}),router[a0_0xfadd6a(0x218)](a0_0xfadd6a(0x24e),auth,async(_0x2f985e,_0x51bced)=>{var _0x565e72=a0_0xfadd6a;try{const _0x322f36=_0x2f985e[_0x565e72(0x2bc)]['id'],_0x59b6b4=await purchases[_0x565e72(0x1fa)]({'_id':_0x2f985e['params']['id']}),_0x44920f=await warehouse['findOne']({'name':_0x59b6b4[_0x565e72(0x1b8)],'room':_0x59b6b4[_0x565e72(0x263)]});_0x59b6b4[_0x565e72(0x1e1)][_0x565e72(0x1e0)](_0x548d4=>{var _0x179e56=_0x565e72;const _0x26b771=_0x44920f[_0x179e56(0x1af)][_0x179e56(0x20f)](_0x220562=>{var _0xe93b4d=_0x179e56;_0x220562[_0xe93b4d(0x20e)]==_0x548d4[_0xe93b4d(0x20e)]&&_0x220562[_0xe93b4d(0x234)]==_0x548d4[_0xe93b4d(0x234)]&&_0x220562[_0xe93b4d(0x2b1)]==_0x548d4['type']&&_0x220562[_0xe93b4d(0x1bb)]==_0x548d4[_0xe93b4d(0x1bb)]&&_0x220562[_0xe93b4d(0x25d)]==_0x548d4[_0xe93b4d(0x25d)]&&_0x220562[_0xe93b4d(0x1fe)]==_0x548d4['rack']&&_0x220562[_0xe93b4d(0x258)]==_0x548d4[_0xe93b4d(0x258)]&&(_0x220562[_0xe93b4d(0x1da)]=parseInt(_0x220562['product_stock'])-parseInt(_0x548d4[_0xe93b4d(0x232)]));});}),await _0x44920f[_0x565e72(0x1d8)]();const {invoice:_0x192295,suppliers:_0x28f80c,date:_0x20132b,warehouse_name:_0x29cfd5,prod_name:_0x5afb01,prod_code:_0x28f82a,prod_qty:_0x49f53e,prod_unit:_0x420f56,prod_secondunit:_0x1be24b,prod_level:_0x5ef47a,prod_isle:_0x5b7532,prod_pallet:_0x17b124,note:_0x5142f1,expiry_date:_0x46e5db,batch_code:_0x4d3576,paid_amount:_0x3f0445,due_amount:_0x26370a,Room_name:_0x433823,primary_code:_0x279ca8,secondary_code:_0x5878fd,PO_number:_0xef90de,JO_number:_0x538da6}=_0x2f985e[_0x565e72(0x1bf)];if(typeof _0x5afb01==_0x565e72(0x2c8))var _0x118969=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x212)]],_0x96633b=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x250)]],_0x5f5773=[_0x2f985e['body'][_0x565e72(0x2c2)]],_0x43ba03=[_0x2f985e[_0x565e72(0x1bf)]['prod_unit']],_0x5ce35e=[_0x2f985e['body']['prod_secondunit']],_0x4e071f=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x209)]],_0x1e8a87=[_0x2f985e[_0x565e72(0x1bf)]['prod_isle']],_0x5ed502=[_0x2f985e['body'][_0x565e72(0x267)]],_0x1db77a=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x299)]],_0x47bc50=[_0x2f985e['body']['secondary_code']],_0x405265=[_0x2f985e[_0x565e72(0x1bf)]['MaxStocks_data']],_0x4a4875=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x1d5)]],_0x5d1dce=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x2a5)]],_0x31716a=[_0x2f985e['body'][_0x565e72(0x258)]],_0x52f8ae=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x243)]],_0x5afbe7=[_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x2b1)]];else var _0x118969=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x212)]],_0x96633b=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x250)]],_0x5f5773=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x2c2)]],_0x43ba03=[..._0x2f985e[_0x565e72(0x1bf)]['prod_unit']],_0x5ce35e=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x2bf)]],_0x4e071f=[..._0x2f985e[_0x565e72(0x1bf)]['prod_level']],_0x1e8a87=[..._0x2f985e[_0x565e72(0x1bf)]['prod_isle']],_0x5ed502=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x267)]],_0x1db77a=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x299)]],_0x47bc50=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x231)]],_0x405265=[..._0x2f985e['body'][_0x565e72(0x1c5)]],_0x4a4875=[..._0x2f985e['body'][_0x565e72(0x1d5)]],_0x5d1dce=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x2a5)]],_0x31716a=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x258)]],_0x52f8ae=[..._0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x243)]],_0x5afbe7=[..._0x2f985e[_0x565e72(0x1bf)]['type']];const _0x3e8fa9=_0x118969[_0x565e72(0x20f)](_0x34e9e2=>{return _0x34e9e2={'product_name':_0x34e9e2};});_0x96633b['forEach']((_0x273464,_0x4f1856)=>{var _0x110003=_0x565e72;_0x3e8fa9[_0x4f1856][_0x110003(0x256)]=_0x273464;}),_0x5f5773['forEach']((_0x2ce300,_0x7ed34)=>{var _0x412e83=_0x565e72;_0x3e8fa9[_0x7ed34][_0x412e83(0x232)]=_0x2ce300;}),_0x43ba03[_0x565e72(0x1e0)]((_0x4712c9,_0x5ec804)=>{_0x3e8fa9[_0x5ec804]['standard_unit']=_0x4712c9;}),_0x5ce35e[_0x565e72(0x1e0)]((_0x32c921,_0x430ec4)=>{_0x3e8fa9[_0x430ec4]['secondary_unit']=_0x32c921;}),_0x4e071f[_0x565e72(0x1e0)]((_0x197156,_0x569e20)=>{var _0x2a72c2=_0x565e72;_0x3e8fa9[_0x569e20][_0x2a72c2(0x25d)]=_0x197156;}),_0x1e8a87['forEach']((_0x561bab,_0x27f322)=>{_0x3e8fa9[_0x27f322]['bin']=_0x561bab;}),_0x5ed502['forEach']((_0x1a8ede,_0x589d5e)=>{_0x3e8fa9[_0x589d5e]['floorlevel']=_0x1a8ede;}),_0x1db77a[_0x565e72(0x1e0)]((_0xa7f511,_0x4a8be0)=>{_0x3e8fa9[_0x4a8be0]['primary_code']=_0xa7f511;}),_0x47bc50[_0x565e72(0x1e0)]((_0x3f235c,_0x5f153f)=>{_0x3e8fa9[_0x5f153f]['secondary_code']=_0x3f235c;}),_0x405265[_0x565e72(0x1e0)]((_0x297387,_0x1ab083)=>{var _0x47a1dd=_0x565e72;_0x3e8fa9[_0x1ab083][_0x47a1dd(0x255)]=_0x297387;}),_0x4a4875['forEach']((_0x32fff4,_0x2dba9c)=>{var _0x46d2a7=_0x565e72;_0x3e8fa9[_0x2dba9c][_0x46d2a7(0x1d5)]=_0x32fff4;}),_0x5d1dce[_0x565e72(0x1e0)]((_0x1e1103,_0x461b6b)=>{var _0x37a64e=_0x565e72;_0x3e8fa9[_0x461b6b][_0x37a64e(0x2a5)]=_0x1e1103;}),_0x5afbe7[_0x565e72(0x1e0)]((_0x5f3403,_0x11792e)=>{var _0x3f79eb=_0x565e72;_0x3e8fa9[_0x11792e][_0x3f79eb(0x2b1)]=_0x5f3403;}),_0x31716a[_0x565e72(0x1e0)]((_0x96227b,_0x38f580)=>{var _0x58beec=_0x565e72;_0x3e8fa9[_0x38f580][_0x58beec(0x258)]=_0x96227b;}),_0x52f8ae[_0x565e72(0x1e0)]((_0x3dd32e,_0x39bd0b)=>{_0x3e8fa9[_0x39bd0b]['rack']=_0x3dd32e;});const _0x4a1bd7=_0x3e8fa9[_0x565e72(0x217)](_0x2471a0=>_0x2471a0['quantity']!=='0'&&_0x2471a0[_0x565e72(0x232)]!=='');_0x59b6b4[_0x565e72(0x252)]=_0x192295,_0x59b6b4[_0x565e72(0x295)]=_0x28f80c,_0x59b6b4[_0x565e72(0x1d1)]=_0x20132b,_0x59b6b4[_0x565e72(0x1b8)]=_0x29cfd5,_0x59b6b4[_0x565e72(0x1e1)]=_0x4a1bd7,_0x59b6b4['note']=_0x5142f1,_0x59b6b4[_0x565e72(0x241)]=_0x3f0445,_0x59b6b4[_0x565e72(0x1b3)]=_0x26370a,_0x59b6b4['room']=_0x433823,_0x59b6b4[_0x565e72(0x1ad)]=_0xef90de,_0x59b6b4[_0x565e72(0x2a0)]=_0x538da6;const _0x590538=await _0x59b6b4[_0x565e72(0x1d8)](),_0xa3a36e=await warehouse[_0x565e72(0x1fa)]({'name':_0x2f985e['body'][_0x565e72(0x1b8)],'room':_0x2f985e['body'][_0x565e72(0x225)]});_0x59b6b4[_0x565e72(0x1e1)][_0x565e72(0x1e0)](_0x5872f0=>{var _0xe03b37=_0x565e72,_0x122807=0x0;const _0x17659a=_0xa3a36e[_0xe03b37(0x1af)]['map'](_0x114359=>{var _0x325126=_0xe03b37;_0x114359[_0x325126(0x20e)]==_0x5872f0[_0x325126(0x20e)]&&_0x114359['floorlevel']==_0x5872f0['floorlevel']&&_0x114359[_0x325126(0x2b1)]==_0x5872f0['type']&&_0x114359[_0x325126(0x1bb)]==_0x5872f0[_0x325126(0x1bb)]&&_0x114359[_0x325126(0x25d)]==_0x5872f0['bay']&&_0x114359[_0x325126(0x1fe)]==_0x5872f0['rack']&&_0x114359['storage']==_0x5872f0[_0x325126(0x258)]&&(_0x114359[_0x325126(0x1da)]=parseInt(_0x114359[_0x325126(0x1da)])+parseInt(_0x5872f0[_0x325126(0x232)]),_0x122807++);});_0x122807=='0'&&(_0xa3a36e[_0xe03b37(0x1af)]=_0xa3a36e['product_details'][_0xe03b37(0x2b5)]({'product_name':_0x5872f0[_0xe03b37(0x20e)],'product_stock':_0x5872f0[_0xe03b37(0x232)],'primary_code':_0x5872f0[_0xe03b37(0x299)],'secondary_code':_0x5872f0[_0xe03b37(0x231)],'product_code':_0x5872f0[_0xe03b37(0x256)],'storage':_0x5872f0[_0xe03b37(0x258)],'rack':_0x5872f0[_0xe03b37(0x1fe)],'bay':_0x5872f0[_0xe03b37(0x25d)],'bin':_0x5872f0[_0xe03b37(0x1bb)],'type':_0x5872f0[_0xe03b37(0x2b1)],'floorlevel':_0x5872f0[_0xe03b37(0x234)],'maxProducts':_0x5872f0[_0xe03b37(0x255)],'unit':_0x5872f0['standard_unit'],'secondary_unit':_0x5872f0[_0xe03b37(0x2ca)],'expiry_date':_0x5872f0[_0xe03b37(0x2a5)]}));}),await _0xa3a36e[_0x565e72(0x1d8)]();const _0xbeeffe=await s_payment_data[_0x565e72(0x1fa)]({'invoice':_0x2f985e['body'][_0x565e72(0x252)]});if(_0xbeeffe===null){}else console['log'](_0x565e72(0x295),_0xbeeffe,_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x252)]),_0xbeeffe[_0x565e72(0x295)]=_0x2f985e[_0x565e72(0x1bf)][_0x565e72(0x295)],await _0xbeeffe[_0x565e72(0x1d8)]();_0x2f985e[_0x565e72(0x1e7)](_0x565e72(0x287),'purchase\x20data\x20update\x20successfully'),_0x51bced[_0x565e72(0x2b0)](_0x565e72(0x276));}catch(_0x296d17){console[_0x565e72(0x27f)](_0x296d17);}}),router[a0_0xfadd6a(0x218)]('/give_payment/:id',auth,async(_0x11709b,_0x42c371)=>{var _0x9d5749=a0_0xfadd6a;try{const _0x1e4922=_0x11709b['params']['id'],{invoice:_0x5db196,suppliers:_0x36a457,payable:_0x239d2e,due_amount:_0x3b340e}=_0x11709b[_0x9d5749(0x1bf)],_0x4438c6=await purchases[_0x9d5749(0x1b1)](_0x1e4922);var _0x2b65ce=_0x239d2e-_0x3b340e;_0x4438c6[_0x9d5749(0x241)]=parseFloat(_0x4438c6[_0x9d5749(0x241)])+parseFloat(_0x3b340e),_0x4438c6[_0x9d5749(0x1b3)]=_0x2b65ce;const _0x5a756f=await _0x4438c6['save']();console[_0x9d5749(0x27f)](_0x5a756f);const _0x12d2f9=await s_payment_data[_0x9d5749(0x1fa)]({'invoice':_0x5db196});_0x12d2f9[_0x9d5749(0x2ae)]=_0x2b65ce,await _0x12d2f9[_0x9d5749(0x1d8)]();let _0x1d348e=new Date(),_0xa0c2a9=('0'+_0x1d348e['getDate']())['slice'](-0x2),_0x46e186=('0'+(_0x1d348e[_0x9d5749(0x235)]()+0x1))[_0x9d5749(0x253)](-0x2),_0x54bbd8=_0x1d348e[_0x9d5749(0x21f)](),_0x2341a5=_0x54bbd8+'-'+_0x46e186+'-'+_0xa0c2a9;const _0x536bb4=new suppliers_payment({'invoice':_0x5db196,'date':_0x54bbd8+'-'+_0x46e186+'-'+_0xa0c2a9,'suppliers':_0x36a457,'reason':_0x9d5749(0x25b),'amount':_0x3b340e}),_0x24bc1f=await _0x536bb4[_0x9d5749(0x1d8)]();_0x11709b[_0x9d5749(0x1e7)](_0x9d5749(0x287),_0x9d5749(0x25e)),_0x42c371[_0x9d5749(0x2b0)](_0x9d5749(0x276));}catch(_0x444466){console[_0x9d5749(0x27f)](_0x444466);}}),router['get'](a0_0xfadd6a(0x279),auth,async(_0x5afccc,_0x9fde03)=>{var _0x546294=a0_0xfadd6a;try{const {username:_0x3b341b,email:_0x367022,role:_0x19369a}=_0x5afccc['user'],_0x590f68=_0x5afccc[_0x546294(0x273)],_0x1fb786=await profile[_0x546294(0x1fa)]({'email':_0x590f68[_0x546294(0x28a)]}),_0x588800=await master_shop['find']();console[_0x546294(0x27f)](_0x546294(0x1e4),_0x588800);const _0x484202=_0x5afccc[_0x546294(0x2bc)]['id'],_0x3e7309=await purchases[_0x546294(0x1b1)](_0x484202);console['log'](_0x3e7309);const _0x1c505e=await suppliers[_0x546294(0x1fa)]({'name':_0x3e7309[_0x546294(0x295)]});console[_0x546294(0x27f)](_0x1c505e);if(_0x588800[0x0][_0x546294(0x25f)]==_0x546294(0x226)){var _0x2d0b5c=users['English'];console[_0x546294(0x27f)](_0x2d0b5c);}else{if(_0x588800[0x0][_0x546294(0x25f)]==_0x546294(0x290))var _0x2d0b5c=users[_0x546294(0x290)];else{if(_0x588800[0x0][_0x546294(0x25f)]==_0x546294(0x1de))var _0x2d0b5c=users[_0x546294(0x1de)];else{if(_0x588800[0x0]['language']==_0x546294(0x260))var _0x2d0b5c=users[_0x546294(0x260)];else{if(_0x588800[0x0][_0x546294(0x25f)]=='French')var _0x2d0b5c=users[_0x546294(0x23f)];else{if(_0x588800[0x0][_0x546294(0x25f)]==_0x546294(0x1ce))var _0x2d0b5c=users[_0x546294(0x2be)];else{if(_0x588800[0x0][_0x546294(0x25f)]==_0x546294(0x1b2))var _0x2d0b5c=users['Chinese'];else{if(_0x588800[0x0]['language']==_0x546294(0x1cb))var _0x2d0b5c=users[_0x546294(0x1f3)];}}}}}}}_0x9fde03[_0x546294(0x1fb)](_0x546294(0x1ee),{'success':_0x5afccc[_0x546294(0x1e7)](_0x546294(0x287)),'errors':_0x5afccc[_0x546294(0x1e7)](_0x546294(0x275)),'role':_0x590f68,'profile':_0x1fb786,'master_shop':_0x588800,'supplier':_0x1c505e,'purchase':_0x3e7309,'language':_0x2d0b5c});}catch(_0x361639){console['log'](_0x361639);}}),router['get'](a0_0xfadd6a(0x204),auth,async(_0x3b7aa3,_0x69ab47)=>{var _0x369afe=a0_0xfadd6a;try{const {username:_0x32332b,email:_0x99920e,role:_0x3b1cb0}=_0x3b7aa3[_0x369afe(0x273)],_0x11765e=_0x3b7aa3['user'],_0x2b606e=await profile[_0x369afe(0x1fa)]({'email':_0x11765e[_0x369afe(0x28a)]}),_0x440ec6=await master_shop[_0x369afe(0x248)]();console[_0x369afe(0x27f)]('master',_0x440ec6);const _0x2fbf9a=_0x3b7aa3['params']['id'];console[_0x369afe(0x27f)](_0x2fbf9a);const _0x249a63=await purchases['findById'](_0x2fbf9a);console['log'](_0x369afe(0x262),_0x249a63);const _0x5c1aaf=await product[_0x369afe(0x248)]({}),_0x4792be=await warehouse['aggregate']([{'$match':{'name':_0x249a63[_0x369afe(0x1b8)],'room':_0x249a63[_0x369afe(0x263)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x369afe(0x298)},{'$group':{'_id':_0x369afe(0x202),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x369afe(0x251)},'bin':{'$first':_0x369afe(0x281)},'type':{'$first':_0x369afe(0x1ef)},'floorlevel':{'$first':_0x369afe(0x200)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x369afe(0x1ec)},'product_code':{'$first':_0x369afe(0x203)},'storage':{'$first':_0x369afe(0x269)},'rack':{'$first':_0x369afe(0x2a2)}}}]);warehouse_data=await warehouse[_0x369afe(0x26c)]([{'$match':{'status':_0x369afe(0x20c),'name':'Return\x20Goods','warehouse_category':_0x369afe(0x1e8)}},{'$group':{'_id':_0x369afe(0x1e3),'name':{'$first':_0x369afe(0x1e3)}}},{'$sort':{'name':0x1}}]),console[_0x369afe(0x27f)](_0x369afe(0x22b),_0x4792be);if(_0x440ec6[0x0][_0x369afe(0x25f)]==_0x369afe(0x226)){var _0x5a961c=users['English'];console[_0x369afe(0x27f)](_0x5a961c);}else{if(_0x440ec6[0x0][_0x369afe(0x25f)]==_0x369afe(0x290))var _0x5a961c=users['Hindi'];else{if(_0x440ec6[0x0]['language']==_0x369afe(0x1de))var _0x5a961c=users['German'];else{if(_0x440ec6[0x0]['language']==_0x369afe(0x260))var _0x5a961c=users['Spanish'];else{if(_0x440ec6[0x0]['language']==_0x369afe(0x23f))var _0x5a961c=users[_0x369afe(0x23f)];else{if(_0x440ec6[0x0][_0x369afe(0x25f)]==_0x369afe(0x1ce))var _0x5a961c=users[_0x369afe(0x2be)];else{if(_0x440ec6[0x0][_0x369afe(0x25f)]=='Chinese')var _0x5a961c=users['Chinese'];else{if(_0x440ec6[0x0][_0x369afe(0x25f)]==_0x369afe(0x1cb))var _0x5a961c=users[_0x369afe(0x1f3)];}}}}}}}_0x69ab47['render'](_0x369afe(0x22f),{'success':_0x3b7aa3[_0x369afe(0x1e7)](_0x369afe(0x287)),'errors':_0x3b7aa3['flash'](_0x369afe(0x275)),'role':_0x11765e,'profile':_0x2b606e,'user':_0x249a63,'stock':_0x4792be,'master_shop':_0x440ec6,'product':_0x5c1aaf,'language':_0x5a961c,'warehouse':warehouse_data});}catch(_0x3c19f3){console[_0x369afe(0x27f)](_0x3c19f3);}}),router['post'](a0_0xfadd6a(0x204),auth,async(_0x19d2a5,_0x475f63)=>{var _0x283ea0=a0_0xfadd6a;try{const {invoice:_0x4a39bc,date:_0x3b4044,warehouse_name:_0x11577f,Room_name:_0x19909e,product_name:_0x4639f8,purchase_quantity:_0x4b4c7a,stocks:_0x4c1413,return_qty:_0x56c85d,note:_0x43d605,level:_0x3a0c8b,isle:_0x44fd2d,pallet:_0x2f017a,to_warehouse_name:_0x264ba5,to_Room_name:_0x28e077}=_0x19d2a5['body'],_0x262b55=await purchases[_0x283ea0(0x1fa)]({'_id':_0x19d2a5['params']['id']}),_0x4c5d90=await warehouse[_0x283ea0(0x1fa)]({'name':_0x11577f,'room':_0x19909e});if(typeof _0x4639f8==_0x283ea0(0x2c8))var _0x27951d=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x20e)]],_0x506193=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x2c9)]],_0x2314d8=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x1f5)]],_0x584b24=[_0x19d2a5[_0x283ea0(0x1bf)]['return_qty']],_0xfd150f=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x20a)]],_0x43c320=[_0x19d2a5[_0x283ea0(0x1bf)]['isle']],_0x35c462=[_0x19d2a5[_0x283ea0(0x1bf)]['pallet']],_0x5e4867=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x24a)]],_0x55936e=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x27c)]],_0x1d665e=[_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x280)]],_0x3d5edd=[_0x19d2a5[_0x283ea0(0x1bf)]['secondary_code_hide']];else var _0x27951d=[..._0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x20e)]],_0x506193=[..._0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x2c9)]],_0x2314d8=[..._0x19d2a5['body'][_0x283ea0(0x1f5)]],_0x584b24=[..._0x19d2a5[_0x283ea0(0x1bf)]['return_qty']],_0xfd150f=[..._0x19d2a5['body'][_0x283ea0(0x20a)]],_0x43c320=[..._0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x21a)]],_0x35c462=[..._0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x25c)]],_0x5e4867=[..._0x19d2a5[_0x283ea0(0x1bf)]['types']],_0x55936e=[..._0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x27c)]],_0x1d665e=[..._0x19d2a5[_0x283ea0(0x1bf)]['primary_code_hide']],_0x3d5edd=[..._0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x26d)]];const _0x5a5592=_0x27951d[_0x283ea0(0x20f)](_0x43bbb6=>{return _0x43bbb6={'product_name':_0x43bbb6};});_0x506193['forEach']((_0x5cf257,_0x2821fe)=>{var _0x1b3549=_0x283ea0;_0x5a5592[_0x2821fe][_0x1b3549(0x2c9)]=_0x5cf257;}),_0x2314d8[_0x283ea0(0x1e0)]((_0x20b962,_0x15e75a)=>{var _0x25f85a=_0x283ea0;_0x5a5592[_0x15e75a][_0x25f85a(0x28d)]=_0x20b962;}),_0x584b24[_0x283ea0(0x1e0)]((_0x54ab2a,_0x4c2cba)=>{var _0x111696=_0x283ea0;_0x5a5592[_0x4c2cba][_0x111696(0x208)]=_0x54ab2a;}),_0xfd150f['forEach']((_0x365b0e,_0x9f2aa1)=>{var _0x338979=_0x283ea0;_0x5a5592[_0x9f2aa1][_0x338979(0x25d)]=_0x365b0e;}),_0x43c320[_0x283ea0(0x1e0)]((_0x642f10,_0x46030f)=>{var _0x2c8fac=_0x283ea0;_0x5a5592[_0x46030f][_0x2c8fac(0x1bb)]=_0x642f10;}),_0x35c462[_0x283ea0(0x1e0)]((_0x454ed1,_0xe8ed94)=>{var _0x1591c3=_0x283ea0;_0x5a5592[_0xe8ed94][_0x1591c3(0x234)]=_0x454ed1;}),_0x5e4867['forEach']((_0x4d3536,_0x259ffe)=>{var _0xbc2c92=_0x283ea0;_0x5a5592[_0x259ffe][_0xbc2c92(0x2b1)]=_0x4d3536;}),_0x55936e[_0x283ea0(0x1e0)]((_0x3a00c1,_0x31f933)=>{var _0x238a8b=_0x283ea0;_0x5a5592[_0x31f933][_0x238a8b(0x256)]=_0x3a00c1;}),_0x1d665e[_0x283ea0(0x1e0)]((_0x3c7bd9,_0x506a52)=>{var _0x237782=_0x283ea0;_0x5a5592[_0x506a52][_0x237782(0x299)]=_0x3c7bd9;}),_0x3d5edd[_0x283ea0(0x1e0)]((_0x1fefb8,_0x3eebe5)=>{var _0x85f9b4=_0x283ea0;_0x5a5592[_0x3eebe5][_0x85f9b4(0x231)]=_0x1fefb8;}),_0x262b55[_0x283ea0(0x1e1)][_0x283ea0(0x1e0)](_0x494454=>{var _0x3fb87f=_0x283ea0;const _0x44cbea=_0x4c5d90[_0x3fb87f(0x1af)]['map'](_0x237c45=>{var _0x4f8c1e=_0x3fb87f;_0x237c45[_0x4f8c1e(0x20e)]==_0x494454[_0x4f8c1e(0x20e)]&&_0x237c45[_0x4f8c1e(0x234)]==_0x494454['floorlevel']&&_0x237c45[_0x4f8c1e(0x2b1)]==_0x494454['type']&&_0x237c45['bin']==_0x494454[_0x4f8c1e(0x1bb)]&&_0x237c45[_0x4f8c1e(0x25d)]==_0x494454['bay']&&_0x237c45[_0x4f8c1e(0x1fe)]==_0x494454['rack']&&_0x237c45[_0x4f8c1e(0x258)]==_0x494454['storage']&&(console['log'](parseInt(_0x237c45['product_stock'])+_0x4f8c1e(0x1ff)+parseInt(_0x494454[_0x4f8c1e(0x232)])),_0x237c45[_0x4f8c1e(0x1da)]=parseInt(_0x237c45[_0x4f8c1e(0x1da)])+parseInt(_0x494454[_0x4f8c1e(0x232)]));});}),await _0x4c5d90['save']();const _0x2a19d2=_0x5a5592[_0x283ea0(0x217)](_0xac2401=>_0xac2401[_0x283ea0(0x208)]!=='0'&&_0xac2401['return_qty']!=='');var _0x1e789b=0x0;_0x2a19d2[_0x283ea0(0x1e0)](_0x9be00c=>{var _0x372d35=_0x283ea0;console['log']('foreach\x20newproduct',_0x9be00c),(parseInt(_0x9be00c[_0x372d35(0x2c9)])<parseInt(_0x9be00c[_0x372d35(0x208)])||parseInt(_0x9be00c['stock_quantity'])<parseInt(_0x9be00c[_0x372d35(0x208)]))&&_0x1e789b++;});if(_0x1e789b!=0x0)return _0x19d2a5[_0x283ea0(0x1e7)]('errors',_0x283ea0(0x2a8)),_0x475f63[_0x283ea0(0x2b0)](_0x283ea0(0x20d));const _0x1b6ccf=new purchases_return({'invoice':_0x4a39bc,'suppliers':_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x295)],'date':_0x3b4044,'warehouse_name':_0x11577f,'return_product':_0x2a19d2,'note':_0x43d605,'room':_0x19909e,'to_warehouse_name':_0x264ba5,'to_room':_0x28e077}),_0x1bc4b9=await _0x1b6ccf[_0x283ea0(0x1d8)]();console[_0x283ea0(0x27f)](_0x1b6ccf);const _0x5046ce=await purchases_return[_0x283ea0(0x1fa)]({'invoice':_0x4a39bc}),_0x27eb47=await warehouse[_0x283ea0(0x1fa)]({'name':_0x264ba5,'room':_0x28e077});_0x5046ce[_0x283ea0(0x27d)]['forEach'](_0x2980e7=>{var _0x4a5534=_0x283ea0,_0x168b13=0x0;const _0x450175=_0x27eb47[_0x4a5534(0x1af)][_0x4a5534(0x20f)](_0x4f5cfc=>{var _0x1c577d=_0x4a5534;_0x4f5cfc[_0x1c577d(0x20e)]==_0x2980e7[_0x1c577d(0x20e)]&&_0x4f5cfc[_0x1c577d(0x234)]==_0x2980e7[_0x1c577d(0x234)]&&_0x4f5cfc[_0x1c577d(0x2b1)]==_0x2980e7['type']&&_0x4f5cfc[_0x1c577d(0x1bb)]==_0x2980e7[_0x1c577d(0x1bb)]&&_0x4f5cfc[_0x1c577d(0x25d)]==_0x2980e7[_0x1c577d(0x25d)]&&(_0x4f5cfc['product_stock']=parseInt(_0x4f5cfc[_0x1c577d(0x1da)])-parseInt(_0x2980e7[_0x1c577d(0x208)]),_0x168b13++);});_0x168b13=='0'&&(_0x27eb47['product_details']=_0x27eb47[_0x4a5534(0x1af)]['concat']({'product_name':_0x2980e7['product_name'],'product_stock':_0x2980e7[_0x4a5534(0x208)],'primary_code':_0x2980e7[_0x4a5534(0x299)],'secondary_code':_0x2980e7[_0x4a5534(0x231)],'product_code':_0x2980e7[_0x4a5534(0x256)],'storage':_0x2980e7['storage'],'rack':_0x2980e7[_0x4a5534(0x1fe)],'bay':_0x2980e7['bay'],'bin':_0x2980e7[_0x4a5534(0x1bb)],'type':_0x2980e7['type'],'floorlevel':_0x2980e7[_0x4a5534(0x234)],'maxProducts':_0x2980e7[_0x4a5534(0x255)],'unit':_0x2980e7[_0x4a5534(0x297)],'secondary_unit':_0x2980e7[_0x4a5534(0x2ca)],'expiry_date':_0x2980e7['expiry_date']}));}),await _0x27eb47[_0x283ea0(0x1d8)]();const _0x29237c=await purchases[_0x283ea0(0x1fa)]({'invoice':_0x4a39bc});_0x29237c[_0x283ea0(0x222)]=_0x283ea0(0x2bd);const _0x45d75e=await _0x29237c[_0x283ea0(0x1d8)](),_0xb774d4=new s_payment_data({'invoice':_0x4a39bc,'suppliers':_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x295)],'reason':'Purchase\x20Return'});await _0xb774d4['save']();const _0x1d0553=await master_shop[_0x283ea0(0x248)]();console[_0x283ea0(0x27f)](_0x283ea0(0x1fd),_0x1d0553[0x0][_0x283ea0(0x284)]);const _0x4754db=await email_settings['findOne'](),_0x686b48=await suppliers[_0x283ea0(0x1fa)]({'name':_0x19d2a5[_0x283ea0(0x1bf)][_0x283ea0(0x295)]});console['log'](_0x283ea0(0x2a1),_0x686b48);_0x1d0553[0x0][_0x283ea0(0x286)]==0x1?(right_currency=_0x1d0553[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x1d0553[0x0][_0x283ea0(0x274)]);var _0x4dd996=_0x27951d,_0x830c79=_0x584b24,_0x41724d='',_0x1b715b;for(_0x1b715b in _0x4dd996){_0x41724d+=_0x283ea0(0x1cf)+_0x283ea0(0x1f6)+_0x4dd996[_0x1b715b]+_0x283ea0(0x1e5)+_0x283ea0(0x1f6)+_0x830c79[_0x1b715b]+_0x283ea0(0x1e5)+_0x283ea0(0x1ae);}console[_0x283ea0(0x27f)](_0x283ea0(0x264),_0x41724d);let _0x11d342=nodemailer[_0x283ea0(0x2a4)]({'service':'gmail','auth':{'user':_0x4754db['email'],'pass':_0x4754db[_0x283ea0(0x270)]}}),_0x28798a={'from':_0x4754db[_0x283ea0(0x28a)],'to':_0x686b48[_0x283ea0(0x28a)],'subject':_0x283ea0(0x23b),'attachments':[{'filename':_0x283ea0(0x254),'path':__dirname+'/../public'+_0x283ea0(0x245)+_0x1d0553[0x0][_0x283ea0(0x284)],'cid':_0x283ea0(0x285)}],'html':'<!DOCTYPE\x20html>'+_0x283ea0(0x21e)+_0x283ea0(0x1cc)+_0x283ea0(0x219)+_0x283ea0(0x1f9)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x283ea0(0x213)+_0x283ea0(0x219)+_0x283ea0(0x2c7)+_0x1d0553[0x0]['site_title']+_0x283ea0(0x2cc)+'</div>'+_0x283ea0(0x213)+_0x283ea0(0x2c3)+_0x283ea0(0x219)+_0x283ea0(0x1c0)+_0x283ea0(0x24f)+_0x4a39bc+'\x20'+_0x283ea0(0x28c)+_0x283ea0(0x2b2)+_0x3b4044+'\x20'+_0x283ea0(0x237)+'</h5>'+_0x283ea0(0x213)+_0x283ea0(0x1e9)+_0x283ea0(0x24c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x283ea0(0x1c6)+_0x283ea0(0x201)+_0x283ea0(0x207)+_0x283ea0(0x1ae)+'</thead>'+_0x283ea0(0x282)+'\x20'+_0x41724d+'\x20'+_0x283ea0(0x230)+_0x283ea0(0x1c1)+_0x283ea0(0x219)+_0x283ea0(0x1c4)+_0x283ea0(0x247)+_0x1d0553[0x0][_0x283ea0(0x28f)]+'</h5>'+_0x283ea0(0x213)+'</div>'+_0x283ea0(0x1bd)};_0x11d342[_0x283ea0(0x238)](_0x28798a,function(_0x530dd2,_0x2cc789){var _0x4fb111=_0x283ea0;_0x530dd2?(console[_0x4fb111(0x27f)](_0x530dd2),console['log'](_0x4fb111(0x259))):console[_0x4fb111(0x27f)]('Email\x20sent\x20successfully');}),_0x19d2a5[_0x283ea0(0x1e7)]('success',_0x283ea0(0x23e)),_0x475f63[_0x283ea0(0x2b0)](_0x283ea0(0x276));}catch(_0x91da44){console[_0x283ea0(0x27f)](_0x91da44),_0x475f63['status'](0xc8)[_0x283ea0(0x277)]({'message':_0x91da44[_0x283ea0(0x292)]});}}),router[a0_0xfadd6a(0x28b)](a0_0xfadd6a(0x265),auth,async(_0x18b920,_0x34f5e1)=>{var _0x37d1c2=a0_0xfadd6a;try{const {username:_0x29afb5,email:_0x29aed5,role:_0x461e1a}=_0x18b920[_0x37d1c2(0x273)],_0x3ba1df=_0x18b920[_0x37d1c2(0x273)],_0x1570d0=await profile['findOne']({'email':_0x3ba1df[_0x37d1c2(0x28a)]}),_0x223549=await master_shop[_0x37d1c2(0x248)](),_0x3fa329=_0x18b920[_0x37d1c2(0x2bc)]['id'],_0x4d4652=await purchases['findById'](_0x3fa329);if(_0x223549[0x0]['language']==_0x37d1c2(0x226))var _0x2ddff2=users[_0x37d1c2(0x2c5)];else{if(_0x223549[0x0][_0x37d1c2(0x25f)]==_0x37d1c2(0x290))var _0x2ddff2=users[_0x37d1c2(0x290)];else{if(_0x223549[0x0][_0x37d1c2(0x25f)]=='German')var _0x2ddff2=users['German'];else{if(_0x223549[0x0][_0x37d1c2(0x25f)]==_0x37d1c2(0x260))var _0x2ddff2=users[_0x37d1c2(0x260)];else{if(_0x223549[0x0]['language']==_0x37d1c2(0x23f))var _0x2ddff2=users[_0x37d1c2(0x23f)];else{if(_0x223549[0x0]['language']==_0x37d1c2(0x1ce))var _0x2ddff2=users['Portuguese'];else{if(_0x223549[0x0][_0x37d1c2(0x25f)]=='Chinese')var _0x2ddff2=users[_0x37d1c2(0x1b2)];else{if(_0x223549[0x0][_0x37d1c2(0x25f)]==_0x37d1c2(0x1cb))var _0x2ddff2=users[_0x37d1c2(0x1f3)];}}}}}}}_0x34f5e1[_0x37d1c2(0x1fb)](_0x37d1c2(0x288),{'success':_0x18b920['flash'](_0x37d1c2(0x287)),'errors':_0x18b920[_0x37d1c2(0x1e7)](_0x37d1c2(0x275)),'role':_0x3ba1df,'profile':_0x1570d0,'alldata':_0x4d4652,'master_shop':_0x223549,'language':_0x2ddff2}),console[_0x37d1c2(0x27f)](alldata);}catch(_0x1d4ec0){console['log'](_0x1d4ec0);}}),router['post']('/barcode_scanner',async(_0x10b5db,_0x492d16)=>{var _0x14add2=a0_0xfadd6a;const {product_code:_0x200a34}=_0x10b5db[_0x14add2(0x1bf)];var _0x5c979b;const _0x1a15d6=await product[_0x14add2(0x26c)]([{'$match':{'primary_code':_0x200a34,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x14add2(0x291),'name':{'$first':_0x14add2(0x1e3)},'category':{'$first':_0x14add2(0x21c)},'brand':{'$first':_0x14add2(0x1d7)},'unit':{'$first':_0x14add2(0x2bb)},'alertquantity':{'$first':_0x14add2(0x2c1)},'product_code':{'$first':_0x14add2(0x1b6)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x14add2(0x215)},'maxProdPerUnit':{'$first':_0x14add2(0x2ce)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x37a750=await product['aggregate']([{'$match':{'secondary_code':_0x200a34,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x14add2(0x1e3)},'category':{'$first':_0x14add2(0x21c)},'brand':{'$first':_0x14add2(0x1d7)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x14add2(0x2c1)},'product_code':{'$first':_0x14add2(0x1b6)},'primary_code':{'$first':_0x14add2(0x224)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x14add2(0x215)},'maxProdPerUnit':{'$first':_0x14add2(0x2ce)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x14add2(0x23c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1a15d6['length']>0x0)_0x5c979b=_0x1a15d6;else _0x37a750[_0x14add2(0x1f1)]>0x0&&(_0x5c979b=_0x37a750);_0x492d16[_0x14add2(0x277)](_0x5c979b);}),router[a0_0xfadd6a(0x218)]('/CheckingWarehouse',async(_0x66e313,_0x4b79ae)=>{var _0x3dfba2=a0_0xfadd6a;const {primaryCode:_0x1c12dd,secondaryCode:_0x5ccc92,productCode:_0x2a9ad3,bay:_0x1b027c,bin:_0x1bdf7a,types:_0x182cbe,pallet:_0x4319de,warehouses:_0x3be5ca,room:_0x52cd64}=_0x66e313['body'];console[_0x3dfba2(0x27f)](_0x66e313[_0x3dfba2(0x1bf)]);try{const _0x3694c4=await warehouse[_0x3dfba2(0x26c)]([{'$match':{'name':_0x3be5ca,'room':_0x52cd64}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x1b027c,'product_details.bin':_0x1bdf7a,'product_details.type':_0x182cbe}},{'$group':{'_id':_0x3dfba2(0x202),'name':{'$first':_0x3dfba2(0x26e)},'product_stock':{'$first':_0x3dfba2(0x21d)},'level':{'$first':_0x3dfba2(0x29c)},'isle':{'$first':_0x3dfba2(0x1f4)},'pallet':{'$first':_0x3dfba2(0x2c4)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4b79ae[_0x3dfba2(0x22e)](0xc8)[_0x3dfba2(0x277)](_0x3694c4);}catch(_0x26ee53){_0x4b79ae[_0x3dfba2(0x22e)](0x194)[_0x3dfba2(0x277)]({'message':_0x26ee53[_0x3dfba2(0x292)]});}}),module[a0_0xfadd6a(0x296)]=router;