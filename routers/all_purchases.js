function a0_0x59c9(){var _0x1b25ed=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Sales\x20Update\x20successfully','$product_details.level','Email\x20sent\x20successfully','product_stock','path','42YmrckU','Rack\x20C','<hr\x20class=\x22my-3\x22>','$batch_code','/barcode/:id','/preview/:id','purchase\x20data\x20update\x20successfully','ejs','prod_qty','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$suppliers','$return_data','\x20<>\x20','invoice','sendMail','</span>','Ambient','primary_code','Enabled','quantity','Return\x20Goods','back','product_code_hide','Arabic\x20(ae)','../middleware/auth','deliverydate','JO_number','<strong>\x20Regards\x20</strong>','$secondary_code','$product_details.secondary_code','COLD\x20STORAGE','exports','maxperunit','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Raw\x20Materials','name','flash','createTransport','amount','Receiving\x20Area','Rack\x20A','bay','<!DOCTYPE\x20html>','floor','product_cat','Portuguese','product_list','/give_payment/:id','return_qty','currency_placement','3620XppEOF','paid_amount','language','slice','filter','1862KWLkhc','user','get','$maxProdPerUnit','prod_primunit','redirect','Room_name','save','An\x20error\x20occurred.','return_purchase','currency','product_code','$product_details.bay','238178JIQIAn','prod_level','prod_code','max_product_unit','Shelves','product','$category','post','secondary_code_hide','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','return_data','</thead>','add_purchases\x20error','$finalize','prod_cat','\x20</h2>','random','email','</h5>','$note','German','isle','\x20Order\x20Date\x20:\x20','</td>','84636PMyXrB','prod_unit','$product_details.bin','<h2>\x20','Spanish','site_title','date_data','staff','getDate','POnumber','all_purchases','/view/add_purchases','warehouse_name','English','<div>','role','$product_code','level','<h5>','actual_uom','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Purchase\x20Return\x20Mail','prod_name','\x20<\x20wew\x20>\x20','nodemailer','image','Hindi','$product_details.product_code','error','string','14392eBjPRS','<html><head><title></title>','$product_details.primary_code','$product_details.product_name','add_purchases','stocks','/invoice/:id','rak','1278fVunRG','params','room_name','$product.quantity','Rack\x20E','find','$name','$product_details.rack','$product_details.storage','padStart','prod_isle','note','239340cDcaBv','forEach','$product_details.maxProducts','concat','batch_code','French','$product_details.type','express','room','../public/language/languages.json','$expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','/all_purchases/view','delivery_date','rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Rack\x20F','success','$room','storage','warehouse','Logo.png','True','getFullYear','Chinese','Router','types','date','logo','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','type','English\x20(US)','$due_amount','67246DCldYJ','return_product','$suppliers_docs','DRY\x20STORAGE','Floor','json','Arabic','map','Error\x20Occurs','maxStocks','../models/all_models','findById','suppliers_docs','$product.bin','product_details','$invoice','abs','$date','$product.floorlevel','purchases\x20item\x20return\x20successfull','payment\x20successfull','$product_details.isle','secondary_unit','MaxStocks_data','/barcode_scanner','$paid_amount','$product_details.floorlevel','message','\x20Order\x20Number\x20:\x20','status','length','$product.type','</tbody>','table\x20page','alertQTY','production_date','catch','$product.room_name','909apFImv','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','495HxYEWB','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/view','$secondary_unit','expiry_date','errors','$alertquantity','prod_Qty','Rack\x20B','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<tr>','$product_details.product_stock','body','prod_invoice','product_name','deliverycode','prod_secondunit','$product','due_amount','add\x20post','Level','gmail','prod_pallet','finalize','$product_details','RoomAssign','then','$product.bay','/view/return_purchase/:id','/upload/','</table>','Portuguese\x20(BR)','/view/:id','<h5\x20style=\x22text-align:\x20left;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','render','$maxStocks','Purchase\x20Return','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','/CheckingWarehouse','pallet','Purchase\x20Mail','standard_unit','$brand','INC-','<span\x20style=\x22float:\x20right;\x22>','getMonth','actual_qty','password','suppliers','$product_details._id','user_id','</head><body>','aggregate','</body></html>','stock_quantity','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','bin','delivery_code','purchase_quantity','findOne','secondary_code','Paid\x20For\x20Purchase','$unit','log','master','</tr>','toString','$_id','floorlevel'];a0_0x59c9=function(){return _0x1b25ed;};return a0_0x59c9();}var a0_0x3d7845=a0_0xd6ca;(function(_0x329395,_0x20e7ca){var _0x232323=a0_0xd6ca,_0x2e0805=_0x329395();while(!![]){try{var _0x57ab30=parseInt(_0x232323(0x22b))/0x1+parseInt(_0x232323(0x2e6))/0x2+-parseInt(_0x232323(0x2a0))/0x3*(-parseInt(_0x232323(0x2fe))/0x4)+-parseInt(_0x232323(0x209))/0x5+parseInt(_0x232323(0x1fd))/0x6*(-parseInt(_0x232323(0x2d9))/0x7)+parseInt(_0x232323(0x1f5))/0x8*(-parseInt(_0x232323(0x251))/0x9)+parseInt(_0x232323(0x2d4))/0xa*(parseInt(_0x232323(0x254))/0xb);if(_0x57ab30===_0x20e7ca)break;else _0x2e0805['push'](_0x2e0805['shift']());}catch(_0x3bad41){_0x2e0805['push'](_0x2e0805['shift']());}}}(a0_0x59c9,0x33e92));const express=require(a0_0x3d7845(0x210)),app=express(),router=express[a0_0x3d7845(0x222)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x3d7845(0x235)),auth=require(a0_0x3d7845(0x2b8)),nodemailer=require(a0_0x3d7845(0x1ef));var ejs=require(a0_0x3d7845(0x2a7));const path=require(a0_0x3d7845(0x29f)),users=require(a0_0x3d7845(0x212));router['get'](a0_0x3d7845(0x256),auth,async(_0x227616,_0x511bad)=>{var _0x5aac6b=a0_0x3d7845;try{const {username:_0x297903,email:_0xdef84a,role:_0xa315fd}=_0x227616[_0x5aac6b(0x2da)],_0x56f81c=_0x227616[_0x5aac6b(0x2da)],_0xad6f2c=await profile[_0x5aac6b(0x290)]({'email':_0x56f81c[_0x5aac6b(0x2f7)]}),_0x3b2167=await staff[_0x5aac6b(0x290)]({'email':_0x56f81c[_0x5aac6b(0x2f7)]});if(_0x56f81c[_0x5aac6b(0x1e6)]==_0x5aac6b(0x305)){const _0x432291=await staff[_0x5aac6b(0x290)]({'email':_0x56f81c[_0x5aac6b(0x2f7)]});}const _0x5e92d1=await master_shop[_0x5aac6b(0x202)]();let _0x2fc712;if(_0x56f81c['role']==_0x5aac6b(0x305)){const _0x344455=await staff[_0x5aac6b(0x290)]({'email':_0x56f81c['email']});_0x2fc712=await purchases['aggregate']([{'$match':{'warehouse_name':_0x344455[_0x5aac6b(0x21d)]}},{'$lookup':{'from':'suppliers','localField':_0x5aac6b(0x285),'foreignField':_0x5aac6b(0x2c5),'as':_0x5aac6b(0x237)}},{'$unwind':_0x5aac6b(0x22d)},{'$unwind':_0x5aac6b(0x265)},{'$group':{'_id':_0x5aac6b(0x298),'invoice':{'$first':_0x5aac6b(0x23a)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x5aac6b(0x23c)},'warehouse_name':{'$first':_0x5aac6b(0x226)},'room':{'$first':_0x5aac6b(0x21b)},'product':{'$push':_0x5aac6b(0x265)},'note':{'$first':_0x5aac6b(0x2f9)},'paid_amount':{'$first':_0x5aac6b(0x244)},'due_amount':{'$first':_0x5aac6b(0x22a)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5aac6b(0x2a3)},'expiry_date':{'$first':_0x5aac6b(0x213)},'suppliers_docs':{'$first':_0x5aac6b(0x22d)},'total_product_quantity':{'$sum':_0x5aac6b(0x200)},'level':{'$addToSet':_0x5aac6b(0x26f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x5aac6b(0x24a)},'floorlevel':{'$addToSet':_0x5aac6b(0x23d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2fc712=await purchases['aggregate']([{'$lookup':{'from':_0x5aac6b(0x285),'localField':_0x5aac6b(0x285),'foreignField':'name','as':_0x5aac6b(0x237)}},{'$unwind':_0x5aac6b(0x22d)},{'$unwind':_0x5aac6b(0x265)},{'$group':{'_id':_0x5aac6b(0x298),'invoice':{'$first':_0x5aac6b(0x23a)},'suppliers':{'$first':_0x5aac6b(0x2aa)},'date':{'$first':_0x5aac6b(0x23c)},'warehouse_name':{'$first':_0x5aac6b(0x226)},'room':{'$addToSet':_0x5aac6b(0x250)},'product':{'$push':_0x5aac6b(0x265)},'note':{'$first':_0x5aac6b(0x2f9)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5aac6b(0x22a)},'return_data':{'$first':_0x5aac6b(0x2ab)},'batch_code':{'$first':_0x5aac6b(0x2a3)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x5aac6b(0x22d)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x5aac6b(0x238)},'type':{'$addToSet':_0x5aac6b(0x24a)},'floorlevel':{'$addToSet':_0x5aac6b(0x23d)},'finalize':{'$first':_0x5aac6b(0x2f3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5e92d1[0x0]['language']==_0x5aac6b(0x229)){var _0x54344a=users[_0x5aac6b(0x1e4)];console[_0x5aac6b(0x294)](_0x54344a);}else{if(_0x5e92d1[0x0][_0x5aac6b(0x2d6)]==_0x5aac6b(0x1f1))var _0x54344a=users[_0x5aac6b(0x1f1)];else{if(_0x5e92d1[0x0][_0x5aac6b(0x2d6)]==_0x5aac6b(0x2fa))var _0x54344a=users[_0x5aac6b(0x2fa)];else{if(_0x5e92d1[0x0][_0x5aac6b(0x2d6)]==_0x5aac6b(0x302))var _0x54344a=users[_0x5aac6b(0x302)];else{if(_0x5e92d1[0x0]['language']=='French')var _0x54344a=users['French'];else{if(_0x5e92d1[0x0]['language']==_0x5aac6b(0x273))var _0x54344a=users[_0x5aac6b(0x2cf)];else{if(_0x5e92d1[0x0][_0x5aac6b(0x2d6)]==_0x5aac6b(0x221))var _0x54344a=users[_0x5aac6b(0x221)];else{if(_0x5e92d1[0x0][_0x5aac6b(0x2d6)]=='Arabic\x20(ae)')var _0x54344a=users[_0x5aac6b(0x231)];}}}}}}}_0x511bad[_0x5aac6b(0x277)](_0x5aac6b(0x308),{'success':_0x227616[_0x5aac6b(0x2c6)](_0x5aac6b(0x21a)),'errors':_0x227616[_0x5aac6b(0x2c6)](_0x5aac6b(0x259)),'purchases':_0x2fc712,'role':_0x56f81c,'profile':_0xad6f2c,'master_shop':_0x5e92d1,'language':_0x54344a});}catch(_0x2c6471){console[_0x5aac6b(0x294)](_0x5aac6b(0x24c),_0x2c6471),_0x511bad[_0x5aac6b(0x248)](0xc8)[_0x5aac6b(0x230)]({'message':_0x2c6471[_0x5aac6b(0x246)]});}});function BayBinSelected(_0x19c18c,_0x71d5b8){var _0x41ec1d=a0_0x3d7845,_0x1f651c=[],_0x6b42e0=[],_0x4a9031=[],_0x38874c=[],_0x1590d6=[],_0x1610bd=[];let _0x5374d5=[];if(_0x19c18c==_0x41ec1d(0x22e))switch(_0x71d5b8){case'Rack\x20A':_0x1f651c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x6b42e0=[0x1,0x2],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=[_0x41ec1d(0x268),_0x41ec1d(0x22f)],_0x1590d6=['D'],_0x1610bd=['A'];break;case _0x41ec1d(0x25c):_0x1f651c=[0x6,0x5,0x4,0x3,0x2,0x1],_0x6b42e0=[0x1,0x2],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=[_0x41ec1d(0x268),'Floor'],_0x1590d6=['D'],_0x1610bd=['B'];break;case'Shelves':_0x1f651c=[0x0],_0x6b42e0=[0x0],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=[_0x41ec1d(0x22f)],_0x1590d6=['D'],_0x1610bd=['S'];break;case _0x41ec1d(0x2c9):_0x1f651c=[0x0],_0x6b42e0=[0x0],_0x38874c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4a9031=[_0x41ec1d(0x22f)],_0x1590d6=['D'],_0x1610bd=['R'];break;}else{if(_0x19c18c==_0x41ec1d(0x2be))switch(_0x71d5b8){case _0x41ec1d(0x2ca):_0x1f651c=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x6b42e0=['B','F'],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=[_0x41ec1d(0x268),'Floor'],_0x1590d6=['C'],_0x1610bd=['A'];break;case _0x41ec1d(0x25c):_0x1f651c=[0x5,0x4,0x3,0x2,0x1],_0x6b42e0=['F','B','S'],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=[_0x41ec1d(0x268),_0x41ec1d(0x22f)],_0x1590d6=['C'],_0x1610bd=['B'];break;case _0x41ec1d(0x2a1):_0x1f651c=[0x1,0x2,0x3,0x4,0x5],_0x6b42e0=['B','F','S'],_0x38874c=[0x5,0x4,0x3,0x2,0x1],_0x4a9031=[_0x41ec1d(0x268),_0x41ec1d(0x22f)],_0x1590d6=['C'],_0x1610bd=['C'];break;case'Rack\x20D':_0x1f651c=[0x5,0x4,0x3,0x2,0x1],_0x6b42e0=['F','B','S'],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=[_0x41ec1d(0x268),_0x41ec1d(0x22f)],_0x1590d6=['C'],_0x1610bd=['D'];break;case _0x41ec1d(0x201):_0x1f651c=[0x4,0x3,0x2,0x1],_0x6b42e0=[0x1,0x2],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=['Level',_0x41ec1d(0x22f)],_0x1590d6=['C'],_0x1610bd=['E'];break;case _0x41ec1d(0x219):_0x1f651c=[0x1,0x2,0x3],_0x6b42e0=[0x1,0x2],_0x38874c=[0x1,0x2,0x3,0x4,0x5],_0x4a9031=['Level'],_0x1590d6=['C'],_0x1610bd=['F'];break;}}return{'levels':_0x1f651c,'Isle':_0x6b42e0,'rack':_0x38874c,'type':_0x4a9031,'storage':_0x1590d6,'rak':_0x1610bd};}async function getRandom8DigitNumber(){var _0x12dfad=a0_0x3d7845;const _0x415b20=0x989680,_0x10afb1=0x5f5e0ff,_0x3aa562=Math[_0x12dfad(0x2cd)](Math[_0x12dfad(0x2f6)]()*(_0x10afb1-_0x415b20+0x1))+_0x415b20;var _0x4d6532;const _0x5bfe0d=await purchases[_0x12dfad(0x290)]({'invoice':'INC-'+_0x3aa562});return _0x5bfe0d&&_0x5bfe0d[_0x12dfad(0x249)]>0x0?_0x4d6532=_0x12dfad(0x280)+_0x3aa562:_0x4d6532='INC-'+_0x3aa562,_0x4d6532;}function a0_0xd6ca(_0x4a33f6,_0x5c803a){var _0x59c9ae=a0_0x59c9();return a0_0xd6ca=function(_0xd6ca53,_0x254f0c){_0xd6ca53=_0xd6ca53-0x1e3;var _0x201653=_0x59c9ae[_0xd6ca53];return _0x201653;},a0_0xd6ca(_0x4a33f6,_0x5c803a);}router['get'](a0_0x3d7845(0x309),auth,async(_0xef1b78,_0x18e323)=>{var _0xcb2965=a0_0x3d7845;try{const {username:_0x24bb04,email:_0x199724,role:_0x45f209}=_0xef1b78[_0xcb2965(0x2da)],_0x500b30=_0xef1b78['user'],_0x13bd2f=await profile['findOne']({'email':_0x500b30[_0xcb2965(0x2f7)]}),_0x542830=await master_shop['find'](),_0x24b627=await staff[_0xcb2965(0x290)]({'email':_0x500b30['email']}),_0x4ab230=await suppliers[_0xcb2965(0x202)]({});let _0x504585;if(_0x500b30[_0xcb2965(0x1e6)]==_0xcb2965(0x305)){const _0x467136=await staff[_0xcb2965(0x290)]({'email':_0x500b30['email']});_0x504585=await warehouse[_0xcb2965(0x289)]([{'$match':{'status':_0xcb2965(0x2b2),'name':_0x467136[_0xcb2965(0x21d)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xcb2965(0x2b4)}}},{'$group':{'_id':_0xcb2965(0x203),'name':{'$first':_0xcb2965(0x203)}}}]);}else _0x504585=await warehouse[_0xcb2965(0x289)]([{'$match':{'status':_0xcb2965(0x2b2),'warehouse_category':_0xcb2965(0x2c4),'name':{'$ne':_0xcb2965(0x2b4)}}},{'$group':{'_id':_0xcb2965(0x203),'name':{'$first':'$name'}}}]);const _0x11dae1=await product[_0xcb2965(0x202)]({}),_0x4a6359=await warehouse[_0xcb2965(0x202)]({'status':'Enabled'}),_0x222232=await purchases[_0xcb2965(0x202)]({}),_0x472975=_0x222232[_0xcb2965(0x249)]+0x1,_0x236e32=_0xcb2965(0x280)+_0x472975[_0xcb2965(0x297)]()[_0xcb2965(0x206)](0x5,'0');var _0x12b13f=[_0xcb2965(0x2b0),'Enclosed'];if(_0x542830[0x0][_0xcb2965(0x2d6)]==_0xcb2965(0x229))var _0x480e58=users[_0xcb2965(0x1e4)];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]==_0xcb2965(0x1f1))var _0x480e58=users[_0xcb2965(0x1f1)];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]=='German')var _0x480e58=users['German'];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]=='Spanish')var _0x480e58=users[_0xcb2965(0x302)];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]=='French')var _0x480e58=users[_0xcb2965(0x20e)];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]=='Portuguese\x20(BR)')var _0x480e58=users[_0xcb2965(0x2cf)];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]==_0xcb2965(0x221))var _0x480e58=users['Chinese'];else{if(_0x542830[0x0][_0xcb2965(0x2d6)]=='Arabic\x20(ae)')var _0x480e58=users['Arabic'];}}}}}}}const _0x5183f3=getRandom8DigitNumber();_0x5183f3[_0xcb2965(0x26e)](_0x17bb28=>{var _0x26e379=_0xcb2965;_0x18e323[_0x26e379(0x277)](_0x26e379(0x1f9),{'success':_0xef1b78[_0x26e379(0x2c6)](_0x26e379(0x21a)),'errors':_0xef1b78[_0x26e379(0x2c6)]('errors'),'role':_0x500b30,'profile':_0x13bd2f,'suppliers':_0x4ab230,'warehouse':_0x504585,'product':_0x11dae1,'invoice':_0x17bb28,'master_shop':_0x542830,'language':_0x480e58,'find_data':_0x4a6359,'rooms_data':_0x12b13f});})[_0xcb2965(0x24f)](_0x470dfc=>{var _0x5348f4=_0xcb2965;_0xef1b78[_0x5348f4(0x2c6)](_0x5348f4(0x259),_0x5348f4(0x2a9)),_0x18e323['redirect'](_0x5348f4(0x215));});}catch(_0x50ee8e){console[_0xcb2965(0x294)](_0x50ee8e);}}),router[a0_0x3d7845(0x2db)]('/view/add_purchases/:id',auth,async(_0x30a55c,_0x13994b)=>{var _0x235e55=a0_0x3d7845;try{const _0x3f974e=_0x30a55c[_0x235e55(0x1fe)]['id'];console['log'](_0x3f974e);const _0x5cde26=await master_shop['find']();console['log'](_0x235e55(0x295),_0x5cde26);const _0x14231c=await product[_0x235e55(0x290)]({'name':_0x3f974e});console[_0x235e55(0x294)](_0x235e55(0x2eb),_0x14231c),_0x13994b[_0x235e55(0x248)](0xc8)['json']({'product_data':_0x14231c,'master':_0x5cde26});}catch(_0x422d34){console[_0x235e55(0x294)](_0x235e55(0x2f2),_0x422d34);}}),router['post'](a0_0x3d7845(0x309),auth,async(_0x202f7d,_0x34e08a)=>{var _0xcd8d67=a0_0x3d7845;try{const {invoice:_0x18f56d,date:_0x4acc10,warehouse_name:_0x3e2120,prod_name:_0xaf4dea,prod_code:_0x3b0e5a,prod_qty:_0x51df5a,prod_unit:_0x4df629,prod_secondunit:_0x47bd58,prod_level:_0x1ec664,prod_isle:_0x2104c7,prod_pallet:_0x55b554,note:_0x314ea2,expiry_date:_0x1449c8,batch_code:_0x409810,payable:_0x18d8f0,due_amount:_0x2fa73f,Room_name:_0x2ac4bb,primary_code:_0x393de4,secondary_code:_0x1a5539,MaxStocks_data:_0x337fdb,PO_number:_0x3ad734,SCRN:_0x5642ab,JO_number:_0x592510}=_0x202f7d[_0xcd8d67(0x260)];if(typeof _0xaf4dea==_0xcd8d67(0x1f4))var _0x2cd03b=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x1ed)]],_0x323909=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2e8)]],_0x343daf=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x25b)]],_0x6c5f52=[_0x202f7d['body']['prod_primunit']],_0x10ef94=[_0x202f7d['body']['prod_secondunit']],_0x1559c3=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2e7)]],_0x10b458=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2b1)]],_0x6d7d93=[_0x202f7d[_0xcd8d67(0x260)]['secondary_code']],_0x315615=[_0x202f7d[_0xcd8d67(0x260)]['MaxStocks_data']],_0x352654=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x20d)]],_0x221ca7=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x258)]],_0x288550=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2e9)]],_0x512c96=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x24d)]],_0xee7a65=[_0x202f7d[_0xcd8d67(0x260)]['production_date']],_0x5225f6=[_0x202f7d[_0xcd8d67(0x260)]['prod_cat']],_0x797a1d=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x26d)]],_0x4b4cc5=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x263)]],_0x5bc9fc=[_0x202f7d[_0xcd8d67(0x260)]['prod_invoice']],_0x25e185=[_0x202f7d['body'][_0xcd8d67(0x283)]],_0x43eddb=[_0x202f7d['body'][_0xcd8d67(0x1ea)]],_0x1692d4=[_0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2b9)]];else var _0x2cd03b=[..._0x202f7d['body']['prod_name']],_0x323909=[..._0x202f7d['body'][_0xcd8d67(0x2e8)]],_0x343daf=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x25b)]],_0x6c5f52=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2dd)]],_0x10ef94=[..._0x202f7d['body']['prod_secondunit']],_0x1559c3=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2e7)]],_0x10b458=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2b1)]],_0x6d7d93=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x291)]],_0x315615=[..._0x202f7d['body'][_0xcd8d67(0x242)]],_0x352654=[..._0x202f7d[_0xcd8d67(0x260)]['batch_code']],_0x221ca7=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x258)]],_0x288550=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2e9)]],_0x512c96=[..._0x202f7d['body'][_0xcd8d67(0x24d)]],_0xee7a65=[..._0x202f7d[_0xcd8d67(0x260)]['production_date']],_0x5225f6=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x2f4)]],_0x797a1d=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x26d)]],_0x4b4cc5=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x263)]],_0x5bc9fc=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x261)]],_0x25e185=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x283)]],_0x43eddb=[..._0x202f7d[_0xcd8d67(0x260)][_0xcd8d67(0x1ea)]],_0x1692d4=[..._0x202f7d['body'][_0xcd8d67(0x2b9)]];const _0x4a453c=_0x2cd03b[_0xcd8d67(0x232)](_0x10fee2=>{return _0x10fee2={'product_name':_0x10fee2};});_0x25e185[_0xcd8d67(0x20a)]((_0x22250f,_0x593b37)=>{var _0x452120=_0xcd8d67;_0x4a453c[_0x593b37][_0x452120(0x283)]=Math['abs'](_0x22250f);}),_0x43eddb[_0xcd8d67(0x20a)]((_0x229439,_0x124565)=>{var _0x562f4e=_0xcd8d67;_0x4a453c[_0x124565][_0x562f4e(0x1ea)]=_0x229439;}),_0x323909[_0xcd8d67(0x20a)]((_0x2d4273,_0x11611c)=>{var _0x417212=_0xcd8d67;_0x4a453c[_0x11611c][_0x417212(0x2e4)]=_0x2d4273,_0x4a453c[_0x11611c][_0x417212(0x304)]=_0x4acc10;}),_0x343daf['forEach']((_0x19d2e9,_0xbf594c)=>{var _0x3e91e1=_0xcd8d67;_0x4a453c[_0xbf594c]['quantity']=Math[_0x3e91e1(0x23b)](_0x19d2e9);}),_0x6c5f52['forEach']((_0x4e22f2,_0x212267)=>{var _0x2187a3=_0xcd8d67;_0x4a453c[_0x212267][_0x2187a3(0x27e)]=_0x4e22f2;}),_0x10ef94[_0xcd8d67(0x20a)]((_0x13a5d0,_0x337a03)=>{var _0x14bc22=_0xcd8d67;_0x4a453c[_0x337a03][_0x14bc22(0x241)]=_0x13a5d0;}),_0x1559c3[_0xcd8d67(0x20a)]((_0x225793,_0x10fcc2)=>{_0x797a1d['forEach']((_0x1b3d9e,_0x4ceef5)=>{var _0x2e6e2e=a0_0xd6ca;if(_0x1b3d9e==_0x2e6e2e(0x2c9)&&_0x10fcc2==_0x4ceef5){console[_0x2e6e2e(0x294)](_0x1b3d9e+_0x2e6e2e(0x1ee)+_0x10fcc2+_0x2e6e2e(0x2ac)+_0x4ceef5+'\x20<>\x20'+_0x225793);var _0x3aaba0=_0x225793[_0x2e6e2e(0x2d7)](0x3);_0x4a453c[_0x10fcc2][_0x2e6e2e(0x21c)]=_0x225793[0x0],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x217)]=_0x225793[0x1],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x2cb)]=0x0,_0x4a453c[_0x10fcc2][_0x2e6e2e(0x28d)]=0x0,_0x4a453c[_0x10fcc2][_0x2e6e2e(0x228)]='Floor',_0x4a453c[_0x10fcc2][_0x2e6e2e(0x299)]=_0x3aaba0;}else{if(_0x1b3d9e==_0x2e6e2e(0x2ea)&&_0x10fcc2==_0x4ceef5){var _0x3aaba0=_0x225793['slice'](0x3);_0x4a453c[_0x10fcc2]['storage']=_0x225793[0x0],_0x4a453c[_0x10fcc2]['rack']=_0x225793[0x1],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x2cb)]=0x0,_0x4a453c[_0x10fcc2][_0x2e6e2e(0x28d)]=0x0,_0x4a453c[_0x10fcc2][_0x2e6e2e(0x228)]=_0x2e6e2e(0x22f),_0x4a453c[_0x10fcc2][_0x2e6e2e(0x299)]=_0x225793[0x5];}else{if(_0x10fcc2==_0x4ceef5){if(_0x225793[0x0]=='A'&&_0x225793[0x1]=='L'&&_0x225793[0x2]=='L')console[_0x2e6e2e(0x294)](_0x1b3d9e+_0x2e6e2e(0x2ac)+_0x10fcc2+_0x2e6e2e(0x2ac)+_0x4ceef5+_0x2e6e2e(0x2ac)+_0x225793+'here'),_0x4a453c[_0x10fcc2]['storage']=_0x225793[0x0],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x217)]=_0x225793[0x1],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x2cb)]=0x0,_0x4a453c[_0x10fcc2][_0x2e6e2e(0x28d)]=0x0,_0x4a453c[_0x10fcc2][_0x2e6e2e(0x228)]=_0x2e6e2e(0x22f),_0x4a453c[_0x10fcc2][_0x2e6e2e(0x299)]=_0x225793[0x3];else{var _0x571886;if(_0x225793[0x4]=='L')_0x571886=_0x2e6e2e(0x268);else _0x225793[0x4]=='F'&&(_0x571886='Floor');_0x4a453c[_0x10fcc2][_0x2e6e2e(0x21c)]=_0x225793[0x0],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x217)]=_0x225793[0x1],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x2cb)]=_0x225793[0x2],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x28d)]=_0x225793[0x3],_0x4a453c[_0x10fcc2][_0x2e6e2e(0x228)]=_0x571886,_0x4a453c[_0x10fcc2]['floorlevel']=_0x225793[0x5];}}}}});}),_0x10b458['forEach']((_0x342c45,_0x14a8bc)=>{var _0x3ce5bd=_0xcd8d67;_0x4a453c[_0x14a8bc][_0x3ce5bd(0x2b1)]=_0x342c45;}),_0x6d7d93[_0xcd8d67(0x20a)]((_0x1d3a20,_0x5850be)=>{_0x4a453c[_0x5850be]['secondary_code']=_0x1d3a20;}),_0x315615[_0xcd8d67(0x20a)]((_0x27aaaa,_0xd39b42)=>{var _0x13e432=_0xcd8d67;_0x4a453c[_0xd39b42][_0x13e432(0x234)]=_0x27aaaa;}),_0x352654['forEach']((_0x42daf1,_0xaa9e82)=>{var _0x188c00=_0xcd8d67;_0x4a453c[_0xaa9e82][_0x188c00(0x20d)]=_0x42daf1;}),_0x221ca7['forEach']((_0x5f4952,_0x149461)=>{var _0x2583e6=_0xcd8d67;_0x4a453c[_0x149461][_0x2583e6(0x258)]=_0x5f4952;}),_0x288550[_0xcd8d67(0x20a)]((_0x59dcc2,_0x5adb24)=>{var _0x5b4000=_0xcd8d67;_0x4a453c[_0x5adb24][_0x5b4000(0x2c0)]=_0x59dcc2;}),_0x512c96[_0xcd8d67(0x20a)]((_0x2f74ad,_0x2a4423)=>{var _0x5563c5=_0xcd8d67;_0x4a453c[_0x2a4423][_0x5563c5(0x24d)]=_0x2f74ad;}),_0xee7a65[_0xcd8d67(0x20a)]((_0x2ae2a1,_0x2ff6a4)=>{var _0x47a092=_0xcd8d67;_0x4a453c[_0x2ff6a4][_0x47a092(0x24e)]=_0x2ae2a1;}),_0x5225f6[_0xcd8d67(0x20a)]((_0xc8617d,_0x1099ff)=>{var _0x31698a=_0xcd8d67;_0x4a453c[_0x1099ff][_0x31698a(0x2ce)]=_0xc8617d;}),_0x797a1d[_0xcd8d67(0x20a)]((_0x53474b,_0x4c77c0)=>{var _0xbe4d3d=_0xcd8d67;_0x4a453c[_0x4c77c0][_0xbe4d3d(0x1ff)]=_0x53474b;}),_0x1692d4[_0xcd8d67(0x20a)]((_0x43d222,_0x12b1ba)=>{var _0x4e0af9=_0xcd8d67;_0x4a453c[_0x12b1ba][_0x4e0af9(0x216)]=_0x43d222;}),_0x4b4cc5[_0xcd8d67(0x20a)]((_0x383a20,_0x5cbbdb)=>{var _0x282cae=_0xcd8d67;_0x4a453c[_0x5cbbdb][_0x282cae(0x28e)]=_0x383a20;}),_0x5bc9fc[_0xcd8d67(0x20a)]((_0x1a6e8,_0x4b12b7)=>{_0x4a453c[_0x4b12b7]['invoice']=_0x1a6e8;});const _0x180086=_0x797a1d['map'](_0x505f40=>{return _0x505f40={'room_name':_0x505f40};}),_0x5a374f=_0x4a453c[_0xcd8d67(0x2d8)](_0xf17f0f=>_0xf17f0f[_0xcd8d67(0x2b3)]!=='0'&&_0xf17f0f[_0xcd8d67(0x2b3)]!==''),_0x2683cd=new purchases({'invoice':_0x18f56d,'suppliers':_0x202f7d['body'][_0xcd8d67(0x285)],'date':_0x4acc10,'warehouse_name':_0x3e2120,'product':_0x5a374f,'note':_0x314ea2,'due_amount':_0x2fa73f,'POnumber':_0x3ad734,'SCRN':_0x5642ab,'JO_number':_0x592510,'roomList':_0x180086}),_0x5b55cb=await _0x2683cd[_0xcd8d67(0x2e0)](),_0x2b6a15=await purchases[_0xcd8d67(0x290)]({'invoice':_0x18f56d}),_0x1dfefa=_0x2b6a15['product'][_0xcd8d67(0x232)](async _0x270474=>{var _0x4bf7ee=_0xcd8d67,_0x537f4a=await warehouse['findOne']({'name':_0x3e2120,'room':_0x270474[_0x4bf7ee(0x1ff)]}),_0x316a07=0x0;return _0x537f4a['product_details'][_0x4bf7ee(0x20a)](_0x2869d0=>{var _0x29faf2=_0x4bf7ee;_0x2869d0[_0x29faf2(0x262)]==_0x270474['product_name']&&_0x2869d0[_0x29faf2(0x299)]==_0x270474[_0x29faf2(0x299)]&&_0x2869d0['type']==_0x270474[_0x29faf2(0x228)]&&_0x2869d0[_0x29faf2(0x28d)]==_0x270474[_0x29faf2(0x28d)]&&_0x2869d0[_0x29faf2(0x2cb)]==_0x270474[_0x29faf2(0x2cb)]&&_0x2869d0[_0x29faf2(0x217)]==_0x270474[_0x29faf2(0x217)]&&_0x2869d0[_0x29faf2(0x21c)]==_0x270474['storage']&&_0x2869d0[_0x29faf2(0x258)]==_0x270474['expiry_date']&&_0x2869d0[_0x29faf2(0x20d)]==_0x270474[_0x29faf2(0x20d)]&&_0x2869d0['production_date']==_0x270474[_0x29faf2(0x24e)]&&_0x2869d0[_0x29faf2(0x2ad)]==_0x2b6a15[_0x29faf2(0x2ad)]&&(_0x2869d0[_0x29faf2(0x29e)]+=Math[_0x29faf2(0x23b)](_0x270474[_0x29faf2(0x2b3)]),_0x316a07++);}),_0x316a07===0x0&&_0x537f4a['product_details']['push']({'product_name':_0x270474['product_name'],'product_stock':Math[_0x4bf7ee(0x23b)](_0x270474[_0x4bf7ee(0x2b3)]),'primary_code':_0x270474[_0x4bf7ee(0x2b1)],'secondary_code':_0x270474[_0x4bf7ee(0x291)],'product_code':_0x270474[_0x4bf7ee(0x2e4)],'storage':_0x270474[_0x4bf7ee(0x21c)],'rack':_0x270474['rack'],'bay':_0x270474[_0x4bf7ee(0x2cb)],'bin':_0x270474[_0x4bf7ee(0x28d)],'type':_0x270474[_0x4bf7ee(0x228)],'floorlevel':_0x270474[_0x4bf7ee(0x299)],'maxProducts':_0x270474[_0x4bf7ee(0x234)],'unit':_0x270474['standard_unit'],'secondary_unit':_0x270474['secondary_unit'],'expiry_date':_0x270474['expiry_date'],'maxPerUnit':_0x270474[_0x4bf7ee(0x2c0)],'batch_code':_0x270474[_0x4bf7ee(0x20d)],'alertQTY':_0x270474['alertQTY'],'production_date':_0x270474[_0x4bf7ee(0x24e)],'product_cat':_0x270474[_0x4bf7ee(0x2ce)],'invoice':_0x270474[_0x4bf7ee(0x2ad)],'actual_qty':Math[_0x4bf7ee(0x23b)](_0x270474[_0x4bf7ee(0x283)]),'actual_uom':_0x270474[_0x4bf7ee(0x1ea)],'delivery_date':_0x270474[_0x4bf7ee(0x216)],'delivery_code':_0x270474[_0x4bf7ee(0x28e)]}),_0x537f4a;});Promise['all'](_0x1dfefa)[_0xcd8d67(0x26e)](async _0x54bdf1=>{var _0x587405=_0xcd8d67;try{for(const _0x108d46 of _0x54bdf1){await _0x108d46['save']();}const _0x43bae2=await master_shop[_0x587405(0x202)](),_0x348068=await email_settings['findOne'](),_0x751fe5=await supervisor_settings[_0x587405(0x202)]();var _0x462d94=_0x2b6a15[_0x587405(0x2eb)],_0x145153='',_0x241994;for(_0x241994 in _0x462d94){_0x145153+='<tr>'+_0x587405(0x253)+_0x462d94[_0x241994][_0x587405(0x262)]+_0x587405(0x2fd)+_0x587405(0x253)+_0x462d94[_0x241994][_0x587405(0x2e4)]+'</td>'+_0x587405(0x253)+_0x462d94[_0x241994][_0x587405(0x2b3)]+_0x587405(0x2fd)+_0x587405(0x253)+_0x462d94[_0x241994][_0x587405(0x27e)]+_0x587405(0x2fd)+_0x587405(0x253)+_0x462d94[_0x241994][_0x587405(0x241)]+_0x587405(0x2fd)+_0x587405(0x253)+_0x2b6a15[_0x587405(0x1e3)]+_0x587405(0x2fd)+_0x587405(0x253)+_0x462d94[_0x241994][_0x587405(0x1ff)]+_0x587405(0x2fd)+_0x587405(0x253)+_0x462d94[_0x241994]['storage']+_0x462d94[_0x241994][_0x587405(0x217)]+_0x462d94[_0x241994][_0x587405(0x2cb)]+_0x462d94[_0x241994][_0x587405(0x28d)]+_0x462d94[_0x241994][_0x587405(0x228)][0x0]+_0x462d94[_0x241994][_0x587405(0x299)]+_0x587405(0x2fd),_0x587405(0x296);}let _0x304566=nodemailer['createTransport']({'host':_0x348068['host'],'port':Number(_0x348068['port']),'secure':![],'auth':{'user':_0x348068['email'],'pass':_0x348068[_0x587405(0x284)]}}),_0x34c302={'from':_0x348068[_0x587405(0x2f7)],'to':_0x751fe5[0x0]['RMSEmail'],'subject':_0x587405(0x27d),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x587405(0x271)+_0x43bae2[0x0][_0x587405(0x1f0)],'cid':_0x587405(0x225)}],'html':_0x587405(0x2cc)+_0x587405(0x1f6)+_0x587405(0x288)+_0x587405(0x1e5)+_0x587405(0x28c)+_0x587405(0x1e5)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x587405(0x2c1)+_0x587405(0x1e5)+_0x587405(0x301)+_0x43bae2[0x0][_0x587405(0x303)]+_0x587405(0x2f5)+_0x587405(0x2c1)+_0x587405(0x2c1)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x587405(0x275)+_0x587405(0x247)+_0x2b6a15[_0x587405(0x2ad)]+'\x20'+_0x587405(0x281)+_0x587405(0x2fc)+_0x2b6a15[_0x587405(0x224)]+'\x20'+'</span>'+_0x587405(0x2f8)+_0x587405(0x2c1)+_0x587405(0x1eb)+_0x587405(0x2c3)+_0x587405(0x25e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x587405(0x25d)+_0x587405(0x218)+_0x587405(0x255)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x587405(0x29a)+_0x587405(0x296)+_0x587405(0x2f1)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x145153+'\x20'+_0x587405(0x24b)+_0x587405(0x272)+_0x587405(0x1e5)+'<strong>\x20Regards\x20</strong>'+_0x587405(0x1e9)+_0x43bae2[0x0][_0x587405(0x303)]+_0x587405(0x2f8)+'</div>'+_0x587405(0x2c1)+'</body></html>'};_0x304566[_0x587405(0x2ae)](_0x34c302,function(_0x10f962,_0x2413af){var _0xcade04=_0x587405;_0x10f962?(console[_0xcade04(0x294)](_0x10f962),console['log'](_0xcade04(0x233))):console['log'](_0xcade04(0x29d));}),_0x202f7d[_0x587405(0x2c6)](_0x587405(0x21a),'Purchase\x20data\x20added\x20successfully'),_0x34e08a['redirect']('/all_purchases/view/');}catch(_0x5cc620){console[_0x587405(0x1f3)](_0x5cc620),_0x34e08a[_0x587405(0x248)](0x1f4)['json']({'error':_0x587405(0x214)});}})['catch'](_0x4a777e=>{var _0x49485c=_0xcd8d67;console[_0x49485c(0x1f3)](_0x4a777e),_0x34e08a[_0x49485c(0x248)](0x1f4)[_0x49485c(0x230)]({'error':_0x49485c(0x2e1)});});}catch(_0x59b9e7){console['log'](_0x59b9e7);}}),router[a0_0x3d7845(0x2db)](a0_0x3d7845(0x2a5),auth,async(_0x58ec15,_0x1a3167)=>{var _0x17f1cc=a0_0x3d7845;try{const {username:_0x75e58,email:_0x5c7047,role:_0xf32aec}=_0x58ec15[_0x17f1cc(0x2da)],_0x20e39d=_0x58ec15['user'],_0x10599d=await profile[_0x17f1cc(0x290)]({'email':_0x20e39d[_0x17f1cc(0x2f7)]}),_0x53733e=await master_shop[_0x17f1cc(0x202)](),_0x536df7=_0x58ec15['params']['id'],_0x4ed405=await purchases[_0x17f1cc(0x236)](_0x536df7),_0x290009=await warehouse[_0x17f1cc(0x289)]([{'$match':{'name':_0x4ed405['warehouse_name'],'room':_0x4ed405['room']}},{'$unwind':_0x17f1cc(0x26c)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x17f1cc(0x1f8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x17f1cc(0x2e5)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x17f1cc(0x1f7)},'secondary_code':{'$first':_0x17f1cc(0x2bd)},'product_code':{'$first':_0x17f1cc(0x1f2)},'storage':{'$first':_0x17f1cc(0x205)},'rack':{'$first':_0x17f1cc(0x204)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x388df3=await customer[_0x17f1cc(0x202)]({});let _0x140fe1;if(_0x20e39d[_0x17f1cc(0x1e6)]==_0x17f1cc(0x305)){const _0x3e66ec=await staff['findOne']({'email':_0x20e39d[_0x17f1cc(0x2f7)]});_0x140fe1=await warehouse[_0x17f1cc(0x289)]([{'$match':{'status':'Enabled','name':_0x3e66ec['warehouse']}},{'$group':{'_id':_0x17f1cc(0x203),'name':{'$first':'$name'}}}]);}else _0x140fe1=await warehouse[_0x17f1cc(0x289)]([{'$match':{'status':_0x17f1cc(0x2b2)}},{'$group':{'_id':_0x17f1cc(0x203),'name':{'$first':'$name'}}}]);const _0x2480e=await product[_0x17f1cc(0x202)]({}),_0x182457=await suppliers[_0x17f1cc(0x202)]({}),_0x3a1dcb=BayBinSelected(_0x4ed405['warehouse_name'],_0x4ed405[_0x17f1cc(0x211)]);if(_0x53733e[0x0][_0x17f1cc(0x2d6)]=='English\x20(US)'){var _0x4a539c=users[_0x17f1cc(0x1e4)];console[_0x17f1cc(0x294)](_0x4a539c);}else{if(_0x53733e[0x0][_0x17f1cc(0x2d6)]=='Hindi')var _0x4a539c=users[_0x17f1cc(0x1f1)];else{if(_0x53733e[0x0]['language']=='German')var _0x4a539c=users[_0x17f1cc(0x2fa)];else{if(_0x53733e[0x0][_0x17f1cc(0x2d6)]==_0x17f1cc(0x302))var _0x4a539c=users[_0x17f1cc(0x302)];else{if(_0x53733e[0x0]['language']==_0x17f1cc(0x20e))var _0x4a539c=users['French'];else{if(_0x53733e[0x0]['language']=='Portuguese\x20(BR)')var _0x4a539c=users[_0x17f1cc(0x2cf)];else{if(_0x53733e[0x0]['language']==_0x17f1cc(0x221))var _0x4a539c=users[_0x17f1cc(0x221)];else{if(_0x53733e[0x0][_0x17f1cc(0x2d6)]==_0x17f1cc(0x2b7))var _0x4a539c=users[_0x17f1cc(0x231)];}}}}}}}_0x1a3167['render']('edit_purchases_view',{'success':_0x58ec15[_0x17f1cc(0x2c6)](_0x17f1cc(0x21a)),'errors':_0x58ec15[_0x17f1cc(0x2c6)](_0x17f1cc(0x259)),'role':_0x20e39d,'profile':_0x10599d,'customer':_0x388df3,'warehouse':_0x140fe1,'product':_0x290009,'user':_0x4ed405,'master_shop':_0x53733e,'unit':_0x2480e,'language':_0x4a539c,'suppliers':_0x182457,'dataSelected':_0x3a1dcb});}catch(_0x68b2){console[_0x17f1cc(0x294)](_0x68b2);}}),router['post']('/preview/:id',auth,async(_0xd6e4b,_0x40443c)=>{var _0x1a8a79=a0_0x3d7845;try{const _0x6b75f1=_0xd6e4b[_0x1a8a79(0x1fe)]['id'],{invoice:_0x3eac8e,warehouse_name:_0xcac2e,Room_name:_0x223ca1}=_0xd6e4b[_0x1a8a79(0x260)],_0x166146=await warehouse[_0x1a8a79(0x290)]({'name':_0xcac2e,'room':_0x223ca1}),_0x416f37=await purchases[_0x1a8a79(0x290)]({'invoice':_0x3eac8e});_0x416f37[_0x1a8a79(0x2eb)][_0x1a8a79(0x20a)](_0x36f351=>{var _0x41016a=_0x1a8a79,_0x3e9964=0x0;const _0x220ae0=_0x166146[_0x41016a(0x239)][_0x41016a(0x232)](_0x4b6d41=>{var _0x5baef1=_0x41016a;_0x4b6d41[_0x5baef1(0x262)]==_0x36f351[_0x5baef1(0x262)]&&_0x4b6d41[_0x5baef1(0x299)]==_0x36f351[_0x5baef1(0x299)]&&_0x4b6d41['type']==_0x36f351[_0x5baef1(0x228)]&&_0x4b6d41[_0x5baef1(0x28d)]==_0x36f351[_0x5baef1(0x28d)]&&_0x4b6d41[_0x5baef1(0x2cb)]==_0x36f351[_0x5baef1(0x2cb)]&&_0x4b6d41[_0x5baef1(0x217)]==_0x36f351[_0x5baef1(0x217)]&&_0x4b6d41[_0x5baef1(0x21c)]==_0x36f351[_0x5baef1(0x21c)]&&_0x4b6d41[_0x5baef1(0x258)]==_0x36f351[_0x5baef1(0x258)]&&_0x4b6d41['batch_code']==_0x36f351['batch_code']&&_0x4b6d41[_0x5baef1(0x24e)]==_0x36f351['production_date']&&_0x4b6d41[_0x5baef1(0x216)]==_0x36f351['delivery_date']&&_0x4b6d41[_0x5baef1(0x28e)]==_0x36f351[_0x5baef1(0x28e)]&&(_0x4b6d41[_0x5baef1(0x29e)]=parseInt(_0x4b6d41[_0x5baef1(0x29e)])+parseInt(_0x36f351[_0x5baef1(0x2b3)]),_0x3e9964++);});_0x3e9964=='0'&&(_0x166146[_0x41016a(0x239)]=_0x166146[_0x41016a(0x239)][_0x41016a(0x20c)]({'product_name':_0x36f351['product_name'],'product_stock':_0x36f351[_0x41016a(0x2b3)],'primary_code':_0x36f351['primary_code'],'secondary_code':_0x36f351[_0x41016a(0x291)],'product_code':_0x36f351[_0x41016a(0x2e4)],'storage':_0x36f351[_0x41016a(0x21c)],'rack':_0x36f351[_0x41016a(0x217)],'bay':_0x36f351['bay'],'bin':_0x36f351[_0x41016a(0x28d)],'type':_0x36f351['type'],'floorlevel':_0x36f351[_0x41016a(0x299)],'maxProducts':_0x36f351[_0x41016a(0x234)],'unit':_0x36f351[_0x41016a(0x27e)],'secondary_unit':_0x36f351[_0x41016a(0x241)],'expiry_date':_0x36f351['expiry_date'],'maxPerUnit':_0x36f351['maxperunit'],'batch_code':_0x36f351[_0x41016a(0x20d)],'alertQTY':_0x36f351['alertQTY'],'production_date':_0x36f351[_0x41016a(0x24e)],'delivery_date':_0x36f351[_0x41016a(0x216)],'delivery_code':_0x36f351['delivery_code']}));}),await _0x166146[_0x1a8a79(0x2e0)](),_0x416f37[_0x1a8a79(0x26b)]=_0x1a8a79(0x21f);const _0x4d3e9d=await _0x416f37['save']();_0xd6e4b[_0x1a8a79(0x2c6)](_0x1a8a79(0x21a),_0x1a8a79(0x29b)),_0x40443c['redirect'](_0x1a8a79(0x215));}catch(_0x3e0f47){console[_0x1a8a79(0x294)](_0x3e0f47);}}),router[a0_0x3d7845(0x2db)](a0_0x3d7845(0x274),auth,async(_0x173443,_0x4c99c3)=>{var _0x4d3a46=a0_0x3d7845;try{const {username:_0x4dd753,email:_0x3b8b3e,role:_0x3e69ca}=_0x173443[_0x4d3a46(0x2da)],_0x1fbf1c=_0x173443[_0x4d3a46(0x2da)],_0x5b22dd=await profile[_0x4d3a46(0x290)]({'email':_0x1fbf1c[_0x4d3a46(0x2f7)]}),_0x525f07=await master_shop[_0x4d3a46(0x202)](),_0x2f3897=_0x173443[_0x4d3a46(0x1fe)]['id'],_0x2a4e78=await purchases['findById'](_0x2f3897),_0x3acb41=await suppliers[_0x4d3a46(0x202)]({});let _0x374771;if(_0x1fbf1c[_0x4d3a46(0x1e6)]==_0x4d3a46(0x305)){const _0xc8bb99=await staff['findOne']({'email':_0x1fbf1c['email']});_0x374771=await warehouse[_0x4d3a46(0x202)]({'status':_0x4d3a46(0x2b2),'name':_0xc8bb99[_0x4d3a46(0x21d)],'warehouse_category':_0x4d3a46(0x2c4)});}else _0x374771=await warehouse['aggregate']([{'$match':{'status':_0x4d3a46(0x2b2),'warehouse_category':_0x4d3a46(0x2c4)}},{'$group':{'_id':_0x4d3a46(0x203),'name':{'$first':_0x4d3a46(0x203)}}}]);const _0x3c4cb4=await product[_0x4d3a46(0x202)]({}),_0x61cfb8=BayBinSelected(_0x2a4e78['warehouse_name'],_0x2a4e78['room']);let _0x5382fe=new Date(_0x2a4e78['expiry_date']),_0x212c3b=('0'+_0x5382fe[_0x4d3a46(0x306)]())[_0x4d3a46(0x2d7)](-0x2),_0x252b01=('0'+(_0x5382fe[_0x4d3a46(0x282)]()+0x1))[_0x4d3a46(0x2d7)](-0x2),_0xa3a8e0=_0x5382fe[_0x4d3a46(0x220)](),_0x1b2e45=_0xa3a8e0+'-'+_0x252b01+'-'+_0x212c3b;if(_0x525f07[0x0][_0x4d3a46(0x2d6)]==_0x4d3a46(0x229)){var _0x519a05=users[_0x4d3a46(0x1e4)];console[_0x4d3a46(0x294)](_0x519a05);}else{if(_0x525f07[0x0]['language']==_0x4d3a46(0x1f1))var _0x519a05=users[_0x4d3a46(0x1f1)];else{if(_0x525f07[0x0][_0x4d3a46(0x2d6)]==_0x4d3a46(0x2fa))var _0x519a05=users[_0x4d3a46(0x2fa)];else{if(_0x525f07[0x0][_0x4d3a46(0x2d6)]=='Spanish')var _0x519a05=users[_0x4d3a46(0x302)];else{if(_0x525f07[0x0][_0x4d3a46(0x2d6)]=='French')var _0x519a05=users['French'];else{if(_0x525f07[0x0][_0x4d3a46(0x2d6)]==_0x4d3a46(0x273))var _0x519a05=users[_0x4d3a46(0x2cf)];else{if(_0x525f07[0x0][_0x4d3a46(0x2d6)]==_0x4d3a46(0x221))var _0x519a05=users['Chinese'];else{if(_0x525f07[0x0]['language']==_0x4d3a46(0x2b7))var _0x519a05=users[_0x4d3a46(0x231)];}}}}}}}_0x4c99c3[_0x4d3a46(0x277)]('edit_purchases',{'success':_0x173443[_0x4d3a46(0x2c6)](_0x4d3a46(0x21a)),'errors':_0x173443[_0x4d3a46(0x2c6)](_0x4d3a46(0x259)),'role':_0x1fbf1c,'profile':_0x5b22dd,'purchases':_0x2a4e78,'suppliers':_0x3acb41,'warehouse':_0x374771,'product':_0x3c4cb4,'master_shop':_0x525f07,'language':_0x519a05,'ed_fullDate':_0x1b2e45,'dataSelected':_0x61cfb8});}catch(_0x5dfb60){console[_0x4d3a46(0x294)](_0x5dfb60);}}),router[a0_0x3d7845(0x2ed)]('/view/:id',auth,async(_0x490019,_0x3adfde)=>{var _0x95cf0e=a0_0x3d7845;try{const _0x39d4e8=_0x490019[_0x95cf0e(0x1fe)]['id'],_0x1af5e2=await purchases[_0x95cf0e(0x290)]({'_id':_0x490019['params']['id']}),_0x4c700b=await warehouse[_0x95cf0e(0x290)]({'name':_0x1af5e2[_0x95cf0e(0x1e3)],'room':_0x1af5e2[_0x95cf0e(0x211)]});_0x1af5e2[_0x95cf0e(0x2eb)]['forEach'](_0x11b786=>{var _0x1ce480=_0x95cf0e;const _0xbdd481=_0x4c700b[_0x1ce480(0x239)][_0x1ce480(0x232)](_0x152d44=>{var _0x3fc51a=_0x1ce480;_0x152d44[_0x3fc51a(0x262)]==_0x11b786[_0x3fc51a(0x262)]&&_0x152d44['floorlevel']==_0x11b786[_0x3fc51a(0x299)]&&_0x152d44['type']==_0x11b786[_0x3fc51a(0x228)]&&_0x152d44[_0x3fc51a(0x28d)]==_0x11b786[_0x3fc51a(0x28d)]&&_0x152d44[_0x3fc51a(0x2cb)]==_0x11b786[_0x3fc51a(0x2cb)]&&_0x152d44[_0x3fc51a(0x217)]==_0x11b786[_0x3fc51a(0x217)]&&_0x152d44['storage']==_0x11b786['storage']&&(_0x152d44[_0x3fc51a(0x29e)]=parseInt(_0x152d44[_0x3fc51a(0x29e)])-parseInt(_0x11b786['quantity']));});}),await _0x4c700b[_0x95cf0e(0x2e0)]();const {invoice:_0x18e8ad,suppliers:_0x19e730,date:_0x314521,warehouse_name:_0x4339ad,prod_name:_0x2752ea,prod_code:_0x6f39cb,prod_qty:_0x2a8e98,prod_unit:_0x40271b,prod_secondunit:_0x506ac8,prod_level:_0x4ea920,prod_isle:_0xc80379,prod_pallet:_0x5165dd,note:_0x5818d9,expiry_date:_0x17ac02,batch_code:_0x3059aa,paid_amount:_0x9b2ef0,due_amount:_0x44093e,Room_name:_0x358169,primary_code:_0x581045,secondary_code:_0x47a601,PO_number:_0x2e256e,JO_number:_0x410add}=_0x490019['body'];if(typeof _0x2752ea==_0x95cf0e(0x1f4))var _0x323f49=[_0x490019['body'][_0x95cf0e(0x1ed)]],_0x1e22b9=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2e8)]],_0x56c2a6=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2a8)]],_0x222fe3=[_0x490019['body'][_0x95cf0e(0x2ff)]],_0x442a61=[_0x490019[_0x95cf0e(0x260)]['prod_secondunit']],_0x5df3d0=[_0x490019['body'][_0x95cf0e(0x2e7)]],_0x2fd794=[_0x490019['body'][_0x95cf0e(0x207)]],_0x67c04c=[_0x490019['body']['prod_pallet']],_0x54973e=[_0x490019[_0x95cf0e(0x260)]['primary_code']],_0x330187=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x291)]],_0x1857f0=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x242)]],_0x37ae9a=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x20d)]],_0x3a0ae5=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x258)]],_0x1ba47e=[_0x490019[_0x95cf0e(0x260)]['storage']],_0x2b5ede=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x1fc)]],_0x4b8975=[_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x228)]];else var _0x323f49=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x1ed)]],_0x1e22b9=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2e8)]],_0x56c2a6=[..._0x490019['body'][_0x95cf0e(0x2a8)]],_0x222fe3=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2ff)]],_0x442a61=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x264)]],_0x5df3d0=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2e7)]],_0x2fd794=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x207)]],_0x67c04c=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x26a)]],_0x54973e=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2b1)]],_0x330187=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x291)]],_0x1857f0=[..._0x490019['body'][_0x95cf0e(0x242)]],_0x37ae9a=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x20d)]],_0x3a0ae5=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x258)]],_0x1ba47e=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x21c)]],_0x2b5ede=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x1fc)]],_0x4b8975=[..._0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x228)]];const _0x38d66a=_0x323f49['map'](_0x33de7e=>{return _0x33de7e={'product_name':_0x33de7e};});_0x1e22b9['forEach']((_0x53df6a,_0x13c1a9)=>{var _0x3b00d0=_0x95cf0e;_0x38d66a[_0x13c1a9][_0x3b00d0(0x2e4)]=_0x53df6a;}),_0x56c2a6['forEach']((_0x4799af,_0x15350d)=>{_0x38d66a[_0x15350d]['quantity']=_0x4799af;}),_0x222fe3[_0x95cf0e(0x20a)]((_0x59243,_0x16b2d7)=>{var _0x4edad7=_0x95cf0e;_0x38d66a[_0x16b2d7][_0x4edad7(0x27e)]=_0x59243;}),_0x442a61[_0x95cf0e(0x20a)]((_0x413539,_0x27ba51)=>{var _0xb72a3f=_0x95cf0e;_0x38d66a[_0x27ba51][_0xb72a3f(0x241)]=_0x413539;}),_0x5df3d0[_0x95cf0e(0x20a)]((_0x36e6ad,_0x515daf)=>{_0x38d66a[_0x515daf]['bay']=_0x36e6ad;}),_0x2fd794[_0x95cf0e(0x20a)]((_0x42328e,_0x227342)=>{_0x38d66a[_0x227342]['bin']=_0x42328e;}),_0x67c04c[_0x95cf0e(0x20a)]((_0x416904,_0x17e519)=>{var _0x49aa31=_0x95cf0e;_0x38d66a[_0x17e519][_0x49aa31(0x299)]=_0x416904;}),_0x54973e['forEach']((_0x3cfe09,_0x5085ce)=>{var _0x25030c=_0x95cf0e;_0x38d66a[_0x5085ce][_0x25030c(0x2b1)]=_0x3cfe09;}),_0x330187['forEach']((_0xf473fd,_0x550798)=>{var _0xf63cec=_0x95cf0e;_0x38d66a[_0x550798][_0xf63cec(0x291)]=_0xf473fd;}),_0x1857f0['forEach']((_0x282eee,_0x352802)=>{_0x38d66a[_0x352802]['maxStocks']=_0x282eee;}),_0x37ae9a[_0x95cf0e(0x20a)]((_0x30b8b4,_0x51a922)=>{var _0x7fb71b=_0x95cf0e;_0x38d66a[_0x51a922][_0x7fb71b(0x20d)]=_0x30b8b4;}),_0x3a0ae5[_0x95cf0e(0x20a)]((_0x188840,_0x57883c)=>{_0x38d66a[_0x57883c]['expiry_date']=_0x188840;}),_0x4b8975[_0x95cf0e(0x20a)]((_0x4631c9,_0x124dc6)=>{var _0x5d3440=_0x95cf0e;_0x38d66a[_0x124dc6][_0x5d3440(0x228)]=_0x4631c9;}),_0x1ba47e[_0x95cf0e(0x20a)]((_0x4df360,_0x2a8413)=>{var _0x41fa1f=_0x95cf0e;_0x38d66a[_0x2a8413][_0x41fa1f(0x21c)]=_0x4df360;}),_0x2b5ede[_0x95cf0e(0x20a)]((_0x2342dd,_0x29a6d4)=>{var _0x52afcd=_0x95cf0e;_0x38d66a[_0x29a6d4][_0x52afcd(0x217)]=_0x2342dd;});const _0x345af2=_0x38d66a['filter'](_0x247e81=>_0x247e81[_0x95cf0e(0x2b3)]!=='0'&&_0x247e81[_0x95cf0e(0x2b3)]!=='');_0x1af5e2[_0x95cf0e(0x2ad)]=_0x18e8ad,_0x1af5e2['suppliers']=_0x19e730,_0x1af5e2['date']=_0x314521,_0x1af5e2['warehouse_name']=_0x4339ad,_0x1af5e2[_0x95cf0e(0x2eb)]=_0x345af2,_0x1af5e2[_0x95cf0e(0x208)]=_0x5818d9,_0x1af5e2['paid_amount']=_0x9b2ef0,_0x1af5e2[_0x95cf0e(0x266)]=_0x44093e,_0x1af5e2[_0x95cf0e(0x211)]=_0x358169,_0x1af5e2[_0x95cf0e(0x307)]=_0x2e256e,_0x1af5e2[_0x95cf0e(0x2ba)]=_0x410add;const _0x4ce1ce=await _0x1af5e2[_0x95cf0e(0x2e0)](),_0x2b07ef=await warehouse[_0x95cf0e(0x290)]({'name':_0x490019['body'][_0x95cf0e(0x1e3)],'room':_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2df)]});_0x1af5e2[_0x95cf0e(0x2eb)][_0x95cf0e(0x20a)](_0x4e7cd3=>{var _0x1028e5=_0x95cf0e,_0x37cfdd=0x0;const _0x1cc27e=_0x2b07ef[_0x1028e5(0x239)][_0x1028e5(0x232)](_0x396d94=>{var _0x5683ed=_0x1028e5;_0x396d94[_0x5683ed(0x262)]==_0x4e7cd3[_0x5683ed(0x262)]&&_0x396d94[_0x5683ed(0x299)]==_0x4e7cd3['floorlevel']&&_0x396d94[_0x5683ed(0x228)]==_0x4e7cd3[_0x5683ed(0x228)]&&_0x396d94[_0x5683ed(0x28d)]==_0x4e7cd3[_0x5683ed(0x28d)]&&_0x396d94[_0x5683ed(0x2cb)]==_0x4e7cd3[_0x5683ed(0x2cb)]&&_0x396d94['rack']==_0x4e7cd3[_0x5683ed(0x217)]&&_0x396d94[_0x5683ed(0x21c)]==_0x4e7cd3[_0x5683ed(0x21c)]&&(_0x396d94[_0x5683ed(0x29e)]=parseInt(_0x396d94[_0x5683ed(0x29e)])+parseInt(_0x4e7cd3[_0x5683ed(0x2b3)]),_0x37cfdd++);});_0x37cfdd=='0'&&(_0x2b07ef[_0x1028e5(0x239)]=_0x2b07ef[_0x1028e5(0x239)][_0x1028e5(0x20c)]({'product_name':_0x4e7cd3[_0x1028e5(0x262)],'product_stock':_0x4e7cd3[_0x1028e5(0x2b3)],'primary_code':_0x4e7cd3[_0x1028e5(0x2b1)],'secondary_code':_0x4e7cd3[_0x1028e5(0x291)],'product_code':_0x4e7cd3[_0x1028e5(0x2e4)],'storage':_0x4e7cd3[_0x1028e5(0x21c)],'rack':_0x4e7cd3[_0x1028e5(0x217)],'bay':_0x4e7cd3[_0x1028e5(0x2cb)],'bin':_0x4e7cd3[_0x1028e5(0x28d)],'type':_0x4e7cd3[_0x1028e5(0x228)],'floorlevel':_0x4e7cd3[_0x1028e5(0x299)],'maxProducts':_0x4e7cd3['maxStocks'],'unit':_0x4e7cd3[_0x1028e5(0x27e)],'secondary_unit':_0x4e7cd3[_0x1028e5(0x241)],'expiry_date':_0x4e7cd3[_0x1028e5(0x258)]}));}),await _0x2b07ef[_0x95cf0e(0x2e0)]();const _0x327e9c=await s_payment_data[_0x95cf0e(0x290)]({'invoice':_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2ad)]});if(_0x327e9c===null){}else console[_0x95cf0e(0x294)](_0x95cf0e(0x285),_0x327e9c,_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x2ad)]),_0x327e9c['suppliers']=_0x490019[_0x95cf0e(0x260)][_0x95cf0e(0x285)],await _0x327e9c[_0x95cf0e(0x2e0)]();_0x490019[_0x95cf0e(0x2c6)](_0x95cf0e(0x21a),_0x95cf0e(0x2a6)),_0x3adfde[_0x95cf0e(0x2de)]('/all_purchases/view');}catch(_0x4d3e4a){console[_0x95cf0e(0x294)](_0x4d3e4a);}}),router[a0_0x3d7845(0x2ed)](a0_0x3d7845(0x2d1),auth,async(_0x463a2e,_0x23c3eb)=>{var _0x4e8a05=a0_0x3d7845;try{const _0x24a939=_0x463a2e[_0x4e8a05(0x1fe)]['id'],{invoice:_0x15fa42,suppliers:_0x8f83f4,payable:_0x459072,due_amount:_0x75b995}=_0x463a2e[_0x4e8a05(0x260)],_0x9daefc=await purchases[_0x4e8a05(0x236)](_0x24a939);var _0x52c077=_0x459072-_0x75b995;_0x9daefc[_0x4e8a05(0x2d5)]=parseFloat(_0x9daefc[_0x4e8a05(0x2d5)])+parseFloat(_0x75b995),_0x9daefc[_0x4e8a05(0x266)]=_0x52c077;const _0x173f82=await _0x9daefc['save']();console[_0x4e8a05(0x294)](_0x173f82);const _0x2e527c=await s_payment_data[_0x4e8a05(0x290)]({'invoice':_0x15fa42});_0x2e527c[_0x4e8a05(0x2c8)]=_0x52c077,await _0x2e527c['save']();let _0xf81051=new Date(),_0x5bca4=('0'+_0xf81051[_0x4e8a05(0x306)]())[_0x4e8a05(0x2d7)](-0x2),_0x6235fb=('0'+(_0xf81051[_0x4e8a05(0x282)]()+0x1))[_0x4e8a05(0x2d7)](-0x2),_0x53a7d4=_0xf81051[_0x4e8a05(0x220)](),_0x3e8f78=_0x53a7d4+'-'+_0x6235fb+'-'+_0x5bca4;const _0x2aa281=new suppliers_payment({'invoice':_0x15fa42,'date':_0x53a7d4+'-'+_0x6235fb+'-'+_0x5bca4,'suppliers':_0x8f83f4,'reason':_0x4e8a05(0x292),'amount':_0x75b995}),_0x5bec23=await _0x2aa281[_0x4e8a05(0x2e0)]();_0x463a2e[_0x4e8a05(0x2c6)]('success',_0x4e8a05(0x23f)),_0x23c3eb[_0x4e8a05(0x2de)](_0x4e8a05(0x215));}catch(_0x390e49){console[_0x4e8a05(0x294)](_0x390e49);}}),router[a0_0x3d7845(0x2db)](a0_0x3d7845(0x1fb),auth,async(_0x491b5f,_0x213e48)=>{var _0xec0a69=a0_0x3d7845;try{const {username:_0x1a0ee4,email:_0x3cbafd,role:_0x30207b}=_0x491b5f[_0xec0a69(0x2da)],_0x50eaef=_0x491b5f[_0xec0a69(0x2da)],_0x4fcd0e=await profile[_0xec0a69(0x290)]({'email':_0x50eaef[_0xec0a69(0x2f7)]}),_0x2a9820=await master_shop[_0xec0a69(0x202)]();console[_0xec0a69(0x294)](_0xec0a69(0x295),_0x2a9820);const _0x3f0a64=_0x491b5f[_0xec0a69(0x1fe)]['id'],_0x1f46a6=await purchases['findById'](_0x3f0a64);console[_0xec0a69(0x294)](_0x1f46a6);const _0x34802d=await suppliers[_0xec0a69(0x290)]({'name':_0x1f46a6[_0xec0a69(0x285)]});console[_0xec0a69(0x294)](_0x34802d);if(_0x2a9820[0x0][_0xec0a69(0x2d6)]==_0xec0a69(0x229)){var _0x3444e4=users[_0xec0a69(0x1e4)];console[_0xec0a69(0x294)](_0x3444e4);}else{if(_0x2a9820[0x0][_0xec0a69(0x2d6)]=='Hindi')var _0x3444e4=users[_0xec0a69(0x1f1)];else{if(_0x2a9820[0x0]['language']==_0xec0a69(0x2fa))var _0x3444e4=users[_0xec0a69(0x2fa)];else{if(_0x2a9820[0x0][_0xec0a69(0x2d6)]=='Spanish')var _0x3444e4=users[_0xec0a69(0x302)];else{if(_0x2a9820[0x0][_0xec0a69(0x2d6)]=='French')var _0x3444e4=users[_0xec0a69(0x20e)];else{if(_0x2a9820[0x0]['language']==_0xec0a69(0x273))var _0x3444e4=users[_0xec0a69(0x2cf)];else{if(_0x2a9820[0x0][_0xec0a69(0x2d6)]==_0xec0a69(0x221))var _0x3444e4=users[_0xec0a69(0x221)];else{if(_0x2a9820[0x0][_0xec0a69(0x2d6)]=='Arabic\x20(ae)')var _0x3444e4=users[_0xec0a69(0x231)];}}}}}}}_0x213e48[_0xec0a69(0x277)]('purchase_invoice',{'success':_0x491b5f[_0xec0a69(0x2c6)](_0xec0a69(0x21a)),'errors':_0x491b5f[_0xec0a69(0x2c6)](_0xec0a69(0x259)),'role':_0x50eaef,'profile':_0x4fcd0e,'master_shop':_0x2a9820,'supplier':_0x34802d,'purchase':_0x1f46a6,'language':_0x3444e4});}catch(_0x21d11c){console['log'](_0x21d11c);}}),router[a0_0x3d7845(0x2db)](a0_0x3d7845(0x270),auth,async(_0xa54920,_0x4fa871)=>{var _0xdadddf=a0_0x3d7845;try{const {username:_0x2e16b1,email:_0x46188e,role:_0x33182c}=_0xa54920['user'],_0x1c57ca=_0xa54920[_0xdadddf(0x2da)],_0x3ef8e2=await profile[_0xdadddf(0x290)]({'email':_0x1c57ca[_0xdadddf(0x2f7)]}),_0xafb43d=await master_shop[_0xdadddf(0x202)]();console[_0xdadddf(0x294)]('master',_0xafb43d);const _0x416e05=_0xa54920[_0xdadddf(0x1fe)]['id'];console[_0xdadddf(0x294)](_0x416e05);const _0x4be24d=await purchases[_0xdadddf(0x236)](_0x416e05);console[_0xdadddf(0x294)](_0xdadddf(0x287),_0x4be24d);const _0x17333e=await product[_0xdadddf(0x202)]({}),_0x9b75c7=await warehouse[_0xdadddf(0x289)]([{'$match':{'name':_0x4be24d[_0xdadddf(0x1e3)],'room':_0x4be24d[_0xdadddf(0x211)],'warehouse_category':_0xdadddf(0x2c4)}},{'$unwind':'$product_details'},{'$group':{'_id':_0xdadddf(0x286),'name':{'$first':_0xdadddf(0x1f8)},'product_stock':{'$first':_0xdadddf(0x25f)},'bay':{'$first':_0xdadddf(0x2e5)},'bin':{'$first':_0xdadddf(0x300)},'type':{'$first':_0xdadddf(0x20f)},'floorlevel':{'$first':_0xdadddf(0x245)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xdadddf(0x2bd)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0xdadddf(0x205)},'rack':{'$first':_0xdadddf(0x204)}}}]);warehouse_data=await warehouse[_0xdadddf(0x289)]([{'$match':{'status':_0xdadddf(0x2b2),'name':_0xdadddf(0x2b4),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0xdadddf(0x203),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0xdadddf(0x294)]('stock_data',_0x9b75c7);if(_0xafb43d[0x0]['language']==_0xdadddf(0x229)){var _0x4458aa=users[_0xdadddf(0x1e4)];console[_0xdadddf(0x294)](_0x4458aa);}else{if(_0xafb43d[0x0][_0xdadddf(0x2d6)]==_0xdadddf(0x1f1))var _0x4458aa=users[_0xdadddf(0x1f1)];else{if(_0xafb43d[0x0][_0xdadddf(0x2d6)]=='German')var _0x4458aa=users[_0xdadddf(0x2fa)];else{if(_0xafb43d[0x0]['language']==_0xdadddf(0x302))var _0x4458aa=users[_0xdadddf(0x302)];else{if(_0xafb43d[0x0]['language']=='French')var _0x4458aa=users[_0xdadddf(0x20e)];else{if(_0xafb43d[0x0][_0xdadddf(0x2d6)]==_0xdadddf(0x273))var _0x4458aa=users['Portuguese'];else{if(_0xafb43d[0x0][_0xdadddf(0x2d6)]==_0xdadddf(0x221))var _0x4458aa=users[_0xdadddf(0x221)];else{if(_0xafb43d[0x0]['language']==_0xdadddf(0x2b7))var _0x4458aa=users[_0xdadddf(0x231)];}}}}}}}_0x4fa871[_0xdadddf(0x277)](_0xdadddf(0x2e2),{'success':_0xa54920[_0xdadddf(0x2c6)](_0xdadddf(0x21a)),'errors':_0xa54920[_0xdadddf(0x2c6)]('errors'),'role':_0x1c57ca,'profile':_0x3ef8e2,'user':_0x4be24d,'stock':_0x9b75c7,'master_shop':_0xafb43d,'product':_0x17333e,'language':_0x4458aa,'warehouse':warehouse_data});}catch(_0x3e72db){console[_0xdadddf(0x294)](_0x3e72db);}}),router[a0_0x3d7845(0x2ed)](a0_0x3d7845(0x270),auth,async(_0x5bfc54,_0xbff7da)=>{var _0x2b8c48=a0_0x3d7845;try{const {invoice:_0x2455b3,date:_0x2715c4,warehouse_name:_0x1383b2,Room_name:_0x38d248,product_name:_0x133fd7,purchase_quantity:_0x3045f0,stocks:_0x10fe1f,return_qty:_0x55a576,note:_0x2ceeb0,level:_0x50e0d3,isle:_0x348db9,pallet:_0x14f6cd,to_warehouse_name:_0x145efb,to_Room_name:_0x4af3a1}=_0x5bfc54[_0x2b8c48(0x260)],_0x5eec38=await purchases['findOne']({'_id':_0x5bfc54[_0x2b8c48(0x1fe)]['id']}),_0x84a100=await warehouse[_0x2b8c48(0x290)]({'name':_0x1383b2,'room':_0x38d248});if(typeof _0x133fd7==_0x2b8c48(0x1f4))var _0x5e109d=[_0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x262)]],_0x421bc0=[_0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x28f)]],_0x13e8ed=[_0x5bfc54['body'][_0x2b8c48(0x1fa)]],_0x319122=[_0x5bfc54[_0x2b8c48(0x260)]['return_qty']],_0x1b9cb9=[_0x5bfc54[_0x2b8c48(0x260)]['level']],_0x2b238f=[_0x5bfc54[_0x2b8c48(0x260)]['isle']],_0x4e387c=[_0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x27c)]],_0x502cba=[_0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x223)]],_0xda1f1f=[_0x5bfc54['body'][_0x2b8c48(0x2b6)]],_0x3ff158=[_0x5bfc54['body']['primary_code_hide']],_0x5c0b01=[_0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x2ee)]];else var _0x5e109d=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x262)]],_0x421bc0=[..._0x5bfc54['body']['purchase_quantity']],_0x13e8ed=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x1fa)]],_0x319122=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x2d2)]],_0x1b9cb9=[..._0x5bfc54['body'][_0x2b8c48(0x1e8)]],_0x2b238f=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x2fb)]],_0x4e387c=[..._0x5bfc54['body'][_0x2b8c48(0x27c)]],_0x502cba=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x223)]],_0xda1f1f=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x2b6)]],_0x3ff158=[..._0x5bfc54['body']['primary_code_hide']],_0x5c0b01=[..._0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x2ee)]];const _0x1886ce=_0x5e109d['map'](_0x4da8bb=>{return _0x4da8bb={'product_name':_0x4da8bb};});_0x421bc0[_0x2b8c48(0x20a)]((_0x489a79,_0x5b7143)=>{_0x1886ce[_0x5b7143]['purchase_quantity']=_0x489a79;}),_0x13e8ed['forEach']((_0xf711d7,_0x4c8cc6)=>{_0x1886ce[_0x4c8cc6]['stock_quantity']=_0xf711d7;}),_0x319122['forEach']((_0xea1848,_0x30bd30)=>{var _0x3ac44b=_0x2b8c48;_0x1886ce[_0x30bd30][_0x3ac44b(0x2d2)]=_0xea1848;}),_0x1b9cb9[_0x2b8c48(0x20a)]((_0x39408c,_0x3f99e8)=>{var _0x3f100c=_0x2b8c48;_0x1886ce[_0x3f99e8][_0x3f100c(0x2cb)]=_0x39408c;}),_0x2b238f['forEach']((_0x353bfd,_0x2b4f27)=>{_0x1886ce[_0x2b4f27]['bin']=_0x353bfd;}),_0x4e387c[_0x2b8c48(0x20a)]((_0x1434e3,_0x249152)=>{_0x1886ce[_0x249152]['floorlevel']=_0x1434e3;}),_0x502cba[_0x2b8c48(0x20a)]((_0x28eb1e,_0x41adf0)=>{var _0x2f620e=_0x2b8c48;_0x1886ce[_0x41adf0][_0x2f620e(0x228)]=_0x28eb1e;}),_0xda1f1f[_0x2b8c48(0x20a)]((_0x64b1aa,_0x7cd291)=>{_0x1886ce[_0x7cd291]['product_code']=_0x64b1aa;}),_0x3ff158[_0x2b8c48(0x20a)]((_0x505e7d,_0x452176)=>{var _0x1431fa=_0x2b8c48;_0x1886ce[_0x452176][_0x1431fa(0x2b1)]=_0x505e7d;}),_0x5c0b01[_0x2b8c48(0x20a)]((_0x59210c,_0x534dcc)=>{var _0x3ff9a8=_0x2b8c48;_0x1886ce[_0x534dcc][_0x3ff9a8(0x291)]=_0x59210c;}),_0x5eec38[_0x2b8c48(0x2eb)][_0x2b8c48(0x20a)](_0xf3b8a7=>{var _0x32a137=_0x2b8c48;const _0x5eae43=_0x84a100[_0x32a137(0x239)][_0x32a137(0x232)](_0x21270f=>{var _0x29c863=_0x32a137;_0x21270f['product_name']==_0xf3b8a7[_0x29c863(0x262)]&&_0x21270f[_0x29c863(0x299)]==_0xf3b8a7[_0x29c863(0x299)]&&_0x21270f[_0x29c863(0x228)]==_0xf3b8a7[_0x29c863(0x228)]&&_0x21270f[_0x29c863(0x28d)]==_0xf3b8a7[_0x29c863(0x28d)]&&_0x21270f[_0x29c863(0x2cb)]==_0xf3b8a7[_0x29c863(0x2cb)]&&_0x21270f['rack']==_0xf3b8a7['rack']&&_0x21270f[_0x29c863(0x21c)]==_0xf3b8a7[_0x29c863(0x21c)]&&(console['log'](parseInt(_0x21270f[_0x29c863(0x29e)])+_0x29c863(0x2ac)+parseInt(_0xf3b8a7['quantity'])),_0x21270f[_0x29c863(0x29e)]=parseInt(_0x21270f[_0x29c863(0x29e)])+parseInt(_0xf3b8a7[_0x29c863(0x2b3)]));});}),await _0x84a100[_0x2b8c48(0x2e0)]();const _0x3a339f=_0x1886ce[_0x2b8c48(0x2d8)](_0x3a4760=>_0x3a4760[_0x2b8c48(0x2d2)]!=='0'&&_0x3a4760[_0x2b8c48(0x2d2)]!=='');var _0x316dc2=0x0;_0x3a339f[_0x2b8c48(0x20a)](_0x28910f=>{var _0x40d548=_0x2b8c48;console[_0x40d548(0x294)]('foreach\x20newproduct',_0x28910f),(parseInt(_0x28910f[_0x40d548(0x28f)])<parseInt(_0x28910f[_0x40d548(0x2d2)])||parseInt(_0x28910f[_0x40d548(0x28b)])<parseInt(_0x28910f[_0x40d548(0x2d2)]))&&_0x316dc2++;});if(_0x316dc2!=0x0)return _0x5bfc54['flash']('errors',_0x2b8c48(0x252)),_0xbff7da[_0x2b8c48(0x2de)](_0x2b8c48(0x2b5));const _0x5afda8=new purchases_return({'invoice':_0x2455b3,'suppliers':_0x5bfc54[_0x2b8c48(0x260)][_0x2b8c48(0x285)],'date':_0x2715c4,'warehouse_name':_0x1383b2,'return_product':_0x3a339f,'note':_0x2ceeb0,'room':_0x38d248,'to_warehouse_name':_0x145efb,'to_room':_0x4af3a1}),_0x34357e=await _0x5afda8['save']();console[_0x2b8c48(0x294)](_0x5afda8);const _0x1c6321=await purchases_return[_0x2b8c48(0x290)]({'invoice':_0x2455b3}),_0x4a77bc=await warehouse['findOne']({'name':_0x145efb,'room':_0x4af3a1});_0x1c6321[_0x2b8c48(0x22c)][_0x2b8c48(0x20a)](_0x4a3b73=>{var _0x57b4d6=_0x2b8c48,_0x5af98d=0x0;const _0x50df78=_0x4a77bc['product_details'][_0x57b4d6(0x232)](_0x21d2b9=>{var _0x1eeb83=_0x57b4d6;_0x21d2b9[_0x1eeb83(0x262)]==_0x4a3b73[_0x1eeb83(0x262)]&&_0x21d2b9[_0x1eeb83(0x299)]==_0x4a3b73[_0x1eeb83(0x299)]&&_0x21d2b9[_0x1eeb83(0x228)]==_0x4a3b73[_0x1eeb83(0x228)]&&_0x21d2b9[_0x1eeb83(0x28d)]==_0x4a3b73['bin']&&_0x21d2b9['bay']==_0x4a3b73[_0x1eeb83(0x2cb)]&&(_0x21d2b9[_0x1eeb83(0x29e)]=parseInt(_0x21d2b9['product_stock'])-parseInt(_0x4a3b73[_0x1eeb83(0x2d2)]),_0x5af98d++);});_0x5af98d=='0'&&(_0x4a77bc[_0x57b4d6(0x239)]=_0x4a77bc[_0x57b4d6(0x239)][_0x57b4d6(0x20c)]({'product_name':_0x4a3b73[_0x57b4d6(0x262)],'product_stock':_0x4a3b73['return_qty'],'primary_code':_0x4a3b73[_0x57b4d6(0x2b1)],'secondary_code':_0x4a3b73[_0x57b4d6(0x291)],'product_code':_0x4a3b73[_0x57b4d6(0x2e4)],'storage':_0x4a3b73['storage'],'rack':_0x4a3b73[_0x57b4d6(0x217)],'bay':_0x4a3b73[_0x57b4d6(0x2cb)],'bin':_0x4a3b73[_0x57b4d6(0x28d)],'type':_0x4a3b73[_0x57b4d6(0x228)],'floorlevel':_0x4a3b73['floorlevel'],'maxProducts':_0x4a3b73['maxStocks'],'unit':_0x4a3b73[_0x57b4d6(0x27e)],'secondary_unit':_0x4a3b73[_0x57b4d6(0x241)],'expiry_date':_0x4a3b73[_0x57b4d6(0x258)]}));}),await _0x4a77bc[_0x2b8c48(0x2e0)]();const _0x519393=await purchases[_0x2b8c48(0x290)]({'invoice':_0x2455b3});_0x519393[_0x2b8c48(0x2f0)]=_0x2b8c48(0x21f);const _0x24f279=await _0x519393[_0x2b8c48(0x2e0)](),_0x2771fc=new s_payment_data({'invoice':_0x2455b3,'suppliers':_0x5bfc54[_0x2b8c48(0x260)]['suppliers'],'reason':_0x2b8c48(0x279)});await _0x2771fc[_0x2b8c48(0x2e0)]();const _0x3f7580=await master_shop[_0x2b8c48(0x202)]();console[_0x2b8c48(0x294)](_0x2b8c48(0x267),_0x3f7580[0x0][_0x2b8c48(0x1f0)]);const _0xc205a6=await email_settings[_0x2b8c48(0x290)](),_0x2a2b35=await suppliers[_0x2b8c48(0x290)]({'name':_0x5bfc54[_0x2b8c48(0x260)]['suppliers']});console[_0x2b8c48(0x294)]('suppliers_data',_0x2a2b35);_0x3f7580[0x0][_0x2b8c48(0x2d3)]==0x1?(right_currency=_0x3f7580[0x0][_0x2b8c48(0x2e3)],left_currency=''):(right_currency='',left_currency=_0x3f7580[0x0][_0x2b8c48(0x2e3)]);var _0x4147de=_0x5e109d,_0x3a1321=_0x319122,_0x146f71='',_0x23b5de;for(_0x23b5de in _0x4147de){_0x146f71+=_0x2b8c48(0x25e)+_0x2b8c48(0x253)+_0x4147de[_0x23b5de]+_0x2b8c48(0x2fd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3a1321[_0x23b5de]+_0x2b8c48(0x2fd)+_0x2b8c48(0x296);}console[_0x2b8c48(0x294)](_0x2b8c48(0x2d0),_0x146f71);let _0x3efbfe=nodemailer[_0x2b8c48(0x2c7)]({'service':_0x2b8c48(0x269),'auth':{'user':_0xc205a6[_0x2b8c48(0x2f7)],'pass':_0xc205a6[_0x2b8c48(0x284)]}}),_0x36ffe1={'from':_0xc205a6[_0x2b8c48(0x2f7)],'to':_0x2a2b35[_0x2b8c48(0x2f7)],'subject':_0x2b8c48(0x1ec),'attachments':[{'filename':_0x2b8c48(0x21e),'path':__dirname+'/../public'+_0x2b8c48(0x271)+_0x3f7580[0x0][_0x2b8c48(0x1f0)],'cid':_0x2b8c48(0x225)}],'html':_0x2b8c48(0x2cc)+'<html><head><title></title>'+_0x2b8c48(0x288)+_0x2b8c48(0x1e5)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x2b8c48(0x1e5)+_0x2b8c48(0x2ef)+_0x2b8c48(0x2c1)+_0x2b8c48(0x1e5)+_0x2b8c48(0x301)+_0x3f7580[0x0]['site_title']+_0x2b8c48(0x2f5)+'</div>'+_0x2b8c48(0x2c1)+_0x2b8c48(0x2a2)+_0x2b8c48(0x1e5)+_0x2b8c48(0x275)+_0x2b8c48(0x247)+_0x2455b3+'\x20'+_0x2b8c48(0x281)+_0x2b8c48(0x2fc)+_0x2715c4+'\x20'+_0x2b8c48(0x2af)+_0x2b8c48(0x2f8)+_0x2b8c48(0x2c1)+_0x2b8c48(0x1eb)+_0x2b8c48(0x2c3)+_0x2b8c48(0x25e)+_0x2b8c48(0x227)+_0x2b8c48(0x27a)+_0x2b8c48(0x2c2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x2b8c48(0x2f1)+_0x2b8c48(0x276)+'\x20'+_0x146f71+'\x20'+'</tbody>'+_0x2b8c48(0x272)+_0x2b8c48(0x1e5)+_0x2b8c48(0x2bb)+_0x2b8c48(0x1e9)+_0x3f7580[0x0]['site_title']+_0x2b8c48(0x2f8)+_0x2b8c48(0x2c1)+_0x2b8c48(0x2c1)+_0x2b8c48(0x28a)};_0x3efbfe[_0x2b8c48(0x2ae)](_0x36ffe1,function(_0x48f30d,_0x254002){var _0x239080=_0x2b8c48;_0x48f30d?(console[_0x239080(0x294)](_0x48f30d),console[_0x239080(0x294)](_0x239080(0x233))):console['log'](_0x239080(0x29d));}),_0x5bfc54[_0x2b8c48(0x2c6)]('success',_0x2b8c48(0x23e)),_0xbff7da[_0x2b8c48(0x2de)](_0x2b8c48(0x215));}catch(_0x4c1866){console['log'](_0x4c1866),_0xbff7da[_0x2b8c48(0x248)](0xc8)[_0x2b8c48(0x230)]({'message':_0x4c1866[_0x2b8c48(0x246)]});}}),router[a0_0x3d7845(0x2db)](a0_0x3d7845(0x2a4),auth,async(_0x4b2156,_0x205255)=>{var _0x58af1c=a0_0x3d7845;try{const {username:_0x487e99,email:_0x366417,role:_0x4892e4}=_0x4b2156[_0x58af1c(0x2da)],_0x217336=_0x4b2156[_0x58af1c(0x2da)],_0x2be9e6=await profile['findOne']({'email':_0x217336[_0x58af1c(0x2f7)]}),_0x54e7e0=await master_shop['find'](),_0x4c2164=_0x4b2156[_0x58af1c(0x1fe)]['id'],_0x3011cd=await purchases['findById'](_0x4c2164);if(_0x54e7e0[0x0]['language']==_0x58af1c(0x229))var _0x174ac1=users[_0x58af1c(0x1e4)];else{if(_0x54e7e0[0x0]['language']=='Hindi')var _0x174ac1=users[_0x58af1c(0x1f1)];else{if(_0x54e7e0[0x0][_0x58af1c(0x2d6)]=='German')var _0x174ac1=users['German'];else{if(_0x54e7e0[0x0][_0x58af1c(0x2d6)]=='Spanish')var _0x174ac1=users[_0x58af1c(0x302)];else{if(_0x54e7e0[0x0][_0x58af1c(0x2d6)]==_0x58af1c(0x20e))var _0x174ac1=users[_0x58af1c(0x20e)];else{if(_0x54e7e0[0x0][_0x58af1c(0x2d6)]==_0x58af1c(0x273))var _0x174ac1=users['Portuguese'];else{if(_0x54e7e0[0x0][_0x58af1c(0x2d6)]==_0x58af1c(0x221))var _0x174ac1=users['Chinese'];else{if(_0x54e7e0[0x0][_0x58af1c(0x2d6)]==_0x58af1c(0x2b7))var _0x174ac1=users[_0x58af1c(0x231)];}}}}}}}_0x205255[_0x58af1c(0x277)]('all_purchases_barcode',{'success':_0x4b2156[_0x58af1c(0x2c6)](_0x58af1c(0x21a)),'errors':_0x4b2156[_0x58af1c(0x2c6)](_0x58af1c(0x259)),'role':_0x217336,'profile':_0x2be9e6,'alldata':_0x3011cd,'master_shop':_0x54e7e0,'language':_0x174ac1}),console[_0x58af1c(0x294)](alldata);}catch(_0x1eee4f){console[_0x58af1c(0x294)](_0x1eee4f);}}),router[a0_0x3d7845(0x2ed)](a0_0x3d7845(0x243),async(_0xad8b20,_0x4b3319)=>{var _0x332059=a0_0x3d7845;const {product_code:_0x415a93}=_0xad8b20[_0x332059(0x260)];var _0x3a5e26;const _0x46eef7=await product[_0x332059(0x289)]([{'$match':{'primary_code':_0x415a93,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x332059(0x298),'name':{'$first':_0x332059(0x203)},'category':{'$first':_0x332059(0x2ec)},'brand':{'$first':_0x332059(0x27f)},'unit':{'$first':_0x332059(0x293)},'alertquantity':{'$first':_0x332059(0x25a)},'product_code':{'$first':_0x332059(0x1e7)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x332059(0x2bc)},'maxStocks':{'$first':_0x332059(0x278)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x332059(0x257)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x44d20f=await product[_0x332059(0x289)]([{'$match':{'secondary_code':_0x415a93,'product_category':_0x332059(0x2c4)}},{'$group':{'_id':_0x332059(0x298),'name':{'$first':_0x332059(0x203)},'category':{'$first':_0x332059(0x2ec)},'brand':{'$first':'$brand'},'unit':{'$first':_0x332059(0x293)},'alertquantity':{'$first':_0x332059(0x25a)},'product_code':{'$first':_0x332059(0x1e7)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x332059(0x2bc)},'maxStocks':{'$first':_0x332059(0x278)},'maxProdPerUnit':{'$first':_0x332059(0x2dc)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x46eef7[_0x332059(0x249)]>0x0)_0x3a5e26=_0x46eef7;else _0x44d20f['length']>0x0&&(_0x3a5e26=_0x44d20f);_0x4b3319[_0x332059(0x230)](_0x3a5e26);}),router[a0_0x3d7845(0x2ed)](a0_0x3d7845(0x27b),async(_0x3eebc8,_0x55dc92)=>{var _0x506207=a0_0x3d7845;const {primaryCode:_0x31dfa0,secondaryCode:_0x1a8045,productCode:_0x342e07,bay:_0x10a4db,bin:_0x2f1339,types:_0x3da5c4,pallet:_0x84c262,warehouses:_0x327e59,room:_0x3d2736}=_0x3eebc8['body'];console[_0x506207(0x294)](_0x3eebc8[_0x506207(0x260)]);try{const _0x4306f3=await warehouse['aggregate']([{'$match':{'name':_0x327e59,'room':_0x3d2736}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x10a4db,'product_details.bin':_0x2f1339,'product_details.type':_0x3da5c4}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x506207(0x1f8)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x506207(0x29c)},'isle':{'$first':_0x506207(0x240)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x506207(0x20b)}}}]);_0x55dc92[_0x506207(0x248)](0xc8)['json'](_0x4306f3);}catch(_0x184bac){_0x55dc92[_0x506207(0x248)](0x194)[_0x506207(0x230)]({'message':_0x184bac['message']});}}),module[a0_0x3d7845(0x2bf)]=router;