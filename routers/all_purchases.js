var a0_0x1e096e=a0_0x549f;(function(_0x13808e,_0x273a7c){var _0x23f59f=a0_0x549f,_0x57d5f0=_0x13808e();while(!![]){try{var _0x5111ca=-parseInt(_0x23f59f(0x1b9))/0x1+-parseInt(_0x23f59f(0x1d5))/0x2+-parseInt(_0x23f59f(0x14e))/0x3*(parseInt(_0x23f59f(0x126))/0x4)+parseInt(_0x23f59f(0x143))/0x5+parseInt(_0x23f59f(0x137))/0x6+parseInt(_0x23f59f(0x1d6))/0x7*(-parseInt(_0x23f59f(0x213))/0x8)+parseInt(_0x23f59f(0x117))/0x9*(parseInt(_0x23f59f(0x19b))/0xa);if(_0x5111ca===_0x273a7c)break;else _0x57d5f0['push'](_0x57d5f0['shift']());}catch(_0x318fca){_0x57d5f0['push'](_0x57d5f0['shift']());}}}(a0_0x4b8f,0x5179e));function a0_0x4b8f(){var _0x28ef2a=['ejs','foreach\x20newproduct','save','/all_purchases/view/','invoice','toString','get','Purchase\x20Return','$product_details','Raw\x20Materials','host','$alertquantity','$return_data','primary_code','room','$product.type','maxperunit','$product_details.bin','<h5>','True','$product.floorlevel','Rack\x20C','getFullYear','Return\x20Goods','/preview/:id','delivery_date','/all_purchases/view','INC-','Arabic','stocks','prod_isle','prod_secondunit','Hindi','prod_invoice','<h2>\x20','$brand','sendMail','prod_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/view','$product.room_name','$product_details.level','$product_details.product_code','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</td>','warehouse_name','log','/view/:id','success','$due_amount','$product','edit_purchases','/give_payment/:id','3881592zESdNX','prod_level','suppliers_data','push','$note','Chinese','\x20<\x20wew\x20>\x20','forEach','\x20</h2>','user','\x20Order\x20Date\x20:\x20','getDate','$name','/view/return_purchase/:id','$batch_code','name','/view/add_purchases','$product_details.pallet','message','all_purchases','RoomAssign','all','aggregate','language','return_purchase','<tr>','storage','note','date','4284eFUbFA','render','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../public/language/languages.json','product_cat','<hr\x20class=\x22my-3\x22>','$secondary_code','$product_details.product_stock','path','suppliers','$paid_amount','paid_amount','Logo.png','\x20Order\x20Number\x20:\x20','Enabled','4436gkearr','actual_uom','$invoice','email','findOne','Purchase\x20Return\x20Mail','$product_details.type','$warehouse_name','isle','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.isle','staff','alertQTY','bay','<!DOCTYPE\x20html>','gmail','max_product_unit','2357280TcgAfh','types','Arabic\x20(ae)','MaxStocks_data','user_id','status','</head><body>','Rack\x20E','\x20<>\x20','Email\x20sent\x20successfully','/barcode/:id','Portuguese','662570KgftVQ','Spanish','purchases\x20item\x20return\x20successfull','prod_qty','prod_unit','<tbody\x20style=\x22text-align:\x20center;\x22>','stock_data','random','all_purchases_barcode','catch','Shelves','1695mWPrLC','$suppliers_docs','product_stock','slice','post','JO_number','</thead>','params','purchase\x20data\x20update\x20successfully','payment\x20successfull','type','master','/../public','port','</span>','Level','Purchase\x20data\x20added\x20successfully','site_title','image','secondary_unit','deliverycode','French','rak','$product_details.rack','$product_code','Sales\x20Update\x20successfully','length','role','product_list','German','Portuguese\x20(BR)','flash','nodemailer','exports','$primary_code','</h5>','$product_details.expiry_date','logo','room_name','Floor','secondary_code','errors','secondary_code_hide','edit_purchases_view','standard_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div>','$product.bay','express','$_id','bin','return_data','DRY\x20STORAGE','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$unit','back','Purchase\x20Mail','floorlevel','password','map','level','stock_quantity','$product_details.primary_code','prod_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','prod_Qty','production_date','currency','prod_cat','<h5\x20style=\x22text-align:\x20left;\x22>','find','$date','English','$expiry_date','Ambient','$product_details.bay','33890uLwtkK','<strong>\x20Regards\x20</strong>','product_name','body','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</tr>','primary_code_hide','$product_details._id','$product.bin','$product_details.product_name','</div>','batch_code','product_code_hide','product_details','$category','padStart','Rack\x20B','prod_primunit','maxStocks','finalize','product','findById','$product_details.floorlevel','</table>','warehouse','/CheckingWarehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','pallet','json','360383XQrwEu','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$finalize','suppliers_docs','<span\x20style=\x22float:\x20right;\x22>','$product_details.maxProducts','product_code','delivery_code','string','Rack\x20A','rack','return_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','abs','/upload/','An\x20error\x20occurred.','filter','redirect','../middleware/auth','There\x27s\x20a\x20error\x20in\x20this\x20transaction','prod_pallet','createTransport','expiry_date','then','$secondary_unit','English\x20(US)','665330GBJUbu','7YBJrex','concat','$maxStocks','actual_qty','/barcode_scanner','add\x20post','purchase_quantity'];a0_0x4b8f=function(){return _0x28ef2a;};return a0_0x4b8f();}const express=require(a0_0x1e096e(0x17e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x1e096e(0x1cd)),nodemailer=require(a0_0x1e096e(0x16e));var ejs=require(a0_0x1e096e(0x1dd));const path=require(a0_0x1e096e(0x11f)),users=require(a0_0x1e096e(0x11a));router[a0_0x1e096e(0x1e3)](a0_0x1e096e(0x204),auth,async(_0x4010e3,_0x384539)=>{var _0x3f6a87=a0_0x1e096e;try{const {username:_0x3a24d5,email:_0x1ad5e6,role:_0xe57acf}=_0x4010e3['user'],_0x24b2d7=_0x4010e3['user'],_0x555259=await profile['findOne']({'email':_0x24b2d7['email']}),_0x4a767f=await staff[_0x3f6a87(0x12a)]({'email':_0x24b2d7['email']});if(_0x24b2d7[_0x3f6a87(0x169)]==_0x3f6a87(0x131)){const _0xc259d3=await staff[_0x3f6a87(0x12a)]({'email':_0x24b2d7[_0x3f6a87(0x129)]});}const _0x230968=await master_shop[_0x3f6a87(0x195)]();let _0x5c0a3b;if(_0x24b2d7['role']==_0x3f6a87(0x131)){const _0x34bad3=await staff['findOne']({'email':_0x24b2d7['email']});_0x5c0a3b=await purchases[_0x3f6a87(0x110)]([{'$match':{'warehouse_name':_0x34bad3[_0x3f6a87(0x1b4)]}},{'$lookup':{'from':_0x3f6a87(0x120),'localField':_0x3f6a87(0x120),'foreignField':_0x3f6a87(0x222),'as':_0x3f6a87(0x1bd)}},{'$unwind':_0x3f6a87(0x14f)},{'$unwind':'$product'},{'$group':{'_id':_0x3f6a87(0x17f),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3f6a87(0x196)},'warehouse_name':{'$first':_0x3f6a87(0x12d)},'room':{'$first':'$room'},'product':{'$push':_0x3f6a87(0x210)},'note':{'$first':_0x3f6a87(0x217)},'paid_amount':{'$first':_0x3f6a87(0x121)},'due_amount':{'$first':_0x3f6a87(0x20f)},'return_data':{'$first':_0x3f6a87(0x1e9)},'batch_code':{'$first':_0x3f6a87(0x221)},'expiry_date':{'$first':_0x3f6a87(0x198)},'suppliers_docs':{'$first':_0x3f6a87(0x14f)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3f6a87(0x1a4)},'type':{'$addToSet':_0x3f6a87(0x1ec)},'floorlevel':{'$addToSet':_0x3f6a87(0x1f1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5c0a3b=await purchases['aggregate']([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x3f6a87(0x222),'as':'suppliers_docs'}},{'$unwind':_0x3f6a87(0x14f)},{'$unwind':_0x3f6a87(0x210)},{'$group':{'_id':_0x3f6a87(0x17f),'invoice':{'$first':_0x3f6a87(0x128)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3f6a87(0x196)},'warehouse_name':{'$first':_0x3f6a87(0x12d)},'room':{'$addToSet':_0x3f6a87(0x205)},'product':{'$push':_0x3f6a87(0x210)},'note':{'$first':_0x3f6a87(0x217)},'paid_amount':{'$first':_0x3f6a87(0x121)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x3f6a87(0x1e9)},'batch_code':{'$first':_0x3f6a87(0x221)},'expiry_date':{'$first':_0x3f6a87(0x198)},'suppliers_docs':{'$first':_0x3f6a87(0x14f)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x3f6a87(0x17d)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x3f6a87(0x1ec)},'floorlevel':{'$addToSet':_0x3f6a87(0x1f1)},'finalize':{'$first':_0x3f6a87(0x1bc)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x1d4)){var _0x279ea4=users[_0x3f6a87(0x197)];console[_0x3f6a87(0x20c)](_0x279ea4);}else{if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x1fd))var _0x279ea4=users[_0x3f6a87(0x1fd)];else{if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x16b))var _0x279ea4=users[_0x3f6a87(0x16b)];else{if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x144))var _0x279ea4=users['Spanish'];else{if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x163))var _0x279ea4=users['French'];else{if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x16c))var _0x279ea4=users[_0x3f6a87(0x142)];else{if(_0x230968[0x0][_0x3f6a87(0x111)]==_0x3f6a87(0x218))var _0x279ea4=users[_0x3f6a87(0x218)];else{if(_0x230968[0x0][_0x3f6a87(0x111)]=='Arabic\x20(ae)')var _0x279ea4=users[_0x3f6a87(0x1f9)];}}}}}}}_0x384539[_0x3f6a87(0x118)](_0x3f6a87(0x10d),{'success':_0x4010e3['flash'](_0x3f6a87(0x20e)),'errors':_0x4010e3[_0x3f6a87(0x16d)]('errors'),'purchases':_0x5c0a3b,'role':_0x24b2d7,'profile':_0x555259,'master_shop':_0x230968,'language':_0x279ea4});}catch(_0x198794){console[_0x3f6a87(0x20c)]('table\x20page',_0x198794),_0x384539[_0x3f6a87(0x13c)](0xc8)[_0x3f6a87(0x1b8)]({'message':_0x198794[_0x3f6a87(0x10c)]});}});function BayBinSelected(_0x18e10d,_0x3fc8a2){var _0xcf4fbe=a0_0x1e096e,_0x216d19=[],_0x33d17e=[],_0x2cb7d4=[],_0xd6213=[],_0x3f0248=[],_0x20e389=[];let _0x4a07d9=[];if(_0x18e10d==_0xcf4fbe(0x182))switch(_0x3fc8a2){case _0xcf4fbe(0x1c3):_0x216d19=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x33d17e=[0x1,0x2],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=['Level',_0xcf4fbe(0x175)],_0x3f0248=['D'],_0x20e389=['A'];break;case _0xcf4fbe(0x1ac):_0x216d19=[0x6,0x5,0x4,0x3,0x2,0x1],_0x33d17e=[0x1,0x2],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=[_0xcf4fbe(0x15d),'Floor'],_0x3f0248=['D'],_0x20e389=['B'];break;case _0xcf4fbe(0x14d):_0x216d19=[0x0],_0x33d17e=[0x0],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=[_0xcf4fbe(0x175)],_0x3f0248=['D'],_0x20e389=['S'];break;case'Receiving\x20Area':_0x216d19=[0x0],_0x33d17e=[0x0],_0xd6213=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2cb7d4=[_0xcf4fbe(0x175)],_0x3f0248=['D'],_0x20e389=['R'];break;}else{if(_0x18e10d=='COLD\x20STORAGE')switch(_0x3fc8a2){case _0xcf4fbe(0x1c3):_0x216d19=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x33d17e=['B','F'],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=[_0xcf4fbe(0x15d),_0xcf4fbe(0x175)],_0x3f0248=['C'],_0x20e389=['A'];break;case _0xcf4fbe(0x1ac):_0x216d19=[0x5,0x4,0x3,0x2,0x1],_0x33d17e=['F','B','S'],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=[_0xcf4fbe(0x15d),'Floor'],_0x3f0248=['C'],_0x20e389=['B'];break;case _0xcf4fbe(0x1f2):_0x216d19=[0x1,0x2,0x3,0x4,0x5],_0x33d17e=['B','F','S'],_0xd6213=[0x5,0x4,0x3,0x2,0x1],_0x2cb7d4=['Level',_0xcf4fbe(0x175)],_0x3f0248=['C'],_0x20e389=['C'];break;case'Rack\x20D':_0x216d19=[0x5,0x4,0x3,0x2,0x1],_0x33d17e=['F','B','S'],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=['Level','Floor'],_0x3f0248=['C'],_0x20e389=['D'];break;case _0xcf4fbe(0x13e):_0x216d19=[0x4,0x3,0x2,0x1],_0x33d17e=[0x1,0x2],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=[_0xcf4fbe(0x15d),_0xcf4fbe(0x175)],_0x3f0248=['C'],_0x20e389=['E'];break;case'Rack\x20F':_0x216d19=[0x1,0x2,0x3],_0x33d17e=[0x1,0x2],_0xd6213=[0x1,0x2,0x3,0x4,0x5],_0x2cb7d4=[_0xcf4fbe(0x15d)],_0x3f0248=['C'],_0x20e389=['F'];break;}}return{'levels':_0x216d19,'Isle':_0x33d17e,'rack':_0xd6213,'type':_0x2cb7d4,'storage':_0x3f0248,'rak':_0x20e389};}async function getRandom8DigitNumber(){var _0x323320=a0_0x1e096e;const _0x45bea3=0x989680,_0x18c35d=0x5f5e0ff,_0x4045f0=Math['floor'](Math[_0x323320(0x14a)]()*(_0x18c35d-_0x45bea3+0x1))+_0x45bea3;var _0x5191e8;const _0x51da0c=await purchases[_0x323320(0x12a)]({'invoice':_0x323320(0x1f8)+_0x4045f0});return _0x51da0c&&_0x51da0c[_0x323320(0x168)]>0x0?_0x5191e8=_0x323320(0x1f8)+_0x4045f0:_0x5191e8=_0x323320(0x1f8)+_0x4045f0,_0x5191e8;}function a0_0x549f(_0x19cb46,_0x127b65){var _0x4b8fb1=a0_0x4b8f();return a0_0x549f=function(_0x549f99,_0x55267f){_0x549f99=_0x549f99-0x10b;var _0x5ec8c8=_0x4b8fb1[_0x549f99];return _0x5ec8c8;},a0_0x549f(_0x19cb46,_0x127b65);}router['get'](a0_0x1e096e(0x223),auth,async(_0x53f94c,_0x5664ee)=>{var _0x4225be=a0_0x1e096e;try{const {username:_0x117303,email:_0x4f69cf,role:_0x5e33e3}=_0x53f94c[_0x4225be(0x21c)],_0x8a4dbd=_0x53f94c[_0x4225be(0x21c)],_0x1081cb=await profile[_0x4225be(0x12a)]({'email':_0x8a4dbd[_0x4225be(0x129)]}),_0x276e87=await master_shop[_0x4225be(0x195)](),_0x260471=await staff['findOne']({'email':_0x8a4dbd[_0x4225be(0x129)]}),_0x289fc6=await suppliers[_0x4225be(0x195)]({});let _0x4cd21f;if(_0x8a4dbd[_0x4225be(0x169)]==_0x4225be(0x131)){const _0x1dc178=await staff[_0x4225be(0x12a)]({'email':_0x8a4dbd[_0x4225be(0x129)]});_0x4cd21f=await warehouse[_0x4225be(0x110)]([{'$match':{'status':_0x4225be(0x125),'name':_0x1dc178['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x4225be(0x1f4)}}},{'$group':{'_id':_0x4225be(0x21f),'name':{'$first':_0x4225be(0x21f)}}}]);}else _0x4cd21f=await warehouse[_0x4225be(0x110)]([{'$match':{'status':_0x4225be(0x125),'warehouse_category':_0x4225be(0x1e6),'name':{'$ne':_0x4225be(0x1f4)}}},{'$group':{'_id':'$name','name':{'$first':_0x4225be(0x21f)}}}]);const _0x5c6302=await product['find']({}),_0x88380=await warehouse[_0x4225be(0x195)]({'status':'Enabled'}),_0x380b20=await purchases[_0x4225be(0x195)]({}),_0x259703=_0x380b20[_0x4225be(0x168)]+0x1,_0x1ad9c8=_0x4225be(0x1f8)+_0x259703[_0x4225be(0x1e2)]()[_0x4225be(0x1ab)](0x5,'0');var _0x59d8b9=[_0x4225be(0x199),'Enclosed'];if(_0x276e87[0x0][_0x4225be(0x111)]=='English\x20(US)')var _0x3f9f36=users[_0x4225be(0x197)];else{if(_0x276e87[0x0][_0x4225be(0x111)]==_0x4225be(0x1fd))var _0x3f9f36=users[_0x4225be(0x1fd)];else{if(_0x276e87[0x0][_0x4225be(0x111)]==_0x4225be(0x16b))var _0x3f9f36=users['German'];else{if(_0x276e87[0x0][_0x4225be(0x111)]=='Spanish')var _0x3f9f36=users['Spanish'];else{if(_0x276e87[0x0][_0x4225be(0x111)]==_0x4225be(0x163))var _0x3f9f36=users['French'];else{if(_0x276e87[0x0][_0x4225be(0x111)]==_0x4225be(0x16c))var _0x3f9f36=users[_0x4225be(0x142)];else{if(_0x276e87[0x0][_0x4225be(0x111)]==_0x4225be(0x218))var _0x3f9f36=users[_0x4225be(0x218)];else{if(_0x276e87[0x0][_0x4225be(0x111)]==_0x4225be(0x139))var _0x3f9f36=users[_0x4225be(0x1f9)];}}}}}}}const _0x353d20=getRandom8DigitNumber();_0x353d20[_0x4225be(0x1d2)](_0x5a57d6=>{var _0x4020e4=_0x4225be;_0x5664ee[_0x4020e4(0x118)]('add_purchases',{'success':_0x53f94c[_0x4020e4(0x16d)](_0x4020e4(0x20e)),'errors':_0x53f94c[_0x4020e4(0x16d)](_0x4020e4(0x177)),'role':_0x8a4dbd,'profile':_0x1081cb,'suppliers':_0x289fc6,'warehouse':_0x4cd21f,'product':_0x5c6302,'invoice':_0x5a57d6,'master_shop':_0x276e87,'language':_0x3f9f36,'find_data':_0x88380,'rooms_data':_0x59d8b9});})[_0x4225be(0x14c)](_0x289994=>{var _0x19444b=_0x4225be;_0x53f94c[_0x19444b(0x16d)](_0x19444b(0x177),_0x19444b(0x1ce)),_0x5664ee['redirect'](_0x19444b(0x1f7));});}catch(_0x2787fd){console['log'](_0x2787fd);}}),router[a0_0x1e096e(0x1e3)]('/view/add_purchases/:id',auth,async(_0x4d8e43,_0x205441)=>{var _0x4a3ae7=a0_0x1e096e;try{const _0x317ec5=_0x4d8e43[_0x4a3ae7(0x155)]['id'];console[_0x4a3ae7(0x20c)](_0x317ec5);const _0x2376da=await master_shop['find']();console[_0x4a3ae7(0x20c)](_0x4a3ae7(0x159),_0x2376da);const _0x5b303c=await product['findOne']({'name':_0x317ec5});console['log'](_0x4a3ae7(0x1b0),_0x5b303c),_0x205441['status'](0xc8)[_0x4a3ae7(0x1b8)]({'product_data':_0x5b303c,'master':_0x2376da});}catch(_0x3f2766){console[_0x4a3ae7(0x20c)]('add_purchases\x20error',_0x3f2766);}}),router[a0_0x1e096e(0x152)](a0_0x1e096e(0x223),auth,async(_0x11cd3a,_0x813019)=>{var _0x1a93bf=a0_0x1e096e;try{const {invoice:_0x57cd01,date:_0x291c4b,warehouse_name:_0x11077b,prod_name:_0x7e431e,prod_code:_0x333e78,prod_qty:_0x4b83be,prod_unit:_0x34a67e,prod_secondunit:_0x411416,prod_level:_0x53ec16,prod_isle:_0x594dd7,prod_pallet:_0x2bee39,note:_0x445ab9,expiry_date:_0x57434c,batch_code:_0x462e35,payable:_0x3fa57b,due_amount:_0x4d4c59,Room_name:_0x205267,primary_code:_0x3b00bd,secondary_code:_0x1f6489,MaxStocks_data:_0x171c65,PO_number:_0x42f67d,SCRN:_0x15c6f3,JO_number:_0x4c7c06}=_0x11cd3a[_0x1a93bf(0x19e)];if(typeof _0x7e431e==_0x1a93bf(0x1c2))var _0x5c89a5=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x18e)]],_0x53295c=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x202)]],_0x2c5a21=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x190)]],_0x39b7b6=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1ad)]],_0x1674c8=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1fc)]],_0x38287b=[_0x11cd3a['body'][_0x1a93bf(0x214)]],_0xbfa14c=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1ea)]],_0x521a37=[_0x11cd3a[_0x1a93bf(0x19e)]['secondary_code']],_0x5328ae=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x13a)]],_0x21621e=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1a7)]],_0x56e232=[_0x11cd3a[_0x1a93bf(0x19e)]['expiry_date']],_0x284b9b=[_0x11cd3a['body'][_0x1a93bf(0x136)]],_0x83815=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x132)]],_0x3d9cb1=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x191)]],_0xaa60b2=[_0x11cd3a['body'][_0x1a93bf(0x193)]],_0x24ff57=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x10e)]],_0x16f5da=[_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x162)]],_0x4488f9=[_0x11cd3a[_0x1a93bf(0x19e)]['prod_invoice']],_0x4d64a6=[_0x11cd3a['body'][_0x1a93bf(0x1d9)]],_0x3ddd96=[_0x11cd3a[_0x1a93bf(0x19e)]['actual_uom']];else var _0x5c89a5=[..._0x11cd3a['body'][_0x1a93bf(0x18e)]],_0x53295c=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x202)]],_0x2c5a21=[..._0x11cd3a['body'][_0x1a93bf(0x190)]],_0x39b7b6=[..._0x11cd3a['body'][_0x1a93bf(0x1ad)]],_0x1674c8=[..._0x11cd3a['body'][_0x1a93bf(0x1fc)]],_0x38287b=[..._0x11cd3a[_0x1a93bf(0x19e)]['prod_level']],_0xbfa14c=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1ea)]],_0x521a37=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x176)]],_0x5328ae=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x13a)]],_0x21621e=[..._0x11cd3a[_0x1a93bf(0x19e)]['batch_code']],_0x56e232=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1d1)]],_0x284b9b=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x136)]],_0x83815=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x132)]],_0x3d9cb1=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x191)]],_0xaa60b2=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x193)]],_0x24ff57=[..._0x11cd3a['body']['RoomAssign']],_0x16f5da=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x162)]],_0x4488f9=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1fe)]],_0x4d64a6=[..._0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x1d9)]],_0x3ddd96=[..._0x11cd3a['body'][_0x1a93bf(0x127)]];const _0x447f49=_0x5c89a5[_0x1a93bf(0x18a)](_0x2ef125=>{return _0x2ef125={'product_name':_0x2ef125};});_0x4d64a6['forEach']((_0x428969,_0x31cd6d)=>{var _0x1675c3=_0x1a93bf;_0x447f49[_0x31cd6d][_0x1675c3(0x1d9)]=Math[_0x1675c3(0x1c8)](_0x428969);}),_0x3ddd96['forEach']((_0x5f22c8,_0x5c37c8)=>{var _0x276a59=_0x1a93bf;_0x447f49[_0x5c37c8][_0x276a59(0x127)]=_0x5f22c8;}),_0x53295c['forEach']((_0x1af887,_0x31ddde)=>{var _0x2e64a2=_0x1a93bf;_0x447f49[_0x31ddde][_0x2e64a2(0x1c0)]=_0x1af887;}),_0x2c5a21[_0x1a93bf(0x21a)]((_0x3bce8d,_0x143209)=>{_0x447f49[_0x143209]['quantity']=Math['abs'](_0x3bce8d);}),_0x39b7b6[_0x1a93bf(0x21a)]((_0x35323b,_0x1a34af)=>{_0x447f49[_0x1a34af]['standard_unit']=_0x35323b;}),_0x1674c8[_0x1a93bf(0x21a)]((_0x5c506c,_0x58b6ca)=>{var _0x9fe8cb=_0x1a93bf;_0x447f49[_0x58b6ca][_0x9fe8cb(0x161)]=_0x5c506c;}),_0x38287b['forEach']((_0x29a3ab,_0x3c6c25)=>{var _0x387c90=_0x1a93bf;_0x24ff57[_0x387c90(0x21a)]((_0x3cae95,_0x2ce286)=>{var _0x515791=_0x387c90;if(_0x3cae95=='Receiving\x20Area'&&_0x3c6c25==_0x2ce286){console[_0x515791(0x20c)](_0x3cae95+_0x515791(0x219)+_0x3c6c25+_0x515791(0x13f)+_0x2ce286+_0x515791(0x13f)+_0x29a3ab);var _0x33c426=_0x29a3ab[_0x515791(0x151)](0x3);_0x447f49[_0x3c6c25][_0x515791(0x114)]=_0x29a3ab[0x0],_0x447f49[_0x3c6c25][_0x515791(0x1c4)]=_0x29a3ab[0x1],_0x447f49[_0x3c6c25]['bay']=0x0,_0x447f49[_0x3c6c25][_0x515791(0x180)]=0x0,_0x447f49[_0x3c6c25][_0x515791(0x158)]='Floor',_0x447f49[_0x3c6c25]['floorlevel']=_0x33c426;}else{if(_0x3cae95=='Shelves'&&_0x3c6c25==_0x2ce286){var _0x33c426=_0x29a3ab['slice'](0x3);_0x447f49[_0x3c6c25][_0x515791(0x114)]=_0x29a3ab[0x0],_0x447f49[_0x3c6c25][_0x515791(0x1c4)]=_0x29a3ab[0x1],_0x447f49[_0x3c6c25][_0x515791(0x133)]=0x0,_0x447f49[_0x3c6c25][_0x515791(0x180)]=0x0,_0x447f49[_0x3c6c25][_0x515791(0x158)]=_0x515791(0x175),_0x447f49[_0x3c6c25][_0x515791(0x188)]=_0x29a3ab[0x5];}else{if(_0x3c6c25==_0x2ce286){var _0x3a1e81;if(_0x29a3ab[0x4]=='L')_0x3a1e81='Level';else _0x29a3ab[0x4]=='F'&&(_0x3a1e81=_0x515791(0x175));_0x447f49[_0x3c6c25][_0x515791(0x114)]=_0x29a3ab[0x0],_0x447f49[_0x3c6c25]['rack']=_0x29a3ab[0x1],_0x447f49[_0x3c6c25][_0x515791(0x133)]=_0x29a3ab[0x2],_0x447f49[_0x3c6c25][_0x515791(0x180)]=_0x29a3ab[0x3],_0x447f49[_0x3c6c25][_0x515791(0x158)]=_0x3a1e81,_0x447f49[_0x3c6c25][_0x515791(0x188)]=_0x29a3ab[0x5];}}}});}),_0xbfa14c[_0x1a93bf(0x21a)]((_0x5b5c11,_0x10155e)=>{var _0x2c65e2=_0x1a93bf;_0x447f49[_0x10155e][_0x2c65e2(0x1ea)]=_0x5b5c11;}),_0x521a37['forEach']((_0x1adb45,_0x4931bd)=>{_0x447f49[_0x4931bd]['secondary_code']=_0x1adb45;}),_0x5328ae[_0x1a93bf(0x21a)]((_0x51005b,_0x2c6076)=>{var _0x2c7db6=_0x1a93bf;_0x447f49[_0x2c6076][_0x2c7db6(0x1ae)]=_0x51005b;}),_0x21621e[_0x1a93bf(0x21a)]((_0x2555ad,_0xeaae9a)=>{var _0x36c44c=_0x1a93bf;_0x447f49[_0xeaae9a][_0x36c44c(0x1a7)]=_0x2555ad;}),_0x56e232[_0x1a93bf(0x21a)]((_0x475c31,_0xbbc414)=>{var _0x5aa29a=_0x1a93bf;_0x447f49[_0xbbc414][_0x5aa29a(0x1d1)]=_0x475c31;}),_0x284b9b[_0x1a93bf(0x21a)]((_0xf70c94,_0x5dfc5e)=>{var _0x23d2aa=_0x1a93bf;_0x447f49[_0x5dfc5e][_0x23d2aa(0x1ed)]=_0xf70c94;}),_0x83815[_0x1a93bf(0x21a)]((_0x5328c1,_0x57d05c)=>{var _0x204f2e=_0x1a93bf;_0x447f49[_0x57d05c][_0x204f2e(0x132)]=_0x5328c1;}),_0x3d9cb1[_0x1a93bf(0x21a)]((_0x1c352d,_0x51bb72)=>{var _0x3c511b=_0x1a93bf;_0x447f49[_0x51bb72][_0x3c511b(0x191)]=_0x1c352d;}),_0xaa60b2[_0x1a93bf(0x21a)]((_0xbb2bc0,_0x20eb8f)=>{var _0x5137da=_0x1a93bf;_0x447f49[_0x20eb8f][_0x5137da(0x11b)]=_0xbb2bc0;}),_0x24ff57[_0x1a93bf(0x21a)]((_0x4dd2f5,_0x5a822c)=>{var _0x26d68a=_0x1a93bf;_0x447f49[_0x5a822c][_0x26d68a(0x174)]=_0x4dd2f5;}),_0x16f5da[_0x1a93bf(0x21a)]((_0x3510fe,_0x2c1a55)=>{var _0x5a6913=_0x1a93bf;_0x447f49[_0x2c1a55][_0x5a6913(0x1c1)]=_0x3510fe;}),_0x4488f9['forEach']((_0x42f895,_0x41dbe2)=>{var _0x53a67e=_0x1a93bf;_0x447f49[_0x41dbe2][_0x53a67e(0x1e1)]=_0x42f895;});const _0x1a353a=_0x24ff57[_0x1a93bf(0x18a)](_0x56d2b0=>{return _0x56d2b0={'room_name':_0x56d2b0};}),_0x5c0d18=_0x447f49['filter'](_0x15f7eb=>_0x15f7eb[_0x1a93bf(0x208)]!=='0'&&_0x15f7eb[_0x1a93bf(0x208)]!==''),_0x1d44b0=new purchases({'invoice':_0x57cd01,'suppliers':_0x11cd3a[_0x1a93bf(0x19e)][_0x1a93bf(0x120)],'date':_0x291c4b,'warehouse_name':_0x11077b,'product':_0x5c0d18,'note':_0x445ab9,'due_amount':_0x4d4c59,'POnumber':_0x42f67d,'SCRN':_0x15c6f3,'JO_number':_0x4c7c06,'roomList':_0x1a353a}),_0x1250cc=await _0x1d44b0['save'](),_0x369f79=await purchases[_0x1a93bf(0x12a)]({'invoice':_0x57cd01}),_0x2eccc4=_0x369f79[_0x1a93bf(0x1b0)][_0x1a93bf(0x18a)](async _0x355bde=>{var _0x1bc1f1=_0x1a93bf,_0x42b6de=await warehouse[_0x1bc1f1(0x12a)]({'name':_0x11077b,'room':_0x355bde[_0x1bc1f1(0x174)]}),_0x25520b=0x0;return _0x42b6de[_0x1bc1f1(0x1a9)]['forEach'](_0x505063=>{var _0x2904c6=_0x1bc1f1;_0x505063[_0x2904c6(0x19d)]==_0x355bde['product_name']&&_0x505063[_0x2904c6(0x188)]==_0x355bde[_0x2904c6(0x188)]&&_0x505063[_0x2904c6(0x158)]==_0x355bde[_0x2904c6(0x158)]&&_0x505063[_0x2904c6(0x180)]==_0x355bde[_0x2904c6(0x180)]&&_0x505063['bay']==_0x355bde[_0x2904c6(0x133)]&&_0x505063[_0x2904c6(0x1c4)]==_0x355bde[_0x2904c6(0x1c4)]&&_0x505063[_0x2904c6(0x114)]==_0x355bde[_0x2904c6(0x114)]&&_0x505063[_0x2904c6(0x1d1)]==_0x355bde['expiry_date']&&_0x505063[_0x2904c6(0x1a7)]==_0x355bde[_0x2904c6(0x1a7)]&&_0x505063[_0x2904c6(0x191)]==_0x355bde[_0x2904c6(0x191)]&&_0x505063[_0x2904c6(0x1e1)]==_0x369f79['invoice']&&(_0x505063[_0x2904c6(0x150)]+=Math[_0x2904c6(0x1c8)](_0x355bde[_0x2904c6(0x208)]),_0x25520b++);}),_0x25520b===0x0&&_0x42b6de[_0x1bc1f1(0x1a9)][_0x1bc1f1(0x216)]({'product_name':_0x355bde[_0x1bc1f1(0x19d)],'product_stock':Math['abs'](_0x355bde[_0x1bc1f1(0x208)]),'primary_code':_0x355bde[_0x1bc1f1(0x1ea)],'secondary_code':_0x355bde[_0x1bc1f1(0x176)],'product_code':_0x355bde[_0x1bc1f1(0x1c0)],'storage':_0x355bde[_0x1bc1f1(0x114)],'rack':_0x355bde[_0x1bc1f1(0x1c4)],'bay':_0x355bde[_0x1bc1f1(0x133)],'bin':_0x355bde['bin'],'type':_0x355bde[_0x1bc1f1(0x158)],'floorlevel':_0x355bde[_0x1bc1f1(0x188)],'maxProducts':_0x355bde[_0x1bc1f1(0x1ae)],'unit':_0x355bde[_0x1bc1f1(0x17a)],'secondary_unit':_0x355bde[_0x1bc1f1(0x161)],'expiry_date':_0x355bde['expiry_date'],'maxPerUnit':_0x355bde[_0x1bc1f1(0x1ed)],'batch_code':_0x355bde[_0x1bc1f1(0x1a7)],'alertQTY':_0x355bde[_0x1bc1f1(0x132)],'production_date':_0x355bde[_0x1bc1f1(0x191)],'product_cat':_0x355bde[_0x1bc1f1(0x11b)],'invoice':_0x355bde[_0x1bc1f1(0x1e1)],'actual_qty':Math[_0x1bc1f1(0x1c8)](_0x355bde[_0x1bc1f1(0x1d9)]),'actual_uom':_0x355bde[_0x1bc1f1(0x127)]}),_0x42b6de;});Promise[_0x1a93bf(0x10f)](_0x2eccc4)[_0x1a93bf(0x1d2)](async _0x31f192=>{var _0x37c356=_0x1a93bf;try{for(const _0x39f385 of _0x31f192){await _0x39f385[_0x37c356(0x1df)]();}const _0x452ebf=await master_shop['find'](),_0x6ec5fc=await email_settings[_0x37c356(0x12a)](),_0x4d02b3=await supervisor_settings[_0x37c356(0x195)]();var _0x2fc445=_0x369f79[_0x37c356(0x1b0)],_0x1aa181='',_0x461994;for(_0x461994 in _0x2fc445){_0x1aa181+=_0x37c356(0x113)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2fc445[_0x461994][_0x37c356(0x19d)]+_0x37c356(0x20a)+_0x37c356(0x119)+_0x2fc445[_0x461994][_0x37c356(0x1c0)]+_0x37c356(0x20a)+_0x37c356(0x119)+_0x2fc445[_0x461994]['quantity']+_0x37c356(0x20a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2fc445[_0x461994][_0x37c356(0x17a)]+'</td>'+_0x37c356(0x119)+_0x2fc445[_0x461994][_0x37c356(0x161)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x369f79[_0x37c356(0x20b)]+_0x37c356(0x20a)+_0x37c356(0x119)+_0x2fc445[_0x461994][_0x37c356(0x174)]+_0x37c356(0x20a)+_0x37c356(0x119)+_0x2fc445[_0x461994][_0x37c356(0x114)]+_0x2fc445[_0x461994]['rack']+_0x2fc445[_0x461994][_0x37c356(0x133)]+_0x2fc445[_0x461994][_0x37c356(0x180)]+_0x2fc445[_0x461994][_0x37c356(0x158)][0x0]+_0x2fc445[_0x461994][_0x37c356(0x188)]+_0x37c356(0x20a),_0x37c356(0x1a1);}let _0x1a2d70=nodemailer[_0x37c356(0x1d0)]({'host':_0x6ec5fc[_0x37c356(0x1e7)],'port':Number(_0x6ec5fc[_0x37c356(0x15b)]),'secure':![],'auth':{'user':_0x6ec5fc['email'],'pass':_0x6ec5fc[_0x37c356(0x189)]}}),_0x24be6a={'from':_0x6ec5fc[_0x37c356(0x129)],'to':_0x4d02b3[0x0]['RMSEmail'],'subject':_0x37c356(0x187),'attachments':[{'filename':_0x37c356(0x123),'path':__dirname+'/../public'+_0x37c356(0x1c9)+_0x452ebf[0x0][_0x37c356(0x160)],'cid':_0x37c356(0x173)}],'html':_0x37c356(0x134)+_0x37c356(0x1ba)+_0x37c356(0x13d)+'<div>'+_0x37c356(0x184)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x37c356(0x1a6)+_0x37c356(0x17c)+_0x37c356(0x1ff)+_0x452ebf[0x0][_0x37c356(0x15f)]+_0x37c356(0x21b)+_0x37c356(0x1a6)+_0x37c356(0x1a6)+_0x37c356(0x11c)+'<div>'+_0x37c356(0x194)+_0x37c356(0x124)+_0x369f79[_0x37c356(0x1e1)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x37c356(0x21d)+_0x369f79[_0x37c356(0x116)]+'\x20'+_0x37c356(0x15c)+'</h5>'+_0x37c356(0x1a6)+_0x37c356(0x12f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x37c356(0x113)+_0x37c356(0x1b6)+_0x37c356(0x209)+_0x37c356(0x1c6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x37c356(0x1a0)+_0x37c356(0x203)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x37c356(0x1a1)+'</thead>'+_0x37c356(0x148)+'\x20'+_0x1aa181+'\x20'+'</tbody>'+'</table>'+_0x37c356(0x17c)+_0x37c356(0x19c)+_0x37c356(0x1ef)+_0x452ebf[0x0][_0x37c356(0x15f)]+_0x37c356(0x171)+_0x37c356(0x1a6)+_0x37c356(0x1a6)+'</body></html>'};_0x1a2d70[_0x37c356(0x201)](_0x24be6a,function(_0x140d59,_0xfe7f4f){var _0x150d52=_0x37c356;_0x140d59?(console[_0x150d52(0x20c)](_0x140d59),console[_0x150d52(0x20c)]('Error\x20Occurs')):console[_0x150d52(0x20c)](_0x150d52(0x140));}),_0x11cd3a[_0x37c356(0x16d)](_0x37c356(0x20e),_0x37c356(0x15e)),_0x813019[_0x37c356(0x1cc)](_0x37c356(0x1e0));}catch(_0x3bfb3a){console['error'](_0x3bfb3a),_0x813019[_0x37c356(0x13c)](0x1f4)[_0x37c356(0x1b8)]({'error':_0x37c356(0x1c7)});}})[_0x1a93bf(0x14c)](_0x645cfb=>{var _0x4abc28=_0x1a93bf;console['error'](_0x645cfb),_0x813019['status'](0x1f4)['json']({'error':_0x4abc28(0x1ca)});});}catch(_0x44285c){console[_0x1a93bf(0x20c)](_0x44285c);}}),router[a0_0x1e096e(0x1e3)](a0_0x1e096e(0x1f5),auth,async(_0x3fb88b,_0x17a69d)=>{var _0x467842=a0_0x1e096e;try{const {username:_0x42b6ba,email:_0xa5c0e4,role:_0x184714}=_0x3fb88b[_0x467842(0x21c)],_0x523a00=_0x3fb88b[_0x467842(0x21c)],_0x331768=await profile['findOne']({'email':_0x523a00[_0x467842(0x129)]}),_0x245f02=await master_shop['find'](),_0x13673a=_0x3fb88b['params']['id'],_0x4169b6=await purchases['findById'](_0x13673a),_0x2bc93f=await warehouse[_0x467842(0x110)]([{'$match':{'name':_0x4169b6[_0x467842(0x20b)],'room':_0x4169b6[_0x467842(0x1eb)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x467842(0x1a3),'name':{'$first':_0x467842(0x1a5)},'product_stock':{'$first':_0x467842(0x11e)},'bay':{'$first':_0x467842(0x19a)},'bin':{'$first':_0x467842(0x1ee)},'type':{'$first':_0x467842(0x12c)},'floorlevel':{'$first':_0x467842(0x1b2)},'primary_code':{'$first':_0x467842(0x18d)},'secondary_code':{'$first':_0x467842(0x19f)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x467842(0x165)},'expiry_date':{'$first':_0x467842(0x172)}}}]),_0x351814=await customer[_0x467842(0x195)]({});let _0x23d670;if(_0x523a00[_0x467842(0x169)]==_0x467842(0x131)){const _0x5d5e5b=await staff[_0x467842(0x12a)]({'email':_0x523a00[_0x467842(0x129)]});_0x23d670=await warehouse[_0x467842(0x110)]([{'$match':{'status':_0x467842(0x125),'name':_0x5d5e5b['warehouse']}},{'$group':{'_id':_0x467842(0x21f),'name':{'$first':_0x467842(0x21f)}}}]);}else _0x23d670=await warehouse[_0x467842(0x110)]([{'$match':{'status':_0x467842(0x125)}},{'$group':{'_id':_0x467842(0x21f),'name':{'$first':'$name'}}}]);const _0xb75395=await product[_0x467842(0x195)]({}),_0x39baa2=await suppliers['find']({}),_0x5cba1d=BayBinSelected(_0x4169b6[_0x467842(0x20b)],_0x4169b6[_0x467842(0x1eb)]);if(_0x245f02[0x0][_0x467842(0x111)]=='English\x20(US)'){var _0x273fd3=users['English'];console['log'](_0x273fd3);}else{if(_0x245f02[0x0][_0x467842(0x111)]=='Hindi')var _0x273fd3=users[_0x467842(0x1fd)];else{if(_0x245f02[0x0]['language']==_0x467842(0x16b))var _0x273fd3=users['German'];else{if(_0x245f02[0x0]['language']==_0x467842(0x144))var _0x273fd3=users[_0x467842(0x144)];else{if(_0x245f02[0x0][_0x467842(0x111)]==_0x467842(0x163))var _0x273fd3=users['French'];else{if(_0x245f02[0x0][_0x467842(0x111)]==_0x467842(0x16c))var _0x273fd3=users[_0x467842(0x142)];else{if(_0x245f02[0x0][_0x467842(0x111)]=='Chinese')var _0x273fd3=users[_0x467842(0x218)];else{if(_0x245f02[0x0][_0x467842(0x111)]=='Arabic\x20(ae)')var _0x273fd3=users[_0x467842(0x1f9)];}}}}}}}_0x17a69d[_0x467842(0x118)](_0x467842(0x179),{'success':_0x3fb88b[_0x467842(0x16d)](_0x467842(0x20e)),'errors':_0x3fb88b[_0x467842(0x16d)](_0x467842(0x177)),'role':_0x523a00,'profile':_0x331768,'customer':_0x351814,'warehouse':_0x23d670,'product':_0x2bc93f,'user':_0x4169b6,'master_shop':_0x245f02,'unit':_0xb75395,'language':_0x273fd3,'suppliers':_0x39baa2,'dataSelected':_0x5cba1d});}catch(_0x545d4c){console[_0x467842(0x20c)](_0x545d4c);}}),router['post'](a0_0x1e096e(0x1f5),auth,async(_0x4ce397,_0x15c3dd)=>{var _0x29fb9a=a0_0x1e096e;try{const _0x4711ab=_0x4ce397[_0x29fb9a(0x155)]['id'],{invoice:_0x49358a,warehouse_name:_0x4600a3,Room_name:_0x384598}=_0x4ce397[_0x29fb9a(0x19e)],_0x5ca2cf=await warehouse['findOne']({'name':_0x4600a3,'room':_0x384598}),_0x5ceacb=await purchases[_0x29fb9a(0x12a)]({'invoice':_0x49358a});_0x5ceacb[_0x29fb9a(0x1b0)]['forEach'](_0x400ee4=>{var _0x185ed5=_0x29fb9a,_0x321c3a=0x0;const _0x5a35cc=_0x5ca2cf['product_details'][_0x185ed5(0x18a)](_0x547212=>{var _0x328299=_0x185ed5;_0x547212['product_name']==_0x400ee4[_0x328299(0x19d)]&&_0x547212[_0x328299(0x188)]==_0x400ee4[_0x328299(0x188)]&&_0x547212[_0x328299(0x158)]==_0x400ee4[_0x328299(0x158)]&&_0x547212[_0x328299(0x180)]==_0x400ee4[_0x328299(0x180)]&&_0x547212[_0x328299(0x133)]==_0x400ee4[_0x328299(0x133)]&&_0x547212['rack']==_0x400ee4['rack']&&_0x547212[_0x328299(0x114)]==_0x400ee4[_0x328299(0x114)]&&_0x547212[_0x328299(0x1d1)]==_0x400ee4[_0x328299(0x1d1)]&&_0x547212[_0x328299(0x1a7)]==_0x400ee4[_0x328299(0x1a7)]&&_0x547212[_0x328299(0x191)]==_0x400ee4[_0x328299(0x191)]&&_0x547212['delivery_date']==_0x400ee4['delivery_date']&&_0x547212['delivery_code']==_0x400ee4[_0x328299(0x1c1)]&&(_0x547212[_0x328299(0x150)]=parseInt(_0x547212[_0x328299(0x150)])+parseInt(_0x400ee4['quantity']),_0x321c3a++);});_0x321c3a=='0'&&(_0x5ca2cf[_0x185ed5(0x1a9)]=_0x5ca2cf[_0x185ed5(0x1a9)]['concat']({'product_name':_0x400ee4[_0x185ed5(0x19d)],'product_stock':_0x400ee4[_0x185ed5(0x208)],'primary_code':_0x400ee4[_0x185ed5(0x1ea)],'secondary_code':_0x400ee4[_0x185ed5(0x176)],'product_code':_0x400ee4['product_code'],'storage':_0x400ee4[_0x185ed5(0x114)],'rack':_0x400ee4['rack'],'bay':_0x400ee4[_0x185ed5(0x133)],'bin':_0x400ee4[_0x185ed5(0x180)],'type':_0x400ee4[_0x185ed5(0x158)],'floorlevel':_0x400ee4[_0x185ed5(0x188)],'maxProducts':_0x400ee4[_0x185ed5(0x1ae)],'unit':_0x400ee4[_0x185ed5(0x17a)],'secondary_unit':_0x400ee4['secondary_unit'],'expiry_date':_0x400ee4[_0x185ed5(0x1d1)],'maxPerUnit':_0x400ee4['maxperunit'],'batch_code':_0x400ee4['batch_code'],'alertQTY':_0x400ee4[_0x185ed5(0x132)],'production_date':_0x400ee4['production_date'],'delivery_date':_0x400ee4[_0x185ed5(0x1f6)],'delivery_code':_0x400ee4[_0x185ed5(0x1c1)]}));}),await _0x5ca2cf[_0x29fb9a(0x1df)](),_0x5ceacb[_0x29fb9a(0x1af)]=_0x29fb9a(0x1f0);const _0x4e2ac1=await _0x5ceacb['save']();_0x4ce397[_0x29fb9a(0x16d)]('success',_0x29fb9a(0x167)),_0x15c3dd[_0x29fb9a(0x1cc)](_0x29fb9a(0x1f7));}catch(_0x3e109e){console[_0x29fb9a(0x20c)](_0x3e109e);}}),router[a0_0x1e096e(0x1e3)](a0_0x1e096e(0x20d),auth,async(_0x1e14a4,_0x158acd)=>{var _0x360729=a0_0x1e096e;try{const {username:_0xe0085e,email:_0x5326df,role:_0x109cf9}=_0x1e14a4[_0x360729(0x21c)],_0x5beb30=_0x1e14a4[_0x360729(0x21c)],_0x4a3496=await profile[_0x360729(0x12a)]({'email':_0x5beb30['email']}),_0x2d3fc0=await master_shop[_0x360729(0x195)](),_0x596803=_0x1e14a4['params']['id'],_0x3f4d27=await purchases['findById'](_0x596803),_0xe21862=await suppliers[_0x360729(0x195)]({});let _0x1541e3;if(_0x5beb30[_0x360729(0x169)]=='staff'){const _0x22ab3d=await staff[_0x360729(0x12a)]({'email':_0x5beb30[_0x360729(0x129)]});_0x1541e3=await warehouse[_0x360729(0x195)]({'status':_0x360729(0x125),'name':_0x22ab3d[_0x360729(0x1b4)],'warehouse_category':'Raw\x20Materials'});}else _0x1541e3=await warehouse[_0x360729(0x110)]([{'$match':{'status':'Enabled','warehouse_category':_0x360729(0x1e6)}},{'$group':{'_id':_0x360729(0x21f),'name':{'$first':_0x360729(0x21f)}}}]);const _0x42ccc6=await product[_0x360729(0x195)]({}),_0xdf118b=BayBinSelected(_0x3f4d27[_0x360729(0x20b)],_0x3f4d27[_0x360729(0x1eb)]);let _0x4553ed=new Date(_0x3f4d27[_0x360729(0x1d1)]),_0x1cd797=('0'+_0x4553ed[_0x360729(0x21e)]())[_0x360729(0x151)](-0x2),_0x4dc44b=('0'+(_0x4553ed['getMonth']()+0x1))[_0x360729(0x151)](-0x2),_0x1dbb4c=_0x4553ed[_0x360729(0x1f3)](),_0x22ac96=_0x1dbb4c+'-'+_0x4dc44b+'-'+_0x1cd797;if(_0x2d3fc0[0x0][_0x360729(0x111)]=='English\x20(US)'){var _0x5cb5bb=users[_0x360729(0x197)];console[_0x360729(0x20c)](_0x5cb5bb);}else{if(_0x2d3fc0[0x0][_0x360729(0x111)]==_0x360729(0x1fd))var _0x5cb5bb=users['Hindi'];else{if(_0x2d3fc0[0x0][_0x360729(0x111)]==_0x360729(0x16b))var _0x5cb5bb=users[_0x360729(0x16b)];else{if(_0x2d3fc0[0x0][_0x360729(0x111)]=='Spanish')var _0x5cb5bb=users[_0x360729(0x144)];else{if(_0x2d3fc0[0x0][_0x360729(0x111)]==_0x360729(0x163))var _0x5cb5bb=users[_0x360729(0x163)];else{if(_0x2d3fc0[0x0]['language']==_0x360729(0x16c))var _0x5cb5bb=users[_0x360729(0x142)];else{if(_0x2d3fc0[0x0]['language']==_0x360729(0x218))var _0x5cb5bb=users['Chinese'];else{if(_0x2d3fc0[0x0][_0x360729(0x111)]==_0x360729(0x139))var _0x5cb5bb=users[_0x360729(0x1f9)];}}}}}}}_0x158acd[_0x360729(0x118)](_0x360729(0x211),{'success':_0x1e14a4[_0x360729(0x16d)](_0x360729(0x20e)),'errors':_0x1e14a4[_0x360729(0x16d)]('errors'),'role':_0x5beb30,'profile':_0x4a3496,'purchases':_0x3f4d27,'suppliers':_0xe21862,'warehouse':_0x1541e3,'product':_0x42ccc6,'master_shop':_0x2d3fc0,'language':_0x5cb5bb,'ed_fullDate':_0x22ac96,'dataSelected':_0xdf118b});}catch(_0x59eaae){console[_0x360729(0x20c)](_0x59eaae);}}),router['post'](a0_0x1e096e(0x20d),auth,async(_0x2c93ad,_0xfad45c)=>{var _0x1a5309=a0_0x1e096e;try{const _0x51fa78=_0x2c93ad[_0x1a5309(0x155)]['id'],_0x235809=await purchases[_0x1a5309(0x12a)]({'_id':_0x2c93ad[_0x1a5309(0x155)]['id']}),_0x4eb5a8=await warehouse['findOne']({'name':_0x235809[_0x1a5309(0x20b)],'room':_0x235809['room']});_0x235809[_0x1a5309(0x1b0)][_0x1a5309(0x21a)](_0xa7484b=>{var _0x56955d=_0x1a5309;const _0x3cfb1d=_0x4eb5a8[_0x56955d(0x1a9)]['map'](_0xce26d6=>{var _0x1a441a=_0x56955d;_0xce26d6['product_name']==_0xa7484b[_0x1a441a(0x19d)]&&_0xce26d6[_0x1a441a(0x188)]==_0xa7484b[_0x1a441a(0x188)]&&_0xce26d6[_0x1a441a(0x158)]==_0xa7484b['type']&&_0xce26d6[_0x1a441a(0x180)]==_0xa7484b['bin']&&_0xce26d6['bay']==_0xa7484b[_0x1a441a(0x133)]&&_0xce26d6[_0x1a441a(0x1c4)]==_0xa7484b['rack']&&_0xce26d6[_0x1a441a(0x114)]==_0xa7484b[_0x1a441a(0x114)]&&(_0xce26d6[_0x1a441a(0x150)]=parseInt(_0xce26d6['product_stock'])-parseInt(_0xa7484b[_0x1a441a(0x208)]));});}),await _0x4eb5a8[_0x1a5309(0x1df)]();const {invoice:_0x21f95f,suppliers:_0x364435,date:_0x222297,warehouse_name:_0x2b2e29,prod_name:_0x3293c7,prod_code:_0x48f594,prod_qty:_0x5cb28b,prod_unit:_0x56521e,prod_secondunit:_0x424132,prod_level:_0x6c309d,prod_isle:_0x3e3d19,prod_pallet:_0x2def5f,note:_0x4f6ab0,expiry_date:_0x3db115,batch_code:_0x5a4731,paid_amount:_0x326a8b,due_amount:_0x3ca964,Room_name:_0x4b304b,primary_code:_0xf81d13,secondary_code:_0x4b9b7d,PO_number:_0x5c656a,JO_number:_0x57fbfb}=_0x2c93ad[_0x1a5309(0x19e)];if(typeof _0x3293c7==_0x1a5309(0x1c2))var _0x1bac92=[_0x2c93ad[_0x1a5309(0x19e)]['prod_name']],_0x52cd18=[_0x2c93ad['body'][_0x1a5309(0x202)]],_0x433fac=[_0x2c93ad[_0x1a5309(0x19e)]['prod_qty']],_0x2b6c92=[_0x2c93ad[_0x1a5309(0x19e)]['prod_unit']],_0x16798a=[_0x2c93ad[_0x1a5309(0x19e)]['prod_secondunit']],_0x3e3364=[_0x2c93ad[_0x1a5309(0x19e)]['prod_level']],_0x35759a=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1fb)]],_0x331ba2=[_0x2c93ad['body'][_0x1a5309(0x1cf)]],_0x35f16c=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1ea)]],_0x5d7a69=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x176)]],_0x42ea53=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x13a)]],_0xfbb265=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1a7)]],_0x3988b6=[_0x2c93ad['body']['expiry_date']],_0x4496ae=[_0x2c93ad[_0x1a5309(0x19e)]['storage']],_0x1f0f29=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x164)]],_0x8252d1=[_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x158)]];else var _0x1bac92=[..._0x2c93ad['body']['prod_name']],_0x52cd18=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x202)]],_0x433fac=[..._0x2c93ad['body'][_0x1a5309(0x146)]],_0x2b6c92=[..._0x2c93ad['body'][_0x1a5309(0x147)]],_0x16798a=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1fc)]],_0x3e3364=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x214)]],_0x35759a=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1fb)]],_0x331ba2=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1cf)]],_0x35f16c=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1ea)]],_0x5d7a69=[..._0x2c93ad['body'][_0x1a5309(0x176)]],_0x42ea53=[..._0x2c93ad['body'][_0x1a5309(0x13a)]],_0xfbb265=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1a7)]],_0x3988b6=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1d1)]],_0x4496ae=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x114)]],_0x1f0f29=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x164)]],_0x8252d1=[..._0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x158)]];const _0x2dd9bb=_0x1bac92['map'](_0x1b3014=>{return _0x1b3014={'product_name':_0x1b3014};});_0x52cd18[_0x1a5309(0x21a)]((_0x151ed7,_0x53d1a1)=>{var _0x2a78da=_0x1a5309;_0x2dd9bb[_0x53d1a1][_0x2a78da(0x1c0)]=_0x151ed7;}),_0x433fac[_0x1a5309(0x21a)]((_0x588009,_0x3bd584)=>{var _0x286dfb=_0x1a5309;_0x2dd9bb[_0x3bd584][_0x286dfb(0x208)]=_0x588009;}),_0x2b6c92[_0x1a5309(0x21a)]((_0x32904d,_0x4803dc)=>{var _0x5f5793=_0x1a5309;_0x2dd9bb[_0x4803dc][_0x5f5793(0x17a)]=_0x32904d;}),_0x16798a[_0x1a5309(0x21a)]((_0x622b57,_0x1a1ef1)=>{_0x2dd9bb[_0x1a1ef1]['secondary_unit']=_0x622b57;}),_0x3e3364[_0x1a5309(0x21a)]((_0x32f623,_0x138cb1)=>{var _0x5ab6d8=_0x1a5309;_0x2dd9bb[_0x138cb1][_0x5ab6d8(0x133)]=_0x32f623;}),_0x35759a['forEach']((_0x256e1a,_0x4036be)=>{_0x2dd9bb[_0x4036be]['bin']=_0x256e1a;}),_0x331ba2['forEach']((_0x16ff1b,_0x45eeff)=>{var _0x4031dc=_0x1a5309;_0x2dd9bb[_0x45eeff][_0x4031dc(0x188)]=_0x16ff1b;}),_0x35f16c[_0x1a5309(0x21a)]((_0x309f08,_0x51a63f)=>{var _0x37ce01=_0x1a5309;_0x2dd9bb[_0x51a63f][_0x37ce01(0x1ea)]=_0x309f08;}),_0x5d7a69[_0x1a5309(0x21a)]((_0xcf076d,_0xb4d3d0)=>{var _0x9b7048=_0x1a5309;_0x2dd9bb[_0xb4d3d0][_0x9b7048(0x176)]=_0xcf076d;}),_0x42ea53[_0x1a5309(0x21a)]((_0x4414e2,_0x49c5c4)=>{var _0x477742=_0x1a5309;_0x2dd9bb[_0x49c5c4][_0x477742(0x1ae)]=_0x4414e2;}),_0xfbb265[_0x1a5309(0x21a)]((_0x20a2fe,_0x4ff6c4)=>{var _0x26bd91=_0x1a5309;_0x2dd9bb[_0x4ff6c4][_0x26bd91(0x1a7)]=_0x20a2fe;}),_0x3988b6[_0x1a5309(0x21a)]((_0x175057,_0x5474a5)=>{_0x2dd9bb[_0x5474a5]['expiry_date']=_0x175057;}),_0x8252d1[_0x1a5309(0x21a)]((_0x58216e,_0x367c3c)=>{_0x2dd9bb[_0x367c3c]['type']=_0x58216e;}),_0x4496ae['forEach']((_0x1084a9,_0x900c8d)=>{var _0x1c2eb3=_0x1a5309;_0x2dd9bb[_0x900c8d][_0x1c2eb3(0x114)]=_0x1084a9;}),_0x1f0f29[_0x1a5309(0x21a)]((_0x33092c,_0x1ee278)=>{var _0x52e4ff=_0x1a5309;_0x2dd9bb[_0x1ee278][_0x52e4ff(0x1c4)]=_0x33092c;});const _0x396f3d=_0x2dd9bb['filter'](_0x9c8f57=>_0x9c8f57[_0x1a5309(0x208)]!=='0'&&_0x9c8f57['quantity']!=='');_0x235809[_0x1a5309(0x1e1)]=_0x21f95f,_0x235809[_0x1a5309(0x120)]=_0x364435,_0x235809[_0x1a5309(0x116)]=_0x222297,_0x235809[_0x1a5309(0x20b)]=_0x2b2e29,_0x235809[_0x1a5309(0x1b0)]=_0x396f3d,_0x235809[_0x1a5309(0x115)]=_0x4f6ab0,_0x235809[_0x1a5309(0x122)]=_0x326a8b,_0x235809['due_amount']=_0x3ca964,_0x235809[_0x1a5309(0x1eb)]=_0x4b304b,_0x235809['POnumber']=_0x5c656a,_0x235809[_0x1a5309(0x153)]=_0x57fbfb;const _0x93cd19=await _0x235809['save'](),_0x2b2899=await warehouse['findOne']({'name':_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x20b)],'room':_0x2c93ad[_0x1a5309(0x19e)]['Room_name']});_0x235809[_0x1a5309(0x1b0)][_0x1a5309(0x21a)](_0x1c2021=>{var _0x47a768=_0x1a5309,_0x466103=0x0;const _0x50c5ed=_0x2b2899[_0x47a768(0x1a9)]['map'](_0x5ec082=>{var _0x30b306=_0x47a768;_0x5ec082['product_name']==_0x1c2021[_0x30b306(0x19d)]&&_0x5ec082[_0x30b306(0x188)]==_0x1c2021['floorlevel']&&_0x5ec082['type']==_0x1c2021[_0x30b306(0x158)]&&_0x5ec082['bin']==_0x1c2021['bin']&&_0x5ec082[_0x30b306(0x133)]==_0x1c2021[_0x30b306(0x133)]&&_0x5ec082[_0x30b306(0x1c4)]==_0x1c2021[_0x30b306(0x1c4)]&&_0x5ec082['storage']==_0x1c2021[_0x30b306(0x114)]&&(_0x5ec082[_0x30b306(0x150)]=parseInt(_0x5ec082[_0x30b306(0x150)])+parseInt(_0x1c2021['quantity']),_0x466103++);});_0x466103=='0'&&(_0x2b2899[_0x47a768(0x1a9)]=_0x2b2899['product_details'][_0x47a768(0x1d7)]({'product_name':_0x1c2021['product_name'],'product_stock':_0x1c2021[_0x47a768(0x208)],'primary_code':_0x1c2021[_0x47a768(0x1ea)],'secondary_code':_0x1c2021[_0x47a768(0x176)],'product_code':_0x1c2021[_0x47a768(0x1c0)],'storage':_0x1c2021[_0x47a768(0x114)],'rack':_0x1c2021['rack'],'bay':_0x1c2021[_0x47a768(0x133)],'bin':_0x1c2021[_0x47a768(0x180)],'type':_0x1c2021[_0x47a768(0x158)],'floorlevel':_0x1c2021[_0x47a768(0x188)],'maxProducts':_0x1c2021[_0x47a768(0x1ae)],'unit':_0x1c2021[_0x47a768(0x17a)],'secondary_unit':_0x1c2021[_0x47a768(0x161)],'expiry_date':_0x1c2021[_0x47a768(0x1d1)]}));}),await _0x2b2899[_0x1a5309(0x1df)]();const _0x111504=await s_payment_data['findOne']({'invoice':_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1e1)]});if(_0x111504===null){}else console['log'](_0x1a5309(0x120),_0x111504,_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x1e1)]),_0x111504[_0x1a5309(0x120)]=_0x2c93ad[_0x1a5309(0x19e)][_0x1a5309(0x120)],await _0x111504[_0x1a5309(0x1df)]();_0x2c93ad['flash']('success',_0x1a5309(0x156)),_0xfad45c[_0x1a5309(0x1cc)]('/all_purchases/view');}catch(_0x54a9bd){console['log'](_0x54a9bd);}}),router[a0_0x1e096e(0x152)](a0_0x1e096e(0x212),auth,async(_0x401e8e,_0x51a92d)=>{var _0x24ea9d=a0_0x1e096e;try{const _0x1f5e33=_0x401e8e[_0x24ea9d(0x155)]['id'],{invoice:_0x5a58ab,suppliers:_0x4d9b20,payable:_0x4ab729,due_amount:_0x43b2ce}=_0x401e8e[_0x24ea9d(0x19e)],_0x1be651=await purchases[_0x24ea9d(0x1b1)](_0x1f5e33);var _0x4d3f3e=_0x4ab729-_0x43b2ce;_0x1be651['paid_amount']=parseFloat(_0x1be651[_0x24ea9d(0x122)])+parseFloat(_0x43b2ce),_0x1be651['due_amount']=_0x4d3f3e;const _0x5a6064=await _0x1be651[_0x24ea9d(0x1df)]();console[_0x24ea9d(0x20c)](_0x5a6064);const _0x370031=await s_payment_data[_0x24ea9d(0x12a)]({'invoice':_0x5a58ab});_0x370031['amount']=_0x4d3f3e,await _0x370031[_0x24ea9d(0x1df)]();let _0x28e15b=new Date(),_0x4e7f31=('0'+_0x28e15b['getDate']())['slice'](-0x2),_0x5a55f9=('0'+(_0x28e15b['getMonth']()+0x1))['slice'](-0x2),_0x11ba7e=_0x28e15b['getFullYear'](),_0x5bf622=_0x11ba7e+'-'+_0x5a55f9+'-'+_0x4e7f31;const _0x86ed6f=new suppliers_payment({'invoice':_0x5a58ab,'date':_0x11ba7e+'-'+_0x5a55f9+'-'+_0x4e7f31,'suppliers':_0x4d9b20,'reason':'Paid\x20For\x20Purchase','amount':_0x43b2ce}),_0xb212b3=await _0x86ed6f[_0x24ea9d(0x1df)]();_0x401e8e[_0x24ea9d(0x16d)](_0x24ea9d(0x20e),_0x24ea9d(0x157)),_0x51a92d[_0x24ea9d(0x1cc)](_0x24ea9d(0x1f7));}catch(_0x582bf2){console[_0x24ea9d(0x20c)](_0x582bf2);}}),router[a0_0x1e096e(0x1e3)]('/invoice/:id',auth,async(_0x337ad4,_0x3fb688)=>{var _0x451cf1=a0_0x1e096e;try{const {username:_0x2454d5,email:_0x195ebf,role:_0x55bc84}=_0x337ad4[_0x451cf1(0x21c)],_0x296646=_0x337ad4['user'],_0x3910dc=await profile[_0x451cf1(0x12a)]({'email':_0x296646['email']}),_0x10e103=await master_shop[_0x451cf1(0x195)]();console['log'](_0x451cf1(0x159),_0x10e103);const _0x4da66a=_0x337ad4[_0x451cf1(0x155)]['id'],_0x2177e6=await purchases[_0x451cf1(0x1b1)](_0x4da66a);console[_0x451cf1(0x20c)](_0x2177e6);const _0x35fdb7=await suppliers[_0x451cf1(0x12a)]({'name':_0x2177e6[_0x451cf1(0x120)]});console[_0x451cf1(0x20c)](_0x35fdb7);if(_0x10e103[0x0][_0x451cf1(0x111)]==_0x451cf1(0x1d4)){var _0x383422=users[_0x451cf1(0x197)];console[_0x451cf1(0x20c)](_0x383422);}else{if(_0x10e103[0x0]['language']==_0x451cf1(0x1fd))var _0x383422=users[_0x451cf1(0x1fd)];else{if(_0x10e103[0x0][_0x451cf1(0x111)]==_0x451cf1(0x16b))var _0x383422=users[_0x451cf1(0x16b)];else{if(_0x10e103[0x0][_0x451cf1(0x111)]==_0x451cf1(0x144))var _0x383422=users[_0x451cf1(0x144)];else{if(_0x10e103[0x0][_0x451cf1(0x111)]==_0x451cf1(0x163))var _0x383422=users[_0x451cf1(0x163)];else{if(_0x10e103[0x0][_0x451cf1(0x111)]=='Portuguese\x20(BR)')var _0x383422=users['Portuguese'];else{if(_0x10e103[0x0][_0x451cf1(0x111)]=='Chinese')var _0x383422=users[_0x451cf1(0x218)];else{if(_0x10e103[0x0][_0x451cf1(0x111)]==_0x451cf1(0x139))var _0x383422=users[_0x451cf1(0x1f9)];}}}}}}}_0x3fb688['render']('purchase_invoice',{'success':_0x337ad4[_0x451cf1(0x16d)]('success'),'errors':_0x337ad4['flash'](_0x451cf1(0x177)),'role':_0x296646,'profile':_0x3910dc,'master_shop':_0x10e103,'supplier':_0x35fdb7,'purchase':_0x2177e6,'language':_0x383422});}catch(_0x3fdfcc){console[_0x451cf1(0x20c)](_0x3fdfcc);}}),router[a0_0x1e096e(0x1e3)](a0_0x1e096e(0x220),auth,async(_0x35e5ea,_0x2d293f)=>{var _0x3edfc6=a0_0x1e096e;try{const {username:_0x141099,email:_0x5d0bdc,role:_0x1049c7}=_0x35e5ea[_0x3edfc6(0x21c)],_0x2f0e14=_0x35e5ea[_0x3edfc6(0x21c)],_0xa9a06b=await profile['findOne']({'email':_0x2f0e14[_0x3edfc6(0x129)]}),_0x1c8e6b=await master_shop[_0x3edfc6(0x195)]();console[_0x3edfc6(0x20c)](_0x3edfc6(0x159),_0x1c8e6b);const _0x3d32a9=_0x35e5ea[_0x3edfc6(0x155)]['id'];console[_0x3edfc6(0x20c)](_0x3d32a9);const _0x5b2f9c=await purchases[_0x3edfc6(0x1b1)](_0x3d32a9);console[_0x3edfc6(0x20c)](_0x3edfc6(0x13b),_0x5b2f9c);const _0x5c3ca2=await product['find']({}),_0x330ac0=await warehouse[_0x3edfc6(0x110)]([{'$match':{'name':_0x5b2f9c['warehouse_name'],'room':_0x5b2f9c[_0x3edfc6(0x1eb)],'warehouse_category':_0x3edfc6(0x1e6)}},{'$unwind':_0x3edfc6(0x1e5)},{'$group':{'_id':_0x3edfc6(0x1a3),'name':{'$first':_0x3edfc6(0x1a5)},'product_stock':{'$first':_0x3edfc6(0x11e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3edfc6(0x1ee)},'type':{'$first':_0x3edfc6(0x12c)},'floorlevel':{'$first':_0x3edfc6(0x1b2)},'primary_code':{'$first':_0x3edfc6(0x18d)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3edfc6(0x207)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3edfc6(0x165)}}}]);warehouse_data=await warehouse[_0x3edfc6(0x110)]([{'$match':{'status':_0x3edfc6(0x125),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x3edfc6(0x21f),'name':{'$first':_0x3edfc6(0x21f)}}},{'$sort':{'name':0x1}}]),console[_0x3edfc6(0x20c)](_0x3edfc6(0x149),_0x330ac0);if(_0x1c8e6b[0x0]['language']=='English\x20(US)'){var _0xaddd08=users[_0x3edfc6(0x197)];console[_0x3edfc6(0x20c)](_0xaddd08);}else{if(_0x1c8e6b[0x0][_0x3edfc6(0x111)]==_0x3edfc6(0x1fd))var _0xaddd08=users[_0x3edfc6(0x1fd)];else{if(_0x1c8e6b[0x0][_0x3edfc6(0x111)]==_0x3edfc6(0x16b))var _0xaddd08=users[_0x3edfc6(0x16b)];else{if(_0x1c8e6b[0x0][_0x3edfc6(0x111)]=='Spanish')var _0xaddd08=users[_0x3edfc6(0x144)];else{if(_0x1c8e6b[0x0][_0x3edfc6(0x111)]==_0x3edfc6(0x163))var _0xaddd08=users[_0x3edfc6(0x163)];else{if(_0x1c8e6b[0x0]['language']==_0x3edfc6(0x16c))var _0xaddd08=users[_0x3edfc6(0x142)];else{if(_0x1c8e6b[0x0][_0x3edfc6(0x111)]==_0x3edfc6(0x218))var _0xaddd08=users[_0x3edfc6(0x218)];else{if(_0x1c8e6b[0x0][_0x3edfc6(0x111)]==_0x3edfc6(0x139))var _0xaddd08=users[_0x3edfc6(0x1f9)];}}}}}}}_0x2d293f['render'](_0x3edfc6(0x112),{'success':_0x35e5ea['flash'](_0x3edfc6(0x20e)),'errors':_0x35e5ea['flash'](_0x3edfc6(0x177)),'role':_0x2f0e14,'profile':_0xa9a06b,'user':_0x5b2f9c,'stock':_0x330ac0,'master_shop':_0x1c8e6b,'product':_0x5c3ca2,'language':_0xaddd08,'warehouse':warehouse_data});}catch(_0x2e08d5){console[_0x3edfc6(0x20c)](_0x2e08d5);}}),router[a0_0x1e096e(0x152)](a0_0x1e096e(0x220),auth,async(_0x3ec438,_0x30e7a5)=>{var _0x1b196b=a0_0x1e096e;try{const {invoice:_0x576eee,date:_0x13420f,warehouse_name:_0x1bf466,Room_name:_0x5f45ea,product_name:_0xc8b053,purchase_quantity:_0x540c6f,stocks:_0x5cbb8e,return_qty:_0x44d5bf,note:_0xce43da,level:_0x40f213,isle:_0x38c733,pallet:_0x45e4f7,to_warehouse_name:_0x20496f,to_Room_name:_0x4bcc81}=_0x3ec438['body'],_0x5aa9e2=await purchases[_0x1b196b(0x12a)]({'_id':_0x3ec438[_0x1b196b(0x155)]['id']}),_0x959930=await warehouse[_0x1b196b(0x12a)]({'name':_0x1bf466,'room':_0x5f45ea});if(typeof _0xc8b053==_0x1b196b(0x1c2))var _0x193787=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x19d)]],_0x743a08=[_0x3ec438['body'][_0x1b196b(0x1dc)]],_0x23e5bc=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1fa)]],_0x3e8beb=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1c5)]],_0x2573c2=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x18b)]],_0x6ac1dc=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x12e)]],_0x5af511=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1b7)]],_0x13dfc6=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x138)]],_0x15bfc5=[_0x3ec438[_0x1b196b(0x19e)]['product_code_hide']],_0x5b5320=[_0x3ec438['body'][_0x1b196b(0x1a2)]],_0x370df6=[_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x178)]];else var _0x193787=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x19d)]],_0x743a08=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1dc)]],_0x23e5bc=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1fa)]],_0x3e8beb=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1c5)]],_0x2573c2=[..._0x3ec438['body'][_0x1b196b(0x18b)]],_0x6ac1dc=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x12e)]],_0x5af511=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1b7)]],_0x13dfc6=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x138)]],_0x15bfc5=[..._0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x1a8)]],_0x5b5320=[..._0x3ec438[_0x1b196b(0x19e)]['primary_code_hide']],_0x370df6=[..._0x3ec438[_0x1b196b(0x19e)]['secondary_code_hide']];const _0x3f2b24=_0x193787[_0x1b196b(0x18a)](_0x32dbb2=>{return _0x32dbb2={'product_name':_0x32dbb2};});_0x743a08[_0x1b196b(0x21a)]((_0x3312ca,_0xc89e0d)=>{var _0x6ba1c2=_0x1b196b;_0x3f2b24[_0xc89e0d][_0x6ba1c2(0x1dc)]=_0x3312ca;}),_0x23e5bc[_0x1b196b(0x21a)]((_0xfee625,_0x5c07ea)=>{var _0xc22b28=_0x1b196b;_0x3f2b24[_0x5c07ea][_0xc22b28(0x18c)]=_0xfee625;}),_0x3e8beb['forEach']((_0x4a1aa7,_0x988f39)=>{var _0x524771=_0x1b196b;_0x3f2b24[_0x988f39][_0x524771(0x1c5)]=_0x4a1aa7;}),_0x2573c2[_0x1b196b(0x21a)]((_0x2540de,_0x4caaae)=>{var _0x930fe4=_0x1b196b;_0x3f2b24[_0x4caaae][_0x930fe4(0x133)]=_0x2540de;}),_0x6ac1dc['forEach']((_0x1ea3c0,_0x361081)=>{var _0x1721a6=_0x1b196b;_0x3f2b24[_0x361081][_0x1721a6(0x180)]=_0x1ea3c0;}),_0x5af511[_0x1b196b(0x21a)]((_0x2ff765,_0x28ed1d)=>{var _0x223dbc=_0x1b196b;_0x3f2b24[_0x28ed1d][_0x223dbc(0x188)]=_0x2ff765;}),_0x13dfc6[_0x1b196b(0x21a)]((_0x1c4062,_0x59b777)=>{_0x3f2b24[_0x59b777]['type']=_0x1c4062;}),_0x15bfc5[_0x1b196b(0x21a)]((_0x3e811a,_0xfb1dd)=>{var _0x1d01b4=_0x1b196b;_0x3f2b24[_0xfb1dd][_0x1d01b4(0x1c0)]=_0x3e811a;}),_0x5b5320[_0x1b196b(0x21a)]((_0x43a193,_0x2681aa)=>{var _0x1cc24e=_0x1b196b;_0x3f2b24[_0x2681aa][_0x1cc24e(0x1ea)]=_0x43a193;}),_0x370df6[_0x1b196b(0x21a)]((_0x339517,_0x57523e)=>{var _0x4f5f91=_0x1b196b;_0x3f2b24[_0x57523e][_0x4f5f91(0x176)]=_0x339517;}),_0x5aa9e2[_0x1b196b(0x1b0)][_0x1b196b(0x21a)](_0x5dca75=>{const _0x28172d=_0x959930['product_details']['map'](_0x34d869=>{var _0x5dd9a1=a0_0x549f;_0x34d869[_0x5dd9a1(0x19d)]==_0x5dca75[_0x5dd9a1(0x19d)]&&_0x34d869[_0x5dd9a1(0x188)]==_0x5dca75[_0x5dd9a1(0x188)]&&_0x34d869[_0x5dd9a1(0x158)]==_0x5dca75[_0x5dd9a1(0x158)]&&_0x34d869[_0x5dd9a1(0x180)]==_0x5dca75[_0x5dd9a1(0x180)]&&_0x34d869[_0x5dd9a1(0x133)]==_0x5dca75[_0x5dd9a1(0x133)]&&_0x34d869[_0x5dd9a1(0x1c4)]==_0x5dca75[_0x5dd9a1(0x1c4)]&&_0x34d869[_0x5dd9a1(0x114)]==_0x5dca75[_0x5dd9a1(0x114)]&&(console[_0x5dd9a1(0x20c)](parseInt(_0x34d869[_0x5dd9a1(0x150)])+'\x20<>\x20'+parseInt(_0x5dca75[_0x5dd9a1(0x208)])),_0x34d869[_0x5dd9a1(0x150)]=parseInt(_0x34d869['product_stock'])+parseInt(_0x5dca75[_0x5dd9a1(0x208)]));});}),await _0x959930['save']();const _0x140651=_0x3f2b24[_0x1b196b(0x1cb)](_0x5a95ff=>_0x5a95ff[_0x1b196b(0x1c5)]!=='0'&&_0x5a95ff[_0x1b196b(0x1c5)]!=='');var _0x18d8e5=0x0;_0x140651[_0x1b196b(0x21a)](_0x1cded4=>{var _0x180d1c=_0x1b196b;console[_0x180d1c(0x20c)](_0x180d1c(0x1de),_0x1cded4),(parseInt(_0x1cded4[_0x180d1c(0x1dc)])<parseInt(_0x1cded4[_0x180d1c(0x1c5)])||parseInt(_0x1cded4[_0x180d1c(0x18c)])<parseInt(_0x1cded4[_0x180d1c(0x1c5)]))&&_0x18d8e5++;});if(_0x18d8e5!=0x0)return _0x3ec438[_0x1b196b(0x16d)](_0x1b196b(0x177),_0x1b196b(0x183)),_0x30e7a5[_0x1b196b(0x1cc)](_0x1b196b(0x186));const _0x8c7445=new purchases_return({'invoice':_0x576eee,'suppliers':_0x3ec438[_0x1b196b(0x19e)][_0x1b196b(0x120)],'date':_0x13420f,'warehouse_name':_0x1bf466,'return_product':_0x140651,'note':_0xce43da,'room':_0x5f45ea,'to_warehouse_name':_0x20496f,'to_room':_0x4bcc81}),_0x53cf63=await _0x8c7445['save']();console[_0x1b196b(0x20c)](_0x8c7445);const _0x1e9963=await purchases_return[_0x1b196b(0x12a)]({'invoice':_0x576eee}),_0x52c1f0=await warehouse[_0x1b196b(0x12a)]({'name':_0x20496f,'room':_0x4bcc81});_0x1e9963['return_product'][_0x1b196b(0x21a)](_0x3e2ae8=>{var _0x4dd0cd=_0x1b196b,_0x1860ed=0x0;const _0x33a79f=_0x52c1f0[_0x4dd0cd(0x1a9)][_0x4dd0cd(0x18a)](_0x37cb3d=>{var _0x54b412=_0x4dd0cd;_0x37cb3d[_0x54b412(0x19d)]==_0x3e2ae8[_0x54b412(0x19d)]&&_0x37cb3d[_0x54b412(0x188)]==_0x3e2ae8['floorlevel']&&_0x37cb3d[_0x54b412(0x158)]==_0x3e2ae8[_0x54b412(0x158)]&&_0x37cb3d[_0x54b412(0x180)]==_0x3e2ae8[_0x54b412(0x180)]&&_0x37cb3d[_0x54b412(0x133)]==_0x3e2ae8['bay']&&(_0x37cb3d['product_stock']=parseInt(_0x37cb3d['product_stock'])-parseInt(_0x3e2ae8['return_qty']),_0x1860ed++);});_0x1860ed=='0'&&(_0x52c1f0[_0x4dd0cd(0x1a9)]=_0x52c1f0[_0x4dd0cd(0x1a9)][_0x4dd0cd(0x1d7)]({'product_name':_0x3e2ae8[_0x4dd0cd(0x19d)],'product_stock':_0x3e2ae8[_0x4dd0cd(0x1c5)],'primary_code':_0x3e2ae8['primary_code'],'secondary_code':_0x3e2ae8['secondary_code'],'product_code':_0x3e2ae8[_0x4dd0cd(0x1c0)],'storage':_0x3e2ae8[_0x4dd0cd(0x114)],'rack':_0x3e2ae8[_0x4dd0cd(0x1c4)],'bay':_0x3e2ae8['bay'],'bin':_0x3e2ae8[_0x4dd0cd(0x180)],'type':_0x3e2ae8['type'],'floorlevel':_0x3e2ae8[_0x4dd0cd(0x188)],'maxProducts':_0x3e2ae8[_0x4dd0cd(0x1ae)],'unit':_0x3e2ae8[_0x4dd0cd(0x17a)],'secondary_unit':_0x3e2ae8[_0x4dd0cd(0x161)],'expiry_date':_0x3e2ae8['expiry_date']}));}),await _0x52c1f0['save']();const _0x193c8d=await purchases[_0x1b196b(0x12a)]({'invoice':_0x576eee});_0x193c8d[_0x1b196b(0x181)]=_0x1b196b(0x1f0);const _0x4cb809=await _0x193c8d['save'](),_0x37a43f=new s_payment_data({'invoice':_0x576eee,'suppliers':_0x3ec438[_0x1b196b(0x19e)]['suppliers'],'reason':_0x1b196b(0x1e4)});await _0x37a43f[_0x1b196b(0x1df)]();const _0x19caf6=await master_shop[_0x1b196b(0x195)]();console[_0x1b196b(0x20c)](_0x1b196b(0x1db),_0x19caf6[0x0][_0x1b196b(0x160)]);const _0x41e430=await email_settings[_0x1b196b(0x12a)](),_0x3ac5d8=await suppliers[_0x1b196b(0x12a)]({'name':_0x3ec438['body'][_0x1b196b(0x120)]});console['log'](_0x1b196b(0x215),_0x3ac5d8);_0x19caf6[0x0]['currency_placement']==0x1?(right_currency=_0x19caf6[0x0][_0x1b196b(0x192)],left_currency=''):(right_currency='',left_currency=_0x19caf6[0x0][_0x1b196b(0x192)]);var _0x4be470=_0x193787,_0x4948cb=_0x3e8beb,_0xb8c713='',_0x46ac56;for(_0x46ac56 in _0x4be470){_0xb8c713+='<tr>'+_0x1b196b(0x119)+_0x4be470[_0x46ac56]+_0x1b196b(0x20a)+_0x1b196b(0x119)+_0x4948cb[_0x46ac56]+_0x1b196b(0x20a)+_0x1b196b(0x1a1);}console[_0x1b196b(0x20c)](_0x1b196b(0x16a),_0xb8c713);let _0x325d86=nodemailer['createTransport']({'service':_0x1b196b(0x135),'auth':{'user':_0x41e430[_0x1b196b(0x129)],'pass':_0x41e430[_0x1b196b(0x189)]}}),_0x5f5499={'from':_0x41e430[_0x1b196b(0x129)],'to':_0x3ac5d8['email'],'subject':_0x1b196b(0x12b),'attachments':[{'filename':_0x1b196b(0x123),'path':__dirname+_0x1b196b(0x15a)+'/upload/'+_0x19caf6[0x0][_0x1b196b(0x160)],'cid':_0x1b196b(0x173)}],'html':_0x1b196b(0x134)+'<html><head><title></title>'+_0x1b196b(0x13d)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1b196b(0x17c)+_0x1b196b(0x17b)+_0x1b196b(0x1a6)+'<div>'+_0x1b196b(0x1ff)+_0x19caf6[0x0][_0x1b196b(0x15f)]+'\x20</h2>'+'</div>'+_0x1b196b(0x1a6)+'<hr\x20class=\x22my-3\x22>'+_0x1b196b(0x17c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x576eee+'\x20'+_0x1b196b(0x1be)+'\x20Order\x20Date\x20:\x20'+_0x13420f+'\x20'+_0x1b196b(0x15c)+_0x1b196b(0x171)+_0x1b196b(0x1a6)+_0x1b196b(0x12f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x1b196b(0x1b6)+_0x1b196b(0x1bb)+_0x1b196b(0x18f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1b196b(0x1a1)+_0x1b196b(0x154)+_0x1b196b(0x148)+'\x20'+_0xb8c713+'\x20'+'</tbody>'+_0x1b196b(0x1b3)+'<div>'+_0x1b196b(0x19c)+_0x1b196b(0x1ef)+_0x19caf6[0x0]['site_title']+_0x1b196b(0x171)+_0x1b196b(0x1a6)+_0x1b196b(0x1a6)+'</body></html>'};_0x325d86[_0x1b196b(0x201)](_0x5f5499,function(_0xf7d0cd,_0x5d74c5){var _0x53fcc1=_0x1b196b;_0xf7d0cd?(console[_0x53fcc1(0x20c)](_0xf7d0cd),console[_0x53fcc1(0x20c)]('Error\x20Occurs')):console[_0x53fcc1(0x20c)](_0x53fcc1(0x140));}),_0x3ec438[_0x1b196b(0x16d)]('success',_0x1b196b(0x145)),_0x30e7a5[_0x1b196b(0x1cc)](_0x1b196b(0x1f7));}catch(_0x2b08cf){console['log'](_0x2b08cf),_0x30e7a5[_0x1b196b(0x13c)](0xc8)[_0x1b196b(0x1b8)]({'message':_0x2b08cf[_0x1b196b(0x10c)]});}}),router[a0_0x1e096e(0x1e3)](a0_0x1e096e(0x141),auth,async(_0x40e96e,_0x421ec6)=>{var _0x332a1a=a0_0x1e096e;try{const {username:_0x4d030a,email:_0xa370ad,role:_0x217181}=_0x40e96e[_0x332a1a(0x21c)],_0x354578=_0x40e96e[_0x332a1a(0x21c)],_0x49661a=await profile[_0x332a1a(0x12a)]({'email':_0x354578[_0x332a1a(0x129)]}),_0x1ecc82=await master_shop[_0x332a1a(0x195)](),_0x1ce15c=_0x40e96e['params']['id'],_0x1ecd4c=await purchases[_0x332a1a(0x1b1)](_0x1ce15c);if(_0x1ecc82[0x0][_0x332a1a(0x111)]==_0x332a1a(0x1d4))var _0x5a7c33=users[_0x332a1a(0x197)];else{if(_0x1ecc82[0x0]['language']==_0x332a1a(0x1fd))var _0x5a7c33=users[_0x332a1a(0x1fd)];else{if(_0x1ecc82[0x0][_0x332a1a(0x111)]==_0x332a1a(0x16b))var _0x5a7c33=users[_0x332a1a(0x16b)];else{if(_0x1ecc82[0x0][_0x332a1a(0x111)]=='Spanish')var _0x5a7c33=users['Spanish'];else{if(_0x1ecc82[0x0][_0x332a1a(0x111)]==_0x332a1a(0x163))var _0x5a7c33=users[_0x332a1a(0x163)];else{if(_0x1ecc82[0x0]['language']==_0x332a1a(0x16c))var _0x5a7c33=users[_0x332a1a(0x142)];else{if(_0x1ecc82[0x0][_0x332a1a(0x111)]==_0x332a1a(0x218))var _0x5a7c33=users[_0x332a1a(0x218)];else{if(_0x1ecc82[0x0]['language']==_0x332a1a(0x139))var _0x5a7c33=users[_0x332a1a(0x1f9)];}}}}}}}_0x421ec6['render'](_0x332a1a(0x14b),{'success':_0x40e96e[_0x332a1a(0x16d)](_0x332a1a(0x20e)),'errors':_0x40e96e[_0x332a1a(0x16d)](_0x332a1a(0x177)),'role':_0x354578,'profile':_0x49661a,'alldata':_0x1ecd4c,'master_shop':_0x1ecc82,'language':_0x5a7c33}),console[_0x332a1a(0x20c)](alldata);}catch(_0x5696d4){console[_0x332a1a(0x20c)](_0x5696d4);}}),router[a0_0x1e096e(0x152)](a0_0x1e096e(0x1da),async(_0x31ca7d,_0x4ba3e0)=>{var _0xd1f2b0=a0_0x1e096e;const {product_code:_0x163a3e}=_0x31ca7d[_0xd1f2b0(0x19e)];var _0x240349;const _0x464e2e=await product['aggregate']([{'$match':{'primary_code':_0x163a3e,'product_category':_0xd1f2b0(0x1e6)}},{'$group':{'_id':_0xd1f2b0(0x17f),'name':{'$first':'$name'},'category':{'$first':_0xd1f2b0(0x1aa)},'brand':{'$first':_0xd1f2b0(0x200)},'unit':{'$first':_0xd1f2b0(0x185)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0xd1f2b0(0x170)},'secondary_code':{'$first':_0xd1f2b0(0x11d)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0xd1f2b0(0x1d3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x43f411=await product[_0xd1f2b0(0x110)]([{'$match':{'secondary_code':_0x163a3e,'product_category':_0xd1f2b0(0x1e6)}},{'$group':{'_id':_0xd1f2b0(0x17f),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0xd1f2b0(0x200)},'unit':{'$first':_0xd1f2b0(0x185)},'alertquantity':{'$first':_0xd1f2b0(0x1e8)},'product_code':{'$first':_0xd1f2b0(0x166)},'primary_code':{'$first':_0xd1f2b0(0x170)},'secondary_code':{'$first':_0xd1f2b0(0x11d)},'maxStocks':{'$first':_0xd1f2b0(0x1d8)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x464e2e['length']>0x0)_0x240349=_0x464e2e;else _0x43f411[_0xd1f2b0(0x168)]>0x0&&(_0x240349=_0x43f411);_0x4ba3e0[_0xd1f2b0(0x1b8)](_0x240349);}),router[a0_0x1e096e(0x152)](a0_0x1e096e(0x1b5),async(_0x382298,_0x446bab)=>{var _0x3badff=a0_0x1e096e;const {primaryCode:_0x125746,secondaryCode:_0x244f5d,productCode:_0x343f92,bay:_0x516371,bin:_0x8f9d0f,types:_0x3ca136,pallet:_0x2bc807,warehouses:_0x21e749,room:_0x2e6d03}=_0x382298['body'];console['log'](_0x382298[_0x3badff(0x19e)]);try{const _0x4f46af=await warehouse[_0x3badff(0x110)]([{'$match':{'name':_0x21e749,'room':_0x2e6d03}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x516371,'product_details.bin':_0x8f9d0f,'product_details.type':_0x3ca136}},{'$group':{'_id':_0x3badff(0x1a3),'name':{'$first':_0x3badff(0x1a5)},'product_stock':{'$first':_0x3badff(0x11e)},'level':{'$first':_0x3badff(0x206)},'isle':{'$first':_0x3badff(0x130)},'pallet':{'$first':_0x3badff(0x10b)},'maxProducts':{'$first':_0x3badff(0x1bf)}}}]);_0x446bab['status'](0xc8)[_0x3badff(0x1b8)](_0x4f46af);}catch(_0x5c331c){_0x446bab['status'](0x194)[_0x3badff(0x1b8)]({'message':_0x5c331c[_0x3badff(0x10c)]});}}),module[a0_0x1e096e(0x16f)]=router;