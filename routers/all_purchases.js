var a0_0x13373b=a0_0x133e;(function(_0x463823,_0x428264){var _0x43b1b7=a0_0x133e,_0x3cd2c8=_0x463823();while(!![]){try{var _0x1ede4e=parseInt(_0x43b1b7(0x1f8))/0x1*(parseInt(_0x43b1b7(0x2b5))/0x2)+parseInt(_0x43b1b7(0x2ba))/0x3+-parseInt(_0x43b1b7(0x1f6))/0x4*(-parseInt(_0x43b1b7(0x29c))/0x5)+-parseInt(_0x43b1b7(0x2b8))/0x6+parseInt(_0x43b1b7(0x238))/0x7+parseInt(_0x43b1b7(0x2b2))/0x8*(parseInt(_0x43b1b7(0x294))/0x9)+-parseInt(_0x43b1b7(0x309))/0xa*(parseInt(_0x43b1b7(0x261))/0xb);if(_0x1ede4e===_0x428264)break;else _0x3cd2c8['push'](_0x3cd2c8['shift']());}catch(_0x1c0e74){_0x3cd2c8['push'](_0x3cd2c8['shift']());}}}(a0_0x53d9,0x3f008));const express=require(a0_0x13373b(0x259)),app=express(),router=express[a0_0x13373b(0x293)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x13373b(0x23b)),auth=require(a0_0x13373b(0x2d8)),nodemailer=require(a0_0x13373b(0x1fc));var ejs=require(a0_0x13373b(0x1fd));function a0_0x133e(_0x440f91,_0x383234){var _0x53d9c7=a0_0x53d9();return a0_0x133e=function(_0x133e9b,_0x589294){_0x133e9b=_0x133e9b-0x1e6;var _0xe17ee7=_0x53d9c7[_0x133e9b];return _0xe17ee7;},a0_0x133e(_0x440f91,_0x383234);}const path=require(a0_0x13373b(0x2e4)),users=require(a0_0x13373b(0x264));router[a0_0x13373b(0x23e)](a0_0x13373b(0x291),auth,async(_0x5a9219,_0x2ee84b)=>{var _0x5b7e6e=a0_0x13373b;try{const {username:_0x46bb15,email:_0x4d6877,role:_0x4fa70b}=_0x5a9219[_0x5b7e6e(0x2f4)],_0x11bdbc=_0x5a9219[_0x5b7e6e(0x2f4)],_0x417414=await profile[_0x5b7e6e(0x2c3)]({'email':_0x11bdbc[_0x5b7e6e(0x245)]}),_0x3c3897=await staff[_0x5b7e6e(0x2c3)]({'email':_0x11bdbc[_0x5b7e6e(0x245)]});if(_0x11bdbc[_0x5b7e6e(0x2a5)]==_0x5b7e6e(0x254)){const _0xf71fdc=await staff[_0x5b7e6e(0x2c3)]({'email':_0x11bdbc[_0x5b7e6e(0x245)]});}const _0x3d63de=await master_shop[_0x5b7e6e(0x2bc)]();let _0x28e168;if(_0x11bdbc['role']==_0x5b7e6e(0x254)){const _0xa94a5c=await staff[_0x5b7e6e(0x2c3)]({'email':_0x11bdbc[_0x5b7e6e(0x245)]});_0x28e168=await purchases[_0x5b7e6e(0x2d9)]([{'$match':{'warehouse_name':_0xa94a5c[_0x5b7e6e(0x2ea)]}},{'$lookup':{'from':_0x5b7e6e(0x24e),'localField':_0x5b7e6e(0x24e),'foreignField':'name','as':_0x5b7e6e(0x2fd)}},{'$unwind':_0x5b7e6e(0x2f9)},{'$unwind':_0x5b7e6e(0x1ea)},{'$group':{'_id':_0x5b7e6e(0x226),'invoice':{'$first':_0x5b7e6e(0x220)},'suppliers':{'$first':_0x5b7e6e(0x27a)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5b7e6e(0x200)},'room':{'$first':_0x5b7e6e(0x2a1)},'product':{'$push':_0x5b7e6e(0x1ea)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5b7e6e(0x1ee)},'return_data':{'$first':_0x5b7e6e(0x296)},'batch_code':{'$first':_0x5b7e6e(0x29a)},'expiry_date':{'$first':_0x5b7e6e(0x2b0)},'suppliers_docs':{'$first':_0x5b7e6e(0x2f9)},'total_product_quantity':{'$sum':_0x5b7e6e(0x280)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x5b7e6e(0x268)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x28e168=await purchases[_0x5b7e6e(0x2d9)]([{'$lookup':{'from':_0x5b7e6e(0x24e),'localField':_0x5b7e6e(0x24e),'foreignField':_0x5b7e6e(0x22c),'as':'suppliers_docs'}},{'$unwind':_0x5b7e6e(0x2f9)},{'$unwind':_0x5b7e6e(0x1ea)},{'$group':{'_id':_0x5b7e6e(0x226),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x5b7e6e(0x27a)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5b7e6e(0x200)},'room':{'$addToSet':_0x5b7e6e(0x300)},'product':{'$push':_0x5b7e6e(0x1ea)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x5b7e6e(0x1ee)},'return_data':{'$first':_0x5b7e6e(0x296)},'batch_code':{'$first':_0x5b7e6e(0x29a)},'expiry_date':{'$first':_0x5b7e6e(0x2b0)},'suppliers_docs':{'$first':_0x5b7e6e(0x2f9)},'total_product_quantity':{'$sum':_0x5b7e6e(0x280)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x5b7e6e(0x22b)},'floorlevel':{'$addToSet':_0x5b7e6e(0x1f2)},'finalize':{'$first':_0x5b7e6e(0x20f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x3d63de[0x0][_0x5b7e6e(0x237)]=='English\x20(US)'){var _0x4cbf56=users['English'];console[_0x5b7e6e(0x2bf)](_0x4cbf56);}else{if(_0x3d63de[0x0][_0x5b7e6e(0x237)]==_0x5b7e6e(0x2f7))var _0x4cbf56=users['Hindi'];else{if(_0x3d63de[0x0][_0x5b7e6e(0x237)]==_0x5b7e6e(0x244))var _0x4cbf56=users['German'];else{if(_0x3d63de[0x0][_0x5b7e6e(0x237)]==_0x5b7e6e(0x2e2))var _0x4cbf56=users[_0x5b7e6e(0x2e2)];else{if(_0x3d63de[0x0][_0x5b7e6e(0x237)]==_0x5b7e6e(0x2fa))var _0x4cbf56=users[_0x5b7e6e(0x2fa)];else{if(_0x3d63de[0x0][_0x5b7e6e(0x237)]==_0x5b7e6e(0x28c))var _0x4cbf56=users['Portuguese'];else{if(_0x3d63de[0x0][_0x5b7e6e(0x237)]=='Chinese')var _0x4cbf56=users[_0x5b7e6e(0x236)];else{if(_0x3d63de[0x0]['language']=='Arabic\x20(ae)')var _0x4cbf56=users[_0x5b7e6e(0x2f3)];}}}}}}}_0x2ee84b['render']('all_purchases',{'success':_0x5a9219[_0x5b7e6e(0x255)](_0x5b7e6e(0x251)),'errors':_0x5a9219[_0x5b7e6e(0x255)]('errors'),'purchases':_0x28e168,'role':_0x11bdbc,'profile':_0x417414,'master_shop':_0x3d63de,'language':_0x4cbf56});}catch(_0x4645ca){console[_0x5b7e6e(0x2bf)]('table\x20page',_0x4645ca),_0x2ee84b[_0x5b7e6e(0x2a3)](0xc8)[_0x5b7e6e(0x28f)]({'message':_0x4645ca[_0x5b7e6e(0x209)]});}});function a0_0x53d9(){var _0x13bf91=['product_code','\x20<>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.pallet','</span>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/CheckingWarehouse','$maxStocks','../middleware/auth','aggregate','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/view/add_purchases','sendMail','then','purchases\x20item\x20return\x20successfull','<tbody\x20style=\x22text-align:\x20center;\x22>','currency','floorlevel','Spanish','/view/add_purchases/:id','path','isle','$brand','padStart','purchase_invoice','Rack\x20D','warehouse','password','prod_unit','Enabled','prod_code','room','primary_code_hide','Rack\x20A','rak','Arabic','user','$product_details.bin','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Hindi','edit_purchases','$suppliers_docs','French','stocks','<h2>\x20','suppliers_docs','return_qty','due_amount','$product.room_name','foreach\x20newproduct','/preview/:id','secondary_unit','floor','DRY\x20STORAGE','logo','params','findById','47830sIJiYP','<h5>','site_title','alertQTY','types','secondary_code','prod_isle','$product','Room_name','RMSEmail','/invoice/:id','$due_amount','</h5>','all','secondary_code_hide','$product.floorlevel','$secondary_unit','type','$product_code','178268qBFWkX','actual_qty','17PdcBRJ','True','primary_code','/view/:id','nodemailer','ejs','/view/return_purchase/:id','product_code_hide','$warehouse_name','concat','JO_number','string','$secondary_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','random','return_purchase','An\x20error\x20occurred.','message','length','prod_qty','maxperunit','RoomAssign','prod_invoice','$finalize','body','$product_details.bay','$product_details.floorlevel','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','prod_Qty','post','<tr>','Purchase\x20Return','Receiving\x20Area','actual_uom','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','push','Enclosed','add_purchases','Portuguese','$invoice','\x20</h2>','paid_amount','<div>','$category','Rack\x20B','$_id','INC-','$product_details','$maxProdPerUnit','currency_placement','$product.type','name','forEach','bin','render','/all_purchases/view','abs','return_data','all_purchases_barcode','</table>','</div>','Chinese','language','35693FJVUie','catch','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','../models/all_models','<html><head><title></title>','prod_name','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','edit_purchases_view','German','email','redirect','maxStocks','</tr>','\x20<\x20wew\x20>\x20','$unit','English','$name','$alertquantity','suppliers','<!DOCTYPE\x20html>','master','success','\x20Order\x20Date\x20:\x20','room_name','staff','flash','</tbody>','back','$product_details.primary_code','express','slice','COLD\x20STORAGE','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details._id','Floor','map','781vnthlC','Purchase\x20Return\x20Mail','$product_details.product_name','../public/language/languages.json','production_date','$product_details.expiry_date','$product_details.type','$product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/../public','product_cat','$primary_code','product_list','product_stock','save','</head><body>','<hr\x20class=\x22my-3\x22>','batch_code','purchase_quantity','$product_details.secondary_code','/all_purchases/view/','image','\x20Order\x20Number\x20:\x20','</td>','deliverycode','$suppliers','standard_unit','$product_details.maxProducts','Rack\x20E','Email\x20sent\x20successfully','storage','$product.quantity','return_product','Level','getDate','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product','Return\x20Goods','prod_cat','</thead>','prod_secondunit','Ambient','add_purchases\x20error','Portuguese\x20(BR)','$product_details.product_code','getFullYear','json','Rack\x20F','/view','Logo.png','Router','63RGCKln','payment\x20successfull','$return_data','note','English\x20(US)','/give_payment/:id','$batch_code','expiry_date','35rFKjlf','prod_pallet','</body></html>','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$room','stock_quantity','status','Sales\x20Update\x20successfully','role','level','/upload/','date','Shelves','prod_level','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','purchase\x20data\x20update\x20successfully','finalize','delivery_date','exports','$expiry_date','delivery_code','159576giETCE','Arabic\x20(ae)','$product_details.storage','26674VtNSCW','MaxStocks_data','errors','531366PlPKwq','error','8352PEMTHY','prod_primunit','find','product_name','<h5\x20style=\x22text-align:\x20left;\x22>','log','bay','Raw\x20Materials','product_details','findOne','Purchase\x20data\x20added\x20successfully','quantity','createTransport','rack','<strong>\x20Regards\x20</strong>','filter','pallet','stock_data','$product_details.product_stock','invoice','$product_details.level','<span\x20style=\x22float:\x20right;\x22>'];a0_0x53d9=function(){return _0x13bf91;};return a0_0x53d9();}function BayBinSelected(_0x57ac6d,_0x439d4c){var _0x3d1d90=a0_0x13373b,_0x12e7b1=[],_0x595811=[],_0x422ef8=[],_0x2e5b49=[],_0x20d05a=[],_0x2cd810=[];let _0x1438d8=[];if(_0x57ac6d==_0x3d1d90(0x305))switch(_0x439d4c){case'Rack\x20A':_0x12e7b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x595811=[0x1,0x2],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=['Level',_0x3d1d90(0x25f)],_0x20d05a=['D'],_0x2cd810=['A'];break;case'Rack\x20B':_0x12e7b1=[0x6,0x5,0x4,0x3,0x2,0x1],_0x595811=[0x1,0x2],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=[_0x3d1d90(0x282),_0x3d1d90(0x25f)],_0x20d05a=['D'],_0x2cd810=['B'];break;case _0x3d1d90(0x2a9):_0x12e7b1=[0x0],_0x595811=[0x0],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=[_0x3d1d90(0x25f)],_0x20d05a=['D'],_0x2cd810=['S'];break;case _0x3d1d90(0x218):_0x12e7b1=[0x0],_0x595811=[0x0],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x422ef8=[_0x3d1d90(0x25f)],_0x20d05a=['D'],_0x2cd810=['R'];break;}else{if(_0x57ac6d==_0x3d1d90(0x25b))switch(_0x439d4c){case _0x3d1d90(0x2f1):_0x12e7b1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x595811=['B','F'],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=[_0x3d1d90(0x282),_0x3d1d90(0x25f)],_0x20d05a=['C'],_0x2cd810=['A'];break;case _0x3d1d90(0x225):_0x12e7b1=[0x5,0x4,0x3,0x2,0x1],_0x595811=['F','B','S'],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=[_0x3d1d90(0x282),_0x3d1d90(0x25f)],_0x20d05a=['C'],_0x2cd810=['B'];break;case'Rack\x20C':_0x12e7b1=[0x1,0x2,0x3,0x4,0x5],_0x595811=['B','F','S'],_0x2e5b49=[0x5,0x4,0x3,0x2,0x1],_0x422ef8=[_0x3d1d90(0x282),_0x3d1d90(0x25f)],_0x20d05a=['C'],_0x2cd810=['C'];break;case _0x3d1d90(0x2e9):_0x12e7b1=[0x5,0x4,0x3,0x2,0x1],_0x595811=['F','B','S'],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=[_0x3d1d90(0x282),_0x3d1d90(0x25f)],_0x20d05a=['C'],_0x2cd810=['D'];break;case _0x3d1d90(0x27d):_0x12e7b1=[0x4,0x3,0x2,0x1],_0x595811=[0x1,0x2],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=['Level',_0x3d1d90(0x25f)],_0x20d05a=['C'],_0x2cd810=['E'];break;case _0x3d1d90(0x290):_0x12e7b1=[0x1,0x2,0x3],_0x595811=[0x1,0x2],_0x2e5b49=[0x1,0x2,0x3,0x4,0x5],_0x422ef8=[_0x3d1d90(0x282)],_0x20d05a=['C'],_0x2cd810=['F'];break;}}return{'levels':_0x12e7b1,'Isle':_0x595811,'rack':_0x2e5b49,'type':_0x422ef8,'storage':_0x20d05a,'rak':_0x2cd810};}async function getRandom8DigitNumber(){var _0x3ce246=a0_0x13373b;const _0x582b5c=0x989680,_0x1dd82a=0x5f5e0ff,_0x5834d6=Math[_0x3ce246(0x304)](Math[_0x3ce246(0x206)]()*(_0x1dd82a-_0x582b5c+0x1))+_0x582b5c;var _0x50a318;const _0x2bbda8=await purchases[_0x3ce246(0x2c3)]({'invoice':_0x3ce246(0x227)+_0x5834d6});return _0x2bbda8&&_0x2bbda8[_0x3ce246(0x20a)]>0x0?_0x50a318=_0x3ce246(0x227)+_0x5834d6:_0x50a318=_0x3ce246(0x227)+_0x5834d6,_0x50a318;}router[a0_0x13373b(0x23e)](a0_0x13373b(0x2db),auth,async(_0x1de734,_0x2fb4a7)=>{var _0x21eea8=a0_0x13373b;try{const {username:_0x50bc65,email:_0x2aa714,role:_0x2852dd}=_0x1de734['user'],_0x2aefc3=_0x1de734[_0x21eea8(0x2f4)],_0x299854=await profile[_0x21eea8(0x2c3)]({'email':_0x2aefc3[_0x21eea8(0x245)]}),_0x4311f7=await master_shop[_0x21eea8(0x2bc)](),_0x52aacd=await staff[_0x21eea8(0x2c3)]({'email':_0x2aefc3['email']}),_0x4a9604=await suppliers[_0x21eea8(0x2bc)]({});let _0x3ee51e;if(_0x2aefc3[_0x21eea8(0x2a5)]==_0x21eea8(0x254)){const _0xadc941=await staff['findOne']({'email':_0x2aefc3[_0x21eea8(0x245)]});_0x3ee51e=await warehouse[_0x21eea8(0x2d9)]([{'$match':{'status':_0x21eea8(0x2ed),'name':_0xadc941[_0x21eea8(0x2ea)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x21eea8(0x286)}}},{'$group':{'_id':_0x21eea8(0x24c),'name':{'$first':_0x21eea8(0x24c)}}}]);}else _0x3ee51e=await warehouse[_0x21eea8(0x2d9)]([{'$match':{'status':_0x21eea8(0x2ed),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x21eea8(0x286)}}},{'$group':{'_id':_0x21eea8(0x24c),'name':{'$first':_0x21eea8(0x24c)}}}]);const _0x47cc63=await product[_0x21eea8(0x2bc)]({}),_0x25ba88=await warehouse[_0x21eea8(0x2bc)]({'status':_0x21eea8(0x2ed)}),_0x5b47c6=await purchases['find']({}),_0x4a824e=_0x5b47c6[_0x21eea8(0x20a)]+0x1,_0x3b36c8=_0x21eea8(0x227)+_0x4a824e['toString']()[_0x21eea8(0x2e7)](0x5,'0');var _0x55905d=[_0x21eea8(0x28a),_0x21eea8(0x21d)];if(_0x4311f7[0x0][_0x21eea8(0x237)]==_0x21eea8(0x298))var _0x15672d=users['English'];else{if(_0x4311f7[0x0][_0x21eea8(0x237)]==_0x21eea8(0x2f7))var _0x15672d=users[_0x21eea8(0x2f7)];else{if(_0x4311f7[0x0][_0x21eea8(0x237)]==_0x21eea8(0x244))var _0x15672d=users[_0x21eea8(0x244)];else{if(_0x4311f7[0x0][_0x21eea8(0x237)]=='Spanish')var _0x15672d=users['Spanish'];else{if(_0x4311f7[0x0][_0x21eea8(0x237)]==_0x21eea8(0x2fa))var _0x15672d=users[_0x21eea8(0x2fa)];else{if(_0x4311f7[0x0]['language']=='Portuguese\x20(BR)')var _0x15672d=users[_0x21eea8(0x21f)];else{if(_0x4311f7[0x0]['language']=='Chinese')var _0x15672d=users[_0x21eea8(0x236)];else{if(_0x4311f7[0x0]['language']==_0x21eea8(0x2b3))var _0x15672d=users[_0x21eea8(0x2f3)];}}}}}}}const _0x317032=getRandom8DigitNumber();_0x317032[_0x21eea8(0x2dd)](_0x367d56=>{var _0x52f7fd=_0x21eea8;_0x2fb4a7[_0x52f7fd(0x22f)](_0x52f7fd(0x21e),{'success':_0x1de734['flash'](_0x52f7fd(0x251)),'errors':_0x1de734[_0x52f7fd(0x255)]('errors'),'role':_0x2aefc3,'profile':_0x299854,'suppliers':_0x4a9604,'warehouse':_0x3ee51e,'product':_0x47cc63,'invoice':_0x367d56,'master_shop':_0x4311f7,'language':_0x15672d,'find_data':_0x25ba88,'rooms_data':_0x55905d});})[_0x21eea8(0x239)](_0x4d4deb=>{var _0x215e7f=_0x21eea8;_0x1de734[_0x215e7f(0x255)](_0x215e7f(0x2b7),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x2fb4a7[_0x215e7f(0x246)](_0x215e7f(0x230));});}catch(_0x4fe6fb){console[_0x21eea8(0x2bf)](_0x4fe6fb);}}),router[a0_0x13373b(0x23e)](a0_0x13373b(0x2e3),auth,async(_0xebee77,_0x545932)=>{var _0x3b1d58=a0_0x13373b;try{const _0x69dd78=_0xebee77['params']['id'];console[_0x3b1d58(0x2bf)](_0x69dd78);const _0x133da4=await master_shop['find']();console['log'](_0x3b1d58(0x250),_0x133da4);const _0xd8985a=await product[_0x3b1d58(0x2c3)]({'name':_0x69dd78});console[_0x3b1d58(0x2bf)]('product',_0xd8985a),_0x545932['status'](0xc8)[_0x3b1d58(0x28f)]({'product_data':_0xd8985a,'master':_0x133da4});}catch(_0x2ab8ea){console[_0x3b1d58(0x2bf)](_0x3b1d58(0x28b),_0x2ab8ea);}}),router['post'](a0_0x13373b(0x2db),auth,async(_0x4b93a6,_0x5afd53)=>{var _0x5a15bd=a0_0x13373b;try{const {invoice:_0x508f89,date:_0xb578fa,warehouse_name:_0xc34b2b,prod_name:_0x420f19,prod_code:_0x158258,prod_qty:_0x5824a4,prod_unit:_0x2bf1e1,prod_secondunit:_0x238749,prod_level:_0x1c646e,prod_isle:_0x3ee4fe,prod_pallet:_0x2b1a9b,note:_0x3b3536,expiry_date:_0x5dad02,batch_code:_0x46e73a,payable:_0x4cf8c2,due_amount:_0x279523,Room_name:_0xe6dec1,primary_code:_0x236aaa,secondary_code:_0x3db16c,MaxStocks_data:_0x174f53,PO_number:_0x190c11,SCRN:_0x18acaa,JO_number:_0x5429cb}=_0x4b93a6[_0x5a15bd(0x210)];if(typeof _0x420f19==_0x5a15bd(0x203))var _0x27337b=[_0x4b93a6[_0x5a15bd(0x210)]['prod_name']],_0x2143af=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x2ee)]],_0x39799d=[_0x4b93a6['body'][_0x5a15bd(0x214)]],_0x2381ca=[_0x4b93a6['body']['prod_primunit']],_0x2f159e=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x289)]],_0x4ea373=[_0x4b93a6['body'][_0x5a15bd(0x2aa)]],_0x4d498e=[_0x4b93a6[_0x5a15bd(0x210)]['primary_code']],_0x4854c6=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1e8)]],_0x48c037=[_0x4b93a6[_0x5a15bd(0x210)]['MaxStocks_data']],_0x371692=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x272)]],_0x36e0e6=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x29b)]],_0x53099b=[_0x4b93a6[_0x5a15bd(0x210)]['max_product_unit']],_0x45bef5=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1e6)]],_0x568116=[_0x4b93a6['body'][_0x5a15bd(0x265)]],_0xe6884a=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x287)]],_0x1c233c=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x20d)]],_0x4192fe=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x279)]],_0x3bb825=[_0x4b93a6['body'][_0x5a15bd(0x20e)]],_0x47cec0=[_0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1f7)]],_0x2fadae=[_0x4b93a6[_0x5a15bd(0x210)]['actual_uom']];else var _0x27337b=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x23d)]],_0x2143af=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x2ee)]],_0x39799d=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x214)]],_0x2381ca=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x2bb)]],_0x2f159e=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x289)]],_0x4ea373=[..._0x4b93a6['body']['prod_level']],_0x4d498e=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1fa)]],_0x4854c6=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1e8)]],_0x48c037=[..._0x4b93a6[_0x5a15bd(0x210)]['MaxStocks_data']],_0x371692=[..._0x4b93a6[_0x5a15bd(0x210)]['batch_code']],_0x36e0e6=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x29b)]],_0x53099b=[..._0x4b93a6[_0x5a15bd(0x210)]['max_product_unit']],_0x45bef5=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1e6)]],_0x568116=[..._0x4b93a6['body']['production_date']],_0xe6884a=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x287)]],_0x1c233c=[..._0x4b93a6['body'][_0x5a15bd(0x20d)]],_0x4192fe=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x279)]],_0x3bb825=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x20e)]],_0x47cec0=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x1f7)]],_0x2fadae=[..._0x4b93a6[_0x5a15bd(0x210)][_0x5a15bd(0x219)]];const _0x11d07d=_0x27337b[_0x5a15bd(0x260)](_0x2520ef=>{return _0x2520ef={'product_name':_0x2520ef};});_0x47cec0[_0x5a15bd(0x22d)]((_0x33ed5c,_0x264119)=>{var _0x30f530=_0x5a15bd;_0x11d07d[_0x264119][_0x30f530(0x1f7)]=Math[_0x30f530(0x231)](_0x33ed5c);}),_0x2fadae['forEach']((_0xdf520d,_0x2cb256)=>{_0x11d07d[_0x2cb256]['actual_uom']=_0xdf520d;}),_0x2143af[_0x5a15bd(0x22d)]((_0x2ba56b,_0x51866f)=>{_0x11d07d[_0x51866f]['product_code']=_0x2ba56b;}),_0x39799d[_0x5a15bd(0x22d)]((_0x357890,_0xe8b64a)=>{_0x11d07d[_0xe8b64a]['quantity']=Math['abs'](_0x357890);}),_0x2381ca['forEach']((_0x27b40d,_0xa52c22)=>{var _0xcbe16e=_0x5a15bd;_0x11d07d[_0xa52c22][_0xcbe16e(0x27b)]=_0x27b40d;}),_0x2f159e[_0x5a15bd(0x22d)]((_0x238555,_0x2b0ffd)=>{var _0x33e083=_0x5a15bd;_0x11d07d[_0x2b0ffd][_0x33e083(0x303)]=_0x238555;}),_0x4ea373['forEach']((_0x5650dc,_0x1f26e2)=>{_0x1c233c['forEach']((_0x55d9ff,_0x52a050)=>{var _0x47d9e7=a0_0x133e;if(_0x55d9ff==_0x47d9e7(0x218)&&_0x1f26e2==_0x52a050){console['log'](_0x55d9ff+_0x47d9e7(0x249)+_0x1f26e2+_0x47d9e7(0x2d1)+_0x52a050+'\x20<>\x20'+_0x5650dc);var _0x44cab7=_0x5650dc[_0x47d9e7(0x25a)](0x3);_0x11d07d[_0x1f26e2]['storage']=_0x5650dc[0x0],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c7)]=_0x5650dc[0x1],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c0)]=0x0,_0x11d07d[_0x1f26e2][_0x47d9e7(0x22e)]=0x0,_0x11d07d[_0x1f26e2][_0x47d9e7(0x1f4)]='Floor',_0x11d07d[_0x1f26e2][_0x47d9e7(0x2e1)]=_0x44cab7;}else{if(_0x55d9ff==_0x47d9e7(0x2a9)&&_0x1f26e2==_0x52a050){var _0x44cab7=_0x5650dc[_0x47d9e7(0x25a)](0x3);_0x11d07d[_0x1f26e2][_0x47d9e7(0x27f)]=_0x5650dc[0x0],_0x11d07d[_0x1f26e2]['rack']=_0x5650dc[0x1],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c0)]=0x0,_0x11d07d[_0x1f26e2][_0x47d9e7(0x22e)]=0x0,_0x11d07d[_0x1f26e2][_0x47d9e7(0x1f4)]=_0x47d9e7(0x25f),_0x11d07d[_0x1f26e2][_0x47d9e7(0x2e1)]=_0x5650dc[0x5];}else{if(_0x1f26e2==_0x52a050){if(_0x5650dc[0x0]=='A'&&_0x5650dc[0x1]=='L'&&_0x5650dc[0x2]=='L')console[_0x47d9e7(0x2bf)](_0x55d9ff+'\x20<>\x20'+_0x1f26e2+_0x47d9e7(0x2d1)+_0x52a050+_0x47d9e7(0x2d1)+_0x5650dc+'here'),_0x11d07d[_0x1f26e2][_0x47d9e7(0x27f)]=_0x5650dc[0x0],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c7)]=_0x5650dc[0x1],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c0)]=0x0,_0x11d07d[_0x1f26e2]['bin']=0x0,_0x11d07d[_0x1f26e2][_0x47d9e7(0x1f4)]=_0x47d9e7(0x25f),_0x11d07d[_0x1f26e2][_0x47d9e7(0x2e1)]=_0x5650dc[0x3];else{var _0x24417d;if(_0x5650dc[0x4]=='L')_0x24417d='Level';else _0x5650dc[0x4]=='F'&&(_0x24417d=_0x47d9e7(0x25f));_0x11d07d[_0x1f26e2][_0x47d9e7(0x27f)]=_0x5650dc[0x0],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c7)]=_0x5650dc[0x1],_0x11d07d[_0x1f26e2][_0x47d9e7(0x2c0)]=_0x5650dc[0x2],_0x11d07d[_0x1f26e2][_0x47d9e7(0x22e)]=_0x5650dc[0x3],_0x11d07d[_0x1f26e2][_0x47d9e7(0x1f4)]=_0x24417d,_0x11d07d[_0x1f26e2]['floorlevel']=_0x5650dc[0x5];}}}}});}),_0x4d498e[_0x5a15bd(0x22d)]((_0x5b0f33,_0x15b5c9)=>{var _0x54fc52=_0x5a15bd;_0x11d07d[_0x15b5c9][_0x54fc52(0x1fa)]=_0x5b0f33;}),_0x4854c6['forEach']((_0x444af6,_0x1c511a)=>{var _0x34fb80=_0x5a15bd;_0x11d07d[_0x1c511a][_0x34fb80(0x1e8)]=_0x444af6;}),_0x48c037['forEach']((_0x4a5e2b,_0x21afd3)=>{_0x11d07d[_0x21afd3]['maxStocks']=_0x4a5e2b;}),_0x371692[_0x5a15bd(0x22d)]((_0x4f95c0,_0x31c7cb)=>{var _0x586741=_0x5a15bd;_0x11d07d[_0x31c7cb][_0x586741(0x272)]=_0x4f95c0;}),_0x36e0e6[_0x5a15bd(0x22d)]((_0x2e8c83,_0x54210a)=>{var _0x3480ad=_0x5a15bd;_0x11d07d[_0x54210a][_0x3480ad(0x29b)]=_0x2e8c83;}),_0x53099b[_0x5a15bd(0x22d)]((_0x291195,_0x2aba2f)=>{var _0x26a196=_0x5a15bd;_0x11d07d[_0x2aba2f][_0x26a196(0x20c)]=_0x291195;}),_0x45bef5[_0x5a15bd(0x22d)]((_0x1003d5,_0x54cf88)=>{var _0x280392=_0x5a15bd;_0x11d07d[_0x54cf88][_0x280392(0x1e6)]=_0x1003d5;}),_0x568116[_0x5a15bd(0x22d)]((_0x5d6d70,_0x4064fe)=>{_0x11d07d[_0x4064fe]['production_date']=_0x5d6d70;}),_0xe6884a['forEach']((_0x557cea,_0x460bfd)=>{var _0x19412f=_0x5a15bd;_0x11d07d[_0x460bfd][_0x19412f(0x26b)]=_0x557cea;}),_0x1c233c[_0x5a15bd(0x22d)]((_0x167d20,_0x5ba9a2)=>{var _0x36336e=_0x5a15bd;_0x11d07d[_0x5ba9a2][_0x36336e(0x253)]=_0x167d20;}),_0x4192fe[_0x5a15bd(0x22d)]((_0x4651a4,_0x1f6043)=>{var _0x19997c=_0x5a15bd;_0x11d07d[_0x1f6043][_0x19997c(0x2b1)]=_0x4651a4;}),_0x3bb825[_0x5a15bd(0x22d)]((_0x2ba783,_0x223187)=>{var _0x21c667=_0x5a15bd;_0x11d07d[_0x223187][_0x21c667(0x2cd)]=_0x2ba783;});const _0xd6d3f9=_0x1c233c[_0x5a15bd(0x260)](_0x414a51=>{return _0x414a51={'room_name':_0x414a51};}),_0x2177ba=_0x11d07d['filter'](_0x3a1dad=>_0x3a1dad['quantity']!=='0'&&_0x3a1dad[_0x5a15bd(0x2c5)]!==''),_0x1c9fae=new purchases({'invoice':_0x508f89,'suppliers':_0x4b93a6['body'][_0x5a15bd(0x24e)],'date':_0xb578fa,'warehouse_name':_0xc34b2b,'product':_0x2177ba,'note':_0x3b3536,'due_amount':_0x279523,'POnumber':_0x190c11,'SCRN':_0x18acaa,'JO_number':_0x5429cb,'roomList':_0xd6d3f9}),_0x3b1ca8=await _0x1c9fae[_0x5a15bd(0x26f)](),_0x185159=await purchases[_0x5a15bd(0x2c3)]({'invoice':_0x508f89}),_0x3a2857=_0x185159[_0x5a15bd(0x285)][_0x5a15bd(0x260)](async _0x36c3a7=>{var _0x159c25=_0x5a15bd,_0x3fe1af=await warehouse['findOne']({'name':_0xc34b2b,'room':_0x36c3a7['room_name']}),_0x2fe9dd=0x0;return _0x3fe1af['product_details'][_0x159c25(0x22d)](_0x5081b1=>{var _0x48dbce=_0x159c25;_0x5081b1[_0x48dbce(0x2bd)]==_0x36c3a7[_0x48dbce(0x2bd)]&&_0x5081b1['floorlevel']==_0x36c3a7[_0x48dbce(0x2e1)]&&_0x5081b1[_0x48dbce(0x1f4)]==_0x36c3a7[_0x48dbce(0x1f4)]&&_0x5081b1[_0x48dbce(0x22e)]==_0x36c3a7[_0x48dbce(0x22e)]&&_0x5081b1[_0x48dbce(0x2c0)]==_0x36c3a7['bay']&&_0x5081b1[_0x48dbce(0x2c7)]==_0x36c3a7[_0x48dbce(0x2c7)]&&_0x5081b1[_0x48dbce(0x27f)]==_0x36c3a7[_0x48dbce(0x27f)]&&_0x5081b1[_0x48dbce(0x29b)]==_0x36c3a7[_0x48dbce(0x29b)]&&_0x5081b1[_0x48dbce(0x272)]==_0x36c3a7['batch_code']&&_0x5081b1[_0x48dbce(0x265)]==_0x36c3a7['production_date']&&_0x5081b1[_0x48dbce(0x2cd)]==_0x185159['invoice']&&(_0x5081b1[_0x48dbce(0x26e)]+=Math[_0x48dbce(0x231)](_0x36c3a7['quantity']),_0x2fe9dd++);}),_0x2fe9dd===0x0&&_0x3fe1af[_0x159c25(0x2c2)][_0x159c25(0x21c)]({'product_name':_0x36c3a7[_0x159c25(0x2bd)],'product_stock':Math[_0x159c25(0x231)](_0x36c3a7[_0x159c25(0x2c5)]),'primary_code':_0x36c3a7[_0x159c25(0x1fa)],'secondary_code':_0x36c3a7[_0x159c25(0x1e8)],'product_code':_0x36c3a7[_0x159c25(0x2d0)],'storage':_0x36c3a7[_0x159c25(0x27f)],'rack':_0x36c3a7[_0x159c25(0x2c7)],'bay':_0x36c3a7['bay'],'bin':_0x36c3a7[_0x159c25(0x22e)],'type':_0x36c3a7[_0x159c25(0x1f4)],'floorlevel':_0x36c3a7[_0x159c25(0x2e1)],'maxProducts':_0x36c3a7[_0x159c25(0x247)],'unit':_0x36c3a7[_0x159c25(0x27b)],'secondary_unit':_0x36c3a7[_0x159c25(0x303)],'expiry_date':_0x36c3a7[_0x159c25(0x29b)],'maxPerUnit':_0x36c3a7[_0x159c25(0x20c)],'batch_code':_0x36c3a7['batch_code'],'alertQTY':_0x36c3a7[_0x159c25(0x1e6)],'production_date':_0x36c3a7['production_date'],'product_cat':_0x36c3a7['product_cat'],'invoice':_0x36c3a7[_0x159c25(0x2cd)],'actual_qty':Math['abs'](_0x36c3a7[_0x159c25(0x1f7)]),'actual_uom':_0x36c3a7[_0x159c25(0x219)]}),_0x3fe1af;});Promise[_0x5a15bd(0x1f0)](_0x3a2857)[_0x5a15bd(0x2dd)](async _0xfbbfb3=>{var _0x2b4974=_0x5a15bd;try{for(const _0x121886 of _0xfbbfb3){await _0x121886['save']();}const _0x345569=await master_shop[_0x2b4974(0x2bc)](),_0x46aa03=await email_settings['findOne'](),_0x42dda0=await supervisor_settings[_0x2b4974(0x2bc)]();var _0x4c98c4=_0x185159[_0x2b4974(0x285)],_0x281970='',_0x53adc3;for(_0x53adc3 in _0x4c98c4){_0x281970+=_0x2b4974(0x216)+_0x2b4974(0x205)+_0x4c98c4[_0x53adc3][_0x2b4974(0x2bd)]+_0x2b4974(0x278)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c98c4[_0x53adc3][_0x2b4974(0x2d0)]+_0x2b4974(0x278)+_0x2b4974(0x205)+_0x4c98c4[_0x53adc3][_0x2b4974(0x2c5)]+'</td>'+_0x2b4974(0x205)+_0x4c98c4[_0x53adc3][_0x2b4974(0x27b)]+_0x2b4974(0x278)+_0x2b4974(0x205)+_0x4c98c4[_0x53adc3][_0x2b4974(0x303)]+_0x2b4974(0x278)+_0x2b4974(0x205)+_0x185159[_0x2b4974(0x240)]+_0x2b4974(0x278)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c98c4[_0x53adc3][_0x2b4974(0x253)]+_0x2b4974(0x278)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4c98c4[_0x53adc3][_0x2b4974(0x27f)]+_0x4c98c4[_0x53adc3][_0x2b4974(0x2c7)]+_0x4c98c4[_0x53adc3][_0x2b4974(0x2c0)]+_0x4c98c4[_0x53adc3][_0x2b4974(0x22e)]+_0x4c98c4[_0x53adc3][_0x2b4974(0x1f4)][0x0]+_0x4c98c4[_0x53adc3][_0x2b4974(0x2e1)]+_0x2b4974(0x278),_0x2b4974(0x248);}let _0x3d1a7f=nodemailer[_0x2b4974(0x2c6)]({'host':_0x46aa03['host'],'port':Number(_0x46aa03['port']),'secure':![],'auth':{'user':_0x46aa03[_0x2b4974(0x245)],'pass':_0x46aa03['password']}}),_0x502970={'from':_0x46aa03[_0x2b4974(0x245)],'to':_0x42dda0[0x0][_0x2b4974(0x1ec)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x2b4974(0x26a)+_0x2b4974(0x2a7)+_0x345569[0x0][_0x2b4974(0x276)],'cid':_0x2b4974(0x306)}],'html':_0x2b4974(0x24f)+_0x2b4974(0x23c)+_0x2b4974(0x270)+_0x2b4974(0x223)+_0x2b4974(0x284)+'<div>'+_0x2b4974(0x2ab)+_0x2b4974(0x235)+_0x2b4974(0x223)+'<h2>\x20'+_0x345569[0x0][_0x2b4974(0x30b)]+_0x2b4974(0x221)+_0x2b4974(0x235)+_0x2b4974(0x235)+_0x2b4974(0x271)+_0x2b4974(0x223)+_0x2b4974(0x2be)+'\x20Order\x20Number\x20:\x20'+_0x185159[_0x2b4974(0x2cd)]+'\x20'+_0x2b4974(0x2cf)+_0x2b4974(0x252)+_0x185159[_0x2b4974(0x2a8)]+'\x20'+_0x2b4974(0x2d4)+_0x2b4974(0x1ef)+_0x2b4974(0x235)+_0x2b4974(0x2f6)+_0x2b4974(0x23a)+_0x2b4974(0x216)+_0x2b4974(0x2a0)+_0x2b4974(0x242)+_0x2b4974(0x269)+_0x2b4974(0x23f)+_0x2b4974(0x21b)+_0x2b4974(0x2d2)+_0x2b4974(0x2da)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x2b4974(0x248)+_0x2b4974(0x288)+_0x2b4974(0x2df)+'\x20'+_0x281970+'\x20'+_0x2b4974(0x256)+_0x2b4974(0x234)+_0x2b4974(0x223)+_0x2b4974(0x2c8)+_0x2b4974(0x30a)+_0x345569[0x0][_0x2b4974(0x30b)]+'</h5>'+_0x2b4974(0x235)+_0x2b4974(0x235)+_0x2b4974(0x29e)};_0x3d1a7f[_0x2b4974(0x2dc)](_0x502970,function(_0x147bc9,_0x3e0458){var _0xe489a4=_0x2b4974;_0x147bc9?(console[_0xe489a4(0x2bf)](_0x147bc9),console[_0xe489a4(0x2bf)]('Error\x20Occurs')):console[_0xe489a4(0x2bf)](_0xe489a4(0x27e));}),_0x4b93a6[_0x2b4974(0x255)](_0x2b4974(0x251),_0x2b4974(0x2c4)),_0x5afd53[_0x2b4974(0x246)](_0x2b4974(0x275));}catch(_0x208ee9){console[_0x2b4974(0x2b9)](_0x208ee9),_0x5afd53[_0x2b4974(0x2a3)](0x1f4)[_0x2b4974(0x28f)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x5a15bd(0x239)](_0x41938d=>{var _0x43bb48=_0x5a15bd;console[_0x43bb48(0x2b9)](_0x41938d),_0x5afd53[_0x43bb48(0x2a3)](0x1f4)[_0x43bb48(0x28f)]({'error':_0x43bb48(0x208)});});}catch(_0x32e12d){console[_0x5a15bd(0x2bf)](_0x32e12d);}}),router[a0_0x13373b(0x23e)]('/preview/:id',auth,async(_0x2d280f,_0x2edfe5)=>{var _0x18c44a=a0_0x13373b;try{const {username:_0x5f290c,email:_0x28b982,role:_0x5c2c17}=_0x2d280f['user'],_0x13949f=_0x2d280f['user'],_0x11d2ad=await profile['findOne']({'email':_0x13949f[_0x18c44a(0x245)]}),_0x1d698f=await master_shop['find'](),_0x56e8f4=_0x2d280f[_0x18c44a(0x307)]['id'],_0x2127ee=await purchases[_0x18c44a(0x308)](_0x56e8f4),_0x14bd54=await warehouse[_0x18c44a(0x2d9)]([{'$match':{'name':_0x2127ee[_0x18c44a(0x240)],'room':_0x2127ee['room']}},{'$unwind':_0x18c44a(0x228)},{'$group':{'_id':_0x18c44a(0x25e),'name':{'$first':_0x18c44a(0x263)},'product_stock':{'$first':_0x18c44a(0x2cc)},'bay':{'$first':_0x18c44a(0x211)},'bin':{'$first':_0x18c44a(0x2f5)},'type':{'$first':_0x18c44a(0x267)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x18c44a(0x274)},'product_code':{'$first':_0x18c44a(0x28d)},'storage':{'$first':_0x18c44a(0x2b4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x18c44a(0x266)}}}]),_0x3195e1=await customer[_0x18c44a(0x2bc)]({});let _0x5b9b06;if(_0x13949f[_0x18c44a(0x2a5)]==_0x18c44a(0x254)){const _0xa3e440=await staff[_0x18c44a(0x2c3)]({'email':_0x13949f[_0x18c44a(0x245)]});_0x5b9b06=await warehouse[_0x18c44a(0x2d9)]([{'$match':{'status':_0x18c44a(0x2ed),'name':_0xa3e440[_0x18c44a(0x2ea)]}},{'$group':{'_id':_0x18c44a(0x24c),'name':{'$first':_0x18c44a(0x24c)}}}]);}else _0x5b9b06=await warehouse[_0x18c44a(0x2d9)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x18c44a(0x24c)}}}]);const _0x4304b5=await product['find']({}),_0x170531=await suppliers['find']({}),_0x428364=BayBinSelected(_0x2127ee[_0x18c44a(0x240)],_0x2127ee['room']);if(_0x1d698f[0x0][_0x18c44a(0x237)]==_0x18c44a(0x298)){var _0xb22147=users[_0x18c44a(0x24b)];console[_0x18c44a(0x2bf)](_0xb22147);}else{if(_0x1d698f[0x0][_0x18c44a(0x237)]==_0x18c44a(0x2f7))var _0xb22147=users[_0x18c44a(0x2f7)];else{if(_0x1d698f[0x0][_0x18c44a(0x237)]==_0x18c44a(0x244))var _0xb22147=users[_0x18c44a(0x244)];else{if(_0x1d698f[0x0]['language']==_0x18c44a(0x2e2))var _0xb22147=users[_0x18c44a(0x2e2)];else{if(_0x1d698f[0x0][_0x18c44a(0x237)]==_0x18c44a(0x2fa))var _0xb22147=users['French'];else{if(_0x1d698f[0x0]['language']==_0x18c44a(0x28c))var _0xb22147=users[_0x18c44a(0x21f)];else{if(_0x1d698f[0x0]['language']==_0x18c44a(0x236))var _0xb22147=users['Chinese'];else{if(_0x1d698f[0x0][_0x18c44a(0x237)]==_0x18c44a(0x2b3))var _0xb22147=users[_0x18c44a(0x2f3)];}}}}}}}_0x2edfe5[_0x18c44a(0x22f)](_0x18c44a(0x243),{'success':_0x2d280f['flash'](_0x18c44a(0x251)),'errors':_0x2d280f[_0x18c44a(0x255)](_0x18c44a(0x2b7)),'role':_0x13949f,'profile':_0x11d2ad,'customer':_0x3195e1,'warehouse':_0x5b9b06,'product':_0x14bd54,'user':_0x2127ee,'master_shop':_0x1d698f,'unit':_0x4304b5,'language':_0xb22147,'suppliers':_0x170531,'dataSelected':_0x428364});}catch(_0x1d43b6){console['log'](_0x1d43b6);}}),router[a0_0x13373b(0x215)](a0_0x13373b(0x302),auth,async(_0x5a1b66,_0x426fd8)=>{var _0x3140a4=a0_0x13373b;try{const _0x4e3ccd=_0x5a1b66[_0x3140a4(0x307)]['id'],{invoice:_0x444ffa,warehouse_name:_0x4d9043,Room_name:_0x58041a}=_0x5a1b66[_0x3140a4(0x210)],_0x54936e=await warehouse[_0x3140a4(0x2c3)]({'name':_0x4d9043,'room':_0x58041a}),_0x57a515=await purchases['findOne']({'invoice':_0x444ffa});_0x57a515[_0x3140a4(0x285)][_0x3140a4(0x22d)](_0x3419c5=>{var _0x5448b4=_0x3140a4,_0x23c161=0x0;const _0x12bc10=_0x54936e['product_details'][_0x5448b4(0x260)](_0x3c4798=>{var _0x191783=_0x5448b4;_0x3c4798[_0x191783(0x2bd)]==_0x3419c5['product_name']&&_0x3c4798[_0x191783(0x2e1)]==_0x3419c5[_0x191783(0x2e1)]&&_0x3c4798['type']==_0x3419c5['type']&&_0x3c4798[_0x191783(0x22e)]==_0x3419c5['bin']&&_0x3c4798[_0x191783(0x2c0)]==_0x3419c5[_0x191783(0x2c0)]&&_0x3c4798[_0x191783(0x2c7)]==_0x3419c5['rack']&&_0x3c4798['storage']==_0x3419c5[_0x191783(0x27f)]&&_0x3c4798[_0x191783(0x29b)]==_0x3419c5[_0x191783(0x29b)]&&_0x3c4798[_0x191783(0x272)]==_0x3419c5[_0x191783(0x272)]&&_0x3c4798[_0x191783(0x265)]==_0x3419c5[_0x191783(0x265)]&&_0x3c4798[_0x191783(0x2ae)]==_0x3419c5['delivery_date']&&_0x3c4798[_0x191783(0x2b1)]==_0x3419c5[_0x191783(0x2b1)]&&(_0x3c4798[_0x191783(0x26e)]=parseInt(_0x3c4798[_0x191783(0x26e)])+parseInt(_0x3419c5[_0x191783(0x2c5)]),_0x23c161++);});_0x23c161=='0'&&(_0x54936e[_0x5448b4(0x2c2)]=_0x54936e[_0x5448b4(0x2c2)][_0x5448b4(0x201)]({'product_name':_0x3419c5['product_name'],'product_stock':_0x3419c5[_0x5448b4(0x2c5)],'primary_code':_0x3419c5[_0x5448b4(0x1fa)],'secondary_code':_0x3419c5[_0x5448b4(0x1e8)],'product_code':_0x3419c5[_0x5448b4(0x2d0)],'storage':_0x3419c5[_0x5448b4(0x27f)],'rack':_0x3419c5[_0x5448b4(0x2c7)],'bay':_0x3419c5[_0x5448b4(0x2c0)],'bin':_0x3419c5[_0x5448b4(0x22e)],'type':_0x3419c5[_0x5448b4(0x1f4)],'floorlevel':_0x3419c5[_0x5448b4(0x2e1)],'maxProducts':_0x3419c5[_0x5448b4(0x247)],'unit':_0x3419c5['standard_unit'],'secondary_unit':_0x3419c5[_0x5448b4(0x303)],'expiry_date':_0x3419c5['expiry_date'],'maxPerUnit':_0x3419c5[_0x5448b4(0x20c)],'batch_code':_0x3419c5[_0x5448b4(0x272)],'alertQTY':_0x3419c5[_0x5448b4(0x1e6)],'production_date':_0x3419c5['production_date'],'delivery_date':_0x3419c5[_0x5448b4(0x2ae)],'delivery_code':_0x3419c5['delivery_code']}));}),await _0x54936e['save'](),_0x57a515[_0x3140a4(0x2ad)]='True';const _0x100d40=await _0x57a515['save']();_0x5a1b66['flash']('success',_0x3140a4(0x2a4)),_0x426fd8[_0x3140a4(0x246)]('/all_purchases/view');}catch(_0x22f789){console[_0x3140a4(0x2bf)](_0x22f789);}}),router[a0_0x13373b(0x23e)](a0_0x13373b(0x1fb),auth,async(_0x28f673,_0x51c1b2)=>{var _0x621f57=a0_0x13373b;try{const {username:_0x1e28ab,email:_0x48f92b,role:_0x3c4f15}=_0x28f673[_0x621f57(0x2f4)],_0x12d418=_0x28f673[_0x621f57(0x2f4)],_0x325c42=await profile[_0x621f57(0x2c3)]({'email':_0x12d418[_0x621f57(0x245)]}),_0x2d72cb=await master_shop['find'](),_0x13ca6a=_0x28f673[_0x621f57(0x307)]['id'],_0x4f7850=await purchases[_0x621f57(0x308)](_0x13ca6a),_0xd25155=await suppliers[_0x621f57(0x2bc)]({});let _0x502617;if(_0x12d418[_0x621f57(0x2a5)]=='staff'){const _0x27c38d=await staff[_0x621f57(0x2c3)]({'email':_0x12d418[_0x621f57(0x245)]});_0x502617=await warehouse[_0x621f57(0x2bc)]({'status':_0x621f57(0x2ed),'name':_0x27c38d[_0x621f57(0x2ea)],'warehouse_category':_0x621f57(0x2c1)});}else _0x502617=await warehouse[_0x621f57(0x2d9)]([{'$match':{'status':_0x621f57(0x2ed),'warehouse_category':_0x621f57(0x2c1)}},{'$group':{'_id':_0x621f57(0x24c),'name':{'$first':_0x621f57(0x24c)}}}]);const _0x10722d=await product[_0x621f57(0x2bc)]({}),_0x5dcec0=BayBinSelected(_0x4f7850[_0x621f57(0x240)],_0x4f7850[_0x621f57(0x2ef)]);let _0xeed7c0=new Date(_0x4f7850['expiry_date']),_0x2ba25e=('0'+_0xeed7c0[_0x621f57(0x283)]())[_0x621f57(0x25a)](-0x2),_0x5c745d=('0'+(_0xeed7c0[_0x621f57(0x29f)]()+0x1))[_0x621f57(0x25a)](-0x2),_0x1697d3=_0xeed7c0['getFullYear'](),_0x4bd125=_0x1697d3+'-'+_0x5c745d+'-'+_0x2ba25e;if(_0x2d72cb[0x0][_0x621f57(0x237)]==_0x621f57(0x298)){var _0x1e133d=users[_0x621f57(0x24b)];console['log'](_0x1e133d);}else{if(_0x2d72cb[0x0][_0x621f57(0x237)]==_0x621f57(0x2f7))var _0x1e133d=users[_0x621f57(0x2f7)];else{if(_0x2d72cb[0x0][_0x621f57(0x237)]==_0x621f57(0x244))var _0x1e133d=users[_0x621f57(0x244)];else{if(_0x2d72cb[0x0][_0x621f57(0x237)]==_0x621f57(0x2e2))var _0x1e133d=users[_0x621f57(0x2e2)];else{if(_0x2d72cb[0x0]['language']==_0x621f57(0x2fa))var _0x1e133d=users[_0x621f57(0x2fa)];else{if(_0x2d72cb[0x0][_0x621f57(0x237)]=='Portuguese\x20(BR)')var _0x1e133d=users[_0x621f57(0x21f)];else{if(_0x2d72cb[0x0]['language']==_0x621f57(0x236))var _0x1e133d=users['Chinese'];else{if(_0x2d72cb[0x0][_0x621f57(0x237)]==_0x621f57(0x2b3))var _0x1e133d=users[_0x621f57(0x2f3)];}}}}}}}_0x51c1b2[_0x621f57(0x22f)](_0x621f57(0x2f8),{'success':_0x28f673['flash'](_0x621f57(0x251)),'errors':_0x28f673[_0x621f57(0x255)](_0x621f57(0x2b7)),'role':_0x12d418,'profile':_0x325c42,'purchases':_0x4f7850,'suppliers':_0xd25155,'warehouse':_0x502617,'product':_0x10722d,'master_shop':_0x2d72cb,'language':_0x1e133d,'ed_fullDate':_0x4bd125,'dataSelected':_0x5dcec0});}catch(_0x110a19){console['log'](_0x110a19);}}),router[a0_0x13373b(0x215)](a0_0x13373b(0x1fb),auth,async(_0x498b1c,_0x4683d5)=>{var _0x5a30dd=a0_0x13373b;try{const _0x396b6e=_0x498b1c[_0x5a30dd(0x307)]['id'],_0x18412e=await purchases[_0x5a30dd(0x2c3)]({'_id':_0x498b1c[_0x5a30dd(0x307)]['id']}),_0x54b79c=await warehouse[_0x5a30dd(0x2c3)]({'name':_0x18412e['warehouse_name'],'room':_0x18412e[_0x5a30dd(0x2ef)]});_0x18412e[_0x5a30dd(0x285)][_0x5a30dd(0x22d)](_0x4b754c=>{var _0x2545d2=_0x5a30dd;const _0x59d999=_0x54b79c[_0x2545d2(0x2c2)][_0x2545d2(0x260)](_0x244050=>{var _0x120b15=_0x2545d2;_0x244050[_0x120b15(0x2bd)]==_0x4b754c[_0x120b15(0x2bd)]&&_0x244050[_0x120b15(0x2e1)]==_0x4b754c['floorlevel']&&_0x244050[_0x120b15(0x1f4)]==_0x4b754c['type']&&_0x244050[_0x120b15(0x22e)]==_0x4b754c[_0x120b15(0x22e)]&&_0x244050[_0x120b15(0x2c0)]==_0x4b754c[_0x120b15(0x2c0)]&&_0x244050[_0x120b15(0x2c7)]==_0x4b754c[_0x120b15(0x2c7)]&&_0x244050['storage']==_0x4b754c[_0x120b15(0x27f)]&&(_0x244050[_0x120b15(0x26e)]=parseInt(_0x244050['product_stock'])-parseInt(_0x4b754c[_0x120b15(0x2c5)]));});}),await _0x54b79c['save']();const {invoice:_0x57062c,suppliers:_0x2f422d,date:_0x325dc9,warehouse_name:_0x1caf9e,prod_name:_0x5346b1,prod_code:_0x354d3f,prod_qty:_0x208ddb,prod_unit:_0x541012,prod_secondunit:_0x5c5392,prod_level:_0x2c7ff8,prod_isle:_0x1fb918,prod_pallet:_0x3911ce,note:_0x5f3881,expiry_date:_0x112d23,batch_code:_0x25cd8c,paid_amount:_0x42667f,due_amount:_0x47b918,Room_name:_0x4eaf66,primary_code:_0x3cb8b7,secondary_code:_0x5ab2c2,PO_number:_0x2abede,JO_number:_0x483f34}=_0x498b1c[_0x5a30dd(0x210)];if(typeof _0x5346b1=='string')var _0x54fa85=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x23d)]],_0x6c1019=[_0x498b1c['body'][_0x5a30dd(0x2ee)]],_0x4789b5=[_0x498b1c['body']['prod_qty']],_0x12b284=[_0x498b1c[_0x5a30dd(0x210)]['prod_unit']],_0x595a1a=[_0x498b1c[_0x5a30dd(0x210)]['prod_secondunit']],_0x5d2a7d=[_0x498b1c['body']['prod_level']],_0x166b50=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1e9)]],_0x4875b7=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x29d)]],_0x2a2ed6=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1fa)]],_0x577b27=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1e8)]],_0x5cf8f5=[_0x498b1c[_0x5a30dd(0x210)]['MaxStocks_data']],_0x7cd941=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x272)]],_0x41a981=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x29b)]],_0x6b46fb=[_0x498b1c[_0x5a30dd(0x210)]['storage']],_0x4fd395=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x2f2)]],_0x40b35b=[_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1f4)]];else var _0x54fa85=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x23d)]],_0x6c1019=[..._0x498b1c[_0x5a30dd(0x210)]['prod_code']],_0x4789b5=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x20b)]],_0x12b284=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x2ec)]],_0x595a1a=[..._0x498b1c[_0x5a30dd(0x210)]['prod_secondunit']],_0x5d2a7d=[..._0x498b1c['body'][_0x5a30dd(0x2aa)]],_0x166b50=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1e9)]],_0x4875b7=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x29d)]],_0x2a2ed6=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1fa)]],_0x577b27=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1e8)]],_0x5cf8f5=[..._0x498b1c['body'][_0x5a30dd(0x2b6)]],_0x7cd941=[..._0x498b1c[_0x5a30dd(0x210)]['batch_code']],_0x41a981=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x29b)]],_0x6b46fb=[..._0x498b1c[_0x5a30dd(0x210)]['storage']],_0x4fd395=[..._0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x2f2)]],_0x40b35b=[..._0x498b1c['body']['type']];const _0x18d517=_0x54fa85[_0x5a30dd(0x260)](_0x2660e1=>{return _0x2660e1={'product_name':_0x2660e1};});_0x6c1019[_0x5a30dd(0x22d)]((_0x54e0b6,_0x15ce50)=>{var _0x13c0f8=_0x5a30dd;_0x18d517[_0x15ce50][_0x13c0f8(0x2d0)]=_0x54e0b6;}),_0x4789b5[_0x5a30dd(0x22d)]((_0x8b268f,_0x5b377e)=>{var _0x5073ed=_0x5a30dd;_0x18d517[_0x5b377e][_0x5073ed(0x2c5)]=_0x8b268f;}),_0x12b284[_0x5a30dd(0x22d)]((_0x4904f6,_0x1051fb)=>{var _0x4ce43a=_0x5a30dd;_0x18d517[_0x1051fb][_0x4ce43a(0x27b)]=_0x4904f6;}),_0x595a1a['forEach']((_0x129849,_0x1f06b4)=>{var _0x4209a5=_0x5a30dd;_0x18d517[_0x1f06b4][_0x4209a5(0x303)]=_0x129849;}),_0x5d2a7d[_0x5a30dd(0x22d)]((_0x2c79b5,_0x37c3c6)=>{var _0x1c784d=_0x5a30dd;_0x18d517[_0x37c3c6][_0x1c784d(0x2c0)]=_0x2c79b5;}),_0x166b50[_0x5a30dd(0x22d)]((_0x31c811,_0x2054ca)=>{var _0x2fe8fd=_0x5a30dd;_0x18d517[_0x2054ca][_0x2fe8fd(0x22e)]=_0x31c811;}),_0x4875b7[_0x5a30dd(0x22d)]((_0x4fbfab,_0x44dd0a)=>{var _0x2ad686=_0x5a30dd;_0x18d517[_0x44dd0a][_0x2ad686(0x2e1)]=_0x4fbfab;}),_0x2a2ed6['forEach']((_0x25b2e3,_0x1bbee5)=>{_0x18d517[_0x1bbee5]['primary_code']=_0x25b2e3;}),_0x577b27[_0x5a30dd(0x22d)]((_0x1d61f6,_0x117b5f)=>{_0x18d517[_0x117b5f]['secondary_code']=_0x1d61f6;}),_0x5cf8f5[_0x5a30dd(0x22d)]((_0xe4c9e5,_0x365df7)=>{_0x18d517[_0x365df7]['maxStocks']=_0xe4c9e5;}),_0x7cd941[_0x5a30dd(0x22d)]((_0x5484b8,_0x2d1272)=>{var _0x638220=_0x5a30dd;_0x18d517[_0x2d1272][_0x638220(0x272)]=_0x5484b8;}),_0x41a981[_0x5a30dd(0x22d)]((_0x40fa1f,_0x1ff4a1)=>{_0x18d517[_0x1ff4a1]['expiry_date']=_0x40fa1f;}),_0x40b35b['forEach']((_0x2dddfe,_0x12f4dd)=>{_0x18d517[_0x12f4dd]['type']=_0x2dddfe;}),_0x6b46fb[_0x5a30dd(0x22d)]((_0x327ff2,_0x4ab53f)=>{var _0xacbe05=_0x5a30dd;_0x18d517[_0x4ab53f][_0xacbe05(0x27f)]=_0x327ff2;}),_0x4fd395[_0x5a30dd(0x22d)]((_0x19bbb6,_0x4d2a43)=>{var _0x24a4eb=_0x5a30dd;_0x18d517[_0x4d2a43][_0x24a4eb(0x2c7)]=_0x19bbb6;});const _0x3cb664=_0x18d517['filter'](_0x19dad3=>_0x19dad3[_0x5a30dd(0x2c5)]!=='0'&&_0x19dad3[_0x5a30dd(0x2c5)]!=='');_0x18412e[_0x5a30dd(0x2cd)]=_0x57062c,_0x18412e[_0x5a30dd(0x24e)]=_0x2f422d,_0x18412e['date']=_0x325dc9,_0x18412e[_0x5a30dd(0x240)]=_0x1caf9e,_0x18412e[_0x5a30dd(0x285)]=_0x3cb664,_0x18412e[_0x5a30dd(0x297)]=_0x5f3881,_0x18412e[_0x5a30dd(0x222)]=_0x42667f,_0x18412e['due_amount']=_0x47b918,_0x18412e['room']=_0x4eaf66,_0x18412e['POnumber']=_0x2abede,_0x18412e[_0x5a30dd(0x202)]=_0x483f34;const _0x55ebe1=await _0x18412e['save'](),_0x27f674=await warehouse[_0x5a30dd(0x2c3)]({'name':_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x240)],'room':_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x1eb)]});_0x18412e[_0x5a30dd(0x285)]['forEach'](_0x3e43bf=>{var _0x3aec30=_0x5a30dd,_0x26a73a=0x0;const _0x26a11b=_0x27f674[_0x3aec30(0x2c2)][_0x3aec30(0x260)](_0x4c62c8=>{var _0x2df755=_0x3aec30;_0x4c62c8['product_name']==_0x3e43bf['product_name']&&_0x4c62c8['floorlevel']==_0x3e43bf['floorlevel']&&_0x4c62c8[_0x2df755(0x1f4)]==_0x3e43bf[_0x2df755(0x1f4)]&&_0x4c62c8[_0x2df755(0x22e)]==_0x3e43bf['bin']&&_0x4c62c8['bay']==_0x3e43bf['bay']&&_0x4c62c8[_0x2df755(0x2c7)]==_0x3e43bf[_0x2df755(0x2c7)]&&_0x4c62c8[_0x2df755(0x27f)]==_0x3e43bf['storage']&&(_0x4c62c8[_0x2df755(0x26e)]=parseInt(_0x4c62c8[_0x2df755(0x26e)])+parseInt(_0x3e43bf['quantity']),_0x26a73a++);});_0x26a73a=='0'&&(_0x27f674[_0x3aec30(0x2c2)]=_0x27f674[_0x3aec30(0x2c2)][_0x3aec30(0x201)]({'product_name':_0x3e43bf['product_name'],'product_stock':_0x3e43bf[_0x3aec30(0x2c5)],'primary_code':_0x3e43bf[_0x3aec30(0x1fa)],'secondary_code':_0x3e43bf[_0x3aec30(0x1e8)],'product_code':_0x3e43bf[_0x3aec30(0x2d0)],'storage':_0x3e43bf[_0x3aec30(0x27f)],'rack':_0x3e43bf[_0x3aec30(0x2c7)],'bay':_0x3e43bf[_0x3aec30(0x2c0)],'bin':_0x3e43bf[_0x3aec30(0x22e)],'type':_0x3e43bf[_0x3aec30(0x1f4)],'floorlevel':_0x3e43bf[_0x3aec30(0x2e1)],'maxProducts':_0x3e43bf[_0x3aec30(0x247)],'unit':_0x3e43bf['standard_unit'],'secondary_unit':_0x3e43bf[_0x3aec30(0x303)],'expiry_date':_0x3e43bf[_0x3aec30(0x29b)]}));}),await _0x27f674[_0x5a30dd(0x26f)]();const _0x4a03ce=await s_payment_data[_0x5a30dd(0x2c3)]({'invoice':_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x2cd)]});if(_0x4a03ce===null){}else console['log'](_0x5a30dd(0x24e),_0x4a03ce,_0x498b1c['body'][_0x5a30dd(0x2cd)]),_0x4a03ce[_0x5a30dd(0x24e)]=_0x498b1c[_0x5a30dd(0x210)][_0x5a30dd(0x24e)],await _0x4a03ce[_0x5a30dd(0x26f)]();_0x498b1c[_0x5a30dd(0x255)](_0x5a30dd(0x251),_0x5a30dd(0x2ac)),_0x4683d5['redirect'](_0x5a30dd(0x230));}catch(_0x1c1144){console[_0x5a30dd(0x2bf)](_0x1c1144);}}),router[a0_0x13373b(0x215)](a0_0x13373b(0x299),auth,async(_0x5e764e,_0x177da4)=>{var _0x57cce0=a0_0x13373b;try{const _0x287435=_0x5e764e['params']['id'],{invoice:_0x3c9f1b,suppliers:_0x3794d1,payable:_0x34c5f0,due_amount:_0x2592be}=_0x5e764e['body'],_0x71186f=await purchases[_0x57cce0(0x308)](_0x287435);var _0x2f70ff=_0x34c5f0-_0x2592be;_0x71186f[_0x57cce0(0x222)]=parseFloat(_0x71186f[_0x57cce0(0x222)])+parseFloat(_0x2592be),_0x71186f[_0x57cce0(0x2ff)]=_0x2f70ff;const _0x27da70=await _0x71186f[_0x57cce0(0x26f)]();console['log'](_0x27da70);const _0x522616=await s_payment_data[_0x57cce0(0x2c3)]({'invoice':_0x3c9f1b});_0x522616[_0x57cce0(0x21a)]=_0x2f70ff,await _0x522616[_0x57cce0(0x26f)]();let _0xffff59=new Date(),_0x3b29c6=('0'+_0xffff59[_0x57cce0(0x283)]())[_0x57cce0(0x25a)](-0x2),_0x57943c=('0'+(_0xffff59[_0x57cce0(0x29f)]()+0x1))[_0x57cce0(0x25a)](-0x2),_0x7ccf9d=_0xffff59[_0x57cce0(0x28e)](),_0x72272c=_0x7ccf9d+'-'+_0x57943c+'-'+_0x3b29c6;const _0x5b8a96=new suppliers_payment({'invoice':_0x3c9f1b,'date':_0x7ccf9d+'-'+_0x57943c+'-'+_0x3b29c6,'suppliers':_0x3794d1,'reason':'Paid\x20For\x20Purchase','amount':_0x2592be}),_0x9e8ffe=await _0x5b8a96['save']();_0x5e764e[_0x57cce0(0x255)](_0x57cce0(0x251),_0x57cce0(0x295)),_0x177da4[_0x57cce0(0x246)]('/all_purchases/view');}catch(_0x464052){console[_0x57cce0(0x2bf)](_0x464052);}}),router[a0_0x13373b(0x23e)](a0_0x13373b(0x1ed),auth,async(_0x248ccb,_0x555390)=>{var _0xf80191=a0_0x13373b;try{const {username:_0x2ad7fa,email:_0x5047df,role:_0x164d6f}=_0x248ccb[_0xf80191(0x2f4)],_0x269466=_0x248ccb[_0xf80191(0x2f4)],_0x574a13=await profile['findOne']({'email':_0x269466['email']}),_0x568bea=await master_shop[_0xf80191(0x2bc)]();console[_0xf80191(0x2bf)](_0xf80191(0x250),_0x568bea);const _0x5027ea=_0x248ccb['params']['id'],_0x5df895=await purchases[_0xf80191(0x308)](_0x5027ea);console['log'](_0x5df895);const _0x470aaa=await suppliers[_0xf80191(0x2c3)]({'name':_0x5df895[_0xf80191(0x24e)]});console['log'](_0x470aaa);if(_0x568bea[0x0][_0xf80191(0x237)]==_0xf80191(0x298)){var _0x2fd293=users[_0xf80191(0x24b)];console[_0xf80191(0x2bf)](_0x2fd293);}else{if(_0x568bea[0x0][_0xf80191(0x237)]=='Hindi')var _0x2fd293=users[_0xf80191(0x2f7)];else{if(_0x568bea[0x0][_0xf80191(0x237)]=='German')var _0x2fd293=users['German'];else{if(_0x568bea[0x0]['language']==_0xf80191(0x2e2))var _0x2fd293=users[_0xf80191(0x2e2)];else{if(_0x568bea[0x0][_0xf80191(0x237)]==_0xf80191(0x2fa))var _0x2fd293=users[_0xf80191(0x2fa)];else{if(_0x568bea[0x0]['language']==_0xf80191(0x28c))var _0x2fd293=users[_0xf80191(0x21f)];else{if(_0x568bea[0x0]['language']==_0xf80191(0x236))var _0x2fd293=users[_0xf80191(0x236)];else{if(_0x568bea[0x0][_0xf80191(0x237)]==_0xf80191(0x2b3))var _0x2fd293=users[_0xf80191(0x2f3)];}}}}}}}_0x555390[_0xf80191(0x22f)](_0xf80191(0x2e8),{'success':_0x248ccb[_0xf80191(0x255)](_0xf80191(0x251)),'errors':_0x248ccb[_0xf80191(0x255)](_0xf80191(0x2b7)),'role':_0x269466,'profile':_0x574a13,'master_shop':_0x568bea,'supplier':_0x470aaa,'purchase':_0x5df895,'language':_0x2fd293});}catch(_0x3a7e15){console[_0xf80191(0x2bf)](_0x3a7e15);}}),router[a0_0x13373b(0x23e)]('/view/return_purchase/:id',auth,async(_0x32b2ae,_0x2bba87)=>{var _0x4099a6=a0_0x13373b;try{const {username:_0x59b450,email:_0x5b3e1a,role:_0x5b0c75}=_0x32b2ae[_0x4099a6(0x2f4)],_0x49c82c=_0x32b2ae['user'],_0x551656=await profile['findOne']({'email':_0x49c82c[_0x4099a6(0x245)]}),_0x59230b=await master_shop['find']();console[_0x4099a6(0x2bf)](_0x4099a6(0x250),_0x59230b);const _0x217810=_0x32b2ae['params']['id'];console[_0x4099a6(0x2bf)](_0x217810);const _0x1ce1fa=await purchases['findById'](_0x217810);console[_0x4099a6(0x2bf)]('user_id',_0x1ce1fa);const _0x836e2d=await product[_0x4099a6(0x2bc)]({}),_0x17f7af=await warehouse[_0x4099a6(0x2d9)]([{'$match':{'name':_0x1ce1fa[_0x4099a6(0x240)],'room':_0x1ce1fa[_0x4099a6(0x2ef)],'warehouse_category':_0x4099a6(0x2c1)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4099a6(0x25e),'name':{'$first':_0x4099a6(0x263)},'product_stock':{'$first':_0x4099a6(0x2cc)},'bay':{'$first':_0x4099a6(0x211)},'bin':{'$first':_0x4099a6(0x2f5)},'type':{'$first':_0x4099a6(0x267)},'floorlevel':{'$first':_0x4099a6(0x212)},'primary_code':{'$first':_0x4099a6(0x258)},'secondary_code':{'$first':_0x4099a6(0x274)},'product_code':{'$first':_0x4099a6(0x28d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x4099a6(0x2ed),'name':_0x4099a6(0x286),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4099a6(0x24c),'name':{'$first':_0x4099a6(0x24c)}}},{'$sort':{'name':0x1}}]),console[_0x4099a6(0x2bf)](_0x4099a6(0x2cb),_0x17f7af);if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x298)){var _0xc9c00f=users[_0x4099a6(0x24b)];console['log'](_0xc9c00f);}else{if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x2f7))var _0xc9c00f=users[_0x4099a6(0x2f7)];else{if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x244))var _0xc9c00f=users[_0x4099a6(0x244)];else{if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x2e2))var _0xc9c00f=users['Spanish'];else{if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x2fa))var _0xc9c00f=users['French'];else{if(_0x59230b[0x0]['language']=='Portuguese\x20(BR)')var _0xc9c00f=users[_0x4099a6(0x21f)];else{if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x236))var _0xc9c00f=users[_0x4099a6(0x236)];else{if(_0x59230b[0x0][_0x4099a6(0x237)]==_0x4099a6(0x2b3))var _0xc9c00f=users['Arabic'];}}}}}}}_0x2bba87[_0x4099a6(0x22f)](_0x4099a6(0x207),{'success':_0x32b2ae[_0x4099a6(0x255)](_0x4099a6(0x251)),'errors':_0x32b2ae['flash']('errors'),'role':_0x49c82c,'profile':_0x551656,'user':_0x1ce1fa,'stock':_0x17f7af,'master_shop':_0x59230b,'product':_0x836e2d,'language':_0xc9c00f,'warehouse':warehouse_data});}catch(_0x300d85){console[_0x4099a6(0x2bf)](_0x300d85);}}),router[a0_0x13373b(0x215)](a0_0x13373b(0x1fe),auth,async(_0xdb2df5,_0x1e5957)=>{var _0x3eb0d=a0_0x13373b;try{const {invoice:_0x371386,date:_0x5ccce2,warehouse_name:_0x251773,Room_name:_0x58af83,product_name:_0x2c758d,purchase_quantity:_0x1f7db6,stocks:_0x5c96b6,return_qty:_0x1a1e31,note:_0x501150,level:_0x4be9db,isle:_0x480811,pallet:_0x30df6f,to_warehouse_name:_0x5a1ad9,to_Room_name:_0x40ac99}=_0xdb2df5[_0x3eb0d(0x210)],_0x385e9e=await purchases[_0x3eb0d(0x2c3)]({'_id':_0xdb2df5['params']['id']}),_0xf1ed11=await warehouse['findOne']({'name':_0x251773,'room':_0x58af83});if(typeof _0x2c758d=='string')var _0x5abb7c=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2bd)]],_0x4a24d0=[_0xdb2df5[_0x3eb0d(0x210)]['purchase_quantity']],_0x4ef671=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2fb)]],_0x15e875=[_0xdb2df5[_0x3eb0d(0x210)]['return_qty']],_0x4e234a=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2a6)]],_0x5c064c=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2e5)]],_0x4b04ca=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2ca)]],_0x4ea023=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x1e7)]],_0x48b5a6=[_0xdb2df5['body']['product_code_hide']],_0x5a82ff=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2f0)]],_0x16d5b7=[_0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x1f1)]];else var _0x5abb7c=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2bd)]],_0x4a24d0=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x273)]],_0x4ef671=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2fb)]],_0x15e875=[..._0xdb2df5['body'][_0x3eb0d(0x2fe)]],_0x4e234a=[..._0xdb2df5['body'][_0x3eb0d(0x2a6)]],_0x5c064c=[..._0xdb2df5[_0x3eb0d(0x210)]['isle']],_0x4b04ca=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x2ca)]],_0x4ea023=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x1e7)]],_0x48b5a6=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x1ff)]],_0x5a82ff=[..._0xdb2df5['body']['primary_code_hide']],_0x16d5b7=[..._0xdb2df5[_0x3eb0d(0x210)][_0x3eb0d(0x1f1)]];const _0x14adb2=_0x5abb7c[_0x3eb0d(0x260)](_0x5bf635=>{return _0x5bf635={'product_name':_0x5bf635};});_0x4a24d0[_0x3eb0d(0x22d)]((_0x3628b8,_0x13e1fb)=>{var _0x1a1636=_0x3eb0d;_0x14adb2[_0x13e1fb][_0x1a1636(0x273)]=_0x3628b8;}),_0x4ef671['forEach']((_0x9cfe6,_0x146e18)=>{var _0x46c9c6=_0x3eb0d;_0x14adb2[_0x146e18][_0x46c9c6(0x2a2)]=_0x9cfe6;}),_0x15e875[_0x3eb0d(0x22d)]((_0x9a7126,_0x4ab2cd)=>{var _0x29d309=_0x3eb0d;_0x14adb2[_0x4ab2cd][_0x29d309(0x2fe)]=_0x9a7126;}),_0x4e234a[_0x3eb0d(0x22d)]((_0x2f80b9,_0x4d719a)=>{var _0x322f2f=_0x3eb0d;_0x14adb2[_0x4d719a][_0x322f2f(0x2c0)]=_0x2f80b9;}),_0x5c064c[_0x3eb0d(0x22d)]((_0x9985e1,_0x3175b2)=>{var _0x18628a=_0x3eb0d;_0x14adb2[_0x3175b2][_0x18628a(0x22e)]=_0x9985e1;}),_0x4b04ca[_0x3eb0d(0x22d)]((_0xd2c7e,_0x8953d8)=>{_0x14adb2[_0x8953d8]['floorlevel']=_0xd2c7e;}),_0x4ea023[_0x3eb0d(0x22d)]((_0x412bc2,_0x1748c0)=>{var _0x26549e=_0x3eb0d;_0x14adb2[_0x1748c0][_0x26549e(0x1f4)]=_0x412bc2;}),_0x48b5a6[_0x3eb0d(0x22d)]((_0x288d52,_0x217cad)=>{_0x14adb2[_0x217cad]['product_code']=_0x288d52;}),_0x5a82ff[_0x3eb0d(0x22d)]((_0x5140f7,_0xe0dce)=>{var _0x841bd7=_0x3eb0d;_0x14adb2[_0xe0dce][_0x841bd7(0x1fa)]=_0x5140f7;}),_0x16d5b7[_0x3eb0d(0x22d)]((_0x3b6bd4,_0x511811)=>{_0x14adb2[_0x511811]['secondary_code']=_0x3b6bd4;}),_0x385e9e[_0x3eb0d(0x285)][_0x3eb0d(0x22d)](_0x15e86d=>{var _0x3a93de=_0x3eb0d;const _0x2b9e7b=_0xf1ed11[_0x3a93de(0x2c2)][_0x3a93de(0x260)](_0x2fac47=>{var _0x272467=_0x3a93de;_0x2fac47['product_name']==_0x15e86d['product_name']&&_0x2fac47['floorlevel']==_0x15e86d[_0x272467(0x2e1)]&&_0x2fac47[_0x272467(0x1f4)]==_0x15e86d['type']&&_0x2fac47[_0x272467(0x22e)]==_0x15e86d[_0x272467(0x22e)]&&_0x2fac47[_0x272467(0x2c0)]==_0x15e86d[_0x272467(0x2c0)]&&_0x2fac47[_0x272467(0x2c7)]==_0x15e86d[_0x272467(0x2c7)]&&_0x2fac47['storage']==_0x15e86d['storage']&&(console[_0x272467(0x2bf)](parseInt(_0x2fac47[_0x272467(0x26e)])+_0x272467(0x2d1)+parseInt(_0x15e86d['quantity'])),_0x2fac47['product_stock']=parseInt(_0x2fac47[_0x272467(0x26e)])+parseInt(_0x15e86d['quantity']));});}),await _0xf1ed11[_0x3eb0d(0x26f)]();const _0x5b81bc=_0x14adb2[_0x3eb0d(0x2c9)](_0x4ce96b=>_0x4ce96b[_0x3eb0d(0x2fe)]!=='0'&&_0x4ce96b[_0x3eb0d(0x2fe)]!=='');var _0xda2a6e=0x0;_0x5b81bc[_0x3eb0d(0x22d)](_0x12db0e=>{var _0x1fec87=_0x3eb0d;console[_0x1fec87(0x2bf)](_0x1fec87(0x301),_0x12db0e),(parseInt(_0x12db0e[_0x1fec87(0x273)])<parseInt(_0x12db0e['return_qty'])||parseInt(_0x12db0e[_0x1fec87(0x2a2)])<parseInt(_0x12db0e['return_qty']))&&_0xda2a6e++;});if(_0xda2a6e!=0x0)return _0xdb2df5[_0x3eb0d(0x255)](_0x3eb0d(0x2b7),_0x3eb0d(0x213)),_0x1e5957[_0x3eb0d(0x246)](_0x3eb0d(0x257));const _0x264a30=new purchases_return({'invoice':_0x371386,'suppliers':_0xdb2df5[_0x3eb0d(0x210)]['suppliers'],'date':_0x5ccce2,'warehouse_name':_0x251773,'return_product':_0x5b81bc,'note':_0x501150,'room':_0x58af83,'to_warehouse_name':_0x5a1ad9,'to_room':_0x40ac99}),_0x39da1f=await _0x264a30[_0x3eb0d(0x26f)]();console['log'](_0x264a30);const _0x4cc6bd=await purchases_return[_0x3eb0d(0x2c3)]({'invoice':_0x371386}),_0x593752=await warehouse[_0x3eb0d(0x2c3)]({'name':_0x5a1ad9,'room':_0x40ac99});_0x4cc6bd[_0x3eb0d(0x281)]['forEach'](_0x497039=>{var _0x395410=_0x3eb0d,_0x111de0=0x0;const _0xdff23c=_0x593752[_0x395410(0x2c2)][_0x395410(0x260)](_0x3f8781=>{var _0x801129=_0x395410;_0x3f8781[_0x801129(0x2bd)]==_0x497039[_0x801129(0x2bd)]&&_0x3f8781[_0x801129(0x2e1)]==_0x497039[_0x801129(0x2e1)]&&_0x3f8781[_0x801129(0x1f4)]==_0x497039[_0x801129(0x1f4)]&&_0x3f8781['bin']==_0x497039[_0x801129(0x22e)]&&_0x3f8781[_0x801129(0x2c0)]==_0x497039[_0x801129(0x2c0)]&&(_0x3f8781['product_stock']=parseInt(_0x3f8781[_0x801129(0x26e)])-parseInt(_0x497039[_0x801129(0x2fe)]),_0x111de0++);});_0x111de0=='0'&&(_0x593752[_0x395410(0x2c2)]=_0x593752[_0x395410(0x2c2)]['concat']({'product_name':_0x497039[_0x395410(0x2bd)],'product_stock':_0x497039[_0x395410(0x2fe)],'primary_code':_0x497039[_0x395410(0x1fa)],'secondary_code':_0x497039[_0x395410(0x1e8)],'product_code':_0x497039[_0x395410(0x2d0)],'storage':_0x497039[_0x395410(0x27f)],'rack':_0x497039[_0x395410(0x2c7)],'bay':_0x497039['bay'],'bin':_0x497039[_0x395410(0x22e)],'type':_0x497039['type'],'floorlevel':_0x497039[_0x395410(0x2e1)],'maxProducts':_0x497039['maxStocks'],'unit':_0x497039[_0x395410(0x27b)],'secondary_unit':_0x497039[_0x395410(0x303)],'expiry_date':_0x497039[_0x395410(0x29b)]}));}),await _0x593752[_0x3eb0d(0x26f)]();const _0x1a2d5e=await purchases['findOne']({'invoice':_0x371386});_0x1a2d5e[_0x3eb0d(0x232)]=_0x3eb0d(0x1f9);const _0x58bb67=await _0x1a2d5e[_0x3eb0d(0x26f)](),_0x5a51de=new s_payment_data({'invoice':_0x371386,'suppliers':_0xdb2df5[_0x3eb0d(0x210)]['suppliers'],'reason':_0x3eb0d(0x217)});await _0x5a51de[_0x3eb0d(0x26f)]();const _0x11631b=await master_shop['find']();console[_0x3eb0d(0x2bf)]('add\x20post',_0x11631b[0x0][_0x3eb0d(0x276)]);const _0x220692=await email_settings['findOne'](),_0x5d45af=await suppliers[_0x3eb0d(0x2c3)]({'name':_0xdb2df5[_0x3eb0d(0x210)]['suppliers']});console[_0x3eb0d(0x2bf)]('suppliers_data',_0x5d45af);_0x11631b[0x0][_0x3eb0d(0x22a)]==0x1?(right_currency=_0x11631b[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x11631b[0x0][_0x3eb0d(0x2e0)]);var _0x3512ef=_0x5abb7c,_0x5c67ea=_0x15e875,_0x16da75='',_0x7063a3;for(_0x7063a3 in _0x3512ef){_0x16da75+=_0x3eb0d(0x216)+_0x3eb0d(0x205)+_0x3512ef[_0x7063a3]+_0x3eb0d(0x278)+_0x3eb0d(0x205)+_0x5c67ea[_0x7063a3]+'</td>'+_0x3eb0d(0x248);}console[_0x3eb0d(0x2bf)](_0x3eb0d(0x26d),_0x16da75);let _0x435416=nodemailer[_0x3eb0d(0x2c6)]({'service':'gmail','auth':{'user':_0x220692[_0x3eb0d(0x245)],'pass':_0x220692[_0x3eb0d(0x2eb)]}}),_0x34df62={'from':_0x220692['email'],'to':_0x5d45af[_0x3eb0d(0x245)],'subject':_0x3eb0d(0x262),'attachments':[{'filename':_0x3eb0d(0x292),'path':__dirname+_0x3eb0d(0x26a)+_0x3eb0d(0x2a7)+_0x11631b[0x0][_0x3eb0d(0x276)],'cid':_0x3eb0d(0x306)}],'html':_0x3eb0d(0x24f)+_0x3eb0d(0x23c)+_0x3eb0d(0x270)+_0x3eb0d(0x223)+_0x3eb0d(0x284)+_0x3eb0d(0x223)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x3eb0d(0x235)+_0x3eb0d(0x223)+_0x3eb0d(0x2fc)+_0x11631b[0x0][_0x3eb0d(0x30b)]+'\x20</h2>'+_0x3eb0d(0x235)+_0x3eb0d(0x235)+'<hr\x20class=\x22my-3\x22>'+_0x3eb0d(0x223)+_0x3eb0d(0x2be)+_0x3eb0d(0x277)+_0x371386+'\x20'+_0x3eb0d(0x2cf)+_0x3eb0d(0x252)+_0x5ccce2+'\x20'+_0x3eb0d(0x2d4)+_0x3eb0d(0x1ef)+_0x3eb0d(0x235)+_0x3eb0d(0x2f6)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3eb0d(0x216)+_0x3eb0d(0x2a0)+_0x3eb0d(0x25d)+_0x3eb0d(0x241)+_0x3eb0d(0x2d5)+_0x3eb0d(0x248)+_0x3eb0d(0x288)+_0x3eb0d(0x2df)+'\x20'+_0x16da75+'\x20'+_0x3eb0d(0x256)+_0x3eb0d(0x234)+_0x3eb0d(0x223)+_0x3eb0d(0x2c8)+_0x3eb0d(0x30a)+_0x11631b[0x0]['site_title']+_0x3eb0d(0x1ef)+_0x3eb0d(0x235)+_0x3eb0d(0x235)+_0x3eb0d(0x29e)};_0x435416[_0x3eb0d(0x2dc)](_0x34df62,function(_0x2351f1,_0x17c618){var _0x4747cc=_0x3eb0d;_0x2351f1?(console[_0x4747cc(0x2bf)](_0x2351f1),console[_0x4747cc(0x2bf)](_0x4747cc(0x25c))):console[_0x4747cc(0x2bf)](_0x4747cc(0x27e));}),_0xdb2df5['flash']('success',_0x3eb0d(0x2de)),_0x1e5957[_0x3eb0d(0x246)](_0x3eb0d(0x230));}catch(_0x42d014){console[_0x3eb0d(0x2bf)](_0x42d014),_0x1e5957[_0x3eb0d(0x2a3)](0xc8)[_0x3eb0d(0x28f)]({'message':_0x42d014[_0x3eb0d(0x209)]});}}),router['get']('/barcode/:id',auth,async(_0x424051,_0x4658e3)=>{var _0x25c992=a0_0x13373b;try{const {username:_0x500480,email:_0xcd29eb,role:_0x41ae00}=_0x424051[_0x25c992(0x2f4)],_0x4aa396=_0x424051[_0x25c992(0x2f4)],_0x44741c=await profile['findOne']({'email':_0x4aa396['email']}),_0x27a46a=await master_shop[_0x25c992(0x2bc)](),_0x5d7150=_0x424051['params']['id'],_0x5e00da=await purchases[_0x25c992(0x308)](_0x5d7150);if(_0x27a46a[0x0][_0x25c992(0x237)]==_0x25c992(0x298))var _0xddbfe5=users['English'];else{if(_0x27a46a[0x0][_0x25c992(0x237)]==_0x25c992(0x2f7))var _0xddbfe5=users['Hindi'];else{if(_0x27a46a[0x0][_0x25c992(0x237)]=='German')var _0xddbfe5=users[_0x25c992(0x244)];else{if(_0x27a46a[0x0]['language']==_0x25c992(0x2e2))var _0xddbfe5=users[_0x25c992(0x2e2)];else{if(_0x27a46a[0x0][_0x25c992(0x237)]==_0x25c992(0x2fa))var _0xddbfe5=users['French'];else{if(_0x27a46a[0x0]['language']==_0x25c992(0x28c))var _0xddbfe5=users[_0x25c992(0x21f)];else{if(_0x27a46a[0x0][_0x25c992(0x237)]==_0x25c992(0x236))var _0xddbfe5=users[_0x25c992(0x236)];else{if(_0x27a46a[0x0][_0x25c992(0x237)]=='Arabic\x20(ae)')var _0xddbfe5=users[_0x25c992(0x2f3)];}}}}}}}_0x4658e3['render'](_0x25c992(0x233),{'success':_0x424051[_0x25c992(0x255)]('success'),'errors':_0x424051[_0x25c992(0x255)](_0x25c992(0x2b7)),'role':_0x4aa396,'profile':_0x44741c,'alldata':_0x5e00da,'master_shop':_0x27a46a,'language':_0xddbfe5}),console[_0x25c992(0x2bf)](alldata);}catch(_0xb86d5f){console[_0x25c992(0x2bf)](_0xb86d5f);}}),router[a0_0x13373b(0x215)]('/barcode_scanner',async(_0x345011,_0x24ea19)=>{var _0x2d3c99=a0_0x13373b;const {product_code:_0x52445f}=_0x345011[_0x2d3c99(0x210)];var _0x109847;const _0x9af549=await product['aggregate']([{'$match':{'primary_code':_0x52445f,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x2d3c99(0x24c)},'category':{'$first':_0x2d3c99(0x224)},'brand':{'$first':_0x2d3c99(0x2e6)},'unit':{'$first':_0x2d3c99(0x24a)},'alertquantity':{'$first':_0x2d3c99(0x24d)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2d3c99(0x26c)},'secondary_code':{'$first':_0x2d3c99(0x204)},'maxStocks':{'$first':_0x2d3c99(0x2d7)},'maxProdPerUnit':{'$first':_0x2d3c99(0x229)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2d3c99(0x1f3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x422dcb=await product['aggregate']([{'$match':{'secondary_code':_0x52445f,'product_category':_0x2d3c99(0x2c1)}},{'$group':{'_id':'$_id','name':{'$first':_0x2d3c99(0x24c)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x2d3c99(0x24a)},'alertquantity':{'$first':_0x2d3c99(0x24d)},'product_code':{'$first':_0x2d3c99(0x1f5)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2d3c99(0x204)},'maxStocks':{'$first':_0x2d3c99(0x2d7)},'maxProdPerUnit':{'$first':_0x2d3c99(0x229)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x9af549[_0x2d3c99(0x20a)]>0x0)_0x109847=_0x9af549;else _0x422dcb['length']>0x0&&(_0x109847=_0x422dcb);_0x24ea19[_0x2d3c99(0x28f)](_0x109847);}),router[a0_0x13373b(0x215)](a0_0x13373b(0x2d6),async(_0x5c2031,_0x2c8a8c)=>{var _0x57245f=a0_0x13373b;const {primaryCode:_0x5632b4,secondaryCode:_0x52fb55,productCode:_0x3154e2,bay:_0x2a00b2,bin:_0x43e4ff,types:_0x33d72a,pallet:_0x15cbf1,warehouses:_0x5b37c2,room:_0x25ad62}=_0x5c2031[_0x57245f(0x210)];console[_0x57245f(0x2bf)](_0x5c2031['body']);try{const _0x4c8498=await warehouse[_0x57245f(0x2d9)]([{'$match':{'name':_0x5b37c2,'room':_0x25ad62}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x2a00b2,'product_details.bin':_0x43e4ff,'product_details.type':_0x33d72a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x57245f(0x263)},'product_stock':{'$first':_0x57245f(0x2cc)},'level':{'$first':_0x57245f(0x2ce)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x57245f(0x2d3)},'maxProducts':{'$first':_0x57245f(0x27c)}}}]);_0x2c8a8c[_0x57245f(0x2a3)](0xc8)[_0x57245f(0x28f)](_0x4c8498);}catch(_0x54c200){_0x2c8a8c[_0x57245f(0x2a3)](0x194)[_0x57245f(0x28f)]({'message':_0x54c200[_0x57245f(0x209)]});}}),module[a0_0x13373b(0x2af)]=router;