var a0_0x3cf07a=a0_0x3133;(function(_0x594696,_0x218142){var _0x5cf657=a0_0x3133,_0x562158=_0x594696();while(!![]){try{var _0x21db03=parseInt(_0x5cf657(0x113))/0x1+parseInt(_0x5cf657(0x1d4))/0x2+parseInt(_0x5cf657(0x16b))/0x3*(-parseInt(_0x5cf657(0x15d))/0x4)+-parseInt(_0x5cf657(0x212))/0x5*(-parseInt(_0x5cf657(0x18d))/0x6)+-parseInt(_0x5cf657(0x1b1))/0x7*(parseInt(_0x5cf657(0x1c9))/0x8)+-parseInt(_0x5cf657(0x114))/0x9+-parseInt(_0x5cf657(0x178))/0xa;if(_0x21db03===_0x218142)break;else _0x562158['push'](_0x562158['shift']());}catch(_0x1911f4){_0x562158['push'](_0x562158['shift']());}}}(a0_0x2104,0x97f4f));function a0_0x3133(_0x1494cc,_0x4ca4f9){var _0x2104e8=a0_0x2104();return a0_0x3133=function(_0x313316,_0x23f838){_0x313316=_0x313316-0x10b;var _0x372ca6=_0x2104e8[_0x313316];return _0x372ca6;},a0_0x3133(_0x1494cc,_0x4ca4f9);}const express=require(a0_0x3cf07a(0x164)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x3cf07a(0x179)),auth=require(a0_0x3cf07a(0x204)),nodemailer=require(a0_0x3cf07a(0x1e9));var ejs=require(a0_0x3cf07a(0x1e1));const path=require(a0_0x3cf07a(0x1a7)),users=require('../public/language/languages.json');router[a0_0x3cf07a(0x1b4)]('/view',auth,async(_0x4da365,_0xa5b0e4)=>{var _0x2b44b2=a0_0x3cf07a;try{const {username:_0x4d45c7,email:_0x49aab5,role:_0x11b34b}=_0x4da365[_0x2b44b2(0x19a)],_0x5dba90=_0x4da365[_0x2b44b2(0x19a)],_0x705c35=await profile[_0x2b44b2(0x228)]({'email':_0x5dba90[_0x2b44b2(0x124)]}),_0x22edf3=await staff['findOne']({'email':_0x5dba90['email']});if(_0x5dba90[_0x2b44b2(0x144)]==_0x2b44b2(0x1db)){const _0x145764=await staff[_0x2b44b2(0x228)]({'email':_0x5dba90[_0x2b44b2(0x124)]});}const _0x55c7af=await master_shop['find']();let _0x10d136;if(_0x5dba90[_0x2b44b2(0x144)]==_0x2b44b2(0x1db)){const _0x3da244=await staff[_0x2b44b2(0x228)]({'email':_0x5dba90[_0x2b44b2(0x124)]});_0x10d136=await purchases[_0x2b44b2(0x222)]([{'$match':{'warehouse_name':_0x3da244[_0x2b44b2(0x163)]}},{'$lookup':{'from':_0x2b44b2(0x1fd),'localField':'suppliers','foreignField':_0x2b44b2(0x116),'as':'suppliers_docs'}},{'$unwind':_0x2b44b2(0x1c3)},{'$unwind':'$product'},{'$group':{'_id':_0x2b44b2(0x1a0),'invoice':{'$first':_0x2b44b2(0x21e)},'suppliers':{'$first':_0x2b44b2(0x1a6)},'date':{'$first':_0x2b44b2(0x220)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x2b44b2(0x1df)},'product':{'$push':_0x2b44b2(0x186)},'note':{'$first':_0x2b44b2(0x15e)},'paid_amount':{'$first':_0x2b44b2(0x140)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2b44b2(0x21b)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2b44b2(0x1c3)},'total_product_quantity':{'$sum':_0x2b44b2(0x203)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2b44b2(0x15b)},'type':{'$addToSet':_0x2b44b2(0x1d1)},'floorlevel':{'$addToSet':_0x2b44b2(0x1bf)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x10d136=await purchases[_0x2b44b2(0x222)]([{'$lookup':{'from':'suppliers','localField':_0x2b44b2(0x1fd),'foreignField':'name','as':_0x2b44b2(0x176)}},{'$unwind':_0x2b44b2(0x1c3)},{'$unwind':'$product'},{'$group':{'_id':_0x2b44b2(0x1a0),'invoice':{'$first':_0x2b44b2(0x21e)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x2b44b2(0x220)},'warehouse_name':{'$first':_0x2b44b2(0x138)},'room':{'$addToSet':_0x2b44b2(0x1b3)},'product':{'$push':_0x2b44b2(0x186)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2b44b2(0x140)},'due_amount':{'$first':_0x2b44b2(0x158)},'return_data':{'$first':_0x2b44b2(0x21b)},'batch_code':{'$first':_0x2b44b2(0x13a)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2b44b2(0x1c3)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2b44b2(0x15b)},'type':{'$addToSet':_0x2b44b2(0x1d1)},'floorlevel':{'$addToSet':_0x2b44b2(0x1bf)},'finalize':{'$first':_0x2b44b2(0x14c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x55c7af[0x0][_0x2b44b2(0x170)]=='English\x20(US)'){var _0x795043=users['English'];console['log'](_0x795043);}else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]==_0x2b44b2(0x14d))var _0x795043=users['Hindi'];else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]==_0x2b44b2(0x1da))var _0x795043=users[_0x2b44b2(0x1da)];else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]==_0x2b44b2(0x134))var _0x795043=users[_0x2b44b2(0x134)];else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]==_0x2b44b2(0x1a2))var _0x795043=users[_0x2b44b2(0x1a2)];else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]=='Portuguese\x20(BR)')var _0x795043=users[_0x2b44b2(0x20f)];else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]=='Chinese')var _0x795043=users[_0x2b44b2(0x1e5)];else{if(_0x55c7af[0x0][_0x2b44b2(0x170)]==_0x2b44b2(0x1ac))var _0x795043=users[_0x2b44b2(0x20c)];}}}}}}}_0xa5b0e4['render'](_0x2b44b2(0x1cc),{'success':_0x4da365[_0x2b44b2(0x162)](_0x2b44b2(0x173)),'errors':_0x4da365[_0x2b44b2(0x162)](_0x2b44b2(0x193)),'purchases':_0x10d136,'role':_0x5dba90,'profile':_0x705c35,'master_shop':_0x55c7af,'language':_0x795043});}catch(_0x1790b9){console[_0x2b44b2(0x166)](_0x2b44b2(0x1a4),_0x1790b9),_0xa5b0e4[_0x2b44b2(0x136)](0xc8)[_0x2b44b2(0x209)]({'message':_0x1790b9['message']});}});function BayBinSelected(_0x55971c,_0x206209){var _0x5f883e=a0_0x3cf07a,_0x1d0e0e=[],_0x2a22fe=[],_0x52dd48=[],_0x2e0997=[],_0x405b6f=[],_0x11ed27=[];let _0x47d619=[];if(_0x55971c=='DRY\x20STORAGE')switch(_0x206209){case _0x5f883e(0x11b):_0x1d0e0e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2a22fe=[0x1,0x2],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=[_0x5f883e(0x1b0),'Floor'],_0x405b6f=['D'],_0x11ed27=['A'];break;case _0x5f883e(0x208):_0x1d0e0e=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2a22fe=[0x1,0x2],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=['Level',_0x5f883e(0x156)],_0x405b6f=['D'],_0x11ed27=['B'];break;case _0x5f883e(0x141):_0x1d0e0e=[0x0],_0x2a22fe=[0x0],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=['Floor'],_0x405b6f=['D'],_0x11ed27=['S'];break;case _0x5f883e(0x1cb):_0x1d0e0e=[0x0],_0x2a22fe=[0x0],_0x2e0997=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x52dd48=[_0x5f883e(0x156)],_0x405b6f=['D'],_0x11ed27=['R'];break;}else{if(_0x55971c==_0x5f883e(0x20a))switch(_0x206209){case _0x5f883e(0x11b):_0x1d0e0e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2a22fe=['B','F'],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=['Level','Floor'],_0x405b6f=['C'],_0x11ed27=['A'];break;case _0x5f883e(0x208):_0x1d0e0e=[0x5,0x4,0x3,0x2,0x1],_0x2a22fe=['F','B','S'],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=[_0x5f883e(0x1b0),'Floor'],_0x405b6f=['C'],_0x11ed27=['B'];break;case _0x5f883e(0x184):_0x1d0e0e=[0x1,0x2,0x3,0x4,0x5],_0x2a22fe=['B','F','S'],_0x2e0997=[0x5,0x4,0x3,0x2,0x1],_0x52dd48=[_0x5f883e(0x1b0),_0x5f883e(0x156)],_0x405b6f=['C'],_0x11ed27=['C'];break;case'Rack\x20D':_0x1d0e0e=[0x5,0x4,0x3,0x2,0x1],_0x2a22fe=['F','B','S'],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=[_0x5f883e(0x1b0),'Floor'],_0x405b6f=['C'],_0x11ed27=['D'];break;case'Rack\x20E':_0x1d0e0e=[0x4,0x3,0x2,0x1],_0x2a22fe=[0x1,0x2],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=[_0x5f883e(0x1b0),_0x5f883e(0x156)],_0x405b6f=['C'],_0x11ed27=['E'];break;case _0x5f883e(0x191):_0x1d0e0e=[0x1,0x2,0x3],_0x2a22fe=[0x1,0x2],_0x2e0997=[0x1,0x2,0x3,0x4,0x5],_0x52dd48=[_0x5f883e(0x1b0)],_0x405b6f=['C'],_0x11ed27=['F'];break;}}return{'levels':_0x1d0e0e,'Isle':_0x2a22fe,'rack':_0x2e0997,'type':_0x52dd48,'storage':_0x405b6f,'rak':_0x11ed27};}async function getRandom8DigitNumber(){var _0x27d1f8=a0_0x3cf07a;const _0x56a876=0x989680,_0x210dcd=0x5f5e0ff,_0x285342=Math[_0x27d1f8(0x1d9)](Math[_0x27d1f8(0x223)]()*(_0x210dcd-_0x56a876+0x1))+_0x56a876;var _0x32b1d9;const _0x5109b6=await purchases[_0x27d1f8(0x228)]({'invoice':_0x27d1f8(0x1d6)+_0x285342});return _0x5109b6&&_0x5109b6[_0x27d1f8(0x122)]>0x0?_0x32b1d9='INC-'+_0x285342:_0x32b1d9='INC-'+_0x285342,_0x32b1d9;}function a0_0x2104(){var _0x503fdd=['\x20</h2>','site_title','<table\x20style=\x22width:\x20100%\x20!important;\x22>','add_purchases\x20error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','purchase_quantity','catch','$product.floorlevel','Portuguese\x20(BR)','<strong>\x20Regards\x20</strong>','back','$suppliers_docs','port','stock_data','slice','toString','<tr>','392mBavHM','actual_uom','Receiving\x20Area','all_purchases','</thead>','$product_details.secondary_code','/preview/:id','isle','$product.type','level','secondary_code','934510vNocdJ','delivery_date','INC-','quantity','push','floor','German','staff','$product_details.type','invoice','</div>','$room','image','ejs','Ambient','currency','$category','Chinese','prod_Qty','max_product_unit','$unit','nodemailer','$product_details.expiry_date','params','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','note','$product_details.bay','body','<h5\x20style=\x22text-align:\x20left;\x22>','Sales\x20Update\x20successfully','/upload/','primary_code','Room_name','prod_secondunit','Enabled','<html><head><title></title>','edit_purchases','foreach\x20newproduct','redirect','prod_level','string','suppliers','rak','Paid\x20For\x20Purchase','expiry_date','map','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product.quantity','../middleware/auth','product','/invoice/:id','abs','Rack\x20B','json','COLD\x20STORAGE','/barcode_scanner','Arabic','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Portuguese','</tbody>','maxperunit','4074010MpuXnv','Error\x20Occurs','all','purchase_invoice','$brand','render','prod_cat','post','password','$return_data','bay','find','$invoice','due_amount','$date','$product_details.maxProducts','aggregate','random','rack','save','\x20<>\x20','<!DOCTYPE\x20html>','findOne','/all_purchases/view/','primary_code_hide','forEach','<div>','add\x20post','secondary_unit','\x20Order\x20Number\x20:\x20','bin','/all_purchases/view','$name','product_code','$product_details.floorlevel','662739mkBDkG','692352VLvacI','There\x27s\x20a\x20error\x20in\x20this\x20transaction','name','production_date','product_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','purchases\x20item\x20return\x20successfull','Rack\x20A','</h5>','product_cat','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_details','$maxStocks','message','length','Raw\x20Materials','email','</body></html>','$product_code','$alertquantity','<span\x20style=\x22float:\x20right;\x22>','$product_details.product_name','</span>','room_name','</head><body>','room','paid_amount','batch_code','master','type','gmail','An\x20error\x20occurred\x20while\x20saving\x20data.','Spanish','payment\x20successfull','status','maxStocks','$warehouse_name','JO_number','$batch_code','return_data','POnumber','$product_details.product_code','$secondary_unit','return_product','$paid_amount','Shelves','\x20Order\x20Date\x20:\x20','actual_qty','role','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','floorlevel','</tr>','An\x20error\x20occurred.','secondary_code_hide','product_list','filter','$finalize','Hindi','stock_quantity','$product_details','$product_details.primary_code','exports','return_purchase','types','return_qty','user_id','Floor','/CheckingWarehouse','$due_amount','product_name','getFullYear','$product.bin','storage','1165616YdOnix','$note','$product_details.bin','prod_primunit','Purchase\x20Mail','flash','warehouse','express','getMonth','log','findById','deliverycode','<h2>\x20','error','3yEpsHg','stocks','<h5>','</td>','True','language','createTransport','alertQTY','success','warehouse_name','host','suppliers_docs','$product_details.product_stock','9174950TgKgqY','../models/all_models','$product_details._id','prod_pallet','$product_details.rack','/barcode/:id','$primary_code','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','getDate','add_purchases','edit_purchases_view','product_stock','Rack\x20C','Purchase\x20Return','$product','English','English\x20(US)','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','6dYSjtB','padStart','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Rack\x20F','Return\x20Goods','errors','MaxStocks_data','date','pallet','here','$maxProdPerUnit','then','user','/view/add_purchases/:id','Enclosed','delivery_code','concat','standard_unit','$_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','French','/give_payment/:id','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$suppliers','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_invoice','suppliers_data','prod_name','Arabic\x20(ae)','/view/add_purchases','sendMail','currency_placement','Level','5222UFeAjo','Email\x20sent\x20successfully','$product.room_name','get','prod_code','/view/:id','$secondary_code'];a0_0x2104=function(){return _0x503fdd;};return a0_0x2104();}router[a0_0x3cf07a(0x1b4)](a0_0x3cf07a(0x1ad),auth,async(_0x490c33,_0x682e6b)=>{var _0x311b41=a0_0x3cf07a;try{const {username:_0x20f938,email:_0xb921f4,role:_0x53bf01}=_0x490c33['user'],_0x45a6cb=_0x490c33[_0x311b41(0x19a)],_0x49265d=await profile['findOne']({'email':_0x45a6cb[_0x311b41(0x124)]}),_0x1ec586=await master_shop['find'](),_0x1159b0=await staff[_0x311b41(0x228)]({'email':_0x45a6cb[_0x311b41(0x124)]}),_0x55032b=await suppliers[_0x311b41(0x21d)]({});let _0x2c14e8;if(_0x45a6cb[_0x311b41(0x144)]==_0x311b41(0x1db)){const _0x49d202=await staff[_0x311b41(0x228)]({'email':_0x45a6cb[_0x311b41(0x124)]});_0x2c14e8=await warehouse[_0x311b41(0x222)]([{'$match':{'status':_0x311b41(0x1f6),'name':_0x49d202[_0x311b41(0x163)],'warehouse_category':_0x311b41(0x123),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x311b41(0x110),'name':{'$first':_0x311b41(0x110)}}}]);}else _0x2c14e8=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x311b41(0x123),'name':{'$ne':_0x311b41(0x192)}}},{'$group':{'_id':_0x311b41(0x110),'name':{'$first':_0x311b41(0x110)}}}]);const _0x5a3400=await product['find']({}),_0x13ebaa=await warehouse[_0x311b41(0x21d)]({'status':'Enabled'}),_0x2e533a=await purchases['find']({}),_0x471c23=_0x2e533a[_0x311b41(0x122)]+0x1,_0x5eb000='INC-'+_0x471c23[_0x311b41(0x1c7)]()[_0x311b41(0x18e)](0x5,'0');var _0x2e6820=[_0x311b41(0x1e2),_0x311b41(0x19c)];if(_0x1ec586[0x0][_0x311b41(0x170)]==_0x311b41(0x188))var _0x4962aa=users[_0x311b41(0x187)];else{if(_0x1ec586[0x0]['language']==_0x311b41(0x14d))var _0x4962aa=users['Hindi'];else{if(_0x1ec586[0x0]['language']==_0x311b41(0x1da))var _0x4962aa=users[_0x311b41(0x1da)];else{if(_0x1ec586[0x0][_0x311b41(0x170)]=='Spanish')var _0x4962aa=users[_0x311b41(0x134)];else{if(_0x1ec586[0x0]['language']==_0x311b41(0x1a2))var _0x4962aa=users[_0x311b41(0x1a2)];else{if(_0x1ec586[0x0]['language']==_0x311b41(0x1c0))var _0x4962aa=users['Portuguese'];else{if(_0x1ec586[0x0][_0x311b41(0x170)]=='Chinese')var _0x4962aa=users[_0x311b41(0x1e5)];else{if(_0x1ec586[0x0]['language']==_0x311b41(0x1ac))var _0x4962aa=users[_0x311b41(0x20c)];}}}}}}}const _0x5e35b0=getRandom8DigitNumber();_0x5e35b0[_0x311b41(0x199)](_0x582195=>{var _0x1c5566=_0x311b41;_0x682e6b[_0x1c5566(0x217)](_0x1c5566(0x181),{'success':_0x490c33['flash'](_0x1c5566(0x173)),'errors':_0x490c33[_0x1c5566(0x162)](_0x1c5566(0x193)),'role':_0x45a6cb,'profile':_0x49265d,'suppliers':_0x55032b,'warehouse':_0x2c14e8,'product':_0x5a3400,'invoice':_0x582195,'master_shop':_0x1ec586,'language':_0x4962aa,'find_data':_0x13ebaa,'rooms_data':_0x2e6820});})[_0x311b41(0x1be)](_0x579c71=>{var _0x5c4188=_0x311b41;_0x490c33[_0x5c4188(0x162)]('errors',_0x5c4188(0x115)),_0x682e6b['redirect'](_0x5c4188(0x10f));});}catch(_0x42cf8f){console['log'](_0x42cf8f);}}),router[a0_0x3cf07a(0x1b4)](a0_0x3cf07a(0x19b),auth,async(_0x389085,_0x45f5ef)=>{var _0x5c4d81=a0_0x3cf07a;try{const _0x1eee1f=_0x389085[_0x5c4d81(0x1eb)]['id'];console[_0x5c4d81(0x166)](_0x1eee1f);const _0x5138ce=await master_shop[_0x5c4d81(0x21d)]();console[_0x5c4d81(0x166)]('master',_0x5138ce);const _0x1c1212=await product[_0x5c4d81(0x228)]({'name':_0x1eee1f});console[_0x5c4d81(0x166)](_0x5c4d81(0x205),_0x1c1212),_0x45f5ef[_0x5c4d81(0x136)](0xc8)[_0x5c4d81(0x209)]({'product_data':_0x1c1212,'master':_0x5138ce});}catch(_0x5404c2){console['log'](_0x5c4d81(0x1bb),_0x5404c2);}}),router[a0_0x3cf07a(0x219)]('/view/add_purchases',auth,async(_0x5a3c26,_0x377712)=>{var _0x433133=a0_0x3cf07a;try{const {invoice:_0x40f055,date:_0x1e845f,warehouse_name:_0x180f47,prod_name:_0x53549a,prod_code:_0x5eeef0,prod_qty:_0x426900,prod_unit:_0x279f3e,prod_secondunit:_0x3346b9,prod_level:_0x7f6eb8,prod_isle:_0x1925d3,prod_pallet:_0x4b48ef,note:_0x58cd52,expiry_date:_0x3a4395,batch_code:_0x409aa3,payable:_0x17786c,due_amount:_0x3f8de7,Room_name:_0x383979,primary_code:_0x47bacf,secondary_code:_0x40d370,MaxStocks_data:_0x231441,PO_number:_0x5cbfa4,SCRN:_0x1cd3f5,JO_number:_0x4a0b0c}=_0x5a3c26[_0x433133(0x1ef)];if(typeof _0x53549a==_0x433133(0x1fc))var _0x29e376=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1ab)]],_0x39b08a=[_0x5a3c26['body']['prod_code']],_0x52d0cf=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1e6)]],_0x37c8f3=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x160)]],_0x5e69cd=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1f5)]],_0x1535fc=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1fb)]],_0x83bc1b=[_0x5a3c26[_0x433133(0x1ef)]['primary_code']],_0x3dcef3=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1d3)]],_0x1f3574=[_0x5a3c26['body'][_0x433133(0x194)]],_0x963d5c=[_0x5a3c26['body'][_0x433133(0x12f)]],_0x4714ce=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x200)]],_0x2e2ee6=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1e7)]],_0x114f92=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x172)]],_0x5468b8=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x117)]],_0x3bbf4d=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x218)]],_0x452a70=[_0x5a3c26[_0x433133(0x1ef)]['RoomAssign']],_0x1099d8=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x168)]],_0x2357c4=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1a9)]],_0x884fd=[_0x5a3c26[_0x433133(0x1ef)]['actual_qty']],_0x4e51cc=[_0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1ca)]];else var _0x29e376=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1ab)]],_0x39b08a=[..._0x5a3c26['body']['prod_code']],_0x52d0cf=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1e6)]],_0x37c8f3=[..._0x5a3c26[_0x433133(0x1ef)]['prod_primunit']],_0x5e69cd=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1f5)]],_0x1535fc=[..._0x5a3c26[_0x433133(0x1ef)]['prod_level']],_0x83bc1b=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1f3)]],_0x3dcef3=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1d3)]],_0x1f3574=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x194)]],_0x963d5c=[..._0x5a3c26['body'][_0x433133(0x12f)]],_0x4714ce=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x200)]],_0x2e2ee6=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1e7)]],_0x114f92=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x172)]],_0x5468b8=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x117)]],_0x3bbf4d=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x218)]],_0x452a70=[..._0x5a3c26[_0x433133(0x1ef)]['RoomAssign']],_0x1099d8=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x168)]],_0x2357c4=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1a9)]],_0x884fd=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x143)]],_0x4e51cc=[..._0x5a3c26[_0x433133(0x1ef)][_0x433133(0x1ca)]];const _0x590789=_0x29e376[_0x433133(0x201)](_0x156f1e=>{return _0x156f1e={'product_name':_0x156f1e};});_0x884fd[_0x433133(0x22b)]((_0x4558c7,_0x48cc0e)=>{var _0x9dd87=_0x433133;_0x590789[_0x48cc0e]['actual_qty']=Math[_0x9dd87(0x207)](_0x4558c7);}),_0x4e51cc['forEach']((_0x59b772,_0x130ef0)=>{var _0x2fc6fd=_0x433133;_0x590789[_0x130ef0][_0x2fc6fd(0x1ca)]=_0x59b772;}),_0x39b08a[_0x433133(0x22b)]((_0x15a6dd,_0x51af2)=>{var _0x38eec3=_0x433133;_0x590789[_0x51af2][_0x38eec3(0x111)]=_0x15a6dd;}),_0x52d0cf[_0x433133(0x22b)]((_0x3e063c,_0x481d45)=>{var _0x1f36da=_0x433133;_0x590789[_0x481d45]['quantity']=Math[_0x1f36da(0x207)](_0x3e063c);}),_0x37c8f3[_0x433133(0x22b)]((_0x3a7bb7,_0x24111d)=>{_0x590789[_0x24111d]['standard_unit']=_0x3a7bb7;}),_0x5e69cd['forEach']((_0x1b68b8,_0x277020)=>{var _0x2e9f0e=_0x433133;_0x590789[_0x277020][_0x2e9f0e(0x10c)]=_0x1b68b8;}),_0x1535fc[_0x433133(0x22b)]((_0x4f8b06,_0x5d9d59)=>{var _0x45f0d8=_0x433133;_0x452a70[_0x45f0d8(0x22b)]((_0x3ba028,_0x16c500)=>{var _0x54012e=_0x45f0d8;if(_0x3ba028=='Receiving\x20Area'&&_0x5d9d59==_0x16c500){console['log'](_0x3ba028+'\x20<\x20wew\x20>\x20'+_0x5d9d59+_0x54012e(0x226)+_0x16c500+_0x54012e(0x226)+_0x4f8b06);var _0x1e8f0e=_0x4f8b06[_0x54012e(0x1c6)](0x3);_0x590789[_0x5d9d59][_0x54012e(0x15c)]=_0x4f8b06[0x0],_0x590789[_0x5d9d59][_0x54012e(0x224)]=_0x4f8b06[0x1],_0x590789[_0x5d9d59]['bay']=0x0,_0x590789[_0x5d9d59][_0x54012e(0x10e)]=0x0,_0x590789[_0x5d9d59][_0x54012e(0x131)]=_0x54012e(0x156),_0x590789[_0x5d9d59][_0x54012e(0x146)]=_0x1e8f0e;}else{if(_0x3ba028==_0x54012e(0x141)&&_0x5d9d59==_0x16c500){var _0x1e8f0e=_0x4f8b06[_0x54012e(0x1c6)](0x3);_0x590789[_0x5d9d59][_0x54012e(0x15c)]=_0x4f8b06[0x0],_0x590789[_0x5d9d59]['rack']=_0x4f8b06[0x1],_0x590789[_0x5d9d59][_0x54012e(0x21c)]=0x0,_0x590789[_0x5d9d59][_0x54012e(0x10e)]=0x0,_0x590789[_0x5d9d59][_0x54012e(0x131)]=_0x54012e(0x156),_0x590789[_0x5d9d59]['floorlevel']=_0x4f8b06[0x5];}else{if(_0x5d9d59==_0x16c500){if(_0x4f8b06[0x0]=='A'&&_0x4f8b06[0x1]=='L'&&_0x4f8b06[0x2]=='L')console[_0x54012e(0x166)](_0x3ba028+_0x54012e(0x226)+_0x5d9d59+_0x54012e(0x226)+_0x16c500+_0x54012e(0x226)+_0x4f8b06+_0x54012e(0x197)),_0x590789[_0x5d9d59]['storage']=_0x4f8b06[0x0],_0x590789[_0x5d9d59]['rack']=_0x4f8b06[0x1],_0x590789[_0x5d9d59]['bay']=0x0,_0x590789[_0x5d9d59]['bin']=0x0,_0x590789[_0x5d9d59][_0x54012e(0x131)]=_0x54012e(0x156),_0x590789[_0x5d9d59]['floorlevel']=_0x4f8b06[0x3];else{var _0x587b7d;if(_0x4f8b06[0x4]=='L')_0x587b7d=_0x54012e(0x1b0);else _0x4f8b06[0x4]=='F'&&(_0x587b7d=_0x54012e(0x156));_0x590789[_0x5d9d59][_0x54012e(0x15c)]=_0x4f8b06[0x0],_0x590789[_0x5d9d59][_0x54012e(0x224)]=_0x4f8b06[0x1],_0x590789[_0x5d9d59][_0x54012e(0x21c)]=_0x4f8b06[0x2],_0x590789[_0x5d9d59][_0x54012e(0x10e)]=_0x4f8b06[0x3],_0x590789[_0x5d9d59][_0x54012e(0x131)]=_0x587b7d,_0x590789[_0x5d9d59][_0x54012e(0x146)]=_0x4f8b06[0x5];}}}}});}),_0x83bc1b[_0x433133(0x22b)]((_0xb1e5de,_0x27fdb4)=>{var _0x465ac1=_0x433133;_0x590789[_0x27fdb4][_0x465ac1(0x1f3)]=_0xb1e5de;}),_0x3dcef3['forEach']((_0x527438,_0x172c93)=>{var _0x163f3f=_0x433133;_0x590789[_0x172c93][_0x163f3f(0x1d3)]=_0x527438;}),_0x1f3574[_0x433133(0x22b)]((_0x33e007,_0x503b44)=>{var _0x477e31=_0x433133;_0x590789[_0x503b44][_0x477e31(0x137)]=_0x33e007;}),_0x963d5c['forEach']((_0x1e3bf1,_0x3fee97)=>{var _0x19b4f7=_0x433133;_0x590789[_0x3fee97][_0x19b4f7(0x12f)]=_0x1e3bf1;}),_0x4714ce[_0x433133(0x22b)]((_0x458aa2,_0x50b7ba)=>{_0x590789[_0x50b7ba]['expiry_date']=_0x458aa2;}),_0x2e2ee6[_0x433133(0x22b)]((_0x166480,_0x5dc4c7)=>{var _0x3e1781=_0x433133;_0x590789[_0x5dc4c7][_0x3e1781(0x211)]=_0x166480;}),_0x114f92[_0x433133(0x22b)]((_0x20927c,_0x1e5443)=>{var _0x1b1201=_0x433133;_0x590789[_0x1e5443][_0x1b1201(0x172)]=_0x20927c;}),_0x5468b8[_0x433133(0x22b)]((_0x30a456,_0x1514ac)=>{var _0xfe59d1=_0x433133;_0x590789[_0x1514ac][_0xfe59d1(0x117)]=_0x30a456;}),_0x3bbf4d[_0x433133(0x22b)]((_0x177b9b,_0xc75d98)=>{var _0x20cf48=_0x433133;_0x590789[_0xc75d98][_0x20cf48(0x11d)]=_0x177b9b;}),_0x452a70[_0x433133(0x22b)]((_0x2f25b3,_0x68470)=>{var _0x4f6de8=_0x433133;_0x590789[_0x68470][_0x4f6de8(0x12b)]=_0x2f25b3;}),_0x1099d8[_0x433133(0x22b)]((_0x17f70c,_0x236006)=>{var _0x2028cc=_0x433133;_0x590789[_0x236006][_0x2028cc(0x19d)]=_0x17f70c;}),_0x2357c4[_0x433133(0x22b)]((_0xe305f3,_0x43f00d)=>{_0x590789[_0x43f00d]['invoice']=_0xe305f3;});const _0x4bd28c=_0x452a70['map'](_0xe284e9=>{return _0xe284e9={'room_name':_0xe284e9};}),_0x1ade4f=_0x590789[_0x433133(0x14b)](_0x41ed78=>_0x41ed78['quantity']!=='0'&&_0x41ed78[_0x433133(0x1d7)]!==''),_0x23b439=new purchases({'invoice':_0x40f055,'suppliers':_0x5a3c26[_0x433133(0x1ef)]['suppliers'],'date':_0x1e845f,'warehouse_name':_0x180f47,'product':_0x1ade4f,'note':_0x58cd52,'due_amount':_0x3f8de7,'POnumber':_0x5cbfa4,'SCRN':_0x1cd3f5,'JO_number':_0x4a0b0c,'roomList':_0x4bd28c}),_0x309c56=await _0x23b439[_0x433133(0x225)](),_0x1e319f=await purchases['findOne']({'invoice':_0x40f055}),_0x246894=_0x1e319f[_0x433133(0x205)][_0x433133(0x201)](async _0x3f7156=>{var _0x5c5a43=_0x433133,_0x5cd65e=await warehouse['findOne']({'name':_0x180f47,'room':_0x3f7156[_0x5c5a43(0x12b)]}),_0x3aca95=0x0;return _0x5cd65e[_0x5c5a43(0x11f)]['forEach'](_0x3c3bd9=>{var _0x1fd605=_0x5c5a43;_0x3c3bd9[_0x1fd605(0x159)]==_0x3f7156[_0x1fd605(0x159)]&&_0x3c3bd9[_0x1fd605(0x146)]==_0x3f7156[_0x1fd605(0x146)]&&_0x3c3bd9['type']==_0x3f7156[_0x1fd605(0x131)]&&_0x3c3bd9['bin']==_0x3f7156[_0x1fd605(0x10e)]&&_0x3c3bd9[_0x1fd605(0x21c)]==_0x3f7156[_0x1fd605(0x21c)]&&_0x3c3bd9['rack']==_0x3f7156[_0x1fd605(0x224)]&&_0x3c3bd9[_0x1fd605(0x15c)]==_0x3f7156[_0x1fd605(0x15c)]&&_0x3c3bd9['expiry_date']==_0x3f7156[_0x1fd605(0x200)]&&_0x3c3bd9[_0x1fd605(0x12f)]==_0x3f7156[_0x1fd605(0x12f)]&&_0x3c3bd9[_0x1fd605(0x117)]==_0x3f7156['production_date']&&_0x3c3bd9[_0x1fd605(0x1dd)]==_0x1e319f[_0x1fd605(0x1dd)]&&(_0x3c3bd9['product_stock']+=Math[_0x1fd605(0x207)](_0x3f7156[_0x1fd605(0x1d7)]),_0x3aca95++);}),_0x3aca95===0x0&&_0x5cd65e[_0x5c5a43(0x11f)][_0x5c5a43(0x1d8)]({'product_name':_0x3f7156[_0x5c5a43(0x159)],'product_stock':Math['abs'](_0x3f7156['quantity']),'primary_code':_0x3f7156[_0x5c5a43(0x1f3)],'secondary_code':_0x3f7156['secondary_code'],'product_code':_0x3f7156[_0x5c5a43(0x111)],'storage':_0x3f7156['storage'],'rack':_0x3f7156[_0x5c5a43(0x224)],'bay':_0x3f7156[_0x5c5a43(0x21c)],'bin':_0x3f7156[_0x5c5a43(0x10e)],'type':_0x3f7156['type'],'floorlevel':_0x3f7156[_0x5c5a43(0x146)],'maxProducts':_0x3f7156['maxStocks'],'unit':_0x3f7156[_0x5c5a43(0x19f)],'secondary_unit':_0x3f7156[_0x5c5a43(0x10c)],'expiry_date':_0x3f7156[_0x5c5a43(0x200)],'maxPerUnit':_0x3f7156[_0x5c5a43(0x211)],'batch_code':_0x3f7156[_0x5c5a43(0x12f)],'alertQTY':_0x3f7156[_0x5c5a43(0x172)],'production_date':_0x3f7156[_0x5c5a43(0x117)],'product_cat':_0x3f7156[_0x5c5a43(0x11d)],'invoice':_0x3f7156['invoice'],'actual_qty':Math[_0x5c5a43(0x207)](_0x3f7156[_0x5c5a43(0x143)]),'actual_uom':_0x3f7156['actual_uom']}),_0x5cd65e;});Promise[_0x433133(0x214)](_0x246894)[_0x433133(0x199)](async _0x308e72=>{var _0x285e2f=_0x433133;try{for(const _0x183a77 of _0x308e72){await _0x183a77[_0x285e2f(0x225)]();}const _0x3fa39c=await master_shop[_0x285e2f(0x21d)](),_0x27971e=await email_settings[_0x285e2f(0x228)](),_0x40e3ea=await supervisor_settings[_0x285e2f(0x21d)]();var _0x58e691=_0x1e319f[_0x285e2f(0x205)],_0x28341a='',_0x589a37;for(_0x589a37 in _0x58e691){_0x28341a+=_0x285e2f(0x1c8)+_0x285e2f(0x11e)+_0x58e691[_0x589a37][_0x285e2f(0x159)]+'</td>'+_0x285e2f(0x11e)+_0x58e691[_0x589a37]['product_code']+'</td>'+_0x285e2f(0x11e)+_0x58e691[_0x589a37][_0x285e2f(0x1d7)]+_0x285e2f(0x16e)+_0x285e2f(0x11e)+_0x58e691[_0x589a37]['standard_unit']+_0x285e2f(0x16e)+_0x285e2f(0x11e)+_0x58e691[_0x589a37][_0x285e2f(0x10c)]+_0x285e2f(0x16e)+_0x285e2f(0x11e)+_0x1e319f[_0x285e2f(0x174)]+_0x285e2f(0x16e)+_0x285e2f(0x11e)+_0x58e691[_0x589a37][_0x285e2f(0x12b)]+_0x285e2f(0x16e)+_0x285e2f(0x11e)+_0x58e691[_0x589a37][_0x285e2f(0x15c)]+_0x58e691[_0x589a37][_0x285e2f(0x224)]+_0x58e691[_0x589a37][_0x285e2f(0x21c)]+_0x58e691[_0x589a37]['bin']+_0x58e691[_0x589a37]['type'][0x0]+_0x58e691[_0x589a37][_0x285e2f(0x146)]+_0x285e2f(0x16e),_0x285e2f(0x147);}let _0x52f195=nodemailer['createTransport']({'host':_0x27971e[_0x285e2f(0x175)],'port':Number(_0x27971e[_0x285e2f(0x1c4)]),'secure':![],'auth':{'user':_0x27971e[_0x285e2f(0x124)],'pass':_0x27971e['password']}}),_0x21557c={'from':_0x27971e[_0x285e2f(0x124)],'to':_0x40e3ea[0x0]['RMSEmail'],'subject':_0x285e2f(0x161),'attachments':[{'filename':_0x285e2f(0x18f),'path':__dirname+'/../public'+'/upload/'+_0x3fa39c[0x0]['image'],'cid':'logo'}],'html':_0x285e2f(0x227)+_0x285e2f(0x1f7)+'</head><body>'+_0x285e2f(0x22c)+_0x285e2f(0x202)+_0x285e2f(0x22c)+_0x285e2f(0x1ec)+_0x285e2f(0x1de)+_0x285e2f(0x22c)+_0x285e2f(0x169)+_0x3fa39c[0x0][_0x285e2f(0x1b9)]+_0x285e2f(0x1b8)+_0x285e2f(0x1de)+_0x285e2f(0x1de)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x285e2f(0x1f0)+_0x285e2f(0x10d)+_0x1e319f[_0x285e2f(0x1dd)]+'\x20'+_0x285e2f(0x128)+_0x285e2f(0x142)+_0x1e319f[_0x285e2f(0x195)]+'\x20'+_0x285e2f(0x12a)+_0x285e2f(0x11c)+_0x285e2f(0x1de)+_0x285e2f(0x1ba)+_0x285e2f(0x17f)+_0x285e2f(0x1c8)+_0x285e2f(0x18a)+_0x285e2f(0x1a8)+_0x285e2f(0x1a1)+_0x285e2f(0x190)+_0x285e2f(0x20e)+_0x285e2f(0x18c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x285e2f(0x1a5)+_0x285e2f(0x147)+_0x285e2f(0x1cd)+_0x285e2f(0x18b)+'\x20'+_0x28341a+'\x20'+_0x285e2f(0x210)+'</table>'+_0x285e2f(0x22c)+_0x285e2f(0x1c1)+'<h5>'+_0x3fa39c[0x0][_0x285e2f(0x1b9)]+_0x285e2f(0x11c)+'</div>'+_0x285e2f(0x1de)+'</body></html>'};_0x52f195[_0x285e2f(0x1ae)](_0x21557c,function(_0x40f499,_0x9cc4aa){var _0x30e4de=_0x285e2f;_0x40f499?(console[_0x30e4de(0x166)](_0x40f499),console[_0x30e4de(0x166)](_0x30e4de(0x213))):console['log'](_0x30e4de(0x1b2));}),_0x5a3c26[_0x285e2f(0x162)](_0x285e2f(0x173),'Purchase\x20data\x20added\x20successfully'),_0x377712[_0x285e2f(0x1fa)](_0x285e2f(0x229));}catch(_0x4865e3){console[_0x285e2f(0x16a)](_0x4865e3),_0x377712['status'](0x1f4)['json']({'error':_0x285e2f(0x133)});}})['catch'](_0x372e8c=>{var _0x36a530=_0x433133;console[_0x36a530(0x16a)](_0x372e8c),_0x377712[_0x36a530(0x136)](0x1f4)[_0x36a530(0x209)]({'error':_0x36a530(0x148)});});}catch(_0x31dfd9){console[_0x433133(0x166)](_0x31dfd9);}}),router[a0_0x3cf07a(0x1b4)](a0_0x3cf07a(0x1cf),auth,async(_0x1e419e,_0x464887)=>{var _0xdc813c=a0_0x3cf07a;try{const {username:_0x3cca0a,email:_0x3b79e7,role:_0x5a87b8}=_0x1e419e[_0xdc813c(0x19a)],_0x317347=_0x1e419e[_0xdc813c(0x19a)],_0x320c83=await profile[_0xdc813c(0x228)]({'email':_0x317347['email']}),_0x46ae06=await master_shop[_0xdc813c(0x21d)](),_0x3ac6b9=_0x1e419e['params']['id'],_0x1b0604=await purchases[_0xdc813c(0x167)](_0x3ac6b9),_0x3b2e94=await warehouse[_0xdc813c(0x222)]([{'$match':{'name':_0x1b0604['warehouse_name'],'room':_0x1b0604[_0xdc813c(0x12d)]}},{'$unwind':_0xdc813c(0x14f)},{'$group':{'_id':_0xdc813c(0x17a),'name':{'$first':_0xdc813c(0x129)},'product_stock':{'$first':_0xdc813c(0x177)},'bay':{'$first':_0xdc813c(0x1ee)},'bin':{'$first':_0xdc813c(0x15f)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xdc813c(0x150)},'secondary_code':{'$first':_0xdc813c(0x1ce)},'product_code':{'$first':_0xdc813c(0x13d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xdc813c(0x1ea)}}}]),_0x3b56c0=await customer[_0xdc813c(0x21d)]({});let _0x56381d;if(_0x317347[_0xdc813c(0x144)]==_0xdc813c(0x1db)){const _0x4e83f2=await staff[_0xdc813c(0x228)]({'email':_0x317347['email']});_0x56381d=await warehouse[_0xdc813c(0x222)]([{'$match':{'status':_0xdc813c(0x1f6),'name':_0x4e83f2[_0xdc813c(0x163)]}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x56381d=await warehouse[_0xdc813c(0x222)]([{'$match':{'status':_0xdc813c(0x1f6)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x48cb54=await product[_0xdc813c(0x21d)]({}),_0x25d898=await suppliers[_0xdc813c(0x21d)]({}),_0xc61cf9=BayBinSelected(_0x1b0604[_0xdc813c(0x174)],_0x1b0604[_0xdc813c(0x12d)]);if(_0x46ae06[0x0]['language']==_0xdc813c(0x188)){var _0x1f7dfb=users[_0xdc813c(0x187)];console['log'](_0x1f7dfb);}else{if(_0x46ae06[0x0][_0xdc813c(0x170)]=='Hindi')var _0x1f7dfb=users[_0xdc813c(0x14d)];else{if(_0x46ae06[0x0]['language']==_0xdc813c(0x1da))var _0x1f7dfb=users[_0xdc813c(0x1da)];else{if(_0x46ae06[0x0]['language']==_0xdc813c(0x134))var _0x1f7dfb=users[_0xdc813c(0x134)];else{if(_0x46ae06[0x0][_0xdc813c(0x170)]=='French')var _0x1f7dfb=users['French'];else{if(_0x46ae06[0x0][_0xdc813c(0x170)]==_0xdc813c(0x1c0))var _0x1f7dfb=users[_0xdc813c(0x20f)];else{if(_0x46ae06[0x0]['language']==_0xdc813c(0x1e5))var _0x1f7dfb=users['Chinese'];else{if(_0x46ae06[0x0][_0xdc813c(0x170)]==_0xdc813c(0x1ac))var _0x1f7dfb=users[_0xdc813c(0x20c)];}}}}}}}_0x464887['render'](_0xdc813c(0x182),{'success':_0x1e419e[_0xdc813c(0x162)](_0xdc813c(0x173)),'errors':_0x1e419e[_0xdc813c(0x162)](_0xdc813c(0x193)),'role':_0x317347,'profile':_0x320c83,'customer':_0x3b56c0,'warehouse':_0x56381d,'product':_0x3b2e94,'user':_0x1b0604,'master_shop':_0x46ae06,'unit':_0x48cb54,'language':_0x1f7dfb,'suppliers':_0x25d898,'dataSelected':_0xc61cf9});}catch(_0x5216c4){console[_0xdc813c(0x166)](_0x5216c4);}}),router[a0_0x3cf07a(0x219)](a0_0x3cf07a(0x1cf),auth,async(_0x139011,_0x196b7c)=>{var _0x500752=a0_0x3cf07a;try{const _0x58f9e2=_0x139011[_0x500752(0x1eb)]['id'],{invoice:_0x24fc0f,warehouse_name:_0x299c22,Room_name:_0x4e5b47}=_0x139011['body'],_0xa949f3=await warehouse[_0x500752(0x228)]({'name':_0x299c22,'room':_0x4e5b47}),_0x2ae360=await purchases[_0x500752(0x228)]({'invoice':_0x24fc0f});_0x2ae360[_0x500752(0x205)][_0x500752(0x22b)](_0x538660=>{var _0xdc1e91=_0x500752,_0x5cdbbc=0x0;const _0x1a1ec5=_0xa949f3[_0xdc1e91(0x11f)][_0xdc1e91(0x201)](_0x262b02=>{var _0x3b54db=_0xdc1e91;_0x262b02[_0x3b54db(0x159)]==_0x538660[_0x3b54db(0x159)]&&_0x262b02[_0x3b54db(0x146)]==_0x538660[_0x3b54db(0x146)]&&_0x262b02[_0x3b54db(0x131)]==_0x538660['type']&&_0x262b02[_0x3b54db(0x10e)]==_0x538660['bin']&&_0x262b02[_0x3b54db(0x21c)]==_0x538660[_0x3b54db(0x21c)]&&_0x262b02[_0x3b54db(0x224)]==_0x538660[_0x3b54db(0x224)]&&_0x262b02['storage']==_0x538660['storage']&&_0x262b02[_0x3b54db(0x200)]==_0x538660[_0x3b54db(0x200)]&&_0x262b02[_0x3b54db(0x12f)]==_0x538660[_0x3b54db(0x12f)]&&_0x262b02[_0x3b54db(0x117)]==_0x538660[_0x3b54db(0x117)]&&_0x262b02['delivery_date']==_0x538660[_0x3b54db(0x1d5)]&&_0x262b02[_0x3b54db(0x19d)]==_0x538660[_0x3b54db(0x19d)]&&(_0x262b02[_0x3b54db(0x183)]=parseInt(_0x262b02['product_stock'])+parseInt(_0x538660[_0x3b54db(0x1d7)]),_0x5cdbbc++);});_0x5cdbbc=='0'&&(_0xa949f3[_0xdc1e91(0x11f)]=_0xa949f3['product_details'][_0xdc1e91(0x19e)]({'product_name':_0x538660[_0xdc1e91(0x159)],'product_stock':_0x538660['quantity'],'primary_code':_0x538660[_0xdc1e91(0x1f3)],'secondary_code':_0x538660['secondary_code'],'product_code':_0x538660[_0xdc1e91(0x111)],'storage':_0x538660[_0xdc1e91(0x15c)],'rack':_0x538660['rack'],'bay':_0x538660[_0xdc1e91(0x21c)],'bin':_0x538660[_0xdc1e91(0x10e)],'type':_0x538660[_0xdc1e91(0x131)],'floorlevel':_0x538660['floorlevel'],'maxProducts':_0x538660[_0xdc1e91(0x137)],'unit':_0x538660['standard_unit'],'secondary_unit':_0x538660[_0xdc1e91(0x10c)],'expiry_date':_0x538660['expiry_date'],'maxPerUnit':_0x538660[_0xdc1e91(0x211)],'batch_code':_0x538660[_0xdc1e91(0x12f)],'alertQTY':_0x538660[_0xdc1e91(0x172)],'production_date':_0x538660[_0xdc1e91(0x117)],'delivery_date':_0x538660[_0xdc1e91(0x1d5)],'delivery_code':_0x538660[_0xdc1e91(0x19d)]}));}),await _0xa949f3['save'](),_0x2ae360['finalize']='True';const _0x42e5b0=await _0x2ae360[_0x500752(0x225)]();_0x139011['flash']('success',_0x500752(0x1f1)),_0x196b7c['redirect'](_0x500752(0x10f));}catch(_0x21758f){console[_0x500752(0x166)](_0x21758f);}}),router[a0_0x3cf07a(0x1b4)](a0_0x3cf07a(0x1b6),auth,async(_0xf07f6e,_0x22e3a5)=>{var _0x4bfe10=a0_0x3cf07a;try{const {username:_0xe0e7c1,email:_0x203161,role:_0x4ed8dc}=_0xf07f6e['user'],_0x1e5e28=_0xf07f6e[_0x4bfe10(0x19a)],_0x149806=await profile['findOne']({'email':_0x1e5e28[_0x4bfe10(0x124)]}),_0x1301ca=await master_shop[_0x4bfe10(0x21d)](),_0x3d2f19=_0xf07f6e[_0x4bfe10(0x1eb)]['id'],_0xbb3c35=await purchases[_0x4bfe10(0x167)](_0x3d2f19),_0x35f47a=await suppliers['find']({});let _0x298860;if(_0x1e5e28[_0x4bfe10(0x144)]==_0x4bfe10(0x1db)){const _0x52c017=await staff[_0x4bfe10(0x228)]({'email':_0x1e5e28[_0x4bfe10(0x124)]});_0x298860=await warehouse[_0x4bfe10(0x21d)]({'status':_0x4bfe10(0x1f6),'name':_0x52c017['warehouse'],'warehouse_category':_0x4bfe10(0x123)});}else _0x298860=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x4bfe10(0x123)}},{'$group':{'_id':_0x4bfe10(0x110),'name':{'$first':'$name'}}}]);const _0x1a8dd9=await product[_0x4bfe10(0x21d)]({}),_0x4e8c65=BayBinSelected(_0xbb3c35[_0x4bfe10(0x174)],_0xbb3c35[_0x4bfe10(0x12d)]);let _0x50bfbd=new Date(_0xbb3c35[_0x4bfe10(0x200)]),_0x3b87a4=('0'+_0x50bfbd[_0x4bfe10(0x180)]())['slice'](-0x2),_0x22feac=('0'+(_0x50bfbd['getMonth']()+0x1))[_0x4bfe10(0x1c6)](-0x2),_0xa93139=_0x50bfbd[_0x4bfe10(0x15a)](),_0x482e4f=_0xa93139+'-'+_0x22feac+'-'+_0x3b87a4;if(_0x1301ca[0x0][_0x4bfe10(0x170)]=='English\x20(US)'){var _0x799e41=users[_0x4bfe10(0x187)];console[_0x4bfe10(0x166)](_0x799e41);}else{if(_0x1301ca[0x0][_0x4bfe10(0x170)]==_0x4bfe10(0x14d))var _0x799e41=users['Hindi'];else{if(_0x1301ca[0x0]['language']==_0x4bfe10(0x1da))var _0x799e41=users[_0x4bfe10(0x1da)];else{if(_0x1301ca[0x0][_0x4bfe10(0x170)]=='Spanish')var _0x799e41=users['Spanish'];else{if(_0x1301ca[0x0]['language']==_0x4bfe10(0x1a2))var _0x799e41=users[_0x4bfe10(0x1a2)];else{if(_0x1301ca[0x0][_0x4bfe10(0x170)]==_0x4bfe10(0x1c0))var _0x799e41=users[_0x4bfe10(0x20f)];else{if(_0x1301ca[0x0]['language']==_0x4bfe10(0x1e5))var _0x799e41=users[_0x4bfe10(0x1e5)];else{if(_0x1301ca[0x0][_0x4bfe10(0x170)]==_0x4bfe10(0x1ac))var _0x799e41=users[_0x4bfe10(0x20c)];}}}}}}}_0x22e3a5[_0x4bfe10(0x217)](_0x4bfe10(0x1f8),{'success':_0xf07f6e[_0x4bfe10(0x162)](_0x4bfe10(0x173)),'errors':_0xf07f6e[_0x4bfe10(0x162)](_0x4bfe10(0x193)),'role':_0x1e5e28,'profile':_0x149806,'purchases':_0xbb3c35,'suppliers':_0x35f47a,'warehouse':_0x298860,'product':_0x1a8dd9,'master_shop':_0x1301ca,'language':_0x799e41,'ed_fullDate':_0x482e4f,'dataSelected':_0x4e8c65});}catch(_0x8371f5){console['log'](_0x8371f5);}}),router[a0_0x3cf07a(0x219)]('/view/:id',auth,async(_0x383f4b,_0x39a07f)=>{var _0x47c874=a0_0x3cf07a;try{const _0x437562=_0x383f4b[_0x47c874(0x1eb)]['id'],_0x1240c1=await purchases['findOne']({'_id':_0x383f4b[_0x47c874(0x1eb)]['id']}),_0x53f05f=await warehouse[_0x47c874(0x228)]({'name':_0x1240c1[_0x47c874(0x174)],'room':_0x1240c1[_0x47c874(0x12d)]});_0x1240c1[_0x47c874(0x205)][_0x47c874(0x22b)](_0x1355d6=>{var _0x56ddc3=_0x47c874;const _0x12522c=_0x53f05f['product_details'][_0x56ddc3(0x201)](_0x501d41=>{var _0x5237db=_0x56ddc3;_0x501d41['product_name']==_0x1355d6[_0x5237db(0x159)]&&_0x501d41[_0x5237db(0x146)]==_0x1355d6[_0x5237db(0x146)]&&_0x501d41[_0x5237db(0x131)]==_0x1355d6[_0x5237db(0x131)]&&_0x501d41['bin']==_0x1355d6[_0x5237db(0x10e)]&&_0x501d41[_0x5237db(0x21c)]==_0x1355d6['bay']&&_0x501d41[_0x5237db(0x224)]==_0x1355d6['rack']&&_0x501d41[_0x5237db(0x15c)]==_0x1355d6[_0x5237db(0x15c)]&&(_0x501d41[_0x5237db(0x183)]=parseInt(_0x501d41[_0x5237db(0x183)])-parseInt(_0x1355d6[_0x5237db(0x1d7)]));});}),await _0x53f05f[_0x47c874(0x225)]();const {invoice:_0x404df2,suppliers:_0x46e0c3,date:_0x4282e2,warehouse_name:_0x3bc8b8,prod_name:_0x1c19d9,prod_code:_0x1e9888,prod_qty:_0x5365d8,prod_unit:_0x1f73af,prod_secondunit:_0x4182ce,prod_level:_0x2c720a,prod_isle:_0x22ea24,prod_pallet:_0x327f35,note:_0x5b3743,expiry_date:_0x364192,batch_code:_0x11311d,paid_amount:_0x1a3bcf,due_amount:_0x50eb50,Room_name:_0x561da0,primary_code:_0xeaf349,secondary_code:_0x353645,PO_number:_0x8124c9,JO_number:_0x263102}=_0x383f4b[_0x47c874(0x1ef)];if(typeof _0x1c19d9=='string')var _0x1aba1f=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1ab)]],_0x504b0a=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1b5)]],_0x4e5a8f=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x189)]],_0x26e40e=[_0x383f4b['body']['prod_unit']],_0x20f59=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1f5)]],_0x1d1a4a=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1fb)]],_0x4abae2=[_0x383f4b[_0x47c874(0x1ef)]['prod_isle']],_0x2c3edb=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x17b)]],_0x3a6c76=[_0x383f4b['body'][_0x47c874(0x1f3)]],_0x8424e0=[_0x383f4b['body'][_0x47c874(0x1d3)]],_0x4127cb=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x194)]],_0xcb69a3=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x12f)]],_0x50519b=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x200)]],_0x1948f1=[_0x383f4b[_0x47c874(0x1ef)]['storage']],_0x59ba47=[_0x383f4b['body'][_0x47c874(0x1fe)]],_0x53f1b5=[_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x131)]];else var _0x1aba1f=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1ab)]],_0x504b0a=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1b5)]],_0x4e5a8f=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x189)]],_0x26e40e=[..._0x383f4b[_0x47c874(0x1ef)]['prod_unit']],_0x20f59=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1f5)]],_0x1d1a4a=[..._0x383f4b[_0x47c874(0x1ef)]['prod_level']],_0x4abae2=[..._0x383f4b[_0x47c874(0x1ef)]['prod_isle']],_0x2c3edb=[..._0x383f4b['body'][_0x47c874(0x17b)]],_0x3a6c76=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1f3)]],_0x8424e0=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1d3)]],_0x4127cb=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x194)]],_0xcb69a3=[..._0x383f4b[_0x47c874(0x1ef)]['batch_code']],_0x50519b=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x200)]],_0x1948f1=[..._0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x15c)]],_0x59ba47=[..._0x383f4b['body'][_0x47c874(0x1fe)]],_0x53f1b5=[..._0x383f4b['body']['type']];const _0x125618=_0x1aba1f[_0x47c874(0x201)](_0x565238=>{return _0x565238={'product_name':_0x565238};});_0x504b0a['forEach']((_0x32d59a,_0x81d8bc)=>{_0x125618[_0x81d8bc]['product_code']=_0x32d59a;}),_0x4e5a8f[_0x47c874(0x22b)]((_0x107209,_0x42186e)=>{var _0x561ce3=_0x47c874;_0x125618[_0x42186e][_0x561ce3(0x1d7)]=_0x107209;}),_0x26e40e[_0x47c874(0x22b)]((_0x5695de,_0x39ebac)=>{var _0x18fef2=_0x47c874;_0x125618[_0x39ebac][_0x18fef2(0x19f)]=_0x5695de;}),_0x20f59['forEach']((_0x26a041,_0x58aba7)=>{var _0x25e6d9=_0x47c874;_0x125618[_0x58aba7][_0x25e6d9(0x10c)]=_0x26a041;}),_0x1d1a4a[_0x47c874(0x22b)]((_0x4d7025,_0x55e14a)=>{var _0x27e6b8=_0x47c874;_0x125618[_0x55e14a][_0x27e6b8(0x21c)]=_0x4d7025;}),_0x4abae2['forEach']((_0x28274d,_0x4d9812)=>{var _0x3731ec=_0x47c874;_0x125618[_0x4d9812][_0x3731ec(0x10e)]=_0x28274d;}),_0x2c3edb[_0x47c874(0x22b)]((_0x4236af,_0x2cca9d)=>{var _0x5b249d=_0x47c874;_0x125618[_0x2cca9d][_0x5b249d(0x146)]=_0x4236af;}),_0x3a6c76[_0x47c874(0x22b)]((_0x2e53ca,_0x548b70)=>{_0x125618[_0x548b70]['primary_code']=_0x2e53ca;}),_0x8424e0['forEach']((_0x50da77,_0x4b3db7)=>{var _0x25ab31=_0x47c874;_0x125618[_0x4b3db7][_0x25ab31(0x1d3)]=_0x50da77;}),_0x4127cb[_0x47c874(0x22b)]((_0x11bf10,_0x5aad5d)=>{_0x125618[_0x5aad5d]['maxStocks']=_0x11bf10;}),_0xcb69a3[_0x47c874(0x22b)]((_0xd89772,_0x3fc6a4)=>{_0x125618[_0x3fc6a4]['batch_code']=_0xd89772;}),_0x50519b[_0x47c874(0x22b)]((_0x567752,_0x5b2ea4)=>{var _0x205ecb=_0x47c874;_0x125618[_0x5b2ea4][_0x205ecb(0x200)]=_0x567752;}),_0x53f1b5['forEach']((_0x3c14f0,_0x5befd7)=>{_0x125618[_0x5befd7]['type']=_0x3c14f0;}),_0x1948f1[_0x47c874(0x22b)]((_0x18f1ef,_0x463781)=>{var _0x2f2ce4=_0x47c874;_0x125618[_0x463781][_0x2f2ce4(0x15c)]=_0x18f1ef;}),_0x59ba47[_0x47c874(0x22b)]((_0x2a6e2a,_0x1d5baa)=>{var _0xed288f=_0x47c874;_0x125618[_0x1d5baa][_0xed288f(0x224)]=_0x2a6e2a;});const _0x237032=_0x125618[_0x47c874(0x14b)](_0xd2dd8a=>_0xd2dd8a[_0x47c874(0x1d7)]!=='0'&&_0xd2dd8a[_0x47c874(0x1d7)]!=='');_0x1240c1[_0x47c874(0x1dd)]=_0x404df2,_0x1240c1[_0x47c874(0x1fd)]=_0x46e0c3,_0x1240c1[_0x47c874(0x195)]=_0x4282e2,_0x1240c1['warehouse_name']=_0x3bc8b8,_0x1240c1[_0x47c874(0x205)]=_0x237032,_0x1240c1[_0x47c874(0x1ed)]=_0x5b3743,_0x1240c1['paid_amount']=_0x1a3bcf,_0x1240c1[_0x47c874(0x21f)]=_0x50eb50,_0x1240c1[_0x47c874(0x12d)]=_0x561da0,_0x1240c1[_0x47c874(0x13c)]=_0x8124c9,_0x1240c1[_0x47c874(0x139)]=_0x263102;const _0x167013=await _0x1240c1[_0x47c874(0x225)](),_0x24d56f=await warehouse[_0x47c874(0x228)]({'name':_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x174)],'room':_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1f4)]});_0x1240c1['product']['forEach'](_0x17298c=>{var _0x377d68=_0x47c874,_0x5e15b0=0x0;const _0x21c08d=_0x24d56f[_0x377d68(0x11f)]['map'](_0x2be93b=>{var _0x3d91f7=_0x377d68;_0x2be93b['product_name']==_0x17298c[_0x3d91f7(0x159)]&&_0x2be93b['floorlevel']==_0x17298c[_0x3d91f7(0x146)]&&_0x2be93b['type']==_0x17298c[_0x3d91f7(0x131)]&&_0x2be93b[_0x3d91f7(0x10e)]==_0x17298c[_0x3d91f7(0x10e)]&&_0x2be93b[_0x3d91f7(0x21c)]==_0x17298c[_0x3d91f7(0x21c)]&&_0x2be93b['rack']==_0x17298c[_0x3d91f7(0x224)]&&_0x2be93b[_0x3d91f7(0x15c)]==_0x17298c[_0x3d91f7(0x15c)]&&(_0x2be93b[_0x3d91f7(0x183)]=parseInt(_0x2be93b[_0x3d91f7(0x183)])+parseInt(_0x17298c['quantity']),_0x5e15b0++);});_0x5e15b0=='0'&&(_0x24d56f['product_details']=_0x24d56f[_0x377d68(0x11f)][_0x377d68(0x19e)]({'product_name':_0x17298c[_0x377d68(0x159)],'product_stock':_0x17298c[_0x377d68(0x1d7)],'primary_code':_0x17298c[_0x377d68(0x1f3)],'secondary_code':_0x17298c['secondary_code'],'product_code':_0x17298c[_0x377d68(0x111)],'storage':_0x17298c[_0x377d68(0x15c)],'rack':_0x17298c[_0x377d68(0x224)],'bay':_0x17298c[_0x377d68(0x21c)],'bin':_0x17298c['bin'],'type':_0x17298c[_0x377d68(0x131)],'floorlevel':_0x17298c[_0x377d68(0x146)],'maxProducts':_0x17298c[_0x377d68(0x137)],'unit':_0x17298c['standard_unit'],'secondary_unit':_0x17298c[_0x377d68(0x10c)],'expiry_date':_0x17298c[_0x377d68(0x200)]}));}),await _0x24d56f[_0x47c874(0x225)]();const _0x495cf7=await s_payment_data['findOne']({'invoice':_0x383f4b['body'][_0x47c874(0x1dd)]});if(_0x495cf7===null){}else console['log'](_0x47c874(0x1fd),_0x495cf7,_0x383f4b['body'][_0x47c874(0x1dd)]),_0x495cf7[_0x47c874(0x1fd)]=_0x383f4b[_0x47c874(0x1ef)][_0x47c874(0x1fd)],await _0x495cf7[_0x47c874(0x225)]();_0x383f4b[_0x47c874(0x162)](_0x47c874(0x173),'purchase\x20data\x20update\x20successfully'),_0x39a07f[_0x47c874(0x1fa)]('/all_purchases/view');}catch(_0xc32275){console[_0x47c874(0x166)](_0xc32275);}}),router['post'](a0_0x3cf07a(0x1a3),auth,async(_0x1728da,_0x38b346)=>{var _0x524a7a=a0_0x3cf07a;try{const _0x73072a=_0x1728da[_0x524a7a(0x1eb)]['id'],{invoice:_0x30f250,suppliers:_0x42d2e7,payable:_0x503cda,due_amount:_0x112898}=_0x1728da[_0x524a7a(0x1ef)],_0x3a1598=await purchases['findById'](_0x73072a);var _0x3cb68c=_0x503cda-_0x112898;_0x3a1598[_0x524a7a(0x12e)]=parseFloat(_0x3a1598[_0x524a7a(0x12e)])+parseFloat(_0x112898),_0x3a1598[_0x524a7a(0x21f)]=_0x3cb68c;const _0x31b3cd=await _0x3a1598[_0x524a7a(0x225)]();console[_0x524a7a(0x166)](_0x31b3cd);const _0x1235a0=await s_payment_data['findOne']({'invoice':_0x30f250});_0x1235a0['amount']=_0x3cb68c,await _0x1235a0[_0x524a7a(0x225)]();let _0x2a2de0=new Date(),_0x2b484d=('0'+_0x2a2de0[_0x524a7a(0x180)]())[_0x524a7a(0x1c6)](-0x2),_0x15fa52=('0'+(_0x2a2de0[_0x524a7a(0x165)]()+0x1))[_0x524a7a(0x1c6)](-0x2),_0x3c0cf0=_0x2a2de0[_0x524a7a(0x15a)](),_0x2e5b3f=_0x3c0cf0+'-'+_0x15fa52+'-'+_0x2b484d;const _0x40896e=new suppliers_payment({'invoice':_0x30f250,'date':_0x3c0cf0+'-'+_0x15fa52+'-'+_0x2b484d,'suppliers':_0x42d2e7,'reason':_0x524a7a(0x1ff),'amount':_0x112898}),_0x387886=await _0x40896e[_0x524a7a(0x225)]();_0x1728da[_0x524a7a(0x162)](_0x524a7a(0x173),_0x524a7a(0x135)),_0x38b346['redirect'](_0x524a7a(0x10f));}catch(_0xc9031a){console[_0x524a7a(0x166)](_0xc9031a);}}),router[a0_0x3cf07a(0x1b4)](a0_0x3cf07a(0x206),auth,async(_0x17ff66,_0x17e8c1)=>{var _0x68ce5=a0_0x3cf07a;try{const {username:_0xa13518,email:_0x2784f9,role:_0x5f53d5}=_0x17ff66['user'],_0x105191=_0x17ff66[_0x68ce5(0x19a)],_0x466f42=await profile[_0x68ce5(0x228)]({'email':_0x105191[_0x68ce5(0x124)]}),_0x4a99ec=await master_shop[_0x68ce5(0x21d)]();console['log'](_0x68ce5(0x130),_0x4a99ec);const _0x50c520=_0x17ff66[_0x68ce5(0x1eb)]['id'],_0x5d2451=await purchases[_0x68ce5(0x167)](_0x50c520);console[_0x68ce5(0x166)](_0x5d2451);const _0x177123=await suppliers['findOne']({'name':_0x5d2451[_0x68ce5(0x1fd)]});console[_0x68ce5(0x166)](_0x177123);if(_0x4a99ec[0x0][_0x68ce5(0x170)]==_0x68ce5(0x188)){var _0x16a55f=users[_0x68ce5(0x187)];console['log'](_0x16a55f);}else{if(_0x4a99ec[0x0]['language']=='Hindi')var _0x16a55f=users['Hindi'];else{if(_0x4a99ec[0x0][_0x68ce5(0x170)]==_0x68ce5(0x1da))var _0x16a55f=users[_0x68ce5(0x1da)];else{if(_0x4a99ec[0x0][_0x68ce5(0x170)]==_0x68ce5(0x134))var _0x16a55f=users[_0x68ce5(0x134)];else{if(_0x4a99ec[0x0][_0x68ce5(0x170)]==_0x68ce5(0x1a2))var _0x16a55f=users[_0x68ce5(0x1a2)];else{if(_0x4a99ec[0x0]['language']==_0x68ce5(0x1c0))var _0x16a55f=users[_0x68ce5(0x20f)];else{if(_0x4a99ec[0x0]['language']=='Chinese')var _0x16a55f=users[_0x68ce5(0x1e5)];else{if(_0x4a99ec[0x0][_0x68ce5(0x170)]==_0x68ce5(0x1ac))var _0x16a55f=users[_0x68ce5(0x20c)];}}}}}}}_0x17e8c1['render'](_0x68ce5(0x215),{'success':_0x17ff66[_0x68ce5(0x162)](_0x68ce5(0x173)),'errors':_0x17ff66[_0x68ce5(0x162)]('errors'),'role':_0x105191,'profile':_0x466f42,'master_shop':_0x4a99ec,'supplier':_0x177123,'purchase':_0x5d2451,'language':_0x16a55f});}catch(_0x43a7d3){console[_0x68ce5(0x166)](_0x43a7d3);}}),router[a0_0x3cf07a(0x1b4)]('/view/return_purchase/:id',auth,async(_0x37a509,_0x539bb2)=>{var _0x4b6052=a0_0x3cf07a;try{const {username:_0x39f695,email:_0x57a5b7,role:_0x29dd51}=_0x37a509[_0x4b6052(0x19a)],_0x48a362=_0x37a509[_0x4b6052(0x19a)],_0x5d3fd1=await profile[_0x4b6052(0x228)]({'email':_0x48a362[_0x4b6052(0x124)]}),_0x4deb2e=await master_shop[_0x4b6052(0x21d)]();console['log'](_0x4b6052(0x130),_0x4deb2e);const _0x34a664=_0x37a509[_0x4b6052(0x1eb)]['id'];console[_0x4b6052(0x166)](_0x34a664);const _0x2f849c=await purchases[_0x4b6052(0x167)](_0x34a664);console[_0x4b6052(0x166)](_0x4b6052(0x155),_0x2f849c);const _0x5db2b6=await product[_0x4b6052(0x21d)]({}),_0x3f99e9=await warehouse['aggregate']([{'$match':{'name':_0x2f849c[_0x4b6052(0x174)],'room':_0x2f849c[_0x4b6052(0x12d)],'warehouse_category':_0x4b6052(0x123)}},{'$unwind':_0x4b6052(0x14f)},{'$group':{'_id':_0x4b6052(0x17a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4b6052(0x177)},'bay':{'$first':_0x4b6052(0x1ee)},'bin':{'$first':_0x4b6052(0x15f)},'type':{'$first':_0x4b6052(0x1dc)},'floorlevel':{'$first':_0x4b6052(0x112)},'primary_code':{'$first':_0x4b6052(0x150)},'secondary_code':{'$first':_0x4b6052(0x1ce)},'product_code':{'$first':_0x4b6052(0x13d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4b6052(0x17c)}}}]);warehouse_data=await warehouse[_0x4b6052(0x222)]([{'$match':{'status':_0x4b6052(0x1f6),'name':_0x4b6052(0x192),'warehouse_category':_0x4b6052(0x123)}},{'$group':{'_id':_0x4b6052(0x110),'name':{'$first':_0x4b6052(0x110)}}},{'$sort':{'name':0x1}}]),console[_0x4b6052(0x166)](_0x4b6052(0x1c5),_0x3f99e9);if(_0x4deb2e[0x0][_0x4b6052(0x170)]=='English\x20(US)'){var _0x3467e6=users[_0x4b6052(0x187)];console[_0x4b6052(0x166)](_0x3467e6);}else{if(_0x4deb2e[0x0][_0x4b6052(0x170)]=='Hindi')var _0x3467e6=users[_0x4b6052(0x14d)];else{if(_0x4deb2e[0x0][_0x4b6052(0x170)]==_0x4b6052(0x1da))var _0x3467e6=users[_0x4b6052(0x1da)];else{if(_0x4deb2e[0x0]['language']=='Spanish')var _0x3467e6=users[_0x4b6052(0x134)];else{if(_0x4deb2e[0x0][_0x4b6052(0x170)]==_0x4b6052(0x1a2))var _0x3467e6=users[_0x4b6052(0x1a2)];else{if(_0x4deb2e[0x0][_0x4b6052(0x170)]==_0x4b6052(0x1c0))var _0x3467e6=users[_0x4b6052(0x20f)];else{if(_0x4deb2e[0x0][_0x4b6052(0x170)]==_0x4b6052(0x1e5))var _0x3467e6=users[_0x4b6052(0x1e5)];else{if(_0x4deb2e[0x0][_0x4b6052(0x170)]==_0x4b6052(0x1ac))var _0x3467e6=users['Arabic'];}}}}}}}_0x539bb2[_0x4b6052(0x217)](_0x4b6052(0x152),{'success':_0x37a509[_0x4b6052(0x162)]('success'),'errors':_0x37a509[_0x4b6052(0x162)](_0x4b6052(0x193)),'role':_0x48a362,'profile':_0x5d3fd1,'user':_0x2f849c,'stock':_0x3f99e9,'master_shop':_0x4deb2e,'product':_0x5db2b6,'language':_0x3467e6,'warehouse':warehouse_data});}catch(_0xe2fb41){console[_0x4b6052(0x166)](_0xe2fb41);}}),router[a0_0x3cf07a(0x219)]('/view/return_purchase/:id',auth,async(_0x3e6edc,_0x2b0809)=>{var _0x38ccd3=a0_0x3cf07a;try{const {invoice:_0x44ccc3,date:_0x87e784,warehouse_name:_0x40b59b,Room_name:_0x42cb94,product_name:_0x768287,purchase_quantity:_0x4d68f5,stocks:_0x29caf7,return_qty:_0x1bd0f7,note:_0x14ccc1,level:_0x13c421,isle:_0x41e1ca,pallet:_0x7a7dd8,to_warehouse_name:_0x552cda,to_Room_name:_0x15bd7b}=_0x3e6edc[_0x38ccd3(0x1ef)],_0x14a8d7=await purchases[_0x38ccd3(0x228)]({'_id':_0x3e6edc[_0x38ccd3(0x1eb)]['id']}),_0x574c89=await warehouse[_0x38ccd3(0x228)]({'name':_0x40b59b,'room':_0x42cb94});if(typeof _0x768287==_0x38ccd3(0x1fc))var _0x4d9b1b=[_0x3e6edc[_0x38ccd3(0x1ef)]['product_name']],_0x3cacf5=[_0x3e6edc['body'][_0x38ccd3(0x1bd)]],_0x52b60c=[_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x16c)]],_0x42da33=[_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x154)]],_0x560ee3=[_0x3e6edc[_0x38ccd3(0x1ef)]['level']],_0x2ac428=[_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x1d0)]],_0x32a1a7=[_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x196)]],_0xf30525=[_0x3e6edc['body'][_0x38ccd3(0x153)]],_0x49c28c=[_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x118)]],_0x397368=[_0x3e6edc['body'][_0x38ccd3(0x22a)]],_0xd3896d=[_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x149)]];else var _0x4d9b1b=[..._0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x159)]],_0x3cacf5=[..._0x3e6edc[_0x38ccd3(0x1ef)]['purchase_quantity']],_0x52b60c=[..._0x3e6edc['body'][_0x38ccd3(0x16c)]],_0x42da33=[..._0x3e6edc['body'][_0x38ccd3(0x154)]],_0x560ee3=[..._0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x1d2)]],_0x2ac428=[..._0x3e6edc['body'][_0x38ccd3(0x1d0)]],_0x32a1a7=[..._0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x196)]],_0xf30525=[..._0x3e6edc['body'][_0x38ccd3(0x153)]],_0x49c28c=[..._0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x118)]],_0x397368=[..._0x3e6edc[_0x38ccd3(0x1ef)]['primary_code_hide']],_0xd3896d=[..._0x3e6edc[_0x38ccd3(0x1ef)]['secondary_code_hide']];const _0x5da50c=_0x4d9b1b[_0x38ccd3(0x201)](_0x4fa56b=>{return _0x4fa56b={'product_name':_0x4fa56b};});_0x3cacf5[_0x38ccd3(0x22b)]((_0x5673d4,_0x315238)=>{var _0x48f8e9=_0x38ccd3;_0x5da50c[_0x315238][_0x48f8e9(0x1bd)]=_0x5673d4;}),_0x52b60c['forEach']((_0x42c639,_0x2445d4)=>{var _0x9369ec=_0x38ccd3;_0x5da50c[_0x2445d4][_0x9369ec(0x14e)]=_0x42c639;}),_0x42da33[_0x38ccd3(0x22b)]((_0x3b30ba,_0x250884)=>{var _0x50e1a7=_0x38ccd3;_0x5da50c[_0x250884][_0x50e1a7(0x154)]=_0x3b30ba;}),_0x560ee3[_0x38ccd3(0x22b)]((_0x2ba2a5,_0x543007)=>{_0x5da50c[_0x543007]['bay']=_0x2ba2a5;}),_0x2ac428[_0x38ccd3(0x22b)]((_0x4e125d,_0x5512a6)=>{var _0x5b7292=_0x38ccd3;_0x5da50c[_0x5512a6][_0x5b7292(0x10e)]=_0x4e125d;}),_0x32a1a7[_0x38ccd3(0x22b)]((_0x5f5503,_0x5320f0)=>{var _0x342f3c=_0x38ccd3;_0x5da50c[_0x5320f0][_0x342f3c(0x146)]=_0x5f5503;}),_0xf30525[_0x38ccd3(0x22b)]((_0x58ff9a,_0xa6fb4b)=>{var _0x261ab7=_0x38ccd3;_0x5da50c[_0xa6fb4b][_0x261ab7(0x131)]=_0x58ff9a;}),_0x49c28c['forEach']((_0x452f4c,_0x3e9685)=>{var _0x1df35c=_0x38ccd3;_0x5da50c[_0x3e9685][_0x1df35c(0x111)]=_0x452f4c;}),_0x397368[_0x38ccd3(0x22b)]((_0x206158,_0x293195)=>{var _0x1ca3ff=_0x38ccd3;_0x5da50c[_0x293195][_0x1ca3ff(0x1f3)]=_0x206158;}),_0xd3896d[_0x38ccd3(0x22b)]((_0xab2bb4,_0x4643e8)=>{_0x5da50c[_0x4643e8]['secondary_code']=_0xab2bb4;}),_0x14a8d7['product'][_0x38ccd3(0x22b)](_0x365fc9=>{var _0x539652=_0x38ccd3;const _0x2cd89b=_0x574c89[_0x539652(0x11f)]['map'](_0x3ac5d3=>{var _0x1a388b=_0x539652;_0x3ac5d3[_0x1a388b(0x159)]==_0x365fc9[_0x1a388b(0x159)]&&_0x3ac5d3['floorlevel']==_0x365fc9[_0x1a388b(0x146)]&&_0x3ac5d3[_0x1a388b(0x131)]==_0x365fc9[_0x1a388b(0x131)]&&_0x3ac5d3[_0x1a388b(0x10e)]==_0x365fc9[_0x1a388b(0x10e)]&&_0x3ac5d3[_0x1a388b(0x21c)]==_0x365fc9[_0x1a388b(0x21c)]&&_0x3ac5d3[_0x1a388b(0x224)]==_0x365fc9[_0x1a388b(0x224)]&&_0x3ac5d3[_0x1a388b(0x15c)]==_0x365fc9[_0x1a388b(0x15c)]&&(console[_0x1a388b(0x166)](parseInt(_0x3ac5d3[_0x1a388b(0x183)])+'\x20<>\x20'+parseInt(_0x365fc9['quantity'])),_0x3ac5d3[_0x1a388b(0x183)]=parseInt(_0x3ac5d3['product_stock'])+parseInt(_0x365fc9[_0x1a388b(0x1d7)]));});}),await _0x574c89[_0x38ccd3(0x225)]();const _0x3d57f1=_0x5da50c[_0x38ccd3(0x14b)](_0x5ab80f=>_0x5ab80f['return_qty']!=='0'&&_0x5ab80f['return_qty']!=='');var _0x28c82e=0x0;_0x3d57f1[_0x38ccd3(0x22b)](_0xd5a81d=>{var _0x48de33=_0x38ccd3;console[_0x48de33(0x166)](_0x48de33(0x1f9),_0xd5a81d),(parseInt(_0xd5a81d[_0x48de33(0x1bd)])<parseInt(_0xd5a81d['return_qty'])||parseInt(_0xd5a81d['stock_quantity'])<parseInt(_0xd5a81d[_0x48de33(0x154)]))&&_0x28c82e++;});if(_0x28c82e!=0x0)return _0x3e6edc['flash'](_0x38ccd3(0x193),_0x38ccd3(0x145)),_0x2b0809['redirect'](_0x38ccd3(0x1c2));const _0x55d05a=new purchases_return({'invoice':_0x44ccc3,'suppliers':_0x3e6edc[_0x38ccd3(0x1ef)]['suppliers'],'date':_0x87e784,'warehouse_name':_0x40b59b,'return_product':_0x3d57f1,'note':_0x14ccc1,'room':_0x42cb94,'to_warehouse_name':_0x552cda,'to_room':_0x15bd7b}),_0x20ed5e=await _0x55d05a[_0x38ccd3(0x225)]();console[_0x38ccd3(0x166)](_0x55d05a);const _0x1412aa=await purchases_return[_0x38ccd3(0x228)]({'invoice':_0x44ccc3}),_0x5aa614=await warehouse[_0x38ccd3(0x228)]({'name':_0x552cda,'room':_0x15bd7b});_0x1412aa[_0x38ccd3(0x13f)][_0x38ccd3(0x22b)](_0x144d41=>{var _0x212635=_0x38ccd3,_0x470d9d=0x0;const _0x52b5a8=_0x5aa614['product_details']['map'](_0x4379d6=>{var _0x2d5bd6=a0_0x3133;_0x4379d6['product_name']==_0x144d41['product_name']&&_0x4379d6[_0x2d5bd6(0x146)]==_0x144d41['floorlevel']&&_0x4379d6[_0x2d5bd6(0x131)]==_0x144d41[_0x2d5bd6(0x131)]&&_0x4379d6[_0x2d5bd6(0x10e)]==_0x144d41[_0x2d5bd6(0x10e)]&&_0x4379d6[_0x2d5bd6(0x21c)]==_0x144d41[_0x2d5bd6(0x21c)]&&(_0x4379d6[_0x2d5bd6(0x183)]=parseInt(_0x4379d6[_0x2d5bd6(0x183)])-parseInt(_0x144d41['return_qty']),_0x470d9d++);});_0x470d9d=='0'&&(_0x5aa614[_0x212635(0x11f)]=_0x5aa614[_0x212635(0x11f)][_0x212635(0x19e)]({'product_name':_0x144d41[_0x212635(0x159)],'product_stock':_0x144d41['return_qty'],'primary_code':_0x144d41[_0x212635(0x1f3)],'secondary_code':_0x144d41['secondary_code'],'product_code':_0x144d41[_0x212635(0x111)],'storage':_0x144d41[_0x212635(0x15c)],'rack':_0x144d41[_0x212635(0x224)],'bay':_0x144d41[_0x212635(0x21c)],'bin':_0x144d41[_0x212635(0x10e)],'type':_0x144d41['type'],'floorlevel':_0x144d41[_0x212635(0x146)],'maxProducts':_0x144d41[_0x212635(0x137)],'unit':_0x144d41['standard_unit'],'secondary_unit':_0x144d41[_0x212635(0x10c)],'expiry_date':_0x144d41[_0x212635(0x200)]}));}),await _0x5aa614['save']();const _0x31d0d5=await purchases[_0x38ccd3(0x228)]({'invoice':_0x44ccc3});_0x31d0d5[_0x38ccd3(0x13b)]=_0x38ccd3(0x16f);const _0x4a1de4=await _0x31d0d5['save'](),_0x3a10f8=new s_payment_data({'invoice':_0x44ccc3,'suppliers':_0x3e6edc['body']['suppliers'],'reason':_0x38ccd3(0x185)});await _0x3a10f8['save']();const _0x33a2d3=await master_shop[_0x38ccd3(0x21d)]();console[_0x38ccd3(0x166)](_0x38ccd3(0x10b),_0x33a2d3[0x0][_0x38ccd3(0x1e0)]);const _0x226f7a=await email_settings[_0x38ccd3(0x228)](),_0x1b4191=await suppliers[_0x38ccd3(0x228)]({'name':_0x3e6edc[_0x38ccd3(0x1ef)][_0x38ccd3(0x1fd)]});console['log'](_0x38ccd3(0x1aa),_0x1b4191);_0x33a2d3[0x0][_0x38ccd3(0x1af)]==0x1?(right_currency=_0x33a2d3[0x0][_0x38ccd3(0x1e3)],left_currency=''):(right_currency='',left_currency=_0x33a2d3[0x0][_0x38ccd3(0x1e3)]);var _0x1e5ba1=_0x4d9b1b,_0x104291=_0x42da33,_0x354c1c='',_0xfa52cc;for(_0xfa52cc in _0x1e5ba1){_0x354c1c+=_0x38ccd3(0x1c8)+_0x38ccd3(0x11e)+_0x1e5ba1[_0xfa52cc]+_0x38ccd3(0x16e)+_0x38ccd3(0x11e)+_0x104291[_0xfa52cc]+'</td>'+_0x38ccd3(0x147);}console[_0x38ccd3(0x166)](_0x38ccd3(0x14a),_0x354c1c);let _0x21233a=nodemailer[_0x38ccd3(0x171)]({'service':_0x38ccd3(0x132),'auth':{'user':_0x226f7a[_0x38ccd3(0x124)],'pass':_0x226f7a[_0x38ccd3(0x21a)]}}),_0x495ff0={'from':_0x226f7a[_0x38ccd3(0x124)],'to':_0x1b4191[_0x38ccd3(0x124)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x38ccd3(0x18f),'path':__dirname+'/../public'+_0x38ccd3(0x1f2)+_0x33a2d3[0x0][_0x38ccd3(0x1e0)],'cid':'logo'}],'html':_0x38ccd3(0x227)+_0x38ccd3(0x1f7)+_0x38ccd3(0x12c)+_0x38ccd3(0x22c)+_0x38ccd3(0x202)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+'<h2>\x20'+_0x33a2d3[0x0][_0x38ccd3(0x1b9)]+_0x38ccd3(0x1b8)+_0x38ccd3(0x1de)+_0x38ccd3(0x1de)+'<hr\x20class=\x22my-3\x22>'+_0x38ccd3(0x22c)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x38ccd3(0x10d)+_0x44ccc3+'\x20'+_0x38ccd3(0x128)+_0x38ccd3(0x142)+_0x87e784+'\x20'+'</span>'+'</h5>'+'</div>'+_0x38ccd3(0x1ba)+_0x38ccd3(0x17f)+_0x38ccd3(0x1c8)+_0x38ccd3(0x18a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x38ccd3(0x1bc)+_0x38ccd3(0x119)+'</tr>'+_0x38ccd3(0x1cd)+_0x38ccd3(0x18b)+'\x20'+_0x354c1c+'\x20'+'</tbody>'+_0x38ccd3(0x20d)+_0x38ccd3(0x22c)+'<strong>\x20Regards\x20</strong>'+_0x38ccd3(0x16d)+_0x33a2d3[0x0][_0x38ccd3(0x1b9)]+_0x38ccd3(0x11c)+'</div>'+_0x38ccd3(0x1de)+_0x38ccd3(0x125)};_0x21233a[_0x38ccd3(0x1ae)](_0x495ff0,function(_0x4dee08,_0x5f18e2){var _0x4c3816=_0x38ccd3;_0x4dee08?(console[_0x4c3816(0x166)](_0x4dee08),console[_0x4c3816(0x166)](_0x4c3816(0x213))):console[_0x4c3816(0x166)](_0x4c3816(0x1b2));}),_0x3e6edc[_0x38ccd3(0x162)](_0x38ccd3(0x173),_0x38ccd3(0x11a)),_0x2b0809[_0x38ccd3(0x1fa)](_0x38ccd3(0x10f));}catch(_0x5dd5c0){console[_0x38ccd3(0x166)](_0x5dd5c0),_0x2b0809[_0x38ccd3(0x136)](0xc8)['json']({'message':_0x5dd5c0[_0x38ccd3(0x121)]});}}),router[a0_0x3cf07a(0x1b4)](a0_0x3cf07a(0x17d),auth,async(_0x5ea2f9,_0x45519d)=>{var _0xdceb87=a0_0x3cf07a;try{const {username:_0x444e0d,email:_0xe34fa3,role:_0x54b5ae}=_0x5ea2f9['user'],_0x564ec0=_0x5ea2f9['user'],_0x9bcebf=await profile[_0xdceb87(0x228)]({'email':_0x564ec0[_0xdceb87(0x124)]}),_0x2c0919=await master_shop[_0xdceb87(0x21d)](),_0x3f4e7d=_0x5ea2f9['params']['id'],_0x1a894a=await purchases[_0xdceb87(0x167)](_0x3f4e7d);if(_0x2c0919[0x0]['language']==_0xdceb87(0x188))var _0x26c08e=users[_0xdceb87(0x187)];else{if(_0x2c0919[0x0][_0xdceb87(0x170)]==_0xdceb87(0x14d))var _0x26c08e=users[_0xdceb87(0x14d)];else{if(_0x2c0919[0x0][_0xdceb87(0x170)]=='German')var _0x26c08e=users[_0xdceb87(0x1da)];else{if(_0x2c0919[0x0][_0xdceb87(0x170)]==_0xdceb87(0x134))var _0x26c08e=users[_0xdceb87(0x134)];else{if(_0x2c0919[0x0]['language']==_0xdceb87(0x1a2))var _0x26c08e=users[_0xdceb87(0x1a2)];else{if(_0x2c0919[0x0][_0xdceb87(0x170)]==_0xdceb87(0x1c0))var _0x26c08e=users[_0xdceb87(0x20f)];else{if(_0x2c0919[0x0]['language']==_0xdceb87(0x1e5))var _0x26c08e=users['Chinese'];else{if(_0x2c0919[0x0][_0xdceb87(0x170)]==_0xdceb87(0x1ac))var _0x26c08e=users[_0xdceb87(0x20c)];}}}}}}}_0x45519d[_0xdceb87(0x217)]('all_purchases_barcode',{'success':_0x5ea2f9[_0xdceb87(0x162)]('success'),'errors':_0x5ea2f9[_0xdceb87(0x162)]('errors'),'role':_0x564ec0,'profile':_0x9bcebf,'alldata':_0x1a894a,'master_shop':_0x2c0919,'language':_0x26c08e}),console[_0xdceb87(0x166)](alldata);}catch(_0x5e3e0d){console[_0xdceb87(0x166)](_0x5e3e0d);}}),router[a0_0x3cf07a(0x219)](a0_0x3cf07a(0x20b),async(_0x20d317,_0x20214e)=>{var _0x596a50=a0_0x3cf07a;const {product_code:_0x53f229}=_0x20d317['body'];var _0xd25bc5;const _0x1b9c2d=await product[_0x596a50(0x222)]([{'$match':{'primary_code':_0x53f229,'product_category':_0x596a50(0x123)}},{'$group':{'_id':_0x596a50(0x1a0),'name':{'$first':_0x596a50(0x110)},'category':{'$first':_0x596a50(0x1e4)},'brand':{'$first':_0x596a50(0x216)},'unit':{'$first':_0x596a50(0x1e8)},'alertquantity':{'$first':_0x596a50(0x127)},'product_code':{'$first':_0x596a50(0x126)},'primary_code':{'$first':_0x596a50(0x17e)},'secondary_code':{'$first':_0x596a50(0x1b7)},'maxStocks':{'$first':_0x596a50(0x120)},'maxProdPerUnit':{'$first':_0x596a50(0x198)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x596a50(0x13e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x12997a=await product['aggregate']([{'$match':{'secondary_code':_0x53f229,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x596a50(0x1a0),'name':{'$first':_0x596a50(0x110)},'category':{'$first':_0x596a50(0x1e4)},'brand':{'$first':_0x596a50(0x216)},'unit':{'$first':_0x596a50(0x1e8)},'alertquantity':{'$first':_0x596a50(0x127)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x596a50(0x1b7)},'maxStocks':{'$first':_0x596a50(0x120)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x596a50(0x13e)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1b9c2d[_0x596a50(0x122)]>0x0)_0xd25bc5=_0x1b9c2d;else _0x12997a[_0x596a50(0x122)]>0x0&&(_0xd25bc5=_0x12997a);_0x20214e[_0x596a50(0x209)](_0xd25bc5);}),router['post'](a0_0x3cf07a(0x157),async(_0x21d4ea,_0x43e6c8)=>{var _0x55145e=a0_0x3cf07a;const {primaryCode:_0x59753c,secondaryCode:_0x3f887f,productCode:_0x5a03c3,bay:_0x5a43b4,bin:_0x25a4eb,types:_0x16db05,pallet:_0x8ffdfc,warehouses:_0x3e7066,room:_0x280034}=_0x21d4ea[_0x55145e(0x1ef)];console[_0x55145e(0x166)](_0x21d4ea['body']);try{const _0x1a477c=await warehouse[_0x55145e(0x222)]([{'$match':{'name':_0x3e7066,'room':_0x280034}},{'$unwind':_0x55145e(0x14f)},{'$match':{'product_details.bay':_0x5a43b4,'product_details.bin':_0x25a4eb,'product_details.type':_0x16db05}},{'$group':{'_id':_0x55145e(0x17a),'name':{'$first':_0x55145e(0x129)},'product_stock':{'$first':_0x55145e(0x177)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x55145e(0x221)}}}]);_0x43e6c8[_0x55145e(0x136)](0xc8)[_0x55145e(0x209)](_0x1a477c);}catch(_0x1d7de2){_0x43e6c8[_0x55145e(0x136)](0x194)['json']({'message':_0x1d7de2[_0x55145e(0x121)]});}}),module[a0_0x3cf07a(0x151)]=router;