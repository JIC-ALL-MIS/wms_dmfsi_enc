var a0_0x52c0f7=a0_0x4583;(function(_0x25aba5,_0x1ea508){var _0x27e921=a0_0x4583,_0x10f318=_0x25aba5();while(!![]){try{var _0x553cf3=-parseInt(_0x27e921(0x176))/0x1+-parseInt(_0x27e921(0x1de))/0x2+-parseInt(_0x27e921(0x26a))/0x3*(-parseInt(_0x27e921(0x218))/0x4)+parseInt(_0x27e921(0x1e6))/0x5*(parseInt(_0x27e921(0x1ab))/0x6)+-parseInt(_0x27e921(0x1a3))/0x7+-parseInt(_0x27e921(0x1a9))/0x8*(-parseInt(_0x27e921(0x237))/0x9)+parseInt(_0x27e921(0x223))/0xa;if(_0x553cf3===_0x1ea508)break;else _0x10f318['push'](_0x10f318['shift']());}catch(_0x276db0){_0x10f318['push'](_0x10f318['shift']());}}}(a0_0x27cc,0xda0bb));const express=require('express'),app=express(),router=express[a0_0x52c0f7(0x1c2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x52c0f7(0x169)),auth=require(a0_0x52c0f7(0x159)),nodemailer=require(a0_0x52c0f7(0x19d));function a0_0x4583(_0x5e560b,_0x324604){var _0x27cc6d=a0_0x27cc();return a0_0x4583=function(_0x458302,_0x30ca15){_0x458302=_0x458302-0x155;var _0x86b939=_0x27cc6d[_0x458302];return _0x86b939;},a0_0x4583(_0x5e560b,_0x324604);}var ejs=require(a0_0x52c0f7(0x1b3));const path=require(a0_0x52c0f7(0x243)),users=require(a0_0x52c0f7(0x1cd));router[a0_0x52c0f7(0x1b7)](a0_0x52c0f7(0x1a1),auth,async(_0x4b922c,_0x15f89f)=>{var _0x5862b4=a0_0x52c0f7;try{const {username:_0x221baf,email:_0x22d189,role:_0x198ac7}=_0x4b922c[_0x5862b4(0x1d4)],_0x1fceca=_0x4b922c[_0x5862b4(0x1d4)],_0x30ae31=await profile[_0x5862b4(0x207)]({'email':_0x1fceca[_0x5862b4(0x158)]}),_0x33faad=await staff[_0x5862b4(0x207)]({'email':_0x1fceca[_0x5862b4(0x158)]});if(_0x1fceca[_0x5862b4(0x1b8)]==_0x5862b4(0x19a)){const _0x479d66=await staff[_0x5862b4(0x207)]({'email':_0x1fceca[_0x5862b4(0x158)]});}const _0x1b3a2c=await master_shop['find']();let _0x50ce4a;if(_0x1fceca[_0x5862b4(0x1b8)]==_0x5862b4(0x19a)){const _0x4ef43d=await staff[_0x5862b4(0x207)]({'email':_0x1fceca[_0x5862b4(0x158)]});_0x50ce4a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4ef43d[_0x5862b4(0x1a7)]}},{'$lookup':{'from':'suppliers','localField':_0x5862b4(0x1dc),'foreignField':_0x5862b4(0x18d),'as':_0x5862b4(0x22d)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x5862b4(0x1d9)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5862b4(0x155)},'suppliers':{'$first':_0x5862b4(0x157)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5862b4(0x1a4)},'room':{'$first':_0x5862b4(0x217)},'product':{'$push':_0x5862b4(0x1d9)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5862b4(0x168)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x5862b4(0x208)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x5862b4(0x236)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x5862b4(0x1cb)},'type':{'$addToSet':_0x5862b4(0x1fe)},'floorlevel':{'$addToSet':_0x5862b4(0x18b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x50ce4a=await purchases['aggregate']([{'$lookup':{'from':_0x5862b4(0x1dc),'localField':_0x5862b4(0x1dc),'foreignField':'name','as':_0x5862b4(0x22d)}},{'$unwind':_0x5862b4(0x1c5)},{'$unwind':_0x5862b4(0x1d9)},{'$group':{'_id':_0x5862b4(0x1ce),'invoice':{'$first':_0x5862b4(0x155)},'suppliers':{'$first':_0x5862b4(0x157)},'date':{'$first':_0x5862b4(0x1c9)},'warehouse_name':{'$first':_0x5862b4(0x1a4)},'room':{'$addToSet':_0x5862b4(0x24e)},'product':{'$push':'$product'},'note':{'$first':_0x5862b4(0x1fc)},'paid_amount':{'$first':_0x5862b4(0x168)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x5862b4(0x16c)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x5862b4(0x1c5)},'total_product_quantity':{'$sum':_0x5862b4(0x213)},'level':{'$addToSet':_0x5862b4(0x15f)},'isle':{'$addToSet':_0x5862b4(0x1cb)},'type':{'$addToSet':_0x5862b4(0x1fe)},'floorlevel':{'$addToSet':_0x5862b4(0x18b)},'finalize':{'$first':_0x5862b4(0x271)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1b3a2c[0x0][_0x5862b4(0x1db)]==_0x5862b4(0x225)){var _0x3bf36d=users['English'];console['log'](_0x3bf36d);}else{if(_0x1b3a2c[0x0][_0x5862b4(0x1db)]==_0x5862b4(0x23d))var _0x3bf36d=users[_0x5862b4(0x23d)];else{if(_0x1b3a2c[0x0][_0x5862b4(0x1db)]=='German')var _0x3bf36d=users['German'];else{if(_0x1b3a2c[0x0]['language']==_0x5862b4(0x1c1))var _0x3bf36d=users['Spanish'];else{if(_0x1b3a2c[0x0][_0x5862b4(0x1db)]==_0x5862b4(0x24a))var _0x3bf36d=users[_0x5862b4(0x24a)];else{if(_0x1b3a2c[0x0]['language']==_0x5862b4(0x175))var _0x3bf36d=users[_0x5862b4(0x21c)];else{if(_0x1b3a2c[0x0]['language']=='Chinese')var _0x3bf36d=users[_0x5862b4(0x1cc)];else{if(_0x1b3a2c[0x0]['language']==_0x5862b4(0x16b))var _0x3bf36d=users[_0x5862b4(0x1f5)];}}}}}}}_0x15f89f[_0x5862b4(0x184)](_0x5862b4(0x202),{'success':_0x4b922c['flash'](_0x5862b4(0x1f2)),'errors':_0x4b922c[_0x5862b4(0x209)]('errors'),'purchases':_0x50ce4a,'role':_0x1fceca,'profile':_0x30ae31,'master_shop':_0x1b3a2c,'language':_0x3bf36d});}catch(_0x3cba46){console['log'](_0x5862b4(0x22e),_0x3cba46),_0x15f89f[_0x5862b4(0x15d)](0xc8)[_0x5862b4(0x1b1)]({'message':_0x3cba46['message']});}});function BayBinSelected(_0x32fa33,_0x703697){var _0xef6806=a0_0x52c0f7,_0x2c67a7=[],_0x4e513c=[],_0x1382d9=[],_0x2a9aaf=[],_0x4175e9=[],_0x3c64aa=[];let _0x8452b9=[];if(_0x32fa33==_0xef6806(0x22b))switch(_0x703697){case _0xef6806(0x263):_0x2c67a7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4e513c=[0x1,0x2],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=[_0xef6806(0x266),_0xef6806(0x221)],_0x4175e9=['D'],_0x3c64aa=['A'];break;case _0xef6806(0x16d):_0x2c67a7=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4e513c=[0x1,0x2],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=['Level',_0xef6806(0x221)],_0x4175e9=['D'],_0x3c64aa=['B'];break;case _0xef6806(0x26c):_0x2c67a7=[0x0],_0x4e513c=[0x0],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=[_0xef6806(0x221)],_0x4175e9=['D'],_0x3c64aa=['S'];break;case'Receiving\x20Area':_0x2c67a7=[0x0],_0x4e513c=[0x0],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1382d9=[_0xef6806(0x221)],_0x4175e9=['D'],_0x3c64aa=['R'];break;}else{if(_0x32fa33==_0xef6806(0x1c0))switch(_0x703697){case _0xef6806(0x263):_0x2c67a7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4e513c=['B','F'],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=['Level',_0xef6806(0x221)],_0x4175e9=['C'],_0x3c64aa=['A'];break;case _0xef6806(0x16d):_0x2c67a7=[0x5,0x4,0x3,0x2,0x1],_0x4e513c=['F','B','S'],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=[_0xef6806(0x266),_0xef6806(0x221)],_0x4175e9=['C'],_0x3c64aa=['B'];break;case _0xef6806(0x182):_0x2c67a7=[0x1,0x2,0x3,0x4,0x5],_0x4e513c=['B','F','S'],_0x2a9aaf=[0x5,0x4,0x3,0x2,0x1],_0x1382d9=[_0xef6806(0x266),_0xef6806(0x221)],_0x4175e9=['C'],_0x3c64aa=['C'];break;case'Rack\x20D':_0x2c67a7=[0x5,0x4,0x3,0x2,0x1],_0x4e513c=['F','B','S'],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=[_0xef6806(0x266),_0xef6806(0x221)],_0x4175e9=['C'],_0x3c64aa=['D'];break;case _0xef6806(0x230):_0x2c67a7=[0x4,0x3,0x2,0x1],_0x4e513c=[0x1,0x2],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=['Level',_0xef6806(0x221)],_0x4175e9=['C'],_0x3c64aa=['E'];break;case _0xef6806(0x19e):_0x2c67a7=[0x1,0x2,0x3],_0x4e513c=[0x1,0x2],_0x2a9aaf=[0x1,0x2,0x3,0x4,0x5],_0x1382d9=[_0xef6806(0x266)],_0x4175e9=['C'],_0x3c64aa=['F'];break;}}return{'levels':_0x2c67a7,'Isle':_0x4e513c,'rack':_0x2a9aaf,'type':_0x1382d9,'storage':_0x4175e9,'rak':_0x3c64aa};}function a0_0x27cc(){var _0x492791=['prod_code','Arabic','$category','then','sendMail','prod_secondunit','pallet','RMSEmail','$note','rack','$product.type','$maxProdPerUnit','standard_unit','product','all_purchases','primary_code','<span\x20style=\x22float:\x20right;\x22>','</head><body>','abs','findOne','$return_data','flash','Enclosed','catch','actual_uom','product_details','delivery_code','find','$product_details.product_stock','/view/:id','product_cat','$product.quantity','product_code','<div>','prod_pallet','$room','396MstdVQ','Enabled','</td>','random','Portuguese','\x20<\x20wew\x20>\x20','floorlevel','date','<strong>\x20Regards\x20</strong>','Floor','MaxStocks_data','23571730ElGhrY','return_qty','English\x20(US)','</tr>','isle','stock_quantity','exports','$product_details.floorlevel','DRY\x20STORAGE','$product_details._id','suppliers_docs','table\x20page','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Rack\x20E','map','Purchase\x20Return','$secondary_unit','Purchase\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$expiry_date','10053tYuJbr','prod_cat','prod_isle','quantity','gmail','here','Hindi','<hr\x20class=\x22my-3\x22>','<!DOCTYPE\x20html>','secondary_unit','\x20</h2>','<h5>','path','prod_qty','<h5\x20style=\x22text-align:\x20left;\x22>','password','/../public','Purchase\x20data\x20added\x20successfully','Receiving\x20Area','French','Logo.png','/barcode/:id','$product_details.product_code','$product.room_name','site_title','createTransport','purchases\x20item\x20return\x20successfull','string','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','suppliers_data','error','Sales\x20Update\x20successfully','$name','getDate','room_name','warehouse_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/invoice/:id','stocks','<tr>','paid_amount','$product_details.bin','$product_details','Rack\x20A','prod_name','True','Level','$primary_code','$product_details.storage','params','1257ZyPgjZ','batch_code','Shelves','concat','prod_unit','prod_invoice','<h2>\x20','$finalize','purchase_quantity','$invoice','maxStocks','$suppliers','email','../middleware/auth','redirect','foreach\x20newproduct','</h5>','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.bay','$product_details.product_name','bin','host','product_code_hide','RoomAssign','forEach','storage','finalize','$paid_amount','../models/all_models','room','Arabic\x20(ae)','$batch_code','Rack\x20B','\x20Order\x20Date\x20:\x20','message','</span>','actual_qty','edit_purchases_view','$product_details.pallet','logo','Portuguese\x20(BR)','1683797lqwMCd','slice','getMonth','type','currency_placement','Return\x20Goods','\x20<>\x20','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','purchase_invoice','$secondary_code','invoice','Rack\x20C','all_purchases_barcode','render','master','<html><head><title></title>','/all_purchases/view','filter','Raw\x20Materials','product_stock','$product.floorlevel','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','name','level','$maxStocks','alertQTY','$product_details.bay','back','delivery_date','return_data','log','push','note','</body></html>','payment\x20successfull','staff','</table>','Room_name','nodemailer','Rack\x20F','add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view','$product_details.rack','11184600usKwVN','$warehouse_name','German','due_amount','warehouse','image','10224CGtgRM','$brand','6AUOakk','getFullYear','/view/add_purchases/:id','$unit','prod_level','padStart','json','$product_details.maxProducts','ejs','\x20Order\x20Number\x20:\x20','toString','prod_Qty','get','role','/upload/','/preview/:id','deliverycode','An\x20error\x20occurred.','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','expiry_date','length','COLD\x20STORAGE','Spanish','Router','$product_details.primary_code','INC-','$suppliers_docs','currency','</div>','An\x20error\x20occurred\x20while\x20saving\x20data.','$date','$product_code','$product.bin','Chinese','../public/language/languages.json','$_id','$alertquantity','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','errors','Error\x20Occurs','POnumber','user','product_name','$product_details.level','Purchase\x20Return\x20Mail','max_product_unit','$product','bay','language','suppliers','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','378554epiuBX','</thead>','add_purchases\x20error','types','Email\x20sent\x20successfully','post','production_date','/view/return_purchase/:id','2689045EqXDeU','aggregate','Ambient','maxperunit','/view/add_purchases','secondary_code_hide','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','purchase\x20data\x20update\x20successfully','body','findById','save','success','<table\x20style=\x22width:\x20100%\x20!important;\x22>'];a0_0x27cc=function(){return _0x492791;};return a0_0x27cc();}async function getRandom8DigitNumber(){var _0x48ac9b=a0_0x52c0f7;const _0xf97715=0x989680,_0x19413e=0x5f5e0ff,_0x227527=Math['floor'](Math[_0x48ac9b(0x21b)]()*(_0x19413e-_0xf97715+0x1))+_0xf97715;var _0x13c0b4;const _0xfbb53a=await purchases[_0x48ac9b(0x207)]({'invoice':_0x48ac9b(0x1c4)+_0x227527});return _0xfbb53a&&_0xfbb53a['length']>0x0?_0x13c0b4='INC-'+_0x227527:_0x13c0b4=_0x48ac9b(0x1c4)+_0x227527,_0x13c0b4;}router['get'](a0_0x52c0f7(0x1ea),auth,async(_0x5dfa7d,_0x120620)=>{var _0x2dfd86=a0_0x52c0f7;try{const {username:_0x19a9da,email:_0x267f84,role:_0x51be3f}=_0x5dfa7d[_0x2dfd86(0x1d4)],_0x7bd87d=_0x5dfa7d[_0x2dfd86(0x1d4)],_0x2d4a8a=await profile[_0x2dfd86(0x207)]({'email':_0x7bd87d[_0x2dfd86(0x158)]}),_0x3e22c0=await master_shop[_0x2dfd86(0x20f)](),_0x582a40=await staff[_0x2dfd86(0x207)]({'email':_0x7bd87d[_0x2dfd86(0x158)]}),_0x3d15e6=await suppliers[_0x2dfd86(0x20f)]({});let _0x52f943;if(_0x7bd87d[_0x2dfd86(0x1b8)]==_0x2dfd86(0x19a)){const _0x355090=await staff[_0x2dfd86(0x207)]({'email':_0x7bd87d[_0x2dfd86(0x158)]});_0x52f943=await warehouse['aggregate']([{'$match':{'status':_0x2dfd86(0x219),'name':_0x355090[_0x2dfd86(0x1a7)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2dfd86(0x258),'name':{'$first':'$name'}}}]);}else _0x52f943=await warehouse[_0x2dfd86(0x1e7)]([{'$match':{'status':_0x2dfd86(0x219),'warehouse_category':_0x2dfd86(0x189),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2dfd86(0x258),'name':{'$first':_0x2dfd86(0x258)}}}]);const _0x3ea23b=await product[_0x2dfd86(0x20f)]({}),_0x16d4ee=await warehouse['find']({'status':_0x2dfd86(0x219)}),_0x3a25a8=await purchases[_0x2dfd86(0x20f)]({}),_0x1c48b6=_0x3a25a8[_0x2dfd86(0x1bf)]+0x1,_0x310b24=_0x2dfd86(0x1c4)+_0x1c48b6[_0x2dfd86(0x1b5)]()[_0x2dfd86(0x1b0)](0x5,'0');var _0x42c2e4=[_0x2dfd86(0x1e8),_0x2dfd86(0x20a)];if(_0x3e22c0[0x0]['language']==_0x2dfd86(0x225))var _0x4eee25=users[_0x2dfd86(0x253)];else{if(_0x3e22c0[0x0][_0x2dfd86(0x1db)]=='Hindi')var _0x4eee25=users['Hindi'];else{if(_0x3e22c0[0x0]['language']==_0x2dfd86(0x1a5))var _0x4eee25=users['German'];else{if(_0x3e22c0[0x0][_0x2dfd86(0x1db)]==_0x2dfd86(0x1c1))var _0x4eee25=users[_0x2dfd86(0x1c1)];else{if(_0x3e22c0[0x0][_0x2dfd86(0x1db)]==_0x2dfd86(0x24a))var _0x4eee25=users[_0x2dfd86(0x24a)];else{if(_0x3e22c0[0x0][_0x2dfd86(0x1db)]==_0x2dfd86(0x175))var _0x4eee25=users[_0x2dfd86(0x21c)];else{if(_0x3e22c0[0x0][_0x2dfd86(0x1db)]==_0x2dfd86(0x1cc))var _0x4eee25=users[_0x2dfd86(0x1cc)];else{if(_0x3e22c0[0x0][_0x2dfd86(0x1db)]==_0x2dfd86(0x16b))var _0x4eee25=users[_0x2dfd86(0x1f5)];}}}}}}}const _0x34be27=getRandom8DigitNumber();_0x34be27[_0x2dfd86(0x1f7)](_0x16f097=>{var _0x1f9a18=_0x2dfd86;_0x120620['render'](_0x1f9a18(0x19f),{'success':_0x5dfa7d['flash'](_0x1f9a18(0x1f2)),'errors':_0x5dfa7d[_0x1f9a18(0x209)](_0x1f9a18(0x1d1)),'role':_0x7bd87d,'profile':_0x2d4a8a,'suppliers':_0x3d15e6,'warehouse':_0x52f943,'product':_0x3ea23b,'invoice':_0x16f097,'master_shop':_0x3e22c0,'language':_0x4eee25,'find_data':_0x16d4ee,'rooms_data':_0x42c2e4});})['catch'](_0x5a65f7=>{var _0x1844ca=_0x2dfd86;_0x5dfa7d[_0x1844ca(0x209)](_0x1844ca(0x1d1),_0x1844ca(0x25c)),_0x120620[_0x1844ca(0x15a)]('/all_purchases/view');});}catch(_0x106ac0){console['log'](_0x106ac0);}}),router[a0_0x52c0f7(0x1b7)](a0_0x52c0f7(0x1ad),auth,async(_0x12c48b,_0x43b1f6)=>{var _0x2dcd95=a0_0x52c0f7;try{const _0x282285=_0x12c48b[_0x2dcd95(0x269)]['id'];console[_0x2dcd95(0x195)](_0x282285);const _0xc82cb0=await master_shop[_0x2dcd95(0x20f)]();console['log']('master',_0xc82cb0);const _0x40ab25=await product[_0x2dcd95(0x207)]({'name':_0x282285});console['log']('product',_0x40ab25),_0x43b1f6['status'](0xc8)['json']({'product_data':_0x40ab25,'master':_0xc82cb0});}catch(_0x128998){console['log'](_0x2dcd95(0x1e0),_0x128998);}}),router['post'](a0_0x52c0f7(0x1ea),auth,async(_0x468c51,_0x133575)=>{var _0x293694=a0_0x52c0f7;try{const {invoice:_0x26342d,date:_0x5e8c9e,warehouse_name:_0x4d1478,prod_name:_0x596033,prod_code:_0x132705,prod_qty:_0x462ad6,prod_unit:_0x25f42e,prod_secondunit:_0x546701,prod_level:_0x308c55,prod_isle:_0x2e8ca3,prod_pallet:_0x2d8d6b,note:_0x75f6e4,expiry_date:_0x58eb03,batch_code:_0x37d58f,payable:_0x44447e,due_amount:_0x3fb698,Room_name:_0x189470,primary_code:_0x492cee,secondary_code:_0x28c932,MaxStocks_data:_0x475bd7,PO_number:_0x6dda53,SCRN:_0x10c0c5,JO_number:_0x294488}=_0x468c51[_0x293694(0x1ef)];if(typeof _0x596033==_0x293694(0x252))var _0x1e6103=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x264)]],_0x1dcc30=[_0x468c51['body'][_0x293694(0x1f4)]],_0xec2884=[_0x468c51['body']['prod_Qty']],_0x231673=[_0x468c51[_0x293694(0x1ef)]['prod_primunit']],_0x5eb59c=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x1f9)]],_0xf9c403=[_0x468c51[_0x293694(0x1ef)]['prod_level']],_0x39e7df=[_0x468c51['body'][_0x293694(0x203)]],_0x1c707c=[_0x468c51[_0x293694(0x1ef)]['secondary_code']],_0x212ac1=[_0x468c51['body'][_0x293694(0x222)]],_0x260824=[_0x468c51['body']['batch_code']],_0x15baff=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x1be)]],_0x3b0ff5=[_0x468c51[_0x293694(0x1ef)]['max_product_unit']],_0x1afc6b=[_0x468c51['body'][_0x293694(0x190)]],_0x79e81d=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x1e4)]],_0x1b96e3=[_0x468c51['body'][_0x293694(0x238)]],_0x4b9f73=[_0x468c51['body']['RoomAssign']],_0x2a5168=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x1bb)]],_0x8c38e4=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x26f)]],_0x4d11e4=[_0x468c51[_0x293694(0x1ef)][_0x293694(0x171)]],_0xa6d3d8=[_0x468c51[_0x293694(0x1ef)]['actual_uom']];else var _0x1e6103=[..._0x468c51['body']['prod_name']],_0x1dcc30=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1f4)]],_0xec2884=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1b6)]],_0x231673=[..._0x468c51['body']['prod_primunit']],_0x5eb59c=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1f9)]],_0xf9c403=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1af)]],_0x39e7df=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x203)]],_0x1c707c=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1ec)]],_0x212ac1=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x222)]],_0x260824=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x26b)]],_0x15baff=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1be)]],_0x3b0ff5=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1d8)]],_0x1afc6b=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x190)]],_0x79e81d=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1e4)]],_0x1b96e3=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x238)]],_0x4b9f73=[..._0x468c51['body'][_0x293694(0x164)]],_0x2a5168=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x1bb)]],_0x8c38e4=[..._0x468c51[_0x293694(0x1ef)][_0x293694(0x26f)]],_0x4d11e4=[..._0x468c51[_0x293694(0x1ef)]['actual_qty']],_0xa6d3d8=[..._0x468c51['body'][_0x293694(0x20c)]];const _0x58771f=_0x1e6103[_0x293694(0x231)](_0x1bc591=>{return _0x1bc591={'product_name':_0x1bc591};});_0x4d11e4[_0x293694(0x165)]((_0x3d0fef,_0x51728c)=>{var _0x2b1cb1=_0x293694;_0x58771f[_0x51728c][_0x2b1cb1(0x171)]=Math[_0x2b1cb1(0x206)](_0x3d0fef);}),_0xa6d3d8[_0x293694(0x165)]((_0x13a3eb,_0x22541a)=>{var _0x4a243f=_0x293694;_0x58771f[_0x22541a][_0x4a243f(0x20c)]=_0x13a3eb;}),_0x1dcc30[_0x293694(0x165)]((_0x29f1cd,_0x741203)=>{var _0xd79519=_0x293694;_0x58771f[_0x741203][_0xd79519(0x214)]=_0x29f1cd;}),_0xec2884[_0x293694(0x165)]((_0x454c38,_0x3eb12d)=>{var _0x5bc0d5=_0x293694;_0x58771f[_0x3eb12d][_0x5bc0d5(0x23a)]=Math['abs'](_0x454c38);}),_0x231673['forEach']((_0xd0757b,_0x562264)=>{var _0x10c975=_0x293694;_0x58771f[_0x562264][_0x10c975(0x200)]=_0xd0757b;}),_0x5eb59c[_0x293694(0x165)]((_0x5c699b,_0x4c0c86)=>{_0x58771f[_0x4c0c86]['secondary_unit']=_0x5c699b;}),_0xf9c403[_0x293694(0x165)]((_0x232a7a,_0x5e0cc8)=>{var _0xc4a7b7=_0x293694;_0x4b9f73[_0xc4a7b7(0x165)]((_0x53025e,_0x507bc4)=>{var _0x21567e=_0xc4a7b7;if(_0x53025e==_0x21567e(0x249)&&_0x5e0cc8==_0x507bc4){console[_0x21567e(0x195)](_0x53025e+_0x21567e(0x21d)+_0x5e0cc8+_0x21567e(0x17c)+_0x507bc4+_0x21567e(0x17c)+_0x232a7a);var _0x3a366=_0x232a7a[_0x21567e(0x177)](0x3);_0x58771f[_0x5e0cc8][_0x21567e(0x166)]=_0x232a7a[0x0],_0x58771f[_0x5e0cc8]['rack']=_0x232a7a[0x1],_0x58771f[_0x5e0cc8]['bay']=0x0,_0x58771f[_0x5e0cc8][_0x21567e(0x161)]=0x0,_0x58771f[_0x5e0cc8]['type']=_0x21567e(0x221),_0x58771f[_0x5e0cc8]['floorlevel']=_0x3a366;}else{if(_0x53025e==_0x21567e(0x26c)&&_0x5e0cc8==_0x507bc4){var _0x3a366=_0x232a7a[_0x21567e(0x177)](0x3);_0x58771f[_0x5e0cc8][_0x21567e(0x166)]=_0x232a7a[0x0],_0x58771f[_0x5e0cc8][_0x21567e(0x1fd)]=_0x232a7a[0x1],_0x58771f[_0x5e0cc8][_0x21567e(0x1da)]=0x0,_0x58771f[_0x5e0cc8][_0x21567e(0x161)]=0x0,_0x58771f[_0x5e0cc8]['type']=_0x21567e(0x221),_0x58771f[_0x5e0cc8][_0x21567e(0x21e)]=_0x232a7a[0x5];}else{if(_0x5e0cc8==_0x507bc4){if(_0x232a7a[0x0]=='A'&&_0x232a7a[0x1]=='L'&&_0x232a7a[0x2]=='L')console[_0x21567e(0x195)](_0x53025e+_0x21567e(0x17c)+_0x5e0cc8+'\x20<>\x20'+_0x507bc4+_0x21567e(0x17c)+_0x232a7a+_0x21567e(0x23c)),_0x58771f[_0x5e0cc8][_0x21567e(0x166)]=_0x232a7a[0x0],_0x58771f[_0x5e0cc8][_0x21567e(0x1fd)]=_0x232a7a[0x1],_0x58771f[_0x5e0cc8][_0x21567e(0x1da)]=0x0,_0x58771f[_0x5e0cc8][_0x21567e(0x161)]=0x0,_0x58771f[_0x5e0cc8]['type']=_0x21567e(0x221),_0x58771f[_0x5e0cc8][_0x21567e(0x21e)]=_0x232a7a[0x3];else{var _0x4499e7;if(_0x232a7a[0x4]=='L')_0x4499e7=_0x21567e(0x266);else _0x232a7a[0x4]=='F'&&(_0x4499e7=_0x21567e(0x221));_0x58771f[_0x5e0cc8][_0x21567e(0x166)]=_0x232a7a[0x0],_0x58771f[_0x5e0cc8][_0x21567e(0x1fd)]=_0x232a7a[0x1],_0x58771f[_0x5e0cc8]['bay']=_0x232a7a[0x2],_0x58771f[_0x5e0cc8][_0x21567e(0x161)]=_0x232a7a[0x3],_0x58771f[_0x5e0cc8]['type']=_0x4499e7,_0x58771f[_0x5e0cc8][_0x21567e(0x21e)]=_0x232a7a[0x5];}}}}});}),_0x39e7df[_0x293694(0x165)]((_0x1b4f45,_0x28e1e2)=>{var _0xd83cf1=_0x293694;_0x58771f[_0x28e1e2][_0xd83cf1(0x203)]=_0x1b4f45;}),_0x1c707c[_0x293694(0x165)]((_0xfb68c0,_0x389af0)=>{var _0x46f8eb=_0x293694;_0x58771f[_0x389af0][_0x46f8eb(0x1ec)]=_0xfb68c0;}),_0x212ac1['forEach']((_0x2b822f,_0x1831fb)=>{var _0x389c34=_0x293694;_0x58771f[_0x1831fb][_0x389c34(0x156)]=_0x2b822f;}),_0x260824['forEach']((_0x44f9de,_0x23def4)=>{_0x58771f[_0x23def4]['batch_code']=_0x44f9de;}),_0x15baff[_0x293694(0x165)]((_0x3a2d99,_0x47bfd8)=>{var _0x1fd8cf=_0x293694;_0x58771f[_0x47bfd8][_0x1fd8cf(0x1be)]=_0x3a2d99;}),_0x3b0ff5[_0x293694(0x165)]((_0x55358f,_0x2dfe86)=>{_0x58771f[_0x2dfe86]['maxperunit']=_0x55358f;}),_0x1afc6b[_0x293694(0x165)]((_0x5a69aa,_0x32e51a)=>{var _0xc0ccb=_0x293694;_0x58771f[_0x32e51a][_0xc0ccb(0x190)]=_0x5a69aa;}),_0x79e81d[_0x293694(0x165)]((_0x5d3cc6,_0x7b46d0)=>{_0x58771f[_0x7b46d0]['production_date']=_0x5d3cc6;}),_0x1b96e3[_0x293694(0x165)]((_0xe7ae8b,_0x46d8b4)=>{var _0x3c229f=_0x293694;_0x58771f[_0x46d8b4][_0x3c229f(0x212)]=_0xe7ae8b;}),_0x4b9f73[_0x293694(0x165)]((_0x51e02c,_0x2f46fe)=>{var _0x24e474=_0x293694;_0x58771f[_0x2f46fe][_0x24e474(0x25a)]=_0x51e02c;}),_0x2a5168[_0x293694(0x165)]((_0x2fcb6f,_0x37f60)=>{var _0x14ef92=_0x293694;_0x58771f[_0x37f60][_0x14ef92(0x20e)]=_0x2fcb6f;}),_0x8c38e4[_0x293694(0x165)]((_0x18ebfa,_0x39706c)=>{var _0x15d3a3=_0x293694;_0x58771f[_0x39706c][_0x15d3a3(0x181)]=_0x18ebfa;});const _0x313864=_0x4b9f73['map'](_0x5694f1=>{return _0x5694f1={'room_name':_0x5694f1};}),_0x3c0220=_0x58771f['filter'](_0x5ec8f1=>_0x5ec8f1[_0x293694(0x23a)]!=='0'&&_0x5ec8f1[_0x293694(0x23a)]!==''),_0x334b68=new purchases({'invoice':_0x26342d,'suppliers':_0x468c51[_0x293694(0x1ef)][_0x293694(0x1dc)],'date':_0x5e8c9e,'warehouse_name':_0x4d1478,'product':_0x3c0220,'note':_0x75f6e4,'due_amount':_0x3fb698,'POnumber':_0x6dda53,'SCRN':_0x10c0c5,'JO_number':_0x294488,'roomList':_0x313864}),_0x142dae=await _0x334b68[_0x293694(0x1f1)](),_0x227def=await purchases['findOne']({'invoice':_0x26342d}),_0x5bd201=_0x227def[_0x293694(0x201)][_0x293694(0x231)](async _0x2f5ecd=>{var _0x465ae2=_0x293694,_0xffd739=await warehouse[_0x465ae2(0x207)]({'name':_0x4d1478,'room':_0x2f5ecd[_0x465ae2(0x25a)]}),_0x368d8d=0x0;return _0xffd739[_0x465ae2(0x20d)][_0x465ae2(0x165)](_0x4fe293=>{var _0x4d3fd0=_0x465ae2;_0x4fe293[_0x4d3fd0(0x1d5)]==_0x2f5ecd[_0x4d3fd0(0x1d5)]&&_0x4fe293[_0x4d3fd0(0x21e)]==_0x2f5ecd[_0x4d3fd0(0x21e)]&&_0x4fe293[_0x4d3fd0(0x179)]==_0x2f5ecd['type']&&_0x4fe293['bin']==_0x2f5ecd[_0x4d3fd0(0x161)]&&_0x4fe293[_0x4d3fd0(0x1da)]==_0x2f5ecd[_0x4d3fd0(0x1da)]&&_0x4fe293[_0x4d3fd0(0x1fd)]==_0x2f5ecd[_0x4d3fd0(0x1fd)]&&_0x4fe293['storage']==_0x2f5ecd[_0x4d3fd0(0x166)]&&_0x4fe293[_0x4d3fd0(0x1be)]==_0x2f5ecd[_0x4d3fd0(0x1be)]&&_0x4fe293[_0x4d3fd0(0x26b)]==_0x2f5ecd[_0x4d3fd0(0x26b)]&&_0x4fe293['production_date']==_0x2f5ecd[_0x4d3fd0(0x1e4)]&&_0x4fe293[_0x4d3fd0(0x181)]==_0x227def['invoice']&&(_0x4fe293[_0x4d3fd0(0x18a)]+=Math[_0x4d3fd0(0x206)](_0x2f5ecd[_0x4d3fd0(0x23a)]),_0x368d8d++);}),_0x368d8d===0x0&&_0xffd739[_0x465ae2(0x20d)][_0x465ae2(0x196)]({'product_name':_0x2f5ecd['product_name'],'product_stock':Math[_0x465ae2(0x206)](_0x2f5ecd[_0x465ae2(0x23a)]),'primary_code':_0x2f5ecd[_0x465ae2(0x203)],'secondary_code':_0x2f5ecd[_0x465ae2(0x1ec)],'product_code':_0x2f5ecd[_0x465ae2(0x214)],'storage':_0x2f5ecd[_0x465ae2(0x166)],'rack':_0x2f5ecd['rack'],'bay':_0x2f5ecd[_0x465ae2(0x1da)],'bin':_0x2f5ecd[_0x465ae2(0x161)],'type':_0x2f5ecd['type'],'floorlevel':_0x2f5ecd[_0x465ae2(0x21e)],'maxProducts':_0x2f5ecd[_0x465ae2(0x156)],'unit':_0x2f5ecd[_0x465ae2(0x200)],'secondary_unit':_0x2f5ecd[_0x465ae2(0x240)],'expiry_date':_0x2f5ecd[_0x465ae2(0x1be)],'maxPerUnit':_0x2f5ecd[_0x465ae2(0x1e9)],'batch_code':_0x2f5ecd[_0x465ae2(0x26b)],'alertQTY':_0x2f5ecd[_0x465ae2(0x190)],'production_date':_0x2f5ecd['production_date'],'product_cat':_0x2f5ecd[_0x465ae2(0x212)],'invoice':_0x2f5ecd['invoice'],'actual_qty':Math[_0x465ae2(0x206)](_0x2f5ecd[_0x465ae2(0x171)]),'actual_uom':_0x2f5ecd[_0x465ae2(0x20c)]}),_0xffd739;});Promise['all'](_0x5bd201)[_0x293694(0x1f7)](async _0x252780=>{var _0x281c09=_0x293694;try{for(const _0xcd5d52 of _0x252780){await _0xcd5d52[_0x281c09(0x1f1)]();}const _0x5bff8a=await master_shop[_0x281c09(0x20f)](),_0x1ccd93=await email_settings['findOne'](),_0x367711=await supervisor_settings[_0x281c09(0x20f)]();var _0x13bc6f=_0x227def[_0x281c09(0x201)],_0x53e6b4='',_0x5ba19f;for(_0x5ba19f in _0x13bc6f){_0x53e6b4+=_0x281c09(0x25f)+_0x281c09(0x1bd)+_0x13bc6f[_0x5ba19f][_0x281c09(0x1d5)]+_0x281c09(0x21a)+_0x281c09(0x1bd)+_0x13bc6f[_0x5ba19f][_0x281c09(0x214)]+_0x281c09(0x21a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x13bc6f[_0x5ba19f][_0x281c09(0x23a)]+_0x281c09(0x21a)+_0x281c09(0x1bd)+_0x13bc6f[_0x5ba19f][_0x281c09(0x200)]+'</td>'+_0x281c09(0x1bd)+_0x13bc6f[_0x5ba19f][_0x281c09(0x240)]+_0x281c09(0x21a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x227def[_0x281c09(0x25b)]+'</td>'+_0x281c09(0x1bd)+_0x13bc6f[_0x5ba19f][_0x281c09(0x25a)]+_0x281c09(0x21a)+_0x281c09(0x1bd)+_0x13bc6f[_0x5ba19f][_0x281c09(0x166)]+_0x13bc6f[_0x5ba19f][_0x281c09(0x1fd)]+_0x13bc6f[_0x5ba19f]['bay']+_0x13bc6f[_0x5ba19f][_0x281c09(0x161)]+_0x13bc6f[_0x5ba19f]['type'][0x0]+_0x13bc6f[_0x5ba19f]['floorlevel']+'</td>','</tr>';}let _0x2d23e3=nodemailer[_0x281c09(0x250)]({'host':_0x1ccd93[_0x281c09(0x162)],'port':Number(_0x1ccd93['port']),'secure':![],'auth':{'user':_0x1ccd93['email'],'pass':_0x1ccd93[_0x281c09(0x246)]}}),_0x4d9dac={'from':_0x1ccd93[_0x281c09(0x158)],'to':_0x367711[0x0][_0x281c09(0x1fb)],'subject':_0x281c09(0x234),'attachments':[{'filename':_0x281c09(0x24b),'path':__dirname+_0x281c09(0x247)+'/upload/'+_0x5bff8a[0x0][_0x281c09(0x1a8)],'cid':_0x281c09(0x174)}],'html':_0x281c09(0x23f)+_0x281c09(0x186)+_0x281c09(0x205)+_0x281c09(0x215)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x281c09(0x1d0)+'</div>'+_0x281c09(0x215)+_0x281c09(0x270)+_0x5bff8a[0x0][_0x281c09(0x24f)]+_0x281c09(0x241)+_0x281c09(0x1c7)+'</div>'+_0x281c09(0x23e)+_0x281c09(0x215)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x227def[_0x281c09(0x181)]+'\x20'+_0x281c09(0x204)+_0x281c09(0x16e)+_0x227def[_0x281c09(0x21f)]+'\x20'+_0x281c09(0x170)+_0x281c09(0x15c)+_0x281c09(0x1c7)+_0x281c09(0x1f3)+_0x281c09(0x18c)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x281c09(0x22f)+_0x281c09(0x17e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x281c09(0x235)+_0x281c09(0x254)+_0x281c09(0x226)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x53e6b4+'\x20'+'</tbody>'+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x281c09(0x242)+_0x5bff8a[0x0][_0x281c09(0x24f)]+_0x281c09(0x15c)+_0x281c09(0x1c7)+_0x281c09(0x1c7)+_0x281c09(0x198)};_0x2d23e3[_0x281c09(0x1f8)](_0x4d9dac,function(_0x45f78b,_0x4554ff){var _0x36f304=_0x281c09;_0x45f78b?(console[_0x36f304(0x195)](_0x45f78b),console['log'](_0x36f304(0x1d2))):console[_0x36f304(0x195)]('Email\x20sent\x20successfully');}),_0x468c51[_0x281c09(0x209)](_0x281c09(0x1f2),_0x281c09(0x248)),_0x133575[_0x281c09(0x15a)]('/all_purchases/view/');}catch(_0x14ca28){console[_0x281c09(0x256)](_0x14ca28),_0x133575[_0x281c09(0x15d)](0x1f4)[_0x281c09(0x1b1)]({'error':_0x281c09(0x1c8)});}})[_0x293694(0x20b)](_0xa598f7=>{var _0x1b8bed=_0x293694;console[_0x1b8bed(0x256)](_0xa598f7),_0x133575[_0x1b8bed(0x15d)](0x1f4)[_0x1b8bed(0x1b1)]({'error':_0x1b8bed(0x1bc)});});}catch(_0x19b6eb){console[_0x293694(0x195)](_0x19b6eb);}}),router[a0_0x52c0f7(0x1b7)]('/preview/:id',auth,async(_0xa324aa,_0x1e93a0)=>{var _0x33d2d5=a0_0x52c0f7;try{const {username:_0x2fd405,email:_0xe93b0,role:_0x252954}=_0xa324aa[_0x33d2d5(0x1d4)],_0x58b942=_0xa324aa[_0x33d2d5(0x1d4)],_0x437db0=await profile[_0x33d2d5(0x207)]({'email':_0x58b942[_0x33d2d5(0x158)]}),_0x4ce069=await master_shop[_0x33d2d5(0x20f)](),_0x472fbc=_0xa324aa[_0x33d2d5(0x269)]['id'],_0x5ccaa2=await purchases['findById'](_0x472fbc),_0x3b29d0=await warehouse[_0x33d2d5(0x1e7)]([{'$match':{'name':_0x5ccaa2[_0x33d2d5(0x25b)],'room':_0x5ccaa2[_0x33d2d5(0x16a)]}},{'$unwind':_0x33d2d5(0x262)},{'$group':{'_id':_0x33d2d5(0x22c),'name':{'$first':_0x33d2d5(0x160)},'product_stock':{'$first':_0x33d2d5(0x210)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x33d2d5(0x261)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x33d2d5(0x22a)},'primary_code':{'$first':_0x33d2d5(0x1c3)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x33d2d5(0x24d)},'storage':{'$first':_0x33d2d5(0x268)},'rack':{'$first':_0x33d2d5(0x1a2)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x575945=await customer[_0x33d2d5(0x20f)]({});let _0x231c53;if(_0x58b942[_0x33d2d5(0x1b8)]==_0x33d2d5(0x19a)){const _0x206a05=await staff[_0x33d2d5(0x207)]({'email':_0x58b942[_0x33d2d5(0x158)]});_0x231c53=await warehouse['aggregate']([{'$match':{'status':_0x33d2d5(0x219),'name':_0x206a05['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x33d2d5(0x258)}}}]);}else _0x231c53=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x33d2d5(0x258),'name':{'$first':_0x33d2d5(0x258)}}}]);const _0x4e3440=await product[_0x33d2d5(0x20f)]({}),_0x41498e=await suppliers[_0x33d2d5(0x20f)]({}),_0x22f5bf=BayBinSelected(_0x5ccaa2[_0x33d2d5(0x25b)],_0x5ccaa2[_0x33d2d5(0x16a)]);if(_0x4ce069[0x0][_0x33d2d5(0x1db)]==_0x33d2d5(0x225)){var _0x31d2e4=users[_0x33d2d5(0x253)];console[_0x33d2d5(0x195)](_0x31d2e4);}else{if(_0x4ce069[0x0][_0x33d2d5(0x1db)]==_0x33d2d5(0x23d))var _0x31d2e4=users[_0x33d2d5(0x23d)];else{if(_0x4ce069[0x0][_0x33d2d5(0x1db)]==_0x33d2d5(0x1a5))var _0x31d2e4=users[_0x33d2d5(0x1a5)];else{if(_0x4ce069[0x0]['language']==_0x33d2d5(0x1c1))var _0x31d2e4=users['Spanish'];else{if(_0x4ce069[0x0][_0x33d2d5(0x1db)]==_0x33d2d5(0x24a))var _0x31d2e4=users[_0x33d2d5(0x24a)];else{if(_0x4ce069[0x0]['language']==_0x33d2d5(0x175))var _0x31d2e4=users[_0x33d2d5(0x21c)];else{if(_0x4ce069[0x0][_0x33d2d5(0x1db)]=='Chinese')var _0x31d2e4=users[_0x33d2d5(0x1cc)];else{if(_0x4ce069[0x0][_0x33d2d5(0x1db)]=='Arabic\x20(ae)')var _0x31d2e4=users[_0x33d2d5(0x1f5)];}}}}}}}_0x1e93a0['render'](_0x33d2d5(0x172),{'success':_0xa324aa[_0x33d2d5(0x209)](_0x33d2d5(0x1f2)),'errors':_0xa324aa[_0x33d2d5(0x209)]('errors'),'role':_0x58b942,'profile':_0x437db0,'customer':_0x575945,'warehouse':_0x231c53,'product':_0x3b29d0,'user':_0x5ccaa2,'master_shop':_0x4ce069,'unit':_0x4e3440,'language':_0x31d2e4,'suppliers':_0x41498e,'dataSelected':_0x22f5bf});}catch(_0x14a4db){console['log'](_0x14a4db);}}),router[a0_0x52c0f7(0x1e3)](a0_0x52c0f7(0x1ba),auth,async(_0xf85788,_0x2cb397)=>{var _0x36897e=a0_0x52c0f7;try{const _0x396eea=_0xf85788[_0x36897e(0x269)]['id'],{invoice:_0x5a210f,warehouse_name:_0x156606,Room_name:_0x29dcf0}=_0xf85788[_0x36897e(0x1ef)],_0x225cbb=await warehouse['findOne']({'name':_0x156606,'room':_0x29dcf0}),_0x336e21=await purchases[_0x36897e(0x207)]({'invoice':_0x5a210f});_0x336e21[_0x36897e(0x201)][_0x36897e(0x165)](_0xed803f=>{var _0x2e1f5d=_0x36897e,_0x9f3984=0x0;const _0x3d41be=_0x225cbb[_0x2e1f5d(0x20d)][_0x2e1f5d(0x231)](_0x57285f=>{var _0x37ea24=_0x2e1f5d;_0x57285f[_0x37ea24(0x1d5)]==_0xed803f['product_name']&&_0x57285f[_0x37ea24(0x21e)]==_0xed803f[_0x37ea24(0x21e)]&&_0x57285f[_0x37ea24(0x179)]==_0xed803f['type']&&_0x57285f[_0x37ea24(0x161)]==_0xed803f[_0x37ea24(0x161)]&&_0x57285f['bay']==_0xed803f[_0x37ea24(0x1da)]&&_0x57285f['rack']==_0xed803f[_0x37ea24(0x1fd)]&&_0x57285f[_0x37ea24(0x166)]==_0xed803f[_0x37ea24(0x166)]&&_0x57285f['expiry_date']==_0xed803f[_0x37ea24(0x1be)]&&_0x57285f[_0x37ea24(0x26b)]==_0xed803f[_0x37ea24(0x26b)]&&_0x57285f[_0x37ea24(0x1e4)]==_0xed803f[_0x37ea24(0x1e4)]&&_0x57285f[_0x37ea24(0x193)]==_0xed803f[_0x37ea24(0x193)]&&_0x57285f['delivery_code']==_0xed803f[_0x37ea24(0x20e)]&&(_0x57285f['product_stock']=parseInt(_0x57285f[_0x37ea24(0x18a)])+parseInt(_0xed803f[_0x37ea24(0x23a)]),_0x9f3984++);});_0x9f3984=='0'&&(_0x225cbb[_0x2e1f5d(0x20d)]=_0x225cbb[_0x2e1f5d(0x20d)][_0x2e1f5d(0x26d)]({'product_name':_0xed803f[_0x2e1f5d(0x1d5)],'product_stock':_0xed803f[_0x2e1f5d(0x23a)],'primary_code':_0xed803f[_0x2e1f5d(0x203)],'secondary_code':_0xed803f[_0x2e1f5d(0x1ec)],'product_code':_0xed803f[_0x2e1f5d(0x214)],'storage':_0xed803f[_0x2e1f5d(0x166)],'rack':_0xed803f[_0x2e1f5d(0x1fd)],'bay':_0xed803f[_0x2e1f5d(0x1da)],'bin':_0xed803f[_0x2e1f5d(0x161)],'type':_0xed803f[_0x2e1f5d(0x179)],'floorlevel':_0xed803f['floorlevel'],'maxProducts':_0xed803f['maxStocks'],'unit':_0xed803f['standard_unit'],'secondary_unit':_0xed803f[_0x2e1f5d(0x240)],'expiry_date':_0xed803f[_0x2e1f5d(0x1be)],'maxPerUnit':_0xed803f[_0x2e1f5d(0x1e9)],'batch_code':_0xed803f[_0x2e1f5d(0x26b)],'alertQTY':_0xed803f[_0x2e1f5d(0x190)],'production_date':_0xed803f[_0x2e1f5d(0x1e4)],'delivery_date':_0xed803f[_0x2e1f5d(0x193)],'delivery_code':_0xed803f[_0x2e1f5d(0x20e)]}));}),await _0x225cbb[_0x36897e(0x1f1)](),_0x336e21[_0x36897e(0x167)]='True';const _0x4d7453=await _0x336e21[_0x36897e(0x1f1)]();_0xf85788[_0x36897e(0x209)]('success',_0x36897e(0x257)),_0x2cb397[_0x36897e(0x15a)](_0x36897e(0x187));}catch(_0x16f39a){console[_0x36897e(0x195)](_0x16f39a);}}),router[a0_0x52c0f7(0x1b7)](a0_0x52c0f7(0x211),auth,async(_0x1cc069,_0x2c8691)=>{var _0x1b8783=a0_0x52c0f7;try{const {username:_0x18bfa4,email:_0x3d5610,role:_0x322912}=_0x1cc069[_0x1b8783(0x1d4)],_0x3b0fb9=_0x1cc069['user'],_0x54e9d7=await profile[_0x1b8783(0x207)]({'email':_0x3b0fb9[_0x1b8783(0x158)]}),_0x2c8034=await master_shop[_0x1b8783(0x20f)](),_0x21f703=_0x1cc069['params']['id'],_0x27fad3=await purchases['findById'](_0x21f703),_0xe2316b=await suppliers[_0x1b8783(0x20f)]({});let _0xf017d5;if(_0x3b0fb9[_0x1b8783(0x1b8)]=='staff'){const _0x284fbe=await staff['findOne']({'email':_0x3b0fb9[_0x1b8783(0x158)]});_0xf017d5=await warehouse[_0x1b8783(0x20f)]({'status':_0x1b8783(0x219),'name':_0x284fbe[_0x1b8783(0x1a7)],'warehouse_category':_0x1b8783(0x189)});}else _0xf017d5=await warehouse['aggregate']([{'$match':{'status':_0x1b8783(0x219),'warehouse_category':_0x1b8783(0x189)}},{'$group':{'_id':_0x1b8783(0x258),'name':{'$first':_0x1b8783(0x258)}}}]);const _0x23d8b5=await product[_0x1b8783(0x20f)]({}),_0x39a509=BayBinSelected(_0x27fad3[_0x1b8783(0x25b)],_0x27fad3[_0x1b8783(0x16a)]);let _0x3f9bf2=new Date(_0x27fad3[_0x1b8783(0x1be)]),_0xfe52b4=('0'+_0x3f9bf2[_0x1b8783(0x259)]())[_0x1b8783(0x177)](-0x2),_0x5697a1=('0'+(_0x3f9bf2[_0x1b8783(0x178)]()+0x1))[_0x1b8783(0x177)](-0x2),_0x18ad73=_0x3f9bf2['getFullYear'](),_0x592822=_0x18ad73+'-'+_0x5697a1+'-'+_0xfe52b4;if(_0x2c8034[0x0]['language']=='English\x20(US)'){var _0x177844=users['English'];console['log'](_0x177844);}else{if(_0x2c8034[0x0][_0x1b8783(0x1db)]==_0x1b8783(0x23d))var _0x177844=users[_0x1b8783(0x23d)];else{if(_0x2c8034[0x0][_0x1b8783(0x1db)]==_0x1b8783(0x1a5))var _0x177844=users[_0x1b8783(0x1a5)];else{if(_0x2c8034[0x0][_0x1b8783(0x1db)]==_0x1b8783(0x1c1))var _0x177844=users['Spanish'];else{if(_0x2c8034[0x0][_0x1b8783(0x1db)]==_0x1b8783(0x24a))var _0x177844=users[_0x1b8783(0x24a)];else{if(_0x2c8034[0x0][_0x1b8783(0x1db)]==_0x1b8783(0x175))var _0x177844=users['Portuguese'];else{if(_0x2c8034[0x0][_0x1b8783(0x1db)]==_0x1b8783(0x1cc))var _0x177844=users[_0x1b8783(0x1cc)];else{if(_0x2c8034[0x0]['language']==_0x1b8783(0x16b))var _0x177844=users[_0x1b8783(0x1f5)];}}}}}}}_0x2c8691[_0x1b8783(0x184)]('edit_purchases',{'success':_0x1cc069[_0x1b8783(0x209)](_0x1b8783(0x1f2)),'errors':_0x1cc069['flash'](_0x1b8783(0x1d1)),'role':_0x3b0fb9,'profile':_0x54e9d7,'purchases':_0x27fad3,'suppliers':_0xe2316b,'warehouse':_0xf017d5,'product':_0x23d8b5,'master_shop':_0x2c8034,'language':_0x177844,'ed_fullDate':_0x592822,'dataSelected':_0x39a509});}catch(_0x201a48){console[_0x1b8783(0x195)](_0x201a48);}}),router[a0_0x52c0f7(0x1e3)](a0_0x52c0f7(0x211),auth,async(_0x2eb58a,_0x5c6366)=>{var _0x32bc39=a0_0x52c0f7;try{const _0x3f00d5=_0x2eb58a['params']['id'],_0xeba71d=await purchases[_0x32bc39(0x207)]({'_id':_0x2eb58a[_0x32bc39(0x269)]['id']}),_0x4b81a0=await warehouse[_0x32bc39(0x207)]({'name':_0xeba71d[_0x32bc39(0x25b)],'room':_0xeba71d['room']});_0xeba71d['product']['forEach'](_0x4153f6=>{var _0x185d8c=_0x32bc39;const _0x44b624=_0x4b81a0[_0x185d8c(0x20d)]['map'](_0x7ae253=>{var _0x1b4d4b=_0x185d8c;_0x7ae253[_0x1b4d4b(0x1d5)]==_0x4153f6[_0x1b4d4b(0x1d5)]&&_0x7ae253[_0x1b4d4b(0x21e)]==_0x4153f6[_0x1b4d4b(0x21e)]&&_0x7ae253['type']==_0x4153f6[_0x1b4d4b(0x179)]&&_0x7ae253[_0x1b4d4b(0x161)]==_0x4153f6[_0x1b4d4b(0x161)]&&_0x7ae253['bay']==_0x4153f6[_0x1b4d4b(0x1da)]&&_0x7ae253[_0x1b4d4b(0x1fd)]==_0x4153f6[_0x1b4d4b(0x1fd)]&&_0x7ae253[_0x1b4d4b(0x166)]==_0x4153f6[_0x1b4d4b(0x166)]&&(_0x7ae253[_0x1b4d4b(0x18a)]=parseInt(_0x7ae253['product_stock'])-parseInt(_0x4153f6[_0x1b4d4b(0x23a)]));});}),await _0x4b81a0['save']();const {invoice:_0x2a9b89,suppliers:_0x561508,date:_0x55402b,warehouse_name:_0x59a288,prod_name:_0x94319c,prod_code:_0x5d43fd,prod_qty:_0x588f38,prod_unit:_0x5b02ae,prod_secondunit:_0x58cd54,prod_level:_0x19d351,prod_isle:_0xd5916f,prod_pallet:_0x53ef6e,note:_0x21c826,expiry_date:_0xedf4df,batch_code:_0x3cd33c,paid_amount:_0x37bd86,due_amount:_0x1ff28b,Room_name:_0x5f540f,primary_code:_0x5347a0,secondary_code:_0x5bad6d,PO_number:_0x4dbd6e,JO_number:_0x2aefb3}=_0x2eb58a[_0x32bc39(0x1ef)];if(typeof _0x94319c==_0x32bc39(0x252))var _0x3b0fd6=[_0x2eb58a[_0x32bc39(0x1ef)]['prod_name']],_0x191802=[_0x2eb58a['body']['prod_code']],_0xbcb6f8=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x244)]],_0xdfa43b=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x26e)]],_0x8c238b=[_0x2eb58a[_0x32bc39(0x1ef)]['prod_secondunit']],_0x561a7e=[_0x2eb58a[_0x32bc39(0x1ef)]['prod_level']],_0xb4caa3=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x239)]],_0x81fb8f=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x216)]],_0x38c7a6=[_0x2eb58a['body']['primary_code']],_0x208692=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1ec)]],_0x469b4f=[_0x2eb58a['body']['MaxStocks_data']],_0x14fc1a=[_0x2eb58a[_0x32bc39(0x1ef)]['batch_code']],_0x131ed2=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1be)]],_0x241fcc=[_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x166)]],_0x1676fb=[_0x2eb58a[_0x32bc39(0x1ef)]['rak']],_0x5831eb=[_0x2eb58a['body'][_0x32bc39(0x179)]];else var _0x3b0fd6=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x264)]],_0x191802=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1f4)]],_0xbcb6f8=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x244)]],_0xdfa43b=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x26e)]],_0x8c238b=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1f9)]],_0x561a7e=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1af)]],_0xb4caa3=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x239)]],_0x81fb8f=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x216)]],_0x38c7a6=[..._0x2eb58a['body'][_0x32bc39(0x203)]],_0x208692=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1ec)]],_0x469b4f=[..._0x2eb58a[_0x32bc39(0x1ef)]['MaxStocks_data']],_0x14fc1a=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x26b)]],_0x131ed2=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1be)]],_0x241fcc=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x166)]],_0x1676fb=[..._0x2eb58a[_0x32bc39(0x1ef)]['rak']],_0x5831eb=[..._0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x179)]];const _0x25d7bf=_0x3b0fd6[_0x32bc39(0x231)](_0x5cb74f=>{return _0x5cb74f={'product_name':_0x5cb74f};});_0x191802[_0x32bc39(0x165)]((_0x3fadc6,_0x547c8d)=>{var _0x17e9c1=_0x32bc39;_0x25d7bf[_0x547c8d][_0x17e9c1(0x214)]=_0x3fadc6;}),_0xbcb6f8[_0x32bc39(0x165)]((_0x5eaf61,_0x22f503)=>{var _0x517d28=_0x32bc39;_0x25d7bf[_0x22f503][_0x517d28(0x23a)]=_0x5eaf61;}),_0xdfa43b[_0x32bc39(0x165)]((_0x461834,_0x85b5cd)=>{_0x25d7bf[_0x85b5cd]['standard_unit']=_0x461834;}),_0x8c238b[_0x32bc39(0x165)]((_0x4a0d7c,_0x331b19)=>{var _0x42d649=_0x32bc39;_0x25d7bf[_0x331b19][_0x42d649(0x240)]=_0x4a0d7c;}),_0x561a7e[_0x32bc39(0x165)]((_0x371f19,_0x30a154)=>{var _0x3a1a1b=_0x32bc39;_0x25d7bf[_0x30a154][_0x3a1a1b(0x1da)]=_0x371f19;}),_0xb4caa3[_0x32bc39(0x165)]((_0x6b39ce,_0x542870)=>{var _0x287313=_0x32bc39;_0x25d7bf[_0x542870][_0x287313(0x161)]=_0x6b39ce;}),_0x81fb8f[_0x32bc39(0x165)]((_0x1d46ea,_0xe657bd)=>{var _0x661220=_0x32bc39;_0x25d7bf[_0xe657bd][_0x661220(0x21e)]=_0x1d46ea;}),_0x38c7a6[_0x32bc39(0x165)]((_0x80bd19,_0x319c34)=>{var _0x510c1d=_0x32bc39;_0x25d7bf[_0x319c34][_0x510c1d(0x203)]=_0x80bd19;}),_0x208692['forEach']((_0x3ae3f3,_0x199cd7)=>{var _0x34c4bc=_0x32bc39;_0x25d7bf[_0x199cd7][_0x34c4bc(0x1ec)]=_0x3ae3f3;}),_0x469b4f[_0x32bc39(0x165)]((_0x58cdbe,_0x4e2af7)=>{_0x25d7bf[_0x4e2af7]['maxStocks']=_0x58cdbe;}),_0x14fc1a[_0x32bc39(0x165)]((_0x11dd57,_0x183cbe)=>{var _0x45311c=_0x32bc39;_0x25d7bf[_0x183cbe][_0x45311c(0x26b)]=_0x11dd57;}),_0x131ed2[_0x32bc39(0x165)]((_0x3fee0c,_0x1dd230)=>{_0x25d7bf[_0x1dd230]['expiry_date']=_0x3fee0c;}),_0x5831eb[_0x32bc39(0x165)]((_0x1409c1,_0x4c3a9b)=>{var _0x1ff468=_0x32bc39;_0x25d7bf[_0x4c3a9b][_0x1ff468(0x179)]=_0x1409c1;}),_0x241fcc['forEach']((_0x2c32a9,_0x5860a1)=>{_0x25d7bf[_0x5860a1]['storage']=_0x2c32a9;}),_0x1676fb['forEach']((_0x269f93,_0x2c12b3)=>{var _0x304327=_0x32bc39;_0x25d7bf[_0x2c12b3][_0x304327(0x1fd)]=_0x269f93;});const _0x1ad4c9=_0x25d7bf['filter'](_0x226da1=>_0x226da1['quantity']!=='0'&&_0x226da1[_0x32bc39(0x23a)]!=='');_0xeba71d[_0x32bc39(0x181)]=_0x2a9b89,_0xeba71d[_0x32bc39(0x1dc)]=_0x561508,_0xeba71d[_0x32bc39(0x21f)]=_0x55402b,_0xeba71d['warehouse_name']=_0x59a288,_0xeba71d[_0x32bc39(0x201)]=_0x1ad4c9,_0xeba71d[_0x32bc39(0x197)]=_0x21c826,_0xeba71d[_0x32bc39(0x260)]=_0x37bd86,_0xeba71d[_0x32bc39(0x1a6)]=_0x1ff28b,_0xeba71d[_0x32bc39(0x16a)]=_0x5f540f,_0xeba71d[_0x32bc39(0x1d3)]=_0x4dbd6e,_0xeba71d['JO_number']=_0x2aefb3;const _0x17078e=await _0xeba71d['save'](),_0x2ed766=await warehouse['findOne']({'name':_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x25b)],'room':_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x19c)]});_0xeba71d[_0x32bc39(0x201)][_0x32bc39(0x165)](_0x3a8100=>{var _0xe0720b=_0x32bc39,_0x905710=0x0;const _0x3bb4f9=_0x2ed766['product_details'][_0xe0720b(0x231)](_0x5f48bd=>{var _0x58d42a=_0xe0720b;_0x5f48bd[_0x58d42a(0x1d5)]==_0x3a8100['product_name']&&_0x5f48bd[_0x58d42a(0x21e)]==_0x3a8100[_0x58d42a(0x21e)]&&_0x5f48bd[_0x58d42a(0x179)]==_0x3a8100[_0x58d42a(0x179)]&&_0x5f48bd[_0x58d42a(0x161)]==_0x3a8100[_0x58d42a(0x161)]&&_0x5f48bd[_0x58d42a(0x1da)]==_0x3a8100[_0x58d42a(0x1da)]&&_0x5f48bd['rack']==_0x3a8100[_0x58d42a(0x1fd)]&&_0x5f48bd[_0x58d42a(0x166)]==_0x3a8100['storage']&&(_0x5f48bd[_0x58d42a(0x18a)]=parseInt(_0x5f48bd[_0x58d42a(0x18a)])+parseInt(_0x3a8100['quantity']),_0x905710++);});_0x905710=='0'&&(_0x2ed766['product_details']=_0x2ed766['product_details']['concat']({'product_name':_0x3a8100[_0xe0720b(0x1d5)],'product_stock':_0x3a8100[_0xe0720b(0x23a)],'primary_code':_0x3a8100[_0xe0720b(0x203)],'secondary_code':_0x3a8100['secondary_code'],'product_code':_0x3a8100[_0xe0720b(0x214)],'storage':_0x3a8100[_0xe0720b(0x166)],'rack':_0x3a8100['rack'],'bay':_0x3a8100[_0xe0720b(0x1da)],'bin':_0x3a8100[_0xe0720b(0x161)],'type':_0x3a8100[_0xe0720b(0x179)],'floorlevel':_0x3a8100[_0xe0720b(0x21e)],'maxProducts':_0x3a8100[_0xe0720b(0x156)],'unit':_0x3a8100[_0xe0720b(0x200)],'secondary_unit':_0x3a8100['secondary_unit'],'expiry_date':_0x3a8100[_0xe0720b(0x1be)]}));}),await _0x2ed766['save']();const _0x5531aa=await s_payment_data[_0x32bc39(0x207)]({'invoice':_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x181)]});if(_0x5531aa===null){}else console[_0x32bc39(0x195)](_0x32bc39(0x1dc),_0x5531aa,_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x181)]),_0x5531aa['suppliers']=_0x2eb58a[_0x32bc39(0x1ef)][_0x32bc39(0x1dc)],await _0x5531aa['save']();_0x2eb58a[_0x32bc39(0x209)](_0x32bc39(0x1f2),_0x32bc39(0x1ee)),_0x5c6366['redirect']('/all_purchases/view');}catch(_0x91aafd){console['log'](_0x91aafd);}}),router[a0_0x52c0f7(0x1e3)]('/give_payment/:id',auth,async(_0x3b340b,_0x57c4e8)=>{var _0x293c86=a0_0x52c0f7;try{const _0x4bcaf8=_0x3b340b[_0x293c86(0x269)]['id'],{invoice:_0x49ad8c,suppliers:_0x3c3531,payable:_0x186cf4,due_amount:_0x156101}=_0x3b340b[_0x293c86(0x1ef)],_0x4cc8b0=await purchases['findById'](_0x4bcaf8);var _0x30662c=_0x186cf4-_0x156101;_0x4cc8b0['paid_amount']=parseFloat(_0x4cc8b0['paid_amount'])+parseFloat(_0x156101),_0x4cc8b0[_0x293c86(0x1a6)]=_0x30662c;const _0x3b2c47=await _0x4cc8b0[_0x293c86(0x1f1)]();console[_0x293c86(0x195)](_0x3b2c47);const _0xcb67b3=await s_payment_data[_0x293c86(0x207)]({'invoice':_0x49ad8c});_0xcb67b3['amount']=_0x30662c,await _0xcb67b3[_0x293c86(0x1f1)]();let _0x5b5c42=new Date(),_0x3444c3=('0'+_0x5b5c42[_0x293c86(0x259)]())[_0x293c86(0x177)](-0x2),_0x84d7f0=('0'+(_0x5b5c42[_0x293c86(0x178)]()+0x1))['slice'](-0x2),_0x53f828=_0x5b5c42[_0x293c86(0x1ac)](),_0x13989c=_0x53f828+'-'+_0x84d7f0+'-'+_0x3444c3;const _0x24be73=new suppliers_payment({'invoice':_0x49ad8c,'date':_0x53f828+'-'+_0x84d7f0+'-'+_0x3444c3,'suppliers':_0x3c3531,'reason':'Paid\x20For\x20Purchase','amount':_0x156101}),_0x45da23=await _0x24be73[_0x293c86(0x1f1)]();_0x3b340b[_0x293c86(0x209)]('success',_0x293c86(0x199)),_0x57c4e8[_0x293c86(0x15a)](_0x293c86(0x187));}catch(_0x5eec24){console[_0x293c86(0x195)](_0x5eec24);}}),router[a0_0x52c0f7(0x1b7)](a0_0x52c0f7(0x25d),auth,async(_0x24fd26,_0x4757d2)=>{var _0x493441=a0_0x52c0f7;try{const {username:_0x478af6,email:_0x5b110f,role:_0x11ee4b}=_0x24fd26[_0x493441(0x1d4)],_0x5653a6=_0x24fd26[_0x493441(0x1d4)],_0x5aa3ba=await profile[_0x493441(0x207)]({'email':_0x5653a6[_0x493441(0x158)]}),_0x53bf0d=await master_shop[_0x493441(0x20f)]();console[_0x493441(0x195)](_0x493441(0x185),_0x53bf0d);const _0x4a8930=_0x24fd26[_0x493441(0x269)]['id'],_0x2751c9=await purchases['findById'](_0x4a8930);console[_0x493441(0x195)](_0x2751c9);const _0x5c2991=await suppliers[_0x493441(0x207)]({'name':_0x2751c9[_0x493441(0x1dc)]});console[_0x493441(0x195)](_0x5c2991);if(_0x53bf0d[0x0]['language']=='English\x20(US)'){var _0x477e20=users['English'];console[_0x493441(0x195)](_0x477e20);}else{if(_0x53bf0d[0x0][_0x493441(0x1db)]==_0x493441(0x23d))var _0x477e20=users[_0x493441(0x23d)];else{if(_0x53bf0d[0x0][_0x493441(0x1db)]==_0x493441(0x1a5))var _0x477e20=users['German'];else{if(_0x53bf0d[0x0]['language']==_0x493441(0x1c1))var _0x477e20=users[_0x493441(0x1c1)];else{if(_0x53bf0d[0x0][_0x493441(0x1db)]==_0x493441(0x24a))var _0x477e20=users[_0x493441(0x24a)];else{if(_0x53bf0d[0x0][_0x493441(0x1db)]==_0x493441(0x175))var _0x477e20=users['Portuguese'];else{if(_0x53bf0d[0x0][_0x493441(0x1db)]==_0x493441(0x1cc))var _0x477e20=users[_0x493441(0x1cc)];else{if(_0x53bf0d[0x0][_0x493441(0x1db)]==_0x493441(0x16b))var _0x477e20=users[_0x493441(0x1f5)];}}}}}}}_0x4757d2['render'](_0x493441(0x17f),{'success':_0x24fd26[_0x493441(0x209)](_0x493441(0x1f2)),'errors':_0x24fd26[_0x493441(0x209)](_0x493441(0x1d1)),'role':_0x5653a6,'profile':_0x5aa3ba,'master_shop':_0x53bf0d,'supplier':_0x5c2991,'purchase':_0x2751c9,'language':_0x477e20});}catch(_0x58f731){console[_0x493441(0x195)](_0x58f731);}}),router[a0_0x52c0f7(0x1b7)](a0_0x52c0f7(0x1e5),auth,async(_0x3eaa90,_0x4173dc)=>{var _0x9f75a7=a0_0x52c0f7;try{const {username:_0x468002,email:_0x2ecf3b,role:_0x3773af}=_0x3eaa90['user'],_0x48c2c2=_0x3eaa90[_0x9f75a7(0x1d4)],_0x427c42=await profile['findOne']({'email':_0x48c2c2[_0x9f75a7(0x158)]}),_0x1e214c=await master_shop[_0x9f75a7(0x20f)]();console[_0x9f75a7(0x195)](_0x9f75a7(0x185),_0x1e214c);const _0x3d496f=_0x3eaa90['params']['id'];console[_0x9f75a7(0x195)](_0x3d496f);const _0x308de4=await purchases[_0x9f75a7(0x1f0)](_0x3d496f);console['log']('user_id',_0x308de4);const _0x3f0f4a=await product[_0x9f75a7(0x20f)]({}),_0x345aa7=await warehouse[_0x9f75a7(0x1e7)]([{'$match':{'name':_0x308de4[_0x9f75a7(0x25b)],'room':_0x308de4[_0x9f75a7(0x16a)],'warehouse_category':_0x9f75a7(0x189)}},{'$unwind':_0x9f75a7(0x262)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x9f75a7(0x210)},'bay':{'$first':_0x9f75a7(0x191)},'bin':{'$first':_0x9f75a7(0x261)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x9f75a7(0x22a)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x9f75a7(0x24d)},'storage':{'$first':_0x9f75a7(0x268)},'rack':{'$first':_0x9f75a7(0x1a2)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x9f75a7(0x219),'name':_0x9f75a7(0x17b),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x9f75a7(0x258),'name':{'$first':_0x9f75a7(0x258)}}},{'$sort':{'name':0x1}}]),console[_0x9f75a7(0x195)]('stock_data',_0x345aa7);if(_0x1e214c[0x0][_0x9f75a7(0x1db)]==_0x9f75a7(0x225)){var _0x119012=users[_0x9f75a7(0x253)];console[_0x9f75a7(0x195)](_0x119012);}else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]=='Hindi')var _0x119012=users[_0x9f75a7(0x23d)];else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]==_0x9f75a7(0x1a5))var _0x119012=users[_0x9f75a7(0x1a5)];else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]==_0x9f75a7(0x1c1))var _0x119012=users[_0x9f75a7(0x1c1)];else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]=='French')var _0x119012=users['French'];else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]==_0x9f75a7(0x175))var _0x119012=users['Portuguese'];else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]==_0x9f75a7(0x1cc))var _0x119012=users['Chinese'];else{if(_0x1e214c[0x0][_0x9f75a7(0x1db)]==_0x9f75a7(0x16b))var _0x119012=users['Arabic'];}}}}}}}_0x4173dc[_0x9f75a7(0x184)]('return_purchase',{'success':_0x3eaa90[_0x9f75a7(0x209)](_0x9f75a7(0x1f2)),'errors':_0x3eaa90[_0x9f75a7(0x209)](_0x9f75a7(0x1d1)),'role':_0x48c2c2,'profile':_0x427c42,'user':_0x308de4,'stock':_0x345aa7,'master_shop':_0x1e214c,'product':_0x3f0f4a,'language':_0x119012,'warehouse':warehouse_data});}catch(_0x215356){console['log'](_0x215356);}}),router[a0_0x52c0f7(0x1e3)]('/view/return_purchase/:id',auth,async(_0x2f90d8,_0x43a4e5)=>{var _0x1139e4=a0_0x52c0f7;try{const {invoice:_0x1070db,date:_0x34d484,warehouse_name:_0x63353,Room_name:_0x3bc248,product_name:_0x8b3249,purchase_quantity:_0x53af9a,stocks:_0x4d46f6,return_qty:_0x3f0bc1,note:_0x157a2f,level:_0x189e79,isle:_0xbf9a87,pallet:_0x13061a,to_warehouse_name:_0x2cee35,to_Room_name:_0x2480f3}=_0x2f90d8[_0x1139e4(0x1ef)],_0x51d647=await purchases[_0x1139e4(0x207)]({'_id':_0x2f90d8[_0x1139e4(0x269)]['id']}),_0x38488f=await warehouse[_0x1139e4(0x207)]({'name':_0x63353,'room':_0x3bc248});if(typeof _0x8b3249==_0x1139e4(0x252))var _0x4adabc=[_0x2f90d8['body']['product_name']],_0x6ba77e=[_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x272)]],_0x113bb4=[_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x25e)]],_0xce3f5=[_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x224)]],_0x35b895=[_0x2f90d8['body'][_0x1139e4(0x18e)]],_0x3f90a2=[_0x2f90d8[_0x1139e4(0x1ef)]['isle']],_0x25f6f3=[_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1fa)]],_0x39afed=[_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1e1)]],_0x193858=[_0x2f90d8[_0x1139e4(0x1ef)]['product_code_hide']],_0x375b35=[_0x2f90d8[_0x1139e4(0x1ef)]['primary_code_hide']],_0xa8a71=[_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1eb)]];else var _0x4adabc=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1d5)]],_0x6ba77e=[..._0x2f90d8['body']['purchase_quantity']],_0x113bb4=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x25e)]],_0xce3f5=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x224)]],_0x35b895=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x18e)]],_0x3f90a2=[..._0x2f90d8['body'][_0x1139e4(0x227)]],_0x25f6f3=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1fa)]],_0x39afed=[..._0x2f90d8[_0x1139e4(0x1ef)]['types']],_0x193858=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x163)]],_0x375b35=[..._0x2f90d8[_0x1139e4(0x1ef)]['primary_code_hide']],_0xa8a71=[..._0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1eb)]];const _0xf0cd2b=_0x4adabc[_0x1139e4(0x231)](_0x5ec8f5=>{return _0x5ec8f5={'product_name':_0x5ec8f5};});_0x6ba77e[_0x1139e4(0x165)]((_0xca6a8,_0x1b204b)=>{var _0x541cfa=_0x1139e4;_0xf0cd2b[_0x1b204b][_0x541cfa(0x272)]=_0xca6a8;}),_0x113bb4[_0x1139e4(0x165)]((_0x5e7542,_0x248ebb)=>{var _0x132c64=_0x1139e4;_0xf0cd2b[_0x248ebb][_0x132c64(0x228)]=_0x5e7542;}),_0xce3f5['forEach']((_0x3fd639,_0x4be8ff)=>{var _0x2219b0=_0x1139e4;_0xf0cd2b[_0x4be8ff][_0x2219b0(0x224)]=_0x3fd639;}),_0x35b895[_0x1139e4(0x165)]((_0xe3493f,_0x18a0aa)=>{var _0x1301b0=_0x1139e4;_0xf0cd2b[_0x18a0aa][_0x1301b0(0x1da)]=_0xe3493f;}),_0x3f90a2['forEach']((_0x3b66ff,_0xf7b130)=>{var _0x45e474=_0x1139e4;_0xf0cd2b[_0xf7b130][_0x45e474(0x161)]=_0x3b66ff;}),_0x25f6f3[_0x1139e4(0x165)]((_0x297f00,_0x4a7808)=>{var _0x364b47=_0x1139e4;_0xf0cd2b[_0x4a7808][_0x364b47(0x21e)]=_0x297f00;}),_0x39afed['forEach']((_0x51cf78,_0x475bfd)=>{_0xf0cd2b[_0x475bfd]['type']=_0x51cf78;}),_0x193858[_0x1139e4(0x165)]((_0x236f99,_0x5a9b2d)=>{_0xf0cd2b[_0x5a9b2d]['product_code']=_0x236f99;}),_0x375b35[_0x1139e4(0x165)]((_0x44718d,_0x5eb6d4)=>{var _0x35a294=_0x1139e4;_0xf0cd2b[_0x5eb6d4][_0x35a294(0x203)]=_0x44718d;}),_0xa8a71[_0x1139e4(0x165)]((_0x4920d6,_0x2b0270)=>{var _0x58db1c=_0x1139e4;_0xf0cd2b[_0x2b0270][_0x58db1c(0x1ec)]=_0x4920d6;}),_0x51d647[_0x1139e4(0x201)][_0x1139e4(0x165)](_0x2927f3=>{var _0x317d58=_0x1139e4;const _0x4b3929=_0x38488f['product_details'][_0x317d58(0x231)](_0x1a2a5a=>{var _0x421953=_0x317d58;_0x1a2a5a['product_name']==_0x2927f3['product_name']&&_0x1a2a5a[_0x421953(0x21e)]==_0x2927f3[_0x421953(0x21e)]&&_0x1a2a5a['type']==_0x2927f3[_0x421953(0x179)]&&_0x1a2a5a['bin']==_0x2927f3['bin']&&_0x1a2a5a[_0x421953(0x1da)]==_0x2927f3[_0x421953(0x1da)]&&_0x1a2a5a['rack']==_0x2927f3[_0x421953(0x1fd)]&&_0x1a2a5a[_0x421953(0x166)]==_0x2927f3[_0x421953(0x166)]&&(console['log'](parseInt(_0x1a2a5a[_0x421953(0x18a)])+_0x421953(0x17c)+parseInt(_0x2927f3[_0x421953(0x23a)])),_0x1a2a5a[_0x421953(0x18a)]=parseInt(_0x1a2a5a['product_stock'])+parseInt(_0x2927f3[_0x421953(0x23a)]));});}),await _0x38488f[_0x1139e4(0x1f1)]();const _0x40b6ff=_0xf0cd2b[_0x1139e4(0x188)](_0x530dfb=>_0x530dfb[_0x1139e4(0x224)]!=='0'&&_0x530dfb[_0x1139e4(0x224)]!=='');var _0x23a16e=0x0;_0x40b6ff[_0x1139e4(0x165)](_0x3c8f8b=>{var _0x2d95f4=_0x1139e4;console[_0x2d95f4(0x195)](_0x2d95f4(0x15b),_0x3c8f8b),(parseInt(_0x3c8f8b[_0x2d95f4(0x272)])<parseInt(_0x3c8f8b[_0x2d95f4(0x224)])||parseInt(_0x3c8f8b[_0x2d95f4(0x228)])<parseInt(_0x3c8f8b[_0x2d95f4(0x224)]))&&_0x23a16e++;});if(_0x23a16e!=0x0)return _0x2f90d8[_0x1139e4(0x209)](_0x1139e4(0x1d1),_0x1139e4(0x1dd)),_0x43a4e5[_0x1139e4(0x15a)](_0x1139e4(0x192));const _0x174577=new purchases_return({'invoice':_0x1070db,'suppliers':_0x2f90d8[_0x1139e4(0x1ef)]['suppliers'],'date':_0x34d484,'warehouse_name':_0x63353,'return_product':_0x40b6ff,'note':_0x157a2f,'room':_0x3bc248,'to_warehouse_name':_0x2cee35,'to_room':_0x2480f3}),_0x26b35f=await _0x174577[_0x1139e4(0x1f1)]();console['log'](_0x174577);const _0x326d55=await purchases_return[_0x1139e4(0x207)]({'invoice':_0x1070db}),_0xa9e394=await warehouse['findOne']({'name':_0x2cee35,'room':_0x2480f3});_0x326d55['return_product']['forEach'](_0x189edb=>{var _0x523640=_0x1139e4,_0x2964b6=0x0;const _0x12bed5=_0xa9e394['product_details'][_0x523640(0x231)](_0xbd9d98=>{var _0x2f2b21=_0x523640;_0xbd9d98[_0x2f2b21(0x1d5)]==_0x189edb[_0x2f2b21(0x1d5)]&&_0xbd9d98[_0x2f2b21(0x21e)]==_0x189edb[_0x2f2b21(0x21e)]&&_0xbd9d98[_0x2f2b21(0x179)]==_0x189edb[_0x2f2b21(0x179)]&&_0xbd9d98['bin']==_0x189edb['bin']&&_0xbd9d98['bay']==_0x189edb[_0x2f2b21(0x1da)]&&(_0xbd9d98['product_stock']=parseInt(_0xbd9d98['product_stock'])-parseInt(_0x189edb['return_qty']),_0x2964b6++);});_0x2964b6=='0'&&(_0xa9e394[_0x523640(0x20d)]=_0xa9e394[_0x523640(0x20d)][_0x523640(0x26d)]({'product_name':_0x189edb[_0x523640(0x1d5)],'product_stock':_0x189edb[_0x523640(0x224)],'primary_code':_0x189edb[_0x523640(0x203)],'secondary_code':_0x189edb[_0x523640(0x1ec)],'product_code':_0x189edb[_0x523640(0x214)],'storage':_0x189edb[_0x523640(0x166)],'rack':_0x189edb[_0x523640(0x1fd)],'bay':_0x189edb[_0x523640(0x1da)],'bin':_0x189edb[_0x523640(0x161)],'type':_0x189edb['type'],'floorlevel':_0x189edb[_0x523640(0x21e)],'maxProducts':_0x189edb[_0x523640(0x156)],'unit':_0x189edb[_0x523640(0x200)],'secondary_unit':_0x189edb[_0x523640(0x240)],'expiry_date':_0x189edb['expiry_date']}));}),await _0xa9e394[_0x1139e4(0x1f1)]();const _0x2006a7=await purchases[_0x1139e4(0x207)]({'invoice':_0x1070db});_0x2006a7[_0x1139e4(0x194)]=_0x1139e4(0x265);const _0x23c0f6=await _0x2006a7[_0x1139e4(0x1f1)](),_0x436e15=new s_payment_data({'invoice':_0x1070db,'suppliers':_0x2f90d8[_0x1139e4(0x1ef)]['suppliers'],'reason':_0x1139e4(0x232)});await _0x436e15[_0x1139e4(0x1f1)]();const _0x3566ef=await master_shop[_0x1139e4(0x20f)]();console[_0x1139e4(0x195)]('add\x20post',_0x3566ef[0x0][_0x1139e4(0x1a8)]);const _0x4f72be=await email_settings[_0x1139e4(0x207)](),_0x4da759=await suppliers[_0x1139e4(0x207)]({'name':_0x2f90d8[_0x1139e4(0x1ef)][_0x1139e4(0x1dc)]});console[_0x1139e4(0x195)](_0x1139e4(0x255),_0x4da759);_0x3566ef[0x0][_0x1139e4(0x17a)]==0x1?(right_currency=_0x3566ef[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3566ef[0x0][_0x1139e4(0x1c6)]);var _0x121d31=_0x4adabc,_0x206ed7=_0xce3f5,_0x45986c='',_0xcf9331;for(_0xcf9331 in _0x121d31){_0x45986c+='<tr>'+_0x1139e4(0x1bd)+_0x121d31[_0xcf9331]+_0x1139e4(0x21a)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x206ed7[_0xcf9331]+_0x1139e4(0x21a)+_0x1139e4(0x226);}console[_0x1139e4(0x195)](_0x1139e4(0x17d),_0x45986c);let _0x12c7af=nodemailer[_0x1139e4(0x250)]({'service':_0x1139e4(0x23b),'auth':{'user':_0x4f72be[_0x1139e4(0x158)],'pass':_0x4f72be['password']}}),_0x566053={'from':_0x4f72be[_0x1139e4(0x158)],'to':_0x4da759[_0x1139e4(0x158)],'subject':_0x1139e4(0x1d7),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x1139e4(0x1b9)+_0x3566ef[0x0][_0x1139e4(0x1a8)],'cid':_0x1139e4(0x174)}],'html':_0x1139e4(0x23f)+'<html><head><title></title>'+_0x1139e4(0x205)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x1139e4(0x1d0)+_0x1139e4(0x1c7)+_0x1139e4(0x215)+_0x1139e4(0x270)+_0x3566ef[0x0]['site_title']+'\x20</h2>'+_0x1139e4(0x1c7)+_0x1139e4(0x1c7)+_0x1139e4(0x23e)+_0x1139e4(0x215)+_0x1139e4(0x245)+_0x1139e4(0x1b4)+_0x1070db+'\x20'+_0x1139e4(0x204)+'\x20Order\x20Date\x20:\x20'+_0x34d484+'\x20'+'</span>'+_0x1139e4(0x15c)+_0x1139e4(0x1c7)+_0x1139e4(0x1f3)+_0x1139e4(0x18c)+_0x1139e4(0x25f)+_0x1139e4(0x1a0)+_0x1139e4(0x1ed)+_0x1139e4(0x15e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1139e4(0x226)+_0x1139e4(0x1df)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x45986c+'\x20'+'</tbody>'+_0x1139e4(0x19b)+'<div>'+_0x1139e4(0x220)+_0x1139e4(0x242)+_0x3566ef[0x0][_0x1139e4(0x24f)]+'</h5>'+'</div>'+_0x1139e4(0x1c7)+_0x1139e4(0x198)};_0x12c7af[_0x1139e4(0x1f8)](_0x566053,function(_0x41c76d,_0x3eb5a6){var _0x4fe5a9=_0x1139e4;_0x41c76d?(console['log'](_0x41c76d),console[_0x4fe5a9(0x195)](_0x4fe5a9(0x1d2))):console['log'](_0x4fe5a9(0x1e2));}),_0x2f90d8[_0x1139e4(0x209)](_0x1139e4(0x1f2),_0x1139e4(0x251)),_0x43a4e5[_0x1139e4(0x15a)](_0x1139e4(0x187));}catch(_0x218871){console[_0x1139e4(0x195)](_0x218871),_0x43a4e5[_0x1139e4(0x15d)](0xc8)[_0x1139e4(0x1b1)]({'message':_0x218871[_0x1139e4(0x16f)]});}}),router[a0_0x52c0f7(0x1b7)](a0_0x52c0f7(0x24c),auth,async(_0x50d924,_0x3e9432)=>{var _0x232d76=a0_0x52c0f7;try{const {username:_0x481983,email:_0x31cc64,role:_0x363f2f}=_0x50d924[_0x232d76(0x1d4)],_0x440e76=_0x50d924[_0x232d76(0x1d4)],_0x55961a=await profile[_0x232d76(0x207)]({'email':_0x440e76[_0x232d76(0x158)]}),_0x363af4=await master_shop[_0x232d76(0x20f)](),_0x2fbfc5=_0x50d924['params']['id'],_0x153fc8=await purchases[_0x232d76(0x1f0)](_0x2fbfc5);if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x225))var _0x3cce5a=users['English'];else{if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x23d))var _0x3cce5a=users[_0x232d76(0x23d)];else{if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x1a5))var _0x3cce5a=users[_0x232d76(0x1a5)];else{if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x1c1))var _0x3cce5a=users[_0x232d76(0x1c1)];else{if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x24a))var _0x3cce5a=users[_0x232d76(0x24a)];else{if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x175))var _0x3cce5a=users[_0x232d76(0x21c)];else{if(_0x363af4[0x0][_0x232d76(0x1db)]==_0x232d76(0x1cc))var _0x3cce5a=users[_0x232d76(0x1cc)];else{if(_0x363af4[0x0]['language']==_0x232d76(0x16b))var _0x3cce5a=users['Arabic'];}}}}}}}_0x3e9432['render'](_0x232d76(0x183),{'success':_0x50d924['flash']('success'),'errors':_0x50d924[_0x232d76(0x209)](_0x232d76(0x1d1)),'role':_0x440e76,'profile':_0x55961a,'alldata':_0x153fc8,'master_shop':_0x363af4,'language':_0x3cce5a}),console[_0x232d76(0x195)](alldata);}catch(_0xcdf13f){console[_0x232d76(0x195)](_0xcdf13f);}}),router[a0_0x52c0f7(0x1e3)]('/barcode_scanner',async(_0x4b7c6a,_0x11f5db)=>{var _0x3982aa=a0_0x52c0f7;const {product_code:_0x18c67b}=_0x4b7c6a[_0x3982aa(0x1ef)];var _0x464535;const _0x2ffdcb=await product['aggregate']([{'$match':{'primary_code':_0x18c67b,'product_category':_0x3982aa(0x189)}},{'$group':{'_id':_0x3982aa(0x1ce),'name':{'$first':'$name'},'category':{'$first':_0x3982aa(0x1f6)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3982aa(0x1ae)},'alertquantity':{'$first':_0x3982aa(0x1cf)},'product_code':{'$first':_0x3982aa(0x1ca)},'primary_code':{'$first':_0x3982aa(0x267)},'secondary_code':{'$first':_0x3982aa(0x180)},'maxStocks':{'$first':_0x3982aa(0x18f)},'maxProdPerUnit':{'$first':_0x3982aa(0x1ff)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3982aa(0x233)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1517db=await product[_0x3982aa(0x1e7)]([{'$match':{'secondary_code':_0x18c67b,'product_category':_0x3982aa(0x189)}},{'$group':{'_id':_0x3982aa(0x1ce),'name':{'$first':_0x3982aa(0x258)},'category':{'$first':'$category'},'brand':{'$first':_0x3982aa(0x1aa)},'unit':{'$first':_0x3982aa(0x1ae)},'alertquantity':{'$first':_0x3982aa(0x1cf)},'product_code':{'$first':_0x3982aa(0x1ca)},'primary_code':{'$first':_0x3982aa(0x267)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3982aa(0x18f)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3982aa(0x233)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2ffdcb[_0x3982aa(0x1bf)]>0x0)_0x464535=_0x2ffdcb;else _0x1517db['length']>0x0&&(_0x464535=_0x1517db);_0x11f5db[_0x3982aa(0x1b1)](_0x464535);}),router[a0_0x52c0f7(0x1e3)]('/CheckingWarehouse',async(_0x19c10a,_0x154f99)=>{var _0x16161d=a0_0x52c0f7;const {primaryCode:_0x4544fc,secondaryCode:_0x451c8d,productCode:_0x4c4351,bay:_0x404ed9,bin:_0x2a73b2,types:_0x4e7cc9,pallet:_0x50ab8e,warehouses:_0x1dc037,room:_0xb9d043}=_0x19c10a[_0x16161d(0x1ef)];console['log'](_0x19c10a['body']);try{const _0x4cbbb4=await warehouse['aggregate']([{'$match':{'name':_0x1dc037,'room':_0xb9d043}},{'$unwind':_0x16161d(0x262)},{'$match':{'product_details.bay':_0x404ed9,'product_details.bin':_0x2a73b2,'product_details.type':_0x4e7cc9}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x16161d(0x210)},'level':{'$first':_0x16161d(0x1d6)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x16161d(0x173)},'maxProducts':{'$first':_0x16161d(0x1b2)}}}]);_0x154f99[_0x16161d(0x15d)](0xc8)[_0x16161d(0x1b1)](_0x4cbbb4);}catch(_0x3caed6){_0x154f99[_0x16161d(0x15d)](0x194)['json']({'message':_0x3caed6[_0x16161d(0x16f)]});}}),module[a0_0x52c0f7(0x229)]=router;