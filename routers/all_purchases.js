var a0_0x3c7338=a0_0x1a9d;function a0_0x1a9d(_0x4af906,_0x2bd8f0){var _0x4418ac=a0_0x4418();return a0_0x1a9d=function(_0x1a9d45,_0x1eb9dc){_0x1a9d45=_0x1a9d45-0x1de;var _0x2d35f9=_0x4418ac[_0x1a9d45];return _0x2d35f9;},a0_0x1a9d(_0x4af906,_0x2bd8f0);}(function(_0x213907,_0xc36086){var _0x416c7f=a0_0x1a9d,_0x491718=_0x213907();while(!![]){try{var _0x320fb5=parseInt(_0x416c7f(0x200))/0x1*(-parseInt(_0x416c7f(0x1f1))/0x2)+-parseInt(_0x416c7f(0x28a))/0x3*(-parseInt(_0x416c7f(0x205))/0x4)+-parseInt(_0x416c7f(0x222))/0x5*(-parseInt(_0x416c7f(0x1fc))/0x6)+parseInt(_0x416c7f(0x290))/0x7*(parseInt(_0x416c7f(0x1f3))/0x8)+parseInt(_0x416c7f(0x284))/0x9+parseInt(_0x416c7f(0x253))/0xa*(parseInt(_0x416c7f(0x2d4))/0xb)+-parseInt(_0x416c7f(0x26d))/0xc*(parseInt(_0x416c7f(0x268))/0xd);if(_0x320fb5===_0xc36086)break;else _0x491718['push'](_0x491718['shift']());}catch(_0x5b310c){_0x491718['push'](_0x491718['shift']());}}}(a0_0x4418,0x716bb));const express=require(a0_0x3c7338(0x27e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x3c7338(0x2a7)),auth=require(a0_0x3c7338(0x251)),nodemailer=require('nodemailer');var ejs=require(a0_0x3c7338(0x275));function a0_0x4418(){var _0x223500=['</div>','concat','email','types','log','Purchase\x20Return','product_details','JO_number','$product_details.isle','Email\x20sent\x20successfully','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Purchase\x20Return\x20Mail','$product_details.secondary_code','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</span>','../public/language/languages.json','13254995YlFxsO','language','$product_details.pallet','Paid\x20For\x20Purchase','status','12HWqDZZ','redirect','$alertquantity','product_code_hide','$room','<span\x20style=\x22float:\x20right;\x22>','sendMail','$product_details.floorlevel','ejs','message','$note','$expiry_date','warehouse','floorlevel','\x20</h2>','storage','$name','express','Raw\x20Materials','$product.floorlevel','Rack\x20A','Logo.png','pallet','3386043uHxhFx','primary_code_hide','return_qty','<h2>\x20','port','$maxStocks','10839cgYLdU','actual_qty','$product.bay','$secondary_code','product','$suppliers','133ahdxfq','production_date','</td>','return_product','standard_unit','level','length','\x20Order\x20Date\x20:\x20','</thead>','due_amount','isle','\x20<>\x20','DRY\x20STORAGE','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product.room_name','$product_details.expiry_date','expiry_date','findById','Rack\x20B','all_purchases_barcode','Spanish','site_title','then','../models/all_models','aggregate','room_name','product_stock','</head><body>','/view','product_code','$category','Enabled','errors','$warehouse_name','/view/add_purchases','RMSEmail','rack','$due_amount','gmail','prod_Qty','$product_details.storage','success','finalize','name','/barcode_scanner','</table>','return_data','\x20<\x20wew\x20>\x20','user_id','/view/add_purchases/:id','$product_details._id','$product_details','<html><head><title></title>','Portuguese','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$finalize','delivery_code','$product.bin','rak','Chinese','Arabic','note','path','quantity','$product','<h5>','stock_quantity','type','8284804RFIDpe','currency_placement','prod_pallet','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$paid_amount','$product_code','string','createTransport','batch_code','purchase_quantity','Return\x20Goods','slice','json','/view/return_purchase/:id','An\x20error\x20occurred.','prod_code','/barcode/:id','floor','Purchase\x20Mail','here','An\x20error\x20occurred\x20while\x20saving\x20data.','role','add_purchases','$product_details.product_code','filter','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','forEach','MaxStocks_data','render','$product_details.rack','<hr\x20class=\x22my-3\x22>','Sales\x20Update\x20successfully','edit_purchases','French','$product.type','user','English','getDate','bay','$batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$unit','$primary_code','$product_details.primary_code','Level','findOne','actual_uom','prod_name','save','$product_details.level','prod_unit','maxperunit','<tbody\x20style=\x22text-align:\x20center;\x22>','secondary_code_hide','<div>','/../public','stocks','flash','$return_data','/view/:id','Ambient','$_id','COLD\x20STORAGE','2MhJzZm','secondary_unit','9304bGVFgV','$maxProdPerUnit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_qty','/upload/','German','back','purchases\x20item\x20return\x20successfull','toString','30VtSPeY','/CheckingWarehouse','edit_purchases_view','Arabic\x20(ae)','166853crJefg','$invoice','Portuguese\x20(BR)','INC-','purchase\x20data\x20update\x20successfully','448tMUTvR','maxStocks','find','/give_payment/:id','</tbody>','delivery_date','getFullYear','prod_invoice','post','English\x20(US)','master','Floor','host','prod_level','warehouse_name','/preview/:id','/invoice/:id','product_name','Enclosed','$product_details.type','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','staff','date','Error\x20Occurs','</body></html>','secondary_code','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','94895zvDpIj','add_purchases\x20error','Rack\x20E','table\x20page','bin','Rack\x20F','prod_isle','Rack\x20C','prod_primunit','POnumber','primary_code','push','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','purchase_invoice','$suppliers_docs','product_list','padStart','</h5>','<h5\x20style=\x22text-align:\x20left;\x22>','return_purchase','paid_amount','$product_details.bay','$product_details.product_name','$brand','map','get','Receiving\x20Area','Rack\x20D','</tr>','$product_details.bin','suppliers','prod_secondunit','Hindi','/all_purchases/view','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Shelves','suppliers_docs','room','params','\x20Order\x20Number\x20:\x20','True','max_product_unit','alertQTY','error','payment\x20successfull','../middleware/auth','body','10kWKWxQ','deliverycode','password','$product.quantity'];a0_0x4418=function(){return _0x223500;};return a0_0x4418();}const path=require(a0_0x3c7338(0x2ce)),users=require(a0_0x3c7338(0x267));router[a0_0x3c7338(0x23c)](a0_0x3c7338(0x2ac),auth,async(_0x3403d9,_0x983e1a)=>{var _0x1bc87c=a0_0x3c7338;try{const {username:_0x1d073c,email:_0x416cc3,role:_0x55e5a4}=_0x3403d9[_0x1bc87c(0x2f9)],_0x451402=_0x3403d9[_0x1bc87c(0x2f9)],_0x536d63=await profile[_0x1bc87c(0x1df)]({'email':_0x451402['email']}),_0x44d32a=await staff[_0x1bc87c(0x1df)]({'email':_0x451402[_0x1bc87c(0x259)]});if(_0x451402[_0x1bc87c(0x2ea)]==_0x1bc87c(0x21b)){const _0x5a3991=await staff[_0x1bc87c(0x1df)]({'email':_0x451402[_0x1bc87c(0x259)]});}const _0x48ed44=await master_shop[_0x1bc87c(0x207)]();let _0x2d42f2;if(_0x451402[_0x1bc87c(0x2ea)]==_0x1bc87c(0x21b)){const _0x421f18=await staff[_0x1bc87c(0x1df)]({'email':_0x451402['email']});_0x2d42f2=await purchases[_0x1bc87c(0x2a8)]([{'$match':{'warehouse_name':_0x421f18[_0x1bc87c(0x279)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x1bc87c(0x2bb),'as':'suppliers_docs'}},{'$unwind':_0x1bc87c(0x231)},{'$unwind':_0x1bc87c(0x2d0)},{'$group':{'_id':_0x1bc87c(0x1ef),'invoice':{'$first':_0x1bc87c(0x201)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x1bc87c(0x271)},'product':{'$push':'$product'},'note':{'$first':_0x1bc87c(0x277)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x1bc87c(0x2b5)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1bc87c(0x2fd)},'expiry_date':{'$first':_0x1bc87c(0x278)},'suppliers_docs':{'$first':_0x1bc87c(0x231)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x1bc87c(0x28c)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x1bc87c(0x2f8)},'floorlevel':{'$addToSet':_0x1bc87c(0x280)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2d42f2=await purchases['aggregate']([{'$lookup':{'from':_0x1bc87c(0x241),'localField':'suppliers','foreignField':_0x1bc87c(0x2bb),'as':_0x1bc87c(0x248)}},{'$unwind':_0x1bc87c(0x231)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x1bc87c(0x201)},'suppliers':{'$first':_0x1bc87c(0x28f)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1bc87c(0x2b1)},'room':{'$addToSet':_0x1bc87c(0x29e)},'product':{'$push':_0x1bc87c(0x2d0)},'note':{'$first':_0x1bc87c(0x277)},'paid_amount':{'$first':_0x1bc87c(0x2d9)},'due_amount':{'$first':_0x1bc87c(0x2b5)},'return_data':{'$first':_0x1bc87c(0x1ec)},'batch_code':{'$first':_0x1bc87c(0x2fd)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x1bc87c(0x231)},'total_product_quantity':{'$sum':_0x1bc87c(0x256)},'level':{'$addToSet':_0x1bc87c(0x28c)},'isle':{'$addToSet':_0x1bc87c(0x2c9)},'type':{'$addToSet':_0x1bc87c(0x2f8)},'floorlevel':{'$addToSet':_0x1bc87c(0x280)},'finalize':{'$first':_0x1bc87c(0x2c7)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x48ed44[0x0][_0x1bc87c(0x269)]==_0x1bc87c(0x20e)){var _0x71e95c=users[_0x1bc87c(0x2fa)];console['log'](_0x71e95c);}else{if(_0x48ed44[0x0][_0x1bc87c(0x269)]==_0x1bc87c(0x243))var _0x71e95c=users['Hindi'];else{if(_0x48ed44[0x0][_0x1bc87c(0x269)]=='German')var _0x71e95c=users[_0x1bc87c(0x1f8)];else{if(_0x48ed44[0x0]['language']=='Spanish')var _0x71e95c=users[_0x1bc87c(0x2a4)];else{if(_0x48ed44[0x0]['language']==_0x1bc87c(0x2f7))var _0x71e95c=users['French'];else{if(_0x48ed44[0x0][_0x1bc87c(0x269)]=='Portuguese\x20(BR)')var _0x71e95c=users[_0x1bc87c(0x2c5)];else{if(_0x48ed44[0x0][_0x1bc87c(0x269)]==_0x1bc87c(0x2cb))var _0x71e95c=users[_0x1bc87c(0x2cb)];else{if(_0x48ed44[0x0]['language']==_0x1bc87c(0x1ff))var _0x71e95c=users[_0x1bc87c(0x2cc)];}}}}}}}_0x983e1a['render']('all_purchases',{'success':_0x3403d9[_0x1bc87c(0x1eb)](_0x1bc87c(0x2b9)),'errors':_0x3403d9[_0x1bc87c(0x1eb)](_0x1bc87c(0x2b0)),'purchases':_0x2d42f2,'role':_0x451402,'profile':_0x536d63,'master_shop':_0x48ed44,'language':_0x71e95c});}catch(_0x29fe15){console[_0x1bc87c(0x25b)](_0x1bc87c(0x225),_0x29fe15),_0x983e1a[_0x1bc87c(0x26c)](0xc8)['json']({'message':_0x29fe15[_0x1bc87c(0x276)]});}});function BayBinSelected(_0x2dc743,_0x5466e4){var _0x18b5b4=a0_0x3c7338,_0x2ae263=[],_0x4cb2e9=[],_0x3b5a90=[],_0x36b2eb=[],_0x3bd968=[],_0x4219d5=[];let _0x314945=[];if(_0x2dc743==_0x18b5b4(0x29c))switch(_0x5466e4){case'Rack\x20A':_0x2ae263=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4cb2e9=[0x1,0x2],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de),'Floor'],_0x3bd968=['D'],_0x4219d5=['A'];break;case'Rack\x20B':_0x2ae263=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4cb2e9=[0x1,0x2],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de),'Floor'],_0x3bd968=['D'],_0x4219d5=['B'];break;case _0x18b5b4(0x247):_0x2ae263=[0x0],_0x4cb2e9=[0x0],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=['Floor'],_0x3bd968=['D'],_0x4219d5=['S'];break;case _0x18b5b4(0x23d):_0x2ae263=[0x0],_0x4cb2e9=[0x0],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3b5a90=[_0x18b5b4(0x210)],_0x3bd968=['D'],_0x4219d5=['R'];break;}else{if(_0x2dc743==_0x18b5b4(0x1f0))switch(_0x5466e4){case _0x18b5b4(0x281):_0x2ae263=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4cb2e9=['B','F'],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de),_0x18b5b4(0x210)],_0x3bd968=['C'],_0x4219d5=['A'];break;case _0x18b5b4(0x2a2):_0x2ae263=[0x5,0x4,0x3,0x2,0x1],_0x4cb2e9=['F','B','S'],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de),_0x18b5b4(0x210)],_0x3bd968=['C'],_0x4219d5=['B'];break;case _0x18b5b4(0x229):_0x2ae263=[0x1,0x2,0x3,0x4,0x5],_0x4cb2e9=['B','F','S'],_0x36b2eb=[0x5,0x4,0x3,0x2,0x1],_0x3b5a90=['Level',_0x18b5b4(0x210)],_0x3bd968=['C'],_0x4219d5=['C'];break;case _0x18b5b4(0x23e):_0x2ae263=[0x5,0x4,0x3,0x2,0x1],_0x4cb2e9=['F','B','S'],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de),_0x18b5b4(0x210)],_0x3bd968=['C'],_0x4219d5=['D'];break;case _0x18b5b4(0x224):_0x2ae263=[0x4,0x3,0x2,0x1],_0x4cb2e9=[0x1,0x2],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de),'Floor'],_0x3bd968=['C'],_0x4219d5=['E'];break;case _0x18b5b4(0x227):_0x2ae263=[0x1,0x2,0x3],_0x4cb2e9=[0x1,0x2],_0x36b2eb=[0x1,0x2,0x3,0x4,0x5],_0x3b5a90=[_0x18b5b4(0x1de)],_0x3bd968=['C'],_0x4219d5=['F'];break;}}return{'levels':_0x2ae263,'Isle':_0x4cb2e9,'rack':_0x36b2eb,'type':_0x3b5a90,'storage':_0x3bd968,'rak':_0x4219d5};}async function getRandom8DigitNumber(){var _0x4b7ac1=a0_0x3c7338;const _0x1bdcc4=0x989680,_0x514159=0x5f5e0ff,_0x2f8d20=Math[_0x4b7ac1(0x2e6)](Math['random']()*(_0x514159-_0x1bdcc4+0x1))+_0x1bdcc4;var _0x317973;const _0x1b2530=await purchases['findOne']({'invoice':_0x4b7ac1(0x203)+_0x2f8d20});return _0x1b2530&&_0x1b2530[_0x4b7ac1(0x296)]>0x0?_0x317973='INC-'+_0x2f8d20:_0x317973='INC-'+_0x2f8d20,_0x317973;}router[a0_0x3c7338(0x23c)](a0_0x3c7338(0x2b2),auth,async(_0x2cae3c,_0x202892)=>{var _0xb17c4c=a0_0x3c7338;try{const {username:_0x9f5f9d,email:_0x2e0ddd,role:_0x2aa1b5}=_0x2cae3c[_0xb17c4c(0x2f9)],_0x148435=_0x2cae3c[_0xb17c4c(0x2f9)],_0x4d49b2=await profile['findOne']({'email':_0x148435[_0xb17c4c(0x259)]}),_0x450481=await master_shop['find'](),_0x581fc3=await staff[_0xb17c4c(0x1df)]({'email':_0x148435[_0xb17c4c(0x259)]}),_0x22637c=await suppliers[_0xb17c4c(0x207)]({});let _0x237e3d;if(_0x148435[_0xb17c4c(0x2ea)]==_0xb17c4c(0x21b)){const _0x1140e8=await staff[_0xb17c4c(0x1df)]({'email':_0x148435[_0xb17c4c(0x259)]});_0x237e3d=await warehouse[_0xb17c4c(0x2a8)]([{'$match':{'status':_0xb17c4c(0x2af),'name':_0x1140e8['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xb17c4c(0x2df)}}},{'$group':{'_id':_0xb17c4c(0x27d),'name':{'$first':'$name'}}}]);}else _0x237e3d=await warehouse[_0xb17c4c(0x2a8)]([{'$match':{'status':_0xb17c4c(0x2af),'warehouse_category':_0xb17c4c(0x27f),'name':{'$ne':_0xb17c4c(0x2df)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x37b8a8=await product[_0xb17c4c(0x207)]({}),_0x25f7c5=await warehouse[_0xb17c4c(0x207)]({'status':_0xb17c4c(0x2af)}),_0x4075a6=await purchases[_0xb17c4c(0x207)]({}),_0x3cea99=_0x4075a6[_0xb17c4c(0x296)]+0x1,_0xe4886c='INC-'+_0x3cea99[_0xb17c4c(0x1fb)]()[_0xb17c4c(0x233)](0x5,'0');var _0x535817=[_0xb17c4c(0x1ee),_0xb17c4c(0x217)];if(_0x450481[0x0][_0xb17c4c(0x269)]=='English\x20(US)')var _0x43ff2e=users[_0xb17c4c(0x2fa)];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x243))var _0x43ff2e=users['Hindi'];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x1f8))var _0x43ff2e=users['German'];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x2a4))var _0x43ff2e=users[_0xb17c4c(0x2a4)];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x2f7))var _0x43ff2e=users[_0xb17c4c(0x2f7)];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x202))var _0x43ff2e=users[_0xb17c4c(0x2c5)];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x2cb))var _0x43ff2e=users[_0xb17c4c(0x2cb)];else{if(_0x450481[0x0][_0xb17c4c(0x269)]==_0xb17c4c(0x1ff))var _0x43ff2e=users['Arabic'];}}}}}}}const _0x3187d0=getRandom8DigitNumber();_0x3187d0[_0xb17c4c(0x2a6)](_0x52e853=>{var _0x51ed26=_0xb17c4c;_0x202892[_0x51ed26(0x2f2)](_0x51ed26(0x2eb),{'success':_0x2cae3c['flash'](_0x51ed26(0x2b9)),'errors':_0x2cae3c['flash'](_0x51ed26(0x2b0)),'role':_0x148435,'profile':_0x4d49b2,'suppliers':_0x22637c,'warehouse':_0x237e3d,'product':_0x37b8a8,'invoice':_0x52e853,'master_shop':_0x450481,'language':_0x43ff2e,'find_data':_0x25f7c5,'rooms_data':_0x535817});})['catch'](_0x40d941=>{var _0x106cac=_0xb17c4c;_0x2cae3c['flash'](_0x106cac(0x2b0),_0x106cac(0x29d)),_0x202892[_0x106cac(0x26e)]('/all_purchases/view');});}catch(_0x1ec972){console['log'](_0x1ec972);}}),router[a0_0x3c7338(0x23c)](a0_0x3c7338(0x2c1),auth,async(_0xd9d26d,_0x212769)=>{var _0x36b081=a0_0x3c7338;try{const _0x3cbee5=_0xd9d26d['params']['id'];console['log'](_0x3cbee5);const _0xcce8a7=await master_shop[_0x36b081(0x207)]();console[_0x36b081(0x25b)](_0x36b081(0x20f),_0xcce8a7);const _0x42f33b=await product[_0x36b081(0x1df)]({'name':_0x3cbee5});console[_0x36b081(0x25b)]('product',_0x42f33b),_0x212769['status'](0xc8)[_0x36b081(0x2e1)]({'product_data':_0x42f33b,'master':_0xcce8a7});}catch(_0x2681e6){console[_0x36b081(0x25b)](_0x36b081(0x223),_0x2681e6);}}),router['post'](a0_0x3c7338(0x2b2),auth,async(_0x180276,_0x57fb47)=>{var _0x537cd8=a0_0x3c7338;try{const {invoice:_0x286188,date:_0x38e1c2,warehouse_name:_0x435321,prod_name:_0x3d4572,prod_code:_0x52edc0,prod_qty:_0x5ce110,prod_unit:_0x16067b,prod_secondunit:_0x1eeb87,prod_level:_0x532257,prod_isle:_0xa7d8ed,prod_pallet:_0x3e1084,note:_0x58059e,expiry_date:_0x1ca242,batch_code:_0x5c2244,payable:_0x5e2451,due_amount:_0x3adcc4,Room_name:_0x41f447,primary_code:_0x3393db,secondary_code:_0x5056ac,MaxStocks_data:_0x19e799,PO_number:_0xae50ca,SCRN:_0x10b072,JO_number:_0x2f46a9}=_0x180276[_0x537cd8(0x252)];if(typeof _0x3d4572==_0x537cd8(0x2db))var _0x440849=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x1e1)]],_0x29b63f=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x2e4)]],_0x453a43=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x2b7)]],_0x442a29=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x22a)]],_0x1dbba4=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x242)]],_0x44d619=[_0x180276['body']['prod_level']],_0x207b6b=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x22c)]],_0x273f32=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x21f)]],_0x1f6d35=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x2f1)]],_0x3d4603=[_0x180276['body'][_0x537cd8(0x2dd)]],_0x197d53=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x2a0)]],_0x3520c8=[_0x180276[_0x537cd8(0x252)]['max_product_unit']],_0x10b6bd=[_0x180276['body'][_0x537cd8(0x24e)]],_0x146a49=[_0x180276['body'][_0x537cd8(0x291)]],_0x5d14d0=[_0x180276[_0x537cd8(0x252)]['prod_cat']],_0x1df628=[_0x180276[_0x537cd8(0x252)]['RoomAssign']],_0x1d8a7d=[_0x180276['body']['deliverycode']],_0x37f065=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x20c)]],_0x4752fc=[_0x180276[_0x537cd8(0x252)]['actual_qty']],_0x4458d3=[_0x180276[_0x537cd8(0x252)][_0x537cd8(0x1e0)]];else var _0x440849=[..._0x180276[_0x537cd8(0x252)]['prod_name']],_0x29b63f=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x2e4)]],_0x453a43=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x2b7)]],_0x442a29=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x22a)]],_0x1dbba4=[..._0x180276[_0x537cd8(0x252)]['prod_secondunit']],_0x44d619=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x212)]],_0x207b6b=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x22c)]],_0x273f32=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x21f)]],_0x1f6d35=[..._0x180276['body'][_0x537cd8(0x2f1)]],_0x3d4603=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x2dd)]],_0x197d53=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x2a0)]],_0x3520c8=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x24d)]],_0x10b6bd=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x24e)]],_0x146a49=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x291)]],_0x5d14d0=[..._0x180276[_0x537cd8(0x252)]['prod_cat']],_0x1df628=[..._0x180276[_0x537cd8(0x252)]['RoomAssign']],_0x1d8a7d=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x254)]],_0x37f065=[..._0x180276['body']['prod_invoice']],_0x4752fc=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x28b)]],_0x4458d3=[..._0x180276[_0x537cd8(0x252)][_0x537cd8(0x1e0)]];const _0x8bfcfa=_0x440849[_0x537cd8(0x23b)](_0x5f990e=>{return _0x5f990e={'product_name':_0x5f990e};});_0x4752fc['forEach']((_0x33ec2a,_0x57fbd6)=>{_0x8bfcfa[_0x57fbd6]['actual_qty']=Math['abs'](_0x33ec2a);}),_0x4458d3['forEach']((_0x1cd496,_0x1f2a71)=>{_0x8bfcfa[_0x1f2a71]['actual_uom']=_0x1cd496;}),_0x29b63f[_0x537cd8(0x2f0)]((_0x1f9297,_0x3f3e0b)=>{_0x8bfcfa[_0x3f3e0b]['product_code']=_0x1f9297;}),_0x453a43['forEach']((_0x1f6d3b,_0x48b8d6)=>{var _0x1276e2=_0x537cd8;_0x8bfcfa[_0x48b8d6]['quantity']=Math[_0x1276e2(0x219)](_0x1f6d3b);}),_0x442a29['forEach']((_0x60dba1,_0x3bda27)=>{var _0xff1e3c=_0x537cd8;_0x8bfcfa[_0x3bda27][_0xff1e3c(0x294)]=_0x60dba1;}),_0x1dbba4[_0x537cd8(0x2f0)]((_0x26aab9,_0x40e0b9)=>{var _0x11b6c3=_0x537cd8;_0x8bfcfa[_0x40e0b9][_0x11b6c3(0x1f2)]=_0x26aab9;}),_0x44d619[_0x537cd8(0x2f0)]((_0x2e8d3a,_0x1d9528)=>{var _0x15006d=_0x537cd8;_0x1df628[_0x15006d(0x2f0)]((_0x5c2934,_0x43ff71)=>{var _0x733cc6=_0x15006d;if(_0x5c2934=='Receiving\x20Area'&&_0x1d9528==_0x43ff71){console[_0x733cc6(0x25b)](_0x5c2934+_0x733cc6(0x2bf)+_0x1d9528+_0x733cc6(0x29b)+_0x43ff71+'\x20<>\x20'+_0x2e8d3a);var _0x24f842=_0x2e8d3a[_0x733cc6(0x2e0)](0x3);_0x8bfcfa[_0x1d9528]['storage']=_0x2e8d3a[0x0],_0x8bfcfa[_0x1d9528][_0x733cc6(0x2b4)]=_0x2e8d3a[0x1],_0x8bfcfa[_0x1d9528][_0x733cc6(0x2fc)]=0x0,_0x8bfcfa[_0x1d9528]['bin']=0x0,_0x8bfcfa[_0x1d9528][_0x733cc6(0x2d3)]='Floor',_0x8bfcfa[_0x1d9528][_0x733cc6(0x27a)]=_0x24f842;}else{if(_0x5c2934=='Shelves'&&_0x1d9528==_0x43ff71){var _0x24f842=_0x2e8d3a[_0x733cc6(0x2e0)](0x3);_0x8bfcfa[_0x1d9528]['storage']=_0x2e8d3a[0x0],_0x8bfcfa[_0x1d9528][_0x733cc6(0x2b4)]=_0x2e8d3a[0x1],_0x8bfcfa[_0x1d9528][_0x733cc6(0x2fc)]=0x0,_0x8bfcfa[_0x1d9528][_0x733cc6(0x226)]=0x0,_0x8bfcfa[_0x1d9528]['type']='Floor',_0x8bfcfa[_0x1d9528][_0x733cc6(0x27a)]=_0x2e8d3a[0x5];}else{if(_0x1d9528==_0x43ff71){if(_0x2e8d3a[0x0]=='A'&&_0x2e8d3a[0x1]=='L'&&_0x2e8d3a[0x2]=='L')console[_0x733cc6(0x25b)](_0x5c2934+_0x733cc6(0x29b)+_0x1d9528+_0x733cc6(0x29b)+_0x43ff71+_0x733cc6(0x29b)+_0x2e8d3a+_0x733cc6(0x2e8)),_0x8bfcfa[_0x1d9528][_0x733cc6(0x27c)]=_0x2e8d3a[0x0],_0x8bfcfa[_0x1d9528]['rack']=_0x2e8d3a[0x1],_0x8bfcfa[_0x1d9528][_0x733cc6(0x2fc)]=0x0,_0x8bfcfa[_0x1d9528][_0x733cc6(0x226)]=0x0,_0x8bfcfa[_0x1d9528][_0x733cc6(0x2d3)]=_0x733cc6(0x210),_0x8bfcfa[_0x1d9528][_0x733cc6(0x27a)]=_0x2e8d3a[0x3];else{var _0x39b9f7;if(_0x2e8d3a[0x4]=='L')_0x39b9f7='Level';else _0x2e8d3a[0x4]=='F'&&(_0x39b9f7=_0x733cc6(0x210));_0x8bfcfa[_0x1d9528]['storage']=_0x2e8d3a[0x0],_0x8bfcfa[_0x1d9528][_0x733cc6(0x2b4)]=_0x2e8d3a[0x1],_0x8bfcfa[_0x1d9528]['bay']=_0x2e8d3a[0x2],_0x8bfcfa[_0x1d9528][_0x733cc6(0x226)]=_0x2e8d3a[0x3],_0x8bfcfa[_0x1d9528]['type']=_0x39b9f7,_0x8bfcfa[_0x1d9528][_0x733cc6(0x27a)]=_0x2e8d3a[0x5];}}}}});}),_0x207b6b['forEach']((_0x3af02,_0x3d6b02)=>{var _0x5c73da=_0x537cd8;_0x8bfcfa[_0x3d6b02][_0x5c73da(0x22c)]=_0x3af02;}),_0x273f32['forEach']((_0x13267b,_0x1dcfa8)=>{var _0x42a5e1=_0x537cd8;_0x8bfcfa[_0x1dcfa8][_0x42a5e1(0x21f)]=_0x13267b;}),_0x1f6d35[_0x537cd8(0x2f0)]((_0x11e9e4,_0x575917)=>{var _0x2ab96d=_0x537cd8;_0x8bfcfa[_0x575917][_0x2ab96d(0x206)]=_0x11e9e4;}),_0x3d4603[_0x537cd8(0x2f0)]((_0x2f6d11,_0x554361)=>{_0x8bfcfa[_0x554361]['batch_code']=_0x2f6d11;}),_0x197d53[_0x537cd8(0x2f0)]((_0x4581d8,_0x5dac00)=>{var _0x232a2c=_0x537cd8;_0x8bfcfa[_0x5dac00][_0x232a2c(0x2a0)]=_0x4581d8;}),_0x3520c8[_0x537cd8(0x2f0)]((_0x32a993,_0x24a256)=>{var _0x40e632=_0x537cd8;_0x8bfcfa[_0x24a256][_0x40e632(0x1e5)]=_0x32a993;}),_0x10b6bd[_0x537cd8(0x2f0)]((_0x10b83b,_0x374cff)=>{var _0x4cb038=_0x537cd8;_0x8bfcfa[_0x374cff][_0x4cb038(0x24e)]=_0x10b83b;}),_0x146a49[_0x537cd8(0x2f0)]((_0x32dc5a,_0x3753ae)=>{var _0x29b633=_0x537cd8;_0x8bfcfa[_0x3753ae][_0x29b633(0x291)]=_0x32dc5a;}),_0x5d14d0[_0x537cd8(0x2f0)]((_0x21d2b9,_0x2ab534)=>{_0x8bfcfa[_0x2ab534]['product_cat']=_0x21d2b9;}),_0x1df628[_0x537cd8(0x2f0)]((_0x594456,_0x1f7a70)=>{var _0x237292=_0x537cd8;_0x8bfcfa[_0x1f7a70][_0x237292(0x2a9)]=_0x594456;}),_0x1d8a7d['forEach']((_0x442e06,_0x2df7ee)=>{var _0x489de6=_0x537cd8;_0x8bfcfa[_0x2df7ee][_0x489de6(0x2c8)]=_0x442e06;}),_0x37f065[_0x537cd8(0x2f0)]((_0x36f173,_0x273a26)=>{var _0x3d3b50=_0x537cd8;_0x8bfcfa[_0x273a26][_0x3d3b50(0x2ee)]=_0x36f173;});const _0x908ac9=_0x1df628[_0x537cd8(0x23b)](_0x4d8614=>{return _0x4d8614={'room_name':_0x4d8614};}),_0x506397=_0x8bfcfa[_0x537cd8(0x2ed)](_0x19837f=>_0x19837f['quantity']!=='0'&&_0x19837f[_0x537cd8(0x2cf)]!==''),_0x2917ec=new purchases({'invoice':_0x286188,'suppliers':_0x180276[_0x537cd8(0x252)][_0x537cd8(0x241)],'date':_0x38e1c2,'warehouse_name':_0x435321,'product':_0x506397,'note':_0x58059e,'due_amount':_0x3adcc4,'POnumber':_0xae50ca,'SCRN':_0x10b072,'JO_number':_0x2f46a9,'roomList':_0x908ac9}),_0x2d1748=await _0x2917ec[_0x537cd8(0x1e2)](),_0x29b26a=await purchases['findOne']({'invoice':_0x286188}),_0x185dde=_0x29b26a[_0x537cd8(0x28e)][_0x537cd8(0x23b)](async _0x500a4c=>{var _0x2d0815=_0x537cd8,_0x52ae8f=await warehouse[_0x2d0815(0x1df)]({'name':_0x435321,'room':_0x500a4c[_0x2d0815(0x2a9)]}),_0x3bd168=0x0;return _0x52ae8f[_0x2d0815(0x25d)]['forEach'](_0x207edb=>{var _0x379a2e=_0x2d0815;_0x207edb[_0x379a2e(0x216)]==_0x500a4c[_0x379a2e(0x216)]&&_0x207edb[_0x379a2e(0x27a)]==_0x500a4c[_0x379a2e(0x27a)]&&_0x207edb[_0x379a2e(0x2d3)]==_0x500a4c[_0x379a2e(0x2d3)]&&_0x207edb['bin']==_0x500a4c[_0x379a2e(0x226)]&&_0x207edb[_0x379a2e(0x2fc)]==_0x500a4c[_0x379a2e(0x2fc)]&&_0x207edb['rack']==_0x500a4c['rack']&&_0x207edb[_0x379a2e(0x27c)]==_0x500a4c[_0x379a2e(0x27c)]&&_0x207edb[_0x379a2e(0x2a0)]==_0x500a4c[_0x379a2e(0x2a0)]&&_0x207edb[_0x379a2e(0x2dd)]==_0x500a4c[_0x379a2e(0x2dd)]&&_0x207edb[_0x379a2e(0x291)]==_0x500a4c[_0x379a2e(0x291)]&&_0x207edb[_0x379a2e(0x2ee)]==_0x29b26a[_0x379a2e(0x2ee)]&&(_0x207edb[_0x379a2e(0x2aa)]+=Math['abs'](_0x500a4c[_0x379a2e(0x2cf)]),_0x3bd168++);}),_0x3bd168===0x0&&_0x52ae8f[_0x2d0815(0x25d)][_0x2d0815(0x22d)]({'product_name':_0x500a4c[_0x2d0815(0x216)],'product_stock':Math['abs'](_0x500a4c[_0x2d0815(0x2cf)]),'primary_code':_0x500a4c['primary_code'],'secondary_code':_0x500a4c[_0x2d0815(0x21f)],'product_code':_0x500a4c['product_code'],'storage':_0x500a4c['storage'],'rack':_0x500a4c['rack'],'bay':_0x500a4c[_0x2d0815(0x2fc)],'bin':_0x500a4c[_0x2d0815(0x226)],'type':_0x500a4c[_0x2d0815(0x2d3)],'floorlevel':_0x500a4c[_0x2d0815(0x27a)],'maxProducts':_0x500a4c['maxStocks'],'unit':_0x500a4c[_0x2d0815(0x294)],'secondary_unit':_0x500a4c[_0x2d0815(0x1f2)],'expiry_date':_0x500a4c['expiry_date'],'maxPerUnit':_0x500a4c[_0x2d0815(0x1e5)],'batch_code':_0x500a4c[_0x2d0815(0x2dd)],'alertQTY':_0x500a4c[_0x2d0815(0x24e)],'production_date':_0x500a4c[_0x2d0815(0x291)],'product_cat':_0x500a4c['product_cat'],'invoice':_0x500a4c[_0x2d0815(0x2ee)],'actual_qty':Math[_0x2d0815(0x219)](_0x500a4c['actual_qty']),'actual_uom':_0x500a4c[_0x2d0815(0x1e0)]}),_0x52ae8f;});Promise['all'](_0x185dde)[_0x537cd8(0x2a6)](async _0x482000=>{var _0x5145a1=_0x537cd8;try{for(const _0x323b37 of _0x482000){await _0x323b37[_0x5145a1(0x1e2)]();}const _0x28d24e=await master_shop['find'](),_0x208c1e=await email_settings[_0x5145a1(0x1df)](),_0x5c0529=await supervisor_settings[_0x5145a1(0x207)]();var _0x56751e=_0x29b26a[_0x5145a1(0x28e)],_0x32d003='',_0x49f42f;for(_0x49f42f in _0x56751e){_0x32d003+=_0x5145a1(0x245)+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x216)]+_0x5145a1(0x292)+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x2ad)]+_0x5145a1(0x292)+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x2cf)]+'</td>'+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x294)]+_0x5145a1(0x292)+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x1f2)]+_0x5145a1(0x292)+_0x5145a1(0x261)+_0x29b26a[_0x5145a1(0x213)]+_0x5145a1(0x292)+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x2a9)]+_0x5145a1(0x292)+_0x5145a1(0x261)+_0x56751e[_0x49f42f][_0x5145a1(0x27c)]+_0x56751e[_0x49f42f]['rack']+_0x56751e[_0x49f42f][_0x5145a1(0x2fc)]+_0x56751e[_0x49f42f]['bin']+_0x56751e[_0x49f42f][_0x5145a1(0x2d3)][0x0]+_0x56751e[_0x49f42f]['floorlevel']+_0x5145a1(0x292),_0x5145a1(0x23f);}let _0x28b351=nodemailer[_0x5145a1(0x2dc)]({'host':_0x208c1e[_0x5145a1(0x211)],'port':Number(_0x208c1e[_0x5145a1(0x288)]),'secure':![],'auth':{'user':_0x208c1e[_0x5145a1(0x259)],'pass':_0x208c1e['password']}}),_0x167c2a={'from':_0x208c1e[_0x5145a1(0x259)],'to':_0x5c0529[0x0][_0x5145a1(0x2b3)],'subject':_0x5145a1(0x2e7),'attachments':[{'filename':_0x5145a1(0x282),'path':__dirname+_0x5145a1(0x1e9)+_0x5145a1(0x1f7)+_0x28d24e[0x0]['image'],'cid':_0x5145a1(0x22e)}],'html':'<!DOCTYPE\x20html>'+_0x5145a1(0x2c4)+_0x5145a1(0x2ab)+_0x5145a1(0x1e8)+_0x5145a1(0x264)+_0x5145a1(0x1e8)+_0x5145a1(0x2c6)+_0x5145a1(0x257)+_0x5145a1(0x1e8)+_0x5145a1(0x287)+_0x28d24e[0x0][_0x5145a1(0x2a5)]+_0x5145a1(0x27b)+'</div>'+'</div>'+_0x5145a1(0x2f4)+_0x5145a1(0x1e8)+_0x5145a1(0x235)+_0x5145a1(0x24b)+_0x29b26a['invoice']+'\x20'+_0x5145a1(0x272)+_0x5145a1(0x297)+_0x29b26a[_0x5145a1(0x21c)]+'\x20'+'</span>'+_0x5145a1(0x234)+'</div>'+_0x5145a1(0x1f5)+_0x5145a1(0x265)+_0x5145a1(0x245)+_0x5145a1(0x2fe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5145a1(0x221)+_0x5145a1(0x21a)+_0x5145a1(0x22f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x5145a1(0x2d8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5145a1(0x23f)+_0x5145a1(0x298)+_0x5145a1(0x1e6)+'\x20'+_0x32d003+'\x20'+_0x5145a1(0x209)+_0x5145a1(0x2bd)+_0x5145a1(0x1e8)+_0x5145a1(0x2d7)+'<h5>'+_0x28d24e[0x0][_0x5145a1(0x2a5)]+_0x5145a1(0x234)+_0x5145a1(0x257)+_0x5145a1(0x257)+_0x5145a1(0x21e)};_0x28b351[_0x5145a1(0x273)](_0x167c2a,function(_0x3a984e,_0x58f495){var _0x2c89bd=_0x5145a1;_0x3a984e?(console['log'](_0x3a984e),console[_0x2c89bd(0x25b)]('Error\x20Occurs')):console[_0x2c89bd(0x25b)](_0x2c89bd(0x260));}),_0x180276['flash']('success','Purchase\x20data\x20added\x20successfully'),_0x57fb47[_0x5145a1(0x26e)]('/all_purchases/view/');}catch(_0x348112){console['error'](_0x348112),_0x57fb47['status'](0x1f4)['json']({'error':_0x5145a1(0x2e9)});}})['catch'](_0x1e1aea=>{var _0xb24333=_0x537cd8;console[_0xb24333(0x24f)](_0x1e1aea),_0x57fb47['status'](0x1f4)[_0xb24333(0x2e1)]({'error':_0xb24333(0x2e3)});});}catch(_0x1ef335){console[_0x537cd8(0x25b)](_0x1ef335);}}),router[a0_0x3c7338(0x23c)](a0_0x3c7338(0x214),auth,async(_0x2f3653,_0x3fb1d6)=>{var _0x19f974=a0_0x3c7338;try{const {username:_0x1cf8aa,email:_0x4120b3,role:_0x36e3d1}=_0x2f3653['user'],_0x2bb2f9=_0x2f3653[_0x19f974(0x2f9)],_0x34bc7f=await profile[_0x19f974(0x1df)]({'email':_0x2bb2f9[_0x19f974(0x259)]}),_0x444942=await master_shop[_0x19f974(0x207)](),_0xd5ef38=_0x2f3653[_0x19f974(0x24a)]['id'],_0x346eae=await purchases[_0x19f974(0x2a1)](_0xd5ef38),_0x3b91ae=await warehouse['aggregate']([{'$match':{'name':_0x346eae[_0x19f974(0x213)],'room':_0x346eae[_0x19f974(0x249)]}},{'$unwind':_0x19f974(0x2c3)},{'$group':{'_id':_0x19f974(0x2c2),'name':{'$first':_0x19f974(0x239)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x19f974(0x238)},'bin':{'$first':_0x19f974(0x240)},'type':{'$first':_0x19f974(0x218)},'floorlevel':{'$first':_0x19f974(0x274)},'primary_code':{'$first':_0x19f974(0x301)},'secondary_code':{'$first':_0x19f974(0x263)},'product_code':{'$first':_0x19f974(0x2ec)},'storage':{'$first':_0x19f974(0x2b8)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x19f974(0x29f)}}}]),_0x42b22c=await customer[_0x19f974(0x207)]({});let _0x512de7;if(_0x2bb2f9[_0x19f974(0x2ea)]=='staff'){const _0x324757=await staff[_0x19f974(0x1df)]({'email':_0x2bb2f9[_0x19f974(0x259)]});_0x512de7=await warehouse[_0x19f974(0x2a8)]([{'$match':{'status':_0x19f974(0x2af),'name':_0x324757[_0x19f974(0x279)]}},{'$group':{'_id':_0x19f974(0x27d),'name':{'$first':'$name'}}}]);}else _0x512de7=await warehouse[_0x19f974(0x2a8)]([{'$match':{'status':_0x19f974(0x2af)}},{'$group':{'_id':_0x19f974(0x27d),'name':{'$first':_0x19f974(0x27d)}}}]);const _0x417f29=await product['find']({}),_0x1d3936=await suppliers['find']({}),_0x243a52=BayBinSelected(_0x346eae[_0x19f974(0x213)],_0x346eae['room']);if(_0x444942[0x0]['language']==_0x19f974(0x20e)){var _0x532dc7=users[_0x19f974(0x2fa)];console[_0x19f974(0x25b)](_0x532dc7);}else{if(_0x444942[0x0][_0x19f974(0x269)]==_0x19f974(0x243))var _0x532dc7=users[_0x19f974(0x243)];else{if(_0x444942[0x0][_0x19f974(0x269)]==_0x19f974(0x1f8))var _0x532dc7=users[_0x19f974(0x1f8)];else{if(_0x444942[0x0]['language']==_0x19f974(0x2a4))var _0x532dc7=users[_0x19f974(0x2a4)];else{if(_0x444942[0x0][_0x19f974(0x269)]=='French')var _0x532dc7=users['French'];else{if(_0x444942[0x0][_0x19f974(0x269)]==_0x19f974(0x202))var _0x532dc7=users[_0x19f974(0x2c5)];else{if(_0x444942[0x0]['language']==_0x19f974(0x2cb))var _0x532dc7=users[_0x19f974(0x2cb)];else{if(_0x444942[0x0][_0x19f974(0x269)]=='Arabic\x20(ae)')var _0x532dc7=users['Arabic'];}}}}}}}_0x3fb1d6[_0x19f974(0x2f2)](_0x19f974(0x1fe),{'success':_0x2f3653['flash'](_0x19f974(0x2b9)),'errors':_0x2f3653[_0x19f974(0x1eb)](_0x19f974(0x2b0)),'role':_0x2bb2f9,'profile':_0x34bc7f,'customer':_0x42b22c,'warehouse':_0x512de7,'product':_0x3b91ae,'user':_0x346eae,'master_shop':_0x444942,'unit':_0x417f29,'language':_0x532dc7,'suppliers':_0x1d3936,'dataSelected':_0x243a52});}catch(_0x4379d2){console[_0x19f974(0x25b)](_0x4379d2);}}),router[a0_0x3c7338(0x20d)]('/preview/:id',auth,async(_0x29ec00,_0x48aa95)=>{var _0x3f0436=a0_0x3c7338;try{const _0x56c8e8=_0x29ec00[_0x3f0436(0x24a)]['id'],{invoice:_0x5a46ae,warehouse_name:_0x5470df,Room_name:_0x26886e}=_0x29ec00[_0x3f0436(0x252)],_0x1a3477=await warehouse[_0x3f0436(0x1df)]({'name':_0x5470df,'room':_0x26886e}),_0xc70288=await purchases[_0x3f0436(0x1df)]({'invoice':_0x5a46ae});_0xc70288['product']['forEach'](_0x3298c8=>{var _0x34ee5c=_0x3f0436,_0x6cd24d=0x0;const _0x131c2b=_0x1a3477['product_details']['map'](_0x5d7e95=>{var _0x52568c=a0_0x1a9d;_0x5d7e95[_0x52568c(0x216)]==_0x3298c8[_0x52568c(0x216)]&&_0x5d7e95['floorlevel']==_0x3298c8['floorlevel']&&_0x5d7e95['type']==_0x3298c8[_0x52568c(0x2d3)]&&_0x5d7e95['bin']==_0x3298c8['bin']&&_0x5d7e95[_0x52568c(0x2fc)]==_0x3298c8[_0x52568c(0x2fc)]&&_0x5d7e95[_0x52568c(0x2b4)]==_0x3298c8[_0x52568c(0x2b4)]&&_0x5d7e95[_0x52568c(0x27c)]==_0x3298c8[_0x52568c(0x27c)]&&_0x5d7e95['expiry_date']==_0x3298c8[_0x52568c(0x2a0)]&&_0x5d7e95[_0x52568c(0x2dd)]==_0x3298c8[_0x52568c(0x2dd)]&&_0x5d7e95['production_date']==_0x3298c8[_0x52568c(0x291)]&&_0x5d7e95[_0x52568c(0x20a)]==_0x3298c8[_0x52568c(0x20a)]&&_0x5d7e95[_0x52568c(0x2c8)]==_0x3298c8[_0x52568c(0x2c8)]&&(_0x5d7e95['product_stock']=parseInt(_0x5d7e95['product_stock'])+parseInt(_0x3298c8[_0x52568c(0x2cf)]),_0x6cd24d++);});_0x6cd24d=='0'&&(_0x1a3477['product_details']=_0x1a3477['product_details']['concat']({'product_name':_0x3298c8['product_name'],'product_stock':_0x3298c8[_0x34ee5c(0x2cf)],'primary_code':_0x3298c8['primary_code'],'secondary_code':_0x3298c8[_0x34ee5c(0x21f)],'product_code':_0x3298c8[_0x34ee5c(0x2ad)],'storage':_0x3298c8[_0x34ee5c(0x27c)],'rack':_0x3298c8[_0x34ee5c(0x2b4)],'bay':_0x3298c8[_0x34ee5c(0x2fc)],'bin':_0x3298c8[_0x34ee5c(0x226)],'type':_0x3298c8[_0x34ee5c(0x2d3)],'floorlevel':_0x3298c8[_0x34ee5c(0x27a)],'maxProducts':_0x3298c8[_0x34ee5c(0x206)],'unit':_0x3298c8[_0x34ee5c(0x294)],'secondary_unit':_0x3298c8[_0x34ee5c(0x1f2)],'expiry_date':_0x3298c8[_0x34ee5c(0x2a0)],'maxPerUnit':_0x3298c8[_0x34ee5c(0x1e5)],'batch_code':_0x3298c8['batch_code'],'alertQTY':_0x3298c8[_0x34ee5c(0x24e)],'production_date':_0x3298c8[_0x34ee5c(0x291)],'delivery_date':_0x3298c8[_0x34ee5c(0x20a)],'delivery_code':_0x3298c8[_0x34ee5c(0x2c8)]}));}),await _0x1a3477[_0x3f0436(0x1e2)](),_0xc70288[_0x3f0436(0x2ba)]=_0x3f0436(0x24c);const _0x4cda67=await _0xc70288[_0x3f0436(0x1e2)]();_0x29ec00[_0x3f0436(0x1eb)](_0x3f0436(0x2b9),_0x3f0436(0x2f5)),_0x48aa95[_0x3f0436(0x26e)](_0x3f0436(0x244));}catch(_0x120457){console[_0x3f0436(0x25b)](_0x120457);}}),router[a0_0x3c7338(0x23c)]('/view/:id',auth,async(_0x33a2b5,_0x31f77c)=>{var _0x54e37f=a0_0x3c7338;try{const {username:_0x567504,email:_0x87bbcf,role:_0xc0cd09}=_0x33a2b5[_0x54e37f(0x2f9)],_0x3bb4aa=_0x33a2b5[_0x54e37f(0x2f9)],_0x4f37c6=await profile['findOne']({'email':_0x3bb4aa[_0x54e37f(0x259)]}),_0x24068f=await master_shop['find'](),_0x2a6b3a=_0x33a2b5['params']['id'],_0x569e2f=await purchases[_0x54e37f(0x2a1)](_0x2a6b3a),_0x4e242e=await suppliers[_0x54e37f(0x207)]({});let _0x411f99;if(_0x3bb4aa[_0x54e37f(0x2ea)]==_0x54e37f(0x21b)){const _0x2fa073=await staff[_0x54e37f(0x1df)]({'email':_0x3bb4aa[_0x54e37f(0x259)]});_0x411f99=await warehouse['find']({'status':_0x54e37f(0x2af),'name':_0x2fa073[_0x54e37f(0x279)],'warehouse_category':_0x54e37f(0x27f)});}else _0x411f99=await warehouse['aggregate']([{'$match':{'status':_0x54e37f(0x2af),'warehouse_category':_0x54e37f(0x27f)}},{'$group':{'_id':_0x54e37f(0x27d),'name':{'$first':_0x54e37f(0x27d)}}}]);const _0x37ea04=await product[_0x54e37f(0x207)]({}),_0x20b876=BayBinSelected(_0x569e2f['warehouse_name'],_0x569e2f[_0x54e37f(0x249)]);let _0x10c397=new Date(_0x569e2f[_0x54e37f(0x2a0)]),_0x5071ef=('0'+_0x10c397[_0x54e37f(0x2fb)]())[_0x54e37f(0x2e0)](-0x2),_0x1daa65=('0'+(_0x10c397[_0x54e37f(0x220)]()+0x1))[_0x54e37f(0x2e0)](-0x2),_0x557f4d=_0x10c397[_0x54e37f(0x20b)](),_0x30f8fb=_0x557f4d+'-'+_0x1daa65+'-'+_0x5071ef;if(_0x24068f[0x0][_0x54e37f(0x269)]==_0x54e37f(0x20e)){var _0x29baf3=users[_0x54e37f(0x2fa)];console['log'](_0x29baf3);}else{if(_0x24068f[0x0][_0x54e37f(0x269)]==_0x54e37f(0x243))var _0x29baf3=users[_0x54e37f(0x243)];else{if(_0x24068f[0x0]['language']==_0x54e37f(0x1f8))var _0x29baf3=users[_0x54e37f(0x1f8)];else{if(_0x24068f[0x0]['language']==_0x54e37f(0x2a4))var _0x29baf3=users['Spanish'];else{if(_0x24068f[0x0][_0x54e37f(0x269)]==_0x54e37f(0x2f7))var _0x29baf3=users[_0x54e37f(0x2f7)];else{if(_0x24068f[0x0][_0x54e37f(0x269)]==_0x54e37f(0x202))var _0x29baf3=users[_0x54e37f(0x2c5)];else{if(_0x24068f[0x0][_0x54e37f(0x269)]==_0x54e37f(0x2cb))var _0x29baf3=users['Chinese'];else{if(_0x24068f[0x0]['language']=='Arabic\x20(ae)')var _0x29baf3=users[_0x54e37f(0x2cc)];}}}}}}}_0x31f77c[_0x54e37f(0x2f2)](_0x54e37f(0x2f6),{'success':_0x33a2b5[_0x54e37f(0x1eb)](_0x54e37f(0x2b9)),'errors':_0x33a2b5[_0x54e37f(0x1eb)](_0x54e37f(0x2b0)),'role':_0x3bb4aa,'profile':_0x4f37c6,'purchases':_0x569e2f,'suppliers':_0x4e242e,'warehouse':_0x411f99,'product':_0x37ea04,'master_shop':_0x24068f,'language':_0x29baf3,'ed_fullDate':_0x30f8fb,'dataSelected':_0x20b876});}catch(_0x1412bf){console[_0x54e37f(0x25b)](_0x1412bf);}}),router[a0_0x3c7338(0x20d)](a0_0x3c7338(0x1ed),auth,async(_0x4512e3,_0xd1fa3e)=>{var _0x2788fd=a0_0x3c7338;try{const _0x105665=_0x4512e3[_0x2788fd(0x24a)]['id'],_0x47af7a=await purchases[_0x2788fd(0x1df)]({'_id':_0x4512e3[_0x2788fd(0x24a)]['id']}),_0x992470=await warehouse[_0x2788fd(0x1df)]({'name':_0x47af7a[_0x2788fd(0x213)],'room':_0x47af7a[_0x2788fd(0x249)]});_0x47af7a[_0x2788fd(0x28e)]['forEach'](_0x4ac2dc=>{var _0x13cf38=_0x2788fd;const _0x4215c5=_0x992470[_0x13cf38(0x25d)][_0x13cf38(0x23b)](_0xde056b=>{var _0x17b406=_0x13cf38;_0xde056b[_0x17b406(0x216)]==_0x4ac2dc[_0x17b406(0x216)]&&_0xde056b[_0x17b406(0x27a)]==_0x4ac2dc[_0x17b406(0x27a)]&&_0xde056b['type']==_0x4ac2dc[_0x17b406(0x2d3)]&&_0xde056b[_0x17b406(0x226)]==_0x4ac2dc[_0x17b406(0x226)]&&_0xde056b[_0x17b406(0x2fc)]==_0x4ac2dc[_0x17b406(0x2fc)]&&_0xde056b['rack']==_0x4ac2dc[_0x17b406(0x2b4)]&&_0xde056b[_0x17b406(0x27c)]==_0x4ac2dc[_0x17b406(0x27c)]&&(_0xde056b[_0x17b406(0x2aa)]=parseInt(_0xde056b[_0x17b406(0x2aa)])-parseInt(_0x4ac2dc[_0x17b406(0x2cf)]));});}),await _0x992470[_0x2788fd(0x1e2)]();const {invoice:_0x2f3caf,suppliers:_0x33b170,date:_0x2823f6,warehouse_name:_0x2316d3,prod_name:_0x5baed2,prod_code:_0x47b2f8,prod_qty:_0xf24a9f,prod_unit:_0x349520,prod_secondunit:_0x276afe,prod_level:_0x1a12cf,prod_isle:_0x3ad234,prod_pallet:_0x2ba674,note:_0x3ac728,expiry_date:_0xa9691d,batch_code:_0x350f38,paid_amount:_0x481709,due_amount:_0x5693a5,Room_name:_0x7a1d6f,primary_code:_0x1b3ca4,secondary_code:_0x4cc7fc,PO_number:_0x3de999,JO_number:_0x5a35dd}=_0x4512e3[_0x2788fd(0x252)];if(typeof _0x5baed2==_0x2788fd(0x2db))var _0x4b2d99=[_0x4512e3['body'][_0x2788fd(0x1e1)]],_0x446176=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2e4)]],_0x27a8ed=[_0x4512e3[_0x2788fd(0x252)]['prod_qty']],_0x42b0f5=[_0x4512e3[_0x2788fd(0x252)]['prod_unit']],_0x485d5f=[_0x4512e3['body'][_0x2788fd(0x242)]],_0x46801b=[_0x4512e3['body'][_0x2788fd(0x212)]],_0x54333d=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x228)]],_0x28be6d=[_0x4512e3[_0x2788fd(0x252)]['prod_pallet']],_0x16a695=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x22c)]],_0x4b7da5=[_0x4512e3[_0x2788fd(0x252)]['secondary_code']],_0xa8f205=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2f1)]],_0x5bdde0=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2dd)]],_0x48a634=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2a0)]],_0x185796=[_0x4512e3[_0x2788fd(0x252)]['storage']],_0x344cec=[_0x4512e3['body'][_0x2788fd(0x2ca)]],_0x50929a=[_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2d3)]];else var _0x4b2d99=[..._0x4512e3[_0x2788fd(0x252)]['prod_name']],_0x446176=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2e4)]],_0x27a8ed=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x1f6)]],_0x42b0f5=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x1e4)]],_0x485d5f=[..._0x4512e3['body']['prod_secondunit']],_0x46801b=[..._0x4512e3['body'][_0x2788fd(0x212)]],_0x54333d=[..._0x4512e3['body']['prod_isle']],_0x28be6d=[..._0x4512e3['body'][_0x2788fd(0x2d6)]],_0x16a695=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x22c)]],_0x4b7da5=[..._0x4512e3[_0x2788fd(0x252)]['secondary_code']],_0xa8f205=[..._0x4512e3['body'][_0x2788fd(0x2f1)]],_0x5bdde0=[..._0x4512e3['body'][_0x2788fd(0x2dd)]],_0x48a634=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2a0)]],_0x185796=[..._0x4512e3['body'][_0x2788fd(0x27c)]],_0x344cec=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2ca)]],_0x50929a=[..._0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2d3)]];const _0x2c2870=_0x4b2d99[_0x2788fd(0x23b)](_0x170fb5=>{return _0x170fb5={'product_name':_0x170fb5};});_0x446176[_0x2788fd(0x2f0)]((_0x31f2f3,_0x37a778)=>{_0x2c2870[_0x37a778]['product_code']=_0x31f2f3;}),_0x27a8ed[_0x2788fd(0x2f0)]((_0x1fe3f7,_0x3f07cf)=>{var _0x6dcfa5=_0x2788fd;_0x2c2870[_0x3f07cf][_0x6dcfa5(0x2cf)]=_0x1fe3f7;}),_0x42b0f5[_0x2788fd(0x2f0)]((_0x45412c,_0x491091)=>{var _0x3c6dd3=_0x2788fd;_0x2c2870[_0x491091][_0x3c6dd3(0x294)]=_0x45412c;}),_0x485d5f[_0x2788fd(0x2f0)]((_0x4cff8a,_0x139b65)=>{var _0x1c907a=_0x2788fd;_0x2c2870[_0x139b65][_0x1c907a(0x1f2)]=_0x4cff8a;}),_0x46801b['forEach']((_0x2b0129,_0x3bdc5b)=>{var _0xb3f2f6=_0x2788fd;_0x2c2870[_0x3bdc5b][_0xb3f2f6(0x2fc)]=_0x2b0129;}),_0x54333d['forEach']((_0x1d0c2c,_0x46d778)=>{var _0x3ea833=_0x2788fd;_0x2c2870[_0x46d778][_0x3ea833(0x226)]=_0x1d0c2c;}),_0x28be6d[_0x2788fd(0x2f0)]((_0x334d8e,_0x5a65a0)=>{var _0x2764c0=_0x2788fd;_0x2c2870[_0x5a65a0][_0x2764c0(0x27a)]=_0x334d8e;}),_0x16a695['forEach']((_0x14e216,_0x30dfdf)=>{var _0x393572=_0x2788fd;_0x2c2870[_0x30dfdf][_0x393572(0x22c)]=_0x14e216;}),_0x4b7da5[_0x2788fd(0x2f0)]((_0x2e34ff,_0x3b328a)=>{var _0x4a12cf=_0x2788fd;_0x2c2870[_0x3b328a][_0x4a12cf(0x21f)]=_0x2e34ff;}),_0xa8f205[_0x2788fd(0x2f0)]((_0x177d78,_0x12275e)=>{_0x2c2870[_0x12275e]['maxStocks']=_0x177d78;}),_0x5bdde0[_0x2788fd(0x2f0)]((_0x1490ed,_0x379f0a)=>{_0x2c2870[_0x379f0a]['batch_code']=_0x1490ed;}),_0x48a634[_0x2788fd(0x2f0)]((_0x3374a5,_0x1fd1ef)=>{var _0x4c3bf1=_0x2788fd;_0x2c2870[_0x1fd1ef][_0x4c3bf1(0x2a0)]=_0x3374a5;}),_0x50929a[_0x2788fd(0x2f0)]((_0xb93946,_0x495a67)=>{_0x2c2870[_0x495a67]['type']=_0xb93946;}),_0x185796['forEach']((_0x89a852,_0x3055b8)=>{_0x2c2870[_0x3055b8]['storage']=_0x89a852;}),_0x344cec[_0x2788fd(0x2f0)]((_0xa8f564,_0xc6e208)=>{var _0x4502d8=_0x2788fd;_0x2c2870[_0xc6e208][_0x4502d8(0x2b4)]=_0xa8f564;});const _0x25490c=_0x2c2870[_0x2788fd(0x2ed)](_0x19f53d=>_0x19f53d[_0x2788fd(0x2cf)]!=='0'&&_0x19f53d[_0x2788fd(0x2cf)]!=='');_0x47af7a[_0x2788fd(0x2ee)]=_0x2f3caf,_0x47af7a[_0x2788fd(0x241)]=_0x33b170,_0x47af7a[_0x2788fd(0x21c)]=_0x2823f6,_0x47af7a['warehouse_name']=_0x2316d3,_0x47af7a[_0x2788fd(0x28e)]=_0x25490c,_0x47af7a[_0x2788fd(0x2cd)]=_0x3ac728,_0x47af7a[_0x2788fd(0x237)]=_0x481709,_0x47af7a['due_amount']=_0x5693a5,_0x47af7a[_0x2788fd(0x249)]=_0x7a1d6f,_0x47af7a[_0x2788fd(0x22b)]=_0x3de999,_0x47af7a[_0x2788fd(0x25e)]=_0x5a35dd;const _0x2c1dd9=await _0x47af7a['save'](),_0x38d568=await warehouse[_0x2788fd(0x1df)]({'name':_0x4512e3['body'][_0x2788fd(0x213)],'room':_0x4512e3[_0x2788fd(0x252)]['Room_name']});_0x47af7a[_0x2788fd(0x28e)][_0x2788fd(0x2f0)](_0x18f6bf=>{var _0x53c5a=_0x2788fd,_0x4ad82c=0x0;const _0x28b176=_0x38d568[_0x53c5a(0x25d)][_0x53c5a(0x23b)](_0x2dcd22=>{var _0x3fa380=_0x53c5a;_0x2dcd22['product_name']==_0x18f6bf['product_name']&&_0x2dcd22[_0x3fa380(0x27a)]==_0x18f6bf[_0x3fa380(0x27a)]&&_0x2dcd22['type']==_0x18f6bf['type']&&_0x2dcd22[_0x3fa380(0x226)]==_0x18f6bf[_0x3fa380(0x226)]&&_0x2dcd22[_0x3fa380(0x2fc)]==_0x18f6bf[_0x3fa380(0x2fc)]&&_0x2dcd22[_0x3fa380(0x2b4)]==_0x18f6bf[_0x3fa380(0x2b4)]&&_0x2dcd22[_0x3fa380(0x27c)]==_0x18f6bf['storage']&&(_0x2dcd22[_0x3fa380(0x2aa)]=parseInt(_0x2dcd22[_0x3fa380(0x2aa)])+parseInt(_0x18f6bf[_0x3fa380(0x2cf)]),_0x4ad82c++);});_0x4ad82c=='0'&&(_0x38d568[_0x53c5a(0x25d)]=_0x38d568['product_details'][_0x53c5a(0x258)]({'product_name':_0x18f6bf[_0x53c5a(0x216)],'product_stock':_0x18f6bf[_0x53c5a(0x2cf)],'primary_code':_0x18f6bf[_0x53c5a(0x22c)],'secondary_code':_0x18f6bf['secondary_code'],'product_code':_0x18f6bf[_0x53c5a(0x2ad)],'storage':_0x18f6bf[_0x53c5a(0x27c)],'rack':_0x18f6bf['rack'],'bay':_0x18f6bf[_0x53c5a(0x2fc)],'bin':_0x18f6bf[_0x53c5a(0x226)],'type':_0x18f6bf[_0x53c5a(0x2d3)],'floorlevel':_0x18f6bf[_0x53c5a(0x27a)],'maxProducts':_0x18f6bf['maxStocks'],'unit':_0x18f6bf[_0x53c5a(0x294)],'secondary_unit':_0x18f6bf[_0x53c5a(0x1f2)],'expiry_date':_0x18f6bf[_0x53c5a(0x2a0)]}));}),await _0x38d568['save']();const _0x3dea0f=await s_payment_data[_0x2788fd(0x1df)]({'invoice':_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2ee)]});if(_0x3dea0f===null){}else console[_0x2788fd(0x25b)](_0x2788fd(0x241),_0x3dea0f,_0x4512e3[_0x2788fd(0x252)][_0x2788fd(0x2ee)]),_0x3dea0f[_0x2788fd(0x241)]=_0x4512e3['body']['suppliers'],await _0x3dea0f[_0x2788fd(0x1e2)]();_0x4512e3[_0x2788fd(0x1eb)](_0x2788fd(0x2b9),_0x2788fd(0x204)),_0xd1fa3e['redirect'](_0x2788fd(0x244));}catch(_0x784413){console[_0x2788fd(0x25b)](_0x784413);}}),router[a0_0x3c7338(0x20d)](a0_0x3c7338(0x208),auth,async(_0x268d96,_0x3c44f6)=>{var _0x1eb856=a0_0x3c7338;try{const _0x308ae7=_0x268d96[_0x1eb856(0x24a)]['id'],{invoice:_0xdbfef0,suppliers:_0x281c1c,payable:_0x5cf1e5,due_amount:_0xa564d4}=_0x268d96[_0x1eb856(0x252)],_0x1c2806=await purchases[_0x1eb856(0x2a1)](_0x308ae7);var _0x434e34=_0x5cf1e5-_0xa564d4;_0x1c2806[_0x1eb856(0x237)]=parseFloat(_0x1c2806['paid_amount'])+parseFloat(_0xa564d4),_0x1c2806[_0x1eb856(0x299)]=_0x434e34;const _0x1125cd=await _0x1c2806[_0x1eb856(0x1e2)]();console[_0x1eb856(0x25b)](_0x1125cd);const _0x267c4e=await s_payment_data[_0x1eb856(0x1df)]({'invoice':_0xdbfef0});_0x267c4e['amount']=_0x434e34,await _0x267c4e[_0x1eb856(0x1e2)]();let _0x3c5a8b=new Date(),_0x358c05=('0'+_0x3c5a8b[_0x1eb856(0x2fb)]())[_0x1eb856(0x2e0)](-0x2),_0x3ab3cc=('0'+(_0x3c5a8b['getMonth']()+0x1))[_0x1eb856(0x2e0)](-0x2),_0x2aefb4=_0x3c5a8b['getFullYear'](),_0x374cb2=_0x2aefb4+'-'+_0x3ab3cc+'-'+_0x358c05;const _0x4c48a7=new suppliers_payment({'invoice':_0xdbfef0,'date':_0x2aefb4+'-'+_0x3ab3cc+'-'+_0x358c05,'suppliers':_0x281c1c,'reason':_0x1eb856(0x26b),'amount':_0xa564d4}),_0x1656af=await _0x4c48a7[_0x1eb856(0x1e2)]();_0x268d96[_0x1eb856(0x1eb)]('success',_0x1eb856(0x250)),_0x3c44f6[_0x1eb856(0x26e)](_0x1eb856(0x244));}catch(_0x521ffb){console['log'](_0x521ffb);}}),router['get'](a0_0x3c7338(0x215),auth,async(_0x2f7bc0,_0x1504a4)=>{var _0x25e1e4=a0_0x3c7338;try{const {username:_0x1f9863,email:_0x2e2c27,role:_0x5546e1}=_0x2f7bc0[_0x25e1e4(0x2f9)],_0x2fdc66=_0x2f7bc0[_0x25e1e4(0x2f9)],_0x2088d5=await profile['findOne']({'email':_0x2fdc66['email']}),_0x2b76a9=await master_shop['find']();console[_0x25e1e4(0x25b)](_0x25e1e4(0x20f),_0x2b76a9);const _0x2b1891=_0x2f7bc0[_0x25e1e4(0x24a)]['id'],_0x3f3711=await purchases[_0x25e1e4(0x2a1)](_0x2b1891);console[_0x25e1e4(0x25b)](_0x3f3711);const _0x4534d8=await suppliers[_0x25e1e4(0x1df)]({'name':_0x3f3711[_0x25e1e4(0x241)]});console[_0x25e1e4(0x25b)](_0x4534d8);if(_0x2b76a9[0x0][_0x25e1e4(0x269)]==_0x25e1e4(0x20e)){var _0x59380f=users[_0x25e1e4(0x2fa)];console['log'](_0x59380f);}else{if(_0x2b76a9[0x0][_0x25e1e4(0x269)]==_0x25e1e4(0x243))var _0x59380f=users[_0x25e1e4(0x243)];else{if(_0x2b76a9[0x0]['language']=='German')var _0x59380f=users[_0x25e1e4(0x1f8)];else{if(_0x2b76a9[0x0][_0x25e1e4(0x269)]==_0x25e1e4(0x2a4))var _0x59380f=users[_0x25e1e4(0x2a4)];else{if(_0x2b76a9[0x0][_0x25e1e4(0x269)]==_0x25e1e4(0x2f7))var _0x59380f=users[_0x25e1e4(0x2f7)];else{if(_0x2b76a9[0x0]['language']==_0x25e1e4(0x202))var _0x59380f=users['Portuguese'];else{if(_0x2b76a9[0x0][_0x25e1e4(0x269)]==_0x25e1e4(0x2cb))var _0x59380f=users[_0x25e1e4(0x2cb)];else{if(_0x2b76a9[0x0][_0x25e1e4(0x269)]=='Arabic\x20(ae)')var _0x59380f=users['Arabic'];}}}}}}}_0x1504a4['render'](_0x25e1e4(0x230),{'success':_0x2f7bc0['flash']('success'),'errors':_0x2f7bc0[_0x25e1e4(0x1eb)](_0x25e1e4(0x2b0)),'role':_0x2fdc66,'profile':_0x2088d5,'master_shop':_0x2b76a9,'supplier':_0x4534d8,'purchase':_0x3f3711,'language':_0x59380f});}catch(_0x9e0b0f){console[_0x25e1e4(0x25b)](_0x9e0b0f);}}),router['get']('/view/return_purchase/:id',auth,async(_0x183d80,_0x17e011)=>{var _0x582b20=a0_0x3c7338;try{const {username:_0x4c8c22,email:_0x5876b0,role:_0x14a1c4}=_0x183d80[_0x582b20(0x2f9)],_0x30b34b=_0x183d80[_0x582b20(0x2f9)],_0xc89338=await profile[_0x582b20(0x1df)]({'email':_0x30b34b['email']}),_0x54417d=await master_shop['find']();console['log'](_0x582b20(0x20f),_0x54417d);const _0x553ffd=_0x183d80['params']['id'];console[_0x582b20(0x25b)](_0x553ffd);const _0x183bac=await purchases['findById'](_0x553ffd);console[_0x582b20(0x25b)](_0x582b20(0x2c0),_0x183bac);const _0x50fde9=await product[_0x582b20(0x207)]({}),_0x9e0a49=await warehouse[_0x582b20(0x2a8)]([{'$match':{'name':_0x183bac[_0x582b20(0x213)],'room':_0x183bac[_0x582b20(0x249)],'warehouse_category':_0x582b20(0x27f)}},{'$unwind':_0x582b20(0x2c3)},{'$group':{'_id':_0x582b20(0x2c2),'name':{'$first':_0x582b20(0x239)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x582b20(0x301)},'secondary_code':{'$first':_0x582b20(0x263)},'product_code':{'$first':_0x582b20(0x2ec)},'storage':{'$first':_0x582b20(0x2b8)},'rack':{'$first':_0x582b20(0x2f3)}}}]);warehouse_data=await warehouse[_0x582b20(0x2a8)]([{'$match':{'status':_0x582b20(0x2af),'name':_0x582b20(0x2df),'warehouse_category':_0x582b20(0x27f)}},{'$group':{'_id':_0x582b20(0x27d),'name':{'$first':_0x582b20(0x27d)}}},{'$sort':{'name':0x1}}]),console[_0x582b20(0x25b)]('stock_data',_0x9e0a49);if(_0x54417d[0x0][_0x582b20(0x269)]==_0x582b20(0x20e)){var _0x3a39e0=users['English'];console['log'](_0x3a39e0);}else{if(_0x54417d[0x0][_0x582b20(0x269)]=='Hindi')var _0x3a39e0=users[_0x582b20(0x243)];else{if(_0x54417d[0x0][_0x582b20(0x269)]=='German')var _0x3a39e0=users[_0x582b20(0x1f8)];else{if(_0x54417d[0x0]['language']==_0x582b20(0x2a4))var _0x3a39e0=users[_0x582b20(0x2a4)];else{if(_0x54417d[0x0][_0x582b20(0x269)]==_0x582b20(0x2f7))var _0x3a39e0=users[_0x582b20(0x2f7)];else{if(_0x54417d[0x0][_0x582b20(0x269)]=='Portuguese\x20(BR)')var _0x3a39e0=users[_0x582b20(0x2c5)];else{if(_0x54417d[0x0][_0x582b20(0x269)]==_0x582b20(0x2cb))var _0x3a39e0=users[_0x582b20(0x2cb)];else{if(_0x54417d[0x0][_0x582b20(0x269)]==_0x582b20(0x1ff))var _0x3a39e0=users[_0x582b20(0x2cc)];}}}}}}}_0x17e011[_0x582b20(0x2f2)](_0x582b20(0x236),{'success':_0x183d80[_0x582b20(0x1eb)](_0x582b20(0x2b9)),'errors':_0x183d80[_0x582b20(0x1eb)](_0x582b20(0x2b0)),'role':_0x30b34b,'profile':_0xc89338,'user':_0x183bac,'stock':_0x9e0a49,'master_shop':_0x54417d,'product':_0x50fde9,'language':_0x3a39e0,'warehouse':warehouse_data});}catch(_0x53c3cd){console[_0x582b20(0x25b)](_0x53c3cd);}}),router['post'](a0_0x3c7338(0x2e2),auth,async(_0x333f8d,_0x179f90)=>{var _0x28f0f7=a0_0x3c7338;try{const {invoice:_0x2904f8,date:_0x5a17c3,warehouse_name:_0x4fb0c6,Room_name:_0xb8f765,product_name:_0x5c791b,purchase_quantity:_0x555b79,stocks:_0x31c247,return_qty:_0xac117b,note:_0x250103,level:_0x5c683c,isle:_0x5a0b71,pallet:_0x3330ca,to_warehouse_name:_0x2d7129,to_Room_name:_0x2d6dc1}=_0x333f8d[_0x28f0f7(0x252)],_0x348e75=await purchases[_0x28f0f7(0x1df)]({'_id':_0x333f8d[_0x28f0f7(0x24a)]['id']}),_0xd0142e=await warehouse[_0x28f0f7(0x1df)]({'name':_0x4fb0c6,'room':_0xb8f765});if(typeof _0x5c791b==_0x28f0f7(0x2db))var _0x40d70d=[_0x333f8d['body'][_0x28f0f7(0x216)]],_0xcf6001=[_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x2de)]],_0x3aaf8f=[_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x1ea)]],_0x2cf5ef=[_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x286)]],_0x58bb54=[_0x333f8d['body'][_0x28f0f7(0x295)]],_0x5841e5=[_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x29a)]],_0x307d91=[_0x333f8d['body'][_0x28f0f7(0x283)]],_0x14d948=[_0x333f8d[_0x28f0f7(0x252)]['types']],_0x1e93c3=[_0x333f8d['body']['product_code_hide']],_0x5a96bf=[_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x285)]],_0x1e0bc4=[_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x1e7)]];else var _0x40d70d=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x216)]],_0xcf6001=[..._0x333f8d[_0x28f0f7(0x252)]['purchase_quantity']],_0x3aaf8f=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x1ea)]],_0x2cf5ef=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x286)]],_0x58bb54=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x295)]],_0x5841e5=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x29a)]],_0x307d91=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x283)]],_0x14d948=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x25a)]],_0x1e93c3=[..._0x333f8d['body'][_0x28f0f7(0x270)]],_0x5a96bf=[..._0x333f8d['body'][_0x28f0f7(0x285)]],_0x1e0bc4=[..._0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x1e7)]];const _0x2c67b9=_0x40d70d[_0x28f0f7(0x23b)](_0xc5d724=>{return _0xc5d724={'product_name':_0xc5d724};});_0xcf6001[_0x28f0f7(0x2f0)]((_0x226231,_0x5c2c45)=>{_0x2c67b9[_0x5c2c45]['purchase_quantity']=_0x226231;}),_0x3aaf8f[_0x28f0f7(0x2f0)]((_0x3be6c4,_0xcbafe8)=>{var _0x2abfe4=_0x28f0f7;_0x2c67b9[_0xcbafe8][_0x2abfe4(0x2d2)]=_0x3be6c4;}),_0x2cf5ef['forEach']((_0xc5bb98,_0x18d819)=>{var _0x5724dc=_0x28f0f7;_0x2c67b9[_0x18d819][_0x5724dc(0x286)]=_0xc5bb98;}),_0x58bb54['forEach']((_0x46c037,_0x4baef3)=>{var _0x28f8ac=_0x28f0f7;_0x2c67b9[_0x4baef3][_0x28f8ac(0x2fc)]=_0x46c037;}),_0x5841e5[_0x28f0f7(0x2f0)]((_0x5c3c59,_0x2712e3)=>{_0x2c67b9[_0x2712e3]['bin']=_0x5c3c59;}),_0x307d91[_0x28f0f7(0x2f0)]((_0x3c68f0,_0x2f240d)=>{var _0x17c3d4=_0x28f0f7;_0x2c67b9[_0x2f240d][_0x17c3d4(0x27a)]=_0x3c68f0;}),_0x14d948['forEach']((_0x1ba32c,_0x139c3e)=>{var _0x45d9b6=_0x28f0f7;_0x2c67b9[_0x139c3e][_0x45d9b6(0x2d3)]=_0x1ba32c;}),_0x1e93c3[_0x28f0f7(0x2f0)]((_0x4c17a2,_0x31c0d7)=>{var _0x5a18b8=_0x28f0f7;_0x2c67b9[_0x31c0d7][_0x5a18b8(0x2ad)]=_0x4c17a2;}),_0x5a96bf[_0x28f0f7(0x2f0)]((_0x3f4408,_0x37b3eb)=>{var _0x4f16da=_0x28f0f7;_0x2c67b9[_0x37b3eb][_0x4f16da(0x22c)]=_0x3f4408;}),_0x1e0bc4['forEach']((_0x4a5520,_0x35a4ee)=>{var _0x25b1e5=_0x28f0f7;_0x2c67b9[_0x35a4ee][_0x25b1e5(0x21f)]=_0x4a5520;}),_0x348e75[_0x28f0f7(0x28e)]['forEach'](_0x49770e=>{var _0x3a1155=_0x28f0f7;const _0x48a3bb=_0xd0142e[_0x3a1155(0x25d)][_0x3a1155(0x23b)](_0x516169=>{var _0x2e46c1=_0x3a1155;_0x516169[_0x2e46c1(0x216)]==_0x49770e[_0x2e46c1(0x216)]&&_0x516169[_0x2e46c1(0x27a)]==_0x49770e['floorlevel']&&_0x516169[_0x2e46c1(0x2d3)]==_0x49770e['type']&&_0x516169['bin']==_0x49770e[_0x2e46c1(0x226)]&&_0x516169[_0x2e46c1(0x2fc)]==_0x49770e[_0x2e46c1(0x2fc)]&&_0x516169[_0x2e46c1(0x2b4)]==_0x49770e['rack']&&_0x516169[_0x2e46c1(0x27c)]==_0x49770e[_0x2e46c1(0x27c)]&&(console[_0x2e46c1(0x25b)](parseInt(_0x516169[_0x2e46c1(0x2aa)])+'\x20<>\x20'+parseInt(_0x49770e[_0x2e46c1(0x2cf)])),_0x516169[_0x2e46c1(0x2aa)]=parseInt(_0x516169[_0x2e46c1(0x2aa)])+parseInt(_0x49770e[_0x2e46c1(0x2cf)]));});}),await _0xd0142e[_0x28f0f7(0x1e2)]();const _0x5c2457=_0x2c67b9['filter'](_0x4f5767=>_0x4f5767[_0x28f0f7(0x286)]!=='0'&&_0x4f5767[_0x28f0f7(0x286)]!=='');var _0x40ba8c=0x0;_0x5c2457['forEach'](_0x999f06=>{var _0x4185bb=_0x28f0f7;console[_0x4185bb(0x25b)]('foreach\x20newproduct',_0x999f06),(parseInt(_0x999f06[_0x4185bb(0x2de)])<parseInt(_0x999f06['return_qty'])||parseInt(_0x999f06[_0x4185bb(0x2d2)])<parseInt(_0x999f06['return_qty']))&&_0x40ba8c++;});if(_0x40ba8c!=0x0)return _0x333f8d[_0x28f0f7(0x1eb)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x179f90[_0x28f0f7(0x26e)](_0x28f0f7(0x1f9));const _0x211c97=new purchases_return({'invoice':_0x2904f8,'suppliers':_0x333f8d[_0x28f0f7(0x252)]['suppliers'],'date':_0x5a17c3,'warehouse_name':_0x4fb0c6,'return_product':_0x5c2457,'note':_0x250103,'room':_0xb8f765,'to_warehouse_name':_0x2d7129,'to_room':_0x2d6dc1}),_0x220732=await _0x211c97[_0x28f0f7(0x1e2)]();console[_0x28f0f7(0x25b)](_0x211c97);const _0x551158=await purchases_return[_0x28f0f7(0x1df)]({'invoice':_0x2904f8}),_0x16ab46=await warehouse[_0x28f0f7(0x1df)]({'name':_0x2d7129,'room':_0x2d6dc1});_0x551158[_0x28f0f7(0x293)][_0x28f0f7(0x2f0)](_0x22b58a=>{var _0xb2c062=_0x28f0f7,_0x37941e=0x0;const _0x14ee02=_0x16ab46[_0xb2c062(0x25d)][_0xb2c062(0x23b)](_0x2bdee2=>{var _0x394406=_0xb2c062;_0x2bdee2[_0x394406(0x216)]==_0x22b58a['product_name']&&_0x2bdee2['floorlevel']==_0x22b58a['floorlevel']&&_0x2bdee2[_0x394406(0x2d3)]==_0x22b58a[_0x394406(0x2d3)]&&_0x2bdee2[_0x394406(0x226)]==_0x22b58a[_0x394406(0x226)]&&_0x2bdee2[_0x394406(0x2fc)]==_0x22b58a[_0x394406(0x2fc)]&&(_0x2bdee2[_0x394406(0x2aa)]=parseInt(_0x2bdee2[_0x394406(0x2aa)])-parseInt(_0x22b58a['return_qty']),_0x37941e++);});_0x37941e=='0'&&(_0x16ab46[_0xb2c062(0x25d)]=_0x16ab46[_0xb2c062(0x25d)][_0xb2c062(0x258)]({'product_name':_0x22b58a[_0xb2c062(0x216)],'product_stock':_0x22b58a[_0xb2c062(0x286)],'primary_code':_0x22b58a[_0xb2c062(0x22c)],'secondary_code':_0x22b58a['secondary_code'],'product_code':_0x22b58a[_0xb2c062(0x2ad)],'storage':_0x22b58a[_0xb2c062(0x27c)],'rack':_0x22b58a['rack'],'bay':_0x22b58a[_0xb2c062(0x2fc)],'bin':_0x22b58a['bin'],'type':_0x22b58a['type'],'floorlevel':_0x22b58a[_0xb2c062(0x27a)],'maxProducts':_0x22b58a[_0xb2c062(0x206)],'unit':_0x22b58a[_0xb2c062(0x294)],'secondary_unit':_0x22b58a[_0xb2c062(0x1f2)],'expiry_date':_0x22b58a[_0xb2c062(0x2a0)]}));}),await _0x16ab46[_0x28f0f7(0x1e2)]();const _0x543e47=await purchases[_0x28f0f7(0x1df)]({'invoice':_0x2904f8});_0x543e47[_0x28f0f7(0x2be)]=_0x28f0f7(0x24c);const _0x43c726=await _0x543e47[_0x28f0f7(0x1e2)](),_0x141661=new s_payment_data({'invoice':_0x2904f8,'suppliers':_0x333f8d['body'][_0x28f0f7(0x241)],'reason':_0x28f0f7(0x25c)});await _0x141661[_0x28f0f7(0x1e2)]();const _0x35f75d=await master_shop[_0x28f0f7(0x207)]();console[_0x28f0f7(0x25b)]('add\x20post',_0x35f75d[0x0]['image']);const _0x343a50=await email_settings['findOne'](),_0x1c5b48=await suppliers[_0x28f0f7(0x1df)]({'name':_0x333f8d[_0x28f0f7(0x252)][_0x28f0f7(0x241)]});console[_0x28f0f7(0x25b)]('suppliers_data',_0x1c5b48);_0x35f75d[0x0][_0x28f0f7(0x2d5)]==0x1?(right_currency=_0x35f75d[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x35f75d[0x0]['currency']);var _0x3ff1d9=_0x40d70d,_0x16df8a=_0x2cf5ef,_0x26156d='',_0x4ce092;for(_0x4ce092 in _0x3ff1d9){_0x26156d+=_0x28f0f7(0x245)+_0x28f0f7(0x261)+_0x3ff1d9[_0x4ce092]+_0x28f0f7(0x292)+_0x28f0f7(0x261)+_0x16df8a[_0x4ce092]+'</td>'+_0x28f0f7(0x23f);}console[_0x28f0f7(0x25b)](_0x28f0f7(0x232),_0x26156d);let _0x4e22f7=nodemailer['createTransport']({'service':_0x28f0f7(0x2b6),'auth':{'user':_0x343a50[_0x28f0f7(0x259)],'pass':_0x343a50[_0x28f0f7(0x255)]}}),_0x4f91f6={'from':_0x343a50[_0x28f0f7(0x259)],'to':_0x1c5b48[_0x28f0f7(0x259)],'subject':_0x28f0f7(0x262),'attachments':[{'filename':_0x28f0f7(0x282),'path':__dirname+_0x28f0f7(0x1e9)+_0x28f0f7(0x1f7)+_0x35f75d[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x28f0f7(0x2c4)+_0x28f0f7(0x2ab)+_0x28f0f7(0x1e8)+_0x28f0f7(0x264)+_0x28f0f7(0x1e8)+_0x28f0f7(0x2c6)+'</div>'+_0x28f0f7(0x1e8)+'<h2>\x20'+_0x35f75d[0x0][_0x28f0f7(0x2a5)]+_0x28f0f7(0x27b)+_0x28f0f7(0x257)+_0x28f0f7(0x257)+_0x28f0f7(0x2f4)+_0x28f0f7(0x1e8)+_0x28f0f7(0x235)+_0x28f0f7(0x24b)+_0x2904f8+'\x20'+_0x28f0f7(0x272)+'\x20Order\x20Date\x20:\x20'+_0x5a17c3+'\x20'+_0x28f0f7(0x266)+_0x28f0f7(0x234)+_0x28f0f7(0x257)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x28f0f7(0x265)+_0x28f0f7(0x245)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x28f0f7(0x2ef)+_0x28f0f7(0x246)+_0x28f0f7(0x23f)+'</thead>'+_0x28f0f7(0x1e6)+'\x20'+_0x26156d+'\x20'+_0x28f0f7(0x209)+_0x28f0f7(0x2bd)+_0x28f0f7(0x1e8)+'<strong>\x20Regards\x20</strong>'+_0x28f0f7(0x2d1)+_0x35f75d[0x0][_0x28f0f7(0x2a5)]+_0x28f0f7(0x234)+_0x28f0f7(0x257)+_0x28f0f7(0x257)+'</body></html>'};_0x4e22f7[_0x28f0f7(0x273)](_0x4f91f6,function(_0x30a5bc,_0x55fafd){var _0x3adafb=_0x28f0f7;_0x30a5bc?(console[_0x3adafb(0x25b)](_0x30a5bc),console[_0x3adafb(0x25b)](_0x3adafb(0x21d))):console[_0x3adafb(0x25b)](_0x3adafb(0x260));}),_0x333f8d[_0x28f0f7(0x1eb)](_0x28f0f7(0x2b9),_0x28f0f7(0x1fa)),_0x179f90[_0x28f0f7(0x26e)](_0x28f0f7(0x244));}catch(_0x34a6e7){console['log'](_0x34a6e7),_0x179f90[_0x28f0f7(0x26c)](0xc8)['json']({'message':_0x34a6e7['message']});}}),router['get'](a0_0x3c7338(0x2e5),auth,async(_0x445570,_0x29a664)=>{var _0x4a1406=a0_0x3c7338;try{const {username:_0x32752a,email:_0x5ed1be,role:_0x30f975}=_0x445570[_0x4a1406(0x2f9)],_0x3affac=_0x445570[_0x4a1406(0x2f9)],_0x2ba26b=await profile[_0x4a1406(0x1df)]({'email':_0x3affac[_0x4a1406(0x259)]}),_0x3ab635=await master_shop[_0x4a1406(0x207)](),_0x35d938=_0x445570['params']['id'],_0x201d8c=await purchases[_0x4a1406(0x2a1)](_0x35d938);if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x20e))var _0x4a9dc2=users[_0x4a1406(0x2fa)];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x243))var _0x4a9dc2=users[_0x4a1406(0x243)];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x1f8))var _0x4a9dc2=users[_0x4a1406(0x1f8)];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x2a4))var _0x4a9dc2=users[_0x4a1406(0x2a4)];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x2f7))var _0x4a9dc2=users[_0x4a1406(0x2f7)];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x202))var _0x4a9dc2=users['Portuguese'];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x2cb))var _0x4a9dc2=users[_0x4a1406(0x2cb)];else{if(_0x3ab635[0x0][_0x4a1406(0x269)]==_0x4a1406(0x1ff))var _0x4a9dc2=users['Arabic'];}}}}}}}_0x29a664[_0x4a1406(0x2f2)](_0x4a1406(0x2a3),{'success':_0x445570['flash'](_0x4a1406(0x2b9)),'errors':_0x445570['flash'](_0x4a1406(0x2b0)),'role':_0x3affac,'profile':_0x2ba26b,'alldata':_0x201d8c,'master_shop':_0x3ab635,'language':_0x4a9dc2}),console[_0x4a1406(0x25b)](alldata);}catch(_0x2ea77c){console[_0x4a1406(0x25b)](_0x2ea77c);}}),router['post'](a0_0x3c7338(0x2bc),async(_0x357986,_0xeab2b8)=>{var _0x5c5a19=a0_0x3c7338;const {product_code:_0x59d74d}=_0x357986['body'];var _0xce897e;const _0x106a47=await product[_0x5c5a19(0x2a8)]([{'$match':{'primary_code':_0x59d74d,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x5c5a19(0x1ef),'name':{'$first':_0x5c5a19(0x27d)},'category':{'$first':_0x5c5a19(0x2ae)},'brand':{'$first':_0x5c5a19(0x23a)},'unit':{'$first':_0x5c5a19(0x2ff)},'alertquantity':{'$first':_0x5c5a19(0x26f)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5c5a19(0x300)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x5c5a19(0x289)},'maxProdPerUnit':{'$first':_0x5c5a19(0x1f4)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x516766=await product[_0x5c5a19(0x2a8)]([{'$match':{'secondary_code':_0x59d74d,'product_category':_0x5c5a19(0x27f)}},{'$group':{'_id':'$_id','name':{'$first':_0x5c5a19(0x27d)},'category':{'$first':'$category'},'brand':{'$first':_0x5c5a19(0x23a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5c5a19(0x2da)},'primary_code':{'$first':_0x5c5a19(0x300)},'secondary_code':{'$first':_0x5c5a19(0x28d)},'maxStocks':{'$first':_0x5c5a19(0x289)},'maxProdPerUnit':{'$first':_0x5c5a19(0x1f4)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x106a47[_0x5c5a19(0x296)]>0x0)_0xce897e=_0x106a47;else _0x516766[_0x5c5a19(0x296)]>0x0&&(_0xce897e=_0x516766);_0xeab2b8['json'](_0xce897e);}),router['post'](a0_0x3c7338(0x1fd),async(_0x2dc8e2,_0xedfa2f)=>{var _0x1ff837=a0_0x3c7338;const {primaryCode:_0xae542,secondaryCode:_0x106f26,productCode:_0x2ba215,bay:_0x1c176f,bin:_0x31e1ff,types:_0x44f652,pallet:_0x363665,warehouses:_0x3624ce,room:_0x487573}=_0x2dc8e2[_0x1ff837(0x252)];console[_0x1ff837(0x25b)](_0x2dc8e2[_0x1ff837(0x252)]);try{const _0x1fe482=await warehouse[_0x1ff837(0x2a8)]([{'$match':{'name':_0x3624ce,'room':_0x487573}},{'$unwind':_0x1ff837(0x2c3)},{'$match':{'product_details.bay':_0x1c176f,'product_details.bin':_0x31e1ff,'product_details.type':_0x44f652}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1ff837(0x239)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x1ff837(0x1e3)},'isle':{'$first':_0x1ff837(0x25f)},'pallet':{'$first':_0x1ff837(0x26a)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xedfa2f[_0x1ff837(0x26c)](0xc8)['json'](_0x1fe482);}catch(_0x38009f){_0xedfa2f[_0x1ff837(0x26c)](0x194)['json']({'message':_0x38009f[_0x1ff837(0x276)]});}}),module['exports']=router;