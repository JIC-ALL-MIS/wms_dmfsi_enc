var a0_0x19dad8=a0_0x55c3;(function(_0x221e87,_0x18573e){var _0x57e470=a0_0x55c3,_0x3bb523=_0x221e87();while(!![]){try{var _0x5b016e=parseInt(_0x57e470(0x203))/0x1+parseInt(_0x57e470(0x2b7))/0x2*(-parseInt(_0x57e470(0x250))/0x3)+parseInt(_0x57e470(0x29b))/0x4*(-parseInt(_0x57e470(0x27f))/0x5)+parseInt(_0x57e470(0x2e0))/0x6*(-parseInt(_0x57e470(0x2de))/0x7)+parseInt(_0x57e470(0x23d))/0x8*(-parseInt(_0x57e470(0x2be))/0x9)+-parseInt(_0x57e470(0x25b))/0xa*(parseInt(_0x57e470(0x22c))/0xb)+-parseInt(_0x57e470(0x2ac))/0xc*(-parseInt(_0x57e470(0x301))/0xd);if(_0x5b016e===_0x18573e)break;else _0x3bb523['push'](_0x3bb523['shift']());}catch(_0x4ad6cb){_0x3bb523['push'](_0x3bb523['shift']());}}}(a0_0x43ef,0x68b82));function a0_0x43ef(){var _0x64e500=['$paid_amount','$product_details.isle','return_qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','add_purchases','$product_details.floorlevel','site_title','INC-','</h5>','Rack\x20E','</tbody>','suppliers_data','/view/:id','map','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$suppliers_docs','invoice','Rack\x20A','$product_details.maxProducts','/../public','currency_placement','payment\x20successfull','Arabic','$product.floorlevel','\x20</h2>','role','random','$room','error','exports','product_code','forEach','3137245AMexqy','\x20Order\x20Number\x20:\x20','Level','../public/language/languages.json','$product.quantity','</table>','slice','express','deliverycode','host','Purchase\x20Mail','errors','<!DOCTYPE\x20html>','stock_data','warehouse','An\x20error\x20occurred.','date','English\x20(US)','German','<html><head><title></title>','suppliers_docs','sendMail','</body></html>','<tbody\x20style=\x22text-align:\x20center;\x22>','save','prod_level','/barcode/:id','\x20<\x20wew\x20>\x20','4ochvHB','prod_pallet','$product_details.product_code','suppliers','aggregate','$warehouse_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<span\x20style=\x22float:\x20right;\x22>','Portuguese\x20(BR)','secondary_unit','RoomAssign','language','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','rak','$maxProdPerUnit','message','user_id','91788ZZnoID','expiry_date','prod_secondunit','Purchase\x20Return\x20Mail','render','room','/give_payment/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','POnumber','prod_cat','$primary_code','608276LynPkF','\x20Order\x20Date\x20:\x20','bay','type','$invoice','$product_details.type','/view/return_purchase/:id','9bsuOvz','isle','$product_details.product_stock','Chinese','$product_details.primary_code','add\x20post','Router','floorlevel','prod_invoice','staff','French','$date','Floor','/CheckingWarehouse','\x20<>\x20','$suppliers','level','<h5>','padStart','prod_name','Error\x20Occurs','Portuguese','$product_details.bay','$product_details.pallet','An\x20error\x20occurred\x20while\x20saving\x20data.','port','room_name','$product.bay','$product_details.storage','standard_unit','</head><body>','product_code_hide','28CNZAgl','RMSEmail','506784FrXYPl','/view/add_purchases','$name','maxStocks','$product','purchase_quantity','There\x27s\x20a\x20error\x20in\x20this\x20transaction','COLD\x20STORAGE','product_stock','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_Qty','/barcode_scanner','$_id','length','Purchase\x20Return','$product_code','Rack\x20F','Enabled','params','/upload/','actual_qty','finalize','<div>','$due_amount','maxperunit','Rack\x20D','$note','product_cat','flash','quantity','prod_unit','deliverydate','prod_isle','3445UgTvgo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product.type','$maxStocks','getFullYear','createTransport','path','max_product_unit','/all_purchases/view','Return\x20Goods','storage','$secondary_code','product_details','email','</tr>','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','rack','all_purchases','$product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Room_name','secondary_code','primary_code_hide','log','<strong>\x20Regards\x20</strong>','<tr>','$product_details.secondary_code','/view/add_purchases/:id','$product_details.bin','user','650360SqWHoV','production_date','floor','</td>','$category','stocks','Rack\x20B','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','image','success','then','back','getMonth','catch','delivery_date','date_data','prod_code','product_name','findOne','Shelves','pallet','Enclosed','edit_purchases','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<h2>\x20','find','prod_primunit','name','Sales\x20Update\x20successfully','</div>','get','abs','json','$product_details.rack','post','Receiving\x20Area','$return_data','$unit','concat','logo','status','820094gBMwsX','getDate','True','types','findById','English','MaxStocks_data','secondary_code_hide','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','body','due_amount','purchases\x20item\x20return\x20successfull','$product_details.level','Rack\x20C','add_purchases\x20error','batch_code','4205808byWDBJ','actual_uom','$alertquantity','master','bin','string','Arabic\x20(ae)','Spanish','password','redirect','filter','primary_code','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details._id','Raw\x20Materials','warehouse_name','stock_quantity','table\x20page','alertQTY','6iWVltd','Hindi','product','Email\x20sent\x20successfully','delivery_code','Paid\x20For\x20Purchase','paid_amount','push','$product_details','$product_details.product_name','</span>','20HsQETw','</thead>','$expiry_date','Ambient'];a0_0x43ef=function(){return _0x64e500;};return a0_0x43ef();}const express=require(a0_0x19dad8(0x286)),app=express(),router=express[a0_0x19dad8(0x2c4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require('ejs');const path=require(a0_0x19dad8(0x1ea)),users=require(a0_0x19dad8(0x282));function a0_0x55c3(_0x1eb26b,_0x63bed0){var _0x43ef05=a0_0x43ef();return a0_0x55c3=function(_0x55c336,_0x4cc2eb){_0x55c336=_0x55c336-0x1e8;var _0x44972a=_0x43ef05[_0x55c336];return _0x44972a;},a0_0x55c3(_0x1eb26b,_0x63bed0);}router['get']('/view',auth,async(_0x1fe033,_0x335f98)=>{var _0xa03d8f=a0_0x19dad8;try{const {username:_0x1dcb9a,email:_0x279d72,role:_0x3d2488}=_0x1fe033[_0xa03d8f(0x202)],_0x5d3354=_0x1fe033[_0xa03d8f(0x202)],_0x4080c0=await profile[_0xa03d8f(0x215)]({'email':_0x5d3354[_0xa03d8f(0x1f1)]}),_0x143c77=await staff['findOne']({'email':_0x5d3354[_0xa03d8f(0x1f1)]});if(_0x5d3354['role']==_0xa03d8f(0x2c7)){const _0x479e00=await staff['findOne']({'email':_0x5d3354[_0xa03d8f(0x1f1)]});}const _0x5c8f05=await master_shop[_0xa03d8f(0x21c)]();let _0x8ceda6;if(_0x5d3354[_0xa03d8f(0x278)]==_0xa03d8f(0x2c7)){const _0x316b3f=await staff[_0xa03d8f(0x215)]({'email':_0x5d3354['email']});_0x8ceda6=await purchases['aggregate']([{'$match':{'warehouse_name':_0x316b3f[_0xa03d8f(0x28d)]}},{'$lookup':{'from':_0xa03d8f(0x29e),'localField':'suppliers','foreignField':_0xa03d8f(0x21e),'as':_0xa03d8f(0x293)}},{'$unwind':_0xa03d8f(0x26e)},{'$unwind':'$product'},{'$group':{'_id':_0xa03d8f(0x2ec),'invoice':{'$first':_0xa03d8f(0x2bb)},'suppliers':{'$first':_0xa03d8f(0x2cd)},'date':{'$first':_0xa03d8f(0x2c9)},'warehouse_name':{'$first':_0xa03d8f(0x2a0)},'room':{'$first':_0xa03d8f(0x27a)},'product':{'$push':_0xa03d8f(0x2e4)},'note':{'$first':_0xa03d8f(0x2fa)},'paid_amount':{'$first':_0xa03d8f(0x25f)},'due_amount':{'$first':_0xa03d8f(0x2f7)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0xa03d8f(0x25d)},'suppliers_docs':{'$first':_0xa03d8f(0x26e)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0xa03d8f(0x2d9)},'isle':{'$addToSet':_0xa03d8f(0x1f7)},'type':{'$addToSet':_0xa03d8f(0x303)},'floorlevel':{'$addToSet':_0xa03d8f(0x276)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x8ceda6=await purchases[_0xa03d8f(0x29f)]([{'$lookup':{'from':_0xa03d8f(0x29e),'localField':_0xa03d8f(0x29e),'foreignField':_0xa03d8f(0x21e),'as':_0xa03d8f(0x293)}},{'$unwind':_0xa03d8f(0x26e)},{'$unwind':'$product'},{'$group':{'_id':_0xa03d8f(0x2ec),'invoice':{'$first':_0xa03d8f(0x2bb)},'suppliers':{'$first':_0xa03d8f(0x2cd)},'date':{'$first':_0xa03d8f(0x2c9)},'warehouse_name':{'$first':_0xa03d8f(0x2a0)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0xa03d8f(0x2e4)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xa03d8f(0x227)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0xa03d8f(0x25d)},'suppliers_docs':{'$first':_0xa03d8f(0x26e)},'total_product_quantity':{'$sum':_0xa03d8f(0x283)},'level':{'$addToSet':_0xa03d8f(0x2d9)},'isle':{'$addToSet':_0xa03d8f(0x1f7)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xa03d8f(0x276)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5c8f05[0x0]['language']==_0xa03d8f(0x290)){var _0x539da4=users[_0xa03d8f(0x231)];console[_0xa03d8f(0x1fc)](_0x539da4);}else{if(_0x5c8f05[0x0][_0xa03d8f(0x2a6)]==_0xa03d8f(0x251))var _0x539da4=users[_0xa03d8f(0x251)];else{if(_0x5c8f05[0x0]['language']=='German')var _0x539da4=users['German'];else{if(_0x5c8f05[0x0][_0xa03d8f(0x2a6)]==_0xa03d8f(0x244))var _0x539da4=users[_0xa03d8f(0x244)];else{if(_0x5c8f05[0x0][_0xa03d8f(0x2a6)]=='French')var _0x539da4=users['French'];else{if(_0x5c8f05[0x0][_0xa03d8f(0x2a6)]==_0xa03d8f(0x2a3))var _0x539da4=users[_0xa03d8f(0x2d3)];else{if(_0x5c8f05[0x0][_0xa03d8f(0x2a6)]==_0xa03d8f(0x2c1))var _0x539da4=users[_0xa03d8f(0x2c1)];else{if(_0x5c8f05[0x0][_0xa03d8f(0x2a6)]=='Arabic\x20(ae)')var _0x539da4=users[_0xa03d8f(0x275)];}}}}}}}_0x335f98[_0xa03d8f(0x2b0)](_0xa03d8f(0x1f6),{'success':_0x1fe033['flash'](_0xa03d8f(0x20c)),'errors':_0x1fe033[_0xa03d8f(0x2fc)](_0xa03d8f(0x28a)),'purchases':_0x8ceda6,'role':_0x5d3354,'profile':_0x4080c0,'master_shop':_0x5c8f05,'language':_0x539da4});}catch(_0x17be71){console[_0xa03d8f(0x1fc)](_0xa03d8f(0x24e),_0x17be71),_0x335f98['status'](0xc8)[_0xa03d8f(0x223)]({'message':_0x17be71[_0xa03d8f(0x2aa)]});}});function BayBinSelected(_0x3c648f,_0x3993dc){var _0x3958da=a0_0x19dad8,_0x125c08=[],_0x1ab074=[],_0x3ab844=[],_0x59a2e8=[],_0x16fa48=[],_0x2c214e=[];let _0x464b68=[];if(_0x3c648f=='DRY\x20STORAGE')switch(_0x3993dc){case _0x3958da(0x270):_0x125c08=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1ab074=[0x1,0x2],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=[_0x3958da(0x281),_0x3958da(0x2ca)],_0x16fa48=['D'],_0x2c214e=['A'];break;case _0x3958da(0x209):_0x125c08=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1ab074=[0x1,0x2],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=[_0x3958da(0x281),_0x3958da(0x2ca)],_0x16fa48=['D'],_0x2c214e=['B'];break;case _0x3958da(0x216):_0x125c08=[0x0],_0x1ab074=[0x0],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=[_0x3958da(0x2ca)],_0x16fa48=['D'],_0x2c214e=['S'];break;case _0x3958da(0x226):_0x125c08=[0x0],_0x1ab074=[0x0],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3ab844=[_0x3958da(0x2ca)],_0x16fa48=['D'],_0x2c214e=['R'];break;}else{if(_0x3c648f==_0x3958da(0x2e7))switch(_0x3993dc){case'Rack\x20A':_0x125c08=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1ab074=['B','F'],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=[_0x3958da(0x281),'Floor'],_0x16fa48=['C'],_0x2c214e=['A'];break;case _0x3958da(0x209):_0x125c08=[0x5,0x4,0x3,0x2,0x1],_0x1ab074=['F','B','S'],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=[_0x3958da(0x281),_0x3958da(0x2ca)],_0x16fa48=['C'],_0x2c214e=['B'];break;case _0x3958da(0x23a):_0x125c08=[0x1,0x2,0x3,0x4,0x5],_0x1ab074=['B','F','S'],_0x59a2e8=[0x5,0x4,0x3,0x2,0x1],_0x3ab844=[_0x3958da(0x281),'Floor'],_0x16fa48=['C'],_0x2c214e=['C'];break;case _0x3958da(0x2f9):_0x125c08=[0x5,0x4,0x3,0x2,0x1],_0x1ab074=['F','B','S'],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=['Level',_0x3958da(0x2ca)],_0x16fa48=['C'],_0x2c214e=['D'];break;case _0x3958da(0x268):_0x125c08=[0x4,0x3,0x2,0x1],_0x1ab074=[0x1,0x2],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=[_0x3958da(0x281),_0x3958da(0x2ca)],_0x16fa48=['C'],_0x2c214e=['E'];break;case _0x3958da(0x2f0):_0x125c08=[0x1,0x2,0x3],_0x1ab074=[0x1,0x2],_0x59a2e8=[0x1,0x2,0x3,0x4,0x5],_0x3ab844=['Level'],_0x16fa48=['C'],_0x2c214e=['F'];break;}}return{'levels':_0x125c08,'Isle':_0x1ab074,'rack':_0x59a2e8,'type':_0x3ab844,'storage':_0x16fa48,'rak':_0x2c214e};}async function getRandom8DigitNumber(){var _0x5491d4=a0_0x19dad8;const _0x33c738=0x989680,_0x203bfd=0x5f5e0ff,_0x558b75=Math[_0x5491d4(0x205)](Math[_0x5491d4(0x279)]()*(_0x203bfd-_0x33c738+0x1))+_0x33c738;var _0x3640c7;const _0x2c23b6=await purchases[_0x5491d4(0x215)]({'invoice':_0x5491d4(0x266)+_0x558b75});return _0x2c23b6&&_0x2c23b6[_0x5491d4(0x2ed)]>0x0?_0x3640c7=_0x5491d4(0x266)+_0x558b75:_0x3640c7=_0x5491d4(0x266)+_0x558b75,_0x3640c7;}router[a0_0x19dad8(0x221)](a0_0x19dad8(0x2e1),auth,async(_0x2d5752,_0x41f90d)=>{var _0x564647=a0_0x19dad8;try{const {username:_0x7b5be8,email:_0x3fe77f,role:_0x58c720}=_0x2d5752[_0x564647(0x202)],_0x31d086=_0x2d5752['user'],_0x3e2658=await profile['findOne']({'email':_0x31d086[_0x564647(0x1f1)]}),_0x3549a6=await master_shop[_0x564647(0x21c)](),_0x42cd39=await staff[_0x564647(0x215)]({'email':_0x31d086[_0x564647(0x1f1)]}),_0x584d67=await suppliers[_0x564647(0x21c)]({});let _0x593aa0;if(_0x31d086[_0x564647(0x278)]==_0x564647(0x2c7)){const _0x461d96=await staff['findOne']({'email':_0x31d086[_0x564647(0x1f1)]});_0x593aa0=await warehouse['aggregate']([{'$match':{'status':_0x564647(0x2f1),'name':_0x461d96[_0x564647(0x28d)],'warehouse_category':_0x564647(0x24b),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x564647(0x2e2),'name':{'$first':_0x564647(0x2e2)}}}]);}else _0x593aa0=await warehouse[_0x564647(0x29f)]([{'$match':{'status':'Enabled','warehouse_category':_0x564647(0x24b),'name':{'$ne':_0x564647(0x1ed)}}},{'$group':{'_id':'$name','name':{'$first':_0x564647(0x2e2)}}}]);const _0xdfa2f0=await product['find']({}),_0x2fd1d7=await warehouse['find']({'status':_0x564647(0x2f1)}),_0x1fbd25=await purchases[_0x564647(0x21c)]({}),_0x3ab875=_0x1fbd25[_0x564647(0x2ed)]+0x1,_0x57cbf7=_0x564647(0x266)+_0x3ab875['toString']()[_0x564647(0x2d0)](0x5,'0');var _0x32233d=[_0x564647(0x25e),_0x564647(0x218)];if(_0x3549a6[0x0][_0x564647(0x2a6)]=='English\x20(US)')var _0x1110b0=users[_0x564647(0x231)];else{if(_0x3549a6[0x0][_0x564647(0x2a6)]==_0x564647(0x251))var _0x1110b0=users[_0x564647(0x251)];else{if(_0x3549a6[0x0]['language']==_0x564647(0x291))var _0x1110b0=users[_0x564647(0x291)];else{if(_0x3549a6[0x0][_0x564647(0x2a6)]==_0x564647(0x244))var _0x1110b0=users[_0x564647(0x244)];else{if(_0x3549a6[0x0][_0x564647(0x2a6)]==_0x564647(0x2c8))var _0x1110b0=users[_0x564647(0x2c8)];else{if(_0x3549a6[0x0]['language']==_0x564647(0x2a3))var _0x1110b0=users[_0x564647(0x2d3)];else{if(_0x3549a6[0x0]['language']=='Chinese')var _0x1110b0=users[_0x564647(0x2c1)];else{if(_0x3549a6[0x0][_0x564647(0x2a6)]==_0x564647(0x243))var _0x1110b0=users[_0x564647(0x275)];}}}}}}}const _0x5290cc=getRandom8DigitNumber();_0x5290cc[_0x564647(0x20d)](_0x1871dd=>{var _0x1bb296=_0x564647;_0x41f90d[_0x1bb296(0x2b0)](_0x1bb296(0x263),{'success':_0x2d5752[_0x1bb296(0x2fc)](_0x1bb296(0x20c)),'errors':_0x2d5752[_0x1bb296(0x2fc)]('errors'),'role':_0x31d086,'profile':_0x3e2658,'suppliers':_0x584d67,'warehouse':_0x593aa0,'product':_0xdfa2f0,'invoice':_0x1871dd,'master_shop':_0x3549a6,'language':_0x1110b0,'find_data':_0x2fd1d7,'rooms_data':_0x32233d});})[_0x564647(0x210)](_0x16de43=>{var _0x1cc005=_0x564647;_0x2d5752[_0x1cc005(0x2fc)](_0x1cc005(0x28a),_0x1cc005(0x2e6)),_0x41f90d[_0x1cc005(0x246)](_0x1cc005(0x1ec));});}catch(_0x407aec){console[_0x564647(0x1fc)](_0x407aec);}}),router[a0_0x19dad8(0x221)](a0_0x19dad8(0x200),auth,async(_0x3345b1,_0x19a31a)=>{var _0x50f39a=a0_0x19dad8;try{const _0x5ac875=_0x3345b1[_0x50f39a(0x2f2)]['id'];console[_0x50f39a(0x1fc)](_0x5ac875);const _0x22387a=await master_shop['find']();console[_0x50f39a(0x1fc)](_0x50f39a(0x240),_0x22387a);const _0x45d2d6=await product[_0x50f39a(0x215)]({'name':_0x5ac875});console[_0x50f39a(0x1fc)](_0x50f39a(0x252),_0x45d2d6),_0x19a31a[_0x50f39a(0x22b)](0xc8)[_0x50f39a(0x223)]({'product_data':_0x45d2d6,'master':_0x22387a});}catch(_0x5c82f9){console[_0x50f39a(0x1fc)](_0x50f39a(0x23b),_0x5c82f9);}}),router[a0_0x19dad8(0x225)]('/view/add_purchases',auth,async(_0x5634cf,_0x1ae47b)=>{var _0x2832fd=a0_0x19dad8;try{const {invoice:_0x3638f6,date:_0xf24d5a,warehouse_name:_0xf17db5,prod_name:_0x47bb31,prod_code:_0x165014,prod_qty:_0x45c862,prod_unit:_0x2550ea,prod_secondunit:_0x3c7132,prod_level:_0x528e7e,prod_isle:_0x425769,prod_pallet:_0x13244c,note:_0x37386a,expiry_date:_0x4ec69c,batch_code:_0x4702d5,payable:_0x424f85,due_amount:_0x4eedeb,Room_name:_0x919a8,primary_code:_0xad1b72,secondary_code:_0x2922b5,MaxStocks_data:_0x4b40bb,PO_number:_0x13a9d5,SCRN:_0x1ecec8,JO_number:_0x3e6af9}=_0x5634cf['body'];if(typeof _0x47bb31=='string')var _0x6014df=[_0x5634cf[_0x2832fd(0x236)]['prod_name']],_0x5c9876=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x213)]],_0x227cac=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2ea)]],_0x140e95=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x21d)]],_0x38ab51=[_0x5634cf[_0x2832fd(0x236)]['prod_secondunit']],_0x178f7b=[_0x5634cf['body']['prod_level']],_0x447dec=[_0x5634cf[_0x2832fd(0x236)]['primary_code']],_0x1b88fe=[_0x5634cf['body'][_0x2832fd(0x1fa)]],_0x1d0aca=[_0x5634cf['body'][_0x2832fd(0x232)]],_0x9c6b8f=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x23c)]],_0x58a508=[_0x5634cf['body'][_0x2832fd(0x2ad)]],_0x4b3112=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x1eb)]],_0x4a6d29=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x24f)]],_0x57b2d8=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x204)]],_0xffb839=[_0x5634cf['body'][_0x2832fd(0x2b5)]],_0x1e1dc0=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2a5)]],_0x157122=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x287)]],_0x4dd89d=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2c6)]],_0x42a70d=[_0x5634cf[_0x2832fd(0x236)]['actual_qty']],_0x2d2c28=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x23e)]],_0x30ea67=[_0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2ff)]];else var _0x6014df=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2d1)]],_0x5c9876=[..._0x5634cf['body'][_0x2832fd(0x213)]],_0x227cac=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2ea)]],_0x140e95=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x21d)]],_0x38ab51=[..._0x5634cf['body']['prod_secondunit']],_0x178f7b=[..._0x5634cf[_0x2832fd(0x236)]['prod_level']],_0x447dec=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x248)]],_0x1b88fe=[..._0x5634cf['body']['secondary_code']],_0x1d0aca=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x232)]],_0x9c6b8f=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x23c)]],_0x58a508=[..._0x5634cf['body'][_0x2832fd(0x2ad)]],_0x4b3112=[..._0x5634cf['body']['max_product_unit']],_0x4a6d29=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x24f)]],_0x57b2d8=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x204)]],_0xffb839=[..._0x5634cf[_0x2832fd(0x236)]['prod_cat']],_0x1e1dc0=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2a5)]],_0x157122=[..._0x5634cf[_0x2832fd(0x236)]['deliverycode']],_0x4dd89d=[..._0x5634cf['body'][_0x2832fd(0x2c6)]],_0x42a70d=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2f4)]],_0x2d2c28=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x23e)]],_0x30ea67=[..._0x5634cf[_0x2832fd(0x236)][_0x2832fd(0x2ff)]];const _0x5b3582=_0x6014df[_0x2832fd(0x26c)](_0x35d59d=>{return _0x35d59d={'product_name':_0x35d59d};});_0x42a70d[_0x2832fd(0x27e)]((_0x1d6cfc,_0x59f93e)=>{var _0x554b9a=_0x2832fd;_0x5b3582[_0x59f93e]['actual_qty']=Math[_0x554b9a(0x222)](_0x1d6cfc);}),_0x2d2c28[_0x2832fd(0x27e)]((_0x5106b7,_0x1892b4)=>{var _0x14165c=_0x2832fd;_0x5b3582[_0x1892b4][_0x14165c(0x23e)]=_0x5106b7;}),_0x5c9876[_0x2832fd(0x27e)]((_0x5d0299,_0x3e1ba9)=>{var _0x4ff65d=_0x2832fd;_0x5b3582[_0x3e1ba9][_0x4ff65d(0x27d)]=_0x5d0299,_0x5b3582[_0x3e1ba9][_0x4ff65d(0x212)]=_0xf24d5a;}),_0x227cac['forEach']((_0x47128a,_0x246125)=>{var _0x22c4b5=_0x2832fd;_0x5b3582[_0x246125][_0x22c4b5(0x2fd)]=Math[_0x22c4b5(0x222)](_0x47128a);}),_0x140e95[_0x2832fd(0x27e)]((_0x3b9130,_0x27092f)=>{var _0x120d46=_0x2832fd;_0x5b3582[_0x27092f][_0x120d46(0x2db)]=_0x3b9130;}),_0x38ab51[_0x2832fd(0x27e)]((_0x274833,_0xfa7595)=>{_0x5b3582[_0xfa7595]['secondary_unit']=_0x274833;}),_0x178f7b[_0x2832fd(0x27e)]((_0x5c0cdb,_0x45103b)=>{_0x1e1dc0['forEach']((_0x5b28ab,_0x17efa7)=>{var _0x38863d=a0_0x55c3;if(_0x5b28ab=='Receiving\x20Area'&&_0x45103b==_0x17efa7){console['log'](_0x5b28ab+_0x38863d(0x29a)+_0x45103b+_0x38863d(0x2cc)+_0x17efa7+_0x38863d(0x2cc)+_0x5c0cdb);var _0x23c91e=_0x5c0cdb[_0x38863d(0x285)](0x3);_0x5b3582[_0x45103b][_0x38863d(0x1ee)]=_0x5c0cdb[0x0],_0x5b3582[_0x45103b][_0x38863d(0x1f5)]=_0x5c0cdb[0x1],_0x5b3582[_0x45103b][_0x38863d(0x2b9)]=0x0,_0x5b3582[_0x45103b][_0x38863d(0x241)]=0x0,_0x5b3582[_0x45103b]['type']=_0x38863d(0x2ca),_0x5b3582[_0x45103b]['floorlevel']=_0x23c91e;}else{if(_0x5b28ab==_0x38863d(0x216)&&_0x45103b==_0x17efa7){var _0x23c91e=_0x5c0cdb[_0x38863d(0x285)](0x3);_0x5b3582[_0x45103b]['storage']=_0x5c0cdb[0x0],_0x5b3582[_0x45103b][_0x38863d(0x1f5)]=_0x5c0cdb[0x1],_0x5b3582[_0x45103b][_0x38863d(0x2b9)]=0x0,_0x5b3582[_0x45103b][_0x38863d(0x241)]=0x0,_0x5b3582[_0x45103b][_0x38863d(0x2ba)]=_0x38863d(0x2ca),_0x5b3582[_0x45103b][_0x38863d(0x2c5)]=_0x5c0cdb[0x5];}else{if(_0x45103b==_0x17efa7){if(_0x5c0cdb[0x0]=='A'&&_0x5c0cdb[0x1]=='L'&&_0x5c0cdb[0x2]=='L')console[_0x38863d(0x1fc)](_0x5b28ab+_0x38863d(0x2cc)+_0x45103b+_0x38863d(0x2cc)+_0x17efa7+'\x20<>\x20'+_0x5c0cdb+'here'),_0x5b3582[_0x45103b][_0x38863d(0x1ee)]=_0x5c0cdb[0x0],_0x5b3582[_0x45103b][_0x38863d(0x1f5)]=_0x5c0cdb[0x1],_0x5b3582[_0x45103b][_0x38863d(0x2b9)]=0x0,_0x5b3582[_0x45103b]['bin']=0x0,_0x5b3582[_0x45103b][_0x38863d(0x2ba)]=_0x38863d(0x2ca),_0x5b3582[_0x45103b][_0x38863d(0x2c5)]=_0x5c0cdb[0x3];else{var _0x3d8120;if(_0x5c0cdb[0x4]=='L')_0x3d8120=_0x38863d(0x281);else _0x5c0cdb[0x4]=='F'&&(_0x3d8120=_0x38863d(0x2ca));_0x5b3582[_0x45103b]['storage']=_0x5c0cdb[0x0],_0x5b3582[_0x45103b][_0x38863d(0x1f5)]=_0x5c0cdb[0x1],_0x5b3582[_0x45103b][_0x38863d(0x2b9)]=_0x5c0cdb[0x2],_0x5b3582[_0x45103b][_0x38863d(0x241)]=_0x5c0cdb[0x3],_0x5b3582[_0x45103b][_0x38863d(0x2ba)]=_0x3d8120,_0x5b3582[_0x45103b]['floorlevel']=_0x5c0cdb[0x5];}}}}});}),_0x447dec[_0x2832fd(0x27e)]((_0x59d282,_0x43fa45)=>{var _0x3f55ec=_0x2832fd;_0x5b3582[_0x43fa45][_0x3f55ec(0x248)]=_0x59d282;}),_0x1b88fe[_0x2832fd(0x27e)]((_0x5a3a03,_0x21f7e9)=>{var _0x2043d9=_0x2832fd;_0x5b3582[_0x21f7e9][_0x2043d9(0x1fa)]=_0x5a3a03;}),_0x1d0aca[_0x2832fd(0x27e)]((_0x544717,_0x40a4ba)=>{var _0x2533a7=_0x2832fd;_0x5b3582[_0x40a4ba][_0x2533a7(0x2e3)]=_0x544717;}),_0x9c6b8f[_0x2832fd(0x27e)]((_0x44fd25,_0x46268c)=>{_0x5b3582[_0x46268c]['batch_code']=_0x44fd25;}),_0x58a508[_0x2832fd(0x27e)]((_0x3e73de,_0x50e4d6)=>{_0x5b3582[_0x50e4d6]['expiry_date']=_0x3e73de;}),_0x4b3112[_0x2832fd(0x27e)]((_0x2c744e,_0x55654f)=>{_0x5b3582[_0x55654f]['maxperunit']=_0x2c744e;}),_0x4a6d29[_0x2832fd(0x27e)]((_0x12dbd4,_0x278889)=>{var _0x1012da=_0x2832fd;_0x5b3582[_0x278889][_0x1012da(0x24f)]=_0x12dbd4;}),_0x57b2d8[_0x2832fd(0x27e)]((_0x3bef43,_0x515ee4)=>{_0x5b3582[_0x515ee4]['production_date']=_0x3bef43;}),_0xffb839[_0x2832fd(0x27e)]((_0x3ab4c9,_0x35f907)=>{_0x5b3582[_0x35f907]['product_cat']=_0x3ab4c9;}),_0x1e1dc0['forEach']((_0x321787,_0x1239c4)=>{var _0x18a581=_0x2832fd;_0x5b3582[_0x1239c4][_0x18a581(0x2d8)]=_0x321787;}),_0x30ea67[_0x2832fd(0x27e)]((_0x4f8173,_0x5bc54d)=>{_0x5b3582[_0x5bc54d]['delivery_date']=_0x4f8173;}),_0x157122[_0x2832fd(0x27e)]((_0x5002df,_0x94f5ca)=>{var _0x249978=_0x2832fd;_0x5b3582[_0x94f5ca][_0x249978(0x254)]=_0x5002df;}),_0x4dd89d[_0x2832fd(0x27e)]((_0x49c557,_0x18a55b)=>{var _0x192b2f=_0x2832fd;_0x5b3582[_0x18a55b][_0x192b2f(0x26f)]=_0x49c557;});const _0x2ec59f=_0x1e1dc0['map'](_0x369876=>{return _0x369876={'room_name':_0x369876};}),_0x2a02ae=_0x5b3582[_0x2832fd(0x247)](_0x5001bd=>_0x5001bd['quantity']!=='0'&&_0x5001bd[_0x2832fd(0x2fd)]!==''),_0x4f0b86=new purchases({'invoice':_0x3638f6,'suppliers':_0x5634cf['body'][_0x2832fd(0x29e)],'date':_0xf24d5a,'warehouse_name':_0xf17db5,'product':_0x2a02ae,'note':_0x37386a,'due_amount':_0x4eedeb,'POnumber':_0x13a9d5,'SCRN':_0x1ecec8,'JO_number':_0x3e6af9,'roomList':_0x2ec59f}),_0x3b3989=await _0x4f0b86[_0x2832fd(0x297)](),_0x1da5a3=await purchases[_0x2832fd(0x215)]({'invoice':_0x3638f6}),_0x934998=_0x1da5a3[_0x2832fd(0x252)][_0x2832fd(0x26c)](async _0x26dede=>{var _0xa8968=_0x2832fd,_0x58e21a=await warehouse[_0xa8968(0x215)]({'name':_0xf17db5,'room':_0x26dede[_0xa8968(0x2d8)]}),_0x685557=0x0;return _0x58e21a['product_details'][_0xa8968(0x27e)](_0x39f37b=>{var _0x1d3524=_0xa8968;_0x39f37b[_0x1d3524(0x214)]==_0x26dede[_0x1d3524(0x214)]&&_0x39f37b[_0x1d3524(0x2c5)]==_0x26dede['floorlevel']&&_0x39f37b[_0x1d3524(0x2ba)]==_0x26dede['type']&&_0x39f37b[_0x1d3524(0x241)]==_0x26dede['bin']&&_0x39f37b[_0x1d3524(0x2b9)]==_0x26dede[_0x1d3524(0x2b9)]&&_0x39f37b[_0x1d3524(0x1f5)]==_0x26dede[_0x1d3524(0x1f5)]&&_0x39f37b[_0x1d3524(0x1ee)]==_0x26dede[_0x1d3524(0x1ee)]&&_0x39f37b['expiry_date']==_0x26dede['expiry_date']&&_0x39f37b[_0x1d3524(0x23c)]==_0x26dede[_0x1d3524(0x23c)]&&_0x39f37b[_0x1d3524(0x204)]==_0x26dede[_0x1d3524(0x204)]&&_0x39f37b[_0x1d3524(0x26f)]==_0x1da5a3[_0x1d3524(0x26f)]&&(_0x39f37b[_0x1d3524(0x2e8)]+=Math['abs'](_0x26dede[_0x1d3524(0x2fd)]),_0x685557++);}),_0x685557===0x0&&_0x58e21a[_0xa8968(0x1f0)][_0xa8968(0x257)]({'product_name':_0x26dede[_0xa8968(0x214)],'product_stock':Math[_0xa8968(0x222)](_0x26dede[_0xa8968(0x2fd)]),'primary_code':_0x26dede['primary_code'],'secondary_code':_0x26dede[_0xa8968(0x1fa)],'product_code':_0x26dede['product_code'],'storage':_0x26dede[_0xa8968(0x1ee)],'rack':_0x26dede[_0xa8968(0x1f5)],'bay':_0x26dede[_0xa8968(0x2b9)],'bin':_0x26dede[_0xa8968(0x241)],'type':_0x26dede['type'],'floorlevel':_0x26dede[_0xa8968(0x2c5)],'maxProducts':_0x26dede['maxStocks'],'unit':_0x26dede[_0xa8968(0x2db)],'secondary_unit':_0x26dede[_0xa8968(0x2a4)],'expiry_date':_0x26dede[_0xa8968(0x2ad)],'maxPerUnit':_0x26dede[_0xa8968(0x2f8)],'batch_code':_0x26dede[_0xa8968(0x23c)],'alertQTY':_0x26dede[_0xa8968(0x24f)],'production_date':_0x26dede[_0xa8968(0x204)],'product_cat':_0x26dede[_0xa8968(0x2fb)],'invoice':_0x26dede[_0xa8968(0x26f)],'actual_qty':Math[_0xa8968(0x222)](_0x26dede[_0xa8968(0x2f4)]),'actual_uom':_0x26dede[_0xa8968(0x23e)],'delivery_date':_0x26dede[_0xa8968(0x211)],'delivery_code':_0x26dede['delivery_code']}),_0x58e21a;});Promise['all'](_0x934998)[_0x2832fd(0x20d)](async _0x1eaea9=>{var _0x573537=_0x2832fd;try{for(const _0x2fe5b7 of _0x1eaea9){await _0x2fe5b7[_0x573537(0x297)]();}const _0xf7c1b8=await master_shop['find'](),_0x160f10=await email_settings['findOne'](),_0x22812c=await supervisor_settings['find']();var _0x5935fc=_0x1da5a3[_0x573537(0x252)],_0x35d3ee='',_0x2e8ef0;for(_0x2e8ef0 in _0x5935fc){_0x35d3ee+=_0x573537(0x1fe)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5935fc[_0x2e8ef0][_0x573537(0x214)]+_0x573537(0x206)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5935fc[_0x2e8ef0][_0x573537(0x27d)]+_0x573537(0x206)+_0x573537(0x2a1)+_0x5935fc[_0x2e8ef0][_0x573537(0x2fd)]+_0x573537(0x206)+_0x573537(0x2a1)+_0x5935fc[_0x2e8ef0]['standard_unit']+_0x573537(0x206)+_0x573537(0x2a1)+_0x5935fc[_0x2e8ef0][_0x573537(0x2a4)]+_0x573537(0x206)+_0x573537(0x2a1)+_0x1da5a3[_0x573537(0x24c)]+'</td>'+_0x573537(0x2a1)+_0x5935fc[_0x2e8ef0][_0x573537(0x2d8)]+_0x573537(0x206)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5935fc[_0x2e8ef0]['storage']+_0x5935fc[_0x2e8ef0][_0x573537(0x1f5)]+_0x5935fc[_0x2e8ef0][_0x573537(0x2b9)]+_0x5935fc[_0x2e8ef0][_0x573537(0x241)]+_0x5935fc[_0x2e8ef0]['type'][0x0]+_0x5935fc[_0x2e8ef0][_0x573537(0x2c5)]+'</td>',_0x573537(0x1f2);}let _0x399366=nodemailer[_0x573537(0x1e9)]({'host':_0x160f10[_0x573537(0x288)],'port':Number(_0x160f10[_0x573537(0x2d7)]),'secure':![],'auth':{'user':_0x160f10[_0x573537(0x1f1)],'pass':_0x160f10[_0x573537(0x245)]}}),_0xb30705={'from':_0x160f10[_0x573537(0x1f1)],'to':_0x22812c[0x0][_0x573537(0x2df)],'subject':_0x573537(0x289),'attachments':[{'filename':'Logo.png','path':__dirname+_0x573537(0x272)+'/upload/'+_0xf7c1b8[0x0][_0x573537(0x20b)],'cid':'logo'}],'html':_0x573537(0x28b)+_0x573537(0x292)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x573537(0x2f6)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x573537(0x220)+'<div>'+_0x573537(0x21b)+_0xf7c1b8[0x0][_0x573537(0x265)]+_0x573537(0x277)+_0x573537(0x220)+_0x573537(0x220)+'<hr\x20class=\x22my-3\x22>'+_0x573537(0x2f6)+_0x573537(0x249)+_0x573537(0x280)+_0x1da5a3[_0x573537(0x26f)]+'\x20'+_0x573537(0x2a2)+_0x573537(0x2b8)+_0x1da5a3[_0x573537(0x28f)]+'\x20'+_0x573537(0x25a)+_0x573537(0x267)+_0x573537(0x220)+_0x573537(0x262)+_0x573537(0x21a)+'<tr>'+_0x573537(0x2e9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x573537(0x302)+_0x573537(0x235)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x573537(0x1f4)+'</tr>'+_0x573537(0x25c)+_0x573537(0x296)+'\x20'+_0x35d3ee+'\x20'+'</tbody>'+_0x573537(0x284)+'<div>'+_0x573537(0x1fd)+_0x573537(0x2cf)+_0xf7c1b8[0x0][_0x573537(0x265)]+'</h5>'+_0x573537(0x220)+'</div>'+'</body></html>'};_0x399366[_0x573537(0x294)](_0xb30705,function(_0x45e47a,_0x1ecc12){var _0x5498a6=_0x573537;_0x45e47a?(console[_0x5498a6(0x1fc)](_0x45e47a),console['log'](_0x5498a6(0x2d2))):console['log'](_0x5498a6(0x253));}),_0x5634cf['flash'](_0x573537(0x20c),'Purchase\x20data\x20added\x20successfully'),_0x1ae47b[_0x573537(0x246)]('/all_purchases/view/');}catch(_0x20d8dc){console['error'](_0x20d8dc),_0x1ae47b['status'](0x1f4)[_0x573537(0x223)]({'error':_0x573537(0x2d6)});}})[_0x2832fd(0x210)](_0x3c2fd0=>{var _0x400e98=_0x2832fd;console[_0x400e98(0x27b)](_0x3c2fd0),_0x1ae47b[_0x400e98(0x22b)](0x1f4)['json']({'error':_0x400e98(0x28e)});});}catch(_0x48b278){console['log'](_0x48b278);}}),router[a0_0x19dad8(0x221)](a0_0x19dad8(0x1f3),auth,async(_0x5dce99,_0x459ec2)=>{var _0x3238b3=a0_0x19dad8;try{const {username:_0x497d22,email:_0x6b33af,role:_0x58643f}=_0x5dce99[_0x3238b3(0x202)],_0x5bf58e=_0x5dce99[_0x3238b3(0x202)],_0x56151e=await profile[_0x3238b3(0x215)]({'email':_0x5bf58e[_0x3238b3(0x1f1)]}),_0x2578ec=await master_shop['find'](),_0x254b3a=_0x5dce99[_0x3238b3(0x2f2)]['id'],_0x4b4ef4=await purchases[_0x3238b3(0x230)](_0x254b3a),_0x2b2421=await warehouse[_0x3238b3(0x29f)]([{'$match':{'name':_0x4b4ef4[_0x3238b3(0x24c)],'room':_0x4b4ef4[_0x3238b3(0x2b1)]}},{'$unwind':_0x3238b3(0x258)},{'$group':{'_id':_0x3238b3(0x24a),'name':{'$first':_0x3238b3(0x259)},'product_stock':{'$first':_0x3238b3(0x2c0)},'bay':{'$first':_0x3238b3(0x2d4)},'bin':{'$first':_0x3238b3(0x201)},'type':{'$first':_0x3238b3(0x2bc)},'floorlevel':{'$first':_0x3238b3(0x264)},'primary_code':{'$first':_0x3238b3(0x2c2)},'secondary_code':{'$first':_0x3238b3(0x1ff)},'product_code':{'$first':_0x3238b3(0x29d)},'storage':{'$first':_0x3238b3(0x2da)},'rack':{'$first':_0x3238b3(0x224)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x63c646=await customer[_0x3238b3(0x21c)]({});let _0x2648be;if(_0x5bf58e[_0x3238b3(0x278)]==_0x3238b3(0x2c7)){const _0x191406=await staff[_0x3238b3(0x215)]({'email':_0x5bf58e[_0x3238b3(0x1f1)]});_0x2648be=await warehouse[_0x3238b3(0x29f)]([{'$match':{'status':_0x3238b3(0x2f1),'name':_0x191406[_0x3238b3(0x28d)]}},{'$group':{'_id':_0x3238b3(0x2e2),'name':{'$first':'$name'}}}]);}else _0x2648be=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x3238b3(0x2e2),'name':{'$first':_0x3238b3(0x2e2)}}}]);const _0x535820=await product['find']({}),_0x5e1c30=await suppliers[_0x3238b3(0x21c)]({}),_0x583fea=BayBinSelected(_0x4b4ef4['warehouse_name'],_0x4b4ef4['room']);if(_0x2578ec[0x0][_0x3238b3(0x2a6)]==_0x3238b3(0x290)){var _0x179490=users[_0x3238b3(0x231)];console['log'](_0x179490);}else{if(_0x2578ec[0x0][_0x3238b3(0x2a6)]=='Hindi')var _0x179490=users[_0x3238b3(0x251)];else{if(_0x2578ec[0x0]['language']==_0x3238b3(0x291))var _0x179490=users['German'];else{if(_0x2578ec[0x0][_0x3238b3(0x2a6)]==_0x3238b3(0x244))var _0x179490=users[_0x3238b3(0x244)];else{if(_0x2578ec[0x0][_0x3238b3(0x2a6)]==_0x3238b3(0x2c8))var _0x179490=users[_0x3238b3(0x2c8)];else{if(_0x2578ec[0x0][_0x3238b3(0x2a6)]==_0x3238b3(0x2a3))var _0x179490=users[_0x3238b3(0x2d3)];else{if(_0x2578ec[0x0]['language']=='Chinese')var _0x179490=users[_0x3238b3(0x2c1)];else{if(_0x2578ec[0x0][_0x3238b3(0x2a6)]==_0x3238b3(0x243))var _0x179490=users[_0x3238b3(0x275)];}}}}}}}_0x459ec2[_0x3238b3(0x2b0)]('edit_purchases_view',{'success':_0x5dce99[_0x3238b3(0x2fc)]('success'),'errors':_0x5dce99['flash']('errors'),'role':_0x5bf58e,'profile':_0x56151e,'customer':_0x63c646,'warehouse':_0x2648be,'product':_0x2b2421,'user':_0x4b4ef4,'master_shop':_0x2578ec,'unit':_0x535820,'language':_0x179490,'suppliers':_0x5e1c30,'dataSelected':_0x583fea});}catch(_0x2f30ed){console[_0x3238b3(0x1fc)](_0x2f30ed);}}),router['post'](a0_0x19dad8(0x1f3),auth,async(_0x29feca,_0x51f7d3)=>{var _0x44ed7b=a0_0x19dad8;try{const _0x91bd06=_0x29feca['params']['id'],{invoice:_0x347752,warehouse_name:_0x30a616,Room_name:_0x24ec2a}=_0x29feca[_0x44ed7b(0x236)],_0x4bc23b=await warehouse[_0x44ed7b(0x215)]({'name':_0x30a616,'room':_0x24ec2a}),_0x27b7b7=await purchases[_0x44ed7b(0x215)]({'invoice':_0x347752});_0x27b7b7['product']['forEach'](_0x597fc3=>{var _0x247c17=_0x44ed7b,_0x35df38=0x0;const _0x450669=_0x4bc23b[_0x247c17(0x1f0)][_0x247c17(0x26c)](_0x4eff50=>{var _0x428679=_0x247c17;_0x4eff50[_0x428679(0x214)]==_0x597fc3[_0x428679(0x214)]&&_0x4eff50['floorlevel']==_0x597fc3[_0x428679(0x2c5)]&&_0x4eff50[_0x428679(0x2ba)]==_0x597fc3[_0x428679(0x2ba)]&&_0x4eff50[_0x428679(0x241)]==_0x597fc3[_0x428679(0x241)]&&_0x4eff50[_0x428679(0x2b9)]==_0x597fc3['bay']&&_0x4eff50[_0x428679(0x1f5)]==_0x597fc3['rack']&&_0x4eff50['storage']==_0x597fc3[_0x428679(0x1ee)]&&_0x4eff50[_0x428679(0x2ad)]==_0x597fc3[_0x428679(0x2ad)]&&_0x4eff50[_0x428679(0x23c)]==_0x597fc3[_0x428679(0x23c)]&&_0x4eff50[_0x428679(0x204)]==_0x597fc3[_0x428679(0x204)]&&_0x4eff50['delivery_date']==_0x597fc3[_0x428679(0x211)]&&_0x4eff50[_0x428679(0x254)]==_0x597fc3[_0x428679(0x254)]&&(_0x4eff50[_0x428679(0x2e8)]=parseInt(_0x4eff50['product_stock'])+parseInt(_0x597fc3[_0x428679(0x2fd)]),_0x35df38++);});_0x35df38=='0'&&(_0x4bc23b[_0x247c17(0x1f0)]=_0x4bc23b['product_details'][_0x247c17(0x229)]({'product_name':_0x597fc3[_0x247c17(0x214)],'product_stock':_0x597fc3[_0x247c17(0x2fd)],'primary_code':_0x597fc3[_0x247c17(0x248)],'secondary_code':_0x597fc3[_0x247c17(0x1fa)],'product_code':_0x597fc3[_0x247c17(0x27d)],'storage':_0x597fc3[_0x247c17(0x1ee)],'rack':_0x597fc3[_0x247c17(0x1f5)],'bay':_0x597fc3[_0x247c17(0x2b9)],'bin':_0x597fc3[_0x247c17(0x241)],'type':_0x597fc3[_0x247c17(0x2ba)],'floorlevel':_0x597fc3['floorlevel'],'maxProducts':_0x597fc3[_0x247c17(0x2e3)],'unit':_0x597fc3['standard_unit'],'secondary_unit':_0x597fc3[_0x247c17(0x2a4)],'expiry_date':_0x597fc3[_0x247c17(0x2ad)],'maxPerUnit':_0x597fc3[_0x247c17(0x2f8)],'batch_code':_0x597fc3[_0x247c17(0x23c)],'alertQTY':_0x597fc3['alertQTY'],'production_date':_0x597fc3[_0x247c17(0x204)],'delivery_date':_0x597fc3['delivery_date'],'delivery_code':_0x597fc3['delivery_code']}));}),await _0x4bc23b[_0x44ed7b(0x297)](),_0x27b7b7[_0x44ed7b(0x2f5)]=_0x44ed7b(0x22e);const _0x22be96=await _0x27b7b7['save']();_0x29feca['flash'](_0x44ed7b(0x20c),_0x44ed7b(0x21f)),_0x51f7d3[_0x44ed7b(0x246)](_0x44ed7b(0x1ec));}catch(_0x57608e){console[_0x44ed7b(0x1fc)](_0x57608e);}}),router[a0_0x19dad8(0x221)](a0_0x19dad8(0x26b),auth,async(_0x59b151,_0x223a66)=>{var _0x4fe883=a0_0x19dad8;try{const {username:_0x46c354,email:_0x5686d6,role:_0x245187}=_0x59b151['user'],_0x425b5f=_0x59b151[_0x4fe883(0x202)],_0x2c8104=await profile[_0x4fe883(0x215)]({'email':_0x425b5f[_0x4fe883(0x1f1)]}),_0x2a7bc0=await master_shop[_0x4fe883(0x21c)](),_0xa4b649=_0x59b151['params']['id'],_0x2e6200=await purchases[_0x4fe883(0x230)](_0xa4b649),_0x4a4ab0=await suppliers['find']({});let _0x3720cf;if(_0x425b5f[_0x4fe883(0x278)]==_0x4fe883(0x2c7)){const _0x4faca1=await staff[_0x4fe883(0x215)]({'email':_0x425b5f[_0x4fe883(0x1f1)]});_0x3720cf=await warehouse[_0x4fe883(0x21c)]({'status':_0x4fe883(0x2f1),'name':_0x4faca1[_0x4fe883(0x28d)],'warehouse_category':_0x4fe883(0x24b)});}else _0x3720cf=await warehouse[_0x4fe883(0x29f)]([{'$match':{'status':_0x4fe883(0x2f1),'warehouse_category':_0x4fe883(0x24b)}},{'$group':{'_id':_0x4fe883(0x2e2),'name':{'$first':_0x4fe883(0x2e2)}}}]);const _0x57f6d3=await product[_0x4fe883(0x21c)]({}),_0x5205ca=BayBinSelected(_0x2e6200[_0x4fe883(0x24c)],_0x2e6200['room']);let _0x27e424=new Date(_0x2e6200[_0x4fe883(0x2ad)]),_0x185fc4=('0'+_0x27e424[_0x4fe883(0x22d)]())[_0x4fe883(0x285)](-0x2),_0x1e7740=('0'+(_0x27e424[_0x4fe883(0x20f)]()+0x1))['slice'](-0x2),_0x1f9627=_0x27e424[_0x4fe883(0x1e8)](),_0x1dcbe4=_0x1f9627+'-'+_0x1e7740+'-'+_0x185fc4;if(_0x2a7bc0[0x0]['language']==_0x4fe883(0x290)){var _0x531c45=users[_0x4fe883(0x231)];console[_0x4fe883(0x1fc)](_0x531c45);}else{if(_0x2a7bc0[0x0][_0x4fe883(0x2a6)]==_0x4fe883(0x251))var _0x531c45=users[_0x4fe883(0x251)];else{if(_0x2a7bc0[0x0][_0x4fe883(0x2a6)]==_0x4fe883(0x291))var _0x531c45=users['German'];else{if(_0x2a7bc0[0x0][_0x4fe883(0x2a6)]==_0x4fe883(0x244))var _0x531c45=users[_0x4fe883(0x244)];else{if(_0x2a7bc0[0x0][_0x4fe883(0x2a6)]==_0x4fe883(0x2c8))var _0x531c45=users[_0x4fe883(0x2c8)];else{if(_0x2a7bc0[0x0]['language']==_0x4fe883(0x2a3))var _0x531c45=users[_0x4fe883(0x2d3)];else{if(_0x2a7bc0[0x0][_0x4fe883(0x2a6)]==_0x4fe883(0x2c1))var _0x531c45=users[_0x4fe883(0x2c1)];else{if(_0x2a7bc0[0x0][_0x4fe883(0x2a6)]==_0x4fe883(0x243))var _0x531c45=users['Arabic'];}}}}}}}_0x223a66['render'](_0x4fe883(0x219),{'success':_0x59b151['flash'](_0x4fe883(0x20c)),'errors':_0x59b151[_0x4fe883(0x2fc)](_0x4fe883(0x28a)),'role':_0x425b5f,'profile':_0x2c8104,'purchases':_0x2e6200,'suppliers':_0x4a4ab0,'warehouse':_0x3720cf,'product':_0x57f6d3,'master_shop':_0x2a7bc0,'language':_0x531c45,'ed_fullDate':_0x1dcbe4,'dataSelected':_0x5205ca});}catch(_0x2e1d00){console[_0x4fe883(0x1fc)](_0x2e1d00);}}),router[a0_0x19dad8(0x225)](a0_0x19dad8(0x26b),auth,async(_0x284832,_0x4daea3)=>{var _0x4b2626=a0_0x19dad8;try{const _0x5e1ced=_0x284832[_0x4b2626(0x2f2)]['id'],_0x35c959=await purchases[_0x4b2626(0x215)]({'_id':_0x284832[_0x4b2626(0x2f2)]['id']}),_0x1d6519=await warehouse[_0x4b2626(0x215)]({'name':_0x35c959[_0x4b2626(0x24c)],'room':_0x35c959['room']});_0x35c959[_0x4b2626(0x252)][_0x4b2626(0x27e)](_0x592fd4=>{var _0x117fd4=_0x4b2626;const _0x3c5c60=_0x1d6519[_0x117fd4(0x1f0)][_0x117fd4(0x26c)](_0x4a506=>{var _0x559848=_0x117fd4;_0x4a506[_0x559848(0x214)]==_0x592fd4[_0x559848(0x214)]&&_0x4a506['floorlevel']==_0x592fd4[_0x559848(0x2c5)]&&_0x4a506[_0x559848(0x2ba)]==_0x592fd4[_0x559848(0x2ba)]&&_0x4a506[_0x559848(0x241)]==_0x592fd4['bin']&&_0x4a506['bay']==_0x592fd4[_0x559848(0x2b9)]&&_0x4a506['rack']==_0x592fd4['rack']&&_0x4a506[_0x559848(0x1ee)]==_0x592fd4[_0x559848(0x1ee)]&&(_0x4a506[_0x559848(0x2e8)]=parseInt(_0x4a506[_0x559848(0x2e8)])-parseInt(_0x592fd4[_0x559848(0x2fd)]));});}),await _0x1d6519[_0x4b2626(0x297)]();const {invoice:_0x5ded36,suppliers:_0xa49259,date:_0x4dfcf7,warehouse_name:_0x22a5a2,prod_name:_0x4e0457,prod_code:_0x4db87a,prod_qty:_0x4529f1,prod_unit:_0x2ef8a7,prod_secondunit:_0x14c3a0,prod_level:_0x4d2f81,prod_isle:_0x34027d,prod_pallet:_0x179477,note:_0x5b5848,expiry_date:_0x9a5095,batch_code:_0x4f981d,paid_amount:_0x25d229,due_amount:_0x42070e,Room_name:_0x25e82d,primary_code:_0x4bd18d,secondary_code:_0x44d5f9,PO_number:_0x2a8eeb,JO_number:_0x28194b}=_0x284832[_0x4b2626(0x236)];if(typeof _0x4e0457==_0x4b2626(0x242))var _0x1432c4=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x2d1)]],_0x4f2412=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x213)]],_0x2f7187=[_0x284832[_0x4b2626(0x236)]['prod_qty']],_0x42dc94=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x2fe)]],_0x35b4ab=[_0x284832[_0x4b2626(0x236)]['prod_secondunit']],_0x242e94=[_0x284832[_0x4b2626(0x236)]['prod_level']],_0x559ed9=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x300)]],_0x12f571=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x29c)]],_0x432581=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x248)]],_0x10f067=[_0x284832['body']['secondary_code']],_0x24acfb=[_0x284832['body'][_0x4b2626(0x232)]],_0x5c43c2=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x23c)]],_0x5ec8a0=[_0x284832[_0x4b2626(0x236)]['expiry_date']],_0x387ae3=[_0x284832['body']['storage']],_0x5d4501=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x2a8)]],_0x38f89f=[_0x284832[_0x4b2626(0x236)][_0x4b2626(0x2ba)]];else var _0x1432c4=[..._0x284832['body'][_0x4b2626(0x2d1)]],_0x4f2412=[..._0x284832['body'][_0x4b2626(0x213)]],_0x2f7187=[..._0x284832[_0x4b2626(0x236)]['prod_qty']],_0x42dc94=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x2fe)]],_0x35b4ab=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x2ae)]],_0x242e94=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x298)]],_0x559ed9=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x300)]],_0x12f571=[..._0x284832['body']['prod_pallet']],_0x432581=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x248)]],_0x10f067=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x1fa)]],_0x24acfb=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x232)]],_0x5c43c2=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x23c)]],_0x5ec8a0=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x2ad)]],_0x387ae3=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x1ee)]],_0x5d4501=[..._0x284832[_0x4b2626(0x236)]['rak']],_0x38f89f=[..._0x284832[_0x4b2626(0x236)][_0x4b2626(0x2ba)]];const _0x3fffd5=_0x1432c4[_0x4b2626(0x26c)](_0x51203f=>{return _0x51203f={'product_name':_0x51203f};});_0x4f2412['forEach']((_0x23b328,_0x5c4a6c)=>{var _0x16e83d=_0x4b2626;_0x3fffd5[_0x5c4a6c][_0x16e83d(0x27d)]=_0x23b328;}),_0x2f7187[_0x4b2626(0x27e)]((_0x35da82,_0x6f71c9)=>{var _0x53b66c=_0x4b2626;_0x3fffd5[_0x6f71c9][_0x53b66c(0x2fd)]=_0x35da82;}),_0x42dc94['forEach']((_0x43546e,_0xe20cad)=>{var _0xf55256=_0x4b2626;_0x3fffd5[_0xe20cad][_0xf55256(0x2db)]=_0x43546e;}),_0x35b4ab[_0x4b2626(0x27e)]((_0x4e5578,_0x57251d)=>{var _0x58b755=_0x4b2626;_0x3fffd5[_0x57251d][_0x58b755(0x2a4)]=_0x4e5578;}),_0x242e94['forEach']((_0x976e55,_0x563d33)=>{var _0x12cd41=_0x4b2626;_0x3fffd5[_0x563d33][_0x12cd41(0x2b9)]=_0x976e55;}),_0x559ed9[_0x4b2626(0x27e)]((_0x44f878,_0x5a8b2d)=>{var _0x1247df=_0x4b2626;_0x3fffd5[_0x5a8b2d][_0x1247df(0x241)]=_0x44f878;}),_0x12f571[_0x4b2626(0x27e)]((_0x4d03d0,_0x6ca561)=>{var _0x1187df=_0x4b2626;_0x3fffd5[_0x6ca561][_0x1187df(0x2c5)]=_0x4d03d0;}),_0x432581[_0x4b2626(0x27e)]((_0x1e4b66,_0x5a2d6)=>{_0x3fffd5[_0x5a2d6]['primary_code']=_0x1e4b66;}),_0x10f067[_0x4b2626(0x27e)]((_0x208334,_0x2c292a)=>{var _0x1d7a38=_0x4b2626;_0x3fffd5[_0x2c292a][_0x1d7a38(0x1fa)]=_0x208334;}),_0x24acfb['forEach']((_0x28861c,_0x180fc7)=>{_0x3fffd5[_0x180fc7]['maxStocks']=_0x28861c;}),_0x5c43c2[_0x4b2626(0x27e)]((_0x397f4d,_0x167c55)=>{var _0x3e46e7=_0x4b2626;_0x3fffd5[_0x167c55][_0x3e46e7(0x23c)]=_0x397f4d;}),_0x5ec8a0[_0x4b2626(0x27e)]((_0x1cb459,_0x2acbb7)=>{_0x3fffd5[_0x2acbb7]['expiry_date']=_0x1cb459;}),_0x38f89f[_0x4b2626(0x27e)]((_0x9138c9,_0x2028bb)=>{var _0x4464f3=_0x4b2626;_0x3fffd5[_0x2028bb][_0x4464f3(0x2ba)]=_0x9138c9;}),_0x387ae3[_0x4b2626(0x27e)]((_0x3b6beb,_0x3c2062)=>{var _0x51ee59=_0x4b2626;_0x3fffd5[_0x3c2062][_0x51ee59(0x1ee)]=_0x3b6beb;}),_0x5d4501['forEach']((_0x38b71f,_0x238ea5)=>{var _0x1f0741=_0x4b2626;_0x3fffd5[_0x238ea5][_0x1f0741(0x1f5)]=_0x38b71f;});const _0x94b00d=_0x3fffd5['filter'](_0x8fa5b2=>_0x8fa5b2[_0x4b2626(0x2fd)]!=='0'&&_0x8fa5b2['quantity']!=='');_0x35c959['invoice']=_0x5ded36,_0x35c959[_0x4b2626(0x29e)]=_0xa49259,_0x35c959[_0x4b2626(0x28f)]=_0x4dfcf7,_0x35c959[_0x4b2626(0x24c)]=_0x22a5a2,_0x35c959[_0x4b2626(0x252)]=_0x94b00d,_0x35c959['note']=_0x5b5848,_0x35c959[_0x4b2626(0x256)]=_0x25d229,_0x35c959[_0x4b2626(0x237)]=_0x42070e,_0x35c959[_0x4b2626(0x2b1)]=_0x25e82d,_0x35c959[_0x4b2626(0x2b4)]=_0x2a8eeb,_0x35c959['JO_number']=_0x28194b;const _0x5c6a2a=await _0x35c959[_0x4b2626(0x297)](),_0x3c4704=await warehouse[_0x4b2626(0x215)]({'name':_0x284832[_0x4b2626(0x236)]['warehouse_name'],'room':_0x284832[_0x4b2626(0x236)][_0x4b2626(0x1f9)]});_0x35c959['product'][_0x4b2626(0x27e)](_0x2caa97=>{var _0x3704d5=_0x4b2626,_0x518629=0x0;const _0x57d528=_0x3c4704[_0x3704d5(0x1f0)][_0x3704d5(0x26c)](_0x2f748e=>{var _0x1ed7fd=_0x3704d5;_0x2f748e[_0x1ed7fd(0x214)]==_0x2caa97[_0x1ed7fd(0x214)]&&_0x2f748e[_0x1ed7fd(0x2c5)]==_0x2caa97[_0x1ed7fd(0x2c5)]&&_0x2f748e[_0x1ed7fd(0x2ba)]==_0x2caa97['type']&&_0x2f748e[_0x1ed7fd(0x241)]==_0x2caa97[_0x1ed7fd(0x241)]&&_0x2f748e[_0x1ed7fd(0x2b9)]==_0x2caa97[_0x1ed7fd(0x2b9)]&&_0x2f748e[_0x1ed7fd(0x1f5)]==_0x2caa97[_0x1ed7fd(0x1f5)]&&_0x2f748e['storage']==_0x2caa97[_0x1ed7fd(0x1ee)]&&(_0x2f748e[_0x1ed7fd(0x2e8)]=parseInt(_0x2f748e[_0x1ed7fd(0x2e8)])+parseInt(_0x2caa97[_0x1ed7fd(0x2fd)]),_0x518629++);});_0x518629=='0'&&(_0x3c4704[_0x3704d5(0x1f0)]=_0x3c4704[_0x3704d5(0x1f0)][_0x3704d5(0x229)]({'product_name':_0x2caa97['product_name'],'product_stock':_0x2caa97[_0x3704d5(0x2fd)],'primary_code':_0x2caa97['primary_code'],'secondary_code':_0x2caa97[_0x3704d5(0x1fa)],'product_code':_0x2caa97[_0x3704d5(0x27d)],'storage':_0x2caa97['storage'],'rack':_0x2caa97[_0x3704d5(0x1f5)],'bay':_0x2caa97[_0x3704d5(0x2b9)],'bin':_0x2caa97[_0x3704d5(0x241)],'type':_0x2caa97[_0x3704d5(0x2ba)],'floorlevel':_0x2caa97[_0x3704d5(0x2c5)],'maxProducts':_0x2caa97[_0x3704d5(0x2e3)],'unit':_0x2caa97[_0x3704d5(0x2db)],'secondary_unit':_0x2caa97[_0x3704d5(0x2a4)],'expiry_date':_0x2caa97['expiry_date']}));}),await _0x3c4704[_0x4b2626(0x297)]();const _0x27452a=await s_payment_data[_0x4b2626(0x215)]({'invoice':_0x284832[_0x4b2626(0x236)][_0x4b2626(0x26f)]});if(_0x27452a===null){}else console['log'](_0x4b2626(0x29e),_0x27452a,_0x284832[_0x4b2626(0x236)][_0x4b2626(0x26f)]),_0x27452a[_0x4b2626(0x29e)]=_0x284832[_0x4b2626(0x236)][_0x4b2626(0x29e)],await _0x27452a[_0x4b2626(0x297)]();_0x284832['flash'](_0x4b2626(0x20c),'purchase\x20data\x20update\x20successfully'),_0x4daea3[_0x4b2626(0x246)](_0x4b2626(0x1ec));}catch(_0x4e9a06){console[_0x4b2626(0x1fc)](_0x4e9a06);}}),router[a0_0x19dad8(0x225)](a0_0x19dad8(0x2b2),auth,async(_0x32734c,_0x431936)=>{var _0xbadd03=a0_0x19dad8;try{const _0x103716=_0x32734c[_0xbadd03(0x2f2)]['id'],{invoice:_0x59d53d,suppliers:_0x199b46,payable:_0x3db7a,due_amount:_0x25a9f5}=_0x32734c[_0xbadd03(0x236)],_0x14d7e5=await purchases[_0xbadd03(0x230)](_0x103716);var _0x407d11=_0x3db7a-_0x25a9f5;_0x14d7e5[_0xbadd03(0x256)]=parseFloat(_0x14d7e5[_0xbadd03(0x256)])+parseFloat(_0x25a9f5),_0x14d7e5[_0xbadd03(0x237)]=_0x407d11;const _0x23c5d1=await _0x14d7e5[_0xbadd03(0x297)]();console[_0xbadd03(0x1fc)](_0x23c5d1);const _0x3784c6=await s_payment_data[_0xbadd03(0x215)]({'invoice':_0x59d53d});_0x3784c6['amount']=_0x407d11,await _0x3784c6[_0xbadd03(0x297)]();let _0x14bcdb=new Date(),_0x28c6d3=('0'+_0x14bcdb[_0xbadd03(0x22d)]())['slice'](-0x2),_0x512e41=('0'+(_0x14bcdb[_0xbadd03(0x20f)]()+0x1))[_0xbadd03(0x285)](-0x2),_0x2f223e=_0x14bcdb[_0xbadd03(0x1e8)](),_0x519e41=_0x2f223e+'-'+_0x512e41+'-'+_0x28c6d3;const _0x40592b=new suppliers_payment({'invoice':_0x59d53d,'date':_0x2f223e+'-'+_0x512e41+'-'+_0x28c6d3,'suppliers':_0x199b46,'reason':_0xbadd03(0x255),'amount':_0x25a9f5}),_0xccd1f9=await _0x40592b[_0xbadd03(0x297)]();_0x32734c[_0xbadd03(0x2fc)](_0xbadd03(0x20c),_0xbadd03(0x274)),_0x431936[_0xbadd03(0x246)](_0xbadd03(0x1ec));}catch(_0x45e607){console['log'](_0x45e607);}}),router[a0_0x19dad8(0x221)]('/invoice/:id',auth,async(_0x55e351,_0x477d35)=>{var _0x350952=a0_0x19dad8;try{const {username:_0x449397,email:_0x238201,role:_0xa55d9b}=_0x55e351[_0x350952(0x202)],_0x384b2c=_0x55e351['user'],_0x446749=await profile[_0x350952(0x215)]({'email':_0x384b2c['email']}),_0x175bd1=await master_shop[_0x350952(0x21c)]();console[_0x350952(0x1fc)](_0x350952(0x240),_0x175bd1);const _0x2f642f=_0x55e351[_0x350952(0x2f2)]['id'],_0x20e96e=await purchases[_0x350952(0x230)](_0x2f642f);console['log'](_0x20e96e);const _0x1c16b1=await suppliers['findOne']({'name':_0x20e96e[_0x350952(0x29e)]});console['log'](_0x1c16b1);if(_0x175bd1[0x0][_0x350952(0x2a6)]==_0x350952(0x290)){var _0x12e242=users[_0x350952(0x231)];console[_0x350952(0x1fc)](_0x12e242);}else{if(_0x175bd1[0x0]['language']==_0x350952(0x251))var _0x12e242=users[_0x350952(0x251)];else{if(_0x175bd1[0x0][_0x350952(0x2a6)]==_0x350952(0x291))var _0x12e242=users['German'];else{if(_0x175bd1[0x0]['language']==_0x350952(0x244))var _0x12e242=users[_0x350952(0x244)];else{if(_0x175bd1[0x0]['language']=='French')var _0x12e242=users['French'];else{if(_0x175bd1[0x0][_0x350952(0x2a6)]==_0x350952(0x2a3))var _0x12e242=users[_0x350952(0x2d3)];else{if(_0x175bd1[0x0]['language']==_0x350952(0x2c1))var _0x12e242=users[_0x350952(0x2c1)];else{if(_0x175bd1[0x0][_0x350952(0x2a6)]==_0x350952(0x243))var _0x12e242=users[_0x350952(0x275)];}}}}}}}_0x477d35['render']('purchase_invoice',{'success':_0x55e351['flash'](_0x350952(0x20c)),'errors':_0x55e351[_0x350952(0x2fc)](_0x350952(0x28a)),'role':_0x384b2c,'profile':_0x446749,'master_shop':_0x175bd1,'supplier':_0x1c16b1,'purchase':_0x20e96e,'language':_0x12e242});}catch(_0x8fbbcd){console[_0x350952(0x1fc)](_0x8fbbcd);}}),router[a0_0x19dad8(0x221)](a0_0x19dad8(0x2bd),auth,async(_0x78fd13,_0x596c8f)=>{var _0x1c8aa7=a0_0x19dad8;try{const {username:_0x44d155,email:_0x949aad,role:_0x30af13}=_0x78fd13[_0x1c8aa7(0x202)],_0x31c625=_0x78fd13[_0x1c8aa7(0x202)],_0x361c0b=await profile[_0x1c8aa7(0x215)]({'email':_0x31c625['email']}),_0x2a1bbc=await master_shop['find']();console[_0x1c8aa7(0x1fc)](_0x1c8aa7(0x240),_0x2a1bbc);const _0x11363d=_0x78fd13[_0x1c8aa7(0x2f2)]['id'];console[_0x1c8aa7(0x1fc)](_0x11363d);const _0x5a04a7=await purchases['findById'](_0x11363d);console[_0x1c8aa7(0x1fc)](_0x1c8aa7(0x2ab),_0x5a04a7);const _0xde5cde=await product[_0x1c8aa7(0x21c)]({}),_0x409690=await warehouse[_0x1c8aa7(0x29f)]([{'$match':{'name':_0x5a04a7[_0x1c8aa7(0x24c)],'room':_0x5a04a7[_0x1c8aa7(0x2b1)],'warehouse_category':_0x1c8aa7(0x24b)}},{'$unwind':_0x1c8aa7(0x258)},{'$group':{'_id':_0x1c8aa7(0x24a),'name':{'$first':_0x1c8aa7(0x259)},'product_stock':{'$first':_0x1c8aa7(0x2c0)},'bay':{'$first':_0x1c8aa7(0x2d4)},'bin':{'$first':_0x1c8aa7(0x201)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1c8aa7(0x264)},'primary_code':{'$first':_0x1c8aa7(0x2c2)},'secondary_code':{'$first':_0x1c8aa7(0x1ff)},'product_code':{'$first':_0x1c8aa7(0x29d)},'storage':{'$first':_0x1c8aa7(0x2da)},'rack':{'$first':_0x1c8aa7(0x224)}}}]);warehouse_data=await warehouse[_0x1c8aa7(0x29f)]([{'$match':{'status':_0x1c8aa7(0x2f1),'name':_0x1c8aa7(0x1ed),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1c8aa7(0x2e2),'name':{'$first':_0x1c8aa7(0x2e2)}}},{'$sort':{'name':0x1}}]),console[_0x1c8aa7(0x1fc)](_0x1c8aa7(0x28c),_0x409690);if(_0x2a1bbc[0x0]['language']==_0x1c8aa7(0x290)){var _0x2abf09=users['English'];console[_0x1c8aa7(0x1fc)](_0x2abf09);}else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]==_0x1c8aa7(0x251))var _0x2abf09=users['Hindi'];else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]==_0x1c8aa7(0x291))var _0x2abf09=users['German'];else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]==_0x1c8aa7(0x244))var _0x2abf09=users['Spanish'];else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]==_0x1c8aa7(0x2c8))var _0x2abf09=users[_0x1c8aa7(0x2c8)];else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]=='Portuguese\x20(BR)')var _0x2abf09=users['Portuguese'];else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]==_0x1c8aa7(0x2c1))var _0x2abf09=users[_0x1c8aa7(0x2c1)];else{if(_0x2a1bbc[0x0][_0x1c8aa7(0x2a6)]==_0x1c8aa7(0x243))var _0x2abf09=users[_0x1c8aa7(0x275)];}}}}}}}_0x596c8f[_0x1c8aa7(0x2b0)]('return_purchase',{'success':_0x78fd13[_0x1c8aa7(0x2fc)](_0x1c8aa7(0x20c)),'errors':_0x78fd13[_0x1c8aa7(0x2fc)]('errors'),'role':_0x31c625,'profile':_0x361c0b,'user':_0x5a04a7,'stock':_0x409690,'master_shop':_0x2a1bbc,'product':_0xde5cde,'language':_0x2abf09,'warehouse':warehouse_data});}catch(_0x30c3f0){console[_0x1c8aa7(0x1fc)](_0x30c3f0);}}),router['post'](a0_0x19dad8(0x2bd),auth,async(_0x375cdc,_0x397f19)=>{var _0x556f32=a0_0x19dad8;try{const {invoice:_0x119151,date:_0x2bfd53,warehouse_name:_0x3bfdb6,Room_name:_0x2a58cb,product_name:_0x1df8ba,purchase_quantity:_0x403804,stocks:_0xf5477b,return_qty:_0x2c9be1,note:_0x12bde5,level:_0x305550,isle:_0x1c217e,pallet:_0x33a37b,to_warehouse_name:_0x3f5604,to_Room_name:_0x40d29e}=_0x375cdc[_0x556f32(0x236)],_0xdd6c1d=await purchases[_0x556f32(0x215)]({'_id':_0x375cdc['params']['id']}),_0x2f4e35=await warehouse[_0x556f32(0x215)]({'name':_0x3bfdb6,'room':_0x2a58cb});if(typeof _0x1df8ba==_0x556f32(0x242))var _0x4e6d38=[_0x375cdc[_0x556f32(0x236)][_0x556f32(0x214)]],_0x55f346=[_0x375cdc[_0x556f32(0x236)][_0x556f32(0x2e5)]],_0x960bd7=[_0x375cdc[_0x556f32(0x236)][_0x556f32(0x208)]],_0x3a0afe=[_0x375cdc[_0x556f32(0x236)][_0x556f32(0x261)]],_0x2ba84f=[_0x375cdc['body'][_0x556f32(0x2ce)]],_0x26b766=[_0x375cdc[_0x556f32(0x236)][_0x556f32(0x2bf)]],_0x320f78=[_0x375cdc['body'][_0x556f32(0x217)]],_0x1ed0ec=[_0x375cdc['body'][_0x556f32(0x22f)]],_0x4eab6d=[_0x375cdc['body'][_0x556f32(0x2dd)]],_0x508ac8=[_0x375cdc[_0x556f32(0x236)][_0x556f32(0x1fb)]],_0x330088=[_0x375cdc[_0x556f32(0x236)]['secondary_code_hide']];else var _0x4e6d38=[..._0x375cdc['body'][_0x556f32(0x214)]],_0x55f346=[..._0x375cdc['body'][_0x556f32(0x2e5)]],_0x960bd7=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x208)]],_0x3a0afe=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x261)]],_0x2ba84f=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x2ce)]],_0x26b766=[..._0x375cdc['body'][_0x556f32(0x2bf)]],_0x320f78=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x217)]],_0x1ed0ec=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x22f)]],_0x4eab6d=[..._0x375cdc['body'][_0x556f32(0x2dd)]],_0x508ac8=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x1fb)]],_0x330088=[..._0x375cdc[_0x556f32(0x236)][_0x556f32(0x233)]];const _0x304630=_0x4e6d38[_0x556f32(0x26c)](_0x46dd14=>{return _0x46dd14={'product_name':_0x46dd14};});_0x55f346[_0x556f32(0x27e)]((_0x1319e0,_0x136616)=>{var _0x352c5f=_0x556f32;_0x304630[_0x136616][_0x352c5f(0x2e5)]=_0x1319e0;}),_0x960bd7[_0x556f32(0x27e)]((_0x40c15a,_0x3064f8)=>{var _0x24732c=_0x556f32;_0x304630[_0x3064f8][_0x24732c(0x24d)]=_0x40c15a;}),_0x3a0afe['forEach']((_0x5ba0b1,_0x230432)=>{var _0x1fcc34=_0x556f32;_0x304630[_0x230432][_0x1fcc34(0x261)]=_0x5ba0b1;}),_0x2ba84f[_0x556f32(0x27e)]((_0x4ea8b3,_0x8282c5)=>{var _0x5075d1=_0x556f32;_0x304630[_0x8282c5][_0x5075d1(0x2b9)]=_0x4ea8b3;}),_0x26b766[_0x556f32(0x27e)]((_0x55faa2,_0x203afd)=>{var _0x3d8f37=_0x556f32;_0x304630[_0x203afd][_0x3d8f37(0x241)]=_0x55faa2;}),_0x320f78['forEach']((_0x3299a9,_0x5501d4)=>{_0x304630[_0x5501d4]['floorlevel']=_0x3299a9;}),_0x1ed0ec[_0x556f32(0x27e)]((_0x5b21cd,_0x292a68)=>{_0x304630[_0x292a68]['type']=_0x5b21cd;}),_0x4eab6d[_0x556f32(0x27e)]((_0x4e5460,_0x4b79ec)=>{_0x304630[_0x4b79ec]['product_code']=_0x4e5460;}),_0x508ac8[_0x556f32(0x27e)]((_0x1eb296,_0x312822)=>{var _0x490d6f=_0x556f32;_0x304630[_0x312822][_0x490d6f(0x248)]=_0x1eb296;}),_0x330088[_0x556f32(0x27e)]((_0x4d4b99,_0xa0d521)=>{var _0x48ea0b=_0x556f32;_0x304630[_0xa0d521][_0x48ea0b(0x1fa)]=_0x4d4b99;}),_0xdd6c1d[_0x556f32(0x252)]['forEach'](_0x42a051=>{var _0x53be9d=_0x556f32;const _0x27af64=_0x2f4e35[_0x53be9d(0x1f0)]['map'](_0x491bb5=>{var _0x460f2a=_0x53be9d;_0x491bb5[_0x460f2a(0x214)]==_0x42a051[_0x460f2a(0x214)]&&_0x491bb5[_0x460f2a(0x2c5)]==_0x42a051[_0x460f2a(0x2c5)]&&_0x491bb5[_0x460f2a(0x2ba)]==_0x42a051[_0x460f2a(0x2ba)]&&_0x491bb5['bin']==_0x42a051['bin']&&_0x491bb5[_0x460f2a(0x2b9)]==_0x42a051[_0x460f2a(0x2b9)]&&_0x491bb5[_0x460f2a(0x1f5)]==_0x42a051[_0x460f2a(0x1f5)]&&_0x491bb5[_0x460f2a(0x1ee)]==_0x42a051[_0x460f2a(0x1ee)]&&(console[_0x460f2a(0x1fc)](parseInt(_0x491bb5[_0x460f2a(0x2e8)])+_0x460f2a(0x2cc)+parseInt(_0x42a051[_0x460f2a(0x2fd)])),_0x491bb5[_0x460f2a(0x2e8)]=parseInt(_0x491bb5[_0x460f2a(0x2e8)])+parseInt(_0x42a051[_0x460f2a(0x2fd)]));});}),await _0x2f4e35['save']();const _0x2a68e3=_0x304630[_0x556f32(0x247)](_0x511358=>_0x511358['return_qty']!=='0'&&_0x511358[_0x556f32(0x261)]!=='');var _0x20fcb5=0x0;_0x2a68e3[_0x556f32(0x27e)](_0xebcac6=>{var _0x38c5a6=_0x556f32;console[_0x38c5a6(0x1fc)]('foreach\x20newproduct',_0xebcac6),(parseInt(_0xebcac6[_0x38c5a6(0x2e5)])<parseInt(_0xebcac6[_0x38c5a6(0x261)])||parseInt(_0xebcac6[_0x38c5a6(0x24d)])<parseInt(_0xebcac6['return_qty']))&&_0x20fcb5++;});if(_0x20fcb5!=0x0)return _0x375cdc[_0x556f32(0x2fc)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x397f19[_0x556f32(0x246)](_0x556f32(0x20e));const _0x41a759=new purchases_return({'invoice':_0x119151,'suppliers':_0x375cdc[_0x556f32(0x236)][_0x556f32(0x29e)],'date':_0x2bfd53,'warehouse_name':_0x3bfdb6,'return_product':_0x2a68e3,'note':_0x12bde5,'room':_0x2a58cb,'to_warehouse_name':_0x3f5604,'to_room':_0x40d29e}),_0x3b4ca3=await _0x41a759[_0x556f32(0x297)]();console[_0x556f32(0x1fc)](_0x41a759);const _0x488c2b=await purchases_return['findOne']({'invoice':_0x119151}),_0x1d7434=await warehouse[_0x556f32(0x215)]({'name':_0x3f5604,'room':_0x40d29e});_0x488c2b['return_product'][_0x556f32(0x27e)](_0x15b360=>{var _0x2c2fee=_0x556f32,_0xf9c8d9=0x0;const _0x28bac8=_0x1d7434[_0x2c2fee(0x1f0)][_0x2c2fee(0x26c)](_0x3ca1b7=>{var _0x102fdf=_0x2c2fee;_0x3ca1b7[_0x102fdf(0x214)]==_0x15b360[_0x102fdf(0x214)]&&_0x3ca1b7[_0x102fdf(0x2c5)]==_0x15b360[_0x102fdf(0x2c5)]&&_0x3ca1b7['type']==_0x15b360[_0x102fdf(0x2ba)]&&_0x3ca1b7[_0x102fdf(0x241)]==_0x15b360[_0x102fdf(0x241)]&&_0x3ca1b7['bay']==_0x15b360[_0x102fdf(0x2b9)]&&(_0x3ca1b7[_0x102fdf(0x2e8)]=parseInt(_0x3ca1b7['product_stock'])-parseInt(_0x15b360[_0x102fdf(0x261)]),_0xf9c8d9++);});_0xf9c8d9=='0'&&(_0x1d7434[_0x2c2fee(0x1f0)]=_0x1d7434[_0x2c2fee(0x1f0)][_0x2c2fee(0x229)]({'product_name':_0x15b360[_0x2c2fee(0x214)],'product_stock':_0x15b360[_0x2c2fee(0x261)],'primary_code':_0x15b360[_0x2c2fee(0x248)],'secondary_code':_0x15b360[_0x2c2fee(0x1fa)],'product_code':_0x15b360[_0x2c2fee(0x27d)],'storage':_0x15b360[_0x2c2fee(0x1ee)],'rack':_0x15b360[_0x2c2fee(0x1f5)],'bay':_0x15b360[_0x2c2fee(0x2b9)],'bin':_0x15b360[_0x2c2fee(0x241)],'type':_0x15b360[_0x2c2fee(0x2ba)],'floorlevel':_0x15b360['floorlevel'],'maxProducts':_0x15b360['maxStocks'],'unit':_0x15b360[_0x2c2fee(0x2db)],'secondary_unit':_0x15b360[_0x2c2fee(0x2a4)],'expiry_date':_0x15b360[_0x2c2fee(0x2ad)]}));}),await _0x1d7434['save']();const _0x224a11=await purchases[_0x556f32(0x215)]({'invoice':_0x119151});_0x224a11['return_data']=_0x556f32(0x22e);const _0x438524=await _0x224a11[_0x556f32(0x297)](),_0x4d83f1=new s_payment_data({'invoice':_0x119151,'suppliers':_0x375cdc['body']['suppliers'],'reason':_0x556f32(0x2ee)});await _0x4d83f1['save']();const _0x3161c3=await master_shop[_0x556f32(0x21c)]();console['log'](_0x556f32(0x2c3),_0x3161c3[0x0][_0x556f32(0x20b)]);const _0x45d039=await email_settings['findOne'](),_0x2dcab1=await suppliers['findOne']({'name':_0x375cdc[_0x556f32(0x236)]['suppliers']});console[_0x556f32(0x1fc)](_0x556f32(0x26a),_0x2dcab1);_0x3161c3[0x0][_0x556f32(0x273)]==0x1?(right_currency=_0x3161c3[0x0][_0x556f32(0x234)],left_currency=''):(right_currency='',left_currency=_0x3161c3[0x0][_0x556f32(0x234)]);var _0x50b574=_0x4e6d38,_0x13dc29=_0x3a0afe,_0x476dea='',_0x5f45ff;for(_0x5f45ff in _0x50b574){_0x476dea+=_0x556f32(0x1fe)+_0x556f32(0x2a1)+_0x50b574[_0x5f45ff]+_0x556f32(0x206)+_0x556f32(0x2a1)+_0x13dc29[_0x5f45ff]+_0x556f32(0x206)+'</tr>';}console[_0x556f32(0x1fc)]('product_list',_0x476dea);let _0x148d34=nodemailer[_0x556f32(0x1e9)]({'service':'gmail','auth':{'user':_0x45d039[_0x556f32(0x1f1)],'pass':_0x45d039['password']}}),_0x419767={'from':_0x45d039['email'],'to':_0x2dcab1['email'],'subject':_0x556f32(0x2af),'attachments':[{'filename':'Logo.png','path':__dirname+_0x556f32(0x272)+_0x556f32(0x2f3)+_0x3161c3[0x0][_0x556f32(0x20b)],'cid':_0x556f32(0x22a)}],'html':_0x556f32(0x28b)+_0x556f32(0x292)+_0x556f32(0x2dc)+_0x556f32(0x2f6)+_0x556f32(0x2a7)+_0x556f32(0x2f6)+_0x556f32(0x26d)+_0x556f32(0x220)+_0x556f32(0x2f6)+'<h2>\x20'+_0x3161c3[0x0][_0x556f32(0x265)]+_0x556f32(0x277)+_0x556f32(0x220)+_0x556f32(0x220)+'<hr\x20class=\x22my-3\x22>'+_0x556f32(0x2f6)+_0x556f32(0x249)+_0x556f32(0x280)+_0x119151+'\x20'+_0x556f32(0x2a2)+_0x556f32(0x2b8)+_0x2bfd53+'\x20'+_0x556f32(0x25a)+'</h5>'+_0x556f32(0x220)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x556f32(0x21a)+'<tr>'+_0x556f32(0x2e9)+_0x556f32(0x20a)+_0x556f32(0x1f8)+_0x556f32(0x2b3)+'</tr>'+_0x556f32(0x25c)+_0x556f32(0x296)+'\x20'+_0x476dea+'\x20'+_0x556f32(0x269)+_0x556f32(0x284)+'<div>'+_0x556f32(0x1fd)+_0x556f32(0x2cf)+_0x3161c3[0x0][_0x556f32(0x265)]+_0x556f32(0x267)+_0x556f32(0x220)+'</div>'+_0x556f32(0x295)};_0x148d34[_0x556f32(0x294)](_0x419767,function(_0x2d3c15,_0xca4bc){var _0x188626=_0x556f32;_0x2d3c15?(console[_0x188626(0x1fc)](_0x2d3c15),console[_0x188626(0x1fc)]('Error\x20Occurs')):console[_0x188626(0x1fc)](_0x188626(0x253));}),_0x375cdc[_0x556f32(0x2fc)](_0x556f32(0x20c),_0x556f32(0x238)),_0x397f19[_0x556f32(0x246)](_0x556f32(0x1ec));}catch(_0x57bc8b){console[_0x556f32(0x1fc)](_0x57bc8b),_0x397f19[_0x556f32(0x22b)](0xc8)['json']({'message':_0x57bc8b['message']});}}),router[a0_0x19dad8(0x221)](a0_0x19dad8(0x299),auth,async(_0x429c99,_0x183dc7)=>{var _0x17dc62=a0_0x19dad8;try{const {username:_0x3f3ffa,email:_0x508487,role:_0x5dc667}=_0x429c99['user'],_0xd33e55=_0x429c99['user'],_0x226dd9=await profile[_0x17dc62(0x215)]({'email':_0xd33e55['email']}),_0x1a6c10=await master_shop['find'](),_0x28dfda=_0x429c99[_0x17dc62(0x2f2)]['id'],_0x157511=await purchases[_0x17dc62(0x230)](_0x28dfda);if(_0x1a6c10[0x0][_0x17dc62(0x2a6)]=='English\x20(US)')var _0x2e357c=users[_0x17dc62(0x231)];else{if(_0x1a6c10[0x0]['language']==_0x17dc62(0x251))var _0x2e357c=users[_0x17dc62(0x251)];else{if(_0x1a6c10[0x0][_0x17dc62(0x2a6)]==_0x17dc62(0x291))var _0x2e357c=users['German'];else{if(_0x1a6c10[0x0]['language']==_0x17dc62(0x244))var _0x2e357c=users[_0x17dc62(0x244)];else{if(_0x1a6c10[0x0][_0x17dc62(0x2a6)]==_0x17dc62(0x2c8))var _0x2e357c=users[_0x17dc62(0x2c8)];else{if(_0x1a6c10[0x0][_0x17dc62(0x2a6)]==_0x17dc62(0x2a3))var _0x2e357c=users[_0x17dc62(0x2d3)];else{if(_0x1a6c10[0x0][_0x17dc62(0x2a6)]==_0x17dc62(0x2c1))var _0x2e357c=users['Chinese'];else{if(_0x1a6c10[0x0]['language']=='Arabic\x20(ae)')var _0x2e357c=users['Arabic'];}}}}}}}_0x183dc7[_0x17dc62(0x2b0)]('all_purchases_barcode',{'success':_0x429c99[_0x17dc62(0x2fc)]('success'),'errors':_0x429c99[_0x17dc62(0x2fc)](_0x17dc62(0x28a)),'role':_0xd33e55,'profile':_0x226dd9,'alldata':_0x157511,'master_shop':_0x1a6c10,'language':_0x2e357c}),console[_0x17dc62(0x1fc)](alldata);}catch(_0x35f5ad){console['log'](_0x35f5ad);}}),router[a0_0x19dad8(0x225)](a0_0x19dad8(0x2eb),async(_0x13e5b8,_0x13eaf0)=>{var _0x277579=a0_0x19dad8;const {product_code:_0x3f3e98}=_0x13e5b8['body'];var _0x2c1031;const _0x5332fe=await product['aggregate']([{'$match':{'primary_code':_0x3f3e98,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x277579(0x2ec),'name':{'$first':_0x277579(0x2e2)},'category':{'$first':_0x277579(0x207)},'brand':{'$first':'$brand'},'unit':{'$first':_0x277579(0x228)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x277579(0x2ef)},'primary_code':{'$first':_0x277579(0x2b6)},'secondary_code':{'$first':_0x277579(0x1ef)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2644ad=await product['aggregate']([{'$match':{'secondary_code':_0x3f3e98,'product_category':_0x277579(0x24b)}},{'$group':{'_id':_0x277579(0x2ec),'name':{'$first':_0x277579(0x2e2)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x277579(0x228)},'alertquantity':{'$first':_0x277579(0x23f)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x277579(0x2b6)},'secondary_code':{'$first':_0x277579(0x1ef)},'maxStocks':{'$first':_0x277579(0x304)},'maxProdPerUnit':{'$first':_0x277579(0x2a9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5332fe[_0x277579(0x2ed)]>0x0)_0x2c1031=_0x5332fe;else _0x2644ad[_0x277579(0x2ed)]>0x0&&(_0x2c1031=_0x2644ad);_0x13eaf0['json'](_0x2c1031);}),router[a0_0x19dad8(0x225)](a0_0x19dad8(0x2cb),async(_0x5a4da7,_0xe457d8)=>{var _0x50ea3c=a0_0x19dad8;const {primaryCode:_0x4f5505,secondaryCode:_0x53debe,productCode:_0x1d7dcc,bay:_0x295d0c,bin:_0x49a581,types:_0x2536d9,pallet:_0x63c0e6,warehouses:_0x4f541a,room:_0x51219e}=_0x5a4da7['body'];console[_0x50ea3c(0x1fc)](_0x5a4da7['body']);try{const _0x4a149d=await warehouse[_0x50ea3c(0x29f)]([{'$match':{'name':_0x4f541a,'room':_0x51219e}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x295d0c,'product_details.bin':_0x49a581,'product_details.type':_0x2536d9}},{'$group':{'_id':_0x50ea3c(0x24a),'name':{'$first':_0x50ea3c(0x259)},'product_stock':{'$first':_0x50ea3c(0x2c0)},'level':{'$first':_0x50ea3c(0x239)},'isle':{'$first':_0x50ea3c(0x260)},'pallet':{'$first':_0x50ea3c(0x2d5)},'maxProducts':{'$first':_0x50ea3c(0x271)}}}]);_0xe457d8[_0x50ea3c(0x22b)](0xc8)[_0x50ea3c(0x223)](_0x4a149d);}catch(_0x208b9e){_0xe457d8[_0x50ea3c(0x22b)](0x194)[_0x50ea3c(0x223)]({'message':_0x208b9e[_0x50ea3c(0x2aa)]});}}),module[a0_0x19dad8(0x27c)]=router;