var a0_0xecd78d=a0_0x5227;(function(_0x19a6fd,_0x527bb9){var _0x2f1f43=a0_0x5227,_0x43811b=_0x19a6fd();while(!![]){try{var _0x1a6eeb=-parseInt(_0x2f1f43(0x273))/0x1+parseInt(_0x2f1f43(0x286))/0x2*(parseInt(_0x2f1f43(0x249))/0x3)+parseInt(_0x2f1f43(0x287))/0x4*(parseInt(_0x2f1f43(0x1fc))/0x5)+parseInt(_0x2f1f43(0x2d7))/0x6*(parseInt(_0x2f1f43(0x2b6))/0x7)+-parseInt(_0x2f1f43(0x1f3))/0x8*(-parseInt(_0x2f1f43(0x2e1))/0x9)+parseInt(_0x2f1f43(0x1fd))/0xa*(parseInt(_0x2f1f43(0x28f))/0xb)+-parseInt(_0x2f1f43(0x1e4))/0xc;if(_0x1a6eeb===_0x527bb9)break;else _0x43811b['push'](_0x43811b['shift']());}catch(_0x35605f){_0x43811b['push'](_0x43811b['shift']());}}}(a0_0x2f93,0x86d10));function a0_0x5227(_0x4f2d95,_0x4ea004){var _0x2f9308=a0_0x2f93();return a0_0x5227=function(_0x522783,_0xa34916){_0x522783=_0x522783-0x1cf;var _0x4aca00=_0x2f9308[_0x522783];return _0x4aca00;},a0_0x5227(_0x4f2d95,_0x4ea004);}const express=require(a0_0xecd78d(0x2e7)),app=express(),router=express[a0_0xecd78d(0x2d2)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xecd78d(0x230)),auth=require(a0_0xecd78d(0x1e1)),nodemailer=require(a0_0xecd78d(0x1f8));var ejs=require(a0_0xecd78d(0x2da));const path=require(a0_0xecd78d(0x2e2)),users=require(a0_0xecd78d(0x2ba));router[a0_0xecd78d(0x260)](a0_0xecd78d(0x25c),auth,async(_0x4b5802,_0x76e111)=>{var _0x1d2f0f=a0_0xecd78d;try{const {username:_0x17bcad,email:_0x3b3c66,role:_0x5ec2a2}=_0x4b5802[_0x1d2f0f(0x220)],_0x5d745f=_0x4b5802[_0x1d2f0f(0x220)],_0x5ab788=await profile['findOne']({'email':_0x5d745f[_0x1d2f0f(0x2b3)]}),_0x5420ff=await staff[_0x1d2f0f(0x1ef)]({'email':_0x5d745f[_0x1d2f0f(0x2b3)]});if(_0x5d745f[_0x1d2f0f(0x1f5)]=='staff'){const _0x444fb4=await staff[_0x1d2f0f(0x1ef)]({'email':_0x5d745f[_0x1d2f0f(0x2b3)]});}const _0x1589d6=await master_shop[_0x1d2f0f(0x23a)]();let _0x48af4a;if(_0x5d745f[_0x1d2f0f(0x1f5)]==_0x1d2f0f(0x22c)){const _0x3a6580=await staff[_0x1d2f0f(0x1ef)]({'email':_0x5d745f[_0x1d2f0f(0x2b3)]});_0x48af4a=await purchases[_0x1d2f0f(0x292)]([{'$match':{'warehouse_name':_0x3a6580[_0x1d2f0f(0x2e9)]}},{'$lookup':{'from':_0x1d2f0f(0x216),'localField':'suppliers','foreignField':'name','as':_0x1d2f0f(0x295)}},{'$unwind':_0x1d2f0f(0x2dc)},{'$unwind':_0x1d2f0f(0x2c7)},{'$group':{'_id':_0x1d2f0f(0x232),'invoice':{'$first':_0x1d2f0f(0x29e)},'suppliers':{'$first':_0x1d2f0f(0x201)},'date':{'$first':_0x1d2f0f(0x1ec)},'warehouse_name':{'$first':_0x1d2f0f(0x2b4)},'room':{'$first':_0x1d2f0f(0x2ec)},'product':{'$push':'$product'},'note':{'$first':_0x1d2f0f(0x263)},'paid_amount':{'$first':_0x1d2f0f(0x2b5)},'due_amount':{'$first':_0x1d2f0f(0x2a0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1d2f0f(0x26d)},'expiry_date':{'$first':_0x1d2f0f(0x1e9)},'suppliers_docs':{'$first':_0x1d2f0f(0x2dc)},'total_product_quantity':{'$sum':_0x1d2f0f(0x262)},'level':{'$addToSet':_0x1d2f0f(0x202)},'isle':{'$addToSet':_0x1d2f0f(0x28d)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x1d2f0f(0x2e6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x48af4a=await purchases[_0x1d2f0f(0x292)]([{'$lookup':{'from':'suppliers','localField':_0x1d2f0f(0x216),'foreignField':_0x1d2f0f(0x29f),'as':_0x1d2f0f(0x295)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x1d2f0f(0x2c7)},{'$group':{'_id':_0x1d2f0f(0x232),'invoice':{'$first':_0x1d2f0f(0x29e)},'suppliers':{'$first':_0x1d2f0f(0x201)},'date':{'$first':_0x1d2f0f(0x1ec)},'warehouse_name':{'$first':_0x1d2f0f(0x2b4)},'room':{'$addToSet':_0x1d2f0f(0x2d5)},'product':{'$push':_0x1d2f0f(0x2c7)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x1d2f0f(0x2b5)},'due_amount':{'$first':_0x1d2f0f(0x2a0)},'return_data':{'$first':_0x1d2f0f(0x253)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1d2f0f(0x1e9)},'suppliers_docs':{'$first':_0x1d2f0f(0x2dc)},'total_product_quantity':{'$sum':_0x1d2f0f(0x262)},'level':{'$addToSet':_0x1d2f0f(0x202)},'isle':{'$addToSet':_0x1d2f0f(0x28d)},'type':{'$addToSet':_0x1d2f0f(0x206)},'floorlevel':{'$addToSet':_0x1d2f0f(0x2e6)},'finalize':{'$first':_0x1d2f0f(0x2b1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1589d6[0x0]['language']==_0x1d2f0f(0x1da)){var _0x2d5a76=users[_0x1d2f0f(0x203)];console[_0x1d2f0f(0x2aa)](_0x2d5a76);}else{if(_0x1589d6[0x0][_0x1d2f0f(0x22f)]==_0x1d2f0f(0x2e8))var _0x2d5a76=users['Hindi'];else{if(_0x1589d6[0x0]['language']==_0x1d2f0f(0x28c))var _0x2d5a76=users[_0x1d2f0f(0x28c)];else{if(_0x1589d6[0x0][_0x1d2f0f(0x22f)]==_0x1d2f0f(0x25f))var _0x2d5a76=users[_0x1d2f0f(0x25f)];else{if(_0x1589d6[0x0][_0x1d2f0f(0x22f)]=='French')var _0x2d5a76=users[_0x1d2f0f(0x1e7)];else{if(_0x1589d6[0x0][_0x1d2f0f(0x22f)]=='Portuguese\x20(BR)')var _0x2d5a76=users[_0x1d2f0f(0x284)];else{if(_0x1589d6[0x0]['language']==_0x1d2f0f(0x2a7))var _0x2d5a76=users[_0x1d2f0f(0x2a7)];else{if(_0x1589d6[0x0]['language']==_0x1d2f0f(0x20f))var _0x2d5a76=users[_0x1d2f0f(0x2ea)];}}}}}}}_0x76e111[_0x1d2f0f(0x242)]('all_purchases',{'success':_0x4b5802[_0x1d2f0f(0x219)](_0x1d2f0f(0x231)),'errors':_0x4b5802[_0x1d2f0f(0x219)](_0x1d2f0f(0x2de)),'purchases':_0x48af4a,'role':_0x5d745f,'profile':_0x5ab788,'master_shop':_0x1589d6,'language':_0x2d5a76});}catch(_0x55110c){console[_0x1d2f0f(0x2aa)](_0x1d2f0f(0x223),_0x55110c),_0x76e111[_0x1d2f0f(0x2a8)](0xc8)[_0x1d2f0f(0x2eb)]({'message':_0x55110c[_0x1d2f0f(0x2db)]});}});function BayBinSelected(_0x52976a,_0x55db6f){var _0x66864e=a0_0xecd78d,_0x1d49f0=[],_0x29601e=[],_0x3d6a6e=[],_0x8eb93=[],_0x57b623=[],_0x1b5066=[];let _0x49940f=[];if(_0x52976a==_0x66864e(0x2ee))switch(_0x55db6f){case _0x66864e(0x1f1):_0x1d49f0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x29601e=[0x1,0x2],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=['Level','Floor'],_0x57b623=['D'],_0x1b5066=['A'];break;case'Rack\x20B':_0x1d49f0=[0x6,0x5,0x4,0x3,0x2,0x1],_0x29601e=[0x1,0x2],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=[_0x66864e(0x285),_0x66864e(0x23c)],_0x57b623=['D'],_0x1b5066=['B'];break;case _0x66864e(0x1f0):_0x1d49f0=[0x0],_0x29601e=[0x0],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=['Floor'],_0x57b623=['D'],_0x1b5066=['S'];break;case'Receiving\x20Area':_0x1d49f0=[0x0],_0x29601e=[0x0],_0x8eb93=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3d6a6e=[_0x66864e(0x23c)],_0x57b623=['D'],_0x1b5066=['R'];break;}else{if(_0x52976a==_0x66864e(0x2ef))switch(_0x55db6f){case'Rack\x20A':_0x1d49f0=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x29601e=['B','F'],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=[_0x66864e(0x285),_0x66864e(0x23c)],_0x57b623=['C'],_0x1b5066=['A'];break;case'Rack\x20B':_0x1d49f0=[0x5,0x4,0x3,0x2,0x1],_0x29601e=['F','B','S'],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=[_0x66864e(0x285),_0x66864e(0x23c)],_0x57b623=['C'],_0x1b5066=['B'];break;case _0x66864e(0x2c0):_0x1d49f0=[0x1,0x2,0x3,0x4,0x5],_0x29601e=['B','F','S'],_0x8eb93=[0x5,0x4,0x3,0x2,0x1],_0x3d6a6e=[_0x66864e(0x285),_0x66864e(0x23c)],_0x57b623=['C'],_0x1b5066=['C'];break;case'Rack\x20D':_0x1d49f0=[0x5,0x4,0x3,0x2,0x1],_0x29601e=['F','B','S'],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=['Level','Floor'],_0x57b623=['C'],_0x1b5066=['D'];break;case _0x66864e(0x2f6):_0x1d49f0=[0x4,0x3,0x2,0x1],_0x29601e=[0x1,0x2],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=[_0x66864e(0x285),'Floor'],_0x57b623=['C'],_0x1b5066=['E'];break;case _0x66864e(0x2d0):_0x1d49f0=[0x1,0x2,0x3],_0x29601e=[0x1,0x2],_0x8eb93=[0x1,0x2,0x3,0x4,0x5],_0x3d6a6e=[_0x66864e(0x285)],_0x57b623=['C'],_0x1b5066=['F'];break;}}return{'levels':_0x1d49f0,'Isle':_0x29601e,'rack':_0x8eb93,'type':_0x3d6a6e,'storage':_0x57b623,'rak':_0x1b5066};}function a0_0x2f93(){var _0x3907f4=['storage','<html><head><title></title>','forEach','English\x20(US)','bay','<tbody\x20style=\x22text-align:\x20center;\x22>','purchase\x20data\x20update\x20successfully','\x20Order\x20Number\x20:\x20','floorlevel','Ambient','../middleware/auth','product_cat','product_name','11071908GFnQSk','</td>','product_code','French','purchases\x20item\x20return\x20successfull','$expiry_date','master','\x20<>\x20','$date','alertQTY','<hr\x20class=\x22my-3\x22>','findOne','Shelves','Rack\x20A','maxperunit','8dFwtHH','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','role','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','nodemailer','rak','<tr>','expiry_date','85olxFUl','4775750ndgIWK','RoomAssign','primary_code','</div>','$suppliers','$product.bay','English','$product_details.product_code','foreach\x20newproduct','$product.type','Enabled','findById','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','currency_placement','<!DOCTYPE\x20html>','Error\x20Occurs','primary_code_hide','Arabic\x20(ae)','</thead>','filter','$secondary_code','$name','maxStocks','quantity','suppliers','product_list','string','flash','actual_uom','<div>','product','finalize','room_name','prod_pallet','user','\x20<\x20wew\x20>\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','table\x20page','random','batch_code','secondary_code','$product_details.product_name','getMonth','$product_details','room','abs','staff','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','getFullYear','language','../models/all_models','success','$_id','INC-','params','invoice','prod_Qty','actual_qty','return_qty','</tbody>','find','catch','Floor','deliverycode','Email\x20sent\x20successfully','all_purchases_barcode','Purchase\x20data\x20added\x20successfully','product_details','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details._id','/../public','padStart','111EsIjXB','$product_details.expiry_date','Portuguese\x20(BR)','$product_details.floorlevel','$product_details.product_stock','level','secondary_unit','$product_details.storage','prod_cat','amount','$return_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</tr>','/invoice/:id','</body></html>','standard_unit','save','Sales\x20Update\x20successfully','/view','/all_purchases/view/','slice','Spanish','get','$product_details.rack','$product.quantity','$note','site_title','post','$product_details.primary_code','prod_unit','logo','bin','</h5>','Purchase\x20Mail','</span>','$batch_code','push','return_product','There\x27s\x20a\x20error\x20in\x20this\x20transaction','password','<strong>\x20Regards\x20</strong>','903480lKgYyH','warehouse_name','createTransport','An\x20error\x20occurred.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','product_code_hide','</head><body>','note','MaxStocks_data','length','map','port','prod_level','RMSEmail','</table>','type','prod_secondunit','Portuguese','Level','30994IdSfMr','148040BkbzwB','exports','/all_purchases/view','edit_purchases_view','production_date','German','$product.bin','image','11fnuLOa','secondary_code_hide','return_purchase','aggregate','$product_details.level','add_purchases\x20error','suppliers_docs','prod_isle','then','<table\x20style=\x22width:\x20100%\x20!important;\x22>','rack','$maxProdPerUnit','body','product_stock','Raw\x20Materials','$invoice','name','$due_amount','floor','due_amount','delivery_date','/view/add_purchases/:id','return_data','Room_name','Chinese','status','<h5>','log','prod_primunit','all','$product_details.bin','purchase_quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','sendMail','$finalize','prod_qty','email','$warehouse_name','$paid_amount','13727oLCEPB','$product_details.isle','types','/CheckingWarehouse','../public/language/languages.json','getDate','add_purchases','error','pallet','$brand','Rack\x20C','payment\x20successfull','redirect','delivery_code','max_product_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product','$primary_code','JO_number','$category','/view/return_purchase/:id','POnumber','/preview/:id','prod_invoice','/view/:id','Rack\x20F','suppliers_data','Router','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','True','$product.room_name','gmail','1722ZhkTtT','$product_details.secondary_code','$product_code','ejs','message','$suppliers_docs','paid_amount','errors','user_id','isle','1218654mbwWVf','path','$secondary_unit','date','/upload/','$product.floorlevel','express','Hindi','warehouse','Arabic','json','$room','$product_details.type','DRY\x20STORAGE','COLD\x20STORAGE','Logo.png','<h2>\x20','$product_details.bay','$unit','\x20</h2>','Return\x20Goods','Rack\x20E','add\x20post','toString','prod_code','\x20Order\x20Date\x20:\x20','Paid\x20For\x20Purchase','concat','/barcode_scanner','currency','prod_name'];a0_0x2f93=function(){return _0x3907f4;};return a0_0x2f93();}async function getRandom8DigitNumber(){var _0x2784ad=a0_0xecd78d;const _0x5e57fc=0x989680,_0x4ed008=0x5f5e0ff,_0x1f4c11=Math[_0x2784ad(0x2a1)](Math[_0x2784ad(0x224)]()*(_0x4ed008-_0x5e57fc+0x1))+_0x5e57fc;var _0x457534;const _0x593175=await purchases[_0x2784ad(0x1ef)]({'invoice':_0x2784ad(0x233)+_0x1f4c11});return _0x593175&&_0x593175[_0x2784ad(0x27c)]>0x0?_0x457534=_0x2784ad(0x233)+_0x1f4c11:_0x457534=_0x2784ad(0x233)+_0x1f4c11,_0x457534;}router[a0_0xecd78d(0x260)]('/view/add_purchases',auth,async(_0x42a3a2,_0x2f002d)=>{var _0x234cd4=a0_0xecd78d;try{const {username:_0x437e15,email:_0x1356db,role:_0xf5143b}=_0x42a3a2['user'],_0x2812c4=_0x42a3a2[_0x234cd4(0x220)],_0x122dbc=await profile[_0x234cd4(0x1ef)]({'email':_0x2812c4['email']}),_0x291e33=await master_shop[_0x234cd4(0x23a)](),_0x1fe707=await staff[_0x234cd4(0x1ef)]({'email':_0x2812c4['email']}),_0x3d019f=await suppliers['find']({});let _0x4bc204;if(_0x2812c4[_0x234cd4(0x1f5)]==_0x234cd4(0x22c)){const _0x5627e7=await staff[_0x234cd4(0x1ef)]({'email':_0x2812c4[_0x234cd4(0x2b3)]});_0x4bc204=await warehouse[_0x234cd4(0x292)]([{'$match':{'status':_0x234cd4(0x207),'name':_0x5627e7['warehouse'],'warehouse_category':_0x234cd4(0x29d),'name':{'$ne':_0x234cd4(0x2f5)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x4bc204=await warehouse[_0x234cd4(0x292)]([{'$match':{'status':_0x234cd4(0x207),'warehouse_category':_0x234cd4(0x29d),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x234cd4(0x213)}}}]);const _0x1318c9=await product['find']({}),_0x1e6708=await warehouse['find']({'status':_0x234cd4(0x207)}),_0x20e475=await purchases[_0x234cd4(0x23a)]({}),_0x2da7f2=_0x20e475[_0x234cd4(0x27c)]+0x1,_0x449722=_0x234cd4(0x233)+_0x2da7f2[_0x234cd4(0x1cf)]()[_0x234cd4(0x248)](0x5,'0');var _0x3063ba=[_0x234cd4(0x1e0),'Enclosed'];if(_0x291e33[0x0][_0x234cd4(0x22f)]==_0x234cd4(0x1da))var _0x4d038c=users[_0x234cd4(0x203)];else{if(_0x291e33[0x0][_0x234cd4(0x22f)]==_0x234cd4(0x2e8))var _0x4d038c=users[_0x234cd4(0x2e8)];else{if(_0x291e33[0x0]['language']=='German')var _0x4d038c=users[_0x234cd4(0x28c)];else{if(_0x291e33[0x0][_0x234cd4(0x22f)]==_0x234cd4(0x25f))var _0x4d038c=users[_0x234cd4(0x25f)];else{if(_0x291e33[0x0]['language']==_0x234cd4(0x1e7))var _0x4d038c=users[_0x234cd4(0x1e7)];else{if(_0x291e33[0x0][_0x234cd4(0x22f)]=='Portuguese\x20(BR)')var _0x4d038c=users['Portuguese'];else{if(_0x291e33[0x0][_0x234cd4(0x22f)]==_0x234cd4(0x2a7))var _0x4d038c=users[_0x234cd4(0x2a7)];else{if(_0x291e33[0x0][_0x234cd4(0x22f)]==_0x234cd4(0x20f))var _0x4d038c=users[_0x234cd4(0x2ea)];}}}}}}}const _0x2df4e1=getRandom8DigitNumber();_0x2df4e1['then'](_0x1ad237=>{var _0x15c2f5=_0x234cd4;_0x2f002d[_0x15c2f5(0x242)](_0x15c2f5(0x2bc),{'success':_0x42a3a2[_0x15c2f5(0x219)]('success'),'errors':_0x42a3a2['flash'](_0x15c2f5(0x2de)),'role':_0x2812c4,'profile':_0x122dbc,'suppliers':_0x3d019f,'warehouse':_0x4bc204,'product':_0x1318c9,'invoice':_0x1ad237,'master_shop':_0x291e33,'language':_0x4d038c,'find_data':_0x1e6708,'rooms_data':_0x3063ba});})[_0x234cd4(0x23b)](_0x541a13=>{var _0x680e1d=_0x234cd4;_0x42a3a2[_0x680e1d(0x219)](_0x680e1d(0x2de),_0x680e1d(0x270)),_0x2f002d[_0x680e1d(0x2c2)]('/all_purchases/view');});}catch(_0x31feef){console[_0x234cd4(0x2aa)](_0x31feef);}}),router[a0_0xecd78d(0x260)](a0_0xecd78d(0x2a4),auth,async(_0x2b392a,_0x53acca)=>{var _0xa3c2df=a0_0xecd78d;try{const _0x1c81c1=_0x2b392a[_0xa3c2df(0x234)]['id'];console[_0xa3c2df(0x2aa)](_0x1c81c1);const _0xa582ec=await master_shop['find']();console['log']('master',_0xa582ec);const _0x1afd74=await product[_0xa3c2df(0x1ef)]({'name':_0x1c81c1});console[_0xa3c2df(0x2aa)](_0xa3c2df(0x21c),_0x1afd74),_0x53acca[_0xa3c2df(0x2a8)](0xc8)[_0xa3c2df(0x2eb)]({'product_data':_0x1afd74,'master':_0xa582ec});}catch(_0x6ccdee){console[_0xa3c2df(0x2aa)](_0xa3c2df(0x294),_0x6ccdee);}}),router[a0_0xecd78d(0x265)]('/view/add_purchases',auth,async(_0x5dec03,_0xd188f0)=>{var _0x532c14=a0_0xecd78d;try{const {invoice:_0x1beddb,date:_0x44d63e,warehouse_name:_0x2f4df8,prod_name:_0x29e0c5,prod_code:_0xe72fab,prod_qty:_0x4eff0d,prod_unit:_0x303e16,prod_secondunit:_0x54acdb,prod_level:_0x1cc628,prod_isle:_0x1f73f0,prod_pallet:_0x50ebc5,note:_0x3c9ab,expiry_date:_0x51273c,batch_code:_0x4f03f1,payable:_0x44e1e5,due_amount:_0x1aa1b7,Room_name:_0x3f586c,primary_code:_0xf7651e,secondary_code:_0x3ace72,MaxStocks_data:_0x3eb5a2,PO_number:_0x1e62fc,SCRN:_0x29c46f,JO_number:_0x5a493f}=_0x5dec03[_0x532c14(0x29b)];if(typeof _0x29e0c5==_0x532c14(0x218))var _0x50bac2=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1d6)]],_0x8a604=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1d0)]],_0x548591=[_0x5dec03[_0x532c14(0x29b)]['prod_Qty']],_0x534c52=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x2ab)]],_0x17b94e=[_0x5dec03['body'][_0x532c14(0x283)]],_0x531f84=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x27f)]],_0x363362=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1ff)]],_0xdb7efa=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x226)]],_0x254cad=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x27b)]],_0x1f0683=[_0x5dec03[_0x532c14(0x29b)]['batch_code']],_0x63669c=[_0x5dec03['body']['expiry_date']],_0x29752c=[_0x5dec03['body'][_0x532c14(0x2c4)]],_0x4daaa7=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1ed)]],_0x5a6ac5=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x28b)]],_0xf9005a=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x251)]],_0x6f3fd1=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1fe)]],_0x4af469=[_0x5dec03[_0x532c14(0x29b)]['deliverycode']],_0x392ea5=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x2ce)]],_0x599cd2=[_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x237)]],_0x27c961=[_0x5dec03['body']['actual_uom']];else var _0x50bac2=[..._0x5dec03['body'][_0x532c14(0x1d6)]],_0x8a604=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1d0)]],_0x548591=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x236)]],_0x534c52=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x2ab)]],_0x17b94e=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x283)]],_0x531f84=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x27f)]],_0x363362=[..._0x5dec03[_0x532c14(0x29b)]['primary_code']],_0xdb7efa=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x226)]],_0x254cad=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x27b)]],_0x1f0683=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x225)]],_0x63669c=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1fb)]],_0x29752c=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x2c4)]],_0x4daaa7=[..._0x5dec03['body'][_0x532c14(0x1ed)]],_0x5a6ac5=[..._0x5dec03['body']['production_date']],_0xf9005a=[..._0x5dec03['body'][_0x532c14(0x251)]],_0x6f3fd1=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x1fe)]],_0x4af469=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x23d)]],_0x392ea5=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x2ce)]],_0x599cd2=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x237)]],_0x27c961=[..._0x5dec03[_0x532c14(0x29b)][_0x532c14(0x21a)]];const _0x154eb6=_0x50bac2[_0x532c14(0x27d)](_0x506bee=>{return _0x506bee={'product_name':_0x506bee};});_0x599cd2[_0x532c14(0x1d9)]((_0x146093,_0x317e5d)=>{var _0x205272=_0x532c14;_0x154eb6[_0x317e5d][_0x205272(0x237)]=Math[_0x205272(0x22b)](_0x146093);}),_0x27c961[_0x532c14(0x1d9)]((_0x201f44,_0x31c160)=>{var _0x196509=_0x532c14;_0x154eb6[_0x31c160][_0x196509(0x21a)]=_0x201f44;}),_0x8a604['forEach']((_0x584f8e,_0x37e0c7)=>{var _0x5dbc88=_0x532c14;_0x154eb6[_0x37e0c7][_0x5dbc88(0x1e6)]=_0x584f8e;}),_0x548591['forEach']((_0x4cd4c1,_0x1c3c67)=>{var _0xbfc67e=_0x532c14;_0x154eb6[_0x1c3c67]['quantity']=Math[_0xbfc67e(0x22b)](_0x4cd4c1);}),_0x534c52[_0x532c14(0x1d9)]((_0x195543,_0x3f486b)=>{var _0x1527a4=_0x532c14;_0x154eb6[_0x3f486b][_0x1527a4(0x259)]=_0x195543;}),_0x17b94e['forEach']((_0x970b84,_0x28ca90)=>{var _0x350037=_0x532c14;_0x154eb6[_0x28ca90][_0x350037(0x24f)]=_0x970b84;}),_0x531f84[_0x532c14(0x1d9)]((_0x43cd1f,_0x53e78d)=>{var _0xcc87aa=_0x532c14;_0x6f3fd1[_0xcc87aa(0x1d9)]((_0x399732,_0x3e5cb7)=>{var _0x17a9e9=_0xcc87aa;if(_0x399732=='Receiving\x20Area'&&_0x53e78d==_0x3e5cb7){console[_0x17a9e9(0x2aa)](_0x399732+_0x17a9e9(0x221)+_0x53e78d+_0x17a9e9(0x1eb)+_0x3e5cb7+_0x17a9e9(0x1eb)+_0x43cd1f);var _0x420599=_0x43cd1f[_0x17a9e9(0x25e)](0x3);_0x154eb6[_0x53e78d][_0x17a9e9(0x1d7)]=_0x43cd1f[0x0],_0x154eb6[_0x53e78d]['rack']=_0x43cd1f[0x1],_0x154eb6[_0x53e78d][_0x17a9e9(0x1db)]=0x0,_0x154eb6[_0x53e78d][_0x17a9e9(0x269)]=0x0,_0x154eb6[_0x53e78d]['type']=_0x17a9e9(0x23c),_0x154eb6[_0x53e78d][_0x17a9e9(0x1df)]=_0x420599;}else{if(_0x399732=='Shelves'&&_0x53e78d==_0x3e5cb7){var _0x420599=_0x43cd1f[_0x17a9e9(0x25e)](0x3);_0x154eb6[_0x53e78d][_0x17a9e9(0x1d7)]=_0x43cd1f[0x0],_0x154eb6[_0x53e78d]['rack']=_0x43cd1f[0x1],_0x154eb6[_0x53e78d][_0x17a9e9(0x1db)]=0x0,_0x154eb6[_0x53e78d]['bin']=0x0,_0x154eb6[_0x53e78d][_0x17a9e9(0x282)]='Floor',_0x154eb6[_0x53e78d][_0x17a9e9(0x1df)]=_0x43cd1f[0x5];}else{if(_0x53e78d==_0x3e5cb7){var _0x44db7f;if(_0x43cd1f[0x4]=='L')_0x44db7f='Level';else _0x43cd1f[0x4]=='F'&&(_0x44db7f='Floor');_0x154eb6[_0x53e78d][_0x17a9e9(0x1d7)]=_0x43cd1f[0x0],_0x154eb6[_0x53e78d]['rack']=_0x43cd1f[0x1],_0x154eb6[_0x53e78d][_0x17a9e9(0x1db)]=_0x43cd1f[0x2],_0x154eb6[_0x53e78d][_0x17a9e9(0x269)]=_0x43cd1f[0x3],_0x154eb6[_0x53e78d]['type']=_0x44db7f,_0x154eb6[_0x53e78d]['floorlevel']=_0x43cd1f[0x5];}}}});}),_0x363362[_0x532c14(0x1d9)]((_0x419d50,_0x2c29ca)=>{var _0x2c8706=_0x532c14;_0x154eb6[_0x2c29ca][_0x2c8706(0x1ff)]=_0x419d50;}),_0xdb7efa[_0x532c14(0x1d9)]((_0x3e576b,_0xcf1b8e)=>{var _0x463a3a=_0x532c14;_0x154eb6[_0xcf1b8e][_0x463a3a(0x226)]=_0x3e576b;}),_0x254cad[_0x532c14(0x1d9)]((_0x23c751,_0x5957f5)=>{var _0x553776=_0x532c14;_0x154eb6[_0x5957f5][_0x553776(0x214)]=_0x23c751;}),_0x1f0683[_0x532c14(0x1d9)]((_0x596a26,_0x1abd9a)=>{var _0x31f8e2=_0x532c14;_0x154eb6[_0x1abd9a][_0x31f8e2(0x225)]=_0x596a26;}),_0x63669c[_0x532c14(0x1d9)]((_0x418d84,_0x36ec71)=>{var _0x4a3c36=_0x532c14;_0x154eb6[_0x36ec71][_0x4a3c36(0x1fb)]=_0x418d84;}),_0x29752c[_0x532c14(0x1d9)]((_0x372cce,_0x5ee91a)=>{_0x154eb6[_0x5ee91a]['maxperunit']=_0x372cce;}),_0x4daaa7[_0x532c14(0x1d9)]((_0xb4ac4,_0x145b18)=>{var _0x1c6134=_0x532c14;_0x154eb6[_0x145b18][_0x1c6134(0x1ed)]=_0xb4ac4;}),_0x5a6ac5[_0x532c14(0x1d9)]((_0x4fee5e,_0x2d86bf)=>{var _0x1ca265=_0x532c14;_0x154eb6[_0x2d86bf][_0x1ca265(0x28b)]=_0x4fee5e;}),_0xf9005a[_0x532c14(0x1d9)]((_0x55902f,_0x305fdc)=>{_0x154eb6[_0x305fdc]['product_cat']=_0x55902f;}),_0x6f3fd1['forEach']((_0x5df0b1,_0x22ec65)=>{var _0x7733c2=_0x532c14;_0x154eb6[_0x22ec65][_0x7733c2(0x21e)]=_0x5df0b1;}),_0x4af469[_0x532c14(0x1d9)]((_0x249e4f,_0x8efc7)=>{var _0x48eb38=_0x532c14;_0x154eb6[_0x8efc7][_0x48eb38(0x2c3)]=_0x249e4f;}),_0x392ea5['forEach']((_0x1f0b71,_0x3b2543)=>{_0x154eb6[_0x3b2543]['invoice']=_0x1f0b71;});const _0x1a13e7=_0x6f3fd1[_0x532c14(0x27d)](_0x2740cc=>{return _0x2740cc={'room_name':_0x2740cc};}),_0x4822ef=_0x154eb6[_0x532c14(0x211)](_0x16c57d=>_0x16c57d[_0x532c14(0x215)]!=='0'&&_0x16c57d[_0x532c14(0x215)]!==''),_0x46105c=new purchases({'invoice':_0x1beddb,'suppliers':_0x5dec03[_0x532c14(0x29b)][_0x532c14(0x216)],'date':_0x44d63e,'warehouse_name':_0x2f4df8,'product':_0x4822ef,'note':_0x3c9ab,'due_amount':_0x1aa1b7,'POnumber':_0x1e62fc,'SCRN':_0x29c46f,'JO_number':_0x5a493f,'roomList':_0x1a13e7}),_0x524e7f=await _0x46105c[_0x532c14(0x25a)](),_0x56b810=await purchases[_0x532c14(0x1ef)]({'invoice':_0x1beddb}),_0x297b93=_0x56b810['product'][_0x532c14(0x27d)](async _0x3c3bc4=>{var _0x22595d=_0x532c14,_0x25bfa9=await warehouse[_0x22595d(0x1ef)]({'name':_0x2f4df8,'room':_0x3c3bc4[_0x22595d(0x21e)]}),_0xad59a7=0x0;return _0x25bfa9[_0x22595d(0x241)]['forEach'](_0x49b62e=>{var _0x4e6ee9=_0x22595d;_0x49b62e[_0x4e6ee9(0x1e3)]==_0x3c3bc4[_0x4e6ee9(0x1e3)]&&_0x49b62e[_0x4e6ee9(0x1df)]==_0x3c3bc4[_0x4e6ee9(0x1df)]&&_0x49b62e[_0x4e6ee9(0x282)]==_0x3c3bc4[_0x4e6ee9(0x282)]&&_0x49b62e[_0x4e6ee9(0x269)]==_0x3c3bc4[_0x4e6ee9(0x269)]&&_0x49b62e[_0x4e6ee9(0x1db)]==_0x3c3bc4[_0x4e6ee9(0x1db)]&&_0x49b62e[_0x4e6ee9(0x299)]==_0x3c3bc4['rack']&&_0x49b62e[_0x4e6ee9(0x1d7)]==_0x3c3bc4[_0x4e6ee9(0x1d7)]&&_0x49b62e['expiry_date']==_0x3c3bc4[_0x4e6ee9(0x1fb)]&&_0x49b62e[_0x4e6ee9(0x225)]==_0x3c3bc4['batch_code']&&_0x49b62e[_0x4e6ee9(0x28b)]==_0x3c3bc4[_0x4e6ee9(0x28b)]&&_0x49b62e[_0x4e6ee9(0x235)]==_0x56b810[_0x4e6ee9(0x235)]&&(_0x49b62e[_0x4e6ee9(0x29c)]+=Math[_0x4e6ee9(0x22b)](_0x3c3bc4[_0x4e6ee9(0x215)]),_0xad59a7++);}),_0xad59a7===0x0&&_0x25bfa9[_0x22595d(0x241)][_0x22595d(0x26e)]({'product_name':_0x3c3bc4[_0x22595d(0x1e3)],'product_stock':Math[_0x22595d(0x22b)](_0x3c3bc4[_0x22595d(0x215)]),'primary_code':_0x3c3bc4[_0x22595d(0x1ff)],'secondary_code':_0x3c3bc4[_0x22595d(0x226)],'product_code':_0x3c3bc4[_0x22595d(0x1e6)],'storage':_0x3c3bc4[_0x22595d(0x1d7)],'rack':_0x3c3bc4[_0x22595d(0x299)],'bay':_0x3c3bc4['bay'],'bin':_0x3c3bc4['bin'],'type':_0x3c3bc4[_0x22595d(0x282)],'floorlevel':_0x3c3bc4[_0x22595d(0x1df)],'maxProducts':_0x3c3bc4[_0x22595d(0x214)],'unit':_0x3c3bc4[_0x22595d(0x259)],'secondary_unit':_0x3c3bc4[_0x22595d(0x24f)],'expiry_date':_0x3c3bc4[_0x22595d(0x1fb)],'maxPerUnit':_0x3c3bc4[_0x22595d(0x1f2)],'batch_code':_0x3c3bc4[_0x22595d(0x225)],'alertQTY':_0x3c3bc4[_0x22595d(0x1ed)],'production_date':_0x3c3bc4['production_date'],'product_cat':_0x3c3bc4[_0x22595d(0x1e2)],'invoice':_0x3c3bc4[_0x22595d(0x235)],'actual_qty':Math[_0x22595d(0x22b)](_0x3c3bc4[_0x22595d(0x237)]),'actual_uom':_0x3c3bc4[_0x22595d(0x21a)]}),_0x25bfa9;});Promise[_0x532c14(0x2ac)](_0x297b93)[_0x532c14(0x297)](async _0x5a9759=>{var _0x18bb39=_0x532c14;try{for(const _0x569fce of _0x5a9759){await _0x569fce['save']();}const _0x212630=await master_shop[_0x18bb39(0x23a)](),_0x29d360=await email_settings[_0x18bb39(0x1ef)](),_0x2c42bf=await supervisor_settings['find']();var _0x1a7ca8=_0x56b810[_0x18bb39(0x21c)],_0x29999b='',_0x2c6ad7;for(_0x2c6ad7 in _0x1a7ca8){_0x29999b+=_0x18bb39(0x1fa)+_0x18bb39(0x1f6)+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x1e3)]+_0x18bb39(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x1e6)]+_0x18bb39(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1a7ca8[_0x2c6ad7]['quantity']+_0x18bb39(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x259)]+_0x18bb39(0x1e5)+_0x18bb39(0x1f6)+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x24f)]+_0x18bb39(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x56b810[_0x18bb39(0x274)]+_0x18bb39(0x1e5)+_0x18bb39(0x1f6)+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x21e)]+_0x18bb39(0x1e5)+_0x18bb39(0x1f6)+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x1d7)]+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x299)]+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x1db)]+_0x1a7ca8[_0x2c6ad7]['bin']+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x282)][0x0]+_0x1a7ca8[_0x2c6ad7][_0x18bb39(0x1df)]+'</td>',_0x18bb39(0x256);}let _0x4a5f39=nodemailer[_0x18bb39(0x275)]({'host':_0x29d360['host'],'port':Number(_0x29d360[_0x18bb39(0x27e)]),'secure':![],'auth':{'user':_0x29d360[_0x18bb39(0x2b3)],'pass':_0x29d360[_0x18bb39(0x271)]}}),_0x9db2cf={'from':_0x29d360['email'],'to':_0x2c42bf[0x0][_0x18bb39(0x280)],'subject':_0x18bb39(0x26b),'attachments':[{'filename':_0x18bb39(0x2f0),'path':__dirname+_0x18bb39(0x247)+_0x18bb39(0x2e5)+_0x212630[0x0]['image'],'cid':_0x18bb39(0x268)}],'html':_0x18bb39(0x20c)+_0x18bb39(0x1d8)+'</head><body>'+_0x18bb39(0x21b)+_0x18bb39(0x22d)+'<div>'+_0x18bb39(0x222)+_0x18bb39(0x200)+'<div>'+'<h2>\x20'+_0x212630[0x0][_0x18bb39(0x264)]+_0x18bb39(0x2f4)+_0x18bb39(0x200)+_0x18bb39(0x200)+_0x18bb39(0x1ee)+_0x18bb39(0x21b)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x18bb39(0x1de)+_0x56b810[_0x18bb39(0x235)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x56b810[_0x18bb39(0x2e4)]+'\x20'+_0x18bb39(0x26c)+_0x18bb39(0x26a)+'</div>'+_0x18bb39(0x298)+_0x18bb39(0x2c6)+_0x18bb39(0x1fa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x18bb39(0x1f4)+_0x18bb39(0x245)+_0x18bb39(0x277)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x18bb39(0x20a)+_0x18bb39(0x254)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x18bb39(0x256)+'</thead>'+_0x18bb39(0x1dc)+'\x20'+_0x29999b+'\x20'+_0x18bb39(0x239)+_0x18bb39(0x281)+_0x18bb39(0x21b)+_0x18bb39(0x272)+_0x18bb39(0x2a9)+_0x212630[0x0][_0x18bb39(0x264)]+_0x18bb39(0x26a)+_0x18bb39(0x200)+_0x18bb39(0x200)+_0x18bb39(0x258)};_0x4a5f39['sendMail'](_0x9db2cf,function(_0x2deead,_0x3b58b7){var _0xdbb10=_0x18bb39;_0x2deead?(console['log'](_0x2deead),console[_0xdbb10(0x2aa)](_0xdbb10(0x20d))):console[_0xdbb10(0x2aa)](_0xdbb10(0x23e));}),_0x5dec03[_0x18bb39(0x219)](_0x18bb39(0x231),_0x18bb39(0x240)),_0xd188f0[_0x18bb39(0x2c2)](_0x18bb39(0x25d));}catch(_0x442440){console['error'](_0x442440),_0xd188f0[_0x18bb39(0x2a8)](0x1f4)['json']({'error':_0x18bb39(0x2af)});}})[_0x532c14(0x23b)](_0x462608=>{var _0x46517=_0x532c14;console[_0x46517(0x2bd)](_0x462608),_0xd188f0['status'](0x1f4)[_0x46517(0x2eb)]({'error':_0x46517(0x276)});});}catch(_0x5e75ba){console[_0x532c14(0x2aa)](_0x5e75ba);}}),router[a0_0xecd78d(0x260)](a0_0xecd78d(0x2cd),auth,async(_0x2b46bc,_0x354ec2)=>{var _0x3f1713=a0_0xecd78d;try{const {username:_0x5e83d4,email:_0xf2254b,role:_0x2d99b0}=_0x2b46bc[_0x3f1713(0x220)],_0x1e4af1=_0x2b46bc['user'],_0x294390=await profile['findOne']({'email':_0x1e4af1[_0x3f1713(0x2b3)]}),_0x1d472d=await master_shop[_0x3f1713(0x23a)](),_0x47610b=_0x2b46bc[_0x3f1713(0x234)]['id'],_0x882150=await purchases[_0x3f1713(0x208)](_0x47610b),_0x4a9e89=await warehouse['aggregate']([{'$match':{'name':_0x882150[_0x3f1713(0x274)],'room':_0x882150[_0x3f1713(0x22a)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3f1713(0x246),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3f1713(0x24d)},'bay':{'$first':_0x3f1713(0x2f2)},'bin':{'$first':_0x3f1713(0x2ad)},'type':{'$first':_0x3f1713(0x2ed)},'floorlevel':{'$first':_0x3f1713(0x24c)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3f1713(0x204)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3f1713(0x261)},'expiry_date':{'$first':_0x3f1713(0x24a)}}}]),_0x5220af=await customer[_0x3f1713(0x23a)]({});let _0x17ce6d;if(_0x1e4af1[_0x3f1713(0x1f5)]==_0x3f1713(0x22c)){const _0x5a23c0=await staff[_0x3f1713(0x1ef)]({'email':_0x1e4af1['email']});_0x17ce6d=await warehouse[_0x3f1713(0x292)]([{'$match':{'status':_0x3f1713(0x207),'name':_0x5a23c0['warehouse']}},{'$group':{'_id':_0x3f1713(0x213),'name':{'$first':_0x3f1713(0x213)}}}]);}else _0x17ce6d=await warehouse['aggregate']([{'$match':{'status':_0x3f1713(0x207)}},{'$group':{'_id':_0x3f1713(0x213),'name':{'$first':_0x3f1713(0x213)}}}]);const _0x493870=await product[_0x3f1713(0x23a)]({}),_0x404473=await suppliers[_0x3f1713(0x23a)]({}),_0x18242b=BayBinSelected(_0x882150['warehouse_name'],_0x882150['room']);if(_0x1d472d[0x0][_0x3f1713(0x22f)]==_0x3f1713(0x1da)){var _0x4c85e6=users['English'];console['log'](_0x4c85e6);}else{if(_0x1d472d[0x0][_0x3f1713(0x22f)]==_0x3f1713(0x2e8))var _0x4c85e6=users[_0x3f1713(0x2e8)];else{if(_0x1d472d[0x0][_0x3f1713(0x22f)]=='German')var _0x4c85e6=users[_0x3f1713(0x28c)];else{if(_0x1d472d[0x0][_0x3f1713(0x22f)]=='Spanish')var _0x4c85e6=users['Spanish'];else{if(_0x1d472d[0x0][_0x3f1713(0x22f)]==_0x3f1713(0x1e7))var _0x4c85e6=users[_0x3f1713(0x1e7)];else{if(_0x1d472d[0x0][_0x3f1713(0x22f)]==_0x3f1713(0x24b))var _0x4c85e6=users[_0x3f1713(0x284)];else{if(_0x1d472d[0x0]['language']==_0x3f1713(0x2a7))var _0x4c85e6=users[_0x3f1713(0x2a7)];else{if(_0x1d472d[0x0]['language']==_0x3f1713(0x20f))var _0x4c85e6=users['Arabic'];}}}}}}}_0x354ec2['render'](_0x3f1713(0x28a),{'success':_0x2b46bc[_0x3f1713(0x219)]('success'),'errors':_0x2b46bc['flash']('errors'),'role':_0x1e4af1,'profile':_0x294390,'customer':_0x5220af,'warehouse':_0x17ce6d,'product':_0x4a9e89,'user':_0x882150,'master_shop':_0x1d472d,'unit':_0x493870,'language':_0x4c85e6,'suppliers':_0x404473,'dataSelected':_0x18242b});}catch(_0x442008){console[_0x3f1713(0x2aa)](_0x442008);}}),router[a0_0xecd78d(0x265)](a0_0xecd78d(0x2cd),auth,async(_0xf27904,_0x495238)=>{var _0x204fac=a0_0xecd78d;try{const _0x37281f=_0xf27904[_0x204fac(0x234)]['id'],{invoice:_0x2893cb,warehouse_name:_0x1eb2c0,Room_name:_0x547da6}=_0xf27904[_0x204fac(0x29b)],_0x35c6bb=await warehouse['findOne']({'name':_0x1eb2c0,'room':_0x547da6}),_0x101884=await purchases[_0x204fac(0x1ef)]({'invoice':_0x2893cb});_0x101884[_0x204fac(0x21c)][_0x204fac(0x1d9)](_0x13fff9=>{var _0x7fc3c5=_0x204fac,_0x47eb02=0x0;const _0x2e70e5=_0x35c6bb[_0x7fc3c5(0x241)][_0x7fc3c5(0x27d)](_0x3a255d=>{var _0x1c2e33=_0x7fc3c5;_0x3a255d['product_name']==_0x13fff9[_0x1c2e33(0x1e3)]&&_0x3a255d[_0x1c2e33(0x1df)]==_0x13fff9['floorlevel']&&_0x3a255d[_0x1c2e33(0x282)]==_0x13fff9['type']&&_0x3a255d[_0x1c2e33(0x269)]==_0x13fff9[_0x1c2e33(0x269)]&&_0x3a255d[_0x1c2e33(0x1db)]==_0x13fff9[_0x1c2e33(0x1db)]&&_0x3a255d[_0x1c2e33(0x299)]==_0x13fff9[_0x1c2e33(0x299)]&&_0x3a255d[_0x1c2e33(0x1d7)]==_0x13fff9[_0x1c2e33(0x1d7)]&&_0x3a255d['expiry_date']==_0x13fff9[_0x1c2e33(0x1fb)]&&_0x3a255d[_0x1c2e33(0x225)]==_0x13fff9[_0x1c2e33(0x225)]&&_0x3a255d[_0x1c2e33(0x28b)]==_0x13fff9[_0x1c2e33(0x28b)]&&_0x3a255d[_0x1c2e33(0x2a3)]==_0x13fff9[_0x1c2e33(0x2a3)]&&_0x3a255d[_0x1c2e33(0x2c3)]==_0x13fff9[_0x1c2e33(0x2c3)]&&(_0x3a255d[_0x1c2e33(0x29c)]=parseInt(_0x3a255d['product_stock'])+parseInt(_0x13fff9[_0x1c2e33(0x215)]),_0x47eb02++);});_0x47eb02=='0'&&(_0x35c6bb[_0x7fc3c5(0x241)]=_0x35c6bb['product_details']['concat']({'product_name':_0x13fff9[_0x7fc3c5(0x1e3)],'product_stock':_0x13fff9[_0x7fc3c5(0x215)],'primary_code':_0x13fff9[_0x7fc3c5(0x1ff)],'secondary_code':_0x13fff9[_0x7fc3c5(0x226)],'product_code':_0x13fff9[_0x7fc3c5(0x1e6)],'storage':_0x13fff9[_0x7fc3c5(0x1d7)],'rack':_0x13fff9[_0x7fc3c5(0x299)],'bay':_0x13fff9[_0x7fc3c5(0x1db)],'bin':_0x13fff9[_0x7fc3c5(0x269)],'type':_0x13fff9[_0x7fc3c5(0x282)],'floorlevel':_0x13fff9[_0x7fc3c5(0x1df)],'maxProducts':_0x13fff9[_0x7fc3c5(0x214)],'unit':_0x13fff9['standard_unit'],'secondary_unit':_0x13fff9['secondary_unit'],'expiry_date':_0x13fff9[_0x7fc3c5(0x1fb)],'maxPerUnit':_0x13fff9[_0x7fc3c5(0x1f2)],'batch_code':_0x13fff9['batch_code'],'alertQTY':_0x13fff9['alertQTY'],'production_date':_0x13fff9[_0x7fc3c5(0x28b)],'delivery_date':_0x13fff9[_0x7fc3c5(0x2a3)],'delivery_code':_0x13fff9[_0x7fc3c5(0x2c3)]}));}),await _0x35c6bb[_0x204fac(0x25a)](),_0x101884[_0x204fac(0x21d)]=_0x204fac(0x2d4);const _0xd1cb80=await _0x101884[_0x204fac(0x25a)]();_0xf27904['flash']('success',_0x204fac(0x25b)),_0x495238['redirect'](_0x204fac(0x289));}catch(_0x4f1cd6){console[_0x204fac(0x2aa)](_0x4f1cd6);}}),router['get'](a0_0xecd78d(0x2cf),auth,async(_0x4279e3,_0xc95de9)=>{var _0x11a10c=a0_0xecd78d;try{const {username:_0x1762eb,email:_0x2343b6,role:_0x1cf46f}=_0x4279e3[_0x11a10c(0x220)],_0x480d83=_0x4279e3[_0x11a10c(0x220)],_0x564090=await profile[_0x11a10c(0x1ef)]({'email':_0x480d83[_0x11a10c(0x2b3)]}),_0x1804de=await master_shop['find'](),_0x392401=_0x4279e3[_0x11a10c(0x234)]['id'],_0x287e5f=await purchases[_0x11a10c(0x208)](_0x392401),_0x4d230e=await suppliers[_0x11a10c(0x23a)]({});let _0x79fb44;if(_0x480d83[_0x11a10c(0x1f5)]==_0x11a10c(0x22c)){const _0x37cab2=await staff[_0x11a10c(0x1ef)]({'email':_0x480d83[_0x11a10c(0x2b3)]});_0x79fb44=await warehouse[_0x11a10c(0x23a)]({'status':_0x11a10c(0x207),'name':_0x37cab2[_0x11a10c(0x2e9)],'warehouse_category':_0x11a10c(0x29d)});}else _0x79fb44=await warehouse[_0x11a10c(0x292)]([{'$match':{'status':_0x11a10c(0x207),'warehouse_category':_0x11a10c(0x29d)}},{'$group':{'_id':_0x11a10c(0x213),'name':{'$first':_0x11a10c(0x213)}}}]);const _0xe34b6d=await product[_0x11a10c(0x23a)]({}),_0x5adf60=BayBinSelected(_0x287e5f[_0x11a10c(0x274)],_0x287e5f[_0x11a10c(0x22a)]);let _0x5bd62a=new Date(_0x287e5f[_0x11a10c(0x1fb)]),_0x51945a=('0'+_0x5bd62a['getDate']())[_0x11a10c(0x25e)](-0x2),_0x376163=('0'+(_0x5bd62a['getMonth']()+0x1))[_0x11a10c(0x25e)](-0x2),_0x511cd0=_0x5bd62a[_0x11a10c(0x22e)](),_0x1d2a58=_0x511cd0+'-'+_0x376163+'-'+_0x51945a;if(_0x1804de[0x0]['language']==_0x11a10c(0x1da)){var _0x568f45=users[_0x11a10c(0x203)];console[_0x11a10c(0x2aa)](_0x568f45);}else{if(_0x1804de[0x0]['language']=='Hindi')var _0x568f45=users[_0x11a10c(0x2e8)];else{if(_0x1804de[0x0][_0x11a10c(0x22f)]==_0x11a10c(0x28c))var _0x568f45=users[_0x11a10c(0x28c)];else{if(_0x1804de[0x0][_0x11a10c(0x22f)]=='Spanish')var _0x568f45=users[_0x11a10c(0x25f)];else{if(_0x1804de[0x0][_0x11a10c(0x22f)]==_0x11a10c(0x1e7))var _0x568f45=users[_0x11a10c(0x1e7)];else{if(_0x1804de[0x0][_0x11a10c(0x22f)]=='Portuguese\x20(BR)')var _0x568f45=users[_0x11a10c(0x284)];else{if(_0x1804de[0x0][_0x11a10c(0x22f)]=='Chinese')var _0x568f45=users[_0x11a10c(0x2a7)];else{if(_0x1804de[0x0][_0x11a10c(0x22f)]==_0x11a10c(0x20f))var _0x568f45=users['Arabic'];}}}}}}}_0xc95de9[_0x11a10c(0x242)]('edit_purchases',{'success':_0x4279e3[_0x11a10c(0x219)]('success'),'errors':_0x4279e3['flash']('errors'),'role':_0x480d83,'profile':_0x564090,'purchases':_0x287e5f,'suppliers':_0x4d230e,'warehouse':_0x79fb44,'product':_0xe34b6d,'master_shop':_0x1804de,'language':_0x568f45,'ed_fullDate':_0x1d2a58,'dataSelected':_0x5adf60});}catch(_0x1ac321){console['log'](_0x1ac321);}}),router['post'](a0_0xecd78d(0x2cf),auth,async(_0x31c662,_0x3cf7b6)=>{var _0x49b2cc=a0_0xecd78d;try{const _0x28da9b=_0x31c662[_0x49b2cc(0x234)]['id'],_0x35e36f=await purchases['findOne']({'_id':_0x31c662[_0x49b2cc(0x234)]['id']}),_0x4178da=await warehouse[_0x49b2cc(0x1ef)]({'name':_0x35e36f['warehouse_name'],'room':_0x35e36f['room']});_0x35e36f[_0x49b2cc(0x21c)][_0x49b2cc(0x1d9)](_0x4c1167=>{var _0x2b574c=_0x49b2cc;const _0x4638dc=_0x4178da[_0x2b574c(0x241)][_0x2b574c(0x27d)](_0x21aed5=>{var _0x2979e7=_0x2b574c;_0x21aed5[_0x2979e7(0x1e3)]==_0x4c1167[_0x2979e7(0x1e3)]&&_0x21aed5[_0x2979e7(0x1df)]==_0x4c1167[_0x2979e7(0x1df)]&&_0x21aed5[_0x2979e7(0x282)]==_0x4c1167[_0x2979e7(0x282)]&&_0x21aed5[_0x2979e7(0x269)]==_0x4c1167['bin']&&_0x21aed5['bay']==_0x4c1167[_0x2979e7(0x1db)]&&_0x21aed5[_0x2979e7(0x299)]==_0x4c1167[_0x2979e7(0x299)]&&_0x21aed5[_0x2979e7(0x1d7)]==_0x4c1167[_0x2979e7(0x1d7)]&&(_0x21aed5['product_stock']=parseInt(_0x21aed5[_0x2979e7(0x29c)])-parseInt(_0x4c1167['quantity']));});}),await _0x4178da['save']();const {invoice:_0x42f579,suppliers:_0x12e6fd,date:_0x3e72f6,warehouse_name:_0x4e8427,prod_name:_0x16016e,prod_code:_0xcb9537,prod_qty:_0x8ee42f,prod_unit:_0x18c632,prod_secondunit:_0x50fe81,prod_level:_0x45492d,prod_isle:_0x110cc3,prod_pallet:_0x54d239,note:_0x3b580e,expiry_date:_0x312b68,batch_code:_0x123f37,paid_amount:_0x42adc2,due_amount:_0x1f9e3c,Room_name:_0xcafa02,primary_code:_0x190d56,secondary_code:_0x74063a,PO_number:_0x214acc,JO_number:_0x125bc4}=_0x31c662['body'];if(typeof _0x16016e==_0x49b2cc(0x218))var _0x7e945a=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1d6)]],_0x4bdff2=[_0x31c662[_0x49b2cc(0x29b)]['prod_code']],_0x1af849=[_0x31c662[_0x49b2cc(0x29b)]['prod_qty']],_0x297eec=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x267)]],_0x2bf66b=[_0x31c662['body']['prod_secondunit']],_0xd7b044=[_0x31c662['body'][_0x49b2cc(0x27f)]],_0x1d600d=[_0x31c662[_0x49b2cc(0x29b)]['prod_isle']],_0x51a825=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x21f)]],_0xa047af=[_0x31c662['body'][_0x49b2cc(0x1ff)]],_0x5490b3=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x226)]],_0x435794=[_0x31c662['body'][_0x49b2cc(0x27b)]],_0x4e78b2=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x225)]],_0x552650=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1fb)]],_0x2b2183=[_0x31c662[_0x49b2cc(0x29b)]['storage']],_0x37ace5=[_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1f9)]],_0x280d4e=[_0x31c662['body'][_0x49b2cc(0x282)]];else var _0x7e945a=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1d6)]],_0x4bdff2=[..._0x31c662[_0x49b2cc(0x29b)]['prod_code']],_0x1af849=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x2b2)]],_0x297eec=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x267)]],_0x2bf66b=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x283)]],_0xd7b044=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x27f)]],_0x1d600d=[..._0x31c662['body'][_0x49b2cc(0x296)]],_0x51a825=[..._0x31c662['body'][_0x49b2cc(0x21f)]],_0xa047af=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1ff)]],_0x5490b3=[..._0x31c662[_0x49b2cc(0x29b)]['secondary_code']],_0x435794=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x27b)]],_0x4e78b2=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x225)]],_0x552650=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1fb)]],_0x2b2183=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1d7)]],_0x37ace5=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x1f9)]],_0x280d4e=[..._0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x282)]];const _0x252d83=_0x7e945a[_0x49b2cc(0x27d)](_0x124fbe=>{return _0x124fbe={'product_name':_0x124fbe};});_0x4bdff2[_0x49b2cc(0x1d9)]((_0x166bff,_0x2bf39b)=>{var _0x32feaf=_0x49b2cc;_0x252d83[_0x2bf39b][_0x32feaf(0x1e6)]=_0x166bff;}),_0x1af849['forEach']((_0x2c0d05,_0x2f5e54)=>{var _0x328960=_0x49b2cc;_0x252d83[_0x2f5e54][_0x328960(0x215)]=_0x2c0d05;}),_0x297eec[_0x49b2cc(0x1d9)]((_0x4a286f,_0x3003e0)=>{var _0xea936b=_0x49b2cc;_0x252d83[_0x3003e0][_0xea936b(0x259)]=_0x4a286f;}),_0x2bf66b[_0x49b2cc(0x1d9)]((_0x43e153,_0x9fafbe)=>{var _0xf9c9f6=_0x49b2cc;_0x252d83[_0x9fafbe][_0xf9c9f6(0x24f)]=_0x43e153;}),_0xd7b044[_0x49b2cc(0x1d9)]((_0x34fb58,_0x65a6ae)=>{_0x252d83[_0x65a6ae]['bay']=_0x34fb58;}),_0x1d600d[_0x49b2cc(0x1d9)]((_0x2d8e8e,_0x17c227)=>{var _0x26caee=_0x49b2cc;_0x252d83[_0x17c227][_0x26caee(0x269)]=_0x2d8e8e;}),_0x51a825['forEach']((_0x309838,_0x24c00c)=>{var _0x55bf63=_0x49b2cc;_0x252d83[_0x24c00c][_0x55bf63(0x1df)]=_0x309838;}),_0xa047af[_0x49b2cc(0x1d9)]((_0xa0d7a6,_0x2de548)=>{var _0x26d758=_0x49b2cc;_0x252d83[_0x2de548][_0x26d758(0x1ff)]=_0xa0d7a6;}),_0x5490b3[_0x49b2cc(0x1d9)]((_0x138a9a,_0x4997a5)=>{_0x252d83[_0x4997a5]['secondary_code']=_0x138a9a;}),_0x435794[_0x49b2cc(0x1d9)]((_0x1e25e8,_0x3d0e86)=>{var _0x50c7e9=_0x49b2cc;_0x252d83[_0x3d0e86][_0x50c7e9(0x214)]=_0x1e25e8;}),_0x4e78b2[_0x49b2cc(0x1d9)]((_0x53b322,_0x3be7c0)=>{var _0x5d1888=_0x49b2cc;_0x252d83[_0x3be7c0][_0x5d1888(0x225)]=_0x53b322;}),_0x552650[_0x49b2cc(0x1d9)]((_0x7b354e,_0x63e91f)=>{var _0x459544=_0x49b2cc;_0x252d83[_0x63e91f][_0x459544(0x1fb)]=_0x7b354e;}),_0x280d4e[_0x49b2cc(0x1d9)]((_0x147eb2,_0x1e5d52)=>{var _0x11e0f9=_0x49b2cc;_0x252d83[_0x1e5d52][_0x11e0f9(0x282)]=_0x147eb2;}),_0x2b2183['forEach']((_0x22e569,_0x3bf558)=>{var _0x2aa70a=_0x49b2cc;_0x252d83[_0x3bf558][_0x2aa70a(0x1d7)]=_0x22e569;}),_0x37ace5[_0x49b2cc(0x1d9)]((_0x11a3e0,_0x9c2e73)=>{var _0xe7de0b=_0x49b2cc;_0x252d83[_0x9c2e73][_0xe7de0b(0x299)]=_0x11a3e0;});const _0x59f049=_0x252d83[_0x49b2cc(0x211)](_0x2feef5=>_0x2feef5[_0x49b2cc(0x215)]!=='0'&&_0x2feef5[_0x49b2cc(0x215)]!=='');_0x35e36f[_0x49b2cc(0x235)]=_0x42f579,_0x35e36f[_0x49b2cc(0x216)]=_0x12e6fd,_0x35e36f[_0x49b2cc(0x2e4)]=_0x3e72f6,_0x35e36f[_0x49b2cc(0x274)]=_0x4e8427,_0x35e36f[_0x49b2cc(0x21c)]=_0x59f049,_0x35e36f[_0x49b2cc(0x27a)]=_0x3b580e,_0x35e36f[_0x49b2cc(0x2dd)]=_0x42adc2,_0x35e36f[_0x49b2cc(0x2a2)]=_0x1f9e3c,_0x35e36f[_0x49b2cc(0x22a)]=_0xcafa02,_0x35e36f[_0x49b2cc(0x2cc)]=_0x214acc,_0x35e36f[_0x49b2cc(0x2c9)]=_0x125bc4;const _0x3f9980=await _0x35e36f[_0x49b2cc(0x25a)](),_0x312fb8=await warehouse[_0x49b2cc(0x1ef)]({'name':_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x274)],'room':_0x31c662['body'][_0x49b2cc(0x2a6)]});_0x35e36f[_0x49b2cc(0x21c)]['forEach'](_0x3bed46=>{var _0x583dc2=_0x49b2cc,_0x27a762=0x0;const _0x283f73=_0x312fb8[_0x583dc2(0x241)]['map'](_0x23832a=>{var _0x283e05=_0x583dc2;_0x23832a[_0x283e05(0x1e3)]==_0x3bed46[_0x283e05(0x1e3)]&&_0x23832a[_0x283e05(0x1df)]==_0x3bed46[_0x283e05(0x1df)]&&_0x23832a['type']==_0x3bed46[_0x283e05(0x282)]&&_0x23832a['bin']==_0x3bed46[_0x283e05(0x269)]&&_0x23832a[_0x283e05(0x1db)]==_0x3bed46[_0x283e05(0x1db)]&&_0x23832a[_0x283e05(0x299)]==_0x3bed46['rack']&&_0x23832a[_0x283e05(0x1d7)]==_0x3bed46[_0x283e05(0x1d7)]&&(_0x23832a[_0x283e05(0x29c)]=parseInt(_0x23832a[_0x283e05(0x29c)])+parseInt(_0x3bed46[_0x283e05(0x215)]),_0x27a762++);});_0x27a762=='0'&&(_0x312fb8[_0x583dc2(0x241)]=_0x312fb8[_0x583dc2(0x241)]['concat']({'product_name':_0x3bed46[_0x583dc2(0x1e3)],'product_stock':_0x3bed46[_0x583dc2(0x215)],'primary_code':_0x3bed46['primary_code'],'secondary_code':_0x3bed46[_0x583dc2(0x226)],'product_code':_0x3bed46[_0x583dc2(0x1e6)],'storage':_0x3bed46['storage'],'rack':_0x3bed46['rack'],'bay':_0x3bed46[_0x583dc2(0x1db)],'bin':_0x3bed46[_0x583dc2(0x269)],'type':_0x3bed46['type'],'floorlevel':_0x3bed46[_0x583dc2(0x1df)],'maxProducts':_0x3bed46[_0x583dc2(0x214)],'unit':_0x3bed46[_0x583dc2(0x259)],'secondary_unit':_0x3bed46[_0x583dc2(0x24f)],'expiry_date':_0x3bed46[_0x583dc2(0x1fb)]}));}),await _0x312fb8['save']();const _0x26f0b1=await s_payment_data[_0x49b2cc(0x1ef)]({'invoice':_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x235)]});if(_0x26f0b1===null){}else console[_0x49b2cc(0x2aa)](_0x49b2cc(0x216),_0x26f0b1,_0x31c662[_0x49b2cc(0x29b)][_0x49b2cc(0x235)]),_0x26f0b1[_0x49b2cc(0x216)]=_0x31c662[_0x49b2cc(0x29b)]['suppliers'],await _0x26f0b1[_0x49b2cc(0x25a)]();_0x31c662[_0x49b2cc(0x219)](_0x49b2cc(0x231),_0x49b2cc(0x1dd)),_0x3cf7b6[_0x49b2cc(0x2c2)](_0x49b2cc(0x289));}catch(_0x5b7f31){console[_0x49b2cc(0x2aa)](_0x5b7f31);}}),router[a0_0xecd78d(0x265)]('/give_payment/:id',auth,async(_0x5d9e20,_0x5216a9)=>{var _0x23bd4f=a0_0xecd78d;try{const _0x584449=_0x5d9e20[_0x23bd4f(0x234)]['id'],{invoice:_0x3620e1,suppliers:_0xd621d4,payable:_0x23292e,due_amount:_0x302bcf}=_0x5d9e20[_0x23bd4f(0x29b)],_0x1f2931=await purchases[_0x23bd4f(0x208)](_0x584449);var _0x286695=_0x23292e-_0x302bcf;_0x1f2931[_0x23bd4f(0x2dd)]=parseFloat(_0x1f2931['paid_amount'])+parseFloat(_0x302bcf),_0x1f2931[_0x23bd4f(0x2a2)]=_0x286695;const _0x5b166a=await _0x1f2931[_0x23bd4f(0x25a)]();console['log'](_0x5b166a);const _0x21dc7a=await s_payment_data['findOne']({'invoice':_0x3620e1});_0x21dc7a[_0x23bd4f(0x252)]=_0x286695,await _0x21dc7a[_0x23bd4f(0x25a)]();let _0x4566cb=new Date(),_0x4f9620=('0'+_0x4566cb[_0x23bd4f(0x2bb)]())[_0x23bd4f(0x25e)](-0x2),_0x1fe6e8=('0'+(_0x4566cb[_0x23bd4f(0x228)]()+0x1))['slice'](-0x2),_0x4c74d8=_0x4566cb[_0x23bd4f(0x22e)](),_0x1b515f=_0x4c74d8+'-'+_0x1fe6e8+'-'+_0x4f9620;const _0x4a48e3=new suppliers_payment({'invoice':_0x3620e1,'date':_0x4c74d8+'-'+_0x1fe6e8+'-'+_0x4f9620,'suppliers':_0xd621d4,'reason':_0x23bd4f(0x1d2),'amount':_0x302bcf}),_0x3bae2f=await _0x4a48e3['save']();_0x5d9e20[_0x23bd4f(0x219)](_0x23bd4f(0x231),_0x23bd4f(0x2c1)),_0x5216a9[_0x23bd4f(0x2c2)](_0x23bd4f(0x289));}catch(_0x255a6e){console[_0x23bd4f(0x2aa)](_0x255a6e);}}),router['get'](a0_0xecd78d(0x257),auth,async(_0x48e36b,_0x21377a)=>{var _0x10e4ae=a0_0xecd78d;try{const {username:_0x2f97e1,email:_0x3b90ae,role:_0x401ec0}=_0x48e36b[_0x10e4ae(0x220)],_0x28d664=_0x48e36b[_0x10e4ae(0x220)],_0x3fed4b=await profile[_0x10e4ae(0x1ef)]({'email':_0x28d664[_0x10e4ae(0x2b3)]}),_0x55f5c6=await master_shop[_0x10e4ae(0x23a)]();console[_0x10e4ae(0x2aa)](_0x10e4ae(0x1ea),_0x55f5c6);const _0xc433d1=_0x48e36b[_0x10e4ae(0x234)]['id'],_0x14227d=await purchases[_0x10e4ae(0x208)](_0xc433d1);console[_0x10e4ae(0x2aa)](_0x14227d);const _0x4efd81=await suppliers['findOne']({'name':_0x14227d['suppliers']});console['log'](_0x4efd81);if(_0x55f5c6[0x0]['language']=='English\x20(US)'){var _0x10063d=users[_0x10e4ae(0x203)];console[_0x10e4ae(0x2aa)](_0x10063d);}else{if(_0x55f5c6[0x0][_0x10e4ae(0x22f)]==_0x10e4ae(0x2e8))var _0x10063d=users['Hindi'];else{if(_0x55f5c6[0x0]['language']==_0x10e4ae(0x28c))var _0x10063d=users[_0x10e4ae(0x28c)];else{if(_0x55f5c6[0x0][_0x10e4ae(0x22f)]=='Spanish')var _0x10063d=users[_0x10e4ae(0x25f)];else{if(_0x55f5c6[0x0][_0x10e4ae(0x22f)]=='French')var _0x10063d=users['French'];else{if(_0x55f5c6[0x0]['language']==_0x10e4ae(0x24b))var _0x10063d=users[_0x10e4ae(0x284)];else{if(_0x55f5c6[0x0][_0x10e4ae(0x22f)]==_0x10e4ae(0x2a7))var _0x10063d=users[_0x10e4ae(0x2a7)];else{if(_0x55f5c6[0x0][_0x10e4ae(0x22f)]=='Arabic\x20(ae)')var _0x10063d=users[_0x10e4ae(0x2ea)];}}}}}}}_0x21377a[_0x10e4ae(0x242)]('purchase_invoice',{'success':_0x48e36b[_0x10e4ae(0x219)]('success'),'errors':_0x48e36b['flash'](_0x10e4ae(0x2de)),'role':_0x28d664,'profile':_0x3fed4b,'master_shop':_0x55f5c6,'supplier':_0x4efd81,'purchase':_0x14227d,'language':_0x10063d});}catch(_0x5a90d0){console['log'](_0x5a90d0);}}),router[a0_0xecd78d(0x260)](a0_0xecd78d(0x2cb),auth,async(_0x177fff,_0x279580)=>{var _0x53c558=a0_0xecd78d;try{const {username:_0x54645b,email:_0x312b1d,role:_0x2bb8bf}=_0x177fff[_0x53c558(0x220)],_0x31c3eb=_0x177fff[_0x53c558(0x220)],_0x1114c6=await profile[_0x53c558(0x1ef)]({'email':_0x31c3eb[_0x53c558(0x2b3)]}),_0x2fcb22=await master_shop[_0x53c558(0x23a)]();console[_0x53c558(0x2aa)](_0x53c558(0x1ea),_0x2fcb22);const _0x3249c1=_0x177fff[_0x53c558(0x234)]['id'];console[_0x53c558(0x2aa)](_0x3249c1);const _0xa8737b=await purchases['findById'](_0x3249c1);console[_0x53c558(0x2aa)](_0x53c558(0x2df),_0xa8737b);const _0x25e341=await product[_0x53c558(0x23a)]({}),_0x4fcba3=await warehouse['aggregate']([{'$match':{'name':_0xa8737b[_0x53c558(0x274)],'room':_0xa8737b[_0x53c558(0x22a)],'warehouse_category':_0x53c558(0x29d)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x53c558(0x246),'name':{'$first':_0x53c558(0x227)},'product_stock':{'$first':_0x53c558(0x24d)},'bay':{'$first':_0x53c558(0x2f2)},'bin':{'$first':_0x53c558(0x2ad)},'type':{'$first':_0x53c558(0x2ed)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x53c558(0x266)},'secondary_code':{'$first':_0x53c558(0x2d8)},'product_code':{'$first':_0x53c558(0x204)},'storage':{'$first':_0x53c558(0x250)},'rack':{'$first':_0x53c558(0x261)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x53c558(0x207),'name':_0x53c558(0x2f5),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x53c558(0x213),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x53c558(0x2aa)]('stock_data',_0x4fcba3);if(_0x2fcb22[0x0]['language']==_0x53c558(0x1da)){var _0x4fbe29=users[_0x53c558(0x203)];console[_0x53c558(0x2aa)](_0x4fbe29);}else{if(_0x2fcb22[0x0][_0x53c558(0x22f)]==_0x53c558(0x2e8))var _0x4fbe29=users[_0x53c558(0x2e8)];else{if(_0x2fcb22[0x0][_0x53c558(0x22f)]==_0x53c558(0x28c))var _0x4fbe29=users['German'];else{if(_0x2fcb22[0x0][_0x53c558(0x22f)]==_0x53c558(0x25f))var _0x4fbe29=users[_0x53c558(0x25f)];else{if(_0x2fcb22[0x0]['language']=='French')var _0x4fbe29=users['French'];else{if(_0x2fcb22[0x0]['language']=='Portuguese\x20(BR)')var _0x4fbe29=users[_0x53c558(0x284)];else{if(_0x2fcb22[0x0]['language']==_0x53c558(0x2a7))var _0x4fbe29=users['Chinese'];else{if(_0x2fcb22[0x0][_0x53c558(0x22f)]==_0x53c558(0x20f))var _0x4fbe29=users['Arabic'];}}}}}}}_0x279580[_0x53c558(0x242)](_0x53c558(0x291),{'success':_0x177fff['flash'](_0x53c558(0x231)),'errors':_0x177fff['flash'](_0x53c558(0x2de)),'role':_0x31c3eb,'profile':_0x1114c6,'user':_0xa8737b,'stock':_0x4fcba3,'master_shop':_0x2fcb22,'product':_0x25e341,'language':_0x4fbe29,'warehouse':warehouse_data});}catch(_0x1c6570){console[_0x53c558(0x2aa)](_0x1c6570);}}),router[a0_0xecd78d(0x265)]('/view/return_purchase/:id',auth,async(_0x15a9ae,_0x3b0624)=>{var _0x477e09=a0_0xecd78d;try{const {invoice:_0x3098fa,date:_0x3185e2,warehouse_name:_0x329c4d,Room_name:_0x14907e,product_name:_0x54c5fe,purchase_quantity:_0x4e96e5,stocks:_0x5d6a5a,return_qty:_0x980e77,note:_0xd9028c,level:_0x1f915d,isle:_0xaeee3e,pallet:_0x178a5a,to_warehouse_name:_0x48942,to_Room_name:_0x4658c4}=_0x15a9ae[_0x477e09(0x29b)],_0x40706b=await purchases['findOne']({'_id':_0x15a9ae[_0x477e09(0x234)]['id']}),_0x8cb5b3=await warehouse[_0x477e09(0x1ef)]({'name':_0x329c4d,'room':_0x14907e});if(typeof _0x54c5fe==_0x477e09(0x218))var _0x4ad39d=[_0x15a9ae['body'][_0x477e09(0x1e3)]],_0xe3f301=[_0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x2ae)]],_0x2324a4=[_0x15a9ae[_0x477e09(0x29b)]['stocks']],_0x399e60=[_0x15a9ae[_0x477e09(0x29b)]['return_qty']],_0xa81c46=[_0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x24e)]],_0x45e44b=[_0x15a9ae['body'][_0x477e09(0x2e0)]],_0x302d8d=[_0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x2be)]],_0x2f3cab=[_0x15a9ae['body'][_0x477e09(0x2b8)]],_0x59d644=[_0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x278)]],_0x2c1a3a=[_0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x20e)]],_0x3f754f=[_0x15a9ae[_0x477e09(0x29b)]['secondary_code_hide']];else var _0x4ad39d=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x1e3)]],_0xe3f301=[..._0x15a9ae['body'][_0x477e09(0x2ae)]],_0x2324a4=[..._0x15a9ae['body']['stocks']],_0x399e60=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x238)]],_0xa81c46=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x24e)]],_0x45e44b=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x2e0)]],_0x302d8d=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x2be)]],_0x2f3cab=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x2b8)]],_0x59d644=[..._0x15a9ae['body'][_0x477e09(0x278)]],_0x2c1a3a=[..._0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x20e)]],_0x3f754f=[..._0x15a9ae['body'][_0x477e09(0x290)]];const _0xfc7a69=_0x4ad39d[_0x477e09(0x27d)](_0x49a96a=>{return _0x49a96a={'product_name':_0x49a96a};});_0xe3f301[_0x477e09(0x1d9)]((_0x1b780a,_0x5662c1)=>{var _0x1ac50a=_0x477e09;_0xfc7a69[_0x5662c1][_0x1ac50a(0x2ae)]=_0x1b780a;}),_0x2324a4[_0x477e09(0x1d9)]((_0x507caf,_0x295408)=>{var _0x3e7389=_0x477e09;_0xfc7a69[_0x295408][_0x3e7389(0x209)]=_0x507caf;}),_0x399e60[_0x477e09(0x1d9)]((_0x12e231,_0x5a1558)=>{var _0x7e36e8=_0x477e09;_0xfc7a69[_0x5a1558][_0x7e36e8(0x238)]=_0x12e231;}),_0xa81c46['forEach']((_0x34fe20,_0x14d071)=>{var _0x2494ca=_0x477e09;_0xfc7a69[_0x14d071][_0x2494ca(0x1db)]=_0x34fe20;}),_0x45e44b['forEach']((_0x5c918f,_0x3d5113)=>{var _0x8384fd=_0x477e09;_0xfc7a69[_0x3d5113][_0x8384fd(0x269)]=_0x5c918f;}),_0x302d8d[_0x477e09(0x1d9)]((_0x17caa3,_0x430647)=>{var _0x315d4a=_0x477e09;_0xfc7a69[_0x430647][_0x315d4a(0x1df)]=_0x17caa3;}),_0x2f3cab[_0x477e09(0x1d9)]((_0x497ae3,_0x259cf9)=>{var _0x17ae06=_0x477e09;_0xfc7a69[_0x259cf9][_0x17ae06(0x282)]=_0x497ae3;}),_0x59d644['forEach']((_0x1a7e7e,_0x2dff07)=>{var _0x4c7163=_0x477e09;_0xfc7a69[_0x2dff07][_0x4c7163(0x1e6)]=_0x1a7e7e;}),_0x2c1a3a[_0x477e09(0x1d9)]((_0x202788,_0x28a565)=>{_0xfc7a69[_0x28a565]['primary_code']=_0x202788;}),_0x3f754f[_0x477e09(0x1d9)]((_0x48ebb5,_0x1dac84)=>{var _0x36c625=_0x477e09;_0xfc7a69[_0x1dac84][_0x36c625(0x226)]=_0x48ebb5;}),_0x40706b['product'][_0x477e09(0x1d9)](_0x553253=>{var _0x69f331=_0x477e09;const _0x363b28=_0x8cb5b3[_0x69f331(0x241)][_0x69f331(0x27d)](_0x52e8f9=>{var _0x40a627=_0x69f331;_0x52e8f9['product_name']==_0x553253['product_name']&&_0x52e8f9[_0x40a627(0x1df)]==_0x553253[_0x40a627(0x1df)]&&_0x52e8f9[_0x40a627(0x282)]==_0x553253[_0x40a627(0x282)]&&_0x52e8f9[_0x40a627(0x269)]==_0x553253['bin']&&_0x52e8f9[_0x40a627(0x1db)]==_0x553253[_0x40a627(0x1db)]&&_0x52e8f9['rack']==_0x553253['rack']&&_0x52e8f9[_0x40a627(0x1d7)]==_0x553253['storage']&&(console[_0x40a627(0x2aa)](parseInt(_0x52e8f9[_0x40a627(0x29c)])+_0x40a627(0x1eb)+parseInt(_0x553253[_0x40a627(0x215)])),_0x52e8f9['product_stock']=parseInt(_0x52e8f9[_0x40a627(0x29c)])+parseInt(_0x553253['quantity']));});}),await _0x8cb5b3[_0x477e09(0x25a)]();const _0x3f6796=_0xfc7a69[_0x477e09(0x211)](_0x372618=>_0x372618[_0x477e09(0x238)]!=='0'&&_0x372618[_0x477e09(0x238)]!=='');var _0x10c975=0x0;_0x3f6796[_0x477e09(0x1d9)](_0x2b7991=>{var _0x3a1e60=_0x477e09;console[_0x3a1e60(0x2aa)](_0x3a1e60(0x205),_0x2b7991),(parseInt(_0x2b7991['purchase_quantity'])<parseInt(_0x2b7991[_0x3a1e60(0x238)])||parseInt(_0x2b7991[_0x3a1e60(0x209)])<parseInt(_0x2b7991[_0x3a1e60(0x238)]))&&_0x10c975++;});if(_0x10c975!=0x0)return _0x15a9ae[_0x477e09(0x219)](_0x477e09(0x2de),_0x477e09(0x2d3)),_0x3b0624[_0x477e09(0x2c2)]('back');const _0x2bac58=new purchases_return({'invoice':_0x3098fa,'suppliers':_0x15a9ae[_0x477e09(0x29b)][_0x477e09(0x216)],'date':_0x3185e2,'warehouse_name':_0x329c4d,'return_product':_0x3f6796,'note':_0xd9028c,'room':_0x14907e,'to_warehouse_name':_0x48942,'to_room':_0x4658c4}),_0x12a380=await _0x2bac58[_0x477e09(0x25a)]();console[_0x477e09(0x2aa)](_0x2bac58);const _0x4ed12f=await purchases_return[_0x477e09(0x1ef)]({'invoice':_0x3098fa}),_0x5811c1=await warehouse[_0x477e09(0x1ef)]({'name':_0x48942,'room':_0x4658c4});_0x4ed12f[_0x477e09(0x26f)][_0x477e09(0x1d9)](_0x53458a=>{var _0x5a3fd4=_0x477e09,_0x1bc11f=0x0;const _0x2bb528=_0x5811c1['product_details'][_0x5a3fd4(0x27d)](_0x3ac072=>{var _0x4e22d4=_0x5a3fd4;_0x3ac072[_0x4e22d4(0x1e3)]==_0x53458a[_0x4e22d4(0x1e3)]&&_0x3ac072[_0x4e22d4(0x1df)]==_0x53458a[_0x4e22d4(0x1df)]&&_0x3ac072[_0x4e22d4(0x282)]==_0x53458a[_0x4e22d4(0x282)]&&_0x3ac072[_0x4e22d4(0x269)]==_0x53458a[_0x4e22d4(0x269)]&&_0x3ac072['bay']==_0x53458a[_0x4e22d4(0x1db)]&&(_0x3ac072[_0x4e22d4(0x29c)]=parseInt(_0x3ac072[_0x4e22d4(0x29c)])-parseInt(_0x53458a[_0x4e22d4(0x238)]),_0x1bc11f++);});_0x1bc11f=='0'&&(_0x5811c1['product_details']=_0x5811c1[_0x5a3fd4(0x241)][_0x5a3fd4(0x1d3)]({'product_name':_0x53458a[_0x5a3fd4(0x1e3)],'product_stock':_0x53458a[_0x5a3fd4(0x238)],'primary_code':_0x53458a[_0x5a3fd4(0x1ff)],'secondary_code':_0x53458a[_0x5a3fd4(0x226)],'product_code':_0x53458a['product_code'],'storage':_0x53458a[_0x5a3fd4(0x1d7)],'rack':_0x53458a['rack'],'bay':_0x53458a[_0x5a3fd4(0x1db)],'bin':_0x53458a[_0x5a3fd4(0x269)],'type':_0x53458a[_0x5a3fd4(0x282)],'floorlevel':_0x53458a[_0x5a3fd4(0x1df)],'maxProducts':_0x53458a[_0x5a3fd4(0x214)],'unit':_0x53458a[_0x5a3fd4(0x259)],'secondary_unit':_0x53458a['secondary_unit'],'expiry_date':_0x53458a['expiry_date']}));}),await _0x5811c1[_0x477e09(0x25a)]();const _0x4f974b=await purchases[_0x477e09(0x1ef)]({'invoice':_0x3098fa});_0x4f974b[_0x477e09(0x2a5)]=_0x477e09(0x2d4);const _0x51f173=await _0x4f974b[_0x477e09(0x25a)](),_0x52eb34=new s_payment_data({'invoice':_0x3098fa,'suppliers':_0x15a9ae['body'][_0x477e09(0x216)],'reason':'Purchase\x20Return'});await _0x52eb34['save']();const _0x4b1fd6=await master_shop[_0x477e09(0x23a)]();console[_0x477e09(0x2aa)](_0x477e09(0x2f7),_0x4b1fd6[0x0][_0x477e09(0x28e)]);const _0x3f60f8=await email_settings[_0x477e09(0x1ef)](),_0x47d869=await suppliers[_0x477e09(0x1ef)]({'name':_0x15a9ae[_0x477e09(0x29b)]['suppliers']});console[_0x477e09(0x2aa)](_0x477e09(0x2d1),_0x47d869);_0x4b1fd6[0x0][_0x477e09(0x20b)]==0x1?(right_currency=_0x4b1fd6[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x4b1fd6[0x0][_0x477e09(0x1d5)]);var _0x930360=_0x4ad39d,_0x5c2c40=_0x399e60,_0xd4c1b1='',_0x4b50e0;for(_0x4b50e0 in _0x930360){_0xd4c1b1+=_0x477e09(0x1fa)+_0x477e09(0x1f6)+_0x930360[_0x4b50e0]+_0x477e09(0x1e5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c2c40[_0x4b50e0]+_0x477e09(0x1e5)+_0x477e09(0x256);}console[_0x477e09(0x2aa)](_0x477e09(0x217),_0xd4c1b1);let _0x48b1f3=nodemailer[_0x477e09(0x275)]({'service':_0x477e09(0x2d6),'auth':{'user':_0x3f60f8[_0x477e09(0x2b3)],'pass':_0x3f60f8[_0x477e09(0x271)]}}),_0xb78a2b={'from':_0x3f60f8[_0x477e09(0x2b3)],'to':_0x47d869[_0x477e09(0x2b3)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x477e09(0x2f0),'path':__dirname+_0x477e09(0x247)+'/upload/'+_0x4b1fd6[0x0][_0x477e09(0x28e)],'cid':_0x477e09(0x268)}],'html':_0x477e09(0x20c)+'<html><head><title></title>'+_0x477e09(0x279)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x477e09(0x21b)+_0x477e09(0x222)+'</div>'+_0x477e09(0x21b)+_0x477e09(0x2f1)+_0x4b1fd6[0x0][_0x477e09(0x264)]+_0x477e09(0x2f4)+'</div>'+_0x477e09(0x200)+_0x477e09(0x1ee)+_0x477e09(0x21b)+_0x477e09(0x1f7)+_0x477e09(0x1de)+_0x3098fa+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x477e09(0x1d1)+_0x3185e2+'\x20'+_0x477e09(0x26c)+_0x477e09(0x26a)+_0x477e09(0x200)+_0x477e09(0x298)+_0x477e09(0x2c6)+_0x477e09(0x1fa)+_0x477e09(0x2c5)+_0x477e09(0x255)+_0x477e09(0x243)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x477e09(0x210)+_0x477e09(0x1dc)+'\x20'+_0xd4c1b1+'\x20'+'</tbody>'+_0x477e09(0x281)+_0x477e09(0x21b)+_0x477e09(0x272)+'<h5>'+_0x4b1fd6[0x0][_0x477e09(0x264)]+_0x477e09(0x26a)+_0x477e09(0x200)+_0x477e09(0x200)+_0x477e09(0x258)};_0x48b1f3[_0x477e09(0x2b0)](_0xb78a2b,function(_0x58b3db,_0xb951b1){var _0x550c5e=_0x477e09;_0x58b3db?(console['log'](_0x58b3db),console[_0x550c5e(0x2aa)](_0x550c5e(0x20d))):console[_0x550c5e(0x2aa)]('Email\x20sent\x20successfully');}),_0x15a9ae[_0x477e09(0x219)](_0x477e09(0x231),_0x477e09(0x1e8)),_0x3b0624[_0x477e09(0x2c2)]('/all_purchases/view');}catch(_0x58ec8f){console[_0x477e09(0x2aa)](_0x58ec8f),_0x3b0624[_0x477e09(0x2a8)](0xc8)[_0x477e09(0x2eb)]({'message':_0x58ec8f[_0x477e09(0x2db)]});}}),router[a0_0xecd78d(0x260)]('/barcode/:id',auth,async(_0x14bee1,_0xfa031a)=>{var _0x31df79=a0_0xecd78d;try{const {username:_0x47aebd,email:_0x19d4b6,role:_0x357a0e}=_0x14bee1['user'],_0x549e38=_0x14bee1['user'],_0x494bc7=await profile[_0x31df79(0x1ef)]({'email':_0x549e38['email']}),_0x4b14b3=await master_shop['find'](),_0x1f8336=_0x14bee1[_0x31df79(0x234)]['id'],_0x5b853c=await purchases[_0x31df79(0x208)](_0x1f8336);if(_0x4b14b3[0x0][_0x31df79(0x22f)]=='English\x20(US)')var _0x4b9a3c=users['English'];else{if(_0x4b14b3[0x0][_0x31df79(0x22f)]==_0x31df79(0x2e8))var _0x4b9a3c=users[_0x31df79(0x2e8)];else{if(_0x4b14b3[0x0][_0x31df79(0x22f)]==_0x31df79(0x28c))var _0x4b9a3c=users[_0x31df79(0x28c)];else{if(_0x4b14b3[0x0][_0x31df79(0x22f)]==_0x31df79(0x25f))var _0x4b9a3c=users[_0x31df79(0x25f)];else{if(_0x4b14b3[0x0]['language']=='French')var _0x4b9a3c=users[_0x31df79(0x1e7)];else{if(_0x4b14b3[0x0]['language']=='Portuguese\x20(BR)')var _0x4b9a3c=users['Portuguese'];else{if(_0x4b14b3[0x0][_0x31df79(0x22f)]==_0x31df79(0x2a7))var _0x4b9a3c=users[_0x31df79(0x2a7)];else{if(_0x4b14b3[0x0]['language']=='Arabic\x20(ae)')var _0x4b9a3c=users[_0x31df79(0x2ea)];}}}}}}}_0xfa031a['render'](_0x31df79(0x23f),{'success':_0x14bee1[_0x31df79(0x219)](_0x31df79(0x231)),'errors':_0x14bee1['flash']('errors'),'role':_0x549e38,'profile':_0x494bc7,'alldata':_0x5b853c,'master_shop':_0x4b14b3,'language':_0x4b9a3c}),console[_0x31df79(0x2aa)](alldata);}catch(_0x12e512){console[_0x31df79(0x2aa)](_0x12e512);}}),router[a0_0xecd78d(0x265)](a0_0xecd78d(0x1d4),async(_0x420c0d,_0x4c574c)=>{var _0x5d9c6e=a0_0xecd78d;const {product_code:_0x126b71}=_0x420c0d['body'];var _0x588a1d;const _0x34c526=await product[_0x5d9c6e(0x292)]([{'$match':{'primary_code':_0x126b71,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x5d9c6e(0x232),'name':{'$first':_0x5d9c6e(0x213)},'category':{'$first':_0x5d9c6e(0x2ca)},'brand':{'$first':_0x5d9c6e(0x2bf)},'unit':{'$first':_0x5d9c6e(0x2f3)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5d9c6e(0x2d9)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x5d9c6e(0x212)},'maxStocks':{'$first':_0x5d9c6e(0x244)},'maxProdPerUnit':{'$first':_0x5d9c6e(0x29a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x29650e=await product['aggregate']([{'$match':{'secondary_code':_0x126b71,'product_category':_0x5d9c6e(0x29d)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x5d9c6e(0x2ca)},'brand':{'$first':_0x5d9c6e(0x2bf)},'unit':{'$first':_0x5d9c6e(0x2f3)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5d9c6e(0x2c8)},'secondary_code':{'$first':_0x5d9c6e(0x212)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5d9c6e(0x29a)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5d9c6e(0x2e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x34c526[_0x5d9c6e(0x27c)]>0x0)_0x588a1d=_0x34c526;else _0x29650e[_0x5d9c6e(0x27c)]>0x0&&(_0x588a1d=_0x29650e);_0x4c574c[_0x5d9c6e(0x2eb)](_0x588a1d);}),router[a0_0xecd78d(0x265)](a0_0xecd78d(0x2b9),async(_0x488896,_0x3273c7)=>{var _0x9d522a=a0_0xecd78d;const {primaryCode:_0x5dda30,secondaryCode:_0x455214,productCode:_0x8f4f6,bay:_0x24157b,bin:_0x56784f,types:_0x181bf3,pallet:_0x3a216a,warehouses:_0x3dd03e,room:_0x2e9d3a}=_0x488896['body'];console[_0x9d522a(0x2aa)](_0x488896[_0x9d522a(0x29b)]);try{const _0xdaea3a=await warehouse['aggregate']([{'$match':{'name':_0x3dd03e,'room':_0x2e9d3a}},{'$unwind':_0x9d522a(0x229)},{'$match':{'product_details.bay':_0x24157b,'product_details.bin':_0x56784f,'product_details.type':_0x181bf3}},{'$group':{'_id':_0x9d522a(0x246),'name':{'$first':_0x9d522a(0x227)},'product_stock':{'$first':_0x9d522a(0x24d)},'level':{'$first':_0x9d522a(0x293)},'isle':{'$first':_0x9d522a(0x2b7)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x3273c7['status'](0xc8)[_0x9d522a(0x2eb)](_0xdaea3a);}catch(_0x8b6278){_0x3273c7['status'](0x194)[_0x9d522a(0x2eb)]({'message':_0x8b6278[_0x9d522a(0x2db)]});}}),module[a0_0xecd78d(0x288)]=router;