var a0_0x1c2e10=a0_0x46ca;(function(_0x1efdeb,_0x341632){var _0x4ccf64=a0_0x46ca,_0xda79a2=_0x1efdeb();while(!![]){try{var _0x4ee8a=parseInt(_0x4ccf64(0x29c))/0x1+parseInt(_0x4ccf64(0x247))/0x2*(-parseInt(_0x4ccf64(0x1c3))/0x3)+-parseInt(_0x4ccf64(0x1a5))/0x4+-parseInt(_0x4ccf64(0x1bc))/0x5+parseInt(_0x4ccf64(0x28a))/0x6*(-parseInt(_0x4ccf64(0x244))/0x7)+-parseInt(_0x4ccf64(0x1db))/0x8+-parseInt(_0x4ccf64(0x23a))/0x9*(-parseInt(_0x4ccf64(0x2a0))/0xa);if(_0x4ee8a===_0x341632)break;else _0xda79a2['push'](_0xda79a2['shift']());}catch(_0x4a2080){_0xda79a2['push'](_0xda79a2['shift']());}}}(a0_0x984e,0x22e85));const express=require('express'),app=express(),router=express[a0_0x1c2e10(0x256)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1c2e10(0x245)),auth=require(a0_0x1c2e10(0x288)),nodemailer=require(a0_0x1c2e10(0x1f1));var ejs=require(a0_0x1c2e10(0x196));const path=require(a0_0x1c2e10(0x204)),users=require('../public/language/languages.json');function a0_0x984e(){var _0xb39c8e=['$product_details.product_code','prod_secondunit','success','type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</h5>','/view/:id','staff','port','currency_placement','Portuguese\x20(BR)','return_data','Chinese','prod_unit','/../public','190895RXZSjP','Rack\x20E','image','German','</div>','padStart','suppliers_data','3405AWwzuc','room','/barcode/:id','expiry_date','add_purchases','$product_details._id','</body></html>','/all_purchases/view','$suppliers_docs','$expiry_date','$maxStocks','aggregate','Spanish','date','getMonth','$product_details.type','suppliers','\x20</h2>','$product_details.product_stock','$product_details.bin','<!DOCTYPE\x20html>','delivery_code','status','prod_level','1896680WKcTMn','$alertquantity','Email\x20sent\x20successfully','$product.quantity','Rack\x20F','bin','RMSEmail','</tr>','$product_details.pallet','<strong>\x20Regards\x20</strong>','body','user','filter','sendMail','alertQTY','quantity','table\x20page','get','warehouse_name','max_product_unit','log','$secondary_unit','nodemailer','gmail','primary_code','secondary_code','getFullYear','Raw\x20Materials','Rack\x20A','$note','purchases\x20item\x20return\x20successfull','Return\x20Goods','/view/return_purchase/:id','primary_code_hide','pallet','rack','\x20<\x20wew\x20>\x20','all_purchases_barcode','$secondary_code','Hindi','$product.bay','path','</tbody>','<html><head><title></title>','English','language','product_name','Purchase\x20Return','name','$primary_code','batch_code','catch','Portuguese','foreach\x20newproduct','deliverycode','floor','$maxProdPerUnit','RoomAssign','Ambient','product_list','Purchase\x20data\x20added\x20successfully','Level','$warehouse_name','$invoice','invoice','warehouse','product_code_hide','master','<table\x20style=\x22width:\x20100%\x20!important;\x22>','DRY\x20STORAGE','$product_details.rack','Purchase\x20Mail','<h2>\x20','\x20Order\x20Date\x20:\x20','$date','types','$product_details','json','render','abs','add_purchases\x20error','prod_invoice','findOne','prod_qty','host','return_qty','delivery_date','An\x20error\x20occurred.','Logo.png','product_code','$name','push','<tr>','suppliers_docs','prod_primunit','631089RVwddg','<h5>','maxStocks','</span>','/all_purchases/view/','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.product_name','$product_details.storage','<span\x20style=\x22float:\x20right;\x22>','$room','1190441glifNh','../models/all_models','bay','448pQPoUq','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product_details','actual_qty','Rack\x20B','/upload/','prod_code','$_id','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','\x20<>\x20','<h5\x20style=\x22text-align:\x20left;\x22>','$batch_code','$paid_amount','$product.room_name','Router','$product_details.isle','message','site_title','product_stock','$unit','COLD\x20STORAGE','$category','standard_unit','actual_uom','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Arabic\x20(ae)','post','$product_details.maxProducts','$due_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','getDate','\x20Order\x20Number\x20:\x20','secondary_unit','purchase_quantity','MaxStocks_data','createTransport','return_product','Rack\x20D','stock_data','Sales\x20Update\x20successfully','English\x20(US)','random','<hr\x20class=\x22my-3\x22>','/view/add_purchases','prod_isle','product','/CheckingWarehouse','all_purchases','errors','prod_cat','email','</thead>','role','password','redirect','logo','level','edit_purchases','map','Error\x20Occurs','production_date','maxperunit','$finalize','../middleware/auth','find','6fFWZDY','Paid\x20For\x20Purchase','flash','$suppliers','stocks','Receiving\x20Area','prod_Qty','payment\x20successfull','floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_pallet','INC-','due_amount','purchase_invoice','$product_details.bay','$product_code','257606JGBLXi','toString','secondary_code_hide','</td>','90eIwRWa','<tbody\x20style=\x22text-align:\x20center;\x22>','/view/add_purchases/:id','currency','stock_quantity','/preview/:id','<div>','note','$product.floorlevel','POnumber','True','forEach','Enabled','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Floor','storage','prod_name','French','ejs','isle','length','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Enclosed','$product','</table>','string','error','save','$brand','paid_amount','184588eYQCGy','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.secondary_code','params','concat','back','</head><body>','product_cat'];a0_0x984e=function(){return _0xb39c8e;};return a0_0x984e();}router[a0_0x1c2e10(0x1ec)]('/view',auth,async(_0x1e2689,_0xc6bf59)=>{var _0x368180=a0_0x1c2e10;try{const {username:_0x22f28f,email:_0x1a7d13,role:_0x3a6394}=_0x1e2689[_0x368180(0x1e6)],_0x2fa02b=_0x1e2689[_0x368180(0x1e6)],_0x456391=await profile['findOne']({'email':_0x2fa02b[_0x368180(0x27b)]}),_0x2749b0=await staff[_0x368180(0x22d)]({'email':_0x2fa02b[_0x368180(0x27b)]});if(_0x2fa02b[_0x368180(0x27d)]==_0x368180(0x1b4)){const _0x239bc3=await staff[_0x368180(0x22d)]({'email':_0x2fa02b[_0x368180(0x27b)]});}const _0x22aa33=await master_shop[_0x368180(0x289)]();let _0x5f5ae0;if(_0x2fa02b[_0x368180(0x27d)]==_0x368180(0x1b4)){const _0x76b956=await staff['findOne']({'email':_0x2fa02b[_0x368180(0x27b)]});_0x5f5ae0=await purchases['aggregate']([{'$match':{'warehouse_name':_0x76b956[_0x368180(0x21c)]}},{'$lookup':{'from':_0x368180(0x1d3),'localField':_0x368180(0x1d3),'foreignField':_0x368180(0x20b),'as':_0x368180(0x238)}},{'$unwind':_0x368180(0x1cb)},{'$unwind':_0x368180(0x19e)},{'$group':{'_id':_0x368180(0x24e),'invoice':{'$first':_0x368180(0x21a)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x368180(0x219)},'room':{'$first':_0x368180(0x243)},'product':{'$push':_0x368180(0x19e)},'note':{'$first':_0x368180(0x1f8)},'paid_amount':{'$first':_0x368180(0x254)},'due_amount':{'$first':_0x368180(0x265)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x368180(0x253)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x368180(0x203)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x368180(0x2a8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5f5ae0=await purchases[_0x368180(0x1ce)]([{'$lookup':{'from':_0x368180(0x1d3),'localField':_0x368180(0x1d3),'foreignField':_0x368180(0x20b),'as':_0x368180(0x238)}},{'$unwind':_0x368180(0x1cb)},{'$unwind':_0x368180(0x19e)},{'$group':{'_id':_0x368180(0x24e),'invoice':{'$first':_0x368180(0x21a)},'suppliers':{'$first':_0x368180(0x28d)},'date':{'$first':_0x368180(0x225)},'warehouse_name':{'$first':_0x368180(0x219)},'room':{'$addToSet':_0x368180(0x255)},'product':{'$push':'$product'},'note':{'$first':_0x368180(0x1f8)},'paid_amount':{'$first':_0x368180(0x254)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x368180(0x253)},'expiry_date':{'$first':_0x368180(0x1cc)},'suppliers_docs':{'$first':_0x368180(0x1cb)},'total_product_quantity':{'$sum':_0x368180(0x1de)},'level':{'$addToSet':_0x368180(0x203)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x368180(0x2a8)},'finalize':{'$first':_0x368180(0x287)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x22aa33[0x0][_0x368180(0x208)]==_0x368180(0x271)){var _0x4aa5fe=users[_0x368180(0x207)];console[_0x368180(0x1ef)](_0x4aa5fe);}else{if(_0x22aa33[0x0]['language']==_0x368180(0x202))var _0x4aa5fe=users[_0x368180(0x202)];else{if(_0x22aa33[0x0][_0x368180(0x208)]==_0x368180(0x1bf))var _0x4aa5fe=users[_0x368180(0x1bf)];else{if(_0x22aa33[0x0][_0x368180(0x208)]==_0x368180(0x1cf))var _0x4aa5fe=users[_0x368180(0x1cf)];else{if(_0x22aa33[0x0]['language']=='French')var _0x4aa5fe=users[_0x368180(0x195)];else{if(_0x22aa33[0x0][_0x368180(0x208)]==_0x368180(0x1b7))var _0x4aa5fe=users['Portuguese'];else{if(_0x22aa33[0x0][_0x368180(0x208)]==_0x368180(0x1b9))var _0x4aa5fe=users[_0x368180(0x1b9)];else{if(_0x22aa33[0x0]['language']==_0x368180(0x262))var _0x4aa5fe=users[_0x368180(0x24f)];}}}}}}}_0xc6bf59[_0x368180(0x229)](_0x368180(0x278),{'success':_0x1e2689[_0x368180(0x28c)](_0x368180(0x1af)),'errors':_0x1e2689[_0x368180(0x28c)]('errors'),'purchases':_0x5f5ae0,'role':_0x2fa02b,'profile':_0x456391,'master_shop':_0x22aa33,'language':_0x4aa5fe});}catch(_0x2014a5){console[_0x368180(0x1ef)](_0x368180(0x1eb),_0x2014a5),_0xc6bf59['status'](0xc8)['json']({'message':_0x2014a5[_0x368180(0x258)]});}});function a0_0x46ca(_0x555ee8,_0x2fe07b){var _0x984e18=a0_0x984e();return a0_0x46ca=function(_0x46caa7,_0x122969){_0x46caa7=_0x46caa7-0x191;var _0x529c5f=_0x984e18[_0x46caa7];return _0x529c5f;},a0_0x46ca(_0x555ee8,_0x2fe07b);}function BayBinSelected(_0x43729d,_0x5f0662){var _0x3885c7=a0_0x1c2e10,_0xa99af4=[],_0x7eec60=[],_0xd889fa=[],_0x25c87d=[],_0x452958=[],_0x10e0ec=[];let _0x1bd460=[];if(_0x43729d==_0x3885c7(0x220))switch(_0x5f0662){case _0x3885c7(0x1f7):_0xa99af4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x7eec60=[0x1,0x2],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=[_0x3885c7(0x218),_0x3885c7(0x192)],_0x452958=['D'],_0x10e0ec=['A'];break;case _0x3885c7(0x24b):_0xa99af4=[0x6,0x5,0x4,0x3,0x2,0x1],_0x7eec60=[0x1,0x2],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=[_0x3885c7(0x218),_0x3885c7(0x192)],_0x452958=['D'],_0x10e0ec=['B'];break;case'Shelves':_0xa99af4=[0x0],_0x7eec60=[0x0],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=[_0x3885c7(0x192)],_0x452958=['D'],_0x10e0ec=['S'];break;case'Receiving\x20Area':_0xa99af4=[0x0],_0x7eec60=[0x0],_0x25c87d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xd889fa=[_0x3885c7(0x192)],_0x452958=['D'],_0x10e0ec=['R'];break;}else{if(_0x43729d==_0x3885c7(0x25c))switch(_0x5f0662){case _0x3885c7(0x1f7):_0xa99af4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x7eec60=['B','F'],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=['Level',_0x3885c7(0x192)],_0x452958=['C'],_0x10e0ec=['A'];break;case'Rack\x20B':_0xa99af4=[0x5,0x4,0x3,0x2,0x1],_0x7eec60=['F','B','S'],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=[_0x3885c7(0x218),'Floor'],_0x452958=['C'],_0x10e0ec=['B'];break;case'Rack\x20C':_0xa99af4=[0x1,0x2,0x3,0x4,0x5],_0x7eec60=['B','F','S'],_0x25c87d=[0x5,0x4,0x3,0x2,0x1],_0xd889fa=[_0x3885c7(0x218),_0x3885c7(0x192)],_0x452958=['C'],_0x10e0ec=['C'];break;case _0x3885c7(0x26e):_0xa99af4=[0x5,0x4,0x3,0x2,0x1],_0x7eec60=['F','B','S'],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=[_0x3885c7(0x218),_0x3885c7(0x192)],_0x452958=['C'],_0x10e0ec=['D'];break;case _0x3885c7(0x1bd):_0xa99af4=[0x4,0x3,0x2,0x1],_0x7eec60=[0x1,0x2],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=['Level',_0x3885c7(0x192)],_0x452958=['C'],_0x10e0ec=['E'];break;case _0x3885c7(0x1df):_0xa99af4=[0x1,0x2,0x3],_0x7eec60=[0x1,0x2],_0x25c87d=[0x1,0x2,0x3,0x4,0x5],_0xd889fa=[_0x3885c7(0x218)],_0x452958=['C'],_0x10e0ec=['F'];break;}}return{'levels':_0xa99af4,'Isle':_0x7eec60,'rack':_0x25c87d,'type':_0xd889fa,'storage':_0x452958,'rak':_0x10e0ec};}async function getRandom8DigitNumber(){var _0x15ab1c=a0_0x1c2e10;const _0x5a688a=0x989680,_0x1a5d12=0x5f5e0ff,_0x2d8134=Math[_0x15ab1c(0x212)](Math[_0x15ab1c(0x272)]()*(_0x1a5d12-_0x5a688a+0x1))+_0x5a688a;var _0x387ce9;const _0x5d3bd4=await purchases[_0x15ab1c(0x22d)]({'invoice':_0x15ab1c(0x297)+_0x2d8134});return _0x5d3bd4&&_0x5d3bd4['length']>0x0?_0x387ce9=_0x15ab1c(0x297)+_0x2d8134:_0x387ce9='INC-'+_0x2d8134,_0x387ce9;}router['get'](a0_0x1c2e10(0x274),auth,async(_0x2e148c,_0x306946)=>{var _0x40f0d6=a0_0x1c2e10;try{const {username:_0x1813b4,email:_0x59c378,role:_0x4fc95d}=_0x2e148c[_0x40f0d6(0x1e6)],_0x4015f5=_0x2e148c[_0x40f0d6(0x1e6)],_0x499d9d=await profile[_0x40f0d6(0x22d)]({'email':_0x4015f5[_0x40f0d6(0x27b)]}),_0x508cd9=await master_shop[_0x40f0d6(0x289)](),_0x1ea338=await staff[_0x40f0d6(0x22d)]({'email':_0x4015f5['email']}),_0x63ed58=await suppliers['find']({});let _0x4a6bfc;if(_0x4015f5[_0x40f0d6(0x27d)]==_0x40f0d6(0x1b4)){const _0x3d69b9=await staff[_0x40f0d6(0x22d)]({'email':_0x4015f5[_0x40f0d6(0x27b)]});_0x4a6bfc=await warehouse[_0x40f0d6(0x1ce)]([{'$match':{'status':_0x40f0d6(0x2ac),'name':_0x3d69b9[_0x40f0d6(0x21c)],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x40f0d6(0x235),'name':{'$first':_0x40f0d6(0x235)}}}]);}else _0x4a6bfc=await warehouse['aggregate']([{'$match':{'status':_0x40f0d6(0x2ac),'warehouse_category':_0x40f0d6(0x1f6),'name':{'$ne':_0x40f0d6(0x1fa)}}},{'$group':{'_id':'$name','name':{'$first':_0x40f0d6(0x235)}}}]);const _0x2bfd41=await product['find']({}),_0xf958f9=await warehouse[_0x40f0d6(0x289)]({'status':_0x40f0d6(0x2ac)}),_0x5e215c=await purchases[_0x40f0d6(0x289)]({}),_0x32cf5d=_0x5e215c['length']+0x1,_0x461608=_0x40f0d6(0x297)+_0x32cf5d[_0x40f0d6(0x29d)]()[_0x40f0d6(0x1c1)](0x5,'0');var _0x408704=[_0x40f0d6(0x215),_0x40f0d6(0x19d)];if(_0x508cd9[0x0]['language']=='English\x20(US)')var _0x440fbb=users[_0x40f0d6(0x207)];else{if(_0x508cd9[0x0]['language']==_0x40f0d6(0x202))var _0x440fbb=users[_0x40f0d6(0x202)];else{if(_0x508cd9[0x0][_0x40f0d6(0x208)]==_0x40f0d6(0x1bf))var _0x440fbb=users[_0x40f0d6(0x1bf)];else{if(_0x508cd9[0x0][_0x40f0d6(0x208)]==_0x40f0d6(0x1cf))var _0x440fbb=users[_0x40f0d6(0x1cf)];else{if(_0x508cd9[0x0][_0x40f0d6(0x208)]==_0x40f0d6(0x195))var _0x440fbb=users[_0x40f0d6(0x195)];else{if(_0x508cd9[0x0][_0x40f0d6(0x208)]==_0x40f0d6(0x1b7))var _0x440fbb=users[_0x40f0d6(0x20f)];else{if(_0x508cd9[0x0][_0x40f0d6(0x208)]=='Chinese')var _0x440fbb=users[_0x40f0d6(0x1b9)];else{if(_0x508cd9[0x0][_0x40f0d6(0x208)]=='Arabic\x20(ae)')var _0x440fbb=users[_0x40f0d6(0x24f)];}}}}}}}const _0x1c832d=getRandom8DigitNumber();_0x1c832d['then'](_0x3e712d=>{var _0xa583b6=_0x40f0d6;_0x306946[_0xa583b6(0x229)](_0xa583b6(0x1c7),{'success':_0x2e148c[_0xa583b6(0x28c)](_0xa583b6(0x1af)),'errors':_0x2e148c['flash'](_0xa583b6(0x279)),'role':_0x4015f5,'profile':_0x499d9d,'suppliers':_0x63ed58,'warehouse':_0x4a6bfc,'product':_0x2bfd41,'invoice':_0x3e712d,'master_shop':_0x508cd9,'language':_0x440fbb,'find_data':_0xf958f9,'rooms_data':_0x408704});})[_0x40f0d6(0x20e)](_0x9eb413=>{var _0x3cf2ef=_0x40f0d6;_0x2e148c[_0x3cf2ef(0x28c)](_0x3cf2ef(0x279),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x306946['redirect'](_0x3cf2ef(0x1ca));});}catch(_0x56eb30){console[_0x40f0d6(0x1ef)](_0x56eb30);}}),router[a0_0x1c2e10(0x1ec)](a0_0x1c2e10(0x2a2),auth,async(_0x22344b,_0x500db0)=>{var _0x52a152=a0_0x1c2e10;try{const _0x5edb3d=_0x22344b[_0x52a152(0x1a8)]['id'];console[_0x52a152(0x1ef)](_0x5edb3d);const _0x3918d5=await master_shop[_0x52a152(0x289)]();console[_0x52a152(0x1ef)](_0x52a152(0x21e),_0x3918d5);const _0x4c5f9e=await product[_0x52a152(0x22d)]({'name':_0x5edb3d});console[_0x52a152(0x1ef)](_0x52a152(0x276),_0x4c5f9e),_0x500db0['status'](0xc8)[_0x52a152(0x228)]({'product_data':_0x4c5f9e,'master':_0x3918d5});}catch(_0x5dcbbf){console[_0x52a152(0x1ef)](_0x52a152(0x22b),_0x5dcbbf);}}),router[a0_0x1c2e10(0x263)](a0_0x1c2e10(0x274),auth,async(_0x5ba5a9,_0x5bcbaf)=>{var _0x34b852=a0_0x1c2e10;try{const {invoice:_0x500703,date:_0x4a3c0e,warehouse_name:_0x31180e,prod_name:_0x4f004d,prod_code:_0x1242c9,prod_qty:_0x20bf51,prod_unit:_0x47c92e,prod_secondunit:_0x27d7f0,prod_level:_0x609cc8,prod_isle:_0x1e6e44,prod_pallet:_0x3dfabe,note:_0x2c5e8e,expiry_date:_0x15ef24,batch_code:_0x4d7fde,payable:_0xea6b48,due_amount:_0x1c9b88,Room_name:_0xcea501,primary_code:_0x4a381c,secondary_code:_0x38ef53,MaxStocks_data:_0x4bc9c0,PO_number:_0x18edea,SCRN:_0x1105ff,JO_number:_0x38c00c}=_0x5ba5a9[_0x34b852(0x1e5)];if(typeof _0x4f004d==_0x34b852(0x1a0))var _0x107fa6=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x194)]],_0x165a2f=[_0x5ba5a9['body'][_0x34b852(0x24d)]],_0x4a9e9f=[_0x5ba5a9[_0x34b852(0x1e5)]['prod_Qty']],_0x40d17e=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x239)]],_0x49f0dc=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1ae)]],_0x5e3a1c=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1da)]],_0x583135=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1f3)]],_0x17c299=[_0x5ba5a9['body']['secondary_code']],_0x334fa7=[_0x5ba5a9['body'][_0x34b852(0x26b)]],_0x19c7e2=[_0x5ba5a9['body'][_0x34b852(0x20d)]],_0x404883=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1c6)]],_0x3ab49d=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1ee)]],_0x141243=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1e9)]],_0x5ac545=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x285)]],_0x274c5f=[_0x5ba5a9['body'][_0x34b852(0x27a)]],_0x276016=[_0x5ba5a9['body'][_0x34b852(0x214)]],_0xf42c99=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x211)]],_0x13de08=[_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x22c)]],_0x25e2f6=[_0x5ba5a9[_0x34b852(0x1e5)]['actual_qty']],_0x41672e=[_0x5ba5a9['body'][_0x34b852(0x25f)]];else var _0x107fa6=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x194)]],_0x165a2f=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x24d)]],_0x4a9e9f=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x290)]],_0x40d17e=[..._0x5ba5a9['body'][_0x34b852(0x239)]],_0x49f0dc=[..._0x5ba5a9[_0x34b852(0x1e5)]['prod_secondunit']],_0x5e3a1c=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1da)]],_0x583135=[..._0x5ba5a9[_0x34b852(0x1e5)]['primary_code']],_0x17c299=[..._0x5ba5a9[_0x34b852(0x1e5)]['secondary_code']],_0x334fa7=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x26b)]],_0x19c7e2=[..._0x5ba5a9[_0x34b852(0x1e5)]['batch_code']],_0x404883=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1c6)]],_0x3ab49d=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1ee)]],_0x141243=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1e9)]],_0x5ac545=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x285)]],_0x274c5f=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x27a)]],_0x276016=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x214)]],_0xf42c99=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x211)]],_0x13de08=[..._0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x22c)]],_0x25e2f6=[..._0x5ba5a9['body'][_0x34b852(0x24a)]],_0x41672e=[..._0x5ba5a9[_0x34b852(0x1e5)]['actual_uom']];const _0x19c548=_0x107fa6['map'](_0x6a4a62=>{return _0x6a4a62={'product_name':_0x6a4a62};});_0x25e2f6[_0x34b852(0x2ab)]((_0x24ea94,_0x5bb47e)=>{var _0x510697=_0x34b852;_0x19c548[_0x5bb47e][_0x510697(0x24a)]=Math['abs'](_0x24ea94);}),_0x41672e[_0x34b852(0x2ab)]((_0x231c48,_0x372bd4)=>{var _0xc7b7ee=_0x34b852;_0x19c548[_0x372bd4][_0xc7b7ee(0x25f)]=_0x231c48;}),_0x165a2f[_0x34b852(0x2ab)]((_0x28f2b0,_0x1bb3e8)=>{var _0x2cf0cb=_0x34b852;_0x19c548[_0x1bb3e8][_0x2cf0cb(0x234)]=_0x28f2b0;}),_0x4a9e9f[_0x34b852(0x2ab)]((_0x5abb9e,_0x1270bb)=>{var _0x126941=_0x34b852;_0x19c548[_0x1270bb][_0x126941(0x1ea)]=Math[_0x126941(0x22a)](_0x5abb9e);}),_0x40d17e[_0x34b852(0x2ab)]((_0x14b0f5,_0x37d39a)=>{var _0x4b4951=_0x34b852;_0x19c548[_0x37d39a][_0x4b4951(0x25e)]=_0x14b0f5;}),_0x49f0dc['forEach']((_0x2c338d,_0x8d1604)=>{var _0x424ea6=_0x34b852;_0x19c548[_0x8d1604][_0x424ea6(0x269)]=_0x2c338d;}),_0x5e3a1c[_0x34b852(0x2ab)]((_0x37d366,_0x443d1e)=>{_0x276016['forEach']((_0x38e080,_0xf63804)=>{var _0xe03759=a0_0x46ca;if(_0x38e080==_0xe03759(0x28f)&&_0x443d1e==_0xf63804){console[_0xe03759(0x1ef)](_0x38e080+_0xe03759(0x1ff)+_0x443d1e+_0xe03759(0x251)+_0xf63804+'\x20<>\x20'+_0x37d366);var _0x303f4e=_0x37d366['slice'](0x3);_0x19c548[_0x443d1e][_0xe03759(0x193)]=_0x37d366[0x0],_0x19c548[_0x443d1e][_0xe03759(0x1fe)]=_0x37d366[0x1],_0x19c548[_0x443d1e]['bay']=0x0,_0x19c548[_0x443d1e][_0xe03759(0x1e0)]=0x0,_0x19c548[_0x443d1e][_0xe03759(0x1b0)]=_0xe03759(0x192),_0x19c548[_0x443d1e][_0xe03759(0x292)]=_0x303f4e;}else{if(_0x38e080=='Shelves'&&_0x443d1e==_0xf63804){var _0x303f4e=_0x37d366['slice'](0x3);_0x19c548[_0x443d1e][_0xe03759(0x193)]=_0x37d366[0x0],_0x19c548[_0x443d1e][_0xe03759(0x1fe)]=_0x37d366[0x1],_0x19c548[_0x443d1e][_0xe03759(0x246)]=0x0,_0x19c548[_0x443d1e]['bin']=0x0,_0x19c548[_0x443d1e][_0xe03759(0x1b0)]=_0xe03759(0x192),_0x19c548[_0x443d1e]['floorlevel']=_0x37d366[0x5];}else{if(_0x443d1e==_0xf63804){if(_0x37d366[0x0]=='A'&&_0x37d366[0x1]=='L'&&_0x37d366[0x2]=='L')console[_0xe03759(0x1ef)](_0x38e080+_0xe03759(0x251)+_0x443d1e+_0xe03759(0x251)+_0xf63804+'\x20<>\x20'+_0x37d366+'here'),_0x19c548[_0x443d1e][_0xe03759(0x193)]=_0x37d366[0x0],_0x19c548[_0x443d1e][_0xe03759(0x1fe)]=_0x37d366[0x1],_0x19c548[_0x443d1e][_0xe03759(0x246)]=0x0,_0x19c548[_0x443d1e][_0xe03759(0x1e0)]=0x0,_0x19c548[_0x443d1e][_0xe03759(0x1b0)]=_0xe03759(0x192),_0x19c548[_0x443d1e][_0xe03759(0x292)]=_0x37d366[0x3];else{var _0x2f372e;if(_0x37d366[0x4]=='L')_0x2f372e=_0xe03759(0x218);else _0x37d366[0x4]=='F'&&(_0x2f372e='Floor');_0x19c548[_0x443d1e][_0xe03759(0x193)]=_0x37d366[0x0],_0x19c548[_0x443d1e][_0xe03759(0x1fe)]=_0x37d366[0x1],_0x19c548[_0x443d1e]['bay']=_0x37d366[0x2],_0x19c548[_0x443d1e][_0xe03759(0x1e0)]=_0x37d366[0x3],_0x19c548[_0x443d1e]['type']=_0x2f372e,_0x19c548[_0x443d1e][_0xe03759(0x292)]=_0x37d366[0x5];}}}}});}),_0x583135[_0x34b852(0x2ab)]((_0x406845,_0x414f34)=>{var _0x15f681=_0x34b852;_0x19c548[_0x414f34][_0x15f681(0x1f3)]=_0x406845;}),_0x17c299[_0x34b852(0x2ab)]((_0x571b6a,_0x33b7e5)=>{_0x19c548[_0x33b7e5]['secondary_code']=_0x571b6a;}),_0x334fa7[_0x34b852(0x2ab)]((_0xe755d9,_0x1096a6)=>{_0x19c548[_0x1096a6]['maxStocks']=_0xe755d9;}),_0x19c7e2[_0x34b852(0x2ab)]((_0x18ad6a,_0x69675b)=>{var _0xe5b39=_0x34b852;_0x19c548[_0x69675b][_0xe5b39(0x20d)]=_0x18ad6a;}),_0x404883['forEach']((_0x537c93,_0x52b4eb)=>{_0x19c548[_0x52b4eb]['expiry_date']=_0x537c93;}),_0x3ab49d['forEach']((_0x269a0b,_0x1fde8e)=>{var _0x1d907e=_0x34b852;_0x19c548[_0x1fde8e][_0x1d907e(0x286)]=_0x269a0b;}),_0x141243['forEach']((_0x3549c4,_0xd56eb6)=>{var _0x196b5c=_0x34b852;_0x19c548[_0xd56eb6][_0x196b5c(0x1e9)]=_0x3549c4;}),_0x5ac545[_0x34b852(0x2ab)]((_0x1dce6d,_0x5bf498)=>{var _0x2a7cb1=_0x34b852;_0x19c548[_0x5bf498][_0x2a7cb1(0x285)]=_0x1dce6d;}),_0x274c5f[_0x34b852(0x2ab)]((_0x4f8902,_0x4d18ea)=>{var _0x3c5857=_0x34b852;_0x19c548[_0x4d18ea][_0x3c5857(0x1ac)]=_0x4f8902;}),_0x276016[_0x34b852(0x2ab)]((_0x5c8815,_0x4f79cc)=>{_0x19c548[_0x4f79cc]['room_name']=_0x5c8815;}),_0xf42c99[_0x34b852(0x2ab)]((_0x3bbe9e,_0xc78cf0)=>{var _0x52b800=_0x34b852;_0x19c548[_0xc78cf0][_0x52b800(0x1d8)]=_0x3bbe9e;}),_0x13de08[_0x34b852(0x2ab)]((_0x3f151e,_0x481aa4)=>{_0x19c548[_0x481aa4]['invoice']=_0x3f151e;});const _0x5acbe6=_0x276016['map'](_0x424a16=>{return _0x424a16={'room_name':_0x424a16};}),_0x535bea=_0x19c548['filter'](_0xcf94c1=>_0xcf94c1[_0x34b852(0x1ea)]!=='0'&&_0xcf94c1['quantity']!==''),_0x4d3fc4=new purchases({'invoice':_0x500703,'suppliers':_0x5ba5a9[_0x34b852(0x1e5)][_0x34b852(0x1d3)],'date':_0x4a3c0e,'warehouse_name':_0x31180e,'product':_0x535bea,'note':_0x2c5e8e,'due_amount':_0x1c9b88,'POnumber':_0x18edea,'SCRN':_0x1105ff,'JO_number':_0x38c00c,'roomList':_0x5acbe6}),_0x1a12e2=await _0x4d3fc4['save'](),_0x494f7b=await purchases[_0x34b852(0x22d)]({'invoice':_0x500703}),_0x13b088=_0x494f7b[_0x34b852(0x276)]['map'](async _0x1fb5f3=>{var _0x1548bb=_0x34b852,_0x27d048=await warehouse[_0x1548bb(0x22d)]({'name':_0x31180e,'room':_0x1fb5f3['room_name']}),_0x5bd41b=0x0;return _0x27d048[_0x1548bb(0x249)][_0x1548bb(0x2ab)](_0x12dbc6=>{var _0x4f6ffd=_0x1548bb;_0x12dbc6[_0x4f6ffd(0x209)]==_0x1fb5f3[_0x4f6ffd(0x209)]&&_0x12dbc6[_0x4f6ffd(0x292)]==_0x1fb5f3[_0x4f6ffd(0x292)]&&_0x12dbc6[_0x4f6ffd(0x1b0)]==_0x1fb5f3['type']&&_0x12dbc6[_0x4f6ffd(0x1e0)]==_0x1fb5f3[_0x4f6ffd(0x1e0)]&&_0x12dbc6[_0x4f6ffd(0x246)]==_0x1fb5f3[_0x4f6ffd(0x246)]&&_0x12dbc6[_0x4f6ffd(0x1fe)]==_0x1fb5f3['rack']&&_0x12dbc6[_0x4f6ffd(0x193)]==_0x1fb5f3[_0x4f6ffd(0x193)]&&_0x12dbc6[_0x4f6ffd(0x1c6)]==_0x1fb5f3[_0x4f6ffd(0x1c6)]&&_0x12dbc6[_0x4f6ffd(0x20d)]==_0x1fb5f3[_0x4f6ffd(0x20d)]&&_0x12dbc6['production_date']==_0x1fb5f3[_0x4f6ffd(0x285)]&&_0x12dbc6[_0x4f6ffd(0x21b)]==_0x494f7b[_0x4f6ffd(0x21b)]&&(_0x12dbc6[_0x4f6ffd(0x25a)]+=Math[_0x4f6ffd(0x22a)](_0x1fb5f3[_0x4f6ffd(0x1ea)]),_0x5bd41b++);}),_0x5bd41b===0x0&&_0x27d048[_0x1548bb(0x249)][_0x1548bb(0x236)]({'product_name':_0x1fb5f3[_0x1548bb(0x209)],'product_stock':Math[_0x1548bb(0x22a)](_0x1fb5f3['quantity']),'primary_code':_0x1fb5f3[_0x1548bb(0x1f3)],'secondary_code':_0x1fb5f3[_0x1548bb(0x1f4)],'product_code':_0x1fb5f3['product_code'],'storage':_0x1fb5f3[_0x1548bb(0x193)],'rack':_0x1fb5f3['rack'],'bay':_0x1fb5f3[_0x1548bb(0x246)],'bin':_0x1fb5f3[_0x1548bb(0x1e0)],'type':_0x1fb5f3[_0x1548bb(0x1b0)],'floorlevel':_0x1fb5f3[_0x1548bb(0x292)],'maxProducts':_0x1fb5f3['maxStocks'],'unit':_0x1fb5f3[_0x1548bb(0x25e)],'secondary_unit':_0x1fb5f3[_0x1548bb(0x269)],'expiry_date':_0x1fb5f3[_0x1548bb(0x1c6)],'maxPerUnit':_0x1fb5f3[_0x1548bb(0x286)],'batch_code':_0x1fb5f3[_0x1548bb(0x20d)],'alertQTY':_0x1fb5f3[_0x1548bb(0x1e9)],'production_date':_0x1fb5f3[_0x1548bb(0x285)],'product_cat':_0x1fb5f3['product_cat'],'invoice':_0x1fb5f3[_0x1548bb(0x21b)],'actual_qty':Math[_0x1548bb(0x22a)](_0x1fb5f3['actual_qty']),'actual_uom':_0x1fb5f3[_0x1548bb(0x25f)]}),_0x27d048;});Promise['all'](_0x13b088)['then'](async _0x43b11d=>{var _0x447222=_0x34b852;try{for(const _0x146276 of _0x43b11d){await _0x146276[_0x447222(0x1a2)]();}const _0x3e0e23=await master_shop[_0x447222(0x289)](),_0x532053=await email_settings[_0x447222(0x22d)](),_0x33b28a=await supervisor_settings[_0x447222(0x289)]();var _0x5bc3bc=_0x494f7b['product'],_0x35004a='',_0x29142a;for(_0x29142a in _0x5bc3bc){_0x35004a+=_0x447222(0x237)+_0x447222(0x266)+_0x5bc3bc[_0x29142a][_0x447222(0x209)]+_0x447222(0x29f)+_0x447222(0x266)+_0x5bc3bc[_0x29142a]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5bc3bc[_0x29142a]['quantity']+_0x447222(0x29f)+_0x447222(0x266)+_0x5bc3bc[_0x29142a][_0x447222(0x25e)]+'</td>'+_0x447222(0x266)+_0x5bc3bc[_0x29142a][_0x447222(0x269)]+_0x447222(0x29f)+_0x447222(0x266)+_0x494f7b[_0x447222(0x1ed)]+_0x447222(0x29f)+_0x447222(0x266)+_0x5bc3bc[_0x29142a][_0x447222(0x19b)]+_0x447222(0x29f)+_0x447222(0x266)+_0x5bc3bc[_0x29142a][_0x447222(0x193)]+_0x5bc3bc[_0x29142a][_0x447222(0x1fe)]+_0x5bc3bc[_0x29142a]['bay']+_0x5bc3bc[_0x29142a][_0x447222(0x1e0)]+_0x5bc3bc[_0x29142a][_0x447222(0x1b0)][0x0]+_0x5bc3bc[_0x29142a][_0x447222(0x292)]+'</td>','</tr>';}let _0x5ea07d=nodemailer[_0x447222(0x26c)]({'host':_0x532053[_0x447222(0x22f)],'port':Number(_0x532053[_0x447222(0x1b5)]),'secure':![],'auth':{'user':_0x532053[_0x447222(0x27b)],'pass':_0x532053[_0x447222(0x27e)]}}),_0x464e62={'from':_0x532053['email'],'to':_0x33b28a[0x0][_0x447222(0x1e1)],'subject':_0x447222(0x222),'attachments':[{'filename':_0x447222(0x233),'path':__dirname+_0x447222(0x1bb)+_0x447222(0x24c)+_0x3e0e23[0x0][_0x447222(0x1be)],'cid':'logo'}],'html':_0x447222(0x1d7)+_0x447222(0x206)+_0x447222(0x1ab)+_0x447222(0x2a6)+_0x447222(0x23f)+'<div>'+_0x447222(0x1b1)+_0x447222(0x1c0)+_0x447222(0x2a6)+_0x447222(0x223)+_0x3e0e23[0x0][_0x447222(0x259)]+_0x447222(0x1d4)+_0x447222(0x1c0)+_0x447222(0x1c0)+_0x447222(0x273)+_0x447222(0x2a6)+_0x447222(0x252)+_0x447222(0x268)+_0x494f7b[_0x447222(0x21b)]+'\x20'+_0x447222(0x242)+'\x20Order\x20Date\x20:\x20'+_0x494f7b['date']+'\x20'+_0x447222(0x23d)+_0x447222(0x1b2)+'</div>'+_0x447222(0x21f)+_0x447222(0x248)+'<tr>'+_0x447222(0x191)+_0x447222(0x1a6)+_0x447222(0x261)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x447222(0x295)+_0x447222(0x19a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x447222(0x1e2)+'</thead>'+_0x447222(0x2a1)+'\x20'+_0x35004a+'\x20'+_0x447222(0x205)+_0x447222(0x19f)+_0x447222(0x2a6)+'<strong>\x20Regards\x20</strong>'+_0x447222(0x23b)+_0x3e0e23[0x0][_0x447222(0x259)]+_0x447222(0x1b2)+_0x447222(0x1c0)+_0x447222(0x1c0)+_0x447222(0x1c9)};_0x5ea07d[_0x447222(0x1e8)](_0x464e62,function(_0x1f43fd,_0x1bba50){var _0x34341f=_0x447222;_0x1f43fd?(console['log'](_0x1f43fd),console[_0x34341f(0x1ef)](_0x34341f(0x284))):console[_0x34341f(0x1ef)](_0x34341f(0x1dd));}),_0x5ba5a9[_0x447222(0x28c)](_0x447222(0x1af),_0x447222(0x217)),_0x5bcbaf[_0x447222(0x27f)](_0x447222(0x23e));}catch(_0x868c3c){console[_0x447222(0x1a1)](_0x868c3c),_0x5bcbaf['status'](0x1f4)[_0x447222(0x228)]({'error':_0x447222(0x294)});}})['catch'](_0xd15d5=>{var _0x72bde5=_0x34b852;console['error'](_0xd15d5),_0x5bcbaf[_0x72bde5(0x1d9)](0x1f4)[_0x72bde5(0x228)]({'error':_0x72bde5(0x232)});});}catch(_0xce6d3a){console[_0x34b852(0x1ef)](_0xce6d3a);}}),router[a0_0x1c2e10(0x1ec)](a0_0x1c2e10(0x2a5),auth,async(_0x5499fa,_0x59926e)=>{var _0x35ffa3=a0_0x1c2e10;try{const {username:_0x7cd512,email:_0x11de3b,role:_0x17af58}=_0x5499fa['user'],_0x55b981=_0x5499fa['user'],_0x23a4e3=await profile[_0x35ffa3(0x22d)]({'email':_0x55b981[_0x35ffa3(0x27b)]}),_0x4ccf58=await master_shop[_0x35ffa3(0x289)](),_0x50facb=_0x5499fa[_0x35ffa3(0x1a8)]['id'],_0x44cf07=await purchases[_0x35ffa3(0x260)](_0x50facb),_0x36ae5e=await warehouse[_0x35ffa3(0x1ce)]([{'$match':{'name':_0x44cf07[_0x35ffa3(0x1ed)],'room':_0x44cf07[_0x35ffa3(0x1c4)]}},{'$unwind':_0x35ffa3(0x227)},{'$group':{'_id':_0x35ffa3(0x1c8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x35ffa3(0x29a)},'bin':{'$first':_0x35ffa3(0x1d6)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x35ffa3(0x199)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x35ffa3(0x241)},'rack':{'$first':_0x35ffa3(0x221)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x2afaae=await customer['find']({});let _0x5f4362;if(_0x55b981['role']==_0x35ffa3(0x1b4)){const _0x359559=await staff[_0x35ffa3(0x22d)]({'email':_0x55b981[_0x35ffa3(0x27b)]});_0x5f4362=await warehouse['aggregate']([{'$match':{'status':_0x35ffa3(0x2ac),'name':_0x359559[_0x35ffa3(0x21c)]}},{'$group':{'_id':_0x35ffa3(0x235),'name':{'$first':_0x35ffa3(0x235)}}}]);}else _0x5f4362=await warehouse[_0x35ffa3(0x1ce)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x35ffa3(0x235),'name':{'$first':_0x35ffa3(0x235)}}}]);const _0xd23c30=await product[_0x35ffa3(0x289)]({}),_0x517c57=await suppliers['find']({}),_0x1ef028=BayBinSelected(_0x44cf07[_0x35ffa3(0x1ed)],_0x44cf07['room']);if(_0x4ccf58[0x0]['language']==_0x35ffa3(0x271)){var _0x125089=users[_0x35ffa3(0x207)];console[_0x35ffa3(0x1ef)](_0x125089);}else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]==_0x35ffa3(0x202))var _0x125089=users[_0x35ffa3(0x202)];else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]=='German')var _0x125089=users['German'];else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]==_0x35ffa3(0x1cf))var _0x125089=users['Spanish'];else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]==_0x35ffa3(0x195))var _0x125089=users[_0x35ffa3(0x195)];else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]==_0x35ffa3(0x1b7))var _0x125089=users[_0x35ffa3(0x20f)];else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]==_0x35ffa3(0x1b9))var _0x125089=users[_0x35ffa3(0x1b9)];else{if(_0x4ccf58[0x0][_0x35ffa3(0x208)]==_0x35ffa3(0x262))var _0x125089=users[_0x35ffa3(0x24f)];}}}}}}}_0x59926e[_0x35ffa3(0x229)]('edit_purchases_view',{'success':_0x5499fa[_0x35ffa3(0x28c)](_0x35ffa3(0x1af)),'errors':_0x5499fa[_0x35ffa3(0x28c)]('errors'),'role':_0x55b981,'profile':_0x23a4e3,'customer':_0x2afaae,'warehouse':_0x5f4362,'product':_0x36ae5e,'user':_0x44cf07,'master_shop':_0x4ccf58,'unit':_0xd23c30,'language':_0x125089,'suppliers':_0x517c57,'dataSelected':_0x1ef028});}catch(_0x55c6ac){console['log'](_0x55c6ac);}}),router[a0_0x1c2e10(0x263)]('/preview/:id',auth,async(_0xbed7c8,_0x4f912a)=>{var _0x17cc86=a0_0x1c2e10;try{const _0x34c14f=_0xbed7c8[_0x17cc86(0x1a8)]['id'],{invoice:_0x591ec7,warehouse_name:_0x2f9d21,Room_name:_0x1f020e}=_0xbed7c8[_0x17cc86(0x1e5)],_0x29e24c=await warehouse[_0x17cc86(0x22d)]({'name':_0x2f9d21,'room':_0x1f020e}),_0x423085=await purchases[_0x17cc86(0x22d)]({'invoice':_0x591ec7});_0x423085[_0x17cc86(0x276)][_0x17cc86(0x2ab)](_0x8127e0=>{var _0x480dd8=_0x17cc86,_0x42cf01=0x0;const _0x200771=_0x29e24c[_0x480dd8(0x249)][_0x480dd8(0x283)](_0x6b3787=>{var _0x455ab2=_0x480dd8;_0x6b3787[_0x455ab2(0x209)]==_0x8127e0[_0x455ab2(0x209)]&&_0x6b3787[_0x455ab2(0x292)]==_0x8127e0[_0x455ab2(0x292)]&&_0x6b3787['type']==_0x8127e0['type']&&_0x6b3787[_0x455ab2(0x1e0)]==_0x8127e0[_0x455ab2(0x1e0)]&&_0x6b3787[_0x455ab2(0x246)]==_0x8127e0['bay']&&_0x6b3787['rack']==_0x8127e0['rack']&&_0x6b3787['storage']==_0x8127e0[_0x455ab2(0x193)]&&_0x6b3787[_0x455ab2(0x1c6)]==_0x8127e0[_0x455ab2(0x1c6)]&&_0x6b3787[_0x455ab2(0x20d)]==_0x8127e0[_0x455ab2(0x20d)]&&_0x6b3787['production_date']==_0x8127e0[_0x455ab2(0x285)]&&_0x6b3787[_0x455ab2(0x231)]==_0x8127e0[_0x455ab2(0x231)]&&_0x6b3787[_0x455ab2(0x1d8)]==_0x8127e0['delivery_code']&&(_0x6b3787[_0x455ab2(0x25a)]=parseInt(_0x6b3787[_0x455ab2(0x25a)])+parseInt(_0x8127e0[_0x455ab2(0x1ea)]),_0x42cf01++);});_0x42cf01=='0'&&(_0x29e24c[_0x480dd8(0x249)]=_0x29e24c[_0x480dd8(0x249)][_0x480dd8(0x1a9)]({'product_name':_0x8127e0[_0x480dd8(0x209)],'product_stock':_0x8127e0[_0x480dd8(0x1ea)],'primary_code':_0x8127e0[_0x480dd8(0x1f3)],'secondary_code':_0x8127e0[_0x480dd8(0x1f4)],'product_code':_0x8127e0['product_code'],'storage':_0x8127e0[_0x480dd8(0x193)],'rack':_0x8127e0[_0x480dd8(0x1fe)],'bay':_0x8127e0[_0x480dd8(0x246)],'bin':_0x8127e0['bin'],'type':_0x8127e0[_0x480dd8(0x1b0)],'floorlevel':_0x8127e0['floorlevel'],'maxProducts':_0x8127e0['maxStocks'],'unit':_0x8127e0[_0x480dd8(0x25e)],'secondary_unit':_0x8127e0[_0x480dd8(0x269)],'expiry_date':_0x8127e0[_0x480dd8(0x1c6)],'maxPerUnit':_0x8127e0[_0x480dd8(0x286)],'batch_code':_0x8127e0[_0x480dd8(0x20d)],'alertQTY':_0x8127e0[_0x480dd8(0x1e9)],'production_date':_0x8127e0[_0x480dd8(0x285)],'delivery_date':_0x8127e0['delivery_date'],'delivery_code':_0x8127e0['delivery_code']}));}),await _0x29e24c[_0x17cc86(0x1a2)](),_0x423085['finalize']=_0x17cc86(0x2aa);const _0x15d5e0=await _0x423085[_0x17cc86(0x1a2)]();_0xbed7c8[_0x17cc86(0x28c)](_0x17cc86(0x1af),_0x17cc86(0x270)),_0x4f912a[_0x17cc86(0x27f)]('/all_purchases/view');}catch(_0x28ffc4){console[_0x17cc86(0x1ef)](_0x28ffc4);}}),router['get'](a0_0x1c2e10(0x1b3),auth,async(_0x3e5982,_0x4cd67a)=>{var _0x5f1668=a0_0x1c2e10;try{const {username:_0x592e73,email:_0x4cc8f8,role:_0x1e201e}=_0x3e5982['user'],_0x2da927=_0x3e5982[_0x5f1668(0x1e6)],_0x168d1b=await profile[_0x5f1668(0x22d)]({'email':_0x2da927[_0x5f1668(0x27b)]}),_0x409183=await master_shop['find'](),_0x173a5c=_0x3e5982['params']['id'],_0x8c0917=await purchases[_0x5f1668(0x260)](_0x173a5c),_0x4e82c6=await suppliers['find']({});let _0x2594b1;if(_0x2da927[_0x5f1668(0x27d)]==_0x5f1668(0x1b4)){const _0x17cb85=await staff[_0x5f1668(0x22d)]({'email':_0x2da927[_0x5f1668(0x27b)]});_0x2594b1=await warehouse['find']({'status':_0x5f1668(0x2ac),'name':_0x17cb85['warehouse'],'warehouse_category':_0x5f1668(0x1f6)});}else _0x2594b1=await warehouse[_0x5f1668(0x1ce)]([{'$match':{'status':'Enabled','warehouse_category':_0x5f1668(0x1f6)}},{'$group':{'_id':_0x5f1668(0x235),'name':{'$first':_0x5f1668(0x235)}}}]);const _0x50248d=await product['find']({}),_0x40f04f=BayBinSelected(_0x8c0917[_0x5f1668(0x1ed)],_0x8c0917[_0x5f1668(0x1c4)]);let _0x2c03c9=new Date(_0x8c0917[_0x5f1668(0x1c6)]),_0x5efbab=('0'+_0x2c03c9[_0x5f1668(0x267)]())[_0x5f1668(0x2ad)](-0x2),_0x533a0b=('0'+(_0x2c03c9[_0x5f1668(0x1d1)]()+0x1))['slice'](-0x2),_0x5388b7=_0x2c03c9['getFullYear'](),_0xa6db95=_0x5388b7+'-'+_0x533a0b+'-'+_0x5efbab;if(_0x409183[0x0][_0x5f1668(0x208)]==_0x5f1668(0x271)){var _0x168da8=users[_0x5f1668(0x207)];console[_0x5f1668(0x1ef)](_0x168da8);}else{if(_0x409183[0x0]['language']==_0x5f1668(0x202))var _0x168da8=users[_0x5f1668(0x202)];else{if(_0x409183[0x0][_0x5f1668(0x208)]==_0x5f1668(0x1bf))var _0x168da8=users[_0x5f1668(0x1bf)];else{if(_0x409183[0x0][_0x5f1668(0x208)]==_0x5f1668(0x1cf))var _0x168da8=users[_0x5f1668(0x1cf)];else{if(_0x409183[0x0][_0x5f1668(0x208)]=='French')var _0x168da8=users[_0x5f1668(0x195)];else{if(_0x409183[0x0][_0x5f1668(0x208)]==_0x5f1668(0x1b7))var _0x168da8=users[_0x5f1668(0x20f)];else{if(_0x409183[0x0][_0x5f1668(0x208)]==_0x5f1668(0x1b9))var _0x168da8=users[_0x5f1668(0x1b9)];else{if(_0x409183[0x0][_0x5f1668(0x208)]==_0x5f1668(0x262))var _0x168da8=users[_0x5f1668(0x24f)];}}}}}}}_0x4cd67a['render'](_0x5f1668(0x282),{'success':_0x3e5982[_0x5f1668(0x28c)](_0x5f1668(0x1af)),'errors':_0x3e5982[_0x5f1668(0x28c)](_0x5f1668(0x279)),'role':_0x2da927,'profile':_0x168d1b,'purchases':_0x8c0917,'suppliers':_0x4e82c6,'warehouse':_0x2594b1,'product':_0x50248d,'master_shop':_0x409183,'language':_0x168da8,'ed_fullDate':_0xa6db95,'dataSelected':_0x40f04f});}catch(_0x5b46ac){console[_0x5f1668(0x1ef)](_0x5b46ac);}}),router[a0_0x1c2e10(0x263)]('/view/:id',auth,async(_0x13dd1d,_0x2a0888)=>{var _0x4cd5f2=a0_0x1c2e10;try{const _0x3864d5=_0x13dd1d[_0x4cd5f2(0x1a8)]['id'],_0x4ebdd=await purchases[_0x4cd5f2(0x22d)]({'_id':_0x13dd1d['params']['id']}),_0x3c97e1=await warehouse[_0x4cd5f2(0x22d)]({'name':_0x4ebdd[_0x4cd5f2(0x1ed)],'room':_0x4ebdd['room']});_0x4ebdd[_0x4cd5f2(0x276)][_0x4cd5f2(0x2ab)](_0x3220ea=>{var _0x117063=_0x4cd5f2;const _0x40767e=_0x3c97e1[_0x117063(0x249)][_0x117063(0x283)](_0x56b54b=>{var _0x30c699=_0x117063;_0x56b54b[_0x30c699(0x209)]==_0x3220ea[_0x30c699(0x209)]&&_0x56b54b[_0x30c699(0x292)]==_0x3220ea['floorlevel']&&_0x56b54b[_0x30c699(0x1b0)]==_0x3220ea[_0x30c699(0x1b0)]&&_0x56b54b[_0x30c699(0x1e0)]==_0x3220ea[_0x30c699(0x1e0)]&&_0x56b54b[_0x30c699(0x246)]==_0x3220ea['bay']&&_0x56b54b['rack']==_0x3220ea[_0x30c699(0x1fe)]&&_0x56b54b['storage']==_0x3220ea['storage']&&(_0x56b54b[_0x30c699(0x25a)]=parseInt(_0x56b54b['product_stock'])-parseInt(_0x3220ea[_0x30c699(0x1ea)]));});}),await _0x3c97e1[_0x4cd5f2(0x1a2)]();const {invoice:_0x2e336d,suppliers:_0x1e4e1c,date:_0x2a6901,warehouse_name:_0x4cc8a7,prod_name:_0x4f1f92,prod_code:_0x12063a,prod_qty:_0x54b015,prod_unit:_0x352f22,prod_secondunit:_0x474af9,prod_level:_0x277a1c,prod_isle:_0x1b64dc,prod_pallet:_0xd63e73,note:_0x19c09b,expiry_date:_0x30fa17,batch_code:_0xf9ecc8,paid_amount:_0x6fad08,due_amount:_0x26594f,Room_name:_0x58696f,primary_code:_0x367639,secondary_code:_0x4c26be,PO_number:_0x6ce82f,JO_number:_0x5be5e6}=_0x13dd1d[_0x4cd5f2(0x1e5)];if(typeof _0x4f1f92=='string')var _0x3daf4c=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x194)]],_0x639779=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x24d)]],_0x294440=[_0x13dd1d['body']['prod_qty']],_0x21d980=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1ba)]],_0x38edf4=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1ae)]],_0x1b0b60=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1da)]],_0x18447d=[_0x13dd1d['body'][_0x4cd5f2(0x275)]],_0x3d863c=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x296)]],_0x109fa8=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1f3)]],_0x3300fd=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1f4)]],_0x12a58c=[_0x13dd1d['body'][_0x4cd5f2(0x26b)]],_0x28eb91=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x20d)]],_0x55e9e6=[_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1c6)]],_0x15aede=[_0x13dd1d['body'][_0x4cd5f2(0x193)]],_0x2f20c5=[_0x13dd1d[_0x4cd5f2(0x1e5)]['rak']],_0x11aa89=[_0x13dd1d[_0x4cd5f2(0x1e5)]['type']];else var _0x3daf4c=[..._0x13dd1d[_0x4cd5f2(0x1e5)]['prod_name']],_0x639779=[..._0x13dd1d['body']['prod_code']],_0x294440=[..._0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x22e)]],_0x21d980=[..._0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1ba)]],_0x38edf4=[..._0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1ae)]],_0x1b0b60=[..._0x13dd1d['body']['prod_level']],_0x18447d=[..._0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x275)]],_0x3d863c=[..._0x13dd1d[_0x4cd5f2(0x1e5)]['prod_pallet']],_0x109fa8=[..._0x13dd1d[_0x4cd5f2(0x1e5)]['primary_code']],_0x3300fd=[..._0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x1f4)]],_0x12a58c=[..._0x13dd1d['body'][_0x4cd5f2(0x26b)]],_0x28eb91=[..._0x13dd1d[_0x4cd5f2(0x1e5)]['batch_code']],_0x55e9e6=[..._0x13dd1d['body'][_0x4cd5f2(0x1c6)]],_0x15aede=[..._0x13dd1d[_0x4cd5f2(0x1e5)]['storage']],_0x2f20c5=[..._0x13dd1d['body']['rak']],_0x11aa89=[..._0x13dd1d['body'][_0x4cd5f2(0x1b0)]];const _0x1c408d=_0x3daf4c[_0x4cd5f2(0x283)](_0x34957e=>{return _0x34957e={'product_name':_0x34957e};});_0x639779[_0x4cd5f2(0x2ab)]((_0x4eb004,_0x5c6e5a)=>{var _0x15c4ee=_0x4cd5f2;_0x1c408d[_0x5c6e5a][_0x15c4ee(0x234)]=_0x4eb004;}),_0x294440['forEach']((_0x36418b,_0x346cdb)=>{_0x1c408d[_0x346cdb]['quantity']=_0x36418b;}),_0x21d980[_0x4cd5f2(0x2ab)]((_0x12fd8a,_0x332a68)=>{_0x1c408d[_0x332a68]['standard_unit']=_0x12fd8a;}),_0x38edf4[_0x4cd5f2(0x2ab)]((_0x56e075,_0x369b1f)=>{var _0x2f29b9=_0x4cd5f2;_0x1c408d[_0x369b1f][_0x2f29b9(0x269)]=_0x56e075;}),_0x1b0b60[_0x4cd5f2(0x2ab)]((_0x1c3d5d,_0x51c6c4)=>{_0x1c408d[_0x51c6c4]['bay']=_0x1c3d5d;}),_0x18447d[_0x4cd5f2(0x2ab)]((_0x27732b,_0x397690)=>{var _0x563b12=_0x4cd5f2;_0x1c408d[_0x397690][_0x563b12(0x1e0)]=_0x27732b;}),_0x3d863c['forEach']((_0x5a1cd1,_0x17d7a8)=>{var _0x56ded8=_0x4cd5f2;_0x1c408d[_0x17d7a8][_0x56ded8(0x292)]=_0x5a1cd1;}),_0x109fa8[_0x4cd5f2(0x2ab)]((_0x282380,_0x294135)=>{_0x1c408d[_0x294135]['primary_code']=_0x282380;}),_0x3300fd[_0x4cd5f2(0x2ab)]((_0x2ee808,_0x269541)=>{var _0x373973=_0x4cd5f2;_0x1c408d[_0x269541][_0x373973(0x1f4)]=_0x2ee808;}),_0x12a58c[_0x4cd5f2(0x2ab)]((_0x508b33,_0x125a14)=>{var _0x3faff2=_0x4cd5f2;_0x1c408d[_0x125a14][_0x3faff2(0x23c)]=_0x508b33;}),_0x28eb91[_0x4cd5f2(0x2ab)]((_0x2eaf7b,_0x122191)=>{var _0x178479=_0x4cd5f2;_0x1c408d[_0x122191][_0x178479(0x20d)]=_0x2eaf7b;}),_0x55e9e6[_0x4cd5f2(0x2ab)]((_0x415d59,_0x1d3537)=>{var _0x1ce9ef=_0x4cd5f2;_0x1c408d[_0x1d3537][_0x1ce9ef(0x1c6)]=_0x415d59;}),_0x11aa89[_0x4cd5f2(0x2ab)]((_0x59fbb7,_0x336bfa)=>{var _0x1d1f43=_0x4cd5f2;_0x1c408d[_0x336bfa][_0x1d1f43(0x1b0)]=_0x59fbb7;}),_0x15aede[_0x4cd5f2(0x2ab)]((_0x2c88ab,_0x3ff82c)=>{var _0x34300f=_0x4cd5f2;_0x1c408d[_0x3ff82c][_0x34300f(0x193)]=_0x2c88ab;}),_0x2f20c5[_0x4cd5f2(0x2ab)]((_0x2b7452,_0x18053b)=>{var _0x513c6b=_0x4cd5f2;_0x1c408d[_0x18053b][_0x513c6b(0x1fe)]=_0x2b7452;});const _0x18a606=_0x1c408d[_0x4cd5f2(0x1e7)](_0x3e44fe=>_0x3e44fe['quantity']!=='0'&&_0x3e44fe[_0x4cd5f2(0x1ea)]!=='');_0x4ebdd[_0x4cd5f2(0x21b)]=_0x2e336d,_0x4ebdd['suppliers']=_0x1e4e1c,_0x4ebdd[_0x4cd5f2(0x1d0)]=_0x2a6901,_0x4ebdd[_0x4cd5f2(0x1ed)]=_0x4cc8a7,_0x4ebdd[_0x4cd5f2(0x276)]=_0x18a606,_0x4ebdd[_0x4cd5f2(0x2a7)]=_0x19c09b,_0x4ebdd['paid_amount']=_0x6fad08,_0x4ebdd['due_amount']=_0x26594f,_0x4ebdd[_0x4cd5f2(0x1c4)]=_0x58696f,_0x4ebdd[_0x4cd5f2(0x2a9)]=_0x6ce82f,_0x4ebdd['JO_number']=_0x5be5e6;const _0x333fa6=await _0x4ebdd[_0x4cd5f2(0x1a2)](),_0x4d9be0=await warehouse[_0x4cd5f2(0x22d)]({'name':_0x13dd1d[_0x4cd5f2(0x1e5)]['warehouse_name'],'room':_0x13dd1d['body']['Room_name']});_0x4ebdd[_0x4cd5f2(0x276)][_0x4cd5f2(0x2ab)](_0x5038ff=>{var _0x5f283d=_0x4cd5f2,_0x463738=0x0;const _0x56af46=_0x4d9be0[_0x5f283d(0x249)][_0x5f283d(0x283)](_0x5b654a=>{var _0x24ea28=_0x5f283d;_0x5b654a['product_name']==_0x5038ff['product_name']&&_0x5b654a[_0x24ea28(0x292)]==_0x5038ff[_0x24ea28(0x292)]&&_0x5b654a['type']==_0x5038ff['type']&&_0x5b654a[_0x24ea28(0x1e0)]==_0x5038ff['bin']&&_0x5b654a[_0x24ea28(0x246)]==_0x5038ff['bay']&&_0x5b654a[_0x24ea28(0x1fe)]==_0x5038ff['rack']&&_0x5b654a['storage']==_0x5038ff[_0x24ea28(0x193)]&&(_0x5b654a[_0x24ea28(0x25a)]=parseInt(_0x5b654a[_0x24ea28(0x25a)])+parseInt(_0x5038ff[_0x24ea28(0x1ea)]),_0x463738++);});_0x463738=='0'&&(_0x4d9be0[_0x5f283d(0x249)]=_0x4d9be0['product_details'][_0x5f283d(0x1a9)]({'product_name':_0x5038ff[_0x5f283d(0x209)],'product_stock':_0x5038ff[_0x5f283d(0x1ea)],'primary_code':_0x5038ff[_0x5f283d(0x1f3)],'secondary_code':_0x5038ff[_0x5f283d(0x1f4)],'product_code':_0x5038ff['product_code'],'storage':_0x5038ff[_0x5f283d(0x193)],'rack':_0x5038ff[_0x5f283d(0x1fe)],'bay':_0x5038ff[_0x5f283d(0x246)],'bin':_0x5038ff[_0x5f283d(0x1e0)],'type':_0x5038ff[_0x5f283d(0x1b0)],'floorlevel':_0x5038ff[_0x5f283d(0x292)],'maxProducts':_0x5038ff[_0x5f283d(0x23c)],'unit':_0x5038ff[_0x5f283d(0x25e)],'secondary_unit':_0x5038ff[_0x5f283d(0x269)],'expiry_date':_0x5038ff[_0x5f283d(0x1c6)]}));}),await _0x4d9be0[_0x4cd5f2(0x1a2)]();const _0x2c829f=await s_payment_data['findOne']({'invoice':_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x21b)]});if(_0x2c829f===null){}else console[_0x4cd5f2(0x1ef)]('suppliers',_0x2c829f,_0x13dd1d[_0x4cd5f2(0x1e5)][_0x4cd5f2(0x21b)]),_0x2c829f[_0x4cd5f2(0x1d3)]=_0x13dd1d['body'][_0x4cd5f2(0x1d3)],await _0x2c829f['save']();_0x13dd1d[_0x4cd5f2(0x28c)]('success','purchase\x20data\x20update\x20successfully'),_0x2a0888[_0x4cd5f2(0x27f)](_0x4cd5f2(0x1ca));}catch(_0x2d3e13){console[_0x4cd5f2(0x1ef)](_0x2d3e13);}}),router[a0_0x1c2e10(0x263)]('/give_payment/:id',auth,async(_0x80611c,_0x492850)=>{var _0x563719=a0_0x1c2e10;try{const _0x1facf3=_0x80611c[_0x563719(0x1a8)]['id'],{invoice:_0x22e469,suppliers:_0x48271a,payable:_0x722b6f,due_amount:_0x4f7b8b}=_0x80611c[_0x563719(0x1e5)],_0x401dbd=await purchases[_0x563719(0x260)](_0x1facf3);var _0x5f4395=_0x722b6f-_0x4f7b8b;_0x401dbd[_0x563719(0x1a4)]=parseFloat(_0x401dbd[_0x563719(0x1a4)])+parseFloat(_0x4f7b8b),_0x401dbd[_0x563719(0x298)]=_0x5f4395;const _0x461210=await _0x401dbd[_0x563719(0x1a2)]();console[_0x563719(0x1ef)](_0x461210);const _0x5e797d=await s_payment_data[_0x563719(0x22d)]({'invoice':_0x22e469});_0x5e797d['amount']=_0x5f4395,await _0x5e797d[_0x563719(0x1a2)]();let _0x38a363=new Date(),_0x371dc7=('0'+_0x38a363['getDate']())['slice'](-0x2),_0x8feb9=('0'+(_0x38a363[_0x563719(0x1d1)]()+0x1))['slice'](-0x2),_0x559220=_0x38a363[_0x563719(0x1f5)](),_0x2fa7d2=_0x559220+'-'+_0x8feb9+'-'+_0x371dc7;const _0x3dd946=new suppliers_payment({'invoice':_0x22e469,'date':_0x559220+'-'+_0x8feb9+'-'+_0x371dc7,'suppliers':_0x48271a,'reason':_0x563719(0x28b),'amount':_0x4f7b8b}),_0x274cd1=await _0x3dd946[_0x563719(0x1a2)]();_0x80611c[_0x563719(0x28c)](_0x563719(0x1af),_0x563719(0x291)),_0x492850[_0x563719(0x27f)](_0x563719(0x1ca));}catch(_0x16565c){console['log'](_0x16565c);}}),router[a0_0x1c2e10(0x1ec)]('/invoice/:id',auth,async(_0x539e25,_0x462f4d)=>{var _0x535ec8=a0_0x1c2e10;try{const {username:_0x30d384,email:_0x1d84e7,role:_0x19c68c}=_0x539e25['user'],_0xc50783=_0x539e25['user'],_0x27fd5e=await profile[_0x535ec8(0x22d)]({'email':_0xc50783['email']}),_0x242701=await master_shop[_0x535ec8(0x289)]();console['log'](_0x535ec8(0x21e),_0x242701);const _0x1daf7f=_0x539e25[_0x535ec8(0x1a8)]['id'],_0x2ad2c2=await purchases[_0x535ec8(0x260)](_0x1daf7f);console[_0x535ec8(0x1ef)](_0x2ad2c2);const _0x56e0c1=await suppliers[_0x535ec8(0x22d)]({'name':_0x2ad2c2[_0x535ec8(0x1d3)]});console[_0x535ec8(0x1ef)](_0x56e0c1);if(_0x242701[0x0][_0x535ec8(0x208)]==_0x535ec8(0x271)){var _0x3ccde6=users[_0x535ec8(0x207)];console[_0x535ec8(0x1ef)](_0x3ccde6);}else{if(_0x242701[0x0]['language']==_0x535ec8(0x202))var _0x3ccde6=users[_0x535ec8(0x202)];else{if(_0x242701[0x0][_0x535ec8(0x208)]==_0x535ec8(0x1bf))var _0x3ccde6=users[_0x535ec8(0x1bf)];else{if(_0x242701[0x0][_0x535ec8(0x208)]==_0x535ec8(0x1cf))var _0x3ccde6=users[_0x535ec8(0x1cf)];else{if(_0x242701[0x0][_0x535ec8(0x208)]=='French')var _0x3ccde6=users[_0x535ec8(0x195)];else{if(_0x242701[0x0][_0x535ec8(0x208)]=='Portuguese\x20(BR)')var _0x3ccde6=users[_0x535ec8(0x20f)];else{if(_0x242701[0x0][_0x535ec8(0x208)]==_0x535ec8(0x1b9))var _0x3ccde6=users[_0x535ec8(0x1b9)];else{if(_0x242701[0x0][_0x535ec8(0x208)]==_0x535ec8(0x262))var _0x3ccde6=users[_0x535ec8(0x24f)];}}}}}}}_0x462f4d[_0x535ec8(0x229)](_0x535ec8(0x299),{'success':_0x539e25[_0x535ec8(0x28c)]('success'),'errors':_0x539e25[_0x535ec8(0x28c)](_0x535ec8(0x279)),'role':_0xc50783,'profile':_0x27fd5e,'master_shop':_0x242701,'supplier':_0x56e0c1,'purchase':_0x2ad2c2,'language':_0x3ccde6});}catch(_0x47a410){console[_0x535ec8(0x1ef)](_0x47a410);}}),router[a0_0x1c2e10(0x1ec)](a0_0x1c2e10(0x1fb),auth,async(_0x55f9ed,_0x499ebb)=>{var _0x168b63=a0_0x1c2e10;try{const {username:_0x8e418f,email:_0x3e0aeb,role:_0x7c26b4}=_0x55f9ed[_0x168b63(0x1e6)],_0xf1f0f2=_0x55f9ed['user'],_0x29758b=await profile[_0x168b63(0x22d)]({'email':_0xf1f0f2[_0x168b63(0x27b)]}),_0x45494a=await master_shop[_0x168b63(0x289)]();console[_0x168b63(0x1ef)](_0x168b63(0x21e),_0x45494a);const _0x3541f6=_0x55f9ed[_0x168b63(0x1a8)]['id'];console[_0x168b63(0x1ef)](_0x3541f6);const _0x2081ab=await purchases['findById'](_0x3541f6);console[_0x168b63(0x1ef)]('user_id',_0x2081ab);const _0x5e3f87=await product['find']({}),_0x47dfda=await warehouse[_0x168b63(0x1ce)]([{'$match':{'name':_0x2081ab['warehouse_name'],'room':_0x2081ab[_0x168b63(0x1c4)],'warehouse_category':_0x168b63(0x1f6)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x168b63(0x1c8),'name':{'$first':_0x168b63(0x240)},'product_stock':{'$first':_0x168b63(0x1d5)},'bay':{'$first':_0x168b63(0x29a)},'bin':{'$first':_0x168b63(0x1d6)},'type':{'$first':_0x168b63(0x1d2)},'floorlevel':{'$first':_0x168b63(0x199)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x168b63(0x1a7)},'product_code':{'$first':_0x168b63(0x1ad)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x168b63(0x221)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x168b63(0x1fa),'warehouse_category':_0x168b63(0x1f6)}},{'$group':{'_id':_0x168b63(0x235),'name':{'$first':_0x168b63(0x235)}}},{'$sort':{'name':0x1}}]),console[_0x168b63(0x1ef)](_0x168b63(0x26f),_0x47dfda);if(_0x45494a[0x0][_0x168b63(0x208)]==_0x168b63(0x271)){var _0x59a8d2=users[_0x168b63(0x207)];console[_0x168b63(0x1ef)](_0x59a8d2);}else{if(_0x45494a[0x0][_0x168b63(0x208)]=='Hindi')var _0x59a8d2=users[_0x168b63(0x202)];else{if(_0x45494a[0x0]['language']==_0x168b63(0x1bf))var _0x59a8d2=users[_0x168b63(0x1bf)];else{if(_0x45494a[0x0][_0x168b63(0x208)]==_0x168b63(0x1cf))var _0x59a8d2=users[_0x168b63(0x1cf)];else{if(_0x45494a[0x0][_0x168b63(0x208)]==_0x168b63(0x195))var _0x59a8d2=users[_0x168b63(0x195)];else{if(_0x45494a[0x0]['language']==_0x168b63(0x1b7))var _0x59a8d2=users[_0x168b63(0x20f)];else{if(_0x45494a[0x0][_0x168b63(0x208)]=='Chinese')var _0x59a8d2=users['Chinese'];else{if(_0x45494a[0x0][_0x168b63(0x208)]==_0x168b63(0x262))var _0x59a8d2=users[_0x168b63(0x24f)];}}}}}}}_0x499ebb['render']('return_purchase',{'success':_0x55f9ed['flash'](_0x168b63(0x1af)),'errors':_0x55f9ed[_0x168b63(0x28c)](_0x168b63(0x279)),'role':_0xf1f0f2,'profile':_0x29758b,'user':_0x2081ab,'stock':_0x47dfda,'master_shop':_0x45494a,'product':_0x5e3f87,'language':_0x59a8d2,'warehouse':warehouse_data});}catch(_0x5f2dd2){console[_0x168b63(0x1ef)](_0x5f2dd2);}}),router['post'](a0_0x1c2e10(0x1fb),auth,async(_0x11d687,_0x3eccb6)=>{var _0x52bf67=a0_0x1c2e10;try{const {invoice:_0x3facc6,date:_0x10f861,warehouse_name:_0x5698b4,Room_name:_0x37b431,product_name:_0x1dc4b5,purchase_quantity:_0x4da450,stocks:_0x1d7456,return_qty:_0x5a7a7b,note:_0x211b65,level:_0x41bc4c,isle:_0x29a8b2,pallet:_0xaec094,to_warehouse_name:_0x76fad9,to_Room_name:_0x1143a4}=_0x11d687['body'],_0x33bf1f=await purchases[_0x52bf67(0x22d)]({'_id':_0x11d687[_0x52bf67(0x1a8)]['id']}),_0x5fb8fc=await warehouse[_0x52bf67(0x22d)]({'name':_0x5698b4,'room':_0x37b431});if(typeof _0x1dc4b5=='string')var _0x332ea4=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x209)]],_0x3020f1=[_0x11d687['body'][_0x52bf67(0x26a)]],_0x1a6f39=[_0x11d687['body'][_0x52bf67(0x28e)]],_0x5eb3f1=[_0x11d687['body']['return_qty']],_0x5af685=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x281)]],_0x6e8717=[_0x11d687[_0x52bf67(0x1e5)]['isle']],_0x1781d4=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x1fd)]],_0x42d6b2=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x226)]],_0x15b07c=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x21d)]],_0x1b612e=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x1fc)]],_0x4f61fb=[_0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x29e)]];else var _0x332ea4=[..._0x11d687['body'][_0x52bf67(0x209)]],_0x3020f1=[..._0x11d687[_0x52bf67(0x1e5)]['purchase_quantity']],_0x1a6f39=[..._0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x28e)]],_0x5eb3f1=[..._0x11d687['body'][_0x52bf67(0x230)]],_0x5af685=[..._0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x281)]],_0x6e8717=[..._0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x197)]],_0x1781d4=[..._0x11d687[_0x52bf67(0x1e5)]['pallet']],_0x42d6b2=[..._0x11d687['body'][_0x52bf67(0x226)]],_0x15b07c=[..._0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x21d)]],_0x1b612e=[..._0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x1fc)]],_0x4f61fb=[..._0x11d687[_0x52bf67(0x1e5)][_0x52bf67(0x29e)]];const _0x156e69=_0x332ea4['map'](_0x580323=>{return _0x580323={'product_name':_0x580323};});_0x3020f1[_0x52bf67(0x2ab)]((_0x51da03,_0x4af719)=>{_0x156e69[_0x4af719]['purchase_quantity']=_0x51da03;}),_0x1a6f39[_0x52bf67(0x2ab)]((_0x29a109,_0x1b45d6)=>{_0x156e69[_0x1b45d6]['stock_quantity']=_0x29a109;}),_0x5eb3f1['forEach']((_0x190a9c,_0x27fa95)=>{var _0x31daf5=_0x52bf67;_0x156e69[_0x27fa95][_0x31daf5(0x230)]=_0x190a9c;}),_0x5af685['forEach']((_0x116f68,_0x2ec986)=>{var _0xa021d0=_0x52bf67;_0x156e69[_0x2ec986][_0xa021d0(0x246)]=_0x116f68;}),_0x6e8717[_0x52bf67(0x2ab)]((_0x192f3f,_0x23dda4)=>{_0x156e69[_0x23dda4]['bin']=_0x192f3f;}),_0x1781d4[_0x52bf67(0x2ab)]((_0x5d977f,_0x282efa)=>{var _0x4b97c1=_0x52bf67;_0x156e69[_0x282efa][_0x4b97c1(0x292)]=_0x5d977f;}),_0x42d6b2[_0x52bf67(0x2ab)]((_0x3fee46,_0x167eb7)=>{var _0x51684a=_0x52bf67;_0x156e69[_0x167eb7][_0x51684a(0x1b0)]=_0x3fee46;}),_0x15b07c[_0x52bf67(0x2ab)]((_0xf514eb,_0x20bfbe)=>{_0x156e69[_0x20bfbe]['product_code']=_0xf514eb;}),_0x1b612e[_0x52bf67(0x2ab)]((_0x456e92,_0x209668)=>{var _0x1cd683=_0x52bf67;_0x156e69[_0x209668][_0x1cd683(0x1f3)]=_0x456e92;}),_0x4f61fb[_0x52bf67(0x2ab)]((_0x5132de,_0x1f54c3)=>{var _0x1846ab=_0x52bf67;_0x156e69[_0x1f54c3][_0x1846ab(0x1f4)]=_0x5132de;}),_0x33bf1f['product'][_0x52bf67(0x2ab)](_0x23cb36=>{var _0x3fed31=_0x52bf67;const _0x2ed125=_0x5fb8fc['product_details'][_0x3fed31(0x283)](_0x571cad=>{var _0x4df039=_0x3fed31;_0x571cad[_0x4df039(0x209)]==_0x23cb36[_0x4df039(0x209)]&&_0x571cad['floorlevel']==_0x23cb36[_0x4df039(0x292)]&&_0x571cad['type']==_0x23cb36['type']&&_0x571cad[_0x4df039(0x1e0)]==_0x23cb36[_0x4df039(0x1e0)]&&_0x571cad[_0x4df039(0x246)]==_0x23cb36['bay']&&_0x571cad[_0x4df039(0x1fe)]==_0x23cb36[_0x4df039(0x1fe)]&&_0x571cad[_0x4df039(0x193)]==_0x23cb36['storage']&&(console['log'](parseInt(_0x571cad[_0x4df039(0x25a)])+'\x20<>\x20'+parseInt(_0x23cb36[_0x4df039(0x1ea)])),_0x571cad[_0x4df039(0x25a)]=parseInt(_0x571cad[_0x4df039(0x25a)])+parseInt(_0x23cb36[_0x4df039(0x1ea)]));});}),await _0x5fb8fc['save']();const _0x247eb5=_0x156e69['filter'](_0x382c5e=>_0x382c5e[_0x52bf67(0x230)]!=='0'&&_0x382c5e[_0x52bf67(0x230)]!=='');var _0x1d75f9=0x0;_0x247eb5['forEach'](_0x32f5f7=>{var _0x5cb5a8=_0x52bf67;console['log'](_0x5cb5a8(0x210),_0x32f5f7),(parseInt(_0x32f5f7[_0x5cb5a8(0x26a)])<parseInt(_0x32f5f7['return_qty'])||parseInt(_0x32f5f7[_0x5cb5a8(0x2a4)])<parseInt(_0x32f5f7[_0x5cb5a8(0x230)]))&&_0x1d75f9++;});if(_0x1d75f9!=0x0)return _0x11d687[_0x52bf67(0x28c)](_0x52bf67(0x279),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3eccb6['redirect'](_0x52bf67(0x1aa));const _0x1d9ec3=new purchases_return({'invoice':_0x3facc6,'suppliers':_0x11d687[_0x52bf67(0x1e5)]['suppliers'],'date':_0x10f861,'warehouse_name':_0x5698b4,'return_product':_0x247eb5,'note':_0x211b65,'room':_0x37b431,'to_warehouse_name':_0x76fad9,'to_room':_0x1143a4}),_0x30b7f3=await _0x1d9ec3[_0x52bf67(0x1a2)]();console[_0x52bf67(0x1ef)](_0x1d9ec3);const _0x394a9d=await purchases_return[_0x52bf67(0x22d)]({'invoice':_0x3facc6}),_0x126cac=await warehouse[_0x52bf67(0x22d)]({'name':_0x76fad9,'room':_0x1143a4});_0x394a9d[_0x52bf67(0x26d)]['forEach'](_0x2dccd4=>{var _0x274780=_0x52bf67,_0x1afc1b=0x0;const _0x1bdaab=_0x126cac['product_details'][_0x274780(0x283)](_0xa4d07b=>{var _0x261633=_0x274780;_0xa4d07b[_0x261633(0x209)]==_0x2dccd4['product_name']&&_0xa4d07b['floorlevel']==_0x2dccd4[_0x261633(0x292)]&&_0xa4d07b['type']==_0x2dccd4[_0x261633(0x1b0)]&&_0xa4d07b[_0x261633(0x1e0)]==_0x2dccd4[_0x261633(0x1e0)]&&_0xa4d07b[_0x261633(0x246)]==_0x2dccd4[_0x261633(0x246)]&&(_0xa4d07b[_0x261633(0x25a)]=parseInt(_0xa4d07b[_0x261633(0x25a)])-parseInt(_0x2dccd4[_0x261633(0x230)]),_0x1afc1b++);});_0x1afc1b=='0'&&(_0x126cac[_0x274780(0x249)]=_0x126cac[_0x274780(0x249)][_0x274780(0x1a9)]({'product_name':_0x2dccd4[_0x274780(0x209)],'product_stock':_0x2dccd4[_0x274780(0x230)],'primary_code':_0x2dccd4['primary_code'],'secondary_code':_0x2dccd4[_0x274780(0x1f4)],'product_code':_0x2dccd4[_0x274780(0x234)],'storage':_0x2dccd4[_0x274780(0x193)],'rack':_0x2dccd4[_0x274780(0x1fe)],'bay':_0x2dccd4[_0x274780(0x246)],'bin':_0x2dccd4[_0x274780(0x1e0)],'type':_0x2dccd4['type'],'floorlevel':_0x2dccd4[_0x274780(0x292)],'maxProducts':_0x2dccd4[_0x274780(0x23c)],'unit':_0x2dccd4['standard_unit'],'secondary_unit':_0x2dccd4[_0x274780(0x269)],'expiry_date':_0x2dccd4[_0x274780(0x1c6)]}));}),await _0x126cac[_0x52bf67(0x1a2)]();const _0x4ebcf5=await purchases['findOne']({'invoice':_0x3facc6});_0x4ebcf5[_0x52bf67(0x1b8)]='True';const _0x9a0fb6=await _0x4ebcf5[_0x52bf67(0x1a2)](),_0x3a0e4c=new s_payment_data({'invoice':_0x3facc6,'suppliers':_0x11d687['body']['suppliers'],'reason':_0x52bf67(0x20a)});await _0x3a0e4c[_0x52bf67(0x1a2)]();const _0xe207c2=await master_shop['find']();console[_0x52bf67(0x1ef)]('add\x20post',_0xe207c2[0x0][_0x52bf67(0x1be)]);const _0x2b2424=await email_settings[_0x52bf67(0x22d)](),_0x49d92b=await suppliers['findOne']({'name':_0x11d687['body'][_0x52bf67(0x1d3)]});console[_0x52bf67(0x1ef)](_0x52bf67(0x1c2),_0x49d92b);_0xe207c2[0x0][_0x52bf67(0x1b6)]==0x1?(right_currency=_0xe207c2[0x0][_0x52bf67(0x2a3)],left_currency=''):(right_currency='',left_currency=_0xe207c2[0x0][_0x52bf67(0x2a3)]);var _0x16eb9a=_0x332ea4,_0x166ffc=_0x5eb3f1,_0x235b06='',_0x2c44c4;for(_0x2c44c4 in _0x16eb9a){_0x235b06+=_0x52bf67(0x237)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x16eb9a[_0x2c44c4]+_0x52bf67(0x29f)+_0x52bf67(0x266)+_0x166ffc[_0x2c44c4]+_0x52bf67(0x29f)+_0x52bf67(0x1e2);}console[_0x52bf67(0x1ef)](_0x52bf67(0x216),_0x235b06);let _0x46197c=nodemailer[_0x52bf67(0x26c)]({'service':_0x52bf67(0x1f2),'auth':{'user':_0x2b2424[_0x52bf67(0x27b)],'pass':_0x2b2424['password']}}),_0x18aefd={'from':_0x2b2424['email'],'to':_0x49d92b[_0x52bf67(0x27b)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x52bf67(0x233),'path':__dirname+_0x52bf67(0x1bb)+'/upload/'+_0xe207c2[0x0][_0x52bf67(0x1be)],'cid':_0x52bf67(0x280)}],'html':_0x52bf67(0x1d7)+'<html><head><title></title>'+_0x52bf67(0x1ab)+_0x52bf67(0x2a6)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x52bf67(0x2a6)+_0x52bf67(0x1b1)+_0x52bf67(0x1c0)+_0x52bf67(0x2a6)+_0x52bf67(0x223)+_0xe207c2[0x0][_0x52bf67(0x259)]+_0x52bf67(0x1d4)+_0x52bf67(0x1c0)+_0x52bf67(0x1c0)+_0x52bf67(0x273)+_0x52bf67(0x2a6)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x52bf67(0x268)+_0x3facc6+'\x20'+_0x52bf67(0x242)+_0x52bf67(0x224)+_0x10f861+'\x20'+'</span>'+_0x52bf67(0x1b2)+_0x52bf67(0x1c0)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x52bf67(0x248)+_0x52bf67(0x237)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x52bf67(0x19c)+_0x52bf67(0x250)+_0x52bf67(0x293)+_0x52bf67(0x1e2)+_0x52bf67(0x27c)+_0x52bf67(0x2a1)+'\x20'+_0x235b06+'\x20'+'</tbody>'+_0x52bf67(0x19f)+_0x52bf67(0x2a6)+_0x52bf67(0x1e4)+_0x52bf67(0x23b)+_0xe207c2[0x0][_0x52bf67(0x259)]+_0x52bf67(0x1b2)+_0x52bf67(0x1c0)+_0x52bf67(0x1c0)+_0x52bf67(0x1c9)};_0x46197c[_0x52bf67(0x1e8)](_0x18aefd,function(_0x2aaceb,_0x35b14f){var _0x43759e=_0x52bf67;_0x2aaceb?(console[_0x43759e(0x1ef)](_0x2aaceb),console[_0x43759e(0x1ef)](_0x43759e(0x284))):console[_0x43759e(0x1ef)]('Email\x20sent\x20successfully');}),_0x11d687['flash'](_0x52bf67(0x1af),_0x52bf67(0x1f9)),_0x3eccb6[_0x52bf67(0x27f)](_0x52bf67(0x1ca));}catch(_0x4bcd46){console[_0x52bf67(0x1ef)](_0x4bcd46),_0x3eccb6[_0x52bf67(0x1d9)](0xc8)['json']({'message':_0x4bcd46[_0x52bf67(0x258)]});}}),router['get'](a0_0x1c2e10(0x1c5),auth,async(_0x5fd8a1,_0xc24482)=>{var _0x4c7a7a=a0_0x1c2e10;try{const {username:_0x1f8553,email:_0x1e6d01,role:_0x51f1b7}=_0x5fd8a1[_0x4c7a7a(0x1e6)],_0x99293d=_0x5fd8a1[_0x4c7a7a(0x1e6)],_0x4e46ba=await profile['findOne']({'email':_0x99293d[_0x4c7a7a(0x27b)]}),_0x44ee44=await master_shop['find'](),_0x4793ca=_0x5fd8a1[_0x4c7a7a(0x1a8)]['id'],_0xe566d5=await purchases[_0x4c7a7a(0x260)](_0x4793ca);if(_0x44ee44[0x0][_0x4c7a7a(0x208)]=='English\x20(US)')var _0x386915=users['English'];else{if(_0x44ee44[0x0]['language']==_0x4c7a7a(0x202))var _0x386915=users[_0x4c7a7a(0x202)];else{if(_0x44ee44[0x0][_0x4c7a7a(0x208)]==_0x4c7a7a(0x1bf))var _0x386915=users['German'];else{if(_0x44ee44[0x0][_0x4c7a7a(0x208)]==_0x4c7a7a(0x1cf))var _0x386915=users['Spanish'];else{if(_0x44ee44[0x0]['language']==_0x4c7a7a(0x195))var _0x386915=users[_0x4c7a7a(0x195)];else{if(_0x44ee44[0x0][_0x4c7a7a(0x208)]=='Portuguese\x20(BR)')var _0x386915=users[_0x4c7a7a(0x20f)];else{if(_0x44ee44[0x0][_0x4c7a7a(0x208)]==_0x4c7a7a(0x1b9))var _0x386915=users[_0x4c7a7a(0x1b9)];else{if(_0x44ee44[0x0][_0x4c7a7a(0x208)]==_0x4c7a7a(0x262))var _0x386915=users['Arabic'];}}}}}}}_0xc24482[_0x4c7a7a(0x229)](_0x4c7a7a(0x200),{'success':_0x5fd8a1['flash'](_0x4c7a7a(0x1af)),'errors':_0x5fd8a1[_0x4c7a7a(0x28c)](_0x4c7a7a(0x279)),'role':_0x99293d,'profile':_0x4e46ba,'alldata':_0xe566d5,'master_shop':_0x44ee44,'language':_0x386915}),console[_0x4c7a7a(0x1ef)](alldata);}catch(_0x591e08){console['log'](_0x591e08);}}),router[a0_0x1c2e10(0x263)]('/barcode_scanner',async(_0x4759db,_0xc25783)=>{var _0x2895f2=a0_0x1c2e10;const {product_code:_0x69c672}=_0x4759db[_0x2895f2(0x1e5)];var _0x7d3a3a;const _0x265e8b=await product[_0x2895f2(0x1ce)]([{'$match':{'primary_code':_0x69c672,'product_category':_0x2895f2(0x1f6)}},{'$group':{'_id':_0x2895f2(0x24e),'name':{'$first':_0x2895f2(0x235)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x2895f2(0x25b)},'alertquantity':{'$first':_0x2895f2(0x1dc)},'product_code':{'$first':_0x2895f2(0x29b)},'primary_code':{'$first':_0x2895f2(0x20c)},'secondary_code':{'$first':_0x2895f2(0x201)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2895f2(0x213)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2895f2(0x1f0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x45074e=await product['aggregate']([{'$match':{'secondary_code':_0x69c672,'product_category':_0x2895f2(0x1f6)}},{'$group':{'_id':_0x2895f2(0x24e),'name':{'$first':_0x2895f2(0x235)},'category':{'$first':_0x2895f2(0x25d)},'brand':{'$first':_0x2895f2(0x1a3)},'unit':{'$first':_0x2895f2(0x25b)},'alertquantity':{'$first':_0x2895f2(0x1dc)},'product_code':{'$first':_0x2895f2(0x29b)},'primary_code':{'$first':_0x2895f2(0x20c)},'secondary_code':{'$first':_0x2895f2(0x201)},'maxStocks':{'$first':_0x2895f2(0x1cd)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x265e8b[_0x2895f2(0x198)]>0x0)_0x7d3a3a=_0x265e8b;else _0x45074e[_0x2895f2(0x198)]>0x0&&(_0x7d3a3a=_0x45074e);_0xc25783[_0x2895f2(0x228)](_0x7d3a3a);}),router[a0_0x1c2e10(0x263)](a0_0x1c2e10(0x277),async(_0x4bc58e,_0x4c8d57)=>{var _0x365481=a0_0x1c2e10;const {primaryCode:_0xb98f51,secondaryCode:_0xde5aef,productCode:_0x29682e,bay:_0x4a1b5e,bin:_0x2224a6,types:_0x4a33c4,pallet:_0x4ba31f,warehouses:_0xf25d49,room:_0x149223}=_0x4bc58e[_0x365481(0x1e5)];console[_0x365481(0x1ef)](_0x4bc58e['body']);try{const _0x5d2dde=await warehouse[_0x365481(0x1ce)]([{'$match':{'name':_0xf25d49,'room':_0x149223}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x4a1b5e,'product_details.bin':_0x2224a6,'product_details.type':_0x4a33c4}},{'$group':{'_id':_0x365481(0x1c8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x365481(0x1d5)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x365481(0x257)},'pallet':{'$first':_0x365481(0x1e3)},'maxProducts':{'$first':_0x365481(0x264)}}}]);_0x4c8d57[_0x365481(0x1d9)](0xc8)['json'](_0x5d2dde);}catch(_0x54c07a){_0x4c8d57[_0x365481(0x1d9)](0x194)[_0x365481(0x228)]({'message':_0x54c07a[_0x365481(0x258)]});}}),module['exports']=router;