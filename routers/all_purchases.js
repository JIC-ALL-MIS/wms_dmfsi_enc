var a0_0x57fcc0=a0_0x5a61;(function(_0x1c590b,_0x16e889){var _0x271a4c=a0_0x5a61,_0xa1da16=_0x1c590b();while(!![]){try{var _0x34ec5c=parseInt(_0x271a4c(0x130))/0x1*(parseInt(_0x271a4c(0x24b))/0x2)+-parseInt(_0x271a4c(0x178))/0x3*(parseInt(_0x271a4c(0x14b))/0x4)+parseInt(_0x271a4c(0x1a2))/0x5*(-parseInt(_0x271a4c(0x228))/0x6)+-parseInt(_0x271a4c(0x198))/0x7+-parseInt(_0x271a4c(0x1d1))/0x8+-parseInt(_0x271a4c(0x18d))/0x9*(parseInt(_0x271a4c(0x14e))/0xa)+parseInt(_0x271a4c(0x235))/0xb;if(_0x34ec5c===_0x16e889)break;else _0xa1da16['push'](_0xa1da16['shift']());}catch(_0x488371){_0xa1da16['push'](_0xa1da16['shift']());}}}(a0_0x1a48,0xe3ec9));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x57fcc0(0x1b9)),auth=require(a0_0x57fcc0(0x1a0)),nodemailer=require(a0_0x57fcc0(0x1ad));var ejs=require('ejs');const path=require(a0_0x57fcc0(0x1e2)),users=require(a0_0x57fcc0(0x1b6));function a0_0x5a61(_0x220c86,_0xed7add){var _0x1a4846=a0_0x1a48();return a0_0x5a61=function(_0x5a6185,_0x115c42){_0x5a6185=_0x5a6185-0x12d;var _0x429b79=_0x1a4846[_0x5a6185];return _0x429b79;},a0_0x5a61(_0x220c86,_0xed7add);}router['get']('/view',auth,async(_0x1cf655,_0x44bd42)=>{var _0x104b1e=a0_0x57fcc0;try{const {username:_0x2cdd0a,email:_0x28c4d4,role:_0x4ad624}=_0x1cf655['user'],_0x4fecb5=_0x1cf655[_0x104b1e(0x141)],_0xc8f9a=await profile['findOne']({'email':_0x4fecb5[_0x104b1e(0x173)]}),_0x12b0f1=await staff['findOne']({'email':_0x4fecb5[_0x104b1e(0x173)]});if(_0x4fecb5[_0x104b1e(0x1ae)]=='staff'){const _0x3f3dc7=await staff[_0x104b1e(0x1bc)]({'email':_0x4fecb5['email']});}const _0x28b836=await master_shop[_0x104b1e(0x180)]();let _0x11e3fa;if(_0x4fecb5[_0x104b1e(0x1ae)]==_0x104b1e(0x1be)){const _0x3a50fa=await staff[_0x104b1e(0x1bc)]({'email':_0x4fecb5[_0x104b1e(0x173)]});_0x11e3fa=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3a50fa['warehouse']}},{'$lookup':{'from':'suppliers','localField':_0x104b1e(0x192),'foreignField':_0x104b1e(0x244),'as':_0x104b1e(0x1b3)}},{'$unwind':_0x104b1e(0x1c9)},{'$unwind':_0x104b1e(0x1f5)},{'$group':{'_id':_0x104b1e(0x1f6),'invoice':{'$first':_0x104b1e(0x16e)},'suppliers':{'$first':_0x104b1e(0x24a)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x104b1e(0x148)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0x104b1e(0x22b)},'paid_amount':{'$first':_0x104b1e(0x196)},'due_amount':{'$first':_0x104b1e(0x210)},'return_data':{'$first':_0x104b1e(0x1a6)},'batch_code':{'$first':_0x104b1e(0x1ea)},'expiry_date':{'$first':_0x104b1e(0x1ba)},'suppliers_docs':{'$first':_0x104b1e(0x1c9)},'total_product_quantity':{'$sum':_0x104b1e(0x155)},'level':{'$addToSet':_0x104b1e(0x19c)},'isle':{'$addToSet':_0x104b1e(0x190)},'type':{'$addToSet':_0x104b1e(0x1de)},'floorlevel':{'$addToSet':_0x104b1e(0x231)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x11e3fa=await purchases[_0x104b1e(0x177)]([{'$lookup':{'from':_0x104b1e(0x192),'localField':'suppliers','foreignField':_0x104b1e(0x244),'as':_0x104b1e(0x1b3)}},{'$unwind':_0x104b1e(0x1c9)},{'$unwind':_0x104b1e(0x1f5)},{'$group':{'_id':_0x104b1e(0x1f6),'invoice':{'$first':_0x104b1e(0x16e)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x104b1e(0x16f)},'warehouse_name':{'$first':_0x104b1e(0x148)},'room':{'$addToSet':_0x104b1e(0x21d)},'product':{'$push':_0x104b1e(0x1f5)},'note':{'$first':_0x104b1e(0x22b)},'paid_amount':{'$first':_0x104b1e(0x196)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x104b1e(0x1a6)},'batch_code':{'$first':_0x104b1e(0x1ea)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x104b1e(0x1c9)},'total_product_quantity':{'$sum':_0x104b1e(0x155)},'level':{'$addToSet':_0x104b1e(0x19c)},'isle':{'$addToSet':_0x104b1e(0x190)},'type':{'$addToSet':_0x104b1e(0x1de)},'floorlevel':{'$addToSet':_0x104b1e(0x231)},'finalize':{'$first':_0x104b1e(0x1b0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x28b836[0x0][_0x104b1e(0x1d0)]==_0x104b1e(0x15c)){var _0x19fc58=users['English'];console['log'](_0x19fc58);}else{if(_0x28b836[0x0][_0x104b1e(0x1d0)]=='Hindi')var _0x19fc58=users['Hindi'];else{if(_0x28b836[0x0][_0x104b1e(0x1d0)]==_0x104b1e(0x1d4))var _0x19fc58=users['German'];else{if(_0x28b836[0x0]['language']==_0x104b1e(0x1f7))var _0x19fc58=users[_0x104b1e(0x1f7)];else{if(_0x28b836[0x0][_0x104b1e(0x1d0)]==_0x104b1e(0x160))var _0x19fc58=users[_0x104b1e(0x160)];else{if(_0x28b836[0x0][_0x104b1e(0x1d0)]==_0x104b1e(0x221))var _0x19fc58=users[_0x104b1e(0x170)];else{if(_0x28b836[0x0][_0x104b1e(0x1d0)]==_0x104b1e(0x1c1))var _0x19fc58=users[_0x104b1e(0x1c1)];else{if(_0x28b836[0x0][_0x104b1e(0x1d0)]=='Arabic\x20(ae)')var _0x19fc58=users[_0x104b1e(0x213)];}}}}}}}_0x44bd42[_0x104b1e(0x1cc)](_0x104b1e(0x220),{'success':_0x1cf655[_0x104b1e(0x227)](_0x104b1e(0x176)),'errors':_0x1cf655['flash'](_0x104b1e(0x242)),'purchases':_0x11e3fa,'role':_0x4fecb5,'profile':_0xc8f9a,'master_shop':_0x28b836,'language':_0x19fc58});}catch(_0x17207e){console[_0x104b1e(0x13e)]('table\x20page',_0x17207e),_0x44bd42[_0x104b1e(0x247)](0xc8)['json']({'message':_0x17207e['message']});}});function a0_0x1a48(){var _0x510212=['Paid\x20For\x20Purchase','Purchase\x20Return\x20Mail','prod_cat','JO_number','$warehouse_name','site_title','prod_level','4267388tOZLlo','bin','product','1150pqqYyR','INC-','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_code','master','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.quantity','Room_name','edit_purchases','exports','return_purchase','all','\x20Order\x20Number\x20:\x20','English\x20(US)','Email\x20sent\x20successfully','$product_details.floorlevel','prod_pallet','French','secondary_code','\x20<\x20wew\x20>\x20','/view/add_purchases/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','logo','prod_Qty','$product_details.bay','save','date','<strong>\x20Regards\x20</strong>','\x20<>\x20','stocks','add\x20post','$invoice','$date','Portuguese','post','$product_details.rack','email','$product_details.secondary_code','Level','success','aggregate','3KbaXgG','$product_details.pallet','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</td>','<!DOCTYPE\x20html>','/upload/','POnumber','find','RoomAssign','primary_code_hide','prod_qty','<tbody\x20style=\x22text-align:\x20center;\x22>','storage','purchase_invoice','actual_qty','maxStocks','$category','Error\x20Occurs','here','quantity','42678NmrJPr','</tbody>','$product_details.isle','$product.bin','return_data','suppliers','Rack\x20B','$product_details.product_code','<span\x20style=\x22float:\x20right;\x22>','$paid_amount','COLD\x20STORAGE','1878660jRVUWr','actual_uom','pallet','port','$product.bay','floorlevel','alertQTY','/give_payment/:id','../middleware/auth','add_purchases\x20error','8673235zRYmGN','RMSEmail','message','$product_details.storage','$return_data','password','$alertquantity','filter','padStart','edit_purchases_view','</head><body>','nodemailer','role','stock_data','$finalize','$product_details.type','Shelves','suppliers_docs','product_details','params','../public/language/languages.json','/../public','<h2>\x20','../models/all_models','$expiry_date','batch_code','findOne','$unit','staff','$maxProdPerUnit','back','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','body','$name','prod_primunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','delivery_date','user_id','$suppliers_docs','secondary_unit','prod_invoice','render','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','warehouse','language','7574912CmzJKc','prod_secondunit','Arabic\x20(ae)','German','abs','Logo.png','Floor','/preview/:id','type','maxperunit','suppliers_data','purchases\x20item\x20return\x20successfull','$secondary_code','$product.type','$product_details.bin','concat','An\x20error\x20occurred.','path','json','prod_code','isle','/CheckingWarehouse','rak','$product_code','</body></html>','$batch_code','return_qty','random','types','level','error','purchase\x20data\x20update\x20successfully','$product_details._id','Hindi','</div>','/view/return_purchase/:id','$product','$_id','Spanish','secondary_code_hide','English','Rack\x20E','/view/add_purchases','/all_purchases/view/','warehouse_name','delivery_code','prod_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Sales\x20Update\x20successfully','<tr>','DRY\x20STORAGE','purchase_quantity','product_code_hide','primary_code','/invoice/:id','/barcode/:id','$product_details','</h5>','Enabled','MaxStocks_data','expiry_date','prod_isle','Rack\x20F','$due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','Arabic','findById','$maxStocks','Rack\x20C','Purchase\x20Return','$product_details.level','add_purchases','paid_amount','<hr\x20class=\x22my-3\x22>','map','$product.room_name','production_date','invoice','all_purchases','Portuguese\x20(BR)','product_list','createTransport','<div>','<h5>','</span>','flash','6CpPQjK','forEach','/all_purchases/view','$note','return_product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Raw\x20Materials','$product_details.primary_code','rack','$product.floorlevel','\x20Order\x20Date\x20:\x20','currency','</tr>','46892967IhXImS','bay','finalize','amount','slice','True','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$secondary_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','Enclosed','string','host','</thead>','errors','<h5\x20style=\x22text-align:\x20left;\x22>','name','Rack\x20A','</table>','status','$product_details.product_name','foreach\x20newproduct','$suppliers','8aFqSaV','getFullYear','then','max_product_unit','room_name','308162eZTOBr','/view/:id','product_name','product_stock','standard_unit','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','length','room','toString','Rack\x20D','all_purchases_barcode','getDate','$product_details.product_stock','log','image','product_cat','user','$primary_code','get'];a0_0x1a48=function(){return _0x510212;};return a0_0x1a48();}function BayBinSelected(_0x340456,_0x39b45c){var _0x114285=a0_0x57fcc0,_0x28be5e=[],_0x101c6c=[],_0x51c87c=[],_0x2ecca1=[],_0x419213=[],_0x550ab7=[];let _0x6425d0=[];if(_0x340456==_0x114285(0x203))switch(_0x39b45c){case _0x114285(0x245):_0x28be5e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x101c6c=[0x1,0x2],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=[_0x114285(0x175),'Floor'],_0x419213=['D'],_0x550ab7=['A'];break;case _0x114285(0x193):_0x28be5e=[0x6,0x5,0x4,0x3,0x2,0x1],_0x101c6c=[0x1,0x2],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=['Level',_0x114285(0x1d7)],_0x419213=['D'],_0x550ab7=['B'];break;case _0x114285(0x1b2):_0x28be5e=[0x0],_0x101c6c=[0x0],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=[_0x114285(0x1d7)],_0x419213=['D'],_0x550ab7=['S'];break;case'Receiving\x20Area':_0x28be5e=[0x0],_0x101c6c=[0x0],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x51c87c=[_0x114285(0x1d7)],_0x419213=['D'],_0x550ab7=['R'];break;}else{if(_0x340456==_0x114285(0x197))switch(_0x39b45c){case'Rack\x20A':_0x28be5e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x101c6c=['B','F'],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=['Level',_0x114285(0x1d7)],_0x419213=['C'],_0x550ab7=['A'];break;case _0x114285(0x193):_0x28be5e=[0x5,0x4,0x3,0x2,0x1],_0x101c6c=['F','B','S'],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=['Level',_0x114285(0x1d7)],_0x419213=['C'],_0x550ab7=['B'];break;case _0x114285(0x216):_0x28be5e=[0x1,0x2,0x3,0x4,0x5],_0x101c6c=['B','F','S'],_0x2ecca1=[0x5,0x4,0x3,0x2,0x1],_0x51c87c=[_0x114285(0x175),_0x114285(0x1d7)],_0x419213=['C'],_0x550ab7=['C'];break;case _0x114285(0x13a):_0x28be5e=[0x5,0x4,0x3,0x2,0x1],_0x101c6c=['F','B','S'],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=[_0x114285(0x175),_0x114285(0x1d7)],_0x419213=['C'],_0x550ab7=['D'];break;case _0x114285(0x1fa):_0x28be5e=[0x4,0x3,0x2,0x1],_0x101c6c=[0x1,0x2],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=[_0x114285(0x175),_0x114285(0x1d7)],_0x419213=['C'],_0x550ab7=['E'];break;case _0x114285(0x20f):_0x28be5e=[0x1,0x2,0x3],_0x101c6c=[0x1,0x2],_0x2ecca1=[0x1,0x2,0x3,0x4,0x5],_0x51c87c=[_0x114285(0x175)],_0x419213=['C'],_0x550ab7=['F'];break;}}return{'levels':_0x28be5e,'Isle':_0x101c6c,'rack':_0x2ecca1,'type':_0x51c87c,'storage':_0x419213,'rak':_0x550ab7};}async function getRandom8DigitNumber(){var _0x5b1a4a=a0_0x57fcc0;const _0x20ba12=0x989680,_0x4635b3=0x5f5e0ff,_0x59a66c=Math['floor'](Math[_0x5b1a4a(0x1ec)]()*(_0x4635b3-_0x20ba12+0x1))+_0x20ba12;var _0x44ff2f;const _0x2f753a=await purchases[_0x5b1a4a(0x1bc)]({'invoice':'INC-'+_0x59a66c});return _0x2f753a&&_0x2f753a[_0x5b1a4a(0x137)]>0x0?_0x44ff2f='INC-'+_0x59a66c:_0x44ff2f=_0x5b1a4a(0x14f)+_0x59a66c,_0x44ff2f;}router[a0_0x57fcc0(0x143)](a0_0x57fcc0(0x1fb),auth,async(_0x3fbc95,_0x161f18)=>{var _0x1ca356=a0_0x57fcc0;try{const {username:_0x57e43f,email:_0x5a07f8,role:_0x42c2aa}=_0x3fbc95[_0x1ca356(0x141)],_0x1c01a7=_0x3fbc95[_0x1ca356(0x141)],_0x27d06a=await profile[_0x1ca356(0x1bc)]({'email':_0x1c01a7[_0x1ca356(0x173)]}),_0x1dfa46=await master_shop[_0x1ca356(0x180)](),_0x5b780e=await staff[_0x1ca356(0x1bc)]({'email':_0x1c01a7[_0x1ca356(0x173)]}),_0x545f02=await suppliers[_0x1ca356(0x180)]({});let _0x10ce04;if(_0x1c01a7[_0x1ca356(0x1ae)]==_0x1ca356(0x1be)){const _0x505d26=await staff[_0x1ca356(0x1bc)]({'email':_0x1c01a7[_0x1ca356(0x173)]});_0x10ce04=await warehouse[_0x1ca356(0x177)]([{'$match':{'status':'Enabled','name':_0x505d26[_0x1ca356(0x1cf)],'warehouse_category':_0x1ca356(0x22e),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x1ca356(0x1c4),'name':{'$first':_0x1ca356(0x1c4)}}}]);}else _0x10ce04=await warehouse[_0x1ca356(0x177)]([{'$match':{'status':_0x1ca356(0x20b),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1ca356(0x153)}}},{'$group':{'_id':_0x1ca356(0x1c4),'name':{'$first':_0x1ca356(0x1c4)}}}]);const _0x2de6c0=await product[_0x1ca356(0x180)]({}),_0x51eb69=await warehouse[_0x1ca356(0x180)]({'status':'Enabled'}),_0x1b7fe0=await purchases[_0x1ca356(0x180)]({}),_0x2d776e=_0x1b7fe0[_0x1ca356(0x137)]+0x1,_0x26b2f0=_0x1ca356(0x14f)+_0x2d776e[_0x1ca356(0x139)]()[_0x1ca356(0x1aa)](0x5,'0');var _0x1ef61c=['Ambient',_0x1ca356(0x23e)];if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]=='English\x20(US)')var _0x5d4172=users['English'];else{if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]==_0x1ca356(0x1f2))var _0x5d4172=users[_0x1ca356(0x1f2)];else{if(_0x1dfa46[0x0]['language']=='German')var _0x5d4172=users[_0x1ca356(0x1d4)];else{if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]=='Spanish')var _0x5d4172=users[_0x1ca356(0x1f7)];else{if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]==_0x1ca356(0x160))var _0x5d4172=users['French'];else{if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]==_0x1ca356(0x221))var _0x5d4172=users[_0x1ca356(0x170)];else{if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]==_0x1ca356(0x1c1))var _0x5d4172=users[_0x1ca356(0x1c1)];else{if(_0x1dfa46[0x0][_0x1ca356(0x1d0)]=='Arabic\x20(ae)')var _0x5d4172=users[_0x1ca356(0x213)];}}}}}}}const _0x4f8a27=getRandom8DigitNumber();_0x4f8a27[_0x1ca356(0x12d)](_0x484fdd=>{var _0xa59bf8=_0x1ca356;_0x161f18[_0xa59bf8(0x1cc)](_0xa59bf8(0x219),{'success':_0x3fbc95[_0xa59bf8(0x227)](_0xa59bf8(0x176)),'errors':_0x3fbc95[_0xa59bf8(0x227)](_0xa59bf8(0x242)),'role':_0x1c01a7,'profile':_0x27d06a,'suppliers':_0x545f02,'warehouse':_0x10ce04,'product':_0x2de6c0,'invoice':_0x484fdd,'master_shop':_0x1dfa46,'language':_0x5d4172,'find_data':_0x51eb69,'rooms_data':_0x1ef61c});})['catch'](_0x13dc5b=>{var _0x29d4dd=_0x1ca356;_0x3fbc95[_0x29d4dd(0x227)](_0x29d4dd(0x242),_0x29d4dd(0x23b)),_0x161f18[_0x29d4dd(0x212)](_0x29d4dd(0x22a));});}catch(_0xb4b025){console['log'](_0xb4b025);}}),router[a0_0x57fcc0(0x143)](a0_0x57fcc0(0x163),auth,async(_0x3ce693,_0x6c0c6a)=>{var _0x5410aa=a0_0x57fcc0;try{const _0x496261=_0x3ce693[_0x5410aa(0x1b5)]['id'];console['log'](_0x496261);const _0x17fa3f=await master_shop[_0x5410aa(0x180)]();console[_0x5410aa(0x13e)](_0x5410aa(0x152),_0x17fa3f);const _0x831d00=await product[_0x5410aa(0x1bc)]({'name':_0x496261});console[_0x5410aa(0x13e)](_0x5410aa(0x14d),_0x831d00),_0x6c0c6a[_0x5410aa(0x247)](0xc8)['json']({'product_data':_0x831d00,'master':_0x17fa3f});}catch(_0x118868){console['log'](_0x5410aa(0x1a1),_0x118868);}}),router[a0_0x57fcc0(0x171)](a0_0x57fcc0(0x1fb),auth,async(_0x346268,_0x513f9a)=>{var _0x4a69b1=a0_0x57fcc0;try{const {invoice:_0x54d262,date:_0x33ba87,warehouse_name:_0x813a94,prod_name:_0x39a062,prod_code:_0x33f821,prod_qty:_0x440aaa,prod_unit:_0x32f1c0,prod_secondunit:_0x2183de,prod_level:_0xefacd7,prod_isle:_0xe3d9e0,prod_pallet:_0x4459a7,note:_0x4e9b2d,expiry_date:_0x52efd6,batch_code:_0x582421,payable:_0x821e8d,due_amount:_0x1c787d,Room_name:_0x323d81,primary_code:_0x13fa95,secondary_code:_0x3ce37c,MaxStocks_data:_0x303f2f,PO_number:_0x3d1718,SCRN:_0x24c88c,JO_number:_0x3a2184}=_0x346268['body'];if(typeof _0x39a062==_0x4a69b1(0x23f))var _0x3ec159=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x1ff)]],_0x58e8b2=[_0x346268[_0x4a69b1(0x1c3)]['prod_code']],_0x5d901b=[_0x346268['body'][_0x4a69b1(0x166)]],_0x2f997f=[_0x346268['body'][_0x4a69b1(0x1c5)]],_0x138ade=[_0x346268[_0x4a69b1(0x1c3)]['prod_secondunit']],_0x5206d9=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x14a)]],_0x111659=[_0x346268[_0x4a69b1(0x1c3)]['primary_code']],_0x30e49b=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x161)]],_0x4790ea=[_0x346268['body'][_0x4a69b1(0x20c)]],_0x43f359=[_0x346268['body']['batch_code']],_0x5ae0e5=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x20d)]],_0xfbffe0=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x12e)]],_0x4e93a0=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x19e)]],_0x25e7fc=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x21e)]],_0xd9a92c=[_0x346268[_0x4a69b1(0x1c3)]['prod_cat']],_0x3b8698=[_0x346268[_0x4a69b1(0x1c3)]['RoomAssign']],_0x4074d8=[_0x346268['body']['deliverycode']],_0x278339=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x1cb)]],_0x220348=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x187)]],_0x1bf828=[_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x199)]];else var _0x3ec159=[..._0x346268['body'][_0x4a69b1(0x1ff)]],_0x58e8b2=[..._0x346268['body']['prod_code']],_0x5d901b=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x166)]],_0x2f997f=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x1c5)]],_0x138ade=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x1d2)]],_0x5206d9=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x14a)]],_0x111659=[..._0x346268['body'][_0x4a69b1(0x206)]],_0x30e49b=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x161)]],_0x4790ea=[..._0x346268[_0x4a69b1(0x1c3)]['MaxStocks_data']],_0x43f359=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x1bb)]],_0x5ae0e5=[..._0x346268['body']['expiry_date']],_0xfbffe0=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x12e)]],_0x4e93a0=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x19e)]],_0x25e7fc=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x21e)]],_0xd9a92c=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x146)]],_0x3b8698=[..._0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x181)]],_0x4074d8=[..._0x346268['body']['deliverycode']],_0x278339=[..._0x346268['body'][_0x4a69b1(0x1cb)]],_0x220348=[..._0x346268['body'][_0x4a69b1(0x187)]],_0x1bf828=[..._0x346268[_0x4a69b1(0x1c3)]['actual_uom']];const _0x8be6a4=_0x3ec159[_0x4a69b1(0x21c)](_0x1dde35=>{return _0x1dde35={'product_name':_0x1dde35};});_0x220348[_0x4a69b1(0x229)]((_0x3ce944,_0x471461)=>{_0x8be6a4[_0x471461]['actual_qty']=Math['abs'](_0x3ce944);}),_0x1bf828[_0x4a69b1(0x229)]((_0x136156,_0x354692)=>{var _0x4f363e=_0x4a69b1;_0x8be6a4[_0x354692][_0x4f363e(0x199)]=_0x136156;}),_0x58e8b2[_0x4a69b1(0x229)]((_0x1b7c1e,_0x1c1fda)=>{var _0xb78407=_0x4a69b1;_0x8be6a4[_0x1c1fda][_0xb78407(0x151)]=_0x1b7c1e;}),_0x5d901b[_0x4a69b1(0x229)]((_0x41ae84,_0x39dce9)=>{_0x8be6a4[_0x39dce9]['quantity']=Math['abs'](_0x41ae84);}),_0x2f997f[_0x4a69b1(0x229)]((_0x219280,_0xebbf06)=>{var _0x23e66a=_0x4a69b1;_0x8be6a4[_0xebbf06][_0x23e66a(0x134)]=_0x219280;}),_0x138ade[_0x4a69b1(0x229)]((_0x5480af,_0xe3ceeb)=>{var _0x157057=_0x4a69b1;_0x8be6a4[_0xe3ceeb][_0x157057(0x1ca)]=_0x5480af;}),_0x5206d9['forEach']((_0x228bf9,_0x301b37)=>{var _0x35ec26=_0x4a69b1;_0x3b8698[_0x35ec26(0x229)]((_0x662b81,_0x3e8198)=>{var _0x51a4bf=_0x35ec26;if(_0x662b81=='Receiving\x20Area'&&_0x301b37==_0x3e8198){console[_0x51a4bf(0x13e)](_0x662b81+_0x51a4bf(0x162)+_0x301b37+_0x51a4bf(0x16b)+_0x3e8198+'\x20<>\x20'+_0x228bf9);var _0x1572a5=_0x228bf9[_0x51a4bf(0x239)](0x3);_0x8be6a4[_0x301b37]['storage']=_0x228bf9[0x0],_0x8be6a4[_0x301b37][_0x51a4bf(0x230)]=_0x228bf9[0x1],_0x8be6a4[_0x301b37][_0x51a4bf(0x236)]=0x0,_0x8be6a4[_0x301b37][_0x51a4bf(0x14c)]=0x0,_0x8be6a4[_0x301b37][_0x51a4bf(0x1d9)]=_0x51a4bf(0x1d7),_0x8be6a4[_0x301b37][_0x51a4bf(0x19d)]=_0x1572a5;}else{if(_0x662b81==_0x51a4bf(0x1b2)&&_0x301b37==_0x3e8198){var _0x1572a5=_0x228bf9['slice'](0x3);_0x8be6a4[_0x301b37]['storage']=_0x228bf9[0x0],_0x8be6a4[_0x301b37][_0x51a4bf(0x230)]=_0x228bf9[0x1],_0x8be6a4[_0x301b37][_0x51a4bf(0x236)]=0x0,_0x8be6a4[_0x301b37][_0x51a4bf(0x14c)]=0x0,_0x8be6a4[_0x301b37][_0x51a4bf(0x1d9)]=_0x51a4bf(0x1d7),_0x8be6a4[_0x301b37][_0x51a4bf(0x19d)]=_0x228bf9[0x5];}else{if(_0x301b37==_0x3e8198){if(_0x228bf9[0x0]=='A'&&_0x228bf9[0x1]=='L'&&_0x228bf9[0x2]=='L')console['log'](_0x662b81+_0x51a4bf(0x16b)+_0x301b37+_0x51a4bf(0x16b)+_0x3e8198+'\x20<>\x20'+_0x228bf9+_0x51a4bf(0x18b)),_0x8be6a4[_0x301b37]['storage']=_0x228bf9[0x0],_0x8be6a4[_0x301b37][_0x51a4bf(0x230)]=_0x228bf9[0x1],_0x8be6a4[_0x301b37][_0x51a4bf(0x236)]=0x0,_0x8be6a4[_0x301b37][_0x51a4bf(0x14c)]=0x0,_0x8be6a4[_0x301b37][_0x51a4bf(0x1d9)]=_0x51a4bf(0x1d7),_0x8be6a4[_0x301b37][_0x51a4bf(0x19d)]=_0x228bf9[0x3];else{var _0x4cc4c6;if(_0x228bf9[0x4]=='L')_0x4cc4c6=_0x51a4bf(0x175);else _0x228bf9[0x4]=='F'&&(_0x4cc4c6=_0x51a4bf(0x1d7));_0x8be6a4[_0x301b37][_0x51a4bf(0x185)]=_0x228bf9[0x0],_0x8be6a4[_0x301b37][_0x51a4bf(0x230)]=_0x228bf9[0x1],_0x8be6a4[_0x301b37][_0x51a4bf(0x236)]=_0x228bf9[0x2],_0x8be6a4[_0x301b37][_0x51a4bf(0x14c)]=_0x228bf9[0x3],_0x8be6a4[_0x301b37][_0x51a4bf(0x1d9)]=_0x4cc4c6,_0x8be6a4[_0x301b37][_0x51a4bf(0x19d)]=_0x228bf9[0x5];}}}}});}),_0x111659['forEach']((_0x356a7b,_0x96cd3b)=>{var _0xded300=_0x4a69b1;_0x8be6a4[_0x96cd3b][_0xded300(0x206)]=_0x356a7b;}),_0x30e49b[_0x4a69b1(0x229)]((_0x424549,_0x16ccdc)=>{_0x8be6a4[_0x16ccdc]['secondary_code']=_0x424549;}),_0x4790ea['forEach']((_0x8427a1,_0x3dd895)=>{_0x8be6a4[_0x3dd895]['maxStocks']=_0x8427a1;}),_0x43f359[_0x4a69b1(0x229)]((_0x19a5fc,_0x11bc36)=>{var _0x5f1ffd=_0x4a69b1;_0x8be6a4[_0x11bc36][_0x5f1ffd(0x1bb)]=_0x19a5fc;}),_0x5ae0e5[_0x4a69b1(0x229)]((_0x52673b,_0x4ccd2e)=>{var _0x417f97=_0x4a69b1;_0x8be6a4[_0x4ccd2e][_0x417f97(0x20d)]=_0x52673b;}),_0xfbffe0['forEach']((_0x28e965,_0x51f252)=>{var _0x21b93c=_0x4a69b1;_0x8be6a4[_0x51f252][_0x21b93c(0x1da)]=_0x28e965;}),_0x4e93a0[_0x4a69b1(0x229)]((_0x45bb9a,_0x254f58)=>{var _0x24835b=_0x4a69b1;_0x8be6a4[_0x254f58][_0x24835b(0x19e)]=_0x45bb9a;}),_0x25e7fc[_0x4a69b1(0x229)]((_0x482f8b,_0x2f1751)=>{var _0x20e3d3=_0x4a69b1;_0x8be6a4[_0x2f1751][_0x20e3d3(0x21e)]=_0x482f8b;}),_0xd9a92c['forEach']((_0x5ade98,_0x2d563d)=>{var _0x3d3457=_0x4a69b1;_0x8be6a4[_0x2d563d][_0x3d3457(0x140)]=_0x5ade98;}),_0x3b8698[_0x4a69b1(0x229)]((_0x4f227b,_0x2f9180)=>{var _0x39bea5=_0x4a69b1;_0x8be6a4[_0x2f9180][_0x39bea5(0x12f)]=_0x4f227b;}),_0x4074d8['forEach']((_0x5e7c30,_0x302e42)=>{var _0xec1a64=_0x4a69b1;_0x8be6a4[_0x302e42][_0xec1a64(0x1fe)]=_0x5e7c30;}),_0x278339[_0x4a69b1(0x229)]((_0x108c88,_0x2270c8)=>{var _0x461f1c=_0x4a69b1;_0x8be6a4[_0x2270c8][_0x461f1c(0x21f)]=_0x108c88;});const _0x2f2b82=_0x3b8698[_0x4a69b1(0x21c)](_0x80b26c=>{return _0x80b26c={'room_name':_0x80b26c};}),_0x3cb101=_0x8be6a4[_0x4a69b1(0x1a9)](_0x789082=>_0x789082[_0x4a69b1(0x18c)]!=='0'&&_0x789082['quantity']!==''),_0x2d6703=new purchases({'invoice':_0x54d262,'suppliers':_0x346268[_0x4a69b1(0x1c3)][_0x4a69b1(0x192)],'date':_0x33ba87,'warehouse_name':_0x813a94,'product':_0x3cb101,'note':_0x4e9b2d,'due_amount':_0x1c787d,'POnumber':_0x3d1718,'SCRN':_0x24c88c,'JO_number':_0x3a2184,'roomList':_0x2f2b82}),_0x56d4ff=await _0x2d6703[_0x4a69b1(0x168)](),_0x2f516c=await purchases[_0x4a69b1(0x1bc)]({'invoice':_0x54d262}),_0x9a145b=_0x2f516c[_0x4a69b1(0x14d)][_0x4a69b1(0x21c)](async _0x287420=>{var _0x53a226=_0x4a69b1,_0xb6434=await warehouse[_0x53a226(0x1bc)]({'name':_0x813a94,'room':_0x287420['room_name']}),_0x3c14e7=0x0;return _0xb6434['product_details']['forEach'](_0x3d7bab=>{var _0x4dca8a=_0x53a226;_0x3d7bab['product_name']==_0x287420[_0x4dca8a(0x132)]&&_0x3d7bab[_0x4dca8a(0x19d)]==_0x287420[_0x4dca8a(0x19d)]&&_0x3d7bab[_0x4dca8a(0x1d9)]==_0x287420[_0x4dca8a(0x1d9)]&&_0x3d7bab['bin']==_0x287420['bin']&&_0x3d7bab[_0x4dca8a(0x236)]==_0x287420[_0x4dca8a(0x236)]&&_0x3d7bab[_0x4dca8a(0x230)]==_0x287420[_0x4dca8a(0x230)]&&_0x3d7bab[_0x4dca8a(0x185)]==_0x287420[_0x4dca8a(0x185)]&&_0x3d7bab['expiry_date']==_0x287420['expiry_date']&&_0x3d7bab[_0x4dca8a(0x1bb)]==_0x287420[_0x4dca8a(0x1bb)]&&_0x3d7bab[_0x4dca8a(0x21e)]==_0x287420[_0x4dca8a(0x21e)]&&_0x3d7bab[_0x4dca8a(0x21f)]==_0x2f516c[_0x4dca8a(0x21f)]&&(_0x3d7bab[_0x4dca8a(0x133)]+=Math[_0x4dca8a(0x1d5)](_0x287420[_0x4dca8a(0x18c)]),_0x3c14e7++);}),_0x3c14e7===0x0&&_0xb6434[_0x53a226(0x1b4)]['push']({'product_name':_0x287420['product_name'],'product_stock':Math[_0x53a226(0x1d5)](_0x287420[_0x53a226(0x18c)]),'primary_code':_0x287420[_0x53a226(0x206)],'secondary_code':_0x287420['secondary_code'],'product_code':_0x287420[_0x53a226(0x151)],'storage':_0x287420['storage'],'rack':_0x287420['rack'],'bay':_0x287420[_0x53a226(0x236)],'bin':_0x287420[_0x53a226(0x14c)],'type':_0x287420['type'],'floorlevel':_0x287420[_0x53a226(0x19d)],'maxProducts':_0x287420[_0x53a226(0x188)],'unit':_0x287420[_0x53a226(0x134)],'secondary_unit':_0x287420[_0x53a226(0x1ca)],'expiry_date':_0x287420[_0x53a226(0x20d)],'maxPerUnit':_0x287420[_0x53a226(0x1da)],'batch_code':_0x287420['batch_code'],'alertQTY':_0x287420[_0x53a226(0x19e)],'production_date':_0x287420[_0x53a226(0x21e)],'product_cat':_0x287420[_0x53a226(0x140)],'invoice':_0x287420['invoice'],'actual_qty':Math[_0x53a226(0x1d5)](_0x287420[_0x53a226(0x187)]),'actual_uom':_0x287420[_0x53a226(0x199)]}),_0xb6434;});Promise[_0x4a69b1(0x15a)](_0x9a145b)['then'](async _0x58401f=>{var _0xf73185=_0x4a69b1;try{for(const _0x35ea03 of _0x58401f){await _0x35ea03[_0xf73185(0x168)]();}const _0x498336=await master_shop['find'](),_0x1f9bd5=await email_settings[_0xf73185(0x1bc)](),_0x45c9f2=await supervisor_settings[_0xf73185(0x180)]();var _0x3e45a4=_0x2f516c[_0xf73185(0x14d)],_0x5610f6='',_0x5cf793;for(_0x5cf793 in _0x3e45a4){_0x5610f6+=_0xf73185(0x202)+_0xf73185(0x1cd)+_0x3e45a4[_0x5cf793][_0xf73185(0x132)]+_0xf73185(0x17c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e45a4[_0x5cf793]['product_code']+'</td>'+_0xf73185(0x1cd)+_0x3e45a4[_0x5cf793][_0xf73185(0x18c)]+'</td>'+_0xf73185(0x1cd)+_0x3e45a4[_0x5cf793]['standard_unit']+_0xf73185(0x17c)+_0xf73185(0x1cd)+_0x3e45a4[_0x5cf793][_0xf73185(0x1ca)]+_0xf73185(0x17c)+_0xf73185(0x1cd)+_0x2f516c[_0xf73185(0x1fd)]+_0xf73185(0x17c)+_0xf73185(0x1cd)+_0x3e45a4[_0x5cf793][_0xf73185(0x12f)]+_0xf73185(0x17c)+_0xf73185(0x1cd)+_0x3e45a4[_0x5cf793][_0xf73185(0x185)]+_0x3e45a4[_0x5cf793][_0xf73185(0x230)]+_0x3e45a4[_0x5cf793][_0xf73185(0x236)]+_0x3e45a4[_0x5cf793]['bin']+_0x3e45a4[_0x5cf793][_0xf73185(0x1d9)][0x0]+_0x3e45a4[_0x5cf793][_0xf73185(0x19d)]+_0xf73185(0x17c),_0xf73185(0x234);}let _0x8e214b=nodemailer['createTransport']({'host':_0x1f9bd5[_0xf73185(0x240)],'port':Number(_0x1f9bd5[_0xf73185(0x19b)]),'secure':![],'auth':{'user':_0x1f9bd5['email'],'pass':_0x1f9bd5[_0xf73185(0x1a7)]}}),_0x16f5fa={'from':_0x1f9bd5['email'],'to':_0x45c9f2[0x0][_0xf73185(0x1a3)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0xf73185(0x1b7)+_0xf73185(0x17e)+_0x498336[0x0][_0xf73185(0x13f)],'cid':_0xf73185(0x165)}],'html':_0xf73185(0x17d)+'<html><head><title></title>'+_0xf73185(0x1ac)+_0xf73185(0x224)+_0xf73185(0x1ce)+'<div>'+_0xf73185(0x200)+_0xf73185(0x1f3)+_0xf73185(0x224)+'<h2>\x20'+_0x498336[0x0][_0xf73185(0x149)]+'\x20</h2>'+_0xf73185(0x1f3)+_0xf73185(0x1f3)+'<hr\x20class=\x22my-3\x22>'+_0xf73185(0x224)+_0xf73185(0x243)+'\x20Order\x20Number\x20:\x20'+_0x2f516c[_0xf73185(0x21f)]+'\x20'+_0xf73185(0x195)+'\x20Order\x20Date\x20:\x20'+_0x2f516c[_0xf73185(0x169)]+'\x20'+_0xf73185(0x226)+_0xf73185(0x20a)+'</div>'+_0xf73185(0x150)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0xf73185(0x1c6)+_0xf73185(0x1c2)+_0xf73185(0x136)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0xf73185(0x211)+_0xf73185(0x22d)+_0xf73185(0x17b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xf73185(0x234)+_0xf73185(0x241)+_0xf73185(0x184)+'\x20'+_0x5610f6+'\x20'+'</tbody>'+'</table>'+_0xf73185(0x224)+_0xf73185(0x16a)+_0xf73185(0x225)+_0x498336[0x0][_0xf73185(0x149)]+'</h5>'+'</div>'+_0xf73185(0x1f3)+_0xf73185(0x1e9)};_0x8e214b[_0xf73185(0x17a)](_0x16f5fa,function(_0x589e47,_0x512b2a){var _0x20c172=_0xf73185;_0x589e47?(console[_0x20c172(0x13e)](_0x589e47),console[_0x20c172(0x13e)](_0x20c172(0x18a))):console[_0x20c172(0x13e)](_0x20c172(0x15d));}),_0x346268[_0xf73185(0x227)](_0xf73185(0x176),'Purchase\x20data\x20added\x20successfully'),_0x513f9a['redirect'](_0xf73185(0x1fc));}catch(_0x359b04){console[_0xf73185(0x1ef)](_0x359b04),_0x513f9a[_0xf73185(0x247)](0x1f4)[_0xf73185(0x1e3)]({'error':_0xf73185(0x23d)});}})['catch'](_0x4cfc5e=>{var _0x4c839e=_0x4a69b1;console[_0x4c839e(0x1ef)](_0x4cfc5e),_0x513f9a[_0x4c839e(0x247)](0x1f4)[_0x4c839e(0x1e3)]({'error':_0x4c839e(0x1e1)});});}catch(_0x327abe){console[_0x4a69b1(0x13e)](_0x327abe);}}),router[a0_0x57fcc0(0x143)](a0_0x57fcc0(0x1d8),auth,async(_0x3504ac,_0x26eec1)=>{var _0x42fc3c=a0_0x57fcc0;try{const {username:_0x20bdd3,email:_0xb3f9f,role:_0x1e9a15}=_0x3504ac[_0x42fc3c(0x141)],_0x26ae46=_0x3504ac[_0x42fc3c(0x141)],_0x572b94=await profile[_0x42fc3c(0x1bc)]({'email':_0x26ae46[_0x42fc3c(0x173)]}),_0x5531ca=await master_shop[_0x42fc3c(0x180)](),_0x55dfb8=_0x3504ac[_0x42fc3c(0x1b5)]['id'],_0x5bff0c=await purchases[_0x42fc3c(0x214)](_0x55dfb8),_0x7f8d5e=await warehouse['aggregate']([{'$match':{'name':_0x5bff0c['warehouse_name'],'room':_0x5bff0c[_0x42fc3c(0x138)]}},{'$unwind':_0x42fc3c(0x209)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x42fc3c(0x248)},'product_stock':{'$first':_0x42fc3c(0x13d)},'bay':{'$first':_0x42fc3c(0x167)},'bin':{'$first':_0x42fc3c(0x1df)},'type':{'$first':_0x42fc3c(0x1b1)},'floorlevel':{'$first':_0x42fc3c(0x15e)},'primary_code':{'$first':_0x42fc3c(0x22f)},'secondary_code':{'$first':_0x42fc3c(0x174)},'product_code':{'$first':_0x42fc3c(0x194)},'storage':{'$first':_0x42fc3c(0x1a5)},'rack':{'$first':_0x42fc3c(0x172)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x1107dc=await customer[_0x42fc3c(0x180)]({});let _0x2557d9;if(_0x26ae46[_0x42fc3c(0x1ae)]==_0x42fc3c(0x1be)){const _0x328b5d=await staff['findOne']({'email':_0x26ae46[_0x42fc3c(0x173)]});_0x2557d9=await warehouse[_0x42fc3c(0x177)]([{'$match':{'status':_0x42fc3c(0x20b),'name':_0x328b5d[_0x42fc3c(0x1cf)]}},{'$group':{'_id':_0x42fc3c(0x1c4),'name':{'$first':_0x42fc3c(0x1c4)}}}]);}else _0x2557d9=await warehouse[_0x42fc3c(0x177)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x42fc3c(0x1c4),'name':{'$first':'$name'}}}]);const _0xb21644=await product['find']({}),_0x4075a2=await suppliers[_0x42fc3c(0x180)]({}),_0x165624=BayBinSelected(_0x5bff0c[_0x42fc3c(0x1fd)],_0x5bff0c[_0x42fc3c(0x138)]);if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]=='English\x20(US)'){var _0x960ba6=users['English'];console[_0x42fc3c(0x13e)](_0x960ba6);}else{if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]=='Hindi')var _0x960ba6=users[_0x42fc3c(0x1f2)];else{if(_0x5531ca[0x0]['language']=='German')var _0x960ba6=users[_0x42fc3c(0x1d4)];else{if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]==_0x42fc3c(0x1f7))var _0x960ba6=users[_0x42fc3c(0x1f7)];else{if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]==_0x42fc3c(0x160))var _0x960ba6=users[_0x42fc3c(0x160)];else{if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]==_0x42fc3c(0x221))var _0x960ba6=users['Portuguese'];else{if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]=='Chinese')var _0x960ba6=users[_0x42fc3c(0x1c1)];else{if(_0x5531ca[0x0][_0x42fc3c(0x1d0)]==_0x42fc3c(0x1d3))var _0x960ba6=users[_0x42fc3c(0x213)];}}}}}}}_0x26eec1[_0x42fc3c(0x1cc)](_0x42fc3c(0x1ab),{'success':_0x3504ac[_0x42fc3c(0x227)](_0x42fc3c(0x176)),'errors':_0x3504ac['flash'](_0x42fc3c(0x242)),'role':_0x26ae46,'profile':_0x572b94,'customer':_0x1107dc,'warehouse':_0x2557d9,'product':_0x7f8d5e,'user':_0x5bff0c,'master_shop':_0x5531ca,'unit':_0xb21644,'language':_0x960ba6,'suppliers':_0x4075a2,'dataSelected':_0x165624});}catch(_0x312c20){console[_0x42fc3c(0x13e)](_0x312c20);}}),router['post']('/preview/:id',auth,async(_0x16788d,_0x4315b)=>{var _0x330860=a0_0x57fcc0;try{const _0xd88ce5=_0x16788d[_0x330860(0x1b5)]['id'],{invoice:_0x3dd01a,warehouse_name:_0x48f4ca,Room_name:_0x1cbc43}=_0x16788d[_0x330860(0x1c3)],_0x469443=await warehouse[_0x330860(0x1bc)]({'name':_0x48f4ca,'room':_0x1cbc43}),_0x4545e6=await purchases['findOne']({'invoice':_0x3dd01a});_0x4545e6[_0x330860(0x14d)][_0x330860(0x229)](_0x10fb15=>{var _0xce9d48=_0x330860,_0x3a9aea=0x0;const _0x42bff3=_0x469443[_0xce9d48(0x1b4)][_0xce9d48(0x21c)](_0x2f613f=>{var _0x2ec5a6=_0xce9d48;_0x2f613f[_0x2ec5a6(0x132)]==_0x10fb15[_0x2ec5a6(0x132)]&&_0x2f613f[_0x2ec5a6(0x19d)]==_0x10fb15[_0x2ec5a6(0x19d)]&&_0x2f613f['type']==_0x10fb15[_0x2ec5a6(0x1d9)]&&_0x2f613f[_0x2ec5a6(0x14c)]==_0x10fb15[_0x2ec5a6(0x14c)]&&_0x2f613f[_0x2ec5a6(0x236)]==_0x10fb15['bay']&&_0x2f613f['rack']==_0x10fb15[_0x2ec5a6(0x230)]&&_0x2f613f[_0x2ec5a6(0x185)]==_0x10fb15[_0x2ec5a6(0x185)]&&_0x2f613f[_0x2ec5a6(0x20d)]==_0x10fb15[_0x2ec5a6(0x20d)]&&_0x2f613f['batch_code']==_0x10fb15['batch_code']&&_0x2f613f[_0x2ec5a6(0x21e)]==_0x10fb15[_0x2ec5a6(0x21e)]&&_0x2f613f[_0x2ec5a6(0x1c7)]==_0x10fb15[_0x2ec5a6(0x1c7)]&&_0x2f613f[_0x2ec5a6(0x1fe)]==_0x10fb15[_0x2ec5a6(0x1fe)]&&(_0x2f613f[_0x2ec5a6(0x133)]=parseInt(_0x2f613f[_0x2ec5a6(0x133)])+parseInt(_0x10fb15[_0x2ec5a6(0x18c)]),_0x3a9aea++);});_0x3a9aea=='0'&&(_0x469443[_0xce9d48(0x1b4)]=_0x469443['product_details'][_0xce9d48(0x1e0)]({'product_name':_0x10fb15['product_name'],'product_stock':_0x10fb15[_0xce9d48(0x18c)],'primary_code':_0x10fb15[_0xce9d48(0x206)],'secondary_code':_0x10fb15[_0xce9d48(0x161)],'product_code':_0x10fb15[_0xce9d48(0x151)],'storage':_0x10fb15[_0xce9d48(0x185)],'rack':_0x10fb15['rack'],'bay':_0x10fb15[_0xce9d48(0x236)],'bin':_0x10fb15[_0xce9d48(0x14c)],'type':_0x10fb15[_0xce9d48(0x1d9)],'floorlevel':_0x10fb15['floorlevel'],'maxProducts':_0x10fb15['maxStocks'],'unit':_0x10fb15['standard_unit'],'secondary_unit':_0x10fb15[_0xce9d48(0x1ca)],'expiry_date':_0x10fb15[_0xce9d48(0x20d)],'maxPerUnit':_0x10fb15[_0xce9d48(0x1da)],'batch_code':_0x10fb15[_0xce9d48(0x1bb)],'alertQTY':_0x10fb15[_0xce9d48(0x19e)],'production_date':_0x10fb15[_0xce9d48(0x21e)],'delivery_date':_0x10fb15['delivery_date'],'delivery_code':_0x10fb15['delivery_code']}));}),await _0x469443[_0x330860(0x168)](),_0x4545e6[_0x330860(0x237)]='True';const _0x5297b8=await _0x4545e6[_0x330860(0x168)]();_0x16788d[_0x330860(0x227)](_0x330860(0x176),_0x330860(0x201)),_0x4315b[_0x330860(0x212)](_0x330860(0x22a));}catch(_0x4ba7cd){console[_0x330860(0x13e)](_0x4ba7cd);}}),router[a0_0x57fcc0(0x143)](a0_0x57fcc0(0x131),auth,async(_0x3a305f,_0xeef07b)=>{var _0x44850b=a0_0x57fcc0;try{const {username:_0x3e293b,email:_0x5a53a9,role:_0x3b7d7e}=_0x3a305f[_0x44850b(0x141)],_0x45bb5a=_0x3a305f[_0x44850b(0x141)],_0x433c4e=await profile[_0x44850b(0x1bc)]({'email':_0x45bb5a[_0x44850b(0x173)]}),_0x232564=await master_shop[_0x44850b(0x180)](),_0x3727d3=_0x3a305f['params']['id'],_0xac08e=await purchases[_0x44850b(0x214)](_0x3727d3),_0x37983b=await suppliers[_0x44850b(0x180)]({});let _0x216cc6;if(_0x45bb5a['role']==_0x44850b(0x1be)){const _0x4401e4=await staff[_0x44850b(0x1bc)]({'email':_0x45bb5a[_0x44850b(0x173)]});_0x216cc6=await warehouse['find']({'status':_0x44850b(0x20b),'name':_0x4401e4[_0x44850b(0x1cf)],'warehouse_category':'Raw\x20Materials'});}else _0x216cc6=await warehouse[_0x44850b(0x177)]([{'$match':{'status':'Enabled','warehouse_category':_0x44850b(0x22e)}},{'$group':{'_id':_0x44850b(0x1c4),'name':{'$first':_0x44850b(0x1c4)}}}]);const _0x129280=await product[_0x44850b(0x180)]({}),_0x161971=BayBinSelected(_0xac08e[_0x44850b(0x1fd)],_0xac08e[_0x44850b(0x138)]);let _0xc89764=new Date(_0xac08e['expiry_date']),_0x265a2a=('0'+_0xc89764[_0x44850b(0x13c)]())['slice'](-0x2),_0x2193a5=('0'+(_0xc89764['getMonth']()+0x1))[_0x44850b(0x239)](-0x2),_0x46bba2=_0xc89764[_0x44850b(0x24c)](),_0x59fca4=_0x46bba2+'-'+_0x2193a5+'-'+_0x265a2a;if(_0x232564[0x0][_0x44850b(0x1d0)]==_0x44850b(0x15c)){var _0x31b1a0=users[_0x44850b(0x1f9)];console[_0x44850b(0x13e)](_0x31b1a0);}else{if(_0x232564[0x0][_0x44850b(0x1d0)]==_0x44850b(0x1f2))var _0x31b1a0=users[_0x44850b(0x1f2)];else{if(_0x232564[0x0][_0x44850b(0x1d0)]==_0x44850b(0x1d4))var _0x31b1a0=users[_0x44850b(0x1d4)];else{if(_0x232564[0x0]['language']==_0x44850b(0x1f7))var _0x31b1a0=users['Spanish'];else{if(_0x232564[0x0][_0x44850b(0x1d0)]==_0x44850b(0x160))var _0x31b1a0=users[_0x44850b(0x160)];else{if(_0x232564[0x0]['language']==_0x44850b(0x221))var _0x31b1a0=users[_0x44850b(0x170)];else{if(_0x232564[0x0][_0x44850b(0x1d0)]=='Chinese')var _0x31b1a0=users[_0x44850b(0x1c1)];else{if(_0x232564[0x0][_0x44850b(0x1d0)]=='Arabic\x20(ae)')var _0x31b1a0=users['Arabic'];}}}}}}}_0xeef07b['render'](_0x44850b(0x157),{'success':_0x3a305f[_0x44850b(0x227)]('success'),'errors':_0x3a305f[_0x44850b(0x227)](_0x44850b(0x242)),'role':_0x45bb5a,'profile':_0x433c4e,'purchases':_0xac08e,'suppliers':_0x37983b,'warehouse':_0x216cc6,'product':_0x129280,'master_shop':_0x232564,'language':_0x31b1a0,'ed_fullDate':_0x59fca4,'dataSelected':_0x161971});}catch(_0x2474f6){console['log'](_0x2474f6);}}),router[a0_0x57fcc0(0x171)](a0_0x57fcc0(0x131),auth,async(_0x16703b,_0x54fc7d)=>{var _0x3d0bca=a0_0x57fcc0;try{const _0x1d285e=_0x16703b['params']['id'],_0x485f20=await purchases['findOne']({'_id':_0x16703b[_0x3d0bca(0x1b5)]['id']}),_0x1b0772=await warehouse[_0x3d0bca(0x1bc)]({'name':_0x485f20[_0x3d0bca(0x1fd)],'room':_0x485f20[_0x3d0bca(0x138)]});_0x485f20[_0x3d0bca(0x14d)]['forEach'](_0x211923=>{var _0x3c1517=_0x3d0bca;const _0x2f0032=_0x1b0772[_0x3c1517(0x1b4)][_0x3c1517(0x21c)](_0x559b4b=>{var _0x572e09=_0x3c1517;_0x559b4b[_0x572e09(0x132)]==_0x211923[_0x572e09(0x132)]&&_0x559b4b[_0x572e09(0x19d)]==_0x211923[_0x572e09(0x19d)]&&_0x559b4b['type']==_0x211923['type']&&_0x559b4b[_0x572e09(0x14c)]==_0x211923[_0x572e09(0x14c)]&&_0x559b4b['bay']==_0x211923['bay']&&_0x559b4b[_0x572e09(0x230)]==_0x211923[_0x572e09(0x230)]&&_0x559b4b[_0x572e09(0x185)]==_0x211923[_0x572e09(0x185)]&&(_0x559b4b[_0x572e09(0x133)]=parseInt(_0x559b4b[_0x572e09(0x133)])-parseInt(_0x211923[_0x572e09(0x18c)]));});}),await _0x1b0772[_0x3d0bca(0x168)]();const {invoice:_0x335cc6,suppliers:_0x226b41,date:_0x5380fd,warehouse_name:_0x2528f6,prod_name:_0x1f0b4d,prod_code:_0x2ea22b,prod_qty:_0x301e2d,prod_unit:_0x56bb9d,prod_secondunit:_0x1d4a19,prod_level:_0xafd666,prod_isle:_0x1009f2,prod_pallet:_0x1c22ab,note:_0x2d7e92,expiry_date:_0x4339a1,batch_code:_0x20a0bc,paid_amount:_0x155f1a,due_amount:_0xd11b5c,Room_name:_0x6e8c57,primary_code:_0x2bd821,secondary_code:_0x4bf77f,PO_number:_0x51b17e,JO_number:_0x3c60fb}=_0x16703b['body'];if(typeof _0x1f0b4d==_0x3d0bca(0x23f))var _0x16a402=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1ff)]],_0x5c6c84=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1e4)]],_0x4da62f=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x183)]],_0x334253=[_0x16703b[_0x3d0bca(0x1c3)]['prod_unit']],_0x14c682=[_0x16703b[_0x3d0bca(0x1c3)]['prod_secondunit']],_0x560f2c=[_0x16703b[_0x3d0bca(0x1c3)]['prod_level']],_0x17c2e2=[_0x16703b['body'][_0x3d0bca(0x20e)]],_0xbc8e18=[_0x16703b[_0x3d0bca(0x1c3)]['prod_pallet']],_0x39f53b=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x206)]],_0x36bfc1=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x161)]],_0x1697c5=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x20c)]],_0x25c827=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1bb)]],_0x38eb5e=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x20d)]],_0x5445f9=[_0x16703b['body']['storage']],_0x26cb07=[_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1e7)]],_0x5835e3=[_0x16703b['body'][_0x3d0bca(0x1d9)]];else var _0x16a402=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1ff)]],_0x5c6c84=[..._0x16703b['body']['prod_code']],_0x4da62f=[..._0x16703b['body'][_0x3d0bca(0x183)]],_0x334253=[..._0x16703b[_0x3d0bca(0x1c3)]['prod_unit']],_0x14c682=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1d2)]],_0x560f2c=[..._0x16703b['body']['prod_level']],_0x17c2e2=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x20e)]],_0xbc8e18=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x15f)]],_0x39f53b=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x206)]],_0x36bfc1=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x161)]],_0x1697c5=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x20c)]],_0x25c827=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1bb)]],_0x38eb5e=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x20d)]],_0x5445f9=[..._0x16703b[_0x3d0bca(0x1c3)]['storage']],_0x26cb07=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1e7)]],_0x5835e3=[..._0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1d9)]];const _0x4ff1b4=_0x16a402[_0x3d0bca(0x21c)](_0x356f5c=>{return _0x356f5c={'product_name':_0x356f5c};});_0x5c6c84[_0x3d0bca(0x229)]((_0x3eddfe,_0x475d9f)=>{_0x4ff1b4[_0x475d9f]['product_code']=_0x3eddfe;}),_0x4da62f[_0x3d0bca(0x229)]((_0x54fafa,_0x576671)=>{var _0x166c0c=_0x3d0bca;_0x4ff1b4[_0x576671][_0x166c0c(0x18c)]=_0x54fafa;}),_0x334253[_0x3d0bca(0x229)]((_0x30d50b,_0x41ec45)=>{var _0x4d24b3=_0x3d0bca;_0x4ff1b4[_0x41ec45][_0x4d24b3(0x134)]=_0x30d50b;}),_0x14c682[_0x3d0bca(0x229)]((_0x14fb59,_0x5dc98e)=>{var _0x5bb140=_0x3d0bca;_0x4ff1b4[_0x5dc98e][_0x5bb140(0x1ca)]=_0x14fb59;}),_0x560f2c[_0x3d0bca(0x229)]((_0x53fc6f,_0x34ef0b)=>{var _0x6e2b47=_0x3d0bca;_0x4ff1b4[_0x34ef0b][_0x6e2b47(0x236)]=_0x53fc6f;}),_0x17c2e2[_0x3d0bca(0x229)]((_0x276de9,_0x4eef32)=>{var _0x1a0b52=_0x3d0bca;_0x4ff1b4[_0x4eef32][_0x1a0b52(0x14c)]=_0x276de9;}),_0xbc8e18[_0x3d0bca(0x229)]((_0x598913,_0x3b6bd5)=>{var _0x136128=_0x3d0bca;_0x4ff1b4[_0x3b6bd5][_0x136128(0x19d)]=_0x598913;}),_0x39f53b['forEach']((_0x519005,_0x700e90)=>{var _0x1c1d74=_0x3d0bca;_0x4ff1b4[_0x700e90][_0x1c1d74(0x206)]=_0x519005;}),_0x36bfc1['forEach']((_0x50f66f,_0x3bd6a4)=>{var _0x4e93ba=_0x3d0bca;_0x4ff1b4[_0x3bd6a4][_0x4e93ba(0x161)]=_0x50f66f;}),_0x1697c5[_0x3d0bca(0x229)]((_0x6978d4,_0x39148f)=>{var _0x561313=_0x3d0bca;_0x4ff1b4[_0x39148f][_0x561313(0x188)]=_0x6978d4;}),_0x25c827[_0x3d0bca(0x229)]((_0x74f5de,_0x4ea1c7)=>{_0x4ff1b4[_0x4ea1c7]['batch_code']=_0x74f5de;}),_0x38eb5e[_0x3d0bca(0x229)]((_0x344ace,_0x5e791b)=>{var _0x398ab1=_0x3d0bca;_0x4ff1b4[_0x5e791b][_0x398ab1(0x20d)]=_0x344ace;}),_0x5835e3[_0x3d0bca(0x229)]((_0x5c01d9,_0x330970)=>{var _0x3c9179=_0x3d0bca;_0x4ff1b4[_0x330970][_0x3c9179(0x1d9)]=_0x5c01d9;}),_0x5445f9['forEach']((_0x5bc872,_0x3cc014)=>{var _0x2e8fd6=_0x3d0bca;_0x4ff1b4[_0x3cc014][_0x2e8fd6(0x185)]=_0x5bc872;}),_0x26cb07['forEach']((_0x435832,_0x1db9f2)=>{_0x4ff1b4[_0x1db9f2]['rack']=_0x435832;});const _0x78637d=_0x4ff1b4[_0x3d0bca(0x1a9)](_0x2cb2eb=>_0x2cb2eb['quantity']!=='0'&&_0x2cb2eb[_0x3d0bca(0x18c)]!=='');_0x485f20['invoice']=_0x335cc6,_0x485f20[_0x3d0bca(0x192)]=_0x226b41,_0x485f20[_0x3d0bca(0x169)]=_0x5380fd,_0x485f20[_0x3d0bca(0x1fd)]=_0x2528f6,_0x485f20['product']=_0x78637d,_0x485f20['note']=_0x2d7e92,_0x485f20[_0x3d0bca(0x21a)]=_0x155f1a,_0x485f20['due_amount']=_0xd11b5c,_0x485f20[_0x3d0bca(0x138)]=_0x6e8c57,_0x485f20[_0x3d0bca(0x17f)]=_0x51b17e,_0x485f20[_0x3d0bca(0x147)]=_0x3c60fb;const _0x3a884e=await _0x485f20[_0x3d0bca(0x168)](),_0x176adb=await warehouse[_0x3d0bca(0x1bc)]({'name':_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x1fd)],'room':_0x16703b['body'][_0x3d0bca(0x156)]});_0x485f20[_0x3d0bca(0x14d)][_0x3d0bca(0x229)](_0x5c7f60=>{var _0x2799a3=_0x3d0bca,_0xfa74be=0x0;const _0x3daf60=_0x176adb[_0x2799a3(0x1b4)][_0x2799a3(0x21c)](_0xb226bd=>{var _0x46e35a=_0x2799a3;_0xb226bd['product_name']==_0x5c7f60[_0x46e35a(0x132)]&&_0xb226bd[_0x46e35a(0x19d)]==_0x5c7f60[_0x46e35a(0x19d)]&&_0xb226bd[_0x46e35a(0x1d9)]==_0x5c7f60['type']&&_0xb226bd[_0x46e35a(0x14c)]==_0x5c7f60[_0x46e35a(0x14c)]&&_0xb226bd[_0x46e35a(0x236)]==_0x5c7f60[_0x46e35a(0x236)]&&_0xb226bd[_0x46e35a(0x230)]==_0x5c7f60['rack']&&_0xb226bd[_0x46e35a(0x185)]==_0x5c7f60[_0x46e35a(0x185)]&&(_0xb226bd[_0x46e35a(0x133)]=parseInt(_0xb226bd['product_stock'])+parseInt(_0x5c7f60[_0x46e35a(0x18c)]),_0xfa74be++);});_0xfa74be=='0'&&(_0x176adb[_0x2799a3(0x1b4)]=_0x176adb[_0x2799a3(0x1b4)][_0x2799a3(0x1e0)]({'product_name':_0x5c7f60[_0x2799a3(0x132)],'product_stock':_0x5c7f60[_0x2799a3(0x18c)],'primary_code':_0x5c7f60[_0x2799a3(0x206)],'secondary_code':_0x5c7f60['secondary_code'],'product_code':_0x5c7f60[_0x2799a3(0x151)],'storage':_0x5c7f60[_0x2799a3(0x185)],'rack':_0x5c7f60[_0x2799a3(0x230)],'bay':_0x5c7f60[_0x2799a3(0x236)],'bin':_0x5c7f60[_0x2799a3(0x14c)],'type':_0x5c7f60[_0x2799a3(0x1d9)],'floorlevel':_0x5c7f60[_0x2799a3(0x19d)],'maxProducts':_0x5c7f60[_0x2799a3(0x188)],'unit':_0x5c7f60['standard_unit'],'secondary_unit':_0x5c7f60[_0x2799a3(0x1ca)],'expiry_date':_0x5c7f60[_0x2799a3(0x20d)]}));}),await _0x176adb[_0x3d0bca(0x168)]();const _0x589c2b=await s_payment_data[_0x3d0bca(0x1bc)]({'invoice':_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x21f)]});if(_0x589c2b===null){}else console['log'](_0x3d0bca(0x192),_0x589c2b,_0x16703b['body']['invoice']),_0x589c2b[_0x3d0bca(0x192)]=_0x16703b[_0x3d0bca(0x1c3)][_0x3d0bca(0x192)],await _0x589c2b[_0x3d0bca(0x168)]();_0x16703b[_0x3d0bca(0x227)](_0x3d0bca(0x176),_0x3d0bca(0x1f0)),_0x54fc7d[_0x3d0bca(0x212)](_0x3d0bca(0x22a));}catch(_0x3a8c0b){console[_0x3d0bca(0x13e)](_0x3a8c0b);}}),router[a0_0x57fcc0(0x171)](a0_0x57fcc0(0x19f),auth,async(_0x5b5962,_0xa03ddd)=>{var _0x22cb80=a0_0x57fcc0;try{const _0x17e382=_0x5b5962['params']['id'],{invoice:_0x55a050,suppliers:_0x27eaf0,payable:_0x1a6b46,due_amount:_0x3855cc}=_0x5b5962[_0x22cb80(0x1c3)],_0x6154a3=await purchases[_0x22cb80(0x214)](_0x17e382);var _0x2284ae=_0x1a6b46-_0x3855cc;_0x6154a3[_0x22cb80(0x21a)]=parseFloat(_0x6154a3['paid_amount'])+parseFloat(_0x3855cc),_0x6154a3[_0x22cb80(0x135)]=_0x2284ae;const _0x69779=await _0x6154a3['save']();console['log'](_0x69779);const _0x592e6c=await s_payment_data[_0x22cb80(0x1bc)]({'invoice':_0x55a050});_0x592e6c[_0x22cb80(0x238)]=_0x2284ae,await _0x592e6c['save']();let _0x3730a1=new Date(),_0x59b9eb=('0'+_0x3730a1[_0x22cb80(0x13c)]())['slice'](-0x2),_0x42d692=('0'+(_0x3730a1['getMonth']()+0x1))[_0x22cb80(0x239)](-0x2),_0x31e7ea=_0x3730a1['getFullYear'](),_0x35b2b5=_0x31e7ea+'-'+_0x42d692+'-'+_0x59b9eb;const _0x22e516=new suppliers_payment({'invoice':_0x55a050,'date':_0x31e7ea+'-'+_0x42d692+'-'+_0x59b9eb,'suppliers':_0x27eaf0,'reason':_0x22cb80(0x144),'amount':_0x3855cc}),_0x4cfec7=await _0x22e516[_0x22cb80(0x168)]();_0x5b5962[_0x22cb80(0x227)](_0x22cb80(0x176),'payment\x20successfull'),_0xa03ddd['redirect']('/all_purchases/view');}catch(_0x22d59e){console[_0x22cb80(0x13e)](_0x22d59e);}}),router[a0_0x57fcc0(0x143)](a0_0x57fcc0(0x207),auth,async(_0x25319f,_0x378b34)=>{var _0x2973fc=a0_0x57fcc0;try{const {username:_0xa06982,email:_0x34888e,role:_0x12aad5}=_0x25319f['user'],_0x150970=_0x25319f[_0x2973fc(0x141)],_0x4a06ce=await profile[_0x2973fc(0x1bc)]({'email':_0x150970['email']}),_0x1d17e4=await master_shop['find']();console[_0x2973fc(0x13e)](_0x2973fc(0x152),_0x1d17e4);const _0x364c86=_0x25319f[_0x2973fc(0x1b5)]['id'],_0x5926a9=await purchases[_0x2973fc(0x214)](_0x364c86);console[_0x2973fc(0x13e)](_0x5926a9);const _0x30799c=await suppliers['findOne']({'name':_0x5926a9[_0x2973fc(0x192)]});console[_0x2973fc(0x13e)](_0x30799c);if(_0x1d17e4[0x0]['language']==_0x2973fc(0x15c)){var _0x3b6c43=users['English'];console[_0x2973fc(0x13e)](_0x3b6c43);}else{if(_0x1d17e4[0x0][_0x2973fc(0x1d0)]=='Hindi')var _0x3b6c43=users[_0x2973fc(0x1f2)];else{if(_0x1d17e4[0x0]['language']==_0x2973fc(0x1d4))var _0x3b6c43=users['German'];else{if(_0x1d17e4[0x0][_0x2973fc(0x1d0)]==_0x2973fc(0x1f7))var _0x3b6c43=users['Spanish'];else{if(_0x1d17e4[0x0][_0x2973fc(0x1d0)]==_0x2973fc(0x160))var _0x3b6c43=users[_0x2973fc(0x160)];else{if(_0x1d17e4[0x0][_0x2973fc(0x1d0)]=='Portuguese\x20(BR)')var _0x3b6c43=users['Portuguese'];else{if(_0x1d17e4[0x0][_0x2973fc(0x1d0)]==_0x2973fc(0x1c1))var _0x3b6c43=users['Chinese'];else{if(_0x1d17e4[0x0][_0x2973fc(0x1d0)]==_0x2973fc(0x1d3))var _0x3b6c43=users['Arabic'];}}}}}}}_0x378b34[_0x2973fc(0x1cc)](_0x2973fc(0x186),{'success':_0x25319f[_0x2973fc(0x227)](_0x2973fc(0x176)),'errors':_0x25319f['flash'](_0x2973fc(0x242)),'role':_0x150970,'profile':_0x4a06ce,'master_shop':_0x1d17e4,'supplier':_0x30799c,'purchase':_0x5926a9,'language':_0x3b6c43});}catch(_0x289a1d){console[_0x2973fc(0x13e)](_0x289a1d);}}),router['get']('/view/return_purchase/:id',auth,async(_0x5f4065,_0x3bb856)=>{var _0x81df45=a0_0x57fcc0;try{const {username:_0x3b08ec,email:_0x48a8f0,role:_0x21a16f}=_0x5f4065['user'],_0x3ef95e=_0x5f4065[_0x81df45(0x141)],_0x4a2fee=await profile[_0x81df45(0x1bc)]({'email':_0x3ef95e[_0x81df45(0x173)]}),_0xb054bf=await master_shop['find']();console[_0x81df45(0x13e)](_0x81df45(0x152),_0xb054bf);const _0x23aff1=_0x5f4065[_0x81df45(0x1b5)]['id'];console[_0x81df45(0x13e)](_0x23aff1);const _0x192cbc=await purchases[_0x81df45(0x214)](_0x23aff1);console[_0x81df45(0x13e)](_0x81df45(0x1c8),_0x192cbc);const _0x28b4d3=await product['find']({}),_0x4f806c=await warehouse[_0x81df45(0x177)]([{'$match':{'name':_0x192cbc['warehouse_name'],'room':_0x192cbc[_0x81df45(0x138)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x81df45(0x209)},{'$group':{'_id':_0x81df45(0x1f1),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x81df45(0x13d)},'bay':{'$first':_0x81df45(0x167)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x81df45(0x22f)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x81df45(0x1a5)},'rack':{'$first':_0x81df45(0x172)}}}]);warehouse_data=await warehouse[_0x81df45(0x177)]([{'$match':{'status':_0x81df45(0x20b),'name':_0x81df45(0x153),'warehouse_category':_0x81df45(0x22e)}},{'$group':{'_id':_0x81df45(0x1c4),'name':{'$first':_0x81df45(0x1c4)}}},{'$sort':{'name':0x1}}]),console[_0x81df45(0x13e)](_0x81df45(0x1af),_0x4f806c);if(_0xb054bf[0x0]['language']==_0x81df45(0x15c)){var _0x2bd293=users[_0x81df45(0x1f9)];console[_0x81df45(0x13e)](_0x2bd293);}else{if(_0xb054bf[0x0]['language']==_0x81df45(0x1f2))var _0x2bd293=users[_0x81df45(0x1f2)];else{if(_0xb054bf[0x0][_0x81df45(0x1d0)]==_0x81df45(0x1d4))var _0x2bd293=users['German'];else{if(_0xb054bf[0x0]['language']==_0x81df45(0x1f7))var _0x2bd293=users[_0x81df45(0x1f7)];else{if(_0xb054bf[0x0][_0x81df45(0x1d0)]==_0x81df45(0x160))var _0x2bd293=users[_0x81df45(0x160)];else{if(_0xb054bf[0x0][_0x81df45(0x1d0)]==_0x81df45(0x221))var _0x2bd293=users[_0x81df45(0x170)];else{if(_0xb054bf[0x0][_0x81df45(0x1d0)]==_0x81df45(0x1c1))var _0x2bd293=users[_0x81df45(0x1c1)];else{if(_0xb054bf[0x0]['language']==_0x81df45(0x1d3))var _0x2bd293=users['Arabic'];}}}}}}}_0x3bb856['render'](_0x81df45(0x159),{'success':_0x5f4065['flash'](_0x81df45(0x176)),'errors':_0x5f4065[_0x81df45(0x227)]('errors'),'role':_0x3ef95e,'profile':_0x4a2fee,'user':_0x192cbc,'stock':_0x4f806c,'master_shop':_0xb054bf,'product':_0x28b4d3,'language':_0x2bd293,'warehouse':warehouse_data});}catch(_0x19be09){console[_0x81df45(0x13e)](_0x19be09);}}),router[a0_0x57fcc0(0x171)](a0_0x57fcc0(0x1f4),auth,async(_0x46f49f,_0x3845c9)=>{var _0x39b984=a0_0x57fcc0;try{const {invoice:_0x956447,date:_0x1bb0aa,warehouse_name:_0x829e8d,Room_name:_0x20e790,product_name:_0x1181eb,purchase_quantity:_0x40f2b7,stocks:_0x3c3701,return_qty:_0x4761e0,note:_0x397479,level:_0x184db3,isle:_0x24740c,pallet:_0x27970e,to_warehouse_name:_0xe42474,to_Room_name:_0x4980a3}=_0x46f49f[_0x39b984(0x1c3)],_0x3adb00=await purchases[_0x39b984(0x1bc)]({'_id':_0x46f49f[_0x39b984(0x1b5)]['id']}),_0x3052dc=await warehouse[_0x39b984(0x1bc)]({'name':_0x829e8d,'room':_0x20e790});if(typeof _0x1181eb=='string')var _0x1c2ebe=[_0x46f49f[_0x39b984(0x1c3)]['product_name']],_0x2cd911=[_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x204)]],_0x321dc0=[_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x16c)]],_0xebfafb=[_0x46f49f[_0x39b984(0x1c3)]['return_qty']],_0x3ad76a=[_0x46f49f['body'][_0x39b984(0x1ee)]],_0xb63c1a=[_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x1e5)]],_0x29d009=[_0x46f49f[_0x39b984(0x1c3)]['pallet']],_0x1003e4=[_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x1ed)]],_0x44138c=[_0x46f49f['body'][_0x39b984(0x205)]],_0x452203=[_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x182)]],_0x32de3d=[_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x1f8)]];else var _0x1c2ebe=[..._0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x132)]],_0x2cd911=[..._0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x204)]],_0x321dc0=[..._0x46f49f['body'][_0x39b984(0x16c)]],_0xebfafb=[..._0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x1eb)]],_0x3ad76a=[..._0x46f49f[_0x39b984(0x1c3)]['level']],_0xb63c1a=[..._0x46f49f[_0x39b984(0x1c3)]['isle']],_0x29d009=[..._0x46f49f['body'][_0x39b984(0x19a)]],_0x1003e4=[..._0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x1ed)]],_0x44138c=[..._0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x205)]],_0x452203=[..._0x46f49f['body'][_0x39b984(0x182)]],_0x32de3d=[..._0x46f49f[_0x39b984(0x1c3)]['secondary_code_hide']];const _0x188343=_0x1c2ebe['map'](_0x322493=>{return _0x322493={'product_name':_0x322493};});_0x2cd911[_0x39b984(0x229)]((_0xb19a84,_0x54dbae)=>{var _0x3dd951=_0x39b984;_0x188343[_0x54dbae][_0x3dd951(0x204)]=_0xb19a84;}),_0x321dc0[_0x39b984(0x229)]((_0x4b1bcd,_0x395378)=>{_0x188343[_0x395378]['stock_quantity']=_0x4b1bcd;}),_0xebfafb[_0x39b984(0x229)]((_0x35037d,_0x1cc792)=>{var _0x3dc60a=_0x39b984;_0x188343[_0x1cc792][_0x3dc60a(0x1eb)]=_0x35037d;}),_0x3ad76a[_0x39b984(0x229)]((_0x161d50,_0x3210f0)=>{var _0xfbb19=_0x39b984;_0x188343[_0x3210f0][_0xfbb19(0x236)]=_0x161d50;}),_0xb63c1a[_0x39b984(0x229)]((_0x59dfb5,_0x575e96)=>{var _0x4f2a0a=_0x39b984;_0x188343[_0x575e96][_0x4f2a0a(0x14c)]=_0x59dfb5;}),_0x29d009[_0x39b984(0x229)]((_0x4627ce,_0x3cf23f)=>{var _0x44a309=_0x39b984;_0x188343[_0x3cf23f][_0x44a309(0x19d)]=_0x4627ce;}),_0x1003e4['forEach']((_0x45a341,_0x3f6979)=>{var _0x58df6b=_0x39b984;_0x188343[_0x3f6979][_0x58df6b(0x1d9)]=_0x45a341;}),_0x44138c[_0x39b984(0x229)]((_0x182c0d,_0x348ae9)=>{var _0x49b786=_0x39b984;_0x188343[_0x348ae9][_0x49b786(0x151)]=_0x182c0d;}),_0x452203[_0x39b984(0x229)]((_0x892dd2,_0x401a61)=>{var _0x12c882=_0x39b984;_0x188343[_0x401a61][_0x12c882(0x206)]=_0x892dd2;}),_0x32de3d['forEach']((_0x1d004f,_0x300def)=>{_0x188343[_0x300def]['secondary_code']=_0x1d004f;}),_0x3adb00[_0x39b984(0x14d)][_0x39b984(0x229)](_0x2f98c7=>{var _0xcd5ae9=_0x39b984;const _0x5e4a27=_0x3052dc[_0xcd5ae9(0x1b4)][_0xcd5ae9(0x21c)](_0x22411a=>{var _0x5b3f1a=_0xcd5ae9;_0x22411a[_0x5b3f1a(0x132)]==_0x2f98c7[_0x5b3f1a(0x132)]&&_0x22411a[_0x5b3f1a(0x19d)]==_0x2f98c7[_0x5b3f1a(0x19d)]&&_0x22411a['type']==_0x2f98c7[_0x5b3f1a(0x1d9)]&&_0x22411a[_0x5b3f1a(0x14c)]==_0x2f98c7[_0x5b3f1a(0x14c)]&&_0x22411a[_0x5b3f1a(0x236)]==_0x2f98c7[_0x5b3f1a(0x236)]&&_0x22411a[_0x5b3f1a(0x230)]==_0x2f98c7[_0x5b3f1a(0x230)]&&_0x22411a['storage']==_0x2f98c7['storage']&&(console[_0x5b3f1a(0x13e)](parseInt(_0x22411a[_0x5b3f1a(0x133)])+'\x20<>\x20'+parseInt(_0x2f98c7[_0x5b3f1a(0x18c)])),_0x22411a[_0x5b3f1a(0x133)]=parseInt(_0x22411a[_0x5b3f1a(0x133)])+parseInt(_0x2f98c7[_0x5b3f1a(0x18c)]));});}),await _0x3052dc[_0x39b984(0x168)]();const _0x23140f=_0x188343[_0x39b984(0x1a9)](_0x37298a=>_0x37298a[_0x39b984(0x1eb)]!=='0'&&_0x37298a[_0x39b984(0x1eb)]!=='');var _0x3c40f7=0x0;_0x23140f['forEach'](_0x23491e=>{var _0x469002=_0x39b984;console[_0x469002(0x13e)](_0x469002(0x249),_0x23491e),(parseInt(_0x23491e[_0x469002(0x204)])<parseInt(_0x23491e['return_qty'])||parseInt(_0x23491e['stock_quantity'])<parseInt(_0x23491e[_0x469002(0x1eb)]))&&_0x3c40f7++;});if(_0x3c40f7!=0x0)return _0x46f49f[_0x39b984(0x227)]('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x3845c9[_0x39b984(0x212)](_0x39b984(0x1c0));const _0x39a6ae=new purchases_return({'invoice':_0x956447,'suppliers':_0x46f49f['body'][_0x39b984(0x192)],'date':_0x1bb0aa,'warehouse_name':_0x829e8d,'return_product':_0x23140f,'note':_0x397479,'room':_0x20e790,'to_warehouse_name':_0xe42474,'to_room':_0x4980a3}),_0x4b3489=await _0x39a6ae[_0x39b984(0x168)]();console[_0x39b984(0x13e)](_0x39a6ae);const _0xbd869b=await purchases_return[_0x39b984(0x1bc)]({'invoice':_0x956447}),_0x321555=await warehouse[_0x39b984(0x1bc)]({'name':_0xe42474,'room':_0x4980a3});_0xbd869b[_0x39b984(0x22c)][_0x39b984(0x229)](_0x26cc81=>{var _0x475711=_0x39b984,_0x204dca=0x0;const _0x3a4344=_0x321555['product_details'][_0x475711(0x21c)](_0x1dcad7=>{var _0x418454=_0x475711;_0x1dcad7[_0x418454(0x132)]==_0x26cc81[_0x418454(0x132)]&&_0x1dcad7[_0x418454(0x19d)]==_0x26cc81[_0x418454(0x19d)]&&_0x1dcad7[_0x418454(0x1d9)]==_0x26cc81[_0x418454(0x1d9)]&&_0x1dcad7[_0x418454(0x14c)]==_0x26cc81[_0x418454(0x14c)]&&_0x1dcad7['bay']==_0x26cc81[_0x418454(0x236)]&&(_0x1dcad7[_0x418454(0x133)]=parseInt(_0x1dcad7['product_stock'])-parseInt(_0x26cc81[_0x418454(0x1eb)]),_0x204dca++);});_0x204dca=='0'&&(_0x321555[_0x475711(0x1b4)]=_0x321555[_0x475711(0x1b4)][_0x475711(0x1e0)]({'product_name':_0x26cc81[_0x475711(0x132)],'product_stock':_0x26cc81['return_qty'],'primary_code':_0x26cc81[_0x475711(0x206)],'secondary_code':_0x26cc81['secondary_code'],'product_code':_0x26cc81['product_code'],'storage':_0x26cc81[_0x475711(0x185)],'rack':_0x26cc81[_0x475711(0x230)],'bay':_0x26cc81['bay'],'bin':_0x26cc81[_0x475711(0x14c)],'type':_0x26cc81['type'],'floorlevel':_0x26cc81[_0x475711(0x19d)],'maxProducts':_0x26cc81[_0x475711(0x188)],'unit':_0x26cc81['standard_unit'],'secondary_unit':_0x26cc81[_0x475711(0x1ca)],'expiry_date':_0x26cc81[_0x475711(0x20d)]}));}),await _0x321555[_0x39b984(0x168)]();const _0x5a8fcc=await purchases['findOne']({'invoice':_0x956447});_0x5a8fcc[_0x39b984(0x191)]=_0x39b984(0x23a);const _0x4a85fc=await _0x5a8fcc[_0x39b984(0x168)](),_0x4a2b0a=new s_payment_data({'invoice':_0x956447,'suppliers':_0x46f49f[_0x39b984(0x1c3)][_0x39b984(0x192)],'reason':_0x39b984(0x217)});await _0x4a2b0a[_0x39b984(0x168)]();const _0x101a05=await master_shop[_0x39b984(0x180)]();console[_0x39b984(0x13e)](_0x39b984(0x16d),_0x101a05[0x0][_0x39b984(0x13f)]);const _0xb75852=await email_settings[_0x39b984(0x1bc)](),_0x1affdd=await suppliers['findOne']({'name':_0x46f49f[_0x39b984(0x1c3)]['suppliers']});console[_0x39b984(0x13e)](_0x39b984(0x1db),_0x1affdd);_0x101a05[0x0]['currency_placement']==0x1?(right_currency=_0x101a05[0x0][_0x39b984(0x233)],left_currency=''):(right_currency='',left_currency=_0x101a05[0x0][_0x39b984(0x233)]);var _0x5bb24b=_0x1c2ebe,_0x34d503=_0xebfafb,_0x2b2090='',_0x291cfc;for(_0x291cfc in _0x5bb24b){_0x2b2090+=_0x39b984(0x202)+_0x39b984(0x1cd)+_0x5bb24b[_0x291cfc]+_0x39b984(0x17c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34d503[_0x291cfc]+_0x39b984(0x17c)+_0x39b984(0x234);}console[_0x39b984(0x13e)](_0x39b984(0x222),_0x2b2090);let _0x5c8360=nodemailer[_0x39b984(0x223)]({'service':'gmail','auth':{'user':_0xb75852['email'],'pass':_0xb75852[_0x39b984(0x1a7)]}}),_0x3eae46={'from':_0xb75852[_0x39b984(0x173)],'to':_0x1affdd[_0x39b984(0x173)],'subject':_0x39b984(0x145),'attachments':[{'filename':_0x39b984(0x1d6),'path':__dirname+_0x39b984(0x1b7)+_0x39b984(0x17e)+_0x101a05[0x0][_0x39b984(0x13f)],'cid':_0x39b984(0x165)}],'html':_0x39b984(0x17d)+'<html><head><title></title>'+'</head><body>'+'<div>'+_0x39b984(0x1ce)+_0x39b984(0x224)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x39b984(0x224)+_0x39b984(0x1b8)+_0x101a05[0x0]['site_title']+'\x20</h2>'+_0x39b984(0x1f3)+'</div>'+_0x39b984(0x21b)+'<div>'+_0x39b984(0x243)+_0x39b984(0x15b)+_0x956447+'\x20'+_0x39b984(0x195)+_0x39b984(0x232)+_0x1bb0aa+'\x20'+_0x39b984(0x226)+_0x39b984(0x20a)+_0x39b984(0x1f3)+_0x39b984(0x150)+_0x39b984(0x164)+_0x39b984(0x202)+_0x39b984(0x1c6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x39b984(0x154)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x39b984(0x234)+'</thead>'+_0x39b984(0x184)+'\x20'+_0x2b2090+'\x20'+_0x39b984(0x18e)+_0x39b984(0x246)+'<div>'+_0x39b984(0x16a)+_0x39b984(0x225)+_0x101a05[0x0][_0x39b984(0x149)]+_0x39b984(0x20a)+_0x39b984(0x1f3)+_0x39b984(0x1f3)+_0x39b984(0x1e9)};_0x5c8360['sendMail'](_0x3eae46,function(_0x9e10fc,_0x257c1d){var _0x11d3e5=_0x39b984;_0x9e10fc?(console[_0x11d3e5(0x13e)](_0x9e10fc),console['log'](_0x11d3e5(0x18a))):console[_0x11d3e5(0x13e)](_0x11d3e5(0x15d));}),_0x46f49f[_0x39b984(0x227)]('success',_0x39b984(0x1dc)),_0x3845c9[_0x39b984(0x212)]('/all_purchases/view');}catch(_0x3f62af){console[_0x39b984(0x13e)](_0x3f62af),_0x3845c9[_0x39b984(0x247)](0xc8)[_0x39b984(0x1e3)]({'message':_0x3f62af[_0x39b984(0x1a4)]});}}),router['get'](a0_0x57fcc0(0x208),auth,async(_0x44258c,_0x34defa)=>{var _0x4c2e2f=a0_0x57fcc0;try{const {username:_0x7381fd,email:_0x44e92b,role:_0x1ec2b6}=_0x44258c['user'],_0x2318a9=_0x44258c[_0x4c2e2f(0x141)],_0x1ddaaa=await profile[_0x4c2e2f(0x1bc)]({'email':_0x2318a9[_0x4c2e2f(0x173)]}),_0xf8cb8a=await master_shop[_0x4c2e2f(0x180)](),_0x1e4607=_0x44258c[_0x4c2e2f(0x1b5)]['id'],_0x2f4ef7=await purchases[_0x4c2e2f(0x214)](_0x1e4607);if(_0xf8cb8a[0x0][_0x4c2e2f(0x1d0)]==_0x4c2e2f(0x15c))var _0x48550e=users[_0x4c2e2f(0x1f9)];else{if(_0xf8cb8a[0x0]['language']=='Hindi')var _0x48550e=users[_0x4c2e2f(0x1f2)];else{if(_0xf8cb8a[0x0][_0x4c2e2f(0x1d0)]==_0x4c2e2f(0x1d4))var _0x48550e=users[_0x4c2e2f(0x1d4)];else{if(_0xf8cb8a[0x0]['language']==_0x4c2e2f(0x1f7))var _0x48550e=users[_0x4c2e2f(0x1f7)];else{if(_0xf8cb8a[0x0][_0x4c2e2f(0x1d0)]==_0x4c2e2f(0x160))var _0x48550e=users[_0x4c2e2f(0x160)];else{if(_0xf8cb8a[0x0][_0x4c2e2f(0x1d0)]==_0x4c2e2f(0x221))var _0x48550e=users['Portuguese'];else{if(_0xf8cb8a[0x0][_0x4c2e2f(0x1d0)]==_0x4c2e2f(0x1c1))var _0x48550e=users[_0x4c2e2f(0x1c1)];else{if(_0xf8cb8a[0x0][_0x4c2e2f(0x1d0)]==_0x4c2e2f(0x1d3))var _0x48550e=users[_0x4c2e2f(0x213)];}}}}}}}_0x34defa['render'](_0x4c2e2f(0x13b),{'success':_0x44258c[_0x4c2e2f(0x227)](_0x4c2e2f(0x176)),'errors':_0x44258c[_0x4c2e2f(0x227)](_0x4c2e2f(0x242)),'role':_0x2318a9,'profile':_0x1ddaaa,'alldata':_0x2f4ef7,'master_shop':_0xf8cb8a,'language':_0x48550e}),console[_0x4c2e2f(0x13e)](alldata);}catch(_0x88b7bf){console[_0x4c2e2f(0x13e)](_0x88b7bf);}}),router['post']('/barcode_scanner',async(_0x272ef7,_0x4fe447)=>{var _0x3b5a34=a0_0x57fcc0;const {product_code:_0x905067}=_0x272ef7[_0x3b5a34(0x1c3)];var _0x23755a;const _0x5d29da=await product[_0x3b5a34(0x177)]([{'$match':{'primary_code':_0x905067,'product_category':_0x3b5a34(0x22e)}},{'$group':{'_id':_0x3b5a34(0x1f6),'name':{'$first':_0x3b5a34(0x1c4)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x3b5a34(0x1bd)},'alertquantity':{'$first':_0x3b5a34(0x1a8)},'product_code':{'$first':_0x3b5a34(0x1e8)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3b5a34(0x1dd)},'maxStocks':{'$first':_0x3b5a34(0x215)},'maxProdPerUnit':{'$first':_0x3b5a34(0x1bf)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3b5a34(0x23c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4a9a92=await product[_0x3b5a34(0x177)]([{'$match':{'secondary_code':_0x905067,'product_category':_0x3b5a34(0x22e)}},{'$group':{'_id':_0x3b5a34(0x1f6),'name':{'$first':'$name'},'category':{'$first':_0x3b5a34(0x189)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x3b5a34(0x1a8)},'product_code':{'$first':_0x3b5a34(0x1e8)},'primary_code':{'$first':_0x3b5a34(0x142)},'secondary_code':{'$first':_0x3b5a34(0x1dd)},'maxStocks':{'$first':_0x3b5a34(0x215)},'maxProdPerUnit':{'$first':_0x3b5a34(0x1bf)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3b5a34(0x23c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5d29da[_0x3b5a34(0x137)]>0x0)_0x23755a=_0x5d29da;else _0x4a9a92[_0x3b5a34(0x137)]>0x0&&(_0x23755a=_0x4a9a92);_0x4fe447[_0x3b5a34(0x1e3)](_0x23755a);}),router[a0_0x57fcc0(0x171)](a0_0x57fcc0(0x1e6),async(_0x273afd,_0x4ba60d)=>{var _0x361b6b=a0_0x57fcc0;const {primaryCode:_0x52233b,secondaryCode:_0x432cbe,productCode:_0x498767,bay:_0x190da5,bin:_0x17f922,types:_0x31cbfe,pallet:_0x2574b1,warehouses:_0x45e474,room:_0x566b6c}=_0x273afd[_0x361b6b(0x1c3)];console[_0x361b6b(0x13e)](_0x273afd[_0x361b6b(0x1c3)]);try{const _0x3114db=await warehouse[_0x361b6b(0x177)]([{'$match':{'name':_0x45e474,'room':_0x566b6c}},{'$unwind':_0x361b6b(0x209)},{'$match':{'product_details.bay':_0x190da5,'product_details.bin':_0x17f922,'product_details.type':_0x31cbfe}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x361b6b(0x248)},'product_stock':{'$first':_0x361b6b(0x13d)},'level':{'$first':_0x361b6b(0x218)},'isle':{'$first':_0x361b6b(0x18f)},'pallet':{'$first':_0x361b6b(0x179)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4ba60d[_0x361b6b(0x247)](0xc8)['json'](_0x3114db);}catch(_0x46dc46){_0x4ba60d[_0x361b6b(0x247)](0x194)['json']({'message':_0x46dc46[_0x361b6b(0x1a4)]});}}),module[a0_0x57fcc0(0x158)]=router;