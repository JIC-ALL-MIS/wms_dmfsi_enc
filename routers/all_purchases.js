var a0_0x1b36e1=a0_0x1974;(function(_0x2065c4,_0x737d74){var _0x46f4b4=a0_0x1974,_0x5541c0=_0x2065c4();while(!![]){try{var _0x39f0d6=parseInt(_0x46f4b4(0x1f8))/0x1*(parseInt(_0x46f4b4(0x172))/0x2)+parseInt(_0x46f4b4(0x19f))/0x3*(-parseInt(_0x46f4b4(0x178))/0x4)+parseInt(_0x46f4b4(0x1a1))/0x5*(-parseInt(_0x46f4b4(0x26b))/0x6)+parseInt(_0x46f4b4(0x21d))/0x7+-parseInt(_0x46f4b4(0x184))/0x8+parseInt(_0x46f4b4(0x25a))/0x9*(-parseInt(_0x46f4b4(0x204))/0xa)+parseInt(_0x46f4b4(0x16e))/0xb;if(_0x39f0d6===_0x737d74)break;else _0x5541c0['push'](_0x5541c0['shift']());}catch(_0x4bcc87){_0x5541c0['push'](_0x5541c0['shift']());}}}(a0_0xf5ea,0xa3dc5));function a0_0x1974(_0x21700b,_0x138eb8){var _0xf5ea2f=a0_0xf5ea();return a0_0x1974=function(_0x197445,_0x3cc067){_0x197445=_0x197445-0x154;var _0x2aae2e=_0xf5ea2f[_0x197445];return _0x2aae2e;},a0_0x1974(_0x21700b,_0x138eb8);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1b36e1(0x1ab)),auth=require(a0_0x1b36e1(0x202)),nodemailer=require(a0_0x1b36e1(0x154));var ejs=require('ejs');const path=require(a0_0x1b36e1(0x227)),users=require('../public/language/languages.json');router[a0_0x1b36e1(0x269)](a0_0x1b36e1(0x175),auth,async(_0x37eb3a,_0x2eeb71)=>{var _0xa4cc5e=a0_0x1b36e1;try{const {username:_0x1f8e8c,email:_0x22ebc5,role:_0x4e9d64}=_0x37eb3a[_0xa4cc5e(0x245)],_0x7a5de4=_0x37eb3a['user'],_0x5f29ca=await profile[_0xa4cc5e(0x208)]({'email':_0x7a5de4[_0xa4cc5e(0x1ed)]}),_0x152bd9=await staff[_0xa4cc5e(0x208)]({'email':_0x7a5de4['email']});if(_0x7a5de4[_0xa4cc5e(0x1a8)]==_0xa4cc5e(0x249)){const _0x1d5d77=await staff['findOne']({'email':_0x7a5de4['email']});}const _0x2c8327=await master_shop[_0xa4cc5e(0x253)]();let _0x4aa88f;if(_0x7a5de4[_0xa4cc5e(0x1a8)]=='staff'){const _0x5b58b3=await staff[_0xa4cc5e(0x208)]({'email':_0x7a5de4[_0xa4cc5e(0x1ed)]});_0x4aa88f=await purchases[_0xa4cc5e(0x203)]([{'$match':{'warehouse_name':_0x5b58b3[_0xa4cc5e(0x1e4)]}},{'$lookup':{'from':_0xa4cc5e(0x186),'localField':'suppliers','foreignField':_0xa4cc5e(0x235),'as':_0xa4cc5e(0x209)}},{'$unwind':_0xa4cc5e(0x201)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0xa4cc5e(0x22f)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0xa4cc5e(0x20f)},'warehouse_name':{'$first':_0xa4cc5e(0x19e)},'room':{'$first':_0xa4cc5e(0x216)},'product':{'$push':_0xa4cc5e(0x260)},'note':{'$first':_0xa4cc5e(0x268)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0xa4cc5e(0x1cb)},'return_data':{'$first':_0xa4cc5e(0x1d0)},'batch_code':{'$first':_0xa4cc5e(0x164)},'expiry_date':{'$first':_0xa4cc5e(0x1c8)},'suppliers_docs':{'$first':_0xa4cc5e(0x201)},'total_product_quantity':{'$sum':_0xa4cc5e(0x225)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0xa4cc5e(0x183)},'type':{'$addToSet':_0xa4cc5e(0x1cf)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4aa88f=await purchases[_0xa4cc5e(0x203)]([{'$lookup':{'from':'suppliers','localField':_0xa4cc5e(0x186),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0xa4cc5e(0x201)},{'$unwind':_0xa4cc5e(0x260)},{'$group':{'_id':_0xa4cc5e(0x1db),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xa4cc5e(0x1c9)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xa4cc5e(0x19e)},'room':{'$addToSet':_0xa4cc5e(0x220)},'product':{'$push':_0xa4cc5e(0x260)},'note':{'$first':_0xa4cc5e(0x268)},'paid_amount':{'$first':_0xa4cc5e(0x1f2)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0xa4cc5e(0x1d0)},'batch_code':{'$first':_0xa4cc5e(0x164)},'expiry_date':{'$first':_0xa4cc5e(0x1c8)},'suppliers_docs':{'$first':_0xa4cc5e(0x201)},'total_product_quantity':{'$sum':_0xa4cc5e(0x225)},'level':{'$addToSet':_0xa4cc5e(0x218)},'isle':{'$addToSet':_0xa4cc5e(0x183)},'type':{'$addToSet':_0xa4cc5e(0x1cf)},'floorlevel':{'$addToSet':_0xa4cc5e(0x1a2)},'finalize':{'$first':_0xa4cc5e(0x193)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x26c)){var _0x7aed93=users[_0xa4cc5e(0x1b6)];console[_0xa4cc5e(0x211)](_0x7aed93);}else{if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x170))var _0x7aed93=users['Hindi'];else{if(_0x2c8327[0x0]['language']==_0xa4cc5e(0x212))var _0x7aed93=users[_0xa4cc5e(0x212)];else{if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x161))var _0x7aed93=users[_0xa4cc5e(0x161)];else{if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x255))var _0x7aed93=users[_0xa4cc5e(0x255)];else{if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x21f))var _0x7aed93=users[_0xa4cc5e(0x1c1)];else{if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x181))var _0x7aed93=users['Chinese'];else{if(_0x2c8327[0x0][_0xa4cc5e(0x1dc)]==_0xa4cc5e(0x265))var _0x7aed93=users[_0xa4cc5e(0x1de)];}}}}}}}_0x2eeb71[_0xa4cc5e(0x19c)]('all_purchases',{'success':_0x37eb3a[_0xa4cc5e(0x1df)](_0xa4cc5e(0x217)),'errors':_0x37eb3a['flash'](_0xa4cc5e(0x258)),'purchases':_0x4aa88f,'role':_0x7a5de4,'profile':_0x5f29ca,'master_shop':_0x2c8327,'language':_0x7aed93});}catch(_0xd42486){console[_0xa4cc5e(0x211)](_0xa4cc5e(0x210),_0xd42486),_0x2eeb71[_0xa4cc5e(0x1ef)](0xc8)[_0xa4cc5e(0x1a0)]({'message':_0xd42486['message']});}});function BayBinSelected(_0x1a0fec,_0x17ee1f){var _0xebfe89=a0_0x1b36e1,_0x5420cd=[],_0x117c7=[],_0x28d3b7=[],_0x2fe877=[],_0x362614=[],_0x520930=[];let _0x11e505=[];if(_0x1a0fec=='DRY\x20STORAGE')switch(_0x17ee1f){case'Rack\x20A':_0x5420cd=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x117c7=[0x1,0x2],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=[_0xebfe89(0x191),_0xebfe89(0x1fb)],_0x362614=['D'],_0x520930=['A'];break;case'Rack\x20B':_0x5420cd=[0x6,0x5,0x4,0x3,0x2,0x1],_0x117c7=[0x1,0x2],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=['Level',_0xebfe89(0x1fb)],_0x362614=['D'],_0x520930=['B'];break;case'Shelves':_0x5420cd=[0x0],_0x117c7=[0x0],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=['Floor'],_0x362614=['D'],_0x520930=['S'];break;case _0xebfe89(0x192):_0x5420cd=[0x0],_0x117c7=[0x0],_0x2fe877=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x28d3b7=['Floor'],_0x362614=['D'],_0x520930=['R'];break;}else{if(_0x1a0fec==_0xebfe89(0x158))switch(_0x17ee1f){case _0xebfe89(0x1d3):_0x5420cd=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x117c7=['B','F'],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=['Level',_0xebfe89(0x1fb)],_0x362614=['C'],_0x520930=['A'];break;case'Rack\x20B':_0x5420cd=[0x5,0x4,0x3,0x2,0x1],_0x117c7=['F','B','S'],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=['Level','Floor'],_0x362614=['C'],_0x520930=['B'];break;case'Rack\x20C':_0x5420cd=[0x1,0x2,0x3,0x4,0x5],_0x117c7=['B','F','S'],_0x2fe877=[0x5,0x4,0x3,0x2,0x1],_0x28d3b7=[_0xebfe89(0x191),_0xebfe89(0x1fb)],_0x362614=['C'],_0x520930=['C'];break;case _0xebfe89(0x19a):_0x5420cd=[0x5,0x4,0x3,0x2,0x1],_0x117c7=['F','B','S'],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=['Level',_0xebfe89(0x1fb)],_0x362614=['C'],_0x520930=['D'];break;case'Rack\x20E':_0x5420cd=[0x4,0x3,0x2,0x1],_0x117c7=[0x1,0x2],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=[_0xebfe89(0x191),_0xebfe89(0x1fb)],_0x362614=['C'],_0x520930=['E'];break;case _0xebfe89(0x22d):_0x5420cd=[0x1,0x2,0x3],_0x117c7=[0x1,0x2],_0x2fe877=[0x1,0x2,0x3,0x4,0x5],_0x28d3b7=[_0xebfe89(0x191)],_0x362614=['C'],_0x520930=['F'];break;}}return{'levels':_0x5420cd,'Isle':_0x117c7,'rack':_0x2fe877,'type':_0x28d3b7,'storage':_0x362614,'rak':_0x520930};}async function getRandom8DigitNumber(){var _0x5555a4=a0_0x1b36e1;const _0x16d462=0x989680,_0x1dc657=0x5f5e0ff,_0x50784b=Math[_0x5555a4(0x1fd)](Math['random']()*(_0x1dc657-_0x16d462+0x1))+_0x16d462;var _0x66dc0d;const _0x60fba2=await purchases[_0x5555a4(0x208)]({'invoice':'INC-'+_0x50784b});return _0x60fba2&&_0x60fba2['length']>0x0?_0x66dc0d=_0x5555a4(0x262)+_0x50784b:_0x66dc0d='INC-'+_0x50784b,_0x66dc0d;}function a0_0xf5ea(){var _0x3470ab=['secondary_code_hide','An\x20error\x20occurred\x20while\x20saving\x20data.','then','redirect','15266988oUrhCK','password','Hindi','createTransport','124198lTsGWT','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','expiry_date','/view','date','params','20792cKKUHk','prod_level','prod_Qty','maxStocks','Room_name','edit_purchases','finalize','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','pallet','Chinese','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product.bin','4605576thxZSf','prod_qty','suppliers','True','product_stock','logo','$product_details.primary_code','An\x20error\x20occurred.','$unit','$category','</table>','return_purchase','prod_pallet','Level','Receiving\x20Area','$finalize','edit_purchases_view','bay','$product_details.product_name','purchases\x20item\x20return\x20successfull','/view/:id','Purchase\x20Return\x20Mail','Rack\x20D','Paid\x20For\x20Purchase','render','<div>','$warehouse_name','312XYSdzw','json','95mFYCeq','$product.floorlevel','/all_purchases/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/../public','<h2>\x20','paid_amount','role','image','<h5\x20style=\x22text-align:\x20left;\x22>','../models/all_models','sendMail','forEach','add\x20post','gmail','</div>','prod_invoice','$product_details.bin','Shelves','Logo.png','room_name','English','<tr>','\x20Order\x20Number\x20:\x20','concat','stock_quantity','delivery_code','site_title','product_details','secondary_code','Return\x20Goods','getFullYear','Portuguese','production_date','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.pallet','Purchase\x20Return','host','$expiry_date','$suppliers','<!DOCTYPE\x20html>','$due_amount','$alertquantity','floorlevel','post','$product.type','$return_data','getMonth','warehouse_name','Rack\x20A','$product_details','$brand','length','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','/view/return_purchase/:id','rak','$_id','language','</h5>','Arabic','flash','standard_unit','$product_details.secondary_code','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','warehouse','primary_code_hide','deliverycode','message','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','MaxStocks_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<strong>\x20Regards\x20</strong>','email','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','status','type','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$paid_amount','purchase_quantity','push','$product_details.storage','findById','product_name','19vGWqjK','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','getDate','Floor','$product_details._id','floor','</span>','types','product_list','$suppliers_docs','../middleware/auth','aggregate','70BOZUBz','<h5>','payment\x20successfull','$primary_code','findOne','suppliers_docs','add_purchases\x20error','<tbody\x20style=\x22text-align:\x20center;\x22>','</head><body>','return_qty','Enabled','$date','table\x20page','log','German','map','room','save','$room','success','$product.bay','</tr>','prod_unit','prod_secondunit','slice','7833889MLpdIs','RoomAssign','Portuguese\x20(BR)','$product.room_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','JO_number','bin','$product_details.product_code','$product.quantity','\x20<>\x20','path','user_id','master','/view/add_purchases','storage','product_code_hide','Rack\x20F','Sales\x20Update\x20successfully','$invoice','\x20Order\x20Date\x20:\x20','actual_qty','$product_details.type','product','</tbody>','name','filter','$product_details.product_stock','/all_purchases/view/','currency','primary_code','\x20</h2>','error','Error\x20Occurs','maxperunit','$product_code','$product_details.floorlevel','<html><head><title></title>','due_amount','$product_details.bay','/barcode_scanner','user','invoice','purchase_invoice','delivery_date','staff','$product_details.isle','all_purchases_barcode','$secondary_unit','exports','body','max_product_unit','quantity','note','port','find','add_purchases','French','catch','prod_primunit','errors','<span\x20style=\x22float:\x20right;\x22>','747081hrsqmP','stocks','Purchase\x20Mail','$maxProdPerUnit','Purchase\x20data\x20added\x20successfully','isle','$product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','INC-','$product_details.level','rack','Arabic\x20(ae)','$secondary_code','alertQTY','$note','get','all','416334FtCKvb','English\x20(US)','nodemailer','</body></html>','prod_name','product_code','COLD\x20STORAGE','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Raw\x20Materials','prod_isle','<hr\x20class=\x22my-3\x22>','</td>','prod_code','POnumber','$product_details.rack','Spanish','string','purchase\x20data\x20update\x20successfully','$batch_code','Email\x20sent\x20successfully','currency_placement','$product_details.expiry_date','secondary_unit','level'];a0_0xf5ea=function(){return _0x3470ab;};return a0_0xf5ea();}router[a0_0x1b36e1(0x269)](a0_0x1b36e1(0x22a),auth,async(_0x5054c4,_0x2f6dbe)=>{var _0x3200d9=a0_0x1b36e1;try{const {username:_0x4cfb0f,email:_0x5db200,role:_0x24c070}=_0x5054c4['user'],_0x371409=_0x5054c4[_0x3200d9(0x245)],_0x2da764=await profile[_0x3200d9(0x208)]({'email':_0x371409[_0x3200d9(0x1ed)]}),_0x417328=await master_shop[_0x3200d9(0x253)](),_0x36f72c=await staff[_0x3200d9(0x208)]({'email':_0x371409[_0x3200d9(0x1ed)]}),_0x549ed6=await suppliers[_0x3200d9(0x253)]({});let _0x1ed466;if(_0x371409[_0x3200d9(0x1a8)]=='staff'){const _0x6ca9b0=await staff[_0x3200d9(0x208)]({'email':_0x371409[_0x3200d9(0x1ed)]});_0x1ed466=await warehouse[_0x3200d9(0x203)]([{'$match':{'status':'Enabled','name':_0x6ca9b0[_0x3200d9(0x1e4)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3200d9(0x1bf)}}},{'$group':{'_id':_0x3200d9(0x1d7),'name':{'$first':'$name'}}}]);}else _0x1ed466=await warehouse[_0x3200d9(0x203)]([{'$match':{'status':_0x3200d9(0x20e),'warehouse_category':_0x3200d9(0x15a),'name':{'$ne':_0x3200d9(0x1bf)}}},{'$group':{'_id':_0x3200d9(0x1d7),'name':{'$first':_0x3200d9(0x1d7)}}}]);const _0xb0b031=await product['find']({}),_0x2cc107=await warehouse[_0x3200d9(0x253)]({'status':_0x3200d9(0x20e)}),_0x10bb30=await purchases[_0x3200d9(0x253)]({}),_0x462865=_0x10bb30[_0x3200d9(0x1d6)]+0x1,_0x312d05='INC-'+_0x462865['toString']()['padStart'](0x5,'0');var _0x67fd56=['Ambient','Enclosed'];if(_0x417328[0x0][_0x3200d9(0x1dc)]==_0x3200d9(0x26c))var _0x359e38=users[_0x3200d9(0x1b6)];else{if(_0x417328[0x0][_0x3200d9(0x1dc)]==_0x3200d9(0x170))var _0x359e38=users['Hindi'];else{if(_0x417328[0x0][_0x3200d9(0x1dc)]==_0x3200d9(0x212))var _0x359e38=users[_0x3200d9(0x212)];else{if(_0x417328[0x0][_0x3200d9(0x1dc)]=='Spanish')var _0x359e38=users[_0x3200d9(0x161)];else{if(_0x417328[0x0][_0x3200d9(0x1dc)]==_0x3200d9(0x255))var _0x359e38=users[_0x3200d9(0x255)];else{if(_0x417328[0x0][_0x3200d9(0x1dc)]==_0x3200d9(0x21f))var _0x359e38=users[_0x3200d9(0x1c1)];else{if(_0x417328[0x0]['language']==_0x3200d9(0x181))var _0x359e38=users[_0x3200d9(0x181)];else{if(_0x417328[0x0]['language']==_0x3200d9(0x265))var _0x359e38=users[_0x3200d9(0x1de)];}}}}}}}const _0x5a30c9=getRandom8DigitNumber();_0x5a30c9[_0x3200d9(0x16c)](_0x3450e6=>{var _0x27cc37=_0x3200d9;_0x2f6dbe[_0x27cc37(0x19c)](_0x27cc37(0x254),{'success':_0x5054c4['flash'](_0x27cc37(0x217)),'errors':_0x5054c4[_0x27cc37(0x1df)](_0x27cc37(0x258)),'role':_0x371409,'profile':_0x2da764,'suppliers':_0x549ed6,'warehouse':_0x1ed466,'product':_0xb0b031,'invoice':_0x3450e6,'master_shop':_0x417328,'language':_0x359e38,'find_data':_0x2cc107,'rooms_data':_0x67fd56});})['catch'](_0x10ec6a=>{var _0x2f107b=_0x3200d9;_0x5054c4[_0x2f107b(0x1df)](_0x2f107b(0x258),_0x2f107b(0x159)),_0x2f6dbe[_0x2f107b(0x16d)](_0x2f107b(0x1a3));});}catch(_0x482e9b){console[_0x3200d9(0x211)](_0x482e9b);}}),router[a0_0x1b36e1(0x269)]('/view/add_purchases/:id',auth,async(_0x274e89,_0x31b6fa)=>{var _0x599e1f=a0_0x1b36e1;try{const _0x214433=_0x274e89[_0x599e1f(0x177)]['id'];console['log'](_0x214433);const _0x196ea1=await master_shop[_0x599e1f(0x253)]();console[_0x599e1f(0x211)](_0x599e1f(0x229),_0x196ea1);const _0x51188a=await product[_0x599e1f(0x208)]({'name':_0x214433});console['log']('product',_0x51188a),_0x31b6fa[_0x599e1f(0x1ef)](0xc8)['json']({'product_data':_0x51188a,'master':_0x196ea1});}catch(_0x288679){console[_0x599e1f(0x211)](_0x599e1f(0x20a),_0x288679);}}),router[a0_0x1b36e1(0x1ce)](a0_0x1b36e1(0x22a),auth,async(_0x55d629,_0x4935dd)=>{var _0x13da85=a0_0x1b36e1;try{const {invoice:_0x1e1fbb,date:_0x4da7fe,warehouse_name:_0x353a42,prod_name:_0x5728db,prod_code:_0x210474,prod_qty:_0x3bf6fb,prod_unit:_0xf2be2b,prod_secondunit:_0xd788f,prod_level:_0x3263d2,prod_isle:_0xe239fa,prod_pallet:_0x420fcd,note:_0x3b9e90,expiry_date:_0x387e8d,batch_code:_0x3169fb,payable:_0x4467c2,due_amount:_0x299504,Room_name:_0x32679e,primary_code:_0x2ae224,secondary_code:_0x4c1858,MaxStocks_data:_0x44fd68,PO_number:_0x2094bd,SCRN:_0x57a451,JO_number:_0x4d93d9}=_0x55d629['body'];if(typeof _0x5728db==_0x13da85(0x162))var _0x21b147=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x156)]],_0x33f78d=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x15e)]],_0x36cc69=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x17a)]],_0x4f1e2b=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x257)]],_0x68cfee=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x21b)]],_0x1cd80c=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x179)]],_0x536d65=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x23a)]],_0x53cdc7=[_0x55d629['body'][_0x13da85(0x1be)]],_0x1ae4d6=[_0x55d629['body'][_0x13da85(0x1ea)]],_0xedfcf2=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x1e8)]],_0x19bbab=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x174)]],_0x50567e=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x24f)]],_0x400598=[_0x55d629['body'][_0x13da85(0x267)]],_0x2fb4f4=[_0x55d629['body'][_0x13da85(0x1c2)]],_0x34e505=[_0x55d629['body']['prod_cat']],_0x499480=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x21e)]],_0x37d13e=[_0x55d629[_0x13da85(0x24e)]['deliverycode']],_0x3341ba=[_0x55d629['body']['prod_invoice']],_0x715b6b=[_0x55d629[_0x13da85(0x24e)][_0x13da85(0x231)]];else var _0x21b147=[..._0x55d629['body'][_0x13da85(0x156)]],_0x33f78d=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x15e)]],_0x36cc69=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x17a)]],_0x4f1e2b=[..._0x55d629['body'][_0x13da85(0x257)]],_0x68cfee=[..._0x55d629[_0x13da85(0x24e)]['prod_secondunit']],_0x1cd80c=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x179)]],_0x536d65=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x23a)]],_0x53cdc7=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x1be)]],_0x1ae4d6=[..._0x55d629[_0x13da85(0x24e)]['MaxStocks_data']],_0xedfcf2=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x1e8)]],_0x19bbab=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x174)]],_0x50567e=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x24f)]],_0x400598=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x267)]],_0x2fb4f4=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x1c2)]],_0x34e505=[..._0x55d629[_0x13da85(0x24e)]['prod_cat']],_0x499480=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x21e)]],_0x37d13e=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x1e6)]],_0x3341ba=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x1b1)]],_0x715b6b=[..._0x55d629[_0x13da85(0x24e)][_0x13da85(0x231)]];const _0xc04251=_0x21b147[_0x13da85(0x213)](_0x3a080a=>{return _0x3a080a={'product_name':_0x3a080a};});_0x715b6b[_0x13da85(0x1ad)]((_0x34c8ea,_0x2bc5be)=>{var _0x3522ac=_0x13da85;_0xc04251[_0x2bc5be][_0x3522ac(0x231)]=_0x34c8ea;}),_0x33f78d['forEach']((_0x292f8d,_0x2e879d)=>{var _0x454eaa=_0x13da85;_0xc04251[_0x2e879d][_0x454eaa(0x157)]=_0x292f8d;}),_0x36cc69[_0x13da85(0x1ad)]((_0x495959,_0x1ed768)=>{var _0x2a45bd=_0x13da85;_0xc04251[_0x1ed768][_0x2a45bd(0x250)]=_0x495959;}),_0x4f1e2b[_0x13da85(0x1ad)]((_0x4d0882,_0x3bbf66)=>{var _0xc3f235=_0x13da85;_0xc04251[_0x3bbf66][_0xc3f235(0x1e0)]=_0x4d0882;}),_0x68cfee[_0x13da85(0x1ad)]((_0x3cf25e,_0xa36c2c)=>{var _0x60d5e3=_0x13da85;_0xc04251[_0xa36c2c][_0x60d5e3(0x168)]=_0x3cf25e;}),_0x1cd80c[_0x13da85(0x1ad)]((_0x32d8ef,_0x8b10e3)=>{_0x499480['forEach']((_0x5a9f43,_0x15b31a)=>{var _0x28ac4a=a0_0x1974;if(_0x5a9f43==_0x28ac4a(0x192)&&_0x8b10e3==_0x15b31a){console['log'](_0x5a9f43+'\x20<\x20wew\x20>\x20'+_0x8b10e3+_0x28ac4a(0x226)+_0x15b31a+'\x20<>\x20'+_0x32d8ef);var _0x3ca234=_0x32d8ef[_0x28ac4a(0x21c)](0x3);_0xc04251[_0x8b10e3][_0x28ac4a(0x22b)]=_0x32d8ef[0x0],_0xc04251[_0x8b10e3][_0x28ac4a(0x264)]=_0x32d8ef[0x1],_0xc04251[_0x8b10e3][_0x28ac4a(0x195)]=0x0,_0xc04251[_0x8b10e3][_0x28ac4a(0x223)]=0x0,_0xc04251[_0x8b10e3][_0x28ac4a(0x1f0)]=_0x28ac4a(0x1fb),_0xc04251[_0x8b10e3]['floorlevel']=_0x3ca234;}else{if(_0x5a9f43==_0x28ac4a(0x1b3)&&_0x8b10e3==_0x15b31a){var _0x3ca234=_0x32d8ef[_0x28ac4a(0x21c)](0x3);_0xc04251[_0x8b10e3][_0x28ac4a(0x22b)]=_0x32d8ef[0x0],_0xc04251[_0x8b10e3][_0x28ac4a(0x264)]=_0x32d8ef[0x1],_0xc04251[_0x8b10e3][_0x28ac4a(0x195)]=0x0,_0xc04251[_0x8b10e3][_0x28ac4a(0x223)]=0x0,_0xc04251[_0x8b10e3][_0x28ac4a(0x1f0)]=_0x28ac4a(0x1fb),_0xc04251[_0x8b10e3][_0x28ac4a(0x1cd)]=_0x32d8ef[0x5];}else{if(_0x8b10e3==_0x15b31a){var _0x569150;if(_0x32d8ef[0x4]=='L')_0x569150='Level';else _0x32d8ef[0x4]=='F'&&(_0x569150='Floor');_0xc04251[_0x8b10e3]['storage']=_0x32d8ef[0x0],_0xc04251[_0x8b10e3][_0x28ac4a(0x264)]=_0x32d8ef[0x1],_0xc04251[_0x8b10e3][_0x28ac4a(0x195)]=_0x32d8ef[0x2],_0xc04251[_0x8b10e3][_0x28ac4a(0x223)]=_0x32d8ef[0x3],_0xc04251[_0x8b10e3][_0x28ac4a(0x1f0)]=_0x569150,_0xc04251[_0x8b10e3][_0x28ac4a(0x1cd)]=_0x32d8ef[0x5];}}}});}),_0x536d65[_0x13da85(0x1ad)]((_0x4b9507,_0x3a4da2)=>{var _0x51a9c3=_0x13da85;_0xc04251[_0x3a4da2][_0x51a9c3(0x23a)]=_0x4b9507;}),_0x53cdc7[_0x13da85(0x1ad)]((_0x5759f9,_0x43607c)=>{var _0x3d2378=_0x13da85;_0xc04251[_0x43607c][_0x3d2378(0x1be)]=_0x5759f9;}),_0x1ae4d6['forEach']((_0x502494,_0x1f765c)=>{_0xc04251[_0x1f765c]['maxStocks']=_0x502494;}),_0xedfcf2[_0x13da85(0x1ad)]((_0x353def,_0xdffa69)=>{var _0x15d849=_0x13da85;_0xc04251[_0xdffa69][_0x15d849(0x1e8)]=_0x353def;}),_0x19bbab[_0x13da85(0x1ad)]((_0x5c5017,_0x97547e)=>{var _0x4df8e9=_0x13da85;_0xc04251[_0x97547e][_0x4df8e9(0x174)]=_0x5c5017;}),_0x50567e[_0x13da85(0x1ad)]((_0x34c4a6,_0x56b9b2)=>{var _0x5add66=_0x13da85;_0xc04251[_0x56b9b2][_0x5add66(0x23e)]=_0x34c4a6;}),_0x400598['forEach']((_0x200501,_0x6bdcd1)=>{var _0x4e8f95=_0x13da85;_0xc04251[_0x6bdcd1][_0x4e8f95(0x267)]=_0x200501;}),_0x2fb4f4[_0x13da85(0x1ad)]((_0xda7909,_0x3acf95)=>{var _0x4a9ab=_0x13da85;_0xc04251[_0x3acf95][_0x4a9ab(0x1c2)]=_0xda7909;}),_0x34e505[_0x13da85(0x1ad)]((_0x4ac989,_0x451a14)=>{_0xc04251[_0x451a14]['product_cat']=_0x4ac989;}),_0x499480['forEach']((_0x5d5d8a,_0x2d7aa8)=>{var _0x78bf64=_0x13da85;_0xc04251[_0x2d7aa8][_0x78bf64(0x1b5)]=_0x5d5d8a;}),_0x37d13e[_0x13da85(0x1ad)]((_0x99ea0,_0x52e41b)=>{var _0x1c57bc=_0x13da85;_0xc04251[_0x52e41b][_0x1c57bc(0x1bb)]=_0x99ea0;}),_0x3341ba['forEach']((_0x4a686d,_0x1af4cf)=>{_0xc04251[_0x1af4cf]['invoice']=_0x4a686d;});const _0x46b205=_0x499480[_0x13da85(0x213)](_0x3ea97d=>{return _0x3ea97d={'room_name':_0x3ea97d};}),_0x8371ad=_0xc04251[_0x13da85(0x236)](_0x10a26f=>_0x10a26f['quantity']!=='0'&&_0x10a26f[_0x13da85(0x250)]!==''),_0x15dde3=new purchases({'invoice':_0x1e1fbb,'suppliers':_0x55d629[_0x13da85(0x24e)]['suppliers'],'date':_0x4da7fe,'warehouse_name':_0x353a42,'product':_0x8371ad,'note':_0x3b9e90,'due_amount':_0x299504,'POnumber':_0x2094bd,'SCRN':_0x57a451,'JO_number':_0x4d93d9,'roomList':_0x46b205}),_0x1e4564=await _0x15dde3['save'](),_0x13c47e=await purchases['findOne']({'invoice':_0x1e1fbb}),_0x5d8dc=_0x13c47e[_0x13da85(0x233)]['map'](async _0x2d2a04=>{var _0x2ca674=_0x13da85,_0x4495ff=await warehouse[_0x2ca674(0x208)]({'name':_0x353a42,'room':_0x2d2a04['room_name']}),_0x1bce25=0x0;return _0x4495ff[_0x2ca674(0x1bd)][_0x2ca674(0x1ad)](_0x5d158c=>{var _0x6d1758=_0x2ca674;_0x5d158c[_0x6d1758(0x1f7)]==_0x2d2a04[_0x6d1758(0x1f7)]&&_0x5d158c[_0x6d1758(0x1cd)]==_0x2d2a04[_0x6d1758(0x1cd)]&&_0x5d158c['type']==_0x2d2a04[_0x6d1758(0x1f0)]&&_0x5d158c[_0x6d1758(0x223)]==_0x2d2a04[_0x6d1758(0x223)]&&_0x5d158c[_0x6d1758(0x195)]==_0x2d2a04[_0x6d1758(0x195)]&&_0x5d158c[_0x6d1758(0x264)]==_0x2d2a04['rack']&&_0x5d158c[_0x6d1758(0x22b)]==_0x2d2a04[_0x6d1758(0x22b)]&&_0x5d158c[_0x6d1758(0x174)]==_0x2d2a04[_0x6d1758(0x174)]&&_0x5d158c[_0x6d1758(0x1e8)]==_0x2d2a04['batch_code']&&_0x5d158c[_0x6d1758(0x1c2)]==_0x2d2a04['production_date']&&_0x5d158c[_0x6d1758(0x246)]==_0x13c47e[_0x6d1758(0x246)]&&(_0x5d158c['product_stock']+=_0x2d2a04['quantity'],_0x1bce25++);}),_0x1bce25===0x0&&_0x4495ff['product_details'][_0x2ca674(0x1f4)]({'product_name':_0x2d2a04[_0x2ca674(0x1f7)],'product_stock':_0x2d2a04['quantity'],'primary_code':_0x2d2a04[_0x2ca674(0x23a)],'secondary_code':_0x2d2a04['secondary_code'],'product_code':_0x2d2a04['product_code'],'storage':_0x2d2a04[_0x2ca674(0x22b)],'rack':_0x2d2a04[_0x2ca674(0x264)],'bay':_0x2d2a04['bay'],'bin':_0x2d2a04[_0x2ca674(0x223)],'type':_0x2d2a04[_0x2ca674(0x1f0)],'floorlevel':_0x2d2a04[_0x2ca674(0x1cd)],'maxProducts':_0x2d2a04[_0x2ca674(0x17b)],'unit':_0x2d2a04[_0x2ca674(0x1e0)],'secondary_unit':_0x2d2a04[_0x2ca674(0x168)],'expiry_date':_0x2d2a04[_0x2ca674(0x174)],'maxPerUnit':_0x2d2a04[_0x2ca674(0x23e)],'batch_code':_0x2d2a04[_0x2ca674(0x1e8)],'alertQTY':_0x2d2a04[_0x2ca674(0x267)],'production_date':_0x2d2a04[_0x2ca674(0x1c2)],'product_cat':_0x2d2a04['product_cat'],'invoice':_0x2d2a04['invoice'],'actual_qty':_0x2d2a04[_0x2ca674(0x231)]}),_0x4495ff;});Promise[_0x13da85(0x26a)](_0x5d8dc)[_0x13da85(0x16c)](async _0x5584d6=>{var _0xdf40cc=_0x13da85;try{for(const _0x3a0e7f of _0x5584d6){await _0x3a0e7f[_0xdf40cc(0x215)]();}const _0x21bd4c=await master_shop['find'](),_0x46078b=await email_settings[_0xdf40cc(0x208)](),_0x5816b8=await supervisor_settings[_0xdf40cc(0x253)]();var _0x109382=_0x13c47e[_0xdf40cc(0x233)],_0x5b796c='',_0x7a6960;for(_0x7a6960 in _0x109382){_0x5b796c+=_0xdf40cc(0x1b7)+_0xdf40cc(0x1ee)+_0x109382[_0x7a6960][_0xdf40cc(0x1f7)]+_0xdf40cc(0x15d)+_0xdf40cc(0x1ee)+_0x109382[_0x7a6960][_0xdf40cc(0x157)]+_0xdf40cc(0x15d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x109382[_0x7a6960][_0xdf40cc(0x250)]+_0xdf40cc(0x15d)+_0xdf40cc(0x1ee)+_0x109382[_0x7a6960][_0xdf40cc(0x1e0)]+'</td>'+_0xdf40cc(0x1ee)+_0x109382[_0x7a6960][_0xdf40cc(0x168)]+_0xdf40cc(0x15d)+_0xdf40cc(0x1ee)+_0x13c47e[_0xdf40cc(0x1d2)]+_0xdf40cc(0x15d)+_0xdf40cc(0x1ee)+_0x109382[_0x7a6960][_0xdf40cc(0x1b5)]+_0xdf40cc(0x15d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x109382[_0x7a6960][_0xdf40cc(0x22b)]+_0x109382[_0x7a6960][_0xdf40cc(0x264)]+_0x109382[_0x7a6960][_0xdf40cc(0x195)]+_0x109382[_0x7a6960]['bin']+_0x109382[_0x7a6960][_0xdf40cc(0x1f0)][0x0]+_0x109382[_0x7a6960][_0xdf40cc(0x1cd)]+'</td>',_0xdf40cc(0x219);}let _0x319d3e=nodemailer[_0xdf40cc(0x171)]({'host':_0x46078b[_0xdf40cc(0x1c7)],'port':Number(_0x46078b[_0xdf40cc(0x252)]),'secure':![],'auth':{'user':_0x46078b['email'],'pass':_0x46078b[_0xdf40cc(0x16f)]}}),_0x486b32={'from':_0x46078b['email'],'to':_0x5816b8[0x0]['RMSEmail'],'subject':_0xdf40cc(0x25c),'attachments':[{'filename':_0xdf40cc(0x1b4),'path':__dirname+_0xdf40cc(0x1a5)+'/upload/'+_0x21bd4c[0x0][_0xdf40cc(0x1a9)],'cid':_0xdf40cc(0x189)}],'html':'<!DOCTYPE\x20html>'+_0xdf40cc(0x241)+_0xdf40cc(0x20c)+_0xdf40cc(0x19d)+_0xdf40cc(0x17f)+_0xdf40cc(0x19d)+_0xdf40cc(0x1eb)+_0xdf40cc(0x1b0)+_0xdf40cc(0x19d)+_0xdf40cc(0x1a6)+_0x21bd4c[0x0][_0xdf40cc(0x1bc)]+'\x20</h2>'+_0xdf40cc(0x1b0)+_0xdf40cc(0x1b0)+_0xdf40cc(0x15c)+_0xdf40cc(0x19d)+_0xdf40cc(0x1aa)+'\x20Order\x20Number\x20:\x20'+_0x13c47e[_0xdf40cc(0x246)]+'\x20'+_0xdf40cc(0x259)+'\x20Order\x20Date\x20:\x20'+_0x13c47e[_0xdf40cc(0x176)]+'\x20'+_0xdf40cc(0x1fe)+_0xdf40cc(0x1dd)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xdf40cc(0x182)+_0xdf40cc(0x1b7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xdf40cc(0x1a4)+_0xdf40cc(0x221)+_0xdf40cc(0x261)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0xdf40cc(0x1e9)+_0xdf40cc(0x173)+_0xdf40cc(0x219)+'</thead>'+_0xdf40cc(0x20b)+'\x20'+_0x5b796c+'\x20'+_0xdf40cc(0x234)+_0xdf40cc(0x18e)+_0xdf40cc(0x19d)+_0xdf40cc(0x1ec)+_0xdf40cc(0x205)+_0x21bd4c[0x0]['site_title']+_0xdf40cc(0x1dd)+_0xdf40cc(0x1b0)+_0xdf40cc(0x1b0)+'</body></html>'};_0x319d3e['sendMail'](_0x486b32,function(_0x99a8c7,_0x2d8270){var _0x43f9e0=_0xdf40cc;_0x99a8c7?(console['log'](_0x99a8c7),console[_0x43f9e0(0x211)](_0x43f9e0(0x23d))):console[_0x43f9e0(0x211)](_0x43f9e0(0x165));}),_0x55d629[_0xdf40cc(0x1df)](_0xdf40cc(0x217),_0xdf40cc(0x25e)),_0x4935dd['redirect'](_0xdf40cc(0x238));}catch(_0x53b4da){console['error'](_0x53b4da),_0x4935dd[_0xdf40cc(0x1ef)](0x1f4)[_0xdf40cc(0x1a0)]({'error':_0xdf40cc(0x16b)});}})[_0x13da85(0x256)](_0x569387=>{var _0x5f1a93=_0x13da85;console[_0x5f1a93(0x23c)](_0x569387),_0x4935dd['status'](0x1f4)[_0x5f1a93(0x1a0)]({'error':_0x5f1a93(0x18b)});});}catch(_0x4cd1a8){console['log'](_0x4cd1a8);}}),router[a0_0x1b36e1(0x269)]('/preview/:id',auth,async(_0x16a933,_0x13cbcc)=>{var _0x4061ae=a0_0x1b36e1;try{const {username:_0x1436f7,email:_0x260296,role:_0xf5aab1}=_0x16a933[_0x4061ae(0x245)],_0x395625=_0x16a933[_0x4061ae(0x245)],_0x5552d6=await profile['findOne']({'email':_0x395625[_0x4061ae(0x1ed)]}),_0x271a68=await master_shop[_0x4061ae(0x253)](),_0x566ede=_0x16a933[_0x4061ae(0x177)]['id'],_0x401d76=await purchases[_0x4061ae(0x1f6)](_0x566ede),_0x1b72ce=await warehouse['aggregate']([{'$match':{'name':_0x401d76[_0x4061ae(0x1d2)],'room':_0x401d76[_0x4061ae(0x214)]}},{'$unwind':_0x4061ae(0x1d4)},{'$group':{'_id':_0x4061ae(0x1fc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4061ae(0x243)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x4061ae(0x232)},'floorlevel':{'$first':_0x4061ae(0x240)},'primary_code':{'$first':_0x4061ae(0x18a)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4061ae(0x224)},'storage':{'$first':_0x4061ae(0x1f5)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4061ae(0x167)}}}]),_0x1f14b6=await customer[_0x4061ae(0x253)]({});let _0xb7388;if(_0x395625[_0x4061ae(0x1a8)]==_0x4061ae(0x249)){const _0x129f50=await staff['findOne']({'email':_0x395625[_0x4061ae(0x1ed)]});_0xb7388=await warehouse[_0x4061ae(0x203)]([{'$match':{'status':_0x4061ae(0x20e),'name':_0x129f50['warehouse']}},{'$group':{'_id':_0x4061ae(0x1d7),'name':{'$first':_0x4061ae(0x1d7)}}}]);}else _0xb7388=await warehouse['aggregate']([{'$match':{'status':_0x4061ae(0x20e)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x534764=await product[_0x4061ae(0x253)]({}),_0x1b4925=await suppliers['find']({}),_0x353cac=BayBinSelected(_0x401d76[_0x4061ae(0x1d2)],_0x401d76[_0x4061ae(0x214)]);if(_0x271a68[0x0][_0x4061ae(0x1dc)]==_0x4061ae(0x26c)){var _0x39cebb=users[_0x4061ae(0x1b6)];console['log'](_0x39cebb);}else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]==_0x4061ae(0x170))var _0x39cebb=users['Hindi'];else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]=='German')var _0x39cebb=users[_0x4061ae(0x212)];else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]=='Spanish')var _0x39cebb=users['Spanish'];else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]==_0x4061ae(0x255))var _0x39cebb=users[_0x4061ae(0x255)];else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]==_0x4061ae(0x21f))var _0x39cebb=users[_0x4061ae(0x1c1)];else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]==_0x4061ae(0x181))var _0x39cebb=users[_0x4061ae(0x181)];else{if(_0x271a68[0x0][_0x4061ae(0x1dc)]==_0x4061ae(0x265))var _0x39cebb=users[_0x4061ae(0x1de)];}}}}}}}_0x13cbcc[_0x4061ae(0x19c)](_0x4061ae(0x194),{'success':_0x16a933['flash'](_0x4061ae(0x217)),'errors':_0x16a933[_0x4061ae(0x1df)](_0x4061ae(0x258)),'role':_0x395625,'profile':_0x5552d6,'customer':_0x1f14b6,'warehouse':_0xb7388,'product':_0x1b72ce,'user':_0x401d76,'master_shop':_0x271a68,'unit':_0x534764,'language':_0x39cebb,'suppliers':_0x1b4925,'dataSelected':_0x353cac});}catch(_0x12bd44){console[_0x4061ae(0x211)](_0x12bd44);}}),router[a0_0x1b36e1(0x1ce)]('/preview/:id',auth,async(_0x556bdd,_0xc26a10)=>{var _0x156389=a0_0x1b36e1;try{const _0x335f15=_0x556bdd['params']['id'],{invoice:_0x5c880a,warehouse_name:_0x1aba36,Room_name:_0x521a8a}=_0x556bdd['body'],_0x415eb0=await warehouse[_0x156389(0x208)]({'name':_0x1aba36,'room':_0x521a8a}),_0x28eebe=await purchases[_0x156389(0x208)]({'invoice':_0x5c880a});_0x28eebe[_0x156389(0x233)][_0x156389(0x1ad)](_0x1e7547=>{var _0x302184=_0x156389,_0x253d64=0x0;const _0x5f0065=_0x415eb0['product_details'][_0x302184(0x213)](_0xb1a6f3=>{var _0x3deaa4=_0x302184;_0xb1a6f3[_0x3deaa4(0x1f7)]==_0x1e7547[_0x3deaa4(0x1f7)]&&_0xb1a6f3[_0x3deaa4(0x1cd)]==_0x1e7547[_0x3deaa4(0x1cd)]&&_0xb1a6f3[_0x3deaa4(0x1f0)]==_0x1e7547[_0x3deaa4(0x1f0)]&&_0xb1a6f3[_0x3deaa4(0x223)]==_0x1e7547['bin']&&_0xb1a6f3['bay']==_0x1e7547[_0x3deaa4(0x195)]&&_0xb1a6f3['rack']==_0x1e7547[_0x3deaa4(0x264)]&&_0xb1a6f3[_0x3deaa4(0x22b)]==_0x1e7547['storage']&&_0xb1a6f3[_0x3deaa4(0x174)]==_0x1e7547['expiry_date']&&_0xb1a6f3['batch_code']==_0x1e7547[_0x3deaa4(0x1e8)]&&_0xb1a6f3[_0x3deaa4(0x1c2)]==_0x1e7547[_0x3deaa4(0x1c2)]&&_0xb1a6f3['delivery_date']==_0x1e7547[_0x3deaa4(0x248)]&&_0xb1a6f3[_0x3deaa4(0x1bb)]==_0x1e7547[_0x3deaa4(0x1bb)]&&(_0xb1a6f3[_0x3deaa4(0x188)]=parseInt(_0xb1a6f3['product_stock'])+parseInt(_0x1e7547['quantity']),_0x253d64++);});_0x253d64=='0'&&(_0x415eb0[_0x302184(0x1bd)]=_0x415eb0[_0x302184(0x1bd)][_0x302184(0x1b9)]({'product_name':_0x1e7547[_0x302184(0x1f7)],'product_stock':_0x1e7547[_0x302184(0x250)],'primary_code':_0x1e7547[_0x302184(0x23a)],'secondary_code':_0x1e7547['secondary_code'],'product_code':_0x1e7547[_0x302184(0x157)],'storage':_0x1e7547[_0x302184(0x22b)],'rack':_0x1e7547[_0x302184(0x264)],'bay':_0x1e7547['bay'],'bin':_0x1e7547['bin'],'type':_0x1e7547[_0x302184(0x1f0)],'floorlevel':_0x1e7547[_0x302184(0x1cd)],'maxProducts':_0x1e7547[_0x302184(0x17b)],'unit':_0x1e7547[_0x302184(0x1e0)],'secondary_unit':_0x1e7547['secondary_unit'],'expiry_date':_0x1e7547['expiry_date'],'maxPerUnit':_0x1e7547[_0x302184(0x23e)],'batch_code':_0x1e7547[_0x302184(0x1e8)],'alertQTY':_0x1e7547['alertQTY'],'production_date':_0x1e7547['production_date'],'delivery_date':_0x1e7547[_0x302184(0x248)],'delivery_code':_0x1e7547['delivery_code']}));}),await _0x415eb0[_0x156389(0x215)](),_0x28eebe[_0x156389(0x17e)]=_0x156389(0x187);const _0x57d926=await _0x28eebe[_0x156389(0x215)]();_0x556bdd['flash']('success',_0x156389(0x22e)),_0xc26a10['redirect'](_0x156389(0x1a3));}catch(_0x8b1171){console['log'](_0x8b1171);}}),router[a0_0x1b36e1(0x269)](a0_0x1b36e1(0x198),auth,async(_0x3529af,_0x2d48bc)=>{var _0x118c0f=a0_0x1b36e1;try{const {username:_0x59c06f,email:_0x4768fe,role:_0x479de4}=_0x3529af[_0x118c0f(0x245)],_0x3b8869=_0x3529af[_0x118c0f(0x245)],_0x12d79f=await profile[_0x118c0f(0x208)]({'email':_0x3b8869[_0x118c0f(0x1ed)]}),_0xfd07b=await master_shop[_0x118c0f(0x253)](),_0x307e0f=_0x3529af[_0x118c0f(0x177)]['id'],_0x4120c6=await purchases['findById'](_0x307e0f),_0xea1ca2=await suppliers[_0x118c0f(0x253)]({});let _0x4af73f;if(_0x3b8869['role']==_0x118c0f(0x249)){const _0x578cd4=await staff[_0x118c0f(0x208)]({'email':_0x3b8869[_0x118c0f(0x1ed)]});_0x4af73f=await warehouse['find']({'status':_0x118c0f(0x20e),'name':_0x578cd4['warehouse'],'warehouse_category':'Raw\x20Materials'});}else _0x4af73f=await warehouse['aggregate']([{'$match':{'status':_0x118c0f(0x20e),'warehouse_category':_0x118c0f(0x15a)}},{'$group':{'_id':'$name','name':{'$first':_0x118c0f(0x1d7)}}}]);const _0x56dc9d=await product[_0x118c0f(0x253)]({}),_0x2a68db=BayBinSelected(_0x4120c6[_0x118c0f(0x1d2)],_0x4120c6[_0x118c0f(0x214)]);let _0x189648=new Date(_0x4120c6[_0x118c0f(0x174)]),_0x25a816=('0'+_0x189648[_0x118c0f(0x1fa)]())[_0x118c0f(0x21c)](-0x2),_0x5cef09=('0'+(_0x189648[_0x118c0f(0x1d1)]()+0x1))[_0x118c0f(0x21c)](-0x2),_0x36eca7=_0x189648['getFullYear'](),_0x1a709b=_0x36eca7+'-'+_0x5cef09+'-'+_0x25a816;if(_0xfd07b[0x0][_0x118c0f(0x1dc)]==_0x118c0f(0x26c)){var _0x36837e=users[_0x118c0f(0x1b6)];console[_0x118c0f(0x211)](_0x36837e);}else{if(_0xfd07b[0x0]['language']==_0x118c0f(0x170))var _0x36837e=users[_0x118c0f(0x170)];else{if(_0xfd07b[0x0][_0x118c0f(0x1dc)]==_0x118c0f(0x212))var _0x36837e=users[_0x118c0f(0x212)];else{if(_0xfd07b[0x0][_0x118c0f(0x1dc)]=='Spanish')var _0x36837e=users[_0x118c0f(0x161)];else{if(_0xfd07b[0x0]['language']==_0x118c0f(0x255))var _0x36837e=users[_0x118c0f(0x255)];else{if(_0xfd07b[0x0][_0x118c0f(0x1dc)]==_0x118c0f(0x21f))var _0x36837e=users[_0x118c0f(0x1c1)];else{if(_0xfd07b[0x0]['language']==_0x118c0f(0x181))var _0x36837e=users[_0x118c0f(0x181)];else{if(_0xfd07b[0x0][_0x118c0f(0x1dc)]==_0x118c0f(0x265))var _0x36837e=users[_0x118c0f(0x1de)];}}}}}}}_0x2d48bc[_0x118c0f(0x19c)](_0x118c0f(0x17d),{'success':_0x3529af[_0x118c0f(0x1df)](_0x118c0f(0x217)),'errors':_0x3529af[_0x118c0f(0x1df)](_0x118c0f(0x258)),'role':_0x3b8869,'profile':_0x12d79f,'purchases':_0x4120c6,'suppliers':_0xea1ca2,'warehouse':_0x4af73f,'product':_0x56dc9d,'master_shop':_0xfd07b,'language':_0x36837e,'ed_fullDate':_0x1a709b,'dataSelected':_0x2a68db});}catch(_0x13dbc9){console[_0x118c0f(0x211)](_0x13dbc9);}}),router[a0_0x1b36e1(0x1ce)]('/view/:id',auth,async(_0x9c563a,_0x414b80)=>{var _0x128f28=a0_0x1b36e1;try{const _0x412d68=_0x9c563a[_0x128f28(0x177)]['id'],_0x1e576d=await purchases[_0x128f28(0x208)]({'_id':_0x9c563a['params']['id']}),_0x40b244=await warehouse[_0x128f28(0x208)]({'name':_0x1e576d[_0x128f28(0x1d2)],'room':_0x1e576d[_0x128f28(0x214)]});_0x1e576d[_0x128f28(0x233)][_0x128f28(0x1ad)](_0x79143e=>{var _0x28865b=_0x128f28;const _0x11ee2a=_0x40b244[_0x28865b(0x1bd)][_0x28865b(0x213)](_0x2712dd=>{var _0x3bdad3=_0x28865b;_0x2712dd[_0x3bdad3(0x1f7)]==_0x79143e['product_name']&&_0x2712dd['floorlevel']==_0x79143e[_0x3bdad3(0x1cd)]&&_0x2712dd['type']==_0x79143e['type']&&_0x2712dd[_0x3bdad3(0x223)]==_0x79143e[_0x3bdad3(0x223)]&&_0x2712dd[_0x3bdad3(0x195)]==_0x79143e[_0x3bdad3(0x195)]&&_0x2712dd['rack']==_0x79143e[_0x3bdad3(0x264)]&&_0x2712dd[_0x3bdad3(0x22b)]==_0x79143e[_0x3bdad3(0x22b)]&&(_0x2712dd[_0x3bdad3(0x188)]=parseInt(_0x2712dd['product_stock'])-parseInt(_0x79143e[_0x3bdad3(0x250)]));});}),await _0x40b244[_0x128f28(0x215)]();const {invoice:_0x15a8f5,suppliers:_0x48c26b,date:_0x251f12,warehouse_name:_0x395cf4,prod_name:_0xe6b4fc,prod_code:_0x4958a2,prod_qty:_0x37ef16,prod_unit:_0x21ed96,prod_secondunit:_0x12de2b,prod_level:_0x26ee1c,prod_isle:_0x347ae7,prod_pallet:_0x370c57,note:_0x26c487,expiry_date:_0x2b9096,batch_code:_0x2bdc02,paid_amount:_0xc8fc91,due_amount:_0x768f41,Room_name:_0x3358d8,primary_code:_0x24fa44,secondary_code:_0x258a15,PO_number:_0x34aacf,JO_number:_0xa7086b}=_0x9c563a[_0x128f28(0x24e)];if(typeof _0xe6b4fc==_0x128f28(0x162))var _0x5aa45f=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x156)]],_0x2a9242=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x15e)]],_0x4b1b46=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x185)]],_0x5847e3=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x21a)]],_0x206a20=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x21b)]],_0x4f8409=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x179)]],_0x2f888a=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x15b)]],_0x1c0f95=[_0x9c563a[_0x128f28(0x24e)]['prod_pallet']],_0x3c2cf6=[_0x9c563a[_0x128f28(0x24e)]['primary_code']],_0x1555c5=[_0x9c563a['body'][_0x128f28(0x1be)]],_0x15765d=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x1ea)]],_0x257ae5=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x1e8)]],_0x4e0a37=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x174)]],_0x1d0e79=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x22b)]],_0x43754b=[_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x1da)]],_0x74f1a2=[_0x9c563a[_0x128f28(0x24e)]['type']];else var _0x5aa45f=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x156)]],_0x2a9242=[..._0x9c563a[_0x128f28(0x24e)]['prod_code']],_0x4b1b46=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x185)]],_0x5847e3=[..._0x9c563a[_0x128f28(0x24e)]['prod_unit']],_0x206a20=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x21b)]],_0x4f8409=[..._0x9c563a['body'][_0x128f28(0x179)]],_0x2f888a=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x15b)]],_0x1c0f95=[..._0x9c563a['body'][_0x128f28(0x190)]],_0x3c2cf6=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x23a)]],_0x1555c5=[..._0x9c563a['body']['secondary_code']],_0x15765d=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x1ea)]],_0x257ae5=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x1e8)]],_0x4e0a37=[..._0x9c563a[_0x128f28(0x24e)]['expiry_date']],_0x1d0e79=[..._0x9c563a[_0x128f28(0x24e)][_0x128f28(0x22b)]],_0x43754b=[..._0x9c563a[_0x128f28(0x24e)]['rak']],_0x74f1a2=[..._0x9c563a['body'][_0x128f28(0x1f0)]];const _0x524c54=_0x5aa45f[_0x128f28(0x213)](_0x3829e8=>{return _0x3829e8={'product_name':_0x3829e8};});_0x2a9242[_0x128f28(0x1ad)]((_0x496041,_0x36f9fb)=>{var _0x58be69=_0x128f28;_0x524c54[_0x36f9fb][_0x58be69(0x157)]=_0x496041;}),_0x4b1b46[_0x128f28(0x1ad)]((_0x25907a,_0x44bfab)=>{_0x524c54[_0x44bfab]['quantity']=_0x25907a;}),_0x5847e3['forEach']((_0x914cf,_0x4e00ab)=>{var _0x170263=_0x128f28;_0x524c54[_0x4e00ab][_0x170263(0x1e0)]=_0x914cf;}),_0x206a20['forEach']((_0x347697,_0x755819)=>{var _0x592b14=_0x128f28;_0x524c54[_0x755819][_0x592b14(0x168)]=_0x347697;}),_0x4f8409['forEach']((_0x382d63,_0x3d31e6)=>{_0x524c54[_0x3d31e6]['bay']=_0x382d63;}),_0x2f888a['forEach']((_0x48e3d6,_0x38b250)=>{var _0x1c7a8a=_0x128f28;_0x524c54[_0x38b250][_0x1c7a8a(0x223)]=_0x48e3d6;}),_0x1c0f95[_0x128f28(0x1ad)]((_0x3aed7d,_0x4fc7b7)=>{var _0x3202cd=_0x128f28;_0x524c54[_0x4fc7b7][_0x3202cd(0x1cd)]=_0x3aed7d;}),_0x3c2cf6['forEach']((_0x4963ff,_0x40afb0)=>{_0x524c54[_0x40afb0]['primary_code']=_0x4963ff;}),_0x1555c5[_0x128f28(0x1ad)]((_0x3b0e0c,_0x272523)=>{var _0x3a12b0=_0x128f28;_0x524c54[_0x272523][_0x3a12b0(0x1be)]=_0x3b0e0c;}),_0x15765d[_0x128f28(0x1ad)]((_0x22baf7,_0x4951c1)=>{var _0x44c4d2=_0x128f28;_0x524c54[_0x4951c1][_0x44c4d2(0x17b)]=_0x22baf7;}),_0x257ae5[_0x128f28(0x1ad)]((_0x19dd13,_0x545fb7)=>{var _0x249c3a=_0x128f28;_0x524c54[_0x545fb7][_0x249c3a(0x1e8)]=_0x19dd13;}),_0x4e0a37['forEach']((_0x19601b,_0x552138)=>{var _0x35d9b3=_0x128f28;_0x524c54[_0x552138][_0x35d9b3(0x174)]=_0x19601b;}),_0x74f1a2['forEach']((_0xad362c,_0x4c2933)=>{var _0x3dfd24=_0x128f28;_0x524c54[_0x4c2933][_0x3dfd24(0x1f0)]=_0xad362c;}),_0x1d0e79[_0x128f28(0x1ad)]((_0x4d7368,_0x8cc0d7)=>{var _0x4b218c=_0x128f28;_0x524c54[_0x8cc0d7][_0x4b218c(0x22b)]=_0x4d7368;}),_0x43754b[_0x128f28(0x1ad)]((_0x1e4bf7,_0x25086b)=>{var _0x308c57=_0x128f28;_0x524c54[_0x25086b][_0x308c57(0x264)]=_0x1e4bf7;});const _0x374e86=_0x524c54[_0x128f28(0x236)](_0x29d828=>_0x29d828[_0x128f28(0x250)]!=='0'&&_0x29d828[_0x128f28(0x250)]!=='');_0x1e576d[_0x128f28(0x246)]=_0x15a8f5,_0x1e576d[_0x128f28(0x186)]=_0x48c26b,_0x1e576d[_0x128f28(0x176)]=_0x251f12,_0x1e576d['warehouse_name']=_0x395cf4,_0x1e576d[_0x128f28(0x233)]=_0x374e86,_0x1e576d[_0x128f28(0x251)]=_0x26c487,_0x1e576d[_0x128f28(0x1a7)]=_0xc8fc91,_0x1e576d[_0x128f28(0x242)]=_0x768f41,_0x1e576d['room']=_0x3358d8,_0x1e576d[_0x128f28(0x15f)]=_0x34aacf,_0x1e576d[_0x128f28(0x222)]=_0xa7086b;const _0x4cb0fa=await _0x1e576d[_0x128f28(0x215)](),_0x1347a1=await warehouse[_0x128f28(0x208)]({'name':_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x1d2)],'room':_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x17c)]});_0x1e576d[_0x128f28(0x233)]['forEach'](_0x512388=>{var _0x125bf8=_0x128f28,_0x38fe7d=0x0;const _0xa7354b=_0x1347a1[_0x125bf8(0x1bd)]['map'](_0x2157d3=>{var _0x340f3f=_0x125bf8;_0x2157d3[_0x340f3f(0x1f7)]==_0x512388[_0x340f3f(0x1f7)]&&_0x2157d3['floorlevel']==_0x512388[_0x340f3f(0x1cd)]&&_0x2157d3[_0x340f3f(0x1f0)]==_0x512388[_0x340f3f(0x1f0)]&&_0x2157d3['bin']==_0x512388[_0x340f3f(0x223)]&&_0x2157d3[_0x340f3f(0x195)]==_0x512388['bay']&&_0x2157d3['rack']==_0x512388['rack']&&_0x2157d3[_0x340f3f(0x22b)]==_0x512388[_0x340f3f(0x22b)]&&(_0x2157d3[_0x340f3f(0x188)]=parseInt(_0x2157d3[_0x340f3f(0x188)])+parseInt(_0x512388[_0x340f3f(0x250)]),_0x38fe7d++);});_0x38fe7d=='0'&&(_0x1347a1[_0x125bf8(0x1bd)]=_0x1347a1[_0x125bf8(0x1bd)]['concat']({'product_name':_0x512388['product_name'],'product_stock':_0x512388[_0x125bf8(0x250)],'primary_code':_0x512388[_0x125bf8(0x23a)],'secondary_code':_0x512388[_0x125bf8(0x1be)],'product_code':_0x512388[_0x125bf8(0x157)],'storage':_0x512388[_0x125bf8(0x22b)],'rack':_0x512388[_0x125bf8(0x264)],'bay':_0x512388[_0x125bf8(0x195)],'bin':_0x512388[_0x125bf8(0x223)],'type':_0x512388[_0x125bf8(0x1f0)],'floorlevel':_0x512388[_0x125bf8(0x1cd)],'maxProducts':_0x512388[_0x125bf8(0x17b)],'unit':_0x512388[_0x125bf8(0x1e0)],'secondary_unit':_0x512388[_0x125bf8(0x168)],'expiry_date':_0x512388[_0x125bf8(0x174)]}));}),await _0x1347a1['save']();const _0x1a1753=await s_payment_data[_0x128f28(0x208)]({'invoice':_0x9c563a[_0x128f28(0x24e)]['invoice']});if(_0x1a1753===null){}else console[_0x128f28(0x211)](_0x128f28(0x186),_0x1a1753,_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x246)]),_0x1a1753['suppliers']=_0x9c563a[_0x128f28(0x24e)][_0x128f28(0x186)],await _0x1a1753[_0x128f28(0x215)]();_0x9c563a[_0x128f28(0x1df)](_0x128f28(0x217),_0x128f28(0x163)),_0x414b80[_0x128f28(0x16d)](_0x128f28(0x1a3));}catch(_0x4485f8){console[_0x128f28(0x211)](_0x4485f8);}}),router[a0_0x1b36e1(0x1ce)]('/give_payment/:id',auth,async(_0x59e09a,_0x417073)=>{var _0x2ec628=a0_0x1b36e1;try{const _0x92cb5f=_0x59e09a['params']['id'],{invoice:_0x31dd27,suppliers:_0x2e57be,payable:_0x43aa19,due_amount:_0x3c3c2b}=_0x59e09a[_0x2ec628(0x24e)],_0x1f39e6=await purchases[_0x2ec628(0x1f6)](_0x92cb5f);var _0x45d524=_0x43aa19-_0x3c3c2b;_0x1f39e6[_0x2ec628(0x1a7)]=parseFloat(_0x1f39e6['paid_amount'])+parseFloat(_0x3c3c2b),_0x1f39e6[_0x2ec628(0x242)]=_0x45d524;const _0x38b53e=await _0x1f39e6['save']();console[_0x2ec628(0x211)](_0x38b53e);const _0x1c0f21=await s_payment_data[_0x2ec628(0x208)]({'invoice':_0x31dd27});_0x1c0f21[_0x2ec628(0x1c3)]=_0x45d524,await _0x1c0f21[_0x2ec628(0x215)]();let _0x478f91=new Date(),_0x8a6d0a=('0'+_0x478f91[_0x2ec628(0x1fa)]())[_0x2ec628(0x21c)](-0x2),_0x20f88b=('0'+(_0x478f91[_0x2ec628(0x1d1)]()+0x1))[_0x2ec628(0x21c)](-0x2),_0x27408b=_0x478f91[_0x2ec628(0x1c0)](),_0x318106=_0x27408b+'-'+_0x20f88b+'-'+_0x8a6d0a;const _0x316414=new suppliers_payment({'invoice':_0x31dd27,'date':_0x27408b+'-'+_0x20f88b+'-'+_0x8a6d0a,'suppliers':_0x2e57be,'reason':_0x2ec628(0x19b),'amount':_0x3c3c2b}),_0x768b5f=await _0x316414['save']();_0x59e09a[_0x2ec628(0x1df)](_0x2ec628(0x217),_0x2ec628(0x206)),_0x417073['redirect'](_0x2ec628(0x1a3));}catch(_0x6e85a7){console[_0x2ec628(0x211)](_0x6e85a7);}}),router[a0_0x1b36e1(0x269)]('/invoice/:id',auth,async(_0xf92d9d,_0x3e64cd)=>{var _0x267b45=a0_0x1b36e1;try{const {username:_0xfe5685,email:_0x15510b,role:_0x29ef61}=_0xf92d9d[_0x267b45(0x245)],_0xfd0264=_0xf92d9d[_0x267b45(0x245)],_0x5be35e=await profile[_0x267b45(0x208)]({'email':_0xfd0264['email']}),_0x72efce=await master_shop['find']();console[_0x267b45(0x211)](_0x267b45(0x229),_0x72efce);const _0x1b47c5=_0xf92d9d[_0x267b45(0x177)]['id'],_0x14781a=await purchases['findById'](_0x1b47c5);console[_0x267b45(0x211)](_0x14781a);const _0x50ca6c=await suppliers[_0x267b45(0x208)]({'name':_0x14781a[_0x267b45(0x186)]});console[_0x267b45(0x211)](_0x50ca6c);if(_0x72efce[0x0][_0x267b45(0x1dc)]=='English\x20(US)'){var _0x93f355=users['English'];console[_0x267b45(0x211)](_0x93f355);}else{if(_0x72efce[0x0][_0x267b45(0x1dc)]==_0x267b45(0x170))var _0x93f355=users[_0x267b45(0x170)];else{if(_0x72efce[0x0]['language']==_0x267b45(0x212))var _0x93f355=users['German'];else{if(_0x72efce[0x0][_0x267b45(0x1dc)]==_0x267b45(0x161))var _0x93f355=users['Spanish'];else{if(_0x72efce[0x0][_0x267b45(0x1dc)]==_0x267b45(0x255))var _0x93f355=users[_0x267b45(0x255)];else{if(_0x72efce[0x0][_0x267b45(0x1dc)]=='Portuguese\x20(BR)')var _0x93f355=users[_0x267b45(0x1c1)];else{if(_0x72efce[0x0][_0x267b45(0x1dc)]==_0x267b45(0x181))var _0x93f355=users['Chinese'];else{if(_0x72efce[0x0]['language']=='Arabic\x20(ae)')var _0x93f355=users[_0x267b45(0x1de)];}}}}}}}_0x3e64cd[_0x267b45(0x19c)](_0x267b45(0x247),{'success':_0xf92d9d['flash'](_0x267b45(0x217)),'errors':_0xf92d9d[_0x267b45(0x1df)](_0x267b45(0x258)),'role':_0xfd0264,'profile':_0x5be35e,'master_shop':_0x72efce,'supplier':_0x50ca6c,'purchase':_0x14781a,'language':_0x93f355});}catch(_0x5971e0){console['log'](_0x5971e0);}}),router['get'](a0_0x1b36e1(0x1d9),auth,async(_0xc2c9b8,_0x242c90)=>{var _0x9bdeb9=a0_0x1b36e1;try{const {username:_0x385f95,email:_0x2144d6,role:_0x3767e1}=_0xc2c9b8[_0x9bdeb9(0x245)],_0x6f12db=_0xc2c9b8['user'],_0x2cb67b=await profile[_0x9bdeb9(0x208)]({'email':_0x6f12db[_0x9bdeb9(0x1ed)]}),_0x3e131c=await master_shop[_0x9bdeb9(0x253)]();console[_0x9bdeb9(0x211)](_0x9bdeb9(0x229),_0x3e131c);const _0x35dccd=_0xc2c9b8['params']['id'];console[_0x9bdeb9(0x211)](_0x35dccd);const _0x2d4f1e=await purchases['findById'](_0x35dccd);console[_0x9bdeb9(0x211)](_0x9bdeb9(0x228),_0x2d4f1e);const _0x46126f=await product['find']({}),_0x5244f4=await warehouse[_0x9bdeb9(0x203)]([{'$match':{'name':_0x2d4f1e[_0x9bdeb9(0x1d2)],'room':_0x2d4f1e[_0x9bdeb9(0x214)],'warehouse_category':_0x9bdeb9(0x15a)}},{'$unwind':_0x9bdeb9(0x1d4)},{'$group':{'_id':_0x9bdeb9(0x1fc),'name':{'$first':_0x9bdeb9(0x196)},'product_stock':{'$first':_0x9bdeb9(0x237)},'bay':{'$first':_0x9bdeb9(0x243)},'bin':{'$first':_0x9bdeb9(0x1b2)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x9bdeb9(0x240)},'primary_code':{'$first':_0x9bdeb9(0x18a)},'secondary_code':{'$first':_0x9bdeb9(0x1e1)},'product_code':{'$first':_0x9bdeb9(0x224)},'storage':{'$first':_0x9bdeb9(0x1f5)},'rack':{'$first':_0x9bdeb9(0x160)}}}]);warehouse_data=await warehouse[_0x9bdeb9(0x203)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x9bdeb9(0x15a)}},{'$group':{'_id':_0x9bdeb9(0x1d7),'name':{'$first':_0x9bdeb9(0x1d7)}}},{'$sort':{'name':0x1}}]),console[_0x9bdeb9(0x211)]('stock_data',_0x5244f4);if(_0x3e131c[0x0]['language']==_0x9bdeb9(0x26c)){var _0x4bb33e=users[_0x9bdeb9(0x1b6)];console[_0x9bdeb9(0x211)](_0x4bb33e);}else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]=='Hindi')var _0x4bb33e=users['Hindi'];else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]==_0x9bdeb9(0x212))var _0x4bb33e=users[_0x9bdeb9(0x212)];else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]==_0x9bdeb9(0x161))var _0x4bb33e=users[_0x9bdeb9(0x161)];else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]==_0x9bdeb9(0x255))var _0x4bb33e=users[_0x9bdeb9(0x255)];else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]==_0x9bdeb9(0x21f))var _0x4bb33e=users[_0x9bdeb9(0x1c1)];else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]==_0x9bdeb9(0x181))var _0x4bb33e=users[_0x9bdeb9(0x181)];else{if(_0x3e131c[0x0][_0x9bdeb9(0x1dc)]==_0x9bdeb9(0x265))var _0x4bb33e=users[_0x9bdeb9(0x1de)];}}}}}}}_0x242c90[_0x9bdeb9(0x19c)](_0x9bdeb9(0x18f),{'success':_0xc2c9b8['flash']('success'),'errors':_0xc2c9b8[_0x9bdeb9(0x1df)]('errors'),'role':_0x6f12db,'profile':_0x2cb67b,'user':_0x2d4f1e,'stock':_0x5244f4,'master_shop':_0x3e131c,'product':_0x46126f,'language':_0x4bb33e,'warehouse':warehouse_data});}catch(_0x468f50){console[_0x9bdeb9(0x211)](_0x468f50);}}),router['post'](a0_0x1b36e1(0x1d9),auth,async(_0x2ba0de,_0x30c5bd)=>{var _0x255b7c=a0_0x1b36e1;try{const {invoice:_0x267b01,date:_0xe430f1,warehouse_name:_0x5c1881,Room_name:_0x424c04,product_name:_0x2e2754,purchase_quantity:_0x436ab3,stocks:_0x5bcf1f,return_qty:_0x6d5c64,note:_0x3638c4,level:_0x108c85,isle:_0x53e283,pallet:_0x390a8f,to_warehouse_name:_0x21bb6f,to_Room_name:_0x164932}=_0x2ba0de['body'],_0x78ac3d=await purchases[_0x255b7c(0x208)]({'_id':_0x2ba0de[_0x255b7c(0x177)]['id']}),_0x58d04a=await warehouse[_0x255b7c(0x208)]({'name':_0x5c1881,'room':_0x424c04});if(typeof _0x2e2754==_0x255b7c(0x162))var _0x415097=[_0x2ba0de['body'][_0x255b7c(0x1f7)]],_0x113808=[_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x1f3)]],_0x3dde57=[_0x2ba0de['body'][_0x255b7c(0x25b)]],_0x3c8625=[_0x2ba0de['body'][_0x255b7c(0x20d)]],_0x57a27f=[_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x169)]],_0x30fab7=[_0x2ba0de['body']['isle']],_0x50b2ea=[_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x180)]],_0x2ca36b=[_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x1ff)]],_0x1e2cc2=[_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x22c)]],_0x29e14a=[_0x2ba0de['body'][_0x255b7c(0x1e5)]],_0xebca31=[_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x16a)]];else var _0x415097=[..._0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x1f7)]],_0x113808=[..._0x2ba0de['body'][_0x255b7c(0x1f3)]],_0x3dde57=[..._0x2ba0de[_0x255b7c(0x24e)]['stocks']],_0x3c8625=[..._0x2ba0de['body'][_0x255b7c(0x20d)]],_0x57a27f=[..._0x2ba0de['body'][_0x255b7c(0x169)]],_0x30fab7=[..._0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x25f)]],_0x50b2ea=[..._0x2ba0de['body'][_0x255b7c(0x180)]],_0x2ca36b=[..._0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x1ff)]],_0x1e2cc2=[..._0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x22c)]],_0x29e14a=[..._0x2ba0de[_0x255b7c(0x24e)]['primary_code_hide']],_0xebca31=[..._0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x16a)]];const _0x29187d=_0x415097[_0x255b7c(0x213)](_0x558c35=>{return _0x558c35={'product_name':_0x558c35};});_0x113808[_0x255b7c(0x1ad)]((_0x38f4f9,_0xac0afc)=>{var _0x2ae2fe=_0x255b7c;_0x29187d[_0xac0afc][_0x2ae2fe(0x1f3)]=_0x38f4f9;}),_0x3dde57[_0x255b7c(0x1ad)]((_0x16cd72,_0x4d28c9)=>{var _0x5867d9=_0x255b7c;_0x29187d[_0x4d28c9][_0x5867d9(0x1ba)]=_0x16cd72;}),_0x3c8625['forEach']((_0x42e3a0,_0x1a79fd)=>{var _0x3311bb=_0x255b7c;_0x29187d[_0x1a79fd][_0x3311bb(0x20d)]=_0x42e3a0;}),_0x57a27f[_0x255b7c(0x1ad)]((_0x500227,_0x5aa031)=>{var _0x28a073=_0x255b7c;_0x29187d[_0x5aa031][_0x28a073(0x195)]=_0x500227;}),_0x30fab7[_0x255b7c(0x1ad)]((_0x3be416,_0x26f992)=>{_0x29187d[_0x26f992]['bin']=_0x3be416;}),_0x50b2ea['forEach']((_0x4cffc4,_0x4e941a)=>{_0x29187d[_0x4e941a]['floorlevel']=_0x4cffc4;}),_0x2ca36b[_0x255b7c(0x1ad)]((_0x498328,_0x521903)=>{var _0x4bc1b3=_0x255b7c;_0x29187d[_0x521903][_0x4bc1b3(0x1f0)]=_0x498328;}),_0x1e2cc2[_0x255b7c(0x1ad)]((_0x43312b,_0x27b573)=>{var _0x12f268=_0x255b7c;_0x29187d[_0x27b573][_0x12f268(0x157)]=_0x43312b;}),_0x29e14a[_0x255b7c(0x1ad)]((_0x3d66b2,_0x31de25)=>{var _0x5dd2cc=_0x255b7c;_0x29187d[_0x31de25][_0x5dd2cc(0x23a)]=_0x3d66b2;}),_0xebca31['forEach']((_0x33253e,_0x2f8009)=>{_0x29187d[_0x2f8009]['secondary_code']=_0x33253e;}),_0x78ac3d[_0x255b7c(0x233)][_0x255b7c(0x1ad)](_0x3f25ce=>{var _0x551c9e=_0x255b7c;const _0x2251f4=_0x58d04a[_0x551c9e(0x1bd)]['map'](_0x5c5907=>{var _0x4710b2=_0x551c9e;_0x5c5907[_0x4710b2(0x1f7)]==_0x3f25ce[_0x4710b2(0x1f7)]&&_0x5c5907[_0x4710b2(0x1cd)]==_0x3f25ce[_0x4710b2(0x1cd)]&&_0x5c5907[_0x4710b2(0x1f0)]==_0x3f25ce[_0x4710b2(0x1f0)]&&_0x5c5907[_0x4710b2(0x223)]==_0x3f25ce['bin']&&_0x5c5907['bay']==_0x3f25ce['bay']&&_0x5c5907[_0x4710b2(0x264)]==_0x3f25ce[_0x4710b2(0x264)]&&_0x5c5907[_0x4710b2(0x22b)]==_0x3f25ce[_0x4710b2(0x22b)]&&(console['log'](parseInt(_0x5c5907[_0x4710b2(0x188)])+'\x20<>\x20'+parseInt(_0x3f25ce[_0x4710b2(0x250)])),_0x5c5907[_0x4710b2(0x188)]=parseInt(_0x5c5907[_0x4710b2(0x188)])+parseInt(_0x3f25ce[_0x4710b2(0x250)]));});}),await _0x58d04a[_0x255b7c(0x215)]();const _0x2d65aa=_0x29187d['filter'](_0x1fe22e=>_0x1fe22e[_0x255b7c(0x20d)]!=='0'&&_0x1fe22e[_0x255b7c(0x20d)]!=='');var _0x22abde=0x0;_0x2d65aa['forEach'](_0x3c31f5=>{var _0x2cc6da=_0x255b7c;console[_0x2cc6da(0x211)]('foreach\x20newproduct',_0x3c31f5),(parseInt(_0x3c31f5[_0x2cc6da(0x1f3)])<parseInt(_0x3c31f5[_0x2cc6da(0x20d)])||parseInt(_0x3c31f5['stock_quantity'])<parseInt(_0x3c31f5[_0x2cc6da(0x20d)]))&&_0x22abde++;});if(_0x22abde!=0x0)return _0x2ba0de['flash'](_0x255b7c(0x258),_0x255b7c(0x1f1)),_0x30c5bd[_0x255b7c(0x16d)]('back');const _0x4168c8=new purchases_return({'invoice':_0x267b01,'suppliers':_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x186)],'date':_0xe430f1,'warehouse_name':_0x5c1881,'return_product':_0x2d65aa,'note':_0x3638c4,'room':_0x424c04,'to_warehouse_name':_0x21bb6f,'to_room':_0x164932}),_0x38fdd1=await _0x4168c8['save']();console[_0x255b7c(0x211)](_0x4168c8);const _0x5c75b0=await purchases_return['findOne']({'invoice':_0x267b01}),_0x5e6db2=await warehouse[_0x255b7c(0x208)]({'name':_0x21bb6f,'room':_0x164932});_0x5c75b0['return_product']['forEach'](_0x521e34=>{var _0x19d799=_0x255b7c,_0x53976c=0x0;const _0x5ad75c=_0x5e6db2[_0x19d799(0x1bd)][_0x19d799(0x213)](_0x534066=>{var _0xa948aa=_0x19d799;_0x534066[_0xa948aa(0x1f7)]==_0x521e34[_0xa948aa(0x1f7)]&&_0x534066[_0xa948aa(0x1cd)]==_0x521e34[_0xa948aa(0x1cd)]&&_0x534066['type']==_0x521e34[_0xa948aa(0x1f0)]&&_0x534066['bin']==_0x521e34['bin']&&_0x534066['bay']==_0x521e34[_0xa948aa(0x195)]&&(_0x534066[_0xa948aa(0x188)]=parseInt(_0x534066[_0xa948aa(0x188)])-parseInt(_0x521e34[_0xa948aa(0x20d)]),_0x53976c++);});_0x53976c=='0'&&(_0x5e6db2[_0x19d799(0x1bd)]=_0x5e6db2[_0x19d799(0x1bd)][_0x19d799(0x1b9)]({'product_name':_0x521e34[_0x19d799(0x1f7)],'product_stock':_0x521e34['return_qty'],'primary_code':_0x521e34['primary_code'],'secondary_code':_0x521e34[_0x19d799(0x1be)],'product_code':_0x521e34[_0x19d799(0x157)],'storage':_0x521e34['storage'],'rack':_0x521e34[_0x19d799(0x264)],'bay':_0x521e34[_0x19d799(0x195)],'bin':_0x521e34['bin'],'type':_0x521e34['type'],'floorlevel':_0x521e34[_0x19d799(0x1cd)],'maxProducts':_0x521e34['maxStocks'],'unit':_0x521e34[_0x19d799(0x1e0)],'secondary_unit':_0x521e34[_0x19d799(0x168)],'expiry_date':_0x521e34['expiry_date']}));}),await _0x5e6db2[_0x255b7c(0x215)]();const _0x4b5f3d=await purchases[_0x255b7c(0x208)]({'invoice':_0x267b01});_0x4b5f3d['return_data']=_0x255b7c(0x187);const _0x42873c=await _0x4b5f3d['save'](),_0x281a9f=new s_payment_data({'invoice':_0x267b01,'suppliers':_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x186)],'reason':_0x255b7c(0x1c6)});await _0x281a9f[_0x255b7c(0x215)]();const _0x49f3bd=await master_shop[_0x255b7c(0x253)]();console[_0x255b7c(0x211)](_0x255b7c(0x1ae),_0x49f3bd[0x0]['image']);const _0x353589=await email_settings[_0x255b7c(0x208)](),_0x1fec8c=await suppliers[_0x255b7c(0x208)]({'name':_0x2ba0de[_0x255b7c(0x24e)][_0x255b7c(0x186)]});console[_0x255b7c(0x211)]('suppliers_data',_0x1fec8c);_0x49f3bd[0x0][_0x255b7c(0x166)]==0x1?(right_currency=_0x49f3bd[0x0][_0x255b7c(0x239)],left_currency=''):(right_currency='',left_currency=_0x49f3bd[0x0][_0x255b7c(0x239)]);var _0x32a83a=_0x415097,_0x114949=_0x3c8625,_0x5bb8ae='',_0xef54fb;for(_0xef54fb in _0x32a83a){_0x5bb8ae+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x32a83a[_0xef54fb]+_0x255b7c(0x15d)+_0x255b7c(0x1ee)+_0x114949[_0xef54fb]+_0x255b7c(0x15d)+_0x255b7c(0x219);}console[_0x255b7c(0x211)](_0x255b7c(0x200),_0x5bb8ae);let _0x15cb63=nodemailer[_0x255b7c(0x171)]({'service':_0x255b7c(0x1af),'auth':{'user':_0x353589[_0x255b7c(0x1ed)],'pass':_0x353589[_0x255b7c(0x16f)]}}),_0x26cb68={'from':_0x353589[_0x255b7c(0x1ed)],'to':_0x1fec8c[_0x255b7c(0x1ed)],'subject':_0x255b7c(0x199),'attachments':[{'filename':_0x255b7c(0x1b4),'path':__dirname+_0x255b7c(0x1a5)+'/upload/'+_0x49f3bd[0x0][_0x255b7c(0x1a9)],'cid':_0x255b7c(0x189)}],'html':_0x255b7c(0x1ca)+_0x255b7c(0x241)+'</head><body>'+'<div>'+_0x255b7c(0x17f)+_0x255b7c(0x19d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x255b7c(0x1b0)+_0x255b7c(0x19d)+_0x255b7c(0x1a6)+_0x49f3bd[0x0]['site_title']+_0x255b7c(0x23b)+_0x255b7c(0x1b0)+'</div>'+_0x255b7c(0x15c)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x255b7c(0x1b8)+_0x267b01+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x255b7c(0x230)+_0xe430f1+'\x20'+_0x255b7c(0x1fe)+_0x255b7c(0x1dd)+_0x255b7c(0x1b0)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x255b7c(0x182)+_0x255b7c(0x1b7)+_0x255b7c(0x1c4)+_0x255b7c(0x1e3)+_0x255b7c(0x1f9)+_0x255b7c(0x1d8)+_0x255b7c(0x219)+'</thead>'+_0x255b7c(0x20b)+'\x20'+_0x5bb8ae+'\x20'+'</tbody>'+_0x255b7c(0x18e)+_0x255b7c(0x19d)+_0x255b7c(0x1ec)+_0x255b7c(0x205)+_0x49f3bd[0x0][_0x255b7c(0x1bc)]+_0x255b7c(0x1dd)+_0x255b7c(0x1b0)+'</div>'+_0x255b7c(0x155)};_0x15cb63[_0x255b7c(0x1ac)](_0x26cb68,function(_0x200fa4,_0x4d6bba){var _0x47ed22=_0x255b7c;_0x200fa4?(console[_0x47ed22(0x211)](_0x200fa4),console[_0x47ed22(0x211)](_0x47ed22(0x23d))):console[_0x47ed22(0x211)]('Email\x20sent\x20successfully');}),_0x2ba0de[_0x255b7c(0x1df)]('success',_0x255b7c(0x197)),_0x30c5bd['redirect'](_0x255b7c(0x1a3));}catch(_0x8ebf6d){console['log'](_0x8ebf6d),_0x30c5bd[_0x255b7c(0x1ef)](0xc8)[_0x255b7c(0x1a0)]({'message':_0x8ebf6d[_0x255b7c(0x1e7)]});}}),router[a0_0x1b36e1(0x269)]('/barcode/:id',auth,async(_0x14a508,_0x18ab79)=>{var _0x189650=a0_0x1b36e1;try{const {username:_0x5b4cf3,email:_0x55117c,role:_0x3a3e13}=_0x14a508[_0x189650(0x245)],_0x5970e6=_0x14a508[_0x189650(0x245)],_0x4044a4=await profile[_0x189650(0x208)]({'email':_0x5970e6['email']}),_0x5132a8=await master_shop[_0x189650(0x253)](),_0x299a0f=_0x14a508[_0x189650(0x177)]['id'],_0x242825=await purchases[_0x189650(0x1f6)](_0x299a0f);if(_0x5132a8[0x0][_0x189650(0x1dc)]==_0x189650(0x26c))var _0x3cf01f=users[_0x189650(0x1b6)];else{if(_0x5132a8[0x0][_0x189650(0x1dc)]=='Hindi')var _0x3cf01f=users[_0x189650(0x170)];else{if(_0x5132a8[0x0]['language']==_0x189650(0x212))var _0x3cf01f=users[_0x189650(0x212)];else{if(_0x5132a8[0x0]['language']=='Spanish')var _0x3cf01f=users[_0x189650(0x161)];else{if(_0x5132a8[0x0][_0x189650(0x1dc)]==_0x189650(0x255))var _0x3cf01f=users[_0x189650(0x255)];else{if(_0x5132a8[0x0]['language']=='Portuguese\x20(BR)')var _0x3cf01f=users[_0x189650(0x1c1)];else{if(_0x5132a8[0x0]['language']==_0x189650(0x181))var _0x3cf01f=users[_0x189650(0x181)];else{if(_0x5132a8[0x0][_0x189650(0x1dc)]==_0x189650(0x265))var _0x3cf01f=users[_0x189650(0x1de)];}}}}}}}_0x18ab79['render'](_0x189650(0x24b),{'success':_0x14a508[_0x189650(0x1df)](_0x189650(0x217)),'errors':_0x14a508['flash'](_0x189650(0x258)),'role':_0x5970e6,'profile':_0x4044a4,'alldata':_0x242825,'master_shop':_0x5132a8,'language':_0x3cf01f}),console[_0x189650(0x211)](alldata);}catch(_0x1346eb){console[_0x189650(0x211)](_0x1346eb);}}),router['post'](a0_0x1b36e1(0x244),async(_0x53b5d6,_0x5c63f6)=>{var _0x3d57ea=a0_0x1b36e1;const {product_code:_0x2326a1}=_0x53b5d6[_0x3d57ea(0x24e)];var _0x157525;const _0x59f380=await product[_0x3d57ea(0x203)]([{'$match':{'primary_code':_0x2326a1,'product_category':_0x3d57ea(0x15a)}},{'$group':{'_id':_0x3d57ea(0x1db),'name':{'$first':_0x3d57ea(0x1d7)},'category':{'$first':_0x3d57ea(0x18d)},'brand':{'$first':'$brand'},'unit':{'$first':_0x3d57ea(0x18c)},'alertquantity':{'$first':_0x3d57ea(0x1cc)},'product_code':{'$first':_0x3d57ea(0x23f)},'primary_code':{'$first':_0x3d57ea(0x207)},'secondary_code':{'$first':_0x3d57ea(0x266)},'maxStocks':{'$first':_0x3d57ea(0x1e2)},'maxProdPerUnit':{'$first':_0x3d57ea(0x25d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3d57ea(0x24c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xd60069=await product[_0x3d57ea(0x203)]([{'$match':{'secondary_code':_0x2326a1,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x3d57ea(0x18d)},'brand':{'$first':_0x3d57ea(0x1d5)},'unit':{'$first':_0x3d57ea(0x18c)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3d57ea(0x266)},'maxStocks':{'$first':_0x3d57ea(0x1e2)},'maxProdPerUnit':{'$first':_0x3d57ea(0x25d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x3d57ea(0x24c)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x59f380[_0x3d57ea(0x1d6)]>0x0)_0x157525=_0x59f380;else _0xd60069[_0x3d57ea(0x1d6)]>0x0&&(_0x157525=_0xd60069);_0x5c63f6[_0x3d57ea(0x1a0)](_0x157525);}),router[a0_0x1b36e1(0x1ce)]('/CheckingWarehouse',async(_0x3d4034,_0x4970fc)=>{var _0x369f43=a0_0x1b36e1;const {primaryCode:_0x8b7e3,secondaryCode:_0x551a27,productCode:_0x4fe046,bay:_0x331018,bin:_0x175116,types:_0x443346,pallet:_0x1f5a4a,warehouses:_0x29a8a4,room:_0x126b0d}=_0x3d4034[_0x369f43(0x24e)];console[_0x369f43(0x211)](_0x3d4034['body']);try{const _0x598ce8=await warehouse['aggregate']([{'$match':{'name':_0x29a8a4,'room':_0x126b0d}},{'$unwind':_0x369f43(0x1d4)},{'$match':{'product_details.bay':_0x331018,'product_details.bin':_0x175116,'product_details.type':_0x443346}},{'$group':{'_id':_0x369f43(0x1fc),'name':{'$first':_0x369f43(0x196)},'product_stock':{'$first':_0x369f43(0x237)},'level':{'$first':_0x369f43(0x263)},'isle':{'$first':_0x369f43(0x24a)},'pallet':{'$first':_0x369f43(0x1c5)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4970fc['status'](0xc8)[_0x369f43(0x1a0)](_0x598ce8);}catch(_0x41b0ee){_0x4970fc[_0x369f43(0x1ef)](0x194)[_0x369f43(0x1a0)]({'message':_0x41b0ee[_0x369f43(0x1e7)]});}}),module[a0_0x1b36e1(0x24d)]=router;