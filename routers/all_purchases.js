function a0_0x2b4e(_0x2cd2cf,_0x1e2d31){var _0x57b9d9=a0_0x57b9();return a0_0x2b4e=function(_0x2b4e8b,_0x1dc8aa){_0x2b4e8b=_0x2b4e8b-0x168;var _0x463c5e=_0x57b9d9[_0x2b4e8b];return _0x463c5e;},a0_0x2b4e(_0x2cd2cf,_0x1e2d31);}var a0_0xc1da41=a0_0x2b4e;(function(_0x1992b5,_0x4fcf13){var _0x419d12=a0_0x2b4e,_0xc7f7be=_0x1992b5();while(!![]){try{var _0x543687=parseInt(_0x419d12(0x20e))/0x1+parseInt(_0x419d12(0x19f))/0x2+parseInt(_0x419d12(0x184))/0x3*(-parseInt(_0x419d12(0x222))/0x4)+parseInt(_0x419d12(0x230))/0x5+parseInt(_0x419d12(0x1db))/0x6*(parseInt(_0x419d12(0x174))/0x7)+-parseInt(_0x419d12(0x202))/0x8*(-parseInt(_0x419d12(0x1f8))/0x9)+-parseInt(_0x419d12(0x27b))/0xa;if(_0x543687===_0x4fcf13)break;else _0xc7f7be['push'](_0xc7f7be['shift']());}catch(_0x3a2a1b){_0xc7f7be['push'](_0xc7f7be['shift']());}}}(a0_0x57b9,0x2c393));function a0_0x57b9(){var _0x1dee21=['Rack\x20E','$batch_code','4364790JFYMAe','finalize','quantity','/all_purchases/view/','path','post','JO_number','deliverycode','Arabic','Arabic\x20(ae)','$note','</body></html>','all','$product.quantity','logo','French','user_id','$product_details','<span\x20style=\x22float:\x20right;\x22>','purchase_invoice','$secondary_unit','Level','$maxProdPerUnit','/../public','../public/language/languages.json','112occKcc','<h2>\x20','filter','\x20Order\x20Date\x20:\x20','secondary_unit','$name','Portuguese\x20(BR)','findOne','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','maxStocks','save','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/invoice/:id','actual_uom','prod_isle','$product_details.product_code','6ftziTD','payment\x20successfull','Receiving\x20Area','prod_primunit','<!DOCTYPE\x20html>','/barcode/:id','$maxStocks','/view/:id','add_purchases\x20error','random','product','/CheckingWarehouse','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','table\x20page','</span>','$product.type','$product.bin','user','flash','log','Shelves','then','aggregate','$product_details.secondary_code','types','$room','266830BTpbkC','English\x20(US)','delivery_code','string','Logo.png','Rack\x20B','Error\x20Occurs','render','$suppliers','\x20Order\x20Number\x20:\x20','production_date','standard_unit','DRY\x20STORAGE','$primary_code','/upload/','stock_quantity','note','email','get','max_product_unit','suppliers_docs','secondary_code','edit_purchases_view','$_id','currency','Room_name','Email\x20sent\x20successfully','$category','</thead>','add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Enabled','bin','$product_details.pallet','all_purchases','<tbody\x20style=\x22text-align:\x20center;\x22>','foreach\x20newproduct','$suppliers_docs','</h5>','delivery_date','currency_placement','prod_qty','body','batch_code','/view/add_purchases/:id','RMSEmail','Raw\x20Materials','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Purchase\x20Return\x20Mail','$product_details.isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','isle','warehouse','prod_code','<hr\x20class=\x22my-3\x22>','prod_name','Sales\x20Update\x20successfully','concat','$secondary_code','password','49332AAdHST','prod_cat','return_purchase','Paid\x20For\x20Purchase','due_amount','room','$product_details.type','$expiry_date','warehouse_name','level','map','True','language','host','master','Router','$brand','actual_qty','<h5\x20style=\x22text-align:\x20left;\x22>','\x20<>\x20','suppliers_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','</tr>','type','all_purchases_barcode','</head><body>','catch','site_title','Spanish','59913pLKKbf','$date','$product_details._id','$product_details.floorlevel','room_name','image','success','nodemailer','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','192yjeMWH','</table>','RoomAssign','purchase_quantity','redirect','suppliers','$return_data','expiry_date','$unit','product_name','<html><head><title></title>','\x20</h2>','345791dtIMuR','</tbody>','createTransport','<div>','prod_level','findById','An\x20error\x20occurred\x20while\x20saving\x20data.','rack','prod_secondunit','purchase\x20data\x20update\x20successfully','sendMail','abs','here','gmail','stocks','\x20<\x20wew\x20>\x20','$product_details.storage','return_qty','name','$invoice','619756qmUEHs','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Purchase\x20Mail','amount','<h5>','paid_amount','length','$product_details.primary_code','Portuguese','$product_details.maxProducts','</td>','rak','product_code_hide','784850NXEbts','prod_invoice','forEach','/give_payment/:id','$warehouse_name','$product','error','$product_details.product_name','Hindi','prod_unit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','MaxStocks_data','product_code','secondary_code_hide','getFullYear','$alertquantity','$product_details.bin','Floor','getMonth','getDate','maxperunit','product_details','slice','product_stock','stock_data','Return\x20Goods','../middleware/auth','/barcode_scanner','storage','Purchase\x20Return','$product.bay','exports','Chinese','There\x27s\x20a\x20error\x20in\x20this\x20transaction','floorlevel','German','message','Rack\x20D','$product.room_name','</div>','alertQTY','status','padStart','json','$product.floorlevel','primary_code','pallet','INC-','$product_details.product_stock','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','push','edit_purchases','$due_amount','role','add\x20post','staff','$product_details.expiry_date','product_list','date','/view/add_purchases','params','An\x20error\x20occurred.','English','Rack\x20A','/all_purchases/view','ejs','product_cat','errors','express','find','invoice','$product_details.rack'];a0_0x57b9=function(){return _0x1dee21;};return a0_0x57b9();}const express=require(a0_0xc1da41(0x275)),app=express(),router=express[a0_0xc1da41(0x1ea)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0xc1da41(0x24a)),nodemailer=require(a0_0xc1da41(0x1ff));var ejs=require(a0_0xc1da41(0x272));const path=require(a0_0xc1da41(0x27f)),users=require(a0_0xc1da41(0x173));router[a0_0xc1da41(0x1b1)]('/view',auth,async(_0x594f23,_0x46dd7a)=>{var _0x24b6e6=a0_0xc1da41;try{const {username:_0x31fec3,email:_0x7a4b4c,role:_0x3e6bdf}=_0x594f23[_0x24b6e6(0x196)],_0x302461=_0x594f23['user'],_0x58315b=await profile[_0x24b6e6(0x17b)]({'email':_0x302461[_0x24b6e6(0x1b0)]}),_0x3693d0=await staff['findOne']({'email':_0x302461['email']});if(_0x302461[_0x24b6e6(0x266)]=='staff'){const _0x56d864=await staff[_0x24b6e6(0x17b)]({'email':_0x302461[_0x24b6e6(0x1b0)]});}const _0x427ca=await master_shop['find']();let _0x3f197d;if(_0x302461[_0x24b6e6(0x266)]==_0x24b6e6(0x268)){const _0x192054=await staff[_0x24b6e6(0x17b)]({'email':_0x302461[_0x24b6e6(0x1b0)]});_0x3f197d=await purchases[_0x24b6e6(0x19b)]([{'$match':{'warehouse_name':_0x192054[_0x24b6e6(0x1d3)]}},{'$lookup':{'from':_0x24b6e6(0x207),'localField':'suppliers','foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x24b6e6(0x1c4)},{'$unwind':_0x24b6e6(0x235)},{'$group':{'_id':_0x24b6e6(0x1b6),'invoice':{'$first':_0x24b6e6(0x221)},'suppliers':{'$first':_0x24b6e6(0x1a7)},'date':{'$first':_0x24b6e6(0x1f9)},'warehouse_name':{'$first':_0x24b6e6(0x234)},'room':{'$first':_0x24b6e6(0x19e)},'product':{'$push':_0x24b6e6(0x235)},'note':{'$first':_0x24b6e6(0x285)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x24b6e6(0x208)},'batch_code':{'$first':_0x24b6e6(0x27a)},'expiry_date':{'$first':_0x24b6e6(0x1e2)},'suppliers_docs':{'$first':_0x24b6e6(0x1c4)},'total_product_quantity':{'$sum':_0x24b6e6(0x168)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x24b6e6(0x194)},'floorlevel':{'$addToSet':_0x24b6e6(0x25c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3f197d=await purchases[_0x24b6e6(0x19b)]([{'$lookup':{'from':_0x24b6e6(0x207),'localField':_0x24b6e6(0x207),'foreignField':_0x24b6e6(0x220),'as':_0x24b6e6(0x1b3)}},{'$unwind':_0x24b6e6(0x1c4)},{'$unwind':_0x24b6e6(0x235)},{'$group':{'_id':_0x24b6e6(0x1b6),'invoice':{'$first':_0x24b6e6(0x221)},'suppliers':{'$first':_0x24b6e6(0x1a7)},'date':{'$first':_0x24b6e6(0x1f9)},'warehouse_name':{'$first':_0x24b6e6(0x234)},'room':{'$addToSet':_0x24b6e6(0x256)},'product':{'$push':_0x24b6e6(0x235)},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x24b6e6(0x265)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x24b6e6(0x1e2)},'suppliers_docs':{'$first':_0x24b6e6(0x1c4)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x24b6e6(0x24e)},'isle':{'$addToSet':_0x24b6e6(0x195)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x24b6e6(0x25c)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x427ca[0x0]['language']==_0x24b6e6(0x1a0)){var _0x500bac=users[_0x24b6e6(0x26f)];console['log'](_0x500bac);}else{if(_0x427ca[0x0][_0x24b6e6(0x1e7)]==_0x24b6e6(0x238))var _0x500bac=users['Hindi'];else{if(_0x427ca[0x0][_0x24b6e6(0x1e7)]==_0x24b6e6(0x253))var _0x500bac=users[_0x24b6e6(0x253)];else{if(_0x427ca[0x0][_0x24b6e6(0x1e7)]==_0x24b6e6(0x1f7))var _0x500bac=users[_0x24b6e6(0x1f7)];else{if(_0x427ca[0x0]['language']=='French')var _0x500bac=users[_0x24b6e6(0x16a)];else{if(_0x427ca[0x0][_0x24b6e6(0x1e7)]==_0x24b6e6(0x17a))var _0x500bac=users[_0x24b6e6(0x22b)];else{if(_0x427ca[0x0][_0x24b6e6(0x1e7)]=='Chinese')var _0x500bac=users[_0x24b6e6(0x250)];else{if(_0x427ca[0x0]['language']==_0x24b6e6(0x284))var _0x500bac=users[_0x24b6e6(0x283)];}}}}}}}_0x46dd7a['render'](_0x24b6e6(0x1c1),{'success':_0x594f23['flash'](_0x24b6e6(0x1fe)),'errors':_0x594f23[_0x24b6e6(0x197)](_0x24b6e6(0x274)),'purchases':_0x3f197d,'role':_0x302461,'profile':_0x58315b,'master_shop':_0x427ca,'language':_0x500bac});}catch(_0x27e129){console[_0x24b6e6(0x198)](_0x24b6e6(0x192),_0x27e129),_0x46dd7a[_0x24b6e6(0x259)](0xc8)[_0x24b6e6(0x25b)]({'message':_0x27e129[_0x24b6e6(0x254)]});}});function BayBinSelected(_0x4619b7,_0x5d11b0){var _0xafb516=a0_0xc1da41,_0x47d103=[],_0x7860cb=[],_0x2e3163=[],_0x3ca5ce=[],_0x11445=[],_0x5bfd77=[];let _0x3cf3cb=[];if(_0x4619b7==_0xafb516(0x1ab))switch(_0x5d11b0){case'Rack\x20A':_0x47d103=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x7860cb=[0x1,0x2],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=['Level','Floor'],_0x11445=['D'],_0x5bfd77=['A'];break;case _0xafb516(0x1a4):_0x47d103=[0x6,0x5,0x4,0x3,0x2,0x1],_0x7860cb=[0x1,0x2],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=[_0xafb516(0x170),'Floor'],_0x11445=['D'],_0x5bfd77=['B'];break;case _0xafb516(0x199):_0x47d103=[0x0],_0x7860cb=[0x0],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=[_0xafb516(0x241)],_0x11445=['D'],_0x5bfd77=['S'];break;case _0xafb516(0x186):_0x47d103=[0x0],_0x7860cb=[0x0],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x2e3163=[_0xafb516(0x241)],_0x11445=['D'],_0x5bfd77=['R'];break;}else{if(_0x4619b7=='COLD\x20STORAGE')switch(_0x5d11b0){case _0xafb516(0x270):_0x47d103=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x7860cb=['B','F'],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=[_0xafb516(0x170),_0xafb516(0x241)],_0x11445=['C'],_0x5bfd77=['A'];break;case _0xafb516(0x1a4):_0x47d103=[0x5,0x4,0x3,0x2,0x1],_0x7860cb=['F','B','S'],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=[_0xafb516(0x170),_0xafb516(0x241)],_0x11445=['C'],_0x5bfd77=['B'];break;case'Rack\x20C':_0x47d103=[0x1,0x2,0x3,0x4,0x5],_0x7860cb=['B','F','S'],_0x3ca5ce=[0x5,0x4,0x3,0x2,0x1],_0x2e3163=[_0xafb516(0x170),'Floor'],_0x11445=['C'],_0x5bfd77=['C'];break;case _0xafb516(0x255):_0x47d103=[0x5,0x4,0x3,0x2,0x1],_0x7860cb=['F','B','S'],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=[_0xafb516(0x170),_0xafb516(0x241)],_0x11445=['C'],_0x5bfd77=['D'];break;case _0xafb516(0x279):_0x47d103=[0x4,0x3,0x2,0x1],_0x7860cb=[0x1,0x2],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=[_0xafb516(0x170),_0xafb516(0x241)],_0x11445=['C'],_0x5bfd77=['E'];break;case'Rack\x20F':_0x47d103=[0x1,0x2,0x3],_0x7860cb=[0x1,0x2],_0x3ca5ce=[0x1,0x2,0x3,0x4,0x5],_0x2e3163=['Level'],_0x11445=['C'],_0x5bfd77=['F'];break;}}return{'levels':_0x47d103,'Isle':_0x7860cb,'rack':_0x3ca5ce,'type':_0x2e3163,'storage':_0x11445,'rak':_0x5bfd77};}async function getRandom8DigitNumber(){var _0x47ae4c=a0_0xc1da41;const _0x5af03a=0x989680,_0xee2eba=0x5f5e0ff,_0x49bce4=Math[_0x47ae4c(0x200)](Math[_0x47ae4c(0x18d)]()*(_0xee2eba-_0x5af03a+0x1))+_0x5af03a;var _0x41efb8;const _0x588c0d=await purchases[_0x47ae4c(0x17b)]({'invoice':_0x47ae4c(0x25f)+_0x49bce4});return _0x588c0d&&_0x588c0d[_0x47ae4c(0x229)]>0x0?_0x41efb8=_0x47ae4c(0x25f)+_0x49bce4:_0x41efb8='INC-'+_0x49bce4,_0x41efb8;}router[a0_0xc1da41(0x1b1)](a0_0xc1da41(0x26c),auth,async(_0x3db769,_0x4db9b5)=>{var _0x2509b8=a0_0xc1da41;try{const {username:_0x5132de,email:_0x3d29a2,role:_0x39e5f9}=_0x3db769[_0x2509b8(0x196)],_0x227d3a=_0x3db769[_0x2509b8(0x196)],_0x124aed=await profile[_0x2509b8(0x17b)]({'email':_0x227d3a[_0x2509b8(0x1b0)]}),_0x2adcfb=await master_shop[_0x2509b8(0x276)](),_0x448627=await staff[_0x2509b8(0x17b)]({'email':_0x227d3a[_0x2509b8(0x1b0)]}),_0x542243=await suppliers[_0x2509b8(0x276)]({});let _0x17dff5;if(_0x227d3a[_0x2509b8(0x266)]=='staff'){const _0x73ea2=await staff[_0x2509b8(0x17b)]({'email':_0x227d3a[_0x2509b8(0x1b0)]});_0x17dff5=await warehouse[_0x2509b8(0x19b)]([{'$match':{'status':'Enabled','name':_0x73ea2['warehouse'],'warehouse_category':_0x2509b8(0x1cd),'name':{'$ne':_0x2509b8(0x249)}}},{'$group':{'_id':_0x2509b8(0x179),'name':{'$first':_0x2509b8(0x179)}}}]);}else _0x17dff5=await warehouse[_0x2509b8(0x19b)]([{'$match':{'status':_0x2509b8(0x1be),'warehouse_category':_0x2509b8(0x1cd),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x2509b8(0x179),'name':{'$first':'$name'}}}]);const _0x793072=await product[_0x2509b8(0x276)]({}),_0x1485b2=await warehouse[_0x2509b8(0x276)]({'status':_0x2509b8(0x1be)}),_0x38bb18=await purchases['find']({}),_0x49da5a=_0x38bb18[_0x2509b8(0x229)]+0x1,_0x2f449b=_0x2509b8(0x25f)+_0x49da5a['toString']()[_0x2509b8(0x25a)](0x5,'0');var _0x18ff13=[_0x2509b8(0x223),'Enclosed'];if(_0x2adcfb[0x0]['language']=='English\x20(US)')var _0x962d3a=users[_0x2509b8(0x26f)];else{if(_0x2adcfb[0x0]['language']=='Hindi')var _0x962d3a=users[_0x2509b8(0x238)];else{if(_0x2adcfb[0x0][_0x2509b8(0x1e7)]==_0x2509b8(0x253))var _0x962d3a=users[_0x2509b8(0x253)];else{if(_0x2adcfb[0x0]['language']=='Spanish')var _0x962d3a=users[_0x2509b8(0x1f7)];else{if(_0x2adcfb[0x0]['language']=='French')var _0x962d3a=users[_0x2509b8(0x16a)];else{if(_0x2adcfb[0x0][_0x2509b8(0x1e7)]=='Portuguese\x20(BR)')var _0x962d3a=users[_0x2509b8(0x22b)];else{if(_0x2adcfb[0x0]['language']==_0x2509b8(0x250))var _0x962d3a=users['Chinese'];else{if(_0x2adcfb[0x0][_0x2509b8(0x1e7)]=='Arabic\x20(ae)')var _0x962d3a=users[_0x2509b8(0x283)];}}}}}}}const _0x3b7c54=getRandom8DigitNumber();_0x3b7c54[_0x2509b8(0x19a)](_0x3ffa4f=>{var _0x3cc596=_0x2509b8;_0x4db9b5[_0x3cc596(0x1a6)](_0x3cc596(0x1bc),{'success':_0x3db769[_0x3cc596(0x197)](_0x3cc596(0x1fe)),'errors':_0x3db769[_0x3cc596(0x197)](_0x3cc596(0x274)),'role':_0x227d3a,'profile':_0x124aed,'suppliers':_0x542243,'warehouse':_0x17dff5,'product':_0x793072,'invoice':_0x3ffa4f,'master_shop':_0x2adcfb,'language':_0x962d3a,'find_data':_0x1485b2,'rooms_data':_0x18ff13});})[_0x2509b8(0x1f5)](_0xa53112=>{var _0x2bc042=_0x2509b8;_0x3db769['flash'](_0x2bc042(0x274),_0x2bc042(0x251)),_0x4db9b5[_0x2bc042(0x206)](_0x2bc042(0x271));});}catch(_0x471363){console[_0x2509b8(0x198)](_0x471363);}}),router[a0_0xc1da41(0x1b1)](a0_0xc1da41(0x1cb),auth,async(_0x49e1ba,_0x3ee2e3)=>{var _0x323173=a0_0xc1da41;try{const _0x451489=_0x49e1ba[_0x323173(0x26d)]['id'];console[_0x323173(0x198)](_0x451489);const _0x2d8afe=await master_shop[_0x323173(0x276)]();console[_0x323173(0x198)](_0x323173(0x1e9),_0x2d8afe);const _0x571d03=await product['findOne']({'name':_0x451489});console['log']('product',_0x571d03),_0x3ee2e3[_0x323173(0x259)](0xc8)['json']({'product_data':_0x571d03,'master':_0x2d8afe});}catch(_0x5ec919){console[_0x323173(0x198)](_0x323173(0x18c),_0x5ec919);}}),router[a0_0xc1da41(0x280)](a0_0xc1da41(0x26c),auth,async(_0x55cfb1,_0x9774f1)=>{var _0x1ee2a2=a0_0xc1da41;try{const {invoice:_0xa79e25,date:_0x562533,warehouse_name:_0x6faef5,prod_name:_0x1bdbab,prod_code:_0x15333,prod_qty:_0x2952b4,prod_unit:_0x1f7283,prod_secondunit:_0x7cf190,prod_level:_0x53eb69,prod_isle:_0x5cd50e,prod_pallet:_0x5780ec,note:_0x30928d,expiry_date:_0x4044ff,batch_code:_0x1af599,payable:_0x70b47,due_amount:_0x3842e4,Room_name:_0x135941,primary_code:_0x36ca59,secondary_code:_0x29d6ff,MaxStocks_data:_0x99616c,PO_number:_0x10f9f1,SCRN:_0x51d23d,JO_number:_0x3da24a}=_0x55cfb1[_0x1ee2a2(0x1c9)];if(typeof _0x1bdbab==_0x1ee2a2(0x1a2))var _0x1a9f9f=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1d6)]],_0x3ba9dc=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1d4)]],_0x107231=[_0x55cfb1[_0x1ee2a2(0x1c9)]['prod_Qty']],_0xd5b3=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x187)]],_0x1e2c24=[_0x55cfb1[_0x1ee2a2(0x1c9)]['prod_secondunit']],_0x522ba1=[_0x55cfb1[_0x1ee2a2(0x1c9)]['prod_level']],_0x4d833f=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x25d)]],_0x531cac=[_0x55cfb1['body'][_0x1ee2a2(0x1b4)]],_0x695350=[_0x55cfb1['body'][_0x1ee2a2(0x23b)]],_0x595e89=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1ca)]],_0x2b65a1=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x209)]],_0x2f8a15=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1b2)]],_0x186c0d=[_0x55cfb1['body'][_0x1ee2a2(0x258)]],_0x5211c7=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1a9)]],_0x28855d=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1dc)]],_0x57f248=[_0x55cfb1['body']['RoomAssign']],_0x540bb9=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x282)]],_0x3abdc6=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x231)]],_0xd2bbb9=[_0x55cfb1[_0x1ee2a2(0x1c9)]['actual_qty']],_0x376019=[_0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x181)]];else var _0x1a9f9f=[..._0x55cfb1['body'][_0x1ee2a2(0x1d6)]],_0x3ba9dc=[..._0x55cfb1['body']['prod_code']],_0x107231=[..._0x55cfb1[_0x1ee2a2(0x1c9)]['prod_Qty']],_0xd5b3=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x187)]],_0x1e2c24=[..._0x55cfb1[_0x1ee2a2(0x1c9)]['prod_secondunit']],_0x522ba1=[..._0x55cfb1[_0x1ee2a2(0x1c9)]['prod_level']],_0x4d833f=[..._0x55cfb1['body']['primary_code']],_0x531cac=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1b4)]],_0x695350=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x23b)]],_0x595e89=[..._0x55cfb1['body'][_0x1ee2a2(0x1ca)]],_0x2b65a1=[..._0x55cfb1[_0x1ee2a2(0x1c9)]['expiry_date']],_0x2f8a15=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1b2)]],_0x186c0d=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x258)]],_0x5211c7=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1a9)]],_0x28855d=[..._0x55cfb1[_0x1ee2a2(0x1c9)]['prod_cat']],_0x57f248=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x204)]],_0x540bb9=[..._0x55cfb1['body'][_0x1ee2a2(0x282)]],_0x3abdc6=[..._0x55cfb1['body'][_0x1ee2a2(0x231)]],_0xd2bbb9=[..._0x55cfb1[_0x1ee2a2(0x1c9)][_0x1ee2a2(0x1ec)]],_0x376019=[..._0x55cfb1['body']['actual_uom']];const _0x25a201=_0x1a9f9f[_0x1ee2a2(0x1e5)](_0x47fcf6=>{return _0x47fcf6={'product_name':_0x47fcf6};});_0xd2bbb9[_0x1ee2a2(0x232)]((_0x588abd,_0x1aa235)=>{var _0x15f6f4=_0x1ee2a2;_0x25a201[_0x1aa235]['actual_qty']=Math[_0x15f6f4(0x219)](_0x588abd);}),_0x376019['forEach']((_0x52bc04,_0x1ccbb9)=>{var _0x3c1dfb=_0x1ee2a2;_0x25a201[_0x1ccbb9][_0x3c1dfb(0x181)]=_0x52bc04;}),_0x3ba9dc[_0x1ee2a2(0x232)]((_0x1e6723,_0x3d1085)=>{var _0x2392c9=_0x1ee2a2;_0x25a201[_0x3d1085][_0x2392c9(0x23c)]=_0x1e6723;}),_0x107231['forEach']((_0x1b69bf,_0x1a3b67)=>{var _0x17d9d3=_0x1ee2a2;_0x25a201[_0x1a3b67][_0x17d9d3(0x27d)]=Math[_0x17d9d3(0x219)](_0x1b69bf);}),_0xd5b3[_0x1ee2a2(0x232)]((_0x4a756b,_0x499889)=>{_0x25a201[_0x499889]['standard_unit']=_0x4a756b;}),_0x1e2c24[_0x1ee2a2(0x232)]((_0x2b6132,_0x48cf9b)=>{_0x25a201[_0x48cf9b]['secondary_unit']=_0x2b6132;}),_0x522ba1[_0x1ee2a2(0x232)]((_0x3b0e22,_0x4c9a52)=>{var _0x1d39e1=_0x1ee2a2;_0x57f248[_0x1d39e1(0x232)]((_0x2dceff,_0xfbac72)=>{var _0x4412e7=_0x1d39e1;if(_0x2dceff=='Receiving\x20Area'&&_0x4c9a52==_0xfbac72){console[_0x4412e7(0x198)](_0x2dceff+_0x4412e7(0x21d)+_0x4c9a52+'\x20<>\x20'+_0xfbac72+'\x20<>\x20'+_0x3b0e22);var _0x48b546=_0x3b0e22[_0x4412e7(0x246)](0x3);_0x25a201[_0x4c9a52][_0x4412e7(0x24c)]=_0x3b0e22[0x0],_0x25a201[_0x4c9a52][_0x4412e7(0x215)]=_0x3b0e22[0x1],_0x25a201[_0x4c9a52][_0x4412e7(0x190)]=0x0,_0x25a201[_0x4c9a52][_0x4412e7(0x1bf)]=0x0,_0x25a201[_0x4c9a52][_0x4412e7(0x1f2)]=_0x4412e7(0x241),_0x25a201[_0x4c9a52]['floorlevel']=_0x48b546;}else{if(_0x2dceff=='Shelves'&&_0x4c9a52==_0xfbac72){var _0x48b546=_0x3b0e22[_0x4412e7(0x246)](0x3);_0x25a201[_0x4c9a52][_0x4412e7(0x24c)]=_0x3b0e22[0x0],_0x25a201[_0x4c9a52][_0x4412e7(0x215)]=_0x3b0e22[0x1],_0x25a201[_0x4c9a52]['bay']=0x0,_0x25a201[_0x4c9a52]['bin']=0x0,_0x25a201[_0x4c9a52][_0x4412e7(0x1f2)]=_0x4412e7(0x241),_0x25a201[_0x4c9a52]['floorlevel']=_0x3b0e22[0x5];}else{if(_0x4c9a52==_0xfbac72){if(_0x3b0e22[0x0]=='A'&&_0x3b0e22[0x1]=='L'&&_0x3b0e22[0x2]=='L')console[_0x4412e7(0x198)](_0x2dceff+'\x20<>\x20'+_0x4c9a52+_0x4412e7(0x1ee)+_0xfbac72+'\x20<>\x20'+_0x3b0e22+_0x4412e7(0x21a)),_0x25a201[_0x4c9a52]['storage']=_0x3b0e22[0x0],_0x25a201[_0x4c9a52][_0x4412e7(0x215)]=_0x3b0e22[0x1],_0x25a201[_0x4c9a52][_0x4412e7(0x190)]=0x0,_0x25a201[_0x4c9a52]['bin']=0x0,_0x25a201[_0x4c9a52]['type']=_0x4412e7(0x241),_0x25a201[_0x4c9a52]['floorlevel']=_0x3b0e22[0x3];else{var _0x59c23e;if(_0x3b0e22[0x4]=='L')_0x59c23e=_0x4412e7(0x170);else _0x3b0e22[0x4]=='F'&&(_0x59c23e=_0x4412e7(0x241));_0x25a201[_0x4c9a52]['storage']=_0x3b0e22[0x0],_0x25a201[_0x4c9a52][_0x4412e7(0x215)]=_0x3b0e22[0x1],_0x25a201[_0x4c9a52][_0x4412e7(0x190)]=_0x3b0e22[0x2],_0x25a201[_0x4c9a52][_0x4412e7(0x1bf)]=_0x3b0e22[0x3],_0x25a201[_0x4c9a52]['type']=_0x59c23e,_0x25a201[_0x4c9a52]['floorlevel']=_0x3b0e22[0x5];}}}}});}),_0x4d833f[_0x1ee2a2(0x232)]((_0x34244f,_0x459950)=>{var _0xd15706=_0x1ee2a2;_0x25a201[_0x459950][_0xd15706(0x25d)]=_0x34244f;}),_0x531cac['forEach']((_0x52856e,_0x54a258)=>{var _0x4ad85b=_0x1ee2a2;_0x25a201[_0x54a258][_0x4ad85b(0x1b4)]=_0x52856e;}),_0x695350[_0x1ee2a2(0x232)]((_0xdcb991,_0x2f60ae)=>{_0x25a201[_0x2f60ae]['maxStocks']=_0xdcb991;}),_0x595e89['forEach']((_0x14ab0a,_0x5b15a0)=>{var _0x4fbf38=_0x1ee2a2;_0x25a201[_0x5b15a0][_0x4fbf38(0x1ca)]=_0x14ab0a;}),_0x2b65a1['forEach']((_0x296170,_0x524650)=>{var _0x3b8d14=_0x1ee2a2;_0x25a201[_0x524650][_0x3b8d14(0x209)]=_0x296170;}),_0x2f8a15[_0x1ee2a2(0x232)]((_0x445ff8,_0x4c6bec)=>{var _0x5acb28=_0x1ee2a2;_0x25a201[_0x4c6bec][_0x5acb28(0x244)]=_0x445ff8;}),_0x186c0d[_0x1ee2a2(0x232)]((_0x1fbaa1,_0x2ada60)=>{_0x25a201[_0x2ada60]['alertQTY']=_0x1fbaa1;}),_0x5211c7['forEach']((_0x952045,_0x37077e)=>{var _0x25943c=_0x1ee2a2;_0x25a201[_0x37077e][_0x25943c(0x1a9)]=_0x952045;}),_0x28855d[_0x1ee2a2(0x232)]((_0x7616dc,_0x4c0ce5)=>{var _0x410643=_0x1ee2a2;_0x25a201[_0x4c0ce5][_0x410643(0x273)]=_0x7616dc;}),_0x57f248[_0x1ee2a2(0x232)]((_0x463404,_0x42b50f)=>{var _0x4a1156=_0x1ee2a2;_0x25a201[_0x42b50f][_0x4a1156(0x1fc)]=_0x463404;}),_0x540bb9[_0x1ee2a2(0x232)]((_0x1baabc,_0x3520f2)=>{var _0x58bc37=_0x1ee2a2;_0x25a201[_0x3520f2][_0x58bc37(0x1a1)]=_0x1baabc;}),_0x3abdc6[_0x1ee2a2(0x232)]((_0x52e76a,_0x55e989)=>{var _0x124539=_0x1ee2a2;_0x25a201[_0x55e989][_0x124539(0x277)]=_0x52e76a;});const _0x2620ad=_0x57f248[_0x1ee2a2(0x1e5)](_0x12f8bc=>{return _0x12f8bc={'room_name':_0x12f8bc};}),_0x2aa7f0=_0x25a201['filter'](_0x5b5529=>_0x5b5529[_0x1ee2a2(0x27d)]!=='0'&&_0x5b5529[_0x1ee2a2(0x27d)]!==''),_0x5bea51=new purchases({'invoice':_0xa79e25,'suppliers':_0x55cfb1[_0x1ee2a2(0x1c9)]['suppliers'],'date':_0x562533,'warehouse_name':_0x6faef5,'product':_0x2aa7f0,'note':_0x30928d,'due_amount':_0x3842e4,'POnumber':_0x10f9f1,'SCRN':_0x51d23d,'JO_number':_0x3da24a,'roomList':_0x2620ad}),_0x42b87d=await _0x5bea51['save'](),_0x1a9bcc=await purchases[_0x1ee2a2(0x17b)]({'invoice':_0xa79e25}),_0x4797fd=_0x1a9bcc[_0x1ee2a2(0x18e)]['map'](async _0x5c7899=>{var _0x4b5475=_0x1ee2a2,_0x275ebc=await warehouse[_0x4b5475(0x17b)]({'name':_0x6faef5,'room':_0x5c7899[_0x4b5475(0x1fc)]}),_0x2ed656=0x0;return _0x275ebc[_0x4b5475(0x245)][_0x4b5475(0x232)](_0x33ccd2=>{var _0x314dea=_0x4b5475;_0x33ccd2[_0x314dea(0x20b)]==_0x5c7899[_0x314dea(0x20b)]&&_0x33ccd2[_0x314dea(0x252)]==_0x5c7899[_0x314dea(0x252)]&&_0x33ccd2['type']==_0x5c7899[_0x314dea(0x1f2)]&&_0x33ccd2['bin']==_0x5c7899[_0x314dea(0x1bf)]&&_0x33ccd2['bay']==_0x5c7899['bay']&&_0x33ccd2[_0x314dea(0x215)]==_0x5c7899['rack']&&_0x33ccd2[_0x314dea(0x24c)]==_0x5c7899[_0x314dea(0x24c)]&&_0x33ccd2[_0x314dea(0x209)]==_0x5c7899['expiry_date']&&_0x33ccd2['batch_code']==_0x5c7899[_0x314dea(0x1ca)]&&_0x33ccd2[_0x314dea(0x1a9)]==_0x5c7899[_0x314dea(0x1a9)]&&_0x33ccd2[_0x314dea(0x277)]==_0x1a9bcc[_0x314dea(0x277)]&&(_0x33ccd2[_0x314dea(0x247)]+=Math[_0x314dea(0x219)](_0x5c7899[_0x314dea(0x27d)]),_0x2ed656++);}),_0x2ed656===0x0&&_0x275ebc[_0x4b5475(0x245)][_0x4b5475(0x263)]({'product_name':_0x5c7899['product_name'],'product_stock':Math[_0x4b5475(0x219)](_0x5c7899[_0x4b5475(0x27d)]),'primary_code':_0x5c7899[_0x4b5475(0x25d)],'secondary_code':_0x5c7899[_0x4b5475(0x1b4)],'product_code':_0x5c7899[_0x4b5475(0x23c)],'storage':_0x5c7899[_0x4b5475(0x24c)],'rack':_0x5c7899['rack'],'bay':_0x5c7899[_0x4b5475(0x190)],'bin':_0x5c7899[_0x4b5475(0x1bf)],'type':_0x5c7899['type'],'floorlevel':_0x5c7899[_0x4b5475(0x252)],'maxProducts':_0x5c7899[_0x4b5475(0x17d)],'unit':_0x5c7899[_0x4b5475(0x1aa)],'secondary_unit':_0x5c7899['secondary_unit'],'expiry_date':_0x5c7899[_0x4b5475(0x209)],'maxPerUnit':_0x5c7899[_0x4b5475(0x244)],'batch_code':_0x5c7899['batch_code'],'alertQTY':_0x5c7899[_0x4b5475(0x258)],'production_date':_0x5c7899[_0x4b5475(0x1a9)],'product_cat':_0x5c7899[_0x4b5475(0x273)],'invoice':_0x5c7899['invoice'],'actual_qty':Math[_0x4b5475(0x219)](_0x5c7899['actual_qty']),'actual_uom':_0x5c7899[_0x4b5475(0x181)]}),_0x275ebc;});Promise[_0x1ee2a2(0x287)](_0x4797fd)[_0x1ee2a2(0x19a)](async _0x30c95a=>{var _0x384a9a=_0x1ee2a2;try{for(const _0x7d3849 of _0x30c95a){await _0x7d3849[_0x384a9a(0x17e)]();}const _0x4bb641=await master_shop[_0x384a9a(0x276)](),_0x42ebca=await email_settings['findOne'](),_0x391a50=await supervisor_settings['find']();var _0x4afa82=_0x1a9bcc['product'],_0x1f5b2e='',_0x23ea5a;for(_0x23ea5a in _0x4afa82){_0x1f5b2e+='<tr>'+_0x384a9a(0x17c)+_0x4afa82[_0x23ea5a][_0x384a9a(0x20b)]+_0x384a9a(0x22d)+_0x384a9a(0x17c)+_0x4afa82[_0x23ea5a][_0x384a9a(0x23c)]+_0x384a9a(0x22d)+_0x384a9a(0x17c)+_0x4afa82[_0x23ea5a][_0x384a9a(0x27d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4afa82[_0x23ea5a][_0x384a9a(0x1aa)]+_0x384a9a(0x22d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4afa82[_0x23ea5a][_0x384a9a(0x178)]+_0x384a9a(0x22d)+_0x384a9a(0x17c)+_0x1a9bcc['warehouse_name']+_0x384a9a(0x22d)+_0x384a9a(0x17c)+_0x4afa82[_0x23ea5a]['room_name']+_0x384a9a(0x22d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4afa82[_0x23ea5a][_0x384a9a(0x24c)]+_0x4afa82[_0x23ea5a]['rack']+_0x4afa82[_0x23ea5a][_0x384a9a(0x190)]+_0x4afa82[_0x23ea5a]['bin']+_0x4afa82[_0x23ea5a][_0x384a9a(0x1f2)][0x0]+_0x4afa82[_0x23ea5a][_0x384a9a(0x252)]+_0x384a9a(0x22d),'</tr>';}let _0x34def7=nodemailer[_0x384a9a(0x210)]({'host':_0x42ebca[_0x384a9a(0x1e8)],'port':Number(_0x42ebca['port']),'secure':![],'auth':{'user':_0x42ebca[_0x384a9a(0x1b0)],'pass':_0x42ebca[_0x384a9a(0x1da)]}}),_0x58e3b7={'from':_0x42ebca['email'],'to':_0x391a50[0x0][_0x384a9a(0x1cc)],'subject':_0x384a9a(0x225),'attachments':[{'filename':_0x384a9a(0x1a3),'path':__dirname+_0x384a9a(0x172)+_0x384a9a(0x1ad)+_0x4bb641[0x0][_0x384a9a(0x1fd)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x384a9a(0x20c)+'</head><body>'+_0x384a9a(0x211)+_0x384a9a(0x1ce)+'<div>'+_0x384a9a(0x1f0)+_0x384a9a(0x257)+'<div>'+'<h2>\x20'+_0x4bb641[0x0][_0x384a9a(0x1f6)]+_0x384a9a(0x20d)+_0x384a9a(0x257)+_0x384a9a(0x257)+_0x384a9a(0x1d5)+_0x384a9a(0x211)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x384a9a(0x1a8)+_0x1a9bcc[_0x384a9a(0x277)]+'\x20'+_0x384a9a(0x16d)+_0x384a9a(0x177)+_0x1a9bcc[_0x384a9a(0x26b)]+'\x20'+_0x384a9a(0x193)+_0x384a9a(0x1c5)+_0x384a9a(0x257)+_0x384a9a(0x17f)+_0x384a9a(0x261)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x384a9a(0x191)+_0x384a9a(0x262)+_0x384a9a(0x1bd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x384a9a(0x224)+_0x384a9a(0x1d1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x384a9a(0x1bb)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1f5b2e+'\x20'+'</tbody>'+_0x384a9a(0x203)+_0x384a9a(0x211)+'<strong>\x20Regards\x20</strong>'+_0x384a9a(0x227)+_0x4bb641[0x0][_0x384a9a(0x1f6)]+_0x384a9a(0x1c5)+_0x384a9a(0x257)+'</div>'+_0x384a9a(0x286)};_0x34def7['sendMail'](_0x58e3b7,function(_0x7fc711,_0x55c117){var _0x217b1e=_0x384a9a;_0x7fc711?(console['log'](_0x7fc711),console[_0x217b1e(0x198)](_0x217b1e(0x1a5))):console[_0x217b1e(0x198)](_0x217b1e(0x1b9));}),_0x55cfb1['flash'](_0x384a9a(0x1fe),'Purchase\x20data\x20added\x20successfully'),_0x9774f1[_0x384a9a(0x206)](_0x384a9a(0x27e));}catch(_0x2a3b00){console['error'](_0x2a3b00),_0x9774f1['status'](0x1f4)['json']({'error':_0x384a9a(0x214)});}})[_0x1ee2a2(0x1f5)](_0x5e5d1b=>{var _0x3e46e1=_0x1ee2a2;console[_0x3e46e1(0x236)](_0x5e5d1b),_0x9774f1[_0x3e46e1(0x259)](0x1f4)['json']({'error':_0x3e46e1(0x26e)});});}catch(_0xc2807){console['log'](_0xc2807);}}),router[a0_0xc1da41(0x1b1)]('/preview/:id',auth,async(_0xf23d19,_0x4c2337)=>{var _0x78e790=a0_0xc1da41;try{const {username:_0x3d74c3,email:_0x5e4cc2,role:_0xa8c316}=_0xf23d19[_0x78e790(0x196)],_0x450f34=_0xf23d19['user'],_0x3c66b5=await profile[_0x78e790(0x17b)]({'email':_0x450f34[_0x78e790(0x1b0)]}),_0x4cabef=await master_shop[_0x78e790(0x276)](),_0x1e1d6c=_0xf23d19[_0x78e790(0x26d)]['id'],_0x2ab26c=await purchases['findById'](_0x1e1d6c),_0x3aeef8=await warehouse['aggregate']([{'$match':{'name':_0x2ab26c[_0x78e790(0x1e3)],'room':_0x2ab26c[_0x78e790(0x1e0)]}},{'$unwind':_0x78e790(0x16c)},{'$group':{'_id':_0x78e790(0x1fa),'name':{'$first':_0x78e790(0x237)},'product_stock':{'$first':_0x78e790(0x260)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x78e790(0x240)},'type':{'$first':_0x78e790(0x1e1)},'floorlevel':{'$first':_0x78e790(0x1fb)},'primary_code':{'$first':_0x78e790(0x22a)},'secondary_code':{'$first':_0x78e790(0x19c)},'product_code':{'$first':_0x78e790(0x183)},'storage':{'$first':_0x78e790(0x21e)},'rack':{'$first':_0x78e790(0x278)},'expiry_date':{'$first':_0x78e790(0x269)}}}]),_0x10b5fa=await customer[_0x78e790(0x276)]({});let _0x3a62d3;if(_0x450f34[_0x78e790(0x266)]=='staff'){const _0x5d745f=await staff[_0x78e790(0x17b)]({'email':_0x450f34[_0x78e790(0x1b0)]});_0x3a62d3=await warehouse[_0x78e790(0x19b)]([{'$match':{'status':'Enabled','name':_0x5d745f['warehouse']}},{'$group':{'_id':'$name','name':{'$first':_0x78e790(0x179)}}}]);}else _0x3a62d3=await warehouse[_0x78e790(0x19b)]([{'$match':{'status':_0x78e790(0x1be)}},{'$group':{'_id':_0x78e790(0x179),'name':{'$first':_0x78e790(0x179)}}}]);const _0x6aef55=await product[_0x78e790(0x276)]({}),_0xcbceeb=await suppliers[_0x78e790(0x276)]({}),_0x1550f7=BayBinSelected(_0x2ab26c[_0x78e790(0x1e3)],_0x2ab26c[_0x78e790(0x1e0)]);if(_0x4cabef[0x0][_0x78e790(0x1e7)]==_0x78e790(0x1a0)){var _0x5d89e8=users[_0x78e790(0x26f)];console[_0x78e790(0x198)](_0x5d89e8);}else{if(_0x4cabef[0x0]['language']==_0x78e790(0x238))var _0x5d89e8=users[_0x78e790(0x238)];else{if(_0x4cabef[0x0][_0x78e790(0x1e7)]==_0x78e790(0x253))var _0x5d89e8=users[_0x78e790(0x253)];else{if(_0x4cabef[0x0]['language']==_0x78e790(0x1f7))var _0x5d89e8=users[_0x78e790(0x1f7)];else{if(_0x4cabef[0x0][_0x78e790(0x1e7)]=='French')var _0x5d89e8=users[_0x78e790(0x16a)];else{if(_0x4cabef[0x0][_0x78e790(0x1e7)]=='Portuguese\x20(BR)')var _0x5d89e8=users[_0x78e790(0x22b)];else{if(_0x4cabef[0x0][_0x78e790(0x1e7)]==_0x78e790(0x250))var _0x5d89e8=users[_0x78e790(0x250)];else{if(_0x4cabef[0x0]['language']=='Arabic\x20(ae)')var _0x5d89e8=users['Arabic'];}}}}}}}_0x4c2337[_0x78e790(0x1a6)](_0x78e790(0x1b5),{'success':_0xf23d19[_0x78e790(0x197)]('success'),'errors':_0xf23d19['flash'](_0x78e790(0x274)),'role':_0x450f34,'profile':_0x3c66b5,'customer':_0x10b5fa,'warehouse':_0x3a62d3,'product':_0x3aeef8,'user':_0x2ab26c,'master_shop':_0x4cabef,'unit':_0x6aef55,'language':_0x5d89e8,'suppliers':_0xcbceeb,'dataSelected':_0x1550f7});}catch(_0x24174b){console['log'](_0x24174b);}}),router[a0_0xc1da41(0x280)]('/preview/:id',auth,async(_0x5a26a8,_0x4ffe16)=>{var _0x1c5811=a0_0xc1da41;try{const _0x5a062b=_0x5a26a8[_0x1c5811(0x26d)]['id'],{invoice:_0x4933e1,warehouse_name:_0x508048,Room_name:_0x4ca1e8}=_0x5a26a8[_0x1c5811(0x1c9)],_0x2cff26=await warehouse[_0x1c5811(0x17b)]({'name':_0x508048,'room':_0x4ca1e8}),_0x4541d5=await purchases[_0x1c5811(0x17b)]({'invoice':_0x4933e1});_0x4541d5['product']['forEach'](_0x37c48b=>{var _0x56be8d=_0x1c5811,_0x49748e=0x0;const _0x3c805a=_0x2cff26[_0x56be8d(0x245)][_0x56be8d(0x1e5)](_0x118fca=>{var _0x1d2638=_0x56be8d;_0x118fca[_0x1d2638(0x20b)]==_0x37c48b[_0x1d2638(0x20b)]&&_0x118fca['floorlevel']==_0x37c48b[_0x1d2638(0x252)]&&_0x118fca[_0x1d2638(0x1f2)]==_0x37c48b[_0x1d2638(0x1f2)]&&_0x118fca[_0x1d2638(0x1bf)]==_0x37c48b[_0x1d2638(0x1bf)]&&_0x118fca[_0x1d2638(0x190)]==_0x37c48b[_0x1d2638(0x190)]&&_0x118fca['rack']==_0x37c48b[_0x1d2638(0x215)]&&_0x118fca[_0x1d2638(0x24c)]==_0x37c48b[_0x1d2638(0x24c)]&&_0x118fca['expiry_date']==_0x37c48b[_0x1d2638(0x209)]&&_0x118fca[_0x1d2638(0x1ca)]==_0x37c48b[_0x1d2638(0x1ca)]&&_0x118fca[_0x1d2638(0x1a9)]==_0x37c48b[_0x1d2638(0x1a9)]&&_0x118fca[_0x1d2638(0x1c6)]==_0x37c48b[_0x1d2638(0x1c6)]&&_0x118fca[_0x1d2638(0x1a1)]==_0x37c48b[_0x1d2638(0x1a1)]&&(_0x118fca[_0x1d2638(0x247)]=parseInt(_0x118fca['product_stock'])+parseInt(_0x37c48b['quantity']),_0x49748e++);});_0x49748e=='0'&&(_0x2cff26[_0x56be8d(0x245)]=_0x2cff26[_0x56be8d(0x245)][_0x56be8d(0x1d8)]({'product_name':_0x37c48b[_0x56be8d(0x20b)],'product_stock':_0x37c48b[_0x56be8d(0x27d)],'primary_code':_0x37c48b[_0x56be8d(0x25d)],'secondary_code':_0x37c48b[_0x56be8d(0x1b4)],'product_code':_0x37c48b[_0x56be8d(0x23c)],'storage':_0x37c48b[_0x56be8d(0x24c)],'rack':_0x37c48b[_0x56be8d(0x215)],'bay':_0x37c48b[_0x56be8d(0x190)],'bin':_0x37c48b[_0x56be8d(0x1bf)],'type':_0x37c48b[_0x56be8d(0x1f2)],'floorlevel':_0x37c48b[_0x56be8d(0x252)],'maxProducts':_0x37c48b[_0x56be8d(0x17d)],'unit':_0x37c48b[_0x56be8d(0x1aa)],'secondary_unit':_0x37c48b['secondary_unit'],'expiry_date':_0x37c48b[_0x56be8d(0x209)],'maxPerUnit':_0x37c48b['maxperunit'],'batch_code':_0x37c48b[_0x56be8d(0x1ca)],'alertQTY':_0x37c48b[_0x56be8d(0x258)],'production_date':_0x37c48b[_0x56be8d(0x1a9)],'delivery_date':_0x37c48b[_0x56be8d(0x1c6)],'delivery_code':_0x37c48b[_0x56be8d(0x1a1)]}));}),await _0x2cff26['save'](),_0x4541d5[_0x1c5811(0x27c)]=_0x1c5811(0x1e6);const _0x88a683=await _0x4541d5[_0x1c5811(0x17e)]();_0x5a26a8['flash']('success',_0x1c5811(0x1d7)),_0x4ffe16[_0x1c5811(0x206)]('/all_purchases/view');}catch(_0x584ac9){console['log'](_0x584ac9);}}),router[a0_0xc1da41(0x1b1)](a0_0xc1da41(0x18b),auth,async(_0x51d29e,_0x149e30)=>{var _0x41442a=a0_0xc1da41;try{const {username:_0x5efc81,email:_0x497d70,role:_0x23cf25}=_0x51d29e[_0x41442a(0x196)],_0x4cab91=_0x51d29e[_0x41442a(0x196)],_0x1a23e2=await profile[_0x41442a(0x17b)]({'email':_0x4cab91[_0x41442a(0x1b0)]}),_0x4284c2=await master_shop[_0x41442a(0x276)](),_0x39cedb=_0x51d29e[_0x41442a(0x26d)]['id'],_0x2ad9c8=await purchases['findById'](_0x39cedb),_0x2bb1da=await suppliers['find']({});let _0x59dfdc;if(_0x4cab91[_0x41442a(0x266)]==_0x41442a(0x268)){const _0x4d4d7d=await staff['findOne']({'email':_0x4cab91['email']});_0x59dfdc=await warehouse[_0x41442a(0x276)]({'status':'Enabled','name':_0x4d4d7d['warehouse'],'warehouse_category':_0x41442a(0x1cd)});}else _0x59dfdc=await warehouse[_0x41442a(0x19b)]([{'$match':{'status':'Enabled','warehouse_category':_0x41442a(0x1cd)}},{'$group':{'_id':_0x41442a(0x179),'name':{'$first':_0x41442a(0x179)}}}]);const _0x387485=await product[_0x41442a(0x276)]({}),_0x5e95a0=BayBinSelected(_0x2ad9c8[_0x41442a(0x1e3)],_0x2ad9c8[_0x41442a(0x1e0)]);let _0xf1fd6=new Date(_0x2ad9c8[_0x41442a(0x209)]),_0x12bbaf=('0'+_0xf1fd6[_0x41442a(0x243)]())[_0x41442a(0x246)](-0x2),_0x200cc9=('0'+(_0xf1fd6[_0x41442a(0x242)]()+0x1))[_0x41442a(0x246)](-0x2),_0x598027=_0xf1fd6[_0x41442a(0x23e)](),_0x366148=_0x598027+'-'+_0x200cc9+'-'+_0x12bbaf;if(_0x4284c2[0x0][_0x41442a(0x1e7)]==_0x41442a(0x1a0)){var _0x17c9b3=users['English'];console[_0x41442a(0x198)](_0x17c9b3);}else{if(_0x4284c2[0x0][_0x41442a(0x1e7)]==_0x41442a(0x238))var _0x17c9b3=users[_0x41442a(0x238)];else{if(_0x4284c2[0x0][_0x41442a(0x1e7)]=='German')var _0x17c9b3=users[_0x41442a(0x253)];else{if(_0x4284c2[0x0][_0x41442a(0x1e7)]==_0x41442a(0x1f7))var _0x17c9b3=users[_0x41442a(0x1f7)];else{if(_0x4284c2[0x0]['language']==_0x41442a(0x16a))var _0x17c9b3=users['French'];else{if(_0x4284c2[0x0][_0x41442a(0x1e7)]==_0x41442a(0x17a))var _0x17c9b3=users[_0x41442a(0x22b)];else{if(_0x4284c2[0x0][_0x41442a(0x1e7)]=='Chinese')var _0x17c9b3=users['Chinese'];else{if(_0x4284c2[0x0][_0x41442a(0x1e7)]==_0x41442a(0x284))var _0x17c9b3=users[_0x41442a(0x283)];}}}}}}}_0x149e30['render'](_0x41442a(0x264),{'success':_0x51d29e[_0x41442a(0x197)](_0x41442a(0x1fe)),'errors':_0x51d29e['flash'](_0x41442a(0x274)),'role':_0x4cab91,'profile':_0x1a23e2,'purchases':_0x2ad9c8,'suppliers':_0x2bb1da,'warehouse':_0x59dfdc,'product':_0x387485,'master_shop':_0x4284c2,'language':_0x17c9b3,'ed_fullDate':_0x366148,'dataSelected':_0x5e95a0});}catch(_0x53acfe){console[_0x41442a(0x198)](_0x53acfe);}}),router['post'](a0_0xc1da41(0x18b),auth,async(_0x24bf38,_0x1b374e)=>{var _0x315b58=a0_0xc1da41;try{const _0x5f29bf=_0x24bf38['params']['id'],_0x971da0=await purchases[_0x315b58(0x17b)]({'_id':_0x24bf38[_0x315b58(0x26d)]['id']}),_0x16a2bb=await warehouse[_0x315b58(0x17b)]({'name':_0x971da0[_0x315b58(0x1e3)],'room':_0x971da0['room']});_0x971da0[_0x315b58(0x18e)]['forEach'](_0x281774=>{var _0x2426fd=_0x315b58;const _0xcf169e=_0x16a2bb[_0x2426fd(0x245)][_0x2426fd(0x1e5)](_0x4455ae=>{var _0x4d9982=_0x2426fd;_0x4455ae[_0x4d9982(0x20b)]==_0x281774['product_name']&&_0x4455ae[_0x4d9982(0x252)]==_0x281774[_0x4d9982(0x252)]&&_0x4455ae['type']==_0x281774[_0x4d9982(0x1f2)]&&_0x4455ae[_0x4d9982(0x1bf)]==_0x281774[_0x4d9982(0x1bf)]&&_0x4455ae[_0x4d9982(0x190)]==_0x281774['bay']&&_0x4455ae[_0x4d9982(0x215)]==_0x281774[_0x4d9982(0x215)]&&_0x4455ae['storage']==_0x281774[_0x4d9982(0x24c)]&&(_0x4455ae[_0x4d9982(0x247)]=parseInt(_0x4455ae[_0x4d9982(0x247)])-parseInt(_0x281774[_0x4d9982(0x27d)]));});}),await _0x16a2bb[_0x315b58(0x17e)]();const {invoice:_0x33778a,suppliers:_0xd56f32,date:_0x29030e,warehouse_name:_0x4f261f,prod_name:_0x26bf72,prod_code:_0x25dd37,prod_qty:_0x2cbe56,prod_unit:_0x4308a8,prod_secondunit:_0x5615e9,prod_level:_0xcc04a2,prod_isle:_0x320f14,prod_pallet:_0x418aeb,note:_0x5cd86b,expiry_date:_0x4a6b01,batch_code:_0x2da589,paid_amount:_0x10c445,due_amount:_0x5d7365,Room_name:_0x436740,primary_code:_0x1d3107,secondary_code:_0x297034,PO_number:_0x115b1a,JO_number:_0x3b8bf7}=_0x24bf38[_0x315b58(0x1c9)];if(typeof _0x26bf72==_0x315b58(0x1a2))var _0x5d8c7d=[_0x24bf38['body'][_0x315b58(0x1d6)]],_0x3286da=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1d4)]],_0x4cd174=[_0x24bf38[_0x315b58(0x1c9)]['prod_qty']],_0x5d6a68=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x239)]],_0x590035=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x216)]],_0x5e28f2=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x212)]],_0x23474e=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x182)]],_0x46fc61=[_0x24bf38[_0x315b58(0x1c9)]['prod_pallet']],_0x5be9f3=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x25d)]],_0x373845=[_0x24bf38['body'][_0x315b58(0x1b4)]],_0x14d7f2=[_0x24bf38['body']['MaxStocks_data']],_0x18ff66=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1ca)]],_0x5a0bb7=[_0x24bf38[_0x315b58(0x1c9)]['expiry_date']],_0x5cf6e8=[_0x24bf38['body'][_0x315b58(0x24c)]],_0x13d56e=[_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x22e)]],_0x587aaa=[_0x24bf38['body'][_0x315b58(0x1f2)]];else var _0x5d8c7d=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1d6)]],_0x3286da=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1d4)]],_0x4cd174=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1c8)]],_0x5d6a68=[..._0x24bf38[_0x315b58(0x1c9)]['prod_unit']],_0x590035=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x216)]],_0x5e28f2=[..._0x24bf38[_0x315b58(0x1c9)]['prod_level']],_0x23474e=[..._0x24bf38['body'][_0x315b58(0x182)]],_0x46fc61=[..._0x24bf38[_0x315b58(0x1c9)]['prod_pallet']],_0x5be9f3=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x25d)]],_0x373845=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1b4)]],_0x14d7f2=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x23b)]],_0x18ff66=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1ca)]],_0x5a0bb7=[..._0x24bf38['body'][_0x315b58(0x209)]],_0x5cf6e8=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x24c)]],_0x13d56e=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x22e)]],_0x587aaa=[..._0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1f2)]];const _0x2dfd6f=_0x5d8c7d[_0x315b58(0x1e5)](_0xd5f65=>{return _0xd5f65={'product_name':_0xd5f65};});_0x3286da[_0x315b58(0x232)]((_0x418821,_0x2d3051)=>{var _0x18b515=_0x315b58;_0x2dfd6f[_0x2d3051][_0x18b515(0x23c)]=_0x418821;}),_0x4cd174[_0x315b58(0x232)]((_0x1f32dc,_0xa6ca99)=>{_0x2dfd6f[_0xa6ca99]['quantity']=_0x1f32dc;}),_0x5d6a68[_0x315b58(0x232)]((_0x414c40,_0x59d20a)=>{var _0x1706be=_0x315b58;_0x2dfd6f[_0x59d20a][_0x1706be(0x1aa)]=_0x414c40;}),_0x590035[_0x315b58(0x232)]((_0x328ca6,_0x2a4619)=>{var _0x21cac6=_0x315b58;_0x2dfd6f[_0x2a4619][_0x21cac6(0x178)]=_0x328ca6;}),_0x5e28f2['forEach']((_0x3e7335,_0x514236)=>{var _0x58e98e=_0x315b58;_0x2dfd6f[_0x514236][_0x58e98e(0x190)]=_0x3e7335;}),_0x23474e[_0x315b58(0x232)]((_0x12c6ea,_0x1bbf48)=>{_0x2dfd6f[_0x1bbf48]['bin']=_0x12c6ea;}),_0x46fc61[_0x315b58(0x232)]((_0x52b186,_0x7432b4)=>{var _0x3ec410=_0x315b58;_0x2dfd6f[_0x7432b4][_0x3ec410(0x252)]=_0x52b186;}),_0x5be9f3[_0x315b58(0x232)]((_0x3910f9,_0x484932)=>{var _0x43da33=_0x315b58;_0x2dfd6f[_0x484932][_0x43da33(0x25d)]=_0x3910f9;}),_0x373845[_0x315b58(0x232)]((_0x43d1fb,_0x45bff9)=>{var _0x2fab8b=_0x315b58;_0x2dfd6f[_0x45bff9][_0x2fab8b(0x1b4)]=_0x43d1fb;}),_0x14d7f2['forEach']((_0x3ddf2e,_0x5c1d6a)=>{var _0x458be3=_0x315b58;_0x2dfd6f[_0x5c1d6a][_0x458be3(0x17d)]=_0x3ddf2e;}),_0x18ff66[_0x315b58(0x232)]((_0x4a0662,_0x42ce17)=>{var _0x5f5141=_0x315b58;_0x2dfd6f[_0x42ce17][_0x5f5141(0x1ca)]=_0x4a0662;}),_0x5a0bb7[_0x315b58(0x232)]((_0x127b0e,_0x5a2064)=>{var _0x1e8eca=_0x315b58;_0x2dfd6f[_0x5a2064][_0x1e8eca(0x209)]=_0x127b0e;}),_0x587aaa[_0x315b58(0x232)]((_0x58e4c4,_0x28f1a9)=>{_0x2dfd6f[_0x28f1a9]['type']=_0x58e4c4;}),_0x5cf6e8[_0x315b58(0x232)]((_0x52c2e2,_0x2c9d6a)=>{var _0x54ff27=_0x315b58;_0x2dfd6f[_0x2c9d6a][_0x54ff27(0x24c)]=_0x52c2e2;}),_0x13d56e[_0x315b58(0x232)]((_0x3e622e,_0x57c1a6)=>{var _0x5d07e7=_0x315b58;_0x2dfd6f[_0x57c1a6][_0x5d07e7(0x215)]=_0x3e622e;});const _0x42478a=_0x2dfd6f[_0x315b58(0x176)](_0x376532=>_0x376532[_0x315b58(0x27d)]!=='0'&&_0x376532[_0x315b58(0x27d)]!=='');_0x971da0['invoice']=_0x33778a,_0x971da0[_0x315b58(0x207)]=_0xd56f32,_0x971da0[_0x315b58(0x26b)]=_0x29030e,_0x971da0[_0x315b58(0x1e3)]=_0x4f261f,_0x971da0[_0x315b58(0x18e)]=_0x42478a,_0x971da0[_0x315b58(0x1af)]=_0x5cd86b,_0x971da0['paid_amount']=_0x10c445,_0x971da0[_0x315b58(0x1df)]=_0x5d7365,_0x971da0[_0x315b58(0x1e0)]=_0x436740,_0x971da0['POnumber']=_0x115b1a,_0x971da0[_0x315b58(0x281)]=_0x3b8bf7;const _0x3b7060=await _0x971da0['save'](),_0x2ed69b=await warehouse[_0x315b58(0x17b)]({'name':_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1e3)],'room':_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x1b8)]});_0x971da0[_0x315b58(0x18e)][_0x315b58(0x232)](_0x1b5c73=>{var _0x5e63e6=_0x315b58,_0x16470f=0x0;const _0xb13724=_0x2ed69b[_0x5e63e6(0x245)]['map'](_0x35696e=>{var _0x1cf005=_0x5e63e6;_0x35696e[_0x1cf005(0x20b)]==_0x1b5c73['product_name']&&_0x35696e['floorlevel']==_0x1b5c73['floorlevel']&&_0x35696e[_0x1cf005(0x1f2)]==_0x1b5c73[_0x1cf005(0x1f2)]&&_0x35696e[_0x1cf005(0x1bf)]==_0x1b5c73[_0x1cf005(0x1bf)]&&_0x35696e['bay']==_0x1b5c73['bay']&&_0x35696e[_0x1cf005(0x215)]==_0x1b5c73['rack']&&_0x35696e[_0x1cf005(0x24c)]==_0x1b5c73[_0x1cf005(0x24c)]&&(_0x35696e[_0x1cf005(0x247)]=parseInt(_0x35696e['product_stock'])+parseInt(_0x1b5c73['quantity']),_0x16470f++);});_0x16470f=='0'&&(_0x2ed69b[_0x5e63e6(0x245)]=_0x2ed69b[_0x5e63e6(0x245)][_0x5e63e6(0x1d8)]({'product_name':_0x1b5c73[_0x5e63e6(0x20b)],'product_stock':_0x1b5c73[_0x5e63e6(0x27d)],'primary_code':_0x1b5c73[_0x5e63e6(0x25d)],'secondary_code':_0x1b5c73['secondary_code'],'product_code':_0x1b5c73[_0x5e63e6(0x23c)],'storage':_0x1b5c73[_0x5e63e6(0x24c)],'rack':_0x1b5c73[_0x5e63e6(0x215)],'bay':_0x1b5c73[_0x5e63e6(0x190)],'bin':_0x1b5c73['bin'],'type':_0x1b5c73['type'],'floorlevel':_0x1b5c73[_0x5e63e6(0x252)],'maxProducts':_0x1b5c73[_0x5e63e6(0x17d)],'unit':_0x1b5c73['standard_unit'],'secondary_unit':_0x1b5c73['secondary_unit'],'expiry_date':_0x1b5c73[_0x5e63e6(0x209)]}));}),await _0x2ed69b['save']();const _0x172435=await s_payment_data['findOne']({'invoice':_0x24bf38[_0x315b58(0x1c9)]['invoice']});if(_0x172435===null){}else console[_0x315b58(0x198)](_0x315b58(0x207),_0x172435,_0x24bf38[_0x315b58(0x1c9)]['invoice']),_0x172435[_0x315b58(0x207)]=_0x24bf38[_0x315b58(0x1c9)][_0x315b58(0x207)],await _0x172435[_0x315b58(0x17e)]();_0x24bf38['flash'](_0x315b58(0x1fe),_0x315b58(0x217)),_0x1b374e[_0x315b58(0x206)](_0x315b58(0x271));}catch(_0xd09d28){console[_0x315b58(0x198)](_0xd09d28);}}),router[a0_0xc1da41(0x280)](a0_0xc1da41(0x233),auth,async(_0x6a0eec,_0x146621)=>{var _0x2e926f=a0_0xc1da41;try{const _0x3cff62=_0x6a0eec[_0x2e926f(0x26d)]['id'],{invoice:_0x1a4153,suppliers:_0x2b91bc,payable:_0x3d2fe6,due_amount:_0x30de23}=_0x6a0eec[_0x2e926f(0x1c9)],_0x3eca6d=await purchases['findById'](_0x3cff62);var _0x545e03=_0x3d2fe6-_0x30de23;_0x3eca6d[_0x2e926f(0x228)]=parseFloat(_0x3eca6d['paid_amount'])+parseFloat(_0x30de23),_0x3eca6d[_0x2e926f(0x1df)]=_0x545e03;const _0x4a33be=await _0x3eca6d[_0x2e926f(0x17e)]();console[_0x2e926f(0x198)](_0x4a33be);const _0x48368d=await s_payment_data['findOne']({'invoice':_0x1a4153});_0x48368d[_0x2e926f(0x226)]=_0x545e03,await _0x48368d[_0x2e926f(0x17e)]();let _0x3a80fa=new Date(),_0x359503=('0'+_0x3a80fa[_0x2e926f(0x243)]())[_0x2e926f(0x246)](-0x2),_0x47e5a4=('0'+(_0x3a80fa[_0x2e926f(0x242)]()+0x1))[_0x2e926f(0x246)](-0x2),_0x3c8890=_0x3a80fa[_0x2e926f(0x23e)](),_0x236925=_0x3c8890+'-'+_0x47e5a4+'-'+_0x359503;const _0x21d691=new suppliers_payment({'invoice':_0x1a4153,'date':_0x3c8890+'-'+_0x47e5a4+'-'+_0x359503,'suppliers':_0x2b91bc,'reason':_0x2e926f(0x1de),'amount':_0x30de23}),_0x3f9ef2=await _0x21d691[_0x2e926f(0x17e)]();_0x6a0eec[_0x2e926f(0x197)](_0x2e926f(0x1fe),_0x2e926f(0x185)),_0x146621['redirect'](_0x2e926f(0x271));}catch(_0x43fd6d){console[_0x2e926f(0x198)](_0x43fd6d);}}),router[a0_0xc1da41(0x1b1)](a0_0xc1da41(0x180),auth,async(_0x302a43,_0xf98777)=>{var _0xdea5e4=a0_0xc1da41;try{const {username:_0x5cdf0e,email:_0x39fe5a,role:_0x377eb1}=_0x302a43['user'],_0x5241f6=_0x302a43['user'],_0xd8c708=await profile[_0xdea5e4(0x17b)]({'email':_0x5241f6[_0xdea5e4(0x1b0)]}),_0x4bcfe6=await master_shop[_0xdea5e4(0x276)]();console[_0xdea5e4(0x198)]('master',_0x4bcfe6);const _0x5a3aa2=_0x302a43[_0xdea5e4(0x26d)]['id'],_0x3e8603=await purchases['findById'](_0x5a3aa2);console['log'](_0x3e8603);const _0x5346f7=await suppliers['findOne']({'name':_0x3e8603[_0xdea5e4(0x207)]});console[_0xdea5e4(0x198)](_0x5346f7);if(_0x4bcfe6[0x0][_0xdea5e4(0x1e7)]==_0xdea5e4(0x1a0)){var _0x3620a6=users[_0xdea5e4(0x26f)];console[_0xdea5e4(0x198)](_0x3620a6);}else{if(_0x4bcfe6[0x0]['language']==_0xdea5e4(0x238))var _0x3620a6=users['Hindi'];else{if(_0x4bcfe6[0x0]['language']==_0xdea5e4(0x253))var _0x3620a6=users[_0xdea5e4(0x253)];else{if(_0x4bcfe6[0x0][_0xdea5e4(0x1e7)]==_0xdea5e4(0x1f7))var _0x3620a6=users[_0xdea5e4(0x1f7)];else{if(_0x4bcfe6[0x0]['language']==_0xdea5e4(0x16a))var _0x3620a6=users['French'];else{if(_0x4bcfe6[0x0][_0xdea5e4(0x1e7)]=='Portuguese\x20(BR)')var _0x3620a6=users['Portuguese'];else{if(_0x4bcfe6[0x0][_0xdea5e4(0x1e7)]==_0xdea5e4(0x250))var _0x3620a6=users[_0xdea5e4(0x250)];else{if(_0x4bcfe6[0x0]['language']=='Arabic\x20(ae)')var _0x3620a6=users[_0xdea5e4(0x283)];}}}}}}}_0xf98777[_0xdea5e4(0x1a6)](_0xdea5e4(0x16e),{'success':_0x302a43[_0xdea5e4(0x197)](_0xdea5e4(0x1fe)),'errors':_0x302a43['flash'](_0xdea5e4(0x274)),'role':_0x5241f6,'profile':_0xd8c708,'master_shop':_0x4bcfe6,'supplier':_0x5346f7,'purchase':_0x3e8603,'language':_0x3620a6});}catch(_0x2f050f){console['log'](_0x2f050f);}}),router['get']('/view/return_purchase/:id',auth,async(_0x1a0d40,_0x2e2733)=>{var _0x1b4b5a=a0_0xc1da41;try{const {username:_0xf97f3f,email:_0x597e13,role:_0x6fa1ba}=_0x1a0d40['user'],_0x2f9234=_0x1a0d40[_0x1b4b5a(0x196)],_0x3be985=await profile[_0x1b4b5a(0x17b)]({'email':_0x2f9234[_0x1b4b5a(0x1b0)]}),_0x11e3d0=await master_shop['find']();console[_0x1b4b5a(0x198)](_0x1b4b5a(0x1e9),_0x11e3d0);const _0x3fdac3=_0x1a0d40[_0x1b4b5a(0x26d)]['id'];console[_0x1b4b5a(0x198)](_0x3fdac3);const _0x1e3370=await purchases['findById'](_0x3fdac3);console[_0x1b4b5a(0x198)](_0x1b4b5a(0x16b),_0x1e3370);const _0x5e48b8=await product[_0x1b4b5a(0x276)]({}),_0x543a40=await warehouse['aggregate']([{'$match':{'name':_0x1e3370[_0x1b4b5a(0x1e3)],'room':_0x1e3370[_0x1b4b5a(0x1e0)],'warehouse_category':_0x1b4b5a(0x1cd)}},{'$unwind':_0x1b4b5a(0x16c)},{'$group':{'_id':_0x1b4b5a(0x1fa),'name':{'$first':_0x1b4b5a(0x237)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1b4b5a(0x240)},'type':{'$first':_0x1b4b5a(0x1e1)},'floorlevel':{'$first':_0x1b4b5a(0x1fb)},'primary_code':{'$first':_0x1b4b5a(0x22a)},'secondary_code':{'$first':_0x1b4b5a(0x19c)},'product_code':{'$first':_0x1b4b5a(0x183)},'storage':{'$first':_0x1b4b5a(0x21e)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x1b4b5a(0x19b)]([{'$match':{'status':'Enabled','name':_0x1b4b5a(0x249),'warehouse_category':_0x1b4b5a(0x1cd)}},{'$group':{'_id':_0x1b4b5a(0x179),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x1b4b5a(0x198)](_0x1b4b5a(0x248),_0x543a40);if(_0x11e3d0[0x0]['language']==_0x1b4b5a(0x1a0)){var _0x5c691a=users[_0x1b4b5a(0x26f)];console[_0x1b4b5a(0x198)](_0x5c691a);}else{if(_0x11e3d0[0x0][_0x1b4b5a(0x1e7)]=='Hindi')var _0x5c691a=users[_0x1b4b5a(0x238)];else{if(_0x11e3d0[0x0]['language']=='German')var _0x5c691a=users['German'];else{if(_0x11e3d0[0x0][_0x1b4b5a(0x1e7)]==_0x1b4b5a(0x1f7))var _0x5c691a=users[_0x1b4b5a(0x1f7)];else{if(_0x11e3d0[0x0][_0x1b4b5a(0x1e7)]==_0x1b4b5a(0x16a))var _0x5c691a=users[_0x1b4b5a(0x16a)];else{if(_0x11e3d0[0x0]['language']=='Portuguese\x20(BR)')var _0x5c691a=users[_0x1b4b5a(0x22b)];else{if(_0x11e3d0[0x0]['language']==_0x1b4b5a(0x250))var _0x5c691a=users['Chinese'];else{if(_0x11e3d0[0x0]['language']==_0x1b4b5a(0x284))var _0x5c691a=users[_0x1b4b5a(0x283)];}}}}}}}_0x2e2733[_0x1b4b5a(0x1a6)](_0x1b4b5a(0x1dd),{'success':_0x1a0d40['flash'](_0x1b4b5a(0x1fe)),'errors':_0x1a0d40[_0x1b4b5a(0x197)](_0x1b4b5a(0x274)),'role':_0x2f9234,'profile':_0x3be985,'user':_0x1e3370,'stock':_0x543a40,'master_shop':_0x11e3d0,'product':_0x5e48b8,'language':_0x5c691a,'warehouse':warehouse_data});}catch(_0x4de124){console[_0x1b4b5a(0x198)](_0x4de124);}}),router[a0_0xc1da41(0x280)]('/view/return_purchase/:id',auth,async(_0x537358,_0x49f098)=>{var _0xd24941=a0_0xc1da41;try{const {invoice:_0x302574,date:_0x8e3385,warehouse_name:_0x5294fa,Room_name:_0x5479ad,product_name:_0x1454f7,purchase_quantity:_0xc09359,stocks:_0x14d154,return_qty:_0x65d425,note:_0x41284e,level:_0x4918b7,isle:_0xd362ef,pallet:_0x42231c,to_warehouse_name:_0x122c2d,to_Room_name:_0x4135b2}=_0x537358[_0xd24941(0x1c9)],_0x76b4b9=await purchases[_0xd24941(0x17b)]({'_id':_0x537358[_0xd24941(0x26d)]['id']}),_0x128e7b=await warehouse[_0xd24941(0x17b)]({'name':_0x5294fa,'room':_0x5479ad});if(typeof _0x1454f7==_0xd24941(0x1a2))var _0x2c5882=[_0x537358['body'][_0xd24941(0x20b)]],_0x3ee567=[_0x537358[_0xd24941(0x1c9)]['purchase_quantity']],_0x461497=[_0x537358[_0xd24941(0x1c9)][_0xd24941(0x21c)]],_0x58a962=[_0x537358['body']['return_qty']],_0x3ba5f9=[_0x537358[_0xd24941(0x1c9)][_0xd24941(0x1e4)]],_0x57fedf=[_0x537358[_0xd24941(0x1c9)]['isle']],_0x4e4e72=[_0x537358[_0xd24941(0x1c9)]['pallet']],_0xe62eb4=[_0x537358[_0xd24941(0x1c9)][_0xd24941(0x19d)]],_0x1189ec=[_0x537358[_0xd24941(0x1c9)][_0xd24941(0x22f)]],_0x287d30=[_0x537358[_0xd24941(0x1c9)]['primary_code_hide']],_0x5651bc=[_0x537358[_0xd24941(0x1c9)][_0xd24941(0x23d)]];else var _0x2c5882=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x20b)]],_0x3ee567=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x205)]],_0x461497=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x21c)]],_0x58a962=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x21f)]],_0x3ba5f9=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x1e4)]],_0x57fedf=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x1d2)]],_0x4e4e72=[..._0x537358['body'][_0xd24941(0x25e)]],_0xe62eb4=[..._0x537358['body']['types']],_0x1189ec=[..._0x537358['body'][_0xd24941(0x22f)]],_0x287d30=[..._0x537358[_0xd24941(0x1c9)]['primary_code_hide']],_0x5651bc=[..._0x537358[_0xd24941(0x1c9)][_0xd24941(0x23d)]];const _0x38c22b=_0x2c5882[_0xd24941(0x1e5)](_0xe94c59=>{return _0xe94c59={'product_name':_0xe94c59};});_0x3ee567[_0xd24941(0x232)]((_0x436c9d,_0x4434d2)=>{var _0x2b8a9b=_0xd24941;_0x38c22b[_0x4434d2][_0x2b8a9b(0x205)]=_0x436c9d;}),_0x461497[_0xd24941(0x232)]((_0x694f64,_0x1e1690)=>{var _0x9daf5=_0xd24941;_0x38c22b[_0x1e1690][_0x9daf5(0x1ae)]=_0x694f64;}),_0x58a962['forEach']((_0x59db17,_0x1383a4)=>{var _0x273193=_0xd24941;_0x38c22b[_0x1383a4][_0x273193(0x21f)]=_0x59db17;}),_0x3ba5f9[_0xd24941(0x232)]((_0x5643dc,_0x2bfa5b)=>{var _0x27057f=_0xd24941;_0x38c22b[_0x2bfa5b][_0x27057f(0x190)]=_0x5643dc;}),_0x57fedf['forEach']((_0xacc10,_0xa1d2e4)=>{var _0x1369a9=_0xd24941;_0x38c22b[_0xa1d2e4][_0x1369a9(0x1bf)]=_0xacc10;}),_0x4e4e72[_0xd24941(0x232)]((_0x3a28bd,_0x582f1b)=>{var _0x517ca5=_0xd24941;_0x38c22b[_0x582f1b][_0x517ca5(0x252)]=_0x3a28bd;}),_0xe62eb4[_0xd24941(0x232)]((_0x35f06a,_0x265d65)=>{var _0x54bd54=_0xd24941;_0x38c22b[_0x265d65][_0x54bd54(0x1f2)]=_0x35f06a;}),_0x1189ec[_0xd24941(0x232)]((_0x4aca87,_0x240854)=>{_0x38c22b[_0x240854]['product_code']=_0x4aca87;}),_0x287d30[_0xd24941(0x232)]((_0x1ce7a3,_0xafdf4f)=>{_0x38c22b[_0xafdf4f]['primary_code']=_0x1ce7a3;}),_0x5651bc[_0xd24941(0x232)]((_0x482bf3,_0x2b1a59)=>{var _0x23e676=_0xd24941;_0x38c22b[_0x2b1a59][_0x23e676(0x1b4)]=_0x482bf3;}),_0x76b4b9['product'][_0xd24941(0x232)](_0x198d4d=>{var _0x5e958f=_0xd24941;const _0x4591d9=_0x128e7b[_0x5e958f(0x245)]['map'](_0x215418=>{var _0x5f58c4=_0x5e958f;_0x215418[_0x5f58c4(0x20b)]==_0x198d4d[_0x5f58c4(0x20b)]&&_0x215418[_0x5f58c4(0x252)]==_0x198d4d[_0x5f58c4(0x252)]&&_0x215418[_0x5f58c4(0x1f2)]==_0x198d4d[_0x5f58c4(0x1f2)]&&_0x215418['bin']==_0x198d4d[_0x5f58c4(0x1bf)]&&_0x215418[_0x5f58c4(0x190)]==_0x198d4d[_0x5f58c4(0x190)]&&_0x215418[_0x5f58c4(0x215)]==_0x198d4d[_0x5f58c4(0x215)]&&_0x215418[_0x5f58c4(0x24c)]==_0x198d4d[_0x5f58c4(0x24c)]&&(console[_0x5f58c4(0x198)](parseInt(_0x215418['product_stock'])+_0x5f58c4(0x1ee)+parseInt(_0x198d4d[_0x5f58c4(0x27d)])),_0x215418[_0x5f58c4(0x247)]=parseInt(_0x215418[_0x5f58c4(0x247)])+parseInt(_0x198d4d[_0x5f58c4(0x27d)]));});}),await _0x128e7b[_0xd24941(0x17e)]();const _0x1baef3=_0x38c22b[_0xd24941(0x176)](_0x17917f=>_0x17917f[_0xd24941(0x21f)]!=='0'&&_0x17917f['return_qty']!=='');var _0x281965=0x0;_0x1baef3[_0xd24941(0x232)](_0x488859=>{var _0x20b575=_0xd24941;console['log'](_0x20b575(0x1c3),_0x488859),(parseInt(_0x488859['purchase_quantity'])<parseInt(_0x488859[_0x20b575(0x21f)])||parseInt(_0x488859[_0x20b575(0x1ae)])<parseInt(_0x488859['return_qty']))&&_0x281965++;});if(_0x281965!=0x0)return _0x537358[_0xd24941(0x197)](_0xd24941(0x274),_0xd24941(0x23a)),_0x49f098[_0xd24941(0x206)]('back');const _0x254119=new purchases_return({'invoice':_0x302574,'suppliers':_0x537358['body'][_0xd24941(0x207)],'date':_0x8e3385,'warehouse_name':_0x5294fa,'return_product':_0x1baef3,'note':_0x41284e,'room':_0x5479ad,'to_warehouse_name':_0x122c2d,'to_room':_0x4135b2}),_0x45d3cc=await _0x254119[_0xd24941(0x17e)]();console[_0xd24941(0x198)](_0x254119);const _0x1304a8=await purchases_return[_0xd24941(0x17b)]({'invoice':_0x302574}),_0x696ba7=await warehouse[_0xd24941(0x17b)]({'name':_0x122c2d,'room':_0x4135b2});_0x1304a8['return_product'][_0xd24941(0x232)](_0x12027c=>{var _0x59d4ff=_0xd24941,_0x52c246=0x0;const _0x353223=_0x696ba7[_0x59d4ff(0x245)][_0x59d4ff(0x1e5)](_0xcb9bbe=>{var _0x36a760=_0x59d4ff;_0xcb9bbe[_0x36a760(0x20b)]==_0x12027c[_0x36a760(0x20b)]&&_0xcb9bbe[_0x36a760(0x252)]==_0x12027c[_0x36a760(0x252)]&&_0xcb9bbe[_0x36a760(0x1f2)]==_0x12027c['type']&&_0xcb9bbe['bin']==_0x12027c['bin']&&_0xcb9bbe['bay']==_0x12027c[_0x36a760(0x190)]&&(_0xcb9bbe['product_stock']=parseInt(_0xcb9bbe['product_stock'])-parseInt(_0x12027c[_0x36a760(0x21f)]),_0x52c246++);});_0x52c246=='0'&&(_0x696ba7[_0x59d4ff(0x245)]=_0x696ba7[_0x59d4ff(0x245)][_0x59d4ff(0x1d8)]({'product_name':_0x12027c[_0x59d4ff(0x20b)],'product_stock':_0x12027c['return_qty'],'primary_code':_0x12027c[_0x59d4ff(0x25d)],'secondary_code':_0x12027c[_0x59d4ff(0x1b4)],'product_code':_0x12027c[_0x59d4ff(0x23c)],'storage':_0x12027c['storage'],'rack':_0x12027c[_0x59d4ff(0x215)],'bay':_0x12027c[_0x59d4ff(0x190)],'bin':_0x12027c['bin'],'type':_0x12027c[_0x59d4ff(0x1f2)],'floorlevel':_0x12027c[_0x59d4ff(0x252)],'maxProducts':_0x12027c[_0x59d4ff(0x17d)],'unit':_0x12027c[_0x59d4ff(0x1aa)],'secondary_unit':_0x12027c[_0x59d4ff(0x178)],'expiry_date':_0x12027c[_0x59d4ff(0x209)]}));}),await _0x696ba7[_0xd24941(0x17e)]();const _0x2bdbeb=await purchases[_0xd24941(0x17b)]({'invoice':_0x302574});_0x2bdbeb['return_data']=_0xd24941(0x1e6);const _0x42f038=await _0x2bdbeb[_0xd24941(0x17e)](),_0x2edbc9=new s_payment_data({'invoice':_0x302574,'suppliers':_0x537358['body']['suppliers'],'reason':_0xd24941(0x24d)});await _0x2edbc9[_0xd24941(0x17e)]();const _0x55b430=await master_shop[_0xd24941(0x276)]();console[_0xd24941(0x198)](_0xd24941(0x267),_0x55b430[0x0][_0xd24941(0x1fd)]);const _0x2ae6f2=await email_settings['findOne'](),_0x5bf8a9=await suppliers[_0xd24941(0x17b)]({'name':_0x537358[_0xd24941(0x1c9)]['suppliers']});console[_0xd24941(0x198)](_0xd24941(0x1ef),_0x5bf8a9);_0x55b430[0x0][_0xd24941(0x1c7)]==0x1?(right_currency=_0x55b430[0x0][_0xd24941(0x1b7)],left_currency=''):(right_currency='',left_currency=_0x55b430[0x0][_0xd24941(0x1b7)]);var _0xabdb8a=_0x2c5882,_0x573ddf=_0x58a962,_0x5c411d='',_0x4d6ebf;for(_0x4d6ebf in _0xabdb8a){_0x5c411d+='<tr>'+_0xd24941(0x17c)+_0xabdb8a[_0x4d6ebf]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x573ddf[_0x4d6ebf]+_0xd24941(0x22d)+'</tr>';}console['log'](_0xd24941(0x26a),_0x5c411d);let _0x4e4b88=nodemailer[_0xd24941(0x210)]({'service':_0xd24941(0x21b),'auth':{'user':_0x2ae6f2[_0xd24941(0x1b0)],'pass':_0x2ae6f2['password']}}),_0x2354fc={'from':_0x2ae6f2['email'],'to':_0x5bf8a9[_0xd24941(0x1b0)],'subject':_0xd24941(0x1cf),'attachments':[{'filename':_0xd24941(0x1a3),'path':__dirname+'/../public'+_0xd24941(0x1ad)+_0x55b430[0x0]['image'],'cid':_0xd24941(0x169)}],'html':_0xd24941(0x188)+'<html><head><title></title>'+_0xd24941(0x1f4)+_0xd24941(0x211)+_0xd24941(0x1ce)+_0xd24941(0x211)+_0xd24941(0x1f0)+_0xd24941(0x257)+_0xd24941(0x211)+_0xd24941(0x175)+_0x55b430[0x0]['site_title']+_0xd24941(0x20d)+_0xd24941(0x257)+_0xd24941(0x257)+_0xd24941(0x1d5)+_0xd24941(0x211)+_0xd24941(0x1ed)+_0xd24941(0x1a8)+_0x302574+'\x20'+_0xd24941(0x16d)+_0xd24941(0x177)+_0x8e3385+'\x20'+_0xd24941(0x193)+'</h5>'+_0xd24941(0x257)+_0xd24941(0x17f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0xd24941(0x201)+_0xd24941(0x1f1)+'</thead>'+_0xd24941(0x1c2)+'\x20'+_0x5c411d+'\x20'+_0xd24941(0x20f)+_0xd24941(0x203)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x55b430[0x0][_0xd24941(0x1f6)]+'</h5>'+_0xd24941(0x257)+_0xd24941(0x257)+_0xd24941(0x286)};_0x4e4b88[_0xd24941(0x218)](_0x2354fc,function(_0x210877,_0x3e057f){var _0xaedfe7=_0xd24941;_0x210877?(console[_0xaedfe7(0x198)](_0x210877),console['log'](_0xaedfe7(0x1a5))):console['log'](_0xaedfe7(0x1b9));}),_0x537358[_0xd24941(0x197)](_0xd24941(0x1fe),'purchases\x20item\x20return\x20successfull'),_0x49f098[_0xd24941(0x206)]('/all_purchases/view');}catch(_0x1c1a03){console[_0xd24941(0x198)](_0x1c1a03),_0x49f098[_0xd24941(0x259)](0xc8)[_0xd24941(0x25b)]({'message':_0x1c1a03['message']});}}),router[a0_0xc1da41(0x1b1)](a0_0xc1da41(0x189),auth,async(_0x112ba1,_0x30b664)=>{var _0x5cd9aa=a0_0xc1da41;try{const {username:_0x578376,email:_0x17f428,role:_0xb9a418}=_0x112ba1[_0x5cd9aa(0x196)],_0x38dcfc=_0x112ba1['user'],_0x60f20f=await profile['findOne']({'email':_0x38dcfc[_0x5cd9aa(0x1b0)]}),_0x4a30a=await master_shop['find'](),_0x27de33=_0x112ba1[_0x5cd9aa(0x26d)]['id'],_0x355c1b=await purchases[_0x5cd9aa(0x213)](_0x27de33);if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x1a0))var _0x414e11=users[_0x5cd9aa(0x26f)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x238))var _0x414e11=users[_0x5cd9aa(0x238)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x253))var _0x414e11=users[_0x5cd9aa(0x253)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x1f7))var _0x414e11=users[_0x5cd9aa(0x1f7)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x16a))var _0x414e11=users[_0x5cd9aa(0x16a)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x17a))var _0x414e11=users[_0x5cd9aa(0x22b)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x250))var _0x414e11=users[_0x5cd9aa(0x250)];else{if(_0x4a30a[0x0][_0x5cd9aa(0x1e7)]==_0x5cd9aa(0x284))var _0x414e11=users[_0x5cd9aa(0x283)];}}}}}}}_0x30b664[_0x5cd9aa(0x1a6)](_0x5cd9aa(0x1f3),{'success':_0x112ba1[_0x5cd9aa(0x197)](_0x5cd9aa(0x1fe)),'errors':_0x112ba1[_0x5cd9aa(0x197)](_0x5cd9aa(0x274)),'role':_0x38dcfc,'profile':_0x60f20f,'alldata':_0x355c1b,'master_shop':_0x4a30a,'language':_0x414e11}),console[_0x5cd9aa(0x198)](alldata);}catch(_0x37852d){console['log'](_0x37852d);}}),router['post'](a0_0xc1da41(0x24b),async(_0x638dde,_0x54ef77)=>{var _0x46a2e8=a0_0xc1da41;const {product_code:_0x554cb4}=_0x638dde['body'];var _0x3934c7;const _0x56317d=await product[_0x46a2e8(0x19b)]([{'$match':{'primary_code':_0x554cb4,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':_0x46a2e8(0x179)},'category':{'$first':_0x46a2e8(0x1ba)},'brand':{'$first':_0x46a2e8(0x1eb)},'unit':{'$first':_0x46a2e8(0x20a)},'alertquantity':{'$first':_0x46a2e8(0x23f)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x46a2e8(0x1ac)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x46a2e8(0x18a)},'maxProdPerUnit':{'$first':_0x46a2e8(0x171)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x46a2e8(0x16f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x3f5f6f=await product[_0x46a2e8(0x19b)]([{'$match':{'secondary_code':_0x554cb4,'product_category':_0x46a2e8(0x1cd)}},{'$group':{'_id':_0x46a2e8(0x1b6),'name':{'$first':_0x46a2e8(0x179)},'category':{'$first':_0x46a2e8(0x1ba)},'brand':{'$first':_0x46a2e8(0x1eb)},'unit':{'$first':_0x46a2e8(0x20a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x46a2e8(0x1ac)},'secondary_code':{'$first':_0x46a2e8(0x1d9)},'maxStocks':{'$first':_0x46a2e8(0x18a)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x46a2e8(0x16f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x56317d[_0x46a2e8(0x229)]>0x0)_0x3934c7=_0x56317d;else _0x3f5f6f['length']>0x0&&(_0x3934c7=_0x3f5f6f);_0x54ef77['json'](_0x3934c7);}),router['post'](a0_0xc1da41(0x18f),async(_0x52c3f3,_0x4b1284)=>{var _0x3b3fef=a0_0xc1da41;const {primaryCode:_0x38fa10,secondaryCode:_0x10acb8,productCode:_0x40ce52,bay:_0x10f065,bin:_0x3f38c3,types:_0xea45b6,pallet:_0x16b05c,warehouses:_0x2c2fb7,room:_0x1decc3}=_0x52c3f3[_0x3b3fef(0x1c9)];console['log'](_0x52c3f3[_0x3b3fef(0x1c9)]);try{const _0x4f86ce=await warehouse[_0x3b3fef(0x19b)]([{'$match':{'name':_0x2c2fb7,'room':_0x1decc3}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x10f065,'product_details.bin':_0x3f38c3,'product_details.type':_0xea45b6}},{'$group':{'_id':_0x3b3fef(0x1fa),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b3fef(0x260)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x3b3fef(0x1d0)},'pallet':{'$first':_0x3b3fef(0x1c0)},'maxProducts':{'$first':_0x3b3fef(0x22c)}}}]);_0x4b1284[_0x3b3fef(0x259)](0xc8)['json'](_0x4f86ce);}catch(_0x3b3f91){_0x4b1284[_0x3b3fef(0x259)](0x194)[_0x3b3fef(0x25b)]({'message':_0x3b3f91['message']});}}),module[a0_0xc1da41(0x24f)]=router;