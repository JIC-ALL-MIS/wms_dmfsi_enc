var a0_0x376f6a=a0_0x6a26;(function(_0x2cbb78,_0x40586b){var _0x26acc9=a0_0x6a26,_0x6041be=_0x2cbb78();while(!![]){try{var _0x58f97d=parseInt(_0x26acc9(0x2da))/0x1*(parseInt(_0x26acc9(0x28e))/0x2)+-parseInt(_0x26acc9(0x284))/0x3+-parseInt(_0x26acc9(0x1be))/0x4*(parseInt(_0x26acc9(0x22a))/0x5)+parseInt(_0x26acc9(0x2c3))/0x6*(-parseInt(_0x26acc9(0x28d))/0x7)+parseInt(_0x26acc9(0x22b))/0x8*(-parseInt(_0x26acc9(0x1c8))/0x9)+parseInt(_0x26acc9(0x2ca))/0xa+parseInt(_0x26acc9(0x1e2))/0xb;if(_0x58f97d===_0x40586b)break;else _0x6041be['push'](_0x6041be['shift']());}catch(_0x97c88a){_0x6041be['push'](_0x6041be['shift']());}}}(a0_0xb5a0,0x41915));const express=require('express'),app=express(),router=express[a0_0x376f6a(0x23c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x376f6a(0x20b)),nodemailer=require(a0_0x376f6a(0x23e));var ejs=require('ejs');function a0_0x6a26(_0x393928,_0x4f13f9){var _0xb5a066=a0_0xb5a0();return a0_0x6a26=function(_0x6a269a,_0x9c068a){_0x6a269a=_0x6a269a-0x1bd;var _0x565bc2=_0xb5a066[_0x6a269a];return _0x565bc2;},a0_0x6a26(_0x393928,_0x4f13f9);}const path=require(a0_0x376f6a(0x1e1)),users=require('../public/language/languages.json');router['get']('/view',auth,async(_0x496051,_0x26107e)=>{var _0x4753f9=a0_0x376f6a;try{const {username:_0x49db8a,email:_0x350894,role:_0x386826}=_0x496051[_0x4753f9(0x1bd)],_0x891b98=_0x496051[_0x4753f9(0x1bd)],_0x53f23f=await profile['findOne']({'email':_0x891b98[_0x4753f9(0x1f5)]}),_0x32dfe1=await staff['findOne']({'email':_0x891b98[_0x4753f9(0x1f5)]});if(_0x891b98[_0x4753f9(0x2c4)]=='staff'){const _0x8e8cde=await staff[_0x4753f9(0x1d1)]({'email':_0x891b98[_0x4753f9(0x1f5)]});}const _0x5e9996=await master_shop['find']();let _0x204233;if(_0x891b98[_0x4753f9(0x2c4)]==_0x4753f9(0x1da)){const _0x7ae0c3=await staff[_0x4753f9(0x1d1)]({'email':_0x891b98[_0x4753f9(0x1f5)]});_0x204233=await purchases[_0x4753f9(0x21f)]([{'$match':{'warehouse_name':_0x7ae0c3[_0x4753f9(0x299)]}},{'$lookup':{'from':'suppliers','localField':_0x4753f9(0x2ba),'foreignField':_0x4753f9(0x1c5),'as':_0x4753f9(0x1ee)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x4753f9(0x2ac)},{'$group':{'_id':_0x4753f9(0x2a1),'invoice':{'$first':_0x4753f9(0x2a9)},'suppliers':{'$first':_0x4753f9(0x206)},'date':{'$first':_0x4753f9(0x2d7)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x4753f9(0x2ac)},'note':{'$first':_0x4753f9(0x1d5)},'paid_amount':{'$first':_0x4753f9(0x211)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x4753f9(0x222)},'batch_code':{'$first':_0x4753f9(0x2a0)},'expiry_date':{'$first':_0x4753f9(0x2d9)},'suppliers_docs':{'$first':_0x4753f9(0x2d0)},'total_product_quantity':{'$sum':_0x4753f9(0x25f)},'level':{'$addToSet':_0x4753f9(0x23d)},'isle':{'$addToSet':_0x4753f9(0x29f)},'type':{'$addToSet':_0x4753f9(0x25a)},'floorlevel':{'$addToSet':_0x4753f9(0x213)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x204233=await purchases['aggregate']([{'$lookup':{'from':_0x4753f9(0x2ba),'localField':_0x4753f9(0x2ba),'foreignField':_0x4753f9(0x1c5),'as':_0x4753f9(0x1ee)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x4753f9(0x2ac)},{'$group':{'_id':_0x4753f9(0x2a1),'invoice':{'$first':_0x4753f9(0x2a9)},'suppliers':{'$first':_0x4753f9(0x206)},'date':{'$first':_0x4753f9(0x2d7)},'warehouse_name':{'$first':_0x4753f9(0x24f)},'room':{'$addToSet':_0x4753f9(0x279)},'product':{'$push':'$product'},'note':{'$first':_0x4753f9(0x1d5)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4753f9(0x2a0)},'expiry_date':{'$first':_0x4753f9(0x2d9)},'suppliers_docs':{'$first':_0x4753f9(0x2d0)},'total_product_quantity':{'$sum':_0x4753f9(0x25f)},'level':{'$addToSet':_0x4753f9(0x23d)},'isle':{'$addToSet':_0x4753f9(0x29f)},'type':{'$addToSet':_0x4753f9(0x25a)},'floorlevel':{'$addToSet':_0x4753f9(0x213)},'finalize':{'$first':_0x4753f9(0x29e)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5e9996[0x0][_0x4753f9(0x245)]==_0x4753f9(0x253)){var _0x33526b=users[_0x4753f9(0x21d)];console['log'](_0x33526b);}else{if(_0x5e9996[0x0]['language']=='Hindi')var _0x33526b=users[_0x4753f9(0x289)];else{if(_0x5e9996[0x0]['language']==_0x4753f9(0x291))var _0x33526b=users[_0x4753f9(0x291)];else{if(_0x5e9996[0x0]['language']==_0x4753f9(0x275))var _0x33526b=users[_0x4753f9(0x275)];else{if(_0x5e9996[0x0][_0x4753f9(0x245)]=='French')var _0x33526b=users[_0x4753f9(0x1ef)];else{if(_0x5e9996[0x0][_0x4753f9(0x245)]=='Portuguese\x20(BR)')var _0x33526b=users[_0x4753f9(0x27c)];else{if(_0x5e9996[0x0][_0x4753f9(0x245)]==_0x4753f9(0x26c))var _0x33526b=users[_0x4753f9(0x26c)];else{if(_0x5e9996[0x0][_0x4753f9(0x245)]==_0x4753f9(0x22d))var _0x33526b=users['Arabic'];}}}}}}}_0x26107e['render'](_0x4753f9(0x233),{'success':_0x496051[_0x4753f9(0x1db)]('success'),'errors':_0x496051[_0x4753f9(0x1db)]('errors'),'purchases':_0x204233,'role':_0x891b98,'profile':_0x53f23f,'master_shop':_0x5e9996,'language':_0x33526b});}catch(_0x639265){console['log'](_0x4753f9(0x1de),_0x639265),_0x26107e[_0x4753f9(0x295)](0xc8)[_0x4753f9(0x1cb)]({'message':_0x639265['message']});}});function BayBinSelected(_0x3d372d,_0x5ae7b9){var _0x59bd89=a0_0x376f6a,_0x3621f5=[],_0x5617ec=[],_0x3aa0c7=[],_0x3798b4=[],_0x52a94f=[],_0x4dc2fb=[];let _0x4dab40=[];if(_0x3d372d=='DRY\x20STORAGE')switch(_0x5ae7b9){case _0x59bd89(0x238):_0x3621f5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5617ec=[0x1,0x2],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1ea),'Floor'],_0x52a94f=['D'],_0x4dc2fb=['A'];break;case _0x59bd89(0x20d):_0x3621f5=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5617ec=[0x1,0x2],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1ea),_0x59bd89(0x1c9)],_0x52a94f=['D'],_0x4dc2fb=['B'];break;case _0x59bd89(0x1ce):_0x3621f5=[0x0],_0x5617ec=[0x0],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1c9)],_0x52a94f=['D'],_0x4dc2fb=['S'];break;case'Receiving\x20Area':_0x3621f5=[0x0],_0x5617ec=[0x0],_0x3798b4=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3aa0c7=['Floor'],_0x52a94f=['D'],_0x4dc2fb=['R'];break;}else{if(_0x3d372d==_0x59bd89(0x267))switch(_0x5ae7b9){case'Rack\x20A':_0x3621f5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5617ec=['B','F'],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=['Level',_0x59bd89(0x1c9)],_0x52a94f=['C'],_0x4dc2fb=['A'];break;case _0x59bd89(0x20d):_0x3621f5=[0x5,0x4,0x3,0x2,0x1],_0x5617ec=['F','B','S'],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1ea),_0x59bd89(0x1c9)],_0x52a94f=['C'],_0x4dc2fb=['B'];break;case _0x59bd89(0x220):_0x3621f5=[0x1,0x2,0x3,0x4,0x5],_0x5617ec=['B','F','S'],_0x3798b4=[0x5,0x4,0x3,0x2,0x1],_0x3aa0c7=[_0x59bd89(0x1ea),_0x59bd89(0x1c9)],_0x52a94f=['C'],_0x4dc2fb=['C'];break;case _0x59bd89(0x250):_0x3621f5=[0x5,0x4,0x3,0x2,0x1],_0x5617ec=['F','B','S'],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1ea),_0x59bd89(0x1c9)],_0x52a94f=['C'],_0x4dc2fb=['D'];break;case _0x59bd89(0x28c):_0x3621f5=[0x4,0x3,0x2,0x1],_0x5617ec=[0x1,0x2],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1ea),_0x59bd89(0x1c9)],_0x52a94f=['C'],_0x4dc2fb=['E'];break;case _0x59bd89(0x244):_0x3621f5=[0x1,0x2,0x3],_0x5617ec=[0x1,0x2],_0x3798b4=[0x1,0x2,0x3,0x4,0x5],_0x3aa0c7=[_0x59bd89(0x1ea)],_0x52a94f=['C'],_0x4dc2fb=['F'];break;}}return{'levels':_0x3621f5,'Isle':_0x5617ec,'rack':_0x3798b4,'type':_0x3aa0c7,'storage':_0x52a94f,'rak':_0x4dc2fb};}async function getRandom8DigitNumber(){var _0x55fcf1=a0_0x376f6a;const _0x3f3460=0x989680,_0x2e5ad2=0x5f5e0ff,_0x1eaabb=Math[_0x55fcf1(0x280)](Math[_0x55fcf1(0x2b7)]()*(_0x2e5ad2-_0x3f3460+0x1))+_0x3f3460;var _0x402c5f;const _0x49ed20=await purchases[_0x55fcf1(0x1d1)]({'invoice':_0x55fcf1(0x2cb)+_0x1eaabb});return _0x49ed20&&_0x49ed20[_0x55fcf1(0x2d3)]>0x0?_0x402c5f=_0x55fcf1(0x2cb)+_0x1eaabb:_0x402c5f=_0x55fcf1(0x2cb)+_0x1eaabb,_0x402c5f;}function a0_0xb5a0(){var _0x5b7ec7=['product_name','get','$invoice','$product_details','Ambient','$product','$product_details.product_code','/barcode_scanner','then','purchases\x20item\x20return\x20successfull','note','save','body','product','product_code_hide','map','random','</thead>','</body></html>','suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','stock_data','add_purchases\x20error','$secondary_unit','types','forEach','batch_code','$product_details.bin','18LoRxZz','role','return_data','concat','primary_code_hide','stocks','Arabic','968330abCMWV','INC-','secondary_unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','foreach\x20newproduct','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$suppliers_docs','purchase_quantity','room','length','prod_isle','isle','Purchase\x20data\x20added\x20successfully','$date','logo','$expiry_date','1VcwSUO','</td>','add\x20post','createTransport','user','76192aozlsC','product_details','toString','catch','\x20<>\x20','$product_details._id','all_purchases_barcode','name','<html><head><title></title>','$product_details.rack','81ZwQaCo','Floor','primary_code','json','\x20Order\x20Date\x20:\x20','$product_details.pallet','Shelves','RMSEmail','$product_details.type','findOne','/all_purchases/view','</h5>','master','$note','abs','<span\x20style=\x22float:\x20right;\x22>','push','Return\x20Goods','staff','flash','Error\x20Occurs','$category','table\x20page','message','prod_unit','path','8437979DUmabh','delivery_date','slice','all','maxStocks','post','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_qty','Level','$name','prod_pallet','$product_details.product_name','suppliers_docs','French','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','deliverycode','/all_purchases/view/','$product_details.maxProducts','Purchase\x20Return\x20Mail','email','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','bin','</head><body>','redirect','$maxStocks','storage','user_id','room_name','getMonth','product_stock','</table>','success','<strong>\x20Regards\x20</strong>','date','$suppliers','string','POnumber','/view/add_purchases/:id','payment\x20successfull','../middleware/auth','floorlevel','Rack\x20B','purchase\x20data\x20update\x20successfully','quantity','here','$paid_amount','prod_cat','$product.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','params','production_date','error','<hr\x20class=\x22my-3\x22>','Receiving\x20Area','rack','maxperunit','</div>','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','aggregate','Rack\x20C','/preview/:id','$return_data','log','$product_details.bay','\x20<\x20wew\x20>\x20','due_amount','padStart','alertQTY','delivery_code','60oBHbCE','227464GOjGvL','bay','Arabic\x20(ae)','<h5>','prod_Qty','secondary_code_hide','\x20</h2>','$product_details.product_stock','all_purchases','purchase_invoice','<div>','render','$maxProdPerUnit','Rack\x20A','Logo.png','<h2>\x20','exports','Router','$product.bay','nodemailer','$alertquantity','Enclosed','Raw\x20Materials','filter','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Rack\x20F','language','getFullYear','edit_purchases_view','password','$product_details.storage','Sales\x20Update\x20successfully','<tbody\x20style=\x22text-align:\x20center;\x22>','<tr>','suppliers_data','/upload/','$warehouse_name','Rack\x20D','True','standard_unit','English\x20(US)','actual_uom','image','/view/add_purchases','$product_details.expiry_date','site_title','prod_code','$product.type','gmail','Room_name','Paid\x20For\x20Purchase','findById','$product.quantity','product_list','$primary_code','/view/return_purchase/:id','expiry_date','invoice','</span>','$product_details.floorlevel','COLD\x20STORAGE','host','$secondary_code','product_code','<!DOCTYPE\x20html>','Chinese','\x20Order\x20Number\x20:\x20','add_purchases','<h5\x20style=\x22text-align:\x20left;\x22>','amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','secondary_code','product_cat','Purchase\x20Return','Spanish','/../public','warehouse_name','find','$product.room_name','$product_code','sendMail','Portuguese','<table\x20style=\x22width:\x20100%\x20!important;\x22>','prod_secondunit','prod_name','floor','prod_primunit','errors','RoomAssign','1150452SQjHqP','level','prod_invoice','/CheckingWarehouse','$product_details.primary_code','Hindi','getDate','paid_amount','Rack\x20E','525931kUqpzS','995998MsgQaa','Email\x20sent\x20successfully','type','German','MaxStocks_data','/view/:id','prod_level','status','currency','stock_quantity','return_qty','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','max_product_unit','Portuguese\x20(BR)','$finalize','$product.bin','$batch_code','$_id','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','rak','$brand','Enabled'];a0_0xb5a0=function(){return _0x5b7ec7;};return a0_0xb5a0();}router[a0_0x376f6a(0x2a8)](a0_0x376f6a(0x256),auth,async(_0xa90d5b,_0x671f1a)=>{var _0x57c243=a0_0x376f6a;try{const {username:_0x234f45,email:_0x34d54d,role:_0x4707ab}=_0xa90d5b[_0x57c243(0x1bd)],_0x5b7508=_0xa90d5b[_0x57c243(0x1bd)],_0x3c465c=await profile[_0x57c243(0x1d1)]({'email':_0x5b7508[_0x57c243(0x1f5)]}),_0x50d186=await master_shop[_0x57c243(0x278)](),_0x1c9a47=await staff['findOne']({'email':_0x5b7508[_0x57c243(0x1f5)]}),_0x19439c=await suppliers[_0x57c243(0x278)]({});let _0x30b7cd;if(_0x5b7508[_0x57c243(0x2c4)]==_0x57c243(0x1da)){const _0xb218ea=await staff[_0x57c243(0x1d1)]({'email':_0x5b7508[_0x57c243(0x1f5)]});_0x30b7cd=await warehouse['aggregate']([{'$match':{'status':_0x57c243(0x2a6),'name':_0xb218ea[_0x57c243(0x299)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x57c243(0x1d9)}}},{'$group':{'_id':_0x57c243(0x1eb),'name':{'$first':_0x57c243(0x1eb)}}}]);}else _0x30b7cd=await warehouse[_0x57c243(0x21f)]([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x57c243(0x1d9)}}},{'$group':{'_id':'$name','name':{'$first':_0x57c243(0x1eb)}}}]);const _0x4804da=await product['find']({}),_0x25209d=await warehouse[_0x57c243(0x278)]({'status':'Enabled'}),_0x4e63d9=await purchases[_0x57c243(0x278)]({}),_0x4e7e1e=_0x4e63d9[_0x57c243(0x2d3)]+0x1,_0x49454d=_0x57c243(0x2cb)+_0x4e7e1e[_0x57c243(0x1c0)]()[_0x57c243(0x227)](0x5,'0');var _0x2a997e=[_0x57c243(0x2ab),_0x57c243(0x240)];if(_0x50d186[0x0]['language']==_0x57c243(0x253))var _0x156fc3=users[_0x57c243(0x21d)];else{if(_0x50d186[0x0][_0x57c243(0x245)]=='Hindi')var _0x156fc3=users['Hindi'];else{if(_0x50d186[0x0]['language']==_0x57c243(0x291))var _0x156fc3=users[_0x57c243(0x291)];else{if(_0x50d186[0x0][_0x57c243(0x245)]=='Spanish')var _0x156fc3=users[_0x57c243(0x275)];else{if(_0x50d186[0x0][_0x57c243(0x245)]=='French')var _0x156fc3=users['French'];else{if(_0x50d186[0x0]['language']==_0x57c243(0x29d))var _0x156fc3=users['Portuguese'];else{if(_0x50d186[0x0][_0x57c243(0x245)]==_0x57c243(0x26c))var _0x156fc3=users[_0x57c243(0x26c)];else{if(_0x50d186[0x0][_0x57c243(0x245)]==_0x57c243(0x22d))var _0x156fc3=users['Arabic'];}}}}}}}const _0x2a7a5b=getRandom8DigitNumber();_0x2a7a5b[_0x57c243(0x2af)](_0xf6051d=>{var _0x2292e7=_0x57c243;_0x671f1a[_0x2292e7(0x236)](_0x2292e7(0x26e),{'success':_0xa90d5b[_0x2292e7(0x1db)](_0x2292e7(0x203)),'errors':_0xa90d5b[_0x2292e7(0x1db)](_0x2292e7(0x282)),'role':_0x5b7508,'profile':_0x3c465c,'suppliers':_0x19439c,'warehouse':_0x30b7cd,'product':_0x4804da,'invoice':_0xf6051d,'master_shop':_0x50d186,'language':_0x156fc3,'find_data':_0x25209d,'rooms_data':_0x2a997e});})[_0x57c243(0x1c1)](_0x343f5f=>{var _0x25cde7=_0x57c243;_0xa90d5b[_0x25cde7(0x1db)](_0x25cde7(0x282),_0x25cde7(0x243)),_0x671f1a[_0x25cde7(0x1fb)](_0x25cde7(0x1d2));});}catch(_0x14a547){console[_0x57c243(0x223)](_0x14a547);}}),router[a0_0x376f6a(0x2a8)](a0_0x376f6a(0x209),auth,async(_0x26ec7a,_0x319923)=>{var _0x2fad6b=a0_0x376f6a;try{const _0x280bd3=_0x26ec7a[_0x2fad6b(0x215)]['id'];console[_0x2fad6b(0x223)](_0x280bd3);const _0x4ad6ee=await master_shop[_0x2fad6b(0x278)]();console[_0x2fad6b(0x223)]('master',_0x4ad6ee);const _0x35ce08=await product[_0x2fad6b(0x1d1)]({'name':_0x280bd3});console[_0x2fad6b(0x223)](_0x2fad6b(0x2b4),_0x35ce08),_0x319923[_0x2fad6b(0x295)](0xc8)[_0x2fad6b(0x1cb)]({'product_data':_0x35ce08,'master':_0x4ad6ee});}catch(_0x4994a8){console['log'](_0x2fad6b(0x2bd),_0x4994a8);}}),router[a0_0x376f6a(0x1e7)](a0_0x376f6a(0x256),auth,async(_0x8c586,_0x1a756c)=>{var _0x1d4515=a0_0x376f6a;try{const {invoice:_0x1b07c4,date:_0x5edf1a,warehouse_name:_0x412c2c,prod_name:_0x265853,prod_code:_0x1e6e06,prod_qty:_0x41d412,prod_unit:_0x24271e,prod_secondunit:_0x30e210,prod_level:_0x536818,prod_isle:_0x279778,prod_pallet:_0x5bc75b,note:_0x4bc54a,expiry_date:_0x1eaf0a,batch_code:_0x590849,payable:_0x3604b5,due_amount:_0x1c5914,Room_name:_0x3c1cd6,primary_code:_0x5cec58,secondary_code:_0x248f11,MaxStocks_data:_0x439b45,PO_number:_0x49ddbd,SCRN:_0x40f5cd,JO_number:_0x55cf9f}=_0x8c586[_0x1d4515(0x2b3)];if(typeof _0x265853=='string')var _0x3a71cd=[_0x8c586['body'][_0x1d4515(0x27f)]],_0x19d118=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x259)]],_0x202ab3=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x22f)]],_0x20581c=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x281)]],_0x223440=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x27e)]],_0x400720=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x294)]],_0xc2317a=[_0x8c586[_0x1d4515(0x2b3)]['primary_code']],_0xb1e03c=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x272)]],_0x56bcd0=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x292)]],_0x5f56c5=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x2c1)]],_0x5ce189=[_0x8c586['body'][_0x1d4515(0x263)]],_0x3dd061=[_0x8c586['body'][_0x1d4515(0x29c)]],_0x533b7e=[_0x8c586['body'][_0x1d4515(0x228)]],_0x2f15ce=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x216)]],_0x1b748e=[_0x8c586[_0x1d4515(0x2b3)]['prod_cat']],_0x4ec240=[_0x8c586[_0x1d4515(0x2b3)]['RoomAssign']],_0x32c0eb=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x1f1)]],_0x420ce6=[_0x8c586[_0x1d4515(0x2b3)]['prod_invoice']],_0x14c37f=[_0x8c586[_0x1d4515(0x2b3)]['actual_qty']],_0x4df13f=[_0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x254)]];else var _0x3a71cd=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x27f)]],_0x19d118=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x259)]],_0x202ab3=[..._0x8c586['body'][_0x1d4515(0x22f)]],_0x20581c=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x281)]],_0x223440=[..._0x8c586['body']['prod_secondunit']],_0x400720=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x294)]],_0xc2317a=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x1ca)]],_0xb1e03c=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x272)]],_0x56bcd0=[..._0x8c586['body'][_0x1d4515(0x292)]],_0x5f56c5=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x2c1)]],_0x5ce189=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x263)]],_0x3dd061=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x29c)]],_0x533b7e=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x228)]],_0x2f15ce=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x216)]],_0x1b748e=[..._0x8c586['body'][_0x1d4515(0x212)]],_0x4ec240=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x283)]],_0x32c0eb=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x1f1)]],_0x420ce6=[..._0x8c586[_0x1d4515(0x2b3)][_0x1d4515(0x286)]],_0x14c37f=[..._0x8c586['body']['actual_qty']],_0x4df13f=[..._0x8c586['body'][_0x1d4515(0x254)]];const _0x5cf1d5=_0x3a71cd[_0x1d4515(0x2b6)](_0x5326ce=>{return _0x5326ce={'product_name':_0x5326ce};});_0x14c37f[_0x1d4515(0x2c0)]((_0x49b670,_0x184a5c)=>{_0x5cf1d5[_0x184a5c]['actual_qty']=Math['abs'](_0x49b670);}),_0x4df13f[_0x1d4515(0x2c0)]((_0x2519ca,_0x580064)=>{var _0x53ef5e=_0x1d4515;_0x5cf1d5[_0x580064][_0x53ef5e(0x254)]=_0x2519ca;}),_0x19d118[_0x1d4515(0x2c0)]((_0x4bead3,_0x3e4c0e)=>{var _0x266483=_0x1d4515;_0x5cf1d5[_0x3e4c0e][_0x266483(0x26a)]=_0x4bead3;}),_0x202ab3[_0x1d4515(0x2c0)]((_0x2699b3,_0x5e077c)=>{var _0x99f787=_0x1d4515;_0x5cf1d5[_0x5e077c][_0x99f787(0x20f)]=Math[_0x99f787(0x1d6)](_0x2699b3);}),_0x20581c['forEach']((_0xa31d84,_0x5b9e5f)=>{var _0x38a44a=_0x1d4515;_0x5cf1d5[_0x5b9e5f][_0x38a44a(0x252)]=_0xa31d84;}),_0x223440[_0x1d4515(0x2c0)]((_0x88df4b,_0x3e8021)=>{var _0x138198=_0x1d4515;_0x5cf1d5[_0x3e8021][_0x138198(0x2cc)]=_0x88df4b;}),_0x400720['forEach']((_0x17b4cd,_0x4d715e)=>{var _0x3c94ee=_0x1d4515;_0x4ec240[_0x3c94ee(0x2c0)]((_0x5b3ee6,_0x591c1d)=>{var _0x5b6ea6=_0x3c94ee;if(_0x5b3ee6==_0x5b6ea6(0x219)&&_0x4d715e==_0x591c1d){console[_0x5b6ea6(0x223)](_0x5b3ee6+_0x5b6ea6(0x225)+_0x4d715e+_0x5b6ea6(0x1c2)+_0x591c1d+_0x5b6ea6(0x1c2)+_0x17b4cd);var _0x2313c5=_0x17b4cd[_0x5b6ea6(0x1e4)](0x3);_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x1fd)]=_0x17b4cd[0x0],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x21a)]=_0x17b4cd[0x1],_0x5cf1d5[_0x4d715e]['bay']=0x0,_0x5cf1d5[_0x4d715e]['bin']=0x0,_0x5cf1d5[_0x4d715e]['type']=_0x5b6ea6(0x1c9),_0x5cf1d5[_0x4d715e]['floorlevel']=_0x2313c5;}else{if(_0x5b3ee6=='Shelves'&&_0x4d715e==_0x591c1d){var _0x2313c5=_0x17b4cd[_0x5b6ea6(0x1e4)](0x3);_0x5cf1d5[_0x4d715e]['storage']=_0x17b4cd[0x0],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x21a)]=_0x17b4cd[0x1],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x22c)]=0x0,_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x1f9)]=0x0,_0x5cf1d5[_0x4d715e]['type']=_0x5b6ea6(0x1c9),_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x20c)]=_0x17b4cd[0x5];}else{if(_0x4d715e==_0x591c1d){if(_0x17b4cd[0x0]=='A'&&_0x17b4cd[0x1]=='L'&&_0x17b4cd[0x2]=='L')console['log'](_0x5b3ee6+_0x5b6ea6(0x1c2)+_0x4d715e+_0x5b6ea6(0x1c2)+_0x591c1d+_0x5b6ea6(0x1c2)+_0x17b4cd+_0x5b6ea6(0x210)),_0x5cf1d5[_0x4d715e]['storage']=_0x17b4cd[0x0],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x21a)]=_0x17b4cd[0x1],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x22c)]=0x0,_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x1f9)]=0x0,_0x5cf1d5[_0x4d715e]['type']=_0x5b6ea6(0x1c9),_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x20c)]=_0x17b4cd[0x3];else{var _0x49ee92;if(_0x17b4cd[0x4]=='L')_0x49ee92='Level';else _0x17b4cd[0x4]=='F'&&(_0x49ee92=_0x5b6ea6(0x1c9));_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x1fd)]=_0x17b4cd[0x0],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x21a)]=_0x17b4cd[0x1],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x22c)]=_0x17b4cd[0x2],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x1f9)]=_0x17b4cd[0x3],_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x290)]=_0x49ee92,_0x5cf1d5[_0x4d715e][_0x5b6ea6(0x20c)]=_0x17b4cd[0x5];}}}}});}),_0xc2317a[_0x1d4515(0x2c0)]((_0x553912,_0x11f75c)=>{_0x5cf1d5[_0x11f75c]['primary_code']=_0x553912;}),_0xb1e03c[_0x1d4515(0x2c0)]((_0x10cfc2,_0x41d239)=>{_0x5cf1d5[_0x41d239]['secondary_code']=_0x10cfc2;}),_0x56bcd0['forEach']((_0x4c1077,_0x397408)=>{var _0x2467b8=_0x1d4515;_0x5cf1d5[_0x397408][_0x2467b8(0x1e6)]=_0x4c1077;}),_0x5f56c5[_0x1d4515(0x2c0)]((_0x1edca5,_0x59dc10)=>{var _0x1181ed=_0x1d4515;_0x5cf1d5[_0x59dc10][_0x1181ed(0x2c1)]=_0x1edca5;}),_0x5ce189[_0x1d4515(0x2c0)]((_0xbcd9ba,_0x38aa18)=>{var _0x569f5b=_0x1d4515;_0x5cf1d5[_0x38aa18][_0x569f5b(0x263)]=_0xbcd9ba;}),_0x3dd061[_0x1d4515(0x2c0)]((_0x23d474,_0xe24ddc)=>{_0x5cf1d5[_0xe24ddc]['maxperunit']=_0x23d474;}),_0x533b7e[_0x1d4515(0x2c0)]((_0x5acc43,_0x299855)=>{var _0x9f5687=_0x1d4515;_0x5cf1d5[_0x299855][_0x9f5687(0x228)]=_0x5acc43;}),_0x2f15ce[_0x1d4515(0x2c0)]((_0x5ee97b,_0x3b8921)=>{var _0x9d37fa=_0x1d4515;_0x5cf1d5[_0x3b8921][_0x9d37fa(0x216)]=_0x5ee97b;}),_0x1b748e[_0x1d4515(0x2c0)]((_0x24a82a,_0x4ff7f4)=>{var _0x52aa7a=_0x1d4515;_0x5cf1d5[_0x4ff7f4][_0x52aa7a(0x273)]=_0x24a82a;}),_0x4ec240[_0x1d4515(0x2c0)]((_0x50ea3e,_0x5854c0)=>{var _0x10c28f=_0x1d4515;_0x5cf1d5[_0x5854c0][_0x10c28f(0x1ff)]=_0x50ea3e;}),_0x32c0eb[_0x1d4515(0x2c0)]((_0x1d784b,_0x36345c)=>{var _0x433c4a=_0x1d4515;_0x5cf1d5[_0x36345c][_0x433c4a(0x229)]=_0x1d784b;}),_0x420ce6[_0x1d4515(0x2c0)]((_0x331169,_0x31d1f7)=>{var _0x52a212=_0x1d4515;_0x5cf1d5[_0x31d1f7][_0x52a212(0x264)]=_0x331169;});const _0x123ab3=_0x4ec240[_0x1d4515(0x2b6)](_0x5e3e43=>{return _0x5e3e43={'room_name':_0x5e3e43};}),_0x511dfe=_0x5cf1d5[_0x1d4515(0x242)](_0x46e3ec=>_0x46e3ec[_0x1d4515(0x20f)]!=='0'&&_0x46e3ec[_0x1d4515(0x20f)]!==''),_0x1bc2e4=new purchases({'invoice':_0x1b07c4,'suppliers':_0x8c586[_0x1d4515(0x2b3)]['suppliers'],'date':_0x5edf1a,'warehouse_name':_0x412c2c,'product':_0x511dfe,'note':_0x4bc54a,'due_amount':_0x1c5914,'POnumber':_0x49ddbd,'SCRN':_0x40f5cd,'JO_number':_0x55cf9f,'roomList':_0x123ab3}),_0x58e1a4=await _0x1bc2e4['save'](),_0x2f3b0d=await purchases[_0x1d4515(0x1d1)]({'invoice':_0x1b07c4}),_0x162a5e=_0x2f3b0d[_0x1d4515(0x2b4)][_0x1d4515(0x2b6)](async _0x54663c=>{var _0x38515a=_0x1d4515,_0x5c4262=await warehouse[_0x38515a(0x1d1)]({'name':_0x412c2c,'room':_0x54663c[_0x38515a(0x1ff)]}),_0x27c9cc=0x0;return _0x5c4262[_0x38515a(0x1bf)][_0x38515a(0x2c0)](_0x46decb=>{var _0x2891ce=_0x38515a;_0x46decb[_0x2891ce(0x2a7)]==_0x54663c[_0x2891ce(0x2a7)]&&_0x46decb[_0x2891ce(0x20c)]==_0x54663c[_0x2891ce(0x20c)]&&_0x46decb[_0x2891ce(0x290)]==_0x54663c[_0x2891ce(0x290)]&&_0x46decb[_0x2891ce(0x1f9)]==_0x54663c[_0x2891ce(0x1f9)]&&_0x46decb[_0x2891ce(0x22c)]==_0x54663c[_0x2891ce(0x22c)]&&_0x46decb['rack']==_0x54663c[_0x2891ce(0x21a)]&&_0x46decb[_0x2891ce(0x1fd)]==_0x54663c[_0x2891ce(0x1fd)]&&_0x46decb[_0x2891ce(0x263)]==_0x54663c[_0x2891ce(0x263)]&&_0x46decb[_0x2891ce(0x2c1)]==_0x54663c[_0x2891ce(0x2c1)]&&_0x46decb[_0x2891ce(0x216)]==_0x54663c[_0x2891ce(0x216)]&&_0x46decb[_0x2891ce(0x264)]==_0x2f3b0d['invoice']&&(_0x46decb[_0x2891ce(0x201)]+=Math['abs'](_0x54663c[_0x2891ce(0x20f)]),_0x27c9cc++);}),_0x27c9cc===0x0&&_0x5c4262[_0x38515a(0x1bf)][_0x38515a(0x1d8)]({'product_name':_0x54663c['product_name'],'product_stock':Math['abs'](_0x54663c[_0x38515a(0x20f)]),'primary_code':_0x54663c[_0x38515a(0x1ca)],'secondary_code':_0x54663c[_0x38515a(0x272)],'product_code':_0x54663c[_0x38515a(0x26a)],'storage':_0x54663c[_0x38515a(0x1fd)],'rack':_0x54663c['rack'],'bay':_0x54663c['bay'],'bin':_0x54663c['bin'],'type':_0x54663c[_0x38515a(0x290)],'floorlevel':_0x54663c[_0x38515a(0x20c)],'maxProducts':_0x54663c[_0x38515a(0x1e6)],'unit':_0x54663c[_0x38515a(0x252)],'secondary_unit':_0x54663c[_0x38515a(0x2cc)],'expiry_date':_0x54663c[_0x38515a(0x263)],'maxPerUnit':_0x54663c['maxperunit'],'batch_code':_0x54663c[_0x38515a(0x2c1)],'alertQTY':_0x54663c[_0x38515a(0x228)],'production_date':_0x54663c[_0x38515a(0x216)],'product_cat':_0x54663c[_0x38515a(0x273)],'invoice':_0x54663c[_0x38515a(0x264)],'actual_qty':Math[_0x38515a(0x1d6)](_0x54663c['actual_qty']),'actual_uom':_0x54663c[_0x38515a(0x254)]}),_0x5c4262;});Promise[_0x1d4515(0x1e5)](_0x162a5e)[_0x1d4515(0x2af)](async _0x196310=>{var _0x5b3702=_0x1d4515;try{for(const _0x5bf159 of _0x196310){await _0x5bf159[_0x5b3702(0x2b2)]();}const _0x568960=await master_shop[_0x5b3702(0x278)](),_0xaaed47=await email_settings[_0x5b3702(0x1d1)](),_0x51ffa8=await supervisor_settings[_0x5b3702(0x278)]();var _0x5adabd=_0x2f3b0d[_0x5b3702(0x2b4)],_0x1beb11='',_0xd7e792;for(_0xd7e792 in _0x5adabd){_0x1beb11+=_0x5b3702(0x24c)+_0x5b3702(0x1e8)+_0x5adabd[_0xd7e792][_0x5b3702(0x2a7)]+_0x5b3702(0x2db)+_0x5b3702(0x1e8)+_0x5adabd[_0xd7e792][_0x5b3702(0x26a)]+'</td>'+_0x5b3702(0x1e8)+_0x5adabd[_0xd7e792]['quantity']+_0x5b3702(0x2db)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5adabd[_0xd7e792][_0x5b3702(0x252)]+_0x5b3702(0x2db)+_0x5b3702(0x1e8)+_0x5adabd[_0xd7e792][_0x5b3702(0x2cc)]+_0x5b3702(0x2db)+_0x5b3702(0x1e8)+_0x2f3b0d[_0x5b3702(0x277)]+_0x5b3702(0x2db)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5adabd[_0xd7e792]['room_name']+_0x5b3702(0x2db)+_0x5b3702(0x1e8)+_0x5adabd[_0xd7e792][_0x5b3702(0x1fd)]+_0x5adabd[_0xd7e792][_0x5b3702(0x21a)]+_0x5adabd[_0xd7e792]['bay']+_0x5adabd[_0xd7e792][_0x5b3702(0x1f9)]+_0x5adabd[_0xd7e792][_0x5b3702(0x290)][0x0]+_0x5adabd[_0xd7e792][_0x5b3702(0x20c)]+_0x5b3702(0x2db),_0x5b3702(0x2a2);}let _0x325d56=nodemailer[_0x5b3702(0x2dd)]({'host':_0xaaed47[_0x5b3702(0x268)],'port':Number(_0xaaed47['port']),'secure':![],'auth':{'user':_0xaaed47[_0x5b3702(0x1f5)],'pass':_0xaaed47[_0x5b3702(0x248)]}}),_0xfa4b7a={'from':_0xaaed47['email'],'to':_0x51ffa8[0x0][_0x5b3702(0x1cf)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x5b3702(0x239),'path':__dirname+_0x5b3702(0x276)+_0x5b3702(0x24e)+_0x568960[0x0][_0x5b3702(0x255)],'cid':_0x5b3702(0x2d8)}],'html':_0x5b3702(0x26b)+_0x5b3702(0x1c6)+_0x5b3702(0x1fa)+_0x5b3702(0x235)+_0x5b3702(0x1f0)+_0x5b3702(0x235)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5b3702(0x21c)+'<div>'+'<h2>\x20'+_0x568960[0x0][_0x5b3702(0x258)]+_0x5b3702(0x231)+'</div>'+_0x5b3702(0x21c)+_0x5b3702(0x218)+_0x5b3702(0x235)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x2f3b0d[_0x5b3702(0x264)]+'\x20'+_0x5b3702(0x1d7)+'\x20Order\x20Date\x20:\x20'+_0x2f3b0d[_0x5b3702(0x205)]+'\x20'+_0x5b3702(0x265)+'</h5>'+'</div>'+_0x5b3702(0x27d)+_0x5b3702(0x1f8)+'<tr>'+_0x5b3702(0x2bb)+_0x5b3702(0x2a3)+_0x5b3702(0x29a)+_0x5b3702(0x1f7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x5b3702(0x214)+_0x5b3702(0x2a2)+_0x5b3702(0x2b8)+_0x5b3702(0x24b)+'\x20'+_0x1beb11+'\x20'+'</tbody>'+_0x5b3702(0x202)+_0x5b3702(0x235)+_0x5b3702(0x204)+'<h5>'+_0x568960[0x0][_0x5b3702(0x258)]+_0x5b3702(0x1d3)+_0x5b3702(0x21c)+_0x5b3702(0x21c)+_0x5b3702(0x2b9)};_0x325d56[_0x5b3702(0x27b)](_0xfa4b7a,function(_0x428bf3,_0x16dba3){var _0x538ff2=_0x5b3702;_0x428bf3?(console[_0x538ff2(0x223)](_0x428bf3),console[_0x538ff2(0x223)]('Error\x20Occurs')):console[_0x538ff2(0x223)](_0x538ff2(0x28f));}),_0x8c586['flash']('success',_0x5b3702(0x2d6)),_0x1a756c[_0x5b3702(0x1fb)](_0x5b3702(0x1f2));}catch(_0x18ed29){console[_0x5b3702(0x217)](_0x18ed29),_0x1a756c['status'](0x1f4)[_0x5b3702(0x1cb)]({'error':_0x5b3702(0x29b)});}})[_0x1d4515(0x1c1)](_0x2f48fb=>{var _0x34385c=_0x1d4515;console[_0x34385c(0x217)](_0x2f48fb),_0x1a756c[_0x34385c(0x295)](0x1f4)[_0x34385c(0x1cb)]({'error':'An\x20error\x20occurred.'});});}catch(_0x7414d4){console[_0x1d4515(0x223)](_0x7414d4);}}),router[a0_0x376f6a(0x2a8)](a0_0x376f6a(0x221),auth,async(_0x4381d3,_0x4e7696)=>{var _0x5dd5ad=a0_0x376f6a;try{const {username:_0x2da950,email:_0x4a59b3,role:_0x2579e7}=_0x4381d3[_0x5dd5ad(0x1bd)],_0x1f0a49=_0x4381d3['user'],_0x2734c0=await profile[_0x5dd5ad(0x1d1)]({'email':_0x1f0a49['email']}),_0x249ec4=await master_shop['find'](),_0x322419=_0x4381d3[_0x5dd5ad(0x215)]['id'],_0x2e4b39=await purchases[_0x5dd5ad(0x25e)](_0x322419),_0x2a6ef6=await warehouse[_0x5dd5ad(0x21f)]([{'$match':{'name':_0x2e4b39['warehouse_name'],'room':_0x2e4b39[_0x5dd5ad(0x2d2)]}},{'$unwind':_0x5dd5ad(0x2aa)},{'$group':{'_id':_0x5dd5ad(0x1c3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5dd5ad(0x232)},'bay':{'$first':_0x5dd5ad(0x224)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5dd5ad(0x1d0)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5dd5ad(0x288)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5dd5ad(0x249)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5dd5ad(0x257)}}}]),_0x4123a8=await customer[_0x5dd5ad(0x278)]({});let _0x2bb711;if(_0x1f0a49[_0x5dd5ad(0x2c4)]=='staff'){const _0x10bcc1=await staff[_0x5dd5ad(0x1d1)]({'email':_0x1f0a49[_0x5dd5ad(0x1f5)]});_0x2bb711=await warehouse[_0x5dd5ad(0x21f)]([{'$match':{'status':_0x5dd5ad(0x2a6),'name':_0x10bcc1['warehouse']}},{'$group':{'_id':_0x5dd5ad(0x1eb),'name':{'$first':_0x5dd5ad(0x1eb)}}}]);}else _0x2bb711=await warehouse[_0x5dd5ad(0x21f)]([{'$match':{'status':_0x5dd5ad(0x2a6)}},{'$group':{'_id':_0x5dd5ad(0x1eb),'name':{'$first':_0x5dd5ad(0x1eb)}}}]);const _0x1fb80b=await product['find']({}),_0x1430d6=await suppliers[_0x5dd5ad(0x278)]({}),_0x3aba35=BayBinSelected(_0x2e4b39[_0x5dd5ad(0x277)],_0x2e4b39['room']);if(_0x249ec4[0x0][_0x5dd5ad(0x245)]==_0x5dd5ad(0x253)){var _0x4b2cfb=users['English'];console['log'](_0x4b2cfb);}else{if(_0x249ec4[0x0][_0x5dd5ad(0x245)]=='Hindi')var _0x4b2cfb=users[_0x5dd5ad(0x289)];else{if(_0x249ec4[0x0]['language']==_0x5dd5ad(0x291))var _0x4b2cfb=users['German'];else{if(_0x249ec4[0x0][_0x5dd5ad(0x245)]==_0x5dd5ad(0x275))var _0x4b2cfb=users[_0x5dd5ad(0x275)];else{if(_0x249ec4[0x0][_0x5dd5ad(0x245)]==_0x5dd5ad(0x1ef))var _0x4b2cfb=users[_0x5dd5ad(0x1ef)];else{if(_0x249ec4[0x0][_0x5dd5ad(0x245)]=='Portuguese\x20(BR)')var _0x4b2cfb=users[_0x5dd5ad(0x27c)];else{if(_0x249ec4[0x0]['language']==_0x5dd5ad(0x26c))var _0x4b2cfb=users[_0x5dd5ad(0x26c)];else{if(_0x249ec4[0x0][_0x5dd5ad(0x245)]==_0x5dd5ad(0x22d))var _0x4b2cfb=users[_0x5dd5ad(0x2c9)];}}}}}}}_0x4e7696[_0x5dd5ad(0x236)](_0x5dd5ad(0x247),{'success':_0x4381d3[_0x5dd5ad(0x1db)](_0x5dd5ad(0x203)),'errors':_0x4381d3[_0x5dd5ad(0x1db)](_0x5dd5ad(0x282)),'role':_0x1f0a49,'profile':_0x2734c0,'customer':_0x4123a8,'warehouse':_0x2bb711,'product':_0x2a6ef6,'user':_0x2e4b39,'master_shop':_0x249ec4,'unit':_0x1fb80b,'language':_0x4b2cfb,'suppliers':_0x1430d6,'dataSelected':_0x3aba35});}catch(_0x2dd1b8){console[_0x5dd5ad(0x223)](_0x2dd1b8);}}),router['post'](a0_0x376f6a(0x221),auth,async(_0x5bf4fb,_0x31b52e)=>{var _0x2c43da=a0_0x376f6a;try{const _0x6b12e6=_0x5bf4fb[_0x2c43da(0x215)]['id'],{invoice:_0x4992e3,warehouse_name:_0x3adc03,Room_name:_0x132523}=_0x5bf4fb['body'],_0x3c1bce=await warehouse['findOne']({'name':_0x3adc03,'room':_0x132523}),_0x4ccdd0=await purchases[_0x2c43da(0x1d1)]({'invoice':_0x4992e3});_0x4ccdd0[_0x2c43da(0x2b4)][_0x2c43da(0x2c0)](_0xb99b66=>{var _0x4ca92b=_0x2c43da,_0x3a9d7e=0x0;const _0x1ce0f8=_0x3c1bce[_0x4ca92b(0x1bf)][_0x4ca92b(0x2b6)](_0xc84116=>{var _0x37a02c=_0x4ca92b;_0xc84116[_0x37a02c(0x2a7)]==_0xb99b66[_0x37a02c(0x2a7)]&&_0xc84116[_0x37a02c(0x20c)]==_0xb99b66[_0x37a02c(0x20c)]&&_0xc84116[_0x37a02c(0x290)]==_0xb99b66[_0x37a02c(0x290)]&&_0xc84116[_0x37a02c(0x1f9)]==_0xb99b66[_0x37a02c(0x1f9)]&&_0xc84116['bay']==_0xb99b66[_0x37a02c(0x22c)]&&_0xc84116['rack']==_0xb99b66[_0x37a02c(0x21a)]&&_0xc84116[_0x37a02c(0x1fd)]==_0xb99b66['storage']&&_0xc84116[_0x37a02c(0x263)]==_0xb99b66[_0x37a02c(0x263)]&&_0xc84116['batch_code']==_0xb99b66[_0x37a02c(0x2c1)]&&_0xc84116[_0x37a02c(0x216)]==_0xb99b66['production_date']&&_0xc84116['delivery_date']==_0xb99b66[_0x37a02c(0x1e3)]&&_0xc84116[_0x37a02c(0x229)]==_0xb99b66[_0x37a02c(0x229)]&&(_0xc84116[_0x37a02c(0x201)]=parseInt(_0xc84116[_0x37a02c(0x201)])+parseInt(_0xb99b66[_0x37a02c(0x20f)]),_0x3a9d7e++);});_0x3a9d7e=='0'&&(_0x3c1bce['product_details']=_0x3c1bce[_0x4ca92b(0x1bf)]['concat']({'product_name':_0xb99b66[_0x4ca92b(0x2a7)],'product_stock':_0xb99b66[_0x4ca92b(0x20f)],'primary_code':_0xb99b66[_0x4ca92b(0x1ca)],'secondary_code':_0xb99b66[_0x4ca92b(0x272)],'product_code':_0xb99b66[_0x4ca92b(0x26a)],'storage':_0xb99b66[_0x4ca92b(0x1fd)],'rack':_0xb99b66[_0x4ca92b(0x21a)],'bay':_0xb99b66[_0x4ca92b(0x22c)],'bin':_0xb99b66['bin'],'type':_0xb99b66[_0x4ca92b(0x290)],'floorlevel':_0xb99b66[_0x4ca92b(0x20c)],'maxProducts':_0xb99b66['maxStocks'],'unit':_0xb99b66['standard_unit'],'secondary_unit':_0xb99b66['secondary_unit'],'expiry_date':_0xb99b66[_0x4ca92b(0x263)],'maxPerUnit':_0xb99b66[_0x4ca92b(0x21b)],'batch_code':_0xb99b66[_0x4ca92b(0x2c1)],'alertQTY':_0xb99b66[_0x4ca92b(0x228)],'production_date':_0xb99b66['production_date'],'delivery_date':_0xb99b66[_0x4ca92b(0x1e3)],'delivery_code':_0xb99b66['delivery_code']}));}),await _0x3c1bce[_0x2c43da(0x2b2)](),_0x4ccdd0['finalize']=_0x2c43da(0x251);const _0x1ab6db=await _0x4ccdd0[_0x2c43da(0x2b2)]();_0x5bf4fb[_0x2c43da(0x1db)](_0x2c43da(0x203),_0x2c43da(0x24a)),_0x31b52e[_0x2c43da(0x1fb)](_0x2c43da(0x1d2));}catch(_0x33244a){console[_0x2c43da(0x223)](_0x33244a);}}),router['get'](a0_0x376f6a(0x293),auth,async(_0x29cc49,_0x146222)=>{var _0x3fdc62=a0_0x376f6a;try{const {username:_0x36ab1a,email:_0x1ac078,role:_0x5beae5}=_0x29cc49[_0x3fdc62(0x1bd)],_0x3eb799=_0x29cc49['user'],_0x9c07a7=await profile[_0x3fdc62(0x1d1)]({'email':_0x3eb799['email']}),_0x591b61=await master_shop[_0x3fdc62(0x278)](),_0x5840cb=_0x29cc49[_0x3fdc62(0x215)]['id'],_0x17ff02=await purchases[_0x3fdc62(0x25e)](_0x5840cb),_0x534f14=await suppliers[_0x3fdc62(0x278)]({});let _0x58e06b;if(_0x3eb799[_0x3fdc62(0x2c4)]=='staff'){const _0x59241e=await staff['findOne']({'email':_0x3eb799['email']});_0x58e06b=await warehouse[_0x3fdc62(0x278)]({'status':_0x3fdc62(0x2a6),'name':_0x59241e[_0x3fdc62(0x299)],'warehouse_category':_0x3fdc62(0x241)});}else _0x58e06b=await warehouse[_0x3fdc62(0x21f)]([{'$match':{'status':'Enabled','warehouse_category':_0x3fdc62(0x241)}},{'$group':{'_id':_0x3fdc62(0x1eb),'name':{'$first':_0x3fdc62(0x1eb)}}}]);const _0x1e076e=await product[_0x3fdc62(0x278)]({}),_0xa5918b=BayBinSelected(_0x17ff02[_0x3fdc62(0x277)],_0x17ff02[_0x3fdc62(0x2d2)]);let _0x5ec4e6=new Date(_0x17ff02[_0x3fdc62(0x263)]),_0x603e3f=('0'+_0x5ec4e6[_0x3fdc62(0x28a)]())['slice'](-0x2),_0x3b8d6f=('0'+(_0x5ec4e6[_0x3fdc62(0x200)]()+0x1))['slice'](-0x2),_0x14a522=_0x5ec4e6['getFullYear'](),_0x4699cc=_0x14a522+'-'+_0x3b8d6f+'-'+_0x603e3f;if(_0x591b61[0x0][_0x3fdc62(0x245)]=='English\x20(US)'){var _0x409f5e=users[_0x3fdc62(0x21d)];console[_0x3fdc62(0x223)](_0x409f5e);}else{if(_0x591b61[0x0][_0x3fdc62(0x245)]=='Hindi')var _0x409f5e=users['Hindi'];else{if(_0x591b61[0x0][_0x3fdc62(0x245)]==_0x3fdc62(0x291))var _0x409f5e=users[_0x3fdc62(0x291)];else{if(_0x591b61[0x0][_0x3fdc62(0x245)]==_0x3fdc62(0x275))var _0x409f5e=users[_0x3fdc62(0x275)];else{if(_0x591b61[0x0][_0x3fdc62(0x245)]==_0x3fdc62(0x1ef))var _0x409f5e=users[_0x3fdc62(0x1ef)];else{if(_0x591b61[0x0][_0x3fdc62(0x245)]==_0x3fdc62(0x29d))var _0x409f5e=users[_0x3fdc62(0x27c)];else{if(_0x591b61[0x0]['language']==_0x3fdc62(0x26c))var _0x409f5e=users['Chinese'];else{if(_0x591b61[0x0][_0x3fdc62(0x245)]=='Arabic\x20(ae)')var _0x409f5e=users['Arabic'];}}}}}}}_0x146222[_0x3fdc62(0x236)]('edit_purchases',{'success':_0x29cc49[_0x3fdc62(0x1db)](_0x3fdc62(0x203)),'errors':_0x29cc49[_0x3fdc62(0x1db)]('errors'),'role':_0x3eb799,'profile':_0x9c07a7,'purchases':_0x17ff02,'suppliers':_0x534f14,'warehouse':_0x58e06b,'product':_0x1e076e,'master_shop':_0x591b61,'language':_0x409f5e,'ed_fullDate':_0x4699cc,'dataSelected':_0xa5918b});}catch(_0x47329c){console['log'](_0x47329c);}}),router[a0_0x376f6a(0x1e7)](a0_0x376f6a(0x293),auth,async(_0x2c4d8f,_0x4a86a5)=>{var _0x1d91af=a0_0x376f6a;try{const _0x9c7e3e=_0x2c4d8f[_0x1d91af(0x215)]['id'],_0x1dfd06=await purchases[_0x1d91af(0x1d1)]({'_id':_0x2c4d8f[_0x1d91af(0x215)]['id']}),_0x194da6=await warehouse[_0x1d91af(0x1d1)]({'name':_0x1dfd06['warehouse_name'],'room':_0x1dfd06[_0x1d91af(0x2d2)]});_0x1dfd06[_0x1d91af(0x2b4)][_0x1d91af(0x2c0)](_0x545386=>{var _0x490108=_0x1d91af;const _0x4523b8=_0x194da6[_0x490108(0x1bf)][_0x490108(0x2b6)](_0x1c3e6b=>{var _0x19501c=_0x490108;_0x1c3e6b[_0x19501c(0x2a7)]==_0x545386[_0x19501c(0x2a7)]&&_0x1c3e6b[_0x19501c(0x20c)]==_0x545386[_0x19501c(0x20c)]&&_0x1c3e6b[_0x19501c(0x290)]==_0x545386['type']&&_0x1c3e6b[_0x19501c(0x1f9)]==_0x545386['bin']&&_0x1c3e6b[_0x19501c(0x22c)]==_0x545386[_0x19501c(0x22c)]&&_0x1c3e6b[_0x19501c(0x21a)]==_0x545386['rack']&&_0x1c3e6b[_0x19501c(0x1fd)]==_0x545386[_0x19501c(0x1fd)]&&(_0x1c3e6b[_0x19501c(0x201)]=parseInt(_0x1c3e6b['product_stock'])-parseInt(_0x545386[_0x19501c(0x20f)]));});}),await _0x194da6['save']();const {invoice:_0x474a05,suppliers:_0x33b0e4,date:_0x3e3c25,warehouse_name:_0x95d29e,prod_name:_0x3893cd,prod_code:_0x58c1ca,prod_qty:_0x2629e5,prod_unit:_0x5d4c3a,prod_secondunit:_0x5ef12c,prod_level:_0x10cae8,prod_isle:_0x3cf537,prod_pallet:_0x24adce,note:_0x13f71e,expiry_date:_0x49fa6a,batch_code:_0x3caed2,paid_amount:_0x14c960,due_amount:_0x57732b,Room_name:_0x140993,primary_code:_0x2096c7,secondary_code:_0x10d114,PO_number:_0x4d8af1,JO_number:_0x248989}=_0x2c4d8f[_0x1d91af(0x2b3)];if(typeof _0x3893cd=='string')var _0x25009a=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x27f)]],_0x591f34=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x259)]],_0x4a89e7=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1e9)]],_0x3867e8=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1e0)]],_0x59e107=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x27e)]],_0x16587d=[_0x2c4d8f['body'][_0x1d91af(0x294)]],_0x26d639=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x2d4)]],_0x5e7af9=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1ec)]],_0x308183=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1ca)]],_0x517785=[_0x2c4d8f['body']['secondary_code']],_0x22ff33=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x292)]],_0x4b008d=[_0x2c4d8f[_0x1d91af(0x2b3)]['batch_code']],_0x48fd2f=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x263)]],_0x1c4899=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1fd)]],_0x53ff5f=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x2a4)]],_0xe148fc=[_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x290)]];else var _0x25009a=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x27f)]],_0x591f34=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x259)]],_0x4a89e7=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1e9)]],_0x3867e8=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1e0)]],_0x59e107=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x27e)]],_0x16587d=[..._0x2c4d8f['body'][_0x1d91af(0x294)]],_0x26d639=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x2d4)]],_0x5e7af9=[..._0x2c4d8f['body'][_0x1d91af(0x1ec)]],_0x308183=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1ca)]],_0x517785=[..._0x2c4d8f[_0x1d91af(0x2b3)]['secondary_code']],_0x22ff33=[..._0x2c4d8f['body'][_0x1d91af(0x292)]],_0x4b008d=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x2c1)]],_0x48fd2f=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x263)]],_0x1c4899=[..._0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x1fd)]],_0x53ff5f=[..._0x2c4d8f[_0x1d91af(0x2b3)]['rak']],_0xe148fc=[..._0x2c4d8f['body'][_0x1d91af(0x290)]];const _0x3c3287=_0x25009a[_0x1d91af(0x2b6)](_0x50be5d=>{return _0x50be5d={'product_name':_0x50be5d};});_0x591f34[_0x1d91af(0x2c0)]((_0x123060,_0x2bda20)=>{_0x3c3287[_0x2bda20]['product_code']=_0x123060;}),_0x4a89e7[_0x1d91af(0x2c0)]((_0x20ba6b,_0x5064b0)=>{var _0x15d662=_0x1d91af;_0x3c3287[_0x5064b0][_0x15d662(0x20f)]=_0x20ba6b;}),_0x3867e8[_0x1d91af(0x2c0)]((_0x48b9a6,_0x5b90e5)=>{_0x3c3287[_0x5b90e5]['standard_unit']=_0x48b9a6;}),_0x59e107['forEach']((_0x1f3cf3,_0x3c9741)=>{var _0x518420=_0x1d91af;_0x3c3287[_0x3c9741][_0x518420(0x2cc)]=_0x1f3cf3;}),_0x16587d[_0x1d91af(0x2c0)]((_0x2cf53a,_0x12106d)=>{var _0x4d8ed2=_0x1d91af;_0x3c3287[_0x12106d][_0x4d8ed2(0x22c)]=_0x2cf53a;}),_0x26d639[_0x1d91af(0x2c0)]((_0x28850c,_0x4e19ef)=>{_0x3c3287[_0x4e19ef]['bin']=_0x28850c;}),_0x5e7af9[_0x1d91af(0x2c0)]((_0x4e6dcb,_0x14cee0)=>{var _0x3c57f9=_0x1d91af;_0x3c3287[_0x14cee0][_0x3c57f9(0x20c)]=_0x4e6dcb;}),_0x308183[_0x1d91af(0x2c0)]((_0x15abf8,_0x467dcc)=>{var _0x42f77a=_0x1d91af;_0x3c3287[_0x467dcc][_0x42f77a(0x1ca)]=_0x15abf8;}),_0x517785[_0x1d91af(0x2c0)]((_0x22b37b,_0x588260)=>{var _0x3b33fe=_0x1d91af;_0x3c3287[_0x588260][_0x3b33fe(0x272)]=_0x22b37b;}),_0x22ff33[_0x1d91af(0x2c0)]((_0x552118,_0x4b8e3c)=>{_0x3c3287[_0x4b8e3c]['maxStocks']=_0x552118;}),_0x4b008d[_0x1d91af(0x2c0)]((_0x5a84a5,_0x108618)=>{_0x3c3287[_0x108618]['batch_code']=_0x5a84a5;}),_0x48fd2f['forEach']((_0xcbeea4,_0x2716c0)=>{var _0x5c2722=_0x1d91af;_0x3c3287[_0x2716c0][_0x5c2722(0x263)]=_0xcbeea4;}),_0xe148fc[_0x1d91af(0x2c0)]((_0x15cdca,_0x5092f0)=>{var _0x4ce478=_0x1d91af;_0x3c3287[_0x5092f0][_0x4ce478(0x290)]=_0x15cdca;}),_0x1c4899[_0x1d91af(0x2c0)]((_0x36b992,_0x1bfdd6)=>{_0x3c3287[_0x1bfdd6]['storage']=_0x36b992;}),_0x53ff5f[_0x1d91af(0x2c0)]((_0x331df2,_0x486b03)=>{_0x3c3287[_0x486b03]['rack']=_0x331df2;});const _0x347c9a=_0x3c3287[_0x1d91af(0x242)](_0x360339=>_0x360339[_0x1d91af(0x20f)]!=='0'&&_0x360339[_0x1d91af(0x20f)]!=='');_0x1dfd06[_0x1d91af(0x264)]=_0x474a05,_0x1dfd06[_0x1d91af(0x2ba)]=_0x33b0e4,_0x1dfd06[_0x1d91af(0x205)]=_0x3e3c25,_0x1dfd06['warehouse_name']=_0x95d29e,_0x1dfd06[_0x1d91af(0x2b4)]=_0x347c9a,_0x1dfd06[_0x1d91af(0x2b1)]=_0x13f71e,_0x1dfd06[_0x1d91af(0x28b)]=_0x14c960,_0x1dfd06['due_amount']=_0x57732b,_0x1dfd06[_0x1d91af(0x2d2)]=_0x140993,_0x1dfd06[_0x1d91af(0x208)]=_0x4d8af1,_0x1dfd06['JO_number']=_0x248989;const _0x167c27=await _0x1dfd06[_0x1d91af(0x2b2)](),_0x419e5b=await warehouse['findOne']({'name':_0x2c4d8f['body'][_0x1d91af(0x277)],'room':_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x25c)]});_0x1dfd06[_0x1d91af(0x2b4)]['forEach'](_0x3f575b=>{var _0x86fb81=_0x1d91af,_0x4db4fc=0x0;const _0x315fbf=_0x419e5b['product_details'][_0x86fb81(0x2b6)](_0x18095d=>{var _0x51ffa1=_0x86fb81;_0x18095d[_0x51ffa1(0x2a7)]==_0x3f575b[_0x51ffa1(0x2a7)]&&_0x18095d[_0x51ffa1(0x20c)]==_0x3f575b['floorlevel']&&_0x18095d[_0x51ffa1(0x290)]==_0x3f575b[_0x51ffa1(0x290)]&&_0x18095d['bin']==_0x3f575b[_0x51ffa1(0x1f9)]&&_0x18095d[_0x51ffa1(0x22c)]==_0x3f575b[_0x51ffa1(0x22c)]&&_0x18095d['rack']==_0x3f575b[_0x51ffa1(0x21a)]&&_0x18095d[_0x51ffa1(0x1fd)]==_0x3f575b[_0x51ffa1(0x1fd)]&&(_0x18095d[_0x51ffa1(0x201)]=parseInt(_0x18095d[_0x51ffa1(0x201)])+parseInt(_0x3f575b[_0x51ffa1(0x20f)]),_0x4db4fc++);});_0x4db4fc=='0'&&(_0x419e5b['product_details']=_0x419e5b[_0x86fb81(0x1bf)]['concat']({'product_name':_0x3f575b[_0x86fb81(0x2a7)],'product_stock':_0x3f575b['quantity'],'primary_code':_0x3f575b[_0x86fb81(0x1ca)],'secondary_code':_0x3f575b['secondary_code'],'product_code':_0x3f575b[_0x86fb81(0x26a)],'storage':_0x3f575b[_0x86fb81(0x1fd)],'rack':_0x3f575b[_0x86fb81(0x21a)],'bay':_0x3f575b[_0x86fb81(0x22c)],'bin':_0x3f575b['bin'],'type':_0x3f575b['type'],'floorlevel':_0x3f575b[_0x86fb81(0x20c)],'maxProducts':_0x3f575b[_0x86fb81(0x1e6)],'unit':_0x3f575b['standard_unit'],'secondary_unit':_0x3f575b[_0x86fb81(0x2cc)],'expiry_date':_0x3f575b[_0x86fb81(0x263)]}));}),await _0x419e5b[_0x1d91af(0x2b2)]();const _0x1ca8d0=await s_payment_data[_0x1d91af(0x1d1)]({'invoice':_0x2c4d8f['body'][_0x1d91af(0x264)]});if(_0x1ca8d0===null){}else console['log'](_0x1d91af(0x2ba),_0x1ca8d0,_0x2c4d8f[_0x1d91af(0x2b3)]['invoice']),_0x1ca8d0[_0x1d91af(0x2ba)]=_0x2c4d8f[_0x1d91af(0x2b3)][_0x1d91af(0x2ba)],await _0x1ca8d0['save']();_0x2c4d8f[_0x1d91af(0x1db)](_0x1d91af(0x203),_0x1d91af(0x20e)),_0x4a86a5['redirect'](_0x1d91af(0x1d2));}catch(_0x5d935b){console[_0x1d91af(0x223)](_0x5d935b);}}),router[a0_0x376f6a(0x1e7)]('/give_payment/:id',auth,async(_0x1226f6,_0x53f987)=>{var _0xf28fae=a0_0x376f6a;try{const _0x35b4d2=_0x1226f6[_0xf28fae(0x215)]['id'],{invoice:_0x1f2bdd,suppliers:_0x2343cb,payable:_0x28cf42,due_amount:_0x4fb881}=_0x1226f6[_0xf28fae(0x2b3)],_0x19a198=await purchases[_0xf28fae(0x25e)](_0x35b4d2);var _0x2a2d4a=_0x28cf42-_0x4fb881;_0x19a198[_0xf28fae(0x28b)]=parseFloat(_0x19a198[_0xf28fae(0x28b)])+parseFloat(_0x4fb881),_0x19a198[_0xf28fae(0x226)]=_0x2a2d4a;const _0xc01dcb=await _0x19a198[_0xf28fae(0x2b2)]();console[_0xf28fae(0x223)](_0xc01dcb);const _0x104ad3=await s_payment_data[_0xf28fae(0x1d1)]({'invoice':_0x1f2bdd});_0x104ad3[_0xf28fae(0x270)]=_0x2a2d4a,await _0x104ad3[_0xf28fae(0x2b2)]();let _0x45778c=new Date(),_0x899e23=('0'+_0x45778c[_0xf28fae(0x28a)]())[_0xf28fae(0x1e4)](-0x2),_0x2e0223=('0'+(_0x45778c[_0xf28fae(0x200)]()+0x1))['slice'](-0x2),_0x125f62=_0x45778c[_0xf28fae(0x246)](),_0x1d9da5=_0x125f62+'-'+_0x2e0223+'-'+_0x899e23;const _0x1ab3d5=new suppliers_payment({'invoice':_0x1f2bdd,'date':_0x125f62+'-'+_0x2e0223+'-'+_0x899e23,'suppliers':_0x2343cb,'reason':_0xf28fae(0x25d),'amount':_0x4fb881}),_0x433233=await _0x1ab3d5[_0xf28fae(0x2b2)]();_0x1226f6[_0xf28fae(0x1db)](_0xf28fae(0x203),_0xf28fae(0x20a)),_0x53f987['redirect']('/all_purchases/view');}catch(_0x232234){console[_0xf28fae(0x223)](_0x232234);}}),router[a0_0x376f6a(0x2a8)]('/invoice/:id',auth,async(_0x3ceed2,_0x6f47c4)=>{var _0x5d82ce=a0_0x376f6a;try{const {username:_0x3fd1c6,email:_0x46550b,role:_0x291e46}=_0x3ceed2['user'],_0x14a8a1=_0x3ceed2[_0x5d82ce(0x1bd)],_0x37db4c=await profile[_0x5d82ce(0x1d1)]({'email':_0x14a8a1[_0x5d82ce(0x1f5)]}),_0x262a83=await master_shop[_0x5d82ce(0x278)]();console[_0x5d82ce(0x223)](_0x5d82ce(0x1d4),_0x262a83);const _0x165bc5=_0x3ceed2['params']['id'],_0x143bd4=await purchases[_0x5d82ce(0x25e)](_0x165bc5);console[_0x5d82ce(0x223)](_0x143bd4);const _0x58b527=await suppliers[_0x5d82ce(0x1d1)]({'name':_0x143bd4[_0x5d82ce(0x2ba)]});console['log'](_0x58b527);if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x253)){var _0x4a40b5=users[_0x5d82ce(0x21d)];console[_0x5d82ce(0x223)](_0x4a40b5);}else{if(_0x262a83[0x0][_0x5d82ce(0x245)]=='Hindi')var _0x4a40b5=users[_0x5d82ce(0x289)];else{if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x291))var _0x4a40b5=users[_0x5d82ce(0x291)];else{if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x275))var _0x4a40b5=users['Spanish'];else{if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x1ef))var _0x4a40b5=users[_0x5d82ce(0x1ef)];else{if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x29d))var _0x4a40b5=users[_0x5d82ce(0x27c)];else{if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x26c))var _0x4a40b5=users[_0x5d82ce(0x26c)];else{if(_0x262a83[0x0][_0x5d82ce(0x245)]==_0x5d82ce(0x22d))var _0x4a40b5=users[_0x5d82ce(0x2c9)];}}}}}}}_0x6f47c4[_0x5d82ce(0x236)](_0x5d82ce(0x234),{'success':_0x3ceed2['flash']('success'),'errors':_0x3ceed2[_0x5d82ce(0x1db)](_0x5d82ce(0x282)),'role':_0x14a8a1,'profile':_0x37db4c,'master_shop':_0x262a83,'supplier':_0x58b527,'purchase':_0x143bd4,'language':_0x4a40b5});}catch(_0x1f18af){console[_0x5d82ce(0x223)](_0x1f18af);}}),router['get'](a0_0x376f6a(0x262),auth,async(_0x528dd8,_0x28e475)=>{var _0x31830d=a0_0x376f6a;try{const {username:_0x222a5c,email:_0xdd352e,role:_0x2006ce}=_0x528dd8['user'],_0x1a4cf5=_0x528dd8[_0x31830d(0x1bd)],_0x178611=await profile[_0x31830d(0x1d1)]({'email':_0x1a4cf5['email']}),_0x199b27=await master_shop['find']();console['log'](_0x31830d(0x1d4),_0x199b27);const _0x597cb9=_0x528dd8[_0x31830d(0x215)]['id'];console[_0x31830d(0x223)](_0x597cb9);const _0x1cf456=await purchases['findById'](_0x597cb9);console[_0x31830d(0x223)](_0x31830d(0x1fe),_0x1cf456);const _0x39fbb3=await product[_0x31830d(0x278)]({}),_0x5d7bdd=await warehouse[_0x31830d(0x21f)]([{'$match':{'name':_0x1cf456[_0x31830d(0x277)],'room':_0x1cf456[_0x31830d(0x2d2)],'warehouse_category':_0x31830d(0x241)}},{'$unwind':_0x31830d(0x2aa)},{'$group':{'_id':_0x31830d(0x1c3),'name':{'$first':_0x31830d(0x1ed)},'product_stock':{'$first':_0x31830d(0x232)},'bay':{'$first':_0x31830d(0x224)},'bin':{'$first':_0x31830d(0x2c2)},'type':{'$first':_0x31830d(0x1d0)},'floorlevel':{'$first':_0x31830d(0x266)},'primary_code':{'$first':_0x31830d(0x288)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x31830d(0x2ad)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x31830d(0x1c7)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x31830d(0x1d9),'warehouse_category':_0x31830d(0x241)}},{'$group':{'_id':_0x31830d(0x1eb),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x31830d(0x223)](_0x31830d(0x2bc),_0x5d7bdd);if(_0x199b27[0x0][_0x31830d(0x245)]==_0x31830d(0x253)){var _0x4ac494=users[_0x31830d(0x21d)];console[_0x31830d(0x223)](_0x4ac494);}else{if(_0x199b27[0x0]['language']=='Hindi')var _0x4ac494=users[_0x31830d(0x289)];else{if(_0x199b27[0x0]['language']==_0x31830d(0x291))var _0x4ac494=users[_0x31830d(0x291)];else{if(_0x199b27[0x0][_0x31830d(0x245)]=='Spanish')var _0x4ac494=users[_0x31830d(0x275)];else{if(_0x199b27[0x0][_0x31830d(0x245)]==_0x31830d(0x1ef))var _0x4ac494=users[_0x31830d(0x1ef)];else{if(_0x199b27[0x0]['language']==_0x31830d(0x29d))var _0x4ac494=users['Portuguese'];else{if(_0x199b27[0x0][_0x31830d(0x245)]==_0x31830d(0x26c))var _0x4ac494=users[_0x31830d(0x26c)];else{if(_0x199b27[0x0][_0x31830d(0x245)]==_0x31830d(0x22d))var _0x4ac494=users[_0x31830d(0x2c9)];}}}}}}}_0x28e475[_0x31830d(0x236)]('return_purchase',{'success':_0x528dd8['flash'](_0x31830d(0x203)),'errors':_0x528dd8['flash'](_0x31830d(0x282)),'role':_0x1a4cf5,'profile':_0x178611,'user':_0x1cf456,'stock':_0x5d7bdd,'master_shop':_0x199b27,'product':_0x39fbb3,'language':_0x4ac494,'warehouse':warehouse_data});}catch(_0xd084db){console['log'](_0xd084db);}}),router[a0_0x376f6a(0x1e7)]('/view/return_purchase/:id',auth,async(_0x3c46d2,_0x4b57aa)=>{var _0x4fdf20=a0_0x376f6a;try{const {invoice:_0x4bd50b,date:_0x224c90,warehouse_name:_0x24e9d0,Room_name:_0x22ddec,product_name:_0xfb962,purchase_quantity:_0x333fc9,stocks:_0x5e0e9c,return_qty:_0x124816,note:_0x4cd0f2,level:_0x1c012f,isle:_0x4a2a86,pallet:_0x8a8f7f,to_warehouse_name:_0x4a38ad,to_Room_name:_0x48193a}=_0x3c46d2[_0x4fdf20(0x2b3)],_0x20ae43=await purchases[_0x4fdf20(0x1d1)]({'_id':_0x3c46d2[_0x4fdf20(0x215)]['id']}),_0x101a49=await warehouse[_0x4fdf20(0x1d1)]({'name':_0x24e9d0,'room':_0x22ddec});if(typeof _0xfb962==_0x4fdf20(0x207))var _0x1b9379=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2a7)]],_0x5d7613=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2d1)]],_0x39e410=[_0x3c46d2['body']['stocks']],_0x122f19=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x298)]],_0x5268b8=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x285)]],_0x84fcd3=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2d5)]],_0x5ebcc2=[_0x3c46d2[_0x4fdf20(0x2b3)]['pallet']],_0x2b3d15=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2bf)]],_0x3e6b66=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2b5)]],_0x18bb1c=[_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2c7)]],_0x2d97c7=[_0x3c46d2['body']['secondary_code_hide']];else var _0x1b9379=[..._0x3c46d2['body'][_0x4fdf20(0x2a7)]],_0x5d7613=[..._0x3c46d2['body'][_0x4fdf20(0x2d1)]],_0x39e410=[..._0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2c8)]],_0x122f19=[..._0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x298)]],_0x5268b8=[..._0x3c46d2['body']['level']],_0x84fcd3=[..._0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2d5)]],_0x5ebcc2=[..._0x3c46d2[_0x4fdf20(0x2b3)]['pallet']],_0x2b3d15=[..._0x3c46d2['body']['types']],_0x3e6b66=[..._0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2b5)]],_0x18bb1c=[..._0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2c7)]],_0x2d97c7=[..._0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x230)]];const _0x22ce8f=_0x1b9379[_0x4fdf20(0x2b6)](_0x308a34=>{return _0x308a34={'product_name':_0x308a34};});_0x5d7613[_0x4fdf20(0x2c0)]((_0x530891,_0x12b522)=>{var _0x3dd299=_0x4fdf20;_0x22ce8f[_0x12b522][_0x3dd299(0x2d1)]=_0x530891;}),_0x39e410['forEach']((_0x1d877d,_0x41a9ec)=>{var _0x2e3271=_0x4fdf20;_0x22ce8f[_0x41a9ec][_0x2e3271(0x297)]=_0x1d877d;}),_0x122f19[_0x4fdf20(0x2c0)]((_0x3756c7,_0x3c7336)=>{var _0x14b4f4=_0x4fdf20;_0x22ce8f[_0x3c7336][_0x14b4f4(0x298)]=_0x3756c7;}),_0x5268b8[_0x4fdf20(0x2c0)]((_0x5f0491,_0x4de4ee)=>{var _0xda4f63=_0x4fdf20;_0x22ce8f[_0x4de4ee][_0xda4f63(0x22c)]=_0x5f0491;}),_0x84fcd3[_0x4fdf20(0x2c0)]((_0xef27a,_0x3d339a)=>{var _0x13ed1f=_0x4fdf20;_0x22ce8f[_0x3d339a][_0x13ed1f(0x1f9)]=_0xef27a;}),_0x5ebcc2[_0x4fdf20(0x2c0)]((_0x397d7a,_0x292fa5)=>{var _0x1a53c8=_0x4fdf20;_0x22ce8f[_0x292fa5][_0x1a53c8(0x20c)]=_0x397d7a;}),_0x2b3d15[_0x4fdf20(0x2c0)]((_0x40c68d,_0x1a249f)=>{var _0x2a9b7e=_0x4fdf20;_0x22ce8f[_0x1a249f][_0x2a9b7e(0x290)]=_0x40c68d;}),_0x3e6b66[_0x4fdf20(0x2c0)]((_0x5c720e,_0x21d4d8)=>{_0x22ce8f[_0x21d4d8]['product_code']=_0x5c720e;}),_0x18bb1c[_0x4fdf20(0x2c0)]((_0x4048b0,_0x55c891)=>{var _0x31b89a=_0x4fdf20;_0x22ce8f[_0x55c891][_0x31b89a(0x1ca)]=_0x4048b0;}),_0x2d97c7[_0x4fdf20(0x2c0)]((_0x847cc2,_0xb8fcbc)=>{_0x22ce8f[_0xb8fcbc]['secondary_code']=_0x847cc2;}),_0x20ae43[_0x4fdf20(0x2b4)][_0x4fdf20(0x2c0)](_0x100672=>{var _0x1c881a=_0x4fdf20;const _0x590e29=_0x101a49[_0x1c881a(0x1bf)][_0x1c881a(0x2b6)](_0x1f6415=>{var _0x12b0b9=_0x1c881a;_0x1f6415[_0x12b0b9(0x2a7)]==_0x100672[_0x12b0b9(0x2a7)]&&_0x1f6415[_0x12b0b9(0x20c)]==_0x100672[_0x12b0b9(0x20c)]&&_0x1f6415[_0x12b0b9(0x290)]==_0x100672[_0x12b0b9(0x290)]&&_0x1f6415[_0x12b0b9(0x1f9)]==_0x100672[_0x12b0b9(0x1f9)]&&_0x1f6415['bay']==_0x100672[_0x12b0b9(0x22c)]&&_0x1f6415[_0x12b0b9(0x21a)]==_0x100672[_0x12b0b9(0x21a)]&&_0x1f6415['storage']==_0x100672[_0x12b0b9(0x1fd)]&&(console[_0x12b0b9(0x223)](parseInt(_0x1f6415['product_stock'])+'\x20<>\x20'+parseInt(_0x100672[_0x12b0b9(0x20f)])),_0x1f6415[_0x12b0b9(0x201)]=parseInt(_0x1f6415['product_stock'])+parseInt(_0x100672[_0x12b0b9(0x20f)]));});}),await _0x101a49['save']();const _0x5ae0b1=_0x22ce8f['filter'](_0x5dcd8e=>_0x5dcd8e[_0x4fdf20(0x298)]!=='0'&&_0x5dcd8e[_0x4fdf20(0x298)]!=='');var _0x1ec18a=0x0;_0x5ae0b1['forEach'](_0xe117cc=>{var _0x4e6798=_0x4fdf20;console[_0x4e6798(0x223)](_0x4e6798(0x2ce),_0xe117cc),(parseInt(_0xe117cc['purchase_quantity'])<parseInt(_0xe117cc['return_qty'])||parseInt(_0xe117cc['stock_quantity'])<parseInt(_0xe117cc[_0x4e6798(0x298)]))&&_0x1ec18a++;});if(_0x1ec18a!=0x0)return _0x3c46d2[_0x4fdf20(0x1db)](_0x4fdf20(0x282),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x4b57aa[_0x4fdf20(0x1fb)]('back');const _0x264730=new purchases_return({'invoice':_0x4bd50b,'suppliers':_0x3c46d2[_0x4fdf20(0x2b3)][_0x4fdf20(0x2ba)],'date':_0x224c90,'warehouse_name':_0x24e9d0,'return_product':_0x5ae0b1,'note':_0x4cd0f2,'room':_0x22ddec,'to_warehouse_name':_0x4a38ad,'to_room':_0x48193a}),_0xe3a3e3=await _0x264730['save']();console[_0x4fdf20(0x223)](_0x264730);const _0x1dcfe2=await purchases_return[_0x4fdf20(0x1d1)]({'invoice':_0x4bd50b}),_0x95a9ff=await warehouse[_0x4fdf20(0x1d1)]({'name':_0x4a38ad,'room':_0x48193a});_0x1dcfe2['return_product']['forEach'](_0x48c59c=>{var _0x51ba12=_0x4fdf20,_0x12b6c3=0x0;const _0xf3ca68=_0x95a9ff[_0x51ba12(0x1bf)][_0x51ba12(0x2b6)](_0x1f5778=>{var _0x1a291e=_0x51ba12;_0x1f5778[_0x1a291e(0x2a7)]==_0x48c59c[_0x1a291e(0x2a7)]&&_0x1f5778[_0x1a291e(0x20c)]==_0x48c59c[_0x1a291e(0x20c)]&&_0x1f5778[_0x1a291e(0x290)]==_0x48c59c[_0x1a291e(0x290)]&&_0x1f5778[_0x1a291e(0x1f9)]==_0x48c59c[_0x1a291e(0x1f9)]&&_0x1f5778['bay']==_0x48c59c[_0x1a291e(0x22c)]&&(_0x1f5778[_0x1a291e(0x201)]=parseInt(_0x1f5778['product_stock'])-parseInt(_0x48c59c[_0x1a291e(0x298)]),_0x12b6c3++);});_0x12b6c3=='0'&&(_0x95a9ff[_0x51ba12(0x1bf)]=_0x95a9ff[_0x51ba12(0x1bf)][_0x51ba12(0x2c6)]({'product_name':_0x48c59c[_0x51ba12(0x2a7)],'product_stock':_0x48c59c[_0x51ba12(0x298)],'primary_code':_0x48c59c[_0x51ba12(0x1ca)],'secondary_code':_0x48c59c[_0x51ba12(0x272)],'product_code':_0x48c59c['product_code'],'storage':_0x48c59c[_0x51ba12(0x1fd)],'rack':_0x48c59c['rack'],'bay':_0x48c59c['bay'],'bin':_0x48c59c[_0x51ba12(0x1f9)],'type':_0x48c59c[_0x51ba12(0x290)],'floorlevel':_0x48c59c[_0x51ba12(0x20c)],'maxProducts':_0x48c59c[_0x51ba12(0x1e6)],'unit':_0x48c59c[_0x51ba12(0x252)],'secondary_unit':_0x48c59c[_0x51ba12(0x2cc)],'expiry_date':_0x48c59c['expiry_date']}));}),await _0x95a9ff[_0x4fdf20(0x2b2)]();const _0x18f461=await purchases[_0x4fdf20(0x1d1)]({'invoice':_0x4bd50b});_0x18f461[_0x4fdf20(0x2c5)]='True';const _0x2a32ac=await _0x18f461['save'](),_0x4e0e39=new s_payment_data({'invoice':_0x4bd50b,'suppliers':_0x3c46d2[_0x4fdf20(0x2b3)]['suppliers'],'reason':_0x4fdf20(0x274)});await _0x4e0e39['save']();const _0x1f2937=await master_shop[_0x4fdf20(0x278)]();console[_0x4fdf20(0x223)](_0x4fdf20(0x2dc),_0x1f2937[0x0][_0x4fdf20(0x255)]);const _0x591498=await email_settings[_0x4fdf20(0x1d1)](),_0x34f61=await suppliers['findOne']({'name':_0x3c46d2['body'][_0x4fdf20(0x2ba)]});console['log'](_0x4fdf20(0x24d),_0x34f61);_0x1f2937[0x0]['currency_placement']==0x1?(right_currency=_0x1f2937[0x0][_0x4fdf20(0x296)],left_currency=''):(right_currency='',left_currency=_0x1f2937[0x0]['currency']);var _0x5f4693=_0x1b9379,_0xfb7db5=_0x122f19,_0x573513='',_0x19733b;for(_0x19733b in _0x5f4693){_0x573513+=_0x4fdf20(0x24c)+_0x4fdf20(0x1e8)+_0x5f4693[_0x19733b]+_0x4fdf20(0x2db)+_0x4fdf20(0x1e8)+_0xfb7db5[_0x19733b]+_0x4fdf20(0x2db)+_0x4fdf20(0x2a2);}console[_0x4fdf20(0x223)](_0x4fdf20(0x260),_0x573513);let _0x42243b=nodemailer[_0x4fdf20(0x2dd)]({'service':_0x4fdf20(0x25b),'auth':{'user':_0x591498['email'],'pass':_0x591498[_0x4fdf20(0x248)]}}),_0x5b1fa9={'from':_0x591498['email'],'to':_0x34f61[_0x4fdf20(0x1f5)],'subject':_0x4fdf20(0x1f4),'attachments':[{'filename':_0x4fdf20(0x239),'path':__dirname+_0x4fdf20(0x276)+_0x4fdf20(0x24e)+_0x1f2937[0x0][_0x4fdf20(0x255)],'cid':_0x4fdf20(0x2d8)}],'html':_0x4fdf20(0x26b)+_0x4fdf20(0x1c6)+_0x4fdf20(0x1fa)+_0x4fdf20(0x235)+_0x4fdf20(0x1f0)+_0x4fdf20(0x235)+_0x4fdf20(0x2cd)+_0x4fdf20(0x21c)+_0x4fdf20(0x235)+_0x4fdf20(0x23a)+_0x1f2937[0x0][_0x4fdf20(0x258)]+_0x4fdf20(0x231)+_0x4fdf20(0x21c)+_0x4fdf20(0x21c)+_0x4fdf20(0x218)+'<div>'+_0x4fdf20(0x26f)+_0x4fdf20(0x26d)+_0x4bd50b+'\x20'+_0x4fdf20(0x1d7)+_0x4fdf20(0x1cc)+_0x224c90+'\x20'+'</span>'+'</h5>'+_0x4fdf20(0x21c)+_0x4fdf20(0x27d)+_0x4fdf20(0x1f8)+_0x4fdf20(0x24c)+_0x4fdf20(0x2bb)+_0x4fdf20(0x21e)+_0x4fdf20(0x2cf)+_0x4fdf20(0x271)+_0x4fdf20(0x2a2)+'</thead>'+_0x4fdf20(0x24b)+'\x20'+_0x573513+'\x20'+'</tbody>'+'</table>'+_0x4fdf20(0x235)+_0x4fdf20(0x204)+_0x4fdf20(0x22e)+_0x1f2937[0x0][_0x4fdf20(0x258)]+_0x4fdf20(0x1d3)+_0x4fdf20(0x21c)+_0x4fdf20(0x21c)+_0x4fdf20(0x2b9)};_0x42243b[_0x4fdf20(0x27b)](_0x5b1fa9,function(_0xdd65e7,_0x4e2097){var _0x569d40=_0x4fdf20;_0xdd65e7?(console[_0x569d40(0x223)](_0xdd65e7),console['log'](_0x569d40(0x1dc))):console[_0x569d40(0x223)](_0x569d40(0x28f));}),_0x3c46d2[_0x4fdf20(0x1db)](_0x4fdf20(0x203),_0x4fdf20(0x2b0)),_0x4b57aa['redirect']('/all_purchases/view');}catch(_0x2523c9){console[_0x4fdf20(0x223)](_0x2523c9),_0x4b57aa[_0x4fdf20(0x295)](0xc8)['json']({'message':_0x2523c9[_0x4fdf20(0x1df)]});}}),router[a0_0x376f6a(0x2a8)](a0_0x376f6a(0x1f6),auth,async(_0x506bcb,_0x3c8122)=>{var _0x4aa9c1=a0_0x376f6a;try{const {username:_0x290a83,email:_0x1d6f6e,role:_0x44a8f5}=_0x506bcb[_0x4aa9c1(0x1bd)],_0x2a5b3d=_0x506bcb[_0x4aa9c1(0x1bd)],_0x29ad2c=await profile[_0x4aa9c1(0x1d1)]({'email':_0x2a5b3d[_0x4aa9c1(0x1f5)]}),_0x2bf684=await master_shop[_0x4aa9c1(0x278)](),_0x16a441=_0x506bcb['params']['id'],_0x2a7e6b=await purchases[_0x4aa9c1(0x25e)](_0x16a441);if(_0x2bf684[0x0][_0x4aa9c1(0x245)]=='English\x20(US)')var _0x4ab12d=users['English'];else{if(_0x2bf684[0x0][_0x4aa9c1(0x245)]=='Hindi')var _0x4ab12d=users[_0x4aa9c1(0x289)];else{if(_0x2bf684[0x0][_0x4aa9c1(0x245)]==_0x4aa9c1(0x291))var _0x4ab12d=users[_0x4aa9c1(0x291)];else{if(_0x2bf684[0x0]['language']==_0x4aa9c1(0x275))var _0x4ab12d=users[_0x4aa9c1(0x275)];else{if(_0x2bf684[0x0]['language']==_0x4aa9c1(0x1ef))var _0x4ab12d=users[_0x4aa9c1(0x1ef)];else{if(_0x2bf684[0x0][_0x4aa9c1(0x245)]==_0x4aa9c1(0x29d))var _0x4ab12d=users[_0x4aa9c1(0x27c)];else{if(_0x2bf684[0x0][_0x4aa9c1(0x245)]==_0x4aa9c1(0x26c))var _0x4ab12d=users[_0x4aa9c1(0x26c)];else{if(_0x2bf684[0x0][_0x4aa9c1(0x245)]==_0x4aa9c1(0x22d))var _0x4ab12d=users[_0x4aa9c1(0x2c9)];}}}}}}}_0x3c8122[_0x4aa9c1(0x236)](_0x4aa9c1(0x1c4),{'success':_0x506bcb[_0x4aa9c1(0x1db)](_0x4aa9c1(0x203)),'errors':_0x506bcb[_0x4aa9c1(0x1db)]('errors'),'role':_0x2a5b3d,'profile':_0x29ad2c,'alldata':_0x2a7e6b,'master_shop':_0x2bf684,'language':_0x4ab12d}),console['log'](alldata);}catch(_0x32bc50){console[_0x4aa9c1(0x223)](_0x32bc50);}}),router[a0_0x376f6a(0x1e7)](a0_0x376f6a(0x2ae),async(_0x57fa50,_0x4eb59d)=>{var _0xa4cf53=a0_0x376f6a;const {product_code:_0x58d6f7}=_0x57fa50[_0xa4cf53(0x2b3)];var _0x5bdec1;const _0x2621c1=await product[_0xa4cf53(0x21f)]([{'$match':{'primary_code':_0x58d6f7,'product_category':_0xa4cf53(0x241)}},{'$group':{'_id':'$_id','name':{'$first':_0xa4cf53(0x1eb)},'category':{'$first':_0xa4cf53(0x1dd)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0xa4cf53(0x23f)},'product_code':{'$first':_0xa4cf53(0x27a)},'primary_code':{'$first':_0xa4cf53(0x261)},'secondary_code':{'$first':_0xa4cf53(0x269)},'maxStocks':{'$first':_0xa4cf53(0x1fc)},'maxProdPerUnit':{'$first':_0xa4cf53(0x237)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x578a5b=await product[_0xa4cf53(0x21f)]([{'$match':{'secondary_code':_0x58d6f7,'product_category':_0xa4cf53(0x241)}},{'$group':{'_id':_0xa4cf53(0x2a1),'name':{'$first':_0xa4cf53(0x1eb)},'category':{'$first':_0xa4cf53(0x1dd)},'brand':{'$first':_0xa4cf53(0x2a5)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0xa4cf53(0x23f)},'product_code':{'$first':_0xa4cf53(0x27a)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0xa4cf53(0x269)},'maxStocks':{'$first':_0xa4cf53(0x1fc)},'maxProdPerUnit':{'$first':_0xa4cf53(0x237)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0xa4cf53(0x2be)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2621c1[_0xa4cf53(0x2d3)]>0x0)_0x5bdec1=_0x2621c1;else _0x578a5b['length']>0x0&&(_0x5bdec1=_0x578a5b);_0x4eb59d[_0xa4cf53(0x1cb)](_0x5bdec1);}),router[a0_0x376f6a(0x1e7)](a0_0x376f6a(0x287),async(_0x1cd0ed,_0x4bac45)=>{var _0x496520=a0_0x376f6a;const {primaryCode:_0x3da604,secondaryCode:_0x2a7c90,productCode:_0x282e26,bay:_0x5ae7c2,bin:_0xc1cd2c,types:_0x19e54d,pallet:_0x51954f,warehouses:_0xa85475,room:_0x5cb7fe}=_0x1cd0ed[_0x496520(0x2b3)];console[_0x496520(0x223)](_0x1cd0ed['body']);try{const _0xa6224=await warehouse[_0x496520(0x21f)]([{'$match':{'name':_0xa85475,'room':_0x5cb7fe}},{'$unwind':_0x496520(0x2aa)},{'$match':{'product_details.bay':_0x5ae7c2,'product_details.bin':_0xc1cd2c,'product_details.type':_0x19e54d}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x496520(0x1ed)},'product_stock':{'$first':_0x496520(0x232)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x496520(0x1cd)},'maxProducts':{'$first':_0x496520(0x1f3)}}}]);_0x4bac45['status'](0xc8)[_0x496520(0x1cb)](_0xa6224);}catch(_0x2c6fa0){_0x4bac45[_0x496520(0x295)](0x194)['json']({'message':_0x2c6fa0[_0x496520(0x1df)]});}}),module[a0_0x376f6a(0x23b)]=router;