var a0_0xb9756=a0_0xfd9e;(function(_0xd93903,_0x4117ce){var _0x2b9c9e=a0_0xfd9e,_0x134082=_0xd93903();while(!![]){try{var _0x1f1303=-parseInt(_0x2b9c9e(0x26d))/0x1*(parseInt(_0x2b9c9e(0x1f7))/0x2)+parseInt(_0x2b9c9e(0x2a8))/0x3+-parseInt(_0x2b9c9e(0x1f3))/0x4*(-parseInt(_0x2b9c9e(0x29b))/0x5)+-parseInt(_0x2b9c9e(0x273))/0x6+parseInt(_0x2b9c9e(0x27d))/0x7*(-parseInt(_0x2b9c9e(0x213))/0x8)+-parseInt(_0x2b9c9e(0x2ac))/0x9+-parseInt(_0x2b9c9e(0x23d))/0xa*(-parseInt(_0x2b9c9e(0x28a))/0xb);if(_0x1f1303===_0x4117ce)break;else _0x134082['push'](_0x134082['shift']());}catch(_0x7488d){_0x134082['push'](_0x134082['shift']());}}}(a0_0x5f4f,0xb083e));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xb9756(0x21c)),auth=require(a0_0xb9756(0x2e9)),nodemailer=require(a0_0xb9756(0x264));var ejs=require('ejs');const path=require(a0_0xb9756(0x29f)),users=require('../public/language/languages.json');router[a0_0xb9756(0x27e)]('/view',auth,async(_0x27f285,_0x856806)=>{var _0x328911=a0_0xb9756;try{const {username:_0xd0cb4b,email:_0x43cc67,role:_0x370672}=_0x27f285[_0x328911(0x200)],_0x5c6880=_0x27f285[_0x328911(0x200)],_0x3cf021=await profile[_0x328911(0x230)]({'email':_0x5c6880[_0x328911(0x2c8)]}),_0x3e3bd0=await staff[_0x328911(0x230)]({'email':_0x5c6880['email']});if(_0x5c6880[_0x328911(0x223)]==_0x328911(0x292)){const _0x4ddc90=await staff[_0x328911(0x230)]({'email':_0x5c6880[_0x328911(0x2c8)]});}const _0x29620c=await master_shop['find']();let _0x3c2e0c;if(_0x5c6880[_0x328911(0x223)]==_0x328911(0x292)){const _0x1cf952=await staff['findOne']({'email':_0x5c6880['email']});_0x3c2e0c=await purchases[_0x328911(0x221)]([{'$match':{'warehouse_name':_0x1cf952['warehouse']}},{'$lookup':{'from':_0x328911(0x224),'localField':'suppliers','foreignField':'name','as':_0x328911(0x294)}},{'$unwind':_0x328911(0x260)},{'$unwind':_0x328911(0x2a5)},{'$group':{'_id':_0x328911(0x2b4),'invoice':{'$first':_0x328911(0x1de)},'suppliers':{'$first':_0x328911(0x21a)},'date':{'$first':_0x328911(0x2db)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x328911(0x27b)},'product':{'$push':_0x328911(0x2a5)},'note':{'$first':_0x328911(0x1f6)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x328911(0x2a2)},'return_data':{'$first':_0x328911(0x2bd)},'batch_code':{'$first':_0x328911(0x228)},'expiry_date':{'$first':_0x328911(0x235)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x328911(0x259)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x328911(0x21b)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x328911(0x251)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3c2e0c=await purchases[_0x328911(0x221)]([{'$lookup':{'from':'suppliers','localField':_0x328911(0x224),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x328911(0x260)},{'$unwind':'$product'},{'$group':{'_id':_0x328911(0x2b4),'invoice':{'$first':_0x328911(0x1de)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x328911(0x2db)},'warehouse_name':{'$first':_0x328911(0x1f8)},'room':{'$addToSet':_0x328911(0x2b9)},'product':{'$push':_0x328911(0x2a5)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x328911(0x2ba)},'due_amount':{'$first':_0x328911(0x2a2)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x328911(0x228)},'expiry_date':{'$first':_0x328911(0x235)},'suppliers_docs':{'$first':_0x328911(0x260)},'total_product_quantity':{'$sum':_0x328911(0x259)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x328911(0x2cf)},'floorlevel':{'$addToSet':_0x328911(0x251)},'finalize':{'$first':_0x328911(0x28d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x29620c[0x0][_0x328911(0x23f)]==_0x328911(0x25d)){var _0x143405=users[_0x328911(0x1e3)];console[_0x328911(0x2cb)](_0x143405);}else{if(_0x29620c[0x0][_0x328911(0x23f)]==_0x328911(0x286))var _0x143405=users[_0x328911(0x286)];else{if(_0x29620c[0x0][_0x328911(0x23f)]=='German')var _0x143405=users[_0x328911(0x274)];else{if(_0x29620c[0x0][_0x328911(0x23f)]==_0x328911(0x26b))var _0x143405=users['Spanish'];else{if(_0x29620c[0x0]['language']==_0x328911(0x281))var _0x143405=users['French'];else{if(_0x29620c[0x0]['language']==_0x328911(0x263))var _0x143405=users[_0x328911(0x22d)];else{if(_0x29620c[0x0][_0x328911(0x23f)]==_0x328911(0x26f))var _0x143405=users[_0x328911(0x26f)];else{if(_0x29620c[0x0][_0x328911(0x23f)]==_0x328911(0x1cd))var _0x143405=users[_0x328911(0x2e3)];}}}}}}}_0x856806[_0x328911(0x250)](_0x328911(0x201),{'success':_0x27f285['flash'](_0x328911(0x1ea)),'errors':_0x27f285['flash'](_0x328911(0x25c)),'purchases':_0x3c2e0c,'role':_0x5c6880,'profile':_0x3cf021,'master_shop':_0x29620c,'language':_0x143405});}catch(_0x35a23a){console[_0x328911(0x2cb)](_0x328911(0x280),_0x35a23a),_0x856806[_0x328911(0x242)](0xc8)[_0x328911(0x297)]({'message':_0x35a23a[_0x328911(0x295)]});}});function a0_0x5f4f(){var _0x459463=['add_purchases','maxStocks','return_qty','$secondary_code','/../public','bay','<strong>\x20Regards\x20</strong>','$_id','INC-','<h5>','$secondary_unit','$product_details.type','$product.room_name','$paid_amount','Receiving\x20Area','primary_code_hide','$return_data','\x20<\x20wew\x20>\x20','product_cat','Purchase\x20data\x20added\x20successfully','all_purchases_barcode','$brand','/give_payment/:id','length','$product_code','string','secondary_unit','email','Rack\x20D','<span\x20style=\x22float:\x20right;\x22>','log','actual_uom','post','product_code','$product.type','return_data','$product_details.floorlevel','$category','Rack\x20E','prod_unit','<h5\x20style=\x22text-align:\x20left;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','/all_purchases/view','/preview/:id','add_purchases\x20error','<!DOCTYPE\x20html>','$date','currency','prod_cat','types','purchase\x20data\x20update\x20successfully','isle','body','foreach\x20newproduct','Arabic','quantity','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</thead>','prod_Qty','</h5>','../middleware/auth','production_date','$product_details.expiry_date','port','getMonth','Arabic\x20(ae)','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','deliverycode','\x20Order\x20Date\x20:\x20','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','due_amount','random','prod_pallet','warehouse_name','$product_details.product_name','$product_details.product_code','floor','return_product','delivery_date','suppliers_data','MaxStocks_data','$invoice','purchase_invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$maxStocks','</table>','English','alertQTY','/upload/','warehouse','</td>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','success','Raw\x20Materials','$product_details','image','bin','gmail','error','<tbody\x20style=\x22text-align:\x20center;\x22>','then','698332kZicBi','$product_details.storage','</head><body>','$note','2617766NBUkLI','$warehouse_name','$product_details.secondary_code','$alertquantity','JO_number','concat','actual_qty','findById','$product_details.product_stock','user','all_purchases','Return\x20Goods','prod_primunit','$maxProdPerUnit','purchase_quantity','back','params','prod_level','$name','prod_name','expiry_date','type','$product_details.rack','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/:id','$product_details.primary_code','level','sendMail','3746728KufvtK','<table\x20style=\x22width:\x20100%\x20!important;\x22>','storage','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','purchases\x20item\x20return\x20successfull','Level','$suppliers','$product.bin','../models/all_models','Logo.png','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Rack\x20C','aggregate','/view/add_purchases/:id','role','suppliers','edit_purchases_view','product_stock','$unit','$batch_code','prod_code','/view/add_purchases','$product_details.bay','toString','Portuguese','batch_code','product_details','findOne','Floor','invoice','Rack\x20B','An\x20error\x20occurred\x20while\x20saving\x20data.','$expiry_date','secondary_code_hide','Enabled','Room_name','/barcode/:id','maxperunit','Rack\x20F','room_name','890bLnznV','save','language','password','/CheckingWarehouse','status','rack','RoomAssign','rak','stocks','amount','COLD\x20STORAGE','room','secondary_code','$product_details.bin','user_id','all','filter','flash','render','$product.floorlevel','getFullYear','prod_secondunit','/view/return_purchase/:id','paid_amount','POnumber','RMSEmail','Rack\x20A','$product.quantity','Purchase\x20Mail','$primary_code','errors','English\x20(US)','finalize','</div>','$suppliers_docs','host','$product_details.maxProducts','Portuguese\x20(BR)','nodemailer','product','redirect','Email\x20sent\x20successfully','Ambient','</body></html>','Error\x20Occurs','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','1SRZwsK','floorlevel','Chinese','stock_quantity','Paid\x20For\x20Purchase','/invoice/:id','2575500YqPcIY','German','$product_details._id','pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','map','prod_invoice','site_title','$room','here','21uVlllS','get','<html><head><title></title>','table\x20page','French','<div>','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/barcode_scanner','Hindi','getDate','prod_isle','forEach','359909xMMJMQ','delivery_code','<hr\x20class=\x22my-3\x22>','$finalize','catch','note','\x20<>\x20','\x20</h2>','staff','max_product_unit','suppliers_docs','message','exports','json','primary_code','payment\x20successfull','<h2>\x20','35GOmska','abs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','\x20Order\x20Number\x20:\x20','path','date','slice','$due_amount','product_code_hide','Purchase\x20Return\x20Mail','$product','$product_details.pallet','find','2434491MPSjAC','</tr>','logo','standard_unit','9714663BiUeqI'];a0_0x5f4f=function(){return _0x459463;};return a0_0x5f4f();}function a0_0xfd9e(_0xab7117,_0x1cd43c){var _0x5f4f7c=a0_0x5f4f();return a0_0xfd9e=function(_0xfd9e2a,_0x40b458){_0xfd9e2a=_0xfd9e2a-0x1cd;var _0x2f1b04=_0x5f4f7c[_0xfd9e2a];return _0x2f1b04;},a0_0xfd9e(_0xab7117,_0x1cd43c);}function BayBinSelected(_0x2d88cd,_0x3728a2){var _0x69a197=a0_0xb9756,_0x4a3dea=[],_0xd89318=[],_0x151f06=[],_0x1e17f7=[],_0x5673f4=[],_0x24c1e9=[];let _0x4ba480=[];if(_0x2d88cd=='DRY\x20STORAGE')switch(_0x3728a2){case'Rack\x20A':_0x4a3dea=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xd89318=[0x1,0x2],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=['Level',_0x69a197(0x231)],_0x5673f4=['D'],_0x24c1e9=['A'];break;case _0x69a197(0x233):_0x4a3dea=[0x6,0x5,0x4,0x3,0x2,0x1],_0xd89318=[0x1,0x2],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=[_0x69a197(0x219),'Floor'],_0x5673f4=['D'],_0x24c1e9=['B'];break;case'Shelves':_0x4a3dea=[0x0],_0xd89318=[0x0],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=[_0x69a197(0x231)],_0x5673f4=['D'],_0x24c1e9=['S'];break;case _0x69a197(0x2bb):_0x4a3dea=[0x0],_0xd89318=[0x0],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x151f06=['Floor'],_0x5673f4=['D'],_0x24c1e9=['R'];break;}else{if(_0x2d88cd==_0x69a197(0x248))switch(_0x3728a2){case _0x69a197(0x258):_0x4a3dea=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xd89318=['B','F'],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=['Level','Floor'],_0x5673f4=['C'],_0x24c1e9=['A'];break;case _0x69a197(0x233):_0x4a3dea=[0x5,0x4,0x3,0x2,0x1],_0xd89318=['F','B','S'],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=[_0x69a197(0x219),_0x69a197(0x231)],_0x5673f4=['C'],_0x24c1e9=['B'];break;case _0x69a197(0x220):_0x4a3dea=[0x1,0x2,0x3,0x4,0x5],_0xd89318=['B','F','S'],_0x1e17f7=[0x5,0x4,0x3,0x2,0x1],_0x151f06=['Level',_0x69a197(0x231)],_0x5673f4=['C'],_0x24c1e9=['C'];break;case _0x69a197(0x2c9):_0x4a3dea=[0x5,0x4,0x3,0x2,0x1],_0xd89318=['F','B','S'],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=['Level',_0x69a197(0x231)],_0x5673f4=['C'],_0x24c1e9=['D'];break;case _0x69a197(0x2d3):_0x4a3dea=[0x4,0x3,0x2,0x1],_0xd89318=[0x1,0x2],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=[_0x69a197(0x219),'Floor'],_0x5673f4=['C'],_0x24c1e9=['E'];break;case _0x69a197(0x23b):_0x4a3dea=[0x1,0x2,0x3],_0xd89318=[0x1,0x2],_0x1e17f7=[0x1,0x2,0x3,0x4,0x5],_0x151f06=[_0x69a197(0x219)],_0x5673f4=['C'],_0x24c1e9=['F'];break;}}return{'levels':_0x4a3dea,'Isle':_0xd89318,'rack':_0x1e17f7,'type':_0x151f06,'storage':_0x5673f4,'rak':_0x24c1e9};}async function getRandom8DigitNumber(){var _0x503865=a0_0xb9756;const _0x237f8d=0x989680,_0xb9faf3=0x5f5e0ff,_0xdfeb72=Math[_0x503865(0x1d9)](Math[_0x503865(0x1d4)]()*(_0xb9faf3-_0x237f8d+0x1))+_0x237f8d;var _0x94d9a4;const _0x28eaf0=await purchases[_0x503865(0x230)]({'invoice':'INC-'+_0xdfeb72});return _0x28eaf0&&_0x28eaf0['length']>0x0?_0x94d9a4='INC-'+_0xdfeb72:_0x94d9a4=_0x503865(0x2b5)+_0xdfeb72,_0x94d9a4;}router[a0_0xb9756(0x27e)]('/view/add_purchases',auth,async(_0xc498d9,_0x3ebfab)=>{var _0x369f3a=a0_0xb9756;try{const {username:_0x212ea2,email:_0x31821f,role:_0x43562f}=_0xc498d9[_0x369f3a(0x200)],_0x345a5c=_0xc498d9[_0x369f3a(0x200)],_0x23615a=await profile[_0x369f3a(0x230)]({'email':_0x345a5c[_0x369f3a(0x2c8)]}),_0x452d49=await master_shop[_0x369f3a(0x2a7)](),_0x1fcc0c=await staff[_0x369f3a(0x230)]({'email':_0x345a5c[_0x369f3a(0x2c8)]}),_0x3e86f9=await suppliers[_0x369f3a(0x2a7)]({});let _0x29e5be;if(_0x345a5c[_0x369f3a(0x223)]=='staff'){const _0x5c6aaf=await staff[_0x369f3a(0x230)]({'email':_0x345a5c[_0x369f3a(0x2c8)]});_0x29e5be=await warehouse[_0x369f3a(0x221)]([{'$match':{'status':_0x369f3a(0x237),'name':_0x5c6aaf[_0x369f3a(0x1e6)],'warehouse_category':_0x369f3a(0x1eb),'name':{'$ne':_0x369f3a(0x202)}}},{'$group':{'_id':_0x369f3a(0x209),'name':{'$first':'$name'}}}]);}else _0x29e5be=await warehouse[_0x369f3a(0x221)]([{'$match':{'status':'Enabled','warehouse_category':_0x369f3a(0x1eb),'name':{'$ne':_0x369f3a(0x202)}}},{'$group':{'_id':_0x369f3a(0x209),'name':{'$first':_0x369f3a(0x209)}}}]);const _0x4f8564=await product[_0x369f3a(0x2a7)]({}),_0x9e82c1=await warehouse[_0x369f3a(0x2a7)]({'status':_0x369f3a(0x237)}),_0x5924b6=await purchases[_0x369f3a(0x2a7)]({}),_0x330b76=_0x5924b6[_0x369f3a(0x2c4)]+0x1,_0x10def4='INC-'+_0x330b76[_0x369f3a(0x22c)]()['padStart'](0x5,'0');var _0x561f79=[_0x369f3a(0x268),'Enclosed'];if(_0x452d49[0x0][_0x369f3a(0x23f)]==_0x369f3a(0x25d))var _0x306adb=users[_0x369f3a(0x1e3)];else{if(_0x452d49[0x0][_0x369f3a(0x23f)]=='Hindi')var _0x306adb=users['Hindi'];else{if(_0x452d49[0x0]['language']==_0x369f3a(0x274))var _0x306adb=users['German'];else{if(_0x452d49[0x0][_0x369f3a(0x23f)]==_0x369f3a(0x26b))var _0x306adb=users[_0x369f3a(0x26b)];else{if(_0x452d49[0x0][_0x369f3a(0x23f)]==_0x369f3a(0x281))var _0x306adb=users[_0x369f3a(0x281)];else{if(_0x452d49[0x0][_0x369f3a(0x23f)]=='Portuguese\x20(BR)')var _0x306adb=users['Portuguese'];else{if(_0x452d49[0x0][_0x369f3a(0x23f)]==_0x369f3a(0x26f))var _0x306adb=users[_0x369f3a(0x26f)];else{if(_0x452d49[0x0][_0x369f3a(0x23f)]==_0x369f3a(0x1cd))var _0x306adb=users[_0x369f3a(0x2e3)];}}}}}}}const _0x8ee216=getRandom8DigitNumber();_0x8ee216[_0x369f3a(0x1f2)](_0x587f48=>{var _0x5dabe8=_0x369f3a;_0x3ebfab['render'](_0x5dabe8(0x2ad),{'success':_0xc498d9['flash'](_0x5dabe8(0x1ea)),'errors':_0xc498d9[_0x5dabe8(0x24f)](_0x5dabe8(0x25c)),'role':_0x345a5c,'profile':_0x23615a,'suppliers':_0x3e86f9,'warehouse':_0x29e5be,'product':_0x4f8564,'invoice':_0x587f48,'master_shop':_0x452d49,'language':_0x306adb,'find_data':_0x9e82c1,'rooms_data':_0x561f79});})['catch'](_0x13adef=>{var _0x4b6fc1=_0x369f3a;_0xc498d9[_0x4b6fc1(0x24f)](_0x4b6fc1(0x25c),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3ebfab[_0x4b6fc1(0x266)](_0x4b6fc1(0x2d7));});}catch(_0x138228){console['log'](_0x138228);}}),router[a0_0xb9756(0x27e)](a0_0xb9756(0x222),auth,async(_0x5f0849,_0x3a6c40)=>{var _0x606ca=a0_0xb9756;try{const _0x573fa0=_0x5f0849[_0x606ca(0x207)]['id'];console[_0x606ca(0x2cb)](_0x573fa0);const _0x56a417=await master_shop[_0x606ca(0x2a7)]();console[_0x606ca(0x2cb)]('master',_0x56a417);const _0xfb529d=await product[_0x606ca(0x230)]({'name':_0x573fa0});console['log'](_0x606ca(0x265),_0xfb529d),_0x3a6c40[_0x606ca(0x242)](0xc8)[_0x606ca(0x297)]({'product_data':_0xfb529d,'master':_0x56a417});}catch(_0xc24262){console[_0x606ca(0x2cb)](_0x606ca(0x2d9),_0xc24262);}}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x22a),auth,async(_0x1e56c1,_0x2876ed)=>{var _0x4e96e7=a0_0xb9756;try{const {invoice:_0x686ee4,date:_0xb2e132,warehouse_name:_0x1161c5,prod_name:_0x45f40e,prod_code:_0x1af36f,prod_qty:_0x2173f7,prod_unit:_0x214094,prod_secondunit:_0x257e36,prod_level:_0x3c2453,prod_isle:_0x34dbdc,prod_pallet:_0x382efc,note:_0x28eda2,expiry_date:_0xe449f5,batch_code:_0x4ecc99,payable:_0x4bb136,due_amount:_0x31223d,Room_name:_0x227f42,primary_code:_0x18e664,secondary_code:_0x5a19a8,MaxStocks_data:_0x138e11,PO_number:_0x3a9862,SCRN:_0x21016e,JO_number:_0x66fd3f}=_0x1e56c1[_0x4e96e7(0x2e1)];if(typeof _0x45f40e==_0x4e96e7(0x2c6))var _0x48d4de=[_0x1e56c1['body'][_0x4e96e7(0x20a)]],_0x30e372=[_0x1e56c1['body']['prod_code']],_0x1c918b=[_0x1e56c1['body'][_0x4e96e7(0x2e7)]],_0x4c4eca=[_0x1e56c1[_0x4e96e7(0x2e1)]['prod_primunit']],_0x3a97be=[_0x1e56c1[_0x4e96e7(0x2e1)]['prod_secondunit']],_0x457ab8=[_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x208)]],_0x58119b=[_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x298)]],_0x5bcbd5=[_0x1e56c1['body'][_0x4e96e7(0x24a)]],_0x4e236c=[_0x1e56c1[_0x4e96e7(0x2e1)]['MaxStocks_data']],_0x403cb1=[_0x1e56c1[_0x4e96e7(0x2e1)]['batch_code']],_0xb5d52a=[_0x1e56c1[_0x4e96e7(0x2e1)]['expiry_date']],_0x50d790=[_0x1e56c1['body'][_0x4e96e7(0x293)]],_0x1ba2dc=[_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x1e4)]],_0x1fec40=[_0x1e56c1[_0x4e96e7(0x2e1)]['production_date']],_0x36f55b=[_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x2dd)]],_0x786b8=[_0x1e56c1[_0x4e96e7(0x2e1)]['RoomAssign']],_0x44b06a=[_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x1d0)]],_0x2a20e6=[_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x279)]],_0x2726a5=[_0x1e56c1['body'][_0x4e96e7(0x1fd)]],_0x14c70f=[_0x1e56c1['body'][_0x4e96e7(0x2cc)]];else var _0x48d4de=[..._0x1e56c1['body']['prod_name']],_0x30e372=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x229)]],_0x1c918b=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x2e7)]],_0x4c4eca=[..._0x1e56c1['body'][_0x4e96e7(0x203)]],_0x3a97be=[..._0x1e56c1['body'][_0x4e96e7(0x253)]],_0x457ab8=[..._0x1e56c1['body'][_0x4e96e7(0x208)]],_0x58119b=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x298)]],_0x5bcbd5=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x24a)]],_0x4e236c=[..._0x1e56c1['body'][_0x4e96e7(0x1dd)]],_0x403cb1=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x22e)]],_0xb5d52a=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x20b)]],_0x50d790=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x293)]],_0x1ba2dc=[..._0x1e56c1[_0x4e96e7(0x2e1)]['alertQTY']],_0x1fec40=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x2ea)]],_0x36f55b=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x2dd)]],_0x786b8=[..._0x1e56c1['body'][_0x4e96e7(0x244)]],_0x44b06a=[..._0x1e56c1['body'][_0x4e96e7(0x1d0)]],_0x2a20e6=[..._0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x279)]],_0x2726a5=[..._0x1e56c1[_0x4e96e7(0x2e1)]['actual_qty']],_0x14c70f=[..._0x1e56c1[_0x4e96e7(0x2e1)]['actual_uom']];const _0x25fd76=_0x48d4de[_0x4e96e7(0x278)](_0x29bd7c=>{return _0x29bd7c={'product_name':_0x29bd7c};});_0x2726a5[_0x4e96e7(0x289)]((_0x3449f5,_0x103670)=>{var _0x3ac131=_0x4e96e7;_0x25fd76[_0x103670][_0x3ac131(0x1fd)]=Math['abs'](_0x3449f5);}),_0x14c70f[_0x4e96e7(0x289)]((_0x398b16,_0x4d971d)=>{var _0x4caa09=_0x4e96e7;_0x25fd76[_0x4d971d][_0x4caa09(0x2cc)]=_0x398b16;}),_0x30e372[_0x4e96e7(0x289)]((_0x59bfac,_0x1d1b40)=>{var _0x43ec5e=_0x4e96e7;_0x25fd76[_0x1d1b40][_0x43ec5e(0x2ce)]=_0x59bfac;}),_0x1c918b[_0x4e96e7(0x289)]((_0x355f4e,_0x1a13c6)=>{var _0x7f0fd7=_0x4e96e7;_0x25fd76[_0x1a13c6][_0x7f0fd7(0x2e4)]=Math[_0x7f0fd7(0x29c)](_0x355f4e);}),_0x4c4eca[_0x4e96e7(0x289)]((_0x2447f0,_0x2c102b)=>{_0x25fd76[_0x2c102b]['standard_unit']=_0x2447f0;}),_0x3a97be[_0x4e96e7(0x289)]((_0x3c6057,_0x45324a)=>{var _0x58038c=_0x4e96e7;_0x25fd76[_0x45324a][_0x58038c(0x2c7)]=_0x3c6057;}),_0x457ab8[_0x4e96e7(0x289)]((_0x154ba2,_0x2876a)=>{_0x786b8['forEach']((_0x4593a5,_0xfb10a6)=>{var _0x154a4b=a0_0xfd9e;if(_0x4593a5=='Receiving\x20Area'&&_0x2876a==_0xfb10a6){console[_0x154a4b(0x2cb)](_0x4593a5+_0x154a4b(0x2be)+_0x2876a+_0x154a4b(0x290)+_0xfb10a6+_0x154a4b(0x290)+_0x154ba2);var _0x1571a8=_0x154ba2['slice'](0x3);_0x25fd76[_0x2876a][_0x154a4b(0x215)]=_0x154ba2[0x0],_0x25fd76[_0x2876a][_0x154a4b(0x243)]=_0x154ba2[0x1],_0x25fd76[_0x2876a][_0x154a4b(0x2b2)]=0x0,_0x25fd76[_0x2876a]['bin']=0x0,_0x25fd76[_0x2876a][_0x154a4b(0x20c)]=_0x154a4b(0x231),_0x25fd76[_0x2876a]['floorlevel']=_0x1571a8;}else{if(_0x4593a5==_0x154a4b(0x216)&&_0x2876a==_0xfb10a6){var _0x1571a8=_0x154ba2[_0x154a4b(0x2a1)](0x3);_0x25fd76[_0x2876a][_0x154a4b(0x215)]=_0x154ba2[0x0],_0x25fd76[_0x2876a]['rack']=_0x154ba2[0x1],_0x25fd76[_0x2876a][_0x154a4b(0x2b2)]=0x0,_0x25fd76[_0x2876a][_0x154a4b(0x1ee)]=0x0,_0x25fd76[_0x2876a][_0x154a4b(0x20c)]=_0x154a4b(0x231),_0x25fd76[_0x2876a][_0x154a4b(0x26e)]=_0x154ba2[0x5];}else{if(_0x2876a==_0xfb10a6){if(_0x154ba2[0x0]=='A'&&_0x154ba2[0x1]=='L'&&_0x154ba2[0x2]=='L')console[_0x154a4b(0x2cb)](_0x4593a5+_0x154a4b(0x290)+_0x2876a+_0x154a4b(0x290)+_0xfb10a6+_0x154a4b(0x290)+_0x154ba2+_0x154a4b(0x27c)),_0x25fd76[_0x2876a][_0x154a4b(0x215)]=_0x154ba2[0x0],_0x25fd76[_0x2876a]['rack']=_0x154ba2[0x1],_0x25fd76[_0x2876a][_0x154a4b(0x2b2)]=0x0,_0x25fd76[_0x2876a][_0x154a4b(0x1ee)]=0x0,_0x25fd76[_0x2876a][_0x154a4b(0x20c)]=_0x154a4b(0x231),_0x25fd76[_0x2876a]['floorlevel']=_0x154ba2[0x3];else{var _0x2f0d24;if(_0x154ba2[0x4]=='L')_0x2f0d24='Level';else _0x154ba2[0x4]=='F'&&(_0x2f0d24='Floor');_0x25fd76[_0x2876a][_0x154a4b(0x215)]=_0x154ba2[0x0],_0x25fd76[_0x2876a]['rack']=_0x154ba2[0x1],_0x25fd76[_0x2876a]['bay']=_0x154ba2[0x2],_0x25fd76[_0x2876a][_0x154a4b(0x1ee)]=_0x154ba2[0x3],_0x25fd76[_0x2876a][_0x154a4b(0x20c)]=_0x2f0d24,_0x25fd76[_0x2876a][_0x154a4b(0x26e)]=_0x154ba2[0x5];}}}}});}),_0x58119b[_0x4e96e7(0x289)]((_0x4cb951,_0x1afb17)=>{var _0x36821c=_0x4e96e7;_0x25fd76[_0x1afb17][_0x36821c(0x298)]=_0x4cb951;}),_0x5bcbd5[_0x4e96e7(0x289)]((_0x1f0a08,_0xa03897)=>{var _0x4d9be8=_0x4e96e7;_0x25fd76[_0xa03897][_0x4d9be8(0x24a)]=_0x1f0a08;}),_0x4e236c['forEach']((_0x307e7a,_0x106d61)=>{var _0x44ba9a=_0x4e96e7;_0x25fd76[_0x106d61][_0x44ba9a(0x2ae)]=_0x307e7a;}),_0x403cb1[_0x4e96e7(0x289)]((_0x5c1dc7,_0x1b7087)=>{_0x25fd76[_0x1b7087]['batch_code']=_0x5c1dc7;}),_0xb5d52a[_0x4e96e7(0x289)]((_0x3d4863,_0x2cfb62)=>{var _0x4511d5=_0x4e96e7;_0x25fd76[_0x2cfb62][_0x4511d5(0x20b)]=_0x3d4863;}),_0x50d790['forEach']((_0x2a2309,_0x43266e)=>{_0x25fd76[_0x43266e]['maxperunit']=_0x2a2309;}),_0x1ba2dc[_0x4e96e7(0x289)]((_0x103032,_0x39a62a)=>{var _0x4ffae7=_0x4e96e7;_0x25fd76[_0x39a62a][_0x4ffae7(0x1e4)]=_0x103032;}),_0x1fec40[_0x4e96e7(0x289)]((_0x54c970,_0x4fe87c)=>{_0x25fd76[_0x4fe87c]['production_date']=_0x54c970;}),_0x36f55b[_0x4e96e7(0x289)]((_0x3d754f,_0x5aa5e6)=>{var _0x50abe5=_0x4e96e7;_0x25fd76[_0x5aa5e6][_0x50abe5(0x2bf)]=_0x3d754f;}),_0x786b8[_0x4e96e7(0x289)]((_0x17cf21,_0x39c2d7)=>{var _0x1bb86b=_0x4e96e7;_0x25fd76[_0x39c2d7][_0x1bb86b(0x23c)]=_0x17cf21;}),_0x44b06a[_0x4e96e7(0x289)]((_0x5438a3,_0x17230c)=>{var _0x15ee1c=_0x4e96e7;_0x25fd76[_0x17230c][_0x15ee1c(0x28b)]=_0x5438a3;}),_0x2a20e6[_0x4e96e7(0x289)]((_0xe52925,_0x4011f7)=>{var _0x223d75=_0x4e96e7;_0x25fd76[_0x4011f7][_0x223d75(0x232)]=_0xe52925;});const _0x352964=_0x786b8[_0x4e96e7(0x278)](_0x31ebdb=>{return _0x31ebdb={'room_name':_0x31ebdb};}),_0x4411f6=_0x25fd76[_0x4e96e7(0x24e)](_0x111081=>_0x111081['quantity']!=='0'&&_0x111081[_0x4e96e7(0x2e4)]!==''),_0x2c00df=new purchases({'invoice':_0x686ee4,'suppliers':_0x1e56c1[_0x4e96e7(0x2e1)][_0x4e96e7(0x224)],'date':_0xb2e132,'warehouse_name':_0x1161c5,'product':_0x4411f6,'note':_0x28eda2,'due_amount':_0x31223d,'POnumber':_0x3a9862,'SCRN':_0x21016e,'JO_number':_0x66fd3f,'roomList':_0x352964}),_0x5edeaa=await _0x2c00df[_0x4e96e7(0x23e)](),_0x218880=await purchases['findOne']({'invoice':_0x686ee4}),_0x394b0d=_0x218880[_0x4e96e7(0x265)]['map'](async _0x2c2e50=>{var _0x28736b=_0x4e96e7,_0x283650=await warehouse[_0x28736b(0x230)]({'name':_0x1161c5,'room':_0x2c2e50[_0x28736b(0x23c)]}),_0x478f5d=0x0;return _0x283650['product_details'][_0x28736b(0x289)](_0x1f5d3d=>{var _0x4c72a3=_0x28736b;_0x1f5d3d[_0x4c72a3(0x1e9)]==_0x2c2e50['product_name']&&_0x1f5d3d[_0x4c72a3(0x26e)]==_0x2c2e50[_0x4c72a3(0x26e)]&&_0x1f5d3d[_0x4c72a3(0x20c)]==_0x2c2e50[_0x4c72a3(0x20c)]&&_0x1f5d3d[_0x4c72a3(0x1ee)]==_0x2c2e50[_0x4c72a3(0x1ee)]&&_0x1f5d3d[_0x4c72a3(0x2b2)]==_0x2c2e50['bay']&&_0x1f5d3d[_0x4c72a3(0x243)]==_0x2c2e50[_0x4c72a3(0x243)]&&_0x1f5d3d['storage']==_0x2c2e50[_0x4c72a3(0x215)]&&_0x1f5d3d[_0x4c72a3(0x20b)]==_0x2c2e50[_0x4c72a3(0x20b)]&&_0x1f5d3d[_0x4c72a3(0x22e)]==_0x2c2e50[_0x4c72a3(0x22e)]&&_0x1f5d3d[_0x4c72a3(0x2ea)]==_0x2c2e50[_0x4c72a3(0x2ea)]&&_0x1f5d3d['invoice']==_0x218880['invoice']&&(_0x1f5d3d['product_stock']+=Math['abs'](_0x2c2e50[_0x4c72a3(0x2e4)]),_0x478f5d++);}),_0x478f5d===0x0&&_0x283650['product_details']['push']({'product_name':_0x2c2e50[_0x28736b(0x1e9)],'product_stock':Math[_0x28736b(0x29c)](_0x2c2e50['quantity']),'primary_code':_0x2c2e50[_0x28736b(0x298)],'secondary_code':_0x2c2e50['secondary_code'],'product_code':_0x2c2e50[_0x28736b(0x2ce)],'storage':_0x2c2e50[_0x28736b(0x215)],'rack':_0x2c2e50['rack'],'bay':_0x2c2e50[_0x28736b(0x2b2)],'bin':_0x2c2e50[_0x28736b(0x1ee)],'type':_0x2c2e50['type'],'floorlevel':_0x2c2e50[_0x28736b(0x26e)],'maxProducts':_0x2c2e50[_0x28736b(0x2ae)],'unit':_0x2c2e50['standard_unit'],'secondary_unit':_0x2c2e50['secondary_unit'],'expiry_date':_0x2c2e50[_0x28736b(0x20b)],'maxPerUnit':_0x2c2e50['maxperunit'],'batch_code':_0x2c2e50[_0x28736b(0x22e)],'alertQTY':_0x2c2e50[_0x28736b(0x1e4)],'production_date':_0x2c2e50[_0x28736b(0x2ea)],'product_cat':_0x2c2e50[_0x28736b(0x2bf)],'invoice':_0x2c2e50[_0x28736b(0x232)],'actual_qty':Math['abs'](_0x2c2e50['actual_qty']),'actual_uom':_0x2c2e50[_0x28736b(0x2cc)]}),_0x283650;});Promise[_0x4e96e7(0x24d)](_0x394b0d)[_0x4e96e7(0x1f2)](async _0x44e8e2=>{var _0x50d274=_0x4e96e7;try{for(const _0x4f682b of _0x44e8e2){await _0x4f682b[_0x50d274(0x23e)]();}const _0x2c6a58=await master_shop[_0x50d274(0x2a7)](),_0x59cf15=await email_settings[_0x50d274(0x230)](),_0x3b682f=await supervisor_settings[_0x50d274(0x2a7)]();var _0x3db967=_0x218880['product'],_0x4eeea0='',_0x273ac8;for(_0x273ac8 in _0x3db967){_0x4eeea0+='<tr>'+_0x50d274(0x20e)+_0x3db967[_0x273ac8][_0x50d274(0x1e9)]+_0x50d274(0x1e7)+_0x50d274(0x20e)+_0x3db967[_0x273ac8][_0x50d274(0x2ce)]+_0x50d274(0x1e7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3db967[_0x273ac8]['quantity']+_0x50d274(0x1e7)+_0x50d274(0x20e)+_0x3db967[_0x273ac8]['standard_unit']+_0x50d274(0x1e7)+_0x50d274(0x20e)+_0x3db967[_0x273ac8]['secondary_unit']+'</td>'+_0x50d274(0x20e)+_0x218880[_0x50d274(0x1d6)]+_0x50d274(0x1e7)+_0x50d274(0x20e)+_0x3db967[_0x273ac8]['room_name']+_0x50d274(0x1e7)+_0x50d274(0x20e)+_0x3db967[_0x273ac8][_0x50d274(0x215)]+_0x3db967[_0x273ac8][_0x50d274(0x243)]+_0x3db967[_0x273ac8][_0x50d274(0x2b2)]+_0x3db967[_0x273ac8][_0x50d274(0x1ee)]+_0x3db967[_0x273ac8][_0x50d274(0x20c)][0x0]+_0x3db967[_0x273ac8][_0x50d274(0x26e)]+_0x50d274(0x1e7),'</tr>';}let _0x45199a=nodemailer['createTransport']({'host':_0x59cf15[_0x50d274(0x261)],'port':Number(_0x59cf15[_0x50d274(0x2ec)]),'secure':![],'auth':{'user':_0x59cf15[_0x50d274(0x2c8)],'pass':_0x59cf15[_0x50d274(0x240)]}}),_0x16b4e8={'from':_0x59cf15['email'],'to':_0x3b682f[0x0][_0x50d274(0x257)],'subject':_0x50d274(0x25a),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x50d274(0x1e5)+_0x2c6a58[0x0][_0x50d274(0x1ed)],'cid':_0x50d274(0x2aa)}],'html':_0x50d274(0x2da)+_0x50d274(0x27f)+_0x50d274(0x1f5)+_0x50d274(0x282)+_0x50d274(0x1e8)+_0x50d274(0x282)+_0x50d274(0x1d2)+_0x50d274(0x25f)+_0x50d274(0x282)+'<h2>\x20'+_0x2c6a58[0x0][_0x50d274(0x27a)]+_0x50d274(0x291)+_0x50d274(0x25f)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x50d274(0x282)+_0x50d274(0x2d5)+_0x50d274(0x29e)+_0x218880['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x50d274(0x1d1)+_0x218880[_0x50d274(0x2a0)]+'\x20'+'</span>'+_0x50d274(0x2e8)+_0x50d274(0x25f)+_0x50d274(0x214)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x50d274(0x26c)+_0x50d274(0x1cf)+_0x50d274(0x1e0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x50d274(0x21f)+_0x50d274(0x217)+_0x50d274(0x29d)+_0x50d274(0x284)+_0x50d274(0x2a9)+_0x50d274(0x2e6)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x4eeea0+'\x20'+'</tbody>'+_0x50d274(0x1e2)+_0x50d274(0x282)+_0x50d274(0x2b3)+_0x50d274(0x2b6)+_0x2c6a58[0x0][_0x50d274(0x27a)]+_0x50d274(0x2e8)+_0x50d274(0x25f)+'</div>'+_0x50d274(0x269)};_0x45199a['sendMail'](_0x16b4e8,function(_0x490a28,_0x4bf698){var _0x54614f=_0x50d274;_0x490a28?(console[_0x54614f(0x2cb)](_0x490a28),console[_0x54614f(0x2cb)](_0x54614f(0x26a))):console[_0x54614f(0x2cb)](_0x54614f(0x267));}),_0x1e56c1[_0x50d274(0x24f)]('success',_0x50d274(0x2c0)),_0x2876ed[_0x50d274(0x266)]('/all_purchases/view/');}catch(_0x493294){console[_0x50d274(0x1f0)](_0x493294),_0x2876ed[_0x50d274(0x242)](0x1f4)[_0x50d274(0x297)]({'error':_0x50d274(0x234)});}})[_0x4e96e7(0x28e)](_0x4ea27b=>{var _0x3191c1=_0x4e96e7;console[_0x3191c1(0x1f0)](_0x4ea27b),_0x2876ed[_0x3191c1(0x242)](0x1f4)[_0x3191c1(0x297)]({'error':'An\x20error\x20occurred.'});});}catch(_0x492dc9){console['log'](_0x492dc9);}}),router[a0_0xb9756(0x27e)](a0_0xb9756(0x2d8),auth,async(_0x47f082,_0x46fe8c)=>{var _0x1f8f41=a0_0xb9756;try{const {username:_0x1a2c34,email:_0x2154fa,role:_0x8ecef8}=_0x47f082[_0x1f8f41(0x200)],_0x8a209d=_0x47f082[_0x1f8f41(0x200)],_0x1ef56a=await profile[_0x1f8f41(0x230)]({'email':_0x8a209d['email']}),_0xd334=await master_shop[_0x1f8f41(0x2a7)](),_0xf7d603=_0x47f082[_0x1f8f41(0x207)]['id'],_0x25a011=await purchases[_0x1f8f41(0x1fe)](_0xf7d603),_0x42e24a=await warehouse[_0x1f8f41(0x221)]([{'$match':{'name':_0x25a011['warehouse_name'],'room':_0x25a011['room']}},{'$unwind':_0x1f8f41(0x1ec)},{'$group':{'_id':_0x1f8f41(0x275),'name':{'$first':_0x1f8f41(0x1d7)},'product_stock':{'$first':_0x1f8f41(0x1ff)},'bay':{'$first':_0x1f8f41(0x22b)},'bin':{'$first':_0x1f8f41(0x24b)},'type':{'$first':_0x1f8f41(0x2b8)},'floorlevel':{'$first':_0x1f8f41(0x2d1)},'primary_code':{'$first':_0x1f8f41(0x210)},'secondary_code':{'$first':_0x1f8f41(0x1f9)},'product_code':{'$first':_0x1f8f41(0x1d8)},'storage':{'$first':_0x1f8f41(0x1f4)},'rack':{'$first':_0x1f8f41(0x20d)},'expiry_date':{'$first':_0x1f8f41(0x2eb)}}}]),_0x1e88f4=await customer['find']({});let _0x4e2f55;if(_0x8a209d[_0x1f8f41(0x223)]==_0x1f8f41(0x292)){const _0x41599c=await staff[_0x1f8f41(0x230)]({'email':_0x8a209d[_0x1f8f41(0x2c8)]});_0x4e2f55=await warehouse[_0x1f8f41(0x221)]([{'$match':{'status':'Enabled','name':_0x41599c[_0x1f8f41(0x1e6)]}},{'$group':{'_id':'$name','name':{'$first':_0x1f8f41(0x209)}}}]);}else _0x4e2f55=await warehouse[_0x1f8f41(0x221)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x1f8f41(0x209),'name':{'$first':'$name'}}}]);const _0x4a316d=await product[_0x1f8f41(0x2a7)]({}),_0x3636b4=await suppliers['find']({}),_0x1ea0d1=BayBinSelected(_0x25a011[_0x1f8f41(0x1d6)],_0x25a011[_0x1f8f41(0x249)]);if(_0xd334[0x0][_0x1f8f41(0x23f)]==_0x1f8f41(0x25d)){var _0x4220de=users[_0x1f8f41(0x1e3)];console['log'](_0x4220de);}else{if(_0xd334[0x0][_0x1f8f41(0x23f)]==_0x1f8f41(0x286))var _0x4220de=users[_0x1f8f41(0x286)];else{if(_0xd334[0x0][_0x1f8f41(0x23f)]=='German')var _0x4220de=users['German'];else{if(_0xd334[0x0][_0x1f8f41(0x23f)]==_0x1f8f41(0x26b))var _0x4220de=users[_0x1f8f41(0x26b)];else{if(_0xd334[0x0][_0x1f8f41(0x23f)]==_0x1f8f41(0x281))var _0x4220de=users[_0x1f8f41(0x281)];else{if(_0xd334[0x0]['language']==_0x1f8f41(0x263))var _0x4220de=users[_0x1f8f41(0x22d)];else{if(_0xd334[0x0][_0x1f8f41(0x23f)]=='Chinese')var _0x4220de=users[_0x1f8f41(0x26f)];else{if(_0xd334[0x0][_0x1f8f41(0x23f)]==_0x1f8f41(0x1cd))var _0x4220de=users[_0x1f8f41(0x2e3)];}}}}}}}_0x46fe8c[_0x1f8f41(0x250)](_0x1f8f41(0x225),{'success':_0x47f082[_0x1f8f41(0x24f)](_0x1f8f41(0x1ea)),'errors':_0x47f082[_0x1f8f41(0x24f)](_0x1f8f41(0x25c)),'role':_0x8a209d,'profile':_0x1ef56a,'customer':_0x1e88f4,'warehouse':_0x4e2f55,'product':_0x42e24a,'user':_0x25a011,'master_shop':_0xd334,'unit':_0x4a316d,'language':_0x4220de,'suppliers':_0x3636b4,'dataSelected':_0x1ea0d1});}catch(_0x3a32c6){console['log'](_0x3a32c6);}}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x2d8),auth,async(_0x3a13e7,_0x67df71)=>{var _0x2cc9a9=a0_0xb9756;try{const _0x12e1ff=_0x3a13e7[_0x2cc9a9(0x207)]['id'],{invoice:_0x4d424c,warehouse_name:_0x507989,Room_name:_0x4ac80b}=_0x3a13e7[_0x2cc9a9(0x2e1)],_0x1c5832=await warehouse[_0x2cc9a9(0x230)]({'name':_0x507989,'room':_0x4ac80b}),_0x57f604=await purchases[_0x2cc9a9(0x230)]({'invoice':_0x4d424c});_0x57f604[_0x2cc9a9(0x265)][_0x2cc9a9(0x289)](_0x291b31=>{var _0x3eb356=_0x2cc9a9,_0x267b49=0x0;const _0x17ad8f=_0x1c5832[_0x3eb356(0x22f)][_0x3eb356(0x278)](_0x30de23=>{var _0x428597=_0x3eb356;_0x30de23[_0x428597(0x1e9)]==_0x291b31['product_name']&&_0x30de23[_0x428597(0x26e)]==_0x291b31['floorlevel']&&_0x30de23[_0x428597(0x20c)]==_0x291b31[_0x428597(0x20c)]&&_0x30de23[_0x428597(0x1ee)]==_0x291b31['bin']&&_0x30de23[_0x428597(0x2b2)]==_0x291b31[_0x428597(0x2b2)]&&_0x30de23[_0x428597(0x243)]==_0x291b31[_0x428597(0x243)]&&_0x30de23[_0x428597(0x215)]==_0x291b31[_0x428597(0x215)]&&_0x30de23[_0x428597(0x20b)]==_0x291b31['expiry_date']&&_0x30de23[_0x428597(0x22e)]==_0x291b31[_0x428597(0x22e)]&&_0x30de23[_0x428597(0x2ea)]==_0x291b31[_0x428597(0x2ea)]&&_0x30de23[_0x428597(0x1db)]==_0x291b31[_0x428597(0x1db)]&&_0x30de23[_0x428597(0x28b)]==_0x291b31[_0x428597(0x28b)]&&(_0x30de23[_0x428597(0x226)]=parseInt(_0x30de23[_0x428597(0x226)])+parseInt(_0x291b31[_0x428597(0x2e4)]),_0x267b49++);});_0x267b49=='0'&&(_0x1c5832[_0x3eb356(0x22f)]=_0x1c5832[_0x3eb356(0x22f)][_0x3eb356(0x1fc)]({'product_name':_0x291b31[_0x3eb356(0x1e9)],'product_stock':_0x291b31['quantity'],'primary_code':_0x291b31[_0x3eb356(0x298)],'secondary_code':_0x291b31['secondary_code'],'product_code':_0x291b31['product_code'],'storage':_0x291b31[_0x3eb356(0x215)],'rack':_0x291b31[_0x3eb356(0x243)],'bay':_0x291b31[_0x3eb356(0x2b2)],'bin':_0x291b31[_0x3eb356(0x1ee)],'type':_0x291b31[_0x3eb356(0x20c)],'floorlevel':_0x291b31[_0x3eb356(0x26e)],'maxProducts':_0x291b31[_0x3eb356(0x2ae)],'unit':_0x291b31[_0x3eb356(0x2ab)],'secondary_unit':_0x291b31[_0x3eb356(0x2c7)],'expiry_date':_0x291b31[_0x3eb356(0x20b)],'maxPerUnit':_0x291b31[_0x3eb356(0x23a)],'batch_code':_0x291b31[_0x3eb356(0x22e)],'alertQTY':_0x291b31['alertQTY'],'production_date':_0x291b31[_0x3eb356(0x2ea)],'delivery_date':_0x291b31[_0x3eb356(0x1db)],'delivery_code':_0x291b31['delivery_code']}));}),await _0x1c5832[_0x2cc9a9(0x23e)](),_0x57f604[_0x2cc9a9(0x25e)]=_0x2cc9a9(0x283);const _0xcb2c96=await _0x57f604[_0x2cc9a9(0x23e)]();_0x3a13e7['flash'](_0x2cc9a9(0x1ea),'Sales\x20Update\x20successfully'),_0x67df71[_0x2cc9a9(0x266)](_0x2cc9a9(0x2d7));}catch(_0x32c50a){console[_0x2cc9a9(0x2cb)](_0x32c50a);}}),router[a0_0xb9756(0x27e)](a0_0xb9756(0x20f),auth,async(_0xa35817,_0x28ef45)=>{var _0x47947b=a0_0xb9756;try{const {username:_0x4d8e4c,email:_0x591e05,role:_0x5e3044}=_0xa35817[_0x47947b(0x200)],_0x5f3b36=_0xa35817[_0x47947b(0x200)],_0xe86587=await profile[_0x47947b(0x230)]({'email':_0x5f3b36[_0x47947b(0x2c8)]}),_0x35922c=await master_shop['find'](),_0x240842=_0xa35817['params']['id'],_0x4ec2d0=await purchases[_0x47947b(0x1fe)](_0x240842),_0x3a83d6=await suppliers['find']({});let _0x5e4bf3;if(_0x5f3b36['role']=='staff'){const _0x45f1e9=await staff[_0x47947b(0x230)]({'email':_0x5f3b36[_0x47947b(0x2c8)]});_0x5e4bf3=await warehouse[_0x47947b(0x2a7)]({'status':'Enabled','name':_0x45f1e9[_0x47947b(0x1e6)],'warehouse_category':_0x47947b(0x1eb)});}else _0x5e4bf3=await warehouse[_0x47947b(0x221)]([{'$match':{'status':_0x47947b(0x237),'warehouse_category':_0x47947b(0x1eb)}},{'$group':{'_id':'$name','name':{'$first':_0x47947b(0x209)}}}]);const _0x1bcd36=await product[_0x47947b(0x2a7)]({}),_0x2e4e89=BayBinSelected(_0x4ec2d0[_0x47947b(0x1d6)],_0x4ec2d0[_0x47947b(0x249)]);let _0x288a4b=new Date(_0x4ec2d0[_0x47947b(0x20b)]),_0x1f95e9=('0'+_0x288a4b[_0x47947b(0x287)]())[_0x47947b(0x2a1)](-0x2),_0x4729af=('0'+(_0x288a4b['getMonth']()+0x1))[_0x47947b(0x2a1)](-0x2),_0x44d249=_0x288a4b[_0x47947b(0x252)](),_0x3f38c9=_0x44d249+'-'+_0x4729af+'-'+_0x1f95e9;if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x25d)){var _0x2554e9=users[_0x47947b(0x1e3)];console[_0x47947b(0x2cb)](_0x2554e9);}else{if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x286))var _0x2554e9=users['Hindi'];else{if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x274))var _0x2554e9=users[_0x47947b(0x274)];else{if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x26b))var _0x2554e9=users['Spanish'];else{if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x281))var _0x2554e9=users[_0x47947b(0x281)];else{if(_0x35922c[0x0]['language']==_0x47947b(0x263))var _0x2554e9=users[_0x47947b(0x22d)];else{if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x26f))var _0x2554e9=users[_0x47947b(0x26f)];else{if(_0x35922c[0x0][_0x47947b(0x23f)]==_0x47947b(0x1cd))var _0x2554e9=users[_0x47947b(0x2e3)];}}}}}}}_0x28ef45['render']('edit_purchases',{'success':_0xa35817[_0x47947b(0x24f)](_0x47947b(0x1ea)),'errors':_0xa35817['flash']('errors'),'role':_0x5f3b36,'profile':_0xe86587,'purchases':_0x4ec2d0,'suppliers':_0x3a83d6,'warehouse':_0x5e4bf3,'product':_0x1bcd36,'master_shop':_0x35922c,'language':_0x2554e9,'ed_fullDate':_0x3f38c9,'dataSelected':_0x2e4e89});}catch(_0x1cd48a){console[_0x47947b(0x2cb)](_0x1cd48a);}}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x20f),auth,async(_0x5d5711,_0x31af62)=>{var _0x32d1d4=a0_0xb9756;try{const _0x1e8089=_0x5d5711[_0x32d1d4(0x207)]['id'],_0x53b1a0=await purchases[_0x32d1d4(0x230)]({'_id':_0x5d5711[_0x32d1d4(0x207)]['id']}),_0x39696a=await warehouse[_0x32d1d4(0x230)]({'name':_0x53b1a0['warehouse_name'],'room':_0x53b1a0[_0x32d1d4(0x249)]});_0x53b1a0[_0x32d1d4(0x265)]['forEach'](_0x30362c=>{var _0x5f5926=_0x32d1d4;const _0x501e60=_0x39696a[_0x5f5926(0x22f)]['map'](_0x2ebdcc=>{var _0x2ee608=_0x5f5926;_0x2ebdcc[_0x2ee608(0x1e9)]==_0x30362c['product_name']&&_0x2ebdcc[_0x2ee608(0x26e)]==_0x30362c[_0x2ee608(0x26e)]&&_0x2ebdcc[_0x2ee608(0x20c)]==_0x30362c[_0x2ee608(0x20c)]&&_0x2ebdcc['bin']==_0x30362c['bin']&&_0x2ebdcc[_0x2ee608(0x2b2)]==_0x30362c[_0x2ee608(0x2b2)]&&_0x2ebdcc['rack']==_0x30362c['rack']&&_0x2ebdcc[_0x2ee608(0x215)]==_0x30362c[_0x2ee608(0x215)]&&(_0x2ebdcc[_0x2ee608(0x226)]=parseInt(_0x2ebdcc[_0x2ee608(0x226)])-parseInt(_0x30362c['quantity']));});}),await _0x39696a[_0x32d1d4(0x23e)]();const {invoice:_0x3126c0,suppliers:_0x2ddd69,date:_0x269406,warehouse_name:_0x21fd59,prod_name:_0x5104b3,prod_code:_0x52ecb0,prod_qty:_0x45f428,prod_unit:_0x1f2bfb,prod_secondunit:_0x3d291d,prod_level:_0x24994c,prod_isle:_0x2f5c46,prod_pallet:_0x358428,note:_0x52efd7,expiry_date:_0x1ba276,batch_code:_0x4293f7,paid_amount:_0x711cdd,due_amount:_0x1ac91d,Room_name:_0x5ec1c7,primary_code:_0x57ab9a,secondary_code:_0x381372,PO_number:_0x5b1ebf,JO_number:_0x141f9d}=_0x5d5711[_0x32d1d4(0x2e1)];if(typeof _0x5104b3=='string')var _0x57af49=[_0x5d5711['body'][_0x32d1d4(0x20a)]],_0x709c2a=[_0x5d5711['body']['prod_code']],_0x2706d7=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x21e)]],_0x3a5e28=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x2d4)]],_0x446b5e=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x253)]],_0x141020=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x208)]],_0x3870ee=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x288)]],_0x249975=[_0x5d5711['body'][_0x32d1d4(0x1d5)]],_0x38dcd5=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x298)]],_0x3d22d4=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x24a)]],_0x2b6833=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x1dd)]],_0x3341da=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x22e)]],_0x35cbf7=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x20b)]],_0x2c9f57=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x215)]],_0x3bbc32=[_0x5d5711['body'][_0x32d1d4(0x245)]],_0xfd5dc=[_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x20c)]];else var _0x57af49=[..._0x5d5711[_0x32d1d4(0x2e1)]['prod_name']],_0x709c2a=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x229)]],_0x2706d7=[..._0x5d5711[_0x32d1d4(0x2e1)]['prod_qty']],_0x3a5e28=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x2d4)]],_0x446b5e=[..._0x5d5711[_0x32d1d4(0x2e1)]['prod_secondunit']],_0x141020=[..._0x5d5711['body']['prod_level']],_0x3870ee=[..._0x5d5711['body'][_0x32d1d4(0x288)]],_0x249975=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x1d5)]],_0x38dcd5=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x298)]],_0x3d22d4=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x24a)]],_0x2b6833=[..._0x5d5711[_0x32d1d4(0x2e1)]['MaxStocks_data']],_0x3341da=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x22e)]],_0x35cbf7=[..._0x5d5711['body'][_0x32d1d4(0x20b)]],_0x2c9f57=[..._0x5d5711[_0x32d1d4(0x2e1)]['storage']],_0x3bbc32=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x245)]],_0xfd5dc=[..._0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x20c)]];const _0x4fdae6=_0x57af49[_0x32d1d4(0x278)](_0x36484e=>{return _0x36484e={'product_name':_0x36484e};});_0x709c2a[_0x32d1d4(0x289)]((_0x54827e,_0x258ca0)=>{var _0x573f88=_0x32d1d4;_0x4fdae6[_0x258ca0][_0x573f88(0x2ce)]=_0x54827e;}),_0x2706d7[_0x32d1d4(0x289)]((_0x4fdb7b,_0x42ead6)=>{var _0x4ceddb=_0x32d1d4;_0x4fdae6[_0x42ead6][_0x4ceddb(0x2e4)]=_0x4fdb7b;}),_0x3a5e28[_0x32d1d4(0x289)]((_0x439cd5,_0x4a8e7f)=>{_0x4fdae6[_0x4a8e7f]['standard_unit']=_0x439cd5;}),_0x446b5e['forEach']((_0x353c5a,_0x3cdcb8)=>{_0x4fdae6[_0x3cdcb8]['secondary_unit']=_0x353c5a;}),_0x141020['forEach']((_0x46fd52,_0x410084)=>{var _0x48fc55=_0x32d1d4;_0x4fdae6[_0x410084][_0x48fc55(0x2b2)]=_0x46fd52;}),_0x3870ee[_0x32d1d4(0x289)]((_0x245faf,_0x208583)=>{var _0x5bfbbb=_0x32d1d4;_0x4fdae6[_0x208583][_0x5bfbbb(0x1ee)]=_0x245faf;}),_0x249975[_0x32d1d4(0x289)]((_0x4abf95,_0x378fff)=>{var _0x44e090=_0x32d1d4;_0x4fdae6[_0x378fff][_0x44e090(0x26e)]=_0x4abf95;}),_0x38dcd5[_0x32d1d4(0x289)]((_0x3d41d1,_0x268572)=>{var _0x3ba735=_0x32d1d4;_0x4fdae6[_0x268572][_0x3ba735(0x298)]=_0x3d41d1;}),_0x3d22d4[_0x32d1d4(0x289)]((_0x1cfbd2,_0x2b48d0)=>{var _0x32c820=_0x32d1d4;_0x4fdae6[_0x2b48d0][_0x32c820(0x24a)]=_0x1cfbd2;}),_0x2b6833['forEach']((_0x14fc54,_0x47e995)=>{var _0x3d5451=_0x32d1d4;_0x4fdae6[_0x47e995][_0x3d5451(0x2ae)]=_0x14fc54;}),_0x3341da[_0x32d1d4(0x289)]((_0x376b2e,_0x2e0133)=>{var _0x102199=_0x32d1d4;_0x4fdae6[_0x2e0133][_0x102199(0x22e)]=_0x376b2e;}),_0x35cbf7[_0x32d1d4(0x289)]((_0x5efbbe,_0x1b541f)=>{_0x4fdae6[_0x1b541f]['expiry_date']=_0x5efbbe;}),_0xfd5dc[_0x32d1d4(0x289)]((_0x3ff02c,_0x2b0c70)=>{var _0x253a40=_0x32d1d4;_0x4fdae6[_0x2b0c70][_0x253a40(0x20c)]=_0x3ff02c;}),_0x2c9f57[_0x32d1d4(0x289)]((_0x4febb0,_0x725ce3)=>{_0x4fdae6[_0x725ce3]['storage']=_0x4febb0;}),_0x3bbc32[_0x32d1d4(0x289)]((_0x29bd5f,_0x14c2c5)=>{var _0x3cb7fe=_0x32d1d4;_0x4fdae6[_0x14c2c5][_0x3cb7fe(0x243)]=_0x29bd5f;});const _0xd6a7d0=_0x4fdae6['filter'](_0x4144d9=>_0x4144d9[_0x32d1d4(0x2e4)]!=='0'&&_0x4144d9[_0x32d1d4(0x2e4)]!=='');_0x53b1a0['invoice']=_0x3126c0,_0x53b1a0[_0x32d1d4(0x224)]=_0x2ddd69,_0x53b1a0[_0x32d1d4(0x2a0)]=_0x269406,_0x53b1a0[_0x32d1d4(0x1d6)]=_0x21fd59,_0x53b1a0[_0x32d1d4(0x265)]=_0xd6a7d0,_0x53b1a0[_0x32d1d4(0x28f)]=_0x52efd7,_0x53b1a0[_0x32d1d4(0x255)]=_0x711cdd,_0x53b1a0[_0x32d1d4(0x1d3)]=_0x1ac91d,_0x53b1a0[_0x32d1d4(0x249)]=_0x5ec1c7,_0x53b1a0[_0x32d1d4(0x256)]=_0x5b1ebf,_0x53b1a0[_0x32d1d4(0x1fb)]=_0x141f9d;const _0x13c06a=await _0x53b1a0[_0x32d1d4(0x23e)](),_0x2f5ef1=await warehouse[_0x32d1d4(0x230)]({'name':_0x5d5711['body']['warehouse_name'],'room':_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x238)]});_0x53b1a0['product'][_0x32d1d4(0x289)](_0x64a97c=>{var _0x45c9bc=_0x32d1d4,_0x5cb7fa=0x0;const _0x29a360=_0x2f5ef1['product_details'][_0x45c9bc(0x278)](_0x32db45=>{var _0x570069=_0x45c9bc;_0x32db45[_0x570069(0x1e9)]==_0x64a97c[_0x570069(0x1e9)]&&_0x32db45[_0x570069(0x26e)]==_0x64a97c[_0x570069(0x26e)]&&_0x32db45['type']==_0x64a97c[_0x570069(0x20c)]&&_0x32db45[_0x570069(0x1ee)]==_0x64a97c[_0x570069(0x1ee)]&&_0x32db45[_0x570069(0x2b2)]==_0x64a97c[_0x570069(0x2b2)]&&_0x32db45[_0x570069(0x243)]==_0x64a97c['rack']&&_0x32db45[_0x570069(0x215)]==_0x64a97c['storage']&&(_0x32db45['product_stock']=parseInt(_0x32db45[_0x570069(0x226)])+parseInt(_0x64a97c[_0x570069(0x2e4)]),_0x5cb7fa++);});_0x5cb7fa=='0'&&(_0x2f5ef1['product_details']=_0x2f5ef1['product_details']['concat']({'product_name':_0x64a97c['product_name'],'product_stock':_0x64a97c[_0x45c9bc(0x2e4)],'primary_code':_0x64a97c[_0x45c9bc(0x298)],'secondary_code':_0x64a97c[_0x45c9bc(0x24a)],'product_code':_0x64a97c['product_code'],'storage':_0x64a97c['storage'],'rack':_0x64a97c[_0x45c9bc(0x243)],'bay':_0x64a97c['bay'],'bin':_0x64a97c[_0x45c9bc(0x1ee)],'type':_0x64a97c[_0x45c9bc(0x20c)],'floorlevel':_0x64a97c[_0x45c9bc(0x26e)],'maxProducts':_0x64a97c[_0x45c9bc(0x2ae)],'unit':_0x64a97c[_0x45c9bc(0x2ab)],'secondary_unit':_0x64a97c[_0x45c9bc(0x2c7)],'expiry_date':_0x64a97c[_0x45c9bc(0x20b)]}));}),await _0x2f5ef1['save']();const _0x42aff9=await s_payment_data['findOne']({'invoice':_0x5d5711[_0x32d1d4(0x2e1)][_0x32d1d4(0x232)]});if(_0x42aff9===null){}else console[_0x32d1d4(0x2cb)]('suppliers',_0x42aff9,_0x5d5711['body'][_0x32d1d4(0x232)]),_0x42aff9[_0x32d1d4(0x224)]=_0x5d5711[_0x32d1d4(0x2e1)]['suppliers'],await _0x42aff9[_0x32d1d4(0x23e)]();_0x5d5711[_0x32d1d4(0x24f)]('success',_0x32d1d4(0x2df)),_0x31af62[_0x32d1d4(0x266)](_0x32d1d4(0x2d7));}catch(_0x5c2f7f){console[_0x32d1d4(0x2cb)](_0x5c2f7f);}}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x2c3),auth,async(_0x406b98,_0x3897a1)=>{var _0x3ed394=a0_0xb9756;try{const _0x2a1543=_0x406b98['params']['id'],{invoice:_0x356659,suppliers:_0x46e41e,payable:_0x2a178d,due_amount:_0x25baa7}=_0x406b98[_0x3ed394(0x2e1)],_0x3f85ab=await purchases[_0x3ed394(0x1fe)](_0x2a1543);var _0x5354cb=_0x2a178d-_0x25baa7;_0x3f85ab[_0x3ed394(0x255)]=parseFloat(_0x3f85ab[_0x3ed394(0x255)])+parseFloat(_0x25baa7),_0x3f85ab[_0x3ed394(0x1d3)]=_0x5354cb;const _0xa3a364=await _0x3f85ab[_0x3ed394(0x23e)]();console['log'](_0xa3a364);const _0x57b835=await s_payment_data[_0x3ed394(0x230)]({'invoice':_0x356659});_0x57b835[_0x3ed394(0x247)]=_0x5354cb,await _0x57b835['save']();let _0x5dcec9=new Date(),_0x1c854b=('0'+_0x5dcec9[_0x3ed394(0x287)]())[_0x3ed394(0x2a1)](-0x2),_0x4cc971=('0'+(_0x5dcec9[_0x3ed394(0x2ed)]()+0x1))['slice'](-0x2),_0x41ceb3=_0x5dcec9[_0x3ed394(0x252)](),_0x4e50c2=_0x41ceb3+'-'+_0x4cc971+'-'+_0x1c854b;const _0x275a81=new suppliers_payment({'invoice':_0x356659,'date':_0x41ceb3+'-'+_0x4cc971+'-'+_0x1c854b,'suppliers':_0x46e41e,'reason':_0x3ed394(0x271),'amount':_0x25baa7}),_0x452551=await _0x275a81[_0x3ed394(0x23e)]();_0x406b98[_0x3ed394(0x24f)](_0x3ed394(0x1ea),_0x3ed394(0x299)),_0x3897a1[_0x3ed394(0x266)](_0x3ed394(0x2d7));}catch(_0x584dbe){console[_0x3ed394(0x2cb)](_0x584dbe);}}),router['get'](a0_0xb9756(0x272),auth,async(_0x1073de,_0xa6fe36)=>{var _0x3343ce=a0_0xb9756;try{const {username:_0x56964e,email:_0x5cef99,role:_0x16fc99}=_0x1073de[_0x3343ce(0x200)],_0x4ec467=_0x1073de[_0x3343ce(0x200)],_0x557416=await profile[_0x3343ce(0x230)]({'email':_0x4ec467[_0x3343ce(0x2c8)]}),_0x1ea895=await master_shop[_0x3343ce(0x2a7)]();console['log']('master',_0x1ea895);const _0x12ba3c=_0x1073de['params']['id'],_0x18b7fa=await purchases[_0x3343ce(0x1fe)](_0x12ba3c);console[_0x3343ce(0x2cb)](_0x18b7fa);const _0x3c72e7=await suppliers[_0x3343ce(0x230)]({'name':_0x18b7fa[_0x3343ce(0x224)]});console['log'](_0x3c72e7);if(_0x1ea895[0x0]['language']==_0x3343ce(0x25d)){var _0x2ee276=users[_0x3343ce(0x1e3)];console[_0x3343ce(0x2cb)](_0x2ee276);}else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]==_0x3343ce(0x286))var _0x2ee276=users[_0x3343ce(0x286)];else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]==_0x3343ce(0x274))var _0x2ee276=users[_0x3343ce(0x274)];else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]=='Spanish')var _0x2ee276=users[_0x3343ce(0x26b)];else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]==_0x3343ce(0x281))var _0x2ee276=users[_0x3343ce(0x281)];else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]==_0x3343ce(0x263))var _0x2ee276=users['Portuguese'];else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]=='Chinese')var _0x2ee276=users[_0x3343ce(0x26f)];else{if(_0x1ea895[0x0][_0x3343ce(0x23f)]==_0x3343ce(0x1cd))var _0x2ee276=users[_0x3343ce(0x2e3)];}}}}}}}_0xa6fe36[_0x3343ce(0x250)](_0x3343ce(0x1df),{'success':_0x1073de[_0x3343ce(0x24f)](_0x3343ce(0x1ea)),'errors':_0x1073de[_0x3343ce(0x24f)](_0x3343ce(0x25c)),'role':_0x4ec467,'profile':_0x557416,'master_shop':_0x1ea895,'supplier':_0x3c72e7,'purchase':_0x18b7fa,'language':_0x2ee276});}catch(_0x553e7b){console[_0x3343ce(0x2cb)](_0x553e7b);}}),router[a0_0xb9756(0x27e)]('/view/return_purchase/:id',auth,async(_0x45b362,_0x367f12)=>{var _0x376975=a0_0xb9756;try{const {username:_0x409cf8,email:_0x1b5e02,role:_0x78bbf3}=_0x45b362[_0x376975(0x200)],_0x387b90=_0x45b362[_0x376975(0x200)],_0x2e1f87=await profile['findOne']({'email':_0x387b90['email']}),_0x42036e=await master_shop[_0x376975(0x2a7)]();console[_0x376975(0x2cb)](_0x376975(0x1ce),_0x42036e);const _0x27c405=_0x45b362[_0x376975(0x207)]['id'];console[_0x376975(0x2cb)](_0x27c405);const _0x50eeea=await purchases[_0x376975(0x1fe)](_0x27c405);console[_0x376975(0x2cb)](_0x376975(0x24c),_0x50eeea);const _0x17e65b=await product['find']({}),_0x3e59ff=await warehouse['aggregate']([{'$match':{'name':_0x50eeea['warehouse_name'],'room':_0x50eeea[_0x376975(0x249)],'warehouse_category':_0x376975(0x1eb)}},{'$unwind':_0x376975(0x1ec)},{'$group':{'_id':_0x376975(0x275),'name':{'$first':_0x376975(0x1d7)},'product_stock':{'$first':_0x376975(0x1ff)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x376975(0x24b)},'type':{'$first':_0x376975(0x2b8)},'floorlevel':{'$first':_0x376975(0x2d1)},'primary_code':{'$first':_0x376975(0x210)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x376975(0x1f4)},'rack':{'$first':_0x376975(0x20d)}}}]);warehouse_data=await warehouse[_0x376975(0x221)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x376975(0x209),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0x3e59ff);if(_0x42036e[0x0]['language']==_0x376975(0x25d)){var _0x5588bc=users[_0x376975(0x1e3)];console[_0x376975(0x2cb)](_0x5588bc);}else{if(_0x42036e[0x0][_0x376975(0x23f)]==_0x376975(0x286))var _0x5588bc=users[_0x376975(0x286)];else{if(_0x42036e[0x0][_0x376975(0x23f)]==_0x376975(0x274))var _0x5588bc=users[_0x376975(0x274)];else{if(_0x42036e[0x0][_0x376975(0x23f)]==_0x376975(0x26b))var _0x5588bc=users[_0x376975(0x26b)];else{if(_0x42036e[0x0]['language']==_0x376975(0x281))var _0x5588bc=users[_0x376975(0x281)];else{if(_0x42036e[0x0][_0x376975(0x23f)]==_0x376975(0x263))var _0x5588bc=users[_0x376975(0x22d)];else{if(_0x42036e[0x0][_0x376975(0x23f)]==_0x376975(0x26f))var _0x5588bc=users[_0x376975(0x26f)];else{if(_0x42036e[0x0][_0x376975(0x23f)]==_0x376975(0x1cd))var _0x5588bc=users[_0x376975(0x2e3)];}}}}}}}_0x367f12[_0x376975(0x250)]('return_purchase',{'success':_0x45b362[_0x376975(0x24f)](_0x376975(0x1ea)),'errors':_0x45b362[_0x376975(0x24f)]('errors'),'role':_0x387b90,'profile':_0x2e1f87,'user':_0x50eeea,'stock':_0x3e59ff,'master_shop':_0x42036e,'product':_0x17e65b,'language':_0x5588bc,'warehouse':warehouse_data});}catch(_0x154b7e){console['log'](_0x154b7e);}}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x254),auth,async(_0x5e1270,_0x2f1020)=>{var _0x10799d=a0_0xb9756;try{const {invoice:_0x2f68da,date:_0x334e5f,warehouse_name:_0x455cc4,Room_name:_0xb36b54,product_name:_0x39b584,purchase_quantity:_0x484e76,stocks:_0x31726c,return_qty:_0x35b398,note:_0x13bdea,level:_0x35abf5,isle:_0x5088ee,pallet:_0x47dd5c,to_warehouse_name:_0x3922cd,to_Room_name:_0x30a036}=_0x5e1270[_0x10799d(0x2e1)],_0x3d0eee=await purchases[_0x10799d(0x230)]({'_id':_0x5e1270[_0x10799d(0x207)]['id']}),_0x26df1a=await warehouse[_0x10799d(0x230)]({'name':_0x455cc4,'room':_0xb36b54});if(typeof _0x39b584=='string')var _0x696f91=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x1e9)]],_0x378d89=[_0x5e1270['body']['purchase_quantity']],_0xf54a43=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x246)]],_0x4bc885=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x2af)]],_0x2484b6=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x211)]],_0x200a6d=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x2e0)]],_0x429378=[_0x5e1270['body'][_0x10799d(0x276)]],_0x5168f5=[_0x5e1270['body'][_0x10799d(0x2de)]],_0x49b145=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x2a3)]],_0x85d8bd=[_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x2bc)]],_0x156680=[_0x5e1270['body'][_0x10799d(0x236)]];else var _0x696f91=[..._0x5e1270['body'][_0x10799d(0x1e9)]],_0x378d89=[..._0x5e1270['body']['purchase_quantity']],_0xf54a43=[..._0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x246)]],_0x4bc885=[..._0x5e1270['body']['return_qty']],_0x2484b6=[..._0x5e1270[_0x10799d(0x2e1)]['level']],_0x200a6d=[..._0x5e1270[_0x10799d(0x2e1)]['isle']],_0x429378=[..._0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x276)]],_0x5168f5=[..._0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x2de)]],_0x49b145=[..._0x5e1270['body'][_0x10799d(0x2a3)]],_0x85d8bd=[..._0x5e1270[_0x10799d(0x2e1)]['primary_code_hide']],_0x156680=[..._0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x236)]];const _0x4e4a6b=_0x696f91['map'](_0x52fa37=>{return _0x52fa37={'product_name':_0x52fa37};});_0x378d89[_0x10799d(0x289)]((_0xd2d182,_0x46409c)=>{var _0x4cfce6=_0x10799d;_0x4e4a6b[_0x46409c][_0x4cfce6(0x205)]=_0xd2d182;}),_0xf54a43[_0x10799d(0x289)]((_0x63d19e,_0x3bbebe)=>{_0x4e4a6b[_0x3bbebe]['stock_quantity']=_0x63d19e;}),_0x4bc885[_0x10799d(0x289)]((_0x2b0850,_0x367084)=>{var _0x23ad11=_0x10799d;_0x4e4a6b[_0x367084][_0x23ad11(0x2af)]=_0x2b0850;}),_0x2484b6[_0x10799d(0x289)]((_0xb78cf8,_0x96ac6b)=>{var _0x152162=_0x10799d;_0x4e4a6b[_0x96ac6b][_0x152162(0x2b2)]=_0xb78cf8;}),_0x200a6d[_0x10799d(0x289)]((_0x24c1aa,_0x99e0aa)=>{_0x4e4a6b[_0x99e0aa]['bin']=_0x24c1aa;}),_0x429378['forEach']((_0x12b26c,_0x3ea2a1)=>{var _0x41d30b=_0x10799d;_0x4e4a6b[_0x3ea2a1][_0x41d30b(0x26e)]=_0x12b26c;}),_0x5168f5['forEach']((_0x4b7b9a,_0xa36f03)=>{var _0x137c34=_0x10799d;_0x4e4a6b[_0xa36f03][_0x137c34(0x20c)]=_0x4b7b9a;}),_0x49b145[_0x10799d(0x289)]((_0xf53a76,_0x539f99)=>{var _0x23bcf1=_0x10799d;_0x4e4a6b[_0x539f99][_0x23bcf1(0x2ce)]=_0xf53a76;}),_0x85d8bd[_0x10799d(0x289)]((_0x308471,_0x1c30c8)=>{var _0x147bcd=_0x10799d;_0x4e4a6b[_0x1c30c8][_0x147bcd(0x298)]=_0x308471;}),_0x156680[_0x10799d(0x289)]((_0x24f7e6,_0x31ed51)=>{var _0x33f1d2=_0x10799d;_0x4e4a6b[_0x31ed51][_0x33f1d2(0x24a)]=_0x24f7e6;}),_0x3d0eee[_0x10799d(0x265)][_0x10799d(0x289)](_0x1203cc=>{var _0xdd9906=_0x10799d;const _0x1ec3ec=_0x26df1a['product_details'][_0xdd9906(0x278)](_0x4fb2f2=>{var _0x16299e=_0xdd9906;_0x4fb2f2[_0x16299e(0x1e9)]==_0x1203cc[_0x16299e(0x1e9)]&&_0x4fb2f2['floorlevel']==_0x1203cc[_0x16299e(0x26e)]&&_0x4fb2f2['type']==_0x1203cc[_0x16299e(0x20c)]&&_0x4fb2f2[_0x16299e(0x1ee)]==_0x1203cc[_0x16299e(0x1ee)]&&_0x4fb2f2['bay']==_0x1203cc[_0x16299e(0x2b2)]&&_0x4fb2f2[_0x16299e(0x243)]==_0x1203cc[_0x16299e(0x243)]&&_0x4fb2f2[_0x16299e(0x215)]==_0x1203cc['storage']&&(console[_0x16299e(0x2cb)](parseInt(_0x4fb2f2[_0x16299e(0x226)])+_0x16299e(0x290)+parseInt(_0x1203cc['quantity'])),_0x4fb2f2[_0x16299e(0x226)]=parseInt(_0x4fb2f2[_0x16299e(0x226)])+parseInt(_0x1203cc['quantity']));});}),await _0x26df1a[_0x10799d(0x23e)]();const _0xd88168=_0x4e4a6b[_0x10799d(0x24e)](_0x22d149=>_0x22d149[_0x10799d(0x2af)]!=='0'&&_0x22d149[_0x10799d(0x2af)]!=='');var _0x1df6fd=0x0;_0xd88168[_0x10799d(0x289)](_0x4afb7d=>{var _0x36701d=_0x10799d;console['log'](_0x36701d(0x2e2),_0x4afb7d),(parseInt(_0x4afb7d[_0x36701d(0x205)])<parseInt(_0x4afb7d[_0x36701d(0x2af)])||parseInt(_0x4afb7d[_0x36701d(0x270)])<parseInt(_0x4afb7d[_0x36701d(0x2af)]))&&_0x1df6fd++;});if(_0x1df6fd!=0x0)return _0x5e1270['flash'](_0x10799d(0x25c),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x2f1020[_0x10799d(0x266)](_0x10799d(0x206));const _0x1baf4b=new purchases_return({'invoice':_0x2f68da,'suppliers':_0x5e1270[_0x10799d(0x2e1)]['suppliers'],'date':_0x334e5f,'warehouse_name':_0x455cc4,'return_product':_0xd88168,'note':_0x13bdea,'room':_0xb36b54,'to_warehouse_name':_0x3922cd,'to_room':_0x30a036}),_0x827c94=await _0x1baf4b[_0x10799d(0x23e)]();console['log'](_0x1baf4b);const _0x1d587e=await purchases_return['findOne']({'invoice':_0x2f68da}),_0x50b20b=await warehouse[_0x10799d(0x230)]({'name':_0x3922cd,'room':_0x30a036});_0x1d587e[_0x10799d(0x1da)]['forEach'](_0x31bf06=>{var _0x1c01b9=_0x10799d,_0x378556=0x0;const _0x11a04c=_0x50b20b[_0x1c01b9(0x22f)][_0x1c01b9(0x278)](_0x3617f4=>{var _0xbf972e=_0x1c01b9;_0x3617f4[_0xbf972e(0x1e9)]==_0x31bf06[_0xbf972e(0x1e9)]&&_0x3617f4[_0xbf972e(0x26e)]==_0x31bf06['floorlevel']&&_0x3617f4[_0xbf972e(0x20c)]==_0x31bf06[_0xbf972e(0x20c)]&&_0x3617f4[_0xbf972e(0x1ee)]==_0x31bf06['bin']&&_0x3617f4['bay']==_0x31bf06[_0xbf972e(0x2b2)]&&(_0x3617f4[_0xbf972e(0x226)]=parseInt(_0x3617f4['product_stock'])-parseInt(_0x31bf06[_0xbf972e(0x2af)]),_0x378556++);});_0x378556=='0'&&(_0x50b20b[_0x1c01b9(0x22f)]=_0x50b20b[_0x1c01b9(0x22f)][_0x1c01b9(0x1fc)]({'product_name':_0x31bf06['product_name'],'product_stock':_0x31bf06[_0x1c01b9(0x2af)],'primary_code':_0x31bf06[_0x1c01b9(0x298)],'secondary_code':_0x31bf06['secondary_code'],'product_code':_0x31bf06['product_code'],'storage':_0x31bf06['storage'],'rack':_0x31bf06[_0x1c01b9(0x243)],'bay':_0x31bf06[_0x1c01b9(0x2b2)],'bin':_0x31bf06[_0x1c01b9(0x1ee)],'type':_0x31bf06[_0x1c01b9(0x20c)],'floorlevel':_0x31bf06[_0x1c01b9(0x26e)],'maxProducts':_0x31bf06[_0x1c01b9(0x2ae)],'unit':_0x31bf06[_0x1c01b9(0x2ab)],'secondary_unit':_0x31bf06[_0x1c01b9(0x2c7)],'expiry_date':_0x31bf06['expiry_date']}));}),await _0x50b20b[_0x10799d(0x23e)]();const _0x1f610e=await purchases[_0x10799d(0x230)]({'invoice':_0x2f68da});_0x1f610e[_0x10799d(0x2d0)]=_0x10799d(0x283);const _0x416835=await _0x1f610e['save'](),_0x15b24f=new s_payment_data({'invoice':_0x2f68da,'suppliers':_0x5e1270[_0x10799d(0x2e1)][_0x10799d(0x224)],'reason':'Purchase\x20Return'});await _0x15b24f['save']();const _0x5da51a=await master_shop['find']();console['log']('add\x20post',_0x5da51a[0x0]['image']);const _0x2b6b13=await email_settings[_0x10799d(0x230)](),_0x17513e=await suppliers[_0x10799d(0x230)]({'name':_0x5e1270['body'][_0x10799d(0x224)]});console[_0x10799d(0x2cb)](_0x10799d(0x1dc),_0x17513e);_0x5da51a[0x0]['currency_placement']==0x1?(right_currency=_0x5da51a[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5da51a[0x0][_0x10799d(0x2dc)]);var _0x4f4c6f=_0x696f91,_0x2b8fe3=_0x4bc885,_0x2df568='',_0x2e3626;for(_0x2e3626 in _0x4f4c6f){_0x2df568+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4f4c6f[_0x2e3626]+'</td>'+_0x10799d(0x20e)+_0x2b8fe3[_0x2e3626]+_0x10799d(0x1e7)+_0x10799d(0x2a9);}console[_0x10799d(0x2cb)]('product_list',_0x2df568);let _0x40e873=nodemailer['createTransport']({'service':_0x10799d(0x1ef),'auth':{'user':_0x2b6b13[_0x10799d(0x2c8)],'pass':_0x2b6b13[_0x10799d(0x240)]}}),_0x5d961a={'from':_0x2b6b13['email'],'to':_0x17513e[_0x10799d(0x2c8)],'subject':_0x10799d(0x2a4),'attachments':[{'filename':_0x10799d(0x21d),'path':__dirname+_0x10799d(0x2b1)+_0x10799d(0x1e5)+_0x5da51a[0x0][_0x10799d(0x1ed)],'cid':_0x10799d(0x2aa)}],'html':_0x10799d(0x2da)+_0x10799d(0x27f)+'</head><body>'+_0x10799d(0x282)+_0x10799d(0x1e8)+_0x10799d(0x282)+_0x10799d(0x1d2)+'</div>'+'<div>'+_0x10799d(0x29a)+_0x5da51a[0x0][_0x10799d(0x27a)]+_0x10799d(0x291)+_0x10799d(0x25f)+_0x10799d(0x25f)+_0x10799d(0x28c)+_0x10799d(0x282)+_0x10799d(0x2d5)+_0x10799d(0x29e)+_0x2f68da+'\x20'+_0x10799d(0x2ca)+_0x10799d(0x1d1)+_0x334e5f+'\x20'+'</span>'+_0x10799d(0x2e8)+_0x10799d(0x25f)+_0x10799d(0x214)+_0x10799d(0x2e5)+'<tr>'+_0x10799d(0x26c)+_0x10799d(0x277)+_0x10799d(0x2d6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x10799d(0x2e6)+_0x10799d(0x1f1)+'\x20'+_0x2df568+'\x20'+'</tbody>'+_0x10799d(0x1e2)+_0x10799d(0x282)+_0x10799d(0x2b3)+'<h5>'+_0x5da51a[0x0][_0x10799d(0x27a)]+_0x10799d(0x2e8)+_0x10799d(0x25f)+_0x10799d(0x25f)+_0x10799d(0x269)};_0x40e873[_0x10799d(0x212)](_0x5d961a,function(_0x2ab1f0,_0x5cde83){var _0x49ef46=_0x10799d;_0x2ab1f0?(console[_0x49ef46(0x2cb)](_0x2ab1f0),console['log'](_0x49ef46(0x26a))):console[_0x49ef46(0x2cb)](_0x49ef46(0x267));}),_0x5e1270[_0x10799d(0x24f)](_0x10799d(0x1ea),_0x10799d(0x218)),_0x2f1020[_0x10799d(0x266)](_0x10799d(0x2d7));}catch(_0x4e9d88){console[_0x10799d(0x2cb)](_0x4e9d88),_0x2f1020[_0x10799d(0x242)](0xc8)['json']({'message':_0x4e9d88[_0x10799d(0x295)]});}}),router[a0_0xb9756(0x27e)](a0_0xb9756(0x239),auth,async(_0x2668ae,_0x253a44)=>{var _0x531544=a0_0xb9756;try{const {username:_0x36fb06,email:_0x70ab61,role:_0x43760c}=_0x2668ae[_0x531544(0x200)],_0x24b67c=_0x2668ae[_0x531544(0x200)],_0x3f21a5=await profile[_0x531544(0x230)]({'email':_0x24b67c['email']}),_0x315934=await master_shop[_0x531544(0x2a7)](),_0x1aa90d=_0x2668ae[_0x531544(0x207)]['id'],_0x420aa8=await purchases[_0x531544(0x1fe)](_0x1aa90d);if(_0x315934[0x0][_0x531544(0x23f)]==_0x531544(0x25d))var _0x45f25b=users['English'];else{if(_0x315934[0x0][_0x531544(0x23f)]==_0x531544(0x286))var _0x45f25b=users['Hindi'];else{if(_0x315934[0x0]['language']==_0x531544(0x274))var _0x45f25b=users[_0x531544(0x274)];else{if(_0x315934[0x0]['language']==_0x531544(0x26b))var _0x45f25b=users[_0x531544(0x26b)];else{if(_0x315934[0x0][_0x531544(0x23f)]==_0x531544(0x281))var _0x45f25b=users[_0x531544(0x281)];else{if(_0x315934[0x0][_0x531544(0x23f)]=='Portuguese\x20(BR)')var _0x45f25b=users[_0x531544(0x22d)];else{if(_0x315934[0x0][_0x531544(0x23f)]==_0x531544(0x26f))var _0x45f25b=users[_0x531544(0x26f)];else{if(_0x315934[0x0][_0x531544(0x23f)]==_0x531544(0x1cd))var _0x45f25b=users[_0x531544(0x2e3)];}}}}}}}_0x253a44[_0x531544(0x250)](_0x531544(0x2c1),{'success':_0x2668ae[_0x531544(0x24f)](_0x531544(0x1ea)),'errors':_0x2668ae['flash'](_0x531544(0x25c)),'role':_0x24b67c,'profile':_0x3f21a5,'alldata':_0x420aa8,'master_shop':_0x315934,'language':_0x45f25b}),console[_0x531544(0x2cb)](alldata);}catch(_0x13d888){console[_0x531544(0x2cb)](_0x13d888);}}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x285),async(_0x14f065,_0x326edd)=>{var _0x33f837=a0_0xb9756;const {product_code:_0x45d5a8}=_0x14f065[_0x33f837(0x2e1)];var _0x3e73b2;const _0x41c4a2=await product[_0x33f837(0x221)]([{'$match':{'primary_code':_0x45d5a8,'product_category':_0x33f837(0x1eb)}},{'$group':{'_id':_0x33f837(0x2b4),'name':{'$first':_0x33f837(0x209)},'category':{'$first':_0x33f837(0x2d2)},'brand':{'$first':_0x33f837(0x2c2)},'unit':{'$first':_0x33f837(0x227)},'alertquantity':{'$first':_0x33f837(0x1fa)},'product_code':{'$first':_0x33f837(0x2c5)},'primary_code':{'$first':_0x33f837(0x25b)},'secondary_code':{'$first':_0x33f837(0x2b0)},'maxStocks':{'$first':_0x33f837(0x1e1)},'maxProdPerUnit':{'$first':_0x33f837(0x204)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x33f837(0x2b7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5d08a1=await product['aggregate']([{'$match':{'secondary_code':_0x45d5a8,'product_category':'Raw\x20Materials'}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x33f837(0x227)},'alertquantity':{'$first':_0x33f837(0x1fa)},'product_code':{'$first':_0x33f837(0x2c5)},'primary_code':{'$first':_0x33f837(0x25b)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x33f837(0x1e1)},'maxProdPerUnit':{'$first':_0x33f837(0x204)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x33f837(0x2b7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x41c4a2[_0x33f837(0x2c4)]>0x0)_0x3e73b2=_0x41c4a2;else _0x5d08a1[_0x33f837(0x2c4)]>0x0&&(_0x3e73b2=_0x5d08a1);_0x326edd['json'](_0x3e73b2);}),router[a0_0xb9756(0x2cd)](a0_0xb9756(0x241),async(_0x152101,_0x13f97a)=>{var _0x5bb13c=a0_0xb9756;const {primaryCode:_0x5840b7,secondaryCode:_0x15ae18,productCode:_0x1a051b,bay:_0x5a2a12,bin:_0x227d72,types:_0x241305,pallet:_0x4eeed1,warehouses:_0xe4cae6,room:_0x1f9166}=_0x152101[_0x5bb13c(0x2e1)];console['log'](_0x152101[_0x5bb13c(0x2e1)]);try{const _0x10f684=await warehouse[_0x5bb13c(0x221)]([{'$match':{'name':_0xe4cae6,'room':_0x1f9166}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x5a2a12,'product_details.bin':_0x227d72,'product_details.type':_0x241305}},{'$group':{'_id':_0x5bb13c(0x275),'name':{'$first':_0x5bb13c(0x1d7)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x5bb13c(0x2a6)},'maxProducts':{'$first':_0x5bb13c(0x262)}}}]);_0x13f97a[_0x5bb13c(0x242)](0xc8)[_0x5bb13c(0x297)](_0x10f684);}catch(_0x5f80d1){_0x13f97a[_0x5bb13c(0x242)](0x194)['json']({'message':_0x5f80d1[_0x5bb13c(0x295)]});}}),module[a0_0xb9756(0x296)]=router;