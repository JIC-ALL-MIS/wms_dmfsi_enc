var a0_0x10c38e=a0_0x4df3;(function(_0x44c26e,_0x3447a4){var _0x4aed53=a0_0x4df3,_0x357619=_0x44c26e();while(!![]){try{var _0x528aa7=parseInt(_0x4aed53(0xf9))/0x1*(-parseInt(_0x4aed53(0x19c))/0x2)+-parseInt(_0x4aed53(0x107))/0x3+-parseInt(_0x4aed53(0x138))/0x4+-parseInt(_0x4aed53(0x143))/0x5*(-parseInt(_0x4aed53(0x90))/0x6)+parseInt(_0x4aed53(0x8c))/0x7+-parseInt(_0x4aed53(0x135))/0x8+-parseInt(_0x4aed53(0xc3))/0x9*(-parseInt(_0x4aed53(0x95))/0xa);if(_0x528aa7===_0x3447a4)break;else _0x357619['push'](_0x357619['shift']());}catch(_0xfa36fd){_0x357619['push'](_0x357619['shift']());}}}(a0_0x699b,0x87e3f));const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x10c38e(0x172)),auth=require(a0_0x10c38e(0x197)),nodemailer=require(a0_0x10c38e(0xf5));var ejs=require(a0_0x10c38e(0xad));function a0_0x699b(){var _0x13ca20=['prod_code','product_code_hide','<tbody\x20style=\x22text-align:\x20center;\x22>','storage','currency','stock_quantity','$product_details.pallet','gmail','prod_Qty','$maxStocks','$product_details.product_code','$product_code','$product_details.bin','host','password','../public/language/languages.json','</span>','product_details','Shelves','Purchase\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','master','language','name','types','\x20</h2>','An\x20error\x20occurred.','site_title','$product.bin','Level','prod_name','render','then','findById','$product_details.product_stock','concat','</tbody>','Error\x20Occurs','bin','errors','French','warehouse_name','product_name','alertQTY','Email\x20sent\x20successfully','/view/add_purchases','staff','nodemailer','$unit','secondary_unit','$category','59WsLGzN','table\x20page','all_purchases_barcode','delivery_code','prod_pallet','path','$note','<strong>\x20Regards\x20</strong>','abs','$product_details.rack','message','$product_details.isle','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_invoice','3245061yFsyNO','find','getMonth','$product_details','Chinese','/barcode_scanner','suppliers','/upload/','$invoice','Ambient','/view/add_purchases/:id','True','floor','\x20<\x20wew\x20>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Arabic\x20(ae)','role','</tr>','\x20<>\x20','pallet','$room','delivery_date','save','COLD\x20STORAGE','return_qty','suppliers_docs','<hr\x20class=\x22my-3\x22>','Receiving\x20Area','length','Hindi','Paid\x20For\x20Purchase','An\x20error\x20occurred\x20while\x20saving\x20data.','primary_code_hide','due_amount','<!DOCTYPE\x20html>','$return_data','slice','production_date','$brand','$name','$product_details.level','</td>','string','German','deliverycode','/preview/:id','3527688QUTDOG','$product.bay','$maxProdPerUnit','445720RzQxJm','RMSEmail','isle','DRY\x20STORAGE','$product_details.maxProducts','English\x20(US)','Logo.png','stocks','purchase_quantity','$product.floorlevel','body','18850fMVEyN','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Rack\x20F','$primary_code','foreach\x20newproduct','$product_details.expiry_date','bay','$product_details.primary_code','here','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Rack\x20B','<div>','<h2>\x20','all_purchases','expiry_date','edit_purchases_view','return_product','standard_unit','<h5\x20style=\x22text-align:\x20left;\x22>','paid_amount','max_product_unit','stock_data','Raw\x20Materials','$secondary_unit','RoomAssign','maxStocks','product','catch','$product_details.floorlevel','$product.quantity','$product_details._id','Rack\x20E','level','redirect','<html><head><title></title>','invoice','date','rack','$due_amount','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','room','suppliers_data','actual_qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','aggregate','../models/all_models','Floor','user','$product_details.secondary_code','/give_payment/:id','$product_details.product_name','$product.type','warehouse','/view/:id','quantity','prod_primunit','batch_code','purchase_invoice','findOne','getDate','/all_purchases/view/','Purchase\x20data\x20added\x20successfully','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','forEach','$finalize','currency_placement','</div>','POnumber','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$secondary_code','maxperunit','room_name','status','<tr>','image','$batch_code','rak','secondary_code','$suppliers_docs','success','Return\x20Goods','get','../middleware/auth','$expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</thead>','email','16136KExFHi','<h5>','back','product_list','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$_id','MaxStocks_data','$paid_amount','6901181cebxmV','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','/CheckingWarehouse','Rack\x20A','42XQtdpZ','prod_unit','English','</body></html>','\x20Order\x20Number\x20:\x20','10jIjKTC','Spanish','error','</table>','primary_code','Portuguese\x20(BR)','json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.storage','Enabled','Portuguese','</h5>','floorlevel','\x20Order\x20Date\x20:\x20','/view/return_purchase/:id','prod_qty','$date','prod_secondunit','$product_details.type','type','actual_uom','logo','secondary_code_hide','sendMail','ejs','$product_details.bay','product_stock','filter','purchases\x20item\x20return\x20successfull','params','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_code','$alertquantity','INC-','createTransport','post','$suppliers','/all_purchases/view','return_purchase','prod_isle','Rack\x20D','Arabic','prod_level','log','There\x27s\x20a\x20error\x20in\x20this\x20transaction','14889816ELPGzI','map','purchase\x20data\x20update\x20successfully'];a0_0x699b=function(){return _0x13ca20;};return a0_0x699b();}const path=require(a0_0x10c38e(0xfe)),users=require(a0_0x10c38e(0xd5));router['get']('/view',auth,async(_0x29bb7f,_0x1b574)=>{var _0x49b5b8=a0_0x10c38e;try{const {username:_0x492f91,email:_0x11ef3b,role:_0x1084e5}=_0x29bb7f['user'],_0x4349f3=_0x29bb7f[_0x49b5b8(0x174)],_0x2b7b07=await profile['findOne']({'email':_0x4349f3[_0x49b5b8(0x19b)]}),_0x18ad8c=await staff[_0x49b5b8(0x17f)]({'email':_0x4349f3['email']});if(_0x4349f3[_0x49b5b8(0x117)]==_0x49b5b8(0xf4)){const _0x2d1b8c=await staff[_0x49b5b8(0x17f)]({'email':_0x4349f3[_0x49b5b8(0x19b)]});}const _0x5b0298=await master_shop[_0x49b5b8(0x108)]();let _0xbc93fe;if(_0x4349f3['role']==_0x49b5b8(0xf4)){const _0x42de05=await staff[_0x49b5b8(0x17f)]({'email':_0x4349f3['email']});_0xbc93fe=await purchases[_0x49b5b8(0x171)]([{'$match':{'warehouse_name':_0x42de05[_0x49b5b8(0x179)]}},{'$lookup':{'from':_0x49b5b8(0x10d),'localField':_0x49b5b8(0x10d),'foreignField':_0x49b5b8(0xdd),'as':_0x49b5b8(0x120)}},{'$unwind':_0x49b5b8(0x193)},{'$unwind':'$product'},{'$group':{'_id':_0x49b5b8(0x1a2),'invoice':{'$first':_0x49b5b8(0x10f)},'suppliers':{'$first':_0x49b5b8(0xba)},'date':{'$first':_0x49b5b8(0xa5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x49b5b8(0x11b)},'product':{'$push':'$product'},'note':{'$first':_0x49b5b8(0xff)},'paid_amount':{'$first':_0x49b5b8(0x1a4)},'due_amount':{'$first':_0x49b5b8(0x169)},'return_data':{'$first':_0x49b5b8(0x12a)},'batch_code':{'$first':_0x49b5b8(0x190)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x49b5b8(0x160)},'level':{'$addToSet':_0x49b5b8(0x136)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x49b5b8(0x141)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xbc93fe=await purchases[_0x49b5b8(0x171)]([{'$lookup':{'from':_0x49b5b8(0x10d),'localField':_0x49b5b8(0x10d),'foreignField':_0x49b5b8(0xdd),'as':_0x49b5b8(0x120)}},{'$unwind':_0x49b5b8(0x193)},{'$unwind':'$product'},{'$group':{'_id':_0x49b5b8(0x1a2),'invoice':{'$first':_0x49b5b8(0x10f)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x49b5b8(0xa5)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x49b5b8(0xff)},'paid_amount':{'$first':_0x49b5b8(0x1a4)},'due_amount':{'$first':_0x49b5b8(0x169)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x49b5b8(0x190)},'expiry_date':{'$first':_0x49b5b8(0x198)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x49b5b8(0x160)},'level':{'$addToSet':_0x49b5b8(0x136)},'isle':{'$addToSet':_0x49b5b8(0xe2)},'type':{'$addToSet':_0x49b5b8(0x178)},'floorlevel':{'$addToSet':_0x49b5b8(0x141)},'finalize':{'$first':_0x49b5b8(0x185)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x5b0298[0x0][_0x49b5b8(0xdc)]==_0x49b5b8(0x13d)){var _0x1e5bbc=users[_0x49b5b8(0x92)];console[_0x49b5b8(0xc1)](_0x1e5bbc);}else{if(_0x5b0298[0x0]['language']==_0x49b5b8(0x124))var _0x1e5bbc=users['Hindi'];else{if(_0x5b0298[0x0][_0x49b5b8(0xdc)]==_0x49b5b8(0x132))var _0x1e5bbc=users['German'];else{if(_0x5b0298[0x0][_0x49b5b8(0xdc)]==_0x49b5b8(0x96))var _0x1e5bbc=users[_0x49b5b8(0x96)];else{if(_0x5b0298[0x0][_0x49b5b8(0xdc)]==_0x49b5b8(0xee))var _0x1e5bbc=users[_0x49b5b8(0xee)];else{if(_0x5b0298[0x0]['language']==_0x49b5b8(0x9a))var _0x1e5bbc=users[_0x49b5b8(0x9f)];else{if(_0x5b0298[0x0][_0x49b5b8(0xdc)]==_0x49b5b8(0x10b))var _0x1e5bbc=users[_0x49b5b8(0x10b)];else{if(_0x5b0298[0x0][_0x49b5b8(0xdc)]==_0x49b5b8(0x116))var _0x1e5bbc=users[_0x49b5b8(0xbf)];}}}}}}}_0x1b574[_0x49b5b8(0xe5)](_0x49b5b8(0x150),{'success':_0x29bb7f[_0x49b5b8(0xb3)]('success'),'errors':_0x29bb7f[_0x49b5b8(0xb3)]('errors'),'purchases':_0xbc93fe,'role':_0x4349f3,'profile':_0x2b7b07,'master_shop':_0x5b0298,'language':_0x1e5bbc});}catch(_0xc2d48b){console['log'](_0x49b5b8(0xfa),_0xc2d48b),_0x1b574[_0x49b5b8(0x18d)](0xc8)[_0x49b5b8(0x9b)]({'message':_0xc2d48b[_0x49b5b8(0x103)]});}});function BayBinSelected(_0x54de91,_0x313560){var _0x25d8cd=a0_0x10c38e,_0x460452=[],_0x2ace1f=[],_0x4d9d00=[],_0x568367=[],_0x1f6b73=[],_0x23d7b7=[];let _0x5a2edc=[];if(_0x54de91==_0x25d8cd(0x13b))switch(_0x313560){case _0x25d8cd(0x8f):_0x460452=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2ace1f=[0x1,0x2],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0xe3),_0x25d8cd(0x173)],_0x1f6b73=['D'],_0x23d7b7=['A'];break;case _0x25d8cd(0x14d):_0x460452=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2ace1f=[0x1,0x2],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0xe3),_0x25d8cd(0x173)],_0x1f6b73=['D'],_0x23d7b7=['B'];break;case _0x25d8cd(0xd8):_0x460452=[0x0],_0x2ace1f=[0x0],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0x173)],_0x1f6b73=['D'],_0x23d7b7=['S'];break;case _0x25d8cd(0x122):_0x460452=[0x0],_0x2ace1f=[0x0],_0x568367=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4d9d00=['Floor'],_0x1f6b73=['D'],_0x23d7b7=['R'];break;}else{if(_0x54de91==_0x25d8cd(0x11e))switch(_0x313560){case _0x25d8cd(0x8f):_0x460452=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2ace1f=['B','F'],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0xe3),_0x25d8cd(0x173)],_0x1f6b73=['C'],_0x23d7b7=['A'];break;case'Rack\x20B':_0x460452=[0x5,0x4,0x3,0x2,0x1],_0x2ace1f=['F','B','S'],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0xe3),_0x25d8cd(0x173)],_0x1f6b73=['C'],_0x23d7b7=['B'];break;case'Rack\x20C':_0x460452=[0x1,0x2,0x3,0x4,0x5],_0x2ace1f=['B','F','S'],_0x568367=[0x5,0x4,0x3,0x2,0x1],_0x4d9d00=[_0x25d8cd(0xe3),_0x25d8cd(0x173)],_0x1f6b73=['C'],_0x23d7b7=['C'];break;case _0x25d8cd(0xbe):_0x460452=[0x5,0x4,0x3,0x2,0x1],_0x2ace1f=['F','B','S'],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0xe3),_0x25d8cd(0x173)],_0x1f6b73=['C'],_0x23d7b7=['D'];break;case _0x25d8cd(0x162):_0x460452=[0x4,0x3,0x2,0x1],_0x2ace1f=[0x1,0x2],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=['Level','Floor'],_0x1f6b73=['C'],_0x23d7b7=['E'];break;case _0x25d8cd(0x145):_0x460452=[0x1,0x2,0x3],_0x2ace1f=[0x1,0x2],_0x568367=[0x1,0x2,0x3,0x4,0x5],_0x4d9d00=[_0x25d8cd(0xe3)],_0x1f6b73=['C'],_0x23d7b7=['F'];break;}}return{'levels':_0x460452,'Isle':_0x2ace1f,'rack':_0x568367,'type':_0x4d9d00,'storage':_0x1f6b73,'rak':_0x23d7b7};}async function getRandom8DigitNumber(){var _0x91877b=a0_0x10c38e;const _0x45e6a8=0x989680,_0x578f9d=0x5f5e0ff,_0x20f1f9=Math[_0x91877b(0x113)](Math['random']()*(_0x578f9d-_0x45e6a8+0x1))+_0x45e6a8;var _0x5816c7;const _0x135add=await purchases[_0x91877b(0x17f)]({'invoice':_0x91877b(0xb7)+_0x20f1f9});return _0x135add&&_0x135add[_0x91877b(0x123)]>0x0?_0x5816c7=_0x91877b(0xb7)+_0x20f1f9:_0x5816c7=_0x91877b(0xb7)+_0x20f1f9,_0x5816c7;}function a0_0x4df3(_0x42a8f0,_0x1e10ad){var _0x699b89=a0_0x699b();return a0_0x4df3=function(_0x4df341,_0x303c5f){_0x4df341=_0x4df341-0x8c;var _0x58acca=_0x699b89[_0x4df341];return _0x58acca;},a0_0x4df3(_0x42a8f0,_0x1e10ad);}router[a0_0x10c38e(0x196)](a0_0x10c38e(0xf3),auth,async(_0xf8b3b0,_0x41ed2e)=>{var _0x3df564=a0_0x10c38e;try{const {username:_0x1392e3,email:_0x45acc6,role:_0x1d96e5}=_0xf8b3b0[_0x3df564(0x174)],_0x40dded=_0xf8b3b0[_0x3df564(0x174)],_0x5e34b5=await profile[_0x3df564(0x17f)]({'email':_0x40dded[_0x3df564(0x19b)]}),_0x92d71=await master_shop['find'](),_0x1a0679=await staff[_0x3df564(0x17f)]({'email':_0x40dded['email']}),_0x44392b=await suppliers[_0x3df564(0x108)]({});let _0x20215d;if(_0x40dded[_0x3df564(0x117)]==_0x3df564(0xf4)){const _0x56bf58=await staff[_0x3df564(0x17f)]({'email':_0x40dded[_0x3df564(0x19b)]});_0x20215d=await warehouse[_0x3df564(0x171)]([{'$match':{'status':_0x3df564(0x9e),'name':_0x56bf58['warehouse'],'warehouse_category':_0x3df564(0x159),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x3df564(0x12e),'name':{'$first':_0x3df564(0x12e)}}}]);}else _0x20215d=await warehouse['aggregate']([{'$match':{'status':_0x3df564(0x9e),'warehouse_category':_0x3df564(0x159),'name':{'$ne':_0x3df564(0x195)}}},{'$group':{'_id':_0x3df564(0x12e),'name':{'$first':_0x3df564(0x12e)}}}]);const _0x40b77d=await product[_0x3df564(0x108)]({}),_0x918645=await warehouse[_0x3df564(0x108)]({'status':_0x3df564(0x9e)}),_0x925d0b=await purchases[_0x3df564(0x108)]({}),_0x58f0c6=_0x925d0b['length']+0x1,_0xa2967a='INC-'+_0x58f0c6['toString']()['padStart'](0x5,'0');var _0x5c9eb6=[_0x3df564(0x110),_0x3df564(0x16a)];if(_0x92d71[0x0][_0x3df564(0xdc)]==_0x3df564(0x13d))var _0x38ef83=users[_0x3df564(0x92)];else{if(_0x92d71[0x0][_0x3df564(0xdc)]=='Hindi')var _0x38ef83=users[_0x3df564(0x124)];else{if(_0x92d71[0x0][_0x3df564(0xdc)]==_0x3df564(0x132))var _0x38ef83=users['German'];else{if(_0x92d71[0x0][_0x3df564(0xdc)]=='Spanish')var _0x38ef83=users['Spanish'];else{if(_0x92d71[0x0]['language']==_0x3df564(0xee))var _0x38ef83=users[_0x3df564(0xee)];else{if(_0x92d71[0x0][_0x3df564(0xdc)]=='Portuguese\x20(BR)')var _0x38ef83=users[_0x3df564(0x9f)];else{if(_0x92d71[0x0]['language']==_0x3df564(0x10b))var _0x38ef83=users[_0x3df564(0x10b)];else{if(_0x92d71[0x0]['language']==_0x3df564(0x116))var _0x38ef83=users[_0x3df564(0xbf)];}}}}}}}const _0x1166b5=getRandom8DigitNumber();_0x1166b5[_0x3df564(0xe6)](_0x2b5c8d=>{var _0x5f12ca=_0x3df564;_0x41ed2e[_0x5f12ca(0xe5)]('add_purchases',{'success':_0xf8b3b0[_0x5f12ca(0xb3)](_0x5f12ca(0x194)),'errors':_0xf8b3b0[_0x5f12ca(0xb3)](_0x5f12ca(0xed)),'role':_0x40dded,'profile':_0x5e34b5,'suppliers':_0x44392b,'warehouse':_0x20215d,'product':_0x40b77d,'invoice':_0x2b5c8d,'master_shop':_0x92d71,'language':_0x38ef83,'find_data':_0x918645,'rooms_data':_0x5c9eb6});})[_0x3df564(0x15e)](_0x5ead19=>{var _0x50ee26=_0x3df564;_0xf8b3b0[_0x50ee26(0xb3)](_0x50ee26(0xed),_0x50ee26(0xc2)),_0x41ed2e[_0x50ee26(0x164)](_0x50ee26(0xbb));});}catch(_0x1e8e85){console['log'](_0x1e8e85);}}),router[a0_0x10c38e(0x196)](a0_0x10c38e(0x111),auth,async(_0xbd9cb,_0x484869)=>{var _0x435da0=a0_0x10c38e;try{const _0x464a8d=_0xbd9cb[_0x435da0(0xb2)]['id'];console['log'](_0x464a8d);const _0x51769c=await master_shop[_0x435da0(0x108)]();console[_0x435da0(0xc1)](_0x435da0(0xdb),_0x51769c);const _0x472682=await product[_0x435da0(0x17f)]({'name':_0x464a8d});console['log'](_0x435da0(0x15d),_0x472682),_0x484869[_0x435da0(0x18d)](0xc8)[_0x435da0(0x9b)]({'product_data':_0x472682,'master':_0x51769c});}catch(_0x412c38){console[_0x435da0(0xc1)]('add_purchases\x20error',_0x412c38);}}),router['post']('/view/add_purchases',auth,async(_0x96eed4,_0x84f73a)=>{var _0x2d8c6e=a0_0x10c38e;try{const {invoice:_0x30aaf3,date:_0xf5becf,warehouse_name:_0x1faf4b,prod_name:_0x35d6e7,prod_code:_0x3f48c4,prod_qty:_0x38fc6e,prod_unit:_0x15fd1c,prod_secondunit:_0x4d1cef,prod_level:_0x1217be,prod_isle:_0x2516dc,prod_pallet:_0x17bdcf,note:_0x46cd22,expiry_date:_0x22e8a6,batch_code:_0x251697,payable:_0x4037b9,due_amount:_0x530b64,Room_name:_0x3a48f9,primary_code:_0x589d1d,secondary_code:_0x5b10f1,MaxStocks_data:_0x164320,PO_number:_0x2edc0a,SCRN:_0x5165d3,JO_number:_0x256d80}=_0x96eed4[_0x2d8c6e(0x142)];if(typeof _0x35d6e7==_0x2d8c6e(0x131))var _0x3409f9=[_0x96eed4['body'][_0x2d8c6e(0xe4)]],_0x14e27b=[_0x96eed4[_0x2d8c6e(0x142)]['prod_code']],_0x110852=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xce)]],_0x5362d1=[_0x96eed4['body'][_0x2d8c6e(0x17c)]],_0x3f0a27=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xa6)]],_0x57f0f3=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xc0)]],_0x5db2da=[_0x96eed4['body'][_0x2d8c6e(0x99)]],_0x283e63=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x192)]],_0x5a05df=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x1a3)]],_0xd5cad3=[_0x96eed4[_0x2d8c6e(0x142)]['batch_code']],_0x57b0ea=[_0x96eed4['body'][_0x2d8c6e(0x151)]],_0x34088c=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x157)]],_0x4c88b8=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xf1)]],_0x251957=[_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x12c)]],_0xa35f1e=[_0x96eed4['body']['prod_cat']],_0x19498d=[_0x96eed4[_0x2d8c6e(0x142)]['RoomAssign']],_0x1fbdf1=[_0x96eed4[_0x2d8c6e(0x142)]['deliverycode']],_0x46ea04=[_0x96eed4['body'][_0x2d8c6e(0x106)]],_0x1dfa08=[_0x96eed4['body'][_0x2d8c6e(0x16f)]],_0x3030db=[_0x96eed4['body']['actual_uom']];else var _0x3409f9=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xe4)]],_0x14e27b=[..._0x96eed4['body'][_0x2d8c6e(0xc6)]],_0x110852=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xce)]],_0x5362d1=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x17c)]],_0x3f0a27=[..._0x96eed4[_0x2d8c6e(0x142)]['prod_secondunit']],_0x57f0f3=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xc0)]],_0x5db2da=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x99)]],_0x283e63=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x192)]],_0x5a05df=[..._0x96eed4['body']['MaxStocks_data']],_0xd5cad3=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x17d)]],_0x57b0ea=[..._0x96eed4[_0x2d8c6e(0x142)]['expiry_date']],_0x34088c=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x157)]],_0x4c88b8=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0xf1)]],_0x251957=[..._0x96eed4['body'][_0x2d8c6e(0x12c)]],_0xa35f1e=[..._0x96eed4[_0x2d8c6e(0x142)]['prod_cat']],_0x19498d=[..._0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x15b)]],_0x1fbdf1=[..._0x96eed4['body'][_0x2d8c6e(0x133)]],_0x46ea04=[..._0x96eed4[_0x2d8c6e(0x142)]['prod_invoice']],_0x1dfa08=[..._0x96eed4[_0x2d8c6e(0x142)]['actual_qty']],_0x3030db=[..._0x96eed4[_0x2d8c6e(0x142)]['actual_uom']];const _0x296d19=_0x3409f9[_0x2d8c6e(0xc4)](_0x1a3446=>{return _0x1a3446={'product_name':_0x1a3446};});_0x1dfa08[_0x2d8c6e(0x184)]((_0x5e523d,_0x44e11e)=>{var _0x521c96=_0x2d8c6e;_0x296d19[_0x44e11e][_0x521c96(0x16f)]=Math[_0x521c96(0x101)](_0x5e523d);}),_0x3030db[_0x2d8c6e(0x184)]((_0x409600,_0x33f437)=>{var _0x4a82e8=_0x2d8c6e;_0x296d19[_0x33f437][_0x4a82e8(0xa9)]=_0x409600;}),_0x14e27b['forEach']((_0x6d22a7,_0x3b9ae8)=>{var _0x5efd01=_0x2d8c6e;_0x296d19[_0x3b9ae8][_0x5efd01(0xb5)]=_0x6d22a7;}),_0x110852['forEach']((_0x3788de,_0x4a0c26)=>{var _0x5bedb9=_0x2d8c6e;_0x296d19[_0x4a0c26]['quantity']=Math[_0x5bedb9(0x101)](_0x3788de);}),_0x5362d1[_0x2d8c6e(0x184)]((_0x1bf3dc,_0x129c8a)=>{var _0x40634c=_0x2d8c6e;_0x296d19[_0x129c8a][_0x40634c(0x154)]=_0x1bf3dc;}),_0x3f0a27[_0x2d8c6e(0x184)]((_0xf489ad,_0x364032)=>{var _0x36fd05=_0x2d8c6e;_0x296d19[_0x364032][_0x36fd05(0xf7)]=_0xf489ad;}),_0x57f0f3[_0x2d8c6e(0x184)]((_0x17e56e,_0x1b7c85)=>{_0x19498d['forEach']((_0x37f9f1,_0x55f635)=>{var _0x46cc01=a0_0x4df3;if(_0x37f9f1==_0x46cc01(0x122)&&_0x1b7c85==_0x55f635){console['log'](_0x37f9f1+_0x46cc01(0x114)+_0x1b7c85+_0x46cc01(0x119)+_0x55f635+_0x46cc01(0x119)+_0x17e56e);var _0xe9cd76=_0x17e56e[_0x46cc01(0x12b)](0x3);_0x296d19[_0x1b7c85][_0x46cc01(0xc9)]=_0x17e56e[0x0],_0x296d19[_0x1b7c85][_0x46cc01(0x168)]=_0x17e56e[0x1],_0x296d19[_0x1b7c85][_0x46cc01(0x149)]=0x0,_0x296d19[_0x1b7c85][_0x46cc01(0xec)]=0x0,_0x296d19[_0x1b7c85][_0x46cc01(0xa8)]=_0x46cc01(0x173),_0x296d19[_0x1b7c85][_0x46cc01(0xa1)]=_0xe9cd76;}else{if(_0x37f9f1==_0x46cc01(0xd8)&&_0x1b7c85==_0x55f635){var _0xe9cd76=_0x17e56e[_0x46cc01(0x12b)](0x3);_0x296d19[_0x1b7c85][_0x46cc01(0xc9)]=_0x17e56e[0x0],_0x296d19[_0x1b7c85]['rack']=_0x17e56e[0x1],_0x296d19[_0x1b7c85][_0x46cc01(0x149)]=0x0,_0x296d19[_0x1b7c85][_0x46cc01(0xec)]=0x0,_0x296d19[_0x1b7c85][_0x46cc01(0xa8)]=_0x46cc01(0x173),_0x296d19[_0x1b7c85][_0x46cc01(0xa1)]=_0x17e56e[0x5];}else{if(_0x1b7c85==_0x55f635){if(_0x17e56e[0x0]=='A'&&_0x17e56e[0x1]=='L'&&_0x17e56e[0x2]=='L')console[_0x46cc01(0xc1)](_0x37f9f1+_0x46cc01(0x119)+_0x1b7c85+_0x46cc01(0x119)+_0x55f635+'\x20<>\x20'+_0x17e56e+_0x46cc01(0x14b)),_0x296d19[_0x1b7c85][_0x46cc01(0xc9)]=_0x17e56e[0x0],_0x296d19[_0x1b7c85][_0x46cc01(0x168)]=_0x17e56e[0x1],_0x296d19[_0x1b7c85][_0x46cc01(0x149)]=0x0,_0x296d19[_0x1b7c85][_0x46cc01(0xec)]=0x0,_0x296d19[_0x1b7c85][_0x46cc01(0xa8)]=_0x46cc01(0x173),_0x296d19[_0x1b7c85][_0x46cc01(0xa1)]=_0x17e56e[0x3];else{var _0x2e2a35;if(_0x17e56e[0x4]=='L')_0x2e2a35=_0x46cc01(0xe3);else _0x17e56e[0x4]=='F'&&(_0x2e2a35=_0x46cc01(0x173));_0x296d19[_0x1b7c85][_0x46cc01(0xc9)]=_0x17e56e[0x0],_0x296d19[_0x1b7c85][_0x46cc01(0x168)]=_0x17e56e[0x1],_0x296d19[_0x1b7c85]['bay']=_0x17e56e[0x2],_0x296d19[_0x1b7c85][_0x46cc01(0xec)]=_0x17e56e[0x3],_0x296d19[_0x1b7c85][_0x46cc01(0xa8)]=_0x2e2a35,_0x296d19[_0x1b7c85][_0x46cc01(0xa1)]=_0x17e56e[0x5];}}}}});}),_0x5db2da[_0x2d8c6e(0x184)]((_0x42a4f2,_0x3e8582)=>{var _0x5b91f2=_0x2d8c6e;_0x296d19[_0x3e8582][_0x5b91f2(0x99)]=_0x42a4f2;}),_0x283e63[_0x2d8c6e(0x184)]((_0x1a4db5,_0x1ab783)=>{var _0x26c982=_0x2d8c6e;_0x296d19[_0x1ab783][_0x26c982(0x192)]=_0x1a4db5;}),_0x5a05df[_0x2d8c6e(0x184)]((_0x591fcc,_0x4c5d4c)=>{var _0x53f876=_0x2d8c6e;_0x296d19[_0x4c5d4c][_0x53f876(0x15c)]=_0x591fcc;}),_0xd5cad3[_0x2d8c6e(0x184)]((_0x54d12f,_0x3d6782)=>{var _0x62bfb0=_0x2d8c6e;_0x296d19[_0x3d6782][_0x62bfb0(0x17d)]=_0x54d12f;}),_0x57b0ea['forEach']((_0x2d6b2a,_0x5446d9)=>{var _0x12ef0e=_0x2d8c6e;_0x296d19[_0x5446d9][_0x12ef0e(0x151)]=_0x2d6b2a;}),_0x34088c['forEach']((_0x1e745e,_0x852f02)=>{_0x296d19[_0x852f02]['maxperunit']=_0x1e745e;}),_0x4c88b8[_0x2d8c6e(0x184)]((_0x6eaf63,_0xa4a9ce)=>{var _0x5c6b53=_0x2d8c6e;_0x296d19[_0xa4a9ce][_0x5c6b53(0xf1)]=_0x6eaf63;}),_0x251957[_0x2d8c6e(0x184)]((_0xaa94b9,_0x20b0d2)=>{var _0x3c8a2f=_0x2d8c6e;_0x296d19[_0x20b0d2][_0x3c8a2f(0x12c)]=_0xaa94b9;}),_0xa35f1e['forEach']((_0x5d28fe,_0x37e610)=>{_0x296d19[_0x37e610]['product_cat']=_0x5d28fe;}),_0x19498d[_0x2d8c6e(0x184)]((_0x6ef4b9,_0x4e4116)=>{var _0x5103c7=_0x2d8c6e;_0x296d19[_0x4e4116][_0x5103c7(0x18c)]=_0x6ef4b9;}),_0x1fbdf1[_0x2d8c6e(0x184)]((_0x4ee9aa,_0x96ae76)=>{var _0x1f80fb=_0x2d8c6e;_0x296d19[_0x96ae76][_0x1f80fb(0xfc)]=_0x4ee9aa;}),_0x46ea04[_0x2d8c6e(0x184)]((_0x460c7d,_0x39315c)=>{_0x296d19[_0x39315c]['invoice']=_0x460c7d;});const _0x34ba8d=_0x19498d['map'](_0x2775b2=>{return _0x2775b2={'room_name':_0x2775b2};}),_0x4b0b51=_0x296d19[_0x2d8c6e(0xb0)](_0x2ef2eb=>_0x2ef2eb[_0x2d8c6e(0x17b)]!=='0'&&_0x2ef2eb[_0x2d8c6e(0x17b)]!==''),_0x4581fc=new purchases({'invoice':_0x30aaf3,'suppliers':_0x96eed4[_0x2d8c6e(0x142)][_0x2d8c6e(0x10d)],'date':_0xf5becf,'warehouse_name':_0x1faf4b,'product':_0x4b0b51,'note':_0x46cd22,'due_amount':_0x530b64,'POnumber':_0x2edc0a,'SCRN':_0x5165d3,'JO_number':_0x256d80,'roomList':_0x34ba8d}),_0x477ff6=await _0x4581fc[_0x2d8c6e(0x11d)](),_0x85cdcd=await purchases[_0x2d8c6e(0x17f)]({'invoice':_0x30aaf3}),_0x5c87c0=_0x85cdcd[_0x2d8c6e(0x15d)]['map'](async _0x3cea61=>{var _0x46dac9=_0x2d8c6e,_0x3b63f6=await warehouse['findOne']({'name':_0x1faf4b,'room':_0x3cea61['room_name']}),_0x4bf3ce=0x0;return _0x3b63f6[_0x46dac9(0xd7)][_0x46dac9(0x184)](_0x5946a9=>{var _0x15aeff=_0x46dac9;_0x5946a9[_0x15aeff(0xf0)]==_0x3cea61[_0x15aeff(0xf0)]&&_0x5946a9[_0x15aeff(0xa1)]==_0x3cea61[_0x15aeff(0xa1)]&&_0x5946a9['type']==_0x3cea61[_0x15aeff(0xa8)]&&_0x5946a9[_0x15aeff(0xec)]==_0x3cea61['bin']&&_0x5946a9[_0x15aeff(0x149)]==_0x3cea61['bay']&&_0x5946a9[_0x15aeff(0x168)]==_0x3cea61['rack']&&_0x5946a9[_0x15aeff(0xc9)]==_0x3cea61[_0x15aeff(0xc9)]&&_0x5946a9['expiry_date']==_0x3cea61[_0x15aeff(0x151)]&&_0x5946a9[_0x15aeff(0x17d)]==_0x3cea61['batch_code']&&_0x5946a9[_0x15aeff(0x12c)]==_0x3cea61['production_date']&&_0x5946a9[_0x15aeff(0x166)]==_0x85cdcd['invoice']&&(_0x5946a9['product_stock']+=Math[_0x15aeff(0x101)](_0x3cea61['quantity']),_0x4bf3ce++);}),_0x4bf3ce===0x0&&_0x3b63f6[_0x46dac9(0xd7)]['push']({'product_name':_0x3cea61[_0x46dac9(0xf0)],'product_stock':Math[_0x46dac9(0x101)](_0x3cea61['quantity']),'primary_code':_0x3cea61[_0x46dac9(0x99)],'secondary_code':_0x3cea61[_0x46dac9(0x192)],'product_code':_0x3cea61['product_code'],'storage':_0x3cea61[_0x46dac9(0xc9)],'rack':_0x3cea61[_0x46dac9(0x168)],'bay':_0x3cea61['bay'],'bin':_0x3cea61[_0x46dac9(0xec)],'type':_0x3cea61[_0x46dac9(0xa8)],'floorlevel':_0x3cea61['floorlevel'],'maxProducts':_0x3cea61['maxStocks'],'unit':_0x3cea61[_0x46dac9(0x154)],'secondary_unit':_0x3cea61[_0x46dac9(0xf7)],'expiry_date':_0x3cea61[_0x46dac9(0x151)],'maxPerUnit':_0x3cea61[_0x46dac9(0x18b)],'batch_code':_0x3cea61[_0x46dac9(0x17d)],'alertQTY':_0x3cea61[_0x46dac9(0xf1)],'production_date':_0x3cea61[_0x46dac9(0x12c)],'product_cat':_0x3cea61['product_cat'],'invoice':_0x3cea61[_0x46dac9(0x166)],'actual_qty':Math[_0x46dac9(0x101)](_0x3cea61['actual_qty']),'actual_uom':_0x3cea61[_0x46dac9(0xa9)]}),_0x3b63f6;});Promise['all'](_0x5c87c0)[_0x2d8c6e(0xe6)](async _0x235d2e=>{var _0xbeb1a6=_0x2d8c6e;try{for(const _0x3839b3 of _0x235d2e){await _0x3839b3[_0xbeb1a6(0x11d)]();}const _0x294fa0=await master_shop[_0xbeb1a6(0x108)](),_0x4b2cc3=await email_settings[_0xbeb1a6(0x17f)](),_0x58205e=await supervisor_settings[_0xbeb1a6(0x108)]();var _0xafeb0=_0x85cdcd[_0xbeb1a6(0x15d)],_0x1dde39='',_0x2856d7;for(_0x2856d7 in _0xafeb0){_0x1dde39+=_0xbeb1a6(0x18e)+_0xbeb1a6(0x189)+_0xafeb0[_0x2856d7][_0xbeb1a6(0xf0)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xafeb0[_0x2856d7][_0xbeb1a6(0xb5)]+_0xbeb1a6(0x130)+_0xbeb1a6(0x189)+_0xafeb0[_0x2856d7][_0xbeb1a6(0x17b)]+'</td>'+_0xbeb1a6(0x189)+_0xafeb0[_0x2856d7][_0xbeb1a6(0x154)]+_0xbeb1a6(0x130)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xafeb0[_0x2856d7][_0xbeb1a6(0xf7)]+_0xbeb1a6(0x130)+_0xbeb1a6(0x189)+_0x85cdcd[_0xbeb1a6(0xef)]+_0xbeb1a6(0x130)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xafeb0[_0x2856d7][_0xbeb1a6(0x18c)]+_0xbeb1a6(0x130)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xafeb0[_0x2856d7]['storage']+_0xafeb0[_0x2856d7]['rack']+_0xafeb0[_0x2856d7][_0xbeb1a6(0x149)]+_0xafeb0[_0x2856d7][_0xbeb1a6(0xec)]+_0xafeb0[_0x2856d7]['type'][0x0]+_0xafeb0[_0x2856d7][_0xbeb1a6(0xa1)]+'</td>',_0xbeb1a6(0x118);}let _0x226bb5=nodemailer[_0xbeb1a6(0xb8)]({'host':_0x4b2cc3[_0xbeb1a6(0xd3)],'port':Number(_0x4b2cc3['port']),'secure':![],'auth':{'user':_0x4b2cc3[_0xbeb1a6(0x19b)],'pass':_0x4b2cc3[_0xbeb1a6(0xd4)]}}),_0x3f3436={'from':_0x4b2cc3[_0xbeb1a6(0x19b)],'to':_0x58205e[0x0][_0xbeb1a6(0x139)],'subject':_0xbeb1a6(0xd9),'attachments':[{'filename':_0xbeb1a6(0x13e),'path':__dirname+'/../public'+'/upload/'+_0x294fa0[0x0][_0xbeb1a6(0x18f)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0xbeb1a6(0x165)+'</head><body>'+_0xbeb1a6(0x14e)+_0xbeb1a6(0x105)+_0xbeb1a6(0x14e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+'<div>'+'<h2>\x20'+_0x294fa0[0x0][_0xbeb1a6(0xe1)]+_0xbeb1a6(0xdf)+_0xbeb1a6(0x187)+_0xbeb1a6(0x187)+_0xbeb1a6(0x121)+_0xbeb1a6(0x14e)+_0xbeb1a6(0x155)+_0xbeb1a6(0x94)+_0x85cdcd[_0xbeb1a6(0x166)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0xbeb1a6(0xa2)+_0x85cdcd[_0xbeb1a6(0x167)]+'\x20'+'</span>'+_0xbeb1a6(0xa0)+_0xbeb1a6(0x187)+_0xbeb1a6(0x170)+_0xbeb1a6(0x1a1)+_0xbeb1a6(0x18e)+_0xbeb1a6(0xda)+_0xbeb1a6(0x115)+_0xbeb1a6(0x14c)+_0xbeb1a6(0x8d)+_0xbeb1a6(0x1a0)+_0xbeb1a6(0xb4)+_0xbeb1a6(0x144)+_0xbeb1a6(0x9c)+_0xbeb1a6(0x118)+_0xbeb1a6(0x19a)+_0xbeb1a6(0xc8)+'\x20'+_0x1dde39+'\x20'+_0xbeb1a6(0xea)+_0xbeb1a6(0x98)+_0xbeb1a6(0x14e)+'<strong>\x20Regards\x20</strong>'+_0xbeb1a6(0x19d)+_0x294fa0[0x0][_0xbeb1a6(0xe1)]+_0xbeb1a6(0xa0)+_0xbeb1a6(0x187)+_0xbeb1a6(0x187)+_0xbeb1a6(0x93)};_0x226bb5[_0xbeb1a6(0xac)](_0x3f3436,function(_0x3f47c0,_0x2c8457){var _0x59312e=_0xbeb1a6;_0x3f47c0?(console[_0x59312e(0xc1)](_0x3f47c0),console['log'](_0x59312e(0xeb))):console[_0x59312e(0xc1)](_0x59312e(0xf2));}),_0x96eed4[_0xbeb1a6(0xb3)](_0xbeb1a6(0x194),_0xbeb1a6(0x182)),_0x84f73a[_0xbeb1a6(0x164)](_0xbeb1a6(0x181));}catch(_0x5ed8b4){console[_0xbeb1a6(0x97)](_0x5ed8b4),_0x84f73a[_0xbeb1a6(0x18d)](0x1f4)[_0xbeb1a6(0x9b)]({'error':_0xbeb1a6(0x126)});}})['catch'](_0x52ca45=>{var _0x260cb4=_0x2d8c6e;console['error'](_0x52ca45),_0x84f73a[_0x260cb4(0x18d)](0x1f4)[_0x260cb4(0x9b)]({'error':_0x260cb4(0xe0)});});}catch(_0x234138){console['log'](_0x234138);}}),router['get']('/preview/:id',auth,async(_0x22a9a4,_0x366086)=>{var _0x22562e=a0_0x10c38e;try{const {username:_0x1fa7b0,email:_0xfed49d,role:_0x924069}=_0x22a9a4[_0x22562e(0x174)],_0x31ac96=_0x22a9a4[_0x22562e(0x174)],_0x4f933d=await profile[_0x22562e(0x17f)]({'email':_0x31ac96[_0x22562e(0x19b)]}),_0x5189a9=await master_shop[_0x22562e(0x108)](),_0x3d1d09=_0x22a9a4[_0x22562e(0xb2)]['id'],_0x3c71a9=await purchases['findById'](_0x3d1d09),_0x48a22f=await warehouse[_0x22562e(0x171)]([{'$match':{'name':_0x3c71a9[_0x22562e(0xef)],'room':_0x3c71a9[_0x22562e(0x16d)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x22562e(0x177)},'product_stock':{'$first':_0x22562e(0xe8)},'bay':{'$first':_0x22562e(0xae)},'bin':{'$first':_0x22562e(0xd2)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x22562e(0x175)},'product_code':{'$first':_0x22562e(0xd0)},'storage':{'$first':_0x22562e(0x9d)},'rack':{'$first':_0x22562e(0x102)},'expiry_date':{'$first':_0x22562e(0x148)}}}]),_0x1552fa=await customer['find']({});let _0xd901ce;if(_0x31ac96['role']==_0x22562e(0xf4)){const _0xb1ff77=await staff['findOne']({'email':_0x31ac96[_0x22562e(0x19b)]});_0xd901ce=await warehouse[_0x22562e(0x171)]([{'$match':{'status':_0x22562e(0x9e),'name':_0xb1ff77[_0x22562e(0x179)]}},{'$group':{'_id':_0x22562e(0x12e),'name':{'$first':_0x22562e(0x12e)}}}]);}else _0xd901ce=await warehouse[_0x22562e(0x171)]([{'$match':{'status':_0x22562e(0x9e)}},{'$group':{'_id':_0x22562e(0x12e),'name':{'$first':_0x22562e(0x12e)}}}]);const _0x273b67=await product[_0x22562e(0x108)]({}),_0x1c87d5=await suppliers['find']({}),_0x32210e=BayBinSelected(_0x3c71a9[_0x22562e(0xef)],_0x3c71a9[_0x22562e(0x16d)]);if(_0x5189a9[0x0]['language']==_0x22562e(0x13d)){var _0x710e48=users['English'];console[_0x22562e(0xc1)](_0x710e48);}else{if(_0x5189a9[0x0][_0x22562e(0xdc)]==_0x22562e(0x124))var _0x710e48=users[_0x22562e(0x124)];else{if(_0x5189a9[0x0][_0x22562e(0xdc)]==_0x22562e(0x132))var _0x710e48=users['German'];else{if(_0x5189a9[0x0][_0x22562e(0xdc)]==_0x22562e(0x96))var _0x710e48=users[_0x22562e(0x96)];else{if(_0x5189a9[0x0][_0x22562e(0xdc)]==_0x22562e(0xee))var _0x710e48=users[_0x22562e(0xee)];else{if(_0x5189a9[0x0][_0x22562e(0xdc)]==_0x22562e(0x9a))var _0x710e48=users[_0x22562e(0x9f)];else{if(_0x5189a9[0x0][_0x22562e(0xdc)]=='Chinese')var _0x710e48=users['Chinese'];else{if(_0x5189a9[0x0][_0x22562e(0xdc)]=='Arabic\x20(ae)')var _0x710e48=users['Arabic'];}}}}}}}_0x366086[_0x22562e(0xe5)](_0x22562e(0x152),{'success':_0x22a9a4[_0x22562e(0xb3)](_0x22562e(0x194)),'errors':_0x22a9a4[_0x22562e(0xb3)](_0x22562e(0xed)),'role':_0x31ac96,'profile':_0x4f933d,'customer':_0x1552fa,'warehouse':_0xd901ce,'product':_0x48a22f,'user':_0x3c71a9,'master_shop':_0x5189a9,'unit':_0x273b67,'language':_0x710e48,'suppliers':_0x1c87d5,'dataSelected':_0x32210e});}catch(_0x581a9d){console['log'](_0x581a9d);}}),router['post'](a0_0x10c38e(0x134),auth,async(_0x2b0dbc,_0x2e54af)=>{var _0x2388cf=a0_0x10c38e;try{const _0x22503f=_0x2b0dbc[_0x2388cf(0xb2)]['id'],{invoice:_0x591e06,warehouse_name:_0xc2ea01,Room_name:_0x4b9347}=_0x2b0dbc[_0x2388cf(0x142)],_0x28813e=await warehouse[_0x2388cf(0x17f)]({'name':_0xc2ea01,'room':_0x4b9347}),_0x40c739=await purchases[_0x2388cf(0x17f)]({'invoice':_0x591e06});_0x40c739[_0x2388cf(0x15d)][_0x2388cf(0x184)](_0x152fb0=>{var _0x4de1b7=_0x2388cf,_0x594892=0x0;const _0x1b9bfb=_0x28813e[_0x4de1b7(0xd7)][_0x4de1b7(0xc4)](_0x3ee8ac=>{var _0x37195c=_0x4de1b7;_0x3ee8ac[_0x37195c(0xf0)]==_0x152fb0[_0x37195c(0xf0)]&&_0x3ee8ac[_0x37195c(0xa1)]==_0x152fb0[_0x37195c(0xa1)]&&_0x3ee8ac[_0x37195c(0xa8)]==_0x152fb0[_0x37195c(0xa8)]&&_0x3ee8ac[_0x37195c(0xec)]==_0x152fb0[_0x37195c(0xec)]&&_0x3ee8ac[_0x37195c(0x149)]==_0x152fb0[_0x37195c(0x149)]&&_0x3ee8ac['rack']==_0x152fb0[_0x37195c(0x168)]&&_0x3ee8ac[_0x37195c(0xc9)]==_0x152fb0[_0x37195c(0xc9)]&&_0x3ee8ac['expiry_date']==_0x152fb0[_0x37195c(0x151)]&&_0x3ee8ac['batch_code']==_0x152fb0['batch_code']&&_0x3ee8ac[_0x37195c(0x12c)]==_0x152fb0[_0x37195c(0x12c)]&&_0x3ee8ac[_0x37195c(0x11c)]==_0x152fb0[_0x37195c(0x11c)]&&_0x3ee8ac[_0x37195c(0xfc)]==_0x152fb0['delivery_code']&&(_0x3ee8ac[_0x37195c(0xaf)]=parseInt(_0x3ee8ac['product_stock'])+parseInt(_0x152fb0['quantity']),_0x594892++);});_0x594892=='0'&&(_0x28813e[_0x4de1b7(0xd7)]=_0x28813e[_0x4de1b7(0xd7)]['concat']({'product_name':_0x152fb0[_0x4de1b7(0xf0)],'product_stock':_0x152fb0[_0x4de1b7(0x17b)],'primary_code':_0x152fb0['primary_code'],'secondary_code':_0x152fb0[_0x4de1b7(0x192)],'product_code':_0x152fb0['product_code'],'storage':_0x152fb0[_0x4de1b7(0xc9)],'rack':_0x152fb0[_0x4de1b7(0x168)],'bay':_0x152fb0[_0x4de1b7(0x149)],'bin':_0x152fb0['bin'],'type':_0x152fb0[_0x4de1b7(0xa8)],'floorlevel':_0x152fb0[_0x4de1b7(0xa1)],'maxProducts':_0x152fb0[_0x4de1b7(0x15c)],'unit':_0x152fb0[_0x4de1b7(0x154)],'secondary_unit':_0x152fb0[_0x4de1b7(0xf7)],'expiry_date':_0x152fb0[_0x4de1b7(0x151)],'maxPerUnit':_0x152fb0[_0x4de1b7(0x18b)],'batch_code':_0x152fb0[_0x4de1b7(0x17d)],'alertQTY':_0x152fb0[_0x4de1b7(0xf1)],'production_date':_0x152fb0[_0x4de1b7(0x12c)],'delivery_date':_0x152fb0[_0x4de1b7(0x11c)],'delivery_code':_0x152fb0['delivery_code']}));}),await _0x28813e[_0x2388cf(0x11d)](),_0x40c739['finalize']=_0x2388cf(0x112);const _0x44e10a=await _0x40c739[_0x2388cf(0x11d)]();_0x2b0dbc['flash'](_0x2388cf(0x194),'Sales\x20Update\x20successfully'),_0x2e54af[_0x2388cf(0x164)](_0x2388cf(0xbb));}catch(_0x4ebd37){console[_0x2388cf(0xc1)](_0x4ebd37);}}),router[a0_0x10c38e(0x196)](a0_0x10c38e(0x17a),auth,async(_0x1706dc,_0x42eda8)=>{var _0x4cb5e7=a0_0x10c38e;try{const {username:_0x4cf304,email:_0x3db2b3,role:_0x330886}=_0x1706dc[_0x4cb5e7(0x174)],_0x42b5a4=_0x1706dc['user'],_0x1978cd=await profile['findOne']({'email':_0x42b5a4[_0x4cb5e7(0x19b)]}),_0x3b113a=await master_shop['find'](),_0x56cf8a=_0x1706dc[_0x4cb5e7(0xb2)]['id'],_0x1c8583=await purchases[_0x4cb5e7(0xe7)](_0x56cf8a),_0x2a907b=await suppliers[_0x4cb5e7(0x108)]({});let _0x2eef0d;if(_0x42b5a4[_0x4cb5e7(0x117)]==_0x4cb5e7(0xf4)){const _0x5bbf41=await staff['findOne']({'email':_0x42b5a4[_0x4cb5e7(0x19b)]});_0x2eef0d=await warehouse['find']({'status':_0x4cb5e7(0x9e),'name':_0x5bbf41['warehouse'],'warehouse_category':_0x4cb5e7(0x159)});}else _0x2eef0d=await warehouse[_0x4cb5e7(0x171)]([{'$match':{'status':_0x4cb5e7(0x9e),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4cb5e7(0x12e),'name':{'$first':_0x4cb5e7(0x12e)}}}]);const _0x39d52d=await product[_0x4cb5e7(0x108)]({}),_0x20e258=BayBinSelected(_0x1c8583[_0x4cb5e7(0xef)],_0x1c8583['room']);let _0x2d8c78=new Date(_0x1c8583['expiry_date']),_0x5e7545=('0'+_0x2d8c78[_0x4cb5e7(0x180)]())['slice'](-0x2),_0x7b8ea8=('0'+(_0x2d8c78[_0x4cb5e7(0x109)]()+0x1))[_0x4cb5e7(0x12b)](-0x2),_0x267b86=_0x2d8c78['getFullYear'](),_0x4758e3=_0x267b86+'-'+_0x7b8ea8+'-'+_0x5e7545;if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x13d)){var _0x5288b7=users[_0x4cb5e7(0x92)];console['log'](_0x5288b7);}else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x124))var _0x5288b7=users[_0x4cb5e7(0x124)];else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x132))var _0x5288b7=users[_0x4cb5e7(0x132)];else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x96))var _0x5288b7=users[_0x4cb5e7(0x96)];else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0xee))var _0x5288b7=users[_0x4cb5e7(0xee)];else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x9a))var _0x5288b7=users[_0x4cb5e7(0x9f)];else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x10b))var _0x5288b7=users[_0x4cb5e7(0x10b)];else{if(_0x3b113a[0x0][_0x4cb5e7(0xdc)]==_0x4cb5e7(0x116))var _0x5288b7=users[_0x4cb5e7(0xbf)];}}}}}}}_0x42eda8[_0x4cb5e7(0xe5)]('edit_purchases',{'success':_0x1706dc['flash'](_0x4cb5e7(0x194)),'errors':_0x1706dc[_0x4cb5e7(0xb3)]('errors'),'role':_0x42b5a4,'profile':_0x1978cd,'purchases':_0x1c8583,'suppliers':_0x2a907b,'warehouse':_0x2eef0d,'product':_0x39d52d,'master_shop':_0x3b113a,'language':_0x5288b7,'ed_fullDate':_0x4758e3,'dataSelected':_0x20e258});}catch(_0x3a2ac4){console[_0x4cb5e7(0xc1)](_0x3a2ac4);}}),router[a0_0x10c38e(0xb9)]('/view/:id',auth,async(_0x1d680a,_0x19fd9f)=>{var _0x23edf7=a0_0x10c38e;try{const _0x366b9e=_0x1d680a['params']['id'],_0x1a0885=await purchases[_0x23edf7(0x17f)]({'_id':_0x1d680a[_0x23edf7(0xb2)]['id']}),_0x22da85=await warehouse[_0x23edf7(0x17f)]({'name':_0x1a0885[_0x23edf7(0xef)],'room':_0x1a0885['room']});_0x1a0885[_0x23edf7(0x15d)]['forEach'](_0x1e345c=>{var _0x168e85=_0x23edf7;const _0x3f3637=_0x22da85[_0x168e85(0xd7)][_0x168e85(0xc4)](_0x5a7362=>{var _0x5aa0d0=_0x168e85;_0x5a7362[_0x5aa0d0(0xf0)]==_0x1e345c['product_name']&&_0x5a7362['floorlevel']==_0x1e345c[_0x5aa0d0(0xa1)]&&_0x5a7362['type']==_0x1e345c[_0x5aa0d0(0xa8)]&&_0x5a7362[_0x5aa0d0(0xec)]==_0x1e345c[_0x5aa0d0(0xec)]&&_0x5a7362[_0x5aa0d0(0x149)]==_0x1e345c[_0x5aa0d0(0x149)]&&_0x5a7362[_0x5aa0d0(0x168)]==_0x1e345c['rack']&&_0x5a7362['storage']==_0x1e345c[_0x5aa0d0(0xc9)]&&(_0x5a7362[_0x5aa0d0(0xaf)]=parseInt(_0x5a7362[_0x5aa0d0(0xaf)])-parseInt(_0x1e345c[_0x5aa0d0(0x17b)]));});}),await _0x22da85[_0x23edf7(0x11d)]();const {invoice:_0x38d640,suppliers:_0x72a7d3,date:_0xa95093,warehouse_name:_0x1338a5,prod_name:_0x4edfec,prod_code:_0x82523a,prod_qty:_0x3734ee,prod_unit:_0x408b9d,prod_secondunit:_0x310ba2,prod_level:_0x509683,prod_isle:_0x245664,prod_pallet:_0x359ab1,note:_0x38e9db,expiry_date:_0x464ce6,batch_code:_0x40406b,paid_amount:_0x3979f4,due_amount:_0x9051e3,Room_name:_0x25572f,primary_code:_0x368c86,secondary_code:_0x48a484,PO_number:_0x164dbb,JO_number:_0x3f3373}=_0x1d680a['body'];if(typeof _0x4edfec==_0x23edf7(0x131))var _0xaf5b4=[_0x1d680a[_0x23edf7(0x142)]['prod_name']],_0x5aba1c=[_0x1d680a['body'][_0x23edf7(0xc6)]],_0x4d20ef=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xa4)]],_0x1fd159=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x91)]],_0x44fa57=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xa6)]],_0x32165c=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xc0)]],_0x201f30=[_0x1d680a[_0x23edf7(0x142)]['prod_isle']],_0xdae375=[_0x1d680a['body'][_0x23edf7(0xfd)]],_0x5d582a=[_0x1d680a['body'][_0x23edf7(0x99)]],_0xc79288=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x192)]],_0x1d9ed3=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x1a3)]],_0x231161=[_0x1d680a['body'][_0x23edf7(0x17d)]],_0x5921c9=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x151)]],_0x5107bb=[_0x1d680a['body'][_0x23edf7(0xc9)]],_0x4098ff=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x191)]],_0x166b50=[_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xa8)]];else var _0xaf5b4=[..._0x1d680a[_0x23edf7(0x142)]['prod_name']],_0x5aba1c=[..._0x1d680a['body'][_0x23edf7(0xc6)]],_0x4d20ef=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xa4)]],_0x1fd159=[..._0x1d680a['body']['prod_unit']],_0x44fa57=[..._0x1d680a['body'][_0x23edf7(0xa6)]],_0x32165c=[..._0x1d680a['body'][_0x23edf7(0xc0)]],_0x201f30=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xbd)]],_0xdae375=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xfd)]],_0x5d582a=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x99)]],_0xc79288=[..._0x1d680a[_0x23edf7(0x142)]['secondary_code']],_0x1d9ed3=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x1a3)]],_0x231161=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x17d)]],_0x5921c9=[..._0x1d680a['body'][_0x23edf7(0x151)]],_0x5107bb=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xc9)]],_0x4098ff=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x191)]],_0x166b50=[..._0x1d680a[_0x23edf7(0x142)][_0x23edf7(0xa8)]];const _0x5b242b=_0xaf5b4[_0x23edf7(0xc4)](_0x5582fe=>{return _0x5582fe={'product_name':_0x5582fe};});_0x5aba1c[_0x23edf7(0x184)]((_0x57ce77,_0x46ed03)=>{var _0x522300=_0x23edf7;_0x5b242b[_0x46ed03][_0x522300(0xb5)]=_0x57ce77;}),_0x4d20ef['forEach']((_0x3b3192,_0x299682)=>{_0x5b242b[_0x299682]['quantity']=_0x3b3192;}),_0x1fd159['forEach']((_0x31db50,_0x153ba1)=>{var _0x37a410=_0x23edf7;_0x5b242b[_0x153ba1][_0x37a410(0x154)]=_0x31db50;}),_0x44fa57[_0x23edf7(0x184)]((_0x3b0399,_0x428093)=>{_0x5b242b[_0x428093]['secondary_unit']=_0x3b0399;}),_0x32165c[_0x23edf7(0x184)]((_0x47ebe1,_0x30f8b1)=>{var _0x359575=_0x23edf7;_0x5b242b[_0x30f8b1][_0x359575(0x149)]=_0x47ebe1;}),_0x201f30[_0x23edf7(0x184)]((_0x48ed6c,_0x3e443c)=>{var _0x49c017=_0x23edf7;_0x5b242b[_0x3e443c][_0x49c017(0xec)]=_0x48ed6c;}),_0xdae375[_0x23edf7(0x184)]((_0x477a46,_0x2486dc)=>{_0x5b242b[_0x2486dc]['floorlevel']=_0x477a46;}),_0x5d582a[_0x23edf7(0x184)]((_0x369775,_0x4fbb7d)=>{var _0x1141c7=_0x23edf7;_0x5b242b[_0x4fbb7d][_0x1141c7(0x99)]=_0x369775;}),_0xc79288[_0x23edf7(0x184)]((_0x5209fb,_0x1b430a)=>{var _0x35a95a=_0x23edf7;_0x5b242b[_0x1b430a][_0x35a95a(0x192)]=_0x5209fb;}),_0x1d9ed3[_0x23edf7(0x184)]((_0x14e166,_0x46094b)=>{var _0x55238d=_0x23edf7;_0x5b242b[_0x46094b][_0x55238d(0x15c)]=_0x14e166;}),_0x231161[_0x23edf7(0x184)]((_0x4234e0,_0x3d4ced)=>{var _0x1526d7=_0x23edf7;_0x5b242b[_0x3d4ced][_0x1526d7(0x17d)]=_0x4234e0;}),_0x5921c9[_0x23edf7(0x184)]((_0x43cd18,_0x308a43)=>{var _0x453461=_0x23edf7;_0x5b242b[_0x308a43][_0x453461(0x151)]=_0x43cd18;}),_0x166b50[_0x23edf7(0x184)]((_0x1fce31,_0x38518b)=>{var _0xb20043=_0x23edf7;_0x5b242b[_0x38518b][_0xb20043(0xa8)]=_0x1fce31;}),_0x5107bb['forEach']((_0x5247f5,_0x3a88b8)=>{var _0x5774f0=_0x23edf7;_0x5b242b[_0x3a88b8][_0x5774f0(0xc9)]=_0x5247f5;}),_0x4098ff[_0x23edf7(0x184)]((_0x57b081,_0x43de69)=>{var _0x417688=_0x23edf7;_0x5b242b[_0x43de69][_0x417688(0x168)]=_0x57b081;});const _0x25e52c=_0x5b242b['filter'](_0x50dfa0=>_0x50dfa0[_0x23edf7(0x17b)]!=='0'&&_0x50dfa0['quantity']!=='');_0x1a0885['invoice']=_0x38d640,_0x1a0885[_0x23edf7(0x10d)]=_0x72a7d3,_0x1a0885[_0x23edf7(0x167)]=_0xa95093,_0x1a0885[_0x23edf7(0xef)]=_0x1338a5,_0x1a0885[_0x23edf7(0x15d)]=_0x25e52c,_0x1a0885['note']=_0x38e9db,_0x1a0885['paid_amount']=_0x3979f4,_0x1a0885[_0x23edf7(0x128)]=_0x9051e3,_0x1a0885['room']=_0x25572f,_0x1a0885[_0x23edf7(0x188)]=_0x164dbb,_0x1a0885['JO_number']=_0x3f3373;const _0x36a106=await _0x1a0885[_0x23edf7(0x11d)](),_0x4c5616=await warehouse[_0x23edf7(0x17f)]({'name':_0x1d680a[_0x23edf7(0x142)]['warehouse_name'],'room':_0x1d680a[_0x23edf7(0x142)]['Room_name']});_0x1a0885[_0x23edf7(0x15d)][_0x23edf7(0x184)](_0x2f26b9=>{var _0x2d8d19=_0x23edf7,_0x4cb3a2=0x0;const _0x2d9be6=_0x4c5616[_0x2d8d19(0xd7)]['map'](_0x465535=>{var _0x57d017=_0x2d8d19;_0x465535[_0x57d017(0xf0)]==_0x2f26b9[_0x57d017(0xf0)]&&_0x465535['floorlevel']==_0x2f26b9['floorlevel']&&_0x465535['type']==_0x2f26b9['type']&&_0x465535[_0x57d017(0xec)]==_0x2f26b9['bin']&&_0x465535[_0x57d017(0x149)]==_0x2f26b9[_0x57d017(0x149)]&&_0x465535[_0x57d017(0x168)]==_0x2f26b9['rack']&&_0x465535[_0x57d017(0xc9)]==_0x2f26b9[_0x57d017(0xc9)]&&(_0x465535[_0x57d017(0xaf)]=parseInt(_0x465535['product_stock'])+parseInt(_0x2f26b9[_0x57d017(0x17b)]),_0x4cb3a2++);});_0x4cb3a2=='0'&&(_0x4c5616[_0x2d8d19(0xd7)]=_0x4c5616[_0x2d8d19(0xd7)][_0x2d8d19(0xe9)]({'product_name':_0x2f26b9[_0x2d8d19(0xf0)],'product_stock':_0x2f26b9[_0x2d8d19(0x17b)],'primary_code':_0x2f26b9['primary_code'],'secondary_code':_0x2f26b9[_0x2d8d19(0x192)],'product_code':_0x2f26b9[_0x2d8d19(0xb5)],'storage':_0x2f26b9[_0x2d8d19(0xc9)],'rack':_0x2f26b9['rack'],'bay':_0x2f26b9[_0x2d8d19(0x149)],'bin':_0x2f26b9[_0x2d8d19(0xec)],'type':_0x2f26b9[_0x2d8d19(0xa8)],'floorlevel':_0x2f26b9[_0x2d8d19(0xa1)],'maxProducts':_0x2f26b9[_0x2d8d19(0x15c)],'unit':_0x2f26b9[_0x2d8d19(0x154)],'secondary_unit':_0x2f26b9[_0x2d8d19(0xf7)],'expiry_date':_0x2f26b9['expiry_date']}));}),await _0x4c5616[_0x23edf7(0x11d)]();const _0x4f01b6=await s_payment_data[_0x23edf7(0x17f)]({'invoice':_0x1d680a[_0x23edf7(0x142)]['invoice']});if(_0x4f01b6===null){}else console['log'](_0x23edf7(0x10d),_0x4f01b6,_0x1d680a[_0x23edf7(0x142)][_0x23edf7(0x166)]),_0x4f01b6[_0x23edf7(0x10d)]=_0x1d680a[_0x23edf7(0x142)]['suppliers'],await _0x4f01b6[_0x23edf7(0x11d)]();_0x1d680a['flash'](_0x23edf7(0x194),_0x23edf7(0xc5)),_0x19fd9f[_0x23edf7(0x164)](_0x23edf7(0xbb));}catch(_0x25d091){console[_0x23edf7(0xc1)](_0x25d091);}}),router[a0_0x10c38e(0xb9)](a0_0x10c38e(0x176),auth,async(_0x578bd6,_0x46d415)=>{var _0x38951f=a0_0x10c38e;try{const _0x5312f0=_0x578bd6[_0x38951f(0xb2)]['id'],{invoice:_0x474529,suppliers:_0x57cfd9,payable:_0x40cfd4,due_amount:_0x1f7037}=_0x578bd6['body'],_0x131236=await purchases[_0x38951f(0xe7)](_0x5312f0);var _0x452f52=_0x40cfd4-_0x1f7037;_0x131236[_0x38951f(0x156)]=parseFloat(_0x131236[_0x38951f(0x156)])+parseFloat(_0x1f7037),_0x131236[_0x38951f(0x128)]=_0x452f52;const _0x8e9ba3=await _0x131236[_0x38951f(0x11d)]();console['log'](_0x8e9ba3);const _0x3f9fc2=await s_payment_data['findOne']({'invoice':_0x474529});_0x3f9fc2['amount']=_0x452f52,await _0x3f9fc2[_0x38951f(0x11d)]();let _0x4373b2=new Date(),_0x355fc9=('0'+_0x4373b2[_0x38951f(0x180)]())[_0x38951f(0x12b)](-0x2),_0x2dfa7d=('0'+(_0x4373b2['getMonth']()+0x1))['slice'](-0x2),_0x1ba4ab=_0x4373b2['getFullYear'](),_0x5c0258=_0x1ba4ab+'-'+_0x2dfa7d+'-'+_0x355fc9;const _0x6c6e86=new suppliers_payment({'invoice':_0x474529,'date':_0x1ba4ab+'-'+_0x2dfa7d+'-'+_0x355fc9,'suppliers':_0x57cfd9,'reason':_0x38951f(0x125),'amount':_0x1f7037}),_0x13831c=await _0x6c6e86[_0x38951f(0x11d)]();_0x578bd6[_0x38951f(0xb3)](_0x38951f(0x194),'payment\x20successfull'),_0x46d415[_0x38951f(0x164)](_0x38951f(0xbb));}catch(_0x2c66b1){console[_0x38951f(0xc1)](_0x2c66b1);}}),router[a0_0x10c38e(0x196)]('/invoice/:id',auth,async(_0x1d3b41,_0x5d0ba2)=>{var _0x5b5775=a0_0x10c38e;try{const {username:_0x5711c9,email:_0x2db566,role:_0x3d95a1}=_0x1d3b41['user'],_0x4702ce=_0x1d3b41['user'],_0x483220=await profile[_0x5b5775(0x17f)]({'email':_0x4702ce['email']}),_0xfee9fa=await master_shop[_0x5b5775(0x108)]();console[_0x5b5775(0xc1)](_0x5b5775(0xdb),_0xfee9fa);const _0x5f5021=_0x1d3b41['params']['id'],_0x128448=await purchases[_0x5b5775(0xe7)](_0x5f5021);console[_0x5b5775(0xc1)](_0x128448);const _0x2e899e=await suppliers['findOne']({'name':_0x128448['suppliers']});console['log'](_0x2e899e);if(_0xfee9fa[0x0][_0x5b5775(0xdc)]==_0x5b5775(0x13d)){var _0x359d69=users[_0x5b5775(0x92)];console[_0x5b5775(0xc1)](_0x359d69);}else{if(_0xfee9fa[0x0]['language']=='Hindi')var _0x359d69=users[_0x5b5775(0x124)];else{if(_0xfee9fa[0x0][_0x5b5775(0xdc)]=='German')var _0x359d69=users[_0x5b5775(0x132)];else{if(_0xfee9fa[0x0][_0x5b5775(0xdc)]==_0x5b5775(0x96))var _0x359d69=users[_0x5b5775(0x96)];else{if(_0xfee9fa[0x0]['language']==_0x5b5775(0xee))var _0x359d69=users[_0x5b5775(0xee)];else{if(_0xfee9fa[0x0][_0x5b5775(0xdc)]==_0x5b5775(0x9a))var _0x359d69=users[_0x5b5775(0x9f)];else{if(_0xfee9fa[0x0]['language']==_0x5b5775(0x10b))var _0x359d69=users[_0x5b5775(0x10b)];else{if(_0xfee9fa[0x0][_0x5b5775(0xdc)]=='Arabic\x20(ae)')var _0x359d69=users[_0x5b5775(0xbf)];}}}}}}}_0x5d0ba2['render'](_0x5b5775(0x17e),{'success':_0x1d3b41[_0x5b5775(0xb3)](_0x5b5775(0x194)),'errors':_0x1d3b41[_0x5b5775(0xb3)]('errors'),'role':_0x4702ce,'profile':_0x483220,'master_shop':_0xfee9fa,'supplier':_0x2e899e,'purchase':_0x128448,'language':_0x359d69});}catch(_0x5df3e0){console['log'](_0x5df3e0);}}),router[a0_0x10c38e(0x196)](a0_0x10c38e(0xa3),auth,async(_0x2bce50,_0xcfc7f7)=>{var _0x4fda3c=a0_0x10c38e;try{const {username:_0x5de024,email:_0x39ada0,role:_0x18f7ea}=_0x2bce50[_0x4fda3c(0x174)],_0x17295b=_0x2bce50[_0x4fda3c(0x174)],_0x1f44bf=await profile['findOne']({'email':_0x17295b[_0x4fda3c(0x19b)]}),_0x16baf0=await master_shop['find']();console[_0x4fda3c(0xc1)](_0x4fda3c(0xdb),_0x16baf0);const _0x36ad5c=_0x2bce50[_0x4fda3c(0xb2)]['id'];console[_0x4fda3c(0xc1)](_0x36ad5c);const _0x3cff5b=await purchases['findById'](_0x36ad5c);console[_0x4fda3c(0xc1)]('user_id',_0x3cff5b);const _0xdd0a63=await product[_0x4fda3c(0x108)]({}),_0x287255=await warehouse[_0x4fda3c(0x171)]([{'$match':{'name':_0x3cff5b[_0x4fda3c(0xef)],'room':_0x3cff5b['room'],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x4fda3c(0x10a)},{'$group':{'_id':_0x4fda3c(0x161),'name':{'$first':_0x4fda3c(0x177)},'product_stock':{'$first':_0x4fda3c(0xe8)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4fda3c(0xd2)},'type':{'$first':_0x4fda3c(0xa7)},'floorlevel':{'$first':_0x4fda3c(0x15f)},'primary_code':{'$first':_0x4fda3c(0x14a)},'secondary_code':{'$first':_0x4fda3c(0x175)},'product_code':{'$first':_0x4fda3c(0xd0)},'storage':{'$first':_0x4fda3c(0x9d)},'rack':{'$first':_0x4fda3c(0x102)}}}]);warehouse_data=await warehouse[_0x4fda3c(0x171)]([{'$match':{'status':_0x4fda3c(0x9e),'name':_0x4fda3c(0x195),'warehouse_category':_0x4fda3c(0x159)}},{'$group':{'_id':_0x4fda3c(0x12e),'name':{'$first':_0x4fda3c(0x12e)}}},{'$sort':{'name':0x1}}]),console[_0x4fda3c(0xc1)](_0x4fda3c(0x158),_0x287255);if(_0x16baf0[0x0][_0x4fda3c(0xdc)]==_0x4fda3c(0x13d)){var _0x4dba78=users[_0x4fda3c(0x92)];console[_0x4fda3c(0xc1)](_0x4dba78);}else{if(_0x16baf0[0x0][_0x4fda3c(0xdc)]==_0x4fda3c(0x124))var _0x4dba78=users[_0x4fda3c(0x124)];else{if(_0x16baf0[0x0][_0x4fda3c(0xdc)]=='German')var _0x4dba78=users[_0x4fda3c(0x132)];else{if(_0x16baf0[0x0][_0x4fda3c(0xdc)]==_0x4fda3c(0x96))var _0x4dba78=users[_0x4fda3c(0x96)];else{if(_0x16baf0[0x0][_0x4fda3c(0xdc)]==_0x4fda3c(0xee))var _0x4dba78=users['French'];else{if(_0x16baf0[0x0]['language']==_0x4fda3c(0x9a))var _0x4dba78=users['Portuguese'];else{if(_0x16baf0[0x0][_0x4fda3c(0xdc)]=='Chinese')var _0x4dba78=users[_0x4fda3c(0x10b)];else{if(_0x16baf0[0x0][_0x4fda3c(0xdc)]==_0x4fda3c(0x116))var _0x4dba78=users[_0x4fda3c(0xbf)];}}}}}}}_0xcfc7f7[_0x4fda3c(0xe5)](_0x4fda3c(0xbc),{'success':_0x2bce50[_0x4fda3c(0xb3)](_0x4fda3c(0x194)),'errors':_0x2bce50[_0x4fda3c(0xb3)](_0x4fda3c(0xed)),'role':_0x17295b,'profile':_0x1f44bf,'user':_0x3cff5b,'stock':_0x287255,'master_shop':_0x16baf0,'product':_0xdd0a63,'language':_0x4dba78,'warehouse':warehouse_data});}catch(_0x263708){console['log'](_0x263708);}}),router['post'](a0_0x10c38e(0xa3),auth,async(_0x164425,_0x790877)=>{var _0x266977=a0_0x10c38e;try{const {invoice:_0x5bfde5,date:_0x5ebd68,warehouse_name:_0x232b08,Room_name:_0x314c88,product_name:_0x2d3b74,purchase_quantity:_0x268406,stocks:_0x55ced1,return_qty:_0x4fce96,note:_0x26b02c,level:_0x465b6b,isle:_0x1d0c89,pallet:_0x245e52,to_warehouse_name:_0x4d16e1,to_Room_name:_0x4da26f}=_0x164425[_0x266977(0x142)],_0x2f1a0d=await purchases[_0x266977(0x17f)]({'_id':_0x164425['params']['id']}),_0x5ceafc=await warehouse['findOne']({'name':_0x232b08,'room':_0x314c88});if(typeof _0x2d3b74==_0x266977(0x131))var _0x5512d2=[_0x164425[_0x266977(0x142)][_0x266977(0xf0)]],_0x3bbfce=[_0x164425[_0x266977(0x142)]['purchase_quantity']],_0x3c35f6=[_0x164425[_0x266977(0x142)][_0x266977(0x13f)]],_0x3a844d=[_0x164425[_0x266977(0x142)][_0x266977(0x11f)]],_0x3e869b=[_0x164425['body'][_0x266977(0x163)]],_0x30349b=[_0x164425[_0x266977(0x142)]['isle']],_0x31b889=[_0x164425['body'][_0x266977(0x11a)]],_0xdb1cf1=[_0x164425[_0x266977(0x142)][_0x266977(0xde)]],_0xf7833c=[_0x164425[_0x266977(0x142)]['product_code_hide']],_0x149b3e=[_0x164425[_0x266977(0x142)][_0x266977(0x127)]],_0x34656c=[_0x164425[_0x266977(0x142)][_0x266977(0xab)]];else var _0x5512d2=[..._0x164425[_0x266977(0x142)][_0x266977(0xf0)]],_0x3bbfce=[..._0x164425[_0x266977(0x142)][_0x266977(0x140)]],_0x3c35f6=[..._0x164425[_0x266977(0x142)][_0x266977(0x13f)]],_0x3a844d=[..._0x164425[_0x266977(0x142)][_0x266977(0x11f)]],_0x3e869b=[..._0x164425[_0x266977(0x142)][_0x266977(0x163)]],_0x30349b=[..._0x164425[_0x266977(0x142)][_0x266977(0x13a)]],_0x31b889=[..._0x164425[_0x266977(0x142)]['pallet']],_0xdb1cf1=[..._0x164425[_0x266977(0x142)][_0x266977(0xde)]],_0xf7833c=[..._0x164425[_0x266977(0x142)][_0x266977(0xc7)]],_0x149b3e=[..._0x164425[_0x266977(0x142)][_0x266977(0x127)]],_0x34656c=[..._0x164425[_0x266977(0x142)][_0x266977(0xab)]];const _0x2c9e60=_0x5512d2[_0x266977(0xc4)](_0x3084b0=>{return _0x3084b0={'product_name':_0x3084b0};});_0x3bbfce['forEach']((_0x30ba7b,_0x4d614d)=>{var _0x4c206b=_0x266977;_0x2c9e60[_0x4d614d][_0x4c206b(0x140)]=_0x30ba7b;}),_0x3c35f6[_0x266977(0x184)]((_0x2505b1,_0x447cba)=>{var _0x5620a9=_0x266977;_0x2c9e60[_0x447cba][_0x5620a9(0xcb)]=_0x2505b1;}),_0x3a844d[_0x266977(0x184)]((_0x5487bd,_0x4fd5d5)=>{_0x2c9e60[_0x4fd5d5]['return_qty']=_0x5487bd;}),_0x3e869b['forEach']((_0x2ff4a3,_0x4c9e0b)=>{var _0x371edc=_0x266977;_0x2c9e60[_0x4c9e0b][_0x371edc(0x149)]=_0x2ff4a3;}),_0x30349b[_0x266977(0x184)]((_0x4b0e02,_0x300532)=>{var _0x46b171=_0x266977;_0x2c9e60[_0x300532][_0x46b171(0xec)]=_0x4b0e02;}),_0x31b889[_0x266977(0x184)]((_0x5c09f4,_0x115c45)=>{var _0xb7f244=_0x266977;_0x2c9e60[_0x115c45][_0xb7f244(0xa1)]=_0x5c09f4;}),_0xdb1cf1[_0x266977(0x184)]((_0x57beb7,_0x1fd165)=>{_0x2c9e60[_0x1fd165]['type']=_0x57beb7;}),_0xf7833c[_0x266977(0x184)]((_0x5a62bd,_0x220317)=>{var _0x89e92b=_0x266977;_0x2c9e60[_0x220317][_0x89e92b(0xb5)]=_0x5a62bd;}),_0x149b3e[_0x266977(0x184)]((_0x1033be,_0x4856b9)=>{var _0x3790b9=_0x266977;_0x2c9e60[_0x4856b9][_0x3790b9(0x99)]=_0x1033be;}),_0x34656c[_0x266977(0x184)]((_0x166ffd,_0x42fa6f)=>{var _0x482cc5=_0x266977;_0x2c9e60[_0x42fa6f][_0x482cc5(0x192)]=_0x166ffd;}),_0x2f1a0d['product']['forEach'](_0x35b65e=>{var _0x1603ed=_0x266977;const _0x3af1ba=_0x5ceafc[_0x1603ed(0xd7)][_0x1603ed(0xc4)](_0x51a113=>{var _0x1b0ec8=_0x1603ed;_0x51a113['product_name']==_0x35b65e['product_name']&&_0x51a113[_0x1b0ec8(0xa1)]==_0x35b65e[_0x1b0ec8(0xa1)]&&_0x51a113[_0x1b0ec8(0xa8)]==_0x35b65e[_0x1b0ec8(0xa8)]&&_0x51a113[_0x1b0ec8(0xec)]==_0x35b65e[_0x1b0ec8(0xec)]&&_0x51a113['bay']==_0x35b65e[_0x1b0ec8(0x149)]&&_0x51a113['rack']==_0x35b65e[_0x1b0ec8(0x168)]&&_0x51a113[_0x1b0ec8(0xc9)]==_0x35b65e[_0x1b0ec8(0xc9)]&&(console['log'](parseInt(_0x51a113[_0x1b0ec8(0xaf)])+_0x1b0ec8(0x119)+parseInt(_0x35b65e[_0x1b0ec8(0x17b)])),_0x51a113[_0x1b0ec8(0xaf)]=parseInt(_0x51a113[_0x1b0ec8(0xaf)])+parseInt(_0x35b65e[_0x1b0ec8(0x17b)]));});}),await _0x5ceafc[_0x266977(0x11d)]();const _0x8e4028=_0x2c9e60[_0x266977(0xb0)](_0x3dce0b=>_0x3dce0b['return_qty']!=='0'&&_0x3dce0b['return_qty']!=='');var _0x40d083=0x0;_0x8e4028[_0x266977(0x184)](_0x2b94fe=>{var _0xfce0fc=_0x266977;console[_0xfce0fc(0xc1)](_0xfce0fc(0x147),_0x2b94fe),(parseInt(_0x2b94fe[_0xfce0fc(0x140)])<parseInt(_0x2b94fe[_0xfce0fc(0x11f)])||parseInt(_0x2b94fe['stock_quantity'])<parseInt(_0x2b94fe[_0xfce0fc(0x11f)]))&&_0x40d083++;});if(_0x40d083!=0x0)return _0x164425[_0x266977(0xb3)](_0x266977(0xed),_0x266977(0x183)),_0x790877['redirect'](_0x266977(0x19e));const _0xf7f1b0=new purchases_return({'invoice':_0x5bfde5,'suppliers':_0x164425[_0x266977(0x142)][_0x266977(0x10d)],'date':_0x5ebd68,'warehouse_name':_0x232b08,'return_product':_0x8e4028,'note':_0x26b02c,'room':_0x314c88,'to_warehouse_name':_0x4d16e1,'to_room':_0x4da26f}),_0x3e78bf=await _0xf7f1b0[_0x266977(0x11d)]();console[_0x266977(0xc1)](_0xf7f1b0);const _0x144920=await purchases_return[_0x266977(0x17f)]({'invoice':_0x5bfde5}),_0x18bc6c=await warehouse[_0x266977(0x17f)]({'name':_0x4d16e1,'room':_0x4da26f});_0x144920[_0x266977(0x153)][_0x266977(0x184)](_0x100ac7=>{var _0x240609=_0x266977,_0x3cc240=0x0;const _0x44f93a=_0x18bc6c[_0x240609(0xd7)][_0x240609(0xc4)](_0x2534c2=>{var _0x2190ce=_0x240609;_0x2534c2[_0x2190ce(0xf0)]==_0x100ac7[_0x2190ce(0xf0)]&&_0x2534c2[_0x2190ce(0xa1)]==_0x100ac7[_0x2190ce(0xa1)]&&_0x2534c2['type']==_0x100ac7['type']&&_0x2534c2[_0x2190ce(0xec)]==_0x100ac7[_0x2190ce(0xec)]&&_0x2534c2[_0x2190ce(0x149)]==_0x100ac7['bay']&&(_0x2534c2[_0x2190ce(0xaf)]=parseInt(_0x2534c2[_0x2190ce(0xaf)])-parseInt(_0x100ac7[_0x2190ce(0x11f)]),_0x3cc240++);});_0x3cc240=='0'&&(_0x18bc6c[_0x240609(0xd7)]=_0x18bc6c[_0x240609(0xd7)][_0x240609(0xe9)]({'product_name':_0x100ac7[_0x240609(0xf0)],'product_stock':_0x100ac7['return_qty'],'primary_code':_0x100ac7[_0x240609(0x99)],'secondary_code':_0x100ac7[_0x240609(0x192)],'product_code':_0x100ac7[_0x240609(0xb5)],'storage':_0x100ac7[_0x240609(0xc9)],'rack':_0x100ac7['rack'],'bay':_0x100ac7[_0x240609(0x149)],'bin':_0x100ac7[_0x240609(0xec)],'type':_0x100ac7[_0x240609(0xa8)],'floorlevel':_0x100ac7['floorlevel'],'maxProducts':_0x100ac7[_0x240609(0x15c)],'unit':_0x100ac7['standard_unit'],'secondary_unit':_0x100ac7[_0x240609(0xf7)],'expiry_date':_0x100ac7['expiry_date']}));}),await _0x18bc6c[_0x266977(0x11d)]();const _0x2145d6=await purchases[_0x266977(0x17f)]({'invoice':_0x5bfde5});_0x2145d6['return_data']=_0x266977(0x112);const _0x2b1fc9=await _0x2145d6[_0x266977(0x11d)](),_0x5ac53f=new s_payment_data({'invoice':_0x5bfde5,'suppliers':_0x164425[_0x266977(0x142)][_0x266977(0x10d)],'reason':'Purchase\x20Return'});await _0x5ac53f['save']();const _0xa86804=await master_shop[_0x266977(0x108)]();console[_0x266977(0xc1)]('add\x20post',_0xa86804[0x0]['image']);const _0x2c1891=await email_settings[_0x266977(0x17f)](),_0x27ef00=await suppliers['findOne']({'name':_0x164425['body']['suppliers']});console['log'](_0x266977(0x16e),_0x27ef00);_0xa86804[0x0][_0x266977(0x186)]==0x1?(right_currency=_0xa86804[0x0][_0x266977(0xca)],left_currency=''):(right_currency='',left_currency=_0xa86804[0x0][_0x266977(0xca)]);var _0x15012b=_0x5512d2,_0x4968cf=_0x3a844d,_0x2dec1d='',_0x22a279;for(_0x22a279 in _0x15012b){_0x2dec1d+=_0x266977(0x18e)+_0x266977(0x189)+_0x15012b[_0x22a279]+_0x266977(0x130)+_0x266977(0x189)+_0x4968cf[_0x22a279]+'</td>'+_0x266977(0x118);}console[_0x266977(0xc1)](_0x266977(0x19f),_0x2dec1d);let _0x2c99c7=nodemailer[_0x266977(0xb8)]({'service':_0x266977(0xcd),'auth':{'user':_0x2c1891[_0x266977(0x19b)],'pass':_0x2c1891[_0x266977(0xd4)]}}),_0x3fe81e={'from':_0x2c1891[_0x266977(0x19b)],'to':_0x27ef00['email'],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x266977(0x13e),'path':__dirname+'/../public'+_0x266977(0x10e)+_0xa86804[0x0][_0x266977(0x18f)],'cid':_0x266977(0xaa)}],'html':_0x266977(0x129)+_0x266977(0x165)+'</head><body>'+_0x266977(0x14e)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x266977(0x14e)+_0x266977(0x16c)+_0x266977(0x187)+_0x266977(0x14e)+_0x266977(0x14f)+_0xa86804[0x0]['site_title']+_0x266977(0xdf)+_0x266977(0x187)+_0x266977(0x187)+_0x266977(0x121)+'<div>'+_0x266977(0x155)+_0x266977(0x94)+_0x5bfde5+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x266977(0xa2)+_0x5ebd68+'\x20'+_0x266977(0xd6)+_0x266977(0xa0)+_0x266977(0x187)+_0x266977(0x170)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x266977(0x18e)+_0x266977(0xda)+_0x266977(0x199)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x266977(0x16b)+_0x266977(0x118)+_0x266977(0x19a)+_0x266977(0xc8)+'\x20'+_0x2dec1d+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x266977(0x100)+_0x266977(0x19d)+_0xa86804[0x0][_0x266977(0xe1)]+'</h5>'+'</div>'+_0x266977(0x187)+_0x266977(0x93)};_0x2c99c7[_0x266977(0xac)](_0x3fe81e,function(_0x24bb5d,_0x1e0e1c){var _0x108811=_0x266977;_0x24bb5d?(console[_0x108811(0xc1)](_0x24bb5d),console[_0x108811(0xc1)](_0x108811(0xeb))):console['log'](_0x108811(0xf2));}),_0x164425[_0x266977(0xb3)]('success',_0x266977(0xb1)),_0x790877['redirect']('/all_purchases/view');}catch(_0x15b71a){console[_0x266977(0xc1)](_0x15b71a),_0x790877[_0x266977(0x18d)](0xc8)[_0x266977(0x9b)]({'message':_0x15b71a[_0x266977(0x103)]});}}),router[a0_0x10c38e(0x196)]('/barcode/:id',auth,async(_0x448b60,_0x4baba4)=>{var _0x4f5373=a0_0x10c38e;try{const {username:_0x5c5f58,email:_0x2a1334,role:_0x41a957}=_0x448b60[_0x4f5373(0x174)],_0x4ebcf2=_0x448b60[_0x4f5373(0x174)],_0x1e7437=await profile[_0x4f5373(0x17f)]({'email':_0x4ebcf2[_0x4f5373(0x19b)]}),_0x49326a=await master_shop[_0x4f5373(0x108)](),_0x35be1a=_0x448b60[_0x4f5373(0xb2)]['id'],_0x5c84c3=await purchases[_0x4f5373(0xe7)](_0x35be1a);if(_0x49326a[0x0]['language']=='English\x20(US)')var _0x7eca99=users[_0x4f5373(0x92)];else{if(_0x49326a[0x0]['language']==_0x4f5373(0x124))var _0x7eca99=users['Hindi'];else{if(_0x49326a[0x0]['language']=='German')var _0x7eca99=users[_0x4f5373(0x132)];else{if(_0x49326a[0x0][_0x4f5373(0xdc)]==_0x4f5373(0x96))var _0x7eca99=users[_0x4f5373(0x96)];else{if(_0x49326a[0x0]['language']==_0x4f5373(0xee))var _0x7eca99=users[_0x4f5373(0xee)];else{if(_0x49326a[0x0]['language']=='Portuguese\x20(BR)')var _0x7eca99=users['Portuguese'];else{if(_0x49326a[0x0][_0x4f5373(0xdc)]==_0x4f5373(0x10b))var _0x7eca99=users[_0x4f5373(0x10b)];else{if(_0x49326a[0x0][_0x4f5373(0xdc)]==_0x4f5373(0x116))var _0x7eca99=users[_0x4f5373(0xbf)];}}}}}}}_0x4baba4[_0x4f5373(0xe5)](_0x4f5373(0xfb),{'success':_0x448b60[_0x4f5373(0xb3)](_0x4f5373(0x194)),'errors':_0x448b60[_0x4f5373(0xb3)](_0x4f5373(0xed)),'role':_0x4ebcf2,'profile':_0x1e7437,'alldata':_0x5c84c3,'master_shop':_0x49326a,'language':_0x7eca99}),console[_0x4f5373(0xc1)](alldata);}catch(_0x480772){console[_0x4f5373(0xc1)](_0x480772);}}),router[a0_0x10c38e(0xb9)](a0_0x10c38e(0x10c),async(_0x535dc4,_0x4501ee)=>{var _0x1a8aaa=a0_0x10c38e;const {product_code:_0x3b035d}=_0x535dc4[_0x1a8aaa(0x142)];var _0x1cf5e3;const _0x1b3b9b=await product[_0x1a8aaa(0x171)]([{'$match':{'primary_code':_0x3b035d,'product_category':_0x1a8aaa(0x159)}},{'$group':{'_id':_0x1a8aaa(0x1a2),'name':{'$first':_0x1a8aaa(0x12e)},'category':{'$first':_0x1a8aaa(0xf8)},'brand':{'$first':_0x1a8aaa(0x12d)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x1a8aaa(0xb6)},'product_code':{'$first':_0x1a8aaa(0xd1)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x1a8aaa(0x18a)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x1a8aaa(0x137)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x186578=await product[_0x1a8aaa(0x171)]([{'$match':{'secondary_code':_0x3b035d,'product_category':_0x1a8aaa(0x159)}},{'$group':{'_id':_0x1a8aaa(0x1a2),'name':{'$first':'$name'},'category':{'$first':_0x1a8aaa(0xf8)},'brand':{'$first':_0x1a8aaa(0x12d)},'unit':{'$first':_0x1a8aaa(0xf6)},'alertquantity':{'$first':_0x1a8aaa(0xb6)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x1a8aaa(0x146)},'secondary_code':{'$first':_0x1a8aaa(0x18a)},'maxStocks':{'$first':_0x1a8aaa(0xcf)},'maxProdPerUnit':{'$first':_0x1a8aaa(0x137)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1a8aaa(0x15a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1b3b9b[_0x1a8aaa(0x123)]>0x0)_0x1cf5e3=_0x1b3b9b;else _0x186578[_0x1a8aaa(0x123)]>0x0&&(_0x1cf5e3=_0x186578);_0x4501ee[_0x1a8aaa(0x9b)](_0x1cf5e3);}),router[a0_0x10c38e(0xb9)](a0_0x10c38e(0x8e),async(_0x4cd441,_0x12546d)=>{var _0x5cb95f=a0_0x10c38e;const {primaryCode:_0x956350,secondaryCode:_0x1d62cf,productCode:_0x222794,bay:_0x46d0e8,bin:_0x217a8a,types:_0x5f9490,pallet:_0x46b37d,warehouses:_0x1659c5,room:_0x1e7662}=_0x4cd441[_0x5cb95f(0x142)];console[_0x5cb95f(0xc1)](_0x4cd441['body']);try{const _0xc6e819=await warehouse[_0x5cb95f(0x171)]([{'$match':{'name':_0x1659c5,'room':_0x1e7662}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x46d0e8,'product_details.bin':_0x217a8a,'product_details.type':_0x5f9490}},{'$group':{'_id':_0x5cb95f(0x161),'name':{'$first':_0x5cb95f(0x177)},'product_stock':{'$first':_0x5cb95f(0xe8)},'level':{'$first':_0x5cb95f(0x12f)},'isle':{'$first':_0x5cb95f(0x104)},'pallet':{'$first':_0x5cb95f(0xcc)},'maxProducts':{'$first':_0x5cb95f(0x13c)}}}]);_0x12546d[_0x5cb95f(0x18d)](0xc8)['json'](_0xc6e819);}catch(_0x2744c4){_0x12546d[_0x5cb95f(0x18d)](0x194)[_0x5cb95f(0x9b)]({'message':_0x2744c4[_0x5cb95f(0x103)]});}}),module['exports']=router;