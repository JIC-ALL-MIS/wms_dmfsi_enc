var a0_0x2793ea=a0_0x5894;(function(_0x51b1ec,_0x3cea7b){var _0x706054=a0_0x5894,_0x5b2913=_0x51b1ec();while(!![]){try{var _0x1e8923=parseInt(_0x706054(0xa8))/0x1*(parseInt(_0x706054(0x112))/0x2)+parseInt(_0x706054(0xf4))/0x3+parseInt(_0x706054(0x121))/0x4*(-parseInt(_0x706054(0xac))/0x5)+-parseInt(_0x706054(0x114))/0x6+-parseInt(_0x706054(0xef))/0x7+-parseInt(_0x706054(0x11b))/0x8+parseInt(_0x706054(0xaa))/0x9;if(_0x1e8923===_0x3cea7b)break;else _0x5b2913['push'](_0x5b2913['shift']());}catch(_0x2d7b03){_0x5b2913['push'](_0x5b2913['shift']());}}}(a0_0x6528,0x1db1d));const express=require('express'),app=express(),router=express[a0_0x2793ea(0x12a)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0x2793ea(0xc0));function a0_0x6528(){var _0x501b16=['/view/:id','Rack\x20A','An\x20error\x20occurred.','suppliers_data','</thead>','</table>','all','</head><body>','all_purchases_barcode','catch','<h2>\x20','prod_qty','gmail','/barcode/:id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','getMonth','</h5>','/upload/','warehouse','$suppliers_docs','../public/language/languages.json','$product_details.bay','product_name','$alertquantity','\x20Order\x20Number\x20:\x20','image','stocks','body','$product.type','production_date','toString','$product_details._id','$primary_code','prod_unit','due_amount','</div>','$product_details.rack','/all_purchases/view','user_id','1577576cUZxPk','note','secondary_code_hide','$product.bin','rack','392016aEoaXQ','find','$product_details.expiry_date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','edit_purchases','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','Rack\x20B','/invoice/:id','/preview/:id','$due_amount','pallet','</td>','return_purchase','batch_code','$product.room_name','logo','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','post','Shelves','<tr>','$product_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','sendMail','$product_details.product_name','currency_placement','$product.quantity','$product_details.bin','$expiry_date','Purchase\x20Mail','303724dvALCA','</span>','114834EjxjRU','$note','Floor','Enclosed','table\x20page','$product_details.primary_code','/../public','1321616dvntkE','prod_cat','Arabic\x20(ae)','prod_invoice','render','$unit','120ptbJGl','$product_details.maxProducts','padStart','get','primary_code_hide','Rack\x20F','expiry_date','purchases\x20item\x20return\x20successfull','An\x20error\x20occurred\x20while\x20saving\x20data.','Router','POnumber','Chinese','actual_qty','</tr>','aggregate','French','room','Portuguese','return_product','Ambient','\x20<\x20wew\x20>\x20','map','Email\x20sent\x20successfully','Paid\x20For\x20Purchase','secondary_unit','foreach\x20newproduct','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','floorlevel','level','role','Sales\x20Update\x20successfully','prod_Qty','$product.floorlevel','/barcode_scanner','$category','$product_details.storage','$maxProdPerUnit','currency','actual_uom','redirect','$room','forEach','length','error','prod_isle','prod_name','alertQTY','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','product_code_hide','createTransport','deliverycode','host','password','<strong>\x20Regards\x20</strong>','types','Logo.png','<hr\x20class=\x22my-3\x22>','$invoice','Error\x20Occurs','$warehouse_name','Enabled','Purchase\x20Return\x20Mail','status','$paid_amount','save','edit_purchases_view','back','return_data','Portuguese\x20(BR)','prod_pallet','maxStocks','standard_unit','product_code','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tbody>','product_list','Level','\x20</h2>','maxperunit','/view/add_purchases/:id','json','bay','$product_details.type','Spanish','<html><head><title></title>','date','<!DOCTYPE\x20html>','COLD\x20STORAGE','RoomAssign','Rack\x20E','$product_details.floorlevel','/view','suppliers','master','suppliers_docs','filter','quantity','$secondary_code','RMSEmail','/view/add_purchases','flash','product_stock','slice','email','DRY\x20STORAGE','$product_details.product_stock','isle','Raw\x20Materials','True','storage','message','finalize','user','errors','delivery_code','success','Receiving\x20Area','product','name','site_title','warehouse_name','</body></html>','all_purchases','$date','stock_data','room_name','staff','Arabic','product_cat','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','getDate','add_purchases\x20error','language','INC-','$brand','JO_number','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$_id','\x20<>\x20','$batch_code','params','$product_details.product_code','Rack\x20D','path','log','return_qty','/view/return_purchase/:id','push','rak','prod_primunit','German','invoice','$secondary_unit','$suppliers','Purchase\x20Return','$name','<tbody\x20style=\x22text-align:\x20center;\x22>','product_details','$product_details','purchase_quantity','type','1VQsPBe','stock_quantity','2840796PNlNEG','prod_secondunit','11140kYRiQj','English\x20(US)','$return_data','MaxStocks_data','findOne','Hindi','$product_details.secondary_code','purchase_invoice','prod_level','concat','string','<span\x20style=\x22float:\x20right;\x22>','Room_name','\x20Order\x20Date\x20:\x20','secondary_code','bin','primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','delivery_date','prod_code','nodemailer','$product','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','then','/CheckingWarehouse','<h5\x20style=\x22text-align:\x20left;\x22>','<div>'];a0_0x6528=function(){return _0x501b16;};return a0_0x6528();}var ejs=require('ejs');const path=require(a0_0x2793ea(0x96)),users=require(a0_0x2793ea(0xdc));router['get'](a0_0x2793ea(0x17f),auth,async(_0x2f488,_0xb6f751)=>{var _0x1cae22=a0_0x2793ea;try{const {username:_0x24b60d,email:_0x19711b,role:_0x4da358}=_0x2f488[_0x1cae22(0x194)],_0x1b0dcb=_0x2f488[_0x1cae22(0x194)],_0x25e77b=await profile[_0x1cae22(0xb0)]({'email':_0x1b0dcb[_0x1cae22(0x18b)]}),_0xaf7a64=await staff['findOne']({'email':_0x1b0dcb[_0x1cae22(0x18b)]});if(_0x1b0dcb[_0x1cae22(0x13e)]=='staff'){const _0xcae471=await staff[_0x1cae22(0xb0)]({'email':_0x1b0dcb['email']});}const _0x23167f=await master_shop[_0x1cae22(0xf5)]();let _0x1e3383;if(_0x1b0dcb[_0x1cae22(0x13e)]=='staff'){const _0x40dc83=await staff[_0x1cae22(0xb0)]({'email':_0x1b0dcb[_0x1cae22(0x18b)]});_0x1e3383=await purchases[_0x1cae22(0x12f)]([{'$match':{'warehouse_name':_0x40dc83[_0x1cae22(0xda)]}},{'$lookup':{'from':_0x1cae22(0x180),'localField':_0x1cae22(0x180),'foreignField':_0x1cae22(0x19a),'as':'suppliers_docs'}},{'$unwind':_0x1cae22(0xdb)},{'$unwind':_0x1cae22(0xc1)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x1cae22(0x82)},'warehouse_name':{'$first':_0x1cae22(0x15d)},'room':{'$first':_0x1cae22(0x149)},'product':{'$push':'$product'},'note':{'$first':_0x1cae22(0x115)},'paid_amount':{'$first':_0x1cae22(0x161)},'due_amount':{'$first':_0x1cae22(0xfe)},'return_data':{'$first':_0x1cae22(0xae)},'batch_code':{'$first':_0x1cae22(0x92)},'expiry_date':{'$first':_0x1cae22(0x110)},'suppliers_docs':{'$first':_0x1cae22(0xdb)},'total_product_quantity':{'$sum':_0x1cae22(0x10e)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1cae22(0xf2)},'type':{'$addToSet':_0x1cae22(0xe4)},'floorlevel':{'$addToSet':_0x1cae22(0x141)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x1e3383=await purchases[_0x1cae22(0x12f)]([{'$lookup':{'from':'suppliers','localField':_0x1cae22(0x180),'foreignField':_0x1cae22(0x19a),'as':_0x1cae22(0x182)}},{'$unwind':_0x1cae22(0xdb)},{'$unwind':_0x1cae22(0xc1)},{'$group':{'_id':_0x1cae22(0x90),'invoice':{'$first':_0x1cae22(0x15b)},'suppliers':{'$first':_0x1cae22(0xa0)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x1cae22(0x103)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x1cae22(0xae)},'batch_code':{'$first':_0x1cae22(0x92)},'expiry_date':{'$first':_0x1cae22(0x110)},'suppliers_docs':{'$first':_0x1cae22(0xdb)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x1cae22(0xf2)},'type':{'$addToSet':_0x1cae22(0xe4)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x23167f[0x0][_0x1cae22(0x8b)]==_0x1cae22(0xad)){var _0x161532=users[_0x1cae22(0x16b)];console[_0x1cae22(0x97)](_0x161532);}else{if(_0x23167f[0x0][_0x1cae22(0x8b)]=='Hindi')var _0x161532=users['Hindi'];else{if(_0x23167f[0x0][_0x1cae22(0x8b)]==_0x1cae22(0x9d))var _0x161532=users['German'];else{if(_0x23167f[0x0]['language']==_0x1cae22(0x177))var _0x161532=users['Spanish'];else{if(_0x23167f[0x0][_0x1cae22(0x8b)]==_0x1cae22(0x130))var _0x161532=users[_0x1cae22(0x130)];else{if(_0x23167f[0x0][_0x1cae22(0x8b)]==_0x1cae22(0x166))var _0x161532=users[_0x1cae22(0x132)];else{if(_0x23167f[0x0][_0x1cae22(0x8b)]==_0x1cae22(0x12c))var _0x161532=users[_0x1cae22(0x12c)];else{if(_0x23167f[0x0]['language']=='Arabic\x20(ae)')var _0x161532=users[_0x1cae22(0x86)];}}}}}}}_0xb6f751[_0x1cae22(0x11f)](_0x1cae22(0x81),{'success':_0x2f488[_0x1cae22(0x188)](_0x1cae22(0x197)),'errors':_0x2f488['flash'](_0x1cae22(0x195)),'purchases':_0x1e3383,'role':_0x1b0dcb,'profile':_0x25e77b,'master_shop':_0x23167f,'language':_0x161532});}catch(_0x391b84){console['log'](_0x1cae22(0x118),_0x391b84),_0xb6f751[_0x1cae22(0x160)](0xc8)[_0x1cae22(0x174)]({'message':_0x391b84['message']});}});function a0_0x5894(_0x57f0a4,_0x3f4686){var _0x6528ca=a0_0x6528();return a0_0x5894=function(_0x5894ef,_0x3b4a29){_0x5894ef=_0x5894ef-0x80;var _0x283702=_0x6528ca[_0x5894ef];return _0x283702;},a0_0x5894(_0x57f0a4,_0x3f4686);}function BayBinSelected(_0x39461d,_0x3ec211){var _0x3c0364=a0_0x2793ea,_0x2bccf8=[],_0x31b6e6=[],_0x55a804=[],_0x46b98f=[],_0x5739e9=[],_0x21156d=[];let _0x5a59be=[];if(_0x39461d==_0x3c0364(0x18c))switch(_0x3ec211){case'Rack\x20A':_0x2bccf8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x31b6e6=[0x1,0x2],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=['Level',_0x3c0364(0x116)],_0x5739e9=['D'],_0x21156d=['A'];break;case _0x3c0364(0xfb):_0x2bccf8=[0x6,0x5,0x4,0x3,0x2,0x1],_0x31b6e6=[0x1,0x2],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=[_0x3c0364(0x170),_0x3c0364(0x116)],_0x5739e9=['D'],_0x21156d=['B'];break;case _0x3c0364(0x107):_0x2bccf8=[0x0],_0x31b6e6=[0x0],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=[_0x3c0364(0x116)],_0x5739e9=['D'],_0x21156d=['S'];break;case _0x3c0364(0x198):_0x2bccf8=[0x0],_0x31b6e6=[0x0],_0x46b98f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x55a804=[_0x3c0364(0x116)],_0x5739e9=['D'],_0x21156d=['R'];break;}else{if(_0x39461d==_0x3c0364(0x17b))switch(_0x3ec211){case _0x3c0364(0xc9):_0x2bccf8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x31b6e6=['B','F'],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=[_0x3c0364(0x170),_0x3c0364(0x116)],_0x5739e9=['C'],_0x21156d=['A'];break;case _0x3c0364(0xfb):_0x2bccf8=[0x5,0x4,0x3,0x2,0x1],_0x31b6e6=['F','B','S'],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=[_0x3c0364(0x170),_0x3c0364(0x116)],_0x5739e9=['C'],_0x21156d=['B'];break;case'Rack\x20C':_0x2bccf8=[0x1,0x2,0x3,0x4,0x5],_0x31b6e6=['B','F','S'],_0x46b98f=[0x5,0x4,0x3,0x2,0x1],_0x55a804=['Level',_0x3c0364(0x116)],_0x5739e9=['C'],_0x21156d=['C'];break;case _0x3c0364(0x95):_0x2bccf8=[0x5,0x4,0x3,0x2,0x1],_0x31b6e6=['F','B','S'],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=[_0x3c0364(0x170),_0x3c0364(0x116)],_0x5739e9=['C'],_0x21156d=['D'];break;case _0x3c0364(0x17d):_0x2bccf8=[0x4,0x3,0x2,0x1],_0x31b6e6=[0x1,0x2],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=['Level','Floor'],_0x5739e9=['C'],_0x21156d=['E'];break;case _0x3c0364(0x126):_0x2bccf8=[0x1,0x2,0x3],_0x31b6e6=[0x1,0x2],_0x46b98f=[0x1,0x2,0x3,0x4,0x5],_0x55a804=[_0x3c0364(0x170)],_0x5739e9=['C'],_0x21156d=['F'];break;}}return{'levels':_0x2bccf8,'Isle':_0x31b6e6,'rack':_0x46b98f,'type':_0x55a804,'storage':_0x5739e9,'rak':_0x21156d};}async function getRandom8DigitNumber(){var _0x475929=a0_0x2793ea;const _0x155d5f=0x989680,_0x17fcb3=0x5f5e0ff,_0x4670ca=Math['floor'](Math['random']()*(_0x17fcb3-_0x155d5f+0x1))+_0x155d5f;var _0x4f4572;const _0x27d44e=await purchases['findOne']({'invoice':'INC-'+_0x4670ca});return _0x27d44e&&_0x27d44e[_0x475929(0x14b)]>0x0?_0x4f4572=_0x475929(0x8c)+_0x4670ca:_0x4f4572=_0x475929(0x8c)+_0x4670ca,_0x4f4572;}router['get'](a0_0x2793ea(0x187),auth,async(_0x1bd974,_0x172e23)=>{var _0x59612e=a0_0x2793ea;try{const {username:_0x1ba217,email:_0x241efb,role:_0x142377}=_0x1bd974[_0x59612e(0x194)],_0x436ca9=_0x1bd974['user'],_0x1e12cb=await profile[_0x59612e(0xb0)]({'email':_0x436ca9[_0x59612e(0x18b)]}),_0x58ad1b=await master_shop['find'](),_0x12b4ec=await staff[_0x59612e(0xb0)]({'email':_0x436ca9['email']}),_0x5865dc=await suppliers['find']({});let _0x346f33;if(_0x436ca9[_0x59612e(0x13e)]=='staff'){const _0x26b284=await staff['findOne']({'email':_0x436ca9[_0x59612e(0x18b)]});_0x346f33=await warehouse[_0x59612e(0x12f)]([{'$match':{'status':_0x59612e(0x15e),'name':_0x26b284[_0x59612e(0xda)],'warehouse_category':_0x59612e(0x18f),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x59612e(0xa2),'name':{'$first':'$name'}}}]);}else _0x346f33=await warehouse[_0x59612e(0x12f)]([{'$match':{'status':_0x59612e(0x15e),'warehouse_category':_0x59612e(0x18f),'name':{'$ne':_0x59612e(0x150)}}},{'$group':{'_id':_0x59612e(0xa2),'name':{'$first':_0x59612e(0xa2)}}}]);const _0x3c4ca8=await product['find']({}),_0x384688=await warehouse['find']({'status':_0x59612e(0x15e)}),_0x576d72=await purchases[_0x59612e(0xf5)]({}),_0x1ec622=_0x576d72['length']+0x1,_0x4180ba='INC-'+_0x1ec622[_0x59612e(0xe6)]()[_0x59612e(0x123)](0x5,'0');var _0x320d02=[_0x59612e(0x134),_0x59612e(0x117)];if(_0x58ad1b[0x0][_0x59612e(0x8b)]==_0x59612e(0xad))var _0xe3c2e5=users[_0x59612e(0x16b)];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]==_0x59612e(0xb1))var _0xe3c2e5=users['Hindi'];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]==_0x59612e(0x9d))var _0xe3c2e5=users[_0x59612e(0x9d)];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]==_0x59612e(0x177))var _0xe3c2e5=users[_0x59612e(0x177)];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]=='French')var _0xe3c2e5=users[_0x59612e(0x130)];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]=='Portuguese\x20(BR)')var _0xe3c2e5=users[_0x59612e(0x132)];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]=='Chinese')var _0xe3c2e5=users['Chinese'];else{if(_0x58ad1b[0x0][_0x59612e(0x8b)]=='Arabic\x20(ae)')var _0xe3c2e5=users['Arabic'];}}}}}}}const _0x1feaa6=getRandom8DigitNumber();_0x1feaa6[_0x59612e(0xc4)](_0x24ff8b=>{var _0x325d75=_0x59612e;_0x172e23[_0x325d75(0x11f)]('add_purchases',{'success':_0x1bd974[_0x325d75(0x188)](_0x325d75(0x197)),'errors':_0x1bd974['flash']('errors'),'role':_0x436ca9,'profile':_0x1e12cb,'suppliers':_0x5865dc,'warehouse':_0x346f33,'product':_0x3c4ca8,'invoice':_0x24ff8b,'master_shop':_0x58ad1b,'language':_0xe3c2e5,'find_data':_0x384688,'rooms_data':_0x320d02});})['catch'](_0x43aa15=>{var _0x399600=_0x59612e;_0x1bd974[_0x399600(0x188)](_0x399600(0x195),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x172e23[_0x399600(0x148)]('/all_purchases/view');});}catch(_0x8cb26f){console[_0x59612e(0x97)](_0x8cb26f);}}),router[a0_0x2793ea(0x124)](a0_0x2793ea(0x173),auth,async(_0x120fce,_0x566396)=>{var _0x1792bc=a0_0x2793ea;try{const _0x219841=_0x120fce[_0x1792bc(0x93)]['id'];console[_0x1792bc(0x97)](_0x219841);const _0x6978ca=await master_shop[_0x1792bc(0xf5)]();console[_0x1792bc(0x97)]('master',_0x6978ca);const _0x5f2f72=await product[_0x1792bc(0xb0)]({'name':_0x219841});console[_0x1792bc(0x97)](_0x1792bc(0x199),_0x5f2f72),_0x566396[_0x1792bc(0x160)](0xc8)[_0x1792bc(0x174)]({'product_data':_0x5f2f72,'master':_0x6978ca});}catch(_0x3af129){console[_0x1792bc(0x97)](_0x1792bc(0x8a),_0x3af129);}}),router[a0_0x2793ea(0x106)](a0_0x2793ea(0x187),auth,async(_0x17e403,_0x488be9)=>{var _0x38cae1=a0_0x2793ea;try{const {invoice:_0x31659c,date:_0x25dac1,warehouse_name:_0x4deff3,prod_name:_0x10eb46,prod_code:_0x4ed314,prod_qty:_0x2f5b78,prod_unit:_0x51b90b,prod_secondunit:_0x4abd58,prod_level:_0x1c73ec,prod_isle:_0x403c12,prod_pallet:_0x4f9b79,note:_0x2a5bb9,expiry_date:_0x1b4478,batch_code:_0x3981bb,payable:_0x1deb36,due_amount:_0x3f2045,Room_name:_0x248293,primary_code:_0x3d4784,secondary_code:_0x43cccf,MaxStocks_data:_0x59ae7d,PO_number:_0x51f8a7,SCRN:_0x21ff8d,JO_number:_0x1b11f9}=_0x17e403['body'];if(typeof _0x10eb46==_0x38cae1(0xb6))var _0x3a5380=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x14e)]],_0x34f8d7=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0xbf)]],_0x37d95d=[_0x17e403['body'][_0x38cae1(0x140)]],_0x49a7a1=[_0x17e403[_0x38cae1(0xe3)]['prod_primunit']],_0xa6ffd0=[_0x17e403[_0x38cae1(0xe3)]['prod_secondunit']],_0x5a3851=[_0x17e403['body']['prod_level']],_0x28af05=[_0x17e403[_0x38cae1(0xe3)]['primary_code']],_0x14e425=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0xba)]],_0x21d23d=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0xaf)]],_0x89357e=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x102)]],_0x4993f6=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x127)]],_0x5b7a98=[_0x17e403[_0x38cae1(0xe3)]['max_product_unit']],_0x341839=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x14f)]],_0x1628d8=[_0x17e403[_0x38cae1(0xe3)]['production_date']],_0x3776a3=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x11c)]],_0x399c12=[_0x17e403['body'][_0x38cae1(0x17c)]],_0x25f913=[_0x17e403[_0x38cae1(0xe3)]['deliverycode']],_0x5de6fb=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x11e)]],_0x4057a3=[_0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x12d)]],_0x59be08=[_0x17e403[_0x38cae1(0xe3)]['actual_uom']];else var _0x3a5380=[..._0x17e403[_0x38cae1(0xe3)]['prod_name']],_0x34f8d7=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0xbf)]],_0x37d95d=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x140)]],_0x49a7a1=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x9c)]],_0xa6ffd0=[..._0x17e403['body'][_0x38cae1(0xab)]],_0x5a3851=[..._0x17e403['body'][_0x38cae1(0xb4)]],_0x28af05=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0xbc)]],_0x14e425=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0xba)]],_0x21d23d=[..._0x17e403['body'][_0x38cae1(0xaf)]],_0x89357e=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x102)]],_0x4993f6=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x127)]],_0x5b7a98=[..._0x17e403[_0x38cae1(0xe3)]['max_product_unit']],_0x341839=[..._0x17e403[_0x38cae1(0xe3)]['alertQTY']],_0x1628d8=[..._0x17e403[_0x38cae1(0xe3)]['production_date']],_0x3776a3=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x11c)]],_0x399c12=[..._0x17e403['body'][_0x38cae1(0x17c)]],_0x25f913=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x154)]],_0x5de6fb=[..._0x17e403['body'][_0x38cae1(0x11e)]],_0x4057a3=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x12d)]],_0x59be08=[..._0x17e403[_0x38cae1(0xe3)][_0x38cae1(0x147)]];const _0xcc3f42=_0x3a5380[_0x38cae1(0x136)](_0x52185d=>{return _0x52185d={'product_name':_0x52185d};});_0x4057a3[_0x38cae1(0x14a)]((_0x3dd6e6,_0x50006b)=>{var _0x1a5f07=_0x38cae1;_0xcc3f42[_0x50006b][_0x1a5f07(0x12d)]=_0x3dd6e6;}),_0x59be08[_0x38cae1(0x14a)]((_0x6a68a0,_0x37ad33)=>{_0xcc3f42[_0x37ad33]['actual_uom']=_0x6a68a0;}),_0x34f8d7[_0x38cae1(0x14a)]((_0x286f62,_0x5718d6)=>{_0xcc3f42[_0x5718d6]['product_code']=_0x286f62;}),_0x37d95d['forEach']((_0x593a3e,_0x585c74)=>{var _0x24628f=_0x38cae1;_0xcc3f42[_0x585c74][_0x24628f(0x184)]=_0x593a3e;}),_0x49a7a1[_0x38cae1(0x14a)]((_0x2c3d15,_0x5776b4)=>{var _0x2ba282=_0x38cae1;_0xcc3f42[_0x5776b4][_0x2ba282(0x169)]=_0x2c3d15;}),_0xa6ffd0[_0x38cae1(0x14a)]((_0x1018eb,_0x4d273f)=>{var _0x398bbc=_0x38cae1;_0xcc3f42[_0x4d273f][_0x398bbc(0x139)]=_0x1018eb;}),_0x5a3851[_0x38cae1(0x14a)]((_0x482ea8,_0x10cb0f)=>{var _0xf925f9=_0x38cae1;_0x399c12[_0xf925f9(0x14a)]((_0x159a6a,_0x16628a)=>{var _0x33a77a=_0xf925f9;if(_0x159a6a=='Receiving\x20Area'&&_0x10cb0f==_0x16628a){console['log'](_0x159a6a+_0x33a77a(0x135)+_0x10cb0f+_0x33a77a(0x91)+_0x16628a+_0x33a77a(0x91)+_0x482ea8);var _0x20c052=_0x482ea8['slice'](0x3);_0xcc3f42[_0x10cb0f][_0x33a77a(0x191)]=_0x482ea8[0x0],_0xcc3f42[_0x10cb0f][_0x33a77a(0xf3)]=_0x482ea8[0x1],_0xcc3f42[_0x10cb0f][_0x33a77a(0x175)]=0x0,_0xcc3f42[_0x10cb0f][_0x33a77a(0xbb)]=0x0,_0xcc3f42[_0x10cb0f][_0x33a77a(0xa7)]=_0x33a77a(0x116),_0xcc3f42[_0x10cb0f][_0x33a77a(0x13c)]=_0x20c052;}else{if(_0x159a6a==_0x33a77a(0x107)&&_0x10cb0f==_0x16628a){var _0x20c052=_0x482ea8[_0x33a77a(0x18a)](0x3);_0xcc3f42[_0x10cb0f][_0x33a77a(0x191)]=_0x482ea8[0x0],_0xcc3f42[_0x10cb0f][_0x33a77a(0xf3)]=_0x482ea8[0x1],_0xcc3f42[_0x10cb0f][_0x33a77a(0x175)]=0x0,_0xcc3f42[_0x10cb0f][_0x33a77a(0xbb)]=0x0,_0xcc3f42[_0x10cb0f][_0x33a77a(0xa7)]=_0x33a77a(0x116),_0xcc3f42[_0x10cb0f][_0x33a77a(0x13c)]=_0x482ea8[0x5];}else{if(_0x10cb0f==_0x16628a){var _0x2d7e2d;if(_0x482ea8[0x4]=='L')_0x2d7e2d=_0x33a77a(0x170);else _0x482ea8[0x4]=='F'&&(_0x2d7e2d=_0x33a77a(0x116));_0xcc3f42[_0x10cb0f][_0x33a77a(0x191)]=_0x482ea8[0x0],_0xcc3f42[_0x10cb0f][_0x33a77a(0xf3)]=_0x482ea8[0x1],_0xcc3f42[_0x10cb0f][_0x33a77a(0x175)]=_0x482ea8[0x2],_0xcc3f42[_0x10cb0f][_0x33a77a(0xbb)]=_0x482ea8[0x3],_0xcc3f42[_0x10cb0f][_0x33a77a(0xa7)]=_0x2d7e2d,_0xcc3f42[_0x10cb0f][_0x33a77a(0x13c)]=_0x482ea8[0x5];}}}});}),_0x28af05[_0x38cae1(0x14a)]((_0x9b4dc2,_0xdc39dd)=>{var _0xc405cc=_0x38cae1;_0xcc3f42[_0xdc39dd][_0xc405cc(0xbc)]=_0x9b4dc2;}),_0x14e425['forEach']((_0x4c3cc3,_0x595f2a)=>{var _0x5f496c=_0x38cae1;_0xcc3f42[_0x595f2a][_0x5f496c(0xba)]=_0x4c3cc3;}),_0x21d23d['forEach']((_0x437e09,_0x295db9)=>{var _0x50ad6d=_0x38cae1;_0xcc3f42[_0x295db9][_0x50ad6d(0x168)]=_0x437e09;}),_0x89357e[_0x38cae1(0x14a)]((_0x3e6fa4,_0x43bd34)=>{var _0x3becb3=_0x38cae1;_0xcc3f42[_0x43bd34][_0x3becb3(0x102)]=_0x3e6fa4;}),_0x4993f6[_0x38cae1(0x14a)]((_0x48d085,_0x3ca83e)=>{_0xcc3f42[_0x3ca83e]['expiry_date']=_0x48d085;}),_0x5b7a98[_0x38cae1(0x14a)]((_0x127506,_0x5e84bc)=>{var _0x221e66=_0x38cae1;_0xcc3f42[_0x5e84bc][_0x221e66(0x172)]=_0x127506;}),_0x341839[_0x38cae1(0x14a)]((_0x4afd4d,_0x567acd)=>{_0xcc3f42[_0x567acd]['alertQTY']=_0x4afd4d;}),_0x1628d8[_0x38cae1(0x14a)]((_0x2979ba,_0x4dfc43)=>{var _0x202dce=_0x38cae1;_0xcc3f42[_0x4dfc43][_0x202dce(0xe5)]=_0x2979ba;}),_0x3776a3['forEach']((_0x17e14f,_0x540864)=>{var _0x4af3d4=_0x38cae1;_0xcc3f42[_0x540864][_0x4af3d4(0x87)]=_0x17e14f;}),_0x399c12[_0x38cae1(0x14a)]((_0x45c6e3,_0x372692)=>{var _0x4f9986=_0x38cae1;_0xcc3f42[_0x372692][_0x4f9986(0x84)]=_0x45c6e3;}),_0x25f913[_0x38cae1(0x14a)]((_0x575113,_0x47f4b5)=>{var _0x1075f9=_0x38cae1;_0xcc3f42[_0x47f4b5][_0x1075f9(0x196)]=_0x575113;}),_0x5de6fb[_0x38cae1(0x14a)]((_0x12db5d,_0x248b6a)=>{var _0x458a0c=_0x38cae1;_0xcc3f42[_0x248b6a][_0x458a0c(0x9e)]=_0x12db5d;});const _0x7a67d6=_0x399c12['map'](_0x186606=>{return _0x186606={'room_name':_0x186606};}),_0x5d49ca=_0xcc3f42['filter'](_0x38773f=>_0x38773f[_0x38cae1(0x184)]!=='0'&&_0x38773f[_0x38cae1(0x184)]!==''),_0x275961=new purchases({'invoice':_0x31659c,'suppliers':_0x17e403['body'][_0x38cae1(0x180)],'date':_0x25dac1,'warehouse_name':_0x4deff3,'product':_0x5d49ca,'note':_0x2a5bb9,'due_amount':_0x3f2045,'POnumber':_0x51f8a7,'SCRN':_0x21ff8d,'JO_number':_0x1b11f9,'roomList':_0x7a67d6}),_0x4921a0=await _0x275961[_0x38cae1(0x162)](),_0x4aca3f=await purchases[_0x38cae1(0xb0)]({'invoice':_0x31659c}),_0x280afd=_0x4aca3f[_0x38cae1(0x199)][_0x38cae1(0x136)](async _0x137a23=>{var _0x1be652=_0x38cae1,_0x39d339=await warehouse[_0x1be652(0xb0)]({'name':_0x4deff3,'room':_0x137a23[_0x1be652(0x84)]}),_0x434d06=0x0;return _0x39d339['product_details']['forEach'](_0x3c5e0f=>{var _0x507ae3=_0x1be652;_0x3c5e0f[_0x507ae3(0xde)]==_0x137a23[_0x507ae3(0xde)]&&_0x3c5e0f[_0x507ae3(0x13c)]==_0x137a23[_0x507ae3(0x13c)]&&_0x3c5e0f['type']==_0x137a23[_0x507ae3(0xa7)]&&_0x3c5e0f['bin']==_0x137a23[_0x507ae3(0xbb)]&&_0x3c5e0f[_0x507ae3(0x175)]==_0x137a23[_0x507ae3(0x175)]&&_0x3c5e0f[_0x507ae3(0xf3)]==_0x137a23['rack']&&_0x3c5e0f[_0x507ae3(0x191)]==_0x137a23[_0x507ae3(0x191)]&&_0x3c5e0f['expiry_date']==_0x137a23['expiry_date']&&_0x3c5e0f[_0x507ae3(0x102)]==_0x137a23['batch_code']&&_0x3c5e0f['production_date']==_0x137a23['production_date']&&_0x3c5e0f[_0x507ae3(0x9e)]==_0x4aca3f[_0x507ae3(0x9e)]&&(_0x3c5e0f[_0x507ae3(0x189)]+=_0x137a23[_0x507ae3(0x184)],_0x434d06++);}),_0x434d06===0x0&&_0x39d339[_0x1be652(0xa4)][_0x1be652(0x9a)]({'product_name':_0x137a23[_0x1be652(0xde)],'product_stock':_0x137a23[_0x1be652(0x184)],'primary_code':_0x137a23[_0x1be652(0xbc)],'secondary_code':_0x137a23['secondary_code'],'product_code':_0x137a23[_0x1be652(0x16a)],'storage':_0x137a23[_0x1be652(0x191)],'rack':_0x137a23[_0x1be652(0xf3)],'bay':_0x137a23['bay'],'bin':_0x137a23[_0x1be652(0xbb)],'type':_0x137a23[_0x1be652(0xa7)],'floorlevel':_0x137a23['floorlevel'],'maxProducts':_0x137a23[_0x1be652(0x168)],'unit':_0x137a23[_0x1be652(0x169)],'secondary_unit':_0x137a23[_0x1be652(0x139)],'expiry_date':_0x137a23['expiry_date'],'maxPerUnit':_0x137a23[_0x1be652(0x172)],'batch_code':_0x137a23[_0x1be652(0x102)],'alertQTY':_0x137a23[_0x1be652(0x14f)],'production_date':_0x137a23[_0x1be652(0xe5)],'product_cat':_0x137a23['product_cat'],'invoice':_0x137a23[_0x1be652(0x9e)],'actual_qty':_0x137a23[_0x1be652(0x12d)],'actual_uom':_0x137a23[_0x1be652(0x147)]}),_0x39d339;});Promise[_0x38cae1(0xce)](_0x280afd)[_0x38cae1(0xc4)](async _0x1a2475=>{var _0x1d5867=_0x38cae1;try{for(const _0x358376 of _0x1a2475){await _0x358376[_0x1d5867(0x162)]();}const _0x48ac7c=await master_shop[_0x1d5867(0xf5)](),_0x4fcc26=await email_settings[_0x1d5867(0xb0)](),_0x152cbc=await supervisor_settings[_0x1d5867(0xf5)]();var _0x48b290=_0x4aca3f[_0x1d5867(0x199)],_0xa8c7a2='',_0x3ce116;for(_0x3ce116 in _0x48b290){_0xa8c7a2+=_0x1d5867(0x108)+_0x1d5867(0x10a)+_0x48b290[_0x3ce116]['product_name']+'</td>'+_0x1d5867(0x10a)+_0x48b290[_0x3ce116][_0x1d5867(0x16a)]+_0x1d5867(0x100)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48b290[_0x3ce116]['quantity']+'</td>'+_0x1d5867(0x10a)+_0x48b290[_0x3ce116][_0x1d5867(0x169)]+_0x1d5867(0x100)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48b290[_0x3ce116][_0x1d5867(0x139)]+_0x1d5867(0x100)+_0x1d5867(0x10a)+_0x4aca3f['warehouse_name']+_0x1d5867(0x100)+_0x1d5867(0x10a)+_0x48b290[_0x3ce116][_0x1d5867(0x84)]+_0x1d5867(0x100)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48b290[_0x3ce116][_0x1d5867(0x191)]+_0x48b290[_0x3ce116][_0x1d5867(0xf3)]+_0x48b290[_0x3ce116][_0x1d5867(0x175)]+_0x48b290[_0x3ce116][_0x1d5867(0xbb)]+_0x48b290[_0x3ce116][_0x1d5867(0xa7)][0x0]+_0x48b290[_0x3ce116]['floorlevel']+_0x1d5867(0x100),'</tr>';}let _0x652d84=nodemailer[_0x1d5867(0x153)]({'host':_0x4fcc26[_0x1d5867(0x155)],'port':Number(_0x4fcc26['port']),'secure':![],'auth':{'user':_0x4fcc26['email'],'pass':_0x4fcc26[_0x1d5867(0x156)]}}),_0x3a28e4={'from':_0x4fcc26['email'],'to':_0x152cbc[0x0][_0x1d5867(0x186)],'subject':_0x1d5867(0x111),'attachments':[{'filename':_0x1d5867(0x159),'path':__dirname+'/../public'+_0x1d5867(0xd9)+_0x48ac7c[0x0][_0x1d5867(0xe1)],'cid':_0x1d5867(0x104)}],'html':'<!DOCTYPE\x20html>'+_0x1d5867(0x178)+_0x1d5867(0xcf)+'<div>'+_0x1d5867(0x105)+_0x1d5867(0xc7)+_0x1d5867(0x13b)+_0x1d5867(0xeb)+_0x1d5867(0xc7)+_0x1d5867(0xd2)+_0x48ac7c[0x0][_0x1d5867(0x19b)]+_0x1d5867(0x171)+'</div>'+_0x1d5867(0xeb)+_0x1d5867(0x15a)+'<div>'+_0x1d5867(0xc6)+_0x1d5867(0xe0)+_0x4aca3f[_0x1d5867(0x9e)]+'\x20'+_0x1d5867(0xb7)+_0x1d5867(0xb9)+_0x4aca3f[_0x1d5867(0x179)]+'\x20'+_0x1d5867(0x113)+'</h5>'+_0x1d5867(0xeb)+_0x1d5867(0xf7)+_0x1d5867(0xd6)+_0x1d5867(0x108)+_0x1d5867(0x88)+_0x1d5867(0x151)+_0x1d5867(0xbd)+_0x1d5867(0x16d)+_0x1d5867(0x16c)+_0x1d5867(0x8f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x1d5867(0x12e)+_0x1d5867(0xcc)+_0x1d5867(0xa3)+'\x20'+_0xa8c7a2+'\x20'+_0x1d5867(0x16e)+_0x1d5867(0xcd)+_0x1d5867(0xc7)+_0x1d5867(0x157)+'<h5>'+_0x48ac7c[0x0][_0x1d5867(0x19b)]+_0x1d5867(0xd8)+'</div>'+_0x1d5867(0xeb)+_0x1d5867(0x80)};_0x652d84[_0x1d5867(0x10b)](_0x3a28e4,function(_0x26211b,_0x2cb6f3){var _0x5d31dc=_0x1d5867;_0x26211b?(console[_0x5d31dc(0x97)](_0x26211b),console[_0x5d31dc(0x97)](_0x5d31dc(0x15c))):console[_0x5d31dc(0x97)](_0x5d31dc(0x137));}),_0x17e403[_0x1d5867(0x188)]('success','Purchase\x20data\x20added\x20successfully'),_0x488be9[_0x1d5867(0x148)]('/all_purchases/view/');}catch(_0x22ac02){console[_0x1d5867(0x14c)](_0x22ac02),_0x488be9['status'](0x1f4)[_0x1d5867(0x174)]({'error':_0x1d5867(0x129)});}})[_0x38cae1(0xd1)](_0x2ac09f=>{var _0x56b4e6=_0x38cae1;console[_0x56b4e6(0x14c)](_0x2ac09f),_0x488be9[_0x56b4e6(0x160)](0x1f4)[_0x56b4e6(0x174)]({'error':_0x56b4e6(0xca)});});}catch(_0x227ae7){console[_0x38cae1(0x97)](_0x227ae7);}}),router[a0_0x2793ea(0x124)](a0_0x2793ea(0xfd),auth,async(_0x300759,_0x67168e)=>{var _0x658eb5=a0_0x2793ea;try{const {username:_0x3fbec4,email:_0x5d5b2f,role:_0x4e39a3}=_0x300759['user'],_0x2cc4e6=_0x300759[_0x658eb5(0x194)],_0xf0893c=await profile[_0x658eb5(0xb0)]({'email':_0x2cc4e6['email']}),_0x2d1ae9=await master_shop[_0x658eb5(0xf5)](),_0x202da8=_0x300759[_0x658eb5(0x93)]['id'],_0xbfa6e2=await purchases[_0x658eb5(0xf9)](_0x202da8),_0x10076e=await warehouse[_0x658eb5(0x12f)]([{'$match':{'name':_0xbfa6e2[_0x658eb5(0x19c)],'room':_0xbfa6e2[_0x658eb5(0x131)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x658eb5(0x10c)},'product_stock':{'$first':_0x658eb5(0x18d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x658eb5(0x10f)},'type':{'$first':_0x658eb5(0x176)},'floorlevel':{'$first':_0x658eb5(0x17e)},'primary_code':{'$first':_0x658eb5(0x119)},'secondary_code':{'$first':_0x658eb5(0xb2)},'product_code':{'$first':_0x658eb5(0x94)},'storage':{'$first':_0x658eb5(0x144)},'rack':{'$first':_0x658eb5(0xec)},'expiry_date':{'$first':_0x658eb5(0xf6)}}}]),_0x4ce8e2=await customer[_0x658eb5(0xf5)]({});let _0xc90ce1;if(_0x2cc4e6[_0x658eb5(0x13e)]==_0x658eb5(0x85)){const _0x5ad28c=await staff['findOne']({'email':_0x2cc4e6[_0x658eb5(0x18b)]});_0xc90ce1=await warehouse[_0x658eb5(0x12f)]([{'$match':{'status':_0x658eb5(0x15e),'name':_0x5ad28c[_0x658eb5(0xda)]}},{'$group':{'_id':_0x658eb5(0xa2),'name':{'$first':_0x658eb5(0xa2)}}}]);}else _0xc90ce1=await warehouse[_0x658eb5(0x12f)]([{'$match':{'status':_0x658eb5(0x15e)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x453e3c=await product[_0x658eb5(0xf5)]({}),_0x158ef0=await suppliers[_0x658eb5(0xf5)]({}),_0x40340d=BayBinSelected(_0xbfa6e2[_0x658eb5(0x19c)],_0xbfa6e2[_0x658eb5(0x131)]);if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]==_0x658eb5(0xad)){var _0xfffe0a=users[_0x658eb5(0x16b)];console['log'](_0xfffe0a);}else{if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]=='Hindi')var _0xfffe0a=users[_0x658eb5(0xb1)];else{if(_0x2d1ae9[0x0]['language']==_0x658eb5(0x9d))var _0xfffe0a=users[_0x658eb5(0x9d)];else{if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]==_0x658eb5(0x177))var _0xfffe0a=users[_0x658eb5(0x177)];else{if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]==_0x658eb5(0x130))var _0xfffe0a=users['French'];else{if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]=='Portuguese\x20(BR)')var _0xfffe0a=users[_0x658eb5(0x132)];else{if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]==_0x658eb5(0x12c))var _0xfffe0a=users[_0x658eb5(0x12c)];else{if(_0x2d1ae9[0x0][_0x658eb5(0x8b)]==_0x658eb5(0x11d))var _0xfffe0a=users[_0x658eb5(0x86)];}}}}}}}_0x67168e[_0x658eb5(0x11f)](_0x658eb5(0x163),{'success':_0x300759[_0x658eb5(0x188)]('success'),'errors':_0x300759[_0x658eb5(0x188)](_0x658eb5(0x195)),'role':_0x2cc4e6,'profile':_0xf0893c,'customer':_0x4ce8e2,'warehouse':_0xc90ce1,'product':_0x10076e,'user':_0xbfa6e2,'master_shop':_0x2d1ae9,'unit':_0x453e3c,'language':_0xfffe0a,'suppliers':_0x158ef0,'dataSelected':_0x40340d});}catch(_0x46a1c4){console[_0x658eb5(0x97)](_0x46a1c4);}}),router['post']('/preview/:id',auth,async(_0xd5a0af,_0x19426a)=>{var _0x5a9176=a0_0x2793ea;try{const _0x4c8068=_0xd5a0af[_0x5a9176(0x93)]['id'],{invoice:_0x1492d6,warehouse_name:_0x58ab57,Room_name:_0x1724b9}=_0xd5a0af[_0x5a9176(0xe3)],_0x157517=await warehouse['findOne']({'name':_0x58ab57,'room':_0x1724b9}),_0x5aa69f=await purchases['findOne']({'invoice':_0x1492d6});_0x5aa69f['product']['forEach'](_0x308fe7=>{var _0x52c44f=_0x5a9176,_0x2dc470=0x0;const _0x503f60=_0x157517[_0x52c44f(0xa4)]['map'](_0x46a08a=>{var _0x58d4fe=_0x52c44f;_0x46a08a[_0x58d4fe(0xde)]==_0x308fe7[_0x58d4fe(0xde)]&&_0x46a08a[_0x58d4fe(0x13c)]==_0x308fe7[_0x58d4fe(0x13c)]&&_0x46a08a['type']==_0x308fe7[_0x58d4fe(0xa7)]&&_0x46a08a[_0x58d4fe(0xbb)]==_0x308fe7[_0x58d4fe(0xbb)]&&_0x46a08a['bay']==_0x308fe7[_0x58d4fe(0x175)]&&_0x46a08a[_0x58d4fe(0xf3)]==_0x308fe7['rack']&&_0x46a08a[_0x58d4fe(0x191)]==_0x308fe7[_0x58d4fe(0x191)]&&_0x46a08a[_0x58d4fe(0x127)]==_0x308fe7[_0x58d4fe(0x127)]&&_0x46a08a[_0x58d4fe(0x102)]==_0x308fe7[_0x58d4fe(0x102)]&&_0x46a08a[_0x58d4fe(0xe5)]==_0x308fe7[_0x58d4fe(0xe5)]&&_0x46a08a['delivery_date']==_0x308fe7[_0x58d4fe(0xbe)]&&_0x46a08a[_0x58d4fe(0x196)]==_0x308fe7[_0x58d4fe(0x196)]&&(_0x46a08a[_0x58d4fe(0x189)]=parseInt(_0x46a08a['product_stock'])+parseInt(_0x308fe7[_0x58d4fe(0x184)]),_0x2dc470++);});_0x2dc470=='0'&&(_0x157517['product_details']=_0x157517[_0x52c44f(0xa4)][_0x52c44f(0xb5)]({'product_name':_0x308fe7['product_name'],'product_stock':_0x308fe7[_0x52c44f(0x184)],'primary_code':_0x308fe7['primary_code'],'secondary_code':_0x308fe7['secondary_code'],'product_code':_0x308fe7['product_code'],'storage':_0x308fe7['storage'],'rack':_0x308fe7[_0x52c44f(0xf3)],'bay':_0x308fe7[_0x52c44f(0x175)],'bin':_0x308fe7['bin'],'type':_0x308fe7[_0x52c44f(0xa7)],'floorlevel':_0x308fe7[_0x52c44f(0x13c)],'maxProducts':_0x308fe7[_0x52c44f(0x168)],'unit':_0x308fe7[_0x52c44f(0x169)],'secondary_unit':_0x308fe7[_0x52c44f(0x139)],'expiry_date':_0x308fe7[_0x52c44f(0x127)],'maxPerUnit':_0x308fe7[_0x52c44f(0x172)],'batch_code':_0x308fe7[_0x52c44f(0x102)],'alertQTY':_0x308fe7[_0x52c44f(0x14f)],'production_date':_0x308fe7[_0x52c44f(0xe5)],'delivery_date':_0x308fe7['delivery_date'],'delivery_code':_0x308fe7['delivery_code']}));}),await _0x157517[_0x5a9176(0x162)](),_0x5aa69f[_0x5a9176(0x193)]='True';const _0x3f2321=await _0x5aa69f['save']();_0xd5a0af['flash'](_0x5a9176(0x197),_0x5a9176(0x13f)),_0x19426a[_0x5a9176(0x148)](_0x5a9176(0xed));}catch(_0x49e85d){console[_0x5a9176(0x97)](_0x49e85d);}}),router[a0_0x2793ea(0x124)](a0_0x2793ea(0xc8),auth,async(_0x1e2bd6,_0x1aab0f)=>{var _0x26aee4=a0_0x2793ea;try{const {username:_0x4e77bf,email:_0xb6d7ac,role:_0x5f10d5}=_0x1e2bd6[_0x26aee4(0x194)],_0x59bc97=_0x1e2bd6['user'],_0x2c9b71=await profile['findOne']({'email':_0x59bc97['email']}),_0x3494ac=await master_shop[_0x26aee4(0xf5)](),_0x5cf8ab=_0x1e2bd6[_0x26aee4(0x93)]['id'],_0x5690eb=await purchases[_0x26aee4(0xf9)](_0x5cf8ab),_0x53a430=await suppliers['find']({});let _0x41918b;if(_0x59bc97['role']=='staff'){const _0x1e2a04=await staff['findOne']({'email':_0x59bc97['email']});_0x41918b=await warehouse[_0x26aee4(0xf5)]({'status':_0x26aee4(0x15e),'name':_0x1e2a04[_0x26aee4(0xda)],'warehouse_category':_0x26aee4(0x18f)});}else _0x41918b=await warehouse[_0x26aee4(0x12f)]([{'$match':{'status':'Enabled','warehouse_category':_0x26aee4(0x18f)}},{'$group':{'_id':_0x26aee4(0xa2),'name':{'$first':_0x26aee4(0xa2)}}}]);const _0x5e431e=await product[_0x26aee4(0xf5)]({}),_0x5045a6=BayBinSelected(_0x5690eb[_0x26aee4(0x19c)],_0x5690eb[_0x26aee4(0x131)]);let _0x5629ff=new Date(_0x5690eb[_0x26aee4(0x127)]),_0x402a3b=('0'+_0x5629ff[_0x26aee4(0x89)]())[_0x26aee4(0x18a)](-0x2),_0x24b439=('0'+(_0x5629ff[_0x26aee4(0xd7)]()+0x1))[_0x26aee4(0x18a)](-0x2),_0x2dd1e1=_0x5629ff['getFullYear'](),_0x4a6195=_0x2dd1e1+'-'+_0x24b439+'-'+_0x402a3b;if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0xad)){var _0x514fb3=users[_0x26aee4(0x16b)];console[_0x26aee4(0x97)](_0x514fb3);}else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0xb1))var _0x514fb3=users[_0x26aee4(0xb1)];else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0x9d))var _0x514fb3=users['German'];else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0x177))var _0x514fb3=users[_0x26aee4(0x177)];else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0x130))var _0x514fb3=users['French'];else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0x166))var _0x514fb3=users[_0x26aee4(0x132)];else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0x12c))var _0x514fb3=users[_0x26aee4(0x12c)];else{if(_0x3494ac[0x0][_0x26aee4(0x8b)]==_0x26aee4(0x11d))var _0x514fb3=users[_0x26aee4(0x86)];}}}}}}}_0x1aab0f['render'](_0x26aee4(0xf8),{'success':_0x1e2bd6[_0x26aee4(0x188)](_0x26aee4(0x197)),'errors':_0x1e2bd6[_0x26aee4(0x188)](_0x26aee4(0x195)),'role':_0x59bc97,'profile':_0x2c9b71,'purchases':_0x5690eb,'suppliers':_0x53a430,'warehouse':_0x41918b,'product':_0x5e431e,'master_shop':_0x3494ac,'language':_0x514fb3,'ed_fullDate':_0x4a6195,'dataSelected':_0x5045a6});}catch(_0xf88a){console[_0x26aee4(0x97)](_0xf88a);}}),router[a0_0x2793ea(0x106)](a0_0x2793ea(0xc8),auth,async(_0x298b6d,_0x18e32e)=>{var _0x30bc89=a0_0x2793ea;try{const _0x337943=_0x298b6d['params']['id'],_0xf537e7=await purchases['findOne']({'_id':_0x298b6d['params']['id']}),_0x2810c7=await warehouse[_0x30bc89(0xb0)]({'name':_0xf537e7['warehouse_name'],'room':_0xf537e7[_0x30bc89(0x131)]});_0xf537e7[_0x30bc89(0x199)][_0x30bc89(0x14a)](_0x112a78=>{var _0x1f06dd=_0x30bc89;const _0x38df06=_0x2810c7[_0x1f06dd(0xa4)][_0x1f06dd(0x136)](_0x4e074c=>{var _0x1f7e74=_0x1f06dd;_0x4e074c['product_name']==_0x112a78[_0x1f7e74(0xde)]&&_0x4e074c[_0x1f7e74(0x13c)]==_0x112a78['floorlevel']&&_0x4e074c[_0x1f7e74(0xa7)]==_0x112a78['type']&&_0x4e074c['bin']==_0x112a78[_0x1f7e74(0xbb)]&&_0x4e074c['bay']==_0x112a78[_0x1f7e74(0x175)]&&_0x4e074c[_0x1f7e74(0xf3)]==_0x112a78[_0x1f7e74(0xf3)]&&_0x4e074c[_0x1f7e74(0x191)]==_0x112a78[_0x1f7e74(0x191)]&&(_0x4e074c[_0x1f7e74(0x189)]=parseInt(_0x4e074c[_0x1f7e74(0x189)])-parseInt(_0x112a78[_0x1f7e74(0x184)]));});}),await _0x2810c7[_0x30bc89(0x162)]();const {invoice:_0x57a7a4,suppliers:_0x14fe4b,date:_0x340c34,warehouse_name:_0x2b8563,prod_name:_0x31fb8d,prod_code:_0x379436,prod_qty:_0x2a8170,prod_unit:_0x2d7c42,prod_secondunit:_0x2d60ef,prod_level:_0x1a2052,prod_isle:_0x1da29a,prod_pallet:_0x112c87,note:_0x49fa30,expiry_date:_0x15a2cc,batch_code:_0x486876,paid_amount:_0x571f71,due_amount:_0x27aec1,Room_name:_0x17a42b,primary_code:_0x36d411,secondary_code:_0x448f93,PO_number:_0x5f1af3,JO_number:_0x176f90}=_0x298b6d['body'];if(typeof _0x31fb8d==_0x30bc89(0xb6))var _0x140fb0=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x14e)]],_0x3e7857=[_0x298b6d[_0x30bc89(0xe3)]['prod_code']],_0x597099=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xd3)]],_0x2a82d2=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xe9)]],_0x36accf=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xab)]],_0x38885c=[_0x298b6d['body'][_0x30bc89(0xb4)]],_0x1a2c12=[_0x298b6d['body'][_0x30bc89(0x14d)]],_0x90c740=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x167)]],_0x292661=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xbc)]],_0x3fb077=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xba)]],_0xb9652e=[_0x298b6d['body'][_0x30bc89(0xaf)]],_0x39c775=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x102)]],_0x1bb2e9=[_0x298b6d['body']['expiry_date']],_0x5a380b=[_0x298b6d['body'][_0x30bc89(0x191)]],_0x5254e6=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x9b)]],_0x37ea53=[_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xa7)]];else var _0x140fb0=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x14e)]],_0x3e7857=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xbf)]],_0x597099=[..._0x298b6d[_0x30bc89(0xe3)]['prod_qty']],_0x2a82d2=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xe9)]],_0x36accf=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xab)]],_0x38885c=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xb4)]],_0x1a2c12=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x14d)]],_0x90c740=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x167)]],_0x292661=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xbc)]],_0x3fb077=[..._0x298b6d['body'][_0x30bc89(0xba)]],_0xb9652e=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xaf)]],_0x39c775=[..._0x298b6d[_0x30bc89(0xe3)]['batch_code']],_0x1bb2e9=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x127)]],_0x5a380b=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x191)]],_0x5254e6=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x9b)]],_0x37ea53=[..._0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xa7)]];const _0x26602c=_0x140fb0['map'](_0xf7ce21=>{return _0xf7ce21={'product_name':_0xf7ce21};});_0x3e7857[_0x30bc89(0x14a)]((_0x589192,_0x967f37)=>{var _0x18ec49=_0x30bc89;_0x26602c[_0x967f37][_0x18ec49(0x16a)]=_0x589192;}),_0x597099['forEach']((_0x5e1c12,_0x3dc838)=>{var _0x44ec03=_0x30bc89;_0x26602c[_0x3dc838][_0x44ec03(0x184)]=_0x5e1c12;}),_0x2a82d2[_0x30bc89(0x14a)]((_0x4f7059,_0x14af0a)=>{_0x26602c[_0x14af0a]['standard_unit']=_0x4f7059;}),_0x36accf['forEach']((_0x39a31c,_0x3b78c8)=>{var _0x538f65=_0x30bc89;_0x26602c[_0x3b78c8][_0x538f65(0x139)]=_0x39a31c;}),_0x38885c[_0x30bc89(0x14a)]((_0x56d37d,_0x350e97)=>{var _0x48429d=_0x30bc89;_0x26602c[_0x350e97][_0x48429d(0x175)]=_0x56d37d;}),_0x1a2c12[_0x30bc89(0x14a)]((_0x4802fc,_0x3766a8)=>{_0x26602c[_0x3766a8]['bin']=_0x4802fc;}),_0x90c740[_0x30bc89(0x14a)]((_0x4a1175,_0x218255)=>{var _0x85c4c7=_0x30bc89;_0x26602c[_0x218255][_0x85c4c7(0x13c)]=_0x4a1175;}),_0x292661['forEach']((_0x30649a,_0x3f32d3)=>{_0x26602c[_0x3f32d3]['primary_code']=_0x30649a;}),_0x3fb077[_0x30bc89(0x14a)]((_0xa53857,_0x5e0933)=>{var _0x4b81d6=_0x30bc89;_0x26602c[_0x5e0933][_0x4b81d6(0xba)]=_0xa53857;}),_0xb9652e[_0x30bc89(0x14a)]((_0x37f564,_0x3ff3b0)=>{var _0x4939b7=_0x30bc89;_0x26602c[_0x3ff3b0][_0x4939b7(0x168)]=_0x37f564;}),_0x39c775['forEach']((_0x40ace5,_0x80895e)=>{var _0x2d740d=_0x30bc89;_0x26602c[_0x80895e][_0x2d740d(0x102)]=_0x40ace5;}),_0x1bb2e9[_0x30bc89(0x14a)]((_0x4fe847,_0x1f5397)=>{var _0x7ad297=_0x30bc89;_0x26602c[_0x1f5397][_0x7ad297(0x127)]=_0x4fe847;}),_0x37ea53[_0x30bc89(0x14a)]((_0x94a22,_0x467969)=>{var _0x411457=_0x30bc89;_0x26602c[_0x467969][_0x411457(0xa7)]=_0x94a22;}),_0x5a380b[_0x30bc89(0x14a)]((_0x38eab2,_0x53b0c6)=>{var _0x4b3595=_0x30bc89;_0x26602c[_0x53b0c6][_0x4b3595(0x191)]=_0x38eab2;}),_0x5254e6[_0x30bc89(0x14a)]((_0x43024b,_0x1453b0)=>{_0x26602c[_0x1453b0]['rack']=_0x43024b;});const _0x1e90ed=_0x26602c[_0x30bc89(0x183)](_0x221418=>_0x221418[_0x30bc89(0x184)]!=='0'&&_0x221418[_0x30bc89(0x184)]!=='');_0xf537e7[_0x30bc89(0x9e)]=_0x57a7a4,_0xf537e7[_0x30bc89(0x180)]=_0x14fe4b,_0xf537e7[_0x30bc89(0x179)]=_0x340c34,_0xf537e7[_0x30bc89(0x19c)]=_0x2b8563,_0xf537e7['product']=_0x1e90ed,_0xf537e7[_0x30bc89(0xf0)]=_0x49fa30,_0xf537e7['paid_amount']=_0x571f71,_0xf537e7['due_amount']=_0x27aec1,_0xf537e7[_0x30bc89(0x131)]=_0x17a42b,_0xf537e7[_0x30bc89(0x12b)]=_0x5f1af3,_0xf537e7[_0x30bc89(0x8e)]=_0x176f90;const _0x939ba1=await _0xf537e7['save'](),_0x9871db=await warehouse[_0x30bc89(0xb0)]({'name':_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x19c)],'room':_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0xb8)]});_0xf537e7[_0x30bc89(0x199)]['forEach'](_0x30f7ee=>{var _0x2688d0=_0x30bc89,_0x6e8d60=0x0;const _0xf4948b=_0x9871db[_0x2688d0(0xa4)][_0x2688d0(0x136)](_0x2fbf3a=>{var _0x3d62b2=_0x2688d0;_0x2fbf3a[_0x3d62b2(0xde)]==_0x30f7ee[_0x3d62b2(0xde)]&&_0x2fbf3a[_0x3d62b2(0x13c)]==_0x30f7ee['floorlevel']&&_0x2fbf3a['type']==_0x30f7ee['type']&&_0x2fbf3a['bin']==_0x30f7ee[_0x3d62b2(0xbb)]&&_0x2fbf3a[_0x3d62b2(0x175)]==_0x30f7ee[_0x3d62b2(0x175)]&&_0x2fbf3a[_0x3d62b2(0xf3)]==_0x30f7ee[_0x3d62b2(0xf3)]&&_0x2fbf3a[_0x3d62b2(0x191)]==_0x30f7ee[_0x3d62b2(0x191)]&&(_0x2fbf3a[_0x3d62b2(0x189)]=parseInt(_0x2fbf3a[_0x3d62b2(0x189)])+parseInt(_0x30f7ee['quantity']),_0x6e8d60++);});_0x6e8d60=='0'&&(_0x9871db[_0x2688d0(0xa4)]=_0x9871db['product_details'][_0x2688d0(0xb5)]({'product_name':_0x30f7ee[_0x2688d0(0xde)],'product_stock':_0x30f7ee[_0x2688d0(0x184)],'primary_code':_0x30f7ee[_0x2688d0(0xbc)],'secondary_code':_0x30f7ee[_0x2688d0(0xba)],'product_code':_0x30f7ee[_0x2688d0(0x16a)],'storage':_0x30f7ee['storage'],'rack':_0x30f7ee[_0x2688d0(0xf3)],'bay':_0x30f7ee[_0x2688d0(0x175)],'bin':_0x30f7ee['bin'],'type':_0x30f7ee[_0x2688d0(0xa7)],'floorlevel':_0x30f7ee[_0x2688d0(0x13c)],'maxProducts':_0x30f7ee[_0x2688d0(0x168)],'unit':_0x30f7ee[_0x2688d0(0x169)],'secondary_unit':_0x30f7ee[_0x2688d0(0x139)],'expiry_date':_0x30f7ee[_0x2688d0(0x127)]}));}),await _0x9871db[_0x30bc89(0x162)]();const _0x273b67=await s_payment_data[_0x30bc89(0xb0)]({'invoice':_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x9e)]});if(_0x273b67===null){}else console['log'](_0x30bc89(0x180),_0x273b67,_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x9e)]),_0x273b67[_0x30bc89(0x180)]=_0x298b6d[_0x30bc89(0xe3)][_0x30bc89(0x180)],await _0x273b67[_0x30bc89(0x162)]();_0x298b6d[_0x30bc89(0x188)](_0x30bc89(0x197),'purchase\x20data\x20update\x20successfully'),_0x18e32e['redirect'](_0x30bc89(0xed));}catch(_0x1988c4){console[_0x30bc89(0x97)](_0x1988c4);}}),router[a0_0x2793ea(0x106)]('/give_payment/:id',auth,async(_0x55b0f5,_0x5850ed)=>{var _0x14aa8c=a0_0x2793ea;try{const _0x1449f6=_0x55b0f5['params']['id'],{invoice:_0x102bef,suppliers:_0x2981fb,payable:_0x59c93a,due_amount:_0x48d755}=_0x55b0f5[_0x14aa8c(0xe3)],_0x4434d8=await purchases[_0x14aa8c(0xf9)](_0x1449f6);var _0x2a3fae=_0x59c93a-_0x48d755;_0x4434d8['paid_amount']=parseFloat(_0x4434d8['paid_amount'])+parseFloat(_0x48d755),_0x4434d8[_0x14aa8c(0xea)]=_0x2a3fae;const _0x48a1aa=await _0x4434d8['save']();console[_0x14aa8c(0x97)](_0x48a1aa);const _0x51f67f=await s_payment_data[_0x14aa8c(0xb0)]({'invoice':_0x102bef});_0x51f67f['amount']=_0x2a3fae,await _0x51f67f[_0x14aa8c(0x162)]();let _0x50f444=new Date(),_0x274901=('0'+_0x50f444['getDate']())[_0x14aa8c(0x18a)](-0x2),_0x4b71c7=('0'+(_0x50f444[_0x14aa8c(0xd7)]()+0x1))[_0x14aa8c(0x18a)](-0x2),_0x4e57dc=_0x50f444['getFullYear'](),_0x11da3d=_0x4e57dc+'-'+_0x4b71c7+'-'+_0x274901;const _0x16f038=new suppliers_payment({'invoice':_0x102bef,'date':_0x4e57dc+'-'+_0x4b71c7+'-'+_0x274901,'suppliers':_0x2981fb,'reason':_0x14aa8c(0x138),'amount':_0x48d755}),_0x19f044=await _0x16f038[_0x14aa8c(0x162)]();_0x55b0f5[_0x14aa8c(0x188)](_0x14aa8c(0x197),_0x14aa8c(0xc2)),_0x5850ed[_0x14aa8c(0x148)](_0x14aa8c(0xed));}catch(_0x495c1b){console['log'](_0x495c1b);}}),router[a0_0x2793ea(0x124)](a0_0x2793ea(0xfc),auth,async(_0x3b7d75,_0x550250)=>{var _0x3ada2a=a0_0x2793ea;try{const {username:_0x101801,email:_0x28ee44,role:_0x3b71c1}=_0x3b7d75[_0x3ada2a(0x194)],_0xb49675=_0x3b7d75['user'],_0x44c171=await profile[_0x3ada2a(0xb0)]({'email':_0xb49675[_0x3ada2a(0x18b)]}),_0xb4c833=await master_shop[_0x3ada2a(0xf5)]();console[_0x3ada2a(0x97)]('master',_0xb4c833);const _0x2875f5=_0x3b7d75[_0x3ada2a(0x93)]['id'],_0x800823=await purchases[_0x3ada2a(0xf9)](_0x2875f5);console[_0x3ada2a(0x97)](_0x800823);const _0x2732da=await suppliers['findOne']({'name':_0x800823['suppliers']});console['log'](_0x2732da);if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0xad)){var _0xdbd447=users[_0x3ada2a(0x16b)];console[_0x3ada2a(0x97)](_0xdbd447);}else{if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0xb1))var _0xdbd447=users[_0x3ada2a(0xb1)];else{if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0x9d))var _0xdbd447=users[_0x3ada2a(0x9d)];else{if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0x177))var _0xdbd447=users[_0x3ada2a(0x177)];else{if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0x130))var _0xdbd447=users[_0x3ada2a(0x130)];else{if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0x166))var _0xdbd447=users['Portuguese'];else{if(_0xb4c833[0x0][_0x3ada2a(0x8b)]==_0x3ada2a(0x12c))var _0xdbd447=users[_0x3ada2a(0x12c)];else{if(_0xb4c833[0x0]['language']=='Arabic\x20(ae)')var _0xdbd447=users[_0x3ada2a(0x86)];}}}}}}}_0x550250[_0x3ada2a(0x11f)](_0x3ada2a(0xb3),{'success':_0x3b7d75[_0x3ada2a(0x188)](_0x3ada2a(0x197)),'errors':_0x3b7d75[_0x3ada2a(0x188)](_0x3ada2a(0x195)),'role':_0xb49675,'profile':_0x44c171,'master_shop':_0xb4c833,'supplier':_0x2732da,'purchase':_0x800823,'language':_0xdbd447});}catch(_0x328abc){console[_0x3ada2a(0x97)](_0x328abc);}}),router[a0_0x2793ea(0x124)]('/view/return_purchase/:id',auth,async(_0xd78a2b,_0xf7f1b9)=>{var _0x138b6b=a0_0x2793ea;try{const {username:_0x28bcf1,email:_0xf807f3,role:_0x444e39}=_0xd78a2b[_0x138b6b(0x194)],_0x4a254a=_0xd78a2b[_0x138b6b(0x194)],_0x419e72=await profile[_0x138b6b(0xb0)]({'email':_0x4a254a[_0x138b6b(0x18b)]}),_0x48f734=await master_shop[_0x138b6b(0xf5)]();console['log'](_0x138b6b(0x181),_0x48f734);const _0x13a993=_0xd78a2b[_0x138b6b(0x93)]['id'];console['log'](_0x13a993);const _0x3ab159=await purchases[_0x138b6b(0xf9)](_0x13a993);console[_0x138b6b(0x97)](_0x138b6b(0xee),_0x3ab159);const _0x54a348=await product[_0x138b6b(0xf5)]({}),_0x11443d=await warehouse['aggregate']([{'$match':{'name':_0x3ab159[_0x138b6b(0x19c)],'room':_0x3ab159[_0x138b6b(0x131)],'warehouse_category':_0x138b6b(0x18f)}},{'$unwind':_0x138b6b(0xa5)},{'$group':{'_id':_0x138b6b(0xe7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x138b6b(0x18d)},'bay':{'$first':_0x138b6b(0xdd)},'bin':{'$first':_0x138b6b(0x10f)},'type':{'$first':_0x138b6b(0x176)},'floorlevel':{'$first':_0x138b6b(0x17e)},'primary_code':{'$first':_0x138b6b(0x119)},'secondary_code':{'$first':_0x138b6b(0xb2)},'product_code':{'$first':_0x138b6b(0x94)},'storage':{'$first':_0x138b6b(0x144)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x138b6b(0x12f)]([{'$match':{'status':_0x138b6b(0x15e),'name':'Return\x20Goods','warehouse_category':_0x138b6b(0x18f)}},{'$group':{'_id':_0x138b6b(0xa2),'name':{'$first':_0x138b6b(0xa2)}}},{'$sort':{'name':0x1}}]),console[_0x138b6b(0x97)](_0x138b6b(0x83),_0x11443d);if(_0x48f734[0x0]['language']==_0x138b6b(0xad)){var _0x9477a5=users[_0x138b6b(0x16b)];console[_0x138b6b(0x97)](_0x9477a5);}else{if(_0x48f734[0x0][_0x138b6b(0x8b)]==_0x138b6b(0xb1))var _0x9477a5=users[_0x138b6b(0xb1)];else{if(_0x48f734[0x0][_0x138b6b(0x8b)]==_0x138b6b(0x9d))var _0x9477a5=users['German'];else{if(_0x48f734[0x0][_0x138b6b(0x8b)]==_0x138b6b(0x177))var _0x9477a5=users[_0x138b6b(0x177)];else{if(_0x48f734[0x0]['language']=='French')var _0x9477a5=users[_0x138b6b(0x130)];else{if(_0x48f734[0x0]['language']==_0x138b6b(0x166))var _0x9477a5=users[_0x138b6b(0x132)];else{if(_0x48f734[0x0][_0x138b6b(0x8b)]==_0x138b6b(0x12c))var _0x9477a5=users[_0x138b6b(0x12c)];else{if(_0x48f734[0x0][_0x138b6b(0x8b)]=='Arabic\x20(ae)')var _0x9477a5=users[_0x138b6b(0x86)];}}}}}}}_0xf7f1b9[_0x138b6b(0x11f)](_0x138b6b(0x101),{'success':_0xd78a2b[_0x138b6b(0x188)]('success'),'errors':_0xd78a2b['flash']('errors'),'role':_0x4a254a,'profile':_0x419e72,'user':_0x3ab159,'stock':_0x11443d,'master_shop':_0x48f734,'product':_0x54a348,'language':_0x9477a5,'warehouse':warehouse_data});}catch(_0xdacfd){console[_0x138b6b(0x97)](_0xdacfd);}}),router[a0_0x2793ea(0x106)](a0_0x2793ea(0x99),auth,async(_0x3d8bd3,_0x44ece1)=>{var _0x45ef4b=a0_0x2793ea;try{const {invoice:_0x399a46,date:_0x284e6d,warehouse_name:_0x18e49a,Room_name:_0x57bd35,product_name:_0x2d5fb2,purchase_quantity:_0x301552,stocks:_0x351e40,return_qty:_0x196058,note:_0x20761b,level:_0x8d2506,isle:_0x598cd7,pallet:_0xe1dff4,to_warehouse_name:_0x392651,to_Room_name:_0x5117fe}=_0x3d8bd3[_0x45ef4b(0xe3)],_0x34eae8=await purchases['findOne']({'_id':_0x3d8bd3[_0x45ef4b(0x93)]['id']}),_0x278734=await warehouse[_0x45ef4b(0xb0)]({'name':_0x18e49a,'room':_0x57bd35});if(typeof _0x2d5fb2==_0x45ef4b(0xb6))var _0xc2bf7e=[_0x3d8bd3['body'][_0x45ef4b(0xde)]],_0x427d7f=[_0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0xa6)]],_0x1e56d7=[_0x3d8bd3['body'][_0x45ef4b(0xe2)]],_0x482c6b=[_0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x98)]],_0x3aec49=[_0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x13d)]],_0x23addb=[_0x3d8bd3['body'][_0x45ef4b(0x18e)]],_0x4ce469=[_0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0xff)]],_0x55eb38=[_0x3d8bd3[_0x45ef4b(0xe3)]['types']],_0x5029b1=[_0x3d8bd3[_0x45ef4b(0xe3)]['product_code_hide']],_0x396f4b=[_0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x125)]],_0x95a7e0=[_0x3d8bd3[_0x45ef4b(0xe3)]['secondary_code_hide']];else var _0xc2bf7e=[..._0x3d8bd3['body'][_0x45ef4b(0xde)]],_0x427d7f=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0xa6)]],_0x1e56d7=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0xe2)]],_0x482c6b=[..._0x3d8bd3[_0x45ef4b(0xe3)]['return_qty']],_0x3aec49=[..._0x3d8bd3['body'][_0x45ef4b(0x13d)]],_0x23addb=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x18e)]],_0x4ce469=[..._0x3d8bd3[_0x45ef4b(0xe3)]['pallet']],_0x55eb38=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x158)]],_0x5029b1=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x152)]],_0x396f4b=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x125)]],_0x95a7e0=[..._0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0xf1)]];const _0x30a760=_0xc2bf7e[_0x45ef4b(0x136)](_0x36fe10=>{return _0x36fe10={'product_name':_0x36fe10};});_0x427d7f[_0x45ef4b(0x14a)]((_0x2a4a82,_0x8affd7)=>{var _0x4175a3=_0x45ef4b;_0x30a760[_0x8affd7][_0x4175a3(0xa6)]=_0x2a4a82;}),_0x1e56d7[_0x45ef4b(0x14a)]((_0x44f409,_0xa774bc)=>{var _0x13e70e=_0x45ef4b;_0x30a760[_0xa774bc][_0x13e70e(0xa9)]=_0x44f409;}),_0x482c6b[_0x45ef4b(0x14a)]((_0xcbf11c,_0x155788)=>{var _0x2e721d=_0x45ef4b;_0x30a760[_0x155788][_0x2e721d(0x98)]=_0xcbf11c;}),_0x3aec49[_0x45ef4b(0x14a)]((_0x2ec74b,_0x207526)=>{var _0x368e80=_0x45ef4b;_0x30a760[_0x207526][_0x368e80(0x175)]=_0x2ec74b;}),_0x23addb[_0x45ef4b(0x14a)]((_0x358d82,_0x74bf83)=>{_0x30a760[_0x74bf83]['bin']=_0x358d82;}),_0x4ce469[_0x45ef4b(0x14a)]((_0x2466e2,_0x1f8e1b)=>{_0x30a760[_0x1f8e1b]['floorlevel']=_0x2466e2;}),_0x55eb38[_0x45ef4b(0x14a)]((_0x487c2f,_0x23ca04)=>{_0x30a760[_0x23ca04]['type']=_0x487c2f;}),_0x5029b1[_0x45ef4b(0x14a)]((_0x4968c8,_0x53d28b)=>{var _0x261da4=_0x45ef4b;_0x30a760[_0x53d28b][_0x261da4(0x16a)]=_0x4968c8;}),_0x396f4b[_0x45ef4b(0x14a)]((_0x7ae66,_0x54162f)=>{var _0x45e7fb=_0x45ef4b;_0x30a760[_0x54162f][_0x45e7fb(0xbc)]=_0x7ae66;}),_0x95a7e0[_0x45ef4b(0x14a)]((_0xad82d6,_0x2add6e)=>{var _0x56911a=_0x45ef4b;_0x30a760[_0x2add6e][_0x56911a(0xba)]=_0xad82d6;}),_0x34eae8[_0x45ef4b(0x199)]['forEach'](_0x23c494=>{var _0x59e2eb=_0x45ef4b;const _0x47355=_0x278734[_0x59e2eb(0xa4)][_0x59e2eb(0x136)](_0x1242a9=>{var _0x847609=_0x59e2eb;_0x1242a9['product_name']==_0x23c494[_0x847609(0xde)]&&_0x1242a9['floorlevel']==_0x23c494[_0x847609(0x13c)]&&_0x1242a9[_0x847609(0xa7)]==_0x23c494['type']&&_0x1242a9[_0x847609(0xbb)]==_0x23c494[_0x847609(0xbb)]&&_0x1242a9['bay']==_0x23c494['bay']&&_0x1242a9[_0x847609(0xf3)]==_0x23c494[_0x847609(0xf3)]&&_0x1242a9[_0x847609(0x191)]==_0x23c494['storage']&&(console[_0x847609(0x97)](parseInt(_0x1242a9['product_stock'])+_0x847609(0x91)+parseInt(_0x23c494[_0x847609(0x184)])),_0x1242a9[_0x847609(0x189)]=parseInt(_0x1242a9[_0x847609(0x189)])+parseInt(_0x23c494[_0x847609(0x184)]));});}),await _0x278734['save']();const _0x1028bf=_0x30a760[_0x45ef4b(0x183)](_0x412778=>_0x412778[_0x45ef4b(0x98)]!=='0'&&_0x412778['return_qty']!=='');var _0x31cef8=0x0;_0x1028bf['forEach'](_0x1d12b9=>{var _0x9053b7=_0x45ef4b;console[_0x9053b7(0x97)](_0x9053b7(0x13a),_0x1d12b9),(parseInt(_0x1d12b9['purchase_quantity'])<parseInt(_0x1d12b9[_0x9053b7(0x98)])||parseInt(_0x1d12b9['stock_quantity'])<parseInt(_0x1d12b9[_0x9053b7(0x98)]))&&_0x31cef8++;});if(_0x31cef8!=0x0)return _0x3d8bd3[_0x45ef4b(0x188)](_0x45ef4b(0x195),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x44ece1['redirect'](_0x45ef4b(0x164));const _0x5e0f3e=new purchases_return({'invoice':_0x399a46,'suppliers':_0x3d8bd3[_0x45ef4b(0xe3)]['suppliers'],'date':_0x284e6d,'warehouse_name':_0x18e49a,'return_product':_0x1028bf,'note':_0x20761b,'room':_0x57bd35,'to_warehouse_name':_0x392651,'to_room':_0x5117fe}),_0x2aae49=await _0x5e0f3e[_0x45ef4b(0x162)]();console['log'](_0x5e0f3e);const _0x4febd8=await purchases_return[_0x45ef4b(0xb0)]({'invoice':_0x399a46}),_0x21337d=await warehouse[_0x45ef4b(0xb0)]({'name':_0x392651,'room':_0x5117fe});_0x4febd8[_0x45ef4b(0x133)]['forEach'](_0x194b98=>{var _0x216973=_0x45ef4b,_0x5afe61=0x0;const _0x5cc045=_0x21337d[_0x216973(0xa4)]['map'](_0x3178ee=>{var _0x4ff817=_0x216973;_0x3178ee['product_name']==_0x194b98[_0x4ff817(0xde)]&&_0x3178ee[_0x4ff817(0x13c)]==_0x194b98['floorlevel']&&_0x3178ee[_0x4ff817(0xa7)]==_0x194b98[_0x4ff817(0xa7)]&&_0x3178ee[_0x4ff817(0xbb)]==_0x194b98['bin']&&_0x3178ee['bay']==_0x194b98['bay']&&(_0x3178ee[_0x4ff817(0x189)]=parseInt(_0x3178ee['product_stock'])-parseInt(_0x194b98[_0x4ff817(0x98)]),_0x5afe61++);});_0x5afe61=='0'&&(_0x21337d['product_details']=_0x21337d['product_details'][_0x216973(0xb5)]({'product_name':_0x194b98['product_name'],'product_stock':_0x194b98[_0x216973(0x98)],'primary_code':_0x194b98[_0x216973(0xbc)],'secondary_code':_0x194b98[_0x216973(0xba)],'product_code':_0x194b98[_0x216973(0x16a)],'storage':_0x194b98[_0x216973(0x191)],'rack':_0x194b98['rack'],'bay':_0x194b98[_0x216973(0x175)],'bin':_0x194b98[_0x216973(0xbb)],'type':_0x194b98[_0x216973(0xa7)],'floorlevel':_0x194b98[_0x216973(0x13c)],'maxProducts':_0x194b98[_0x216973(0x168)],'unit':_0x194b98[_0x216973(0x169)],'secondary_unit':_0x194b98[_0x216973(0x139)],'expiry_date':_0x194b98[_0x216973(0x127)]}));}),await _0x21337d['save']();const _0x25719d=await purchases['findOne']({'invoice':_0x399a46});_0x25719d[_0x45ef4b(0x165)]=_0x45ef4b(0x190);const _0xb87067=await _0x25719d[_0x45ef4b(0x162)](),_0xe12cff=new s_payment_data({'invoice':_0x399a46,'suppliers':_0x3d8bd3[_0x45ef4b(0xe3)][_0x45ef4b(0x180)],'reason':_0x45ef4b(0xa1)});await _0xe12cff[_0x45ef4b(0x162)]();const _0x382c18=await master_shop[_0x45ef4b(0xf5)]();console[_0x45ef4b(0x97)]('add\x20post',_0x382c18[0x0]['image']);const _0x35327c=await email_settings[_0x45ef4b(0xb0)](),_0x5b2b03=await suppliers[_0x45ef4b(0xb0)]({'name':_0x3d8bd3[_0x45ef4b(0xe3)]['suppliers']});console[_0x45ef4b(0x97)](_0x45ef4b(0xcb),_0x5b2b03);_0x382c18[0x0][_0x45ef4b(0x10d)]==0x1?(right_currency=_0x382c18[0x0][_0x45ef4b(0x146)],left_currency=''):(right_currency='',left_currency=_0x382c18[0x0][_0x45ef4b(0x146)]);var _0x418a09=_0xc2bf7e,_0x3d3259=_0x482c6b,_0x16c79a='',_0x5b1303;for(_0x5b1303 in _0x418a09){_0x16c79a+=_0x45ef4b(0x108)+_0x45ef4b(0x10a)+_0x418a09[_0x5b1303]+_0x45ef4b(0x100)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d3259[_0x5b1303]+_0x45ef4b(0x100)+'</tr>';}console[_0x45ef4b(0x97)](_0x45ef4b(0x16f),_0x16c79a);let _0x15f1dc=nodemailer['createTransport']({'service':_0x45ef4b(0xd4),'auth':{'user':_0x35327c[_0x45ef4b(0x18b)],'pass':_0x35327c['password']}}),_0x37f501={'from':_0x35327c['email'],'to':_0x5b2b03[_0x45ef4b(0x18b)],'subject':_0x45ef4b(0x15f),'attachments':[{'filename':_0x45ef4b(0x159),'path':__dirname+_0x45ef4b(0x11a)+_0x45ef4b(0xd9)+_0x382c18[0x0]['image'],'cid':_0x45ef4b(0x104)}],'html':_0x45ef4b(0x17a)+_0x45ef4b(0x178)+_0x45ef4b(0xcf)+'<div>'+_0x45ef4b(0x105)+_0x45ef4b(0xc7)+_0x45ef4b(0x13b)+_0x45ef4b(0xeb)+'<div>'+_0x45ef4b(0xd2)+_0x382c18[0x0]['site_title']+_0x45ef4b(0x171)+_0x45ef4b(0xeb)+'</div>'+_0x45ef4b(0x15a)+_0x45ef4b(0xc7)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x45ef4b(0xe0)+_0x399a46+'\x20'+_0x45ef4b(0xb7)+_0x45ef4b(0xb9)+_0x284e6d+'\x20'+'</span>'+'</h5>'+'</div>'+_0x45ef4b(0xf7)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x45ef4b(0x108)+_0x45ef4b(0x88)+_0x45ef4b(0xfa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x45ef4b(0xc3)+_0x45ef4b(0x12e)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x16c79a+'\x20'+_0x45ef4b(0x16e)+_0x45ef4b(0xcd)+_0x45ef4b(0xc7)+_0x45ef4b(0x157)+'<h5>'+_0x382c18[0x0]['site_title']+'</h5>'+_0x45ef4b(0xeb)+_0x45ef4b(0xeb)+'</body></html>'};_0x15f1dc[_0x45ef4b(0x10b)](_0x37f501,function(_0x49441f,_0x821c05){var _0x818918=_0x45ef4b;_0x49441f?(console['log'](_0x49441f),console[_0x818918(0x97)](_0x818918(0x15c))):console[_0x818918(0x97)](_0x818918(0x137));}),_0x3d8bd3[_0x45ef4b(0x188)](_0x45ef4b(0x197),_0x45ef4b(0x128)),_0x44ece1[_0x45ef4b(0x148)](_0x45ef4b(0xed));}catch(_0x5f3c39){console[_0x45ef4b(0x97)](_0x5f3c39),_0x44ece1[_0x45ef4b(0x160)](0xc8)['json']({'message':_0x5f3c39[_0x45ef4b(0x192)]});}}),router['get'](a0_0x2793ea(0xd5),auth,async(_0x14b2e8,_0x2df70c)=>{var _0x30af32=a0_0x2793ea;try{const {username:_0x4f5377,email:_0x7f7d,role:_0x4285e3}=_0x14b2e8[_0x30af32(0x194)],_0x1d770c=_0x14b2e8[_0x30af32(0x194)],_0x2b8a6a=await profile[_0x30af32(0xb0)]({'email':_0x1d770c['email']}),_0x2338fc=await master_shop['find'](),_0x51ad09=_0x14b2e8[_0x30af32(0x93)]['id'],_0x41b509=await purchases[_0x30af32(0xf9)](_0x51ad09);if(_0x2338fc[0x0][_0x30af32(0x8b)]=='English\x20(US)')var _0x5a89cd=users[_0x30af32(0x16b)];else{if(_0x2338fc[0x0][_0x30af32(0x8b)]=='Hindi')var _0x5a89cd=users['Hindi'];else{if(_0x2338fc[0x0][_0x30af32(0x8b)]==_0x30af32(0x9d))var _0x5a89cd=users['German'];else{if(_0x2338fc[0x0][_0x30af32(0x8b)]==_0x30af32(0x177))var _0x5a89cd=users[_0x30af32(0x177)];else{if(_0x2338fc[0x0][_0x30af32(0x8b)]==_0x30af32(0x130))var _0x5a89cd=users['French'];else{if(_0x2338fc[0x0][_0x30af32(0x8b)]==_0x30af32(0x166))var _0x5a89cd=users[_0x30af32(0x132)];else{if(_0x2338fc[0x0]['language']==_0x30af32(0x12c))var _0x5a89cd=users[_0x30af32(0x12c)];else{if(_0x2338fc[0x0]['language']==_0x30af32(0x11d))var _0x5a89cd=users[_0x30af32(0x86)];}}}}}}}_0x2df70c['render'](_0x30af32(0xd0),{'success':_0x14b2e8[_0x30af32(0x188)](_0x30af32(0x197)),'errors':_0x14b2e8[_0x30af32(0x188)](_0x30af32(0x195)),'role':_0x1d770c,'profile':_0x2b8a6a,'alldata':_0x41b509,'master_shop':_0x2338fc,'language':_0x5a89cd}),console['log'](alldata);}catch(_0x1705fc){console[_0x30af32(0x97)](_0x1705fc);}}),router['post'](a0_0x2793ea(0x142),async(_0x970448,_0x26a594)=>{var _0x12a905=a0_0x2793ea;const {product_code:_0x254aa0}=_0x970448[_0x12a905(0xe3)];var _0x566fa8;const _0x12e0d2=await product['aggregate']([{'$match':{'primary_code':_0x254aa0,'product_category':_0x12a905(0x18f)}},{'$group':{'_id':'$_id','name':{'$first':_0x12a905(0xa2)},'category':{'$first':_0x12a905(0x143)},'brand':{'$first':_0x12a905(0x8d)},'unit':{'$first':_0x12a905(0x120)},'alertquantity':{'$first':_0x12a905(0xdf)},'product_code':{'$first':_0x12a905(0x109)},'primary_code':{'$first':_0x12a905(0xe8)},'secondary_code':{'$first':_0x12a905(0x185)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x12a905(0x145)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x12a905(0x9f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1c8772=await product['aggregate']([{'$match':{'secondary_code':_0x254aa0,'product_category':_0x12a905(0x18f)}},{'$group':{'_id':_0x12a905(0x90),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x12a905(0x8d)},'unit':{'$first':_0x12a905(0x120)},'alertquantity':{'$first':_0x12a905(0xdf)},'product_code':{'$first':_0x12a905(0x109)},'primary_code':{'$first':_0x12a905(0xe8)},'secondary_code':{'$first':_0x12a905(0x185)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x12a905(0x145)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x12a905(0x9f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x12e0d2[_0x12a905(0x14b)]>0x0)_0x566fa8=_0x12e0d2;else _0x1c8772['length']>0x0&&(_0x566fa8=_0x1c8772);_0x26a594[_0x12a905(0x174)](_0x566fa8);}),router[a0_0x2793ea(0x106)](a0_0x2793ea(0xc5),async(_0x33e830,_0x53fa5c)=>{var _0x4c937b=a0_0x2793ea;const {primaryCode:_0x318946,secondaryCode:_0xce6193,productCode:_0x30c1f5,bay:_0x29fd1d,bin:_0x247149,types:_0x3963dc,pallet:_0x2de7bf,warehouses:_0x4e1b22,room:_0x166649}=_0x33e830['body'];console[_0x4c937b(0x97)](_0x33e830[_0x4c937b(0xe3)]);try{const _0x4c827a=await warehouse[_0x4c937b(0x12f)]([{'$match':{'name':_0x4e1b22,'room':_0x166649}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x29fd1d,'product_details.bin':_0x247149,'product_details.type':_0x3963dc}},{'$group':{'_id':_0x4c937b(0xe7),'name':{'$first':_0x4c937b(0x10c)},'product_stock':{'$first':_0x4c937b(0x18d)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x4c937b(0x122)}}}]);_0x53fa5c['status'](0xc8)[_0x4c937b(0x174)](_0x4c827a);}catch(_0x549ff4){_0x53fa5c[_0x4c937b(0x160)](0x194)[_0x4c937b(0x174)]({'message':_0x549ff4[_0x4c937b(0x192)]});}}),module['exports']=router;