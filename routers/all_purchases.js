var a0_0x2035e9=a0_0x16d6;function a0_0x5aa9(){var _0x282916=['findOne','1032OauDUe','back','Arabic','Purchase\x20Return','$invoice','body','bay','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','return_qty','/barcode_scanner','RMSEmail','length','secondary_code_hide','</thead>','/view/add_purchases/:id','secondary_code','\x20</h2>','$secondary_code','31484088AaMceu','<h5>','\x20<>\x20','14zVAyDE','isle','user','INC-','$maxStocks','Purchase\x20Return\x20Mail','$expiry_date','$product_details.product_stock','getDate','Rack\x20D','French','Rack\x20E','expiry_date','render','floor','/view','bin','email','actual_uom','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','pallet','German','suppliers_docs','16115UgenXe','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_Qty','error','JO_number','584229GHahSC','$suppliers_docs','redirect','/barcode/:id','host','2794167oAOpAM','<div>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','return_product','return_purchase','all_purchases_barcode','params','rak','$product_details._id','foreach\x20newproduct','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_name','exports','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$finalize','Portuguese','flash','product_list','sendMail','Raw\x20Materials','/upload/','$product_details.bin','currency','actual_qty','An\x20error\x20occurred\x20while\x20saving\x20data.','find','MaxStocks_data','product_stock','</div>','$product.room_name','string','DRY\x20STORAGE','maxperunit','then','prod_level','</td>','staff','user_id','forEach','stocks','filter','random','prod_qty','nodemailer','suppliers_data','Rack\x20C','Paid\x20For\x20Purchase','log','createTransport','warehouse_name','product_cat','\x20Order\x20Number\x20:\x20','$product_details.rack','/CheckingWarehouse','$product_details','$primary_code','$alertquantity','$product.bin','$product_details.secondary_code','Return\x20Goods','8qrmUmj','Room_name','product_code_hide','suppliers','$product_details.product_name','12KsPkLq','$brand','$product_details.isle','$product_details.type','standard_unit','push','583OTJMPz','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','primary_code','express','Hindi','primary_code_hide','json','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','add_purchases\x20error','get','paid_amount','<tr>','Shelves','logo','Email\x20sent\x20successfully','product_name','$return_data','findById','prod_isle','3744545YhUEJZ','map','$product_details.maxProducts','</h5>','Portuguese\x20(BR)','$_id','date','Receiving\x20Area','status','prod_secondunit','return_data','$name','Arabic\x20(ae)','deliverycode','rack','image','</span>','$product_code','COLD\x20STORAGE','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','all','$product.type','Rack\x20A','invoice','</tbody>','batch_code','product','quantity','91119ZxBGvC','product_code','prod_pallet','getFullYear','concat','$note','prod_unit','delivery_date','stock_quantity','\x20Order\x20Date\x20:\x20','maxStocks','<h2>\x20','$product_details.primary_code','floorlevel','type','/all_purchases/view','</body></html>','$product','secondary_unit','password','room_name','here','<table\x20style=\x22width:\x20100%\x20!important;\x22>','types','add\x20post','currency_placement','/view/return_purchase/:id','Purchase\x20Mail','English\x20(US)','Logo.png','success','amount','name','payment\x20successfull','abs','$secondary_unit','$batch_code','English','room','$paid_amount','Spanish','post','There\x27s\x20a\x20error\x20in\x20this\x20transaction','purchases\x20item\x20return\x20successfull','master','due_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<span\x20style=\x22float:\x20right;\x22>','$unit','delivery_code','purchase_quantity','prod_cat','warehouse','edit_purchases','Ambient','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','Level','role','/../public','slice','aggregate','Rack\x20F','storage','level','$category','POnumber','site_title','</head><body>','/view/:id','language','prod_primunit','catch','\x20<\x20wew\x20>\x20','Chinese','Rack\x20B','../middleware/auth','gmail','production_date','/view/add_purchases','$product.bay','/give_payment/:id','save','$product_details.floorlevel','$product.floorlevel','$product_details.pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<strong>\x20Regards\x20</strong>','table\x20page','Error\x20Occurs','prod_code','$product_details.product_code','$product.quantity','$product_details.storage','$product_details.bay','$product_details.expiry_date','note','Enabled','port','<tbody\x20style=\x22text-align:\x20center;\x22>','alertQTY','/invoice/:id','purchase_invoice','product_details','54310PUsKYM','getMonth','Floor','</tr>','prod_invoice'];a0_0x5aa9=function(){return _0x282916;};return a0_0x5aa9();}(function(_0xdcc5a3,_0x8b6a53){var _0x32d27c=a0_0x16d6,_0x2e6b49=_0xdcc5a3();while(!![]){try{var _0x2bf10f=parseInt(_0x32d27c(0x167))/0x1*(-parseInt(_0x32d27c(0xcd))/0x2)+parseInt(_0x32d27c(0xe9))/0x3*(-parseInt(_0x32d27c(0x131))/0x4)+-parseInt(_0x32d27c(0xe4))/0x5*(parseInt(_0x32d27c(0xb7))/0x6)+-parseInt(_0x32d27c(0x14b))/0x7+-parseInt(_0x32d27c(0x12c))/0x8*(-parseInt(_0x32d27c(0xee))/0x9)+-parseInt(_0x32d27c(0xb1))/0xa*(parseInt(_0x32d27c(0x137))/0xb)+parseInt(_0x32d27c(0xca))/0xc;if(_0x2bf10f===_0x8b6a53)break;else _0x2e6b49['push'](_0x2e6b49['shift']());}catch(_0x1fa1aa){_0x2e6b49['push'](_0x2e6b49['shift']());}}}(a0_0x5aa9,0x51c5d));const express=require(a0_0x2035e9(0x13b)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x2035e9(0x95)),nodemailer=require(a0_0x2035e9(0x11b));var ejs=require('ejs');function a0_0x16d6(_0x1bc55d,_0xb6aae5){var _0x5aa9a9=a0_0x5aa9();return a0_0x16d6=function(_0x16d62c,_0x5b0b4b){_0x16d62c=_0x16d62c-0x6d;var _0x5cf13b=_0x5aa9a9[_0x16d62c];return _0x5cf13b;},a0_0x16d6(_0x1bc55d,_0xb6aae5);}const path=require('path'),users=require('../public/language/languages.json');router['get'](a0_0x2035e9(0xdc),auth,async(_0x25b057,_0x34d556)=>{var _0x17b09c=a0_0x2035e9;try{const {username:_0x4c0416,email:_0x3037cf,role:_0x56f16e}=_0x25b057[_0x17b09c(0xcf)],_0x297866=_0x25b057[_0x17b09c(0xcf)],_0x32e435=await profile['findOne']({'email':_0x297866[_0x17b09c(0xde)]}),_0x2ce46a=await staff['findOne']({'email':_0x297866[_0x17b09c(0xde)]});if(_0x297866[_0x17b09c(0x83)]=='staff'){const _0x4b7817=await staff[_0x17b09c(0xb6)]({'email':_0x297866[_0x17b09c(0xde)]});}const _0x2b2998=await master_shop[_0x17b09c(0x109)]();let _0x29a2a6;if(_0x297866[_0x17b09c(0x83)]=='staff'){const _0x4a8e0c=await staff[_0x17b09c(0xb6)]({'email':_0x297866[_0x17b09c(0xde)]});_0x29a2a6=await purchases[_0x17b09c(0x86)]([{'$match':{'warehouse_name':_0x4a8e0c[_0x17b09c(0x7e)]}},{'$lookup':{'from':_0x17b09c(0x12f),'localField':_0x17b09c(0x12f),'foreignField':'name','as':_0x17b09c(0xe3)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x17b09c(0x178)},{'$group':{'_id':_0x17b09c(0x150),'invoice':{'$first':_0x17b09c(0xbb)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x17b09c(0xf8)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x17b09c(0x178)},'note':{'$first':_0x17b09c(0x16c)},'paid_amount':{'$first':_0x17b09c(0x71)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x17b09c(0x148)},'batch_code':{'$first':_0x17b09c(0x6e)},'expiry_date':{'$first':_0x17b09c(0xd3)},'suppliers_docs':{'$first':_0x17b09c(0xea)},'total_product_quantity':{'$sum':_0x17b09c(0xa5)},'level':{'$addToSet':_0x17b09c(0x99)},'isle':{'$addToSet':_0x17b09c(0x129)},'type':{'$addToSet':_0x17b09c(0x160)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x29a2a6=await purchases[_0x17b09c(0x86)]([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x17b09c(0x187),'as':_0x17b09c(0xe3)}},{'$unwind':_0x17b09c(0xea)},{'$unwind':_0x17b09c(0x178)},{'$group':{'_id':_0x17b09c(0x150),'invoice':{'$first':_0x17b09c(0xbb)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x17b09c(0x10d)},'product':{'$push':_0x17b09c(0x178)},'note':{'$first':_0x17b09c(0x16c)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x17b09c(0x148)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x17b09c(0xd3)},'suppliers_docs':{'$first':_0x17b09c(0xea)},'total_product_quantity':{'$sum':_0x17b09c(0xa5)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x17b09c(0x9d)},'finalize':{'$first':_0x17b09c(0xfe)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0x183)){var _0x1518d3=users['English'];console[_0x17b09c(0x11f)](_0x1518d3);}else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0x13c))var _0x1518d3=users[_0x17b09c(0x13c)];else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0xe2))var _0x1518d3=users[_0x17b09c(0xe2)];else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0x72))var _0x1518d3=users[_0x17b09c(0x72)];else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0xd7))var _0x1518d3=users[_0x17b09c(0xd7)];else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]=='Portuguese\x20(BR)')var _0x1518d3=users[_0x17b09c(0xff)];else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0x93))var _0x1518d3=users[_0x17b09c(0x93)];else{if(_0x2b2998[0x0][_0x17b09c(0x8f)]==_0x17b09c(0x157))var _0x1518d3=users[_0x17b09c(0xb9)];}}}}}}}_0x34d556['render']('all_purchases',{'success':_0x25b057[_0x17b09c(0x100)](_0x17b09c(0x185)),'errors':_0x25b057[_0x17b09c(0x100)](_0x17b09c(0xbe)),'purchases':_0x29a2a6,'role':_0x297866,'profile':_0x32e435,'master_shop':_0x2b2998,'language':_0x1518d3});}catch(_0x52d949){console[_0x17b09c(0x11f)](_0x17b09c(0xa1),_0x52d949),_0x34d556['status'](0xc8)[_0x17b09c(0x13e)]({'message':_0x52d949['message']});}});function BayBinSelected(_0x49ebd2,_0x38ec96){var _0x290aa0=a0_0x2035e9,_0x4aff98=[],_0x7b3828=[],_0x14757d=[],_0x2374f8=[],_0x48aff5=[],_0x50dc2e=[];let _0x45e750=[];if(_0x49ebd2==_0x290aa0(0x10f))switch(_0x38ec96){case'Rack\x20A':_0x4aff98=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x7b3828=[0x1,0x2],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=[_0x290aa0(0x82),'Floor'],_0x48aff5=['D'],_0x50dc2e=['A'];break;case _0x290aa0(0x94):_0x4aff98=[0x6,0x5,0x4,0x3,0x2,0x1],_0x7b3828=[0x1,0x2],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=[_0x290aa0(0x82),_0x290aa0(0xb3)],_0x48aff5=['D'],_0x50dc2e=['B'];break;case _0x290aa0(0x144):_0x4aff98=[0x0],_0x7b3828=[0x0],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=['Floor'],_0x48aff5=['D'],_0x50dc2e=['S'];break;case _0x290aa0(0x152):_0x4aff98=[0x0],_0x7b3828=[0x0],_0x2374f8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x14757d=[_0x290aa0(0xb3)],_0x48aff5=['D'],_0x50dc2e=['R'];break;}else{if(_0x49ebd2==_0x290aa0(0x15d))switch(_0x38ec96){case _0x290aa0(0x161):_0x4aff98=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x7b3828=['B','F'],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=[_0x290aa0(0x82),_0x290aa0(0xb3)],_0x48aff5=['C'],_0x50dc2e=['A'];break;case _0x290aa0(0x94):_0x4aff98=[0x5,0x4,0x3,0x2,0x1],_0x7b3828=['F','B','S'],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=['Level',_0x290aa0(0xb3)],_0x48aff5=['C'],_0x50dc2e=['B'];break;case _0x290aa0(0x11d):_0x4aff98=[0x1,0x2,0x3,0x4,0x5],_0x7b3828=['B','F','S'],_0x2374f8=[0x5,0x4,0x3,0x2,0x1],_0x14757d=[_0x290aa0(0x82),_0x290aa0(0xb3)],_0x48aff5=['C'],_0x50dc2e=['C'];break;case _0x290aa0(0xd6):_0x4aff98=[0x5,0x4,0x3,0x2,0x1],_0x7b3828=['F','B','S'],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=[_0x290aa0(0x82),_0x290aa0(0xb3)],_0x48aff5=['C'],_0x50dc2e=['D'];break;case _0x290aa0(0xd8):_0x4aff98=[0x4,0x3,0x2,0x1],_0x7b3828=[0x1,0x2],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=['Level',_0x290aa0(0xb3)],_0x48aff5=['C'],_0x50dc2e=['E'];break;case _0x290aa0(0x87):_0x4aff98=[0x1,0x2,0x3],_0x7b3828=[0x1,0x2],_0x2374f8=[0x1,0x2,0x3,0x4,0x5],_0x14757d=[_0x290aa0(0x82)],_0x48aff5=['C'],_0x50dc2e=['F'];break;}}return{'levels':_0x4aff98,'Isle':_0x7b3828,'rack':_0x2374f8,'type':_0x14757d,'storage':_0x48aff5,'rak':_0x50dc2e};}async function getRandom8DigitNumber(){var _0x21dbfc=a0_0x2035e9;const _0x2b3652=0x989680,_0x38876a=0x5f5e0ff,_0x374085=Math[_0x21dbfc(0xdb)](Math[_0x21dbfc(0x119)]()*(_0x38876a-_0x2b3652+0x1))+_0x2b3652;var _0x4c79ff;const _0x28281f=await purchases[_0x21dbfc(0xb6)]({'invoice':_0x21dbfc(0xd0)+_0x374085});return _0x28281f&&_0x28281f[_0x21dbfc(0xc3)]>0x0?_0x4c79ff='INC-'+_0x374085:_0x4c79ff='INC-'+_0x374085,_0x4c79ff;}router[a0_0x2035e9(0x141)](a0_0x2035e9(0x98),auth,async(_0x289291,_0x5dd210)=>{var _0xb0ce38=a0_0x2035e9;try{const {username:_0x5ca596,email:_0x380723,role:_0x1818d0}=_0x289291[_0xb0ce38(0xcf)],_0x1137b7=_0x289291[_0xb0ce38(0xcf)],_0x14cccb=await profile[_0xb0ce38(0xb6)]({'email':_0x1137b7[_0xb0ce38(0xde)]}),_0x529354=await master_shop[_0xb0ce38(0x109)](),_0x236aa7=await staff['findOne']({'email':_0x1137b7[_0xb0ce38(0xde)]}),_0x2eb9fe=await suppliers[_0xb0ce38(0x109)]({});let _0x4ed822;if(_0x1137b7['role']=='staff'){const _0x363593=await staff['findOne']({'email':_0x1137b7['email']});_0x4ed822=await warehouse[_0xb0ce38(0x86)]([{'$match':{'status':'Enabled','name':_0x363593[_0xb0ce38(0x7e)],'warehouse_category':_0xb0ce38(0x103),'name':{'$ne':_0xb0ce38(0x12b)}}},{'$group':{'_id':_0xb0ce38(0x156),'name':{'$first':_0xb0ce38(0x156)}}}]);}else _0x4ed822=await warehouse[_0xb0ce38(0x86)]([{'$match':{'status':_0xb0ce38(0xaa),'warehouse_category':_0xb0ce38(0x103),'name':{'$ne':_0xb0ce38(0x12b)}}},{'$group':{'_id':_0xb0ce38(0x156),'name':{'$first':'$name'}}}]);const _0x1e2517=await product[_0xb0ce38(0x109)]({}),_0x59c653=await warehouse[_0xb0ce38(0x109)]({'status':_0xb0ce38(0xaa)}),_0x59c637=await purchases['find']({}),_0xdbe9b4=_0x59c637[_0xb0ce38(0xc3)]+0x1,_0x5c2401=_0xb0ce38(0xd0)+_0xdbe9b4['toString']()['padStart'](0x5,'0');var _0x4ea23f=[_0xb0ce38(0x80),_0xb0ce38(0xfc)];if(_0x529354[0x0]['language']=='English\x20(US)')var _0x3f17bc=users['English'];else{if(_0x529354[0x0][_0xb0ce38(0x8f)]==_0xb0ce38(0x13c))var _0x3f17bc=users[_0xb0ce38(0x13c)];else{if(_0x529354[0x0][_0xb0ce38(0x8f)]==_0xb0ce38(0xe2))var _0x3f17bc=users[_0xb0ce38(0xe2)];else{if(_0x529354[0x0][_0xb0ce38(0x8f)]==_0xb0ce38(0x72))var _0x3f17bc=users[_0xb0ce38(0x72)];else{if(_0x529354[0x0]['language']==_0xb0ce38(0xd7))var _0x3f17bc=users[_0xb0ce38(0xd7)];else{if(_0x529354[0x0][_0xb0ce38(0x8f)]=='Portuguese\x20(BR)')var _0x3f17bc=users['Portuguese'];else{if(_0x529354[0x0][_0xb0ce38(0x8f)]==_0xb0ce38(0x93))var _0x3f17bc=users['Chinese'];else{if(_0x529354[0x0][_0xb0ce38(0x8f)]=='Arabic\x20(ae)')var _0x3f17bc=users[_0xb0ce38(0xb9)];}}}}}}}const _0x295644=getRandom8DigitNumber();_0x295644[_0xb0ce38(0x111)](_0x507683=>{var _0xab048d=_0xb0ce38;_0x5dd210[_0xab048d(0xda)]('add_purchases',{'success':_0x289291['flash'](_0xab048d(0x185)),'errors':_0x289291[_0xab048d(0x100)](_0xab048d(0xbe)),'role':_0x1137b7,'profile':_0x14cccb,'suppliers':_0x2eb9fe,'warehouse':_0x4ed822,'product':_0x1e2517,'invoice':_0x507683,'master_shop':_0x529354,'language':_0x3f17bc,'find_data':_0x59c653,'rooms_data':_0x4ea23f});})[_0xb0ce38(0x91)](_0x135925=>{var _0x3551bc=_0xb0ce38;_0x289291[_0x3551bc(0x100)](_0x3551bc(0xbe),_0x3551bc(0x74)),_0x5dd210[_0x3551bc(0xeb)](_0x3551bc(0x176));});}catch(_0x1d1d2b){console[_0xb0ce38(0x11f)](_0x1d1d2b);}}),router['get'](a0_0x2035e9(0xc6),auth,async(_0x52f0f7,_0x138f02)=>{var _0x4e11d4=a0_0x2035e9;try{const _0x46e5b1=_0x52f0f7[_0x4e11d4(0xf4)]['id'];console[_0x4e11d4(0x11f)](_0x46e5b1);const _0x5e6b91=await master_shop[_0x4e11d4(0x109)]();console[_0x4e11d4(0x11f)]('master',_0x5e6b91);const _0x55bb5d=await product['findOne']({'name':_0x46e5b1});console[_0x4e11d4(0x11f)](_0x4e11d4(0x165),_0x55bb5d),_0x138f02[_0x4e11d4(0x153)](0xc8)[_0x4e11d4(0x13e)]({'product_data':_0x55bb5d,'master':_0x5e6b91});}catch(_0xfdb2e7){console[_0x4e11d4(0x11f)](_0x4e11d4(0x140),_0xfdb2e7);}}),router['post'](a0_0x2035e9(0x98),auth,async(_0x57b847,_0x11891e)=>{var _0x13c04d=a0_0x2035e9;try{const {invoice:_0x43ec26,date:_0x3428a7,warehouse_name:_0x4eb299,prod_name:_0xbd415c,prod_code:_0x433862,prod_qty:_0x1c158c,prod_unit:_0x43760e,prod_secondunit:_0xe2d757,prod_level:_0x56bc14,prod_isle:_0x11f144,prod_pallet:_0x4b6bad,note:_0x3ec376,expiry_date:_0x35f8d8,batch_code:_0x567b09,payable:_0x2efcf0,due_amount:_0x1b1235,Room_name:_0x375b52,primary_code:_0x55d325,secondary_code:_0x3b0f53,MaxStocks_data:_0xd8d2f4,PO_number:_0x4e643b,SCRN:_0x25bcca,JO_number:_0x387581}=_0x57b847[_0x13c04d(0xbc)];if(typeof _0xbd415c==_0x13c04d(0x10e))var _0x25d99f=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xfa)]],_0x51d625=[_0x57b847['body'][_0x13c04d(0xa3)]],_0x35b2dc=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xe6)]],_0x4ecddc=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x90)]],_0x235872=[_0x57b847['body'][_0x13c04d(0x154)]],_0x84bb0a=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x112)]],_0x13ece6=[_0x57b847['body'][_0x13c04d(0x13a)]],_0x21be9b=[_0x57b847['body'][_0x13c04d(0xc7)]],_0x345fa5=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x10a)]],_0x4ee43a=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x164)]],_0xef8850=[_0x57b847['body'][_0x13c04d(0xd9)]],_0x34796d=[_0x57b847[_0x13c04d(0xbc)]['max_product_unit']],_0x282287=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xad)]],_0x39e242=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x97)]],_0x2533fc=[_0x57b847[_0x13c04d(0xbc)]['prod_cat']],_0x4477b6=[_0x57b847[_0x13c04d(0xbc)]['RoomAssign']],_0x179f1d=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x158)]],_0x35783f=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xb5)]],_0x5c29f7=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x107)]],_0x396ea7=[_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xdf)]];else var _0x25d99f=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xfa)]],_0x51d625=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xa3)]],_0x35b2dc=[..._0x57b847['body']['prod_Qty']],_0x4ecddc=[..._0x57b847['body'][_0x13c04d(0x90)]],_0x235872=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x154)]],_0x84bb0a=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x112)]],_0x13ece6=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x13a)]],_0x21be9b=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xc7)]],_0x345fa5=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x10a)]],_0x4ee43a=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x164)]],_0xef8850=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xd9)]],_0x34796d=[..._0x57b847[_0x13c04d(0xbc)]['max_product_unit']],_0x282287=[..._0x57b847['body'][_0x13c04d(0xad)]],_0x39e242=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x97)]],_0x2533fc=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x7d)]],_0x4477b6=[..._0x57b847[_0x13c04d(0xbc)]['RoomAssign']],_0x179f1d=[..._0x57b847['body'][_0x13c04d(0x158)]],_0x35783f=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xb5)]],_0x5c29f7=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x107)]],_0x396ea7=[..._0x57b847[_0x13c04d(0xbc)][_0x13c04d(0xdf)]];const _0x2a8d81=_0x25d99f[_0x13c04d(0x14c)](_0x3e1735=>{return _0x3e1735={'product_name':_0x3e1735};});_0x5c29f7[_0x13c04d(0x116)]((_0xe9868,_0x5d0f61)=>{var _0x166426=_0x13c04d;_0x2a8d81[_0x5d0f61][_0x166426(0x107)]=Math[_0x166426(0x189)](_0xe9868);}),_0x396ea7[_0x13c04d(0x116)]((_0x706869,_0x5be4ca)=>{var _0x5828fa=_0x13c04d;_0x2a8d81[_0x5be4ca][_0x5828fa(0xdf)]=_0x706869;}),_0x51d625[_0x13c04d(0x116)]((_0x15b1da,_0x18a788)=>{var _0x2a81b8=_0x13c04d;_0x2a8d81[_0x18a788][_0x2a81b8(0x168)]=_0x15b1da;}),_0x35b2dc['forEach']((_0x248a64,_0x55c425)=>{var _0x41e879=_0x13c04d;_0x2a8d81[_0x55c425][_0x41e879(0x166)]=Math[_0x41e879(0x189)](_0x248a64);}),_0x4ecddc[_0x13c04d(0x116)]((_0x125131,_0x253bb4)=>{var _0x259cc8=_0x13c04d;_0x2a8d81[_0x253bb4][_0x259cc8(0x135)]=_0x125131;}),_0x235872['forEach']((_0xd124ca,_0x35382d)=>{var _0x1be5b1=_0x13c04d;_0x2a8d81[_0x35382d][_0x1be5b1(0x179)]=_0xd124ca;}),_0x84bb0a[_0x13c04d(0x116)]((_0x26fc81,_0x2dda30)=>{var _0x28b630=_0x13c04d;_0x4477b6[_0x28b630(0x116)]((_0x3a0187,_0x140e15)=>{var _0x3acdb3=_0x28b630;if(_0x3a0187==_0x3acdb3(0x152)&&_0x2dda30==_0x140e15){console[_0x3acdb3(0x11f)](_0x3a0187+_0x3acdb3(0x92)+_0x2dda30+_0x3acdb3(0xcc)+_0x140e15+_0x3acdb3(0xcc)+_0x26fc81);var _0x248daf=_0x26fc81['slice'](0x3);_0x2a8d81[_0x2dda30]['storage']=_0x26fc81[0x0],_0x2a8d81[_0x2dda30][_0x3acdb3(0x159)]=_0x26fc81[0x1],_0x2a8d81[_0x2dda30][_0x3acdb3(0xbd)]=0x0,_0x2a8d81[_0x2dda30]['bin']=0x0,_0x2a8d81[_0x2dda30][_0x3acdb3(0x175)]=_0x3acdb3(0xb3),_0x2a8d81[_0x2dda30]['floorlevel']=_0x248daf;}else{if(_0x3a0187=='Shelves'&&_0x2dda30==_0x140e15){var _0x248daf=_0x26fc81[_0x3acdb3(0x85)](0x3);_0x2a8d81[_0x2dda30]['storage']=_0x26fc81[0x0],_0x2a8d81[_0x2dda30][_0x3acdb3(0x159)]=_0x26fc81[0x1],_0x2a8d81[_0x2dda30][_0x3acdb3(0xbd)]=0x0,_0x2a8d81[_0x2dda30][_0x3acdb3(0xdd)]=0x0,_0x2a8d81[_0x2dda30]['type']='Floor',_0x2a8d81[_0x2dda30][_0x3acdb3(0x174)]=_0x26fc81[0x5];}else{if(_0x2dda30==_0x140e15){if(_0x26fc81[0x0]=='A'&&_0x26fc81[0x1]=='L'&&_0x26fc81[0x2]=='L')console[_0x3acdb3(0x11f)](_0x3a0187+'\x20<>\x20'+_0x2dda30+_0x3acdb3(0xcc)+_0x140e15+_0x3acdb3(0xcc)+_0x26fc81+_0x3acdb3(0x17c)),_0x2a8d81[_0x2dda30][_0x3acdb3(0x88)]=_0x26fc81[0x0],_0x2a8d81[_0x2dda30]['rack']=_0x26fc81[0x1],_0x2a8d81[_0x2dda30][_0x3acdb3(0xbd)]=0x0,_0x2a8d81[_0x2dda30][_0x3acdb3(0xdd)]=0x0,_0x2a8d81[_0x2dda30][_0x3acdb3(0x175)]='Floor',_0x2a8d81[_0x2dda30][_0x3acdb3(0x174)]=_0x26fc81[0x3];else{var _0x53c2fb;if(_0x26fc81[0x4]=='L')_0x53c2fb=_0x3acdb3(0x82);else _0x26fc81[0x4]=='F'&&(_0x53c2fb=_0x3acdb3(0xb3));_0x2a8d81[_0x2dda30]['storage']=_0x26fc81[0x0],_0x2a8d81[_0x2dda30]['rack']=_0x26fc81[0x1],_0x2a8d81[_0x2dda30][_0x3acdb3(0xbd)]=_0x26fc81[0x2],_0x2a8d81[_0x2dda30][_0x3acdb3(0xdd)]=_0x26fc81[0x3],_0x2a8d81[_0x2dda30][_0x3acdb3(0x175)]=_0x53c2fb,_0x2a8d81[_0x2dda30][_0x3acdb3(0x174)]=_0x26fc81[0x5];}}}}});}),_0x13ece6['forEach']((_0x127b37,_0x11ea8f)=>{var _0x1c46ed=_0x13c04d;_0x2a8d81[_0x11ea8f][_0x1c46ed(0x13a)]=_0x127b37;}),_0x21be9b[_0x13c04d(0x116)]((_0x60c5ae,_0x347b6a)=>{var _0x5b2d32=_0x13c04d;_0x2a8d81[_0x347b6a][_0x5b2d32(0xc7)]=_0x60c5ae;}),_0x345fa5[_0x13c04d(0x116)]((_0x51bd77,_0x9cf768)=>{var _0x376090=_0x13c04d;_0x2a8d81[_0x9cf768][_0x376090(0x171)]=_0x51bd77;}),_0x4ee43a[_0x13c04d(0x116)]((_0x28e0ea,_0x2c723f)=>{var _0x58a207=_0x13c04d;_0x2a8d81[_0x2c723f][_0x58a207(0x164)]=_0x28e0ea;}),_0xef8850[_0x13c04d(0x116)]((_0x11b70d,_0x2ca2e1)=>{_0x2a8d81[_0x2ca2e1]['expiry_date']=_0x11b70d;}),_0x34796d['forEach']((_0x41e022,_0x9e4e11)=>{var _0x45ef54=_0x13c04d;_0x2a8d81[_0x9e4e11][_0x45ef54(0x110)]=_0x41e022;}),_0x282287[_0x13c04d(0x116)]((_0x380b3b,_0x1b53c4)=>{var _0x2f2f14=_0x13c04d;_0x2a8d81[_0x1b53c4][_0x2f2f14(0xad)]=_0x380b3b;}),_0x39e242['forEach']((_0x404c03,_0x5c39ff)=>{var _0x325783=_0x13c04d;_0x2a8d81[_0x5c39ff][_0x325783(0x97)]=_0x404c03;}),_0x2533fc['forEach']((_0x3b91e2,_0x2882c2)=>{var _0x5bb320=_0x13c04d;_0x2a8d81[_0x2882c2][_0x5bb320(0x122)]=_0x3b91e2;}),_0x4477b6[_0x13c04d(0x116)]((_0x435aa6,_0x46b153)=>{var _0x30922e=_0x13c04d;_0x2a8d81[_0x46b153][_0x30922e(0x17b)]=_0x435aa6;}),_0x179f1d[_0x13c04d(0x116)]((_0xd30a8d,_0x1d2083)=>{var _0x534a32=_0x13c04d;_0x2a8d81[_0x1d2083][_0x534a32(0x7b)]=_0xd30a8d;}),_0x35783f[_0x13c04d(0x116)]((_0x40dee2,_0x1c6491)=>{_0x2a8d81[_0x1c6491]['invoice']=_0x40dee2;});const _0x20a067=_0x4477b6[_0x13c04d(0x14c)](_0x476da8=>{return _0x476da8={'room_name':_0x476da8};}),_0x3cbd9d=_0x2a8d81[_0x13c04d(0x118)](_0x42f3b9=>_0x42f3b9[_0x13c04d(0x166)]!=='0'&&_0x42f3b9[_0x13c04d(0x166)]!==''),_0x2adb53=new purchases({'invoice':_0x43ec26,'suppliers':_0x57b847[_0x13c04d(0xbc)][_0x13c04d(0x12f)],'date':_0x3428a7,'warehouse_name':_0x4eb299,'product':_0x3cbd9d,'note':_0x3ec376,'due_amount':_0x1b1235,'POnumber':_0x4e643b,'SCRN':_0x25bcca,'JO_number':_0x387581,'roomList':_0x20a067}),_0x3ecf79=await _0x2adb53[_0x13c04d(0x9b)](),_0x1dbe8e=await purchases[_0x13c04d(0xb6)]({'invoice':_0x43ec26}),_0x4cdc14=_0x1dbe8e[_0x13c04d(0x165)][_0x13c04d(0x14c)](async _0x1a5b7a=>{var _0x2600dc=_0x13c04d,_0x4cac7f=await warehouse[_0x2600dc(0xb6)]({'name':_0x4eb299,'room':_0x1a5b7a[_0x2600dc(0x17b)]}),_0x5a4311=0x0;return _0x4cac7f[_0x2600dc(0xb0)][_0x2600dc(0x116)](_0x413e60=>{var _0x473fb3=_0x2600dc;_0x413e60[_0x473fb3(0x147)]==_0x1a5b7a[_0x473fb3(0x147)]&&_0x413e60[_0x473fb3(0x174)]==_0x1a5b7a[_0x473fb3(0x174)]&&_0x413e60[_0x473fb3(0x175)]==_0x1a5b7a['type']&&_0x413e60[_0x473fb3(0xdd)]==_0x1a5b7a[_0x473fb3(0xdd)]&&_0x413e60[_0x473fb3(0xbd)]==_0x1a5b7a[_0x473fb3(0xbd)]&&_0x413e60['rack']==_0x1a5b7a[_0x473fb3(0x159)]&&_0x413e60[_0x473fb3(0x88)]==_0x1a5b7a[_0x473fb3(0x88)]&&_0x413e60['expiry_date']==_0x1a5b7a[_0x473fb3(0xd9)]&&_0x413e60[_0x473fb3(0x164)]==_0x1a5b7a[_0x473fb3(0x164)]&&_0x413e60[_0x473fb3(0x97)]==_0x1a5b7a[_0x473fb3(0x97)]&&_0x413e60['invoice']==_0x1dbe8e['invoice']&&(_0x413e60[_0x473fb3(0x10b)]+=Math[_0x473fb3(0x189)](_0x1a5b7a[_0x473fb3(0x166)]),_0x5a4311++);}),_0x5a4311===0x0&&_0x4cac7f[_0x2600dc(0xb0)][_0x2600dc(0x136)]({'product_name':_0x1a5b7a[_0x2600dc(0x147)],'product_stock':Math['abs'](_0x1a5b7a[_0x2600dc(0x166)]),'primary_code':_0x1a5b7a['primary_code'],'secondary_code':_0x1a5b7a[_0x2600dc(0xc7)],'product_code':_0x1a5b7a[_0x2600dc(0x168)],'storage':_0x1a5b7a[_0x2600dc(0x88)],'rack':_0x1a5b7a[_0x2600dc(0x159)],'bay':_0x1a5b7a[_0x2600dc(0xbd)],'bin':_0x1a5b7a[_0x2600dc(0xdd)],'type':_0x1a5b7a['type'],'floorlevel':_0x1a5b7a['floorlevel'],'maxProducts':_0x1a5b7a['maxStocks'],'unit':_0x1a5b7a[_0x2600dc(0x135)],'secondary_unit':_0x1a5b7a[_0x2600dc(0x179)],'expiry_date':_0x1a5b7a[_0x2600dc(0xd9)],'maxPerUnit':_0x1a5b7a[_0x2600dc(0x110)],'batch_code':_0x1a5b7a[_0x2600dc(0x164)],'alertQTY':_0x1a5b7a[_0x2600dc(0xad)],'production_date':_0x1a5b7a['production_date'],'product_cat':_0x1a5b7a['product_cat'],'invoice':_0x1a5b7a[_0x2600dc(0x162)],'actual_qty':Math[_0x2600dc(0x189)](_0x1a5b7a[_0x2600dc(0x107)]),'actual_uom':_0x1a5b7a['actual_uom']}),_0x4cac7f;});Promise[_0x13c04d(0x15f)](_0x4cdc14)[_0x13c04d(0x111)](async _0x3b998c=>{var _0x59bcc6=_0x13c04d;try{for(const _0x48ae09 of _0x3b998c){await _0x48ae09[_0x59bcc6(0x9b)]();}const _0x342481=await master_shop['find'](),_0x45238e=await email_settings[_0x59bcc6(0xb6)](),_0x240eb8=await supervisor_settings[_0x59bcc6(0x109)]();var _0x2145da=_0x1dbe8e['product'],_0x43998f='',_0x515ff0;for(_0x515ff0 in _0x2145da){_0x43998f+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2145da[_0x515ff0][_0x59bcc6(0x147)]+_0x59bcc6(0x113)+_0x59bcc6(0x15e)+_0x2145da[_0x515ff0]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2145da[_0x515ff0]['quantity']+_0x59bcc6(0x113)+_0x59bcc6(0x15e)+_0x2145da[_0x515ff0][_0x59bcc6(0x135)]+'</td>'+_0x59bcc6(0x15e)+_0x2145da[_0x515ff0][_0x59bcc6(0x179)]+_0x59bcc6(0x113)+_0x59bcc6(0x15e)+_0x1dbe8e[_0x59bcc6(0x121)]+_0x59bcc6(0x113)+_0x59bcc6(0x15e)+_0x2145da[_0x515ff0][_0x59bcc6(0x17b)]+_0x59bcc6(0x113)+_0x59bcc6(0x15e)+_0x2145da[_0x515ff0][_0x59bcc6(0x88)]+_0x2145da[_0x515ff0][_0x59bcc6(0x159)]+_0x2145da[_0x515ff0][_0x59bcc6(0xbd)]+_0x2145da[_0x515ff0][_0x59bcc6(0xdd)]+_0x2145da[_0x515ff0][_0x59bcc6(0x175)][0x0]+_0x2145da[_0x515ff0][_0x59bcc6(0x174)]+_0x59bcc6(0x113),_0x59bcc6(0xb4);}let _0x1aed4a=nodemailer[_0x59bcc6(0x120)]({'host':_0x45238e[_0x59bcc6(0xed)],'port':Number(_0x45238e[_0x59bcc6(0xab)]),'secure':![],'auth':{'user':_0x45238e['email'],'pass':_0x45238e[_0x59bcc6(0x17a)]}}),_0x7639c7={'from':_0x45238e[_0x59bcc6(0xde)],'to':_0x240eb8[0x0][_0x59bcc6(0xc2)],'subject':_0x59bcc6(0x182),'attachments':[{'filename':_0x59bcc6(0x184),'path':__dirname+_0x59bcc6(0x84)+_0x59bcc6(0x104)+_0x342481[0x0][_0x59bcc6(0x15a)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x59bcc6(0xef)+_0x59bcc6(0xe5)+_0x59bcc6(0xef)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x59bcc6(0x10c)+_0x59bcc6(0xef)+_0x59bcc6(0x172)+_0x342481[0x0][_0x59bcc6(0x8c)]+_0x59bcc6(0xc8)+_0x59bcc6(0x10c)+_0x59bcc6(0x10c)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x59bcc6(0x123)+_0x1dbe8e[_0x59bcc6(0x162)]+'\x20'+_0x59bcc6(0x79)+'\x20Order\x20Date\x20:\x20'+_0x1dbe8e[_0x59bcc6(0x151)]+'\x20'+_0x59bcc6(0x15b)+_0x59bcc6(0x14e)+_0x59bcc6(0x10c)+_0x59bcc6(0x17d)+_0x59bcc6(0xf0)+_0x59bcc6(0x143)+_0x59bcc6(0xfd)+_0x59bcc6(0xf9)+_0x59bcc6(0x9f)+_0x59bcc6(0xbf)+_0x59bcc6(0x78)+_0x59bcc6(0xe0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x59bcc6(0xb4)+_0x59bcc6(0xc5)+_0x59bcc6(0xac)+'\x20'+_0x43998f+'\x20'+_0x59bcc6(0x163)+'</table>'+_0x59bcc6(0xef)+'<strong>\x20Regards\x20</strong>'+_0x59bcc6(0xcb)+_0x342481[0x0][_0x59bcc6(0x8c)]+_0x59bcc6(0x14e)+_0x59bcc6(0x10c)+_0x59bcc6(0x10c)+_0x59bcc6(0x177)};_0x1aed4a[_0x59bcc6(0x102)](_0x7639c7,function(_0x19f651,_0x327c13){var _0x186fe9=_0x59bcc6;_0x19f651?(console[_0x186fe9(0x11f)](_0x19f651),console[_0x186fe9(0x11f)](_0x186fe9(0xa2))):console[_0x186fe9(0x11f)](_0x186fe9(0x146));}),_0x57b847[_0x59bcc6(0x100)](_0x59bcc6(0x185),'Purchase\x20data\x20added\x20successfully'),_0x11891e['redirect']('/all_purchases/view/');}catch(_0x5d157e){console[_0x59bcc6(0xe7)](_0x5d157e),_0x11891e['status'](0x1f4)[_0x59bcc6(0x13e)]({'error':_0x59bcc6(0x108)});}})[_0x13c04d(0x91)](_0x5be9c5=>{var _0x153f09=_0x13c04d;console[_0x153f09(0xe7)](_0x5be9c5),_0x11891e[_0x153f09(0x153)](0x1f4)[_0x153f09(0x13e)]({'error':'An\x20error\x20occurred.'});});}catch(_0x290939){console['log'](_0x290939);}}),router[a0_0x2035e9(0x141)]('/preview/:id',auth,async(_0x39761b,_0x532c22)=>{var _0x53551e=a0_0x2035e9;try{const {username:_0xe5df5e,email:_0x215362,role:_0x1706da}=_0x39761b[_0x53551e(0xcf)],_0xe2d82f=_0x39761b['user'],_0x41c785=await profile['findOne']({'email':_0xe2d82f[_0x53551e(0xde)]}),_0x301550=await master_shop['find'](),_0x247aac=_0x39761b[_0x53551e(0xf4)]['id'],_0x11e596=await purchases['findById'](_0x247aac),_0x5bc69d=await warehouse[_0x53551e(0x86)]([{'$match':{'name':_0x11e596[_0x53551e(0x121)],'room':_0x11e596['room']}},{'$unwind':_0x53551e(0x126)},{'$group':{'_id':_0x53551e(0xf6),'name':{'$first':_0x53551e(0x130)},'product_stock':{'$first':_0x53551e(0xd4)},'bay':{'$first':_0x53551e(0xa7)},'bin':{'$first':_0x53551e(0x105)},'type':{'$first':_0x53551e(0x134)},'floorlevel':{'$first':_0x53551e(0x9c)},'primary_code':{'$first':_0x53551e(0x173)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x53551e(0xa4)},'storage':{'$first':_0x53551e(0xa6)},'rack':{'$first':_0x53551e(0x124)},'expiry_date':{'$first':_0x53551e(0xa8)}}}]),_0xb3909b=await customer['find']({});let _0x219d6a;if(_0xe2d82f[_0x53551e(0x83)]=='staff'){const _0x1f0695=await staff['findOne']({'email':_0xe2d82f[_0x53551e(0xde)]});_0x219d6a=await warehouse[_0x53551e(0x86)]([{'$match':{'status':'Enabled','name':_0x1f0695[_0x53551e(0x7e)]}},{'$group':{'_id':_0x53551e(0x156),'name':{'$first':_0x53551e(0x156)}}}]);}else _0x219d6a=await warehouse['aggregate']([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x53551e(0x156)}}}]);const _0x3cfa44=await product[_0x53551e(0x109)]({}),_0x1915a3=await suppliers[_0x53551e(0x109)]({}),_0x1a96fa=BayBinSelected(_0x11e596[_0x53551e(0x121)],_0x11e596[_0x53551e(0x70)]);if(_0x301550[0x0][_0x53551e(0x8f)]=='English\x20(US)'){var _0x2b8fd3=users[_0x53551e(0x6f)];console[_0x53551e(0x11f)](_0x2b8fd3);}else{if(_0x301550[0x0][_0x53551e(0x8f)]==_0x53551e(0x13c))var _0x2b8fd3=users[_0x53551e(0x13c)];else{if(_0x301550[0x0][_0x53551e(0x8f)]=='German')var _0x2b8fd3=users[_0x53551e(0xe2)];else{if(_0x301550[0x0][_0x53551e(0x8f)]=='Spanish')var _0x2b8fd3=users[_0x53551e(0x72)];else{if(_0x301550[0x0][_0x53551e(0x8f)]=='French')var _0x2b8fd3=users[_0x53551e(0xd7)];else{if(_0x301550[0x0]['language']==_0x53551e(0x14f))var _0x2b8fd3=users[_0x53551e(0xff)];else{if(_0x301550[0x0][_0x53551e(0x8f)]==_0x53551e(0x93))var _0x2b8fd3=users['Chinese'];else{if(_0x301550[0x0]['language']=='Arabic\x20(ae)')var _0x2b8fd3=users[_0x53551e(0xb9)];}}}}}}}_0x532c22[_0x53551e(0xda)]('edit_purchases_view',{'success':_0x39761b['flash'](_0x53551e(0x185)),'errors':_0x39761b['flash'](_0x53551e(0xbe)),'role':_0xe2d82f,'profile':_0x41c785,'customer':_0xb3909b,'warehouse':_0x219d6a,'product':_0x5bc69d,'user':_0x11e596,'master_shop':_0x301550,'unit':_0x3cfa44,'language':_0x2b8fd3,'suppliers':_0x1915a3,'dataSelected':_0x1a96fa});}catch(_0x3a0f63){console['log'](_0x3a0f63);}}),router[a0_0x2035e9(0x73)]('/preview/:id',auth,async(_0x353dca,_0x5735bc)=>{var _0x3ed6c4=a0_0x2035e9;try{const _0x1661f2=_0x353dca['params']['id'],{invoice:_0x4ab250,warehouse_name:_0x2f0caa,Room_name:_0x17ba54}=_0x353dca['body'],_0x2aeaed=await warehouse[_0x3ed6c4(0xb6)]({'name':_0x2f0caa,'room':_0x17ba54}),_0x34e053=await purchases[_0x3ed6c4(0xb6)]({'invoice':_0x4ab250});_0x34e053[_0x3ed6c4(0x165)][_0x3ed6c4(0x116)](_0x223834=>{var _0x440572=_0x3ed6c4,_0x1c8d44=0x0;const _0x502f97=_0x2aeaed[_0x440572(0xb0)][_0x440572(0x14c)](_0x277bb7=>{var _0x1d2d6e=_0x440572;_0x277bb7[_0x1d2d6e(0x147)]==_0x223834[_0x1d2d6e(0x147)]&&_0x277bb7['floorlevel']==_0x223834[_0x1d2d6e(0x174)]&&_0x277bb7[_0x1d2d6e(0x175)]==_0x223834['type']&&_0x277bb7[_0x1d2d6e(0xdd)]==_0x223834[_0x1d2d6e(0xdd)]&&_0x277bb7[_0x1d2d6e(0xbd)]==_0x223834[_0x1d2d6e(0xbd)]&&_0x277bb7[_0x1d2d6e(0x159)]==_0x223834['rack']&&_0x277bb7[_0x1d2d6e(0x88)]==_0x223834[_0x1d2d6e(0x88)]&&_0x277bb7[_0x1d2d6e(0xd9)]==_0x223834[_0x1d2d6e(0xd9)]&&_0x277bb7[_0x1d2d6e(0x164)]==_0x223834[_0x1d2d6e(0x164)]&&_0x277bb7[_0x1d2d6e(0x97)]==_0x223834[_0x1d2d6e(0x97)]&&_0x277bb7[_0x1d2d6e(0x16e)]==_0x223834[_0x1d2d6e(0x16e)]&&_0x277bb7[_0x1d2d6e(0x7b)]==_0x223834[_0x1d2d6e(0x7b)]&&(_0x277bb7[_0x1d2d6e(0x10b)]=parseInt(_0x277bb7[_0x1d2d6e(0x10b)])+parseInt(_0x223834[_0x1d2d6e(0x166)]),_0x1c8d44++);});_0x1c8d44=='0'&&(_0x2aeaed['product_details']=_0x2aeaed[_0x440572(0xb0)][_0x440572(0x16b)]({'product_name':_0x223834[_0x440572(0x147)],'product_stock':_0x223834[_0x440572(0x166)],'primary_code':_0x223834[_0x440572(0x13a)],'secondary_code':_0x223834[_0x440572(0xc7)],'product_code':_0x223834[_0x440572(0x168)],'storage':_0x223834[_0x440572(0x88)],'rack':_0x223834[_0x440572(0x159)],'bay':_0x223834[_0x440572(0xbd)],'bin':_0x223834[_0x440572(0xdd)],'type':_0x223834['type'],'floorlevel':_0x223834['floorlevel'],'maxProducts':_0x223834[_0x440572(0x171)],'unit':_0x223834[_0x440572(0x135)],'secondary_unit':_0x223834[_0x440572(0x179)],'expiry_date':_0x223834['expiry_date'],'maxPerUnit':_0x223834['maxperunit'],'batch_code':_0x223834['batch_code'],'alertQTY':_0x223834['alertQTY'],'production_date':_0x223834['production_date'],'delivery_date':_0x223834['delivery_date'],'delivery_code':_0x223834[_0x440572(0x7b)]}));}),await _0x2aeaed[_0x3ed6c4(0x9b)](),_0x34e053['finalize']='True';const _0x3185e5=await _0x34e053[_0x3ed6c4(0x9b)]();_0x353dca['flash'](_0x3ed6c4(0x185),'Sales\x20Update\x20successfully'),_0x5735bc[_0x3ed6c4(0xeb)](_0x3ed6c4(0x176));}catch(_0x5f2eb8){console[_0x3ed6c4(0x11f)](_0x5f2eb8);}}),router[a0_0x2035e9(0x141)](a0_0x2035e9(0x8e),auth,async(_0x3dc0b4,_0x45b167)=>{var _0x23ffda=a0_0x2035e9;try{const {username:_0x1042d8,email:_0xe8f450,role:_0x5a1c52}=_0x3dc0b4['user'],_0x135509=_0x3dc0b4[_0x23ffda(0xcf)],_0x490b0a=await profile[_0x23ffda(0xb6)]({'email':_0x135509[_0x23ffda(0xde)]}),_0x5dfc7a=await master_shop[_0x23ffda(0x109)](),_0x1de972=_0x3dc0b4[_0x23ffda(0xf4)]['id'],_0x3058af=await purchases[_0x23ffda(0x149)](_0x1de972),_0x34b2b0=await suppliers[_0x23ffda(0x109)]({});let _0xf64a64;if(_0x135509[_0x23ffda(0x83)]==_0x23ffda(0x114)){const _0x4e16d4=await staff[_0x23ffda(0xb6)]({'email':_0x135509['email']});_0xf64a64=await warehouse[_0x23ffda(0x109)]({'status':_0x23ffda(0xaa),'name':_0x4e16d4[_0x23ffda(0x7e)],'warehouse_category':_0x23ffda(0x103)});}else _0xf64a64=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x23ffda(0x103)}},{'$group':{'_id':'$name','name':{'$first':_0x23ffda(0x156)}}}]);const _0x264cbf=await product[_0x23ffda(0x109)]({}),_0x4ceb23=BayBinSelected(_0x3058af[_0x23ffda(0x121)],_0x3058af[_0x23ffda(0x70)]);let _0x54028f=new Date(_0x3058af[_0x23ffda(0xd9)]),_0x5a154b=('0'+_0x54028f[_0x23ffda(0xd5)]())[_0x23ffda(0x85)](-0x2),_0x233180=('0'+(_0x54028f['getMonth']()+0x1))[_0x23ffda(0x85)](-0x2),_0x1ea30e=_0x54028f[_0x23ffda(0x16a)](),_0x348713=_0x1ea30e+'-'+_0x233180+'-'+_0x5a154b;if(_0x5dfc7a[0x0][_0x23ffda(0x8f)]==_0x23ffda(0x183)){var _0x46bed5=users[_0x23ffda(0x6f)];console['log'](_0x46bed5);}else{if(_0x5dfc7a[0x0]['language']=='Hindi')var _0x46bed5=users[_0x23ffda(0x13c)];else{if(_0x5dfc7a[0x0][_0x23ffda(0x8f)]=='German')var _0x46bed5=users[_0x23ffda(0xe2)];else{if(_0x5dfc7a[0x0][_0x23ffda(0x8f)]==_0x23ffda(0x72))var _0x46bed5=users[_0x23ffda(0x72)];else{if(_0x5dfc7a[0x0][_0x23ffda(0x8f)]==_0x23ffda(0xd7))var _0x46bed5=users[_0x23ffda(0xd7)];else{if(_0x5dfc7a[0x0]['language']==_0x23ffda(0x14f))var _0x46bed5=users['Portuguese'];else{if(_0x5dfc7a[0x0][_0x23ffda(0x8f)]=='Chinese')var _0x46bed5=users[_0x23ffda(0x93)];else{if(_0x5dfc7a[0x0][_0x23ffda(0x8f)]=='Arabic\x20(ae)')var _0x46bed5=users['Arabic'];}}}}}}}_0x45b167[_0x23ffda(0xda)](_0x23ffda(0x7f),{'success':_0x3dc0b4[_0x23ffda(0x100)](_0x23ffda(0x185)),'errors':_0x3dc0b4['flash'](_0x23ffda(0xbe)),'role':_0x135509,'profile':_0x490b0a,'purchases':_0x3058af,'suppliers':_0x34b2b0,'warehouse':_0xf64a64,'product':_0x264cbf,'master_shop':_0x5dfc7a,'language':_0x46bed5,'ed_fullDate':_0x348713,'dataSelected':_0x4ceb23});}catch(_0x4a0353){console[_0x23ffda(0x11f)](_0x4a0353);}}),router[a0_0x2035e9(0x73)](a0_0x2035e9(0x8e),auth,async(_0x533183,_0x399c5f)=>{var _0x2ca056=a0_0x2035e9;try{const _0x76094b=_0x533183['params']['id'],_0x48b6da=await purchases['findOne']({'_id':_0x533183[_0x2ca056(0xf4)]['id']}),_0x4f7288=await warehouse['findOne']({'name':_0x48b6da[_0x2ca056(0x121)],'room':_0x48b6da[_0x2ca056(0x70)]});_0x48b6da[_0x2ca056(0x165)][_0x2ca056(0x116)](_0x359cd1=>{var _0x856230=_0x2ca056;const _0x872d98=_0x4f7288[_0x856230(0xb0)][_0x856230(0x14c)](_0x497098=>{var _0x4aaa32=_0x856230;_0x497098[_0x4aaa32(0x147)]==_0x359cd1[_0x4aaa32(0x147)]&&_0x497098['floorlevel']==_0x359cd1['floorlevel']&&_0x497098[_0x4aaa32(0x175)]==_0x359cd1[_0x4aaa32(0x175)]&&_0x497098[_0x4aaa32(0xdd)]==_0x359cd1[_0x4aaa32(0xdd)]&&_0x497098['bay']==_0x359cd1['bay']&&_0x497098[_0x4aaa32(0x159)]==_0x359cd1['rack']&&_0x497098[_0x4aaa32(0x88)]==_0x359cd1[_0x4aaa32(0x88)]&&(_0x497098[_0x4aaa32(0x10b)]=parseInt(_0x497098[_0x4aaa32(0x10b)])-parseInt(_0x359cd1[_0x4aaa32(0x166)]));});}),await _0x4f7288['save']();const {invoice:_0x608dc5,suppliers:_0x3ca6bb,date:_0x41fcd9,warehouse_name:_0x4398f1,prod_name:_0x47de63,prod_code:_0x3b2dc0,prod_qty:_0x4fc1c2,prod_unit:_0x54a3,prod_secondunit:_0x11acdb,prod_level:_0x27dc55,prod_isle:_0x3562b3,prod_pallet:_0x17e57f,note:_0x5b9236,expiry_date:_0x3fd855,batch_code:_0x1daa78,paid_amount:_0x34754c,due_amount:_0x3aaa2b,Room_name:_0x57103c,primary_code:_0xf521d6,secondary_code:_0x811c5a,PO_number:_0x1aacf0,JO_number:_0x21fd89}=_0x533183[_0x2ca056(0xbc)];if(typeof _0x47de63==_0x2ca056(0x10e))var _0x9ce7ba=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0xfa)]],_0x48684e=[_0x533183[_0x2ca056(0xbc)]['prod_code']],_0x2bba26=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x11a)]],_0x38e64c=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x16d)]],_0x95deba=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x154)]],_0x453c0a=[_0x533183['body'][_0x2ca056(0x112)]],_0x5d45a2=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x14a)]],_0x211e4f=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x169)]],_0x55a4bb=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x13a)]],_0x3b3fc9=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0xc7)]],_0x4c55ec=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x10a)]],_0x1aa7e4=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x164)]],_0x30828e=[_0x533183['body'][_0x2ca056(0xd9)]],_0x2215be=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x88)]],_0x27d863=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0xf5)]],_0x4e7b19=[_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x175)]];else var _0x9ce7ba=[..._0x533183['body']['prod_name']],_0x48684e=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0xa3)]],_0x2bba26=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0x11a)]],_0x38e64c=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0x16d)]],_0x95deba=[..._0x533183['body']['prod_secondunit']],_0x453c0a=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0x112)]],_0x5d45a2=[..._0x533183[_0x2ca056(0xbc)]['prod_isle']],_0x211e4f=[..._0x533183['body'][_0x2ca056(0x169)]],_0x55a4bb=[..._0x533183[_0x2ca056(0xbc)]['primary_code']],_0x3b3fc9=[..._0x533183['body'][_0x2ca056(0xc7)]],_0x4c55ec=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0x10a)]],_0x1aa7e4=[..._0x533183['body']['batch_code']],_0x30828e=[..._0x533183['body'][_0x2ca056(0xd9)]],_0x2215be=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0x88)]],_0x27d863=[..._0x533183[_0x2ca056(0xbc)][_0x2ca056(0xf5)]],_0x4e7b19=[..._0x533183['body'][_0x2ca056(0x175)]];const _0x321e28=_0x9ce7ba[_0x2ca056(0x14c)](_0x21bd1a=>{return _0x21bd1a={'product_name':_0x21bd1a};});_0x48684e[_0x2ca056(0x116)]((_0x244b49,_0x9734bc)=>{var _0x414df1=_0x2ca056;_0x321e28[_0x9734bc][_0x414df1(0x168)]=_0x244b49;}),_0x2bba26['forEach']((_0x444e0b,_0x32d12b)=>{var _0xfa6f2b=_0x2ca056;_0x321e28[_0x32d12b][_0xfa6f2b(0x166)]=_0x444e0b;}),_0x38e64c['forEach']((_0x234616,_0x2b7962)=>{var _0x1296d4=_0x2ca056;_0x321e28[_0x2b7962][_0x1296d4(0x135)]=_0x234616;}),_0x95deba[_0x2ca056(0x116)]((_0x6135ae,_0x388284)=>{_0x321e28[_0x388284]['secondary_unit']=_0x6135ae;}),_0x453c0a[_0x2ca056(0x116)]((_0x597beb,_0x1a34b3)=>{_0x321e28[_0x1a34b3]['bay']=_0x597beb;}),_0x5d45a2['forEach']((_0xb1ac41,_0x5200fe)=>{var _0x42a0b4=_0x2ca056;_0x321e28[_0x5200fe][_0x42a0b4(0xdd)]=_0xb1ac41;}),_0x211e4f[_0x2ca056(0x116)]((_0xde4f62,_0x541d54)=>{var _0x7a70f3=_0x2ca056;_0x321e28[_0x541d54][_0x7a70f3(0x174)]=_0xde4f62;}),_0x55a4bb[_0x2ca056(0x116)]((_0xe517fa,_0x129752)=>{var _0x3358c1=_0x2ca056;_0x321e28[_0x129752][_0x3358c1(0x13a)]=_0xe517fa;}),_0x3b3fc9[_0x2ca056(0x116)]((_0x24364e,_0x18a35c)=>{var _0x17f22c=_0x2ca056;_0x321e28[_0x18a35c][_0x17f22c(0xc7)]=_0x24364e;}),_0x4c55ec['forEach']((_0x1e1c2b,_0x5dc3f5)=>{_0x321e28[_0x5dc3f5]['maxStocks']=_0x1e1c2b;}),_0x1aa7e4['forEach']((_0x293c01,_0x5599e6)=>{var _0x5c9cfe=_0x2ca056;_0x321e28[_0x5599e6][_0x5c9cfe(0x164)]=_0x293c01;}),_0x30828e[_0x2ca056(0x116)]((_0x11aa2b,_0xa35444)=>{var _0x1bb879=_0x2ca056;_0x321e28[_0xa35444][_0x1bb879(0xd9)]=_0x11aa2b;}),_0x4e7b19[_0x2ca056(0x116)]((_0x3d22cd,_0x1ae398)=>{var _0x3502f3=_0x2ca056;_0x321e28[_0x1ae398][_0x3502f3(0x175)]=_0x3d22cd;}),_0x2215be[_0x2ca056(0x116)]((_0x2285e3,_0x3b47c1)=>{var _0x3f1bf8=_0x2ca056;_0x321e28[_0x3b47c1][_0x3f1bf8(0x88)]=_0x2285e3;}),_0x27d863[_0x2ca056(0x116)]((_0x4c1b1f,_0x5ec6d0)=>{var _0x4b7408=_0x2ca056;_0x321e28[_0x5ec6d0][_0x4b7408(0x159)]=_0x4c1b1f;});const _0x357a44=_0x321e28[_0x2ca056(0x118)](_0x1e62c5=>_0x1e62c5[_0x2ca056(0x166)]!=='0'&&_0x1e62c5[_0x2ca056(0x166)]!=='');_0x48b6da[_0x2ca056(0x162)]=_0x608dc5,_0x48b6da[_0x2ca056(0x12f)]=_0x3ca6bb,_0x48b6da[_0x2ca056(0x151)]=_0x41fcd9,_0x48b6da[_0x2ca056(0x121)]=_0x4398f1,_0x48b6da['product']=_0x357a44,_0x48b6da[_0x2ca056(0xa9)]=_0x5b9236,_0x48b6da['paid_amount']=_0x34754c,_0x48b6da['due_amount']=_0x3aaa2b,_0x48b6da['room']=_0x57103c,_0x48b6da[_0x2ca056(0x8b)]=_0x1aacf0,_0x48b6da[_0x2ca056(0xe8)]=_0x21fd89;const _0xc396fd=await _0x48b6da[_0x2ca056(0x9b)](),_0x4c493d=await warehouse[_0x2ca056(0xb6)]({'name':_0x533183['body'][_0x2ca056(0x121)],'room':_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x12d)]});_0x48b6da[_0x2ca056(0x165)][_0x2ca056(0x116)](_0x195bfc=>{var _0x3f18ef=_0x2ca056,_0x4fcda5=0x0;const _0x3560a4=_0x4c493d[_0x3f18ef(0xb0)][_0x3f18ef(0x14c)](_0x4aa5a4=>{var _0x3f841e=_0x3f18ef;_0x4aa5a4['product_name']==_0x195bfc[_0x3f841e(0x147)]&&_0x4aa5a4[_0x3f841e(0x174)]==_0x195bfc['floorlevel']&&_0x4aa5a4[_0x3f841e(0x175)]==_0x195bfc[_0x3f841e(0x175)]&&_0x4aa5a4[_0x3f841e(0xdd)]==_0x195bfc['bin']&&_0x4aa5a4[_0x3f841e(0xbd)]==_0x195bfc[_0x3f841e(0xbd)]&&_0x4aa5a4[_0x3f841e(0x159)]==_0x195bfc[_0x3f841e(0x159)]&&_0x4aa5a4[_0x3f841e(0x88)]==_0x195bfc[_0x3f841e(0x88)]&&(_0x4aa5a4['product_stock']=parseInt(_0x4aa5a4['product_stock'])+parseInt(_0x195bfc[_0x3f841e(0x166)]),_0x4fcda5++);});_0x4fcda5=='0'&&(_0x4c493d[_0x3f18ef(0xb0)]=_0x4c493d[_0x3f18ef(0xb0)][_0x3f18ef(0x16b)]({'product_name':_0x195bfc[_0x3f18ef(0x147)],'product_stock':_0x195bfc[_0x3f18ef(0x166)],'primary_code':_0x195bfc[_0x3f18ef(0x13a)],'secondary_code':_0x195bfc['secondary_code'],'product_code':_0x195bfc['product_code'],'storage':_0x195bfc['storage'],'rack':_0x195bfc[_0x3f18ef(0x159)],'bay':_0x195bfc[_0x3f18ef(0xbd)],'bin':_0x195bfc[_0x3f18ef(0xdd)],'type':_0x195bfc[_0x3f18ef(0x175)],'floorlevel':_0x195bfc['floorlevel'],'maxProducts':_0x195bfc[_0x3f18ef(0x171)],'unit':_0x195bfc[_0x3f18ef(0x135)],'secondary_unit':_0x195bfc[_0x3f18ef(0x179)],'expiry_date':_0x195bfc['expiry_date']}));}),await _0x4c493d[_0x2ca056(0x9b)]();const _0x56b7a6=await s_payment_data[_0x2ca056(0xb6)]({'invoice':_0x533183[_0x2ca056(0xbc)][_0x2ca056(0x162)]});if(_0x56b7a6===null){}else console[_0x2ca056(0x11f)](_0x2ca056(0x12f),_0x56b7a6,_0x533183[_0x2ca056(0xbc)]['invoice']),_0x56b7a6[_0x2ca056(0x12f)]=_0x533183['body'][_0x2ca056(0x12f)],await _0x56b7a6[_0x2ca056(0x9b)]();_0x533183[_0x2ca056(0x100)](_0x2ca056(0x185),'purchase\x20data\x20update\x20successfully'),_0x399c5f[_0x2ca056(0xeb)]('/all_purchases/view');}catch(_0x5770ee){console[_0x2ca056(0x11f)](_0x5770ee);}}),router['post'](a0_0x2035e9(0x9a),auth,async(_0x252f53,_0x5bab94)=>{var _0x4a3a44=a0_0x2035e9;try{const _0x58342b=_0x252f53[_0x4a3a44(0xf4)]['id'],{invoice:_0x4f6737,suppliers:_0xe7692c,payable:_0xc8b591,due_amount:_0x1a1050}=_0x252f53[_0x4a3a44(0xbc)],_0x46ce49=await purchases['findById'](_0x58342b);var _0x2cb53a=_0xc8b591-_0x1a1050;_0x46ce49[_0x4a3a44(0x142)]=parseFloat(_0x46ce49['paid_amount'])+parseFloat(_0x1a1050),_0x46ce49[_0x4a3a44(0x77)]=_0x2cb53a;const _0x135f51=await _0x46ce49[_0x4a3a44(0x9b)]();console[_0x4a3a44(0x11f)](_0x135f51);const _0xa0eb5a=await s_payment_data[_0x4a3a44(0xb6)]({'invoice':_0x4f6737});_0xa0eb5a[_0x4a3a44(0x186)]=_0x2cb53a,await _0xa0eb5a[_0x4a3a44(0x9b)]();let _0x103bf5=new Date(),_0x1778d6=('0'+_0x103bf5[_0x4a3a44(0xd5)]())[_0x4a3a44(0x85)](-0x2),_0x26df07=('0'+(_0x103bf5[_0x4a3a44(0xb2)]()+0x1))[_0x4a3a44(0x85)](-0x2),_0x167f34=_0x103bf5[_0x4a3a44(0x16a)](),_0x2287ec=_0x167f34+'-'+_0x26df07+'-'+_0x1778d6;const _0x2e0931=new suppliers_payment({'invoice':_0x4f6737,'date':_0x167f34+'-'+_0x26df07+'-'+_0x1778d6,'suppliers':_0xe7692c,'reason':_0x4a3a44(0x11e),'amount':_0x1a1050}),_0x4a8708=await _0x2e0931[_0x4a3a44(0x9b)]();_0x252f53[_0x4a3a44(0x100)](_0x4a3a44(0x185),_0x4a3a44(0x188)),_0x5bab94[_0x4a3a44(0xeb)](_0x4a3a44(0x176));}catch(_0xd790b0){console[_0x4a3a44(0x11f)](_0xd790b0);}}),router[a0_0x2035e9(0x141)](a0_0x2035e9(0xae),auth,async(_0x42dae6,_0x19996a)=>{var _0x5c5013=a0_0x2035e9;try{const {username:_0x4c7f74,email:_0x5219af,role:_0x464dd1}=_0x42dae6[_0x5c5013(0xcf)],_0x4410ea=_0x42dae6['user'],_0x34b8c6=await profile[_0x5c5013(0xb6)]({'email':_0x4410ea['email']}),_0x274146=await master_shop[_0x5c5013(0x109)]();console[_0x5c5013(0x11f)](_0x5c5013(0x76),_0x274146);const _0x3ff4c8=_0x42dae6[_0x5c5013(0xf4)]['id'],_0x5c0611=await purchases[_0x5c5013(0x149)](_0x3ff4c8);console[_0x5c5013(0x11f)](_0x5c0611);const _0x32e161=await suppliers[_0x5c5013(0xb6)]({'name':_0x5c0611[_0x5c5013(0x12f)]});console['log'](_0x32e161);if(_0x274146[0x0][_0x5c5013(0x8f)]==_0x5c5013(0x183)){var _0x1a67d0=users[_0x5c5013(0x6f)];console['log'](_0x1a67d0);}else{if(_0x274146[0x0][_0x5c5013(0x8f)]==_0x5c5013(0x13c))var _0x1a67d0=users['Hindi'];else{if(_0x274146[0x0][_0x5c5013(0x8f)]==_0x5c5013(0xe2))var _0x1a67d0=users[_0x5c5013(0xe2)];else{if(_0x274146[0x0][_0x5c5013(0x8f)]==_0x5c5013(0x72))var _0x1a67d0=users['Spanish'];else{if(_0x274146[0x0][_0x5c5013(0x8f)]=='French')var _0x1a67d0=users['French'];else{if(_0x274146[0x0]['language']==_0x5c5013(0x14f))var _0x1a67d0=users[_0x5c5013(0xff)];else{if(_0x274146[0x0]['language']==_0x5c5013(0x93))var _0x1a67d0=users['Chinese'];else{if(_0x274146[0x0][_0x5c5013(0x8f)]=='Arabic\x20(ae)')var _0x1a67d0=users[_0x5c5013(0xb9)];}}}}}}}_0x19996a['render'](_0x5c5013(0xaf),{'success':_0x42dae6[_0x5c5013(0x100)](_0x5c5013(0x185)),'errors':_0x42dae6[_0x5c5013(0x100)](_0x5c5013(0xbe)),'role':_0x4410ea,'profile':_0x34b8c6,'master_shop':_0x274146,'supplier':_0x32e161,'purchase':_0x5c0611,'language':_0x1a67d0});}catch(_0x266dde){console[_0x5c5013(0x11f)](_0x266dde);}}),router[a0_0x2035e9(0x141)]('/view/return_purchase/:id',auth,async(_0x215e80,_0x41f29a)=>{var _0x5a5d62=a0_0x2035e9;try{const {username:_0x208daa,email:_0x3f26d3,role:_0x271dc7}=_0x215e80[_0x5a5d62(0xcf)],_0x4c52ac=_0x215e80[_0x5a5d62(0xcf)],_0x2b9407=await profile[_0x5a5d62(0xb6)]({'email':_0x4c52ac['email']}),_0x3a19ef=await master_shop[_0x5a5d62(0x109)]();console['log'](_0x5a5d62(0x76),_0x3a19ef);const _0x45203d=_0x215e80['params']['id'];console['log'](_0x45203d);const _0x15adb7=await purchases[_0x5a5d62(0x149)](_0x45203d);console[_0x5a5d62(0x11f)](_0x5a5d62(0x115),_0x15adb7);const _0xab3010=await product[_0x5a5d62(0x109)]({}),_0x540e4f=await warehouse[_0x5a5d62(0x86)]([{'$match':{'name':_0x15adb7[_0x5a5d62(0x121)],'room':_0x15adb7[_0x5a5d62(0x70)],'warehouse_category':_0x5a5d62(0x103)}},{'$unwind':_0x5a5d62(0x126)},{'$group':{'_id':_0x5a5d62(0xf6),'name':{'$first':_0x5a5d62(0x130)},'product_stock':{'$first':_0x5a5d62(0xd4)},'bay':{'$first':_0x5a5d62(0xa7)},'bin':{'$first':_0x5a5d62(0x105)},'type':{'$first':_0x5a5d62(0x134)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5a5d62(0x173)},'secondary_code':{'$first':_0x5a5d62(0x12a)},'product_code':{'$first':_0x5a5d62(0xa4)},'storage':{'$first':_0x5a5d62(0xa6)},'rack':{'$first':_0x5a5d62(0x124)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x5a5d62(0xaa),'name':'Return\x20Goods','warehouse_category':_0x5a5d62(0x103)}},{'$group':{'_id':_0x5a5d62(0x156),'name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x5a5d62(0x11f)]('stock_data',_0x540e4f);if(_0x3a19ef[0x0][_0x5a5d62(0x8f)]=='English\x20(US)'){var _0x5407dc=users[_0x5a5d62(0x6f)];console[_0x5a5d62(0x11f)](_0x5407dc);}else{if(_0x3a19ef[0x0][_0x5a5d62(0x8f)]=='Hindi')var _0x5407dc=users[_0x5a5d62(0x13c)];else{if(_0x3a19ef[0x0][_0x5a5d62(0x8f)]==_0x5a5d62(0xe2))var _0x5407dc=users[_0x5a5d62(0xe2)];else{if(_0x3a19ef[0x0][_0x5a5d62(0x8f)]==_0x5a5d62(0x72))var _0x5407dc=users['Spanish'];else{if(_0x3a19ef[0x0][_0x5a5d62(0x8f)]==_0x5a5d62(0xd7))var _0x5407dc=users[_0x5a5d62(0xd7)];else{if(_0x3a19ef[0x0]['language']==_0x5a5d62(0x14f))var _0x5407dc=users[_0x5a5d62(0xff)];else{if(_0x3a19ef[0x0]['language']==_0x5a5d62(0x93))var _0x5407dc=users[_0x5a5d62(0x93)];else{if(_0x3a19ef[0x0][_0x5a5d62(0x8f)]==_0x5a5d62(0x157))var _0x5407dc=users[_0x5a5d62(0xb9)];}}}}}}}_0x41f29a['render'](_0x5a5d62(0xf2),{'success':_0x215e80[_0x5a5d62(0x100)](_0x5a5d62(0x185)),'errors':_0x215e80[_0x5a5d62(0x100)](_0x5a5d62(0xbe)),'role':_0x4c52ac,'profile':_0x2b9407,'user':_0x15adb7,'stock':_0x540e4f,'master_shop':_0x3a19ef,'product':_0xab3010,'language':_0x5407dc,'warehouse':warehouse_data});}catch(_0x37b9c2){console[_0x5a5d62(0x11f)](_0x37b9c2);}}),router[a0_0x2035e9(0x73)](a0_0x2035e9(0x181),auth,async(_0x3b249b,_0x524f48)=>{var _0x15a20b=a0_0x2035e9;try{const {invoice:_0x48ca67,date:_0x24418c,warehouse_name:_0x254ae5,Room_name:_0x22f033,product_name:_0x3f6cc7,purchase_quantity:_0x15ef48,stocks:_0x58ae6e,return_qty:_0x3d0302,note:_0x53deff,level:_0x8de24e,isle:_0x158e9a,pallet:_0x3f1c29,to_warehouse_name:_0x15044f,to_Room_name:_0x4e7cc0}=_0x3b249b[_0x15a20b(0xbc)],_0x240dc2=await purchases[_0x15a20b(0xb6)]({'_id':_0x3b249b[_0x15a20b(0xf4)]['id']}),_0x431018=await warehouse['findOne']({'name':_0x254ae5,'room':_0x22f033});if(typeof _0x3f6cc7==_0x15a20b(0x10e))var _0x12b3b2=[_0x3b249b['body'][_0x15a20b(0x147)]],_0x58ac70=[_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x7c)]],_0x557993=[_0x3b249b['body']['stocks']],_0xc5d2ec=[_0x3b249b[_0x15a20b(0xbc)]['return_qty']],_0x318f5f=[_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x89)]],_0xc94604=[_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xce)]],_0x3439ca=[_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xe1)]],_0x1174c3=[_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x17e)]],_0x22b699=[_0x3b249b['body']['product_code_hide']],_0x1679ac=[_0x3b249b[_0x15a20b(0xbc)]['primary_code_hide']],_0x4deb8a=[_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xc4)]];else var _0x12b3b2=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x147)]],_0x58ac70=[..._0x3b249b[_0x15a20b(0xbc)]['purchase_quantity']],_0x557993=[..._0x3b249b['body'][_0x15a20b(0x117)]],_0xc5d2ec=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xc0)]],_0x318f5f=[..._0x3b249b['body'][_0x15a20b(0x89)]],_0xc94604=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xce)]],_0x3439ca=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xe1)]],_0x1174c3=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x17e)]],_0x22b699=[..._0x3b249b['body'][_0x15a20b(0x12e)]],_0x1679ac=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x13d)]],_0x4deb8a=[..._0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0xc4)]];const _0x58a134=_0x12b3b2[_0x15a20b(0x14c)](_0x5db932=>{return _0x5db932={'product_name':_0x5db932};});_0x58ac70[_0x15a20b(0x116)]((_0x3861b4,_0x36266f)=>{var _0xb44e1=_0x15a20b;_0x58a134[_0x36266f][_0xb44e1(0x7c)]=_0x3861b4;}),_0x557993['forEach']((_0x268481,_0x33184e)=>{var _0x248a55=_0x15a20b;_0x58a134[_0x33184e][_0x248a55(0x16f)]=_0x268481;}),_0xc5d2ec[_0x15a20b(0x116)]((_0x2e8f33,_0x47d6a7)=>{var _0x4aaa4d=_0x15a20b;_0x58a134[_0x47d6a7][_0x4aaa4d(0xc0)]=_0x2e8f33;}),_0x318f5f[_0x15a20b(0x116)]((_0x10a609,_0x4a8c0c)=>{var _0x341c97=_0x15a20b;_0x58a134[_0x4a8c0c][_0x341c97(0xbd)]=_0x10a609;}),_0xc94604[_0x15a20b(0x116)]((_0x55c1e0,_0x1053e0)=>{_0x58a134[_0x1053e0]['bin']=_0x55c1e0;}),_0x3439ca[_0x15a20b(0x116)]((_0x5a6e9d,_0x2acc8a)=>{var _0x31bc19=_0x15a20b;_0x58a134[_0x2acc8a][_0x31bc19(0x174)]=_0x5a6e9d;}),_0x1174c3[_0x15a20b(0x116)]((_0x2fc670,_0xe88903)=>{var _0x237d5e=_0x15a20b;_0x58a134[_0xe88903][_0x237d5e(0x175)]=_0x2fc670;}),_0x22b699[_0x15a20b(0x116)]((_0x148290,_0x4c84a9)=>{var _0x26ef7e=_0x15a20b;_0x58a134[_0x4c84a9][_0x26ef7e(0x168)]=_0x148290;}),_0x1679ac[_0x15a20b(0x116)]((_0x2800d0,_0x2a8176)=>{_0x58a134[_0x2a8176]['primary_code']=_0x2800d0;}),_0x4deb8a['forEach']((_0x3e7255,_0x55a3dc)=>{var _0x494010=_0x15a20b;_0x58a134[_0x55a3dc][_0x494010(0xc7)]=_0x3e7255;}),_0x240dc2[_0x15a20b(0x165)][_0x15a20b(0x116)](_0x5e4b27=>{var _0x560dd3=_0x15a20b;const _0x523ad4=_0x431018[_0x560dd3(0xb0)]['map'](_0x158296=>{var _0x48aa=_0x560dd3;_0x158296[_0x48aa(0x147)]==_0x5e4b27[_0x48aa(0x147)]&&_0x158296[_0x48aa(0x174)]==_0x5e4b27[_0x48aa(0x174)]&&_0x158296[_0x48aa(0x175)]==_0x5e4b27[_0x48aa(0x175)]&&_0x158296['bin']==_0x5e4b27[_0x48aa(0xdd)]&&_0x158296[_0x48aa(0xbd)]==_0x5e4b27[_0x48aa(0xbd)]&&_0x158296[_0x48aa(0x159)]==_0x5e4b27['rack']&&_0x158296[_0x48aa(0x88)]==_0x5e4b27['storage']&&(console[_0x48aa(0x11f)](parseInt(_0x158296[_0x48aa(0x10b)])+'\x20<>\x20'+parseInt(_0x5e4b27[_0x48aa(0x166)])),_0x158296[_0x48aa(0x10b)]=parseInt(_0x158296[_0x48aa(0x10b)])+parseInt(_0x5e4b27[_0x48aa(0x166)]));});}),await _0x431018[_0x15a20b(0x9b)]();const _0x3d62f3=_0x58a134[_0x15a20b(0x118)](_0x12a2b6=>_0x12a2b6[_0x15a20b(0xc0)]!=='0'&&_0x12a2b6[_0x15a20b(0xc0)]!=='');var _0x55864f=0x0;_0x3d62f3[_0x15a20b(0x116)](_0x13a8fa=>{var _0x5ca364=_0x15a20b;console['log'](_0x5ca364(0xf7),_0x13a8fa),(parseInt(_0x13a8fa[_0x5ca364(0x7c)])<parseInt(_0x13a8fa[_0x5ca364(0xc0)])||parseInt(_0x13a8fa[_0x5ca364(0x16f)])<parseInt(_0x13a8fa['return_qty']))&&_0x55864f++;});if(_0x55864f!=0x0)return _0x3b249b[_0x15a20b(0x100)](_0x15a20b(0xbe),_0x15a20b(0x81)),_0x524f48['redirect'](_0x15a20b(0xb8));const _0x6ad936=new purchases_return({'invoice':_0x48ca67,'suppliers':_0x3b249b['body'][_0x15a20b(0x12f)],'date':_0x24418c,'warehouse_name':_0x254ae5,'return_product':_0x3d62f3,'note':_0x53deff,'room':_0x22f033,'to_warehouse_name':_0x15044f,'to_room':_0x4e7cc0}),_0x243a84=await _0x6ad936[_0x15a20b(0x9b)]();console[_0x15a20b(0x11f)](_0x6ad936);const _0x45fd0d=await purchases_return[_0x15a20b(0xb6)]({'invoice':_0x48ca67}),_0x44d6ef=await warehouse['findOne']({'name':_0x15044f,'room':_0x4e7cc0});_0x45fd0d[_0x15a20b(0xf1)]['forEach'](_0x158ca6=>{var _0x540e26=_0x15a20b,_0x3b359a=0x0;const _0x42c31f=_0x44d6ef[_0x540e26(0xb0)][_0x540e26(0x14c)](_0x5401b6=>{var _0xbb84ad=_0x540e26;_0x5401b6[_0xbb84ad(0x147)]==_0x158ca6['product_name']&&_0x5401b6[_0xbb84ad(0x174)]==_0x158ca6[_0xbb84ad(0x174)]&&_0x5401b6['type']==_0x158ca6[_0xbb84ad(0x175)]&&_0x5401b6[_0xbb84ad(0xdd)]==_0x158ca6['bin']&&_0x5401b6[_0xbb84ad(0xbd)]==_0x158ca6[_0xbb84ad(0xbd)]&&(_0x5401b6[_0xbb84ad(0x10b)]=parseInt(_0x5401b6['product_stock'])-parseInt(_0x158ca6['return_qty']),_0x3b359a++);});_0x3b359a=='0'&&(_0x44d6ef['product_details']=_0x44d6ef[_0x540e26(0xb0)]['concat']({'product_name':_0x158ca6['product_name'],'product_stock':_0x158ca6['return_qty'],'primary_code':_0x158ca6[_0x540e26(0x13a)],'secondary_code':_0x158ca6[_0x540e26(0xc7)],'product_code':_0x158ca6['product_code'],'storage':_0x158ca6[_0x540e26(0x88)],'rack':_0x158ca6[_0x540e26(0x159)],'bay':_0x158ca6[_0x540e26(0xbd)],'bin':_0x158ca6[_0x540e26(0xdd)],'type':_0x158ca6['type'],'floorlevel':_0x158ca6[_0x540e26(0x174)],'maxProducts':_0x158ca6[_0x540e26(0x171)],'unit':_0x158ca6[_0x540e26(0x135)],'secondary_unit':_0x158ca6[_0x540e26(0x179)],'expiry_date':_0x158ca6[_0x540e26(0xd9)]}));}),await _0x44d6ef[_0x15a20b(0x9b)]();const _0x3337ce=await purchases[_0x15a20b(0xb6)]({'invoice':_0x48ca67});_0x3337ce[_0x15a20b(0x155)]='True';const _0x13cfea=await _0x3337ce[_0x15a20b(0x9b)](),_0x307d36=new s_payment_data({'invoice':_0x48ca67,'suppliers':_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x12f)],'reason':_0x15a20b(0xba)});await _0x307d36[_0x15a20b(0x9b)]();const _0x1e068e=await master_shop[_0x15a20b(0x109)]();console['log'](_0x15a20b(0x17f),_0x1e068e[0x0][_0x15a20b(0x15a)]);const _0x228a0c=await email_settings[_0x15a20b(0xb6)](),_0xebb9ca=await suppliers[_0x15a20b(0xb6)]({'name':_0x3b249b[_0x15a20b(0xbc)][_0x15a20b(0x12f)]});console[_0x15a20b(0x11f)](_0x15a20b(0x11c),_0xebb9ca);_0x1e068e[0x0][_0x15a20b(0x180)]==0x1?(right_currency=_0x1e068e[0x0][_0x15a20b(0x106)],left_currency=''):(right_currency='',left_currency=_0x1e068e[0x0][_0x15a20b(0x106)]);var _0x225977=_0x12b3b2,_0x15c20c=_0xc5d2ec,_0xbf263c='',_0x1b21e3;for(_0x1b21e3 in _0x225977){_0xbf263c+=_0x15a20b(0x143)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x225977[_0x1b21e3]+_0x15a20b(0x113)+_0x15a20b(0x15e)+_0x15c20c[_0x1b21e3]+_0x15a20b(0x113)+_0x15a20b(0xb4);}console[_0x15a20b(0x11f)](_0x15a20b(0x101),_0xbf263c);let _0x1a3af6=nodemailer[_0x15a20b(0x120)]({'service':_0x15a20b(0x96),'auth':{'user':_0x228a0c[_0x15a20b(0xde)],'pass':_0x228a0c[_0x15a20b(0x17a)]}}),_0x7a2641={'from':_0x228a0c[_0x15a20b(0xde)],'to':_0xebb9ca[_0x15a20b(0xde)],'subject':_0x15a20b(0xd2),'attachments':[{'filename':_0x15a20b(0x184),'path':__dirname+'/../public'+_0x15a20b(0x104)+_0x1e068e[0x0][_0x15a20b(0x15a)],'cid':_0x15a20b(0x145)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x15a20b(0x8d)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x15a20b(0xef)+_0x15a20b(0x13f)+_0x15a20b(0x10c)+_0x15a20b(0xef)+'<h2>\x20'+_0x1e068e[0x0]['site_title']+_0x15a20b(0xc8)+_0x15a20b(0x10c)+'</div>'+_0x15a20b(0x138)+_0x15a20b(0xef)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x15a20b(0x123)+_0x48ca67+'\x20'+_0x15a20b(0x79)+_0x15a20b(0x170)+_0x24418c+'\x20'+_0x15a20b(0x15b)+_0x15a20b(0x14e)+_0x15a20b(0x10c)+_0x15a20b(0x17d)+_0x15a20b(0xf0)+_0x15a20b(0x143)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x15a20b(0x139)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x15a20b(0xb4)+_0x15a20b(0xc5)+_0x15a20b(0xac)+'\x20'+_0xbf263c+'\x20'+_0x15a20b(0x163)+'</table>'+'<div>'+_0x15a20b(0xa0)+'<h5>'+_0x1e068e[0x0][_0x15a20b(0x8c)]+'</h5>'+_0x15a20b(0x10c)+'</div>'+_0x15a20b(0x177)};_0x1a3af6['sendMail'](_0x7a2641,function(_0x1caef5,_0x313109){var _0x32ce0b=_0x15a20b;_0x1caef5?(console[_0x32ce0b(0x11f)](_0x1caef5),console[_0x32ce0b(0x11f)](_0x32ce0b(0xa2))):console[_0x32ce0b(0x11f)](_0x32ce0b(0x146));}),_0x3b249b[_0x15a20b(0x100)]('success',_0x15a20b(0x75)),_0x524f48['redirect']('/all_purchases/view');}catch(_0x4a968e){console[_0x15a20b(0x11f)](_0x4a968e),_0x524f48[_0x15a20b(0x153)](0xc8)['json']({'message':_0x4a968e['message']});}}),router[a0_0x2035e9(0x141)](a0_0x2035e9(0xec),auth,async(_0x33b780,_0x3782c3)=>{var _0x841d15=a0_0x2035e9;try{const {username:_0x814978,email:_0x16ca17,role:_0x3a90bc}=_0x33b780[_0x841d15(0xcf)],_0x29275a=_0x33b780['user'],_0x430c9d=await profile[_0x841d15(0xb6)]({'email':_0x29275a['email']}),_0x385ad6=await master_shop['find'](),_0x32478d=_0x33b780[_0x841d15(0xf4)]['id'],_0x4b5e84=await purchases[_0x841d15(0x149)](_0x32478d);if(_0x385ad6[0x0][_0x841d15(0x8f)]==_0x841d15(0x183))var _0x156a46=users[_0x841d15(0x6f)];else{if(_0x385ad6[0x0][_0x841d15(0x8f)]==_0x841d15(0x13c))var _0x156a46=users[_0x841d15(0x13c)];else{if(_0x385ad6[0x0][_0x841d15(0x8f)]=='German')var _0x156a46=users['German'];else{if(_0x385ad6[0x0]['language']=='Spanish')var _0x156a46=users[_0x841d15(0x72)];else{if(_0x385ad6[0x0]['language']==_0x841d15(0xd7))var _0x156a46=users[_0x841d15(0xd7)];else{if(_0x385ad6[0x0][_0x841d15(0x8f)]=='Portuguese\x20(BR)')var _0x156a46=users['Portuguese'];else{if(_0x385ad6[0x0][_0x841d15(0x8f)]==_0x841d15(0x93))var _0x156a46=users['Chinese'];else{if(_0x385ad6[0x0][_0x841d15(0x8f)]==_0x841d15(0x157))var _0x156a46=users['Arabic'];}}}}}}}_0x3782c3[_0x841d15(0xda)](_0x841d15(0xf3),{'success':_0x33b780[_0x841d15(0x100)](_0x841d15(0x185)),'errors':_0x33b780[_0x841d15(0x100)](_0x841d15(0xbe)),'role':_0x29275a,'profile':_0x430c9d,'alldata':_0x4b5e84,'master_shop':_0x385ad6,'language':_0x156a46}),console[_0x841d15(0x11f)](alldata);}catch(_0x2f3cd1){console['log'](_0x2f3cd1);}}),router['post'](a0_0x2035e9(0xc1),async(_0xc0d931,_0x141050)=>{var _0x11b42e=a0_0x2035e9;const {product_code:_0x440901}=_0xc0d931['body'];var _0x24f1b3;const _0x43c315=await product[_0x11b42e(0x86)]([{'$match':{'primary_code':_0x440901,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x11b42e(0x150),'name':{'$first':_0x11b42e(0x156)},'category':{'$first':_0x11b42e(0x8a)},'brand':{'$first':_0x11b42e(0x132)},'unit':{'$first':_0x11b42e(0x7a)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x11b42e(0x127)},'secondary_code':{'$first':_0x11b42e(0xc9)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x11b42e(0x6d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xce95b3=await product[_0x11b42e(0x86)]([{'$match':{'secondary_code':_0x440901,'product_category':_0x11b42e(0x103)}},{'$group':{'_id':_0x11b42e(0x150),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x11b42e(0x132)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x11b42e(0x128)},'product_code':{'$first':_0x11b42e(0x15c)},'primary_code':{'$first':_0x11b42e(0x127)},'secondary_code':{'$first':_0x11b42e(0xc9)},'maxStocks':{'$first':_0x11b42e(0xd1)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x11b42e(0x6d)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x43c315[_0x11b42e(0xc3)]>0x0)_0x24f1b3=_0x43c315;else _0xce95b3[_0x11b42e(0xc3)]>0x0&&(_0x24f1b3=_0xce95b3);_0x141050[_0x11b42e(0x13e)](_0x24f1b3);}),router[a0_0x2035e9(0x73)](a0_0x2035e9(0x125),async(_0x3b3af5,_0x50ff57)=>{var _0x17c434=a0_0x2035e9;const {primaryCode:_0x343363,secondaryCode:_0x3ea39b,productCode:_0x116ced,bay:_0x228cf8,bin:_0x22213e,types:_0x19ecab,pallet:_0x40e100,warehouses:_0xe1fa41,room:_0x260825}=_0x3b3af5[_0x17c434(0xbc)];console[_0x17c434(0x11f)](_0x3b3af5[_0x17c434(0xbc)]);try{const _0x2f101b=await warehouse[_0x17c434(0x86)]([{'$match':{'name':_0xe1fa41,'room':_0x260825}},{'$unwind':_0x17c434(0x126)},{'$match':{'product_details.bay':_0x228cf8,'product_details.bin':_0x22213e,'product_details.type':_0x19ecab}},{'$group':{'_id':_0x17c434(0xf6),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x17c434(0xd4)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x17c434(0x133)},'pallet':{'$first':_0x17c434(0x9e)},'maxProducts':{'$first':_0x17c434(0x14d)}}}]);_0x50ff57[_0x17c434(0x153)](0xc8)[_0x17c434(0x13e)](_0x2f101b);}catch(_0x351c2f){_0x50ff57['status'](0x194)[_0x17c434(0x13e)]({'message':_0x351c2f['message']});}}),module[a0_0x2035e9(0xfb)]=router;