var a0_0x22c0d4=a0_0x5b8d;(function(_0x1ecb0f,_0x18739e){var _0x4322a0=a0_0x5b8d,_0xb6c0d9=_0x1ecb0f();while(!![]){try{var _0x2f7ca6=-parseInt(_0x4322a0(0x1c0))/0x1*(parseInt(_0x4322a0(0x21b))/0x2)+-parseInt(_0x4322a0(0x1a7))/0x3+-parseInt(_0x4322a0(0x24a))/0x4+parseInt(_0x4322a0(0x1d1))/0x5*(parseInt(_0x4322a0(0x1e5))/0x6)+-parseInt(_0x4322a0(0x169))/0x7*(-parseInt(_0x4322a0(0x16e))/0x8)+parseInt(_0x4322a0(0x1df))/0x9+parseInt(_0x4322a0(0x22b))/0xa;if(_0x2f7ca6===_0x18739e)break;else _0xb6c0d9['push'](_0xb6c0d9['shift']());}catch(_0x173bf6){_0xb6c0d9['push'](_0xb6c0d9['shift']());}}}(a0_0x15b9,0x8bd37));const express=require(a0_0x22c0d4(0x259)),app=express(),router=express[a0_0x22c0d4(0x1b9)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x22c0d4(0x1a4)),auth=require(a0_0x22c0d4(0x190)),nodemailer=require(a0_0x22c0d4(0x20d));var ejs=require(a0_0x22c0d4(0x247));function a0_0x15b9(){var _0x4cbbe5=['Arabic','rack','Purchase\x20Return\x20Mail','stock_quantity','1556019tJOEcQ','$product_details.product_stock','floor','abs','Chinese','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','114bbRvmr','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/add_purchases/:id','/preview/:id','$maxProdPerUnit','language','prod_pallet','isle','JO_number','<tr>','product_code_hide','name','Rack\x20C','$date','return_purchase','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','status','\x20Order\x20Number\x20:\x20','secondary_code','prod_secondunit','catch','product_list','standard_unit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','INC-','Rack\x20D','$product_details.expiry_date','user_id','site_title','secondary_unit','delivery_date','role','RoomAssign','find','findOne','success','purchase_quantity','DRY\x20STORAGE','add\x20post','error','nodemailer','message','amount','Hindi','currency_placement','/view/return_purchase/:id','Ambient','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','toString','$maxStocks','getMonth','$product_details.pallet','secondary_code_hide','Purchase\x20Mail','64286WMpNAx','add_purchases','/barcode_scanner','return_qty','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.secondary_code','An\x20error\x20occurred.','prod_name','all_purchases_barcode','slice','</tbody>','suppliers','prod_invoice','Arabic\x20(ae)','getFullYear','3317510wIGpqb','</head><body>','\x20</h2>','post','Floor','delivery_code','product_stock','type','\x20<>\x20','/give_payment/:id','warehouse','suppliers_data','Sales\x20Update\x20successfully','product','Email\x20sent\x20successfully','$product_details._id','logo','forEach','room_name','all','prod_qty','$secondary_unit','/invoice/:id','floorlevel','get','log','$warehouse_name','params','ejs','master','quantity','2956556LDVJUy','English\x20(US)','getDate','primary_code','padStart','$invoice','COLD\x20STORAGE','add_purchases\x20error','redirect','</body></html>','actual_qty','filter','errors','</span>','Level','express','<h5>','user','$paid_amount','/upload/','<!DOCTYPE\x20html>','gmail','finalize','production_date','primary_code_hide','Enabled','bin','prod_isle','pallet','$finalize','here','sendMail','actual_uom','prod_unit','/barcode/:id','product_details','/../public','return_data','$product_details.primary_code','Room_name','port','$product_details.isle','body','</div>','$product.type','render','$suppliers_docs','$return_data','$product.room_name','$batch_code','purchase\x20data\x20update\x20successfully','foreach\x20newproduct','product_code','$product_details.level','prod_code','push','level','English','</thead>','<hr\x20class=\x22my-3\x22>','Paid\x20For\x20Purchase','payment\x20successfull','json','../public/language/languages.json','expiry_date','Purchase\x20Return','return_product','createTransport','5451481WWOxnk','maxStocks','</tr>','prod_primunit','<h5\x20style=\x22text-align:\x20left;\x22>','8AutjlS','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Portuguese\x20(BR)','maxperunit','/CheckingWarehouse','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product','concat','$primary_code','warehouse_name','$product_details.bay','$product_details.type','path','$suppliers','alertQTY','edit_purchases_view','invoice','/view/add_purchases','$brand','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$category','<h2>\x20','Spanish','$_id','string','$product_details.product_name','$expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','random','Rack\x20B','Rack\x20E','$product.floorlevel','types','../middleware/auth','/view/:id','<tbody\x20style=\x22text-align:\x20center;\x22>','all_purchases','purchase_invoice','storage','room','$product_details','$product_details.bin','$product.quantity','$product_code','Error\x20Occurs','<html><head><title></title>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','staff','then','$product.bay','Logo.png','German','</h5>','../models/all_models','image','$product_details.storage','828834VZwWSG','<table\x20style=\x22width:\x20100%\x20!important;\x22>','purchases\x20item\x20return\x20successfull','/all_purchases/view','$unit','French','$product_details.rack','\x20Order\x20Date\x20:\x20','prod_level','date','$product_details.product_code','stock_data','rak','$product.bin','</td>','Receiving\x20Area','suppliers_docs','password','Router','Enclosed','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','map','Purchase\x20data\x20added\x20successfully','aggregate','26PcXqmt','Raw\x20Materials','Rack\x20A','batch_code','email','findById','MaxStocks_data','prod_Qty','paid_amount','due_amount','exports','$due_amount','max_product_unit','bay','/all_purchases/view/','Portuguese','$name','300115KrlIpS','edit_purchases','$note','product_name','length','Shelves','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','save','$alertquantity','deliverycode'];a0_0x15b9=function(){return _0x4cbbe5;};return a0_0x15b9();}const path=require(a0_0x22c0d4(0x17b)),users=require(a0_0x22c0d4(0x164));router[a0_0x22c0d4(0x243)]('/view',auth,async(_0x3c5a4a,_0x1c4eb0)=>{var _0xe10aa4=a0_0x22c0d4;try{const {username:_0x2c1a4a,email:_0x2ae3d1,role:_0x55ad16}=_0x3c5a4a[_0xe10aa4(0x25b)],_0x1cb505=_0x3c5a4a[_0xe10aa4(0x25b)],_0x35e062=await profile[_0xe10aa4(0x207)]({'email':_0x1cb505[_0xe10aa4(0x1c4)]}),_0x26cc1b=await staff[_0xe10aa4(0x207)]({'email':_0x1cb505['email']});if(_0x1cb505[_0xe10aa4(0x204)]==_0xe10aa4(0x19e)){const _0x107a5d=await staff[_0xe10aa4(0x207)]({'email':_0x1cb505[_0xe10aa4(0x1c4)]});}const _0x19ad64=await master_shop[_0xe10aa4(0x206)]();let _0x491110;if(_0x1cb505[_0xe10aa4(0x204)]==_0xe10aa4(0x19e)){const _0x10c9a9=await staff[_0xe10aa4(0x207)]({'email':_0x1cb505[_0xe10aa4(0x1c4)]});_0x491110=await purchases['aggregate']([{'$match':{'warehouse_name':_0x10c9a9['warehouse']}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0xe10aa4(0x1f0),'as':'suppliers_docs'}},{'$unwind':_0xe10aa4(0x278)},{'$unwind':_0xe10aa4(0x175)},{'$group':{'_id':'$_id','invoice':{'$first':_0xe10aa4(0x24f)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0xe10aa4(0x1f2)},'warehouse_name':{'$first':_0xe10aa4(0x245)},'room':{'$first':'$room'},'product':{'$push':'$product'},'note':{'$first':_0xe10aa4(0x1d3)},'paid_amount':{'$first':_0xe10aa4(0x25c)},'due_amount':{'$first':_0xe10aa4(0x1cb)},'return_data':{'$first':_0xe10aa4(0x279)},'batch_code':{'$first':_0xe10aa4(0x27b)},'expiry_date':{'$first':_0xe10aa4(0x189)},'suppliers_docs':{'$first':_0xe10aa4(0x278)},'total_product_quantity':{'$sum':_0xe10aa4(0x199)},'level':{'$addToSet':_0xe10aa4(0x1a0)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0xe10aa4(0x276)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x491110=await purchases[_0xe10aa4(0x1bf)]([{'$lookup':{'from':_0xe10aa4(0x227),'localField':'suppliers','foreignField':_0xe10aa4(0x1f0),'as':_0xe10aa4(0x1b7)}},{'$unwind':_0xe10aa4(0x278)},{'$unwind':'$product'},{'$group':{'_id':_0xe10aa4(0x186),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0xe10aa4(0x17c)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0xe10aa4(0x27a)},'product':{'$push':_0xe10aa4(0x175)},'note':{'$first':_0xe10aa4(0x1d3)},'paid_amount':{'$first':_0xe10aa4(0x25c)},'due_amount':{'$first':_0xe10aa4(0x1cb)},'return_data':{'$first':_0xe10aa4(0x279)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xe10aa4(0x199)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0xe10aa4(0x1b4)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0xe10aa4(0x18e)},'finalize':{'$first':_0xe10aa4(0x267)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x19ad64[0x0][_0xe10aa4(0x1ea)]==_0xe10aa4(0x24b)){var _0x2edca0=users['English'];console[_0xe10aa4(0x244)](_0x2edca0);}else{if(_0x19ad64[0x0][_0xe10aa4(0x1ea)]==_0xe10aa4(0x210))var _0x2edca0=users['Hindi'];else{if(_0x19ad64[0x0]['language']==_0xe10aa4(0x1a2))var _0x2edca0=users[_0xe10aa4(0x1a2)];else{if(_0x19ad64[0x0][_0xe10aa4(0x1ea)]==_0xe10aa4(0x185))var _0x2edca0=users[_0xe10aa4(0x185)];else{if(_0x19ad64[0x0][_0xe10aa4(0x1ea)]==_0xe10aa4(0x1ac))var _0x2edca0=users['French'];else{if(_0x19ad64[0x0][_0xe10aa4(0x1ea)]=='Portuguese\x20(BR)')var _0x2edca0=users['Portuguese'];else{if(_0x19ad64[0x0]['language']==_0xe10aa4(0x1e3))var _0x2edca0=users[_0xe10aa4(0x1e3)];else{if(_0x19ad64[0x0]['language']==_0xe10aa4(0x229))var _0x2edca0=users[_0xe10aa4(0x1db)];}}}}}}}_0x1c4eb0['render'](_0xe10aa4(0x193),{'success':_0x3c5a4a[_0xe10aa4(0x1bb)]('success'),'errors':_0x3c5a4a[_0xe10aa4(0x1bb)]('errors'),'purchases':_0x491110,'role':_0x1cb505,'profile':_0x35e062,'master_shop':_0x19ad64,'language':_0x2edca0});}catch(_0x55a00e){console[_0xe10aa4(0x244)]('table\x20page',_0x55a00e),_0x1c4eb0[_0xe10aa4(0x1f5)](0xc8)[_0xe10aa4(0x163)]({'message':_0x55a00e[_0xe10aa4(0x20e)]});}});function BayBinSelected(_0x122da1,_0x3199c7){var _0x3658a5=a0_0x22c0d4,_0x237519=[],_0x9e2653=[],_0x58d054=[],_0x275e81=[],_0x1b6404=[],_0x1dfc4d=[];let _0x146759=[];if(_0x122da1==_0x3658a5(0x20a))switch(_0x3199c7){case _0x3658a5(0x1c2):_0x237519=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x9e2653=[0x1,0x2],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=[_0x3658a5(0x258),_0x3658a5(0x22f)],_0x1b6404=['D'],_0x1dfc4d=['A'];break;case _0x3658a5(0x18c):_0x237519=[0x6,0x5,0x4,0x3,0x2,0x1],_0x9e2653=[0x1,0x2],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=['Level',_0x3658a5(0x22f)],_0x1b6404=['D'],_0x1dfc4d=['B'];break;case _0x3658a5(0x1d6):_0x237519=[0x0],_0x9e2653=[0x0],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=['Floor'],_0x1b6404=['D'],_0x1dfc4d=['S'];break;case _0x3658a5(0x1b6):_0x237519=[0x0],_0x9e2653=[0x0],_0x275e81=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x58d054=[_0x3658a5(0x22f)],_0x1b6404=['D'],_0x1dfc4d=['R'];break;}else{if(_0x122da1==_0x3658a5(0x250))switch(_0x3199c7){case _0x3658a5(0x1c2):_0x237519=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x9e2653=['B','F'],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=[_0x3658a5(0x258),_0x3658a5(0x22f)],_0x1b6404=['C'],_0x1dfc4d=['A'];break;case _0x3658a5(0x18c):_0x237519=[0x5,0x4,0x3,0x2,0x1],_0x9e2653=['F','B','S'],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=['Level',_0x3658a5(0x22f)],_0x1b6404=['C'],_0x1dfc4d=['B'];break;case _0x3658a5(0x1f1):_0x237519=[0x1,0x2,0x3,0x4,0x5],_0x9e2653=['B','F','S'],_0x275e81=[0x5,0x4,0x3,0x2,0x1],_0x58d054=[_0x3658a5(0x258),'Floor'],_0x1b6404=['C'],_0x1dfc4d=['C'];break;case _0x3658a5(0x1fe):_0x237519=[0x5,0x4,0x3,0x2,0x1],_0x9e2653=['F','B','S'],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=[_0x3658a5(0x258),'Floor'],_0x1b6404=['C'],_0x1dfc4d=['D'];break;case _0x3658a5(0x18d):_0x237519=[0x4,0x3,0x2,0x1],_0x9e2653=[0x1,0x2],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=['Level',_0x3658a5(0x22f)],_0x1b6404=['C'],_0x1dfc4d=['E'];break;case'Rack\x20F':_0x237519=[0x1,0x2,0x3],_0x9e2653=[0x1,0x2],_0x275e81=[0x1,0x2,0x3,0x4,0x5],_0x58d054=[_0x3658a5(0x258)],_0x1b6404=['C'],_0x1dfc4d=['F'];break;}}return{'levels':_0x237519,'Isle':_0x9e2653,'rack':_0x275e81,'type':_0x58d054,'storage':_0x1b6404,'rak':_0x1dfc4d};}async function getRandom8DigitNumber(){var _0x1c04de=a0_0x22c0d4;const _0x5942f1=0x989680,_0x39befd=0x5f5e0ff,_0x436975=Math[_0x1c04de(0x1e1)](Math[_0x1c04de(0x18b)]()*(_0x39befd-_0x5942f1+0x1))+_0x5942f1;var _0x225ad8;const _0x1eb92a=await purchases[_0x1c04de(0x207)]({'invoice':_0x1c04de(0x1fd)+_0x436975});return _0x1eb92a&&_0x1eb92a[_0x1c04de(0x1d5)]>0x0?_0x225ad8=_0x1c04de(0x1fd)+_0x436975:_0x225ad8=_0x1c04de(0x1fd)+_0x436975,_0x225ad8;}function a0_0x5b8d(_0x53693b,_0x25f5dc){var _0x15b955=a0_0x15b9();return a0_0x5b8d=function(_0x5b8d51,_0x353b6b){_0x5b8d51=_0x5b8d51-0x158;var _0xbf293c=_0x15b955[_0x5b8d51];return _0xbf293c;},a0_0x5b8d(_0x53693b,_0x25f5dc);}router[a0_0x22c0d4(0x243)](a0_0x22c0d4(0x180),auth,async(_0x5b0f2f,_0x202a4e)=>{var _0xb40d94=a0_0x22c0d4;try{const {username:_0x178be1,email:_0x33c616,role:_0x3307e3}=_0x5b0f2f[_0xb40d94(0x25b)],_0x5de834=_0x5b0f2f[_0xb40d94(0x25b)],_0x228b90=await profile[_0xb40d94(0x207)]({'email':_0x5de834['email']}),_0x24587f=await master_shop[_0xb40d94(0x206)](),_0x50772a=await staff[_0xb40d94(0x207)]({'email':_0x5de834[_0xb40d94(0x1c4)]}),_0x1bdc0d=await suppliers[_0xb40d94(0x206)]({});let _0x5d094a;if(_0x5de834[_0xb40d94(0x204)]==_0xb40d94(0x19e)){const _0xb20cf3=await staff['findOne']({'email':_0x5de834[_0xb40d94(0x1c4)]});_0x5d094a=await warehouse[_0xb40d94(0x1bf)]([{'$match':{'status':_0xb40d94(0x263),'name':_0xb20cf3['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xb40d94(0x21f)}}},{'$group':{'_id':_0xb40d94(0x1d0),'name':{'$first':_0xb40d94(0x1d0)}}}]);}else _0x5d094a=await warehouse[_0xb40d94(0x1bf)]([{'$match':{'status':_0xb40d94(0x263),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xb40d94(0x21f)}}},{'$group':{'_id':_0xb40d94(0x1d0),'name':{'$first':_0xb40d94(0x1d0)}}}]);const _0x2b895a=await product[_0xb40d94(0x206)]({}),_0x32ddf3=await warehouse[_0xb40d94(0x206)]({'status':'Enabled'}),_0x1f2476=await purchases['find']({}),_0x3061fd=_0x1f2476[_0xb40d94(0x1d5)]+0x1,_0x4be88f='INC-'+_0x3061fd[_0xb40d94(0x215)]()[_0xb40d94(0x24e)](0x5,'0');var _0x5cb722=[_0xb40d94(0x213),_0xb40d94(0x1ba)];if(_0x24587f[0x0][_0xb40d94(0x1ea)]==_0xb40d94(0x24b))var _0x3cd9f5=users[_0xb40d94(0x15e)];else{if(_0x24587f[0x0][_0xb40d94(0x1ea)]==_0xb40d94(0x210))var _0x3cd9f5=users[_0xb40d94(0x210)];else{if(_0x24587f[0x0][_0xb40d94(0x1ea)]==_0xb40d94(0x1a2))var _0x3cd9f5=users[_0xb40d94(0x1a2)];else{if(_0x24587f[0x0]['language']=='Spanish')var _0x3cd9f5=users[_0xb40d94(0x185)];else{if(_0x24587f[0x0]['language']=='French')var _0x3cd9f5=users['French'];else{if(_0x24587f[0x0]['language']==_0xb40d94(0x170))var _0x3cd9f5=users[_0xb40d94(0x1cf)];else{if(_0x24587f[0x0][_0xb40d94(0x1ea)]==_0xb40d94(0x1e3))var _0x3cd9f5=users[_0xb40d94(0x1e3)];else{if(_0x24587f[0x0][_0xb40d94(0x1ea)]==_0xb40d94(0x229))var _0x3cd9f5=users[_0xb40d94(0x1db)];}}}}}}}const _0x567258=getRandom8DigitNumber();_0x567258[_0xb40d94(0x19f)](_0x38f5b1=>{var _0x4a5679=_0xb40d94;_0x202a4e['render'](_0x4a5679(0x21c),{'success':_0x5b0f2f['flash'](_0x4a5679(0x208)),'errors':_0x5b0f2f[_0x4a5679(0x1bb)]('errors'),'role':_0x5de834,'profile':_0x228b90,'suppliers':_0x1bdc0d,'warehouse':_0x5d094a,'product':_0x2b895a,'invoice':_0x38f5b1,'master_shop':_0x24587f,'language':_0x3cd9f5,'find_data':_0x32ddf3,'rooms_data':_0x5cb722});})[_0xb40d94(0x1f9)](_0x39644d=>{var _0x107c6e=_0xb40d94;_0x5b0f2f[_0x107c6e(0x1bb)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x202a4e['redirect'](_0x107c6e(0x1aa));});}catch(_0x53e62b){console[_0xb40d94(0x244)](_0x53e62b);}}),router['get'](a0_0x22c0d4(0x1e7),auth,async(_0xf67d2e,_0x4e116e)=>{var _0x20d881=a0_0x22c0d4;try{const _0x48c201=_0xf67d2e[_0x20d881(0x246)]['id'];console[_0x20d881(0x244)](_0x48c201);const _0x29dd29=await master_shop['find']();console[_0x20d881(0x244)]('master',_0x29dd29);const _0x64380c=await product[_0x20d881(0x207)]({'name':_0x48c201});console[_0x20d881(0x244)](_0x20d881(0x238),_0x64380c),_0x4e116e[_0x20d881(0x1f5)](0xc8)[_0x20d881(0x163)]({'product_data':_0x64380c,'master':_0x29dd29});}catch(_0x22fcb8){console[_0x20d881(0x244)](_0x20d881(0x251),_0x22fcb8);}}),router[a0_0x22c0d4(0x22e)](a0_0x22c0d4(0x180),auth,async(_0x346ed2,_0x45fa0f)=>{var _0x5732cd=a0_0x22c0d4;try{const {invoice:_0x1f4b1a,date:_0x4816e6,warehouse_name:_0x378df4,prod_name:_0x44dc34,prod_code:_0x2e3b3e,prod_qty:_0x16da0f,prod_unit:_0x552f58,prod_secondunit:_0x33f9ce,prod_level:_0xc6ae5c,prod_isle:_0xd3da84,prod_pallet:_0x4825f6,note:_0x57eea6,expiry_date:_0x57a22b,batch_code:_0x5db1a3,payable:_0x13ef7a,due_amount:_0xfd7389,Room_name:_0x3c8913,primary_code:_0x10c443,secondary_code:_0x29640c,MaxStocks_data:_0xc2575c,PO_number:_0xa0bf41,SCRN:_0x3fccc9,JO_number:_0x5c3c1c}=_0x346ed2[_0x5732cd(0x274)];if(typeof _0x44dc34==_0x5732cd(0x187))var _0x2fda73=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x223)]],_0x352213=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x15b)]],_0x4243b2=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1c7)]],_0x4bbb6a=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x16c)]],_0x4f9e4e=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1f8)]],_0x2f2fc9=[_0x346ed2['body']['prod_level']],_0x28f45b=[_0x346ed2[_0x5732cd(0x274)]['primary_code']],_0x365797=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1f7)]],_0x2b45ee=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1c6)]],_0x18a1e0=[_0x346ed2[_0x5732cd(0x274)]['batch_code']],_0x44867e=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x165)]],_0x178ef3=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1cc)]],_0x1e68c6=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x17d)]],_0x10265d=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x261)]],_0x339ddf=[_0x346ed2[_0x5732cd(0x274)]['prod_cat']],_0x2154e6=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x205)]],_0x1cc9be=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1da)]],_0xc096f=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x228)]],_0x5d9829=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x254)]],_0x2d2347=[_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x26a)]];else var _0x2fda73=[..._0x346ed2[_0x5732cd(0x274)]['prod_name']],_0x352213=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x15b)]],_0x4243b2=[..._0x346ed2['body'][_0x5732cd(0x1c7)]],_0x4bbb6a=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x16c)]],_0x4f9e4e=[..._0x346ed2['body']['prod_secondunit']],_0x2f2fc9=[..._0x346ed2['body'][_0x5732cd(0x1af)]],_0x28f45b=[..._0x346ed2[_0x5732cd(0x274)]['primary_code']],_0x365797=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1f7)]],_0x2b45ee=[..._0x346ed2['body'][_0x5732cd(0x1c6)]],_0x18a1e0=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1c3)]],_0x44867e=[..._0x346ed2[_0x5732cd(0x274)]['expiry_date']],_0x178ef3=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1cc)]],_0x1e68c6=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x17d)]],_0x10265d=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x261)]],_0x339ddf=[..._0x346ed2[_0x5732cd(0x274)]['prod_cat']],_0x2154e6=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x205)]],_0x1cc9be=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x1da)]],_0xc096f=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x228)]],_0x5d9829=[..._0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x254)]],_0x2d2347=[..._0x346ed2['body'][_0x5732cd(0x26a)]];const _0x50ac6e=_0x2fda73[_0x5732cd(0x1bd)](_0x5fbf51=>{return _0x5fbf51={'product_name':_0x5fbf51};});_0x5d9829['forEach']((_0x3ac1c3,_0x2010bb)=>{var _0x1fa1fa=_0x5732cd;_0x50ac6e[_0x2010bb][_0x1fa1fa(0x254)]=Math[_0x1fa1fa(0x1e2)](_0x3ac1c3);}),_0x2d2347[_0x5732cd(0x23c)]((_0x520729,_0x508993)=>{var _0x407af8=_0x5732cd;_0x50ac6e[_0x508993][_0x407af8(0x26a)]=_0x520729;}),_0x352213[_0x5732cd(0x23c)]((_0x298b6f,_0x20f37c)=>{var _0x26c94a=_0x5732cd;_0x50ac6e[_0x20f37c][_0x26c94a(0x159)]=_0x298b6f;}),_0x4243b2[_0x5732cd(0x23c)]((_0x2664be,_0x3c0b97)=>{var _0x3a2a21=_0x5732cd;_0x50ac6e[_0x3c0b97][_0x3a2a21(0x249)]=Math[_0x3a2a21(0x1e2)](_0x2664be);}),_0x4bbb6a[_0x5732cd(0x23c)]((_0x2ab497,_0x22d69f)=>{var _0x186737=_0x5732cd;_0x50ac6e[_0x22d69f][_0x186737(0x1fb)]=_0x2ab497;}),_0x4f9e4e[_0x5732cd(0x23c)]((_0x6e0130,_0x1d728b)=>{var _0x35e895=_0x5732cd;_0x50ac6e[_0x1d728b][_0x35e895(0x202)]=_0x6e0130;}),_0x2f2fc9[_0x5732cd(0x23c)]((_0x711e94,_0x5bdbc9)=>{_0x2154e6['forEach']((_0x1cf750,_0x36d0e0)=>{var _0x30717e=a0_0x5b8d;if(_0x1cf750==_0x30717e(0x1b6)&&_0x5bdbc9==_0x36d0e0){console[_0x30717e(0x244)](_0x1cf750+'\x20<\x20wew\x20>\x20'+_0x5bdbc9+_0x30717e(0x233)+_0x36d0e0+_0x30717e(0x233)+_0x711e94);var _0x49ad64=_0x711e94['slice'](0x3);_0x50ac6e[_0x5bdbc9][_0x30717e(0x195)]=_0x711e94[0x0],_0x50ac6e[_0x5bdbc9][_0x30717e(0x1dc)]=_0x711e94[0x1],_0x50ac6e[_0x5bdbc9]['bay']=0x0,_0x50ac6e[_0x5bdbc9][_0x30717e(0x264)]=0x0,_0x50ac6e[_0x5bdbc9]['type']=_0x30717e(0x22f),_0x50ac6e[_0x5bdbc9]['floorlevel']=_0x49ad64;}else{if(_0x1cf750==_0x30717e(0x1d6)&&_0x5bdbc9==_0x36d0e0){var _0x49ad64=_0x711e94[_0x30717e(0x225)](0x3);_0x50ac6e[_0x5bdbc9][_0x30717e(0x195)]=_0x711e94[0x0],_0x50ac6e[_0x5bdbc9][_0x30717e(0x1dc)]=_0x711e94[0x1],_0x50ac6e[_0x5bdbc9][_0x30717e(0x1cd)]=0x0,_0x50ac6e[_0x5bdbc9]['bin']=0x0,_0x50ac6e[_0x5bdbc9][_0x30717e(0x232)]=_0x30717e(0x22f),_0x50ac6e[_0x5bdbc9]['floorlevel']=_0x711e94[0x5];}else{if(_0x5bdbc9==_0x36d0e0){if(_0x711e94[0x0]=='A'&&_0x711e94[0x1]=='L'&&_0x711e94[0x2]=='L')console[_0x30717e(0x244)](_0x1cf750+_0x30717e(0x233)+_0x5bdbc9+_0x30717e(0x233)+_0x36d0e0+_0x30717e(0x233)+_0x711e94+_0x30717e(0x268)),_0x50ac6e[_0x5bdbc9][_0x30717e(0x195)]=_0x711e94[0x0],_0x50ac6e[_0x5bdbc9][_0x30717e(0x1dc)]=_0x711e94[0x1],_0x50ac6e[_0x5bdbc9]['bay']=0x0,_0x50ac6e[_0x5bdbc9][_0x30717e(0x264)]=0x0,_0x50ac6e[_0x5bdbc9][_0x30717e(0x232)]=_0x30717e(0x22f),_0x50ac6e[_0x5bdbc9][_0x30717e(0x242)]=_0x711e94[0x3];else{var _0x56ae3f;if(_0x711e94[0x4]=='L')_0x56ae3f=_0x30717e(0x258);else _0x711e94[0x4]=='F'&&(_0x56ae3f='Floor');_0x50ac6e[_0x5bdbc9][_0x30717e(0x195)]=_0x711e94[0x0],_0x50ac6e[_0x5bdbc9][_0x30717e(0x1dc)]=_0x711e94[0x1],_0x50ac6e[_0x5bdbc9][_0x30717e(0x1cd)]=_0x711e94[0x2],_0x50ac6e[_0x5bdbc9][_0x30717e(0x264)]=_0x711e94[0x3],_0x50ac6e[_0x5bdbc9][_0x30717e(0x232)]=_0x56ae3f,_0x50ac6e[_0x5bdbc9][_0x30717e(0x242)]=_0x711e94[0x5];}}}}});}),_0x28f45b[_0x5732cd(0x23c)]((_0x1133f1,_0x2cf0c9)=>{var _0x398c0e=_0x5732cd;_0x50ac6e[_0x2cf0c9][_0x398c0e(0x24d)]=_0x1133f1;}),_0x365797[_0x5732cd(0x23c)]((_0x2286e0,_0x5bb330)=>{_0x50ac6e[_0x5bb330]['secondary_code']=_0x2286e0;}),_0x2b45ee['forEach']((_0x52d57b,_0x13eb67)=>{_0x50ac6e[_0x13eb67]['maxStocks']=_0x52d57b;}),_0x18a1e0[_0x5732cd(0x23c)]((_0x28c773,_0x5ad92f)=>{var _0x55680f=_0x5732cd;_0x50ac6e[_0x5ad92f][_0x55680f(0x1c3)]=_0x28c773;}),_0x44867e['forEach']((_0x448602,_0x4cf032)=>{var _0xccd89a=_0x5732cd;_0x50ac6e[_0x4cf032][_0xccd89a(0x165)]=_0x448602;}),_0x178ef3[_0x5732cd(0x23c)]((_0xe4eb89,_0x1001a3)=>{var _0x5dc627=_0x5732cd;_0x50ac6e[_0x1001a3][_0x5dc627(0x171)]=_0xe4eb89;}),_0x1e68c6[_0x5732cd(0x23c)]((_0xfb5d7c,_0x5f1877)=>{var _0x2437f5=_0x5732cd;_0x50ac6e[_0x5f1877][_0x2437f5(0x17d)]=_0xfb5d7c;}),_0x10265d['forEach']((_0x3e337f,_0x56b930)=>{_0x50ac6e[_0x56b930]['production_date']=_0x3e337f;}),_0x339ddf[_0x5732cd(0x23c)]((_0x33e973,_0x5670e5)=>{_0x50ac6e[_0x5670e5]['product_cat']=_0x33e973;}),_0x2154e6[_0x5732cd(0x23c)]((_0x227b91,_0x6d02d3)=>{var _0x51685f=_0x5732cd;_0x50ac6e[_0x6d02d3][_0x51685f(0x23d)]=_0x227b91;}),_0x1cc9be[_0x5732cd(0x23c)]((_0x5026f9,_0x138386)=>{var _0x54979d=_0x5732cd;_0x50ac6e[_0x138386][_0x54979d(0x230)]=_0x5026f9;}),_0xc096f[_0x5732cd(0x23c)]((_0x303ab7,_0xd7a7c1)=>{var _0x22bc84=_0x5732cd;_0x50ac6e[_0xd7a7c1][_0x22bc84(0x17f)]=_0x303ab7;});const _0x195908=_0x2154e6[_0x5732cd(0x1bd)](_0x578c21=>{return _0x578c21={'room_name':_0x578c21};}),_0x96d669=_0x50ac6e['filter'](_0x1db097=>_0x1db097[_0x5732cd(0x249)]!=='0'&&_0x1db097[_0x5732cd(0x249)]!==''),_0x33eadc=new purchases({'invoice':_0x1f4b1a,'suppliers':_0x346ed2[_0x5732cd(0x274)][_0x5732cd(0x227)],'date':_0x4816e6,'warehouse_name':_0x378df4,'product':_0x96d669,'note':_0x57eea6,'due_amount':_0xfd7389,'POnumber':_0xa0bf41,'SCRN':_0x3fccc9,'JO_number':_0x5c3c1c,'roomList':_0x195908}),_0x13df98=await _0x33eadc[_0x5732cd(0x1d8)](),_0x44824=await purchases[_0x5732cd(0x207)]({'invoice':_0x1f4b1a}),_0x42fd60=_0x44824[_0x5732cd(0x238)]['map'](async _0x4bde76=>{var _0x314306=_0x5732cd,_0x5842da=await warehouse[_0x314306(0x207)]({'name':_0x378df4,'room':_0x4bde76[_0x314306(0x23d)]}),_0x32f31d=0x0;return _0x5842da[_0x314306(0x26d)][_0x314306(0x23c)](_0x2991c8=>{var _0x579c25=_0x314306;_0x2991c8[_0x579c25(0x1d4)]==_0x4bde76[_0x579c25(0x1d4)]&&_0x2991c8[_0x579c25(0x242)]==_0x4bde76[_0x579c25(0x242)]&&_0x2991c8[_0x579c25(0x232)]==_0x4bde76[_0x579c25(0x232)]&&_0x2991c8['bin']==_0x4bde76[_0x579c25(0x264)]&&_0x2991c8['bay']==_0x4bde76[_0x579c25(0x1cd)]&&_0x2991c8[_0x579c25(0x1dc)]==_0x4bde76[_0x579c25(0x1dc)]&&_0x2991c8[_0x579c25(0x195)]==_0x4bde76['storage']&&_0x2991c8['expiry_date']==_0x4bde76[_0x579c25(0x165)]&&_0x2991c8[_0x579c25(0x1c3)]==_0x4bde76['batch_code']&&_0x2991c8['production_date']==_0x4bde76['production_date']&&_0x2991c8[_0x579c25(0x17f)]==_0x44824[_0x579c25(0x17f)]&&(_0x2991c8[_0x579c25(0x231)]+=Math[_0x579c25(0x1e2)](_0x4bde76[_0x579c25(0x249)]),_0x32f31d++);}),_0x32f31d===0x0&&_0x5842da[_0x314306(0x26d)][_0x314306(0x15c)]({'product_name':_0x4bde76[_0x314306(0x1d4)],'product_stock':Math[_0x314306(0x1e2)](_0x4bde76[_0x314306(0x249)]),'primary_code':_0x4bde76[_0x314306(0x24d)],'secondary_code':_0x4bde76[_0x314306(0x1f7)],'product_code':_0x4bde76[_0x314306(0x159)],'storage':_0x4bde76[_0x314306(0x195)],'rack':_0x4bde76[_0x314306(0x1dc)],'bay':_0x4bde76['bay'],'bin':_0x4bde76[_0x314306(0x264)],'type':_0x4bde76[_0x314306(0x232)],'floorlevel':_0x4bde76['floorlevel'],'maxProducts':_0x4bde76[_0x314306(0x16a)],'unit':_0x4bde76[_0x314306(0x1fb)],'secondary_unit':_0x4bde76[_0x314306(0x202)],'expiry_date':_0x4bde76['expiry_date'],'maxPerUnit':_0x4bde76[_0x314306(0x171)],'batch_code':_0x4bde76[_0x314306(0x1c3)],'alertQTY':_0x4bde76[_0x314306(0x17d)],'production_date':_0x4bde76['production_date'],'product_cat':_0x4bde76['product_cat'],'invoice':_0x4bde76['invoice'],'actual_qty':Math[_0x314306(0x1e2)](_0x4bde76[_0x314306(0x254)]),'actual_uom':_0x4bde76['actual_uom']}),_0x5842da;});Promise[_0x5732cd(0x23e)](_0x42fd60)[_0x5732cd(0x19f)](async _0x5c202c=>{var _0x5180be=_0x5732cd;try{for(const _0x3db881 of _0x5c202c){await _0x3db881['save']();}const _0x347482=await master_shop[_0x5180be(0x206)](),_0x3dd7d1=await email_settings[_0x5180be(0x207)](),_0xee85e8=await supervisor_settings[_0x5180be(0x206)]();var _0x361f53=_0x44824[_0x5180be(0x238)],_0x595536='',_0xadb6a6;for(_0xadb6a6 in _0x361f53){_0x595536+=_0x5180be(0x1ee)+_0x5180be(0x214)+_0x361f53[_0xadb6a6][_0x5180be(0x1d4)]+_0x5180be(0x1b5)+_0x5180be(0x214)+_0x361f53[_0xadb6a6]['product_code']+_0x5180be(0x1b5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x361f53[_0xadb6a6]['quantity']+_0x5180be(0x1b5)+_0x5180be(0x214)+_0x361f53[_0xadb6a6][_0x5180be(0x1fb)]+_0x5180be(0x1b5)+_0x5180be(0x214)+_0x361f53[_0xadb6a6][_0x5180be(0x202)]+'</td>'+_0x5180be(0x214)+_0x44824[_0x5180be(0x178)]+_0x5180be(0x1b5)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x361f53[_0xadb6a6][_0x5180be(0x23d)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x361f53[_0xadb6a6][_0x5180be(0x195)]+_0x361f53[_0xadb6a6][_0x5180be(0x1dc)]+_0x361f53[_0xadb6a6][_0x5180be(0x1cd)]+_0x361f53[_0xadb6a6][_0x5180be(0x264)]+_0x361f53[_0xadb6a6][_0x5180be(0x232)][0x0]+_0x361f53[_0xadb6a6][_0x5180be(0x242)]+_0x5180be(0x1b5),_0x5180be(0x16b);}let _0x17e903=nodemailer[_0x5180be(0x168)]({'host':_0x3dd7d1['host'],'port':Number(_0x3dd7d1[_0x5180be(0x272)]),'secure':![],'auth':{'user':_0x3dd7d1[_0x5180be(0x1c4)],'pass':_0x3dd7d1[_0x5180be(0x1b8)]}}),_0x5355b8={'from':_0x3dd7d1[_0x5180be(0x1c4)],'to':_0xee85e8[0x0]['RMSEmail'],'subject':_0x5180be(0x21a),'attachments':[{'filename':_0x5180be(0x1a1),'path':__dirname+_0x5180be(0x26e)+_0x5180be(0x25d)+_0x347482[0x0]['image'],'cid':_0x5180be(0x23b)}],'html':_0x5180be(0x25e)+_0x5180be(0x19c)+_0x5180be(0x22c)+_0x5180be(0x173)+_0x5180be(0x16f)+'<div>'+_0x5180be(0x1e6)+_0x5180be(0x275)+_0x5180be(0x173)+_0x5180be(0x184)+_0x347482[0x0][_0x5180be(0x201)]+_0x5180be(0x22d)+_0x5180be(0x275)+_0x5180be(0x275)+_0x5180be(0x160)+_0x5180be(0x173)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x44824[_0x5180be(0x17f)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x5180be(0x1ae)+_0x44824[_0x5180be(0x1b0)]+'\x20'+_0x5180be(0x257)+_0x5180be(0x1a3)+_0x5180be(0x275)+_0x5180be(0x1a8)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5180be(0x1ee)+_0x5180be(0x1f4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5180be(0x1bc)+_0x5180be(0x182)+_0x5180be(0x220)+_0x5180be(0x18a)+_0x5180be(0x1d7)+_0x5180be(0x174)+_0x5180be(0x16b)+_0x5180be(0x15f)+_0x5180be(0x192)+'\x20'+_0x595536+'\x20'+_0x5180be(0x226)+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x5180be(0x25a)+_0x347482[0x0][_0x5180be(0x201)]+_0x5180be(0x1a3)+_0x5180be(0x275)+_0x5180be(0x275)+_0x5180be(0x253)};_0x17e903[_0x5180be(0x269)](_0x5355b8,function(_0x3b817a,_0x238817){var _0x444760=_0x5180be;_0x3b817a?(console['log'](_0x3b817a),console[_0x444760(0x244)]('Error\x20Occurs')):console[_0x444760(0x244)]('Email\x20sent\x20successfully');}),_0x346ed2[_0x5180be(0x1bb)](_0x5180be(0x208),_0x5180be(0x1be)),_0x45fa0f[_0x5180be(0x252)](_0x5180be(0x1ce));}catch(_0x4f954c){console[_0x5180be(0x20c)](_0x4f954c),_0x45fa0f['status'](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x5732cd(0x1f9)](_0x17d502=>{var _0x1c18c4=_0x5732cd;console[_0x1c18c4(0x20c)](_0x17d502),_0x45fa0f[_0x1c18c4(0x1f5)](0x1f4)['json']({'error':_0x1c18c4(0x222)});});}catch(_0x6a09e7){console[_0x5732cd(0x244)](_0x6a09e7);}}),router[a0_0x22c0d4(0x243)]('/preview/:id',auth,async(_0xfb10be,_0x454a00)=>{var _0x4254ec=a0_0x22c0d4;try{const {username:_0x3a9aaa,email:_0x3e726a,role:_0x212abb}=_0xfb10be[_0x4254ec(0x25b)],_0x3ce30b=_0xfb10be['user'],_0x58d12a=await profile['findOne']({'email':_0x3ce30b[_0x4254ec(0x1c4)]}),_0x786fd9=await master_shop[_0x4254ec(0x206)](),_0x509332=_0xfb10be['params']['id'],_0x3b52fc=await purchases['findById'](_0x509332),_0xc82e01=await warehouse[_0x4254ec(0x1bf)]([{'$match':{'name':_0x3b52fc[_0x4254ec(0x178)],'room':_0x3b52fc['room']}},{'$unwind':_0x4254ec(0x197)},{'$group':{'_id':_0x4254ec(0x23a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4254ec(0x1e0)},'bay':{'$first':_0x4254ec(0x179)},'bin':{'$first':_0x4254ec(0x198)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4254ec(0x270)},'secondary_code':{'$first':_0x4254ec(0x221)},'product_code':{'$first':_0x4254ec(0x1b1)},'storage':{'$first':_0x4254ec(0x1a6)},'rack':{'$first':_0x4254ec(0x1ad)},'expiry_date':{'$first':_0x4254ec(0x1ff)}}}]),_0x52af52=await customer[_0x4254ec(0x206)]({});let _0x31c8fe;if(_0x3ce30b['role']=='staff'){const _0x2c465c=await staff[_0x4254ec(0x207)]({'email':_0x3ce30b['email']});_0x31c8fe=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x2c465c[_0x4254ec(0x235)]}},{'$group':{'_id':'$name','name':{'$first':_0x4254ec(0x1d0)}}}]);}else _0x31c8fe=await warehouse[_0x4254ec(0x1bf)]([{'$match':{'status':_0x4254ec(0x263)}},{'$group':{'_id':_0x4254ec(0x1d0),'name':{'$first':_0x4254ec(0x1d0)}}}]);const _0x5af89c=await product[_0x4254ec(0x206)]({}),_0x35b96f=await suppliers[_0x4254ec(0x206)]({}),_0x3d48d6=BayBinSelected(_0x3b52fc[_0x4254ec(0x178)],_0x3b52fc[_0x4254ec(0x196)]);if(_0x786fd9[0x0]['language']==_0x4254ec(0x24b)){var _0x4ebaa0=users['English'];console[_0x4254ec(0x244)](_0x4ebaa0);}else{if(_0x786fd9[0x0][_0x4254ec(0x1ea)]==_0x4254ec(0x210))var _0x4ebaa0=users[_0x4254ec(0x210)];else{if(_0x786fd9[0x0]['language']=='German')var _0x4ebaa0=users[_0x4254ec(0x1a2)];else{if(_0x786fd9[0x0][_0x4254ec(0x1ea)]==_0x4254ec(0x185))var _0x4ebaa0=users['Spanish'];else{if(_0x786fd9[0x0][_0x4254ec(0x1ea)]==_0x4254ec(0x1ac))var _0x4ebaa0=users[_0x4254ec(0x1ac)];else{if(_0x786fd9[0x0][_0x4254ec(0x1ea)]==_0x4254ec(0x170))var _0x4ebaa0=users[_0x4254ec(0x1cf)];else{if(_0x786fd9[0x0]['language']==_0x4254ec(0x1e3))var _0x4ebaa0=users[_0x4254ec(0x1e3)];else{if(_0x786fd9[0x0][_0x4254ec(0x1ea)]==_0x4254ec(0x229))var _0x4ebaa0=users[_0x4254ec(0x1db)];}}}}}}}_0x454a00['render'](_0x4254ec(0x17e),{'success':_0xfb10be[_0x4254ec(0x1bb)](_0x4254ec(0x208)),'errors':_0xfb10be[_0x4254ec(0x1bb)](_0x4254ec(0x256)),'role':_0x3ce30b,'profile':_0x58d12a,'customer':_0x52af52,'warehouse':_0x31c8fe,'product':_0xc82e01,'user':_0x3b52fc,'master_shop':_0x786fd9,'unit':_0x5af89c,'language':_0x4ebaa0,'suppliers':_0x35b96f,'dataSelected':_0x3d48d6});}catch(_0x4bab84){console[_0x4254ec(0x244)](_0x4bab84);}}),router[a0_0x22c0d4(0x22e)](a0_0x22c0d4(0x1e8),auth,async(_0x3187bf,_0x55a906)=>{var _0x2756d1=a0_0x22c0d4;try{const _0x40f4df=_0x3187bf['params']['id'],{invoice:_0x51a4d7,warehouse_name:_0x52d9b8,Room_name:_0x4a0bec}=_0x3187bf[_0x2756d1(0x274)],_0x1b9785=await warehouse[_0x2756d1(0x207)]({'name':_0x52d9b8,'room':_0x4a0bec}),_0xdf9bbb=await purchases[_0x2756d1(0x207)]({'invoice':_0x51a4d7});_0xdf9bbb['product'][_0x2756d1(0x23c)](_0x278f89=>{var _0x397ef5=_0x2756d1,_0x1a7d1d=0x0;const _0x50dc3c=_0x1b9785['product_details']['map'](_0x843619=>{var _0x5b7eca=a0_0x5b8d;_0x843619['product_name']==_0x278f89['product_name']&&_0x843619[_0x5b7eca(0x242)]==_0x278f89[_0x5b7eca(0x242)]&&_0x843619[_0x5b7eca(0x232)]==_0x278f89[_0x5b7eca(0x232)]&&_0x843619['bin']==_0x278f89['bin']&&_0x843619[_0x5b7eca(0x1cd)]==_0x278f89[_0x5b7eca(0x1cd)]&&_0x843619[_0x5b7eca(0x1dc)]==_0x278f89[_0x5b7eca(0x1dc)]&&_0x843619[_0x5b7eca(0x195)]==_0x278f89[_0x5b7eca(0x195)]&&_0x843619[_0x5b7eca(0x165)]==_0x278f89[_0x5b7eca(0x165)]&&_0x843619[_0x5b7eca(0x1c3)]==_0x278f89[_0x5b7eca(0x1c3)]&&_0x843619[_0x5b7eca(0x261)]==_0x278f89['production_date']&&_0x843619[_0x5b7eca(0x203)]==_0x278f89[_0x5b7eca(0x203)]&&_0x843619[_0x5b7eca(0x230)]==_0x278f89[_0x5b7eca(0x230)]&&(_0x843619[_0x5b7eca(0x231)]=parseInt(_0x843619[_0x5b7eca(0x231)])+parseInt(_0x278f89[_0x5b7eca(0x249)]),_0x1a7d1d++);});_0x1a7d1d=='0'&&(_0x1b9785[_0x397ef5(0x26d)]=_0x1b9785[_0x397ef5(0x26d)][_0x397ef5(0x176)]({'product_name':_0x278f89[_0x397ef5(0x1d4)],'product_stock':_0x278f89['quantity'],'primary_code':_0x278f89[_0x397ef5(0x24d)],'secondary_code':_0x278f89['secondary_code'],'product_code':_0x278f89[_0x397ef5(0x159)],'storage':_0x278f89['storage'],'rack':_0x278f89[_0x397ef5(0x1dc)],'bay':_0x278f89[_0x397ef5(0x1cd)],'bin':_0x278f89[_0x397ef5(0x264)],'type':_0x278f89[_0x397ef5(0x232)],'floorlevel':_0x278f89[_0x397ef5(0x242)],'maxProducts':_0x278f89[_0x397ef5(0x16a)],'unit':_0x278f89['standard_unit'],'secondary_unit':_0x278f89[_0x397ef5(0x202)],'expiry_date':_0x278f89['expiry_date'],'maxPerUnit':_0x278f89[_0x397ef5(0x171)],'batch_code':_0x278f89[_0x397ef5(0x1c3)],'alertQTY':_0x278f89[_0x397ef5(0x17d)],'production_date':_0x278f89[_0x397ef5(0x261)],'delivery_date':_0x278f89[_0x397ef5(0x203)],'delivery_code':_0x278f89[_0x397ef5(0x230)]}));}),await _0x1b9785[_0x2756d1(0x1d8)](),_0xdf9bbb[_0x2756d1(0x260)]='True';const _0x2f2e21=await _0xdf9bbb[_0x2756d1(0x1d8)]();_0x3187bf[_0x2756d1(0x1bb)](_0x2756d1(0x208),_0x2756d1(0x237)),_0x55a906[_0x2756d1(0x252)](_0x2756d1(0x1aa));}catch(_0x5c70c1){console[_0x2756d1(0x244)](_0x5c70c1);}}),router['get'](a0_0x22c0d4(0x191),auth,async(_0x26b7b4,_0xeb2319)=>{var _0x510684=a0_0x22c0d4;try{const {username:_0x1049dd,email:_0xcbb036,role:_0x4e2f5d}=_0x26b7b4[_0x510684(0x25b)],_0x1d0090=_0x26b7b4['user'],_0x443e4a=await profile['findOne']({'email':_0x1d0090['email']}),_0x52ef51=await master_shop['find'](),_0x98085d=_0x26b7b4[_0x510684(0x246)]['id'],_0x4fcf9f=await purchases['findById'](_0x98085d),_0xcd5080=await suppliers['find']({});let _0x2d9223;if(_0x1d0090['role']=='staff'){const _0xe8f53e=await staff[_0x510684(0x207)]({'email':_0x1d0090['email']});_0x2d9223=await warehouse[_0x510684(0x206)]({'status':_0x510684(0x263),'name':_0xe8f53e[_0x510684(0x235)],'warehouse_category':_0x510684(0x1c1)});}else _0x2d9223=await warehouse['aggregate']([{'$match':{'status':_0x510684(0x263),'warehouse_category':_0x510684(0x1c1)}},{'$group':{'_id':'$name','name':{'$first':_0x510684(0x1d0)}}}]);const _0x3c47ed=await product[_0x510684(0x206)]({}),_0x16f3dd=BayBinSelected(_0x4fcf9f[_0x510684(0x178)],_0x4fcf9f[_0x510684(0x196)]);let _0x5338f5=new Date(_0x4fcf9f['expiry_date']),_0x47c718=('0'+_0x5338f5[_0x510684(0x24c)]())[_0x510684(0x225)](-0x2),_0x56fdff=('0'+(_0x5338f5[_0x510684(0x217)]()+0x1))[_0x510684(0x225)](-0x2),_0x5e6892=_0x5338f5[_0x510684(0x22a)](),_0x2dbe23=_0x5e6892+'-'+_0x56fdff+'-'+_0x47c718;if(_0x52ef51[0x0][_0x510684(0x1ea)]==_0x510684(0x24b)){var _0x435644=users[_0x510684(0x15e)];console[_0x510684(0x244)](_0x435644);}else{if(_0x52ef51[0x0][_0x510684(0x1ea)]==_0x510684(0x210))var _0x435644=users[_0x510684(0x210)];else{if(_0x52ef51[0x0][_0x510684(0x1ea)]==_0x510684(0x1a2))var _0x435644=users[_0x510684(0x1a2)];else{if(_0x52ef51[0x0][_0x510684(0x1ea)]==_0x510684(0x185))var _0x435644=users['Spanish'];else{if(_0x52ef51[0x0][_0x510684(0x1ea)]==_0x510684(0x1ac))var _0x435644=users[_0x510684(0x1ac)];else{if(_0x52ef51[0x0]['language']==_0x510684(0x170))var _0x435644=users[_0x510684(0x1cf)];else{if(_0x52ef51[0x0]['language']==_0x510684(0x1e3))var _0x435644=users[_0x510684(0x1e3)];else{if(_0x52ef51[0x0]['language']==_0x510684(0x229))var _0x435644=users['Arabic'];}}}}}}}_0xeb2319[_0x510684(0x277)](_0x510684(0x1d2),{'success':_0x26b7b4[_0x510684(0x1bb)](_0x510684(0x208)),'errors':_0x26b7b4[_0x510684(0x1bb)]('errors'),'role':_0x1d0090,'profile':_0x443e4a,'purchases':_0x4fcf9f,'suppliers':_0xcd5080,'warehouse':_0x2d9223,'product':_0x3c47ed,'master_shop':_0x52ef51,'language':_0x435644,'ed_fullDate':_0x2dbe23,'dataSelected':_0x16f3dd});}catch(_0x3cc40c){console[_0x510684(0x244)](_0x3cc40c);}}),router[a0_0x22c0d4(0x22e)]('/view/:id',auth,async(_0x12cf79,_0x23c69b)=>{var _0x5e61c2=a0_0x22c0d4;try{const _0x59052f=_0x12cf79[_0x5e61c2(0x246)]['id'],_0xca2e33=await purchases['findOne']({'_id':_0x12cf79[_0x5e61c2(0x246)]['id']}),_0x28322d=await warehouse[_0x5e61c2(0x207)]({'name':_0xca2e33[_0x5e61c2(0x178)],'room':_0xca2e33[_0x5e61c2(0x196)]});_0xca2e33[_0x5e61c2(0x238)][_0x5e61c2(0x23c)](_0x23d902=>{var _0x606932=_0x5e61c2;const _0x84a6da=_0x28322d['product_details'][_0x606932(0x1bd)](_0x337074=>{var _0x359ffb=_0x606932;_0x337074[_0x359ffb(0x1d4)]==_0x23d902['product_name']&&_0x337074[_0x359ffb(0x242)]==_0x23d902[_0x359ffb(0x242)]&&_0x337074['type']==_0x23d902[_0x359ffb(0x232)]&&_0x337074[_0x359ffb(0x264)]==_0x23d902[_0x359ffb(0x264)]&&_0x337074['bay']==_0x23d902[_0x359ffb(0x1cd)]&&_0x337074['rack']==_0x23d902[_0x359ffb(0x1dc)]&&_0x337074[_0x359ffb(0x195)]==_0x23d902['storage']&&(_0x337074[_0x359ffb(0x231)]=parseInt(_0x337074[_0x359ffb(0x231)])-parseInt(_0x23d902['quantity']));});}),await _0x28322d[_0x5e61c2(0x1d8)]();const {invoice:_0x4bbf4a,suppliers:_0x5719c9,date:_0x5cd05b,warehouse_name:_0x51be54,prod_name:_0x1b0493,prod_code:_0x277595,prod_qty:_0xee1514,prod_unit:_0x2386a0,prod_secondunit:_0x54133c,prod_level:_0x4f3db1,prod_isle:_0x1aa964,prod_pallet:_0x510637,note:_0x3619ed,expiry_date:_0x406fba,batch_code:_0x222eb0,paid_amount:_0x3e5b70,due_amount:_0x475cef,Room_name:_0x368284,primary_code:_0x4933d8,secondary_code:_0x27d496,PO_number:_0x130335,JO_number:_0xab1209}=_0x12cf79['body'];if(typeof _0x1b0493==_0x5e61c2(0x187))var _0x8020f=[_0x12cf79[_0x5e61c2(0x274)]['prod_name']],_0x48fa0f=[_0x12cf79[_0x5e61c2(0x274)]['prod_code']],_0x570997=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x23f)]],_0x1dcb62=[_0x12cf79['body'][_0x5e61c2(0x26b)]],_0x12be96=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1f8)]],_0x2023f7=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1af)]],_0xd3dbaf=[_0x12cf79[_0x5e61c2(0x274)]['prod_isle']],_0x5be544=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1eb)]],_0x365d25=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x24d)]],_0xb8e351=[_0x12cf79[_0x5e61c2(0x274)]['secondary_code']],_0x2d26b8=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1c6)]],_0x18d0d0=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1c3)]],_0x153036=[_0x12cf79['body'][_0x5e61c2(0x165)]],_0x2f47b4=[_0x12cf79['body'][_0x5e61c2(0x195)]],_0x5c59e4=[_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1b3)]],_0x1bea3c=[_0x12cf79['body']['type']];else var _0x8020f=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x223)]],_0x48fa0f=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x15b)]],_0x570997=[..._0x12cf79['body'][_0x5e61c2(0x23f)]],_0x1dcb62=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x26b)]],_0x12be96=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1f8)]],_0x2023f7=[..._0x12cf79['body'][_0x5e61c2(0x1af)]],_0xd3dbaf=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x265)]],_0x5be544=[..._0x12cf79[_0x5e61c2(0x274)]['prod_pallet']],_0x365d25=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x24d)]],_0xb8e351=[..._0x12cf79['body']['secondary_code']],_0x2d26b8=[..._0x12cf79['body'][_0x5e61c2(0x1c6)]],_0x18d0d0=[..._0x12cf79['body'][_0x5e61c2(0x1c3)]],_0x153036=[..._0x12cf79['body'][_0x5e61c2(0x165)]],_0x2f47b4=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x195)]],_0x5c59e4=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x1b3)]],_0x1bea3c=[..._0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x232)]];const _0x943c4d=_0x8020f['map'](_0x2d9215=>{return _0x2d9215={'product_name':_0x2d9215};});_0x48fa0f['forEach']((_0x57d8e5,_0x493d85)=>{var _0x4653f6=_0x5e61c2;_0x943c4d[_0x493d85][_0x4653f6(0x159)]=_0x57d8e5;}),_0x570997['forEach']((_0x3d0b1d,_0x1bf67b)=>{var _0x3fe939=_0x5e61c2;_0x943c4d[_0x1bf67b][_0x3fe939(0x249)]=_0x3d0b1d;}),_0x1dcb62[_0x5e61c2(0x23c)]((_0x619e03,_0xcb3a92)=>{_0x943c4d[_0xcb3a92]['standard_unit']=_0x619e03;}),_0x12be96[_0x5e61c2(0x23c)]((_0x489644,_0x53891c)=>{var _0x24b37b=_0x5e61c2;_0x943c4d[_0x53891c][_0x24b37b(0x202)]=_0x489644;}),_0x2023f7[_0x5e61c2(0x23c)]((_0x2d8510,_0x1e04ed)=>{var _0x9b2571=_0x5e61c2;_0x943c4d[_0x1e04ed][_0x9b2571(0x1cd)]=_0x2d8510;}),_0xd3dbaf[_0x5e61c2(0x23c)]((_0x5445d1,_0x4ac0e8)=>{_0x943c4d[_0x4ac0e8]['bin']=_0x5445d1;}),_0x5be544['forEach']((_0x3c655a,_0x210b65)=>{var _0x30d32e=_0x5e61c2;_0x943c4d[_0x210b65][_0x30d32e(0x242)]=_0x3c655a;}),_0x365d25[_0x5e61c2(0x23c)]((_0x4f740a,_0x4fdedb)=>{var _0x15ef49=_0x5e61c2;_0x943c4d[_0x4fdedb][_0x15ef49(0x24d)]=_0x4f740a;}),_0xb8e351[_0x5e61c2(0x23c)]((_0x12f405,_0x3304fa)=>{_0x943c4d[_0x3304fa]['secondary_code']=_0x12f405;}),_0x2d26b8[_0x5e61c2(0x23c)]((_0x324ec2,_0x218cca)=>{var _0x5f140a=_0x5e61c2;_0x943c4d[_0x218cca][_0x5f140a(0x16a)]=_0x324ec2;}),_0x18d0d0['forEach']((_0x59364a,_0x32b062)=>{_0x943c4d[_0x32b062]['batch_code']=_0x59364a;}),_0x153036[_0x5e61c2(0x23c)]((_0x530023,_0x42620f)=>{var _0x7615ed=_0x5e61c2;_0x943c4d[_0x42620f][_0x7615ed(0x165)]=_0x530023;}),_0x1bea3c[_0x5e61c2(0x23c)]((_0x43a16b,_0xa2a476)=>{var _0x5b04e8=_0x5e61c2;_0x943c4d[_0xa2a476][_0x5b04e8(0x232)]=_0x43a16b;}),_0x2f47b4[_0x5e61c2(0x23c)]((_0x48d482,_0x3b235e)=>{var _0x4f881b=_0x5e61c2;_0x943c4d[_0x3b235e][_0x4f881b(0x195)]=_0x48d482;}),_0x5c59e4[_0x5e61c2(0x23c)]((_0x556b32,_0x33ea57)=>{var _0x4740c5=_0x5e61c2;_0x943c4d[_0x33ea57][_0x4740c5(0x1dc)]=_0x556b32;});const _0x22dfda=_0x943c4d[_0x5e61c2(0x255)](_0x21985e=>_0x21985e[_0x5e61c2(0x249)]!=='0'&&_0x21985e[_0x5e61c2(0x249)]!=='');_0xca2e33[_0x5e61c2(0x17f)]=_0x4bbf4a,_0xca2e33[_0x5e61c2(0x227)]=_0x5719c9,_0xca2e33[_0x5e61c2(0x1b0)]=_0x5cd05b,_0xca2e33[_0x5e61c2(0x178)]=_0x51be54,_0xca2e33[_0x5e61c2(0x238)]=_0x22dfda,_0xca2e33['note']=_0x3619ed,_0xca2e33[_0x5e61c2(0x1c8)]=_0x3e5b70,_0xca2e33[_0x5e61c2(0x1c9)]=_0x475cef,_0xca2e33[_0x5e61c2(0x196)]=_0x368284,_0xca2e33['POnumber']=_0x130335,_0xca2e33[_0x5e61c2(0x1ed)]=_0xab1209;const _0x415a6d=await _0xca2e33[_0x5e61c2(0x1d8)](),_0x178420=await warehouse[_0x5e61c2(0x207)]({'name':_0x12cf79[_0x5e61c2(0x274)]['warehouse_name'],'room':_0x12cf79['body'][_0x5e61c2(0x271)]});_0xca2e33['product'][_0x5e61c2(0x23c)](_0xd35fb7=>{var _0x3c97ec=_0x5e61c2,_0x483a1d=0x0;const _0x441bcd=_0x178420['product_details'][_0x3c97ec(0x1bd)](_0x52530e=>{var _0x5b6b2b=_0x3c97ec;_0x52530e[_0x5b6b2b(0x1d4)]==_0xd35fb7['product_name']&&_0x52530e[_0x5b6b2b(0x242)]==_0xd35fb7[_0x5b6b2b(0x242)]&&_0x52530e[_0x5b6b2b(0x232)]==_0xd35fb7['type']&&_0x52530e[_0x5b6b2b(0x264)]==_0xd35fb7[_0x5b6b2b(0x264)]&&_0x52530e['bay']==_0xd35fb7['bay']&&_0x52530e['rack']==_0xd35fb7[_0x5b6b2b(0x1dc)]&&_0x52530e[_0x5b6b2b(0x195)]==_0xd35fb7[_0x5b6b2b(0x195)]&&(_0x52530e['product_stock']=parseInt(_0x52530e[_0x5b6b2b(0x231)])+parseInt(_0xd35fb7[_0x5b6b2b(0x249)]),_0x483a1d++);});_0x483a1d=='0'&&(_0x178420['product_details']=_0x178420[_0x3c97ec(0x26d)][_0x3c97ec(0x176)]({'product_name':_0xd35fb7[_0x3c97ec(0x1d4)],'product_stock':_0xd35fb7['quantity'],'primary_code':_0xd35fb7[_0x3c97ec(0x24d)],'secondary_code':_0xd35fb7[_0x3c97ec(0x1f7)],'product_code':_0xd35fb7['product_code'],'storage':_0xd35fb7[_0x3c97ec(0x195)],'rack':_0xd35fb7[_0x3c97ec(0x1dc)],'bay':_0xd35fb7[_0x3c97ec(0x1cd)],'bin':_0xd35fb7['bin'],'type':_0xd35fb7[_0x3c97ec(0x232)],'floorlevel':_0xd35fb7[_0x3c97ec(0x242)],'maxProducts':_0xd35fb7[_0x3c97ec(0x16a)],'unit':_0xd35fb7[_0x3c97ec(0x1fb)],'secondary_unit':_0xd35fb7[_0x3c97ec(0x202)],'expiry_date':_0xd35fb7[_0x3c97ec(0x165)]}));}),await _0x178420[_0x5e61c2(0x1d8)]();const _0x44bc92=await s_payment_data[_0x5e61c2(0x207)]({'invoice':_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x17f)]});if(_0x44bc92===null){}else console[_0x5e61c2(0x244)](_0x5e61c2(0x227),_0x44bc92,_0x12cf79[_0x5e61c2(0x274)][_0x5e61c2(0x17f)]),_0x44bc92[_0x5e61c2(0x227)]=_0x12cf79['body'][_0x5e61c2(0x227)],await _0x44bc92[_0x5e61c2(0x1d8)]();_0x12cf79[_0x5e61c2(0x1bb)]('success',_0x5e61c2(0x27c)),_0x23c69b[_0x5e61c2(0x252)](_0x5e61c2(0x1aa));}catch(_0x115440){console['log'](_0x115440);}}),router[a0_0x22c0d4(0x22e)](a0_0x22c0d4(0x234),auth,async(_0x3bea87,_0x5ba0dc)=>{var _0x2f6926=a0_0x22c0d4;try{const _0x59f44a=_0x3bea87['params']['id'],{invoice:_0x4cc0b7,suppliers:_0x1a2db5,payable:_0x58051e,due_amount:_0x4c6a88}=_0x3bea87['body'],_0x3a594a=await purchases[_0x2f6926(0x1c5)](_0x59f44a);var _0x16959c=_0x58051e-_0x4c6a88;_0x3a594a[_0x2f6926(0x1c8)]=parseFloat(_0x3a594a['paid_amount'])+parseFloat(_0x4c6a88),_0x3a594a[_0x2f6926(0x1c9)]=_0x16959c;const _0x3f47ee=await _0x3a594a[_0x2f6926(0x1d8)]();console[_0x2f6926(0x244)](_0x3f47ee);const _0x44eace=await s_payment_data[_0x2f6926(0x207)]({'invoice':_0x4cc0b7});_0x44eace[_0x2f6926(0x20f)]=_0x16959c,await _0x44eace[_0x2f6926(0x1d8)]();let _0xe19ee7=new Date(),_0x1a1388=('0'+_0xe19ee7['getDate']())['slice'](-0x2),_0x513d77=('0'+(_0xe19ee7[_0x2f6926(0x217)]()+0x1))[_0x2f6926(0x225)](-0x2),_0x2df7fb=_0xe19ee7[_0x2f6926(0x22a)](),_0x421041=_0x2df7fb+'-'+_0x513d77+'-'+_0x1a1388;const _0x493dbb=new suppliers_payment({'invoice':_0x4cc0b7,'date':_0x2df7fb+'-'+_0x513d77+'-'+_0x1a1388,'suppliers':_0x1a2db5,'reason':_0x2f6926(0x161),'amount':_0x4c6a88}),_0x68591a=await _0x493dbb[_0x2f6926(0x1d8)]();_0x3bea87[_0x2f6926(0x1bb)](_0x2f6926(0x208),_0x2f6926(0x162)),_0x5ba0dc[_0x2f6926(0x252)](_0x2f6926(0x1aa));}catch(_0xceaca1){console[_0x2f6926(0x244)](_0xceaca1);}}),router['get'](a0_0x22c0d4(0x241),auth,async(_0x21bc8e,_0x210546)=>{var _0x20d5d6=a0_0x22c0d4;try{const {username:_0x59a7e2,email:_0x3fd99e,role:_0x49fd0e}=_0x21bc8e[_0x20d5d6(0x25b)],_0x5df6cb=_0x21bc8e[_0x20d5d6(0x25b)],_0x5bc5e3=await profile[_0x20d5d6(0x207)]({'email':_0x5df6cb[_0x20d5d6(0x1c4)]}),_0x437567=await master_shop['find']();console[_0x20d5d6(0x244)](_0x20d5d6(0x248),_0x437567);const _0xae58d=_0x21bc8e['params']['id'],_0x203b84=await purchases[_0x20d5d6(0x1c5)](_0xae58d);console[_0x20d5d6(0x244)](_0x203b84);const _0x2c8c21=await suppliers[_0x20d5d6(0x207)]({'name':_0x203b84['suppliers']});console[_0x20d5d6(0x244)](_0x2c8c21);if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x24b)){var _0x237c3f=users['English'];console[_0x20d5d6(0x244)](_0x237c3f);}else{if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x210))var _0x237c3f=users['Hindi'];else{if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x1a2))var _0x237c3f=users[_0x20d5d6(0x1a2)];else{if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x185))var _0x237c3f=users[_0x20d5d6(0x185)];else{if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x1ac))var _0x237c3f=users['French'];else{if(_0x437567[0x0]['language']==_0x20d5d6(0x170))var _0x237c3f=users[_0x20d5d6(0x1cf)];else{if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x1e3))var _0x237c3f=users['Chinese'];else{if(_0x437567[0x0][_0x20d5d6(0x1ea)]==_0x20d5d6(0x229))var _0x237c3f=users[_0x20d5d6(0x1db)];}}}}}}}_0x210546[_0x20d5d6(0x277)](_0x20d5d6(0x194),{'success':_0x21bc8e['flash']('success'),'errors':_0x21bc8e[_0x20d5d6(0x1bb)](_0x20d5d6(0x256)),'role':_0x5df6cb,'profile':_0x5bc5e3,'master_shop':_0x437567,'supplier':_0x2c8c21,'purchase':_0x203b84,'language':_0x237c3f});}catch(_0x40d44a){console[_0x20d5d6(0x244)](_0x40d44a);}}),router[a0_0x22c0d4(0x243)](a0_0x22c0d4(0x212),auth,async(_0x22f160,_0x7d8f94)=>{var _0xe6b878=a0_0x22c0d4;try{const {username:_0x54e516,email:_0x29b884,role:_0x52e92d}=_0x22f160[_0xe6b878(0x25b)],_0x503750=_0x22f160[_0xe6b878(0x25b)],_0x131167=await profile[_0xe6b878(0x207)]({'email':_0x503750[_0xe6b878(0x1c4)]}),_0x23b103=await master_shop[_0xe6b878(0x206)]();console[_0xe6b878(0x244)]('master',_0x23b103);const _0x467778=_0x22f160[_0xe6b878(0x246)]['id'];console[_0xe6b878(0x244)](_0x467778);const _0x446712=await purchases[_0xe6b878(0x1c5)](_0x467778);console[_0xe6b878(0x244)](_0xe6b878(0x200),_0x446712);const _0x5f0bb8=await product[_0xe6b878(0x206)]({}),_0x16aafc=await warehouse['aggregate']([{'$match':{'name':_0x446712[_0xe6b878(0x178)],'room':_0x446712[_0xe6b878(0x196)],'warehouse_category':_0xe6b878(0x1c1)}},{'$unwind':_0xe6b878(0x197)},{'$group':{'_id':_0xe6b878(0x23a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xe6b878(0x1e0)},'bay':{'$first':_0xe6b878(0x179)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0xe6b878(0x17a)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xe6b878(0x270)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0xe6b878(0x1b1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xe6b878(0x1ad)}}}]);warehouse_data=await warehouse[_0xe6b878(0x1bf)]([{'$match':{'status':_0xe6b878(0x263),'name':_0xe6b878(0x21f),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0xe6b878(0x244)](_0xe6b878(0x1b2),_0x16aafc);if(_0x23b103[0x0][_0xe6b878(0x1ea)]==_0xe6b878(0x24b)){var _0x41c91f=users[_0xe6b878(0x15e)];console[_0xe6b878(0x244)](_0x41c91f);}else{if(_0x23b103[0x0][_0xe6b878(0x1ea)]==_0xe6b878(0x210))var _0x41c91f=users[_0xe6b878(0x210)];else{if(_0x23b103[0x0][_0xe6b878(0x1ea)]==_0xe6b878(0x1a2))var _0x41c91f=users[_0xe6b878(0x1a2)];else{if(_0x23b103[0x0]['language']==_0xe6b878(0x185))var _0x41c91f=users[_0xe6b878(0x185)];else{if(_0x23b103[0x0]['language']=='French')var _0x41c91f=users[_0xe6b878(0x1ac)];else{if(_0x23b103[0x0][_0xe6b878(0x1ea)]==_0xe6b878(0x170))var _0x41c91f=users[_0xe6b878(0x1cf)];else{if(_0x23b103[0x0][_0xe6b878(0x1ea)]=='Chinese')var _0x41c91f=users[_0xe6b878(0x1e3)];else{if(_0x23b103[0x0]['language']=='Arabic\x20(ae)')var _0x41c91f=users[_0xe6b878(0x1db)];}}}}}}}_0x7d8f94[_0xe6b878(0x277)](_0xe6b878(0x1f3),{'success':_0x22f160[_0xe6b878(0x1bb)](_0xe6b878(0x208)),'errors':_0x22f160['flash']('errors'),'role':_0x503750,'profile':_0x131167,'user':_0x446712,'stock':_0x16aafc,'master_shop':_0x23b103,'product':_0x5f0bb8,'language':_0x41c91f,'warehouse':warehouse_data});}catch(_0x4fbb30){console[_0xe6b878(0x244)](_0x4fbb30);}}),router[a0_0x22c0d4(0x22e)](a0_0x22c0d4(0x212),auth,async(_0x589f7a,_0x374569)=>{var _0x592508=a0_0x22c0d4;try{const {invoice:_0x3127f5,date:_0x1d3410,warehouse_name:_0x2c9617,Room_name:_0x2b9c3d,product_name:_0xe3bc86,purchase_quantity:_0x4b428c,stocks:_0x43ba78,return_qty:_0x33728e,note:_0x52619a,level:_0x333796,isle:_0x2a2eb5,pallet:_0x56cebb,to_warehouse_name:_0x58908e,to_Room_name:_0xe4a828}=_0x589f7a[_0x592508(0x274)],_0x5ced06=await purchases['findOne']({'_id':_0x589f7a[_0x592508(0x246)]['id']}),_0x137d3c=await warehouse[_0x592508(0x207)]({'name':_0x2c9617,'room':_0x2b9c3d});if(typeof _0xe3bc86==_0x592508(0x187))var _0x2ef801=[_0x589f7a['body'][_0x592508(0x1d4)]],_0x48c567=[_0x589f7a[_0x592508(0x274)][_0x592508(0x209)]],_0x29c8c8=[_0x589f7a[_0x592508(0x274)]['stocks']],_0x5c6801=[_0x589f7a[_0x592508(0x274)][_0x592508(0x21e)]],_0x28cb17=[_0x589f7a[_0x592508(0x274)][_0x592508(0x15d)]],_0x11d38f=[_0x589f7a[_0x592508(0x274)][_0x592508(0x1ec)]],_0xfb9e97=[_0x589f7a[_0x592508(0x274)][_0x592508(0x266)]],_0x2c1b23=[_0x589f7a[_0x592508(0x274)][_0x592508(0x18f)]],_0x44a78f=[_0x589f7a[_0x592508(0x274)][_0x592508(0x1ef)]],_0x3b7c03=[_0x589f7a[_0x592508(0x274)][_0x592508(0x262)]],_0x589018=[_0x589f7a[_0x592508(0x274)]['secondary_code_hide']];else var _0x2ef801=[..._0x589f7a[_0x592508(0x274)][_0x592508(0x1d4)]],_0x48c567=[..._0x589f7a[_0x592508(0x274)][_0x592508(0x209)]],_0x29c8c8=[..._0x589f7a[_0x592508(0x274)]['stocks']],_0x5c6801=[..._0x589f7a[_0x592508(0x274)]['return_qty']],_0x28cb17=[..._0x589f7a['body'][_0x592508(0x15d)]],_0x11d38f=[..._0x589f7a[_0x592508(0x274)][_0x592508(0x1ec)]],_0xfb9e97=[..._0x589f7a['body'][_0x592508(0x266)]],_0x2c1b23=[..._0x589f7a[_0x592508(0x274)][_0x592508(0x18f)]],_0x44a78f=[..._0x589f7a[_0x592508(0x274)]['product_code_hide']],_0x3b7c03=[..._0x589f7a[_0x592508(0x274)]['primary_code_hide']],_0x589018=[..._0x589f7a['body'][_0x592508(0x219)]];const _0x746096=_0x2ef801['map'](_0x28be07=>{return _0x28be07={'product_name':_0x28be07};});_0x48c567[_0x592508(0x23c)]((_0x1d31e6,_0x1afdaa)=>{var _0x1a1395=_0x592508;_0x746096[_0x1afdaa][_0x1a1395(0x209)]=_0x1d31e6;}),_0x29c8c8[_0x592508(0x23c)]((_0x43f0ce,_0x5de196)=>{var _0x277b20=_0x592508;_0x746096[_0x5de196][_0x277b20(0x1de)]=_0x43f0ce;}),_0x5c6801[_0x592508(0x23c)]((_0x3356d5,_0x3ec800)=>{_0x746096[_0x3ec800]['return_qty']=_0x3356d5;}),_0x28cb17['forEach']((_0x3e5f47,_0x56b2ab)=>{var _0x1de188=_0x592508;_0x746096[_0x56b2ab][_0x1de188(0x1cd)]=_0x3e5f47;}),_0x11d38f['forEach']((_0x53b98c,_0x2c2563)=>{var _0x103589=_0x592508;_0x746096[_0x2c2563][_0x103589(0x264)]=_0x53b98c;}),_0xfb9e97[_0x592508(0x23c)]((_0x23296e,_0x216b16)=>{var _0x5ad94e=_0x592508;_0x746096[_0x216b16][_0x5ad94e(0x242)]=_0x23296e;}),_0x2c1b23[_0x592508(0x23c)]((_0xe0f0cb,_0x16c9b5)=>{var _0x2c7187=_0x592508;_0x746096[_0x16c9b5][_0x2c7187(0x232)]=_0xe0f0cb;}),_0x44a78f['forEach']((_0x4f4c1a,_0x36a476)=>{var _0x5cace2=_0x592508;_0x746096[_0x36a476][_0x5cace2(0x159)]=_0x4f4c1a;}),_0x3b7c03[_0x592508(0x23c)]((_0x2b83c8,_0x1da70b)=>{var _0x4a53ea=_0x592508;_0x746096[_0x1da70b][_0x4a53ea(0x24d)]=_0x2b83c8;}),_0x589018['forEach']((_0x3dd73e,_0x25862a)=>{var _0x177adf=_0x592508;_0x746096[_0x25862a][_0x177adf(0x1f7)]=_0x3dd73e;}),_0x5ced06[_0x592508(0x238)][_0x592508(0x23c)](_0x5ab955=>{var _0x1ed724=_0x592508;const _0x28c2c0=_0x137d3c[_0x1ed724(0x26d)]['map'](_0x54b49a=>{var _0x228237=_0x1ed724;_0x54b49a['product_name']==_0x5ab955['product_name']&&_0x54b49a[_0x228237(0x242)]==_0x5ab955[_0x228237(0x242)]&&_0x54b49a['type']==_0x5ab955['type']&&_0x54b49a[_0x228237(0x264)]==_0x5ab955[_0x228237(0x264)]&&_0x54b49a['bay']==_0x5ab955[_0x228237(0x1cd)]&&_0x54b49a['rack']==_0x5ab955[_0x228237(0x1dc)]&&_0x54b49a[_0x228237(0x195)]==_0x5ab955[_0x228237(0x195)]&&(console[_0x228237(0x244)](parseInt(_0x54b49a[_0x228237(0x231)])+'\x20<>\x20'+parseInt(_0x5ab955['quantity'])),_0x54b49a['product_stock']=parseInt(_0x54b49a[_0x228237(0x231)])+parseInt(_0x5ab955[_0x228237(0x249)]));});}),await _0x137d3c['save']();const _0x3dc47f=_0x746096['filter'](_0x3191a1=>_0x3191a1['return_qty']!=='0'&&_0x3191a1[_0x592508(0x21e)]!=='');var _0x54e9b2=0x0;_0x3dc47f['forEach'](_0x88b0ee=>{var _0x2f8872=_0x592508;console[_0x2f8872(0x244)](_0x2f8872(0x158),_0x88b0ee),(parseInt(_0x88b0ee[_0x2f8872(0x209)])<parseInt(_0x88b0ee[_0x2f8872(0x21e)])||parseInt(_0x88b0ee[_0x2f8872(0x1de)])<parseInt(_0x88b0ee['return_qty']))&&_0x54e9b2++;});if(_0x54e9b2!=0x0)return _0x589f7a['flash']('errors',_0x592508(0x1e4)),_0x374569[_0x592508(0x252)]('back');const _0x3852c2=new purchases_return({'invoice':_0x3127f5,'suppliers':_0x589f7a[_0x592508(0x274)][_0x592508(0x227)],'date':_0x1d3410,'warehouse_name':_0x2c9617,'return_product':_0x3dc47f,'note':_0x52619a,'room':_0x2b9c3d,'to_warehouse_name':_0x58908e,'to_room':_0xe4a828}),_0x104391=await _0x3852c2['save']();console[_0x592508(0x244)](_0x3852c2);const _0x39d821=await purchases_return[_0x592508(0x207)]({'invoice':_0x3127f5}),_0x3f6f45=await warehouse[_0x592508(0x207)]({'name':_0x58908e,'room':_0xe4a828});_0x39d821[_0x592508(0x167)][_0x592508(0x23c)](_0x3f1c96=>{var _0x4b772a=_0x592508,_0x5a2db9=0x0;const _0x544843=_0x3f6f45[_0x4b772a(0x26d)][_0x4b772a(0x1bd)](_0x4e4b00=>{var _0x2b7fe6=_0x4b772a;_0x4e4b00[_0x2b7fe6(0x1d4)]==_0x3f1c96[_0x2b7fe6(0x1d4)]&&_0x4e4b00['floorlevel']==_0x3f1c96[_0x2b7fe6(0x242)]&&_0x4e4b00[_0x2b7fe6(0x232)]==_0x3f1c96[_0x2b7fe6(0x232)]&&_0x4e4b00[_0x2b7fe6(0x264)]==_0x3f1c96['bin']&&_0x4e4b00[_0x2b7fe6(0x1cd)]==_0x3f1c96[_0x2b7fe6(0x1cd)]&&(_0x4e4b00[_0x2b7fe6(0x231)]=parseInt(_0x4e4b00['product_stock'])-parseInt(_0x3f1c96[_0x2b7fe6(0x21e)]),_0x5a2db9++);});_0x5a2db9=='0'&&(_0x3f6f45[_0x4b772a(0x26d)]=_0x3f6f45[_0x4b772a(0x26d)][_0x4b772a(0x176)]({'product_name':_0x3f1c96[_0x4b772a(0x1d4)],'product_stock':_0x3f1c96['return_qty'],'primary_code':_0x3f1c96[_0x4b772a(0x24d)],'secondary_code':_0x3f1c96[_0x4b772a(0x1f7)],'product_code':_0x3f1c96[_0x4b772a(0x159)],'storage':_0x3f1c96['storage'],'rack':_0x3f1c96['rack'],'bay':_0x3f1c96['bay'],'bin':_0x3f1c96[_0x4b772a(0x264)],'type':_0x3f1c96[_0x4b772a(0x232)],'floorlevel':_0x3f1c96[_0x4b772a(0x242)],'maxProducts':_0x3f1c96[_0x4b772a(0x16a)],'unit':_0x3f1c96[_0x4b772a(0x1fb)],'secondary_unit':_0x3f1c96[_0x4b772a(0x202)],'expiry_date':_0x3f1c96[_0x4b772a(0x165)]}));}),await _0x3f6f45[_0x592508(0x1d8)]();const _0x41e095=await purchases[_0x592508(0x207)]({'invoice':_0x3127f5});_0x41e095[_0x592508(0x26f)]='True';const _0x3c287d=await _0x41e095[_0x592508(0x1d8)](),_0x2963d7=new s_payment_data({'invoice':_0x3127f5,'suppliers':_0x589f7a[_0x592508(0x274)][_0x592508(0x227)],'reason':_0x592508(0x166)});await _0x2963d7[_0x592508(0x1d8)]();const _0x2be074=await master_shop[_0x592508(0x206)]();console[_0x592508(0x244)](_0x592508(0x20b),_0x2be074[0x0][_0x592508(0x1a5)]);const _0x38c5d6=await email_settings[_0x592508(0x207)](),_0x325ce0=await suppliers['findOne']({'name':_0x589f7a['body'][_0x592508(0x227)]});console['log'](_0x592508(0x236),_0x325ce0);_0x2be074[0x0][_0x592508(0x211)]==0x1?(right_currency=_0x2be074[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x2be074[0x0]['currency']);var _0x3231dd=_0x2ef801,_0x37348d=_0x5c6801,_0xbe0dbe='',_0x575172;for(_0x575172 in _0x3231dd){_0xbe0dbe+=_0x592508(0x1ee)+_0x592508(0x214)+_0x3231dd[_0x575172]+'</td>'+_0x592508(0x214)+_0x37348d[_0x575172]+_0x592508(0x1b5)+_0x592508(0x16b);}console[_0x592508(0x244)](_0x592508(0x1fa),_0xbe0dbe);let _0x12c9bb=nodemailer[_0x592508(0x168)]({'service':_0x592508(0x25f),'auth':{'user':_0x38c5d6[_0x592508(0x1c4)],'pass':_0x38c5d6[_0x592508(0x1b8)]}}),_0x5e5666={'from':_0x38c5d6['email'],'to':_0x325ce0['email'],'subject':_0x592508(0x1dd),'attachments':[{'filename':_0x592508(0x1a1),'path':__dirname+'/../public'+_0x592508(0x25d)+_0x2be074[0x0][_0x592508(0x1a5)],'cid':_0x592508(0x23b)}],'html':_0x592508(0x25e)+'<html><head><title></title>'+_0x592508(0x22c)+_0x592508(0x173)+_0x592508(0x16f)+_0x592508(0x173)+_0x592508(0x1e6)+'</div>'+_0x592508(0x173)+_0x592508(0x184)+_0x2be074[0x0][_0x592508(0x201)]+_0x592508(0x22d)+_0x592508(0x275)+_0x592508(0x275)+_0x592508(0x160)+_0x592508(0x173)+_0x592508(0x16d)+_0x592508(0x1f6)+_0x3127f5+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x592508(0x1ae)+_0x1d3410+'\x20'+_0x592508(0x257)+_0x592508(0x1a3)+_0x592508(0x275)+_0x592508(0x1a8)+_0x592508(0x1fc)+_0x592508(0x1ee)+_0x592508(0x1f4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x592508(0x19d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x592508(0x16b)+_0x592508(0x15f)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0xbe0dbe+'\x20'+_0x592508(0x226)+'</table>'+_0x592508(0x173)+'<strong>\x20Regards\x20</strong>'+_0x592508(0x25a)+_0x2be074[0x0][_0x592508(0x201)]+_0x592508(0x1a3)+'</div>'+_0x592508(0x275)+_0x592508(0x253)};_0x12c9bb[_0x592508(0x269)](_0x5e5666,function(_0x587705,_0xceda2b){var _0x33a7f0=_0x592508;_0x587705?(console[_0x33a7f0(0x244)](_0x587705),console[_0x33a7f0(0x244)](_0x33a7f0(0x19b))):console[_0x33a7f0(0x244)](_0x33a7f0(0x239));}),_0x589f7a[_0x592508(0x1bb)]('success',_0x592508(0x1a9)),_0x374569[_0x592508(0x252)](_0x592508(0x1aa));}catch(_0x34e9bb){console['log'](_0x34e9bb),_0x374569[_0x592508(0x1f5)](0xc8)['json']({'message':_0x34e9bb[_0x592508(0x20e)]});}}),router[a0_0x22c0d4(0x243)](a0_0x22c0d4(0x26c),auth,async(_0x30ceab,_0x26f2b8)=>{var _0x27a083=a0_0x22c0d4;try{const {username:_0x1510f7,email:_0x2b7d0f,role:_0x25bee7}=_0x30ceab['user'],_0x48d3e5=_0x30ceab['user'],_0x8ad1ad=await profile[_0x27a083(0x207)]({'email':_0x48d3e5[_0x27a083(0x1c4)]}),_0x4b1b03=await master_shop[_0x27a083(0x206)](),_0x44d4d1=_0x30ceab[_0x27a083(0x246)]['id'],_0x4363f9=await purchases['findById'](_0x44d4d1);if(_0x4b1b03[0x0][_0x27a083(0x1ea)]==_0x27a083(0x24b))var _0x4da76a=users[_0x27a083(0x15e)];else{if(_0x4b1b03[0x0]['language']==_0x27a083(0x210))var _0x4da76a=users[_0x27a083(0x210)];else{if(_0x4b1b03[0x0][_0x27a083(0x1ea)]==_0x27a083(0x1a2))var _0x4da76a=users['German'];else{if(_0x4b1b03[0x0]['language']==_0x27a083(0x185))var _0x4da76a=users[_0x27a083(0x185)];else{if(_0x4b1b03[0x0][_0x27a083(0x1ea)]==_0x27a083(0x1ac))var _0x4da76a=users['French'];else{if(_0x4b1b03[0x0][_0x27a083(0x1ea)]==_0x27a083(0x170))var _0x4da76a=users['Portuguese'];else{if(_0x4b1b03[0x0][_0x27a083(0x1ea)]==_0x27a083(0x1e3))var _0x4da76a=users[_0x27a083(0x1e3)];else{if(_0x4b1b03[0x0][_0x27a083(0x1ea)]=='Arabic\x20(ae)')var _0x4da76a=users[_0x27a083(0x1db)];}}}}}}}_0x26f2b8[_0x27a083(0x277)](_0x27a083(0x224),{'success':_0x30ceab['flash']('success'),'errors':_0x30ceab[_0x27a083(0x1bb)](_0x27a083(0x256)),'role':_0x48d3e5,'profile':_0x8ad1ad,'alldata':_0x4363f9,'master_shop':_0x4b1b03,'language':_0x4da76a}),console[_0x27a083(0x244)](alldata);}catch(_0x5c61a4){console[_0x27a083(0x244)](_0x5c61a4);}}),router[a0_0x22c0d4(0x22e)](a0_0x22c0d4(0x21d),async(_0x132f5e,_0x291a9b)=>{var _0x1237cd=a0_0x22c0d4;const {product_code:_0x3208de}=_0x132f5e[_0x1237cd(0x274)];var _0x984b98;const _0x15b831=await product['aggregate']([{'$match':{'primary_code':_0x3208de,'product_category':_0x1237cd(0x1c1)}},{'$group':{'_id':'$_id','name':{'$first':_0x1237cd(0x1d0)},'category':{'$first':_0x1237cd(0x183)},'brand':{'$first':_0x1237cd(0x181)},'unit':{'$first':_0x1237cd(0x1ab)},'alertquantity':{'$first':_0x1237cd(0x1d9)},'product_code':{'$first':_0x1237cd(0x19a)},'primary_code':{'$first':_0x1237cd(0x177)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1237cd(0x216)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1237cd(0x240)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x7eb6f7=await product['aggregate']([{'$match':{'secondary_code':_0x3208de,'product_category':_0x1237cd(0x1c1)}},{'$group':{'_id':'$_id','name':{'$first':_0x1237cd(0x1d0)},'category':{'$first':_0x1237cd(0x183)},'brand':{'$first':_0x1237cd(0x181)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x1237cd(0x1d9)},'product_code':{'$first':_0x1237cd(0x19a)},'primary_code':{'$first':_0x1237cd(0x177)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1237cd(0x216)},'maxProdPerUnit':{'$first':_0x1237cd(0x1e9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x15b831['length']>0x0)_0x984b98=_0x15b831;else _0x7eb6f7['length']>0x0&&(_0x984b98=_0x7eb6f7);_0x291a9b[_0x1237cd(0x163)](_0x984b98);}),router[a0_0x22c0d4(0x22e)](a0_0x22c0d4(0x172),async(_0x1446bc,_0x160613)=>{var _0x58e76b=a0_0x22c0d4;const {primaryCode:_0x422bec,secondaryCode:_0x2a96ea,productCode:_0x436a03,bay:_0x5ef292,bin:_0x288ba4,types:_0x3c040a,pallet:_0x4e98ad,warehouses:_0xa6c66e,room:_0x29f1d1}=_0x1446bc[_0x58e76b(0x274)];console['log'](_0x1446bc[_0x58e76b(0x274)]);try{const _0x4f3a5c=await warehouse['aggregate']([{'$match':{'name':_0xa6c66e,'room':_0x29f1d1}},{'$unwind':_0x58e76b(0x197)},{'$match':{'product_details.bay':_0x5ef292,'product_details.bin':_0x288ba4,'product_details.type':_0x3c040a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x58e76b(0x188)},'product_stock':{'$first':_0x58e76b(0x1e0)},'level':{'$first':_0x58e76b(0x15a)},'isle':{'$first':_0x58e76b(0x273)},'pallet':{'$first':_0x58e76b(0x218)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x160613[_0x58e76b(0x1f5)](0xc8)['json'](_0x4f3a5c);}catch(_0x4196f1){_0x160613[_0x58e76b(0x1f5)](0x194)['json']({'message':_0x4196f1[_0x58e76b(0x20e)]});}}),module[a0_0x22c0d4(0x1ca)]=router;