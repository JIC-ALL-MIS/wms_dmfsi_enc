var a0_0x98235d=a0_0x5b2e;(function(_0x42eefd,_0x27377b){var _0x591f29=a0_0x5b2e,_0x337a1a=_0x42eefd();while(!![]){try{var _0x777c94=parseInt(_0x591f29(0x2fb))/0x1*(-parseInt(_0x591f29(0x2c1))/0x2)+parseInt(_0x591f29(0x2f2))/0x3*(-parseInt(_0x591f29(0x20a))/0x4)+parseInt(_0x591f29(0x2a5))/0x5*(parseInt(_0x591f29(0x290))/0x6)+parseInt(_0x591f29(0x2af))/0x7+-parseInt(_0x591f29(0x27b))/0x8+-parseInt(_0x591f29(0x211))/0x9*(-parseInt(_0x591f29(0x238))/0xa)+parseInt(_0x591f29(0x270))/0xb*(parseInt(_0x591f29(0x274))/0xc);if(_0x777c94===_0x27377b)break;else _0x337a1a['push'](_0x337a1a['shift']());}catch(_0x48620d){_0x337a1a['push'](_0x337a1a['shift']());}}}(a0_0x1b08,0xa5308));function a0_0x5b2e(_0x2b6ca4,_0x2ec6e3){var _0x1b084c=a0_0x1b08();return a0_0x5b2e=function(_0x5b2e54,_0x5bfc96){_0x5b2e54=_0x5b2e54-0x1ec;var _0x37f9a6=_0x1b084c[_0x5b2e54];return _0x37f9a6;},a0_0x5b2e(_0x2b6ca4,_0x2ec6e3);}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x98235d(0x2dd)),auth=require(a0_0x98235d(0x2c5)),nodemailer=require('nodemailer');function a0_0x1b08(){var _0x4d94bb=['$product_details.rack','40zKRiPx','Level','Purchase\x20data\x20added\x20successfully','POnumber','An\x20error\x20occurred.','production_date','paid_amount','status','$product_details.product_stock','logo','forEach','level','Shelves','Purchase\x20Return\x20Mail','toString','German','$product_details._id','suppliers_data','Email\x20sent\x20successfully','edit_purchases_view','abs','image','Logo.png','max_product_unit','port','MaxStocks_data','$maxStocks','floorlevel','<tbody\x20style=\x22text-align:\x20center;\x22>','product_name','slice','</tbody>','return_data','$product_details.bay','quantity','\x20Order\x20Number\x20:\x20','rack','Raw\x20Materials','expiry_date','actual_uom','params','</td>','add_purchases','Rack\x20C','$product_details.primary_code','aggregate','\x20<>\x20','findById','prod_primunit','message','<html><head><title></title>','English\x20(US)','<h5\x20style=\x22text-align:\x20left;\x22>','/barcode/:id','$primary_code','$_id','1760OKLsEu','$product_details.product_code','$product_code','$product.floorlevel','48528htycba','password','return_qty','</tr>','Room_name','Rack\x20F','</thead>','3711504kTDzLj','$product_details.storage','<span\x20style=\x22float:\x20right;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Return\x20Goods','finalize','map','pallet','$suppliers','English','/preview/:id','Portuguese','prod_cat','name','Arabic','stocks','$note','French','table\x20page','rak','</div>','2265342ofKyKe','$product_details.level','/barcode_scanner','$product_details.pallet','<!DOCTYPE\x20html>','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','error','Error\x20Occurs','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$alertquantity','INC-','\x20</h2>','$maxProdPerUnit','<h5>','$secondary_code','prod_invoice','Hindi','/view','getMonth','10UKwKrX','flash','user','prod_name','invoice','product_details','all_purchases','/upload/','$invoice','$batch_code','3836525ehJGvb','standard_unit','Enclosed','<hr\x20class=\x22my-3\x22>','True','$product_details.floorlevel','success','createTransport','/../public','$unit','back','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.type','$expiry_date','Rack\x20D','$name','</span>','product_cat','2hNJjrS','language','note','Portuguese\x20(BR)','../middleware/auth','Rack\x20A','purchases\x20item\x20return\x20successfull','prod_level','</h5>','secondary_unit','log','/all_purchases/view','/view/return_purchase/:id','prod_code','Rack\x20E','render','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product','$product.bay','maxperunit','Sales\x20Update\x20successfully','$product.type','Paid\x20For\x20Purchase','errors','edit_purchases','role','redirect','Rack\x20B','../models/all_models','findOne','prod_unit','date','room_name','primary_code','get','isle','$due_amount','secondary_code','storage','suppliers_docs','$product_details','Floor','delivery_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','purchase_quantity','DRY\x20STORAGE','due_amount','/invoice/:id','json','7386PsSgCa','$product_details.product_name','$warehouse_name','RoomAssign','delivery_date','random','amount','Receiving\x20Area','stock_data','1086231SkVOtd','length','$product.room_name','room','There\x27s\x20a\x20error\x20in\x20this\x20transaction','concat','alertQTY','<div>','gmail','bin','push','prod_isle','<tr>','COLD\x20STORAGE','$paid_amount','Arabic\x20(ae)','$suppliers_docs','/view/:id','staff','currency','types','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','save','$product.quantity','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product_details.expiry_date','add\x20post','$category','</body></html>','primary_code_hide','padStart','product_code','/all_purchases/view/','prod_Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','type','master','find','RMSEmail','\x20Order\x20Date\x20:\x20','product_stock','all','email','actual_qty','1072xMLqiP','<strong>\x20Regards\x20</strong>','JO_number','batch_code','</head><body>','$product','filter','2106837dxxFKi','Enabled','product_code_hide','return_product','suppliers','add_purchases\x20error','payment\x20successfull','exports','bay','$secondary_unit','getDate','host','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_secondunit','warehouse_name','path','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','stock_quantity','return_purchase','catch','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','deliverycode','$product_details.bin','user_id','Chinese','$brand','secondary_code_hide','Ambient','$return_data','body','post','warehouse','maxStocks','Spanish','$product_details.secondary_code','then','</table>','prod_qty'];a0_0x1b08=function(){return _0x4d94bb;};return a0_0x1b08();}var ejs=require('ejs');const path=require(a0_0x98235d(0x220)),users=require('../public/language/languages.json');router[a0_0x98235d(0x2e3)](a0_0x98235d(0x2a3),auth,async(_0x5bc4bd,_0x50a08c)=>{var _0x368cd4=a0_0x98235d;try{const {username:_0x3540dd,email:_0x25393b,role:_0x44c3b9}=_0x5bc4bd['user'],_0x23b80b=_0x5bc4bd[_0x368cd4(0x2a7)],_0x26849b=await profile[_0x368cd4(0x2de)]({'email':_0x23b80b[_0x368cd4(0x208)]}),_0x183a78=await staff[_0x368cd4(0x2de)]({'email':_0x23b80b['email']});if(_0x23b80b[_0x368cd4(0x2da)]==_0x368cd4(0x1ee)){const _0x502f73=await staff[_0x368cd4(0x2de)]({'email':_0x23b80b['email']});}const _0x360c7b=await master_shop[_0x368cd4(0x203)]();let _0x12bfb6;if(_0x23b80b['role']=='staff'){const _0x3c9781=await staff['findOne']({'email':_0x23b80b['email']});_0x12bfb6=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3c9781[_0x368cd4(0x230)]}},{'$lookup':{'from':_0x368cd4(0x215),'localField':_0x368cd4(0x215),'foreignField':_0x368cd4(0x288),'as':_0x368cd4(0x2e8)}},{'$unwind':_0x368cd4(0x1ec)},{'$unwind':_0x368cd4(0x20f)},{'$group':{'_id':_0x368cd4(0x26f),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x368cd4(0x283)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x368cd4(0x2f4)},'room':{'$first':'$room'},'product':{'$push':_0x368cd4(0x20f)},'note':{'$first':_0x368cd4(0x28b)},'paid_amount':{'$first':_0x368cd4(0x309)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x368cd4(0x22d)},'batch_code':{'$first':_0x368cd4(0x2ae)},'expiry_date':{'$first':_0x368cd4(0x2bc)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x368cd4(0x1f5)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x368cd4(0x273)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x12bfb6=await purchases[_0x368cd4(0x265)]([{'$lookup':{'from':_0x368cd4(0x215),'localField':'suppliers','foreignField':'name','as':_0x368cd4(0x2e8)}},{'$unwind':_0x368cd4(0x1ec)},{'$unwind':_0x368cd4(0x20f)},{'$group':{'_id':_0x368cd4(0x26f),'invoice':{'$first':_0x368cd4(0x2ad)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x368cd4(0x2f4)},'room':{'$addToSet':_0x368cd4(0x2fd)},'product':{'$push':_0x368cd4(0x20f)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x368cd4(0x309)},'due_amount':{'$first':_0x368cd4(0x2e5)},'return_data':{'$first':_0x368cd4(0x22d)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x368cd4(0x2bc)},'suppliers_docs':{'$first':_0x368cd4(0x1ec)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x368cd4(0x2d3)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x368cd4(0x2d6)},'floorlevel':{'$addToSet':_0x368cd4(0x273)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x360c7b[0x0]['language']==_0x368cd4(0x26b)){var _0x2e6e8a=users['English'];console[_0x368cd4(0x2cb)](_0x2e6e8a);}else{if(_0x360c7b[0x0]['language']==_0x368cd4(0x2a2))var _0x2e6e8a=users['Hindi'];else{if(_0x360c7b[0x0][_0x368cd4(0x2c2)]==_0x368cd4(0x247))var _0x2e6e8a=users[_0x368cd4(0x247)];else{if(_0x360c7b[0x0][_0x368cd4(0x2c2)]==_0x368cd4(0x232))var _0x2e6e8a=users[_0x368cd4(0x232)];else{if(_0x360c7b[0x0][_0x368cd4(0x2c2)]=='French')var _0x2e6e8a=users[_0x368cd4(0x28c)];else{if(_0x360c7b[0x0][_0x368cd4(0x2c2)]==_0x368cd4(0x2c4))var _0x2e6e8a=users['Portuguese'];else{if(_0x360c7b[0x0]['language']==_0x368cd4(0x229))var _0x2e6e8a=users['Chinese'];else{if(_0x360c7b[0x0][_0x368cd4(0x2c2)]==_0x368cd4(0x30a))var _0x2e6e8a=users[_0x368cd4(0x289)];}}}}}}}_0x50a08c[_0x368cd4(0x2d0)](_0x368cd4(0x2ab),{'success':_0x5bc4bd[_0x368cd4(0x2a6)](_0x368cd4(0x2b5)),'errors':_0x5bc4bd['flash'](_0x368cd4(0x2d8)),'purchases':_0x12bfb6,'role':_0x23b80b,'profile':_0x26849b,'master_shop':_0x360c7b,'language':_0x2e6e8a});}catch(_0x1a9127){console['log'](_0x368cd4(0x28d),_0x1a9127),_0x50a08c['status'](0xc8)[_0x368cd4(0x2f1)]({'message':_0x1a9127[_0x368cd4(0x269)]});}});function BayBinSelected(_0x19de19,_0x5603aa){var _0x375aac=a0_0x98235d,_0x231e1e=[],_0x3a9674=[],_0x5d54f3=[],_0x233c4f=[],_0x23af7e=[],_0x58129a=[];let _0x57b44f=[];if(_0x19de19==_0x375aac(0x2ee))switch(_0x5603aa){case _0x375aac(0x2c6):_0x231e1e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x3a9674=[0x1,0x2],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x239),_0x375aac(0x2ea)],_0x23af7e=['D'],_0x58129a=['A'];break;case _0x375aac(0x2dc):_0x231e1e=[0x6,0x5,0x4,0x3,0x2,0x1],_0x3a9674=[0x1,0x2],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x239),_0x375aac(0x2ea)],_0x23af7e=['D'],_0x58129a=['B'];break;case _0x375aac(0x244):_0x231e1e=[0x0],_0x3a9674=[0x0],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x2ea)],_0x23af7e=['D'],_0x58129a=['S'];break;case _0x375aac(0x2f9):_0x231e1e=[0x0],_0x3a9674=[0x0],_0x233c4f=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x5d54f3=[_0x375aac(0x2ea)],_0x23af7e=['D'],_0x58129a=['R'];break;}else{if(_0x19de19==_0x375aac(0x308))switch(_0x5603aa){case'Rack\x20A':_0x231e1e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x3a9674=['B','F'],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x239),_0x375aac(0x2ea)],_0x23af7e=['C'],_0x58129a=['A'];break;case'Rack\x20B':_0x231e1e=[0x5,0x4,0x3,0x2,0x1],_0x3a9674=['F','B','S'],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=['Level',_0x375aac(0x2ea)],_0x23af7e=['C'],_0x58129a=['B'];break;case _0x375aac(0x263):_0x231e1e=[0x1,0x2,0x3,0x4,0x5],_0x3a9674=['B','F','S'],_0x233c4f=[0x5,0x4,0x3,0x2,0x1],_0x5d54f3=['Level',_0x375aac(0x2ea)],_0x23af7e=['C'],_0x58129a=['C'];break;case _0x375aac(0x2bd):_0x231e1e=[0x5,0x4,0x3,0x2,0x1],_0x3a9674=['F','B','S'],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x239),_0x375aac(0x2ea)],_0x23af7e=['C'],_0x58129a=['D'];break;case _0x375aac(0x2cf):_0x231e1e=[0x4,0x3,0x2,0x1],_0x3a9674=[0x1,0x2],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x239),_0x375aac(0x2ea)],_0x23af7e=['C'],_0x58129a=['E'];break;case _0x375aac(0x279):_0x231e1e=[0x1,0x2,0x3],_0x3a9674=[0x1,0x2],_0x233c4f=[0x1,0x2,0x3,0x4,0x5],_0x5d54f3=[_0x375aac(0x239)],_0x23af7e=['C'],_0x58129a=['F'];break;}}return{'levels':_0x231e1e,'Isle':_0x3a9674,'rack':_0x233c4f,'type':_0x5d54f3,'storage':_0x23af7e,'rak':_0x58129a};}async function getRandom8DigitNumber(){var _0x1179f8=a0_0x98235d;const _0x5ab5a5=0x989680,_0x419bed=0x5f5e0ff,_0xa02920=Math['floor'](Math[_0x1179f8(0x2f7)]()*(_0x419bed-_0x5ab5a5+0x1))+_0x5ab5a5;var _0x2ff4ab;const _0x6aaa0=await purchases['findOne']({'invoice':_0x1179f8(0x29c)+_0xa02920});return _0x6aaa0&&_0x6aaa0[_0x1179f8(0x2fc)]>0x0?_0x2ff4ab=_0x1179f8(0x29c)+_0xa02920:_0x2ff4ab='INC-'+_0xa02920,_0x2ff4ab;}router[a0_0x98235d(0x2e3)]('/view/add_purchases',auth,async(_0x4d3bf4,_0xeaaa30)=>{var _0x518eef=a0_0x98235d;try{const {username:_0x3243fc,email:_0x50d85a,role:_0x3cfe44}=_0x4d3bf4[_0x518eef(0x2a7)],_0x457ddf=_0x4d3bf4['user'],_0x4b6b0d=await profile[_0x518eef(0x2de)]({'email':_0x457ddf[_0x518eef(0x208)]}),_0x26644c=await master_shop[_0x518eef(0x203)](),_0x5a421f=await staff[_0x518eef(0x2de)]({'email':_0x457ddf[_0x518eef(0x208)]}),_0x57cb5e=await suppliers[_0x518eef(0x203)]({});let _0x28d834;if(_0x457ddf[_0x518eef(0x2da)]=='staff'){const _0x5e4a5f=await staff['findOne']({'email':_0x457ddf['email']});_0x28d834=await warehouse[_0x518eef(0x265)]([{'$match':{'status':_0x518eef(0x212),'name':_0x5e4a5f[_0x518eef(0x230)],'warehouse_category':_0x518eef(0x25d),'name':{'$ne':_0x518eef(0x27f)}}},{'$group':{'_id':_0x518eef(0x2be),'name':{'$first':'$name'}}}]);}else _0x28d834=await warehouse['aggregate']([{'$match':{'status':_0x518eef(0x212),'warehouse_category':_0x518eef(0x25d),'name':{'$ne':_0x518eef(0x27f)}}},{'$group':{'_id':_0x518eef(0x2be),'name':{'$first':_0x518eef(0x2be)}}}]);const _0x5e95a6=await product['find']({}),_0x4f99aa=await warehouse[_0x518eef(0x203)]({'status':_0x518eef(0x212)}),_0xc3fc71=await purchases[_0x518eef(0x203)]({}),_0x2b45ec=_0xc3fc71['length']+0x1,_0x5eb4bd=_0x518eef(0x29c)+_0x2b45ec[_0x518eef(0x246)]()[_0x518eef(0x1fc)](0x5,'0');var _0x2fba23=[_0x518eef(0x22c),_0x518eef(0x2b1)];if(_0x26644c[0x0][_0x518eef(0x2c2)]==_0x518eef(0x26b))var _0xf7c5ef=users[_0x518eef(0x284)];else{if(_0x26644c[0x0]['language']=='Hindi')var _0xf7c5ef=users[_0x518eef(0x2a2)];else{if(_0x26644c[0x0]['language']==_0x518eef(0x247))var _0xf7c5ef=users[_0x518eef(0x247)];else{if(_0x26644c[0x0][_0x518eef(0x2c2)]==_0x518eef(0x232))var _0xf7c5ef=users[_0x518eef(0x232)];else{if(_0x26644c[0x0][_0x518eef(0x2c2)]=='French')var _0xf7c5ef=users[_0x518eef(0x28c)];else{if(_0x26644c[0x0][_0x518eef(0x2c2)]==_0x518eef(0x2c4))var _0xf7c5ef=users[_0x518eef(0x286)];else{if(_0x26644c[0x0]['language']=='Chinese')var _0xf7c5ef=users[_0x518eef(0x229)];else{if(_0x26644c[0x0]['language']==_0x518eef(0x30a))var _0xf7c5ef=users[_0x518eef(0x289)];}}}}}}}const _0x24d094=getRandom8DigitNumber();_0x24d094['then'](_0x203c9f=>{var _0x2e63c6=_0x518eef;_0xeaaa30['render'](_0x2e63c6(0x262),{'success':_0x4d3bf4[_0x2e63c6(0x2a6)](_0x2e63c6(0x2b5)),'errors':_0x4d3bf4[_0x2e63c6(0x2a6)]('errors'),'role':_0x457ddf,'profile':_0x4b6b0d,'suppliers':_0x57cb5e,'warehouse':_0x28d834,'product':_0x5e95a6,'invoice':_0x203c9f,'master_shop':_0x26644c,'language':_0xf7c5ef,'find_data':_0x4f99aa,'rooms_data':_0x2fba23});})[_0x518eef(0x224)](_0x4d58ac=>{var _0x21dab8=_0x518eef;_0x4d3bf4['flash'](_0x21dab8(0x2d8),_0x21dab8(0x2ff)),_0xeaaa30['redirect']('/all_purchases/view');});}catch(_0x19d77a){console[_0x518eef(0x2cb)](_0x19d77a);}}),router[a0_0x98235d(0x2e3)]('/view/add_purchases/:id',auth,async(_0x4d4305,_0x374c3d)=>{var _0x5a0b85=a0_0x98235d;try{const _0x139997=_0x4d4305['params']['id'];console[_0x5a0b85(0x2cb)](_0x139997);const _0x6e6f3d=await master_shop[_0x5a0b85(0x203)]();console[_0x5a0b85(0x2cb)](_0x5a0b85(0x202),_0x6e6f3d);const _0x215d9b=await product[_0x5a0b85(0x2de)]({'name':_0x139997});console['log'](_0x5a0b85(0x2d2),_0x215d9b),_0x374c3d[_0x5a0b85(0x23f)](0xc8)[_0x5a0b85(0x2f1)]({'product_data':_0x215d9b,'master':_0x6e6f3d});}catch(_0x3c760b){console['log'](_0x5a0b85(0x216),_0x3c760b);}}),router[a0_0x98235d(0x22f)]('/view/add_purchases',auth,async(_0x400c1c,_0x4750b3)=>{var _0x1c0ee0=a0_0x98235d;try{const {invoice:_0x5f1f2d,date:_0x38e1b0,warehouse_name:_0x3c0f7e,prod_name:_0xedc2e,prod_code:_0x7a60cd,prod_qty:_0x4a1625,prod_unit:_0x47810d,prod_secondunit:_0x29fa2a,prod_level:_0x13e330,prod_isle:_0x270306,prod_pallet:_0x29031a,note:_0x5f25ea,expiry_date:_0x40810e,batch_code:_0x52843d,payable:_0x23c667,due_amount:_0x42b24f,Room_name:_0x205ec6,primary_code:_0x5f2a0f,secondary_code:_0x49de4a,MaxStocks_data:_0x504630,PO_number:_0x207636,SCRN:_0xf277b4,JO_number:_0x1d957e}=_0x400c1c[_0x1c0ee0(0x22e)];if(typeof _0xedc2e==_0x1c0ee0(0x299))var _0x5ab73f=[_0x400c1c[_0x1c0ee0(0x22e)]['prod_name']],_0x4c0346=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x2ce)]],_0x13330c=[_0x400c1c['body'][_0x1c0ee0(0x1ff)]],_0x1d5fa6=[_0x400c1c['body'][_0x1c0ee0(0x268)]],_0x505998=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x21e)]],_0x513ffd=[_0x400c1c[_0x1c0ee0(0x22e)]['prod_level']],_0x30f56c=[_0x400c1c['body'][_0x1c0ee0(0x2e2)]],_0x6cb7d2=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x2e6)]],_0x529c71=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x251)]],_0x1709bc=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x20d)]],_0x12d5f0=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x25e)]],_0x339044=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x24f)]],_0x7a2695=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x301)]],_0x44a7ae=[_0x400c1c[_0x1c0ee0(0x22e)]['production_date']],_0x4f4c6c=[_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x287)]],_0x12251f=[_0x400c1c['body'][_0x1c0ee0(0x2f5)]],_0x33132a=[_0x400c1c['body'][_0x1c0ee0(0x226)]],_0x1cb387=[_0x400c1c[_0x1c0ee0(0x22e)]['prod_invoice']],_0x3bd508=[_0x400c1c[_0x1c0ee0(0x22e)]['actual_qty']],_0x2f8234=[_0x400c1c[_0x1c0ee0(0x22e)]['actual_uom']];else var _0x5ab73f=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x2a8)]],_0x4c0346=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x2ce)]],_0x13330c=[..._0x400c1c[_0x1c0ee0(0x22e)]['prod_Qty']],_0x1d5fa6=[..._0x400c1c['body'][_0x1c0ee0(0x268)]],_0x505998=[..._0x400c1c['body']['prod_secondunit']],_0x513ffd=[..._0x400c1c['body'][_0x1c0ee0(0x2c8)]],_0x30f56c=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x2e2)]],_0x6cb7d2=[..._0x400c1c['body']['secondary_code']],_0x529c71=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x251)]],_0x1709bc=[..._0x400c1c['body'][_0x1c0ee0(0x20d)]],_0x12d5f0=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x25e)]],_0x339044=[..._0x400c1c['body'][_0x1c0ee0(0x24f)]],_0x7a2695=[..._0x400c1c['body'][_0x1c0ee0(0x301)]],_0x44a7ae=[..._0x400c1c['body'][_0x1c0ee0(0x23d)]],_0x4f4c6c=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x287)]],_0x12251f=[..._0x400c1c['body'][_0x1c0ee0(0x2f5)]],_0x33132a=[..._0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x226)]],_0x1cb387=[..._0x400c1c['body'][_0x1c0ee0(0x2a1)]],_0x3bd508=[..._0x400c1c['body'][_0x1c0ee0(0x209)]],_0x2f8234=[..._0x400c1c[_0x1c0ee0(0x22e)]['actual_uom']];const _0x5645ba=_0x5ab73f[_0x1c0ee0(0x281)](_0x278bf4=>{return _0x278bf4={'product_name':_0x278bf4};});_0x3bd508[_0x1c0ee0(0x242)]((_0x2dd480,_0x256304)=>{var _0x6b4ceb=_0x1c0ee0;_0x5645ba[_0x256304][_0x6b4ceb(0x209)]=Math[_0x6b4ceb(0x24c)](_0x2dd480);}),_0x2f8234['forEach']((_0x3923a9,_0x4c8de1)=>{_0x5645ba[_0x4c8de1]['actual_uom']=_0x3923a9;}),_0x4c0346['forEach']((_0x27f4c1,_0x40ac6b)=>{_0x5645ba[_0x40ac6b]['product_code']=_0x27f4c1;}),_0x13330c[_0x1c0ee0(0x242)]((_0x568a48,_0x58b61e)=>{var _0x2652f9=_0x1c0ee0;_0x5645ba[_0x58b61e]['quantity']=Math[_0x2652f9(0x24c)](_0x568a48);}),_0x1d5fa6[_0x1c0ee0(0x242)]((_0x3a9750,_0x46cfef)=>{var _0x4aac45=_0x1c0ee0;_0x5645ba[_0x46cfef][_0x4aac45(0x2b0)]=_0x3a9750;}),_0x505998[_0x1c0ee0(0x242)]((_0x3ab277,_0x55c591)=>{var _0x373cb6=_0x1c0ee0;_0x5645ba[_0x55c591][_0x373cb6(0x2ca)]=_0x3ab277;}),_0x513ffd[_0x1c0ee0(0x242)]((_0x27cbf7,_0x35a7fe)=>{var _0x215d89=_0x1c0ee0;_0x12251f[_0x215d89(0x242)]((_0x53f470,_0x217b21)=>{var _0x439198=_0x215d89;if(_0x53f470==_0x439198(0x2f9)&&_0x35a7fe==_0x217b21){console[_0x439198(0x2cb)](_0x53f470+'\x20<\x20wew\x20>\x20'+_0x35a7fe+'\x20<>\x20'+_0x217b21+_0x439198(0x266)+_0x27cbf7);var _0x1e1d0a=_0x27cbf7[_0x439198(0x256)](0x3);_0x5645ba[_0x35a7fe][_0x439198(0x2e7)]=_0x27cbf7[0x0],_0x5645ba[_0x35a7fe][_0x439198(0x25c)]=_0x27cbf7[0x1],_0x5645ba[_0x35a7fe][_0x439198(0x219)]=0x0,_0x5645ba[_0x35a7fe][_0x439198(0x304)]=0x0,_0x5645ba[_0x35a7fe][_0x439198(0x201)]=_0x439198(0x2ea),_0x5645ba[_0x35a7fe]['floorlevel']=_0x1e1d0a;}else{if(_0x53f470==_0x439198(0x244)&&_0x35a7fe==_0x217b21){var _0x1e1d0a=_0x27cbf7[_0x439198(0x256)](0x3);_0x5645ba[_0x35a7fe][_0x439198(0x2e7)]=_0x27cbf7[0x0],_0x5645ba[_0x35a7fe][_0x439198(0x25c)]=_0x27cbf7[0x1],_0x5645ba[_0x35a7fe][_0x439198(0x219)]=0x0,_0x5645ba[_0x35a7fe][_0x439198(0x304)]=0x0,_0x5645ba[_0x35a7fe][_0x439198(0x201)]=_0x439198(0x2ea),_0x5645ba[_0x35a7fe][_0x439198(0x253)]=_0x27cbf7[0x5];}else{if(_0x35a7fe==_0x217b21){var _0x38df1e;if(_0x27cbf7[0x4]=='L')_0x38df1e=_0x439198(0x239);else _0x27cbf7[0x4]=='F'&&(_0x38df1e=_0x439198(0x2ea));_0x5645ba[_0x35a7fe]['storage']=_0x27cbf7[0x0],_0x5645ba[_0x35a7fe][_0x439198(0x25c)]=_0x27cbf7[0x1],_0x5645ba[_0x35a7fe]['bay']=_0x27cbf7[0x2],_0x5645ba[_0x35a7fe][_0x439198(0x304)]=_0x27cbf7[0x3],_0x5645ba[_0x35a7fe]['type']=_0x38df1e,_0x5645ba[_0x35a7fe][_0x439198(0x253)]=_0x27cbf7[0x5];}}}});}),_0x30f56c['forEach']((_0x3f1477,_0x54a20e)=>{var _0x2a5310=_0x1c0ee0;_0x5645ba[_0x54a20e][_0x2a5310(0x2e2)]=_0x3f1477;}),_0x6cb7d2['forEach']((_0x21a7d0,_0x39dd96)=>{_0x5645ba[_0x39dd96]['secondary_code']=_0x21a7d0;}),_0x529c71[_0x1c0ee0(0x242)]((_0xc6e830,_0x5a9441)=>{var _0x1ad6eb=_0x1c0ee0;_0x5645ba[_0x5a9441][_0x1ad6eb(0x231)]=_0xc6e830;}),_0x1709bc[_0x1c0ee0(0x242)]((_0x5209a9,_0x495fcc)=>{_0x5645ba[_0x495fcc]['batch_code']=_0x5209a9;}),_0x12d5f0['forEach']((_0x1a14ba,_0x2d3af4)=>{var _0x25b616=_0x1c0ee0;_0x5645ba[_0x2d3af4][_0x25b616(0x25e)]=_0x1a14ba;}),_0x339044[_0x1c0ee0(0x242)]((_0x32733d,_0x154eb2)=>{var _0x360c93=_0x1c0ee0;_0x5645ba[_0x154eb2][_0x360c93(0x2d4)]=_0x32733d;}),_0x7a2695[_0x1c0ee0(0x242)]((_0x325701,_0x2ecc75)=>{var _0x4968d5=_0x1c0ee0;_0x5645ba[_0x2ecc75][_0x4968d5(0x301)]=_0x325701;}),_0x44a7ae[_0x1c0ee0(0x242)]((_0x1ed823,_0x165177)=>{var _0x2e8651=_0x1c0ee0;_0x5645ba[_0x165177][_0x2e8651(0x23d)]=_0x1ed823;}),_0x4f4c6c[_0x1c0ee0(0x242)]((_0x110b48,_0x197f2b)=>{var _0x96a2ec=_0x1c0ee0;_0x5645ba[_0x197f2b][_0x96a2ec(0x2c0)]=_0x110b48;}),_0x12251f[_0x1c0ee0(0x242)]((_0xa0a134,_0x94eed)=>{var _0x577d27=_0x1c0ee0;_0x5645ba[_0x94eed][_0x577d27(0x2e1)]=_0xa0a134;}),_0x33132a[_0x1c0ee0(0x242)]((_0x4aeb40,_0x3be31b)=>{var _0x4ecaa1=_0x1c0ee0;_0x5645ba[_0x3be31b][_0x4ecaa1(0x2eb)]=_0x4aeb40;}),_0x1cb387['forEach']((_0x224ae8,_0xbf87b2)=>{var _0x5bcac5=_0x1c0ee0;_0x5645ba[_0xbf87b2][_0x5bcac5(0x2a9)]=_0x224ae8;});const _0x34ba08=_0x12251f[_0x1c0ee0(0x281)](_0xcb6402=>{return _0xcb6402={'room_name':_0xcb6402};}),_0x1517bf=_0x5645ba[_0x1c0ee0(0x210)](_0x36ca63=>_0x36ca63['quantity']!=='0'&&_0x36ca63['quantity']!==''),_0x441ba0=new purchases({'invoice':_0x5f1f2d,'suppliers':_0x400c1c[_0x1c0ee0(0x22e)][_0x1c0ee0(0x215)],'date':_0x38e1b0,'warehouse_name':_0x3c0f7e,'product':_0x1517bf,'note':_0x5f25ea,'due_amount':_0x42b24f,'POnumber':_0x207636,'SCRN':_0xf277b4,'JO_number':_0x1d957e,'roomList':_0x34ba08}),_0x20ed1d=await _0x441ba0[_0x1c0ee0(0x1f4)](),_0x35b9af=await purchases[_0x1c0ee0(0x2de)]({'invoice':_0x5f1f2d}),_0x1cd259=_0x35b9af['product'][_0x1c0ee0(0x281)](async _0x41bee1=>{var _0x3c4cd7=_0x1c0ee0,_0x374963=await warehouse[_0x3c4cd7(0x2de)]({'name':_0x3c0f7e,'room':_0x41bee1[_0x3c4cd7(0x2e1)]}),_0x1fcc31=0x0;return _0x374963[_0x3c4cd7(0x2aa)][_0x3c4cd7(0x242)](_0x558d16=>{var _0x301caf=_0x3c4cd7;_0x558d16[_0x301caf(0x255)]==_0x41bee1[_0x301caf(0x255)]&&_0x558d16[_0x301caf(0x253)]==_0x41bee1[_0x301caf(0x253)]&&_0x558d16[_0x301caf(0x201)]==_0x41bee1[_0x301caf(0x201)]&&_0x558d16[_0x301caf(0x304)]==_0x41bee1['bin']&&_0x558d16[_0x301caf(0x219)]==_0x41bee1[_0x301caf(0x219)]&&_0x558d16[_0x301caf(0x25c)]==_0x41bee1[_0x301caf(0x25c)]&&_0x558d16['storage']==_0x41bee1[_0x301caf(0x2e7)]&&_0x558d16[_0x301caf(0x25e)]==_0x41bee1['expiry_date']&&_0x558d16[_0x301caf(0x20d)]==_0x41bee1[_0x301caf(0x20d)]&&_0x558d16[_0x301caf(0x23d)]==_0x41bee1[_0x301caf(0x23d)]&&_0x558d16[_0x301caf(0x2a9)]==_0x35b9af['invoice']&&(_0x558d16[_0x301caf(0x206)]+=Math[_0x301caf(0x24c)](_0x41bee1[_0x301caf(0x25a)]),_0x1fcc31++);}),_0x1fcc31===0x0&&_0x374963['product_details'][_0x3c4cd7(0x305)]({'product_name':_0x41bee1['product_name'],'product_stock':Math[_0x3c4cd7(0x24c)](_0x41bee1[_0x3c4cd7(0x25a)]),'primary_code':_0x41bee1[_0x3c4cd7(0x2e2)],'secondary_code':_0x41bee1['secondary_code'],'product_code':_0x41bee1[_0x3c4cd7(0x1fd)],'storage':_0x41bee1[_0x3c4cd7(0x2e7)],'rack':_0x41bee1['rack'],'bay':_0x41bee1[_0x3c4cd7(0x219)],'bin':_0x41bee1[_0x3c4cd7(0x304)],'type':_0x41bee1[_0x3c4cd7(0x201)],'floorlevel':_0x41bee1[_0x3c4cd7(0x253)],'maxProducts':_0x41bee1[_0x3c4cd7(0x231)],'unit':_0x41bee1[_0x3c4cd7(0x2b0)],'secondary_unit':_0x41bee1[_0x3c4cd7(0x2ca)],'expiry_date':_0x41bee1[_0x3c4cd7(0x25e)],'maxPerUnit':_0x41bee1['maxperunit'],'batch_code':_0x41bee1['batch_code'],'alertQTY':_0x41bee1[_0x3c4cd7(0x301)],'production_date':_0x41bee1[_0x3c4cd7(0x23d)],'product_cat':_0x41bee1['product_cat'],'invoice':_0x41bee1[_0x3c4cd7(0x2a9)],'actual_qty':Math['abs'](_0x41bee1[_0x3c4cd7(0x209)]),'actual_uom':_0x41bee1[_0x3c4cd7(0x25f)]}),_0x374963;});Promise[_0x1c0ee0(0x207)](_0x1cd259)[_0x1c0ee0(0x234)](async _0x154d5e=>{var _0x43065c=_0x1c0ee0;try{for(const _0x587cc8 of _0x154d5e){await _0x587cc8['save']();}const _0x265c67=await master_shop['find'](),_0x3cc337=await email_settings[_0x43065c(0x2de)](),_0x147cfa=await supervisor_settings[_0x43065c(0x203)]();var _0x4b202f=_0x35b9af['product'],_0x524e05='',_0x21daa0;for(_0x21daa0 in _0x4b202f){_0x524e05+=_0x43065c(0x307)+_0x43065c(0x21d)+_0x4b202f[_0x21daa0][_0x43065c(0x255)]+'</td>'+_0x43065c(0x21d)+_0x4b202f[_0x21daa0][_0x43065c(0x1fd)]+_0x43065c(0x261)+_0x43065c(0x21d)+_0x4b202f[_0x21daa0][_0x43065c(0x25a)]+_0x43065c(0x261)+_0x43065c(0x21d)+_0x4b202f[_0x21daa0][_0x43065c(0x2b0)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b202f[_0x21daa0][_0x43065c(0x2ca)]+_0x43065c(0x261)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35b9af['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b202f[_0x21daa0][_0x43065c(0x2e1)]+_0x43065c(0x261)+_0x43065c(0x21d)+_0x4b202f[_0x21daa0][_0x43065c(0x2e7)]+_0x4b202f[_0x21daa0][_0x43065c(0x25c)]+_0x4b202f[_0x21daa0]['bay']+_0x4b202f[_0x21daa0][_0x43065c(0x304)]+_0x4b202f[_0x21daa0][_0x43065c(0x201)][0x0]+_0x4b202f[_0x21daa0][_0x43065c(0x253)]+_0x43065c(0x261),'</tr>';}let _0x46dca3=nodemailer['createTransport']({'host':_0x3cc337[_0x43065c(0x21c)],'port':Number(_0x3cc337[_0x43065c(0x250)]),'secure':![],'auth':{'user':_0x3cc337[_0x43065c(0x208)],'pass':_0x3cc337[_0x43065c(0x275)]}}),_0x3b0b60={'from':_0x3cc337[_0x43065c(0x208)],'to':_0x147cfa[0x0][_0x43065c(0x204)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x43065c(0x24e),'path':__dirname+_0x43065c(0x2b7)+'/upload/'+_0x265c67[0x0][_0x43065c(0x24d)],'cid':_0x43065c(0x241)}],'html':_0x43065c(0x294)+_0x43065c(0x26a)+_0x43065c(0x20e)+_0x43065c(0x302)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x43065c(0x2ba)+_0x43065c(0x28f)+'<div>'+'<h2>\x20'+_0x265c67[0x0][_0x43065c(0x295)]+'\x20</h2>'+_0x43065c(0x28f)+_0x43065c(0x28f)+_0x43065c(0x2b2)+_0x43065c(0x302)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x43065c(0x25b)+_0x35b9af[_0x43065c(0x2a9)]+'\x20'+_0x43065c(0x27d)+_0x43065c(0x205)+_0x35b9af[_0x43065c(0x2e0)]+'\x20'+'</span>'+_0x43065c(0x2c9)+_0x43065c(0x28f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x43065c(0x2d1)+_0x43065c(0x307)+_0x43065c(0x1f3)+_0x43065c(0x200)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x43065c(0x225)+_0x43065c(0x2ec)+_0x43065c(0x27e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x43065c(0x296)+_0x43065c(0x277)+'</thead>'+_0x43065c(0x254)+'\x20'+_0x524e05+'\x20'+_0x43065c(0x257)+_0x43065c(0x235)+_0x43065c(0x302)+'<strong>\x20Regards\x20</strong>'+_0x43065c(0x29f)+_0x265c67[0x0][_0x43065c(0x295)]+_0x43065c(0x2c9)+'</div>'+_0x43065c(0x28f)+_0x43065c(0x1fa)};_0x46dca3[_0x43065c(0x1f1)](_0x3b0b60,function(_0x273d2d,_0x4a32eb){var _0x983684=_0x43065c;_0x273d2d?(console[_0x983684(0x2cb)](_0x273d2d),console[_0x983684(0x2cb)](_0x983684(0x298))):console['log'](_0x983684(0x24a));}),_0x400c1c[_0x43065c(0x2a6)](_0x43065c(0x2b5),_0x43065c(0x23a)),_0x4750b3[_0x43065c(0x2db)](_0x43065c(0x1fe));}catch(_0x3f1286){console[_0x43065c(0x297)](_0x3f1286),_0x4750b3[_0x43065c(0x23f)](0x1f4)[_0x43065c(0x2f1)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x1c0ee0(0x224)](_0x381d9b=>{var _0x1f4f25=_0x1c0ee0;console[_0x1f4f25(0x297)](_0x381d9b),_0x4750b3['status'](0x1f4)[_0x1f4f25(0x2f1)]({'error':_0x1f4f25(0x23c)});});}catch(_0x1aef43){console['log'](_0x1aef43);}}),router[a0_0x98235d(0x2e3)]('/preview/:id',auth,async(_0x448238,_0x32c6c6)=>{var _0xff2bae=a0_0x98235d;try{const {username:_0x2071a2,email:_0x27ddb4,role:_0x4ab04a}=_0x448238[_0xff2bae(0x2a7)],_0x560fba=_0x448238['user'],_0x413eb6=await profile[_0xff2bae(0x2de)]({'email':_0x560fba['email']}),_0x5f5258=await master_shop[_0xff2bae(0x203)](),_0x25c7ac=_0x448238[_0xff2bae(0x260)]['id'],_0x244e3b=await purchases[_0xff2bae(0x267)](_0x25c7ac),_0x2935d4=await warehouse[_0xff2bae(0x265)]([{'$match':{'name':_0x244e3b['warehouse_name'],'room':_0x244e3b[_0xff2bae(0x2fe)]}},{'$unwind':_0xff2bae(0x2e9)},{'$group':{'_id':_0xff2bae(0x248),'name':{'$first':_0xff2bae(0x2f3)},'product_stock':{'$first':_0xff2bae(0x240)},'bay':{'$first':_0xff2bae(0x259)},'bin':{'$first':_0xff2bae(0x227)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xff2bae(0x233)},'product_code':{'$first':_0xff2bae(0x271)},'storage':{'$first':_0xff2bae(0x27c)},'rack':{'$first':_0xff2bae(0x237)},'expiry_date':{'$first':_0xff2bae(0x1f7)}}}]),_0x1824bd=await customer[_0xff2bae(0x203)]({});let _0x5eec8f;if(_0x560fba[_0xff2bae(0x2da)]=='staff'){const _0x3f7d3a=await staff[_0xff2bae(0x2de)]({'email':_0x560fba['email']});_0x5eec8f=await warehouse[_0xff2bae(0x265)]([{'$match':{'status':_0xff2bae(0x212),'name':_0x3f7d3a[_0xff2bae(0x230)]}},{'$group':{'_id':_0xff2bae(0x2be),'name':{'$first':_0xff2bae(0x2be)}}}]);}else _0x5eec8f=await warehouse['aggregate']([{'$match':{'status':_0xff2bae(0x212)}},{'$group':{'_id':_0xff2bae(0x2be),'name':{'$first':_0xff2bae(0x2be)}}}]);const _0x3bb8ad=await product[_0xff2bae(0x203)]({}),_0x40ed46=await suppliers['find']({}),_0x1b9ebc=BayBinSelected(_0x244e3b['warehouse_name'],_0x244e3b['room']);if(_0x5f5258[0x0]['language']==_0xff2bae(0x26b)){var _0x27a5ea=users[_0xff2bae(0x284)];console[_0xff2bae(0x2cb)](_0x27a5ea);}else{if(_0x5f5258[0x0][_0xff2bae(0x2c2)]=='Hindi')var _0x27a5ea=users[_0xff2bae(0x2a2)];else{if(_0x5f5258[0x0][_0xff2bae(0x2c2)]==_0xff2bae(0x247))var _0x27a5ea=users[_0xff2bae(0x247)];else{if(_0x5f5258[0x0]['language']==_0xff2bae(0x232))var _0x27a5ea=users[_0xff2bae(0x232)];else{if(_0x5f5258[0x0]['language']=='French')var _0x27a5ea=users[_0xff2bae(0x28c)];else{if(_0x5f5258[0x0][_0xff2bae(0x2c2)]=='Portuguese\x20(BR)')var _0x27a5ea=users[_0xff2bae(0x286)];else{if(_0x5f5258[0x0][_0xff2bae(0x2c2)]==_0xff2bae(0x229))var _0x27a5ea=users[_0xff2bae(0x229)];else{if(_0x5f5258[0x0][_0xff2bae(0x2c2)]==_0xff2bae(0x30a))var _0x27a5ea=users['Arabic'];}}}}}}}_0x32c6c6[_0xff2bae(0x2d0)](_0xff2bae(0x24b),{'success':_0x448238[_0xff2bae(0x2a6)](_0xff2bae(0x2b5)),'errors':_0x448238['flash']('errors'),'role':_0x560fba,'profile':_0x413eb6,'customer':_0x1824bd,'warehouse':_0x5eec8f,'product':_0x2935d4,'user':_0x244e3b,'master_shop':_0x5f5258,'unit':_0x3bb8ad,'language':_0x27a5ea,'suppliers':_0x40ed46,'dataSelected':_0x1b9ebc});}catch(_0xd537ec){console['log'](_0xd537ec);}}),router[a0_0x98235d(0x22f)](a0_0x98235d(0x285),auth,async(_0x3030e2,_0x59412d)=>{var _0x11f4b4=a0_0x98235d;try{const _0x5246c4=_0x3030e2[_0x11f4b4(0x260)]['id'],{invoice:_0x3c0d78,warehouse_name:_0x2cf015,Room_name:_0x184123}=_0x3030e2[_0x11f4b4(0x22e)],_0x2232e3=await warehouse[_0x11f4b4(0x2de)]({'name':_0x2cf015,'room':_0x184123}),_0x4a6e8b=await purchases['findOne']({'invoice':_0x3c0d78});_0x4a6e8b[_0x11f4b4(0x2d2)][_0x11f4b4(0x242)](_0x679438=>{var _0x19d465=_0x11f4b4,_0x1941b8=0x0;const _0x5ac3fc=_0x2232e3[_0x19d465(0x2aa)]['map'](_0x4e1903=>{var _0x4f2373=_0x19d465;_0x4e1903[_0x4f2373(0x255)]==_0x679438['product_name']&&_0x4e1903[_0x4f2373(0x253)]==_0x679438[_0x4f2373(0x253)]&&_0x4e1903[_0x4f2373(0x201)]==_0x679438['type']&&_0x4e1903['bin']==_0x679438[_0x4f2373(0x304)]&&_0x4e1903[_0x4f2373(0x219)]==_0x679438[_0x4f2373(0x219)]&&_0x4e1903[_0x4f2373(0x25c)]==_0x679438[_0x4f2373(0x25c)]&&_0x4e1903[_0x4f2373(0x2e7)]==_0x679438[_0x4f2373(0x2e7)]&&_0x4e1903['expiry_date']==_0x679438['expiry_date']&&_0x4e1903[_0x4f2373(0x20d)]==_0x679438[_0x4f2373(0x20d)]&&_0x4e1903['production_date']==_0x679438[_0x4f2373(0x23d)]&&_0x4e1903[_0x4f2373(0x2f6)]==_0x679438[_0x4f2373(0x2f6)]&&_0x4e1903[_0x4f2373(0x2eb)]==_0x679438[_0x4f2373(0x2eb)]&&(_0x4e1903[_0x4f2373(0x206)]=parseInt(_0x4e1903['product_stock'])+parseInt(_0x679438['quantity']),_0x1941b8++);});_0x1941b8=='0'&&(_0x2232e3['product_details']=_0x2232e3[_0x19d465(0x2aa)][_0x19d465(0x300)]({'product_name':_0x679438[_0x19d465(0x255)],'product_stock':_0x679438[_0x19d465(0x25a)],'primary_code':_0x679438[_0x19d465(0x2e2)],'secondary_code':_0x679438[_0x19d465(0x2e6)],'product_code':_0x679438['product_code'],'storage':_0x679438[_0x19d465(0x2e7)],'rack':_0x679438[_0x19d465(0x25c)],'bay':_0x679438[_0x19d465(0x219)],'bin':_0x679438[_0x19d465(0x304)],'type':_0x679438[_0x19d465(0x201)],'floorlevel':_0x679438[_0x19d465(0x253)],'maxProducts':_0x679438[_0x19d465(0x231)],'unit':_0x679438['standard_unit'],'secondary_unit':_0x679438['secondary_unit'],'expiry_date':_0x679438[_0x19d465(0x25e)],'maxPerUnit':_0x679438[_0x19d465(0x2d4)],'batch_code':_0x679438[_0x19d465(0x20d)],'alertQTY':_0x679438[_0x19d465(0x301)],'production_date':_0x679438['production_date'],'delivery_date':_0x679438[_0x19d465(0x2f6)],'delivery_code':_0x679438[_0x19d465(0x2eb)]}));}),await _0x2232e3['save'](),_0x4a6e8b[_0x11f4b4(0x280)]=_0x11f4b4(0x2b3);const _0xb62a07=await _0x4a6e8b[_0x11f4b4(0x1f4)]();_0x3030e2[_0x11f4b4(0x2a6)](_0x11f4b4(0x2b5),_0x11f4b4(0x2d5)),_0x59412d['redirect'](_0x11f4b4(0x2cc));}catch(_0x19120e){console[_0x11f4b4(0x2cb)](_0x19120e);}}),router['get'](a0_0x98235d(0x1ed),auth,async(_0x284ee5,_0x394d8f)=>{var _0x2252a9=a0_0x98235d;try{const {username:_0xbbf082,email:_0x2f5968,role:_0x4c423d}=_0x284ee5[_0x2252a9(0x2a7)],_0x43ceb8=_0x284ee5[_0x2252a9(0x2a7)],_0x401d87=await profile[_0x2252a9(0x2de)]({'email':_0x43ceb8[_0x2252a9(0x208)]}),_0x390f19=await master_shop[_0x2252a9(0x203)](),_0xcc94f1=_0x284ee5['params']['id'],_0x13fe53=await purchases[_0x2252a9(0x267)](_0xcc94f1),_0x6e10c7=await suppliers[_0x2252a9(0x203)]({});let _0x2cdb7a;if(_0x43ceb8[_0x2252a9(0x2da)]==_0x2252a9(0x1ee)){const _0x545b17=await staff['findOne']({'email':_0x43ceb8[_0x2252a9(0x208)]});_0x2cdb7a=await warehouse['find']({'status':_0x2252a9(0x212),'name':_0x545b17[_0x2252a9(0x230)],'warehouse_category':_0x2252a9(0x25d)});}else _0x2cdb7a=await warehouse[_0x2252a9(0x265)]([{'$match':{'status':_0x2252a9(0x212),'warehouse_category':_0x2252a9(0x25d)}},{'$group':{'_id':_0x2252a9(0x2be),'name':{'$first':_0x2252a9(0x2be)}}}]);const _0x2203a4=await product[_0x2252a9(0x203)]({}),_0x5ba2ab=BayBinSelected(_0x13fe53['warehouse_name'],_0x13fe53[_0x2252a9(0x2fe)]);let _0x1768f9=new Date(_0x13fe53[_0x2252a9(0x25e)]),_0x161dbe=('0'+_0x1768f9[_0x2252a9(0x21b)]())[_0x2252a9(0x256)](-0x2),_0x4c2a53=('0'+(_0x1768f9[_0x2252a9(0x2a4)]()+0x1))['slice'](-0x2),_0x5a199b=_0x1768f9['getFullYear'](),_0x1e3411=_0x5a199b+'-'+_0x4c2a53+'-'+_0x161dbe;if(_0x390f19[0x0][_0x2252a9(0x2c2)]==_0x2252a9(0x26b)){var _0x5a7d08=users[_0x2252a9(0x284)];console[_0x2252a9(0x2cb)](_0x5a7d08);}else{if(_0x390f19[0x0]['language']==_0x2252a9(0x2a2))var _0x5a7d08=users[_0x2252a9(0x2a2)];else{if(_0x390f19[0x0][_0x2252a9(0x2c2)]==_0x2252a9(0x247))var _0x5a7d08=users[_0x2252a9(0x247)];else{if(_0x390f19[0x0][_0x2252a9(0x2c2)]==_0x2252a9(0x232))var _0x5a7d08=users['Spanish'];else{if(_0x390f19[0x0][_0x2252a9(0x2c2)]==_0x2252a9(0x28c))var _0x5a7d08=users[_0x2252a9(0x28c)];else{if(_0x390f19[0x0]['language']==_0x2252a9(0x2c4))var _0x5a7d08=users['Portuguese'];else{if(_0x390f19[0x0][_0x2252a9(0x2c2)]==_0x2252a9(0x229))var _0x5a7d08=users[_0x2252a9(0x229)];else{if(_0x390f19[0x0]['language']=='Arabic\x20(ae)')var _0x5a7d08=users[_0x2252a9(0x289)];}}}}}}}_0x394d8f[_0x2252a9(0x2d0)](_0x2252a9(0x2d9),{'success':_0x284ee5[_0x2252a9(0x2a6)](_0x2252a9(0x2b5)),'errors':_0x284ee5[_0x2252a9(0x2a6)]('errors'),'role':_0x43ceb8,'profile':_0x401d87,'purchases':_0x13fe53,'suppliers':_0x6e10c7,'warehouse':_0x2cdb7a,'product':_0x2203a4,'master_shop':_0x390f19,'language':_0x5a7d08,'ed_fullDate':_0x1e3411,'dataSelected':_0x5ba2ab});}catch(_0x5cf25f){console['log'](_0x5cf25f);}}),router[a0_0x98235d(0x22f)](a0_0x98235d(0x1ed),auth,async(_0x1cf301,_0x58224c)=>{var _0x440af2=a0_0x98235d;try{const _0x3b4f64=_0x1cf301[_0x440af2(0x260)]['id'],_0xc6b33d=await purchases[_0x440af2(0x2de)]({'_id':_0x1cf301[_0x440af2(0x260)]['id']}),_0x4f8d67=await warehouse[_0x440af2(0x2de)]({'name':_0xc6b33d[_0x440af2(0x21f)],'room':_0xc6b33d[_0x440af2(0x2fe)]});_0xc6b33d['product']['forEach'](_0x4d4891=>{var _0x3f77a0=_0x440af2;const _0x4832e9=_0x4f8d67[_0x3f77a0(0x2aa)]['map'](_0x4402f4=>{var _0x40b591=_0x3f77a0;_0x4402f4[_0x40b591(0x255)]==_0x4d4891[_0x40b591(0x255)]&&_0x4402f4[_0x40b591(0x253)]==_0x4d4891[_0x40b591(0x253)]&&_0x4402f4[_0x40b591(0x201)]==_0x4d4891['type']&&_0x4402f4[_0x40b591(0x304)]==_0x4d4891[_0x40b591(0x304)]&&_0x4402f4[_0x40b591(0x219)]==_0x4d4891[_0x40b591(0x219)]&&_0x4402f4[_0x40b591(0x25c)]==_0x4d4891['rack']&&_0x4402f4[_0x40b591(0x2e7)]==_0x4d4891[_0x40b591(0x2e7)]&&(_0x4402f4[_0x40b591(0x206)]=parseInt(_0x4402f4[_0x40b591(0x206)])-parseInt(_0x4d4891['quantity']));});}),await _0x4f8d67[_0x440af2(0x1f4)]();const {invoice:_0xca0027,suppliers:_0x3e112d,date:_0x2f1001,warehouse_name:_0x293ea2,prod_name:_0x514a59,prod_code:_0x4ad545,prod_qty:_0x3dce62,prod_unit:_0x4c434f,prod_secondunit:_0x4a227d,prod_level:_0x5a7216,prod_isle:_0x243a6c,prod_pallet:_0x1b5cb8,note:_0x365a35,expiry_date:_0x59491e,batch_code:_0x11145b,paid_amount:_0x22949d,due_amount:_0x154fc4,Room_name:_0x1df21,primary_code:_0x5034db,secondary_code:_0x557cb2,PO_number:_0x228a22,JO_number:_0x21d78f}=_0x1cf301[_0x440af2(0x22e)];if(typeof _0x514a59==_0x440af2(0x299))var _0x1ea2aa=[_0x1cf301[_0x440af2(0x22e)]['prod_name']],_0x2c761d=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2ce)]],_0x139576=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x236)]],_0x17fe0b=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2df)]],_0x1f1cff=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x21e)]],_0xd1426e=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2c8)]],_0x3d01af=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x306)]],_0x3216b4=[_0x1cf301[_0x440af2(0x22e)]['prod_pallet']],_0x3a6fa2=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2e2)]],_0x42c6a6=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2e6)]],_0x3386a7=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x251)]],_0xa45554=[_0x1cf301['body'][_0x440af2(0x20d)]],_0x2c1906=[_0x1cf301['body'][_0x440af2(0x25e)]],_0x84fdfb=[_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2e7)]],_0xea364=[_0x1cf301['body'][_0x440af2(0x28e)]],_0x3fc010=[_0x1cf301[_0x440af2(0x22e)]['type']];else var _0x1ea2aa=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2a8)]],_0x2c761d=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2ce)]],_0x139576=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x236)]],_0x17fe0b=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2df)]],_0x1f1cff=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x21e)]],_0xd1426e=[..._0x1cf301[_0x440af2(0x22e)]['prod_level']],_0x3d01af=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x306)]],_0x3216b4=[..._0x1cf301['body']['prod_pallet']],_0x3a6fa2=[..._0x1cf301['body'][_0x440af2(0x2e2)]],_0x42c6a6=[..._0x1cf301[_0x440af2(0x22e)]['secondary_code']],_0x3386a7=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x251)]],_0xa45554=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x20d)]],_0x2c1906=[..._0x1cf301[_0x440af2(0x22e)][_0x440af2(0x25e)]],_0x84fdfb=[..._0x1cf301[_0x440af2(0x22e)]['storage']],_0xea364=[..._0x1cf301['body'][_0x440af2(0x28e)]],_0x3fc010=[..._0x1cf301[_0x440af2(0x22e)]['type']];const _0x2c0947=_0x1ea2aa[_0x440af2(0x281)](_0x4369bc=>{return _0x4369bc={'product_name':_0x4369bc};});_0x2c761d[_0x440af2(0x242)]((_0xe829e3,_0x248ea0)=>{var _0x490f8b=_0x440af2;_0x2c0947[_0x248ea0][_0x490f8b(0x1fd)]=_0xe829e3;}),_0x139576[_0x440af2(0x242)]((_0x35d448,_0x5f02d9)=>{var _0x18ae41=_0x440af2;_0x2c0947[_0x5f02d9][_0x18ae41(0x25a)]=_0x35d448;}),_0x17fe0b[_0x440af2(0x242)]((_0x1d0755,_0x2be92c)=>{var _0x29b34a=_0x440af2;_0x2c0947[_0x2be92c][_0x29b34a(0x2b0)]=_0x1d0755;}),_0x1f1cff['forEach']((_0x434945,_0x33704c)=>{var _0x180cef=_0x440af2;_0x2c0947[_0x33704c][_0x180cef(0x2ca)]=_0x434945;}),_0xd1426e[_0x440af2(0x242)]((_0x1c31b2,_0x5a25ae)=>{var _0x2c0476=_0x440af2;_0x2c0947[_0x5a25ae][_0x2c0476(0x219)]=_0x1c31b2;}),_0x3d01af[_0x440af2(0x242)]((_0xdd2bcc,_0x168b65)=>{var _0x4a5a36=_0x440af2;_0x2c0947[_0x168b65][_0x4a5a36(0x304)]=_0xdd2bcc;}),_0x3216b4[_0x440af2(0x242)]((_0x17b954,_0x517535)=>{var _0x566346=_0x440af2;_0x2c0947[_0x517535][_0x566346(0x253)]=_0x17b954;}),_0x3a6fa2[_0x440af2(0x242)]((_0x4a47cf,_0x54a631)=>{var _0x41cec0=_0x440af2;_0x2c0947[_0x54a631][_0x41cec0(0x2e2)]=_0x4a47cf;}),_0x42c6a6[_0x440af2(0x242)]((_0x471040,_0x163496)=>{var _0x378eba=_0x440af2;_0x2c0947[_0x163496][_0x378eba(0x2e6)]=_0x471040;}),_0x3386a7[_0x440af2(0x242)]((_0x3353c6,_0x17b8c9)=>{var _0xcb1f64=_0x440af2;_0x2c0947[_0x17b8c9][_0xcb1f64(0x231)]=_0x3353c6;}),_0xa45554[_0x440af2(0x242)]((_0xdf885,_0xe4b946)=>{var _0x10486a=_0x440af2;_0x2c0947[_0xe4b946][_0x10486a(0x20d)]=_0xdf885;}),_0x2c1906[_0x440af2(0x242)]((_0xf34450,_0x4784f5)=>{_0x2c0947[_0x4784f5]['expiry_date']=_0xf34450;}),_0x3fc010[_0x440af2(0x242)]((_0x2d2433,_0x1e6a5a)=>{var _0x20d8f9=_0x440af2;_0x2c0947[_0x1e6a5a][_0x20d8f9(0x201)]=_0x2d2433;}),_0x84fdfb[_0x440af2(0x242)]((_0x2228ab,_0x486d45)=>{_0x2c0947[_0x486d45]['storage']=_0x2228ab;}),_0xea364[_0x440af2(0x242)]((_0x4ee9ce,_0x108576)=>{_0x2c0947[_0x108576]['rack']=_0x4ee9ce;});const _0x471182=_0x2c0947[_0x440af2(0x210)](_0xef8882=>_0xef8882[_0x440af2(0x25a)]!=='0'&&_0xef8882[_0x440af2(0x25a)]!=='');_0xc6b33d[_0x440af2(0x2a9)]=_0xca0027,_0xc6b33d[_0x440af2(0x215)]=_0x3e112d,_0xc6b33d['date']=_0x2f1001,_0xc6b33d[_0x440af2(0x21f)]=_0x293ea2,_0xc6b33d['product']=_0x471182,_0xc6b33d[_0x440af2(0x2c3)]=_0x365a35,_0xc6b33d[_0x440af2(0x23e)]=_0x22949d,_0xc6b33d[_0x440af2(0x2ef)]=_0x154fc4,_0xc6b33d['room']=_0x1df21,_0xc6b33d[_0x440af2(0x23b)]=_0x228a22,_0xc6b33d[_0x440af2(0x20c)]=_0x21d78f;const _0x816827=await _0xc6b33d[_0x440af2(0x1f4)](),_0x14eda0=await warehouse['findOne']({'name':_0x1cf301[_0x440af2(0x22e)]['warehouse_name'],'room':_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x278)]});_0xc6b33d[_0x440af2(0x2d2)]['forEach'](_0x427f84=>{var _0x193439=_0x440af2,_0x452c09=0x0;const _0x34935e=_0x14eda0['product_details'][_0x193439(0x281)](_0x3b0e00=>{var _0x22792b=_0x193439;_0x3b0e00['product_name']==_0x427f84[_0x22792b(0x255)]&&_0x3b0e00[_0x22792b(0x253)]==_0x427f84[_0x22792b(0x253)]&&_0x3b0e00[_0x22792b(0x201)]==_0x427f84[_0x22792b(0x201)]&&_0x3b0e00[_0x22792b(0x304)]==_0x427f84[_0x22792b(0x304)]&&_0x3b0e00[_0x22792b(0x219)]==_0x427f84['bay']&&_0x3b0e00[_0x22792b(0x25c)]==_0x427f84[_0x22792b(0x25c)]&&_0x3b0e00[_0x22792b(0x2e7)]==_0x427f84[_0x22792b(0x2e7)]&&(_0x3b0e00['product_stock']=parseInt(_0x3b0e00[_0x22792b(0x206)])+parseInt(_0x427f84[_0x22792b(0x25a)]),_0x452c09++);});_0x452c09=='0'&&(_0x14eda0[_0x193439(0x2aa)]=_0x14eda0[_0x193439(0x2aa)][_0x193439(0x300)]({'product_name':_0x427f84[_0x193439(0x255)],'product_stock':_0x427f84[_0x193439(0x25a)],'primary_code':_0x427f84[_0x193439(0x2e2)],'secondary_code':_0x427f84[_0x193439(0x2e6)],'product_code':_0x427f84[_0x193439(0x1fd)],'storage':_0x427f84[_0x193439(0x2e7)],'rack':_0x427f84['rack'],'bay':_0x427f84[_0x193439(0x219)],'bin':_0x427f84[_0x193439(0x304)],'type':_0x427f84[_0x193439(0x201)],'floorlevel':_0x427f84[_0x193439(0x253)],'maxProducts':_0x427f84[_0x193439(0x231)],'unit':_0x427f84['standard_unit'],'secondary_unit':_0x427f84[_0x193439(0x2ca)],'expiry_date':_0x427f84['expiry_date']}));}),await _0x14eda0['save']();const _0x1b484e=await s_payment_data['findOne']({'invoice':_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2a9)]});if(_0x1b484e===null){}else console[_0x440af2(0x2cb)](_0x440af2(0x215),_0x1b484e,_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x2a9)]),_0x1b484e[_0x440af2(0x215)]=_0x1cf301[_0x440af2(0x22e)][_0x440af2(0x215)],await _0x1b484e[_0x440af2(0x1f4)]();_0x1cf301[_0x440af2(0x2a6)](_0x440af2(0x2b5),'purchase\x20data\x20update\x20successfully'),_0x58224c[_0x440af2(0x2db)](_0x440af2(0x2cc));}catch(_0x142b00){console[_0x440af2(0x2cb)](_0x142b00);}}),router['post']('/give_payment/:id',auth,async(_0x4315c6,_0x5f4ce3)=>{var _0x171dc8=a0_0x98235d;try{const _0x599ac3=_0x4315c6[_0x171dc8(0x260)]['id'],{invoice:_0x51a60d,suppliers:_0x33d510,payable:_0x13e740,due_amount:_0x2a1cf0}=_0x4315c6[_0x171dc8(0x22e)],_0xb1779=await purchases['findById'](_0x599ac3);var _0x3bfbbe=_0x13e740-_0x2a1cf0;_0xb1779[_0x171dc8(0x23e)]=parseFloat(_0xb1779[_0x171dc8(0x23e)])+parseFloat(_0x2a1cf0),_0xb1779[_0x171dc8(0x2ef)]=_0x3bfbbe;const _0x3192b9=await _0xb1779[_0x171dc8(0x1f4)]();console[_0x171dc8(0x2cb)](_0x3192b9);const _0x44e409=await s_payment_data[_0x171dc8(0x2de)]({'invoice':_0x51a60d});_0x44e409[_0x171dc8(0x2f8)]=_0x3bfbbe,await _0x44e409[_0x171dc8(0x1f4)]();let _0x16bd87=new Date(),_0x34cfb3=('0'+_0x16bd87[_0x171dc8(0x21b)]())['slice'](-0x2),_0xc0859f=('0'+(_0x16bd87[_0x171dc8(0x2a4)]()+0x1))[_0x171dc8(0x256)](-0x2),_0x19a68e=_0x16bd87['getFullYear'](),_0x3540d5=_0x19a68e+'-'+_0xc0859f+'-'+_0x34cfb3;const _0x46f706=new suppliers_payment({'invoice':_0x51a60d,'date':_0x19a68e+'-'+_0xc0859f+'-'+_0x34cfb3,'suppliers':_0x33d510,'reason':_0x171dc8(0x2d7),'amount':_0x2a1cf0}),_0x221909=await _0x46f706[_0x171dc8(0x1f4)]();_0x4315c6[_0x171dc8(0x2a6)]('success',_0x171dc8(0x217)),_0x5f4ce3[_0x171dc8(0x2db)](_0x171dc8(0x2cc));}catch(_0x8a4ca8){console[_0x171dc8(0x2cb)](_0x8a4ca8);}}),router[a0_0x98235d(0x2e3)](a0_0x98235d(0x2f0),auth,async(_0x11961f,_0x33cb84)=>{var _0x2281f9=a0_0x98235d;try{const {username:_0x2d5406,email:_0x243f6e,role:_0x33fd04}=_0x11961f[_0x2281f9(0x2a7)],_0x2030d5=_0x11961f[_0x2281f9(0x2a7)],_0x507e96=await profile['findOne']({'email':_0x2030d5[_0x2281f9(0x208)]}),_0x1898e3=await master_shop[_0x2281f9(0x203)]();console['log'](_0x2281f9(0x202),_0x1898e3);const _0x302fbd=_0x11961f[_0x2281f9(0x260)]['id'],_0x20ac42=await purchases[_0x2281f9(0x267)](_0x302fbd);console[_0x2281f9(0x2cb)](_0x20ac42);const _0x37266a=await suppliers['findOne']({'name':_0x20ac42[_0x2281f9(0x215)]});console['log'](_0x37266a);if(_0x1898e3[0x0][_0x2281f9(0x2c2)]==_0x2281f9(0x26b)){var _0x39a454=users['English'];console[_0x2281f9(0x2cb)](_0x39a454);}else{if(_0x1898e3[0x0]['language']==_0x2281f9(0x2a2))var _0x39a454=users['Hindi'];else{if(_0x1898e3[0x0]['language']=='German')var _0x39a454=users[_0x2281f9(0x247)];else{if(_0x1898e3[0x0][_0x2281f9(0x2c2)]==_0x2281f9(0x232))var _0x39a454=users['Spanish'];else{if(_0x1898e3[0x0]['language']==_0x2281f9(0x28c))var _0x39a454=users[_0x2281f9(0x28c)];else{if(_0x1898e3[0x0]['language']==_0x2281f9(0x2c4))var _0x39a454=users[_0x2281f9(0x286)];else{if(_0x1898e3[0x0][_0x2281f9(0x2c2)]=='Chinese')var _0x39a454=users[_0x2281f9(0x229)];else{if(_0x1898e3[0x0][_0x2281f9(0x2c2)]==_0x2281f9(0x30a))var _0x39a454=users[_0x2281f9(0x289)];}}}}}}}_0x33cb84[_0x2281f9(0x2d0)]('purchase_invoice',{'success':_0x11961f[_0x2281f9(0x2a6)]('success'),'errors':_0x11961f[_0x2281f9(0x2a6)](_0x2281f9(0x2d8)),'role':_0x2030d5,'profile':_0x507e96,'master_shop':_0x1898e3,'supplier':_0x37266a,'purchase':_0x20ac42,'language':_0x39a454});}catch(_0x28a528){console[_0x2281f9(0x2cb)](_0x28a528);}}),router['get']('/view/return_purchase/:id',auth,async(_0x44c0e6,_0x48a115)=>{var _0x26e03d=a0_0x98235d;try{const {username:_0xa82f0b,email:_0x5a3d8a,role:_0x304c34}=_0x44c0e6[_0x26e03d(0x2a7)],_0x24469c=_0x44c0e6['user'],_0x3dbd13=await profile[_0x26e03d(0x2de)]({'email':_0x24469c[_0x26e03d(0x208)]}),_0x5aaf83=await master_shop[_0x26e03d(0x203)]();console[_0x26e03d(0x2cb)](_0x26e03d(0x202),_0x5aaf83);const _0x30bf00=_0x44c0e6[_0x26e03d(0x260)]['id'];console[_0x26e03d(0x2cb)](_0x30bf00);const _0x528f17=await purchases['findById'](_0x30bf00);console[_0x26e03d(0x2cb)](_0x26e03d(0x228),_0x528f17);const _0x46df45=await product[_0x26e03d(0x203)]({}),_0x1472b2=await warehouse[_0x26e03d(0x265)]([{'$match':{'name':_0x528f17[_0x26e03d(0x21f)],'room':_0x528f17['room'],'warehouse_category':_0x26e03d(0x25d)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x26e03d(0x248),'name':{'$first':_0x26e03d(0x2f3)},'product_stock':{'$first':_0x26e03d(0x240)},'bay':{'$first':_0x26e03d(0x259)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x26e03d(0x2bb)},'floorlevel':{'$first':_0x26e03d(0x2b4)},'primary_code':{'$first':_0x26e03d(0x264)},'secondary_code':{'$first':_0x26e03d(0x233)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x26e03d(0x27c)},'rack':{'$first':_0x26e03d(0x237)}}}]);warehouse_data=await warehouse[_0x26e03d(0x265)]([{'$match':{'status':'Enabled','name':_0x26e03d(0x27f),'warehouse_category':_0x26e03d(0x25d)}},{'$group':{'_id':'$name','name':{'$first':_0x26e03d(0x2be)}}},{'$sort':{'name':0x1}}]),console[_0x26e03d(0x2cb)](_0x26e03d(0x2fa),_0x1472b2);if(_0x5aaf83[0x0][_0x26e03d(0x2c2)]==_0x26e03d(0x26b)){var _0x5a4b98=users[_0x26e03d(0x284)];console[_0x26e03d(0x2cb)](_0x5a4b98);}else{if(_0x5aaf83[0x0][_0x26e03d(0x2c2)]==_0x26e03d(0x2a2))var _0x5a4b98=users['Hindi'];else{if(_0x5aaf83[0x0]['language']==_0x26e03d(0x247))var _0x5a4b98=users['German'];else{if(_0x5aaf83[0x0]['language']=='Spanish')var _0x5a4b98=users[_0x26e03d(0x232)];else{if(_0x5aaf83[0x0]['language']==_0x26e03d(0x28c))var _0x5a4b98=users[_0x26e03d(0x28c)];else{if(_0x5aaf83[0x0][_0x26e03d(0x2c2)]=='Portuguese\x20(BR)')var _0x5a4b98=users[_0x26e03d(0x286)];else{if(_0x5aaf83[0x0][_0x26e03d(0x2c2)]==_0x26e03d(0x229))var _0x5a4b98=users['Chinese'];else{if(_0x5aaf83[0x0][_0x26e03d(0x2c2)]=='Arabic\x20(ae)')var _0x5a4b98=users[_0x26e03d(0x289)];}}}}}}}_0x48a115[_0x26e03d(0x2d0)](_0x26e03d(0x223),{'success':_0x44c0e6[_0x26e03d(0x2a6)](_0x26e03d(0x2b5)),'errors':_0x44c0e6[_0x26e03d(0x2a6)](_0x26e03d(0x2d8)),'role':_0x24469c,'profile':_0x3dbd13,'user':_0x528f17,'stock':_0x1472b2,'master_shop':_0x5aaf83,'product':_0x46df45,'language':_0x5a4b98,'warehouse':warehouse_data});}catch(_0x2aa9b3){console['log'](_0x2aa9b3);}}),router[a0_0x98235d(0x22f)](a0_0x98235d(0x2cd),auth,async(_0x455081,_0x4ee4b5)=>{var _0x2edc97=a0_0x98235d;try{const {invoice:_0x354f5f,date:_0x217716,warehouse_name:_0x198861,Room_name:_0x560fe5,product_name:_0x50a20d,purchase_quantity:_0x121952,stocks:_0x3f1e04,return_qty:_0x4321b1,note:_0x34ebd2,level:_0x2c274c,isle:_0x201c8b,pallet:_0x387305,to_warehouse_name:_0x520c3e,to_Room_name:_0x55f328}=_0x455081[_0x2edc97(0x22e)],_0x33d0d0=await purchases[_0x2edc97(0x2de)]({'_id':_0x455081[_0x2edc97(0x260)]['id']}),_0x12a469=await warehouse[_0x2edc97(0x2de)]({'name':_0x198861,'room':_0x560fe5});if(typeof _0x50a20d==_0x2edc97(0x299))var _0x217767=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x255)]],_0x1b2bef=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x2ed)]],_0x2b89db=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x28a)]],_0x5721c9=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x276)]],_0xc7418=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x243)]],_0x157ad9=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x2e4)]],_0x4fef90=[_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x282)]],_0x4f9a77=[_0x455081[_0x2edc97(0x22e)]['types']],_0x3aeaa3=[_0x455081[_0x2edc97(0x22e)]['product_code_hide']],_0x191394=[_0x455081[_0x2edc97(0x22e)]['primary_code_hide']],_0x340fac=[_0x455081['body']['secondary_code_hide']];else var _0x217767=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x255)]],_0x1b2bef=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x2ed)]],_0x2b89db=[..._0x455081[_0x2edc97(0x22e)]['stocks']],_0x5721c9=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x276)]],_0xc7418=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x243)]],_0x157ad9=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x2e4)]],_0x4fef90=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x282)]],_0x4f9a77=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x1f0)]],_0x3aeaa3=[..._0x455081[_0x2edc97(0x22e)][_0x2edc97(0x213)]],_0x191394=[..._0x455081['body'][_0x2edc97(0x1fb)]],_0x340fac=[..._0x455081['body'][_0x2edc97(0x22b)]];const _0x578942=_0x217767[_0x2edc97(0x281)](_0x209743=>{return _0x209743={'product_name':_0x209743};});_0x1b2bef[_0x2edc97(0x242)]((_0x117cb4,_0x13dbac)=>{_0x578942[_0x13dbac]['purchase_quantity']=_0x117cb4;}),_0x2b89db['forEach']((_0x5922d3,_0x4b20e4)=>{var _0x429258=_0x2edc97;_0x578942[_0x4b20e4][_0x429258(0x222)]=_0x5922d3;}),_0x5721c9[_0x2edc97(0x242)]((_0x2f3aa9,_0x2ae304)=>{var _0x4c8162=_0x2edc97;_0x578942[_0x2ae304][_0x4c8162(0x276)]=_0x2f3aa9;}),_0xc7418[_0x2edc97(0x242)]((_0x2a7ec2,_0x4c9835)=>{var _0x109cd5=_0x2edc97;_0x578942[_0x4c9835][_0x109cd5(0x219)]=_0x2a7ec2;}),_0x157ad9[_0x2edc97(0x242)]((_0x5ddb5f,_0xdb00de)=>{var _0x13a9e7=_0x2edc97;_0x578942[_0xdb00de][_0x13a9e7(0x304)]=_0x5ddb5f;}),_0x4fef90['forEach']((_0x5b351b,_0x4b3eb4)=>{var _0x5e6e38=_0x2edc97;_0x578942[_0x4b3eb4][_0x5e6e38(0x253)]=_0x5b351b;}),_0x4f9a77[_0x2edc97(0x242)]((_0x5ecc8b,_0x4c1c9f)=>{var _0x294d2e=_0x2edc97;_0x578942[_0x4c1c9f][_0x294d2e(0x201)]=_0x5ecc8b;}),_0x3aeaa3[_0x2edc97(0x242)]((_0x1aefce,_0x32528f)=>{var _0x252962=_0x2edc97;_0x578942[_0x32528f][_0x252962(0x1fd)]=_0x1aefce;}),_0x191394[_0x2edc97(0x242)]((_0x577e3c,_0x120481)=>{var _0x466b90=_0x2edc97;_0x578942[_0x120481][_0x466b90(0x2e2)]=_0x577e3c;}),_0x340fac['forEach']((_0x16a612,_0x1194c4)=>{var _0xb9a585=_0x2edc97;_0x578942[_0x1194c4][_0xb9a585(0x2e6)]=_0x16a612;}),_0x33d0d0['product'][_0x2edc97(0x242)](_0xcf17ad=>{var _0x1ddb2d=_0x2edc97;const _0x518793=_0x12a469[_0x1ddb2d(0x2aa)]['map'](_0x1d7ef8=>{var _0x300f7f=_0x1ddb2d;_0x1d7ef8[_0x300f7f(0x255)]==_0xcf17ad['product_name']&&_0x1d7ef8[_0x300f7f(0x253)]==_0xcf17ad['floorlevel']&&_0x1d7ef8[_0x300f7f(0x201)]==_0xcf17ad['type']&&_0x1d7ef8[_0x300f7f(0x304)]==_0xcf17ad[_0x300f7f(0x304)]&&_0x1d7ef8[_0x300f7f(0x219)]==_0xcf17ad[_0x300f7f(0x219)]&&_0x1d7ef8['rack']==_0xcf17ad['rack']&&_0x1d7ef8['storage']==_0xcf17ad['storage']&&(console['log'](parseInt(_0x1d7ef8[_0x300f7f(0x206)])+_0x300f7f(0x266)+parseInt(_0xcf17ad[_0x300f7f(0x25a)])),_0x1d7ef8[_0x300f7f(0x206)]=parseInt(_0x1d7ef8[_0x300f7f(0x206)])+parseInt(_0xcf17ad[_0x300f7f(0x25a)]));});}),await _0x12a469[_0x2edc97(0x1f4)]();const _0x1e0395=_0x578942[_0x2edc97(0x210)](_0x57e7cf=>_0x57e7cf[_0x2edc97(0x276)]!=='0'&&_0x57e7cf[_0x2edc97(0x276)]!=='');var _0x2cc454=0x0;_0x1e0395[_0x2edc97(0x242)](_0x38e89f=>{var _0xfda91e=_0x2edc97;console[_0xfda91e(0x2cb)]('foreach\x20newproduct',_0x38e89f),(parseInt(_0x38e89f[_0xfda91e(0x2ed)])<parseInt(_0x38e89f[_0xfda91e(0x276)])||parseInt(_0x38e89f[_0xfda91e(0x222)])<parseInt(_0x38e89f[_0xfda91e(0x276)]))&&_0x2cc454++;});if(_0x2cc454!=0x0)return _0x455081[_0x2edc97(0x2a6)]('errors',_0x2edc97(0x1f6)),_0x4ee4b5['redirect'](_0x2edc97(0x2b9));const _0x3221f7=new purchases_return({'invoice':_0x354f5f,'suppliers':_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x215)],'date':_0x217716,'warehouse_name':_0x198861,'return_product':_0x1e0395,'note':_0x34ebd2,'room':_0x560fe5,'to_warehouse_name':_0x520c3e,'to_room':_0x55f328}),_0x3b9a91=await _0x3221f7[_0x2edc97(0x1f4)]();console['log'](_0x3221f7);const _0x154710=await purchases_return[_0x2edc97(0x2de)]({'invoice':_0x354f5f}),_0x394709=await warehouse[_0x2edc97(0x2de)]({'name':_0x520c3e,'room':_0x55f328});_0x154710[_0x2edc97(0x214)]['forEach'](_0x22b572=>{var _0x5ba3e4=_0x2edc97,_0x3dcdfe=0x0;const _0x1bd228=_0x394709['product_details'][_0x5ba3e4(0x281)](_0x5c4729=>{var _0x5da02e=_0x5ba3e4;_0x5c4729[_0x5da02e(0x255)]==_0x22b572[_0x5da02e(0x255)]&&_0x5c4729[_0x5da02e(0x253)]==_0x22b572[_0x5da02e(0x253)]&&_0x5c4729[_0x5da02e(0x201)]==_0x22b572[_0x5da02e(0x201)]&&_0x5c4729['bin']==_0x22b572['bin']&&_0x5c4729[_0x5da02e(0x219)]==_0x22b572[_0x5da02e(0x219)]&&(_0x5c4729['product_stock']=parseInt(_0x5c4729[_0x5da02e(0x206)])-parseInt(_0x22b572[_0x5da02e(0x276)]),_0x3dcdfe++);});_0x3dcdfe=='0'&&(_0x394709[_0x5ba3e4(0x2aa)]=_0x394709[_0x5ba3e4(0x2aa)][_0x5ba3e4(0x300)]({'product_name':_0x22b572[_0x5ba3e4(0x255)],'product_stock':_0x22b572[_0x5ba3e4(0x276)],'primary_code':_0x22b572[_0x5ba3e4(0x2e2)],'secondary_code':_0x22b572[_0x5ba3e4(0x2e6)],'product_code':_0x22b572['product_code'],'storage':_0x22b572[_0x5ba3e4(0x2e7)],'rack':_0x22b572[_0x5ba3e4(0x25c)],'bay':_0x22b572['bay'],'bin':_0x22b572[_0x5ba3e4(0x304)],'type':_0x22b572['type'],'floorlevel':_0x22b572[_0x5ba3e4(0x253)],'maxProducts':_0x22b572[_0x5ba3e4(0x231)],'unit':_0x22b572['standard_unit'],'secondary_unit':_0x22b572[_0x5ba3e4(0x2ca)],'expiry_date':_0x22b572[_0x5ba3e4(0x25e)]}));}),await _0x394709[_0x2edc97(0x1f4)]();const _0x4695a9=await purchases['findOne']({'invoice':_0x354f5f});_0x4695a9[_0x2edc97(0x258)]=_0x2edc97(0x2b3);const _0x5a34bc=await _0x4695a9[_0x2edc97(0x1f4)](),_0x47d773=new s_payment_data({'invoice':_0x354f5f,'suppliers':_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x215)],'reason':'Purchase\x20Return'});await _0x47d773['save']();const _0x5b3293=await master_shop[_0x2edc97(0x203)]();console[_0x2edc97(0x2cb)](_0x2edc97(0x1f8),_0x5b3293[0x0]['image']);const _0x3671f2=await email_settings[_0x2edc97(0x2de)](),_0xcb23f5=await suppliers[_0x2edc97(0x2de)]({'name':_0x455081[_0x2edc97(0x22e)][_0x2edc97(0x215)]});console['log'](_0x2edc97(0x249),_0xcb23f5);_0x5b3293[0x0]['currency_placement']==0x1?(right_currency=_0x5b3293[0x0][_0x2edc97(0x1ef)],left_currency=''):(right_currency='',left_currency=_0x5b3293[0x0][_0x2edc97(0x1ef)]);var _0x4458fa=_0x217767,_0x2c4da5=_0x5721c9,_0x1358f3='',_0x5db901;for(_0x5db901 in _0x4458fa){_0x1358f3+=_0x2edc97(0x307)+_0x2edc97(0x21d)+_0x4458fa[_0x5db901]+'</td>'+_0x2edc97(0x21d)+_0x2c4da5[_0x5db901]+'</td>'+_0x2edc97(0x277);}console['log']('product_list',_0x1358f3);let _0x1075a=nodemailer[_0x2edc97(0x2b6)]({'service':_0x2edc97(0x303),'auth':{'user':_0x3671f2[_0x2edc97(0x208)],'pass':_0x3671f2[_0x2edc97(0x275)]}}),_0x2227fc={'from':_0x3671f2[_0x2edc97(0x208)],'to':_0xcb23f5[_0x2edc97(0x208)],'subject':_0x2edc97(0x245),'attachments':[{'filename':_0x2edc97(0x24e),'path':__dirname+_0x2edc97(0x2b7)+_0x2edc97(0x2ac)+_0x5b3293[0x0][_0x2edc97(0x24d)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x2edc97(0x26a)+_0x2edc97(0x20e)+_0x2edc97(0x302)+_0x2edc97(0x221)+_0x2edc97(0x302)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x2edc97(0x28f)+_0x2edc97(0x302)+'<h2>\x20'+_0x5b3293[0x0]['site_title']+_0x2edc97(0x29d)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x2edc97(0x26c)+_0x2edc97(0x25b)+_0x354f5f+'\x20'+_0x2edc97(0x27d)+_0x2edc97(0x205)+_0x217716+'\x20'+_0x2edc97(0x2bf)+_0x2edc97(0x2c9)+_0x2edc97(0x28f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2edc97(0x2d1)+'<tr>'+_0x2edc97(0x1f3)+_0x2edc97(0x29a)+_0x2edc97(0x1f2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x2edc97(0x27a)+_0x2edc97(0x254)+'\x20'+_0x1358f3+'\x20'+_0x2edc97(0x257)+_0x2edc97(0x235)+_0x2edc97(0x302)+_0x2edc97(0x20b)+_0x2edc97(0x29f)+_0x5b3293[0x0]['site_title']+_0x2edc97(0x2c9)+'</div>'+'</div>'+_0x2edc97(0x1fa)};_0x1075a[_0x2edc97(0x1f1)](_0x2227fc,function(_0x4a2021,_0x538897){var _0x32e1ea=_0x2edc97;_0x4a2021?(console['log'](_0x4a2021),console[_0x32e1ea(0x2cb)]('Error\x20Occurs')):console[_0x32e1ea(0x2cb)]('Email\x20sent\x20successfully');}),_0x455081['flash'](_0x2edc97(0x2b5),_0x2edc97(0x2c7)),_0x4ee4b5[_0x2edc97(0x2db)]('/all_purchases/view');}catch(_0x3fef01){console[_0x2edc97(0x2cb)](_0x3fef01),_0x4ee4b5[_0x2edc97(0x23f)](0xc8)['json']({'message':_0x3fef01[_0x2edc97(0x269)]});}}),router[a0_0x98235d(0x2e3)](a0_0x98235d(0x26d),auth,async(_0x43b235,_0x2e30c5)=>{var _0x193352=a0_0x98235d;try{const {username:_0x5312ba,email:_0x3d0cdf,role:_0x33567e}=_0x43b235[_0x193352(0x2a7)],_0x4594c3=_0x43b235[_0x193352(0x2a7)],_0x3afd93=await profile['findOne']({'email':_0x4594c3[_0x193352(0x208)]}),_0x1b5128=await master_shop[_0x193352(0x203)](),_0x467923=_0x43b235[_0x193352(0x260)]['id'],_0x4af9d5=await purchases[_0x193352(0x267)](_0x467923);if(_0x1b5128[0x0][_0x193352(0x2c2)]=='English\x20(US)')var _0x5bb7f9=users[_0x193352(0x284)];else{if(_0x1b5128[0x0]['language']==_0x193352(0x2a2))var _0x5bb7f9=users[_0x193352(0x2a2)];else{if(_0x1b5128[0x0]['language']==_0x193352(0x247))var _0x5bb7f9=users[_0x193352(0x247)];else{if(_0x1b5128[0x0][_0x193352(0x2c2)]==_0x193352(0x232))var _0x5bb7f9=users[_0x193352(0x232)];else{if(_0x1b5128[0x0][_0x193352(0x2c2)]==_0x193352(0x28c))var _0x5bb7f9=users[_0x193352(0x28c)];else{if(_0x1b5128[0x0][_0x193352(0x2c2)]==_0x193352(0x2c4))var _0x5bb7f9=users[_0x193352(0x286)];else{if(_0x1b5128[0x0][_0x193352(0x2c2)]==_0x193352(0x229))var _0x5bb7f9=users['Chinese'];else{if(_0x1b5128[0x0]['language']==_0x193352(0x30a))var _0x5bb7f9=users['Arabic'];}}}}}}}_0x2e30c5[_0x193352(0x2d0)]('all_purchases_barcode',{'success':_0x43b235[_0x193352(0x2a6)](_0x193352(0x2b5)),'errors':_0x43b235[_0x193352(0x2a6)](_0x193352(0x2d8)),'role':_0x4594c3,'profile':_0x3afd93,'alldata':_0x4af9d5,'master_shop':_0x1b5128,'language':_0x5bb7f9}),console['log'](alldata);}catch(_0x3dbc0e){console[_0x193352(0x2cb)](_0x3dbc0e);}}),router[a0_0x98235d(0x22f)](a0_0x98235d(0x292),async(_0x1cb463,_0x234c87)=>{var _0x4c7bb7=a0_0x98235d;const {product_code:_0x5f8421}=_0x1cb463['body'];var _0x2ac230;const _0x5c8b1e=await product[_0x4c7bb7(0x265)]([{'$match':{'primary_code':_0x5f8421,'product_category':_0x4c7bb7(0x25d)}},{'$group':{'_id':_0x4c7bb7(0x26f),'name':{'$first':_0x4c7bb7(0x2be)},'category':{'$first':_0x4c7bb7(0x1f9)},'brand':{'$first':_0x4c7bb7(0x22a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x4c7bb7(0x29b)},'product_code':{'$first':_0x4c7bb7(0x272)},'primary_code':{'$first':_0x4c7bb7(0x26e)},'secondary_code':{'$first':_0x4c7bb7(0x2a0)},'maxStocks':{'$first':_0x4c7bb7(0x252)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4c7bb7(0x21a)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x22ee34=await product['aggregate']([{'$match':{'secondary_code':_0x5f8421,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4c7bb7(0x26f),'name':{'$first':_0x4c7bb7(0x2be)},'category':{'$first':_0x4c7bb7(0x1f9)},'brand':{'$first':'$brand'},'unit':{'$first':_0x4c7bb7(0x2b8)},'alertquantity':{'$first':_0x4c7bb7(0x29b)},'product_code':{'$first':_0x4c7bb7(0x272)},'primary_code':{'$first':_0x4c7bb7(0x26e)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4c7bb7(0x252)},'maxProdPerUnit':{'$first':_0x4c7bb7(0x29e)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x5c8b1e[_0x4c7bb7(0x2fc)]>0x0)_0x2ac230=_0x5c8b1e;else _0x22ee34['length']>0x0&&(_0x2ac230=_0x22ee34);_0x234c87['json'](_0x2ac230);}),router[a0_0x98235d(0x22f)]('/CheckingWarehouse',async(_0x202601,_0xd9c699)=>{var _0x4c7fa9=a0_0x98235d;const {primaryCode:_0x165f9d,secondaryCode:_0x52ad85,productCode:_0x32771c,bay:_0x302616,bin:_0x138bf0,types:_0x54fd80,pallet:_0x17f21a,warehouses:_0x313d88,room:_0x5526ca}=_0x202601[_0x4c7fa9(0x22e)];console[_0x4c7fa9(0x2cb)](_0x202601[_0x4c7fa9(0x22e)]);try{const _0x29bfd8=await warehouse[_0x4c7fa9(0x265)]([{'$match':{'name':_0x313d88,'room':_0x5526ca}},{'$unwind':_0x4c7fa9(0x2e9)},{'$match':{'product_details.bay':_0x302616,'product_details.bin':_0x138bf0,'product_details.type':_0x54fd80}},{'$group':{'_id':_0x4c7fa9(0x248),'name':{'$first':_0x4c7fa9(0x2f3)},'product_stock':{'$first':_0x4c7fa9(0x240)},'level':{'$first':_0x4c7fa9(0x291)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x4c7fa9(0x293)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xd9c699[_0x4c7fa9(0x23f)](0xc8)[_0x4c7fa9(0x2f1)](_0x29bfd8);}catch(_0x2d0808){_0xd9c699[_0x4c7fa9(0x23f)](0x194)[_0x4c7fa9(0x2f1)]({'message':_0x2d0808[_0x4c7fa9(0x269)]});}}),module[a0_0x98235d(0x218)]=router;