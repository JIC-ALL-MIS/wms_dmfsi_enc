var a0_0x3d2d6a=a0_0x12a2;(function(_0x135af7,_0x31c7fe){var _0x444f50=a0_0x12a2,_0x2cd578=_0x135af7();while(!![]){try{var _0x1f75e6=parseInt(_0x444f50(0x255))/0x1+-parseInt(_0x444f50(0x1aa))/0x2*(parseInt(_0x444f50(0x21f))/0x3)+parseInt(_0x444f50(0x275))/0x4+-parseInt(_0x444f50(0x197))/0x5+-parseInt(_0x444f50(0x24e))/0x6*(parseInt(_0x444f50(0x194))/0x7)+-parseInt(_0x444f50(0x1ce))/0x8*(parseInt(_0x444f50(0x189))/0x9)+-parseInt(_0x444f50(0x277))/0xa*(-parseInt(_0x444f50(0x1f3))/0xb);if(_0x1f75e6===_0x31c7fe)break;else _0x2cd578['push'](_0x2cd578['shift']());}catch(_0x1aefe8){_0x2cd578['push'](_0x2cd578['shift']());}}}(a0_0x5144,0x6de27));const express=require(a0_0x3d2d6a(0x26c)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x3d2d6a(0x20d)),nodemailer=require(a0_0x3d2d6a(0x1bd));var ejs=require(a0_0x3d2d6a(0x211));function a0_0x5144(){var _0x3f1719=['$product_details.pallet','post','rack','Paid\x20For\x20Purchase','product_code','gmail','prod_code','stocks','</tr>','site_title','/view','$invoice','edit_purchases','Rack\x20F','Floor','prod_level','/all_purchases/view/','floorlevel','$product_details.bin','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/view/add_purchases','French','$product','$product.quantity','padStart','warehouse_name','secondary_code_hide','return_qty','</thead>','/CheckingWarehouse','$suppliers','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_details','../public/language/languages.json','production_date','toString','status','suppliers_docs','all_purchases_barcode','$product_details.maxProducts','$product_code','suppliers','\x20<\x20wew\x20>\x20','$date','$product.bin','$product_details.storage','Purchase\x20Return','7718274oLZcSE','$product_details','/invoice/:id','product_list','prod_cat','$product.type','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tbody>','staff','product_stock','7nrfXiw','bay','$product_details._id','1413175stJNVN','</div>','$product_details.product_stock','maxperunit','Email\x20sent\x20successfully','exports','\x20<>\x20','$warehouse_name','product_cat','add\x20post','error','$product_details.primary_code','COLD\x20STORAGE','redirect','$return_data','length','$alertquantity','table\x20page','</table>','11516uMwRMi','English\x20(US)','storage','purchases\x20item\x20return\x20successfull','max_product_unit','/give_payment/:id','Return\x20Goods','Receiving\x20Area','push','$category','$room','prod_secondunit','$brand','delivery_date','secondary_unit','warehouse','createTransport','success','$product_details.type','nodemailer','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','getMonth','abs','German','$suppliers_docs','/../public','image','all_purchases','email','RMSEmail','name','$name','actual_qty','$product_details.rack','user','purchase\x20data\x20update\x20successfully','8hMvWTC','$unit','Level','deliverycode','role','foreach\x20newproduct','English','standard_unit','host','return_data','<h2>\x20','<tbody\x20style=\x22text-align:\x20center;\x22>','invoice','prod_pallet','batch_code','purchase_invoice','user_id','</h5>','Ambient','prod_primunit','add_purchases\x20error','\x20Order\x20Date\x20:\x20','<hr\x20class=\x22my-3\x22>','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/view/return_purchase/:id','path','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','save','port','bin','quantity','Arabic','$product_details.product_code','due_amount','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Shelves','22xHeTqP','prod_Qty','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$_id','alertQTY','Raw\x20Materials','product_code_hide','types','body','Enclosed','DRY\x20STORAGE','Rack\x20E','payment\x20successfull','$product.floorlevel','$product.bay','<span\x20style=\x22float:\x20right;\x22>','Error\x20Occurs','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.floorlevel','/preview/:id','$product_details.secondary_code','params','find','get','room_name','../middleware/auth','actual_uom','paid_amount','currency_placement','ejs','forEach','pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Arabic\x20(ae)','level','$finalize','\x20</h2>','message','prod_name','language','</span>','getFullYear','json','339LEKDjV','$note','$product_details.product_name','$secondary_code','INC-','purchase_quantity','Enabled','$product_details.expiry_date','/view/:id','note','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','rak','secondary_code','aggregate','$primary_code','prod_unit','<html><head><title></title>','primary_code','$product.room_name','map','/view/add_purchases/:id','RoomAssign','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','stock_data','catch','delivery_code','/upload/','Portuguese\x20(BR)','MaxStocks_data','primary_code_hide','$due_amount','$secondary_unit','errors','$expiry_date','$maxProdPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','log','flash','Purchase\x20Mail','Spanish','password','random','stock_quantity','\x20Order\x20Number\x20:\x20','<h5>','Logo.png','223050NMZRQR','filter','then','product_name','<div>','An\x20error\x20occurred\x20while\x20saving\x20data.','date','160650wyHBnd','POnumber','Purchase\x20data\x20added\x20successfully','/barcode_scanner','Chinese','$product_details.bay','here','isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','expiry_date','/all_purchases/view','</head><body>','type','prod_invoice','return_product','<tr>','True','product','$batch_code','suppliers_data','Rack\x20B','prod_isle','currency','express','Portuguese','render','sendMail','Rack\x20A','</td>','maxStocks','room','slice','134052iDAkcJ','concat','10419870HjthZu','Hindi','Sales\x20Update\x20successfully','$paid_amount','</body></html>','string'];a0_0x5144=function(){return _0x3f1719;};return a0_0x5144();}const path=require(a0_0x3d2d6a(0x1e8)),users=require(a0_0x3d2d6a(0x29e));router[a0_0x3d2d6a(0x20b)](a0_0x3d2d6a(0x287),auth,async(_0x118c35,_0x5df9ee)=>{var _0x25bb8e=a0_0x3d2d6a;try{const {username:_0x1d18f9,email:_0x592f4f,role:_0x15a2e2}=_0x118c35['user'],_0x4a9939=_0x118c35[_0x25bb8e(0x1cc)],_0x1ae53c=await profile[_0x25bb8e(0x18f)]({'email':_0x4a9939[_0x25bb8e(0x1c6)]}),_0x5e3de3=await staff['findOne']({'email':_0x4a9939[_0x25bb8e(0x1c6)]});if(_0x4a9939['role']==_0x25bb8e(0x192)){const _0x4e99d8=await staff[_0x25bb8e(0x18f)]({'email':_0x4a9939[_0x25bb8e(0x1c6)]});}const _0x2d38f1=await master_shop['find']();let _0x2a9ead;if(_0x4a9939[_0x25bb8e(0x1d2)]=='staff'){const _0x38afd8=await staff[_0x25bb8e(0x18f)]({'email':_0x4a9939['email']});_0x2a9ead=await purchases[_0x25bb8e(0x22d)]([{'$match':{'warehouse_name':_0x38afd8[_0x25bb8e(0x1b9)]}},{'$lookup':{'from':'suppliers','localField':_0x25bb8e(0x183),'foreignField':_0x25bb8e(0x1c8),'as':_0x25bb8e(0x17f)}},{'$unwind':_0x25bb8e(0x1c2)},{'$unwind':_0x25bb8e(0x293)},{'$group':{'_id':_0x25bb8e(0x1f6),'invoice':{'$first':_0x25bb8e(0x288)},'suppliers':{'$first':_0x25bb8e(0x29b)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x25bb8e(0x1b4)},'product':{'$push':_0x25bb8e(0x293)},'note':{'$first':_0x25bb8e(0x220)},'paid_amount':{'$first':_0x25bb8e(0x27a)},'due_amount':{'$first':_0x25bb8e(0x23e)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x25bb8e(0x267)},'expiry_date':{'$first':_0x25bb8e(0x241)},'suppliers_docs':{'$first':_0x25bb8e(0x1c2)},'total_product_quantity':{'$sum':_0x25bb8e(0x294)},'level':{'$addToSet':_0x25bb8e(0x201)},'isle':{'$addToSet':_0x25bb8e(0x186)},'type':{'$addToSet':_0x25bb8e(0x18e)},'floorlevel':{'$addToSet':_0x25bb8e(0x200)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2a9ead=await purchases[_0x25bb8e(0x22d)]([{'$lookup':{'from':_0x25bb8e(0x183),'localField':_0x25bb8e(0x183),'foreignField':_0x25bb8e(0x1c8),'as':_0x25bb8e(0x17f)}},{'$unwind':_0x25bb8e(0x1c2)},{'$unwind':_0x25bb8e(0x293)},{'$group':{'_id':'$_id','invoice':{'$first':_0x25bb8e(0x288)},'suppliers':{'$first':_0x25bb8e(0x29b)},'date':{'$first':_0x25bb8e(0x185)},'warehouse_name':{'$first':_0x25bb8e(0x19e)},'room':{'$addToSet':_0x25bb8e(0x232)},'product':{'$push':'$product'},'note':{'$first':_0x25bb8e(0x220)},'paid_amount':{'$first':_0x25bb8e(0x27a)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x25bb8e(0x1a5)},'batch_code':{'$first':_0x25bb8e(0x267)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x25bb8e(0x201)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x25bb8e(0x18e)},'floorlevel':{'$addToSet':_0x25bb8e(0x200)},'finalize':{'$first':_0x25bb8e(0x217)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]=='English\x20(US)'){var _0x35021c=users[_0x25bb8e(0x1d4)];console['log'](_0x35021c);}else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x278))var _0x35021c=users[_0x25bb8e(0x278)];else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x1c1))var _0x35021c=users['German'];else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x247))var _0x35021c=users[_0x25bb8e(0x247)];else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x292))var _0x35021c=users[_0x25bb8e(0x292)];else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x23b))var _0x35021c=users[_0x25bb8e(0x26d)];else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x259))var _0x35021c=users[_0x25bb8e(0x259)];else{if(_0x2d38f1[0x0][_0x25bb8e(0x21b)]==_0x25bb8e(0x215))var _0x35021c=users[_0x25bb8e(0x1ee)];}}}}}}}_0x5df9ee[_0x25bb8e(0x26e)](_0x25bb8e(0x1c5),{'success':_0x118c35['flash'](_0x25bb8e(0x1bb)),'errors':_0x118c35[_0x25bb8e(0x245)](_0x25bb8e(0x240)),'purchases':_0x2a9ead,'role':_0x4a9939,'profile':_0x1ae53c,'master_shop':_0x2d38f1,'language':_0x35021c});}catch(_0xe736b6){console[_0x25bb8e(0x244)](_0x25bb8e(0x1a8),_0xe736b6),_0x5df9ee['status'](0xc8)[_0x25bb8e(0x21e)]({'message':_0xe736b6[_0x25bb8e(0x219)]});}});function BayBinSelected(_0x301f93,_0x193202){var _0x2829a3=a0_0x3d2d6a,_0x557bfa=[],_0x147ec5=[],_0x55c8cd=[],_0x3e5552=[],_0x55a4ce=[],_0x36bcfc=[];let _0x447438=[];if(_0x301f93==_0x2829a3(0x1fd))switch(_0x193202){case'Rack\x20A':_0x557bfa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x147ec5=[0x1,0x2],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x1d0),_0x2829a3(0x28b)],_0x55a4ce=['D'],_0x36bcfc=['A'];break;case _0x2829a3(0x269):_0x557bfa=[0x6,0x5,0x4,0x3,0x2,0x1],_0x147ec5=[0x1,0x2],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x1d0),_0x2829a3(0x28b)],_0x55a4ce=['D'],_0x36bcfc=['B'];break;case _0x2829a3(0x1f2):_0x557bfa=[0x0],_0x147ec5=[0x0],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x28b)],_0x55a4ce=['D'],_0x36bcfc=['S'];break;case _0x2829a3(0x1b1):_0x557bfa=[0x0],_0x147ec5=[0x0],_0x3e5552=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x55c8cd=[_0x2829a3(0x28b)],_0x55a4ce=['D'],_0x36bcfc=['R'];break;}else{if(_0x301f93==_0x2829a3(0x1a3))switch(_0x193202){case _0x2829a3(0x270):_0x557bfa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x147ec5=['B','F'],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=['Level',_0x2829a3(0x28b)],_0x55a4ce=['C'],_0x36bcfc=['A'];break;case _0x2829a3(0x269):_0x557bfa=[0x5,0x4,0x3,0x2,0x1],_0x147ec5=['F','B','S'],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x1d0),_0x2829a3(0x28b)],_0x55a4ce=['C'],_0x36bcfc=['B'];break;case'Rack\x20C':_0x557bfa=[0x1,0x2,0x3,0x4,0x5],_0x147ec5=['B','F','S'],_0x3e5552=[0x5,0x4,0x3,0x2,0x1],_0x55c8cd=[_0x2829a3(0x1d0),_0x2829a3(0x28b)],_0x55a4ce=['C'],_0x36bcfc=['C'];break;case'Rack\x20D':_0x557bfa=[0x5,0x4,0x3,0x2,0x1],_0x147ec5=['F','B','S'],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x1d0),_0x2829a3(0x28b)],_0x55a4ce=['C'],_0x36bcfc=['D'];break;case _0x2829a3(0x1fe):_0x557bfa=[0x4,0x3,0x2,0x1],_0x147ec5=[0x1,0x2],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x1d0),_0x2829a3(0x28b)],_0x55a4ce=['C'],_0x36bcfc=['E'];break;case _0x2829a3(0x28a):_0x557bfa=[0x1,0x2,0x3],_0x147ec5=[0x1,0x2],_0x3e5552=[0x1,0x2,0x3,0x4,0x5],_0x55c8cd=[_0x2829a3(0x1d0)],_0x55a4ce=['C'],_0x36bcfc=['F'];break;}}return{'levels':_0x557bfa,'Isle':_0x147ec5,'rack':_0x3e5552,'type':_0x55c8cd,'storage':_0x55a4ce,'rak':_0x36bcfc};}async function getRandom8DigitNumber(){var _0x1da5f3=a0_0x3d2d6a;const _0x5580a3=0x989680,_0x68de90=0x5f5e0ff,_0x167bb0=Math['floor'](Math[_0x1da5f3(0x249)]()*(_0x68de90-_0x5580a3+0x1))+_0x5580a3;var _0xa26cb;const _0x500e15=await purchases[_0x1da5f3(0x18f)]({'invoice':_0x1da5f3(0x223)+_0x167bb0});return _0x500e15&&_0x500e15['length']>0x0?_0xa26cb=_0x1da5f3(0x223)+_0x167bb0:_0xa26cb='INC-'+_0x167bb0,_0xa26cb;}function a0_0x12a2(_0x12760e,_0x4f8435){var _0x51447a=a0_0x5144();return a0_0x12a2=function(_0x12a295,_0x199669){_0x12a295=_0x12a295-0x17e;var _0x494656=_0x51447a[_0x12a295];return _0x494656;},a0_0x12a2(_0x12760e,_0x4f8435);}router[a0_0x3d2d6a(0x20b)]('/view/add_purchases',auth,async(_0x4b4231,_0x4617a0)=>{var _0x1f68c1=a0_0x3d2d6a;try{const {username:_0x21dec1,email:_0x42938c,role:_0x24d089}=_0x4b4231['user'],_0x572a68=_0x4b4231[_0x1f68c1(0x1cc)],_0x1ad188=await profile[_0x1f68c1(0x18f)]({'email':_0x572a68[_0x1f68c1(0x1c6)]}),_0x5711c3=await master_shop[_0x1f68c1(0x20a)](),_0x230477=await staff[_0x1f68c1(0x18f)]({'email':_0x572a68[_0x1f68c1(0x1c6)]}),_0x52b5cf=await suppliers[_0x1f68c1(0x20a)]({});let _0x4dbd20;if(_0x572a68[_0x1f68c1(0x1d2)]==_0x1f68c1(0x192)){const _0x489373=await staff['findOne']({'email':_0x572a68[_0x1f68c1(0x1c6)]});_0x4dbd20=await warehouse[_0x1f68c1(0x22d)]([{'$match':{'status':'Enabled','name':_0x489373[_0x1f68c1(0x1b9)],'warehouse_category':_0x1f68c1(0x1f8),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x1f68c1(0x1c9),'name':{'$first':_0x1f68c1(0x1c9)}}}]);}else _0x4dbd20=await warehouse[_0x1f68c1(0x22d)]([{'$match':{'status':_0x1f68c1(0x225),'warehouse_category':_0x1f68c1(0x1f8),'name':{'$ne':_0x1f68c1(0x1b0)}}},{'$group':{'_id':_0x1f68c1(0x1c9),'name':{'$first':_0x1f68c1(0x1c9)}}}]);const _0x48ade9=await product['find']({}),_0x251c29=await warehouse[_0x1f68c1(0x20a)]({'status':'Enabled'}),_0xd00ab=await purchases[_0x1f68c1(0x20a)]({}),_0x3a2a4f=_0xd00ab['length']+0x1,_0x4ad074=_0x1f68c1(0x223)+_0x3a2a4f[_0x1f68c1(0x2a0)]()[_0x1f68c1(0x295)](0x5,'0');var _0x2bdf31=[_0x1f68c1(0x1e0),_0x1f68c1(0x1fc)];if(_0x5711c3[0x0][_0x1f68c1(0x21b)]=='English\x20(US)')var _0xfe39cf=users['English'];else{if(_0x5711c3[0x0][_0x1f68c1(0x21b)]==_0x1f68c1(0x278))var _0xfe39cf=users[_0x1f68c1(0x278)];else{if(_0x5711c3[0x0][_0x1f68c1(0x21b)]==_0x1f68c1(0x1c1))var _0xfe39cf=users['German'];else{if(_0x5711c3[0x0]['language']==_0x1f68c1(0x247))var _0xfe39cf=users[_0x1f68c1(0x247)];else{if(_0x5711c3[0x0][_0x1f68c1(0x21b)]=='French')var _0xfe39cf=users[_0x1f68c1(0x292)];else{if(_0x5711c3[0x0][_0x1f68c1(0x21b)]==_0x1f68c1(0x23b))var _0xfe39cf=users['Portuguese'];else{if(_0x5711c3[0x0][_0x1f68c1(0x21b)]=='Chinese')var _0xfe39cf=users[_0x1f68c1(0x259)];else{if(_0x5711c3[0x0][_0x1f68c1(0x21b)]=='Arabic\x20(ae)')var _0xfe39cf=users[_0x1f68c1(0x1ee)];}}}}}}}const _0x12178e=getRandom8DigitNumber();_0x12178e['then'](_0x2736e3=>{var _0x18d4fc=_0x1f68c1;_0x4617a0[_0x18d4fc(0x26e)]('add_purchases',{'success':_0x4b4231[_0x18d4fc(0x245)]('success'),'errors':_0x4b4231[_0x18d4fc(0x245)](_0x18d4fc(0x240)),'role':_0x572a68,'profile':_0x1ad188,'suppliers':_0x52b5cf,'warehouse':_0x4dbd20,'product':_0x48ade9,'invoice':_0x2736e3,'master_shop':_0x5711c3,'language':_0xfe39cf,'find_data':_0x251c29,'rooms_data':_0x2bdf31});})[_0x1f68c1(0x238)](_0x9a85d5=>{var _0xfd5cfc=_0x1f68c1;_0x4b4231[_0xfd5cfc(0x245)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x4617a0[_0xfd5cfc(0x1a4)](_0xfd5cfc(0x25f));});}catch(_0x4a6ceb){console[_0x1f68c1(0x244)](_0x4a6ceb);}}),router['get'](a0_0x3d2d6a(0x234),auth,async(_0x3816a2,_0x4f65e5)=>{var _0x409188=a0_0x3d2d6a;try{const _0x23be37=_0x3816a2[_0x409188(0x209)]['id'];console['log'](_0x23be37);const _0x494ce0=await master_shop[_0x409188(0x20a)]();console[_0x409188(0x244)](_0x409188(0x204),_0x494ce0);const _0x38d06d=await product[_0x409188(0x18f)]({'name':_0x23be37});console[_0x409188(0x244)](_0x409188(0x266),_0x38d06d),_0x4f65e5[_0x409188(0x17e)](0xc8)['json']({'product_data':_0x38d06d,'master':_0x494ce0});}catch(_0x785797){console[_0x409188(0x244)](_0x409188(0x1e2),_0x785797);}}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x291),auth,async(_0x3b552d,_0xe870bf)=>{var _0xdf6166=a0_0x3d2d6a;try{const {invoice:_0x100871,date:_0x548dd0,warehouse_name:_0x23c797,prod_name:_0x58c91b,prod_code:_0x443867,prod_qty:_0xbc59e8,prod_unit:_0xdc6140,prod_secondunit:_0x70201,prod_level:_0x27cffd,prod_isle:_0xb12545,prod_pallet:_0x5827ca,note:_0x167b06,expiry_date:_0x543863,batch_code:_0x42caae,payable:_0x382088,due_amount:_0x422679,Room_name:_0x5a5f38,primary_code:_0x217bf2,secondary_code:_0x59419c,MaxStocks_data:_0x3d21ce,PO_number:_0x179717,SCRN:_0x1c5467,JO_number:_0x2badcb}=_0x3b552d[_0xdf6166(0x1fb)];if(typeof _0x58c91b==_0xdf6166(0x27c))var _0x549d24=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x21a)]],_0x3efa66=[_0x3b552d[_0xdf6166(0x1fb)]['prod_code']],_0x35c5f1=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1f4)]],_0x3acdd7=[_0x3b552d[_0xdf6166(0x1fb)]['prod_primunit']],_0x2a4a17=[_0x3b552d['body']['prod_secondunit']],_0x3e1ead=[_0x3b552d['body'][_0xdf6166(0x28c)]],_0x46f921=[_0x3b552d['body'][_0xdf6166(0x231)]],_0x27c013=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x22c)]],_0x5031cc=[_0x3b552d['body'][_0xdf6166(0x23c)]],_0x2c698f=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1dc)]],_0x2351e3=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x25e)]],_0x1057ac=[_0x3b552d['body']['max_product_unit']],_0x189fa1=[_0x3b552d['body'][_0xdf6166(0x1f7)]],_0x48f55a=[_0x3b552d['body'][_0xdf6166(0x29f)]],_0x1f9943=[_0x3b552d['body'][_0xdf6166(0x18d)]],_0x43ec74=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x235)]],_0x36e76a=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1d1)]],_0x25cfc0=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x262)]],_0xa7d484=[_0x3b552d['body'][_0xdf6166(0x1ca)]],_0x2fe967=[_0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x20e)]];else var _0x549d24=[..._0x3b552d[_0xdf6166(0x1fb)]['prod_name']],_0x3efa66=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x283)]],_0x35c5f1=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1f4)]],_0x3acdd7=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1e1)]],_0x2a4a17=[..._0x3b552d[_0xdf6166(0x1fb)]['prod_secondunit']],_0x3e1ead=[..._0x3b552d['body'][_0xdf6166(0x28c)]],_0x46f921=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x231)]],_0x27c013=[..._0x3b552d[_0xdf6166(0x1fb)]['secondary_code']],_0x5031cc=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x23c)]],_0x2c698f=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1dc)]],_0x2351e3=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x25e)]],_0x1057ac=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1ae)]],_0x189fa1=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1f7)]],_0x48f55a=[..._0x3b552d['body'][_0xdf6166(0x29f)]],_0x1f9943=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x18d)]],_0x43ec74=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x235)]],_0x36e76a=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x1d1)]],_0x25cfc0=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x262)]],_0xa7d484=[..._0x3b552d['body'][_0xdf6166(0x1ca)]],_0x2fe967=[..._0x3b552d[_0xdf6166(0x1fb)][_0xdf6166(0x20e)]];const _0x484ae1=_0x549d24[_0xdf6166(0x233)](_0x249104=>{return _0x249104={'product_name':_0x249104};});_0xa7d484[_0xdf6166(0x212)]((_0x3021e2,_0x52026f)=>{var _0x2b502b=_0xdf6166;_0x484ae1[_0x52026f]['actual_qty']=Math[_0x2b502b(0x1c0)](_0x3021e2);}),_0x2fe967[_0xdf6166(0x212)]((_0x2a8bd4,_0x260d66)=>{var _0x36d46d=_0xdf6166;_0x484ae1[_0x260d66][_0x36d46d(0x20e)]=_0x2a8bd4;}),_0x3efa66['forEach']((_0x455390,_0x6c8fc2)=>{var _0x1718a5=_0xdf6166;_0x484ae1[_0x6c8fc2][_0x1718a5(0x281)]=_0x455390;}),_0x35c5f1[_0xdf6166(0x212)]((_0x52ba81,_0x28aeb1)=>{var _0x36aae4=_0xdf6166;_0x484ae1[_0x28aeb1][_0x36aae4(0x1ed)]=Math[_0x36aae4(0x1c0)](_0x52ba81);}),_0x3acdd7['forEach']((_0x39d1d5,_0x5edba1)=>{var _0x6167b3=_0xdf6166;_0x484ae1[_0x5edba1][_0x6167b3(0x1d5)]=_0x39d1d5;}),_0x2a4a17['forEach']((_0x3fb36d,_0x449bfa)=>{_0x484ae1[_0x449bfa]['secondary_unit']=_0x3fb36d;}),_0x3e1ead[_0xdf6166(0x212)]((_0x2fe8de,_0x29c3d5)=>{var _0x4455e8=_0xdf6166;_0x43ec74[_0x4455e8(0x212)]((_0x28af83,_0x117dfe)=>{var _0x34e22f=_0x4455e8;if(_0x28af83==_0x34e22f(0x1b1)&&_0x29c3d5==_0x117dfe){console[_0x34e22f(0x244)](_0x28af83+_0x34e22f(0x184)+_0x29c3d5+_0x34e22f(0x19d)+_0x117dfe+_0x34e22f(0x19d)+_0x2fe8de);var _0x527f73=_0x2fe8de[_0x34e22f(0x274)](0x3);_0x484ae1[_0x29c3d5][_0x34e22f(0x1ac)]=_0x2fe8de[0x0],_0x484ae1[_0x29c3d5]['rack']=_0x2fe8de[0x1],_0x484ae1[_0x29c3d5][_0x34e22f(0x195)]=0x0,_0x484ae1[_0x29c3d5][_0x34e22f(0x1ec)]=0x0,_0x484ae1[_0x29c3d5]['type']=_0x34e22f(0x28b),_0x484ae1[_0x29c3d5]['floorlevel']=_0x527f73;}else{if(_0x28af83==_0x34e22f(0x1f2)&&_0x29c3d5==_0x117dfe){var _0x527f73=_0x2fe8de[_0x34e22f(0x274)](0x3);_0x484ae1[_0x29c3d5][_0x34e22f(0x1ac)]=_0x2fe8de[0x0],_0x484ae1[_0x29c3d5][_0x34e22f(0x27f)]=_0x2fe8de[0x1],_0x484ae1[_0x29c3d5][_0x34e22f(0x195)]=0x0,_0x484ae1[_0x29c3d5]['bin']=0x0,_0x484ae1[_0x29c3d5][_0x34e22f(0x261)]=_0x34e22f(0x28b),_0x484ae1[_0x29c3d5]['floorlevel']=_0x2fe8de[0x5];}else{if(_0x29c3d5==_0x117dfe){if(_0x2fe8de[0x0]=='A'&&_0x2fe8de[0x1]=='L'&&_0x2fe8de[0x2]=='L')console[_0x34e22f(0x244)](_0x28af83+_0x34e22f(0x19d)+_0x29c3d5+'\x20<>\x20'+_0x117dfe+'\x20<>\x20'+_0x2fe8de+_0x34e22f(0x25b)),_0x484ae1[_0x29c3d5][_0x34e22f(0x1ac)]=_0x2fe8de[0x0],_0x484ae1[_0x29c3d5][_0x34e22f(0x27f)]=_0x2fe8de[0x1],_0x484ae1[_0x29c3d5][_0x34e22f(0x195)]=0x0,_0x484ae1[_0x29c3d5][_0x34e22f(0x1ec)]=0x0,_0x484ae1[_0x29c3d5]['type']=_0x34e22f(0x28b),_0x484ae1[_0x29c3d5][_0x34e22f(0x28e)]=_0x2fe8de[0x3];else{var _0x1d4f7a;if(_0x2fe8de[0x4]=='L')_0x1d4f7a=_0x34e22f(0x1d0);else _0x2fe8de[0x4]=='F'&&(_0x1d4f7a='Floor');_0x484ae1[_0x29c3d5][_0x34e22f(0x1ac)]=_0x2fe8de[0x0],_0x484ae1[_0x29c3d5]['rack']=_0x2fe8de[0x1],_0x484ae1[_0x29c3d5][_0x34e22f(0x195)]=_0x2fe8de[0x2],_0x484ae1[_0x29c3d5][_0x34e22f(0x1ec)]=_0x2fe8de[0x3],_0x484ae1[_0x29c3d5][_0x34e22f(0x261)]=_0x1d4f7a,_0x484ae1[_0x29c3d5]['floorlevel']=_0x2fe8de[0x5];}}}}});}),_0x46f921['forEach']((_0x207ad3,_0xe555e7)=>{var _0x870b80=_0xdf6166;_0x484ae1[_0xe555e7][_0x870b80(0x231)]=_0x207ad3;}),_0x27c013[_0xdf6166(0x212)]((_0x1c94ce,_0x4795e4)=>{var _0x16e478=_0xdf6166;_0x484ae1[_0x4795e4][_0x16e478(0x22c)]=_0x1c94ce;}),_0x5031cc[_0xdf6166(0x212)]((_0x11de26,_0x5ef103)=>{var _0x176fbb=_0xdf6166;_0x484ae1[_0x5ef103][_0x176fbb(0x272)]=_0x11de26;}),_0x2c698f['forEach']((_0x848c76,_0x1bcff7)=>{var _0x511a3d=_0xdf6166;_0x484ae1[_0x1bcff7][_0x511a3d(0x1dc)]=_0x848c76;}),_0x2351e3[_0xdf6166(0x212)]((_0x241789,_0x5bec00)=>{_0x484ae1[_0x5bec00]['expiry_date']=_0x241789;}),_0x1057ac['forEach']((_0x371922,_0x250d83)=>{var _0x9b473f=_0xdf6166;_0x484ae1[_0x250d83][_0x9b473f(0x19a)]=_0x371922;}),_0x189fa1['forEach']((_0x201f94,_0x496d13)=>{var _0x258d25=_0xdf6166;_0x484ae1[_0x496d13][_0x258d25(0x1f7)]=_0x201f94;}),_0x48f55a['forEach']((_0x35f567,_0xd04f95)=>{var _0x18f116=_0xdf6166;_0x484ae1[_0xd04f95][_0x18f116(0x29f)]=_0x35f567;}),_0x1f9943[_0xdf6166(0x212)]((_0x13bffc,_0x1d2250)=>{var _0x12f71b=_0xdf6166;_0x484ae1[_0x1d2250][_0x12f71b(0x19f)]=_0x13bffc;}),_0x43ec74[_0xdf6166(0x212)]((_0x290de1,_0x3dbd66)=>{var _0x16a959=_0xdf6166;_0x484ae1[_0x3dbd66][_0x16a959(0x20c)]=_0x290de1;}),_0x36e76a[_0xdf6166(0x212)]((_0x111cb9,_0x2ff324)=>{_0x484ae1[_0x2ff324]['delivery_code']=_0x111cb9;}),_0x25cfc0[_0xdf6166(0x212)]((_0x17f245,_0x5cdfcc)=>{var _0x233c00=_0xdf6166;_0x484ae1[_0x5cdfcc][_0x233c00(0x1da)]=_0x17f245;});const _0x17ceca=_0x43ec74[_0xdf6166(0x233)](_0x2e758c=>{return _0x2e758c={'room_name':_0x2e758c};}),_0x161d35=_0x484ae1[_0xdf6166(0x24f)](_0x31baf1=>_0x31baf1['quantity']!=='0'&&_0x31baf1[_0xdf6166(0x1ed)]!==''),_0x48cc90=new purchases({'invoice':_0x100871,'suppliers':_0x3b552d['body']['suppliers'],'date':_0x548dd0,'warehouse_name':_0x23c797,'product':_0x161d35,'note':_0x167b06,'due_amount':_0x422679,'POnumber':_0x179717,'SCRN':_0x1c5467,'JO_number':_0x2badcb,'roomList':_0x17ceca}),_0x3c3bf9=await _0x48cc90[_0xdf6166(0x1ea)](),_0x302672=await purchases[_0xdf6166(0x18f)]({'invoice':_0x100871}),_0x5ed2ac=_0x302672[_0xdf6166(0x266)][_0xdf6166(0x233)](async _0x155293=>{var _0x1a771f=_0xdf6166,_0x16f7ee=await warehouse['findOne']({'name':_0x23c797,'room':_0x155293['room_name']}),_0x5b2f93=0x0;return _0x16f7ee[_0x1a771f(0x29d)][_0x1a771f(0x212)](_0x57401e=>{var _0x1106dc=_0x1a771f;_0x57401e['product_name']==_0x155293[_0x1106dc(0x251)]&&_0x57401e['floorlevel']==_0x155293[_0x1106dc(0x28e)]&&_0x57401e[_0x1106dc(0x261)]==_0x155293[_0x1106dc(0x261)]&&_0x57401e[_0x1106dc(0x1ec)]==_0x155293[_0x1106dc(0x1ec)]&&_0x57401e[_0x1106dc(0x195)]==_0x155293[_0x1106dc(0x195)]&&_0x57401e[_0x1106dc(0x27f)]==_0x155293[_0x1106dc(0x27f)]&&_0x57401e['storage']==_0x155293[_0x1106dc(0x1ac)]&&_0x57401e[_0x1106dc(0x25e)]==_0x155293[_0x1106dc(0x25e)]&&_0x57401e[_0x1106dc(0x1dc)]==_0x155293[_0x1106dc(0x1dc)]&&_0x57401e[_0x1106dc(0x29f)]==_0x155293[_0x1106dc(0x29f)]&&_0x57401e[_0x1106dc(0x1da)]==_0x302672['invoice']&&(_0x57401e[_0x1106dc(0x193)]+=Math['abs'](_0x155293['quantity']),_0x5b2f93++);}),_0x5b2f93===0x0&&_0x16f7ee[_0x1a771f(0x29d)][_0x1a771f(0x1b2)]({'product_name':_0x155293['product_name'],'product_stock':Math[_0x1a771f(0x1c0)](_0x155293['quantity']),'primary_code':_0x155293[_0x1a771f(0x231)],'secondary_code':_0x155293['secondary_code'],'product_code':_0x155293[_0x1a771f(0x281)],'storage':_0x155293[_0x1a771f(0x1ac)],'rack':_0x155293['rack'],'bay':_0x155293[_0x1a771f(0x195)],'bin':_0x155293[_0x1a771f(0x1ec)],'type':_0x155293[_0x1a771f(0x261)],'floorlevel':_0x155293[_0x1a771f(0x28e)],'maxProducts':_0x155293['maxStocks'],'unit':_0x155293[_0x1a771f(0x1d5)],'secondary_unit':_0x155293[_0x1a771f(0x1b8)],'expiry_date':_0x155293['expiry_date'],'maxPerUnit':_0x155293[_0x1a771f(0x19a)],'batch_code':_0x155293[_0x1a771f(0x1dc)],'alertQTY':_0x155293[_0x1a771f(0x1f7)],'production_date':_0x155293['production_date'],'product_cat':_0x155293['product_cat'],'invoice':_0x155293[_0x1a771f(0x1da)],'actual_qty':Math[_0x1a771f(0x1c0)](_0x155293[_0x1a771f(0x1ca)]),'actual_uom':_0x155293[_0x1a771f(0x20e)]}),_0x16f7ee;});Promise['all'](_0x5ed2ac)[_0xdf6166(0x250)](async _0x4a924c=>{var _0x4a93ae=_0xdf6166;try{for(const _0x1e270f of _0x4a924c){await _0x1e270f[_0x4a93ae(0x1ea)]();}const _0x179842=await master_shop['find'](),_0x3286d9=await email_settings['findOne'](),_0x7265dd=await supervisor_settings[_0x4a93ae(0x20a)]();var _0xf3ead6=_0x302672[_0x4a93ae(0x266)],_0x39bd5f='',_0x2d80fc;for(_0x2d80fc in _0xf3ead6){_0x39bd5f+=_0x4a93ae(0x264)+_0x4a93ae(0x1f1)+_0xf3ead6[_0x2d80fc][_0x4a93ae(0x251)]+'</td>'+_0x4a93ae(0x1f1)+_0xf3ead6[_0x2d80fc]['product_code']+_0x4a93ae(0x271)+_0x4a93ae(0x1f1)+_0xf3ead6[_0x2d80fc]['quantity']+_0x4a93ae(0x271)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf3ead6[_0x2d80fc]['standard_unit']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xf3ead6[_0x2d80fc][_0x4a93ae(0x1b8)]+_0x4a93ae(0x271)+_0x4a93ae(0x1f1)+_0x302672['warehouse_name']+'</td>'+_0x4a93ae(0x1f1)+_0xf3ead6[_0x2d80fc]['room_name']+_0x4a93ae(0x271)+_0x4a93ae(0x1f1)+_0xf3ead6[_0x2d80fc][_0x4a93ae(0x1ac)]+_0xf3ead6[_0x2d80fc][_0x4a93ae(0x27f)]+_0xf3ead6[_0x2d80fc]['bay']+_0xf3ead6[_0x2d80fc]['bin']+_0xf3ead6[_0x2d80fc][_0x4a93ae(0x261)][0x0]+_0xf3ead6[_0x2d80fc]['floorlevel']+_0x4a93ae(0x271),_0x4a93ae(0x285);}let _0x438a3d=nodemailer[_0x4a93ae(0x1ba)]({'host':_0x3286d9[_0x4a93ae(0x1d6)],'port':Number(_0x3286d9[_0x4a93ae(0x1eb)]),'secure':![],'auth':{'user':_0x3286d9[_0x4a93ae(0x1c6)],'pass':_0x3286d9[_0x4a93ae(0x248)]}}),_0x1e09ef={'from':_0x3286d9[_0x4a93ae(0x1c6)],'to':_0x7265dd[0x0][_0x4a93ae(0x1c7)],'subject':_0x4a93ae(0x246),'attachments':[{'filename':_0x4a93ae(0x24d),'path':__dirname+'/../public'+_0x4a93ae(0x23a)+_0x179842[0x0][_0x4a93ae(0x1c4)],'cid':_0x4a93ae(0x1e5)}],'html':'<!DOCTYPE\x20html>'+_0x4a93ae(0x230)+_0x4a93ae(0x260)+_0x4a93ae(0x252)+_0x4a93ae(0x1be)+_0x4a93ae(0x252)+_0x4a93ae(0x29c)+'</div>'+'<div>'+_0x4a93ae(0x1d8)+_0x179842[0x0][_0x4a93ae(0x286)]+_0x4a93ae(0x218)+_0x4a93ae(0x198)+'</div>'+_0x4a93ae(0x1e4)+_0x4a93ae(0x252)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x4a93ae(0x24b)+_0x302672[_0x4a93ae(0x1da)]+'\x20'+_0x4a93ae(0x202)+_0x4a93ae(0x1e3)+_0x302672[_0x4a93ae(0x254)]+'\x20'+_0x4a93ae(0x21c)+_0x4a93ae(0x1df)+'</div>'+_0x4a93ae(0x1f5)+_0x4a93ae(0x290)+_0x4a93ae(0x264)+_0x4a93ae(0x22a)+_0x4a93ae(0x243)+_0x4a93ae(0x236)+_0x4a93ae(0x190)+_0x4a93ae(0x1e6)+_0x4a93ae(0x1e9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4a93ae(0x205)+_0x4a93ae(0x285)+_0x4a93ae(0x299)+_0x4a93ae(0x1d9)+'\x20'+_0x39bd5f+'\x20'+_0x4a93ae(0x191)+'</table>'+_0x4a93ae(0x252)+'<strong>\x20Regards\x20</strong>'+_0x4a93ae(0x24c)+_0x179842[0x0][_0x4a93ae(0x286)]+'</h5>'+_0x4a93ae(0x198)+_0x4a93ae(0x198)+_0x4a93ae(0x27b)};_0x438a3d[_0x4a93ae(0x26f)](_0x1e09ef,function(_0x348267,_0x412b90){var _0x8ec490=_0x4a93ae;_0x348267?(console[_0x8ec490(0x244)](_0x348267),console[_0x8ec490(0x244)](_0x8ec490(0x203))):console[_0x8ec490(0x244)](_0x8ec490(0x19b));}),_0x3b552d['flash'](_0x4a93ae(0x1bb),_0x4a93ae(0x257)),_0xe870bf[_0x4a93ae(0x1a4)](_0x4a93ae(0x28d));}catch(_0x3f772b){console[_0x4a93ae(0x1a1)](_0x3f772b),_0xe870bf[_0x4a93ae(0x17e)](0x1f4)[_0x4a93ae(0x21e)]({'error':_0x4a93ae(0x253)});}})['catch'](_0x31abd0=>{var _0x569f3f=_0xdf6166;console['error'](_0x31abd0),_0xe870bf[_0x569f3f(0x17e)](0x1f4)[_0x569f3f(0x21e)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3853af){console['log'](_0x3853af);}}),router[a0_0x3d2d6a(0x20b)]('/preview/:id',auth,async(_0x32bee0,_0x2cc10f)=>{var _0x237902=a0_0x3d2d6a;try{const {username:_0xa091c,email:_0x2cf752,role:_0x173b07}=_0x32bee0['user'],_0x1ba514=_0x32bee0[_0x237902(0x1cc)],_0x17d2a8=await profile['findOne']({'email':_0x1ba514[_0x237902(0x1c6)]}),_0x14cb0b=await master_shop['find'](),_0x2cbf9b=_0x32bee0[_0x237902(0x209)]['id'],_0x18a3ff=await purchases[_0x237902(0x229)](_0x2cbf9b),_0x2d25c9=await warehouse[_0x237902(0x22d)]([{'$match':{'name':_0x18a3ff[_0x237902(0x296)],'room':_0x18a3ff[_0x237902(0x273)]}},{'$unwind':_0x237902(0x18a)},{'$group':{'_id':_0x237902(0x196),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x237902(0x199)},'bay':{'$first':_0x237902(0x25a)},'bin':{'$first':_0x237902(0x28f)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x237902(0x206)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x237902(0x208)},'product_code':{'$first':_0x237902(0x1ef)},'storage':{'$first':_0x237902(0x187)},'rack':{'$first':_0x237902(0x1cb)},'expiry_date':{'$first':_0x237902(0x226)}}}]),_0x176cd9=await customer['find']({});let _0x1bf743;if(_0x1ba514[_0x237902(0x1d2)]==_0x237902(0x192)){const _0x2cee99=await staff[_0x237902(0x18f)]({'email':_0x1ba514[_0x237902(0x1c6)]});_0x1bf743=await warehouse[_0x237902(0x22d)]([{'$match':{'status':_0x237902(0x225),'name':_0x2cee99[_0x237902(0x1b9)]}},{'$group':{'_id':_0x237902(0x1c9),'name':{'$first':'$name'}}}]);}else _0x1bf743=await warehouse[_0x237902(0x22d)]([{'$match':{'status':_0x237902(0x225)}},{'$group':{'_id':_0x237902(0x1c9),'name':{'$first':'$name'}}}]);const _0x2afa20=await product[_0x237902(0x20a)]({}),_0x3d241e=await suppliers[_0x237902(0x20a)]({}),_0x28bff2=BayBinSelected(_0x18a3ff[_0x237902(0x296)],_0x18a3ff['room']);if(_0x14cb0b[0x0]['language']==_0x237902(0x1ab)){var _0x30f2f3=users[_0x237902(0x1d4)];console[_0x237902(0x244)](_0x30f2f3);}else{if(_0x14cb0b[0x0][_0x237902(0x21b)]==_0x237902(0x278))var _0x30f2f3=users[_0x237902(0x278)];else{if(_0x14cb0b[0x0][_0x237902(0x21b)]==_0x237902(0x1c1))var _0x30f2f3=users['German'];else{if(_0x14cb0b[0x0][_0x237902(0x21b)]==_0x237902(0x247))var _0x30f2f3=users[_0x237902(0x247)];else{if(_0x14cb0b[0x0][_0x237902(0x21b)]==_0x237902(0x292))var _0x30f2f3=users[_0x237902(0x292)];else{if(_0x14cb0b[0x0]['language']==_0x237902(0x23b))var _0x30f2f3=users[_0x237902(0x26d)];else{if(_0x14cb0b[0x0]['language']=='Chinese')var _0x30f2f3=users[_0x237902(0x259)];else{if(_0x14cb0b[0x0]['language']==_0x237902(0x215))var _0x30f2f3=users[_0x237902(0x1ee)];}}}}}}}_0x2cc10f[_0x237902(0x26e)]('edit_purchases_view',{'success':_0x32bee0['flash'](_0x237902(0x1bb)),'errors':_0x32bee0[_0x237902(0x245)](_0x237902(0x240)),'role':_0x1ba514,'profile':_0x17d2a8,'customer':_0x176cd9,'warehouse':_0x1bf743,'product':_0x2d25c9,'user':_0x18a3ff,'master_shop':_0x14cb0b,'unit':_0x2afa20,'language':_0x30f2f3,'suppliers':_0x3d241e,'dataSelected':_0x28bff2});}catch(_0x135cad){console[_0x237902(0x244)](_0x135cad);}}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x207),auth,async(_0x4ae4c8,_0x3401b0)=>{var _0x1d8d3d=a0_0x3d2d6a;try{const _0x575e18=_0x4ae4c8['params']['id'],{invoice:_0x4d258e,warehouse_name:_0x468f53,Room_name:_0x1204ca}=_0x4ae4c8[_0x1d8d3d(0x1fb)],_0x52406c=await warehouse[_0x1d8d3d(0x18f)]({'name':_0x468f53,'room':_0x1204ca}),_0x7a3c72=await purchases['findOne']({'invoice':_0x4d258e});_0x7a3c72[_0x1d8d3d(0x266)][_0x1d8d3d(0x212)](_0x288d4a=>{var _0x1c137e=_0x1d8d3d,_0x194b28=0x0;const _0x4437b9=_0x52406c[_0x1c137e(0x29d)]['map'](_0x5e2050=>{var _0x14e910=_0x1c137e;_0x5e2050[_0x14e910(0x251)]==_0x288d4a[_0x14e910(0x251)]&&_0x5e2050['floorlevel']==_0x288d4a['floorlevel']&&_0x5e2050[_0x14e910(0x261)]==_0x288d4a[_0x14e910(0x261)]&&_0x5e2050[_0x14e910(0x1ec)]==_0x288d4a[_0x14e910(0x1ec)]&&_0x5e2050[_0x14e910(0x195)]==_0x288d4a[_0x14e910(0x195)]&&_0x5e2050['rack']==_0x288d4a[_0x14e910(0x27f)]&&_0x5e2050[_0x14e910(0x1ac)]==_0x288d4a[_0x14e910(0x1ac)]&&_0x5e2050['expiry_date']==_0x288d4a[_0x14e910(0x25e)]&&_0x5e2050[_0x14e910(0x1dc)]==_0x288d4a[_0x14e910(0x1dc)]&&_0x5e2050['production_date']==_0x288d4a[_0x14e910(0x29f)]&&_0x5e2050[_0x14e910(0x1b7)]==_0x288d4a[_0x14e910(0x1b7)]&&_0x5e2050[_0x14e910(0x239)]==_0x288d4a[_0x14e910(0x239)]&&(_0x5e2050[_0x14e910(0x193)]=parseInt(_0x5e2050[_0x14e910(0x193)])+parseInt(_0x288d4a[_0x14e910(0x1ed)]),_0x194b28++);});_0x194b28=='0'&&(_0x52406c[_0x1c137e(0x29d)]=_0x52406c[_0x1c137e(0x29d)][_0x1c137e(0x276)]({'product_name':_0x288d4a['product_name'],'product_stock':_0x288d4a[_0x1c137e(0x1ed)],'primary_code':_0x288d4a['primary_code'],'secondary_code':_0x288d4a[_0x1c137e(0x22c)],'product_code':_0x288d4a[_0x1c137e(0x281)],'storage':_0x288d4a[_0x1c137e(0x1ac)],'rack':_0x288d4a[_0x1c137e(0x27f)],'bay':_0x288d4a['bay'],'bin':_0x288d4a['bin'],'type':_0x288d4a[_0x1c137e(0x261)],'floorlevel':_0x288d4a[_0x1c137e(0x28e)],'maxProducts':_0x288d4a['maxStocks'],'unit':_0x288d4a[_0x1c137e(0x1d5)],'secondary_unit':_0x288d4a[_0x1c137e(0x1b8)],'expiry_date':_0x288d4a[_0x1c137e(0x25e)],'maxPerUnit':_0x288d4a[_0x1c137e(0x19a)],'batch_code':_0x288d4a[_0x1c137e(0x1dc)],'alertQTY':_0x288d4a['alertQTY'],'production_date':_0x288d4a['production_date'],'delivery_date':_0x288d4a[_0x1c137e(0x1b7)],'delivery_code':_0x288d4a['delivery_code']}));}),await _0x52406c[_0x1d8d3d(0x1ea)](),_0x7a3c72['finalize']=_0x1d8d3d(0x265);const _0x360ab8=await _0x7a3c72[_0x1d8d3d(0x1ea)]();_0x4ae4c8[_0x1d8d3d(0x245)](_0x1d8d3d(0x1bb),_0x1d8d3d(0x279)),_0x3401b0[_0x1d8d3d(0x1a4)]('/all_purchases/view');}catch(_0x475bd4){console[_0x1d8d3d(0x244)](_0x475bd4);}}),router[a0_0x3d2d6a(0x20b)]('/view/:id',auth,async(_0x21b9c9,_0xf97439)=>{var _0x272b7b=a0_0x3d2d6a;try{const {username:_0x5df57d,email:_0x1eebcb,role:_0x24829c}=_0x21b9c9['user'],_0xa13f66=_0x21b9c9['user'],_0xd99719=await profile[_0x272b7b(0x18f)]({'email':_0xa13f66[_0x272b7b(0x1c6)]}),_0x3ba78f=await master_shop[_0x272b7b(0x20a)](),_0x5184e1=_0x21b9c9['params']['id'],_0x3ac4da=await purchases[_0x272b7b(0x229)](_0x5184e1),_0x22fa0b=await suppliers[_0x272b7b(0x20a)]({});let _0x3f54ce;if(_0xa13f66[_0x272b7b(0x1d2)]=='staff'){const _0x41d2a0=await staff['findOne']({'email':_0xa13f66[_0x272b7b(0x1c6)]});_0x3f54ce=await warehouse[_0x272b7b(0x20a)]({'status':'Enabled','name':_0x41d2a0['warehouse'],'warehouse_category':_0x272b7b(0x1f8)});}else _0x3f54ce=await warehouse[_0x272b7b(0x22d)]([{'$match':{'status':_0x272b7b(0x225),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x272b7b(0x1c9),'name':{'$first':'$name'}}}]);const _0x136d99=await product[_0x272b7b(0x20a)]({}),_0x4a2fa2=BayBinSelected(_0x3ac4da[_0x272b7b(0x296)],_0x3ac4da['room']);let _0x5e7bdc=new Date(_0x3ac4da[_0x272b7b(0x25e)]),_0x33ae48=('0'+_0x5e7bdc['getDate']())['slice'](-0x2),_0x32495e=('0'+(_0x5e7bdc['getMonth']()+0x1))[_0x272b7b(0x274)](-0x2),_0x2214e6=_0x5e7bdc[_0x272b7b(0x21d)](),_0x190d90=_0x2214e6+'-'+_0x32495e+'-'+_0x33ae48;if(_0x3ba78f[0x0]['language']==_0x272b7b(0x1ab)){var _0x1cd9c5=users[_0x272b7b(0x1d4)];console[_0x272b7b(0x244)](_0x1cd9c5);}else{if(_0x3ba78f[0x0][_0x272b7b(0x21b)]==_0x272b7b(0x278))var _0x1cd9c5=users[_0x272b7b(0x278)];else{if(_0x3ba78f[0x0][_0x272b7b(0x21b)]==_0x272b7b(0x1c1))var _0x1cd9c5=users[_0x272b7b(0x1c1)];else{if(_0x3ba78f[0x0]['language']==_0x272b7b(0x247))var _0x1cd9c5=users[_0x272b7b(0x247)];else{if(_0x3ba78f[0x0]['language']==_0x272b7b(0x292))var _0x1cd9c5=users[_0x272b7b(0x292)];else{if(_0x3ba78f[0x0][_0x272b7b(0x21b)]==_0x272b7b(0x23b))var _0x1cd9c5=users[_0x272b7b(0x26d)];else{if(_0x3ba78f[0x0][_0x272b7b(0x21b)]==_0x272b7b(0x259))var _0x1cd9c5=users['Chinese'];else{if(_0x3ba78f[0x0]['language']==_0x272b7b(0x215))var _0x1cd9c5=users['Arabic'];}}}}}}}_0xf97439[_0x272b7b(0x26e)](_0x272b7b(0x289),{'success':_0x21b9c9[_0x272b7b(0x245)](_0x272b7b(0x1bb)),'errors':_0x21b9c9[_0x272b7b(0x245)](_0x272b7b(0x240)),'role':_0xa13f66,'profile':_0xd99719,'purchases':_0x3ac4da,'suppliers':_0x22fa0b,'warehouse':_0x3f54ce,'product':_0x136d99,'master_shop':_0x3ba78f,'language':_0x1cd9c5,'ed_fullDate':_0x190d90,'dataSelected':_0x4a2fa2});}catch(_0x414150){console[_0x272b7b(0x244)](_0x414150);}}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x227),auth,async(_0x442cd8,_0x2ff166)=>{var _0x46f821=a0_0x3d2d6a;try{const _0x345b6b=_0x442cd8['params']['id'],_0xbbaaad=await purchases['findOne']({'_id':_0x442cd8[_0x46f821(0x209)]['id']}),_0x1b8f55=await warehouse['findOne']({'name':_0xbbaaad[_0x46f821(0x296)],'room':_0xbbaaad[_0x46f821(0x273)]});_0xbbaaad[_0x46f821(0x266)][_0x46f821(0x212)](_0x395fac=>{var _0x2b6f05=_0x46f821;const _0x1d6f80=_0x1b8f55[_0x2b6f05(0x29d)][_0x2b6f05(0x233)](_0x385a90=>{var _0x872114=_0x2b6f05;_0x385a90[_0x872114(0x251)]==_0x395fac[_0x872114(0x251)]&&_0x385a90[_0x872114(0x28e)]==_0x395fac[_0x872114(0x28e)]&&_0x385a90['type']==_0x395fac[_0x872114(0x261)]&&_0x385a90['bin']==_0x395fac[_0x872114(0x1ec)]&&_0x385a90[_0x872114(0x195)]==_0x395fac['bay']&&_0x385a90['rack']==_0x395fac[_0x872114(0x27f)]&&_0x385a90['storage']==_0x395fac[_0x872114(0x1ac)]&&(_0x385a90[_0x872114(0x193)]=parseInt(_0x385a90[_0x872114(0x193)])-parseInt(_0x395fac[_0x872114(0x1ed)]));});}),await _0x1b8f55[_0x46f821(0x1ea)]();const {invoice:_0x3ffd5b,suppliers:_0x458de9,date:_0x1ca425,warehouse_name:_0x3d0edf,prod_name:_0x3a617f,prod_code:_0x63dd45,prod_qty:_0x2bdd53,prod_unit:_0x198d8b,prod_secondunit:_0x40adeb,prod_level:_0x4ab7b2,prod_isle:_0x4df8fc,prod_pallet:_0x2e8431,note:_0x3dc942,expiry_date:_0x1a3569,batch_code:_0x17244b,paid_amount:_0x4d615a,due_amount:_0x48604e,Room_name:_0x16f215,primary_code:_0x4493f9,secondary_code:_0x4907d9,PO_number:_0x59fbef,JO_number:_0x391242}=_0x442cd8[_0x46f821(0x1fb)];if(typeof _0x3a617f=='string')var _0x6d2027=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x21a)]],_0x2de899=[_0x442cd8[_0x46f821(0x1fb)]['prod_code']],_0x26f62d=[_0x442cd8[_0x46f821(0x1fb)]['prod_qty']],_0x128040=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x22f)]],_0x2661b1=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1b5)]],_0x3f1cee=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x28c)]],_0x1155b6=[_0x442cd8['body'][_0x46f821(0x26a)]],_0x52ef3b=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1db)]],_0x28ee90=[_0x442cd8['body'][_0x46f821(0x231)]],_0x3993fb=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x22c)]],_0x5b0da2=[_0x442cd8['body'][_0x46f821(0x23c)]],_0xc58348=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1dc)]],_0x157207=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x25e)]],_0x5b389a=[_0x442cd8[_0x46f821(0x1fb)]['storage']],_0xdb68c5=[_0x442cd8[_0x46f821(0x1fb)]['rak']],_0x303e55=[_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x261)]];else var _0x6d2027=[..._0x442cd8[_0x46f821(0x1fb)]['prod_name']],_0x2de899=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x283)]],_0x26f62d=[..._0x442cd8['body']['prod_qty']],_0x128040=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x22f)]],_0x2661b1=[..._0x442cd8[_0x46f821(0x1fb)]['prod_secondunit']],_0x3f1cee=[..._0x442cd8['body']['prod_level']],_0x1155b6=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x26a)]],_0x52ef3b=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1db)]],_0x28ee90=[..._0x442cd8[_0x46f821(0x1fb)]['primary_code']],_0x3993fb=[..._0x442cd8[_0x46f821(0x1fb)]['secondary_code']],_0x5b0da2=[..._0x442cd8['body'][_0x46f821(0x23c)]],_0xc58348=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1dc)]],_0x157207=[..._0x442cd8['body']['expiry_date']],_0x5b389a=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1ac)]],_0xdb68c5=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x22b)]],_0x303e55=[..._0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x261)]];const _0x3943b5=_0x6d2027[_0x46f821(0x233)](_0x225c56=>{return _0x225c56={'product_name':_0x225c56};});_0x2de899[_0x46f821(0x212)]((_0x150316,_0x2e1cdf)=>{_0x3943b5[_0x2e1cdf]['product_code']=_0x150316;}),_0x26f62d[_0x46f821(0x212)]((_0x16aba1,_0x4d40eb)=>{var _0x358e94=_0x46f821;_0x3943b5[_0x4d40eb][_0x358e94(0x1ed)]=_0x16aba1;}),_0x128040[_0x46f821(0x212)]((_0x335337,_0x3fae2c)=>{var _0x54cc6b=_0x46f821;_0x3943b5[_0x3fae2c][_0x54cc6b(0x1d5)]=_0x335337;}),_0x2661b1[_0x46f821(0x212)]((_0x19f6e7,_0x44cbf1)=>{_0x3943b5[_0x44cbf1]['secondary_unit']=_0x19f6e7;}),_0x3f1cee['forEach']((_0x59cb3f,_0x2698a3)=>{var _0x1c704e=_0x46f821;_0x3943b5[_0x2698a3][_0x1c704e(0x195)]=_0x59cb3f;}),_0x1155b6['forEach']((_0x52c8b6,_0x466d22)=>{_0x3943b5[_0x466d22]['bin']=_0x52c8b6;}),_0x52ef3b[_0x46f821(0x212)]((_0x43a943,_0x47ae2a)=>{var _0x527841=_0x46f821;_0x3943b5[_0x47ae2a][_0x527841(0x28e)]=_0x43a943;}),_0x28ee90[_0x46f821(0x212)]((_0x34782b,_0x3c4abd)=>{var _0x547d4b=_0x46f821;_0x3943b5[_0x3c4abd][_0x547d4b(0x231)]=_0x34782b;}),_0x3993fb[_0x46f821(0x212)]((_0x413ab4,_0x6c67c5)=>{var _0x2edbd5=_0x46f821;_0x3943b5[_0x6c67c5][_0x2edbd5(0x22c)]=_0x413ab4;}),_0x5b0da2[_0x46f821(0x212)]((_0x1a6253,_0x5e0028)=>{_0x3943b5[_0x5e0028]['maxStocks']=_0x1a6253;}),_0xc58348[_0x46f821(0x212)]((_0x5eec60,_0x1a0deb)=>{_0x3943b5[_0x1a0deb]['batch_code']=_0x5eec60;}),_0x157207[_0x46f821(0x212)]((_0x2e19a5,_0x3684c1)=>{var _0x1110f4=_0x46f821;_0x3943b5[_0x3684c1][_0x1110f4(0x25e)]=_0x2e19a5;}),_0x303e55[_0x46f821(0x212)]((_0x27ebdf,_0x37b35b)=>{var _0x59b5ab=_0x46f821;_0x3943b5[_0x37b35b][_0x59b5ab(0x261)]=_0x27ebdf;}),_0x5b389a['forEach']((_0x1e59ec,_0x54c54d)=>{var _0x4d7a8d=_0x46f821;_0x3943b5[_0x54c54d][_0x4d7a8d(0x1ac)]=_0x1e59ec;}),_0xdb68c5['forEach']((_0x393af5,_0x5a3d71)=>{_0x3943b5[_0x5a3d71]['rack']=_0x393af5;});const _0x528b72=_0x3943b5[_0x46f821(0x24f)](_0x16cf31=>_0x16cf31[_0x46f821(0x1ed)]!=='0'&&_0x16cf31[_0x46f821(0x1ed)]!=='');_0xbbaaad[_0x46f821(0x1da)]=_0x3ffd5b,_0xbbaaad['suppliers']=_0x458de9,_0xbbaaad[_0x46f821(0x254)]=_0x1ca425,_0xbbaaad[_0x46f821(0x296)]=_0x3d0edf,_0xbbaaad[_0x46f821(0x266)]=_0x528b72,_0xbbaaad[_0x46f821(0x228)]=_0x3dc942,_0xbbaaad[_0x46f821(0x20f)]=_0x4d615a,_0xbbaaad[_0x46f821(0x1f0)]=_0x48604e,_0xbbaaad[_0x46f821(0x273)]=_0x16f215,_0xbbaaad[_0x46f821(0x256)]=_0x59fbef,_0xbbaaad['JO_number']=_0x391242;const _0x1327c5=await _0xbbaaad['save'](),_0x30f11b=await warehouse[_0x46f821(0x18f)]({'name':_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x296)],'room':_0x442cd8['body']['Room_name']});_0xbbaaad[_0x46f821(0x266)][_0x46f821(0x212)](_0x222446=>{var _0x3c814b=_0x46f821,_0x1b41f8=0x0;const _0x1b1cc6=_0x30f11b[_0x3c814b(0x29d)][_0x3c814b(0x233)](_0x580575=>{var _0x51a466=_0x3c814b;_0x580575[_0x51a466(0x251)]==_0x222446['product_name']&&_0x580575[_0x51a466(0x28e)]==_0x222446[_0x51a466(0x28e)]&&_0x580575['type']==_0x222446[_0x51a466(0x261)]&&_0x580575['bin']==_0x222446['bin']&&_0x580575[_0x51a466(0x195)]==_0x222446['bay']&&_0x580575[_0x51a466(0x27f)]==_0x222446[_0x51a466(0x27f)]&&_0x580575[_0x51a466(0x1ac)]==_0x222446[_0x51a466(0x1ac)]&&(_0x580575[_0x51a466(0x193)]=parseInt(_0x580575[_0x51a466(0x193)])+parseInt(_0x222446[_0x51a466(0x1ed)]),_0x1b41f8++);});_0x1b41f8=='0'&&(_0x30f11b[_0x3c814b(0x29d)]=_0x30f11b[_0x3c814b(0x29d)][_0x3c814b(0x276)]({'product_name':_0x222446[_0x3c814b(0x251)],'product_stock':_0x222446[_0x3c814b(0x1ed)],'primary_code':_0x222446[_0x3c814b(0x231)],'secondary_code':_0x222446[_0x3c814b(0x22c)],'product_code':_0x222446[_0x3c814b(0x281)],'storage':_0x222446[_0x3c814b(0x1ac)],'rack':_0x222446[_0x3c814b(0x27f)],'bay':_0x222446['bay'],'bin':_0x222446[_0x3c814b(0x1ec)],'type':_0x222446[_0x3c814b(0x261)],'floorlevel':_0x222446['floorlevel'],'maxProducts':_0x222446[_0x3c814b(0x272)],'unit':_0x222446[_0x3c814b(0x1d5)],'secondary_unit':_0x222446['secondary_unit'],'expiry_date':_0x222446['expiry_date']}));}),await _0x30f11b[_0x46f821(0x1ea)]();const _0x17da40=await s_payment_data[_0x46f821(0x18f)]({'invoice':_0x442cd8['body'][_0x46f821(0x1da)]});if(_0x17da40===null){}else console[_0x46f821(0x244)](_0x46f821(0x183),_0x17da40,_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x1da)]),_0x17da40[_0x46f821(0x183)]=_0x442cd8[_0x46f821(0x1fb)][_0x46f821(0x183)],await _0x17da40[_0x46f821(0x1ea)]();_0x442cd8[_0x46f821(0x245)](_0x46f821(0x1bb),_0x46f821(0x1cd)),_0x2ff166[_0x46f821(0x1a4)](_0x46f821(0x25f));}catch(_0x21d75a){console[_0x46f821(0x244)](_0x21d75a);}}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x1af),auth,async(_0x4fb58b,_0x2010f6)=>{var _0x418d53=a0_0x3d2d6a;try{const _0x2ab4eb=_0x4fb58b['params']['id'],{invoice:_0x23fe50,suppliers:_0x2bf186,payable:_0x262ac0,due_amount:_0x4a111b}=_0x4fb58b[_0x418d53(0x1fb)],_0x2a07b2=await purchases[_0x418d53(0x229)](_0x2ab4eb);var _0x54d503=_0x262ac0-_0x4a111b;_0x2a07b2[_0x418d53(0x20f)]=parseFloat(_0x2a07b2[_0x418d53(0x20f)])+parseFloat(_0x4a111b),_0x2a07b2['due_amount']=_0x54d503;const _0x5da875=await _0x2a07b2['save']();console[_0x418d53(0x244)](_0x5da875);const _0x4f3211=await s_payment_data[_0x418d53(0x18f)]({'invoice':_0x23fe50});_0x4f3211['amount']=_0x54d503,await _0x4f3211[_0x418d53(0x1ea)]();let _0x1208d9=new Date(),_0x39db04=('0'+_0x1208d9['getDate']())['slice'](-0x2),_0x2c46d7=('0'+(_0x1208d9[_0x418d53(0x1bf)]()+0x1))['slice'](-0x2),_0x87363=_0x1208d9[_0x418d53(0x21d)](),_0x3e0306=_0x87363+'-'+_0x2c46d7+'-'+_0x39db04;const _0x2de180=new suppliers_payment({'invoice':_0x23fe50,'date':_0x87363+'-'+_0x2c46d7+'-'+_0x39db04,'suppliers':_0x2bf186,'reason':_0x418d53(0x280),'amount':_0x4a111b}),_0x1590d2=await _0x2de180['save']();_0x4fb58b[_0x418d53(0x245)](_0x418d53(0x1bb),_0x418d53(0x1ff)),_0x2010f6[_0x418d53(0x1a4)](_0x418d53(0x25f));}catch(_0x2cdafa){console[_0x418d53(0x244)](_0x2cdafa);}}),router[a0_0x3d2d6a(0x20b)](a0_0x3d2d6a(0x18b),auth,async(_0xd7b215,_0x28b329)=>{var _0x506e22=a0_0x3d2d6a;try{const {username:_0x303d92,email:_0x3668ae,role:_0x2b91ce}=_0xd7b215[_0x506e22(0x1cc)],_0x24f776=_0xd7b215[_0x506e22(0x1cc)],_0x13aa98=await profile['findOne']({'email':_0x24f776[_0x506e22(0x1c6)]}),_0x386536=await master_shop[_0x506e22(0x20a)]();console[_0x506e22(0x244)](_0x506e22(0x204),_0x386536);const _0x3d14ef=_0xd7b215[_0x506e22(0x209)]['id'],_0x819d7f=await purchases['findById'](_0x3d14ef);console[_0x506e22(0x244)](_0x819d7f);const _0x4bbea6=await suppliers['findOne']({'name':_0x819d7f['suppliers']});console[_0x506e22(0x244)](_0x4bbea6);if(_0x386536[0x0][_0x506e22(0x21b)]==_0x506e22(0x1ab)){var _0x120c26=users[_0x506e22(0x1d4)];console['log'](_0x120c26);}else{if(_0x386536[0x0]['language']=='Hindi')var _0x120c26=users['Hindi'];else{if(_0x386536[0x0][_0x506e22(0x21b)]==_0x506e22(0x1c1))var _0x120c26=users['German'];else{if(_0x386536[0x0][_0x506e22(0x21b)]=='Spanish')var _0x120c26=users[_0x506e22(0x247)];else{if(_0x386536[0x0][_0x506e22(0x21b)]==_0x506e22(0x292))var _0x120c26=users[_0x506e22(0x292)];else{if(_0x386536[0x0][_0x506e22(0x21b)]==_0x506e22(0x23b))var _0x120c26=users[_0x506e22(0x26d)];else{if(_0x386536[0x0][_0x506e22(0x21b)]==_0x506e22(0x259))var _0x120c26=users['Chinese'];else{if(_0x386536[0x0]['language']==_0x506e22(0x215))var _0x120c26=users[_0x506e22(0x1ee)];}}}}}}}_0x28b329[_0x506e22(0x26e)](_0x506e22(0x1dd),{'success':_0xd7b215[_0x506e22(0x245)](_0x506e22(0x1bb)),'errors':_0xd7b215[_0x506e22(0x245)](_0x506e22(0x240)),'role':_0x24f776,'profile':_0x13aa98,'master_shop':_0x386536,'supplier':_0x4bbea6,'purchase':_0x819d7f,'language':_0x120c26});}catch(_0x29c077){console['log'](_0x29c077);}}),router[a0_0x3d2d6a(0x20b)](a0_0x3d2d6a(0x1e7),auth,async(_0x44a1ae,_0x5229b0)=>{var _0x40530b=a0_0x3d2d6a;try{const {username:_0x5dba6a,email:_0x18b203,role:_0x22c1ad}=_0x44a1ae[_0x40530b(0x1cc)],_0x58163d=_0x44a1ae[_0x40530b(0x1cc)],_0x3454e1=await profile[_0x40530b(0x18f)]({'email':_0x58163d[_0x40530b(0x1c6)]}),_0x4e655c=await master_shop[_0x40530b(0x20a)]();console[_0x40530b(0x244)](_0x40530b(0x204),_0x4e655c);const _0x564512=_0x44a1ae[_0x40530b(0x209)]['id'];console['log'](_0x564512);const _0x5920f8=await purchases[_0x40530b(0x229)](_0x564512);console['log'](_0x40530b(0x1de),_0x5920f8);const _0x2a5ce6=await product[_0x40530b(0x20a)]({}),_0x4a6d65=await warehouse[_0x40530b(0x22d)]([{'$match':{'name':_0x5920f8[_0x40530b(0x296)],'room':_0x5920f8[_0x40530b(0x273)],'warehouse_category':_0x40530b(0x1f8)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x40530b(0x196),'name':{'$first':_0x40530b(0x221)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x40530b(0x25a)},'bin':{'$first':_0x40530b(0x28f)},'type':{'$first':_0x40530b(0x1bc)},'floorlevel':{'$first':_0x40530b(0x206)},'primary_code':{'$first':_0x40530b(0x1a2)},'secondary_code':{'$first':_0x40530b(0x208)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x40530b(0x187)},'rack':{'$first':_0x40530b(0x1cb)}}}]);warehouse_data=await warehouse[_0x40530b(0x22d)]([{'$match':{'status':_0x40530b(0x225),'name':_0x40530b(0x1b0),'warehouse_category':_0x40530b(0x1f8)}},{'$group':{'_id':'$name','name':{'$first':_0x40530b(0x1c9)}}},{'$sort':{'name':0x1}}]),console['log'](_0x40530b(0x237),_0x4a6d65);if(_0x4e655c[0x0][_0x40530b(0x21b)]==_0x40530b(0x1ab)){var _0x3e1cd7=users[_0x40530b(0x1d4)];console['log'](_0x3e1cd7);}else{if(_0x4e655c[0x0][_0x40530b(0x21b)]==_0x40530b(0x278))var _0x3e1cd7=users[_0x40530b(0x278)];else{if(_0x4e655c[0x0][_0x40530b(0x21b)]==_0x40530b(0x1c1))var _0x3e1cd7=users[_0x40530b(0x1c1)];else{if(_0x4e655c[0x0][_0x40530b(0x21b)]==_0x40530b(0x247))var _0x3e1cd7=users[_0x40530b(0x247)];else{if(_0x4e655c[0x0][_0x40530b(0x21b)]==_0x40530b(0x292))var _0x3e1cd7=users['French'];else{if(_0x4e655c[0x0][_0x40530b(0x21b)]=='Portuguese\x20(BR)')var _0x3e1cd7=users['Portuguese'];else{if(_0x4e655c[0x0][_0x40530b(0x21b)]==_0x40530b(0x259))var _0x3e1cd7=users[_0x40530b(0x259)];else{if(_0x4e655c[0x0][_0x40530b(0x21b)]=='Arabic\x20(ae)')var _0x3e1cd7=users[_0x40530b(0x1ee)];}}}}}}}_0x5229b0[_0x40530b(0x26e)]('return_purchase',{'success':_0x44a1ae['flash'](_0x40530b(0x1bb)),'errors':_0x44a1ae[_0x40530b(0x245)](_0x40530b(0x240)),'role':_0x58163d,'profile':_0x3454e1,'user':_0x5920f8,'stock':_0x4a6d65,'master_shop':_0x4e655c,'product':_0x2a5ce6,'language':_0x3e1cd7,'warehouse':warehouse_data});}catch(_0x1b033a){console[_0x40530b(0x244)](_0x1b033a);}}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x1e7),auth,async(_0x357868,_0x33c779)=>{var _0x1ca449=a0_0x3d2d6a;try{const {invoice:_0x34d7e5,date:_0x324dd5,warehouse_name:_0x71b4b3,Room_name:_0x138472,product_name:_0x20056d,purchase_quantity:_0x164c08,stocks:_0x19e9cd,return_qty:_0x284e43,note:_0x5cf95f,level:_0x1d754f,isle:_0x36879a,pallet:_0xfc86b4,to_warehouse_name:_0x2a3fb6,to_Room_name:_0x1bc904}=_0x357868[_0x1ca449(0x1fb)],_0x38f05b=await purchases[_0x1ca449(0x18f)]({'_id':_0x357868[_0x1ca449(0x209)]['id']}),_0x51d101=await warehouse[_0x1ca449(0x18f)]({'name':_0x71b4b3,'room':_0x138472});if(typeof _0x20056d==_0x1ca449(0x27c))var _0x146c39=[_0x357868['body'][_0x1ca449(0x251)]],_0x50da94=[_0x357868['body'][_0x1ca449(0x224)]],_0x51efba=[_0x357868['body'][_0x1ca449(0x284)]],_0x26c154=[_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x298)]],_0x4f1456=[_0x357868['body'][_0x1ca449(0x216)]],_0x1dc1d5=[_0x357868['body']['isle']],_0x2662ee=[_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x213)]],_0x18ff0c=[_0x357868[_0x1ca449(0x1fb)]['types']],_0x3640e3=[_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x1f9)]],_0x418e0d=[_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x23d)]],_0x1ecfba=[_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x297)]];else var _0x146c39=[..._0x357868['body'][_0x1ca449(0x251)]],_0x50da94=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x224)]],_0x51efba=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x284)]],_0x26c154=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x298)]],_0x4f1456=[..._0x357868[_0x1ca449(0x1fb)]['level']],_0x1dc1d5=[..._0x357868['body'][_0x1ca449(0x25c)]],_0x2662ee=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x213)]],_0x18ff0c=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x1fa)]],_0x3640e3=[..._0x357868[_0x1ca449(0x1fb)]['product_code_hide']],_0x418e0d=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x23d)]],_0x1ecfba=[..._0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x297)]];const _0x2e0913=_0x146c39['map'](_0x401eef=>{return _0x401eef={'product_name':_0x401eef};});_0x50da94[_0x1ca449(0x212)]((_0x18e96d,_0x13db7b)=>{var _0x1dc497=_0x1ca449;_0x2e0913[_0x13db7b][_0x1dc497(0x224)]=_0x18e96d;}),_0x51efba[_0x1ca449(0x212)]((_0x4a3a40,_0x4b6c8a)=>{_0x2e0913[_0x4b6c8a]['stock_quantity']=_0x4a3a40;}),_0x26c154[_0x1ca449(0x212)]((_0x36e47c,_0x3ac45c)=>{var _0x17d98a=_0x1ca449;_0x2e0913[_0x3ac45c][_0x17d98a(0x298)]=_0x36e47c;}),_0x4f1456[_0x1ca449(0x212)]((_0x2ed284,_0x1e3e83)=>{_0x2e0913[_0x1e3e83]['bay']=_0x2ed284;}),_0x1dc1d5['forEach']((_0x69c989,_0x36b160)=>{var _0x183392=_0x1ca449;_0x2e0913[_0x36b160][_0x183392(0x1ec)]=_0x69c989;}),_0x2662ee[_0x1ca449(0x212)]((_0x8fd4e9,_0x46ffa7)=>{var _0x2f737d=_0x1ca449;_0x2e0913[_0x46ffa7][_0x2f737d(0x28e)]=_0x8fd4e9;}),_0x18ff0c[_0x1ca449(0x212)]((_0x1bd503,_0x333348)=>{_0x2e0913[_0x333348]['type']=_0x1bd503;}),_0x3640e3[_0x1ca449(0x212)]((_0x1d8e13,_0xbecf72)=>{_0x2e0913[_0xbecf72]['product_code']=_0x1d8e13;}),_0x418e0d[_0x1ca449(0x212)]((_0x2952ea,_0x4ead18)=>{var _0x42ce3a=_0x1ca449;_0x2e0913[_0x4ead18][_0x42ce3a(0x231)]=_0x2952ea;}),_0x1ecfba['forEach']((_0x3a1a64,_0x5c96cc)=>{_0x2e0913[_0x5c96cc]['secondary_code']=_0x3a1a64;}),_0x38f05b[_0x1ca449(0x266)][_0x1ca449(0x212)](_0x4e8137=>{var _0x1e283f=_0x1ca449;const _0x3c14c6=_0x51d101['product_details'][_0x1e283f(0x233)](_0xf61983=>{var _0x43eda2=_0x1e283f;_0xf61983['product_name']==_0x4e8137['product_name']&&_0xf61983[_0x43eda2(0x28e)]==_0x4e8137['floorlevel']&&_0xf61983[_0x43eda2(0x261)]==_0x4e8137[_0x43eda2(0x261)]&&_0xf61983['bin']==_0x4e8137[_0x43eda2(0x1ec)]&&_0xf61983['bay']==_0x4e8137[_0x43eda2(0x195)]&&_0xf61983[_0x43eda2(0x27f)]==_0x4e8137[_0x43eda2(0x27f)]&&_0xf61983[_0x43eda2(0x1ac)]==_0x4e8137[_0x43eda2(0x1ac)]&&(console[_0x43eda2(0x244)](parseInt(_0xf61983['product_stock'])+_0x43eda2(0x19d)+parseInt(_0x4e8137[_0x43eda2(0x1ed)])),_0xf61983['product_stock']=parseInt(_0xf61983[_0x43eda2(0x193)])+parseInt(_0x4e8137[_0x43eda2(0x1ed)]));});}),await _0x51d101[_0x1ca449(0x1ea)]();const _0x54ea73=_0x2e0913['filter'](_0x410641=>_0x410641[_0x1ca449(0x298)]!=='0'&&_0x410641[_0x1ca449(0x298)]!=='');var _0x1a2f78=0x0;_0x54ea73[_0x1ca449(0x212)](_0x12461b=>{var _0x553ada=_0x1ca449;console[_0x553ada(0x244)](_0x553ada(0x1d3),_0x12461b),(parseInt(_0x12461b[_0x553ada(0x224)])<parseInt(_0x12461b[_0x553ada(0x298)])||parseInt(_0x12461b[_0x553ada(0x24a)])<parseInt(_0x12461b[_0x553ada(0x298)]))&&_0x1a2f78++;});if(_0x1a2f78!=0x0)return _0x357868[_0x1ca449(0x245)](_0x1ca449(0x240),'Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x33c779[_0x1ca449(0x1a4)]('back');const _0x24d65c=new purchases_return({'invoice':_0x34d7e5,'suppliers':_0x357868[_0x1ca449(0x1fb)]['suppliers'],'date':_0x324dd5,'warehouse_name':_0x71b4b3,'return_product':_0x54ea73,'note':_0x5cf95f,'room':_0x138472,'to_warehouse_name':_0x2a3fb6,'to_room':_0x1bc904}),_0x1a4ef8=await _0x24d65c[_0x1ca449(0x1ea)]();console[_0x1ca449(0x244)](_0x24d65c);const _0x1e8059=await purchases_return[_0x1ca449(0x18f)]({'invoice':_0x34d7e5}),_0x51bc5b=await warehouse['findOne']({'name':_0x2a3fb6,'room':_0x1bc904});_0x1e8059[_0x1ca449(0x263)]['forEach'](_0xb54897=>{var _0x138598=_0x1ca449,_0x4bbd48=0x0;const _0x56a614=_0x51bc5b[_0x138598(0x29d)][_0x138598(0x233)](_0x9efa8a=>{var _0x58270c=_0x138598;_0x9efa8a[_0x58270c(0x251)]==_0xb54897[_0x58270c(0x251)]&&_0x9efa8a[_0x58270c(0x28e)]==_0xb54897[_0x58270c(0x28e)]&&_0x9efa8a[_0x58270c(0x261)]==_0xb54897[_0x58270c(0x261)]&&_0x9efa8a[_0x58270c(0x1ec)]==_0xb54897['bin']&&_0x9efa8a[_0x58270c(0x195)]==_0xb54897['bay']&&(_0x9efa8a[_0x58270c(0x193)]=parseInt(_0x9efa8a['product_stock'])-parseInt(_0xb54897[_0x58270c(0x298)]),_0x4bbd48++);});_0x4bbd48=='0'&&(_0x51bc5b['product_details']=_0x51bc5b[_0x138598(0x29d)][_0x138598(0x276)]({'product_name':_0xb54897[_0x138598(0x251)],'product_stock':_0xb54897['return_qty'],'primary_code':_0xb54897[_0x138598(0x231)],'secondary_code':_0xb54897[_0x138598(0x22c)],'product_code':_0xb54897['product_code'],'storage':_0xb54897[_0x138598(0x1ac)],'rack':_0xb54897[_0x138598(0x27f)],'bay':_0xb54897[_0x138598(0x195)],'bin':_0xb54897[_0x138598(0x1ec)],'type':_0xb54897['type'],'floorlevel':_0xb54897[_0x138598(0x28e)],'maxProducts':_0xb54897[_0x138598(0x272)],'unit':_0xb54897[_0x138598(0x1d5)],'secondary_unit':_0xb54897[_0x138598(0x1b8)],'expiry_date':_0xb54897[_0x138598(0x25e)]}));}),await _0x51bc5b[_0x1ca449(0x1ea)]();const _0x5d6e57=await purchases[_0x1ca449(0x18f)]({'invoice':_0x34d7e5});_0x5d6e57[_0x1ca449(0x1d7)]=_0x1ca449(0x265);const _0x2ac973=await _0x5d6e57[_0x1ca449(0x1ea)](),_0x2c3249=new s_payment_data({'invoice':_0x34d7e5,'suppliers':_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x183)],'reason':_0x1ca449(0x188)});await _0x2c3249['save']();const _0x5dac7f=await master_shop[_0x1ca449(0x20a)]();console['log'](_0x1ca449(0x1a0),_0x5dac7f[0x0][_0x1ca449(0x1c4)]);const _0x34796e=await email_settings[_0x1ca449(0x18f)](),_0xbec757=await suppliers[_0x1ca449(0x18f)]({'name':_0x357868[_0x1ca449(0x1fb)][_0x1ca449(0x183)]});console['log'](_0x1ca449(0x268),_0xbec757);_0x5dac7f[0x0][_0x1ca449(0x210)]==0x1?(right_currency=_0x5dac7f[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x5dac7f[0x0][_0x1ca449(0x26b)]);var _0x1f079c=_0x146c39,_0x41ccc4=_0x26c154,_0x47fb0c='',_0x5b993c;for(_0x5b993c in _0x1f079c){_0x47fb0c+=_0x1ca449(0x264)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1f079c[_0x5b993c]+'</td>'+_0x1ca449(0x1f1)+_0x41ccc4[_0x5b993c]+_0x1ca449(0x271)+'</tr>';}console[_0x1ca449(0x244)](_0x1ca449(0x18c),_0x47fb0c);let _0x57d4e8=nodemailer[_0x1ca449(0x1ba)]({'service':_0x1ca449(0x282),'auth':{'user':_0x34796e[_0x1ca449(0x1c6)],'pass':_0x34796e[_0x1ca449(0x248)]}}),_0x492dd3={'from':_0x34796e[_0x1ca449(0x1c6)],'to':_0xbec757[_0x1ca449(0x1c6)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':_0x1ca449(0x24d),'path':__dirname+_0x1ca449(0x1c3)+_0x1ca449(0x23a)+_0x5dac7f[0x0][_0x1ca449(0x1c4)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x1ca449(0x260)+_0x1ca449(0x252)+_0x1ca449(0x1be)+_0x1ca449(0x252)+_0x1ca449(0x29c)+_0x1ca449(0x198)+'<div>'+'<h2>\x20'+_0x5dac7f[0x0][_0x1ca449(0x286)]+_0x1ca449(0x218)+_0x1ca449(0x198)+'</div>'+_0x1ca449(0x1e4)+_0x1ca449(0x252)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x1ca449(0x24b)+_0x34d7e5+'\x20'+_0x1ca449(0x202)+_0x1ca449(0x1e3)+_0x324dd5+'\x20'+_0x1ca449(0x21c)+_0x1ca449(0x1df)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x1ca449(0x22a)+_0x1ca449(0x25d)+_0x1ca449(0x214)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x1ca449(0x285)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x47fb0c+'\x20'+_0x1ca449(0x191)+_0x1ca449(0x1a9)+_0x1ca449(0x252)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x5dac7f[0x0]['site_title']+_0x1ca449(0x1df)+_0x1ca449(0x198)+_0x1ca449(0x198)+'</body></html>'};_0x57d4e8[_0x1ca449(0x26f)](_0x492dd3,function(_0x2c8cdb,_0x1b697a){var _0x14c57a=_0x1ca449;_0x2c8cdb?(console['log'](_0x2c8cdb),console[_0x14c57a(0x244)](_0x14c57a(0x203))):console[_0x14c57a(0x244)](_0x14c57a(0x19b));}),_0x357868[_0x1ca449(0x245)](_0x1ca449(0x1bb),_0x1ca449(0x1ad)),_0x33c779[_0x1ca449(0x1a4)](_0x1ca449(0x25f));}catch(_0x3429a2){console[_0x1ca449(0x244)](_0x3429a2),_0x33c779[_0x1ca449(0x17e)](0xc8)[_0x1ca449(0x21e)]({'message':_0x3429a2[_0x1ca449(0x219)]});}}),router['get']('/barcode/:id',auth,async(_0x4f9ff8,_0x345be1)=>{var _0x50a477=a0_0x3d2d6a;try{const {username:_0x4fbbc5,email:_0x3b8ddb,role:_0x26544e}=_0x4f9ff8['user'],_0x576a94=_0x4f9ff8[_0x50a477(0x1cc)],_0x125329=await profile[_0x50a477(0x18f)]({'email':_0x576a94[_0x50a477(0x1c6)]}),_0x26e7a2=await master_shop[_0x50a477(0x20a)](),_0x13f895=_0x4f9ff8['params']['id'],_0x272eda=await purchases[_0x50a477(0x229)](_0x13f895);if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x1ab))var _0x47d0c9=users[_0x50a477(0x1d4)];else{if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x278))var _0x47d0c9=users[_0x50a477(0x278)];else{if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x1c1))var _0x47d0c9=users[_0x50a477(0x1c1)];else{if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x247))var _0x47d0c9=users[_0x50a477(0x247)];else{if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x292))var _0x47d0c9=users[_0x50a477(0x292)];else{if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x23b))var _0x47d0c9=users['Portuguese'];else{if(_0x26e7a2[0x0][_0x50a477(0x21b)]==_0x50a477(0x259))var _0x47d0c9=users[_0x50a477(0x259)];else{if(_0x26e7a2[0x0]['language']=='Arabic\x20(ae)')var _0x47d0c9=users[_0x50a477(0x1ee)];}}}}}}}_0x345be1['render'](_0x50a477(0x180),{'success':_0x4f9ff8[_0x50a477(0x245)](_0x50a477(0x1bb)),'errors':_0x4f9ff8[_0x50a477(0x245)](_0x50a477(0x240)),'role':_0x576a94,'profile':_0x125329,'alldata':_0x272eda,'master_shop':_0x26e7a2,'language':_0x47d0c9}),console[_0x50a477(0x244)](alldata);}catch(_0x33a931){console[_0x50a477(0x244)](_0x33a931);}}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x258),async(_0x777aa5,_0x4b77dc)=>{var _0x368d87=a0_0x3d2d6a;const {product_code:_0x4e1958}=_0x777aa5['body'];var _0x3afa97;const _0x159113=await product[_0x368d87(0x22d)]([{'$match':{'primary_code':_0x4e1958,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x368d87(0x1f6),'name':{'$first':_0x368d87(0x1c9)},'category':{'$first':_0x368d87(0x1b3)},'brand':{'$first':_0x368d87(0x1b6)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x368d87(0x1a7)},'product_code':{'$first':_0x368d87(0x182)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x368d87(0x222)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x368d87(0x242)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x368d87(0x23f)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x29b32e=await product[_0x368d87(0x22d)]([{'$match':{'secondary_code':_0x4e1958,'product_category':_0x368d87(0x1f8)}},{'$group':{'_id':_0x368d87(0x1f6),'name':{'$first':'$name'},'category':{'$first':_0x368d87(0x1b3)},'brand':{'$first':_0x368d87(0x1b6)},'unit':{'$first':_0x368d87(0x1cf)},'alertquantity':{'$first':_0x368d87(0x1a7)},'product_code':{'$first':_0x368d87(0x182)},'primary_code':{'$first':_0x368d87(0x22e)},'secondary_code':{'$first':_0x368d87(0x222)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x368d87(0x242)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x159113[_0x368d87(0x1a6)]>0x0)_0x3afa97=_0x159113;else _0x29b32e['length']>0x0&&(_0x3afa97=_0x29b32e);_0x4b77dc[_0x368d87(0x21e)](_0x3afa97);}),router[a0_0x3d2d6a(0x27e)](a0_0x3d2d6a(0x29a),async(_0x511793,_0x446a60)=>{var _0x19e669=a0_0x3d2d6a;const {primaryCode:_0x44cfb4,secondaryCode:_0x489782,productCode:_0x43926e,bay:_0x95ea50,bin:_0x2adb3d,types:_0x847e31,pallet:_0x4443e4,warehouses:_0x3b9529,room:_0x5e7598}=_0x511793[_0x19e669(0x1fb)];console['log'](_0x511793[_0x19e669(0x1fb)]);try{const _0x3f6be4=await warehouse[_0x19e669(0x22d)]([{'$match':{'name':_0x3b9529,'room':_0x5e7598}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x95ea50,'product_details.bin':_0x2adb3d,'product_details.type':_0x847e31}},{'$group':{'_id':_0x19e669(0x196),'name':{'$first':_0x19e669(0x221)},'product_stock':{'$first':_0x19e669(0x199)},'level':{'$first':'$product_details.level'},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x19e669(0x27d)},'maxProducts':{'$first':_0x19e669(0x181)}}}]);_0x446a60[_0x19e669(0x17e)](0xc8)['json'](_0x3f6be4);}catch(_0x3b52ac){_0x446a60[_0x19e669(0x17e)](0x194)[_0x19e669(0x21e)]({'message':_0x3b52ac['message']});}}),module[a0_0x3d2d6a(0x19c)]=router;