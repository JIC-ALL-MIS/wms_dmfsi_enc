var a0_0xffb7c4=a0_0x3f9d;(function(_0x7e144c,_0x5530f9){var _0x25eee7=a0_0x3f9d,_0x4d9ee1=_0x7e144c();while(!![]){try{var _0x203747=parseInt(_0x25eee7(0x19a))/0x1+parseInt(_0x25eee7(0x183))/0x2*(-parseInt(_0x25eee7(0x107))/0x3)+-parseInt(_0x25eee7(0x103))/0x4*(-parseInt(_0x25eee7(0x191))/0x5)+-parseInt(_0x25eee7(0x1d5))/0x6+-parseInt(_0x25eee7(0x153))/0x7*(-parseInt(_0x25eee7(0x140))/0x8)+parseInt(_0x25eee7(0x16a))/0x9*(parseInt(_0x25eee7(0x1ba))/0xa)+-parseInt(_0x25eee7(0x14c))/0xb;if(_0x203747===_0x5530f9)break;else _0x4d9ee1['push'](_0x4d9ee1['shift']());}catch(_0x5b5b2e){_0x4d9ee1['push'](_0x4d9ee1['shift']());}}}(a0_0x2589,0x3ea1a));const express=require(a0_0xffb7c4(0x147)),app=express(),router=express[a0_0xffb7c4(0x144)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xffb7c4(0x104)),auth=require(a0_0xffb7c4(0x12b)),nodemailer=require(a0_0xffb7c4(0x12f));function a0_0x2589(){var _0x49a000=['isle','../middleware/auth','maxStocks','room','$product_code','nodemailer','purchases\x20item\x20return\x20successfull','success','/upload/','Chinese','Return\x20Goods','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','add_purchases\x20error','True','prod_Qty','bay','aggregate','$warehouse_name','$batch_code','Ambient','add_purchases','Sales\x20Update\x20successfully','56bvORpT','payment\x20successfull','JO_number','Spanish','Router','standard_unit','name','express','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','invoice','purchase_invoice','suppliers_docs','3468300TnztuT','$maxProdPerUnit','$product_details.product_stock','product_code','Purchase\x20Return\x20Mail','edit_purchases_view','suppliers_data','376495KqWIEK','map','error','type','storage','then','POnumber','slice','room_name','secondary_unit','Rack\x20C','prod_level','Rack\x20A','$product_details.product_name','$invoice','/view/:id','stock_data','pallet','alertQTY','</head><body>','$note','Level','prod_unit','1769373UdvgUR','primary_code_hide','getDate','warehouse','/view','level','message','rak','\x20<\x20wew\x20>\x20','../public/language/languages.json','<tr>','$product.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','suppliers','createTransport','purchase_quantity','get','Paid\x20For\x20Purchase','floor','$product_details.bin','English','product_stock','return_purchase','return_qty','maxperunit','1738SelzQG','/view/add_purchases','/view/return_purchase/:id','rack','Logo.png','log','post','redirect','secondary_code_hide','$product_details.type','$suppliers_docs','Rack\x20D','<html><head><title></title>','$date','7570SgzkQc','table\x20page','$product_details.product_code','string','language','prod_pallet','</h5>','$product_details._id','render','19156PbtJYi','actual_qty','RoomAssign','/../public','$product_details.storage','stocks','host','RMSEmail','Hindi','COLD\x20STORAGE','$brand','image','find','\x20Order\x20Number\x20:\x20','bin','<strong>\x20Regards\x20</strong>','ejs','\x20</h2>','currency','body','$finalize','here','Rack\x20B','port','quantity','Rack\x20F','$product_details.rack','due_amount','</div>','primary_code','amount','$product','10grzkzm','<span\x20style=\x22float:\x20right;\x22>','errors','prod_cat','/barcode/:id','product_name','json','$product_details.floorlevel','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$expiry_date','email','</table>','$return_data','French','</td>','$product_details.primary_code','all','return_product','DRY\x20STORAGE','$product_details.secondary_code','$secondary_code','site_title','flash','finalize','</tr>','user_id','currency_placement','1616964SgHtrI','role','production_date','</tbody>','sendMail','$maxStocks','/view/add_purchases/:id','Portuguese\x20(BR)','Shelves','random','warehouse_name','gmail','expiry_date','deliverycode','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$unit','paid_amount','Purchase\x20Return','Receiving\x20Area','filter','padStart','Email\x20sent\x20successfully','$product.floorlevel','$product.room_name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.bay','Portuguese','$secondary_unit','<h5>','all_purchases','$product.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','date','master','\x20<>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','logo','Raw\x20Materials','$name','$_id','return_data','user','forEach','catch','length','push','stock_quantity','<!DOCTYPE\x20html>','/all_purchases/view','note','floorlevel','$room','$primary_code','$paid_amount','max_product_unit','$alertquantity','MaxStocks_data','staff','$product_details.pallet','An\x20error\x20occurred\x20while\x20saving\x20data.','actual_uom','/give_payment/:id','/CheckingWarehouse','foreach\x20newproduct','product','getMonth','$due_amount','product_code_hide','<h2>\x20','delivery_date','$category','prod_invoice','/invoice/:id','Enabled','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','save','product_list','prod_isle','$product_details','params','German','INC-','$suppliers','704ILmIKd','../models/all_models','prod_secondunit','prod_code','60ohvGHx','<h5\x20style=\x22text-align:\x20left;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.isle','Purchase\x20data\x20added\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_primunit','concat','$product.quantity','abs','<table\x20style=\x22width:\x20100%\x20!important;\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','status','<hr\x20class=\x22my-3\x22>','types','Arabic','Error\x20Occurs','Purchase\x20Mail','English\x20(US)','$product_details.bay','batch_code','</body></html>','secondary_code','Floor','findById','prod_name','product_cat','/barcode_scanner','<div>','edit_purchases','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Arabic\x20(ae)','delivery_code','findOne'];a0_0x2589=function(){return _0x49a000;};return a0_0x2589();}function a0_0x3f9d(_0x209a73,_0x4ef08e){var _0x2589e9=a0_0x2589();return a0_0x3f9d=function(_0x3f9d85,_0x37670d){_0x3f9d85=_0x3f9d85-0xe5;var _0x57a837=_0x2589e9[_0x3f9d85];return _0x57a837;},a0_0x3f9d(_0x209a73,_0x4ef08e);}var ejs=require(a0_0xffb7c4(0x1aa));const path=require('path'),users=require(a0_0xffb7c4(0x173));router['get'](a0_0xffb7c4(0x16e),auth,async(_0x2d7e7b,_0x284e7b)=>{var _0x3fd0d4=a0_0xffb7c4;try{const {username:_0x2705d5,email:_0x4ac8ce,role:_0xb16d63}=_0x2d7e7b['user'],_0x16582f=_0x2d7e7b[_0x3fd0d4(0x1fe)],_0x2922af=await profile[_0x3fd0d4(0x129)]({'email':_0x16582f[_0x3fd0d4(0x1c4)]}),_0x185b16=await staff[_0x3fd0d4(0x129)]({'email':_0x16582f['email']});if(_0x16582f[_0x3fd0d4(0x1d6)]==_0x3fd0d4(0xe8)){const _0x418675=await staff[_0x3fd0d4(0x129)]({'email':_0x16582f[_0x3fd0d4(0x1c4)]});}const _0x4c2c68=await master_shop['find']();let _0xa271db;if(_0x16582f['role']=='staff'){const _0x36cbd8=await staff[_0x3fd0d4(0x129)]({'email':_0x16582f[_0x3fd0d4(0x1c4)]});_0xa271db=await purchases[_0x3fd0d4(0x13a)]([{'$match':{'warehouse_name':_0x36cbd8[_0x3fd0d4(0x16d)]}},{'$lookup':{'from':_0x3fd0d4(0x177),'localField':'suppliers','foreignField':_0x3fd0d4(0x146),'as':'suppliers_docs'}},{'$unwind':_0x3fd0d4(0x18d)},{'$unwind':'$product'},{'$group':{'_id':_0x3fd0d4(0x1fc),'invoice':{'$first':_0x3fd0d4(0x161)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x3fd0d4(0x190)},'warehouse_name':{'$first':_0x3fd0d4(0x13b)},'room':{'$first':_0x3fd0d4(0x208)},'product':{'$push':'$product'},'note':{'$first':_0x3fd0d4(0x167)},'paid_amount':{'$first':_0x3fd0d4(0x20a)},'due_amount':{'$first':_0x3fd0d4(0xf1)},'return_data':{'$first':_0x3fd0d4(0x1c6)},'batch_code':{'$first':_0x3fd0d4(0x13c)},'expiry_date':{'$first':_0x3fd0d4(0x1c3)},'suppliers_docs':{'$first':_0x3fd0d4(0x18d)},'total_product_quantity':{'$sum':_0x3fd0d4(0x10f)},'level':{'$addToSet':_0x3fd0d4(0x1ee)},'isle':{'$addToSet':_0x3fd0d4(0x1f3)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x3fd0d4(0x1eb)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xa271db=await purchases[_0x3fd0d4(0x13a)]([{'$lookup':{'from':'suppliers','localField':_0x3fd0d4(0x177),'foreignField':_0x3fd0d4(0x146),'as':_0x3fd0d4(0x14b)}},{'$unwind':_0x3fd0d4(0x18d)},{'$unwind':'$product'},{'$group':{'_id':_0x3fd0d4(0x1fc),'invoice':{'$first':_0x3fd0d4(0x161)},'suppliers':{'$first':_0x3fd0d4(0x102)},'date':{'$first':_0x3fd0d4(0x190)},'warehouse_name':{'$first':_0x3fd0d4(0x13b)},'room':{'$addToSet':_0x3fd0d4(0x1ec)},'product':{'$push':_0x3fd0d4(0x1b9)},'note':{'$first':_0x3fd0d4(0x167)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x3fd0d4(0xf1)},'return_data':{'$first':_0x3fd0d4(0x1c6)},'batch_code':{'$first':_0x3fd0d4(0x13c)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3fd0d4(0x18d)},'total_product_quantity':{'$sum':_0x3fd0d4(0x10f)},'level':{'$addToSet':_0x3fd0d4(0x1ee)},'isle':{'$addToSet':_0x3fd0d4(0x1f3)},'type':{'$addToSet':_0x3fd0d4(0x175)},'floorlevel':{'$addToSet':_0x3fd0d4(0x1eb)},'finalize':{'$first':_0x3fd0d4(0x1ae)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x4c2c68[0x0]['language']=='English\x20(US)'){var _0x2a5f5e=users[_0x3fd0d4(0x17e)];console[_0x3fd0d4(0x188)](_0x2a5f5e);}else{if(_0x4c2c68[0x0][_0x3fd0d4(0x195)]==_0x3fd0d4(0x1a2))var _0x2a5f5e=users[_0x3fd0d4(0x1a2)];else{if(_0x4c2c68[0x0][_0x3fd0d4(0x195)]=='German')var _0x2a5f5e=users[_0x3fd0d4(0x100)];else{if(_0x4c2c68[0x0]['language']==_0x3fd0d4(0x143))var _0x2a5f5e=users['Spanish'];else{if(_0x4c2c68[0x0]['language']==_0x3fd0d4(0x1c7))var _0x2a5f5e=users[_0x3fd0d4(0x1c7)];else{if(_0x4c2c68[0x0]['language']==_0x3fd0d4(0x1dc))var _0x2a5f5e=users['Portuguese'];else{if(_0x4c2c68[0x0][_0x3fd0d4(0x195)]==_0x3fd0d4(0x133))var _0x2a5f5e=users['Chinese'];else{if(_0x4c2c68[0x0]['language']==_0x3fd0d4(0x127))var _0x2a5f5e=users[_0x3fd0d4(0x116)];}}}}}}}_0x284e7b[_0x3fd0d4(0x199)](_0x3fd0d4(0x1f2),{'success':_0x2d7e7b[_0x3fd0d4(0x1d0)](_0x3fd0d4(0x131)),'errors':_0x2d7e7b['flash'](_0x3fd0d4(0x1bc)),'purchases':_0xa271db,'role':_0x16582f,'profile':_0x2922af,'master_shop':_0x4c2c68,'language':_0x2a5f5e});}catch(_0x33a063){console[_0x3fd0d4(0x188)](_0x3fd0d4(0x192),_0x33a063),_0x284e7b[_0x3fd0d4(0x113)](0xc8)[_0x3fd0d4(0x1c0)]({'message':_0x33a063[_0x3fd0d4(0x170)]});}});function BayBinSelected(_0x514dde,_0x386709){var _0x5bc8e7=a0_0xffb7c4,_0x24857e=[],_0x10ac5f=[],_0x1088b2=[],_0x2c7007=[],_0xeee635=[],_0x2a286b=[];let _0x2f6eba=[];if(_0x514dde==_0x5bc8e7(0x1cc))switch(_0x386709){case'Rack\x20A':_0x24857e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x10ac5f=[0x1,0x2],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168),_0x5bc8e7(0x11e)],_0xeee635=['D'],_0x2a286b=['A'];break;case _0x5bc8e7(0x1b0):_0x24857e=[0x6,0x5,0x4,0x3,0x2,0x1],_0x10ac5f=[0x1,0x2],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168),_0x5bc8e7(0x11e)],_0xeee635=['D'],_0x2a286b=['B'];break;case _0x5bc8e7(0x1dd):_0x24857e=[0x0],_0x10ac5f=[0x0],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x11e)],_0xeee635=['D'],_0x2a286b=['S'];break;case'Receiving\x20Area':_0x24857e=[0x0],_0x10ac5f=[0x0],_0x2c7007=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1088b2=['Floor'],_0xeee635=['D'],_0x2a286b=['R'];break;}else{if(_0x514dde==_0x5bc8e7(0x1a3))switch(_0x386709){case _0x5bc8e7(0x15f):_0x24857e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x10ac5f=['B','F'],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168),'Floor'],_0xeee635=['C'],_0x2a286b=['A'];break;case _0x5bc8e7(0x1b0):_0x24857e=[0x5,0x4,0x3,0x2,0x1],_0x10ac5f=['F','B','S'],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168),_0x5bc8e7(0x11e)],_0xeee635=['C'],_0x2a286b=['B'];break;case _0x5bc8e7(0x15d):_0x24857e=[0x1,0x2,0x3,0x4,0x5],_0x10ac5f=['B','F','S'],_0x2c7007=[0x5,0x4,0x3,0x2,0x1],_0x1088b2=['Level','Floor'],_0xeee635=['C'],_0x2a286b=['C'];break;case _0x5bc8e7(0x18e):_0x24857e=[0x5,0x4,0x3,0x2,0x1],_0x10ac5f=['F','B','S'],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168),_0x5bc8e7(0x11e)],_0xeee635=['C'],_0x2a286b=['D'];break;case'Rack\x20E':_0x24857e=[0x4,0x3,0x2,0x1],_0x10ac5f=[0x1,0x2],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168),'Floor'],_0xeee635=['C'],_0x2a286b=['E'];break;case _0x5bc8e7(0x1b3):_0x24857e=[0x1,0x2,0x3],_0x10ac5f=[0x1,0x2],_0x2c7007=[0x1,0x2,0x3,0x4,0x5],_0x1088b2=[_0x5bc8e7(0x168)],_0xeee635=['C'],_0x2a286b=['F'];break;}}return{'levels':_0x24857e,'Isle':_0x10ac5f,'rack':_0x2c7007,'type':_0x1088b2,'storage':_0xeee635,'rak':_0x2a286b};}async function getRandom8DigitNumber(){var _0x3ae2c5=a0_0xffb7c4;const _0x475fd1=0x989680,_0x4cf259=0x5f5e0ff,_0x5c5f09=Math[_0x3ae2c5(0x17c)](Math[_0x3ae2c5(0x1de)]()*(_0x4cf259-_0x475fd1+0x1))+_0x475fd1;var _0x1eb81c;const _0x5d207b=await purchases[_0x3ae2c5(0x129)]({'invoice':_0x3ae2c5(0x101)+_0x5c5f09});return _0x5d207b&&_0x5d207b[_0x3ae2c5(0x201)]>0x0?_0x1eb81c=_0x3ae2c5(0x101)+_0x5c5f09:_0x1eb81c=_0x3ae2c5(0x101)+_0x5c5f09,_0x1eb81c;}router['get'](a0_0xffb7c4(0x184),auth,async(_0x1bcdbb,_0x48abd1)=>{var _0x51d16d=a0_0xffb7c4;try{const {username:_0x47f9a3,email:_0x59dfc5,role:_0x4f11ff}=_0x1bcdbb[_0x51d16d(0x1fe)],_0xc732d1=_0x1bcdbb[_0x51d16d(0x1fe)],_0x4852b0=await profile[_0x51d16d(0x129)]({'email':_0xc732d1[_0x51d16d(0x1c4)]}),_0x35b7a4=await master_shop[_0x51d16d(0x1a6)](),_0x2a91f4=await staff['findOne']({'email':_0xc732d1[_0x51d16d(0x1c4)]}),_0x14816f=await suppliers['find']({});let _0xf7fb44;if(_0xc732d1['role']==_0x51d16d(0xe8)){const _0x508650=await staff[_0x51d16d(0x129)]({'email':_0xc732d1[_0x51d16d(0x1c4)]});_0xf7fb44=await warehouse[_0x51d16d(0x13a)]([{'$match':{'status':_0x51d16d(0xf8),'name':_0x508650[_0x51d16d(0x16d)],'warehouse_category':_0x51d16d(0x1fa),'name':{'$ne':_0x51d16d(0x134)}}},{'$group':{'_id':_0x51d16d(0x1fb),'name':{'$first':'$name'}}}]);}else _0xf7fb44=await warehouse[_0x51d16d(0x13a)]([{'$match':{'status':_0x51d16d(0xf8),'warehouse_category':_0x51d16d(0x1fa),'name':{'$ne':_0x51d16d(0x134)}}},{'$group':{'_id':_0x51d16d(0x1fb),'name':{'$first':_0x51d16d(0x1fb)}}}]);const _0x3d40d8=await product['find']({}),_0xeaaf5e=await warehouse[_0x51d16d(0x1a6)]({'status':_0x51d16d(0xf8)}),_0x116529=await purchases[_0x51d16d(0x1a6)]({}),_0x55b421=_0x116529['length']+0x1,_0x597513=_0x51d16d(0x101)+_0x55b421['toString']()[_0x51d16d(0x1e9)](0x5,'0');var _0x347330=[_0x51d16d(0x13d),'Enclosed'];if(_0x35b7a4[0x0][_0x51d16d(0x195)]==_0x51d16d(0x119))var _0x403fe0=users[_0x51d16d(0x17e)];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]==_0x51d16d(0x1a2))var _0x403fe0=users['Hindi'];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]==_0x51d16d(0x100))var _0x403fe0=users[_0x51d16d(0x100)];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]=='Spanish')var _0x403fe0=users[_0x51d16d(0x143)];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]==_0x51d16d(0x1c7))var _0x403fe0=users['French'];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]==_0x51d16d(0x1dc))var _0x403fe0=users[_0x51d16d(0x1ef)];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]==_0x51d16d(0x133))var _0x403fe0=users[_0x51d16d(0x133)];else{if(_0x35b7a4[0x0][_0x51d16d(0x195)]=='Arabic\x20(ae)')var _0x403fe0=users[_0x51d16d(0x116)];}}}}}}}const _0x2ccdf2=getRandom8DigitNumber();_0x2ccdf2[_0x51d16d(0x158)](_0x2f0773=>{var _0x1bb316=_0x51d16d;_0x48abd1['render'](_0x1bb316(0x13e),{'success':_0x1bcdbb[_0x1bb316(0x1d0)]('success'),'errors':_0x1bcdbb[_0x1bb316(0x1d0)](_0x1bb316(0x1bc)),'role':_0xc732d1,'profile':_0x4852b0,'suppliers':_0x14816f,'warehouse':_0xf7fb44,'product':_0x3d40d8,'invoice':_0x2f0773,'master_shop':_0x35b7a4,'language':_0x403fe0,'find_data':_0xeaaf5e,'rooms_data':_0x347330});})['catch'](_0x2c0ca4=>{var _0x13822a=_0x51d16d;_0x1bcdbb[_0x13822a(0x1d0)](_0x13822a(0x1bc),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x48abd1[_0x13822a(0x18a)](_0x13822a(0x205));});}catch(_0x360757){console['log'](_0x360757);}}),router[a0_0xffb7c4(0x17a)](a0_0xffb7c4(0x1db),auth,async(_0x3ffe42,_0x251d4f)=>{var _0x9b107a=a0_0xffb7c4;try{const _0x1bd663=_0x3ffe42[_0x9b107a(0xff)]['id'];console[_0x9b107a(0x188)](_0x1bd663);const _0x3c3f48=await master_shop[_0x9b107a(0x1a6)]();console['log'](_0x9b107a(0x1f6),_0x3c3f48);const _0x5e5290=await product['findOne']({'name':_0x1bd663});console[_0x9b107a(0x188)](_0x9b107a(0xef),_0x5e5290),_0x251d4f[_0x9b107a(0x113)](0xc8)[_0x9b107a(0x1c0)]({'product_data':_0x5e5290,'master':_0x3c3f48});}catch(_0x49e6c9){console['log'](_0x9b107a(0x136),_0x49e6c9);}}),router['post'](a0_0xffb7c4(0x184),auth,async(_0xc0a827,_0x9fe151)=>{var _0x3dc823=a0_0xffb7c4;try{const {invoice:_0x335178,date:_0x44fea9,warehouse_name:_0xf8586,prod_name:_0x5f5c3f,prod_code:_0x38a4a1,prod_qty:_0x531f2d,prod_unit:_0x3c5895,prod_secondunit:_0x1ce9b8,prod_level:_0x54758b,prod_isle:_0x495dc3,prod_pallet:_0x1944a1,note:_0x405aaa,expiry_date:_0x158353,batch_code:_0x1a1060,payable:_0xde8a9d,due_amount:_0x40952a,Room_name:_0x341857,primary_code:_0x20c7b8,secondary_code:_0x334e20,MaxStocks_data:_0x5ddcfa,PO_number:_0x5d8e05,SCRN:_0x1435f7,JO_number:_0x934c9f}=_0xc0a827[_0x3dc823(0x1ad)];if(typeof _0x5f5c3f==_0x3dc823(0x194))var _0x27e5ed=[_0xc0a827[_0x3dc823(0x1ad)]['prod_name']],_0x4e6538=[_0xc0a827[_0x3dc823(0x1ad)]['prod_code']],_0x2a30ce=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x138)]],_0x38da2f=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x10d)]],_0x356483=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x105)]],_0x30ae01=[_0xc0a827[_0x3dc823(0x1ad)]['prod_level']],_0x45daf2=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x1b7)]],_0x4982ab=[_0xc0a827['body'][_0x3dc823(0x11d)]],_0x516d3f=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0xe7)]],_0x109ea5=[_0xc0a827['body'][_0x3dc823(0x11b)]],_0x496ec8=[_0xc0a827[_0x3dc823(0x1ad)]['expiry_date']],_0x5c730d=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0xe5)]],_0x200c93=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x165)]],_0x288377=[_0xc0a827[_0x3dc823(0x1ad)]['production_date']],_0x3064c1=[_0xc0a827['body'][_0x3dc823(0x1bd)]],_0xcedaf3=[_0xc0a827['body'][_0x3dc823(0x19c)]],_0x2d41b6=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x1e2)]],_0x58d97d=[_0xc0a827['body'][_0x3dc823(0xf6)]],_0x2da975=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x19b)]],_0x4efee7=[_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0xeb)]];else var _0x27e5ed=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x120)]],_0x4e6538=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x106)]],_0x2a30ce=[..._0xc0a827['body']['prod_Qty']],_0x38da2f=[..._0xc0a827[_0x3dc823(0x1ad)]['prod_primunit']],_0x356483=[..._0xc0a827['body'][_0x3dc823(0x105)]],_0x30ae01=[..._0xc0a827[_0x3dc823(0x1ad)]['prod_level']],_0x45daf2=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x1b7)]],_0x4982ab=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x11d)]],_0x516d3f=[..._0xc0a827['body']['MaxStocks_data']],_0x109ea5=[..._0xc0a827[_0x3dc823(0x1ad)]['batch_code']],_0x496ec8=[..._0xc0a827[_0x3dc823(0x1ad)]['expiry_date']],_0x5c730d=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0xe5)]],_0x200c93=[..._0xc0a827['body'][_0x3dc823(0x165)]],_0x288377=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x1d7)]],_0x3064c1=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x1bd)]],_0xcedaf3=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x19c)]],_0x2d41b6=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x1e2)]],_0x58d97d=[..._0xc0a827[_0x3dc823(0x1ad)]['prod_invoice']],_0x2da975=[..._0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x19b)]],_0x4efee7=[..._0xc0a827['body'][_0x3dc823(0xeb)]];const _0x101104=_0x27e5ed[_0x3dc823(0x154)](_0x5ee287=>{return _0x5ee287={'product_name':_0x5ee287};});_0x2da975[_0x3dc823(0x1ff)]((_0xaa3ae8,_0x1a00fc)=>{var _0xebd7fe=_0x3dc823;_0x101104[_0x1a00fc]['actual_qty']=Math[_0xebd7fe(0x110)](_0xaa3ae8);}),_0x4efee7['forEach']((_0x316c95,_0x431236)=>{var _0x1c3d7f=_0x3dc823;_0x101104[_0x431236][_0x1c3d7f(0xeb)]=_0x316c95;}),_0x4e6538[_0x3dc823(0x1ff)]((_0x28aefa,_0x5264b5)=>{_0x101104[_0x5264b5]['product_code']=_0x28aefa;}),_0x2a30ce[_0x3dc823(0x1ff)]((_0x4f4278,_0x448a5e)=>{var _0x872c48=_0x3dc823;_0x101104[_0x448a5e][_0x872c48(0x1b2)]=Math[_0x872c48(0x110)](_0x4f4278);}),_0x38da2f[_0x3dc823(0x1ff)]((_0x34b122,_0x1bcb26)=>{var _0x1986ca=_0x3dc823;_0x101104[_0x1bcb26][_0x1986ca(0x145)]=_0x34b122;}),_0x356483[_0x3dc823(0x1ff)]((_0x5c5042,_0x226661)=>{var _0x46221f=_0x3dc823;_0x101104[_0x226661][_0x46221f(0x15c)]=_0x5c5042;}),_0x30ae01[_0x3dc823(0x1ff)]((_0x4819bb,_0x35f215)=>{var _0x333c77=_0x3dc823;_0xcedaf3[_0x333c77(0x1ff)]((_0x2446f0,_0x2cac23)=>{var _0x16b465=_0x333c77;if(_0x2446f0==_0x16b465(0x1e7)&&_0x35f215==_0x2cac23){console[_0x16b465(0x188)](_0x2446f0+_0x16b465(0x172)+_0x35f215+_0x16b465(0x1f7)+_0x2cac23+_0x16b465(0x1f7)+_0x4819bb);var _0x1aa1a9=_0x4819bb[_0x16b465(0x15a)](0x3);_0x101104[_0x35f215][_0x16b465(0x157)]=_0x4819bb[0x0],_0x101104[_0x35f215][_0x16b465(0x186)]=_0x4819bb[0x1],_0x101104[_0x35f215]['bay']=0x0,_0x101104[_0x35f215][_0x16b465(0x1a8)]=0x0,_0x101104[_0x35f215]['type']=_0x16b465(0x11e),_0x101104[_0x35f215][_0x16b465(0x207)]=_0x1aa1a9;}else{if(_0x2446f0==_0x16b465(0x1dd)&&_0x35f215==_0x2cac23){var _0x1aa1a9=_0x4819bb[_0x16b465(0x15a)](0x3);_0x101104[_0x35f215][_0x16b465(0x157)]=_0x4819bb[0x0],_0x101104[_0x35f215][_0x16b465(0x186)]=_0x4819bb[0x1],_0x101104[_0x35f215]['bay']=0x0,_0x101104[_0x35f215][_0x16b465(0x1a8)]=0x0,_0x101104[_0x35f215][_0x16b465(0x156)]='Floor',_0x101104[_0x35f215][_0x16b465(0x207)]=_0x4819bb[0x5];}else{if(_0x35f215==_0x2cac23){if(_0x4819bb[0x0]=='A'&&_0x4819bb[0x1]=='L'&&_0x4819bb[0x2]=='L')console[_0x16b465(0x188)](_0x2446f0+_0x16b465(0x1f7)+_0x35f215+'\x20<>\x20'+_0x2cac23+_0x16b465(0x1f7)+_0x4819bb+_0x16b465(0x1af)),_0x101104[_0x35f215][_0x16b465(0x157)]=_0x4819bb[0x0],_0x101104[_0x35f215][_0x16b465(0x186)]=_0x4819bb[0x1],_0x101104[_0x35f215][_0x16b465(0x139)]=0x0,_0x101104[_0x35f215][_0x16b465(0x1a8)]=0x0,_0x101104[_0x35f215]['type']='Floor',_0x101104[_0x35f215][_0x16b465(0x207)]=_0x4819bb[0x3];else{var _0x453879;if(_0x4819bb[0x4]=='L')_0x453879='Level';else _0x4819bb[0x4]=='F'&&(_0x453879=_0x16b465(0x11e));_0x101104[_0x35f215][_0x16b465(0x157)]=_0x4819bb[0x0],_0x101104[_0x35f215][_0x16b465(0x186)]=_0x4819bb[0x1],_0x101104[_0x35f215][_0x16b465(0x139)]=_0x4819bb[0x2],_0x101104[_0x35f215][_0x16b465(0x1a8)]=_0x4819bb[0x3],_0x101104[_0x35f215][_0x16b465(0x156)]=_0x453879,_0x101104[_0x35f215][_0x16b465(0x207)]=_0x4819bb[0x5];}}}}});}),_0x45daf2[_0x3dc823(0x1ff)]((_0xe18e5f,_0x535149)=>{var _0x51fd2e=_0x3dc823;_0x101104[_0x535149][_0x51fd2e(0x1b7)]=_0xe18e5f;}),_0x4982ab[_0x3dc823(0x1ff)]((_0x560b08,_0x51e096)=>{var _0x259f45=_0x3dc823;_0x101104[_0x51e096][_0x259f45(0x11d)]=_0x560b08;}),_0x516d3f[_0x3dc823(0x1ff)]((_0x4473b9,_0x19e57c)=>{_0x101104[_0x19e57c]['maxStocks']=_0x4473b9;}),_0x109ea5[_0x3dc823(0x1ff)]((_0x282b4b,_0x2f99ca)=>{var _0x3bb624=_0x3dc823;_0x101104[_0x2f99ca][_0x3bb624(0x11b)]=_0x282b4b;}),_0x496ec8[_0x3dc823(0x1ff)]((_0x134d28,_0x471e65)=>{var _0x504ba7=_0x3dc823;_0x101104[_0x471e65][_0x504ba7(0x1e1)]=_0x134d28;}),_0x5c730d['forEach']((_0x17b389,_0x27bbd5)=>{var _0x437150=_0x3dc823;_0x101104[_0x27bbd5][_0x437150(0x182)]=_0x17b389;}),_0x200c93['forEach']((_0x354aa8,_0x49a59c)=>{var _0x4244c2=_0x3dc823;_0x101104[_0x49a59c][_0x4244c2(0x165)]=_0x354aa8;}),_0x288377[_0x3dc823(0x1ff)]((_0x4c6cbb,_0x354e34)=>{var _0x15b186=_0x3dc823;_0x101104[_0x354e34][_0x15b186(0x1d7)]=_0x4c6cbb;}),_0x3064c1[_0x3dc823(0x1ff)]((_0x3e88c1,_0x2944f6)=>{var _0x54ab14=_0x3dc823;_0x101104[_0x2944f6][_0x54ab14(0x121)]=_0x3e88c1;}),_0xcedaf3[_0x3dc823(0x1ff)]((_0x558b8f,_0x1678ce)=>{var _0x47d8ef=_0x3dc823;_0x101104[_0x1678ce][_0x47d8ef(0x15b)]=_0x558b8f;}),_0x2d41b6[_0x3dc823(0x1ff)]((_0x3b41e1,_0x931a0f)=>{_0x101104[_0x931a0f]['delivery_code']=_0x3b41e1;}),_0x58d97d[_0x3dc823(0x1ff)]((_0x4a5989,_0x33d053)=>{var _0x2067f8=_0x3dc823;_0x101104[_0x33d053][_0x2067f8(0x149)]=_0x4a5989;});const _0x373863=_0xcedaf3[_0x3dc823(0x154)](_0x379acc=>{return _0x379acc={'room_name':_0x379acc};}),_0x863846=_0x101104[_0x3dc823(0x1e8)](_0x26d231=>_0x26d231['quantity']!=='0'&&_0x26d231[_0x3dc823(0x1b2)]!==''),_0x2dca3c=new purchases({'invoice':_0x335178,'suppliers':_0xc0a827[_0x3dc823(0x1ad)][_0x3dc823(0x177)],'date':_0x44fea9,'warehouse_name':_0xf8586,'product':_0x863846,'note':_0x405aaa,'due_amount':_0x40952a,'POnumber':_0x5d8e05,'SCRN':_0x1435f7,'JO_number':_0x934c9f,'roomList':_0x373863}),_0x612b0f=await _0x2dca3c[_0x3dc823(0xfb)](),_0x548129=await purchases[_0x3dc823(0x129)]({'invoice':_0x335178}),_0x35a447=_0x548129[_0x3dc823(0xef)][_0x3dc823(0x154)](async _0x36da62=>{var _0x1d5c15=_0x3dc823,_0x2199b3=await warehouse[_0x1d5c15(0x129)]({'name':_0xf8586,'room':_0x36da62['room_name']}),_0x4569ed=0x0;return _0x2199b3[_0x1d5c15(0x125)]['forEach'](_0x196e17=>{var _0x5f5a47=_0x1d5c15;_0x196e17['product_name']==_0x36da62['product_name']&&_0x196e17['floorlevel']==_0x36da62[_0x5f5a47(0x207)]&&_0x196e17['type']==_0x36da62[_0x5f5a47(0x156)]&&_0x196e17[_0x5f5a47(0x1a8)]==_0x36da62[_0x5f5a47(0x1a8)]&&_0x196e17[_0x5f5a47(0x139)]==_0x36da62['bay']&&_0x196e17[_0x5f5a47(0x186)]==_0x36da62['rack']&&_0x196e17[_0x5f5a47(0x157)]==_0x36da62[_0x5f5a47(0x157)]&&_0x196e17[_0x5f5a47(0x1e1)]==_0x36da62[_0x5f5a47(0x1e1)]&&_0x196e17[_0x5f5a47(0x11b)]==_0x36da62[_0x5f5a47(0x11b)]&&_0x196e17[_0x5f5a47(0x1d7)]==_0x36da62['production_date']&&_0x196e17[_0x5f5a47(0x149)]==_0x548129[_0x5f5a47(0x149)]&&(_0x196e17[_0x5f5a47(0x17f)]+=Math['abs'](_0x36da62['quantity']),_0x4569ed++);}),_0x4569ed===0x0&&_0x2199b3['product_details'][_0x1d5c15(0x202)]({'product_name':_0x36da62[_0x1d5c15(0x1bf)],'product_stock':Math[_0x1d5c15(0x110)](_0x36da62[_0x1d5c15(0x1b2)]),'primary_code':_0x36da62[_0x1d5c15(0x1b7)],'secondary_code':_0x36da62['secondary_code'],'product_code':_0x36da62[_0x1d5c15(0x14f)],'storage':_0x36da62[_0x1d5c15(0x157)],'rack':_0x36da62[_0x1d5c15(0x186)],'bay':_0x36da62['bay'],'bin':_0x36da62[_0x1d5c15(0x1a8)],'type':_0x36da62[_0x1d5c15(0x156)],'floorlevel':_0x36da62['floorlevel'],'maxProducts':_0x36da62[_0x1d5c15(0x12c)],'unit':_0x36da62[_0x1d5c15(0x145)],'secondary_unit':_0x36da62['secondary_unit'],'expiry_date':_0x36da62['expiry_date'],'maxPerUnit':_0x36da62[_0x1d5c15(0x182)],'batch_code':_0x36da62[_0x1d5c15(0x11b)],'alertQTY':_0x36da62['alertQTY'],'production_date':_0x36da62[_0x1d5c15(0x1d7)],'product_cat':_0x36da62[_0x1d5c15(0x121)],'invoice':_0x36da62['invoice'],'actual_qty':Math[_0x1d5c15(0x110)](_0x36da62[_0x1d5c15(0x19b)]),'actual_uom':_0x36da62[_0x1d5c15(0xeb)]}),_0x2199b3;});Promise[_0x3dc823(0x1ca)](_0x35a447)[_0x3dc823(0x158)](async _0x413bd5=>{var _0x5d816d=_0x3dc823;try{for(const _0x23b889 of _0x413bd5){await _0x23b889[_0x5d816d(0xfb)]();}const _0x50351b=await master_shop[_0x5d816d(0x1a6)](),_0x6f11a2=await email_settings[_0x5d816d(0x129)](),_0x58dabe=await supervisor_settings[_0x5d816d(0x1a6)]();var _0x49b6ec=_0x548129[_0x5d816d(0xef)],_0x512cc8='',_0x56fa4c;for(_0x56fa4c in _0x49b6ec){_0x512cc8+=_0x5d816d(0x174)+_0x5d816d(0x1ed)+_0x49b6ec[_0x56fa4c][_0x5d816d(0x1bf)]+_0x5d816d(0x1c8)+_0x5d816d(0x1ed)+_0x49b6ec[_0x56fa4c]['product_code']+_0x5d816d(0x1c8)+_0x5d816d(0x1ed)+_0x49b6ec[_0x56fa4c][_0x5d816d(0x1b2)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x49b6ec[_0x56fa4c][_0x5d816d(0x145)]+'</td>'+_0x5d816d(0x1ed)+_0x49b6ec[_0x56fa4c][_0x5d816d(0x15c)]+'</td>'+_0x5d816d(0x1ed)+_0x548129[_0x5d816d(0x1df)]+_0x5d816d(0x1c8)+_0x5d816d(0x1ed)+_0x49b6ec[_0x56fa4c]['room_name']+_0x5d816d(0x1c8)+_0x5d816d(0x1ed)+_0x49b6ec[_0x56fa4c][_0x5d816d(0x157)]+_0x49b6ec[_0x56fa4c][_0x5d816d(0x186)]+_0x49b6ec[_0x56fa4c]['bay']+_0x49b6ec[_0x56fa4c]['bin']+_0x49b6ec[_0x56fa4c][_0x5d816d(0x156)][0x0]+_0x49b6ec[_0x56fa4c]['floorlevel']+_0x5d816d(0x1c8),_0x5d816d(0x1d2);}let _0x51fc53=nodemailer[_0x5d816d(0x178)]({'host':_0x6f11a2[_0x5d816d(0x1a0)],'port':Number(_0x6f11a2[_0x5d816d(0x1b1)]),'secure':![],'auth':{'user':_0x6f11a2[_0x5d816d(0x1c4)],'pass':_0x6f11a2['password']}}),_0x10384d={'from':_0x6f11a2[_0x5d816d(0x1c4)],'to':_0x58dabe[0x0][_0x5d816d(0x1a1)],'subject':_0x5d816d(0x118),'attachments':[{'filename':_0x5d816d(0x187),'path':__dirname+_0x5d816d(0x19d)+_0x5d816d(0x132)+_0x50351b[0x0][_0x5d816d(0x1a5)],'cid':'logo'}],'html':_0x5d816d(0x204)+'<html><head><title></title>'+_0x5d816d(0x166)+_0x5d816d(0x123)+_0x5d816d(0x148)+_0x5d816d(0x123)+_0x5d816d(0x109)+_0x5d816d(0x1b6)+'<div>'+'<h2>\x20'+_0x50351b[0x0]['site_title']+'\x20</h2>'+_0x5d816d(0x1b6)+_0x5d816d(0x1b6)+_0x5d816d(0x114)+_0x5d816d(0x123)+_0x5d816d(0x108)+_0x5d816d(0x1a7)+_0x548129[_0x5d816d(0x149)]+'\x20'+_0x5d816d(0x1bb)+'\x20Order\x20Date\x20:\x20'+_0x548129[_0x5d816d(0x1f5)]+'\x20'+'</span>'+_0x5d816d(0x197)+_0x5d816d(0x1b6)+_0x5d816d(0x111)+_0x5d816d(0xf9)+_0x5d816d(0x174)+_0x5d816d(0x126)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5d816d(0x10c)+_0x5d816d(0xfa)+_0x5d816d(0x1f8)+_0x5d816d(0x1c2)+_0x5d816d(0x176)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x5d816d(0x1d2)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x512cc8+'\x20'+'</tbody>'+_0x5d816d(0x1c5)+_0x5d816d(0x123)+_0x5d816d(0x1a9)+_0x5d816d(0x1f1)+_0x50351b[0x0][_0x5d816d(0x1cf)]+'</h5>'+_0x5d816d(0x1b6)+_0x5d816d(0x1b6)+_0x5d816d(0x11c)};_0x51fc53[_0x5d816d(0x1d9)](_0x10384d,function(_0x3c61bf,_0x44c26a){var _0x3f6d72=_0x5d816d;_0x3c61bf?(console[_0x3f6d72(0x188)](_0x3c61bf),console[_0x3f6d72(0x188)](_0x3f6d72(0x117))):console[_0x3f6d72(0x188)](_0x3f6d72(0x1ea));}),_0xc0a827[_0x5d816d(0x1d0)](_0x5d816d(0x131),_0x5d816d(0x10b)),_0x9fe151[_0x5d816d(0x18a)]('/all_purchases/view/');}catch(_0x1c3e18){console['error'](_0x1c3e18),_0x9fe151[_0x5d816d(0x113)](0x1f4)['json']({'error':_0x5d816d(0xea)});}})[_0x3dc823(0x200)](_0x810fa8=>{var _0x402b7e=_0x3dc823;console[_0x402b7e(0x155)](_0x810fa8),_0x9fe151[_0x402b7e(0x113)](0x1f4)[_0x402b7e(0x1c0)]({'error':'An\x20error\x20occurred.'});});}catch(_0x22d202){console[_0x3dc823(0x188)](_0x22d202);}}),router[a0_0xffb7c4(0x17a)]('/preview/:id',auth,async(_0x10d3d1,_0x3d35b2)=>{var _0x56270d=a0_0xffb7c4;try{const {username:_0x4973b1,email:_0x319493,role:_0x393ff5}=_0x10d3d1[_0x56270d(0x1fe)],_0x4d043c=_0x10d3d1[_0x56270d(0x1fe)],_0x1963c9=await profile['findOne']({'email':_0x4d043c['email']}),_0x3e93c6=await master_shop['find'](),_0x4f50ec=_0x10d3d1['params']['id'],_0x594f1e=await purchases[_0x56270d(0x11f)](_0x4f50ec),_0x432f17=await warehouse[_0x56270d(0x13a)]([{'$match':{'name':_0x594f1e[_0x56270d(0x1df)],'room':_0x594f1e[_0x56270d(0x12d)]}},{'$unwind':_0x56270d(0xfe)},{'$group':{'_id':_0x56270d(0x198),'name':{'$first':_0x56270d(0x160)},'product_stock':{'$first':_0x56270d(0x14e)},'bay':{'$first':_0x56270d(0x11a)},'bin':{'$first':_0x56270d(0x17d)},'type':{'$first':_0x56270d(0x18c)},'floorlevel':{'$first':_0x56270d(0x1c1)},'primary_code':{'$first':_0x56270d(0x1c9)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x56270d(0x193)},'storage':{'$first':_0x56270d(0x19e)},'rack':{'$first':_0x56270d(0x1b4)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x624bf0=await customer[_0x56270d(0x1a6)]({});let _0x3cb525;if(_0x4d043c[_0x56270d(0x1d6)]==_0x56270d(0xe8)){const _0x4c573c=await staff['findOne']({'email':_0x4d043c[_0x56270d(0x1c4)]});_0x3cb525=await warehouse[_0x56270d(0x13a)]([{'$match':{'status':_0x56270d(0xf8),'name':_0x4c573c[_0x56270d(0x16d)]}},{'$group':{'_id':'$name','name':{'$first':_0x56270d(0x1fb)}}}]);}else _0x3cb525=await warehouse[_0x56270d(0x13a)]([{'$match':{'status':_0x56270d(0xf8)}},{'$group':{'_id':_0x56270d(0x1fb),'name':{'$first':_0x56270d(0x1fb)}}}]);const _0x127d13=await product['find']({}),_0x18ddb2=await suppliers[_0x56270d(0x1a6)]({}),_0x7fd851=BayBinSelected(_0x594f1e[_0x56270d(0x1df)],_0x594f1e['room']);if(_0x3e93c6[0x0]['language']=='English\x20(US)'){var _0x169747=users[_0x56270d(0x17e)];console['log'](_0x169747);}else{if(_0x3e93c6[0x0][_0x56270d(0x195)]=='Hindi')var _0x169747=users[_0x56270d(0x1a2)];else{if(_0x3e93c6[0x0][_0x56270d(0x195)]==_0x56270d(0x100))var _0x169747=users[_0x56270d(0x100)];else{if(_0x3e93c6[0x0]['language']==_0x56270d(0x143))var _0x169747=users[_0x56270d(0x143)];else{if(_0x3e93c6[0x0]['language']==_0x56270d(0x1c7))var _0x169747=users[_0x56270d(0x1c7)];else{if(_0x3e93c6[0x0][_0x56270d(0x195)]==_0x56270d(0x1dc))var _0x169747=users[_0x56270d(0x1ef)];else{if(_0x3e93c6[0x0]['language']=='Chinese')var _0x169747=users['Chinese'];else{if(_0x3e93c6[0x0][_0x56270d(0x195)]==_0x56270d(0x127))var _0x169747=users['Arabic'];}}}}}}}_0x3d35b2['render'](_0x56270d(0x151),{'success':_0x10d3d1['flash'](_0x56270d(0x131)),'errors':_0x10d3d1[_0x56270d(0x1d0)](_0x56270d(0x1bc)),'role':_0x4d043c,'profile':_0x1963c9,'customer':_0x624bf0,'warehouse':_0x3cb525,'product':_0x432f17,'user':_0x594f1e,'master_shop':_0x3e93c6,'unit':_0x127d13,'language':_0x169747,'suppliers':_0x18ddb2,'dataSelected':_0x7fd851});}catch(_0x241922){console[_0x56270d(0x188)](_0x241922);}}),router[a0_0xffb7c4(0x189)]('/preview/:id',auth,async(_0x1ef7eb,_0x2de815)=>{var _0x898ff0=a0_0xffb7c4;try{const _0x5b019d=_0x1ef7eb['params']['id'],{invoice:_0x4de429,warehouse_name:_0xc68406,Room_name:_0x93ee36}=_0x1ef7eb[_0x898ff0(0x1ad)],_0x10bb01=await warehouse[_0x898ff0(0x129)]({'name':_0xc68406,'room':_0x93ee36}),_0x3e8171=await purchases['findOne']({'invoice':_0x4de429});_0x3e8171[_0x898ff0(0xef)][_0x898ff0(0x1ff)](_0x3c4321=>{var _0x4e97ac=_0x898ff0,_0x3f035c=0x0;const _0x239de1=_0x10bb01['product_details']['map'](_0x318dbb=>{var _0xd54cde=a0_0x3f9d;_0x318dbb[_0xd54cde(0x1bf)]==_0x3c4321[_0xd54cde(0x1bf)]&&_0x318dbb[_0xd54cde(0x207)]==_0x3c4321[_0xd54cde(0x207)]&&_0x318dbb['type']==_0x3c4321[_0xd54cde(0x156)]&&_0x318dbb[_0xd54cde(0x1a8)]==_0x3c4321[_0xd54cde(0x1a8)]&&_0x318dbb[_0xd54cde(0x139)]==_0x3c4321[_0xd54cde(0x139)]&&_0x318dbb[_0xd54cde(0x186)]==_0x3c4321[_0xd54cde(0x186)]&&_0x318dbb['storage']==_0x3c4321['storage']&&_0x318dbb[_0xd54cde(0x1e1)]==_0x3c4321[_0xd54cde(0x1e1)]&&_0x318dbb['batch_code']==_0x3c4321[_0xd54cde(0x11b)]&&_0x318dbb[_0xd54cde(0x1d7)]==_0x3c4321[_0xd54cde(0x1d7)]&&_0x318dbb[_0xd54cde(0xf4)]==_0x3c4321[_0xd54cde(0xf4)]&&_0x318dbb[_0xd54cde(0x128)]==_0x3c4321['delivery_code']&&(_0x318dbb[_0xd54cde(0x17f)]=parseInt(_0x318dbb[_0xd54cde(0x17f)])+parseInt(_0x3c4321['quantity']),_0x3f035c++);});_0x3f035c=='0'&&(_0x10bb01[_0x4e97ac(0x125)]=_0x10bb01[_0x4e97ac(0x125)][_0x4e97ac(0x10e)]({'product_name':_0x3c4321[_0x4e97ac(0x1bf)],'product_stock':_0x3c4321['quantity'],'primary_code':_0x3c4321[_0x4e97ac(0x1b7)],'secondary_code':_0x3c4321['secondary_code'],'product_code':_0x3c4321['product_code'],'storage':_0x3c4321[_0x4e97ac(0x157)],'rack':_0x3c4321['rack'],'bay':_0x3c4321[_0x4e97ac(0x139)],'bin':_0x3c4321[_0x4e97ac(0x1a8)],'type':_0x3c4321[_0x4e97ac(0x156)],'floorlevel':_0x3c4321[_0x4e97ac(0x207)],'maxProducts':_0x3c4321[_0x4e97ac(0x12c)],'unit':_0x3c4321[_0x4e97ac(0x145)],'secondary_unit':_0x3c4321[_0x4e97ac(0x15c)],'expiry_date':_0x3c4321['expiry_date'],'maxPerUnit':_0x3c4321[_0x4e97ac(0x182)],'batch_code':_0x3c4321[_0x4e97ac(0x11b)],'alertQTY':_0x3c4321[_0x4e97ac(0x165)],'production_date':_0x3c4321[_0x4e97ac(0x1d7)],'delivery_date':_0x3c4321[_0x4e97ac(0xf4)],'delivery_code':_0x3c4321[_0x4e97ac(0x128)]}));}),await _0x10bb01['save'](),_0x3e8171[_0x898ff0(0x1d1)]=_0x898ff0(0x137);const _0x2cdfcb=await _0x3e8171[_0x898ff0(0xfb)]();_0x1ef7eb['flash'](_0x898ff0(0x131),_0x898ff0(0x13f)),_0x2de815[_0x898ff0(0x18a)]('/all_purchases/view');}catch(_0x3c09f4){console[_0x898ff0(0x188)](_0x3c09f4);}}),router[a0_0xffb7c4(0x17a)]('/view/:id',auth,async(_0x51f7be,_0x2ad2dd)=>{var _0x299ce8=a0_0xffb7c4;try{const {username:_0x38da2a,email:_0x34955b,role:_0x4ad15b}=_0x51f7be[_0x299ce8(0x1fe)],_0x3d98b4=_0x51f7be[_0x299ce8(0x1fe)],_0x21b2d0=await profile['findOne']({'email':_0x3d98b4[_0x299ce8(0x1c4)]}),_0x492e2d=await master_shop['find'](),_0x2d6de9=_0x51f7be[_0x299ce8(0xff)]['id'],_0x5c8457=await purchases[_0x299ce8(0x11f)](_0x2d6de9),_0x5a73f6=await suppliers[_0x299ce8(0x1a6)]({});let _0x5d05b9;if(_0x3d98b4['role']==_0x299ce8(0xe8)){const _0x2bff49=await staff[_0x299ce8(0x129)]({'email':_0x3d98b4[_0x299ce8(0x1c4)]});_0x5d05b9=await warehouse[_0x299ce8(0x1a6)]({'status':_0x299ce8(0xf8),'name':_0x2bff49[_0x299ce8(0x16d)],'warehouse_category':_0x299ce8(0x1fa)});}else _0x5d05b9=await warehouse[_0x299ce8(0x13a)]([{'$match':{'status':_0x299ce8(0xf8),'warehouse_category':_0x299ce8(0x1fa)}},{'$group':{'_id':'$name','name':{'$first':_0x299ce8(0x1fb)}}}]);const _0x2c64a2=await product[_0x299ce8(0x1a6)]({}),_0x2b6d80=BayBinSelected(_0x5c8457['warehouse_name'],_0x5c8457['room']);let _0x33bfd0=new Date(_0x5c8457[_0x299ce8(0x1e1)]),_0x248d07=('0'+_0x33bfd0[_0x299ce8(0x16c)]())[_0x299ce8(0x15a)](-0x2),_0x5992a9=('0'+(_0x33bfd0[_0x299ce8(0xf0)]()+0x1))[_0x299ce8(0x15a)](-0x2),_0x280362=_0x33bfd0['getFullYear'](),_0x3ef32c=_0x280362+'-'+_0x5992a9+'-'+_0x248d07;if(_0x492e2d[0x0][_0x299ce8(0x195)]==_0x299ce8(0x119)){var _0x490267=users[_0x299ce8(0x17e)];console[_0x299ce8(0x188)](_0x490267);}else{if(_0x492e2d[0x0][_0x299ce8(0x195)]==_0x299ce8(0x1a2))var _0x490267=users[_0x299ce8(0x1a2)];else{if(_0x492e2d[0x0][_0x299ce8(0x195)]==_0x299ce8(0x100))var _0x490267=users['German'];else{if(_0x492e2d[0x0][_0x299ce8(0x195)]==_0x299ce8(0x143))var _0x490267=users[_0x299ce8(0x143)];else{if(_0x492e2d[0x0][_0x299ce8(0x195)]==_0x299ce8(0x1c7))var _0x490267=users[_0x299ce8(0x1c7)];else{if(_0x492e2d[0x0][_0x299ce8(0x195)]==_0x299ce8(0x1dc))var _0x490267=users[_0x299ce8(0x1ef)];else{if(_0x492e2d[0x0][_0x299ce8(0x195)]=='Chinese')var _0x490267=users['Chinese'];else{if(_0x492e2d[0x0][_0x299ce8(0x195)]=='Arabic\x20(ae)')var _0x490267=users[_0x299ce8(0x116)];}}}}}}}_0x2ad2dd[_0x299ce8(0x199)](_0x299ce8(0x124),{'success':_0x51f7be['flash']('success'),'errors':_0x51f7be[_0x299ce8(0x1d0)](_0x299ce8(0x1bc)),'role':_0x3d98b4,'profile':_0x21b2d0,'purchases':_0x5c8457,'suppliers':_0x5a73f6,'warehouse':_0x5d05b9,'product':_0x2c64a2,'master_shop':_0x492e2d,'language':_0x490267,'ed_fullDate':_0x3ef32c,'dataSelected':_0x2b6d80});}catch(_0x53bb9d){console[_0x299ce8(0x188)](_0x53bb9d);}}),router[a0_0xffb7c4(0x189)](a0_0xffb7c4(0x162),auth,async(_0x324b52,_0x5a0ab0)=>{var _0x41ac65=a0_0xffb7c4;try{const _0x32906d=_0x324b52[_0x41ac65(0xff)]['id'],_0x23c295=await purchases[_0x41ac65(0x129)]({'_id':_0x324b52[_0x41ac65(0xff)]['id']}),_0x15a943=await warehouse[_0x41ac65(0x129)]({'name':_0x23c295[_0x41ac65(0x1df)],'room':_0x23c295[_0x41ac65(0x12d)]});_0x23c295['product'][_0x41ac65(0x1ff)](_0x4a4826=>{var _0x30c8e6=_0x41ac65;const _0x29341a=_0x15a943[_0x30c8e6(0x125)]['map'](_0x441c17=>{var _0x15cd84=_0x30c8e6;_0x441c17[_0x15cd84(0x1bf)]==_0x4a4826[_0x15cd84(0x1bf)]&&_0x441c17[_0x15cd84(0x207)]==_0x4a4826[_0x15cd84(0x207)]&&_0x441c17['type']==_0x4a4826[_0x15cd84(0x156)]&&_0x441c17[_0x15cd84(0x1a8)]==_0x4a4826[_0x15cd84(0x1a8)]&&_0x441c17[_0x15cd84(0x139)]==_0x4a4826[_0x15cd84(0x139)]&&_0x441c17[_0x15cd84(0x186)]==_0x4a4826[_0x15cd84(0x186)]&&_0x441c17[_0x15cd84(0x157)]==_0x4a4826[_0x15cd84(0x157)]&&(_0x441c17[_0x15cd84(0x17f)]=parseInt(_0x441c17['product_stock'])-parseInt(_0x4a4826[_0x15cd84(0x1b2)]));});}),await _0x15a943['save']();const {invoice:_0x972dab,suppliers:_0x3b5d9d,date:_0x3df5c4,warehouse_name:_0x5d5a87,prod_name:_0x5acf60,prod_code:_0x27755b,prod_qty:_0x180477,prod_unit:_0x91c0c9,prod_secondunit:_0x5f5b7b,prod_level:_0x3bcad2,prod_isle:_0x25347a,prod_pallet:_0xba353c,note:_0x5359a9,expiry_date:_0x588141,batch_code:_0x3730fb,paid_amount:_0x2f14b3,due_amount:_0x5a8a2e,Room_name:_0x32e901,primary_code:_0x441f9a,secondary_code:_0x17e231,PO_number:_0xd6b084,JO_number:_0x2e1418}=_0x324b52[_0x41ac65(0x1ad)];if(typeof _0x5acf60=='string')var _0x337f8d=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x120)]],_0x1548e4=[_0x324b52['body'][_0x41ac65(0x106)]],_0x25538d=[_0x324b52[_0x41ac65(0x1ad)]['prod_qty']],_0x47248d=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x169)]],_0x5ad57b=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x105)]],_0x2594f2=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x15e)]],_0x461203=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0xfd)]],_0x15010c=[_0x324b52['body'][_0x41ac65(0x196)]],_0x5d97c4=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x1b7)]],_0x553c0b=[_0x324b52['body'][_0x41ac65(0x11d)]],_0x514e20=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0xe7)]],_0x3fea11=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x11b)]],_0x516124=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x1e1)]],_0x51cf3b=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x157)]],_0x2ec1a2=[_0x324b52[_0x41ac65(0x1ad)]['rak']],_0xa9cf4a=[_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x156)]];else var _0x337f8d=[..._0x324b52['body'][_0x41ac65(0x120)]],_0x1548e4=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x106)]],_0x25538d=[..._0x324b52[_0x41ac65(0x1ad)]['prod_qty']],_0x47248d=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x169)]],_0x5ad57b=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x105)]],_0x2594f2=[..._0x324b52['body'][_0x41ac65(0x15e)]],_0x461203=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0xfd)]],_0x15010c=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x196)]],_0x5d97c4=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x1b7)]],_0x553c0b=[..._0x324b52['body'][_0x41ac65(0x11d)]],_0x514e20=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0xe7)]],_0x3fea11=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x11b)]],_0x516124=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x1e1)]],_0x51cf3b=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x157)]],_0x2ec1a2=[..._0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x171)]],_0xa9cf4a=[..._0x324b52[_0x41ac65(0x1ad)]['type']];const _0x1e52f7=_0x337f8d[_0x41ac65(0x154)](_0x40ef5b=>{return _0x40ef5b={'product_name':_0x40ef5b};});_0x1548e4[_0x41ac65(0x1ff)]((_0x1be729,_0xcc5bac)=>{var _0x4674fc=_0x41ac65;_0x1e52f7[_0xcc5bac][_0x4674fc(0x14f)]=_0x1be729;}),_0x25538d['forEach']((_0x32c573,_0x320788)=>{var _0x118361=_0x41ac65;_0x1e52f7[_0x320788][_0x118361(0x1b2)]=_0x32c573;}),_0x47248d[_0x41ac65(0x1ff)]((_0x12ed2a,_0x35bf5a)=>{var _0x514851=_0x41ac65;_0x1e52f7[_0x35bf5a][_0x514851(0x145)]=_0x12ed2a;}),_0x5ad57b[_0x41ac65(0x1ff)]((_0x53c91b,_0x7c20f2)=>{var _0x2ac59f=_0x41ac65;_0x1e52f7[_0x7c20f2][_0x2ac59f(0x15c)]=_0x53c91b;}),_0x2594f2[_0x41ac65(0x1ff)]((_0x4669cd,_0xb53602)=>{var _0x4b53aa=_0x41ac65;_0x1e52f7[_0xb53602][_0x4b53aa(0x139)]=_0x4669cd;}),_0x461203[_0x41ac65(0x1ff)]((_0x15d80c,_0x254a79)=>{var _0x27fe9c=_0x41ac65;_0x1e52f7[_0x254a79][_0x27fe9c(0x1a8)]=_0x15d80c;}),_0x15010c[_0x41ac65(0x1ff)]((_0x578202,_0x595bee)=>{_0x1e52f7[_0x595bee]['floorlevel']=_0x578202;}),_0x5d97c4[_0x41ac65(0x1ff)]((_0x29f399,_0x52ac5e)=>{var _0x1a7588=_0x41ac65;_0x1e52f7[_0x52ac5e][_0x1a7588(0x1b7)]=_0x29f399;}),_0x553c0b['forEach']((_0x4c9610,_0x13d978)=>{var _0x19e0cb=_0x41ac65;_0x1e52f7[_0x13d978][_0x19e0cb(0x11d)]=_0x4c9610;}),_0x514e20[_0x41ac65(0x1ff)]((_0x41ad14,_0xede67f)=>{var _0x11a79b=_0x41ac65;_0x1e52f7[_0xede67f][_0x11a79b(0x12c)]=_0x41ad14;}),_0x3fea11[_0x41ac65(0x1ff)]((_0x252e6d,_0x1b9c9c)=>{var _0x246b7f=_0x41ac65;_0x1e52f7[_0x1b9c9c][_0x246b7f(0x11b)]=_0x252e6d;}),_0x516124[_0x41ac65(0x1ff)]((_0x33c6ef,_0x4d82cc)=>{_0x1e52f7[_0x4d82cc]['expiry_date']=_0x33c6ef;}),_0xa9cf4a['forEach']((_0x1c574c,_0x3067ff)=>{var _0x251a35=_0x41ac65;_0x1e52f7[_0x3067ff][_0x251a35(0x156)]=_0x1c574c;}),_0x51cf3b[_0x41ac65(0x1ff)]((_0x395b71,_0x299d60)=>{var _0x143ca7=_0x41ac65;_0x1e52f7[_0x299d60][_0x143ca7(0x157)]=_0x395b71;}),_0x2ec1a2[_0x41ac65(0x1ff)]((_0x190451,_0x9b2678)=>{var _0x5e4e20=_0x41ac65;_0x1e52f7[_0x9b2678][_0x5e4e20(0x186)]=_0x190451;});const _0x259f01=_0x1e52f7['filter'](_0x4bdadc=>_0x4bdadc['quantity']!=='0'&&_0x4bdadc[_0x41ac65(0x1b2)]!=='');_0x23c295[_0x41ac65(0x149)]=_0x972dab,_0x23c295[_0x41ac65(0x177)]=_0x3b5d9d,_0x23c295['date']=_0x3df5c4,_0x23c295[_0x41ac65(0x1df)]=_0x5d5a87,_0x23c295['product']=_0x259f01,_0x23c295[_0x41ac65(0x206)]=_0x5359a9,_0x23c295['paid_amount']=_0x2f14b3,_0x23c295[_0x41ac65(0x1b5)]=_0x5a8a2e,_0x23c295[_0x41ac65(0x12d)]=_0x32e901,_0x23c295[_0x41ac65(0x159)]=_0xd6b084,_0x23c295[_0x41ac65(0x142)]=_0x2e1418;const _0x405504=await _0x23c295[_0x41ac65(0xfb)](),_0x5a9199=await warehouse[_0x41ac65(0x129)]({'name':_0x324b52['body'][_0x41ac65(0x1df)],'room':_0x324b52['body']['Room_name']});_0x23c295[_0x41ac65(0xef)][_0x41ac65(0x1ff)](_0x30b93c=>{var _0x395552=_0x41ac65,_0x49691f=0x0;const _0x5973f4=_0x5a9199[_0x395552(0x125)]['map'](_0x485887=>{var _0x2ba0b5=_0x395552;_0x485887[_0x2ba0b5(0x1bf)]==_0x30b93c[_0x2ba0b5(0x1bf)]&&_0x485887[_0x2ba0b5(0x207)]==_0x30b93c[_0x2ba0b5(0x207)]&&_0x485887['type']==_0x30b93c[_0x2ba0b5(0x156)]&&_0x485887[_0x2ba0b5(0x1a8)]==_0x30b93c[_0x2ba0b5(0x1a8)]&&_0x485887[_0x2ba0b5(0x139)]==_0x30b93c[_0x2ba0b5(0x139)]&&_0x485887[_0x2ba0b5(0x186)]==_0x30b93c[_0x2ba0b5(0x186)]&&_0x485887['storage']==_0x30b93c['storage']&&(_0x485887[_0x2ba0b5(0x17f)]=parseInt(_0x485887[_0x2ba0b5(0x17f)])+parseInt(_0x30b93c[_0x2ba0b5(0x1b2)]),_0x49691f++);});_0x49691f=='0'&&(_0x5a9199[_0x395552(0x125)]=_0x5a9199['product_details'][_0x395552(0x10e)]({'product_name':_0x30b93c[_0x395552(0x1bf)],'product_stock':_0x30b93c[_0x395552(0x1b2)],'primary_code':_0x30b93c[_0x395552(0x1b7)],'secondary_code':_0x30b93c['secondary_code'],'product_code':_0x30b93c[_0x395552(0x14f)],'storage':_0x30b93c[_0x395552(0x157)],'rack':_0x30b93c[_0x395552(0x186)],'bay':_0x30b93c['bay'],'bin':_0x30b93c['bin'],'type':_0x30b93c['type'],'floorlevel':_0x30b93c[_0x395552(0x207)],'maxProducts':_0x30b93c[_0x395552(0x12c)],'unit':_0x30b93c[_0x395552(0x145)],'secondary_unit':_0x30b93c['secondary_unit'],'expiry_date':_0x30b93c['expiry_date']}));}),await _0x5a9199['save']();const _0x5ee197=await s_payment_data[_0x41ac65(0x129)]({'invoice':_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x149)]});if(_0x5ee197===null){}else console[_0x41ac65(0x188)](_0x41ac65(0x177),_0x5ee197,_0x324b52[_0x41ac65(0x1ad)][_0x41ac65(0x149)]),_0x5ee197[_0x41ac65(0x177)]=_0x324b52[_0x41ac65(0x1ad)]['suppliers'],await _0x5ee197['save']();_0x324b52[_0x41ac65(0x1d0)](_0x41ac65(0x131),'purchase\x20data\x20update\x20successfully'),_0x5a0ab0[_0x41ac65(0x18a)](_0x41ac65(0x205));}catch(_0x4de7b9){console[_0x41ac65(0x188)](_0x4de7b9);}}),router['post'](a0_0xffb7c4(0xec),auth,async(_0x2bf4a0,_0x4b3e83)=>{var _0x5f407d=a0_0xffb7c4;try{const _0x3f9e16=_0x2bf4a0[_0x5f407d(0xff)]['id'],{invoice:_0x3e7e33,suppliers:_0x5760e4,payable:_0x25cd1f,due_amount:_0x27ef5e}=_0x2bf4a0[_0x5f407d(0x1ad)],_0x2e142f=await purchases['findById'](_0x3f9e16);var _0x5329fd=_0x25cd1f-_0x27ef5e;_0x2e142f[_0x5f407d(0x1e5)]=parseFloat(_0x2e142f[_0x5f407d(0x1e5)])+parseFloat(_0x27ef5e),_0x2e142f['due_amount']=_0x5329fd;const _0x5c1ef7=await _0x2e142f[_0x5f407d(0xfb)]();console[_0x5f407d(0x188)](_0x5c1ef7);const _0x5bc104=await s_payment_data[_0x5f407d(0x129)]({'invoice':_0x3e7e33});_0x5bc104[_0x5f407d(0x1b8)]=_0x5329fd,await _0x5bc104[_0x5f407d(0xfb)]();let _0x2b46eb=new Date(),_0x567d06=('0'+_0x2b46eb[_0x5f407d(0x16c)]())[_0x5f407d(0x15a)](-0x2),_0x27dd2d=('0'+(_0x2b46eb[_0x5f407d(0xf0)]()+0x1))[_0x5f407d(0x15a)](-0x2),_0x28fba3=_0x2b46eb['getFullYear'](),_0x2b87fe=_0x28fba3+'-'+_0x27dd2d+'-'+_0x567d06;const _0x4ad2f7=new suppliers_payment({'invoice':_0x3e7e33,'date':_0x28fba3+'-'+_0x27dd2d+'-'+_0x567d06,'suppliers':_0x5760e4,'reason':_0x5f407d(0x17b),'amount':_0x27ef5e}),_0x275228=await _0x4ad2f7[_0x5f407d(0xfb)]();_0x2bf4a0[_0x5f407d(0x1d0)]('success',_0x5f407d(0x141)),_0x4b3e83[_0x5f407d(0x18a)](_0x5f407d(0x205));}catch(_0xc04ab7){console[_0x5f407d(0x188)](_0xc04ab7);}}),router[a0_0xffb7c4(0x17a)](a0_0xffb7c4(0xf7),auth,async(_0x20473f,_0x2d7cc7)=>{var _0x6588a5=a0_0xffb7c4;try{const {username:_0x20aed7,email:_0x4c6b77,role:_0x12b342}=_0x20473f[_0x6588a5(0x1fe)],_0x3ecc9e=_0x20473f['user'],_0x305d98=await profile['findOne']({'email':_0x3ecc9e['email']}),_0x31789a=await master_shop['find']();console[_0x6588a5(0x188)](_0x6588a5(0x1f6),_0x31789a);const _0x3b2c2e=_0x20473f['params']['id'],_0x1d929b=await purchases[_0x6588a5(0x11f)](_0x3b2c2e);console[_0x6588a5(0x188)](_0x1d929b);const _0x11ec21=await suppliers[_0x6588a5(0x129)]({'name':_0x1d929b[_0x6588a5(0x177)]});console['log'](_0x11ec21);if(_0x31789a[0x0][_0x6588a5(0x195)]=='English\x20(US)'){var _0x102b39=users[_0x6588a5(0x17e)];console['log'](_0x102b39);}else{if(_0x31789a[0x0][_0x6588a5(0x195)]==_0x6588a5(0x1a2))var _0x102b39=users[_0x6588a5(0x1a2)];else{if(_0x31789a[0x0][_0x6588a5(0x195)]==_0x6588a5(0x100))var _0x102b39=users[_0x6588a5(0x100)];else{if(_0x31789a[0x0][_0x6588a5(0x195)]==_0x6588a5(0x143))var _0x102b39=users['Spanish'];else{if(_0x31789a[0x0][_0x6588a5(0x195)]=='French')var _0x102b39=users[_0x6588a5(0x1c7)];else{if(_0x31789a[0x0][_0x6588a5(0x195)]==_0x6588a5(0x1dc))var _0x102b39=users[_0x6588a5(0x1ef)];else{if(_0x31789a[0x0][_0x6588a5(0x195)]==_0x6588a5(0x133))var _0x102b39=users[_0x6588a5(0x133)];else{if(_0x31789a[0x0][_0x6588a5(0x195)]==_0x6588a5(0x127))var _0x102b39=users[_0x6588a5(0x116)];}}}}}}}_0x2d7cc7[_0x6588a5(0x199)](_0x6588a5(0x14a),{'success':_0x20473f[_0x6588a5(0x1d0)](_0x6588a5(0x131)),'errors':_0x20473f[_0x6588a5(0x1d0)]('errors'),'role':_0x3ecc9e,'profile':_0x305d98,'master_shop':_0x31789a,'supplier':_0x11ec21,'purchase':_0x1d929b,'language':_0x102b39});}catch(_0x140126){console['log'](_0x140126);}}),router[a0_0xffb7c4(0x17a)](a0_0xffb7c4(0x185),auth,async(_0x14b4c9,_0x3f959d)=>{var _0x13de23=a0_0xffb7c4;try{const {username:_0xc15ec0,email:_0x3db37a,role:_0x19f785}=_0x14b4c9['user'],_0x504edc=_0x14b4c9[_0x13de23(0x1fe)],_0xf52ab5=await profile[_0x13de23(0x129)]({'email':_0x504edc[_0x13de23(0x1c4)]}),_0x194c34=await master_shop['find']();console[_0x13de23(0x188)]('master',_0x194c34);const _0x1b4d7b=_0x14b4c9[_0x13de23(0xff)]['id'];console[_0x13de23(0x188)](_0x1b4d7b);const _0x44a399=await purchases['findById'](_0x1b4d7b);console[_0x13de23(0x188)](_0x13de23(0x1d3),_0x44a399);const _0x49d8ee=await product['find']({}),_0x446fb6=await warehouse['aggregate']([{'$match':{'name':_0x44a399[_0x13de23(0x1df)],'room':_0x44a399[_0x13de23(0x12d)],'warehouse_category':_0x13de23(0x1fa)}},{'$unwind':_0x13de23(0xfe)},{'$group':{'_id':_0x13de23(0x198),'name':{'$first':_0x13de23(0x160)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x13de23(0x11a)},'bin':{'$first':_0x13de23(0x17d)},'type':{'$first':_0x13de23(0x18c)},'floorlevel':{'$first':_0x13de23(0x1c1)},'primary_code':{'$first':_0x13de23(0x1c9)},'secondary_code':{'$first':_0x13de23(0x1cd)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x13de23(0x19e)},'rack':{'$first':_0x13de23(0x1b4)}}}]);warehouse_data=await warehouse[_0x13de23(0x13a)]([{'$match':{'status':_0x13de23(0xf8),'name':_0x13de23(0x134),'warehouse_category':_0x13de23(0x1fa)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x13de23(0x188)](_0x13de23(0x163),_0x446fb6);if(_0x194c34[0x0][_0x13de23(0x195)]==_0x13de23(0x119)){var _0x2c966e=users[_0x13de23(0x17e)];console[_0x13de23(0x188)](_0x2c966e);}else{if(_0x194c34[0x0]['language']==_0x13de23(0x1a2))var _0x2c966e=users[_0x13de23(0x1a2)];else{if(_0x194c34[0x0][_0x13de23(0x195)]==_0x13de23(0x100))var _0x2c966e=users[_0x13de23(0x100)];else{if(_0x194c34[0x0]['language']==_0x13de23(0x143))var _0x2c966e=users[_0x13de23(0x143)];else{if(_0x194c34[0x0][_0x13de23(0x195)]==_0x13de23(0x1c7))var _0x2c966e=users[_0x13de23(0x1c7)];else{if(_0x194c34[0x0][_0x13de23(0x195)]==_0x13de23(0x1dc))var _0x2c966e=users[_0x13de23(0x1ef)];else{if(_0x194c34[0x0]['language']==_0x13de23(0x133))var _0x2c966e=users[_0x13de23(0x133)];else{if(_0x194c34[0x0]['language']=='Arabic\x20(ae)')var _0x2c966e=users[_0x13de23(0x116)];}}}}}}}_0x3f959d[_0x13de23(0x199)](_0x13de23(0x180),{'success':_0x14b4c9[_0x13de23(0x1d0)](_0x13de23(0x131)),'errors':_0x14b4c9['flash'](_0x13de23(0x1bc)),'role':_0x504edc,'profile':_0xf52ab5,'user':_0x44a399,'stock':_0x446fb6,'master_shop':_0x194c34,'product':_0x49d8ee,'language':_0x2c966e,'warehouse':warehouse_data});}catch(_0x13e066){console[_0x13de23(0x188)](_0x13e066);}}),router['post']('/view/return_purchase/:id',auth,async(_0xe0056b,_0x1f9db4)=>{var _0x1308c1=a0_0xffb7c4;try{const {invoice:_0x3566dd,date:_0x500684,warehouse_name:_0x2a65c4,Room_name:_0x2bc986,product_name:_0x4e6b7a,purchase_quantity:_0x5a9eb0,stocks:_0x241da6,return_qty:_0x545c58,note:_0x33e3a3,level:_0x36b189,isle:_0x8b523c,pallet:_0x3f0da3,to_warehouse_name:_0x4599db,to_Room_name:_0x44361e}=_0xe0056b['body'],_0x3ca4a0=await purchases[_0x1308c1(0x129)]({'_id':_0xe0056b[_0x1308c1(0xff)]['id']}),_0x45802b=await warehouse['findOne']({'name':_0x2a65c4,'room':_0x2bc986});if(typeof _0x4e6b7a=='string')var _0xd010c1=[_0xe0056b[_0x1308c1(0x1ad)]['product_name']],_0x3b2527=[_0xe0056b[_0x1308c1(0x1ad)]['purchase_quantity']],_0x4b2ff7=[_0xe0056b['body'][_0x1308c1(0x19f)]],_0x40da3c=[_0xe0056b[_0x1308c1(0x1ad)]['return_qty']],_0x2ad73f=[_0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x16f)]],_0xc49e55=[_0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x12a)]],_0x5541a4=[_0xe0056b[_0x1308c1(0x1ad)]['pallet']],_0x338c87=[_0xe0056b['body'][_0x1308c1(0x115)]],_0x2786fd=[_0xe0056b['body']['product_code_hide']],_0x590de8=[_0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x16b)]],_0x32ba40=[_0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x18b)]];else var _0xd010c1=[..._0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x1bf)]],_0x3b2527=[..._0xe0056b['body'][_0x1308c1(0x179)]],_0x4b2ff7=[..._0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x19f)]],_0x40da3c=[..._0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x181)]],_0x2ad73f=[..._0xe0056b['body'][_0x1308c1(0x16f)]],_0xc49e55=[..._0xe0056b[_0x1308c1(0x1ad)]['isle']],_0x5541a4=[..._0xe0056b['body'][_0x1308c1(0x164)]],_0x338c87=[..._0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x115)]],_0x2786fd=[..._0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0xf2)]],_0x590de8=[..._0xe0056b[_0x1308c1(0x1ad)][_0x1308c1(0x16b)]],_0x32ba40=[..._0xe0056b['body']['secondary_code_hide']];const _0x2f53f5=_0xd010c1[_0x1308c1(0x154)](_0x113eb2=>{return _0x113eb2={'product_name':_0x113eb2};});_0x3b2527[_0x1308c1(0x1ff)]((_0x2f9ebd,_0x57d7a3)=>{_0x2f53f5[_0x57d7a3]['purchase_quantity']=_0x2f9ebd;}),_0x4b2ff7['forEach']((_0x23b16e,_0x5c2f2a)=>{var _0x5e1fbb=_0x1308c1;_0x2f53f5[_0x5c2f2a][_0x5e1fbb(0x203)]=_0x23b16e;}),_0x40da3c['forEach']((_0x22e5b1,_0x3dbe35)=>{var _0x57c4fa=_0x1308c1;_0x2f53f5[_0x3dbe35][_0x57c4fa(0x181)]=_0x22e5b1;}),_0x2ad73f[_0x1308c1(0x1ff)]((_0x3cece6,_0xd37b80)=>{_0x2f53f5[_0xd37b80]['bay']=_0x3cece6;}),_0xc49e55[_0x1308c1(0x1ff)]((_0x3cfba1,_0x5f3bbc)=>{var _0x24f7b7=_0x1308c1;_0x2f53f5[_0x5f3bbc][_0x24f7b7(0x1a8)]=_0x3cfba1;}),_0x5541a4[_0x1308c1(0x1ff)]((_0x423831,_0x2cc2fd)=>{var _0x5d3c94=_0x1308c1;_0x2f53f5[_0x2cc2fd][_0x5d3c94(0x207)]=_0x423831;}),_0x338c87[_0x1308c1(0x1ff)]((_0x3006be,_0x598a6e)=>{_0x2f53f5[_0x598a6e]['type']=_0x3006be;}),_0x2786fd['forEach']((_0x10bed1,_0x45138a)=>{var _0x73c78e=_0x1308c1;_0x2f53f5[_0x45138a][_0x73c78e(0x14f)]=_0x10bed1;}),_0x590de8[_0x1308c1(0x1ff)]((_0x20d0cc,_0xa7e92a)=>{var _0x35ccaa=_0x1308c1;_0x2f53f5[_0xa7e92a][_0x35ccaa(0x1b7)]=_0x20d0cc;}),_0x32ba40[_0x1308c1(0x1ff)]((_0x4a8dcf,_0x562442)=>{var _0x214071=_0x1308c1;_0x2f53f5[_0x562442][_0x214071(0x11d)]=_0x4a8dcf;}),_0x3ca4a0[_0x1308c1(0xef)][_0x1308c1(0x1ff)](_0x46cb55=>{var _0x11e08d=_0x1308c1;const _0x3fe33e=_0x45802b['product_details'][_0x11e08d(0x154)](_0x6d7cbd=>{var _0x911814=_0x11e08d;_0x6d7cbd[_0x911814(0x1bf)]==_0x46cb55['product_name']&&_0x6d7cbd['floorlevel']==_0x46cb55[_0x911814(0x207)]&&_0x6d7cbd[_0x911814(0x156)]==_0x46cb55[_0x911814(0x156)]&&_0x6d7cbd[_0x911814(0x1a8)]==_0x46cb55[_0x911814(0x1a8)]&&_0x6d7cbd['bay']==_0x46cb55[_0x911814(0x139)]&&_0x6d7cbd[_0x911814(0x186)]==_0x46cb55[_0x911814(0x186)]&&_0x6d7cbd[_0x911814(0x157)]==_0x46cb55['storage']&&(console[_0x911814(0x188)](parseInt(_0x6d7cbd['product_stock'])+_0x911814(0x1f7)+parseInt(_0x46cb55[_0x911814(0x1b2)])),_0x6d7cbd[_0x911814(0x17f)]=parseInt(_0x6d7cbd['product_stock'])+parseInt(_0x46cb55[_0x911814(0x1b2)]));});}),await _0x45802b[_0x1308c1(0xfb)]();const _0x4671fc=_0x2f53f5[_0x1308c1(0x1e8)](_0x575150=>_0x575150['return_qty']!=='0'&&_0x575150[_0x1308c1(0x181)]!=='');var _0x26105c=0x0;_0x4671fc[_0x1308c1(0x1ff)](_0x35ae9e=>{var _0x4fd3e5=_0x1308c1;console['log'](_0x4fd3e5(0xee),_0x35ae9e),(parseInt(_0x35ae9e[_0x4fd3e5(0x179)])<parseInt(_0x35ae9e[_0x4fd3e5(0x181)])||parseInt(_0x35ae9e['stock_quantity'])<parseInt(_0x35ae9e[_0x4fd3e5(0x181)]))&&_0x26105c++;});if(_0x26105c!=0x0)return _0xe0056b[_0x1308c1(0x1d0)](_0x1308c1(0x1bc),_0x1308c1(0x135)),_0x1f9db4[_0x1308c1(0x18a)]('back');const _0x3c4fc3=new purchases_return({'invoice':_0x3566dd,'suppliers':_0xe0056b['body'][_0x1308c1(0x177)],'date':_0x500684,'warehouse_name':_0x2a65c4,'return_product':_0x4671fc,'note':_0x33e3a3,'room':_0x2bc986,'to_warehouse_name':_0x4599db,'to_room':_0x44361e}),_0x391c88=await _0x3c4fc3[_0x1308c1(0xfb)]();console[_0x1308c1(0x188)](_0x3c4fc3);const _0x3bb5f2=await purchases_return[_0x1308c1(0x129)]({'invoice':_0x3566dd}),_0x23da36=await warehouse[_0x1308c1(0x129)]({'name':_0x4599db,'room':_0x44361e});_0x3bb5f2[_0x1308c1(0x1cb)][_0x1308c1(0x1ff)](_0x337855=>{var _0x4936c2=_0x1308c1,_0x4ffa84=0x0;const _0x3f6365=_0x23da36[_0x4936c2(0x125)][_0x4936c2(0x154)](_0x4b3dad=>{var _0x454d62=_0x4936c2;_0x4b3dad['product_name']==_0x337855['product_name']&&_0x4b3dad[_0x454d62(0x207)]==_0x337855[_0x454d62(0x207)]&&_0x4b3dad[_0x454d62(0x156)]==_0x337855[_0x454d62(0x156)]&&_0x4b3dad[_0x454d62(0x1a8)]==_0x337855[_0x454d62(0x1a8)]&&_0x4b3dad[_0x454d62(0x139)]==_0x337855[_0x454d62(0x139)]&&(_0x4b3dad[_0x454d62(0x17f)]=parseInt(_0x4b3dad[_0x454d62(0x17f)])-parseInt(_0x337855['return_qty']),_0x4ffa84++);});_0x4ffa84=='0'&&(_0x23da36[_0x4936c2(0x125)]=_0x23da36['product_details'][_0x4936c2(0x10e)]({'product_name':_0x337855['product_name'],'product_stock':_0x337855[_0x4936c2(0x181)],'primary_code':_0x337855['primary_code'],'secondary_code':_0x337855[_0x4936c2(0x11d)],'product_code':_0x337855[_0x4936c2(0x14f)],'storage':_0x337855[_0x4936c2(0x157)],'rack':_0x337855[_0x4936c2(0x186)],'bay':_0x337855['bay'],'bin':_0x337855['bin'],'type':_0x337855['type'],'floorlevel':_0x337855[_0x4936c2(0x207)],'maxProducts':_0x337855[_0x4936c2(0x12c)],'unit':_0x337855[_0x4936c2(0x145)],'secondary_unit':_0x337855[_0x4936c2(0x15c)],'expiry_date':_0x337855[_0x4936c2(0x1e1)]}));}),await _0x23da36[_0x1308c1(0xfb)]();const _0x2e4d3f=await purchases[_0x1308c1(0x129)]({'invoice':_0x3566dd});_0x2e4d3f[_0x1308c1(0x1fd)]=_0x1308c1(0x137);const _0x4b47ea=await _0x2e4d3f[_0x1308c1(0xfb)](),_0x4c436b=new s_payment_data({'invoice':_0x3566dd,'suppliers':_0xe0056b['body'][_0x1308c1(0x177)],'reason':_0x1308c1(0x1e6)});await _0x4c436b[_0x1308c1(0xfb)]();const _0x28d3dd=await master_shop[_0x1308c1(0x1a6)]();console[_0x1308c1(0x188)]('add\x20post',_0x28d3dd[0x0]['image']);const _0x1b85db=await email_settings[_0x1308c1(0x129)](),_0x44c948=await suppliers[_0x1308c1(0x129)]({'name':_0xe0056b[_0x1308c1(0x1ad)]['suppliers']});console['log'](_0x1308c1(0x152),_0x44c948);_0x28d3dd[0x0][_0x1308c1(0x1d4)]==0x1?(right_currency=_0x28d3dd[0x0][_0x1308c1(0x1ac)],left_currency=''):(right_currency='',left_currency=_0x28d3dd[0x0][_0x1308c1(0x1ac)]);var _0x48ab45=_0xd010c1,_0xcb02ed=_0x40da3c,_0x42a6cf='',_0x4f36b7;for(_0x4f36b7 in _0x48ab45){_0x42a6cf+=_0x1308c1(0x174)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x48ab45[_0x4f36b7]+_0x1308c1(0x1c8)+_0x1308c1(0x1ed)+_0xcb02ed[_0x4f36b7]+'</td>'+_0x1308c1(0x1d2);}console[_0x1308c1(0x188)](_0x1308c1(0xfc),_0x42a6cf);let _0x12ee4b=nodemailer['createTransport']({'service':_0x1308c1(0x1e0),'auth':{'user':_0x1b85db[_0x1308c1(0x1c4)],'pass':_0x1b85db['password']}}),_0x52f408={'from':_0x1b85db[_0x1308c1(0x1c4)],'to':_0x44c948[_0x1308c1(0x1c4)],'subject':_0x1308c1(0x150),'attachments':[{'filename':_0x1308c1(0x187),'path':__dirname+_0x1308c1(0x19d)+'/upload/'+_0x28d3dd[0x0]['image'],'cid':_0x1308c1(0x1f9)}],'html':_0x1308c1(0x204)+_0x1308c1(0x18f)+_0x1308c1(0x166)+_0x1308c1(0x123)+_0x1308c1(0x148)+_0x1308c1(0x123)+_0x1308c1(0x109)+_0x1308c1(0x1b6)+_0x1308c1(0x123)+_0x1308c1(0xf3)+_0x28d3dd[0x0][_0x1308c1(0x1cf)]+_0x1308c1(0x1ab)+_0x1308c1(0x1b6)+'</div>'+_0x1308c1(0x114)+_0x1308c1(0x123)+_0x1308c1(0x108)+_0x1308c1(0x1a7)+_0x3566dd+'\x20'+_0x1308c1(0x1bb)+'\x20Order\x20Date\x20:\x20'+_0x500684+'\x20'+'</span>'+'</h5>'+'</div>'+_0x1308c1(0x111)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1308c1(0x174)+_0x1308c1(0x126)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x1308c1(0x1e3)+_0x1308c1(0x1f4)+_0x1308c1(0x1d2)+'</thead>'+_0x1308c1(0x112)+'\x20'+_0x42a6cf+'\x20'+_0x1308c1(0x1d8)+_0x1308c1(0x1c5)+'<div>'+_0x1308c1(0x1a9)+_0x1308c1(0x1f1)+_0x28d3dd[0x0][_0x1308c1(0x1cf)]+_0x1308c1(0x197)+_0x1308c1(0x1b6)+_0x1308c1(0x1b6)+'</body></html>'};_0x12ee4b[_0x1308c1(0x1d9)](_0x52f408,function(_0x4ad87f,_0xb84f2c){var _0x469d9a=_0x1308c1;_0x4ad87f?(console[_0x469d9a(0x188)](_0x4ad87f),console[_0x469d9a(0x188)](_0x469d9a(0x117))):console[_0x469d9a(0x188)]('Email\x20sent\x20successfully');}),_0xe0056b['flash'](_0x1308c1(0x131),_0x1308c1(0x130)),_0x1f9db4[_0x1308c1(0x18a)]('/all_purchases/view');}catch(_0x41d899){console[_0x1308c1(0x188)](_0x41d899),_0x1f9db4[_0x1308c1(0x113)](0xc8)[_0x1308c1(0x1c0)]({'message':_0x41d899[_0x1308c1(0x170)]});}}),router['get'](a0_0xffb7c4(0x1be),auth,async(_0x561643,_0x43bcd1)=>{var _0x1b90b3=a0_0xffb7c4;try{const {username:_0x10b87e,email:_0x5ac0ad,role:_0x289387}=_0x561643[_0x1b90b3(0x1fe)],_0x5ee540=_0x561643['user'],_0x48a547=await profile[_0x1b90b3(0x129)]({'email':_0x5ee540[_0x1b90b3(0x1c4)]}),_0x4ba73f=await master_shop[_0x1b90b3(0x1a6)](),_0x46acae=_0x561643['params']['id'],_0x2bd716=await purchases[_0x1b90b3(0x11f)](_0x46acae);if(_0x4ba73f[0x0]['language']==_0x1b90b3(0x119))var _0x5e413c=users['English'];else{if(_0x4ba73f[0x0][_0x1b90b3(0x195)]==_0x1b90b3(0x1a2))var _0x5e413c=users['Hindi'];else{if(_0x4ba73f[0x0]['language']=='German')var _0x5e413c=users[_0x1b90b3(0x100)];else{if(_0x4ba73f[0x0]['language']==_0x1b90b3(0x143))var _0x5e413c=users[_0x1b90b3(0x143)];else{if(_0x4ba73f[0x0][_0x1b90b3(0x195)]==_0x1b90b3(0x1c7))var _0x5e413c=users[_0x1b90b3(0x1c7)];else{if(_0x4ba73f[0x0][_0x1b90b3(0x195)]==_0x1b90b3(0x1dc))var _0x5e413c=users[_0x1b90b3(0x1ef)];else{if(_0x4ba73f[0x0][_0x1b90b3(0x195)]=='Chinese')var _0x5e413c=users[_0x1b90b3(0x133)];else{if(_0x4ba73f[0x0]['language']==_0x1b90b3(0x127))var _0x5e413c=users[_0x1b90b3(0x116)];}}}}}}}_0x43bcd1[_0x1b90b3(0x199)]('all_purchases_barcode',{'success':_0x561643[_0x1b90b3(0x1d0)](_0x1b90b3(0x131)),'errors':_0x561643['flash'](_0x1b90b3(0x1bc)),'role':_0x5ee540,'profile':_0x48a547,'alldata':_0x2bd716,'master_shop':_0x4ba73f,'language':_0x5e413c}),console[_0x1b90b3(0x188)](alldata);}catch(_0x19adaf){console['log'](_0x19adaf);}}),router[a0_0xffb7c4(0x189)](a0_0xffb7c4(0x122),async(_0x3f70a7,_0x2b3170)=>{var _0x5d692a=a0_0xffb7c4;const {product_code:_0xddbb48}=_0x3f70a7[_0x5d692a(0x1ad)];var _0x1b66d3;const _0xed2898=await product[_0x5d692a(0x13a)]([{'$match':{'primary_code':_0xddbb48,'product_category':_0x5d692a(0x1fa)}},{'$group':{'_id':_0x5d692a(0x1fc),'name':{'$first':_0x5d692a(0x1fb)},'category':{'$first':_0x5d692a(0xf5)},'brand':{'$first':_0x5d692a(0x1a4)},'unit':{'$first':_0x5d692a(0x1e4)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5d692a(0x12e)},'primary_code':{'$first':_0x5d692a(0x209)},'secondary_code':{'$first':_0x5d692a(0x1ce)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5d692a(0x14d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5d692a(0x1f0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xae86c7=await product[_0x5d692a(0x13a)]([{'$match':{'secondary_code':_0xddbb48,'product_category':_0x5d692a(0x1fa)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x5d692a(0xf5)},'brand':{'$first':_0x5d692a(0x1a4)},'unit':{'$first':_0x5d692a(0x1e4)},'alertquantity':{'$first':_0x5d692a(0xe6)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5d692a(0x209)},'secondary_code':{'$first':_0x5d692a(0x1ce)},'maxStocks':{'$first':_0x5d692a(0x1da)},'maxProdPerUnit':{'$first':_0x5d692a(0x14d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5d692a(0x1f0)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xed2898[_0x5d692a(0x201)]>0x0)_0x1b66d3=_0xed2898;else _0xae86c7[_0x5d692a(0x201)]>0x0&&(_0x1b66d3=_0xae86c7);_0x2b3170[_0x5d692a(0x1c0)](_0x1b66d3);}),router[a0_0xffb7c4(0x189)](a0_0xffb7c4(0xed),async(_0x151b36,_0x452424)=>{var _0x193fb7=a0_0xffb7c4;const {primaryCode:_0x178455,secondaryCode:_0x2f8e4a,productCode:_0x209d57,bay:_0x1761e6,bin:_0x503bd8,types:_0x3c52db,pallet:_0x4d9138,warehouses:_0x4725a3,room:_0x252d3f}=_0x151b36[_0x193fb7(0x1ad)];console[_0x193fb7(0x188)](_0x151b36[_0x193fb7(0x1ad)]);try{const _0x89845b=await warehouse[_0x193fb7(0x13a)]([{'$match':{'name':_0x4725a3,'room':_0x252d3f}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x1761e6,'product_details.bin':_0x503bd8,'product_details.type':_0x3c52db}},{'$group':{'_id':_0x193fb7(0x198),'name':{'$first':_0x193fb7(0x160)},'product_stock':{'$first':_0x193fb7(0x14e)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x193fb7(0x10a)},'pallet':{'$first':_0x193fb7(0xe9)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x452424[_0x193fb7(0x113)](0xc8)[_0x193fb7(0x1c0)](_0x89845b);}catch(_0x1bcb91){_0x452424['status'](0x194)[_0x193fb7(0x1c0)]({'message':_0x1bcb91['message']});}}),module['exports']=router;