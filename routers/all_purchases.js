function a0_0x1ba5(){var _0x2e3139=['prod_invoice','prod_pallet','Portuguese\x20(BR)','Level','finalize','production_date','108105OmLYEX','bay','984085Xsrxex','catch','Sales\x20Update\x20successfully','primary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','RMSEmail','redirect','concat','maxperunit','aggregate','product_stock','$product_code','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','prod_name','stocks','secondary_code_hide','prod_isle','Rack\x20B','expiry_date','English','POnumber','purchase_quantity','$product_details.product_stock','$name','name','actual_uom','floorlevel','prod_unit','$paid_amount','prod_secondunit','logo','<html><head><title></title>','isle','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','actual_qty','/barcode/:id','note','type','$alertquantity','Rack\x20E','image','Chinese','currency_placement','$product_details.product_name','suppliers_docs','\x20Order\x20Date\x20:\x20','room','log','prod_primunit','add_purchases\x20error','51827PqpubE','level','forEach','string','</td>','all_purchases_barcode','$secondary_unit','createTransport','Hindi','</body></html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','host','Floor','<strong>\x20Regards\x20</strong>','12nJstzR','$unit','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</div>','$product_details._id','True','French','prod_Qty','German','10959135KenkPE','<h5>','then','Rack\x20C','JO_number','gmail','status','batch_code','params','<h5\x20style=\x22text-align:\x20left;\x22>','warehouse','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/CheckingWarehouse','$room','Spanish','22qwvxBW','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','purchase\x20data\x20update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','user_id','payment\x20successfull','\x20</h2>','getDate','$product_details.isle','purchases\x20item\x20return\x20successfull','$product.floorlevel','$finalize','paid_amount','return_product','save','slice','prod_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product.bin','<tbody\x20style=\x22text-align:\x20center;\x22>','$_id','user','padStart','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/:id','delivery_code','Email\x20sent\x20successfully','room_name','currency','language','email','$product_details.primary_code','<div>','$due_amount','<span\x20style=\x22float:\x20right;\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/give_payment/:id','message','pallet','MaxStocks_data','</head><body>','Arabic\x20(ae)','foreach\x20newproduct','Return\x20Goods','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','filter','find','date','$suppliers','push','$product_details.floorlevel','/all_purchases/view/','/view/add_purchases/:id','</tr>','<hr\x20class=\x22my-3\x22>','deliverycode','<!DOCTYPE\x20html>','getMonth','Purchase\x20Return\x20Mail','product_cat','site_title','ejs','1359GIjZHF','/invoice/:id','<h2>\x20','render','primary_code','1601152tjqskG','An\x20error\x20occurred\x20while\x20saving\x20data.','all_purchases','return_purchase','$product_details.storage','flash','prod_level','/upload/','abs','Router','return_qty','due_amount','$product_details.level','password','suppliers','Ambient','$product_details.maxProducts','product_name','/view/add_purchases','\x20<>\x20','exports','Paid\x20For\x20Purchase','stock_data','standard_unit','$product_details.bay','back','$product.type','</h5>','$warehouse_name','get','$product_details.bin','json','$batch_code','edit_purchases_view','An\x20error\x20occurred.','English\x20(US)','$brand','$product_details.pallet','errors','product','../middleware/auth','bin','4qQxEMh','$expiry_date','body','</span>','$product_details.rack','Room_name','\x20Order\x20Number\x20:\x20','Purchase\x20data\x20added\x20successfully','Enabled','../models/all_models','amount','post','$product_details.expiry_date','$maxStocks','secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</table>','findOne','/view','here','return_data','warehouse_name','Rack\x20A','Portuguese','$product.quantity','Shelves','rak','getFullYear','</thead>','maxStocks','Error\x20Occurs','types','Rack\x20F','</tbody>','master','/all_purchases/view','Logo.png','$product_details.secondary_code','49128iKQWHi','Raw\x20Materials','$product','stock_quantity','length','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$suppliers_docs','staff','$note','rack','$maxProdPerUnit','$product_details.product_code','Arabic','prod_code','product_code_hide','alertQTY','invoice','map','RoomAssign','$category','suppliers_data','success','express','product_details','/barcode_scanner','port','toString','product_code','$product.bay','INC-','all','5670480VJsZey','<tr>','delivery_date','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','floor','sendMail','/../public','product_list','$date','findById','quantity','add_purchases','storage','role','$product_details'];a0_0x1ba5=function(){return _0x2e3139;};return a0_0x1ba5();}var a0_0x1d7139=a0_0x318a;(function(_0x4bc059,_0x4dca1f){var _0x2a7863=a0_0x318a,_0x55c29f=_0x4bc059();while(!![]){try{var _0x360bca=-parseInt(_0x2a7863(0x1a6))/0x1*(-parseInt(_0x2a7863(0x1ce))/0x2)+parseInt(_0x2a7863(0x170))/0x3*(parseInt(_0x2a7863(0x115))/0x4)+-parseInt(_0x2a7863(0x172))/0x5*(parseInt(_0x2a7863(0x1b4))/0x6)+-parseInt(_0x2a7863(0xeb))/0x7+parseInt(_0x2a7863(0x13b))/0x8*(parseInt(_0x2a7863(0xe6))/0x9)+parseInt(_0x2a7863(0x15a))/0xa+-parseInt(_0x2a7863(0x1be))/0xb;if(_0x360bca===_0x4dca1f)break;else _0x55c29f['push'](_0x55c29f['shift']());}catch(_0x420bba){_0x55c29f['push'](_0x55c29f['shift']());}}}(a0_0x1ba5,0x75a18));const express=require(a0_0x1d7139(0x151)),app=express(),router=express[a0_0x1d7139(0xf4)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x1d7139(0x11e)),auth=require(a0_0x1d7139(0x113)),nodemailer=require('nodemailer');var ejs=require(a0_0x1d7139(0xe5));const path=require('path'),users=require('../public/language/languages.json');router[a0_0x1d7139(0x108)](a0_0x1d7139(0x127),auth,async(_0x5a54b5,_0x8c4c2b)=>{var _0x9b1d3=a0_0x1d7139;try{const {username:_0x495b61,email:_0x3ab4b2,role:_0x2d8211}=_0x5a54b5['user'],_0x51a0a4=_0x5a54b5[_0x9b1d3(0xbd)],_0x1dc62f=await profile[_0x9b1d3(0x126)]({'email':_0x51a0a4[_0x9b1d3(0xc6)]}),_0x164b96=await staff[_0x9b1d3(0x126)]({'email':_0x51a0a4[_0x9b1d3(0xc6)]});if(_0x51a0a4[_0x9b1d3(0x168)]==_0x9b1d3(0x142)){const _0x4c3d13=await staff[_0x9b1d3(0x126)]({'email':_0x51a0a4[_0x9b1d3(0xc6)]});}const _0x1330eb=await master_shop[_0x9b1d3(0xd6)]();let _0x18659f;if(_0x51a0a4[_0x9b1d3(0x168)]==_0x9b1d3(0x142)){const _0x30e0ac=await staff['findOne']({'email':_0x51a0a4[_0x9b1d3(0xc6)]});_0x18659f=await purchases['aggregate']([{'$match':{'warehouse_name':_0x30e0ac['warehouse']}},{'$lookup':{'from':_0x9b1d3(0xf9),'localField':'suppliers','foreignField':_0x9b1d3(0x18b),'as':_0x9b1d3(0x1a0)}},{'$unwind':_0x9b1d3(0x141)},{'$unwind':_0x9b1d3(0x13d)},{'$group':{'_id':_0x9b1d3(0xbc),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x9b1d3(0xd8)},'date':{'$first':_0x9b1d3(0x163)},'warehouse_name':{'$first':_0x9b1d3(0x107)},'room':{'$first':_0x9b1d3(0x1cc)},'product':{'$push':_0x9b1d3(0x13d)},'note':{'$first':_0x9b1d3(0x143)},'paid_amount':{'$first':_0x9b1d3(0x18f)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x9b1d3(0x10b)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x9b1d3(0x12d)},'level':{'$addToSet':_0x9b1d3(0x157)},'isle':{'$addToSet':_0x9b1d3(0xba)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x9b1d3(0x1d8)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x18659f=await purchases[_0x9b1d3(0x17b)]([{'$lookup':{'from':_0x9b1d3(0xf9),'localField':_0x9b1d3(0xf9),'foreignField':_0x9b1d3(0x18b),'as':'suppliers_docs'}},{'$unwind':_0x9b1d3(0x141)},{'$unwind':'$product'},{'$group':{'_id':_0x9b1d3(0xbc),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x9b1d3(0xd8)},'date':{'$first':_0x9b1d3(0x163)},'warehouse_name':{'$first':_0x9b1d3(0x107)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x9b1d3(0x13d)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x9b1d3(0x18f)},'due_amount':{'$first':_0x9b1d3(0xc9)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x9b1d3(0x10b)},'expiry_date':{'$first':_0x9b1d3(0x116)},'suppliers_docs':{'$first':_0x9b1d3(0x141)},'total_product_quantity':{'$sum':_0x9b1d3(0x12d)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x9b1d3(0x105)},'floorlevel':{'$addToSet':_0x9b1d3(0x1d8)},'finalize':{'$first':_0x9b1d3(0x1d9)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0x10e)){var _0x2af11f=users['English'];console['log'](_0x2af11f);}else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0x1ae))var _0x2af11f=users[_0x9b1d3(0x1ae)];else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0x1bd))var _0x2af11f=users[_0x9b1d3(0x1bd)];else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0x1cd))var _0x2af11f=users[_0x9b1d3(0x1cd)];else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0x1bb))var _0x2af11f=users[_0x9b1d3(0x1bb)];else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0x16c))var _0x2af11f=users[_0x9b1d3(0x12c)];else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]=='Chinese')var _0x2af11f=users['Chinese'];else{if(_0x1330eb[0x0][_0x9b1d3(0xc5)]==_0x9b1d3(0xd1))var _0x2af11f=users['Arabic'];}}}}}}}_0x8c4c2b[_0x9b1d3(0xe9)](_0x9b1d3(0xed),{'success':_0x5a54b5[_0x9b1d3(0xf0)](_0x9b1d3(0x150)),'errors':_0x5a54b5[_0x9b1d3(0xf0)](_0x9b1d3(0x111)),'purchases':_0x18659f,'role':_0x51a0a4,'profile':_0x1dc62f,'master_shop':_0x1330eb,'language':_0x2af11f});}catch(_0x431274){console['log']('table\x20page',_0x431274),_0x8c4c2b[_0x9b1d3(0x1c4)](0xc8)[_0x9b1d3(0x10a)]({'message':_0x431274[_0x9b1d3(0xcd)]});}});function BayBinSelected(_0x56fd50,_0x1957ed){var _0x1b9994=a0_0x1d7139,_0x40b2f7=[],_0x4022e3=[],_0x3e8cdd=[],_0xe4566=[],_0xa773ed=[],_0x1281d8=[];let _0x371ac9=[];if(_0x56fd50=='DRY\x20STORAGE')switch(_0x1957ed){case _0x1b9994(0x12b):_0x40b2f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4022e3=[0x1,0x2],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=['Level',_0x1b9994(0x1b2)],_0xa773ed=['D'],_0x1281d8=['A'];break;case _0x1b9994(0x184):_0x40b2f7=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4022e3=[0x1,0x2],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=[_0x1b9994(0x16d),'Floor'],_0xa773ed=['D'],_0x1281d8=['B'];break;case _0x1b9994(0x12e):_0x40b2f7=[0x0],_0x4022e3=[0x0],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=[_0x1b9994(0x1b2)],_0xa773ed=['D'],_0x1281d8=['S'];break;case'Receiving\x20Area':_0x40b2f7=[0x0],_0x4022e3=[0x0],_0xe4566=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x3e8cdd=[_0x1b9994(0x1b2)],_0xa773ed=['D'],_0x1281d8=['R'];break;}else{if(_0x56fd50=='COLD\x20STORAGE')switch(_0x1957ed){case _0x1b9994(0x12b):_0x40b2f7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4022e3=['B','F'],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=['Level','Floor'],_0xa773ed=['C'],_0x1281d8=['A'];break;case _0x1b9994(0x184):_0x40b2f7=[0x5,0x4,0x3,0x2,0x1],_0x4022e3=['F','B','S'],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=[_0x1b9994(0x16d),_0x1b9994(0x1b2)],_0xa773ed=['C'],_0x1281d8=['B'];break;case _0x1b9994(0x1c1):_0x40b2f7=[0x1,0x2,0x3,0x4,0x5],_0x4022e3=['B','F','S'],_0xe4566=[0x5,0x4,0x3,0x2,0x1],_0x3e8cdd=[_0x1b9994(0x16d),_0x1b9994(0x1b2)],_0xa773ed=['C'],_0x1281d8=['C'];break;case'Rack\x20D':_0x40b2f7=[0x5,0x4,0x3,0x2,0x1],_0x4022e3=['F','B','S'],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=[_0x1b9994(0x16d),'Floor'],_0xa773ed=['C'],_0x1281d8=['D'];break;case _0x1b9994(0x19b):_0x40b2f7=[0x4,0x3,0x2,0x1],_0x4022e3=[0x1,0x2],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=['Level',_0x1b9994(0x1b2)],_0xa773ed=['C'],_0x1281d8=['E'];break;case _0x1b9994(0x135):_0x40b2f7=[0x1,0x2,0x3],_0x4022e3=[0x1,0x2],_0xe4566=[0x1,0x2,0x3,0x4,0x5],_0x3e8cdd=[_0x1b9994(0x16d)],_0xa773ed=['C'],_0x1281d8=['F'];break;}}return{'levels':_0x40b2f7,'Isle':_0x4022e3,'rack':_0xe4566,'type':_0x3e8cdd,'storage':_0xa773ed,'rak':_0x1281d8};}function a0_0x318a(_0x5b3d7b,_0x1606cb){var _0x1ba55c=a0_0x1ba5();return a0_0x318a=function(_0x318afe,_0x1d2baa){_0x318afe=_0x318afe-0xb4;var _0x656ef2=_0x1ba55c[_0x318afe];return _0x656ef2;},a0_0x318a(_0x5b3d7b,_0x1606cb);}async function getRandom8DigitNumber(){var _0x3a9835=a0_0x1d7139;const _0x438ec7=0x989680,_0x1512ce=0x5f5e0ff,_0x5eb78a=Math[_0x3a9835(0x15f)](Math['random']()*(_0x1512ce-_0x438ec7+0x1))+_0x438ec7;var _0x51c800;const _0x85ce94=await purchases[_0x3a9835(0x126)]({'invoice':_0x3a9835(0x158)+_0x5eb78a});return _0x85ce94&&_0x85ce94[_0x3a9835(0x13f)]>0x0?_0x51c800=_0x3a9835(0x158)+_0x5eb78a:_0x51c800=_0x3a9835(0x158)+_0x5eb78a,_0x51c800;}router[a0_0x1d7139(0x108)](a0_0x1d7139(0xfd),auth,async(_0x44c125,_0x15ff66)=>{var _0x5f25ec=a0_0x1d7139;try{const {username:_0x11433b,email:_0x15d864,role:_0x4bc39b}=_0x44c125[_0x5f25ec(0xbd)],_0x5bbaf9=_0x44c125[_0x5f25ec(0xbd)],_0x799cc0=await profile[_0x5f25ec(0x126)]({'email':_0x5bbaf9[_0x5f25ec(0xc6)]}),_0x3db18a=await master_shop[_0x5f25ec(0xd6)](),_0x4efdf2=await staff[_0x5f25ec(0x126)]({'email':_0x5bbaf9[_0x5f25ec(0xc6)]}),_0x22aff3=await suppliers[_0x5f25ec(0xd6)]({});let _0x3a6bac;if(_0x5bbaf9['role']==_0x5f25ec(0x142)){const _0x31c638=await staff['findOne']({'email':_0x5bbaf9[_0x5f25ec(0xc6)]});_0x3a6bac=await warehouse[_0x5f25ec(0x17b)]([{'$match':{'status':_0x5f25ec(0x11d),'name':_0x31c638['warehouse'],'warehouse_category':_0x5f25ec(0x13c),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x5f25ec(0x18a),'name':{'$first':_0x5f25ec(0x18a)}}}]);}else _0x3a6bac=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':'Raw\x20Materials','name':{'$ne':_0x5f25ec(0xd3)}}},{'$group':{'_id':_0x5f25ec(0x18a),'name':{'$first':_0x5f25ec(0x18a)}}}]);const _0x5f14ab=await product['find']({}),_0x3258f5=await warehouse[_0x5f25ec(0xd6)]({'status':_0x5f25ec(0x11d)}),_0x2d7939=await purchases[_0x5f25ec(0xd6)]({}),_0xc6bc58=_0x2d7939[_0x5f25ec(0x13f)]+0x1,_0x2ae32f='INC-'+_0xc6bc58[_0x5f25ec(0x155)]()[_0x5f25ec(0xbe)](0x5,'0');var _0x3b0419=[_0x5f25ec(0xfa),'Enclosed'];if(_0x3db18a[0x0]['language']=='English\x20(US)')var _0x4a9f4e=users[_0x5f25ec(0x186)];else{if(_0x3db18a[0x0][_0x5f25ec(0xc5)]=='Hindi')var _0x4a9f4e=users[_0x5f25ec(0x1ae)];else{if(_0x3db18a[0x0]['language']==_0x5f25ec(0x1bd))var _0x4a9f4e=users[_0x5f25ec(0x1bd)];else{if(_0x3db18a[0x0]['language']=='Spanish')var _0x4a9f4e=users[_0x5f25ec(0x1cd)];else{if(_0x3db18a[0x0]['language']==_0x5f25ec(0x1bb))var _0x4a9f4e=users[_0x5f25ec(0x1bb)];else{if(_0x3db18a[0x0]['language']==_0x5f25ec(0x16c))var _0x4a9f4e=users[_0x5f25ec(0x12c)];else{if(_0x3db18a[0x0][_0x5f25ec(0xc5)]=='Chinese')var _0x4a9f4e=users[_0x5f25ec(0x19d)];else{if(_0x3db18a[0x0][_0x5f25ec(0xc5)]==_0x5f25ec(0xd1))var _0x4a9f4e=users[_0x5f25ec(0x147)];}}}}}}}const _0x6811d9=getRandom8DigitNumber();_0x6811d9['then'](_0x4e6490=>{var _0x56172f=_0x5f25ec;_0x15ff66[_0x56172f(0xe9)](_0x56172f(0x166),{'success':_0x44c125[_0x56172f(0xf0)](_0x56172f(0x150)),'errors':_0x44c125[_0x56172f(0xf0)](_0x56172f(0x111)),'role':_0x5bbaf9,'profile':_0x799cc0,'suppliers':_0x22aff3,'warehouse':_0x3a6bac,'product':_0x5f14ab,'invoice':_0x4e6490,'master_shop':_0x3db18a,'language':_0x4a9f4e,'find_data':_0x3258f5,'rooms_data':_0x3b0419});})[_0x5f25ec(0x173)](_0xcd91f1=>{var _0x404b21=_0x5f25ec;_0x44c125['flash'](_0x404b21(0x111),_0x404b21(0x140)),_0x15ff66[_0x404b21(0x178)](_0x404b21(0x138));});}catch(_0x222aaa){console[_0x5f25ec(0x1a3)](_0x222aaa);}}),router['get'](a0_0x1d7139(0xdc),auth,async(_0x25d5bd,_0x2af52a)=>{var _0x2d78b6=a0_0x1d7139;try{const _0x417654=_0x25d5bd['params']['id'];console[_0x2d78b6(0x1a3)](_0x417654);const _0x39b3c8=await master_shop['find']();console['log'](_0x2d78b6(0x137),_0x39b3c8);const _0x44aa39=await product[_0x2d78b6(0x126)]({'name':_0x417654});console[_0x2d78b6(0x1a3)](_0x2d78b6(0x112),_0x44aa39),_0x2af52a[_0x2d78b6(0x1c4)](0xc8)['json']({'product_data':_0x44aa39,'master':_0x39b3c8});}catch(_0x4b8fc6){console[_0x2d78b6(0x1a3)](_0x2d78b6(0x1a5),_0x4b8fc6);}}),router['post']('/view/add_purchases',auth,async(_0x217322,_0x2b5c59)=>{var _0x90d7eb=a0_0x1d7139;try{const {invoice:_0x451921,date:_0x272759,warehouse_name:_0x1e5dc9,prod_name:_0x21ad3f,prod_code:_0x3e39b8,prod_qty:_0x56064c,prod_unit:_0x1f77d8,prod_secondunit:_0x7522ce,prod_level:_0x5c9896,prod_isle:_0x2bd867,prod_pallet:_0x1f9a7d,note:_0x47df96,expiry_date:_0x12d090,batch_code:_0xd3766,payable:_0x2d9b0f,due_amount:_0x2bccb6,Room_name:_0x1071c1,primary_code:_0x322dcb,secondary_code:_0x487c80,MaxStocks_data:_0x2f338c,PO_number:_0x2a4fcf,SCRN:_0x2c04b9,JO_number:_0x58d389}=_0x217322['body'];if(typeof _0x21ad3f==_0x90d7eb(0x1a9))var _0x2cab08=[_0x217322['body'][_0x90d7eb(0x180)]],_0x12b4cf=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x148)]],_0x4c6a16=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x1bc)]],_0x37b27a=[_0x217322[_0x90d7eb(0x117)]['prod_primunit']],_0x244d6c=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x190)]],_0xbe18a0=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0xf1)]],_0x3d58f5=[_0x217322['body'][_0x90d7eb(0xea)]],_0x3698da=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x123)]],_0x36d4ce=[_0x217322[_0x90d7eb(0x117)]['MaxStocks_data']],_0xef304e=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x1c5)]],_0x388b06=[_0x217322['body'][_0x90d7eb(0x185)]],_0xd649a8=[_0x217322[_0x90d7eb(0x117)]['max_product_unit']],_0x2dad6a=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x14a)]],_0x3d28a9=[_0x217322['body'][_0x90d7eb(0x16f)]],_0x23e7e4=[_0x217322['body']['prod_cat']],_0x3a8c7a=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x14d)]],_0x4d1764=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0xdf)]],_0x3f8fe9=[_0x217322['body'][_0x90d7eb(0x16a)]],_0x5a0cea=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x196)]],_0x41d919=[_0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x18c)]];else var _0x2cab08=[..._0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x180)]],_0x12b4cf=[..._0x217322[_0x90d7eb(0x117)]['prod_code']],_0x4c6a16=[..._0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x1bc)]],_0x37b27a=[..._0x217322['body'][_0x90d7eb(0x1a4)]],_0x244d6c=[..._0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x190)]],_0xbe18a0=[..._0x217322['body'][_0x90d7eb(0xf1)]],_0x3d58f5=[..._0x217322[_0x90d7eb(0x117)]['primary_code']],_0x3698da=[..._0x217322['body'][_0x90d7eb(0x123)]],_0x36d4ce=[..._0x217322['body'][_0x90d7eb(0xcf)]],_0xef304e=[..._0x217322['body'][_0x90d7eb(0x1c5)]],_0x388b06=[..._0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x185)]],_0xd649a8=[..._0x217322[_0x90d7eb(0x117)]['max_product_unit']],_0x2dad6a=[..._0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x14a)]],_0x3d28a9=[..._0x217322[_0x90d7eb(0x117)][_0x90d7eb(0x16f)]],_0x23e7e4=[..._0x217322[_0x90d7eb(0x117)]['prod_cat']],_0x3a8c7a=[..._0x217322['body'][_0x90d7eb(0x14d)]],_0x4d1764=[..._0x217322[_0x90d7eb(0x117)]['deliverycode']],_0x3f8fe9=[..._0x217322[_0x90d7eb(0x117)]['prod_invoice']],_0x5a0cea=[..._0x217322['body'][_0x90d7eb(0x196)]],_0x41d919=[..._0x217322[_0x90d7eb(0x117)]['actual_uom']];const _0x43105b=_0x2cab08[_0x90d7eb(0x14c)](_0x4c25e9=>{return _0x4c25e9={'product_name':_0x4c25e9};});_0x5a0cea['forEach']((_0x8ca0c5,_0x5e0730)=>{var _0x51d21a=_0x90d7eb;_0x43105b[_0x5e0730][_0x51d21a(0x196)]=Math[_0x51d21a(0xf3)](_0x8ca0c5);}),_0x41d919[_0x90d7eb(0x1a8)]((_0x14b952,_0x42f0bf)=>{_0x43105b[_0x42f0bf]['actual_uom']=_0x14b952;}),_0x12b4cf[_0x90d7eb(0x1a8)]((_0x235350,_0x2744ab)=>{_0x43105b[_0x2744ab]['product_code']=_0x235350;}),_0x4c6a16['forEach']((_0x241e8a,_0x847b9f)=>{var _0x141a9a=_0x90d7eb;_0x43105b[_0x847b9f][_0x141a9a(0x165)]=Math[_0x141a9a(0xf3)](_0x241e8a);}),_0x37b27a['forEach']((_0xcce8ec,_0x1b4439)=>{var _0x406ddb=_0x90d7eb;_0x43105b[_0x1b4439][_0x406ddb(0x102)]=_0xcce8ec;}),_0x244d6c[_0x90d7eb(0x1a8)]((_0x31920a,_0x5e7553)=>{_0x43105b[_0x5e7553]['secondary_unit']=_0x31920a;}),_0xbe18a0['forEach']((_0x216c91,_0x43b4ab)=>{var _0x14008a=_0x90d7eb;_0x3a8c7a[_0x14008a(0x1a8)]((_0xa109ce,_0x53c364)=>{var _0x2bf0b7=_0x14008a;if(_0xa109ce=='Receiving\x20Area'&&_0x43b4ab==_0x53c364){console[_0x2bf0b7(0x1a3)](_0xa109ce+'\x20<\x20wew\x20>\x20'+_0x43b4ab+'\x20<>\x20'+_0x53c364+_0x2bf0b7(0xfe)+_0x216c91);var _0x7677ea=_0x216c91[_0x2bf0b7(0xb7)](0x3);_0x43105b[_0x43b4ab]['storage']=_0x216c91[0x0],_0x43105b[_0x43b4ab][_0x2bf0b7(0x144)]=_0x216c91[0x1],_0x43105b[_0x43b4ab]['bay']=0x0,_0x43105b[_0x43b4ab]['bin']=0x0,_0x43105b[_0x43b4ab][_0x2bf0b7(0x199)]='Floor',_0x43105b[_0x43b4ab][_0x2bf0b7(0x18d)]=_0x7677ea;}else{if(_0xa109ce=='Shelves'&&_0x43b4ab==_0x53c364){var _0x7677ea=_0x216c91[_0x2bf0b7(0xb7)](0x3);_0x43105b[_0x43b4ab][_0x2bf0b7(0x167)]=_0x216c91[0x0],_0x43105b[_0x43b4ab][_0x2bf0b7(0x144)]=_0x216c91[0x1],_0x43105b[_0x43b4ab][_0x2bf0b7(0x171)]=0x0,_0x43105b[_0x43b4ab][_0x2bf0b7(0x114)]=0x0,_0x43105b[_0x43b4ab][_0x2bf0b7(0x199)]=_0x2bf0b7(0x1b2),_0x43105b[_0x43b4ab][_0x2bf0b7(0x18d)]=_0x216c91[0x5];}else{if(_0x43b4ab==_0x53c364){if(_0x216c91[0x0]=='A'&&_0x216c91[0x1]=='L'&&_0x216c91[0x2]=='L')console[_0x2bf0b7(0x1a3)](_0xa109ce+_0x2bf0b7(0xfe)+_0x43b4ab+_0x2bf0b7(0xfe)+_0x53c364+_0x2bf0b7(0xfe)+_0x216c91+_0x2bf0b7(0x128)),_0x43105b[_0x43b4ab][_0x2bf0b7(0x167)]=_0x216c91[0x0],_0x43105b[_0x43b4ab][_0x2bf0b7(0x144)]=_0x216c91[0x1],_0x43105b[_0x43b4ab][_0x2bf0b7(0x171)]=0x0,_0x43105b[_0x43b4ab]['bin']=0x0,_0x43105b[_0x43b4ab][_0x2bf0b7(0x199)]=_0x2bf0b7(0x1b2),_0x43105b[_0x43b4ab][_0x2bf0b7(0x18d)]=_0x216c91[0x3];else{var _0x365672;if(_0x216c91[0x4]=='L')_0x365672=_0x2bf0b7(0x16d);else _0x216c91[0x4]=='F'&&(_0x365672=_0x2bf0b7(0x1b2));_0x43105b[_0x43b4ab][_0x2bf0b7(0x167)]=_0x216c91[0x0],_0x43105b[_0x43b4ab]['rack']=_0x216c91[0x1],_0x43105b[_0x43b4ab][_0x2bf0b7(0x171)]=_0x216c91[0x2],_0x43105b[_0x43b4ab][_0x2bf0b7(0x114)]=_0x216c91[0x3],_0x43105b[_0x43b4ab][_0x2bf0b7(0x199)]=_0x365672,_0x43105b[_0x43b4ab][_0x2bf0b7(0x18d)]=_0x216c91[0x5];}}}}});}),_0x3d58f5[_0x90d7eb(0x1a8)]((_0x4be4dd,_0x2e1d7a)=>{_0x43105b[_0x2e1d7a]['primary_code']=_0x4be4dd;}),_0x3698da['forEach']((_0x5c80c3,_0x5c2cff)=>{var _0xcadf0f=_0x90d7eb;_0x43105b[_0x5c2cff][_0xcadf0f(0x123)]=_0x5c80c3;}),_0x36d4ce[_0x90d7eb(0x1a8)]((_0x5c6533,_0x4c6052)=>{var _0x5643e5=_0x90d7eb;_0x43105b[_0x4c6052][_0x5643e5(0x132)]=_0x5c6533;}),_0xef304e[_0x90d7eb(0x1a8)]((_0x31db3,_0x3ec25a)=>{_0x43105b[_0x3ec25a]['batch_code']=_0x31db3;}),_0x388b06[_0x90d7eb(0x1a8)]((_0x48c844,_0x320cbc)=>{var _0x449b85=_0x90d7eb;_0x43105b[_0x320cbc][_0x449b85(0x185)]=_0x48c844;}),_0xd649a8[_0x90d7eb(0x1a8)]((_0x1ea61f,_0x22d15f)=>{var _0x2bad45=_0x90d7eb;_0x43105b[_0x22d15f][_0x2bad45(0x17a)]=_0x1ea61f;}),_0x2dad6a[_0x90d7eb(0x1a8)]((_0x32b6f6,_0x1836d8)=>{var _0x32113b=_0x90d7eb;_0x43105b[_0x1836d8][_0x32113b(0x14a)]=_0x32b6f6;}),_0x3d28a9[_0x90d7eb(0x1a8)]((_0x3b9b4e,_0x26d2e4)=>{var _0x22e5d0=_0x90d7eb;_0x43105b[_0x26d2e4][_0x22e5d0(0x16f)]=_0x3b9b4e;}),_0x23e7e4['forEach']((_0x17b095,_0x2e5547)=>{_0x43105b[_0x2e5547]['product_cat']=_0x17b095;}),_0x3a8c7a[_0x90d7eb(0x1a8)]((_0x46bc58,_0x5d1c07)=>{var _0x1d6753=_0x90d7eb;_0x43105b[_0x5d1c07][_0x1d6753(0xc3)]=_0x46bc58;}),_0x4d1764['forEach']((_0x51b675,_0x12e27a)=>{var _0x51e962=_0x90d7eb;_0x43105b[_0x12e27a][_0x51e962(0xc1)]=_0x51b675;}),_0x3f8fe9[_0x90d7eb(0x1a8)]((_0xf34a2f,_0x9c6d8c)=>{var _0xb9a997=_0x90d7eb;_0x43105b[_0x9c6d8c][_0xb9a997(0x14b)]=_0xf34a2f;});const _0x45dbe2=_0x3a8c7a['map'](_0x3e7706=>{return _0x3e7706={'room_name':_0x3e7706};}),_0x384d03=_0x43105b[_0x90d7eb(0xd5)](_0xd7b700=>_0xd7b700[_0x90d7eb(0x165)]!=='0'&&_0xd7b700[_0x90d7eb(0x165)]!==''),_0x3e37d6=new purchases({'invoice':_0x451921,'suppliers':_0x217322[_0x90d7eb(0x117)]['suppliers'],'date':_0x272759,'warehouse_name':_0x1e5dc9,'product':_0x384d03,'note':_0x47df96,'due_amount':_0x2bccb6,'POnumber':_0x2a4fcf,'SCRN':_0x2c04b9,'JO_number':_0x58d389,'roomList':_0x45dbe2}),_0x57c915=await _0x3e37d6[_0x90d7eb(0xb6)](),_0x4b0616=await purchases['findOne']({'invoice':_0x451921}),_0x244e1c=_0x4b0616[_0x90d7eb(0x112)][_0x90d7eb(0x14c)](async _0x506298=>{var _0x30833b=_0x90d7eb,_0xa75948=await warehouse[_0x30833b(0x126)]({'name':_0x1e5dc9,'room':_0x506298[_0x30833b(0xc3)]}),_0x2dbe03=0x0;return _0xa75948[_0x30833b(0x152)]['forEach'](_0x35238f=>{var _0x5f3ac6=_0x30833b;_0x35238f[_0x5f3ac6(0xfc)]==_0x506298[_0x5f3ac6(0xfc)]&&_0x35238f[_0x5f3ac6(0x18d)]==_0x506298[_0x5f3ac6(0x18d)]&&_0x35238f[_0x5f3ac6(0x199)]==_0x506298[_0x5f3ac6(0x199)]&&_0x35238f['bin']==_0x506298[_0x5f3ac6(0x114)]&&_0x35238f['bay']==_0x506298[_0x5f3ac6(0x171)]&&_0x35238f[_0x5f3ac6(0x144)]==_0x506298[_0x5f3ac6(0x144)]&&_0x35238f[_0x5f3ac6(0x167)]==_0x506298[_0x5f3ac6(0x167)]&&_0x35238f['expiry_date']==_0x506298[_0x5f3ac6(0x185)]&&_0x35238f[_0x5f3ac6(0x1c5)]==_0x506298[_0x5f3ac6(0x1c5)]&&_0x35238f['production_date']==_0x506298['production_date']&&_0x35238f[_0x5f3ac6(0x14b)]==_0x4b0616['invoice']&&(_0x35238f[_0x5f3ac6(0x17c)]+=Math[_0x5f3ac6(0xf3)](_0x506298['quantity']),_0x2dbe03++);}),_0x2dbe03===0x0&&_0xa75948[_0x30833b(0x152)][_0x30833b(0xd9)]({'product_name':_0x506298[_0x30833b(0xfc)],'product_stock':Math[_0x30833b(0xf3)](_0x506298[_0x30833b(0x165)]),'primary_code':_0x506298[_0x30833b(0xea)],'secondary_code':_0x506298[_0x30833b(0x123)],'product_code':_0x506298[_0x30833b(0x156)],'storage':_0x506298[_0x30833b(0x167)],'rack':_0x506298[_0x30833b(0x144)],'bay':_0x506298[_0x30833b(0x171)],'bin':_0x506298[_0x30833b(0x114)],'type':_0x506298[_0x30833b(0x199)],'floorlevel':_0x506298[_0x30833b(0x18d)],'maxProducts':_0x506298[_0x30833b(0x132)],'unit':_0x506298['standard_unit'],'secondary_unit':_0x506298['secondary_unit'],'expiry_date':_0x506298[_0x30833b(0x185)],'maxPerUnit':_0x506298[_0x30833b(0x17a)],'batch_code':_0x506298['batch_code'],'alertQTY':_0x506298['alertQTY'],'production_date':_0x506298['production_date'],'product_cat':_0x506298[_0x30833b(0xe3)],'invoice':_0x506298[_0x30833b(0x14b)],'actual_qty':Math['abs'](_0x506298[_0x30833b(0x196)]),'actual_uom':_0x506298[_0x30833b(0x18c)]}),_0xa75948;});Promise[_0x90d7eb(0x159)](_0x244e1c)[_0x90d7eb(0x1c0)](async _0x583cf4=>{var _0x49fc62=_0x90d7eb;try{for(const _0x3be340 of _0x583cf4){await _0x3be340[_0x49fc62(0xb6)]();}const _0x4c8535=await master_shop[_0x49fc62(0xd6)](),_0x5a7d0b=await email_settings[_0x49fc62(0x126)](),_0x2c26fb=await supervisor_settings[_0x49fc62(0xd6)]();var _0x2b8163=_0x4b0616['product'],_0x1eba82='',_0x3f3688;for(_0x3f3688 in _0x2b8163){_0x1eba82+='<tr>'+_0x49fc62(0xbf)+_0x2b8163[_0x3f3688][_0x49fc62(0xfc)]+_0x49fc62(0x1aa)+_0x49fc62(0xbf)+_0x2b8163[_0x3f3688]['product_code']+_0x49fc62(0x1aa)+_0x49fc62(0xbf)+_0x2b8163[_0x3f3688][_0x49fc62(0x165)]+_0x49fc62(0x1aa)+_0x49fc62(0xbf)+_0x2b8163[_0x3f3688][_0x49fc62(0x102)]+_0x49fc62(0x1aa)+_0x49fc62(0xbf)+_0x2b8163[_0x3f3688][_0x49fc62(0x194)]+_0x49fc62(0x1aa)+_0x49fc62(0xbf)+_0x4b0616[_0x49fc62(0x12a)]+_0x49fc62(0x1aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b8163[_0x3f3688][_0x49fc62(0xc3)]+_0x49fc62(0x1aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2b8163[_0x3f3688][_0x49fc62(0x167)]+_0x2b8163[_0x3f3688][_0x49fc62(0x144)]+_0x2b8163[_0x3f3688][_0x49fc62(0x171)]+_0x2b8163[_0x3f3688][_0x49fc62(0x114)]+_0x2b8163[_0x3f3688][_0x49fc62(0x199)][0x0]+_0x2b8163[_0x3f3688]['floorlevel']+_0x49fc62(0x1aa),'</tr>';}let _0x46ccba=nodemailer[_0x49fc62(0x1ad)]({'host':_0x5a7d0b[_0x49fc62(0x1b1)],'port':Number(_0x5a7d0b[_0x49fc62(0x154)]),'secure':![],'auth':{'user':_0x5a7d0b[_0x49fc62(0xc6)],'pass':_0x5a7d0b[_0x49fc62(0xf8)]}}),_0x3b0b07={'from':_0x5a7d0b[_0x49fc62(0xc6)],'to':_0x2c26fb[0x0][_0x49fc62(0x177)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x49fc62(0x161)+_0x49fc62(0xf2)+_0x4c8535[0x0][_0x49fc62(0x19c)],'cid':_0x49fc62(0x191)}],'html':_0x49fc62(0xe0)+_0x49fc62(0x192)+_0x49fc62(0xd0)+'<div>'+_0x49fc62(0x1cf)+'<div>'+_0x49fc62(0xd4)+_0x49fc62(0x1b8)+'<div>'+_0x49fc62(0xe8)+_0x4c8535[0x0][_0x49fc62(0xe4)]+_0x49fc62(0x1d4)+_0x49fc62(0x1b8)+_0x49fc62(0x1b8)+_0x49fc62(0xde)+_0x49fc62(0xc8)+_0x49fc62(0x1c7)+'\x20Order\x20Number\x20:\x20'+_0x4b0616[_0x49fc62(0x14b)]+'\x20'+_0x49fc62(0xca)+_0x49fc62(0x1a1)+_0x4b0616[_0x49fc62(0xd7)]+'\x20'+_0x49fc62(0x118)+_0x49fc62(0x106)+_0x49fc62(0x1b8)+_0x49fc62(0xcb)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x49fc62(0x124)+_0x49fc62(0x1ca)+_0x49fc62(0xb9)+_0x49fc62(0x1b7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x49fc62(0x1d1)+_0x49fc62(0x15e)+_0x49fc62(0x1b0)+'</tr>'+_0x49fc62(0x131)+_0x49fc62(0xbb)+'\x20'+_0x1eba82+'\x20'+_0x49fc62(0x136)+_0x49fc62(0x125)+'<div>'+_0x49fc62(0x1b3)+_0x49fc62(0x1bf)+_0x4c8535[0x0]['site_title']+'</h5>'+_0x49fc62(0x1b8)+_0x49fc62(0x1b8)+_0x49fc62(0x1af)};_0x46ccba[_0x49fc62(0x160)](_0x3b0b07,function(_0x5c7c2c,_0xc6c8f8){var _0x4833fd=_0x49fc62;_0x5c7c2c?(console[_0x4833fd(0x1a3)](_0x5c7c2c),console['log'](_0x4833fd(0x133))):console[_0x4833fd(0x1a3)](_0x4833fd(0xc2));}),_0x217322[_0x49fc62(0xf0)](_0x49fc62(0x150),_0x49fc62(0x11c)),_0x2b5c59[_0x49fc62(0x178)](_0x49fc62(0xdb));}catch(_0x2a4542){console[_0x49fc62(0x15d)](_0x2a4542),_0x2b5c59['status'](0x1f4)[_0x49fc62(0x10a)]({'error':_0x49fc62(0xec)});}})['catch'](_0x423657=>{var _0x36aea3=_0x90d7eb;console[_0x36aea3(0x15d)](_0x423657),_0x2b5c59[_0x36aea3(0x1c4)](0x1f4)['json']({'error':_0x36aea3(0x10d)});});}catch(_0x3a74cd){console['log'](_0x3a74cd);}}),router[a0_0x1d7139(0x108)](a0_0x1d7139(0x1c9),auth,async(_0x4e8bd0,_0x3cd91d)=>{var _0x26e73a=a0_0x1d7139;try{const {username:_0x13e7a1,email:_0x256664,role:_0x598315}=_0x4e8bd0['user'],_0x1142f0=_0x4e8bd0[_0x26e73a(0xbd)],_0x5b8241=await profile[_0x26e73a(0x126)]({'email':_0x1142f0['email']}),_0x36548b=await master_shop[_0x26e73a(0xd6)](),_0x29b8c1=_0x4e8bd0[_0x26e73a(0x1c6)]['id'],_0x587153=await purchases[_0x26e73a(0x164)](_0x29b8c1),_0x30ae7d=await warehouse[_0x26e73a(0x17b)]([{'$match':{'name':_0x587153[_0x26e73a(0x12a)],'room':_0x587153[_0x26e73a(0x1a2)]}},{'$unwind':_0x26e73a(0x169)},{'$group':{'_id':_0x26e73a(0x1b9),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x26e73a(0x189)},'bay':{'$first':_0x26e73a(0x103)},'bin':{'$first':_0x26e73a(0x109)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x26e73a(0xda)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x26e73a(0x13a)},'product_code':{'$first':_0x26e73a(0x146)},'storage':{'$first':_0x26e73a(0xef)},'rack':{'$first':_0x26e73a(0x119)},'expiry_date':{'$first':_0x26e73a(0x121)}}}]),_0x110bcf=await customer[_0x26e73a(0xd6)]({});let _0x47b504;if(_0x1142f0[_0x26e73a(0x168)]==_0x26e73a(0x142)){const _0x17afa7=await staff['findOne']({'email':_0x1142f0[_0x26e73a(0xc6)]});_0x47b504=await warehouse['aggregate']([{'$match':{'status':_0x26e73a(0x11d),'name':_0x17afa7[_0x26e73a(0x1c8)]}},{'$group':{'_id':_0x26e73a(0x18a),'name':{'$first':_0x26e73a(0x18a)}}}]);}else _0x47b504=await warehouse[_0x26e73a(0x17b)]([{'$match':{'status':_0x26e73a(0x11d)}},{'$group':{'_id':_0x26e73a(0x18a),'name':{'$first':_0x26e73a(0x18a)}}}]);const _0x54497a=await product[_0x26e73a(0xd6)]({}),_0x30b676=await suppliers[_0x26e73a(0xd6)]({}),_0xb59db7=BayBinSelected(_0x587153[_0x26e73a(0x12a)],_0x587153[_0x26e73a(0x1a2)]);if(_0x36548b[0x0][_0x26e73a(0xc5)]==_0x26e73a(0x10e)){var _0x42edba=users[_0x26e73a(0x186)];console[_0x26e73a(0x1a3)](_0x42edba);}else{if(_0x36548b[0x0]['language']==_0x26e73a(0x1ae))var _0x42edba=users['Hindi'];else{if(_0x36548b[0x0][_0x26e73a(0xc5)]=='German')var _0x42edba=users[_0x26e73a(0x1bd)];else{if(_0x36548b[0x0][_0x26e73a(0xc5)]==_0x26e73a(0x1cd))var _0x42edba=users[_0x26e73a(0x1cd)];else{if(_0x36548b[0x0]['language']=='French')var _0x42edba=users[_0x26e73a(0x1bb)];else{if(_0x36548b[0x0]['language']=='Portuguese\x20(BR)')var _0x42edba=users[_0x26e73a(0x12c)];else{if(_0x36548b[0x0][_0x26e73a(0xc5)]=='Chinese')var _0x42edba=users['Chinese'];else{if(_0x36548b[0x0]['language']==_0x26e73a(0xd1))var _0x42edba=users['Arabic'];}}}}}}}_0x3cd91d['render'](_0x26e73a(0x10c),{'success':_0x4e8bd0[_0x26e73a(0xf0)](_0x26e73a(0x150)),'errors':_0x4e8bd0[_0x26e73a(0xf0)](_0x26e73a(0x111)),'role':_0x1142f0,'profile':_0x5b8241,'customer':_0x110bcf,'warehouse':_0x47b504,'product':_0x30ae7d,'user':_0x587153,'master_shop':_0x36548b,'unit':_0x54497a,'language':_0x42edba,'suppliers':_0x30b676,'dataSelected':_0xb59db7});}catch(_0x15c62d){console[_0x26e73a(0x1a3)](_0x15c62d);}}),router['post']('/preview/:id',auth,async(_0x315bc0,_0x1504ea)=>{var _0x270b3a=a0_0x1d7139;try{const _0x341642=_0x315bc0['params']['id'],{invoice:_0xb622ab,warehouse_name:_0x4abc94,Room_name:_0xd6fd0a}=_0x315bc0['body'],_0xbd3bdf=await warehouse[_0x270b3a(0x126)]({'name':_0x4abc94,'room':_0xd6fd0a}),_0x1b316a=await purchases[_0x270b3a(0x126)]({'invoice':_0xb622ab});_0x1b316a[_0x270b3a(0x112)][_0x270b3a(0x1a8)](_0x48ea76=>{var _0x362fa9=_0x270b3a,_0x4ea5e8=0x0;const _0x13fb37=_0xbd3bdf[_0x362fa9(0x152)][_0x362fa9(0x14c)](_0x3b3060=>{var _0x252272=_0x362fa9;_0x3b3060[_0x252272(0xfc)]==_0x48ea76[_0x252272(0xfc)]&&_0x3b3060[_0x252272(0x18d)]==_0x48ea76['floorlevel']&&_0x3b3060[_0x252272(0x199)]==_0x48ea76['type']&&_0x3b3060[_0x252272(0x114)]==_0x48ea76[_0x252272(0x114)]&&_0x3b3060[_0x252272(0x171)]==_0x48ea76[_0x252272(0x171)]&&_0x3b3060[_0x252272(0x144)]==_0x48ea76[_0x252272(0x144)]&&_0x3b3060[_0x252272(0x167)]==_0x48ea76[_0x252272(0x167)]&&_0x3b3060['expiry_date']==_0x48ea76[_0x252272(0x185)]&&_0x3b3060['batch_code']==_0x48ea76[_0x252272(0x1c5)]&&_0x3b3060[_0x252272(0x16f)]==_0x48ea76[_0x252272(0x16f)]&&_0x3b3060[_0x252272(0x15c)]==_0x48ea76['delivery_date']&&_0x3b3060[_0x252272(0xc1)]==_0x48ea76[_0x252272(0xc1)]&&(_0x3b3060['product_stock']=parseInt(_0x3b3060[_0x252272(0x17c)])+parseInt(_0x48ea76[_0x252272(0x165)]),_0x4ea5e8++);});_0x4ea5e8=='0'&&(_0xbd3bdf['product_details']=_0xbd3bdf['product_details'][_0x362fa9(0x179)]({'product_name':_0x48ea76[_0x362fa9(0xfc)],'product_stock':_0x48ea76['quantity'],'primary_code':_0x48ea76[_0x362fa9(0xea)],'secondary_code':_0x48ea76[_0x362fa9(0x123)],'product_code':_0x48ea76[_0x362fa9(0x156)],'storage':_0x48ea76[_0x362fa9(0x167)],'rack':_0x48ea76[_0x362fa9(0x144)],'bay':_0x48ea76[_0x362fa9(0x171)],'bin':_0x48ea76[_0x362fa9(0x114)],'type':_0x48ea76['type'],'floorlevel':_0x48ea76[_0x362fa9(0x18d)],'maxProducts':_0x48ea76[_0x362fa9(0x132)],'unit':_0x48ea76[_0x362fa9(0x102)],'secondary_unit':_0x48ea76[_0x362fa9(0x194)],'expiry_date':_0x48ea76[_0x362fa9(0x185)],'maxPerUnit':_0x48ea76[_0x362fa9(0x17a)],'batch_code':_0x48ea76[_0x362fa9(0x1c5)],'alertQTY':_0x48ea76['alertQTY'],'production_date':_0x48ea76['production_date'],'delivery_date':_0x48ea76[_0x362fa9(0x15c)],'delivery_code':_0x48ea76[_0x362fa9(0xc1)]}));}),await _0xbd3bdf['save'](),_0x1b316a[_0x270b3a(0x16e)]=_0x270b3a(0x1ba);const _0x5a5f6c=await _0x1b316a[_0x270b3a(0xb6)]();_0x315bc0['flash'](_0x270b3a(0x150),_0x270b3a(0x174)),_0x1504ea[_0x270b3a(0x178)](_0x270b3a(0x138));}catch(_0x478589){console['log'](_0x478589);}}),router[a0_0x1d7139(0x108)]('/view/:id',auth,async(_0x4d9079,_0x239220)=>{var _0x3f4193=a0_0x1d7139;try{const {username:_0x50f96b,email:_0x350604,role:_0x2c3544}=_0x4d9079[_0x3f4193(0xbd)],_0x356c7e=_0x4d9079[_0x3f4193(0xbd)],_0x54a97c=await profile[_0x3f4193(0x126)]({'email':_0x356c7e['email']}),_0x494886=await master_shop['find'](),_0x403753=_0x4d9079[_0x3f4193(0x1c6)]['id'],_0x3fe8a3=await purchases['findById'](_0x403753),_0x1b1649=await suppliers[_0x3f4193(0xd6)]({});let _0x158b66;if(_0x356c7e[_0x3f4193(0x168)]==_0x3f4193(0x142)){const _0x55efeb=await staff['findOne']({'email':_0x356c7e['email']});_0x158b66=await warehouse[_0x3f4193(0xd6)]({'status':'Enabled','name':_0x55efeb[_0x3f4193(0x1c8)],'warehouse_category':_0x3f4193(0x13c)});}else _0x158b66=await warehouse[_0x3f4193(0x17b)]([{'$match':{'status':_0x3f4193(0x11d),'warehouse_category':_0x3f4193(0x13c)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x2e0062=await product['find']({}),_0x1300cd=BayBinSelected(_0x3fe8a3[_0x3f4193(0x12a)],_0x3fe8a3[_0x3f4193(0x1a2)]);let _0x30257e=new Date(_0x3fe8a3[_0x3f4193(0x185)]),_0x360f22=('0'+_0x30257e[_0x3f4193(0x1d5)]())[_0x3f4193(0xb7)](-0x2),_0x42bc51=('0'+(_0x30257e['getMonth']()+0x1))[_0x3f4193(0xb7)](-0x2),_0x878d9=_0x30257e[_0x3f4193(0x130)](),_0x16d14d=_0x878d9+'-'+_0x42bc51+'-'+_0x360f22;if(_0x494886[0x0][_0x3f4193(0xc5)]==_0x3f4193(0x10e)){var _0x389768=users[_0x3f4193(0x186)];console['log'](_0x389768);}else{if(_0x494886[0x0][_0x3f4193(0xc5)]==_0x3f4193(0x1ae))var _0x389768=users['Hindi'];else{if(_0x494886[0x0]['language']==_0x3f4193(0x1bd))var _0x389768=users['German'];else{if(_0x494886[0x0][_0x3f4193(0xc5)]=='Spanish')var _0x389768=users['Spanish'];else{if(_0x494886[0x0][_0x3f4193(0xc5)]==_0x3f4193(0x1bb))var _0x389768=users['French'];else{if(_0x494886[0x0]['language']==_0x3f4193(0x16c))var _0x389768=users[_0x3f4193(0x12c)];else{if(_0x494886[0x0][_0x3f4193(0xc5)]==_0x3f4193(0x19d))var _0x389768=users[_0x3f4193(0x19d)];else{if(_0x494886[0x0]['language']==_0x3f4193(0xd1))var _0x389768=users[_0x3f4193(0x147)];}}}}}}}_0x239220[_0x3f4193(0xe9)]('edit_purchases',{'success':_0x4d9079[_0x3f4193(0xf0)](_0x3f4193(0x150)),'errors':_0x4d9079[_0x3f4193(0xf0)](_0x3f4193(0x111)),'role':_0x356c7e,'profile':_0x54a97c,'purchases':_0x3fe8a3,'suppliers':_0x1b1649,'warehouse':_0x158b66,'product':_0x2e0062,'master_shop':_0x494886,'language':_0x389768,'ed_fullDate':_0x16d14d,'dataSelected':_0x1300cd});}catch(_0x8d792){console['log'](_0x8d792);}}),router[a0_0x1d7139(0x120)](a0_0x1d7139(0xc0),auth,async(_0x1969c5,_0x4e06e5)=>{var _0x25d485=a0_0x1d7139;try{const _0x102247=_0x1969c5[_0x25d485(0x1c6)]['id'],_0x123eac=await purchases[_0x25d485(0x126)]({'_id':_0x1969c5['params']['id']}),_0x405b5a=await warehouse[_0x25d485(0x126)]({'name':_0x123eac['warehouse_name'],'room':_0x123eac['room']});_0x123eac[_0x25d485(0x112)][_0x25d485(0x1a8)](_0x97481e=>{var _0x1b96a2=_0x25d485;const _0x4b8a1d=_0x405b5a[_0x1b96a2(0x152)]['map'](_0x1c45e8=>{var _0x448c47=_0x1b96a2;_0x1c45e8[_0x448c47(0xfc)]==_0x97481e[_0x448c47(0xfc)]&&_0x1c45e8['floorlevel']==_0x97481e[_0x448c47(0x18d)]&&_0x1c45e8[_0x448c47(0x199)]==_0x97481e[_0x448c47(0x199)]&&_0x1c45e8['bin']==_0x97481e[_0x448c47(0x114)]&&_0x1c45e8['bay']==_0x97481e[_0x448c47(0x171)]&&_0x1c45e8[_0x448c47(0x144)]==_0x97481e[_0x448c47(0x144)]&&_0x1c45e8['storage']==_0x97481e[_0x448c47(0x167)]&&(_0x1c45e8[_0x448c47(0x17c)]=parseInt(_0x1c45e8[_0x448c47(0x17c)])-parseInt(_0x97481e[_0x448c47(0x165)]));});}),await _0x405b5a[_0x25d485(0xb6)]();const {invoice:_0x58f6b0,suppliers:_0x486b9d,date:_0x562055,warehouse_name:_0x459eb1,prod_name:_0x546742,prod_code:_0x3de952,prod_qty:_0x3d8a39,prod_unit:_0x564834,prod_secondunit:_0x1c788f,prod_level:_0xbac9de,prod_isle:_0x5201c5,prod_pallet:_0x17c50a,note:_0x44f494,expiry_date:_0x3e33b8,batch_code:_0x14f06a,paid_amount:_0x472357,due_amount:_0x1a243c,Room_name:_0x17ad22,primary_code:_0x7c024e,secondary_code:_0x14e67e,PO_number:_0x266dd4,JO_number:_0x17545a}=_0x1969c5[_0x25d485(0x117)];if(typeof _0x546742==_0x25d485(0x1a9))var _0x2a0fd6=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x180)]],_0x3a71de=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x148)]],_0x3a5cd5=[_0x1969c5['body'][_0x25d485(0xb8)]],_0x28162f=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x18e)]],_0x409483=[_0x1969c5['body'][_0x25d485(0x190)]],_0xfd5717=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0xf1)]],_0x129876=[_0x1969c5['body'][_0x25d485(0x183)]],_0x16416c=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x16b)]],_0xa252c1=[_0x1969c5[_0x25d485(0x117)]['primary_code']],_0x160e83=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x123)]],_0x33b7bc=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0xcf)]],_0x54696f=[_0x1969c5['body']['batch_code']],_0x3bfcc7=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x185)]],_0xf13307=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x167)]],_0x51edc8=[_0x1969c5[_0x25d485(0x117)]['rak']],_0x26749c=[_0x1969c5[_0x25d485(0x117)][_0x25d485(0x199)]];else var _0x2a0fd6=[..._0x1969c5['body']['prod_name']],_0x3a71de=[..._0x1969c5[_0x25d485(0x117)]['prod_code']],_0x3a5cd5=[..._0x1969c5['body'][_0x25d485(0xb8)]],_0x28162f=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x18e)]],_0x409483=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x190)]],_0xfd5717=[..._0x1969c5[_0x25d485(0x117)]['prod_level']],_0x129876=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x183)]],_0x16416c=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x16b)]],_0xa252c1=[..._0x1969c5[_0x25d485(0x117)]['primary_code']],_0x160e83=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x123)]],_0x33b7bc=[..._0x1969c5[_0x25d485(0x117)]['MaxStocks_data']],_0x54696f=[..._0x1969c5[_0x25d485(0x117)]['batch_code']],_0x3bfcc7=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x185)]],_0xf13307=[..._0x1969c5[_0x25d485(0x117)][_0x25d485(0x167)]],_0x51edc8=[..._0x1969c5['body'][_0x25d485(0x12f)]],_0x26749c=[..._0x1969c5[_0x25d485(0x117)]['type']];const _0x4772d4=_0x2a0fd6['map'](_0x961c55=>{return _0x961c55={'product_name':_0x961c55};});_0x3a71de['forEach']((_0x14013d,_0x4c8005)=>{var _0x404c0d=_0x25d485;_0x4772d4[_0x4c8005][_0x404c0d(0x156)]=_0x14013d;}),_0x3a5cd5[_0x25d485(0x1a8)]((_0x44617d,_0x34b066)=>{var _0x51f5be=_0x25d485;_0x4772d4[_0x34b066][_0x51f5be(0x165)]=_0x44617d;}),_0x28162f[_0x25d485(0x1a8)]((_0x5ca06b,_0x19f04b)=>{var _0x28e19c=_0x25d485;_0x4772d4[_0x19f04b][_0x28e19c(0x102)]=_0x5ca06b;}),_0x409483['forEach']((_0x359738,_0x334df0)=>{_0x4772d4[_0x334df0]['secondary_unit']=_0x359738;}),_0xfd5717[_0x25d485(0x1a8)]((_0xd8c5e5,_0x338a84)=>{var _0x16118a=_0x25d485;_0x4772d4[_0x338a84][_0x16118a(0x171)]=_0xd8c5e5;}),_0x129876[_0x25d485(0x1a8)]((_0xc023c5,_0x202946)=>{var _0x22d6ad=_0x25d485;_0x4772d4[_0x202946][_0x22d6ad(0x114)]=_0xc023c5;}),_0x16416c['forEach']((_0xd2742b,_0x5a76a4)=>{var _0x44dca9=_0x25d485;_0x4772d4[_0x5a76a4][_0x44dca9(0x18d)]=_0xd2742b;}),_0xa252c1['forEach']((_0x5b5585,_0x38c46d)=>{var _0x15f4ef=_0x25d485;_0x4772d4[_0x38c46d][_0x15f4ef(0xea)]=_0x5b5585;}),_0x160e83[_0x25d485(0x1a8)]((_0x41906c,_0x3eed6b)=>{var _0x437b76=_0x25d485;_0x4772d4[_0x3eed6b][_0x437b76(0x123)]=_0x41906c;}),_0x33b7bc[_0x25d485(0x1a8)]((_0xb1fa53,_0x301e94)=>{var _0x20d3c2=_0x25d485;_0x4772d4[_0x301e94][_0x20d3c2(0x132)]=_0xb1fa53;}),_0x54696f[_0x25d485(0x1a8)]((_0x4fa185,_0x5c7a66)=>{var _0x37b753=_0x25d485;_0x4772d4[_0x5c7a66][_0x37b753(0x1c5)]=_0x4fa185;}),_0x3bfcc7['forEach']((_0x21b41,_0x337fad)=>{var _0x447d7d=_0x25d485;_0x4772d4[_0x337fad][_0x447d7d(0x185)]=_0x21b41;}),_0x26749c[_0x25d485(0x1a8)]((_0x547491,_0x49f62c)=>{var _0x1ba557=_0x25d485;_0x4772d4[_0x49f62c][_0x1ba557(0x199)]=_0x547491;}),_0xf13307[_0x25d485(0x1a8)]((_0x1fa293,_0x4ff7f0)=>{_0x4772d4[_0x4ff7f0]['storage']=_0x1fa293;}),_0x51edc8[_0x25d485(0x1a8)]((_0x2e6b1e,_0x9d69b7)=>{var _0x2f5c73=_0x25d485;_0x4772d4[_0x9d69b7][_0x2f5c73(0x144)]=_0x2e6b1e;});const _0x1f0ea3=_0x4772d4[_0x25d485(0xd5)](_0x489cfa=>_0x489cfa[_0x25d485(0x165)]!=='0'&&_0x489cfa[_0x25d485(0x165)]!=='');_0x123eac[_0x25d485(0x14b)]=_0x58f6b0,_0x123eac[_0x25d485(0xf9)]=_0x486b9d,_0x123eac[_0x25d485(0xd7)]=_0x562055,_0x123eac[_0x25d485(0x12a)]=_0x459eb1,_0x123eac[_0x25d485(0x112)]=_0x1f0ea3,_0x123eac[_0x25d485(0x198)]=_0x44f494,_0x123eac[_0x25d485(0xb4)]=_0x472357,_0x123eac['due_amount']=_0x1a243c,_0x123eac[_0x25d485(0x1a2)]=_0x17ad22,_0x123eac[_0x25d485(0x187)]=_0x266dd4,_0x123eac[_0x25d485(0x1c2)]=_0x17545a;const _0x47f9ac=await _0x123eac['save'](),_0x5b438b=await warehouse['findOne']({'name':_0x1969c5[_0x25d485(0x117)][_0x25d485(0x12a)],'room':_0x1969c5[_0x25d485(0x117)][_0x25d485(0x11a)]});_0x123eac[_0x25d485(0x112)][_0x25d485(0x1a8)](_0x6c018b=>{var _0x388686=_0x25d485,_0x2d44ae=0x0;const _0x43ecd2=_0x5b438b['product_details']['map'](_0x24d319=>{var _0x591346=a0_0x318a;_0x24d319[_0x591346(0xfc)]==_0x6c018b[_0x591346(0xfc)]&&_0x24d319[_0x591346(0x18d)]==_0x6c018b['floorlevel']&&_0x24d319[_0x591346(0x199)]==_0x6c018b[_0x591346(0x199)]&&_0x24d319[_0x591346(0x114)]==_0x6c018b[_0x591346(0x114)]&&_0x24d319['bay']==_0x6c018b[_0x591346(0x171)]&&_0x24d319[_0x591346(0x144)]==_0x6c018b[_0x591346(0x144)]&&_0x24d319[_0x591346(0x167)]==_0x6c018b[_0x591346(0x167)]&&(_0x24d319[_0x591346(0x17c)]=parseInt(_0x24d319[_0x591346(0x17c)])+parseInt(_0x6c018b[_0x591346(0x165)]),_0x2d44ae++);});_0x2d44ae=='0'&&(_0x5b438b[_0x388686(0x152)]=_0x5b438b[_0x388686(0x152)]['concat']({'product_name':_0x6c018b[_0x388686(0xfc)],'product_stock':_0x6c018b[_0x388686(0x165)],'primary_code':_0x6c018b[_0x388686(0xea)],'secondary_code':_0x6c018b[_0x388686(0x123)],'product_code':_0x6c018b[_0x388686(0x156)],'storage':_0x6c018b['storage'],'rack':_0x6c018b['rack'],'bay':_0x6c018b[_0x388686(0x171)],'bin':_0x6c018b[_0x388686(0x114)],'type':_0x6c018b['type'],'floorlevel':_0x6c018b[_0x388686(0x18d)],'maxProducts':_0x6c018b[_0x388686(0x132)],'unit':_0x6c018b[_0x388686(0x102)],'secondary_unit':_0x6c018b[_0x388686(0x194)],'expiry_date':_0x6c018b['expiry_date']}));}),await _0x5b438b['save']();const _0x3b418b=await s_payment_data[_0x25d485(0x126)]({'invoice':_0x1969c5[_0x25d485(0x117)]['invoice']});if(_0x3b418b===null){}else console[_0x25d485(0x1a3)](_0x25d485(0xf9),_0x3b418b,_0x1969c5[_0x25d485(0x117)][_0x25d485(0x14b)]),_0x3b418b['suppliers']=_0x1969c5['body'][_0x25d485(0xf9)],await _0x3b418b[_0x25d485(0xb6)]();_0x1969c5[_0x25d485(0xf0)](_0x25d485(0x150),_0x25d485(0x1d0)),_0x4e06e5['redirect']('/all_purchases/view');}catch(_0x2e0368){console['log'](_0x2e0368);}}),router[a0_0x1d7139(0x120)](a0_0x1d7139(0xcc),auth,async(_0xde8e73,_0x3076d2)=>{var _0x355acd=a0_0x1d7139;try{const _0x415325=_0xde8e73['params']['id'],{invoice:_0x537b69,suppliers:_0x3cfff5,payable:_0x45b80f,due_amount:_0x4a7a5a}=_0xde8e73['body'],_0x276f83=await purchases[_0x355acd(0x164)](_0x415325);var _0x1ed0af=_0x45b80f-_0x4a7a5a;_0x276f83[_0x355acd(0xb4)]=parseFloat(_0x276f83[_0x355acd(0xb4)])+parseFloat(_0x4a7a5a),_0x276f83[_0x355acd(0xf6)]=_0x1ed0af;const _0x4132c8=await _0x276f83[_0x355acd(0xb6)]();console[_0x355acd(0x1a3)](_0x4132c8);const _0x32b638=await s_payment_data[_0x355acd(0x126)]({'invoice':_0x537b69});_0x32b638[_0x355acd(0x11f)]=_0x1ed0af,await _0x32b638[_0x355acd(0xb6)]();let _0x47c075=new Date(),_0x1a67d7=('0'+_0x47c075[_0x355acd(0x1d5)]())['slice'](-0x2),_0x4df2eb=('0'+(_0x47c075[_0x355acd(0xe1)]()+0x1))[_0x355acd(0xb7)](-0x2),_0xa92f64=_0x47c075[_0x355acd(0x130)](),_0x37d7dd=_0xa92f64+'-'+_0x4df2eb+'-'+_0x1a67d7;const _0x3dfda5=new suppliers_payment({'invoice':_0x537b69,'date':_0xa92f64+'-'+_0x4df2eb+'-'+_0x1a67d7,'suppliers':_0x3cfff5,'reason':_0x355acd(0x100),'amount':_0x4a7a5a}),_0x314c8e=await _0x3dfda5['save']();_0xde8e73['flash'](_0x355acd(0x150),_0x355acd(0x1d3)),_0x3076d2[_0x355acd(0x178)](_0x355acd(0x138));}catch(_0x4a84d0){console[_0x355acd(0x1a3)](_0x4a84d0);}}),router['get'](a0_0x1d7139(0xe7),auth,async(_0x1d95be,_0x3c4f40)=>{var _0x2eac59=a0_0x1d7139;try{const {username:_0x2762d3,email:_0x3599b9,role:_0x2aadb7}=_0x1d95be[_0x2eac59(0xbd)],_0x39c527=_0x1d95be[_0x2eac59(0xbd)],_0x58d5df=await profile[_0x2eac59(0x126)]({'email':_0x39c527[_0x2eac59(0xc6)]}),_0x31a946=await master_shop['find']();console[_0x2eac59(0x1a3)](_0x2eac59(0x137),_0x31a946);const _0x3d6c3f=_0x1d95be[_0x2eac59(0x1c6)]['id'],_0x559106=await purchases[_0x2eac59(0x164)](_0x3d6c3f);console['log'](_0x559106);const _0x3a09e8=await suppliers[_0x2eac59(0x126)]({'name':_0x559106[_0x2eac59(0xf9)]});console['log'](_0x3a09e8);if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0x10e)){var _0x4321c3=users[_0x2eac59(0x186)];console[_0x2eac59(0x1a3)](_0x4321c3);}else{if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0x1ae))var _0x4321c3=users[_0x2eac59(0x1ae)];else{if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0x1bd))var _0x4321c3=users[_0x2eac59(0x1bd)];else{if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0x1cd))var _0x4321c3=users[_0x2eac59(0x1cd)];else{if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0x1bb))var _0x4321c3=users['French'];else{if(_0x31a946[0x0][_0x2eac59(0xc5)]=='Portuguese\x20(BR)')var _0x4321c3=users['Portuguese'];else{if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0x19d))var _0x4321c3=users[_0x2eac59(0x19d)];else{if(_0x31a946[0x0][_0x2eac59(0xc5)]==_0x2eac59(0xd1))var _0x4321c3=users[_0x2eac59(0x147)];}}}}}}}_0x3c4f40['render']('purchase_invoice',{'success':_0x1d95be[_0x2eac59(0xf0)](_0x2eac59(0x150)),'errors':_0x1d95be[_0x2eac59(0xf0)]('errors'),'role':_0x39c527,'profile':_0x58d5df,'master_shop':_0x31a946,'supplier':_0x3a09e8,'purchase':_0x559106,'language':_0x4321c3});}catch(_0x780b5){console[_0x2eac59(0x1a3)](_0x780b5);}}),router[a0_0x1d7139(0x108)]('/view/return_purchase/:id',auth,async(_0x4f67c9,_0x44ea37)=>{var _0x4264a7=a0_0x1d7139;try{const {username:_0x1d0a1c,email:_0x5ae375,role:_0x535859}=_0x4f67c9[_0x4264a7(0xbd)],_0x4fd1a3=_0x4f67c9[_0x4264a7(0xbd)],_0xd9995e=await profile[_0x4264a7(0x126)]({'email':_0x4fd1a3[_0x4264a7(0xc6)]}),_0x472104=await master_shop[_0x4264a7(0xd6)]();console[_0x4264a7(0x1a3)](_0x4264a7(0x137),_0x472104);const _0x3b3814=_0x4f67c9[_0x4264a7(0x1c6)]['id'];console[_0x4264a7(0x1a3)](_0x3b3814);const _0x2cb760=await purchases[_0x4264a7(0x164)](_0x3b3814);console[_0x4264a7(0x1a3)](_0x4264a7(0x1d2),_0x2cb760);const _0x301958=await product[_0x4264a7(0xd6)]({}),_0x4ba9e4=await warehouse['aggregate']([{'$match':{'name':_0x2cb760[_0x4264a7(0x12a)],'room':_0x2cb760[_0x4264a7(0x1a2)],'warehouse_category':_0x4264a7(0x13c)}},{'$unwind':_0x4264a7(0x169)},{'$group':{'_id':_0x4264a7(0x1b9),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4264a7(0x189)},'bay':{'$first':_0x4264a7(0x103)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x4264a7(0xda)},'primary_code':{'$first':_0x4264a7(0xc7)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4264a7(0x146)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4264a7(0x119)}}}]);warehouse_data=await warehouse[_0x4264a7(0x17b)]([{'$match':{'status':_0x4264a7(0x11d),'name':_0x4264a7(0xd3),'warehouse_category':_0x4264a7(0x13c)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x4264a7(0x1a3)](_0x4264a7(0x101),_0x4ba9e4);if(_0x472104[0x0][_0x4264a7(0xc5)]=='English\x20(US)'){var _0x3fccc5=users[_0x4264a7(0x186)];console[_0x4264a7(0x1a3)](_0x3fccc5);}else{if(_0x472104[0x0][_0x4264a7(0xc5)]==_0x4264a7(0x1ae))var _0x3fccc5=users[_0x4264a7(0x1ae)];else{if(_0x472104[0x0][_0x4264a7(0xc5)]==_0x4264a7(0x1bd))var _0x3fccc5=users[_0x4264a7(0x1bd)];else{if(_0x472104[0x0][_0x4264a7(0xc5)]==_0x4264a7(0x1cd))var _0x3fccc5=users[_0x4264a7(0x1cd)];else{if(_0x472104[0x0][_0x4264a7(0xc5)]=='French')var _0x3fccc5=users[_0x4264a7(0x1bb)];else{if(_0x472104[0x0][_0x4264a7(0xc5)]==_0x4264a7(0x16c))var _0x3fccc5=users['Portuguese'];else{if(_0x472104[0x0][_0x4264a7(0xc5)]==_0x4264a7(0x19d))var _0x3fccc5=users[_0x4264a7(0x19d)];else{if(_0x472104[0x0][_0x4264a7(0xc5)]==_0x4264a7(0xd1))var _0x3fccc5=users[_0x4264a7(0x147)];}}}}}}}_0x44ea37['render'](_0x4264a7(0xee),{'success':_0x4f67c9[_0x4264a7(0xf0)]('success'),'errors':_0x4f67c9[_0x4264a7(0xf0)](_0x4264a7(0x111)),'role':_0x4fd1a3,'profile':_0xd9995e,'user':_0x2cb760,'stock':_0x4ba9e4,'master_shop':_0x472104,'product':_0x301958,'language':_0x3fccc5,'warehouse':warehouse_data});}catch(_0x35caa3){console[_0x4264a7(0x1a3)](_0x35caa3);}}),router['post']('/view/return_purchase/:id',auth,async(_0x1f331f,_0x363806)=>{var _0x24d9f4=a0_0x1d7139;try{const {invoice:_0x2b13c0,date:_0xabb287,warehouse_name:_0x3a7f3f,Room_name:_0x196ffd,product_name:_0x2c0f38,purchase_quantity:_0x58e45e,stocks:_0x4a3979,return_qty:_0x400ebb,note:_0x8e2b7e,level:_0x107c12,isle:_0x110758,pallet:_0x485852,to_warehouse_name:_0xa130d9,to_Room_name:_0x50437f}=_0x1f331f[_0x24d9f4(0x117)],_0x2a1d3c=await purchases[_0x24d9f4(0x126)]({'_id':_0x1f331f[_0x24d9f4(0x1c6)]['id']}),_0x54d0e3=await warehouse[_0x24d9f4(0x126)]({'name':_0x3a7f3f,'room':_0x196ffd});if(typeof _0x2c0f38==_0x24d9f4(0x1a9))var _0x340d52=[_0x1f331f['body'][_0x24d9f4(0xfc)]],_0x255def=[_0x1f331f['body'][_0x24d9f4(0x188)]],_0x5a8e5d=[_0x1f331f['body'][_0x24d9f4(0x181)]],_0x36a666=[_0x1f331f['body'][_0x24d9f4(0xf5)]],_0x3bdf08=[_0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x1a7)]],_0x3b0d08=[_0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x193)]],_0x57ebe5=[_0x1f331f[_0x24d9f4(0x117)]['pallet']],_0x1aa8d0=[_0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x134)]],_0x194325=[_0x1f331f['body'][_0x24d9f4(0x149)]],_0x162037=[_0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x175)]],_0x3aba91=[_0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x182)]];else var _0x340d52=[..._0x1f331f['body']['product_name']],_0x255def=[..._0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x188)]],_0x5a8e5d=[..._0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x181)]],_0x36a666=[..._0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0xf5)]],_0x3bdf08=[..._0x1f331f['body'][_0x24d9f4(0x1a7)]],_0x3b0d08=[..._0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x193)]],_0x57ebe5=[..._0x1f331f['body'][_0x24d9f4(0xce)]],_0x1aa8d0=[..._0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x134)]],_0x194325=[..._0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0x149)]],_0x162037=[..._0x1f331f[_0x24d9f4(0x117)]['primary_code_hide']],_0x3aba91=[..._0x1f331f['body'][_0x24d9f4(0x182)]];const _0xcb4589=_0x340d52[_0x24d9f4(0x14c)](_0x10cbbc=>{return _0x10cbbc={'product_name':_0x10cbbc};});_0x255def[_0x24d9f4(0x1a8)]((_0x4c087a,_0x54523e)=>{var _0x33bf79=_0x24d9f4;_0xcb4589[_0x54523e][_0x33bf79(0x188)]=_0x4c087a;}),_0x5a8e5d[_0x24d9f4(0x1a8)]((_0x52e499,_0xf73d3f)=>{var _0x4dac33=_0x24d9f4;_0xcb4589[_0xf73d3f][_0x4dac33(0x13e)]=_0x52e499;}),_0x36a666[_0x24d9f4(0x1a8)]((_0x64c875,_0x3092d5)=>{var _0x4134bf=_0x24d9f4;_0xcb4589[_0x3092d5][_0x4134bf(0xf5)]=_0x64c875;}),_0x3bdf08[_0x24d9f4(0x1a8)]((_0x390955,_0xbf8611)=>{var _0x23d204=_0x24d9f4;_0xcb4589[_0xbf8611][_0x23d204(0x171)]=_0x390955;}),_0x3b0d08[_0x24d9f4(0x1a8)]((_0x50986d,_0x46a34d)=>{var _0x55e979=_0x24d9f4;_0xcb4589[_0x46a34d][_0x55e979(0x114)]=_0x50986d;}),_0x57ebe5[_0x24d9f4(0x1a8)]((_0x385c24,_0x2b5dec)=>{_0xcb4589[_0x2b5dec]['floorlevel']=_0x385c24;}),_0x1aa8d0[_0x24d9f4(0x1a8)]((_0x61293d,_0xb1d19)=>{var _0x1b8bbd=_0x24d9f4;_0xcb4589[_0xb1d19][_0x1b8bbd(0x199)]=_0x61293d;}),_0x194325[_0x24d9f4(0x1a8)]((_0xc3e310,_0x20d66b)=>{var _0x72e00d=_0x24d9f4;_0xcb4589[_0x20d66b][_0x72e00d(0x156)]=_0xc3e310;}),_0x162037[_0x24d9f4(0x1a8)]((_0x3d2715,_0x234138)=>{_0xcb4589[_0x234138]['primary_code']=_0x3d2715;}),_0x3aba91[_0x24d9f4(0x1a8)]((_0x5765e9,_0x3d8004)=>{var _0x255fae=_0x24d9f4;_0xcb4589[_0x3d8004][_0x255fae(0x123)]=_0x5765e9;}),_0x2a1d3c[_0x24d9f4(0x112)][_0x24d9f4(0x1a8)](_0x166a7a=>{var _0x2b248e=_0x24d9f4;const _0x1ceeb0=_0x54d0e3[_0x2b248e(0x152)]['map'](_0x2d7546=>{var _0x17e38b=_0x2b248e;_0x2d7546[_0x17e38b(0xfc)]==_0x166a7a['product_name']&&_0x2d7546[_0x17e38b(0x18d)]==_0x166a7a[_0x17e38b(0x18d)]&&_0x2d7546[_0x17e38b(0x199)]==_0x166a7a[_0x17e38b(0x199)]&&_0x2d7546[_0x17e38b(0x114)]==_0x166a7a[_0x17e38b(0x114)]&&_0x2d7546[_0x17e38b(0x171)]==_0x166a7a[_0x17e38b(0x171)]&&_0x2d7546[_0x17e38b(0x144)]==_0x166a7a[_0x17e38b(0x144)]&&_0x2d7546[_0x17e38b(0x167)]==_0x166a7a[_0x17e38b(0x167)]&&(console['log'](parseInt(_0x2d7546[_0x17e38b(0x17c)])+_0x17e38b(0xfe)+parseInt(_0x166a7a[_0x17e38b(0x165)])),_0x2d7546['product_stock']=parseInt(_0x2d7546[_0x17e38b(0x17c)])+parseInt(_0x166a7a[_0x17e38b(0x165)]));});}),await _0x54d0e3[_0x24d9f4(0xb6)]();const _0x46b300=_0xcb4589[_0x24d9f4(0xd5)](_0x22f267=>_0x22f267[_0x24d9f4(0xf5)]!=='0'&&_0x22f267[_0x24d9f4(0xf5)]!=='');var _0x23aa5f=0x0;_0x46b300['forEach'](_0x555e3e=>{var _0x388439=_0x24d9f4;console[_0x388439(0x1a3)](_0x388439(0xd2),_0x555e3e),(parseInt(_0x555e3e[_0x388439(0x188)])<parseInt(_0x555e3e[_0x388439(0xf5)])||parseInt(_0x555e3e['stock_quantity'])<parseInt(_0x555e3e[_0x388439(0xf5)]))&&_0x23aa5f++;});if(_0x23aa5f!=0x0)return _0x1f331f[_0x24d9f4(0xf0)](_0x24d9f4(0x111),_0x24d9f4(0x17e)),_0x363806[_0x24d9f4(0x178)](_0x24d9f4(0x104));const _0x53e92c=new purchases_return({'invoice':_0x2b13c0,'suppliers':_0x1f331f['body'][_0x24d9f4(0xf9)],'date':_0xabb287,'warehouse_name':_0x3a7f3f,'return_product':_0x46b300,'note':_0x8e2b7e,'room':_0x196ffd,'to_warehouse_name':_0xa130d9,'to_room':_0x50437f}),_0x4088b2=await _0x53e92c[_0x24d9f4(0xb6)]();console[_0x24d9f4(0x1a3)](_0x53e92c);const _0x2d1114=await purchases_return['findOne']({'invoice':_0x2b13c0}),_0x3ec1c3=await warehouse['findOne']({'name':_0xa130d9,'room':_0x50437f});_0x2d1114[_0x24d9f4(0xb5)]['forEach'](_0x297723=>{var _0x164d96=_0x24d9f4,_0x44d1f6=0x0;const _0x2336fb=_0x3ec1c3[_0x164d96(0x152)][_0x164d96(0x14c)](_0x4b11b6=>{var _0xc10116=_0x164d96;_0x4b11b6['product_name']==_0x297723[_0xc10116(0xfc)]&&_0x4b11b6[_0xc10116(0x18d)]==_0x297723[_0xc10116(0x18d)]&&_0x4b11b6[_0xc10116(0x199)]==_0x297723[_0xc10116(0x199)]&&_0x4b11b6[_0xc10116(0x114)]==_0x297723['bin']&&_0x4b11b6[_0xc10116(0x171)]==_0x297723['bay']&&(_0x4b11b6['product_stock']=parseInt(_0x4b11b6[_0xc10116(0x17c)])-parseInt(_0x297723[_0xc10116(0xf5)]),_0x44d1f6++);});_0x44d1f6=='0'&&(_0x3ec1c3[_0x164d96(0x152)]=_0x3ec1c3[_0x164d96(0x152)]['concat']({'product_name':_0x297723[_0x164d96(0xfc)],'product_stock':_0x297723[_0x164d96(0xf5)],'primary_code':_0x297723['primary_code'],'secondary_code':_0x297723['secondary_code'],'product_code':_0x297723[_0x164d96(0x156)],'storage':_0x297723['storage'],'rack':_0x297723[_0x164d96(0x144)],'bay':_0x297723[_0x164d96(0x171)],'bin':_0x297723['bin'],'type':_0x297723[_0x164d96(0x199)],'floorlevel':_0x297723[_0x164d96(0x18d)],'maxProducts':_0x297723[_0x164d96(0x132)],'unit':_0x297723[_0x164d96(0x102)],'secondary_unit':_0x297723[_0x164d96(0x194)],'expiry_date':_0x297723['expiry_date']}));}),await _0x3ec1c3[_0x24d9f4(0xb6)]();const _0x1000ef=await purchases[_0x24d9f4(0x126)]({'invoice':_0x2b13c0});_0x1000ef[_0x24d9f4(0x129)]=_0x24d9f4(0x1ba);const _0x4402dc=await _0x1000ef[_0x24d9f4(0xb6)](),_0x429a03=new s_payment_data({'invoice':_0x2b13c0,'suppliers':_0x1f331f['body'][_0x24d9f4(0xf9)],'reason':'Purchase\x20Return'});await _0x429a03['save']();const _0x2c867a=await master_shop[_0x24d9f4(0xd6)]();console[_0x24d9f4(0x1a3)]('add\x20post',_0x2c867a[0x0][_0x24d9f4(0x19c)]);const _0x9262cc=await email_settings[_0x24d9f4(0x126)](),_0x36bc2f=await suppliers['findOne']({'name':_0x1f331f[_0x24d9f4(0x117)][_0x24d9f4(0xf9)]});console[_0x24d9f4(0x1a3)](_0x24d9f4(0x14f),_0x36bc2f);_0x2c867a[0x0][_0x24d9f4(0x19e)]==0x1?(right_currency=_0x2c867a[0x0][_0x24d9f4(0xc4)],left_currency=''):(right_currency='',left_currency=_0x2c867a[0x0][_0x24d9f4(0xc4)]);var _0x20f8d9=_0x340d52,_0x12cad5=_0x36a666,_0x2b6503='',_0x547487;for(_0x547487 in _0x20f8d9){_0x2b6503+=_0x24d9f4(0x15b)+_0x24d9f4(0xbf)+_0x20f8d9[_0x547487]+_0x24d9f4(0x1aa)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x12cad5[_0x547487]+_0x24d9f4(0x1aa)+_0x24d9f4(0xdd);}console[_0x24d9f4(0x1a3)](_0x24d9f4(0x162),_0x2b6503);let _0x274ae7=nodemailer[_0x24d9f4(0x1ad)]({'service':_0x24d9f4(0x1c3),'auth':{'user':_0x9262cc[_0x24d9f4(0xc6)],'pass':_0x9262cc[_0x24d9f4(0xf8)]}}),_0x585c3a={'from':_0x9262cc[_0x24d9f4(0xc6)],'to':_0x36bc2f['email'],'subject':_0x24d9f4(0xe2),'attachments':[{'filename':_0x24d9f4(0x139),'path':__dirname+_0x24d9f4(0x161)+_0x24d9f4(0xf2)+_0x2c867a[0x0][_0x24d9f4(0x19c)],'cid':_0x24d9f4(0x191)}],'html':'<!DOCTYPE\x20html>'+_0x24d9f4(0x192)+_0x24d9f4(0xd0)+'<div>'+_0x24d9f4(0x1cf)+_0x24d9f4(0xc8)+_0x24d9f4(0xd4)+_0x24d9f4(0x1b8)+_0x24d9f4(0xc8)+'<h2>\x20'+_0x2c867a[0x0]['site_title']+_0x24d9f4(0x1d4)+'</div>'+_0x24d9f4(0x1b8)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x24d9f4(0x1c7)+_0x24d9f4(0x11b)+_0x2b13c0+'\x20'+_0x24d9f4(0xca)+_0x24d9f4(0x1a1)+_0xabb287+'\x20'+_0x24d9f4(0x118)+_0x24d9f4(0x106)+_0x24d9f4(0x1b8)+_0x24d9f4(0xcb)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+'<tr>'+_0x24d9f4(0x124)+_0x24d9f4(0x17f)+_0x24d9f4(0x176)+_0x24d9f4(0x195)+_0x24d9f4(0xdd)+_0x24d9f4(0x131)+_0x24d9f4(0xbb)+'\x20'+_0x2b6503+'\x20'+_0x24d9f4(0x136)+'</table>'+'<div>'+'<strong>\x20Regards\x20</strong>'+_0x24d9f4(0x1bf)+_0x2c867a[0x0]['site_title']+_0x24d9f4(0x106)+_0x24d9f4(0x1b8)+'</div>'+_0x24d9f4(0x1af)};_0x274ae7[_0x24d9f4(0x160)](_0x585c3a,function(_0xf27177,_0x5ea9e0){var _0xde5448=_0x24d9f4;_0xf27177?(console[_0xde5448(0x1a3)](_0xf27177),console[_0xde5448(0x1a3)](_0xde5448(0x133))):console[_0xde5448(0x1a3)](_0xde5448(0xc2));}),_0x1f331f[_0x24d9f4(0xf0)](_0x24d9f4(0x150),_0x24d9f4(0x1d7)),_0x363806[_0x24d9f4(0x178)](_0x24d9f4(0x138));}catch(_0x103b8f){console[_0x24d9f4(0x1a3)](_0x103b8f),_0x363806['status'](0xc8)[_0x24d9f4(0x10a)]({'message':_0x103b8f[_0x24d9f4(0xcd)]});}}),router[a0_0x1d7139(0x108)](a0_0x1d7139(0x197),auth,async(_0x239872,_0x7ac87c)=>{var _0x59fc64=a0_0x1d7139;try{const {username:_0x5ef173,email:_0x138495,role:_0x39e280}=_0x239872[_0x59fc64(0xbd)],_0x2020a8=_0x239872[_0x59fc64(0xbd)],_0x5a1ff7=await profile['findOne']({'email':_0x2020a8[_0x59fc64(0xc6)]}),_0x214111=await master_shop[_0x59fc64(0xd6)](),_0x4928de=_0x239872[_0x59fc64(0x1c6)]['id'],_0x4cbe0c=await purchases[_0x59fc64(0x164)](_0x4928de);if(_0x214111[0x0][_0x59fc64(0xc5)]==_0x59fc64(0x10e))var _0x5a553c=users['English'];else{if(_0x214111[0x0][_0x59fc64(0xc5)]==_0x59fc64(0x1ae))var _0x5a553c=users['Hindi'];else{if(_0x214111[0x0][_0x59fc64(0xc5)]==_0x59fc64(0x1bd))var _0x5a553c=users[_0x59fc64(0x1bd)];else{if(_0x214111[0x0][_0x59fc64(0xc5)]==_0x59fc64(0x1cd))var _0x5a553c=users[_0x59fc64(0x1cd)];else{if(_0x214111[0x0]['language']==_0x59fc64(0x1bb))var _0x5a553c=users[_0x59fc64(0x1bb)];else{if(_0x214111[0x0][_0x59fc64(0xc5)]==_0x59fc64(0x16c))var _0x5a553c=users[_0x59fc64(0x12c)];else{if(_0x214111[0x0][_0x59fc64(0xc5)]=='Chinese')var _0x5a553c=users[_0x59fc64(0x19d)];else{if(_0x214111[0x0][_0x59fc64(0xc5)]==_0x59fc64(0xd1))var _0x5a553c=users[_0x59fc64(0x147)];}}}}}}}_0x7ac87c[_0x59fc64(0xe9)](_0x59fc64(0x1ab),{'success':_0x239872[_0x59fc64(0xf0)](_0x59fc64(0x150)),'errors':_0x239872['flash'](_0x59fc64(0x111)),'role':_0x2020a8,'profile':_0x5a1ff7,'alldata':_0x4cbe0c,'master_shop':_0x214111,'language':_0x5a553c}),console['log'](alldata);}catch(_0x41aa03){console[_0x59fc64(0x1a3)](_0x41aa03);}}),router[a0_0x1d7139(0x120)](a0_0x1d7139(0x153),async(_0x3164c0,_0x189635)=>{var _0x1d99a1=a0_0x1d7139;const {product_code:_0x19e431}=_0x3164c0[_0x1d99a1(0x117)];var _0x3f944f;const _0x13a16a=await product['aggregate']([{'$match':{'primary_code':_0x19e431,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x1d99a1(0xbc),'name':{'$first':'$name'},'category':{'$first':_0x1d99a1(0x14e)},'brand':{'$first':_0x1d99a1(0x10f)},'unit':{'$first':_0x1d99a1(0x1b5)},'alertquantity':{'$first':_0x1d99a1(0x19a)},'product_code':{'$first':_0x1d99a1(0x17d)},'primary_code':{'$first':_0x1d99a1(0x1b6)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1d99a1(0x122)},'maxProdPerUnit':{'$first':_0x1d99a1(0x145)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x1d99a1(0x1ac)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x478da1=await product[_0x1d99a1(0x17b)]([{'$match':{'secondary_code':_0x19e431,'product_category':_0x1d99a1(0x13c)}},{'$group':{'_id':_0x1d99a1(0xbc),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x1d99a1(0x10f)},'unit':{'$first':_0x1d99a1(0x1b5)},'alertquantity':{'$first':_0x1d99a1(0x19a)},'product_code':{'$first':_0x1d99a1(0x17d)},'primary_code':{'$first':_0x1d99a1(0x1b6)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x1d99a1(0x122)},'maxProdPerUnit':{'$first':_0x1d99a1(0x145)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x1d99a1(0x1ac)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x13a16a[_0x1d99a1(0x13f)]>0x0)_0x3f944f=_0x13a16a;else _0x478da1[_0x1d99a1(0x13f)]>0x0&&(_0x3f944f=_0x478da1);_0x189635[_0x1d99a1(0x10a)](_0x3f944f);}),router[a0_0x1d7139(0x120)](a0_0x1d7139(0x1cb),async(_0x4bda2b,_0x369c84)=>{var _0x253180=a0_0x1d7139;const {primaryCode:_0x8f5ca5,secondaryCode:_0x56797e,productCode:_0x54a2e5,bay:_0x354ffd,bin:_0x1f0e7c,types:_0x3c86ce,pallet:_0x4db452,warehouses:_0x50df8f,room:_0x16d72d}=_0x4bda2b[_0x253180(0x117)];console[_0x253180(0x1a3)](_0x4bda2b['body']);try{const _0x4f1d7e=await warehouse[_0x253180(0x17b)]([{'$match':{'name':_0x50df8f,'room':_0x16d72d}},{'$unwind':_0x253180(0x169)},{'$match':{'product_details.bay':_0x354ffd,'product_details.bin':_0x1f0e7c,'product_details.type':_0x3c86ce}},{'$group':{'_id':_0x253180(0x1b9),'name':{'$first':_0x253180(0x19f)},'product_stock':{'$first':_0x253180(0x189)},'level':{'$first':_0x253180(0xf7)},'isle':{'$first':_0x253180(0x1d6)},'pallet':{'$first':_0x253180(0x110)},'maxProducts':{'$first':_0x253180(0xfb)}}}]);_0x369c84[_0x253180(0x1c4)](0xc8)[_0x253180(0x10a)](_0x4f1d7e);}catch(_0x40e341){_0x369c84[_0x253180(0x1c4)](0x194)[_0x253180(0x10a)]({'message':_0x40e341[_0x253180(0xcd)]});}}),module[a0_0x1d7139(0xff)]=router;