var a0_0x23264f=a0_0x3eb1;(function(_0x2ce87b,_0x5547f7){var _0x5c4c98=a0_0x3eb1,_0x133197=_0x2ce87b();while(!![]){try{var _0x41e635=parseInt(_0x5c4c98(0x20c))/0x1*(-parseInt(_0x5c4c98(0x1c5))/0x2)+parseInt(_0x5c4c98(0x203))/0x3+-parseInt(_0x5c4c98(0x122))/0x4*(parseInt(_0x5c4c98(0x1e4))/0x5)+-parseInt(_0x5c4c98(0x148))/0x6+-parseInt(_0x5c4c98(0x17f))/0x7*(-parseInt(_0x5c4c98(0x105))/0x8)+-parseInt(_0x5c4c98(0x1e7))/0x9+parseInt(_0x5c4c98(0x12c))/0xa;if(_0x41e635===_0x5547f7)break;else _0x133197['push'](_0x133197['shift']());}catch(_0x5dc86f){_0x133197['push'](_0x133197['shift']());}}}(a0_0x954e,0x59b57));function a0_0x3eb1(_0x20e435,_0x455df5){var _0x954ef1=a0_0x954e();return a0_0x3eb1=function(_0x3eb132,_0x10931a){_0x3eb132=_0x3eb132-0x105;var _0x449b50=_0x954ef1[_0x3eb132];return _0x449b50;},a0_0x3eb1(_0x20e435,_0x455df5);}const express=require(a0_0x23264f(0x118)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x23264f(0x20f)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require(a0_0x23264f(0x213));const path=require('path'),users=require(a0_0x23264f(0x183));router[a0_0x23264f(0x1dd)]('/view',auth,async(_0x1e7488,_0x953e57)=>{var _0x2d3f88=a0_0x23264f;try{const {username:_0x350cdd,email:_0x250b3e,role:_0x22ce09}=_0x1e7488[_0x2d3f88(0x193)],_0x234a3e=_0x1e7488[_0x2d3f88(0x193)],_0x52811d=await profile['findOne']({'email':_0x234a3e[_0x2d3f88(0x13d)]}),_0x2e8bdb=await staff[_0x2d3f88(0x21a)]({'email':_0x234a3e[_0x2d3f88(0x13d)]});if(_0x234a3e['role']=='staff'){const _0x33101c=await staff[_0x2d3f88(0x21a)]({'email':_0x234a3e[_0x2d3f88(0x13d)]});}const _0x525320=await master_shop[_0x2d3f88(0x114)]();let _0x27b59b;if(_0x234a3e['role']==_0x2d3f88(0x220)){const _0x4b8653=await staff['findOne']({'email':_0x234a3e[_0x2d3f88(0x13d)]});_0x27b59b=await purchases[_0x2d3f88(0x18a)]([{'$match':{'warehouse_name':_0x4b8653['warehouse']}},{'$lookup':{'from':_0x2d3f88(0x182),'localField':_0x2d3f88(0x182),'foreignField':'name','as':_0x2d3f88(0x15e)}},{'$unwind':_0x2d3f88(0x216)},{'$unwind':_0x2d3f88(0x1da)},{'$group':{'_id':_0x2d3f88(0x16f),'invoice':{'$first':_0x2d3f88(0x1b8)},'suppliers':{'$first':_0x2d3f88(0x178)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2d3f88(0x188)},'room':{'$first':'$room'},'product':{'$push':_0x2d3f88(0x1da)},'note':{'$first':_0x2d3f88(0x159)},'paid_amount':{'$first':_0x2d3f88(0x1cb)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':_0x2d3f88(0x1e8)},'batch_code':{'$first':_0x2d3f88(0x1de)},'expiry_date':{'$first':_0x2d3f88(0x112)},'suppliers_docs':{'$first':_0x2d3f88(0x216)},'total_product_quantity':{'$sum':_0x2d3f88(0x16b)},'level':{'$addToSet':_0x2d3f88(0x1a0)},'isle':{'$addToSet':_0x2d3f88(0x1c9)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x27b59b=await purchases[_0x2d3f88(0x18a)]([{'$lookup':{'from':'suppliers','localField':_0x2d3f88(0x182),'foreignField':_0x2d3f88(0x1dc),'as':'suppliers_docs'}},{'$unwind':_0x2d3f88(0x216)},{'$unwind':_0x2d3f88(0x1da)},{'$group':{'_id':'$_id','invoice':{'$first':_0x2d3f88(0x1b8)},'suppliers':{'$first':_0x2d3f88(0x178)},'date':{'$first':_0x2d3f88(0x16e)},'warehouse_name':{'$first':_0x2d3f88(0x188)},'room':{'$addToSet':_0x2d3f88(0x21c)},'product':{'$push':_0x2d3f88(0x1da)},'note':{'$first':_0x2d3f88(0x159)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x2d3f88(0x12f)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2d3f88(0x112)},'suppliers_docs':{'$first':_0x2d3f88(0x216)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x2d3f88(0x1a0)},'isle':{'$addToSet':_0x2d3f88(0x1c9)},'type':{'$addToSet':_0x2d3f88(0x17e)},'floorlevel':{'$addToSet':_0x2d3f88(0x135)},'finalize':{'$first':_0x2d3f88(0x209)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x525320[0x0][_0x2d3f88(0x1d7)]==_0x2d3f88(0x1e2)){var _0x3fa2aa=users['English'];console[_0x2d3f88(0x1e5)](_0x3fa2aa);}else{if(_0x525320[0x0][_0x2d3f88(0x1d7)]=='Hindi')var _0x3fa2aa=users['Hindi'];else{if(_0x525320[0x0][_0x2d3f88(0x1d7)]=='German')var _0x3fa2aa=users['German'];else{if(_0x525320[0x0]['language']==_0x2d3f88(0x1f2))var _0x3fa2aa=users[_0x2d3f88(0x1f2)];else{if(_0x525320[0x0]['language']=='French')var _0x3fa2aa=users['French'];else{if(_0x525320[0x0][_0x2d3f88(0x1d7)]=='Portuguese\x20(BR)')var _0x3fa2aa=users[_0x2d3f88(0x161)];else{if(_0x525320[0x0]['language']==_0x2d3f88(0x1d5))var _0x3fa2aa=users[_0x2d3f88(0x1d5)];else{if(_0x525320[0x0][_0x2d3f88(0x1d7)]=='Arabic\x20(ae)')var _0x3fa2aa=users['Arabic'];}}}}}}}_0x953e57['render'](_0x2d3f88(0x217),{'success':_0x1e7488[_0x2d3f88(0x1f0)](_0x2d3f88(0x1ff)),'errors':_0x1e7488[_0x2d3f88(0x1f0)]('errors'),'purchases':_0x27b59b,'role':_0x234a3e,'profile':_0x52811d,'master_shop':_0x525320,'language':_0x3fa2aa});}catch(_0x2c5834){console[_0x2d3f88(0x1e5)]('table\x20page',_0x2c5834),_0x953e57[_0x2d3f88(0x10a)](0xc8)['json']({'message':_0x2c5834['message']});}});function BayBinSelected(_0x2e2cb5,_0x8f99f6){var _0x5a679d=a0_0x23264f,_0x1c8f61=[],_0x2bb3d0=[],_0x1eb14d=[],_0x56b0e8=[],_0x194267=[],_0x1f70a5=[];let _0x29d28c=[];if(_0x2e2cb5==_0x5a679d(0x1f8))switch(_0x8f99f6){case _0x5a679d(0x20a):_0x1c8f61=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x2bb3d0=[0x1,0x2],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=[_0x5a679d(0x215),_0x5a679d(0x132)],_0x194267=['D'],_0x1f70a5=['A'];break;case _0x5a679d(0x1a5):_0x1c8f61=[0x6,0x5,0x4,0x3,0x2,0x1],_0x2bb3d0=[0x1,0x2],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=[_0x5a679d(0x215),_0x5a679d(0x132)],_0x194267=['D'],_0x1f70a5=['B'];break;case _0x5a679d(0x174):_0x1c8f61=[0x0],_0x2bb3d0=[0x0],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=['Floor'],_0x194267=['D'],_0x1f70a5=['S'];break;case'Receiving\x20Area':_0x1c8f61=[0x0],_0x2bb3d0=[0x0],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1eb14d=[_0x5a679d(0x132)],_0x194267=['D'],_0x1f70a5=['R'];break;}else{if(_0x2e2cb5==_0x5a679d(0x15f))switch(_0x8f99f6){case _0x5a679d(0x20a):_0x1c8f61=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x2bb3d0=['B','F'],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=[_0x5a679d(0x215),_0x5a679d(0x132)],_0x194267=['C'],_0x1f70a5=['A'];break;case'Rack\x20B':_0x1c8f61=[0x5,0x4,0x3,0x2,0x1],_0x2bb3d0=['F','B','S'],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=[_0x5a679d(0x215),_0x5a679d(0x132)],_0x194267=['C'],_0x1f70a5=['B'];break;case _0x5a679d(0x119):_0x1c8f61=[0x1,0x2,0x3,0x4,0x5],_0x2bb3d0=['B','F','S'],_0x56b0e8=[0x5,0x4,0x3,0x2,0x1],_0x1eb14d=[_0x5a679d(0x215),_0x5a679d(0x132)],_0x194267=['C'],_0x1f70a5=['C'];break;case _0x5a679d(0x169):_0x1c8f61=[0x5,0x4,0x3,0x2,0x1],_0x2bb3d0=['F','B','S'],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=[_0x5a679d(0x215),_0x5a679d(0x132)],_0x194267=['C'],_0x1f70a5=['D'];break;case _0x5a679d(0x1b9):_0x1c8f61=[0x4,0x3,0x2,0x1],_0x2bb3d0=[0x1,0x2],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=[_0x5a679d(0x215),'Floor'],_0x194267=['C'],_0x1f70a5=['E'];break;case'Rack\x20F':_0x1c8f61=[0x1,0x2,0x3],_0x2bb3d0=[0x1,0x2],_0x56b0e8=[0x1,0x2,0x3,0x4,0x5],_0x1eb14d=['Level'],_0x194267=['C'],_0x1f70a5=['F'];break;}}return{'levels':_0x1c8f61,'Isle':_0x2bb3d0,'rack':_0x56b0e8,'type':_0x1eb14d,'storage':_0x194267,'rak':_0x1f70a5};}async function getRandom8DigitNumber(){var _0x5dbb2c=a0_0x23264f;const _0xf50c1e=0x989680,_0x3d4fae=0x5f5e0ff,_0xc5e504=Math[_0x5dbb2c(0x146)](Math[_0x5dbb2c(0x160)]()*(_0x3d4fae-_0xf50c1e+0x1))+_0xf50c1e;var _0x463267;const _0x45796d=await purchases[_0x5dbb2c(0x21a)]({'invoice':_0x5dbb2c(0x18f)+_0xc5e504});return _0x45796d&&_0x45796d[_0x5dbb2c(0x12a)]>0x0?_0x463267=_0x5dbb2c(0x18f)+_0xc5e504:_0x463267=_0x5dbb2c(0x18f)+_0xc5e504,_0x463267;}function a0_0x954e(){var _0x52c4ef=['gmail','then','</tr>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','maxStocks','12vWEsYC','prod_secondunit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Room_name','prod_unit','bay','$product_details.type','primary_code','length','<h5>','15300390JcdwlL','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product_details.product_code','$due_amount','concat','$product_details._id','Floor','return_qty','prod_name','$product.floorlevel','$product_details.primary_code','prod_Qty','prod_pallet','primary_code_hide','rak','$secondary_code','$product_details.level','email','getMonth','bin','Receiving\x20Area','RoomAssign','English','$name','return_purchase','$product_code','floor','$maxStocks','4168674OnvmZK','purchase_invoice','add_purchases','map','getDate','isle','expiry_date','production_date','$product_details.rack','$maxProdPerUnit','foreach\x20newproduct','catch','$product_details.product_name','Arabic\x20(ae)','product','stock_data','currency','$note','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','password','findById','suppliers_docs','COLD\x20STORAGE','random','Portuguese','Portuguese\x20(BR)','add_purchases\x20error','json','delivery_date','save','errors','paid_amount','Rack\x20D','all_purchases_barcode','$product.quantity','params','error','$date','$_id','prod_level','$product_details','/barcode_scanner','batch_code','Shelves','German','$product_details.maxProducts','max_product_unit','$suppliers','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','True','maxperunit','body','$alertquantity','$product.type','13181fwnohC','delivery_code','<html><head><title></title>','suppliers','../public/language/languages.json','storage','Raw\x20Materials','Sales\x20Update\x20successfully','edit_purchases_view','$warehouse_name','message','aggregate','filter','/view/return_purchase/:id','</span>','/view/add_purchases','INC-','MaxStocks_data','deliverycode','pallet','user','secondary_code','/upload/','exports','$unit','\x20Order\x20Number\x20:\x20','Email\x20sent\x20successfully','warehouse_name','</h5>','$product_details.bay','logo','padStart','Paid\x20For\x20Purchase','$product.bay','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<span\x20style=\x22float:\x20right;\x22>','Logo.png','sendMail','Rack\x20B','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','getFullYear','master','An\x20error\x20occurred\x20while\x20saving\x20data.','/all_purchases/view/','Purchase\x20Return\x20Mail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','render','secondary_code_hide','</head><body>','product_stock','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stocks','<tr>','currency_placement','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','post','$invoice','Rack\x20E','quantity','</tbody>','$category','/view/:id','$primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','types','type','secondary_unit','product_list','143648TIohuR','POnumber','$product_details.bin','<h2>\x20','$product.bin','$secondary_unit','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','date','toString','due_amount','<strong>\x20Regards\x20</strong>','prod_primunit','/../public','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.secondary_code','Chinese','return_data','language','<!DOCTYPE\x20html>','slice','$product','standard_unit','name','get','$batch_code','JO_number','add\x20post','product_code_hide','English\x20(US)','stock_quantity','545245fBtsxg','log','level','1146645IGPzAn','$return_data','warehouse','host','product_details','createTransport','prod_invoice','</div>','RMSEmail','flash','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Spanish','Return\x20Goods','$product_details.product_stock','alertQTY','</td>','suppliers_data','DRY\x20STORAGE','user_id','prod_qty','French','port','product_code','\x20</h2>','success','site_title','finalize','product_cat','763206ZkCSdA','amount','product_name','floorlevel','prod_isle','rack','$finalize','Rack\x20A','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','8tCyILb','/all_purchases/view','</thead>','../models/all_models','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','room','ejs','/CheckingWarehouse','Level','$suppliers_docs','all_purchases','/preview/:id','$product_details.storage','findOne','\x20<>\x20','$product.room_name','/barcode/:id','purchase_quantity','\x20Order\x20Date\x20:\x20','staff','1304TBWltp','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Arabic','<h5\x20style=\x22text-align:\x20left;\x22>','Purchase\x20Mail','status','Hindi','room_name','role','$brand','<div>','prod_cat','Ambient','$expiry_date','redirect','find','Purchase\x20Return','invoice','prod_code','express','Rack\x20C','/view/add_purchases/:id','$product_details.floorlevel','forEach'];a0_0x954e=function(){return _0x52c4ef;};return a0_0x954e();}router[a0_0x23264f(0x1dd)]('/view/add_purchases',auth,async(_0x36bc8d,_0x3d59a)=>{var _0x27db67=a0_0x23264f;try{const {username:_0x159d0b,email:_0x2fc2ae,role:_0x501825}=_0x36bc8d[_0x27db67(0x193)],_0x45836f=_0x36bc8d[_0x27db67(0x193)],_0x3cd1d5=await profile[_0x27db67(0x21a)]({'email':_0x45836f[_0x27db67(0x13d)]}),_0x4959d2=await master_shop[_0x27db67(0x114)](),_0xd33f37=await staff[_0x27db67(0x21a)]({'email':_0x45836f[_0x27db67(0x13d)]}),_0x5c491=await suppliers[_0x27db67(0x114)]({});let _0x147c7b;if(_0x45836f['role']==_0x27db67(0x220)){const _0xad053c=await staff['findOne']({'email':_0x45836f[_0x27db67(0x13d)]});_0x147c7b=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0xad053c['warehouse'],'warehouse_category':_0x27db67(0x185),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x27db67(0x143),'name':{'$first':_0x27db67(0x143)}}}]);}else _0x147c7b=await warehouse[_0x27db67(0x18a)]([{'$match':{'status':_0x27db67(0x15a),'warehouse_category':_0x27db67(0x185),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x27db67(0x143),'name':{'$first':_0x27db67(0x143)}}}]);const _0x52b42e=await product[_0x27db67(0x114)]({}),_0x5ca1e5=await warehouse[_0x27db67(0x114)]({'status':_0x27db67(0x15a)}),_0x50ae2d=await purchases['find']({}),_0x59cbba=_0x50ae2d['length']+0x1,_0x410db5=_0x27db67(0x18f)+_0x59cbba[_0x27db67(0x1ce)]()[_0x27db67(0x19e)](0x5,'0');var _0x50955e=[_0x27db67(0x111),_0x27db67(0x210)];if(_0x4959d2[0x0][_0x27db67(0x1d7)]==_0x27db67(0x1e2))var _0x394fcd=users[_0x27db67(0x142)];else{if(_0x4959d2[0x0][_0x27db67(0x1d7)]=='Hindi')var _0x394fcd=users[_0x27db67(0x10b)];else{if(_0x4959d2[0x0][_0x27db67(0x1d7)]==_0x27db67(0x175))var _0x394fcd=users[_0x27db67(0x175)];else{if(_0x4959d2[0x0]['language']==_0x27db67(0x1f2))var _0x394fcd=users[_0x27db67(0x1f2)];else{if(_0x4959d2[0x0][_0x27db67(0x1d7)]==_0x27db67(0x1fb))var _0x394fcd=users[_0x27db67(0x1fb)];else{if(_0x4959d2[0x0][_0x27db67(0x1d7)]==_0x27db67(0x162))var _0x394fcd=users[_0x27db67(0x161)];else{if(_0x4959d2[0x0]['language']==_0x27db67(0x1d5))var _0x394fcd=users['Chinese'];else{if(_0x4959d2[0x0]['language']=='Arabic\x20(ae)')var _0x394fcd=users[_0x27db67(0x107)];}}}}}}}const _0x12aa79=getRandom8DigitNumber();_0x12aa79[_0x27db67(0x11e)](_0x537106=>{var _0x14a808=_0x27db67;_0x3d59a[_0x14a808(0x1ad)](_0x14a808(0x14a),{'success':_0x36bc8d[_0x14a808(0x1f0)](_0x14a808(0x1ff)),'errors':_0x36bc8d[_0x14a808(0x1f0)](_0x14a808(0x167)),'role':_0x45836f,'profile':_0x3cd1d5,'suppliers':_0x5c491,'warehouse':_0x147c7b,'product':_0x52b42e,'invoice':_0x537106,'master_shop':_0x4959d2,'language':_0x394fcd,'find_data':_0x5ca1e5,'rooms_data':_0x50955e});})[_0x27db67(0x153)](_0x3b9b1a=>{var _0x279aa7=_0x27db67;_0x36bc8d[_0x279aa7(0x1f0)](_0x279aa7(0x167),_0x279aa7(0x1f1)),_0x3d59a[_0x279aa7(0x113)]('/all_purchases/view');});}catch(_0x5f4bbb){console[_0x27db67(0x1e5)](_0x5f4bbb);}}),router[a0_0x23264f(0x1dd)](a0_0x23264f(0x11a),auth,async(_0x2768bd,_0x3fad51)=>{var _0x19e001=a0_0x23264f;try{const _0x3e6931=_0x2768bd[_0x19e001(0x16c)]['id'];console['log'](_0x3e6931);const _0x1cf76d=await master_shop['find']();console[_0x19e001(0x1e5)](_0x19e001(0x1a8),_0x1cf76d);const _0x2d69b3=await product[_0x19e001(0x21a)]({'name':_0x3e6931});console[_0x19e001(0x1e5)]('product',_0x2d69b3),_0x3fad51[_0x19e001(0x10a)](0xc8)[_0x19e001(0x164)]({'product_data':_0x2d69b3,'master':_0x1cf76d});}catch(_0x36191f){console[_0x19e001(0x1e5)](_0x19e001(0x163),_0x36191f);}}),router[a0_0x23264f(0x1b7)](a0_0x23264f(0x18e),auth,async(_0x391e47,_0x4ef756)=>{var _0x281cf7=a0_0x23264f;try{const {invoice:_0x44326e,date:_0x73f48,warehouse_name:_0x1ceb22,prod_name:_0xeab22a,prod_code:_0x118731,prod_qty:_0x491074,prod_unit:_0x2aecb0,prod_secondunit:_0x3af655,prod_level:_0x1ba695,prod_isle:_0x157940,prod_pallet:_0x5bd8ce,note:_0x3b9a6c,expiry_date:_0x39d3b5,batch_code:_0x5e2fec,payable:_0x11d7c7,due_amount:_0x8bec03,Room_name:_0x407b0b,primary_code:_0x4fcaf3,secondary_code:_0x231ed2,MaxStocks_data:_0xa9a7d0,PO_number:_0x2f52a5,SCRN:_0x38e319,JO_number:_0x545ae0}=_0x391e47['body'];if(typeof _0xeab22a=='string')var _0x569234=[_0x391e47[_0x281cf7(0x17c)]['prod_name']],_0x269801=[_0x391e47[_0x281cf7(0x17c)]['prod_code']],_0x55d7f2=[_0x391e47['body']['prod_Qty']],_0x175123=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x1d1)]],_0x29aaa4=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x123)]],_0x125ef6=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x170)]],_0x26b6dc=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x129)]],_0x479045=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x194)]],_0x153d5f=[_0x391e47['body']['MaxStocks_data']],_0x1b2e1b=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x173)]],_0x45dfd4=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x14e)]],_0x39819d=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x177)]],_0xc5d780=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x1f5)]],_0x4171a0=[_0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x14f)]],_0x22c8ff=[_0x391e47['body'][_0x281cf7(0x110)]],_0x4de409=[_0x391e47['body']['RoomAssign']],_0x223258=[_0x391e47['body'][_0x281cf7(0x191)]],_0x1e793c=[_0x391e47['body'][_0x281cf7(0x1ed)]];else var _0x569234=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x134)]],_0x269801=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x117)]],_0x55d7f2=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x137)]],_0x175123=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x1d1)]],_0x29aaa4=[..._0x391e47[_0x281cf7(0x17c)]['prod_secondunit']],_0x125ef6=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x170)]],_0x26b6dc=[..._0x391e47[_0x281cf7(0x17c)]['primary_code']],_0x479045=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x194)]],_0x153d5f=[..._0x391e47[_0x281cf7(0x17c)]['MaxStocks_data']],_0x1b2e1b=[..._0x391e47[_0x281cf7(0x17c)]['batch_code']],_0x45dfd4=[..._0x391e47[_0x281cf7(0x17c)]['expiry_date']],_0x39819d=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x177)]],_0xc5d780=[..._0x391e47['body']['alertQTY']],_0x4171a0=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x14f)]],_0x22c8ff=[..._0x391e47[_0x281cf7(0x17c)]['prod_cat']],_0x4de409=[..._0x391e47['body'][_0x281cf7(0x141)]],_0x223258=[..._0x391e47['body']['deliverycode']],_0x1e793c=[..._0x391e47[_0x281cf7(0x17c)][_0x281cf7(0x1ed)]];const _0x4fa3a9=_0x569234['map'](_0x4f2bdc=>{return _0x4f2bdc={'product_name':_0x4f2bdc};});_0x269801['forEach']((_0x3d8514,_0x5d030b)=>{_0x4fa3a9[_0x5d030b]['product_code']=_0x3d8514;}),_0x55d7f2[_0x281cf7(0x11c)]((_0x2f3cd6,_0x2e9950)=>{var _0x3a2686=_0x281cf7;_0x4fa3a9[_0x2e9950][_0x3a2686(0x1ba)]=_0x2f3cd6;}),_0x175123[_0x281cf7(0x11c)]((_0x20ad8f,_0x5def53)=>{var _0x42dadc=_0x281cf7;_0x4fa3a9[_0x5def53][_0x42dadc(0x1db)]=_0x20ad8f;}),_0x29aaa4['forEach']((_0x35c39d,_0x2850b4)=>{var _0x4582bf=_0x281cf7;_0x4fa3a9[_0x2850b4][_0x4582bf(0x1c3)]=_0x35c39d;}),_0x125ef6[_0x281cf7(0x11c)]((_0x416762,_0x153714)=>{var _0x320b76=_0x281cf7;_0x4de409[_0x320b76(0x11c)]((_0x2690a2,_0x360aed)=>{var _0x33f5a7=_0x320b76;if(_0x2690a2==_0x33f5a7(0x140)&&_0x153714==_0x360aed){console[_0x33f5a7(0x1e5)](_0x2690a2+'\x20<\x20wew\x20>\x20'+_0x153714+_0x33f5a7(0x21b)+_0x360aed+'\x20<>\x20'+_0x416762);var _0x89388f=_0x416762['slice'](0x3);_0x4fa3a9[_0x153714]['storage']=_0x416762[0x0],_0x4fa3a9[_0x153714][_0x33f5a7(0x208)]=_0x416762[0x1],_0x4fa3a9[_0x153714][_0x33f5a7(0x127)]=0x0,_0x4fa3a9[_0x153714][_0x33f5a7(0x13f)]=0x0,_0x4fa3a9[_0x153714][_0x33f5a7(0x1c2)]=_0x33f5a7(0x132),_0x4fa3a9[_0x153714][_0x33f5a7(0x206)]=_0x89388f;}else{if(_0x2690a2==_0x33f5a7(0x174)&&_0x153714==_0x360aed){var _0x89388f=_0x416762[_0x33f5a7(0x1d9)](0x3);_0x4fa3a9[_0x153714]['storage']=_0x416762[0x0],_0x4fa3a9[_0x153714]['rack']=_0x416762[0x1],_0x4fa3a9[_0x153714][_0x33f5a7(0x127)]=0x0,_0x4fa3a9[_0x153714]['bin']=0x0,_0x4fa3a9[_0x153714]['type']=_0x33f5a7(0x132),_0x4fa3a9[_0x153714][_0x33f5a7(0x206)]=_0x416762[0x5];}else{if(_0x153714==_0x360aed){var _0x354e65;if(_0x416762[0x4]=='L')_0x354e65='Level';else _0x416762[0x4]=='F'&&(_0x354e65=_0x33f5a7(0x132));_0x4fa3a9[_0x153714][_0x33f5a7(0x184)]=_0x416762[0x0],_0x4fa3a9[_0x153714][_0x33f5a7(0x208)]=_0x416762[0x1],_0x4fa3a9[_0x153714][_0x33f5a7(0x127)]=_0x416762[0x2],_0x4fa3a9[_0x153714][_0x33f5a7(0x13f)]=_0x416762[0x3],_0x4fa3a9[_0x153714][_0x33f5a7(0x1c2)]=_0x354e65,_0x4fa3a9[_0x153714][_0x33f5a7(0x206)]=_0x416762[0x5];}}}});}),_0x26b6dc[_0x281cf7(0x11c)]((_0x1d380f,_0x5f00da)=>{var _0x50dcc5=_0x281cf7;_0x4fa3a9[_0x5f00da][_0x50dcc5(0x129)]=_0x1d380f;}),_0x479045[_0x281cf7(0x11c)]((_0x46021a,_0x322456)=>{var _0x5e7a1c=_0x281cf7;_0x4fa3a9[_0x322456][_0x5e7a1c(0x194)]=_0x46021a;}),_0x153d5f[_0x281cf7(0x11c)]((_0x210dad,_0x427421)=>{var _0x6c3b46=_0x281cf7;_0x4fa3a9[_0x427421][_0x6c3b46(0x121)]=_0x210dad;}),_0x1b2e1b[_0x281cf7(0x11c)]((_0x1f5158,_0x2895c6)=>{_0x4fa3a9[_0x2895c6]['batch_code']=_0x1f5158;}),_0x45dfd4[_0x281cf7(0x11c)]((_0xc2e82e,_0x42d070)=>{_0x4fa3a9[_0x42d070]['expiry_date']=_0xc2e82e;}),_0x39819d['forEach']((_0x3829e8,_0x27e494)=>{_0x4fa3a9[_0x27e494]['maxperunit']=_0x3829e8;}),_0xc5d780[_0x281cf7(0x11c)]((_0x4de86d,_0x3f929b)=>{_0x4fa3a9[_0x3f929b]['alertQTY']=_0x4de86d;}),_0x4171a0[_0x281cf7(0x11c)]((_0x1c0c88,_0x3db317)=>{var _0x156da4=_0x281cf7;_0x4fa3a9[_0x3db317][_0x156da4(0x14f)]=_0x1c0c88;}),_0x22c8ff['forEach']((_0x3bdb96,_0x110fbf)=>{_0x4fa3a9[_0x110fbf]['product_cat']=_0x3bdb96;}),_0x4de409['forEach']((_0x1b0ef6,_0x4d6ed5)=>{_0x4fa3a9[_0x4d6ed5]['room_name']=_0x1b0ef6;}),_0x223258[_0x281cf7(0x11c)]((_0x4ca643,_0x4e3e2c)=>{_0x4fa3a9[_0x4e3e2c]['delivery_code']=_0x4ca643;}),_0x1e793c['forEach']((_0x28d684,_0x455452)=>{var _0x36a86b=_0x281cf7;_0x4fa3a9[_0x455452][_0x36a86b(0x116)]=_0x28d684;});const _0xcabc17=_0x4de409[_0x281cf7(0x14b)](_0x1f0558=>{return _0x1f0558={'room_name':_0x1f0558};}),_0x1f7402=_0x4fa3a9['filter'](_0x9ef819=>_0x9ef819[_0x281cf7(0x1ba)]!=='0'&&_0x9ef819[_0x281cf7(0x1ba)]!==''),_0x369ebc=new purchases({'invoice':_0x44326e,'suppliers':_0x391e47['body'][_0x281cf7(0x182)],'date':_0x73f48,'warehouse_name':_0x1ceb22,'product':_0x1f7402,'note':_0x3b9a6c,'due_amount':_0x8bec03,'POnumber':_0x2f52a5,'SCRN':_0x38e319,'JO_number':_0x545ae0,'roomList':_0xcabc17}),_0x2f0cc4=await _0x369ebc[_0x281cf7(0x166)](),_0x376ec7=await purchases[_0x281cf7(0x21a)]({'invoice':_0x44326e}),_0xf35ab5=_0x376ec7[_0x281cf7(0x156)]['map'](async _0x3f0be8=>{var _0x629b55=_0x281cf7,_0x260118=await warehouse[_0x629b55(0x21a)]({'name':_0x1ceb22,'room':_0x3f0be8[_0x629b55(0x10c)]}),_0x397cfb=0x0;return _0x260118[_0x629b55(0x1eb)]['forEach'](_0x38b1bd=>{var _0x4a469f=_0x629b55;_0x38b1bd['product_name']==_0x3f0be8[_0x4a469f(0x205)]&&_0x38b1bd[_0x4a469f(0x206)]==_0x3f0be8[_0x4a469f(0x206)]&&_0x38b1bd[_0x4a469f(0x1c2)]==_0x3f0be8[_0x4a469f(0x1c2)]&&_0x38b1bd[_0x4a469f(0x13f)]==_0x3f0be8[_0x4a469f(0x13f)]&&_0x38b1bd[_0x4a469f(0x127)]==_0x3f0be8[_0x4a469f(0x127)]&&_0x38b1bd[_0x4a469f(0x208)]==_0x3f0be8['rack']&&_0x38b1bd[_0x4a469f(0x184)]==_0x3f0be8[_0x4a469f(0x184)]&&_0x38b1bd[_0x4a469f(0x14e)]==_0x3f0be8[_0x4a469f(0x14e)]&&_0x38b1bd['batch_code']==_0x3f0be8['batch_code']&&_0x38b1bd['production_date']==_0x3f0be8[_0x4a469f(0x14f)]&&_0x38b1bd['invoice']==_0x376ec7[_0x4a469f(0x116)]&&(_0x38b1bd[_0x4a469f(0x1b0)]+=_0x3f0be8[_0x4a469f(0x1ba)],_0x397cfb++);}),_0x397cfb===0x0&&_0x260118['product_details']['push']({'product_name':_0x3f0be8[_0x629b55(0x205)],'product_stock':_0x3f0be8[_0x629b55(0x1ba)],'primary_code':_0x3f0be8[_0x629b55(0x129)],'secondary_code':_0x3f0be8[_0x629b55(0x194)],'product_code':_0x3f0be8[_0x629b55(0x1fd)],'storage':_0x3f0be8['storage'],'rack':_0x3f0be8['rack'],'bay':_0x3f0be8[_0x629b55(0x127)],'bin':_0x3f0be8[_0x629b55(0x13f)],'type':_0x3f0be8[_0x629b55(0x1c2)],'floorlevel':_0x3f0be8[_0x629b55(0x206)],'maxProducts':_0x3f0be8[_0x629b55(0x121)],'unit':_0x3f0be8[_0x629b55(0x1db)],'secondary_unit':_0x3f0be8['secondary_unit'],'expiry_date':_0x3f0be8['expiry_date'],'maxPerUnit':_0x3f0be8[_0x629b55(0x17b)],'batch_code':_0x3f0be8['batch_code'],'alertQTY':_0x3f0be8['alertQTY'],'production_date':_0x3f0be8[_0x629b55(0x14f)],'product_cat':_0x3f0be8[_0x629b55(0x202)],'invoice':_0x3f0be8[_0x629b55(0x116)]}),_0x260118;});Promise['all'](_0xf35ab5)['then'](async _0x12d53f=>{var _0x287383=_0x281cf7;try{for(const _0x375a53 of _0x12d53f){await _0x375a53['save']();}const _0x3e2781=await master_shop[_0x287383(0x114)](),_0x3ca602=await email_settings[_0x287383(0x21a)](),_0x472ec1=await supervisor_settings['find']();var _0x2aacf7=_0x376ec7['product'],_0x49a7f4='',_0x3efa40;for(_0x3efa40 in _0x2aacf7){_0x49a7f4+=_0x287383(0x1b4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2aacf7[_0x3efa40][_0x287383(0x205)]+_0x287383(0x1f6)+_0x287383(0x1a1)+_0x2aacf7[_0x3efa40]['product_code']+_0x287383(0x1f6)+_0x287383(0x1a1)+_0x2aacf7[_0x3efa40]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2aacf7[_0x3efa40][_0x287383(0x1db)]+_0x287383(0x1f6)+_0x287383(0x1a1)+_0x2aacf7[_0x3efa40][_0x287383(0x1c3)]+'</td>'+_0x287383(0x1a1)+_0x376ec7[_0x287383(0x19a)]+'</td>'+_0x287383(0x1a1)+_0x2aacf7[_0x3efa40][_0x287383(0x10c)]+_0x287383(0x1f6)+_0x287383(0x1a1)+_0x2aacf7[_0x3efa40][_0x287383(0x184)]+_0x2aacf7[_0x3efa40][_0x287383(0x208)]+_0x2aacf7[_0x3efa40][_0x287383(0x127)]+_0x2aacf7[_0x3efa40]['bin']+_0x2aacf7[_0x3efa40][_0x287383(0x1c2)][0x0]+_0x2aacf7[_0x3efa40][_0x287383(0x206)]+_0x287383(0x1f6),'</tr>';}let _0x29aa24=nodemailer[_0x287383(0x1ec)]({'host':_0x3ca602[_0x287383(0x1ea)],'port':Number(_0x3ca602[_0x287383(0x1fc)]),'secure':![],'auth':{'user':_0x3ca602[_0x287383(0x13d)],'pass':_0x3ca602[_0x287383(0x15c)]}}),_0x129bf0={'from':_0x3ca602[_0x287383(0x13d)],'to':_0x472ec1[0x0][_0x287383(0x1ef)],'subject':_0x287383(0x109),'attachments':[{'filename':_0x287383(0x1a3),'path':__dirname+_0x287383(0x1d2)+'/upload/'+_0x3e2781[0x0]['image'],'cid':_0x287383(0x19d)}],'html':_0x287383(0x1d8)+_0x287383(0x181)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x287383(0x10f)+_0x287383(0x1c0)+_0x287383(0x1ee)+_0x287383(0x10f)+_0x287383(0x1c8)+_0x3e2781[0x0][_0x287383(0x200)]+_0x287383(0x1fe)+_0x287383(0x1ee)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x287383(0x10f)+_0x287383(0x108)+'\x20Order\x20Number\x20:\x20'+_0x376ec7[_0x287383(0x116)]+'\x20'+_0x287383(0x1a2)+_0x287383(0x21f)+_0x376ec7[_0x287383(0x1cd)]+'\x20'+_0x287383(0x18d)+'</h5>'+_0x287383(0x1ee)+_0x287383(0x106)+_0x287383(0x1ac)+_0x287383(0x1b4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x287383(0x1cc)+_0x287383(0x124)+_0x287383(0x179)+_0x287383(0x1a6)+_0x287383(0x211)+_0x287383(0x1b6)+_0x287383(0x11f)+_0x287383(0x20e)+_0x287383(0x1d3)+'\x20'+_0x49a7f4+'\x20'+_0x287383(0x1bb)+'</table>'+_0x287383(0x10f)+_0x287383(0x1d0)+'<h5>'+_0x3e2781[0x0][_0x287383(0x200)]+_0x287383(0x19b)+_0x287383(0x1ee)+_0x287383(0x1ee)+'</body></html>'};_0x29aa24[_0x287383(0x1a4)](_0x129bf0,function(_0x306dc2,_0x34e915){var _0x3e4a89=_0x287383;_0x306dc2?(console[_0x3e4a89(0x1e5)](_0x306dc2),console[_0x3e4a89(0x1e5)]('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x391e47['flash'](_0x287383(0x1ff),'Purchase\x20data\x20added\x20successfully'),_0x4ef756[_0x287383(0x113)](_0x287383(0x1aa));}catch(_0x3db996){console[_0x287383(0x16d)](_0x3db996),_0x4ef756['status'](0x1f4)[_0x287383(0x164)]({'error':_0x287383(0x1a9)});}})[_0x281cf7(0x153)](_0x380694=>{var _0x2ef8dd=_0x281cf7;console[_0x2ef8dd(0x16d)](_0x380694),_0x4ef756[_0x2ef8dd(0x10a)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x4e1298){console[_0x281cf7(0x1e5)](_0x4e1298);}}),router['get'](a0_0x23264f(0x218),auth,async(_0xf72534,_0x1f454c)=>{var _0x3d5611=a0_0x23264f;try{const {username:_0x57190a,email:_0x24b743,role:_0x1e01b5}=_0xf72534[_0x3d5611(0x193)],_0x21353e=_0xf72534['user'],_0x1e20e1=await profile[_0x3d5611(0x21a)]({'email':_0x21353e['email']}),_0x3620c0=await master_shop[_0x3d5611(0x114)](),_0x3ad35f=_0xf72534[_0x3d5611(0x16c)]['id'],_0x1a0390=await purchases['findById'](_0x3ad35f),_0xb0b7ca=await warehouse[_0x3d5611(0x18a)]([{'$match':{'name':_0x1a0390[_0x3d5611(0x19a)],'room':_0x1a0390[_0x3d5611(0x212)]}},{'$unwind':_0x3d5611(0x171)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3d5611(0x154)},'product_stock':{'$first':_0x3d5611(0x1f4)},'bay':{'$first':_0x3d5611(0x19c)},'bin':{'$first':_0x3d5611(0x1c7)},'type':{'$first':_0x3d5611(0x128)},'floorlevel':{'$first':_0x3d5611(0x11b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3d5611(0x1d4)},'product_code':{'$first':_0x3d5611(0x12e)},'storage':{'$first':_0x3d5611(0x219)},'rack':{'$first':_0x3d5611(0x150)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x756da1=await customer[_0x3d5611(0x114)]({});let _0x1aa9b3;if(_0x21353e[_0x3d5611(0x10d)]==_0x3d5611(0x220)){const _0xf99bbd=await staff[_0x3d5611(0x21a)]({'email':_0x21353e[_0x3d5611(0x13d)]});_0x1aa9b3=await warehouse[_0x3d5611(0x18a)]([{'$match':{'status':_0x3d5611(0x15a),'name':_0xf99bbd[_0x3d5611(0x1e9)]}},{'$group':{'_id':'$name','name':{'$first':_0x3d5611(0x143)}}}]);}else _0x1aa9b3=await warehouse[_0x3d5611(0x18a)]([{'$match':{'status':_0x3d5611(0x15a)}},{'$group':{'_id':_0x3d5611(0x143),'name':{'$first':_0x3d5611(0x143)}}}]);const _0x5b81dc=await product[_0x3d5611(0x114)]({}),_0x51c0fe=await suppliers[_0x3d5611(0x114)]({}),_0x4800a0=BayBinSelected(_0x1a0390[_0x3d5611(0x19a)],_0x1a0390[_0x3d5611(0x212)]);if(_0x3620c0[0x0]['language']==_0x3d5611(0x1e2)){var _0x236163=users[_0x3d5611(0x142)];console[_0x3d5611(0x1e5)](_0x236163);}else{if(_0x3620c0[0x0][_0x3d5611(0x1d7)]==_0x3d5611(0x10b))var _0x236163=users[_0x3d5611(0x10b)];else{if(_0x3620c0[0x0][_0x3d5611(0x1d7)]==_0x3d5611(0x175))var _0x236163=users[_0x3d5611(0x175)];else{if(_0x3620c0[0x0]['language']=='Spanish')var _0x236163=users['Spanish'];else{if(_0x3620c0[0x0][_0x3d5611(0x1d7)]==_0x3d5611(0x1fb))var _0x236163=users[_0x3d5611(0x1fb)];else{if(_0x3620c0[0x0][_0x3d5611(0x1d7)]==_0x3d5611(0x162))var _0x236163=users[_0x3d5611(0x161)];else{if(_0x3620c0[0x0][_0x3d5611(0x1d7)]==_0x3d5611(0x1d5))var _0x236163=users[_0x3d5611(0x1d5)];else{if(_0x3620c0[0x0][_0x3d5611(0x1d7)]==_0x3d5611(0x155))var _0x236163=users[_0x3d5611(0x107)];}}}}}}}_0x1f454c[_0x3d5611(0x1ad)](_0x3d5611(0x187),{'success':_0xf72534[_0x3d5611(0x1f0)]('success'),'errors':_0xf72534[_0x3d5611(0x1f0)]('errors'),'role':_0x21353e,'profile':_0x1e20e1,'customer':_0x756da1,'warehouse':_0x1aa9b3,'product':_0xb0b7ca,'user':_0x1a0390,'master_shop':_0x3620c0,'unit':_0x5b81dc,'language':_0x236163,'suppliers':_0x51c0fe,'dataSelected':_0x4800a0});}catch(_0x35c799){console['log'](_0x35c799);}}),router[a0_0x23264f(0x1b7)](a0_0x23264f(0x218),auth,async(_0x3f5b9c,_0x13334b)=>{var _0xc6f64a=a0_0x23264f;try{const _0x20ac62=_0x3f5b9c[_0xc6f64a(0x16c)]['id'],{invoice:_0x153395,warehouse_name:_0x4cd521,Room_name:_0x51b62d}=_0x3f5b9c[_0xc6f64a(0x17c)],_0x357d54=await warehouse[_0xc6f64a(0x21a)]({'name':_0x4cd521,'room':_0x51b62d}),_0x40a0e6=await purchases[_0xc6f64a(0x21a)]({'invoice':_0x153395});_0x40a0e6[_0xc6f64a(0x156)][_0xc6f64a(0x11c)](_0x5ea275=>{var _0x3dbf43=_0xc6f64a,_0x1d35b4=0x0;const _0x496455=_0x357d54['product_details'][_0x3dbf43(0x14b)](_0x4ffa61=>{var _0x201bde=_0x3dbf43;_0x4ffa61[_0x201bde(0x205)]==_0x5ea275[_0x201bde(0x205)]&&_0x4ffa61[_0x201bde(0x206)]==_0x5ea275[_0x201bde(0x206)]&&_0x4ffa61[_0x201bde(0x1c2)]==_0x5ea275[_0x201bde(0x1c2)]&&_0x4ffa61[_0x201bde(0x13f)]==_0x5ea275['bin']&&_0x4ffa61['bay']==_0x5ea275[_0x201bde(0x127)]&&_0x4ffa61['rack']==_0x5ea275[_0x201bde(0x208)]&&_0x4ffa61[_0x201bde(0x184)]==_0x5ea275[_0x201bde(0x184)]&&_0x4ffa61[_0x201bde(0x14e)]==_0x5ea275[_0x201bde(0x14e)]&&_0x4ffa61['batch_code']==_0x5ea275['batch_code']&&_0x4ffa61[_0x201bde(0x14f)]==_0x5ea275[_0x201bde(0x14f)]&&_0x4ffa61[_0x201bde(0x165)]==_0x5ea275['delivery_date']&&_0x4ffa61['delivery_code']==_0x5ea275[_0x201bde(0x180)]&&(_0x4ffa61[_0x201bde(0x1b0)]=parseInt(_0x4ffa61['product_stock'])+parseInt(_0x5ea275[_0x201bde(0x1ba)]),_0x1d35b4++);});_0x1d35b4=='0'&&(_0x357d54[_0x3dbf43(0x1eb)]=_0x357d54[_0x3dbf43(0x1eb)]['concat']({'product_name':_0x5ea275[_0x3dbf43(0x205)],'product_stock':_0x5ea275['quantity'],'primary_code':_0x5ea275[_0x3dbf43(0x129)],'secondary_code':_0x5ea275[_0x3dbf43(0x194)],'product_code':_0x5ea275[_0x3dbf43(0x1fd)],'storage':_0x5ea275[_0x3dbf43(0x184)],'rack':_0x5ea275['rack'],'bay':_0x5ea275['bay'],'bin':_0x5ea275['bin'],'type':_0x5ea275[_0x3dbf43(0x1c2)],'floorlevel':_0x5ea275['floorlevel'],'maxProducts':_0x5ea275[_0x3dbf43(0x121)],'unit':_0x5ea275[_0x3dbf43(0x1db)],'secondary_unit':_0x5ea275[_0x3dbf43(0x1c3)],'expiry_date':_0x5ea275[_0x3dbf43(0x14e)],'maxPerUnit':_0x5ea275[_0x3dbf43(0x17b)],'batch_code':_0x5ea275[_0x3dbf43(0x173)],'alertQTY':_0x5ea275['alertQTY'],'production_date':_0x5ea275[_0x3dbf43(0x14f)],'delivery_date':_0x5ea275[_0x3dbf43(0x165)],'delivery_code':_0x5ea275[_0x3dbf43(0x180)]}));}),await _0x357d54[_0xc6f64a(0x166)](),_0x40a0e6[_0xc6f64a(0x201)]=_0xc6f64a(0x17a);const _0x26a475=await _0x40a0e6[_0xc6f64a(0x166)]();_0x3f5b9c[_0xc6f64a(0x1f0)](_0xc6f64a(0x1ff),_0xc6f64a(0x186)),_0x13334b['redirect'](_0xc6f64a(0x20d));}catch(_0x4a18f6){console['log'](_0x4a18f6);}}),router['get'](a0_0x23264f(0x1bd),auth,async(_0x39610e,_0x60b225)=>{var _0x3f6906=a0_0x23264f;try{const {username:_0x3ff879,email:_0xf20707,role:_0x1f64e7}=_0x39610e['user'],_0x3461a8=_0x39610e['user'],_0x2c67dd=await profile['findOne']({'email':_0x3461a8[_0x3f6906(0x13d)]}),_0x27c229=await master_shop['find'](),_0x30325a=_0x39610e[_0x3f6906(0x16c)]['id'],_0x128cba=await purchases['findById'](_0x30325a),_0x5091cc=await suppliers['find']({});let _0x5cf7a2;if(_0x3461a8[_0x3f6906(0x10d)]==_0x3f6906(0x220)){const _0x4a5c21=await staff[_0x3f6906(0x21a)]({'email':_0x3461a8[_0x3f6906(0x13d)]});_0x5cf7a2=await warehouse['find']({'status':_0x3f6906(0x15a),'name':_0x4a5c21[_0x3f6906(0x1e9)],'warehouse_category':_0x3f6906(0x185)});}else _0x5cf7a2=await warehouse[_0x3f6906(0x18a)]([{'$match':{'status':_0x3f6906(0x15a),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x3f6906(0x143)}}}]);const _0x5668bf=await product[_0x3f6906(0x114)]({}),_0x2c4fd4=BayBinSelected(_0x128cba[_0x3f6906(0x19a)],_0x128cba[_0x3f6906(0x212)]);let _0x523729=new Date(_0x128cba[_0x3f6906(0x14e)]),_0x20f58f=('0'+_0x523729['getDate']())[_0x3f6906(0x1d9)](-0x2),_0xb86424=('0'+(_0x523729[_0x3f6906(0x13e)]()+0x1))[_0x3f6906(0x1d9)](-0x2),_0x2705be=_0x523729[_0x3f6906(0x1a7)](),_0x250d10=_0x2705be+'-'+_0xb86424+'-'+_0x20f58f;if(_0x27c229[0x0][_0x3f6906(0x1d7)]==_0x3f6906(0x1e2)){var _0x329c7a=users[_0x3f6906(0x142)];console[_0x3f6906(0x1e5)](_0x329c7a);}else{if(_0x27c229[0x0]['language']=='Hindi')var _0x329c7a=users['Hindi'];else{if(_0x27c229[0x0][_0x3f6906(0x1d7)]=='German')var _0x329c7a=users[_0x3f6906(0x175)];else{if(_0x27c229[0x0][_0x3f6906(0x1d7)]==_0x3f6906(0x1f2))var _0x329c7a=users[_0x3f6906(0x1f2)];else{if(_0x27c229[0x0][_0x3f6906(0x1d7)]==_0x3f6906(0x1fb))var _0x329c7a=users[_0x3f6906(0x1fb)];else{if(_0x27c229[0x0]['language']==_0x3f6906(0x162))var _0x329c7a=users[_0x3f6906(0x161)];else{if(_0x27c229[0x0]['language']=='Chinese')var _0x329c7a=users['Chinese'];else{if(_0x27c229[0x0][_0x3f6906(0x1d7)]=='Arabic\x20(ae)')var _0x329c7a=users[_0x3f6906(0x107)];}}}}}}}_0x60b225[_0x3f6906(0x1ad)]('edit_purchases',{'success':_0x39610e['flash']('success'),'errors':_0x39610e[_0x3f6906(0x1f0)](_0x3f6906(0x167)),'role':_0x3461a8,'profile':_0x2c67dd,'purchases':_0x128cba,'suppliers':_0x5091cc,'warehouse':_0x5cf7a2,'product':_0x5668bf,'master_shop':_0x27c229,'language':_0x329c7a,'ed_fullDate':_0x250d10,'dataSelected':_0x2c4fd4});}catch(_0x38749d){console[_0x3f6906(0x1e5)](_0x38749d);}}),router[a0_0x23264f(0x1b7)]('/view/:id',auth,async(_0x28306b,_0x509807)=>{var _0x4781a3=a0_0x23264f;try{const _0x1d1e16=_0x28306b[_0x4781a3(0x16c)]['id'],_0x36b937=await purchases['findOne']({'_id':_0x28306b[_0x4781a3(0x16c)]['id']}),_0x4b27eb=await warehouse[_0x4781a3(0x21a)]({'name':_0x36b937[_0x4781a3(0x19a)],'room':_0x36b937['room']});_0x36b937[_0x4781a3(0x156)][_0x4781a3(0x11c)](_0x4ec57f=>{var _0x583ced=_0x4781a3;const _0x263444=_0x4b27eb[_0x583ced(0x1eb)]['map'](_0xb5fc0d=>{var _0x18d5de=_0x583ced;_0xb5fc0d['product_name']==_0x4ec57f[_0x18d5de(0x205)]&&_0xb5fc0d['floorlevel']==_0x4ec57f['floorlevel']&&_0xb5fc0d[_0x18d5de(0x1c2)]==_0x4ec57f[_0x18d5de(0x1c2)]&&_0xb5fc0d[_0x18d5de(0x13f)]==_0x4ec57f[_0x18d5de(0x13f)]&&_0xb5fc0d[_0x18d5de(0x127)]==_0x4ec57f[_0x18d5de(0x127)]&&_0xb5fc0d[_0x18d5de(0x208)]==_0x4ec57f[_0x18d5de(0x208)]&&_0xb5fc0d['storage']==_0x4ec57f[_0x18d5de(0x184)]&&(_0xb5fc0d[_0x18d5de(0x1b0)]=parseInt(_0xb5fc0d[_0x18d5de(0x1b0)])-parseInt(_0x4ec57f[_0x18d5de(0x1ba)]));});}),await _0x4b27eb['save']();const {invoice:_0x477ac9,suppliers:_0x47bce0,date:_0x1fe160,warehouse_name:_0x18f6e6,prod_name:_0x327ad6,prod_code:_0x23c30e,prod_qty:_0x239cd8,prod_unit:_0x5488d8,prod_secondunit:_0x5e9ed3,prod_level:_0xf413c7,prod_isle:_0xc1b505,prod_pallet:_0x355455,note:_0x40cbca,expiry_date:_0x6f298a,batch_code:_0x18a785,paid_amount:_0x17b20e,due_amount:_0x171195,Room_name:_0x54ff59,primary_code:_0x26a06c,secondary_code:_0x1a1f5c,PO_number:_0x526ada,JO_number:_0x2c2c6}=_0x28306b[_0x4781a3(0x17c)];if(typeof _0x327ad6=='string')var _0x3d20be=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x134)]],_0x68f5f6=[_0x28306b['body'][_0x4781a3(0x117)]],_0x5c24fd=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x1fa)]],_0xb9c42e=[_0x28306b[_0x4781a3(0x17c)]['prod_unit']],_0x18589c=[_0x28306b[_0x4781a3(0x17c)]['prod_secondunit']],_0x31b0ac=[_0x28306b['body']['prod_level']],_0x2a844f=[_0x28306b['body'][_0x4781a3(0x207)]],_0x56841f=[_0x28306b['body'][_0x4781a3(0x138)]],_0x188d8c=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x129)]],_0x5ab0c6=[_0x28306b['body']['secondary_code']],_0x3dda29=[_0x28306b['body'][_0x4781a3(0x190)]],_0x2d6edf=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x173)]],_0x3f499e=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x14e)]],_0x498624=[_0x28306b[_0x4781a3(0x17c)]['storage']],_0x4363f2=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x13a)]],_0x332494=[_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x1c2)]];else var _0x3d20be=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x134)]],_0x68f5f6=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x117)]],_0x5c24fd=[..._0x28306b['body'][_0x4781a3(0x1fa)]],_0xb9c42e=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x126)]],_0x18589c=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x123)]],_0x31b0ac=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x170)]],_0x2a844f=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x207)]],_0x56841f=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x138)]],_0x188d8c=[..._0x28306b['body'][_0x4781a3(0x129)]],_0x5ab0c6=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x194)]],_0x3dda29=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x190)]],_0x2d6edf=[..._0x28306b[_0x4781a3(0x17c)]['batch_code']],_0x3f499e=[..._0x28306b['body']['expiry_date']],_0x498624=[..._0x28306b[_0x4781a3(0x17c)]['storage']],_0x4363f2=[..._0x28306b['body'][_0x4781a3(0x13a)]],_0x332494=[..._0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x1c2)]];const _0x4cecb0=_0x3d20be[_0x4781a3(0x14b)](_0x1fa207=>{return _0x1fa207={'product_name':_0x1fa207};});_0x68f5f6['forEach']((_0x4c2954,_0x40afeb)=>{_0x4cecb0[_0x40afeb]['product_code']=_0x4c2954;}),_0x5c24fd[_0x4781a3(0x11c)]((_0x258007,_0x536799)=>{_0x4cecb0[_0x536799]['quantity']=_0x258007;}),_0xb9c42e[_0x4781a3(0x11c)]((_0xe4cbb9,_0x1df166)=>{var _0x378777=_0x4781a3;_0x4cecb0[_0x1df166][_0x378777(0x1db)]=_0xe4cbb9;}),_0x18589c[_0x4781a3(0x11c)]((_0x516797,_0x2dffad)=>{var _0x53096c=_0x4781a3;_0x4cecb0[_0x2dffad][_0x53096c(0x1c3)]=_0x516797;}),_0x31b0ac[_0x4781a3(0x11c)]((_0x3d7c30,_0x36a32e)=>{var _0x8a6eaa=_0x4781a3;_0x4cecb0[_0x36a32e][_0x8a6eaa(0x127)]=_0x3d7c30;}),_0x2a844f['forEach']((_0x1346cc,_0x4158ba)=>{_0x4cecb0[_0x4158ba]['bin']=_0x1346cc;}),_0x56841f['forEach']((_0xc433d9,_0x96c1d4)=>{var _0x33f22f=_0x4781a3;_0x4cecb0[_0x96c1d4][_0x33f22f(0x206)]=_0xc433d9;}),_0x188d8c['forEach']((_0x25322a,_0xa33bf2)=>{_0x4cecb0[_0xa33bf2]['primary_code']=_0x25322a;}),_0x5ab0c6[_0x4781a3(0x11c)]((_0xc2034a,_0x593ffc)=>{var _0x25730e=_0x4781a3;_0x4cecb0[_0x593ffc][_0x25730e(0x194)]=_0xc2034a;}),_0x3dda29[_0x4781a3(0x11c)]((_0x24d463,_0x497c13)=>{var _0x5c2e3e=_0x4781a3;_0x4cecb0[_0x497c13][_0x5c2e3e(0x121)]=_0x24d463;}),_0x2d6edf['forEach']((_0x14cd15,_0x4c3f49)=>{var _0x56e41e=_0x4781a3;_0x4cecb0[_0x4c3f49][_0x56e41e(0x173)]=_0x14cd15;}),_0x3f499e[_0x4781a3(0x11c)]((_0x3303eb,_0x4d0ae3)=>{_0x4cecb0[_0x4d0ae3]['expiry_date']=_0x3303eb;}),_0x332494['forEach']((_0x4146c1,_0x12ac06)=>{var _0x467635=_0x4781a3;_0x4cecb0[_0x12ac06][_0x467635(0x1c2)]=_0x4146c1;}),_0x498624['forEach']((_0x5738ce,_0x4cbda7)=>{var _0x513419=_0x4781a3;_0x4cecb0[_0x4cbda7][_0x513419(0x184)]=_0x5738ce;}),_0x4363f2['forEach']((_0x4d5b50,_0x374f94)=>{_0x4cecb0[_0x374f94]['rack']=_0x4d5b50;});const _0x1cca4b=_0x4cecb0[_0x4781a3(0x18b)](_0x33379f=>_0x33379f['quantity']!=='0'&&_0x33379f[_0x4781a3(0x1ba)]!=='');_0x36b937['invoice']=_0x477ac9,_0x36b937[_0x4781a3(0x182)]=_0x47bce0,_0x36b937['date']=_0x1fe160,_0x36b937[_0x4781a3(0x19a)]=_0x18f6e6,_0x36b937['product']=_0x1cca4b,_0x36b937['note']=_0x40cbca,_0x36b937['paid_amount']=_0x17b20e,_0x36b937[_0x4781a3(0x1cf)]=_0x171195,_0x36b937[_0x4781a3(0x212)]=_0x54ff59,_0x36b937[_0x4781a3(0x1c6)]=_0x526ada,_0x36b937[_0x4781a3(0x1df)]=_0x2c2c6;const _0x35a67e=await _0x36b937['save'](),_0x4ae09a=await warehouse[_0x4781a3(0x21a)]({'name':_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x19a)],'room':_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x125)]});_0x36b937[_0x4781a3(0x156)]['forEach'](_0x4f681e=>{var _0xc351d9=_0x4781a3,_0x2ab426=0x0;const _0x4c9ac4=_0x4ae09a[_0xc351d9(0x1eb)][_0xc351d9(0x14b)](_0x10ebe5=>{var _0x1cd954=_0xc351d9;_0x10ebe5['product_name']==_0x4f681e[_0x1cd954(0x205)]&&_0x10ebe5[_0x1cd954(0x206)]==_0x4f681e[_0x1cd954(0x206)]&&_0x10ebe5[_0x1cd954(0x1c2)]==_0x4f681e[_0x1cd954(0x1c2)]&&_0x10ebe5[_0x1cd954(0x13f)]==_0x4f681e[_0x1cd954(0x13f)]&&_0x10ebe5[_0x1cd954(0x127)]==_0x4f681e[_0x1cd954(0x127)]&&_0x10ebe5[_0x1cd954(0x208)]==_0x4f681e[_0x1cd954(0x208)]&&_0x10ebe5[_0x1cd954(0x184)]==_0x4f681e[_0x1cd954(0x184)]&&(_0x10ebe5[_0x1cd954(0x1b0)]=parseInt(_0x10ebe5[_0x1cd954(0x1b0)])+parseInt(_0x4f681e[_0x1cd954(0x1ba)]),_0x2ab426++);});_0x2ab426=='0'&&(_0x4ae09a[_0xc351d9(0x1eb)]=_0x4ae09a[_0xc351d9(0x1eb)][_0xc351d9(0x130)]({'product_name':_0x4f681e[_0xc351d9(0x205)],'product_stock':_0x4f681e['quantity'],'primary_code':_0x4f681e[_0xc351d9(0x129)],'secondary_code':_0x4f681e[_0xc351d9(0x194)],'product_code':_0x4f681e[_0xc351d9(0x1fd)],'storage':_0x4f681e[_0xc351d9(0x184)],'rack':_0x4f681e[_0xc351d9(0x208)],'bay':_0x4f681e['bay'],'bin':_0x4f681e[_0xc351d9(0x13f)],'type':_0x4f681e[_0xc351d9(0x1c2)],'floorlevel':_0x4f681e[_0xc351d9(0x206)],'maxProducts':_0x4f681e[_0xc351d9(0x121)],'unit':_0x4f681e[_0xc351d9(0x1db)],'secondary_unit':_0x4f681e[_0xc351d9(0x1c3)],'expiry_date':_0x4f681e[_0xc351d9(0x14e)]}));}),await _0x4ae09a['save']();const _0x3647ec=await s_payment_data['findOne']({'invoice':_0x28306b[_0x4781a3(0x17c)][_0x4781a3(0x116)]});if(_0x3647ec===null){}else console['log']('suppliers',_0x3647ec,_0x28306b['body'][_0x4781a3(0x116)]),_0x3647ec[_0x4781a3(0x182)]=_0x28306b[_0x4781a3(0x17c)]['suppliers'],await _0x3647ec['save']();_0x28306b[_0x4781a3(0x1f0)]('success','purchase\x20data\x20update\x20successfully'),_0x509807[_0x4781a3(0x113)](_0x4781a3(0x20d));}catch(_0x2b34e5){console[_0x4781a3(0x1e5)](_0x2b34e5);}}),router[a0_0x23264f(0x1b7)]('/give_payment/:id',auth,async(_0x36ff07,_0x30a980)=>{var _0x4bb27e=a0_0x23264f;try{const _0x5c9bcb=_0x36ff07[_0x4bb27e(0x16c)]['id'],{invoice:_0x2410a8,suppliers:_0x108ea6,payable:_0x2ee904,due_amount:_0x860187}=_0x36ff07[_0x4bb27e(0x17c)],_0x2c7781=await purchases['findById'](_0x5c9bcb);var _0x15ddaa=_0x2ee904-_0x860187;_0x2c7781['paid_amount']=parseFloat(_0x2c7781[_0x4bb27e(0x168)])+parseFloat(_0x860187),_0x2c7781[_0x4bb27e(0x1cf)]=_0x15ddaa;const _0x29790f=await _0x2c7781['save']();console[_0x4bb27e(0x1e5)](_0x29790f);const _0x4966e4=await s_payment_data[_0x4bb27e(0x21a)]({'invoice':_0x2410a8});_0x4966e4[_0x4bb27e(0x204)]=_0x15ddaa,await _0x4966e4[_0x4bb27e(0x166)]();let _0x4ce3f8=new Date(),_0xc49ac9=('0'+_0x4ce3f8[_0x4bb27e(0x14c)]())[_0x4bb27e(0x1d9)](-0x2),_0x14d090=('0'+(_0x4ce3f8[_0x4bb27e(0x13e)]()+0x1))['slice'](-0x2),_0x554dba=_0x4ce3f8['getFullYear'](),_0x707d24=_0x554dba+'-'+_0x14d090+'-'+_0xc49ac9;const _0x13ced6=new suppliers_payment({'invoice':_0x2410a8,'date':_0x554dba+'-'+_0x14d090+'-'+_0xc49ac9,'suppliers':_0x108ea6,'reason':_0x4bb27e(0x19f),'amount':_0x860187}),_0x101a79=await _0x13ced6[_0x4bb27e(0x166)]();_0x36ff07[_0x4bb27e(0x1f0)](_0x4bb27e(0x1ff),'payment\x20successfull'),_0x30a980[_0x4bb27e(0x113)](_0x4bb27e(0x20d));}catch(_0x164f9b){console['log'](_0x164f9b);}}),router['get']('/invoice/:id',auth,async(_0x42f11d,_0x3b1f6c)=>{var _0x5da1c1=a0_0x23264f;try{const {username:_0x432ab9,email:_0x8968fa,role:_0x242203}=_0x42f11d[_0x5da1c1(0x193)],_0xc9f768=_0x42f11d[_0x5da1c1(0x193)],_0x121472=await profile[_0x5da1c1(0x21a)]({'email':_0xc9f768[_0x5da1c1(0x13d)]}),_0x871033=await master_shop['find']();console[_0x5da1c1(0x1e5)](_0x5da1c1(0x1a8),_0x871033);const _0xa8a797=_0x42f11d[_0x5da1c1(0x16c)]['id'],_0x2e5c52=await purchases[_0x5da1c1(0x15d)](_0xa8a797);console[_0x5da1c1(0x1e5)](_0x2e5c52);const _0xf62a88=await suppliers[_0x5da1c1(0x21a)]({'name':_0x2e5c52['suppliers']});console[_0x5da1c1(0x1e5)](_0xf62a88);if(_0x871033[0x0][_0x5da1c1(0x1d7)]==_0x5da1c1(0x1e2)){var _0x416ae8=users['English'];console[_0x5da1c1(0x1e5)](_0x416ae8);}else{if(_0x871033[0x0][_0x5da1c1(0x1d7)]==_0x5da1c1(0x10b))var _0x416ae8=users[_0x5da1c1(0x10b)];else{if(_0x871033[0x0]['language']=='German')var _0x416ae8=users[_0x5da1c1(0x175)];else{if(_0x871033[0x0][_0x5da1c1(0x1d7)]==_0x5da1c1(0x1f2))var _0x416ae8=users[_0x5da1c1(0x1f2)];else{if(_0x871033[0x0][_0x5da1c1(0x1d7)]=='French')var _0x416ae8=users[_0x5da1c1(0x1fb)];else{if(_0x871033[0x0]['language']==_0x5da1c1(0x162))var _0x416ae8=users[_0x5da1c1(0x161)];else{if(_0x871033[0x0][_0x5da1c1(0x1d7)]==_0x5da1c1(0x1d5))var _0x416ae8=users[_0x5da1c1(0x1d5)];else{if(_0x871033[0x0][_0x5da1c1(0x1d7)]==_0x5da1c1(0x155))var _0x416ae8=users[_0x5da1c1(0x107)];}}}}}}}_0x3b1f6c[_0x5da1c1(0x1ad)](_0x5da1c1(0x149),{'success':_0x42f11d['flash'](_0x5da1c1(0x1ff)),'errors':_0x42f11d[_0x5da1c1(0x1f0)](_0x5da1c1(0x167)),'role':_0xc9f768,'profile':_0x121472,'master_shop':_0x871033,'supplier':_0xf62a88,'purchase':_0x2e5c52,'language':_0x416ae8});}catch(_0xfecead){console[_0x5da1c1(0x1e5)](_0xfecead);}}),router['get'](a0_0x23264f(0x18c),auth,async(_0x57105d,_0x19e45c)=>{var _0x4dcde0=a0_0x23264f;try{const {username:_0x2a2611,email:_0x2539dc,role:_0x22b567}=_0x57105d[_0x4dcde0(0x193)],_0x39483c=_0x57105d[_0x4dcde0(0x193)],_0x16b7c5=await profile[_0x4dcde0(0x21a)]({'email':_0x39483c[_0x4dcde0(0x13d)]}),_0x51713c=await master_shop[_0x4dcde0(0x114)]();console['log'](_0x4dcde0(0x1a8),_0x51713c);const _0x6530d7=_0x57105d[_0x4dcde0(0x16c)]['id'];console['log'](_0x6530d7);const _0xe9bc11=await purchases[_0x4dcde0(0x15d)](_0x6530d7);console[_0x4dcde0(0x1e5)](_0x4dcde0(0x1f9),_0xe9bc11);const _0xa9d51a=await product[_0x4dcde0(0x114)]({}),_0x24c77e=await warehouse[_0x4dcde0(0x18a)]([{'$match':{'name':_0xe9bc11[_0x4dcde0(0x19a)],'room':_0xe9bc11['room'],'warehouse_category':_0x4dcde0(0x185)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4dcde0(0x131),'name':{'$first':_0x4dcde0(0x154)},'product_stock':{'$first':_0x4dcde0(0x1f4)},'bay':{'$first':_0x4dcde0(0x19c)},'bin':{'$first':_0x4dcde0(0x1c7)},'type':{'$first':_0x4dcde0(0x128)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4dcde0(0x136)},'secondary_code':{'$first':_0x4dcde0(0x1d4)},'product_code':{'$first':_0x4dcde0(0x12e)},'storage':{'$first':_0x4dcde0(0x219)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse[_0x4dcde0(0x18a)]([{'$match':{'status':_0x4dcde0(0x15a),'name':_0x4dcde0(0x1f3),'warehouse_category':_0x4dcde0(0x185)}},{'$group':{'_id':_0x4dcde0(0x143),'name':{'$first':_0x4dcde0(0x143)}}},{'$sort':{'name':0x1}}]),console[_0x4dcde0(0x1e5)](_0x4dcde0(0x157),_0x24c77e);if(_0x51713c[0x0]['language']=='English\x20(US)'){var _0x5c2b50=users[_0x4dcde0(0x142)];console[_0x4dcde0(0x1e5)](_0x5c2b50);}else{if(_0x51713c[0x0][_0x4dcde0(0x1d7)]==_0x4dcde0(0x10b))var _0x5c2b50=users[_0x4dcde0(0x10b)];else{if(_0x51713c[0x0][_0x4dcde0(0x1d7)]==_0x4dcde0(0x175))var _0x5c2b50=users['German'];else{if(_0x51713c[0x0][_0x4dcde0(0x1d7)]==_0x4dcde0(0x1f2))var _0x5c2b50=users[_0x4dcde0(0x1f2)];else{if(_0x51713c[0x0][_0x4dcde0(0x1d7)]==_0x4dcde0(0x1fb))var _0x5c2b50=users[_0x4dcde0(0x1fb)];else{if(_0x51713c[0x0]['language']=='Portuguese\x20(BR)')var _0x5c2b50=users[_0x4dcde0(0x161)];else{if(_0x51713c[0x0]['language']=='Chinese')var _0x5c2b50=users[_0x4dcde0(0x1d5)];else{if(_0x51713c[0x0][_0x4dcde0(0x1d7)]==_0x4dcde0(0x155))var _0x5c2b50=users['Arabic'];}}}}}}}_0x19e45c[_0x4dcde0(0x1ad)](_0x4dcde0(0x144),{'success':_0x57105d['flash'](_0x4dcde0(0x1ff)),'errors':_0x57105d['flash'](_0x4dcde0(0x167)),'role':_0x39483c,'profile':_0x16b7c5,'user':_0xe9bc11,'stock':_0x24c77e,'master_shop':_0x51713c,'product':_0xa9d51a,'language':_0x5c2b50,'warehouse':warehouse_data});}catch(_0x12c5bd){console['log'](_0x12c5bd);}}),router[a0_0x23264f(0x1b7)](a0_0x23264f(0x18c),auth,async(_0x281dd8,_0x193295)=>{var _0x5eb055=a0_0x23264f;try{const {invoice:_0x1c4042,date:_0x5a3197,warehouse_name:_0x3b9813,Room_name:_0x26bdc8,product_name:_0x1ff1b8,purchase_quantity:_0x3df7c0,stocks:_0x3f1c5b,return_qty:_0x5153f2,note:_0x2eb620,level:_0xf8f39e,isle:_0x49ab5e,pallet:_0x2ef0e1,to_warehouse_name:_0x4fc5a8,to_Room_name:_0x265c1f}=_0x281dd8[_0x5eb055(0x17c)],_0x292656=await purchases['findOne']({'_id':_0x281dd8[_0x5eb055(0x16c)]['id']}),_0x5a96e2=await warehouse[_0x5eb055(0x21a)]({'name':_0x3b9813,'room':_0x26bdc8});if(typeof _0x1ff1b8=='string')var _0x3500a9=[_0x281dd8[_0x5eb055(0x17c)]['product_name']],_0x32183b=[_0x281dd8[_0x5eb055(0x17c)]['purchase_quantity']],_0x1aca93=[_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1b3)]],_0x129c0a=[_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x133)]],_0x2379c7=[_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1e6)]],_0x2554b4=[_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x14d)]],_0x5d2399=[_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x192)]],_0x20e4cb=[_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1c1)]],_0x41f760=[_0x281dd8['body'][_0x5eb055(0x1e1)]],_0x347fe1=[_0x281dd8['body'][_0x5eb055(0x139)]],_0x87c04f=[_0x281dd8[_0x5eb055(0x17c)]['secondary_code_hide']];else var _0x3500a9=[..._0x281dd8['body']['product_name']],_0x32183b=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x21e)]],_0x1aca93=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1b3)]],_0x129c0a=[..._0x281dd8['body'][_0x5eb055(0x133)]],_0x2379c7=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1e6)]],_0x2554b4=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x14d)]],_0x5d2399=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x192)]],_0x20e4cb=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1c1)]],_0x41f760=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1e1)]],_0x347fe1=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x139)]],_0x87c04f=[..._0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x1ae)]];const _0x12e508=_0x3500a9[_0x5eb055(0x14b)](_0x41acd0=>{return _0x41acd0={'product_name':_0x41acd0};});_0x32183b['forEach']((_0x14451c,_0x40d3f1)=>{var _0x2ff86a=_0x5eb055;_0x12e508[_0x40d3f1][_0x2ff86a(0x21e)]=_0x14451c;}),_0x1aca93[_0x5eb055(0x11c)]((_0x49f0ad,_0x1bf96a)=>{var _0x49343f=_0x5eb055;_0x12e508[_0x1bf96a][_0x49343f(0x1e3)]=_0x49f0ad;}),_0x129c0a[_0x5eb055(0x11c)]((_0x3d7ecb,_0x4e4bd9)=>{var _0x5bb4e7=_0x5eb055;_0x12e508[_0x4e4bd9][_0x5bb4e7(0x133)]=_0x3d7ecb;}),_0x2379c7[_0x5eb055(0x11c)]((_0x30532c,_0x8b9bb5)=>{_0x12e508[_0x8b9bb5]['bay']=_0x30532c;}),_0x2554b4[_0x5eb055(0x11c)]((_0x14f76a,_0x5e25da)=>{var _0x404a94=_0x5eb055;_0x12e508[_0x5e25da][_0x404a94(0x13f)]=_0x14f76a;}),_0x5d2399[_0x5eb055(0x11c)]((_0x5e767e,_0x956f39)=>{_0x12e508[_0x956f39]['floorlevel']=_0x5e767e;}),_0x20e4cb[_0x5eb055(0x11c)]((_0x54ccdd,_0x500ed0)=>{var _0x41387c=_0x5eb055;_0x12e508[_0x500ed0][_0x41387c(0x1c2)]=_0x54ccdd;}),_0x41f760[_0x5eb055(0x11c)]((_0x1cf2ed,_0x51153e)=>{var _0x3f9435=_0x5eb055;_0x12e508[_0x51153e][_0x3f9435(0x1fd)]=_0x1cf2ed;}),_0x347fe1[_0x5eb055(0x11c)]((_0x3c6d6a,_0x1500e9)=>{var _0x492b96=_0x5eb055;_0x12e508[_0x1500e9][_0x492b96(0x129)]=_0x3c6d6a;}),_0x87c04f[_0x5eb055(0x11c)]((_0x2f847a,_0x2d30bd)=>{_0x12e508[_0x2d30bd]['secondary_code']=_0x2f847a;}),_0x292656[_0x5eb055(0x156)][_0x5eb055(0x11c)](_0x16329d=>{var _0x45b73e=_0x5eb055;const _0x203be7=_0x5a96e2[_0x45b73e(0x1eb)]['map'](_0x33796e=>{var _0x472eeb=_0x45b73e;_0x33796e[_0x472eeb(0x205)]==_0x16329d['product_name']&&_0x33796e[_0x472eeb(0x206)]==_0x16329d[_0x472eeb(0x206)]&&_0x33796e[_0x472eeb(0x1c2)]==_0x16329d[_0x472eeb(0x1c2)]&&_0x33796e['bin']==_0x16329d[_0x472eeb(0x13f)]&&_0x33796e[_0x472eeb(0x127)]==_0x16329d[_0x472eeb(0x127)]&&_0x33796e[_0x472eeb(0x208)]==_0x16329d['rack']&&_0x33796e[_0x472eeb(0x184)]==_0x16329d[_0x472eeb(0x184)]&&(console[_0x472eeb(0x1e5)](parseInt(_0x33796e['product_stock'])+_0x472eeb(0x21b)+parseInt(_0x16329d[_0x472eeb(0x1ba)])),_0x33796e[_0x472eeb(0x1b0)]=parseInt(_0x33796e['product_stock'])+parseInt(_0x16329d[_0x472eeb(0x1ba)]));});}),await _0x5a96e2['save']();const _0x1cb925=_0x12e508[_0x5eb055(0x18b)](_0x38c797=>_0x38c797[_0x5eb055(0x133)]!=='0'&&_0x38c797[_0x5eb055(0x133)]!=='');var _0x58d9b2=0x0;_0x1cb925[_0x5eb055(0x11c)](_0xea5e39=>{var _0x428945=_0x5eb055;console[_0x428945(0x1e5)](_0x428945(0x152),_0xea5e39),(parseInt(_0xea5e39[_0x428945(0x21e)])<parseInt(_0xea5e39['return_qty'])||parseInt(_0xea5e39[_0x428945(0x1e3)])<parseInt(_0xea5e39[_0x428945(0x133)]))&&_0x58d9b2++;});if(_0x58d9b2!=0x0)return _0x281dd8[_0x5eb055(0x1f0)](_0x5eb055(0x167),_0x5eb055(0x120)),_0x193295[_0x5eb055(0x113)]('back');const _0x550d0c=new purchases_return({'invoice':_0x1c4042,'suppliers':_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x182)],'date':_0x5a3197,'warehouse_name':_0x3b9813,'return_product':_0x1cb925,'note':_0x2eb620,'room':_0x26bdc8,'to_warehouse_name':_0x4fc5a8,'to_room':_0x265c1f}),_0x58ef46=await _0x550d0c['save']();console[_0x5eb055(0x1e5)](_0x550d0c);const _0x4c8bc1=await purchases_return['findOne']({'invoice':_0x1c4042}),_0x264811=await warehouse[_0x5eb055(0x21a)]({'name':_0x4fc5a8,'room':_0x265c1f});_0x4c8bc1['return_product'][_0x5eb055(0x11c)](_0x561f89=>{var _0xb7f198=_0x5eb055,_0x5b600f=0x0;const _0x595b5f=_0x264811['product_details'][_0xb7f198(0x14b)](_0x35fefa=>{var _0x5a006d=_0xb7f198;_0x35fefa[_0x5a006d(0x205)]==_0x561f89[_0x5a006d(0x205)]&&_0x35fefa['floorlevel']==_0x561f89['floorlevel']&&_0x35fefa[_0x5a006d(0x1c2)]==_0x561f89[_0x5a006d(0x1c2)]&&_0x35fefa[_0x5a006d(0x13f)]==_0x561f89[_0x5a006d(0x13f)]&&_0x35fefa[_0x5a006d(0x127)]==_0x561f89[_0x5a006d(0x127)]&&(_0x35fefa['product_stock']=parseInt(_0x35fefa[_0x5a006d(0x1b0)])-parseInt(_0x561f89[_0x5a006d(0x133)]),_0x5b600f++);});_0x5b600f=='0'&&(_0x264811[_0xb7f198(0x1eb)]=_0x264811['product_details'][_0xb7f198(0x130)]({'product_name':_0x561f89[_0xb7f198(0x205)],'product_stock':_0x561f89['return_qty'],'primary_code':_0x561f89[_0xb7f198(0x129)],'secondary_code':_0x561f89[_0xb7f198(0x194)],'product_code':_0x561f89['product_code'],'storage':_0x561f89[_0xb7f198(0x184)],'rack':_0x561f89[_0xb7f198(0x208)],'bay':_0x561f89['bay'],'bin':_0x561f89[_0xb7f198(0x13f)],'type':_0x561f89[_0xb7f198(0x1c2)],'floorlevel':_0x561f89[_0xb7f198(0x206)],'maxProducts':_0x561f89[_0xb7f198(0x121)],'unit':_0x561f89[_0xb7f198(0x1db)],'secondary_unit':_0x561f89['secondary_unit'],'expiry_date':_0x561f89[_0xb7f198(0x14e)]}));}),await _0x264811['save']();const _0x5f1adc=await purchases[_0x5eb055(0x21a)]({'invoice':_0x1c4042});_0x5f1adc[_0x5eb055(0x1d6)]=_0x5eb055(0x17a);const _0x3f939b=await _0x5f1adc[_0x5eb055(0x166)](),_0x2efbaf=new s_payment_data({'invoice':_0x1c4042,'suppliers':_0x281dd8[_0x5eb055(0x17c)][_0x5eb055(0x182)],'reason':_0x5eb055(0x115)});await _0x2efbaf[_0x5eb055(0x166)]();const _0x47f805=await master_shop[_0x5eb055(0x114)]();console['log'](_0x5eb055(0x1e0),_0x47f805[0x0][_0x5eb055(0x1b1)]);const _0x3bdb1d=await email_settings[_0x5eb055(0x21a)](),_0x46e75b=await suppliers['findOne']({'name':_0x281dd8['body']['suppliers']});console[_0x5eb055(0x1e5)](_0x5eb055(0x1f7),_0x46e75b);_0x47f805[0x0][_0x5eb055(0x1b5)]==0x1?(right_currency=_0x47f805[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x47f805[0x0][_0x5eb055(0x158)]);var _0x23d8d7=_0x3500a9,_0x2c2f7b=_0x129c0a,_0x117736='',_0x56d497;for(_0x56d497 in _0x23d8d7){_0x117736+=_0x5eb055(0x1b4)+_0x5eb055(0x1a1)+_0x23d8d7[_0x56d497]+_0x5eb055(0x1f6)+_0x5eb055(0x1a1)+_0x2c2f7b[_0x56d497]+_0x5eb055(0x1f6)+_0x5eb055(0x11f);}console[_0x5eb055(0x1e5)](_0x5eb055(0x1c4),_0x117736);let _0x271284=nodemailer[_0x5eb055(0x1ec)]({'service':_0x5eb055(0x11d),'auth':{'user':_0x3bdb1d[_0x5eb055(0x13d)],'pass':_0x3bdb1d['password']}}),_0x31648f={'from':_0x3bdb1d['email'],'to':_0x46e75b[_0x5eb055(0x13d)],'subject':_0x5eb055(0x1ab),'attachments':[{'filename':_0x5eb055(0x1a3),'path':__dirname+'/../public'+_0x5eb055(0x195)+_0x47f805[0x0][_0x5eb055(0x1b1)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5eb055(0x181)+_0x5eb055(0x1af)+'<div>'+_0x5eb055(0x20b)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x5eb055(0x10f)+_0x5eb055(0x1c8)+_0x47f805[0x0][_0x5eb055(0x200)]+_0x5eb055(0x1fe)+_0x5eb055(0x1ee)+_0x5eb055(0x1ee)+'<hr\x20class=\x22my-3\x22>'+_0x5eb055(0x10f)+_0x5eb055(0x108)+_0x5eb055(0x198)+_0x1c4042+'\x20'+_0x5eb055(0x1a2)+_0x5eb055(0x21f)+_0x5a3197+'\x20'+_0x5eb055(0x18d)+_0x5eb055(0x19b)+_0x5eb055(0x1ee)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5eb055(0x1ac)+_0x5eb055(0x1b4)+_0x5eb055(0x1bf)+_0x5eb055(0x1b2)+_0x5eb055(0x12d)+_0x5eb055(0x15b)+_0x5eb055(0x11f)+_0x5eb055(0x20e)+_0x5eb055(0x1d3)+'\x20'+_0x117736+'\x20'+_0x5eb055(0x1bb)+'</table>'+_0x5eb055(0x10f)+_0x5eb055(0x1d0)+_0x5eb055(0x12b)+_0x47f805[0x0][_0x5eb055(0x200)]+_0x5eb055(0x19b)+_0x5eb055(0x1ee)+'</div>'+'</body></html>'};_0x271284[_0x5eb055(0x1a4)](_0x31648f,function(_0x1884a1,_0x1ca3ec){var _0x1222c1=_0x5eb055;_0x1884a1?(console[_0x1222c1(0x1e5)](_0x1884a1),console[_0x1222c1(0x1e5)]('Error\x20Occurs')):console[_0x1222c1(0x1e5)](_0x1222c1(0x199));}),_0x281dd8[_0x5eb055(0x1f0)]('success','purchases\x20item\x20return\x20successfull'),_0x193295['redirect'](_0x5eb055(0x20d));}catch(_0x418a82){console['log'](_0x418a82),_0x193295[_0x5eb055(0x10a)](0xc8)[_0x5eb055(0x164)]({'message':_0x418a82[_0x5eb055(0x189)]});}}),router[a0_0x23264f(0x1dd)](a0_0x23264f(0x21d),auth,async(_0x211923,_0x44b750)=>{var _0x403c5d=a0_0x23264f;try{const {username:_0x3bdf0e,email:_0x53ea4c,role:_0x1de983}=_0x211923[_0x403c5d(0x193)],_0x3a23e3=_0x211923[_0x403c5d(0x193)],_0x5798d5=await profile[_0x403c5d(0x21a)]({'email':_0x3a23e3[_0x403c5d(0x13d)]}),_0x532312=await master_shop['find'](),_0x51b4cc=_0x211923[_0x403c5d(0x16c)]['id'],_0x19ddf1=await purchases[_0x403c5d(0x15d)](_0x51b4cc);if(_0x532312[0x0]['language']==_0x403c5d(0x1e2))var _0x154228=users[_0x403c5d(0x142)];else{if(_0x532312[0x0][_0x403c5d(0x1d7)]=='Hindi')var _0x154228=users[_0x403c5d(0x10b)];else{if(_0x532312[0x0][_0x403c5d(0x1d7)]==_0x403c5d(0x175))var _0x154228=users[_0x403c5d(0x175)];else{if(_0x532312[0x0][_0x403c5d(0x1d7)]==_0x403c5d(0x1f2))var _0x154228=users[_0x403c5d(0x1f2)];else{if(_0x532312[0x0]['language']==_0x403c5d(0x1fb))var _0x154228=users['French'];else{if(_0x532312[0x0][_0x403c5d(0x1d7)]==_0x403c5d(0x162))var _0x154228=users[_0x403c5d(0x161)];else{if(_0x532312[0x0][_0x403c5d(0x1d7)]==_0x403c5d(0x1d5))var _0x154228=users[_0x403c5d(0x1d5)];else{if(_0x532312[0x0]['language']==_0x403c5d(0x155))var _0x154228=users[_0x403c5d(0x107)];}}}}}}}_0x44b750['render'](_0x403c5d(0x16a),{'success':_0x211923[_0x403c5d(0x1f0)](_0x403c5d(0x1ff)),'errors':_0x211923[_0x403c5d(0x1f0)](_0x403c5d(0x167)),'role':_0x3a23e3,'profile':_0x5798d5,'alldata':_0x19ddf1,'master_shop':_0x532312,'language':_0x154228}),console[_0x403c5d(0x1e5)](alldata);}catch(_0x5357ef){console[_0x403c5d(0x1e5)](_0x5357ef);}}),router['post'](a0_0x23264f(0x172),async(_0x29a3ca,_0x4be10f)=>{var _0x4902f0=a0_0x23264f;const {product_code:_0x4075df}=_0x29a3ca['body'];var _0x517962;const _0x521cc3=await product[_0x4902f0(0x18a)]([{'$match':{'primary_code':_0x4075df,'product_category':_0x4902f0(0x185)}},{'$group':{'_id':_0x4902f0(0x16f),'name':{'$first':'$name'},'category':{'$first':_0x4902f0(0x1bc)},'brand':{'$first':_0x4902f0(0x10e)},'unit':{'$first':_0x4902f0(0x197)},'alertquantity':{'$first':_0x4902f0(0x17d)},'product_code':{'$first':_0x4902f0(0x145)},'primary_code':{'$first':_0x4902f0(0x1be)},'secondary_code':{'$first':_0x4902f0(0x13b)},'maxStocks':{'$first':_0x4902f0(0x147)},'maxProdPerUnit':{'$first':_0x4902f0(0x151)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x4902f0(0x1ca)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x494c31=await product['aggregate']([{'$match':{'secondary_code':_0x4075df,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4902f0(0x16f),'name':{'$first':_0x4902f0(0x143)},'category':{'$first':'$category'},'brand':{'$first':_0x4902f0(0x10e)},'unit':{'$first':_0x4902f0(0x197)},'alertquantity':{'$first':_0x4902f0(0x17d)},'product_code':{'$first':_0x4902f0(0x145)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x4902f0(0x147)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x4902f0(0x1ca)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x521cc3[_0x4902f0(0x12a)]>0x0)_0x517962=_0x521cc3;else _0x494c31[_0x4902f0(0x12a)]>0x0&&(_0x517962=_0x494c31);_0x4be10f['json'](_0x517962);}),router['post'](a0_0x23264f(0x214),async(_0x1620c2,_0x5711f9)=>{var _0x2c761b=a0_0x23264f;const {primaryCode:_0x1ef01b,secondaryCode:_0x45c49e,productCode:_0x230471,bay:_0x23c6eb,bin:_0x29a41f,types:_0x2d0ddc,pallet:_0x588993,warehouses:_0x5ad7ec,room:_0x1612b2}=_0x1620c2[_0x2c761b(0x17c)];console[_0x2c761b(0x1e5)](_0x1620c2[_0x2c761b(0x17c)]);try{const _0x5dfcec=await warehouse[_0x2c761b(0x18a)]([{'$match':{'name':_0x5ad7ec,'room':_0x1612b2}},{'$unwind':_0x2c761b(0x171)},{'$match':{'product_details.bay':_0x23c6eb,'product_details.bin':_0x29a41f,'product_details.type':_0x2d0ddc}},{'$group':{'_id':_0x2c761b(0x131),'name':{'$first':_0x2c761b(0x154)},'product_stock':{'$first':_0x2c761b(0x1f4)},'level':{'$first':_0x2c761b(0x13c)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x2c761b(0x176)}}}]);_0x5711f9[_0x2c761b(0x10a)](0xc8)['json'](_0x5dfcec);}catch(_0x48f3ec){_0x5711f9[_0x2c761b(0x10a)](0x194)[_0x2c761b(0x164)]({'message':_0x48f3ec[_0x2c761b(0x189)]});}}),module[a0_0x23264f(0x196)]=router;