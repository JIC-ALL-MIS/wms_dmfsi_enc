var a0_0x504112=a0_0x5458;(function(_0x2af04f,_0x4586b7){var _0x2d9ae5=a0_0x5458,_0x541271=_0x2af04f();while(!![]){try{var _0x34a4d7=-parseInt(_0x2d9ae5(0x296))/0x1*(-parseInt(_0x2d9ae5(0x194))/0x2)+parseInt(_0x2d9ae5(0x197))/0x3+-parseInt(_0x2d9ae5(0x24a))/0x4+-parseInt(_0x2d9ae5(0x2a8))/0x5+-parseInt(_0x2d9ae5(0x1c6))/0x6+-parseInt(_0x2d9ae5(0x218))/0x7*(parseInt(_0x2d9ae5(0x21e))/0x8)+parseInt(_0x2d9ae5(0x285))/0x9*(parseInt(_0x2d9ae5(0x295))/0xa);if(_0x34a4d7===_0x4586b7)break;else _0x541271['push'](_0x541271['shift']());}catch(_0x494c33){_0x541271['push'](_0x541271['shift']());}}}(a0_0x5f2b,0x97fea));const express=require(a0_0x504112(0x19e)),app=express(),router=express[a0_0x504112(0x25c)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x504112(0x1c3)),auth=require(a0_0x504112(0x204)),nodemailer=require(a0_0x504112(0x1f4));var ejs=require(a0_0x504112(0x2ac));const path=require(a0_0x504112(0x1e0)),users=require('../public/language/languages.json');function a0_0x5f2b(){var _0x51676f=['\x20<>\x20','aggregate','INC-','../models/all_models','user','Purchase\x20Return\x20Mail','797454xdnaVp','$primary_code','German','purchases\x20item\x20return\x20successfull','then','$product_code','$product_details.floorlevel','product_list','delivery_date','True','$batch_code','warehouse','/view/add_purchases','\x20Order\x20Date\x20:\x20','language','all_purchases_barcode','due_amount','$product_details.product_name','string','<html><head><title></title>','padStart','staff','add_purchases\x20error','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','params','secondary_code_hide','path','/view/return_purchase/:id','secondary_code','types','/all_purchases/view/','<!DOCTYPE\x20html>','product_code_hide','/preview/:id','return_product','$secondary_unit','all_purchases','catch','$due_amount','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','</td>','$product_details.rack','/../public','prod_name','Purchase\x20Return','nodemailer','sendMail','type','bin','/all_purchases/view','product_name','DRY\x20STORAGE','prod_cat','Error\x20Occurs','$expiry_date','status','forEach','<h5\x20style=\x22text-align:\x20left;\x22>','Sales\x20Update\x20successfully','Level','</div>','../middleware/auth','</table>','Purchase\x20Mail','primary_code_hide','Enabled','$maxStocks','maxStocks','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','$product_details.product_stock','invoice','rak','<hr\x20class=\x22my-3\x22>','max_product_unit','Raw\x20Materials','actual_qty','</span>','$category','actual_uom','$product_details.level','7XKVqMi','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','findOne','prod_level','gmail','An\x20error\x20occurred.','2113480dswwfT','$warehouse_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','payment\x20successfull','/CheckingWarehouse','json','body','message','product','$product','prod_pallet','role','MaxStocks_data','<span\x20style=\x22float:\x20right;\x22>','port','suppliers','batch_code','table\x20page','</body></html>','Return\x20Goods','$product.floorlevel','$product.quantity','Hindi','filter','prod_secondunit','abs','bay','$paid_amount','/upload/','here','product_cat','prod_isle','<tbody\x20style=\x22text-align:\x20center;\x22>','save','random','stock_quantity','user_id','expiry_date','$return_data','$product_details.isle','deliverycode','warehouse_name','stock_data','return_data','1541800vtKFFD','Floor','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product.bay','add\x20post','purchase\x20data\x20update\x20successfully','\x20Order\x20Number\x20:\x20','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Spanish','quantity','JO_number','$product.bin','prod_unit','Portuguese','getDate','$finalize','Receiving\x20Area','Router','slice','Arabic','/view/:id','site_title','logo','delivery_code','redirect','secondary_unit','getFullYear','$product_details.bin','/barcode/:id','currency','purchase_quantity','stocks','\x20</h2>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','createTransport','Purchase\x20data\x20added\x20successfully','master','note','return_qty','production_date','$product_details._id','exports','$product_details.storage','English\x20(US)','/view','RMSEmail','$brand','product_stock','Portuguese\x20(BR)','Enclosed','foreach\x20newproduct','prod_qty','$_id','alertQTY','rack','getMonth','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product.type','18qphMDx','email','image','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Rack\x20E','log','length','$note','<tr>','maxperunit','password','POnumber','success','$product_details.type','product_code','7872440PjZXgv','46MfjQSf','host','findById','<h2>\x20','prod_code','$product_details.bay','$product_details.expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','name','Paid\x20For\x20Purchase','isle','$maxProdPerUnit','/invoice/:id','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','prod_Qty','/give_payment/:id','$product.room_name','$product_details.maxProducts','4916370nkzERE','Rack\x20A','$unit','product_details','ejs','$product_details','pallet','Rack\x20D','prod_invoice','</head><body>','\x20<\x20wew\x20>\x20','Shelves','Arabic\x20(ae)','Logo.png','Ambient','back','edit_purchases','error','suppliers_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product_details.product_code','<table\x20style=\x22width:\x20100%\x20!important;\x22>','push','23496ErCOxL','Room_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','820476JsVqFy','COLD\x20STORAGE','suppliers_docs','level','toString','$product_details.primary_code','concat','express','<strong>\x20Regards\x20</strong>','storage','Email\x20sent\x20successfully','errors','room','room_name','standard_unit','date','French','Rack\x20F','map','get','floorlevel','English','all','Chinese','<h5>','/view/add_purchases/:id','$suppliers_docs','<div>','primary_code','An\x20error\x20occurred\x20while\x20saving\x20data.','finalize','</tr>','</h5>','Rack\x20B','/barcode_scanner','$name','render','purchase_invoice','paid_amount','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'];a0_0x5f2b=function(){return _0x51676f;};return a0_0x5f2b();}router[a0_0x504112(0x1aa)](a0_0x504112(0x277),auth,async(_0x2cf306,_0x256901)=>{var _0x1b333a=a0_0x504112;try{const {username:_0x57cd4d,email:_0x29babd,role:_0x20fa17}=_0x2cf306[_0x1b333a(0x1c4)],_0x3789e9=_0x2cf306['user'],_0x24a4b9=await profile[_0x1b333a(0x21a)]({'email':_0x3789e9['email']}),_0x3f3df8=await staff[_0x1b333a(0x21a)]({'email':_0x3789e9['email']});if(_0x3789e9[_0x1b333a(0x229)]==_0x1b333a(0x1db)){const _0xbb7724=await staff[_0x1b333a(0x21a)]({'email':_0x3789e9[_0x1b333a(0x286)]});}const _0xc16e86=await master_shop[_0x1b333a(0x251)]();let _0xaab411;if(_0x3789e9[_0x1b333a(0x229)]==_0x1b333a(0x1db)){const _0xb0db57=await staff[_0x1b333a(0x21a)]({'email':_0x3789e9[_0x1b333a(0x286)]});_0xaab411=await purchases[_0x1b333a(0x1c1)]([{'$match':{'warehouse_name':_0xb0db57['warehouse']}},{'$lookup':{'from':_0x1b333a(0x22d),'localField':_0x1b333a(0x22d),'foreignField':_0x1b333a(0x29e),'as':_0x1b333a(0x199)}},{'$unwind':_0x1b333a(0x1b1)},{'$unwind':_0x1b333a(0x227)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x1b333a(0x20b)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':'$room'},'product':{'$push':_0x1b333a(0x227)},'note':{'$first':_0x1b333a(0x28d)},'paid_amount':{'$first':_0x1b333a(0x239)},'due_amount':{'$first':_0x1b333a(0x1ec)},'return_data':{'$first':_0x1b333a(0x244)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x1b333a(0x1fd)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x1b333a(0x233)},'level':{'$addToSet':_0x1b333a(0x24d)},'isle':{'$addToSet':_0x1b333a(0x256)},'type':{'$addToSet':_0x1b333a(0x284)},'floorlevel':{'$addToSet':_0x1b333a(0x232)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0xaab411=await purchases[_0x1b333a(0x1c1)]([{'$lookup':{'from':_0x1b333a(0x22d),'localField':'suppliers','foreignField':_0x1b333a(0x29e),'as':_0x1b333a(0x199)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x1b333a(0x227)},{'$group':{'_id':_0x1b333a(0x27f),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x1b333a(0x20b)},'warehouse_name':{'$first':_0x1b333a(0x21f)},'room':{'$addToSet':_0x1b333a(0x2a6)},'product':{'$push':'$product'},'note':{'$first':_0x1b333a(0x28d)},'paid_amount':{'$first':_0x1b333a(0x239)},'due_amount':{'$first':_0x1b333a(0x1ec)},'return_data':{'$first':_0x1b333a(0x244)},'batch_code':{'$first':_0x1b333a(0x1d0)},'expiry_date':{'$first':_0x1b333a(0x1fd)},'suppliers_docs':{'$first':_0x1b333a(0x1b1)},'total_product_quantity':{'$sum':_0x1b333a(0x233)},'level':{'$addToSet':_0x1b333a(0x24d)},'isle':{'$addToSet':_0x1b333a(0x256)},'type':{'$addToSet':_0x1b333a(0x284)},'floorlevel':{'$addToSet':_0x1b333a(0x232)},'finalize':{'$first':_0x1b333a(0x25a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0xc16e86[0x0]['language']=='English\x20(US)'){var _0x556e58=users['English'];console['log'](_0x556e58);}else{if(_0xc16e86[0x0]['language']==_0x1b333a(0x234))var _0x556e58=users[_0x1b333a(0x234)];else{if(_0xc16e86[0x0][_0x1b333a(0x1d4)]==_0x1b333a(0x1c8))var _0x556e58=users[_0x1b333a(0x1c8)];else{if(_0xc16e86[0x0]['language']=='Spanish')var _0x556e58=users['Spanish'];else{if(_0xc16e86[0x0][_0x1b333a(0x1d4)]=='French')var _0x556e58=users[_0x1b333a(0x1a7)];else{if(_0xc16e86[0x0]['language']==_0x1b333a(0x27b))var _0x556e58=users[_0x1b333a(0x258)];else{if(_0xc16e86[0x0][_0x1b333a(0x1d4)]==_0x1b333a(0x1ae))var _0x556e58=users[_0x1b333a(0x1ae)];else{if(_0xc16e86[0x0]['language']==_0x1b333a(0x2b4))var _0x556e58=users[_0x1b333a(0x25e)];}}}}}}}_0x256901[_0x1b333a(0x1bb)](_0x1b333a(0x1ea),{'success':_0x2cf306[_0x1b333a(0x288)](_0x1b333a(0x292)),'errors':_0x2cf306[_0x1b333a(0x288)](_0x1b333a(0x1a2)),'purchases':_0xaab411,'role':_0x3789e9,'profile':_0x24a4b9,'master_shop':_0xc16e86,'language':_0x556e58});}catch(_0xb5280b){console[_0x1b333a(0x28b)](_0x1b333a(0x22f),_0xb5280b),_0x256901[_0x1b333a(0x1fe)](0xc8)[_0x1b333a(0x223)]({'message':_0xb5280b[_0x1b333a(0x225)]});}});function BayBinSelected(_0x2e964f,_0x189fa4){var _0x4cff00=a0_0x504112,_0x212f1d=[],_0x5440aa=[],_0x50ad15=[],_0x1e1950=[],_0x34ab1f=[],_0x34cb8b=[];let _0x39eacf=[];if(_0x2e964f==_0x4cff00(0x1fa))switch(_0x189fa4){case'Rack\x20A':_0x212f1d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5440aa=[0x1,0x2],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=[_0x4cff00(0x202),_0x4cff00(0x24b)],_0x34ab1f=['D'],_0x34cb8b=['A'];break;case _0x4cff00(0x1b8):_0x212f1d=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5440aa=[0x1,0x2],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=[_0x4cff00(0x202),_0x4cff00(0x24b)],_0x34ab1f=['D'],_0x34cb8b=['B'];break;case _0x4cff00(0x2b3):_0x212f1d=[0x0],_0x5440aa=[0x0],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=[_0x4cff00(0x24b)],_0x34ab1f=['D'],_0x34cb8b=['S'];break;case'Receiving\x20Area':_0x212f1d=[0x0],_0x5440aa=[0x0],_0x1e1950=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x50ad15=[_0x4cff00(0x24b)],_0x34ab1f=['D'],_0x34cb8b=['R'];break;}else{if(_0x2e964f==_0x4cff00(0x198))switch(_0x189fa4){case _0x4cff00(0x2a9):_0x212f1d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5440aa=['B','F'],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=[_0x4cff00(0x202),_0x4cff00(0x24b)],_0x34ab1f=['C'],_0x34cb8b=['A'];break;case _0x4cff00(0x1b8):_0x212f1d=[0x5,0x4,0x3,0x2,0x1],_0x5440aa=['F','B','S'],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=['Level',_0x4cff00(0x24b)],_0x34ab1f=['C'],_0x34cb8b=['B'];break;case'Rack\x20C':_0x212f1d=[0x1,0x2,0x3,0x4,0x5],_0x5440aa=['B','F','S'],_0x1e1950=[0x5,0x4,0x3,0x2,0x1],_0x50ad15=[_0x4cff00(0x202),_0x4cff00(0x24b)],_0x34ab1f=['C'],_0x34cb8b=['C'];break;case _0x4cff00(0x2af):_0x212f1d=[0x5,0x4,0x3,0x2,0x1],_0x5440aa=['F','B','S'],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=[_0x4cff00(0x202),'Floor'],_0x34ab1f=['C'],_0x34cb8b=['D'];break;case _0x4cff00(0x28a):_0x212f1d=[0x4,0x3,0x2,0x1],_0x5440aa=[0x1,0x2],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=[_0x4cff00(0x202),_0x4cff00(0x24b)],_0x34ab1f=['C'],_0x34cb8b=['E'];break;case _0x4cff00(0x1a8):_0x212f1d=[0x1,0x2,0x3],_0x5440aa=[0x1,0x2],_0x1e1950=[0x1,0x2,0x3,0x4,0x5],_0x50ad15=['Level'],_0x34ab1f=['C'],_0x34cb8b=['F'];break;}}return{'levels':_0x212f1d,'Isle':_0x5440aa,'rack':_0x1e1950,'type':_0x50ad15,'storage':_0x34ab1f,'rak':_0x34cb8b};}function a0_0x5458(_0x59b74a,_0x53618c){var _0x5f2b30=a0_0x5f2b();return a0_0x5458=function(_0x545803,_0x5babc7){_0x545803=_0x545803-0x18b;var _0x1a3a3e=_0x5f2b30[_0x545803];return _0x1a3a3e;},a0_0x5458(_0x59b74a,_0x53618c);}async function getRandom8DigitNumber(){var _0x4d3144=a0_0x504112;const _0x1a147f=0x989680,_0x5f547e=0x5f5e0ff,_0x5de69e=Math['floor'](Math[_0x4d3144(0x240)]()*(_0x5f547e-_0x1a147f+0x1))+_0x1a147f;var _0x38abc5;const _0x5ce72e=await purchases[_0x4d3144(0x21a)]({'invoice':'INC-'+_0x5de69e});return _0x5ce72e&&_0x5ce72e[_0x4d3144(0x28c)]>0x0?_0x38abc5=_0x4d3144(0x1c2)+_0x5de69e:_0x38abc5='INC-'+_0x5de69e,_0x38abc5;}router[a0_0x504112(0x1aa)](a0_0x504112(0x1d2),auth,async(_0x8de200,_0x5ac0c9)=>{var _0x2f6d9c=a0_0x504112;try{const {username:_0xbc921b,email:_0x483da3,role:_0x12e8d7}=_0x8de200[_0x2f6d9c(0x1c4)],_0x46eef6=_0x8de200['user'],_0x359b89=await profile[_0x2f6d9c(0x21a)]({'email':_0x46eef6['email']}),_0x1d82a6=await master_shop[_0x2f6d9c(0x251)](),_0x4f8160=await staff[_0x2f6d9c(0x21a)]({'email':_0x46eef6[_0x2f6d9c(0x286)]}),_0x4f8270=await suppliers[_0x2f6d9c(0x251)]({});let _0x1274e6;if(_0x46eef6[_0x2f6d9c(0x229)]==_0x2f6d9c(0x1db)){const _0xa73a8=await staff[_0x2f6d9c(0x21a)]({'email':_0x46eef6[_0x2f6d9c(0x286)]});_0x1274e6=await warehouse[_0x2f6d9c(0x1c1)]([{'$match':{'status':_0x2f6d9c(0x208),'name':_0xa73a8[_0x2f6d9c(0x1d1)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2f6d9c(0x231)}}},{'$group':{'_id':_0x2f6d9c(0x1ba),'name':{'$first':_0x2f6d9c(0x1ba)}}}]);}else _0x1274e6=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x2f6d9c(0x212),'name':{'$ne':_0x2f6d9c(0x231)}}},{'$group':{'_id':_0x2f6d9c(0x1ba),'name':{'$first':_0x2f6d9c(0x1ba)}}}]);const _0x30e823=await product[_0x2f6d9c(0x251)]({}),_0x157d4f=await warehouse[_0x2f6d9c(0x251)]({'status':_0x2f6d9c(0x208)}),_0x4a12c=await purchases[_0x2f6d9c(0x251)]({}),_0x40c149=_0x4a12c[_0x2f6d9c(0x28c)]+0x1,_0x4581ed='INC-'+_0x40c149[_0x2f6d9c(0x19b)]()[_0x2f6d9c(0x1da)](0x5,'0');var _0x24d911=[_0x2f6d9c(0x18b),_0x2f6d9c(0x27c)];if(_0x1d82a6[0x0][_0x2f6d9c(0x1d4)]=='English\x20(US)')var _0x3860ca=users['English'];else{if(_0x1d82a6[0x0]['language']==_0x2f6d9c(0x234))var _0x3860ca=users[_0x2f6d9c(0x234)];else{if(_0x1d82a6[0x0][_0x2f6d9c(0x1d4)]==_0x2f6d9c(0x1c8))var _0x3860ca=users[_0x2f6d9c(0x1c8)];else{if(_0x1d82a6[0x0]['language']==_0x2f6d9c(0x253))var _0x3860ca=users['Spanish'];else{if(_0x1d82a6[0x0][_0x2f6d9c(0x1d4)]==_0x2f6d9c(0x1a7))var _0x3860ca=users[_0x2f6d9c(0x1a7)];else{if(_0x1d82a6[0x0]['language']==_0x2f6d9c(0x27b))var _0x3860ca=users['Portuguese'];else{if(_0x1d82a6[0x0][_0x2f6d9c(0x1d4)]==_0x2f6d9c(0x1ae))var _0x3860ca=users[_0x2f6d9c(0x1ae)];else{if(_0x1d82a6[0x0][_0x2f6d9c(0x1d4)]==_0x2f6d9c(0x2b4))var _0x3860ca=users[_0x2f6d9c(0x25e)];}}}}}}}const _0x4ddce7=getRandom8DigitNumber();_0x4ddce7['then'](_0x3eff19=>{var _0x5773ea=_0x2f6d9c;_0x5ac0c9[_0x5773ea(0x1bb)]('add_purchases',{'success':_0x8de200['flash'](_0x5773ea(0x292)),'errors':_0x8de200[_0x5773ea(0x288)](_0x5773ea(0x1a2)),'role':_0x46eef6,'profile':_0x359b89,'suppliers':_0x4f8270,'warehouse':_0x1274e6,'product':_0x30e823,'invoice':_0x3eff19,'master_shop':_0x1d82a6,'language':_0x3860ca,'find_data':_0x157d4f,'rooms_data':_0x24d911});})[_0x2f6d9c(0x1eb)](_0x3dd287=>{var _0x242bc8=_0x2f6d9c;_0x8de200[_0x242bc8(0x288)]('errors',_0x242bc8(0x220)),_0x5ac0c9[_0x242bc8(0x263)](_0x242bc8(0x1f8));});}catch(_0x7e691f){console[_0x2f6d9c(0x28b)](_0x7e691f);}}),router[a0_0x504112(0x1aa)](a0_0x504112(0x1b0),auth,async(_0xd81f51,_0x3cac66)=>{var _0x497904=a0_0x504112;try{const _0x447f4c=_0xd81f51[_0x497904(0x1de)]['id'];console['log'](_0x447f4c);const _0x470b0c=await master_shop['find']();console['log'](_0x497904(0x26f),_0x470b0c);const _0x3a40df=await product['findOne']({'name':_0x447f4c});console['log']('product',_0x3a40df),_0x3cac66['status'](0xc8)[_0x497904(0x223)]({'product_data':_0x3a40df,'master':_0x470b0c});}catch(_0x2f99be){console[_0x497904(0x28b)](_0x497904(0x1dc),_0x2f99be);}}),router[a0_0x504112(0x1be)](a0_0x504112(0x1d2),auth,async(_0x54448f,_0x46f64d)=>{var _0x4bce1f=a0_0x504112;try{const {invoice:_0x2b8edf,date:_0x2f03a9,warehouse_name:_0x48acee,prod_name:_0xc7e26,prod_code:_0x1fa5bd,prod_qty:_0xe78e15,prod_unit:_0x50952c,prod_secondunit:_0x25991c,prod_level:_0x3f00e1,prod_isle:_0x4f56f2,prod_pallet:_0x23fcbe,note:_0x54fb48,expiry_date:_0x51a0dc,batch_code:_0x36cb8d,payable:_0x2af0b5,due_amount:_0x398f9d,Room_name:_0x469bec,primary_code:_0x11941f,secondary_code:_0x233f5a,MaxStocks_data:_0x28ca3b,PO_number:_0x2460d8,SCRN:_0x4ac000,JO_number:_0x37b73c}=_0x54448f[_0x4bce1f(0x224)];if(typeof _0xc7e26==_0x4bce1f(0x1d8))var _0x2935fc=[_0x54448f['body'][_0x4bce1f(0x1f2)]],_0xe543e6=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x29a)]],_0x75d7a=[_0x54448f['body'][_0x4bce1f(0x2a4)]],_0x131c62=[_0x54448f[_0x4bce1f(0x224)]['prod_primunit']],_0x26c1ec=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x236)]],_0xb7052f=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x21b)]],_0xf1e00a=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x1b3)]],_0x1478ed=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x1e2)]],_0x1158ec=[_0x54448f['body'][_0x4bce1f(0x22a)]],_0x4feba3=[_0x54448f['body'][_0x4bce1f(0x22e)]],_0x2b7280=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x243)]],_0xf2c5fa=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x211)]],_0x38c436=[_0x54448f['body']['alertQTY']],_0x48bd2d=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x272)]],_0x1da2c9=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x1fb)]],_0x549512=[_0x54448f[_0x4bce1f(0x224)]['RoomAssign']],_0x5a0379=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x246)]],_0x598719=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x2b0)]],_0x2ca2b3=[_0x54448f[_0x4bce1f(0x224)]['actual_qty']],_0x27e60c=[_0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x216)]];else var _0x2935fc=[..._0x54448f[_0x4bce1f(0x224)]['prod_name']],_0xe543e6=[..._0x54448f['body'][_0x4bce1f(0x29a)]],_0x75d7a=[..._0x54448f[_0x4bce1f(0x224)]['prod_Qty']],_0x131c62=[..._0x54448f[_0x4bce1f(0x224)]['prod_primunit']],_0x26c1ec=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x236)]],_0xb7052f=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x21b)]],_0xf1e00a=[..._0x54448f[_0x4bce1f(0x224)]['primary_code']],_0x1478ed=[..._0x54448f[_0x4bce1f(0x224)]['secondary_code']],_0x1158ec=[..._0x54448f['body']['MaxStocks_data']],_0x4feba3=[..._0x54448f[_0x4bce1f(0x224)]['batch_code']],_0x2b7280=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x243)]],_0xf2c5fa=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x211)]],_0x38c436=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x280)]],_0x48bd2d=[..._0x54448f[_0x4bce1f(0x224)]['production_date']],_0x1da2c9=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x1fb)]],_0x549512=[..._0x54448f[_0x4bce1f(0x224)]['RoomAssign']],_0x5a0379=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x246)]],_0x598719=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x2b0)]],_0x2ca2b3=[..._0x54448f[_0x4bce1f(0x224)][_0x4bce1f(0x213)]],_0x27e60c=[..._0x54448f[_0x4bce1f(0x224)]['actual_uom']];const _0x3ed684=_0x2935fc[_0x4bce1f(0x1a9)](_0x412aba=>{return _0x412aba={'product_name':_0x412aba};});_0x2ca2b3[_0x4bce1f(0x1ff)]((_0x453802,_0x1a0963)=>{var _0x2cb834=_0x4bce1f;_0x3ed684[_0x1a0963][_0x2cb834(0x213)]=Math[_0x2cb834(0x237)](_0x453802);}),_0x27e60c[_0x4bce1f(0x1ff)]((_0x169da2,_0x5ad89b)=>{var _0x42e743=_0x4bce1f;_0x3ed684[_0x5ad89b][_0x42e743(0x216)]=_0x169da2;}),_0xe543e6['forEach']((_0x383f51,_0x25f34f)=>{var _0x312c85=_0x4bce1f;_0x3ed684[_0x25f34f][_0x312c85(0x294)]=_0x383f51;}),_0x75d7a['forEach']((_0x20b2dd,_0x48c97d)=>{var _0x59487c=_0x4bce1f;_0x3ed684[_0x48c97d][_0x59487c(0x254)]=Math[_0x59487c(0x237)](_0x20b2dd);}),_0x131c62[_0x4bce1f(0x1ff)]((_0x4442f2,_0x38b41e)=>{_0x3ed684[_0x38b41e]['standard_unit']=_0x4442f2;}),_0x26c1ec[_0x4bce1f(0x1ff)]((_0x16a5c6,_0x21479d)=>{_0x3ed684[_0x21479d]['secondary_unit']=_0x16a5c6;}),_0xb7052f['forEach']((_0x1d9370,_0x492f65)=>{_0x549512['forEach']((_0x9f1121,_0x5d3ad3)=>{var _0x420db0=a0_0x5458;if(_0x9f1121==_0x420db0(0x25b)&&_0x492f65==_0x5d3ad3){console[_0x420db0(0x28b)](_0x9f1121+_0x420db0(0x2b2)+_0x492f65+_0x420db0(0x1c0)+_0x5d3ad3+_0x420db0(0x1c0)+_0x1d9370);var _0x184525=_0x1d9370[_0x420db0(0x25d)](0x3);_0x3ed684[_0x492f65][_0x420db0(0x1a0)]=_0x1d9370[0x0],_0x3ed684[_0x492f65][_0x420db0(0x281)]=_0x1d9370[0x1],_0x3ed684[_0x492f65][_0x420db0(0x238)]=0x0,_0x3ed684[_0x492f65][_0x420db0(0x1f7)]=0x0,_0x3ed684[_0x492f65][_0x420db0(0x1f6)]='Floor',_0x3ed684[_0x492f65]['floorlevel']=_0x184525;}else{if(_0x9f1121==_0x420db0(0x2b3)&&_0x492f65==_0x5d3ad3){var _0x184525=_0x1d9370[_0x420db0(0x25d)](0x3);_0x3ed684[_0x492f65][_0x420db0(0x1a0)]=_0x1d9370[0x0],_0x3ed684[_0x492f65][_0x420db0(0x281)]=_0x1d9370[0x1],_0x3ed684[_0x492f65][_0x420db0(0x238)]=0x0,_0x3ed684[_0x492f65][_0x420db0(0x1f7)]=0x0,_0x3ed684[_0x492f65][_0x420db0(0x1f6)]=_0x420db0(0x24b),_0x3ed684[_0x492f65][_0x420db0(0x1ab)]=_0x1d9370[0x5];}else{if(_0x492f65==_0x5d3ad3){if(_0x1d9370[0x0]=='A'&&_0x1d9370[0x1]=='L'&&_0x1d9370[0x2]=='L')console[_0x420db0(0x28b)](_0x9f1121+_0x420db0(0x1c0)+_0x492f65+_0x420db0(0x1c0)+_0x5d3ad3+_0x420db0(0x1c0)+_0x1d9370+_0x420db0(0x23b)),_0x3ed684[_0x492f65]['storage']=_0x1d9370[0x0],_0x3ed684[_0x492f65][_0x420db0(0x281)]=_0x1d9370[0x1],_0x3ed684[_0x492f65][_0x420db0(0x238)]=0x0,_0x3ed684[_0x492f65][_0x420db0(0x1f7)]=0x0,_0x3ed684[_0x492f65]['type']='Floor',_0x3ed684[_0x492f65][_0x420db0(0x1ab)]=_0x1d9370[0x3];else{var _0x37d5fa;if(_0x1d9370[0x4]=='L')_0x37d5fa='Level';else _0x1d9370[0x4]=='F'&&(_0x37d5fa=_0x420db0(0x24b));_0x3ed684[_0x492f65][_0x420db0(0x1a0)]=_0x1d9370[0x0],_0x3ed684[_0x492f65][_0x420db0(0x281)]=_0x1d9370[0x1],_0x3ed684[_0x492f65][_0x420db0(0x238)]=_0x1d9370[0x2],_0x3ed684[_0x492f65]['bin']=_0x1d9370[0x3],_0x3ed684[_0x492f65][_0x420db0(0x1f6)]=_0x37d5fa,_0x3ed684[_0x492f65][_0x420db0(0x1ab)]=_0x1d9370[0x5];}}}}});}),_0xf1e00a['forEach']((_0x5d90ae,_0x3dcf8c)=>{var _0x15748f=_0x4bce1f;_0x3ed684[_0x3dcf8c][_0x15748f(0x1b3)]=_0x5d90ae;}),_0x1478ed['forEach']((_0x9dbc09,_0x7fec17)=>{_0x3ed684[_0x7fec17]['secondary_code']=_0x9dbc09;}),_0x1158ec[_0x4bce1f(0x1ff)]((_0x403613,_0xd31967)=>{_0x3ed684[_0xd31967]['maxStocks']=_0x403613;}),_0x4feba3[_0x4bce1f(0x1ff)]((_0x3189a1,_0x347316)=>{var _0x4841c1=_0x4bce1f;_0x3ed684[_0x347316][_0x4841c1(0x22e)]=_0x3189a1;}),_0x2b7280['forEach']((_0xffda1e,_0x4647cf)=>{var _0x10f9ce=_0x4bce1f;_0x3ed684[_0x4647cf][_0x10f9ce(0x243)]=_0xffda1e;}),_0xf2c5fa[_0x4bce1f(0x1ff)]((_0x1214a2,_0x201da2)=>{var _0x2b3626=_0x4bce1f;_0x3ed684[_0x201da2][_0x2b3626(0x28f)]=_0x1214a2;}),_0x38c436['forEach']((_0x3444c,_0x4318e4)=>{var _0x484831=_0x4bce1f;_0x3ed684[_0x4318e4][_0x484831(0x280)]=_0x3444c;}),_0x48bd2d[_0x4bce1f(0x1ff)]((_0x308f04,_0x52ea6b)=>{var _0x317834=_0x4bce1f;_0x3ed684[_0x52ea6b][_0x317834(0x272)]=_0x308f04;}),_0x1da2c9[_0x4bce1f(0x1ff)]((_0x4898f0,_0x3dd886)=>{var _0x36559a=_0x4bce1f;_0x3ed684[_0x3dd886][_0x36559a(0x23c)]=_0x4898f0;}),_0x549512[_0x4bce1f(0x1ff)]((_0x587e65,_0x19094f)=>{var _0x53c673=_0x4bce1f;_0x3ed684[_0x19094f][_0x53c673(0x1a4)]=_0x587e65;}),_0x5a0379[_0x4bce1f(0x1ff)]((_0x275019,_0x195b4a)=>{var _0x9e1c89=_0x4bce1f;_0x3ed684[_0x195b4a][_0x9e1c89(0x262)]=_0x275019;}),_0x598719[_0x4bce1f(0x1ff)]((_0x5868c3,_0x54ff11)=>{_0x3ed684[_0x54ff11]['invoice']=_0x5868c3;});const _0x67c240=_0x549512[_0x4bce1f(0x1a9)](_0x238cc2=>{return _0x238cc2={'room_name':_0x238cc2};}),_0xd64648=_0x3ed684[_0x4bce1f(0x235)](_0x8c7d0c=>_0x8c7d0c['quantity']!=='0'&&_0x8c7d0c[_0x4bce1f(0x254)]!==''),_0x247a4b=new purchases({'invoice':_0x2b8edf,'suppliers':_0x54448f['body']['suppliers'],'date':_0x2f03a9,'warehouse_name':_0x48acee,'product':_0xd64648,'note':_0x54fb48,'due_amount':_0x398f9d,'POnumber':_0x2460d8,'SCRN':_0x4ac000,'JO_number':_0x37b73c,'roomList':_0x67c240}),_0x1ca66d=await _0x247a4b[_0x4bce1f(0x23f)](),_0x53c591=await purchases[_0x4bce1f(0x21a)]({'invoice':_0x2b8edf}),_0x5f28af=_0x53c591[_0x4bce1f(0x226)][_0x4bce1f(0x1a9)](async _0x482b78=>{var _0x5caa3b=_0x4bce1f,_0x12ced0=await warehouse[_0x5caa3b(0x21a)]({'name':_0x48acee,'room':_0x482b78[_0x5caa3b(0x1a4)]}),_0x441f3a=0x0;return _0x12ced0[_0x5caa3b(0x2ab)]['forEach'](_0x395102=>{var _0x46d8de=_0x5caa3b;_0x395102[_0x46d8de(0x1f9)]==_0x482b78['product_name']&&_0x395102[_0x46d8de(0x1ab)]==_0x482b78[_0x46d8de(0x1ab)]&&_0x395102[_0x46d8de(0x1f6)]==_0x482b78['type']&&_0x395102[_0x46d8de(0x1f7)]==_0x482b78[_0x46d8de(0x1f7)]&&_0x395102[_0x46d8de(0x238)]==_0x482b78['bay']&&_0x395102[_0x46d8de(0x281)]==_0x482b78[_0x46d8de(0x281)]&&_0x395102[_0x46d8de(0x1a0)]==_0x482b78[_0x46d8de(0x1a0)]&&_0x395102[_0x46d8de(0x243)]==_0x482b78[_0x46d8de(0x243)]&&_0x395102[_0x46d8de(0x22e)]==_0x482b78[_0x46d8de(0x22e)]&&_0x395102[_0x46d8de(0x272)]==_0x482b78[_0x46d8de(0x272)]&&_0x395102[_0x46d8de(0x20e)]==_0x53c591['invoice']&&(_0x395102['product_stock']+=Math['abs'](_0x482b78[_0x46d8de(0x254)]),_0x441f3a++);}),_0x441f3a===0x0&&_0x12ced0['product_details'][_0x5caa3b(0x193)]({'product_name':_0x482b78['product_name'],'product_stock':Math[_0x5caa3b(0x237)](_0x482b78['quantity']),'primary_code':_0x482b78[_0x5caa3b(0x1b3)],'secondary_code':_0x482b78[_0x5caa3b(0x1e2)],'product_code':_0x482b78['product_code'],'storage':_0x482b78['storage'],'rack':_0x482b78[_0x5caa3b(0x281)],'bay':_0x482b78['bay'],'bin':_0x482b78['bin'],'type':_0x482b78['type'],'floorlevel':_0x482b78[_0x5caa3b(0x1ab)],'maxProducts':_0x482b78[_0x5caa3b(0x20a)],'unit':_0x482b78[_0x5caa3b(0x1a5)],'secondary_unit':_0x482b78[_0x5caa3b(0x264)],'expiry_date':_0x482b78[_0x5caa3b(0x243)],'maxPerUnit':_0x482b78['maxperunit'],'batch_code':_0x482b78[_0x5caa3b(0x22e)],'alertQTY':_0x482b78[_0x5caa3b(0x280)],'production_date':_0x482b78[_0x5caa3b(0x272)],'product_cat':_0x482b78['product_cat'],'invoice':_0x482b78[_0x5caa3b(0x20e)],'actual_qty':Math[_0x5caa3b(0x237)](_0x482b78[_0x5caa3b(0x213)]),'actual_uom':_0x482b78[_0x5caa3b(0x216)]}),_0x12ced0;});Promise[_0x4bce1f(0x1ad)](_0x5f28af)[_0x4bce1f(0x1ca)](async _0x32cae8=>{var _0x573676=_0x4bce1f;try{for(const _0x5b2165 of _0x32cae8){await _0x5b2165[_0x573676(0x23f)]();}const _0x5b7ef7=await master_shop[_0x573676(0x251)](),_0x69ea32=await email_settings[_0x573676(0x21a)](),_0x55f75d=await supervisor_settings[_0x573676(0x251)]();var _0x3cf8eb=_0x53c591['product'],_0x4825f5='',_0x26af30;for(_0x26af30 in _0x3cf8eb){_0x4825f5+=_0x573676(0x28e)+_0x573676(0x24c)+_0x3cf8eb[_0x26af30][_0x573676(0x1f9)]+_0x573676(0x1ef)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3cf8eb[_0x26af30][_0x573676(0x294)]+_0x573676(0x1ef)+_0x573676(0x24c)+_0x3cf8eb[_0x26af30][_0x573676(0x254)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3cf8eb[_0x26af30][_0x573676(0x1a5)]+'</td>'+_0x573676(0x24c)+_0x3cf8eb[_0x26af30][_0x573676(0x264)]+_0x573676(0x1ef)+_0x573676(0x24c)+_0x53c591[_0x573676(0x247)]+_0x573676(0x1ef)+_0x573676(0x24c)+_0x3cf8eb[_0x26af30]['room_name']+'</td>'+_0x573676(0x24c)+_0x3cf8eb[_0x26af30]['storage']+_0x3cf8eb[_0x26af30]['rack']+_0x3cf8eb[_0x26af30][_0x573676(0x238)]+_0x3cf8eb[_0x26af30]['bin']+_0x3cf8eb[_0x26af30]['type'][0x0]+_0x3cf8eb[_0x26af30][_0x573676(0x1ab)]+_0x573676(0x1ef),_0x573676(0x1b6);}let _0xc88853=nodemailer['createTransport']({'host':_0x69ea32[_0x573676(0x297)],'port':Number(_0x69ea32[_0x573676(0x22c)]),'secure':![],'auth':{'user':_0x69ea32[_0x573676(0x286)],'pass':_0x69ea32[_0x573676(0x290)]}}),_0x3e47b0={'from':_0x69ea32[_0x573676(0x286)],'to':_0x55f75d[0x0][_0x573676(0x278)],'subject':_0x573676(0x206),'attachments':[{'filename':_0x573676(0x2b5),'path':__dirname+_0x573676(0x1f1)+_0x573676(0x23a)+_0x5b7ef7[0x0][_0x573676(0x287)],'cid':'logo'}],'html':_0x573676(0x1e5)+_0x573676(0x1d9)+_0x573676(0x2b1)+_0x573676(0x1b2)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x573676(0x1b2)+_0x573676(0x1dd)+_0x573676(0x203)+'<div>'+_0x573676(0x299)+_0x5b7ef7[0x0][_0x573676(0x260)]+_0x573676(0x26b)+_0x573676(0x203)+'</div>'+_0x573676(0x210)+_0x573676(0x1b2)+_0x573676(0x200)+'\x20Order\x20Number\x20:\x20'+_0x53c591[_0x573676(0x20e)]+'\x20'+_0x573676(0x22b)+_0x573676(0x1d3)+_0x53c591[_0x573676(0x1a6)]+'\x20'+_0x573676(0x214)+_0x573676(0x1b7)+_0x573676(0x203)+_0x573676(0x192)+_0x573676(0x196)+_0x573676(0x28e)+_0x573676(0x29d)+_0x573676(0x190)+_0x573676(0x1bf)+_0x573676(0x289)+_0x573676(0x219)+_0x573676(0x252)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x573676(0x23e)+'\x20'+_0x4825f5+'\x20'+_0x573676(0x1ed)+'</table>'+'<div>'+_0x573676(0x19f)+'<h5>'+_0x5b7ef7[0x0][_0x573676(0x260)]+_0x573676(0x1b7)+_0x573676(0x203)+_0x573676(0x203)+'</body></html>'};_0xc88853['sendMail'](_0x3e47b0,function(_0x44615f,_0x189d1c){var _0x560606=_0x573676;_0x44615f?(console[_0x560606(0x28b)](_0x44615f),console[_0x560606(0x28b)](_0x560606(0x1fc))):console['log'](_0x560606(0x1a1));}),_0x54448f[_0x573676(0x288)]('success',_0x573676(0x26e)),_0x46f64d[_0x573676(0x263)](_0x573676(0x1e4));}catch(_0x4e6a16){console[_0x573676(0x18e)](_0x4e6a16),_0x46f64d['status'](0x1f4)[_0x573676(0x223)]({'error':_0x573676(0x1b4)});}})[_0x4bce1f(0x1eb)](_0x4e014c=>{var _0x2c0c4a=_0x4bce1f;console['error'](_0x4e014c),_0x46f64d[_0x2c0c4a(0x1fe)](0x1f4)['json']({'error':_0x2c0c4a(0x21d)});});}catch(_0x1cb9b6){console[_0x4bce1f(0x28b)](_0x1cb9b6);}}),router[a0_0x504112(0x1aa)]('/preview/:id',auth,async(_0x182b8f,_0x3b340a)=>{var _0x4cf8b4=a0_0x504112;try{const {username:_0x5ed283,email:_0x53fc87,role:_0x2f8232}=_0x182b8f[_0x4cf8b4(0x1c4)],_0x1d3401=_0x182b8f[_0x4cf8b4(0x1c4)],_0xec7a8a=await profile[_0x4cf8b4(0x21a)]({'email':_0x1d3401['email']}),_0x24fff6=await master_shop[_0x4cf8b4(0x251)](),_0x1af420=_0x182b8f[_0x4cf8b4(0x1de)]['id'],_0xca232f=await purchases[_0x4cf8b4(0x298)](_0x1af420),_0x41c739=await warehouse['aggregate']([{'$match':{'name':_0xca232f[_0x4cf8b4(0x247)],'room':_0xca232f[_0x4cf8b4(0x1a3)]}},{'$unwind':_0x4cf8b4(0x2ad)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4cf8b4(0x20d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4cf8b4(0x266)},'type':{'$first':_0x4cf8b4(0x293)},'floorlevel':{'$first':_0x4cf8b4(0x1cc)},'primary_code':{'$first':_0x4cf8b4(0x19c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x4cf8b4(0x191)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4cf8b4(0x1f0)},'expiry_date':{'$first':_0x4cf8b4(0x29c)}}}]),_0x19812a=await customer[_0x4cf8b4(0x251)]({});let _0x47313d;if(_0x1d3401['role']==_0x4cf8b4(0x1db)){const _0x331cec=await staff[_0x4cf8b4(0x21a)]({'email':_0x1d3401[_0x4cf8b4(0x286)]});_0x47313d=await warehouse[_0x4cf8b4(0x1c1)]([{'$match':{'status':_0x4cf8b4(0x208),'name':_0x331cec[_0x4cf8b4(0x1d1)]}},{'$group':{'_id':_0x4cf8b4(0x1ba),'name':{'$first':'$name'}}}]);}else _0x47313d=await warehouse['aggregate']([{'$match':{'status':_0x4cf8b4(0x208)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0xbf12b9=await product[_0x4cf8b4(0x251)]({}),_0x3a300d=await suppliers['find']({}),_0x8ee967=BayBinSelected(_0xca232f[_0x4cf8b4(0x247)],_0xca232f[_0x4cf8b4(0x1a3)]);if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]==_0x4cf8b4(0x276)){var _0x3875a7=users[_0x4cf8b4(0x1ac)];console[_0x4cf8b4(0x28b)](_0x3875a7);}else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]=='Hindi')var _0x3875a7=users[_0x4cf8b4(0x234)];else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]==_0x4cf8b4(0x1c8))var _0x3875a7=users[_0x4cf8b4(0x1c8)];else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]=='Spanish')var _0x3875a7=users[_0x4cf8b4(0x253)];else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]==_0x4cf8b4(0x1a7))var _0x3875a7=users[_0x4cf8b4(0x1a7)];else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]=='Portuguese\x20(BR)')var _0x3875a7=users[_0x4cf8b4(0x258)];else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]==_0x4cf8b4(0x1ae))var _0x3875a7=users[_0x4cf8b4(0x1ae)];else{if(_0x24fff6[0x0][_0x4cf8b4(0x1d4)]=='Arabic\x20(ae)')var _0x3875a7=users[_0x4cf8b4(0x25e)];}}}}}}}_0x3b340a['render']('edit_purchases_view',{'success':_0x182b8f[_0x4cf8b4(0x288)](_0x4cf8b4(0x292)),'errors':_0x182b8f[_0x4cf8b4(0x288)](_0x4cf8b4(0x1a2)),'role':_0x1d3401,'profile':_0xec7a8a,'customer':_0x19812a,'warehouse':_0x47313d,'product':_0x41c739,'user':_0xca232f,'master_shop':_0x24fff6,'unit':_0xbf12b9,'language':_0x3875a7,'suppliers':_0x3a300d,'dataSelected':_0x8ee967});}catch(_0xac6f73){console[_0x4cf8b4(0x28b)](_0xac6f73);}}),router[a0_0x504112(0x1be)](a0_0x504112(0x1e7),auth,async(_0x19134e,_0x38a1b9)=>{var _0x37009e=a0_0x504112;try{const _0x33564d=_0x19134e[_0x37009e(0x1de)]['id'],{invoice:_0x106acc,warehouse_name:_0x49ea61,Room_name:_0x25ce04}=_0x19134e[_0x37009e(0x224)],_0x1a4f0d=await warehouse[_0x37009e(0x21a)]({'name':_0x49ea61,'room':_0x25ce04}),_0x786503=await purchases[_0x37009e(0x21a)]({'invoice':_0x106acc});_0x786503['product']['forEach'](_0x42be0c=>{var _0x1b387d=_0x37009e,_0x365040=0x0;const _0x4f9f1e=_0x1a4f0d[_0x1b387d(0x2ab)][_0x1b387d(0x1a9)](_0x4464ff=>{var _0x3c85c1=_0x1b387d;_0x4464ff[_0x3c85c1(0x1f9)]==_0x42be0c[_0x3c85c1(0x1f9)]&&_0x4464ff[_0x3c85c1(0x1ab)]==_0x42be0c[_0x3c85c1(0x1ab)]&&_0x4464ff[_0x3c85c1(0x1f6)]==_0x42be0c['type']&&_0x4464ff['bin']==_0x42be0c[_0x3c85c1(0x1f7)]&&_0x4464ff['bay']==_0x42be0c[_0x3c85c1(0x238)]&&_0x4464ff['rack']==_0x42be0c[_0x3c85c1(0x281)]&&_0x4464ff[_0x3c85c1(0x1a0)]==_0x42be0c[_0x3c85c1(0x1a0)]&&_0x4464ff[_0x3c85c1(0x243)]==_0x42be0c[_0x3c85c1(0x243)]&&_0x4464ff[_0x3c85c1(0x22e)]==_0x42be0c['batch_code']&&_0x4464ff[_0x3c85c1(0x272)]==_0x42be0c['production_date']&&_0x4464ff[_0x3c85c1(0x1ce)]==_0x42be0c['delivery_date']&&_0x4464ff['delivery_code']==_0x42be0c[_0x3c85c1(0x262)]&&(_0x4464ff[_0x3c85c1(0x27a)]=parseInt(_0x4464ff[_0x3c85c1(0x27a)])+parseInt(_0x42be0c[_0x3c85c1(0x254)]),_0x365040++);});_0x365040=='0'&&(_0x1a4f0d['product_details']=_0x1a4f0d[_0x1b387d(0x2ab)][_0x1b387d(0x19d)]({'product_name':_0x42be0c['product_name'],'product_stock':_0x42be0c[_0x1b387d(0x254)],'primary_code':_0x42be0c[_0x1b387d(0x1b3)],'secondary_code':_0x42be0c[_0x1b387d(0x1e2)],'product_code':_0x42be0c[_0x1b387d(0x294)],'storage':_0x42be0c[_0x1b387d(0x1a0)],'rack':_0x42be0c['rack'],'bay':_0x42be0c[_0x1b387d(0x238)],'bin':_0x42be0c[_0x1b387d(0x1f7)],'type':_0x42be0c['type'],'floorlevel':_0x42be0c['floorlevel'],'maxProducts':_0x42be0c['maxStocks'],'unit':_0x42be0c[_0x1b387d(0x1a5)],'secondary_unit':_0x42be0c[_0x1b387d(0x264)],'expiry_date':_0x42be0c['expiry_date'],'maxPerUnit':_0x42be0c[_0x1b387d(0x28f)],'batch_code':_0x42be0c['batch_code'],'alertQTY':_0x42be0c[_0x1b387d(0x280)],'production_date':_0x42be0c[_0x1b387d(0x272)],'delivery_date':_0x42be0c[_0x1b387d(0x1ce)],'delivery_code':_0x42be0c[_0x1b387d(0x262)]}));}),await _0x1a4f0d[_0x37009e(0x23f)](),_0x786503[_0x37009e(0x1b5)]=_0x37009e(0x1cf);const _0x51c893=await _0x786503[_0x37009e(0x23f)]();_0x19134e[_0x37009e(0x288)](_0x37009e(0x292),_0x37009e(0x201)),_0x38a1b9[_0x37009e(0x263)](_0x37009e(0x1f8));}catch(_0x296372){console[_0x37009e(0x28b)](_0x296372);}}),router['get']('/view/:id',auth,async(_0x5dde8f,_0x3fee81)=>{var _0x339552=a0_0x504112;try{const {username:_0x29e630,email:_0x13e3d3,role:_0x175766}=_0x5dde8f[_0x339552(0x1c4)],_0x4f10f8=_0x5dde8f[_0x339552(0x1c4)],_0x3b4eb0=await profile[_0x339552(0x21a)]({'email':_0x4f10f8['email']}),_0x591ac5=await master_shop[_0x339552(0x251)](),_0x124277=_0x5dde8f[_0x339552(0x1de)]['id'],_0x6ef5d8=await purchases[_0x339552(0x298)](_0x124277),_0xbe5e9c=await suppliers[_0x339552(0x251)]({});let _0x21869d;if(_0x4f10f8['role']==_0x339552(0x1db)){const _0x56fb02=await staff[_0x339552(0x21a)]({'email':_0x4f10f8['email']});_0x21869d=await warehouse[_0x339552(0x251)]({'status':_0x339552(0x208),'name':_0x56fb02['warehouse'],'warehouse_category':_0x339552(0x212)});}else _0x21869d=await warehouse[_0x339552(0x1c1)]([{'$match':{'status':'Enabled','warehouse_category':_0x339552(0x212)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x496ba8=await product[_0x339552(0x251)]({}),_0x126708=BayBinSelected(_0x6ef5d8['warehouse_name'],_0x6ef5d8[_0x339552(0x1a3)]);let _0x2ffb69=new Date(_0x6ef5d8['expiry_date']),_0x4c4477=('0'+_0x2ffb69[_0x339552(0x259)]())[_0x339552(0x25d)](-0x2),_0x4064af=('0'+(_0x2ffb69[_0x339552(0x282)]()+0x1))['slice'](-0x2),_0x27e083=_0x2ffb69['getFullYear'](),_0x448dcc=_0x27e083+'-'+_0x4064af+'-'+_0x4c4477;if(_0x591ac5[0x0]['language']==_0x339552(0x276)){var _0x22256e=users['English'];console[_0x339552(0x28b)](_0x22256e);}else{if(_0x591ac5[0x0][_0x339552(0x1d4)]==_0x339552(0x234))var _0x22256e=users['Hindi'];else{if(_0x591ac5[0x0][_0x339552(0x1d4)]==_0x339552(0x1c8))var _0x22256e=users[_0x339552(0x1c8)];else{if(_0x591ac5[0x0][_0x339552(0x1d4)]==_0x339552(0x253))var _0x22256e=users[_0x339552(0x253)];else{if(_0x591ac5[0x0][_0x339552(0x1d4)]=='French')var _0x22256e=users[_0x339552(0x1a7)];else{if(_0x591ac5[0x0][_0x339552(0x1d4)]==_0x339552(0x27b))var _0x22256e=users[_0x339552(0x258)];else{if(_0x591ac5[0x0][_0x339552(0x1d4)]==_0x339552(0x1ae))var _0x22256e=users[_0x339552(0x1ae)];else{if(_0x591ac5[0x0][_0x339552(0x1d4)]==_0x339552(0x2b4))var _0x22256e=users[_0x339552(0x25e)];}}}}}}}_0x3fee81[_0x339552(0x1bb)](_0x339552(0x18d),{'success':_0x5dde8f[_0x339552(0x288)]('success'),'errors':_0x5dde8f[_0x339552(0x288)](_0x339552(0x1a2)),'role':_0x4f10f8,'profile':_0x3b4eb0,'purchases':_0x6ef5d8,'suppliers':_0xbe5e9c,'warehouse':_0x21869d,'product':_0x496ba8,'master_shop':_0x591ac5,'language':_0x22256e,'ed_fullDate':_0x448dcc,'dataSelected':_0x126708});}catch(_0x214e81){console[_0x339552(0x28b)](_0x214e81);}}),router['post'](a0_0x504112(0x25f),auth,async(_0x1fa7d7,_0x96cd33)=>{var _0x53fd89=a0_0x504112;try{const _0x3e70fa=_0x1fa7d7[_0x53fd89(0x1de)]['id'],_0x5e3652=await purchases[_0x53fd89(0x21a)]({'_id':_0x1fa7d7[_0x53fd89(0x1de)]['id']}),_0x992644=await warehouse['findOne']({'name':_0x5e3652['warehouse_name'],'room':_0x5e3652[_0x53fd89(0x1a3)]});_0x5e3652[_0x53fd89(0x226)][_0x53fd89(0x1ff)](_0x46d79b=>{var _0x1bc563=_0x53fd89;const _0x533358=_0x992644[_0x1bc563(0x2ab)]['map'](_0x824a9b=>{var _0x127dde=_0x1bc563;_0x824a9b[_0x127dde(0x1f9)]==_0x46d79b[_0x127dde(0x1f9)]&&_0x824a9b[_0x127dde(0x1ab)]==_0x46d79b['floorlevel']&&_0x824a9b[_0x127dde(0x1f6)]==_0x46d79b['type']&&_0x824a9b['bin']==_0x46d79b['bin']&&_0x824a9b[_0x127dde(0x238)]==_0x46d79b[_0x127dde(0x238)]&&_0x824a9b[_0x127dde(0x281)]==_0x46d79b[_0x127dde(0x281)]&&_0x824a9b[_0x127dde(0x1a0)]==_0x46d79b[_0x127dde(0x1a0)]&&(_0x824a9b[_0x127dde(0x27a)]=parseInt(_0x824a9b[_0x127dde(0x27a)])-parseInt(_0x46d79b[_0x127dde(0x254)]));});}),await _0x992644[_0x53fd89(0x23f)]();const {invoice:_0x1db381,suppliers:_0x18704f,date:_0x15d5d6,warehouse_name:_0x21ba7d,prod_name:_0x4097b1,prod_code:_0x44da36,prod_qty:_0x252fa1,prod_unit:_0x123cbf,prod_secondunit:_0x82cd0e,prod_level:_0x319ff5,prod_isle:_0x36318f,prod_pallet:_0x42c6a0,note:_0x5ca0df,expiry_date:_0x8a11c7,batch_code:_0x3f6e67,paid_amount:_0xbb9e84,due_amount:_0x52afc2,Room_name:_0x1d46ea,primary_code:_0x2b2d36,secondary_code:_0x258e6a,PO_number:_0x2bcb66,JO_number:_0x41c6a2}=_0x1fa7d7[_0x53fd89(0x224)];if(typeof _0x4097b1=='string')var _0x35f75b=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x1f2)]],_0x2a10f0=[_0x1fa7d7['body'][_0x53fd89(0x29a)]],_0x42b681=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x27e)]],_0x1273cd=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x257)]],_0x200e1a=[_0x1fa7d7[_0x53fd89(0x224)]['prod_secondunit']],_0x25f8a3=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x21b)]],_0x472380=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x23d)]],_0x15fd43=[_0x1fa7d7['body'][_0x53fd89(0x228)]],_0x1ce66c=[_0x1fa7d7[_0x53fd89(0x224)]['primary_code']],_0x5b18ab=[_0x1fa7d7['body'][_0x53fd89(0x1e2)]],_0x34c749=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x22a)]],_0x509a5f=[_0x1fa7d7['body'][_0x53fd89(0x22e)]],_0x4e37cc=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x243)]],_0x5e894e=[_0x1fa7d7['body'][_0x53fd89(0x1a0)]],_0x55e447=[_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x20f)]],_0x3c6cc9=[_0x1fa7d7[_0x53fd89(0x224)]['type']];else var _0x35f75b=[..._0x1fa7d7['body'][_0x53fd89(0x1f2)]],_0x2a10f0=[..._0x1fa7d7['body'][_0x53fd89(0x29a)]],_0x42b681=[..._0x1fa7d7[_0x53fd89(0x224)]['prod_qty']],_0x1273cd=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x257)]],_0x200e1a=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x236)]],_0x25f8a3=[..._0x1fa7d7['body'][_0x53fd89(0x21b)]],_0x472380=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x23d)]],_0x15fd43=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x228)]],_0x1ce66c=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x1b3)]],_0x5b18ab=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x1e2)]],_0x34c749=[..._0x1fa7d7['body'][_0x53fd89(0x22a)]],_0x509a5f=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x22e)]],_0x4e37cc=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x243)]],_0x5e894e=[..._0x1fa7d7[_0x53fd89(0x224)]['storage']],_0x55e447=[..._0x1fa7d7[_0x53fd89(0x224)]['rak']],_0x3c6cc9=[..._0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x1f6)]];const _0x48a49f=_0x35f75b[_0x53fd89(0x1a9)](_0x24d74b=>{return _0x24d74b={'product_name':_0x24d74b};});_0x2a10f0[_0x53fd89(0x1ff)]((_0x2a795e,_0x432534)=>{var _0x228b14=_0x53fd89;_0x48a49f[_0x432534][_0x228b14(0x294)]=_0x2a795e;}),_0x42b681[_0x53fd89(0x1ff)]((_0x53aef9,_0x17e224)=>{var _0x5d0a47=_0x53fd89;_0x48a49f[_0x17e224][_0x5d0a47(0x254)]=_0x53aef9;}),_0x1273cd['forEach']((_0x1b110f,_0x2417de)=>{_0x48a49f[_0x2417de]['standard_unit']=_0x1b110f;}),_0x200e1a[_0x53fd89(0x1ff)]((_0x58b7db,_0x1e3c6c)=>{var _0x3b1dad=_0x53fd89;_0x48a49f[_0x1e3c6c][_0x3b1dad(0x264)]=_0x58b7db;}),_0x25f8a3[_0x53fd89(0x1ff)]((_0x23e3d1,_0x4f7f94)=>{var _0x1f5ee8=_0x53fd89;_0x48a49f[_0x4f7f94][_0x1f5ee8(0x238)]=_0x23e3d1;}),_0x472380[_0x53fd89(0x1ff)]((_0x3bae54,_0x33ab72)=>{var _0x5f5e47=_0x53fd89;_0x48a49f[_0x33ab72][_0x5f5e47(0x1f7)]=_0x3bae54;}),_0x15fd43['forEach']((_0x25c1bc,_0x2dda35)=>{var _0x23bbf1=_0x53fd89;_0x48a49f[_0x2dda35][_0x23bbf1(0x1ab)]=_0x25c1bc;}),_0x1ce66c[_0x53fd89(0x1ff)]((_0x251f8e,_0x286260)=>{var _0x4ce714=_0x53fd89;_0x48a49f[_0x286260][_0x4ce714(0x1b3)]=_0x251f8e;}),_0x5b18ab[_0x53fd89(0x1ff)]((_0x49c3df,_0x3cac1b)=>{var _0x2b0722=_0x53fd89;_0x48a49f[_0x3cac1b][_0x2b0722(0x1e2)]=_0x49c3df;}),_0x34c749[_0x53fd89(0x1ff)]((_0x57f84c,_0x566ed1)=>{_0x48a49f[_0x566ed1]['maxStocks']=_0x57f84c;}),_0x509a5f[_0x53fd89(0x1ff)]((_0x397732,_0x1b2e51)=>{_0x48a49f[_0x1b2e51]['batch_code']=_0x397732;}),_0x4e37cc[_0x53fd89(0x1ff)]((_0x393df1,_0x300304)=>{_0x48a49f[_0x300304]['expiry_date']=_0x393df1;}),_0x3c6cc9['forEach']((_0xd7fc39,_0x57911c)=>{var _0xc460a4=_0x53fd89;_0x48a49f[_0x57911c][_0xc460a4(0x1f6)]=_0xd7fc39;}),_0x5e894e['forEach']((_0x19413f,_0x1e818c)=>{var _0x5dcd26=_0x53fd89;_0x48a49f[_0x1e818c][_0x5dcd26(0x1a0)]=_0x19413f;}),_0x55e447[_0x53fd89(0x1ff)]((_0x22e8b1,_0x566e2d)=>{var _0x57d3b9=_0x53fd89;_0x48a49f[_0x566e2d][_0x57d3b9(0x281)]=_0x22e8b1;});const _0x322331=_0x48a49f['filter'](_0x611803=>_0x611803[_0x53fd89(0x254)]!=='0'&&_0x611803[_0x53fd89(0x254)]!=='');_0x5e3652[_0x53fd89(0x20e)]=_0x1db381,_0x5e3652['suppliers']=_0x18704f,_0x5e3652['date']=_0x15d5d6,_0x5e3652[_0x53fd89(0x247)]=_0x21ba7d,_0x5e3652[_0x53fd89(0x226)]=_0x322331,_0x5e3652[_0x53fd89(0x270)]=_0x5ca0df,_0x5e3652['paid_amount']=_0xbb9e84,_0x5e3652[_0x53fd89(0x1d6)]=_0x52afc2,_0x5e3652[_0x53fd89(0x1a3)]=_0x1d46ea,_0x5e3652[_0x53fd89(0x291)]=_0x2bcb66,_0x5e3652[_0x53fd89(0x255)]=_0x41c6a2;const _0x49129d=await _0x5e3652[_0x53fd89(0x23f)](),_0x5cf4ad=await warehouse[_0x53fd89(0x21a)]({'name':_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x247)],'room':_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x195)]});_0x5e3652[_0x53fd89(0x226)][_0x53fd89(0x1ff)](_0x49277e=>{var _0x2c5ca3=_0x53fd89,_0x453a05=0x0;const _0x46c742=_0x5cf4ad['product_details'][_0x2c5ca3(0x1a9)](_0x3496f1=>{var _0x1fd1ad=_0x2c5ca3;_0x3496f1[_0x1fd1ad(0x1f9)]==_0x49277e[_0x1fd1ad(0x1f9)]&&_0x3496f1[_0x1fd1ad(0x1ab)]==_0x49277e['floorlevel']&&_0x3496f1[_0x1fd1ad(0x1f6)]==_0x49277e[_0x1fd1ad(0x1f6)]&&_0x3496f1['bin']==_0x49277e[_0x1fd1ad(0x1f7)]&&_0x3496f1[_0x1fd1ad(0x238)]==_0x49277e[_0x1fd1ad(0x238)]&&_0x3496f1[_0x1fd1ad(0x281)]==_0x49277e['rack']&&_0x3496f1[_0x1fd1ad(0x1a0)]==_0x49277e[_0x1fd1ad(0x1a0)]&&(_0x3496f1[_0x1fd1ad(0x27a)]=parseInt(_0x3496f1['product_stock'])+parseInt(_0x49277e[_0x1fd1ad(0x254)]),_0x453a05++);});_0x453a05=='0'&&(_0x5cf4ad[_0x2c5ca3(0x2ab)]=_0x5cf4ad['product_details'][_0x2c5ca3(0x19d)]({'product_name':_0x49277e[_0x2c5ca3(0x1f9)],'product_stock':_0x49277e['quantity'],'primary_code':_0x49277e[_0x2c5ca3(0x1b3)],'secondary_code':_0x49277e[_0x2c5ca3(0x1e2)],'product_code':_0x49277e[_0x2c5ca3(0x294)],'storage':_0x49277e[_0x2c5ca3(0x1a0)],'rack':_0x49277e[_0x2c5ca3(0x281)],'bay':_0x49277e[_0x2c5ca3(0x238)],'bin':_0x49277e[_0x2c5ca3(0x1f7)],'type':_0x49277e[_0x2c5ca3(0x1f6)],'floorlevel':_0x49277e[_0x2c5ca3(0x1ab)],'maxProducts':_0x49277e['maxStocks'],'unit':_0x49277e[_0x2c5ca3(0x1a5)],'secondary_unit':_0x49277e[_0x2c5ca3(0x264)],'expiry_date':_0x49277e[_0x2c5ca3(0x243)]}));}),await _0x5cf4ad['save']();const _0xbe21a5=await s_payment_data['findOne']({'invoice':_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x20e)]});if(_0xbe21a5===null){}else console[_0x53fd89(0x28b)](_0x53fd89(0x22d),_0xbe21a5,_0x1fa7d7[_0x53fd89(0x224)][_0x53fd89(0x20e)]),_0xbe21a5[_0x53fd89(0x22d)]=_0x1fa7d7['body'][_0x53fd89(0x22d)],await _0xbe21a5['save']();_0x1fa7d7[_0x53fd89(0x288)]('success',_0x53fd89(0x24f)),_0x96cd33[_0x53fd89(0x263)](_0x53fd89(0x1f8));}catch(_0x26737c){console[_0x53fd89(0x28b)](_0x26737c);}}),router[a0_0x504112(0x1be)](a0_0x504112(0x2a5),auth,async(_0x9abc08,_0x3e2157)=>{var _0x25014c=a0_0x504112;try{const _0x2b8843=_0x9abc08[_0x25014c(0x1de)]['id'],{invoice:_0xa26583,suppliers:_0x485d55,payable:_0x321cc3,due_amount:_0x5ad744}=_0x9abc08[_0x25014c(0x224)],_0x579d29=await purchases[_0x25014c(0x298)](_0x2b8843);var _0x3dfb16=_0x321cc3-_0x5ad744;_0x579d29[_0x25014c(0x1bd)]=parseFloat(_0x579d29[_0x25014c(0x1bd)])+parseFloat(_0x5ad744),_0x579d29['due_amount']=_0x3dfb16;const _0x4d8b02=await _0x579d29[_0x25014c(0x23f)]();console['log'](_0x4d8b02);const _0x17f8b1=await s_payment_data[_0x25014c(0x21a)]({'invoice':_0xa26583});_0x17f8b1['amount']=_0x3dfb16,await _0x17f8b1[_0x25014c(0x23f)]();let _0x213b6a=new Date(),_0x5e1d45=('0'+_0x213b6a[_0x25014c(0x259)]())[_0x25014c(0x25d)](-0x2),_0x2a8681=('0'+(_0x213b6a[_0x25014c(0x282)]()+0x1))[_0x25014c(0x25d)](-0x2),_0x45cef5=_0x213b6a[_0x25014c(0x265)](),_0x47e7b2=_0x45cef5+'-'+_0x2a8681+'-'+_0x5e1d45;const _0x13fb06=new suppliers_payment({'invoice':_0xa26583,'date':_0x45cef5+'-'+_0x2a8681+'-'+_0x5e1d45,'suppliers':_0x485d55,'reason':_0x25014c(0x29f),'amount':_0x5ad744}),_0x53dc6e=await _0x13fb06[_0x25014c(0x23f)]();_0x9abc08[_0x25014c(0x288)](_0x25014c(0x292),_0x25014c(0x221)),_0x3e2157[_0x25014c(0x263)](_0x25014c(0x1f8));}catch(_0x4fb129){console[_0x25014c(0x28b)](_0x4fb129);}}),router['get'](a0_0x504112(0x2a2),auth,async(_0x18c753,_0x38de58)=>{var _0x2c1350=a0_0x504112;try{const {username:_0x83484f,email:_0x26b28e,role:_0x223024}=_0x18c753['user'],_0x7015b=_0x18c753[_0x2c1350(0x1c4)],_0x39c236=await profile[_0x2c1350(0x21a)]({'email':_0x7015b[_0x2c1350(0x286)]}),_0x4c04f2=await master_shop[_0x2c1350(0x251)]();console[_0x2c1350(0x28b)](_0x2c1350(0x26f),_0x4c04f2);const _0x58b284=_0x18c753[_0x2c1350(0x1de)]['id'],_0x45791d=await purchases['findById'](_0x58b284);console[_0x2c1350(0x28b)](_0x45791d);const _0x141804=await suppliers[_0x2c1350(0x21a)]({'name':_0x45791d[_0x2c1350(0x22d)]});console[_0x2c1350(0x28b)](_0x141804);if(_0x4c04f2[0x0]['language']==_0x2c1350(0x276)){var _0x3fbf70=users[_0x2c1350(0x1ac)];console[_0x2c1350(0x28b)](_0x3fbf70);}else{if(_0x4c04f2[0x0][_0x2c1350(0x1d4)]==_0x2c1350(0x234))var _0x3fbf70=users[_0x2c1350(0x234)];else{if(_0x4c04f2[0x0][_0x2c1350(0x1d4)]==_0x2c1350(0x1c8))var _0x3fbf70=users['German'];else{if(_0x4c04f2[0x0][_0x2c1350(0x1d4)]==_0x2c1350(0x253))var _0x3fbf70=users[_0x2c1350(0x253)];else{if(_0x4c04f2[0x0][_0x2c1350(0x1d4)]==_0x2c1350(0x1a7))var _0x3fbf70=users[_0x2c1350(0x1a7)];else{if(_0x4c04f2[0x0]['language']==_0x2c1350(0x27b))var _0x3fbf70=users[_0x2c1350(0x258)];else{if(_0x4c04f2[0x0]['language']==_0x2c1350(0x1ae))var _0x3fbf70=users[_0x2c1350(0x1ae)];else{if(_0x4c04f2[0x0][_0x2c1350(0x1d4)]==_0x2c1350(0x2b4))var _0x3fbf70=users[_0x2c1350(0x25e)];}}}}}}}_0x38de58['render'](_0x2c1350(0x1bc),{'success':_0x18c753[_0x2c1350(0x288)]('success'),'errors':_0x18c753[_0x2c1350(0x288)]('errors'),'role':_0x7015b,'profile':_0x39c236,'master_shop':_0x4c04f2,'supplier':_0x141804,'purchase':_0x45791d,'language':_0x3fbf70});}catch(_0x347d28){console[_0x2c1350(0x28b)](_0x347d28);}}),router[a0_0x504112(0x1aa)](a0_0x504112(0x1e1),auth,async(_0x55b36a,_0x4a412d)=>{var _0x54e063=a0_0x504112;try{const {username:_0x48032a,email:_0x405817,role:_0x28b907}=_0x55b36a[_0x54e063(0x1c4)],_0x22958f=_0x55b36a['user'],_0x3592f4=await profile[_0x54e063(0x21a)]({'email':_0x22958f['email']}),_0x3898b6=await master_shop[_0x54e063(0x251)]();console[_0x54e063(0x28b)](_0x54e063(0x26f),_0x3898b6);const _0x2a0c22=_0x55b36a['params']['id'];console[_0x54e063(0x28b)](_0x2a0c22);const _0x1ce3ec=await purchases[_0x54e063(0x298)](_0x2a0c22);console['log'](_0x54e063(0x242),_0x1ce3ec);const _0x156bda=await product[_0x54e063(0x251)]({}),_0x44cfb6=await warehouse[_0x54e063(0x1c1)]([{'$match':{'name':_0x1ce3ec[_0x54e063(0x247)],'room':_0x1ce3ec['room'],'warehouse_category':_0x54e063(0x212)}},{'$unwind':_0x54e063(0x2ad)},{'$group':{'_id':_0x54e063(0x273),'name':{'$first':_0x54e063(0x1d7)},'product_stock':{'$first':_0x54e063(0x20d)},'bay':{'$first':_0x54e063(0x29b)},'bin':{'$first':_0x54e063(0x266)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x54e063(0x19c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x54e063(0x275)},'rack':{'$first':_0x54e063(0x1f0)}}}]);warehouse_data=await warehouse[_0x54e063(0x1c1)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x54e063(0x212)}},{'$group':{'_id':_0x54e063(0x1ba),'name':{'$first':_0x54e063(0x1ba)}}},{'$sort':{'name':0x1}}]),console['log'](_0x54e063(0x248),_0x44cfb6);if(_0x3898b6[0x0][_0x54e063(0x1d4)]=='English\x20(US)'){var _0x3c8300=users[_0x54e063(0x1ac)];console[_0x54e063(0x28b)](_0x3c8300);}else{if(_0x3898b6[0x0][_0x54e063(0x1d4)]==_0x54e063(0x234))var _0x3c8300=users[_0x54e063(0x234)];else{if(_0x3898b6[0x0][_0x54e063(0x1d4)]=='German')var _0x3c8300=users[_0x54e063(0x1c8)];else{if(_0x3898b6[0x0]['language']=='Spanish')var _0x3c8300=users[_0x54e063(0x253)];else{if(_0x3898b6[0x0][_0x54e063(0x1d4)]==_0x54e063(0x1a7))var _0x3c8300=users[_0x54e063(0x1a7)];else{if(_0x3898b6[0x0][_0x54e063(0x1d4)]=='Portuguese\x20(BR)')var _0x3c8300=users[_0x54e063(0x258)];else{if(_0x3898b6[0x0][_0x54e063(0x1d4)]=='Chinese')var _0x3c8300=users[_0x54e063(0x1ae)];else{if(_0x3898b6[0x0][_0x54e063(0x1d4)]==_0x54e063(0x2b4))var _0x3c8300=users['Arabic'];}}}}}}}_0x4a412d[_0x54e063(0x1bb)]('return_purchase',{'success':_0x55b36a[_0x54e063(0x288)](_0x54e063(0x292)),'errors':_0x55b36a['flash']('errors'),'role':_0x22958f,'profile':_0x3592f4,'user':_0x1ce3ec,'stock':_0x44cfb6,'master_shop':_0x3898b6,'product':_0x156bda,'language':_0x3c8300,'warehouse':warehouse_data});}catch(_0xdb3b20){console[_0x54e063(0x28b)](_0xdb3b20);}}),router[a0_0x504112(0x1be)](a0_0x504112(0x1e1),auth,async(_0x3d8fa4,_0x11b242)=>{var _0x5e8812=a0_0x504112;try{const {invoice:_0x283d5b,date:_0xa96876,warehouse_name:_0x293f6e,Room_name:_0x5c39e5,product_name:_0xe9dbd4,purchase_quantity:_0x3c14dc,stocks:_0x5ee45b,return_qty:_0x3d24f4,note:_0x241e49,level:_0x1ef1db,isle:_0x5650cb,pallet:_0x4efc22,to_warehouse_name:_0x5c82b7,to_Room_name:_0x2b2a23}=_0x3d8fa4[_0x5e8812(0x224)],_0x216fa6=await purchases[_0x5e8812(0x21a)]({'_id':_0x3d8fa4[_0x5e8812(0x1de)]['id']}),_0x2a241d=await warehouse[_0x5e8812(0x21a)]({'name':_0x293f6e,'room':_0x5c39e5});if(typeof _0xe9dbd4==_0x5e8812(0x1d8))var _0x20bf72=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x1f9)]],_0x23559f=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x269)]],_0x11895b=[_0x3d8fa4['body']['stocks']],_0x57a798=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x271)]],_0x2a4b85=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x19a)]],_0x222cb9=[_0x3d8fa4[_0x5e8812(0x224)]['isle']],_0x58002e=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x2ae)]],_0xa13325=[_0x3d8fa4['body'][_0x5e8812(0x1e3)]],_0x83f965=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x1e6)]],_0xebe42=[_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x207)]],_0xd92980=[_0x3d8fa4['body'][_0x5e8812(0x1df)]];else var _0x20bf72=[..._0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x1f9)]],_0x23559f=[..._0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x269)]],_0x11895b=[..._0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x26a)]],_0x57a798=[..._0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x271)]],_0x2a4b85=[..._0x3d8fa4['body'][_0x5e8812(0x19a)]],_0x222cb9=[..._0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x2a0)]],_0x58002e=[..._0x3d8fa4['body'][_0x5e8812(0x2ae)]],_0xa13325=[..._0x3d8fa4[_0x5e8812(0x224)]['types']],_0x83f965=[..._0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x1e6)]],_0xebe42=[..._0x3d8fa4['body'][_0x5e8812(0x207)]],_0xd92980=[..._0x3d8fa4['body'][_0x5e8812(0x1df)]];const _0x10171c=_0x20bf72[_0x5e8812(0x1a9)](_0x54566a=>{return _0x54566a={'product_name':_0x54566a};});_0x23559f[_0x5e8812(0x1ff)]((_0x10d8bb,_0x394a4e)=>{_0x10171c[_0x394a4e]['purchase_quantity']=_0x10d8bb;}),_0x11895b[_0x5e8812(0x1ff)]((_0x4e74f4,_0x44bc2d)=>{var _0x5cc7cb=_0x5e8812;_0x10171c[_0x44bc2d][_0x5cc7cb(0x241)]=_0x4e74f4;}),_0x57a798[_0x5e8812(0x1ff)]((_0x5b0dd9,_0x8fe543)=>{var _0x54d758=_0x5e8812;_0x10171c[_0x8fe543][_0x54d758(0x271)]=_0x5b0dd9;}),_0x2a4b85[_0x5e8812(0x1ff)]((_0x3b6beb,_0x4e2d44)=>{var _0x37d770=_0x5e8812;_0x10171c[_0x4e2d44][_0x37d770(0x238)]=_0x3b6beb;}),_0x222cb9[_0x5e8812(0x1ff)]((_0x32d951,_0x276f5e)=>{var _0x4ea280=_0x5e8812;_0x10171c[_0x276f5e][_0x4ea280(0x1f7)]=_0x32d951;}),_0x58002e[_0x5e8812(0x1ff)]((_0x2d751a,_0x26636f)=>{_0x10171c[_0x26636f]['floorlevel']=_0x2d751a;}),_0xa13325[_0x5e8812(0x1ff)]((_0x6a4481,_0x49f1c6)=>{var _0x3c0a7e=_0x5e8812;_0x10171c[_0x49f1c6][_0x3c0a7e(0x1f6)]=_0x6a4481;}),_0x83f965[_0x5e8812(0x1ff)]((_0x5b9631,_0x25c66a)=>{var _0x29a312=_0x5e8812;_0x10171c[_0x25c66a][_0x29a312(0x294)]=_0x5b9631;}),_0xebe42[_0x5e8812(0x1ff)]((_0x56cc30,_0x5d42a1)=>{_0x10171c[_0x5d42a1]['primary_code']=_0x56cc30;}),_0xd92980['forEach']((_0x2fdc61,_0x5c0781)=>{var _0x908ff6=_0x5e8812;_0x10171c[_0x5c0781][_0x908ff6(0x1e2)]=_0x2fdc61;}),_0x216fa6['product'][_0x5e8812(0x1ff)](_0x410d5c=>{var _0x3fb3e1=_0x5e8812;const _0x5ebd98=_0x2a241d[_0x3fb3e1(0x2ab)][_0x3fb3e1(0x1a9)](_0x1a85f2=>{var _0x462448=_0x3fb3e1;_0x1a85f2[_0x462448(0x1f9)]==_0x410d5c[_0x462448(0x1f9)]&&_0x1a85f2[_0x462448(0x1ab)]==_0x410d5c[_0x462448(0x1ab)]&&_0x1a85f2[_0x462448(0x1f6)]==_0x410d5c[_0x462448(0x1f6)]&&_0x1a85f2['bin']==_0x410d5c[_0x462448(0x1f7)]&&_0x1a85f2['bay']==_0x410d5c[_0x462448(0x238)]&&_0x1a85f2[_0x462448(0x281)]==_0x410d5c[_0x462448(0x281)]&&_0x1a85f2[_0x462448(0x1a0)]==_0x410d5c[_0x462448(0x1a0)]&&(console[_0x462448(0x28b)](parseInt(_0x1a85f2[_0x462448(0x27a)])+_0x462448(0x1c0)+parseInt(_0x410d5c['quantity'])),_0x1a85f2[_0x462448(0x27a)]=parseInt(_0x1a85f2[_0x462448(0x27a)])+parseInt(_0x410d5c[_0x462448(0x254)]));});}),await _0x2a241d[_0x5e8812(0x23f)]();const _0x3dd36b=_0x10171c[_0x5e8812(0x235)](_0x1e5b74=>_0x1e5b74[_0x5e8812(0x271)]!=='0'&&_0x1e5b74[_0x5e8812(0x271)]!=='');var _0x4d9c88=0x0;_0x3dd36b[_0x5e8812(0x1ff)](_0x3a05ab=>{var _0x31602e=_0x5e8812;console['log'](_0x31602e(0x27d),_0x3a05ab),(parseInt(_0x3a05ab[_0x31602e(0x269)])<parseInt(_0x3a05ab[_0x31602e(0x271)])||parseInt(_0x3a05ab[_0x31602e(0x241)])<parseInt(_0x3a05ab[_0x31602e(0x271)]))&&_0x4d9c88++;});if(_0x4d9c88!=0x0)return _0x3d8fa4[_0x5e8812(0x288)](_0x5e8812(0x1a2),_0x5e8812(0x283)),_0x11b242[_0x5e8812(0x263)](_0x5e8812(0x18c));const _0x504249=new purchases_return({'invoice':_0x283d5b,'suppliers':_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x22d)],'date':_0xa96876,'warehouse_name':_0x293f6e,'return_product':_0x3dd36b,'note':_0x241e49,'room':_0x5c39e5,'to_warehouse_name':_0x5c82b7,'to_room':_0x2b2a23}),_0x69d804=await _0x504249[_0x5e8812(0x23f)]();console[_0x5e8812(0x28b)](_0x504249);const _0x3275fe=await purchases_return[_0x5e8812(0x21a)]({'invoice':_0x283d5b}),_0x406874=await warehouse[_0x5e8812(0x21a)]({'name':_0x5c82b7,'room':_0x2b2a23});_0x3275fe[_0x5e8812(0x1e8)][_0x5e8812(0x1ff)](_0x2e3cb4=>{var _0x36e86a=_0x5e8812,_0x4921a2=0x0;const _0x4862f2=_0x406874[_0x36e86a(0x2ab)][_0x36e86a(0x1a9)](_0x1eb7d6=>{var _0x504919=_0x36e86a;_0x1eb7d6[_0x504919(0x1f9)]==_0x2e3cb4['product_name']&&_0x1eb7d6[_0x504919(0x1ab)]==_0x2e3cb4[_0x504919(0x1ab)]&&_0x1eb7d6[_0x504919(0x1f6)]==_0x2e3cb4[_0x504919(0x1f6)]&&_0x1eb7d6['bin']==_0x2e3cb4[_0x504919(0x1f7)]&&_0x1eb7d6[_0x504919(0x238)]==_0x2e3cb4[_0x504919(0x238)]&&(_0x1eb7d6[_0x504919(0x27a)]=parseInt(_0x1eb7d6[_0x504919(0x27a)])-parseInt(_0x2e3cb4[_0x504919(0x271)]),_0x4921a2++);});_0x4921a2=='0'&&(_0x406874['product_details']=_0x406874[_0x36e86a(0x2ab)]['concat']({'product_name':_0x2e3cb4[_0x36e86a(0x1f9)],'product_stock':_0x2e3cb4['return_qty'],'primary_code':_0x2e3cb4[_0x36e86a(0x1b3)],'secondary_code':_0x2e3cb4[_0x36e86a(0x1e2)],'product_code':_0x2e3cb4[_0x36e86a(0x294)],'storage':_0x2e3cb4[_0x36e86a(0x1a0)],'rack':_0x2e3cb4['rack'],'bay':_0x2e3cb4[_0x36e86a(0x238)],'bin':_0x2e3cb4[_0x36e86a(0x1f7)],'type':_0x2e3cb4[_0x36e86a(0x1f6)],'floorlevel':_0x2e3cb4[_0x36e86a(0x1ab)],'maxProducts':_0x2e3cb4[_0x36e86a(0x20a)],'unit':_0x2e3cb4[_0x36e86a(0x1a5)],'secondary_unit':_0x2e3cb4[_0x36e86a(0x264)],'expiry_date':_0x2e3cb4[_0x36e86a(0x243)]}));}),await _0x406874[_0x5e8812(0x23f)]();const _0xf310de=await purchases[_0x5e8812(0x21a)]({'invoice':_0x283d5b});_0xf310de[_0x5e8812(0x249)]=_0x5e8812(0x1cf);const _0x5853dc=await _0xf310de['save'](),_0x4776ac=new s_payment_data({'invoice':_0x283d5b,'suppliers':_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x22d)],'reason':_0x5e8812(0x1f3)});await _0x4776ac['save']();const _0x35fa37=await master_shop['find']();console[_0x5e8812(0x28b)](_0x5e8812(0x24e),_0x35fa37[0x0]['image']);const _0x2826ec=await email_settings[_0x5e8812(0x21a)](),_0x54a2f1=await suppliers['findOne']({'name':_0x3d8fa4[_0x5e8812(0x224)][_0x5e8812(0x22d)]});console['log'](_0x5e8812(0x18f),_0x54a2f1);_0x35fa37[0x0]['currency_placement']==0x1?(right_currency=_0x35fa37[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x35fa37[0x0][_0x5e8812(0x268)]);var _0xdbe914=_0x20bf72,_0x40679e=_0x57a798,_0x4fe36c='',_0x23b00f;for(_0x23b00f in _0xdbe914){_0x4fe36c+=_0x5e8812(0x28e)+_0x5e8812(0x24c)+_0xdbe914[_0x23b00f]+'</td>'+_0x5e8812(0x24c)+_0x40679e[_0x23b00f]+'</td>'+_0x5e8812(0x1b6);}console['log'](_0x5e8812(0x1cd),_0x4fe36c);let _0x5762d9=nodemailer[_0x5e8812(0x26d)]({'service':_0x5e8812(0x21c),'auth':{'user':_0x2826ec['email'],'pass':_0x2826ec[_0x5e8812(0x290)]}}),_0x3fc97b={'from':_0x2826ec[_0x5e8812(0x286)],'to':_0x54a2f1[_0x5e8812(0x286)],'subject':_0x5e8812(0x1c5),'attachments':[{'filename':_0x5e8812(0x2b5),'path':__dirname+_0x5e8812(0x1f1)+_0x5e8812(0x23a)+_0x35fa37[0x0][_0x5e8812(0x287)],'cid':_0x5e8812(0x261)}],'html':_0x5e8812(0x1e5)+_0x5e8812(0x1d9)+'</head><body>'+_0x5e8812(0x1b2)+_0x5e8812(0x2a3)+_0x5e8812(0x1b2)+_0x5e8812(0x1dd)+_0x5e8812(0x203)+_0x5e8812(0x1b2)+_0x5e8812(0x299)+_0x35fa37[0x0]['site_title']+_0x5e8812(0x26b)+_0x5e8812(0x203)+_0x5e8812(0x203)+_0x5e8812(0x210)+_0x5e8812(0x1b2)+_0x5e8812(0x200)+_0x5e8812(0x250)+_0x283d5b+'\x20'+_0x5e8812(0x22b)+_0x5e8812(0x1d3)+_0xa96876+'\x20'+'</span>'+_0x5e8812(0x1b7)+_0x5e8812(0x203)+_0x5e8812(0x192)+_0x5e8812(0x196)+_0x5e8812(0x28e)+_0x5e8812(0x29d)+_0x5e8812(0x1ee)+_0x5e8812(0x26c)+_0x5e8812(0x20c)+'</tr>'+'</thead>'+_0x5e8812(0x23e)+'\x20'+_0x4fe36c+'\x20'+_0x5e8812(0x1ed)+_0x5e8812(0x205)+'<div>'+_0x5e8812(0x19f)+_0x5e8812(0x1af)+_0x35fa37[0x0][_0x5e8812(0x260)]+_0x5e8812(0x1b7)+_0x5e8812(0x203)+_0x5e8812(0x203)+_0x5e8812(0x230)};_0x5762d9[_0x5e8812(0x1f5)](_0x3fc97b,function(_0x245e2b,_0x1d9fe5){var _0x1b670b=_0x5e8812;_0x245e2b?(console[_0x1b670b(0x28b)](_0x245e2b),console[_0x1b670b(0x28b)](_0x1b670b(0x1fc))):console[_0x1b670b(0x28b)](_0x1b670b(0x1a1));}),_0x3d8fa4[_0x5e8812(0x288)](_0x5e8812(0x292),_0x5e8812(0x1c9)),_0x11b242[_0x5e8812(0x263)](_0x5e8812(0x1f8));}catch(_0x4b67af){console['log'](_0x4b67af),_0x11b242['status'](0xc8)[_0x5e8812(0x223)]({'message':_0x4b67af['message']});}}),router[a0_0x504112(0x1aa)](a0_0x504112(0x267),auth,async(_0x1451ea,_0x53aefe)=>{var _0x23c24f=a0_0x504112;try{const {username:_0x3724af,email:_0x3dadd6,role:_0x540fe7}=_0x1451ea[_0x23c24f(0x1c4)],_0x22561d=_0x1451ea[_0x23c24f(0x1c4)],_0x2108a4=await profile[_0x23c24f(0x21a)]({'email':_0x22561d[_0x23c24f(0x286)]}),_0x5125a4=await master_shop['find'](),_0x284fcf=_0x1451ea[_0x23c24f(0x1de)]['id'],_0x56c395=await purchases[_0x23c24f(0x298)](_0x284fcf);if(_0x5125a4[0x0]['language']=='English\x20(US)')var _0x1f918e=users[_0x23c24f(0x1ac)];else{if(_0x5125a4[0x0][_0x23c24f(0x1d4)]=='Hindi')var _0x1f918e=users['Hindi'];else{if(_0x5125a4[0x0][_0x23c24f(0x1d4)]==_0x23c24f(0x1c8))var _0x1f918e=users[_0x23c24f(0x1c8)];else{if(_0x5125a4[0x0]['language']=='Spanish')var _0x1f918e=users[_0x23c24f(0x253)];else{if(_0x5125a4[0x0]['language']==_0x23c24f(0x1a7))var _0x1f918e=users[_0x23c24f(0x1a7)];else{if(_0x5125a4[0x0]['language']==_0x23c24f(0x27b))var _0x1f918e=users[_0x23c24f(0x258)];else{if(_0x5125a4[0x0][_0x23c24f(0x1d4)]==_0x23c24f(0x1ae))var _0x1f918e=users[_0x23c24f(0x1ae)];else{if(_0x5125a4[0x0][_0x23c24f(0x1d4)]==_0x23c24f(0x2b4))var _0x1f918e=users[_0x23c24f(0x25e)];}}}}}}}_0x53aefe[_0x23c24f(0x1bb)](_0x23c24f(0x1d5),{'success':_0x1451ea[_0x23c24f(0x288)]('success'),'errors':_0x1451ea[_0x23c24f(0x288)](_0x23c24f(0x1a2)),'role':_0x22561d,'profile':_0x2108a4,'alldata':_0x56c395,'master_shop':_0x5125a4,'language':_0x1f918e}),console['log'](alldata);}catch(_0x21ef34){console[_0x23c24f(0x28b)](_0x21ef34);}}),router['post'](a0_0x504112(0x1b9),async(_0x54370a,_0x555026)=>{var _0x2c16a4=a0_0x504112;const {product_code:_0x141399}=_0x54370a['body'];var _0x59a87f;const _0x42ee78=await product[_0x2c16a4(0x1c1)]([{'$match':{'primary_code':_0x141399,'product_category':_0x2c16a4(0x212)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x2c16a4(0x215)},'brand':{'$first':'$brand'},'unit':{'$first':_0x2c16a4(0x2aa)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x2c16a4(0x1c7)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2c16a4(0x209)},'maxProdPerUnit':{'$first':_0x2c16a4(0x2a1)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2c16a4(0x1e9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xcc2b08=await product[_0x2c16a4(0x1c1)]([{'$match':{'secondary_code':_0x141399,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x2c16a4(0x27f),'name':{'$first':_0x2c16a4(0x1ba)},'category':{'$first':'$category'},'brand':{'$first':_0x2c16a4(0x279)},'unit':{'$first':_0x2c16a4(0x2aa)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2c16a4(0x1cb)},'primary_code':{'$first':_0x2c16a4(0x1c7)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x2c16a4(0x209)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2c16a4(0x1e9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x42ee78[_0x2c16a4(0x28c)]>0x0)_0x59a87f=_0x42ee78;else _0xcc2b08[_0x2c16a4(0x28c)]>0x0&&(_0x59a87f=_0xcc2b08);_0x555026['json'](_0x59a87f);}),router['post'](a0_0x504112(0x222),async(_0x275396,_0x29d1ad)=>{var _0x3bae3c=a0_0x504112;const {primaryCode:_0x588015,secondaryCode:_0x233335,productCode:_0x3e3fda,bay:_0x5c77f5,bin:_0x3d8a2e,types:_0x577323,pallet:_0x15579f,warehouses:_0x55c060,room:_0x53b2fb}=_0x275396['body'];console[_0x3bae3c(0x28b)](_0x275396[_0x3bae3c(0x224)]);try{const _0x197b0d=await warehouse[_0x3bae3c(0x1c1)]([{'$match':{'name':_0x55c060,'room':_0x53b2fb}},{'$unwind':_0x3bae3c(0x2ad)},{'$match':{'product_details.bay':_0x5c77f5,'product_details.bin':_0x3d8a2e,'product_details.type':_0x577323}},{'$group':{'_id':_0x3bae3c(0x273),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x3bae3c(0x217)},'isle':{'$first':_0x3bae3c(0x245)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x3bae3c(0x2a7)}}}]);_0x29d1ad[_0x3bae3c(0x1fe)](0xc8)['json'](_0x197b0d);}catch(_0x2c7606){_0x29d1ad['status'](0x194)[_0x3bae3c(0x223)]({'message':_0x2c7606[_0x3bae3c(0x225)]});}}),module[a0_0x504112(0x274)]=router;