function a0_0x1fb7(_0x2ae744,_0x56ff00){var _0x502cda=a0_0x502c();return a0_0x1fb7=function(_0x1fb739,_0x1e0803){_0x1fb739=_0x1fb739-0xd2;var _0x437761=_0x502cda[_0x1fb739];return _0x437761;},a0_0x1fb7(_0x2ae744,_0x56ff00);}var a0_0xce45da=a0_0x1fb7;(function(_0x26736f,_0xbfa23b){var _0x11ebc6=a0_0x1fb7,_0x74760e=_0x26736f();while(!![]){try{var _0x275cbc=-parseInt(_0x11ebc6(0x137))/0x1+-parseInt(_0x11ebc6(0x12d))/0x2+parseInt(_0x11ebc6(0xfb))/0x3+-parseInt(_0x11ebc6(0x187))/0x4+parseInt(_0x11ebc6(0x107))/0x5+-parseInt(_0x11ebc6(0x129))/0x6+parseInt(_0x11ebc6(0x1d5))/0x7;if(_0x275cbc===_0xbfa23b)break;else _0x74760e['push'](_0x74760e['shift']());}catch(_0xa9b77d){_0x74760e['push'](_0x74760e['shift']());}}}(a0_0x502c,0xf2730));const express=require(a0_0xce45da(0x1b6)),app=express(),router=express[a0_0xce45da(0xfc)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0xce45da(0x1a5)),auth=require(a0_0xce45da(0x105)),nodemailer=require(a0_0xce45da(0x1bd));var ejs=require(a0_0xce45da(0x12f));const path=require(a0_0xce45da(0x1c9)),users=require(a0_0xce45da(0x118));router[a0_0xce45da(0x1d1)]('/view',auth,async(_0x12b718,_0x3c8f88)=>{var _0x26dc7a=a0_0xce45da;try{const {username:_0x4d17b3,email:_0x24412d,role:_0x253e5c}=_0x12b718[_0x26dc7a(0x168)],_0x38502e=_0x12b718[_0x26dc7a(0x168)],_0x31136d=await profile[_0x26dc7a(0x13f)]({'email':_0x38502e[_0x26dc7a(0x1d8)]}),_0x41cb72=await staff['findOne']({'email':_0x38502e[_0x26dc7a(0x1d8)]});if(_0x38502e['role']=='staff'){const _0x2410e6=await staff[_0x26dc7a(0x13f)]({'email':_0x38502e[_0x26dc7a(0x1d8)]});}const _0x4cedf4=await master_shop[_0x26dc7a(0x16c)]();let _0x38aaf9;if(_0x38502e[_0x26dc7a(0x126)]=='staff'){const _0x4c47ae=await staff[_0x26dc7a(0x13f)]({'email':_0x38502e[_0x26dc7a(0x1d8)]});_0x38aaf9=await purchases[_0x26dc7a(0x1b5)]([{'$match':{'warehouse_name':_0x4c47ae[_0x26dc7a(0x141)]}},{'$lookup':{'from':_0x26dc7a(0x199),'localField':'suppliers','foreignField':'name','as':_0x26dc7a(0x1ac)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x26dc7a(0x104)},{'$group':{'_id':_0x26dc7a(0x1d2),'invoice':{'$first':_0x26dc7a(0x190)},'suppliers':{'$first':_0x26dc7a(0xf0)},'date':{'$first':_0x26dc7a(0x164)},'warehouse_name':{'$first':_0x26dc7a(0xfd)},'room':{'$first':_0x26dc7a(0x174)},'product':{'$push':_0x26dc7a(0x104)},'note':{'$first':_0x26dc7a(0x197)},'paid_amount':{'$first':_0x26dc7a(0x145)},'due_amount':{'$first':_0x26dc7a(0x15b)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x26dc7a(0x130)},'expiry_date':{'$first':_0x26dc7a(0x192)},'suppliers_docs':{'$first':_0x26dc7a(0x149)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x26dc7a(0x10d)},'floorlevel':{'$addToSet':_0x26dc7a(0x1c5)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x38aaf9=await purchases[_0x26dc7a(0x1b5)]([{'$lookup':{'from':_0x26dc7a(0x199),'localField':_0x26dc7a(0x199),'foreignField':_0x26dc7a(0x1eb),'as':_0x26dc7a(0x1ac)}},{'$unwind':_0x26dc7a(0x149)},{'$unwind':_0x26dc7a(0x104)},{'$group':{'_id':_0x26dc7a(0x1d2),'invoice':{'$first':'$invoice'},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x26dc7a(0x164)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x26dc7a(0x19b)},'product':{'$push':_0x26dc7a(0x104)},'note':{'$first':_0x26dc7a(0x197)},'paid_amount':{'$first':_0x26dc7a(0x145)},'due_amount':{'$first':_0x26dc7a(0x15b)},'return_data':{'$first':_0x26dc7a(0x1e1)},'batch_code':{'$first':_0x26dc7a(0x130)},'expiry_date':{'$first':_0x26dc7a(0x192)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x26dc7a(0x14f)},'level':{'$addToSet':_0x26dc7a(0x19d)},'isle':{'$addToSet':_0x26dc7a(0x1ae)},'type':{'$addToSet':_0x26dc7a(0x10d)},'floorlevel':{'$addToSet':_0x26dc7a(0x1c5)},'finalize':{'$first':_0x26dc7a(0x1ab)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x4cedf4[0x0][_0x26dc7a(0x136)]=='English\x20(US)'){var _0x3c5d64=users[_0x26dc7a(0x18e)];console[_0x26dc7a(0x12c)](_0x3c5d64);}else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]==_0x26dc7a(0x1da))var _0x3c5d64=users['Hindi'];else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]==_0x26dc7a(0xe4))var _0x3c5d64=users[_0x26dc7a(0xe4)];else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]==_0x26dc7a(0x1e2))var _0x3c5d64=users['Spanish'];else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]==_0x26dc7a(0x140))var _0x3c5d64=users[_0x26dc7a(0x140)];else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]=='Portuguese\x20(BR)')var _0x3c5d64=users['Portuguese'];else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]==_0x26dc7a(0x14c))var _0x3c5d64=users[_0x26dc7a(0x14c)];else{if(_0x4cedf4[0x0][_0x26dc7a(0x136)]==_0x26dc7a(0x142))var _0x3c5d64=users[_0x26dc7a(0x1e7)];}}}}}}}_0x3c8f88[_0x26dc7a(0x171)]('all_purchases',{'success':_0x12b718[_0x26dc7a(0xea)](_0x26dc7a(0x19c)),'errors':_0x12b718[_0x26dc7a(0xea)](_0x26dc7a(0x1b2)),'purchases':_0x38aaf9,'role':_0x38502e,'profile':_0x31136d,'master_shop':_0x4cedf4,'language':_0x3c5d64});}catch(_0x4af402){console[_0x26dc7a(0x12c)]('table\x20page',_0x4af402),_0x3c8f88[_0x26dc7a(0x162)](0xc8)[_0x26dc7a(0x143)]({'message':_0x4af402[_0x26dc7a(0x193)]});}});function BayBinSelected(_0x47edbc,_0x4a26a6){var _0x1205af=a0_0xce45da,_0xd933e5=[],_0xf6953a=[],_0x21e73a=[],_0x1e53ba=[],_0x155b50=[],_0x3e6bc4=[];let _0xb9610f=[];if(_0x47edbc==_0x1205af(0xe6))switch(_0x4a26a6){case'Rack\x20A':_0xd933e5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0xf6953a=[0x1,0x2],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=[_0x1205af(0x102),_0x1205af(0xe1)],_0x155b50=['D'],_0x3e6bc4=['A'];break;case _0x1205af(0x1cc):_0xd933e5=[0x6,0x5,0x4,0x3,0x2,0x1],_0xf6953a=[0x1,0x2],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=['Level',_0x1205af(0xe1)],_0x155b50=['D'],_0x3e6bc4=['B'];break;case _0x1205af(0x1ee):_0xd933e5=[0x0],_0xf6953a=[0x0],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=[_0x1205af(0xe1)],_0x155b50=['D'],_0x3e6bc4=['S'];break;case _0x1205af(0x116):_0xd933e5=[0x0],_0xf6953a=[0x0],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x21e73a=[_0x1205af(0xe1)],_0x155b50=['D'],_0x3e6bc4=['R'];break;}else{if(_0x47edbc=='COLD\x20STORAGE')switch(_0x4a26a6){case'Rack\x20A':_0xd933e5=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0xf6953a=['B','F'],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=[_0x1205af(0x102),_0x1205af(0xe1)],_0x155b50=['C'],_0x3e6bc4=['A'];break;case'Rack\x20B':_0xd933e5=[0x5,0x4,0x3,0x2,0x1],_0xf6953a=['F','B','S'],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=[_0x1205af(0x102),_0x1205af(0xe1)],_0x155b50=['C'],_0x3e6bc4=['B'];break;case _0x1205af(0x1ec):_0xd933e5=[0x1,0x2,0x3,0x4,0x5],_0xf6953a=['B','F','S'],_0x1e53ba=[0x5,0x4,0x3,0x2,0x1],_0x21e73a=[_0x1205af(0x102),_0x1205af(0xe1)],_0x155b50=['C'],_0x3e6bc4=['C'];break;case _0x1205af(0x166):_0xd933e5=[0x5,0x4,0x3,0x2,0x1],_0xf6953a=['F','B','S'],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=['Level',_0x1205af(0xe1)],_0x155b50=['C'],_0x3e6bc4=['D'];break;case _0x1205af(0x18d):_0xd933e5=[0x4,0x3,0x2,0x1],_0xf6953a=[0x1,0x2],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=[_0x1205af(0x102),_0x1205af(0xe1)],_0x155b50=['C'],_0x3e6bc4=['E'];break;case _0x1205af(0xdb):_0xd933e5=[0x1,0x2,0x3],_0xf6953a=[0x1,0x2],_0x1e53ba=[0x1,0x2,0x3,0x4,0x5],_0x21e73a=[_0x1205af(0x102)],_0x155b50=['C'],_0x3e6bc4=['F'];break;}}return{'levels':_0xd933e5,'Isle':_0xf6953a,'rack':_0x1e53ba,'type':_0x21e73a,'storage':_0x155b50,'rak':_0x3e6bc4};}async function getRandom8DigitNumber(){var _0x3ed3ea=a0_0xce45da;const _0x1af3be=0x989680,_0x417e42=0x5f5e0ff,_0x54fdfe=Math[_0x3ed3ea(0x198)](Math['random']()*(_0x417e42-_0x1af3be+0x1))+_0x1af3be;var _0x1725fa;const _0x446126=await purchases[_0x3ed3ea(0x13f)]({'invoice':_0x3ed3ea(0x12a)+_0x54fdfe});return _0x446126&&_0x446126[_0x3ed3ea(0x153)]>0x0?_0x1725fa=_0x3ed3ea(0x12a)+_0x54fdfe:_0x1725fa='INC-'+_0x54fdfe,_0x1725fa;}function a0_0x502c(){var _0x18064d=['RoomAssign','<hr\x20class=\x22my-3\x22>','</div>','Email\x20sent\x20successfully','body','gmail','<span\x20style=\x22float:\x20right;\x22>','host','532520EIeEEv','</body></html>','createTransport','primary_code_hide','secondary_unit','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Rack\x20E','English','quantity','$invoice','return_data','$expiry_date','message','back','$secondary_unit','add\x20post','$note','floor','suppliers','prod_name','$product.room_name','success','$product.bay','post','<h5\x20style=\x22text-align:\x20left;\x22>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','slice','$maxStocks','<tr>','error','../models/all_models','JO_number','deliverydate','logo','/preview/:id','True','$finalize','suppliers_docs','\x20Order\x20Date\x20:\x20','$product.bin','warehouse_name','prod_secondunit','level','errors','return_product','$category','aggregate','express','$secondary_code','English\x20(US)','isle','return_purchase','<tbody\x20style=\x22text-align:\x20center;\x22>','delivery_date','nodemailer','stocks','purchases\x20item\x20return\x20successfull','primary_code','getMonth','</tr>','prod_level','$product_details.bin','$product.floorlevel','POnumber','date_data','$product_details.product_code','path','</span>','/invoice/:id','Rack\x20B','stock_data','</table>','return_qty','actual_uom','get','$_id','$product_details.bay','room_name','19581023tZmqmJ','toString','$product_details.product_name','email','purchase_quantity','Hindi','standard_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</head><body>','$product_details._id','exports','/view/add_purchases','$return_data','Spanish','Portuguese\x20(BR)','secondary_code_hide','product_list','invoice','Arabic','alertQTY','Portuguese','\x20<\x20wew\x20>\x20','name','Rack\x20C','purchase\x20data\x20update\x20successfully','Shelves','product_name','then','/../public','Paid\x20For\x20Purchase','type','port','maxperunit','$product_details.product_stock','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h5>','Rack\x20F','production_date','forEach','redirect','$brand','getDate','Floor','$product_details','push','German','</tbody>','DRY\x20STORAGE','room','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.secondary_code','flash','params','Enabled','\x20<>\x20','expiry_date','note','$suppliers','prod_isle','/all_purchases/view/','secondary_code','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','MaxStocks_data','/all_purchases/view','image','site_title','password','2405670fAFvQk','Router','$warehouse_name','bay','findById','prod_Qty','/barcode/:id','Level','finalize','$product','../middleware/auth','payment\x20successfull','2961735JCmFOO','</td>','due_amount','catch','purchase_invoice','$maxProdPerUnit','$product.type','padStart','$product_details.pallet','currency_placement','all','max_product_unit','storage','/view/add_purchases/:id','RMSEmail','Receiving\x20Area','$product_details.expiry_date','../public/language/languages.json','</h5>','save','add_purchases','rak','actual_qty','</thead>','batch_code','master','Return\x20Goods','Ambient','amount','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','role','/upload/','paid_amount','6622242nZZzeQ','INC-','product_stock','log','3097736PEwKSr','Error\x20Occurs','ejs','$batch_code','map','currency','$product_details.level','<strong>\x20Regards\x20</strong>','maxStocks','language','412749fbHgnG','$unit','all_purchases_barcode','stock_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product_code','\x20Order\x20Number\x20:\x20','findOne','French','warehouse','Arabic\x20(ae)','json','Purchase\x20Return','$paid_amount','$alertquantity','/view/:id','Raw\x20Materials','$suppliers_docs','/give_payment/:id','/barcode_scanner','Chinese','prod_invoice','prod_qty','$product.quantity','add_purchases\x20error','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Room_name','length','product_cat','getFullYear','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','deliverycode','prod_primunit','staff','prod_pallet','$due_amount','prod_unit','product_code_hide','floorlevel','prod_code','delivery_code','string','status','pallet','$date','product_details','Rack\x20D','$product_details.maxProducts','user','sendMail','foreach\x20newproduct','<html><head><title></title>','find','bin','$product_details.type','product_code','$product_details.rack','render','$name','rack','$room','filter','types','$primary_code','\x20</h2>','abs','$product_details.isle','product','/view/return_purchase/:id','<h2>\x20','concat'];a0_0x502c=function(){return _0x18064d;};return a0_0x502c();}router['get'](a0_0xce45da(0x1e0),auth,async(_0x41385c,_0x31108f)=>{var _0x24acb3=a0_0xce45da;try{const {username:_0xe63975,email:_0x4143a6,role:_0x396a8c}=_0x41385c[_0x24acb3(0x168)],_0x3792a8=_0x41385c['user'],_0x2a9581=await profile[_0x24acb3(0x13f)]({'email':_0x3792a8['email']}),_0x5a7589=await master_shop[_0x24acb3(0x16c)](),_0x34db1e=await staff[_0x24acb3(0x13f)]({'email':_0x3792a8['email']}),_0x9c1bf7=await suppliers[_0x24acb3(0x16c)]({});let _0x5c1aea;if(_0x3792a8[_0x24acb3(0x126)]=='staff'){const _0x319e73=await staff['findOne']({'email':_0x3792a8[_0x24acb3(0x1d8)]});_0x5c1aea=await warehouse[_0x24acb3(0x1b5)]([{'$match':{'status':_0x24acb3(0xec),'name':_0x319e73[_0x24acb3(0x141)],'warehouse_category':_0x24acb3(0x148),'name':{'$ne':_0x24acb3(0x121)}}},{'$group':{'_id':_0x24acb3(0x172),'name':{'$first':_0x24acb3(0x172)}}}]);}else _0x5c1aea=await warehouse[_0x24acb3(0x1b5)]([{'$match':{'status':_0x24acb3(0xec),'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x24acb3(0x172),'name':{'$first':_0x24acb3(0x172)}}}]);const _0x27ce09=await product[_0x24acb3(0x16c)]({}),_0x494924=await warehouse[_0x24acb3(0x16c)]({'status':_0x24acb3(0xec)}),_0x7c510a=await purchases[_0x24acb3(0x16c)]({}),_0x241ae2=_0x7c510a[_0x24acb3(0x153)]+0x1,_0x185e13=_0x24acb3(0x12a)+_0x241ae2[_0x24acb3(0x1d6)]()[_0x24acb3(0x10e)](0x5,'0');var _0xb4b9fb=[_0x24acb3(0x122),'Enclosed'];if(_0x5a7589[0x0][_0x24acb3(0x136)]=='English\x20(US)')var _0xdc2abe=users['English'];else{if(_0x5a7589[0x0][_0x24acb3(0x136)]==_0x24acb3(0x1da))var _0xdc2abe=users[_0x24acb3(0x1da)];else{if(_0x5a7589[0x0][_0x24acb3(0x136)]=='German')var _0xdc2abe=users[_0x24acb3(0xe4)];else{if(_0x5a7589[0x0]['language']==_0x24acb3(0x1e2))var _0xdc2abe=users[_0x24acb3(0x1e2)];else{if(_0x5a7589[0x0][_0x24acb3(0x136)]==_0x24acb3(0x140))var _0xdc2abe=users[_0x24acb3(0x140)];else{if(_0x5a7589[0x0]['language']==_0x24acb3(0x1e3))var _0xdc2abe=users[_0x24acb3(0x1e9)];else{if(_0x5a7589[0x0][_0x24acb3(0x136)]==_0x24acb3(0x14c))var _0xdc2abe=users['Chinese'];else{if(_0x5a7589[0x0][_0x24acb3(0x136)]==_0x24acb3(0x142))var _0xdc2abe=users['Arabic'];}}}}}}}const _0x5caf4d=getRandom8DigitNumber();_0x5caf4d[_0x24acb3(0x1f0)](_0x345c57=>{var _0x581d65=_0x24acb3;_0x31108f[_0x581d65(0x171)](_0x581d65(0x11b),{'success':_0x41385c[_0x581d65(0xea)](_0x581d65(0x19c)),'errors':_0x41385c['flash'](_0x581d65(0x1b2)),'role':_0x3792a8,'profile':_0x2a9581,'suppliers':_0x9c1bf7,'warehouse':_0x5c1aea,'product':_0x27ce09,'invoice':_0x345c57,'master_shop':_0x5a7589,'language':_0xdc2abe,'find_data':_0x494924,'rooms_data':_0xb4b9fb});})[_0x24acb3(0x10a)](_0x44fae6=>{var _0x57f01e=_0x24acb3;_0x41385c[_0x57f01e(0xea)](_0x57f01e(0x1b2),_0x57f01e(0x151)),_0x31108f[_0x57f01e(0xde)](_0x57f01e(0xf7));});}catch(_0x5d56f6){console[_0x24acb3(0x12c)](_0x5d56f6);}}),router[a0_0xce45da(0x1d1)](a0_0xce45da(0x114),auth,async(_0x2b6087,_0x4fad95)=>{var _0x34f2b6=a0_0xce45da;try{const _0x21ec39=_0x2b6087[_0x34f2b6(0xeb)]['id'];console[_0x34f2b6(0x12c)](_0x21ec39);const _0x1c40b6=await master_shop[_0x34f2b6(0x16c)]();console[_0x34f2b6(0x12c)](_0x34f2b6(0x120),_0x1c40b6);const _0x1f8fd5=await product[_0x34f2b6(0x13f)]({'name':_0x21ec39});console[_0x34f2b6(0x12c)]('product',_0x1f8fd5),_0x4fad95[_0x34f2b6(0x162)](0xc8)['json']({'product_data':_0x1f8fd5,'master':_0x1c40b6});}catch(_0x3075d6){console[_0x34f2b6(0x12c)](_0x34f2b6(0x150),_0x3075d6);}}),router[a0_0xce45da(0x19e)](a0_0xce45da(0x1e0),auth,async(_0x550382,_0x2adefa)=>{var _0x2de8a0=a0_0xce45da;try{const {invoice:_0x4bbf3f,date:_0x2b8644,warehouse_name:_0x33a542,prod_name:_0x27680a,prod_code:_0x561879,prod_qty:_0x5165a4,prod_unit:_0x547580,prod_secondunit:_0x527da3,prod_level:_0x585d0e,prod_isle:_0x13c693,prod_pallet:_0x4b7c83,note:_0x3f846f,expiry_date:_0x147428,batch_code:_0x23c994,payable:_0x4c8213,due_amount:_0x16cb6a,Room_name:_0x3a75fa,primary_code:_0x3b4742,secondary_code:_0x2f3f87,MaxStocks_data:_0x4f5ade,PO_number:_0x16661c,SCRN:_0x3a4c6a,JO_number:_0x4b0fbb}=_0x550382[_0x2de8a0(0x183)];if(typeof _0x27680a==_0x2de8a0(0x161))var _0x59525b=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x19a)]],_0x2fac36=[_0x550382[_0x2de8a0(0x183)]['prod_code']],_0xf10c1b=[_0x550382['body'][_0x2de8a0(0x100)]],_0x35169a=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x158)]],_0x4a5fd2=[_0x550382['body'][_0x2de8a0(0x1b0)]],_0x593f8a=[_0x550382['body'][_0x2de8a0(0x1c3)]],_0x436b1a=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x1c0)]],_0x548249=[_0x550382[_0x2de8a0(0x183)]['secondary_code']],_0x2aa517=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0xf6)]],_0x897e1d=[_0x550382['body'][_0x2de8a0(0x11f)]],_0x516f91=[_0x550382['body'][_0x2de8a0(0xee)]],_0x660582=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x112)]],_0x1f7e38=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x1e8)]],_0x1bc6df=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0xdc)]],_0x1897c4=[_0x550382['body']['prod_cat']],_0x226eca=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x17f)]],_0x13cdfc=[_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x157)]],_0x2897b7=[_0x550382['body']['prod_invoice']],_0x4ee4aa=[_0x550382[_0x2de8a0(0x183)]['actual_qty']],_0x407521=[_0x550382[_0x2de8a0(0x183)]['actual_uom']],_0x3ff243=[_0x550382[_0x2de8a0(0x183)]['deliverydate']];else var _0x59525b=[..._0x550382['body'][_0x2de8a0(0x19a)]],_0x2fac36=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x15f)]],_0xf10c1b=[..._0x550382['body']['prod_Qty']],_0x35169a=[..._0x550382['body'][_0x2de8a0(0x158)]],_0x4a5fd2=[..._0x550382[_0x2de8a0(0x183)]['prod_secondunit']],_0x593f8a=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x1c3)]],_0x436b1a=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x1c0)]],_0x548249=[..._0x550382['body'][_0x2de8a0(0xf3)]],_0x2aa517=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0xf6)]],_0x897e1d=[..._0x550382[_0x2de8a0(0x183)]['batch_code']],_0x516f91=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0xee)]],_0x660582=[..._0x550382[_0x2de8a0(0x183)]['max_product_unit']],_0x1f7e38=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x1e8)]],_0x1bc6df=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0xdc)]],_0x1897c4=[..._0x550382[_0x2de8a0(0x183)]['prod_cat']],_0x226eca=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x17f)]],_0x13cdfc=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x157)]],_0x2897b7=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x14d)]],_0x4ee4aa=[..._0x550382[_0x2de8a0(0x183)]['actual_qty']],_0x407521=[..._0x550382['body'][_0x2de8a0(0x1d0)]],_0x3ff243=[..._0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x1a7)]];const _0xf32ef6=_0x59525b['map'](_0x27188b=>{return _0x27188b={'product_name':_0x27188b};});_0x4ee4aa[_0x2de8a0(0xdd)]((_0x4e0454,_0xe10b9c)=>{var _0x5973b0=_0x2de8a0;_0xf32ef6[_0xe10b9c][_0x5973b0(0x11d)]=Math['abs'](_0x4e0454);}),_0x407521['forEach']((_0x36abc8,_0xd518cd)=>{var _0x54b72c=_0x2de8a0;_0xf32ef6[_0xd518cd][_0x54b72c(0x1d0)]=_0x36abc8;}),_0x2fac36[_0x2de8a0(0xdd)]((_0x27d75f,_0xda3435)=>{var _0x41323b=_0x2de8a0;_0xf32ef6[_0xda3435][_0x41323b(0x16f)]=_0x27d75f,_0xf32ef6[_0xda3435][_0x41323b(0x1c7)]=_0x2b8644;}),_0xf10c1b['forEach']((_0x564357,_0x3c457f)=>{var _0x40c96d=_0x2de8a0;_0xf32ef6[_0x3c457f][_0x40c96d(0x18f)]=Math[_0x40c96d(0x179)](_0x564357);}),_0x35169a[_0x2de8a0(0xdd)]((_0x2e8ded,_0x1b035a)=>{var _0x38146d=_0x2de8a0;_0xf32ef6[_0x1b035a][_0x38146d(0x1db)]=_0x2e8ded;}),_0x4a5fd2[_0x2de8a0(0xdd)]((_0x2af026,_0x272d91)=>{_0xf32ef6[_0x272d91]['secondary_unit']=_0x2af026;}),_0x593f8a[_0x2de8a0(0xdd)]((_0x344468,_0x3c3aba)=>{_0x226eca['forEach']((_0x2915c3,_0x50c4b1)=>{var _0x1ea966=a0_0x1fb7;if(_0x2915c3==_0x1ea966(0x116)&&_0x3c3aba==_0x50c4b1){console[_0x1ea966(0x12c)](_0x2915c3+_0x1ea966(0x1ea)+_0x3c3aba+'\x20<>\x20'+_0x50c4b1+_0x1ea966(0xed)+_0x344468);var _0xc506f7=_0x344468[_0x1ea966(0x1a1)](0x3);_0xf32ef6[_0x3c3aba][_0x1ea966(0x113)]=_0x344468[0x0],_0xf32ef6[_0x3c3aba][_0x1ea966(0x173)]=_0x344468[0x1],_0xf32ef6[_0x3c3aba][_0x1ea966(0xfe)]=0x0,_0xf32ef6[_0x3c3aba][_0x1ea966(0x16d)]=0x0,_0xf32ef6[_0x3c3aba]['type']='Floor',_0xf32ef6[_0x3c3aba]['floorlevel']=_0xc506f7;}else{if(_0x2915c3==_0x1ea966(0x1ee)&&_0x3c3aba==_0x50c4b1){var _0xc506f7=_0x344468[_0x1ea966(0x1a1)](0x3);_0xf32ef6[_0x3c3aba]['storage']=_0x344468[0x0],_0xf32ef6[_0x3c3aba][_0x1ea966(0x173)]=_0x344468[0x1],_0xf32ef6[_0x3c3aba][_0x1ea966(0xfe)]=0x0,_0xf32ef6[_0x3c3aba]['bin']=0x0,_0xf32ef6[_0x3c3aba][_0x1ea966(0xd3)]=_0x1ea966(0xe1),_0xf32ef6[_0x3c3aba][_0x1ea966(0x15e)]=_0x344468[0x5];}else{if(_0x3c3aba==_0x50c4b1){if(_0x344468[0x0]=='A'&&_0x344468[0x1]=='L'&&_0x344468[0x2]=='L')console[_0x1ea966(0x12c)](_0x2915c3+_0x1ea966(0xed)+_0x3c3aba+_0x1ea966(0xed)+_0x50c4b1+_0x1ea966(0xed)+_0x344468+'here'),_0xf32ef6[_0x3c3aba][_0x1ea966(0x113)]=_0x344468[0x0],_0xf32ef6[_0x3c3aba][_0x1ea966(0x173)]=_0x344468[0x1],_0xf32ef6[_0x3c3aba]['bay']=0x0,_0xf32ef6[_0x3c3aba][_0x1ea966(0x16d)]=0x0,_0xf32ef6[_0x3c3aba][_0x1ea966(0xd3)]='Floor',_0xf32ef6[_0x3c3aba][_0x1ea966(0x15e)]=_0x344468[0x3];else{var _0x749a0e;if(_0x344468[0x4]=='L')_0x749a0e=_0x1ea966(0x102);else _0x344468[0x4]=='F'&&(_0x749a0e=_0x1ea966(0xe1));_0xf32ef6[_0x3c3aba][_0x1ea966(0x113)]=_0x344468[0x0],_0xf32ef6[_0x3c3aba][_0x1ea966(0x173)]=_0x344468[0x1],_0xf32ef6[_0x3c3aba][_0x1ea966(0xfe)]=_0x344468[0x2],_0xf32ef6[_0x3c3aba][_0x1ea966(0x16d)]=_0x344468[0x3],_0xf32ef6[_0x3c3aba][_0x1ea966(0xd3)]=_0x749a0e,_0xf32ef6[_0x3c3aba][_0x1ea966(0x15e)]=_0x344468[0x5];}}}}});}),_0x436b1a['forEach']((_0x5cb854,_0x38cdc6)=>{var _0x37bffd=_0x2de8a0;_0xf32ef6[_0x38cdc6][_0x37bffd(0x1c0)]=_0x5cb854;}),_0x548249[_0x2de8a0(0xdd)]((_0x198452,_0x41aaba)=>{_0xf32ef6[_0x41aaba]['secondary_code']=_0x198452;}),_0x2aa517['forEach']((_0x751ff7,_0xaad342)=>{var _0x4d7909=_0x2de8a0;_0xf32ef6[_0xaad342][_0x4d7909(0x135)]=_0x751ff7;}),_0x897e1d[_0x2de8a0(0xdd)]((_0x4c110b,_0xa802ae)=>{var _0x51d3b0=_0x2de8a0;_0xf32ef6[_0xa802ae][_0x51d3b0(0x11f)]=_0x4c110b;}),_0x516f91[_0x2de8a0(0xdd)]((_0x279ec2,_0x1fcee2)=>{var _0x2be249=_0x2de8a0;_0xf32ef6[_0x1fcee2][_0x2be249(0xee)]=_0x279ec2;}),_0x660582['forEach']((_0x185409,_0x55f162)=>{var _0xa8798c=_0x2de8a0;_0xf32ef6[_0x55f162][_0xa8798c(0xd5)]=_0x185409;}),_0x1f7e38[_0x2de8a0(0xdd)]((_0x377bdc,_0x30a661)=>{var _0x45edb2=_0x2de8a0;_0xf32ef6[_0x30a661][_0x45edb2(0x1e8)]=_0x377bdc;}),_0x1bc6df[_0x2de8a0(0xdd)]((_0x43ea3f,_0x48d314)=>{var _0x426b32=_0x2de8a0;_0xf32ef6[_0x48d314][_0x426b32(0xdc)]=_0x43ea3f;}),_0x1897c4[_0x2de8a0(0xdd)]((_0xab12ce,_0xf02a7e)=>{var _0x22e0a7=_0x2de8a0;_0xf32ef6[_0xf02a7e][_0x22e0a7(0x154)]=_0xab12ce;}),_0x226eca[_0x2de8a0(0xdd)]((_0xffd14e,_0x55cee7)=>{var _0x1b5d11=_0x2de8a0;_0xf32ef6[_0x55cee7][_0x1b5d11(0x1d4)]=_0xffd14e;}),_0x3ff243['forEach']((_0x589b84,_0x3fb56f)=>{var _0xe5efdf=_0x2de8a0;_0xf32ef6[_0x3fb56f][_0xe5efdf(0x1bc)]=_0x589b84;}),_0x13cdfc[_0x2de8a0(0xdd)]((_0x4c08c5,_0x22ce70)=>{var _0x15b40c=_0x2de8a0;_0xf32ef6[_0x22ce70][_0x15b40c(0x160)]=_0x4c08c5;}),_0x2897b7[_0x2de8a0(0xdd)]((_0x30ddf8,_0x4ad665)=>{_0xf32ef6[_0x4ad665]['invoice']=_0x30ddf8;});const _0x3af071=_0x226eca[_0x2de8a0(0x131)](_0x413c22=>{return _0x413c22={'room_name':_0x413c22};}),_0x2f795b=_0xf32ef6[_0x2de8a0(0x175)](_0x215df5=>_0x215df5[_0x2de8a0(0x18f)]!=='0'&&_0x215df5[_0x2de8a0(0x18f)]!==''),_0x2c61bd=new purchases({'invoice':_0x4bbf3f,'suppliers':_0x550382[_0x2de8a0(0x183)][_0x2de8a0(0x199)],'date':_0x2b8644,'warehouse_name':_0x33a542,'product':_0x2f795b,'note':_0x3f846f,'due_amount':_0x16cb6a,'POnumber':_0x16661c,'SCRN':_0x3a4c6a,'JO_number':_0x4b0fbb,'roomList':_0x3af071}),_0x421cb4=await _0x2c61bd[_0x2de8a0(0x11a)](),_0x4b25f0=await purchases[_0x2de8a0(0x13f)]({'invoice':_0x4bbf3f}),_0x324415=_0x4b25f0[_0x2de8a0(0x17b)][_0x2de8a0(0x131)](async _0x59617b=>{var _0x1ad647=_0x2de8a0,_0x2e0bb3=await warehouse['findOne']({'name':_0x33a542,'room':_0x59617b[_0x1ad647(0x1d4)]}),_0x1d86f9=0x0;return _0x2e0bb3[_0x1ad647(0x165)][_0x1ad647(0xdd)](_0x337479=>{var _0x37937a=_0x1ad647;_0x337479['product_name']==_0x59617b[_0x37937a(0x1ef)]&&_0x337479[_0x37937a(0x15e)]==_0x59617b[_0x37937a(0x15e)]&&_0x337479['type']==_0x59617b[_0x37937a(0xd3)]&&_0x337479[_0x37937a(0x16d)]==_0x59617b['bin']&&_0x337479[_0x37937a(0xfe)]==_0x59617b['bay']&&_0x337479['rack']==_0x59617b[_0x37937a(0x173)]&&_0x337479[_0x37937a(0x113)]==_0x59617b['storage']&&_0x337479['expiry_date']==_0x59617b['expiry_date']&&_0x337479[_0x37937a(0x11f)]==_0x59617b[_0x37937a(0x11f)]&&_0x337479['production_date']==_0x59617b[_0x37937a(0xdc)]&&_0x337479['invoice']==_0x4b25f0['invoice']&&(_0x337479[_0x37937a(0x12b)]+=Math[_0x37937a(0x179)](_0x59617b['quantity']),_0x1d86f9++);}),_0x1d86f9===0x0&&_0x2e0bb3[_0x1ad647(0x165)][_0x1ad647(0xe3)]({'product_name':_0x59617b['product_name'],'product_stock':Math[_0x1ad647(0x179)](_0x59617b[_0x1ad647(0x18f)]),'primary_code':_0x59617b[_0x1ad647(0x1c0)],'secondary_code':_0x59617b['secondary_code'],'product_code':_0x59617b['product_code'],'storage':_0x59617b[_0x1ad647(0x113)],'rack':_0x59617b[_0x1ad647(0x173)],'bay':_0x59617b[_0x1ad647(0xfe)],'bin':_0x59617b[_0x1ad647(0x16d)],'type':_0x59617b[_0x1ad647(0xd3)],'floorlevel':_0x59617b['floorlevel'],'maxProducts':_0x59617b[_0x1ad647(0x135)],'unit':_0x59617b['standard_unit'],'secondary_unit':_0x59617b[_0x1ad647(0x18b)],'expiry_date':_0x59617b['expiry_date'],'maxPerUnit':_0x59617b[_0x1ad647(0xd5)],'batch_code':_0x59617b['batch_code'],'alertQTY':_0x59617b[_0x1ad647(0x1e8)],'production_date':_0x59617b[_0x1ad647(0xdc)],'product_cat':_0x59617b[_0x1ad647(0x154)],'invoice':_0x59617b['invoice'],'actual_qty':Math[_0x1ad647(0x179)](_0x59617b[_0x1ad647(0x11d)]),'actual_uom':_0x59617b[_0x1ad647(0x1d0)],'delivery_date':_0x59617b[_0x1ad647(0x1bc)],'delivery_code':_0x59617b[_0x1ad647(0x160)]}),_0x2e0bb3;});Promise[_0x2de8a0(0x111)](_0x324415)[_0x2de8a0(0x1f0)](async _0x1ca86c=>{var _0x5b312a=_0x2de8a0;try{for(const _0x27e080 of _0x1ca86c){await _0x27e080[_0x5b312a(0x11a)]();}const _0x435abf=await master_shop['find'](),_0x5b75b6=await email_settings[_0x5b312a(0x13f)](),_0x4cbba7=await supervisor_settings[_0x5b312a(0x16c)]();var _0x518359=_0x4b25f0[_0x5b312a(0x17b)],_0x2ac51d='',_0x4f5566;for(_0x4f5566 in _0x518359){_0x2ac51d+=_0x5b312a(0x1a3)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x518359[_0x4f5566]['product_name']+_0x5b312a(0x108)+_0x5b312a(0xd9)+_0x518359[_0x4f5566][_0x5b312a(0x16f)]+'</td>'+_0x5b312a(0xd9)+_0x518359[_0x4f5566][_0x5b312a(0x18f)]+_0x5b312a(0x108)+_0x5b312a(0xd9)+_0x518359[_0x4f5566][_0x5b312a(0x1db)]+_0x5b312a(0x108)+_0x5b312a(0xd9)+_0x518359[_0x4f5566]['secondary_unit']+_0x5b312a(0x108)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4b25f0[_0x5b312a(0x1af)]+'</td>'+_0x5b312a(0xd9)+_0x518359[_0x4f5566][_0x5b312a(0x1d4)]+_0x5b312a(0x108)+_0x5b312a(0xd9)+_0x518359[_0x4f5566]['storage']+_0x518359[_0x4f5566][_0x5b312a(0x173)]+_0x518359[_0x4f5566][_0x5b312a(0xfe)]+_0x518359[_0x4f5566][_0x5b312a(0x16d)]+_0x518359[_0x4f5566][_0x5b312a(0xd3)][0x0]+_0x518359[_0x4f5566][_0x5b312a(0x15e)]+'</td>',_0x5b312a(0x1c2);}let _0x4c5477=nodemailer[_0x5b312a(0x189)]({'host':_0x5b75b6[_0x5b312a(0x186)],'port':Number(_0x5b75b6[_0x5b312a(0xd4)]),'secure':![],'auth':{'user':_0x5b75b6[_0x5b312a(0x1d8)],'pass':_0x5b75b6[_0x5b312a(0xfa)]}}),_0x3cdfed={'from':_0x5b75b6[_0x5b312a(0x1d8)],'to':_0x4cbba7[0x0][_0x5b312a(0x115)],'subject':'Purchase\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x5b312a(0x1f1)+_0x5b312a(0x127)+_0x435abf[0x0]['image'],'cid':_0x5b312a(0x1a8)}],'html':_0x5b312a(0x124)+_0x5b312a(0x16b)+_0x5b312a(0x1dd)+_0x5b312a(0xf4)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5b312a(0x181)+_0x5b312a(0xf4)+_0x5b312a(0x17d)+_0x435abf[0x0][_0x5b312a(0xf9)]+_0x5b312a(0x178)+'</div>'+'</div>'+_0x5b312a(0x180)+_0x5b312a(0xf4)+_0x5b312a(0x19f)+_0x5b312a(0x13e)+_0x4b25f0[_0x5b312a(0x1e6)]+'\x20'+_0x5b312a(0x185)+'\x20Order\x20Date\x20:\x20'+_0x4b25f0['date']+'\x20'+_0x5b312a(0x1ca)+'</h5>'+_0x5b312a(0x181)+_0x5b312a(0xe8)+_0x5b312a(0x156)+_0x5b312a(0x1a3)+_0x5b312a(0x13b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x5b312a(0xd8)+_0x5b312a(0x125)+_0x5b312a(0x1dc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+_0x5b312a(0x11e)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2ac51d+'\x20'+_0x5b312a(0xe5)+_0x5b312a(0x1ce)+_0x5b312a(0xf4)+_0x5b312a(0x134)+_0x5b312a(0xda)+_0x435abf[0x0][_0x5b312a(0xf9)]+'</h5>'+_0x5b312a(0x181)+_0x5b312a(0x181)+_0x5b312a(0x188)};_0x4c5477[_0x5b312a(0x169)](_0x3cdfed,function(_0x567706,_0x10ca79){var _0x4c11ad=_0x5b312a;_0x567706?(console[_0x4c11ad(0x12c)](_0x567706),console[_0x4c11ad(0x12c)](_0x4c11ad(0x12e))):console['log'](_0x4c11ad(0x182));}),_0x550382[_0x5b312a(0xea)](_0x5b312a(0x19c),'Purchase\x20data\x20added\x20successfully'),_0x2adefa['redirect'](_0x5b312a(0xf2));}catch(_0x2d4c03){console[_0x5b312a(0x1a4)](_0x2d4c03),_0x2adefa[_0x5b312a(0x162)](0x1f4)[_0x5b312a(0x143)]({'error':_0x5b312a(0xd7)});}})[_0x2de8a0(0x10a)](_0x385868=>{var _0x462d63=_0x2de8a0;console[_0x462d63(0x1a4)](_0x385868),_0x2adefa[_0x462d63(0x162)](0x1f4)[_0x462d63(0x143)]({'error':'An\x20error\x20occurred.'});});}catch(_0x47b73f){console['log'](_0x47b73f);}}),router['get'](a0_0xce45da(0x1a9),auth,async(_0x278f5b,_0x59e116)=>{var _0x4c1ad4=a0_0xce45da;try{const {username:_0x3370b2,email:_0x3941de,role:_0x14ef2a}=_0x278f5b['user'],_0x263a50=_0x278f5b[_0x4c1ad4(0x168)],_0x246720=await profile[_0x4c1ad4(0x13f)]({'email':_0x263a50[_0x4c1ad4(0x1d8)]}),_0x4388ec=await master_shop['find'](),_0x36fca1=_0x278f5b[_0x4c1ad4(0xeb)]['id'],_0xd1df7d=await purchases['findById'](_0x36fca1),_0x2e33d3=await warehouse[_0x4c1ad4(0x1b5)]([{'$match':{'name':_0xd1df7d['warehouse_name'],'room':_0xd1df7d[_0x4c1ad4(0xe7)]}},{'$unwind':_0x4c1ad4(0xe2)},{'$group':{'_id':_0x4c1ad4(0x1de),'name':{'$first':_0x4c1ad4(0x1d7)},'product_stock':{'$first':_0x4c1ad4(0xd6)},'bay':{'$first':_0x4c1ad4(0x1d3)},'bin':{'$first':_0x4c1ad4(0x1c4)},'type':{'$first':_0x4c1ad4(0x16e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4c1ad4(0xe9)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4c1ad4(0x170)},'expiry_date':{'$first':_0x4c1ad4(0x117)}}}]),_0x53fce0=await customer['find']({});let _0x8202a;if(_0x263a50['role']=='staff'){const _0x361df8=await staff[_0x4c1ad4(0x13f)]({'email':_0x263a50[_0x4c1ad4(0x1d8)]});_0x8202a=await warehouse[_0x4c1ad4(0x1b5)]([{'$match':{'status':'Enabled','name':_0x361df8[_0x4c1ad4(0x141)]}},{'$group':{'_id':_0x4c1ad4(0x172),'name':{'$first':_0x4c1ad4(0x172)}}}]);}else _0x8202a=await warehouse[_0x4c1ad4(0x1b5)]([{'$match':{'status':_0x4c1ad4(0xec)}},{'$group':{'_id':_0x4c1ad4(0x172),'name':{'$first':_0x4c1ad4(0x172)}}}]);const _0x2a24ff=await product[_0x4c1ad4(0x16c)]({}),_0x53f669=await suppliers[_0x4c1ad4(0x16c)]({}),_0x21b62c=BayBinSelected(_0xd1df7d['warehouse_name'],_0xd1df7d['room']);if(_0x4388ec[0x0][_0x4c1ad4(0x136)]==_0x4c1ad4(0x1b8)){var _0x1c4b5f=users['English'];console['log'](_0x1c4b5f);}else{if(_0x4388ec[0x0][_0x4c1ad4(0x136)]==_0x4c1ad4(0x1da))var _0x1c4b5f=users[_0x4c1ad4(0x1da)];else{if(_0x4388ec[0x0][_0x4c1ad4(0x136)]==_0x4c1ad4(0xe4))var _0x1c4b5f=users[_0x4c1ad4(0xe4)];else{if(_0x4388ec[0x0][_0x4c1ad4(0x136)]=='Spanish')var _0x1c4b5f=users[_0x4c1ad4(0x1e2)];else{if(_0x4388ec[0x0][_0x4c1ad4(0x136)]==_0x4c1ad4(0x140))var _0x1c4b5f=users[_0x4c1ad4(0x140)];else{if(_0x4388ec[0x0][_0x4c1ad4(0x136)]==_0x4c1ad4(0x1e3))var _0x1c4b5f=users[_0x4c1ad4(0x1e9)];else{if(_0x4388ec[0x0][_0x4c1ad4(0x136)]==_0x4c1ad4(0x14c))var _0x1c4b5f=users[_0x4c1ad4(0x14c)];else{if(_0x4388ec[0x0]['language']==_0x4c1ad4(0x142))var _0x1c4b5f=users[_0x4c1ad4(0x1e7)];}}}}}}}_0x59e116[_0x4c1ad4(0x171)]('edit_purchases_view',{'success':_0x278f5b['flash'](_0x4c1ad4(0x19c)),'errors':_0x278f5b[_0x4c1ad4(0xea)](_0x4c1ad4(0x1b2)),'role':_0x263a50,'profile':_0x246720,'customer':_0x53fce0,'warehouse':_0x8202a,'product':_0x2e33d3,'user':_0xd1df7d,'master_shop':_0x4388ec,'unit':_0x2a24ff,'language':_0x1c4b5f,'suppliers':_0x53f669,'dataSelected':_0x21b62c});}catch(_0x24bcb7){console[_0x4c1ad4(0x12c)](_0x24bcb7);}}),router[a0_0xce45da(0x19e)]('/preview/:id',auth,async(_0x78911f,_0x2aeed6)=>{var _0x31ebb8=a0_0xce45da;try{const _0x3f4890=_0x78911f[_0x31ebb8(0xeb)]['id'],{invoice:_0x3e746e,warehouse_name:_0x1c8a90,Room_name:_0x3bac35}=_0x78911f[_0x31ebb8(0x183)],_0x235238=await warehouse[_0x31ebb8(0x13f)]({'name':_0x1c8a90,'room':_0x3bac35}),_0x583509=await purchases[_0x31ebb8(0x13f)]({'invoice':_0x3e746e});_0x583509[_0x31ebb8(0x17b)][_0x31ebb8(0xdd)](_0x4bfd72=>{var _0x5aece7=_0x31ebb8,_0x4afaf6=0x0;const _0xdfb795=_0x235238[_0x5aece7(0x165)]['map'](_0x158673=>{var _0xead988=_0x5aece7;_0x158673[_0xead988(0x1ef)]==_0x4bfd72[_0xead988(0x1ef)]&&_0x158673[_0xead988(0x15e)]==_0x4bfd72[_0xead988(0x15e)]&&_0x158673[_0xead988(0xd3)]==_0x4bfd72[_0xead988(0xd3)]&&_0x158673['bin']==_0x4bfd72[_0xead988(0x16d)]&&_0x158673[_0xead988(0xfe)]==_0x4bfd72[_0xead988(0xfe)]&&_0x158673['rack']==_0x4bfd72[_0xead988(0x173)]&&_0x158673[_0xead988(0x113)]==_0x4bfd72[_0xead988(0x113)]&&_0x158673[_0xead988(0xee)]==_0x4bfd72[_0xead988(0xee)]&&_0x158673[_0xead988(0x11f)]==_0x4bfd72[_0xead988(0x11f)]&&_0x158673[_0xead988(0xdc)]==_0x4bfd72['production_date']&&_0x158673[_0xead988(0x1bc)]==_0x4bfd72['delivery_date']&&_0x158673[_0xead988(0x160)]==_0x4bfd72[_0xead988(0x160)]&&(_0x158673[_0xead988(0x12b)]=parseInt(_0x158673[_0xead988(0x12b)])+parseInt(_0x4bfd72[_0xead988(0x18f)]),_0x4afaf6++);});_0x4afaf6=='0'&&(_0x235238[_0x5aece7(0x165)]=_0x235238[_0x5aece7(0x165)]['concat']({'product_name':_0x4bfd72['product_name'],'product_stock':_0x4bfd72['quantity'],'primary_code':_0x4bfd72[_0x5aece7(0x1c0)],'secondary_code':_0x4bfd72['secondary_code'],'product_code':_0x4bfd72[_0x5aece7(0x16f)],'storage':_0x4bfd72[_0x5aece7(0x113)],'rack':_0x4bfd72[_0x5aece7(0x173)],'bay':_0x4bfd72[_0x5aece7(0xfe)],'bin':_0x4bfd72[_0x5aece7(0x16d)],'type':_0x4bfd72[_0x5aece7(0xd3)],'floorlevel':_0x4bfd72[_0x5aece7(0x15e)],'maxProducts':_0x4bfd72['maxStocks'],'unit':_0x4bfd72[_0x5aece7(0x1db)],'secondary_unit':_0x4bfd72[_0x5aece7(0x18b)],'expiry_date':_0x4bfd72['expiry_date'],'maxPerUnit':_0x4bfd72[_0x5aece7(0xd5)],'batch_code':_0x4bfd72['batch_code'],'alertQTY':_0x4bfd72['alertQTY'],'production_date':_0x4bfd72[_0x5aece7(0xdc)],'delivery_date':_0x4bfd72[_0x5aece7(0x1bc)],'delivery_code':_0x4bfd72[_0x5aece7(0x160)]}));}),await _0x235238['save'](),_0x583509[_0x31ebb8(0x103)]=_0x31ebb8(0x1aa);const _0x7ab65b=await _0x583509['save']();_0x78911f['flash'](_0x31ebb8(0x19c),'Sales\x20Update\x20successfully'),_0x2aeed6['redirect']('/all_purchases/view');}catch(_0x4b7803){console[_0x31ebb8(0x12c)](_0x4b7803);}}),router[a0_0xce45da(0x1d1)](a0_0xce45da(0x147),auth,async(_0x542f3a,_0x45209e)=>{var _0x5ad37e=a0_0xce45da;try{const {username:_0x2e9611,email:_0xf81552,role:_0x5df3fa}=_0x542f3a[_0x5ad37e(0x168)],_0x547da1=_0x542f3a[_0x5ad37e(0x168)],_0x187922=await profile[_0x5ad37e(0x13f)]({'email':_0x547da1['email']}),_0xf254e8=await master_shop[_0x5ad37e(0x16c)](),_0x8278c3=_0x542f3a[_0x5ad37e(0xeb)]['id'],_0x3198d6=await purchases['findById'](_0x8278c3),_0x791376=await suppliers['find']({});let _0x405cd0;if(_0x547da1['role']==_0x5ad37e(0x159)){const _0x5cee69=await staff[_0x5ad37e(0x13f)]({'email':_0x547da1[_0x5ad37e(0x1d8)]});_0x405cd0=await warehouse[_0x5ad37e(0x16c)]({'status':_0x5ad37e(0xec),'name':_0x5cee69[_0x5ad37e(0x141)],'warehouse_category':'Raw\x20Materials'});}else _0x405cd0=await warehouse[_0x5ad37e(0x1b5)]([{'$match':{'status':_0x5ad37e(0xec),'warehouse_category':_0x5ad37e(0x148)}},{'$group':{'_id':_0x5ad37e(0x172),'name':{'$first':_0x5ad37e(0x172)}}}]);const _0x492aca=await product[_0x5ad37e(0x16c)]({}),_0x236a56=BayBinSelected(_0x3198d6[_0x5ad37e(0x1af)],_0x3198d6[_0x5ad37e(0xe7)]);let _0x17587a=new Date(_0x3198d6[_0x5ad37e(0xee)]),_0xccaf9=('0'+_0x17587a[_0x5ad37e(0xe0)]())[_0x5ad37e(0x1a1)](-0x2),_0x3fb744=('0'+(_0x17587a[_0x5ad37e(0x1c1)]()+0x1))['slice'](-0x2),_0x438e5a=_0x17587a[_0x5ad37e(0x155)](),_0x80f76e=_0x438e5a+'-'+_0x3fb744+'-'+_0xccaf9;if(_0xf254e8[0x0][_0x5ad37e(0x136)]==_0x5ad37e(0x1b8)){var _0x53fa0b=users[_0x5ad37e(0x18e)];console[_0x5ad37e(0x12c)](_0x53fa0b);}else{if(_0xf254e8[0x0][_0x5ad37e(0x136)]=='Hindi')var _0x53fa0b=users[_0x5ad37e(0x1da)];else{if(_0xf254e8[0x0]['language']==_0x5ad37e(0xe4))var _0x53fa0b=users[_0x5ad37e(0xe4)];else{if(_0xf254e8[0x0][_0x5ad37e(0x136)]==_0x5ad37e(0x1e2))var _0x53fa0b=users[_0x5ad37e(0x1e2)];else{if(_0xf254e8[0x0]['language']==_0x5ad37e(0x140))var _0x53fa0b=users['French'];else{if(_0xf254e8[0x0][_0x5ad37e(0x136)]==_0x5ad37e(0x1e3))var _0x53fa0b=users[_0x5ad37e(0x1e9)];else{if(_0xf254e8[0x0][_0x5ad37e(0x136)]==_0x5ad37e(0x14c))var _0x53fa0b=users['Chinese'];else{if(_0xf254e8[0x0][_0x5ad37e(0x136)]=='Arabic\x20(ae)')var _0x53fa0b=users[_0x5ad37e(0x1e7)];}}}}}}}_0x45209e[_0x5ad37e(0x171)]('edit_purchases',{'success':_0x542f3a['flash'](_0x5ad37e(0x19c)),'errors':_0x542f3a[_0x5ad37e(0xea)]('errors'),'role':_0x547da1,'profile':_0x187922,'purchases':_0x3198d6,'suppliers':_0x791376,'warehouse':_0x405cd0,'product':_0x492aca,'master_shop':_0xf254e8,'language':_0x53fa0b,'ed_fullDate':_0x80f76e,'dataSelected':_0x236a56});}catch(_0x163a26){console['log'](_0x163a26);}}),router['post'](a0_0xce45da(0x147),auth,async(_0x3d0ebd,_0x3bc1ab)=>{var _0x5bc11e=a0_0xce45da;try{const _0x217c79=_0x3d0ebd['params']['id'],_0x5f1229=await purchases['findOne']({'_id':_0x3d0ebd[_0x5bc11e(0xeb)]['id']}),_0x1c7a5b=await warehouse['findOne']({'name':_0x5f1229[_0x5bc11e(0x1af)],'room':_0x5f1229[_0x5bc11e(0xe7)]});_0x5f1229[_0x5bc11e(0x17b)][_0x5bc11e(0xdd)](_0x44b81e=>{const _0x3f4e40=_0x1c7a5b['product_details']['map'](_0x445ab6=>{var _0x54182f=a0_0x1fb7;_0x445ab6[_0x54182f(0x1ef)]==_0x44b81e[_0x54182f(0x1ef)]&&_0x445ab6[_0x54182f(0x15e)]==_0x44b81e[_0x54182f(0x15e)]&&_0x445ab6[_0x54182f(0xd3)]==_0x44b81e[_0x54182f(0xd3)]&&_0x445ab6[_0x54182f(0x16d)]==_0x44b81e[_0x54182f(0x16d)]&&_0x445ab6[_0x54182f(0xfe)]==_0x44b81e[_0x54182f(0xfe)]&&_0x445ab6[_0x54182f(0x173)]==_0x44b81e['rack']&&_0x445ab6['storage']==_0x44b81e['storage']&&(_0x445ab6[_0x54182f(0x12b)]=parseInt(_0x445ab6['product_stock'])-parseInt(_0x44b81e[_0x54182f(0x18f)]));});}),await _0x1c7a5b[_0x5bc11e(0x11a)]();const {invoice:_0x17a8a2,suppliers:_0x34268e,date:_0x49ce94,warehouse_name:_0x47bdc5,prod_name:_0x35bbc1,prod_code:_0x1c20de,prod_qty:_0x3dbe66,prod_unit:_0x417cfc,prod_secondunit:_0x4bd2a2,prod_level:_0x1ed29d,prod_isle:_0x471e0c,prod_pallet:_0x117a62,note:_0x32a7a9,expiry_date:_0x3e9304,batch_code:_0x4b2586,paid_amount:_0x3ef0d0,due_amount:_0x3e65ec,Room_name:_0x4b0550,primary_code:_0x17fbc4,secondary_code:_0x1baa1b,PO_number:_0x5f1e70,JO_number:_0x575cf4}=_0x3d0ebd[_0x5bc11e(0x183)];if(typeof _0x35bbc1=='string')var _0x29eca2=[_0x3d0ebd['body'][_0x5bc11e(0x19a)]],_0x2f19c9=[_0x3d0ebd['body'][_0x5bc11e(0x15f)]],_0x212ad0=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x14e)]],_0x5106cd=[_0x3d0ebd['body'][_0x5bc11e(0x15c)]],_0x4a83dc=[_0x3d0ebd[_0x5bc11e(0x183)]['prod_secondunit']],_0x4f95cd=[_0x3d0ebd['body'][_0x5bc11e(0x1c3)]],_0x522fb6=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0xf1)]],_0x2b0b28=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x15a)]],_0x2af313=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x1c0)]],_0x4fa032=[_0x3d0ebd['body']['secondary_code']],_0x2d6233=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0xf6)]],_0x576b02=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x11f)]],_0x40982f=[_0x3d0ebd['body'][_0x5bc11e(0xee)]],_0x4550a9=[_0x3d0ebd['body'][_0x5bc11e(0x113)]],_0x983258=[_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x11c)]],_0x4d8797=[_0x3d0ebd[_0x5bc11e(0x183)]['type']];else var _0x29eca2=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x19a)]],_0x2f19c9=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x15f)]],_0x212ad0=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x14e)]],_0x5106cd=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x15c)]],_0x4a83dc=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x1b0)]],_0x4f95cd=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x1c3)]],_0x522fb6=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0xf1)]],_0x2b0b28=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x15a)]],_0x2af313=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x1c0)]],_0x4fa032=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0xf3)]],_0x2d6233=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0xf6)]],_0x576b02=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x11f)]],_0x40982f=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0xee)]],_0x4550a9=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x113)]],_0x983258=[..._0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x11c)]],_0x4d8797=[..._0x3d0ebd[_0x5bc11e(0x183)]['type']];const _0x56cc5d=_0x29eca2[_0x5bc11e(0x131)](_0x49b672=>{return _0x49b672={'product_name':_0x49b672};});_0x2f19c9['forEach']((_0x70d7fa,_0x5a74ce)=>{var _0x125c9a=_0x5bc11e;_0x56cc5d[_0x5a74ce][_0x125c9a(0x16f)]=_0x70d7fa;}),_0x212ad0[_0x5bc11e(0xdd)]((_0x372b58,_0x159a55)=>{_0x56cc5d[_0x159a55]['quantity']=_0x372b58;}),_0x5106cd[_0x5bc11e(0xdd)]((_0x4396ed,_0x31624c)=>{var _0x1e27f6=_0x5bc11e;_0x56cc5d[_0x31624c][_0x1e27f6(0x1db)]=_0x4396ed;}),_0x4a83dc[_0x5bc11e(0xdd)]((_0x28b4e2,_0x5d2fd4)=>{var _0x41245d=_0x5bc11e;_0x56cc5d[_0x5d2fd4][_0x41245d(0x18b)]=_0x28b4e2;}),_0x4f95cd['forEach']((_0x3aeb6b,_0x21b940)=>{var _0x2bf33f=_0x5bc11e;_0x56cc5d[_0x21b940][_0x2bf33f(0xfe)]=_0x3aeb6b;}),_0x522fb6['forEach']((_0x496865,_0x5317df)=>{_0x56cc5d[_0x5317df]['bin']=_0x496865;}),_0x2b0b28['forEach']((_0x52f6f2,_0x4ec42b)=>{var _0x25404f=_0x5bc11e;_0x56cc5d[_0x4ec42b][_0x25404f(0x15e)]=_0x52f6f2;}),_0x2af313[_0x5bc11e(0xdd)]((_0x18744f,_0x5505ad)=>{var _0x4622fe=_0x5bc11e;_0x56cc5d[_0x5505ad][_0x4622fe(0x1c0)]=_0x18744f;}),_0x4fa032['forEach']((_0x2c35dd,_0x5cf629)=>{_0x56cc5d[_0x5cf629]['secondary_code']=_0x2c35dd;}),_0x2d6233['forEach']((_0x7639d,_0x21d784)=>{var _0xacd36f=_0x5bc11e;_0x56cc5d[_0x21d784][_0xacd36f(0x135)]=_0x7639d;}),_0x576b02[_0x5bc11e(0xdd)]((_0x492a1c,_0x1b0892)=>{var _0x4d0fd1=_0x5bc11e;_0x56cc5d[_0x1b0892][_0x4d0fd1(0x11f)]=_0x492a1c;}),_0x40982f[_0x5bc11e(0xdd)]((_0x2ba7f6,_0x4dc8a3)=>{var _0x543e6c=_0x5bc11e;_0x56cc5d[_0x4dc8a3][_0x543e6c(0xee)]=_0x2ba7f6;}),_0x4d8797[_0x5bc11e(0xdd)]((_0x4064f0,_0x480ebe)=>{var _0x4ce3ef=_0x5bc11e;_0x56cc5d[_0x480ebe][_0x4ce3ef(0xd3)]=_0x4064f0;}),_0x4550a9['forEach']((_0x3ee5d1,_0x2b0c7d)=>{var _0x5ade11=_0x5bc11e;_0x56cc5d[_0x2b0c7d][_0x5ade11(0x113)]=_0x3ee5d1;}),_0x983258[_0x5bc11e(0xdd)]((_0x2e3729,_0x2353e0)=>{var _0xa13bc8=_0x5bc11e;_0x56cc5d[_0x2353e0][_0xa13bc8(0x173)]=_0x2e3729;});const _0x404fee=_0x56cc5d[_0x5bc11e(0x175)](_0x410eb7=>_0x410eb7['quantity']!=='0'&&_0x410eb7[_0x5bc11e(0x18f)]!=='');_0x5f1229[_0x5bc11e(0x1e6)]=_0x17a8a2,_0x5f1229['suppliers']=_0x34268e,_0x5f1229['date']=_0x49ce94,_0x5f1229[_0x5bc11e(0x1af)]=_0x47bdc5,_0x5f1229[_0x5bc11e(0x17b)]=_0x404fee,_0x5f1229[_0x5bc11e(0xef)]=_0x32a7a9,_0x5f1229[_0x5bc11e(0x128)]=_0x3ef0d0,_0x5f1229[_0x5bc11e(0x109)]=_0x3e65ec,_0x5f1229[_0x5bc11e(0xe7)]=_0x4b0550,_0x5f1229[_0x5bc11e(0x1c6)]=_0x5f1e70,_0x5f1229[_0x5bc11e(0x1a6)]=_0x575cf4;const _0x1b0ca5=await _0x5f1229[_0x5bc11e(0x11a)](),_0x589031=await warehouse['findOne']({'name':_0x3d0ebd['body'][_0x5bc11e(0x1af)],'room':_0x3d0ebd['body'][_0x5bc11e(0x152)]});_0x5f1229[_0x5bc11e(0x17b)]['forEach'](_0xda28fd=>{var _0x18b04c=_0x5bc11e,_0x42a565=0x0;const _0x35815b=_0x589031['product_details']['map'](_0x1b146b=>{var _0x109d35=a0_0x1fb7;_0x1b146b[_0x109d35(0x1ef)]==_0xda28fd['product_name']&&_0x1b146b[_0x109d35(0x15e)]==_0xda28fd[_0x109d35(0x15e)]&&_0x1b146b[_0x109d35(0xd3)]==_0xda28fd[_0x109d35(0xd3)]&&_0x1b146b[_0x109d35(0x16d)]==_0xda28fd[_0x109d35(0x16d)]&&_0x1b146b['bay']==_0xda28fd['bay']&&_0x1b146b[_0x109d35(0x173)]==_0xda28fd[_0x109d35(0x173)]&&_0x1b146b[_0x109d35(0x113)]==_0xda28fd[_0x109d35(0x113)]&&(_0x1b146b[_0x109d35(0x12b)]=parseInt(_0x1b146b['product_stock'])+parseInt(_0xda28fd[_0x109d35(0x18f)]),_0x42a565++);});_0x42a565=='0'&&(_0x589031[_0x18b04c(0x165)]=_0x589031[_0x18b04c(0x165)][_0x18b04c(0x17e)]({'product_name':_0xda28fd[_0x18b04c(0x1ef)],'product_stock':_0xda28fd[_0x18b04c(0x18f)],'primary_code':_0xda28fd[_0x18b04c(0x1c0)],'secondary_code':_0xda28fd[_0x18b04c(0xf3)],'product_code':_0xda28fd[_0x18b04c(0x16f)],'storage':_0xda28fd['storage'],'rack':_0xda28fd[_0x18b04c(0x173)],'bay':_0xda28fd[_0x18b04c(0xfe)],'bin':_0xda28fd['bin'],'type':_0xda28fd[_0x18b04c(0xd3)],'floorlevel':_0xda28fd[_0x18b04c(0x15e)],'maxProducts':_0xda28fd['maxStocks'],'unit':_0xda28fd[_0x18b04c(0x1db)],'secondary_unit':_0xda28fd['secondary_unit'],'expiry_date':_0xda28fd[_0x18b04c(0xee)]}));}),await _0x589031['save']();const _0x2c64de=await s_payment_data[_0x5bc11e(0x13f)]({'invoice':_0x3d0ebd['body']['invoice']});if(_0x2c64de===null){}else console['log'](_0x5bc11e(0x199),_0x2c64de,_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x1e6)]),_0x2c64de[_0x5bc11e(0x199)]=_0x3d0ebd[_0x5bc11e(0x183)][_0x5bc11e(0x199)],await _0x2c64de[_0x5bc11e(0x11a)]();_0x3d0ebd[_0x5bc11e(0xea)]('success',_0x5bc11e(0x1ed)),_0x3bc1ab['redirect']('/all_purchases/view');}catch(_0x1e747a){console[_0x5bc11e(0x12c)](_0x1e747a);}}),router[a0_0xce45da(0x19e)](a0_0xce45da(0x14a),auth,async(_0x565522,_0x8b3e64)=>{var _0x4347f0=a0_0xce45da;try{const _0x54542a=_0x565522['params']['id'],{invoice:_0x26fbf9,suppliers:_0x44db2f,payable:_0x46573f,due_amount:_0x1edf2e}=_0x565522['body'],_0x1520eb=await purchases[_0x4347f0(0xff)](_0x54542a);var _0x197c0e=_0x46573f-_0x1edf2e;_0x1520eb[_0x4347f0(0x128)]=parseFloat(_0x1520eb[_0x4347f0(0x128)])+parseFloat(_0x1edf2e),_0x1520eb[_0x4347f0(0x109)]=_0x197c0e;const _0x50f66e=await _0x1520eb[_0x4347f0(0x11a)]();console[_0x4347f0(0x12c)](_0x50f66e);const _0x5589fd=await s_payment_data[_0x4347f0(0x13f)]({'invoice':_0x26fbf9});_0x5589fd[_0x4347f0(0x123)]=_0x197c0e,await _0x5589fd['save']();let _0x184ca6=new Date(),_0x4839ad=('0'+_0x184ca6[_0x4347f0(0xe0)]())[_0x4347f0(0x1a1)](-0x2),_0x1a85f0=('0'+(_0x184ca6['getMonth']()+0x1))[_0x4347f0(0x1a1)](-0x2),_0x356c28=_0x184ca6[_0x4347f0(0x155)](),_0x3e55df=_0x356c28+'-'+_0x1a85f0+'-'+_0x4839ad;const _0x48ff20=new suppliers_payment({'invoice':_0x26fbf9,'date':_0x356c28+'-'+_0x1a85f0+'-'+_0x4839ad,'suppliers':_0x44db2f,'reason':_0x4347f0(0xd2),'amount':_0x1edf2e}),_0xa70a67=await _0x48ff20[_0x4347f0(0x11a)]();_0x565522[_0x4347f0(0xea)](_0x4347f0(0x19c),_0x4347f0(0x106)),_0x8b3e64[_0x4347f0(0xde)]('/all_purchases/view');}catch(_0x5a8e33){console[_0x4347f0(0x12c)](_0x5a8e33);}}),router['get'](a0_0xce45da(0x1cb),auth,async(_0x13d974,_0x1bb56a)=>{var _0x478214=a0_0xce45da;try{const {username:_0x36fb33,email:_0x2d9f76,role:_0x308fe7}=_0x13d974[_0x478214(0x168)],_0x5d145=_0x13d974['user'],_0x5bff4=await profile['findOne']({'email':_0x5d145[_0x478214(0x1d8)]}),_0x23748c=await master_shop[_0x478214(0x16c)]();console['log']('master',_0x23748c);const _0xebadc0=_0x13d974[_0x478214(0xeb)]['id'],_0x1909f8=await purchases[_0x478214(0xff)](_0xebadc0);console[_0x478214(0x12c)](_0x1909f8);const _0x21a882=await suppliers['findOne']({'name':_0x1909f8[_0x478214(0x199)]});console['log'](_0x21a882);if(_0x23748c[0x0][_0x478214(0x136)]==_0x478214(0x1b8)){var _0x4e49fa=users['English'];console[_0x478214(0x12c)](_0x4e49fa);}else{if(_0x23748c[0x0][_0x478214(0x136)]==_0x478214(0x1da))var _0x4e49fa=users[_0x478214(0x1da)];else{if(_0x23748c[0x0]['language']==_0x478214(0xe4))var _0x4e49fa=users[_0x478214(0xe4)];else{if(_0x23748c[0x0][_0x478214(0x136)]==_0x478214(0x1e2))var _0x4e49fa=users['Spanish'];else{if(_0x23748c[0x0][_0x478214(0x136)]==_0x478214(0x140))var _0x4e49fa=users[_0x478214(0x140)];else{if(_0x23748c[0x0][_0x478214(0x136)]==_0x478214(0x1e3))var _0x4e49fa=users['Portuguese'];else{if(_0x23748c[0x0][_0x478214(0x136)]==_0x478214(0x14c))var _0x4e49fa=users[_0x478214(0x14c)];else{if(_0x23748c[0x0][_0x478214(0x136)]=='Arabic\x20(ae)')var _0x4e49fa=users[_0x478214(0x1e7)];}}}}}}}_0x1bb56a[_0x478214(0x171)](_0x478214(0x10b),{'success':_0x13d974[_0x478214(0xea)](_0x478214(0x19c)),'errors':_0x13d974['flash'](_0x478214(0x1b2)),'role':_0x5d145,'profile':_0x5bff4,'master_shop':_0x23748c,'supplier':_0x21a882,'purchase':_0x1909f8,'language':_0x4e49fa});}catch(_0x3a13cf){console[_0x478214(0x12c)](_0x3a13cf);}}),router[a0_0xce45da(0x1d1)](a0_0xce45da(0x17c),auth,async(_0x5d6347,_0x3c614d)=>{var _0x452c14=a0_0xce45da;try{const {username:_0x1bb58a,email:_0x5acbb1,role:_0x21cd96}=_0x5d6347['user'],_0x4accd6=_0x5d6347['user'],_0x5e66cd=await profile[_0x452c14(0x13f)]({'email':_0x4accd6[_0x452c14(0x1d8)]}),_0x4366e4=await master_shop[_0x452c14(0x16c)]();console[_0x452c14(0x12c)](_0x452c14(0x120),_0x4366e4);const _0x437a93=_0x5d6347['params']['id'];console['log'](_0x437a93);const _0x1ed45d=await purchases['findById'](_0x437a93);console['log']('user_id',_0x1ed45d);const _0x282faa=await product[_0x452c14(0x16c)]({}),_0x21fe2a=await warehouse[_0x452c14(0x1b5)]([{'$match':{'name':_0x1ed45d[_0x452c14(0x1af)],'room':_0x1ed45d[_0x452c14(0xe7)],'warehouse_category':_0x452c14(0x148)}},{'$unwind':_0x452c14(0xe2)},{'$group':{'_id':_0x452c14(0x1de),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x452c14(0xd6)},'bay':{'$first':_0x452c14(0x1d3)},'bin':{'$first':_0x452c14(0x1c4)},'type':{'$first':_0x452c14(0x16e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x452c14(0xe9)},'product_code':{'$first':_0x452c14(0x1c8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x452c14(0x170)}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x452c14(0xec),'name':'Return\x20Goods','warehouse_category':_0x452c14(0x148)}},{'$group':{'_id':_0x452c14(0x172),'name':{'$first':_0x452c14(0x172)}}},{'$sort':{'name':0x1}}]),console[_0x452c14(0x12c)](_0x452c14(0x1cd),_0x21fe2a);if(_0x4366e4[0x0]['language']==_0x452c14(0x1b8)){var _0x123ee8=users[_0x452c14(0x18e)];console[_0x452c14(0x12c)](_0x123ee8);}else{if(_0x4366e4[0x0][_0x452c14(0x136)]=='Hindi')var _0x123ee8=users['Hindi'];else{if(_0x4366e4[0x0][_0x452c14(0x136)]=='German')var _0x123ee8=users[_0x452c14(0xe4)];else{if(_0x4366e4[0x0][_0x452c14(0x136)]==_0x452c14(0x1e2))var _0x123ee8=users['Spanish'];else{if(_0x4366e4[0x0]['language']==_0x452c14(0x140))var _0x123ee8=users[_0x452c14(0x140)];else{if(_0x4366e4[0x0][_0x452c14(0x136)]==_0x452c14(0x1e3))var _0x123ee8=users['Portuguese'];else{if(_0x4366e4[0x0][_0x452c14(0x136)]==_0x452c14(0x14c))var _0x123ee8=users[_0x452c14(0x14c)];else{if(_0x4366e4[0x0][_0x452c14(0x136)]==_0x452c14(0x142))var _0x123ee8=users[_0x452c14(0x1e7)];}}}}}}}_0x3c614d[_0x452c14(0x171)](_0x452c14(0x1ba),{'success':_0x5d6347['flash']('success'),'errors':_0x5d6347[_0x452c14(0xea)]('errors'),'role':_0x4accd6,'profile':_0x5e66cd,'user':_0x1ed45d,'stock':_0x21fe2a,'master_shop':_0x4366e4,'product':_0x282faa,'language':_0x123ee8,'warehouse':warehouse_data});}catch(_0x5c5e80){console[_0x452c14(0x12c)](_0x5c5e80);}}),router[a0_0xce45da(0x19e)]('/view/return_purchase/:id',auth,async(_0x296230,_0x4f65c7)=>{var _0x5382d3=a0_0xce45da;try{const {invoice:_0x22491a,date:_0x270d0d,warehouse_name:_0x5505bf,Room_name:_0x25b74b,product_name:_0x409a64,purchase_quantity:_0x26c68c,stocks:_0x2089f4,return_qty:_0x4938a2,note:_0x3f42dd,level:_0x168bc3,isle:_0x9e06b5,pallet:_0x1a0114,to_warehouse_name:_0x2d4bf0,to_Room_name:_0x347891}=_0x296230['body'],_0x2aec16=await purchases[_0x5382d3(0x13f)]({'_id':_0x296230[_0x5382d3(0xeb)]['id']}),_0x42098f=await warehouse[_0x5382d3(0x13f)]({'name':_0x5505bf,'room':_0x25b74b});if(typeof _0x409a64==_0x5382d3(0x161))var _0x26e591=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x1ef)]],_0x4d6807=[_0x296230[_0x5382d3(0x183)]['purchase_quantity']],_0x408317=[_0x296230['body'][_0x5382d3(0x1be)]],_0x52c1e2=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x1cf)]],_0x380bca=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x1b1)]],_0x136201=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x1b9)]],_0x181fec=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x163)]],_0x2c16a3=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x176)]],_0x48a07c=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x15d)]],_0x2bf5a5=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x18a)]],_0x13c5f8=[_0x296230[_0x5382d3(0x183)][_0x5382d3(0x1e4)]];else var _0x26e591=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x1ef)]],_0x4d6807=[..._0x296230['body'][_0x5382d3(0x1d9)]],_0x408317=[..._0x296230['body'][_0x5382d3(0x1be)]],_0x52c1e2=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x1cf)]],_0x380bca=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x1b1)]],_0x136201=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x1b9)]],_0x181fec=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x163)]],_0x2c16a3=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x176)]],_0x48a07c=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x15d)]],_0x2bf5a5=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x18a)]],_0x13c5f8=[..._0x296230[_0x5382d3(0x183)][_0x5382d3(0x1e4)]];const _0x34248c=_0x26e591[_0x5382d3(0x131)](_0x5757c0=>{return _0x5757c0={'product_name':_0x5757c0};});_0x4d6807[_0x5382d3(0xdd)]((_0x94681c,_0x319f0b)=>{_0x34248c[_0x319f0b]['purchase_quantity']=_0x94681c;}),_0x408317[_0x5382d3(0xdd)]((_0x3ff5b6,_0x259470)=>{var _0x1eef76=_0x5382d3;_0x34248c[_0x259470][_0x1eef76(0x13a)]=_0x3ff5b6;}),_0x52c1e2['forEach']((_0x859e02,_0x27f5c6)=>{var _0x4c1410=_0x5382d3;_0x34248c[_0x27f5c6][_0x4c1410(0x1cf)]=_0x859e02;}),_0x380bca['forEach']((_0x7abfc1,_0x29021c)=>{var _0x2ec6d8=_0x5382d3;_0x34248c[_0x29021c][_0x2ec6d8(0xfe)]=_0x7abfc1;}),_0x136201['forEach']((_0x5a9cd1,_0x418595)=>{_0x34248c[_0x418595]['bin']=_0x5a9cd1;}),_0x181fec['forEach']((_0x51b0d7,_0x24aea4)=>{var _0x39df46=_0x5382d3;_0x34248c[_0x24aea4][_0x39df46(0x15e)]=_0x51b0d7;}),_0x2c16a3['forEach']((_0x375250,_0x53c38f)=>{var _0x35bfcd=_0x5382d3;_0x34248c[_0x53c38f][_0x35bfcd(0xd3)]=_0x375250;}),_0x48a07c[_0x5382d3(0xdd)]((_0xdaf8df,_0x22a13e)=>{_0x34248c[_0x22a13e]['product_code']=_0xdaf8df;}),_0x2bf5a5[_0x5382d3(0xdd)]((_0x41c0ba,_0x29e553)=>{var _0x387292=_0x5382d3;_0x34248c[_0x29e553][_0x387292(0x1c0)]=_0x41c0ba;}),_0x13c5f8[_0x5382d3(0xdd)]((_0x16af64,_0x4fe4b5)=>{var _0x160d45=_0x5382d3;_0x34248c[_0x4fe4b5][_0x160d45(0xf3)]=_0x16af64;}),_0x2aec16['product'][_0x5382d3(0xdd)](_0x5974ce=>{var _0x214cce=_0x5382d3;const _0x2335d7=_0x42098f[_0x214cce(0x165)][_0x214cce(0x131)](_0x47c26a=>{var _0x333584=_0x214cce;_0x47c26a[_0x333584(0x1ef)]==_0x5974ce['product_name']&&_0x47c26a[_0x333584(0x15e)]==_0x5974ce[_0x333584(0x15e)]&&_0x47c26a[_0x333584(0xd3)]==_0x5974ce[_0x333584(0xd3)]&&_0x47c26a[_0x333584(0x16d)]==_0x5974ce[_0x333584(0x16d)]&&_0x47c26a['bay']==_0x5974ce[_0x333584(0xfe)]&&_0x47c26a[_0x333584(0x173)]==_0x5974ce[_0x333584(0x173)]&&_0x47c26a[_0x333584(0x113)]==_0x5974ce[_0x333584(0x113)]&&(console[_0x333584(0x12c)](parseInt(_0x47c26a['product_stock'])+'\x20<>\x20'+parseInt(_0x5974ce[_0x333584(0x18f)])),_0x47c26a[_0x333584(0x12b)]=parseInt(_0x47c26a[_0x333584(0x12b)])+parseInt(_0x5974ce[_0x333584(0x18f)]));});}),await _0x42098f[_0x5382d3(0x11a)]();const _0x289da3=_0x34248c[_0x5382d3(0x175)](_0x456181=>_0x456181['return_qty']!=='0'&&_0x456181[_0x5382d3(0x1cf)]!=='');var _0x3b612c=0x0;_0x289da3['forEach'](_0x48bcb7=>{var _0x530e99=_0x5382d3;console['log'](_0x530e99(0x16a),_0x48bcb7),(parseInt(_0x48bcb7['purchase_quantity'])<parseInt(_0x48bcb7['return_qty'])||parseInt(_0x48bcb7[_0x530e99(0x13a)])<parseInt(_0x48bcb7['return_qty']))&&_0x3b612c++;});if(_0x3b612c!=0x0)return _0x296230[_0x5382d3(0xea)](_0x5382d3(0x1b2),_0x5382d3(0x13c)),_0x4f65c7['redirect'](_0x5382d3(0x194));const _0x45f8c3=new purchases_return({'invoice':_0x22491a,'suppliers':_0x296230['body']['suppliers'],'date':_0x270d0d,'warehouse_name':_0x5505bf,'return_product':_0x289da3,'note':_0x3f42dd,'room':_0x25b74b,'to_warehouse_name':_0x2d4bf0,'to_room':_0x347891}),_0xd8a42c=await _0x45f8c3[_0x5382d3(0x11a)]();console[_0x5382d3(0x12c)](_0x45f8c3);const _0x4167a6=await purchases_return['findOne']({'invoice':_0x22491a}),_0x9c7f29=await warehouse[_0x5382d3(0x13f)]({'name':_0x2d4bf0,'room':_0x347891});_0x4167a6[_0x5382d3(0x1b3)][_0x5382d3(0xdd)](_0x3155b2=>{var _0x414c3d=_0x5382d3,_0x53023a=0x0;const _0x3f5423=_0x9c7f29[_0x414c3d(0x165)][_0x414c3d(0x131)](_0x1fb361=>{var _0x3549e5=_0x414c3d;_0x1fb361[_0x3549e5(0x1ef)]==_0x3155b2[_0x3549e5(0x1ef)]&&_0x1fb361[_0x3549e5(0x15e)]==_0x3155b2[_0x3549e5(0x15e)]&&_0x1fb361['type']==_0x3155b2['type']&&_0x1fb361[_0x3549e5(0x16d)]==_0x3155b2[_0x3549e5(0x16d)]&&_0x1fb361[_0x3549e5(0xfe)]==_0x3155b2[_0x3549e5(0xfe)]&&(_0x1fb361[_0x3549e5(0x12b)]=parseInt(_0x1fb361[_0x3549e5(0x12b)])-parseInt(_0x3155b2[_0x3549e5(0x1cf)]),_0x53023a++);});_0x53023a=='0'&&(_0x9c7f29['product_details']=_0x9c7f29[_0x414c3d(0x165)][_0x414c3d(0x17e)]({'product_name':_0x3155b2['product_name'],'product_stock':_0x3155b2['return_qty'],'primary_code':_0x3155b2[_0x414c3d(0x1c0)],'secondary_code':_0x3155b2[_0x414c3d(0xf3)],'product_code':_0x3155b2[_0x414c3d(0x16f)],'storage':_0x3155b2['storage'],'rack':_0x3155b2['rack'],'bay':_0x3155b2[_0x414c3d(0xfe)],'bin':_0x3155b2[_0x414c3d(0x16d)],'type':_0x3155b2[_0x414c3d(0xd3)],'floorlevel':_0x3155b2[_0x414c3d(0x15e)],'maxProducts':_0x3155b2[_0x414c3d(0x135)],'unit':_0x3155b2[_0x414c3d(0x1db)],'secondary_unit':_0x3155b2[_0x414c3d(0x18b)],'expiry_date':_0x3155b2[_0x414c3d(0xee)]}));}),await _0x9c7f29[_0x5382d3(0x11a)]();const _0x3d14bc=await purchases[_0x5382d3(0x13f)]({'invoice':_0x22491a});_0x3d14bc[_0x5382d3(0x191)]='True';const _0x476da9=await _0x3d14bc[_0x5382d3(0x11a)](),_0x42a9be=new s_payment_data({'invoice':_0x22491a,'suppliers':_0x296230[_0x5382d3(0x183)][_0x5382d3(0x199)],'reason':_0x5382d3(0x144)});await _0x42a9be[_0x5382d3(0x11a)]();const _0x48b358=await master_shop[_0x5382d3(0x16c)]();console[_0x5382d3(0x12c)](_0x5382d3(0x196),_0x48b358[0x0][_0x5382d3(0xf8)]);const _0x34e8e0=await email_settings[_0x5382d3(0x13f)](),_0x304cdf=await suppliers[_0x5382d3(0x13f)]({'name':_0x296230[_0x5382d3(0x183)][_0x5382d3(0x199)]});console[_0x5382d3(0x12c)]('suppliers_data',_0x304cdf);_0x48b358[0x0][_0x5382d3(0x110)]==0x1?(right_currency=_0x48b358[0x0][_0x5382d3(0x132)],left_currency=''):(right_currency='',left_currency=_0x48b358[0x0][_0x5382d3(0x132)]);var _0x4376cf=_0x26e591,_0x2abd59=_0x52c1e2,_0x401efb='',_0x22a375;for(_0x22a375 in _0x4376cf){_0x401efb+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4376cf[_0x22a375]+'</td>'+_0x5382d3(0xd9)+_0x2abd59[_0x22a375]+_0x5382d3(0x108)+_0x5382d3(0x1c2);}console[_0x5382d3(0x12c)](_0x5382d3(0x1e5),_0x401efb);let _0x2dc0db=nodemailer[_0x5382d3(0x189)]({'service':_0x5382d3(0x184),'auth':{'user':_0x34e8e0[_0x5382d3(0x1d8)],'pass':_0x34e8e0[_0x5382d3(0xfa)]}}),_0x2d7b68={'from':_0x34e8e0[_0x5382d3(0x1d8)],'to':_0x304cdf[_0x5382d3(0x1d8)],'subject':'Purchase\x20Return\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x5382d3(0x1f1)+_0x5382d3(0x127)+_0x48b358[0x0][_0x5382d3(0xf8)],'cid':_0x5382d3(0x1a8)}],'html':_0x5382d3(0x124)+'<html><head><title></title>'+_0x5382d3(0x1dd)+_0x5382d3(0xf4)+_0x5382d3(0x18c)+_0x5382d3(0xf4)+_0x5382d3(0x1a0)+_0x5382d3(0x181)+_0x5382d3(0xf4)+_0x5382d3(0x17d)+_0x48b358[0x0][_0x5382d3(0xf9)]+'\x20</h2>'+_0x5382d3(0x181)+_0x5382d3(0x181)+'<hr\x20class=\x22my-3\x22>'+_0x5382d3(0xf4)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x22491a+'\x20'+_0x5382d3(0x185)+_0x5382d3(0x1ad)+_0x270d0d+'\x20'+_0x5382d3(0x1ca)+_0x5382d3(0x119)+'</div>'+_0x5382d3(0xe8)+_0x5382d3(0x156)+_0x5382d3(0x1a3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x5382d3(0xf5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+_0x5382d3(0x1c2)+_0x5382d3(0x11e)+_0x5382d3(0x1bb)+'\x20'+_0x401efb+'\x20'+'</tbody>'+_0x5382d3(0x1ce)+_0x5382d3(0xf4)+_0x5382d3(0x134)+_0x5382d3(0xda)+_0x48b358[0x0][_0x5382d3(0xf9)]+_0x5382d3(0x119)+_0x5382d3(0x181)+_0x5382d3(0x181)+'</body></html>'};_0x2dc0db[_0x5382d3(0x169)](_0x2d7b68,function(_0x590879,_0x26676f){var _0x194e32=_0x5382d3;_0x590879?(console[_0x194e32(0x12c)](_0x590879),console['log'](_0x194e32(0x12e))):console[_0x194e32(0x12c)]('Email\x20sent\x20successfully');}),_0x296230[_0x5382d3(0xea)](_0x5382d3(0x19c),_0x5382d3(0x1bf)),_0x4f65c7[_0x5382d3(0xde)](_0x5382d3(0xf7));}catch(_0x2ecb21){console['log'](_0x2ecb21),_0x4f65c7['status'](0xc8)[_0x5382d3(0x143)]({'message':_0x2ecb21[_0x5382d3(0x193)]});}}),router['get'](a0_0xce45da(0x101),auth,async(_0x382e8e,_0x21540c)=>{var _0x2743a3=a0_0xce45da;try{const {username:_0x3c4c7a,email:_0x1c51b1,role:_0x1b6272}=_0x382e8e['user'],_0x17d1af=_0x382e8e[_0x2743a3(0x168)],_0x32e39e=await profile[_0x2743a3(0x13f)]({'email':_0x17d1af[_0x2743a3(0x1d8)]}),_0xfebc86=await master_shop[_0x2743a3(0x16c)](),_0x1d3760=_0x382e8e['params']['id'],_0xc17f03=await purchases[_0x2743a3(0xff)](_0x1d3760);if(_0xfebc86[0x0]['language']==_0x2743a3(0x1b8))var _0x537660=users[_0x2743a3(0x18e)];else{if(_0xfebc86[0x0][_0x2743a3(0x136)]==_0x2743a3(0x1da))var _0x537660=users[_0x2743a3(0x1da)];else{if(_0xfebc86[0x0][_0x2743a3(0x136)]=='German')var _0x537660=users[_0x2743a3(0xe4)];else{if(_0xfebc86[0x0][_0x2743a3(0x136)]=='Spanish')var _0x537660=users[_0x2743a3(0x1e2)];else{if(_0xfebc86[0x0]['language']==_0x2743a3(0x140))var _0x537660=users[_0x2743a3(0x140)];else{if(_0xfebc86[0x0]['language']==_0x2743a3(0x1e3))var _0x537660=users['Portuguese'];else{if(_0xfebc86[0x0][_0x2743a3(0x136)]==_0x2743a3(0x14c))var _0x537660=users[_0x2743a3(0x14c)];else{if(_0xfebc86[0x0]['language']=='Arabic\x20(ae)')var _0x537660=users[_0x2743a3(0x1e7)];}}}}}}}_0x21540c[_0x2743a3(0x171)](_0x2743a3(0x139),{'success':_0x382e8e[_0x2743a3(0xea)](_0x2743a3(0x19c)),'errors':_0x382e8e[_0x2743a3(0xea)](_0x2743a3(0x1b2)),'role':_0x17d1af,'profile':_0x32e39e,'alldata':_0xc17f03,'master_shop':_0xfebc86,'language':_0x537660}),console['log'](alldata);}catch(_0x4ab19f){console[_0x2743a3(0x12c)](_0x4ab19f);}}),router['post'](a0_0xce45da(0x14b),async(_0x59e5d8,_0x322644)=>{var _0x5a9d96=a0_0xce45da;const {product_code:_0x594eb2}=_0x59e5d8[_0x5a9d96(0x183)];var _0x50aadc;const _0x13958a=await product[_0x5a9d96(0x1b5)]([{'$match':{'primary_code':_0x594eb2,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x5a9d96(0x1d2),'name':{'$first':'$name'},'category':{'$first':_0x5a9d96(0x1b4)},'brand':{'$first':_0x5a9d96(0xdf)},'unit':{'$first':_0x5a9d96(0x138)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x5a9d96(0x13d)},'primary_code':{'$first':_0x5a9d96(0x177)},'secondary_code':{'$first':_0x5a9d96(0x1b7)},'maxStocks':{'$first':_0x5a9d96(0x1a2)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5a9d96(0x195)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x33fa2e=await product[_0x5a9d96(0x1b5)]([{'$match':{'secondary_code':_0x594eb2,'product_category':_0x5a9d96(0x148)}},{'$group':{'_id':_0x5a9d96(0x1d2),'name':{'$first':_0x5a9d96(0x172)},'category':{'$first':_0x5a9d96(0x1b4)},'brand':{'$first':_0x5a9d96(0xdf)},'unit':{'$first':_0x5a9d96(0x138)},'alertquantity':{'$first':_0x5a9d96(0x146)},'product_code':{'$first':_0x5a9d96(0x13d)},'primary_code':{'$first':_0x5a9d96(0x177)},'secondary_code':{'$first':_0x5a9d96(0x1b7)},'maxStocks':{'$first':_0x5a9d96(0x1a2)},'maxProdPerUnit':{'$first':_0x5a9d96(0x10c)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5a9d96(0x195)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x13958a['length']>0x0)_0x50aadc=_0x13958a;else _0x33fa2e[_0x5a9d96(0x153)]>0x0&&(_0x50aadc=_0x33fa2e);_0x322644[_0x5a9d96(0x143)](_0x50aadc);}),router['post']('/CheckingWarehouse',async(_0x339348,_0x1e2a21)=>{var _0x1e6ac9=a0_0xce45da;const {primaryCode:_0x31b767,secondaryCode:_0x1a2d83,productCode:_0x3fcde6,bay:_0x4dabc4,bin:_0x4c99e8,types:_0x849ffe,pallet:_0x25b7f5,warehouses:_0x53e91f,room:_0x5c557d}=_0x339348['body'];console[_0x1e6ac9(0x12c)](_0x339348[_0x1e6ac9(0x183)]);try{const _0x1ff458=await warehouse['aggregate']([{'$match':{'name':_0x53e91f,'room':_0x5c557d}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x4dabc4,'product_details.bin':_0x4c99e8,'product_details.type':_0x849ffe}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1e6ac9(0x1d7)},'product_stock':{'$first':_0x1e6ac9(0xd6)},'level':{'$first':_0x1e6ac9(0x133)},'isle':{'$first':_0x1e6ac9(0x17a)},'pallet':{'$first':_0x1e6ac9(0x10f)},'maxProducts':{'$first':_0x1e6ac9(0x167)}}}]);_0x1e2a21['status'](0xc8)[_0x1e6ac9(0x143)](_0x1ff458);}catch(_0x1d5ddc){_0x1e2a21['status'](0x194)[_0x1e6ac9(0x143)]({'message':_0x1d5ddc[_0x1e6ac9(0x193)]});}}),module[a0_0xce45da(0x1df)]=router;