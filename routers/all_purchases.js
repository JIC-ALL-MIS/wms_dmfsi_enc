var a0_0x37d6eb=a0_0x57e5;(function(_0x4bbf3e,_0x601a5a){var _0x2fe00a=a0_0x57e5,_0x5201a7=_0x4bbf3e();while(!![]){try{var _0x3f1d4f=parseInt(_0x2fe00a(0x24b))/0x1*(-parseInt(_0x2fe00a(0x269))/0x2)+parseInt(_0x2fe00a(0x1d2))/0x3*(-parseInt(_0x2fe00a(0x26f))/0x4)+parseInt(_0x2fe00a(0x224))/0x5+parseInt(_0x2fe00a(0x1b3))/0x6+-parseInt(_0x2fe00a(0x283))/0x7+parseInt(_0x2fe00a(0x20a))/0x8*(-parseInt(_0x2fe00a(0x23e))/0x9)+parseInt(_0x2fe00a(0x246))/0xa;if(_0x3f1d4f===_0x601a5a)break;else _0x5201a7['push'](_0x5201a7['shift']());}catch(_0x141798){_0x5201a7['push'](_0x5201a7['shift']());}}}(a0_0x367d,0x21d0e));const express=require('express'),app=express(),router=express[a0_0x37d6eb(0x2ac)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x37d6eb(0x1ca)),auth=require(a0_0x37d6eb(0x216)),nodemailer=require(a0_0x37d6eb(0x249));var ejs=require('ejs');const path=require(a0_0x37d6eb(0x1c4)),users=require(a0_0x37d6eb(0x258));function a0_0x57e5(_0x45918c,_0x59382c){var _0x367d21=a0_0x367d();return a0_0x57e5=function(_0x57e53a,_0x153343){_0x57e53a=_0x57e53a-0x19b;var _0x2632b0=_0x367d21[_0x57e53a];return _0x2632b0;},a0_0x57e5(_0x45918c,_0x59382c);}router[a0_0x37d6eb(0x23c)]('/view',auth,async(_0x4f3550,_0x4006b3)=>{var _0x4e0206=a0_0x37d6eb;try{const {username:_0x5e874b,email:_0x1c9921,role:_0x1109c9}=_0x4f3550[_0x4e0206(0x1fa)],_0x3863c5=_0x4f3550[_0x4e0206(0x1fa)],_0x232eb3=await profile['findOne']({'email':_0x3863c5[_0x4e0206(0x1be)]}),_0x4c9a9d=await staff['findOne']({'email':_0x3863c5[_0x4e0206(0x1be)]});if(_0x3863c5['role']==_0x4e0206(0x2b2)){const _0xe2e8da=await staff[_0x4e0206(0x204)]({'email':_0x3863c5[_0x4e0206(0x1be)]});}const _0x2da36e=await master_shop[_0x4e0206(0x2ae)]();let _0x2a9bc2;if(_0x3863c5['role']=='staff'){const _0x2ad13f=await staff['findOne']({'email':_0x3863c5[_0x4e0206(0x1be)]});_0x2a9bc2=await purchases[_0x4e0206(0x287)]([{'$match':{'warehouse_name':_0x2ad13f['warehouse']}},{'$lookup':{'from':'suppliers','localField':_0x4e0206(0x253),'foreignField':_0x4e0206(0x293),'as':_0x4e0206(0x1e4)}},{'$unwind':_0x4e0206(0x1ee)},{'$unwind':_0x4e0206(0x243)},{'$group':{'_id':'$_id','invoice':{'$first':_0x4e0206(0x1ef)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x4e0206(0x24e)},'warehouse_name':{'$first':_0x4e0206(0x27c)},'room':{'$first':_0x4e0206(0x1ab)},'product':{'$push':'$product'},'note':{'$first':_0x4e0206(0x26e)},'paid_amount':{'$first':_0x4e0206(0x1d8)},'due_amount':{'$first':_0x4e0206(0x20d)},'return_data':{'$first':_0x4e0206(0x267)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x4e0206(0x1a3)},'suppliers_docs':{'$first':_0x4e0206(0x1ee)},'total_product_quantity':{'$sum':_0x4e0206(0x276)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x4e0206(0x1b9)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x4e0206(0x1fd)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2a9bc2=await purchases[_0x4e0206(0x287)]([{'$lookup':{'from':_0x4e0206(0x253),'localField':_0x4e0206(0x253),'foreignField':_0x4e0206(0x293),'as':_0x4e0206(0x1e4)}},{'$unwind':'$suppliers_docs'},{'$unwind':_0x4e0206(0x243)},{'$group':{'_id':_0x4e0206(0x298),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x4e0206(0x274)},'date':{'$first':_0x4e0206(0x24e)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x4e0206(0x219)},'product':{'$push':_0x4e0206(0x243)},'note':{'$first':_0x4e0206(0x26e)},'paid_amount':{'$first':_0x4e0206(0x1d8)},'due_amount':{'$first':_0x4e0206(0x20d)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x4e0206(0x1bf)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x4e0206(0x1ee)},'total_product_quantity':{'$sum':_0x4e0206(0x276)},'level':{'$addToSet':_0x4e0206(0x202)},'isle':{'$addToSet':_0x4e0206(0x1b9)},'type':{'$addToSet':_0x4e0206(0x21a)},'floorlevel':{'$addToSet':_0x4e0206(0x1fd)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2da36e[0x0][_0x4e0206(0x27b)]==_0x4e0206(0x25e)){var _0x3ea5ae=users[_0x4e0206(0x1b5)];console[_0x4e0206(0x263)](_0x3ea5ae);}else{if(_0x2da36e[0x0]['language']==_0x4e0206(0x286))var _0x3ea5ae=users['Hindi'];else{if(_0x2da36e[0x0][_0x4e0206(0x27b)]==_0x4e0206(0x1b2))var _0x3ea5ae=users[_0x4e0206(0x1b2)];else{if(_0x2da36e[0x0]['language']=='Spanish')var _0x3ea5ae=users[_0x4e0206(0x1d3)];else{if(_0x2da36e[0x0][_0x4e0206(0x27b)]==_0x4e0206(0x254))var _0x3ea5ae=users[_0x4e0206(0x254)];else{if(_0x2da36e[0x0][_0x4e0206(0x27b)]=='Portuguese\x20(BR)')var _0x3ea5ae=users[_0x4e0206(0x240)];else{if(_0x2da36e[0x0][_0x4e0206(0x27b)]==_0x4e0206(0x217))var _0x3ea5ae=users[_0x4e0206(0x217)];else{if(_0x2da36e[0x0][_0x4e0206(0x27b)]==_0x4e0206(0x1bd))var _0x3ea5ae=users[_0x4e0206(0x211)];}}}}}}}_0x4006b3['render']('all_purchases',{'success':_0x4f3550[_0x4e0206(0x1ea)](_0x4e0206(0x1af)),'errors':_0x4f3550[_0x4e0206(0x1ea)]('errors'),'purchases':_0x2a9bc2,'role':_0x3863c5,'profile':_0x232eb3,'master_shop':_0x2da36e,'language':_0x3ea5ae});}catch(_0x14645f){console['log'](_0x4e0206(0x25b),_0x14645f),_0x4006b3[_0x4e0206(0x1b1)](0xc8)['json']({'message':_0x14645f[_0x4e0206(0x22e)]});}});function BayBinSelected(_0x12801c,_0x8ad3e8){var _0x54cd0f=a0_0x37d6eb,_0x1a35b9=[],_0x88c5b1=[],_0x1fde65=[],_0x46cdef=[],_0x4ea7c7=[],_0xdb1c4e=[];let _0x52f9a0=[];if(_0x12801c==_0x54cd0f(0x1d1))switch(_0x8ad3e8){case _0x54cd0f(0x29c):_0x1a35b9=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x88c5b1=[0x1,0x2],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x26b),_0x54cd0f(0x1a6)],_0x4ea7c7=['D'],_0xdb1c4e=['A'];break;case _0x54cd0f(0x1a1):_0x1a35b9=[0x6,0x5,0x4,0x3,0x2,0x1],_0x88c5b1=[0x1,0x2],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x26b),'Floor'],_0x4ea7c7=['D'],_0xdb1c4e=['B'];break;case _0x54cd0f(0x1aa):_0x1a35b9=[0x0],_0x88c5b1=[0x0],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x1a6)],_0x4ea7c7=['D'],_0xdb1c4e=['S'];break;case _0x54cd0f(0x201):_0x1a35b9=[0x0],_0x88c5b1=[0x0],_0x46cdef=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1fde65=[_0x54cd0f(0x1a6)],_0x4ea7c7=['D'],_0xdb1c4e=['R'];break;}else{if(_0x12801c==_0x54cd0f(0x2b3))switch(_0x8ad3e8){case _0x54cd0f(0x29c):_0x1a35b9=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x88c5b1=['B','F'],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x26b),_0x54cd0f(0x1a6)],_0x4ea7c7=['C'],_0xdb1c4e=['A'];break;case'Rack\x20B':_0x1a35b9=[0x5,0x4,0x3,0x2,0x1],_0x88c5b1=['F','B','S'],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x26b),_0x54cd0f(0x1a6)],_0x4ea7c7=['C'],_0xdb1c4e=['B'];break;case _0x54cd0f(0x1c8):_0x1a35b9=[0x1,0x2,0x3,0x4,0x5],_0x88c5b1=['B','F','S'],_0x46cdef=[0x5,0x4,0x3,0x2,0x1],_0x1fde65=['Level',_0x54cd0f(0x1a6)],_0x4ea7c7=['C'],_0xdb1c4e=['C'];break;case _0x54cd0f(0x1c3):_0x1a35b9=[0x5,0x4,0x3,0x2,0x1],_0x88c5b1=['F','B','S'],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x26b),_0x54cd0f(0x1a6)],_0x4ea7c7=['C'],_0xdb1c4e=['D'];break;case _0x54cd0f(0x282):_0x1a35b9=[0x4,0x3,0x2,0x1],_0x88c5b1=[0x1,0x2],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=['Level',_0x54cd0f(0x1a6)],_0x4ea7c7=['C'],_0xdb1c4e=['E'];break;case _0x54cd0f(0x1e0):_0x1a35b9=[0x1,0x2,0x3],_0x88c5b1=[0x1,0x2],_0x46cdef=[0x1,0x2,0x3,0x4,0x5],_0x1fde65=[_0x54cd0f(0x26b)],_0x4ea7c7=['C'],_0xdb1c4e=['F'];break;}}return{'levels':_0x1a35b9,'Isle':_0x88c5b1,'rack':_0x46cdef,'type':_0x1fde65,'storage':_0x4ea7c7,'rak':_0xdb1c4e};}async function getRandom8DigitNumber(){var _0x19e349=a0_0x37d6eb;const _0x267169=0x989680,_0x20f6fc=0x5f5e0ff,_0x1a6bdf=Math[_0x19e349(0x2b5)](Math[_0x19e349(0x251)]()*(_0x20f6fc-_0x267169+0x1))+_0x267169;var _0x3f824d;const _0x232ff9=await purchases[_0x19e349(0x204)]({'invoice':_0x19e349(0x2a2)+_0x1a6bdf});return _0x232ff9&&_0x232ff9[_0x19e349(0x285)]>0x0?_0x3f824d=_0x19e349(0x2a2)+_0x1a6bdf:_0x3f824d=_0x19e349(0x2a2)+_0x1a6bdf,_0x3f824d;}router['get'](a0_0x37d6eb(0x220),auth,async(_0x348927,_0x3a0ac5)=>{var _0x12801e=a0_0x37d6eb;try{const {username:_0x125f5e,email:_0x270f82,role:_0x3c820e}=_0x348927[_0x12801e(0x1fa)],_0x2c8a6a=_0x348927[_0x12801e(0x1fa)],_0x23f69c=await profile['findOne']({'email':_0x2c8a6a['email']}),_0x4553d8=await master_shop[_0x12801e(0x2ae)](),_0x2305cd=await staff[_0x12801e(0x204)]({'email':_0x2c8a6a['email']}),_0x30b3e0=await suppliers[_0x12801e(0x2ae)]({});let _0x5cfafa;if(_0x2c8a6a[_0x12801e(0x19c)]==_0x12801e(0x2b2)){const _0xfba135=await staff['findOne']({'email':_0x2c8a6a[_0x12801e(0x1be)]});_0x5cfafa=await warehouse[_0x12801e(0x287)]([{'$match':{'status':_0x12801e(0x1cb),'name':_0xfba135[_0x12801e(0x28d)],'warehouse_category':_0x12801e(0x27f),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x12801e(0x1cf)}}}]);}else _0x5cfafa=await warehouse[_0x12801e(0x287)]([{'$match':{'status':_0x12801e(0x1cb),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x12801e(0x1ba)}}},{'$group':{'_id':_0x12801e(0x1cf),'name':{'$first':'$name'}}}]);const _0x579d68=await product['find']({}),_0x2af6fa=await warehouse[_0x12801e(0x2ae)]({'status':_0x12801e(0x1cb)}),_0x1e37d4=await purchases[_0x12801e(0x2ae)]({}),_0xa11955=_0x1e37d4[_0x12801e(0x285)]+0x1,_0x53799f=_0x12801e(0x2a2)+_0xa11955['toString']()['padStart'](0x5,'0');var _0x1f6f1d=[_0x12801e(0x2a3),_0x12801e(0x256)];if(_0x4553d8[0x0][_0x12801e(0x27b)]==_0x12801e(0x25e))var _0x259f96=users[_0x12801e(0x1b5)];else{if(_0x4553d8[0x0]['language']==_0x12801e(0x286))var _0x259f96=users[_0x12801e(0x286)];else{if(_0x4553d8[0x0][_0x12801e(0x27b)]==_0x12801e(0x1b2))var _0x259f96=users[_0x12801e(0x1b2)];else{if(_0x4553d8[0x0]['language']==_0x12801e(0x1d3))var _0x259f96=users[_0x12801e(0x1d3)];else{if(_0x4553d8[0x0][_0x12801e(0x27b)]==_0x12801e(0x254))var _0x259f96=users[_0x12801e(0x254)];else{if(_0x4553d8[0x0][_0x12801e(0x27b)]==_0x12801e(0x1a0))var _0x259f96=users[_0x12801e(0x240)];else{if(_0x4553d8[0x0][_0x12801e(0x27b)]=='Chinese')var _0x259f96=users['Chinese'];else{if(_0x4553d8[0x0][_0x12801e(0x27b)]==_0x12801e(0x1bd))var _0x259f96=users[_0x12801e(0x211)];}}}}}}}const _0x4e807d=getRandom8DigitNumber();_0x4e807d[_0x12801e(0x1f2)](_0x2b9c0e=>{var _0x4f5314=_0x12801e;_0x3a0ac5['render']('add_purchases',{'success':_0x348927[_0x4f5314(0x1ea)](_0x4f5314(0x1af)),'errors':_0x348927[_0x4f5314(0x1ea)](_0x4f5314(0x2b4)),'role':_0x2c8a6a,'profile':_0x23f69c,'suppliers':_0x30b3e0,'warehouse':_0x5cfafa,'product':_0x579d68,'invoice':_0x2b9c0e,'master_shop':_0x4553d8,'language':_0x259f96,'find_data':_0x2af6fa,'rooms_data':_0x1f6f1d});})[_0x12801e(0x23b)](_0x48f160=>{var _0x196e91=_0x12801e;_0x348927[_0x196e91(0x1ea)](_0x196e91(0x2b4),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x3a0ac5[_0x196e91(0x235)](_0x196e91(0x25c));});}catch(_0x5f3e4){console[_0x12801e(0x263)](_0x5f3e4);}}),router[a0_0x37d6eb(0x23c)](a0_0x37d6eb(0x265),auth,async(_0x5723ef,_0x5000bf)=>{var _0x8cbd2=a0_0x37d6eb;try{const _0x498aed=_0x5723ef[_0x8cbd2(0x225)]['id'];console[_0x8cbd2(0x263)](_0x498aed);const _0x5d750c=await master_shop[_0x8cbd2(0x2ae)]();console[_0x8cbd2(0x263)](_0x8cbd2(0x223),_0x5d750c);const _0x1ce774=await product[_0x8cbd2(0x204)]({'name':_0x498aed});console[_0x8cbd2(0x263)](_0x8cbd2(0x2a6),_0x1ce774),_0x5000bf[_0x8cbd2(0x1b1)](0xc8)[_0x8cbd2(0x278)]({'product_data':_0x1ce774,'master':_0x5d750c});}catch(_0x5d29a9){console[_0x8cbd2(0x263)](_0x8cbd2(0x2a8),_0x5d29a9);}}),router[a0_0x37d6eb(0x1d9)](a0_0x37d6eb(0x220),auth,async(_0x37633f,_0x3dc335)=>{var _0x299e34=a0_0x37d6eb;try{const {invoice:_0x6e7e20,date:_0xaa49a9,warehouse_name:_0xb8a0e0,prod_name:_0x40192c,prod_code:_0x3f0f7d,prod_qty:_0x1f5a60,prod_unit:_0x63b55d,prod_secondunit:_0xedb0e9,prod_level:_0x55a9a8,prod_isle:_0x2c20dd,prod_pallet:_0x22cc39,note:_0x5e5b,expiry_date:_0x2d18e6,batch_code:_0x3dfe0b,payable:_0x2ca1f6,due_amount:_0x4af83,Room_name:_0x1356f8,primary_code:_0x109931,secondary_code:_0x10ede4,MaxStocks_data:_0x49a336,PO_number:_0x3c32a6,SCRN:_0x20e9b7,JO_number:_0x548cb5}=_0x37633f[_0x299e34(0x1c2)];if(typeof _0x40192c==_0x299e34(0x1c7))var _0x47f483=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x29b)]],_0x5df8ed=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x21d)]],_0x23412c=[_0x37633f[_0x299e34(0x1c2)]['prod_Qty']],_0x31a610=[_0x37633f['body']['prod_primunit']],_0xfa83b6=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x268)]],_0x3cba28=[_0x37633f['body'][_0x299e34(0x19d)]],_0xf7ee62=[_0x37633f[_0x299e34(0x1c2)]['primary_code']],_0xd54684=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x1f5)]],_0x120d49=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x28b)]],_0x3077d3=[_0x37633f[_0x299e34(0x1c2)]['batch_code']],_0x207e80=[_0x37633f['body'][_0x299e34(0x1e2)]],_0x4fb98c=[_0x37633f[_0x299e34(0x1c2)]['max_product_unit']],_0x84439e=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x226)]],_0x4f0671=[_0x37633f[_0x299e34(0x1c2)]['production_date']],_0x50e911=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x2a1)]],_0x4bdc87=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x1e7)]],_0x8a59c=[_0x37633f[_0x299e34(0x1c2)]['deliverycode']],_0x4fef4a=[_0x37633f['body'][_0x299e34(0x234)]],_0xe14ca6=[_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x29f)]],_0x2a64cf=[_0x37633f[_0x299e34(0x1c2)]['actual_uom']];else var _0x47f483=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x29b)]],_0x5df8ed=[..._0x37633f[_0x299e34(0x1c2)]['prod_code']],_0x23412c=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x2b0)]],_0x31a610=[..._0x37633f[_0x299e34(0x1c2)]['prod_primunit']],_0xfa83b6=[..._0x37633f[_0x299e34(0x1c2)]['prod_secondunit']],_0x3cba28=[..._0x37633f['body'][_0x299e34(0x19d)]],_0xf7ee62=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x218)]],_0xd54684=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x1f5)]],_0x120d49=[..._0x37633f['body']['MaxStocks_data']],_0x3077d3=[..._0x37633f['body'][_0x299e34(0x221)]],_0x207e80=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x1e2)]],_0x4fb98c=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x275)]],_0x84439e=[..._0x37633f['body']['alertQTY']],_0x4f0671=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x21c)]],_0x50e911=[..._0x37633f['body'][_0x299e34(0x2a1)]],_0x4bdc87=[..._0x37633f[_0x299e34(0x1c2)]['RoomAssign']],_0x8a59c=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x2aa)]],_0x4fef4a=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x234)]],_0xe14ca6=[..._0x37633f[_0x299e34(0x1c2)]['actual_qty']],_0x2a64cf=[..._0x37633f[_0x299e34(0x1c2)][_0x299e34(0x1c9)]];const _0x511e01=_0x47f483[_0x299e34(0x266)](_0x5ca0ac=>{return _0x5ca0ac={'product_name':_0x5ca0ac};});_0xe14ca6['forEach']((_0x22454d,_0x28b3f7)=>{var _0x4be93d=_0x299e34;_0x511e01[_0x28b3f7][_0x4be93d(0x29f)]=Math[_0x4be93d(0x208)](_0x22454d);}),_0x2a64cf[_0x299e34(0x1ec)]((_0x1b1abf,_0x3faa28)=>{var _0x6d98bc=_0x299e34;_0x511e01[_0x3faa28][_0x6d98bc(0x1c9)]=_0x1b1abf;}),_0x5df8ed[_0x299e34(0x1ec)]((_0x1df1c1,_0x4e4a4b)=>{var _0x1ad12b=_0x299e34;_0x511e01[_0x4e4a4b][_0x1ad12b(0x233)]=_0x1df1c1;}),_0x23412c[_0x299e34(0x1ec)]((_0x400093,_0x273877)=>{_0x511e01[_0x273877]['quantity']=Math['abs'](_0x400093);}),_0x31a610['forEach']((_0x324987,_0x393713)=>{var _0x373489=_0x299e34;_0x511e01[_0x393713][_0x373489(0x281)]=_0x324987;}),_0xfa83b6[_0x299e34(0x1ec)]((_0x917dfc,_0x5300c1)=>{var _0x40770a=_0x299e34;_0x511e01[_0x5300c1][_0x40770a(0x1e8)]=_0x917dfc;}),_0x3cba28[_0x299e34(0x1ec)]((_0xe7a019,_0x573c43)=>{var _0x47c503=_0x299e34;_0x4bdc87[_0x47c503(0x1ec)]((_0x2b0be1,_0x29c592)=>{var _0x4e4e61=_0x47c503;if(_0x2b0be1==_0x4e4e61(0x201)&&_0x573c43==_0x29c592){console[_0x4e4e61(0x263)](_0x2b0be1+_0x4e4e61(0x2b8)+_0x573c43+'\x20<>\x20'+_0x29c592+'\x20<>\x20'+_0xe7a019);var _0x5b4a40=_0xe7a019[_0x4e4e61(0x242)](0x3);_0x511e01[_0x573c43][_0x4e4e61(0x228)]=_0xe7a019[0x0],_0x511e01[_0x573c43][_0x4e4e61(0x22f)]=_0xe7a019[0x1],_0x511e01[_0x573c43][_0x4e4e61(0x2bb)]=0x0,_0x511e01[_0x573c43]['bin']=0x0,_0x511e01[_0x573c43][_0x4e4e61(0x1c0)]=_0x4e4e61(0x1a6),_0x511e01[_0x573c43][_0x4e4e61(0x25f)]=_0x5b4a40;}else{if(_0x2b0be1==_0x4e4e61(0x1aa)&&_0x573c43==_0x29c592){var _0x5b4a40=_0xe7a019[_0x4e4e61(0x242)](0x3);_0x511e01[_0x573c43]['storage']=_0xe7a019[0x0],_0x511e01[_0x573c43][_0x4e4e61(0x22f)]=_0xe7a019[0x1],_0x511e01[_0x573c43]['bay']=0x0,_0x511e01[_0x573c43][_0x4e4e61(0x227)]=0x0,_0x511e01[_0x573c43][_0x4e4e61(0x1c0)]=_0x4e4e61(0x1a6),_0x511e01[_0x573c43][_0x4e4e61(0x25f)]=_0xe7a019[0x5];}else{if(_0x573c43==_0x29c592){if(_0xe7a019[0x0]=='A'&&_0xe7a019[0x1]=='L'&&_0xe7a019[0x2]=='L')console[_0x4e4e61(0x263)](_0x2b0be1+'\x20<>\x20'+_0x573c43+_0x4e4e61(0x1db)+_0x29c592+_0x4e4e61(0x1db)+_0xe7a019+_0x4e4e61(0x25d)),_0x511e01[_0x573c43][_0x4e4e61(0x228)]=_0xe7a019[0x0],_0x511e01[_0x573c43][_0x4e4e61(0x22f)]=_0xe7a019[0x1],_0x511e01[_0x573c43][_0x4e4e61(0x2bb)]=0x0,_0x511e01[_0x573c43][_0x4e4e61(0x227)]=0x0,_0x511e01[_0x573c43][_0x4e4e61(0x1c0)]=_0x4e4e61(0x1a6),_0x511e01[_0x573c43]['floorlevel']=_0xe7a019[0x3];else{var _0x1bafda;if(_0xe7a019[0x4]=='L')_0x1bafda=_0x4e4e61(0x26b);else _0xe7a019[0x4]=='F'&&(_0x1bafda='Floor');_0x511e01[_0x573c43]['storage']=_0xe7a019[0x0],_0x511e01[_0x573c43][_0x4e4e61(0x22f)]=_0xe7a019[0x1],_0x511e01[_0x573c43][_0x4e4e61(0x2bb)]=_0xe7a019[0x2],_0x511e01[_0x573c43][_0x4e4e61(0x227)]=_0xe7a019[0x3],_0x511e01[_0x573c43][_0x4e4e61(0x1c0)]=_0x1bafda,_0x511e01[_0x573c43][_0x4e4e61(0x25f)]=_0xe7a019[0x5];}}}}});}),_0xf7ee62[_0x299e34(0x1ec)]((_0x5ad009,_0x3ba3a6)=>{_0x511e01[_0x3ba3a6]['primary_code']=_0x5ad009;}),_0xd54684[_0x299e34(0x1ec)]((_0x19d201,_0x45f1a0)=>{_0x511e01[_0x45f1a0]['secondary_code']=_0x19d201;}),_0x120d49[_0x299e34(0x1ec)]((_0x484607,_0x44c624)=>{var _0x4859b1=_0x299e34;_0x511e01[_0x44c624][_0x4859b1(0x2b7)]=_0x484607;}),_0x3077d3[_0x299e34(0x1ec)]((_0x5b4bd1,_0x4bc087)=>{_0x511e01[_0x4bc087]['batch_code']=_0x5b4bd1;}),_0x207e80[_0x299e34(0x1ec)]((_0x1fde04,_0x497a57)=>{var _0x3a82b5=_0x299e34;_0x511e01[_0x497a57][_0x3a82b5(0x1e2)]=_0x1fde04;}),_0x4fb98c[_0x299e34(0x1ec)]((_0x37c7e8,_0xecb540)=>{_0x511e01[_0xecb540]['maxperunit']=_0x37c7e8;}),_0x84439e[_0x299e34(0x1ec)]((_0x178098,_0x4fd908)=>{var _0x397a13=_0x299e34;_0x511e01[_0x4fd908][_0x397a13(0x226)]=_0x178098;}),_0x4f0671[_0x299e34(0x1ec)]((_0x40b86e,_0x3e8f09)=>{var _0x57aa2f=_0x299e34;_0x511e01[_0x3e8f09][_0x57aa2f(0x21c)]=_0x40b86e;}),_0x50e911[_0x299e34(0x1ec)]((_0x1c11a8,_0x418496)=>{var _0x177f07=_0x299e34;_0x511e01[_0x418496][_0x177f07(0x288)]=_0x1c11a8;}),_0x4bdc87[_0x299e34(0x1ec)]((_0xe82bf6,_0x495ba7)=>{_0x511e01[_0x495ba7]['room_name']=_0xe82bf6;}),_0x8a59c[_0x299e34(0x1ec)]((_0x221959,_0x11bbd5)=>{var _0x27107e=_0x299e34;_0x511e01[_0x11bbd5][_0x27107e(0x1fb)]=_0x221959;}),_0x4fef4a['forEach']((_0x38bcb0,_0xf406e)=>{var _0x325e22=_0x299e34;_0x511e01[_0xf406e][_0x325e22(0x2ab)]=_0x38bcb0;});const _0xed7b0c=_0x4bdc87['map'](_0x19d74a=>{return _0x19d74a={'room_name':_0x19d74a};}),_0x58ce57=_0x511e01[_0x299e34(0x28c)](_0x1148ac=>_0x1148ac[_0x299e34(0x21e)]!=='0'&&_0x1148ac['quantity']!==''),_0x4399fe=new purchases({'invoice':_0x6e7e20,'suppliers':_0x37633f[_0x299e34(0x1c2)][_0x299e34(0x253)],'date':_0xaa49a9,'warehouse_name':_0xb8a0e0,'product':_0x58ce57,'note':_0x5e5b,'due_amount':_0x4af83,'POnumber':_0x3c32a6,'SCRN':_0x20e9b7,'JO_number':_0x548cb5,'roomList':_0xed7b0c}),_0x4383f4=await _0x4399fe['save'](),_0x522f97=await purchases[_0x299e34(0x204)]({'invoice':_0x6e7e20}),_0x216b49=_0x522f97[_0x299e34(0x2a6)][_0x299e34(0x266)](async _0x47f0d1=>{var _0x3404d1=_0x299e34,_0xba8580=await warehouse[_0x3404d1(0x204)]({'name':_0xb8a0e0,'room':_0x47f0d1[_0x3404d1(0x262)]}),_0x3d42d0=0x0;return _0xba8580[_0x3404d1(0x22a)][_0x3404d1(0x1ec)](_0x2b5bd6=>{var _0x1ccddc=_0x3404d1;_0x2b5bd6[_0x1ccddc(0x261)]==_0x47f0d1['product_name']&&_0x2b5bd6[_0x1ccddc(0x25f)]==_0x47f0d1['floorlevel']&&_0x2b5bd6[_0x1ccddc(0x1c0)]==_0x47f0d1[_0x1ccddc(0x1c0)]&&_0x2b5bd6[_0x1ccddc(0x227)]==_0x47f0d1['bin']&&_0x2b5bd6['bay']==_0x47f0d1['bay']&&_0x2b5bd6[_0x1ccddc(0x22f)]==_0x47f0d1[_0x1ccddc(0x22f)]&&_0x2b5bd6[_0x1ccddc(0x228)]==_0x47f0d1[_0x1ccddc(0x228)]&&_0x2b5bd6[_0x1ccddc(0x1e2)]==_0x47f0d1['expiry_date']&&_0x2b5bd6[_0x1ccddc(0x221)]==_0x47f0d1[_0x1ccddc(0x221)]&&_0x2b5bd6['production_date']==_0x47f0d1[_0x1ccddc(0x21c)]&&_0x2b5bd6[_0x1ccddc(0x2ab)]==_0x522f97['invoice']&&(_0x2b5bd6['product_stock']+=Math[_0x1ccddc(0x208)](_0x47f0d1[_0x1ccddc(0x21e)]),_0x3d42d0++);}),_0x3d42d0===0x0&&_0xba8580[_0x3404d1(0x22a)][_0x3404d1(0x291)]({'product_name':_0x47f0d1[_0x3404d1(0x261)],'product_stock':Math[_0x3404d1(0x208)](_0x47f0d1['quantity']),'primary_code':_0x47f0d1['primary_code'],'secondary_code':_0x47f0d1[_0x3404d1(0x1f5)],'product_code':_0x47f0d1[_0x3404d1(0x233)],'storage':_0x47f0d1[_0x3404d1(0x228)],'rack':_0x47f0d1[_0x3404d1(0x22f)],'bay':_0x47f0d1[_0x3404d1(0x2bb)],'bin':_0x47f0d1[_0x3404d1(0x227)],'type':_0x47f0d1[_0x3404d1(0x1c0)],'floorlevel':_0x47f0d1[_0x3404d1(0x25f)],'maxProducts':_0x47f0d1[_0x3404d1(0x2b7)],'unit':_0x47f0d1['standard_unit'],'secondary_unit':_0x47f0d1[_0x3404d1(0x1e8)],'expiry_date':_0x47f0d1[_0x3404d1(0x1e2)],'maxPerUnit':_0x47f0d1[_0x3404d1(0x20b)],'batch_code':_0x47f0d1[_0x3404d1(0x221)],'alertQTY':_0x47f0d1[_0x3404d1(0x226)],'production_date':_0x47f0d1[_0x3404d1(0x21c)],'product_cat':_0x47f0d1[_0x3404d1(0x288)],'invoice':_0x47f0d1['invoice'],'actual_qty':Math[_0x3404d1(0x208)](_0x47f0d1[_0x3404d1(0x29f)]),'actual_uom':_0x47f0d1[_0x3404d1(0x1c9)]}),_0xba8580;});Promise[_0x299e34(0x1d6)](_0x216b49)[_0x299e34(0x1f2)](async _0x4842be=>{var _0x18223d=_0x299e34;try{for(const _0x41bd45 of _0x4842be){await _0x41bd45['save']();}const _0x5e5621=await master_shop['find'](),_0x508a3f=await email_settings[_0x18223d(0x204)](),_0x269bec=await supervisor_settings[_0x18223d(0x2ae)]();var _0x35b2ee=_0x522f97['product'],_0x1da2c3='',_0x595c2b;for(_0x595c2b in _0x35b2ee){_0x1da2c3+=_0x18223d(0x1b4)+_0x18223d(0x257)+_0x35b2ee[_0x595c2b]['product_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35b2ee[_0x595c2b][_0x18223d(0x233)]+_0x18223d(0x272)+_0x18223d(0x257)+_0x35b2ee[_0x595c2b][_0x18223d(0x21e)]+'</td>'+_0x18223d(0x257)+_0x35b2ee[_0x595c2b][_0x18223d(0x281)]+_0x18223d(0x272)+_0x18223d(0x257)+_0x35b2ee[_0x595c2b][_0x18223d(0x1e8)]+'</td>'+_0x18223d(0x257)+_0x522f97[_0x18223d(0x2b1)]+_0x18223d(0x272)+_0x18223d(0x257)+_0x35b2ee[_0x595c2b]['room_name']+_0x18223d(0x272)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x35b2ee[_0x595c2b]['storage']+_0x35b2ee[_0x595c2b][_0x18223d(0x22f)]+_0x35b2ee[_0x595c2b]['bay']+_0x35b2ee[_0x595c2b]['bin']+_0x35b2ee[_0x595c2b][_0x18223d(0x1c0)][0x0]+_0x35b2ee[_0x595c2b][_0x18223d(0x25f)]+_0x18223d(0x272),'</tr>';}let _0x52e174=nodemailer[_0x18223d(0x289)]({'host':_0x508a3f['host'],'port':Number(_0x508a3f[_0x18223d(0x19b)]),'secure':![],'auth':{'user':_0x508a3f['email'],'pass':_0x508a3f[_0x18223d(0x2b6)]}}),_0x2bbd2b={'from':_0x508a3f[_0x18223d(0x1be)],'to':_0x269bec[0x0]['RMSEmail'],'subject':_0x18223d(0x1f1),'attachments':[{'filename':_0x18223d(0x28a),'path':__dirname+_0x18223d(0x1cd)+_0x18223d(0x22c)+_0x5e5621[0x0]['image'],'cid':'logo'}],'html':_0x18223d(0x2ad)+_0x18223d(0x1f6)+'</head><body>'+_0x18223d(0x20e)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x18223d(0x231)+'</div>'+'<div>'+_0x18223d(0x1a9)+_0x5e5621[0x0][_0x18223d(0x1cc)]+_0x18223d(0x24c)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x18223d(0x20e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x522f97[_0x18223d(0x2ab)]+'\x20'+_0x18223d(0x248)+_0x18223d(0x1d0)+_0x522f97[_0x18223d(0x207)]+'\x20'+'</span>'+'</h5>'+_0x18223d(0x1ff)+_0x18223d(0x24a)+_0x18223d(0x1a8)+_0x18223d(0x1b4)+_0x18223d(0x1f3)+_0x18223d(0x1d4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x18223d(0x245)+_0x18223d(0x232)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x18223d(0x252)+_0x18223d(0x1df)+_0x18223d(0x24f)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1da2c3+'\x20'+_0x18223d(0x27d)+_0x18223d(0x238)+'<div>'+_0x18223d(0x205)+'<h5>'+_0x5e5621[0x0][_0x18223d(0x1cc)]+_0x18223d(0x1e1)+_0x18223d(0x1ff)+_0x18223d(0x1ff)+'</body></html>'};_0x52e174[_0x18223d(0x1dd)](_0x2bbd2b,function(_0x22aa1f,_0x3b4a56){var _0x1e854c=_0x18223d;_0x22aa1f?(console['log'](_0x22aa1f),console[_0x1e854c(0x263)](_0x1e854c(0x22b))):console[_0x1e854c(0x263)](_0x1e854c(0x270));}),_0x37633f[_0x18223d(0x1ea)](_0x18223d(0x1af),'Purchase\x20data\x20added\x20successfully'),_0x3dc335[_0x18223d(0x235)](_0x18223d(0x1c1));}catch(_0x1f96cb){console[_0x18223d(0x23d)](_0x1f96cb),_0x3dc335['status'](0x1f4)[_0x18223d(0x278)]({'error':_0x18223d(0x20f)});}})[_0x299e34(0x23b)](_0x43a0b9=>{var _0x4f570a=_0x299e34;console['error'](_0x43a0b9),_0x3dc335['status'](0x1f4)[_0x4f570a(0x278)]({'error':'An\x20error\x20occurred.'});});}catch(_0x41e243){console['log'](_0x41e243);}}),router[a0_0x37d6eb(0x23c)](a0_0x37d6eb(0x22d),auth,async(_0x134134,_0x8f604)=>{var _0x5b4618=a0_0x37d6eb;try{const {username:_0x417ce4,email:_0x16946a,role:_0x15631e}=_0x134134[_0x5b4618(0x1fa)],_0x1fedda=_0x134134[_0x5b4618(0x1fa)],_0x4f18c8=await profile[_0x5b4618(0x204)]({'email':_0x1fedda[_0x5b4618(0x1be)]}),_0xc16edf=await master_shop[_0x5b4618(0x2ae)](),_0x486ab1=_0x134134[_0x5b4618(0x225)]['id'],_0x10900a=await purchases[_0x5b4618(0x1fc)](_0x486ab1),_0x54a5e8=await warehouse[_0x5b4618(0x287)]([{'$match':{'name':_0x10900a['warehouse_name'],'room':_0x10900a['room']}},{'$unwind':_0x5b4618(0x1f4)},{'$group':{'_id':_0x5b4618(0x299),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5b4618(0x2a7)},'type':{'$first':_0x5b4618(0x28f)},'floorlevel':{'$first':_0x5b4618(0x1bc)},'primary_code':{'$first':_0x5b4618(0x26c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5b4618(0x1a2)},'storage':{'$first':_0x5b4618(0x26a)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5b4618(0x214)}}}]),_0x1002d9=await customer[_0x5b4618(0x2ae)]({});let _0x1dd51a;if(_0x1fedda[_0x5b4618(0x19c)]==_0x5b4618(0x2b2)){const _0x332153=await staff[_0x5b4618(0x204)]({'email':_0x1fedda[_0x5b4618(0x1be)]});_0x1dd51a=await warehouse[_0x5b4618(0x287)]([{'$match':{'status':_0x5b4618(0x1cb),'name':_0x332153[_0x5b4618(0x28d)]}},{'$group':{'_id':'$name','name':{'$first':_0x5b4618(0x1cf)}}}]);}else _0x1dd51a=await warehouse[_0x5b4618(0x287)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0x5b4618(0x1cf),'name':{'$first':'$name'}}}]);const _0x2bd03d=await product[_0x5b4618(0x2ae)]({}),_0xb289fb=await suppliers[_0x5b4618(0x2ae)]({}),_0x3f2bee=BayBinSelected(_0x10900a['warehouse_name'],_0x10900a[_0x5b4618(0x2a0)]);if(_0xc16edf[0x0][_0x5b4618(0x27b)]==_0x5b4618(0x25e)){var _0x50d360=users['English'];console[_0x5b4618(0x263)](_0x50d360);}else{if(_0xc16edf[0x0][_0x5b4618(0x27b)]==_0x5b4618(0x286))var _0x50d360=users[_0x5b4618(0x286)];else{if(_0xc16edf[0x0][_0x5b4618(0x27b)]==_0x5b4618(0x1b2))var _0x50d360=users['German'];else{if(_0xc16edf[0x0][_0x5b4618(0x27b)]=='Spanish')var _0x50d360=users[_0x5b4618(0x1d3)];else{if(_0xc16edf[0x0]['language']==_0x5b4618(0x254))var _0x50d360=users[_0x5b4618(0x254)];else{if(_0xc16edf[0x0][_0x5b4618(0x27b)]=='Portuguese\x20(BR)')var _0x50d360=users[_0x5b4618(0x240)];else{if(_0xc16edf[0x0][_0x5b4618(0x27b)]==_0x5b4618(0x217))var _0x50d360=users[_0x5b4618(0x217)];else{if(_0xc16edf[0x0][_0x5b4618(0x27b)]=='Arabic\x20(ae)')var _0x50d360=users[_0x5b4618(0x211)];}}}}}}}_0x8f604[_0x5b4618(0x2a9)](_0x5b4618(0x236),{'success':_0x134134[_0x5b4618(0x1ea)](_0x5b4618(0x1af)),'errors':_0x134134[_0x5b4618(0x1ea)](_0x5b4618(0x2b4)),'role':_0x1fedda,'profile':_0x4f18c8,'customer':_0x1002d9,'warehouse':_0x1dd51a,'product':_0x54a5e8,'user':_0x10900a,'master_shop':_0xc16edf,'unit':_0x2bd03d,'language':_0x50d360,'suppliers':_0xb289fb,'dataSelected':_0x3f2bee});}catch(_0x5e4fce){console[_0x5b4618(0x263)](_0x5e4fce);}}),router[a0_0x37d6eb(0x1d9)](a0_0x37d6eb(0x22d),auth,async(_0x505320,_0x19ab12)=>{var _0x49d08a=a0_0x37d6eb;try{const _0x2cdb95=_0x505320[_0x49d08a(0x225)]['id'],{invoice:_0x57f69e,warehouse_name:_0x6817b8,Room_name:_0x1d42af}=_0x505320[_0x49d08a(0x1c2)],_0x355195=await warehouse[_0x49d08a(0x204)]({'name':_0x6817b8,'room':_0x1d42af}),_0x4ad39b=await purchases[_0x49d08a(0x204)]({'invoice':_0x57f69e});_0x4ad39b[_0x49d08a(0x2a6)][_0x49d08a(0x1ec)](_0x18c085=>{var _0x1b06cf=_0x49d08a,_0x2b07f6=0x0;const _0x5cc122=_0x355195[_0x1b06cf(0x22a)]['map'](_0x1e1fff=>{var _0x14d90c=_0x1b06cf;_0x1e1fff[_0x14d90c(0x261)]==_0x18c085['product_name']&&_0x1e1fff[_0x14d90c(0x25f)]==_0x18c085[_0x14d90c(0x25f)]&&_0x1e1fff[_0x14d90c(0x1c0)]==_0x18c085[_0x14d90c(0x1c0)]&&_0x1e1fff[_0x14d90c(0x227)]==_0x18c085[_0x14d90c(0x227)]&&_0x1e1fff[_0x14d90c(0x2bb)]==_0x18c085[_0x14d90c(0x2bb)]&&_0x1e1fff[_0x14d90c(0x22f)]==_0x18c085[_0x14d90c(0x22f)]&&_0x1e1fff[_0x14d90c(0x228)]==_0x18c085[_0x14d90c(0x228)]&&_0x1e1fff[_0x14d90c(0x1e2)]==_0x18c085['expiry_date']&&_0x1e1fff[_0x14d90c(0x221)]==_0x18c085[_0x14d90c(0x221)]&&_0x1e1fff[_0x14d90c(0x21c)]==_0x18c085[_0x14d90c(0x21c)]&&_0x1e1fff[_0x14d90c(0x2b9)]==_0x18c085['delivery_date']&&_0x1e1fff[_0x14d90c(0x1fb)]==_0x18c085[_0x14d90c(0x1fb)]&&(_0x1e1fff[_0x14d90c(0x241)]=parseInt(_0x1e1fff[_0x14d90c(0x241)])+parseInt(_0x18c085[_0x14d90c(0x21e)]),_0x2b07f6++);});_0x2b07f6=='0'&&(_0x355195['product_details']=_0x355195[_0x1b06cf(0x22a)]['concat']({'product_name':_0x18c085[_0x1b06cf(0x261)],'product_stock':_0x18c085['quantity'],'primary_code':_0x18c085[_0x1b06cf(0x218)],'secondary_code':_0x18c085['secondary_code'],'product_code':_0x18c085[_0x1b06cf(0x233)],'storage':_0x18c085[_0x1b06cf(0x228)],'rack':_0x18c085[_0x1b06cf(0x22f)],'bay':_0x18c085[_0x1b06cf(0x2bb)],'bin':_0x18c085[_0x1b06cf(0x227)],'type':_0x18c085[_0x1b06cf(0x1c0)],'floorlevel':_0x18c085[_0x1b06cf(0x25f)],'maxProducts':_0x18c085[_0x1b06cf(0x2b7)],'unit':_0x18c085['standard_unit'],'secondary_unit':_0x18c085[_0x1b06cf(0x1e8)],'expiry_date':_0x18c085['expiry_date'],'maxPerUnit':_0x18c085[_0x1b06cf(0x20b)],'batch_code':_0x18c085[_0x1b06cf(0x221)],'alertQTY':_0x18c085[_0x1b06cf(0x226)],'production_date':_0x18c085['production_date'],'delivery_date':_0x18c085[_0x1b06cf(0x2b9)],'delivery_code':_0x18c085[_0x1b06cf(0x1fb)]}));}),await _0x355195[_0x49d08a(0x279)](),_0x4ad39b['finalize']='True';const _0x47cd2c=await _0x4ad39b['save']();_0x505320[_0x49d08a(0x1ea)]('success',_0x49d08a(0x230)),_0x19ab12['redirect']('/all_purchases/view');}catch(_0x17d059){console[_0x49d08a(0x263)](_0x17d059);}}),router[a0_0x37d6eb(0x23c)](a0_0x37d6eb(0x255),auth,async(_0x51a427,_0x4d7b7f)=>{var _0x50196c=a0_0x37d6eb;try{const {username:_0x42d3fc,email:_0x332e50,role:_0x34b485}=_0x51a427[_0x50196c(0x1fa)],_0x20b0e8=_0x51a427[_0x50196c(0x1fa)],_0x1ae3ed=await profile[_0x50196c(0x204)]({'email':_0x20b0e8[_0x50196c(0x1be)]}),_0x4f6ebc=await master_shop[_0x50196c(0x2ae)](),_0x1534cc=_0x51a427[_0x50196c(0x225)]['id'],_0x394ab0=await purchases['findById'](_0x1534cc),_0x12eb22=await suppliers[_0x50196c(0x2ae)]({});let _0x7b5686;if(_0x20b0e8['role']==_0x50196c(0x2b2)){const _0x4aa144=await staff[_0x50196c(0x204)]({'email':_0x20b0e8[_0x50196c(0x1be)]});_0x7b5686=await warehouse[_0x50196c(0x2ae)]({'status':'Enabled','name':_0x4aa144[_0x50196c(0x28d)],'warehouse_category':_0x50196c(0x27f)});}else _0x7b5686=await warehouse['aggregate']([{'$match':{'status':_0x50196c(0x1cb),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':_0x50196c(0x1cf)}}}]);const _0x5ce9e4=await product['find']({}),_0x351501=BayBinSelected(_0x394ab0[_0x50196c(0x2b1)],_0x394ab0['room']);let _0x1bd805=new Date(_0x394ab0['expiry_date']),_0x112e0b=('0'+_0x1bd805['getDate']())[_0x50196c(0x242)](-0x2),_0x5b6adc=('0'+(_0x1bd805['getMonth']()+0x1))[_0x50196c(0x242)](-0x2),_0x2b18d3=_0x1bd805['getFullYear'](),_0x295f9c=_0x2b18d3+'-'+_0x5b6adc+'-'+_0x112e0b;if(_0x4f6ebc[0x0][_0x50196c(0x27b)]=='English\x20(US)'){var _0x33d092=users[_0x50196c(0x1b5)];console[_0x50196c(0x263)](_0x33d092);}else{if(_0x4f6ebc[0x0][_0x50196c(0x27b)]==_0x50196c(0x286))var _0x33d092=users[_0x50196c(0x286)];else{if(_0x4f6ebc[0x0]['language']==_0x50196c(0x1b2))var _0x33d092=users[_0x50196c(0x1b2)];else{if(_0x4f6ebc[0x0][_0x50196c(0x27b)]==_0x50196c(0x1d3))var _0x33d092=users[_0x50196c(0x1d3)];else{if(_0x4f6ebc[0x0][_0x50196c(0x27b)]==_0x50196c(0x254))var _0x33d092=users[_0x50196c(0x254)];else{if(_0x4f6ebc[0x0][_0x50196c(0x27b)]==_0x50196c(0x1a0))var _0x33d092=users[_0x50196c(0x240)];else{if(_0x4f6ebc[0x0][_0x50196c(0x27b)]==_0x50196c(0x217))var _0x33d092=users[_0x50196c(0x217)];else{if(_0x4f6ebc[0x0]['language']==_0x50196c(0x1bd))var _0x33d092=users[_0x50196c(0x211)];}}}}}}}_0x4d7b7f[_0x50196c(0x2a9)]('edit_purchases',{'success':_0x51a427['flash'](_0x50196c(0x1af)),'errors':_0x51a427[_0x50196c(0x1ea)]('errors'),'role':_0x20b0e8,'profile':_0x1ae3ed,'purchases':_0x394ab0,'suppliers':_0x12eb22,'warehouse':_0x7b5686,'product':_0x5ce9e4,'master_shop':_0x4f6ebc,'language':_0x33d092,'ed_fullDate':_0x295f9c,'dataSelected':_0x351501});}catch(_0xa600c5){console['log'](_0xa600c5);}}),router[a0_0x37d6eb(0x1d9)](a0_0x37d6eb(0x255),auth,async(_0x5272ca,_0x58522e)=>{var _0x4e02c6=a0_0x37d6eb;try{const _0x5a5a88=_0x5272ca[_0x4e02c6(0x225)]['id'],_0x504f55=await purchases['findOne']({'_id':_0x5272ca['params']['id']}),_0x3e8117=await warehouse[_0x4e02c6(0x204)]({'name':_0x504f55['warehouse_name'],'room':_0x504f55['room']});_0x504f55[_0x4e02c6(0x2a6)][_0x4e02c6(0x1ec)](_0x5cea11=>{var _0x72b530=_0x4e02c6;const _0x16cf65=_0x3e8117[_0x72b530(0x22a)][_0x72b530(0x266)](_0x16cd07=>{var _0x43dd63=_0x72b530;_0x16cd07['product_name']==_0x5cea11[_0x43dd63(0x261)]&&_0x16cd07['floorlevel']==_0x5cea11[_0x43dd63(0x25f)]&&_0x16cd07['type']==_0x5cea11[_0x43dd63(0x1c0)]&&_0x16cd07[_0x43dd63(0x227)]==_0x5cea11[_0x43dd63(0x227)]&&_0x16cd07[_0x43dd63(0x2bb)]==_0x5cea11['bay']&&_0x16cd07[_0x43dd63(0x22f)]==_0x5cea11[_0x43dd63(0x22f)]&&_0x16cd07[_0x43dd63(0x228)]==_0x5cea11[_0x43dd63(0x228)]&&(_0x16cd07[_0x43dd63(0x241)]=parseInt(_0x16cd07['product_stock'])-parseInt(_0x5cea11['quantity']));});}),await _0x3e8117[_0x4e02c6(0x279)]();const {invoice:_0x47b208,suppliers:_0x22c1b9,date:_0x3458fb,warehouse_name:_0x9e3544,prod_name:_0x42d819,prod_code:_0x20ba11,prod_qty:_0x98ebb1,prod_unit:_0x2dfa6d,prod_secondunit:_0x215971,prod_level:_0x427ab8,prod_isle:_0x243d13,prod_pallet:_0x70c89,note:_0x424d39,expiry_date:_0x264056,batch_code:_0x16a46b,paid_amount:_0x335a8f,due_amount:_0x4df601,Room_name:_0x52bb60,primary_code:_0x4c6f23,secondary_code:_0x25917c,PO_number:_0x4fccc3,JO_number:_0x4db7b0}=_0x5272ca['body'];if(typeof _0x42d819==_0x4e02c6(0x1c7))var _0xe0c1c4=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x29b)]],_0x729a6f=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x21d)]],_0x308b39=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x1a5)]],_0x48441b=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x296)]],_0x152bb3=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x268)]],_0x468b9a=[_0x5272ca[_0x4e02c6(0x1c2)]['prod_level']],_0x15bc1c=[_0x5272ca['body'][_0x4e02c6(0x26d)]],_0x590540=[_0x5272ca[_0x4e02c6(0x1c2)]['prod_pallet']],_0x375b2a=[_0x5272ca['body'][_0x4e02c6(0x218)]],_0x5845df=[_0x5272ca['body'][_0x4e02c6(0x1f5)]],_0x4cc7f6=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x28b)]],_0x5034f8=[_0x5272ca[_0x4e02c6(0x1c2)]['batch_code']],_0x4a18db=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x1e2)]],_0x4c0069=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x228)]],_0x3071f8=[_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x24d)]],_0x44b6c7=[_0x5272ca[_0x4e02c6(0x1c2)]['type']];else var _0xe0c1c4=[..._0x5272ca[_0x4e02c6(0x1c2)]['prod_name']],_0x729a6f=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x21d)]],_0x308b39=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x1a5)]],_0x48441b=[..._0x5272ca['body'][_0x4e02c6(0x296)]],_0x152bb3=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x268)]],_0x468b9a=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x19d)]],_0x15bc1c=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x26d)]],_0x590540=[..._0x5272ca[_0x4e02c6(0x1c2)]['prod_pallet']],_0x375b2a=[..._0x5272ca[_0x4e02c6(0x1c2)]['primary_code']],_0x5845df=[..._0x5272ca[_0x4e02c6(0x1c2)]['secondary_code']],_0x4cc7f6=[..._0x5272ca['body'][_0x4e02c6(0x28b)]],_0x5034f8=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x221)]],_0x4a18db=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x1e2)]],_0x4c0069=[..._0x5272ca['body'][_0x4e02c6(0x228)]],_0x3071f8=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x24d)]],_0x44b6c7=[..._0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x1c0)]];const _0x17cee3=_0xe0c1c4[_0x4e02c6(0x266)](_0x3fcd23=>{return _0x3fcd23={'product_name':_0x3fcd23};});_0x729a6f[_0x4e02c6(0x1ec)]((_0x8d135,_0x3817af)=>{var _0x39b393=_0x4e02c6;_0x17cee3[_0x3817af][_0x39b393(0x233)]=_0x8d135;}),_0x308b39[_0x4e02c6(0x1ec)]((_0x99b71f,_0x30ecd0)=>{_0x17cee3[_0x30ecd0]['quantity']=_0x99b71f;}),_0x48441b[_0x4e02c6(0x1ec)]((_0x237747,_0x4047fd)=>{var _0x2f11d4=_0x4e02c6;_0x17cee3[_0x4047fd][_0x2f11d4(0x281)]=_0x237747;}),_0x152bb3[_0x4e02c6(0x1ec)]((_0xe30818,_0x340933)=>{_0x17cee3[_0x340933]['secondary_unit']=_0xe30818;}),_0x468b9a['forEach']((_0x47ca0a,_0x150133)=>{var _0x5c019c=_0x4e02c6;_0x17cee3[_0x150133][_0x5c019c(0x2bb)]=_0x47ca0a;}),_0x15bc1c[_0x4e02c6(0x1ec)]((_0x5e8e35,_0x5365d3)=>{var _0x38f02e=_0x4e02c6;_0x17cee3[_0x5365d3][_0x38f02e(0x227)]=_0x5e8e35;}),_0x590540[_0x4e02c6(0x1ec)]((_0x1ac60d,_0x5c1336)=>{var _0x201a88=_0x4e02c6;_0x17cee3[_0x5c1336][_0x201a88(0x25f)]=_0x1ac60d;}),_0x375b2a[_0x4e02c6(0x1ec)]((_0x2cc576,_0x33c912)=>{_0x17cee3[_0x33c912]['primary_code']=_0x2cc576;}),_0x5845df[_0x4e02c6(0x1ec)]((_0x2fba4a,_0x1f25ac)=>{var _0x5a3fb0=_0x4e02c6;_0x17cee3[_0x1f25ac][_0x5a3fb0(0x1f5)]=_0x2fba4a;}),_0x4cc7f6[_0x4e02c6(0x1ec)]((_0x3b9cf9,_0x3e8797)=>{var _0x260b17=_0x4e02c6;_0x17cee3[_0x3e8797][_0x260b17(0x2b7)]=_0x3b9cf9;}),_0x5034f8[_0x4e02c6(0x1ec)]((_0x2295da,_0x5b10a0)=>{var _0x994e90=_0x4e02c6;_0x17cee3[_0x5b10a0][_0x994e90(0x221)]=_0x2295da;}),_0x4a18db[_0x4e02c6(0x1ec)]((_0x4d6ded,_0x141864)=>{var _0x3d799c=_0x4e02c6;_0x17cee3[_0x141864][_0x3d799c(0x1e2)]=_0x4d6ded;}),_0x44b6c7[_0x4e02c6(0x1ec)]((_0x40cd7a,_0x2bd54b)=>{var _0x5c2d11=_0x4e02c6;_0x17cee3[_0x2bd54b][_0x5c2d11(0x1c0)]=_0x40cd7a;}),_0x4c0069[_0x4e02c6(0x1ec)]((_0x419647,_0x42c5f9)=>{_0x17cee3[_0x42c5f9]['storage']=_0x419647;}),_0x3071f8[_0x4e02c6(0x1ec)]((_0x28335a,_0x3fe51d)=>{var _0x263485=_0x4e02c6;_0x17cee3[_0x3fe51d][_0x263485(0x22f)]=_0x28335a;});const _0x272640=_0x17cee3['filter'](_0x5239d3=>_0x5239d3['quantity']!=='0'&&_0x5239d3['quantity']!=='');_0x504f55[_0x4e02c6(0x2ab)]=_0x47b208,_0x504f55[_0x4e02c6(0x253)]=_0x22c1b9,_0x504f55[_0x4e02c6(0x207)]=_0x3458fb,_0x504f55[_0x4e02c6(0x2b1)]=_0x9e3544,_0x504f55[_0x4e02c6(0x2a6)]=_0x272640,_0x504f55[_0x4e02c6(0x1ce)]=_0x424d39,_0x504f55[_0x4e02c6(0x1e5)]=_0x335a8f,_0x504f55['due_amount']=_0x4df601,_0x504f55[_0x4e02c6(0x2a0)]=_0x52bb60,_0x504f55[_0x4e02c6(0x260)]=_0x4fccc3,_0x504f55[_0x4e02c6(0x271)]=_0x4db7b0;const _0x1a7f7a=await _0x504f55[_0x4e02c6(0x279)](),_0x485e5b=await warehouse[_0x4e02c6(0x204)]({'name':_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x2b1)],'room':_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x19f)]});_0x504f55[_0x4e02c6(0x2a6)][_0x4e02c6(0x1ec)](_0x114a96=>{var _0x1696f0=_0x4e02c6,_0x5ecf75=0x0;const _0x49eef8=_0x485e5b[_0x1696f0(0x22a)]['map'](_0x14235b=>{var _0x7b2664=_0x1696f0;_0x14235b[_0x7b2664(0x261)]==_0x114a96['product_name']&&_0x14235b['floorlevel']==_0x114a96[_0x7b2664(0x25f)]&&_0x14235b[_0x7b2664(0x1c0)]==_0x114a96[_0x7b2664(0x1c0)]&&_0x14235b[_0x7b2664(0x227)]==_0x114a96['bin']&&_0x14235b[_0x7b2664(0x2bb)]==_0x114a96[_0x7b2664(0x2bb)]&&_0x14235b[_0x7b2664(0x22f)]==_0x114a96[_0x7b2664(0x22f)]&&_0x14235b[_0x7b2664(0x228)]==_0x114a96[_0x7b2664(0x228)]&&(_0x14235b[_0x7b2664(0x241)]=parseInt(_0x14235b['product_stock'])+parseInt(_0x114a96['quantity']),_0x5ecf75++);});_0x5ecf75=='0'&&(_0x485e5b[_0x1696f0(0x22a)]=_0x485e5b[_0x1696f0(0x22a)][_0x1696f0(0x28e)]({'product_name':_0x114a96[_0x1696f0(0x261)],'product_stock':_0x114a96['quantity'],'primary_code':_0x114a96[_0x1696f0(0x218)],'secondary_code':_0x114a96[_0x1696f0(0x1f5)],'product_code':_0x114a96[_0x1696f0(0x233)],'storage':_0x114a96[_0x1696f0(0x228)],'rack':_0x114a96[_0x1696f0(0x22f)],'bay':_0x114a96[_0x1696f0(0x2bb)],'bin':_0x114a96[_0x1696f0(0x227)],'type':_0x114a96[_0x1696f0(0x1c0)],'floorlevel':_0x114a96[_0x1696f0(0x25f)],'maxProducts':_0x114a96['maxStocks'],'unit':_0x114a96[_0x1696f0(0x281)],'secondary_unit':_0x114a96['secondary_unit'],'expiry_date':_0x114a96[_0x1696f0(0x1e2)]}));}),await _0x485e5b[_0x4e02c6(0x279)]();const _0x56367b=await s_payment_data[_0x4e02c6(0x204)]({'invoice':_0x5272ca[_0x4e02c6(0x1c2)][_0x4e02c6(0x2ab)]});if(_0x56367b===null){}else console['log']('suppliers',_0x56367b,_0x5272ca['body'][_0x4e02c6(0x2ab)]),_0x56367b[_0x4e02c6(0x253)]=_0x5272ca['body'][_0x4e02c6(0x253)],await _0x56367b['save']();_0x5272ca['flash']('success',_0x4e02c6(0x2a5)),_0x58522e[_0x4e02c6(0x235)](_0x4e02c6(0x25c));}catch(_0x445524){console['log'](_0x445524);}}),router[a0_0x37d6eb(0x1d9)](a0_0x37d6eb(0x215),auth,async(_0x1ff523,_0x488b54)=>{var _0x2d9ce6=a0_0x37d6eb;try{const _0x4d0b4a=_0x1ff523[_0x2d9ce6(0x225)]['id'],{invoice:_0x2afd25,suppliers:_0x124bdc,payable:_0x141138,due_amount:_0x556bf7}=_0x1ff523[_0x2d9ce6(0x1c2)],_0x122a86=await purchases[_0x2d9ce6(0x1fc)](_0x4d0b4a);var _0x46cecf=_0x141138-_0x556bf7;_0x122a86[_0x2d9ce6(0x1e5)]=parseFloat(_0x122a86[_0x2d9ce6(0x1e5)])+parseFloat(_0x556bf7),_0x122a86[_0x2d9ce6(0x209)]=_0x46cecf;const _0x3cab76=await _0x122a86[_0x2d9ce6(0x279)]();console['log'](_0x3cab76);const _0x268310=await s_payment_data[_0x2d9ce6(0x204)]({'invoice':_0x2afd25});_0x268310[_0x2d9ce6(0x1dc)]=_0x46cecf,await _0x268310[_0x2d9ce6(0x279)]();let _0x199f9a=new Date(),_0xd2808e=('0'+_0x199f9a[_0x2d9ce6(0x237)]())[_0x2d9ce6(0x242)](-0x2),_0x533c8f=('0'+(_0x199f9a['getMonth']()+0x1))[_0x2d9ce6(0x242)](-0x2),_0x54bfbc=_0x199f9a[_0x2d9ce6(0x25a)](),_0xcf32fb=_0x54bfbc+'-'+_0x533c8f+'-'+_0xd2808e;const _0x346f55=new suppliers_payment({'invoice':_0x2afd25,'date':_0x54bfbc+'-'+_0x533c8f+'-'+_0xd2808e,'suppliers':_0x124bdc,'reason':_0x2d9ce6(0x1b8),'amount':_0x556bf7}),_0x51dfea=await _0x346f55['save']();_0x1ff523[_0x2d9ce6(0x1ea)](_0x2d9ce6(0x1af),_0x2d9ce6(0x206)),_0x488b54[_0x2d9ce6(0x235)](_0x2d9ce6(0x25c));}catch(_0xe1b882){console['log'](_0xe1b882);}}),router[a0_0x37d6eb(0x23c)]('/invoice/:id',auth,async(_0x50f082,_0x9ac400)=>{var _0x1f526e=a0_0x37d6eb;try{const {username:_0x5f2c73,email:_0x2e94ee,role:_0x5d67a8}=_0x50f082['user'],_0x36f2c8=_0x50f082[_0x1f526e(0x1fa)],_0x2cc6d4=await profile['findOne']({'email':_0x36f2c8['email']}),_0x52335e=await master_shop['find']();console['log'](_0x1f526e(0x223),_0x52335e);const _0x23b3ee=_0x50f082[_0x1f526e(0x225)]['id'],_0x51a288=await purchases[_0x1f526e(0x1fc)](_0x23b3ee);console['log'](_0x51a288);const _0x8ce243=await suppliers[_0x1f526e(0x204)]({'name':_0x51a288[_0x1f526e(0x253)]});console['log'](_0x8ce243);if(_0x52335e[0x0][_0x1f526e(0x27b)]=='English\x20(US)'){var _0xbffcf1=users[_0x1f526e(0x1b5)];console[_0x1f526e(0x263)](_0xbffcf1);}else{if(_0x52335e[0x0][_0x1f526e(0x27b)]==_0x1f526e(0x286))var _0xbffcf1=users['Hindi'];else{if(_0x52335e[0x0][_0x1f526e(0x27b)]==_0x1f526e(0x1b2))var _0xbffcf1=users['German'];else{if(_0x52335e[0x0][_0x1f526e(0x27b)]=='Spanish')var _0xbffcf1=users[_0x1f526e(0x1d3)];else{if(_0x52335e[0x0]['language']==_0x1f526e(0x254))var _0xbffcf1=users[_0x1f526e(0x254)];else{if(_0x52335e[0x0]['language']==_0x1f526e(0x1a0))var _0xbffcf1=users[_0x1f526e(0x240)];else{if(_0x52335e[0x0]['language']==_0x1f526e(0x217))var _0xbffcf1=users[_0x1f526e(0x217)];else{if(_0x52335e[0x0]['language']==_0x1f526e(0x1bd))var _0xbffcf1=users[_0x1f526e(0x211)];}}}}}}}_0x9ac400['render'](_0x1f526e(0x229),{'success':_0x50f082[_0x1f526e(0x1ea)]('success'),'errors':_0x50f082[_0x1f526e(0x1ea)](_0x1f526e(0x2b4)),'role':_0x36f2c8,'profile':_0x2cc6d4,'master_shop':_0x52335e,'supplier':_0x8ce243,'purchase':_0x51a288,'language':_0xbffcf1});}catch(_0x22bfbf){console[_0x1f526e(0x263)](_0x22bfbf);}}),router[a0_0x37d6eb(0x23c)](a0_0x37d6eb(0x292),auth,async(_0x2b3854,_0x5ea3bc)=>{var _0x58c841=a0_0x37d6eb;try{const {username:_0x3cac72,email:_0x343a28,role:_0x4d4a1a}=_0x2b3854[_0x58c841(0x1fa)],_0x1a7995=_0x2b3854[_0x58c841(0x1fa)],_0x468126=await profile[_0x58c841(0x204)]({'email':_0x1a7995['email']}),_0xd90948=await master_shop[_0x58c841(0x2ae)]();console[_0x58c841(0x263)](_0x58c841(0x223),_0xd90948);const _0x544f59=_0x2b3854['params']['id'];console[_0x58c841(0x263)](_0x544f59);const _0x4202c1=await purchases[_0x58c841(0x1fc)](_0x544f59);console['log'](_0x58c841(0x1c6),_0x4202c1);const _0x4f426b=await product[_0x58c841(0x2ae)]({}),_0x4a62d6=await warehouse[_0x58c841(0x287)]([{'$match':{'name':_0x4202c1[_0x58c841(0x2b1)],'room':_0x4202c1[_0x58c841(0x2a0)],'warehouse_category':_0x58c841(0x27f)}},{'$unwind':_0x58c841(0x1f4)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x58c841(0x290)},'product_stock':{'$first':_0x58c841(0x200)},'bay':{'$first':_0x58c841(0x1ed)},'bin':{'$first':_0x58c841(0x2a7)},'type':{'$first':_0x58c841(0x28f)},'floorlevel':{'$first':_0x58c841(0x1bc)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x58c841(0x1de)},'product_code':{'$first':_0x58c841(0x1a2)},'storage':{'$first':_0x58c841(0x26a)},'rack':{'$first':_0x58c841(0x210)}}}]);warehouse_data=await warehouse[_0x58c841(0x287)]([{'$match':{'status':_0x58c841(0x1cb),'name':_0x58c841(0x1ba),'warehouse_category':_0x58c841(0x27f)}},{'$group':{'_id':_0x58c841(0x1cf),'name':{'$first':_0x58c841(0x1cf)}}},{'$sort':{'name':0x1}}]),console[_0x58c841(0x263)](_0x58c841(0x1a4),_0x4a62d6);if(_0xd90948[0x0][_0x58c841(0x27b)]=='English\x20(US)'){var _0x124dff=users['English'];console[_0x58c841(0x263)](_0x124dff);}else{if(_0xd90948[0x0][_0x58c841(0x27b)]==_0x58c841(0x286))var _0x124dff=users[_0x58c841(0x286)];else{if(_0xd90948[0x0][_0x58c841(0x27b)]=='German')var _0x124dff=users[_0x58c841(0x1b2)];else{if(_0xd90948[0x0][_0x58c841(0x27b)]==_0x58c841(0x1d3))var _0x124dff=users['Spanish'];else{if(_0xd90948[0x0][_0x58c841(0x27b)]==_0x58c841(0x254))var _0x124dff=users[_0x58c841(0x254)];else{if(_0xd90948[0x0][_0x58c841(0x27b)]==_0x58c841(0x1a0))var _0x124dff=users[_0x58c841(0x240)];else{if(_0xd90948[0x0][_0x58c841(0x27b)]=='Chinese')var _0x124dff=users['Chinese'];else{if(_0xd90948[0x0][_0x58c841(0x27b)]==_0x58c841(0x1bd))var _0x124dff=users['Arabic'];}}}}}}}_0x5ea3bc['render'](_0x58c841(0x280),{'success':_0x2b3854[_0x58c841(0x1ea)]('success'),'errors':_0x2b3854[_0x58c841(0x1ea)](_0x58c841(0x2b4)),'role':_0x1a7995,'profile':_0x468126,'user':_0x4202c1,'stock':_0x4a62d6,'master_shop':_0xd90948,'product':_0x4f426b,'language':_0x124dff,'warehouse':warehouse_data});}catch(_0x34d802){console['log'](_0x34d802);}}),router[a0_0x37d6eb(0x1d9)](a0_0x37d6eb(0x292),auth,async(_0xe64756,_0x193879)=>{var _0x7dca32=a0_0x37d6eb;try{const {invoice:_0x36728b,date:_0x618faa,warehouse_name:_0x1f12ad,Room_name:_0x2e5e59,product_name:_0x125001,purchase_quantity:_0x149267,stocks:_0x223eef,return_qty:_0x497231,note:_0x47eef3,level:_0x441f52,isle:_0x3d3e7a,pallet:_0x314e5d,to_warehouse_name:_0x1b3f63,to_Room_name:_0x4b6eab}=_0xe64756[_0x7dca32(0x1c2)],_0x4ad5cb=await purchases[_0x7dca32(0x204)]({'_id':_0xe64756[_0x7dca32(0x225)]['id']}),_0x221870=await warehouse[_0x7dca32(0x204)]({'name':_0x1f12ad,'room':_0x2e5e59});if(typeof _0x125001==_0x7dca32(0x1c7))var _0x13ad0e=[_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x261)]],_0x2581b5=[_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1f9)]],_0x528718=[_0xe64756['body'][_0x7dca32(0x29d)]],_0x4dc355=[_0xe64756['body'][_0x7dca32(0x21b)]],_0x43e9d4=[_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1d7)]],_0x423684=[_0xe64756[_0x7dca32(0x1c2)]['isle']],_0xe2235f=[_0xe64756['body']['pallet']],_0xfd1b40=[_0xe64756[_0x7dca32(0x1c2)]['types']],_0x2420e0=[_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1e9)]],_0x5c9f04=[_0xe64756[_0x7dca32(0x1c2)]['primary_code_hide']],_0x5efdc4=[_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x19e)]];else var _0x13ad0e=[..._0xe64756[_0x7dca32(0x1c2)]['product_name']],_0x2581b5=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1f9)]],_0x528718=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x29d)]],_0x4dc355=[..._0xe64756[_0x7dca32(0x1c2)]['return_qty']],_0x43e9d4=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1d7)]],_0x423684=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1b0)]],_0xe2235f=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x1c5)]],_0xfd1b40=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x294)]],_0x2420e0=[..._0xe64756['body']['product_code_hide']],_0x5c9f04=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x29e)]],_0x5efdc4=[..._0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x19e)]];const _0x9cec86=_0x13ad0e[_0x7dca32(0x266)](_0x30fa5f=>{return _0x30fa5f={'product_name':_0x30fa5f};});_0x2581b5['forEach']((_0x4f6eda,_0x115985)=>{var _0x3e45c5=_0x7dca32;_0x9cec86[_0x115985][_0x3e45c5(0x1f9)]=_0x4f6eda;}),_0x528718[_0x7dca32(0x1ec)]((_0x2390d2,_0x59cfd0)=>{var _0x3a3a1d=_0x7dca32;_0x9cec86[_0x59cfd0][_0x3a3a1d(0x295)]=_0x2390d2;}),_0x4dc355[_0x7dca32(0x1ec)]((_0x2efa73,_0x5f2d05)=>{var _0x30ee47=_0x7dca32;_0x9cec86[_0x5f2d05][_0x30ee47(0x21b)]=_0x2efa73;}),_0x43e9d4['forEach']((_0x214a69,_0x4ef347)=>{var _0x5dfa0c=_0x7dca32;_0x9cec86[_0x4ef347][_0x5dfa0c(0x2bb)]=_0x214a69;}),_0x423684[_0x7dca32(0x1ec)]((_0x3e0241,_0x2acc8e)=>{var _0x27f402=_0x7dca32;_0x9cec86[_0x2acc8e][_0x27f402(0x227)]=_0x3e0241;}),_0xe2235f[_0x7dca32(0x1ec)]((_0x40c9c1,_0x120ecf)=>{var _0x1b7bb6=_0x7dca32;_0x9cec86[_0x120ecf][_0x1b7bb6(0x25f)]=_0x40c9c1;}),_0xfd1b40[_0x7dca32(0x1ec)]((_0x5256d4,_0x24bc19)=>{var _0x38709f=_0x7dca32;_0x9cec86[_0x24bc19][_0x38709f(0x1c0)]=_0x5256d4;}),_0x2420e0['forEach']((_0x30066d,_0x37ff60)=>{_0x9cec86[_0x37ff60]['product_code']=_0x30066d;}),_0x5c9f04['forEach']((_0x379aac,_0x361874)=>{_0x9cec86[_0x361874]['primary_code']=_0x379aac;}),_0x5efdc4[_0x7dca32(0x1ec)]((_0x3c05d4,_0x2bb5f3)=>{var _0x2a137e=_0x7dca32;_0x9cec86[_0x2bb5f3][_0x2a137e(0x1f5)]=_0x3c05d4;}),_0x4ad5cb[_0x7dca32(0x2a6)][_0x7dca32(0x1ec)](_0x1d3175=>{var _0x4290f9=_0x7dca32;const _0x1f221e=_0x221870[_0x4290f9(0x22a)][_0x4290f9(0x266)](_0x3d87e3=>{var _0x335011=_0x4290f9;_0x3d87e3[_0x335011(0x261)]==_0x1d3175['product_name']&&_0x3d87e3[_0x335011(0x25f)]==_0x1d3175[_0x335011(0x25f)]&&_0x3d87e3[_0x335011(0x1c0)]==_0x1d3175[_0x335011(0x1c0)]&&_0x3d87e3[_0x335011(0x227)]==_0x1d3175[_0x335011(0x227)]&&_0x3d87e3[_0x335011(0x2bb)]==_0x1d3175[_0x335011(0x2bb)]&&_0x3d87e3[_0x335011(0x22f)]==_0x1d3175[_0x335011(0x22f)]&&_0x3d87e3['storage']==_0x1d3175[_0x335011(0x228)]&&(console['log'](parseInt(_0x3d87e3[_0x335011(0x241)])+_0x335011(0x1db)+parseInt(_0x1d3175[_0x335011(0x21e)])),_0x3d87e3['product_stock']=parseInt(_0x3d87e3[_0x335011(0x241)])+parseInt(_0x1d3175['quantity']));});}),await _0x221870[_0x7dca32(0x279)]();const _0x279f92=_0x9cec86[_0x7dca32(0x28c)](_0x32616e=>_0x32616e[_0x7dca32(0x21b)]!=='0'&&_0x32616e[_0x7dca32(0x21b)]!=='');var _0xfcb219=0x0;_0x279f92[_0x7dca32(0x1ec)](_0x12c60f=>{var _0x20fb70=_0x7dca32;console[_0x20fb70(0x263)](_0x20fb70(0x297),_0x12c60f),(parseInt(_0x12c60f[_0x20fb70(0x1f9)])<parseInt(_0x12c60f[_0x20fb70(0x21b)])||parseInt(_0x12c60f[_0x20fb70(0x295)])<parseInt(_0x12c60f[_0x20fb70(0x21b)]))&&_0xfcb219++;});if(_0xfcb219!=0x0)return _0xe64756['flash']('errors','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty'),_0x193879[_0x7dca32(0x235)](_0x7dca32(0x273));const _0x2d1bf4=new purchases_return({'invoice':_0x36728b,'suppliers':_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x253)],'date':_0x618faa,'warehouse_name':_0x1f12ad,'return_product':_0x279f92,'note':_0x47eef3,'room':_0x2e5e59,'to_warehouse_name':_0x1b3f63,'to_room':_0x4b6eab}),_0xd38e42=await _0x2d1bf4['save']();console['log'](_0x2d1bf4);const _0x3ecd73=await purchases_return[_0x7dca32(0x204)]({'invoice':_0x36728b}),_0x42ce3f=await warehouse[_0x7dca32(0x204)]({'name':_0x1b3f63,'room':_0x4b6eab});_0x3ecd73[_0x7dca32(0x250)][_0x7dca32(0x1ec)](_0x35fe90=>{var _0x2d9f26=_0x7dca32,_0x824432=0x0;const _0x45a55b=_0x42ce3f['product_details']['map'](_0x39645b=>{var _0x1f9288=a0_0x57e5;_0x39645b[_0x1f9288(0x261)]==_0x35fe90[_0x1f9288(0x261)]&&_0x39645b['floorlevel']==_0x35fe90[_0x1f9288(0x25f)]&&_0x39645b['type']==_0x35fe90[_0x1f9288(0x1c0)]&&_0x39645b[_0x1f9288(0x227)]==_0x35fe90['bin']&&_0x39645b[_0x1f9288(0x2bb)]==_0x35fe90[_0x1f9288(0x2bb)]&&(_0x39645b[_0x1f9288(0x241)]=parseInt(_0x39645b[_0x1f9288(0x241)])-parseInt(_0x35fe90['return_qty']),_0x824432++);});_0x824432=='0'&&(_0x42ce3f[_0x2d9f26(0x22a)]=_0x42ce3f[_0x2d9f26(0x22a)][_0x2d9f26(0x28e)]({'product_name':_0x35fe90[_0x2d9f26(0x261)],'product_stock':_0x35fe90[_0x2d9f26(0x21b)],'primary_code':_0x35fe90[_0x2d9f26(0x218)],'secondary_code':_0x35fe90['secondary_code'],'product_code':_0x35fe90[_0x2d9f26(0x233)],'storage':_0x35fe90[_0x2d9f26(0x228)],'rack':_0x35fe90[_0x2d9f26(0x22f)],'bay':_0x35fe90['bay'],'bin':_0x35fe90[_0x2d9f26(0x227)],'type':_0x35fe90[_0x2d9f26(0x1c0)],'floorlevel':_0x35fe90['floorlevel'],'maxProducts':_0x35fe90['maxStocks'],'unit':_0x35fe90[_0x2d9f26(0x281)],'secondary_unit':_0x35fe90[_0x2d9f26(0x1e8)],'expiry_date':_0x35fe90[_0x2d9f26(0x1e2)]}));}),await _0x42ce3f['save']();const _0x49e3a4=await purchases[_0x7dca32(0x204)]({'invoice':_0x36728b});_0x49e3a4[_0x7dca32(0x1bb)]='True';const _0x41484b=await _0x49e3a4[_0x7dca32(0x279)](),_0x4981c9=new s_payment_data({'invoice':_0x36728b,'suppliers':_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x253)],'reason':_0x7dca32(0x1ae)});await _0x4981c9[_0x7dca32(0x279)]();const _0x325df6=await master_shop[_0x7dca32(0x2ae)]();console[_0x7dca32(0x263)](_0x7dca32(0x1a7),_0x325df6[0x0][_0x7dca32(0x1ac)]);const _0x111a5d=await email_settings[_0x7dca32(0x204)](),_0x290cd5=await suppliers['findOne']({'name':_0xe64756[_0x7dca32(0x1c2)][_0x7dca32(0x253)]});console[_0x7dca32(0x263)](_0x7dca32(0x259),_0x290cd5);_0x325df6[0x0][_0x7dca32(0x277)]==0x1?(right_currency=_0x325df6[0x0][_0x7dca32(0x21f)],left_currency=''):(right_currency='',left_currency=_0x325df6[0x0][_0x7dca32(0x21f)]);var _0x24af92=_0x13ad0e,_0xaf19c6=_0x4dc355,_0x13bc1c='',_0x2b199b;for(_0x2b199b in _0x24af92){_0x13bc1c+=_0x7dca32(0x1b4)+_0x7dca32(0x257)+_0x24af92[_0x2b199b]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xaf19c6[_0x2b199b]+_0x7dca32(0x272)+_0x7dca32(0x1df);}console['log'](_0x7dca32(0x1eb),_0x13bc1c);let _0x2d79cc=nodemailer[_0x7dca32(0x289)]({'service':_0x7dca32(0x1ad),'auth':{'user':_0x111a5d[_0x7dca32(0x1be)],'pass':_0x111a5d['password']}}),_0xb10ac={'from':_0x111a5d[_0x7dca32(0x1be)],'to':_0x290cd5['email'],'subject':_0x7dca32(0x244),'attachments':[{'filename':_0x7dca32(0x28a),'path':__dirname+_0x7dca32(0x1cd)+_0x7dca32(0x22c)+_0x325df6[0x0][_0x7dca32(0x1ac)],'cid':'logo'}],'html':_0x7dca32(0x2ad)+'<html><head><title></title>'+'</head><body>'+_0x7dca32(0x20e)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x7dca32(0x20e)+_0x7dca32(0x231)+'</div>'+_0x7dca32(0x20e)+_0x7dca32(0x1a9)+_0x325df6[0x0]['site_title']+_0x7dca32(0x24c)+_0x7dca32(0x1ff)+'</div>'+_0x7dca32(0x203)+_0x7dca32(0x20e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x7dca32(0x1f0)+_0x36728b+'\x20'+_0x7dca32(0x248)+_0x7dca32(0x1d0)+_0x618faa+'\x20'+'</span>'+'</h5>'+_0x7dca32(0x1ff)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x7dca32(0x1a8)+_0x7dca32(0x1b4)+_0x7dca32(0x1f3)+_0x7dca32(0x213)+_0x7dca32(0x27e)+_0x7dca32(0x29a)+_0x7dca32(0x1df)+'</thead>'+_0x7dca32(0x1b7)+'\x20'+_0x13bc1c+'\x20'+'</tbody>'+_0x7dca32(0x238)+_0x7dca32(0x20e)+_0x7dca32(0x205)+_0x7dca32(0x2af)+_0x325df6[0x0][_0x7dca32(0x1cc)]+_0x7dca32(0x1e1)+_0x7dca32(0x1ff)+_0x7dca32(0x1ff)+_0x7dca32(0x284)};_0x2d79cc[_0x7dca32(0x1dd)](_0xb10ac,function(_0x4de86f,_0x443f6f){var _0x3e0a8f=_0x7dca32;_0x4de86f?(console['log'](_0x4de86f),console[_0x3e0a8f(0x263)](_0x3e0a8f(0x22b))):console['log'](_0x3e0a8f(0x270));}),_0xe64756[_0x7dca32(0x1ea)](_0x7dca32(0x1af),_0x7dca32(0x23a)),_0x193879[_0x7dca32(0x235)](_0x7dca32(0x25c));}catch(_0x49f37f){console[_0x7dca32(0x263)](_0x49f37f),_0x193879[_0x7dca32(0x1b1)](0xc8)[_0x7dca32(0x278)]({'message':_0x49f37f['message']});}}),router[a0_0x37d6eb(0x23c)](a0_0x37d6eb(0x222),auth,async(_0x669e41,_0x4656c0)=>{var _0x4b092e=a0_0x37d6eb;try{const {username:_0x46cc1a,email:_0xb415b1,role:_0x25eb0c}=_0x669e41[_0x4b092e(0x1fa)],_0x36659e=_0x669e41[_0x4b092e(0x1fa)],_0x1b41ae=await profile[_0x4b092e(0x204)]({'email':_0x36659e[_0x4b092e(0x1be)]}),_0x5c6548=await master_shop['find'](),_0x36e550=_0x669e41[_0x4b092e(0x225)]['id'],_0x1081bc=await purchases[_0x4b092e(0x1fc)](_0x36e550);if(_0x5c6548[0x0]['language']==_0x4b092e(0x25e))var _0x330b8c=users[_0x4b092e(0x1b5)];else{if(_0x5c6548[0x0]['language']==_0x4b092e(0x286))var _0x330b8c=users['Hindi'];else{if(_0x5c6548[0x0][_0x4b092e(0x27b)]==_0x4b092e(0x1b2))var _0x330b8c=users['German'];else{if(_0x5c6548[0x0]['language']=='Spanish')var _0x330b8c=users[_0x4b092e(0x1d3)];else{if(_0x5c6548[0x0][_0x4b092e(0x27b)]==_0x4b092e(0x254))var _0x330b8c=users[_0x4b092e(0x254)];else{if(_0x5c6548[0x0][_0x4b092e(0x27b)]==_0x4b092e(0x1a0))var _0x330b8c=users['Portuguese'];else{if(_0x5c6548[0x0]['language']==_0x4b092e(0x217))var _0x330b8c=users[_0x4b092e(0x217)];else{if(_0x5c6548[0x0][_0x4b092e(0x27b)]==_0x4b092e(0x1bd))var _0x330b8c=users[_0x4b092e(0x211)];}}}}}}}_0x4656c0[_0x4b092e(0x2a9)](_0x4b092e(0x1b6),{'success':_0x669e41[_0x4b092e(0x1ea)](_0x4b092e(0x1af)),'errors':_0x669e41['flash'](_0x4b092e(0x2b4)),'role':_0x36659e,'profile':_0x1b41ae,'alldata':_0x1081bc,'master_shop':_0x5c6548,'language':_0x330b8c}),console[_0x4b092e(0x263)](alldata);}catch(_0x11217e){console[_0x4b092e(0x263)](_0x11217e);}}),router[a0_0x37d6eb(0x1d9)](a0_0x37d6eb(0x1da),async(_0x5b9cf6,_0x5258cc)=>{var _0x2450bd=a0_0x37d6eb;const {product_code:_0x5abac0}=_0x5b9cf6['body'];var _0x5d8376;const _0x407b2c=await product[_0x2450bd(0x287)]([{'$match':{'primary_code':_0x5abac0,'product_category':_0x2450bd(0x27f)}},{'$group':{'_id':_0x2450bd(0x298),'name':{'$first':_0x2450bd(0x1cf)},'category':{'$first':_0x2450bd(0x1d5)},'brand':{'$first':_0x2450bd(0x2a4)},'unit':{'$first':_0x2450bd(0x2ba)},'alertquantity':{'$first':_0x2450bd(0x1e6)},'product_code':{'$first':_0x2450bd(0x1fe)},'primary_code':{'$first':_0x2450bd(0x247)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x2450bd(0x1e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x206018=await product[_0x2450bd(0x287)]([{'$match':{'secondary_code':_0x5abac0,'product_category':_0x2450bd(0x27f)}},{'$group':{'_id':'$_id','name':{'$first':_0x2450bd(0x1cf)},'category':{'$first':_0x2450bd(0x1d5)},'brand':{'$first':_0x2450bd(0x2a4)},'unit':{'$first':_0x2450bd(0x2ba)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x2450bd(0x1fe)},'primary_code':{'$first':_0x2450bd(0x247)},'secondary_code':{'$first':_0x2450bd(0x20c)},'maxStocks':{'$first':_0x2450bd(0x264)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x2450bd(0x1e3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x407b2c['length']>0x0)_0x5d8376=_0x407b2c;else _0x206018[_0x2450bd(0x285)]>0x0&&(_0x5d8376=_0x206018);_0x5258cc[_0x2450bd(0x278)](_0x5d8376);}),router['post'](a0_0x37d6eb(0x1f8),async(_0x1759af,_0x287064)=>{var _0x316f79=a0_0x37d6eb;const {primaryCode:_0x1cc825,secondaryCode:_0x31e2ab,productCode:_0x539720,bay:_0x3b92a8,bin:_0x57a3a4,types:_0xbb4ae8,pallet:_0x5746c2,warehouses:_0x7d5305,room:_0x3ad965}=_0x1759af[_0x316f79(0x1c2)];console[_0x316f79(0x263)](_0x1759af[_0x316f79(0x1c2)]);try{const _0x5897fb=await warehouse[_0x316f79(0x287)]([{'$match':{'name':_0x7d5305,'room':_0x3ad965}},{'$unwind':_0x316f79(0x1f4)},{'$match':{'product_details.bay':_0x3b92a8,'product_details.bin':_0x57a3a4,'product_details.type':_0xbb4ae8}},{'$group':{'_id':_0x316f79(0x299),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x316f79(0x200)},'level':{'$first':_0x316f79(0x27a)},'isle':{'$first':_0x316f79(0x23f)},'pallet':{'$first':_0x316f79(0x212)},'maxProducts':{'$first':_0x316f79(0x1f7)}}}]);_0x287064[_0x316f79(0x1b1)](0xc8)['json'](_0x5897fb);}catch(_0x3fed00){_0x287064[_0x316f79(0x1b1)](0x194)[_0x316f79(0x278)]({'message':_0x3fed00[_0x316f79(0x22e)]});}}),module[a0_0x37d6eb(0x239)]=router;function a0_0x367d(){var _0x1808b4=['$product','Purchase\x20Return\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','2674080WdHtDv','$primary_code','<span\x20style=\x22float:\x20right;\x22>','nodemailer','<table\x20style=\x22width:\x20100%\x20!important;\x22>','1205FcpZUS','\x20</h2>','rak','$date','</thead>','return_product','random','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','suppliers','French','/view/:id','Enclosed','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','../public/language/languages.json','suppliers_data','getFullYear','table\x20page','/all_purchases/view','here','English\x20(US)','floorlevel','POnumber','product_name','room_name','log','$maxStocks','/view/add_purchases/:id','map','$return_data','prod_secondunit','134rPybkl','$product_details.storage','Level','$product_details.primary_code','prod_isle','$note','864812GAWFvN','Email\x20sent\x20successfully','JO_number','</td>','back','$suppliers','max_product_unit','$product.quantity','currency_placement','json','save','$product_details.level','language','$warehouse_name','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','Raw\x20Materials','return_purchase','standard_unit','Rack\x20E','201474uiTwGR','</body></html>','length','Hindi','aggregate','product_cat','createTransport','Logo.png','MaxStocks_data','filter','warehouse','concat','$product_details.type','$product_details.product_name','push','/view/return_purchase/:id','name','types','stock_quantity','prod_unit','foreach\x20newproduct','$_id','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_name','Rack\x20A','stocks','primary_code_hide','actual_qty','room','prod_cat','INC-','Ambient','$brand','purchase\x20data\x20update\x20successfully','product','$product_details.bin','add_purchases\x20error','render','deliverycode','invoice','Router','<!DOCTYPE\x20html>','find','<h5>','prod_Qty','warehouse_name','staff','COLD\x20STORAGE','errors','floor','password','maxStocks','\x20<\x20wew\x20>\x20','delivery_date','$unit','bay','port','role','prod_level','secondary_code_hide','Room_name','Portuguese\x20(BR)','Rack\x20B','$product_details.product_code','$expiry_date','stock_data','prod_qty','Floor','add\x20post','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<h2>\x20','Shelves','$room','image','gmail','Purchase\x20Return','success','isle','status','German','1084224UbazEF','<tr>','English','all_purchases_barcode','<tbody\x20style=\x22text-align:\x20center;\x22>','Paid\x20For\x20Purchase','$product.bin','Return\x20Goods','return_data','$product_details.floorlevel','Arabic\x20(ae)','email','$batch_code','type','/all_purchases/view/','body','Rack\x20D','path','pallet','user_id','string','Rack\x20C','actual_uom','../models/all_models','Enabled','site_title','/../public','note','$name','\x20Order\x20Date\x20:\x20','DRY\x20STORAGE','3FFaTEJ','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$category','all','level','$paid_amount','post','/barcode_scanner','\x20<>\x20','amount','sendMail','$product_details.secondary_code','</tr>','Rack\x20F','</h5>','expiry_date','$secondary_unit','suppliers_docs','paid_amount','$alertquantity','RoomAssign','secondary_unit','product_code_hide','flash','product_list','forEach','$product_details.bay','$suppliers_docs','$invoice','\x20Order\x20Number\x20:\x20','Purchase\x20Mail','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details','secondary_code','<html><head><title></title>','$product_details.maxProducts','/CheckingWarehouse','purchase_quantity','user','delivery_code','findById','$product.floorlevel','$product_code','</div>','$product_details.product_stock','Receiving\x20Area','$product.bay','<hr\x20class=\x22my-3\x22>','findOne','<strong>\x20Regards\x20</strong>','payment\x20successfull','date','abs','due_amount','488Rawlof','maxperunit','$secondary_code','$due_amount','<div>','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.rack','Arabic','$product_details.pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.expiry_date','/give_payment/:id','../middleware/auth','Chinese','primary_code','$product.room_name','$product.type','return_qty','production_date','prod_code','quantity','currency','/view/add_purchases','batch_code','/barcode/:id','master','1089225qlFZLG','params','alertQTY','bin','storage','purchase_invoice','product_details','Error\x20Occurs','/upload/','/preview/:id','message','rack','Sales\x20Update\x20successfully','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_code','prod_invoice','redirect','edit_purchases_view','getDate','</table>','exports','purchases\x20item\x20return\x20successfull','catch','get','error','29763sqXFLI','$product_details.isle','Portuguese','product_stock','slice'];a0_0x367d=function(){return _0x1808b4;};return a0_0x367d();}