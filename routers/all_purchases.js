var a0_0xe1dfd2=a0_0x1177;(function(_0xe7a1ca,_0x56ebeb){var _0x562e7f=a0_0x1177,_0x5b9edc=_0xe7a1ca();while(!![]){try{var _0x2e2064=parseInt(_0x562e7f(0x1c1))/0x1*(-parseInt(_0x562e7f(0x1a8))/0x2)+parseInt(_0x562e7f(0x172))/0x3+parseInt(_0x562e7f(0x1b8))/0x4+parseInt(_0x562e7f(0x1b2))/0x5+-parseInt(_0x562e7f(0x289))/0x6*(-parseInt(_0x562e7f(0x1af))/0x7)+parseInt(_0x562e7f(0x1de))/0x8+-parseInt(_0x562e7f(0x24c))/0x9;if(_0x2e2064===_0x56ebeb)break;else _0x5b9edc['push'](_0x5b9edc['shift']());}catch(_0x951ff2){_0x5b9edc['push'](_0x5b9edc['shift']());}}}(a0_0x1286,0x346cc));function a0_0x1177(_0xc66da0,_0x3ea9ae){var _0x128688=a0_0x1286();return a0_0x1177=function(_0x1177f6,_0x4fcd06){_0x1177f6=_0x1177f6-0x16b;var _0x40cbb8=_0x128688[_0x1177f6];return _0x40cbb8;},a0_0x1177(_0xc66da0,_0x3ea9ae);}const express=require(a0_0xe1dfd2(0x23e)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require('nodemailer');var ejs=require(a0_0xe1dfd2(0x1b9));const path=require(a0_0xe1dfd2(0x281)),users=require('../public/language/languages.json');router[a0_0xe1dfd2(0x285)](a0_0xe1dfd2(0x255),auth,async(_0x1de877,_0x232c54)=>{var _0x571151=a0_0xe1dfd2;try{const {username:_0x315a26,email:_0xe2a1c4,role:_0x26a92c}=_0x1de877[_0x571151(0x187)],_0x1ba6fd=_0x1de877[_0x571151(0x187)],_0x5c06ad=await profile[_0x571151(0x27d)]({'email':_0x1ba6fd[_0x571151(0x286)]}),_0x2c70f6=await staff['findOne']({'email':_0x1ba6fd[_0x571151(0x286)]});if(_0x1ba6fd[_0x571151(0x26b)]==_0x571151(0x1f6)){const _0x343239=await staff[_0x571151(0x27d)]({'email':_0x1ba6fd[_0x571151(0x286)]});}const _0x4e790d=await master_shop['find']();let _0x3a49b3;if(_0x1ba6fd[_0x571151(0x26b)]==_0x571151(0x1f6)){const _0x2e1484=await staff['findOne']({'email':_0x1ba6fd[_0x571151(0x286)]});_0x3a49b3=await purchases[_0x571151(0x256)]([{'$match':{'warehouse_name':_0x2e1484[_0x571151(0x251)]}},{'$lookup':{'from':_0x571151(0x225),'localField':_0x571151(0x225),'foreignField':'name','as':_0x571151(0x260)}},{'$unwind':_0x571151(0x1d5)},{'$unwind':_0x571151(0x279)},{'$group':{'_id':'$_id','invoice':{'$first':_0x571151(0x1bb)},'suppliers':{'$first':_0x571151(0x252)},'date':{'$first':_0x571151(0x1ab)},'warehouse_name':{'$first':_0x571151(0x21f)},'room':{'$first':_0x571151(0x196)},'product':{'$push':_0x571151(0x279)},'note':{'$first':_0x571151(0x197)},'paid_amount':{'$first':_0x571151(0x268)},'due_amount':{'$first':_0x571151(0x16e)},'return_data':{'$first':_0x571151(0x25d)},'batch_code':{'$first':_0x571151(0x22a)},'expiry_date':{'$first':_0x571151(0x1da)},'suppliers_docs':{'$first':_0x571151(0x1d5)},'total_product_quantity':{'$sum':_0x571151(0x1fe)},'level':{'$addToSet':_0x571151(0x24f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x571151(0x1e2)},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3a49b3=await purchases['aggregate']([{'$lookup':{'from':_0x571151(0x225),'localField':_0x571151(0x225),'foreignField':_0x571151(0x287),'as':_0x571151(0x260)}},{'$unwind':_0x571151(0x1d5)},{'$unwind':_0x571151(0x279)},{'$group':{'_id':_0x571151(0x262),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x571151(0x252)},'date':{'$first':_0x571151(0x1ab)},'warehouse_name':{'$first':_0x571151(0x21f)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':'$product'},'note':{'$first':_0x571151(0x197)},'paid_amount':{'$first':_0x571151(0x268)},'due_amount':{'$first':_0x571151(0x16e)},'return_data':{'$first':_0x571151(0x25d)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x571151(0x1da)},'suppliers_docs':{'$first':_0x571151(0x1d5)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x571151(0x24f)},'isle':{'$addToSet':_0x571151(0x200)},'type':{'$addToSet':_0x571151(0x1e2)},'floorlevel':{'$addToSet':_0x571151(0x1ee)},'finalize':{'$first':_0x571151(0x180)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x4e790d[0x0][_0x571151(0x277)]==_0x571151(0x16f)){var _0x258a84=users[_0x571151(0x23b)];console['log'](_0x258a84);}else{if(_0x4e790d[0x0][_0x571151(0x277)]==_0x571151(0x1a6))var _0x258a84=users[_0x571151(0x1a6)];else{if(_0x4e790d[0x0]['language']==_0x571151(0x24a))var _0x258a84=users[_0x571151(0x24a)];else{if(_0x4e790d[0x0][_0x571151(0x277)]==_0x571151(0x1c7))var _0x258a84=users[_0x571151(0x1c7)];else{if(_0x4e790d[0x0]['language']==_0x571151(0x1ca))var _0x258a84=users[_0x571151(0x1ca)];else{if(_0x4e790d[0x0][_0x571151(0x277)]=='Portuguese\x20(BR)')var _0x258a84=users[_0x571151(0x248)];else{if(_0x4e790d[0x0][_0x571151(0x277)]==_0x571151(0x23a))var _0x258a84=users[_0x571151(0x23a)];else{if(_0x4e790d[0x0][_0x571151(0x277)]==_0x571151(0x181))var _0x258a84=users[_0x571151(0x249)];}}}}}}}_0x232c54[_0x571151(0x16b)](_0x571151(0x224),{'success':_0x1de877['flash']('success'),'errors':_0x1de877[_0x571151(0x1f1)](_0x571151(0x214)),'purchases':_0x3a49b3,'role':_0x1ba6fd,'profile':_0x5c06ad,'master_shop':_0x4e790d,'language':_0x258a84});}catch(_0x5880ab){console[_0x571151(0x1bc)](_0x571151(0x1ed),_0x5880ab),_0x232c54['status'](0xc8)[_0x571151(0x1e1)]({'message':_0x5880ab[_0x571151(0x26c)]});}});function BayBinSelected(_0xe86ea,_0x41c935){var _0x3ea8fb=a0_0xe1dfd2,_0x4b13aa=[],_0x189af7=[],_0x1cfb0f=[],_0x316304=[],_0x2315e8=[],_0x189049=[];let _0x32cd59=[];if(_0xe86ea==_0x3ea8fb(0x1e3))switch(_0x41c935){case _0x3ea8fb(0x1dd):_0x4b13aa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x189af7=[0x1,0x2],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=[_0x3ea8fb(0x189),_0x3ea8fb(0x1ec)],_0x2315e8=['D'],_0x189049=['A'];break;case'Rack\x20B':_0x4b13aa=[0x6,0x5,0x4,0x3,0x2,0x1],_0x189af7=[0x1,0x2],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=['Level',_0x3ea8fb(0x1ec)],_0x2315e8=['D'],_0x189049=['B'];break;case _0x3ea8fb(0x230):_0x4b13aa=[0x0],_0x189af7=[0x0],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=['Floor'],_0x2315e8=['D'],_0x189049=['S'];break;case _0x3ea8fb(0x258):_0x4b13aa=[0x0],_0x189af7=[0x0],_0x316304=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1cfb0f=['Floor'],_0x2315e8=['D'],_0x189049=['R'];break;}else{if(_0xe86ea==_0x3ea8fb(0x191))switch(_0x41c935){case _0x3ea8fb(0x1dd):_0x4b13aa=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x189af7=['B','F'],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=[_0x3ea8fb(0x189),_0x3ea8fb(0x1ec)],_0x2315e8=['C'],_0x189049=['A'];break;case _0x3ea8fb(0x194):_0x4b13aa=[0x5,0x4,0x3,0x2,0x1],_0x189af7=['F','B','S'],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=['Level','Floor'],_0x2315e8=['C'],_0x189049=['B'];break;case'Rack\x20C':_0x4b13aa=[0x1,0x2,0x3,0x4,0x5],_0x189af7=['B','F','S'],_0x316304=[0x5,0x4,0x3,0x2,0x1],_0x1cfb0f=['Level','Floor'],_0x2315e8=['C'],_0x189049=['C'];break;case _0x3ea8fb(0x1c5):_0x4b13aa=[0x5,0x4,0x3,0x2,0x1],_0x189af7=['F','B','S'],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=[_0x3ea8fb(0x189),_0x3ea8fb(0x1ec)],_0x2315e8=['C'],_0x189049=['D'];break;case _0x3ea8fb(0x222):_0x4b13aa=[0x4,0x3,0x2,0x1],_0x189af7=[0x1,0x2],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=['Level','Floor'],_0x2315e8=['C'],_0x189049=['E'];break;case _0x3ea8fb(0x1eb):_0x4b13aa=[0x1,0x2,0x3],_0x189af7=[0x1,0x2],_0x316304=[0x1,0x2,0x3,0x4,0x5],_0x1cfb0f=['Level'],_0x2315e8=['C'],_0x189049=['F'];break;}}return{'levels':_0x4b13aa,'Isle':_0x189af7,'rack':_0x316304,'type':_0x1cfb0f,'storage':_0x2315e8,'rak':_0x189049};}function a0_0x1286(){var _0x4ffabb=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</td>','stock_data','product_list','$expiry_date','<tbody\x20style=\x22text-align:\x20center;\x22>','getDate','Rack\x20A','1115296rctkcZ','<h2>\x20','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','json','$product.type','DRY\x20STORAGE','storage','suppliers_data','$secondary_code','deliverycode','site_title','getMonth','body','Rack\x20F','Floor','table\x20page','$product.floorlevel','slice','secondary_code_hide','flash','$brand','<strong>\x20Regards\x20</strong>','Sales\x20Update\x20successfully','exports','staff','$secondary_unit','</table>','filter','quantity','expiry_date','find','length','$product.quantity','findById','$product.bin','$product_details.isle','$product_details.floorlevel','sendMail','</div>','Purchase\x20Return','secondary_unit','Room_name','all_purchases_barcode','host','/view/:id','\x20Order\x20Date\x20:\x20','$product_details.expiry_date','prod_secondunit','$product_details.primary_code','prod_primunit','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$category','RMSEmail','Purchase\x20Mail','errors','prod_cat','</body></html>','return_purchase','status','room_name','$product_details.rack','$product_details','\x20<>\x20','An\x20error\x20occurred.','actual_uom','$warehouse_name','stocks','due_amount','Rack\x20E','<h5\x20style=\x22text-align:\x20left;\x22>','all_purchases','suppliers','map','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Logo.png','/upload/','$batch_code','$product_details.product_code','then','Error\x20Occurs','$name','bay','Shelves','success','$product_details.pallet','pallet','level','/all_purchases/view','logo','type','POnumber','master','Chinese','English','$product_details.type','purchase_quantity','express','$product_details.product_stock','MaxStocks_data','$product_details.storage','product_name','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','redirect','rak','createTransport','Portuguese','Arabic','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','1754154nqtNwn','paid_amount','<!DOCTYPE\x20html>','$product.bay','Portuguese\x20(BR)','warehouse','$suppliers','delivery_code','$product_details.bay','/view','aggregate','$primary_code','Receiving\x20Area','/preview/:id','production_date','product_cat','$unit','$return_data','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/CheckingWarehouse','suppliers_docs','prod_pallet','$_id','$alertquantity','prod_isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','room','actual_qty','$paid_amount','post','toString','role','message','floorlevel','currency','prod_level','back','<tr>','product','maxperunit','<hr\x20class=\x22my-3\x22>','<h5>','save','language','standard_unit','$product','product_code','catch','return_data','findOne','purchase_invoice','</tr>','string','path','True','batch_code','max_product_unit','get','email','name','foreach\x20newproduct','42UyzStE','render','types','JO_number','$due_amount','English\x20(US)','primary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','5367NJSXzf','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','rack','push','$product_details.level','$product_details._id','abs','prod_invoice','/barcode_scanner','$product_details.secondary_code','/give_payment/:id','prod_name','Return\x20Goods','product_code_hide','$finalize','Arabic\x20(ae)','$product_details.maxProducts','add_purchases','error','edit_purchases_view','</h5>','user','prod_Qty','Level','/view/return_purchase/:id','$product_details.product_name','RoomAssign','product_stock','gmail','Enclosed','date','COLD\x20STORAGE','</thead>','/all_purchases/view/','Rack\x20B','maxStocks','$room','$note','prod_code','INC-','prod_qty','alertQTY','bin','<span\x20style=\x22float:\x20right;\x22>','product_details','finalize','getFullYear','secondary_code','random','</span>','<div>','return_qty','Hindi','Paid\x20For\x20Purchase','2nFWAUc','here','<html><head><title></title>','$date','params','isle','\x20Order\x20Number\x20:\x20','64589eumLWj','Purchase\x20Return\x20Mail','</head><body>','1217370ZeGOTb','purchase\x20data\x20update\x20successfully','$maxProdPerUnit','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','Raw\x20Materials','243084CKBxJx','ejs','image','$invoice','log','floor','password','port','Purchase\x20data\x20added\x20successfully','100397ZkNYUP','\x20</h2>','forEach','prod_unit','Rack\x20D','Enabled','Spanish','primary_code','$maxStocks','French','concat','warehouse_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','payment\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Email\x20sent\x20successfully','/../public','$product_code','delivery_date','$suppliers_docs'];a0_0x1286=function(){return _0x4ffabb;};return a0_0x1286();}async function getRandom8DigitNumber(){var _0x2c10ae=a0_0xe1dfd2;const _0x49dcd6=0x989680,_0x112a95=0x5f5e0ff,_0x4ba771=Math[_0x2c10ae(0x1bd)](Math[_0x2c10ae(0x1a2)]()*(_0x112a95-_0x49dcd6+0x1))+_0x49dcd6;var _0x2cecd3;const _0x53bafb=await purchases[_0x2c10ae(0x27d)]({'invoice':_0x2c10ae(0x199)+_0x4ba771});return _0x53bafb&&_0x53bafb['length']>0x0?_0x2cecd3=_0x2c10ae(0x199)+_0x4ba771:_0x2cecd3=_0x2c10ae(0x199)+_0x4ba771,_0x2cecd3;}router[a0_0xe1dfd2(0x285)]('/view/add_purchases',auth,async(_0x2524bf,_0x44236d)=>{var _0x3646fe=a0_0xe1dfd2;try{const {username:_0x300d6c,email:_0x19e65c,role:_0x3435f0}=_0x2524bf[_0x3646fe(0x187)],_0x4d6d42=_0x2524bf[_0x3646fe(0x187)],_0x6eccbd=await profile['findOne']({'email':_0x4d6d42[_0x3646fe(0x286)]}),_0xfb2899=await master_shop['find'](),_0x3e583a=await staff['findOne']({'email':_0x4d6d42[_0x3646fe(0x286)]}),_0x1c7571=await suppliers[_0x3646fe(0x1fc)]({});let _0xc7a1a;if(_0x4d6d42[_0x3646fe(0x26b)]==_0x3646fe(0x1f6)){const _0x1a7938=await staff[_0x3646fe(0x27d)]({'email':_0x4d6d42[_0x3646fe(0x286)]});_0xc7a1a=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x1a7938['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x3646fe(0x17e)}}},{'$group':{'_id':_0x3646fe(0x22e),'name':{'$first':_0x3646fe(0x22e)}}}]);}else _0xc7a1a=await warehouse[_0x3646fe(0x256)]([{'$match':{'status':_0x3646fe(0x1c6),'warehouse_category':_0x3646fe(0x1b7),'name':{'$ne':_0x3646fe(0x17e)}}},{'$group':{'_id':'$name','name':{'$first':_0x3646fe(0x22e)}}}]);const _0x56df3f=await product[_0x3646fe(0x1fc)]({}),_0x468daa=await warehouse[_0x3646fe(0x1fc)]({'status':_0x3646fe(0x1c6)}),_0xf5d82b=await purchases['find']({}),_0x5b3851=_0xf5d82b[_0x3646fe(0x1fd)]+0x1,_0x4f818d='INC-'+_0x5b3851[_0x3646fe(0x26a)]()['padStart'](0x5,'0');var _0x43d653=['Ambient',_0x3646fe(0x18f)];if(_0xfb2899[0x0][_0x3646fe(0x277)]=='English\x20(US)')var _0x936cb1=users[_0x3646fe(0x23b)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]=='Hindi')var _0x936cb1=users[_0x3646fe(0x1a6)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]==_0x3646fe(0x24a))var _0x936cb1=users[_0x3646fe(0x24a)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]==_0x3646fe(0x1c7))var _0x936cb1=users[_0x3646fe(0x1c7)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]=='French')var _0x936cb1=users[_0x3646fe(0x1ca)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]==_0x3646fe(0x250))var _0x936cb1=users[_0x3646fe(0x248)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]==_0x3646fe(0x23a))var _0x936cb1=users[_0x3646fe(0x23a)];else{if(_0xfb2899[0x0][_0x3646fe(0x277)]==_0x3646fe(0x181))var _0x936cb1=users[_0x3646fe(0x249)];}}}}}}}const _0x54965c=getRandom8DigitNumber();_0x54965c['then'](_0xf4e337=>{var _0x4a0ac2=_0x3646fe;_0x44236d['render'](_0x4a0ac2(0x183),{'success':_0x2524bf[_0x4a0ac2(0x1f1)](_0x4a0ac2(0x231)),'errors':_0x2524bf[_0x4a0ac2(0x1f1)](_0x4a0ac2(0x214)),'role':_0x4d6d42,'profile':_0x6eccbd,'suppliers':_0x1c7571,'warehouse':_0xc7a1a,'product':_0x56df3f,'invoice':_0xf4e337,'master_shop':_0xfb2899,'language':_0x936cb1,'find_data':_0x468daa,'rooms_data':_0x43d653});})[_0x3646fe(0x27b)](_0x58fed9=>{var _0x736c=_0x3646fe;_0x2524bf[_0x736c(0x1f1)](_0x736c(0x214),_0x736c(0x1cd)),_0x44236d[_0x736c(0x245)]('/all_purchases/view');});}catch(_0x27fba3){console[_0x3646fe(0x1bc)](_0x27fba3);}}),router[a0_0xe1dfd2(0x285)]('/view/add_purchases/:id',auth,async(_0x4f8e2c,_0x20092d)=>{var _0x138006=a0_0xe1dfd2;try{const _0x365684=_0x4f8e2c['params']['id'];console[_0x138006(0x1bc)](_0x365684);const _0x5d2439=await master_shop[_0x138006(0x1fc)]();console['log']('master',_0x5d2439);const _0x75befd=await product['findOne']({'name':_0x365684});console['log'](_0x138006(0x272),_0x75befd),_0x20092d[_0x138006(0x218)](0xc8)[_0x138006(0x1e1)]({'product_data':_0x75befd,'master':_0x5d2439});}catch(_0x4b4f5a){console[_0x138006(0x1bc)]('add_purchases\x20error',_0x4b4f5a);}}),router[a0_0xe1dfd2(0x269)]('/view/add_purchases',auth,async(_0x36b764,_0x356b5d)=>{var _0x5ef8de=a0_0xe1dfd2;try{const {invoice:_0x4f1789,date:_0x37f0bb,warehouse_name:_0xbef5d,prod_name:_0x48767c,prod_code:_0x4162e7,prod_qty:_0x3d6d3e,prod_unit:_0x82af88,prod_secondunit:_0xfddb6b,prod_level:_0x545b13,prod_isle:_0x388a45,prod_pallet:_0x1bd6e0,note:_0x482821,expiry_date:_0x2cadfd,batch_code:_0x46b5fd,payable:_0x3755f2,due_amount:_0x2512c2,Room_name:_0x5d2cc0,primary_code:_0x435bb0,secondary_code:_0x2778d7,MaxStocks_data:_0x3a3d73,PO_number:_0x5229b8,SCRN:_0xda8324,JO_number:_0x4b233f}=_0x36b764[_0x5ef8de(0x1ea)];if(typeof _0x48767c==_0x5ef8de(0x280))var _0x4d73f4=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x17d)]],_0x215f93=[_0x36b764['body'][_0x5ef8de(0x198)]],_0x4c066e=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x188)]],_0x469393=[_0x36b764['body'][_0x5ef8de(0x20f)]],_0xfebc19=[_0x36b764['body'][_0x5ef8de(0x20d)]],_0x322094=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x26f)]],_0x539809=[_0x36b764['body']['primary_code']],_0xfc2d9e=[_0x36b764[_0x5ef8de(0x1ea)]['secondary_code']],_0x1fc42d=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x240)]],_0x4d8d66=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x283)]],_0x5a4036=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x1fb)]],_0x4c488a=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x284)]],_0x4aa3c8=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x19b)]],_0x3de53a=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x25a)]],_0x4e197e=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x215)]],_0x379623=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x18c)]],_0x2b9903=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x1e7)]],_0x1c7547=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x179)]],_0x11ddf4=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x267)]],_0x10dfb1=[_0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x21e)]];else var _0x4d73f4=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x17d)]],_0x215f93=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x198)]],_0x4c066e=[..._0x36b764[_0x5ef8de(0x1ea)]['prod_Qty']],_0x469393=[..._0x36b764[_0x5ef8de(0x1ea)]['prod_primunit']],_0xfebc19=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x20d)]],_0x322094=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x26f)]],_0x539809=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x1c8)]],_0xfc2d9e=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x1a1)]],_0x1fc42d=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x240)]],_0x4d8d66=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x283)]],_0x5a4036=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x1fb)]],_0x4c488a=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x284)]],_0x4aa3c8=[..._0x36b764[_0x5ef8de(0x1ea)]['alertQTY']],_0x3de53a=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x25a)]],_0x4e197e=[..._0x36b764[_0x5ef8de(0x1ea)]['prod_cat']],_0x379623=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x18c)]],_0x2b9903=[..._0x36b764[_0x5ef8de(0x1ea)][_0x5ef8de(0x1e7)]],_0x1c7547=[..._0x36b764[_0x5ef8de(0x1ea)]['prod_invoice']],_0x11ddf4=[..._0x36b764['body'][_0x5ef8de(0x267)]],_0x10dfb1=[..._0x36b764['body'][_0x5ef8de(0x21e)]];const _0x465481=_0x4d73f4[_0x5ef8de(0x226)](_0x11aa8f=>{return _0x11aa8f={'product_name':_0x11aa8f};});_0x11ddf4[_0x5ef8de(0x1c3)]((_0x58876b,_0x2f573a)=>{var _0xaf22dc=_0x5ef8de;_0x465481[_0x2f573a][_0xaf22dc(0x267)]=Math[_0xaf22dc(0x178)](_0x58876b);}),_0x10dfb1[_0x5ef8de(0x1c3)]((_0x6e5315,_0x27cc33)=>{var _0x3f9827=_0x5ef8de;_0x465481[_0x27cc33][_0x3f9827(0x21e)]=_0x6e5315;}),_0x215f93[_0x5ef8de(0x1c3)]((_0xa9d83a,_0x52317a)=>{var _0x322e20=_0x5ef8de;_0x465481[_0x52317a][_0x322e20(0x27a)]=_0xa9d83a;}),_0x4c066e[_0x5ef8de(0x1c3)]((_0x28e642,_0x325084)=>{var _0x493dcd=_0x5ef8de;_0x465481[_0x325084][_0x493dcd(0x1fa)]=Math[_0x493dcd(0x178)](_0x28e642);}),_0x469393[_0x5ef8de(0x1c3)]((_0x39705a,_0x236724)=>{_0x465481[_0x236724]['standard_unit']=_0x39705a;}),_0xfebc19['forEach']((_0x52ad29,_0x1eb8fd)=>{var _0x9400c2=_0x5ef8de;_0x465481[_0x1eb8fd][_0x9400c2(0x206)]=_0x52ad29;}),_0x322094['forEach']((_0x594604,_0x11e5ad)=>{_0x379623['forEach']((_0x3e2614,_0x51fd35)=>{var _0x49ff5b=a0_0x1177;if(_0x3e2614=='Receiving\x20Area'&&_0x11e5ad==_0x51fd35){console[_0x49ff5b(0x1bc)](_0x3e2614+'\x20<\x20wew\x20>\x20'+_0x11e5ad+_0x49ff5b(0x21c)+_0x51fd35+_0x49ff5b(0x21c)+_0x594604);var _0x17d9d9=_0x594604[_0x49ff5b(0x1ef)](0x3);_0x465481[_0x11e5ad][_0x49ff5b(0x1e4)]=_0x594604[0x0],_0x465481[_0x11e5ad][_0x49ff5b(0x174)]=_0x594604[0x1],_0x465481[_0x11e5ad][_0x49ff5b(0x22f)]=0x0,_0x465481[_0x11e5ad]['bin']=0x0,_0x465481[_0x11e5ad][_0x49ff5b(0x237)]=_0x49ff5b(0x1ec),_0x465481[_0x11e5ad]['floorlevel']=_0x17d9d9;}else{if(_0x3e2614=='Shelves'&&_0x11e5ad==_0x51fd35){var _0x17d9d9=_0x594604['slice'](0x3);_0x465481[_0x11e5ad][_0x49ff5b(0x1e4)]=_0x594604[0x0],_0x465481[_0x11e5ad][_0x49ff5b(0x174)]=_0x594604[0x1],_0x465481[_0x11e5ad][_0x49ff5b(0x22f)]=0x0,_0x465481[_0x11e5ad][_0x49ff5b(0x19c)]=0x0,_0x465481[_0x11e5ad][_0x49ff5b(0x237)]=_0x49ff5b(0x1ec),_0x465481[_0x11e5ad][_0x49ff5b(0x26d)]=_0x594604[0x5];}else{if(_0x11e5ad==_0x51fd35){if(_0x594604[0x0]=='A'&&_0x594604[0x1]=='L'&&_0x594604[0x2]=='L')console[_0x49ff5b(0x1bc)](_0x3e2614+_0x49ff5b(0x21c)+_0x11e5ad+_0x49ff5b(0x21c)+_0x51fd35+'\x20<>\x20'+_0x594604+_0x49ff5b(0x1a9)),_0x465481[_0x11e5ad]['storage']=_0x594604[0x0],_0x465481[_0x11e5ad][_0x49ff5b(0x174)]=_0x594604[0x1],_0x465481[_0x11e5ad]['bay']=0x0,_0x465481[_0x11e5ad][_0x49ff5b(0x19c)]=0x0,_0x465481[_0x11e5ad][_0x49ff5b(0x237)]=_0x49ff5b(0x1ec),_0x465481[_0x11e5ad][_0x49ff5b(0x26d)]=_0x594604[0x3];else{var _0x244008;if(_0x594604[0x4]=='L')_0x244008=_0x49ff5b(0x189);else _0x594604[0x4]=='F'&&(_0x244008='Floor');_0x465481[_0x11e5ad][_0x49ff5b(0x1e4)]=_0x594604[0x0],_0x465481[_0x11e5ad][_0x49ff5b(0x174)]=_0x594604[0x1],_0x465481[_0x11e5ad][_0x49ff5b(0x22f)]=_0x594604[0x2],_0x465481[_0x11e5ad][_0x49ff5b(0x19c)]=_0x594604[0x3],_0x465481[_0x11e5ad][_0x49ff5b(0x237)]=_0x244008,_0x465481[_0x11e5ad][_0x49ff5b(0x26d)]=_0x594604[0x5];}}}}});}),_0x539809[_0x5ef8de(0x1c3)]((_0x2b3b67,_0x310d66)=>{_0x465481[_0x310d66]['primary_code']=_0x2b3b67;}),_0xfc2d9e[_0x5ef8de(0x1c3)]((_0xc18ffb,_0x991204)=>{var _0x4d0b42=_0x5ef8de;_0x465481[_0x991204][_0x4d0b42(0x1a1)]=_0xc18ffb;}),_0x1fc42d['forEach']((_0x2a0270,_0x2afcaa)=>{_0x465481[_0x2afcaa]['maxStocks']=_0x2a0270;}),_0x4d8d66[_0x5ef8de(0x1c3)]((_0x497e75,_0x1503b0)=>{var _0x2c101b=_0x5ef8de;_0x465481[_0x1503b0][_0x2c101b(0x283)]=_0x497e75;}),_0x5a4036['forEach']((_0xce4409,_0x266df3)=>{var _0x4f086f=_0x5ef8de;_0x465481[_0x266df3][_0x4f086f(0x1fb)]=_0xce4409;}),_0x4c488a[_0x5ef8de(0x1c3)]((_0x31561f,_0x3ccbd3)=>{var _0x325bdb=_0x5ef8de;_0x465481[_0x3ccbd3][_0x325bdb(0x273)]=_0x31561f;}),_0x4aa3c8[_0x5ef8de(0x1c3)]((_0x24f890,_0x4042ec)=>{_0x465481[_0x4042ec]['alertQTY']=_0x24f890;}),_0x3de53a[_0x5ef8de(0x1c3)]((_0x337983,_0x3ce8c7)=>{var _0x4c5252=_0x5ef8de;_0x465481[_0x3ce8c7][_0x4c5252(0x25a)]=_0x337983;}),_0x4e197e[_0x5ef8de(0x1c3)]((_0x250bfc,_0x28518d)=>{var _0x4eb2cb=_0x5ef8de;_0x465481[_0x28518d][_0x4eb2cb(0x25b)]=_0x250bfc;}),_0x379623['forEach']((_0x4d33f2,_0x44cf8d)=>{var _0x522ec8=_0x5ef8de;_0x465481[_0x44cf8d][_0x522ec8(0x219)]=_0x4d33f2;}),_0x2b9903[_0x5ef8de(0x1c3)]((_0x14f0d0,_0x36f088)=>{var _0x4b1f1e=_0x5ef8de;_0x465481[_0x36f088][_0x4b1f1e(0x253)]=_0x14f0d0;}),_0x1c7547[_0x5ef8de(0x1c3)]((_0x52151e,_0x2824da)=>{_0x465481[_0x2824da]['invoice']=_0x52151e;});const _0x46c863=_0x379623[_0x5ef8de(0x226)](_0x52200f=>{return _0x52200f={'room_name':_0x52200f};}),_0x159183=_0x465481[_0x5ef8de(0x1f9)](_0x3ff1b4=>_0x3ff1b4[_0x5ef8de(0x1fa)]!=='0'&&_0x3ff1b4[_0x5ef8de(0x1fa)]!==''),_0x4b0a9d=new purchases({'invoice':_0x4f1789,'suppliers':_0x36b764['body']['suppliers'],'date':_0x37f0bb,'warehouse_name':_0xbef5d,'product':_0x159183,'note':_0x482821,'due_amount':_0x2512c2,'POnumber':_0x5229b8,'SCRN':_0xda8324,'JO_number':_0x4b233f,'roomList':_0x46c863}),_0x3932c6=await _0x4b0a9d[_0x5ef8de(0x276)](),_0x37265d=await purchases[_0x5ef8de(0x27d)]({'invoice':_0x4f1789}),_0x39b1b0=_0x37265d[_0x5ef8de(0x272)][_0x5ef8de(0x226)](async _0x1211bb=>{var _0x174da5=_0x5ef8de,_0x85f381=await warehouse[_0x174da5(0x27d)]({'name':_0xbef5d,'room':_0x1211bb['room_name']}),_0x1215ac=0x0;return _0x85f381['product_details'][_0x174da5(0x1c3)](_0x382d7c=>{var _0x1c57ce=_0x174da5;_0x382d7c[_0x1c57ce(0x242)]==_0x1211bb[_0x1c57ce(0x242)]&&_0x382d7c[_0x1c57ce(0x26d)]==_0x1211bb[_0x1c57ce(0x26d)]&&_0x382d7c['type']==_0x1211bb['type']&&_0x382d7c['bin']==_0x1211bb[_0x1c57ce(0x19c)]&&_0x382d7c[_0x1c57ce(0x22f)]==_0x1211bb[_0x1c57ce(0x22f)]&&_0x382d7c[_0x1c57ce(0x174)]==_0x1211bb[_0x1c57ce(0x174)]&&_0x382d7c[_0x1c57ce(0x1e4)]==_0x1211bb['storage']&&_0x382d7c[_0x1c57ce(0x1fb)]==_0x1211bb[_0x1c57ce(0x1fb)]&&_0x382d7c['batch_code']==_0x1211bb[_0x1c57ce(0x283)]&&_0x382d7c['production_date']==_0x1211bb['production_date']&&_0x382d7c['invoice']==_0x37265d['invoice']&&(_0x382d7c[_0x1c57ce(0x18d)]+=Math['abs'](_0x1211bb[_0x1c57ce(0x1fa)]),_0x1215ac++);}),_0x1215ac===0x0&&_0x85f381[_0x174da5(0x19e)][_0x174da5(0x175)]({'product_name':_0x1211bb[_0x174da5(0x242)],'product_stock':Math[_0x174da5(0x178)](_0x1211bb['quantity']),'primary_code':_0x1211bb['primary_code'],'secondary_code':_0x1211bb['secondary_code'],'product_code':_0x1211bb[_0x174da5(0x27a)],'storage':_0x1211bb['storage'],'rack':_0x1211bb['rack'],'bay':_0x1211bb['bay'],'bin':_0x1211bb['bin'],'type':_0x1211bb[_0x174da5(0x237)],'floorlevel':_0x1211bb[_0x174da5(0x26d)],'maxProducts':_0x1211bb['maxStocks'],'unit':_0x1211bb[_0x174da5(0x278)],'secondary_unit':_0x1211bb['secondary_unit'],'expiry_date':_0x1211bb[_0x174da5(0x1fb)],'maxPerUnit':_0x1211bb['maxperunit'],'batch_code':_0x1211bb[_0x174da5(0x283)],'alertQTY':_0x1211bb[_0x174da5(0x19b)],'production_date':_0x1211bb['production_date'],'product_cat':_0x1211bb[_0x174da5(0x25b)],'invoice':_0x1211bb[_0x174da5(0x243)],'actual_qty':Math[_0x174da5(0x178)](_0x1211bb[_0x174da5(0x267)]),'actual_uom':_0x1211bb[_0x174da5(0x21e)]}),_0x85f381;});Promise['all'](_0x39b1b0)[_0x5ef8de(0x22c)](async _0x5ae986=>{var _0x32b7d6=_0x5ef8de;try{for(const _0x532a96 of _0x5ae986){await _0x532a96['save']();}const _0x4c8cbc=await master_shop[_0x32b7d6(0x1fc)](),_0x7c4674=await email_settings[_0x32b7d6(0x27d)](),_0x2f41b7=await supervisor_settings['find']();var _0xcd6352=_0x37265d[_0x32b7d6(0x272)],_0x299af8='',_0x49a5c2;for(_0x49a5c2 in _0xcd6352){_0x299af8+=_0x32b7d6(0x271)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcd6352[_0x49a5c2][_0x32b7d6(0x242)]+_0x32b7d6(0x1d7)+_0x32b7d6(0x1d0)+_0xcd6352[_0x49a5c2]['product_code']+_0x32b7d6(0x1d7)+_0x32b7d6(0x1d0)+_0xcd6352[_0x49a5c2][_0x32b7d6(0x1fa)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcd6352[_0x49a5c2][_0x32b7d6(0x278)]+'</td>'+_0x32b7d6(0x1d0)+_0xcd6352[_0x49a5c2][_0x32b7d6(0x206)]+_0x32b7d6(0x1d7)+_0x32b7d6(0x1d0)+_0x37265d[_0x32b7d6(0x1cc)]+_0x32b7d6(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcd6352[_0x49a5c2][_0x32b7d6(0x219)]+_0x32b7d6(0x1d7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xcd6352[_0x49a5c2][_0x32b7d6(0x1e4)]+_0xcd6352[_0x49a5c2]['rack']+_0xcd6352[_0x49a5c2][_0x32b7d6(0x22f)]+_0xcd6352[_0x49a5c2][_0x32b7d6(0x19c)]+_0xcd6352[_0x49a5c2]['type'][0x0]+_0xcd6352[_0x49a5c2][_0x32b7d6(0x26d)]+_0x32b7d6(0x1d7),_0x32b7d6(0x27f);}let _0x550783=nodemailer[_0x32b7d6(0x247)]({'host':_0x7c4674[_0x32b7d6(0x209)],'port':Number(_0x7c4674[_0x32b7d6(0x1bf)]),'secure':![],'auth':{'user':_0x7c4674[_0x32b7d6(0x286)],'pass':_0x7c4674[_0x32b7d6(0x1be)]}}),_0x2c2bb7={'from':_0x7c4674['email'],'to':_0x2f41b7[0x0][_0x32b7d6(0x212)],'subject':_0x32b7d6(0x213),'attachments':[{'filename':'Logo.png','path':__dirname+_0x32b7d6(0x1d2)+'/upload/'+_0x4c8cbc[0x0][_0x32b7d6(0x1ba)],'cid':_0x32b7d6(0x236)}],'html':_0x32b7d6(0x24e)+_0x32b7d6(0x1aa)+_0x32b7d6(0x1b1)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x32b7d6(0x1a4)+_0x32b7d6(0x25e)+_0x32b7d6(0x204)+_0x32b7d6(0x1a4)+_0x32b7d6(0x1df)+_0x4c8cbc[0x0][_0x32b7d6(0x1e8)]+'\x20</h2>'+_0x32b7d6(0x204)+_0x32b7d6(0x204)+_0x32b7d6(0x274)+_0x32b7d6(0x1a4)+_0x32b7d6(0x223)+_0x32b7d6(0x1ae)+_0x37265d['invoice']+'\x20'+_0x32b7d6(0x19d)+_0x32b7d6(0x20b)+_0x37265d[_0x32b7d6(0x190)]+'\x20'+_0x32b7d6(0x1a3)+_0x32b7d6(0x186)+'</div>'+_0x32b7d6(0x210)+_0x32b7d6(0x1e0)+_0x32b7d6(0x271)+_0x32b7d6(0x1d6)+_0x32b7d6(0x1cf)+_0x32b7d6(0x173)+_0x32b7d6(0x265)+_0x32b7d6(0x244)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x32b7d6(0x24b)+_0x32b7d6(0x27f)+'</thead>'+_0x32b7d6(0x1db)+'\x20'+_0x299af8+'\x20'+'</tbody>'+'</table>'+_0x32b7d6(0x1a4)+_0x32b7d6(0x1f3)+_0x32b7d6(0x275)+_0x4c8cbc[0x0][_0x32b7d6(0x1e8)]+_0x32b7d6(0x186)+_0x32b7d6(0x204)+_0x32b7d6(0x204)+_0x32b7d6(0x216)};_0x550783[_0x32b7d6(0x203)](_0x2c2bb7,function(_0x457388,_0xdd9b99){var _0xca8e4a=_0x32b7d6;_0x457388?(console[_0xca8e4a(0x1bc)](_0x457388),console[_0xca8e4a(0x1bc)](_0xca8e4a(0x22d))):console[_0xca8e4a(0x1bc)](_0xca8e4a(0x1d1));}),_0x36b764[_0x32b7d6(0x1f1)](_0x32b7d6(0x231),_0x32b7d6(0x1c0)),_0x356b5d[_0x32b7d6(0x245)](_0x32b7d6(0x193));}catch(_0x2dabce){console['error'](_0x2dabce),_0x356b5d[_0x32b7d6(0x218)](0x1f4)[_0x32b7d6(0x1e1)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x5ef8de(0x27b)](_0x3bdfa3=>{var _0x16002e=_0x5ef8de;console[_0x16002e(0x184)](_0x3bdfa3),_0x356b5d[_0x16002e(0x218)](0x1f4)[_0x16002e(0x1e1)]({'error':_0x16002e(0x21d)});});}catch(_0x52ff5f){console[_0x5ef8de(0x1bc)](_0x52ff5f);}}),router[a0_0xe1dfd2(0x285)](a0_0xe1dfd2(0x259),auth,async(_0x42a757,_0x513dea)=>{var _0x131653=a0_0xe1dfd2;try{const {username:_0x196643,email:_0x418e3c,role:_0x55508a}=_0x42a757['user'],_0x903142=_0x42a757[_0x131653(0x187)],_0x4be346=await profile['findOne']({'email':_0x903142[_0x131653(0x286)]}),_0x45a7e7=await master_shop[_0x131653(0x1fc)](),_0x1398d7=_0x42a757[_0x131653(0x1ac)]['id'],_0x391d93=await purchases[_0x131653(0x1ff)](_0x1398d7),_0x55d2fb=await warehouse[_0x131653(0x256)]([{'$match':{'name':_0x391d93[_0x131653(0x1cc)],'room':_0x391d93['room']}},{'$unwind':_0x131653(0x21b)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x131653(0x23f)},'bay':{'$first':_0x131653(0x254)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x131653(0x23c)},'floorlevel':{'$first':_0x131653(0x202)},'primary_code':{'$first':_0x131653(0x20e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x131653(0x241)},'rack':{'$first':_0x131653(0x21a)},'expiry_date':{'$first':_0x131653(0x20c)}}}]),_0x152133=await customer[_0x131653(0x1fc)]({});let _0x4482da;if(_0x903142[_0x131653(0x26b)]==_0x131653(0x1f6)){const _0xae8814=await staff[_0x131653(0x27d)]({'email':_0x903142[_0x131653(0x286)]});_0x4482da=await warehouse['aggregate']([{'$match':{'status':_0x131653(0x1c6),'name':_0xae8814[_0x131653(0x251)]}},{'$group':{'_id':_0x131653(0x22e),'name':{'$first':_0x131653(0x22e)}}}]);}else _0x4482da=await warehouse[_0x131653(0x256)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x131653(0x22e)}}}]);const _0x38ff06=await product[_0x131653(0x1fc)]({}),_0x3e1df2=await suppliers[_0x131653(0x1fc)]({}),_0xcfa2cd=BayBinSelected(_0x391d93['warehouse_name'],_0x391d93[_0x131653(0x266)]);if(_0x45a7e7[0x0][_0x131653(0x277)]=='English\x20(US)'){var _0x2273d1=users[_0x131653(0x23b)];console[_0x131653(0x1bc)](_0x2273d1);}else{if(_0x45a7e7[0x0]['language']=='Hindi')var _0x2273d1=users['Hindi'];else{if(_0x45a7e7[0x0][_0x131653(0x277)]=='German')var _0x2273d1=users[_0x131653(0x24a)];else{if(_0x45a7e7[0x0]['language']==_0x131653(0x1c7))var _0x2273d1=users[_0x131653(0x1c7)];else{if(_0x45a7e7[0x0][_0x131653(0x277)]==_0x131653(0x1ca))var _0x2273d1=users[_0x131653(0x1ca)];else{if(_0x45a7e7[0x0]['language']==_0x131653(0x250))var _0x2273d1=users[_0x131653(0x248)];else{if(_0x45a7e7[0x0][_0x131653(0x277)]==_0x131653(0x23a))var _0x2273d1=users['Chinese'];else{if(_0x45a7e7[0x0]['language']==_0x131653(0x181))var _0x2273d1=users[_0x131653(0x249)];}}}}}}}_0x513dea['render'](_0x131653(0x185),{'success':_0x42a757[_0x131653(0x1f1)]('success'),'errors':_0x42a757[_0x131653(0x1f1)](_0x131653(0x214)),'role':_0x903142,'profile':_0x4be346,'customer':_0x152133,'warehouse':_0x4482da,'product':_0x55d2fb,'user':_0x391d93,'master_shop':_0x45a7e7,'unit':_0x38ff06,'language':_0x2273d1,'suppliers':_0x3e1df2,'dataSelected':_0xcfa2cd});}catch(_0xf6654a){console['log'](_0xf6654a);}}),router['post']('/preview/:id',auth,async(_0x5c9468,_0x4c3720)=>{var _0x274972=a0_0xe1dfd2;try{const _0x431bb7=_0x5c9468[_0x274972(0x1ac)]['id'],{invoice:_0x39c353,warehouse_name:_0x4448d1,Room_name:_0x219e61}=_0x5c9468[_0x274972(0x1ea)],_0x2e2499=await warehouse[_0x274972(0x27d)]({'name':_0x4448d1,'room':_0x219e61}),_0x2dccde=await purchases['findOne']({'invoice':_0x39c353});_0x2dccde[_0x274972(0x272)]['forEach'](_0x168285=>{var _0x5c563b=_0x274972,_0x4044a4=0x0;const _0x4f2dc4=_0x2e2499['product_details'][_0x5c563b(0x226)](_0x3c1abc=>{var _0x1f5d0a=_0x5c563b;_0x3c1abc[_0x1f5d0a(0x242)]==_0x168285['product_name']&&_0x3c1abc[_0x1f5d0a(0x26d)]==_0x168285['floorlevel']&&_0x3c1abc[_0x1f5d0a(0x237)]==_0x168285[_0x1f5d0a(0x237)]&&_0x3c1abc[_0x1f5d0a(0x19c)]==_0x168285[_0x1f5d0a(0x19c)]&&_0x3c1abc[_0x1f5d0a(0x22f)]==_0x168285[_0x1f5d0a(0x22f)]&&_0x3c1abc[_0x1f5d0a(0x174)]==_0x168285['rack']&&_0x3c1abc[_0x1f5d0a(0x1e4)]==_0x168285[_0x1f5d0a(0x1e4)]&&_0x3c1abc[_0x1f5d0a(0x1fb)]==_0x168285[_0x1f5d0a(0x1fb)]&&_0x3c1abc[_0x1f5d0a(0x283)]==_0x168285[_0x1f5d0a(0x283)]&&_0x3c1abc[_0x1f5d0a(0x25a)]==_0x168285[_0x1f5d0a(0x25a)]&&_0x3c1abc[_0x1f5d0a(0x1d4)]==_0x168285[_0x1f5d0a(0x1d4)]&&_0x3c1abc[_0x1f5d0a(0x253)]==_0x168285[_0x1f5d0a(0x253)]&&(_0x3c1abc[_0x1f5d0a(0x18d)]=parseInt(_0x3c1abc[_0x1f5d0a(0x18d)])+parseInt(_0x168285[_0x1f5d0a(0x1fa)]),_0x4044a4++);});_0x4044a4=='0'&&(_0x2e2499[_0x5c563b(0x19e)]=_0x2e2499[_0x5c563b(0x19e)]['concat']({'product_name':_0x168285[_0x5c563b(0x242)],'product_stock':_0x168285[_0x5c563b(0x1fa)],'primary_code':_0x168285[_0x5c563b(0x1c8)],'secondary_code':_0x168285[_0x5c563b(0x1a1)],'product_code':_0x168285[_0x5c563b(0x27a)],'storage':_0x168285[_0x5c563b(0x1e4)],'rack':_0x168285[_0x5c563b(0x174)],'bay':_0x168285[_0x5c563b(0x22f)],'bin':_0x168285[_0x5c563b(0x19c)],'type':_0x168285[_0x5c563b(0x237)],'floorlevel':_0x168285[_0x5c563b(0x26d)],'maxProducts':_0x168285[_0x5c563b(0x195)],'unit':_0x168285['standard_unit'],'secondary_unit':_0x168285['secondary_unit'],'expiry_date':_0x168285['expiry_date'],'maxPerUnit':_0x168285[_0x5c563b(0x273)],'batch_code':_0x168285[_0x5c563b(0x283)],'alertQTY':_0x168285[_0x5c563b(0x19b)],'production_date':_0x168285[_0x5c563b(0x25a)],'delivery_date':_0x168285['delivery_date'],'delivery_code':_0x168285[_0x5c563b(0x253)]}));}),await _0x2e2499[_0x274972(0x276)](),_0x2dccde[_0x274972(0x19f)]=_0x274972(0x282);const _0x167138=await _0x2dccde[_0x274972(0x276)]();_0x5c9468['flash'](_0x274972(0x231),_0x274972(0x1f4)),_0x4c3720[_0x274972(0x245)]('/all_purchases/view');}catch(_0x5731ea){console[_0x274972(0x1bc)](_0x5731ea);}}),router[a0_0xe1dfd2(0x285)](a0_0xe1dfd2(0x20a),auth,async(_0x26c5f5,_0x3ea23c)=>{var _0x517ca3=a0_0xe1dfd2;try{const {username:_0x4b8359,email:_0xdf2ac2,role:_0x1363c1}=_0x26c5f5['user'],_0x45ac91=_0x26c5f5['user'],_0x2b2c0a=await profile[_0x517ca3(0x27d)]({'email':_0x45ac91[_0x517ca3(0x286)]}),_0x40e35e=await master_shop[_0x517ca3(0x1fc)](),_0x41cfdf=_0x26c5f5[_0x517ca3(0x1ac)]['id'],_0x123c48=await purchases['findById'](_0x41cfdf),_0x1199cf=await suppliers[_0x517ca3(0x1fc)]({});let _0x443a93;if(_0x45ac91['role']==_0x517ca3(0x1f6)){const _0x413563=await staff['findOne']({'email':_0x45ac91[_0x517ca3(0x286)]});_0x443a93=await warehouse['find']({'status':_0x517ca3(0x1c6),'name':_0x413563['warehouse'],'warehouse_category':_0x517ca3(0x1b7)});}else _0x443a93=await warehouse[_0x517ca3(0x256)]([{'$match':{'status':_0x517ca3(0x1c6),'warehouse_category':_0x517ca3(0x1b7)}},{'$group':{'_id':_0x517ca3(0x22e),'name':{'$first':'$name'}}}]);const _0x4fe4a9=await product[_0x517ca3(0x1fc)]({}),_0x4420d3=BayBinSelected(_0x123c48[_0x517ca3(0x1cc)],_0x123c48[_0x517ca3(0x266)]);let _0x4fded8=new Date(_0x123c48[_0x517ca3(0x1fb)]),_0x3f53cd=('0'+_0x4fded8[_0x517ca3(0x1dc)]())[_0x517ca3(0x1ef)](-0x2),_0x169111=('0'+(_0x4fded8[_0x517ca3(0x1e9)]()+0x1))['slice'](-0x2),_0x5208ab=_0x4fded8[_0x517ca3(0x1a0)](),_0x1afaec=_0x5208ab+'-'+_0x169111+'-'+_0x3f53cd;if(_0x40e35e[0x0][_0x517ca3(0x277)]==_0x517ca3(0x16f)){var _0x2a2689=users[_0x517ca3(0x23b)];console[_0x517ca3(0x1bc)](_0x2a2689);}else{if(_0x40e35e[0x0][_0x517ca3(0x277)]==_0x517ca3(0x1a6))var _0x2a2689=users[_0x517ca3(0x1a6)];else{if(_0x40e35e[0x0][_0x517ca3(0x277)]=='German')var _0x2a2689=users['German'];else{if(_0x40e35e[0x0][_0x517ca3(0x277)]==_0x517ca3(0x1c7))var _0x2a2689=users[_0x517ca3(0x1c7)];else{if(_0x40e35e[0x0][_0x517ca3(0x277)]==_0x517ca3(0x1ca))var _0x2a2689=users[_0x517ca3(0x1ca)];else{if(_0x40e35e[0x0][_0x517ca3(0x277)]==_0x517ca3(0x250))var _0x2a2689=users['Portuguese'];else{if(_0x40e35e[0x0]['language']==_0x517ca3(0x23a))var _0x2a2689=users[_0x517ca3(0x23a)];else{if(_0x40e35e[0x0][_0x517ca3(0x277)]==_0x517ca3(0x181))var _0x2a2689=users[_0x517ca3(0x249)];}}}}}}}_0x3ea23c['render']('edit_purchases',{'success':_0x26c5f5[_0x517ca3(0x1f1)](_0x517ca3(0x231)),'errors':_0x26c5f5['flash'](_0x517ca3(0x214)),'role':_0x45ac91,'profile':_0x2b2c0a,'purchases':_0x123c48,'suppliers':_0x1199cf,'warehouse':_0x443a93,'product':_0x4fe4a9,'master_shop':_0x40e35e,'language':_0x2a2689,'ed_fullDate':_0x1afaec,'dataSelected':_0x4420d3});}catch(_0x197531){console[_0x517ca3(0x1bc)](_0x197531);}}),router['post']('/view/:id',auth,async(_0x1d0c88,_0x1ac3d1)=>{var _0x21aa99=a0_0xe1dfd2;try{const _0x5d17b2=_0x1d0c88[_0x21aa99(0x1ac)]['id'],_0x324132=await purchases['findOne']({'_id':_0x1d0c88[_0x21aa99(0x1ac)]['id']}),_0x359f1b=await warehouse[_0x21aa99(0x27d)]({'name':_0x324132[_0x21aa99(0x1cc)],'room':_0x324132['room']});_0x324132[_0x21aa99(0x272)]['forEach'](_0x570f58=>{var _0x218c6d=_0x21aa99;const _0x1fa86c=_0x359f1b['product_details'][_0x218c6d(0x226)](_0x25e433=>{var _0x1c3e58=_0x218c6d;_0x25e433[_0x1c3e58(0x242)]==_0x570f58[_0x1c3e58(0x242)]&&_0x25e433[_0x1c3e58(0x26d)]==_0x570f58[_0x1c3e58(0x26d)]&&_0x25e433[_0x1c3e58(0x237)]==_0x570f58[_0x1c3e58(0x237)]&&_0x25e433[_0x1c3e58(0x19c)]==_0x570f58[_0x1c3e58(0x19c)]&&_0x25e433[_0x1c3e58(0x22f)]==_0x570f58[_0x1c3e58(0x22f)]&&_0x25e433['rack']==_0x570f58[_0x1c3e58(0x174)]&&_0x25e433[_0x1c3e58(0x1e4)]==_0x570f58[_0x1c3e58(0x1e4)]&&(_0x25e433[_0x1c3e58(0x18d)]=parseInt(_0x25e433['product_stock'])-parseInt(_0x570f58[_0x1c3e58(0x1fa)]));});}),await _0x359f1b[_0x21aa99(0x276)]();const {invoice:_0x3b7418,suppliers:_0x19152d,date:_0x1577e2,warehouse_name:_0x8ee24d,prod_name:_0x2e44ae,prod_code:_0x55a6bf,prod_qty:_0x4d70b0,prod_unit:_0x4d1522,prod_secondunit:_0x3f7e42,prod_level:_0x1ddd51,prod_isle:_0x4a418f,prod_pallet:_0x17a329,note:_0x401893,expiry_date:_0x4e458d,batch_code:_0x14aece,paid_amount:_0x349cb6,due_amount:_0x2d2b66,Room_name:_0x185b76,primary_code:_0x38d299,secondary_code:_0x598cba,PO_number:_0x2c82ca,JO_number:_0x3df07d}=_0x1d0c88[_0x21aa99(0x1ea)];if(typeof _0x2e44ae=='string')var _0xbf3cb7=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x17d)]],_0x258929=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x198)]],_0x298a73=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x19a)]],_0x5206bb=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x1c4)]],_0x503d79=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x20d)]],_0x54c977=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x26f)]],_0x1eda88=[_0x1d0c88[_0x21aa99(0x1ea)]['prod_isle']],_0x437223=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x261)]],_0x5eb076=[_0x1d0c88['body'][_0x21aa99(0x1c8)]],_0x4b38d=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x1a1)]],_0x1aee11=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x240)]],_0x492c7a=[_0x1d0c88[_0x21aa99(0x1ea)]['batch_code']],_0x404070=[_0x1d0c88['body'][_0x21aa99(0x1fb)]],_0xc8c04d=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x1e4)]],_0x383f95=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x246)]],_0x3766fb=[_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x237)]];else var _0xbf3cb7=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x17d)]],_0x258929=[..._0x1d0c88['body'][_0x21aa99(0x198)]],_0x298a73=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x19a)]],_0x5206bb=[..._0x1d0c88[_0x21aa99(0x1ea)]['prod_unit']],_0x503d79=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x20d)]],_0x54c977=[..._0x1d0c88['body']['prod_level']],_0x1eda88=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x264)]],_0x437223=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x261)]],_0x5eb076=[..._0x1d0c88['body'][_0x21aa99(0x1c8)]],_0x4b38d=[..._0x1d0c88['body']['secondary_code']],_0x1aee11=[..._0x1d0c88[_0x21aa99(0x1ea)]['MaxStocks_data']],_0x492c7a=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x283)]],_0x404070=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x1fb)]],_0xc8c04d=[..._0x1d0c88['body'][_0x21aa99(0x1e4)]],_0x383f95=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x246)]],_0x3766fb=[..._0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x237)]];const _0x58eb30=_0xbf3cb7[_0x21aa99(0x226)](_0x3a95cc=>{return _0x3a95cc={'product_name':_0x3a95cc};});_0x258929[_0x21aa99(0x1c3)]((_0x1bdbf0,_0x5eaab5)=>{var _0xf0e21b=_0x21aa99;_0x58eb30[_0x5eaab5][_0xf0e21b(0x27a)]=_0x1bdbf0;}),_0x298a73[_0x21aa99(0x1c3)]((_0x520d52,_0x23e373)=>{var _0x79dd11=_0x21aa99;_0x58eb30[_0x23e373][_0x79dd11(0x1fa)]=_0x520d52;}),_0x5206bb['forEach']((_0xaae327,_0xe57f07)=>{var _0x1230a7=_0x21aa99;_0x58eb30[_0xe57f07][_0x1230a7(0x278)]=_0xaae327;}),_0x503d79[_0x21aa99(0x1c3)]((_0x211133,_0x4a2d7d)=>{var _0x4c745e=_0x21aa99;_0x58eb30[_0x4a2d7d][_0x4c745e(0x206)]=_0x211133;}),_0x54c977['forEach']((_0xa63182,_0x2952bc)=>{var _0x17d22f=_0x21aa99;_0x58eb30[_0x2952bc][_0x17d22f(0x22f)]=_0xa63182;}),_0x1eda88[_0x21aa99(0x1c3)]((_0x1bbdbe,_0x2c2332)=>{var _0x57db29=_0x21aa99;_0x58eb30[_0x2c2332][_0x57db29(0x19c)]=_0x1bbdbe;}),_0x437223[_0x21aa99(0x1c3)]((_0x1eaf15,_0x184614)=>{_0x58eb30[_0x184614]['floorlevel']=_0x1eaf15;}),_0x5eb076[_0x21aa99(0x1c3)]((_0x1f7073,_0x305aee)=>{_0x58eb30[_0x305aee]['primary_code']=_0x1f7073;}),_0x4b38d[_0x21aa99(0x1c3)]((_0x1694e0,_0xad1616)=>{var _0x4c23a1=_0x21aa99;_0x58eb30[_0xad1616][_0x4c23a1(0x1a1)]=_0x1694e0;}),_0x1aee11[_0x21aa99(0x1c3)]((_0x54c994,_0x2136d6)=>{var _0x4809f3=_0x21aa99;_0x58eb30[_0x2136d6][_0x4809f3(0x195)]=_0x54c994;}),_0x492c7a['forEach']((_0x456033,_0x104dfd)=>{var _0x460267=_0x21aa99;_0x58eb30[_0x104dfd][_0x460267(0x283)]=_0x456033;}),_0x404070[_0x21aa99(0x1c3)]((_0x10d3e5,_0x44c49d)=>{var _0xb4f745=_0x21aa99;_0x58eb30[_0x44c49d][_0xb4f745(0x1fb)]=_0x10d3e5;}),_0x3766fb[_0x21aa99(0x1c3)]((_0x26b839,_0x1bfdfc)=>{_0x58eb30[_0x1bfdfc]['type']=_0x26b839;}),_0xc8c04d[_0x21aa99(0x1c3)]((_0x50bbe6,_0x317b2a)=>{var _0x5c47cb=_0x21aa99;_0x58eb30[_0x317b2a][_0x5c47cb(0x1e4)]=_0x50bbe6;}),_0x383f95[_0x21aa99(0x1c3)]((_0x1d1c4d,_0x54f1bb)=>{var _0x294bc4=_0x21aa99;_0x58eb30[_0x54f1bb][_0x294bc4(0x174)]=_0x1d1c4d;});const _0x53e3ae=_0x58eb30['filter'](_0x2dc37d=>_0x2dc37d[_0x21aa99(0x1fa)]!=='0'&&_0x2dc37d[_0x21aa99(0x1fa)]!=='');_0x324132[_0x21aa99(0x243)]=_0x3b7418,_0x324132[_0x21aa99(0x225)]=_0x19152d,_0x324132[_0x21aa99(0x190)]=_0x1577e2,_0x324132['warehouse_name']=_0x8ee24d,_0x324132[_0x21aa99(0x272)]=_0x53e3ae,_0x324132['note']=_0x401893,_0x324132['paid_amount']=_0x349cb6,_0x324132[_0x21aa99(0x221)]=_0x2d2b66,_0x324132['room']=_0x185b76,_0x324132[_0x21aa99(0x238)]=_0x2c82ca,_0x324132[_0x21aa99(0x16d)]=_0x3df07d;const _0x23ff22=await _0x324132[_0x21aa99(0x276)](),_0x2b5e49=await warehouse['findOne']({'name':_0x1d0c88[_0x21aa99(0x1ea)]['warehouse_name'],'room':_0x1d0c88['body'][_0x21aa99(0x207)]});_0x324132[_0x21aa99(0x272)][_0x21aa99(0x1c3)](_0x5ee249=>{var _0x315518=_0x21aa99,_0x2a5ce1=0x0;const _0xbb78ab=_0x2b5e49['product_details']['map'](_0x5ce60d=>{var _0x36eea5=a0_0x1177;_0x5ce60d[_0x36eea5(0x242)]==_0x5ee249[_0x36eea5(0x242)]&&_0x5ce60d['floorlevel']==_0x5ee249[_0x36eea5(0x26d)]&&_0x5ce60d['type']==_0x5ee249['type']&&_0x5ce60d[_0x36eea5(0x19c)]==_0x5ee249[_0x36eea5(0x19c)]&&_0x5ce60d[_0x36eea5(0x22f)]==_0x5ee249['bay']&&_0x5ce60d[_0x36eea5(0x174)]==_0x5ee249['rack']&&_0x5ce60d[_0x36eea5(0x1e4)]==_0x5ee249[_0x36eea5(0x1e4)]&&(_0x5ce60d[_0x36eea5(0x18d)]=parseInt(_0x5ce60d[_0x36eea5(0x18d)])+parseInt(_0x5ee249['quantity']),_0x2a5ce1++);});_0x2a5ce1=='0'&&(_0x2b5e49['product_details']=_0x2b5e49[_0x315518(0x19e)][_0x315518(0x1cb)]({'product_name':_0x5ee249[_0x315518(0x242)],'product_stock':_0x5ee249[_0x315518(0x1fa)],'primary_code':_0x5ee249[_0x315518(0x1c8)],'secondary_code':_0x5ee249[_0x315518(0x1a1)],'product_code':_0x5ee249[_0x315518(0x27a)],'storage':_0x5ee249['storage'],'rack':_0x5ee249[_0x315518(0x174)],'bay':_0x5ee249[_0x315518(0x22f)],'bin':_0x5ee249['bin'],'type':_0x5ee249[_0x315518(0x237)],'floorlevel':_0x5ee249[_0x315518(0x26d)],'maxProducts':_0x5ee249[_0x315518(0x195)],'unit':_0x5ee249[_0x315518(0x278)],'secondary_unit':_0x5ee249[_0x315518(0x206)],'expiry_date':_0x5ee249[_0x315518(0x1fb)]}));}),await _0x2b5e49[_0x21aa99(0x276)]();const _0x28f9cf=await s_payment_data[_0x21aa99(0x27d)]({'invoice':_0x1d0c88[_0x21aa99(0x1ea)]['invoice']});if(_0x28f9cf===null){}else console[_0x21aa99(0x1bc)](_0x21aa99(0x225),_0x28f9cf,_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x243)]),_0x28f9cf[_0x21aa99(0x225)]=_0x1d0c88[_0x21aa99(0x1ea)][_0x21aa99(0x225)],await _0x28f9cf[_0x21aa99(0x276)]();_0x1d0c88['flash'](_0x21aa99(0x231),_0x21aa99(0x1b3)),_0x1ac3d1[_0x21aa99(0x245)](_0x21aa99(0x235));}catch(_0xd91fec){console[_0x21aa99(0x1bc)](_0xd91fec);}}),router['post'](a0_0xe1dfd2(0x17c),auth,async(_0x34c7e5,_0x141331)=>{var _0x43f848=a0_0xe1dfd2;try{const _0xddb743=_0x34c7e5[_0x43f848(0x1ac)]['id'],{invoice:_0x5c6a34,suppliers:_0x5d2494,payable:_0x273111,due_amount:_0x363112}=_0x34c7e5[_0x43f848(0x1ea)],_0x300ce1=await purchases[_0x43f848(0x1ff)](_0xddb743);var _0x4398ce=_0x273111-_0x363112;_0x300ce1[_0x43f848(0x24d)]=parseFloat(_0x300ce1['paid_amount'])+parseFloat(_0x363112),_0x300ce1['due_amount']=_0x4398ce;const _0xa50b3e=await _0x300ce1['save']();console[_0x43f848(0x1bc)](_0xa50b3e);const _0x474e93=await s_payment_data[_0x43f848(0x27d)]({'invoice':_0x5c6a34});_0x474e93['amount']=_0x4398ce,await _0x474e93['save']();let _0x57ddd5=new Date(),_0x1e4c98=('0'+_0x57ddd5[_0x43f848(0x1dc)]())[_0x43f848(0x1ef)](-0x2),_0xdcbe34=('0'+(_0x57ddd5[_0x43f848(0x1e9)]()+0x1))[_0x43f848(0x1ef)](-0x2),_0x27d92e=_0x57ddd5['getFullYear'](),_0x52fb87=_0x27d92e+'-'+_0xdcbe34+'-'+_0x1e4c98;const _0x2263dd=new suppliers_payment({'invoice':_0x5c6a34,'date':_0x27d92e+'-'+_0xdcbe34+'-'+_0x1e4c98,'suppliers':_0x5d2494,'reason':_0x43f848(0x1a7),'amount':_0x363112}),_0xba8d2a=await _0x2263dd[_0x43f848(0x276)]();_0x34c7e5['flash'](_0x43f848(0x231),_0x43f848(0x1ce)),_0x141331[_0x43f848(0x245)](_0x43f848(0x235));}catch(_0x23224c){console['log'](_0x23224c);}}),router[a0_0xe1dfd2(0x285)]('/invoice/:id',auth,async(_0x222205,_0x8221b)=>{var _0x3d5371=a0_0xe1dfd2;try{const {username:_0x129df2,email:_0x48bf45,role:_0x335ede}=_0x222205[_0x3d5371(0x187)],_0x5476f0=_0x222205[_0x3d5371(0x187)],_0x40c4e9=await profile[_0x3d5371(0x27d)]({'email':_0x5476f0['email']}),_0x2c2336=await master_shop[_0x3d5371(0x1fc)]();console[_0x3d5371(0x1bc)](_0x3d5371(0x239),_0x2c2336);const _0xfb551f=_0x222205[_0x3d5371(0x1ac)]['id'],_0x11b2ab=await purchases['findById'](_0xfb551f);console[_0x3d5371(0x1bc)](_0x11b2ab);const _0x2fb7ca=await suppliers[_0x3d5371(0x27d)]({'name':_0x11b2ab['suppliers']});console[_0x3d5371(0x1bc)](_0x2fb7ca);if(_0x2c2336[0x0][_0x3d5371(0x277)]==_0x3d5371(0x16f)){var _0x45e1bd=users[_0x3d5371(0x23b)];console[_0x3d5371(0x1bc)](_0x45e1bd);}else{if(_0x2c2336[0x0][_0x3d5371(0x277)]==_0x3d5371(0x1a6))var _0x45e1bd=users[_0x3d5371(0x1a6)];else{if(_0x2c2336[0x0][_0x3d5371(0x277)]==_0x3d5371(0x24a))var _0x45e1bd=users[_0x3d5371(0x24a)];else{if(_0x2c2336[0x0][_0x3d5371(0x277)]==_0x3d5371(0x1c7))var _0x45e1bd=users['Spanish'];else{if(_0x2c2336[0x0][_0x3d5371(0x277)]=='French')var _0x45e1bd=users[_0x3d5371(0x1ca)];else{if(_0x2c2336[0x0]['language']==_0x3d5371(0x250))var _0x45e1bd=users[_0x3d5371(0x248)];else{if(_0x2c2336[0x0][_0x3d5371(0x277)]==_0x3d5371(0x23a))var _0x45e1bd=users[_0x3d5371(0x23a)];else{if(_0x2c2336[0x0][_0x3d5371(0x277)]==_0x3d5371(0x181))var _0x45e1bd=users[_0x3d5371(0x249)];}}}}}}}_0x8221b[_0x3d5371(0x16b)](_0x3d5371(0x27e),{'success':_0x222205[_0x3d5371(0x1f1)](_0x3d5371(0x231)),'errors':_0x222205[_0x3d5371(0x1f1)](_0x3d5371(0x214)),'role':_0x5476f0,'profile':_0x40c4e9,'master_shop':_0x2c2336,'supplier':_0x2fb7ca,'purchase':_0x11b2ab,'language':_0x45e1bd});}catch(_0x2fe777){console['log'](_0x2fe777);}}),router[a0_0xe1dfd2(0x285)](a0_0xe1dfd2(0x18a),auth,async(_0x33f2cf,_0x337cf9)=>{var _0x39fe9a=a0_0xe1dfd2;try{const {username:_0xbdd327,email:_0x2a9e13,role:_0x2b856a}=_0x33f2cf[_0x39fe9a(0x187)],_0x48b29b=_0x33f2cf[_0x39fe9a(0x187)],_0x4ffed9=await profile[_0x39fe9a(0x27d)]({'email':_0x48b29b[_0x39fe9a(0x286)]}),_0x4dd9bb=await master_shop[_0x39fe9a(0x1fc)]();console['log'](_0x39fe9a(0x239),_0x4dd9bb);const _0x18555a=_0x33f2cf[_0x39fe9a(0x1ac)]['id'];console[_0x39fe9a(0x1bc)](_0x18555a);const _0x2c0fd7=await purchases['findById'](_0x18555a);console[_0x39fe9a(0x1bc)]('user_id',_0x2c0fd7);const _0x12f5a8=await product[_0x39fe9a(0x1fc)]({}),_0x406ef3=await warehouse[_0x39fe9a(0x256)]([{'$match':{'name':_0x2c0fd7[_0x39fe9a(0x1cc)],'room':_0x2c0fd7['room'],'warehouse_category':_0x39fe9a(0x1b7)}},{'$unwind':_0x39fe9a(0x21b)},{'$group':{'_id':_0x39fe9a(0x177),'name':{'$first':_0x39fe9a(0x18b)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x39fe9a(0x254)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x39fe9a(0x23c)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x39fe9a(0x20e)},'secondary_code':{'$first':_0x39fe9a(0x17b)},'product_code':{'$first':_0x39fe9a(0x22b)},'storage':{'$first':_0x39fe9a(0x241)},'rack':{'$first':_0x39fe9a(0x21a)}}}]);warehouse_data=await warehouse[_0x39fe9a(0x256)]([{'$match':{'status':_0x39fe9a(0x1c6),'name':'Return\x20Goods','warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':0x1}}]),console[_0x39fe9a(0x1bc)](_0x39fe9a(0x1d8),_0x406ef3);if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]=='English\x20(US)'){var _0x2c7386=users[_0x39fe9a(0x23b)];console[_0x39fe9a(0x1bc)](_0x2c7386);}else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]==_0x39fe9a(0x1a6))var _0x2c7386=users[_0x39fe9a(0x1a6)];else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]==_0x39fe9a(0x24a))var _0x2c7386=users[_0x39fe9a(0x24a)];else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]==_0x39fe9a(0x1c7))var _0x2c7386=users['Spanish'];else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]==_0x39fe9a(0x1ca))var _0x2c7386=users[_0x39fe9a(0x1ca)];else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]==_0x39fe9a(0x250))var _0x2c7386=users['Portuguese'];else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]==_0x39fe9a(0x23a))var _0x2c7386=users[_0x39fe9a(0x23a)];else{if(_0x4dd9bb[0x0][_0x39fe9a(0x277)]=='Arabic\x20(ae)')var _0x2c7386=users[_0x39fe9a(0x249)];}}}}}}}_0x337cf9['render'](_0x39fe9a(0x217),{'success':_0x33f2cf[_0x39fe9a(0x1f1)]('success'),'errors':_0x33f2cf[_0x39fe9a(0x1f1)]('errors'),'role':_0x48b29b,'profile':_0x4ffed9,'user':_0x2c0fd7,'stock':_0x406ef3,'master_shop':_0x4dd9bb,'product':_0x12f5a8,'language':_0x2c7386,'warehouse':warehouse_data});}catch(_0x313af4){console[_0x39fe9a(0x1bc)](_0x313af4);}}),router['post'](a0_0xe1dfd2(0x18a),auth,async(_0x18193e,_0x6dc324)=>{var _0x3364e0=a0_0xe1dfd2;try{const {invoice:_0x53d55b,date:_0x334e17,warehouse_name:_0xf3837c,Room_name:_0x3ead98,product_name:_0x33c525,purchase_quantity:_0x726e6c,stocks:_0x3c0247,return_qty:_0xfe56c2,note:_0x31a400,level:_0x5c30e0,isle:_0x370c4c,pallet:_0x2990,to_warehouse_name:_0x55b9e5,to_Room_name:_0xa69d7e}=_0x18193e['body'],_0x1f3fcc=await purchases[_0x3364e0(0x27d)]({'_id':_0x18193e[_0x3364e0(0x1ac)]['id']}),_0x2102e9=await warehouse['findOne']({'name':_0xf3837c,'room':_0x3ead98});if(typeof _0x33c525==_0x3364e0(0x280))var _0x142e02=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x242)]],_0x1867d5=[_0x18193e[_0x3364e0(0x1ea)]['purchase_quantity']],_0x10a5b1=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x220)]],_0x349819=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x1a5)]],_0x51c6ac=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x234)]],_0x47a222=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x1ad)]],_0x36ef92=[_0x18193e[_0x3364e0(0x1ea)]['pallet']],_0x24eeb9=[_0x18193e['body']['types']],_0x4ea86d=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x17f)]],_0x25cd8c=[_0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x170)]],_0x25976b=[_0x18193e['body'][_0x3364e0(0x1f0)]];else var _0x142e02=[..._0x18193e[_0x3364e0(0x1ea)]['product_name']],_0x1867d5=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x23d)]],_0x10a5b1=[..._0x18193e[_0x3364e0(0x1ea)]['stocks']],_0x349819=[..._0x18193e[_0x3364e0(0x1ea)]['return_qty']],_0x51c6ac=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x234)]],_0x47a222=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x1ad)]],_0x36ef92=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x233)]],_0x24eeb9=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x16c)]],_0x4ea86d=[..._0x18193e[_0x3364e0(0x1ea)]['product_code_hide']],_0x25cd8c=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x170)]],_0x25976b=[..._0x18193e[_0x3364e0(0x1ea)][_0x3364e0(0x1f0)]];const _0x3d2407=_0x142e02[_0x3364e0(0x226)](_0x66d433=>{return _0x66d433={'product_name':_0x66d433};});_0x1867d5[_0x3364e0(0x1c3)]((_0x3464ee,_0x2c29d7)=>{_0x3d2407[_0x2c29d7]['purchase_quantity']=_0x3464ee;}),_0x10a5b1[_0x3364e0(0x1c3)]((_0x11eb5f,_0x549a22)=>{_0x3d2407[_0x549a22]['stock_quantity']=_0x11eb5f;}),_0x349819[_0x3364e0(0x1c3)]((_0x1388e6,_0x26c638)=>{var _0x3de0f9=_0x3364e0;_0x3d2407[_0x26c638][_0x3de0f9(0x1a5)]=_0x1388e6;}),_0x51c6ac[_0x3364e0(0x1c3)]((_0xdffe04,_0x5a4a9a)=>{var _0x36cbbb=_0x3364e0;_0x3d2407[_0x5a4a9a][_0x36cbbb(0x22f)]=_0xdffe04;}),_0x47a222[_0x3364e0(0x1c3)]((_0x245316,_0x576985)=>{var _0xc31db=_0x3364e0;_0x3d2407[_0x576985][_0xc31db(0x19c)]=_0x245316;}),_0x36ef92['forEach']((_0x5431fb,_0x2a12d1)=>{var _0x4ec0d1=_0x3364e0;_0x3d2407[_0x2a12d1][_0x4ec0d1(0x26d)]=_0x5431fb;}),_0x24eeb9['forEach']((_0x414cdc,_0x4962fc)=>{_0x3d2407[_0x4962fc]['type']=_0x414cdc;}),_0x4ea86d[_0x3364e0(0x1c3)]((_0x2e66a2,_0x520e26)=>{var _0x493802=_0x3364e0;_0x3d2407[_0x520e26][_0x493802(0x27a)]=_0x2e66a2;}),_0x25cd8c[_0x3364e0(0x1c3)]((_0x463c56,_0x482ffe)=>{_0x3d2407[_0x482ffe]['primary_code']=_0x463c56;}),_0x25976b[_0x3364e0(0x1c3)]((_0x418a6b,_0xdcec39)=>{var _0x569eba=_0x3364e0;_0x3d2407[_0xdcec39][_0x569eba(0x1a1)]=_0x418a6b;}),_0x1f3fcc['product'][_0x3364e0(0x1c3)](_0x1804a3=>{const _0x1075b3=_0x2102e9['product_details']['map'](_0x5274e0=>{var _0x2d1239=a0_0x1177;_0x5274e0[_0x2d1239(0x242)]==_0x1804a3[_0x2d1239(0x242)]&&_0x5274e0[_0x2d1239(0x26d)]==_0x1804a3[_0x2d1239(0x26d)]&&_0x5274e0['type']==_0x1804a3[_0x2d1239(0x237)]&&_0x5274e0[_0x2d1239(0x19c)]==_0x1804a3[_0x2d1239(0x19c)]&&_0x5274e0[_0x2d1239(0x22f)]==_0x1804a3[_0x2d1239(0x22f)]&&_0x5274e0['rack']==_0x1804a3[_0x2d1239(0x174)]&&_0x5274e0[_0x2d1239(0x1e4)]==_0x1804a3[_0x2d1239(0x1e4)]&&(console[_0x2d1239(0x1bc)](parseInt(_0x5274e0[_0x2d1239(0x18d)])+_0x2d1239(0x21c)+parseInt(_0x1804a3['quantity'])),_0x5274e0[_0x2d1239(0x18d)]=parseInt(_0x5274e0[_0x2d1239(0x18d)])+parseInt(_0x1804a3[_0x2d1239(0x1fa)]));});}),await _0x2102e9[_0x3364e0(0x276)]();const _0x3f8738=_0x3d2407['filter'](_0x4c632b=>_0x4c632b[_0x3364e0(0x1a5)]!=='0'&&_0x4c632b[_0x3364e0(0x1a5)]!=='');var _0x2d1c71=0x0;_0x3f8738[_0x3364e0(0x1c3)](_0x5d3d01=>{var _0xf5a554=_0x3364e0;console[_0xf5a554(0x1bc)](_0xf5a554(0x288),_0x5d3d01),(parseInt(_0x5d3d01[_0xf5a554(0x23d)])<parseInt(_0x5d3d01[_0xf5a554(0x1a5)])||parseInt(_0x5d3d01['stock_quantity'])<parseInt(_0x5d3d01['return_qty']))&&_0x2d1c71++;});if(_0x2d1c71!=0x0)return _0x18193e[_0x3364e0(0x1f1)](_0x3364e0(0x214),_0x3364e0(0x1b5)),_0x6dc324[_0x3364e0(0x245)](_0x3364e0(0x270));const _0x1605c1=new purchases_return({'invoice':_0x53d55b,'suppliers':_0x18193e['body']['suppliers'],'date':_0x334e17,'warehouse_name':_0xf3837c,'return_product':_0x3f8738,'note':_0x31a400,'room':_0x3ead98,'to_warehouse_name':_0x55b9e5,'to_room':_0xa69d7e}),_0x352717=await _0x1605c1[_0x3364e0(0x276)]();console[_0x3364e0(0x1bc)](_0x1605c1);const _0x44fe66=await purchases_return[_0x3364e0(0x27d)]({'invoice':_0x53d55b}),_0x20d4fe=await warehouse[_0x3364e0(0x27d)]({'name':_0x55b9e5,'room':_0xa69d7e});_0x44fe66['return_product']['forEach'](_0x2cf738=>{var _0x3fdef9=_0x3364e0,_0x82890c=0x0;const _0x21f80e=_0x20d4fe['product_details'][_0x3fdef9(0x226)](_0x4e32dd=>{var _0x11cba5=_0x3fdef9;_0x4e32dd['product_name']==_0x2cf738[_0x11cba5(0x242)]&&_0x4e32dd['floorlevel']==_0x2cf738[_0x11cba5(0x26d)]&&_0x4e32dd[_0x11cba5(0x237)]==_0x2cf738['type']&&_0x4e32dd[_0x11cba5(0x19c)]==_0x2cf738['bin']&&_0x4e32dd[_0x11cba5(0x22f)]==_0x2cf738[_0x11cba5(0x22f)]&&(_0x4e32dd[_0x11cba5(0x18d)]=parseInt(_0x4e32dd[_0x11cba5(0x18d)])-parseInt(_0x2cf738[_0x11cba5(0x1a5)]),_0x82890c++);});_0x82890c=='0'&&(_0x20d4fe['product_details']=_0x20d4fe[_0x3fdef9(0x19e)]['concat']({'product_name':_0x2cf738[_0x3fdef9(0x242)],'product_stock':_0x2cf738[_0x3fdef9(0x1a5)],'primary_code':_0x2cf738['primary_code'],'secondary_code':_0x2cf738[_0x3fdef9(0x1a1)],'product_code':_0x2cf738['product_code'],'storage':_0x2cf738['storage'],'rack':_0x2cf738[_0x3fdef9(0x174)],'bay':_0x2cf738['bay'],'bin':_0x2cf738[_0x3fdef9(0x19c)],'type':_0x2cf738[_0x3fdef9(0x237)],'floorlevel':_0x2cf738[_0x3fdef9(0x26d)],'maxProducts':_0x2cf738['maxStocks'],'unit':_0x2cf738[_0x3fdef9(0x278)],'secondary_unit':_0x2cf738[_0x3fdef9(0x206)],'expiry_date':_0x2cf738[_0x3fdef9(0x1fb)]}));}),await _0x20d4fe['save']();const _0x2019e3=await purchases['findOne']({'invoice':_0x53d55b});_0x2019e3[_0x3364e0(0x27c)]=_0x3364e0(0x282);const _0x38cfd3=await _0x2019e3['save'](),_0x584912=new s_payment_data({'invoice':_0x53d55b,'suppliers':_0x18193e[_0x3364e0(0x1ea)]['suppliers'],'reason':_0x3364e0(0x205)});await _0x584912[_0x3364e0(0x276)]();const _0x1134a4=await master_shop[_0x3364e0(0x1fc)]();console[_0x3364e0(0x1bc)]('add\x20post',_0x1134a4[0x0][_0x3364e0(0x1ba)]);const _0x90039b=await email_settings[_0x3364e0(0x27d)](),_0x552622=await suppliers[_0x3364e0(0x27d)]({'name':_0x18193e[_0x3364e0(0x1ea)]['suppliers']});console[_0x3364e0(0x1bc)](_0x3364e0(0x1e5),_0x552622);_0x1134a4[0x0]['currency_placement']==0x1?(right_currency=_0x1134a4[0x0][_0x3364e0(0x26e)],left_currency=''):(right_currency='',left_currency=_0x1134a4[0x0]['currency']);var _0x486d8b=_0x142e02,_0x40f9c6=_0x349819,_0x22ea4e='',_0x548a1a;for(_0x548a1a in _0x486d8b){_0x22ea4e+=_0x3364e0(0x271)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x486d8b[_0x548a1a]+_0x3364e0(0x1d7)+_0x3364e0(0x1d0)+_0x40f9c6[_0x548a1a]+_0x3364e0(0x1d7)+'</tr>';}console[_0x3364e0(0x1bc)](_0x3364e0(0x1d9),_0x22ea4e);let _0x3ea2b1=nodemailer['createTransport']({'service':_0x3364e0(0x18e),'auth':{'user':_0x90039b[_0x3364e0(0x286)],'pass':_0x90039b[_0x3364e0(0x1be)]}}),_0x11e665={'from':_0x90039b[_0x3364e0(0x286)],'to':_0x552622['email'],'subject':_0x3364e0(0x1b0),'attachments':[{'filename':_0x3364e0(0x228),'path':__dirname+_0x3364e0(0x1d2)+_0x3364e0(0x229)+_0x1134a4[0x0][_0x3364e0(0x1ba)],'cid':'logo'}],'html':_0x3364e0(0x24e)+_0x3364e0(0x1aa)+_0x3364e0(0x1b1)+_0x3364e0(0x1a4)+_0x3364e0(0x227)+_0x3364e0(0x1a4)+_0x3364e0(0x25e)+_0x3364e0(0x204)+_0x3364e0(0x1a4)+'<h2>\x20'+_0x1134a4[0x0][_0x3364e0(0x1e8)]+_0x3364e0(0x1c2)+_0x3364e0(0x204)+'</div>'+_0x3364e0(0x274)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x3364e0(0x1ae)+_0x53d55b+'\x20'+_0x3364e0(0x19d)+_0x3364e0(0x20b)+_0x334e17+'\x20'+'</span>'+_0x3364e0(0x186)+_0x3364e0(0x204)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3364e0(0x1e0)+'<tr>'+_0x3364e0(0x1d6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x3364e0(0x171)+_0x3364e0(0x1b6)+'</tr>'+_0x3364e0(0x192)+_0x3364e0(0x1db)+'\x20'+_0x22ea4e+'\x20'+'</tbody>'+_0x3364e0(0x1f8)+_0x3364e0(0x1a4)+_0x3364e0(0x1f3)+_0x3364e0(0x275)+_0x1134a4[0x0][_0x3364e0(0x1e8)]+'</h5>'+_0x3364e0(0x204)+_0x3364e0(0x204)+'</body></html>'};_0x3ea2b1[_0x3364e0(0x203)](_0x11e665,function(_0xc3ff98,_0x2da88e){var _0x56b3ae=_0x3364e0;_0xc3ff98?(console[_0x56b3ae(0x1bc)](_0xc3ff98),console[_0x56b3ae(0x1bc)]('Error\x20Occurs')):console[_0x56b3ae(0x1bc)](_0x56b3ae(0x1d1));}),_0x18193e['flash'](_0x3364e0(0x231),'purchases\x20item\x20return\x20successfull'),_0x6dc324[_0x3364e0(0x245)]('/all_purchases/view');}catch(_0x22905e){console[_0x3364e0(0x1bc)](_0x22905e),_0x6dc324[_0x3364e0(0x218)](0xc8)[_0x3364e0(0x1e1)]({'message':_0x22905e[_0x3364e0(0x26c)]});}}),router[a0_0xe1dfd2(0x285)]('/barcode/:id',auth,async(_0x563d13,_0x5d422a)=>{var _0x7d5115=a0_0xe1dfd2;try{const {username:_0x4a8826,email:_0x47743b,role:_0x4a962a}=_0x563d13[_0x7d5115(0x187)],_0x3bc46a=_0x563d13[_0x7d5115(0x187)],_0x2f2447=await profile[_0x7d5115(0x27d)]({'email':_0x3bc46a[_0x7d5115(0x286)]}),_0x489f4a=await master_shop[_0x7d5115(0x1fc)](),_0x76b773=_0x563d13[_0x7d5115(0x1ac)]['id'],_0x5d8ff4=await purchases[_0x7d5115(0x1ff)](_0x76b773);if(_0x489f4a[0x0][_0x7d5115(0x277)]=='English\x20(US)')var _0x1f632e=users['English'];else{if(_0x489f4a[0x0]['language']=='Hindi')var _0x1f632e=users[_0x7d5115(0x1a6)];else{if(_0x489f4a[0x0][_0x7d5115(0x277)]==_0x7d5115(0x24a))var _0x1f632e=users[_0x7d5115(0x24a)];else{if(_0x489f4a[0x0][_0x7d5115(0x277)]==_0x7d5115(0x1c7))var _0x1f632e=users[_0x7d5115(0x1c7)];else{if(_0x489f4a[0x0][_0x7d5115(0x277)]==_0x7d5115(0x1ca))var _0x1f632e=users[_0x7d5115(0x1ca)];else{if(_0x489f4a[0x0]['language']==_0x7d5115(0x250))var _0x1f632e=users[_0x7d5115(0x248)];else{if(_0x489f4a[0x0][_0x7d5115(0x277)]==_0x7d5115(0x23a))var _0x1f632e=users['Chinese'];else{if(_0x489f4a[0x0][_0x7d5115(0x277)]==_0x7d5115(0x181))var _0x1f632e=users[_0x7d5115(0x249)];}}}}}}}_0x5d422a['render'](_0x7d5115(0x208),{'success':_0x563d13[_0x7d5115(0x1f1)]('success'),'errors':_0x563d13[_0x7d5115(0x1f1)](_0x7d5115(0x214)),'role':_0x3bc46a,'profile':_0x2f2447,'alldata':_0x5d8ff4,'master_shop':_0x489f4a,'language':_0x1f632e}),console['log'](alldata);}catch(_0x2f0bb7){console[_0x7d5115(0x1bc)](_0x2f0bb7);}}),router['post'](a0_0xe1dfd2(0x17a),async(_0x561082,_0x18817d)=>{var _0x314950=a0_0xe1dfd2;const {product_code:_0x2340e2}=_0x561082['body'];var _0x207b98;const _0x2996ce=await product['aggregate']([{'$match':{'primary_code':_0x2340e2,'product_category':_0x314950(0x1b7)}},{'$group':{'_id':_0x314950(0x262),'name':{'$first':_0x314950(0x22e)},'category':{'$first':_0x314950(0x211)},'brand':{'$first':_0x314950(0x1f2)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x314950(0x263)},'product_code':{'$first':_0x314950(0x1d3)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x314950(0x1e6)},'maxStocks':{'$first':_0x314950(0x1c9)},'maxProdPerUnit':{'$first':_0x314950(0x1b4)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x314950(0x1f7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x190236=await product['aggregate']([{'$match':{'secondary_code':_0x2340e2,'product_category':_0x314950(0x1b7)}},{'$group':{'_id':'$_id','name':{'$first':_0x314950(0x22e)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x314950(0x25c)},'alertquantity':{'$first':_0x314950(0x263)},'product_code':{'$first':_0x314950(0x1d3)},'primary_code':{'$first':_0x314950(0x257)},'secondary_code':{'$first':_0x314950(0x1e6)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x314950(0x1f7)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x2996ce[_0x314950(0x1fd)]>0x0)_0x207b98=_0x2996ce;else _0x190236[_0x314950(0x1fd)]>0x0&&(_0x207b98=_0x190236);_0x18817d[_0x314950(0x1e1)](_0x207b98);}),router[a0_0xe1dfd2(0x269)](a0_0xe1dfd2(0x25f),async(_0x526293,_0xa8cc8e)=>{var _0x38007a=a0_0xe1dfd2;const {primaryCode:_0x104c26,secondaryCode:_0x443e9c,productCode:_0x6911ce,bay:_0x5a1f91,bin:_0xa7afdb,types:_0x2cc518,pallet:_0x4f1acd,warehouses:_0x45f8f7,room:_0x127792}=_0x526293[_0x38007a(0x1ea)];console[_0x38007a(0x1bc)](_0x526293['body']);try{const _0x20edbb=await warehouse[_0x38007a(0x256)]([{'$match':{'name':_0x45f8f7,'room':_0x127792}},{'$unwind':_0x38007a(0x21b)},{'$match':{'product_details.bay':_0x5a1f91,'product_details.bin':_0xa7afdb,'product_details.type':_0x2cc518}},{'$group':{'_id':_0x38007a(0x177),'name':{'$first':_0x38007a(0x18b)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x38007a(0x176)},'isle':{'$first':_0x38007a(0x201)},'pallet':{'$first':_0x38007a(0x232)},'maxProducts':{'$first':_0x38007a(0x182)}}}]);_0xa8cc8e[_0x38007a(0x218)](0xc8)['json'](_0x20edbb);}catch(_0x8498cf){_0xa8cc8e[_0x38007a(0x218)](0x194)['json']({'message':_0x8498cf['message']});}}),module[a0_0xe1dfd2(0x1f5)]=router;