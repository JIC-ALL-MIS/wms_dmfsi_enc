var a0_0x2dfbeb=a0_0x42ce;(function(_0x256753,_0x2ce514){var _0x2c7b28=a0_0x42ce,_0x3a78b3=_0x256753();while(!![]){try{var _0x242b36=-parseInt(_0x2c7b28(0x1d2))/0x1*(-parseInt(_0x2c7b28(0x1dc))/0x2)+parseInt(_0x2c7b28(0x1ce))/0x3*(-parseInt(_0x2c7b28(0x228))/0x4)+-parseInt(_0x2c7b28(0x19b))/0x5+parseInt(_0x2c7b28(0x186))/0x6*(parseInt(_0x2c7b28(0x19e))/0x7)+parseInt(_0x2c7b28(0x1d5))/0x8*(parseInt(_0x2c7b28(0x206))/0x9)+-parseInt(_0x2c7b28(0x208))/0xa*(parseInt(_0x2c7b28(0x19f))/0xb)+parseInt(_0x2c7b28(0x20c))/0xc;if(_0x242b36===_0x2ce514)break;else _0x3a78b3['push'](_0x3a78b3['shift']());}catch(_0x1db059){_0x3a78b3['push'](_0x3a78b3['shift']());}}}(a0_0x1d2f,0x1ce44));function a0_0x1d2f(){var _0x1b88b0=['Return\x20Goods','random','$product_details.storage','host','Hindi','$suppliers_docs','prod_code','$alertquantity','stock_data','</span>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','MaxStocks_data','3573ahlCJr','$product_details.rack','597570MVRTKI','nodemailer','actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','2881800PMMqub','email','secondary_code','\x20<>\x20','<strong>\x20Regards\x20</strong>','</td>','$product_details.primary_code','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','INC-','prod_name','/view/return_purchase/:id','return_data','invoice','\x20<\x20wew\x20>\x20','Receiving\x20Area','<h5>','types','<hr\x20class=\x22my-3\x22>','primary_code_hide','Rack\x20B','delivery_date','/invoice/:id','date','Purchase\x20data\x20added\x20successfully','warehouse','storage','all_purchases_barcode','116rMLiUo','/barcode/:id','/CheckingWarehouse','$return_data','master','purchase\x20data\x20update\x20successfully','$product_details.product_stock','production_date','$room','push','$_id','prod_secondunit','<div>','prod_Qty','return_qty','</body></html>','/view/add_purchases','Sales\x20Update\x20successfully','purchase_invoice','</h5>','$product_details.type','foreach\x20newproduct','paid_amount','<!DOCTYPE\x20html>','secondary_code_hide','actual_uom','product_details','deliverycode','Error\x20Occurs','Logo.png','$expiry_date','$product_details.bay','$warehouse_name','/all_purchases/view/','Arabic\x20(ae)','getFullYear','delivery_code','find','gmail','Rack\x20F','Shelves','room_name','bay','filter','prod_level','$product_details.isle','quantity','findById','</tr>','site_title','$product_details.product_code','$name','floor','standard_unit','Enabled','success','purchases\x20item\x20return\x20successfull','toString','type','Purchase\x20Return\x20Mail','/preview/:id','sendMail','status','product_code_hide','getDate','../middleware/auth','$product.bin','return_purchase','/view','exports','$product_code','$maxStocks','product_cat','$invoice','prod_qty','An\x20error\x20occurred.','prod_unit','<span\x20style=\x22float:\x20right;\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','/view/:id','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','French','abs','POnumber','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','$product_details.product_name','post','suppliers','forEach','prod_cat','map','note','catch','prod_primunit','$paid_amount','/upload/','../models/all_models','stock_quantity','$product_details.bin','prod_isle','Paid\x20For\x20Purchase','redirect','$product_details.floorlevel','json','Portuguese','$suppliers','RMSEmail','<tbody\x20style=\x22text-align:\x20center;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','currency','\x20</h2>','product_stock','$maxProdPerUnit','product_code','True','Level','user','$product.type','add_purchases','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','222uewYuQ','log','save','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<tr>','max_product_unit','path','Raw\x20Materials','rack','pallet','room','Rack\x20E','role','amount','$due_amount','bin','$unit','prod_pallet','getMonth','errors','express','358110OYstHp','expiry_date','Router','28301ydBCNz','11mjYoNO','</div>','createTransport','error','alertQTY','$product.bay','German','secondary_unit','batch_code','length','ejs','An\x20error\x20occurred\x20while\x20saving\x20data.','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_name','back','warehouse_name','params','$batch_code','logo','all_purchases','flash','maxStocks','Floor','image','string','$product_details','staff','Email\x20sent\x20successfully','$product','isle','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','password','body','</tbody>','Chinese','/../public','$product_details.pallet','concat','$product_details.level','then','English\x20(US)','/all_purchases/view','message','floorlevel','slice','</thead>','/view/add_purchases/:id','22158uLmInN','$product_details.expiry_date','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','337bofdzS','\x20Order\x20Date\x20:\x20','due_amount','184hSOWmf','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','\x20Order\x20Number\x20:\x20','purchase_quantity','product','suppliers_docs','386EedzHQ','name','RoomAssign','Enclosed','English','$primary_code','prod_invoice','$product_details.maxProducts','$brand','$product_details._id','$date','rak','$secondary_unit','DRY\x20STORAGE','render','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$product.floorlevel','primary_code','aggregate','suppliers_data','Arabic','Portuguese\x20(BR)','Rack\x20A','Purchase\x20Return','/give_payment/:id','Spanish','get','$product_details.secondary_code','</table>','<h2>\x20'];a0_0x1d2f=function(){return _0x1b88b0;};return a0_0x1d2f();}const express=require(a0_0x2dfbeb(0x19a)),app=express(),router=express[a0_0x2dfbeb(0x19d)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2dfbeb(0x288)),auth=require(a0_0x2dfbeb(0x269)),nodemailer=require(a0_0x2dfbeb(0x209));function a0_0x42ce(_0x31d430,_0x6c1e5d){var _0x1d2f8a=a0_0x1d2f();return a0_0x42ce=function(_0x42cea2,_0x1e98a4){_0x42cea2=_0x42cea2-0x182;var _0xcb3784=_0x1d2f8a[_0x42cea2];return _0xcb3784;},a0_0x42ce(_0x31d430,_0x6c1e5d);}var ejs=require(a0_0x2dfbeb(0x1a9));const path=require(a0_0x2dfbeb(0x18c)),users=require('../public/language/languages.json');router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x26c),auth,async(_0x5eb09b,_0x453375)=>{var _0x303398=a0_0x2dfbeb;try{const {username:_0x1e037d,email:_0x4c284a,role:_0x4691d2}=_0x5eb09b['user'],_0x5ec5ba=_0x5eb09b[_0x303398(0x29c)],_0x2e0f51=await profile['findOne']({'email':_0x5ec5ba[_0x303398(0x20d)]}),_0x184bc4=await staff[_0x303398(0x184)]({'email':_0x5ec5ba[_0x303398(0x20d)]});if(_0x5ec5ba[_0x303398(0x192)]=='staff'){const _0x2d1d52=await staff[_0x303398(0x184)]({'email':_0x5ec5ba['email']});}const _0x3d2c55=await master_shop[_0x303398(0x24d)]();let _0x2ecbab;if(_0x5ec5ba['role']==_0x303398(0x1b9)){const _0x1a770e=await staff['findOne']({'email':_0x5ec5ba[_0x303398(0x20d)]});_0x2ecbab=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1a770e[_0x303398(0x225)]}},{'$lookup':{'from':_0x303398(0x27f),'localField':_0x303398(0x27f),'foreignField':_0x303398(0x1dd),'as':_0x303398(0x1db)}},{'$unwind':_0x303398(0x1ff)},{'$unwind':'$product'},{'$group':{'_id':_0x303398(0x232),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x303398(0x291)},'date':{'$first':_0x303398(0x1e6)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x303398(0x230)},'product':{'$push':_0x303398(0x1bb)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x303398(0x286)},'due_amount':{'$first':_0x303398(0x194)},'return_data':{'$first':_0x303398(0x22b)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x303398(0x246)},'suppliers_docs':{'$first':_0x303398(0x1ff)},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x303398(0x1a4)},'isle':{'$addToSet':_0x303398(0x26a)},'type':{'$addToSet':_0x303398(0x182)},'floorlevel':{'$addToSet':_0x303398(0x1ec)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2ecbab=await purchases['aggregate']([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x303398(0x1dd),'as':'suppliers_docs'}},{'$unwind':_0x303398(0x1ff)},{'$unwind':_0x303398(0x1bb)},{'$group':{'_id':_0x303398(0x232),'invoice':{'$first':_0x303398(0x271)},'suppliers':{'$first':'$suppliers'},'date':{'$first':_0x303398(0x1e6)},'warehouse_name':{'$first':_0x303398(0x248)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x303398(0x1bb)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x303398(0x286)},'due_amount':{'$first':_0x303398(0x194)},'return_data':{'$first':_0x303398(0x22b)},'batch_code':{'$first':_0x303398(0x1b0)},'expiry_date':{'$first':_0x303398(0x246)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':_0x303398(0x1a4)},'isle':{'$addToSet':_0x303398(0x26a)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':_0x303398(0x1ec)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x3d2c55[0x0]['language']==_0x303398(0x1c7)){var _0x4439e1=users[_0x303398(0x1e0)];console['log'](_0x4439e1);}else{if(_0x3d2c55[0x0][_0x303398(0x213)]==_0x303398(0x1fe))var _0x4439e1=users[_0x303398(0x1fe)];else{if(_0x3d2c55[0x0][_0x303398(0x213)]==_0x303398(0x1a5))var _0x4439e1=users[_0x303398(0x1a5)];else{if(_0x3d2c55[0x0]['language']==_0x303398(0x1f5))var _0x4439e1=users[_0x303398(0x1f5)];else{if(_0x3d2c55[0x0][_0x303398(0x213)]=='French')var _0x4439e1=users[_0x303398(0x279)];else{if(_0x3d2c55[0x0][_0x303398(0x213)]==_0x303398(0x1f1))var _0x4439e1=users['Portuguese'];else{if(_0x3d2c55[0x0][_0x303398(0x213)]==_0x303398(0x1c1))var _0x4439e1=users[_0x303398(0x1c1)];else{if(_0x3d2c55[0x0][_0x303398(0x213)]==_0x303398(0x24a))var _0x4439e1=users[_0x303398(0x1f0)];}}}}}}}_0x453375[_0x303398(0x1ea)](_0x303398(0x1b2),{'success':_0x5eb09b[_0x303398(0x1b3)]('success'),'errors':_0x5eb09b[_0x303398(0x1b3)]('errors'),'purchases':_0x2ecbab,'role':_0x5ec5ba,'profile':_0x2e0f51,'master_shop':_0x3d2c55,'language':_0x4439e1});}catch(_0xea0a6e){console[_0x303398(0x187)]('table\x20page',_0xea0a6e),_0x453375[_0x303398(0x266)](0xc8)['json']({'message':_0xea0a6e[_0x303398(0x1c9)]});}});function BayBinSelected(_0x33ab77,_0x54cd99){var _0x4faaad=a0_0x2dfbeb,_0x1926be=[],_0x3130a5=[],_0x4b2b0d=[],_0x448fdf=[],_0x5bdb7d=[],_0xace10f=[];let _0x4959a0=[];if(_0x33ab77==_0x4faaad(0x1e9))switch(_0x54cd99){case _0x4faaad(0x1f2):_0x1926be=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x3130a5=[0x1,0x2],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=['Level',_0x4faaad(0x1b5)],_0x5bdb7d=['D'],_0xace10f=['A'];break;case _0x4faaad(0x220):_0x1926be=[0x6,0x5,0x4,0x3,0x2,0x1],_0x3130a5=[0x1,0x2],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=[_0x4faaad(0x29b),_0x4faaad(0x1b5)],_0x5bdb7d=['D'],_0xace10f=['B'];break;case _0x4faaad(0x250):_0x1926be=[0x0],_0x3130a5=[0x0],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=[_0x4faaad(0x1b5)],_0x5bdb7d=['D'],_0xace10f=['S'];break;case _0x4faaad(0x21b):_0x1926be=[0x0],_0x3130a5=[0x0],_0x448fdf=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x4b2b0d=[_0x4faaad(0x1b5)],_0x5bdb7d=['D'],_0xace10f=['R'];break;}else{if(_0x33ab77=='COLD\x20STORAGE')switch(_0x54cd99){case _0x4faaad(0x1f2):_0x1926be=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x3130a5=['B','F'],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=[_0x4faaad(0x29b),'Floor'],_0x5bdb7d=['C'],_0xace10f=['A'];break;case'Rack\x20B':_0x1926be=[0x5,0x4,0x3,0x2,0x1],_0x3130a5=['F','B','S'],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=[_0x4faaad(0x29b),'Floor'],_0x5bdb7d=['C'],_0xace10f=['B'];break;case'Rack\x20C':_0x1926be=[0x1,0x2,0x3,0x4,0x5],_0x3130a5=['B','F','S'],_0x448fdf=[0x5,0x4,0x3,0x2,0x1],_0x4b2b0d=[_0x4faaad(0x29b),_0x4faaad(0x1b5)],_0x5bdb7d=['C'],_0xace10f=['C'];break;case'Rack\x20D':_0x1926be=[0x5,0x4,0x3,0x2,0x1],_0x3130a5=['F','B','S'],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=['Level',_0x4faaad(0x1b5)],_0x5bdb7d=['C'],_0xace10f=['D'];break;case _0x4faaad(0x191):_0x1926be=[0x4,0x3,0x2,0x1],_0x3130a5=[0x1,0x2],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=[_0x4faaad(0x29b),_0x4faaad(0x1b5)],_0x5bdb7d=['C'],_0xace10f=['E'];break;case _0x4faaad(0x24f):_0x1926be=[0x1,0x2,0x3],_0x3130a5=[0x1,0x2],_0x448fdf=[0x1,0x2,0x3,0x4,0x5],_0x4b2b0d=[_0x4faaad(0x29b)],_0x5bdb7d=['C'],_0xace10f=['F'];break;}}return{'levels':_0x1926be,'Isle':_0x3130a5,'rack':_0x448fdf,'type':_0x4b2b0d,'storage':_0x5bdb7d,'rak':_0xace10f};}async function getRandom8DigitNumber(){var _0x4e7f46=a0_0x2dfbeb;const _0x4ed930=0x989680,_0x2fe038=0x5f5e0ff,_0x282d45=Math[_0x4e7f46(0x25c)](Math[_0x4e7f46(0x1fb)]()*(_0x2fe038-_0x4ed930+0x1))+_0x4ed930;var _0x520265;const _0x2d8fed=await purchases[_0x4e7f46(0x184)]({'invoice':_0x4e7f46(0x215)+_0x282d45});return _0x2d8fed&&_0x2d8fed[_0x4e7f46(0x1a8)]>0x0?_0x520265='INC-'+_0x282d45:_0x520265=_0x4e7f46(0x215)+_0x282d45,_0x520265;}router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x238),auth,async(_0x29ef3b,_0x1b8d9c)=>{var _0x2e518f=a0_0x2dfbeb;try{const {username:_0x152695,email:_0x1a97b9,role:_0x2f3d56}=_0x29ef3b['user'],_0xf7419d=_0x29ef3b['user'],_0x410d85=await profile[_0x2e518f(0x184)]({'email':_0xf7419d[_0x2e518f(0x20d)]}),_0x4b5cf0=await master_shop[_0x2e518f(0x24d)](),_0x3c0b8a=await staff['findOne']({'email':_0xf7419d[_0x2e518f(0x20d)]}),_0x16f7ed=await suppliers['find']({});let _0x4fe35b;if(_0xf7419d['role']==_0x2e518f(0x1b9)){const _0x34a2ac=await staff['findOne']({'email':_0xf7419d['email']});_0x4fe35b=await warehouse[_0x2e518f(0x1ee)]([{'$match':{'status':_0x2e518f(0x25e),'name':_0x34a2ac[_0x2e518f(0x225)],'warehouse_category':_0x2e518f(0x18d),'name':{'$ne':_0x2e518f(0x1fa)}}},{'$group':{'_id':_0x2e518f(0x25b),'name':{'$first':_0x2e518f(0x25b)}}}]);}else _0x4fe35b=await warehouse['aggregate']([{'$match':{'status':_0x2e518f(0x25e),'warehouse_category':_0x2e518f(0x18d),'name':{'$ne':_0x2e518f(0x1fa)}}},{'$group':{'_id':_0x2e518f(0x25b),'name':{'$first':_0x2e518f(0x25b)}}}]);const _0x5274e1=await product[_0x2e518f(0x24d)]({}),_0x266e77=await warehouse[_0x2e518f(0x24d)]({'status':_0x2e518f(0x25e)}),_0x336506=await purchases['find']({}),_0x268681=_0x336506[_0x2e518f(0x1a8)]+0x1,_0xde0217='INC-'+_0x268681[_0x2e518f(0x261)]()['padStart'](0x5,'0');var _0x4040a8=[_0x2e518f(0x1d6),_0x2e518f(0x1df)];if(_0x4b5cf0[0x0][_0x2e518f(0x213)]==_0x2e518f(0x1c7))var _0x263b4e=users['English'];else{if(_0x4b5cf0[0x0][_0x2e518f(0x213)]=='Hindi')var _0x263b4e=users['Hindi'];else{if(_0x4b5cf0[0x0]['language']==_0x2e518f(0x1a5))var _0x263b4e=users[_0x2e518f(0x1a5)];else{if(_0x4b5cf0[0x0]['language']==_0x2e518f(0x1f5))var _0x263b4e=users[_0x2e518f(0x1f5)];else{if(_0x4b5cf0[0x0][_0x2e518f(0x213)]=='French')var _0x263b4e=users['French'];else{if(_0x4b5cf0[0x0][_0x2e518f(0x213)]==_0x2e518f(0x1f1))var _0x263b4e=users[_0x2e518f(0x290)];else{if(_0x4b5cf0[0x0]['language']==_0x2e518f(0x1c1))var _0x263b4e=users[_0x2e518f(0x1c1)];else{if(_0x4b5cf0[0x0][_0x2e518f(0x213)]==_0x2e518f(0x24a))var _0x263b4e=users[_0x2e518f(0x1f0)];}}}}}}}const _0x3e3ad9=getRandom8DigitNumber();_0x3e3ad9[_0x2e518f(0x1c6)](_0x5e4f2e=>{var _0x3ec974=_0x2e518f;_0x1b8d9c[_0x3ec974(0x1ea)](_0x3ec974(0x183),{'success':_0x29ef3b[_0x3ec974(0x1b3)]('success'),'errors':_0x29ef3b[_0x3ec974(0x1b3)](_0x3ec974(0x199)),'role':_0xf7419d,'profile':_0x410d85,'suppliers':_0x16f7ed,'warehouse':_0x4fe35b,'product':_0x5274e1,'invoice':_0x5e4f2e,'master_shop':_0x4b5cf0,'language':_0x263b4e,'find_data':_0x266e77,'rooms_data':_0x4040a8});})['catch'](_0x25d573=>{var _0x533db8=_0x2e518f;_0x29ef3b['flash'](_0x533db8(0x199),_0x533db8(0x294)),_0x1b8d9c[_0x533db8(0x28d)](_0x533db8(0x1c8));});}catch(_0x2e06b4){console[_0x2e518f(0x187)](_0x2e06b4);}}),router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x1cd),auth,async(_0x41184f,_0x175f32)=>{var _0x24e3c3=a0_0x2dfbeb;try{const _0x3d2418=_0x41184f[_0x24e3c3(0x1af)]['id'];console[_0x24e3c3(0x187)](_0x3d2418);const _0x1c398e=await master_shop['find']();console[_0x24e3c3(0x187)](_0x24e3c3(0x22c),_0x1c398e);const _0x26a7a9=await product[_0x24e3c3(0x184)]({'name':_0x3d2418});console['log']('product',_0x26a7a9),_0x175f32[_0x24e3c3(0x266)](0xc8)[_0x24e3c3(0x28f)]({'product_data':_0x26a7a9,'master':_0x1c398e});}catch(_0x3cfabf){console[_0x24e3c3(0x187)]('add_purchases\x20error',_0x3cfabf);}}),router[a0_0x2dfbeb(0x27e)](a0_0x2dfbeb(0x238),auth,async(_0x2518cd,_0x1d456d)=>{var _0x580092=a0_0x2dfbeb;try{const {invoice:_0x5d0825,date:_0x13c2eb,warehouse_name:_0x476846,prod_name:_0x23b286,prod_code:_0x287099,prod_qty:_0x339005,prod_unit:_0xf2af7,prod_secondunit:_0xdb6ca4,prod_level:_0x4804cf,prod_isle:_0x4fb985,prod_pallet:_0x4267a7,note:_0x5a3ace,expiry_date:_0x4e8980,batch_code:_0x373cf8,payable:_0x4cba72,due_amount:_0x43cc18,Room_name:_0x22c34c,primary_code:_0x1404e0,secondary_code:_0x3dbd58,MaxStocks_data:_0x1ad5ac,PO_number:_0x4d22c6,SCRN:_0x536369,JO_number:_0x3a3364}=_0x2518cd['body'];if(typeof _0x23b286=='string')var _0x12621d=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x216)]],_0x284e94=[_0x2518cd['body'][_0x580092(0x200)]],_0xd9f113=[_0x2518cd['body'][_0x580092(0x235)]],_0xa35014=[_0x2518cd['body'][_0x580092(0x285)]],_0x519978=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x233)]],_0xba491c=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x254)]],_0x1ed86c=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x1ed)]],_0x45d86f=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x20e)]],_0x29e9cf=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x205)]],_0x1c1e00=[_0x2518cd['body'][_0x580092(0x1a7)]],_0x395a4e=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x19c)]],_0x50966a=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x18b)]],_0x4f69ee=[_0x2518cd[_0x580092(0x1bf)]['alertQTY']],_0x379400=[_0x2518cd[_0x580092(0x1bf)]['production_date']],_0x1f02ef=[_0x2518cd[_0x580092(0x1bf)]['prod_cat']],_0x2f91dc=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x1de)]],_0x4b59a0=[_0x2518cd['body'][_0x580092(0x243)]],_0x829b80=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x1e2)]],_0x1e9c33=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x20a)]],_0x39e3bf=[_0x2518cd[_0x580092(0x1bf)][_0x580092(0x241)]];else var _0x12621d=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x216)]],_0x284e94=[..._0x2518cd['body'][_0x580092(0x200)]],_0xd9f113=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x235)]],_0xa35014=[..._0x2518cd['body'][_0x580092(0x285)]],_0x519978=[..._0x2518cd['body'][_0x580092(0x233)]],_0xba491c=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x254)]],_0x1ed86c=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x1ed)]],_0x45d86f=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x20e)]],_0x29e9cf=[..._0x2518cd['body'][_0x580092(0x205)]],_0x1c1e00=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x1a7)]],_0x395a4e=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x19c)]],_0x50966a=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x18b)]],_0x4f69ee=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x1a3)]],_0x379400=[..._0x2518cd['body'][_0x580092(0x22f)]],_0x1f02ef=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x281)]],_0x2f91dc=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x1de)]],_0x4b59a0=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x243)]],_0x829b80=[..._0x2518cd['body'][_0x580092(0x1e2)]],_0x1e9c33=[..._0x2518cd[_0x580092(0x1bf)][_0x580092(0x20a)]],_0x39e3bf=[..._0x2518cd['body'][_0x580092(0x241)]];const _0x36033f=_0x12621d['map'](_0x56c381=>{return _0x56c381={'product_name':_0x56c381};});_0x1e9c33[_0x580092(0x280)]((_0x242153,_0x2ca213)=>{var _0x2ee75b=_0x580092;_0x36033f[_0x2ca213][_0x2ee75b(0x20a)]=Math[_0x2ee75b(0x27a)](_0x242153);}),_0x39e3bf['forEach']((_0xd65790,_0x193021)=>{var _0x5396ad=_0x580092;_0x36033f[_0x193021][_0x5396ad(0x241)]=_0xd65790;}),_0x284e94['forEach']((_0x5f06c6,_0x1036c0)=>{_0x36033f[_0x1036c0]['product_code']=_0x5f06c6;}),_0xd9f113[_0x580092(0x280)]((_0x4e42eb,_0x6863d)=>{var _0x5c195c=_0x580092;_0x36033f[_0x6863d][_0x5c195c(0x256)]=Math[_0x5c195c(0x27a)](_0x4e42eb);}),_0xa35014['forEach']((_0x2378c9,_0x2269ad)=>{var _0x5817b4=_0x580092;_0x36033f[_0x2269ad][_0x5817b4(0x25d)]=_0x2378c9;}),_0x519978[_0x580092(0x280)]((_0x329d15,_0x173b98)=>{var _0x5bbd24=_0x580092;_0x36033f[_0x173b98][_0x5bbd24(0x1a6)]=_0x329d15;}),_0xba491c['forEach']((_0x5b2da3,_0x58ff78)=>{_0x2f91dc['forEach']((_0x20c1f1,_0x526925)=>{var _0x258d5c=a0_0x42ce;if(_0x20c1f1=='Receiving\x20Area'&&_0x58ff78==_0x526925){console[_0x258d5c(0x187)](_0x20c1f1+_0x258d5c(0x21a)+_0x58ff78+_0x258d5c(0x20f)+_0x526925+_0x258d5c(0x20f)+_0x5b2da3);var _0x2a6230=_0x5b2da3[_0x258d5c(0x1cb)](0x3);_0x36033f[_0x58ff78][_0x258d5c(0x226)]=_0x5b2da3[0x0],_0x36033f[_0x58ff78]['rack']=_0x5b2da3[0x1],_0x36033f[_0x58ff78][_0x258d5c(0x252)]=0x0,_0x36033f[_0x58ff78][_0x258d5c(0x195)]=0x0,_0x36033f[_0x58ff78][_0x258d5c(0x262)]=_0x258d5c(0x1b5),_0x36033f[_0x58ff78][_0x258d5c(0x1ca)]=_0x2a6230;}else{if(_0x20c1f1==_0x258d5c(0x250)&&_0x58ff78==_0x526925){var _0x2a6230=_0x5b2da3[_0x258d5c(0x1cb)](0x3);_0x36033f[_0x58ff78][_0x258d5c(0x226)]=_0x5b2da3[0x0],_0x36033f[_0x58ff78][_0x258d5c(0x18e)]=_0x5b2da3[0x1],_0x36033f[_0x58ff78][_0x258d5c(0x252)]=0x0,_0x36033f[_0x58ff78]['bin']=0x0,_0x36033f[_0x58ff78][_0x258d5c(0x262)]='Floor',_0x36033f[_0x58ff78][_0x258d5c(0x1ca)]=_0x5b2da3[0x5];}else{if(_0x58ff78==_0x526925){var _0x1a5655;if(_0x5b2da3[0x4]=='L')_0x1a5655='Level';else _0x5b2da3[0x4]=='F'&&(_0x1a5655=_0x258d5c(0x1b5));_0x36033f[_0x58ff78][_0x258d5c(0x226)]=_0x5b2da3[0x0],_0x36033f[_0x58ff78][_0x258d5c(0x18e)]=_0x5b2da3[0x1],_0x36033f[_0x58ff78][_0x258d5c(0x252)]=_0x5b2da3[0x2],_0x36033f[_0x58ff78][_0x258d5c(0x195)]=_0x5b2da3[0x3],_0x36033f[_0x58ff78][_0x258d5c(0x262)]=_0x1a5655,_0x36033f[_0x58ff78][_0x258d5c(0x1ca)]=_0x5b2da3[0x5];}}}});}),_0x1ed86c['forEach']((_0x52cf3b,_0x245fde)=>{var _0x4cc173=_0x580092;_0x36033f[_0x245fde][_0x4cc173(0x1ed)]=_0x52cf3b;}),_0x45d86f[_0x580092(0x280)]((_0x249d14,_0x437ad6)=>{var _0x2f18ab=_0x580092;_0x36033f[_0x437ad6][_0x2f18ab(0x20e)]=_0x249d14;}),_0x29e9cf[_0x580092(0x280)]((_0x483388,_0x41abc3)=>{_0x36033f[_0x41abc3]['maxStocks']=_0x483388;}),_0x1c1e00['forEach']((_0x14bc0a,_0x2c5db0)=>{var _0x24795f=_0x580092;_0x36033f[_0x2c5db0][_0x24795f(0x1a7)]=_0x14bc0a;}),_0x395a4e[_0x580092(0x280)]((_0x4010a5,_0xc10d9)=>{var _0x53fdb6=_0x580092;_0x36033f[_0xc10d9][_0x53fdb6(0x19c)]=_0x4010a5;}),_0x50966a[_0x580092(0x280)]((_0x42c884,_0x1ac478)=>{_0x36033f[_0x1ac478]['maxperunit']=_0x42c884;}),_0x4f69ee[_0x580092(0x280)]((_0x11fb92,_0x199928)=>{var _0xb2499f=_0x580092;_0x36033f[_0x199928][_0xb2499f(0x1a3)]=_0x11fb92;}),_0x379400[_0x580092(0x280)]((_0x488f3e,_0x2d36b8)=>{var _0xca86a7=_0x580092;_0x36033f[_0x2d36b8][_0xca86a7(0x22f)]=_0x488f3e;}),_0x1f02ef[_0x580092(0x280)]((_0x2aa529,_0x5d6ff4)=>{var _0x54f910=_0x580092;_0x36033f[_0x5d6ff4][_0x54f910(0x270)]=_0x2aa529;}),_0x2f91dc[_0x580092(0x280)]((_0x157b43,_0x1c06ac)=>{var _0x95dac9=_0x580092;_0x36033f[_0x1c06ac][_0x95dac9(0x251)]=_0x157b43;}),_0x4b59a0['forEach']((_0x17d554,_0x5516f8)=>{var _0x3795f=_0x580092;_0x36033f[_0x5516f8][_0x3795f(0x24c)]=_0x17d554;}),_0x829b80[_0x580092(0x280)]((_0x3f9eee,_0x3a3191)=>{var _0x5c4091=_0x580092;_0x36033f[_0x3a3191][_0x5c4091(0x219)]=_0x3f9eee;});const _0x13cc18=_0x2f91dc[_0x580092(0x282)](_0x362e01=>{return _0x362e01={'room_name':_0x362e01};}),_0x4ca73d=_0x36033f[_0x580092(0x253)](_0x5dd9f5=>_0x5dd9f5['quantity']!=='0'&&_0x5dd9f5[_0x580092(0x256)]!==''),_0x1ed501=new purchases({'invoice':_0x5d0825,'suppliers':_0x2518cd['body'][_0x580092(0x27f)],'date':_0x13c2eb,'warehouse_name':_0x476846,'product':_0x4ca73d,'note':_0x5a3ace,'due_amount':_0x43cc18,'POnumber':_0x4d22c6,'SCRN':_0x536369,'JO_number':_0x3a3364,'roomList':_0x13cc18}),_0x1341ad=await _0x1ed501['save'](),_0x21f89d=await purchases[_0x580092(0x184)]({'invoice':_0x5d0825}),_0x216d11=_0x21f89d['product'][_0x580092(0x282)](async _0x55b1df=>{var _0x2d76e2=_0x580092,_0x3c1f81=await warehouse['findOne']({'name':_0x476846,'room':_0x55b1df['room_name']}),_0x2000c7=0x0;return _0x3c1f81[_0x2d76e2(0x242)][_0x2d76e2(0x280)](_0xf94ff7=>{var _0x1afdd7=_0x2d76e2;_0xf94ff7[_0x1afdd7(0x1ac)]==_0x55b1df[_0x1afdd7(0x1ac)]&&_0xf94ff7[_0x1afdd7(0x1ca)]==_0x55b1df[_0x1afdd7(0x1ca)]&&_0xf94ff7[_0x1afdd7(0x262)]==_0x55b1df[_0x1afdd7(0x262)]&&_0xf94ff7['bin']==_0x55b1df[_0x1afdd7(0x195)]&&_0xf94ff7[_0x1afdd7(0x252)]==_0x55b1df[_0x1afdd7(0x252)]&&_0xf94ff7[_0x1afdd7(0x18e)]==_0x55b1df[_0x1afdd7(0x18e)]&&_0xf94ff7['storage']==_0x55b1df[_0x1afdd7(0x226)]&&_0xf94ff7[_0x1afdd7(0x19c)]==_0x55b1df['expiry_date']&&_0xf94ff7[_0x1afdd7(0x1a7)]==_0x55b1df['batch_code']&&_0xf94ff7['production_date']==_0x55b1df['production_date']&&_0xf94ff7[_0x1afdd7(0x219)]==_0x21f89d['invoice']&&(_0xf94ff7[_0x1afdd7(0x297)]+=Math[_0x1afdd7(0x27a)](_0x55b1df[_0x1afdd7(0x256)]),_0x2000c7++);}),_0x2000c7===0x0&&_0x3c1f81['product_details'][_0x2d76e2(0x231)]({'product_name':_0x55b1df[_0x2d76e2(0x1ac)],'product_stock':Math['abs'](_0x55b1df[_0x2d76e2(0x256)]),'primary_code':_0x55b1df[_0x2d76e2(0x1ed)],'secondary_code':_0x55b1df[_0x2d76e2(0x20e)],'product_code':_0x55b1df[_0x2d76e2(0x299)],'storage':_0x55b1df[_0x2d76e2(0x226)],'rack':_0x55b1df[_0x2d76e2(0x18e)],'bay':_0x55b1df[_0x2d76e2(0x252)],'bin':_0x55b1df[_0x2d76e2(0x195)],'type':_0x55b1df[_0x2d76e2(0x262)],'floorlevel':_0x55b1df[_0x2d76e2(0x1ca)],'maxProducts':_0x55b1df[_0x2d76e2(0x1b4)],'unit':_0x55b1df['standard_unit'],'secondary_unit':_0x55b1df['secondary_unit'],'expiry_date':_0x55b1df[_0x2d76e2(0x19c)],'maxPerUnit':_0x55b1df['maxperunit'],'batch_code':_0x55b1df[_0x2d76e2(0x1a7)],'alertQTY':_0x55b1df['alertQTY'],'production_date':_0x55b1df[_0x2d76e2(0x22f)],'product_cat':_0x55b1df[_0x2d76e2(0x270)],'invoice':_0x55b1df[_0x2d76e2(0x219)],'actual_qty':Math[_0x2d76e2(0x27a)](_0x55b1df['actual_qty']),'actual_uom':_0x55b1df[_0x2d76e2(0x241)]}),_0x3c1f81;});Promise['all'](_0x216d11)[_0x580092(0x1c6)](async _0x3eee3a=>{var _0x28fc0e=_0x580092;try{for(const _0x22d0c5 of _0x3eee3a){await _0x22d0c5[_0x28fc0e(0x188)]();}const _0x9f8d8d=await master_shop['find'](),_0x22344d=await email_settings[_0x28fc0e(0x184)](),_0x3da9b6=await supervisor_settings['find']();var _0x5dabee=_0x21f89d[_0x28fc0e(0x1da)],_0x565977='',_0x2763f8;for(_0x2763f8 in _0x5dabee){_0x565977+=_0x28fc0e(0x18a)+_0x28fc0e(0x204)+_0x5dabee[_0x2763f8]['product_name']+_0x28fc0e(0x211)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5dabee[_0x2763f8][_0x28fc0e(0x299)]+_0x28fc0e(0x211)+_0x28fc0e(0x204)+_0x5dabee[_0x2763f8][_0x28fc0e(0x256)]+_0x28fc0e(0x211)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5dabee[_0x2763f8][_0x28fc0e(0x25d)]+_0x28fc0e(0x211)+_0x28fc0e(0x204)+_0x5dabee[_0x2763f8][_0x28fc0e(0x1a6)]+_0x28fc0e(0x211)+_0x28fc0e(0x204)+_0x21f89d[_0x28fc0e(0x1ae)]+_0x28fc0e(0x211)+_0x28fc0e(0x204)+_0x5dabee[_0x2763f8]['room_name']+_0x28fc0e(0x211)+_0x28fc0e(0x204)+_0x5dabee[_0x2763f8]['storage']+_0x5dabee[_0x2763f8][_0x28fc0e(0x18e)]+_0x5dabee[_0x2763f8][_0x28fc0e(0x252)]+_0x5dabee[_0x2763f8][_0x28fc0e(0x195)]+_0x5dabee[_0x2763f8][_0x28fc0e(0x262)][0x0]+_0x5dabee[_0x2763f8][_0x28fc0e(0x1ca)]+_0x28fc0e(0x211),_0x28fc0e(0x258);}let _0x4898e0=nodemailer[_0x28fc0e(0x1a1)]({'host':_0x22344d[_0x28fc0e(0x1fd)],'port':Number(_0x22344d['port']),'secure':![],'auth':{'user':_0x22344d[_0x28fc0e(0x20d)],'pass':_0x22344d[_0x28fc0e(0x1be)]}}),_0x299b8f={'from':_0x22344d[_0x28fc0e(0x20d)],'to':_0x3da9b6[0x0][_0x28fc0e(0x292)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x28fc0e(0x245),'path':__dirname+'/../public'+_0x28fc0e(0x287)+_0x9f8d8d[0x0][_0x28fc0e(0x1b6)],'cid':_0x28fc0e(0x1b1)}],'html':_0x28fc0e(0x23f)+'<html><head><title></title>'+'</head><body>'+_0x28fc0e(0x234)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x28fc0e(0x234)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x28fc0e(0x234)+_0x28fc0e(0x1f9)+_0x9f8d8d[0x0]['site_title']+_0x28fc0e(0x296)+_0x28fc0e(0x1a0)+_0x28fc0e(0x1a0)+_0x28fc0e(0x21e)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x28fc0e(0x1d8)+_0x21f89d['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x28fc0e(0x1d3)+_0x21f89d[_0x28fc0e(0x223)]+'\x20'+_0x28fc0e(0x203)+_0x28fc0e(0x23b)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x28fc0e(0x18a)+_0x28fc0e(0x1d7)+_0x28fc0e(0x1d1)+_0x28fc0e(0x20b)+_0x28fc0e(0x185)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x28fc0e(0x214)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x28fc0e(0x293)+'\x20'+_0x565977+'\x20'+'</tbody>'+_0x28fc0e(0x1f8)+_0x28fc0e(0x234)+_0x28fc0e(0x210)+_0x28fc0e(0x21c)+_0x9f8d8d[0x0][_0x28fc0e(0x259)]+_0x28fc0e(0x23b)+_0x28fc0e(0x1a0)+'</div>'+_0x28fc0e(0x237)};_0x4898e0[_0x28fc0e(0x265)](_0x299b8f,function(_0x59f0d9,_0x271211){var _0x53bc99=_0x28fc0e;_0x59f0d9?(console['log'](_0x59f0d9),console[_0x53bc99(0x187)](_0x53bc99(0x244))):console['log'](_0x53bc99(0x1ba));}),_0x2518cd[_0x28fc0e(0x1b3)](_0x28fc0e(0x25f),_0x28fc0e(0x224)),_0x1d456d[_0x28fc0e(0x28d)](_0x28fc0e(0x249));}catch(_0x48ddcc){console[_0x28fc0e(0x1a2)](_0x48ddcc),_0x1d456d[_0x28fc0e(0x266)](0x1f4)['json']({'error':_0x28fc0e(0x1aa)});}})[_0x580092(0x284)](_0x5a4a4a=>{var _0x3f6566=_0x580092;console[_0x3f6566(0x1a2)](_0x5a4a4a),_0x1d456d[_0x3f6566(0x266)](0x1f4)[_0x3f6566(0x28f)]({'error':_0x3f6566(0x273)});});}catch(_0x36d4d8){console[_0x580092(0x187)](_0x36d4d8);}}),router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x264),auth,async(_0xa0918b,_0x70bf6b)=>{var _0x2de44c=a0_0x2dfbeb;try{const {username:_0x54e1f3,email:_0x4cb39b,role:_0x24fc50}=_0xa0918b[_0x2de44c(0x29c)],_0x5facbd=_0xa0918b[_0x2de44c(0x29c)],_0x291c23=await profile['findOne']({'email':_0x5facbd[_0x2de44c(0x20d)]}),_0x8d8828=await master_shop[_0x2de44c(0x24d)](),_0x2f4435=_0xa0918b[_0x2de44c(0x1af)]['id'],_0x5b88c7=await purchases[_0x2de44c(0x257)](_0x2f4435),_0x52c8a4=await warehouse[_0x2de44c(0x1ee)]([{'$match':{'name':_0x5b88c7[_0x2de44c(0x1ae)],'room':_0x5b88c7['room']}},{'$unwind':_0x2de44c(0x1b8)},{'$group':{'_id':_0x2de44c(0x1e5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2de44c(0x22e)},'bay':{'$first':_0x2de44c(0x247)},'bin':{'$first':_0x2de44c(0x28a)},'type':{'$first':_0x2de44c(0x23c)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2de44c(0x212)},'secondary_code':{'$first':_0x2de44c(0x1f7)},'product_code':{'$first':_0x2de44c(0x25a)},'storage':{'$first':_0x2de44c(0x1fc)},'rack':{'$first':_0x2de44c(0x207)},'expiry_date':{'$first':_0x2de44c(0x1cf)}}}]),_0x2f69ab=await customer[_0x2de44c(0x24d)]({});let _0x41d115;if(_0x5facbd[_0x2de44c(0x192)]==_0x2de44c(0x1b9)){const _0x5eab36=await staff[_0x2de44c(0x184)]({'email':_0x5facbd[_0x2de44c(0x20d)]});_0x41d115=await warehouse['aggregate']([{'$match':{'status':_0x2de44c(0x25e),'name':_0x5eab36['warehouse']}},{'$group':{'_id':_0x2de44c(0x25b),'name':{'$first':_0x2de44c(0x25b)}}}]);}else _0x41d115=await warehouse[_0x2de44c(0x1ee)]([{'$match':{'status':_0x2de44c(0x25e)}},{'$group':{'_id':_0x2de44c(0x25b),'name':{'$first':_0x2de44c(0x25b)}}}]);const _0x5ae94d=await product[_0x2de44c(0x24d)]({}),_0x4974d6=await suppliers[_0x2de44c(0x24d)]({}),_0x171aa4=BayBinSelected(_0x5b88c7['warehouse_name'],_0x5b88c7[_0x2de44c(0x190)]);if(_0x8d8828[0x0]['language']=='English\x20(US)'){var _0x778102=users[_0x2de44c(0x1e0)];console['log'](_0x778102);}else{if(_0x8d8828[0x0][_0x2de44c(0x213)]==_0x2de44c(0x1fe))var _0x778102=users[_0x2de44c(0x1fe)];else{if(_0x8d8828[0x0]['language']==_0x2de44c(0x1a5))var _0x778102=users['German'];else{if(_0x8d8828[0x0][_0x2de44c(0x213)]==_0x2de44c(0x1f5))var _0x778102=users[_0x2de44c(0x1f5)];else{if(_0x8d8828[0x0][_0x2de44c(0x213)]==_0x2de44c(0x279))var _0x778102=users['French'];else{if(_0x8d8828[0x0][_0x2de44c(0x213)]==_0x2de44c(0x1f1))var _0x778102=users['Portuguese'];else{if(_0x8d8828[0x0][_0x2de44c(0x213)]=='Chinese')var _0x778102=users[_0x2de44c(0x1c1)];else{if(_0x8d8828[0x0][_0x2de44c(0x213)]==_0x2de44c(0x24a))var _0x778102=users['Arabic'];}}}}}}}_0x70bf6b[_0x2de44c(0x1ea)]('edit_purchases_view',{'success':_0xa0918b[_0x2de44c(0x1b3)](_0x2de44c(0x25f)),'errors':_0xa0918b['flash']('errors'),'role':_0x5facbd,'profile':_0x291c23,'customer':_0x2f69ab,'warehouse':_0x41d115,'product':_0x52c8a4,'user':_0x5b88c7,'master_shop':_0x8d8828,'unit':_0x5ae94d,'language':_0x778102,'suppliers':_0x4974d6,'dataSelected':_0x171aa4});}catch(_0x4965a6){console[_0x2de44c(0x187)](_0x4965a6);}}),router[a0_0x2dfbeb(0x27e)]('/preview/:id',auth,async(_0x383ff7,_0x5998ce)=>{var _0x13a9d1=a0_0x2dfbeb;try{const _0x26b642=_0x383ff7[_0x13a9d1(0x1af)]['id'],{invoice:_0x35f4cb,warehouse_name:_0x921ba7,Room_name:_0x3ab09f}=_0x383ff7[_0x13a9d1(0x1bf)],_0x2abb24=await warehouse['findOne']({'name':_0x921ba7,'room':_0x3ab09f}),_0x21b874=await purchases[_0x13a9d1(0x184)]({'invoice':_0x35f4cb});_0x21b874[_0x13a9d1(0x1da)][_0x13a9d1(0x280)](_0x5771e3=>{var _0x447736=_0x13a9d1,_0x12f67f=0x0;const _0x4adc26=_0x2abb24['product_details'][_0x447736(0x282)](_0x49e4b1=>{var _0x5153b0=_0x447736;_0x49e4b1['product_name']==_0x5771e3['product_name']&&_0x49e4b1[_0x5153b0(0x1ca)]==_0x5771e3['floorlevel']&&_0x49e4b1[_0x5153b0(0x262)]==_0x5771e3[_0x5153b0(0x262)]&&_0x49e4b1[_0x5153b0(0x195)]==_0x5771e3['bin']&&_0x49e4b1[_0x5153b0(0x252)]==_0x5771e3[_0x5153b0(0x252)]&&_0x49e4b1[_0x5153b0(0x18e)]==_0x5771e3[_0x5153b0(0x18e)]&&_0x49e4b1[_0x5153b0(0x226)]==_0x5771e3[_0x5153b0(0x226)]&&_0x49e4b1[_0x5153b0(0x19c)]==_0x5771e3[_0x5153b0(0x19c)]&&_0x49e4b1[_0x5153b0(0x1a7)]==_0x5771e3[_0x5153b0(0x1a7)]&&_0x49e4b1['production_date']==_0x5771e3[_0x5153b0(0x22f)]&&_0x49e4b1[_0x5153b0(0x221)]==_0x5771e3[_0x5153b0(0x221)]&&_0x49e4b1[_0x5153b0(0x24c)]==_0x5771e3[_0x5153b0(0x24c)]&&(_0x49e4b1[_0x5153b0(0x297)]=parseInt(_0x49e4b1[_0x5153b0(0x297)])+parseInt(_0x5771e3[_0x5153b0(0x256)]),_0x12f67f++);});_0x12f67f=='0'&&(_0x2abb24[_0x447736(0x242)]=_0x2abb24['product_details'][_0x447736(0x1c4)]({'product_name':_0x5771e3[_0x447736(0x1ac)],'product_stock':_0x5771e3['quantity'],'primary_code':_0x5771e3[_0x447736(0x1ed)],'secondary_code':_0x5771e3[_0x447736(0x20e)],'product_code':_0x5771e3['product_code'],'storage':_0x5771e3[_0x447736(0x226)],'rack':_0x5771e3['rack'],'bay':_0x5771e3[_0x447736(0x252)],'bin':_0x5771e3[_0x447736(0x195)],'type':_0x5771e3[_0x447736(0x262)],'floorlevel':_0x5771e3[_0x447736(0x1ca)],'maxProducts':_0x5771e3['maxStocks'],'unit':_0x5771e3[_0x447736(0x25d)],'secondary_unit':_0x5771e3[_0x447736(0x1a6)],'expiry_date':_0x5771e3[_0x447736(0x19c)],'maxPerUnit':_0x5771e3['maxperunit'],'batch_code':_0x5771e3[_0x447736(0x1a7)],'alertQTY':_0x5771e3[_0x447736(0x1a3)],'production_date':_0x5771e3[_0x447736(0x22f)],'delivery_date':_0x5771e3[_0x447736(0x221)],'delivery_code':_0x5771e3[_0x447736(0x24c)]}));}),await _0x2abb24[_0x13a9d1(0x188)](),_0x21b874['finalize']=_0x13a9d1(0x29a);const _0x717095=await _0x21b874['save']();_0x383ff7[_0x13a9d1(0x1b3)](_0x13a9d1(0x25f),_0x13a9d1(0x239)),_0x5998ce[_0x13a9d1(0x28d)]('/all_purchases/view');}catch(_0x9dc207){console[_0x13a9d1(0x187)](_0x9dc207);}}),router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x277),auth,async(_0x94669c,_0x3a8dc4)=>{var _0x4a624b=a0_0x2dfbeb;try{const {username:_0x500c42,email:_0x2851c7,role:_0x1d9bae}=_0x94669c[_0x4a624b(0x29c)],_0x1f705a=_0x94669c[_0x4a624b(0x29c)],_0x6c6afb=await profile[_0x4a624b(0x184)]({'email':_0x1f705a[_0x4a624b(0x20d)]}),_0x284160=await master_shop[_0x4a624b(0x24d)](),_0x5dd2e6=_0x94669c[_0x4a624b(0x1af)]['id'],_0x18e666=await purchases[_0x4a624b(0x257)](_0x5dd2e6),_0x429518=await suppliers[_0x4a624b(0x24d)]({});let _0x5680f8;if(_0x1f705a['role']==_0x4a624b(0x1b9)){const _0x4ab76f=await staff[_0x4a624b(0x184)]({'email':_0x1f705a['email']});_0x5680f8=await warehouse[_0x4a624b(0x24d)]({'status':_0x4a624b(0x25e),'name':_0x4ab76f[_0x4a624b(0x225)],'warehouse_category':_0x4a624b(0x18d)});}else _0x5680f8=await warehouse['aggregate']([{'$match':{'status':_0x4a624b(0x25e),'warehouse_category':_0x4a624b(0x18d)}},{'$group':{'_id':_0x4a624b(0x25b),'name':{'$first':_0x4a624b(0x25b)}}}]);const _0x4ff010=await product[_0x4a624b(0x24d)]({}),_0x221b81=BayBinSelected(_0x18e666[_0x4a624b(0x1ae)],_0x18e666[_0x4a624b(0x190)]);let _0x306f79=new Date(_0x18e666['expiry_date']),_0x5a2bdd=('0'+_0x306f79[_0x4a624b(0x268)]())['slice'](-0x2),_0x29df3b=('0'+(_0x306f79['getMonth']()+0x1))['slice'](-0x2),_0x1c8158=_0x306f79[_0x4a624b(0x24b)](),_0x2dfadc=_0x1c8158+'-'+_0x29df3b+'-'+_0x5a2bdd;if(_0x284160[0x0][_0x4a624b(0x213)]=='English\x20(US)'){var _0x5028b6=users['English'];console[_0x4a624b(0x187)](_0x5028b6);}else{if(_0x284160[0x0]['language']=='Hindi')var _0x5028b6=users[_0x4a624b(0x1fe)];else{if(_0x284160[0x0][_0x4a624b(0x213)]==_0x4a624b(0x1a5))var _0x5028b6=users[_0x4a624b(0x1a5)];else{if(_0x284160[0x0][_0x4a624b(0x213)]==_0x4a624b(0x1f5))var _0x5028b6=users['Spanish'];else{if(_0x284160[0x0]['language']==_0x4a624b(0x279))var _0x5028b6=users[_0x4a624b(0x279)];else{if(_0x284160[0x0]['language']==_0x4a624b(0x1f1))var _0x5028b6=users['Portuguese'];else{if(_0x284160[0x0][_0x4a624b(0x213)]==_0x4a624b(0x1c1))var _0x5028b6=users[_0x4a624b(0x1c1)];else{if(_0x284160[0x0]['language']==_0x4a624b(0x24a))var _0x5028b6=users['Arabic'];}}}}}}}_0x3a8dc4[_0x4a624b(0x1ea)]('edit_purchases',{'success':_0x94669c[_0x4a624b(0x1b3)](_0x4a624b(0x25f)),'errors':_0x94669c['flash'](_0x4a624b(0x199)),'role':_0x1f705a,'profile':_0x6c6afb,'purchases':_0x18e666,'suppliers':_0x429518,'warehouse':_0x5680f8,'product':_0x4ff010,'master_shop':_0x284160,'language':_0x5028b6,'ed_fullDate':_0x2dfadc,'dataSelected':_0x221b81});}catch(_0x4ede48){console[_0x4a624b(0x187)](_0x4ede48);}}),router[a0_0x2dfbeb(0x27e)]('/view/:id',auth,async(_0x57b384,_0xe94775)=>{var _0x40bec7=a0_0x2dfbeb;try{const _0xa84521=_0x57b384['params']['id'],_0x9b509b=await purchases[_0x40bec7(0x184)]({'_id':_0x57b384[_0x40bec7(0x1af)]['id']}),_0x80348=await warehouse[_0x40bec7(0x184)]({'name':_0x9b509b['warehouse_name'],'room':_0x9b509b[_0x40bec7(0x190)]});_0x9b509b[_0x40bec7(0x1da)][_0x40bec7(0x280)](_0x6af017=>{var _0x32a57b=_0x40bec7;const _0x1edfcc=_0x80348['product_details'][_0x32a57b(0x282)](_0x1b1bb4=>{var _0x4a986b=_0x32a57b;_0x1b1bb4[_0x4a986b(0x1ac)]==_0x6af017['product_name']&&_0x1b1bb4['floorlevel']==_0x6af017[_0x4a986b(0x1ca)]&&_0x1b1bb4[_0x4a986b(0x262)]==_0x6af017['type']&&_0x1b1bb4['bin']==_0x6af017['bin']&&_0x1b1bb4[_0x4a986b(0x252)]==_0x6af017[_0x4a986b(0x252)]&&_0x1b1bb4[_0x4a986b(0x18e)]==_0x6af017['rack']&&_0x1b1bb4['storage']==_0x6af017['storage']&&(_0x1b1bb4[_0x4a986b(0x297)]=parseInt(_0x1b1bb4[_0x4a986b(0x297)])-parseInt(_0x6af017[_0x4a986b(0x256)]));});}),await _0x80348[_0x40bec7(0x188)]();const {invoice:_0x64bbaa,suppliers:_0x46b9ab,date:_0x2675b8,warehouse_name:_0x1c0ffa,prod_name:_0x425781,prod_code:_0x2f568d,prod_qty:_0x239685,prod_unit:_0x8f2acc,prod_secondunit:_0x533b51,prod_level:_0x139bd8,prod_isle:_0x57de6b,prod_pallet:_0x5a37af,note:_0x575d01,expiry_date:_0x3547ad,batch_code:_0x57a2cb,paid_amount:_0x48551f,due_amount:_0x270588,Room_name:_0x2fc927,primary_code:_0x548ed4,secondary_code:_0x3ca750,PO_number:_0x495bcf,JO_number:_0x4648f5}=_0x57b384[_0x40bec7(0x1bf)];if(typeof _0x425781==_0x40bec7(0x1b7))var _0x958497=[_0x57b384['body'][_0x40bec7(0x216)]],_0x1af962=[_0x57b384['body'][_0x40bec7(0x200)]],_0x3bf622=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x272)]],_0x2b9f44=[_0x57b384[_0x40bec7(0x1bf)]['prod_unit']],_0x88c18d=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x233)]],_0x5eb812=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x254)]],_0x102983=[_0x57b384[_0x40bec7(0x1bf)]['prod_isle']],_0x3298a6=[_0x57b384['body'][_0x40bec7(0x197)]],_0x3f69c=[_0x57b384[_0x40bec7(0x1bf)]['primary_code']],_0x43f795=[_0x57b384['body'][_0x40bec7(0x20e)]],_0x7af524=[_0x57b384['body']['MaxStocks_data']],_0x434bfa=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x1a7)]],_0x3e8832=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x19c)]],_0x52d0a8=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x226)]],_0x543b19=[_0x57b384['body'][_0x40bec7(0x1e7)]],_0x6b2bdc=[_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x262)]];else var _0x958497=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x216)]],_0x1af962=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x200)]],_0x3bf622=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x272)]],_0x2b9f44=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x274)]],_0x88c18d=[..._0x57b384['body'][_0x40bec7(0x233)]],_0x5eb812=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x254)]],_0x102983=[..._0x57b384['body'][_0x40bec7(0x28b)]],_0x3298a6=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x197)]],_0x3f69c=[..._0x57b384['body']['primary_code']],_0x43f795=[..._0x57b384['body'][_0x40bec7(0x20e)]],_0x7af524=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x205)]],_0x434bfa=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x1a7)]],_0x3e8832=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x19c)]],_0x52d0a8=[..._0x57b384[_0x40bec7(0x1bf)]['storage']],_0x543b19=[..._0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x1e7)]],_0x6b2bdc=[..._0x57b384['body'][_0x40bec7(0x262)]];const _0x33a4de=_0x958497['map'](_0x234e0f=>{return _0x234e0f={'product_name':_0x234e0f};});_0x1af962[_0x40bec7(0x280)]((_0xd06470,_0x5e0aba)=>{_0x33a4de[_0x5e0aba]['product_code']=_0xd06470;}),_0x3bf622['forEach']((_0x2258a9,_0x23cd91)=>{var _0x17f0a5=_0x40bec7;_0x33a4de[_0x23cd91][_0x17f0a5(0x256)]=_0x2258a9;}),_0x2b9f44[_0x40bec7(0x280)]((_0x446c2d,_0x5dcd57)=>{var _0x1713ab=_0x40bec7;_0x33a4de[_0x5dcd57][_0x1713ab(0x25d)]=_0x446c2d;}),_0x88c18d[_0x40bec7(0x280)]((_0x1d8a0,_0x524719)=>{var _0x1e2479=_0x40bec7;_0x33a4de[_0x524719][_0x1e2479(0x1a6)]=_0x1d8a0;}),_0x5eb812[_0x40bec7(0x280)]((_0xb777fa,_0x44d7b2)=>{var _0x2fccca=_0x40bec7;_0x33a4de[_0x44d7b2][_0x2fccca(0x252)]=_0xb777fa;}),_0x102983[_0x40bec7(0x280)]((_0x3582d9,_0x673183)=>{var _0x3f8cf2=_0x40bec7;_0x33a4de[_0x673183][_0x3f8cf2(0x195)]=_0x3582d9;}),_0x3298a6[_0x40bec7(0x280)]((_0x91e38d,_0x2fd6ec)=>{_0x33a4de[_0x2fd6ec]['floorlevel']=_0x91e38d;}),_0x3f69c[_0x40bec7(0x280)]((_0x4151a9,_0x36b586)=>{var _0x54a28e=_0x40bec7;_0x33a4de[_0x36b586][_0x54a28e(0x1ed)]=_0x4151a9;}),_0x43f795['forEach']((_0x257856,_0xb0d252)=>{var _0x7bb615=_0x40bec7;_0x33a4de[_0xb0d252][_0x7bb615(0x20e)]=_0x257856;}),_0x7af524[_0x40bec7(0x280)]((_0x4de7ae,_0xcefafb)=>{var _0xc524bf=_0x40bec7;_0x33a4de[_0xcefafb][_0xc524bf(0x1b4)]=_0x4de7ae;}),_0x434bfa[_0x40bec7(0x280)]((_0x5b99ed,_0x244be3)=>{var _0x1e46bb=_0x40bec7;_0x33a4de[_0x244be3][_0x1e46bb(0x1a7)]=_0x5b99ed;}),_0x3e8832[_0x40bec7(0x280)]((_0x5497f2,_0x4cb888)=>{var _0xebca4d=_0x40bec7;_0x33a4de[_0x4cb888][_0xebca4d(0x19c)]=_0x5497f2;}),_0x6b2bdc['forEach']((_0x50d08a,_0x1d85b6)=>{var _0x146678=_0x40bec7;_0x33a4de[_0x1d85b6][_0x146678(0x262)]=_0x50d08a;}),_0x52d0a8['forEach']((_0x1b2843,_0x1b323f)=>{var _0x27c339=_0x40bec7;_0x33a4de[_0x1b323f][_0x27c339(0x226)]=_0x1b2843;}),_0x543b19['forEach']((_0x29bfab,_0x3adf5f)=>{var _0x388eda=_0x40bec7;_0x33a4de[_0x3adf5f][_0x388eda(0x18e)]=_0x29bfab;});const _0x51a0e5=_0x33a4de[_0x40bec7(0x253)](_0xc451bd=>_0xc451bd[_0x40bec7(0x256)]!=='0'&&_0xc451bd['quantity']!=='');_0x9b509b[_0x40bec7(0x219)]=_0x64bbaa,_0x9b509b[_0x40bec7(0x27f)]=_0x46b9ab,_0x9b509b['date']=_0x2675b8,_0x9b509b[_0x40bec7(0x1ae)]=_0x1c0ffa,_0x9b509b[_0x40bec7(0x1da)]=_0x51a0e5,_0x9b509b[_0x40bec7(0x283)]=_0x575d01,_0x9b509b[_0x40bec7(0x23e)]=_0x48551f,_0x9b509b[_0x40bec7(0x1d4)]=_0x270588,_0x9b509b[_0x40bec7(0x190)]=_0x2fc927,_0x9b509b[_0x40bec7(0x27b)]=_0x495bcf,_0x9b509b['JO_number']=_0x4648f5;const _0x1afabe=await _0x9b509b[_0x40bec7(0x188)](),_0x4002b2=await warehouse[_0x40bec7(0x184)]({'name':_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x1ae)],'room':_0x57b384[_0x40bec7(0x1bf)]['Room_name']});_0x9b509b['product'][_0x40bec7(0x280)](_0x5cca65=>{var _0x1d49ea=_0x40bec7,_0x542982=0x0;const _0xe99bdb=_0x4002b2[_0x1d49ea(0x242)][_0x1d49ea(0x282)](_0x5e940b=>{var _0x375ea5=_0x1d49ea;_0x5e940b[_0x375ea5(0x1ac)]==_0x5cca65[_0x375ea5(0x1ac)]&&_0x5e940b[_0x375ea5(0x1ca)]==_0x5cca65[_0x375ea5(0x1ca)]&&_0x5e940b[_0x375ea5(0x262)]==_0x5cca65['type']&&_0x5e940b[_0x375ea5(0x195)]==_0x5cca65[_0x375ea5(0x195)]&&_0x5e940b['bay']==_0x5cca65[_0x375ea5(0x252)]&&_0x5e940b[_0x375ea5(0x18e)]==_0x5cca65[_0x375ea5(0x18e)]&&_0x5e940b[_0x375ea5(0x226)]==_0x5cca65[_0x375ea5(0x226)]&&(_0x5e940b[_0x375ea5(0x297)]=parseInt(_0x5e940b[_0x375ea5(0x297)])+parseInt(_0x5cca65[_0x375ea5(0x256)]),_0x542982++);});_0x542982=='0'&&(_0x4002b2['product_details']=_0x4002b2[_0x1d49ea(0x242)][_0x1d49ea(0x1c4)]({'product_name':_0x5cca65[_0x1d49ea(0x1ac)],'product_stock':_0x5cca65[_0x1d49ea(0x256)],'primary_code':_0x5cca65[_0x1d49ea(0x1ed)],'secondary_code':_0x5cca65[_0x1d49ea(0x20e)],'product_code':_0x5cca65[_0x1d49ea(0x299)],'storage':_0x5cca65[_0x1d49ea(0x226)],'rack':_0x5cca65['rack'],'bay':_0x5cca65['bay'],'bin':_0x5cca65[_0x1d49ea(0x195)],'type':_0x5cca65['type'],'floorlevel':_0x5cca65[_0x1d49ea(0x1ca)],'maxProducts':_0x5cca65[_0x1d49ea(0x1b4)],'unit':_0x5cca65['standard_unit'],'secondary_unit':_0x5cca65['secondary_unit'],'expiry_date':_0x5cca65['expiry_date']}));}),await _0x4002b2[_0x40bec7(0x188)]();const _0x5eef1a=await s_payment_data['findOne']({'invoice':_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x219)]});if(_0x5eef1a===null){}else console[_0x40bec7(0x187)](_0x40bec7(0x27f),_0x5eef1a,_0x57b384[_0x40bec7(0x1bf)][_0x40bec7(0x219)]),_0x5eef1a['suppliers']=_0x57b384['body']['suppliers'],await _0x5eef1a[_0x40bec7(0x188)]();_0x57b384[_0x40bec7(0x1b3)](_0x40bec7(0x25f),_0x40bec7(0x22d)),_0xe94775[_0x40bec7(0x28d)](_0x40bec7(0x1c8));}catch(_0x51877c){console[_0x40bec7(0x187)](_0x51877c);}}),router[a0_0x2dfbeb(0x27e)](a0_0x2dfbeb(0x1f4),auth,async(_0x311c71,_0x4b2057)=>{var _0x1904ae=a0_0x2dfbeb;try{const _0x1b8314=_0x311c71[_0x1904ae(0x1af)]['id'],{invoice:_0x1f39ac,suppliers:_0x181a7a,payable:_0x281a9b,due_amount:_0x29ad77}=_0x311c71['body'],_0x579ab3=await purchases[_0x1904ae(0x257)](_0x1b8314);var _0x229df1=_0x281a9b-_0x29ad77;_0x579ab3[_0x1904ae(0x23e)]=parseFloat(_0x579ab3[_0x1904ae(0x23e)])+parseFloat(_0x29ad77),_0x579ab3['due_amount']=_0x229df1;const _0x4a3c3e=await _0x579ab3[_0x1904ae(0x188)]();console[_0x1904ae(0x187)](_0x4a3c3e);const _0x34f84a=await s_payment_data[_0x1904ae(0x184)]({'invoice':_0x1f39ac});_0x34f84a[_0x1904ae(0x193)]=_0x229df1,await _0x34f84a[_0x1904ae(0x188)]();let _0x2147a=new Date(),_0x38289b=('0'+_0x2147a[_0x1904ae(0x268)]())[_0x1904ae(0x1cb)](-0x2),_0x7c093e=('0'+(_0x2147a[_0x1904ae(0x198)]()+0x1))[_0x1904ae(0x1cb)](-0x2),_0x285d70=_0x2147a[_0x1904ae(0x24b)](),_0x1831d8=_0x285d70+'-'+_0x7c093e+'-'+_0x38289b;const _0x1f0892=new suppliers_payment({'invoice':_0x1f39ac,'date':_0x285d70+'-'+_0x7c093e+'-'+_0x38289b,'suppliers':_0x181a7a,'reason':_0x1904ae(0x28c),'amount':_0x29ad77}),_0x5a97d2=await _0x1f0892[_0x1904ae(0x188)]();_0x311c71['flash'](_0x1904ae(0x25f),'payment\x20successfull'),_0x4b2057[_0x1904ae(0x28d)]('/all_purchases/view');}catch(_0x57e432){console[_0x1904ae(0x187)](_0x57e432);}}),router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x222),auth,async(_0x2fea94,_0x2424c8)=>{var _0x129d9d=a0_0x2dfbeb;try{const {username:_0x44011a,email:_0x1042f9,role:_0xd9bef5}=_0x2fea94[_0x129d9d(0x29c)],_0x4411a5=_0x2fea94[_0x129d9d(0x29c)],_0x21c868=await profile[_0x129d9d(0x184)]({'email':_0x4411a5['email']}),_0x50b9b3=await master_shop[_0x129d9d(0x24d)]();console[_0x129d9d(0x187)](_0x129d9d(0x22c),_0x50b9b3);const _0x38d826=_0x2fea94['params']['id'],_0x2f2e11=await purchases[_0x129d9d(0x257)](_0x38d826);console[_0x129d9d(0x187)](_0x2f2e11);const _0x3443e2=await suppliers['findOne']({'name':_0x2f2e11[_0x129d9d(0x27f)]});console[_0x129d9d(0x187)](_0x3443e2);if(_0x50b9b3[0x0][_0x129d9d(0x213)]==_0x129d9d(0x1c7)){var _0x55b39e=users[_0x129d9d(0x1e0)];console[_0x129d9d(0x187)](_0x55b39e);}else{if(_0x50b9b3[0x0][_0x129d9d(0x213)]=='Hindi')var _0x55b39e=users[_0x129d9d(0x1fe)];else{if(_0x50b9b3[0x0][_0x129d9d(0x213)]==_0x129d9d(0x1a5))var _0x55b39e=users[_0x129d9d(0x1a5)];else{if(_0x50b9b3[0x0][_0x129d9d(0x213)]=='Spanish')var _0x55b39e=users['Spanish'];else{if(_0x50b9b3[0x0][_0x129d9d(0x213)]==_0x129d9d(0x279))var _0x55b39e=users[_0x129d9d(0x279)];else{if(_0x50b9b3[0x0][_0x129d9d(0x213)]=='Portuguese\x20(BR)')var _0x55b39e=users[_0x129d9d(0x290)];else{if(_0x50b9b3[0x0][_0x129d9d(0x213)]==_0x129d9d(0x1c1))var _0x55b39e=users[_0x129d9d(0x1c1)];else{if(_0x50b9b3[0x0]['language']==_0x129d9d(0x24a))var _0x55b39e=users['Arabic'];}}}}}}}_0x2424c8[_0x129d9d(0x1ea)](_0x129d9d(0x23a),{'success':_0x2fea94[_0x129d9d(0x1b3)]('success'),'errors':_0x2fea94[_0x129d9d(0x1b3)](_0x129d9d(0x199)),'role':_0x4411a5,'profile':_0x21c868,'master_shop':_0x50b9b3,'supplier':_0x3443e2,'purchase':_0x2f2e11,'language':_0x55b39e});}catch(_0x1d9aa0){console['log'](_0x1d9aa0);}}),router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x217),auth,async(_0x1d8ebc,_0x1b42d8)=>{var _0x493c6b=a0_0x2dfbeb;try{const {username:_0x79d378,email:_0x328234,role:_0x51eb19}=_0x1d8ebc[_0x493c6b(0x29c)],_0x29c3e6=_0x1d8ebc[_0x493c6b(0x29c)],_0x38cad1=await profile[_0x493c6b(0x184)]({'email':_0x29c3e6[_0x493c6b(0x20d)]}),_0x2103ab=await master_shop['find']();console[_0x493c6b(0x187)](_0x493c6b(0x22c),_0x2103ab);const _0x1e23b0=_0x1d8ebc[_0x493c6b(0x1af)]['id'];console[_0x493c6b(0x187)](_0x1e23b0);const _0x59bb6c=await purchases[_0x493c6b(0x257)](_0x1e23b0);console[_0x493c6b(0x187)]('user_id',_0x59bb6c);const _0x348de6=await product[_0x493c6b(0x24d)]({}),_0x4237bb=await warehouse[_0x493c6b(0x1ee)]([{'$match':{'name':_0x59bb6c[_0x493c6b(0x1ae)],'room':_0x59bb6c[_0x493c6b(0x190)],'warehouse_category':_0x493c6b(0x18d)}},{'$unwind':_0x493c6b(0x1b8)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x493c6b(0x27d)},'product_stock':{'$first':_0x493c6b(0x22e)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x493c6b(0x28a)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x493c6b(0x28e)},'primary_code':{'$first':_0x493c6b(0x212)},'secondary_code':{'$first':_0x493c6b(0x1f7)},'product_code':{'$first':_0x493c6b(0x25a)},'storage':{'$first':_0x493c6b(0x1fc)},'rack':{'$first':_0x493c6b(0x207)}}}]);warehouse_data=await warehouse[_0x493c6b(0x1ee)]([{'$match':{'status':'Enabled','name':_0x493c6b(0x1fa),'warehouse_category':_0x493c6b(0x18d)}},{'$group':{'_id':_0x493c6b(0x25b),'name':{'$first':_0x493c6b(0x25b)}}},{'$sort':{'name':0x1}}]),console[_0x493c6b(0x187)](_0x493c6b(0x202),_0x4237bb);if(_0x2103ab[0x0][_0x493c6b(0x213)]==_0x493c6b(0x1c7)){var _0x5f44fa=users[_0x493c6b(0x1e0)];console[_0x493c6b(0x187)](_0x5f44fa);}else{if(_0x2103ab[0x0][_0x493c6b(0x213)]=='Hindi')var _0x5f44fa=users[_0x493c6b(0x1fe)];else{if(_0x2103ab[0x0][_0x493c6b(0x213)]==_0x493c6b(0x1a5))var _0x5f44fa=users[_0x493c6b(0x1a5)];else{if(_0x2103ab[0x0][_0x493c6b(0x213)]==_0x493c6b(0x1f5))var _0x5f44fa=users[_0x493c6b(0x1f5)];else{if(_0x2103ab[0x0][_0x493c6b(0x213)]==_0x493c6b(0x279))var _0x5f44fa=users[_0x493c6b(0x279)];else{if(_0x2103ab[0x0][_0x493c6b(0x213)]==_0x493c6b(0x1f1))var _0x5f44fa=users[_0x493c6b(0x290)];else{if(_0x2103ab[0x0][_0x493c6b(0x213)]==_0x493c6b(0x1c1))var _0x5f44fa=users[_0x493c6b(0x1c1)];else{if(_0x2103ab[0x0][_0x493c6b(0x213)]=='Arabic\x20(ae)')var _0x5f44fa=users[_0x493c6b(0x1f0)];}}}}}}}_0x1b42d8['render'](_0x493c6b(0x26b),{'success':_0x1d8ebc['flash'](_0x493c6b(0x25f)),'errors':_0x1d8ebc['flash'](_0x493c6b(0x199)),'role':_0x29c3e6,'profile':_0x38cad1,'user':_0x59bb6c,'stock':_0x4237bb,'master_shop':_0x2103ab,'product':_0x348de6,'language':_0x5f44fa,'warehouse':warehouse_data});}catch(_0xec85b3){console[_0x493c6b(0x187)](_0xec85b3);}}),router[a0_0x2dfbeb(0x27e)](a0_0x2dfbeb(0x217),auth,async(_0x5c467e,_0x3401ad)=>{var _0x1938a3=a0_0x2dfbeb;try{const {invoice:_0x5879f2,date:_0x4f7485,warehouse_name:_0x4ca741,Room_name:_0x33d9b9,product_name:_0x2e7582,purchase_quantity:_0x337307,stocks:_0x3107d2,return_qty:_0x5a3c3c,note:_0x477d9d,level:_0x59491a,isle:_0x1364bb,pallet:_0x264bf6,to_warehouse_name:_0x55528a,to_Room_name:_0x330d3a}=_0x5c467e[_0x1938a3(0x1bf)],_0x2d7ceb=await purchases[_0x1938a3(0x184)]({'_id':_0x5c467e[_0x1938a3(0x1af)]['id']}),_0x34bab4=await warehouse[_0x1938a3(0x184)]({'name':_0x4ca741,'room':_0x33d9b9});if(typeof _0x2e7582==_0x1938a3(0x1b7))var _0x2dca5c=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x1ac)]],_0xaf5c4d=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x1d9)]],_0x5d0b28=[_0x5c467e[_0x1938a3(0x1bf)]['stocks']],_0x2d9944=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x236)]],_0x2a4458=[_0x5c467e['body']['level']],_0x59c5c0=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x1bc)]],_0x208c9d=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x18f)]],_0x4473f1=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x21d)]],_0x2bb036=[_0x5c467e['body']['product_code_hide']],_0x3f3b4f=[_0x5c467e['body'][_0x1938a3(0x21f)]],_0x3d248d=[_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x240)]];else var _0x2dca5c=[..._0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x1ac)]],_0xaf5c4d=[..._0x5c467e['body'][_0x1938a3(0x1d9)]],_0x5d0b28=[..._0x5c467e[_0x1938a3(0x1bf)]['stocks']],_0x2d9944=[..._0x5c467e['body']['return_qty']],_0x2a4458=[..._0x5c467e[_0x1938a3(0x1bf)]['level']],_0x59c5c0=[..._0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x1bc)]],_0x208c9d=[..._0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x18f)]],_0x4473f1=[..._0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x21d)]],_0x2bb036=[..._0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x267)]],_0x3f3b4f=[..._0x5c467e['body']['primary_code_hide']],_0x3d248d=[..._0x5c467e[_0x1938a3(0x1bf)]['secondary_code_hide']];const _0xbef5f5=_0x2dca5c[_0x1938a3(0x282)](_0x11b765=>{return _0x11b765={'product_name':_0x11b765};});_0xaf5c4d[_0x1938a3(0x280)]((_0x6baf5,_0x4ba9b4)=>{_0xbef5f5[_0x4ba9b4]['purchase_quantity']=_0x6baf5;}),_0x5d0b28[_0x1938a3(0x280)]((_0x500185,_0x43118b)=>{_0xbef5f5[_0x43118b]['stock_quantity']=_0x500185;}),_0x2d9944['forEach']((_0x37730a,_0x4e3e6c)=>{var _0x482723=_0x1938a3;_0xbef5f5[_0x4e3e6c][_0x482723(0x236)]=_0x37730a;}),_0x2a4458[_0x1938a3(0x280)]((_0x5f06e4,_0x13ed0b)=>{var _0x59cc8f=_0x1938a3;_0xbef5f5[_0x13ed0b][_0x59cc8f(0x252)]=_0x5f06e4;}),_0x59c5c0['forEach']((_0x3eba4e,_0x1cd3cd)=>{var _0x186a6e=_0x1938a3;_0xbef5f5[_0x1cd3cd][_0x186a6e(0x195)]=_0x3eba4e;}),_0x208c9d[_0x1938a3(0x280)]((_0x53bb67,_0x12ab2)=>{var _0x44decc=_0x1938a3;_0xbef5f5[_0x12ab2][_0x44decc(0x1ca)]=_0x53bb67;}),_0x4473f1['forEach']((_0x2686e8,_0x5b4970)=>{_0xbef5f5[_0x5b4970]['type']=_0x2686e8;}),_0x2bb036[_0x1938a3(0x280)]((_0x36284b,_0x12ef42)=>{var _0x402ea3=_0x1938a3;_0xbef5f5[_0x12ef42][_0x402ea3(0x299)]=_0x36284b;}),_0x3f3b4f[_0x1938a3(0x280)]((_0xf2a49e,_0x31ae06)=>{var _0x485756=_0x1938a3;_0xbef5f5[_0x31ae06][_0x485756(0x1ed)]=_0xf2a49e;}),_0x3d248d['forEach']((_0x390832,_0x1e452f)=>{var _0x114847=_0x1938a3;_0xbef5f5[_0x1e452f][_0x114847(0x20e)]=_0x390832;}),_0x2d7ceb['product']['forEach'](_0x712103=>{const _0x55a93e=_0x34bab4['product_details']['map'](_0x108e66=>{var _0x18f02f=a0_0x42ce;_0x108e66['product_name']==_0x712103[_0x18f02f(0x1ac)]&&_0x108e66[_0x18f02f(0x1ca)]==_0x712103[_0x18f02f(0x1ca)]&&_0x108e66[_0x18f02f(0x262)]==_0x712103['type']&&_0x108e66[_0x18f02f(0x195)]==_0x712103[_0x18f02f(0x195)]&&_0x108e66[_0x18f02f(0x252)]==_0x712103[_0x18f02f(0x252)]&&_0x108e66[_0x18f02f(0x18e)]==_0x712103[_0x18f02f(0x18e)]&&_0x108e66['storage']==_0x712103[_0x18f02f(0x226)]&&(console[_0x18f02f(0x187)](parseInt(_0x108e66[_0x18f02f(0x297)])+'\x20<>\x20'+parseInt(_0x712103[_0x18f02f(0x256)])),_0x108e66[_0x18f02f(0x297)]=parseInt(_0x108e66['product_stock'])+parseInt(_0x712103[_0x18f02f(0x256)]));});}),await _0x34bab4[_0x1938a3(0x188)]();const _0x3492a5=_0xbef5f5[_0x1938a3(0x253)](_0x183360=>_0x183360[_0x1938a3(0x236)]!=='0'&&_0x183360[_0x1938a3(0x236)]!=='');var _0x297fe5=0x0;_0x3492a5[_0x1938a3(0x280)](_0x545f4b=>{var _0x595b04=_0x1938a3;console['log'](_0x595b04(0x23d),_0x545f4b),(parseInt(_0x545f4b[_0x595b04(0x1d9)])<parseInt(_0x545f4b['return_qty'])||parseInt(_0x545f4b[_0x595b04(0x289)])<parseInt(_0x545f4b[_0x595b04(0x236)]))&&_0x297fe5++;});if(_0x297fe5!=0x0)return _0x5c467e[_0x1938a3(0x1b3)](_0x1938a3(0x199),_0x1938a3(0x278)),_0x3401ad[_0x1938a3(0x28d)](_0x1938a3(0x1ad));const _0x35d95c=new purchases_return({'invoice':_0x5879f2,'suppliers':_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x27f)],'date':_0x4f7485,'warehouse_name':_0x4ca741,'return_product':_0x3492a5,'note':_0x477d9d,'room':_0x33d9b9,'to_warehouse_name':_0x55528a,'to_room':_0x330d3a}),_0x325eb0=await _0x35d95c[_0x1938a3(0x188)]();console[_0x1938a3(0x187)](_0x35d95c);const _0x38a32c=await purchases_return[_0x1938a3(0x184)]({'invoice':_0x5879f2}),_0x5143af=await warehouse[_0x1938a3(0x184)]({'name':_0x55528a,'room':_0x330d3a});_0x38a32c['return_product'][_0x1938a3(0x280)](_0x1f258b=>{var _0x1a0da7=_0x1938a3,_0x177d97=0x0;const _0x2be51b=_0x5143af[_0x1a0da7(0x242)]['map'](_0x320c5f=>{var _0x4da6bb=_0x1a0da7;_0x320c5f['product_name']==_0x1f258b['product_name']&&_0x320c5f[_0x4da6bb(0x1ca)]==_0x1f258b['floorlevel']&&_0x320c5f['type']==_0x1f258b[_0x4da6bb(0x262)]&&_0x320c5f[_0x4da6bb(0x195)]==_0x1f258b[_0x4da6bb(0x195)]&&_0x320c5f[_0x4da6bb(0x252)]==_0x1f258b[_0x4da6bb(0x252)]&&(_0x320c5f[_0x4da6bb(0x297)]=parseInt(_0x320c5f[_0x4da6bb(0x297)])-parseInt(_0x1f258b[_0x4da6bb(0x236)]),_0x177d97++);});_0x177d97=='0'&&(_0x5143af[_0x1a0da7(0x242)]=_0x5143af[_0x1a0da7(0x242)][_0x1a0da7(0x1c4)]({'product_name':_0x1f258b[_0x1a0da7(0x1ac)],'product_stock':_0x1f258b[_0x1a0da7(0x236)],'primary_code':_0x1f258b[_0x1a0da7(0x1ed)],'secondary_code':_0x1f258b[_0x1a0da7(0x20e)],'product_code':_0x1f258b[_0x1a0da7(0x299)],'storage':_0x1f258b['storage'],'rack':_0x1f258b[_0x1a0da7(0x18e)],'bay':_0x1f258b['bay'],'bin':_0x1f258b[_0x1a0da7(0x195)],'type':_0x1f258b[_0x1a0da7(0x262)],'floorlevel':_0x1f258b[_0x1a0da7(0x1ca)],'maxProducts':_0x1f258b[_0x1a0da7(0x1b4)],'unit':_0x1f258b['standard_unit'],'secondary_unit':_0x1f258b[_0x1a0da7(0x1a6)],'expiry_date':_0x1f258b['expiry_date']}));}),await _0x5143af[_0x1938a3(0x188)]();const _0x305b11=await purchases[_0x1938a3(0x184)]({'invoice':_0x5879f2});_0x305b11[_0x1938a3(0x218)]=_0x1938a3(0x29a);const _0x111d19=await _0x305b11[_0x1938a3(0x188)](),_0x17b3bc=new s_payment_data({'invoice':_0x5879f2,'suppliers':_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x27f)],'reason':_0x1938a3(0x1f3)});await _0x17b3bc[_0x1938a3(0x188)]();const _0x43a5d4=await master_shop[_0x1938a3(0x24d)]();console[_0x1938a3(0x187)]('add\x20post',_0x43a5d4[0x0][_0x1938a3(0x1b6)]);const _0x5a1818=await email_settings[_0x1938a3(0x184)](),_0x3c6848=await suppliers[_0x1938a3(0x184)]({'name':_0x5c467e[_0x1938a3(0x1bf)][_0x1938a3(0x27f)]});console['log'](_0x1938a3(0x1ef),_0x3c6848);_0x43a5d4[0x0]['currency_placement']==0x1?(right_currency=_0x43a5d4[0x0][_0x1938a3(0x295)],left_currency=''):(right_currency='',left_currency=_0x43a5d4[0x0][_0x1938a3(0x295)]);var _0x5b21f6=_0x2dca5c,_0x1fc305=_0x2d9944,_0x539b2f='',_0x27e13a;for(_0x27e13a in _0x5b21f6){_0x539b2f+='<tr>'+_0x1938a3(0x204)+_0x5b21f6[_0x27e13a]+_0x1938a3(0x211)+_0x1938a3(0x204)+_0x1fc305[_0x27e13a]+_0x1938a3(0x211)+'</tr>';}console['log']('product_list',_0x539b2f);let _0x14dcfa=nodemailer[_0x1938a3(0x1a1)]({'service':_0x1938a3(0x24e),'auth':{'user':_0x5a1818['email'],'pass':_0x5a1818['password']}}),_0x423d41={'from':_0x5a1818[_0x1938a3(0x20d)],'to':_0x3c6848[_0x1938a3(0x20d)],'subject':_0x1938a3(0x263),'attachments':[{'filename':_0x1938a3(0x245),'path':__dirname+_0x1938a3(0x1c2)+'/upload/'+_0x43a5d4[0x0]['image'],'cid':_0x1938a3(0x1b1)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x1938a3(0x234)+_0x1938a3(0x189)+_0x1938a3(0x234)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x1938a3(0x234)+'<h2>\x20'+_0x43a5d4[0x0][_0x1938a3(0x259)]+_0x1938a3(0x296)+_0x1938a3(0x1a0)+_0x1938a3(0x1a0)+_0x1938a3(0x21e)+_0x1938a3(0x234)+_0x1938a3(0x276)+'\x20Order\x20Number\x20:\x20'+_0x5879f2+'\x20'+_0x1938a3(0x275)+_0x1938a3(0x1d3)+_0x4f7485+'\x20'+_0x1938a3(0x203)+_0x1938a3(0x23b)+'</div>'+_0x1938a3(0x1ab)+_0x1938a3(0x1d0)+_0x1938a3(0x18a)+_0x1938a3(0x1d7)+_0x1938a3(0x27c)+_0x1938a3(0x1eb)+_0x1938a3(0x1bd)+_0x1938a3(0x258)+_0x1938a3(0x1cc)+_0x1938a3(0x293)+'\x20'+_0x539b2f+'\x20'+_0x1938a3(0x1c0)+_0x1938a3(0x1f8)+_0x1938a3(0x234)+_0x1938a3(0x210)+_0x1938a3(0x21c)+_0x43a5d4[0x0][_0x1938a3(0x259)]+_0x1938a3(0x23b)+'</div>'+_0x1938a3(0x1a0)+_0x1938a3(0x237)};_0x14dcfa[_0x1938a3(0x265)](_0x423d41,function(_0x16b12e,_0x357c3f){var _0x1fdd47=_0x1938a3;_0x16b12e?(console[_0x1fdd47(0x187)](_0x16b12e),console[_0x1fdd47(0x187)](_0x1fdd47(0x244))):console[_0x1fdd47(0x187)]('Email\x20sent\x20successfully');}),_0x5c467e[_0x1938a3(0x1b3)](_0x1938a3(0x25f),_0x1938a3(0x260)),_0x3401ad[_0x1938a3(0x28d)](_0x1938a3(0x1c8));}catch(_0x266822){console[_0x1938a3(0x187)](_0x266822),_0x3401ad[_0x1938a3(0x266)](0xc8)[_0x1938a3(0x28f)]({'message':_0x266822[_0x1938a3(0x1c9)]});}}),router[a0_0x2dfbeb(0x1f6)](a0_0x2dfbeb(0x229),auth,async(_0x3a0720,_0x45805c)=>{var _0x474a4b=a0_0x2dfbeb;try{const {username:_0x27b849,email:_0x820290,role:_0x265e4f}=_0x3a0720['user'],_0x460141=_0x3a0720[_0x474a4b(0x29c)],_0x1b5f71=await profile['findOne']({'email':_0x460141[_0x474a4b(0x20d)]}),_0x4bbf94=await master_shop[_0x474a4b(0x24d)](),_0xe8614=_0x3a0720['params']['id'],_0x5d0bed=await purchases[_0x474a4b(0x257)](_0xe8614);if(_0x4bbf94[0x0]['language']==_0x474a4b(0x1c7))var _0xd0c056=users[_0x474a4b(0x1e0)];else{if(_0x4bbf94[0x0]['language']=='Hindi')var _0xd0c056=users[_0x474a4b(0x1fe)];else{if(_0x4bbf94[0x0]['language']==_0x474a4b(0x1a5))var _0xd0c056=users[_0x474a4b(0x1a5)];else{if(_0x4bbf94[0x0][_0x474a4b(0x213)]==_0x474a4b(0x1f5))var _0xd0c056=users[_0x474a4b(0x1f5)];else{if(_0x4bbf94[0x0][_0x474a4b(0x213)]==_0x474a4b(0x279))var _0xd0c056=users[_0x474a4b(0x279)];else{if(_0x4bbf94[0x0]['language']==_0x474a4b(0x1f1))var _0xd0c056=users[_0x474a4b(0x290)];else{if(_0x4bbf94[0x0][_0x474a4b(0x213)]==_0x474a4b(0x1c1))var _0xd0c056=users['Chinese'];else{if(_0x4bbf94[0x0][_0x474a4b(0x213)]==_0x474a4b(0x24a))var _0xd0c056=users['Arabic'];}}}}}}}_0x45805c[_0x474a4b(0x1ea)](_0x474a4b(0x227),{'success':_0x3a0720[_0x474a4b(0x1b3)](_0x474a4b(0x25f)),'errors':_0x3a0720[_0x474a4b(0x1b3)](_0x474a4b(0x199)),'role':_0x460141,'profile':_0x1b5f71,'alldata':_0x5d0bed,'master_shop':_0x4bbf94,'language':_0xd0c056}),console[_0x474a4b(0x187)](alldata);}catch(_0x1174cc){console['log'](_0x1174cc);}}),router[a0_0x2dfbeb(0x27e)]('/barcode_scanner',async(_0x3dfe70,_0x1b3779)=>{var _0x5afd01=a0_0x2dfbeb;const {product_code:_0x4dbb98}=_0x3dfe70['body'];var _0xb57d96;const _0x1008f6=await product[_0x5afd01(0x1ee)]([{'$match':{'primary_code':_0x4dbb98,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x5afd01(0x232),'name':{'$first':_0x5afd01(0x25b)},'category':{'$first':'$category'},'brand':{'$first':_0x5afd01(0x1e4)},'unit':{'$first':_0x5afd01(0x196)},'alertquantity':{'$first':_0x5afd01(0x201)},'product_code':{'$first':_0x5afd01(0x26e)},'primary_code':{'$first':_0x5afd01(0x1e1)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x5afd01(0x298)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0xa56298=await product['aggregate']([{'$match':{'secondary_code':_0x4dbb98,'product_category':_0x5afd01(0x18d)}},{'$group':{'_id':_0x5afd01(0x232),'name':{'$first':'$name'},'category':{'$first':'$category'},'brand':{'$first':_0x5afd01(0x1e4)},'unit':{'$first':_0x5afd01(0x196)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x5afd01(0x1e1)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x5afd01(0x26f)},'maxProdPerUnit':{'$first':_0x5afd01(0x298)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5afd01(0x1e8)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1008f6[_0x5afd01(0x1a8)]>0x0)_0xb57d96=_0x1008f6;else _0xa56298[_0x5afd01(0x1a8)]>0x0&&(_0xb57d96=_0xa56298);_0x1b3779['json'](_0xb57d96);}),router[a0_0x2dfbeb(0x27e)](a0_0x2dfbeb(0x22a),async(_0x11033b,_0x5717b0)=>{var _0x12026d=a0_0x2dfbeb;const {primaryCode:_0x58ed23,secondaryCode:_0x3b95b3,productCode:_0x458642,bay:_0x328aec,bin:_0x320462,types:_0x588e0f,pallet:_0x4c8185,warehouses:_0x1b67e7,room:_0x114bda}=_0x11033b[_0x12026d(0x1bf)];console[_0x12026d(0x187)](_0x11033b['body']);try{const _0x50bf71=await warehouse[_0x12026d(0x1ee)]([{'$match':{'name':_0x1b67e7,'room':_0x114bda}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x328aec,'product_details.bin':_0x320462,'product_details.type':_0x588e0f}},{'$group':{'_id':_0x12026d(0x1e5),'name':{'$first':_0x12026d(0x27d)},'product_stock':{'$first':_0x12026d(0x22e)},'level':{'$first':_0x12026d(0x1c5)},'isle':{'$first':_0x12026d(0x255)},'pallet':{'$first':_0x12026d(0x1c3)},'maxProducts':{'$first':_0x12026d(0x1e3)}}}]);_0x5717b0['status'](0xc8)[_0x12026d(0x28f)](_0x50bf71);}catch(_0x4b1fb7){_0x5717b0[_0x12026d(0x266)](0x194)[_0x12026d(0x28f)]({'message':_0x4b1fb7['message']});}}),module[a0_0x2dfbeb(0x26d)]=router;