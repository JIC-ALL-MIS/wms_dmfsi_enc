var a0_0x2d9e43=a0_0x4224;(function(_0x187284,_0xdbf23e){var _0x1b5708=a0_0x4224,_0xfb556c=_0x187284();while(!![]){try{var _0x202123=-parseInt(_0x1b5708(0x1d8))/0x1+-parseInt(_0x1b5708(0x237))/0x2+parseInt(_0x1b5708(0x224))/0x3*(parseInt(_0x1b5708(0x25f))/0x4)+-parseInt(_0x1b5708(0x1c4))/0x5*(-parseInt(_0x1b5708(0x264))/0x6)+parseInt(_0x1b5708(0x206))/0x7+-parseInt(_0x1b5708(0x1de))/0x8*(-parseInt(_0x1b5708(0x2a1))/0x9)+-parseInt(_0x1b5708(0x1c7))/0xa;if(_0x202123===_0xdbf23e)break;else _0xfb556c['push'](_0xfb556c['shift']());}catch(_0x124590){_0xfb556c['push'](_0xfb556c['shift']());}}}(a0_0x2653,0x823f6));function a0_0x2653(){var _0x3e5309=['product_cat','Portuguese\x20(BR)','floorlevel','paid_amount','Arabic\x20(ae)','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','RoomAssign','error','Rack\x20E','Enabled','nodemailer','Ambient','product_details','purchase_quantity','bin','$product_details.product_code','prod_code','6833127WFKtRh','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/view','$product_details.product_name','$maxProdPerUnit','/view/return_purchase/:id','Spanish','/upload/','prod_primunit','errors','$unit','$suppliers_docs','</tr>','prod_cat','Sales\x20Update\x20successfully','prod_pallet','/give_payment/:id','catch','$product','prod_name','type','quantity','</tbody>','$product_details.rack','$product_details.pallet','purchases\x20item\x20return\x20successfull','add\x20post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_unit','secondary_code','289404XNuahf','forEach','$_id','actual_qty','delivery_code','success','English\x20(US)','$product.floorlevel','$product_details.secondary_code','aggregate','</thead>','room','Portuguese','<div>','product_code_hide','/../public','room_name','<h5>','log','90018YbJhfS','name','warehouse_name','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','pallet','$finalize','return_qty','types','all','There\x27s\x20a\x20error\x20in\x20this\x20transaction','batch_code','currency','sendMail','filter','$product_details.floorlevel','json','\x20</h2>','edit_purchases_view','Hindi','body','</h5>','prod_isle','$warehouse_name','German','$product_details.expiry_date','$maxStocks','site_title','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_qty','<hr\x20class=\x22my-3\x22>','<h5\x20style=\x22text-align:\x20left;\x22>','$category','role','finalize','\x20<\x20wew\x20>\x20','</head><body>','alertQTY','prod_Qty','user','12vnpowv','primary_code_hide','amount','$product.type','$paid_amount','888390pLXuav','redirect','<tr>','standard_unit','</div>','POnumber','length','production_date','find','getMonth','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','$product.quantity','An\x20error\x20occurred\x20while\x20saving\x20data.','French','<!DOCTYPE\x20html>','suppliers_data','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','stock_data','$alertquantity','padStart','$product.bin','$note','Room_name','$expiry_date','Chinese','\x20<>\x20','findOne','$product.bay','$name','getFullYear','$product_details._id','language','$secondary_unit','post','Floor','MaxStocks_data','prod_invoice','maxStocks','<strong>\x20Regards\x20</strong>','slice','</td>','Raw\x20Materials','INC-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.bay','<h2>\x20','all_purchases','push','$invoice','gmail','return_product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Receiving\x20Area','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','staff','exports','invoice','expiry_date','render','4622607lENoCC','</body></html>','delivery_date','$product_details.type','product_list','Purchase\x20Return','../models/all_models','storage','prod_level','Rack\x20F','message','$product_details.level','Purchase\x20Return\x20Mail','Purchase\x20Mail','$suppliers','level','max_product_unit','map','Rack\x20B','prod_secondunit','$product_details.bin','</table>','RMSEmail','flash','/all_purchases/view','path','$return_data','$primary_code','secondary_code_hide','createTransport','suppliers_docs','COLD\x20STORAGE','Error\x20Occurs','English','params','stocks','\x20Order\x20Date\x20:\x20','Paid\x20For\x20Purchase','master','suppliers','$product_details.product_stock','product_name','due_amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Rack\x20C','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','bay','Email\x20sent\x20successfully','product_code','$product_details.primary_code','Arabic','string','35oTAkeL','JO_number','</span>','13244670FTIdgL','warehouse','logo','Level','findById','actual_uom','$room','\x20Order\x20Number\x20:\x20','product','secondary_unit','Return\x20Goods','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','purchase_invoice','get','email','<span\x20style=\x22float:\x20right;\x22>','$secondary_code','912673OJFfxb','status','maxperunit','payment\x20successfull','../public/language/languages.json','$product_details.isle','8XnMbXT','purchase\x20data\x20update\x20successfully','../middleware/auth','concat','Rack\x20D','Shelves','/CheckingWarehouse','/preview/:id','image','return_data','product_stock','rak','user_id','$due_amount','/view/add_purchases','rack','primary_code','$product_code','save','isle','True','$product_details','/barcode_scanner'];a0_0x2653=function(){return _0x3e5309;};return a0_0x2653();}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2d9e43(0x2a7)),auth=require(a0_0x2d9e43(0x1e0)),nodemailer=require(a0_0x2d9e43(0x1ff));var ejs=require('ejs');const path=require(a0_0x2d9e43(0x1a9)),users=require(a0_0x2d9e43(0x1dc));function a0_0x4224(_0x1cedd9,_0x1d28d8){var _0x2653c8=a0_0x2653();return a0_0x4224=function(_0x42247e,_0x4f749a){_0x42247e=_0x42247e-0x199;var _0x228dba=_0x2653c8[_0x42247e];return _0x228dba;},a0_0x4224(_0x1cedd9,_0x1d28d8);}router['get'](a0_0x2d9e43(0x208),auth,async(_0x3ec60b,_0x23582c)=>{var _0x5f2a7c=a0_0x2d9e43;try{const {username:_0x2bfeee,email:_0x10561d,role:_0x43a656}=_0x3ec60b['user'],_0x5c4df0=_0x3ec60b[_0x5f2a7c(0x25e)],_0x2bdb80=await profile[_0x5f2a7c(0x27f)]({'email':_0x5c4df0[_0x5f2a7c(0x1d5)]}),_0x4966fc=await staff[_0x5f2a7c(0x27f)]({'email':_0x5c4df0[_0x5f2a7c(0x1d5)]});if(_0x5c4df0[_0x5f2a7c(0x258)]=='staff'){const _0x4b5970=await staff['findOne']({'email':_0x5c4df0['email']});}const _0x38d3dd=await master_shop[_0x5f2a7c(0x26c)]();let _0x3c8b61;if(_0x5c4df0[_0x5f2a7c(0x258)]==_0x5f2a7c(0x29c)){const _0x112121=await staff[_0x5f2a7c(0x27f)]({'email':_0x5c4df0['email']});_0x3c8b61=await purchases[_0x5f2a7c(0x22d)]([{'$match':{'warehouse_name':_0x112121[_0x5f2a7c(0x1c8)]}},{'$lookup':{'from':_0x5f2a7c(0x1b7),'localField':_0x5f2a7c(0x1b7),'foreignField':_0x5f2a7c(0x238),'as':'suppliers_docs'}},{'$unwind':_0x5f2a7c(0x211)},{'$unwind':_0x5f2a7c(0x218)},{'$group':{'_id':_0x5f2a7c(0x226),'invoice':{'$first':_0x5f2a7c(0x296)},'suppliers':{'$first':_0x5f2a7c(0x19e)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5f2a7c(0x24e)},'room':{'$first':_0x5f2a7c(0x1cd)},'product':{'$push':_0x5f2a7c(0x218)},'note':{'$first':_0x5f2a7c(0x27a)},'paid_amount':{'$first':_0x5f2a7c(0x263)},'due_amount':{'$first':_0x5f2a7c(0x1eb)},'return_data':{'$first':_0x5f2a7c(0x1aa)},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x5f2a7c(0x27c)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x5f2a7c(0x279)},'type':{'$addToSet':_0x5f2a7c(0x262)},'floorlevel':{'$addToSet':_0x5f2a7c(0x22b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x3c8b61=await purchases['aggregate']([{'$lookup':{'from':_0x5f2a7c(0x1b7),'localField':'suppliers','foreignField':_0x5f2a7c(0x238),'as':_0x5f2a7c(0x1ae)}},{'$unwind':_0x5f2a7c(0x211)},{'$unwind':_0x5f2a7c(0x218)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5f2a7c(0x296)},'suppliers':{'$first':_0x5f2a7c(0x19e)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5f2a7c(0x24e)},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x5f2a7c(0x218)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x5f2a7c(0x263)},'due_amount':{'$first':_0x5f2a7c(0x1eb)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x5f2a7c(0x211)},'total_product_quantity':{'$sum':_0x5f2a7c(0x26f)},'level':{'$addToSet':_0x5f2a7c(0x280)},'isle':{'$addToSet':_0x5f2a7c(0x279)},'type':{'$addToSet':_0x5f2a7c(0x262)},'floorlevel':{'$addToSet':_0x5f2a7c(0x22b)},'finalize':{'$first':_0x5f2a7c(0x23d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x38d3dd[0x0]['language']=='English\x20(US)'){var _0x49851f=users['English'];console[_0x5f2a7c(0x236)](_0x49851f);}else{if(_0x38d3dd[0x0]['language']==_0x5f2a7c(0x24a))var _0x49851f=users['Hindi'];else{if(_0x38d3dd[0x0]['language']=='German')var _0x49851f=users['German'];else{if(_0x38d3dd[0x0][_0x5f2a7c(0x284)]==_0x5f2a7c(0x20c))var _0x49851f=users[_0x5f2a7c(0x20c)];else{if(_0x38d3dd[0x0][_0x5f2a7c(0x284)]==_0x5f2a7c(0x271))var _0x49851f=users[_0x5f2a7c(0x271)];else{if(_0x38d3dd[0x0][_0x5f2a7c(0x284)]==_0x5f2a7c(0x1f6))var _0x49851f=users['Portuguese'];else{if(_0x38d3dd[0x0]['language']==_0x5f2a7c(0x27d))var _0x49851f=users['Chinese'];else{if(_0x38d3dd[0x0]['language']==_0x5f2a7c(0x1f9))var _0x49851f=users['Arabic'];}}}}}}}_0x23582c[_0x5f2a7c(0x2a0)](_0x5f2a7c(0x294),{'success':_0x3ec60b[_0x5f2a7c(0x1a7)](_0x5f2a7c(0x229)),'errors':_0x3ec60b[_0x5f2a7c(0x1a7)](_0x5f2a7c(0x20f)),'purchases':_0x3c8b61,'role':_0x5c4df0,'profile':_0x2bdb80,'master_shop':_0x38d3dd,'language':_0x49851f});}catch(_0x1347b4){console[_0x5f2a7c(0x236)]('table\x20page',_0x1347b4),_0x23582c['status'](0xc8)['json']({'message':_0x1347b4[_0x5f2a7c(0x19a)]});}});function BayBinSelected(_0x4cace0,_0x5f3673){var _0xe7be33=a0_0x2d9e43,_0x56bca7=[],_0x5d4787=[],_0x49ccaa=[],_0x39b217=[],_0x119e2c=[],_0x3ca9e2=[];let _0x2640f0=[];if(_0x4cace0=='DRY\x20STORAGE')switch(_0x5f3673){case'Rack\x20A':_0x56bca7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x5d4787=[0x1,0x2],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=[_0xe7be33(0x1ca),'Floor'],_0x119e2c=['D'],_0x3ca9e2=['A'];break;case'Rack\x20B':_0x56bca7=[0x6,0x5,0x4,0x3,0x2,0x1],_0x5d4787=[0x1,0x2],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=[_0xe7be33(0x1ca),'Floor'],_0x119e2c=['D'],_0x3ca9e2=['B'];break;case _0xe7be33(0x1e3):_0x56bca7=[0x0],_0x5d4787=[0x0],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=['Floor'],_0x119e2c=['D'],_0x3ca9e2=['S'];break;case _0xe7be33(0x29a):_0x56bca7=[0x0],_0x5d4787=[0x0],_0x39b217=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x49ccaa=[_0xe7be33(0x287)],_0x119e2c=['D'],_0x3ca9e2=['R'];break;}else{if(_0x4cace0==_0xe7be33(0x1af))switch(_0x5f3673){case'Rack\x20A':_0x56bca7=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x5d4787=['B','F'],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=[_0xe7be33(0x1ca),_0xe7be33(0x287)],_0x119e2c=['C'],_0x3ca9e2=['A'];break;case _0xe7be33(0x1a2):_0x56bca7=[0x5,0x4,0x3,0x2,0x1],_0x5d4787=['F','B','S'],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=['Level',_0xe7be33(0x287)],_0x119e2c=['C'],_0x3ca9e2=['B'];break;case _0xe7be33(0x1bc):_0x56bca7=[0x1,0x2,0x3,0x4,0x5],_0x5d4787=['B','F','S'],_0x39b217=[0x5,0x4,0x3,0x2,0x1],_0x49ccaa=[_0xe7be33(0x1ca),'Floor'],_0x119e2c=['C'],_0x3ca9e2=['C'];break;case _0xe7be33(0x1e2):_0x56bca7=[0x5,0x4,0x3,0x2,0x1],_0x5d4787=['F','B','S'],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=['Level',_0xe7be33(0x287)],_0x119e2c=['C'],_0x3ca9e2=['D'];break;case _0xe7be33(0x1fd):_0x56bca7=[0x4,0x3,0x2,0x1],_0x5d4787=[0x1,0x2],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=['Level',_0xe7be33(0x287)],_0x119e2c=['C'],_0x3ca9e2=['E'];break;case _0xe7be33(0x199):_0x56bca7=[0x1,0x2,0x3],_0x5d4787=[0x1,0x2],_0x39b217=[0x1,0x2,0x3,0x4,0x5],_0x49ccaa=['Level'],_0x119e2c=['C'],_0x3ca9e2=['F'];break;}}return{'levels':_0x56bca7,'Isle':_0x5d4787,'rack':_0x39b217,'type':_0x49ccaa,'storage':_0x119e2c,'rak':_0x3ca9e2};}async function getRandom8DigitNumber(){var _0x3b1f4a=a0_0x2d9e43;const _0x5a7d56=0x989680,_0x109c90=0x5f5e0ff,_0x558fcd=Math['floor'](Math['random']()*(_0x109c90-_0x5a7d56+0x1))+_0x5a7d56;var _0x2fcf0b;const _0x5c584f=await purchases[_0x3b1f4a(0x27f)]({'invoice':_0x3b1f4a(0x28f)+_0x558fcd});return _0x5c584f&&_0x5c584f['length']>0x0?_0x2fcf0b=_0x3b1f4a(0x28f)+_0x558fcd:_0x2fcf0b='INC-'+_0x558fcd,_0x2fcf0b;}router[a0_0x2d9e43(0x1d4)](a0_0x2d9e43(0x1ec),auth,async(_0x17a409,_0x3bdb75)=>{var _0xd7e457=a0_0x2d9e43;try{const {username:_0x22f4ac,email:_0x219ee1,role:_0xb1e863}=_0x17a409['user'],_0x3fedd4=_0x17a409[_0xd7e457(0x25e)],_0x544468=await profile['findOne']({'email':_0x3fedd4[_0xd7e457(0x1d5)]}),_0x50d9e2=await master_shop[_0xd7e457(0x26c)](),_0x335dc4=await staff[_0xd7e457(0x27f)]({'email':_0x3fedd4[_0xd7e457(0x1d5)]}),_0x3f973a=await suppliers[_0xd7e457(0x26c)]({});let _0x46509f;if(_0x3fedd4['role']==_0xd7e457(0x29c)){const _0x5f3b39=await staff[_0xd7e457(0x27f)]({'email':_0x3fedd4[_0xd7e457(0x1d5)]});_0x46509f=await warehouse[_0xd7e457(0x22d)]([{'$match':{'status':_0xd7e457(0x1fe),'name':_0x5f3b39[_0xd7e457(0x1c8)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0xd7e457(0x1d1)}}},{'$group':{'_id':_0xd7e457(0x281),'name':{'$first':_0xd7e457(0x281)}}}]);}else _0x46509f=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0xd7e457(0x28e),'name':{'$ne':_0xd7e457(0x1d1)}}},{'$group':{'_id':_0xd7e457(0x281),'name':{'$first':_0xd7e457(0x281)}}}]);const _0x8c7fae=await product[_0xd7e457(0x26c)]({}),_0x4be2c8=await warehouse[_0xd7e457(0x26c)]({'status':'Enabled'}),_0x8b3c1e=await purchases[_0xd7e457(0x26c)]({}),_0x4c4de0=_0x8b3c1e[_0xd7e457(0x26a)]+0x1,_0x246f38=_0xd7e457(0x28f)+_0x4c4de0['toString']()[_0xd7e457(0x278)](0x5,'0');var _0x2571f3=[_0xd7e457(0x200),'Enclosed'];if(_0x50d9e2[0x0][_0xd7e457(0x284)]==_0xd7e457(0x22a))var _0x11c76c=users['English'];else{if(_0x50d9e2[0x0][_0xd7e457(0x284)]==_0xd7e457(0x24a))var _0x11c76c=users['Hindi'];else{if(_0x50d9e2[0x0]['language']==_0xd7e457(0x24f))var _0x11c76c=users[_0xd7e457(0x24f)];else{if(_0x50d9e2[0x0]['language']==_0xd7e457(0x20c))var _0x11c76c=users[_0xd7e457(0x20c)];else{if(_0x50d9e2[0x0]['language']==_0xd7e457(0x271))var _0x11c76c=users['French'];else{if(_0x50d9e2[0x0]['language']==_0xd7e457(0x1f6))var _0x11c76c=users[_0xd7e457(0x230)];else{if(_0x50d9e2[0x0][_0xd7e457(0x284)]==_0xd7e457(0x27d))var _0x11c76c=users[_0xd7e457(0x27d)];else{if(_0x50d9e2[0x0][_0xd7e457(0x284)]==_0xd7e457(0x1f9))var _0x11c76c=users[_0xd7e457(0x1c2)];}}}}}}}const _0x119b66=getRandom8DigitNumber();_0x119b66['then'](_0x171c21=>{var _0x41ccd6=_0xd7e457;_0x3bdb75[_0x41ccd6(0x2a0)]('add_purchases',{'success':_0x17a409[_0x41ccd6(0x1a7)](_0x41ccd6(0x229)),'errors':_0x17a409[_0x41ccd6(0x1a7)](_0x41ccd6(0x20f)),'role':_0x3fedd4,'profile':_0x544468,'suppliers':_0x3f973a,'warehouse':_0x46509f,'product':_0x8c7fae,'invoice':_0x171c21,'master_shop':_0x50d9e2,'language':_0x11c76c,'find_data':_0x4be2c8,'rooms_data':_0x2571f3});})[_0xd7e457(0x217)](_0x5375c2=>{var _0x233bb3=_0xd7e457;_0x17a409['flash'](_0x233bb3(0x20f),_0x233bb3(0x241)),_0x3bdb75[_0x233bb3(0x265)](_0x233bb3(0x1a8));});}catch(_0x1653cb){console[_0xd7e457(0x236)](_0x1653cb);}}),router[a0_0x2d9e43(0x1d4)]('/view/add_purchases/:id',auth,async(_0x5719b9,_0x476d7c)=>{var _0x192541=a0_0x2d9e43;try{const _0x1716ee=_0x5719b9['params']['id'];console[_0x192541(0x236)](_0x1716ee);const _0x6aabf8=await master_shop['find']();console[_0x192541(0x236)](_0x192541(0x1b6),_0x6aabf8);const _0x144222=await product[_0x192541(0x27f)]({'name':_0x1716ee});console['log'](_0x192541(0x1cf),_0x144222),_0x476d7c[_0x192541(0x1d9)](0xc8)['json']({'product_data':_0x144222,'master':_0x6aabf8});}catch(_0x5a5b4e){console[_0x192541(0x236)]('add_purchases\x20error',_0x5a5b4e);}}),router['post'](a0_0x2d9e43(0x1ec),auth,async(_0x4c27b4,_0x282802)=>{var _0x5a3316=a0_0x2d9e43;try{const {invoice:_0x5eb276,date:_0x1fd423,warehouse_name:_0x25cf46,prod_name:_0x28ed4b,prod_code:_0x3db072,prod_qty:_0x5e606f,prod_unit:_0x103bf5,prod_secondunit:_0x574e35,prod_level:_0x269b30,prod_isle:_0x546f74,prod_pallet:_0x5e4d98,note:_0x257740,expiry_date:_0x57bca0,batch_code:_0x2f8fec,payable:_0x139b61,due_amount:_0xdbbd19,Room_name:_0x43b964,primary_code:_0xe98e66,secondary_code:_0x1974b2,MaxStocks_data:_0x275967,PO_number:_0x31e4d9,SCRN:_0x8aa265,JO_number:_0x2f531c}=_0x4c27b4[_0x5a3316(0x24b)];if(typeof _0x28ed4b==_0x5a3316(0x1c3))var _0x3ba2d7=[_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x219)]],_0x4df141=[_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x205)]],_0x3f0388=[_0x4c27b4[_0x5a3316(0x24b)]['prod_Qty']],_0x564a12=[_0x4c27b4['body']['prod_primunit']],_0x2339b4=[_0x4c27b4['body'][_0x5a3316(0x1a3)]],_0x5800cf=[_0x4c27b4['body'][_0x5a3316(0x2a9)]],_0x382b57=[_0x4c27b4['body'][_0x5a3316(0x1ee)]],_0x1c21d0=[_0x4c27b4['body'][_0x5a3316(0x223)]],_0x51be6f=[_0x4c27b4[_0x5a3316(0x24b)]['MaxStocks_data']],_0x5aeaf9=[_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x242)]],_0x2339cc=[_0x4c27b4[_0x5a3316(0x24b)]['expiry_date']],_0x393c3c=[_0x4c27b4[_0x5a3316(0x24b)]['max_product_unit']],_0x31bbc2=[_0x4c27b4['body'][_0x5a3316(0x25c)]],_0x4a55a6=[_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x26b)]],_0x5b155e=[_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x213)]],_0x5162ac=[_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x1fb)]],_0xa23e58=[_0x4c27b4[_0x5a3316(0x24b)]['deliverycode']],_0x20e34e=[_0x4c27b4['body'][_0x5a3316(0x289)]],_0x290c22=[_0x4c27b4['body'][_0x5a3316(0x227)]],_0x135ca9=[_0x4c27b4['body'][_0x5a3316(0x1cc)]];else var _0x3ba2d7=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x219)]],_0x4df141=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x205)]],_0x3f0388=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x25d)]],_0x564a12=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x20e)]],_0x2339b4=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x1a3)]],_0x5800cf=[..._0x4c27b4[_0x5a3316(0x24b)]['prod_level']],_0x382b57=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x1ee)]],_0x1c21d0=[..._0x4c27b4[_0x5a3316(0x24b)]['secondary_code']],_0x51be6f=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x288)]],_0x5aeaf9=[..._0x4c27b4['body'][_0x5a3316(0x242)]],_0x2339cc=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x29f)]],_0x393c3c=[..._0x4c27b4['body'][_0x5a3316(0x1a0)]],_0x31bbc2=[..._0x4c27b4['body']['alertQTY']],_0x4a55a6=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x26b)]],_0x5b155e=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x213)]],_0x5162ac=[..._0x4c27b4[_0x5a3316(0x24b)]['RoomAssign']],_0xa23e58=[..._0x4c27b4[_0x5a3316(0x24b)]['deliverycode']],_0x20e34e=[..._0x4c27b4[_0x5a3316(0x24b)]['prod_invoice']],_0x290c22=[..._0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x227)]],_0x135ca9=[..._0x4c27b4['body'][_0x5a3316(0x1cc)]];const _0x3a9e5d=_0x3ba2d7[_0x5a3316(0x1a1)](_0x5b49fc=>{return _0x5b49fc={'product_name':_0x5b49fc};});_0x290c22[_0x5a3316(0x225)]((_0x3a555b,_0x1613e0)=>{var _0x9d4340=_0x5a3316;_0x3a9e5d[_0x1613e0][_0x9d4340(0x227)]=_0x3a555b;}),_0x135ca9[_0x5a3316(0x225)]((_0x316af3,_0x449756)=>{_0x3a9e5d[_0x449756]['actual_uom']=_0x316af3;}),_0x4df141[_0x5a3316(0x225)]((_0x45a792,_0x4abff8)=>{var _0x4cf34f=_0x5a3316;_0x3a9e5d[_0x4abff8][_0x4cf34f(0x1c0)]=_0x45a792;}),_0x3f0388[_0x5a3316(0x225)]((_0x3d6f72,_0x49c6af)=>{var _0x2aa950=_0x5a3316;_0x3a9e5d[_0x49c6af][_0x2aa950(0x21b)]=_0x3d6f72;}),_0x564a12[_0x5a3316(0x225)]((_0x4607ce,_0x1f3831)=>{var _0x5dd0b9=_0x5a3316;_0x3a9e5d[_0x1f3831][_0x5dd0b9(0x267)]=_0x4607ce;}),_0x2339b4[_0x5a3316(0x225)]((_0x415ce8,_0x352de4)=>{var _0x3cf379=_0x5a3316;_0x3a9e5d[_0x352de4][_0x3cf379(0x1d0)]=_0x415ce8;}),_0x5800cf[_0x5a3316(0x225)]((_0x570aa4,_0x39e7d3)=>{_0x5162ac['forEach']((_0x5251a7,_0x2898d0)=>{var _0xda9b96=a0_0x4224;if(_0x5251a7==_0xda9b96(0x29a)&&_0x39e7d3==_0x2898d0){console[_0xda9b96(0x236)](_0x5251a7+_0xda9b96(0x25a)+_0x39e7d3+_0xda9b96(0x27e)+_0x2898d0+_0xda9b96(0x27e)+_0x570aa4);var _0x398cf7=_0x570aa4[_0xda9b96(0x28c)](0x3);_0x3a9e5d[_0x39e7d3][_0xda9b96(0x2a8)]=_0x570aa4[0x0],_0x3a9e5d[_0x39e7d3][_0xda9b96(0x1ed)]=_0x570aa4[0x1],_0x3a9e5d[_0x39e7d3][_0xda9b96(0x1be)]=0x0,_0x3a9e5d[_0x39e7d3]['bin']=0x0,_0x3a9e5d[_0x39e7d3][_0xda9b96(0x21a)]=_0xda9b96(0x287),_0x3a9e5d[_0x39e7d3]['floorlevel']=_0x398cf7;}else{if(_0x5251a7==_0xda9b96(0x1e3)&&_0x39e7d3==_0x2898d0){var _0x398cf7=_0x570aa4['slice'](0x3);_0x3a9e5d[_0x39e7d3][_0xda9b96(0x2a8)]=_0x570aa4[0x0],_0x3a9e5d[_0x39e7d3]['rack']=_0x570aa4[0x1],_0x3a9e5d[_0x39e7d3][_0xda9b96(0x1be)]=0x0,_0x3a9e5d[_0x39e7d3][_0xda9b96(0x203)]=0x0,_0x3a9e5d[_0x39e7d3][_0xda9b96(0x21a)]=_0xda9b96(0x287),_0x3a9e5d[_0x39e7d3][_0xda9b96(0x1f7)]=_0x570aa4[0x5];}else{if(_0x39e7d3==_0x2898d0){var _0x5a34e4;if(_0x570aa4[0x4]=='L')_0x5a34e4=_0xda9b96(0x1ca);else _0x570aa4[0x4]=='F'&&(_0x5a34e4=_0xda9b96(0x287));_0x3a9e5d[_0x39e7d3]['storage']=_0x570aa4[0x0],_0x3a9e5d[_0x39e7d3][_0xda9b96(0x1ed)]=_0x570aa4[0x1],_0x3a9e5d[_0x39e7d3][_0xda9b96(0x1be)]=_0x570aa4[0x2],_0x3a9e5d[_0x39e7d3]['bin']=_0x570aa4[0x3],_0x3a9e5d[_0x39e7d3][_0xda9b96(0x21a)]=_0x5a34e4,_0x3a9e5d[_0x39e7d3]['floorlevel']=_0x570aa4[0x5];}}}});}),_0x382b57[_0x5a3316(0x225)]((_0x4193cf,_0x3d1306)=>{var _0x28235f=_0x5a3316;_0x3a9e5d[_0x3d1306][_0x28235f(0x1ee)]=_0x4193cf;}),_0x1c21d0['forEach']((_0x1f9de6,_0x324bb3)=>{var _0x25dcc3=_0x5a3316;_0x3a9e5d[_0x324bb3][_0x25dcc3(0x223)]=_0x1f9de6;}),_0x51be6f[_0x5a3316(0x225)]((_0x107aed,_0x16c2e5)=>{var _0x400c38=_0x5a3316;_0x3a9e5d[_0x16c2e5][_0x400c38(0x28a)]=_0x107aed;}),_0x5aeaf9['forEach']((_0x5238cd,_0x5d61f0)=>{var _0x4afa2d=_0x5a3316;_0x3a9e5d[_0x5d61f0][_0x4afa2d(0x242)]=_0x5238cd;}),_0x2339cc[_0x5a3316(0x225)]((_0xe35a30,_0x42b473)=>{var _0x103fe1=_0x5a3316;_0x3a9e5d[_0x42b473][_0x103fe1(0x29f)]=_0xe35a30;}),_0x393c3c['forEach']((_0x38ddab,_0x399c1e)=>{_0x3a9e5d[_0x399c1e]['maxperunit']=_0x38ddab;}),_0x31bbc2[_0x5a3316(0x225)]((_0x36a6f9,_0x2e2fff)=>{_0x3a9e5d[_0x2e2fff]['alertQTY']=_0x36a6f9;}),_0x4a55a6[_0x5a3316(0x225)]((_0x386acd,_0x495ce3)=>{var _0x1782b2=_0x5a3316;_0x3a9e5d[_0x495ce3][_0x1782b2(0x26b)]=_0x386acd;}),_0x5b155e[_0x5a3316(0x225)]((_0x217e2b,_0x27f520)=>{var _0x129437=_0x5a3316;_0x3a9e5d[_0x27f520][_0x129437(0x1f5)]=_0x217e2b;}),_0x5162ac[_0x5a3316(0x225)]((_0x148a66,_0x37488b)=>{var _0x5d50f1=_0x5a3316;_0x3a9e5d[_0x37488b][_0x5d50f1(0x234)]=_0x148a66;}),_0xa23e58[_0x5a3316(0x225)]((_0x55e4c0,_0x3c3b4b)=>{var _0x26d27f=_0x5a3316;_0x3a9e5d[_0x3c3b4b][_0x26d27f(0x228)]=_0x55e4c0;}),_0x20e34e[_0x5a3316(0x225)]((_0x4c7781,_0x24d31f)=>{_0x3a9e5d[_0x24d31f]['invoice']=_0x4c7781;});const _0x358156=_0x5162ac[_0x5a3316(0x1a1)](_0x382a09=>{return _0x382a09={'room_name':_0x382a09};}),_0x4e14f2=_0x3a9e5d[_0x5a3316(0x245)](_0x3d0123=>_0x3d0123['quantity']!=='0'&&_0x3d0123['quantity']!==''),_0x23f1ee=new purchases({'invoice':_0x5eb276,'suppliers':_0x4c27b4[_0x5a3316(0x24b)][_0x5a3316(0x1b7)],'date':_0x1fd423,'warehouse_name':_0x25cf46,'product':_0x4e14f2,'note':_0x257740,'due_amount':_0xdbbd19,'POnumber':_0x31e4d9,'SCRN':_0x8aa265,'JO_number':_0x2f531c,'roomList':_0x358156}),_0x5f5065=await _0x23f1ee[_0x5a3316(0x1f0)](),_0x246109=await purchases[_0x5a3316(0x27f)]({'invoice':_0x5eb276}),_0x3e28ef=_0x246109['product'][_0x5a3316(0x1a1)](async _0x3b2e1b=>{var _0x504e90=_0x5a3316,_0x1194da=await warehouse[_0x504e90(0x27f)]({'name':_0x25cf46,'room':_0x3b2e1b[_0x504e90(0x234)]}),_0x34dbd6=0x0;return _0x1194da[_0x504e90(0x201)]['forEach'](_0x374129=>{var _0x2a6322=_0x504e90;_0x374129['product_name']==_0x3b2e1b[_0x2a6322(0x1b9)]&&_0x374129[_0x2a6322(0x1f7)]==_0x3b2e1b[_0x2a6322(0x1f7)]&&_0x374129[_0x2a6322(0x21a)]==_0x3b2e1b[_0x2a6322(0x21a)]&&_0x374129[_0x2a6322(0x203)]==_0x3b2e1b[_0x2a6322(0x203)]&&_0x374129[_0x2a6322(0x1be)]==_0x3b2e1b[_0x2a6322(0x1be)]&&_0x374129[_0x2a6322(0x1ed)]==_0x3b2e1b[_0x2a6322(0x1ed)]&&_0x374129[_0x2a6322(0x2a8)]==_0x3b2e1b[_0x2a6322(0x2a8)]&&_0x374129['expiry_date']==_0x3b2e1b[_0x2a6322(0x29f)]&&_0x374129[_0x2a6322(0x242)]==_0x3b2e1b[_0x2a6322(0x242)]&&_0x374129[_0x2a6322(0x26b)]==_0x3b2e1b['production_date']&&_0x374129[_0x2a6322(0x29e)]==_0x246109[_0x2a6322(0x29e)]&&(_0x374129[_0x2a6322(0x1e8)]+=_0x3b2e1b[_0x2a6322(0x21b)],_0x34dbd6++);}),_0x34dbd6===0x0&&_0x1194da[_0x504e90(0x201)][_0x504e90(0x295)]({'product_name':_0x3b2e1b[_0x504e90(0x1b9)],'product_stock':_0x3b2e1b[_0x504e90(0x21b)],'primary_code':_0x3b2e1b['primary_code'],'secondary_code':_0x3b2e1b[_0x504e90(0x223)],'product_code':_0x3b2e1b[_0x504e90(0x1c0)],'storage':_0x3b2e1b['storage'],'rack':_0x3b2e1b[_0x504e90(0x1ed)],'bay':_0x3b2e1b[_0x504e90(0x1be)],'bin':_0x3b2e1b[_0x504e90(0x203)],'type':_0x3b2e1b[_0x504e90(0x21a)],'floorlevel':_0x3b2e1b['floorlevel'],'maxProducts':_0x3b2e1b['maxStocks'],'unit':_0x3b2e1b['standard_unit'],'secondary_unit':_0x3b2e1b[_0x504e90(0x1d0)],'expiry_date':_0x3b2e1b[_0x504e90(0x29f)],'maxPerUnit':_0x3b2e1b[_0x504e90(0x1da)],'batch_code':_0x3b2e1b[_0x504e90(0x242)],'alertQTY':_0x3b2e1b[_0x504e90(0x25c)],'production_date':_0x3b2e1b[_0x504e90(0x26b)],'product_cat':_0x3b2e1b[_0x504e90(0x1f5)],'invoice':_0x3b2e1b['invoice'],'actual_qty':_0x3b2e1b[_0x504e90(0x227)],'actual_uom':_0x3b2e1b[_0x504e90(0x1cc)]}),_0x1194da;});Promise[_0x5a3316(0x240)](_0x3e28ef)['then'](async _0x1efe6b=>{var _0x45c74a=_0x5a3316;try{for(const _0x14088d of _0x1efe6b){await _0x14088d[_0x45c74a(0x1f0)]();}const _0x1e3955=await master_shop[_0x45c74a(0x26c)](),_0x34a2dd=await email_settings[_0x45c74a(0x27f)](),_0x4f80ab=await supervisor_settings[_0x45c74a(0x26c)]();var _0x33ce0f=_0x246109[_0x45c74a(0x1cf)],_0x33b2ce='',_0x540c8d;for(_0x540c8d in _0x33ce0f){_0x33b2ce+=_0x45c74a(0x266)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x33ce0f[_0x540c8d]['product_name']+'</td>'+_0x45c74a(0x253)+_0x33ce0f[_0x540c8d][_0x45c74a(0x1c0)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x33ce0f[_0x540c8d][_0x45c74a(0x21b)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x33ce0f[_0x540c8d][_0x45c74a(0x267)]+_0x45c74a(0x28d)+_0x45c74a(0x253)+_0x33ce0f[_0x540c8d][_0x45c74a(0x1d0)]+_0x45c74a(0x28d)+_0x45c74a(0x253)+_0x246109[_0x45c74a(0x239)]+_0x45c74a(0x28d)+_0x45c74a(0x253)+_0x33ce0f[_0x540c8d][_0x45c74a(0x234)]+_0x45c74a(0x28d)+_0x45c74a(0x253)+_0x33ce0f[_0x540c8d][_0x45c74a(0x2a8)]+_0x33ce0f[_0x540c8d][_0x45c74a(0x1ed)]+_0x33ce0f[_0x540c8d][_0x45c74a(0x1be)]+_0x33ce0f[_0x540c8d][_0x45c74a(0x203)]+_0x33ce0f[_0x540c8d]['type'][0x0]+_0x33ce0f[_0x540c8d]['floorlevel']+'</td>',_0x45c74a(0x212);}let _0x6d0070=nodemailer['createTransport']({'host':_0x34a2dd['host'],'port':Number(_0x34a2dd['port']),'secure':![],'auth':{'user':_0x34a2dd[_0x45c74a(0x1d5)],'pass':_0x34a2dd['password']}}),_0x857212={'from':_0x34a2dd['email'],'to':_0x4f80ab[0x0][_0x45c74a(0x1a6)],'subject':_0x45c74a(0x19d),'attachments':[{'filename':'Logo.png','path':__dirname+'/../public'+_0x45c74a(0x20d)+_0x1e3955[0x0][_0x45c74a(0x1e6)],'cid':_0x45c74a(0x1c9)}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+_0x45c74a(0x25b)+_0x45c74a(0x231)+_0x45c74a(0x1fa)+'<div>'+_0x45c74a(0x299)+_0x45c74a(0x268)+_0x45c74a(0x231)+'<h2>\x20'+_0x1e3955[0x0][_0x45c74a(0x252)]+_0x45c74a(0x248)+_0x45c74a(0x268)+'</div>'+_0x45c74a(0x255)+'<div>'+_0x45c74a(0x256)+_0x45c74a(0x1ce)+_0x246109[_0x45c74a(0x29e)]+'\x20'+_0x45c74a(0x1d6)+_0x45c74a(0x1b4)+_0x246109['date']+'\x20'+_0x45c74a(0x1c6)+_0x45c74a(0x24c)+_0x45c74a(0x268)+_0x45c74a(0x1bb)+_0x45c74a(0x1d2)+_0x45c74a(0x266)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x45c74a(0x23b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x45c74a(0x207)+_0x45c74a(0x290)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x45c74a(0x29b)+_0x45c74a(0x212)+_0x45c74a(0x22e)+_0x45c74a(0x291)+'\x20'+_0x33b2ce+'\x20'+_0x45c74a(0x21c)+_0x45c74a(0x1a5)+_0x45c74a(0x231)+_0x45c74a(0x28b)+_0x45c74a(0x235)+_0x1e3955[0x0][_0x45c74a(0x252)]+_0x45c74a(0x24c)+'</div>'+_0x45c74a(0x268)+_0x45c74a(0x2a2)};_0x6d0070['sendMail'](_0x857212,function(_0x1873bf,_0x464449){var _0x1ab87b=_0x45c74a;_0x1873bf?(console[_0x1ab87b(0x236)](_0x1873bf),console[_0x1ab87b(0x236)](_0x1ab87b(0x1b0))):console[_0x1ab87b(0x236)](_0x1ab87b(0x1bf));}),_0x4c27b4[_0x45c74a(0x1a7)]('success','Purchase\x20data\x20added\x20successfully'),_0x282802['redirect']('/all_purchases/view/');}catch(_0x5f4bc9){console[_0x45c74a(0x1fc)](_0x5f4bc9),_0x282802[_0x45c74a(0x1d9)](0x1f4)[_0x45c74a(0x247)]({'error':_0x45c74a(0x270)});}})[_0x5a3316(0x217)](_0x232264=>{var _0x6c1902=_0x5a3316;console[_0x6c1902(0x1fc)](_0x232264),_0x282802['status'](0x1f4)[_0x6c1902(0x247)]({'error':'An\x20error\x20occurred.'});});}catch(_0x25eb86){console[_0x5a3316(0x236)](_0x25eb86);}}),router[a0_0x2d9e43(0x1d4)](a0_0x2d9e43(0x1e5),auth,async(_0x246a32,_0x20c38b)=>{var _0x56a6b9=a0_0x2d9e43;try{const {username:_0x1610c0,email:_0x4db3a0,role:_0x17fac3}=_0x246a32[_0x56a6b9(0x25e)],_0x24eecf=_0x246a32[_0x56a6b9(0x25e)],_0x273797=await profile[_0x56a6b9(0x27f)]({'email':_0x24eecf[_0x56a6b9(0x1d5)]}),_0x50d70c=await master_shop[_0x56a6b9(0x26c)](),_0x26e9ab=_0x246a32[_0x56a6b9(0x1b2)]['id'],_0xa50015=await purchases['findById'](_0x26e9ab),_0x46abb0=await warehouse[_0x56a6b9(0x22d)]([{'$match':{'name':_0xa50015[_0x56a6b9(0x239)],'room':_0xa50015[_0x56a6b9(0x22f)]}},{'$unwind':_0x56a6b9(0x1f3)},{'$group':{'_id':_0x56a6b9(0x283),'name':{'$first':_0x56a6b9(0x209)},'product_stock':{'$first':_0x56a6b9(0x1b8)},'bay':{'$first':_0x56a6b9(0x292)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x56a6b9(0x1c1)},'secondary_code':{'$first':_0x56a6b9(0x22c)},'product_code':{'$first':_0x56a6b9(0x204)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x56a6b9(0x21d)},'expiry_date':{'$first':_0x56a6b9(0x250)}}}]),_0x46bb5d=await customer[_0x56a6b9(0x26c)]({});let _0x3fc90c;if(_0x24eecf['role']=='staff'){const _0x14ad85=await staff['findOne']({'email':_0x24eecf[_0x56a6b9(0x1d5)]});_0x3fc90c=await warehouse[_0x56a6b9(0x22d)]([{'$match':{'status':_0x56a6b9(0x1fe),'name':_0x14ad85[_0x56a6b9(0x1c8)]}},{'$group':{'_id':_0x56a6b9(0x281),'name':{'$first':_0x56a6b9(0x281)}}}]);}else _0x3fc90c=await warehouse[_0x56a6b9(0x22d)]([{'$match':{'status':_0x56a6b9(0x1fe)}},{'$group':{'_id':_0x56a6b9(0x281),'name':{'$first':_0x56a6b9(0x281)}}}]);const _0xd185e8=await product[_0x56a6b9(0x26c)]({}),_0x1ae06c=await suppliers[_0x56a6b9(0x26c)]({}),_0x1a80e5=BayBinSelected(_0xa50015['warehouse_name'],_0xa50015[_0x56a6b9(0x22f)]);if(_0x50d70c[0x0][_0x56a6b9(0x284)]==_0x56a6b9(0x22a)){var _0x512669=users[_0x56a6b9(0x1b1)];console[_0x56a6b9(0x236)](_0x512669);}else{if(_0x50d70c[0x0][_0x56a6b9(0x284)]==_0x56a6b9(0x24a))var _0x512669=users[_0x56a6b9(0x24a)];else{if(_0x50d70c[0x0]['language']=='German')var _0x512669=users[_0x56a6b9(0x24f)];else{if(_0x50d70c[0x0][_0x56a6b9(0x284)]==_0x56a6b9(0x20c))var _0x512669=users[_0x56a6b9(0x20c)];else{if(_0x50d70c[0x0]['language']==_0x56a6b9(0x271))var _0x512669=users['French'];else{if(_0x50d70c[0x0][_0x56a6b9(0x284)]==_0x56a6b9(0x1f6))var _0x512669=users['Portuguese'];else{if(_0x50d70c[0x0][_0x56a6b9(0x284)]==_0x56a6b9(0x27d))var _0x512669=users[_0x56a6b9(0x27d)];else{if(_0x50d70c[0x0][_0x56a6b9(0x284)]==_0x56a6b9(0x1f9))var _0x512669=users[_0x56a6b9(0x1c2)];}}}}}}}_0x20c38b['render'](_0x56a6b9(0x249),{'success':_0x246a32['flash']('success'),'errors':_0x246a32[_0x56a6b9(0x1a7)]('errors'),'role':_0x24eecf,'profile':_0x273797,'customer':_0x46bb5d,'warehouse':_0x3fc90c,'product':_0x46abb0,'user':_0xa50015,'master_shop':_0x50d70c,'unit':_0xd185e8,'language':_0x512669,'suppliers':_0x1ae06c,'dataSelected':_0x1a80e5});}catch(_0x164884){console[_0x56a6b9(0x236)](_0x164884);}}),router['post']('/preview/:id',auth,async(_0x21c422,_0x5515a2)=>{var _0x2a1427=a0_0x2d9e43;try{const _0x2ad9e6=_0x21c422[_0x2a1427(0x1b2)]['id'],{invoice:_0x18042c,warehouse_name:_0x5eee48,Room_name:_0x40c824}=_0x21c422['body'],_0x445770=await warehouse[_0x2a1427(0x27f)]({'name':_0x5eee48,'room':_0x40c824}),_0x5d5e5c=await purchases[_0x2a1427(0x27f)]({'invoice':_0x18042c});_0x5d5e5c[_0x2a1427(0x1cf)][_0x2a1427(0x225)](_0x647fdd=>{var _0x50738d=_0x2a1427,_0x4f2aa7=0x0;const _0x1cddc9=_0x445770[_0x50738d(0x201)]['map'](_0x30102e=>{var _0xb8b9b9=_0x50738d;_0x30102e[_0xb8b9b9(0x1b9)]==_0x647fdd['product_name']&&_0x30102e[_0xb8b9b9(0x1f7)]==_0x647fdd[_0xb8b9b9(0x1f7)]&&_0x30102e[_0xb8b9b9(0x21a)]==_0x647fdd[_0xb8b9b9(0x21a)]&&_0x30102e[_0xb8b9b9(0x203)]==_0x647fdd['bin']&&_0x30102e[_0xb8b9b9(0x1be)]==_0x647fdd[_0xb8b9b9(0x1be)]&&_0x30102e['rack']==_0x647fdd[_0xb8b9b9(0x1ed)]&&_0x30102e[_0xb8b9b9(0x2a8)]==_0x647fdd['storage']&&_0x30102e['expiry_date']==_0x647fdd[_0xb8b9b9(0x29f)]&&_0x30102e['batch_code']==_0x647fdd[_0xb8b9b9(0x242)]&&_0x30102e[_0xb8b9b9(0x26b)]==_0x647fdd['production_date']&&_0x30102e[_0xb8b9b9(0x2a3)]==_0x647fdd['delivery_date']&&_0x30102e['delivery_code']==_0x647fdd[_0xb8b9b9(0x228)]&&(_0x30102e[_0xb8b9b9(0x1e8)]=parseInt(_0x30102e['product_stock'])+parseInt(_0x647fdd[_0xb8b9b9(0x21b)]),_0x4f2aa7++);});_0x4f2aa7=='0'&&(_0x445770[_0x50738d(0x201)]=_0x445770['product_details'][_0x50738d(0x1e1)]({'product_name':_0x647fdd[_0x50738d(0x1b9)],'product_stock':_0x647fdd['quantity'],'primary_code':_0x647fdd[_0x50738d(0x1ee)],'secondary_code':_0x647fdd[_0x50738d(0x223)],'product_code':_0x647fdd['product_code'],'storage':_0x647fdd['storage'],'rack':_0x647fdd[_0x50738d(0x1ed)],'bay':_0x647fdd['bay'],'bin':_0x647fdd[_0x50738d(0x203)],'type':_0x647fdd['type'],'floorlevel':_0x647fdd[_0x50738d(0x1f7)],'maxProducts':_0x647fdd[_0x50738d(0x28a)],'unit':_0x647fdd[_0x50738d(0x267)],'secondary_unit':_0x647fdd[_0x50738d(0x1d0)],'expiry_date':_0x647fdd[_0x50738d(0x29f)],'maxPerUnit':_0x647fdd['maxperunit'],'batch_code':_0x647fdd[_0x50738d(0x242)],'alertQTY':_0x647fdd[_0x50738d(0x25c)],'production_date':_0x647fdd[_0x50738d(0x26b)],'delivery_date':_0x647fdd[_0x50738d(0x2a3)],'delivery_code':_0x647fdd['delivery_code']}));}),await _0x445770[_0x2a1427(0x1f0)](),_0x5d5e5c[_0x2a1427(0x259)]='True';const _0x3a0ef9=await _0x5d5e5c[_0x2a1427(0x1f0)]();_0x21c422[_0x2a1427(0x1a7)](_0x2a1427(0x229),_0x2a1427(0x214)),_0x5515a2[_0x2a1427(0x265)]('/all_purchases/view');}catch(_0x46a7d5){console[_0x2a1427(0x236)](_0x46a7d5);}}),router[a0_0x2d9e43(0x1d4)](a0_0x2d9e43(0x23a),auth,async(_0x422371,_0x233f32)=>{var _0x2171e8=a0_0x2d9e43;try{const {username:_0x360e0e,email:_0x58483e,role:_0x98949c}=_0x422371[_0x2171e8(0x25e)],_0x45ca95=_0x422371[_0x2171e8(0x25e)],_0x2768ea=await profile[_0x2171e8(0x27f)]({'email':_0x45ca95[_0x2171e8(0x1d5)]}),_0x23f126=await master_shop[_0x2171e8(0x26c)](),_0x3a2661=_0x422371[_0x2171e8(0x1b2)]['id'],_0x3533c4=await purchases[_0x2171e8(0x1cb)](_0x3a2661),_0xb9caf6=await suppliers[_0x2171e8(0x26c)]({});let _0x200666;if(_0x45ca95[_0x2171e8(0x258)]==_0x2171e8(0x29c)){const _0x1c9505=await staff[_0x2171e8(0x27f)]({'email':_0x45ca95[_0x2171e8(0x1d5)]});_0x200666=await warehouse[_0x2171e8(0x26c)]({'status':'Enabled','name':_0x1c9505['warehouse'],'warehouse_category':_0x2171e8(0x28e)});}else _0x200666=await warehouse[_0x2171e8(0x22d)]([{'$match':{'status':'Enabled','warehouse_category':_0x2171e8(0x28e)}},{'$group':{'_id':_0x2171e8(0x281),'name':{'$first':_0x2171e8(0x281)}}}]);const _0x124912=await product['find']({}),_0xd44ca2=BayBinSelected(_0x3533c4[_0x2171e8(0x239)],_0x3533c4[_0x2171e8(0x22f)]);let _0x42d5c3=new Date(_0x3533c4[_0x2171e8(0x29f)]),_0xf76325=('0'+_0x42d5c3['getDate']())['slice'](-0x2),_0x4055ee=('0'+(_0x42d5c3[_0x2171e8(0x26d)]()+0x1))[_0x2171e8(0x28c)](-0x2),_0x274232=_0x42d5c3[_0x2171e8(0x282)](),_0x12fe01=_0x274232+'-'+_0x4055ee+'-'+_0xf76325;if(_0x23f126[0x0]['language']==_0x2171e8(0x22a)){var _0x5781da=users[_0x2171e8(0x1b1)];console[_0x2171e8(0x236)](_0x5781da);}else{if(_0x23f126[0x0][_0x2171e8(0x284)]==_0x2171e8(0x24a))var _0x5781da=users['Hindi'];else{if(_0x23f126[0x0][_0x2171e8(0x284)]=='German')var _0x5781da=users[_0x2171e8(0x24f)];else{if(_0x23f126[0x0]['language']==_0x2171e8(0x20c))var _0x5781da=users[_0x2171e8(0x20c)];else{if(_0x23f126[0x0][_0x2171e8(0x284)]==_0x2171e8(0x271))var _0x5781da=users[_0x2171e8(0x271)];else{if(_0x23f126[0x0][_0x2171e8(0x284)]==_0x2171e8(0x1f6))var _0x5781da=users[_0x2171e8(0x230)];else{if(_0x23f126[0x0][_0x2171e8(0x284)]==_0x2171e8(0x27d))var _0x5781da=users[_0x2171e8(0x27d)];else{if(_0x23f126[0x0][_0x2171e8(0x284)]==_0x2171e8(0x1f9))var _0x5781da=users['Arabic'];}}}}}}}_0x233f32[_0x2171e8(0x2a0)]('edit_purchases',{'success':_0x422371[_0x2171e8(0x1a7)]('success'),'errors':_0x422371['flash']('errors'),'role':_0x45ca95,'profile':_0x2768ea,'purchases':_0x3533c4,'suppliers':_0xb9caf6,'warehouse':_0x200666,'product':_0x124912,'master_shop':_0x23f126,'language':_0x5781da,'ed_fullDate':_0x12fe01,'dataSelected':_0xd44ca2});}catch(_0x5a2b01){console[_0x2171e8(0x236)](_0x5a2b01);}}),router['post'](a0_0x2d9e43(0x23a),auth,async(_0x75bf7f,_0x394c75)=>{var _0x15cc9c=a0_0x2d9e43;try{const _0xc79c2f=_0x75bf7f[_0x15cc9c(0x1b2)]['id'],_0x20de79=await purchases[_0x15cc9c(0x27f)]({'_id':_0x75bf7f[_0x15cc9c(0x1b2)]['id']}),_0x482447=await warehouse[_0x15cc9c(0x27f)]({'name':_0x20de79[_0x15cc9c(0x239)],'room':_0x20de79[_0x15cc9c(0x22f)]});_0x20de79[_0x15cc9c(0x1cf)]['forEach'](_0x2059ff=>{var _0x3a186e=_0x15cc9c;const _0x1256d9=_0x482447['product_details'][_0x3a186e(0x1a1)](_0x4f692b=>{var _0x2229fb=_0x3a186e;_0x4f692b[_0x2229fb(0x1b9)]==_0x2059ff[_0x2229fb(0x1b9)]&&_0x4f692b[_0x2229fb(0x1f7)]==_0x2059ff[_0x2229fb(0x1f7)]&&_0x4f692b[_0x2229fb(0x21a)]==_0x2059ff['type']&&_0x4f692b[_0x2229fb(0x203)]==_0x2059ff[_0x2229fb(0x203)]&&_0x4f692b[_0x2229fb(0x1be)]==_0x2059ff[_0x2229fb(0x1be)]&&_0x4f692b[_0x2229fb(0x1ed)]==_0x2059ff[_0x2229fb(0x1ed)]&&_0x4f692b['storage']==_0x2059ff[_0x2229fb(0x2a8)]&&(_0x4f692b[_0x2229fb(0x1e8)]=parseInt(_0x4f692b[_0x2229fb(0x1e8)])-parseInt(_0x2059ff[_0x2229fb(0x21b)]));});}),await _0x482447[_0x15cc9c(0x1f0)]();const {invoice:_0x1981b9,suppliers:_0x5e2855,date:_0x46e922,warehouse_name:_0x49728c,prod_name:_0x25170c,prod_code:_0x50d7cd,prod_qty:_0x4ed291,prod_unit:_0x5c7e59,prod_secondunit:_0x158b82,prod_level:_0x2c153e,prod_isle:_0x533f78,prod_pallet:_0x2a5090,note:_0x1883b4,expiry_date:_0x2a3a24,batch_code:_0x1c195d,paid_amount:_0x59d65e,due_amount:_0x5dd360,Room_name:_0x300bf3,primary_code:_0x4c91ea,secondary_code:_0x63953c,PO_number:_0x43eb0b,JO_number:_0x21101c}=_0x75bf7f[_0x15cc9c(0x24b)];if(typeof _0x25170c==_0x15cc9c(0x1c3))var _0x6ad3f1=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x219)]],_0x265ace=[_0x75bf7f['body']['prod_code']],_0x4beea1=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x254)]],_0x1e3194=[_0x75bf7f['body'][_0x15cc9c(0x222)]],_0x1bd115=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x1a3)]],_0x4d1b45=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x2a9)]],_0x19f04a=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x24d)]],_0x46c0c7=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x215)]],_0xf6acac=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x1ee)]],_0x2c1044=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x223)]],_0x21f120=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x288)]],_0x1812de=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x242)]],_0xf800c8=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x29f)]],_0x2a3149=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x2a8)]],_0x38d7ea=[_0x75bf7f[_0x15cc9c(0x24b)]['rak']],_0x4a719d=[_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x21a)]];else var _0x6ad3f1=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x219)]],_0x265ace=[..._0x75bf7f[_0x15cc9c(0x24b)]['prod_code']],_0x4beea1=[..._0x75bf7f['body']['prod_qty']],_0x1e3194=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x222)]],_0x1bd115=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x1a3)]],_0x4d1b45=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x2a9)]],_0x19f04a=[..._0x75bf7f[_0x15cc9c(0x24b)]['prod_isle']],_0x46c0c7=[..._0x75bf7f['body'][_0x15cc9c(0x215)]],_0xf6acac=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x1ee)]],_0x2c1044=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x223)]],_0x21f120=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x288)]],_0x1812de=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x242)]],_0xf800c8=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x29f)]],_0x2a3149=[..._0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x2a8)]],_0x38d7ea=[..._0x75bf7f['body'][_0x15cc9c(0x1e9)]],_0x4a719d=[..._0x75bf7f['body']['type']];const _0x5c5bce=_0x6ad3f1[_0x15cc9c(0x1a1)](_0x373b72=>{return _0x373b72={'product_name':_0x373b72};});_0x265ace[_0x15cc9c(0x225)]((_0x26862b,_0x2966a4)=>{_0x5c5bce[_0x2966a4]['product_code']=_0x26862b;}),_0x4beea1[_0x15cc9c(0x225)]((_0x3ec149,_0x2539ba)=>{var _0x345443=_0x15cc9c;_0x5c5bce[_0x2539ba][_0x345443(0x21b)]=_0x3ec149;}),_0x1e3194[_0x15cc9c(0x225)]((_0x29c7b0,_0x5240b1)=>{_0x5c5bce[_0x5240b1]['standard_unit']=_0x29c7b0;}),_0x1bd115[_0x15cc9c(0x225)]((_0x5ab0a4,_0x1fc222)=>{var _0x48d094=_0x15cc9c;_0x5c5bce[_0x1fc222][_0x48d094(0x1d0)]=_0x5ab0a4;}),_0x4d1b45[_0x15cc9c(0x225)]((_0x5b6f76,_0x138521)=>{var _0x865256=_0x15cc9c;_0x5c5bce[_0x138521][_0x865256(0x1be)]=_0x5b6f76;}),_0x19f04a[_0x15cc9c(0x225)]((_0x59b2f7,_0x941edb)=>{var _0x39053c=_0x15cc9c;_0x5c5bce[_0x941edb][_0x39053c(0x203)]=_0x59b2f7;}),_0x46c0c7['forEach']((_0x51bcc3,_0x1eb07e)=>{_0x5c5bce[_0x1eb07e]['floorlevel']=_0x51bcc3;}),_0xf6acac[_0x15cc9c(0x225)]((_0x249295,_0x4cc3b0)=>{var _0x894c81=_0x15cc9c;_0x5c5bce[_0x4cc3b0][_0x894c81(0x1ee)]=_0x249295;}),_0x2c1044[_0x15cc9c(0x225)]((_0x424a86,_0x13537e)=>{var _0x1c694d=_0x15cc9c;_0x5c5bce[_0x13537e][_0x1c694d(0x223)]=_0x424a86;}),_0x21f120[_0x15cc9c(0x225)]((_0xc83c01,_0x5e6a49)=>{var _0x1f57a4=_0x15cc9c;_0x5c5bce[_0x5e6a49][_0x1f57a4(0x28a)]=_0xc83c01;}),_0x1812de[_0x15cc9c(0x225)]((_0x445687,_0x72f36f)=>{_0x5c5bce[_0x72f36f]['batch_code']=_0x445687;}),_0xf800c8['forEach']((_0x4d5148,_0x5069a4)=>{var _0x676bdb=_0x15cc9c;_0x5c5bce[_0x5069a4][_0x676bdb(0x29f)]=_0x4d5148;}),_0x4a719d[_0x15cc9c(0x225)]((_0x3dfa56,_0x324364)=>{var _0x9865ab=_0x15cc9c;_0x5c5bce[_0x324364][_0x9865ab(0x21a)]=_0x3dfa56;}),_0x2a3149[_0x15cc9c(0x225)]((_0x21fc2a,_0xbc7bd5)=>{_0x5c5bce[_0xbc7bd5]['storage']=_0x21fc2a;}),_0x38d7ea[_0x15cc9c(0x225)]((_0x1b2fdf,_0x3eca26)=>{_0x5c5bce[_0x3eca26]['rack']=_0x1b2fdf;});const _0x2a35dd=_0x5c5bce[_0x15cc9c(0x245)](_0x29ae87=>_0x29ae87[_0x15cc9c(0x21b)]!=='0'&&_0x29ae87[_0x15cc9c(0x21b)]!=='');_0x20de79['invoice']=_0x1981b9,_0x20de79[_0x15cc9c(0x1b7)]=_0x5e2855,_0x20de79['date']=_0x46e922,_0x20de79[_0x15cc9c(0x239)]=_0x49728c,_0x20de79[_0x15cc9c(0x1cf)]=_0x2a35dd,_0x20de79['note']=_0x1883b4,_0x20de79[_0x15cc9c(0x1f8)]=_0x59d65e,_0x20de79['due_amount']=_0x5dd360,_0x20de79[_0x15cc9c(0x22f)]=_0x300bf3,_0x20de79[_0x15cc9c(0x269)]=_0x43eb0b,_0x20de79[_0x15cc9c(0x1c5)]=_0x21101c;const _0x21441a=await _0x20de79[_0x15cc9c(0x1f0)](),_0x57bc38=await warehouse['findOne']({'name':_0x75bf7f[_0x15cc9c(0x24b)]['warehouse_name'],'room':_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x27b)]});_0x20de79[_0x15cc9c(0x1cf)][_0x15cc9c(0x225)](_0x5b2e84=>{var _0x208f30=_0x15cc9c,_0x121302=0x0;const _0x1f6a90=_0x57bc38[_0x208f30(0x201)][_0x208f30(0x1a1)](_0x1f3ee8=>{var _0xbb256a=_0x208f30;_0x1f3ee8[_0xbb256a(0x1b9)]==_0x5b2e84[_0xbb256a(0x1b9)]&&_0x1f3ee8[_0xbb256a(0x1f7)]==_0x5b2e84[_0xbb256a(0x1f7)]&&_0x1f3ee8[_0xbb256a(0x21a)]==_0x5b2e84[_0xbb256a(0x21a)]&&_0x1f3ee8[_0xbb256a(0x203)]==_0x5b2e84['bin']&&_0x1f3ee8[_0xbb256a(0x1be)]==_0x5b2e84[_0xbb256a(0x1be)]&&_0x1f3ee8['rack']==_0x5b2e84[_0xbb256a(0x1ed)]&&_0x1f3ee8['storage']==_0x5b2e84[_0xbb256a(0x2a8)]&&(_0x1f3ee8[_0xbb256a(0x1e8)]=parseInt(_0x1f3ee8['product_stock'])+parseInt(_0x5b2e84[_0xbb256a(0x21b)]),_0x121302++);});_0x121302=='0'&&(_0x57bc38[_0x208f30(0x201)]=_0x57bc38[_0x208f30(0x201)][_0x208f30(0x1e1)]({'product_name':_0x5b2e84['product_name'],'product_stock':_0x5b2e84[_0x208f30(0x21b)],'primary_code':_0x5b2e84[_0x208f30(0x1ee)],'secondary_code':_0x5b2e84[_0x208f30(0x223)],'product_code':_0x5b2e84['product_code'],'storage':_0x5b2e84['storage'],'rack':_0x5b2e84[_0x208f30(0x1ed)],'bay':_0x5b2e84[_0x208f30(0x1be)],'bin':_0x5b2e84[_0x208f30(0x203)],'type':_0x5b2e84[_0x208f30(0x21a)],'floorlevel':_0x5b2e84[_0x208f30(0x1f7)],'maxProducts':_0x5b2e84['maxStocks'],'unit':_0x5b2e84['standard_unit'],'secondary_unit':_0x5b2e84['secondary_unit'],'expiry_date':_0x5b2e84[_0x208f30(0x29f)]}));}),await _0x57bc38['save']();const _0x235110=await s_payment_data['findOne']({'invoice':_0x75bf7f[_0x15cc9c(0x24b)]['invoice']});if(_0x235110===null){}else console[_0x15cc9c(0x236)](_0x15cc9c(0x1b7),_0x235110,_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x29e)]),_0x235110['suppliers']=_0x75bf7f[_0x15cc9c(0x24b)][_0x15cc9c(0x1b7)],await _0x235110['save']();_0x75bf7f[_0x15cc9c(0x1a7)]('success',_0x15cc9c(0x1df)),_0x394c75[_0x15cc9c(0x265)](_0x15cc9c(0x1a8));}catch(_0x52d561){console[_0x15cc9c(0x236)](_0x52d561);}}),router[a0_0x2d9e43(0x286)](a0_0x2d9e43(0x216),auth,async(_0x3c7156,_0x58e5f0)=>{var _0x2b4c55=a0_0x2d9e43;try{const _0x1f8bd6=_0x3c7156[_0x2b4c55(0x1b2)]['id'],{invoice:_0x15378e,suppliers:_0x534d87,payable:_0x393e36,due_amount:_0x5c7e06}=_0x3c7156['body'],_0x652e99=await purchases[_0x2b4c55(0x1cb)](_0x1f8bd6);var _0x52dff0=_0x393e36-_0x5c7e06;_0x652e99[_0x2b4c55(0x1f8)]=parseFloat(_0x652e99[_0x2b4c55(0x1f8)])+parseFloat(_0x5c7e06),_0x652e99[_0x2b4c55(0x1ba)]=_0x52dff0;const _0x4f2e50=await _0x652e99[_0x2b4c55(0x1f0)]();console[_0x2b4c55(0x236)](_0x4f2e50);const _0xc3b9e=await s_payment_data[_0x2b4c55(0x27f)]({'invoice':_0x15378e});_0xc3b9e[_0x2b4c55(0x261)]=_0x52dff0,await _0xc3b9e[_0x2b4c55(0x1f0)]();let _0x3aee6d=new Date(),_0x4bec0c=('0'+_0x3aee6d['getDate']())[_0x2b4c55(0x28c)](-0x2),_0x43bf1a=('0'+(_0x3aee6d[_0x2b4c55(0x26d)]()+0x1))[_0x2b4c55(0x28c)](-0x2),_0x5dbbfc=_0x3aee6d[_0x2b4c55(0x282)](),_0x23a27d=_0x5dbbfc+'-'+_0x43bf1a+'-'+_0x4bec0c;const _0x538cb1=new suppliers_payment({'invoice':_0x15378e,'date':_0x5dbbfc+'-'+_0x43bf1a+'-'+_0x4bec0c,'suppliers':_0x534d87,'reason':_0x2b4c55(0x1b5),'amount':_0x5c7e06}),_0x327fd1=await _0x538cb1[_0x2b4c55(0x1f0)]();_0x3c7156[_0x2b4c55(0x1a7)](_0x2b4c55(0x229),_0x2b4c55(0x1db)),_0x58e5f0[_0x2b4c55(0x265)](_0x2b4c55(0x1a8));}catch(_0x413ae0){console['log'](_0x413ae0);}}),router[a0_0x2d9e43(0x1d4)]('/invoice/:id',auth,async(_0x5d931b,_0x216022)=>{var _0x4c1c0e=a0_0x2d9e43;try{const {username:_0x4e11a1,email:_0x1956f2,role:_0x5748e5}=_0x5d931b[_0x4c1c0e(0x25e)],_0x9c0727=_0x5d931b[_0x4c1c0e(0x25e)],_0x4d0635=await profile[_0x4c1c0e(0x27f)]({'email':_0x9c0727[_0x4c1c0e(0x1d5)]}),_0x36a1bc=await master_shop[_0x4c1c0e(0x26c)]();console[_0x4c1c0e(0x236)](_0x4c1c0e(0x1b6),_0x36a1bc);const _0x495c2e=_0x5d931b[_0x4c1c0e(0x1b2)]['id'],_0x16b21d=await purchases['findById'](_0x495c2e);console['log'](_0x16b21d);const _0x159871=await suppliers['findOne']({'name':_0x16b21d[_0x4c1c0e(0x1b7)]});console['log'](_0x159871);if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]==_0x4c1c0e(0x22a)){var _0x4e7a07=users[_0x4c1c0e(0x1b1)];console['log'](_0x4e7a07);}else{if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]=='Hindi')var _0x4e7a07=users[_0x4c1c0e(0x24a)];else{if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]==_0x4c1c0e(0x24f))var _0x4e7a07=users['German'];else{if(_0x36a1bc[0x0]['language']=='Spanish')var _0x4e7a07=users[_0x4c1c0e(0x20c)];else{if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]==_0x4c1c0e(0x271))var _0x4e7a07=users[_0x4c1c0e(0x271)];else{if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]==_0x4c1c0e(0x1f6))var _0x4e7a07=users[_0x4c1c0e(0x230)];else{if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]==_0x4c1c0e(0x27d))var _0x4e7a07=users[_0x4c1c0e(0x27d)];else{if(_0x36a1bc[0x0][_0x4c1c0e(0x284)]==_0x4c1c0e(0x1f9))var _0x4e7a07=users['Arabic'];}}}}}}}_0x216022[_0x4c1c0e(0x2a0)](_0x4c1c0e(0x1d3),{'success':_0x5d931b['flash'](_0x4c1c0e(0x229)),'errors':_0x5d931b['flash'](_0x4c1c0e(0x20f)),'role':_0x9c0727,'profile':_0x4d0635,'master_shop':_0x36a1bc,'supplier':_0x159871,'purchase':_0x16b21d,'language':_0x4e7a07});}catch(_0x5219f7){console['log'](_0x5219f7);}}),router[a0_0x2d9e43(0x1d4)](a0_0x2d9e43(0x20b),auth,async(_0x1b2a47,_0x40effc)=>{var _0x4a1d0c=a0_0x2d9e43;try{const {username:_0x35678f,email:_0x3e0f58,role:_0x275dcc}=_0x1b2a47[_0x4a1d0c(0x25e)],_0x4dcef8=_0x1b2a47[_0x4a1d0c(0x25e)],_0x23659c=await profile['findOne']({'email':_0x4dcef8[_0x4a1d0c(0x1d5)]}),_0x2ea1ca=await master_shop[_0x4a1d0c(0x26c)]();console[_0x4a1d0c(0x236)](_0x4a1d0c(0x1b6),_0x2ea1ca);const _0x316e2e=_0x1b2a47[_0x4a1d0c(0x1b2)]['id'];console[_0x4a1d0c(0x236)](_0x316e2e);const _0x1a25f1=await purchases['findById'](_0x316e2e);console['log'](_0x4a1d0c(0x1ea),_0x1a25f1);const _0xadc54b=await product[_0x4a1d0c(0x26c)]({}),_0x3ae4df=await warehouse['aggregate']([{'$match':{'name':_0x1a25f1[_0x4a1d0c(0x239)],'room':_0x1a25f1[_0x4a1d0c(0x22f)],'warehouse_category':_0x4a1d0c(0x28e)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4a1d0c(0x283),'name':{'$first':_0x4a1d0c(0x209)},'product_stock':{'$first':_0x4a1d0c(0x1b8)},'bay':{'$first':_0x4a1d0c(0x292)},'bin':{'$first':_0x4a1d0c(0x1a4)},'type':{'$first':_0x4a1d0c(0x2a4)},'floorlevel':{'$first':_0x4a1d0c(0x246)},'primary_code':{'$first':_0x4a1d0c(0x1c1)},'secondary_code':{'$first':_0x4a1d0c(0x22c)},'product_code':{'$first':_0x4a1d0c(0x204)},'storage':{'$first':_0x4a1d0c(0x274)},'rack':{'$first':_0x4a1d0c(0x21d)}}}]);warehouse_data=await warehouse[_0x4a1d0c(0x22d)]([{'$match':{'status':'Enabled','name':'Return\x20Goods','warehouse_category':_0x4a1d0c(0x28e)}},{'$group':{'_id':'$name','name':{'$first':_0x4a1d0c(0x281)}}},{'$sort':{'name':0x1}}]),console[_0x4a1d0c(0x236)](_0x4a1d0c(0x276),_0x3ae4df);if(_0x2ea1ca[0x0][_0x4a1d0c(0x284)]=='English\x20(US)'){var _0xd31d0c=users['English'];console[_0x4a1d0c(0x236)](_0xd31d0c);}else{if(_0x2ea1ca[0x0]['language']==_0x4a1d0c(0x24a))var _0xd31d0c=users['Hindi'];else{if(_0x2ea1ca[0x0][_0x4a1d0c(0x284)]==_0x4a1d0c(0x24f))var _0xd31d0c=users[_0x4a1d0c(0x24f)];else{if(_0x2ea1ca[0x0][_0x4a1d0c(0x284)]==_0x4a1d0c(0x20c))var _0xd31d0c=users[_0x4a1d0c(0x20c)];else{if(_0x2ea1ca[0x0][_0x4a1d0c(0x284)]==_0x4a1d0c(0x271))var _0xd31d0c=users[_0x4a1d0c(0x271)];else{if(_0x2ea1ca[0x0][_0x4a1d0c(0x284)]=='Portuguese\x20(BR)')var _0xd31d0c=users[_0x4a1d0c(0x230)];else{if(_0x2ea1ca[0x0]['language']==_0x4a1d0c(0x27d))var _0xd31d0c=users[_0x4a1d0c(0x27d)];else{if(_0x2ea1ca[0x0][_0x4a1d0c(0x284)]==_0x4a1d0c(0x1f9))var _0xd31d0c=users[_0x4a1d0c(0x1c2)];}}}}}}}_0x40effc[_0x4a1d0c(0x2a0)]('return_purchase',{'success':_0x1b2a47[_0x4a1d0c(0x1a7)](_0x4a1d0c(0x229)),'errors':_0x1b2a47[_0x4a1d0c(0x1a7)]('errors'),'role':_0x4dcef8,'profile':_0x23659c,'user':_0x1a25f1,'stock':_0x3ae4df,'master_shop':_0x2ea1ca,'product':_0xadc54b,'language':_0xd31d0c,'warehouse':warehouse_data});}catch(_0x454a16){console[_0x4a1d0c(0x236)](_0x454a16);}}),router[a0_0x2d9e43(0x286)](a0_0x2d9e43(0x20b),auth,async(_0x5e6b2d,_0x329e87)=>{var _0x156e73=a0_0x2d9e43;try{const {invoice:_0x44da54,date:_0xd40d09,warehouse_name:_0x98586e,Room_name:_0x38b06c,product_name:_0x360c7a,purchase_quantity:_0x459d04,stocks:_0x57a655,return_qty:_0x5abf8b,note:_0x501579,level:_0x1278f4,isle:_0x2f0790,pallet:_0x27d1aa,to_warehouse_name:_0x25dd85,to_Room_name:_0x1ff07c}=_0x5e6b2d['body'],_0xa3dd8=await purchases['findOne']({'_id':_0x5e6b2d['params']['id']}),_0x54378e=await warehouse[_0x156e73(0x27f)]({'name':_0x98586e,'room':_0x38b06c});if(typeof _0x360c7a==_0x156e73(0x1c3))var _0x28c3e2=[_0x5e6b2d['body'][_0x156e73(0x1b9)]],_0x482da2=[_0x5e6b2d['body'][_0x156e73(0x202)]],_0x2b120c=[_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1b3)]],_0x809a8b=[_0x5e6b2d['body'][_0x156e73(0x23e)]],_0x5c31e1=[_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x19f)]],_0x3dac5e=[_0x5e6b2d[_0x156e73(0x24b)]['isle']],_0x265b35=[_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x23c)]],_0x4b3bd0=[_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x23f)]],_0x5bca1c=[_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x232)]],_0x41d3dd=[_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x260)]],_0x30125a=[_0x5e6b2d[_0x156e73(0x24b)]['secondary_code_hide']];else var _0x28c3e2=[..._0x5e6b2d[_0x156e73(0x24b)]['product_name']],_0x482da2=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x202)]],_0x2b120c=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1b3)]],_0x809a8b=[..._0x5e6b2d['body'][_0x156e73(0x23e)]],_0x5c31e1=[..._0x5e6b2d[_0x156e73(0x24b)]['level']],_0x3dac5e=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1f1)]],_0x265b35=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x23c)]],_0x4b3bd0=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x23f)]],_0x5bca1c=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x232)]],_0x41d3dd=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x260)]],_0x30125a=[..._0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1ac)]];const _0x30b8a0=_0x28c3e2['map'](_0xf48831=>{return _0xf48831={'product_name':_0xf48831};});_0x482da2[_0x156e73(0x225)]((_0x4eb3db,_0x47b4db)=>{var _0x299c87=_0x156e73;_0x30b8a0[_0x47b4db][_0x299c87(0x202)]=_0x4eb3db;}),_0x2b120c[_0x156e73(0x225)]((_0x3f38ab,_0x3435fb)=>{_0x30b8a0[_0x3435fb]['stock_quantity']=_0x3f38ab;}),_0x809a8b[_0x156e73(0x225)]((_0x251f6a,_0x5e03b4)=>{var _0x1fa2fc=_0x156e73;_0x30b8a0[_0x5e03b4][_0x1fa2fc(0x23e)]=_0x251f6a;}),_0x5c31e1['forEach']((_0x50f3d7,_0x427995)=>{var _0x44ef0b=_0x156e73;_0x30b8a0[_0x427995][_0x44ef0b(0x1be)]=_0x50f3d7;}),_0x3dac5e[_0x156e73(0x225)]((_0x339247,_0x2b08ca)=>{var _0x5590b4=_0x156e73;_0x30b8a0[_0x2b08ca][_0x5590b4(0x203)]=_0x339247;}),_0x265b35[_0x156e73(0x225)]((_0x115daa,_0x3d81a)=>{var _0x3fa8a4=_0x156e73;_0x30b8a0[_0x3d81a][_0x3fa8a4(0x1f7)]=_0x115daa;}),_0x4b3bd0['forEach']((_0x5e7369,_0xb4a8a)=>{var _0x259094=_0x156e73;_0x30b8a0[_0xb4a8a][_0x259094(0x21a)]=_0x5e7369;}),_0x5bca1c['forEach']((_0x48af9b,_0x312d2a)=>{var _0x1b7722=_0x156e73;_0x30b8a0[_0x312d2a][_0x1b7722(0x1c0)]=_0x48af9b;}),_0x41d3dd[_0x156e73(0x225)]((_0x4dc467,_0x2aad55)=>{var _0x2d0b28=_0x156e73;_0x30b8a0[_0x2aad55][_0x2d0b28(0x1ee)]=_0x4dc467;}),_0x30125a[_0x156e73(0x225)]((_0x18ed9d,_0x5dbdbe)=>{var _0xdc1499=_0x156e73;_0x30b8a0[_0x5dbdbe][_0xdc1499(0x223)]=_0x18ed9d;}),_0xa3dd8[_0x156e73(0x1cf)]['forEach'](_0x262060=>{var _0x11cd91=_0x156e73;const _0x30a49a=_0x54378e[_0x11cd91(0x201)][_0x11cd91(0x1a1)](_0x55f9e3=>{var _0x472839=_0x11cd91;_0x55f9e3[_0x472839(0x1b9)]==_0x262060[_0x472839(0x1b9)]&&_0x55f9e3[_0x472839(0x1f7)]==_0x262060[_0x472839(0x1f7)]&&_0x55f9e3['type']==_0x262060[_0x472839(0x21a)]&&_0x55f9e3['bin']==_0x262060['bin']&&_0x55f9e3['bay']==_0x262060[_0x472839(0x1be)]&&_0x55f9e3['rack']==_0x262060[_0x472839(0x1ed)]&&_0x55f9e3[_0x472839(0x2a8)]==_0x262060[_0x472839(0x2a8)]&&(console['log'](parseInt(_0x55f9e3[_0x472839(0x1e8)])+_0x472839(0x27e)+parseInt(_0x262060[_0x472839(0x21b)])),_0x55f9e3[_0x472839(0x1e8)]=parseInt(_0x55f9e3[_0x472839(0x1e8)])+parseInt(_0x262060[_0x472839(0x21b)]));});}),await _0x54378e['save']();const _0x2aa0ed=_0x30b8a0[_0x156e73(0x245)](_0x277449=>_0x277449[_0x156e73(0x23e)]!=='0'&&_0x277449[_0x156e73(0x23e)]!=='');var _0x3e3fd3=0x0;_0x2aa0ed[_0x156e73(0x225)](_0x473aa6=>{var _0x278f95=_0x156e73;console[_0x278f95(0x236)]('foreach\x20newproduct',_0x473aa6),(parseInt(_0x473aa6[_0x278f95(0x202)])<parseInt(_0x473aa6[_0x278f95(0x23e)])||parseInt(_0x473aa6['stock_quantity'])<parseInt(_0x473aa6[_0x278f95(0x23e)]))&&_0x3e3fd3++;});if(_0x3e3fd3!=0x0)return _0x5e6b2d[_0x156e73(0x1a7)](_0x156e73(0x20f),_0x156e73(0x26e)),_0x329e87[_0x156e73(0x265)]('back');const _0x498b4=new purchases_return({'invoice':_0x44da54,'suppliers':_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1b7)],'date':_0xd40d09,'warehouse_name':_0x98586e,'return_product':_0x2aa0ed,'note':_0x501579,'room':_0x38b06c,'to_warehouse_name':_0x25dd85,'to_room':_0x1ff07c}),_0x41a63d=await _0x498b4[_0x156e73(0x1f0)]();console[_0x156e73(0x236)](_0x498b4);const _0x3650df=await purchases_return[_0x156e73(0x27f)]({'invoice':_0x44da54}),_0x28429d=await warehouse[_0x156e73(0x27f)]({'name':_0x25dd85,'room':_0x1ff07c});_0x3650df[_0x156e73(0x298)][_0x156e73(0x225)](_0x5e9919=>{var _0x3b8337=_0x156e73,_0x65139c=0x0;const _0x2dc51f=_0x28429d[_0x3b8337(0x201)][_0x3b8337(0x1a1)](_0x5dd3c1=>{var _0x124196=_0x3b8337;_0x5dd3c1[_0x124196(0x1b9)]==_0x5e9919[_0x124196(0x1b9)]&&_0x5dd3c1['floorlevel']==_0x5e9919['floorlevel']&&_0x5dd3c1[_0x124196(0x21a)]==_0x5e9919[_0x124196(0x21a)]&&_0x5dd3c1[_0x124196(0x203)]==_0x5e9919[_0x124196(0x203)]&&_0x5dd3c1['bay']==_0x5e9919['bay']&&(_0x5dd3c1['product_stock']=parseInt(_0x5dd3c1[_0x124196(0x1e8)])-parseInt(_0x5e9919[_0x124196(0x23e)]),_0x65139c++);});_0x65139c=='0'&&(_0x28429d[_0x3b8337(0x201)]=_0x28429d[_0x3b8337(0x201)][_0x3b8337(0x1e1)]({'product_name':_0x5e9919[_0x3b8337(0x1b9)],'product_stock':_0x5e9919['return_qty'],'primary_code':_0x5e9919['primary_code'],'secondary_code':_0x5e9919[_0x3b8337(0x223)],'product_code':_0x5e9919[_0x3b8337(0x1c0)],'storage':_0x5e9919[_0x3b8337(0x2a8)],'rack':_0x5e9919['rack'],'bay':_0x5e9919[_0x3b8337(0x1be)],'bin':_0x5e9919['bin'],'type':_0x5e9919[_0x3b8337(0x21a)],'floorlevel':_0x5e9919[_0x3b8337(0x1f7)],'maxProducts':_0x5e9919[_0x3b8337(0x28a)],'unit':_0x5e9919[_0x3b8337(0x267)],'secondary_unit':_0x5e9919[_0x3b8337(0x1d0)],'expiry_date':_0x5e9919[_0x3b8337(0x29f)]}));}),await _0x28429d['save']();const _0x118a36=await purchases[_0x156e73(0x27f)]({'invoice':_0x44da54});_0x118a36[_0x156e73(0x1e7)]=_0x156e73(0x1f2);const _0x170421=await _0x118a36[_0x156e73(0x1f0)](),_0x58f653=new s_payment_data({'invoice':_0x44da54,'suppliers':_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1b7)],'reason':_0x156e73(0x2a6)});await _0x58f653[_0x156e73(0x1f0)]();const _0x2d9e9f=await master_shop['find']();console['log'](_0x156e73(0x220),_0x2d9e9f[0x0][_0x156e73(0x1e6)]);const _0x59ede5=await email_settings['findOne'](),_0x21e18b=await suppliers[_0x156e73(0x27f)]({'name':_0x5e6b2d[_0x156e73(0x24b)][_0x156e73(0x1b7)]});console[_0x156e73(0x236)](_0x156e73(0x273),_0x21e18b);_0x2d9e9f[0x0]['currency_placement']==0x1?(right_currency=_0x2d9e9f[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x2d9e9f[0x0][_0x156e73(0x243)]);var _0x25d873=_0x28c3e2,_0x70c9de=_0x809a8b,_0x4ea39f='',_0x41b12f;for(_0x41b12f in _0x25d873){_0x4ea39f+='<tr>'+_0x156e73(0x253)+_0x25d873[_0x41b12f]+_0x156e73(0x28d)+_0x156e73(0x253)+_0x70c9de[_0x41b12f]+_0x156e73(0x28d)+'</tr>';}console[_0x156e73(0x236)](_0x156e73(0x2a5),_0x4ea39f);let _0x396d45=nodemailer[_0x156e73(0x1ad)]({'service':_0x156e73(0x297),'auth':{'user':_0x59ede5[_0x156e73(0x1d5)],'pass':_0x59ede5['password']}}),_0x592b89={'from':_0x59ede5['email'],'to':_0x21e18b['email'],'subject':_0x156e73(0x19c),'attachments':[{'filename':'Logo.png','path':__dirname+_0x156e73(0x233)+_0x156e73(0x20d)+_0x2d9e9f[0x0]['image'],'cid':'logo'}],'html':_0x156e73(0x272)+'<html><head><title></title>'+_0x156e73(0x25b)+_0x156e73(0x231)+_0x156e73(0x1fa)+'<div>'+_0x156e73(0x299)+_0x156e73(0x268)+_0x156e73(0x231)+_0x156e73(0x293)+_0x2d9e9f[0x0][_0x156e73(0x252)]+'\x20</h2>'+'</div>'+_0x156e73(0x268)+_0x156e73(0x255)+_0x156e73(0x231)+_0x156e73(0x256)+'\x20Order\x20Number\x20:\x20'+_0x44da54+'\x20'+_0x156e73(0x1d6)+_0x156e73(0x1b4)+_0xd40d09+'\x20'+_0x156e73(0x1c6)+'</h5>'+_0x156e73(0x268)+_0x156e73(0x1bb)+_0x156e73(0x1d2)+_0x156e73(0x266)+_0x156e73(0x221)+_0x156e73(0x275)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x156e73(0x1bd)+_0x156e73(0x212)+_0x156e73(0x22e)+_0x156e73(0x291)+'\x20'+_0x4ea39f+'\x20'+_0x156e73(0x21c)+_0x156e73(0x1a5)+_0x156e73(0x231)+'<strong>\x20Regards\x20</strong>'+_0x156e73(0x235)+_0x2d9e9f[0x0][_0x156e73(0x252)]+_0x156e73(0x24c)+_0x156e73(0x268)+_0x156e73(0x268)+_0x156e73(0x2a2)};_0x396d45[_0x156e73(0x244)](_0x592b89,function(_0x29d2d3,_0x5cf22f){var _0x562056=_0x156e73;_0x29d2d3?(console[_0x562056(0x236)](_0x29d2d3),console[_0x562056(0x236)](_0x562056(0x1b0))):console[_0x562056(0x236)]('Email\x20sent\x20successfully');}),_0x5e6b2d[_0x156e73(0x1a7)](_0x156e73(0x229),_0x156e73(0x21f)),_0x329e87[_0x156e73(0x265)]('/all_purchases/view');}catch(_0x426d5c){console[_0x156e73(0x236)](_0x426d5c),_0x329e87['status'](0xc8)[_0x156e73(0x247)]({'message':_0x426d5c[_0x156e73(0x19a)]});}}),router['get']('/barcode/:id',auth,async(_0x17fa68,_0x381cfb)=>{var _0x34e1eb=a0_0x2d9e43;try{const {username:_0x1535ea,email:_0x4fff60,role:_0x392fb6}=_0x17fa68['user'],_0x1c6a18=_0x17fa68['user'],_0x1eb1f2=await profile['findOne']({'email':_0x1c6a18[_0x34e1eb(0x1d5)]}),_0x1a2767=await master_shop[_0x34e1eb(0x26c)](),_0x2f793c=_0x17fa68['params']['id'],_0x5258a1=await purchases[_0x34e1eb(0x1cb)](_0x2f793c);if(_0x1a2767[0x0]['language']==_0x34e1eb(0x22a))var _0x50860a=users['English'];else{if(_0x1a2767[0x0]['language']=='Hindi')var _0x50860a=users[_0x34e1eb(0x24a)];else{if(_0x1a2767[0x0][_0x34e1eb(0x284)]=='German')var _0x50860a=users[_0x34e1eb(0x24f)];else{if(_0x1a2767[0x0]['language']=='Spanish')var _0x50860a=users[_0x34e1eb(0x20c)];else{if(_0x1a2767[0x0][_0x34e1eb(0x284)]=='French')var _0x50860a=users[_0x34e1eb(0x271)];else{if(_0x1a2767[0x0][_0x34e1eb(0x284)]==_0x34e1eb(0x1f6))var _0x50860a=users[_0x34e1eb(0x230)];else{if(_0x1a2767[0x0][_0x34e1eb(0x284)]==_0x34e1eb(0x27d))var _0x50860a=users[_0x34e1eb(0x27d)];else{if(_0x1a2767[0x0][_0x34e1eb(0x284)]==_0x34e1eb(0x1f9))var _0x50860a=users['Arabic'];}}}}}}}_0x381cfb[_0x34e1eb(0x2a0)]('all_purchases_barcode',{'success':_0x17fa68['flash']('success'),'errors':_0x17fa68['flash'](_0x34e1eb(0x20f)),'role':_0x1c6a18,'profile':_0x1eb1f2,'alldata':_0x5258a1,'master_shop':_0x1a2767,'language':_0x50860a}),console[_0x34e1eb(0x236)](alldata);}catch(_0x2285e3){console['log'](_0x2285e3);}}),router['post'](a0_0x2d9e43(0x1f4),async(_0x12a55b,_0xb6355d)=>{var _0x28c016=a0_0x2d9e43;const {product_code:_0x22ccd7}=_0x12a55b[_0x28c016(0x24b)];var _0x48b117;const _0x111b13=await product[_0x28c016(0x22d)]([{'$match':{'primary_code':_0x22ccd7,'product_category':_0x28c016(0x28e)}},{'$group':{'_id':_0x28c016(0x226),'name':{'$first':_0x28c016(0x281)},'category':{'$first':_0x28c016(0x257)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x28c016(0x277)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x28c016(0x1ab)},'secondary_code':{'$first':_0x28c016(0x1d7)},'maxStocks':{'$first':_0x28c016(0x251)},'maxProdPerUnit':{'$first':_0x28c016(0x20a)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x28c016(0x285)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1435f6=await product[_0x28c016(0x22d)]([{'$match':{'secondary_code':_0x22ccd7,'product_category':_0x28c016(0x28e)}},{'$group':{'_id':'$_id','name':{'$first':'$name'},'category':{'$first':_0x28c016(0x257)},'brand':{'$first':'$brand'},'unit':{'$first':_0x28c016(0x210)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x28c016(0x1ef)},'primary_code':{'$first':_0x28c016(0x1ab)},'secondary_code':{'$first':_0x28c016(0x1d7)},'maxStocks':{'$first':_0x28c016(0x251)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x28c016(0x285)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x111b13['length']>0x0)_0x48b117=_0x111b13;else _0x1435f6['length']>0x0&&(_0x48b117=_0x1435f6);_0xb6355d[_0x28c016(0x247)](_0x48b117);}),router[a0_0x2d9e43(0x286)](a0_0x2d9e43(0x1e4),async(_0x5a3c86,_0x4bf6fd)=>{var _0x24c949=a0_0x2d9e43;const {primaryCode:_0x1beafc,secondaryCode:_0x5c8eb0,productCode:_0x4c0287,bay:_0x5fe51e,bin:_0x44c355,types:_0xfe3d9d,pallet:_0x56087b,warehouses:_0x2d387a,room:_0x16b30d}=_0x5a3c86[_0x24c949(0x24b)];console[_0x24c949(0x236)](_0x5a3c86[_0x24c949(0x24b)]);try{const _0x304e1a=await warehouse[_0x24c949(0x22d)]([{'$match':{'name':_0x2d387a,'room':_0x16b30d}},{'$unwind':_0x24c949(0x1f3)},{'$match':{'product_details.bay':_0x5fe51e,'product_details.bin':_0x44c355,'product_details.type':_0xfe3d9d}},{'$group':{'_id':_0x24c949(0x283),'name':{'$first':_0x24c949(0x209)},'product_stock':{'$first':_0x24c949(0x1b8)},'level':{'$first':_0x24c949(0x19b)},'isle':{'$first':_0x24c949(0x1dd)},'pallet':{'$first':_0x24c949(0x21e)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4bf6fd[_0x24c949(0x1d9)](0xc8)['json'](_0x304e1a);}catch(_0x4de257){_0x4bf6fd['status'](0x194)[_0x24c949(0x247)]({'message':_0x4de257[_0x24c949(0x19a)]});}}),module[a0_0x2d9e43(0x29d)]=router;