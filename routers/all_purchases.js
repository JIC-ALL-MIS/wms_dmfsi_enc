var a0_0x47faad=a0_0x43fb;(function(_0x4427e1,_0x9cf6d4){var _0xcaa294=a0_0x43fb,_0x56fb5c=_0x4427e1();while(!![]){try{var _0x2774c3=-parseInt(_0xcaa294(0x1ac))/0x1+-parseInt(_0xcaa294(0x1a5))/0x2*(parseInt(_0xcaa294(0x15c))/0x3)+parseInt(_0xcaa294(0x13d))/0x4*(-parseInt(_0xcaa294(0x164))/0x5)+parseInt(_0xcaa294(0x1c0))/0x6+-parseInt(_0xcaa294(0x1d4))/0x7*(-parseInt(_0xcaa294(0x139))/0x8)+-parseInt(_0xcaa294(0x19e))/0x9*(-parseInt(_0xcaa294(0x14d))/0xa)+parseInt(_0xcaa294(0x1b4))/0xb;if(_0x2774c3===_0x9cf6d4)break;else _0x56fb5c['push'](_0x56fb5c['shift']());}catch(_0x425075){_0x56fb5c['push'](_0x56fb5c['shift']());}}}(a0_0x59a1,0x9e529));const express=require(a0_0x47faad(0x142)),app=express(),router=express[a0_0x47faad(0x176)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x47faad(0x13a)),auth=require(a0_0x47faad(0x12c)),nodemailer=require('nodemailer');var ejs=require(a0_0x47faad(0x148));const path=require(a0_0x47faad(0x1ec)),users=require(a0_0x47faad(0x102));function a0_0x43fb(_0x1d764d,_0x5a40e1){var _0x59a11b=a0_0x59a1();return a0_0x43fb=function(_0x43fb02,_0x3bd5fd){_0x43fb02=_0x43fb02-0xf5;var _0x34a665=_0x59a11b[_0x43fb02];return _0x34a665;},a0_0x43fb(_0x1d764d,_0x5a40e1);}function a0_0x59a1(){var _0x58ecaf=['../models/all_models','/preview/:id','Email\x20sent\x20successfully','4JxSJnl','Rack\x20B','port','/all_purchases/view/','/CheckingWarehouse','express','$product.room_name','<h5>','</tr>','invoice','$product_details.maxProducts','ejs','concat','/view/:id','bin','delivery_date','662000mYpTkM','success','<strong>\x20Regards\x20</strong>','log','host','all','$product_details.pallet','$product.bin','$primary_code','edit_purchases_view','$product_details.product_stock','$date','prod_unit','/barcode_scanner','redirect','3SGVmOS','RoomAssign','Purchase\x20Return\x20Mail','edit_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','floor','add_purchases','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','3314565elIfvp','abs','type','<h2>\x20','deliverycode','standard_unit','English','Ambient','stock_data','prod_code','English\x20(US)','Raw\x20Materials','$product.bay','$brand','length','<tr>','batch_code','maxStocks','Router','$invoice','True','$_id','string','<tbody\x20style=\x22text-align:\x20center;\x22>','staff','</table>','storage','$unit','</tbody>','paid_amount','payment\x20successfull','$product_details','site_title','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','max_product_unit','$product_details.product_name','$due_amount','$product_details.level','<div>','filter','/barcode/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','prod_level','$suppliers_docs','Room_name','types','purchase\x20data\x20update\x20successfully','note','/give_payment/:id','</h5>','padStart','$product_details.floorlevel','</body></html>','save','secondary_unit','prod_Qty','production_date','email','36kYGWBx','$maxProdPerUnit','product_list','</span>','product_code_hide','Return\x20Goods','\x20Order\x20Date\x20:\x20','2068366OFWvKM','$category','aggregate','$product_details.product_code','$product_code','isle','catch','617020UtFrxn','$product_details.bay','toString','Shelves','$product_details.rack','Chinese','Arabic','findOne','11161359HTtNty','/view/return_purchase/:id','\x20<\x20wew\x20>\x20','body','createTransport','delivery_code','status','bay','render','</td>','$product_details.bin','room_name','7424802GPcIxo','prod_qty','prod_pallet','message','name','$alertquantity','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','getMonth','$product_details.type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','RMSEmail','prod_invoice','\x20Order\x20Number\x20:\x20','currency_placement','quantity','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/view/add_purchases','445669JzAlKo','Error\x20Occurs','Receiving\x20Area','product_code','</div>','DRY\x20STORAGE','Portuguese\x20(BR)','currency','$expiry_date','find','rack','<span\x20style=\x22float:\x20right;\x22>','json','Rack\x20D','product','gmail','Logo.png','Level','$warehouse_name','logo','prod_primunit','maxperunit','$product_details.isle','back','path','/invoice/:id','alertQTY','$product_details.primary_code','prod_name','date','return_purchase','due_amount','An\x20error\x20occurred\x20while\x20saving\x20data.','return_product','here','INC-','slice','\x20</h2>','all_purchases','/all_purchases/view','primary_code','</head><body>','user_id','amount','push','stock_quantity','flash','secondary_code_hide','purchases\x20item\x20return\x20successfull','get','$product.floorlevel','product_stock','getDate','level','$product.quantity','Purchase\x20Return','$secondary_code','Rack\x20E','findById','sendMail','user','$product_details._id','/upload/','Arabic\x20(ae)','stocks','Rack\x20F','$paid_amount','German','errors','suppliers_data','secondary_code','$product_details.storage','image','warehouse','$suppliers','return_qty','There\x27s\x20a\x20error\x20in\x20this\x20transaction','actual_uom','random','\x20<>\x20','/view/add_purchases/:id','master','Floor','COLD\x20STORAGE','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$maxStocks','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../public/language/languages.json','finalize','forEach','all_purchases_barcode','suppliers_docs','$product.type','Purchase\x20Mail','<h5\x20style=\x22text-align:\x20left;\x22>','params','actual_qty','primary_code_hide','product_name','then','MaxStocks_data','role','prod_secondunit','$finalize','$product','Hindi','Enclosed','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','floorlevel','error','room','$return_data','return_data','$batch_code','table\x20page','$name','Rack\x20A','post','<table\x20style=\x22width:\x20100%\x20!important;\x22>','suppliers','<!DOCTYPE\x20html>','French','language','$note','prod_isle','password','product_details','POnumber','../middleware/auth','product_cat','prod_cat','purchase_invoice','expiry_date','Spanish','<html><head><title></title>','purchase_quantity','pallet','Portuguese','Enabled','$room','getFullYear','56XtxJBk'];a0_0x59a1=function(){return _0x58ecaf;};return a0_0x59a1();}router[a0_0x47faad(0x205)]('/view',auth,async(_0x1b3df7,_0x57589a)=>{var _0x206300=a0_0x47faad;try{const {username:_0x33ec2c,email:_0x575207,role:_0x291074}=_0x1b3df7[_0x206300(0x210)],_0x3ee556=_0x1b3df7[_0x206300(0x210)],_0x2ee74b=await profile['findOne']({'email':_0x3ee556[_0x206300(0x19d)]}),_0x6f2d60=await staff[_0x206300(0x1b3)]({'email':_0x3ee556['email']});if(_0x3ee556[_0x206300(0x110)]=='staff'){const _0x556345=await staff[_0x206300(0x1b3)]({'email':_0x3ee556['email']});}const _0x302ef0=await master_shop[_0x206300(0x1dd)]();let _0x4c4051;if(_0x3ee556[_0x206300(0x110)]==_0x206300(0x17c)){const _0x96aabe=await staff[_0x206300(0x1b3)]({'email':_0x3ee556['email']});_0x4c4051=await purchases[_0x206300(0x1a7)]([{'$match':{'warehouse_name':_0x96aabe[_0x206300(0x21d)]}},{'$lookup':{'from':'suppliers','localField':_0x206300(0x123),'foreignField':_0x206300(0x1c4),'as':_0x206300(0x106)}},{'$unwind':_0x206300(0x18f)},{'$unwind':'$product'},{'$group':{'_id':_0x206300(0x179),'invoice':{'$first':_0x206300(0x177)},'suppliers':{'$first':_0x206300(0x21e)},'date':{'$first':_0x206300(0x158)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$first':_0x206300(0x137)},'product':{'$push':_0x206300(0x113)},'note':{'$first':_0x206300(0x127)},'paid_amount':{'$first':_0x206300(0x216)},'due_amount':{'$first':_0x206300(0x188)},'return_data':{'$first':_0x206300(0x11b)},'batch_code':{'$first':_0x206300(0x11d)},'expiry_date':{'$first':_0x206300(0x1dc)},'suppliers_docs':{'$first':_0x206300(0x18f)},'total_product_quantity':{'$sum':_0x206300(0x20a)},'level':{'$addToSet':_0x206300(0x170)},'isle':{'$addToSet':_0x206300(0x154)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x4c4051=await purchases[_0x206300(0x1a7)]([{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':_0x206300(0x1c4),'as':_0x206300(0x106)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x206300(0x179),'invoice':{'$first':_0x206300(0x177)},'suppliers':{'$first':'$suppliers'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x206300(0x1e6)},'room':{'$addToSet':_0x206300(0x143)},'product':{'$push':'$product'},'note':{'$first':_0x206300(0x127)},'paid_amount':{'$first':_0x206300(0x216)},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x206300(0x11d)},'expiry_date':{'$first':_0x206300(0x1dc)},'suppliers_docs':{'$first':_0x206300(0x18f)},'total_product_quantity':{'$sum':_0x206300(0x20a)},'level':{'$addToSet':_0x206300(0x170)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x206300(0x107)},'floorlevel':{'$addToSet':_0x206300(0x206)},'finalize':{'$first':_0x206300(0x112)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x302ef0[0x0][_0x206300(0x126)]==_0x206300(0x16e)){var _0x58a1c7=users[_0x206300(0x16a)];console[_0x206300(0x150)](_0x58a1c7);}else{if(_0x302ef0[0x0][_0x206300(0x126)]==_0x206300(0x114))var _0x58a1c7=users[_0x206300(0x114)];else{if(_0x302ef0[0x0][_0x206300(0x126)]==_0x206300(0x217))var _0x58a1c7=users[_0x206300(0x217)];else{if(_0x302ef0[0x0][_0x206300(0x126)]==_0x206300(0x131))var _0x58a1c7=users['Spanish'];else{if(_0x302ef0[0x0]['language']=='French')var _0x58a1c7=users[_0x206300(0x125)];else{if(_0x302ef0[0x0]['language']==_0x206300(0x1da))var _0x58a1c7=users[_0x206300(0x135)];else{if(_0x302ef0[0x0]['language']==_0x206300(0x1b1))var _0x58a1c7=users[_0x206300(0x1b1)];else{if(_0x302ef0[0x0][_0x206300(0x126)]==_0x206300(0x213))var _0x58a1c7=users[_0x206300(0x1b2)];}}}}}}}_0x57589a[_0x206300(0x1bc)](_0x206300(0x1fa),{'success':_0x1b3df7['flash']('success'),'errors':_0x1b3df7[_0x206300(0x202)](_0x206300(0x218)),'purchases':_0x4c4051,'role':_0x3ee556,'profile':_0x2ee74b,'master_shop':_0x302ef0,'language':_0x58a1c7});}catch(_0xb11822){console['log'](_0x206300(0x11e),_0xb11822),_0x57589a[_0x206300(0x1ba)](0xc8)[_0x206300(0x1e0)]({'message':_0xb11822[_0x206300(0x1c3)]});}});function BayBinSelected(_0x27e6b6,_0x550c61){var _0x5c3a9c=a0_0x47faad,_0x1a0a0e=[],_0x1c9870=[],_0x1efa24=[],_0x452c0d=[],_0x23569a=[],_0x1817da=[];let _0x2e86e8=[];if(_0x27e6b6==_0x5c3a9c(0x1d9))switch(_0x550c61){case _0x5c3a9c(0x120):_0x1a0a0e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x1c9870=[0x1,0x2],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=[_0x5c3a9c(0x1e5),_0x5c3a9c(0xfc)],_0x23569a=['D'],_0x1817da=['A'];break;case'Rack\x20B':_0x1a0a0e=[0x6,0x5,0x4,0x3,0x2,0x1],_0x1c9870=[0x1,0x2],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=[_0x5c3a9c(0x1e5),_0x5c3a9c(0xfc)],_0x23569a=['D'],_0x1817da=['B'];break;case _0x5c3a9c(0x1af):_0x1a0a0e=[0x0],_0x1c9870=[0x0],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=[_0x5c3a9c(0xfc)],_0x23569a=['D'],_0x1817da=['S'];break;case _0x5c3a9c(0x1d6):_0x1a0a0e=[0x0],_0x1c9870=[0x0],_0x452c0d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x1efa24=['Floor'],_0x23569a=['D'],_0x1817da=['R'];break;}else{if(_0x27e6b6==_0x5c3a9c(0xfd))switch(_0x550c61){case _0x5c3a9c(0x120):_0x1a0a0e=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x1c9870=['B','F'],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=['Level','Floor'],_0x23569a=['C'],_0x1817da=['A'];break;case _0x5c3a9c(0x13e):_0x1a0a0e=[0x5,0x4,0x3,0x2,0x1],_0x1c9870=['F','B','S'],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=[_0x5c3a9c(0x1e5),_0x5c3a9c(0xfc)],_0x23569a=['C'],_0x1817da=['B'];break;case'Rack\x20C':_0x1a0a0e=[0x1,0x2,0x3,0x4,0x5],_0x1c9870=['B','F','S'],_0x452c0d=[0x5,0x4,0x3,0x2,0x1],_0x1efa24=['Level',_0x5c3a9c(0xfc)],_0x23569a=['C'],_0x1817da=['C'];break;case _0x5c3a9c(0x1e1):_0x1a0a0e=[0x5,0x4,0x3,0x2,0x1],_0x1c9870=['F','B','S'],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=['Level',_0x5c3a9c(0xfc)],_0x23569a=['C'],_0x1817da=['D'];break;case _0x5c3a9c(0x20d):_0x1a0a0e=[0x4,0x3,0x2,0x1],_0x1c9870=[0x1,0x2],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=[_0x5c3a9c(0x1e5),_0x5c3a9c(0xfc)],_0x23569a=['C'],_0x1817da=['E'];break;case _0x5c3a9c(0x215):_0x1a0a0e=[0x1,0x2,0x3],_0x1c9870=[0x1,0x2],_0x452c0d=[0x1,0x2,0x3,0x4,0x5],_0x1efa24=[_0x5c3a9c(0x1e5)],_0x23569a=['C'],_0x1817da=['F'];break;}}return{'levels':_0x1a0a0e,'Isle':_0x1c9870,'rack':_0x452c0d,'type':_0x1efa24,'storage':_0x23569a,'rak':_0x1817da};}async function getRandom8DigitNumber(){var _0xf2ba21=a0_0x47faad;const _0x3c9b7a=0x989680,_0x7bc688=0x5f5e0ff,_0x1da956=Math[_0xf2ba21(0x161)](Math[_0xf2ba21(0xf8)]()*(_0x7bc688-_0x3c9b7a+0x1))+_0x3c9b7a;var _0x224e87;const _0x9ce843=await purchases[_0xf2ba21(0x1b3)]({'invoice':_0xf2ba21(0x1f7)+_0x1da956});return _0x9ce843&&_0x9ce843[_0xf2ba21(0x172)]>0x0?_0x224e87='INC-'+_0x1da956:_0x224e87=_0xf2ba21(0x1f7)+_0x1da956,_0x224e87;}router[a0_0x47faad(0x205)](a0_0x47faad(0x1d3),auth,async(_0x468d5b,_0x42431c)=>{var _0xca74a3=a0_0x47faad;try{const {username:_0x4350fd,email:_0x2a6cad,role:_0xc5c9f3}=_0x468d5b['user'],_0x1b64c3=_0x468d5b['user'],_0x4a4fbf=await profile[_0xca74a3(0x1b3)]({'email':_0x1b64c3[_0xca74a3(0x19d)]}),_0x53eaa1=await master_shop[_0xca74a3(0x1dd)](),_0x3f2b0a=await staff[_0xca74a3(0x1b3)]({'email':_0x1b64c3[_0xca74a3(0x19d)]}),_0x5554df=await suppliers[_0xca74a3(0x1dd)]({});let _0x58c7c8;if(_0x1b64c3[_0xca74a3(0x110)]==_0xca74a3(0x17c)){const _0x48cdde=await staff[_0xca74a3(0x1b3)]({'email':_0x1b64c3['email']});_0x58c7c8=await warehouse[_0xca74a3(0x1a7)]([{'$match':{'status':'Enabled','name':_0x48cdde[_0xca74a3(0x21d)],'warehouse_category':_0xca74a3(0x16f),'name':{'$ne':_0xca74a3(0x1a3)}}},{'$group':{'_id':_0xca74a3(0x11f),'name':{'$first':_0xca74a3(0x11f)}}}]);}else _0x58c7c8=await warehouse['aggregate']([{'$match':{'status':_0xca74a3(0x136),'warehouse_category':_0xca74a3(0x16f),'name':{'$ne':_0xca74a3(0x1a3)}}},{'$group':{'_id':_0xca74a3(0x11f),'name':{'$first':'$name'}}}]);const _0x4c9899=await product[_0xca74a3(0x1dd)]({}),_0x570467=await warehouse[_0xca74a3(0x1dd)]({'status':'Enabled'}),_0x590206=await purchases[_0xca74a3(0x1dd)]({}),_0x4bb0de=_0x590206[_0xca74a3(0x172)]+0x1,_0x249364=_0xca74a3(0x1f7)+_0x4bb0de[_0xca74a3(0x1ae)]()[_0xca74a3(0x196)](0x5,'0');var _0x1a1b26=[_0xca74a3(0x16b),_0xca74a3(0x115)];if(_0x53eaa1[0x0][_0xca74a3(0x126)]==_0xca74a3(0x16e))var _0x1546b5=users['English'];else{if(_0x53eaa1[0x0][_0xca74a3(0x126)]==_0xca74a3(0x114))var _0x1546b5=users[_0xca74a3(0x114)];else{if(_0x53eaa1[0x0][_0xca74a3(0x126)]==_0xca74a3(0x217))var _0x1546b5=users['German'];else{if(_0x53eaa1[0x0][_0xca74a3(0x126)]==_0xca74a3(0x131))var _0x1546b5=users[_0xca74a3(0x131)];else{if(_0x53eaa1[0x0][_0xca74a3(0x126)]==_0xca74a3(0x125))var _0x1546b5=users[_0xca74a3(0x125)];else{if(_0x53eaa1[0x0]['language']==_0xca74a3(0x1da))var _0x1546b5=users[_0xca74a3(0x135)];else{if(_0x53eaa1[0x0][_0xca74a3(0x126)]=='Chinese')var _0x1546b5=users['Chinese'];else{if(_0x53eaa1[0x0]['language']=='Arabic\x20(ae)')var _0x1546b5=users[_0xca74a3(0x1b2)];}}}}}}}const _0x33dc7f=getRandom8DigitNumber();_0x33dc7f[_0xca74a3(0x10e)](_0x546939=>{var _0x59a681=_0xca74a3;_0x42431c[_0x59a681(0x1bc)](_0x59a681(0x162),{'success':_0x468d5b[_0x59a681(0x202)](_0x59a681(0x14e)),'errors':_0x468d5b[_0x59a681(0x202)]('errors'),'role':_0x1b64c3,'profile':_0x4a4fbf,'suppliers':_0x5554df,'warehouse':_0x58c7c8,'product':_0x4c9899,'invoice':_0x546939,'master_shop':_0x53eaa1,'language':_0x1546b5,'find_data':_0x570467,'rooms_data':_0x1a1b26});})[_0xca74a3(0x1ab)](_0x599748=>{var _0x54cae0=_0xca74a3;_0x468d5b[_0x54cae0(0x202)](_0x54cae0(0x218),_0x54cae0(0xf6)),_0x42431c[_0x54cae0(0x15b)](_0x54cae0(0x1fb));});}catch(_0x43a3b2){console[_0xca74a3(0x150)](_0x43a3b2);}}),router['get'](a0_0x47faad(0xfa),auth,async(_0x2f54f3,_0x277706)=>{var _0x1abcda=a0_0x47faad;try{const _0x463322=_0x2f54f3['params']['id'];console[_0x1abcda(0x150)](_0x463322);const _0xa6d292=await master_shop[_0x1abcda(0x1dd)]();console[_0x1abcda(0x150)](_0x1abcda(0xfb),_0xa6d292);const _0x384a50=await product[_0x1abcda(0x1b3)]({'name':_0x463322});console[_0x1abcda(0x150)](_0x1abcda(0x1e2),_0x384a50),_0x277706[_0x1abcda(0x1ba)](0xc8)['json']({'product_data':_0x384a50,'master':_0xa6d292});}catch(_0x2bf6a3){console['log']('add_purchases\x20error',_0x2bf6a3);}}),router[a0_0x47faad(0x121)]('/view/add_purchases',auth,async(_0x6eb482,_0x3ea84f)=>{var _0x4047c8=a0_0x47faad;try{const {invoice:_0x4530ce,date:_0x458060,warehouse_name:_0x1df031,prod_name:_0x19df29,prod_code:_0x156ce1,prod_qty:_0x5cf789,prod_unit:_0x4c0d90,prod_secondunit:_0x19cb9d,prod_level:_0x5ec8c9,prod_isle:_0x3b6635,prod_pallet:_0x1a6f2e,note:_0x341fe4,expiry_date:_0x69eff9,batch_code:_0x51c62b,payable:_0x3dc164,due_amount:_0x43d76f,Room_name:_0xbb499f,primary_code:_0x534698,secondary_code:_0x3082b1,MaxStocks_data:_0x20a5ed,PO_number:_0x436ed2,SCRN:_0x2e7740,JO_number:_0x46e973}=_0x6eb482[_0x4047c8(0x1b7)];if(typeof _0x19df29==_0x4047c8(0x17a))var _0x693e67=[_0x6eb482[_0x4047c8(0x1b7)]['prod_name']],_0x2a4982=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x16d)]],_0x5b1319=[_0x6eb482['body'][_0x4047c8(0x19b)]],_0x1435de=[_0x6eb482['body'][_0x4047c8(0x1e8)]],_0x557bd7=[_0x6eb482[_0x4047c8(0x1b7)]['prod_secondunit']],_0x3d24fa=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x18e)]],_0x3aa54b=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x1fc)]],_0x5f2e77=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x21a)]],_0x2eb27a=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x10f)]],_0x1035b6=[_0x6eb482[_0x4047c8(0x1b7)]['batch_code']],_0x3fddaa=[_0x6eb482[_0x4047c8(0x1b7)]['expiry_date']],_0x726b61=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x186)]],_0x35fbc7=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x1ee)]],_0xdff7a3=[_0x6eb482[_0x4047c8(0x1b7)]['production_date']],_0x5ecff6=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x12e)]],_0x2d7dd8=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x15d)]],_0x15708d=[_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x168)]],_0x104dbf=[_0x6eb482['body'][_0x4047c8(0x1cc)]],_0xe08233=[_0x6eb482[_0x4047c8(0x1b7)]['actual_qty']],_0x43d7f4=[_0x6eb482[_0x4047c8(0x1b7)]['actual_uom']];else var _0x693e67=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x1f0)]],_0x2a4982=[..._0x6eb482['body'][_0x4047c8(0x16d)]],_0x5b1319=[..._0x6eb482[_0x4047c8(0x1b7)]['prod_Qty']],_0x1435de=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x1e8)]],_0x557bd7=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x111)]],_0x3d24fa=[..._0x6eb482[_0x4047c8(0x1b7)]['prod_level']],_0x3aa54b=[..._0x6eb482[_0x4047c8(0x1b7)]['primary_code']],_0x5f2e77=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x21a)]],_0x2eb27a=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x10f)]],_0x1035b6=[..._0x6eb482['body'][_0x4047c8(0x174)]],_0x3fddaa=[..._0x6eb482['body'][_0x4047c8(0x130)]],_0x726b61=[..._0x6eb482[_0x4047c8(0x1b7)]['max_product_unit']],_0x35fbc7=[..._0x6eb482[_0x4047c8(0x1b7)]['alertQTY']],_0xdff7a3=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x19c)]],_0x5ecff6=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x12e)]],_0x2d7dd8=[..._0x6eb482['body'][_0x4047c8(0x15d)]],_0x15708d=[..._0x6eb482['body'][_0x4047c8(0x168)]],_0x104dbf=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x1cc)]],_0xe08233=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x10b)]],_0x43d7f4=[..._0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0xf7)]];const _0x290247=_0x693e67[_0x4047c8(0x1d0)](_0x12177a=>{return _0x12177a={'product_name':_0x12177a};});_0xe08233[_0x4047c8(0x104)]((_0x12b1e4,_0x4e51ab)=>{var _0x2df14c=_0x4047c8;_0x290247[_0x4e51ab][_0x2df14c(0x10b)]=Math[_0x2df14c(0x165)](_0x12b1e4);}),_0x43d7f4['forEach']((_0x57f7c8,_0x12e12f)=>{var _0x555c14=_0x4047c8;_0x290247[_0x12e12f][_0x555c14(0xf7)]=_0x57f7c8;}),_0x2a4982[_0x4047c8(0x104)]((_0x470ecb,_0x44d6ea)=>{var _0x26a8d8=_0x4047c8;_0x290247[_0x44d6ea][_0x26a8d8(0x1d7)]=_0x470ecb;}),_0x5b1319['forEach']((_0x2e2329,_0x28b97b)=>{var _0x7eeeb8=_0x4047c8;_0x290247[_0x28b97b][_0x7eeeb8(0x1cf)]=Math[_0x7eeeb8(0x165)](_0x2e2329);}),_0x1435de[_0x4047c8(0x104)]((_0x174dbe,_0x2a7f6d)=>{var _0x2d4ff2=_0x4047c8;_0x290247[_0x2a7f6d][_0x2d4ff2(0x169)]=_0x174dbe;}),_0x557bd7[_0x4047c8(0x104)]((_0x25fde5,_0xd28fa3)=>{var _0xb9a54f=_0x4047c8;_0x290247[_0xd28fa3][_0xb9a54f(0x19a)]=_0x25fde5;}),_0x3d24fa[_0x4047c8(0x104)]((_0x2d15ad,_0x541c65)=>{var _0x3f2e90=_0x4047c8;_0x2d7dd8[_0x3f2e90(0x104)]((_0x1aaccb,_0x364765)=>{var _0x3823b3=_0x3f2e90;if(_0x1aaccb=='Receiving\x20Area'&&_0x541c65==_0x364765){console['log'](_0x1aaccb+_0x3823b3(0x1b6)+_0x541c65+'\x20<>\x20'+_0x364765+_0x3823b3(0xf9)+_0x2d15ad);var _0x2cb493=_0x2d15ad[_0x3823b3(0x1f8)](0x3);_0x290247[_0x541c65]['storage']=_0x2d15ad[0x0],_0x290247[_0x541c65]['rack']=_0x2d15ad[0x1],_0x290247[_0x541c65][_0x3823b3(0x1bb)]=0x0,_0x290247[_0x541c65][_0x3823b3(0x14b)]=0x0,_0x290247[_0x541c65][_0x3823b3(0x166)]=_0x3823b3(0xfc),_0x290247[_0x541c65][_0x3823b3(0x118)]=_0x2cb493;}else{if(_0x1aaccb==_0x3823b3(0x1af)&&_0x541c65==_0x364765){var _0x2cb493=_0x2d15ad['slice'](0x3);_0x290247[_0x541c65]['storage']=_0x2d15ad[0x0],_0x290247[_0x541c65][_0x3823b3(0x1de)]=_0x2d15ad[0x1],_0x290247[_0x541c65][_0x3823b3(0x1bb)]=0x0,_0x290247[_0x541c65][_0x3823b3(0x14b)]=0x0,_0x290247[_0x541c65][_0x3823b3(0x166)]=_0x3823b3(0xfc),_0x290247[_0x541c65][_0x3823b3(0x118)]=_0x2d15ad[0x5];}else{if(_0x541c65==_0x364765){if(_0x2d15ad[0x0]=='A'&&_0x2d15ad[0x1]=='L'&&_0x2d15ad[0x2]=='L')console[_0x3823b3(0x150)](_0x1aaccb+_0x3823b3(0xf9)+_0x541c65+_0x3823b3(0xf9)+_0x364765+_0x3823b3(0xf9)+_0x2d15ad+_0x3823b3(0x1f6)),_0x290247[_0x541c65][_0x3823b3(0x17e)]=_0x2d15ad[0x0],_0x290247[_0x541c65][_0x3823b3(0x1de)]=_0x2d15ad[0x1],_0x290247[_0x541c65][_0x3823b3(0x1bb)]=0x0,_0x290247[_0x541c65][_0x3823b3(0x14b)]=0x0,_0x290247[_0x541c65][_0x3823b3(0x166)]=_0x3823b3(0xfc),_0x290247[_0x541c65][_0x3823b3(0x118)]=_0x2d15ad[0x3];else{var _0x549985;if(_0x2d15ad[0x4]=='L')_0x549985=_0x3823b3(0x1e5);else _0x2d15ad[0x4]=='F'&&(_0x549985=_0x3823b3(0xfc));_0x290247[_0x541c65][_0x3823b3(0x17e)]=_0x2d15ad[0x0],_0x290247[_0x541c65][_0x3823b3(0x1de)]=_0x2d15ad[0x1],_0x290247[_0x541c65]['bay']=_0x2d15ad[0x2],_0x290247[_0x541c65][_0x3823b3(0x14b)]=_0x2d15ad[0x3],_0x290247[_0x541c65]['type']=_0x549985,_0x290247[_0x541c65][_0x3823b3(0x118)]=_0x2d15ad[0x5];}}}}});}),_0x3aa54b[_0x4047c8(0x104)]((_0xe2a5b7,_0x2d3a03)=>{_0x290247[_0x2d3a03]['primary_code']=_0xe2a5b7;}),_0x5f2e77[_0x4047c8(0x104)]((_0x1dc9ed,_0x3e92f5)=>{var _0x157f09=_0x4047c8;_0x290247[_0x3e92f5][_0x157f09(0x21a)]=_0x1dc9ed;}),_0x2eb27a[_0x4047c8(0x104)]((_0x20f296,_0x50e40e)=>{var _0x24ea63=_0x4047c8;_0x290247[_0x50e40e][_0x24ea63(0x175)]=_0x20f296;}),_0x1035b6[_0x4047c8(0x104)]((_0x24d139,_0x117b80)=>{var _0x588512=_0x4047c8;_0x290247[_0x117b80][_0x588512(0x174)]=_0x24d139;}),_0x3fddaa[_0x4047c8(0x104)]((_0x2e7e47,_0x7cef98)=>{var _0x51eb4d=_0x4047c8;_0x290247[_0x7cef98][_0x51eb4d(0x130)]=_0x2e7e47;}),_0x726b61[_0x4047c8(0x104)]((_0x50f815,_0x1885a5)=>{var _0x432378=_0x4047c8;_0x290247[_0x1885a5][_0x432378(0x1e9)]=_0x50f815;}),_0x35fbc7['forEach']((_0x2a38f1,_0x398751)=>{_0x290247[_0x398751]['alertQTY']=_0x2a38f1;}),_0xdff7a3[_0x4047c8(0x104)]((_0x16dcfb,_0x1e55c8)=>{var _0x3736a1=_0x4047c8;_0x290247[_0x1e55c8][_0x3736a1(0x19c)]=_0x16dcfb;}),_0x5ecff6[_0x4047c8(0x104)]((_0x579d8c,_0x3df1e9)=>{var _0x13715f=_0x4047c8;_0x290247[_0x3df1e9][_0x13715f(0x12d)]=_0x579d8c;}),_0x2d7dd8[_0x4047c8(0x104)]((_0x4cd415,_0x38044a)=>{_0x290247[_0x38044a]['room_name']=_0x4cd415;}),_0x15708d['forEach']((_0x12fea1,_0x1672cc)=>{var _0x203264=_0x4047c8;_0x290247[_0x1672cc][_0x203264(0x1b9)]=_0x12fea1;}),_0x104dbf['forEach']((_0x338100,_0x61b2b)=>{var _0x5a0d9f=_0x4047c8;_0x290247[_0x61b2b][_0x5a0d9f(0x146)]=_0x338100;});const _0x14e2fb=_0x2d7dd8[_0x4047c8(0x1d0)](_0xa7b1a2=>{return _0xa7b1a2={'room_name':_0xa7b1a2};}),_0x307a7a=_0x290247[_0x4047c8(0x18b)](_0x442adb=>_0x442adb['quantity']!=='0'&&_0x442adb[_0x4047c8(0x1cf)]!==''),_0x55185a=new purchases({'invoice':_0x4530ce,'suppliers':_0x6eb482[_0x4047c8(0x1b7)][_0x4047c8(0x123)],'date':_0x458060,'warehouse_name':_0x1df031,'product':_0x307a7a,'note':_0x341fe4,'due_amount':_0x43d76f,'POnumber':_0x436ed2,'SCRN':_0x2e7740,'JO_number':_0x46e973,'roomList':_0x14e2fb}),_0x54a649=await _0x55185a[_0x4047c8(0x199)](),_0x50b69a=await purchases[_0x4047c8(0x1b3)]({'invoice':_0x4530ce}),_0x54f4fc=_0x50b69a['product'][_0x4047c8(0x1d0)](async _0xe2eec8=>{var _0x5c45a1=_0x4047c8,_0x5031d2=await warehouse[_0x5c45a1(0x1b3)]({'name':_0x1df031,'room':_0xe2eec8[_0x5c45a1(0x1bf)]}),_0x2c8a79=0x0;return _0x5031d2[_0x5c45a1(0x12a)]['forEach'](_0xa09a4e=>{var _0x27f8f1=_0x5c45a1;_0xa09a4e['product_name']==_0xe2eec8[_0x27f8f1(0x10d)]&&_0xa09a4e[_0x27f8f1(0x118)]==_0xe2eec8['floorlevel']&&_0xa09a4e[_0x27f8f1(0x166)]==_0xe2eec8[_0x27f8f1(0x166)]&&_0xa09a4e[_0x27f8f1(0x14b)]==_0xe2eec8['bin']&&_0xa09a4e[_0x27f8f1(0x1bb)]==_0xe2eec8[_0x27f8f1(0x1bb)]&&_0xa09a4e[_0x27f8f1(0x1de)]==_0xe2eec8[_0x27f8f1(0x1de)]&&_0xa09a4e['storage']==_0xe2eec8[_0x27f8f1(0x17e)]&&_0xa09a4e[_0x27f8f1(0x130)]==_0xe2eec8[_0x27f8f1(0x130)]&&_0xa09a4e['batch_code']==_0xe2eec8[_0x27f8f1(0x174)]&&_0xa09a4e['production_date']==_0xe2eec8['production_date']&&_0xa09a4e[_0x27f8f1(0x146)]==_0x50b69a['invoice']&&(_0xa09a4e['product_stock']+=Math['abs'](_0xe2eec8[_0x27f8f1(0x1cf)]),_0x2c8a79++);}),_0x2c8a79===0x0&&_0x5031d2[_0x5c45a1(0x12a)][_0x5c45a1(0x200)]({'product_name':_0xe2eec8['product_name'],'product_stock':Math[_0x5c45a1(0x165)](_0xe2eec8[_0x5c45a1(0x1cf)]),'primary_code':_0xe2eec8[_0x5c45a1(0x1fc)],'secondary_code':_0xe2eec8[_0x5c45a1(0x21a)],'product_code':_0xe2eec8['product_code'],'storage':_0xe2eec8[_0x5c45a1(0x17e)],'rack':_0xe2eec8[_0x5c45a1(0x1de)],'bay':_0xe2eec8['bay'],'bin':_0xe2eec8[_0x5c45a1(0x14b)],'type':_0xe2eec8[_0x5c45a1(0x166)],'floorlevel':_0xe2eec8[_0x5c45a1(0x118)],'maxProducts':_0xe2eec8[_0x5c45a1(0x175)],'unit':_0xe2eec8[_0x5c45a1(0x169)],'secondary_unit':_0xe2eec8[_0x5c45a1(0x19a)],'expiry_date':_0xe2eec8[_0x5c45a1(0x130)],'maxPerUnit':_0xe2eec8[_0x5c45a1(0x1e9)],'batch_code':_0xe2eec8[_0x5c45a1(0x174)],'alertQTY':_0xe2eec8[_0x5c45a1(0x1ee)],'production_date':_0xe2eec8['production_date'],'product_cat':_0xe2eec8['product_cat'],'invoice':_0xe2eec8[_0x5c45a1(0x146)],'actual_qty':Math[_0x5c45a1(0x165)](_0xe2eec8[_0x5c45a1(0x10b)]),'actual_uom':_0xe2eec8['actual_uom']}),_0x5031d2;});Promise[_0x4047c8(0x152)](_0x54f4fc)[_0x4047c8(0x10e)](async _0x3ee4a8=>{var _0x341c76=_0x4047c8;try{for(const _0x280347 of _0x3ee4a8){await _0x280347[_0x341c76(0x199)]();}const _0x202ac1=await master_shop[_0x341c76(0x1dd)](),_0x489790=await email_settings[_0x341c76(0x1b3)](),_0x410f1c=await supervisor_settings['find']();var _0x51a02a=_0x50b69a[_0x341c76(0x1e2)],_0x56b5ac='',_0x4284a6;for(_0x4284a6 in _0x51a02a){_0x56b5ac+=_0x341c76(0x173)+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6][_0x341c76(0x10d)]+'</td>'+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6]['product_code']+_0x341c76(0x1bd)+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6][_0x341c76(0x1cf)]+_0x341c76(0x1bd)+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6][_0x341c76(0x169)]+_0x341c76(0x1bd)+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6][_0x341c76(0x19a)]+_0x341c76(0x1bd)+_0x341c76(0x1d2)+_0x50b69a[_0x341c76(0x1c6)]+_0x341c76(0x1bd)+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6][_0x341c76(0x1bf)]+'</td>'+_0x341c76(0x1d2)+_0x51a02a[_0x4284a6][_0x341c76(0x17e)]+_0x51a02a[_0x4284a6][_0x341c76(0x1de)]+_0x51a02a[_0x4284a6]['bay']+_0x51a02a[_0x4284a6]['bin']+_0x51a02a[_0x4284a6][_0x341c76(0x166)][0x0]+_0x51a02a[_0x4284a6][_0x341c76(0x118)]+_0x341c76(0x1bd),'</tr>';}let _0x6e46d1=nodemailer['createTransport']({'host':_0x489790[_0x341c76(0x151)],'port':Number(_0x489790[_0x341c76(0x13f)]),'secure':![],'auth':{'user':_0x489790[_0x341c76(0x19d)],'pass':_0x489790[_0x341c76(0x129)]}}),_0x36cc2c={'from':_0x489790[_0x341c76(0x19d)],'to':_0x410f1c[0x0][_0x341c76(0x1cb)],'subject':_0x341c76(0x108),'attachments':[{'filename':_0x341c76(0x1e4),'path':__dirname+'/../public'+_0x341c76(0x212)+_0x202ac1[0x0][_0x341c76(0x21c)],'cid':_0x341c76(0x1e7)}],'html':_0x341c76(0x124)+'<html><head><title></title>'+_0x341c76(0x1fd)+_0x341c76(0x18a)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x341c76(0x18a)+_0x341c76(0x1ca)+_0x341c76(0x1d8)+_0x341c76(0x18a)+_0x341c76(0x167)+_0x202ac1[0x0]['site_title']+_0x341c76(0x1f9)+_0x341c76(0x1d8)+_0x341c76(0x1d8)+_0x341c76(0x116)+_0x341c76(0x18a)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x341c76(0x1cd)+_0x50b69a[_0x341c76(0x146)]+'\x20'+_0x341c76(0x1df)+_0x341c76(0x1a4)+_0x50b69a['date']+'\x20'+_0x341c76(0x1a1)+_0x341c76(0x195)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x341c76(0xff)+_0x341c76(0x173)+_0x341c76(0x1c7)+_0x341c76(0x160)+_0x341c76(0x1d1)+_0x341c76(0x117)+_0x341c76(0xfe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x341c76(0x101)+_0x341c76(0x145)+'</thead>'+_0x341c76(0x17b)+'\x20'+_0x56b5ac+'\x20'+_0x341c76(0x180)+_0x341c76(0x17d)+_0x341c76(0x18a)+_0x341c76(0x14f)+_0x341c76(0x144)+_0x202ac1[0x0]['site_title']+'</h5>'+_0x341c76(0x1d8)+'</div>'+_0x341c76(0x198)};_0x6e46d1[_0x341c76(0x20f)](_0x36cc2c,function(_0x185f87,_0x2a08b2){var _0x1a2eee=_0x341c76;_0x185f87?(console[_0x1a2eee(0x150)](_0x185f87),console[_0x1a2eee(0x150)](_0x1a2eee(0x1d5))):console['log'](_0x1a2eee(0x13c));}),_0x6eb482['flash'](_0x341c76(0x14e),'Purchase\x20data\x20added\x20successfully'),_0x3ea84f[_0x341c76(0x15b)](_0x341c76(0x140));}catch(_0x8c7898){console[_0x341c76(0x119)](_0x8c7898),_0x3ea84f[_0x341c76(0x1ba)](0x1f4)[_0x341c76(0x1e0)]({'error':_0x341c76(0x1f4)});}})[_0x4047c8(0x1ab)](_0x993f38=>{var _0x5d2977=_0x4047c8;console['error'](_0x993f38),_0x3ea84f[_0x5d2977(0x1ba)](0x1f4)[_0x5d2977(0x1e0)]({'error':'An\x20error\x20occurred.'});});}catch(_0x3d1a7e){console[_0x4047c8(0x150)](_0x3d1a7e);}}),router[a0_0x47faad(0x205)](a0_0x47faad(0x13b),auth,async(_0x20de59,_0x57a8fd)=>{var _0x552dd3=a0_0x47faad;try{const {username:_0x587bc5,email:_0x5b8b6b,role:_0x1191d8}=_0x20de59[_0x552dd3(0x210)],_0x3c7682=_0x20de59[_0x552dd3(0x210)],_0x4e2cb0=await profile[_0x552dd3(0x1b3)]({'email':_0x3c7682[_0x552dd3(0x19d)]}),_0x14750d=await master_shop[_0x552dd3(0x1dd)](),_0x1e5911=_0x20de59[_0x552dd3(0x10a)]['id'],_0x351fa2=await purchases[_0x552dd3(0x20e)](_0x1e5911),_0x3f3bc9=await warehouse[_0x552dd3(0x1a7)]([{'$match':{'name':_0x351fa2[_0x552dd3(0x1c6)],'room':_0x351fa2[_0x552dd3(0x11a)]}},{'$unwind':_0x552dd3(0x183)},{'$group':{'_id':_0x552dd3(0x211),'name':{'$first':_0x552dd3(0x187)},'product_stock':{'$first':_0x552dd3(0x157)},'bay':{'$first':_0x552dd3(0x1ad)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x552dd3(0x1c9)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x552dd3(0x1ef)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x552dd3(0x21b)},'rack':{'$first':_0x552dd3(0x1b0)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x9ea283=await customer[_0x552dd3(0x1dd)]({});let _0x116e74;if(_0x3c7682[_0x552dd3(0x110)]==_0x552dd3(0x17c)){const _0x2a3e4f=await staff['findOne']({'email':_0x3c7682[_0x552dd3(0x19d)]});_0x116e74=await warehouse['aggregate']([{'$match':{'status':_0x552dd3(0x136),'name':_0x2a3e4f[_0x552dd3(0x21d)]}},{'$group':{'_id':_0x552dd3(0x11f),'name':{'$first':'$name'}}}]);}else _0x116e74=await warehouse['aggregate']([{'$match':{'status':_0x552dd3(0x136)}},{'$group':{'_id':_0x552dd3(0x11f),'name':{'$first':_0x552dd3(0x11f)}}}]);const _0x2db4ad=await product[_0x552dd3(0x1dd)]({}),_0x323792=await suppliers['find']({}),_0x2d2de1=BayBinSelected(_0x351fa2[_0x552dd3(0x1c6)],_0x351fa2[_0x552dd3(0x11a)]);if(_0x14750d[0x0][_0x552dd3(0x126)]=='English\x20(US)'){var _0x4ea97a=users['English'];console['log'](_0x4ea97a);}else{if(_0x14750d[0x0][_0x552dd3(0x126)]==_0x552dd3(0x114))var _0x4ea97a=users[_0x552dd3(0x114)];else{if(_0x14750d[0x0][_0x552dd3(0x126)]=='German')var _0x4ea97a=users[_0x552dd3(0x217)];else{if(_0x14750d[0x0][_0x552dd3(0x126)]==_0x552dd3(0x131))var _0x4ea97a=users[_0x552dd3(0x131)];else{if(_0x14750d[0x0][_0x552dd3(0x126)]==_0x552dd3(0x125))var _0x4ea97a=users[_0x552dd3(0x125)];else{if(_0x14750d[0x0][_0x552dd3(0x126)]==_0x552dd3(0x1da))var _0x4ea97a=users[_0x552dd3(0x135)];else{if(_0x14750d[0x0][_0x552dd3(0x126)]=='Chinese')var _0x4ea97a=users[_0x552dd3(0x1b1)];else{if(_0x14750d[0x0][_0x552dd3(0x126)]==_0x552dd3(0x213))var _0x4ea97a=users[_0x552dd3(0x1b2)];}}}}}}}_0x57a8fd[_0x552dd3(0x1bc)](_0x552dd3(0x156),{'success':_0x20de59['flash'](_0x552dd3(0x14e)),'errors':_0x20de59[_0x552dd3(0x202)]('errors'),'role':_0x3c7682,'profile':_0x4e2cb0,'customer':_0x9ea283,'warehouse':_0x116e74,'product':_0x3f3bc9,'user':_0x351fa2,'master_shop':_0x14750d,'unit':_0x2db4ad,'language':_0x4ea97a,'suppliers':_0x323792,'dataSelected':_0x2d2de1});}catch(_0x50c9ba){console[_0x552dd3(0x150)](_0x50c9ba);}}),router['post'](a0_0x47faad(0x13b),auth,async(_0x23fcfb,_0x14fb3b)=>{var _0x420a72=a0_0x47faad;try{const _0x40d9c3=_0x23fcfb[_0x420a72(0x10a)]['id'],{invoice:_0x300413,warehouse_name:_0x20856f,Room_name:_0x2d0304}=_0x23fcfb['body'],_0x11aab7=await warehouse['findOne']({'name':_0x20856f,'room':_0x2d0304}),_0x1f0b69=await purchases[_0x420a72(0x1b3)]({'invoice':_0x300413});_0x1f0b69[_0x420a72(0x1e2)]['forEach'](_0x5089fe=>{var _0x49151c=_0x420a72,_0xc20ab8=0x0;const _0x151e5a=_0x11aab7[_0x49151c(0x12a)][_0x49151c(0x1d0)](_0x11ea4a=>{var _0x1c9e64=_0x49151c;_0x11ea4a['product_name']==_0x5089fe[_0x1c9e64(0x10d)]&&_0x11ea4a['floorlevel']==_0x5089fe['floorlevel']&&_0x11ea4a[_0x1c9e64(0x166)]==_0x5089fe[_0x1c9e64(0x166)]&&_0x11ea4a[_0x1c9e64(0x14b)]==_0x5089fe[_0x1c9e64(0x14b)]&&_0x11ea4a['bay']==_0x5089fe[_0x1c9e64(0x1bb)]&&_0x11ea4a['rack']==_0x5089fe[_0x1c9e64(0x1de)]&&_0x11ea4a[_0x1c9e64(0x17e)]==_0x5089fe[_0x1c9e64(0x17e)]&&_0x11ea4a[_0x1c9e64(0x130)]==_0x5089fe[_0x1c9e64(0x130)]&&_0x11ea4a[_0x1c9e64(0x174)]==_0x5089fe[_0x1c9e64(0x174)]&&_0x11ea4a['production_date']==_0x5089fe[_0x1c9e64(0x19c)]&&_0x11ea4a[_0x1c9e64(0x14c)]==_0x5089fe[_0x1c9e64(0x14c)]&&_0x11ea4a['delivery_code']==_0x5089fe[_0x1c9e64(0x1b9)]&&(_0x11ea4a[_0x1c9e64(0x207)]=parseInt(_0x11ea4a[_0x1c9e64(0x207)])+parseInt(_0x5089fe['quantity']),_0xc20ab8++);});_0xc20ab8=='0'&&(_0x11aab7['product_details']=_0x11aab7['product_details']['concat']({'product_name':_0x5089fe[_0x49151c(0x10d)],'product_stock':_0x5089fe[_0x49151c(0x1cf)],'primary_code':_0x5089fe[_0x49151c(0x1fc)],'secondary_code':_0x5089fe[_0x49151c(0x21a)],'product_code':_0x5089fe[_0x49151c(0x1d7)],'storage':_0x5089fe[_0x49151c(0x17e)],'rack':_0x5089fe[_0x49151c(0x1de)],'bay':_0x5089fe['bay'],'bin':_0x5089fe[_0x49151c(0x14b)],'type':_0x5089fe['type'],'floorlevel':_0x5089fe[_0x49151c(0x118)],'maxProducts':_0x5089fe[_0x49151c(0x175)],'unit':_0x5089fe[_0x49151c(0x169)],'secondary_unit':_0x5089fe[_0x49151c(0x19a)],'expiry_date':_0x5089fe[_0x49151c(0x130)],'maxPerUnit':_0x5089fe[_0x49151c(0x1e9)],'batch_code':_0x5089fe[_0x49151c(0x174)],'alertQTY':_0x5089fe[_0x49151c(0x1ee)],'production_date':_0x5089fe[_0x49151c(0x19c)],'delivery_date':_0x5089fe[_0x49151c(0x14c)],'delivery_code':_0x5089fe[_0x49151c(0x1b9)]}));}),await _0x11aab7['save'](),_0x1f0b69[_0x420a72(0x103)]=_0x420a72(0x178);const _0x17f4f1=await _0x1f0b69[_0x420a72(0x199)]();_0x23fcfb[_0x420a72(0x202)]('success','Sales\x20Update\x20successfully'),_0x14fb3b[_0x420a72(0x15b)](_0x420a72(0x1fb));}catch(_0x13846a){console[_0x420a72(0x150)](_0x13846a);}}),router[a0_0x47faad(0x205)](a0_0x47faad(0x14a),auth,async(_0x15426e,_0x2603b7)=>{var _0x26a627=a0_0x47faad;try{const {username:_0x470eef,email:_0x3bc387,role:_0x12442c}=_0x15426e[_0x26a627(0x210)],_0x57ff37=_0x15426e[_0x26a627(0x210)],_0x17aac6=await profile[_0x26a627(0x1b3)]({'email':_0x57ff37[_0x26a627(0x19d)]}),_0x5ad8fa=await master_shop[_0x26a627(0x1dd)](),_0x595af8=_0x15426e[_0x26a627(0x10a)]['id'],_0x3c6c6f=await purchases[_0x26a627(0x20e)](_0x595af8),_0x24c869=await suppliers['find']({});let _0x4ea8ed;if(_0x57ff37['role']==_0x26a627(0x17c)){const _0x1de140=await staff[_0x26a627(0x1b3)]({'email':_0x57ff37[_0x26a627(0x19d)]});_0x4ea8ed=await warehouse[_0x26a627(0x1dd)]({'status':_0x26a627(0x136),'name':_0x1de140[_0x26a627(0x21d)],'warehouse_category':_0x26a627(0x16f)});}else _0x4ea8ed=await warehouse[_0x26a627(0x1a7)]([{'$match':{'status':'Enabled','warehouse_category':_0x26a627(0x16f)}},{'$group':{'_id':_0x26a627(0x11f),'name':{'$first':_0x26a627(0x11f)}}}]);const _0x1a45f9=await product[_0x26a627(0x1dd)]({}),_0xac378c=BayBinSelected(_0x3c6c6f[_0x26a627(0x1c6)],_0x3c6c6f['room']);let _0x2779c4=new Date(_0x3c6c6f[_0x26a627(0x130)]),_0x34d0ce=('0'+_0x2779c4[_0x26a627(0x208)]())[_0x26a627(0x1f8)](-0x2),_0x42ba59=('0'+(_0x2779c4[_0x26a627(0x1c8)]()+0x1))[_0x26a627(0x1f8)](-0x2),_0x1c1aad=_0x2779c4[_0x26a627(0x138)](),_0x5dc02b=_0x1c1aad+'-'+_0x42ba59+'-'+_0x34d0ce;if(_0x5ad8fa[0x0]['language']==_0x26a627(0x16e)){var _0x2567c7=users[_0x26a627(0x16a)];console['log'](_0x2567c7);}else{if(_0x5ad8fa[0x0]['language']==_0x26a627(0x114))var _0x2567c7=users[_0x26a627(0x114)];else{if(_0x5ad8fa[0x0][_0x26a627(0x126)]==_0x26a627(0x217))var _0x2567c7=users[_0x26a627(0x217)];else{if(_0x5ad8fa[0x0][_0x26a627(0x126)]==_0x26a627(0x131))var _0x2567c7=users[_0x26a627(0x131)];else{if(_0x5ad8fa[0x0]['language']=='French')var _0x2567c7=users['French'];else{if(_0x5ad8fa[0x0][_0x26a627(0x126)]==_0x26a627(0x1da))var _0x2567c7=users['Portuguese'];else{if(_0x5ad8fa[0x0][_0x26a627(0x126)]==_0x26a627(0x1b1))var _0x2567c7=users[_0x26a627(0x1b1)];else{if(_0x5ad8fa[0x0][_0x26a627(0x126)]==_0x26a627(0x213))var _0x2567c7=users[_0x26a627(0x1b2)];}}}}}}}_0x2603b7[_0x26a627(0x1bc)](_0x26a627(0x15f),{'success':_0x15426e[_0x26a627(0x202)](_0x26a627(0x14e)),'errors':_0x15426e[_0x26a627(0x202)](_0x26a627(0x218)),'role':_0x57ff37,'profile':_0x17aac6,'purchases':_0x3c6c6f,'suppliers':_0x24c869,'warehouse':_0x4ea8ed,'product':_0x1a45f9,'master_shop':_0x5ad8fa,'language':_0x2567c7,'ed_fullDate':_0x5dc02b,'dataSelected':_0xac378c});}catch(_0x39fc80){console[_0x26a627(0x150)](_0x39fc80);}}),router[a0_0x47faad(0x121)]('/view/:id',auth,async(_0x59c014,_0x12a9aa)=>{var _0x1dce57=a0_0x47faad;try{const _0x15cb47=_0x59c014[_0x1dce57(0x10a)]['id'],_0x45d6d8=await purchases[_0x1dce57(0x1b3)]({'_id':_0x59c014[_0x1dce57(0x10a)]['id']}),_0x8d533=await warehouse[_0x1dce57(0x1b3)]({'name':_0x45d6d8[_0x1dce57(0x1c6)],'room':_0x45d6d8[_0x1dce57(0x11a)]});_0x45d6d8[_0x1dce57(0x1e2)]['forEach'](_0x29e51f=>{var _0x3dae72=_0x1dce57;const _0x491bc3=_0x8d533[_0x3dae72(0x12a)][_0x3dae72(0x1d0)](_0x44b7ed=>{var _0x1c116a=_0x3dae72;_0x44b7ed[_0x1c116a(0x10d)]==_0x29e51f[_0x1c116a(0x10d)]&&_0x44b7ed[_0x1c116a(0x118)]==_0x29e51f[_0x1c116a(0x118)]&&_0x44b7ed[_0x1c116a(0x166)]==_0x29e51f['type']&&_0x44b7ed[_0x1c116a(0x14b)]==_0x29e51f[_0x1c116a(0x14b)]&&_0x44b7ed[_0x1c116a(0x1bb)]==_0x29e51f[_0x1c116a(0x1bb)]&&_0x44b7ed['rack']==_0x29e51f[_0x1c116a(0x1de)]&&_0x44b7ed[_0x1c116a(0x17e)]==_0x29e51f['storage']&&(_0x44b7ed['product_stock']=parseInt(_0x44b7ed[_0x1c116a(0x207)])-parseInt(_0x29e51f[_0x1c116a(0x1cf)]));});}),await _0x8d533[_0x1dce57(0x199)]();const {invoice:_0x3a1f0b,suppliers:_0x82f2d9,date:_0x1a6c2e,warehouse_name:_0x613e31,prod_name:_0x3ffad2,prod_code:_0x31f533,prod_qty:_0x1bb12c,prod_unit:_0x323aef,prod_secondunit:_0x22ef45,prod_level:_0x5caf91,prod_isle:_0x4a38d9,prod_pallet:_0x4e3ab1,note:_0x43e9bc,expiry_date:_0x13fa68,batch_code:_0x169925,paid_amount:_0x10e0a6,due_amount:_0x3b635b,Room_name:_0xc66f39,primary_code:_0x1579a5,secondary_code:_0x5f588b,PO_number:_0x2b8503,JO_number:_0x8b4251}=_0x59c014[_0x1dce57(0x1b7)];if(typeof _0x3ffad2==_0x1dce57(0x17a))var _0x281f20=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x1f0)]],_0x4a94b4=[_0x59c014[_0x1dce57(0x1b7)]['prod_code']],_0xfa7798=[_0x59c014['body'][_0x1dce57(0x1c1)]],_0x394799=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x159)]],_0x737f78=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x111)]],_0x5c9bd3=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x18e)]],_0x331fad=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x128)]],_0x4afd25=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x1c2)]],_0x16076b=[_0x59c014['body'][_0x1dce57(0x1fc)]],_0x1bce9c=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x21a)]],_0x72f3f6=[_0x59c014[_0x1dce57(0x1b7)]['MaxStocks_data']],_0x1047ea=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x174)]],_0x819232=[_0x59c014[_0x1dce57(0x1b7)]['expiry_date']],_0x54a587=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x17e)]],_0xf4af34=[_0x59c014['body']['rak']],_0x345fa1=[_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x166)]];else var _0x281f20=[..._0x59c014['body'][_0x1dce57(0x1f0)]],_0x4a94b4=[..._0x59c014[_0x1dce57(0x1b7)]['prod_code']],_0xfa7798=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x1c1)]],_0x394799=[..._0x59c014[_0x1dce57(0x1b7)]['prod_unit']],_0x737f78=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x111)]],_0x5c9bd3=[..._0x59c014['body'][_0x1dce57(0x18e)]],_0x331fad=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x128)]],_0x4afd25=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x1c2)]],_0x16076b=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x1fc)]],_0x1bce9c=[..._0x59c014['body'][_0x1dce57(0x21a)]],_0x72f3f6=[..._0x59c014['body'][_0x1dce57(0x10f)]],_0x1047ea=[..._0x59c014[_0x1dce57(0x1b7)]['batch_code']],_0x819232=[..._0x59c014['body']['expiry_date']],_0x54a587=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x17e)]],_0xf4af34=[..._0x59c014['body']['rak']],_0x345fa1=[..._0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x166)]];const _0x14bdd4=_0x281f20[_0x1dce57(0x1d0)](_0x2d02fc=>{return _0x2d02fc={'product_name':_0x2d02fc};});_0x4a94b4['forEach']((_0x1f99d0,_0x37bc78)=>{var _0x4bf608=_0x1dce57;_0x14bdd4[_0x37bc78][_0x4bf608(0x1d7)]=_0x1f99d0;}),_0xfa7798[_0x1dce57(0x104)]((_0x319d5e,_0xb6ab07)=>{var _0x4c6183=_0x1dce57;_0x14bdd4[_0xb6ab07][_0x4c6183(0x1cf)]=_0x319d5e;}),_0x394799['forEach']((_0x2d2c4f,_0x565074)=>{var _0x5df09d=_0x1dce57;_0x14bdd4[_0x565074][_0x5df09d(0x169)]=_0x2d2c4f;}),_0x737f78[_0x1dce57(0x104)]((_0x29368b,_0x43c35e)=>{var _0x194f79=_0x1dce57;_0x14bdd4[_0x43c35e][_0x194f79(0x19a)]=_0x29368b;}),_0x5c9bd3['forEach']((_0x3c8289,_0x3640fa)=>{var _0x54b52e=_0x1dce57;_0x14bdd4[_0x3640fa][_0x54b52e(0x1bb)]=_0x3c8289;}),_0x331fad[_0x1dce57(0x104)]((_0x5ca161,_0x1aed09)=>{var _0x196ded=_0x1dce57;_0x14bdd4[_0x1aed09][_0x196ded(0x14b)]=_0x5ca161;}),_0x4afd25[_0x1dce57(0x104)]((_0x3b9ef7,_0xd39711)=>{var _0xf8fd40=_0x1dce57;_0x14bdd4[_0xd39711][_0xf8fd40(0x118)]=_0x3b9ef7;}),_0x16076b[_0x1dce57(0x104)]((_0x96eb,_0x1815ad)=>{var _0x413940=_0x1dce57;_0x14bdd4[_0x1815ad][_0x413940(0x1fc)]=_0x96eb;}),_0x1bce9c[_0x1dce57(0x104)]((_0x280e74,_0xc39ba8)=>{var _0x3e8e7c=_0x1dce57;_0x14bdd4[_0xc39ba8][_0x3e8e7c(0x21a)]=_0x280e74;}),_0x72f3f6['forEach']((_0x35f26e,_0x46ef25)=>{_0x14bdd4[_0x46ef25]['maxStocks']=_0x35f26e;}),_0x1047ea['forEach']((_0x533159,_0x2f110e)=>{var _0xc8044b=_0x1dce57;_0x14bdd4[_0x2f110e][_0xc8044b(0x174)]=_0x533159;}),_0x819232[_0x1dce57(0x104)]((_0x5a8d91,_0x59d261)=>{_0x14bdd4[_0x59d261]['expiry_date']=_0x5a8d91;}),_0x345fa1[_0x1dce57(0x104)]((_0x2b884c,_0x4d282d)=>{var _0x796140=_0x1dce57;_0x14bdd4[_0x4d282d][_0x796140(0x166)]=_0x2b884c;}),_0x54a587[_0x1dce57(0x104)]((_0x5626af,_0x4dd00f)=>{_0x14bdd4[_0x4dd00f]['storage']=_0x5626af;}),_0xf4af34[_0x1dce57(0x104)]((_0x351230,_0x4b57c2)=>{var _0x427579=_0x1dce57;_0x14bdd4[_0x4b57c2][_0x427579(0x1de)]=_0x351230;});const _0xca07e6=_0x14bdd4[_0x1dce57(0x18b)](_0x5b65ad=>_0x5b65ad['quantity']!=='0'&&_0x5b65ad[_0x1dce57(0x1cf)]!=='');_0x45d6d8[_0x1dce57(0x146)]=_0x3a1f0b,_0x45d6d8[_0x1dce57(0x123)]=_0x82f2d9,_0x45d6d8[_0x1dce57(0x1f1)]=_0x1a6c2e,_0x45d6d8[_0x1dce57(0x1c6)]=_0x613e31,_0x45d6d8[_0x1dce57(0x1e2)]=_0xca07e6,_0x45d6d8[_0x1dce57(0x193)]=_0x43e9bc,_0x45d6d8[_0x1dce57(0x181)]=_0x10e0a6,_0x45d6d8[_0x1dce57(0x1f3)]=_0x3b635b,_0x45d6d8[_0x1dce57(0x11a)]=_0xc66f39,_0x45d6d8[_0x1dce57(0x12b)]=_0x2b8503,_0x45d6d8['JO_number']=_0x8b4251;const _0x14d1c5=await _0x45d6d8[_0x1dce57(0x199)](),_0x1ed5cf=await warehouse[_0x1dce57(0x1b3)]({'name':_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x1c6)],'room':_0x59c014[_0x1dce57(0x1b7)][_0x1dce57(0x190)]});_0x45d6d8[_0x1dce57(0x1e2)][_0x1dce57(0x104)](_0x54ae31=>{var _0x4fa107=_0x1dce57,_0x31b0a9=0x0;const _0x4d9059=_0x1ed5cf[_0x4fa107(0x12a)][_0x4fa107(0x1d0)](_0x5539e3=>{var _0x58962c=_0x4fa107;_0x5539e3[_0x58962c(0x10d)]==_0x54ae31[_0x58962c(0x10d)]&&_0x5539e3[_0x58962c(0x118)]==_0x54ae31[_0x58962c(0x118)]&&_0x5539e3[_0x58962c(0x166)]==_0x54ae31[_0x58962c(0x166)]&&_0x5539e3[_0x58962c(0x14b)]==_0x54ae31['bin']&&_0x5539e3[_0x58962c(0x1bb)]==_0x54ae31[_0x58962c(0x1bb)]&&_0x5539e3[_0x58962c(0x1de)]==_0x54ae31[_0x58962c(0x1de)]&&_0x5539e3[_0x58962c(0x17e)]==_0x54ae31[_0x58962c(0x17e)]&&(_0x5539e3[_0x58962c(0x207)]=parseInt(_0x5539e3[_0x58962c(0x207)])+parseInt(_0x54ae31[_0x58962c(0x1cf)]),_0x31b0a9++);});_0x31b0a9=='0'&&(_0x1ed5cf['product_details']=_0x1ed5cf[_0x4fa107(0x12a)]['concat']({'product_name':_0x54ae31[_0x4fa107(0x10d)],'product_stock':_0x54ae31['quantity'],'primary_code':_0x54ae31[_0x4fa107(0x1fc)],'secondary_code':_0x54ae31[_0x4fa107(0x21a)],'product_code':_0x54ae31[_0x4fa107(0x1d7)],'storage':_0x54ae31[_0x4fa107(0x17e)],'rack':_0x54ae31['rack'],'bay':_0x54ae31[_0x4fa107(0x1bb)],'bin':_0x54ae31[_0x4fa107(0x14b)],'type':_0x54ae31[_0x4fa107(0x166)],'floorlevel':_0x54ae31['floorlevel'],'maxProducts':_0x54ae31[_0x4fa107(0x175)],'unit':_0x54ae31[_0x4fa107(0x169)],'secondary_unit':_0x54ae31['secondary_unit'],'expiry_date':_0x54ae31[_0x4fa107(0x130)]}));}),await _0x1ed5cf[_0x1dce57(0x199)]();const _0x281dd8=await s_payment_data[_0x1dce57(0x1b3)]({'invoice':_0x59c014['body'][_0x1dce57(0x146)]});if(_0x281dd8===null){}else console[_0x1dce57(0x150)]('suppliers',_0x281dd8,_0x59c014['body']['invoice']),_0x281dd8[_0x1dce57(0x123)]=_0x59c014[_0x1dce57(0x1b7)]['suppliers'],await _0x281dd8['save']();_0x59c014[_0x1dce57(0x202)](_0x1dce57(0x14e),_0x1dce57(0x192)),_0x12a9aa[_0x1dce57(0x15b)](_0x1dce57(0x1fb));}catch(_0x1edd15){console[_0x1dce57(0x150)](_0x1edd15);}}),router[a0_0x47faad(0x121)](a0_0x47faad(0x194),auth,async(_0x80f7a3,_0x4186de)=>{var _0x1110dd=a0_0x47faad;try{const _0x4f25e8=_0x80f7a3['params']['id'],{invoice:_0xbd9c09,suppliers:_0x4f70f9,payable:_0x7521ba,due_amount:_0x5d7cbe}=_0x80f7a3[_0x1110dd(0x1b7)],_0x523aaf=await purchases[_0x1110dd(0x20e)](_0x4f25e8);var _0x2489ee=_0x7521ba-_0x5d7cbe;_0x523aaf[_0x1110dd(0x181)]=parseFloat(_0x523aaf[_0x1110dd(0x181)])+parseFloat(_0x5d7cbe),_0x523aaf[_0x1110dd(0x1f3)]=_0x2489ee;const _0x2a7d7c=await _0x523aaf[_0x1110dd(0x199)]();console['log'](_0x2a7d7c);const _0xb66847=await s_payment_data['findOne']({'invoice':_0xbd9c09});_0xb66847[_0x1110dd(0x1ff)]=_0x2489ee,await _0xb66847[_0x1110dd(0x199)]();let _0x1082e0=new Date(),_0x5a20ef=('0'+_0x1082e0[_0x1110dd(0x208)]())[_0x1110dd(0x1f8)](-0x2),_0xb71192=('0'+(_0x1082e0[_0x1110dd(0x1c8)]()+0x1))[_0x1110dd(0x1f8)](-0x2),_0x21c0ad=_0x1082e0['getFullYear'](),_0x4ce16e=_0x21c0ad+'-'+_0xb71192+'-'+_0x5a20ef;const _0x2a4e75=new suppliers_payment({'invoice':_0xbd9c09,'date':_0x21c0ad+'-'+_0xb71192+'-'+_0x5a20ef,'suppliers':_0x4f70f9,'reason':'Paid\x20For\x20Purchase','amount':_0x5d7cbe}),_0x3c2472=await _0x2a4e75[_0x1110dd(0x199)]();_0x80f7a3[_0x1110dd(0x202)](_0x1110dd(0x14e),_0x1110dd(0x182)),_0x4186de[_0x1110dd(0x15b)](_0x1110dd(0x1fb));}catch(_0x2f08c8){console[_0x1110dd(0x150)](_0x2f08c8);}}),router[a0_0x47faad(0x205)](a0_0x47faad(0x1ed),auth,async(_0x2cfc28,_0x5ab8cb)=>{var _0x43b64f=a0_0x47faad;try{const {username:_0x199ddd,email:_0x565b53,role:_0x3316ee}=_0x2cfc28[_0x43b64f(0x210)],_0x3e333d=_0x2cfc28[_0x43b64f(0x210)],_0x50bccc=await profile[_0x43b64f(0x1b3)]({'email':_0x3e333d[_0x43b64f(0x19d)]}),_0x1f8bbd=await master_shop[_0x43b64f(0x1dd)]();console[_0x43b64f(0x150)](_0x43b64f(0xfb),_0x1f8bbd);const _0x5aee31=_0x2cfc28['params']['id'],_0x55494e=await purchases[_0x43b64f(0x20e)](_0x5aee31);console[_0x43b64f(0x150)](_0x55494e);const _0x1081eb=await suppliers[_0x43b64f(0x1b3)]({'name':_0x55494e[_0x43b64f(0x123)]});console[_0x43b64f(0x150)](_0x1081eb);if(_0x1f8bbd[0x0]['language']=='English\x20(US)'){var _0x1dbb5e=users['English'];console[_0x43b64f(0x150)](_0x1dbb5e);}else{if(_0x1f8bbd[0x0][_0x43b64f(0x126)]==_0x43b64f(0x114))var _0x1dbb5e=users[_0x43b64f(0x114)];else{if(_0x1f8bbd[0x0][_0x43b64f(0x126)]==_0x43b64f(0x217))var _0x1dbb5e=users[_0x43b64f(0x217)];else{if(_0x1f8bbd[0x0]['language']=='Spanish')var _0x1dbb5e=users['Spanish'];else{if(_0x1f8bbd[0x0][_0x43b64f(0x126)]=='French')var _0x1dbb5e=users[_0x43b64f(0x125)];else{if(_0x1f8bbd[0x0]['language']==_0x43b64f(0x1da))var _0x1dbb5e=users[_0x43b64f(0x135)];else{if(_0x1f8bbd[0x0][_0x43b64f(0x126)]==_0x43b64f(0x1b1))var _0x1dbb5e=users[_0x43b64f(0x1b1)];else{if(_0x1f8bbd[0x0][_0x43b64f(0x126)]==_0x43b64f(0x213))var _0x1dbb5e=users['Arabic'];}}}}}}}_0x5ab8cb[_0x43b64f(0x1bc)](_0x43b64f(0x12f),{'success':_0x2cfc28['flash'](_0x43b64f(0x14e)),'errors':_0x2cfc28[_0x43b64f(0x202)](_0x43b64f(0x218)),'role':_0x3e333d,'profile':_0x50bccc,'master_shop':_0x1f8bbd,'supplier':_0x1081eb,'purchase':_0x55494e,'language':_0x1dbb5e});}catch(_0x21fea7){console[_0x43b64f(0x150)](_0x21fea7);}}),router['get'](a0_0x47faad(0x1b5),auth,async(_0x55cfe9,_0x28dccb)=>{var _0x2a1d35=a0_0x47faad;try{const {username:_0x300009,email:_0x4e55d8,role:_0x170514}=_0x55cfe9[_0x2a1d35(0x210)],_0x5d27c0=_0x55cfe9[_0x2a1d35(0x210)],_0x1bce2c=await profile[_0x2a1d35(0x1b3)]({'email':_0x5d27c0['email']}),_0x49d7a5=await master_shop[_0x2a1d35(0x1dd)]();console[_0x2a1d35(0x150)](_0x2a1d35(0xfb),_0x49d7a5);const _0x1ec795=_0x55cfe9[_0x2a1d35(0x10a)]['id'];console[_0x2a1d35(0x150)](_0x1ec795);const _0x40e1d4=await purchases['findById'](_0x1ec795);console['log'](_0x2a1d35(0x1fe),_0x40e1d4);const _0x57705f=await product[_0x2a1d35(0x1dd)]({}),_0x1be1eb=await warehouse[_0x2a1d35(0x1a7)]([{'$match':{'name':_0x40e1d4[_0x2a1d35(0x1c6)],'room':_0x40e1d4[_0x2a1d35(0x11a)],'warehouse_category':_0x2a1d35(0x16f)}},{'$unwind':_0x2a1d35(0x183)},{'$group':{'_id':_0x2a1d35(0x211),'name':{'$first':_0x2a1d35(0x187)},'product_stock':{'$first':_0x2a1d35(0x157)},'bay':{'$first':_0x2a1d35(0x1ad)},'bin':{'$first':_0x2a1d35(0x1be)},'type':{'$first':_0x2a1d35(0x1c9)},'floorlevel':{'$first':_0x2a1d35(0x197)},'primary_code':{'$first':_0x2a1d35(0x1ef)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2a1d35(0x1a8)},'storage':{'$first':_0x2a1d35(0x21b)},'rack':{'$first':_0x2a1d35(0x1b0)}}}]);warehouse_data=await warehouse[_0x2a1d35(0x1a7)]([{'$match':{'status':_0x2a1d35(0x136),'name':_0x2a1d35(0x1a3),'warehouse_category':_0x2a1d35(0x16f)}},{'$group':{'_id':_0x2a1d35(0x11f),'name':{'$first':_0x2a1d35(0x11f)}}},{'$sort':{'name':0x1}}]),console[_0x2a1d35(0x150)](_0x2a1d35(0x16c),_0x1be1eb);if(_0x49d7a5[0x0]['language']=='English\x20(US)'){var _0x212fff=users[_0x2a1d35(0x16a)];console[_0x2a1d35(0x150)](_0x212fff);}else{if(_0x49d7a5[0x0]['language']==_0x2a1d35(0x114))var _0x212fff=users[_0x2a1d35(0x114)];else{if(_0x49d7a5[0x0][_0x2a1d35(0x126)]=='German')var _0x212fff=users[_0x2a1d35(0x217)];else{if(_0x49d7a5[0x0][_0x2a1d35(0x126)]==_0x2a1d35(0x131))var _0x212fff=users['Spanish'];else{if(_0x49d7a5[0x0][_0x2a1d35(0x126)]=='French')var _0x212fff=users[_0x2a1d35(0x125)];else{if(_0x49d7a5[0x0][_0x2a1d35(0x126)]==_0x2a1d35(0x1da))var _0x212fff=users[_0x2a1d35(0x135)];else{if(_0x49d7a5[0x0][_0x2a1d35(0x126)]==_0x2a1d35(0x1b1))var _0x212fff=users['Chinese'];else{if(_0x49d7a5[0x0][_0x2a1d35(0x126)]=='Arabic\x20(ae)')var _0x212fff=users[_0x2a1d35(0x1b2)];}}}}}}}_0x28dccb[_0x2a1d35(0x1bc)](_0x2a1d35(0x1f2),{'success':_0x55cfe9['flash'](_0x2a1d35(0x14e)),'errors':_0x55cfe9[_0x2a1d35(0x202)]('errors'),'role':_0x5d27c0,'profile':_0x1bce2c,'user':_0x40e1d4,'stock':_0x1be1eb,'master_shop':_0x49d7a5,'product':_0x57705f,'language':_0x212fff,'warehouse':warehouse_data});}catch(_0x4595f0){console[_0x2a1d35(0x150)](_0x4595f0);}}),router[a0_0x47faad(0x121)]('/view/return_purchase/:id',auth,async(_0x4c3c29,_0x3ba9fa)=>{var _0x50abbb=a0_0x47faad;try{const {invoice:_0x2046cb,date:_0x1f54e4,warehouse_name:_0x14eaf1,Room_name:_0x221665,product_name:_0x474a65,purchase_quantity:_0x242297,stocks:_0x5ce506,return_qty:_0x310546,note:_0xeee49d,level:_0x25b147,isle:_0x20f5bb,pallet:_0x59cbba,to_warehouse_name:_0x209db9,to_Room_name:_0x477654}=_0x4c3c29[_0x50abbb(0x1b7)],_0x5b347f=await purchases[_0x50abbb(0x1b3)]({'_id':_0x4c3c29[_0x50abbb(0x10a)]['id']}),_0x4f17c4=await warehouse['findOne']({'name':_0x14eaf1,'room':_0x221665});if(typeof _0x474a65==_0x50abbb(0x17a))var _0x2cb761=[_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x10d)]],_0x608218=[_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x133)]],_0x197e7b=[_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x214)]],_0x1a2808=[_0x4c3c29['body'][_0x50abbb(0xf5)]],_0x2cc30c=[_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x209)]],_0x164ca5=[_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x1aa)]],_0x15de00=[_0x4c3c29['body']['pallet']],_0x39d54b=[_0x4c3c29['body'][_0x50abbb(0x191)]],_0x6f596f=[_0x4c3c29['body'][_0x50abbb(0x1a2)]],_0x1553f3=[_0x4c3c29[_0x50abbb(0x1b7)]['primary_code_hide']],_0x3f3755=[_0x4c3c29['body'][_0x50abbb(0x203)]];else var _0x2cb761=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x10d)]],_0x608218=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x133)]],_0x197e7b=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x214)]],_0x1a2808=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0xf5)]],_0x2cc30c=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x209)]],_0x164ca5=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x1aa)]],_0x15de00=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x134)]],_0x39d54b=[..._0x4c3c29['body'][_0x50abbb(0x191)]],_0x6f596f=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x1a2)]],_0x1553f3=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x10c)]],_0x3f3755=[..._0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x203)]];const _0x1a0778=_0x2cb761[_0x50abbb(0x1d0)](_0x18842f=>{return _0x18842f={'product_name':_0x18842f};});_0x608218[_0x50abbb(0x104)]((_0x548c43,_0x296e00)=>{var _0x1207f7=_0x50abbb;_0x1a0778[_0x296e00][_0x1207f7(0x133)]=_0x548c43;}),_0x197e7b[_0x50abbb(0x104)]((_0x50ddc6,_0x1f06d0)=>{var _0x26f2e0=_0x50abbb;_0x1a0778[_0x1f06d0][_0x26f2e0(0x201)]=_0x50ddc6;}),_0x1a2808[_0x50abbb(0x104)]((_0x1699de,_0x3042f3)=>{_0x1a0778[_0x3042f3]['return_qty']=_0x1699de;}),_0x2cc30c[_0x50abbb(0x104)]((_0x415ac4,_0x268d2c)=>{var _0x169c09=_0x50abbb;_0x1a0778[_0x268d2c][_0x169c09(0x1bb)]=_0x415ac4;}),_0x164ca5[_0x50abbb(0x104)]((_0x56c583,_0xed3e42)=>{var _0x55844c=_0x50abbb;_0x1a0778[_0xed3e42][_0x55844c(0x14b)]=_0x56c583;}),_0x15de00[_0x50abbb(0x104)]((_0x3498eb,_0x2396df)=>{_0x1a0778[_0x2396df]['floorlevel']=_0x3498eb;}),_0x39d54b[_0x50abbb(0x104)]((_0x46fdca,_0x670738)=>{var _0x2e9bbb=_0x50abbb;_0x1a0778[_0x670738][_0x2e9bbb(0x166)]=_0x46fdca;}),_0x6f596f['forEach']((_0x2c0181,_0x5de1a9)=>{_0x1a0778[_0x5de1a9]['product_code']=_0x2c0181;}),_0x1553f3[_0x50abbb(0x104)]((_0x4b3f03,_0x2fd9d3)=>{_0x1a0778[_0x2fd9d3]['primary_code']=_0x4b3f03;}),_0x3f3755[_0x50abbb(0x104)]((_0x1f3462,_0x2ae70b)=>{var _0x381ec9=_0x50abbb;_0x1a0778[_0x2ae70b][_0x381ec9(0x21a)]=_0x1f3462;}),_0x5b347f[_0x50abbb(0x1e2)][_0x50abbb(0x104)](_0x161a02=>{var _0x3fe534=_0x50abbb;const _0x58741d=_0x4f17c4['product_details'][_0x3fe534(0x1d0)](_0x5e0134=>{var _0x1fc96c=_0x3fe534;_0x5e0134[_0x1fc96c(0x10d)]==_0x161a02[_0x1fc96c(0x10d)]&&_0x5e0134[_0x1fc96c(0x118)]==_0x161a02['floorlevel']&&_0x5e0134['type']==_0x161a02[_0x1fc96c(0x166)]&&_0x5e0134[_0x1fc96c(0x14b)]==_0x161a02[_0x1fc96c(0x14b)]&&_0x5e0134[_0x1fc96c(0x1bb)]==_0x161a02[_0x1fc96c(0x1bb)]&&_0x5e0134['rack']==_0x161a02[_0x1fc96c(0x1de)]&&_0x5e0134[_0x1fc96c(0x17e)]==_0x161a02[_0x1fc96c(0x17e)]&&(console[_0x1fc96c(0x150)](parseInt(_0x5e0134['product_stock'])+_0x1fc96c(0xf9)+parseInt(_0x161a02[_0x1fc96c(0x1cf)])),_0x5e0134[_0x1fc96c(0x207)]=parseInt(_0x5e0134['product_stock'])+parseInt(_0x161a02[_0x1fc96c(0x1cf)]));});}),await _0x4f17c4['save']();const _0x48d60a=_0x1a0778[_0x50abbb(0x18b)](_0x1ffe64=>_0x1ffe64[_0x50abbb(0xf5)]!=='0'&&_0x1ffe64[_0x50abbb(0xf5)]!=='');var _0x30f303=0x0;_0x48d60a[_0x50abbb(0x104)](_0x2c72d5=>{var _0x18d92e=_0x50abbb;console[_0x18d92e(0x150)]('foreach\x20newproduct',_0x2c72d5),(parseInt(_0x2c72d5[_0x18d92e(0x133)])<parseInt(_0x2c72d5[_0x18d92e(0xf5)])||parseInt(_0x2c72d5[_0x18d92e(0x201)])<parseInt(_0x2c72d5[_0x18d92e(0xf5)]))&&_0x30f303++;});if(_0x30f303!=0x0)return _0x4c3c29[_0x50abbb(0x202)](_0x50abbb(0x218),_0x50abbb(0x185)),_0x3ba9fa['redirect'](_0x50abbb(0x1eb));const _0x12b951=new purchases_return({'invoice':_0x2046cb,'suppliers':_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x123)],'date':_0x1f54e4,'warehouse_name':_0x14eaf1,'return_product':_0x48d60a,'note':_0xeee49d,'room':_0x221665,'to_warehouse_name':_0x209db9,'to_room':_0x477654}),_0x2e8f56=await _0x12b951[_0x50abbb(0x199)]();console[_0x50abbb(0x150)](_0x12b951);const _0x57c8be=await purchases_return[_0x50abbb(0x1b3)]({'invoice':_0x2046cb}),_0xce4aa3=await warehouse['findOne']({'name':_0x209db9,'room':_0x477654});_0x57c8be[_0x50abbb(0x1f5)][_0x50abbb(0x104)](_0x33f8b2=>{var _0x581fd4=_0x50abbb,_0x19d0f0=0x0;const _0x585dff=_0xce4aa3[_0x581fd4(0x12a)][_0x581fd4(0x1d0)](_0x46e035=>{var _0x3d14fb=_0x581fd4;_0x46e035[_0x3d14fb(0x10d)]==_0x33f8b2[_0x3d14fb(0x10d)]&&_0x46e035[_0x3d14fb(0x118)]==_0x33f8b2[_0x3d14fb(0x118)]&&_0x46e035['type']==_0x33f8b2[_0x3d14fb(0x166)]&&_0x46e035[_0x3d14fb(0x14b)]==_0x33f8b2[_0x3d14fb(0x14b)]&&_0x46e035[_0x3d14fb(0x1bb)]==_0x33f8b2[_0x3d14fb(0x1bb)]&&(_0x46e035['product_stock']=parseInt(_0x46e035[_0x3d14fb(0x207)])-parseInt(_0x33f8b2[_0x3d14fb(0xf5)]),_0x19d0f0++);});_0x19d0f0=='0'&&(_0xce4aa3[_0x581fd4(0x12a)]=_0xce4aa3[_0x581fd4(0x12a)][_0x581fd4(0x149)]({'product_name':_0x33f8b2[_0x581fd4(0x10d)],'product_stock':_0x33f8b2[_0x581fd4(0xf5)],'primary_code':_0x33f8b2[_0x581fd4(0x1fc)],'secondary_code':_0x33f8b2[_0x581fd4(0x21a)],'product_code':_0x33f8b2[_0x581fd4(0x1d7)],'storage':_0x33f8b2[_0x581fd4(0x17e)],'rack':_0x33f8b2[_0x581fd4(0x1de)],'bay':_0x33f8b2[_0x581fd4(0x1bb)],'bin':_0x33f8b2[_0x581fd4(0x14b)],'type':_0x33f8b2[_0x581fd4(0x166)],'floorlevel':_0x33f8b2[_0x581fd4(0x118)],'maxProducts':_0x33f8b2[_0x581fd4(0x175)],'unit':_0x33f8b2[_0x581fd4(0x169)],'secondary_unit':_0x33f8b2[_0x581fd4(0x19a)],'expiry_date':_0x33f8b2[_0x581fd4(0x130)]}));}),await _0xce4aa3[_0x50abbb(0x199)]();const _0x577a27=await purchases[_0x50abbb(0x1b3)]({'invoice':_0x2046cb});_0x577a27[_0x50abbb(0x11c)]=_0x50abbb(0x178);const _0x184b12=await _0x577a27['save'](),_0x2cd33f=new s_payment_data({'invoice':_0x2046cb,'suppliers':_0x4c3c29[_0x50abbb(0x1b7)]['suppliers'],'reason':_0x50abbb(0x20b)});await _0x2cd33f[_0x50abbb(0x199)]();const _0x22fcfe=await master_shop[_0x50abbb(0x1dd)]();console['log']('add\x20post',_0x22fcfe[0x0][_0x50abbb(0x21c)]);const _0xfc93ac=await email_settings[_0x50abbb(0x1b3)](),_0x17a5e2=await suppliers[_0x50abbb(0x1b3)]({'name':_0x4c3c29[_0x50abbb(0x1b7)][_0x50abbb(0x123)]});console[_0x50abbb(0x150)](_0x50abbb(0x219),_0x17a5e2);_0x22fcfe[0x0][_0x50abbb(0x1ce)]==0x1?(right_currency=_0x22fcfe[0x0][_0x50abbb(0x1db)],left_currency=''):(right_currency='',left_currency=_0x22fcfe[0x0]['currency']);var _0x403752=_0x2cb761,_0x4f6af8=_0x1a2808,_0x48f48d='',_0x48af84;for(_0x48af84 in _0x403752){_0x48f48d+=_0x50abbb(0x173)+_0x50abbb(0x1d2)+_0x403752[_0x48af84]+_0x50abbb(0x1bd)+_0x50abbb(0x1d2)+_0x4f6af8[_0x48af84]+_0x50abbb(0x1bd)+_0x50abbb(0x145);}console[_0x50abbb(0x150)](_0x50abbb(0x1a0),_0x48f48d);let _0x4d8146=nodemailer[_0x50abbb(0x1b8)]({'service':_0x50abbb(0x1e3),'auth':{'user':_0xfc93ac[_0x50abbb(0x19d)],'pass':_0xfc93ac[_0x50abbb(0x129)]}}),_0x5089bd={'from':_0xfc93ac['email'],'to':_0x17a5e2[_0x50abbb(0x19d)],'subject':_0x50abbb(0x15e),'attachments':[{'filename':_0x50abbb(0x1e4),'path':__dirname+'/../public'+_0x50abbb(0x212)+_0x22fcfe[0x0][_0x50abbb(0x21c)],'cid':_0x50abbb(0x1e7)}],'html':'<!DOCTYPE\x20html>'+_0x50abbb(0x132)+_0x50abbb(0x1fd)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x50abbb(0x1ca)+'</div>'+_0x50abbb(0x18a)+_0x50abbb(0x167)+_0x22fcfe[0x0]['site_title']+_0x50abbb(0x1f9)+'</div>'+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x50abbb(0x18a)+_0x50abbb(0x109)+_0x50abbb(0x1cd)+_0x2046cb+'\x20'+_0x50abbb(0x1df)+_0x50abbb(0x1a4)+_0x1f54e4+'\x20'+_0x50abbb(0x1a1)+_0x50abbb(0x195)+'</div>'+_0x50abbb(0x122)+_0x50abbb(0xff)+_0x50abbb(0x173)+_0x50abbb(0x1c7)+_0x50abbb(0x163)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>'+_0x50abbb(0x18d)+_0x50abbb(0x145)+'</thead>'+_0x50abbb(0x17b)+'\x20'+_0x48f48d+'\x20'+'</tbody>'+_0x50abbb(0x17d)+_0x50abbb(0x18a)+_0x50abbb(0x14f)+_0x50abbb(0x144)+_0x22fcfe[0x0][_0x50abbb(0x184)]+_0x50abbb(0x195)+_0x50abbb(0x1d8)+_0x50abbb(0x1d8)+'</body></html>'};_0x4d8146[_0x50abbb(0x20f)](_0x5089bd,function(_0x1fdb42,_0x333e28){var _0x1d4aa3=_0x50abbb;_0x1fdb42?(console[_0x1d4aa3(0x150)](_0x1fdb42),console[_0x1d4aa3(0x150)](_0x1d4aa3(0x1d5))):console[_0x1d4aa3(0x150)](_0x1d4aa3(0x13c));}),_0x4c3c29[_0x50abbb(0x202)](_0x50abbb(0x14e),_0x50abbb(0x204)),_0x3ba9fa[_0x50abbb(0x15b)]('/all_purchases/view');}catch(_0x46852e){console['log'](_0x46852e),_0x3ba9fa[_0x50abbb(0x1ba)](0xc8)['json']({'message':_0x46852e['message']});}}),router[a0_0x47faad(0x205)](a0_0x47faad(0x18c),auth,async(_0x3311ba,_0x1adb42)=>{var _0x5c7575=a0_0x47faad;try{const {username:_0x1aa662,email:_0x36c6da,role:_0xb0f33f}=_0x3311ba[_0x5c7575(0x210)],_0x4b0a64=_0x3311ba['user'],_0x8b03f7=await profile['findOne']({'email':_0x4b0a64['email']}),_0x1d9ae7=await master_shop[_0x5c7575(0x1dd)](),_0x3ed3f3=_0x3311ba[_0x5c7575(0x10a)]['id'],_0x17c50d=await purchases[_0x5c7575(0x20e)](_0x3ed3f3);if(_0x1d9ae7[0x0]['language']==_0x5c7575(0x16e))var _0x452df9=users[_0x5c7575(0x16a)];else{if(_0x1d9ae7[0x0]['language']==_0x5c7575(0x114))var _0x452df9=users[_0x5c7575(0x114)];else{if(_0x1d9ae7[0x0][_0x5c7575(0x126)]==_0x5c7575(0x217))var _0x452df9=users[_0x5c7575(0x217)];else{if(_0x1d9ae7[0x0][_0x5c7575(0x126)]=='Spanish')var _0x452df9=users[_0x5c7575(0x131)];else{if(_0x1d9ae7[0x0][_0x5c7575(0x126)]=='French')var _0x452df9=users[_0x5c7575(0x125)];else{if(_0x1d9ae7[0x0][_0x5c7575(0x126)]==_0x5c7575(0x1da))var _0x452df9=users[_0x5c7575(0x135)];else{if(_0x1d9ae7[0x0][_0x5c7575(0x126)]=='Chinese')var _0x452df9=users[_0x5c7575(0x1b1)];else{if(_0x1d9ae7[0x0][_0x5c7575(0x126)]==_0x5c7575(0x213))var _0x452df9=users[_0x5c7575(0x1b2)];}}}}}}}_0x1adb42[_0x5c7575(0x1bc)](_0x5c7575(0x105),{'success':_0x3311ba['flash'](_0x5c7575(0x14e)),'errors':_0x3311ba[_0x5c7575(0x202)]('errors'),'role':_0x4b0a64,'profile':_0x8b03f7,'alldata':_0x17c50d,'master_shop':_0x1d9ae7,'language':_0x452df9}),console['log'](alldata);}catch(_0x3e8068){console[_0x5c7575(0x150)](_0x3e8068);}}),router[a0_0x47faad(0x121)](a0_0x47faad(0x15a),async(_0x26e2c9,_0x75cf9)=>{var _0x2612d3=a0_0x47faad;const {product_code:_0x27072e}=_0x26e2c9['body'];var _0x4675f9;const _0xa7e5a=await product[_0x2612d3(0x1a7)]([{'$match':{'primary_code':_0x27072e,'product_category':_0x2612d3(0x16f)}},{'$group':{'_id':'$_id','name':{'$first':_0x2612d3(0x11f)},'category':{'$first':_0x2612d3(0x1a6)},'brand':{'$first':_0x2612d3(0x171)},'unit':{'$first':_0x2612d3(0x17f)},'alertquantity':{'$first':_0x2612d3(0x1c5)},'product_code':{'$first':_0x2612d3(0x1a9)},'primary_code':{'$first':_0x2612d3(0x155)},'secondary_code':{'$first':_0x2612d3(0x20c)},'maxStocks':{'$first':_0x2612d3(0x100)},'maxProdPerUnit':{'$first':_0x2612d3(0x19f)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x19af73=await product[_0x2612d3(0x1a7)]([{'$match':{'secondary_code':_0x27072e,'product_category':_0x2612d3(0x16f)}},{'$group':{'_id':_0x2612d3(0x179),'name':{'$first':'$name'},'category':{'$first':_0x2612d3(0x1a6)},'brand':{'$first':_0x2612d3(0x171)},'unit':{'$first':_0x2612d3(0x17f)},'alertquantity':{'$first':_0x2612d3(0x1c5)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x2612d3(0x20c)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x2612d3(0x19f)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xa7e5a[_0x2612d3(0x172)]>0x0)_0x4675f9=_0xa7e5a;else _0x19af73[_0x2612d3(0x172)]>0x0&&(_0x4675f9=_0x19af73);_0x75cf9[_0x2612d3(0x1e0)](_0x4675f9);}),router['post'](a0_0x47faad(0x141),async(_0x382f8b,_0xcc4fd7)=>{var _0x49cd74=a0_0x47faad;const {primaryCode:_0x3bae15,secondaryCode:_0x35a5f3,productCode:_0x1455d4,bay:_0x49f247,bin:_0x4bd7de,types:_0x52d355,pallet:_0x580742,warehouses:_0x45f69f,room:_0x257c26}=_0x382f8b['body'];console['log'](_0x382f8b[_0x49cd74(0x1b7)]);try{const _0x2fa540=await warehouse[_0x49cd74(0x1a7)]([{'$match':{'name':_0x45f69f,'room':_0x257c26}},{'$unwind':_0x49cd74(0x183)},{'$match':{'product_details.bay':_0x49f247,'product_details.bin':_0x4bd7de,'product_details.type':_0x52d355}},{'$group':{'_id':_0x49cd74(0x211),'name':{'$first':_0x49cd74(0x187)},'product_stock':{'$first':_0x49cd74(0x157)},'level':{'$first':_0x49cd74(0x189)},'isle':{'$first':_0x49cd74(0x1ea)},'pallet':{'$first':_0x49cd74(0x153)},'maxProducts':{'$first':_0x49cd74(0x147)}}}]);_0xcc4fd7[_0x49cd74(0x1ba)](0xc8)[_0x49cd74(0x1e0)](_0x2fa540);}catch(_0xc39d78){_0xcc4fd7[_0x49cd74(0x1ba)](0x194)[_0x49cd74(0x1e0)]({'message':_0xc39d78[_0x49cd74(0x1c3)]});}}),module['exports']=router;