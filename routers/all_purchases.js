var a0_0x3c5d12=a0_0x27d0;(function(_0x1f536b,_0x493b6f){var _0x45aced=a0_0x27d0,_0x472167=_0x1f536b();while(!![]){try{var _0x260609=parseInt(_0x45aced(0x2f7))/0x1*(parseInt(_0x45aced(0x20f))/0x2)+parseInt(_0x45aced(0x242))/0x3*(-parseInt(_0x45aced(0x28a))/0x4)+parseInt(_0x45aced(0x2e2))/0x5+-parseInt(_0x45aced(0x2c8))/0x6+parseInt(_0x45aced(0x212))/0x7*(-parseInt(_0x45aced(0x1fd))/0x8)+parseInt(_0x45aced(0x23b))/0x9+-parseInt(_0x45aced(0x203))/0xa*(parseInt(_0x45aced(0x2ab))/0xb);if(_0x260609===_0x493b6f)break;else _0x472167['push'](_0x472167['shift']());}catch(_0x5bc855){_0x472167['push'](_0x472167['shift']());}}}(a0_0x2580,0xb1044));const express=require(a0_0x3c5d12(0x20b)),app=express(),router=express[a0_0x3c5d12(0x287)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x3c5d12(0x213)),auth=require(a0_0x3c5d12(0x2b3)),nodemailer=require(a0_0x3c5d12(0x24e));function a0_0x2580(){var _0x3086da=['<tbody\x20style=\x22text-align:\x20center;\x22>','product_cat','24qfJIQw','Rack\x20B','sendMail','Rack\x20A','suppliers','$product_details.expiry_date','47900bQgpPh','/preview/:id','all_purchases_barcode','Chinese','getFullYear','Receiving\x20Area','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','type','express','random','alertQTY','Hindi','1791564XprdYp','forEach','floorlevel','2399719ZDosyY','../models/all_models','/upload/','$suppliers_docs','/all_purchases/view','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$category','get','$product_details.product_name','$paid_amount','secondary_unit','product_stock','port','Rack\x20E','$product_details.primary_code','Return\x20Goods','actual_qty','paid_amount','<table\x20style=\x22width:\x20100%\x20!important;\x22>','createTransport','slice','../public/language/languages.json','An\x20error\x20occurred.','currency','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.storage','INC-','$room','find','render','$secondary_code','storage','Rack\x20D','master','params','$name','invoice','findById','Room_name','prod_Qty','success','10630386AJUikL','stocks','Purchase\x20data\x20added\x20successfully','<h5>','$product.room_name','expiry_date','abs','133425uEyVcK','Rack\x20F','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Spanish','map','product_details','$expiry_date','table\x20page','password','product','Arabic\x20(ae)','nodemailer','</td>','Enabled','purchase\x20data\x20update\x20successfully','$invoice','role','Level','/../public','delivery_code','\x20<>\x20','Portuguese','json','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','push','prod_level','purchase_quantity','product_code','<span\x20style=\x22float:\x20right;\x22>','$product.floorlevel','catch','maxperunit','/barcode/:id','</tr>','warehouse','\x20Order\x20Date\x20:\x20','$product.bin','return_qty','$return_data','warehouse_name','redirect','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','staff','<div>','RoomAssign','foreach\x20newproduct','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','stock_quantity','prod_secondunit','$date','\x20<\x20wew\x20>\x20','note','due_amount','English\x20(US)','Enclosed','$product_details.floorlevel','</tbody>','German','length','$finalize','suppliers_data','$product_details._id','/invoice/:id','$product_details.secondary_code','status','$product_details.product_code','level','Router','prod_code','Rack\x20C','52fOcyGy','bay','message','product_list','deliverycode','user','</head><body>','prod_pallet','Floor','user_id','$due_amount','Logo.png','<hr\x20class=\x22my-3\x22>','$product.bay','<!DOCTYPE\x20html>','findOne','all','add\x20post','maxStocks','French','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/view/return_purchase/:id','</body></html>','<h5\x20style=\x22text-align:\x20left;\x22>','/give_payment/:id','Email\x20sent\x20successfully','Purchase\x20Return\x20Mail','$product_details.level','$product_details.isle','max_product_unit','body','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','pallet','715CECguI','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Portuguese\x20(BR)','$unit','</div>','prod_primunit','getMonth','filter','../middleware/auth','\x20</h2>','Error\x20Occurs','getDate','prod_isle','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','purchase_invoice','$product_details.pallet','JO_number','Purchase\x20Return','exports','$product','all_purchases','True','DRY\x20STORAGE','logo','MaxStocks_data','flash','host','<html><head><title></title>','log','2028942WhOKwH','/view/add_purchases/:id','product_code_hide','types','string','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</span>','path','<h2>\x20','</h5>','name','production_date','An\x20error\x20occurred\x20while\x20saving\x20data.','quantity','\x20Order\x20Number\x20:\x20','RMSEmail','rack','$alertquantity','/barcode_scanner','$product_details.rack','$primary_code','prod_unit','room','image','Raw\x20Materials','/view/:id','4521285oxhaTS','suppliers_docs','actual_uom','$product_details.product_stock','$product.type','site_title','primary_code','$warehouse_name','$_id','$maxStocks','save','Purchase\x20Mail','rak','error','/CheckingWarehouse','secondary_code','post','$product_details.bin','batch_code','Shelves','edit_purchases_view','1fkrNzA','amount','<strong>\x20Regards\x20</strong>','prod_name','prod_invoice','$product_details.bay','$suppliers','prod_cat','</table>','delivery_date','<tr>','Sales\x20Update\x20successfully','aggregate','concat','primary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','email','</thead>','secondary_code_hide','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','date','language','product_name','$product.quantity','$batch_code','bin','$product_code','add_purchases','$product_details.type','room_name','here','standard_unit','isle','Arabic','errors','/view/add_purchases'];a0_0x2580=function(){return _0x3086da;};return a0_0x2580();}var ejs=require('ejs');function a0_0x27d0(_0x1445d6,_0x1835e7){var _0x25806c=a0_0x2580();return a0_0x27d0=function(_0x27d0a8,_0x57f699){_0x27d0a8=_0x27d0a8-0x1e5;var _0xabc2d7=_0x25806c[_0x27d0a8];return _0xabc2d7;},a0_0x27d0(_0x1445d6,_0x1835e7);}const path=require(a0_0x3c5d12(0x2cf)),users=require(a0_0x3c5d12(0x227));router[a0_0x3c5d12(0x219)]('/view',auth,async(_0x50f34a,_0x3eacff)=>{var _0x3dccb1=a0_0x3c5d12;try{const {username:_0x3bd1a9,email:_0x39f159,role:_0x55a380}=_0x50f34a[_0x3dccb1(0x28f)],_0x1c5efb=_0x50f34a['user'],_0x1d9a70=await profile['findOne']({'email':_0x1c5efb[_0x3dccb1(0x1e7)]}),_0x8d1499=await staff[_0x3dccb1(0x299)]({'email':_0x1c5efb[_0x3dccb1(0x1e7)]});if(_0x1c5efb[_0x3dccb1(0x253)]==_0x3dccb1(0x26d)){const _0x13c33e=await staff[_0x3dccb1(0x299)]({'email':_0x1c5efb[_0x3dccb1(0x1e7)]});}const _0x2a1a85=await master_shop['find']();let _0x417c42;if(_0x1c5efb[_0x3dccb1(0x253)]=='staff'){const _0x154c3c=await staff[_0x3dccb1(0x299)]({'email':_0x1c5efb['email']});_0x417c42=await purchases['aggregate']([{'$match':{'warehouse_name':_0x154c3c['warehouse']}},{'$lookup':{'from':_0x3dccb1(0x201),'localField':_0x3dccb1(0x201),'foreignField':_0x3dccb1(0x2d2),'as':_0x3dccb1(0x2e3)}},{'$unwind':_0x3dccb1(0x215)},{'$unwind':_0x3dccb1(0x2be)},{'$group':{'_id':_0x3dccb1(0x2ea),'invoice':{'$first':'$invoice'},'suppliers':{'$first':_0x3dccb1(0x2fd)},'date':{'$first':_0x3dccb1(0x275)},'warehouse_name':{'$first':_0x3dccb1(0x2e9)},'room':{'$first':_0x3dccb1(0x22d)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3dccb1(0x21b)},'due_amount':{'$first':_0x3dccb1(0x294)},'return_data':{'$first':_0x3dccb1(0x269)},'batch_code':{'$first':_0x3dccb1(0x1ef)},'expiry_date':{'$first':_0x3dccb1(0x249)},'suppliers_docs':{'$first':_0x3dccb1(0x215)},'total_product_quantity':{'$sum':_0x3dccb1(0x1ee)},'level':{'$addToSet':_0x3dccb1(0x297)},'isle':{'$addToSet':_0x3dccb1(0x267)},'type':{'$addToSet':'$product.type'},'floorlevel':{'$addToSet':'$product.floorlevel'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x417c42=await purchases[_0x3dccb1(0x303)]([{'$lookup':{'from':_0x3dccb1(0x201),'localField':_0x3dccb1(0x201),'foreignField':_0x3dccb1(0x2d2),'as':_0x3dccb1(0x2e3)}},{'$unwind':_0x3dccb1(0x215)},{'$unwind':_0x3dccb1(0x2be)},{'$group':{'_id':_0x3dccb1(0x2ea),'invoice':{'$first':_0x3dccb1(0x252)},'suppliers':{'$first':_0x3dccb1(0x2fd)},'date':{'$first':_0x3dccb1(0x275)},'warehouse_name':{'$first':_0x3dccb1(0x2e9)},'room':{'$addToSet':_0x3dccb1(0x23f)},'product':{'$push':_0x3dccb1(0x2be)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x3dccb1(0x21b)},'due_amount':{'$first':_0x3dccb1(0x294)},'return_data':{'$first':_0x3dccb1(0x269)},'batch_code':{'$first':_0x3dccb1(0x1ef)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x3dccb1(0x215)},'total_product_quantity':{'$sum':_0x3dccb1(0x1ee)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x3dccb1(0x267)},'type':{'$addToSet':_0x3dccb1(0x2e6)},'floorlevel':{'$addToSet':_0x3dccb1(0x260)},'finalize':{'$first':_0x3dccb1(0x27f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x2a1a85[0x0][_0x3dccb1(0x1ec)]==_0x3dccb1(0x279)){var _0xa7b695=users[_0x3dccb1(0x271)];console[_0x3dccb1(0x2c7)](_0xa7b695);}else{if(_0x2a1a85[0x0]['language']=='Hindi')var _0xa7b695=users[_0x3dccb1(0x20e)];else{if(_0x2a1a85[0x0]['language']==_0x3dccb1(0x27d))var _0xa7b695=users['German'];else{if(_0x2a1a85[0x0][_0x3dccb1(0x1ec)]==_0x3dccb1(0x246))var _0xa7b695=users['Spanish'];else{if(_0x2a1a85[0x0][_0x3dccb1(0x1ec)]==_0x3dccb1(0x29d))var _0xa7b695=users[_0x3dccb1(0x29d)];else{if(_0x2a1a85[0x0]['language']==_0x3dccb1(0x2ad))var _0xa7b695=users[_0x3dccb1(0x258)];else{if(_0x2a1a85[0x0][_0x3dccb1(0x1ec)]==_0x3dccb1(0x206))var _0xa7b695=users[_0x3dccb1(0x206)];else{if(_0x2a1a85[0x0][_0x3dccb1(0x1ec)]==_0x3dccb1(0x24d))var _0xa7b695=users[_0x3dccb1(0x1f8)];}}}}}}}_0x3eacff[_0x3dccb1(0x22f)](_0x3dccb1(0x2bf),{'success':_0x50f34a[_0x3dccb1(0x2c4)](_0x3dccb1(0x23a)),'errors':_0x50f34a[_0x3dccb1(0x2c4)]('errors'),'purchases':_0x417c42,'role':_0x1c5efb,'profile':_0x1d9a70,'master_shop':_0x2a1a85,'language':_0xa7b695});}catch(_0x35e06b){console[_0x3dccb1(0x2c7)](_0x3dccb1(0x24a),_0x35e06b),_0x3eacff[_0x3dccb1(0x284)](0xc8)['json']({'message':_0x35e06b[_0x3dccb1(0x28c)]});}});function BayBinSelected(_0x4078dc,_0xb4c14c){var _0x599b83=a0_0x3c5d12,_0x25172d=[],_0x479d16=[],_0x42f18a=[],_0x275aed=[],_0x402132=[],_0x4eb141=[];let _0x53950c=[];if(_0x4078dc==_0x599b83(0x2c1))switch(_0xb4c14c){case _0x599b83(0x200):_0x25172d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x479d16=[0x1,0x2],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x254),'Floor'],_0x402132=['D'],_0x4eb141=['A'];break;case _0x599b83(0x1fe):_0x25172d=[0x6,0x5,0x4,0x3,0x2,0x1],_0x479d16=[0x1,0x2],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x254),_0x599b83(0x292)],_0x402132=['D'],_0x4eb141=['B'];break;case _0x599b83(0x2f5):_0x25172d=[0x0],_0x479d16=[0x0],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x292)],_0x402132=['D'],_0x4eb141=['S'];break;case'Receiving\x20Area':_0x25172d=[0x0],_0x479d16=[0x0],_0x275aed=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x42f18a=[_0x599b83(0x292)],_0x402132=['D'],_0x4eb141=['R'];break;}else{if(_0x4078dc=='COLD\x20STORAGE')switch(_0xb4c14c){case'Rack\x20A':_0x25172d=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x479d16=['B','F'],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x254),_0x599b83(0x292)],_0x402132=['C'],_0x4eb141=['A'];break;case _0x599b83(0x1fe):_0x25172d=[0x5,0x4,0x3,0x2,0x1],_0x479d16=['F','B','S'],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=['Level',_0x599b83(0x292)],_0x402132=['C'],_0x4eb141=['B'];break;case _0x599b83(0x289):_0x25172d=[0x1,0x2,0x3,0x4,0x5],_0x479d16=['B','F','S'],_0x275aed=[0x5,0x4,0x3,0x2,0x1],_0x42f18a=['Level',_0x599b83(0x292)],_0x402132=['C'],_0x4eb141=['C'];break;case _0x599b83(0x232):_0x25172d=[0x5,0x4,0x3,0x2,0x1],_0x479d16=['F','B','S'],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x254),'Floor'],_0x402132=['C'],_0x4eb141=['D'];break;case _0x599b83(0x21f):_0x25172d=[0x4,0x3,0x2,0x1],_0x479d16=[0x1,0x2],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x254),_0x599b83(0x292)],_0x402132=['C'],_0x4eb141=['E'];break;case _0x599b83(0x243):_0x25172d=[0x1,0x2,0x3],_0x479d16=[0x1,0x2],_0x275aed=[0x1,0x2,0x3,0x4,0x5],_0x42f18a=[_0x599b83(0x254)],_0x402132=['C'],_0x4eb141=['F'];break;}}return{'levels':_0x25172d,'Isle':_0x479d16,'rack':_0x275aed,'type':_0x42f18a,'storage':_0x402132,'rak':_0x4eb141};}async function getRandom8DigitNumber(){var _0x2f76e0=a0_0x3c5d12;const _0x2d5861=0x989680,_0x17d851=0x5f5e0ff,_0x12f0bc=Math['floor'](Math[_0x2f76e0(0x20c)]()*(_0x17d851-_0x2d5861+0x1))+_0x2d5861;var _0x554958;const _0x3ce6df=await purchases[_0x2f76e0(0x299)]({'invoice':_0x2f76e0(0x22c)+_0x12f0bc});return _0x3ce6df&&_0x3ce6df['length']>0x0?_0x554958=_0x2f76e0(0x22c)+_0x12f0bc:_0x554958=_0x2f76e0(0x22c)+_0x12f0bc,_0x554958;}router[a0_0x3c5d12(0x219)](a0_0x3c5d12(0x1fa),auth,async(_0x5437b2,_0xf658a7)=>{var _0x252a99=a0_0x3c5d12;try{const {username:_0x13f852,email:_0x18a80e,role:_0x5b33ea}=_0x5437b2[_0x252a99(0x28f)],_0x3d64ff=_0x5437b2[_0x252a99(0x28f)],_0x1658b4=await profile[_0x252a99(0x299)]({'email':_0x3d64ff[_0x252a99(0x1e7)]}),_0x381a29=await master_shop[_0x252a99(0x22e)](),_0x3b0c26=await staff[_0x252a99(0x299)]({'email':_0x3d64ff[_0x252a99(0x1e7)]}),_0x380559=await suppliers[_0x252a99(0x22e)]({});let _0x493579;if(_0x3d64ff[_0x252a99(0x253)]==_0x252a99(0x26d)){const _0x51fa4a=await staff[_0x252a99(0x299)]({'email':_0x3d64ff[_0x252a99(0x1e7)]});_0x493579=await warehouse[_0x252a99(0x303)]([{'$match':{'status':_0x252a99(0x250),'name':_0x51fa4a[_0x252a99(0x265)],'warehouse_category':_0x252a99(0x2e0),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x252a99(0x235),'name':{'$first':_0x252a99(0x235)}}}]);}else _0x493579=await warehouse[_0x252a99(0x303)]([{'$match':{'status':_0x252a99(0x250),'warehouse_category':_0x252a99(0x2e0),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x252a99(0x235),'name':{'$first':_0x252a99(0x235)}}}]);const _0x235039=await product[_0x252a99(0x22e)]({}),_0x46a158=await warehouse[_0x252a99(0x22e)]({'status':'Enabled'}),_0x107805=await purchases[_0x252a99(0x22e)]({}),_0x326b4c=_0x107805['length']+0x1,_0x13e0cb=_0x252a99(0x22c)+_0x326b4c['toString']()['padStart'](0x5,'0');var _0x342b9e=['Ambient',_0x252a99(0x27a)];if(_0x381a29[0x0][_0x252a99(0x1ec)]==_0x252a99(0x279))var _0x450187=users[_0x252a99(0x271)];else{if(_0x381a29[0x0][_0x252a99(0x1ec)]==_0x252a99(0x20e))var _0x450187=users[_0x252a99(0x20e)];else{if(_0x381a29[0x0][_0x252a99(0x1ec)]=='German')var _0x450187=users[_0x252a99(0x27d)];else{if(_0x381a29[0x0]['language']==_0x252a99(0x246))var _0x450187=users[_0x252a99(0x246)];else{if(_0x381a29[0x0][_0x252a99(0x1ec)]=='French')var _0x450187=users['French'];else{if(_0x381a29[0x0][_0x252a99(0x1ec)]==_0x252a99(0x2ad))var _0x450187=users[_0x252a99(0x258)];else{if(_0x381a29[0x0][_0x252a99(0x1ec)]=='Chinese')var _0x450187=users[_0x252a99(0x206)];else{if(_0x381a29[0x0]['language']==_0x252a99(0x24d))var _0x450187=users[_0x252a99(0x1f8)];}}}}}}}const _0x2c7b17=getRandom8DigitNumber();_0x2c7b17['then'](_0x43f1e0=>{var _0x2c1e5d=_0x252a99;_0xf658a7[_0x2c1e5d(0x22f)](_0x2c1e5d(0x1f2),{'success':_0x5437b2[_0x2c1e5d(0x2c4)](_0x2c1e5d(0x23a)),'errors':_0x5437b2[_0x2c1e5d(0x2c4)](_0x2c1e5d(0x1f9)),'role':_0x3d64ff,'profile':_0x1658b4,'suppliers':_0x380559,'warehouse':_0x493579,'product':_0x235039,'invoice':_0x43f1e0,'master_shop':_0x381a29,'language':_0x450187,'find_data':_0x46a158,'rooms_data':_0x342b9e});})[_0x252a99(0x261)](_0x247bb2=>{var _0x4b4d49=_0x252a99;_0x5437b2[_0x4b4d49(0x2c4)]('errors',_0x4b4d49(0x217)),_0xf658a7['redirect'](_0x4b4d49(0x216));});}catch(_0x46763a){console[_0x252a99(0x2c7)](_0x46763a);}}),router[a0_0x3c5d12(0x219)](a0_0x3c5d12(0x2c9),auth,async(_0x544c36,_0x522b45)=>{var _0x195cf4=a0_0x3c5d12;try{const _0xc3fda2=_0x544c36['params']['id'];console[_0x195cf4(0x2c7)](_0xc3fda2);const _0x286da0=await master_shop[_0x195cf4(0x22e)]();console[_0x195cf4(0x2c7)](_0x195cf4(0x233),_0x286da0);const _0x30b8a5=await product['findOne']({'name':_0xc3fda2});console[_0x195cf4(0x2c7)](_0x195cf4(0x24c),_0x30b8a5),_0x522b45[_0x195cf4(0x284)](0xc8)[_0x195cf4(0x259)]({'product_data':_0x30b8a5,'master':_0x286da0});}catch(_0x269388){console[_0x195cf4(0x2c7)]('add_purchases\x20error',_0x269388);}}),router[a0_0x3c5d12(0x2f2)]('/view/add_purchases',auth,async(_0x14cabc,_0x1066cf)=>{var _0xf53fc4=a0_0x3c5d12;try{const {invoice:_0x10ad8d,date:_0x4a3d23,warehouse_name:_0x2f0e16,prod_name:_0x4959ab,prod_code:_0x43750b,prod_qty:_0x49787c,prod_unit:_0x460cd7,prod_secondunit:_0x5261f6,prod_level:_0x269cb3,prod_isle:_0x114dc4,prod_pallet:_0xa8f144,note:_0x1f20f9,expiry_date:_0x2c545f,batch_code:_0x395dcb,payable:_0x13939a,due_amount:_0x20a496,Room_name:_0x17d1c1,primary_code:_0x396029,secondary_code:_0x1d1107,MaxStocks_data:_0x5a3c39,PO_number:_0x222f1e,SCRN:_0x3d06b6,JO_number:_0x5a9707}=_0x14cabc[_0xf53fc4(0x2a8)];if(typeof _0x4959ab=='string')var _0x421350=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2fa)]],_0x4862a5=[_0x14cabc['body'][_0xf53fc4(0x288)]],_0x2e68c8=[_0x14cabc[_0xf53fc4(0x2a8)]['prod_Qty']],_0x4ab7b3=[_0x14cabc['body']['prod_primunit']],_0x39f96a=[_0x14cabc['body'][_0xf53fc4(0x274)]],_0x329c80=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x25c)]],_0x42996f=[_0x14cabc[_0xf53fc4(0x2a8)]['primary_code']],_0x2593ee=[_0x14cabc[_0xf53fc4(0x2a8)]['secondary_code']],_0xac05d7=[_0x14cabc[_0xf53fc4(0x2a8)]['MaxStocks_data']],_0x44192a=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2f4)]],_0x97b2dc=[_0x14cabc[_0xf53fc4(0x2a8)]['expiry_date']],_0x46a269=[_0x14cabc['body'][_0xf53fc4(0x2a7)]],_0x38e310=[_0x14cabc['body'][_0xf53fc4(0x20d)]],_0x33a02c=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2d3)]],_0x541bcb=[_0x14cabc['body'][_0xf53fc4(0x2fe)]],_0xbe09d9=[_0x14cabc['body'][_0xf53fc4(0x26f)]],_0x4e19c6=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x28e)]],_0x322805=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2fb)]],_0x3c96ca=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x222)]],_0x2af89d=[_0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2e4)]];else var _0x421350=[..._0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2fa)]],_0x4862a5=[..._0x14cabc['body'][_0xf53fc4(0x288)]],_0x2e68c8=[..._0x14cabc['body'][_0xf53fc4(0x239)]],_0x4ab7b3=[..._0x14cabc['body'][_0xf53fc4(0x2b0)]],_0x39f96a=[..._0x14cabc['body'][_0xf53fc4(0x274)]],_0x329c80=[..._0x14cabc['body']['prod_level']],_0x42996f=[..._0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2e8)]],_0x2593ee=[..._0x14cabc['body']['secondary_code']],_0xac05d7=[..._0x14cabc['body'][_0xf53fc4(0x2c3)]],_0x44192a=[..._0x14cabc['body'][_0xf53fc4(0x2f4)]],_0x97b2dc=[..._0x14cabc['body'][_0xf53fc4(0x240)]],_0x46a269=[..._0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2a7)]],_0x38e310=[..._0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x20d)]],_0x33a02c=[..._0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x2d3)]],_0x541bcb=[..._0x14cabc[_0xf53fc4(0x2a8)]['prod_cat']],_0xbe09d9=[..._0x14cabc[_0xf53fc4(0x2a8)][_0xf53fc4(0x26f)]],_0x4e19c6=[..._0x14cabc[_0xf53fc4(0x2a8)]['deliverycode']],_0x322805=[..._0x14cabc['body']['prod_invoice']],_0x3c96ca=[..._0x14cabc['body'][_0xf53fc4(0x222)]],_0x2af89d=[..._0x14cabc[_0xf53fc4(0x2a8)]['actual_uom']];const _0x1a3626=_0x421350[_0xf53fc4(0x247)](_0x340fb3=>{return _0x340fb3={'product_name':_0x340fb3};});_0x3c96ca['forEach']((_0x3c458e,_0x152cc8)=>{var _0x5b2b88=_0xf53fc4;_0x1a3626[_0x152cc8][_0x5b2b88(0x222)]=Math[_0x5b2b88(0x241)](_0x3c458e);}),_0x2af89d[_0xf53fc4(0x210)]((_0x16a4ff,_0x3ddc0a)=>{var _0x49524f=_0xf53fc4;_0x1a3626[_0x3ddc0a][_0x49524f(0x2e4)]=_0x16a4ff;}),_0x4862a5['forEach']((_0x4b79e2,_0x40880e)=>{var _0x36f6e9=_0xf53fc4;_0x1a3626[_0x40880e][_0x36f6e9(0x25e)]=_0x4b79e2;}),_0x2e68c8[_0xf53fc4(0x210)]((_0x46041a,_0x1aaf3e)=>{var _0x5b3071=_0xf53fc4;_0x1a3626[_0x1aaf3e]['quantity']=Math[_0x5b3071(0x241)](_0x46041a);}),_0x4ab7b3['forEach']((_0x2a1feb,_0x3d08f9)=>{var _0x1dd25a=_0xf53fc4;_0x1a3626[_0x3d08f9][_0x1dd25a(0x1f6)]=_0x2a1feb;}),_0x39f96a[_0xf53fc4(0x210)]((_0x192d6d,_0x1fbd18)=>{var _0x44bcb2=_0xf53fc4;_0x1a3626[_0x1fbd18][_0x44bcb2(0x21c)]=_0x192d6d;}),_0x329c80[_0xf53fc4(0x210)]((_0xf0baf9,_0x2618cf)=>{var _0x794e63=_0xf53fc4;_0xbe09d9[_0x794e63(0x210)]((_0x5ac2af,_0xc2aba)=>{var _0x353b9b=_0x794e63;if(_0x5ac2af==_0x353b9b(0x208)&&_0x2618cf==_0xc2aba){console['log'](_0x5ac2af+_0x353b9b(0x276)+_0x2618cf+_0x353b9b(0x257)+_0xc2aba+_0x353b9b(0x257)+_0xf0baf9);var _0xca4012=_0xf0baf9[_0x353b9b(0x226)](0x3);_0x1a3626[_0x2618cf][_0x353b9b(0x231)]=_0xf0baf9[0x0],_0x1a3626[_0x2618cf][_0x353b9b(0x2d8)]=_0xf0baf9[0x1],_0x1a3626[_0x2618cf]['bay']=0x0,_0x1a3626[_0x2618cf][_0x353b9b(0x1f0)]=0x0,_0x1a3626[_0x2618cf][_0x353b9b(0x20a)]='Floor',_0x1a3626[_0x2618cf]['floorlevel']=_0xca4012;}else{if(_0x5ac2af==_0x353b9b(0x2f5)&&_0x2618cf==_0xc2aba){var _0xca4012=_0xf0baf9['slice'](0x3);_0x1a3626[_0x2618cf][_0x353b9b(0x231)]=_0xf0baf9[0x0],_0x1a3626[_0x2618cf]['rack']=_0xf0baf9[0x1],_0x1a3626[_0x2618cf][_0x353b9b(0x28b)]=0x0,_0x1a3626[_0x2618cf][_0x353b9b(0x1f0)]=0x0,_0x1a3626[_0x2618cf][_0x353b9b(0x20a)]=_0x353b9b(0x292),_0x1a3626[_0x2618cf]['floorlevel']=_0xf0baf9[0x5];}else{if(_0x2618cf==_0xc2aba){if(_0xf0baf9[0x0]=='A'&&_0xf0baf9[0x1]=='L'&&_0xf0baf9[0x2]=='L')console[_0x353b9b(0x2c7)](_0x5ac2af+'\x20<>\x20'+_0x2618cf+_0x353b9b(0x257)+_0xc2aba+'\x20<>\x20'+_0xf0baf9+_0x353b9b(0x1f5)),_0x1a3626[_0x2618cf][_0x353b9b(0x231)]=_0xf0baf9[0x0],_0x1a3626[_0x2618cf][_0x353b9b(0x2d8)]=_0xf0baf9[0x1],_0x1a3626[_0x2618cf][_0x353b9b(0x28b)]=0x0,_0x1a3626[_0x2618cf][_0x353b9b(0x1f0)]=0x0,_0x1a3626[_0x2618cf][_0x353b9b(0x20a)]=_0x353b9b(0x292),_0x1a3626[_0x2618cf]['floorlevel']=_0xf0baf9[0x3];else{var _0x34cbd7;if(_0xf0baf9[0x4]=='L')_0x34cbd7=_0x353b9b(0x254);else _0xf0baf9[0x4]=='F'&&(_0x34cbd7='Floor');_0x1a3626[_0x2618cf][_0x353b9b(0x231)]=_0xf0baf9[0x0],_0x1a3626[_0x2618cf]['rack']=_0xf0baf9[0x1],_0x1a3626[_0x2618cf][_0x353b9b(0x28b)]=_0xf0baf9[0x2],_0x1a3626[_0x2618cf][_0x353b9b(0x1f0)]=_0xf0baf9[0x3],_0x1a3626[_0x2618cf][_0x353b9b(0x20a)]=_0x34cbd7,_0x1a3626[_0x2618cf]['floorlevel']=_0xf0baf9[0x5];}}}}});}),_0x42996f[_0xf53fc4(0x210)]((_0x38c463,_0x344087)=>{var _0x2a7464=_0xf53fc4;_0x1a3626[_0x344087][_0x2a7464(0x2e8)]=_0x38c463;}),_0x2593ee['forEach']((_0x349644,_0x3cd4f7)=>{_0x1a3626[_0x3cd4f7]['secondary_code']=_0x349644;}),_0xac05d7[_0xf53fc4(0x210)]((_0x46432e,_0x485fe5)=>{var _0x58de13=_0xf53fc4;_0x1a3626[_0x485fe5][_0x58de13(0x29c)]=_0x46432e;}),_0x44192a[_0xf53fc4(0x210)]((_0x481072,_0x47ee9a)=>{var _0x5c1fc0=_0xf53fc4;_0x1a3626[_0x47ee9a][_0x5c1fc0(0x2f4)]=_0x481072;}),_0x97b2dc[_0xf53fc4(0x210)]((_0x1fe49d,_0x3b148c)=>{var _0x191ff3=_0xf53fc4;_0x1a3626[_0x3b148c][_0x191ff3(0x240)]=_0x1fe49d;}),_0x46a269['forEach']((_0x223647,_0x2665ca)=>{var _0x5486af=_0xf53fc4;_0x1a3626[_0x2665ca][_0x5486af(0x262)]=_0x223647;}),_0x38e310['forEach']((_0xac79db,_0x3a0220)=>{_0x1a3626[_0x3a0220]['alertQTY']=_0xac79db;}),_0x33a02c[_0xf53fc4(0x210)]((_0x38d2e1,_0x28e61a)=>{var _0x3241db=_0xf53fc4;_0x1a3626[_0x28e61a][_0x3241db(0x2d3)]=_0x38d2e1;}),_0x541bcb[_0xf53fc4(0x210)]((_0x3c73d5,_0x2c770a)=>{var _0x59e31b=_0xf53fc4;_0x1a3626[_0x2c770a][_0x59e31b(0x1fc)]=_0x3c73d5;}),_0xbe09d9[_0xf53fc4(0x210)]((_0x222192,_0x158070)=>{var _0x4e5445=_0xf53fc4;_0x1a3626[_0x158070][_0x4e5445(0x1f4)]=_0x222192;}),_0x4e19c6['forEach']((_0x1d18f1,_0x86f1d2)=>{var _0x16b0ee=_0xf53fc4;_0x1a3626[_0x86f1d2][_0x16b0ee(0x256)]=_0x1d18f1;}),_0x322805[_0xf53fc4(0x210)]((_0x245e9d,_0x338c8b)=>{var _0x302596=_0xf53fc4;_0x1a3626[_0x338c8b][_0x302596(0x236)]=_0x245e9d;});const _0x1baba7=_0xbe09d9[_0xf53fc4(0x247)](_0x384df3=>{return _0x384df3={'room_name':_0x384df3};}),_0x1a0658=_0x1a3626['filter'](_0x4e9014=>_0x4e9014['quantity']!=='0'&&_0x4e9014['quantity']!==''),_0x3f0eed=new purchases({'invoice':_0x10ad8d,'suppliers':_0x14cabc[_0xf53fc4(0x2a8)]['suppliers'],'date':_0x4a3d23,'warehouse_name':_0x2f0e16,'product':_0x1a0658,'note':_0x1f20f9,'due_amount':_0x20a496,'POnumber':_0x222f1e,'SCRN':_0x3d06b6,'JO_number':_0x5a9707,'roomList':_0x1baba7}),_0x13b5ba=await _0x3f0eed['save'](),_0x489000=await purchases[_0xf53fc4(0x299)]({'invoice':_0x10ad8d}),_0x60c3cc=_0x489000['product']['map'](async _0x69431f=>{var _0x34b8f1=_0xf53fc4,_0x5e4cdf=await warehouse['findOne']({'name':_0x2f0e16,'room':_0x69431f['room_name']}),_0x305366=0x0;return _0x5e4cdf[_0x34b8f1(0x248)][_0x34b8f1(0x210)](_0xd4eb74=>{var _0x431d53=_0x34b8f1;_0xd4eb74[_0x431d53(0x1ed)]==_0x69431f[_0x431d53(0x1ed)]&&_0xd4eb74[_0x431d53(0x211)]==_0x69431f[_0x431d53(0x211)]&&_0xd4eb74[_0x431d53(0x20a)]==_0x69431f[_0x431d53(0x20a)]&&_0xd4eb74[_0x431d53(0x1f0)]==_0x69431f['bin']&&_0xd4eb74[_0x431d53(0x28b)]==_0x69431f[_0x431d53(0x28b)]&&_0xd4eb74[_0x431d53(0x2d8)]==_0x69431f[_0x431d53(0x2d8)]&&_0xd4eb74['storage']==_0x69431f[_0x431d53(0x231)]&&_0xd4eb74[_0x431d53(0x240)]==_0x69431f[_0x431d53(0x240)]&&_0xd4eb74['batch_code']==_0x69431f[_0x431d53(0x2f4)]&&_0xd4eb74[_0x431d53(0x2d3)]==_0x69431f['production_date']&&_0xd4eb74[_0x431d53(0x236)]==_0x489000[_0x431d53(0x236)]&&(_0xd4eb74[_0x431d53(0x21d)]+=Math['abs'](_0x69431f['quantity']),_0x305366++);}),_0x305366===0x0&&_0x5e4cdf[_0x34b8f1(0x248)][_0x34b8f1(0x25b)]({'product_name':_0x69431f[_0x34b8f1(0x1ed)],'product_stock':Math[_0x34b8f1(0x241)](_0x69431f['quantity']),'primary_code':_0x69431f[_0x34b8f1(0x2e8)],'secondary_code':_0x69431f[_0x34b8f1(0x2f1)],'product_code':_0x69431f['product_code'],'storage':_0x69431f[_0x34b8f1(0x231)],'rack':_0x69431f[_0x34b8f1(0x2d8)],'bay':_0x69431f[_0x34b8f1(0x28b)],'bin':_0x69431f['bin'],'type':_0x69431f['type'],'floorlevel':_0x69431f[_0x34b8f1(0x211)],'maxProducts':_0x69431f[_0x34b8f1(0x29c)],'unit':_0x69431f[_0x34b8f1(0x1f6)],'secondary_unit':_0x69431f[_0x34b8f1(0x21c)],'expiry_date':_0x69431f[_0x34b8f1(0x240)],'maxPerUnit':_0x69431f[_0x34b8f1(0x262)],'batch_code':_0x69431f[_0x34b8f1(0x2f4)],'alertQTY':_0x69431f[_0x34b8f1(0x20d)],'production_date':_0x69431f[_0x34b8f1(0x2d3)],'product_cat':_0x69431f['product_cat'],'invoice':_0x69431f[_0x34b8f1(0x236)],'actual_qty':Math[_0x34b8f1(0x241)](_0x69431f[_0x34b8f1(0x222)]),'actual_uom':_0x69431f[_0x34b8f1(0x2e4)]}),_0x5e4cdf;});Promise[_0xf53fc4(0x29a)](_0x60c3cc)['then'](async _0x576c6e=>{var _0x46069d=_0xf53fc4;try{for(const _0x579082 of _0x576c6e){await _0x579082['save']();}const _0x15e0d2=await master_shop[_0x46069d(0x22e)](),_0x12004d=await email_settings[_0x46069d(0x299)](),_0x1fb9af=await supervisor_settings[_0x46069d(0x22e)]();var _0xefdd1d=_0x489000[_0x46069d(0x24c)],_0x26da7a='',_0x337823;for(_0x337823 in _0xefdd1d){_0x26da7a+='<tr>'+_0x46069d(0x2b8)+_0xefdd1d[_0x337823][_0x46069d(0x1ed)]+'</td>'+_0x46069d(0x2b8)+_0xefdd1d[_0x337823]['product_code']+'</td>'+_0x46069d(0x2b8)+_0xefdd1d[_0x337823][_0x46069d(0x2d5)]+_0x46069d(0x24f)+_0x46069d(0x2b8)+_0xefdd1d[_0x337823][_0x46069d(0x1f6)]+_0x46069d(0x24f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xefdd1d[_0x337823][_0x46069d(0x21c)]+_0x46069d(0x24f)+_0x46069d(0x2b8)+_0x489000[_0x46069d(0x26a)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xefdd1d[_0x337823][_0x46069d(0x1f4)]+_0x46069d(0x24f)+_0x46069d(0x2b8)+_0xefdd1d[_0x337823][_0x46069d(0x231)]+_0xefdd1d[_0x337823][_0x46069d(0x2d8)]+_0xefdd1d[_0x337823]['bay']+_0xefdd1d[_0x337823][_0x46069d(0x1f0)]+_0xefdd1d[_0x337823][_0x46069d(0x20a)][0x0]+_0xefdd1d[_0x337823][_0x46069d(0x211)]+_0x46069d(0x24f),_0x46069d(0x264);}let _0x2dd8b7=nodemailer[_0x46069d(0x225)]({'host':_0x12004d[_0x46069d(0x2c5)],'port':Number(_0x12004d[_0x46069d(0x21e)]),'secure':![],'auth':{'user':_0x12004d['email'],'pass':_0x12004d[_0x46069d(0x24b)]}}),_0x2dccff={'from':_0x12004d['email'],'to':_0x1fb9af[0x0][_0x46069d(0x2d7)],'subject':_0x46069d(0x2ed),'attachments':[{'filename':_0x46069d(0x295),'path':__dirname+'/../public'+'/upload/'+_0x15e0d2[0x0]['image'],'cid':_0x46069d(0x2c2)}],'html':_0x46069d(0x298)+'<html><head><title></title>'+_0x46069d(0x290)+_0x46069d(0x26e)+_0x46069d(0x26c)+_0x46069d(0x26e)+_0x46069d(0x29e)+_0x46069d(0x2af)+_0x46069d(0x26e)+_0x46069d(0x2d0)+_0x15e0d2[0x0][_0x46069d(0x2e7)]+_0x46069d(0x2b4)+_0x46069d(0x2af)+_0x46069d(0x2af)+_0x46069d(0x296)+_0x46069d(0x26e)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x489000['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x46069d(0x266)+_0x489000[_0x46069d(0x1eb)]+'\x20'+_0x46069d(0x2ce)+'</h5>'+_0x46069d(0x2af)+_0x46069d(0x224)+_0x46069d(0x1e6)+_0x46069d(0x301)+_0x46069d(0x2a9)+_0x46069d(0x245)+_0x46069d(0x2ac)+_0x46069d(0x22a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x46069d(0x2cd)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x46069d(0x1ea)+'</tr>'+_0x46069d(0x1e8)+_0x46069d(0x1fb)+'\x20'+_0x26da7a+'\x20'+_0x46069d(0x27c)+_0x46069d(0x2ff)+_0x46069d(0x26e)+_0x46069d(0x2f9)+'<h5>'+_0x15e0d2[0x0][_0x46069d(0x2e7)]+'</h5>'+_0x46069d(0x2af)+_0x46069d(0x2af)+_0x46069d(0x2a0)};_0x2dd8b7[_0x46069d(0x1ff)](_0x2dccff,function(_0x38db82,_0x35744e){var _0x402034=_0x46069d;_0x38db82?(console[_0x402034(0x2c7)](_0x38db82),console['log'](_0x402034(0x2b5))):console[_0x402034(0x2c7)](_0x402034(0x2a3));}),_0x14cabc[_0x46069d(0x2c4)]('success',_0x46069d(0x23d)),_0x1066cf[_0x46069d(0x26b)]('/all_purchases/view/');}catch(_0x3d9347){console['error'](_0x3d9347),_0x1066cf['status'](0x1f4)[_0x46069d(0x259)]({'error':_0x46069d(0x2d4)});}})[_0xf53fc4(0x261)](_0x42efa3=>{var _0xb56b1d=_0xf53fc4;console[_0xb56b1d(0x2ef)](_0x42efa3),_0x1066cf[_0xb56b1d(0x284)](0x1f4)[_0xb56b1d(0x259)]({'error':_0xb56b1d(0x228)});});}catch(_0x4b55b1){console[_0xf53fc4(0x2c7)](_0x4b55b1);}}),router[a0_0x3c5d12(0x219)](a0_0x3c5d12(0x204),auth,async(_0x288ce5,_0x5f3264)=>{var _0x31e064=a0_0x3c5d12;try{const {username:_0x2b3eb,email:_0x2891e2,role:_0x489c0c}=_0x288ce5[_0x31e064(0x28f)],_0x73dcd4=_0x288ce5[_0x31e064(0x28f)],_0x2c850f=await profile['findOne']({'email':_0x73dcd4[_0x31e064(0x1e7)]}),_0x209d81=await master_shop['find'](),_0x18bb7e=_0x288ce5[_0x31e064(0x234)]['id'],_0x4f0e8a=await purchases[_0x31e064(0x237)](_0x18bb7e),_0x25e799=await warehouse[_0x31e064(0x303)]([{'$match':{'name':_0x4f0e8a[_0x31e064(0x26a)],'room':_0x4f0e8a['room']}},{'$unwind':_0x31e064(0x244)},{'$group':{'_id':_0x31e064(0x281),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x31e064(0x2fc)},'bin':{'$first':_0x31e064(0x2f3)},'type':{'$first':_0x31e064(0x1f3)},'floorlevel':{'$first':_0x31e064(0x27b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x31e064(0x285)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x31e064(0x2db)},'expiry_date':{'$first':_0x31e064(0x202)}}}]),_0x5e7001=await customer[_0x31e064(0x22e)]({});let _0x55951e;if(_0x73dcd4[_0x31e064(0x253)]==_0x31e064(0x26d)){const _0x373b2c=await staff[_0x31e064(0x299)]({'email':_0x73dcd4[_0x31e064(0x1e7)]});_0x55951e=await warehouse[_0x31e064(0x303)]([{'$match':{'status':_0x31e064(0x250),'name':_0x373b2c[_0x31e064(0x265)]}},{'$group':{'_id':_0x31e064(0x235),'name':{'$first':_0x31e064(0x235)}}}]);}else _0x55951e=await warehouse[_0x31e064(0x303)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':'$name','name':{'$first':_0x31e064(0x235)}}}]);const _0x3a4bb8=await product['find']({}),_0x12d257=await suppliers[_0x31e064(0x22e)]({}),_0x2a880f=BayBinSelected(_0x4f0e8a[_0x31e064(0x26a)],_0x4f0e8a[_0x31e064(0x2de)]);if(_0x209d81[0x0]['language']==_0x31e064(0x279)){var _0x5c61cc=users[_0x31e064(0x271)];console['log'](_0x5c61cc);}else{if(_0x209d81[0x0][_0x31e064(0x1ec)]==_0x31e064(0x20e))var _0x5c61cc=users['Hindi'];else{if(_0x209d81[0x0][_0x31e064(0x1ec)]=='German')var _0x5c61cc=users[_0x31e064(0x27d)];else{if(_0x209d81[0x0][_0x31e064(0x1ec)]==_0x31e064(0x246))var _0x5c61cc=users[_0x31e064(0x246)];else{if(_0x209d81[0x0][_0x31e064(0x1ec)]=='French')var _0x5c61cc=users[_0x31e064(0x29d)];else{if(_0x209d81[0x0][_0x31e064(0x1ec)]=='Portuguese\x20(BR)')var _0x5c61cc=users['Portuguese'];else{if(_0x209d81[0x0][_0x31e064(0x1ec)]==_0x31e064(0x206))var _0x5c61cc=users[_0x31e064(0x206)];else{if(_0x209d81[0x0][_0x31e064(0x1ec)]==_0x31e064(0x24d))var _0x5c61cc=users[_0x31e064(0x1f8)];}}}}}}}_0x5f3264['render'](_0x31e064(0x2f6),{'success':_0x288ce5[_0x31e064(0x2c4)]('success'),'errors':_0x288ce5['flash'](_0x31e064(0x1f9)),'role':_0x73dcd4,'profile':_0x2c850f,'customer':_0x5e7001,'warehouse':_0x55951e,'product':_0x25e799,'user':_0x4f0e8a,'master_shop':_0x209d81,'unit':_0x3a4bb8,'language':_0x5c61cc,'suppliers':_0x12d257,'dataSelected':_0x2a880f});}catch(_0x18a032){console['log'](_0x18a032);}}),router[a0_0x3c5d12(0x2f2)]('/preview/:id',auth,async(_0x3a8033,_0x3e7bdf)=>{var _0x2cec95=a0_0x3c5d12;try{const _0x41c538=_0x3a8033['params']['id'],{invoice:_0x494a80,warehouse_name:_0x31f2b1,Room_name:_0x4f4542}=_0x3a8033[_0x2cec95(0x2a8)],_0x39f4c4=await warehouse[_0x2cec95(0x299)]({'name':_0x31f2b1,'room':_0x4f4542}),_0x1ce6ae=await purchases['findOne']({'invoice':_0x494a80});_0x1ce6ae[_0x2cec95(0x24c)]['forEach'](_0x5d55d2=>{var _0x5a0860=_0x2cec95,_0x1ac519=0x0;const _0x3bfa21=_0x39f4c4['product_details'][_0x5a0860(0x247)](_0x34b10c=>{var _0x95fbb=_0x5a0860;_0x34b10c['product_name']==_0x5d55d2['product_name']&&_0x34b10c[_0x95fbb(0x211)]==_0x5d55d2[_0x95fbb(0x211)]&&_0x34b10c[_0x95fbb(0x20a)]==_0x5d55d2[_0x95fbb(0x20a)]&&_0x34b10c[_0x95fbb(0x1f0)]==_0x5d55d2[_0x95fbb(0x1f0)]&&_0x34b10c['bay']==_0x5d55d2['bay']&&_0x34b10c[_0x95fbb(0x2d8)]==_0x5d55d2[_0x95fbb(0x2d8)]&&_0x34b10c['storage']==_0x5d55d2[_0x95fbb(0x231)]&&_0x34b10c[_0x95fbb(0x240)]==_0x5d55d2[_0x95fbb(0x240)]&&_0x34b10c['batch_code']==_0x5d55d2[_0x95fbb(0x2f4)]&&_0x34b10c[_0x95fbb(0x2d3)]==_0x5d55d2[_0x95fbb(0x2d3)]&&_0x34b10c[_0x95fbb(0x300)]==_0x5d55d2[_0x95fbb(0x300)]&&_0x34b10c[_0x95fbb(0x256)]==_0x5d55d2[_0x95fbb(0x256)]&&(_0x34b10c['product_stock']=parseInt(_0x34b10c[_0x95fbb(0x21d)])+parseInt(_0x5d55d2[_0x95fbb(0x2d5)]),_0x1ac519++);});_0x1ac519=='0'&&(_0x39f4c4[_0x5a0860(0x248)]=_0x39f4c4[_0x5a0860(0x248)][_0x5a0860(0x304)]({'product_name':_0x5d55d2[_0x5a0860(0x1ed)],'product_stock':_0x5d55d2[_0x5a0860(0x2d5)],'primary_code':_0x5d55d2[_0x5a0860(0x2e8)],'secondary_code':_0x5d55d2['secondary_code'],'product_code':_0x5d55d2[_0x5a0860(0x25e)],'storage':_0x5d55d2[_0x5a0860(0x231)],'rack':_0x5d55d2[_0x5a0860(0x2d8)],'bay':_0x5d55d2['bay'],'bin':_0x5d55d2[_0x5a0860(0x1f0)],'type':_0x5d55d2[_0x5a0860(0x20a)],'floorlevel':_0x5d55d2[_0x5a0860(0x211)],'maxProducts':_0x5d55d2[_0x5a0860(0x29c)],'unit':_0x5d55d2[_0x5a0860(0x1f6)],'secondary_unit':_0x5d55d2[_0x5a0860(0x21c)],'expiry_date':_0x5d55d2['expiry_date'],'maxPerUnit':_0x5d55d2[_0x5a0860(0x262)],'batch_code':_0x5d55d2['batch_code'],'alertQTY':_0x5d55d2[_0x5a0860(0x20d)],'production_date':_0x5d55d2[_0x5a0860(0x2d3)],'delivery_date':_0x5d55d2['delivery_date'],'delivery_code':_0x5d55d2['delivery_code']}));}),await _0x39f4c4[_0x2cec95(0x2ec)](),_0x1ce6ae['finalize']=_0x2cec95(0x2c0);const _0x1d2562=await _0x1ce6ae[_0x2cec95(0x2ec)]();_0x3a8033[_0x2cec95(0x2c4)](_0x2cec95(0x23a),_0x2cec95(0x302)),_0x3e7bdf[_0x2cec95(0x26b)](_0x2cec95(0x216));}catch(_0x1c3aef){console[_0x2cec95(0x2c7)](_0x1c3aef);}}),router[a0_0x3c5d12(0x219)](a0_0x3c5d12(0x2e1),auth,async(_0x3b829c,_0x3ef3fa)=>{var _0x4612bf=a0_0x3c5d12;try{const {username:_0x13c3e9,email:_0x2dd9d9,role:_0x176955}=_0x3b829c[_0x4612bf(0x28f)],_0x5f0714=_0x3b829c[_0x4612bf(0x28f)],_0x4f199d=await profile[_0x4612bf(0x299)]({'email':_0x5f0714[_0x4612bf(0x1e7)]}),_0x1a260f=await master_shop[_0x4612bf(0x22e)](),_0x4d1fd4=_0x3b829c['params']['id'],_0x5a90f7=await purchases[_0x4612bf(0x237)](_0x4d1fd4),_0x55dc85=await suppliers['find']({});let _0x3fabab;if(_0x5f0714['role']==_0x4612bf(0x26d)){const _0x1a2b00=await staff[_0x4612bf(0x299)]({'email':_0x5f0714[_0x4612bf(0x1e7)]});_0x3fabab=await warehouse[_0x4612bf(0x22e)]({'status':_0x4612bf(0x250),'name':_0x1a2b00[_0x4612bf(0x265)],'warehouse_category':_0x4612bf(0x2e0)});}else _0x3fabab=await warehouse[_0x4612bf(0x303)]([{'$match':{'status':'Enabled','warehouse_category':_0x4612bf(0x2e0)}},{'$group':{'_id':_0x4612bf(0x235),'name':{'$first':_0x4612bf(0x235)}}}]);const _0x5cf5a6=await product['find']({}),_0x189282=BayBinSelected(_0x5a90f7[_0x4612bf(0x26a)],_0x5a90f7[_0x4612bf(0x2de)]);let _0x34716c=new Date(_0x5a90f7[_0x4612bf(0x240)]),_0x2b3698=('0'+_0x34716c[_0x4612bf(0x2b6)]())['slice'](-0x2),_0xab3824=('0'+(_0x34716c[_0x4612bf(0x2b1)]()+0x1))['slice'](-0x2),_0x1b09d9=_0x34716c['getFullYear'](),_0x33922=_0x1b09d9+'-'+_0xab3824+'-'+_0x2b3698;if(_0x1a260f[0x0][_0x4612bf(0x1ec)]==_0x4612bf(0x279)){var _0x23b301=users[_0x4612bf(0x271)];console[_0x4612bf(0x2c7)](_0x23b301);}else{if(_0x1a260f[0x0][_0x4612bf(0x1ec)]==_0x4612bf(0x20e))var _0x23b301=users[_0x4612bf(0x20e)];else{if(_0x1a260f[0x0][_0x4612bf(0x1ec)]==_0x4612bf(0x27d))var _0x23b301=users[_0x4612bf(0x27d)];else{if(_0x1a260f[0x0]['language']==_0x4612bf(0x246))var _0x23b301=users[_0x4612bf(0x246)];else{if(_0x1a260f[0x0][_0x4612bf(0x1ec)]=='French')var _0x23b301=users['French'];else{if(_0x1a260f[0x0][_0x4612bf(0x1ec)]=='Portuguese\x20(BR)')var _0x23b301=users['Portuguese'];else{if(_0x1a260f[0x0][_0x4612bf(0x1ec)]==_0x4612bf(0x206))var _0x23b301=users['Chinese'];else{if(_0x1a260f[0x0][_0x4612bf(0x1ec)]==_0x4612bf(0x24d))var _0x23b301=users[_0x4612bf(0x1f8)];}}}}}}}_0x3ef3fa[_0x4612bf(0x22f)]('edit_purchases',{'success':_0x3b829c['flash'](_0x4612bf(0x23a)),'errors':_0x3b829c['flash'](_0x4612bf(0x1f9)),'role':_0x5f0714,'profile':_0x4f199d,'purchases':_0x5a90f7,'suppliers':_0x55dc85,'warehouse':_0x3fabab,'product':_0x5cf5a6,'master_shop':_0x1a260f,'language':_0x23b301,'ed_fullDate':_0x33922,'dataSelected':_0x189282});}catch(_0x446962){console[_0x4612bf(0x2c7)](_0x446962);}}),router[a0_0x3c5d12(0x2f2)]('/view/:id',auth,async(_0x3af5fb,_0x18e300)=>{var _0x6cfad=a0_0x3c5d12;try{const _0x4f27b8=_0x3af5fb['params']['id'],_0x950707=await purchases['findOne']({'_id':_0x3af5fb['params']['id']}),_0x204aef=await warehouse['findOne']({'name':_0x950707[_0x6cfad(0x26a)],'room':_0x950707[_0x6cfad(0x2de)]});_0x950707[_0x6cfad(0x24c)][_0x6cfad(0x210)](_0x3d3962=>{var _0x32134a=_0x6cfad;const _0x5b8b9f=_0x204aef[_0x32134a(0x248)]['map'](_0x5d6ff8=>{var _0xa8f7fb=_0x32134a;_0x5d6ff8[_0xa8f7fb(0x1ed)]==_0x3d3962[_0xa8f7fb(0x1ed)]&&_0x5d6ff8[_0xa8f7fb(0x211)]==_0x3d3962['floorlevel']&&_0x5d6ff8[_0xa8f7fb(0x20a)]==_0x3d3962[_0xa8f7fb(0x20a)]&&_0x5d6ff8[_0xa8f7fb(0x1f0)]==_0x3d3962[_0xa8f7fb(0x1f0)]&&_0x5d6ff8['bay']==_0x3d3962[_0xa8f7fb(0x28b)]&&_0x5d6ff8['rack']==_0x3d3962[_0xa8f7fb(0x2d8)]&&_0x5d6ff8[_0xa8f7fb(0x231)]==_0x3d3962[_0xa8f7fb(0x231)]&&(_0x5d6ff8[_0xa8f7fb(0x21d)]=parseInt(_0x5d6ff8[_0xa8f7fb(0x21d)])-parseInt(_0x3d3962[_0xa8f7fb(0x2d5)]));});}),await _0x204aef[_0x6cfad(0x2ec)]();const {invoice:_0x5cc6ae,suppliers:_0x3d4a34,date:_0x158b29,warehouse_name:_0x17efaa,prod_name:_0x506192,prod_code:_0x1e1a07,prod_qty:_0x52e0c4,prod_unit:_0x2855a4,prod_secondunit:_0x679c91,prod_level:_0x1b48ca,prod_isle:_0x2af365,prod_pallet:_0x17e807,note:_0x4bc5e2,expiry_date:_0x534b98,batch_code:_0x2a8d29,paid_amount:_0x4fca18,due_amount:_0x2b912e,Room_name:_0x221c22,primary_code:_0x9bbdb1,secondary_code:_0x2df966,PO_number:_0xb51788,JO_number:_0x1239f4}=_0x3af5fb[_0x6cfad(0x2a8)];if(typeof _0x506192==_0x6cfad(0x2cc))var _0xe9df57=[_0x3af5fb['body'][_0x6cfad(0x2fa)]],_0x3e1dfe=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x288)]],_0x6955ab=[_0x3af5fb[_0x6cfad(0x2a8)]['prod_qty']],_0x667cf7=[_0x3af5fb['body'][_0x6cfad(0x2dd)]],_0xc79413=[_0x3af5fb[_0x6cfad(0x2a8)]['prod_secondunit']],_0x54c4a8=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x25c)]],_0x3e2012=[_0x3af5fb[_0x6cfad(0x2a8)]['prod_isle']],_0x153e77=[_0x3af5fb[_0x6cfad(0x2a8)]['prod_pallet']],_0x5f5dbe=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2e8)]],_0xc2523f=[_0x3af5fb['body'][_0x6cfad(0x2f1)]],_0x59e3a4=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2c3)]],_0x2893ae=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2f4)]],_0x4b45a7=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x240)]],_0xc7c47c=[_0x3af5fb[_0x6cfad(0x2a8)]['storage']],_0x22bff4=[_0x3af5fb['body'][_0x6cfad(0x2ee)]],_0x252ac6=[_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x20a)]];else var _0xe9df57=[..._0x3af5fb[_0x6cfad(0x2a8)]['prod_name']],_0x3e1dfe=[..._0x3af5fb['body'][_0x6cfad(0x288)]],_0x6955ab=[..._0x3af5fb[_0x6cfad(0x2a8)]['prod_qty']],_0x667cf7=[..._0x3af5fb['body'][_0x6cfad(0x2dd)]],_0xc79413=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x274)]],_0x54c4a8=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x25c)]],_0x3e2012=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2b7)]],_0x153e77=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x291)]],_0x5f5dbe=[..._0x3af5fb['body'][_0x6cfad(0x2e8)]],_0xc2523f=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2f1)]],_0x59e3a4=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2c3)]],_0x2893ae=[..._0x3af5fb[_0x6cfad(0x2a8)]['batch_code']],_0x4b45a7=[..._0x3af5fb['body'][_0x6cfad(0x240)]],_0xc7c47c=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x231)]],_0x22bff4=[..._0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x2ee)]],_0x252ac6=[..._0x3af5fb[_0x6cfad(0x2a8)]['type']];const _0x5db907=_0xe9df57[_0x6cfad(0x247)](_0x49d1c8=>{return _0x49d1c8={'product_name':_0x49d1c8};});_0x3e1dfe[_0x6cfad(0x210)]((_0x3079a8,_0x8233a9)=>{_0x5db907[_0x8233a9]['product_code']=_0x3079a8;}),_0x6955ab['forEach']((_0x16ccda,_0x2a9a80)=>{_0x5db907[_0x2a9a80]['quantity']=_0x16ccda;}),_0x667cf7[_0x6cfad(0x210)]((_0x358448,_0x556756)=>{var _0x53bbe3=_0x6cfad;_0x5db907[_0x556756][_0x53bbe3(0x1f6)]=_0x358448;}),_0xc79413[_0x6cfad(0x210)]((_0x2433bc,_0x1820e1)=>{var _0x29f85b=_0x6cfad;_0x5db907[_0x1820e1][_0x29f85b(0x21c)]=_0x2433bc;}),_0x54c4a8[_0x6cfad(0x210)]((_0x5e2fc6,_0x31975b)=>{var _0x5b9d5d=_0x6cfad;_0x5db907[_0x31975b][_0x5b9d5d(0x28b)]=_0x5e2fc6;}),_0x3e2012[_0x6cfad(0x210)]((_0x3c8cc8,_0x5c9c19)=>{_0x5db907[_0x5c9c19]['bin']=_0x3c8cc8;}),_0x153e77[_0x6cfad(0x210)]((_0x12a8c5,_0x4ac8b5)=>{var _0x5f0587=_0x6cfad;_0x5db907[_0x4ac8b5][_0x5f0587(0x211)]=_0x12a8c5;}),_0x5f5dbe[_0x6cfad(0x210)]((_0x1dd95c,_0x4499b0)=>{var _0x595486=_0x6cfad;_0x5db907[_0x4499b0][_0x595486(0x2e8)]=_0x1dd95c;}),_0xc2523f['forEach']((_0x3fffa8,_0x74bc19)=>{var _0x52e39e=_0x6cfad;_0x5db907[_0x74bc19][_0x52e39e(0x2f1)]=_0x3fffa8;}),_0x59e3a4[_0x6cfad(0x210)]((_0x3e53f1,_0x1f2160)=>{var _0x1b9fe9=_0x6cfad;_0x5db907[_0x1f2160][_0x1b9fe9(0x29c)]=_0x3e53f1;}),_0x2893ae[_0x6cfad(0x210)]((_0x457d27,_0x505d6c)=>{_0x5db907[_0x505d6c]['batch_code']=_0x457d27;}),_0x4b45a7[_0x6cfad(0x210)]((_0x2ac41f,_0xb10338)=>{var _0x402d55=_0x6cfad;_0x5db907[_0xb10338][_0x402d55(0x240)]=_0x2ac41f;}),_0x252ac6[_0x6cfad(0x210)]((_0x1f5502,_0xee341f)=>{var _0x53d3a5=_0x6cfad;_0x5db907[_0xee341f][_0x53d3a5(0x20a)]=_0x1f5502;}),_0xc7c47c['forEach']((_0x56211a,_0x1af110)=>{var _0x12057f=_0x6cfad;_0x5db907[_0x1af110][_0x12057f(0x231)]=_0x56211a;}),_0x22bff4[_0x6cfad(0x210)]((_0x2d724a,_0x1291ff)=>{var _0x234f8a=_0x6cfad;_0x5db907[_0x1291ff][_0x234f8a(0x2d8)]=_0x2d724a;});const _0x188676=_0x5db907[_0x6cfad(0x2b2)](_0x3d7494=>_0x3d7494[_0x6cfad(0x2d5)]!=='0'&&_0x3d7494[_0x6cfad(0x2d5)]!=='');_0x950707['invoice']=_0x5cc6ae,_0x950707['suppliers']=_0x3d4a34,_0x950707['date']=_0x158b29,_0x950707['warehouse_name']=_0x17efaa,_0x950707[_0x6cfad(0x24c)]=_0x188676,_0x950707[_0x6cfad(0x277)]=_0x4bc5e2,_0x950707[_0x6cfad(0x223)]=_0x4fca18,_0x950707[_0x6cfad(0x278)]=_0x2b912e,_0x950707[_0x6cfad(0x2de)]=_0x221c22,_0x950707['POnumber']=_0xb51788,_0x950707[_0x6cfad(0x2bb)]=_0x1239f4;const _0x6a8fc1=await _0x950707[_0x6cfad(0x2ec)](),_0xe97802=await warehouse[_0x6cfad(0x299)]({'name':_0x3af5fb['body'][_0x6cfad(0x26a)],'room':_0x3af5fb['body'][_0x6cfad(0x238)]});_0x950707[_0x6cfad(0x24c)][_0x6cfad(0x210)](_0x3c2ce1=>{var _0x219f5e=_0x6cfad,_0x27c722=0x0;const _0x163cb0=_0xe97802['product_details'][_0x219f5e(0x247)](_0x4ca001=>{var _0x540fbe=_0x219f5e;_0x4ca001['product_name']==_0x3c2ce1[_0x540fbe(0x1ed)]&&_0x4ca001[_0x540fbe(0x211)]==_0x3c2ce1['floorlevel']&&_0x4ca001[_0x540fbe(0x20a)]==_0x3c2ce1['type']&&_0x4ca001[_0x540fbe(0x1f0)]==_0x3c2ce1[_0x540fbe(0x1f0)]&&_0x4ca001[_0x540fbe(0x28b)]==_0x3c2ce1[_0x540fbe(0x28b)]&&_0x4ca001[_0x540fbe(0x2d8)]==_0x3c2ce1[_0x540fbe(0x2d8)]&&_0x4ca001[_0x540fbe(0x231)]==_0x3c2ce1[_0x540fbe(0x231)]&&(_0x4ca001[_0x540fbe(0x21d)]=parseInt(_0x4ca001['product_stock'])+parseInt(_0x3c2ce1[_0x540fbe(0x2d5)]),_0x27c722++);});_0x27c722=='0'&&(_0xe97802[_0x219f5e(0x248)]=_0xe97802[_0x219f5e(0x248)][_0x219f5e(0x304)]({'product_name':_0x3c2ce1[_0x219f5e(0x1ed)],'product_stock':_0x3c2ce1[_0x219f5e(0x2d5)],'primary_code':_0x3c2ce1[_0x219f5e(0x2e8)],'secondary_code':_0x3c2ce1['secondary_code'],'product_code':_0x3c2ce1[_0x219f5e(0x25e)],'storage':_0x3c2ce1[_0x219f5e(0x231)],'rack':_0x3c2ce1[_0x219f5e(0x2d8)],'bay':_0x3c2ce1[_0x219f5e(0x28b)],'bin':_0x3c2ce1[_0x219f5e(0x1f0)],'type':_0x3c2ce1[_0x219f5e(0x20a)],'floorlevel':_0x3c2ce1[_0x219f5e(0x211)],'maxProducts':_0x3c2ce1['maxStocks'],'unit':_0x3c2ce1[_0x219f5e(0x1f6)],'secondary_unit':_0x3c2ce1[_0x219f5e(0x21c)],'expiry_date':_0x3c2ce1['expiry_date']}));}),await _0xe97802[_0x6cfad(0x2ec)]();const _0x47a687=await s_payment_data[_0x6cfad(0x299)]({'invoice':_0x3af5fb[_0x6cfad(0x2a8)][_0x6cfad(0x236)]});if(_0x47a687===null){}else console[_0x6cfad(0x2c7)]('suppliers',_0x47a687,_0x3af5fb['body']['invoice']),_0x47a687[_0x6cfad(0x201)]=_0x3af5fb['body'][_0x6cfad(0x201)],await _0x47a687['save']();_0x3af5fb['flash'](_0x6cfad(0x23a),_0x6cfad(0x251)),_0x18e300['redirect'](_0x6cfad(0x216));}catch(_0x1f02fe){console[_0x6cfad(0x2c7)](_0x1f02fe);}}),router['post'](a0_0x3c5d12(0x2a2),auth,async(_0x5706ac,_0x9e57cd)=>{var _0x4c78f6=a0_0x3c5d12;try{const _0x208e89=_0x5706ac[_0x4c78f6(0x234)]['id'],{invoice:_0x2d9d62,suppliers:_0x54fc37,payable:_0x251090,due_amount:_0x346a52}=_0x5706ac[_0x4c78f6(0x2a8)],_0x533370=await purchases['findById'](_0x208e89);var _0x3ef910=_0x251090-_0x346a52;_0x533370['paid_amount']=parseFloat(_0x533370[_0x4c78f6(0x223)])+parseFloat(_0x346a52),_0x533370['due_amount']=_0x3ef910;const _0x537571=await _0x533370[_0x4c78f6(0x2ec)]();console[_0x4c78f6(0x2c7)](_0x537571);const _0x5e5623=await s_payment_data[_0x4c78f6(0x299)]({'invoice':_0x2d9d62});_0x5e5623[_0x4c78f6(0x2f8)]=_0x3ef910,await _0x5e5623['save']();let _0x32d727=new Date(),_0x4e6e83=('0'+_0x32d727[_0x4c78f6(0x2b6)]())[_0x4c78f6(0x226)](-0x2),_0xc11b78=('0'+(_0x32d727[_0x4c78f6(0x2b1)]()+0x1))[_0x4c78f6(0x226)](-0x2),_0x3b3bca=_0x32d727[_0x4c78f6(0x207)](),_0x51df6c=_0x3b3bca+'-'+_0xc11b78+'-'+_0x4e6e83;const _0x4040ef=new suppliers_payment({'invoice':_0x2d9d62,'date':_0x3b3bca+'-'+_0xc11b78+'-'+_0x4e6e83,'suppliers':_0x54fc37,'reason':'Paid\x20For\x20Purchase','amount':_0x346a52}),_0x25c14b=await _0x4040ef['save']();_0x5706ac[_0x4c78f6(0x2c4)]('success','payment\x20successfull'),_0x9e57cd['redirect'](_0x4c78f6(0x216));}catch(_0x1c89f8){console[_0x4c78f6(0x2c7)](_0x1c89f8);}}),router['get'](a0_0x3c5d12(0x282),auth,async(_0x32582f,_0x7b60a)=>{var _0x69930d=a0_0x3c5d12;try{const {username:_0x28166e,email:_0x311559,role:_0x1377e9}=_0x32582f[_0x69930d(0x28f)],_0x1f1a02=_0x32582f[_0x69930d(0x28f)],_0x46730e=await profile[_0x69930d(0x299)]({'email':_0x1f1a02[_0x69930d(0x1e7)]}),_0x2d1c8d=await master_shop[_0x69930d(0x22e)]();console['log'](_0x69930d(0x233),_0x2d1c8d);const _0x2e41ce=_0x32582f['params']['id'],_0x9afb98=await purchases[_0x69930d(0x237)](_0x2e41ce);console['log'](_0x9afb98);const _0x27bccf=await suppliers['findOne']({'name':_0x9afb98[_0x69930d(0x201)]});console['log'](_0x27bccf);if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]==_0x69930d(0x279)){var _0x14cc8b=users[_0x69930d(0x271)];console[_0x69930d(0x2c7)](_0x14cc8b);}else{if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]==_0x69930d(0x20e))var _0x14cc8b=users[_0x69930d(0x20e)];else{if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]==_0x69930d(0x27d))var _0x14cc8b=users[_0x69930d(0x27d)];else{if(_0x2d1c8d[0x0]['language']=='Spanish')var _0x14cc8b=users[_0x69930d(0x246)];else{if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]=='French')var _0x14cc8b=users[_0x69930d(0x29d)];else{if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]==_0x69930d(0x2ad))var _0x14cc8b=users[_0x69930d(0x258)];else{if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]==_0x69930d(0x206))var _0x14cc8b=users[_0x69930d(0x206)];else{if(_0x2d1c8d[0x0][_0x69930d(0x1ec)]==_0x69930d(0x24d))var _0x14cc8b=users[_0x69930d(0x1f8)];}}}}}}}_0x7b60a[_0x69930d(0x22f)](_0x69930d(0x2b9),{'success':_0x32582f[_0x69930d(0x2c4)](_0x69930d(0x23a)),'errors':_0x32582f[_0x69930d(0x2c4)](_0x69930d(0x1f9)),'role':_0x1f1a02,'profile':_0x46730e,'master_shop':_0x2d1c8d,'supplier':_0x27bccf,'purchase':_0x9afb98,'language':_0x14cc8b});}catch(_0x42c4fc){console[_0x69930d(0x2c7)](_0x42c4fc);}}),router[a0_0x3c5d12(0x219)](a0_0x3c5d12(0x29f),auth,async(_0x5f0356,_0x268251)=>{var _0x4f7cff=a0_0x3c5d12;try{const {username:_0x29fe39,email:_0x5c0189,role:_0x448cea}=_0x5f0356[_0x4f7cff(0x28f)],_0x5c0504=_0x5f0356[_0x4f7cff(0x28f)],_0x5b8335=await profile['findOne']({'email':_0x5c0504['email']}),_0x3d8eb6=await master_shop[_0x4f7cff(0x22e)]();console[_0x4f7cff(0x2c7)](_0x4f7cff(0x233),_0x3d8eb6);const _0x342d95=_0x5f0356[_0x4f7cff(0x234)]['id'];console['log'](_0x342d95);const _0x2d5dfc=await purchases[_0x4f7cff(0x237)](_0x342d95);console[_0x4f7cff(0x2c7)](_0x4f7cff(0x293),_0x2d5dfc);const _0x319016=await product[_0x4f7cff(0x22e)]({}),_0x457b68=await warehouse['aggregate']([{'$match':{'name':_0x2d5dfc['warehouse_name'],'room':_0x2d5dfc[_0x4f7cff(0x2de)],'warehouse_category':_0x4f7cff(0x2e0)}},{'$unwind':_0x4f7cff(0x244)},{'$group':{'_id':_0x4f7cff(0x281),'name':{'$first':_0x4f7cff(0x21a)},'product_stock':{'$first':_0x4f7cff(0x2e5)},'bay':{'$first':_0x4f7cff(0x2fc)},'bin':{'$first':_0x4f7cff(0x2f3)},'type':{'$first':_0x4f7cff(0x1f3)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4f7cff(0x220)},'secondary_code':{'$first':_0x4f7cff(0x283)},'product_code':{'$first':_0x4f7cff(0x285)},'storage':{'$first':_0x4f7cff(0x22b)},'rack':{'$first':_0x4f7cff(0x2db)}}}]);warehouse_data=await warehouse[_0x4f7cff(0x303)]([{'$match':{'status':'Enabled','name':_0x4f7cff(0x221),'warehouse_category':'Raw\x20Materials'}},{'$group':{'_id':_0x4f7cff(0x235),'name':{'$first':_0x4f7cff(0x235)}}},{'$sort':{'name':0x1}}]),console['log']('stock_data',_0x457b68);if(_0x3d8eb6[0x0]['language']==_0x4f7cff(0x279)){var _0x1af7c4=users['English'];console['log'](_0x1af7c4);}else{if(_0x3d8eb6[0x0][_0x4f7cff(0x1ec)]==_0x4f7cff(0x20e))var _0x1af7c4=users[_0x4f7cff(0x20e)];else{if(_0x3d8eb6[0x0][_0x4f7cff(0x1ec)]==_0x4f7cff(0x27d))var _0x1af7c4=users[_0x4f7cff(0x27d)];else{if(_0x3d8eb6[0x0][_0x4f7cff(0x1ec)]=='Spanish')var _0x1af7c4=users[_0x4f7cff(0x246)];else{if(_0x3d8eb6[0x0]['language']==_0x4f7cff(0x29d))var _0x1af7c4=users[_0x4f7cff(0x29d)];else{if(_0x3d8eb6[0x0][_0x4f7cff(0x1ec)]==_0x4f7cff(0x2ad))var _0x1af7c4=users[_0x4f7cff(0x258)];else{if(_0x3d8eb6[0x0][_0x4f7cff(0x1ec)]==_0x4f7cff(0x206))var _0x1af7c4=users[_0x4f7cff(0x206)];else{if(_0x3d8eb6[0x0][_0x4f7cff(0x1ec)]=='Arabic\x20(ae)')var _0x1af7c4=users[_0x4f7cff(0x1f8)];}}}}}}}_0x268251[_0x4f7cff(0x22f)]('return_purchase',{'success':_0x5f0356[_0x4f7cff(0x2c4)](_0x4f7cff(0x23a)),'errors':_0x5f0356[_0x4f7cff(0x2c4)]('errors'),'role':_0x5c0504,'profile':_0x5b8335,'user':_0x2d5dfc,'stock':_0x457b68,'master_shop':_0x3d8eb6,'product':_0x319016,'language':_0x1af7c4,'warehouse':warehouse_data});}catch(_0x181567){console[_0x4f7cff(0x2c7)](_0x181567);}}),router[a0_0x3c5d12(0x2f2)](a0_0x3c5d12(0x29f),auth,async(_0x44ddfe,_0x572897)=>{var _0x80a455=a0_0x3c5d12;try{const {invoice:_0x675936,date:_0x4ea0e4,warehouse_name:_0x542925,Room_name:_0x28a140,product_name:_0x36a6b1,purchase_quantity:_0x4cf65e,stocks:_0x2c86a6,return_qty:_0x3126a5,note:_0x21de92,level:_0x4497f9,isle:_0x3fafa1,pallet:_0x43687c,to_warehouse_name:_0x395df3,to_Room_name:_0x49405d}=_0x44ddfe['body'],_0x263e31=await purchases[_0x80a455(0x299)]({'_id':_0x44ddfe[_0x80a455(0x234)]['id']}),_0x3dfb9d=await warehouse['findOne']({'name':_0x542925,'room':_0x28a140});if(typeof _0x36a6b1==_0x80a455(0x2cc))var _0x18bc09=[_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x1ed)]],_0x1c74a7=[_0x44ddfe['body'][_0x80a455(0x25d)]],_0x4d788a=[_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x23c)]],_0x5e856b=[_0x44ddfe['body'][_0x80a455(0x268)]],_0x148143=[_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x286)]],_0x256bbc=[_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x1f7)]],_0x53c8a4=[_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x2aa)]],_0x21aa50=[_0x44ddfe['body']['types']],_0x345650=[_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x2ca)]],_0x6d9f7=[_0x44ddfe[_0x80a455(0x2a8)]['primary_code_hide']],_0x334999=[_0x44ddfe['body'][_0x80a455(0x1e9)]];else var _0x18bc09=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x1ed)]],_0x1c74a7=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x25d)]],_0x4d788a=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x23c)]],_0x5e856b=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x268)]],_0x148143=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x286)]],_0x256bbc=[..._0x44ddfe['body'][_0x80a455(0x1f7)]],_0x53c8a4=[..._0x44ddfe[_0x80a455(0x2a8)]['pallet']],_0x21aa50=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x2cb)]],_0x345650=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x2ca)]],_0x6d9f7=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x305)]],_0x334999=[..._0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x1e9)]];const _0x1b4d6b=_0x18bc09[_0x80a455(0x247)](_0x2e96d6=>{return _0x2e96d6={'product_name':_0x2e96d6};});_0x1c74a7['forEach']((_0x5af167,_0x636e5e)=>{var _0x1d563d=_0x80a455;_0x1b4d6b[_0x636e5e][_0x1d563d(0x25d)]=_0x5af167;}),_0x4d788a['forEach']((_0x4833a3,_0x5ec84d)=>{var _0xdfdeb9=_0x80a455;_0x1b4d6b[_0x5ec84d][_0xdfdeb9(0x273)]=_0x4833a3;}),_0x5e856b['forEach']((_0x5b81b5,_0x45834b)=>{var _0x54c22b=_0x80a455;_0x1b4d6b[_0x45834b][_0x54c22b(0x268)]=_0x5b81b5;}),_0x148143[_0x80a455(0x210)]((_0x50ddbe,_0x307338)=>{var _0x1c17b4=_0x80a455;_0x1b4d6b[_0x307338][_0x1c17b4(0x28b)]=_0x50ddbe;}),_0x256bbc['forEach']((_0x4cb2fc,_0x2c35bb)=>{var _0x138e12=_0x80a455;_0x1b4d6b[_0x2c35bb][_0x138e12(0x1f0)]=_0x4cb2fc;}),_0x53c8a4['forEach']((_0x1a87f1,_0x281fd5)=>{var _0x51efc9=_0x80a455;_0x1b4d6b[_0x281fd5][_0x51efc9(0x211)]=_0x1a87f1;}),_0x21aa50[_0x80a455(0x210)]((_0x11d595,_0x3caf24)=>{var _0xc0f754=_0x80a455;_0x1b4d6b[_0x3caf24][_0xc0f754(0x20a)]=_0x11d595;}),_0x345650[_0x80a455(0x210)]((_0x558289,_0x55b86c)=>{var _0xdfd57e=_0x80a455;_0x1b4d6b[_0x55b86c][_0xdfd57e(0x25e)]=_0x558289;}),_0x6d9f7[_0x80a455(0x210)]((_0x3ac7cd,_0x30ff10)=>{_0x1b4d6b[_0x30ff10]['primary_code']=_0x3ac7cd;}),_0x334999[_0x80a455(0x210)]((_0x4df420,_0x461d03)=>{var _0x4a6c2f=_0x80a455;_0x1b4d6b[_0x461d03][_0x4a6c2f(0x2f1)]=_0x4df420;}),_0x263e31[_0x80a455(0x24c)][_0x80a455(0x210)](_0x58d405=>{var _0x726e3e=_0x80a455;const _0x48b7e6=_0x3dfb9d[_0x726e3e(0x248)][_0x726e3e(0x247)](_0x38e5cb=>{var _0x41e5f1=_0x726e3e;_0x38e5cb[_0x41e5f1(0x1ed)]==_0x58d405[_0x41e5f1(0x1ed)]&&_0x38e5cb[_0x41e5f1(0x211)]==_0x58d405[_0x41e5f1(0x211)]&&_0x38e5cb[_0x41e5f1(0x20a)]==_0x58d405[_0x41e5f1(0x20a)]&&_0x38e5cb[_0x41e5f1(0x1f0)]==_0x58d405['bin']&&_0x38e5cb['bay']==_0x58d405[_0x41e5f1(0x28b)]&&_0x38e5cb[_0x41e5f1(0x2d8)]==_0x58d405[_0x41e5f1(0x2d8)]&&_0x38e5cb[_0x41e5f1(0x231)]==_0x58d405[_0x41e5f1(0x231)]&&(console[_0x41e5f1(0x2c7)](parseInt(_0x38e5cb[_0x41e5f1(0x21d)])+_0x41e5f1(0x257)+parseInt(_0x58d405[_0x41e5f1(0x2d5)])),_0x38e5cb[_0x41e5f1(0x21d)]=parseInt(_0x38e5cb[_0x41e5f1(0x21d)])+parseInt(_0x58d405['quantity']));});}),await _0x3dfb9d['save']();const _0x5d4772=_0x1b4d6b[_0x80a455(0x2b2)](_0x24f667=>_0x24f667['return_qty']!=='0'&&_0x24f667[_0x80a455(0x268)]!=='');var _0x1b9e45=0x0;_0x5d4772[_0x80a455(0x210)](_0x1386d9=>{var _0x392f45=_0x80a455;console['log'](_0x392f45(0x270),_0x1386d9),(parseInt(_0x1386d9[_0x392f45(0x25d)])<parseInt(_0x1386d9[_0x392f45(0x268)])||parseInt(_0x1386d9[_0x392f45(0x273)])<parseInt(_0x1386d9['return_qty']))&&_0x1b9e45++;});if(_0x1b9e45!=0x0)return _0x44ddfe[_0x80a455(0x2c4)](_0x80a455(0x1f9),_0x80a455(0x25a)),_0x572897[_0x80a455(0x26b)]('back');const _0x2d75d1=new purchases_return({'invoice':_0x675936,'suppliers':_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x201)],'date':_0x4ea0e4,'warehouse_name':_0x542925,'return_product':_0x5d4772,'note':_0x21de92,'room':_0x28a140,'to_warehouse_name':_0x395df3,'to_room':_0x49405d}),_0x702878=await _0x2d75d1['save']();console['log'](_0x2d75d1);const _0x21ed2f=await purchases_return[_0x80a455(0x299)]({'invoice':_0x675936}),_0x302f7f=await warehouse[_0x80a455(0x299)]({'name':_0x395df3,'room':_0x49405d});_0x21ed2f['return_product'][_0x80a455(0x210)](_0x4ccf06=>{var _0x4cfc70=_0x80a455,_0x56bbfc=0x0;const _0x11066c=_0x302f7f[_0x4cfc70(0x248)][_0x4cfc70(0x247)](_0x4e76ab=>{var _0x2c3846=_0x4cfc70;_0x4e76ab[_0x2c3846(0x1ed)]==_0x4ccf06[_0x2c3846(0x1ed)]&&_0x4e76ab[_0x2c3846(0x211)]==_0x4ccf06[_0x2c3846(0x211)]&&_0x4e76ab['type']==_0x4ccf06['type']&&_0x4e76ab[_0x2c3846(0x1f0)]==_0x4ccf06['bin']&&_0x4e76ab[_0x2c3846(0x28b)]==_0x4ccf06['bay']&&(_0x4e76ab[_0x2c3846(0x21d)]=parseInt(_0x4e76ab[_0x2c3846(0x21d)])-parseInt(_0x4ccf06[_0x2c3846(0x268)]),_0x56bbfc++);});_0x56bbfc=='0'&&(_0x302f7f[_0x4cfc70(0x248)]=_0x302f7f['product_details'][_0x4cfc70(0x304)]({'product_name':_0x4ccf06[_0x4cfc70(0x1ed)],'product_stock':_0x4ccf06[_0x4cfc70(0x268)],'primary_code':_0x4ccf06[_0x4cfc70(0x2e8)],'secondary_code':_0x4ccf06[_0x4cfc70(0x2f1)],'product_code':_0x4ccf06[_0x4cfc70(0x25e)],'storage':_0x4ccf06['storage'],'rack':_0x4ccf06[_0x4cfc70(0x2d8)],'bay':_0x4ccf06['bay'],'bin':_0x4ccf06[_0x4cfc70(0x1f0)],'type':_0x4ccf06[_0x4cfc70(0x20a)],'floorlevel':_0x4ccf06[_0x4cfc70(0x211)],'maxProducts':_0x4ccf06[_0x4cfc70(0x29c)],'unit':_0x4ccf06[_0x4cfc70(0x1f6)],'secondary_unit':_0x4ccf06[_0x4cfc70(0x21c)],'expiry_date':_0x4ccf06[_0x4cfc70(0x240)]}));}),await _0x302f7f[_0x80a455(0x2ec)]();const _0x3b43b7=await purchases[_0x80a455(0x299)]({'invoice':_0x675936});_0x3b43b7['return_data']='True';const _0x2deee2=await _0x3b43b7[_0x80a455(0x2ec)](),_0x4f2c47=new s_payment_data({'invoice':_0x675936,'suppliers':_0x44ddfe[_0x80a455(0x2a8)][_0x80a455(0x201)],'reason':_0x80a455(0x2bc)});await _0x4f2c47[_0x80a455(0x2ec)]();const _0x3485f4=await master_shop[_0x80a455(0x22e)]();console[_0x80a455(0x2c7)](_0x80a455(0x29b),_0x3485f4[0x0][_0x80a455(0x2df)]);const _0x494caa=await email_settings['findOne'](),_0x11bdeb=await suppliers[_0x80a455(0x299)]({'name':_0x44ddfe['body']['suppliers']});console['log'](_0x80a455(0x280),_0x11bdeb);_0x3485f4[0x0]['currency_placement']==0x1?(right_currency=_0x3485f4[0x0][_0x80a455(0x229)],left_currency=''):(right_currency='',left_currency=_0x3485f4[0x0][_0x80a455(0x229)]);var _0x421e0e=_0x18bc09,_0x589b03=_0x5e856b,_0x37130b='',_0x4ee2c4;for(_0x4ee2c4 in _0x421e0e){_0x37130b+=_0x80a455(0x301)+_0x80a455(0x2b8)+_0x421e0e[_0x4ee2c4]+_0x80a455(0x24f)+_0x80a455(0x2b8)+_0x589b03[_0x4ee2c4]+_0x80a455(0x24f)+'</tr>';}console[_0x80a455(0x2c7)](_0x80a455(0x28d),_0x37130b);let _0x199744=nodemailer['createTransport']({'service':'gmail','auth':{'user':_0x494caa[_0x80a455(0x1e7)],'pass':_0x494caa['password']}}),_0x366800={'from':_0x494caa[_0x80a455(0x1e7)],'to':_0x11bdeb['email'],'subject':_0x80a455(0x2a4),'attachments':[{'filename':_0x80a455(0x295),'path':__dirname+_0x80a455(0x255)+_0x80a455(0x214)+_0x3485f4[0x0][_0x80a455(0x2df)],'cid':_0x80a455(0x2c2)}],'html':_0x80a455(0x298)+_0x80a455(0x2c6)+'</head><body>'+_0x80a455(0x26e)+_0x80a455(0x26c)+_0x80a455(0x26e)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x80a455(0x26e)+_0x80a455(0x2d0)+_0x3485f4[0x0]['site_title']+'\x20</h2>'+_0x80a455(0x2af)+_0x80a455(0x2af)+_0x80a455(0x296)+'<div>'+_0x80a455(0x2a1)+_0x80a455(0x2d6)+_0x675936+'\x20'+_0x80a455(0x25f)+'\x20Order\x20Date\x20:\x20'+_0x4ea0e4+'\x20'+_0x80a455(0x2ce)+_0x80a455(0x2d1)+_0x80a455(0x2af)+_0x80a455(0x224)+_0x80a455(0x1e6)+_0x80a455(0x301)+_0x80a455(0x2a9)+_0x80a455(0x209)+_0x80a455(0x272)+_0x80a455(0x1e5)+_0x80a455(0x264)+_0x80a455(0x1e8)+_0x80a455(0x1fb)+'\x20'+_0x37130b+'\x20'+'</tbody>'+_0x80a455(0x2ff)+_0x80a455(0x26e)+_0x80a455(0x2f9)+_0x80a455(0x23e)+_0x3485f4[0x0][_0x80a455(0x2e7)]+_0x80a455(0x2d1)+_0x80a455(0x2af)+_0x80a455(0x2af)+_0x80a455(0x2a0)};_0x199744[_0x80a455(0x1ff)](_0x366800,function(_0x4a8b19,_0x296198){var _0x12b7e0=_0x80a455;_0x4a8b19?(console['log'](_0x4a8b19),console[_0x12b7e0(0x2c7)]('Error\x20Occurs')):console['log'](_0x12b7e0(0x2a3));}),_0x44ddfe[_0x80a455(0x2c4)](_0x80a455(0x23a),'purchases\x20item\x20return\x20successfull'),_0x572897['redirect'](_0x80a455(0x216));}catch(_0x42fc9b){console[_0x80a455(0x2c7)](_0x42fc9b),_0x572897['status'](0xc8)[_0x80a455(0x259)]({'message':_0x42fc9b[_0x80a455(0x28c)]});}}),router[a0_0x3c5d12(0x219)](a0_0x3c5d12(0x263),auth,async(_0x3f1819,_0x2a7cc6)=>{var _0x2e7b9e=a0_0x3c5d12;try{const {username:_0x25e49b,email:_0x1229ff,role:_0x5b9880}=_0x3f1819[_0x2e7b9e(0x28f)],_0x1cceca=_0x3f1819[_0x2e7b9e(0x28f)],_0xf180a1=await profile['findOne']({'email':_0x1cceca['email']}),_0x59427f=await master_shop[_0x2e7b9e(0x22e)](),_0x1c715c=_0x3f1819[_0x2e7b9e(0x234)]['id'],_0x29afac=await purchases[_0x2e7b9e(0x237)](_0x1c715c);if(_0x59427f[0x0][_0x2e7b9e(0x1ec)]==_0x2e7b9e(0x279))var _0x28a3d7=users[_0x2e7b9e(0x271)];else{if(_0x59427f[0x0][_0x2e7b9e(0x1ec)]=='Hindi')var _0x28a3d7=users['Hindi'];else{if(_0x59427f[0x0][_0x2e7b9e(0x1ec)]==_0x2e7b9e(0x27d))var _0x28a3d7=users[_0x2e7b9e(0x27d)];else{if(_0x59427f[0x0][_0x2e7b9e(0x1ec)]==_0x2e7b9e(0x246))var _0x28a3d7=users['Spanish'];else{if(_0x59427f[0x0][_0x2e7b9e(0x1ec)]=='French')var _0x28a3d7=users[_0x2e7b9e(0x29d)];else{if(_0x59427f[0x0][_0x2e7b9e(0x1ec)]==_0x2e7b9e(0x2ad))var _0x28a3d7=users[_0x2e7b9e(0x258)];else{if(_0x59427f[0x0]['language']==_0x2e7b9e(0x206))var _0x28a3d7=users[_0x2e7b9e(0x206)];else{if(_0x59427f[0x0]['language']==_0x2e7b9e(0x24d))var _0x28a3d7=users['Arabic'];}}}}}}}_0x2a7cc6['render'](_0x2e7b9e(0x205),{'success':_0x3f1819[_0x2e7b9e(0x2c4)](_0x2e7b9e(0x23a)),'errors':_0x3f1819[_0x2e7b9e(0x2c4)]('errors'),'role':_0x1cceca,'profile':_0xf180a1,'alldata':_0x29afac,'master_shop':_0x59427f,'language':_0x28a3d7}),console[_0x2e7b9e(0x2c7)](alldata);}catch(_0x492d88){console[_0x2e7b9e(0x2c7)](_0x492d88);}}),router[a0_0x3c5d12(0x2f2)](a0_0x3c5d12(0x2da),async(_0x4e5bae,_0x2e9ee1)=>{var _0x123c37=a0_0x3c5d12;const {product_code:_0x24e040}=_0x4e5bae[_0x123c37(0x2a8)];var _0x3ae5a2;const _0x3a50eb=await product[_0x123c37(0x303)]([{'$match':{'primary_code':_0x24e040,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x123c37(0x2ea),'name':{'$first':_0x123c37(0x235)},'category':{'$first':_0x123c37(0x218)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x123c37(0x2d9)},'product_code':{'$first':_0x123c37(0x1f1)},'primary_code':{'$first':_0x123c37(0x2dc)},'secondary_code':{'$first':_0x123c37(0x230)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x2772a4=await product['aggregate']([{'$match':{'secondary_code':_0x24e040,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x123c37(0x2ea),'name':{'$first':'$name'},'category':{'$first':_0x123c37(0x218)},'brand':{'$first':'$brand'},'unit':{'$first':_0x123c37(0x2ae)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x123c37(0x1f1)},'primary_code':{'$first':_0x123c37(0x2dc)},'secondary_code':{'$first':_0x123c37(0x230)},'maxStocks':{'$first':_0x123c37(0x2eb)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x3a50eb['length']>0x0)_0x3ae5a2=_0x3a50eb;else _0x2772a4[_0x123c37(0x27e)]>0x0&&(_0x3ae5a2=_0x2772a4);_0x2e9ee1[_0x123c37(0x259)](_0x3ae5a2);}),router['post'](a0_0x3c5d12(0x2f0),async(_0x19f8db,_0x252702)=>{var _0x45b8bd=a0_0x3c5d12;const {primaryCode:_0x61fced,secondaryCode:_0x13ef25,productCode:_0x51d52f,bay:_0x3b300b,bin:_0x590171,types:_0x5e3a22,pallet:_0x1fd417,warehouses:_0xbd18fe,room:_0x240ef9}=_0x19f8db[_0x45b8bd(0x2a8)];console[_0x45b8bd(0x2c7)](_0x19f8db['body']);try{const _0x14f6d=await warehouse['aggregate']([{'$match':{'name':_0xbd18fe,'room':_0x240ef9}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x3b300b,'product_details.bin':_0x590171,'product_details.type':_0x5e3a22}},{'$group':{'_id':_0x45b8bd(0x281),'name':{'$first':_0x45b8bd(0x21a)},'product_stock':{'$first':_0x45b8bd(0x2e5)},'level':{'$first':_0x45b8bd(0x2a5)},'isle':{'$first':_0x45b8bd(0x2a6)},'pallet':{'$first':_0x45b8bd(0x2ba)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x252702[_0x45b8bd(0x284)](0xc8)[_0x45b8bd(0x259)](_0x14f6d);}catch(_0x4fa7ff){_0x252702['status'](0x194)[_0x45b8bd(0x259)]({'message':_0x4fa7ff[_0x45b8bd(0x28c)]});}}),module[a0_0x3c5d12(0x2bd)]=router;