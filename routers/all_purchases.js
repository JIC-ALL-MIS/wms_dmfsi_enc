var a0_0xae0fc2=a0_0x5751;(function(_0x332ece,_0x462e49){var _0x13a497=a0_0x5751,_0x190dcf=_0x332ece();while(!![]){try{var _0x445a91=parseInt(_0x13a497(0x178))/0x1+-parseInt(_0x13a497(0x1c0))/0x2+parseInt(_0x13a497(0x21c))/0x3*(-parseInt(_0x13a497(0x1c8))/0x4)+parseInt(_0x13a497(0x276))/0x5*(parseInt(_0x13a497(0x1e4))/0x6)+parseInt(_0x13a497(0x184))/0x7*(parseInt(_0x13a497(0x1e9))/0x8)+-parseInt(_0x13a497(0x19d))/0x9+parseInt(_0x13a497(0x1dd))/0xa*(parseInt(_0x13a497(0x172))/0xb);if(_0x445a91===_0x462e49)break;else _0x190dcf['push'](_0x190dcf['shift']());}catch(_0x4f856c){_0x190dcf['push'](_0x190dcf['shift']());}}}(a0_0xe910,0x553de));function a0_0x5751(_0x2fefcf,_0x5d4c0e){var _0xe91053=a0_0xe910();return a0_0x5751=function(_0x575139,_0xd72328){_0x575139=_0x575139-0x166;var _0x54a048=_0xe91053[_0x575139];return _0x54a048;},a0_0x5751(_0x2fefcf,_0x5d4c0e);}const express=require(a0_0xae0fc2(0x268)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require('../middleware/auth'),nodemailer=require(a0_0xae0fc2(0x1fa));function a0_0xe910(){var _0x5c62dc=['prod_qty','quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','suppliers_data','$date','Rack\x20E','$product_details.bay','Portuguese','$product','$warehouse_name','product_stock','bin','findOne','prod_isle','string','return_data','room','slice','$product_details.type','RMSEmail','getFullYear','</thead>','\x20Order\x20Number\x20:\x20','$product_details.isle','image','$product.quantity','/view/:id','express','status','</body></html>','body','site_title','$return_data','then','../public/language/languages.json','$product_details.product_stock','purchase_invoice','Rack\x20D','here','payment\x20successfull','<hr\x20class=\x22my-3\x22>','25ulmcjv','English\x20(US)','json','<h5\x20style=\x22text-align:\x20left;\x22>','$invoice','</tbody>','$product_code','delivery_date','finalize','</span>','map','$suppliers','Rack\x20A','Portuguese\x20(BR)','<div>','warehouse','product','$product_details.floorlevel','errors','<strong>\x20Regards\x20</strong>','alertQTY','857439XghxrH','$secondary_code','secondary_unit','</td>','actual_uom','log','669339BGhIlu','Enclosed','Sales\x20Update\x20successfully','/../public','$category','INC-','params','render','$product_details.secondary_code','actual_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','forEach','1916453GsLRus','primary_code','expiry_date','add_purchases\x20error','user','Logo.png','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/barcode_scanner','/barcode/:id','Arabic\x20(ae)','post','An\x20error\x20occurred\x20while\x20saving\x20data.','True','maxStocks','amount','getMonth','$unit','product_details','product_cat','Shelves','prod_name','primary_code_hide','invoice','$product_details._id','6058062uoxQAO','Enabled','aggregate','</h5>','Hindi','/view/return_purchase/:id','<h2>\x20','all','stock_quantity','Spanish','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','push','\x20<\x20wew\x20>\x20','$suppliers_docs','warehouse_name','</div>','max_product_unit','prod_code','$product_details.product_code','Level','$finalize','error','$secondary_unit','\x20<>\x20','add\x20post','batch_code','secondary_code_hide','host','exports','Floor','$product.type','$product.bay','password','due_amount','Purchase\x20Return\x20Mail','1269754oqWPzz','floorlevel','prod_unit','<h5>','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','product_code_hide','$brand','production_date','4NijKzU','prod_primunit','Arabic','createTransport','get','</head><body>','all_purchases','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$alertquantity','/preview/:id','<table\x20style=\x22width:\x20100%\x20!important;\x22>','rack','Chinese','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>','save','/all_purchases/view','German','RoomAssign','<html><head><title></title>','prod_level','110ZJkHCM','getDate','$_id','concat','<span\x20style=\x22float:\x20right;\x22>','\x20</h2>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','5946oNuYcS','note','Email\x20sent\x20successfully','abs','redirect','16glqDJP','/view','stock_data','padStart','storage','prod_invoice','maxperunit','\x20Order\x20Date\x20:\x20','back','$expiry_date','secondary_code','<!DOCTYPE\x20html>','/give_payment/:id','JO_number','path','product_name','bay','nodemailer','purchase_quantity','logo','type','suppliers','Rack\x20B','filter','all_purchases_barcode','pallet','$product_details.pallet','$product_details.bin','$batch_code','date','currency','<tr>','port','$product_details.storage','prod_secondunit','prod_Qty','$paid_amount','sendMail','$product_details.primary_code','/view/add_purchases/:id','MaxStocks_data','COLD\x20STORAGE','$due_amount','return_qty','email','edit_purchases','types','</tr>','prod_pallet','French','suppliers_docs','1266438jqxHQN','DRY\x20STORAGE','Ambient','POnumber','findById','length','find','Rack\x20C','purchase\x20data\x20update\x20successfully','$product_details.maxProducts','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','language','$product_details.product_name','$maxStocks','flash','success','$maxProdPerUnit','paid_amount','product_code','foreach\x20newproduct','gmail','delivery_code','staff','<tbody\x20style=\x22text-align:\x20center;\x22>','Error\x20Occurs','role','$product.floorlevel','$product_details','$room','English','$product.bin','/view/add_purchases','master','</table>','message','purchases\x20item\x20return\x20successfull','$name','/CheckingWarehouse','standard_unit','return_purchase','edit_purchases_view','Raw\x20Materials','return_product','Return\x20Goods','isle','/all_purchases/view/','room_name','$product_details.rack'];a0_0xe910=function(){return _0x5c62dc;};return a0_0xe910();}var ejs=require('ejs');const path=require(a0_0xae0fc2(0x1f7)),users=require(a0_0xae0fc2(0x26f));router[a0_0xae0fc2(0x1cc)](a0_0xae0fc2(0x1ea),auth,async(_0x5ac571,_0x1886c1)=>{var _0x2a824b=a0_0xae0fc2;try{const {username:_0x30717d,email:_0x486ebd,role:_0x53d80c}=_0x5ac571['user'],_0x31006b=_0x5ac571[_0x2a824b(0x188)],_0x425cbc=await profile[_0x2a824b(0x259)]({'email':_0x31006b[_0x2a824b(0x215)]}),_0x2b9d76=await staff[_0x2a824b(0x259)]({'email':_0x31006b[_0x2a824b(0x215)]});if(_0x31006b[_0x2a824b(0x236)]=='staff'){const _0x34aeae=await staff[_0x2a824b(0x259)]({'email':_0x31006b[_0x2a824b(0x215)]});}const _0x464913=await master_shop[_0x2a824b(0x222)]();let _0x5a8b3c;if(_0x31006b[_0x2a824b(0x236)]==_0x2a824b(0x233)){const _0x5dbf58=await staff[_0x2a824b(0x259)]({'email':_0x31006b[_0x2a824b(0x215)]});_0x5a8b3c=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5dbf58[_0x2a824b(0x16c)]}},{'$lookup':{'from':'suppliers','localField':'suppliers','foreignField':'name','as':_0x2a824b(0x21b)}},{'$unwind':_0x2a824b(0x1aa)},{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x2a824b(0x27a)},'suppliers':{'$first':_0x2a824b(0x168)},'date':{'$first':_0x2a824b(0x251)},'warehouse_name':{'$first':_0x2a824b(0x256)},'room':{'$first':_0x2a824b(0x239)},'product':{'$push':'$product'},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2a824b(0x20d)},'due_amount':{'$first':_0x2a824b(0x213)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':'$batch_code'},'expiry_date':{'$first':_0x2a824b(0x1f2)},'suppliers_docs':{'$first':_0x2a824b(0x1aa)},'total_product_quantity':{'$sum':_0x2a824b(0x266)},'level':{'$addToSet':_0x2a824b(0x1bc)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x2a824b(0x1bb)},'floorlevel':{'$addToSet':_0x2a824b(0x237)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x5a8b3c=await purchases['aggregate']([{'$lookup':{'from':_0x2a824b(0x1fe),'localField':'suppliers','foreignField':'name','as':_0x2a824b(0x21b)}},{'$unwind':_0x2a824b(0x1aa)},{'$unwind':_0x2a824b(0x255)},{'$group':{'_id':_0x2a824b(0x1df),'invoice':{'$first':_0x2a824b(0x27a)},'suppliers':{'$first':_0x2a824b(0x168)},'date':{'$first':_0x2a824b(0x251)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_name'},'product':{'$push':_0x2a824b(0x255)},'note':{'$first':'$note'},'paid_amount':{'$first':_0x2a824b(0x20d)},'due_amount':{'$first':_0x2a824b(0x213)},'return_data':{'$first':_0x2a824b(0x26d)},'batch_code':{'$first':_0x2a824b(0x205)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':_0x2a824b(0x1aa)},'total_product_quantity':{'$sum':_0x2a824b(0x266)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x2a824b(0x23b)},'type':{'$addToSet':_0x2a824b(0x1bb)},'floorlevel':{'$addToSet':_0x2a824b(0x237)},'finalize':{'$first':_0x2a824b(0x1b1)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x464913[0x0][_0x2a824b(0x228)]==_0x2a824b(0x277)){var _0x2cfcba=users[_0x2a824b(0x23a)];console[_0x2a824b(0x177)](_0x2cfcba);}else{if(_0x464913[0x0][_0x2a824b(0x228)]==_0x2a824b(0x1a1))var _0x2cfcba=users[_0x2a824b(0x1a1)];else{if(_0x464913[0x0]['language']==_0x2a824b(0x1d9))var _0x2cfcba=users[_0x2a824b(0x1d9)];else{if(_0x464913[0x0][_0x2a824b(0x228)]==_0x2a824b(0x1a6))var _0x2cfcba=users[_0x2a824b(0x1a6)];else{if(_0x464913[0x0]['language']=='French')var _0x2cfcba=users['French'];else{if(_0x464913[0x0][_0x2a824b(0x228)]==_0x2a824b(0x16a))var _0x2cfcba=users[_0x2a824b(0x254)];else{if(_0x464913[0x0][_0x2a824b(0x228)]==_0x2a824b(0x1d4))var _0x2cfcba=users['Chinese'];else{if(_0x464913[0x0][_0x2a824b(0x228)]==_0x2a824b(0x18e))var _0x2cfcba=users['Arabic'];}}}}}}}_0x1886c1[_0x2a824b(0x17f)](_0x2a824b(0x1ce),{'success':_0x5ac571[_0x2a824b(0x22b)](_0x2a824b(0x22c)),'errors':_0x5ac571[_0x2a824b(0x22b)](_0x2a824b(0x16f)),'purchases':_0x5a8b3c,'role':_0x31006b,'profile':_0x425cbc,'master_shop':_0x464913,'language':_0x2cfcba});}catch(_0xd74595){console[_0x2a824b(0x177)]('table\x20page',_0xd74595),_0x1886c1[_0x2a824b(0x269)](0xc8)[_0x2a824b(0x278)]({'message':_0xd74595[_0x2a824b(0x23f)]});}});function BayBinSelected(_0x339d1f,_0x5ac84a){var _0x1dad3c=a0_0xae0fc2,_0x37fedc=[],_0x145838=[],_0xbbc174=[],_0x585eee=[],_0x100d77=[],_0x54e03e=[];let _0x2342cc=[];if(_0x339d1f==_0x1dad3c(0x21d))switch(_0x5ac84a){case'Rack\x20A':_0x37fedc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x145838=[0x1,0x2],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=[_0x1dad3c(0x1b0),_0x1dad3c(0x1ba)],_0x100d77=['D'],_0x54e03e=['A'];break;case _0x1dad3c(0x1ff):_0x37fedc=[0x6,0x5,0x4,0x3,0x2,0x1],_0x145838=[0x1,0x2],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=[_0x1dad3c(0x1b0),'Floor'],_0x100d77=['D'],_0x54e03e=['B'];break;case _0x1dad3c(0x198):_0x37fedc=[0x0],_0x145838=[0x0],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=[_0x1dad3c(0x1ba)],_0x100d77=['D'],_0x54e03e=['S'];break;case'Receiving\x20Area':_0x37fedc=[0x0],_0x145838=[0x0],_0x585eee=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0xbbc174=[_0x1dad3c(0x1ba)],_0x100d77=['D'],_0x54e03e=['R'];break;}else{if(_0x339d1f==_0x1dad3c(0x212))switch(_0x5ac84a){case _0x1dad3c(0x169):_0x37fedc=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x145838=['B','F'],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=[_0x1dad3c(0x1b0),_0x1dad3c(0x1ba)],_0x100d77=['C'],_0x54e03e=['A'];break;case'Rack\x20B':_0x37fedc=[0x5,0x4,0x3,0x2,0x1],_0x145838=['F','B','S'],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=[_0x1dad3c(0x1b0),_0x1dad3c(0x1ba)],_0x100d77=['C'],_0x54e03e=['B'];break;case _0x1dad3c(0x223):_0x37fedc=[0x1,0x2,0x3,0x4,0x5],_0x145838=['B','F','S'],_0x585eee=[0x5,0x4,0x3,0x2,0x1],_0xbbc174=[_0x1dad3c(0x1b0),_0x1dad3c(0x1ba)],_0x100d77=['C'],_0x54e03e=['C'];break;case _0x1dad3c(0x272):_0x37fedc=[0x5,0x4,0x3,0x2,0x1],_0x145838=['F','B','S'],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=['Level',_0x1dad3c(0x1ba)],_0x100d77=['C'],_0x54e03e=['D'];break;case _0x1dad3c(0x252):_0x37fedc=[0x4,0x3,0x2,0x1],_0x145838=[0x1,0x2],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=['Level',_0x1dad3c(0x1ba)],_0x100d77=['C'],_0x54e03e=['E'];break;case'Rack\x20F':_0x37fedc=[0x1,0x2,0x3],_0x145838=[0x1,0x2],_0x585eee=[0x1,0x2,0x3,0x4,0x5],_0xbbc174=[_0x1dad3c(0x1b0)],_0x100d77=['C'],_0x54e03e=['F'];break;}}return{'levels':_0x37fedc,'Isle':_0x145838,'rack':_0x585eee,'type':_0xbbc174,'storage':_0x100d77,'rak':_0x54e03e};}async function getRandom8DigitNumber(){var _0x9f3c4a=a0_0xae0fc2;const _0xa133f7=0x989680,_0x25edb5=0x5f5e0ff,_0x3d7bf1=Math['floor'](Math['random']()*(_0x25edb5-_0xa133f7+0x1))+_0xa133f7;var _0x48f4fe;const _0x8920d=await purchases[_0x9f3c4a(0x259)]({'invoice':_0x9f3c4a(0x17d)+_0x3d7bf1});return _0x8920d&&_0x8920d[_0x9f3c4a(0x221)]>0x0?_0x48f4fe='INC-'+_0x3d7bf1:_0x48f4fe=_0x9f3c4a(0x17d)+_0x3d7bf1,_0x48f4fe;}router['get']('/view/add_purchases',auth,async(_0x47a46b,_0x586c7b)=>{var _0x621968=a0_0xae0fc2;try{const {username:_0x419582,email:_0x3f6998,role:_0x341a71}=_0x47a46b[_0x621968(0x188)],_0x2bc75e=_0x47a46b[_0x621968(0x188)],_0x18a6d1=await profile[_0x621968(0x259)]({'email':_0x2bc75e[_0x621968(0x215)]}),_0xa4c906=await master_shop[_0x621968(0x222)](),_0x30f442=await staff[_0x621968(0x259)]({'email':_0x2bc75e[_0x621968(0x215)]}),_0x47aa9c=await suppliers['find']({});let _0x2ed7b6;if(_0x2bc75e['role']==_0x621968(0x233)){const _0x3c3926=await staff['findOne']({'email':_0x2bc75e[_0x621968(0x215)]});_0x2ed7b6=await warehouse[_0x621968(0x19f)]([{'$match':{'status':'Enabled','name':_0x3c3926['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x621968(0x248)}}},{'$group':{'_id':_0x621968(0x241),'name':{'$first':_0x621968(0x241)}}}]);}else _0x2ed7b6=await warehouse[_0x621968(0x19f)]([{'$match':{'status':'Enabled','warehouse_category':_0x621968(0x246),'name':{'$ne':_0x621968(0x248)}}},{'$group':{'_id':_0x621968(0x241),'name':{'$first':_0x621968(0x241)}}}]);const _0x2440ee=await product[_0x621968(0x222)]({}),_0x23e92=await warehouse[_0x621968(0x222)]({'status':'Enabled'}),_0x37584d=await purchases['find']({}),_0x344f19=_0x37584d[_0x621968(0x221)]+0x1,_0x9e290a=_0x621968(0x17d)+_0x344f19['toString']()[_0x621968(0x1ec)](0x5,'0');var _0x4fd1c2=[_0x621968(0x21e),_0x621968(0x179)];if(_0xa4c906[0x0]['language']==_0x621968(0x277))var _0x469d51=users[_0x621968(0x23a)];else{if(_0xa4c906[0x0]['language']==_0x621968(0x1a1))var _0x469d51=users[_0x621968(0x1a1)];else{if(_0xa4c906[0x0][_0x621968(0x228)]=='German')var _0x469d51=users['German'];else{if(_0xa4c906[0x0][_0x621968(0x228)]=='Spanish')var _0x469d51=users['Spanish'];else{if(_0xa4c906[0x0]['language']==_0x621968(0x21a))var _0x469d51=users[_0x621968(0x21a)];else{if(_0xa4c906[0x0]['language']==_0x621968(0x16a))var _0x469d51=users[_0x621968(0x254)];else{if(_0xa4c906[0x0][_0x621968(0x228)]=='Chinese')var _0x469d51=users[_0x621968(0x1d4)];else{if(_0xa4c906[0x0][_0x621968(0x228)]==_0x621968(0x18e))var _0x469d51=users['Arabic'];}}}}}}}const _0x2c4747=getRandom8DigitNumber();_0x2c4747[_0x621968(0x26e)](_0x33d6dc=>{var _0x338358=_0x621968;_0x586c7b['render']('add_purchases',{'success':_0x47a46b['flash'](_0x338358(0x22c)),'errors':_0x47a46b['flash'](_0x338358(0x16f)),'role':_0x2bc75e,'profile':_0x18a6d1,'suppliers':_0x47aa9c,'warehouse':_0x2ed7b6,'product':_0x2440ee,'invoice':_0x33d6dc,'master_shop':_0xa4c906,'language':_0x469d51,'find_data':_0x23e92,'rooms_data':_0x4fd1c2});})['catch'](_0x5e5c8f=>{var _0x41e333=_0x621968;_0x47a46b[_0x41e333(0x22b)](_0x41e333(0x16f),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x586c7b[_0x41e333(0x1e8)](_0x41e333(0x1d8));});}catch(_0x3b69d1){console[_0x621968(0x177)](_0x3b69d1);}}),router[a0_0xae0fc2(0x1cc)](a0_0xae0fc2(0x210),auth,async(_0x2200f0,_0x3f1491)=>{var _0xecf8ea=a0_0xae0fc2;try{const _0x595853=_0x2200f0[_0xecf8ea(0x17e)]['id'];console[_0xecf8ea(0x177)](_0x595853);const _0x297626=await master_shop[_0xecf8ea(0x222)]();console[_0xecf8ea(0x177)](_0xecf8ea(0x23d),_0x297626);const _0x52fb52=await product[_0xecf8ea(0x259)]({'name':_0x595853});console[_0xecf8ea(0x177)](_0xecf8ea(0x16d),_0x52fb52),_0x3f1491[_0xecf8ea(0x269)](0xc8)['json']({'product_data':_0x52fb52,'master':_0x297626});}catch(_0x5bdc05){console['log'](_0xecf8ea(0x187),_0x5bdc05);}}),router[a0_0xae0fc2(0x18f)](a0_0xae0fc2(0x23c),auth,async(_0x20cac0,_0x48e594)=>{var _0x118dec=a0_0xae0fc2;try{const {invoice:_0x2fa25e,date:_0x36f36f,warehouse_name:_0x5030be,prod_name:_0xa12d4e,prod_code:_0x5dd9cd,prod_qty:_0x1ee4f4,prod_unit:_0x5b28e3,prod_secondunit:_0x31014d,prod_level:_0x222a11,prod_isle:_0x4e7329,prod_pallet:_0x390acc,note:_0x120c36,expiry_date:_0xc31e54,batch_code:_0x19c256,payable:_0x2ac2a5,due_amount:_0x57687b,Room_name:_0x4f81e5,primary_code:_0x12dcd2,secondary_code:_0x6f7a3a,MaxStocks_data:_0x215631,PO_number:_0x2d1c81,SCRN:_0x5e01ac,JO_number:_0x1721d0}=_0x20cac0[_0x118dec(0x26b)];if(typeof _0xa12d4e=='string')var _0x2c51fe=[_0x20cac0['body'][_0x118dec(0x199)]],_0xba83bf=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1ae)]],_0x5517d2=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x20c)]],_0x2dab9b=[_0x20cac0['body'][_0x118dec(0x1c9)]],_0x21c37a=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x20b)]],_0x2bcabc=[_0x20cac0[_0x118dec(0x26b)]['prod_level']],_0x3b50c2=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x185)]],_0x46541a=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1f3)]],_0x58436f=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x211)]],_0xa11d0c=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1b6)]],_0x4b0179=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x186)]],_0x523abc=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1ad)]],_0x59baef=[_0x20cac0['body'][_0x118dec(0x171)]],_0x55f56f=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1c7)]],_0x43640a=[_0x20cac0['body']['prod_cat']],_0x561a51=[_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1da)]],_0xab35ad=[_0x20cac0['body']['deliverycode']],_0x3171b6=[_0x20cac0['body'][_0x118dec(0x1ee)]],_0x312529=[_0x20cac0[_0x118dec(0x26b)]['actual_qty']],_0x1ea874=[_0x20cac0['body'][_0x118dec(0x176)]];else var _0x2c51fe=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x199)]],_0xba83bf=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1ae)]],_0x5517d2=[..._0x20cac0['body']['prod_Qty']],_0x2dab9b=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1c9)]],_0x21c37a=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x20b)]],_0x2bcabc=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1dc)]],_0x3b50c2=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x185)]],_0x46541a=[..._0x20cac0[_0x118dec(0x26b)]['secondary_code']],_0x58436f=[..._0x20cac0['body'][_0x118dec(0x211)]],_0xa11d0c=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1b6)]],_0x4b0179=[..._0x20cac0[_0x118dec(0x26b)]['expiry_date']],_0x523abc=[..._0x20cac0['body'][_0x118dec(0x1ad)]],_0x59baef=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x171)]],_0x55f56f=[..._0x20cac0['body'][_0x118dec(0x1c7)]],_0x43640a=[..._0x20cac0[_0x118dec(0x26b)]['prod_cat']],_0x561a51=[..._0x20cac0['body'][_0x118dec(0x1da)]],_0xab35ad=[..._0x20cac0[_0x118dec(0x26b)]['deliverycode']],_0x3171b6=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1ee)]],_0x312529=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x181)]],_0x1ea874=[..._0x20cac0[_0x118dec(0x26b)][_0x118dec(0x176)]];const _0x50de93=_0x2c51fe['map'](_0x3f0101=>{return _0x3f0101={'product_name':_0x3f0101};});_0x312529[_0x118dec(0x183)]((_0x31e4c2,_0x558c71)=>{var _0x24e460=_0x118dec;_0x50de93[_0x558c71][_0x24e460(0x181)]=Math['abs'](_0x31e4c2);}),_0x1ea874['forEach']((_0x4ff086,_0x259b72)=>{_0x50de93[_0x259b72]['actual_uom']=_0x4ff086;}),_0xba83bf[_0x118dec(0x183)]((_0x5ae12,_0x4ae8a4)=>{var _0x9ea58a=_0x118dec;_0x50de93[_0x4ae8a4][_0x9ea58a(0x22f)]=_0x5ae12;}),_0x5517d2[_0x118dec(0x183)]((_0x56c356,_0x211022)=>{var _0x212576=_0x118dec;_0x50de93[_0x211022][_0x212576(0x24e)]=Math['abs'](_0x56c356);}),_0x2dab9b[_0x118dec(0x183)]((_0x3dfbb9,_0x581f98)=>{var _0x1fbffe=_0x118dec;_0x50de93[_0x581f98][_0x1fbffe(0x243)]=_0x3dfbb9;}),_0x21c37a[_0x118dec(0x183)]((_0x464231,_0x14f02f)=>{var _0x4a9c66=_0x118dec;_0x50de93[_0x14f02f][_0x4a9c66(0x174)]=_0x464231;}),_0x2bcabc[_0x118dec(0x183)]((_0x1c948f,_0x3f9482)=>{var _0x135083=_0x118dec;_0x561a51[_0x135083(0x183)]((_0x3e6a08,_0x30aa54)=>{var _0x1a1cde=_0x135083;if(_0x3e6a08=='Receiving\x20Area'&&_0x3f9482==_0x30aa54){console['log'](_0x3e6a08+_0x1a1cde(0x1a9)+_0x3f9482+'\x20<>\x20'+_0x30aa54+_0x1a1cde(0x1b4)+_0x1c948f);var _0x297fdf=_0x1c948f[_0x1a1cde(0x25e)](0x3);_0x50de93[_0x3f9482][_0x1a1cde(0x1ed)]=_0x1c948f[0x0],_0x50de93[_0x3f9482]['rack']=_0x1c948f[0x1],_0x50de93[_0x3f9482][_0x1a1cde(0x1f9)]=0x0,_0x50de93[_0x3f9482]['bin']=0x0,_0x50de93[_0x3f9482][_0x1a1cde(0x1fd)]=_0x1a1cde(0x1ba),_0x50de93[_0x3f9482][_0x1a1cde(0x1c1)]=_0x297fdf;}else{if(_0x3e6a08==_0x1a1cde(0x198)&&_0x3f9482==_0x30aa54){var _0x297fdf=_0x1c948f['slice'](0x3);_0x50de93[_0x3f9482][_0x1a1cde(0x1ed)]=_0x1c948f[0x0],_0x50de93[_0x3f9482][_0x1a1cde(0x1d3)]=_0x1c948f[0x1],_0x50de93[_0x3f9482][_0x1a1cde(0x1f9)]=0x0,_0x50de93[_0x3f9482][_0x1a1cde(0x258)]=0x0,_0x50de93[_0x3f9482][_0x1a1cde(0x1fd)]=_0x1a1cde(0x1ba),_0x50de93[_0x3f9482][_0x1a1cde(0x1c1)]=_0x1c948f[0x5];}else{if(_0x3f9482==_0x30aa54){if(_0x1c948f[0x0]=='A'&&_0x1c948f[0x1]=='L'&&_0x1c948f[0x2]=='L')console[_0x1a1cde(0x177)](_0x3e6a08+_0x1a1cde(0x1b4)+_0x3f9482+_0x1a1cde(0x1b4)+_0x30aa54+_0x1a1cde(0x1b4)+_0x1c948f+_0x1a1cde(0x273)),_0x50de93[_0x3f9482]['storage']=_0x1c948f[0x0],_0x50de93[_0x3f9482][_0x1a1cde(0x1d3)]=_0x1c948f[0x1],_0x50de93[_0x3f9482][_0x1a1cde(0x1f9)]=0x0,_0x50de93[_0x3f9482][_0x1a1cde(0x258)]=0x0,_0x50de93[_0x3f9482][_0x1a1cde(0x1fd)]='Floor',_0x50de93[_0x3f9482][_0x1a1cde(0x1c1)]=_0x1c948f[0x3];else{var _0x4ec1d2;if(_0x1c948f[0x4]=='L')_0x4ec1d2=_0x1a1cde(0x1b0);else _0x1c948f[0x4]=='F'&&(_0x4ec1d2='Floor');_0x50de93[_0x3f9482][_0x1a1cde(0x1ed)]=_0x1c948f[0x0],_0x50de93[_0x3f9482][_0x1a1cde(0x1d3)]=_0x1c948f[0x1],_0x50de93[_0x3f9482]['bay']=_0x1c948f[0x2],_0x50de93[_0x3f9482][_0x1a1cde(0x258)]=_0x1c948f[0x3],_0x50de93[_0x3f9482]['type']=_0x4ec1d2,_0x50de93[_0x3f9482][_0x1a1cde(0x1c1)]=_0x1c948f[0x5];}}}}});}),_0x3b50c2[_0x118dec(0x183)]((_0x3b6a20,_0x51d8d1)=>{var _0x482fe8=_0x118dec;_0x50de93[_0x51d8d1][_0x482fe8(0x185)]=_0x3b6a20;}),_0x46541a[_0x118dec(0x183)]((_0x43596a,_0x45101a)=>{var _0x3080b5=_0x118dec;_0x50de93[_0x45101a][_0x3080b5(0x1f3)]=_0x43596a;}),_0x58436f[_0x118dec(0x183)]((_0x5bd5b3,_0x2c9528)=>{var _0xf18edb=_0x118dec;_0x50de93[_0x2c9528][_0xf18edb(0x192)]=_0x5bd5b3;}),_0xa11d0c[_0x118dec(0x183)]((_0x4bbb6c,_0x45ce50)=>{_0x50de93[_0x45ce50]['batch_code']=_0x4bbb6c;}),_0x4b0179[_0x118dec(0x183)]((_0x5417a7,_0x1afbea)=>{var _0x4aba53=_0x118dec;_0x50de93[_0x1afbea][_0x4aba53(0x186)]=_0x5417a7;}),_0x523abc['forEach']((_0x5892cb,_0x2208a2)=>{var _0x162826=_0x118dec;_0x50de93[_0x2208a2][_0x162826(0x1ef)]=_0x5892cb;}),_0x59baef[_0x118dec(0x183)]((_0x4ac390,_0x439d05)=>{var _0x12b6ca=_0x118dec;_0x50de93[_0x439d05][_0x12b6ca(0x171)]=_0x4ac390;}),_0x55f56f[_0x118dec(0x183)]((_0x5789be,_0x592e6d)=>{_0x50de93[_0x592e6d]['production_date']=_0x5789be;}),_0x43640a[_0x118dec(0x183)]((_0xa080da,_0x350302)=>{_0x50de93[_0x350302]['product_cat']=_0xa080da;}),_0x561a51[_0x118dec(0x183)]((_0x39fbc9,_0x46ebc3)=>{var _0x18459a=_0x118dec;_0x50de93[_0x46ebc3][_0x18459a(0x24b)]=_0x39fbc9;}),_0xab35ad[_0x118dec(0x183)]((_0x5d657a,_0xe16c3e)=>{_0x50de93[_0xe16c3e]['delivery_code']=_0x5d657a;}),_0x3171b6[_0x118dec(0x183)]((_0x19f502,_0x6c4f04)=>{var _0x17bf12=_0x118dec;_0x50de93[_0x6c4f04][_0x17bf12(0x19b)]=_0x19f502;});const _0x143b45=_0x561a51[_0x118dec(0x167)](_0x365af2=>{return _0x365af2={'room_name':_0x365af2};}),_0x2d30e3=_0x50de93[_0x118dec(0x200)](_0x1e94b1=>_0x1e94b1[_0x118dec(0x24e)]!=='0'&&_0x1e94b1[_0x118dec(0x24e)]!==''),_0xe3f931=new purchases({'invoice':_0x2fa25e,'suppliers':_0x20cac0[_0x118dec(0x26b)][_0x118dec(0x1fe)],'date':_0x36f36f,'warehouse_name':_0x5030be,'product':_0x2d30e3,'note':_0x120c36,'due_amount':_0x57687b,'POnumber':_0x2d1c81,'SCRN':_0x5e01ac,'JO_number':_0x1721d0,'roomList':_0x143b45}),_0x25fbab=await _0xe3f931[_0x118dec(0x1d7)](),_0x69f9ff=await purchases[_0x118dec(0x259)]({'invoice':_0x2fa25e}),_0x329145=_0x69f9ff[_0x118dec(0x16d)][_0x118dec(0x167)](async _0x3532cc=>{var _0x4d43bd=_0x118dec,_0x925db9=await warehouse[_0x4d43bd(0x259)]({'name':_0x5030be,'room':_0x3532cc[_0x4d43bd(0x24b)]}),_0x476a91=0x0;return _0x925db9[_0x4d43bd(0x196)][_0x4d43bd(0x183)](_0x46b95e=>{var _0x43c675=_0x4d43bd;_0x46b95e[_0x43c675(0x1f8)]==_0x3532cc[_0x43c675(0x1f8)]&&_0x46b95e[_0x43c675(0x1c1)]==_0x3532cc[_0x43c675(0x1c1)]&&_0x46b95e[_0x43c675(0x1fd)]==_0x3532cc['type']&&_0x46b95e[_0x43c675(0x258)]==_0x3532cc[_0x43c675(0x258)]&&_0x46b95e[_0x43c675(0x1f9)]==_0x3532cc[_0x43c675(0x1f9)]&&_0x46b95e[_0x43c675(0x1d3)]==_0x3532cc[_0x43c675(0x1d3)]&&_0x46b95e[_0x43c675(0x1ed)]==_0x3532cc[_0x43c675(0x1ed)]&&_0x46b95e['expiry_date']==_0x3532cc[_0x43c675(0x186)]&&_0x46b95e[_0x43c675(0x1b6)]==_0x3532cc[_0x43c675(0x1b6)]&&_0x46b95e[_0x43c675(0x1c7)]==_0x3532cc[_0x43c675(0x1c7)]&&_0x46b95e['invoice']==_0x69f9ff[_0x43c675(0x19b)]&&(_0x46b95e['product_stock']+=Math[_0x43c675(0x1e7)](_0x3532cc[_0x43c675(0x24e)]),_0x476a91++);}),_0x476a91===0x0&&_0x925db9[_0x4d43bd(0x196)][_0x4d43bd(0x1a8)]({'product_name':_0x3532cc[_0x4d43bd(0x1f8)],'product_stock':Math[_0x4d43bd(0x1e7)](_0x3532cc[_0x4d43bd(0x24e)]),'primary_code':_0x3532cc['primary_code'],'secondary_code':_0x3532cc['secondary_code'],'product_code':_0x3532cc[_0x4d43bd(0x22f)],'storage':_0x3532cc[_0x4d43bd(0x1ed)],'rack':_0x3532cc[_0x4d43bd(0x1d3)],'bay':_0x3532cc[_0x4d43bd(0x1f9)],'bin':_0x3532cc[_0x4d43bd(0x258)],'type':_0x3532cc[_0x4d43bd(0x1fd)],'floorlevel':_0x3532cc['floorlevel'],'maxProducts':_0x3532cc[_0x4d43bd(0x192)],'unit':_0x3532cc['standard_unit'],'secondary_unit':_0x3532cc['secondary_unit'],'expiry_date':_0x3532cc[_0x4d43bd(0x186)],'maxPerUnit':_0x3532cc[_0x4d43bd(0x1ef)],'batch_code':_0x3532cc['batch_code'],'alertQTY':_0x3532cc[_0x4d43bd(0x171)],'production_date':_0x3532cc[_0x4d43bd(0x1c7)],'product_cat':_0x3532cc[_0x4d43bd(0x197)],'invoice':_0x3532cc[_0x4d43bd(0x19b)],'actual_qty':Math[_0x4d43bd(0x1e7)](_0x3532cc[_0x4d43bd(0x181)]),'actual_uom':_0x3532cc['actual_uom']}),_0x925db9;});Promise[_0x118dec(0x1a4)](_0x329145)['then'](async _0x42467d=>{var _0x1b6c4b=_0x118dec;try{for(const _0x42845d of _0x42467d){await _0x42845d['save']();}const _0x35c880=await master_shop[_0x1b6c4b(0x222)](),_0x6252c=await email_settings[_0x1b6c4b(0x259)](),_0x34587a=await supervisor_settings[_0x1b6c4b(0x222)]();var _0x23d7b6=_0x69f9ff[_0x1b6c4b(0x16d)],_0x31a53d='',_0x26f920;for(_0x26f920 in _0x23d7b6){_0x31a53d+=_0x1b6c4b(0x208)+_0x1b6c4b(0x1e3)+_0x23d7b6[_0x26f920][_0x1b6c4b(0x1f8)]+_0x1b6c4b(0x175)+_0x1b6c4b(0x1e3)+_0x23d7b6[_0x26f920][_0x1b6c4b(0x22f)]+_0x1b6c4b(0x175)+_0x1b6c4b(0x1e3)+_0x23d7b6[_0x26f920]['quantity']+_0x1b6c4b(0x175)+_0x1b6c4b(0x1e3)+_0x23d7b6[_0x26f920][_0x1b6c4b(0x243)]+'</td>'+_0x1b6c4b(0x1e3)+_0x23d7b6[_0x26f920][_0x1b6c4b(0x174)]+_0x1b6c4b(0x175)+_0x1b6c4b(0x1e3)+_0x69f9ff[_0x1b6c4b(0x1ab)]+_0x1b6c4b(0x175)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x23d7b6[_0x26f920]['room_name']+_0x1b6c4b(0x175)+_0x1b6c4b(0x1e3)+_0x23d7b6[_0x26f920][_0x1b6c4b(0x1ed)]+_0x23d7b6[_0x26f920][_0x1b6c4b(0x1d3)]+_0x23d7b6[_0x26f920]['bay']+_0x23d7b6[_0x26f920]['bin']+_0x23d7b6[_0x26f920][_0x1b6c4b(0x1fd)][0x0]+_0x23d7b6[_0x26f920][_0x1b6c4b(0x1c1)]+_0x1b6c4b(0x175),_0x1b6c4b(0x218);}let _0xa6ff0a=nodemailer[_0x1b6c4b(0x1cb)]({'host':_0x6252c[_0x1b6c4b(0x1b8)],'port':Number(_0x6252c[_0x1b6c4b(0x209)]),'secure':![],'auth':{'user':_0x6252c[_0x1b6c4b(0x215)],'pass':_0x6252c[_0x1b6c4b(0x1bd)]}}),_0x370cc6={'from':_0x6252c[_0x1b6c4b(0x215)],'to':_0x34587a[0x0][_0x1b6c4b(0x260)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x1b6c4b(0x189),'path':__dirname+_0x1b6c4b(0x17b)+_0x1b6c4b(0x1d5)+_0x35c880[0x0][_0x1b6c4b(0x265)],'cid':_0x1b6c4b(0x1fc)}],'html':_0x1b6c4b(0x1f4)+_0x1b6c4b(0x1db)+_0x1b6c4b(0x1cd)+_0x1b6c4b(0x16b)+_0x1b6c4b(0x1cf)+_0x1b6c4b(0x16b)+_0x1b6c4b(0x18a)+_0x1b6c4b(0x1ac)+'<div>'+_0x1b6c4b(0x1a3)+_0x35c880[0x0][_0x1b6c4b(0x26c)]+'\x20</h2>'+_0x1b6c4b(0x1ac)+_0x1b6c4b(0x1ac)+_0x1b6c4b(0x275)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x69f9ff[_0x1b6c4b(0x19b)]+'\x20'+_0x1b6c4b(0x1e1)+_0x1b6c4b(0x1f0)+_0x69f9ff[_0x1b6c4b(0x206)]+'\x20'+_0x1b6c4b(0x166)+_0x1b6c4b(0x1a0)+_0x1b6c4b(0x1ac)+_0x1b6c4b(0x1d2)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1b6c4b(0x208)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x1b6c4b(0x24f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x1b6c4b(0x1a7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1b6c4b(0x227)+_0x1b6c4b(0x218)+_0x1b6c4b(0x262)+_0x1b6c4b(0x234)+'\x20'+_0x31a53d+'\x20'+_0x1b6c4b(0x27b)+_0x1b6c4b(0x23e)+_0x1b6c4b(0x16b)+'<strong>\x20Regards\x20</strong>'+_0x1b6c4b(0x1c3)+_0x35c880[0x0][_0x1b6c4b(0x26c)]+'</h5>'+'</div>'+_0x1b6c4b(0x1ac)+_0x1b6c4b(0x26a)};_0xa6ff0a[_0x1b6c4b(0x20e)](_0x370cc6,function(_0x1687f1,_0x2557f0){var _0x3d9704=_0x1b6c4b;_0x1687f1?(console[_0x3d9704(0x177)](_0x1687f1),console[_0x3d9704(0x177)](_0x3d9704(0x235))):console['log'](_0x3d9704(0x1e6));}),_0x20cac0[_0x1b6c4b(0x22b)]('success','Purchase\x20data\x20added\x20successfully'),_0x48e594[_0x1b6c4b(0x1e8)](_0x1b6c4b(0x24a));}catch(_0xf69e7){console[_0x1b6c4b(0x1b2)](_0xf69e7),_0x48e594[_0x1b6c4b(0x269)](0x1f4)[_0x1b6c4b(0x278)]({'error':_0x1b6c4b(0x190)});}})['catch'](_0x4beb07=>{var _0x593ee0=_0x118dec;console[_0x593ee0(0x1b2)](_0x4beb07),_0x48e594['status'](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x44ea45){console[_0x118dec(0x177)](_0x44ea45);}}),router[a0_0xae0fc2(0x1cc)](a0_0xae0fc2(0x1d1),auth,async(_0x254ccf,_0xd8a0bb)=>{var _0x2b6ccd=a0_0xae0fc2;try{const {username:_0x2421cd,email:_0x40b859,role:_0x5894b3}=_0x254ccf[_0x2b6ccd(0x188)],_0x343701=_0x254ccf['user'],_0x2b748e=await profile[_0x2b6ccd(0x259)]({'email':_0x343701[_0x2b6ccd(0x215)]}),_0x337d80=await master_shop['find'](),_0x3ea3a8=_0x254ccf['params']['id'],_0x297337=await purchases[_0x2b6ccd(0x220)](_0x3ea3a8),_0x27358f=await warehouse[_0x2b6ccd(0x19f)]([{'$match':{'name':_0x297337[_0x2b6ccd(0x1ab)],'room':_0x297337[_0x2b6ccd(0x25d)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x2b6ccd(0x19c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2b6ccd(0x270)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2b6ccd(0x204)},'type':{'$first':_0x2b6ccd(0x25f)},'floorlevel':{'$first':_0x2b6ccd(0x16e)},'primary_code':{'$first':_0x2b6ccd(0x20f)},'secondary_code':{'$first':_0x2b6ccd(0x180)},'product_code':{'$first':_0x2b6ccd(0x1af)},'storage':{'$first':_0x2b6ccd(0x20a)},'rack':{'$first':_0x2b6ccd(0x24c)},'expiry_date':{'$first':'$product_details.expiry_date'}}}]),_0x349d67=await customer[_0x2b6ccd(0x222)]({});let _0x42de63;if(_0x343701[_0x2b6ccd(0x236)]=='staff'){const _0x2ffe34=await staff[_0x2b6ccd(0x259)]({'email':_0x343701[_0x2b6ccd(0x215)]});_0x42de63=await warehouse['aggregate']([{'$match':{'status':_0x2b6ccd(0x19e),'name':_0x2ffe34[_0x2b6ccd(0x16c)]}},{'$group':{'_id':_0x2b6ccd(0x241),'name':{'$first':'$name'}}}]);}else _0x42de63=await warehouse[_0x2b6ccd(0x19f)]([{'$match':{'status':_0x2b6ccd(0x19e)}},{'$group':{'_id':_0x2b6ccd(0x241),'name':{'$first':_0x2b6ccd(0x241)}}}]);const _0x46a359=await product[_0x2b6ccd(0x222)]({}),_0x46547d=await suppliers[_0x2b6ccd(0x222)]({}),_0x3d3860=BayBinSelected(_0x297337[_0x2b6ccd(0x1ab)],_0x297337['room']);if(_0x337d80[0x0]['language']=='English\x20(US)'){var _0xc8cbc0=users[_0x2b6ccd(0x23a)];console[_0x2b6ccd(0x177)](_0xc8cbc0);}else{if(_0x337d80[0x0][_0x2b6ccd(0x228)]==_0x2b6ccd(0x1a1))var _0xc8cbc0=users[_0x2b6ccd(0x1a1)];else{if(_0x337d80[0x0][_0x2b6ccd(0x228)]==_0x2b6ccd(0x1d9))var _0xc8cbc0=users[_0x2b6ccd(0x1d9)];else{if(_0x337d80[0x0][_0x2b6ccd(0x228)]==_0x2b6ccd(0x1a6))var _0xc8cbc0=users[_0x2b6ccd(0x1a6)];else{if(_0x337d80[0x0]['language']==_0x2b6ccd(0x21a))var _0xc8cbc0=users[_0x2b6ccd(0x21a)];else{if(_0x337d80[0x0]['language']==_0x2b6ccd(0x16a))var _0xc8cbc0=users[_0x2b6ccd(0x254)];else{if(_0x337d80[0x0][_0x2b6ccd(0x228)]=='Chinese')var _0xc8cbc0=users[_0x2b6ccd(0x1d4)];else{if(_0x337d80[0x0][_0x2b6ccd(0x228)]=='Arabic\x20(ae)')var _0xc8cbc0=users['Arabic'];}}}}}}}_0xd8a0bb['render'](_0x2b6ccd(0x245),{'success':_0x254ccf['flash'](_0x2b6ccd(0x22c)),'errors':_0x254ccf['flash'](_0x2b6ccd(0x16f)),'role':_0x343701,'profile':_0x2b748e,'customer':_0x349d67,'warehouse':_0x42de63,'product':_0x27358f,'user':_0x297337,'master_shop':_0x337d80,'unit':_0x46a359,'language':_0xc8cbc0,'suppliers':_0x46547d,'dataSelected':_0x3d3860});}catch(_0x28aafb){console[_0x2b6ccd(0x177)](_0x28aafb);}}),router[a0_0xae0fc2(0x18f)](a0_0xae0fc2(0x1d1),auth,async(_0x49e204,_0x1582d7)=>{var _0xcd1ca3=a0_0xae0fc2;try{const _0x3dc602=_0x49e204['params']['id'],{invoice:_0x648deb,warehouse_name:_0x1953dc,Room_name:_0x3826c1}=_0x49e204[_0xcd1ca3(0x26b)],_0x13c78e=await warehouse['findOne']({'name':_0x1953dc,'room':_0x3826c1}),_0x4a2f04=await purchases[_0xcd1ca3(0x259)]({'invoice':_0x648deb});_0x4a2f04['product'][_0xcd1ca3(0x183)](_0x412232=>{var _0x4b874a=_0xcd1ca3,_0x30db6d=0x0;const _0xc999ab=_0x13c78e['product_details'][_0x4b874a(0x167)](_0x3dc01e=>{var _0x56aecb=_0x4b874a;_0x3dc01e[_0x56aecb(0x1f8)]==_0x412232[_0x56aecb(0x1f8)]&&_0x3dc01e[_0x56aecb(0x1c1)]==_0x412232['floorlevel']&&_0x3dc01e['type']==_0x412232[_0x56aecb(0x1fd)]&&_0x3dc01e[_0x56aecb(0x258)]==_0x412232[_0x56aecb(0x258)]&&_0x3dc01e[_0x56aecb(0x1f9)]==_0x412232[_0x56aecb(0x1f9)]&&_0x3dc01e[_0x56aecb(0x1d3)]==_0x412232['rack']&&_0x3dc01e[_0x56aecb(0x1ed)]==_0x412232[_0x56aecb(0x1ed)]&&_0x3dc01e[_0x56aecb(0x186)]==_0x412232['expiry_date']&&_0x3dc01e['batch_code']==_0x412232[_0x56aecb(0x1b6)]&&_0x3dc01e[_0x56aecb(0x1c7)]==_0x412232[_0x56aecb(0x1c7)]&&_0x3dc01e[_0x56aecb(0x27d)]==_0x412232[_0x56aecb(0x27d)]&&_0x3dc01e[_0x56aecb(0x232)]==_0x412232['delivery_code']&&(_0x3dc01e['product_stock']=parseInt(_0x3dc01e['product_stock'])+parseInt(_0x412232[_0x56aecb(0x24e)]),_0x30db6d++);});_0x30db6d=='0'&&(_0x13c78e[_0x4b874a(0x196)]=_0x13c78e['product_details']['concat']({'product_name':_0x412232[_0x4b874a(0x1f8)],'product_stock':_0x412232['quantity'],'primary_code':_0x412232[_0x4b874a(0x185)],'secondary_code':_0x412232[_0x4b874a(0x1f3)],'product_code':_0x412232[_0x4b874a(0x22f)],'storage':_0x412232[_0x4b874a(0x1ed)],'rack':_0x412232['rack'],'bay':_0x412232['bay'],'bin':_0x412232['bin'],'type':_0x412232['type'],'floorlevel':_0x412232[_0x4b874a(0x1c1)],'maxProducts':_0x412232['maxStocks'],'unit':_0x412232[_0x4b874a(0x243)],'secondary_unit':_0x412232['secondary_unit'],'expiry_date':_0x412232['expiry_date'],'maxPerUnit':_0x412232[_0x4b874a(0x1ef)],'batch_code':_0x412232[_0x4b874a(0x1b6)],'alertQTY':_0x412232['alertQTY'],'production_date':_0x412232[_0x4b874a(0x1c7)],'delivery_date':_0x412232['delivery_date'],'delivery_code':_0x412232['delivery_code']}));}),await _0x13c78e['save'](),_0x4a2f04[_0xcd1ca3(0x27e)]=_0xcd1ca3(0x191);const _0xd453e0=await _0x4a2f04[_0xcd1ca3(0x1d7)]();_0x49e204[_0xcd1ca3(0x22b)]('success',_0xcd1ca3(0x17a)),_0x1582d7[_0xcd1ca3(0x1e8)](_0xcd1ca3(0x1d8));}catch(_0x3c41e4){console['log'](_0x3c41e4);}}),router[a0_0xae0fc2(0x1cc)]('/view/:id',auth,async(_0x974b14,_0x15ef4a)=>{var _0x44bf32=a0_0xae0fc2;try{const {username:_0x2cac80,email:_0x34af69,role:_0x1b10d4}=_0x974b14[_0x44bf32(0x188)],_0x5a013a=_0x974b14[_0x44bf32(0x188)],_0x259384=await profile[_0x44bf32(0x259)]({'email':_0x5a013a[_0x44bf32(0x215)]}),_0x4fd70c=await master_shop[_0x44bf32(0x222)](),_0x317da0=_0x974b14[_0x44bf32(0x17e)]['id'],_0x22d366=await purchases[_0x44bf32(0x220)](_0x317da0),_0xbcf6ca=await suppliers[_0x44bf32(0x222)]({});let _0x53977e;if(_0x5a013a['role']==_0x44bf32(0x233)){const _0x20e2fa=await staff[_0x44bf32(0x259)]({'email':_0x5a013a[_0x44bf32(0x215)]});_0x53977e=await warehouse['find']({'status':'Enabled','name':_0x20e2fa[_0x44bf32(0x16c)],'warehouse_category':_0x44bf32(0x246)});}else _0x53977e=await warehouse['aggregate']([{'$match':{'status':_0x44bf32(0x19e),'warehouse_category':_0x44bf32(0x246)}},{'$group':{'_id':_0x44bf32(0x241),'name':{'$first':_0x44bf32(0x241)}}}]);const _0x395f3f=await product[_0x44bf32(0x222)]({}),_0xbfdbac=BayBinSelected(_0x22d366['warehouse_name'],_0x22d366[_0x44bf32(0x25d)]);let _0x5a8fd9=new Date(_0x22d366[_0x44bf32(0x186)]),_0x4aa5e3=('0'+_0x5a8fd9[_0x44bf32(0x1de)]())[_0x44bf32(0x25e)](-0x2),_0x5bf76f=('0'+(_0x5a8fd9[_0x44bf32(0x194)]()+0x1))[_0x44bf32(0x25e)](-0x2),_0xacf018=_0x5a8fd9['getFullYear'](),_0x24910c=_0xacf018+'-'+_0x5bf76f+'-'+_0x4aa5e3;if(_0x4fd70c[0x0]['language']=='English\x20(US)'){var _0x3a4bee=users[_0x44bf32(0x23a)];console[_0x44bf32(0x177)](_0x3a4bee);}else{if(_0x4fd70c[0x0][_0x44bf32(0x228)]=='Hindi')var _0x3a4bee=users[_0x44bf32(0x1a1)];else{if(_0x4fd70c[0x0]['language']==_0x44bf32(0x1d9))var _0x3a4bee=users[_0x44bf32(0x1d9)];else{if(_0x4fd70c[0x0][_0x44bf32(0x228)]=='Spanish')var _0x3a4bee=users[_0x44bf32(0x1a6)];else{if(_0x4fd70c[0x0][_0x44bf32(0x228)]==_0x44bf32(0x21a))var _0x3a4bee=users[_0x44bf32(0x21a)];else{if(_0x4fd70c[0x0][_0x44bf32(0x228)]==_0x44bf32(0x16a))var _0x3a4bee=users[_0x44bf32(0x254)];else{if(_0x4fd70c[0x0][_0x44bf32(0x228)]==_0x44bf32(0x1d4))var _0x3a4bee=users['Chinese'];else{if(_0x4fd70c[0x0][_0x44bf32(0x228)]==_0x44bf32(0x18e))var _0x3a4bee=users[_0x44bf32(0x1ca)];}}}}}}}_0x15ef4a[_0x44bf32(0x17f)](_0x44bf32(0x216),{'success':_0x974b14['flash'](_0x44bf32(0x22c)),'errors':_0x974b14[_0x44bf32(0x22b)]('errors'),'role':_0x5a013a,'profile':_0x259384,'purchases':_0x22d366,'suppliers':_0xbcf6ca,'warehouse':_0x53977e,'product':_0x395f3f,'master_shop':_0x4fd70c,'language':_0x3a4bee,'ed_fullDate':_0x24910c,'dataSelected':_0xbfdbac});}catch(_0x4b554a){console[_0x44bf32(0x177)](_0x4b554a);}}),router[a0_0xae0fc2(0x18f)](a0_0xae0fc2(0x267),auth,async(_0x1a42a1,_0x174eb1)=>{var _0x9b26b0=a0_0xae0fc2;try{const _0x49bf84=_0x1a42a1['params']['id'],_0x596293=await purchases[_0x9b26b0(0x259)]({'_id':_0x1a42a1[_0x9b26b0(0x17e)]['id']}),_0x33c20f=await warehouse['findOne']({'name':_0x596293[_0x9b26b0(0x1ab)],'room':_0x596293[_0x9b26b0(0x25d)]});_0x596293[_0x9b26b0(0x16d)]['forEach'](_0x60d475=>{var _0x3342bb=_0x9b26b0;const _0x3473b2=_0x33c20f[_0x3342bb(0x196)][_0x3342bb(0x167)](_0x5b0987=>{var _0x442c90=_0x3342bb;_0x5b0987[_0x442c90(0x1f8)]==_0x60d475['product_name']&&_0x5b0987[_0x442c90(0x1c1)]==_0x60d475[_0x442c90(0x1c1)]&&_0x5b0987['type']==_0x60d475[_0x442c90(0x1fd)]&&_0x5b0987[_0x442c90(0x258)]==_0x60d475[_0x442c90(0x258)]&&_0x5b0987[_0x442c90(0x1f9)]==_0x60d475[_0x442c90(0x1f9)]&&_0x5b0987['rack']==_0x60d475['rack']&&_0x5b0987['storage']==_0x60d475[_0x442c90(0x1ed)]&&(_0x5b0987['product_stock']=parseInt(_0x5b0987['product_stock'])-parseInt(_0x60d475[_0x442c90(0x24e)]));});}),await _0x33c20f[_0x9b26b0(0x1d7)]();const {invoice:_0x348f2d,suppliers:_0x3375f0,date:_0x1a70a6,warehouse_name:_0x2dabe8,prod_name:_0x31fe3e,prod_code:_0x10d2c6,prod_qty:_0x229e20,prod_unit:_0x4df2c6,prod_secondunit:_0x4986e7,prod_level:_0x1da860,prod_isle:_0xfef61b,prod_pallet:_0x1c06c7,note:_0x54fd19,expiry_date:_0x28895a,batch_code:_0x1882e5,paid_amount:_0x30754d,due_amount:_0x31fd20,Room_name:_0x5bc206,primary_code:_0x2c485f,secondary_code:_0x30a104,PO_number:_0x1571c9,JO_number:_0x5bd8de}=_0x1a42a1['body'];if(typeof _0x31fe3e==_0x9b26b0(0x25b))var _0x36b62b=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x199)]],_0x2bc3c4=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1ae)]],_0xdb86ba=[_0x1a42a1['body'][_0x9b26b0(0x24d)]],_0x4dcfcf=[_0x1a42a1[_0x9b26b0(0x26b)]['prod_unit']],_0x5de20b=[_0x1a42a1[_0x9b26b0(0x26b)]['prod_secondunit']],_0x3d89dd=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1dc)]],_0x2af62b=[_0x1a42a1[_0x9b26b0(0x26b)]['prod_isle']],_0x3b5a41=[_0x1a42a1['body']['prod_pallet']],_0x5bfb03=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x185)]],_0x38d20a=[_0x1a42a1['body'][_0x9b26b0(0x1f3)]],_0x5a0343=[_0x1a42a1['body']['MaxStocks_data']],_0x103408=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1b6)]],_0x1dfffa=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x186)]],_0x29493b=[_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1ed)]],_0x2e0abf=[_0x1a42a1[_0x9b26b0(0x26b)]['rak']],_0x5e35a6=[_0x1a42a1[_0x9b26b0(0x26b)]['type']];else var _0x36b62b=[..._0x1a42a1[_0x9b26b0(0x26b)]['prod_name']],_0x2bc3c4=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1ae)]],_0xdb86ba=[..._0x1a42a1['body'][_0x9b26b0(0x24d)]],_0x4dcfcf=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1c2)]],_0x5de20b=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x20b)]],_0x3d89dd=[..._0x1a42a1['body'][_0x9b26b0(0x1dc)]],_0x2af62b=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x25a)]],_0x3b5a41=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x219)]],_0x5bfb03=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x185)]],_0x38d20a=[..._0x1a42a1[_0x9b26b0(0x26b)]['secondary_code']],_0x5a0343=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x211)]],_0x103408=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1b6)]],_0x1dfffa=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x186)]],_0x29493b=[..._0x1a42a1[_0x9b26b0(0x26b)]['storage']],_0x2e0abf=[..._0x1a42a1[_0x9b26b0(0x26b)]['rak']],_0x5e35a6=[..._0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1fd)]];const _0x37eadb=_0x36b62b[_0x9b26b0(0x167)](_0x8f3f2f=>{return _0x8f3f2f={'product_name':_0x8f3f2f};});_0x2bc3c4[_0x9b26b0(0x183)]((_0x7bf54c,_0x11b7a4)=>{_0x37eadb[_0x11b7a4]['product_code']=_0x7bf54c;}),_0xdb86ba[_0x9b26b0(0x183)]((_0x45eb9c,_0x56cf6c)=>{var _0x1c2d1f=_0x9b26b0;_0x37eadb[_0x56cf6c][_0x1c2d1f(0x24e)]=_0x45eb9c;}),_0x4dcfcf[_0x9b26b0(0x183)]((_0x202cbc,_0x173b49)=>{_0x37eadb[_0x173b49]['standard_unit']=_0x202cbc;}),_0x5de20b[_0x9b26b0(0x183)]((_0x350549,_0x320fe2)=>{var _0x5bedf2=_0x9b26b0;_0x37eadb[_0x320fe2][_0x5bedf2(0x174)]=_0x350549;}),_0x3d89dd['forEach']((_0x5c979a,_0x567558)=>{_0x37eadb[_0x567558]['bay']=_0x5c979a;}),_0x2af62b[_0x9b26b0(0x183)]((_0x46d73c,_0x27c1f7)=>{_0x37eadb[_0x27c1f7]['bin']=_0x46d73c;}),_0x3b5a41['forEach']((_0x2fb644,_0x3ef9e4)=>{var _0x176404=_0x9b26b0;_0x37eadb[_0x3ef9e4][_0x176404(0x1c1)]=_0x2fb644;}),_0x5bfb03[_0x9b26b0(0x183)]((_0x2e0b32,_0x5e47a3)=>{var _0x3d5bfe=_0x9b26b0;_0x37eadb[_0x5e47a3][_0x3d5bfe(0x185)]=_0x2e0b32;}),_0x38d20a[_0x9b26b0(0x183)]((_0x33ec2c,_0x3748ef)=>{_0x37eadb[_0x3748ef]['secondary_code']=_0x33ec2c;}),_0x5a0343['forEach']((_0x24610a,_0x2062ea)=>{var _0x22c667=_0x9b26b0;_0x37eadb[_0x2062ea][_0x22c667(0x192)]=_0x24610a;}),_0x103408['forEach']((_0x2997be,_0x1f8b85)=>{var _0x1f4ebf=_0x9b26b0;_0x37eadb[_0x1f8b85][_0x1f4ebf(0x1b6)]=_0x2997be;}),_0x1dfffa['forEach']((_0xc26dad,_0x2124b0)=>{_0x37eadb[_0x2124b0]['expiry_date']=_0xc26dad;}),_0x5e35a6[_0x9b26b0(0x183)]((_0xe70bd6,_0x4a3d38)=>{var _0x180a0d=_0x9b26b0;_0x37eadb[_0x4a3d38][_0x180a0d(0x1fd)]=_0xe70bd6;}),_0x29493b[_0x9b26b0(0x183)]((_0x12ff41,_0x12cb49)=>{_0x37eadb[_0x12cb49]['storage']=_0x12ff41;}),_0x2e0abf[_0x9b26b0(0x183)]((_0x35fd44,_0x5d1ab6)=>{var _0x83e4cc=_0x9b26b0;_0x37eadb[_0x5d1ab6][_0x83e4cc(0x1d3)]=_0x35fd44;});const _0x3c1c55=_0x37eadb[_0x9b26b0(0x200)](_0x5826db=>_0x5826db[_0x9b26b0(0x24e)]!=='0'&&_0x5826db[_0x9b26b0(0x24e)]!=='');_0x596293[_0x9b26b0(0x19b)]=_0x348f2d,_0x596293[_0x9b26b0(0x1fe)]=_0x3375f0,_0x596293['date']=_0x1a70a6,_0x596293['warehouse_name']=_0x2dabe8,_0x596293[_0x9b26b0(0x16d)]=_0x3c1c55,_0x596293[_0x9b26b0(0x1e5)]=_0x54fd19,_0x596293[_0x9b26b0(0x22e)]=_0x30754d,_0x596293[_0x9b26b0(0x1be)]=_0x31fd20,_0x596293[_0x9b26b0(0x25d)]=_0x5bc206,_0x596293[_0x9b26b0(0x21f)]=_0x1571c9,_0x596293[_0x9b26b0(0x1f6)]=_0x5bd8de;const _0x35db5b=await _0x596293['save'](),_0x311bde=await warehouse[_0x9b26b0(0x259)]({'name':_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1ab)],'room':_0x1a42a1[_0x9b26b0(0x26b)]['Room_name']});_0x596293[_0x9b26b0(0x16d)]['forEach'](_0x3287d8=>{var _0x38566a=_0x9b26b0,_0x41f4b8=0x0;const _0x1e0e53=_0x311bde[_0x38566a(0x196)][_0x38566a(0x167)](_0x464cd2=>{var _0x2c81e0=_0x38566a;_0x464cd2[_0x2c81e0(0x1f8)]==_0x3287d8[_0x2c81e0(0x1f8)]&&_0x464cd2[_0x2c81e0(0x1c1)]==_0x3287d8['floorlevel']&&_0x464cd2[_0x2c81e0(0x1fd)]==_0x3287d8[_0x2c81e0(0x1fd)]&&_0x464cd2['bin']==_0x3287d8[_0x2c81e0(0x258)]&&_0x464cd2[_0x2c81e0(0x1f9)]==_0x3287d8[_0x2c81e0(0x1f9)]&&_0x464cd2[_0x2c81e0(0x1d3)]==_0x3287d8['rack']&&_0x464cd2[_0x2c81e0(0x1ed)]==_0x3287d8['storage']&&(_0x464cd2[_0x2c81e0(0x257)]=parseInt(_0x464cd2['product_stock'])+parseInt(_0x3287d8['quantity']),_0x41f4b8++);});_0x41f4b8=='0'&&(_0x311bde[_0x38566a(0x196)]=_0x311bde['product_details'][_0x38566a(0x1e0)]({'product_name':_0x3287d8[_0x38566a(0x1f8)],'product_stock':_0x3287d8[_0x38566a(0x24e)],'primary_code':_0x3287d8['primary_code'],'secondary_code':_0x3287d8[_0x38566a(0x1f3)],'product_code':_0x3287d8[_0x38566a(0x22f)],'storage':_0x3287d8[_0x38566a(0x1ed)],'rack':_0x3287d8['rack'],'bay':_0x3287d8[_0x38566a(0x1f9)],'bin':_0x3287d8[_0x38566a(0x258)],'type':_0x3287d8[_0x38566a(0x1fd)],'floorlevel':_0x3287d8[_0x38566a(0x1c1)],'maxProducts':_0x3287d8[_0x38566a(0x192)],'unit':_0x3287d8[_0x38566a(0x243)],'secondary_unit':_0x3287d8[_0x38566a(0x174)],'expiry_date':_0x3287d8['expiry_date']}));}),await _0x311bde[_0x9b26b0(0x1d7)]();const _0x129f17=await s_payment_data['findOne']({'invoice':_0x1a42a1[_0x9b26b0(0x26b)]['invoice']});if(_0x129f17===null){}else console[_0x9b26b0(0x177)](_0x9b26b0(0x1fe),_0x129f17,_0x1a42a1['body'][_0x9b26b0(0x19b)]),_0x129f17[_0x9b26b0(0x1fe)]=_0x1a42a1[_0x9b26b0(0x26b)][_0x9b26b0(0x1fe)],await _0x129f17[_0x9b26b0(0x1d7)]();_0x1a42a1[_0x9b26b0(0x22b)](_0x9b26b0(0x22c),_0x9b26b0(0x224)),_0x174eb1[_0x9b26b0(0x1e8)](_0x9b26b0(0x1d8));}catch(_0x5a8ab6){console[_0x9b26b0(0x177)](_0x5a8ab6);}}),router[a0_0xae0fc2(0x18f)](a0_0xae0fc2(0x1f5),auth,async(_0x6d4ac2,_0x29ac05)=>{var _0x167ce0=a0_0xae0fc2;try{const _0x533ce1=_0x6d4ac2[_0x167ce0(0x17e)]['id'],{invoice:_0x1a57ad,suppliers:_0x508065,payable:_0x44d04e,due_amount:_0x24640f}=_0x6d4ac2[_0x167ce0(0x26b)],_0x1f45aa=await purchases['findById'](_0x533ce1);var _0x12c2da=_0x44d04e-_0x24640f;_0x1f45aa[_0x167ce0(0x22e)]=parseFloat(_0x1f45aa[_0x167ce0(0x22e)])+parseFloat(_0x24640f),_0x1f45aa[_0x167ce0(0x1be)]=_0x12c2da;const _0x45f9d5=await _0x1f45aa[_0x167ce0(0x1d7)]();console[_0x167ce0(0x177)](_0x45f9d5);const _0xed51a9=await s_payment_data[_0x167ce0(0x259)]({'invoice':_0x1a57ad});_0xed51a9[_0x167ce0(0x193)]=_0x12c2da,await _0xed51a9['save']();let _0x140fbc=new Date(),_0x30b8aa=('0'+_0x140fbc[_0x167ce0(0x1de)]())[_0x167ce0(0x25e)](-0x2),_0x5ece05=('0'+(_0x140fbc[_0x167ce0(0x194)]()+0x1))[_0x167ce0(0x25e)](-0x2),_0x233721=_0x140fbc[_0x167ce0(0x261)](),_0x1ddb9d=_0x233721+'-'+_0x5ece05+'-'+_0x30b8aa;const _0x2ac5e8=new suppliers_payment({'invoice':_0x1a57ad,'date':_0x233721+'-'+_0x5ece05+'-'+_0x30b8aa,'suppliers':_0x508065,'reason':'Paid\x20For\x20Purchase','amount':_0x24640f}),_0x3b4bfe=await _0x2ac5e8[_0x167ce0(0x1d7)]();_0x6d4ac2[_0x167ce0(0x22b)](_0x167ce0(0x22c),_0x167ce0(0x274)),_0x29ac05[_0x167ce0(0x1e8)](_0x167ce0(0x1d8));}catch(_0x41d6a1){console[_0x167ce0(0x177)](_0x41d6a1);}}),router['get']('/invoice/:id',auth,async(_0x43a896,_0x537eb8)=>{var _0x3e62b2=a0_0xae0fc2;try{const {username:_0x46c5f1,email:_0x5f0e30,role:_0x306745}=_0x43a896['user'],_0x4ac15b=_0x43a896[_0x3e62b2(0x188)],_0x3c15f5=await profile[_0x3e62b2(0x259)]({'email':_0x4ac15b[_0x3e62b2(0x215)]}),_0x415511=await master_shop['find']();console[_0x3e62b2(0x177)](_0x3e62b2(0x23d),_0x415511);const _0x391f31=_0x43a896['params']['id'],_0x1335fc=await purchases[_0x3e62b2(0x220)](_0x391f31);console[_0x3e62b2(0x177)](_0x1335fc);const _0x4db093=await suppliers[_0x3e62b2(0x259)]({'name':_0x1335fc[_0x3e62b2(0x1fe)]});console[_0x3e62b2(0x177)](_0x4db093);if(_0x415511[0x0][_0x3e62b2(0x228)]==_0x3e62b2(0x277)){var _0x3d90cf=users[_0x3e62b2(0x23a)];console[_0x3e62b2(0x177)](_0x3d90cf);}else{if(_0x415511[0x0][_0x3e62b2(0x228)]==_0x3e62b2(0x1a1))var _0x3d90cf=users['Hindi'];else{if(_0x415511[0x0][_0x3e62b2(0x228)]==_0x3e62b2(0x1d9))var _0x3d90cf=users[_0x3e62b2(0x1d9)];else{if(_0x415511[0x0]['language']=='Spanish')var _0x3d90cf=users['Spanish'];else{if(_0x415511[0x0]['language']=='French')var _0x3d90cf=users['French'];else{if(_0x415511[0x0][_0x3e62b2(0x228)]=='Portuguese\x20(BR)')var _0x3d90cf=users[_0x3e62b2(0x254)];else{if(_0x415511[0x0]['language']=='Chinese')var _0x3d90cf=users['Chinese'];else{if(_0x415511[0x0][_0x3e62b2(0x228)]==_0x3e62b2(0x18e))var _0x3d90cf=users['Arabic'];}}}}}}}_0x537eb8[_0x3e62b2(0x17f)](_0x3e62b2(0x271),{'success':_0x43a896[_0x3e62b2(0x22b)](_0x3e62b2(0x22c)),'errors':_0x43a896[_0x3e62b2(0x22b)](_0x3e62b2(0x16f)),'role':_0x4ac15b,'profile':_0x3c15f5,'master_shop':_0x415511,'supplier':_0x4db093,'purchase':_0x1335fc,'language':_0x3d90cf});}catch(_0x50fbe5){console[_0x3e62b2(0x177)](_0x50fbe5);}}),router[a0_0xae0fc2(0x1cc)](a0_0xae0fc2(0x1a2),auth,async(_0xb2f87b,_0x5cfb62)=>{var _0x57d142=a0_0xae0fc2;try{const {username:_0x2eca8b,email:_0x296172,role:_0x26b6d2}=_0xb2f87b['user'],_0x359877=_0xb2f87b['user'],_0x4aeb31=await profile[_0x57d142(0x259)]({'email':_0x359877[_0x57d142(0x215)]}),_0x3a3068=await master_shop[_0x57d142(0x222)]();console['log'](_0x57d142(0x23d),_0x3a3068);const _0x4e6cd1=_0xb2f87b[_0x57d142(0x17e)]['id'];console['log'](_0x4e6cd1);const _0xcbaaf2=await purchases[_0x57d142(0x220)](_0x4e6cd1);console[_0x57d142(0x177)]('user_id',_0xcbaaf2);const _0x545a01=await product['find']({}),_0x1bd1da=await warehouse[_0x57d142(0x19f)]([{'$match':{'name':_0xcbaaf2[_0x57d142(0x1ab)],'room':_0xcbaaf2[_0x57d142(0x25d)],'warehouse_category':_0x57d142(0x246)}},{'$unwind':_0x57d142(0x238)},{'$group':{'_id':_0x57d142(0x19c),'name':{'$first':_0x57d142(0x229)},'product_stock':{'$first':_0x57d142(0x270)},'bay':{'$first':_0x57d142(0x253)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x57d142(0x25f)},'floorlevel':{'$first':_0x57d142(0x16e)},'primary_code':{'$first':_0x57d142(0x20f)},'secondary_code':{'$first':_0x57d142(0x180)},'product_code':{'$first':_0x57d142(0x1af)},'storage':{'$first':_0x57d142(0x20a)},'rack':{'$first':_0x57d142(0x24c)}}}]);warehouse_data=await warehouse[_0x57d142(0x19f)]([{'$match':{'status':_0x57d142(0x19e),'name':_0x57d142(0x248),'warehouse_category':_0x57d142(0x246)}},{'$group':{'_id':'$name','name':{'$first':_0x57d142(0x241)}}},{'$sort':{'name':0x1}}]),console[_0x57d142(0x177)](_0x57d142(0x1eb),_0x1bd1da);if(_0x3a3068[0x0]['language']==_0x57d142(0x277)){var _0x522419=users[_0x57d142(0x23a)];console[_0x57d142(0x177)](_0x522419);}else{if(_0x3a3068[0x0][_0x57d142(0x228)]==_0x57d142(0x1a1))var _0x522419=users['Hindi'];else{if(_0x3a3068[0x0][_0x57d142(0x228)]==_0x57d142(0x1d9))var _0x522419=users[_0x57d142(0x1d9)];else{if(_0x3a3068[0x0]['language']==_0x57d142(0x1a6))var _0x522419=users[_0x57d142(0x1a6)];else{if(_0x3a3068[0x0][_0x57d142(0x228)]==_0x57d142(0x21a))var _0x522419=users[_0x57d142(0x21a)];else{if(_0x3a3068[0x0][_0x57d142(0x228)]==_0x57d142(0x16a))var _0x522419=users[_0x57d142(0x254)];else{if(_0x3a3068[0x0]['language']==_0x57d142(0x1d4))var _0x522419=users[_0x57d142(0x1d4)];else{if(_0x3a3068[0x0][_0x57d142(0x228)]==_0x57d142(0x18e))var _0x522419=users['Arabic'];}}}}}}}_0x5cfb62[_0x57d142(0x17f)](_0x57d142(0x244),{'success':_0xb2f87b[_0x57d142(0x22b)]('success'),'errors':_0xb2f87b[_0x57d142(0x22b)](_0x57d142(0x16f)),'role':_0x359877,'profile':_0x4aeb31,'user':_0xcbaaf2,'stock':_0x1bd1da,'master_shop':_0x3a3068,'product':_0x545a01,'language':_0x522419,'warehouse':warehouse_data});}catch(_0x3fa269){console[_0x57d142(0x177)](_0x3fa269);}}),router[a0_0xae0fc2(0x18f)](a0_0xae0fc2(0x1a2),auth,async(_0x1be8e8,_0x4a4b73)=>{var _0x347094=a0_0xae0fc2;try{const {invoice:_0xe6aeaf,date:_0x365885,warehouse_name:_0x1dceec,Room_name:_0xc74cf0,product_name:_0x5c5c57,purchase_quantity:_0x3b27b5,stocks:_0x59eb34,return_qty:_0x30cb5f,note:_0x137652,level:_0x20eace,isle:_0x5c9f54,pallet:_0x29e99e,to_warehouse_name:_0x39ae87,to_Room_name:_0x175501}=_0x1be8e8[_0x347094(0x26b)],_0x5ef30e=await purchases['findOne']({'_id':_0x1be8e8['params']['id']}),_0x40dedc=await warehouse[_0x347094(0x259)]({'name':_0x1dceec,'room':_0xc74cf0});if(typeof _0x5c5c57==_0x347094(0x25b))var _0x1f6bec=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x1f8)]],_0x5d8702=[_0x1be8e8['body'][_0x347094(0x1fb)]],_0x36366c=[_0x1be8e8[_0x347094(0x26b)]['stocks']],_0x58431b=[_0x1be8e8[_0x347094(0x26b)]['return_qty']],_0x4aad37=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x226)]],_0xeab148=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x249)]],_0x28d0d6=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x202)]],_0x35848b=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x217)]],_0x550440=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x1c5)]],_0x6f14bc=[_0x1be8e8['body']['primary_code_hide']],_0x29d533=[_0x1be8e8[_0x347094(0x26b)][_0x347094(0x1b7)]];else var _0x1f6bec=[..._0x1be8e8['body']['product_name']],_0x5d8702=[..._0x1be8e8['body'][_0x347094(0x1fb)]],_0x36366c=[..._0x1be8e8['body']['stocks']],_0x58431b=[..._0x1be8e8['body'][_0x347094(0x214)]],_0x4aad37=[..._0x1be8e8[_0x347094(0x26b)][_0x347094(0x226)]],_0xeab148=[..._0x1be8e8[_0x347094(0x26b)][_0x347094(0x249)]],_0x28d0d6=[..._0x1be8e8['body'][_0x347094(0x202)]],_0x35848b=[..._0x1be8e8[_0x347094(0x26b)][_0x347094(0x217)]],_0x550440=[..._0x1be8e8[_0x347094(0x26b)][_0x347094(0x1c5)]],_0x6f14bc=[..._0x1be8e8[_0x347094(0x26b)][_0x347094(0x19a)]],_0x29d533=[..._0x1be8e8[_0x347094(0x26b)][_0x347094(0x1b7)]];const _0x57affd=_0x1f6bec['map'](_0xda7cfc=>{return _0xda7cfc={'product_name':_0xda7cfc};});_0x5d8702['forEach']((_0x3c1c63,_0x54e7a0)=>{var _0x193720=_0x347094;_0x57affd[_0x54e7a0][_0x193720(0x1fb)]=_0x3c1c63;}),_0x36366c['forEach']((_0x53f9c0,_0x2eda52)=>{_0x57affd[_0x2eda52]['stock_quantity']=_0x53f9c0;}),_0x58431b[_0x347094(0x183)]((_0x22e17e,_0x181cfd)=>{var _0x3ceebb=_0x347094;_0x57affd[_0x181cfd][_0x3ceebb(0x214)]=_0x22e17e;}),_0x4aad37[_0x347094(0x183)]((_0x4d6224,_0x50ae44)=>{_0x57affd[_0x50ae44]['bay']=_0x4d6224;}),_0xeab148['forEach']((_0x33182e,_0x5d0d67)=>{var _0x48dd54=_0x347094;_0x57affd[_0x5d0d67][_0x48dd54(0x258)]=_0x33182e;}),_0x28d0d6[_0x347094(0x183)]((_0x453063,_0x304cb9)=>{var _0x37e585=_0x347094;_0x57affd[_0x304cb9][_0x37e585(0x1c1)]=_0x453063;}),_0x35848b['forEach']((_0x42333e,_0x23f561)=>{var _0x84d1=_0x347094;_0x57affd[_0x23f561][_0x84d1(0x1fd)]=_0x42333e;}),_0x550440[_0x347094(0x183)]((_0x39b012,_0x22eb16)=>{var _0x5d3df3=_0x347094;_0x57affd[_0x22eb16][_0x5d3df3(0x22f)]=_0x39b012;}),_0x6f14bc[_0x347094(0x183)]((_0xd4ce03,_0x49588d)=>{var _0x155f68=_0x347094;_0x57affd[_0x49588d][_0x155f68(0x185)]=_0xd4ce03;}),_0x29d533[_0x347094(0x183)]((_0xcd9d44,_0x50c2fe)=>{_0x57affd[_0x50c2fe]['secondary_code']=_0xcd9d44;}),_0x5ef30e[_0x347094(0x16d)][_0x347094(0x183)](_0x3e20c2=>{var _0x172d9c=_0x347094;const _0x3ae2d4=_0x40dedc[_0x172d9c(0x196)][_0x172d9c(0x167)](_0x4130a7=>{var _0x5d1084=_0x172d9c;_0x4130a7[_0x5d1084(0x1f8)]==_0x3e20c2[_0x5d1084(0x1f8)]&&_0x4130a7[_0x5d1084(0x1c1)]==_0x3e20c2[_0x5d1084(0x1c1)]&&_0x4130a7[_0x5d1084(0x1fd)]==_0x3e20c2[_0x5d1084(0x1fd)]&&_0x4130a7['bin']==_0x3e20c2['bin']&&_0x4130a7[_0x5d1084(0x1f9)]==_0x3e20c2[_0x5d1084(0x1f9)]&&_0x4130a7['rack']==_0x3e20c2[_0x5d1084(0x1d3)]&&_0x4130a7[_0x5d1084(0x1ed)]==_0x3e20c2['storage']&&(console[_0x5d1084(0x177)](parseInt(_0x4130a7['product_stock'])+_0x5d1084(0x1b4)+parseInt(_0x3e20c2[_0x5d1084(0x24e)])),_0x4130a7[_0x5d1084(0x257)]=parseInt(_0x4130a7[_0x5d1084(0x257)])+parseInt(_0x3e20c2[_0x5d1084(0x24e)]));});}),await _0x40dedc[_0x347094(0x1d7)]();const _0x558503=_0x57affd[_0x347094(0x200)](_0x438122=>_0x438122['return_qty']!=='0'&&_0x438122['return_qty']!=='');var _0x2e2c69=0x0;_0x558503['forEach'](_0x2a5563=>{var _0x237686=_0x347094;console[_0x237686(0x177)](_0x237686(0x230),_0x2a5563),(parseInt(_0x2a5563[_0x237686(0x1fb)])<parseInt(_0x2a5563[_0x237686(0x214)])||parseInt(_0x2a5563[_0x237686(0x1a5)])<parseInt(_0x2a5563['return_qty']))&&_0x2e2c69++;});if(_0x2e2c69!=0x0)return _0x1be8e8[_0x347094(0x22b)](_0x347094(0x16f),_0x347094(0x1c4)),_0x4a4b73[_0x347094(0x1e8)](_0x347094(0x1f1));const _0x237396=new purchases_return({'invoice':_0xe6aeaf,'suppliers':_0x1be8e8['body'][_0x347094(0x1fe)],'date':_0x365885,'warehouse_name':_0x1dceec,'return_product':_0x558503,'note':_0x137652,'room':_0xc74cf0,'to_warehouse_name':_0x39ae87,'to_room':_0x175501}),_0x3685e2=await _0x237396[_0x347094(0x1d7)]();console[_0x347094(0x177)](_0x237396);const _0x1b9553=await purchases_return[_0x347094(0x259)]({'invoice':_0xe6aeaf}),_0x5dd3e8=await warehouse[_0x347094(0x259)]({'name':_0x39ae87,'room':_0x175501});_0x1b9553[_0x347094(0x247)]['forEach'](_0x4fe6bf=>{var _0x29d166=_0x347094,_0x263e0e=0x0;const _0x219f08=_0x5dd3e8[_0x29d166(0x196)][_0x29d166(0x167)](_0x17bf1b=>{var _0x15a67f=_0x29d166;_0x17bf1b[_0x15a67f(0x1f8)]==_0x4fe6bf[_0x15a67f(0x1f8)]&&_0x17bf1b[_0x15a67f(0x1c1)]==_0x4fe6bf['floorlevel']&&_0x17bf1b['type']==_0x4fe6bf[_0x15a67f(0x1fd)]&&_0x17bf1b[_0x15a67f(0x258)]==_0x4fe6bf['bin']&&_0x17bf1b[_0x15a67f(0x1f9)]==_0x4fe6bf[_0x15a67f(0x1f9)]&&(_0x17bf1b['product_stock']=parseInt(_0x17bf1b['product_stock'])-parseInt(_0x4fe6bf[_0x15a67f(0x214)]),_0x263e0e++);});_0x263e0e=='0'&&(_0x5dd3e8[_0x29d166(0x196)]=_0x5dd3e8[_0x29d166(0x196)][_0x29d166(0x1e0)]({'product_name':_0x4fe6bf[_0x29d166(0x1f8)],'product_stock':_0x4fe6bf[_0x29d166(0x214)],'primary_code':_0x4fe6bf[_0x29d166(0x185)],'secondary_code':_0x4fe6bf[_0x29d166(0x1f3)],'product_code':_0x4fe6bf[_0x29d166(0x22f)],'storage':_0x4fe6bf[_0x29d166(0x1ed)],'rack':_0x4fe6bf['rack'],'bay':_0x4fe6bf[_0x29d166(0x1f9)],'bin':_0x4fe6bf[_0x29d166(0x258)],'type':_0x4fe6bf[_0x29d166(0x1fd)],'floorlevel':_0x4fe6bf[_0x29d166(0x1c1)],'maxProducts':_0x4fe6bf['maxStocks'],'unit':_0x4fe6bf[_0x29d166(0x243)],'secondary_unit':_0x4fe6bf[_0x29d166(0x174)],'expiry_date':_0x4fe6bf['expiry_date']}));}),await _0x5dd3e8[_0x347094(0x1d7)]();const _0x360e6c=await purchases[_0x347094(0x259)]({'invoice':_0xe6aeaf});_0x360e6c[_0x347094(0x25c)]='True';const _0x6120ff=await _0x360e6c[_0x347094(0x1d7)](),_0x567e75=new s_payment_data({'invoice':_0xe6aeaf,'suppliers':_0x1be8e8[_0x347094(0x26b)][_0x347094(0x1fe)],'reason':'Purchase\x20Return'});await _0x567e75[_0x347094(0x1d7)]();const _0x410ce5=await master_shop[_0x347094(0x222)]();console[_0x347094(0x177)](_0x347094(0x1b5),_0x410ce5[0x0][_0x347094(0x265)]);const _0x2d649e=await email_settings['findOne'](),_0x5608a4=await suppliers[_0x347094(0x259)]({'name':_0x1be8e8[_0x347094(0x26b)]['suppliers']});console[_0x347094(0x177)](_0x347094(0x250),_0x5608a4);_0x410ce5[0x0]['currency_placement']==0x1?(right_currency=_0x410ce5[0x0][_0x347094(0x207)],left_currency=''):(right_currency='',left_currency=_0x410ce5[0x0][_0x347094(0x207)]);var _0x5c3e32=_0x1f6bec,_0x152842=_0x58431b,_0x4de190='',_0x473e38;for(_0x473e38 in _0x5c3e32){_0x4de190+='<tr>'+_0x347094(0x1e3)+_0x5c3e32[_0x473e38]+'</td>'+_0x347094(0x1e3)+_0x152842[_0x473e38]+_0x347094(0x175)+_0x347094(0x218);}console[_0x347094(0x177)]('product_list',_0x4de190);let _0x503918=nodemailer[_0x347094(0x1cb)]({'service':_0x347094(0x231),'auth':{'user':_0x2d649e[_0x347094(0x215)],'pass':_0x2d649e[_0x347094(0x1bd)]}}),_0x300dad={'from':_0x2d649e['email'],'to':_0x5608a4[_0x347094(0x215)],'subject':_0x347094(0x1bf),'attachments':[{'filename':_0x347094(0x189),'path':__dirname+'/../public'+_0x347094(0x1d5)+_0x410ce5[0x0][_0x347094(0x265)],'cid':_0x347094(0x1fc)}],'html':_0x347094(0x1f4)+'<html><head><title></title>'+_0x347094(0x1cd)+_0x347094(0x16b)+_0x347094(0x1cf)+_0x347094(0x16b)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x347094(0x16b)+'<h2>\x20'+_0x410ce5[0x0][_0x347094(0x26c)]+_0x347094(0x1e2)+_0x347094(0x1ac)+_0x347094(0x1ac)+'<hr\x20class=\x22my-3\x22>'+_0x347094(0x16b)+_0x347094(0x279)+_0x347094(0x263)+_0xe6aeaf+'\x20'+_0x347094(0x1e1)+_0x347094(0x1f0)+_0x365885+'\x20'+_0x347094(0x166)+_0x347094(0x1a0)+'</div>'+_0x347094(0x1d2)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x347094(0x208)+_0x347094(0x18b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>'+_0x347094(0x182)+_0x347094(0x1d6)+_0x347094(0x218)+'</thead>'+_0x347094(0x234)+'\x20'+_0x4de190+'\x20'+'</tbody>'+_0x347094(0x23e)+_0x347094(0x16b)+_0x347094(0x170)+_0x347094(0x1c3)+_0x410ce5[0x0][_0x347094(0x26c)]+_0x347094(0x1a0)+'</div>'+_0x347094(0x1ac)+_0x347094(0x26a)};_0x503918[_0x347094(0x20e)](_0x300dad,function(_0x4c200b,_0x1cfb61){var _0x1c41f7=_0x347094;_0x4c200b?(console[_0x1c41f7(0x177)](_0x4c200b),console[_0x1c41f7(0x177)](_0x1c41f7(0x235))):console[_0x1c41f7(0x177)](_0x1c41f7(0x1e6));}),_0x1be8e8[_0x347094(0x22b)](_0x347094(0x22c),_0x347094(0x240)),_0x4a4b73['redirect'](_0x347094(0x1d8));}catch(_0x28d932){console[_0x347094(0x177)](_0x28d932),_0x4a4b73[_0x347094(0x269)](0xc8)[_0x347094(0x278)]({'message':_0x28d932[_0x347094(0x23f)]});}}),router[a0_0xae0fc2(0x1cc)](a0_0xae0fc2(0x18d),auth,async(_0x4c004a,_0x230cce)=>{var _0x5c7be0=a0_0xae0fc2;try{const {username:_0x164b64,email:_0x29af13,role:_0x4e0c74}=_0x4c004a[_0x5c7be0(0x188)],_0x1142ac=_0x4c004a[_0x5c7be0(0x188)],_0x5b4366=await profile[_0x5c7be0(0x259)]({'email':_0x1142ac[_0x5c7be0(0x215)]}),_0x237170=await master_shop['find'](),_0x1a13cf=_0x4c004a['params']['id'],_0x3a2ca1=await purchases[_0x5c7be0(0x220)](_0x1a13cf);if(_0x237170[0x0][_0x5c7be0(0x228)]==_0x5c7be0(0x277))var _0x5d3028=users[_0x5c7be0(0x23a)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]=='Hindi')var _0x5d3028=users[_0x5c7be0(0x1a1)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]==_0x5c7be0(0x1d9))var _0x5d3028=users[_0x5c7be0(0x1d9)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]==_0x5c7be0(0x1a6))var _0x5d3028=users[_0x5c7be0(0x1a6)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]=='French')var _0x5d3028=users[_0x5c7be0(0x21a)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]==_0x5c7be0(0x16a))var _0x5d3028=users[_0x5c7be0(0x254)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]==_0x5c7be0(0x1d4))var _0x5d3028=users[_0x5c7be0(0x1d4)];else{if(_0x237170[0x0][_0x5c7be0(0x228)]==_0x5c7be0(0x18e))var _0x5d3028=users[_0x5c7be0(0x1ca)];}}}}}}}_0x230cce[_0x5c7be0(0x17f)](_0x5c7be0(0x201),{'success':_0x4c004a[_0x5c7be0(0x22b)](_0x5c7be0(0x22c)),'errors':_0x4c004a[_0x5c7be0(0x22b)](_0x5c7be0(0x16f)),'role':_0x1142ac,'profile':_0x5b4366,'alldata':_0x3a2ca1,'master_shop':_0x237170,'language':_0x5d3028}),console[_0x5c7be0(0x177)](alldata);}catch(_0x211f21){console[_0x5c7be0(0x177)](_0x211f21);}}),router[a0_0xae0fc2(0x18f)](a0_0xae0fc2(0x18c),async(_0xdc6dcd,_0x3540d4)=>{var _0x3f62ee=a0_0xae0fc2;const {product_code:_0x378077}=_0xdc6dcd[_0x3f62ee(0x26b)];var _0x338364;const _0x1a6d6d=await product[_0x3f62ee(0x19f)]([{'$match':{'primary_code':_0x378077,'product_category':_0x3f62ee(0x246)}},{'$group':{'_id':_0x3f62ee(0x1df),'name':{'$first':_0x3f62ee(0x241)},'category':{'$first':_0x3f62ee(0x17c)},'brand':{'$first':_0x3f62ee(0x1c6)},'unit':{'$first':_0x3f62ee(0x195)},'alertquantity':{'$first':_0x3f62ee(0x1d0)},'product_code':{'$first':_0x3f62ee(0x27c)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x3f62ee(0x173)},'maxStocks':{'$first':_0x3f62ee(0x22a)},'maxProdPerUnit':{'$first':_0x3f62ee(0x22d)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x3f62ee(0x1b3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x4a3b33=await product[_0x3f62ee(0x19f)]([{'$match':{'secondary_code':_0x378077,'product_category':_0x3f62ee(0x246)}},{'$group':{'_id':'$_id','name':{'$first':_0x3f62ee(0x241)},'category':{'$first':'$category'},'brand':{'$first':_0x3f62ee(0x1c6)},'unit':{'$first':_0x3f62ee(0x195)},'alertquantity':{'$first':'$alertquantity'},'product_code':{'$first':_0x3f62ee(0x27c)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x3f62ee(0x22a)},'maxProdPerUnit':{'$first':_0x3f62ee(0x22d)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x1a6d6d[_0x3f62ee(0x221)]>0x0)_0x338364=_0x1a6d6d;else _0x4a3b33[_0x3f62ee(0x221)]>0x0&&(_0x338364=_0x4a3b33);_0x3540d4['json'](_0x338364);}),router['post'](a0_0xae0fc2(0x242),async(_0x510aab,_0xd9d84)=>{var _0x446dcc=a0_0xae0fc2;const {primaryCode:_0x42503e,secondaryCode:_0x585b01,productCode:_0xa89ace,bay:_0x13c6b6,bin:_0x20a2f4,types:_0x41e516,pallet:_0x1009dc,warehouses:_0x109640,room:_0xcf0d0f}=_0x510aab[_0x446dcc(0x26b)];console[_0x446dcc(0x177)](_0x510aab['body']);try{const _0x1c9c06=await warehouse[_0x446dcc(0x19f)]([{'$match':{'name':_0x109640,'room':_0xcf0d0f}},{'$unwind':_0x446dcc(0x238)},{'$match':{'product_details.bay':_0x13c6b6,'product_details.bin':_0x20a2f4,'product_details.type':_0x41e516}},{'$group':{'_id':_0x446dcc(0x19c),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x446dcc(0x264)},'pallet':{'$first':_0x446dcc(0x203)},'maxProducts':{'$first':_0x446dcc(0x225)}}}]);_0xd9d84[_0x446dcc(0x269)](0xc8)[_0x446dcc(0x278)](_0x1c9c06);}catch(_0x7792f7){_0xd9d84[_0x446dcc(0x269)](0x194)['json']({'message':_0x7792f7[_0x446dcc(0x23f)]});}}),module[a0_0xae0fc2(0x1b9)]=router;