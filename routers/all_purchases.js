var a0_0x34c840=a0_0x3172;(function(_0x4cf238,_0x4c0797){var _0x5509a1=a0_0x3172,_0x173dac=_0x4cf238();while(!![]){try{var _0x3d7e30=parseInt(_0x5509a1(0x23b))/0x1*(parseInt(_0x5509a1(0x278))/0x2)+-parseInt(_0x5509a1(0x1f6))/0x3*(-parseInt(_0x5509a1(0x28f))/0x4)+-parseInt(_0x5509a1(0x244))/0x5+parseInt(_0x5509a1(0x2c3))/0x6+-parseInt(_0x5509a1(0x249))/0x7*(parseInt(_0x5509a1(0x2aa))/0x8)+parseInt(_0x5509a1(0x225))/0x9+-parseInt(_0x5509a1(0x279))/0xa;if(_0x3d7e30===_0x4c0797)break;else _0x173dac['push'](_0x173dac['shift']());}catch(_0x49e1bc){_0x173dac['push'](_0x173dac['shift']());}}}(a0_0x4aa8,0xb94fe));const express=require(a0_0x34c840(0x213)),app=express(),router=express[a0_0x34c840(0x25f)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x34c840(0x1ee)),auth=require('../middleware/auth'),nodemailer=require('nodemailer');function a0_0x3172(_0x4738f1,_0x184963){var _0x4aa853=a0_0x4aa8();return a0_0x3172=function(_0x31729d,_0x1af002){_0x31729d=_0x31729d-0x1cd;var _0x81c86=_0x4aa853[_0x31729d];return _0x81c86;},a0_0x3172(_0x4738f1,_0x184963);}var ejs=require(a0_0x34c840(0x1f3));function a0_0x4aa8(){var _0x5813e6=['findById','$brand','warehouse_name','prod_cat','params','Purchase\x20data\x20added\x20successfully','$return_data','<span\x20style=\x22float:\x20right;\x22>','$product_details','$product.quantity','MaxStocks_data','room_name','string','prod_qty','French','user','type','/view/return_purchase/:id','Router','prod_invoice','Raw\x20Materials','$name','</td>','prod_pallet','secondary_code','due_amount','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<hr\x20class=\x22my-3\x22>','DRY\x20STORAGE','aggregate','<tr>','RMSEmail','production_date','error','</div>','Rack\x20B','\x20Order\x20Number\x20:\x20','return_purchase','/preview/:id','padStart','path','<div>','/view/:id','2418350BPfbRr','3371490eDTlmz','pallet','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$expiry_date','product_name','Ambient','$date','$warehouse_name','</body></html>','$alertquantity','$product.bin','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','password','$invoice','$product_details.level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.type','user_id','/barcode/:id','note','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Return\x20Quantity\x20</th>','8pscJgG','$product_details.bay','table\x20page','toString','bin','find','Purchase\x20Return\x20Mail','$category','</span>','</table>','name','RoomAssign','purchase\x20data\x20update\x20successfully','suppliers','success','English\x20(US)','rak','getMonth','all_purchases','secondary_code_hide','body','$product_details.product_name','edit_purchases_view','edit_purchases','product_cat','prod_isle','prod_code','1049376kPDgmy','deliverycode','Enabled','get','getFullYear','$secondary_code','Logo.png','master','$maxProdPerUnit','English','concat','currency_placement','alertQTY','delivery_date','forEach','render','$primary_code','Sales\x20Update\x20successfully','$secondary_unit','<h2>\x20','language','random','stock_data','Floor','quantity','4380156lRTUYz','errors','Rack\x20C','post','/invoice/:id','German','secondary_unit','image','product_details','foreach\x20newproduct','An\x20error\x20occurred.','$due_amount','warehouse','prod_Qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$suppliers_docs','suppliers_data','Arabic','$suppliers','Rack\x20A','product_code_hide','prod_primunit','redirect','$maxStocks','floorlevel','$product.room_name','product_list','COLD\x20STORAGE','$product_details.secondary_code','createTransport','then','$product.type','$product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Price\x20</th>','$_id','return_product','$product_details.bin','\x20<>\x20','POnumber','Return\x20Goods','map','$product_details._id','status','\x20</h2>','standard_unit','/barcode_scanner','level','email','site_title','paid_amount','all_purchases_barcode','$product.bay','</thead>','Level','role','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Shelves','filter','$paid_amount','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<strong>\x20Regards\x20</strong>','max_product_unit','purchase_quantity','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<html><head><title></title>','Paid\x20For\x20Purchase','Arabic\x20(ae)','</h5>','delivery_code','abs','Purchase\x20Return','stock_quantity','$product_details.storage','batch_code','here','$unit','return_qty','../models/all_models','slice','JO_number','invoice','log','ejs','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','back','1444710LXeRVF','/give_payment/:id','An\x20error\x20occurred\x20while\x20saving\x20data.','currency','primary_code_hide','../public/language/languages.json','$product','staff','Portuguese','$room','length','$product_details.pallet','room','Chinese','product','</tbody>','storage','exports','prod_unit','/all_purchases/view','types','Error\x20Occurs','Rack\x20D','/view/add_purchases','gmail','rack','stocks','isle','product_stock','express','actual_uom','$product.floorlevel','save','date','/CheckingWarehouse','INC-','add\x20post','$product_details.floorlevel','</tr>','prod_level','Portuguese\x20(BR)','<h5>','/view','catch','Hindi','purchases\x20item\x20return\x20successfull','$product_details.product_code','3053601MHsUjL','actual_qty','\x20Order\x20Date\x20:\x20','Spanish','$batch_code','message','maxperunit','$product_details.primary_code','prod_name','findOne','json','getDate','Receiving\x20Area','sendMail','$product_details.expiry_date','</head><body>','prod_secondunit','suppliers_docs','primary_code','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','flash','1gvPpLp','$note','$finalize','Must\x20not\x20be\x20greater\x20than\x20Purchase/Stock\x20Qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','push','expiry_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_code','5480335mfmSPM','<tbody\x20style=\x22text-align:\x20center;\x22>','purchase_invoice','/upload/','maxStocks','56NHdTza','Email\x20sent\x20successfully','/../public','Room_name'];a0_0x4aa8=function(){return _0x5813e6;};return a0_0x4aa8();}const path=require(a0_0x34c840(0x275)),users=require(a0_0x34c840(0x1fb));router[a0_0x34c840(0x2ad)](a0_0x34c840(0x220),auth,async(_0x2c2007,_0x370c86)=>{var _0xc2db33=a0_0x34c840;try{const {username:_0x5e45e1,email:_0x3c9e67,role:_0x27d4ff}=_0x2c2007[_0xc2db33(0x25c)],_0x3be6e8=_0x2c2007[_0xc2db33(0x25c)],_0x3c1670=await profile[_0xc2db33(0x22e)]({'email':_0x3be6e8[_0xc2db33(0x1d0)]}),_0x2d0d29=await staff[_0xc2db33(0x22e)]({'email':_0x3be6e8['email']});if(_0x3be6e8[_0xc2db33(0x1d7)]==_0xc2db33(0x1fd)){const _0x440461=await staff[_0xc2db33(0x22e)]({'email':_0x3be6e8['email']});}const _0x1f6d20=await master_shop['find']();let _0x2b44c1;if(_0x3be6e8[_0xc2db33(0x1d7)]==_0xc2db33(0x1fd)){const _0x474c51=await staff['findOne']({'email':_0x3be6e8['email']});_0x2b44c1=await purchases[_0xc2db33(0x26a)]([{'$match':{'warehouse_name':_0x474c51[_0xc2db33(0x2cf)]}},{'$lookup':{'from':_0xc2db33(0x29c),'localField':_0xc2db33(0x29c),'foreignField':_0xc2db33(0x299),'as':_0xc2db33(0x236)}},{'$unwind':_0xc2db33(0x2d2)},{'$unwind':_0xc2db33(0x1fc)},{'$group':{'_id':'$_id','invoice':{'$first':_0xc2db33(0x286)},'suppliers':{'$first':_0xc2db33(0x2d5)},'date':{'$first':_0xc2db33(0x27f)},'warehouse_name':{'$first':_0xc2db33(0x280)},'room':{'$first':_0xc2db33(0x1ff)},'product':{'$push':_0xc2db33(0x1fc)},'note':{'$first':_0xc2db33(0x23c)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':'$due_amount'},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0xc2db33(0x229)},'expiry_date':{'$first':_0xc2db33(0x27c)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xc2db33(0x256)},'level':{'$addToSet':_0xc2db33(0x1d4)},'isle':{'$addToSet':_0xc2db33(0x283)},'type':{'$addToSet':_0xc2db33(0x2e2)},'floorlevel':{'$addToSet':_0xc2db33(0x215)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1}}]);}else _0x2b44c1=await purchases[_0xc2db33(0x26a)]([{'$lookup':{'from':'suppliers','localField':_0xc2db33(0x29c),'foreignField':'name','as':_0xc2db33(0x236)}},{'$unwind':_0xc2db33(0x2d2)},{'$unwind':'$product'},{'$group':{'_id':_0xc2db33(0x2e5),'invoice':{'$first':_0xc2db33(0x286)},'suppliers':{'$first':_0xc2db33(0x2d5)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0xc2db33(0x280)},'room':{'$addToSet':_0xc2db33(0x2dc)},'product':{'$push':_0xc2db33(0x1fc)},'note':{'$first':'$note'},'paid_amount':{'$first':_0xc2db33(0x1db)},'due_amount':{'$first':_0xc2db33(0x2ce)},'return_data':{'$first':_0xc2db33(0x253)},'batch_code':{'$first':_0xc2db33(0x229)},'expiry_date':{'$first':_0xc2db33(0x27c)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0xc2db33(0x256)},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0xc2db33(0x283)},'type':{'$addToSet':_0xc2db33(0x2e2)},'floorlevel':{'$addToSet':_0xc2db33(0x215)},'finalize':{'$first':_0xc2db33(0x23d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}}]);if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x29e)){var _0x44cb79=users[_0xc2db33(0x2b3)];console[_0xc2db33(0x1f2)](_0x44cb79);}else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x222))var _0x44cb79=users[_0xc2db33(0x222)];else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x2c8))var _0x44cb79=users['German'];else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x228))var _0x44cb79=users[_0xc2db33(0x228)];else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x25b))var _0x44cb79=users[_0xc2db33(0x25b)];else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]=='Portuguese\x20(BR)')var _0x44cb79=users[_0xc2db33(0x1fe)];else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x203))var _0x44cb79=users[_0xc2db33(0x203)];else{if(_0x1f6d20[0x0][_0xc2db33(0x2be)]==_0xc2db33(0x1e3))var _0x44cb79=users[_0xc2db33(0x2d4)];}}}}}}}_0x370c86['render'](_0xc2db33(0x2a1),{'success':_0x2c2007[_0xc2db33(0x23a)]('success'),'errors':_0x2c2007[_0xc2db33(0x23a)](_0xc2db33(0x2c4)),'purchases':_0x2b44c1,'role':_0x3be6e8,'profile':_0x3c1670,'master_shop':_0x1f6d20,'language':_0x44cb79});}catch(_0x2a6a11){console[_0xc2db33(0x1f2)](_0xc2db33(0x291),_0x2a6a11),_0x370c86['status'](0xc8)[_0xc2db33(0x22f)]({'message':_0x2a6a11[_0xc2db33(0x22a)]});}});function BayBinSelected(_0x3b5fc0,_0x8f3f03){var _0x14a2d1=a0_0x34c840,_0x523f82=[],_0x4aee5f=[],_0x119ef1=[],_0x2fca52=[],_0x49cd6e=[],_0x3ff55f=[];let _0x139eaf=[];if(_0x3b5fc0==_0x14a2d1(0x269))switch(_0x8f3f03){case _0x14a2d1(0x2d6):_0x523f82=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8],_0x4aee5f=[0x1,0x2],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=[_0x14a2d1(0x1d6),_0x14a2d1(0x2c1)],_0x49cd6e=['D'],_0x3ff55f=['A'];break;case _0x14a2d1(0x270):_0x523f82=[0x6,0x5,0x4,0x3,0x2,0x1],_0x4aee5f=[0x1,0x2],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=[_0x14a2d1(0x1d6),_0x14a2d1(0x2c1)],_0x49cd6e=['D'],_0x3ff55f=['B'];break;case _0x14a2d1(0x1d9):_0x523f82=[0x0],_0x4aee5f=[0x0],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=['Floor'],_0x49cd6e=['D'],_0x3ff55f=['S'];break;case _0x14a2d1(0x231):_0x523f82=[0x0],_0x4aee5f=[0x0],_0x2fca52=[0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,0xc,0xd,0xe,0xf,0x10],_0x119ef1=[_0x14a2d1(0x2c1)],_0x49cd6e=['D'],_0x3ff55f=['R'];break;}else{if(_0x3b5fc0==_0x14a2d1(0x2de))switch(_0x8f3f03){case _0x14a2d1(0x2d6):_0x523f82=[0x1,0x2,0x3,0x4,0x5,0x6,0x7],_0x4aee5f=['B','F'],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=['Level','Floor'],_0x49cd6e=['C'],_0x3ff55f=['A'];break;case _0x14a2d1(0x270):_0x523f82=[0x5,0x4,0x3,0x2,0x1],_0x4aee5f=['F','B','S'],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=[_0x14a2d1(0x1d6),'Floor'],_0x49cd6e=['C'],_0x3ff55f=['B'];break;case _0x14a2d1(0x2c5):_0x523f82=[0x1,0x2,0x3,0x4,0x5],_0x4aee5f=['B','F','S'],_0x2fca52=[0x5,0x4,0x3,0x2,0x1],_0x119ef1=[_0x14a2d1(0x1d6),'Floor'],_0x49cd6e=['C'],_0x3ff55f=['C'];break;case _0x14a2d1(0x20c):_0x523f82=[0x5,0x4,0x3,0x2,0x1],_0x4aee5f=['F','B','S'],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=[_0x14a2d1(0x1d6),'Floor'],_0x49cd6e=['C'],_0x3ff55f=['D'];break;case'Rack\x20E':_0x523f82=[0x4,0x3,0x2,0x1],_0x4aee5f=[0x1,0x2],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=['Level',_0x14a2d1(0x2c1)],_0x49cd6e=['C'],_0x3ff55f=['E'];break;case'Rack\x20F':_0x523f82=[0x1,0x2,0x3],_0x4aee5f=[0x1,0x2],_0x2fca52=[0x1,0x2,0x3,0x4,0x5],_0x119ef1=['Level'],_0x49cd6e=['C'],_0x3ff55f=['F'];break;}}return{'levels':_0x523f82,'Isle':_0x4aee5f,'rack':_0x2fca52,'type':_0x119ef1,'storage':_0x49cd6e,'rak':_0x3ff55f};}async function getRandom8DigitNumber(){var _0x51bed4=a0_0x34c840;const _0x13e85e=0x989680,_0x1e7f60=0x5f5e0ff,_0x101282=Math['floor'](Math[_0x51bed4(0x2bf)]()*(_0x1e7f60-_0x13e85e+0x1))+_0x13e85e;var _0x1c2241;const _0x30aae8=await purchases[_0x51bed4(0x22e)]({'invoice':_0x51bed4(0x219)+_0x101282});return _0x30aae8&&_0x30aae8['length']>0x0?_0x1c2241=_0x51bed4(0x219)+_0x101282:_0x1c2241=_0x51bed4(0x219)+_0x101282,_0x1c2241;}router[a0_0x34c840(0x2ad)](a0_0x34c840(0x20d),auth,async(_0x1ea029,_0x2dd96e)=>{var _0x122e4f=a0_0x34c840;try{const {username:_0x4548aa,email:_0x47b9a6,role:_0x1af7cc}=_0x1ea029['user'],_0x16c2cb=_0x1ea029[_0x122e4f(0x25c)],_0xa3369a=await profile['findOne']({'email':_0x16c2cb[_0x122e4f(0x1d0)]}),_0x2f8a97=await master_shop[_0x122e4f(0x294)](),_0x416482=await staff[_0x122e4f(0x22e)]({'email':_0x16c2cb[_0x122e4f(0x1d0)]}),_0x1d96d4=await suppliers[_0x122e4f(0x294)]({});let _0x250afb;if(_0x16c2cb['role']==_0x122e4f(0x1fd)){const _0xd1b3d0=await staff[_0x122e4f(0x22e)]({'email':_0x16c2cb[_0x122e4f(0x1d0)]});_0x250afb=await warehouse['aggregate']([{'$match':{'status':_0x122e4f(0x2ac),'name':_0xd1b3d0[_0x122e4f(0x2cf)],'warehouse_category':_0x122e4f(0x261),'name':{'$ne':_0x122e4f(0x2ea)}}},{'$group':{'_id':_0x122e4f(0x262),'name':{'$first':_0x122e4f(0x262)}}}]);}else _0x250afb=await warehouse[_0x122e4f(0x26a)]([{'$match':{'status':_0x122e4f(0x2ac),'warehouse_category':_0x122e4f(0x261),'name':{'$ne':_0x122e4f(0x2ea)}}},{'$group':{'_id':_0x122e4f(0x262),'name':{'$first':_0x122e4f(0x262)}}}]);const _0xd17780=await product[_0x122e4f(0x294)]({}),_0x4b6d68=await warehouse[_0x122e4f(0x294)]({'status':_0x122e4f(0x2ac)}),_0x3f5236=await purchases[_0x122e4f(0x294)]({}),_0x4b0996=_0x3f5236[_0x122e4f(0x200)]+0x1,_0x5d967e=_0x122e4f(0x219)+_0x4b0996[_0x122e4f(0x292)]()[_0x122e4f(0x274)](0x5,'0');var _0x2cfd88=[_0x122e4f(0x27e),_0x122e4f(0x28d)];if(_0x2f8a97[0x0][_0x122e4f(0x2be)]==_0x122e4f(0x29e))var _0xe3a180=users[_0x122e4f(0x2b3)];else{if(_0x2f8a97[0x0][_0x122e4f(0x2be)]=='Hindi')var _0xe3a180=users[_0x122e4f(0x222)];else{if(_0x2f8a97[0x0]['language']==_0x122e4f(0x2c8))var _0xe3a180=users[_0x122e4f(0x2c8)];else{if(_0x2f8a97[0x0][_0x122e4f(0x2be)]==_0x122e4f(0x228))var _0xe3a180=users['Spanish'];else{if(_0x2f8a97[0x0]['language']==_0x122e4f(0x25b))var _0xe3a180=users[_0x122e4f(0x25b)];else{if(_0x2f8a97[0x0][_0x122e4f(0x2be)]==_0x122e4f(0x21e))var _0xe3a180=users[_0x122e4f(0x1fe)];else{if(_0x2f8a97[0x0][_0x122e4f(0x2be)]=='Chinese')var _0xe3a180=users[_0x122e4f(0x203)];else{if(_0x2f8a97[0x0]['language']==_0x122e4f(0x1e3))var _0xe3a180=users[_0x122e4f(0x2d4)];}}}}}}}const _0x2f48b9=getRandom8DigitNumber();_0x2f48b9[_0x122e4f(0x2e1)](_0x523243=>{var _0x4d4f9d=_0x122e4f;_0x2dd96e[_0x4d4f9d(0x2b9)]('add_purchases',{'success':_0x1ea029[_0x4d4f9d(0x23a)](_0x4d4f9d(0x29d)),'errors':_0x1ea029[_0x4d4f9d(0x23a)](_0x4d4f9d(0x2c4)),'role':_0x16c2cb,'profile':_0xa3369a,'suppliers':_0x1d96d4,'warehouse':_0x250afb,'product':_0xd17780,'invoice':_0x523243,'master_shop':_0x2f8a97,'language':_0xe3a180,'find_data':_0x4b6d68,'rooms_data':_0x2cfd88});})[_0x122e4f(0x221)](_0x184593=>{var _0x311d70=_0x122e4f;_0x1ea029[_0x311d70(0x23a)]('errors',_0x311d70(0x267)),_0x2dd96e[_0x311d70(0x2d9)](_0x311d70(0x209));});}catch(_0x3e9b49){console[_0x122e4f(0x1f2)](_0x3e9b49);}}),router[a0_0x34c840(0x2ad)]('/view/add_purchases/:id',auth,async(_0x35eccf,_0x397a1f)=>{var _0x59de47=a0_0x34c840;try{const _0x12df44=_0x35eccf[_0x59de47(0x251)]['id'];console['log'](_0x12df44);const _0x533d6e=await master_shop[_0x59de47(0x294)]();console[_0x59de47(0x1f2)](_0x59de47(0x2b1),_0x533d6e);const _0x34cbb8=await product[_0x59de47(0x22e)]({'name':_0x12df44});console[_0x59de47(0x1f2)]('product',_0x34cbb8),_0x397a1f[_0x59de47(0x2ed)](0xc8)[_0x59de47(0x22f)]({'product_data':_0x34cbb8,'master':_0x533d6e});}catch(_0x4ada11){console['log']('add_purchases\x20error',_0x4ada11);}}),router['post'](a0_0x34c840(0x20d),auth,async(_0x480156,_0x4f7198)=>{var _0x5414fb=a0_0x34c840;try{const {invoice:_0x223c2a,date:_0x273001,warehouse_name:_0x2178f2,prod_name:_0xacd964,prod_code:_0x38db24,prod_qty:_0x510428,prod_unit:_0x6cf8bc,prod_secondunit:_0x386963,prod_level:_0xa8be3a,prod_isle:_0x1ae82c,prod_pallet:_0x5d1449,note:_0x44dc09,expiry_date:_0x1ea334,batch_code:_0x50d4c3,payable:_0x1eec84,due_amount:_0x1c2ba8,Room_name:_0xb260c3,primary_code:_0x143c8c,secondary_code:_0x30830e,MaxStocks_data:_0x5ba225,PO_number:_0x50e0fd,SCRN:_0x2544f0,JO_number:_0x2f114b}=_0x480156[_0x5414fb(0x2a3)];if(typeof _0xacd964=='string')var _0x5704dc=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x22d)]],_0x39b5ad=[_0x480156['body']['prod_code']],_0x34e79c=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x2d0)]],_0x36550e=[_0x480156['body'][_0x5414fb(0x2d8)]],_0x40319a=[_0x480156['body'][_0x5414fb(0x235)]],_0x29a224=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x21d)]],_0xfb2b4f=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x237)]],_0x4ff5d7=[_0x480156['body']['secondary_code']],_0x49f096=[_0x480156['body'][_0x5414fb(0x257)]],_0x128775=[_0x480156[_0x5414fb(0x2a3)]['batch_code']],_0x15cb98=[_0x480156[_0x5414fb(0x2a3)]['expiry_date']],_0x1de373=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x1de)]],_0x2497ca=[_0x480156['body'][_0x5414fb(0x2b6)]],_0x3e18bf=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x26d)]],_0x10b2f5=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x250)]],_0xbce703=[_0x480156[_0x5414fb(0x2a3)]['RoomAssign']],_0xd5204e=[_0x480156[_0x5414fb(0x2a3)]['deliverycode']],_0x457b05=[_0x480156['body'][_0x5414fb(0x260)]],_0xddb919=[_0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x226)]],_0x470afa=[_0x480156[_0x5414fb(0x2a3)]['actual_uom']];else var _0x5704dc=[..._0x480156[_0x5414fb(0x2a3)]['prod_name']],_0x39b5ad=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x2a9)]],_0x34e79c=[..._0x480156['body']['prod_Qty']],_0x36550e=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x2d8)]],_0x40319a=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x235)]],_0x29a224=[..._0x480156[_0x5414fb(0x2a3)]['prod_level']],_0xfb2b4f=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x237)]],_0x4ff5d7=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x265)]],_0x49f096=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x257)]],_0x128775=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x1ea)]],_0x15cb98=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x241)]],_0x1de373=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x1de)]],_0x2497ca=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x2b6)]],_0x3e18bf=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x26d)]],_0x10b2f5=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x250)]],_0xbce703=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x29a)]],_0xd5204e=[..._0x480156['body'][_0x5414fb(0x2ab)]],_0x457b05=[..._0x480156[_0x5414fb(0x2a3)][_0x5414fb(0x260)]],_0xddb919=[..._0x480156[_0x5414fb(0x2a3)]['actual_qty']],_0x470afa=[..._0x480156['body'][_0x5414fb(0x214)]];const _0x506c1f=_0x5704dc[_0x5414fb(0x2eb)](_0x5cae4a=>{return _0x5cae4a={'product_name':_0x5cae4a};});_0xddb919[_0x5414fb(0x2b8)]((_0x30fa2e,_0x46394e)=>{var _0x697993=_0x5414fb;_0x506c1f[_0x46394e][_0x697993(0x226)]=Math[_0x697993(0x1e6)](_0x30fa2e);}),_0x470afa[_0x5414fb(0x2b8)]((_0x11449e,_0x155b1a)=>{var _0x238f8e=_0x5414fb;_0x506c1f[_0x155b1a][_0x238f8e(0x214)]=_0x11449e;}),_0x39b5ad['forEach']((_0x2ec953,_0x2c366d)=>{var _0x138ac7=_0x5414fb;_0x506c1f[_0x2c366d][_0x138ac7(0x243)]=_0x2ec953;}),_0x34e79c[_0x5414fb(0x2b8)]((_0x282e2f,_0x1953bf)=>{var _0x47bc50=_0x5414fb;_0x506c1f[_0x1953bf][_0x47bc50(0x2c2)]=Math[_0x47bc50(0x1e6)](_0x282e2f);}),_0x36550e[_0x5414fb(0x2b8)]((_0x47bbff,_0x5c338f)=>{var _0x3df4ea=_0x5414fb;_0x506c1f[_0x5c338f][_0x3df4ea(0x1cd)]=_0x47bbff;}),_0x40319a[_0x5414fb(0x2b8)]((_0x1b54ed,_0x1b63c5)=>{var _0x1fd668=_0x5414fb;_0x506c1f[_0x1b63c5][_0x1fd668(0x2c9)]=_0x1b54ed;}),_0x29a224[_0x5414fb(0x2b8)]((_0x360b6e,_0x359a89)=>{_0xbce703['forEach']((_0x564b1c,_0x1f9f4b)=>{var _0x205719=a0_0x3172;if(_0x564b1c==_0x205719(0x231)&&_0x359a89==_0x1f9f4b){console[_0x205719(0x1f2)](_0x564b1c+'\x20<\x20wew\x20>\x20'+_0x359a89+_0x205719(0x2e8)+_0x1f9f4b+_0x205719(0x2e8)+_0x360b6e);var _0x3488fc=_0x360b6e[_0x205719(0x1ef)](0x3);_0x506c1f[_0x359a89]['storage']=_0x360b6e[0x0],_0x506c1f[_0x359a89][_0x205719(0x20f)]=_0x360b6e[0x1],_0x506c1f[_0x359a89][_0x205719(0x238)]=0x0,_0x506c1f[_0x359a89][_0x205719(0x293)]=0x0,_0x506c1f[_0x359a89][_0x205719(0x25d)]=_0x205719(0x2c1),_0x506c1f[_0x359a89]['floorlevel']=_0x3488fc;}else{if(_0x564b1c=='Shelves'&&_0x359a89==_0x1f9f4b){var _0x3488fc=_0x360b6e['slice'](0x3);_0x506c1f[_0x359a89][_0x205719(0x206)]=_0x360b6e[0x0],_0x506c1f[_0x359a89][_0x205719(0x20f)]=_0x360b6e[0x1],_0x506c1f[_0x359a89][_0x205719(0x238)]=0x0,_0x506c1f[_0x359a89][_0x205719(0x293)]=0x0,_0x506c1f[_0x359a89][_0x205719(0x25d)]=_0x205719(0x2c1),_0x506c1f[_0x359a89][_0x205719(0x2db)]=_0x360b6e[0x5];}else{if(_0x359a89==_0x1f9f4b){if(_0x360b6e[0x0]=='A'&&_0x360b6e[0x1]=='L'&&_0x360b6e[0x2]=='L')console[_0x205719(0x1f2)](_0x564b1c+_0x205719(0x2e8)+_0x359a89+_0x205719(0x2e8)+_0x1f9f4b+_0x205719(0x2e8)+_0x360b6e+_0x205719(0x1eb)),_0x506c1f[_0x359a89][_0x205719(0x206)]=_0x360b6e[0x0],_0x506c1f[_0x359a89][_0x205719(0x20f)]=_0x360b6e[0x1],_0x506c1f[_0x359a89][_0x205719(0x238)]=0x0,_0x506c1f[_0x359a89][_0x205719(0x293)]=0x0,_0x506c1f[_0x359a89][_0x205719(0x25d)]='Floor',_0x506c1f[_0x359a89]['floorlevel']=_0x360b6e[0x3];else{var _0x2055d9;if(_0x360b6e[0x4]=='L')_0x2055d9=_0x205719(0x1d6);else _0x360b6e[0x4]=='F'&&(_0x2055d9=_0x205719(0x2c1));_0x506c1f[_0x359a89][_0x205719(0x206)]=_0x360b6e[0x0],_0x506c1f[_0x359a89][_0x205719(0x20f)]=_0x360b6e[0x1],_0x506c1f[_0x359a89]['bay']=_0x360b6e[0x2],_0x506c1f[_0x359a89][_0x205719(0x293)]=_0x360b6e[0x3],_0x506c1f[_0x359a89]['type']=_0x2055d9,_0x506c1f[_0x359a89][_0x205719(0x2db)]=_0x360b6e[0x5];}}}}});}),_0xfb2b4f['forEach']((_0x1d2339,_0x5088c0)=>{var _0x30f7a4=_0x5414fb;_0x506c1f[_0x5088c0][_0x30f7a4(0x237)]=_0x1d2339;}),_0x4ff5d7[_0x5414fb(0x2b8)]((_0x233c70,_0x5e7650)=>{var _0x479a85=_0x5414fb;_0x506c1f[_0x5e7650][_0x479a85(0x265)]=_0x233c70;}),_0x49f096[_0x5414fb(0x2b8)]((_0x7caf5,_0x3051dd)=>{var _0xb2b909=_0x5414fb;_0x506c1f[_0x3051dd][_0xb2b909(0x248)]=_0x7caf5;}),_0x128775['forEach']((_0x52f41c,_0x452a40)=>{var _0x538e35=_0x5414fb;_0x506c1f[_0x452a40][_0x538e35(0x1ea)]=_0x52f41c;}),_0x15cb98[_0x5414fb(0x2b8)]((_0x2c9994,_0x249f8)=>{var _0x1b86b5=_0x5414fb;_0x506c1f[_0x249f8][_0x1b86b5(0x241)]=_0x2c9994;}),_0x1de373[_0x5414fb(0x2b8)]((_0x528e37,_0x566cf7)=>{var _0xb3413b=_0x5414fb;_0x506c1f[_0x566cf7][_0xb3413b(0x22b)]=_0x528e37;}),_0x2497ca['forEach']((_0xd2eefa,_0x36dad5)=>{var _0x47a0be=_0x5414fb;_0x506c1f[_0x36dad5][_0x47a0be(0x2b6)]=_0xd2eefa;}),_0x3e18bf[_0x5414fb(0x2b8)]((_0x41678a,_0x118579)=>{_0x506c1f[_0x118579]['production_date']=_0x41678a;}),_0x10b2f5[_0x5414fb(0x2b8)]((_0x3ce8af,_0x4df4ae)=>{var _0x20073f=_0x5414fb;_0x506c1f[_0x4df4ae][_0x20073f(0x2a7)]=_0x3ce8af;}),_0xbce703['forEach']((_0x5afbe8,_0xad1ac2)=>{var _0x312fbd=_0x5414fb;_0x506c1f[_0xad1ac2][_0x312fbd(0x258)]=_0x5afbe8;}),_0xd5204e[_0x5414fb(0x2b8)]((_0x542183,_0x4e57a6)=>{var _0x1db60d=_0x5414fb;_0x506c1f[_0x4e57a6][_0x1db60d(0x1e5)]=_0x542183;}),_0x457b05['forEach']((_0x584d54,_0x55bb78)=>{var _0x4c2896=_0x5414fb;_0x506c1f[_0x55bb78][_0x4c2896(0x1f1)]=_0x584d54;});const _0x144367=_0xbce703[_0x5414fb(0x2eb)](_0x54cfb6=>{return _0x54cfb6={'room_name':_0x54cfb6};}),_0x56c0bf=_0x506c1f[_0x5414fb(0x1da)](_0x59b8a5=>_0x59b8a5['quantity']!=='0'&&_0x59b8a5[_0x5414fb(0x2c2)]!==''),_0x27fa91=new purchases({'invoice':_0x223c2a,'suppliers':_0x480156[_0x5414fb(0x2a3)]['suppliers'],'date':_0x273001,'warehouse_name':_0x2178f2,'product':_0x56c0bf,'note':_0x44dc09,'due_amount':_0x1c2ba8,'POnumber':_0x50e0fd,'SCRN':_0x2544f0,'JO_number':_0x2f114b,'roomList':_0x144367}),_0x4d82bd=await _0x27fa91[_0x5414fb(0x216)](),_0x4be3b8=await purchases[_0x5414fb(0x22e)]({'invoice':_0x223c2a}),_0x582f18=_0x4be3b8[_0x5414fb(0x204)][_0x5414fb(0x2eb)](async _0x53f2d8=>{var _0x3185cd=_0x5414fb,_0x1f2995=await warehouse[_0x3185cd(0x22e)]({'name':_0x2178f2,'room':_0x53f2d8[_0x3185cd(0x258)]}),_0x30704a=0x0;return _0x1f2995[_0x3185cd(0x2cb)][_0x3185cd(0x2b8)](_0x105a9d=>{var _0x486422=_0x3185cd;_0x105a9d['product_name']==_0x53f2d8['product_name']&&_0x105a9d['floorlevel']==_0x53f2d8[_0x486422(0x2db)]&&_0x105a9d[_0x486422(0x25d)]==_0x53f2d8[_0x486422(0x25d)]&&_0x105a9d['bin']==_0x53f2d8['bin']&&_0x105a9d[_0x486422(0x238)]==_0x53f2d8[_0x486422(0x238)]&&_0x105a9d[_0x486422(0x20f)]==_0x53f2d8[_0x486422(0x20f)]&&_0x105a9d[_0x486422(0x206)]==_0x53f2d8[_0x486422(0x206)]&&_0x105a9d[_0x486422(0x241)]==_0x53f2d8['expiry_date']&&_0x105a9d[_0x486422(0x1ea)]==_0x53f2d8['batch_code']&&_0x105a9d['production_date']==_0x53f2d8[_0x486422(0x26d)]&&_0x105a9d[_0x486422(0x1f1)]==_0x4be3b8[_0x486422(0x1f1)]&&(_0x105a9d[_0x486422(0x212)]+=Math[_0x486422(0x1e6)](_0x53f2d8[_0x486422(0x2c2)]),_0x30704a++);}),_0x30704a===0x0&&_0x1f2995[_0x3185cd(0x2cb)][_0x3185cd(0x240)]({'product_name':_0x53f2d8['product_name'],'product_stock':Math[_0x3185cd(0x1e6)](_0x53f2d8['quantity']),'primary_code':_0x53f2d8[_0x3185cd(0x237)],'secondary_code':_0x53f2d8[_0x3185cd(0x265)],'product_code':_0x53f2d8[_0x3185cd(0x243)],'storage':_0x53f2d8[_0x3185cd(0x206)],'rack':_0x53f2d8[_0x3185cd(0x20f)],'bay':_0x53f2d8[_0x3185cd(0x238)],'bin':_0x53f2d8[_0x3185cd(0x293)],'type':_0x53f2d8[_0x3185cd(0x25d)],'floorlevel':_0x53f2d8['floorlevel'],'maxProducts':_0x53f2d8['maxStocks'],'unit':_0x53f2d8['standard_unit'],'secondary_unit':_0x53f2d8[_0x3185cd(0x2c9)],'expiry_date':_0x53f2d8[_0x3185cd(0x241)],'maxPerUnit':_0x53f2d8['maxperunit'],'batch_code':_0x53f2d8['batch_code'],'alertQTY':_0x53f2d8[_0x3185cd(0x2b6)],'production_date':_0x53f2d8[_0x3185cd(0x26d)],'product_cat':_0x53f2d8['product_cat'],'invoice':_0x53f2d8['invoice'],'actual_qty':Math[_0x3185cd(0x1e6)](_0x53f2d8[_0x3185cd(0x226)]),'actual_uom':_0x53f2d8[_0x3185cd(0x214)]}),_0x1f2995;});Promise['all'](_0x582f18)[_0x5414fb(0x2e1)](async _0x214a26=>{var _0x52cdd1=_0x5414fb;try{for(const _0xe8fbfb of _0x214a26){await _0xe8fbfb['save']();}const _0x1dd9bf=await master_shop['find'](),_0x34912f=await email_settings[_0x52cdd1(0x22e)](),_0x1fb72b=await supervisor_settings['find']();var _0x5ca3f9=_0x4be3b8[_0x52cdd1(0x204)],_0x36e506='',_0x9eeef8;for(_0x9eeef8 in _0x5ca3f9){_0x36e506+=_0x52cdd1(0x26b)+_0x52cdd1(0x284)+_0x5ca3f9[_0x9eeef8]['product_name']+_0x52cdd1(0x263)+_0x52cdd1(0x284)+_0x5ca3f9[_0x9eeef8]['product_code']+_0x52cdd1(0x263)+_0x52cdd1(0x284)+_0x5ca3f9[_0x9eeef8]['quantity']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x1cd)]+_0x52cdd1(0x263)+_0x52cdd1(0x284)+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x2c9)]+'</td>'+_0x52cdd1(0x284)+_0x4be3b8[_0x52cdd1(0x24f)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x258)]+_0x52cdd1(0x263)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x206)]+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x20f)]+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x238)]+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x293)]+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x25d)][0x0]+_0x5ca3f9[_0x9eeef8][_0x52cdd1(0x2db)]+_0x52cdd1(0x263),_0x52cdd1(0x21c);}let _0x5cfd1a=nodemailer[_0x52cdd1(0x2e0)]({'host':_0x34912f['host'],'port':Number(_0x34912f['port']),'secure':![],'auth':{'user':_0x34912f[_0x52cdd1(0x1d0)],'pass':_0x34912f[_0x52cdd1(0x285)]}}),_0x45a6ea={'from':_0x34912f[_0x52cdd1(0x1d0)],'to':_0x1fb72b[0x0][_0x52cdd1(0x26c)],'subject':'Purchase\x20Mail','attachments':[{'filename':_0x52cdd1(0x2b0),'path':__dirname+_0x52cdd1(0x24b)+_0x52cdd1(0x247)+_0x1dd9bf[0x0][_0x52cdd1(0x2ca)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x52cdd1(0x1e1)+'</head><body>'+_0x52cdd1(0x276)+_0x52cdd1(0x23f)+_0x52cdd1(0x276)+_0x52cdd1(0x242)+'</div>'+_0x52cdd1(0x276)+_0x52cdd1(0x2bd)+_0x1dd9bf[0x0][_0x52cdd1(0x1d1)]+_0x52cdd1(0x2ee)+_0x52cdd1(0x26f)+_0x52cdd1(0x26f)+_0x52cdd1(0x268)+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x52cdd1(0x271)+_0x4be3b8['invoice']+'\x20'+_0x52cdd1(0x254)+_0x52cdd1(0x227)+_0x4be3b8[_0x52cdd1(0x217)]+'\x20'+_0x52cdd1(0x297)+_0x52cdd1(0x1e4)+_0x52cdd1(0x26f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x52cdd1(0x1f4)+_0x52cdd1(0x26b)+_0x52cdd1(0x1d8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x52cdd1(0x239)+_0x52cdd1(0x1e0)+_0x52cdd1(0x27b)+_0x52cdd1(0x2d1)+_0x52cdd1(0x1dc)+_0x52cdd1(0x288)+_0x52cdd1(0x21c)+_0x52cdd1(0x1d5)+_0x52cdd1(0x245)+'\x20'+_0x36e506+'\x20'+_0x52cdd1(0x205)+_0x52cdd1(0x298)+_0x52cdd1(0x276)+_0x52cdd1(0x1dd)+_0x52cdd1(0x21f)+_0x1dd9bf[0x0]['site_title']+_0x52cdd1(0x1e4)+'</div>'+_0x52cdd1(0x26f)+_0x52cdd1(0x281)};_0x5cfd1a[_0x52cdd1(0x232)](_0x45a6ea,function(_0x1ab0df,_0x4353eb){var _0x3d65c2=_0x52cdd1;_0x1ab0df?(console[_0x3d65c2(0x1f2)](_0x1ab0df),console[_0x3d65c2(0x1f2)](_0x3d65c2(0x20b))):console[_0x3d65c2(0x1f2)](_0x3d65c2(0x24a));}),_0x480156[_0x52cdd1(0x23a)]('success',_0x52cdd1(0x252)),_0x4f7198[_0x52cdd1(0x2d9)]('/all_purchases/view/');}catch(_0x24cf3){console[_0x52cdd1(0x26e)](_0x24cf3),_0x4f7198['status'](0x1f4)[_0x52cdd1(0x22f)]({'error':_0x52cdd1(0x1f8)});}})[_0x5414fb(0x221)](_0x4c1b93=>{var _0x380f7e=_0x5414fb;console[_0x380f7e(0x26e)](_0x4c1b93),_0x4f7198[_0x380f7e(0x2ed)](0x1f4)[_0x380f7e(0x22f)]({'error':_0x380f7e(0x2cd)});});}catch(_0x1fe072){console[_0x5414fb(0x1f2)](_0x1fe072);}}),router[a0_0x34c840(0x2ad)](a0_0x34c840(0x273),auth,async(_0x273b37,_0x3cdd65)=>{var _0x54e365=a0_0x34c840;try{const {username:_0x1dffaa,email:_0x319b9c,role:_0x5c2e21}=_0x273b37[_0x54e365(0x25c)],_0x58c466=_0x273b37[_0x54e365(0x25c)],_0x435119=await profile[_0x54e365(0x22e)]({'email':_0x58c466[_0x54e365(0x1d0)]}),_0xf5f912=await master_shop[_0x54e365(0x294)](),_0x2427e5=_0x273b37[_0x54e365(0x251)]['id'],_0x891773=await purchases[_0x54e365(0x24d)](_0x2427e5),_0x7e41c4=await warehouse[_0x54e365(0x26a)]([{'$match':{'name':_0x891773['warehouse_name'],'room':_0x891773['room']}},{'$unwind':_0x54e365(0x255)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x54e365(0x2a4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x54e365(0x290)},'bin':{'$first':_0x54e365(0x2e7)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x54e365(0x22c)},'secondary_code':{'$first':_0x54e365(0x2df)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x54e365(0x233)}}}]),_0x5d1513=await customer[_0x54e365(0x294)]({});let _0x5ba610;if(_0x58c466[_0x54e365(0x1d7)]==_0x54e365(0x1fd)){const _0xa56560=await staff[_0x54e365(0x22e)]({'email':_0x58c466[_0x54e365(0x1d0)]});_0x5ba610=await warehouse[_0x54e365(0x26a)]([{'$match':{'status':_0x54e365(0x2ac),'name':_0xa56560[_0x54e365(0x2cf)]}},{'$group':{'_id':_0x54e365(0x262),'name':{'$first':_0x54e365(0x262)}}}]);}else _0x5ba610=await warehouse[_0x54e365(0x26a)]([{'$match':{'status':_0x54e365(0x2ac)}},{'$group':{'_id':'$name','name':{'$first':_0x54e365(0x262)}}}]);const _0x206425=await product['find']({}),_0x42ba3f=await suppliers['find']({}),_0x4fa9e5=BayBinSelected(_0x891773[_0x54e365(0x24f)],_0x891773[_0x54e365(0x202)]);if(_0xf5f912[0x0][_0x54e365(0x2be)]==_0x54e365(0x29e)){var _0x9983e0=users[_0x54e365(0x2b3)];console['log'](_0x9983e0);}else{if(_0xf5f912[0x0][_0x54e365(0x2be)]==_0x54e365(0x222))var _0x9983e0=users[_0x54e365(0x222)];else{if(_0xf5f912[0x0][_0x54e365(0x2be)]==_0x54e365(0x2c8))var _0x9983e0=users[_0x54e365(0x2c8)];else{if(_0xf5f912[0x0][_0x54e365(0x2be)]==_0x54e365(0x228))var _0x9983e0=users[_0x54e365(0x228)];else{if(_0xf5f912[0x0]['language']==_0x54e365(0x25b))var _0x9983e0=users['French'];else{if(_0xf5f912[0x0][_0x54e365(0x2be)]==_0x54e365(0x21e))var _0x9983e0=users[_0x54e365(0x1fe)];else{if(_0xf5f912[0x0]['language']==_0x54e365(0x203))var _0x9983e0=users[_0x54e365(0x203)];else{if(_0xf5f912[0x0][_0x54e365(0x2be)]==_0x54e365(0x1e3))var _0x9983e0=users[_0x54e365(0x2d4)];}}}}}}}_0x3cdd65[_0x54e365(0x2b9)](_0x54e365(0x2a5),{'success':_0x273b37[_0x54e365(0x23a)](_0x54e365(0x29d)),'errors':_0x273b37['flash'](_0x54e365(0x2c4)),'role':_0x58c466,'profile':_0x435119,'customer':_0x5d1513,'warehouse':_0x5ba610,'product':_0x7e41c4,'user':_0x891773,'master_shop':_0xf5f912,'unit':_0x206425,'language':_0x9983e0,'suppliers':_0x42ba3f,'dataSelected':_0x4fa9e5});}catch(_0x249151){console[_0x54e365(0x1f2)](_0x249151);}}),router['post'](a0_0x34c840(0x273),auth,async(_0x36cda5,_0x19226d)=>{var _0x31f257=a0_0x34c840;try{const _0x3fd1f7=_0x36cda5['params']['id'],{invoice:_0x5d0758,warehouse_name:_0x4f2256,Room_name:_0x3828b3}=_0x36cda5[_0x31f257(0x2a3)],_0x1ab7d5=await warehouse[_0x31f257(0x22e)]({'name':_0x4f2256,'room':_0x3828b3}),_0x3bcd7c=await purchases[_0x31f257(0x22e)]({'invoice':_0x5d0758});_0x3bcd7c[_0x31f257(0x204)][_0x31f257(0x2b8)](_0x4135e8=>{var _0x57344a=_0x31f257,_0x374f1e=0x0;const _0x1965d0=_0x1ab7d5[_0x57344a(0x2cb)]['map'](_0x2946b3=>{var _0x541b7e=_0x57344a;_0x2946b3[_0x541b7e(0x27d)]==_0x4135e8[_0x541b7e(0x27d)]&&_0x2946b3[_0x541b7e(0x2db)]==_0x4135e8[_0x541b7e(0x2db)]&&_0x2946b3[_0x541b7e(0x25d)]==_0x4135e8['type']&&_0x2946b3[_0x541b7e(0x293)]==_0x4135e8[_0x541b7e(0x293)]&&_0x2946b3[_0x541b7e(0x238)]==_0x4135e8[_0x541b7e(0x238)]&&_0x2946b3['rack']==_0x4135e8['rack']&&_0x2946b3[_0x541b7e(0x206)]==_0x4135e8[_0x541b7e(0x206)]&&_0x2946b3['expiry_date']==_0x4135e8['expiry_date']&&_0x2946b3['batch_code']==_0x4135e8[_0x541b7e(0x1ea)]&&_0x2946b3[_0x541b7e(0x26d)]==_0x4135e8[_0x541b7e(0x26d)]&&_0x2946b3[_0x541b7e(0x2b7)]==_0x4135e8['delivery_date']&&_0x2946b3[_0x541b7e(0x1e5)]==_0x4135e8[_0x541b7e(0x1e5)]&&(_0x2946b3['product_stock']=parseInt(_0x2946b3[_0x541b7e(0x212)])+parseInt(_0x4135e8[_0x541b7e(0x2c2)]),_0x374f1e++);});_0x374f1e=='0'&&(_0x1ab7d5[_0x57344a(0x2cb)]=_0x1ab7d5[_0x57344a(0x2cb)][_0x57344a(0x2b4)]({'product_name':_0x4135e8[_0x57344a(0x27d)],'product_stock':_0x4135e8[_0x57344a(0x2c2)],'primary_code':_0x4135e8[_0x57344a(0x237)],'secondary_code':_0x4135e8[_0x57344a(0x265)],'product_code':_0x4135e8[_0x57344a(0x243)],'storage':_0x4135e8[_0x57344a(0x206)],'rack':_0x4135e8[_0x57344a(0x20f)],'bay':_0x4135e8['bay'],'bin':_0x4135e8['bin'],'type':_0x4135e8['type'],'floorlevel':_0x4135e8[_0x57344a(0x2db)],'maxProducts':_0x4135e8['maxStocks'],'unit':_0x4135e8['standard_unit'],'secondary_unit':_0x4135e8[_0x57344a(0x2c9)],'expiry_date':_0x4135e8[_0x57344a(0x241)],'maxPerUnit':_0x4135e8['maxperunit'],'batch_code':_0x4135e8[_0x57344a(0x1ea)],'alertQTY':_0x4135e8[_0x57344a(0x2b6)],'production_date':_0x4135e8[_0x57344a(0x26d)],'delivery_date':_0x4135e8[_0x57344a(0x2b7)],'delivery_code':_0x4135e8[_0x57344a(0x1e5)]}));}),await _0x1ab7d5[_0x31f257(0x216)](),_0x3bcd7c['finalize']='True';const _0x509d72=await _0x3bcd7c['save']();_0x36cda5['flash']('success',_0x31f257(0x2bb)),_0x19226d[_0x31f257(0x2d9)](_0x31f257(0x209));}catch(_0x2bc0f7){console['log'](_0x2bc0f7);}}),router[a0_0x34c840(0x2ad)](a0_0x34c840(0x277),auth,async(_0xa96190,_0x5c9095)=>{var _0x2d4e9d=a0_0x34c840;try{const {username:_0x13291d,email:_0x10dd9b,role:_0x4e8ecc}=_0xa96190[_0x2d4e9d(0x25c)],_0x5821ef=_0xa96190[_0x2d4e9d(0x25c)],_0x349019=await profile['findOne']({'email':_0x5821ef[_0x2d4e9d(0x1d0)]}),_0x5b13ea=await master_shop['find'](),_0x5a0814=_0xa96190[_0x2d4e9d(0x251)]['id'],_0x9691ea=await purchases[_0x2d4e9d(0x24d)](_0x5a0814),_0x821b5a=await suppliers[_0x2d4e9d(0x294)]({});let _0x4d4886;if(_0x5821ef[_0x2d4e9d(0x1d7)]=='staff'){const _0x5c125b=await staff['findOne']({'email':_0x5821ef[_0x2d4e9d(0x1d0)]});_0x4d4886=await warehouse[_0x2d4e9d(0x294)]({'status':_0x2d4e9d(0x2ac),'name':_0x5c125b[_0x2d4e9d(0x2cf)],'warehouse_category':_0x2d4e9d(0x261)});}else _0x4d4886=await warehouse['aggregate']([{'$match':{'status':_0x2d4e9d(0x2ac),'warehouse_category':_0x2d4e9d(0x261)}},{'$group':{'_id':_0x2d4e9d(0x262),'name':{'$first':_0x2d4e9d(0x262)}}}]);const _0x2913b2=await product[_0x2d4e9d(0x294)]({}),_0xe5ce48=BayBinSelected(_0x9691ea[_0x2d4e9d(0x24f)],_0x9691ea[_0x2d4e9d(0x202)]);let _0x31a091=new Date(_0x9691ea[_0x2d4e9d(0x241)]),_0x4faa86=('0'+_0x31a091['getDate']())[_0x2d4e9d(0x1ef)](-0x2),_0x2010a7=('0'+(_0x31a091[_0x2d4e9d(0x2a0)]()+0x1))[_0x2d4e9d(0x1ef)](-0x2),_0x156488=_0x31a091[_0x2d4e9d(0x2ae)](),_0x774afa=_0x156488+'-'+_0x2010a7+'-'+_0x4faa86;if(_0x5b13ea[0x0][_0x2d4e9d(0x2be)]=='English\x20(US)'){var _0x40131a=users[_0x2d4e9d(0x2b3)];console['log'](_0x40131a);}else{if(_0x5b13ea[0x0][_0x2d4e9d(0x2be)]=='Hindi')var _0x40131a=users[_0x2d4e9d(0x222)];else{if(_0x5b13ea[0x0][_0x2d4e9d(0x2be)]==_0x2d4e9d(0x2c8))var _0x40131a=users[_0x2d4e9d(0x2c8)];else{if(_0x5b13ea[0x0]['language']==_0x2d4e9d(0x228))var _0x40131a=users['Spanish'];else{if(_0x5b13ea[0x0][_0x2d4e9d(0x2be)]==_0x2d4e9d(0x25b))var _0x40131a=users['French'];else{if(_0x5b13ea[0x0][_0x2d4e9d(0x2be)]==_0x2d4e9d(0x21e))var _0x40131a=users[_0x2d4e9d(0x1fe)];else{if(_0x5b13ea[0x0]['language']=='Chinese')var _0x40131a=users[_0x2d4e9d(0x203)];else{if(_0x5b13ea[0x0][_0x2d4e9d(0x2be)]==_0x2d4e9d(0x1e3))var _0x40131a=users[_0x2d4e9d(0x2d4)];}}}}}}}_0x5c9095['render'](_0x2d4e9d(0x2a6),{'success':_0xa96190[_0x2d4e9d(0x23a)](_0x2d4e9d(0x29d)),'errors':_0xa96190[_0x2d4e9d(0x23a)](_0x2d4e9d(0x2c4)),'role':_0x5821ef,'profile':_0x349019,'purchases':_0x9691ea,'suppliers':_0x821b5a,'warehouse':_0x4d4886,'product':_0x2913b2,'master_shop':_0x5b13ea,'language':_0x40131a,'ed_fullDate':_0x774afa,'dataSelected':_0xe5ce48});}catch(_0xc5eb4b){console[_0x2d4e9d(0x1f2)](_0xc5eb4b);}}),router['post'](a0_0x34c840(0x277),auth,async(_0x55b906,_0x3838ef)=>{var _0x25c596=a0_0x34c840;try{const _0x95cae2=_0x55b906['params']['id'],_0x469d03=await purchases[_0x25c596(0x22e)]({'_id':_0x55b906[_0x25c596(0x251)]['id']}),_0x1fab32=await warehouse[_0x25c596(0x22e)]({'name':_0x469d03[_0x25c596(0x24f)],'room':_0x469d03[_0x25c596(0x202)]});_0x469d03[_0x25c596(0x204)][_0x25c596(0x2b8)](_0x51a54c=>{var _0x4d065f=_0x25c596;const _0xf9a343=_0x1fab32[_0x4d065f(0x2cb)]['map'](_0x49266d=>{var _0x5c82a4=_0x4d065f;_0x49266d[_0x5c82a4(0x27d)]==_0x51a54c['product_name']&&_0x49266d[_0x5c82a4(0x2db)]==_0x51a54c[_0x5c82a4(0x2db)]&&_0x49266d['type']==_0x51a54c[_0x5c82a4(0x25d)]&&_0x49266d[_0x5c82a4(0x293)]==_0x51a54c['bin']&&_0x49266d[_0x5c82a4(0x238)]==_0x51a54c['bay']&&_0x49266d[_0x5c82a4(0x20f)]==_0x51a54c[_0x5c82a4(0x20f)]&&_0x49266d['storage']==_0x51a54c[_0x5c82a4(0x206)]&&(_0x49266d[_0x5c82a4(0x212)]=parseInt(_0x49266d[_0x5c82a4(0x212)])-parseInt(_0x51a54c[_0x5c82a4(0x2c2)]));});}),await _0x1fab32[_0x25c596(0x216)]();const {invoice:_0xfbb95b,suppliers:_0x531402,date:_0xfb6822,warehouse_name:_0x356935,prod_name:_0x2aa83d,prod_code:_0x4c7963,prod_qty:_0x44e514,prod_unit:_0x117e74,prod_secondunit:_0x5e6be8,prod_level:_0x34729b,prod_isle:_0x1b2023,prod_pallet:_0x49370a,note:_0xe96327,expiry_date:_0x16619f,batch_code:_0x4e96a6,paid_amount:_0x496ffc,due_amount:_0x21de81,Room_name:_0xa5282d,primary_code:_0x1aa97b,secondary_code:_0x20fade,PO_number:_0x5a26be,JO_number:_0x40a785}=_0x55b906[_0x25c596(0x2a3)];if(typeof _0x2aa83d=='string')var _0x44ecb5=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x22d)]],_0x4d93f1=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x2a9)]],_0x2d400a=[_0x55b906[_0x25c596(0x2a3)]['prod_qty']],_0x558201=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x208)]],_0x12101f=[_0x55b906['body'][_0x25c596(0x235)]],_0xf6a5eb=[_0x55b906[_0x25c596(0x2a3)]['prod_level']],_0x3e1e0b=[_0x55b906[_0x25c596(0x2a3)]['prod_isle']],_0x2917ca=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x264)]],_0x1d8be8=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x237)]],_0x15106d=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x265)]],_0x13740f=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x257)]],_0x437f76=[_0x55b906['body']['batch_code']],_0x30dd56=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x241)]],_0x4562df=[_0x55b906[_0x25c596(0x2a3)]['storage']],_0x53b5eb=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x29f)]],_0x37cdb4=[_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x25d)]];else var _0x44ecb5=[..._0x55b906['body'][_0x25c596(0x22d)]],_0x4d93f1=[..._0x55b906['body'][_0x25c596(0x2a9)]],_0x2d400a=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x25a)]],_0x558201=[..._0x55b906[_0x25c596(0x2a3)]['prod_unit']],_0x12101f=[..._0x55b906['body'][_0x25c596(0x235)]],_0xf6a5eb=[..._0x55b906['body'][_0x25c596(0x21d)]],_0x3e1e0b=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x2a8)]],_0x2917ca=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x264)]],_0x1d8be8=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x237)]],_0x15106d=[..._0x55b906[_0x25c596(0x2a3)]['secondary_code']],_0x13740f=[..._0x55b906[_0x25c596(0x2a3)]['MaxStocks_data']],_0x437f76=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x1ea)]],_0x30dd56=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x241)]],_0x4562df=[..._0x55b906['body']['storage']],_0x53b5eb=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x29f)]],_0x37cdb4=[..._0x55b906[_0x25c596(0x2a3)][_0x25c596(0x25d)]];const _0x10fe86=_0x44ecb5[_0x25c596(0x2eb)](_0x5ddce0=>{return _0x5ddce0={'product_name':_0x5ddce0};});_0x4d93f1[_0x25c596(0x2b8)]((_0x336c2c,_0x471068)=>{var _0x5919d0=_0x25c596;_0x10fe86[_0x471068][_0x5919d0(0x243)]=_0x336c2c;}),_0x2d400a[_0x25c596(0x2b8)]((_0x1b7c97,_0x3928d0)=>{var _0x42a66a=_0x25c596;_0x10fe86[_0x3928d0][_0x42a66a(0x2c2)]=_0x1b7c97;}),_0x558201[_0x25c596(0x2b8)]((_0x392a54,_0x54f233)=>{var _0x51fd93=_0x25c596;_0x10fe86[_0x54f233][_0x51fd93(0x1cd)]=_0x392a54;}),_0x12101f[_0x25c596(0x2b8)]((_0x266efe,_0x35fdc6)=>{var _0x560534=_0x25c596;_0x10fe86[_0x35fdc6][_0x560534(0x2c9)]=_0x266efe;}),_0xf6a5eb[_0x25c596(0x2b8)]((_0x315dba,_0x378231)=>{var _0x44bd23=_0x25c596;_0x10fe86[_0x378231][_0x44bd23(0x238)]=_0x315dba;}),_0x3e1e0b['forEach']((_0x3bcae4,_0x275bcd)=>{var _0xacfffd=_0x25c596;_0x10fe86[_0x275bcd][_0xacfffd(0x293)]=_0x3bcae4;}),_0x2917ca['forEach']((_0x3120ce,_0x1b6b3b)=>{var _0x8aff7=_0x25c596;_0x10fe86[_0x1b6b3b][_0x8aff7(0x2db)]=_0x3120ce;}),_0x1d8be8['forEach']((_0x40a0c8,_0x9d58ae)=>{_0x10fe86[_0x9d58ae]['primary_code']=_0x40a0c8;}),_0x15106d[_0x25c596(0x2b8)]((_0x3c9ebb,_0x11c961)=>{var _0x5f1e87=_0x25c596;_0x10fe86[_0x11c961][_0x5f1e87(0x265)]=_0x3c9ebb;}),_0x13740f[_0x25c596(0x2b8)]((_0x839501,_0x12b19d)=>{var _0x582314=_0x25c596;_0x10fe86[_0x12b19d][_0x582314(0x248)]=_0x839501;}),_0x437f76['forEach']((_0x5b004c,_0x4ff20c)=>{var _0x527ab8=_0x25c596;_0x10fe86[_0x4ff20c][_0x527ab8(0x1ea)]=_0x5b004c;}),_0x30dd56['forEach']((_0x3e614a,_0x13ee0b)=>{var _0x56ea19=_0x25c596;_0x10fe86[_0x13ee0b][_0x56ea19(0x241)]=_0x3e614a;}),_0x37cdb4[_0x25c596(0x2b8)]((_0x4f1b35,_0x3487dd)=>{var _0x5b6611=_0x25c596;_0x10fe86[_0x3487dd][_0x5b6611(0x25d)]=_0x4f1b35;}),_0x4562df[_0x25c596(0x2b8)]((_0x57c54c,_0x7b0291)=>{var _0x1c7936=_0x25c596;_0x10fe86[_0x7b0291][_0x1c7936(0x206)]=_0x57c54c;}),_0x53b5eb[_0x25c596(0x2b8)]((_0xf517a3,_0x3ed480)=>{var _0x3fd52f=_0x25c596;_0x10fe86[_0x3ed480][_0x3fd52f(0x20f)]=_0xf517a3;});const _0x1ee35a=_0x10fe86[_0x25c596(0x1da)](_0x5527d8=>_0x5527d8[_0x25c596(0x2c2)]!=='0'&&_0x5527d8[_0x25c596(0x2c2)]!=='');_0x469d03[_0x25c596(0x1f1)]=_0xfbb95b,_0x469d03[_0x25c596(0x29c)]=_0x531402,_0x469d03[_0x25c596(0x217)]=_0xfb6822,_0x469d03[_0x25c596(0x24f)]=_0x356935,_0x469d03['product']=_0x1ee35a,_0x469d03[_0x25c596(0x28c)]=_0xe96327,_0x469d03['paid_amount']=_0x496ffc,_0x469d03['due_amount']=_0x21de81,_0x469d03[_0x25c596(0x202)]=_0xa5282d,_0x469d03[_0x25c596(0x2e9)]=_0x5a26be,_0x469d03[_0x25c596(0x1f0)]=_0x40a785;const _0x5b9f2f=await _0x469d03['save'](),_0x384d74=await warehouse['findOne']({'name':_0x55b906[_0x25c596(0x2a3)]['warehouse_name'],'room':_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x24c)]});_0x469d03[_0x25c596(0x204)][_0x25c596(0x2b8)](_0x8c4a7c=>{var _0x26b3d6=_0x25c596,_0x31eb2a=0x0;const _0x483832=_0x384d74[_0x26b3d6(0x2cb)][_0x26b3d6(0x2eb)](_0x5df14d=>{var _0xe5e376=_0x26b3d6;_0x5df14d[_0xe5e376(0x27d)]==_0x8c4a7c[_0xe5e376(0x27d)]&&_0x5df14d[_0xe5e376(0x2db)]==_0x8c4a7c[_0xe5e376(0x2db)]&&_0x5df14d[_0xe5e376(0x25d)]==_0x8c4a7c['type']&&_0x5df14d[_0xe5e376(0x293)]==_0x8c4a7c['bin']&&_0x5df14d[_0xe5e376(0x238)]==_0x8c4a7c['bay']&&_0x5df14d[_0xe5e376(0x20f)]==_0x8c4a7c['rack']&&_0x5df14d[_0xe5e376(0x206)]==_0x8c4a7c[_0xe5e376(0x206)]&&(_0x5df14d['product_stock']=parseInt(_0x5df14d['product_stock'])+parseInt(_0x8c4a7c['quantity']),_0x31eb2a++);});_0x31eb2a=='0'&&(_0x384d74['product_details']=_0x384d74['product_details'][_0x26b3d6(0x2b4)]({'product_name':_0x8c4a7c[_0x26b3d6(0x27d)],'product_stock':_0x8c4a7c[_0x26b3d6(0x2c2)],'primary_code':_0x8c4a7c[_0x26b3d6(0x237)],'secondary_code':_0x8c4a7c[_0x26b3d6(0x265)],'product_code':_0x8c4a7c[_0x26b3d6(0x243)],'storage':_0x8c4a7c[_0x26b3d6(0x206)],'rack':_0x8c4a7c[_0x26b3d6(0x20f)],'bay':_0x8c4a7c['bay'],'bin':_0x8c4a7c[_0x26b3d6(0x293)],'type':_0x8c4a7c[_0x26b3d6(0x25d)],'floorlevel':_0x8c4a7c[_0x26b3d6(0x2db)],'maxProducts':_0x8c4a7c[_0x26b3d6(0x248)],'unit':_0x8c4a7c['standard_unit'],'secondary_unit':_0x8c4a7c['secondary_unit'],'expiry_date':_0x8c4a7c[_0x26b3d6(0x241)]}));}),await _0x384d74[_0x25c596(0x216)]();const _0x1d8c61=await s_payment_data[_0x25c596(0x22e)]({'invoice':_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x1f1)]});if(_0x1d8c61===null){}else console[_0x25c596(0x1f2)](_0x25c596(0x29c),_0x1d8c61,_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x1f1)]),_0x1d8c61[_0x25c596(0x29c)]=_0x55b906[_0x25c596(0x2a3)][_0x25c596(0x29c)],await _0x1d8c61[_0x25c596(0x216)]();_0x55b906[_0x25c596(0x23a)](_0x25c596(0x29d),_0x25c596(0x29b)),_0x3838ef[_0x25c596(0x2d9)](_0x25c596(0x209));}catch(_0x1d5a26){console[_0x25c596(0x1f2)](_0x1d5a26);}}),router[a0_0x34c840(0x2c6)](a0_0x34c840(0x1f7),auth,async(_0x5171a7,_0x172d58)=>{var _0x109100=a0_0x34c840;try{const _0x26373a=_0x5171a7[_0x109100(0x251)]['id'],{invoice:_0x22fda,suppliers:_0x3ded65,payable:_0x299f0d,due_amount:_0x34cff8}=_0x5171a7[_0x109100(0x2a3)],_0x224f77=await purchases[_0x109100(0x24d)](_0x26373a);var _0x35e894=_0x299f0d-_0x34cff8;_0x224f77[_0x109100(0x1d2)]=parseFloat(_0x224f77['paid_amount'])+parseFloat(_0x34cff8),_0x224f77[_0x109100(0x266)]=_0x35e894;const _0x418e5a=await _0x224f77[_0x109100(0x216)]();console['log'](_0x418e5a);const _0x3506ee=await s_payment_data[_0x109100(0x22e)]({'invoice':_0x22fda});_0x3506ee['amount']=_0x35e894,await _0x3506ee[_0x109100(0x216)]();let _0x54832e=new Date(),_0x1f72a6=('0'+_0x54832e[_0x109100(0x230)]())[_0x109100(0x1ef)](-0x2),_0x4cec10=('0'+(_0x54832e[_0x109100(0x2a0)]()+0x1))['slice'](-0x2),_0x1b1cab=_0x54832e[_0x109100(0x2ae)](),_0x134f79=_0x1b1cab+'-'+_0x4cec10+'-'+_0x1f72a6;const _0x1368fa=new suppliers_payment({'invoice':_0x22fda,'date':_0x1b1cab+'-'+_0x4cec10+'-'+_0x1f72a6,'suppliers':_0x3ded65,'reason':_0x109100(0x1e2),'amount':_0x34cff8}),_0x5c80a5=await _0x1368fa[_0x109100(0x216)]();_0x5171a7[_0x109100(0x23a)](_0x109100(0x29d),'payment\x20successfull'),_0x172d58['redirect']('/all_purchases/view');}catch(_0x237123){console[_0x109100(0x1f2)](_0x237123);}}),router[a0_0x34c840(0x2ad)](a0_0x34c840(0x2c7),auth,async(_0x5e6bfb,_0x4092c4)=>{var _0x190ed5=a0_0x34c840;try{const {username:_0x1edd95,email:_0x45f424,role:_0xc2850e}=_0x5e6bfb[_0x190ed5(0x25c)],_0x431164=_0x5e6bfb['user'],_0x14127c=await profile[_0x190ed5(0x22e)]({'email':_0x431164[_0x190ed5(0x1d0)]}),_0x3684cc=await master_shop[_0x190ed5(0x294)]();console[_0x190ed5(0x1f2)]('master',_0x3684cc);const _0x1e034b=_0x5e6bfb['params']['id'],_0x3f0ca1=await purchases[_0x190ed5(0x24d)](_0x1e034b);console['log'](_0x3f0ca1);const _0x369fef=await suppliers[_0x190ed5(0x22e)]({'name':_0x3f0ca1[_0x190ed5(0x29c)]});console[_0x190ed5(0x1f2)](_0x369fef);if(_0x3684cc[0x0][_0x190ed5(0x2be)]==_0x190ed5(0x29e)){var _0x18e499=users['English'];console[_0x190ed5(0x1f2)](_0x18e499);}else{if(_0x3684cc[0x0][_0x190ed5(0x2be)]==_0x190ed5(0x222))var _0x18e499=users['Hindi'];else{if(_0x3684cc[0x0]['language']==_0x190ed5(0x2c8))var _0x18e499=users['German'];else{if(_0x3684cc[0x0]['language']==_0x190ed5(0x228))var _0x18e499=users[_0x190ed5(0x228)];else{if(_0x3684cc[0x0][_0x190ed5(0x2be)]==_0x190ed5(0x25b))var _0x18e499=users[_0x190ed5(0x25b)];else{if(_0x3684cc[0x0]['language']==_0x190ed5(0x21e))var _0x18e499=users[_0x190ed5(0x1fe)];else{if(_0x3684cc[0x0][_0x190ed5(0x2be)]==_0x190ed5(0x203))var _0x18e499=users[_0x190ed5(0x203)];else{if(_0x3684cc[0x0][_0x190ed5(0x2be)]==_0x190ed5(0x1e3))var _0x18e499=users[_0x190ed5(0x2d4)];}}}}}}}_0x4092c4[_0x190ed5(0x2b9)](_0x190ed5(0x246),{'success':_0x5e6bfb[_0x190ed5(0x23a)](_0x190ed5(0x29d)),'errors':_0x5e6bfb[_0x190ed5(0x23a)](_0x190ed5(0x2c4)),'role':_0x431164,'profile':_0x14127c,'master_shop':_0x3684cc,'supplier':_0x369fef,'purchase':_0x3f0ca1,'language':_0x18e499});}catch(_0x405841){console[_0x190ed5(0x1f2)](_0x405841);}}),router[a0_0x34c840(0x2ad)](a0_0x34c840(0x25e),auth,async(_0x2c943a,_0x2a178f)=>{var _0x4f0f07=a0_0x34c840;try{const {username:_0x1e06c0,email:_0x3830f7,role:_0xa92ffb}=_0x2c943a[_0x4f0f07(0x25c)],_0x3407b1=_0x2c943a[_0x4f0f07(0x25c)],_0x28bfb=await profile['findOne']({'email':_0x3407b1[_0x4f0f07(0x1d0)]}),_0x5ebc9b=await master_shop[_0x4f0f07(0x294)]();console['log'](_0x4f0f07(0x2b1),_0x5ebc9b);const _0x4a1ab2=_0x2c943a['params']['id'];console[_0x4f0f07(0x1f2)](_0x4a1ab2);const _0x462fe1=await purchases['findById'](_0x4a1ab2);console['log'](_0x4f0f07(0x28a),_0x462fe1);const _0x52bde9=await product[_0x4f0f07(0x294)]({}),_0x3b4001=await warehouse['aggregate']([{'$match':{'name':_0x462fe1[_0x4f0f07(0x24f)],'room':_0x462fe1[_0x4f0f07(0x202)],'warehouse_category':'Raw\x20Materials'}},{'$unwind':_0x4f0f07(0x255)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x4f0f07(0x2a4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4f0f07(0x2e7)},'type':{'$first':_0x4f0f07(0x289)},'floorlevel':{'$first':_0x4f0f07(0x21b)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x4f0f07(0x2df)},'product_code':{'$first':_0x4f0f07(0x224)},'storage':{'$first':_0x4f0f07(0x1e9)},'rack':{'$first':'$product_details.rack'}}}]);warehouse_data=await warehouse['aggregate']([{'$match':{'status':_0x4f0f07(0x2ac),'name':'Return\x20Goods','warehouse_category':_0x4f0f07(0x261)}},{'$group':{'_id':'$name','name':{'$first':_0x4f0f07(0x262)}}},{'$sort':{'name':0x1}}]),console[_0x4f0f07(0x1f2)](_0x4f0f07(0x2c0),_0x3b4001);if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]==_0x4f0f07(0x29e)){var _0x1c6273=users[_0x4f0f07(0x2b3)];console['log'](_0x1c6273);}else{if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]==_0x4f0f07(0x222))var _0x1c6273=users['Hindi'];else{if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]==_0x4f0f07(0x2c8))var _0x1c6273=users[_0x4f0f07(0x2c8)];else{if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]=='Spanish')var _0x1c6273=users['Spanish'];else{if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]==_0x4f0f07(0x25b))var _0x1c6273=users['French'];else{if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]==_0x4f0f07(0x21e))var _0x1c6273=users[_0x4f0f07(0x1fe)];else{if(_0x5ebc9b[0x0]['language']=='Chinese')var _0x1c6273=users[_0x4f0f07(0x203)];else{if(_0x5ebc9b[0x0][_0x4f0f07(0x2be)]=='Arabic\x20(ae)')var _0x1c6273=users['Arabic'];}}}}}}}_0x2a178f['render'](_0x4f0f07(0x272),{'success':_0x2c943a['flash'](_0x4f0f07(0x29d)),'errors':_0x2c943a['flash'](_0x4f0f07(0x2c4)),'role':_0x3407b1,'profile':_0x28bfb,'user':_0x462fe1,'stock':_0x3b4001,'master_shop':_0x5ebc9b,'product':_0x52bde9,'language':_0x1c6273,'warehouse':warehouse_data});}catch(_0x2888f6){console[_0x4f0f07(0x1f2)](_0x2888f6);}}),router[a0_0x34c840(0x2c6)](a0_0x34c840(0x25e),auth,async(_0x3a506b,_0x256b13)=>{var _0x5f55fa=a0_0x34c840;try{const {invoice:_0x141253,date:_0x1fb96d,warehouse_name:_0x301f53,Room_name:_0x6d612e,product_name:_0xc70886,purchase_quantity:_0xf205de,stocks:_0x6b447,return_qty:_0xe8b92,note:_0x3690c5,level:_0x4c8fe4,isle:_0x3e90a5,pallet:_0x3780af,to_warehouse_name:_0x1a3b86,to_Room_name:_0x1040f9}=_0x3a506b['body'],_0x21b648=await purchases['findOne']({'_id':_0x3a506b[_0x5f55fa(0x251)]['id']}),_0x743ac9=await warehouse[_0x5f55fa(0x22e)]({'name':_0x301f53,'room':_0x6d612e});if(typeof _0xc70886==_0x5f55fa(0x259))var _0x2a8905=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x27d)]],_0x45e019=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x1df)]],_0x484dbb=[_0x3a506b[_0x5f55fa(0x2a3)]['stocks']],_0x2edd20=[_0x3a506b[_0x5f55fa(0x2a3)]['return_qty']],_0x41c667=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x1cf)]],_0x460ac2=[_0x3a506b['body'][_0x5f55fa(0x211)]],_0x3a0dac=[_0x3a506b['body']['pallet']],_0x38cf33=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x20a)]],_0x4340a6=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x2d7)]],_0x4ff4f0=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x1fa)]],_0x4c85b3=[_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x2a2)]];else var _0x2a8905=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x27d)]],_0x45e019=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x1df)]],_0x484dbb=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x210)]],_0x2edd20=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x1ed)]],_0x41c667=[..._0x3a506b[_0x5f55fa(0x2a3)]['level']],_0x460ac2=[..._0x3a506b['body'][_0x5f55fa(0x211)]],_0x3a0dac=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x27a)]],_0x38cf33=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x20a)]],_0x4340a6=[..._0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x2d7)]],_0x4ff4f0=[..._0x3a506b[_0x5f55fa(0x2a3)]['primary_code_hide']],_0x4c85b3=[..._0x3a506b[_0x5f55fa(0x2a3)]['secondary_code_hide']];const _0x44b057=_0x2a8905[_0x5f55fa(0x2eb)](_0x20d33e=>{return _0x20d33e={'product_name':_0x20d33e};});_0x45e019['forEach']((_0x25e984,_0x266b33)=>{var _0x2de297=_0x5f55fa;_0x44b057[_0x266b33][_0x2de297(0x1df)]=_0x25e984;}),_0x484dbb['forEach']((_0x2513a7,_0x55f7ff)=>{var _0x5c4947=_0x5f55fa;_0x44b057[_0x55f7ff][_0x5c4947(0x1e8)]=_0x2513a7;}),_0x2edd20[_0x5f55fa(0x2b8)]((_0x2aae28,_0x4f4d40)=>{var _0x64f6c1=_0x5f55fa;_0x44b057[_0x4f4d40][_0x64f6c1(0x1ed)]=_0x2aae28;}),_0x41c667[_0x5f55fa(0x2b8)]((_0x509f70,_0x505982)=>{var _0x2b7d70=_0x5f55fa;_0x44b057[_0x505982][_0x2b7d70(0x238)]=_0x509f70;}),_0x460ac2[_0x5f55fa(0x2b8)]((_0x33be4f,_0x205dd2)=>{_0x44b057[_0x205dd2]['bin']=_0x33be4f;}),_0x3a0dac[_0x5f55fa(0x2b8)]((_0x4e4a90,_0x23117e)=>{var _0x5b2408=_0x5f55fa;_0x44b057[_0x23117e][_0x5b2408(0x2db)]=_0x4e4a90;}),_0x38cf33[_0x5f55fa(0x2b8)]((_0x43cfe6,_0x5f37bf)=>{var _0xd9d410=_0x5f55fa;_0x44b057[_0x5f37bf][_0xd9d410(0x25d)]=_0x43cfe6;}),_0x4340a6['forEach']((_0x532b36,_0x1e574d)=>{var _0x7556de=_0x5f55fa;_0x44b057[_0x1e574d][_0x7556de(0x243)]=_0x532b36;}),_0x4ff4f0[_0x5f55fa(0x2b8)]((_0x30b2ef,_0x212ae0)=>{var _0xfdae95=_0x5f55fa;_0x44b057[_0x212ae0][_0xfdae95(0x237)]=_0x30b2ef;}),_0x4c85b3[_0x5f55fa(0x2b8)]((_0x4068a2,_0x2e4eb9)=>{var _0x590b60=_0x5f55fa;_0x44b057[_0x2e4eb9][_0x590b60(0x265)]=_0x4068a2;}),_0x21b648[_0x5f55fa(0x204)][_0x5f55fa(0x2b8)](_0x2029a9=>{var _0x276843=_0x5f55fa;const _0x246050=_0x743ac9[_0x276843(0x2cb)][_0x276843(0x2eb)](_0x4cd776=>{var _0x1c3826=_0x276843;_0x4cd776['product_name']==_0x2029a9[_0x1c3826(0x27d)]&&_0x4cd776[_0x1c3826(0x2db)]==_0x2029a9[_0x1c3826(0x2db)]&&_0x4cd776[_0x1c3826(0x25d)]==_0x2029a9[_0x1c3826(0x25d)]&&_0x4cd776[_0x1c3826(0x293)]==_0x2029a9[_0x1c3826(0x293)]&&_0x4cd776[_0x1c3826(0x238)]==_0x2029a9['bay']&&_0x4cd776[_0x1c3826(0x20f)]==_0x2029a9[_0x1c3826(0x20f)]&&_0x4cd776[_0x1c3826(0x206)]==_0x2029a9[_0x1c3826(0x206)]&&(console['log'](parseInt(_0x4cd776[_0x1c3826(0x212)])+'\x20<>\x20'+parseInt(_0x2029a9[_0x1c3826(0x2c2)])),_0x4cd776['product_stock']=parseInt(_0x4cd776[_0x1c3826(0x212)])+parseInt(_0x2029a9[_0x1c3826(0x2c2)]));});}),await _0x743ac9['save']();const _0x33a595=_0x44b057[_0x5f55fa(0x1da)](_0x4f8bbf=>_0x4f8bbf[_0x5f55fa(0x1ed)]!=='0'&&_0x4f8bbf[_0x5f55fa(0x1ed)]!=='');var _0x14edc9=0x0;_0x33a595[_0x5f55fa(0x2b8)](_0x4c6a1c=>{var _0xfcbb54=_0x5f55fa;console[_0xfcbb54(0x1f2)](_0xfcbb54(0x2cc),_0x4c6a1c),(parseInt(_0x4c6a1c[_0xfcbb54(0x1df)])<parseInt(_0x4c6a1c[_0xfcbb54(0x1ed)])||parseInt(_0x4c6a1c[_0xfcbb54(0x1e8)])<parseInt(_0x4c6a1c['return_qty']))&&_0x14edc9++;});if(_0x14edc9!=0x0)return _0x3a506b[_0x5f55fa(0x23a)](_0x5f55fa(0x2c4),_0x5f55fa(0x23e)),_0x256b13['redirect'](_0x5f55fa(0x1f5));const _0x2270f2=new purchases_return({'invoice':_0x141253,'suppliers':_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x29c)],'date':_0x1fb96d,'warehouse_name':_0x301f53,'return_product':_0x33a595,'note':_0x3690c5,'room':_0x6d612e,'to_warehouse_name':_0x1a3b86,'to_room':_0x1040f9}),_0x2f4606=await _0x2270f2[_0x5f55fa(0x216)]();console[_0x5f55fa(0x1f2)](_0x2270f2);const _0x1ea85c=await purchases_return[_0x5f55fa(0x22e)]({'invoice':_0x141253}),_0x5a1809=await warehouse[_0x5f55fa(0x22e)]({'name':_0x1a3b86,'room':_0x1040f9});_0x1ea85c[_0x5f55fa(0x2e6)][_0x5f55fa(0x2b8)](_0x4e2d50=>{var _0x44abd0=_0x5f55fa,_0x46a5a7=0x0;const _0x48aeb0=_0x5a1809[_0x44abd0(0x2cb)]['map'](_0xac323a=>{var _0x558e06=_0x44abd0;_0xac323a[_0x558e06(0x27d)]==_0x4e2d50['product_name']&&_0xac323a['floorlevel']==_0x4e2d50[_0x558e06(0x2db)]&&_0xac323a['type']==_0x4e2d50[_0x558e06(0x25d)]&&_0xac323a[_0x558e06(0x293)]==_0x4e2d50[_0x558e06(0x293)]&&_0xac323a[_0x558e06(0x238)]==_0x4e2d50[_0x558e06(0x238)]&&(_0xac323a[_0x558e06(0x212)]=parseInt(_0xac323a[_0x558e06(0x212)])-parseInt(_0x4e2d50[_0x558e06(0x1ed)]),_0x46a5a7++);});_0x46a5a7=='0'&&(_0x5a1809[_0x44abd0(0x2cb)]=_0x5a1809[_0x44abd0(0x2cb)]['concat']({'product_name':_0x4e2d50['product_name'],'product_stock':_0x4e2d50[_0x44abd0(0x1ed)],'primary_code':_0x4e2d50['primary_code'],'secondary_code':_0x4e2d50['secondary_code'],'product_code':_0x4e2d50[_0x44abd0(0x243)],'storage':_0x4e2d50[_0x44abd0(0x206)],'rack':_0x4e2d50[_0x44abd0(0x20f)],'bay':_0x4e2d50['bay'],'bin':_0x4e2d50[_0x44abd0(0x293)],'type':_0x4e2d50['type'],'floorlevel':_0x4e2d50[_0x44abd0(0x2db)],'maxProducts':_0x4e2d50[_0x44abd0(0x248)],'unit':_0x4e2d50[_0x44abd0(0x1cd)],'secondary_unit':_0x4e2d50['secondary_unit'],'expiry_date':_0x4e2d50[_0x44abd0(0x241)]}));}),await _0x5a1809[_0x5f55fa(0x216)]();const _0x3e484e=await purchases[_0x5f55fa(0x22e)]({'invoice':_0x141253});_0x3e484e['return_data']='True';const _0xfc8a57=await _0x3e484e[_0x5f55fa(0x216)](),_0x2ad0b0=new s_payment_data({'invoice':_0x141253,'suppliers':_0x3a506b['body']['suppliers'],'reason':_0x5f55fa(0x1e7)});await _0x2ad0b0[_0x5f55fa(0x216)]();const _0x3e0539=await master_shop['find']();console[_0x5f55fa(0x1f2)](_0x5f55fa(0x21a),_0x3e0539[0x0][_0x5f55fa(0x2ca)]);const _0x465023=await email_settings[_0x5f55fa(0x22e)](),_0x388e7e=await suppliers['findOne']({'name':_0x3a506b[_0x5f55fa(0x2a3)][_0x5f55fa(0x29c)]});console[_0x5f55fa(0x1f2)](_0x5f55fa(0x2d3),_0x388e7e);_0x3e0539[0x0][_0x5f55fa(0x2b5)]==0x1?(right_currency=_0x3e0539[0x0]['currency'],left_currency=''):(right_currency='',left_currency=_0x3e0539[0x0][_0x5f55fa(0x1f9)]);var _0x5f56b4=_0x2a8905,_0x2cb1a6=_0x2edd20,_0x3a8988='',_0x437794;for(_0x437794 in _0x5f56b4){_0x3a8988+=_0x5f55fa(0x26b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5f56b4[_0x437794]+_0x5f55fa(0x263)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2cb1a6[_0x437794]+_0x5f55fa(0x263)+_0x5f55fa(0x21c);}console[_0x5f55fa(0x1f2)](_0x5f55fa(0x2dd),_0x3a8988);let _0xf852ad=nodemailer[_0x5f55fa(0x2e0)]({'service':_0x5f55fa(0x20e),'auth':{'user':_0x465023[_0x5f55fa(0x1d0)],'pass':_0x465023[_0x5f55fa(0x285)]}}),_0x499612={'from':_0x465023[_0x5f55fa(0x1d0)],'to':_0x388e7e[_0x5f55fa(0x1d0)],'subject':_0x5f55fa(0x295),'attachments':[{'filename':_0x5f55fa(0x2b0),'path':__dirname+_0x5f55fa(0x24b)+'/upload/'+_0x3e0539[0x0][_0x5f55fa(0x2ca)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5f55fa(0x1e1)+_0x5f55fa(0x234)+'<div>'+_0x5f55fa(0x23f)+_0x5f55fa(0x276)+_0x5f55fa(0x242)+_0x5f55fa(0x26f)+_0x5f55fa(0x276)+_0x5f55fa(0x2bd)+_0x3e0539[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x5f55fa(0x26f)+'<hr\x20class=\x22my-3\x22>'+_0x5f55fa(0x276)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5f55fa(0x271)+_0x141253+'\x20'+_0x5f55fa(0x254)+_0x5f55fa(0x227)+_0x1fb96d+'\x20'+_0x5f55fa(0x297)+_0x5f55fa(0x1e4)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5f55fa(0x1f4)+'<tr>'+_0x5f55fa(0x1d8)+_0x5f55fa(0x28e)+_0x5f55fa(0x2e4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Total\x20</th>'+'</tr>'+_0x5f55fa(0x1d5)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3a8988+'\x20'+_0x5f55fa(0x205)+'</table>'+_0x5f55fa(0x276)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x3e0539[0x0][_0x5f55fa(0x1d1)]+_0x5f55fa(0x1e4)+_0x5f55fa(0x26f)+_0x5f55fa(0x26f)+_0x5f55fa(0x281)};_0xf852ad[_0x5f55fa(0x232)](_0x499612,function(_0x16158a,_0x540462){var _0x383fe1=_0x5f55fa;_0x16158a?(console[_0x383fe1(0x1f2)](_0x16158a),console[_0x383fe1(0x1f2)]('Error\x20Occurs')):console[_0x383fe1(0x1f2)](_0x383fe1(0x24a));}),_0x3a506b[_0x5f55fa(0x23a)]('success',_0x5f55fa(0x223)),_0x256b13[_0x5f55fa(0x2d9)](_0x5f55fa(0x209));}catch(_0x3ce368){console[_0x5f55fa(0x1f2)](_0x3ce368),_0x256b13[_0x5f55fa(0x2ed)](0xc8)[_0x5f55fa(0x22f)]({'message':_0x3ce368[_0x5f55fa(0x22a)]});}}),router[a0_0x34c840(0x2ad)](a0_0x34c840(0x28b),auth,async(_0x5c8892,_0x4397b3)=>{var _0x3f6eee=a0_0x34c840;try{const {username:_0x2807d5,email:_0x2e9546,role:_0x37306b}=_0x5c8892[_0x3f6eee(0x25c)],_0x213c0f=_0x5c8892[_0x3f6eee(0x25c)],_0x2d2549=await profile[_0x3f6eee(0x22e)]({'email':_0x213c0f[_0x3f6eee(0x1d0)]}),_0x3999bc=await master_shop['find'](),_0x54397c=_0x5c8892[_0x3f6eee(0x251)]['id'],_0x4301b8=await purchases['findById'](_0x54397c);if(_0x3999bc[0x0][_0x3f6eee(0x2be)]==_0x3f6eee(0x29e))var _0x2b9baf=users['English'];else{if(_0x3999bc[0x0]['language']==_0x3f6eee(0x222))var _0x2b9baf=users['Hindi'];else{if(_0x3999bc[0x0][_0x3f6eee(0x2be)]==_0x3f6eee(0x2c8))var _0x2b9baf=users[_0x3f6eee(0x2c8)];else{if(_0x3999bc[0x0]['language']==_0x3f6eee(0x228))var _0x2b9baf=users[_0x3f6eee(0x228)];else{if(_0x3999bc[0x0][_0x3f6eee(0x2be)]==_0x3f6eee(0x25b))var _0x2b9baf=users[_0x3f6eee(0x25b)];else{if(_0x3999bc[0x0]['language']==_0x3f6eee(0x21e))var _0x2b9baf=users[_0x3f6eee(0x1fe)];else{if(_0x3999bc[0x0]['language']==_0x3f6eee(0x203))var _0x2b9baf=users['Chinese'];else{if(_0x3999bc[0x0][_0x3f6eee(0x2be)]==_0x3f6eee(0x1e3))var _0x2b9baf=users['Arabic'];}}}}}}}_0x4397b3[_0x3f6eee(0x2b9)](_0x3f6eee(0x1d3),{'success':_0x5c8892[_0x3f6eee(0x23a)](_0x3f6eee(0x29d)),'errors':_0x5c8892['flash'](_0x3f6eee(0x2c4)),'role':_0x213c0f,'profile':_0x2d2549,'alldata':_0x4301b8,'master_shop':_0x3999bc,'language':_0x2b9baf}),console[_0x3f6eee(0x1f2)](alldata);}catch(_0x1fcabf){console[_0x3f6eee(0x1f2)](_0x1fcabf);}}),router['post'](a0_0x34c840(0x1ce),async(_0x4ae06e,_0xdefcae)=>{var _0x45554b=a0_0x34c840;const {product_code:_0x278ceb}=_0x4ae06e[_0x45554b(0x2a3)];var _0x4148ec;const _0x47bc38=await product[_0x45554b(0x26a)]([{'$match':{'primary_code':_0x278ceb,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x45554b(0x2e5),'name':{'$first':_0x45554b(0x262)},'category':{'$first':_0x45554b(0x296)},'brand':{'$first':_0x45554b(0x24e)},'unit':{'$first':_0x45554b(0x1ec)},'alertquantity':{'$first':_0x45554b(0x282)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x45554b(0x2ba)},'secondary_code':{'$first':_0x45554b(0x2af)},'maxStocks':{'$first':_0x45554b(0x2da)},'maxProdPerUnit':{'$first':_0x45554b(0x2b2)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x45554b(0x2bc)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x5376f8=await product['aggregate']([{'$match':{'secondary_code':_0x278ceb,'product_category':_0x45554b(0x261)}},{'$group':{'_id':'$_id','name':{'$first':_0x45554b(0x262)},'category':{'$first':_0x45554b(0x296)},'brand':{'$first':'$brand'},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x45554b(0x282)},'product_code':{'$first':_0x45554b(0x2e3)},'primary_code':{'$first':_0x45554b(0x2ba)},'secondary_code':{'$first':_0x45554b(0x2af)},'maxStocks':{'$first':_0x45554b(0x2da)},'maxProdPerUnit':{'$first':_0x45554b(0x2b2)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x47bc38[_0x45554b(0x200)]>0x0)_0x4148ec=_0x47bc38;else _0x5376f8[_0x45554b(0x200)]>0x0&&(_0x4148ec=_0x5376f8);_0xdefcae[_0x45554b(0x22f)](_0x4148ec);}),router[a0_0x34c840(0x2c6)](a0_0x34c840(0x218),async(_0x141f99,_0x4a8980)=>{var _0x3fe973=a0_0x34c840;const {primaryCode:_0x476371,secondaryCode:_0xf0cf85,productCode:_0xb87531,bay:_0x394bc5,bin:_0x19df74,types:_0x26604a,pallet:_0x5bb6b3,warehouses:_0x2c634c,room:_0x31fb65}=_0x141f99[_0x3fe973(0x2a3)];console['log'](_0x141f99[_0x3fe973(0x2a3)]);try{const _0xb3063a=await warehouse[_0x3fe973(0x26a)]([{'$match':{'name':_0x2c634c,'room':_0x31fb65}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':_0x394bc5,'product_details.bin':_0x19df74,'product_details.type':_0x26604a}},{'$group':{'_id':_0x3fe973(0x2ec),'name':{'$first':_0x3fe973(0x2a4)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x3fe973(0x287)},'isle':{'$first':'$product_details.isle'},'pallet':{'$first':_0x3fe973(0x201)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x4a8980[_0x3fe973(0x2ed)](0xc8)[_0x3fe973(0x22f)](_0xb3063a);}catch(_0x209ff4){_0x4a8980['status'](0x194)['json']({'message':_0x209ff4[_0x3fe973(0x22a)]});}}),module[a0_0x34c840(0x207)]=router;