var a0_0x3374e7=a0_0xa5cd;(function(_0x198d67,_0x20c3cf){var _0x9a02f3=a0_0xa5cd,_0x2f34c8=_0x198d67();while(!![]){try{var _0x17cba9=parseInt(_0x9a02f3(0x152))/0x1*(parseInt(_0x9a02f3(0xf0))/0x2)+parseInt(_0x9a02f3(0x124))/0x3*(parseInt(_0x9a02f3(0x175))/0x4)+parseInt(_0x9a02f3(0x1b4))/0x5+parseInt(_0x9a02f3(0x1b6))/0x6*(parseInt(_0x9a02f3(0x10d))/0x7)+parseInt(_0x9a02f3(0x155))/0x8*(parseInt(_0x9a02f3(0x190))/0x9)+parseInt(_0x9a02f3(0x10c))/0xa+-parseInt(_0x9a02f3(0x18e))/0xb;if(_0x17cba9===_0x20c3cf)break;else _0x2f34c8['push'](_0x2f34c8['shift']());}catch(_0x188398){_0x2f34c8['push'](_0x2f34c8['shift']());}}}(a0_0x1bcf,0xb5a24));function a0_0xa5cd(_0x14e471,_0x460b45){var _0x1bcf16=a0_0x1bcf();return a0_0xa5cd=function(_0xa5cd89,_0x32e4a9){_0xa5cd89=_0xa5cd89-0xed;var _0x3fe885=_0x1bcf16[_0xa5cd89];return _0x3fe885;},a0_0xa5cd(_0x14e471,_0x460b45);}const express=require('express'),app=express(),router=express[a0_0x3374e7(0xf3)](),auth=require(a0_0x3374e7(0x156)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x3374e7(0x12e)),nodemailer=require(a0_0x3374e7(0x17f));router[a0_0x3374e7(0x178)](a0_0x3374e7(0x15c),auth,async(_0x4bfa3f,_0x1cbabf)=>{var _0x4c56d6=a0_0x3374e7;try{const {username:_0x5db8de,email:_0x3b269f,role:_0x5ae929}=_0x4bfa3f[_0x4c56d6(0x144)],_0x119b08=_0x4bfa3f['user'],_0x23609a=await profile['findOne']({'email':_0x119b08[_0x4c56d6(0xed)]}),_0x43a0b3=await master_shop['find']();let _0x5a1b8f;if(_0x119b08[_0x4c56d6(0x1a8)]=='staff'){const _0x2a610e=await staff['findOne']({'email':_0x119b08[_0x4c56d6(0xed)]});_0x5a1b8f=await warehouse[_0x4c56d6(0x121)]({'status':_0x4c56d6(0x1b0),'name':_0x2a610e[_0x4c56d6(0x114)]});}else _0x5a1b8f=await warehouse[_0x4c56d6(0x121)]({'status':_0x4c56d6(0x1b0)});const _0x25bb3d=await product[_0x4c56d6(0x121)]();let _0x475f1b;if(_0x119b08[_0x4c56d6(0x1a8)]==_0x4c56d6(0x1b7)){const _0x5bf9e8=await staff[_0x4c56d6(0x1a5)]({'email':_0x119b08[_0x4c56d6(0xed)]});_0x475f1b=await adjustment_finished['find']({'warehouse_name':_0x5bf9e8[_0x4c56d6(0x114)]});}else _0x475f1b=await adjustment_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x4c56d6(0x16a),'invoice':{'$first':_0x4c56d6(0xf2)},'date':{'$first':_0x4c56d6(0x13d)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x4c56d6(0x1a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x43a0b3[0x0]['language']==_0x4c56d6(0x12f)){var _0x2ae448=users[_0x4c56d6(0x182)];console['log'](_0x2ae448);}else{if(_0x43a0b3[0x0][_0x4c56d6(0x176)]==_0x4c56d6(0x186))var _0x2ae448=users[_0x4c56d6(0x186)];else{if(_0x43a0b3[0x0][_0x4c56d6(0x176)]=='German')var _0x2ae448=users['German'];else{if(_0x43a0b3[0x0][_0x4c56d6(0x176)]==_0x4c56d6(0x139))var _0x2ae448=users[_0x4c56d6(0x139)];else{if(_0x43a0b3[0x0][_0x4c56d6(0x176)]==_0x4c56d6(0xf9))var _0x2ae448=users[_0x4c56d6(0xf9)];else{if(_0x43a0b3[0x0][_0x4c56d6(0x176)]=='Portuguese\x20(BR)')var _0x2ae448=users['Portuguese'];else{if(_0x43a0b3[0x0][_0x4c56d6(0x176)]==_0x4c56d6(0x122))var _0x2ae448=users['Chinese'];else{if(_0x43a0b3[0x0]['language']=='Arabic\x20(ae)')var _0x2ae448=users[_0x4c56d6(0x103)];}}}}}}}_0x1cbabf[_0x4c56d6(0x120)](_0x4c56d6(0x199),{'success':_0x4bfa3f[_0x4c56d6(0x127)](_0x4c56d6(0x13b)),'errors':_0x4bfa3f[_0x4c56d6(0x127)]('errors'),'role':_0x119b08,'profile':_0x23609a,'warehouse':_0x5a1b8f,'product':_0x25bb3d,'adjustment':_0x475f1b,'master_shop':_0x43a0b3,'language':_0x2ae448});}catch(_0x4958a7){console[_0x4c56d6(0x14f)](_0x4958a7);}});function a0_0x1bcf(){var _0x34cae7=['adjustment\x20data\x20update\x20successfully','$product_details._id','level','<h2>\x20','Enabled','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.primary_code','post','6223595rcSAdC','/../public','6pfHgzf','staff','split','email','$product_details.secondary_unit','<html><head><title></title>','2SBesGR','An\x20error\x20occurred.','$invoice','Router','Arabic\x20(ae)','$name','bay','$product.product_name','stock','French','save','<hr\x20class=\x22my-3\x22>','exports','types','$product_details.product_stock','maxPerUnit','redirect','QA\x20Warehouse','$product_details.product_code','Arabic','master','/adjustment/view','Logo.png','</td>','logo','Secondary_units','length','$product_details.product_name','14600110ltuilf','4294941vJMnfp','errors','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<tr>','push','JO_number','warehouse','error','_id','findById','</span>','<div>','body','An\x20error\x20occurred\x20while\x20saving\x20data.','invoice','padStart','Enclosed','aggregate','render','find','Chinese','<h5\x20style=\x22text-align:\x20left;\x22>','3EXVUIR','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','flash','\x20Order\x20Number\x20:\x20','Email\x20sent\x20successfully','<tbody\x20style=\x22text-align:\x20center;\x22>','getFullYear','New_Qty_Converted','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','../public/language/languages.json','English\x20(US)','$product_details','message','True','forEach','Primary_Units','German','product','batch_code','production_date','Spanish','$product_details.floorlevel','success','minus','$date','Error\x20Occurs','</tr>','Portuguese\x20(BR)','$product_details.type','ADJF-','product_stock','user','$product_details.batch_code','<h5>','$product_details.maxPerUnit','Return\x20Rooms','$product_details.bin','Ambient','catch','<span\x20style=\x22float:\x20right;\x22>','$product_details.bay','floor','log','<table\x20style=\x22width:\x20100%\x20!important;\x22>','room','400129NsvwKk','password','stockBefore','104OqPfPu','../middleware/auth','secondary_unit','unit','prod_invoice','product_details','prod_cat','/view','prod_code','room_names','$product_details.rack','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','add_adjustment_finished','status','json','</body></html>','/preview/:id','Adjustment\x20Mail','params','foreach\x20newproduct','$_id','<strong>\x20Regards\x20</strong>','product_code','site_title','host','adjust_qty','$product_details.maxProducts','</h5>','</head><body>','/CheckingWarehouse','all','5700908TFALsU','language','port','get','Finished\x20Goods','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','Portuguese','date','/picking_list/PDF_adjustment/','purchases_data','nodemailer','getDate','/view/add_adjustment','English','edit_adjustment_finished_view','$product_details.secondary_code','filter','Hindi','product_name','string','back','$product_details.production_date','then','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','adjustment\x20add\x20successfull','49514993uFkNPf','/barcode_scanner','70398nLktnY','New_Qty_Converted_adj','random','getMonth','$product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.unit','prod_name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','adjustment_finished','$room','expiry_date','slice','map','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','toString','</div>','new_adjust_qty','$product_details.invoice','Rooms','$product_details.expiry_date','findOne','$finalize','/view/:id','role','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/upload/','edit_adjustment_finished'];a0_0x1bcf=function(){return _0x34cae7;};return a0_0x1bcf();}async function getRandom8DigitNumber(){var _0x2c2b42=a0_0x3374e7;const _0x362236=0x989680,_0x5108a4=0x5f5e0ff,_0x304aa2=Math[_0x2c2b42(0x14e)](Math[_0x2c2b42(0x192)]()*(_0x5108a4-_0x362236+0x1))+_0x362236;var _0x547010;const _0x11f389=await adjustment_finished['findOne']({'invoice':_0x2c2b42(0x142)+_0x304aa2});return _0x11f389&&_0x11f389[_0x2c2b42(0x10a)]>0x0?_0x547010=_0x2c2b42(0x142)+_0x304aa2:_0x547010=_0x2c2b42(0x142)+_0x304aa2,_0x547010;}router['get'](a0_0x3374e7(0x181),auth,async(_0x383bbb,_0x2f6ea2)=>{var _0x6918f6=a0_0x3374e7;try{const {username:_0x167ae3,email:_0x53377b,role:_0x134303}=_0x383bbb[_0x6918f6(0x144)],_0x5c3b3e=_0x383bbb['user'],_0x365111=await profile[_0x6918f6(0x1a5)]({'email':_0x5c3b3e[_0x6918f6(0xed)]}),_0x4b72f0=await master_shop['find']();let _0x345a5e;if(_0x5c3b3e[_0x6918f6(0x1a8)]==_0x6918f6(0x1b7)){const _0x7da2c8=await staff['findOne']({'email':_0x5c3b3e['email']});_0x345a5e=await warehouse[_0x6918f6(0x11f)]([{'$match':{'status':_0x6918f6(0x1b0),'name':_0x7da2c8[_0x6918f6(0x114)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x6918f6(0x101)}}},{'$group':{'_id':_0x6918f6(0xf5),'name':{'$first':'$name'}}}]);}else _0x345a5e=await warehouse[_0x6918f6(0x11f)]([{'$match':{'status':'Enabled','warehouse_category':_0x6918f6(0x179),'name':{'$ne':_0x6918f6(0x101)}}},{'$group':{'_id':'$name','name':{'$first':_0x6918f6(0xf5)}}}]);const _0x8a91d7=await product[_0x6918f6(0x121)]({}),_0x1f6fa4=await adjustment_finished[_0x6918f6(0x121)]({}),_0x3c9a4a=_0x1f6fa4[_0x6918f6(0x10a)]+0x1,_0x228af9=_0x6918f6(0x142)+_0x3c9a4a[_0x6918f6(0x19f)]()[_0x6918f6(0x11d)](0x5,'0');var _0x408c7a=[_0x6918f6(0x14a),_0x6918f6(0x11e),_0x6918f6(0x148)];if(_0x4b72f0[0x0][_0x6918f6(0x176)]==_0x6918f6(0x12f))var _0x40437a=users[_0x6918f6(0x182)];else{if(_0x4b72f0[0x0][_0x6918f6(0x176)]==_0x6918f6(0x186))var _0x40437a=users[_0x6918f6(0x186)];else{if(_0x4b72f0[0x0][_0x6918f6(0x176)]==_0x6918f6(0x135))var _0x40437a=users[_0x6918f6(0x135)];else{if(_0x4b72f0[0x0]['language']==_0x6918f6(0x139))var _0x40437a=users['Spanish'];else{if(_0x4b72f0[0x0]['language']==_0x6918f6(0xf9))var _0x40437a=users['French'];else{if(_0x4b72f0[0x0][_0x6918f6(0x176)]=='Portuguese\x20(BR)')var _0x40437a=users[_0x6918f6(0x17b)];else{if(_0x4b72f0[0x0][_0x6918f6(0x176)]==_0x6918f6(0x122))var _0x40437a=users[_0x6918f6(0x122)];else{if(_0x4b72f0[0x0][_0x6918f6(0x176)]==_0x6918f6(0xf4))var _0x40437a=users['Arabic'];}}}}}}}const _0x2de84c=getRandom8DigitNumber();_0x2de84c[_0x6918f6(0x18b)](_0xf84f88=>{var _0x376563=_0x6918f6;_0x2f6ea2[_0x376563(0x120)](_0x376563(0x162),{'success':_0x383bbb[_0x376563(0x127)](_0x376563(0x13b)),'errors':_0x383bbb[_0x376563(0x127)](_0x376563(0x10e)),'role':_0x5c3b3e,'profile':_0x365111,'warehouse':_0x345a5e,'product':_0x8a91d7,'master_shop':_0x4b72f0,'language':_0x40437a,'rooms_data':_0x408c7a,'invoice_no':_0xf84f88});})[_0x6918f6(0x14b)](_0x454b67=>{var _0x54f99d=_0x6918f6;_0x383bbb[_0x54f99d(0x127)](_0x54f99d(0x10e),_0x54f99d(0x198)),_0x2f6ea2[_0x54f99d(0x100)](_0x54f99d(0x105));});}catch(_0x5e4c86){console[_0x6918f6(0x14f)](_0x5e4c86);}}),router[a0_0x3374e7(0x1b3)]('/view/add_adjustment',auth,async(_0x177488,_0x141b1d)=>{var _0x1ba7e1=a0_0x3374e7;try{const {warehouse_name:_0x31bd5c,date:_0x3373bf,prod_name:_0x357cd2,level:_0x24cabb,isle:_0x3c4dbb,pallet:_0x28a3cd,stock:_0x4b566e,types:_0x4046ea,adjust_qty:_0x51fc95,new_adjust_qty:_0x2b3a7f,note:_0x23e9a5,Room_name:_0x516054,invoice:_0x144d95,JO_number:_0x48740b,expiry_date:_0x1f960d}=_0x177488['body'];if(typeof _0x357cd2=='string')var _0x380a16=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x197)]],_0x27a430=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x1ae)]],_0x5a8376=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0xf8)]],_0x1e0846=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0xfd)]],_0x5bdcb5=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x191)]],_0x659d89=[_0x177488[_0x1ba7e1(0x11a)]['New_Qty_Converted']],_0x4784fd=[_0x177488[_0x1ba7e1(0x11a)]['Primary_Units']],_0x219cc8=[_0x177488['body']['Secondary_units']],_0xb797f8=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x15d)]],_0x43c54e=[_0x177488[_0x1ba7e1(0x11a)]['batch_code']],_0x1697e7=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x19b)]],_0x3acb45=[_0x177488[_0x1ba7e1(0x11a)]['product_date']],_0x27f0d5=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x15b)]],_0x2422b7=[_0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x1a3)]],_0x1f1da5=[_0x177488[_0x1ba7e1(0x11a)]['maxPerUnit']],_0x4cfb43=[_0x177488['body'][_0x1ba7e1(0x159)]];else var _0x380a16=[..._0x177488['body'][_0x1ba7e1(0x197)]],_0x27a430=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x1ae)]],_0x5a8376=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0xf8)]],_0x1e0846=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0xfd)]],_0x5bdcb5=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x191)]],_0x659d89=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x12c)]],_0x4784fd=[..._0x177488['body'][_0x1ba7e1(0x134)]],_0x219cc8=[..._0x177488['body'][_0x1ba7e1(0x109)]],_0xb797f8=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x15d)]],_0x43c54e=[..._0x177488['body'][_0x1ba7e1(0x137)]],_0x1697e7=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x19b)]],_0x3acb45=[..._0x177488[_0x1ba7e1(0x11a)]['product_date']],_0x27f0d5=[..._0x177488[_0x1ba7e1(0x11a)][_0x1ba7e1(0x15b)]],_0x2422b7=[..._0x177488['body']['Rooms']],_0x1f1da5=[..._0x177488[_0x1ba7e1(0x11a)]['maxPerUnit']],_0x4cfb43=[..._0x177488[_0x1ba7e1(0x11a)]['prod_invoice']];const _0x1bdcdc=_0x380a16[_0x1ba7e1(0x19d)](_0x274a38=>{return _0x274a38={'product_name':_0x274a38};});_0x27a430[_0x1ba7e1(0x133)]((_0x1c35da,_0x537865)=>{_0x1bdcdc[_0x537865]['bay']=_0x1c35da;}),_0x5a8376[_0x1ba7e1(0x133)]((_0x46d221,_0x3ce837)=>{var _0x26c6b0=_0x1ba7e1;_0x1bdcdc[_0x3ce837][_0x26c6b0(0x154)]=_0x46d221;}),_0x1e0846[_0x1ba7e1(0x133)]((_0x40f843,_0x10919e)=>{var _0x28df12=_0x1ba7e1;_0x1bdcdc[_0x10919e][_0x28df12(0xfd)]=_0x40f843;}),_0x5bdcb5['forEach']((_0x4da702,_0x2b322b)=>{var _0x1de967=_0x1ba7e1;_0x1bdcdc[_0x2b322b][_0x1de967(0x16f)]=_0x4da702;}),_0x659d89[_0x1ba7e1(0x133)]((_0xe7eaa7,_0x1a63dc)=>{var _0xc41fc9=_0x1ba7e1;_0x1bdcdc[_0x1a63dc][_0xc41fc9(0x1a1)]=_0xe7eaa7;}),_0x4784fd[_0x1ba7e1(0x133)]((_0x248615,_0x45eab3)=>{var _0x2e421e=_0x1ba7e1;_0x1bdcdc[_0x45eab3][_0x2e421e(0x158)]=_0x248615;}),_0x219cc8[_0x1ba7e1(0x133)]((_0x287dcc,_0x1aa9bf)=>{var _0x78ffef=_0x1ba7e1;_0x1bdcdc[_0x1aa9bf][_0x78ffef(0x157)]=_0x287dcc;}),_0xb797f8[_0x1ba7e1(0x133)]((_0x4c238e,_0xc3e9f6)=>{var _0x343bfd=_0x1ba7e1;_0x1bdcdc[_0xc3e9f6][_0x343bfd(0x16c)]=_0x4c238e;}),_0x43c54e[_0x1ba7e1(0x133)]((_0xb5105c,_0x1f2398)=>{_0x1bdcdc[_0x1f2398]['batch_code']=_0xb5105c;}),_0x1697e7[_0x1ba7e1(0x133)]((_0x120510,_0x3bd796)=>{var _0x7b07c4=_0x1ba7e1;_0x1bdcdc[_0x3bd796][_0x7b07c4(0x19b)]=_0x120510;}),_0x3acb45[_0x1ba7e1(0x133)]((_0x1585c9,_0x17f4b5)=>{var _0x5e4b50=_0x1ba7e1;_0x1bdcdc[_0x17f4b5][_0x5e4b50(0x138)]=_0x1585c9;}),_0x27f0d5['forEach']((_0x177ae0,_0x27f46)=>{_0x1bdcdc[_0x27f46]['prod_cat']=_0x177ae0;}),_0x2422b7[_0x1ba7e1(0x133)]((_0x9482f8,_0x3ebcd7)=>{_0x1bdcdc[_0x3ebcd7]['room_names']=_0x9482f8;}),_0x1f1da5[_0x1ba7e1(0x133)]((_0x2fcaae,_0x50cd65)=>{var _0x2dc1f7=_0x1ba7e1;_0x1bdcdc[_0x50cd65][_0x2dc1f7(0xff)]=_0x2fcaae;}),_0x4cfb43['forEach']((_0x633462,_0x5b8dcb)=>{var _0x5b6381=_0x1ba7e1;_0x1bdcdc[_0x5b8dcb][_0x5b6381(0x11c)]=_0x633462;});const _0x33e283=_0x1bdcdc[_0x1ba7e1(0x185)](_0x2ba587=>_0x2ba587[_0x1ba7e1(0x16f)]!=='0'&&_0x2ba587[_0x1ba7e1(0x16f)]!=='');var _0x45183a=0x0;_0x33e283['forEach'](_0x45b9dc=>{var _0x1db1db=_0x1ba7e1;console[_0x1db1db(0x14f)](_0x1db1db(0x169),_0x45b9dc),parseInt(_0x45b9dc[_0x1db1db(0x16f)])<=0x0&&_0x45183a++;});if(_0x45183a!=0x0)return _0x177488[_0x1ba7e1(0x127)](_0x1ba7e1(0x10e),_0x1ba7e1(0x17a)),_0x141b1d['redirect'](_0x1ba7e1(0x189));const _0x5a91c8=new adjustment_finished({'warehouse_name':_0x31bd5c,'date':_0x3373bf,'product':_0x33e283,'note':_0x23e9a5,'room':_0x516054,'invoice':_0x144d95,'JO_number':_0x48740b,'expiry_date':_0x1f960d}),_0x35f048=await _0x5a91c8[_0x1ba7e1(0xfa)]();_0x177488[_0x1ba7e1(0x127)]('success',_0x1ba7e1(0x18d)),_0x141b1d['redirect']('/adjustment_finished/preview/'+_0x35f048[_0x1ba7e1(0x116)]);}catch(_0x13fb09){console[_0x1ba7e1(0x14f)](_0x13fb09),_0x141b1d[_0x1ba7e1(0x163)](0xc8)[_0x1ba7e1(0x164)]({'message':_0x13fb09['message']});}}),router[a0_0x3374e7(0x178)](a0_0x3374e7(0x166),auth,async(_0x547bdb,_0x14617a)=>{var _0x11866f=a0_0x3374e7;try{const {username:_0x1bf617,email:_0x299abb,role:_0x570162}=_0x547bdb[_0x11866f(0x144)],_0x30c61d=_0x547bdb[_0x11866f(0x144)],_0x383417=await profile[_0x11866f(0x1a5)]({'email':_0x30c61d[_0x11866f(0xed)]}),_0x5666df=await master_shop[_0x11866f(0x121)](),_0x551773=_0x547bdb[_0x11866f(0x168)]['id'],_0x36a874=await adjustment_finished['findById']({'_id':_0x551773}),_0x15d067=await purchases[_0x11866f(0x11f)]([{'$match':{'warehouse_name':_0x36a874['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0x11866f(0xf7)}}]);console[_0x11866f(0x14f)]('purchases_data',_0x15d067);const _0x563807=await product[_0x11866f(0x121)]({}),_0x3e51e8=await warehouse[_0x11866f(0x11f)]([{'$match':{'name':_0x36a874[_0x11866f(0x125)],'warehouse_category':_0x11866f(0x179)}},{'$unwind':_0x11866f(0x130)},{'$group':{'_id':_0x11866f(0x1ad),'name':{'$first':_0x11866f(0x10b)},'product_stock':{'$first':_0x11866f(0xfe)},'bay':{'$first':_0x11866f(0x14d)},'bin':{'$first':_0x11866f(0x149)},'type':{'$first':_0x11866f(0x141)},'floorlevel':{'$first':_0x11866f(0x13a)},'primary_code':{'$first':_0x11866f(0x1b2)},'secondary_code':{'$first':_0x11866f(0x184)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x11866f(0x160)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x11866f(0x1a4)},'production_date':{'$first':_0x11866f(0x18a)},'batch_code':{'$first':_0x11866f(0x145)},'maxPerUnit':{'$first':_0x11866f(0x147)},'room':{'$first':'$room'}}}]);if(_0x5666df[0x0][_0x11866f(0x176)]==_0x11866f(0x12f)){var _0x341ef9=users[_0x11866f(0x182)];console[_0x11866f(0x14f)](_0x341ef9);}else{if(_0x5666df[0x0][_0x11866f(0x176)]==_0x11866f(0x186))var _0x341ef9=users['Hindi'];else{if(_0x5666df[0x0][_0x11866f(0x176)]==_0x11866f(0x135))var _0x341ef9=users['German'];else{if(_0x5666df[0x0]['language']==_0x11866f(0x139))var _0x341ef9=users[_0x11866f(0x139)];else{if(_0x5666df[0x0][_0x11866f(0x176)]==_0x11866f(0xf9))var _0x341ef9=users[_0x11866f(0xf9)];else{if(_0x5666df[0x0][_0x11866f(0x176)]=='Portuguese\x20(BR)')var _0x341ef9=users[_0x11866f(0x17b)];else{if(_0x5666df[0x0]['language']=='Chinese')var _0x341ef9=users[_0x11866f(0x122)];else{if(_0x5666df[0x0]['language']==_0x11866f(0xf4))var _0x341ef9=users['Arabic'];}}}}}}}_0x14617a['render'](_0x11866f(0x183),{'success':_0x547bdb[_0x11866f(0x127)]('success'),'errors':_0x547bdb[_0x11866f(0x127)](_0x11866f(0x10e)),'role':_0x30c61d,'profile':_0x383417,'adjustment':_0x36a874,'stock':_0x3e51e8,'master_shop':_0x5666df,'warehouse_name':_0x15d067,'unit':_0x563807,'language':_0x341ef9});}catch(_0x11e2ce){console[_0x11866f(0x14f)](_0x11e2ce),_0x14617a[_0x11866f(0x163)](0xc8)[_0x11866f(0x164)]({'message':_0x11e2ce['message']});}}),router['post'](a0_0x3374e7(0x166),auth,async(_0x7157ac,_0x1f0215)=>{var _0x3ca3f7=a0_0x3374e7;try{const {invoice:_0x5cb2d2,warehouse_name:_0x25e92a,Room_name:_0x2fc2ef}=_0x7157ac[_0x3ca3f7(0x11a)],_0x51b8fd=_0x7157ac[_0x3ca3f7(0x168)]['id'],_0x45b2fa=await adjustment_finished[_0x3ca3f7(0x117)]({'_id':_0x51b8fd});var _0x15456a;const _0x5d00f2=_0x45b2fa['product'][_0x3ca3f7(0x19d)](async _0x4a46f0=>{var _0x69a105=_0x3ca3f7;if(_0x4a46f0['adjust_qty']>0x0){_0x15456a=await warehouse[_0x69a105(0x1a5)]({'name':_0x25e92a,'room':_0x4a46f0[_0x69a105(0x15e)],'warehouse_category':_0x69a105(0x179)});const _0x109e9e=_0x15456a[_0x69a105(0x15a)][_0x69a105(0x19d)](_0x22a8d8=>{var _0x263eee=_0x69a105;console['log'](_0x4a46f0[_0x263eee(0xfd)]);if(_0x4a46f0[_0x263eee(0xfd)]==_0x263eee(0x13c))_0x22a8d8[_0x263eee(0x187)]==_0x4a46f0['product_name']&&_0x22a8d8[_0x263eee(0xf6)]==_0x4a46f0[_0x263eee(0xf6)]&&_0x22a8d8[_0x263eee(0x19b)]==_0x4a46f0[_0x263eee(0x19b)]&&_0x22a8d8[_0x263eee(0x138)]==_0x4a46f0[_0x263eee(0x138)]&&_0x22a8d8[_0x263eee(0x137)]==_0x4a46f0[_0x263eee(0x137)]&&_0x22a8d8[_0x263eee(0x11c)]==_0x4a46f0['invoice']&&(_0x22a8d8['product_stock']=_0x22a8d8['product_stock']-_0x4a46f0['adjust_qty']);else _0x4a46f0[_0x263eee(0xfd)]=='add'&&(_0x22a8d8['product_name']==_0x4a46f0[_0x263eee(0x187)]&&_0x22a8d8[_0x263eee(0xf6)]==_0x4a46f0[_0x263eee(0xf6)]&&_0x22a8d8[_0x263eee(0x19b)]==_0x4a46f0[_0x263eee(0x19b)]&&_0x22a8d8['production_date']==_0x4a46f0['production_date']&&_0x22a8d8[_0x263eee(0x137)]==_0x4a46f0['batch_code']&&_0x22a8d8[_0x263eee(0x11c)]==_0x4a46f0[_0x263eee(0x11c)]&&(_0x22a8d8[_0x263eee(0x143)]=_0x22a8d8[_0x263eee(0x143)]+_0x4a46f0[_0x263eee(0x16f)]));});}return _0x15456a;});Promise[_0x3ca3f7(0x174)](_0x5d00f2)[_0x3ca3f7(0x18b)](async _0x5bf4b2=>{var _0x275e88=_0x3ca3f7;try{for(const _0x43952f of _0x5bf4b2){await _0x43952f[_0x275e88(0xfa)]();}_0x45b2fa['finalize']=_0x275e88(0x132);const _0x92af83=await _0x45b2fa[_0x275e88(0xfa)](),_0x1fcf58=await master_shop[_0x275e88(0x121)](),_0x436109=await email_settings[_0x275e88(0x1a5)](),_0x2fdc51=await supervisor_settings[_0x275e88(0x121)]();var _0x5622e0=_0x45b2fa[_0x275e88(0x136)],_0x5a2db8='',_0x29e924;for(_0x29e924 in _0x5622e0){var _0x34958b='FG';_0x45b2fa['warehouse_name']=='DRY\x20GOODS'&&(_0x34958b='DG'),_0x5a2db8+=_0x275e88(0x111)+_0x275e88(0x18c)+_0x5622e0[_0x29e924][_0x275e88(0x187)]+'</td>'+_0x275e88(0x18c)+_0x5622e0[_0x29e924][_0x275e88(0x16c)]+_0x275e88(0x107)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5622e0[_0x29e924][_0x275e88(0x16f)]+_0x275e88(0x107)+_0x275e88(0x18c)+_0x5622e0[_0x29e924][_0x275e88(0x158)]+_0x275e88(0x107)+_0x275e88(0x18c)+_0x5622e0[_0x29e924][_0x275e88(0x157)]+'</td>'+_0x275e88(0x18c)+_0x45b2fa[_0x275e88(0x125)]+_0x275e88(0x107)+_0x275e88(0x18c)+_0x5622e0[_0x29e924][_0x275e88(0x15e)]+_0x275e88(0x107)+_0x275e88(0x18c)+_0x34958b+_0x5622e0[_0x29e924]['bay']+'</td>'+'</tr>';}let _0x12d1ad=nodemailer['createTransport']({'host':_0x436109[_0x275e88(0x16e)],'port':Number(_0x436109[_0x275e88(0x177)]),'secure':![],'auth':{'user':_0x436109['email'],'pass':_0x436109[_0x275e88(0x153)]}}),_0x1d1889={'from':_0x436109['email'],'to':_0x2fdc51[0x0][_0x275e88(0x10f)],'subject':_0x275e88(0x167),'attachments':[{'filename':_0x275e88(0x106),'path':__dirname+_0x275e88(0x1b5)+_0x275e88(0x1aa)+_0x1fcf58[0x0]['image'],'cid':_0x275e88(0x108)}],'html':'<!DOCTYPE\x20html>'+_0x275e88(0xef)+_0x275e88(0x172)+_0x275e88(0x119)+_0x275e88(0x12d)+_0x275e88(0x119)+_0x275e88(0x195)+_0x275e88(0x1a0)+_0x275e88(0x119)+_0x275e88(0x1af)+_0x1fcf58[0x0]['site_title']+'\x20</h2>'+'</div>'+'</div>'+_0x275e88(0xfb)+_0x275e88(0x119)+_0x275e88(0x123)+_0x275e88(0x128)+_0x45b2fa['invoice']+'\x20'+_0x275e88(0x14c)+'\x20Order\x20Date\x20:\x20'+_0x45b2fa[_0x275e88(0x17c)]+'\x20'+_0x275e88(0x118)+'</h5>'+'</div>'+_0x275e88(0x150)+_0x275e88(0x1a9)+_0x275e88(0x111)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x275e88(0x126)+_0x275e88(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x275e88(0x161)+_0x275e88(0x110)+_0x275e88(0x1b1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x275e88(0x13f)+'</thead>'+_0x275e88(0x12a)+'\x20'+_0x5a2db8+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x275e88(0x16b)+_0x275e88(0x146)+_0x1fcf58[0x0][_0x275e88(0x16d)]+_0x275e88(0x171)+_0x275e88(0x1a0)+_0x275e88(0x1a0)+_0x275e88(0x165)};_0x12d1ad['sendMail'](_0x1d1889,function(_0x5c04ec,_0x157581){var _0x90537e=_0x275e88;_0x5c04ec?(console[_0x90537e(0x14f)](_0x5c04ec),console[_0x90537e(0x14f)](_0x90537e(0x13e))):console['log'](_0x90537e(0x129));}),_0x7157ac[_0x275e88(0x127)](_0x275e88(0x13b),'Adjustment\x20Finalize\x20Successfully'),_0x1f0215[_0x275e88(0x100)](_0x275e88(0x17d)+_0x92af83[_0x275e88(0x116)]);}catch(_0x425d9e){console[_0x275e88(0x115)](_0x425d9e),_0x1f0215[_0x275e88(0x163)](0x1f4)[_0x275e88(0x164)]({'error':_0x275e88(0x11b)});}})[_0x3ca3f7(0x14b)](_0x55a59e=>{var _0x36de16=_0x3ca3f7;console[_0x36de16(0x115)](_0x55a59e),_0x1f0215[_0x36de16(0x163)](0x1f4)[_0x36de16(0x164)]({'error':_0x36de16(0xf1)});});}catch(_0x5e4d09){_0x1f0215['json']({'message':_0x5e4d09[_0x3ca3f7(0x131)]});}}),router[a0_0x3374e7(0x178)](a0_0x3374e7(0x1a7),auth,async(_0x2b2b3c,_0x45ed53)=>{var _0x10ad3e=a0_0x3374e7;try{const {username:_0x3b0a36,email:_0x48c985,role:_0x513ea2}=_0x2b2b3c['user'],_0x531c46=_0x2b2b3c[_0x10ad3e(0x144)],_0x2bf905=await profile[_0x10ad3e(0x1a5)]({'email':_0x531c46[_0x10ad3e(0xed)]}),_0x4a2a98=await master_shop['find']();console[_0x10ad3e(0x14f)](_0x10ad3e(0x104),_0x4a2a98);const _0x42e82c=_0x2b2b3c[_0x10ad3e(0x168)]['id'],_0x1ac4fa=await adjustment_finished[_0x10ad3e(0x117)]({'_id':_0x42e82c});let _0x474997=new Date(_0x1ac4fa[_0x10ad3e(0x19b)]),_0xde97c=('0'+_0x474997[_0x10ad3e(0x180)]())[_0x10ad3e(0x19c)](-0x2),_0x3288fb=('0'+(_0x474997[_0x10ad3e(0x193)]()+0x1))[_0x10ad3e(0x19c)](-0x2),_0x45e8ad=_0x474997[_0x10ad3e(0x12b)](),_0xa2e3e9=_0x45e8ad+'-'+_0x3288fb+'-'+_0xde97c;var _0x461665=['Ambient',_0x10ad3e(0x11e),_0x10ad3e(0x148)];const _0x2422d7=await purchases[_0x10ad3e(0x11f)]([{'$match':{'warehouse_name':_0x1ac4fa[_0x10ad3e(0x125)]}},{'$unwind':_0x10ad3e(0x194)},{'$group':{'_id':_0x10ad3e(0xf7)}}]);console[_0x10ad3e(0x14f)](_0x10ad3e(0x17e),_0x2422d7);const _0x576dfc=await product[_0x10ad3e(0x121)]({}),_0x130601=await warehouse[_0x10ad3e(0x11f)]([{'$match':{'name':_0x1ac4fa[_0x10ad3e(0x125)],'room':_0x1ac4fa[_0x10ad3e(0x151)]}},{'$unwind':_0x10ad3e(0x130)},{'$group':{'_id':_0x10ad3e(0x1ad),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x10ad3e(0xfe)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x10ad3e(0x149)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x10ad3e(0x13a)},'primary_code':{'$first':_0x10ad3e(0x1b2)},'secondary_code':{'$first':_0x10ad3e(0x184)},'product_code':{'$first':_0x10ad3e(0x102)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);if(_0x4a2a98[0x0][_0x10ad3e(0x176)]==_0x10ad3e(0x12f)){var _0x577de0=users['English'];console['log'](_0x577de0);}else{if(_0x4a2a98[0x0]['language']==_0x10ad3e(0x186))var _0x577de0=users[_0x10ad3e(0x186)];else{if(_0x4a2a98[0x0]['language']==_0x10ad3e(0x135))var _0x577de0=users['German'];else{if(_0x4a2a98[0x0][_0x10ad3e(0x176)]==_0x10ad3e(0x139))var _0x577de0=users[_0x10ad3e(0x139)];else{if(_0x4a2a98[0x0][_0x10ad3e(0x176)]==_0x10ad3e(0xf9))var _0x577de0=users['French'];else{if(_0x4a2a98[0x0][_0x10ad3e(0x176)]==_0x10ad3e(0x140))var _0x577de0=users[_0x10ad3e(0x17b)];else{if(_0x4a2a98[0x0][_0x10ad3e(0x176)]==_0x10ad3e(0x122))var _0x577de0=users[_0x10ad3e(0x122)];else{if(_0x4a2a98[0x0][_0x10ad3e(0x176)]==_0x10ad3e(0xf4))var _0x577de0=users[_0x10ad3e(0x103)];}}}}}}}_0x45ed53[_0x10ad3e(0x120)](_0x10ad3e(0x1ab),{'success':_0x2b2b3c[_0x10ad3e(0x127)]('success'),'errors':_0x2b2b3c[_0x10ad3e(0x127)](_0x10ad3e(0x10e)),'role':_0x531c46,'profile':_0x2bf905,'adjustment':_0x1ac4fa,'stock':_0x130601,'master_shop':_0x4a2a98,'warehouse_name':_0x2422d7,'unit':_0x576dfc,'language':_0x577de0,'rooms_data':_0x461665,'ed_fullDate':_0xa2e3e9});}catch(_0x54088f){console[_0x10ad3e(0x14f)](_0x54088f),_0x45ed53[_0x10ad3e(0x163)](0xc8)[_0x10ad3e(0x164)]({'message':_0x54088f[_0x10ad3e(0x131)]});}}),router[a0_0x3374e7(0x1b3)](a0_0x3374e7(0x1a7),auth,async(_0x536241,_0x2d08be)=>{var _0x44312a=a0_0x3374e7;try{const _0x40667d=_0x536241[_0x44312a(0x168)]['id'],_0x283249=await adjustment_finished[_0x44312a(0x117)]({'_id':_0x40667d}),_0x112e4d=await warehouse[_0x44312a(0x1a5)]({'name':_0x283249[_0x44312a(0x125)],'room':_0x283249[_0x44312a(0x151)]}),{warehouse_name:_0x24be85,date:_0x426fd0,prod_name:_0x56729b,level:_0x2ecd4e,isle:_0x14aa6b,pallet:_0x1408a9,stock:_0x2304bf,types:_0x533f82,adjust_qty:_0x8a83b8,new_adjust_qty:_0x2b9136,note:_0x1bc9e9,Room_name:_0x584206,invoice:_0x16dbf9,JO_number:_0x4d6e6f}=_0x536241[_0x44312a(0x11a)];if(typeof _0x56729b==_0x44312a(0x188))var _0x4373b2=[_0x536241[_0x44312a(0x11a)]['prod_name']],_0x35c671=[_0x536241[_0x44312a(0x11a)][_0x44312a(0x1ae)]],_0x3e0226=[_0x536241['body'][_0x44312a(0xf8)]],_0x2c99f9=[_0x536241['body']['types']],_0x297073=[_0x536241[_0x44312a(0x11a)]['adjust_qty']],_0x35be5a=[_0x536241[_0x44312a(0x11a)][_0x44312a(0x1a1)]],_0x5c1096=[_0x536241[_0x44312a(0x11a)][_0x44312a(0x15d)]],_0x28ea1d=[_0x536241[_0x44312a(0x11a)]['unit']],_0x187443=[_0x536241['body']['Secondary_units']],_0x2959fa=[_0x536241[_0x44312a(0x11a)][_0x44312a(0x137)]],_0x9a1a2=[_0x536241[_0x44312a(0x11a)][_0x44312a(0x19b)]];else var _0x4373b2=[..._0x536241['body'][_0x44312a(0x197)]],_0x35c671=[..._0x536241[_0x44312a(0x11a)]['level']],_0x3e0226=[..._0x536241[_0x44312a(0x11a)][_0x44312a(0xf8)]],_0x2c99f9=[..._0x536241[_0x44312a(0x11a)][_0x44312a(0xfd)]],_0x297073=[..._0x536241['body'][_0x44312a(0x16f)]],_0x35be5a=[..._0x536241[_0x44312a(0x11a)][_0x44312a(0x1a1)]],_0x5c1096=[..._0x536241['body'][_0x44312a(0x15d)]],_0x28ea1d=[..._0x536241['body'][_0x44312a(0x158)]],_0x187443=[..._0x536241['body'][_0x44312a(0x109)]],_0x2959fa=[..._0x536241[_0x44312a(0x11a)][_0x44312a(0x137)]],_0x9a1a2=[..._0x536241['body'][_0x44312a(0x19b)]];const _0x15f62d=_0x4373b2[_0x44312a(0x19d)](_0x5cae9e=>{return _0x5cae9e={'product_name':_0x5cae9e};});_0x35c671[_0x44312a(0x133)]((_0x45d50c,_0x5baa44)=>{_0x15f62d[_0x5baa44]['bay']=_0x45d50c;}),_0x3e0226[_0x44312a(0x133)]((_0x376338,_0x2453fe)=>{var _0x26ea40=_0x44312a;_0x15f62d[_0x2453fe][_0x26ea40(0x154)]=_0x376338;}),_0x2c99f9[_0x44312a(0x133)]((_0x7e358b,_0x1db7ae)=>{var _0x3b03b8=_0x44312a;_0x15f62d[_0x1db7ae][_0x3b03b8(0xfd)]=_0x7e358b;}),_0x297073[_0x44312a(0x133)]((_0x490661,_0x6d24b)=>{_0x15f62d[_0x6d24b]['adjust_qty']=_0x490661;}),_0x35be5a[_0x44312a(0x133)]((_0x4d5585,_0x4c4ab8)=>{var _0x234f18=_0x44312a;_0x15f62d[_0x4c4ab8][_0x234f18(0x1a1)]=_0x4d5585;}),_0x28ea1d['forEach']((_0x33bb78,_0x5765bf)=>{_0x15f62d[_0x5765bf]['unit']=_0x33bb78;}),_0x187443[_0x44312a(0x133)]((_0x484908,_0x25ca36)=>{var _0x221633=_0x44312a;_0x15f62d[_0x25ca36][_0x221633(0x157)]=_0x484908;}),_0x5c1096[_0x44312a(0x133)]((_0x30107c,_0xe05ffd)=>{var _0xbebadd=_0x44312a;_0x15f62d[_0xe05ffd][_0xbebadd(0x16c)]=_0x30107c;}),_0x2959fa[_0x44312a(0x133)]((_0x41f8aa,_0x3dbe3b)=>{var _0x5b3616=_0x44312a;_0x15f62d[_0x3dbe3b][_0x5b3616(0x137)]=_0x41f8aa;}),_0x9a1a2[_0x44312a(0x133)]((_0x247d96,_0x245ee2)=>{var _0x453402=_0x44312a;_0x15f62d[_0x245ee2][_0x453402(0x19b)]=_0x247d96;});const _0x532115=_0x15f62d[_0x44312a(0x185)](_0x3679fa=>_0x3679fa[_0x44312a(0x16f)]!=='0'&&_0x3679fa['adjust_qty']!=='');var _0x3fff51=0x0;_0x532115['forEach'](_0x36f27f=>{var _0x433ee1=_0x44312a;console['log'](_0x433ee1(0x169),_0x36f27f),parseInt(_0x36f27f[_0x433ee1(0x16f)])<=0x0&&_0x3fff51++;});if(_0x3fff51!=0x0)return _0x536241[_0x44312a(0x127)](_0x44312a(0x10e),_0x44312a(0x17a)),_0x2d08be[_0x44312a(0x100)](_0x44312a(0x189));_0x283249[_0x44312a(0x125)]=_0x24be85,_0x283249[_0x44312a(0x17c)]=_0x426fd0,_0x283249[_0x44312a(0x136)]=_0x532115,_0x283249['note']=_0x1bc9e9,_0x283249['room']=_0x584206,_0x283249['invoice']=_0x16dbf9,_0x283249[_0x44312a(0x113)]=_0x4d6e6f;const _0x11cafc=await _0x283249['save'](),_0x140057=await warehouse[_0x44312a(0x1a5)]({'name':_0x24be85,'room':_0x584206});_0x11cafc['product']['forEach'](_0x41f4ac=>{var _0x2b8776=_0x44312a;const _0x5b29d9=_0x140057[_0x2b8776(0x15a)]['map'](_0x133545=>{var _0x5796a4=_0x2b8776;_0x41f4ac['types']==_0x5796a4(0x13c)?_0x133545[_0x5796a4(0x187)]==_0x41f4ac[_0x5796a4(0x187)]&&_0x133545['bay']==_0x41f4ac[_0x5796a4(0xf6)]&&(_0x133545[_0x5796a4(0x143)]=parseInt(_0x133545[_0x5796a4(0x143)])-parseInt(_0x41f4ac[_0x5796a4(0x16f)])):_0x133545[_0x5796a4(0x187)]==_0x41f4ac[_0x5796a4(0x187)]&&_0x133545[_0x5796a4(0xf6)]==_0x41f4ac[_0x5796a4(0xf6)]&&(_0x133545[_0x5796a4(0x143)]=parseInt(_0x133545[_0x5796a4(0x143)])+parseInt(_0x41f4ac[_0x5796a4(0x16f)]));});}),await _0x140057['save'](),_0x536241['flash'](_0x44312a(0x13b),_0x44312a(0x1ac)),_0x2d08be[_0x44312a(0x100)]('/adjustment_finished/view');}catch(_0x75fc9b){console[_0x44312a(0x14f)](_0x75fc9b);}}),router[a0_0x3374e7(0x1b3)](a0_0x3374e7(0x18f),async(_0x2d32b0,_0x226033)=>{var _0x262994=a0_0x3374e7;const {primary_code:_0x139caa,warehouse_data:_0x3a26db,rooms_data:_0x5d9191,Roomslist:_0x220b97}=_0x2d32b0['body'],_0x3e220f=_0x220b97[_0x262994(0x1b8)](','),_0x1313cb=[];async function _0x40205a(_0xca24aa){var _0x6b26a9=_0x262994;const _0x2106c2=await warehouse[_0x6b26a9(0x11f)]([{'$match':{'name':_0x3a26db,'room':_0xca24aa}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x139caa}},{'$group':{'_id':_0x6b26a9(0x1ad),'name':{'$first':_0x6b26a9(0x10b)},'product_stock':{'$first':_0x6b26a9(0xfe)},'primary_code':{'$first':_0x6b26a9(0x1b2)},'secondary_code':{'$first':_0x6b26a9(0x184)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x6b26a9(0x149)},'type':{'$first':_0x6b26a9(0x141)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x6b26a9(0xee)},'storage':{'$first':_0x6b26a9(0x160)},'rack':{'$first':_0x6b26a9(0x15f)},'expiry_date':{'$first':_0x6b26a9(0x1a4)},'production_date':{'$first':_0x6b26a9(0x18a)},'batch_code':{'$first':_0x6b26a9(0x145)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x6b26a9(0x147)},'roomNamed':{'$first':_0x6b26a9(0x19a)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x37b2d2=await warehouse['aggregate']([{'$match':{'name':_0x3a26db,'room':_0xca24aa}},{'$unwind':_0x6b26a9(0x130)},{'$match':{'product_details.secondary_code':_0x139caa}},{'$group':{'_id':_0x6b26a9(0x1ad),'name':{'$first':_0x6b26a9(0x10b)},'product_stock':{'$first':_0x6b26a9(0xfe)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x6b26a9(0x184)},'product_code':{'$first':_0x6b26a9(0x102)},'level':{'$first':_0x6b26a9(0x14d)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x6b26a9(0x141)},'pallet':{'$first':_0x6b26a9(0x13a)},'unit':{'$first':_0x6b26a9(0x196)},'secondary_unit':{'$first':_0x6b26a9(0xee)},'storage':{'$first':_0x6b26a9(0x160)},'rack':{'$first':_0x6b26a9(0x15f)},'expiry_date':{'$first':_0x6b26a9(0x1a4)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x6b26a9(0x145)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x6b26a9(0x147)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x6b26a9(0x1a2)}}}]);if(_0x2106c2['length']>0x0)_0x1313cb[_0x6b26a9(0x112)](_0x2106c2);else _0x37b2d2[_0x6b26a9(0x10a)]>0x0&&_0x1313cb[_0x6b26a9(0x112)](_0x37b2d2);}const _0xb32f27=_0x3e220f['map'](_0x2d2af2=>_0x40205a(_0x2d2af2));await Promise[_0x262994(0x174)](_0xb32f27),_0x226033['json'](_0x1313cb);}),router['post'](a0_0x3374e7(0x173),async(_0x27c20e,_0x334ab8)=>{var _0x765c7d=a0_0x3374e7;const {productCode:_0x199115,bay:_0x16cdf3,warehouses:_0x14449d,room:_0x5e2350}=_0x27c20e[_0x765c7d(0x11a)];console['log'](_0x27c20e[_0x765c7d(0x11a)]);try{const _0x147845=await warehouse[_0x765c7d(0x11f)]([{'$match':{'name':_0x14449d,'room':_0x5e2350}},{'$unwind':_0x765c7d(0x130)},{'$match':{'product_details.bay':parseInt(_0x16cdf3)}},{'$group':{'_id':_0x765c7d(0x1ad),'name':{'$first':_0x765c7d(0x10b)},'product_stock':{'$first':_0x765c7d(0xfe)},'bay':{'$first':_0x765c7d(0x14d)},'maxProducts':{'$first':_0x765c7d(0x170)}}}]);_0x334ab8[_0x765c7d(0x163)](0xc8)['json'](_0x147845);}catch(_0x417894){_0x334ab8['status'](0x194)[_0x765c7d(0x164)]({'message':_0x417894[_0x765c7d(0x131)]});}}),module[a0_0x3374e7(0xfc)]=router;