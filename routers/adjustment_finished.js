var a0_0x2ec6a8=a0_0x572c;(function(_0x276439,_0x553554){var _0x257f4a=a0_0x572c,_0x53a60d=_0x276439();while(!![]){try{var _0x31e959=-parseInt(_0x257f4a(0x221))/0x1*(-parseInt(_0x257f4a(0x261))/0x2)+-parseInt(_0x257f4a(0x224))/0x3+parseInt(_0x257f4a(0x265))/0x4*(-parseInt(_0x257f4a(0x29a))/0x5)+parseInt(_0x257f4a(0x251))/0x6+-parseInt(_0x257f4a(0x29e))/0x7+-parseInt(_0x257f4a(0x218))/0x8*(parseInt(_0x257f4a(0x1e6))/0x9)+parseInt(_0x257f4a(0x263))/0xa*(parseInt(_0x257f4a(0x233))/0xb);if(_0x31e959===_0x553554)break;else _0x53a60d['push'](_0x53a60d['shift']());}catch(_0x5a6a95){_0x53a60d['push'](_0x53a60d['shift']());}}}(a0_0xf2d0,0x8029b));function a0_0xf2d0(){var _0x12a7bc=['/adjustment_finished/view','forEach','Rooms','$product_details.unit','Error\x20Occurs','Primary_Units','error','<!DOCTYPE\x20html>','/barcode_scanner','length','success','batch_code','<h2>\x20','54UUsWPJ','$product_details.secondary_unit','$product_details.storage','Return\x20Rooms','Arabic','production_date','types','warehouse_name','express','expiry_date','status','Logo.png','minus','logo','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Portuguese','New_Qty_Converted','bay','product_name','flash','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/picking_list/PDF_adjustment/','Portuguese\x20(BR)','floor','map','$product_details.bay','/../public','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','stockBefore','$product_details.product_code','slice','foreach\x20newproduct','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','purchases_data','$product_details.product_stock','warehouse','getDate','$product_details.maxPerUnit','findOne','all','language','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','JO_number','</span>','969976eUSGHr','Spanish','then','/view/add_adjustment','An\x20error\x20occurred\x20while\x20saving\x20data.','Adjustment\x20Finalize\x20Successfully','$product_details.batch_code','$product_details.bin','Adjustment\x20Mail','182LIdsRM','email','push','1131621ALzxti','New_Qty_Converted_adj','room_names','prod_name','note','adjust_qty','staff','../public/language/languages.json','product_details','../models/all_models','/adjustment/view','prod_invoice','</table>','$product_details.type','<h5>','77xwwBut','body','$product_details.production_date','</body></html>','QA\x20Warehouse','invoice','product_stock','toString','date','prod_code','English','nodemailer','secondary_unit','$product_details.primary_code','An\x20error\x20occurred.','/view','</h5>','</tbody>','<hr\x20class=\x22my-3\x22>','maxPerUnit','$product_details.floorlevel','aggregate','$product_details.expiry_date','Enabled','/upload/','room','stock','Finished\x20Goods','errors','$invoice','163254xvOXUS','new_adjust_qty','image','log','Hindi','split','$room','product','host','prod_cat','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','unit','find','user','redirect','</td>','1138vIoaRm','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','3147620LUXkhR','render','867212SIFiNj','Arabic\x20(ae)','back','$product','password','finalize','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div>','json','<tbody\x20style=\x22text-align:\x20center;\x22>','edit_adjustment_finished_view','Email\x20sent\x20successfully','<h5\x20style=\x22text-align:\x20left;\x22>','edit_adjustment_finished','/view/:id','$product_details.product_name','params','get','$product_details','$date','<tr>','<strong>\x20Regards\x20</strong>','\x20Order\x20Number\x20:\x20','German','post','$product_details.rack','adjustment\x20data\x20update\x20successfully','</div>','product_code','$product_details._id','Router','\x20</h2>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','catch','Chinese','ADJF-','add_adjustment_finished','findById','French','Secondary_units','/preview/:id','port','<html><head><title></title>','</tr>','string','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Enclosed','$product_details.maxProducts','$warehouse_name','filter','5rnUOHM','$product.room_names','master','adjustment_finished','3413578ydwPMO','site_title','level','role'];a0_0xf2d0=function(){return _0x12a7bc;};return a0_0xf2d0();}const express=require(a0_0x2ec6a8(0x1ee)),app=express(),router=express[a0_0x2ec6a8(0x285)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x2ec6a8(0x22d)),users=require(a0_0x2ec6a8(0x22b)),nodemailer=require(a0_0x2ec6a8(0x23e));router['get'](a0_0x2ec6a8(0x242),auth,async(_0x8f5235,_0x1b7bee)=>{var _0x21f651=a0_0x2ec6a8;try{const {username:_0x3d165d,email:_0x3e6c64,role:_0x37cea6}=_0x8f5235[_0x21f651(0x25e)],_0x7c195d=_0x8f5235[_0x21f651(0x25e)],_0x544eb9=await profile[_0x21f651(0x211)]({'email':_0x7c195d[_0x21f651(0x222)]}),_0x129efb=await master_shop[_0x21f651(0x25d)]();let _0x1c2b48;if(_0x7c195d[_0x21f651(0x1d8)]==_0x21f651(0x22a)){const _0x441779=await staff[_0x21f651(0x211)]({'email':_0x7c195d['email']});_0x1c2b48=await warehouse[_0x21f651(0x25d)]({'status':_0x21f651(0x24a),'name':_0x441779[_0x21f651(0x20e)]});}else _0x1c2b48=await warehouse[_0x21f651(0x25d)]({'status':_0x21f651(0x24a)});const _0x181ea9=await product[_0x21f651(0x25d)]();let _0x2e7aed;if(_0x7c195d[_0x21f651(0x1d8)]==_0x21f651(0x22a)){const _0x13c223=await staff[_0x21f651(0x211)]({'email':_0x7c195d[_0x21f651(0x222)]});_0x2e7aed=await adjustment_finished[_0x21f651(0x25d)]({'warehouse_name':_0x13c223[_0x21f651(0x20e)]});}else _0x2e7aed=await adjustment_finished['aggregate']([{'$unwind':_0x21f651(0x268)},{'$group':{'_id':'$_id','invoice':{'$first':_0x21f651(0x250)},'date':{'$first':_0x21f651(0x27a)},'warehouse_name':{'$first':_0x21f651(0x298)},'room':{'$addToSet':_0x21f651(0x29b)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x129efb[0x0][_0x21f651(0x213)]==_0x21f651(0x294)){var _0x142c79=users['English'];console['log'](_0x142c79);}else{if(_0x129efb[0x0][_0x21f651(0x213)]==_0x21f651(0x255))var _0x142c79=users['Hindi'];else{if(_0x129efb[0x0][_0x21f651(0x213)]==_0x21f651(0x27e))var _0x142c79=users[_0x21f651(0x27e)];else{if(_0x129efb[0x0][_0x21f651(0x213)]==_0x21f651(0x219))var _0x142c79=users[_0x21f651(0x219)];else{if(_0x129efb[0x0]['language']==_0x21f651(0x28d))var _0x142c79=users[_0x21f651(0x28d)];else{if(_0x129efb[0x0][_0x21f651(0x213)]=='Portuguese\x20(BR)')var _0x142c79=users[_0x21f651(0x1f6)];else{if(_0x129efb[0x0][_0x21f651(0x213)]=='Chinese')var _0x142c79=users[_0x21f651(0x289)];else{if(_0x129efb[0x0][_0x21f651(0x213)]==_0x21f651(0x266))var _0x142c79=users[_0x21f651(0x1ea)];}}}}}}}_0x1b7bee[_0x21f651(0x264)](_0x21f651(0x29d),{'success':_0x8f5235[_0x21f651(0x1fa)](_0x21f651(0x1e3)),'errors':_0x8f5235[_0x21f651(0x1fa)](_0x21f651(0x24f)),'role':_0x7c195d,'profile':_0x544eb9,'warehouse':_0x1c2b48,'product':_0x181ea9,'adjustment':_0x2e7aed,'master_shop':_0x129efb,'language':_0x142c79});}catch(_0x56850c){console[_0x21f651(0x254)](_0x56850c);}});async function getRandom8DigitNumber(){var _0x344c66=a0_0x2ec6a8;const _0x2c3d61=0x989680,_0x123f67=0x5f5e0ff,_0x59cd03=Math[_0x344c66(0x1ff)](Math['random']()*(_0x123f67-_0x2c3d61+0x1))+_0x2c3d61;var _0x19d8ee;const _0x283992=await adjustment_finished[_0x344c66(0x211)]({'invoice':'ADJF-'+_0x59cd03});return _0x283992&&_0x283992[_0x344c66(0x1e2)]>0x0?_0x19d8ee=_0x344c66(0x28a)+_0x59cd03:_0x19d8ee=_0x344c66(0x28a)+_0x59cd03,_0x19d8ee;}function a0_0x572c(_0x469d09,_0x239647){var _0xf2d0ca=a0_0xf2d0();return a0_0x572c=function(_0x572cd8,_0x593683){_0x572cd8=_0x572cd8-0x1d7;var _0x15ef70=_0xf2d0ca[_0x572cd8];return _0x15ef70;},a0_0x572c(_0x469d09,_0x239647);}router[a0_0x2ec6a8(0x278)](a0_0x2ec6a8(0x21b),auth,async(_0x3d0395,_0x5ea32a)=>{var _0x535f53=a0_0x2ec6a8;try{const {username:_0x250e58,email:_0x384601,role:_0x5d3775}=_0x3d0395['user'],_0x6e7ac7=_0x3d0395[_0x535f53(0x25e)],_0x3a3ccb=await profile['findOne']({'email':_0x6e7ac7[_0x535f53(0x222)]}),_0x14ccca=await master_shop['find']();let _0x5c5802;if(_0x6e7ac7[_0x535f53(0x1d8)]==_0x535f53(0x22a)){const _0x175d8b=await staff[_0x535f53(0x211)]({'email':_0x6e7ac7[_0x535f53(0x222)]});_0x5c5802=await warehouse[_0x535f53(0x248)]([{'$match':{'status':'Enabled','name':_0x175d8b[_0x535f53(0x20e)],'warehouse_category':_0x535f53(0x24e),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x535f53(0x205),'name':{'$first':_0x535f53(0x205)}}}]);}else _0x5c5802=await warehouse[_0x535f53(0x248)]([{'$match':{'status':_0x535f53(0x24a),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x535f53(0x237)}}},{'$group':{'_id':'$name','name':{'$first':_0x535f53(0x205)}}}]);const _0x1466d5=await product[_0x535f53(0x25d)]({}),_0x354f0b=await adjustment_finished[_0x535f53(0x25d)]({}),_0x27f350=_0x354f0b[_0x535f53(0x1e2)]+0x1,_0x22a34a=_0x535f53(0x28a)+_0x27f350[_0x535f53(0x23a)]()['padStart'](0x5,'0');var _0x3ce868=['Ambient',_0x535f53(0x296),_0x535f53(0x1e9)];if(_0x14ccca[0x0]['language']==_0x535f53(0x294))var _0x4bd7c5=users[_0x535f53(0x23d)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]==_0x535f53(0x255))var _0x4bd7c5=users[_0x535f53(0x255)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]==_0x535f53(0x27e))var _0x4bd7c5=users[_0x535f53(0x27e)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]==_0x535f53(0x219))var _0x4bd7c5=users[_0x535f53(0x219)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]==_0x535f53(0x28d))var _0x4bd7c5=users[_0x535f53(0x28d)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]==_0x535f53(0x1fe))var _0x4bd7c5=users[_0x535f53(0x1f6)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]==_0x535f53(0x289))var _0x4bd7c5=users[_0x535f53(0x289)];else{if(_0x14ccca[0x0][_0x535f53(0x213)]=='Arabic\x20(ae)')var _0x4bd7c5=users[_0x535f53(0x1ea)];}}}}}}}const _0x22ada3=getRandom8DigitNumber();_0x22ada3[_0x535f53(0x21a)](_0x3bd2cf=>{var _0x48dea1=_0x535f53;_0x5ea32a[_0x48dea1(0x264)](_0x48dea1(0x28b),{'success':_0x3d0395['flash'](_0x48dea1(0x1e3)),'errors':_0x3d0395['flash']('errors'),'role':_0x6e7ac7,'profile':_0x3a3ccb,'warehouse':_0x5c5802,'product':_0x1466d5,'master_shop':_0x14ccca,'language':_0x4bd7c5,'rooms_data':_0x3ce868,'invoice_no':_0x3bd2cf});})[_0x535f53(0x288)](_0x383bb7=>{var _0x34721c=_0x535f53;_0x3d0395[_0x34721c(0x1fa)]('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5ea32a[_0x34721c(0x25f)](_0x34721c(0x22e));});}catch(_0x595900){console[_0x535f53(0x254)](_0x595900);}}),router[a0_0x2ec6a8(0x27f)](a0_0x2ec6a8(0x21b),auth,async(_0x464c68,_0x3e2c33)=>{var _0x1fa6fa=a0_0x2ec6a8;try{const {warehouse_name:_0x28e0ee,date:_0x227918,prod_name:_0x1da265,level:_0x21b5b7,isle:_0x13295d,pallet:_0x24355b,stock:_0x17ca4b,types:_0x560e8e,adjust_qty:_0x1968e6,new_adjust_qty:_0xb8c15b,note:_0x4f0f03,Room_name:_0x37bb24,invoice:_0x33e40f,JO_number:_0x16c403,expiry_date:_0x1093a8}=_0x464c68[_0x1fa6fa(0x234)];if(typeof _0x1da265=='string')var _0x48fd16=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x227)]],_0x2471a6=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1d7)]],_0x4d426c=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x24d)]],_0xa00522=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1ec)]],_0x3f3b95=[_0x464c68['body'][_0x1fa6fa(0x225)]],_0x526181=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1f7)]],_0x937bb6=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1de)]],_0xceb6e8=[_0x464c68['body'][_0x1fa6fa(0x28e)]],_0x29f76a=[_0x464c68['body'][_0x1fa6fa(0x23c)]],_0x332868=[_0x464c68[_0x1fa6fa(0x234)]['batch_code']],_0x191f25=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1ef)]],_0x2e21b4=[_0x464c68[_0x1fa6fa(0x234)]['product_date']],_0x4424a4=[_0x464c68['body'][_0x1fa6fa(0x25a)]],_0x3e8645=[_0x464c68['body'][_0x1fa6fa(0x1db)]],_0x1943dd=[_0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x246)]],_0x25aee6=[_0x464c68['body'][_0x1fa6fa(0x22f)]];else var _0x48fd16=[..._0x464c68[_0x1fa6fa(0x234)]['prod_name']],_0x2471a6=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1d7)]],_0x4d426c=[..._0x464c68['body'][_0x1fa6fa(0x24d)]],_0xa00522=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1ec)]],_0x3f3b95=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x225)]],_0x526181=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1f7)]],_0x937bb6=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1de)]],_0xceb6e8=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x28e)]],_0x29f76a=[..._0x464c68[_0x1fa6fa(0x234)]['prod_code']],_0x332868=[..._0x464c68['body'][_0x1fa6fa(0x1e4)]],_0x191f25=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x1ef)]],_0x2e21b4=[..._0x464c68[_0x1fa6fa(0x234)]['product_date']],_0x4424a4=[..._0x464c68[_0x1fa6fa(0x234)]['prod_cat']],_0x3e8645=[..._0x464c68[_0x1fa6fa(0x234)]['Rooms']],_0x1943dd=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x246)]],_0x25aee6=[..._0x464c68[_0x1fa6fa(0x234)][_0x1fa6fa(0x22f)]];const _0x964b5e=_0x48fd16['map'](_0x4d7fcc=>{return _0x4d7fcc={'product_name':_0x4d7fcc};});_0x2471a6[_0x1fa6fa(0x1da)]((_0x32a41b,_0x1b3f31)=>{var _0xd96753=_0x1fa6fa;_0x964b5e[_0x1b3f31][_0xd96753(0x1f8)]=_0x32a41b;}),_0x4d426c[_0x1fa6fa(0x1da)]((_0x39f18d,_0x400ca4)=>{var _0x164ee2=_0x1fa6fa;_0x964b5e[_0x400ca4][_0x164ee2(0x207)]=_0x39f18d;}),_0xa00522[_0x1fa6fa(0x1da)]((_0x35c6cc,_0x388950)=>{_0x964b5e[_0x388950]['types']=_0x35c6cc;}),_0x3f3b95[_0x1fa6fa(0x1da)]((_0x106073,_0x55d520)=>{_0x964b5e[_0x55d520]['adjust_qty']=_0x106073;}),_0x526181[_0x1fa6fa(0x1da)]((_0x7ef2d9,_0x1a892c)=>{var _0x22a16e=_0x1fa6fa;_0x964b5e[_0x1a892c][_0x22a16e(0x252)]=_0x7ef2d9;}),_0x937bb6['forEach']((_0xbed65e,_0x5dcab6)=>{var _0x2d4536=_0x1fa6fa;_0x964b5e[_0x5dcab6][_0x2d4536(0x25c)]=_0xbed65e;}),_0xceb6e8[_0x1fa6fa(0x1da)]((_0x209513,_0x148b33)=>{var _0x70e974=_0x1fa6fa;_0x964b5e[_0x148b33][_0x70e974(0x23f)]=_0x209513;}),_0x29f76a[_0x1fa6fa(0x1da)]((_0x867ea2,_0x482999)=>{var _0x3d3271=_0x1fa6fa;_0x964b5e[_0x482999][_0x3d3271(0x283)]=_0x867ea2;}),_0x332868['forEach']((_0x55d972,_0x24bdfe)=>{var _0x2b2b57=_0x1fa6fa;_0x964b5e[_0x24bdfe][_0x2b2b57(0x1e4)]=_0x55d972;}),_0x191f25['forEach']((_0x284c6d,_0x4dc7ef)=>{_0x964b5e[_0x4dc7ef]['expiry_date']=_0x284c6d;}),_0x2e21b4[_0x1fa6fa(0x1da)]((_0x2dd3e1,_0x2d495e)=>{var _0x1d050a=_0x1fa6fa;_0x964b5e[_0x2d495e][_0x1d050a(0x1eb)]=_0x2dd3e1;}),_0x4424a4[_0x1fa6fa(0x1da)]((_0x102b5a,_0xa3b15a)=>{var _0x5e341b=_0x1fa6fa;_0x964b5e[_0xa3b15a][_0x5e341b(0x25a)]=_0x102b5a;}),_0x3e8645[_0x1fa6fa(0x1da)]((_0x3c1dfd,_0x348285)=>{var _0x4c5ca8=_0x1fa6fa;_0x964b5e[_0x348285][_0x4c5ca8(0x226)]=_0x3c1dfd;}),_0x1943dd[_0x1fa6fa(0x1da)]((_0x1653b3,_0x12cd0e)=>{var _0x5044dc=_0x1fa6fa;_0x964b5e[_0x12cd0e][_0x5044dc(0x246)]=_0x1653b3;}),_0x25aee6['forEach']((_0x545de3,_0x34a563)=>{var _0x334632=_0x1fa6fa;_0x964b5e[_0x34a563][_0x334632(0x238)]=_0x545de3;});const _0x5c56ac=_0x964b5e[_0x1fa6fa(0x299)](_0x14d0c5=>_0x14d0c5['adjust_qty']!=='0'&&_0x14d0c5[_0x1fa6fa(0x229)]!=='');var _0x47e814=0x0;_0x5c56ac['forEach'](_0x57710d=>{var _0x4f966a=_0x1fa6fa;console[_0x4f966a(0x254)]('foreach\x20newproduct',_0x57710d),parseInt(_0x57710d[_0x4f966a(0x229)])<=0x0&&_0x47e814++;});if(_0x47e814!=0x0)return _0x464c68[_0x1fa6fa(0x1fa)](_0x1fa6fa(0x24f),_0x1fa6fa(0x20b)),_0x3e2c33['redirect'](_0x1fa6fa(0x267));const _0x360080=new adjustment_finished({'warehouse_name':_0x28e0ee,'date':_0x227918,'product':_0x5c56ac,'note':_0x4f0f03,'room':_0x37bb24,'invoice':_0x33e40f,'JO_number':_0x16c403,'expiry_date':_0x1093a8}),_0x24940b=await _0x360080[_0x1fa6fa(0x1f4)]();_0x464c68['flash'](_0x1fa6fa(0x1e3),'adjustment\x20add\x20successfull'),_0x3e2c33[_0x1fa6fa(0x25f)]('/adjustment_finished/preview/'+_0x24940b[_0x1fa6fa(0x26b)]);}catch(_0x46bd5e){console[_0x1fa6fa(0x254)](_0x46bd5e),_0x3e2c33[_0x1fa6fa(0x1f0)](0xc8)[_0x1fa6fa(0x26f)]({'message':_0x46bd5e[_0x1fa6fa(0x214)]});}}),router[a0_0x2ec6a8(0x278)](a0_0x2ec6a8(0x28f),auth,async(_0x533823,_0x124093)=>{var _0x39331e=a0_0x2ec6a8;try{const {username:_0x293386,email:_0x39634f,role:_0x58c72c}=_0x533823[_0x39331e(0x25e)],_0x27805b=_0x533823[_0x39331e(0x25e)],_0x5a6236=await profile[_0x39331e(0x211)]({'email':_0x27805b[_0x39331e(0x222)]}),_0x5c9054=await master_shop[_0x39331e(0x25d)](),_0x5bb035=_0x533823['params']['id'],_0x4e33cf=await adjustment_finished[_0x39331e(0x28c)]({'_id':_0x5bb035}),_0x453340=await purchases[_0x39331e(0x248)]([{'$match':{'warehouse_name':_0x4e33cf[_0x39331e(0x1ed)]}},{'$unwind':_0x39331e(0x268)},{'$group':{'_id':'$product.product_name'}}]);console[_0x39331e(0x254)](_0x39331e(0x20c),_0x453340);const _0x129fd0=await product['find']({}),_0x34d142=await warehouse[_0x39331e(0x248)]([{'$match':{'name':_0x4e33cf[_0x39331e(0x1ed)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x39331e(0x279)},{'$group':{'_id':_0x39331e(0x284),'name':{'$first':_0x39331e(0x276)},'product_stock':{'$first':_0x39331e(0x20d)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x39331e(0x21f)},'type':{'$first':_0x39331e(0x231)},'floorlevel':{'$first':_0x39331e(0x247)},'primary_code':{'$first':_0x39331e(0x240)},'secondary_code':{'$first':_0x39331e(0x203)},'product_code':{'$first':_0x39331e(0x208)},'storage':{'$first':_0x39331e(0x1e8)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x39331e(0x249)},'production_date':{'$first':_0x39331e(0x235)},'batch_code':{'$first':_0x39331e(0x21e)},'maxPerUnit':{'$first':_0x39331e(0x210)},'room':{'$first':'$room'}}}]);if(_0x5c9054[0x0][_0x39331e(0x213)]==_0x39331e(0x294)){var _0x17bc83=users[_0x39331e(0x23d)];console[_0x39331e(0x254)](_0x17bc83);}else{if(_0x5c9054[0x0][_0x39331e(0x213)]==_0x39331e(0x255))var _0x17bc83=users[_0x39331e(0x255)];else{if(_0x5c9054[0x0][_0x39331e(0x213)]==_0x39331e(0x27e))var _0x17bc83=users[_0x39331e(0x27e)];else{if(_0x5c9054[0x0][_0x39331e(0x213)]=='Spanish')var _0x17bc83=users[_0x39331e(0x219)];else{if(_0x5c9054[0x0][_0x39331e(0x213)]==_0x39331e(0x28d))var _0x17bc83=users['French'];else{if(_0x5c9054[0x0][_0x39331e(0x213)]==_0x39331e(0x1fe))var _0x17bc83=users['Portuguese'];else{if(_0x5c9054[0x0]['language']==_0x39331e(0x289))var _0x17bc83=users[_0x39331e(0x289)];else{if(_0x5c9054[0x0][_0x39331e(0x213)]=='Arabic\x20(ae)')var _0x17bc83=users[_0x39331e(0x1ea)];}}}}}}}_0x124093[_0x39331e(0x264)](_0x39331e(0x271),{'success':_0x533823[_0x39331e(0x1fa)](_0x39331e(0x1e3)),'errors':_0x533823[_0x39331e(0x1fa)](_0x39331e(0x24f)),'role':_0x27805b,'profile':_0x5a6236,'adjustment':_0x4e33cf,'stock':_0x34d142,'master_shop':_0x5c9054,'warehouse_name':_0x453340,'unit':_0x129fd0,'language':_0x17bc83});}catch(_0x585290){console[_0x39331e(0x254)](_0x585290),_0x124093[_0x39331e(0x1f0)](0xc8)['json']({'message':_0x585290[_0x39331e(0x214)]});}}),router[a0_0x2ec6a8(0x27f)](a0_0x2ec6a8(0x28f),auth,async(_0x2e7c9a,_0x386140)=>{var _0x161dc8=a0_0x2ec6a8;try{const {invoice:_0x2a3e81,warehouse_name:_0x13a61b,Room_name:_0x15f28c}=_0x2e7c9a['body'],_0x1337e2=_0x2e7c9a['params']['id'],_0xa8c198=await adjustment_finished[_0x161dc8(0x28c)]({'_id':_0x1337e2});var _0x1917c7;const _0x4dfde8=_0xa8c198['product'][_0x161dc8(0x200)](async _0x4dd604=>{var _0x4c4ccf=_0x161dc8;if(_0x4dd604[_0x4c4ccf(0x229)]>0x0){_0x1917c7=await warehouse['findOne']({'name':_0x13a61b,'room':_0x4dd604[_0x4c4ccf(0x226)],'warehouse_category':'Finished\x20Goods'});const _0x38f7dc=_0x1917c7[_0x4c4ccf(0x22c)]['map'](_0x3a6f34=>{var _0x542ba7=_0x4c4ccf;console[_0x542ba7(0x254)](_0x4dd604[_0x542ba7(0x1ec)]);if(_0x4dd604[_0x542ba7(0x1ec)]==_0x542ba7(0x1f2))_0x3a6f34[_0x542ba7(0x1f9)]==_0x4dd604[_0x542ba7(0x1f9)]&&_0x3a6f34[_0x542ba7(0x1f8)]==_0x4dd604['bay']&&_0x3a6f34['expiry_date']==_0x4dd604['expiry_date']&&_0x3a6f34[_0x542ba7(0x1eb)]==_0x4dd604[_0x542ba7(0x1eb)]&&_0x3a6f34[_0x542ba7(0x1e4)]==_0x4dd604[_0x542ba7(0x1e4)]&&_0x3a6f34[_0x542ba7(0x238)]==_0x4dd604[_0x542ba7(0x238)]&&(_0x3a6f34[_0x542ba7(0x239)]=_0x3a6f34[_0x542ba7(0x239)]-_0x4dd604[_0x542ba7(0x229)]);else _0x4dd604['types']=='add'&&(_0x3a6f34[_0x542ba7(0x1f9)]==_0x4dd604[_0x542ba7(0x1f9)]&&_0x3a6f34[_0x542ba7(0x1f8)]==_0x4dd604[_0x542ba7(0x1f8)]&&_0x3a6f34[_0x542ba7(0x1ef)]==_0x4dd604[_0x542ba7(0x1ef)]&&_0x3a6f34['production_date']==_0x4dd604['production_date']&&_0x3a6f34[_0x542ba7(0x1e4)]==_0x4dd604['batch_code']&&_0x3a6f34[_0x542ba7(0x238)]==_0x4dd604[_0x542ba7(0x238)]&&(_0x3a6f34[_0x542ba7(0x239)]=_0x3a6f34[_0x542ba7(0x239)]+_0x4dd604[_0x542ba7(0x229)]));});}return _0x1917c7;});Promise[_0x161dc8(0x212)](_0x4dfde8)[_0x161dc8(0x21a)](async _0x331110=>{var _0x38b4a1=_0x161dc8;try{for(const _0x228dac of _0x331110){await _0x228dac['save']();}_0xa8c198[_0x38b4a1(0x26a)]=_0x38b4a1(0x1fb);const _0x439783=await _0xa8c198['save'](),_0x3ac9f3=await master_shop[_0x38b4a1(0x25d)](),_0x4ae785=await email_settings[_0x38b4a1(0x211)](),_0x282352=await supervisor_settings[_0x38b4a1(0x25d)]();var _0x1268c0=_0xa8c198[_0x38b4a1(0x258)],_0x3d7a44='',_0x2c47f6;for(_0x2c47f6 in _0x1268c0){var _0x4fec31='FG';_0xa8c198[_0x38b4a1(0x1ed)]=='DRY\x20GOODS'&&(_0x4fec31='DG'),_0x3d7a44+=_0x38b4a1(0x27b)+_0x38b4a1(0x287)+_0x1268c0[_0x2c47f6]['product_name']+_0x38b4a1(0x260)+_0x38b4a1(0x287)+_0x1268c0[_0x2c47f6][_0x38b4a1(0x283)]+_0x38b4a1(0x260)+_0x38b4a1(0x287)+_0x1268c0[_0x2c47f6][_0x38b4a1(0x229)]+_0x38b4a1(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1268c0[_0x2c47f6][_0x38b4a1(0x25c)]+'</td>'+_0x38b4a1(0x287)+_0x1268c0[_0x2c47f6]['secondary_unit']+_0x38b4a1(0x260)+_0x38b4a1(0x287)+_0xa8c198['warehouse_name']+_0x38b4a1(0x260)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1268c0[_0x2c47f6]['room_names']+'</td>'+_0x38b4a1(0x287)+_0x4fec31+_0x1268c0[_0x2c47f6][_0x38b4a1(0x1f8)]+_0x38b4a1(0x260)+_0x38b4a1(0x292);}let _0x1fb201=nodemailer['createTransport']({'host':_0x4ae785[_0x38b4a1(0x259)],'port':Number(_0x4ae785[_0x38b4a1(0x290)]),'secure':![],'auth':{'user':_0x4ae785['email'],'pass':_0x4ae785[_0x38b4a1(0x269)]}}),_0x54946e={'from':_0x4ae785[_0x38b4a1(0x222)],'to':_0x282352[0x0]['FGSEmail'],'subject':_0x38b4a1(0x220),'attachments':[{'filename':_0x38b4a1(0x1f1),'path':__dirname+_0x38b4a1(0x202)+_0x38b4a1(0x24b)+_0x3ac9f3[0x0][_0x38b4a1(0x253)],'cid':_0x38b4a1(0x1f3)}],'html':_0x38b4a1(0x1e0)+_0x38b4a1(0x291)+'</head><body>'+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x38b4a1(0x26e)+_0x38b4a1(0x26d)+_0x38b4a1(0x282)+_0x38b4a1(0x26e)+_0x38b4a1(0x1e5)+_0x3ac9f3[0x0][_0x38b4a1(0x29f)]+_0x38b4a1(0x286)+_0x38b4a1(0x282)+'</div>'+_0x38b4a1(0x245)+_0x38b4a1(0x26e)+_0x38b4a1(0x273)+_0x38b4a1(0x27d)+_0xa8c198[_0x38b4a1(0x238)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0xa8c198['date']+'\x20'+_0x38b4a1(0x217)+'</h5>'+_0x38b4a1(0x282)+_0x38b4a1(0x206)+_0x38b4a1(0x25b)+'<tr>'+_0x38b4a1(0x262)+_0x38b4a1(0x26c)+_0x38b4a1(0x204)+_0x38b4a1(0x215)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x38b4a1(0x1f5)+_0x38b4a1(0x1fc)+_0x38b4a1(0x295)+_0x38b4a1(0x292)+'</thead>'+_0x38b4a1(0x270)+'\x20'+_0x3d7a44+'\x20'+_0x38b4a1(0x244)+_0x38b4a1(0x230)+_0x38b4a1(0x26e)+_0x38b4a1(0x27c)+_0x38b4a1(0x232)+_0x3ac9f3[0x0][_0x38b4a1(0x29f)]+_0x38b4a1(0x243)+'</div>'+_0x38b4a1(0x282)+_0x38b4a1(0x236)};_0x1fb201['sendMail'](_0x54946e,function(_0x240343,_0x2eba71){var _0x3e0798=_0x38b4a1;_0x240343?(console[_0x3e0798(0x254)](_0x240343),console[_0x3e0798(0x254)](_0x3e0798(0x1dd))):console[_0x3e0798(0x254)](_0x3e0798(0x272));}),_0x2e7c9a[_0x38b4a1(0x1fa)](_0x38b4a1(0x1e3),_0x38b4a1(0x21d)),_0x386140[_0x38b4a1(0x25f)](_0x38b4a1(0x1fd)+_0x439783[_0x38b4a1(0x26b)]);}catch(_0x2ca4e6){console[_0x38b4a1(0x1df)](_0x2ca4e6),_0x386140[_0x38b4a1(0x1f0)](0x1f4)[_0x38b4a1(0x26f)]({'error':_0x38b4a1(0x21c)});}})[_0x161dc8(0x288)](_0x50f186=>{var _0x4931b4=_0x161dc8;console[_0x4931b4(0x1df)](_0x50f186),_0x386140[_0x4931b4(0x1f0)](0x1f4)[_0x4931b4(0x26f)]({'error':_0x4931b4(0x241)});});}catch(_0x78de14){_0x386140[_0x161dc8(0x26f)]({'message':_0x78de14[_0x161dc8(0x214)]});}}),router[a0_0x2ec6a8(0x278)](a0_0x2ec6a8(0x275),auth,async(_0x5dac04,_0x563015)=>{var _0x59e259=a0_0x2ec6a8;try{const {username:_0x5a4853,email:_0x566d46,role:_0x32034b}=_0x5dac04[_0x59e259(0x25e)],_0x436a1f=_0x5dac04[_0x59e259(0x25e)],_0x27dbe3=await profile[_0x59e259(0x211)]({'email':_0x436a1f[_0x59e259(0x222)]}),_0xb4b63d=await master_shop[_0x59e259(0x25d)]();console[_0x59e259(0x254)](_0x59e259(0x29c),_0xb4b63d);const _0x33cab7=_0x5dac04[_0x59e259(0x277)]['id'],_0x4daffb=await adjustment_finished[_0x59e259(0x28c)]({'_id':_0x33cab7});let _0x5ee23a=new Date(_0x4daffb[_0x59e259(0x1ef)]),_0x527093=('0'+_0x5ee23a[_0x59e259(0x20f)]())[_0x59e259(0x209)](-0x2),_0x33c5cd=('0'+(_0x5ee23a['getMonth']()+0x1))[_0x59e259(0x209)](-0x2),_0x4be6af=_0x5ee23a['getFullYear'](),_0x1ceb77=_0x4be6af+'-'+_0x33c5cd+'-'+_0x527093;var _0x2be3ce=['Ambient',_0x59e259(0x296),'Return\x20Rooms'];const _0x20097a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4daffb[_0x59e259(0x1ed)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x59e259(0x20c),_0x20097a);const _0x5ec872=await product['find']({}),_0x297797=await warehouse[_0x59e259(0x248)]([{'$match':{'name':_0x4daffb['warehouse_name'],'room':_0x4daffb[_0x59e259(0x24c)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x59e259(0x276)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x59e259(0x201)},'bin':{'$first':_0x59e259(0x21f)},'type':{'$first':_0x59e259(0x231)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x59e259(0x240)},'secondary_code':{'$first':_0x59e259(0x203)},'product_code':{'$first':_0x59e259(0x208)},'storage':{'$first':_0x59e259(0x1e8)},'rack':{'$first':_0x59e259(0x280)}}}]);if(_0xb4b63d[0x0][_0x59e259(0x213)]=='English\x20(US)'){var _0x540fbd=users['English'];console[_0x59e259(0x254)](_0x540fbd);}else{if(_0xb4b63d[0x0][_0x59e259(0x213)]==_0x59e259(0x255))var _0x540fbd=users[_0x59e259(0x255)];else{if(_0xb4b63d[0x0][_0x59e259(0x213)]=='German')var _0x540fbd=users[_0x59e259(0x27e)];else{if(_0xb4b63d[0x0][_0x59e259(0x213)]==_0x59e259(0x219))var _0x540fbd=users[_0x59e259(0x219)];else{if(_0xb4b63d[0x0][_0x59e259(0x213)]=='French')var _0x540fbd=users[_0x59e259(0x28d)];else{if(_0xb4b63d[0x0][_0x59e259(0x213)]=='Portuguese\x20(BR)')var _0x540fbd=users[_0x59e259(0x1f6)];else{if(_0xb4b63d[0x0][_0x59e259(0x213)]==_0x59e259(0x289))var _0x540fbd=users[_0x59e259(0x289)];else{if(_0xb4b63d[0x0][_0x59e259(0x213)]==_0x59e259(0x266))var _0x540fbd=users[_0x59e259(0x1ea)];}}}}}}}_0x563015[_0x59e259(0x264)](_0x59e259(0x274),{'success':_0x5dac04[_0x59e259(0x1fa)](_0x59e259(0x1e3)),'errors':_0x5dac04[_0x59e259(0x1fa)](_0x59e259(0x24f)),'role':_0x436a1f,'profile':_0x27dbe3,'adjustment':_0x4daffb,'stock':_0x297797,'master_shop':_0xb4b63d,'warehouse_name':_0x20097a,'unit':_0x5ec872,'language':_0x540fbd,'rooms_data':_0x2be3ce,'ed_fullDate':_0x1ceb77});}catch(_0x247847){console[_0x59e259(0x254)](_0x247847),_0x563015[_0x59e259(0x1f0)](0xc8)['json']({'message':_0x247847[_0x59e259(0x214)]});}}),router[a0_0x2ec6a8(0x27f)](a0_0x2ec6a8(0x275),auth,async(_0x24944e,_0x3bb37e)=>{var _0x20d3ef=a0_0x2ec6a8;try{const _0x51e89a=_0x24944e[_0x20d3ef(0x277)]['id'],_0xbfd499=await adjustment_finished['findById']({'_id':_0x51e89a}),_0x401597=await warehouse[_0x20d3ef(0x211)]({'name':_0xbfd499[_0x20d3ef(0x1ed)],'room':_0xbfd499[_0x20d3ef(0x24c)]}),{warehouse_name:_0x3786c2,date:_0x2def4b,prod_name:_0x464f3e,level:_0xb89670,isle:_0x36a3ba,pallet:_0x56f5d1,stock:_0x29b046,types:_0x4bda87,adjust_qty:_0x31edef,new_adjust_qty:_0x44dde6,note:_0x4f6a0f,Room_name:_0x1ee391,invoice:_0xc8f647,JO_number:_0x1a6975}=_0x24944e[_0x20d3ef(0x234)];if(typeof _0x464f3e==_0x20d3ef(0x293))var _0xbd503f=[_0x24944e['body'][_0x20d3ef(0x227)]],_0x281da2=[_0x24944e[_0x20d3ef(0x234)]['level']],_0xb6e1ae=[_0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x24d)]],_0x230408=[_0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x1ec)]],_0x22f294=[_0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x229)]],_0x49564b=[_0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x252)]],_0x5dbede=[_0x24944e[_0x20d3ef(0x234)]['prod_code']],_0x24867e=[_0x24944e[_0x20d3ef(0x234)]['unit']],_0x30eb4c=[_0x24944e['body'][_0x20d3ef(0x28e)]],_0x2afb52=[_0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x1e4)]],_0x32030d=[_0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x1ef)]];else var _0xbd503f=[..._0x24944e[_0x20d3ef(0x234)]['prod_name']],_0x281da2=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x1d7)]],_0xb6e1ae=[..._0x24944e['body'][_0x20d3ef(0x24d)]],_0x230408=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x1ec)]],_0x22f294=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x229)]],_0x49564b=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x252)]],_0x5dbede=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x23c)]],_0x24867e=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x25c)]],_0x30eb4c=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x28e)]],_0x2afb52=[..._0x24944e[_0x20d3ef(0x234)]['batch_code']],_0x32030d=[..._0x24944e[_0x20d3ef(0x234)][_0x20d3ef(0x1ef)]];const _0x2df5d6=_0xbd503f[_0x20d3ef(0x200)](_0x44b629=>{return _0x44b629={'product_name':_0x44b629};});_0x281da2['forEach']((_0x4e0252,_0x4ec1cb)=>{_0x2df5d6[_0x4ec1cb]['bay']=_0x4e0252;}),_0xb6e1ae[_0x20d3ef(0x1da)]((_0x4b846c,_0x46b40c)=>{var _0x198b39=_0x20d3ef;_0x2df5d6[_0x46b40c][_0x198b39(0x207)]=_0x4b846c;}),_0x230408[_0x20d3ef(0x1da)]((_0x5a6f89,_0x22355f)=>{var _0x2e3229=_0x20d3ef;_0x2df5d6[_0x22355f][_0x2e3229(0x1ec)]=_0x5a6f89;}),_0x22f294['forEach']((_0x286af3,_0x1d4ef6)=>{var _0x4ac5da=_0x20d3ef;_0x2df5d6[_0x1d4ef6][_0x4ac5da(0x229)]=_0x286af3;}),_0x49564b[_0x20d3ef(0x1da)]((_0x31fcf1,_0xf0e4f8)=>{var _0x4962a9=_0x20d3ef;_0x2df5d6[_0xf0e4f8][_0x4962a9(0x252)]=_0x31fcf1;}),_0x24867e[_0x20d3ef(0x1da)]((_0x310013,_0x35e477)=>{_0x2df5d6[_0x35e477]['unit']=_0x310013;}),_0x30eb4c[_0x20d3ef(0x1da)]((_0x4e8a47,_0x5c193d)=>{var _0x1840a4=_0x20d3ef;_0x2df5d6[_0x5c193d][_0x1840a4(0x23f)]=_0x4e8a47;}),_0x5dbede[_0x20d3ef(0x1da)]((_0x5f4958,_0xb566e7)=>{var _0x5304c4=_0x20d3ef;_0x2df5d6[_0xb566e7][_0x5304c4(0x283)]=_0x5f4958;}),_0x2afb52[_0x20d3ef(0x1da)]((_0x1a1c85,_0x55f9c1)=>{var _0x24ba29=_0x20d3ef;_0x2df5d6[_0x55f9c1][_0x24ba29(0x1e4)]=_0x1a1c85;}),_0x32030d[_0x20d3ef(0x1da)]((_0x42958a,_0x31fcbd)=>{var _0x4c19b0=_0x20d3ef;_0x2df5d6[_0x31fcbd][_0x4c19b0(0x1ef)]=_0x42958a;});const _0x456767=_0x2df5d6[_0x20d3ef(0x299)](_0x559635=>_0x559635['adjust_qty']!=='0'&&_0x559635[_0x20d3ef(0x229)]!=='');var _0x73554e=0x0;_0x456767['forEach'](_0x5b1a54=>{var _0x1f7d4f=_0x20d3ef;console['log'](_0x1f7d4f(0x20a),_0x5b1a54),parseInt(_0x5b1a54['adjust_qty'])<=0x0&&_0x73554e++;});if(_0x73554e!=0x0)return _0x24944e[_0x20d3ef(0x1fa)](_0x20d3ef(0x24f),_0x20d3ef(0x20b)),_0x3bb37e['redirect'](_0x20d3ef(0x267));_0xbfd499[_0x20d3ef(0x1ed)]=_0x3786c2,_0xbfd499[_0x20d3ef(0x23b)]=_0x2def4b,_0xbfd499['product']=_0x456767,_0xbfd499[_0x20d3ef(0x228)]=_0x4f6a0f,_0xbfd499['room']=_0x1ee391,_0xbfd499['invoice']=_0xc8f647,_0xbfd499[_0x20d3ef(0x216)]=_0x1a6975;const _0x5b40a9=await _0xbfd499[_0x20d3ef(0x1f4)](),_0x1480ae=await warehouse[_0x20d3ef(0x211)]({'name':_0x3786c2,'room':_0x1ee391});_0x5b40a9[_0x20d3ef(0x258)][_0x20d3ef(0x1da)](_0x1eed6e=>{var _0x585e7a=_0x20d3ef;const _0x420563=_0x1480ae['product_details'][_0x585e7a(0x200)](_0x1d117b=>{var _0x5231cb=_0x585e7a;_0x1eed6e['types']==_0x5231cb(0x1f2)?_0x1d117b[_0x5231cb(0x1f9)]==_0x1eed6e[_0x5231cb(0x1f9)]&&_0x1d117b[_0x5231cb(0x1f8)]==_0x1eed6e[_0x5231cb(0x1f8)]&&(_0x1d117b['product_stock']=parseInt(_0x1d117b[_0x5231cb(0x239)])-parseInt(_0x1eed6e[_0x5231cb(0x229)])):_0x1d117b['product_name']==_0x1eed6e[_0x5231cb(0x1f9)]&&_0x1d117b[_0x5231cb(0x1f8)]==_0x1eed6e[_0x5231cb(0x1f8)]&&(_0x1d117b['product_stock']=parseInt(_0x1d117b[_0x5231cb(0x239)])+parseInt(_0x1eed6e[_0x5231cb(0x229)]));});}),await _0x1480ae['save'](),_0x24944e[_0x20d3ef(0x1fa)]('success',_0x20d3ef(0x281)),_0x3bb37e[_0x20d3ef(0x25f)](_0x20d3ef(0x1d9));}catch(_0x2fd42f){console[_0x20d3ef(0x254)](_0x2fd42f);}}),router[a0_0x2ec6a8(0x27f)](a0_0x2ec6a8(0x1e1),async(_0x474ec4,_0x175648)=>{var _0x2c0594=a0_0x2ec6a8;const {primary_code:_0x45eeea,warehouse_data:_0x23a040,rooms_data:_0x45656e,Roomslist:_0x4821e5}=_0x474ec4['body'],_0x156d65=_0x4821e5[_0x2c0594(0x256)](','),_0x1ac3aa=[];async function _0x4bf8a7(_0x4d3728){var _0x44d3b9=_0x2c0594;const _0x37b4b1=await warehouse[_0x44d3b9(0x248)]([{'$match':{'name':_0x23a040,'room':_0x4d3728}},{'$unwind':_0x44d3b9(0x279)},{'$match':{'product_details.primary_code':_0x45eeea}},{'$group':{'_id':_0x44d3b9(0x284),'name':{'$first':_0x44d3b9(0x276)},'product_stock':{'$first':_0x44d3b9(0x20d)},'primary_code':{'$first':_0x44d3b9(0x240)},'secondary_code':{'$first':_0x44d3b9(0x203)},'product_code':{'$first':_0x44d3b9(0x208)},'level':{'$first':_0x44d3b9(0x201)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x44d3b9(0x247)},'unit':{'$first':_0x44d3b9(0x1dc)},'secondary_unit':{'$first':_0x44d3b9(0x1e7)},'storage':{'$first':_0x44d3b9(0x1e8)},'rack':{'$first':_0x44d3b9(0x280)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x44d3b9(0x235)},'batch_code':{'$first':_0x44d3b9(0x21e)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x44d3b9(0x210)},'roomNamed':{'$first':_0x44d3b9(0x257)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x211e67=await warehouse['aggregate']([{'$match':{'name':_0x23a040,'room':_0x4d3728}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x45eeea}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x44d3b9(0x276)},'product_stock':{'$first':_0x44d3b9(0x20d)},'primary_code':{'$first':_0x44d3b9(0x240)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x44d3b9(0x208)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x44d3b9(0x21f)},'type':{'$first':_0x44d3b9(0x231)},'pallet':{'$first':_0x44d3b9(0x247)},'unit':{'$first':_0x44d3b9(0x1dc)},'secondary_unit':{'$first':_0x44d3b9(0x1e7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x44d3b9(0x249)},'production_date':{'$first':_0x44d3b9(0x235)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x44d3b9(0x210)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x37b4b1[_0x44d3b9(0x1e2)]>0x0)_0x1ac3aa[_0x44d3b9(0x223)](_0x37b4b1);else _0x211e67[_0x44d3b9(0x1e2)]>0x0&&_0x1ac3aa['push'](_0x211e67);}const _0x31c7e7=_0x156d65[_0x2c0594(0x200)](_0x2b9da5=>_0x4bf8a7(_0x2b9da5));await Promise[_0x2c0594(0x212)](_0x31c7e7),_0x175648[_0x2c0594(0x26f)](_0x1ac3aa);}),router[a0_0x2ec6a8(0x27f)]('/CheckingWarehouse',async(_0x237a73,_0x303801)=>{var _0x1100f6=a0_0x2ec6a8;const {productCode:_0x5be37b,bay:_0x8df16,warehouses:_0x2662db,room:_0x853311}=_0x237a73[_0x1100f6(0x234)];console[_0x1100f6(0x254)](_0x237a73[_0x1100f6(0x234)]);try{const _0x4b8bb7=await warehouse[_0x1100f6(0x248)]([{'$match':{'name':_0x2662db,'room':_0x853311}},{'$unwind':_0x1100f6(0x279)},{'$match':{'product_details.bay':parseInt(_0x8df16)}},{'$group':{'_id':_0x1100f6(0x284),'name':{'$first':_0x1100f6(0x276)},'product_stock':{'$first':_0x1100f6(0x20d)},'bay':{'$first':_0x1100f6(0x201)},'maxProducts':{'$first':_0x1100f6(0x297)}}}]);_0x303801[_0x1100f6(0x1f0)](0xc8)['json'](_0x4b8bb7);}catch(_0x49294e){_0x303801['status'](0x194)[_0x1100f6(0x26f)]({'message':_0x49294e['message']});}}),module['exports']=router;