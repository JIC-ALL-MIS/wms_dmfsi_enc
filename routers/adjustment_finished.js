function a0_0x8e47(){var _0x47e1f6=['product_name','Router','$product.product_name','<h5>','maxPerUnit','forEach','$product_details.invoice','Arabic\x20(ae)','Secondary_units','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Portuguese','ADJF-','Chinese','logo','<tr>','</div>','get','stock','add_adjustment_finished','1744122BpyHLY','$_id','English\x20(US)','errors','Adjustment\x20Mail','getMonth','production_date','_id','then','warehouse','/adjustment_finished/view','flash','$product_details.maxProducts','product','log','JO_number','</span>','push','product_stock','/barcode_scanner','$product_details.batch_code','createTransport','</td>','room','/adjustment/view','error','<strong>\x20Regards\x20</strong>','render','$product_details.bay','catch','product_code','date','email','unit','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','length','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<h2>\x20','New_Qty_Converted_adj','<span\x20style=\x22float:\x20right;\x22>','3150077QtFVqE','165519vzHAxw','prod_cat','$product_details.bin','foreach\x20newproduct','$product_details.storage','new_adjust_qty','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product','New_Qty_Converted','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/picking_list/PDF_adjustment/','express','prod_name','sendMail','stockBefore','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','German','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Spanish','$date','5081658TwSESB','/upload/','../middleware/auth','<tbody\x20style=\x22text-align:\x20center;\x22>','<!DOCTYPE\x20html>','getFullYear','role','/view','160439PYQrAx','$product_details','language','Logo.png','English','exports','$warehouse_name','string','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.type','image','expiry_date','staff','$product_details.rack','36422570tSbzge','Primary_Units','French','add','Enabled','adjustment\x20add\x20successfull','params','An\x20error\x20occurred\x20while\x20saving\x20data.','$name','Rooms','findById','/adjustment_finished/preview/','password','floor','$product_details.primary_code','<hr\x20class=\x22my-3\x22>','QA\x20Warehouse','success','<div>','Hindi','host','padStart','5yLxJNj','all','master','redirect','types','Arabic','save','4zUMdqi','$product_details.unit','filter','$product_details.product_code','True','$product_details.secondary_code','Finished\x20Goods','room_names','</head><body>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','invoice','bay','Adjustment\x20Finalize\x20Successfully','note','message','slice','</tr>','body','find','map','aggregate','Portuguese\x20(BR)','product_date','warehouse_name','Return\x20Rooms','adjustment\x20data\x20update\x20successfully','prod_code','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','../models/all_models','level','getDate','Error\x20Occurs','<h5\x20style=\x22text-align:\x20left;\x22>','toString','2222136qlaxYK','product_details','</thead>','Enclosed','/../public','secondary_unit','/preview/:id','post','</h5>','An\x20error\x20occurred.','batch_code','prod_invoice','user','$product_details.production_date','$finalize','/view/:id','</table>','/CheckingWarehouse','$product_details.expiry_date','json','$product_details._id','findOne','$product_details.maxPerUnit','adjust_qty','adjustment_finished','$product_details.product_name','$room','432JbEGED','/view/add_adjustment','DRY\x20GOODS','$product.room_names','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','status','$product_details.floorlevel','$product_details.product_stock','Ambient','back'];a0_0x8e47=function(){return _0x47e1f6;};return a0_0x8e47();}var a0_0x30c42d=a0_0x1ed4;function a0_0x1ed4(_0x2f8f42,_0xa83cf4){var _0x8e473=a0_0x8e47();return a0_0x1ed4=function(_0x1ed4bb,_0x82bf0a){_0x1ed4bb=_0x1ed4bb-0x18b;var _0x423795=_0x8e473[_0x1ed4bb];return _0x423795;},a0_0x1ed4(_0x2f8f42,_0xa83cf4);}(function(_0x5b9d64,_0x1ffd69){var _0x48f0d0=a0_0x1ed4,_0x1b0b21=_0x5b9d64();while(!![]){try{var _0x3311b2=-parseInt(_0x48f0d0(0x1f4))/0x1+parseInt(_0x48f0d0(0x21f))/0x2*(-parseInt(_0x48f0d0(0x1ac))/0x3)+parseInt(_0x48f0d0(0x241))/0x4+-parseInt(_0x48f0d0(0x218))/0x5*(parseInt(_0x48f0d0(0x1ec))/0x6)+-parseInt(_0x48f0d0(0x1d5))/0x7+parseInt(_0x48f0d0(0x18f))/0x8*(-parseInt(_0x48f0d0(0x1d6))/0x9)+parseInt(_0x48f0d0(0x202))/0xa;if(_0x3311b2===_0x1ffd69)break;else _0x1b0b21['push'](_0x1b0b21['shift']());}catch(_0x2b24fc){_0x1b0b21['push'](_0x1b0b21['shift']());}}}(a0_0x8e47,0x8eb58));const express=require(a0_0x30c42d(0x1e2)),app=express(),router=express[a0_0x30c42d(0x19a)](),auth=require(a0_0x30c42d(0x1ee)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x30c42d(0x23b)),users=require('../public/language/languages.json'),nodemailer=require('nodemailer');router[a0_0x30c42d(0x1a9)](a0_0x30c42d(0x1f3),auth,async(_0x597de6,_0x85eb1c)=>{var _0x167db7=a0_0x30c42d;try{const {username:_0x1d4d02,email:_0x19074a,role:_0x1fa80f}=_0x597de6[_0x167db7(0x24d)],_0x10617e=_0x597de6[_0x167db7(0x24d)],_0x2c9a62=await profile[_0x167db7(0x256)]({'email':_0x10617e['email']}),_0x23626b=await master_shop[_0x167db7(0x231)]();let _0x4896e3;if(_0x10617e[_0x167db7(0x1f2)]==_0x167db7(0x200)){const _0x348031=await staff[_0x167db7(0x256)]({'email':_0x10617e[_0x167db7(0x1cc)]});_0x4896e3=await warehouse['find']({'status':_0x167db7(0x206),'name':_0x348031['warehouse']});}else _0x4896e3=await warehouse['find']({'status':_0x167db7(0x206)});const _0x30bf07=await product[_0x167db7(0x231)]();let _0x4cdd34;if(_0x10617e[_0x167db7(0x1f2)]==_0x167db7(0x200)){const _0x2b8962=await staff[_0x167db7(0x256)]({'email':_0x10617e[_0x167db7(0x1cc)]});_0x4cdd34=await adjustment_finished[_0x167db7(0x231)]({'warehouse_name':_0x2b8962[_0x167db7(0x1b5)]});}else _0x4cdd34=await adjustment_finished[_0x167db7(0x233)]([{'$unwind':_0x167db7(0x1de)},{'$group':{'_id':_0x167db7(0x1ad),'invoice':{'$first':'$invoice'},'date':{'$first':_0x167db7(0x1eb)},'warehouse_name':{'$first':_0x167db7(0x1fa)},'room':{'$addToSet':_0x167db7(0x192)},'finalize':{'$first':_0x167db7(0x24f)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x23626b[0x0][_0x167db7(0x1f6)]=='English\x20(US)'){var _0x861a93=users[_0x167db7(0x1f8)];console['log'](_0x861a93);}else{if(_0x23626b[0x0]['language']==_0x167db7(0x215))var _0x861a93=users[_0x167db7(0x215)];else{if(_0x23626b[0x0][_0x167db7(0x1f6)]==_0x167db7(0x1e7))var _0x861a93=users[_0x167db7(0x1e7)];else{if(_0x23626b[0x0][_0x167db7(0x1f6)]==_0x167db7(0x1ea))var _0x861a93=users[_0x167db7(0x1ea)];else{if(_0x23626b[0x0][_0x167db7(0x1f6)]==_0x167db7(0x204))var _0x861a93=users[_0x167db7(0x204)];else{if(_0x23626b[0x0][_0x167db7(0x1f6)]=='Portuguese\x20(BR)')var _0x861a93=users['Portuguese'];else{if(_0x23626b[0x0]['language']=='Chinese')var _0x861a93=users[_0x167db7(0x1a5)];else{if(_0x23626b[0x0]['language']==_0x167db7(0x1a0))var _0x861a93=users[_0x167db7(0x21d)];}}}}}}}_0x85eb1c[_0x167db7(0x1c7)](_0x167db7(0x18c),{'success':_0x597de6[_0x167db7(0x1b7)]('success'),'errors':_0x597de6[_0x167db7(0x1b7)](_0x167db7(0x1af)),'role':_0x10617e,'profile':_0x2c9a62,'warehouse':_0x4896e3,'product':_0x30bf07,'adjustment':_0x4cdd34,'master_shop':_0x23626b,'language':_0x861a93});}catch(_0x142b97){console[_0x167db7(0x1ba)](_0x142b97);}});async function getRandom8DigitNumber(){var _0x18198c=a0_0x30c42d;const _0x454d3d=0x989680,_0x47383c=0x5f5e0ff,_0x30cb5b=Math[_0x18198c(0x20f)](Math['random']()*(_0x47383c-_0x454d3d+0x1))+_0x454d3d;var _0xc4e341;const _0x2653f1=await adjustment_finished[_0x18198c(0x256)]({'invoice':_0x18198c(0x1a4)+_0x30cb5b});return _0x2653f1&&_0x2653f1[_0x18198c(0x1d0)]>0x0?_0xc4e341=_0x18198c(0x1a4)+_0x30cb5b:_0xc4e341='ADJF-'+_0x30cb5b,_0xc4e341;}router[a0_0x30c42d(0x1a9)](a0_0x30c42d(0x190),auth,async(_0x21ef93,_0x244ae1)=>{var _0x3dffab=a0_0x30c42d;try{const {username:_0x4e3adf,email:_0x4a9ff4,role:_0x1f91d9}=_0x21ef93[_0x3dffab(0x24d)],_0x3ccd9f=_0x21ef93['user'],_0x5cec10=await profile[_0x3dffab(0x256)]({'email':_0x3ccd9f['email']}),_0x1c366d=await master_shop[_0x3dffab(0x231)]();let _0x71ddb8;if(_0x3ccd9f[_0x3dffab(0x1f2)]==_0x3dffab(0x200)){const _0x58cdf5=await staff[_0x3dffab(0x256)]({'email':_0x3ccd9f[_0x3dffab(0x1cc)]});_0x71ddb8=await warehouse['aggregate']([{'$match':{'status':_0x3dffab(0x206),'name':_0x58cdf5[_0x3dffab(0x1b5)],'warehouse_category':_0x3dffab(0x225),'name':{'$ne':_0x3dffab(0x212)}}},{'$group':{'_id':_0x3dffab(0x20a),'name':{'$first':_0x3dffab(0x20a)}}}]);}else _0x71ddb8=await warehouse['aggregate']([{'$match':{'status':_0x3dffab(0x206),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x3dffab(0x212)}}},{'$group':{'_id':_0x3dffab(0x20a),'name':{'$first':'$name'}}}]);const _0x3ffd36=await product[_0x3dffab(0x231)]({}),_0x4243a6=await adjustment_finished['find']({}),_0x1f94a0=_0x4243a6[_0x3dffab(0x1d0)]+0x1,_0xa230f6='ADJF-'+_0x1f94a0[_0x3dffab(0x240)]()[_0x3dffab(0x217)](0x5,'0');var _0xe13156=[_0x3dffab(0x197),_0x3dffab(0x244),_0x3dffab(0x237)];if(_0x1c366d[0x0][_0x3dffab(0x1f6)]==_0x3dffab(0x1ae))var _0xd72d0=users['English'];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]==_0x3dffab(0x215))var _0xd72d0=users['Hindi'];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]==_0x3dffab(0x1e7))var _0xd72d0=users[_0x3dffab(0x1e7)];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]=='Spanish')var _0xd72d0=users[_0x3dffab(0x1ea)];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]==_0x3dffab(0x204))var _0xd72d0=users['French'];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]=='Portuguese\x20(BR)')var _0xd72d0=users[_0x3dffab(0x1a3)];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]==_0x3dffab(0x1a5))var _0xd72d0=users[_0x3dffab(0x1a5)];else{if(_0x1c366d[0x0][_0x3dffab(0x1f6)]=='Arabic\x20(ae)')var _0xd72d0=users[_0x3dffab(0x21d)];}}}}}}}const _0x4c8e45=getRandom8DigitNumber();_0x4c8e45[_0x3dffab(0x1b4)](_0x2f9233=>{var _0x2828fb=_0x3dffab;_0x244ae1[_0x2828fb(0x1c7)](_0x2828fb(0x1ab),{'success':_0x21ef93[_0x2828fb(0x1b7)]('success'),'errors':_0x21ef93[_0x2828fb(0x1b7)](_0x2828fb(0x1af)),'role':_0x3ccd9f,'profile':_0x5cec10,'warehouse':_0x71ddb8,'product':_0x3ffd36,'master_shop':_0x1c366d,'language':_0xd72d0,'rooms_data':_0xe13156,'invoice_no':_0x2f9233});})[_0x3dffab(0x1c9)](_0x50494d=>{var _0x4c8d58=_0x3dffab;_0x21ef93[_0x4c8d58(0x1b7)](_0x4c8d58(0x1af),_0x4c8d58(0x1dc)),_0x244ae1[_0x4c8d58(0x21b)](_0x4c8d58(0x1c4));});}catch(_0x11ccde){console[_0x3dffab(0x1ba)](_0x11ccde);}}),router['post'](a0_0x30c42d(0x190),auth,async(_0x396226,_0x565932)=>{var _0x183f35=a0_0x30c42d;try{const {warehouse_name:_0x235f6b,date:_0x39ef8a,prod_name:_0x5d90cf,level:_0x54611d,isle:_0x1cb3c4,pallet:_0x13c05b,stock:_0x42b78e,types:_0xf419f5,adjust_qty:_0x4f9881,new_adjust_qty:_0x20667f,note:_0x2956d8,Room_name:_0x2ff474,invoice:_0xc37a6b,JO_number:_0xc56a5,expiry_date:_0x100c58}=_0x396226[_0x183f35(0x230)];if(typeof _0x5d90cf==_0x183f35(0x1fb))var _0x5ee629=[_0x396226[_0x183f35(0x230)][_0x183f35(0x1e3)]],_0x2712a8=[_0x396226[_0x183f35(0x230)][_0x183f35(0x23c)]],_0x3cd52b=[_0x396226[_0x183f35(0x230)][_0x183f35(0x1aa)]],_0x3f09b9=[_0x396226[_0x183f35(0x230)][_0x183f35(0x21c)]],_0x45c0d7=[_0x396226[_0x183f35(0x230)][_0x183f35(0x1d3)]],_0x4440e3=[_0x396226[_0x183f35(0x230)]['New_Qty_Converted']],_0x3f0147=[_0x396226['body'][_0x183f35(0x203)]],_0x49dd12=[_0x396226[_0x183f35(0x230)][_0x183f35(0x1a1)]],_0x19f689=[_0x396226['body'][_0x183f35(0x239)]],_0x5087da=[_0x396226[_0x183f35(0x230)]['batch_code']],_0x558648=[_0x396226[_0x183f35(0x230)][_0x183f35(0x1ff)]],_0x3bd12e=[_0x396226[_0x183f35(0x230)][_0x183f35(0x235)]],_0x3e6ca6=[_0x396226[_0x183f35(0x230)]['prod_cat']],_0x1a8afa=[_0x396226[_0x183f35(0x230)]['Rooms']],_0x3e87ef=[_0x396226[_0x183f35(0x230)][_0x183f35(0x19d)]],_0x45b2ea=[_0x396226[_0x183f35(0x230)][_0x183f35(0x24c)]];else var _0x5ee629=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x1e3)]],_0x2712a8=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x23c)]],_0x3cd52b=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x1aa)]],_0x3f09b9=[..._0x396226['body']['types']],_0x45c0d7=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x1d3)]],_0x4440e3=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x1df)]],_0x3f0147=[..._0x396226['body'][_0x183f35(0x203)]],_0x49dd12=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x1a1)]],_0x19f689=[..._0x396226['body'][_0x183f35(0x239)]],_0x5087da=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x24b)]],_0x558648=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x1ff)]],_0x3bd12e=[..._0x396226['body'][_0x183f35(0x235)]],_0x3e6ca6=[..._0x396226[_0x183f35(0x230)]['prod_cat']],_0x1a8afa=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x20b)]],_0x3e87ef=[..._0x396226[_0x183f35(0x230)][_0x183f35(0x19d)]],_0x45b2ea=[..._0x396226['body'][_0x183f35(0x24c)]];const _0x4aff1e=_0x5ee629['map'](_0x271c21=>{return _0x271c21={'product_name':_0x271c21};});_0x2712a8[_0x183f35(0x19e)]((_0x2f87d2,_0x99e770)=>{var _0x285a3d=_0x183f35;_0x4aff1e[_0x99e770][_0x285a3d(0x22a)]=_0x2f87d2;}),_0x3cd52b[_0x183f35(0x19e)]((_0x5c10fc,_0x550c76)=>{var _0x28057a=_0x183f35;_0x4aff1e[_0x550c76][_0x28057a(0x1e5)]=_0x5c10fc;}),_0x3f09b9['forEach']((_0x2d130a,_0x4896a5)=>{var _0x15b727=_0x183f35;_0x4aff1e[_0x4896a5][_0x15b727(0x21c)]=_0x2d130a;}),_0x45c0d7[_0x183f35(0x19e)]((_0x5cfb17,_0x1eaef8)=>{_0x4aff1e[_0x1eaef8]['adjust_qty']=_0x5cfb17;}),_0x4440e3[_0x183f35(0x19e)]((_0x112b14,_0x158a97)=>{var _0x1adfec=_0x183f35;_0x4aff1e[_0x158a97][_0x1adfec(0x1db)]=_0x112b14;}),_0x3f0147[_0x183f35(0x19e)]((_0xc7f741,_0x53f7e6)=>{var _0x560740=_0x183f35;_0x4aff1e[_0x53f7e6][_0x560740(0x1cd)]=_0xc7f741;}),_0x49dd12[_0x183f35(0x19e)]((_0x1ba277,_0x27333e)=>{var _0x1b7f9c=_0x183f35;_0x4aff1e[_0x27333e][_0x1b7f9c(0x246)]=_0x1ba277;}),_0x19f689[_0x183f35(0x19e)]((_0x18e0d1,_0x1b950a)=>{var _0x288d7e=_0x183f35;_0x4aff1e[_0x1b950a][_0x288d7e(0x1ca)]=_0x18e0d1;}),_0x5087da[_0x183f35(0x19e)]((_0x1cc6f6,_0x9c6647)=>{_0x4aff1e[_0x9c6647]['batch_code']=_0x1cc6f6;}),_0x558648[_0x183f35(0x19e)]((_0x49e578,_0x5097f0)=>{var _0x3d6a7a=_0x183f35;_0x4aff1e[_0x5097f0][_0x3d6a7a(0x1ff)]=_0x49e578;}),_0x3bd12e[_0x183f35(0x19e)]((_0x574db5,_0x798ba5)=>{_0x4aff1e[_0x798ba5]['production_date']=_0x574db5;}),_0x3e6ca6[_0x183f35(0x19e)]((_0x5d9eb2,_0x4e25b4)=>{var _0x18d7c8=_0x183f35;_0x4aff1e[_0x4e25b4][_0x18d7c8(0x1d7)]=_0x5d9eb2;}),_0x1a8afa['forEach']((_0x5ea8d4,_0x446f6b)=>{var _0x3a0e36=_0x183f35;_0x4aff1e[_0x446f6b][_0x3a0e36(0x226)]=_0x5ea8d4;}),_0x3e87ef['forEach']((_0xe79f88,_0x2b473b)=>{var _0x151751=_0x183f35;_0x4aff1e[_0x2b473b][_0x151751(0x19d)]=_0xe79f88;}),_0x45b2ea[_0x183f35(0x19e)]((_0x5db3a5,_0x84660d)=>{var _0x5336d3=_0x183f35;_0x4aff1e[_0x84660d][_0x5336d3(0x229)]=_0x5db3a5;});const _0x55c12e=_0x4aff1e[_0x183f35(0x221)](_0x4e2b60=>_0x4e2b60[_0x183f35(0x18b)]!=='0'&&_0x4e2b60['adjust_qty']!=='');var _0x36e62d=0x0;_0x55c12e[_0x183f35(0x19e)](_0x1e386d=>{var _0x570589=_0x183f35;console['log'](_0x570589(0x1d9),_0x1e386d),parseInt(_0x1e386d[_0x570589(0x18b)])<=0x0&&_0x36e62d++;});if(_0x36e62d!=0x0)return _0x396226[_0x183f35(0x1b7)](_0x183f35(0x1af),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x565932[_0x183f35(0x21b)](_0x183f35(0x198));const _0x19b8a8=new adjustment_finished({'warehouse_name':_0x235f6b,'date':_0x39ef8a,'product':_0x55c12e,'note':_0x2956d8,'room':_0x2ff474,'invoice':_0xc37a6b,'JO_number':_0xc56a5,'expiry_date':_0x100c58}),_0x211560=await _0x19b8a8['save']();_0x396226[_0x183f35(0x1b7)](_0x183f35(0x213),_0x183f35(0x207)),_0x565932[_0x183f35(0x21b)](_0x183f35(0x20d)+_0x211560[_0x183f35(0x1b3)]);}catch(_0xffc3c7){console[_0x183f35(0x1ba)](_0xffc3c7),_0x565932[_0x183f35(0x194)](0xc8)[_0x183f35(0x254)]({'message':_0xffc3c7[_0x183f35(0x22d)]});}}),router['get'](a0_0x30c42d(0x247),auth,async(_0x44cb0f,_0x2d661e)=>{var _0x4258df=a0_0x30c42d;try{const {username:_0x502a6e,email:_0x1baa5b,role:_0x118a48}=_0x44cb0f[_0x4258df(0x24d)],_0x102da9=_0x44cb0f[_0x4258df(0x24d)],_0x4ce94c=await profile['findOne']({'email':_0x102da9[_0x4258df(0x1cc)]}),_0x2ed518=await master_shop['find'](),_0x117f54=_0x44cb0f[_0x4258df(0x208)]['id'],_0x2d657f=await adjustment_finished[_0x4258df(0x20c)]({'_id':_0x117f54}),_0x3b4ace=await purchases[_0x4258df(0x233)]([{'$match':{'warehouse_name':_0x2d657f[_0x4258df(0x236)]}},{'$unwind':_0x4258df(0x1de)},{'$group':{'_id':_0x4258df(0x19b)}}]);console[_0x4258df(0x1ba)]('purchases_data',_0x3b4ace);const _0x536747=await product[_0x4258df(0x231)]({}),_0x6c67bd=await warehouse[_0x4258df(0x233)]([{'$match':{'name':_0x2d657f[_0x4258df(0x236)],'warehouse_category':_0x4258df(0x225)}},{'$unwind':_0x4258df(0x1f5)},{'$group':{'_id':_0x4258df(0x255),'name':{'$first':_0x4258df(0x18d)},'product_stock':{'$first':_0x4258df(0x196)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x4258df(0x1d8)},'type':{'$first':_0x4258df(0x1fd)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x4258df(0x210)},'secondary_code':{'$first':_0x4258df(0x224)},'product_code':{'$first':_0x4258df(0x222)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x4258df(0x253)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x4258df(0x1c0)},'maxPerUnit':{'$first':_0x4258df(0x257)},'room':{'$first':_0x4258df(0x18e)}}}]);if(_0x2ed518[0x0]['language']==_0x4258df(0x1ae)){var _0x4aedf6=users[_0x4258df(0x1f8)];console[_0x4258df(0x1ba)](_0x4aedf6);}else{if(_0x2ed518[0x0][_0x4258df(0x1f6)]==_0x4258df(0x215))var _0x4aedf6=users[_0x4258df(0x215)];else{if(_0x2ed518[0x0]['language']==_0x4258df(0x1e7))var _0x4aedf6=users[_0x4258df(0x1e7)];else{if(_0x2ed518[0x0][_0x4258df(0x1f6)]==_0x4258df(0x1ea))var _0x4aedf6=users[_0x4258df(0x1ea)];else{if(_0x2ed518[0x0]['language']==_0x4258df(0x204))var _0x4aedf6=users['French'];else{if(_0x2ed518[0x0][_0x4258df(0x1f6)]=='Portuguese\x20(BR)')var _0x4aedf6=users[_0x4258df(0x1a3)];else{if(_0x2ed518[0x0]['language']==_0x4258df(0x1a5))var _0x4aedf6=users['Chinese'];else{if(_0x2ed518[0x0][_0x4258df(0x1f6)]==_0x4258df(0x1a0))var _0x4aedf6=users[_0x4258df(0x21d)];}}}}}}}_0x2d661e[_0x4258df(0x1c7)]('edit_adjustment_finished_view',{'success':_0x44cb0f['flash'](_0x4258df(0x213)),'errors':_0x44cb0f['flash']('errors'),'role':_0x102da9,'profile':_0x4ce94c,'adjustment':_0x2d657f,'stock':_0x6c67bd,'master_shop':_0x2ed518,'warehouse_name':_0x3b4ace,'unit':_0x536747,'language':_0x4aedf6});}catch(_0x599320){console[_0x4258df(0x1ba)](_0x599320),_0x2d661e[_0x4258df(0x194)](0xc8)[_0x4258df(0x254)]({'message':_0x599320['message']});}}),router['post']('/preview/:id',auth,async(_0x3a6c6b,_0x1bc6db)=>{var _0x2883e6=a0_0x30c42d;try{const {invoice:_0x5b1e64,warehouse_name:_0xc569fb,Room_name:_0x269943}=_0x3a6c6b['body'],_0x27880a=_0x3a6c6b['params']['id'],_0x9dd6ce=await adjustment_finished[_0x2883e6(0x20c)]({'_id':_0x27880a});var _0x27ad2d;const _0x462931=_0x9dd6ce[_0x2883e6(0x1b9)][_0x2883e6(0x232)](async _0x58b488=>{var _0x2c5468=_0x2883e6;if(_0x58b488[_0x2c5468(0x18b)]>0x0){_0x27ad2d=await warehouse['findOne']({'name':_0xc569fb,'room':_0x58b488[_0x2c5468(0x226)],'warehouse_category':_0x2c5468(0x225)});const _0xef47d6=_0x27ad2d['product_details'][_0x2c5468(0x232)](_0x36111e=>{var _0x7dc2fc=_0x2c5468;console[_0x7dc2fc(0x1ba)](_0x58b488[_0x7dc2fc(0x21c)]);if(_0x58b488[_0x7dc2fc(0x21c)]=='minus')_0x36111e[_0x7dc2fc(0x199)]==_0x58b488[_0x7dc2fc(0x199)]&&_0x36111e['bay']==_0x58b488['bay']&&_0x36111e['expiry_date']==_0x58b488['expiry_date']&&_0x36111e[_0x7dc2fc(0x1b2)]==_0x58b488[_0x7dc2fc(0x1b2)]&&_0x36111e[_0x7dc2fc(0x24b)]==_0x58b488[_0x7dc2fc(0x24b)]&&_0x36111e[_0x7dc2fc(0x229)]==_0x58b488['invoice']&&(_0x36111e[_0x7dc2fc(0x1be)]=_0x36111e[_0x7dc2fc(0x1be)]-_0x58b488[_0x7dc2fc(0x18b)]);else _0x58b488[_0x7dc2fc(0x21c)]==_0x7dc2fc(0x205)&&(_0x36111e[_0x7dc2fc(0x199)]==_0x58b488[_0x7dc2fc(0x199)]&&_0x36111e[_0x7dc2fc(0x22a)]==_0x58b488[_0x7dc2fc(0x22a)]&&_0x36111e[_0x7dc2fc(0x1ff)]==_0x58b488[_0x7dc2fc(0x1ff)]&&_0x36111e['production_date']==_0x58b488[_0x7dc2fc(0x1b2)]&&_0x36111e[_0x7dc2fc(0x24b)]==_0x58b488[_0x7dc2fc(0x24b)]&&_0x36111e['invoice']==_0x58b488[_0x7dc2fc(0x229)]&&(_0x36111e['product_stock']=_0x36111e['product_stock']+_0x58b488[_0x7dc2fc(0x18b)]));});}return _0x27ad2d;});Promise['all'](_0x462931)[_0x2883e6(0x1b4)](async _0x16169f=>{var _0x416b3e=_0x2883e6;try{for(const _0x865622 of _0x16169f){await _0x865622[_0x416b3e(0x21e)]();}_0x9dd6ce['finalize']=_0x416b3e(0x223);const _0x26ec6e=await _0x9dd6ce[_0x416b3e(0x21e)](),_0x381304=await master_shop[_0x416b3e(0x231)](),_0x19c8b2=await email_settings['findOne'](),_0x1586a4=await supervisor_settings[_0x416b3e(0x231)]();var _0x417680=_0x9dd6ce[_0x416b3e(0x1b9)],_0x46f6a7='',_0x547b88;for(_0x547b88 in _0x417680){var _0x1233ec='FG';_0x9dd6ce['warehouse_name']==_0x416b3e(0x191)&&(_0x1233ec='DG'),_0x46f6a7+=_0x416b3e(0x1a7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x417680[_0x547b88][_0x416b3e(0x199)]+'</td>'+_0x416b3e(0x1fc)+_0x417680[_0x547b88]['product_code']+_0x416b3e(0x1c2)+_0x416b3e(0x1fc)+_0x417680[_0x547b88]['adjust_qty']+_0x416b3e(0x1c2)+_0x416b3e(0x1fc)+_0x417680[_0x547b88][_0x416b3e(0x1cd)]+_0x416b3e(0x1c2)+_0x416b3e(0x1fc)+_0x417680[_0x547b88][_0x416b3e(0x246)]+_0x416b3e(0x1c2)+_0x416b3e(0x1fc)+_0x9dd6ce['warehouse_name']+_0x416b3e(0x1c2)+_0x416b3e(0x1fc)+_0x417680[_0x547b88]['room_names']+_0x416b3e(0x1c2)+_0x416b3e(0x1fc)+_0x1233ec+_0x417680[_0x547b88][_0x416b3e(0x22a)]+'</td>'+'</tr>';}let _0x1e6471=nodemailer[_0x416b3e(0x1c1)]({'host':_0x19c8b2[_0x416b3e(0x216)],'port':Number(_0x19c8b2['port']),'secure':![],'auth':{'user':_0x19c8b2[_0x416b3e(0x1cc)],'pass':_0x19c8b2[_0x416b3e(0x20e)]}}),_0x4f55fc={'from':_0x19c8b2[_0x416b3e(0x1cc)],'to':_0x1586a4[0x0][_0x416b3e(0x1e8)],'subject':_0x416b3e(0x1b0),'attachments':[{'filename':_0x416b3e(0x1f7),'path':__dirname+_0x416b3e(0x245)+_0x416b3e(0x1ed)+_0x381304[0x0][_0x416b3e(0x1fe)],'cid':_0x416b3e(0x1a6)}],'html':_0x416b3e(0x1f0)+'<html><head><title></title>'+_0x416b3e(0x227)+_0x416b3e(0x214)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x416b3e(0x214)+_0x416b3e(0x1d1)+_0x416b3e(0x1a8)+_0x416b3e(0x214)+_0x416b3e(0x1d2)+_0x381304[0x0][_0x416b3e(0x1ce)]+'\x20</h2>'+'</div>'+_0x416b3e(0x1a8)+_0x416b3e(0x211)+'<div>'+_0x416b3e(0x23f)+'\x20Order\x20Number\x20:\x20'+_0x9dd6ce['invoice']+'\x20'+_0x416b3e(0x1d4)+'\x20Order\x20Date\x20:\x20'+_0x9dd6ce['date']+'\x20'+_0x416b3e(0x1bc)+_0x416b3e(0x249)+_0x416b3e(0x1a8)+_0x416b3e(0x1dd)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x416b3e(0x1a7)+_0x416b3e(0x1e6)+_0x416b3e(0x1e0)+_0x416b3e(0x228)+_0x416b3e(0x193)+_0x416b3e(0x1e9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x416b3e(0x1cf)+_0x416b3e(0x1a2)+_0x416b3e(0x22f)+_0x416b3e(0x243)+_0x416b3e(0x1ef)+'\x20'+_0x46f6a7+'\x20'+'</tbody>'+_0x416b3e(0x251)+_0x416b3e(0x214)+_0x416b3e(0x1c6)+_0x416b3e(0x19c)+_0x381304[0x0][_0x416b3e(0x1ce)]+_0x416b3e(0x249)+'</div>'+_0x416b3e(0x1a8)+'</body></html>'};_0x1e6471[_0x416b3e(0x1e4)](_0x4f55fc,function(_0x2a253d,_0x501218){var _0x54b328=_0x416b3e;_0x2a253d?(console['log'](_0x2a253d),console[_0x54b328(0x1ba)](_0x54b328(0x23e))):console[_0x54b328(0x1ba)]('Email\x20sent\x20successfully');}),_0x3a6c6b['flash'](_0x416b3e(0x213),_0x416b3e(0x22b)),_0x1bc6db[_0x416b3e(0x21b)](_0x416b3e(0x1e1)+_0x26ec6e[_0x416b3e(0x1b3)]);}catch(_0x51702f){console[_0x416b3e(0x1c5)](_0x51702f),_0x1bc6db[_0x416b3e(0x194)](0x1f4)[_0x416b3e(0x254)]({'error':_0x416b3e(0x209)});}})[_0x2883e6(0x1c9)](_0x3c453a=>{var _0x28b392=_0x2883e6;console[_0x28b392(0x1c5)](_0x3c453a),_0x1bc6db[_0x28b392(0x194)](0x1f4)[_0x28b392(0x254)]({'error':_0x28b392(0x24a)});});}catch(_0x18f28e){_0x1bc6db[_0x2883e6(0x254)]({'message':_0x18f28e[_0x2883e6(0x22d)]});}}),router[a0_0x30c42d(0x1a9)]('/view/:id',auth,async(_0x24da75,_0x2959fb)=>{var _0x141eb3=a0_0x30c42d;try{const {username:_0x3c8e80,email:_0x163c37,role:_0x3a02f5}=_0x24da75[_0x141eb3(0x24d)],_0x467980=_0x24da75[_0x141eb3(0x24d)],_0x2fcc70=await profile['findOne']({'email':_0x467980[_0x141eb3(0x1cc)]}),_0x2f0638=await master_shop[_0x141eb3(0x231)]();console[_0x141eb3(0x1ba)](_0x141eb3(0x21a),_0x2f0638);const _0x24440f=_0x24da75['params']['id'],_0x436779=await adjustment_finished[_0x141eb3(0x20c)]({'_id':_0x24440f});let _0x213d40=new Date(_0x436779['expiry_date']),_0x3be44e=('0'+_0x213d40[_0x141eb3(0x23d)]())[_0x141eb3(0x22e)](-0x2),_0x5a8d4c=('0'+(_0x213d40[_0x141eb3(0x1b1)]()+0x1))[_0x141eb3(0x22e)](-0x2),_0x82ef1d=_0x213d40[_0x141eb3(0x1f1)](),_0x1b6b5d=_0x82ef1d+'-'+_0x5a8d4c+'-'+_0x3be44e;var _0x316cf5=['Ambient',_0x141eb3(0x244),_0x141eb3(0x237)];const _0x3cb59b=await purchases[_0x141eb3(0x233)]([{'$match':{'warehouse_name':_0x436779[_0x141eb3(0x236)]}},{'$unwind':_0x141eb3(0x1de)},{'$group':{'_id':_0x141eb3(0x19b)}}]);console[_0x141eb3(0x1ba)]('purchases_data',_0x3cb59b);const _0x48f36c=await product[_0x141eb3(0x231)]({}),_0x5131fa=await warehouse[_0x141eb3(0x233)]([{'$match':{'name':_0x436779[_0x141eb3(0x236)],'room':_0x436779[_0x141eb3(0x1c3)]}},{'$unwind':_0x141eb3(0x1f5)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x141eb3(0x196)},'bay':{'$first':_0x141eb3(0x1c8)},'bin':{'$first':_0x141eb3(0x1d8)},'type':{'$first':_0x141eb3(0x1fd)},'floorlevel':{'$first':_0x141eb3(0x195)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x141eb3(0x224)},'product_code':{'$first':_0x141eb3(0x222)},'storage':{'$first':_0x141eb3(0x1da)},'rack':{'$first':_0x141eb3(0x201)}}}]);if(_0x2f0638[0x0][_0x141eb3(0x1f6)]==_0x141eb3(0x1ae)){var _0xd48aea=users[_0x141eb3(0x1f8)];console[_0x141eb3(0x1ba)](_0xd48aea);}else{if(_0x2f0638[0x0][_0x141eb3(0x1f6)]==_0x141eb3(0x215))var _0xd48aea=users[_0x141eb3(0x215)];else{if(_0x2f0638[0x0]['language']==_0x141eb3(0x1e7))var _0xd48aea=users['German'];else{if(_0x2f0638[0x0]['language']==_0x141eb3(0x1ea))var _0xd48aea=users[_0x141eb3(0x1ea)];else{if(_0x2f0638[0x0]['language']=='French')var _0xd48aea=users['French'];else{if(_0x2f0638[0x0][_0x141eb3(0x1f6)]==_0x141eb3(0x234))var _0xd48aea=users['Portuguese'];else{if(_0x2f0638[0x0][_0x141eb3(0x1f6)]==_0x141eb3(0x1a5))var _0xd48aea=users[_0x141eb3(0x1a5)];else{if(_0x2f0638[0x0][_0x141eb3(0x1f6)]=='Arabic\x20(ae)')var _0xd48aea=users[_0x141eb3(0x21d)];}}}}}}}_0x2959fb[_0x141eb3(0x1c7)]('edit_adjustment_finished',{'success':_0x24da75['flash']('success'),'errors':_0x24da75[_0x141eb3(0x1b7)](_0x141eb3(0x1af)),'role':_0x467980,'profile':_0x2fcc70,'adjustment':_0x436779,'stock':_0x5131fa,'master_shop':_0x2f0638,'warehouse_name':_0x3cb59b,'unit':_0x48f36c,'language':_0xd48aea,'rooms_data':_0x316cf5,'ed_fullDate':_0x1b6b5d});}catch(_0x1f53e8){console['log'](_0x1f53e8),_0x2959fb[_0x141eb3(0x194)](0xc8)[_0x141eb3(0x254)]({'message':_0x1f53e8[_0x141eb3(0x22d)]});}}),router[a0_0x30c42d(0x248)](a0_0x30c42d(0x250),auth,async(_0x371f2f,_0x1308bb)=>{var _0x153bee=a0_0x30c42d;try{const _0x455b76=_0x371f2f[_0x153bee(0x208)]['id'],_0x1138f7=await adjustment_finished['findById']({'_id':_0x455b76}),_0x2c5304=await warehouse['findOne']({'name':_0x1138f7['warehouse_name'],'room':_0x1138f7[_0x153bee(0x1c3)]}),{warehouse_name:_0x5c0389,date:_0x4b9d7e,prod_name:_0x83d65b,level:_0x2bebdc,isle:_0x40d136,pallet:_0x44cd06,stock:_0x112305,types:_0x3b1101,adjust_qty:_0x22d6a3,new_adjust_qty:_0x4425ac,note:_0x38afad,Room_name:_0xd8ddb3,invoice:_0x5d4a4f,JO_number:_0x3669c3}=_0x371f2f[_0x153bee(0x230)];if(typeof _0x83d65b==_0x153bee(0x1fb))var _0x268bab=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x1e3)]],_0xef1e38=[_0x371f2f['body'][_0x153bee(0x23c)]],_0x170161=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x1aa)]],_0x32c196=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x21c)]],_0x2d015c=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x18b)]],_0x219ce7=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x1db)]],_0x165f1e=[_0x371f2f['body'][_0x153bee(0x239)]],_0x1d78a4=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x1cd)]],_0x19635e=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x1a1)]],_0x5da44d=[_0x371f2f[_0x153bee(0x230)][_0x153bee(0x24b)]],_0x2ed4c9=[_0x371f2f[_0x153bee(0x230)]['expiry_date']];else var _0x268bab=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x1e3)]],_0xef1e38=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x23c)]],_0x170161=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x1aa)]],_0x32c196=[..._0x371f2f['body'][_0x153bee(0x21c)]],_0x2d015c=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x18b)]],_0x219ce7=[..._0x371f2f['body'][_0x153bee(0x1db)]],_0x165f1e=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x239)]],_0x1d78a4=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x1cd)]],_0x19635e=[..._0x371f2f['body'][_0x153bee(0x1a1)]],_0x5da44d=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x24b)]],_0x2ed4c9=[..._0x371f2f[_0x153bee(0x230)][_0x153bee(0x1ff)]];const _0x165e3f=_0x268bab[_0x153bee(0x232)](_0x235998=>{return _0x235998={'product_name':_0x235998};});_0xef1e38[_0x153bee(0x19e)]((_0x25edb4,_0x4f0a5c)=>{var _0x122866=_0x153bee;_0x165e3f[_0x4f0a5c][_0x122866(0x22a)]=_0x25edb4;}),_0x170161['forEach']((_0x51af7c,_0x36bd72)=>{_0x165e3f[_0x36bd72]['stockBefore']=_0x51af7c;}),_0x32c196[_0x153bee(0x19e)]((_0x5a8be4,_0x29db74)=>{_0x165e3f[_0x29db74]['types']=_0x5a8be4;}),_0x2d015c[_0x153bee(0x19e)]((_0x3280dd,_0x527829)=>{var _0x836dee=_0x153bee;_0x165e3f[_0x527829][_0x836dee(0x18b)]=_0x3280dd;}),_0x219ce7['forEach']((_0xa10274,_0x29263b)=>{_0x165e3f[_0x29263b]['new_adjust_qty']=_0xa10274;}),_0x1d78a4[_0x153bee(0x19e)]((_0x1a9069,_0xfed842)=>{var _0x235e5d=_0x153bee;_0x165e3f[_0xfed842][_0x235e5d(0x1cd)]=_0x1a9069;}),_0x19635e[_0x153bee(0x19e)]((_0x42f416,_0x4e16ff)=>{var _0x141822=_0x153bee;_0x165e3f[_0x4e16ff][_0x141822(0x246)]=_0x42f416;}),_0x165f1e[_0x153bee(0x19e)]((_0x3fcc11,_0xbfc6ad)=>{_0x165e3f[_0xbfc6ad]['product_code']=_0x3fcc11;}),_0x5da44d['forEach']((_0x3b041b,_0x2c4a2d)=>{var _0x455d1c=_0x153bee;_0x165e3f[_0x2c4a2d][_0x455d1c(0x24b)]=_0x3b041b;}),_0x2ed4c9['forEach']((_0x35b7c6,_0x559ebf)=>{_0x165e3f[_0x559ebf]['expiry_date']=_0x35b7c6;});const _0xf6caa6=_0x165e3f[_0x153bee(0x221)](_0x29e823=>_0x29e823[_0x153bee(0x18b)]!=='0'&&_0x29e823[_0x153bee(0x18b)]!=='');var _0x579072=0x0;_0xf6caa6[_0x153bee(0x19e)](_0x37738c=>{var _0x4e257e=_0x153bee;console[_0x4e257e(0x1ba)](_0x4e257e(0x1d9),_0x37738c),parseInt(_0x37738c[_0x4e257e(0x18b)])<=0x0&&_0x579072++;});if(_0x579072!=0x0)return _0x371f2f[_0x153bee(0x1b7)](_0x153bee(0x1af),_0x153bee(0x23a)),_0x1308bb[_0x153bee(0x21b)](_0x153bee(0x198));_0x1138f7['warehouse_name']=_0x5c0389,_0x1138f7[_0x153bee(0x1cb)]=_0x4b9d7e,_0x1138f7[_0x153bee(0x1b9)]=_0xf6caa6,_0x1138f7[_0x153bee(0x22c)]=_0x38afad,_0x1138f7[_0x153bee(0x1c3)]=_0xd8ddb3,_0x1138f7['invoice']=_0x5d4a4f,_0x1138f7[_0x153bee(0x1bb)]=_0x3669c3;const _0x14be66=await _0x1138f7[_0x153bee(0x21e)](),_0xc3cc9c=await warehouse[_0x153bee(0x256)]({'name':_0x5c0389,'room':_0xd8ddb3});_0x14be66['product']['forEach'](_0x5657b8=>{var _0x9b46f7=_0x153bee;const _0x29a552=_0xc3cc9c[_0x9b46f7(0x242)][_0x9b46f7(0x232)](_0x2d6c92=>{var _0xbd20e=_0x9b46f7;_0x5657b8[_0xbd20e(0x21c)]=='minus'?_0x2d6c92['product_name']==_0x5657b8[_0xbd20e(0x199)]&&_0x2d6c92[_0xbd20e(0x22a)]==_0x5657b8[_0xbd20e(0x22a)]&&(_0x2d6c92[_0xbd20e(0x1be)]=parseInt(_0x2d6c92[_0xbd20e(0x1be)])-parseInt(_0x5657b8[_0xbd20e(0x18b)])):_0x2d6c92[_0xbd20e(0x199)]==_0x5657b8[_0xbd20e(0x199)]&&_0x2d6c92[_0xbd20e(0x22a)]==_0x5657b8['bay']&&(_0x2d6c92[_0xbd20e(0x1be)]=parseInt(_0x2d6c92['product_stock'])+parseInt(_0x5657b8[_0xbd20e(0x18b)]));});}),await _0xc3cc9c[_0x153bee(0x21e)](),_0x371f2f[_0x153bee(0x1b7)]('success',_0x153bee(0x238)),_0x1308bb[_0x153bee(0x21b)](_0x153bee(0x1b6));}catch(_0x2af420){console[_0x153bee(0x1ba)](_0x2af420);}}),router[a0_0x30c42d(0x248)](a0_0x30c42d(0x1bf),async(_0x142896,_0x2ac9a4)=>{var _0x3db2bf=a0_0x30c42d;const {primary_code:_0x4649d2,warehouse_data:_0x45da53,rooms_data:_0x152de2,Roomslist:_0x25f212}=_0x142896[_0x3db2bf(0x230)],_0x43ab0b=_0x25f212['split'](','),_0x378fb2=[];async function _0x577be6(_0x385e1c){var _0x11d653=_0x3db2bf;const _0x2e71b8=await warehouse[_0x11d653(0x233)]([{'$match':{'name':_0x45da53,'room':_0x385e1c}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x4649d2}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x11d653(0x222)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x11d653(0x1d8)},'type':{'$first':_0x11d653(0x1fd)},'pallet':{'$first':_0x11d653(0x195)},'unit':{'$first':_0x11d653(0x220)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x11d653(0x1da)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x11d653(0x253)},'production_date':{'$first':_0x11d653(0x24e)},'batch_code':{'$first':_0x11d653(0x1c0)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x11d653(0x257)},'roomNamed':{'$first':_0x11d653(0x18e)},'invoice':{'$first':_0x11d653(0x19f)}}}]),_0x589d98=await warehouse['aggregate']([{'$match':{'name':_0x45da53,'room':_0x385e1c}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x4649d2}},{'$group':{'_id':_0x11d653(0x255),'name':{'$first':_0x11d653(0x18d)},'product_stock':{'$first':_0x11d653(0x196)},'primary_code':{'$first':_0x11d653(0x210)},'secondary_code':{'$first':_0x11d653(0x224)},'product_code':{'$first':_0x11d653(0x222)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x11d653(0x1d8)},'type':{'$first':_0x11d653(0x1fd)},'pallet':{'$first':_0x11d653(0x195)},'unit':{'$first':_0x11d653(0x220)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x11d653(0x1da)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x11d653(0x24e)},'batch_code':{'$first':_0x11d653(0x1c0)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x11d653(0x257)},'roomNamed':{'$first':_0x11d653(0x18e)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2e71b8[_0x11d653(0x1d0)]>0x0)_0x378fb2['push'](_0x2e71b8);else _0x589d98[_0x11d653(0x1d0)]>0x0&&_0x378fb2[_0x11d653(0x1bd)](_0x589d98);}const _0x22b199=_0x43ab0b['map'](_0x179159=>_0x577be6(_0x179159));await Promise[_0x3db2bf(0x219)](_0x22b199),_0x2ac9a4[_0x3db2bf(0x254)](_0x378fb2);}),router[a0_0x30c42d(0x248)](a0_0x30c42d(0x252),async(_0x212a78,_0x13d0dd)=>{var _0x2e726b=a0_0x30c42d;const {productCode:_0x396caa,bay:_0x58b16f,warehouses:_0x1028da,room:_0x2f6ae9}=_0x212a78[_0x2e726b(0x230)];console[_0x2e726b(0x1ba)](_0x212a78[_0x2e726b(0x230)]);try{const _0x116ed6=await warehouse[_0x2e726b(0x233)]([{'$match':{'name':_0x1028da,'room':_0x2f6ae9}},{'$unwind':_0x2e726b(0x1f5)},{'$match':{'product_details.bay':parseInt(_0x58b16f)}},{'$group':{'_id':_0x2e726b(0x255),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x2e726b(0x1c8)},'maxProducts':{'$first':_0x2e726b(0x1b8)}}}]);_0x13d0dd[_0x2e726b(0x194)](0xc8)[_0x2e726b(0x254)](_0x116ed6);}catch(_0x959aeb){_0x13d0dd[_0x2e726b(0x194)](0x194)[_0x2e726b(0x254)]({'message':_0x959aeb['message']});}}),module[a0_0x30c42d(0x1f9)]=router;