var a0_0x164751=a0_0x5d70;(function(_0x5263f0,_0x432ee4){var _0x1a4dc4=a0_0x5d70,_0x4323c5=_0x5263f0();while(!![]){try{var _0x259982=-parseInt(_0x1a4dc4(0x11e))/0x1*(parseInt(_0x1a4dc4(0x14e))/0x2)+parseInt(_0x1a4dc4(0x10a))/0x3+-parseInt(_0x1a4dc4(0x112))/0x4*(-parseInt(_0x1a4dc4(0x133))/0x5)+parseInt(_0x1a4dc4(0xd7))/0x6*(-parseInt(_0x1a4dc4(0xbd))/0x7)+-parseInt(_0x1a4dc4(0x92))/0x8*(parseInt(_0x1a4dc4(0xd3))/0x9)+-parseInt(_0x1a4dc4(0xbb))/0xa*(-parseInt(_0x1a4dc4(0x10c))/0xb)+-parseInt(_0x1a4dc4(0xc4))/0xc*(parseInt(_0x1a4dc4(0xd1))/0xd);if(_0x259982===_0x432ee4)break;else _0x4323c5['push'](_0x4323c5['shift']());}catch(_0x16222c){_0x4323c5['push'](_0x4323c5['shift']());}}}(a0_0x2fbb,0x2d25e));function a0_0x5d70(_0x3362c1,_0x175bd8){var _0x2fbb06=a0_0x2fbb();return a0_0x5d70=function(_0x5d70da,_0x32052c){_0x5d70da=_0x5d70da-0x91;var _0x57388d=_0x2fbb06[_0x5d70da];return _0x57388d;},a0_0x5d70(_0x3362c1,_0x175bd8);}const express=require(a0_0x164751(0xec)),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x164751(0xf5)),users=require(a0_0x164751(0x141)),nodemailer=require(a0_0x164751(0xbe));router['get'](a0_0x164751(0x106),auth,async(_0x21dab9,_0x46b790)=>{var _0x5056a7=a0_0x164751;try{const {username:_0x5d133e,email:_0x13e25c,role:_0x3a6d7b}=_0x21dab9['user'],_0x3729b7=_0x21dab9[_0x5056a7(0xc7)],_0x48aef2=await profile[_0x5056a7(0x95)]({'email':_0x3729b7[_0x5056a7(0x144)]}),_0x48e2af=await master_shop[_0x5056a7(0xfa)]();let _0x27f6e4;if(_0x3729b7['role']==_0x5056a7(0xc6)){const _0x38c476=await staff['findOne']({'email':_0x3729b7['email']});_0x27f6e4=await warehouse['find']({'status':_0x5056a7(0xae),'name':_0x38c476[_0x5056a7(0x13e)]});}else _0x27f6e4=await warehouse[_0x5056a7(0xfa)]({'status':_0x5056a7(0xae)});const _0x542108=await product['find']();let _0xe43267;if(_0x3729b7[_0x5056a7(0xb3)]==_0x5056a7(0xc6)){const _0xe60da6=await staff[_0x5056a7(0x95)]({'email':_0x3729b7[_0x5056a7(0x144)]});_0xe43267=await adjustment_finished['find']({'warehouse_name':_0xe60da6['warehouse']});}else _0xe43267=await adjustment_finished[_0x5056a7(0x136)]([{'$unwind':_0x5056a7(0x157)},{'$group':{'_id':_0x5056a7(0xd0),'invoice':{'$first':_0x5056a7(0xb5)},'date':{'$first':_0x5056a7(0xca)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x5056a7(0x151)},'finalize':{'$first':_0x5056a7(0x104)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x48e2af[0x0][_0x5056a7(0x134)]=='English\x20(US)'){var _0x21a797=users[_0x5056a7(0x153)];console[_0x5056a7(0x113)](_0x21a797);}else{if(_0x48e2af[0x0][_0x5056a7(0x134)]==_0x5056a7(0xe6))var _0x21a797=users[_0x5056a7(0xe6)];else{if(_0x48e2af[0x0][_0x5056a7(0x134)]==_0x5056a7(0xd2))var _0x21a797=users['German'];else{if(_0x48e2af[0x0][_0x5056a7(0x134)]==_0x5056a7(0x149))var _0x21a797=users[_0x5056a7(0x149)];else{if(_0x48e2af[0x0]['language']==_0x5056a7(0xa7))var _0x21a797=users['French'];else{if(_0x48e2af[0x0]['language']==_0x5056a7(0xda))var _0x21a797=users['Portuguese'];else{if(_0x48e2af[0x0][_0x5056a7(0x134)]==_0x5056a7(0x164))var _0x21a797=users[_0x5056a7(0x164)];else{if(_0x48e2af[0x0][_0x5056a7(0x134)]==_0x5056a7(0x12f))var _0x21a797=users['Arabic'];}}}}}}}_0x46b790[_0x5056a7(0xba)](_0x5056a7(0x12a),{'success':_0x21dab9[_0x5056a7(0x105)]('success'),'errors':_0x21dab9[_0x5056a7(0x105)](_0x5056a7(0x129)),'role':_0x3729b7,'profile':_0x48aef2,'warehouse':_0x27f6e4,'product':_0x542108,'adjustment':_0xe43267,'master_shop':_0x48e2af,'language':_0x21a797});}catch(_0x2ce274){console['log'](_0x2ce274);}});function a0_0x2fbb(){var _0x4ed274=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Email\x20sent\x20successfully','save','master','getFullYear','105cBMyrN','True','bay','$room','prod_invoice','QA\x20Warehouse','$product_details.storage','prod_code','split','An\x20error\x20occurred\x20while\x20saving\x20data.','<div>','errors','adjustment_finished','foreach\x20newproduct','product','edit_adjustment_finished_view','getMonth','Arabic\x20(ae)','sendMail','purchases_data','$product_details.type','55nJqszP','language','\x20</h2>','aggregate','</body></html>','level','</div>','</thead>','types','params','room_names','warehouse','new_adjust_qty','<h5\x20style=\x22text-align:\x20left;\x22>','../public/language/languages.json','stockBefore','New_Qty_Converted_adj','email','get','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','/picking_list/PDF_adjustment/','product_date','Spanish','host','<span\x20style=\x22float:\x20right;\x22>','forEach','<hr\x20class=\x22my-3\x22>','1622rHxygv','push','$product_details.maxProducts','$product.room_names','edit_adjustment_finished','English','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Adjustment\x20Mail','$product','$product_details.secondary_unit','</td>','product_stock','\x20Order\x20Date\x20:\x20','$product_details.expiry_date','<tbody\x20style=\x22text-align:\x20center;\x22>','Secondary_units','Portuguese','back','<!DOCTYPE\x20html>','secondary_unit','Primary_Units','Chinese','Rooms','body','1530344KYQHVY','date','findById','findOne','$product_details.production_date','$product.product_name','note','product_name','createTransport','getDate','New_Qty_Converted','minus','An\x20error\x20occurred.','status','$product_details.bin','map','expiry_date','</table>','finalize','image','Return\x20Rooms','French','/view/:id','$product_details.invoice','$product_details.rack','There\x27s\x20a\x20error\x20in\x20this\x20transaction','json','</head><body>','Enabled','warehouse_name','success','Finished\x20Goods','maxPerUnit','role','$product_details.product_stock','$invoice','all','/adjustment_finished/preview/','catch','port','render','2878550JlhiQQ','product_code','8666jfRHVC','nodemailer','/adjustment_finished/view','then','<tr>','$name','Ambient','2088CGBMsI','random','staff','user','</span>','Enclosed','$date','ADJF-','Error\x20Occurs','slice','prod_name','$product_details.bay','$_id','17316NUtqOq','German','9bFkxYl','DRY\x20GOODS','<strong>\x20Regards\x20</strong>','$product_details','648mFcxub','post','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Portuguese\x20(BR)','prod_cat','unit','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/view/add_adjustment','$product_details.unit','Adjustment\x20Finalize\x20Successfully','/preview/:id','</tr>','adjustment\x20data\x20update\x20successfully','$product_details.batch_code','Hindi','production_date','Arabic','error','_id','batch_code','express','site_title','message','adjust_qty','$product_details.primary_code','redirect','<h5>','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','../models/all_models','</h5>','exports','string','\x20Order\x20Number\x20:\x20','find','$product_details.product_name','add_adjustment_finished','invoice','floor','adjustment\x20add\x20successfull','filter','<html><head><title></title>','length','English\x20(US)','$finalize','flash','/view','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','stock','895692omWbUb','room','11gHOUvh','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','add','Logo.png','$product_details.product_code','87428WJZTRV','log','$product_details.floorlevel','$product_details.maxPerUnit','$product_details._id','$product_details.secondary_code'];a0_0x2fbb=function(){return _0x4ed274;};return a0_0x2fbb();}async function getRandom8DigitNumber(){var _0x1ea42=a0_0x164751;const _0x3cc24a=0x989680,_0x33f385=0x5f5e0ff,_0x480766=Math[_0x1ea42(0xfe)](Math[_0x1ea42(0xc5)]()*(_0x33f385-_0x3cc24a+0x1))+_0x3cc24a;var _0x748915;const _0x826509=await adjustment_finished[_0x1ea42(0x95)]({'invoice':_0x1ea42(0xcb)+_0x480766});return _0x826509&&_0x826509[_0x1ea42(0x102)]>0x0?_0x748915=_0x1ea42(0xcb)+_0x480766:_0x748915='ADJF-'+_0x480766,_0x748915;}router[a0_0x164751(0x145)](a0_0x164751(0xdf),auth,async(_0x52c512,_0xb29570)=>{var _0x3545fe=a0_0x164751;try{const {username:_0x3c5b09,email:_0x29a5f2,role:_0x5216ea}=_0x52c512[_0x3545fe(0xc7)],_0x3564b9=_0x52c512['user'],_0x49ca8d=await profile[_0x3545fe(0x95)]({'email':_0x3564b9[_0x3545fe(0x144)]}),_0x4e0b44=await master_shop[_0x3545fe(0xfa)]();let _0x1337ec;if(_0x3564b9[_0x3545fe(0xb3)]==_0x3545fe(0xc6)){const _0x12eb88=await staff[_0x3545fe(0x95)]({'email':_0x3564b9[_0x3545fe(0x144)]});_0x1337ec=await warehouse[_0x3545fe(0x136)]([{'$match':{'status':_0x3545fe(0xae),'name':_0x12eb88[_0x3545fe(0x13e)],'warehouse_category':_0x3545fe(0xb1),'name':{'$ne':_0x3545fe(0x123)}}},{'$group':{'_id':_0x3545fe(0xc2),'name':{'$first':_0x3545fe(0xc2)}}}]);}else _0x1337ec=await warehouse[_0x3545fe(0x136)]([{'$match':{'status':_0x3545fe(0xae),'warehouse_category':_0x3545fe(0xb1),'name':{'$ne':_0x3545fe(0x123)}}},{'$group':{'_id':'$name','name':{'$first':_0x3545fe(0xc2)}}}]);const _0x16cb68=await product[_0x3545fe(0xfa)]({}),_0x18b537=await adjustment_finished[_0x3545fe(0xfa)]({}),_0x3ea45a=_0x18b537['length']+0x1,_0x2cb020='ADJF-'+_0x3ea45a['toString']()['padStart'](0x5,'0');var _0x57bf60=['Ambient','Enclosed',_0x3545fe(0xa6)];if(_0x4e0b44[0x0][_0x3545fe(0x134)]==_0x3545fe(0x103))var _0x4f45f2=users[_0x3545fe(0x153)];else{if(_0x4e0b44[0x0][_0x3545fe(0x134)]==_0x3545fe(0xe6))var _0x4f45f2=users[_0x3545fe(0xe6)];else{if(_0x4e0b44[0x0]['language']=='German')var _0x4f45f2=users[_0x3545fe(0xd2)];else{if(_0x4e0b44[0x0][_0x3545fe(0x134)]==_0x3545fe(0x149))var _0x4f45f2=users['Spanish'];else{if(_0x4e0b44[0x0]['language']==_0x3545fe(0xa7))var _0x4f45f2=users['French'];else{if(_0x4e0b44[0x0]['language']=='Portuguese\x20(BR)')var _0x4f45f2=users['Portuguese'];else{if(_0x4e0b44[0x0][_0x3545fe(0x134)]==_0x3545fe(0x164))var _0x4f45f2=users[_0x3545fe(0x164)];else{if(_0x4e0b44[0x0][_0x3545fe(0x134)]==_0x3545fe(0x12f))var _0x4f45f2=users[_0x3545fe(0xe8)];}}}}}}}const _0x5d81ca=getRandom8DigitNumber();_0x5d81ca[_0x3545fe(0xc0)](_0x33ad53=>{var _0x57be08=_0x3545fe;_0xb29570[_0x57be08(0xba)](_0x57be08(0xfc),{'success':_0x52c512[_0x57be08(0x105)](_0x57be08(0xb0)),'errors':_0x52c512[_0x57be08(0x105)](_0x57be08(0x129)),'role':_0x3564b9,'profile':_0x49ca8d,'warehouse':_0x1337ec,'product':_0x16cb68,'master_shop':_0x4e0b44,'language':_0x4f45f2,'rooms_data':_0x57bf60,'invoice_no':_0x33ad53});})[_0x3545fe(0xb8)](_0x28454e=>{var _0x1053bc=_0x3545fe;_0x52c512[_0x1053bc(0x105)]('errors',_0x1053bc(0xab)),_0xb29570[_0x1053bc(0xf1)]('/adjustment/view');});}catch(_0x41e749){console[_0x3545fe(0x113)](_0x41e749);}}),router[a0_0x164751(0xd8)](a0_0x164751(0xdf),auth,async(_0x25ea73,_0x58c369)=>{var _0x14276c=a0_0x164751;try{const {warehouse_name:_0x225725,date:_0x3799bc,prod_name:_0x4da632,level:_0x5db8ba,isle:_0x14a56b,pallet:_0xa3efbb,stock:_0x452da9,types:_0x9e2b52,adjust_qty:_0x4bbf1a,new_adjust_qty:_0x59e772,note:_0x213bcd,Room_name:_0x7ada7d,invoice:_0x45815f,JO_number:_0x5d683a,expiry_date:_0x464d32}=_0x25ea73[_0x14276c(0x91)];if(typeof _0x4da632=='string')var _0x13c18e=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0xce)]],_0x52bb4f=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x138)]],_0x15e65a=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x109)]],_0x39f97c=[_0x25ea73['body'][_0x14276c(0x13b)]],_0x5c911f=[_0x25ea73[_0x14276c(0x91)]['New_Qty_Converted_adj']],_0x30c34a=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x9c)]],_0x18f4e6=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x163)]],_0x75495a=[_0x25ea73[_0x14276c(0x91)]['Secondary_units']],_0x28706c=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x125)]],_0x2ad4da=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0xeb)]],_0x3f1c44=[_0x25ea73[_0x14276c(0x91)]['expiry_date']],_0x3bd179=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x148)]],_0x44c2e7=[_0x25ea73[_0x14276c(0x91)]['prod_cat']],_0x373ce8=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x165)]],_0x4a785b=[_0x25ea73['body']['maxPerUnit']],_0x3cb01e=[_0x25ea73[_0x14276c(0x91)][_0x14276c(0x122)]];else var _0x13c18e=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0xce)]],_0x52bb4f=[..._0x25ea73[_0x14276c(0x91)]['level']],_0x15e65a=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x109)]],_0x39f97c=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x13b)]],_0x5c911f=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x143)]],_0x30c34a=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x9c)]],_0x18f4e6=[..._0x25ea73[_0x14276c(0x91)]['Primary_Units']],_0x75495a=[..._0x25ea73['body']['Secondary_units']],_0x28706c=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x125)]],_0x2ad4da=[..._0x25ea73[_0x14276c(0x91)]['batch_code']],_0x3f1c44=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0xa2)]],_0x3bd179=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x148)]],_0x44c2e7=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0xdb)]],_0x373ce8=[..._0x25ea73[_0x14276c(0x91)]['Rooms']],_0x4a785b=[..._0x25ea73['body']['maxPerUnit']],_0x3cb01e=[..._0x25ea73[_0x14276c(0x91)][_0x14276c(0x122)]];const _0xa7a02f=_0x13c18e[_0x14276c(0xa1)](_0x3e8d53=>{return _0x3e8d53={'product_name':_0x3e8d53};});_0x52bb4f[_0x14276c(0x14c)]((_0x4c5494,_0x10e526)=>{var _0x1a375b=_0x14276c;_0xa7a02f[_0x10e526][_0x1a375b(0x120)]=_0x4c5494;}),_0x15e65a[_0x14276c(0x14c)]((_0x101710,_0x53fa06)=>{var _0x5f1924=_0x14276c;_0xa7a02f[_0x53fa06][_0x5f1924(0x142)]=_0x101710;}),_0x39f97c['forEach']((_0x5aed16,_0x2d9049)=>{_0xa7a02f[_0x2d9049]['types']=_0x5aed16;}),_0x5c911f[_0x14276c(0x14c)]((_0x620f9c,_0x54af42)=>{_0xa7a02f[_0x54af42]['adjust_qty']=_0x620f9c;}),_0x30c34a[_0x14276c(0x14c)]((_0x139055,_0x2f0bbd)=>{var _0x4f60d9=_0x14276c;_0xa7a02f[_0x2f0bbd][_0x4f60d9(0x13f)]=_0x139055;}),_0x18f4e6[_0x14276c(0x14c)]((_0x492c4d,_0x5f119c)=>{_0xa7a02f[_0x5f119c]['unit']=_0x492c4d;}),_0x75495a[_0x14276c(0x14c)]((_0x3cdad5,_0x187f97)=>{_0xa7a02f[_0x187f97]['secondary_unit']=_0x3cdad5;}),_0x28706c['forEach']((_0x28777d,_0xa4ca1d)=>{_0xa7a02f[_0xa4ca1d]['product_code']=_0x28777d;}),_0x2ad4da['forEach']((_0x3d8ce1,_0x14034c)=>{_0xa7a02f[_0x14034c]['batch_code']=_0x3d8ce1;}),_0x3f1c44[_0x14276c(0x14c)]((_0x1fdd4f,_0x2edd0e)=>{var _0x1ef808=_0x14276c;_0xa7a02f[_0x2edd0e][_0x1ef808(0xa2)]=_0x1fdd4f;}),_0x3bd179[_0x14276c(0x14c)]((_0x3d6b69,_0x18303f)=>{var _0x4e2066=_0x14276c;_0xa7a02f[_0x18303f][_0x4e2066(0xe7)]=_0x3d6b69;}),_0x44c2e7[_0x14276c(0x14c)]((_0x134bc7,_0x178095)=>{var _0x56a171=_0x14276c;_0xa7a02f[_0x178095][_0x56a171(0xdb)]=_0x134bc7;}),_0x373ce8['forEach']((_0x4730d6,_0x5d09cf)=>{var _0x457bf5=_0x14276c;_0xa7a02f[_0x5d09cf][_0x457bf5(0x13d)]=_0x4730d6;}),_0x4a785b[_0x14276c(0x14c)]((_0x484724,_0xa8a221)=>{var _0x366e40=_0x14276c;_0xa7a02f[_0xa8a221][_0x366e40(0xb2)]=_0x484724;}),_0x3cb01e[_0x14276c(0x14c)]((_0x18cc4c,_0x227034)=>{var _0x1c146d=_0x14276c;_0xa7a02f[_0x227034][_0x1c146d(0xfd)]=_0x18cc4c;});const _0x991ed=_0xa7a02f['filter'](_0x58d1e8=>_0x58d1e8['adjust_qty']!=='0'&&_0x58d1e8[_0x14276c(0xef)]!=='');var _0x24163d=0x0;_0x991ed['forEach'](_0x511b93=>{var _0x306b25=_0x14276c;console[_0x306b25(0x113)]('foreach\x20newproduct',_0x511b93),parseInt(_0x511b93[_0x306b25(0xef)])<=0x0&&_0x24163d++;});if(_0x24163d!=0x0)return _0x25ea73[_0x14276c(0x105)](_0x14276c(0x129),_0x14276c(0xf3)),_0x58c369['redirect'](_0x14276c(0x160));const _0x2848e3=new adjustment_finished({'warehouse_name':_0x225725,'date':_0x3799bc,'product':_0x991ed,'note':_0x213bcd,'room':_0x7ada7d,'invoice':_0x45815f,'JO_number':_0x5d683a,'expiry_date':_0x464d32}),_0x5c6294=await _0x2848e3[_0x14276c(0x11b)]();_0x25ea73[_0x14276c(0x105)](_0x14276c(0xb0),_0x14276c(0xff)),_0x58c369[_0x14276c(0xf1)](_0x14276c(0xb7)+_0x5c6294[_0x14276c(0xea)]);}catch(_0x1ab2f3){console[_0x14276c(0x113)](_0x1ab2f3),_0x58c369[_0x14276c(0x9f)](0xc8)[_0x14276c(0xac)]({'message':_0x1ab2f3['message']});}}),router[a0_0x164751(0x145)](a0_0x164751(0xe2),auth,async(_0x2c834f,_0x1640de)=>{var _0x1f5788=a0_0x164751;try{const {username:_0x35e8fb,email:_0x31e046,role:_0x512069}=_0x2c834f[_0x1f5788(0xc7)],_0x3efe5b=_0x2c834f[_0x1f5788(0xc7)],_0x5dd3a4=await profile[_0x1f5788(0x95)]({'email':_0x3efe5b[_0x1f5788(0x144)]}),_0x39eb26=await master_shop['find'](),_0x2b6e05=_0x2c834f[_0x1f5788(0x13c)]['id'],_0x1d431a=await adjustment_finished['findById']({'_id':_0x2b6e05}),_0x27b66=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1d431a[_0x1f5788(0xaf)]}},{'$unwind':_0x1f5788(0x157)},{'$group':{'_id':_0x1f5788(0x97)}}]);console[_0x1f5788(0x113)](_0x1f5788(0x131),_0x27b66);const _0x12c1c7=await product[_0x1f5788(0xfa)]({}),_0x49c0a1=await warehouse['aggregate']([{'$match':{'name':_0x1d431a[_0x1f5788(0xaf)],'warehouse_category':_0x1f5788(0xb1)}},{'$unwind':_0x1f5788(0xd6)},{'$group':{'_id':_0x1f5788(0x116),'name':{'$first':_0x1f5788(0xfb)},'product_stock':{'$first':_0x1f5788(0xb4)},'bay':{'$first':_0x1f5788(0xcf)},'bin':{'$first':_0x1f5788(0xa0)},'type':{'$first':_0x1f5788(0x132)},'floorlevel':{'$first':_0x1f5788(0x114)},'primary_code':{'$first':_0x1f5788(0xf0)},'secondary_code':{'$first':_0x1f5788(0x117)},'product_code':{'$first':_0x1f5788(0x111)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1f5788(0x15c)},'production_date':{'$first':_0x1f5788(0x96)},'batch_code':{'$first':_0x1f5788(0xe5)},'maxPerUnit':{'$first':_0x1f5788(0x115)},'room':{'$first':_0x1f5788(0x121)}}}]);if(_0x39eb26[0x0][_0x1f5788(0x134)]=='English\x20(US)'){var _0x31ab98=users[_0x1f5788(0x153)];console[_0x1f5788(0x113)](_0x31ab98);}else{if(_0x39eb26[0x0]['language']=='Hindi')var _0x31ab98=users['Hindi'];else{if(_0x39eb26[0x0]['language']==_0x1f5788(0xd2))var _0x31ab98=users[_0x1f5788(0xd2)];else{if(_0x39eb26[0x0][_0x1f5788(0x134)]==_0x1f5788(0x149))var _0x31ab98=users[_0x1f5788(0x149)];else{if(_0x39eb26[0x0][_0x1f5788(0x134)]=='French')var _0x31ab98=users[_0x1f5788(0xa7)];else{if(_0x39eb26[0x0][_0x1f5788(0x134)]==_0x1f5788(0xda))var _0x31ab98=users[_0x1f5788(0x15f)];else{if(_0x39eb26[0x0][_0x1f5788(0x134)]==_0x1f5788(0x164))var _0x31ab98=users[_0x1f5788(0x164)];else{if(_0x39eb26[0x0]['language']=='Arabic\x20(ae)')var _0x31ab98=users[_0x1f5788(0xe8)];}}}}}}}_0x1640de['render'](_0x1f5788(0x12d),{'success':_0x2c834f['flash'](_0x1f5788(0xb0)),'errors':_0x2c834f[_0x1f5788(0x105)](_0x1f5788(0x129)),'role':_0x3efe5b,'profile':_0x5dd3a4,'adjustment':_0x1d431a,'stock':_0x49c0a1,'master_shop':_0x39eb26,'warehouse_name':_0x27b66,'unit':_0x12c1c7,'language':_0x31ab98});}catch(_0x573c95){console[_0x1f5788(0x113)](_0x573c95),_0x1640de[_0x1f5788(0x9f)](0xc8)[_0x1f5788(0xac)]({'message':_0x573c95[_0x1f5788(0xee)]});}}),router['post'](a0_0x164751(0xe2),auth,async(_0x43e553,_0x4d5b8f)=>{var _0x495f9d=a0_0x164751;try{const {invoice:_0x13121f,warehouse_name:_0x539774,Room_name:_0x971dca}=_0x43e553[_0x495f9d(0x91)],_0x58fb4b=_0x43e553[_0x495f9d(0x13c)]['id'],_0x28afed=await adjustment_finished[_0x495f9d(0x94)]({'_id':_0x58fb4b});var _0x2f6a97;const _0x116d69=_0x28afed[_0x495f9d(0x12c)][_0x495f9d(0xa1)](async _0x2ec438=>{var _0x138ce2=_0x495f9d;if(_0x2ec438[_0x138ce2(0xef)]>0x0){_0x2f6a97=await warehouse[_0x138ce2(0x95)]({'name':_0x539774,'room':_0x2ec438[_0x138ce2(0x13d)],'warehouse_category':_0x138ce2(0xb1)});const _0x24de56=_0x2f6a97[_0x138ce2(0x10d)][_0x138ce2(0xa1)](_0x27aa1b=>{var _0x398be4=_0x138ce2;console[_0x398be4(0x113)](_0x2ec438['types']);if(_0x2ec438[_0x398be4(0x13b)]==_0x398be4(0x9d))_0x27aa1b[_0x398be4(0x99)]==_0x2ec438[_0x398be4(0x99)]&&_0x27aa1b['bay']==_0x2ec438[_0x398be4(0x120)]&&_0x27aa1b[_0x398be4(0xa2)]==_0x2ec438['expiry_date']&&_0x27aa1b[_0x398be4(0xe7)]==_0x2ec438[_0x398be4(0xe7)]&&_0x27aa1b[_0x398be4(0xeb)]==_0x2ec438[_0x398be4(0xeb)]&&_0x27aa1b[_0x398be4(0xfd)]==_0x2ec438[_0x398be4(0xfd)]&&(_0x27aa1b[_0x398be4(0x15a)]=_0x27aa1b[_0x398be4(0x15a)]-_0x2ec438['adjust_qty']);else _0x2ec438[_0x398be4(0x13b)]==_0x398be4(0x10f)&&(_0x27aa1b[_0x398be4(0x99)]==_0x2ec438[_0x398be4(0x99)]&&_0x27aa1b[_0x398be4(0x120)]==_0x2ec438['bay']&&_0x27aa1b[_0x398be4(0xa2)]==_0x2ec438[_0x398be4(0xa2)]&&_0x27aa1b['production_date']==_0x2ec438[_0x398be4(0xe7)]&&_0x27aa1b['batch_code']==_0x2ec438[_0x398be4(0xeb)]&&_0x27aa1b[_0x398be4(0xfd)]==_0x2ec438[_0x398be4(0xfd)]&&(_0x27aa1b[_0x398be4(0x15a)]=_0x27aa1b['product_stock']+_0x2ec438[_0x398be4(0xef)]));});}return _0x2f6a97;});Promise[_0x495f9d(0xb6)](_0x116d69)[_0x495f9d(0xc0)](async _0x194c73=>{var _0x2212b2=_0x495f9d;try{for(const _0x14bf16 of _0x194c73){await _0x14bf16['save']();}_0x28afed[_0x2212b2(0xa4)]=_0x2212b2(0x11f);const _0x25f8e8=await _0x28afed[_0x2212b2(0x11b)](),_0x587ebe=await master_shop[_0x2212b2(0xfa)](),_0x1947bb=await email_settings[_0x2212b2(0x95)](),_0x2d731b=await supervisor_settings[_0x2212b2(0xfa)]();var _0x5ab0bb=_0x28afed[_0x2212b2(0x12c)],_0x46bab5='',_0x5c149a;for(_0x5c149a in _0x5ab0bb){var _0x215842='FG';_0x28afed[_0x2212b2(0xaf)]==_0x2212b2(0xd4)&&(_0x215842='DG'),_0x46bab5+=_0x2212b2(0xc1)+_0x2212b2(0x146)+_0x5ab0bb[_0x5c149a][_0x2212b2(0x99)]+_0x2212b2(0x159)+_0x2212b2(0x146)+_0x5ab0bb[_0x5c149a][_0x2212b2(0xbc)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5ab0bb[_0x5c149a][_0x2212b2(0xef)]+_0x2212b2(0x159)+_0x2212b2(0x146)+_0x5ab0bb[_0x5c149a][_0x2212b2(0xdc)]+_0x2212b2(0x159)+_0x2212b2(0x146)+_0x5ab0bb[_0x5c149a][_0x2212b2(0x162)]+_0x2212b2(0x159)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x28afed[_0x2212b2(0xaf)]+'</td>'+_0x2212b2(0x146)+_0x5ab0bb[_0x5c149a][_0x2212b2(0x13d)]+_0x2212b2(0x159)+_0x2212b2(0x146)+_0x215842+_0x5ab0bb[_0x5c149a][_0x2212b2(0x120)]+_0x2212b2(0x159)+'</tr>';}let _0x5d3157=nodemailer[_0x2212b2(0x9a)]({'host':_0x1947bb[_0x2212b2(0x14a)],'port':Number(_0x1947bb[_0x2212b2(0xb9)]),'secure':![],'auth':{'user':_0x1947bb[_0x2212b2(0x144)],'pass':_0x1947bb['password']}}),_0xd740ba={'from':_0x1947bb[_0x2212b2(0x144)],'to':_0x2d731b[0x0]['FGSEmail'],'subject':_0x2212b2(0x156),'attachments':[{'filename':_0x2212b2(0x110),'path':__dirname+'/../public'+_0x2212b2(0x107)+_0x587ebe[0x0][_0x2212b2(0xa5)],'cid':_0x2212b2(0xdd)}],'html':_0x2212b2(0x161)+_0x2212b2(0x101)+_0x2212b2(0xad)+_0x2212b2(0x128)+_0x2212b2(0x119)+_0x2212b2(0x128)+_0x2212b2(0xd9)+_0x2212b2(0x139)+_0x2212b2(0x128)+'<h2>\x20'+_0x587ebe[0x0][_0x2212b2(0xed)]+_0x2212b2(0x135)+'</div>'+_0x2212b2(0x139)+_0x2212b2(0x14d)+_0x2212b2(0x128)+_0x2212b2(0x140)+_0x2212b2(0xf9)+_0x28afed[_0x2212b2(0xfd)]+'\x20'+_0x2212b2(0x14b)+_0x2212b2(0x15b)+_0x28afed[_0x2212b2(0x93)]+'\x20'+_0x2212b2(0xc8)+_0x2212b2(0xf6)+_0x2212b2(0x139)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x2212b2(0xc1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x2212b2(0xde)+_0x2212b2(0x155)+_0x2212b2(0x118)+_0x2212b2(0x154)+_0x2212b2(0x10e)+_0x2212b2(0xf4)+_0x2212b2(0x108)+_0x2212b2(0xe3)+_0x2212b2(0x13a)+_0x2212b2(0x15d)+'\x20'+_0x46bab5+'\x20'+'</tbody>'+_0x2212b2(0xa3)+_0x2212b2(0x128)+_0x2212b2(0xd5)+_0x2212b2(0xf2)+_0x587ebe[0x0][_0x2212b2(0xed)]+_0x2212b2(0xf6)+'</div>'+_0x2212b2(0x139)+_0x2212b2(0x137)};_0x5d3157[_0x2212b2(0x130)](_0xd740ba,function(_0x549f78,_0x244be8){var _0x38cd04=_0x2212b2;_0x549f78?(console[_0x38cd04(0x113)](_0x549f78),console[_0x38cd04(0x113)](_0x38cd04(0xcc))):console[_0x38cd04(0x113)](_0x38cd04(0x11a));}),_0x43e553['flash'](_0x2212b2(0xb0),_0x2212b2(0xe1)),_0x4d5b8f[_0x2212b2(0xf1)](_0x2212b2(0x147)+_0x25f8e8[_0x2212b2(0xea)]);}catch(_0x43ee89){console[_0x2212b2(0xe9)](_0x43ee89),_0x4d5b8f[_0x2212b2(0x9f)](0x1f4)[_0x2212b2(0xac)]({'error':_0x2212b2(0x127)});}})['catch'](_0x4e74fc=>{var _0x108075=_0x495f9d;console[_0x108075(0xe9)](_0x4e74fc),_0x4d5b8f['status'](0x1f4)[_0x108075(0xac)]({'error':_0x108075(0x9e)});});}catch(_0x350a36){_0x4d5b8f[_0x495f9d(0xac)]({'message':_0x350a36[_0x495f9d(0xee)]});}}),router[a0_0x164751(0x145)](a0_0x164751(0xa8),auth,async(_0x11d555,_0xd86896)=>{var _0x1ddb4f=a0_0x164751;try{const {username:_0xf7f61,email:_0xf93135,role:_0x4a9e20}=_0x11d555['user'],_0xe39cc0=_0x11d555[_0x1ddb4f(0xc7)],_0x4ad4f0=await profile[_0x1ddb4f(0x95)]({'email':_0xe39cc0[_0x1ddb4f(0x144)]}),_0x3fc977=await master_shop[_0x1ddb4f(0xfa)]();console[_0x1ddb4f(0x113)](_0x1ddb4f(0x11c),_0x3fc977);const _0x3899a4=_0x11d555[_0x1ddb4f(0x13c)]['id'],_0xe4af86=await adjustment_finished['findById']({'_id':_0x3899a4});let _0x2ed18c=new Date(_0xe4af86[_0x1ddb4f(0xa2)]),_0x280b4d=('0'+_0x2ed18c[_0x1ddb4f(0x9b)]())[_0x1ddb4f(0xcd)](-0x2),_0x4d96a6=('0'+(_0x2ed18c[_0x1ddb4f(0x12e)]()+0x1))[_0x1ddb4f(0xcd)](-0x2),_0x441176=_0x2ed18c[_0x1ddb4f(0x11d)](),_0x5bf240=_0x441176+'-'+_0x4d96a6+'-'+_0x280b4d;var _0x2ffb47=[_0x1ddb4f(0xc3),_0x1ddb4f(0xc9),_0x1ddb4f(0xa6)];const _0x3fa4a7=await purchases[_0x1ddb4f(0x136)]([{'$match':{'warehouse_name':_0xe4af86[_0x1ddb4f(0xaf)]}},{'$unwind':_0x1ddb4f(0x157)},{'$group':{'_id':_0x1ddb4f(0x97)}}]);console[_0x1ddb4f(0x113)](_0x1ddb4f(0x131),_0x3fa4a7);const _0x3c11a3=await product['find']({}),_0x442733=await warehouse[_0x1ddb4f(0x136)]([{'$match':{'name':_0xe4af86[_0x1ddb4f(0xaf)],'room':_0xe4af86[_0x1ddb4f(0x10b)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1ddb4f(0x116),'name':{'$first':_0x1ddb4f(0xfb)},'product_stock':{'$first':_0x1ddb4f(0xb4)},'bay':{'$first':_0x1ddb4f(0xcf)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1ddb4f(0x132)},'floorlevel':{'$first':_0x1ddb4f(0x114)},'primary_code':{'$first':_0x1ddb4f(0xf0)},'secondary_code':{'$first':_0x1ddb4f(0x117)},'product_code':{'$first':_0x1ddb4f(0x111)},'storage':{'$first':_0x1ddb4f(0x124)},'rack':{'$first':_0x1ddb4f(0xaa)}}}]);if(_0x3fc977[0x0]['language']==_0x1ddb4f(0x103)){var _0x48e0f5=users['English'];console[_0x1ddb4f(0x113)](_0x48e0f5);}else{if(_0x3fc977[0x0][_0x1ddb4f(0x134)]==_0x1ddb4f(0xe6))var _0x48e0f5=users[_0x1ddb4f(0xe6)];else{if(_0x3fc977[0x0][_0x1ddb4f(0x134)]==_0x1ddb4f(0xd2))var _0x48e0f5=users[_0x1ddb4f(0xd2)];else{if(_0x3fc977[0x0]['language']==_0x1ddb4f(0x149))var _0x48e0f5=users[_0x1ddb4f(0x149)];else{if(_0x3fc977[0x0]['language']=='French')var _0x48e0f5=users[_0x1ddb4f(0xa7)];else{if(_0x3fc977[0x0][_0x1ddb4f(0x134)]==_0x1ddb4f(0xda))var _0x48e0f5=users[_0x1ddb4f(0x15f)];else{if(_0x3fc977[0x0][_0x1ddb4f(0x134)]==_0x1ddb4f(0x164))var _0x48e0f5=users[_0x1ddb4f(0x164)];else{if(_0x3fc977[0x0][_0x1ddb4f(0x134)]==_0x1ddb4f(0x12f))var _0x48e0f5=users[_0x1ddb4f(0xe8)];}}}}}}}_0xd86896['render'](_0x1ddb4f(0x152),{'success':_0x11d555[_0x1ddb4f(0x105)](_0x1ddb4f(0xb0)),'errors':_0x11d555[_0x1ddb4f(0x105)](_0x1ddb4f(0x129)),'role':_0xe39cc0,'profile':_0x4ad4f0,'adjustment':_0xe4af86,'stock':_0x442733,'master_shop':_0x3fc977,'warehouse_name':_0x3fa4a7,'unit':_0x3c11a3,'language':_0x48e0f5,'rooms_data':_0x2ffb47,'ed_fullDate':_0x5bf240});}catch(_0x425f2a){console['log'](_0x425f2a),_0xd86896[_0x1ddb4f(0x9f)](0xc8)[_0x1ddb4f(0xac)]({'message':_0x425f2a[_0x1ddb4f(0xee)]});}}),router[a0_0x164751(0xd8)](a0_0x164751(0xa8),auth,async(_0x2a8e02,_0x4d2ac5)=>{var _0x581065=a0_0x164751;try{const _0xa2c680=_0x2a8e02[_0x581065(0x13c)]['id'],_0x81f3bd=await adjustment_finished['findById']({'_id':_0xa2c680}),_0x137d70=await warehouse[_0x581065(0x95)]({'name':_0x81f3bd[_0x581065(0xaf)],'room':_0x81f3bd['room']}),{warehouse_name:_0x741f,date:_0xe89400,prod_name:_0x1a656b,level:_0x9058e0,isle:_0x5d7a07,pallet:_0x5e5cf7,stock:_0x4db35c,types:_0x255743,adjust_qty:_0x528a19,new_adjust_qty:_0x1b4841,note:_0x2bba53,Room_name:_0xd27abb,invoice:_0x5c28bd,JO_number:_0x2000c2}=_0x2a8e02['body'];if(typeof _0x1a656b==_0x581065(0xf8))var _0x4e1ad4=[_0x2a8e02[_0x581065(0x91)][_0x581065(0xce)]],_0x37b002=[_0x2a8e02[_0x581065(0x91)][_0x581065(0x138)]],_0x57fecd=[_0x2a8e02[_0x581065(0x91)][_0x581065(0x109)]],_0xc61a28=[_0x2a8e02[_0x581065(0x91)][_0x581065(0x13b)]],_0x4184ac=[_0x2a8e02[_0x581065(0x91)][_0x581065(0xef)]],_0x1af172=[_0x2a8e02[_0x581065(0x91)]['new_adjust_qty']],_0x1e6314=[_0x2a8e02[_0x581065(0x91)]['prod_code']],_0x34bc8a=[_0x2a8e02['body']['unit']],_0x40491a=[_0x2a8e02[_0x581065(0x91)][_0x581065(0x15e)]],_0x15495f=[_0x2a8e02[_0x581065(0x91)]['batch_code']],_0x3a2024=[_0x2a8e02['body'][_0x581065(0xa2)]];else var _0x4e1ad4=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0xce)]],_0x37b002=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0x138)]],_0x57fecd=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0x109)]],_0xc61a28=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0x13b)]],_0x4184ac=[..._0x2a8e02['body'][_0x581065(0xef)]],_0x1af172=[..._0x2a8e02['body'][_0x581065(0x13f)]],_0x1e6314=[..._0x2a8e02['body'][_0x581065(0x125)]],_0x34bc8a=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0xdc)]],_0x40491a=[..._0x2a8e02['body'][_0x581065(0x15e)]],_0x15495f=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0xeb)]],_0x3a2024=[..._0x2a8e02[_0x581065(0x91)][_0x581065(0xa2)]];const _0x302254=_0x4e1ad4[_0x581065(0xa1)](_0x5bd0bc=>{return _0x5bd0bc={'product_name':_0x5bd0bc};});_0x37b002[_0x581065(0x14c)]((_0x3ca793,_0x4adb08)=>{_0x302254[_0x4adb08]['bay']=_0x3ca793;}),_0x57fecd[_0x581065(0x14c)]((_0x9527fc,_0x3c51e2)=>{var _0x4c1c72=_0x581065;_0x302254[_0x3c51e2][_0x4c1c72(0x142)]=_0x9527fc;}),_0xc61a28[_0x581065(0x14c)]((_0x4fada5,_0x4a2897)=>{var _0x4818d5=_0x581065;_0x302254[_0x4a2897][_0x4818d5(0x13b)]=_0x4fada5;}),_0x4184ac[_0x581065(0x14c)]((_0x2bd70a,_0x2d028f)=>{_0x302254[_0x2d028f]['adjust_qty']=_0x2bd70a;}),_0x1af172[_0x581065(0x14c)]((_0x32fd19,_0x275807)=>{var _0x38e2ef=_0x581065;_0x302254[_0x275807][_0x38e2ef(0x13f)]=_0x32fd19;}),_0x34bc8a[_0x581065(0x14c)]((_0x538e59,_0x4cd5c1)=>{var _0x3897a7=_0x581065;_0x302254[_0x4cd5c1][_0x3897a7(0xdc)]=_0x538e59;}),_0x40491a['forEach']((_0x4d3e8f,_0xdfdc5f)=>{var _0x1da6a5=_0x581065;_0x302254[_0xdfdc5f][_0x1da6a5(0x162)]=_0x4d3e8f;}),_0x1e6314[_0x581065(0x14c)]((_0x57d8ae,_0x1ee5e1)=>{var _0x2e08a4=_0x581065;_0x302254[_0x1ee5e1][_0x2e08a4(0xbc)]=_0x57d8ae;}),_0x15495f[_0x581065(0x14c)]((_0x5861f0,_0x4a48f9)=>{var _0x4350e8=_0x581065;_0x302254[_0x4a48f9][_0x4350e8(0xeb)]=_0x5861f0;}),_0x3a2024[_0x581065(0x14c)]((_0x5b76e9,_0x48bb32)=>{_0x302254[_0x48bb32]['expiry_date']=_0x5b76e9;});const _0x3a5ea8=_0x302254[_0x581065(0x100)](_0x6b3aee=>_0x6b3aee[_0x581065(0xef)]!=='0'&&_0x6b3aee[_0x581065(0xef)]!=='');var _0x4be48d=0x0;_0x3a5ea8[_0x581065(0x14c)](_0x2e156e=>{var _0x2346ca=_0x581065;console['log'](_0x2346ca(0x12b),_0x2e156e),parseInt(_0x2e156e[_0x2346ca(0xef)])<=0x0&&_0x4be48d++;});if(_0x4be48d!=0x0)return _0x2a8e02[_0x581065(0x105)](_0x581065(0x129),_0x581065(0xf3)),_0x4d2ac5[_0x581065(0xf1)](_0x581065(0x160));_0x81f3bd[_0x581065(0xaf)]=_0x741f,_0x81f3bd[_0x581065(0x93)]=_0xe89400,_0x81f3bd[_0x581065(0x12c)]=_0x3a5ea8,_0x81f3bd[_0x581065(0x98)]=_0x2bba53,_0x81f3bd[_0x581065(0x10b)]=_0xd27abb,_0x81f3bd[_0x581065(0xfd)]=_0x5c28bd,_0x81f3bd['JO_number']=_0x2000c2;const _0xdeeebe=await _0x81f3bd[_0x581065(0x11b)](),_0x1e7a6f=await warehouse[_0x581065(0x95)]({'name':_0x741f,'room':_0xd27abb});_0xdeeebe['product'][_0x581065(0x14c)](_0x58e4a7=>{var _0x1d1dad=_0x581065;const _0x1dacca=_0x1e7a6f[_0x1d1dad(0x10d)][_0x1d1dad(0xa1)](_0x2b9c35=>{var _0x3c42f6=_0x1d1dad;_0x58e4a7[_0x3c42f6(0x13b)]==_0x3c42f6(0x9d)?_0x2b9c35[_0x3c42f6(0x99)]==_0x58e4a7[_0x3c42f6(0x99)]&&_0x2b9c35[_0x3c42f6(0x120)]==_0x58e4a7[_0x3c42f6(0x120)]&&(_0x2b9c35['product_stock']=parseInt(_0x2b9c35[_0x3c42f6(0x15a)])-parseInt(_0x58e4a7[_0x3c42f6(0xef)])):_0x2b9c35[_0x3c42f6(0x99)]==_0x58e4a7[_0x3c42f6(0x99)]&&_0x2b9c35[_0x3c42f6(0x120)]==_0x58e4a7[_0x3c42f6(0x120)]&&(_0x2b9c35['product_stock']=parseInt(_0x2b9c35[_0x3c42f6(0x15a)])+parseInt(_0x58e4a7[_0x3c42f6(0xef)]));});}),await _0x1e7a6f[_0x581065(0x11b)](),_0x2a8e02[_0x581065(0x105)]('success',_0x581065(0xe4)),_0x4d2ac5[_0x581065(0xf1)](_0x581065(0xbf));}catch(_0xc4e8d5){console['log'](_0xc4e8d5);}}),router[a0_0x164751(0xd8)]('/barcode_scanner',async(_0x297bc9,_0x5142b2)=>{var _0x4040a3=a0_0x164751;const {primary_code:_0x49b64b,warehouse_data:_0x510733,rooms_data:_0x1a15f6,Roomslist:_0x42ad21}=_0x297bc9[_0x4040a3(0x91)],_0x13630d=_0x42ad21[_0x4040a3(0x126)](','),_0x49ca5f=[];async function _0x39312f(_0x3f391f){var _0x53e4f6=_0x4040a3;const _0xedcb46=await warehouse[_0x53e4f6(0x136)]([{'$match':{'name':_0x510733,'room':_0x3f391f}},{'$unwind':_0x53e4f6(0xd6)},{'$match':{'product_details.primary_code':_0x49b64b}},{'$group':{'_id':_0x53e4f6(0x116),'name':{'$first':_0x53e4f6(0xfb)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x53e4f6(0xf0)},'secondary_code':{'$first':_0x53e4f6(0x117)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x53e4f6(0xa0)},'type':{'$first':_0x53e4f6(0x132)},'pallet':{'$first':_0x53e4f6(0x114)},'unit':{'$first':_0x53e4f6(0xe0)},'secondary_unit':{'$first':_0x53e4f6(0x158)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x53e4f6(0xaa)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x53e4f6(0x96)},'batch_code':{'$first':_0x53e4f6(0xe5)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x53e4f6(0x115)},'roomNamed':{'$first':_0x53e4f6(0x121)},'invoice':{'$first':_0x53e4f6(0xa9)}}}]),_0x4ed5f2=await warehouse[_0x53e4f6(0x136)]([{'$match':{'name':_0x510733,'room':_0x3f391f}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x49b64b}},{'$group':{'_id':_0x53e4f6(0x116),'name':{'$first':_0x53e4f6(0xfb)},'product_stock':{'$first':_0x53e4f6(0xb4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x53e4f6(0x117)},'product_code':{'$first':_0x53e4f6(0x111)},'level':{'$first':_0x53e4f6(0xcf)},'isle':{'$first':_0x53e4f6(0xa0)},'type':{'$first':_0x53e4f6(0x132)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x53e4f6(0xe0)},'secondary_unit':{'$first':_0x53e4f6(0x158)},'storage':{'$first':_0x53e4f6(0x124)},'rack':{'$first':_0x53e4f6(0xaa)},'expiry_date':{'$first':_0x53e4f6(0x15c)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x53e4f6(0xe5)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x53e4f6(0x121)},'invoice':{'$first':_0x53e4f6(0xa9)}}}]);if(_0xedcb46[_0x53e4f6(0x102)]>0x0)_0x49ca5f[_0x53e4f6(0x14f)](_0xedcb46);else _0x4ed5f2[_0x53e4f6(0x102)]>0x0&&_0x49ca5f['push'](_0x4ed5f2);}const _0x1bc39a=_0x13630d['map'](_0x54fcda=>_0x39312f(_0x54fcda));await Promise['all'](_0x1bc39a),_0x5142b2[_0x4040a3(0xac)](_0x49ca5f);}),router[a0_0x164751(0xd8)]('/CheckingWarehouse',async(_0x46d8cc,_0x4aa2ab)=>{var _0xdc0b14=a0_0x164751;const {productCode:_0x4ec97e,bay:_0x3d5f4e,warehouses:_0x579acc,room:_0x46caaa}=_0x46d8cc['body'];console['log'](_0x46d8cc['body']);try{const _0x190ad4=await warehouse[_0xdc0b14(0x136)]([{'$match':{'name':_0x579acc,'room':_0x46caaa}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x3d5f4e)}},{'$group':{'_id':_0xdc0b14(0x116),'name':{'$first':_0xdc0b14(0xfb)},'product_stock':{'$first':_0xdc0b14(0xb4)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0xdc0b14(0x150)}}}]);_0x4aa2ab[_0xdc0b14(0x9f)](0xc8)[_0xdc0b14(0xac)](_0x190ad4);}catch(_0x25a27e){_0x4aa2ab[_0xdc0b14(0x9f)](0x194)[_0xdc0b14(0xac)]({'message':_0x25a27e['message']});}}),module[a0_0x164751(0xf7)]=router;