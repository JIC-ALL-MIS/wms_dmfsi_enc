var a0_0x5d2d2c=a0_0x37f7;(function(_0x1f428c,_0x29b0cd){var _0x38b4a7=a0_0x37f7,_0x28a343=_0x1f428c();while(!![]){try{var _0x25e91e=-parseInt(_0x38b4a7(0x26b))/0x1*(parseInt(_0x38b4a7(0x23a))/0x2)+parseInt(_0x38b4a7(0x25e))/0x3+parseInt(_0x38b4a7(0x2ad))/0x4+parseInt(_0x38b4a7(0x21f))/0x5+-parseInt(_0x38b4a7(0x23d))/0x6*(parseInt(_0x38b4a7(0x28a))/0x7)+-parseInt(_0x38b4a7(0x21e))/0x8+parseInt(_0x38b4a7(0x244))/0x9;if(_0x25e91e===_0x29b0cd)break;else _0x28a343['push'](_0x28a343['shift']());}catch(_0xce85a8){_0x28a343['push'](_0x28a343['shift']());}}}(a0_0x1694,0xbe4c8));const express=require(a0_0x5d2d2c(0x203)),app=express(),router=express['Router'](),auth=require(a0_0x5d2d2c(0x229)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x5d2d2c(0x27d));function a0_0x37f7(_0x2a68d4,_0x2a7669){var _0x1694bf=a0_0x1694();return a0_0x37f7=function(_0x37f73e,_0x18227e){_0x37f73e=_0x37f73e-0x1f4;var _0x123574=_0x1694bf[_0x37f73e];return _0x123574;},a0_0x37f7(_0x2a68d4,_0x2a7669);}router[a0_0x5d2d2c(0x290)](a0_0x5d2d2c(0x210),auth,async(_0x109023,_0x33ada7)=>{var _0x5587b7=a0_0x5d2d2c;try{const {username:_0x4dbb34,email:_0x5bd7d9,role:_0x1af16d}=_0x109023['user'],_0x402af=_0x109023[_0x5587b7(0x239)],_0x353097=await profile[_0x5587b7(0x24a)]({'email':_0x402af[_0x5587b7(0x21c)]}),_0x26b863=await master_shop[_0x5587b7(0x212)]();let _0x4f5748;if(_0x402af[_0x5587b7(0x255)]==_0x5587b7(0x21a)){const _0x8dbb25=await staff[_0x5587b7(0x24a)]({'email':_0x402af['email']});_0x4f5748=await warehouse[_0x5587b7(0x212)]({'status':_0x5587b7(0x28f),'name':_0x8dbb25[_0x5587b7(0x24e)]});}else _0x4f5748=await warehouse['find']({'status':_0x5587b7(0x28f)});const _0x9d8acd=await product[_0x5587b7(0x212)]();let _0xc1c29a;if(_0x402af[_0x5587b7(0x255)]==_0x5587b7(0x21a)){const _0x417014=await staff['findOne']({'email':_0x402af['email']});_0xc1c29a=await adjustment_finished[_0x5587b7(0x212)]({'warehouse_name':_0x417014[_0x5587b7(0x24e)]});}else _0xc1c29a=await adjustment_finished['aggregate']([{'$unwind':_0x5587b7(0x278)},{'$group':{'_id':_0x5587b7(0x202),'invoice':{'$first':_0x5587b7(0x266)},'date':{'$first':_0x5587b7(0x288)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x5587b7(0x215)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x26b863[0x0][_0x5587b7(0x265)]=='English\x20(US)'){var _0xdd4919=users[_0x5587b7(0x253)];console[_0x5587b7(0x1f8)](_0xdd4919);}else{if(_0x26b863[0x0]['language']==_0x5587b7(0x246))var _0xdd4919=users[_0x5587b7(0x246)];else{if(_0x26b863[0x0][_0x5587b7(0x265)]==_0x5587b7(0x268))var _0xdd4919=users[_0x5587b7(0x268)];else{if(_0x26b863[0x0][_0x5587b7(0x265)]=='Spanish')var _0xdd4919=users['Spanish'];else{if(_0x26b863[0x0][_0x5587b7(0x265)]==_0x5587b7(0x2b4))var _0xdd4919=users[_0x5587b7(0x2b4)];else{if(_0x26b863[0x0][_0x5587b7(0x265)]==_0x5587b7(0x274))var _0xdd4919=users['Portuguese'];else{if(_0x26b863[0x0][_0x5587b7(0x265)]==_0x5587b7(0x243))var _0xdd4919=users[_0x5587b7(0x243)];else{if(_0x26b863[0x0]['language']==_0x5587b7(0x22d))var _0xdd4919=users[_0x5587b7(0x24b)];}}}}}}}_0x33ada7[_0x5587b7(0x281)](_0x5587b7(0x22a),{'success':_0x109023[_0x5587b7(0x237)](_0x5587b7(0x24f)),'errors':_0x109023[_0x5587b7(0x237)]('errors'),'role':_0x402af,'profile':_0x353097,'warehouse':_0x4f5748,'product':_0x9d8acd,'adjustment':_0xc1c29a,'master_shop':_0x26b863,'language':_0xdd4919});}catch(_0x15af7b){console[_0x5587b7(0x1f8)](_0x15af7b);}});async function getRandom8DigitNumber(){var _0x1e6e42=a0_0x5d2d2c;const _0x4e9a01=0x989680,_0x3241de=0x5f5e0ff,_0x565c74=Math[_0x1e6e42(0x21b)](Math[_0x1e6e42(0x2ab)]()*(_0x3241de-_0x4e9a01+0x1))+_0x4e9a01;var _0x5b3237;const _0x2ee5e3=await adjustment_finished[_0x1e6e42(0x24a)]({'invoice':_0x1e6e42(0x2a6)+_0x565c74});return _0x2ee5e3&&_0x2ee5e3[_0x1e6e42(0x27e)]>0x0?_0x5b3237=_0x1e6e42(0x2a6)+_0x565c74:_0x5b3237=_0x1e6e42(0x2a6)+_0x565c74,_0x5b3237;}function a0_0x1694(){var _0x185f5d=['</body></html>','/view/:id','prod_code','$product_details.floorlevel','finalize','errors','$product_details.storage','$product_details.primary_code','ADJF-','Adjustment\x20Finalize\x20Successfully','sendMail','unit','back','random','/picking_list/PDF_adjustment/','5619664HKWeFO','batch_code','master','$product_details.product_name','secondary_unit','site_title','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','French','New_Qty_Converted_adj','prod_invoice','then','note','<tr>','An\x20error\x20occurred\x20while\x20saving\x20data.','$room','FGSEmail','product_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','error','Finished\x20Goods','Spanish','status','getMonth','<strong>\x20Regards\x20</strong>','<html><head><title></title>','</table>','types','log','adjustment\x20add\x20successfull','filter','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.bay','json','Ambient','/adjustment_finished/preview/','$product_details.type','$product_details.invoice','$_id','express','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.rack','</thead>','product_details','save','prod_name','\x20Order\x20Number\x20:\x20','getDate','/adjustment/view','An\x20error\x20occurred.','body','room_names','/view','padStart','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','/view/add_adjustment','$finalize','$product_details.unit','split','purchases_data','</tbody>','staff','floor','email','warehouse_name','5129904cYYbJm','3646480VOHFbM','/CheckingWarehouse','\x20</h2>','$product_details.maxProducts','</td>','Rooms','maxPerUnit','<div>','redirect','findById','../middleware/auth','adjustment_finished','/upload/','foreach\x20newproduct','Arabic\x20(ae)','forEach','$product_details','exports','adjustment\x20data\x20update\x20successfully','</tr>','edit_adjustment_finished','There\x27s\x20a\x20error\x20in\x20this\x20transaction','password','</div>','flash','<h5>','user','148722bPvPzF','English\x20(US)','post','90LMQxpd','stock','prod_cat','DRY\x20GOODS','production_date','bay','Chinese','3955185WaWjnA','/preview/:id','Hindi','invoice','$product_details.maxPerUnit','Error\x20Occurs','findOne','Arabic','/adjustment_finished/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','warehouse','success','/../public','message','Primary_Units','English','$product_details.bin','role','params','aggregate','createTransport','/barcode_scanner','stockBefore','getFullYear','string','<tbody\x20style=\x22text-align:\x20center;\x22>','2691459obnCxR','<h5\x20style=\x22text-align:\x20left;\x22>','product','<span\x20style=\x22float:\x20right;\x22>','toString','QA\x20Warehouse','$product_details.secondary_code','language','$invoice','</h5>','German','$product_details.product_stock','$product_details._id','8MGnuhx','Portuguese','port','<h2>\x20','expiry_date','host','New_Qty_Converted','$product.product_name','True','Portuguese\x20(BR)','$product_details.product_code','$product_details.production_date','product_date','$product','$product_details.batch_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_stock','Enclosed','nodemailer','length','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','push','render','adjust_qty','room','catch','logo','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','product_name','$date','<table\x20style=\x22width:\x20100%\x20!important;\x22>','679112SdJHnW','Secondary_units','add','<!DOCTYPE\x20html>','edit_adjustment_finished_view','Enabled','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','date','$name','minus','_id','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Return\x20Rooms','$product_details.secondary_unit','slice','\x20Order\x20Date\x20:\x20','map','level','new_adjust_qty'];a0_0x1694=function(){return _0x185f5d;};return a0_0x1694();}router[a0_0x5d2d2c(0x290)]('/view/add_adjustment',auth,async(_0x3f441c,_0x34e1bc)=>{var _0x40cde5=a0_0x5d2d2c;try{const {username:_0x54cbe0,email:_0x5411d2,role:_0x28f37f}=_0x3f441c['user'],_0x13fa21=_0x3f441c[_0x40cde5(0x239)],_0x227682=await profile[_0x40cde5(0x24a)]({'email':_0x13fa21['email']}),_0x3f8e41=await master_shop['find']();let _0x51e6eb;if(_0x13fa21[_0x40cde5(0x255)]==_0x40cde5(0x21a)){const _0x22965b=await staff[_0x40cde5(0x24a)]({'email':_0x13fa21['email']});_0x51e6eb=await warehouse['aggregate']([{'$match':{'status':_0x40cde5(0x28f),'name':_0x22965b[_0x40cde5(0x24e)],'warehouse_category':_0x40cde5(0x2c0),'name':{'$ne':_0x40cde5(0x263)}}},{'$group':{'_id':_0x40cde5(0x293),'name':{'$first':_0x40cde5(0x293)}}}]);}else _0x51e6eb=await warehouse[_0x40cde5(0x257)]([{'$match':{'status':_0x40cde5(0x28f),'warehouse_category':_0x40cde5(0x2c0),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x40cde5(0x293),'name':{'$first':'$name'}}}]);const _0x3df147=await product[_0x40cde5(0x212)]({}),_0xc215ec=await adjustment_finished[_0x40cde5(0x212)]({}),_0x133127=_0xc215ec[_0x40cde5(0x27e)]+0x1,_0x1d6746=_0x40cde5(0x2a6)+_0x133127[_0x40cde5(0x262)]()[_0x40cde5(0x211)](0x5,'0');var _0x46fc6d=[_0x40cde5(0x1fe),_0x40cde5(0x27c),_0x40cde5(0x297)];if(_0x3f8e41[0x0][_0x40cde5(0x265)]==_0x40cde5(0x23b))var _0x3fa9bc=users[_0x40cde5(0x253)];else{if(_0x3f8e41[0x0][_0x40cde5(0x265)]==_0x40cde5(0x246))var _0x3fa9bc=users[_0x40cde5(0x246)];else{if(_0x3f8e41[0x0][_0x40cde5(0x265)]=='German')var _0x3fa9bc=users[_0x40cde5(0x268)];else{if(_0x3f8e41[0x0][_0x40cde5(0x265)]==_0x40cde5(0x2c1))var _0x3fa9bc=users[_0x40cde5(0x2c1)];else{if(_0x3f8e41[0x0][_0x40cde5(0x265)]==_0x40cde5(0x2b4))var _0x3fa9bc=users[_0x40cde5(0x2b4)];else{if(_0x3f8e41[0x0]['language']==_0x40cde5(0x274))var _0x3fa9bc=users[_0x40cde5(0x26c)];else{if(_0x3f8e41[0x0]['language']==_0x40cde5(0x243))var _0x3fa9bc=users['Chinese'];else{if(_0x3f8e41[0x0][_0x40cde5(0x265)]==_0x40cde5(0x22d))var _0x3fa9bc=users['Arabic'];}}}}}}}const _0x37a0d7=getRandom8DigitNumber();_0x37a0d7['then'](_0xe99dc0=>{var _0x5044c3=_0x40cde5;_0x34e1bc[_0x5044c3(0x281)]('add_adjustment_finished',{'success':_0x3f441c[_0x5044c3(0x237)](_0x5044c3(0x24f)),'errors':_0x3f441c[_0x5044c3(0x237)]('errors'),'role':_0x13fa21,'profile':_0x227682,'warehouse':_0x51e6eb,'product':_0x3df147,'master_shop':_0x3f8e41,'language':_0x3fa9bc,'rooms_data':_0x46fc6d,'invoice_no':_0xe99dc0});})[_0x40cde5(0x284)](_0x4a70d3=>{var _0x5cbf28=_0x40cde5;_0x3f441c[_0x5cbf28(0x237)](_0x5cbf28(0x2a3),_0x5cbf28(0x234)),_0x34e1bc[_0x5cbf28(0x227)](_0x5cbf28(0x20c));});}catch(_0x26fdf9){console[_0x40cde5(0x1f8)](_0x26fdf9);}}),router[a0_0x5d2d2c(0x23c)](a0_0x5d2d2c(0x214),auth,async(_0x23e31a,_0x578326)=>{var _0x531149=a0_0x5d2d2c;try{const {warehouse_name:_0x17dff6,date:_0x39a687,prod_name:_0x46c7d0,level:_0x5a3fe1,isle:_0x5f2e7f,pallet:_0x142cec,stock:_0x3be7e6,types:_0x5a917b,adjust_qty:_0x42e7da,new_adjust_qty:_0x3bdac1,note:_0x53681f,Room_name:_0x4cd332,invoice:_0x1fe8be,JO_number:_0x484d5f,expiry_date:_0x26ab96}=_0x23e31a[_0x531149(0x20e)];if(typeof _0x46c7d0==_0x531149(0x25c))var _0x167127=[_0x23e31a['body'][_0x531149(0x209)]],_0x139575=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x29c)]],_0x32a6c4=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x23e)]],_0x143b78=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x1f7)]],_0x313bed=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x2b5)]],_0x128ee9=[_0x23e31a['body'][_0x531149(0x271)]],_0x557f03=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x252)]],_0x5446b9=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x28b)]],_0x356760=[_0x23e31a[_0x531149(0x20e)]['prod_code']],_0x5bff27=[_0x23e31a[_0x531149(0x20e)]['batch_code']],_0x4b8c23=[_0x23e31a[_0x531149(0x20e)]['expiry_date']],_0x37f6e2=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x277)]],_0x49e467=[_0x23e31a['body']['prod_cat']],_0x5bc890=[_0x23e31a[_0x531149(0x20e)][_0x531149(0x224)]],_0x35a6aa=[_0x23e31a[_0x531149(0x20e)]['maxPerUnit']],_0xac279c=[_0x23e31a['body']['prod_invoice']];else var _0x167127=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x209)]],_0x139575=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x29c)]],_0x32a6c4=[..._0x23e31a['body']['stock']],_0x143b78=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x1f7)]],_0x313bed=[..._0x23e31a[_0x531149(0x20e)]['New_Qty_Converted_adj']],_0x128ee9=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x271)]],_0x557f03=[..._0x23e31a[_0x531149(0x20e)]['Primary_Units']],_0x5446b9=[..._0x23e31a['body'][_0x531149(0x28b)]],_0x356760=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x2a0)]],_0x5bff27=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x2ae)]],_0x4b8c23=[..._0x23e31a[_0x531149(0x20e)]['expiry_date']],_0x37f6e2=[..._0x23e31a[_0x531149(0x20e)]['product_date']],_0x49e467=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x23f)]],_0x5bc890=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x224)]],_0x35a6aa=[..._0x23e31a[_0x531149(0x20e)]['maxPerUnit']],_0xac279c=[..._0x23e31a[_0x531149(0x20e)][_0x531149(0x2b6)]];const _0x1e2536=_0x167127['map'](_0x14f568=>{return _0x14f568={'product_name':_0x14f568};});_0x139575['forEach']((_0x2a7be3,_0x40b877)=>{var _0x896e6b=_0x531149;_0x1e2536[_0x40b877][_0x896e6b(0x242)]=_0x2a7be3;}),_0x32a6c4[_0x531149(0x22e)]((_0x2df399,_0x436308)=>{_0x1e2536[_0x436308]['stockBefore']=_0x2df399;}),_0x143b78['forEach']((_0x26afa7,_0x175e97)=>{_0x1e2536[_0x175e97]['types']=_0x26afa7;}),_0x313bed[_0x531149(0x22e)]((_0x3b73b7,_0x50e723)=>{_0x1e2536[_0x50e723]['adjust_qty']=_0x3b73b7;}),_0x128ee9[_0x531149(0x22e)]((_0x234f4d,_0x579d64)=>{var _0x33efef=_0x531149;_0x1e2536[_0x579d64][_0x33efef(0x29d)]=_0x234f4d;}),_0x557f03[_0x531149(0x22e)]((_0x14e1b6,_0x46ef5b)=>{var _0x183748=_0x531149;_0x1e2536[_0x46ef5b][_0x183748(0x2a9)]=_0x14e1b6;}),_0x5446b9[_0x531149(0x22e)]((_0xcb7075,_0x3353d1)=>{var _0x5117cb=_0x531149;_0x1e2536[_0x3353d1][_0x5117cb(0x2b1)]=_0xcb7075;}),_0x356760[_0x531149(0x22e)]((_0x2aab22,_0x1f3f21)=>{var _0x339c9e=_0x531149;_0x1e2536[_0x1f3f21][_0x339c9e(0x2bd)]=_0x2aab22;}),_0x5bff27[_0x531149(0x22e)]((_0x57089b,_0x16f1aa)=>{var _0x2895a5=_0x531149;_0x1e2536[_0x16f1aa][_0x2895a5(0x2ae)]=_0x57089b;}),_0x4b8c23[_0x531149(0x22e)]((_0x54a26d,_0x3d3b3f)=>{var _0x2ddd91=_0x531149;_0x1e2536[_0x3d3b3f][_0x2ddd91(0x26f)]=_0x54a26d;}),_0x37f6e2[_0x531149(0x22e)]((_0xc3503b,_0x1c405f)=>{_0x1e2536[_0x1c405f]['production_date']=_0xc3503b;}),_0x49e467['forEach']((_0x281a8b,_0x2f24a4)=>{_0x1e2536[_0x2f24a4]['prod_cat']=_0x281a8b;}),_0x5bc890[_0x531149(0x22e)]((_0x3e0a2e,_0x3bf72a)=>{var _0x385c57=_0x531149;_0x1e2536[_0x3bf72a][_0x385c57(0x20f)]=_0x3e0a2e;}),_0x35a6aa[_0x531149(0x22e)]((_0x2be101,_0x506c68)=>{var _0x187441=_0x531149;_0x1e2536[_0x506c68][_0x187441(0x225)]=_0x2be101;}),_0xac279c[_0x531149(0x22e)]((_0x2fff50,_0x33a7e7)=>{var _0x545f5b=_0x531149;_0x1e2536[_0x33a7e7][_0x545f5b(0x247)]=_0x2fff50;});const _0x10f471=_0x1e2536[_0x531149(0x1fa)](_0x5ccf32=>_0x5ccf32[_0x531149(0x282)]!=='0'&&_0x5ccf32['adjust_qty']!=='');var _0x1843fb=0x0;_0x10f471[_0x531149(0x22e)](_0x482b61=>{var _0x416912=_0x531149;console[_0x416912(0x1f8)](_0x416912(0x22c),_0x482b61),parseInt(_0x482b61['adjust_qty'])<=0x0&&_0x1843fb++;});if(_0x1843fb!=0x0)return _0x23e31a[_0x531149(0x237)](_0x531149(0x2a3),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x578326[_0x531149(0x227)](_0x531149(0x2aa));const _0x107886=new adjustment_finished({'warehouse_name':_0x17dff6,'date':_0x39a687,'product':_0x10f471,'note':_0x53681f,'room':_0x4cd332,'invoice':_0x1fe8be,'JO_number':_0x484d5f,'expiry_date':_0x26ab96}),_0x1cc574=await _0x107886[_0x531149(0x208)]();_0x23e31a[_0x531149(0x237)](_0x531149(0x24f),_0x531149(0x1f9)),_0x578326['redirect'](_0x531149(0x1ff)+_0x1cc574['_id']);}catch(_0x4cee9e){console['log'](_0x4cee9e),_0x578326['status'](0xc8)['json']({'message':_0x4cee9e['message']});}}),router[a0_0x5d2d2c(0x290)](a0_0x5d2d2c(0x245),auth,async(_0x191bbc,_0x16e27e)=>{var _0x491c6e=a0_0x5d2d2c;try{const {username:_0x1ecf9e,email:_0x232d48,role:_0x26edf1}=_0x191bbc[_0x491c6e(0x239)],_0x52d866=_0x191bbc[_0x491c6e(0x239)],_0x2329a0=await profile[_0x491c6e(0x24a)]({'email':_0x52d866[_0x491c6e(0x21c)]}),_0x5f88ac=await master_shop[_0x491c6e(0x212)](),_0x986535=_0x191bbc['params']['id'],_0x59d969=await adjustment_finished[_0x491c6e(0x228)]({'_id':_0x986535}),_0x165023=await purchases[_0x491c6e(0x257)]([{'$match':{'warehouse_name':_0x59d969[_0x491c6e(0x21d)]}},{'$unwind':_0x491c6e(0x278)},{'$group':{'_id':_0x491c6e(0x272)}}]);console[_0x491c6e(0x1f8)](_0x491c6e(0x218),_0x165023);const _0x549e08=await product[_0x491c6e(0x212)]({}),_0x26e1fb=await warehouse[_0x491c6e(0x257)]([{'$match':{'name':_0x59d969[_0x491c6e(0x21d)],'warehouse_category':_0x491c6e(0x2c0)}},{'$unwind':_0x491c6e(0x22f)},{'$group':{'_id':_0x491c6e(0x26a),'name':{'$first':_0x491c6e(0x2b0)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x491c6e(0x1fc)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x491c6e(0x200)},'floorlevel':{'$first':_0x491c6e(0x2a1)},'primary_code':{'$first':_0x491c6e(0x2a5)},'secondary_code':{'$first':_0x491c6e(0x264)},'product_code':{'$first':_0x491c6e(0x275)},'storage':{'$first':_0x491c6e(0x2a4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x491c6e(0x276)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x491c6e(0x248)},'room':{'$first':_0x491c6e(0x2bb)}}}]);if(_0x5f88ac[0x0]['language']==_0x491c6e(0x23b)){var _0x5cfec8=users[_0x491c6e(0x253)];console['log'](_0x5cfec8);}else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]==_0x491c6e(0x246))var _0x5cfec8=users[_0x491c6e(0x246)];else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]=='German')var _0x5cfec8=users[_0x491c6e(0x268)];else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]==_0x491c6e(0x2c1))var _0x5cfec8=users['Spanish'];else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]==_0x491c6e(0x2b4))var _0x5cfec8=users['French'];else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]==_0x491c6e(0x274))var _0x5cfec8=users['Portuguese'];else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]==_0x491c6e(0x243))var _0x5cfec8=users[_0x491c6e(0x243)];else{if(_0x5f88ac[0x0][_0x491c6e(0x265)]==_0x491c6e(0x22d))var _0x5cfec8=users[_0x491c6e(0x24b)];}}}}}}}_0x16e27e[_0x491c6e(0x281)](_0x491c6e(0x28e),{'success':_0x191bbc[_0x491c6e(0x237)](_0x491c6e(0x24f)),'errors':_0x191bbc[_0x491c6e(0x237)](_0x491c6e(0x2a3)),'role':_0x52d866,'profile':_0x2329a0,'adjustment':_0x59d969,'stock':_0x26e1fb,'master_shop':_0x5f88ac,'warehouse_name':_0x165023,'unit':_0x549e08,'language':_0x5cfec8});}catch(_0x39e02b){console[_0x491c6e(0x1f8)](_0x39e02b),_0x16e27e['status'](0xc8)[_0x491c6e(0x1fd)]({'message':_0x39e02b['message']});}}),router[a0_0x5d2d2c(0x23c)]('/preview/:id',auth,async(_0x36a934,_0x59df41)=>{var _0x4c5d11=a0_0x5d2d2c;try{const {invoice:_0x23a13c,warehouse_name:_0x486a2f,Room_name:_0x149f91}=_0x36a934[_0x4c5d11(0x20e)],_0x389364=_0x36a934[_0x4c5d11(0x256)]['id'],_0x1e783f=await adjustment_finished[_0x4c5d11(0x228)]({'_id':_0x389364});var _0xbd4db7;const _0x3e140a=_0x1e783f[_0x4c5d11(0x260)][_0x4c5d11(0x29b)](async _0x2e82a4=>{var _0x585733=_0x4c5d11;if(_0x2e82a4[_0x585733(0x282)]>0x0){_0xbd4db7=await warehouse[_0x585733(0x24a)]({'name':_0x486a2f,'room':_0x2e82a4['room_names'],'warehouse_category':_0x585733(0x2c0)});const _0x595ab6=_0xbd4db7[_0x585733(0x207)][_0x585733(0x29b)](_0x12e092=>{var _0x23bb94=_0x585733;console[_0x23bb94(0x1f8)](_0x2e82a4[_0x23bb94(0x1f7)]);if(_0x2e82a4['types']==_0x23bb94(0x294))_0x12e092[_0x23bb94(0x287)]==_0x2e82a4['product_name']&&_0x12e092[_0x23bb94(0x242)]==_0x2e82a4[_0x23bb94(0x242)]&&_0x12e092['expiry_date']==_0x2e82a4['expiry_date']&&_0x12e092[_0x23bb94(0x241)]==_0x2e82a4['production_date']&&_0x12e092[_0x23bb94(0x2ae)]==_0x2e82a4[_0x23bb94(0x2ae)]&&_0x12e092[_0x23bb94(0x247)]==_0x2e82a4['invoice']&&(_0x12e092[_0x23bb94(0x27b)]=_0x12e092[_0x23bb94(0x27b)]-_0x2e82a4['adjust_qty']);else _0x2e82a4[_0x23bb94(0x1f7)]==_0x23bb94(0x28c)&&(_0x12e092['product_name']==_0x2e82a4[_0x23bb94(0x287)]&&_0x12e092[_0x23bb94(0x242)]==_0x2e82a4[_0x23bb94(0x242)]&&_0x12e092[_0x23bb94(0x26f)]==_0x2e82a4[_0x23bb94(0x26f)]&&_0x12e092[_0x23bb94(0x241)]==_0x2e82a4[_0x23bb94(0x241)]&&_0x12e092[_0x23bb94(0x2ae)]==_0x2e82a4[_0x23bb94(0x2ae)]&&_0x12e092[_0x23bb94(0x247)]==_0x2e82a4[_0x23bb94(0x247)]&&(_0x12e092[_0x23bb94(0x27b)]=_0x12e092['product_stock']+_0x2e82a4[_0x23bb94(0x282)]));});}return _0xbd4db7;});Promise['all'](_0x3e140a)[_0x4c5d11(0x2b7)](async _0x561f35=>{var _0x2d8037=_0x4c5d11;try{for(const _0x659ed of _0x561f35){await _0x659ed[_0x2d8037(0x208)]();}_0x1e783f[_0x2d8037(0x2a2)]=_0x2d8037(0x273);const _0x141b42=await _0x1e783f[_0x2d8037(0x208)](),_0x10f58c=await master_shop['find'](),_0x122a67=await email_settings[_0x2d8037(0x24a)](),_0x2cfa8f=await supervisor_settings[_0x2d8037(0x212)]();var _0x25b366=_0x1e783f['product'],_0x46dc81='',_0x487489;for(_0x487489 in _0x25b366){var _0x38803f='FG';_0x1e783f['warehouse_name']==_0x2d8037(0x240)&&(_0x38803f='DG'),_0x46dc81+=_0x2d8037(0x2b9)+_0x2d8037(0x27a)+_0x25b366[_0x487489][_0x2d8037(0x287)]+_0x2d8037(0x223)+_0x2d8037(0x27a)+_0x25b366[_0x487489][_0x2d8037(0x2bd)]+'</td>'+_0x2d8037(0x27a)+_0x25b366[_0x487489][_0x2d8037(0x282)]+_0x2d8037(0x223)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x25b366[_0x487489][_0x2d8037(0x2a9)]+_0x2d8037(0x223)+_0x2d8037(0x27a)+_0x25b366[_0x487489][_0x2d8037(0x2b1)]+_0x2d8037(0x223)+_0x2d8037(0x27a)+_0x1e783f[_0x2d8037(0x21d)]+'</td>'+_0x2d8037(0x27a)+_0x25b366[_0x487489][_0x2d8037(0x20f)]+_0x2d8037(0x223)+_0x2d8037(0x27a)+_0x38803f+_0x25b366[_0x487489][_0x2d8037(0x242)]+'</td>'+_0x2d8037(0x232);}let _0x24c7a9=nodemailer[_0x2d8037(0x258)]({'host':_0x122a67[_0x2d8037(0x270)],'port':Number(_0x122a67[_0x2d8037(0x26d)]),'secure':![],'auth':{'user':_0x122a67[_0x2d8037(0x21c)],'pass':_0x122a67[_0x2d8037(0x235)]}}),_0x48c6cc={'from':_0x122a67[_0x2d8037(0x21c)],'to':_0x2cfa8f[0x0][_0x2d8037(0x2bc)],'subject':'Adjustment\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x2d8037(0x250)+_0x2d8037(0x22b)+_0x10f58c[0x0]['image'],'cid':_0x2d8037(0x285)}],'html':_0x2d8037(0x28d)+_0x2d8037(0x1f5)+'</head><body>'+_0x2d8037(0x226)+_0x2d8037(0x286)+_0x2d8037(0x226)+_0x2d8037(0x296)+_0x2d8037(0x236)+_0x2d8037(0x226)+_0x2d8037(0x26e)+_0x10f58c[0x0][_0x2d8037(0x2b2)]+_0x2d8037(0x221)+'</div>'+_0x2d8037(0x236)+'<hr\x20class=\x22my-3\x22>'+_0x2d8037(0x226)+_0x2d8037(0x25f)+_0x2d8037(0x20a)+_0x1e783f[_0x2d8037(0x247)]+'\x20'+_0x2d8037(0x261)+_0x2d8037(0x29a)+_0x1e783f[_0x2d8037(0x292)]+'\x20'+'</span>'+_0x2d8037(0x267)+'</div>'+_0x2d8037(0x289)+_0x2d8037(0x204)+'<tr>'+_0x2d8037(0x213)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x2d8037(0x2b3)+_0x2d8037(0x1fb)+_0x2d8037(0x24d)+_0x2d8037(0x27f)+_0x2d8037(0x2be)+_0x2d8037(0x291)+_0x2d8037(0x232)+_0x2d8037(0x206)+_0x2d8037(0x25d)+'\x20'+_0x46dc81+'\x20'+_0x2d8037(0x219)+_0x2d8037(0x1f6)+'<div>'+_0x2d8037(0x1f4)+_0x2d8037(0x238)+_0x10f58c[0x0]['site_title']+'</h5>'+_0x2d8037(0x236)+_0x2d8037(0x236)+_0x2d8037(0x29e)};_0x24c7a9[_0x2d8037(0x2a8)](_0x48c6cc,function(_0x1663df,_0x47e3ee){var _0x2b1dda=_0x2d8037;_0x1663df?(console['log'](_0x1663df),console[_0x2b1dda(0x1f8)](_0x2b1dda(0x249))):console[_0x2b1dda(0x1f8)]('Email\x20sent\x20successfully');}),_0x36a934[_0x2d8037(0x237)](_0x2d8037(0x24f),_0x2d8037(0x2a7)),_0x59df41['redirect'](_0x2d8037(0x2ac)+_0x141b42[_0x2d8037(0x295)]);}catch(_0x16d885){console[_0x2d8037(0x2bf)](_0x16d885),_0x59df41[_0x2d8037(0x2c2)](0x1f4)[_0x2d8037(0x1fd)]({'error':_0x2d8037(0x2ba)});}})['catch'](_0x1a746a=>{var _0x33e806=_0x4c5d11;console[_0x33e806(0x2bf)](_0x1a746a),_0x59df41[_0x33e806(0x2c2)](0x1f4)['json']({'error':_0x33e806(0x20d)});});}catch(_0x146503){_0x59df41[_0x4c5d11(0x1fd)]({'message':_0x146503[_0x4c5d11(0x251)]});}}),router[a0_0x5d2d2c(0x290)](a0_0x5d2d2c(0x29f),auth,async(_0x59cf30,_0x33ddbe)=>{var _0x10b7d9=a0_0x5d2d2c;try{const {username:_0x423d91,email:_0x52b30d,role:_0xb1236e}=_0x59cf30[_0x10b7d9(0x239)],_0x1ccb3d=_0x59cf30[_0x10b7d9(0x239)],_0x3414af=await profile['findOne']({'email':_0x1ccb3d[_0x10b7d9(0x21c)]}),_0x35b415=await master_shop[_0x10b7d9(0x212)]();console[_0x10b7d9(0x1f8)](_0x10b7d9(0x2af),_0x35b415);const _0x347249=_0x59cf30[_0x10b7d9(0x256)]['id'],_0x22c0a6=await adjustment_finished[_0x10b7d9(0x228)]({'_id':_0x347249});let _0x4f90bf=new Date(_0x22c0a6['expiry_date']),_0x6d6fa7=('0'+_0x4f90bf[_0x10b7d9(0x20b)]())['slice'](-0x2),_0x4d2871=('0'+(_0x4f90bf[_0x10b7d9(0x2c3)]()+0x1))[_0x10b7d9(0x299)](-0x2),_0x49a5e4=_0x4f90bf[_0x10b7d9(0x25b)](),_0x234388=_0x49a5e4+'-'+_0x4d2871+'-'+_0x6d6fa7;var _0x2ffa1b=[_0x10b7d9(0x1fe),_0x10b7d9(0x27c),_0x10b7d9(0x297)];const _0x1c314a=await purchases[_0x10b7d9(0x257)]([{'$match':{'warehouse_name':_0x22c0a6[_0x10b7d9(0x21d)]}},{'$unwind':_0x10b7d9(0x278)},{'$group':{'_id':'$product.product_name'}}]);console[_0x10b7d9(0x1f8)](_0x10b7d9(0x218),_0x1c314a);const _0x835f28=await product[_0x10b7d9(0x212)]({}),_0x3bdd46=await warehouse['aggregate']([{'$match':{'name':_0x22c0a6[_0x10b7d9(0x21d)],'room':_0x22c0a6[_0x10b7d9(0x283)]}},{'$unwind':_0x10b7d9(0x22f)},{'$group':{'_id':_0x10b7d9(0x26a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x10b7d9(0x269)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x10b7d9(0x254)},'type':{'$first':_0x10b7d9(0x200)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x10b7d9(0x2a5)},'secondary_code':{'$first':_0x10b7d9(0x264)},'product_code':{'$first':_0x10b7d9(0x275)},'storage':{'$first':_0x10b7d9(0x2a4)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x35b415[0x0][_0x10b7d9(0x265)]==_0x10b7d9(0x23b)){var _0x2945ad=users[_0x10b7d9(0x253)];console[_0x10b7d9(0x1f8)](_0x2945ad);}else{if(_0x35b415[0x0][_0x10b7d9(0x265)]==_0x10b7d9(0x246))var _0x2945ad=users[_0x10b7d9(0x246)];else{if(_0x35b415[0x0][_0x10b7d9(0x265)]==_0x10b7d9(0x268))var _0x2945ad=users['German'];else{if(_0x35b415[0x0][_0x10b7d9(0x265)]==_0x10b7d9(0x2c1))var _0x2945ad=users[_0x10b7d9(0x2c1)];else{if(_0x35b415[0x0]['language']==_0x10b7d9(0x2b4))var _0x2945ad=users[_0x10b7d9(0x2b4)];else{if(_0x35b415[0x0][_0x10b7d9(0x265)]=='Portuguese\x20(BR)')var _0x2945ad=users[_0x10b7d9(0x26c)];else{if(_0x35b415[0x0][_0x10b7d9(0x265)]==_0x10b7d9(0x243))var _0x2945ad=users[_0x10b7d9(0x243)];else{if(_0x35b415[0x0][_0x10b7d9(0x265)]==_0x10b7d9(0x22d))var _0x2945ad=users[_0x10b7d9(0x24b)];}}}}}}}_0x33ddbe[_0x10b7d9(0x281)](_0x10b7d9(0x233),{'success':_0x59cf30[_0x10b7d9(0x237)]('success'),'errors':_0x59cf30[_0x10b7d9(0x237)](_0x10b7d9(0x2a3)),'role':_0x1ccb3d,'profile':_0x3414af,'adjustment':_0x22c0a6,'stock':_0x3bdd46,'master_shop':_0x35b415,'warehouse_name':_0x1c314a,'unit':_0x835f28,'language':_0x2945ad,'rooms_data':_0x2ffa1b,'ed_fullDate':_0x234388});}catch(_0x100fe4){console[_0x10b7d9(0x1f8)](_0x100fe4),_0x33ddbe[_0x10b7d9(0x2c2)](0xc8)['json']({'message':_0x100fe4[_0x10b7d9(0x251)]});}}),router[a0_0x5d2d2c(0x23c)](a0_0x5d2d2c(0x29f),auth,async(_0x34e23f,_0x5095c9)=>{var _0x1ce7a5=a0_0x5d2d2c;try{const _0x337ce7=_0x34e23f[_0x1ce7a5(0x256)]['id'],_0x3684e9=await adjustment_finished[_0x1ce7a5(0x228)]({'_id':_0x337ce7}),_0x1130ec=await warehouse[_0x1ce7a5(0x24a)]({'name':_0x3684e9[_0x1ce7a5(0x21d)],'room':_0x3684e9[_0x1ce7a5(0x283)]}),{warehouse_name:_0x292800,date:_0xa284c7,prod_name:_0x387dd2,level:_0x7eaf08,isle:_0x4b32d0,pallet:_0x5d70bd,stock:_0x19dea1,types:_0x232381,adjust_qty:_0x149997,new_adjust_qty:_0x26d541,note:_0x217ecb,Room_name:_0x47d85a,invoice:_0x374e24,JO_number:_0x446163}=_0x34e23f[_0x1ce7a5(0x20e)];if(typeof _0x387dd2==_0x1ce7a5(0x25c))var _0x503843=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x209)]],_0x158809=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x29c)]],_0x30c746=[_0x34e23f['body']['stock']],_0x313883=[_0x34e23f[_0x1ce7a5(0x20e)]['types']],_0xb3400c=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x282)]],_0x509947=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x29d)]],_0x4867db=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x2a0)]],_0x5cd631=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x2a9)]],_0x26492a=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x28b)]],_0x4544d5=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x2ae)]],_0x506754=[_0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x26f)]];else var _0x503843=[..._0x34e23f[_0x1ce7a5(0x20e)]['prod_name']],_0x158809=[..._0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x29c)]],_0x30c746=[..._0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x23e)]],_0x313883=[..._0x34e23f['body'][_0x1ce7a5(0x1f7)]],_0xb3400c=[..._0x34e23f['body'][_0x1ce7a5(0x282)]],_0x509947=[..._0x34e23f[_0x1ce7a5(0x20e)]['new_adjust_qty']],_0x4867db=[..._0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x2a0)]],_0x5cd631=[..._0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x2a9)]],_0x26492a=[..._0x34e23f[_0x1ce7a5(0x20e)][_0x1ce7a5(0x28b)]],_0x4544d5=[..._0x34e23f['body'][_0x1ce7a5(0x2ae)]],_0x506754=[..._0x34e23f['body'][_0x1ce7a5(0x26f)]];const _0x41dad2=_0x503843[_0x1ce7a5(0x29b)](_0x1ba22f=>{return _0x1ba22f={'product_name':_0x1ba22f};});_0x158809['forEach']((_0x4ca5ab,_0x463c74)=>{var _0x44a6f0=_0x1ce7a5;_0x41dad2[_0x463c74][_0x44a6f0(0x242)]=_0x4ca5ab;}),_0x30c746[_0x1ce7a5(0x22e)]((_0x8091eb,_0x45cb10)=>{var _0x207327=_0x1ce7a5;_0x41dad2[_0x45cb10][_0x207327(0x25a)]=_0x8091eb;}),_0x313883[_0x1ce7a5(0x22e)]((_0x649ae4,_0x33d47b)=>{var _0x730b19=_0x1ce7a5;_0x41dad2[_0x33d47b][_0x730b19(0x1f7)]=_0x649ae4;}),_0xb3400c[_0x1ce7a5(0x22e)]((_0x4f0ad1,_0x36e86b)=>{var _0x19742b=_0x1ce7a5;_0x41dad2[_0x36e86b][_0x19742b(0x282)]=_0x4f0ad1;}),_0x509947['forEach']((_0x35d98d,_0x4b14e0)=>{var _0x46cd5d=_0x1ce7a5;_0x41dad2[_0x4b14e0][_0x46cd5d(0x29d)]=_0x35d98d;}),_0x5cd631['forEach']((_0xd159d9,_0x45d971)=>{var _0x41eef3=_0x1ce7a5;_0x41dad2[_0x45d971][_0x41eef3(0x2a9)]=_0xd159d9;}),_0x26492a['forEach']((_0x3f6dc1,_0x59feb7)=>{var _0x397d78=_0x1ce7a5;_0x41dad2[_0x59feb7][_0x397d78(0x2b1)]=_0x3f6dc1;}),_0x4867db[_0x1ce7a5(0x22e)]((_0x3dec6e,_0x2b7211)=>{var _0x2a18af=_0x1ce7a5;_0x41dad2[_0x2b7211][_0x2a18af(0x2bd)]=_0x3dec6e;}),_0x4544d5['forEach']((_0x908cb1,_0x42c643)=>{var _0x3dff50=_0x1ce7a5;_0x41dad2[_0x42c643][_0x3dff50(0x2ae)]=_0x908cb1;}),_0x506754[_0x1ce7a5(0x22e)]((_0x55d419,_0x3fb218)=>{var _0x472dd0=_0x1ce7a5;_0x41dad2[_0x3fb218][_0x472dd0(0x26f)]=_0x55d419;});const _0x3d2351=_0x41dad2[_0x1ce7a5(0x1fa)](_0x4d8bd6=>_0x4d8bd6[_0x1ce7a5(0x282)]!=='0'&&_0x4d8bd6['adjust_qty']!=='');var _0x4e0e49=0x0;_0x3d2351[_0x1ce7a5(0x22e)](_0x1ce732=>{var _0xe9cf00=_0x1ce7a5;console[_0xe9cf00(0x1f8)]('foreach\x20newproduct',_0x1ce732),parseInt(_0x1ce732[_0xe9cf00(0x282)])<=0x0&&_0x4e0e49++;});if(_0x4e0e49!=0x0)return _0x34e23f['flash'](_0x1ce7a5(0x2a3),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x5095c9[_0x1ce7a5(0x227)](_0x1ce7a5(0x2aa));_0x3684e9[_0x1ce7a5(0x21d)]=_0x292800,_0x3684e9[_0x1ce7a5(0x292)]=_0xa284c7,_0x3684e9[_0x1ce7a5(0x260)]=_0x3d2351,_0x3684e9[_0x1ce7a5(0x2b8)]=_0x217ecb,_0x3684e9[_0x1ce7a5(0x283)]=_0x47d85a,_0x3684e9[_0x1ce7a5(0x247)]=_0x374e24,_0x3684e9['JO_number']=_0x446163;const _0x143e89=await _0x3684e9[_0x1ce7a5(0x208)](),_0x1456b8=await warehouse[_0x1ce7a5(0x24a)]({'name':_0x292800,'room':_0x47d85a});_0x143e89['product'][_0x1ce7a5(0x22e)](_0x45ec60=>{var _0x10db94=_0x1ce7a5;const _0x255a3a=_0x1456b8[_0x10db94(0x207)][_0x10db94(0x29b)](_0xb02df0=>{var _0x114e4b=_0x10db94;_0x45ec60[_0x114e4b(0x1f7)]==_0x114e4b(0x294)?_0xb02df0[_0x114e4b(0x287)]==_0x45ec60[_0x114e4b(0x287)]&&_0xb02df0[_0x114e4b(0x242)]==_0x45ec60[_0x114e4b(0x242)]&&(_0xb02df0[_0x114e4b(0x27b)]=parseInt(_0xb02df0[_0x114e4b(0x27b)])-parseInt(_0x45ec60[_0x114e4b(0x282)])):_0xb02df0[_0x114e4b(0x287)]==_0x45ec60[_0x114e4b(0x287)]&&_0xb02df0[_0x114e4b(0x242)]==_0x45ec60[_0x114e4b(0x242)]&&(_0xb02df0[_0x114e4b(0x27b)]=parseInt(_0xb02df0[_0x114e4b(0x27b)])+parseInt(_0x45ec60[_0x114e4b(0x282)]));});}),await _0x1456b8[_0x1ce7a5(0x208)](),_0x34e23f[_0x1ce7a5(0x237)](_0x1ce7a5(0x24f),_0x1ce7a5(0x231)),_0x5095c9[_0x1ce7a5(0x227)](_0x1ce7a5(0x24c));}catch(_0x59ea8e){console['log'](_0x59ea8e);}}),router['post'](a0_0x5d2d2c(0x259),async(_0x481150,_0x9b0add)=>{var _0x4d2948=a0_0x5d2d2c;const {primary_code:_0x2ea628,warehouse_data:_0xac24d7,rooms_data:_0x1be926,Roomslist:_0x479998}=_0x481150[_0x4d2948(0x20e)],_0xc4b833=_0x479998[_0x4d2948(0x217)](','),_0x29e455=[];async function _0x283f61(_0x5d64a2){var _0x4abc25=_0x4d2948;const _0x2ef2c5=await warehouse[_0x4abc25(0x257)]([{'$match':{'name':_0xac24d7,'room':_0x5d64a2}},{'$unwind':_0x4abc25(0x22f)},{'$match':{'product_details.primary_code':_0x2ea628}},{'$group':{'_id':_0x4abc25(0x26a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4abc25(0x269)},'primary_code':{'$first':_0x4abc25(0x2a5)},'secondary_code':{'$first':_0x4abc25(0x264)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x4abc25(0x1fc)},'isle':{'$first':_0x4abc25(0x254)},'type':{'$first':_0x4abc25(0x200)},'pallet':{'$first':_0x4abc25(0x2a1)},'unit':{'$first':_0x4abc25(0x216)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x4abc25(0x2a4)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4abc25(0x276)},'batch_code':{'$first':_0x4abc25(0x279)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x4abc25(0x248)},'roomNamed':{'$first':_0x4abc25(0x2bb)},'invoice':{'$first':_0x4abc25(0x201)}}}]),_0x152412=await warehouse[_0x4abc25(0x257)]([{'$match':{'name':_0xac24d7,'room':_0x5d64a2}},{'$unwind':_0x4abc25(0x22f)},{'$match':{'product_details.secondary_code':_0x2ea628}},{'$group':{'_id':_0x4abc25(0x26a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4abc25(0x269)},'primary_code':{'$first':_0x4abc25(0x2a5)},'secondary_code':{'$first':_0x4abc25(0x264)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x4abc25(0x200)},'pallet':{'$first':_0x4abc25(0x2a1)},'unit':{'$first':_0x4abc25(0x216)},'secondary_unit':{'$first':_0x4abc25(0x298)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x4abc25(0x205)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x4abc25(0x276)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x4abc25(0x248)},'roomNamed':{'$first':_0x4abc25(0x2bb)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2ef2c5[_0x4abc25(0x27e)]>0x0)_0x29e455['push'](_0x2ef2c5);else _0x152412[_0x4abc25(0x27e)]>0x0&&_0x29e455[_0x4abc25(0x280)](_0x152412);}const _0x47d1dc=_0xc4b833[_0x4d2948(0x29b)](_0x1353c0=>_0x283f61(_0x1353c0));await Promise['all'](_0x47d1dc),_0x9b0add[_0x4d2948(0x1fd)](_0x29e455);}),router[a0_0x5d2d2c(0x23c)](a0_0x5d2d2c(0x220),async(_0x11318d,_0x2dd2)=>{var _0x214f8b=a0_0x5d2d2c;const {productCode:_0x5e0226,bay:_0x436924,warehouses:_0x5850cd,room:_0xa293bd}=_0x11318d[_0x214f8b(0x20e)];console[_0x214f8b(0x1f8)](_0x11318d[_0x214f8b(0x20e)]);try{const _0x4ddf82=await warehouse[_0x214f8b(0x257)]([{'$match':{'name':_0x5850cd,'room':_0xa293bd}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x436924)}},{'$group':{'_id':_0x214f8b(0x26a),'name':{'$first':_0x214f8b(0x2b0)},'product_stock':{'$first':_0x214f8b(0x269)},'bay':{'$first':_0x214f8b(0x1fc)},'maxProducts':{'$first':_0x214f8b(0x222)}}}]);_0x2dd2[_0x214f8b(0x2c2)](0xc8)[_0x214f8b(0x1fd)](_0x4ddf82);}catch(_0x100767){_0x2dd2['status'](0x194)[_0x214f8b(0x1fd)]({'message':_0x100767[_0x214f8b(0x251)]});}}),module[a0_0x5d2d2c(0x230)]=router;