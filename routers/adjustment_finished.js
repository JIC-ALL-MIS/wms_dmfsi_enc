var a0_0x43870d=a0_0x2da0;(function(_0x2c3889,_0x2319c6){var _0x9337cc=a0_0x2da0,_0x1bb8a3=_0x2c3889();while(!![]){try{var _0x1a4326=parseInt(_0x9337cc(0x1bc))/0x1*(parseInt(_0x9337cc(0x19e))/0x2)+parseInt(_0x9337cc(0x237))/0x3+parseInt(_0x9337cc(0x23f))/0x4*(parseInt(_0x9337cc(0x1d5))/0x5)+-parseInt(_0x9337cc(0x1f2))/0x6+-parseInt(_0x9337cc(0x1bb))/0x7+parseInt(_0x9337cc(0x1f1))/0x8+-parseInt(_0x9337cc(0x1e3))/0x9;if(_0x1a4326===_0x2319c6)break;else _0x1bb8a3['push'](_0x1bb8a3['shift']());}catch(_0x46ba7c){_0x1bb8a3['push'](_0x1bb8a3['shift']());}}}(a0_0x2b4d,0xab900));function a0_0x2b4d(){var _0x55edee=['role','<strong>\x20Regards\x20</strong>','Error\x20Occurs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','batch_code','all','catch','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','minus','$product_details.bin','prod_name','logo','$name','<span\x20style=\x22float:\x20right;\x22>','</body></html>','aggregate','English','French','success','1278JykIiP','product_details','$product_details.batch_code','</div>','</head><body>','image','_id','$product_details.product_stock','site_title','edit_adjustment_finished','push','</span>','new_adjust_qty','findById','get','Enabled','back','password','</td>','German','True','port','json','map','../public/language/languages.json','Arabic','purchases_data','stock','/view/:id','1965264aRrCfJ','1650zyHmMk','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$date','invoice','note','$product.product_name','Primary_Units','findOne','QA\x20Warehouse','product_name','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.secondary_unit','redirect','express','sendMail','room_names','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','finalize','product_stock','then','production_date','Enclosed','$product_details.rack','/barcode_scanner','save','681930TEFjFV','$room','createTransport','date','Secondary_units','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/CheckingWarehouse','New_Qty_Converted','Router','$product_details','params','Hindi','$product_details.maxProducts','body','18960876NAOMbi','add_adjustment_finished','post','$product','<html><head><title></title>','$product_details.product_name','getMonth','$product_details.bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Ambient','$product_details.invoice','$product_details.product_code','stockBefore','forEach','8304736mXoCOt','6534378vLEZVx','$product_details.storage','<hr\x20class=\x22my-3\x22>','</tr>','$product_details.unit','$product_details.production_date','message','filter','product_date','string','find','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.primary_code','adjustment\x20add\x20successfull','$product_details.maxPerUnit','types','toString','warehouse','/adjustment_finished/preview/','email','maxPerUnit','flash','Portuguese','English\x20(US)','master','product_code','$product_details.type','Arabic\x20(ae)','/../public','padStart','warehouse_name','$product_details.expiry_date','$invoice','product','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','random','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','errors','Return\x20Rooms','room','FGSEmail','/adjustment_finished/view','secondary_unit','staff','<div>','prod_cat','$product_details.floorlevel','edit_adjustment_finished_view','bay','$product_details.secondary_code','slice','\x20</h2>','language','Logo.png','<h5\x20style=\x22text-align:\x20left;\x22>','Finished\x20Goods','/preview/:id','length','/view','prod_invoice','prod_code','</table>','New_Qty_Converted_adj','Spanish','Chinese','$product_details._id','$warehouse_name','2578149dmLRku','/adjustment/view','Portuguese\x20(BR)','$_id','<h5>','Rooms','unit','render','36BqvSVd','/upload/','adjust_qty','</h5>','status','exports','JO_number','There\x27s\x20a\x20error\x20in\x20this\x20transaction','expiry_date','log','floor','user','/view/add_adjustment','<tr>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','ADJF-'];a0_0x2b4d=function(){return _0x55edee;};return a0_0x2b4d();}const express=require(a0_0x43870d(0x1c9)),app=express(),router=express[a0_0x43870d(0x1dd)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x43870d(0x1b6)),nodemailer=require('nodemailer');router['get'](a0_0x43870d(0x22e),auth,async(_0xbb1c0f,_0x2ff888)=>{var _0x372da4=a0_0x43870d;try{const {username:_0x2138f6,email:_0x3e879b,role:_0x76e0f0}=_0xbb1c0f[_0x372da4(0x24a)],_0xf87819=_0xbb1c0f[_0x372da4(0x24a)],_0x229156=await profile[_0x372da4(0x1c3)]({'email':_0xf87819[_0x372da4(0x205)]}),_0xede650=await master_shop[_0x372da4(0x1fc)]();let _0x195ebc;if(_0xf87819[_0x372da4(0x24f)]==_0x372da4(0x21f)){const _0x1696fc=await staff[_0x372da4(0x1c3)]({'email':_0xf87819[_0x372da4(0x205)]});_0x195ebc=await warehouse[_0x372da4(0x1fc)]({'status':_0x372da4(0x1ad),'name':_0x1696fc[_0x372da4(0x203)]});}else _0x195ebc=await warehouse['find']({'status':_0x372da4(0x1ad)});const _0x3fff8=await product[_0x372da4(0x1fc)]();let _0x541191;if(_0xf87819[_0x372da4(0x24f)]==_0x372da4(0x21f)){const _0x50b577=await staff[_0x372da4(0x1c3)]({'email':_0xf87819['email']});_0x541191=await adjustment_finished[_0x372da4(0x1fc)]({'warehouse_name':_0x50b577[_0x372da4(0x203)]});}else _0x541191=await adjustment_finished[_0x372da4(0x25f)]([{'$unwind':'$product'},{'$group':{'_id':_0x372da4(0x23a),'invoice':{'$first':_0x372da4(0x212)},'date':{'$first':_0x372da4(0x1be)},'warehouse_name':{'$first':_0x372da4(0x236)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xede650[0x0]['language']==_0x372da4(0x209)){var _0x2aa5e3=users['English'];console[_0x372da4(0x248)](_0x2aa5e3);}else{if(_0xede650[0x0][_0x372da4(0x228)]==_0x372da4(0x1e0))var _0x2aa5e3=users[_0x372da4(0x1e0)];else{if(_0xede650[0x0][_0x372da4(0x228)]==_0x372da4(0x1b1))var _0x2aa5e3=users[_0x372da4(0x1b1)];else{if(_0xede650[0x0][_0x372da4(0x228)]==_0x372da4(0x233))var _0x2aa5e3=users[_0x372da4(0x233)];else{if(_0xede650[0x0][_0x372da4(0x228)]==_0x372da4(0x261))var _0x2aa5e3=users[_0x372da4(0x261)];else{if(_0xede650[0x0][_0x372da4(0x228)]=='Portuguese\x20(BR)')var _0x2aa5e3=users[_0x372da4(0x208)];else{if(_0xede650[0x0][_0x372da4(0x228)]==_0x372da4(0x234))var _0x2aa5e3=users['Chinese'];else{if(_0xede650[0x0][_0x372da4(0x228)]=='Arabic\x20(ae)')var _0x2aa5e3=users[_0x372da4(0x1b7)];}}}}}}}_0x2ff888[_0x372da4(0x23e)]('adjustment_finished',{'success':_0xbb1c0f[_0x372da4(0x207)](_0x372da4(0x262)),'errors':_0xbb1c0f[_0x372da4(0x207)](_0x372da4(0x219)),'role':_0xf87819,'profile':_0x229156,'warehouse':_0x195ebc,'product':_0x3fff8,'adjustment':_0x541191,'master_shop':_0xede650,'language':_0x2aa5e3});}catch(_0x3e7e39){console['log'](_0x3e7e39);}});async function getRandom8DigitNumber(){var _0x24eca7=a0_0x43870d;const _0x25764a=0x989680,_0x41f569=0x5f5e0ff,_0x4404fa=Math[_0x24eca7(0x249)](Math[_0x24eca7(0x216)]()*(_0x41f569-_0x25764a+0x1))+_0x25764a;var _0x302c34;const _0x279b92=await adjustment_finished[_0x24eca7(0x1c3)]({'invoice':_0x24eca7(0x24e)+_0x4404fa});return _0x279b92&&_0x279b92[_0x24eca7(0x22d)]>0x0?_0x302c34=_0x24eca7(0x24e)+_0x4404fa:_0x302c34=_0x24eca7(0x24e)+_0x4404fa,_0x302c34;}function a0_0x2da0(_0x153a69,_0x480472){var _0x2b4d06=a0_0x2b4d();return a0_0x2da0=function(_0x2da064,_0xef32e0){_0x2da064=_0x2da064-0x19e;var _0x3a6eac=_0x2b4d06[_0x2da064];return _0x3a6eac;},a0_0x2da0(_0x153a69,_0x480472);}router[a0_0x43870d(0x1ac)](a0_0x43870d(0x24b),auth,async(_0x4c4dc4,_0x4e1abf)=>{var _0x5da87a=a0_0x43870d;try{const {username:_0x48b40b,email:_0x1cb73b,role:_0x170f69}=_0x4c4dc4['user'],_0x116f87=_0x4c4dc4[_0x5da87a(0x24a)],_0x1e64b1=await profile[_0x5da87a(0x1c3)]({'email':_0x116f87[_0x5da87a(0x205)]}),_0xdf1960=await master_shop[_0x5da87a(0x1fc)]();let _0x57d163;if(_0x116f87['role']==_0x5da87a(0x21f)){const _0x5aa672=await staff[_0x5da87a(0x1c3)]({'email':_0x116f87[_0x5da87a(0x205)]});_0x57d163=await warehouse[_0x5da87a(0x25f)]([{'$match':{'status':_0x5da87a(0x1ad),'name':_0x5aa672[_0x5da87a(0x203)],'warehouse_category':_0x5da87a(0x22b),'name':{'$ne':_0x5da87a(0x1c4)}}},{'$group':{'_id':_0x5da87a(0x25c),'name':{'$first':_0x5da87a(0x25c)}}}]);}else _0x57d163=await warehouse[_0x5da87a(0x25f)]([{'$match':{'status':'Enabled','warehouse_category':_0x5da87a(0x22b),'name':{'$ne':_0x5da87a(0x1c4)}}},{'$group':{'_id':_0x5da87a(0x25c),'name':{'$first':_0x5da87a(0x25c)}}}]);const _0x203f4a=await product[_0x5da87a(0x1fc)]({}),_0x370190=await adjustment_finished[_0x5da87a(0x1fc)]({}),_0x431e22=_0x370190[_0x5da87a(0x22d)]+0x1,_0x45a5a5=_0x5da87a(0x24e)+_0x431e22[_0x5da87a(0x202)]()[_0x5da87a(0x20f)](0x5,'0');var _0x165129=[_0x5da87a(0x1ec),_0x5da87a(0x1d1),_0x5da87a(0x21a)];if(_0xdf1960[0x0]['language']==_0x5da87a(0x209))var _0x3969c9=users[_0x5da87a(0x260)];else{if(_0xdf1960[0x0][_0x5da87a(0x228)]==_0x5da87a(0x1e0))var _0x3969c9=users[_0x5da87a(0x1e0)];else{if(_0xdf1960[0x0][_0x5da87a(0x228)]==_0x5da87a(0x1b1))var _0x3969c9=users[_0x5da87a(0x1b1)];else{if(_0xdf1960[0x0]['language']==_0x5da87a(0x233))var _0x3969c9=users[_0x5da87a(0x233)];else{if(_0xdf1960[0x0][_0x5da87a(0x228)]=='French')var _0x3969c9=users[_0x5da87a(0x261)];else{if(_0xdf1960[0x0][_0x5da87a(0x228)]=='Portuguese\x20(BR)')var _0x3969c9=users[_0x5da87a(0x208)];else{if(_0xdf1960[0x0]['language']==_0x5da87a(0x234))var _0x3969c9=users[_0x5da87a(0x234)];else{if(_0xdf1960[0x0][_0x5da87a(0x228)]==_0x5da87a(0x20d))var _0x3969c9=users[_0x5da87a(0x1b7)];}}}}}}}const _0x35bc84=getRandom8DigitNumber();_0x35bc84[_0x5da87a(0x1cf)](_0x5deb71=>{var _0x55e7f6=_0x5da87a;_0x4e1abf[_0x55e7f6(0x23e)](_0x55e7f6(0x1e4),{'success':_0x4c4dc4[_0x55e7f6(0x207)](_0x55e7f6(0x262)),'errors':_0x4c4dc4[_0x55e7f6(0x207)]('errors'),'role':_0x116f87,'profile':_0x1e64b1,'warehouse':_0x57d163,'product':_0x203f4a,'master_shop':_0xdf1960,'language':_0x3969c9,'rooms_data':_0x165129,'invoice_no':_0x5deb71});})[_0x5da87a(0x255)](_0x470b4f=>{var _0x592d43=_0x5da87a;_0x4c4dc4[_0x592d43(0x207)](_0x592d43(0x219),_0x592d43(0x246)),_0x4e1abf[_0x592d43(0x1c8)](_0x592d43(0x238));});}catch(_0xf1eae){console[_0x5da87a(0x248)](_0xf1eae);}}),router[a0_0x43870d(0x1e5)](a0_0x43870d(0x24b),auth,async(_0xe0cb6a,_0x2c6202)=>{var _0x5a58f1=a0_0x43870d;try{const {warehouse_name:_0x3a5ad9,date:_0x25cd4a,prod_name:_0x18a8ea,level:_0x305c6e,isle:_0x8e4736,pallet:_0x2ac020,stock:_0x4a65d1,types:_0x19bc61,adjust_qty:_0x5e7a6c,new_adjust_qty:_0x2713d9,note:_0x40b81a,Room_name:_0x4929c7,invoice:_0x32aa28,JO_number:_0x535cd7,expiry_date:_0x66844e}=_0xe0cb6a[_0x5a58f1(0x1e2)];if(typeof _0x18a8ea==_0x5a58f1(0x1fb))var _0x2af8a0=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x25a)]],_0x49c064=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x256)]],_0x399815=[_0xe0cb6a['body'][_0x5a58f1(0x1b9)]],_0x1ce2fc=[_0xe0cb6a[_0x5a58f1(0x1e2)]['types']],_0x42af06=[_0xe0cb6a['body'][_0x5a58f1(0x232)]],_0x2d1674=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1dc)]],_0x5b11d4=[_0xe0cb6a['body'][_0x5a58f1(0x1c2)]],_0x4a53df=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1d9)]],_0x27e317=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x230)]],_0x14da9d=[_0xe0cb6a['body'][_0x5a58f1(0x253)]],_0x2c415b=[_0xe0cb6a['body'][_0x5a58f1(0x247)]],_0x549d13=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1fa)]],_0x521f82=[_0xe0cb6a['body'][_0x5a58f1(0x221)]],_0x3971d4=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x23c)]],_0x5b8072=[_0xe0cb6a[_0x5a58f1(0x1e2)]['maxPerUnit']],_0x36edf0=[_0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x22f)]];else var _0x2af8a0=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x25a)]],_0x49c064=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x256)]],_0x399815=[..._0xe0cb6a['body'][_0x5a58f1(0x1b9)]],_0x1ce2fc=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x201)]],_0x42af06=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x232)]],_0x2d1674=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1dc)]],_0x5b11d4=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1c2)]],_0x4a53df=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1d9)]],_0x27e317=[..._0xe0cb6a[_0x5a58f1(0x1e2)]['prod_code']],_0x14da9d=[..._0xe0cb6a[_0x5a58f1(0x1e2)]['batch_code']],_0x2c415b=[..._0xe0cb6a['body'][_0x5a58f1(0x247)]],_0x549d13=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x1fa)]],_0x521f82=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x221)]],_0x3971d4=[..._0xe0cb6a['body']['Rooms']],_0x5b8072=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x206)]],_0x36edf0=[..._0xe0cb6a[_0x5a58f1(0x1e2)][_0x5a58f1(0x22f)]];const _0x2321c3=_0x2af8a0['map'](_0x1a1e0d=>{return _0x1a1e0d={'product_name':_0x1a1e0d};});_0x49c064[_0x5a58f1(0x1f0)]((_0x4dbf90,_0x580a94)=>{var _0x3be524=_0x5a58f1;_0x2321c3[_0x580a94][_0x3be524(0x224)]=_0x4dbf90;}),_0x399815[_0x5a58f1(0x1f0)]((_0x41fa35,_0x144747)=>{_0x2321c3[_0x144747]['stockBefore']=_0x41fa35;}),_0x1ce2fc[_0x5a58f1(0x1f0)]((_0xb4ca87,_0x5071ae)=>{var _0x4308fc=_0x5a58f1;_0x2321c3[_0x5071ae][_0x4308fc(0x201)]=_0xb4ca87;}),_0x42af06[_0x5a58f1(0x1f0)]((_0x141ed2,_0x284c79)=>{var _0x341afd=_0x5a58f1;_0x2321c3[_0x284c79][_0x341afd(0x241)]=_0x141ed2;}),_0x2d1674['forEach']((_0x26220e,_0x49959d)=>{var _0x3a109e=_0x5a58f1;_0x2321c3[_0x49959d][_0x3a109e(0x1aa)]=_0x26220e;}),_0x5b11d4[_0x5a58f1(0x1f0)]((_0x5300b5,_0x32866c)=>{var _0x565c5c=_0x5a58f1;_0x2321c3[_0x32866c][_0x565c5c(0x23d)]=_0x5300b5;}),_0x4a53df['forEach']((_0x29124e,_0x558c16)=>{_0x2321c3[_0x558c16]['secondary_unit']=_0x29124e;}),_0x27e317[_0x5a58f1(0x1f0)]((_0x2ddf7f,_0x111bb5)=>{var _0x867ebc=_0x5a58f1;_0x2321c3[_0x111bb5][_0x867ebc(0x20b)]=_0x2ddf7f;}),_0x14da9d[_0x5a58f1(0x1f0)]((_0xaeb68f,_0x15113d)=>{_0x2321c3[_0x15113d]['batch_code']=_0xaeb68f;}),_0x2c415b[_0x5a58f1(0x1f0)]((_0x2e266f,_0x34a583)=>{var _0x29d211=_0x5a58f1;_0x2321c3[_0x34a583][_0x29d211(0x247)]=_0x2e266f;}),_0x549d13[_0x5a58f1(0x1f0)]((_0x915a68,_0x431cef)=>{var _0x47bb86=_0x5a58f1;_0x2321c3[_0x431cef][_0x47bb86(0x1d0)]=_0x915a68;}),_0x521f82[_0x5a58f1(0x1f0)]((_0x266db1,_0x3e50b5)=>{_0x2321c3[_0x3e50b5]['prod_cat']=_0x266db1;}),_0x3971d4[_0x5a58f1(0x1f0)]((_0x1a1068,_0x614721)=>{var _0x2b00e3=_0x5a58f1;_0x2321c3[_0x614721][_0x2b00e3(0x1cb)]=_0x1a1068;}),_0x5b8072[_0x5a58f1(0x1f0)]((_0x4ee0ed,_0x3ac498)=>{var _0x2a560d=_0x5a58f1;_0x2321c3[_0x3ac498][_0x2a560d(0x206)]=_0x4ee0ed;}),_0x36edf0['forEach']((_0x19be42,_0x36239f)=>{var _0x4f5726=_0x5a58f1;_0x2321c3[_0x36239f][_0x4f5726(0x1bf)]=_0x19be42;});const _0x379406=_0x2321c3[_0x5a58f1(0x1f9)](_0x3157b9=>_0x3157b9['adjust_qty']!=='0'&&_0x3157b9[_0x5a58f1(0x241)]!=='');var _0x58f8d8=0x0;_0x379406['forEach'](_0x202f01=>{var _0x44c5cf=_0x5a58f1;console['log']('foreach\x20newproduct',_0x202f01),parseInt(_0x202f01[_0x44c5cf(0x241)])<=0x0&&_0x58f8d8++;});if(_0x58f8d8!=0x0)return _0xe0cb6a[_0x5a58f1(0x207)](_0x5a58f1(0x219),_0x5a58f1(0x1c6)),_0x2c6202[_0x5a58f1(0x1c8)](_0x5a58f1(0x1ae));const _0x2ea24c=new adjustment_finished({'warehouse_name':_0x3a5ad9,'date':_0x25cd4a,'product':_0x379406,'note':_0x40b81a,'room':_0x4929c7,'invoice':_0x32aa28,'JO_number':_0x535cd7,'expiry_date':_0x66844e}),_0x15b8ca=await _0x2ea24c[_0x5a58f1(0x1d4)]();_0xe0cb6a[_0x5a58f1(0x207)](_0x5a58f1(0x262),_0x5a58f1(0x1ff)),_0x2c6202[_0x5a58f1(0x1c8)](_0x5a58f1(0x204)+_0x15b8ca[_0x5a58f1(0x1a4)]);}catch(_0x53b23e){console[_0x5a58f1(0x248)](_0x53b23e),_0x2c6202[_0x5a58f1(0x243)](0xc8)[_0x5a58f1(0x1b4)]({'message':_0x53b23e['message']});}}),router[a0_0x43870d(0x1ac)](a0_0x43870d(0x22c),auth,async(_0x3e5f65,_0x1d07da)=>{var _0x29c3f9=a0_0x43870d;try{const {username:_0x5d99b8,email:_0x1c14d3,role:_0x572921}=_0x3e5f65[_0x29c3f9(0x24a)],_0x2f09c3=_0x3e5f65[_0x29c3f9(0x24a)],_0x21b27b=await profile[_0x29c3f9(0x1c3)]({'email':_0x2f09c3['email']}),_0x4b14c2=await master_shop[_0x29c3f9(0x1fc)](),_0x3c8e5b=_0x3e5f65[_0x29c3f9(0x1df)]['id'],_0x379d52=await adjustment_finished[_0x29c3f9(0x1ab)]({'_id':_0x3c8e5b}),_0x4eaffd=await purchases[_0x29c3f9(0x25f)]([{'$match':{'warehouse_name':_0x379d52['warehouse_name']}},{'$unwind':_0x29c3f9(0x1e6)},{'$group':{'_id':_0x29c3f9(0x1c1)}}]);console[_0x29c3f9(0x248)](_0x29c3f9(0x1b8),_0x4eaffd);const _0x2a738a=await product[_0x29c3f9(0x1fc)]({}),_0xfe91bb=await warehouse[_0x29c3f9(0x25f)]([{'$match':{'name':_0x379d52[_0x29c3f9(0x210)],'warehouse_category':_0x29c3f9(0x22b)}},{'$unwind':_0x29c3f9(0x1de)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x29c3f9(0x1a5)},'bay':{'$first':_0x29c3f9(0x1ea)},'bin':{'$first':_0x29c3f9(0x259)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x29c3f9(0x222)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x29c3f9(0x225)},'product_code':{'$first':_0x29c3f9(0x1ee)},'storage':{'$first':_0x29c3f9(0x1f3)},'rack':{'$first':_0x29c3f9(0x1d2)},'expiry_date':{'$first':_0x29c3f9(0x211)},'production_date':{'$first':_0x29c3f9(0x1f7)},'batch_code':{'$first':_0x29c3f9(0x1a0)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x29c3f9(0x1d6)}}}]);if(_0x4b14c2[0x0][_0x29c3f9(0x228)]==_0x29c3f9(0x209)){var _0x2c6fe2=users['English'];console['log'](_0x2c6fe2);}else{if(_0x4b14c2[0x0][_0x29c3f9(0x228)]==_0x29c3f9(0x1e0))var _0x2c6fe2=users['Hindi'];else{if(_0x4b14c2[0x0][_0x29c3f9(0x228)]==_0x29c3f9(0x1b1))var _0x2c6fe2=users[_0x29c3f9(0x1b1)];else{if(_0x4b14c2[0x0]['language']=='Spanish')var _0x2c6fe2=users[_0x29c3f9(0x233)];else{if(_0x4b14c2[0x0]['language']=='French')var _0x2c6fe2=users[_0x29c3f9(0x261)];else{if(_0x4b14c2[0x0]['language']==_0x29c3f9(0x239))var _0x2c6fe2=users[_0x29c3f9(0x208)];else{if(_0x4b14c2[0x0][_0x29c3f9(0x228)]==_0x29c3f9(0x234))var _0x2c6fe2=users['Chinese'];else{if(_0x4b14c2[0x0][_0x29c3f9(0x228)]==_0x29c3f9(0x20d))var _0x2c6fe2=users[_0x29c3f9(0x1b7)];}}}}}}}_0x1d07da[_0x29c3f9(0x23e)](_0x29c3f9(0x223),{'success':_0x3e5f65[_0x29c3f9(0x207)](_0x29c3f9(0x262)),'errors':_0x3e5f65['flash'](_0x29c3f9(0x219)),'role':_0x2f09c3,'profile':_0x21b27b,'adjustment':_0x379d52,'stock':_0xfe91bb,'master_shop':_0x4b14c2,'warehouse_name':_0x4eaffd,'unit':_0x2a738a,'language':_0x2c6fe2});}catch(_0x13e7ba){console['log'](_0x13e7ba),_0x1d07da[_0x29c3f9(0x243)](0xc8)['json']({'message':_0x13e7ba['message']});}}),router[a0_0x43870d(0x1e5)]('/preview/:id',auth,async(_0x20f204,_0x257215)=>{var _0x4cd178=a0_0x43870d;try{const {invoice:_0x14701,warehouse_name:_0x11d029,Room_name:_0x542de5}=_0x20f204[_0x4cd178(0x1e2)],_0x16d3d4=_0x20f204[_0x4cd178(0x1df)]['id'],_0x22a7b1=await adjustment_finished['findById']({'_id':_0x16d3d4});var _0x2acc1c;const _0xb966=_0x22a7b1[_0x4cd178(0x213)]['map'](async _0x2a131b=>{var _0x58daaa=_0x4cd178;if(_0x2a131b[_0x58daaa(0x241)]>0x0){_0x2acc1c=await warehouse[_0x58daaa(0x1c3)]({'name':_0x11d029,'room':_0x2a131b['room_names'],'warehouse_category':_0x58daaa(0x22b)});const _0x1fe427=_0x2acc1c[_0x58daaa(0x19f)][_0x58daaa(0x1b5)](_0x48fddf=>{var _0x1097ae=_0x58daaa;console[_0x1097ae(0x248)](_0x2a131b['types']);if(_0x2a131b[_0x1097ae(0x201)]==_0x1097ae(0x258))_0x48fddf['product_name']==_0x2a131b['product_name']&&_0x48fddf['bay']==_0x2a131b[_0x1097ae(0x224)]&&_0x48fddf[_0x1097ae(0x247)]==_0x2a131b[_0x1097ae(0x247)]&&_0x48fddf[_0x1097ae(0x1d0)]==_0x2a131b['production_date']&&_0x48fddf['batch_code']==_0x2a131b[_0x1097ae(0x253)]&&_0x48fddf['invoice']==_0x2a131b['invoice']&&(_0x48fddf[_0x1097ae(0x1ce)]=_0x48fddf['product_stock']-_0x2a131b[_0x1097ae(0x241)]);else _0x2a131b[_0x1097ae(0x201)]=='add'&&(_0x48fddf[_0x1097ae(0x1c5)]==_0x2a131b[_0x1097ae(0x1c5)]&&_0x48fddf['bay']==_0x2a131b['bay']&&_0x48fddf[_0x1097ae(0x247)]==_0x2a131b[_0x1097ae(0x247)]&&_0x48fddf[_0x1097ae(0x1d0)]==_0x2a131b[_0x1097ae(0x1d0)]&&_0x48fddf[_0x1097ae(0x253)]==_0x2a131b[_0x1097ae(0x253)]&&_0x48fddf[_0x1097ae(0x1bf)]==_0x2a131b[_0x1097ae(0x1bf)]&&(_0x48fddf[_0x1097ae(0x1ce)]=_0x48fddf[_0x1097ae(0x1ce)]+_0x2a131b['adjust_qty']));});}return _0x2acc1c;});Promise[_0x4cd178(0x254)](_0xb966)['then'](async _0x42838d=>{var _0x126f13=_0x4cd178;try{for(const _0x5bddc3 of _0x42838d){await _0x5bddc3[_0x126f13(0x1d4)]();}_0x22a7b1[_0x126f13(0x1cd)]=_0x126f13(0x1b2);const _0x3932b6=await _0x22a7b1[_0x126f13(0x1d4)](),_0x1a749d=await master_shop[_0x126f13(0x1fc)](),_0x1819de=await email_settings[_0x126f13(0x1c3)](),_0x5dd425=await supervisor_settings[_0x126f13(0x1fc)]();var _0x3effa2=_0x22a7b1['product'],_0x1cb89b='',_0x4d2bdd;for(_0x4d2bdd in _0x3effa2){var _0x5d2401='FG';_0x22a7b1['warehouse_name']=='DRY\x20GOODS'&&(_0x5d2401='DG'),_0x1cb89b+=_0x126f13(0x24c)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3effa2[_0x4d2bdd][_0x126f13(0x1c5)]+_0x126f13(0x1b0)+_0x126f13(0x1fd)+_0x3effa2[_0x4d2bdd][_0x126f13(0x20b)]+_0x126f13(0x1b0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3effa2[_0x4d2bdd][_0x126f13(0x241)]+_0x126f13(0x1b0)+_0x126f13(0x1fd)+_0x3effa2[_0x4d2bdd]['unit']+_0x126f13(0x1b0)+_0x126f13(0x1fd)+_0x3effa2[_0x4d2bdd][_0x126f13(0x21e)]+_0x126f13(0x1b0)+_0x126f13(0x1fd)+_0x22a7b1['warehouse_name']+_0x126f13(0x1b0)+_0x126f13(0x1fd)+_0x3effa2[_0x4d2bdd][_0x126f13(0x1cb)]+_0x126f13(0x1b0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5d2401+_0x3effa2[_0x4d2bdd][_0x126f13(0x224)]+'</td>'+_0x126f13(0x1f5);}let _0x410c1b=nodemailer[_0x126f13(0x1d7)]({'host':_0x1819de['host'],'port':Number(_0x1819de[_0x126f13(0x1b3)]),'secure':![],'auth':{'user':_0x1819de[_0x126f13(0x205)],'pass':_0x1819de[_0x126f13(0x1af)]}}),_0x45c1ea={'from':_0x1819de['email'],'to':_0x5dd425[0x0][_0x126f13(0x21c)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x126f13(0x229),'path':__dirname+_0x126f13(0x20e)+_0x126f13(0x240)+_0x1a749d[0x0][_0x126f13(0x1a3)],'cid':_0x126f13(0x25b)}],'html':'<!DOCTYPE\x20html>'+_0x126f13(0x1e7)+_0x126f13(0x1a2)+_0x126f13(0x220)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x126f13(0x220)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x126f13(0x1a1)+'<div>'+'<h2>\x20'+_0x1a749d[0x0]['site_title']+_0x126f13(0x227)+_0x126f13(0x1a1)+_0x126f13(0x1a1)+_0x126f13(0x1f4)+_0x126f13(0x220)+_0x126f13(0x22a)+_0x126f13(0x214)+_0x22a7b1['invoice']+'\x20'+_0x126f13(0x25d)+'\x20Order\x20Date\x20:\x20'+_0x22a7b1[_0x126f13(0x1d8)]+'\x20'+_0x126f13(0x1a9)+'</h5>'+_0x126f13(0x1a1)+_0x126f13(0x24d)+_0x126f13(0x1bd)+'<tr>'+_0x126f13(0x1cc)+_0x126f13(0x252)+_0x126f13(0x257)+_0x126f13(0x215)+_0x126f13(0x1da)+_0x126f13(0x218)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x126f13(0x1eb)+_0x126f13(0x1f5)+'</thead>'+_0x126f13(0x217)+'\x20'+_0x1cb89b+'\x20'+'</tbody>'+_0x126f13(0x231)+_0x126f13(0x220)+_0x126f13(0x250)+_0x126f13(0x23b)+_0x1a749d[0x0][_0x126f13(0x1a6)]+_0x126f13(0x242)+_0x126f13(0x1a1)+_0x126f13(0x1a1)+_0x126f13(0x25e)};_0x410c1b[_0x126f13(0x1ca)](_0x45c1ea,function(_0x50cb67,_0x4b90fb){var _0x3ef6dd=_0x126f13;_0x50cb67?(console['log'](_0x50cb67),console[_0x3ef6dd(0x248)](_0x3ef6dd(0x251))):console['log']('Email\x20sent\x20successfully');}),_0x20f204[_0x126f13(0x207)](_0x126f13(0x262),'Adjustment\x20Finalize\x20Successfully'),_0x257215['redirect']('/picking_list/PDF_adjustment/'+_0x3932b6[_0x126f13(0x1a4)]);}catch(_0x562177){console['error'](_0x562177),_0x257215[_0x126f13(0x243)](0x1f4)[_0x126f13(0x1b4)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x4cd178(0x255)](_0x280119=>{var _0x5569be=_0x4cd178;console['error'](_0x280119),_0x257215[_0x5569be(0x243)](0x1f4)[_0x5569be(0x1b4)]({'error':'An\x20error\x20occurred.'});});}catch(_0x4a7b60){_0x257215[_0x4cd178(0x1b4)]({'message':_0x4a7b60[_0x4cd178(0x1f8)]});}}),router[a0_0x43870d(0x1ac)](a0_0x43870d(0x1ba),auth,async(_0x15d8ee,_0x57fecb)=>{var _0x11ee4e=a0_0x43870d;try{const {username:_0x24ef0e,email:_0x8c4c27,role:_0x51a3e4}=_0x15d8ee[_0x11ee4e(0x24a)],_0x120092=_0x15d8ee[_0x11ee4e(0x24a)],_0x32b939=await profile[_0x11ee4e(0x1c3)]({'email':_0x120092[_0x11ee4e(0x205)]}),_0x3d90df=await master_shop[_0x11ee4e(0x1fc)]();console[_0x11ee4e(0x248)](_0x11ee4e(0x20a),_0x3d90df);const _0x1310ba=_0x15d8ee['params']['id'],_0x4a4bf2=await adjustment_finished[_0x11ee4e(0x1ab)]({'_id':_0x1310ba});let _0x4b7130=new Date(_0x4a4bf2[_0x11ee4e(0x247)]),_0x5db5ed=('0'+_0x4b7130['getDate']())[_0x11ee4e(0x226)](-0x2),_0x5c62fc=('0'+(_0x4b7130[_0x11ee4e(0x1e9)]()+0x1))[_0x11ee4e(0x226)](-0x2),_0xd49498=_0x4b7130['getFullYear'](),_0x520318=_0xd49498+'-'+_0x5c62fc+'-'+_0x5db5ed;var _0x8fd022=['Ambient',_0x11ee4e(0x1d1),_0x11ee4e(0x21a)];const _0x1ac144=await purchases['aggregate']([{'$match':{'warehouse_name':_0x4a4bf2[_0x11ee4e(0x210)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x11ee4e(0x248)](_0x11ee4e(0x1b8),_0x1ac144);const _0x5c3c10=await product[_0x11ee4e(0x1fc)]({}),_0x4273fe=await warehouse[_0x11ee4e(0x25f)]([{'$match':{'name':_0x4a4bf2[_0x11ee4e(0x210)],'room':_0x4a4bf2[_0x11ee4e(0x21b)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x11ee4e(0x235),'name':{'$first':_0x11ee4e(0x1e8)},'product_stock':{'$first':_0x11ee4e(0x1a5)},'bay':{'$first':_0x11ee4e(0x1ea)},'bin':{'$first':_0x11ee4e(0x259)},'type':{'$first':_0x11ee4e(0x20c)},'floorlevel':{'$first':_0x11ee4e(0x222)},'primary_code':{'$first':_0x11ee4e(0x1fe)},'secondary_code':{'$first':_0x11ee4e(0x225)},'product_code':{'$first':_0x11ee4e(0x1ee)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x11ee4e(0x1d2)}}}]);if(_0x3d90df[0x0][_0x11ee4e(0x228)]==_0x11ee4e(0x209)){var _0x1f66d1=users[_0x11ee4e(0x260)];console[_0x11ee4e(0x248)](_0x1f66d1);}else{if(_0x3d90df[0x0]['language']=='Hindi')var _0x1f66d1=users[_0x11ee4e(0x1e0)];else{if(_0x3d90df[0x0][_0x11ee4e(0x228)]==_0x11ee4e(0x1b1))var _0x1f66d1=users[_0x11ee4e(0x1b1)];else{if(_0x3d90df[0x0][_0x11ee4e(0x228)]=='Spanish')var _0x1f66d1=users[_0x11ee4e(0x233)];else{if(_0x3d90df[0x0][_0x11ee4e(0x228)]=='French')var _0x1f66d1=users['French'];else{if(_0x3d90df[0x0][_0x11ee4e(0x228)]==_0x11ee4e(0x239))var _0x1f66d1=users['Portuguese'];else{if(_0x3d90df[0x0][_0x11ee4e(0x228)]=='Chinese')var _0x1f66d1=users['Chinese'];else{if(_0x3d90df[0x0][_0x11ee4e(0x228)]==_0x11ee4e(0x20d))var _0x1f66d1=users[_0x11ee4e(0x1b7)];}}}}}}}_0x57fecb[_0x11ee4e(0x23e)](_0x11ee4e(0x1a7),{'success':_0x15d8ee[_0x11ee4e(0x207)](_0x11ee4e(0x262)),'errors':_0x15d8ee['flash'](_0x11ee4e(0x219)),'role':_0x120092,'profile':_0x32b939,'adjustment':_0x4a4bf2,'stock':_0x4273fe,'master_shop':_0x3d90df,'warehouse_name':_0x1ac144,'unit':_0x5c3c10,'language':_0x1f66d1,'rooms_data':_0x8fd022,'ed_fullDate':_0x520318});}catch(_0x311fb2){console[_0x11ee4e(0x248)](_0x311fb2),_0x57fecb[_0x11ee4e(0x243)](0xc8)[_0x11ee4e(0x1b4)]({'message':_0x311fb2[_0x11ee4e(0x1f8)]});}}),router[a0_0x43870d(0x1e5)](a0_0x43870d(0x1ba),auth,async(_0x465631,_0x3b9237)=>{var _0xe516a2=a0_0x43870d;try{const _0x37fe45=_0x465631[_0xe516a2(0x1df)]['id'],_0x200171=await adjustment_finished['findById']({'_id':_0x37fe45}),_0xe7c81e=await warehouse[_0xe516a2(0x1c3)]({'name':_0x200171['warehouse_name'],'room':_0x200171[_0xe516a2(0x21b)]}),{warehouse_name:_0x3cc8c1,date:_0x417f95,prod_name:_0x32dc1e,level:_0x2fc7b1,isle:_0x1265de,pallet:_0x56ea20,stock:_0x395688,types:_0x5251d5,adjust_qty:_0x4cdbb0,new_adjust_qty:_0x4d4e05,note:_0x37247c,Room_name:_0x10a52a,invoice:_0x3114e9,JO_number:_0x28a1cf}=_0x465631[_0xe516a2(0x1e2)];if(typeof _0x32dc1e==_0xe516a2(0x1fb))var _0x4c397e=[_0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x25a)]],_0x4585e9=[_0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x256)]],_0x58fb02=[_0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x1b9)]],_0x3a9036=[_0x465631['body']['types']],_0x2dfe50=[_0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x241)]],_0x2a4a3e=[_0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x1aa)]],_0x5b69c0=[_0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x230)]],_0x39c54a=[_0x465631[_0xe516a2(0x1e2)]['unit']],_0x25ab3b=[_0x465631['body'][_0xe516a2(0x1d9)]],_0x44a01d=[_0x465631[_0xe516a2(0x1e2)]['batch_code']],_0x4ada13=[_0x465631[_0xe516a2(0x1e2)]['expiry_date']];else var _0x4c397e=[..._0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x25a)]],_0x4585e9=[..._0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x256)]],_0x58fb02=[..._0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x1b9)]],_0x3a9036=[..._0x465631[_0xe516a2(0x1e2)]['types']],_0x2dfe50=[..._0x465631[_0xe516a2(0x1e2)]['adjust_qty']],_0x2a4a3e=[..._0x465631['body'][_0xe516a2(0x1aa)]],_0x5b69c0=[..._0x465631['body']['prod_code']],_0x39c54a=[..._0x465631[_0xe516a2(0x1e2)][_0xe516a2(0x23d)]],_0x25ab3b=[..._0x465631[_0xe516a2(0x1e2)]['Secondary_units']],_0x44a01d=[..._0x465631['body'][_0xe516a2(0x253)]],_0x4ada13=[..._0x465631['body'][_0xe516a2(0x247)]];const _0x3156fe=_0x4c397e[_0xe516a2(0x1b5)](_0x4a6e7b=>{return _0x4a6e7b={'product_name':_0x4a6e7b};});_0x4585e9[_0xe516a2(0x1f0)]((_0x3713e0,_0x280878)=>{var _0x176d63=_0xe516a2;_0x3156fe[_0x280878][_0x176d63(0x224)]=_0x3713e0;}),_0x58fb02[_0xe516a2(0x1f0)]((_0x491dcd,_0x5a5904)=>{var _0x299ad6=_0xe516a2;_0x3156fe[_0x5a5904][_0x299ad6(0x1ef)]=_0x491dcd;}),_0x3a9036[_0xe516a2(0x1f0)]((_0x2b3588,_0x259b0b)=>{var _0x1e1933=_0xe516a2;_0x3156fe[_0x259b0b][_0x1e1933(0x201)]=_0x2b3588;}),_0x2dfe50[_0xe516a2(0x1f0)]((_0x3f3a43,_0x51e47a)=>{var _0x14f036=_0xe516a2;_0x3156fe[_0x51e47a][_0x14f036(0x241)]=_0x3f3a43;}),_0x2a4a3e['forEach']((_0x377f83,_0x6fd766)=>{var _0x49738e=_0xe516a2;_0x3156fe[_0x6fd766][_0x49738e(0x1aa)]=_0x377f83;}),_0x39c54a[_0xe516a2(0x1f0)]((_0x546e70,_0x4d40a3)=>{var _0x1476a5=_0xe516a2;_0x3156fe[_0x4d40a3][_0x1476a5(0x23d)]=_0x546e70;}),_0x25ab3b[_0xe516a2(0x1f0)]((_0x593476,_0x2c6bab)=>{var _0x3606f8=_0xe516a2;_0x3156fe[_0x2c6bab][_0x3606f8(0x21e)]=_0x593476;}),_0x5b69c0[_0xe516a2(0x1f0)]((_0x42377f,_0x2359f6)=>{var _0x57c65=_0xe516a2;_0x3156fe[_0x2359f6][_0x57c65(0x20b)]=_0x42377f;}),_0x44a01d[_0xe516a2(0x1f0)]((_0x24aa28,_0x229c28)=>{_0x3156fe[_0x229c28]['batch_code']=_0x24aa28;}),_0x4ada13['forEach']((_0x2514da,_0x17f660)=>{var _0x413fef=_0xe516a2;_0x3156fe[_0x17f660][_0x413fef(0x247)]=_0x2514da;});const _0x1ed8e9=_0x3156fe['filter'](_0x2f38f3=>_0x2f38f3[_0xe516a2(0x241)]!=='0'&&_0x2f38f3['adjust_qty']!=='');var _0x202e6d=0x0;_0x1ed8e9[_0xe516a2(0x1f0)](_0x54a3d7=>{var _0x3fd998=_0xe516a2;console[_0x3fd998(0x248)]('foreach\x20newproduct',_0x54a3d7),parseInt(_0x54a3d7[_0x3fd998(0x241)])<=0x0&&_0x202e6d++;});if(_0x202e6d!=0x0)return _0x465631[_0xe516a2(0x207)](_0xe516a2(0x219),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x3b9237[_0xe516a2(0x1c8)](_0xe516a2(0x1ae));_0x200171[_0xe516a2(0x210)]=_0x3cc8c1,_0x200171['date']=_0x417f95,_0x200171[_0xe516a2(0x213)]=_0x1ed8e9,_0x200171[_0xe516a2(0x1c0)]=_0x37247c,_0x200171['room']=_0x10a52a,_0x200171[_0xe516a2(0x1bf)]=_0x3114e9,_0x200171[_0xe516a2(0x245)]=_0x28a1cf;const _0x2a29c0=await _0x200171[_0xe516a2(0x1d4)](),_0x3092d1=await warehouse[_0xe516a2(0x1c3)]({'name':_0x3cc8c1,'room':_0x10a52a});_0x2a29c0[_0xe516a2(0x213)][_0xe516a2(0x1f0)](_0x2e78f7=>{var _0x13f266=_0xe516a2;const _0x5be06d=_0x3092d1[_0x13f266(0x19f)]['map'](_0x2d2ac4=>{var _0x56d973=_0x13f266;_0x2e78f7[_0x56d973(0x201)]==_0x56d973(0x258)?_0x2d2ac4[_0x56d973(0x1c5)]==_0x2e78f7[_0x56d973(0x1c5)]&&_0x2d2ac4[_0x56d973(0x224)]==_0x2e78f7[_0x56d973(0x224)]&&(_0x2d2ac4[_0x56d973(0x1ce)]=parseInt(_0x2d2ac4['product_stock'])-parseInt(_0x2e78f7[_0x56d973(0x241)])):_0x2d2ac4[_0x56d973(0x1c5)]==_0x2e78f7[_0x56d973(0x1c5)]&&_0x2d2ac4[_0x56d973(0x224)]==_0x2e78f7['bay']&&(_0x2d2ac4[_0x56d973(0x1ce)]=parseInt(_0x2d2ac4[_0x56d973(0x1ce)])+parseInt(_0x2e78f7[_0x56d973(0x241)]));});}),await _0x3092d1[_0xe516a2(0x1d4)](),_0x465631['flash'](_0xe516a2(0x262),'adjustment\x20data\x20update\x20successfully'),_0x3b9237[_0xe516a2(0x1c8)](_0xe516a2(0x21d));}catch(_0x40726e){console[_0xe516a2(0x248)](_0x40726e);}}),router[a0_0x43870d(0x1e5)](a0_0x43870d(0x1d3),async(_0x243507,_0x1a7c0b)=>{var _0x11a331=a0_0x43870d;const {primary_code:_0x3b0b67,warehouse_data:_0x42ace7,rooms_data:_0x2c9cbd,Roomslist:_0x3dad2a}=_0x243507['body'],_0x2757ba=_0x3dad2a['split'](','),_0x246f5c=[];async function _0x3aabd0(_0x43a7d6){var _0x1a8d2a=a0_0x2da0;const _0x21abe2=await warehouse[_0x1a8d2a(0x25f)]([{'$match':{'name':_0x42ace7,'room':_0x43a7d6}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x3b0b67}},{'$group':{'_id':_0x1a8d2a(0x235),'name':{'$first':_0x1a8d2a(0x1e8)},'product_stock':{'$first':_0x1a8d2a(0x1a5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1a8d2a(0x1ee)},'level':{'$first':_0x1a8d2a(0x1ea)},'isle':{'$first':_0x1a8d2a(0x259)},'type':{'$first':_0x1a8d2a(0x20c)},'pallet':{'$first':_0x1a8d2a(0x222)},'unit':{'$first':_0x1a8d2a(0x1f6)},'secondary_unit':{'$first':_0x1a8d2a(0x1c7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1a8d2a(0x1d2)},'expiry_date':{'$first':_0x1a8d2a(0x211)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x1a8d2a(0x200)},'roomNamed':{'$first':_0x1a8d2a(0x1d6)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x36832f=await warehouse[_0x1a8d2a(0x25f)]([{'$match':{'name':_0x42ace7,'room':_0x43a7d6}},{'$unwind':_0x1a8d2a(0x1de)},{'$match':{'product_details.secondary_code':_0x3b0b67}},{'$group':{'_id':_0x1a8d2a(0x235),'name':{'$first':_0x1a8d2a(0x1e8)},'product_stock':{'$first':_0x1a8d2a(0x1a5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1a8d2a(0x225)},'product_code':{'$first':_0x1a8d2a(0x1ee)},'level':{'$first':_0x1a8d2a(0x1ea)},'isle':{'$first':_0x1a8d2a(0x259)},'type':{'$first':_0x1a8d2a(0x20c)},'pallet':{'$first':_0x1a8d2a(0x222)},'unit':{'$first':_0x1a8d2a(0x1f6)},'secondary_unit':{'$first':_0x1a8d2a(0x1c7)},'storage':{'$first':_0x1a8d2a(0x1f3)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1a8d2a(0x211)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1a8d2a(0x1a0)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x1a8d2a(0x200)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1a8d2a(0x1ed)}}}]);if(_0x21abe2[_0x1a8d2a(0x22d)]>0x0)_0x246f5c[_0x1a8d2a(0x1a8)](_0x21abe2);else _0x36832f['length']>0x0&&_0x246f5c[_0x1a8d2a(0x1a8)](_0x36832f);}const _0x5d4b84=_0x2757ba[_0x11a331(0x1b5)](_0x1023fe=>_0x3aabd0(_0x1023fe));await Promise[_0x11a331(0x254)](_0x5d4b84),_0x1a7c0b[_0x11a331(0x1b4)](_0x246f5c);}),router['post'](a0_0x43870d(0x1db),async(_0x5f5686,_0x4b2b5d)=>{var _0x3ec887=a0_0x43870d;const {productCode:_0xdaa5b7,bay:_0x5bd52f,warehouses:_0x4f9edf,room:_0x19bf60}=_0x5f5686['body'];console[_0x3ec887(0x248)](_0x5f5686[_0x3ec887(0x1e2)]);try{const _0x399140=await warehouse['aggregate']([{'$match':{'name':_0x4f9edf,'room':_0x19bf60}},{'$unwind':_0x3ec887(0x1de)},{'$match':{'product_details.bay':parseInt(_0x5bd52f)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3ec887(0x1e8)},'product_stock':{'$first':_0x3ec887(0x1a5)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x3ec887(0x1e1)}}}]);_0x4b2b5d[_0x3ec887(0x243)](0xc8)[_0x3ec887(0x1b4)](_0x399140);}catch(_0x30a956){_0x4b2b5d[_0x3ec887(0x243)](0x194)[_0x3ec887(0x1b4)]({'message':_0x30a956[_0x3ec887(0x1f8)]});}}),module[a0_0x43870d(0x244)]=router;