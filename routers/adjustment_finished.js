var a0_0x2e3bee=a0_0x28ce;function a0_0x28ce(_0x1d95de,_0x3601a0){var _0xf5c687=a0_0xf5c6();return a0_0x28ce=function(_0x28ce44,_0x31358c){_0x28ce44=_0x28ce44-0x98;var _0x5f177f=_0xf5c687[_0x28ce44];return _0x5f177f;},a0_0x28ce(_0x1d95de,_0x3601a0);}(function(_0x17e47a,_0x2f9c52){var _0x1c4086=a0_0x28ce,_0x611ddc=_0x17e47a();while(!![]){try{var _0x19440d=-parseInt(_0x1c4086(0xe6))/0x1*(-parseInt(_0x1c4086(0xd3))/0x2)+-parseInt(_0x1c4086(0x131))/0x3+-parseInt(_0x1c4086(0xf9))/0x4*(-parseInt(_0x1c4086(0x112))/0x5)+parseInt(_0x1c4086(0xc6))/0x6+-parseInt(_0x1c4086(0x149))/0x7+-parseInt(_0x1c4086(0xfc))/0x8*(parseInt(_0x1c4086(0xe7))/0x9)+-parseInt(_0x1c4086(0xca))/0xa*(-parseInt(_0x1c4086(0xb1))/0xb);if(_0x19440d===_0x2f9c52)break;else _0x611ddc['push'](_0x611ddc['shift']());}catch(_0x3a4800){_0x611ddc['push'](_0x611ddc['shift']());}}}(a0_0xf5c6,0x5aa26));const express=require(a0_0x2e3bee(0x143)),app=express(),router=express['Router'](),auth=require(a0_0x2e3bee(0x12d)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x2e3bee(0x13d)),users=require('../public/language/languages.json'),nodemailer=require('nodemailer');router[a0_0x2e3bee(0xf4)](a0_0x2e3bee(0x101),auth,async(_0xb9b6c9,_0x22f953)=>{var _0x3a49b1=a0_0x2e3bee;try{const {username:_0x49b461,email:_0x200f4b,role:_0x221b35}=_0xb9b6c9['user'],_0x34ef7f=_0xb9b6c9[_0x3a49b1(0xfa)],_0x5e017e=await profile[_0x3a49b1(0xdc)]({'email':_0x34ef7f['email']}),_0x19bf4f=await master_shop['find']();let _0x547efd;if(_0x34ef7f[_0x3a49b1(0xa0)]==_0x3a49b1(0x119)){const _0x3956fe=await staff[_0x3a49b1(0xdc)]({'email':_0x34ef7f['email']});_0x547efd=await warehouse['find']({'status':'Enabled','name':_0x3956fe[_0x3a49b1(0x146)]});}else _0x547efd=await warehouse[_0x3a49b1(0x124)]({'status':_0x3a49b1(0x134)});const _0x24d41b=await product['find']();let _0x37816d;if(_0x34ef7f[_0x3a49b1(0xa0)]==_0x3a49b1(0x119)){const _0xcdfb18=await staff[_0x3a49b1(0xdc)]({'email':_0x34ef7f['email']});_0x37816d=await adjustment_finished[_0x3a49b1(0x124)]({'warehouse_name':_0xcdfb18[_0x3a49b1(0x146)]});}else _0x37816d=await adjustment_finished[_0x3a49b1(0xab)]([{'$unwind':_0x3a49b1(0x9b)},{'$group':{'_id':_0x3a49b1(0x11e),'invoice':{'$first':'$invoice'},'date':{'$first':_0x3a49b1(0x111)},'warehouse_name':{'$first':_0x3a49b1(0x11d)},'room':{'$addToSet':_0x3a49b1(0x145)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x19bf4f[0x0][_0x3a49b1(0xaf)]==_0x3a49b1(0xed)){var _0x2c070b=users['English'];console[_0x3a49b1(0xea)](_0x2c070b);}else{if(_0x19bf4f[0x0]['language']==_0x3a49b1(0x15d))var _0x2c070b=users[_0x3a49b1(0x15d)];else{if(_0x19bf4f[0x0][_0x3a49b1(0xaf)]==_0x3a49b1(0xbb))var _0x2c070b=users[_0x3a49b1(0xbb)];else{if(_0x19bf4f[0x0]['language']==_0x3a49b1(0x10b))var _0x2c070b=users['Spanish'];else{if(_0x19bf4f[0x0][_0x3a49b1(0xaf)]==_0x3a49b1(0x106))var _0x2c070b=users[_0x3a49b1(0x106)];else{if(_0x19bf4f[0x0][_0x3a49b1(0xaf)]=='Portuguese\x20(BR)')var _0x2c070b=users[_0x3a49b1(0xf6)];else{if(_0x19bf4f[0x0]['language']==_0x3a49b1(0x9d))var _0x2c070b=users[_0x3a49b1(0x9d)];else{if(_0x19bf4f[0x0][_0x3a49b1(0xaf)]=='Arabic\x20(ae)')var _0x2c070b=users[_0x3a49b1(0xb9)];}}}}}}}_0x22f953[_0x3a49b1(0xf5)](_0x3a49b1(0xc0),{'success':_0xb9b6c9[_0x3a49b1(0x129)](_0x3a49b1(0xa8)),'errors':_0xb9b6c9[_0x3a49b1(0x129)](_0x3a49b1(0xae)),'role':_0x34ef7f,'profile':_0x5e017e,'warehouse':_0x547efd,'product':_0x24d41b,'adjustment':_0x37816d,'master_shop':_0x19bf4f,'language':_0x2c070b});}catch(_0x12324b){console[_0x3a49b1(0xea)](_0x12324b);}});function a0_0xf5c6(){var _0x28ad28=['warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','then','3046799hqcCGn','sendMail','push','$product_details.type','unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','new_adjust_qty','product_stock','$room','room','$product_details.production_date','length','bay','split','/adjustment/view','back','Error\x20Occurs','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','batch_code','edit_adjustment_finished','Hindi','<!DOCTYPE\x20html>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_unit','save','prod_cat','body','$product_details.floorlevel','/../public','prod_invoice','$product','json','Chinese','error','adjustment\x20data\x20update\x20successfully','role','getDate','product','</tbody>','<span\x20style=\x22float:\x20right;\x22>','floor','New_Qty_Converted_adj','<tr>','success','adjustment\x20add\x20successfull','$product_details.expiry_date','aggregate','port','$product_details.storage','errors','language','<h5\x20style=\x22text-align:\x20left;\x22>','11QzkOSQ','$product_details.product_name','New_Qty_Converted','$product_details.rack','$product_details.product_code','catch','$name','site_title','Arabic','DRY\x20GOODS','German','</h5>','$product_details.unit','<div>','product_details','adjustment_finished','forEach','</div>','$product_details.primary_code','foreach\x20newproduct','</head><body>','1288302hVvwHj','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','An\x20error\x20occurred.','getMonth','8393170dFZhek','createTransport','prod_name','purchases_data','params','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','random','master','all','4isWIyw','</table>','note','$product.product_name','status','FGSEmail','$product_details.product_stock','minus','/preview/:id','findOne','Ambient','<html><head><title></title>','/view/add_adjustment','/adjustment_finished/preview/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','QA\x20Warehouse','$product_details.bin','<h5>','edit_adjustment_finished_view','124993diEThH','3789iyeafp','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','product_code','log','</tr>','$product_details.bay','English\x20(US)','production_date','filter','slice','Return\x20Rooms','English','Finished\x20Goods','get','render','Portuguese','level','prod_code','1453220kYSsye','user','map','3576GKUNau','Adjustment\x20Finalize\x20Successfully','add','product_name','_id','/view','findById','Primary_Units','$product_details.secondary_unit','host','French','string','$product_details.secondary_code','$product_details','JO_number','Spanish','expiry_date','</td>','/view/:id','stockBefore','</thead>','$date','5njKTTH','post','<table\x20style=\x22width:\x20100%\x20!important;\x22>','exports','$product_details._id','date','room_names','staff','Logo.png','message','<tbody\x20style=\x22text-align:\x20center;\x22>','$warehouse_name','$_id','Secondary_units','$product_details.maxPerUnit','invoice','\x20Order\x20Number\x20:\x20','adjust_qty','find','Adjustment\x20Mail','email','$product_details.maxProducts','add_adjustment_finished','flash','stock','Enclosed','image','../middleware/auth','ADJF-','maxPerUnit','padStart','2017929YvUtqc','/picking_list/PDF_adjustment/','redirect','Enabled','/adjustment_finished/view','types','product_date','\x20</h2>','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','</body></html>','../models/all_models','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.batch_code','Portuguese\x20(BR)','<strong>\x20Regards\x20</strong>','express','Arabic\x20(ae)','$product.room_names'];a0_0xf5c6=function(){return _0x28ad28;};return a0_0xf5c6();}async function getRandom8DigitNumber(){var _0x26645f=a0_0x2e3bee;const _0x267407=0x989680,_0x258da5=0x5f5e0ff,_0x182968=Math[_0x26645f(0xa5)](Math[_0x26645f(0xd0)]()*(_0x258da5-_0x267407+0x1))+_0x267407;var _0x14c1bc;const _0x4883e0=await adjustment_finished[_0x26645f(0xdc)]({'invoice':_0x26645f(0x12e)+_0x182968});return _0x4883e0&&_0x4883e0[_0x26645f(0x154)]>0x0?_0x14c1bc='ADJF-'+_0x182968:_0x14c1bc=_0x26645f(0x12e)+_0x182968,_0x14c1bc;}router[a0_0x2e3bee(0xf4)](a0_0x2e3bee(0xdf),auth,async(_0x495717,_0x43eaf8)=>{var _0x1a84b3=a0_0x2e3bee;try{const {username:_0x4be3d0,email:_0x3b4278,role:_0x31b91b}=_0x495717[_0x1a84b3(0xfa)],_0x1bd199=_0x495717[_0x1a84b3(0xfa)],_0x4ab944=await profile['findOne']({'email':_0x1bd199[_0x1a84b3(0x126)]}),_0x28e2cd=await master_shop['find']();let _0xef20be;if(_0x1bd199[_0x1a84b3(0xa0)]=='staff'){const _0x2a551b=await staff[_0x1a84b3(0xdc)]({'email':_0x1bd199[_0x1a84b3(0x126)]});_0xef20be=await warehouse['aggregate']([{'$match':{'status':_0x1a84b3(0x134),'name':_0x2a551b[_0x1a84b3(0x146)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1a84b3(0xb7),'name':{'$first':'$name'}}}]);}else _0xef20be=await warehouse[_0x1a84b3(0xab)]([{'$match':{'status':_0x1a84b3(0x134),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x1a84b3(0xe2)}}},{'$group':{'_id':_0x1a84b3(0xb7),'name':{'$first':_0x1a84b3(0xb7)}}}]);const _0x8602dc=await product[_0x1a84b3(0x124)]({}),_0xe0456f=await adjustment_finished[_0x1a84b3(0x124)]({}),_0x33c6ac=_0xe0456f[_0x1a84b3(0x154)]+0x1,_0x40a117=_0x1a84b3(0x12e)+_0x33c6ac['toString']()[_0x1a84b3(0x130)](0x5,'0');var _0x586884=[_0x1a84b3(0xdd),'Enclosed',_0x1a84b3(0xf1)];if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0xed))var _0x4605a2=users[_0x1a84b3(0xf2)];else{if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0x15d))var _0x4605a2=users[_0x1a84b3(0x15d)];else{if(_0x28e2cd[0x0]['language']==_0x1a84b3(0xbb))var _0x4605a2=users[_0x1a84b3(0xbb)];else{if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0x10b))var _0x4605a2=users[_0x1a84b3(0x10b)];else{if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0x106))var _0x4605a2=users[_0x1a84b3(0x106)];else{if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0x141))var _0x4605a2=users['Portuguese'];else{if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0x9d))var _0x4605a2=users[_0x1a84b3(0x9d)];else{if(_0x28e2cd[0x0][_0x1a84b3(0xaf)]==_0x1a84b3(0x144))var _0x4605a2=users[_0x1a84b3(0xb9)];}}}}}}}const _0x1582c8=getRandom8DigitNumber();_0x1582c8[_0x1a84b3(0x148)](_0x5371e8=>{var _0x3caa4f=_0x1a84b3;_0x43eaf8[_0x3caa4f(0xf5)](_0x3caa4f(0x128),{'success':_0x495717['flash'](_0x3caa4f(0xa8)),'errors':_0x495717['flash'](_0x3caa4f(0xae)),'role':_0x1bd199,'profile':_0x4ab944,'warehouse':_0xef20be,'product':_0x8602dc,'master_shop':_0x28e2cd,'language':_0x4605a2,'rooms_data':_0x586884,'invoice_no':_0x5371e8});})[_0x1a84b3(0xb6)](_0x47a27b=>{var _0x2c3df3=_0x1a84b3;_0x495717['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x43eaf8['redirect'](_0x2c3df3(0x157));});}catch(_0x44df28){console['log'](_0x44df28);}}),router['post'](a0_0x2e3bee(0xdf),auth,async(_0x3db846,_0x31cebc)=>{var _0x1c945c=a0_0x2e3bee;try{const {warehouse_name:_0x183bd3,date:_0x1aba59,prod_name:_0x57751b,level:_0x51280f,isle:_0x1572ed,pallet:_0x2c6ecc,stock:_0x2b14e5,types:_0x182966,adjust_qty:_0x9bbdf2,new_adjust_qty:_0x56fece,note:_0xb1616f,Room_name:_0x5cadc3,invoice:_0x1e1899,JO_number:_0x374ef1,expiry_date:_0x31f0fb}=_0x3db846[_0x1c945c(0x163)];if(typeof _0x57751b==_0x1c945c(0x107))var _0x531369=[_0x3db846['body'][_0x1c945c(0xcc)]],_0x204a85=[_0x3db846[_0x1c945c(0x163)]['level']],_0x49d025=[_0x3db846['body'][_0x1c945c(0x12a)]],_0x139d30=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0x136)]],_0x420d19=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0xa6)]],_0x5b9abb=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0xb3)]],_0x5e705b=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0x103)]],_0x1a5e54=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0x11f)]],_0x243717=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0xf8)]],_0x1356d1=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0x15b)]],_0x2077dd=[_0x3db846['body'][_0x1c945c(0x10c)]],_0x2eb61f=[_0x3db846['body'][_0x1c945c(0x137)]],_0x2cdfda=[_0x3db846['body'][_0x1c945c(0x162)]],_0x59da1c=[_0x3db846[_0x1c945c(0x163)]['Rooms']],_0x253931=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0x12f)]],_0x1bd439=[_0x3db846[_0x1c945c(0x163)][_0x1c945c(0x9a)]];else var _0x531369=[..._0x3db846['body'][_0x1c945c(0xcc)]],_0x204a85=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0xf7)]],_0x49d025=[..._0x3db846[_0x1c945c(0x163)]['stock']],_0x139d30=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0x136)]],_0x420d19=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0xa6)]],_0x5b9abb=[..._0x3db846[_0x1c945c(0x163)]['New_Qty_Converted']],_0x5e705b=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0x103)]],_0x1a5e54=[..._0x3db846[_0x1c945c(0x163)]['Secondary_units']],_0x243717=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0xf8)]],_0x1356d1=[..._0x3db846['body'][_0x1c945c(0x15b)]],_0x2077dd=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0x10c)]],_0x2eb61f=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0x137)]],_0x2cdfda=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0x162)]],_0x59da1c=[..._0x3db846[_0x1c945c(0x163)]['Rooms']],_0x253931=[..._0x3db846['body'][_0x1c945c(0x12f)]],_0x1bd439=[..._0x3db846[_0x1c945c(0x163)][_0x1c945c(0x9a)]];const _0x2d4aca=_0x531369[_0x1c945c(0xfb)](_0x557d74=>{return _0x557d74={'product_name':_0x557d74};});_0x204a85[_0x1c945c(0xc1)]((_0x1d29cc,_0x37e47b)=>{var _0x1a1ebe=_0x1c945c;_0x2d4aca[_0x37e47b][_0x1a1ebe(0x155)]=_0x1d29cc;}),_0x49d025[_0x1c945c(0xc1)]((_0x5306a0,_0x1e03a1)=>{_0x2d4aca[_0x1e03a1]['stockBefore']=_0x5306a0;}),_0x139d30['forEach']((_0x1a577a,_0x3c12c4)=>{var _0x28b6d9=_0x1c945c;_0x2d4aca[_0x3c12c4][_0x28b6d9(0x136)]=_0x1a577a;}),_0x420d19['forEach']((_0x4457aa,_0x1d8722)=>{var _0x5e08d4=_0x1c945c;_0x2d4aca[_0x1d8722][_0x5e08d4(0x123)]=_0x4457aa;}),_0x5b9abb[_0x1c945c(0xc1)]((_0x414c02,_0x27deb9)=>{var _0x34f0a1=_0x1c945c;_0x2d4aca[_0x27deb9][_0x34f0a1(0x14f)]=_0x414c02;}),_0x5e705b[_0x1c945c(0xc1)]((_0x198229,_0x2cf79a)=>{var _0x46696a=_0x1c945c;_0x2d4aca[_0x2cf79a][_0x46696a(0x14d)]=_0x198229;}),_0x1a5e54['forEach']((_0x53d726,_0x92f9a5)=>{var _0x31d99c=_0x1c945c;_0x2d4aca[_0x92f9a5][_0x31d99c(0x160)]=_0x53d726;}),_0x243717['forEach']((_0x30fed2,_0x4eb23c)=>{_0x2d4aca[_0x4eb23c]['product_code']=_0x30fed2;}),_0x1356d1[_0x1c945c(0xc1)]((_0xff223f,_0x37a878)=>{_0x2d4aca[_0x37a878]['batch_code']=_0xff223f;}),_0x2077dd[_0x1c945c(0xc1)]((_0x343832,_0x3c62af)=>{var _0x18b9bd=_0x1c945c;_0x2d4aca[_0x3c62af][_0x18b9bd(0x10c)]=_0x343832;}),_0x2eb61f[_0x1c945c(0xc1)]((_0x572586,_0x204f5f)=>{_0x2d4aca[_0x204f5f]['production_date']=_0x572586;}),_0x2cdfda[_0x1c945c(0xc1)]((_0x11d191,_0x3f48c2)=>{var _0x2b7b46=_0x1c945c;_0x2d4aca[_0x3f48c2][_0x2b7b46(0x162)]=_0x11d191;}),_0x59da1c[_0x1c945c(0xc1)]((_0x345eee,_0x57128d)=>{_0x2d4aca[_0x57128d]['room_names']=_0x345eee;}),_0x253931[_0x1c945c(0xc1)]((_0x538573,_0x4b06d8)=>{var _0x3a5397=_0x1c945c;_0x2d4aca[_0x4b06d8][_0x3a5397(0x12f)]=_0x538573;}),_0x1bd439['forEach']((_0x157cc6,_0x5e9bf8)=>{var _0x3439ab=_0x1c945c;_0x2d4aca[_0x5e9bf8][_0x3439ab(0x121)]=_0x157cc6;});const _0x15f405=_0x2d4aca[_0x1c945c(0xef)](_0x460d7c=>_0x460d7c[_0x1c945c(0x123)]!=='0'&&_0x460d7c[_0x1c945c(0x123)]!=='');var _0x115ec5=0x0;_0x15f405[_0x1c945c(0xc1)](_0x3002e2=>{var _0x595908=_0x1c945c;console[_0x595908(0xea)](_0x595908(0xc4),_0x3002e2),parseInt(_0x3002e2['adjust_qty'])<=0x0&&_0x115ec5++;});if(_0x115ec5!=0x0)return _0x3db846['flash'](_0x1c945c(0xae),_0x1c945c(0x13b)),_0x31cebc['redirect'](_0x1c945c(0x158));const _0x2791ae=new adjustment_finished({'warehouse_name':_0x183bd3,'date':_0x1aba59,'product':_0x15f405,'note':_0xb1616f,'room':_0x5cadc3,'invoice':_0x1e1899,'JO_number':_0x374ef1,'expiry_date':_0x31f0fb}),_0x5a193f=await _0x2791ae['save']();_0x3db846[_0x1c945c(0x129)]('success',_0x1c945c(0xa9)),_0x31cebc[_0x1c945c(0x133)](_0x1c945c(0xe0)+_0x5a193f[_0x1c945c(0x100)]);}catch(_0xb84544){console[_0x1c945c(0xea)](_0xb84544),_0x31cebc['status'](0xc8)[_0x1c945c(0x9c)]({'message':_0xb84544[_0x1c945c(0x11b)]});}}),router[a0_0x2e3bee(0xf4)](a0_0x2e3bee(0xdb),auth,async(_0x294d47,_0x12311b)=>{var _0x1256bc=a0_0x2e3bee;try{const {username:_0x3bba86,email:_0x1890e5,role:_0x16a381}=_0x294d47[_0x1256bc(0xfa)],_0x59e381=_0x294d47[_0x1256bc(0xfa)],_0x2d1d72=await profile[_0x1256bc(0xdc)]({'email':_0x59e381[_0x1256bc(0x126)]}),_0x19f4e0=await master_shop[_0x1256bc(0x124)](),_0xb41206=_0x294d47[_0x1256bc(0xce)]['id'],_0x1bd0db=await adjustment_finished[_0x1256bc(0x102)]({'_id':_0xb41206}),_0x58d3f5=await purchases[_0x1256bc(0xab)]([{'$match':{'warehouse_name':_0x1bd0db[_0x1256bc(0x139)]}},{'$unwind':_0x1256bc(0x9b)},{'$group':{'_id':_0x1256bc(0xd6)}}]);console[_0x1256bc(0xea)](_0x1256bc(0xcd),_0x58d3f5);const _0x22cbab=await product[_0x1256bc(0x124)]({}),_0xbcc775=await warehouse[_0x1256bc(0xab)]([{'$match':{'name':_0x1bd0db[_0x1256bc(0x139)],'warehouse_category':_0x1256bc(0xf3)}},{'$unwind':_0x1256bc(0x109)},{'$group':{'_id':_0x1256bc(0x116),'name':{'$first':_0x1256bc(0xb2)},'product_stock':{'$first':_0x1256bc(0xd9)},'bay':{'$first':_0x1256bc(0xec)},'bin':{'$first':_0x1256bc(0xe3)},'type':{'$first':_0x1256bc(0x14c)},'floorlevel':{'$first':_0x1256bc(0x98)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1256bc(0xb5)},'storage':{'$first':_0x1256bc(0xad)},'rack':{'$first':_0x1256bc(0xb4)},'expiry_date':{'$first':_0x1256bc(0xaa)},'production_date':{'$first':_0x1256bc(0x153)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x1256bc(0x151)}}}]);if(_0x19f4e0[0x0][_0x1256bc(0xaf)]=='English\x20(US)'){var _0x34beb5=users['English'];console[_0x1256bc(0xea)](_0x34beb5);}else{if(_0x19f4e0[0x0]['language']==_0x1256bc(0x15d))var _0x34beb5=users[_0x1256bc(0x15d)];else{if(_0x19f4e0[0x0][_0x1256bc(0xaf)]==_0x1256bc(0xbb))var _0x34beb5=users[_0x1256bc(0xbb)];else{if(_0x19f4e0[0x0][_0x1256bc(0xaf)]=='Spanish')var _0x34beb5=users[_0x1256bc(0x10b)];else{if(_0x19f4e0[0x0][_0x1256bc(0xaf)]==_0x1256bc(0x106))var _0x34beb5=users[_0x1256bc(0x106)];else{if(_0x19f4e0[0x0][_0x1256bc(0xaf)]==_0x1256bc(0x141))var _0x34beb5=users[_0x1256bc(0xf6)];else{if(_0x19f4e0[0x0][_0x1256bc(0xaf)]==_0x1256bc(0x9d))var _0x34beb5=users[_0x1256bc(0x9d)];else{if(_0x19f4e0[0x0][_0x1256bc(0xaf)]==_0x1256bc(0x144))var _0x34beb5=users[_0x1256bc(0xb9)];}}}}}}}_0x12311b[_0x1256bc(0xf5)](_0x1256bc(0xe5),{'success':_0x294d47[_0x1256bc(0x129)](_0x1256bc(0xa8)),'errors':_0x294d47[_0x1256bc(0x129)](_0x1256bc(0xae)),'role':_0x59e381,'profile':_0x2d1d72,'adjustment':_0x1bd0db,'stock':_0xbcc775,'master_shop':_0x19f4e0,'warehouse_name':_0x58d3f5,'unit':_0x22cbab,'language':_0x34beb5});}catch(_0x1f7fa0){console[_0x1256bc(0xea)](_0x1f7fa0),_0x12311b[_0x1256bc(0xd7)](0xc8)['json']({'message':_0x1f7fa0[_0x1256bc(0x11b)]});}}),router[a0_0x2e3bee(0x113)](a0_0x2e3bee(0xdb),auth,async(_0x367c8a,_0x12f363)=>{var _0x5d32b7=a0_0x2e3bee;try{const {invoice:_0xf06b62,warehouse_name:_0x491a39,Room_name:_0x51261b}=_0x367c8a[_0x5d32b7(0x163)],_0x403cd9=_0x367c8a[_0x5d32b7(0xce)]['id'],_0x17d411=await adjustment_finished[_0x5d32b7(0x102)]({'_id':_0x403cd9});var _0x2da49d;const _0x4bd05e=_0x17d411[_0x5d32b7(0xa2)][_0x5d32b7(0xfb)](async _0x19b18c=>{var _0x2b3722=_0x5d32b7;if(_0x19b18c[_0x2b3722(0x123)]>0x0){_0x2da49d=await warehouse[_0x2b3722(0xdc)]({'name':_0x491a39,'room':_0x19b18c[_0x2b3722(0x118)],'warehouse_category':_0x2b3722(0xf3)});const _0x8b466c=_0x2da49d[_0x2b3722(0xbf)][_0x2b3722(0xfb)](_0x250a64=>{var _0x4d6a23=_0x2b3722;console[_0x4d6a23(0xea)](_0x19b18c[_0x4d6a23(0x136)]);if(_0x19b18c[_0x4d6a23(0x136)]==_0x4d6a23(0xda))_0x250a64['product_name']==_0x19b18c[_0x4d6a23(0xff)]&&_0x250a64['bay']==_0x19b18c[_0x4d6a23(0x155)]&&_0x250a64[_0x4d6a23(0x10c)]==_0x19b18c[_0x4d6a23(0x10c)]&&_0x250a64[_0x4d6a23(0xee)]==_0x19b18c[_0x4d6a23(0xee)]&&_0x250a64['batch_code']==_0x19b18c[_0x4d6a23(0x15b)]&&_0x250a64[_0x4d6a23(0x121)]==_0x19b18c[_0x4d6a23(0x121)]&&(_0x250a64[_0x4d6a23(0x150)]=_0x250a64['product_stock']-_0x19b18c[_0x4d6a23(0x123)]);else _0x19b18c['types']==_0x4d6a23(0xfe)&&(_0x250a64[_0x4d6a23(0xff)]==_0x19b18c[_0x4d6a23(0xff)]&&_0x250a64['bay']==_0x19b18c['bay']&&_0x250a64[_0x4d6a23(0x10c)]==_0x19b18c[_0x4d6a23(0x10c)]&&_0x250a64[_0x4d6a23(0xee)]==_0x19b18c[_0x4d6a23(0xee)]&&_0x250a64[_0x4d6a23(0x15b)]==_0x19b18c[_0x4d6a23(0x15b)]&&_0x250a64['invoice']==_0x19b18c['invoice']&&(_0x250a64['product_stock']=_0x250a64[_0x4d6a23(0x150)]+_0x19b18c[_0x4d6a23(0x123)]));});}return _0x2da49d;});Promise[_0x5d32b7(0xd2)](_0x4bd05e)[_0x5d32b7(0x148)](async _0xd5d169=>{var _0x176d11=_0x5d32b7;try{for(const _0x5acf2 of _0xd5d169){await _0x5acf2['save']();}_0x17d411['finalize']='True';const _0x5a8d6a=await _0x17d411[_0x176d11(0x161)](),_0x5d776c=await master_shop['find'](),_0x22b4a3=await email_settings[_0x176d11(0xdc)](),_0x5738bf=await supervisor_settings['find']();var _0x24e596=_0x17d411[_0x176d11(0xa2)],_0x3c47a3='',_0x334332;for(_0x334332 in _0x24e596){var _0xededc2='FG';_0x17d411[_0x176d11(0x139)]==_0x176d11(0xba)&&(_0xededc2='DG'),_0x3c47a3+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24e596[_0x334332][_0x176d11(0xff)]+_0x176d11(0x10d)+_0x176d11(0xcf)+_0x24e596[_0x334332][_0x176d11(0xe9)]+_0x176d11(0x10d)+_0x176d11(0xcf)+_0x24e596[_0x334332][_0x176d11(0x123)]+_0x176d11(0x10d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24e596[_0x334332][_0x176d11(0x14d)]+_0x176d11(0x10d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x24e596[_0x334332][_0x176d11(0x160)]+_0x176d11(0x10d)+_0x176d11(0xcf)+_0x17d411[_0x176d11(0x139)]+'</td>'+_0x176d11(0xcf)+_0x24e596[_0x334332][_0x176d11(0x118)]+_0x176d11(0x10d)+_0x176d11(0xcf)+_0xededc2+_0x24e596[_0x334332][_0x176d11(0x155)]+_0x176d11(0x10d)+_0x176d11(0xeb);}let _0x3b7ec8=nodemailer[_0x176d11(0xcb)]({'host':_0x22b4a3[_0x176d11(0x105)],'port':Number(_0x22b4a3[_0x176d11(0xac)]),'secure':![],'auth':{'user':_0x22b4a3[_0x176d11(0x126)],'pass':_0x22b4a3['password']}}),_0x158fe8={'from':_0x22b4a3[_0x176d11(0x126)],'to':_0x5738bf[0x0][_0x176d11(0xd8)],'subject':_0x176d11(0x125),'attachments':[{'filename':_0x176d11(0x11a),'path':__dirname+_0x176d11(0x99)+'/upload/'+_0x5d776c[0x0][_0x176d11(0x12c)],'cid':'logo'}],'html':_0x176d11(0x15e)+_0x176d11(0xde)+_0x176d11(0xc5)+_0x176d11(0xbe)+_0x176d11(0xc7)+_0x176d11(0xbe)+_0x176d11(0x15a)+'</div>'+_0x176d11(0xbe)+'<h2>\x20'+_0x5d776c[0x0][_0x176d11(0xb8)]+_0x176d11(0x138)+'</div>'+_0x176d11(0xc2)+'<hr\x20class=\x22my-3\x22>'+_0x176d11(0xbe)+_0x176d11(0xb0)+_0x176d11(0x122)+_0x17d411['invoice']+'\x20'+_0x176d11(0xa4)+'\x20Order\x20Date\x20:\x20'+_0x17d411['date']+'\x20'+'</span>'+'</h5>'+_0x176d11(0xc2)+_0x176d11(0x114)+_0x176d11(0x15f)+_0x176d11(0xa7)+_0x176d11(0xe1)+_0x176d11(0x13a)+_0x176d11(0x147)+_0x176d11(0x14e)+_0x176d11(0xe8)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x176d11(0x13f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x176d11(0xeb)+_0x176d11(0x110)+_0x176d11(0x11c)+'\x20'+_0x3c47a3+'\x20'+_0x176d11(0xa3)+_0x176d11(0xd4)+_0x176d11(0xbe)+_0x176d11(0x142)+_0x176d11(0xe4)+_0x5d776c[0x0][_0x176d11(0xb8)]+_0x176d11(0xbc)+_0x176d11(0xc2)+'</div>'+_0x176d11(0x13c)};_0x3b7ec8[_0x176d11(0x14a)](_0x158fe8,function(_0x507595,_0x4ef101){var _0x262b15=_0x176d11;_0x507595?(console['log'](_0x507595),console[_0x262b15(0xea)](_0x262b15(0x159))):console['log']('Email\x20sent\x20successfully');}),_0x367c8a[_0x176d11(0x129)]('success',_0x176d11(0xfd)),_0x12f363[_0x176d11(0x133)](_0x176d11(0x132)+_0x5a8d6a['_id']);}catch(_0x4b8940){console[_0x176d11(0x9e)](_0x4b8940),_0x12f363[_0x176d11(0xd7)](0x1f4)[_0x176d11(0x9c)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x5d32b7(0xb6)](_0x396a6b=>{var _0x4b5c43=_0x5d32b7;console[_0x4b5c43(0x9e)](_0x396a6b),_0x12f363[_0x4b5c43(0xd7)](0x1f4)[_0x4b5c43(0x9c)]({'error':_0x4b5c43(0xc8)});});}catch(_0x398b22){_0x12f363[_0x5d32b7(0x9c)]({'message':_0x398b22[_0x5d32b7(0x11b)]});}}),router[a0_0x2e3bee(0xf4)](a0_0x2e3bee(0x10e),auth,async(_0x430c4c,_0x391070)=>{var _0x14b528=a0_0x2e3bee;try{const {username:_0x391a69,email:_0x295346,role:_0x2f32bd}=_0x430c4c['user'],_0x481e10=_0x430c4c[_0x14b528(0xfa)],_0x16e40b=await profile['findOne']({'email':_0x481e10['email']}),_0x557d75=await master_shop['find']();console[_0x14b528(0xea)](_0x14b528(0xd1),_0x557d75);const _0x38e1fd=_0x430c4c[_0x14b528(0xce)]['id'],_0x2a092c=await adjustment_finished[_0x14b528(0x102)]({'_id':_0x38e1fd});let _0x30401c=new Date(_0x2a092c[_0x14b528(0x10c)]),_0x3a9799=('0'+_0x30401c[_0x14b528(0xa1)]())[_0x14b528(0xf0)](-0x2),_0x4d7922=('0'+(_0x30401c[_0x14b528(0xc9)]()+0x1))['slice'](-0x2),_0xd1c913=_0x30401c['getFullYear'](),_0x1b7325=_0xd1c913+'-'+_0x4d7922+'-'+_0x3a9799;var _0x572b53=['Ambient',_0x14b528(0x12b),'Return\x20Rooms'];const _0x194bea=await purchases[_0x14b528(0xab)]([{'$match':{'warehouse_name':_0x2a092c[_0x14b528(0x139)]}},{'$unwind':_0x14b528(0x9b)},{'$group':{'_id':_0x14b528(0xd6)}}]);console[_0x14b528(0xea)](_0x14b528(0xcd),_0x194bea);const _0x5710b8=await product['find']({}),_0x527c18=await warehouse[_0x14b528(0xab)]([{'$match':{'name':_0x2a092c['warehouse_name'],'room':_0x2a092c[_0x14b528(0x152)]}},{'$unwind':_0x14b528(0x109)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x14b528(0xb2)},'product_stock':{'$first':_0x14b528(0xd9)},'bay':{'$first':_0x14b528(0xec)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x14b528(0x14c)},'floorlevel':{'$first':_0x14b528(0x98)},'primary_code':{'$first':_0x14b528(0xc3)},'secondary_code':{'$first':_0x14b528(0x108)},'product_code':{'$first':_0x14b528(0xb5)},'storage':{'$first':_0x14b528(0xad)},'rack':{'$first':_0x14b528(0xb4)}}}]);if(_0x557d75[0x0][_0x14b528(0xaf)]==_0x14b528(0xed)){var _0x5cdbe0=users[_0x14b528(0xf2)];console[_0x14b528(0xea)](_0x5cdbe0);}else{if(_0x557d75[0x0][_0x14b528(0xaf)]==_0x14b528(0x15d))var _0x5cdbe0=users[_0x14b528(0x15d)];else{if(_0x557d75[0x0][_0x14b528(0xaf)]==_0x14b528(0xbb))var _0x5cdbe0=users[_0x14b528(0xbb)];else{if(_0x557d75[0x0]['language']==_0x14b528(0x10b))var _0x5cdbe0=users[_0x14b528(0x10b)];else{if(_0x557d75[0x0][_0x14b528(0xaf)]==_0x14b528(0x106))var _0x5cdbe0=users['French'];else{if(_0x557d75[0x0]['language']=='Portuguese\x20(BR)')var _0x5cdbe0=users['Portuguese'];else{if(_0x557d75[0x0][_0x14b528(0xaf)]==_0x14b528(0x9d))var _0x5cdbe0=users['Chinese'];else{if(_0x557d75[0x0]['language']=='Arabic\x20(ae)')var _0x5cdbe0=users[_0x14b528(0xb9)];}}}}}}}_0x391070[_0x14b528(0xf5)](_0x14b528(0x15c),{'success':_0x430c4c['flash'](_0x14b528(0xa8)),'errors':_0x430c4c[_0x14b528(0x129)](_0x14b528(0xae)),'role':_0x481e10,'profile':_0x16e40b,'adjustment':_0x2a092c,'stock':_0x527c18,'master_shop':_0x557d75,'warehouse_name':_0x194bea,'unit':_0x5710b8,'language':_0x5cdbe0,'rooms_data':_0x572b53,'ed_fullDate':_0x1b7325});}catch(_0x4c6177){console[_0x14b528(0xea)](_0x4c6177),_0x391070[_0x14b528(0xd7)](0xc8)[_0x14b528(0x9c)]({'message':_0x4c6177[_0x14b528(0x11b)]});}}),router[a0_0x2e3bee(0x113)](a0_0x2e3bee(0x10e),auth,async(_0x393b3e,_0x6eb3a4)=>{var _0x381a3b=a0_0x2e3bee;try{const _0x310d2b=_0x393b3e[_0x381a3b(0xce)]['id'],_0x2cb16e=await adjustment_finished['findById']({'_id':_0x310d2b}),_0x4a9ad5=await warehouse[_0x381a3b(0xdc)]({'name':_0x2cb16e[_0x381a3b(0x139)],'room':_0x2cb16e[_0x381a3b(0x152)]}),{warehouse_name:_0x23ac5d,date:_0x58e4e3,prod_name:_0x2a04a0,level:_0x1680fc,isle:_0x7903b7,pallet:_0x41927b,stock:_0x178abf,types:_0x3b17f2,adjust_qty:_0x2cae97,new_adjust_qty:_0x56f6be,note:_0x35a58d,Room_name:_0x9cf80c,invoice:_0x5ab63b,JO_number:_0xd8ada}=_0x393b3e['body'];if(typeof _0x2a04a0==_0x381a3b(0x107))var _0x56b69d=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0xcc)]],_0x2707b3=[_0x393b3e[_0x381a3b(0x163)]['level']],_0x3f4a57=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x12a)]],_0x1ec122=[_0x393b3e[_0x381a3b(0x163)]['types']],_0x13c55a=[_0x393b3e['body'][_0x381a3b(0x123)]],_0x282bef=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x14f)]],_0x6dbe6=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0xf8)]],_0x210679=[_0x393b3e['body'][_0x381a3b(0x14d)]],_0x1f7c5c=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x11f)]],_0x13d0c2=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x15b)]],_0x734436=[_0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x10c)]];else var _0x56b69d=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0xcc)]],_0x2707b3=[..._0x393b3e['body'][_0x381a3b(0xf7)]],_0x3f4a57=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x12a)]],_0x1ec122=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x136)]],_0x13c55a=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x123)]],_0x282bef=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x14f)]],_0x6dbe6=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0xf8)]],_0x210679=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x14d)]],_0x1f7c5c=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x11f)]],_0x13d0c2=[..._0x393b3e[_0x381a3b(0x163)]['batch_code']],_0x734436=[..._0x393b3e[_0x381a3b(0x163)][_0x381a3b(0x10c)]];const _0x115b69=_0x56b69d[_0x381a3b(0xfb)](_0x4fec90=>{return _0x4fec90={'product_name':_0x4fec90};});_0x2707b3[_0x381a3b(0xc1)]((_0x1848ab,_0x4fbb6d)=>{var _0x94c688=_0x381a3b;_0x115b69[_0x4fbb6d][_0x94c688(0x155)]=_0x1848ab;}),_0x3f4a57[_0x381a3b(0xc1)]((_0x2e321c,_0x13d87e)=>{var _0x206162=_0x381a3b;_0x115b69[_0x13d87e][_0x206162(0x10f)]=_0x2e321c;}),_0x1ec122['forEach']((_0x392444,_0xe53532)=>{var _0x3fa8bd=_0x381a3b;_0x115b69[_0xe53532][_0x3fa8bd(0x136)]=_0x392444;}),_0x13c55a[_0x381a3b(0xc1)]((_0x3d013a,_0x55f10a)=>{var _0x5e832b=_0x381a3b;_0x115b69[_0x55f10a][_0x5e832b(0x123)]=_0x3d013a;}),_0x282bef[_0x381a3b(0xc1)]((_0x5a3985,_0x408ee1)=>{var _0x1d2607=_0x381a3b;_0x115b69[_0x408ee1][_0x1d2607(0x14f)]=_0x5a3985;}),_0x210679[_0x381a3b(0xc1)]((_0x3ce178,_0xcb7a02)=>{var _0xcd33ba=_0x381a3b;_0x115b69[_0xcb7a02][_0xcd33ba(0x14d)]=_0x3ce178;}),_0x1f7c5c[_0x381a3b(0xc1)]((_0xa9537d,_0x502f80)=>{var _0x29d92c=_0x381a3b;_0x115b69[_0x502f80][_0x29d92c(0x160)]=_0xa9537d;}),_0x6dbe6[_0x381a3b(0xc1)]((_0xf03b59,_0x43ec21)=>{var _0x496f39=_0x381a3b;_0x115b69[_0x43ec21][_0x496f39(0xe9)]=_0xf03b59;}),_0x13d0c2['forEach']((_0x56126a,_0x31ec7a)=>{var _0xcc600a=_0x381a3b;_0x115b69[_0x31ec7a][_0xcc600a(0x15b)]=_0x56126a;}),_0x734436[_0x381a3b(0xc1)]((_0x54b81f,_0x42dadf)=>{var _0x121e0e=_0x381a3b;_0x115b69[_0x42dadf][_0x121e0e(0x10c)]=_0x54b81f;});const _0x376406=_0x115b69[_0x381a3b(0xef)](_0x2be623=>_0x2be623[_0x381a3b(0x123)]!=='0'&&_0x2be623[_0x381a3b(0x123)]!=='');var _0x4863c9=0x0;_0x376406[_0x381a3b(0xc1)](_0x3d421f=>{var _0x50778c=_0x381a3b;console['log'](_0x50778c(0xc4),_0x3d421f),parseInt(_0x3d421f[_0x50778c(0x123)])<=0x0&&_0x4863c9++;});if(_0x4863c9!=0x0)return _0x393b3e['flash'](_0x381a3b(0xae),_0x381a3b(0x13b)),_0x6eb3a4[_0x381a3b(0x133)](_0x381a3b(0x158));_0x2cb16e[_0x381a3b(0x139)]=_0x23ac5d,_0x2cb16e[_0x381a3b(0x117)]=_0x58e4e3,_0x2cb16e[_0x381a3b(0xa2)]=_0x376406,_0x2cb16e[_0x381a3b(0xd5)]=_0x35a58d,_0x2cb16e[_0x381a3b(0x152)]=_0x9cf80c,_0x2cb16e[_0x381a3b(0x121)]=_0x5ab63b,_0x2cb16e[_0x381a3b(0x10a)]=_0xd8ada;const _0x2abe55=await _0x2cb16e['save'](),_0xe48faf=await warehouse[_0x381a3b(0xdc)]({'name':_0x23ac5d,'room':_0x9cf80c});_0x2abe55[_0x381a3b(0xa2)][_0x381a3b(0xc1)](_0x2bd582=>{var _0x185a88=_0x381a3b;const _0x2531fa=_0xe48faf[_0x185a88(0xbf)][_0x185a88(0xfb)](_0x2a3041=>{var _0x441940=_0x185a88;_0x2bd582[_0x441940(0x136)]==_0x441940(0xda)?_0x2a3041['product_name']==_0x2bd582[_0x441940(0xff)]&&_0x2a3041[_0x441940(0x155)]==_0x2bd582[_0x441940(0x155)]&&(_0x2a3041[_0x441940(0x150)]=parseInt(_0x2a3041[_0x441940(0x150)])-parseInt(_0x2bd582[_0x441940(0x123)])):_0x2a3041[_0x441940(0xff)]==_0x2bd582[_0x441940(0xff)]&&_0x2a3041['bay']==_0x2bd582[_0x441940(0x155)]&&(_0x2a3041[_0x441940(0x150)]=parseInt(_0x2a3041[_0x441940(0x150)])+parseInt(_0x2bd582['adjust_qty']));});}),await _0xe48faf[_0x381a3b(0x161)](),_0x393b3e[_0x381a3b(0x129)](_0x381a3b(0xa8),_0x381a3b(0x9f)),_0x6eb3a4[_0x381a3b(0x133)](_0x381a3b(0x135));}catch(_0x10e180){console['log'](_0x10e180);}}),router[a0_0x2e3bee(0x113)](a0_0x2e3bee(0x13e),async(_0x3d548a,_0x5ac9b9)=>{var _0x27e21e=a0_0x2e3bee;const {primary_code:_0x40f640,warehouse_data:_0xeb6f60,rooms_data:_0x371245,Roomslist:_0x42668d}=_0x3d548a['body'],_0x241459=_0x42668d[_0x27e21e(0x156)](','),_0x529c34=[];async function _0x414ffa(_0x414b95){var _0x242799=_0x27e21e;const _0x43cf64=await warehouse[_0x242799(0xab)]([{'$match':{'name':_0xeb6f60,'room':_0x414b95}},{'$unwind':_0x242799(0x109)},{'$match':{'product_details.primary_code':_0x40f640}},{'$group':{'_id':_0x242799(0x116),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x242799(0xd9)},'primary_code':{'$first':_0x242799(0xc3)},'secondary_code':{'$first':_0x242799(0x108)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x242799(0xe3)},'type':{'$first':_0x242799(0x14c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x242799(0xbd)},'secondary_unit':{'$first':_0x242799(0x104)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x242799(0xb4)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x242799(0x153)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x242799(0x120)},'roomNamed':{'$first':_0x242799(0x151)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2b987a=await warehouse['aggregate']([{'$match':{'name':_0xeb6f60,'room':_0x414b95}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x40f640}},{'$group':{'_id':_0x242799(0x116),'name':{'$first':_0x242799(0xb2)},'product_stock':{'$first':_0x242799(0xd9)},'primary_code':{'$first':_0x242799(0xc3)},'secondary_code':{'$first':_0x242799(0x108)},'product_code':{'$first':_0x242799(0xb5)},'level':{'$first':_0x242799(0xec)},'isle':{'$first':_0x242799(0xe3)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x242799(0x98)},'unit':{'$first':_0x242799(0xbd)},'secondary_unit':{'$first':_0x242799(0x104)},'storage':{'$first':_0x242799(0xad)},'rack':{'$first':_0x242799(0xb4)},'expiry_date':{'$first':_0x242799(0xaa)},'production_date':{'$first':_0x242799(0x153)},'batch_code':{'$first':_0x242799(0x140)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x242799(0x151)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x43cf64[_0x242799(0x154)]>0x0)_0x529c34[_0x242799(0x14b)](_0x43cf64);else _0x2b987a[_0x242799(0x154)]>0x0&&_0x529c34[_0x242799(0x14b)](_0x2b987a);}const _0x222e84=_0x241459[_0x27e21e(0xfb)](_0x560ee6=>_0x414ffa(_0x560ee6));await Promise['all'](_0x222e84),_0x5ac9b9[_0x27e21e(0x9c)](_0x529c34);}),router[a0_0x2e3bee(0x113)]('/CheckingWarehouse',async(_0x593055,_0xf936c2)=>{var _0x357e45=a0_0x2e3bee;const {productCode:_0x1159b9,bay:_0x20307b,warehouses:_0x5c30a6,room:_0x20d3f1}=_0x593055[_0x357e45(0x163)];console['log'](_0x593055[_0x357e45(0x163)]);try{const _0x36ec82=await warehouse[_0x357e45(0xab)]([{'$match':{'name':_0x5c30a6,'room':_0x20d3f1}},{'$unwind':_0x357e45(0x109)},{'$match':{'product_details.bay':parseInt(_0x20307b)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x357e45(0xb2)},'product_stock':{'$first':_0x357e45(0xd9)},'bay':{'$first':_0x357e45(0xec)},'maxProducts':{'$first':_0x357e45(0x127)}}}]);_0xf936c2[_0x357e45(0xd7)](0xc8)[_0x357e45(0x9c)](_0x36ec82);}catch(_0x6adfc3){_0xf936c2['status'](0x194)[_0x357e45(0x9c)]({'message':_0x6adfc3[_0x357e45(0x11b)]});}}),module[a0_0x2e3bee(0x115)]=router;