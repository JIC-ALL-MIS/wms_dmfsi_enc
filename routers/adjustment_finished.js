function a0_0x49a8(){var _0x375886=['</div>','role','unit','stockBefore','Portuguese\x20(BR)','length','adjust_qty','date','<span\x20style=\x22float:\x20right;\x22>','$product_details.primary_code','$product_details.storage','$product.room_names','/view/:id','json','back','<tr>','foreach\x20newproduct','then','Secondary_units','room','$name','redirect','/adjustment/view','<!DOCTYPE\x20html>','1674848mBEqiP','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product.product_name','Primary_Units','</td>','product_date','$product_details.product_stock','/../public','$product_details.rack','/picking_list/PDF_adjustment/','Rooms','True','$room','5QFYzwb','French','user','createTransport','finalize','prod_cat','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','_id','\x20Order\x20Number\x20:\x20','../middleware/auth','warehouse','save','get','forEach','params','$product_details.unit','invoice','find','/adjustment_finished/preview/','product_name','$product_details.expiry_date','$product_details.bin','<div>','QA\x20Warehouse','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','prod_name','purchases_data','bay','$product_details','level','<h5>','1171310PLauuy','filter','host','production_date','prod_invoice','3GbSjxe','8994EkzmJE','Arabic','room_names','$product_details.maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.bay','email','$warehouse_name','slice','$product_details.floorlevel','nodemailer','getFullYear','English\x20(US)','$product_details.type','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','new_adjust_qty','errors','language','toString','warehouse_name','password','<tbody\x20style=\x22text-align:\x20center;\x22>','/adjustment_finished/view','exports','all','Enabled','maxPerUnit','An\x20error\x20occurred\x20while\x20saving\x20data.','/preview/:id','site_title','add_adjustment_finished','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','findOne','2094132HPAWWs','Portuguese','../public/language/languages.json','Spanish','edit_adjustment_finished_view','Finished\x20Goods','padStart','Hindi','adjustment\x20data\x20update\x20successfully','$date','Router','Logo.png','logo','stock','$product_details.production_date','render','</head><body>','adjustment\x20add\x20successfull','minus','</span>','/barcode_scanner','Chinese','string','Enclosed','44LHmGVu','status','12497652hyKtNI','prod_code','$product','4492989ufLkvU','Arabic\x20(ae)','catch','post','product','$product_details.secondary_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Ambient','$_id','push','secondary_unit','note','expiry_date','JO_number','\x20Order\x20Date\x20:\x20','types','findById','1863780vxhaGy','success','ADJF-','Error\x20Occurs','image','$product_details.maxProducts','flash','staff','German','error','English','product_code','FGSEmail','add','New_Qty_Converted_adj','97qqEgin','product_stock','$product_details.product_code','Adjustment\x20Finalize\x20Successfully','7evGbMA','</h5>','$finalize','<html><head><title></title>','aggregate','random','port','DRY\x20GOODS','$product_details.secondary_unit','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.batch_code','message','<strong>\x20Regards\x20</strong>','$product_details.product_name','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','An\x20error\x20occurred.','</table>','log','</body></html>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','batch_code','body','/CheckingWarehouse','map','Return\x20Rooms','</tr>'];a0_0x49a8=function(){return _0x375886;};return a0_0x49a8();}var a0_0x53ff32=a0_0x5d71;(function(_0x3f69f5,_0x50a953){var _0x5c39ad=a0_0x5d71,_0x2d5d80=_0x3f69f5();while(!![]){try{var _0x54570f=parseInt(_0x5c39ad(0x226))/0x1*(parseInt(_0x5c39ad(0x291))/0x2)+parseInt(_0x5c39ad(0x290))/0x3*(parseInt(_0x5c39ad(0x217))/0x4)+parseInt(_0x5c39ad(0x26a))/0x5*(-parseInt(_0x5c39ad(0x1e9))/0x6)+-parseInt(_0x5c39ad(0x22a))/0x7*(parseInt(_0x5c39ad(0x25d))/0x8)+parseInt(_0x5c39ad(0x206))/0x9+-parseInt(_0x5c39ad(0x28b))/0xa*(-parseInt(_0x5c39ad(0x201))/0xb)+-parseInt(_0x5c39ad(0x203))/0xc;if(_0x54570f===_0x50a953)break;else _0x2d5d80['push'](_0x2d5d80['shift']());}catch(_0x31f0b8){_0x2d5d80['push'](_0x2d5d80['shift']());}}}(a0_0x49a8,0x41ee2));const express=require('express'),app=express(),router=express[a0_0x53ff32(0x1f3)](),auth=require(a0_0x53ff32(0x274)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x53ff32(0x1eb)),nodemailer=require(a0_0x53ff32(0x29b));router[a0_0x53ff32(0x277)]('/view',auth,async(_0x4689f0,_0x3cee7c)=>{var _0x4bc1ab=a0_0x53ff32;try{const {username:_0x217cc6,email:_0x17bddb,role:_0x5c8824}=_0x4689f0['user'],_0x179281=_0x4689f0['user'],_0x519861=await profile[_0x4bc1ab(0x1e8)]({'email':_0x179281[_0x4bc1ab(0x297)]}),_0x2bcb3f=await master_shop[_0x4bc1ab(0x27c)]();let _0x55f5a0;if(_0x179281[_0x4bc1ab(0x246)]==_0x4bc1ab(0x21e)){const _0x2e6f02=await staff[_0x4bc1ab(0x1e8)]({'email':_0x179281[_0x4bc1ab(0x297)]});_0x55f5a0=await warehouse[_0x4bc1ab(0x27c)]({'status':_0x4bc1ab(0x1e1),'name':_0x2e6f02['warehouse']});}else _0x55f5a0=await warehouse['find']({'status':_0x4bc1ab(0x1e1)});const _0x52ad2c=await product[_0x4bc1ab(0x27c)]();let _0x20b13c;if(_0x179281['role']==_0x4bc1ab(0x21e)){const _0xb4307b=await staff['findOne']({'email':_0x179281[_0x4bc1ab(0x297)]});_0x20b13c=await adjustment_finished[_0x4bc1ab(0x27c)]({'warehouse_name':_0xb4307b[_0x4bc1ab(0x275)]});}else _0x20b13c=await adjustment_finished[_0x4bc1ab(0x22e)]([{'$unwind':_0x4bc1ab(0x205)},{'$group':{'_id':_0x4bc1ab(0x20e),'invoice':{'$first':'$invoice'},'date':{'$first':_0x4bc1ab(0x1f2)},'warehouse_name':{'$first':_0x4bc1ab(0x298)},'room':{'$addToSet':_0x4bc1ab(0x250)},'finalize':{'$first':_0x4bc1ab(0x22c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]==_0x4bc1ab(0x29d)){var _0x421b08=users[_0x4bc1ab(0x221)];console[_0x4bc1ab(0x23c)](_0x421b08);}else{if(_0x2bcb3f[0x0]['language']==_0x4bc1ab(0x1f0))var _0x421b08=users['Hindi'];else{if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]==_0x4bc1ab(0x21f))var _0x421b08=users[_0x4bc1ab(0x21f)];else{if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]==_0x4bc1ab(0x1ec))var _0x421b08=users[_0x4bc1ab(0x1ec)];else{if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]==_0x4bc1ab(0x26b))var _0x421b08=users[_0x4bc1ab(0x26b)];else{if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]=='Portuguese\x20(BR)')var _0x421b08=users[_0x4bc1ab(0x1ea)];else{if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]==_0x4bc1ab(0x1fe))var _0x421b08=users[_0x4bc1ab(0x1fe)];else{if(_0x2bcb3f[0x0][_0x4bc1ab(0x2a2)]==_0x4bc1ab(0x207))var _0x421b08=users[_0x4bc1ab(0x292)];}}}}}}}_0x3cee7c[_0x4bc1ab(0x1f8)]('adjustment_finished',{'success':_0x4689f0[_0x4bc1ab(0x21d)](_0x4bc1ab(0x218)),'errors':_0x4689f0[_0x4bc1ab(0x21d)](_0x4bc1ab(0x2a1)),'role':_0x179281,'profile':_0x519861,'warehouse':_0x55f5a0,'product':_0x52ad2c,'adjustment':_0x20b13c,'master_shop':_0x2bcb3f,'language':_0x421b08});}catch(_0x1b485a){console[_0x4bc1ab(0x23c)](_0x1b485a);}});function a0_0x5d71(_0x1e889b,_0x513de5){var _0x49a87e=a0_0x49a8();return a0_0x5d71=function(_0x5d718e,_0x154b53){_0x5d718e=_0x5d718e-0x1da;var _0x249475=_0x49a87e[_0x5d718e];return _0x249475;},a0_0x5d71(_0x1e889b,_0x513de5);}async function getRandom8DigitNumber(){var _0x4d1ddf=a0_0x53ff32;const _0x2889f7=0x989680,_0x11aec6=0x5f5e0ff,_0x2885c9=Math['floor'](Math[_0x4d1ddf(0x22f)]()*(_0x11aec6-_0x2889f7+0x1))+_0x2889f7;var _0x3d88b3;const _0x2b9ce0=await adjustment_finished[_0x4d1ddf(0x1e8)]({'invoice':_0x4d1ddf(0x219)+_0x2885c9});return _0x2b9ce0&&_0x2b9ce0[_0x4d1ddf(0x24a)]>0x0?_0x3d88b3=_0x4d1ddf(0x219)+_0x2885c9:_0x3d88b3='ADJF-'+_0x2885c9,_0x3d88b3;}router[a0_0x53ff32(0x277)]('/view/add_adjustment',auth,async(_0x4c4095,_0x1e14a9)=>{var _0x5f3d18=a0_0x53ff32;try{const {username:_0x435278,email:_0xb8de7c,role:_0x4bc047}=_0x4c4095['user'],_0x9b4051=_0x4c4095[_0x5f3d18(0x26c)],_0x75639d=await profile['findOne']({'email':_0x9b4051['email']}),_0x274ecd=await master_shop[_0x5f3d18(0x27c)]();let _0x339232;if(_0x9b4051['role']==_0x5f3d18(0x21e)){const _0x36539e=await staff['findOne']({'email':_0x9b4051['email']});_0x339232=await warehouse[_0x5f3d18(0x22e)]([{'$match':{'status':_0x5f3d18(0x1e1),'name':_0x36539e[_0x5f3d18(0x275)],'warehouse_category':_0x5f3d18(0x1ee),'name':{'$ne':_0x5f3d18(0x282)}}},{'$group':{'_id':'$name','name':{'$first':_0x5f3d18(0x259)}}}]);}else _0x339232=await warehouse[_0x5f3d18(0x22e)]([{'$match':{'status':'Enabled','warehouse_category':_0x5f3d18(0x1ee),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x5f3d18(0x259),'name':{'$first':_0x5f3d18(0x259)}}}]);const _0x39452f=await product[_0x5f3d18(0x27c)]({}),_0x3df7a7=await adjustment_finished['find']({}),_0x45371a=_0x3df7a7[_0x5f3d18(0x24a)]+0x1,_0x18d52e=_0x5f3d18(0x219)+_0x45371a[_0x5f3d18(0x1da)]()[_0x5f3d18(0x1ef)](0x5,'0');var _0x44017b=[_0x5f3d18(0x20d),_0x5f3d18(0x200),_0x5f3d18(0x243)];if(_0x274ecd[0x0][_0x5f3d18(0x2a2)]==_0x5f3d18(0x29d))var _0x5c74b0=users['English'];else{if(_0x274ecd[0x0][_0x5f3d18(0x2a2)]=='Hindi')var _0x5c74b0=users[_0x5f3d18(0x1f0)];else{if(_0x274ecd[0x0][_0x5f3d18(0x2a2)]=='German')var _0x5c74b0=users[_0x5f3d18(0x21f)];else{if(_0x274ecd[0x0][_0x5f3d18(0x2a2)]==_0x5f3d18(0x1ec))var _0x5c74b0=users[_0x5f3d18(0x1ec)];else{if(_0x274ecd[0x0]['language']=='French')var _0x5c74b0=users[_0x5f3d18(0x26b)];else{if(_0x274ecd[0x0][_0x5f3d18(0x2a2)]==_0x5f3d18(0x249))var _0x5c74b0=users['Portuguese'];else{if(_0x274ecd[0x0][_0x5f3d18(0x2a2)]==_0x5f3d18(0x1fe))var _0x5c74b0=users[_0x5f3d18(0x1fe)];else{if(_0x274ecd[0x0]['language']==_0x5f3d18(0x207))var _0x5c74b0=users[_0x5f3d18(0x292)];}}}}}}}const _0x40d745=getRandom8DigitNumber();_0x40d745[_0x5f3d18(0x256)](_0x394553=>{var _0x2199da=_0x5f3d18;_0x1e14a9[_0x2199da(0x1f8)](_0x2199da(0x1e6),{'success':_0x4c4095['flash']('success'),'errors':_0x4c4095[_0x2199da(0x21d)]('errors'),'role':_0x9b4051,'profile':_0x75639d,'warehouse':_0x339232,'product':_0x39452f,'master_shop':_0x274ecd,'language':_0x5c74b0,'rooms_data':_0x44017b,'invoice_no':_0x394553});})[_0x5f3d18(0x208)](_0x4783ad=>{var _0x57f360=_0x5f3d18;_0x4c4095[_0x57f360(0x21d)](_0x57f360(0x2a1),_0x57f360(0x23e)),_0x1e14a9['redirect'](_0x57f360(0x25b));});}catch(_0x4506e5){console[_0x5f3d18(0x23c)](_0x4506e5);}}),router[a0_0x53ff32(0x209)]('/view/add_adjustment',auth,async(_0x5d2640,_0x7dfe0)=>{var _0x3a8f91=a0_0x53ff32;try{const {warehouse_name:_0x1cb3e5,date:_0x3c9123,prod_name:_0x578c44,level:_0x454f9b,isle:_0x1c1c95,pallet:_0x14601a,stock:_0x254a17,types:_0x4ed26,adjust_qty:_0x145c4f,new_adjust_qty:_0x46ea2f,note:_0x2c3809,Room_name:_0x234f6b,invoice:_0x2e1715,JO_number:_0x110784,expiry_date:_0x45d2be}=_0x5d2640[_0x3a8f91(0x240)];if(typeof _0x578c44==_0x3a8f91(0x1ff))var _0x353e0a=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x285)]],_0x34c491=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x289)]],_0x3b01e0=[_0x5d2640['body'][_0x3a8f91(0x1f6)]],_0x5d7cbd=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x215)]],_0x3f5a75=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x225)]],_0x326a8d=[_0x5d2640['body']['New_Qty_Converted']],_0x563c39=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x260)]],_0x4511c3=[_0x5d2640[_0x3a8f91(0x240)]['Secondary_units']],_0x9c5f98=[_0x5d2640['body'][_0x3a8f91(0x204)]],_0x560bd6=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x23f)]],_0x57fc00=[_0x5d2640['body'][_0x3a8f91(0x212)]],_0x53527b=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x262)]],_0x4397e1=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x26f)]],_0x2400a2=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x267)]],_0x5c9ef3=[_0x5d2640['body']['maxPerUnit']],_0xd64910=[_0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x28f)]];else var _0x353e0a=[..._0x5d2640['body'][_0x3a8f91(0x285)]],_0x34c491=[..._0x5d2640['body']['level']],_0x3b01e0=[..._0x5d2640[_0x3a8f91(0x240)]['stock']],_0x5d7cbd=[..._0x5d2640['body'][_0x3a8f91(0x215)]],_0x3f5a75=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x225)]],_0x326a8d=[..._0x5d2640[_0x3a8f91(0x240)]['New_Qty_Converted']],_0x563c39=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x260)]],_0x4511c3=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x257)]],_0x9c5f98=[..._0x5d2640['body'][_0x3a8f91(0x204)]],_0x560bd6=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x23f)]],_0x57fc00=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x212)]],_0x53527b=[..._0x5d2640[_0x3a8f91(0x240)]['product_date']],_0x4397e1=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x26f)]],_0x2400a2=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x267)]],_0x5c9ef3=[..._0x5d2640['body'][_0x3a8f91(0x1e2)]],_0xd64910=[..._0x5d2640[_0x3a8f91(0x240)][_0x3a8f91(0x28f)]];const _0x4a8d59=_0x353e0a['map'](_0x13dea8=>{return _0x13dea8={'product_name':_0x13dea8};});_0x34c491['forEach']((_0x2e7c7b,_0x196199)=>{var _0x4b4baa=_0x3a8f91;_0x4a8d59[_0x196199][_0x4b4baa(0x287)]=_0x2e7c7b;}),_0x3b01e0[_0x3a8f91(0x278)]((_0x485740,_0x3ff5f3)=>{var _0x41ee95=_0x3a8f91;_0x4a8d59[_0x3ff5f3][_0x41ee95(0x248)]=_0x485740;}),_0x5d7cbd[_0x3a8f91(0x278)]((_0x37a905,_0x138fa9)=>{var _0x3f0770=_0x3a8f91;_0x4a8d59[_0x138fa9][_0x3f0770(0x215)]=_0x37a905;}),_0x3f5a75[_0x3a8f91(0x278)]((_0x1c33ef,_0xca68cf)=>{var _0x3ea821=_0x3a8f91;_0x4a8d59[_0xca68cf][_0x3ea821(0x24b)]=_0x1c33ef;}),_0x326a8d[_0x3a8f91(0x278)]((_0x27762b,_0x3c6e76)=>{_0x4a8d59[_0x3c6e76]['new_adjust_qty']=_0x27762b;}),_0x563c39[_0x3a8f91(0x278)]((_0x5aa176,_0x5758d4)=>{_0x4a8d59[_0x5758d4]['unit']=_0x5aa176;}),_0x4511c3[_0x3a8f91(0x278)]((_0x48d3c4,_0x1b9449)=>{var _0xe09a77=_0x3a8f91;_0x4a8d59[_0x1b9449][_0xe09a77(0x210)]=_0x48d3c4;}),_0x9c5f98[_0x3a8f91(0x278)]((_0x43ebf0,_0x43e158)=>{var _0x59878b=_0x3a8f91;_0x4a8d59[_0x43e158][_0x59878b(0x222)]=_0x43ebf0;}),_0x560bd6[_0x3a8f91(0x278)]((_0x3d75fa,_0x244af5)=>{var _0x40e8a1=_0x3a8f91;_0x4a8d59[_0x244af5][_0x40e8a1(0x23f)]=_0x3d75fa;}),_0x57fc00[_0x3a8f91(0x278)]((_0x14e6b9,_0x4ae6a3)=>{var _0x1e8198=_0x3a8f91;_0x4a8d59[_0x4ae6a3][_0x1e8198(0x212)]=_0x14e6b9;}),_0x53527b[_0x3a8f91(0x278)]((_0x45694d,_0x26b217)=>{_0x4a8d59[_0x26b217]['production_date']=_0x45694d;}),_0x4397e1[_0x3a8f91(0x278)]((_0x3686e3,_0x3deb84)=>{var _0x560d0f=_0x3a8f91;_0x4a8d59[_0x3deb84][_0x560d0f(0x26f)]=_0x3686e3;}),_0x2400a2[_0x3a8f91(0x278)]((_0x32c479,_0x245a80)=>{var _0x15494f=_0x3a8f91;_0x4a8d59[_0x245a80][_0x15494f(0x293)]=_0x32c479;}),_0x5c9ef3[_0x3a8f91(0x278)]((_0x97fdc7,_0x4601e5)=>{var _0x42c89e=_0x3a8f91;_0x4a8d59[_0x4601e5][_0x42c89e(0x1e2)]=_0x97fdc7;}),_0xd64910[_0x3a8f91(0x278)]((_0x299d5a,_0x2ea592)=>{_0x4a8d59[_0x2ea592]['invoice']=_0x299d5a;});const _0x3e8181=_0x4a8d59[_0x3a8f91(0x28c)](_0x5d52df=>_0x5d52df[_0x3a8f91(0x24b)]!=='0'&&_0x5d52df[_0x3a8f91(0x24b)]!=='');var _0x3af03e=0x0;_0x3e8181[_0x3a8f91(0x278)](_0x250886=>{var _0x4934f4=_0x3a8f91;console[_0x4934f4(0x23c)]('foreach\x20newproduct',_0x250886),parseInt(_0x250886[_0x4934f4(0x24b)])<=0x0&&_0x3af03e++;});if(_0x3af03e!=0x0)return _0x5d2640['flash'](_0x3a8f91(0x2a1),_0x3a8f91(0x283)),_0x7dfe0['redirect']('back');const _0xfb3168=new adjustment_finished({'warehouse_name':_0x1cb3e5,'date':_0x3c9123,'product':_0x3e8181,'note':_0x2c3809,'room':_0x234f6b,'invoice':_0x2e1715,'JO_number':_0x110784,'expiry_date':_0x45d2be}),_0x2b1b10=await _0xfb3168[_0x3a8f91(0x276)]();_0x5d2640[_0x3a8f91(0x21d)](_0x3a8f91(0x218),_0x3a8f91(0x1fa)),_0x7dfe0[_0x3a8f91(0x25a)](_0x3a8f91(0x27d)+_0x2b1b10[_0x3a8f91(0x272)]);}catch(_0x35aab1){console[_0x3a8f91(0x23c)](_0x35aab1),_0x7dfe0[_0x3a8f91(0x202)](0xc8)[_0x3a8f91(0x252)]({'message':_0x35aab1[_0x3a8f91(0x235)]});}}),router['get'](a0_0x53ff32(0x1e4),auth,async(_0x38847e,_0x342918)=>{var _0x94b7f6=a0_0x53ff32;try{const {username:_0x15f441,email:_0x21920d,role:_0x4aa642}=_0x38847e[_0x94b7f6(0x26c)],_0x9e48e4=_0x38847e[_0x94b7f6(0x26c)],_0x22a2f1=await profile[_0x94b7f6(0x1e8)]({'email':_0x9e48e4['email']}),_0x4b9996=await master_shop[_0x94b7f6(0x27c)](),_0xa13a68=_0x38847e[_0x94b7f6(0x279)]['id'],_0x2fa971=await adjustment_finished['findById']({'_id':_0xa13a68}),_0x1069e3=await purchases[_0x94b7f6(0x22e)]([{'$match':{'warehouse_name':_0x2fa971[_0x94b7f6(0x1db)]}},{'$unwind':'$product'},{'$group':{'_id':_0x94b7f6(0x25f)}}]);console[_0x94b7f6(0x23c)](_0x94b7f6(0x286),_0x1069e3);const _0x12c62f=await product['find']({}),_0x531bf0=await warehouse['aggregate']([{'$match':{'name':_0x2fa971[_0x94b7f6(0x1db)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x94b7f6(0x288)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x94b7f6(0x296)},'bin':{'$first':_0x94b7f6(0x280)},'type':{'$first':_0x94b7f6(0x29e)},'floorlevel':{'$first':_0x94b7f6(0x29a)},'primary_code':{'$first':_0x94b7f6(0x24e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x94b7f6(0x24f)},'rack':{'$first':_0x94b7f6(0x265)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x94b7f6(0x234)},'maxPerUnit':{'$first':_0x94b7f6(0x294)},'room':{'$first':_0x94b7f6(0x269)}}}]);if(_0x4b9996[0x0]['language']==_0x94b7f6(0x29d)){var _0x5238c1=users[_0x94b7f6(0x221)];console[_0x94b7f6(0x23c)](_0x5238c1);}else{if(_0x4b9996[0x0]['language']==_0x94b7f6(0x1f0))var _0x5238c1=users[_0x94b7f6(0x1f0)];else{if(_0x4b9996[0x0][_0x94b7f6(0x2a2)]==_0x94b7f6(0x21f))var _0x5238c1=users[_0x94b7f6(0x21f)];else{if(_0x4b9996[0x0][_0x94b7f6(0x2a2)]==_0x94b7f6(0x1ec))var _0x5238c1=users['Spanish'];else{if(_0x4b9996[0x0][_0x94b7f6(0x2a2)]==_0x94b7f6(0x26b))var _0x5238c1=users[_0x94b7f6(0x26b)];else{if(_0x4b9996[0x0]['language']=='Portuguese\x20(BR)')var _0x5238c1=users[_0x94b7f6(0x1ea)];else{if(_0x4b9996[0x0][_0x94b7f6(0x2a2)]=='Chinese')var _0x5238c1=users[_0x94b7f6(0x1fe)];else{if(_0x4b9996[0x0][_0x94b7f6(0x2a2)]==_0x94b7f6(0x207))var _0x5238c1=users[_0x94b7f6(0x292)];}}}}}}}_0x342918['render'](_0x94b7f6(0x1ed),{'success':_0x38847e['flash'](_0x94b7f6(0x218)),'errors':_0x38847e['flash'](_0x94b7f6(0x2a1)),'role':_0x9e48e4,'profile':_0x22a2f1,'adjustment':_0x2fa971,'stock':_0x531bf0,'master_shop':_0x4b9996,'warehouse_name':_0x1069e3,'unit':_0x12c62f,'language':_0x5238c1});}catch(_0x2752ab){console[_0x94b7f6(0x23c)](_0x2752ab),_0x342918['status'](0xc8)['json']({'message':_0x2752ab[_0x94b7f6(0x235)]});}}),router[a0_0x53ff32(0x209)](a0_0x53ff32(0x1e4),auth,async(_0x231204,_0x1caf45)=>{var _0x3d80b0=a0_0x53ff32;try{const {invoice:_0x46206b,warehouse_name:_0x1cf221,Room_name:_0x39f7c8}=_0x231204[_0x3d80b0(0x240)],_0x9db6e0=_0x231204[_0x3d80b0(0x279)]['id'],_0x4a222f=await adjustment_finished[_0x3d80b0(0x216)]({'_id':_0x9db6e0});var _0x573dfd;const _0x589eea=_0x4a222f[_0x3d80b0(0x20a)][_0x3d80b0(0x242)](async _0x5a0d9e=>{var _0x23ea30=_0x3d80b0;if(_0x5a0d9e[_0x23ea30(0x24b)]>0x0){_0x573dfd=await warehouse[_0x23ea30(0x1e8)]({'name':_0x1cf221,'room':_0x5a0d9e[_0x23ea30(0x293)],'warehouse_category':'Finished\x20Goods'});const _0x177182=_0x573dfd['product_details'][_0x23ea30(0x242)](_0x381795=>{var _0x311834=_0x23ea30;console[_0x311834(0x23c)](_0x5a0d9e[_0x311834(0x215)]);if(_0x5a0d9e['types']==_0x311834(0x1fb))_0x381795[_0x311834(0x27e)]==_0x5a0d9e[_0x311834(0x27e)]&&_0x381795[_0x311834(0x287)]==_0x5a0d9e[_0x311834(0x287)]&&_0x381795[_0x311834(0x212)]==_0x5a0d9e[_0x311834(0x212)]&&_0x381795[_0x311834(0x28e)]==_0x5a0d9e[_0x311834(0x28e)]&&_0x381795['batch_code']==_0x5a0d9e['batch_code']&&_0x381795[_0x311834(0x27b)]==_0x5a0d9e[_0x311834(0x27b)]&&(_0x381795[_0x311834(0x227)]=_0x381795[_0x311834(0x227)]-_0x5a0d9e['adjust_qty']);else _0x5a0d9e[_0x311834(0x215)]==_0x311834(0x224)&&(_0x381795[_0x311834(0x27e)]==_0x5a0d9e['product_name']&&_0x381795[_0x311834(0x287)]==_0x5a0d9e[_0x311834(0x287)]&&_0x381795['expiry_date']==_0x5a0d9e[_0x311834(0x212)]&&_0x381795[_0x311834(0x28e)]==_0x5a0d9e[_0x311834(0x28e)]&&_0x381795['batch_code']==_0x5a0d9e[_0x311834(0x23f)]&&_0x381795[_0x311834(0x27b)]==_0x5a0d9e[_0x311834(0x27b)]&&(_0x381795['product_stock']=_0x381795[_0x311834(0x227)]+_0x5a0d9e[_0x311834(0x24b)]));});}return _0x573dfd;});Promise[_0x3d80b0(0x1e0)](_0x589eea)[_0x3d80b0(0x256)](async _0x1b637a=>{var _0x4c36f4=_0x3d80b0;try{for(const _0x5bd18f of _0x1b637a){await _0x5bd18f['save']();}_0x4a222f[_0x4c36f4(0x26e)]=_0x4c36f4(0x268);const _0x16a047=await _0x4a222f[_0x4c36f4(0x276)](),_0x415337=await master_shop[_0x4c36f4(0x27c)](),_0x3e823e=await email_settings[_0x4c36f4(0x1e8)](),_0x224ac6=await supervisor_settings[_0x4c36f4(0x27c)]();var _0x34ee06=_0x4a222f['product'],_0xbf195='',_0x5dfb6e;for(_0x5dfb6e in _0x34ee06){var _0x3b2ba8='FG';_0x4a222f[_0x4c36f4(0x1db)]==_0x4c36f4(0x231)&&(_0x3b2ba8='DG'),_0xbf195+='<tr>'+_0x4c36f4(0x1e7)+_0x34ee06[_0x5dfb6e][_0x4c36f4(0x27e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34ee06[_0x5dfb6e][_0x4c36f4(0x222)]+_0x4c36f4(0x261)+_0x4c36f4(0x1e7)+_0x34ee06[_0x5dfb6e][_0x4c36f4(0x24b)]+_0x4c36f4(0x261)+_0x4c36f4(0x1e7)+_0x34ee06[_0x5dfb6e]['unit']+_0x4c36f4(0x261)+_0x4c36f4(0x1e7)+_0x34ee06[_0x5dfb6e]['secondary_unit']+_0x4c36f4(0x261)+_0x4c36f4(0x1e7)+_0x4a222f[_0x4c36f4(0x1db)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34ee06[_0x5dfb6e][_0x4c36f4(0x293)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3b2ba8+_0x34ee06[_0x5dfb6e][_0x4c36f4(0x287)]+_0x4c36f4(0x261)+_0x4c36f4(0x244);}let _0x1a58ba=nodemailer[_0x4c36f4(0x26d)]({'host':_0x3e823e[_0x4c36f4(0x28d)],'port':Number(_0x3e823e[_0x4c36f4(0x230)]),'secure':![],'auth':{'user':_0x3e823e[_0x4c36f4(0x297)],'pass':_0x3e823e[_0x4c36f4(0x1dc)]}}),_0x1ed46f={'from':_0x3e823e[_0x4c36f4(0x297)],'to':_0x224ac6[0x0][_0x4c36f4(0x223)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x4c36f4(0x1f4),'path':__dirname+_0x4c36f4(0x264)+'/upload/'+_0x415337[0x0][_0x4c36f4(0x21b)],'cid':_0x4c36f4(0x1f5)}],'html':_0x4c36f4(0x25c)+_0x4c36f4(0x22d)+_0x4c36f4(0x1f9)+_0x4c36f4(0x281)+_0x4c36f4(0x29f)+_0x4c36f4(0x281)+_0x4c36f4(0x20c)+_0x4c36f4(0x245)+_0x4c36f4(0x281)+'<h2>\x20'+_0x415337[0x0][_0x4c36f4(0x1e5)]+'\x20</h2>'+_0x4c36f4(0x245)+_0x4c36f4(0x245)+'<hr\x20class=\x22my-3\x22>'+'<div>'+_0x4c36f4(0x233)+_0x4c36f4(0x273)+_0x4a222f[_0x4c36f4(0x27b)]+'\x20'+_0x4c36f4(0x24d)+_0x4c36f4(0x214)+_0x4a222f['date']+'\x20'+_0x4c36f4(0x1fc)+_0x4c36f4(0x22b)+_0x4c36f4(0x245)+_0x4c36f4(0x25e)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4c36f4(0x254)+_0x4c36f4(0x284)+_0x4c36f4(0x271)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x4c36f4(0x295)+_0x4c36f4(0x239)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x4c36f4(0x244)+'</thead>'+_0x4c36f4(0x1dd)+'\x20'+_0xbf195+'\x20'+'</tbody>'+_0x4c36f4(0x23b)+_0x4c36f4(0x281)+_0x4c36f4(0x236)+_0x4c36f4(0x28a)+_0x415337[0x0][_0x4c36f4(0x1e5)]+'</h5>'+_0x4c36f4(0x245)+'</div>'+_0x4c36f4(0x23d)};_0x1a58ba['sendMail'](_0x1ed46f,function(_0x43da1a,_0x21293c){var _0x16ba55=_0x4c36f4;_0x43da1a?(console[_0x16ba55(0x23c)](_0x43da1a),console['log'](_0x16ba55(0x21a))):console[_0x16ba55(0x23c)]('Email\x20sent\x20successfully');}),_0x231204[_0x4c36f4(0x21d)]('success',_0x4c36f4(0x229)),_0x1caf45['redirect'](_0x4c36f4(0x266)+_0x16a047['_id']);}catch(_0x4695eb){console[_0x4c36f4(0x220)](_0x4695eb),_0x1caf45[_0x4c36f4(0x202)](0x1f4)['json']({'error':_0x4c36f4(0x1e3)});}})['catch'](_0x491d1a=>{var _0x263aed=_0x3d80b0;console[_0x263aed(0x220)](_0x491d1a),_0x1caf45[_0x263aed(0x202)](0x1f4)[_0x263aed(0x252)]({'error':_0x263aed(0x23a)});});}catch(_0x3ac4ee){_0x1caf45[_0x3d80b0(0x252)]({'message':_0x3ac4ee['message']});}}),router[a0_0x53ff32(0x277)](a0_0x53ff32(0x251),auth,async(_0x519b0d,_0x446326)=>{var _0x242e6e=a0_0x53ff32;try{const {username:_0x59532f,email:_0x12f1dd,role:_0x552117}=_0x519b0d[_0x242e6e(0x26c)],_0x4d948d=_0x519b0d[_0x242e6e(0x26c)],_0x57d1eb=await profile[_0x242e6e(0x1e8)]({'email':_0x4d948d[_0x242e6e(0x297)]}),_0x5c431b=await master_shop[_0x242e6e(0x27c)]();console[_0x242e6e(0x23c)]('master',_0x5c431b);const _0x43d1bf=_0x519b0d['params']['id'],_0x3cc136=await adjustment_finished[_0x242e6e(0x216)]({'_id':_0x43d1bf});let _0x3509be=new Date(_0x3cc136[_0x242e6e(0x212)]),_0x1f4198=('0'+_0x3509be['getDate']())['slice'](-0x2),_0x535591=('0'+(_0x3509be[_0x242e6e(0x238)]()+0x1))[_0x242e6e(0x299)](-0x2),_0x1857bb=_0x3509be[_0x242e6e(0x29c)](),_0x4947b4=_0x1857bb+'-'+_0x535591+'-'+_0x1f4198;var _0x156a1c=[_0x242e6e(0x20d),_0x242e6e(0x200),_0x242e6e(0x243)];const _0x12968d=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3cc136['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x242e6e(0x23c)]('purchases_data',_0x12968d);const _0x10e26b=await product[_0x242e6e(0x27c)]({}),_0x1728f5=await warehouse[_0x242e6e(0x22e)]([{'$match':{'name':_0x3cc136[_0x242e6e(0x1db)],'room':_0x3cc136[_0x242e6e(0x258)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x242e6e(0x270),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x242e6e(0x296)},'bin':{'$first':_0x242e6e(0x280)},'type':{'$first':_0x242e6e(0x29e)},'floorlevel':{'$first':_0x242e6e(0x29a)},'primary_code':{'$first':_0x242e6e(0x24e)},'secondary_code':{'$first':_0x242e6e(0x20b)},'product_code':{'$first':_0x242e6e(0x228)},'storage':{'$first':_0x242e6e(0x24f)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x5c431b[0x0][_0x242e6e(0x2a2)]==_0x242e6e(0x29d)){var _0x3c91f3=users['English'];console[_0x242e6e(0x23c)](_0x3c91f3);}else{if(_0x5c431b[0x0]['language']==_0x242e6e(0x1f0))var _0x3c91f3=users[_0x242e6e(0x1f0)];else{if(_0x5c431b[0x0]['language']==_0x242e6e(0x21f))var _0x3c91f3=users['German'];else{if(_0x5c431b[0x0][_0x242e6e(0x2a2)]==_0x242e6e(0x1ec))var _0x3c91f3=users['Spanish'];else{if(_0x5c431b[0x0]['language']=='French')var _0x3c91f3=users[_0x242e6e(0x26b)];else{if(_0x5c431b[0x0][_0x242e6e(0x2a2)]==_0x242e6e(0x249))var _0x3c91f3=users[_0x242e6e(0x1ea)];else{if(_0x5c431b[0x0][_0x242e6e(0x2a2)]=='Chinese')var _0x3c91f3=users[_0x242e6e(0x1fe)];else{if(_0x5c431b[0x0][_0x242e6e(0x2a2)]=='Arabic\x20(ae)')var _0x3c91f3=users[_0x242e6e(0x292)];}}}}}}}_0x446326[_0x242e6e(0x1f8)]('edit_adjustment_finished',{'success':_0x519b0d[_0x242e6e(0x21d)](_0x242e6e(0x218)),'errors':_0x519b0d[_0x242e6e(0x21d)]('errors'),'role':_0x4d948d,'profile':_0x57d1eb,'adjustment':_0x3cc136,'stock':_0x1728f5,'master_shop':_0x5c431b,'warehouse_name':_0x12968d,'unit':_0x10e26b,'language':_0x3c91f3,'rooms_data':_0x156a1c,'ed_fullDate':_0x4947b4});}catch(_0x4bd72c){console[_0x242e6e(0x23c)](_0x4bd72c),_0x446326['status'](0xc8)[_0x242e6e(0x252)]({'message':_0x4bd72c[_0x242e6e(0x235)]});}}),router[a0_0x53ff32(0x209)](a0_0x53ff32(0x251),auth,async(_0x611937,_0x5a4860)=>{var _0x231aec=a0_0x53ff32;try{const _0x47a10c=_0x611937[_0x231aec(0x279)]['id'],_0x1fdf60=await adjustment_finished[_0x231aec(0x216)]({'_id':_0x47a10c}),_0x5f27f6=await warehouse[_0x231aec(0x1e8)]({'name':_0x1fdf60[_0x231aec(0x1db)],'room':_0x1fdf60[_0x231aec(0x258)]}),{warehouse_name:_0x19f74b,date:_0x2c9916,prod_name:_0xc30bcc,level:_0x99d0a2,isle:_0x15cf82,pallet:_0x46391b,stock:_0x57a301,types:_0x22b326,adjust_qty:_0x3340bf,new_adjust_qty:_0x1cfa77,note:_0x129482,Room_name:_0xb14e27,invoice:_0x963398,JO_number:_0x2ffc58}=_0x611937[_0x231aec(0x240)];if(typeof _0xc30bcc==_0x231aec(0x1ff))var _0x3e9b13=[_0x611937[_0x231aec(0x240)]['prod_name']],_0xf4b9a6=[_0x611937[_0x231aec(0x240)]['level']],_0xface0=[_0x611937[_0x231aec(0x240)]['stock']],_0x59bbc3=[_0x611937[_0x231aec(0x240)][_0x231aec(0x215)]],_0x49c107=[_0x611937[_0x231aec(0x240)]['adjust_qty']],_0x515bc6=[_0x611937[_0x231aec(0x240)][_0x231aec(0x2a0)]],_0x294d2e=[_0x611937[_0x231aec(0x240)][_0x231aec(0x204)]],_0x1d57ba=[_0x611937[_0x231aec(0x240)]['unit']],_0x3ed97f=[_0x611937[_0x231aec(0x240)]['Secondary_units']],_0x2df40a=[_0x611937[_0x231aec(0x240)][_0x231aec(0x23f)]],_0x556a6d=[_0x611937[_0x231aec(0x240)][_0x231aec(0x212)]];else var _0x3e9b13=[..._0x611937[_0x231aec(0x240)][_0x231aec(0x285)]],_0xf4b9a6=[..._0x611937['body']['level']],_0xface0=[..._0x611937[_0x231aec(0x240)]['stock']],_0x59bbc3=[..._0x611937[_0x231aec(0x240)][_0x231aec(0x215)]],_0x49c107=[..._0x611937[_0x231aec(0x240)]['adjust_qty']],_0x515bc6=[..._0x611937[_0x231aec(0x240)]['new_adjust_qty']],_0x294d2e=[..._0x611937[_0x231aec(0x240)]['prod_code']],_0x1d57ba=[..._0x611937[_0x231aec(0x240)][_0x231aec(0x247)]],_0x3ed97f=[..._0x611937[_0x231aec(0x240)]['Secondary_units']],_0x2df40a=[..._0x611937[_0x231aec(0x240)][_0x231aec(0x23f)]],_0x556a6d=[..._0x611937['body'][_0x231aec(0x212)]];const _0x1df435=_0x3e9b13[_0x231aec(0x242)](_0x44dde1=>{return _0x44dde1={'product_name':_0x44dde1};});_0xf4b9a6[_0x231aec(0x278)]((_0x356674,_0x3ce091)=>{var _0x3f9d0b=_0x231aec;_0x1df435[_0x3ce091][_0x3f9d0b(0x287)]=_0x356674;}),_0xface0[_0x231aec(0x278)]((_0x3aa184,_0x2b631b)=>{var _0x4a7b32=_0x231aec;_0x1df435[_0x2b631b][_0x4a7b32(0x248)]=_0x3aa184;}),_0x59bbc3['forEach']((_0x102931,_0x396951)=>{var _0x42c47a=_0x231aec;_0x1df435[_0x396951][_0x42c47a(0x215)]=_0x102931;}),_0x49c107[_0x231aec(0x278)]((_0x4cfbf3,_0x3ccfd4)=>{var _0x729c20=_0x231aec;_0x1df435[_0x3ccfd4][_0x729c20(0x24b)]=_0x4cfbf3;}),_0x515bc6[_0x231aec(0x278)]((_0x2a6671,_0x28eab8)=>{var _0x28d156=_0x231aec;_0x1df435[_0x28eab8][_0x28d156(0x2a0)]=_0x2a6671;}),_0x1d57ba[_0x231aec(0x278)]((_0x40b8df,_0x48544f)=>{_0x1df435[_0x48544f]['unit']=_0x40b8df;}),_0x3ed97f[_0x231aec(0x278)]((_0x1fa686,_0x172893)=>{var _0x2cc5a7=_0x231aec;_0x1df435[_0x172893][_0x2cc5a7(0x210)]=_0x1fa686;}),_0x294d2e['forEach']((_0x24c956,_0x144bdb)=>{var _0x6c2d89=_0x231aec;_0x1df435[_0x144bdb][_0x6c2d89(0x222)]=_0x24c956;}),_0x2df40a[_0x231aec(0x278)]((_0x5560e3,_0x3bf64b)=>{var _0x1f2768=_0x231aec;_0x1df435[_0x3bf64b][_0x1f2768(0x23f)]=_0x5560e3;}),_0x556a6d[_0x231aec(0x278)]((_0x27e946,_0x590112)=>{_0x1df435[_0x590112]['expiry_date']=_0x27e946;});const _0x1c8078=_0x1df435[_0x231aec(0x28c)](_0x526090=>_0x526090['adjust_qty']!=='0'&&_0x526090[_0x231aec(0x24b)]!=='');var _0x323b87=0x0;_0x1c8078[_0x231aec(0x278)](_0x264b7a=>{var _0x4fcc5a=_0x231aec;console[_0x4fcc5a(0x23c)](_0x4fcc5a(0x255),_0x264b7a),parseInt(_0x264b7a[_0x4fcc5a(0x24b)])<=0x0&&_0x323b87++;});if(_0x323b87!=0x0)return _0x611937['flash'](_0x231aec(0x2a1),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x5a4860[_0x231aec(0x25a)](_0x231aec(0x253));_0x1fdf60[_0x231aec(0x1db)]=_0x19f74b,_0x1fdf60[_0x231aec(0x24c)]=_0x2c9916,_0x1fdf60[_0x231aec(0x20a)]=_0x1c8078,_0x1fdf60[_0x231aec(0x211)]=_0x129482,_0x1fdf60[_0x231aec(0x258)]=_0xb14e27,_0x1fdf60[_0x231aec(0x27b)]=_0x963398,_0x1fdf60[_0x231aec(0x213)]=_0x2ffc58;const _0x1a8ef5=await _0x1fdf60[_0x231aec(0x276)](),_0xef930f=await warehouse[_0x231aec(0x1e8)]({'name':_0x19f74b,'room':_0xb14e27});_0x1a8ef5[_0x231aec(0x20a)][_0x231aec(0x278)](_0x8eeeb7=>{var _0x4702a3=_0x231aec;const _0x5921a1=_0xef930f['product_details'][_0x4702a3(0x242)](_0x17f447=>{var _0x471e32=_0x4702a3;_0x8eeeb7[_0x471e32(0x215)]==_0x471e32(0x1fb)?_0x17f447[_0x471e32(0x27e)]==_0x8eeeb7[_0x471e32(0x27e)]&&_0x17f447['bay']==_0x8eeeb7[_0x471e32(0x287)]&&(_0x17f447[_0x471e32(0x227)]=parseInt(_0x17f447[_0x471e32(0x227)])-parseInt(_0x8eeeb7[_0x471e32(0x24b)])):_0x17f447[_0x471e32(0x27e)]==_0x8eeeb7[_0x471e32(0x27e)]&&_0x17f447[_0x471e32(0x287)]==_0x8eeeb7['bay']&&(_0x17f447[_0x471e32(0x227)]=parseInt(_0x17f447[_0x471e32(0x227)])+parseInt(_0x8eeeb7[_0x471e32(0x24b)]));});}),await _0xef930f[_0x231aec(0x276)](),_0x611937[_0x231aec(0x21d)](_0x231aec(0x218),_0x231aec(0x1f1)),_0x5a4860['redirect'](_0x231aec(0x1de));}catch(_0x242f82){console[_0x231aec(0x23c)](_0x242f82);}}),router[a0_0x53ff32(0x209)](a0_0x53ff32(0x1fd),async(_0x34b45f,_0x1085d4)=>{var _0x2d7f21=a0_0x53ff32;const {primary_code:_0x257805,warehouse_data:_0x3e43ab,rooms_data:_0x52e12c,Roomslist:_0x4c4601}=_0x34b45f[_0x2d7f21(0x240)],_0x11704a=_0x4c4601['split'](','),_0x33ed65=[];async function _0x3c697b(_0x4ecd66){var _0x12583e=_0x2d7f21;const _0x251a43=await warehouse[_0x12583e(0x22e)]([{'$match':{'name':_0x3e43ab,'room':_0x4ecd66}},{'$unwind':_0x12583e(0x288)},{'$match':{'product_details.primary_code':_0x257805}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x12583e(0x237)},'product_stock':{'$first':_0x12583e(0x263)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x12583e(0x20b)},'product_code':{'$first':_0x12583e(0x228)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x12583e(0x27a)},'secondary_unit':{'$first':_0x12583e(0x232)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x12583e(0x265)},'expiry_date':{'$first':_0x12583e(0x27f)},'production_date':{'$first':_0x12583e(0x1f7)},'batch_code':{'$first':_0x12583e(0x234)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x12583e(0x294)},'roomNamed':{'$first':_0x12583e(0x269)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x27a139=await warehouse[_0x12583e(0x22e)]([{'$match':{'name':_0x3e43ab,'room':_0x4ecd66}},{'$unwind':_0x12583e(0x288)},{'$match':{'product_details.secondary_code':_0x257805}},{'$group':{'_id':_0x12583e(0x270),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x12583e(0x263)},'primary_code':{'$first':_0x12583e(0x24e)},'secondary_code':{'$first':_0x12583e(0x20b)},'product_code':{'$first':_0x12583e(0x228)},'level':{'$first':_0x12583e(0x296)},'isle':{'$first':_0x12583e(0x280)},'type':{'$first':_0x12583e(0x29e)},'pallet':{'$first':_0x12583e(0x29a)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x12583e(0x265)},'expiry_date':{'$first':_0x12583e(0x27f)},'production_date':{'$first':_0x12583e(0x1f7)},'batch_code':{'$first':_0x12583e(0x234)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x12583e(0x269)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x251a43[_0x12583e(0x24a)]>0x0)_0x33ed65[_0x12583e(0x20f)](_0x251a43);else _0x27a139[_0x12583e(0x24a)]>0x0&&_0x33ed65[_0x12583e(0x20f)](_0x27a139);}const _0x133843=_0x11704a['map'](_0x2489b1=>_0x3c697b(_0x2489b1));await Promise[_0x2d7f21(0x1e0)](_0x133843),_0x1085d4['json'](_0x33ed65);}),router['post'](a0_0x53ff32(0x241),async(_0x391ef0,_0x5c87f7)=>{var _0x570d78=a0_0x53ff32;const {productCode:_0x171fd2,bay:_0x3bd03c,warehouses:_0x5cf6ec,room:_0xe2a92e}=_0x391ef0[_0x570d78(0x240)];console[_0x570d78(0x23c)](_0x391ef0['body']);try{const _0x3c164f=await warehouse[_0x570d78(0x22e)]([{'$match':{'name':_0x5cf6ec,'room':_0xe2a92e}},{'$unwind':_0x570d78(0x288)},{'$match':{'product_details.bay':parseInt(_0x3bd03c)}},{'$group':{'_id':_0x570d78(0x270),'name':{'$first':_0x570d78(0x237)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x570d78(0x296)},'maxProducts':{'$first':_0x570d78(0x21c)}}}]);_0x5c87f7['status'](0xc8)[_0x570d78(0x252)](_0x3c164f);}catch(_0x33b143){_0x5c87f7[_0x570d78(0x202)](0x194)['json']({'message':_0x33b143['message']});}}),module[a0_0x53ff32(0x1df)]=router;