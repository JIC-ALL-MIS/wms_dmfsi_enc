var a0_0x30ae6f=a0_0x3899;(function(_0xac0e19,_0x268591){var _0xb56730=a0_0x3899,_0x5d0528=_0xac0e19();while(!![]){try{var _0x123636=-parseInt(_0xb56730(0x1ca))/0x1*(-parseInt(_0xb56730(0x177))/0x2)+parseInt(_0xb56730(0x198))/0x3+-parseInt(_0xb56730(0x199))/0x4*(-parseInt(_0xb56730(0x1e4))/0x5)+parseInt(_0xb56730(0x17e))/0x6+parseInt(_0xb56730(0x195))/0x7*(parseInt(_0xb56730(0x1e2))/0x8)+-parseInt(_0xb56730(0x1db))/0x9+-parseInt(_0xb56730(0x19d))/0xa;if(_0x123636===_0x268591)break;else _0x5d0528['push'](_0x5d0528['shift']());}catch(_0x4a87ca){_0x5d0528['push'](_0x5d0528['shift']());}}}(a0_0x22c8,0x83e37));const express=require(a0_0x30ae6f(0x1d4)),app=express(),router=express[a0_0x30ae6f(0x14d)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x30ae6f(0x1e1)),nodemailer=require(a0_0x30ae6f(0x1d5));function a0_0x3899(_0x385196,_0x1428b4){var _0x22c8ca=a0_0x22c8();return a0_0x3899=function(_0x389982,_0x42073c){_0x389982=_0x389982-0x14c;var _0x2d9f90=_0x22c8ca[_0x389982];return _0x2d9f90;},a0_0x3899(_0x385196,_0x1428b4);}function a0_0x22c8(){var _0x434546=['add','Adjustment\x20Mail','length','</td>','$product_details.production_date','New_Qty_Converted','edit_adjustment_finished_view','/view','$product_details.floorlevel','adjustment\x20data\x20update\x20successfully','13436RFOuTu','minus','Arabic\x20(ae)','/CheckingWarehouse','random','find','getDate','730086RMgYBh','French','<tr>','$product.product_name','$product_details.product_code','$room','body','flash','English\x20(US)','ADJF-','createTransport','adjust_qty','<html><head><title></title>','DRY\x20GOODS','new_adjust_qty','error','<h5\x20style=\x22text-align:\x20left;\x22>','foreach\x20newproduct','German','$product','map','getMonth','warehouse_name','14kNNxvG','$product_details','$product_details.batch_code','1297587cLLaQK','24uleern','$date','$product_details.product_stock','Return\x20Rooms','10609090dFnBRz','types','Arabic','expiry_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','site_title','get','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','_id','aggregate','Enabled','prod_invoice','filter','warehouse','<div>','add_adjustment_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','sendMail','$invoice','redirect','Portuguese','$product_details.invoice','</div>','$product_details.unit','Primary_Units','<span\x20style=\x22float:\x20right;\x22>','prod_name','render','findById','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/upload/','$name','$product_details.product_name','Logo.png','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','production_date','note','back','product_stock','English','maxPerUnit','status','errors','room','52bDjZFo','/adjustment_finished/preview/','catch','floor','all','log','Adjustment\x20Finalize\x20Successfully','push','success','forEach','express','nodemailer','Finished\x20Goods','</h5>','/view/:id','slice','toString','6571206CbJwmu','secondary_unit','Hindi','stockBefore','New_Qty_Converted_adj','master','../public/language/languages.json','2353752nLPjoG','room_names','699395EHoqMV','\x20Order\x20Number\x20:\x20','post','exports','product_code','date','$product_details.maxPerUnit','Rooms','$product_details.secondary_unit','unit','/view/add_adjustment','message','level','$product_details.maxProducts','<table\x20style=\x22width:\x20100%\x20!important;\x22>','user','batch_code','$product_details.rack','product','Spanish','/adjustment_finished/view','language','$product_details.bay','Chinese','$product_details._id','$warehouse_name','purchases_data','\x20</h2>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','bay','$product_details.primary_code','save','Email\x20sent\x20successfully','invoice','image','getFullYear','edit_adjustment_finished','QA\x20Warehouse','finalize','stock','/../public','product_date','Secondary_units','adjustment_finished','$_id','Portuguese\x20(BR)','Router','string','role','<tbody\x20style=\x22text-align:\x20center;\x22>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.expiry_date','</tr>','json','$finalize','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<h2>\x20','email','prod_cat','staff','product_details','prod_code','<h5>','$product_details.bin','/preview/:id','$product.room_names','$product_details.secondary_code','padStart','True','product_name','/barcode_scanner','findOne','<strong>\x20Regards\x20</strong>','</tbody>','$product_details.storage','params','<!DOCTYPE\x20html>','port'];a0_0x22c8=function(){return _0x434546;};return a0_0x22c8();}router[a0_0x30ae6f(0x1a3)](a0_0x30ae6f(0x174),auth,async(_0x14c5d0,_0x5cb98d)=>{var _0x1754e5=a0_0x30ae6f;try{const {username:_0x181dde,email:_0x213be6,role:_0x350333}=_0x14c5d0[_0x1754e5(0x1f3)],_0x166139=_0x14c5d0[_0x1754e5(0x1f3)],_0x3a5b74=await profile[_0x1754e5(0x166)]({'email':_0x166139[_0x1754e5(0x158)]}),_0x3e2a6d=await master_shop[_0x1754e5(0x17c)]();let _0x1bdf82;if(_0x166139[_0x1754e5(0x14f)]==_0x1754e5(0x15a)){const _0xc7a01=await staff['findOne']({'email':_0x166139[_0x1754e5(0x158)]});_0x1bdf82=await warehouse[_0x1754e5(0x17c)]({'status':_0x1754e5(0x1a7),'name':_0xc7a01['warehouse']});}else _0x1bdf82=await warehouse[_0x1754e5(0x17c)]({'status':_0x1754e5(0x1a7)});const _0xd14cdf=await product[_0x1754e5(0x17c)]();let _0x12cce3;if(_0x166139[_0x1754e5(0x14f)]==_0x1754e5(0x15a)){const _0x178c7f=await staff[_0x1754e5(0x166)]({'email':_0x166139[_0x1754e5(0x158)]});_0x12cce3=await adjustment_finished['find']({'warehouse_name':_0x178c7f[_0x1754e5(0x1aa)]});}else _0x12cce3=await adjustment_finished[_0x1754e5(0x1a6)]([{'$unwind':_0x1754e5(0x191)},{'$group':{'_id':_0x1754e5(0x210),'invoice':{'$first':_0x1754e5(0x1af)},'date':{'$first':_0x1754e5(0x19a)},'warehouse_name':{'$first':_0x1754e5(0x1fd)},'room':{'$addToSet':_0x1754e5(0x160)},'finalize':{'$first':_0x1754e5(0x155)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]==_0x1754e5(0x186)){var _0x51b47e=users[_0x1754e5(0x1c5)];console[_0x1754e5(0x1cf)](_0x51b47e);}else{if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]==_0x1754e5(0x1dd))var _0x51b47e=users[_0x1754e5(0x1dd)];else{if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]==_0x1754e5(0x190))var _0x51b47e=users[_0x1754e5(0x190)];else{if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]==_0x1754e5(0x1f7))var _0x51b47e=users[_0x1754e5(0x1f7)];else{if(_0x3e2a6d[0x0]['language']==_0x1754e5(0x17f))var _0x51b47e=users[_0x1754e5(0x17f)];else{if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]=='Portuguese\x20(BR)')var _0x51b47e=users[_0x1754e5(0x1b1)];else{if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]=='Chinese')var _0x51b47e=users['Chinese'];else{if(_0x3e2a6d[0x0][_0x1754e5(0x1f9)]==_0x1754e5(0x179))var _0x51b47e=users[_0x1754e5(0x19f)];}}}}}}}_0x5cb98d[_0x1754e5(0x1b8)](_0x1754e5(0x20f),{'success':_0x14c5d0[_0x1754e5(0x185)](_0x1754e5(0x1d2)),'errors':_0x14c5d0[_0x1754e5(0x185)]('errors'),'role':_0x166139,'profile':_0x3a5b74,'warehouse':_0x1bdf82,'product':_0xd14cdf,'adjustment':_0x12cce3,'master_shop':_0x3e2a6d,'language':_0x51b47e});}catch(_0x4efbc0){console[_0x1754e5(0x1cf)](_0x4efbc0);}});async function getRandom8DigitNumber(){var _0x9d546a=a0_0x30ae6f;const _0x5e2e4a=0x989680,_0x5049de=0x5f5e0ff,_0x47a436=Math[_0x9d546a(0x1cd)](Math[_0x9d546a(0x17b)]()*(_0x5049de-_0x5e2e4a+0x1))+_0x5e2e4a;var _0x461630;const _0x240e7f=await adjustment_finished['findOne']({'invoice':'ADJF-'+_0x47a436});return _0x240e7f&&_0x240e7f[_0x9d546a(0x16f)]>0x0?_0x461630=_0x9d546a(0x187)+_0x47a436:_0x461630=_0x9d546a(0x187)+_0x47a436,_0x461630;}router[a0_0x30ae6f(0x1a3)](a0_0x30ae6f(0x1ee),auth,async(_0x324ba1,_0x43b658)=>{var _0x1488b0=a0_0x30ae6f;try{const {username:_0x116a98,email:_0x3765fe,role:_0x40aaa4}=_0x324ba1[_0x1488b0(0x1f3)],_0x400d58=_0x324ba1[_0x1488b0(0x1f3)],_0x3a753b=await profile['findOne']({'email':_0x400d58[_0x1488b0(0x158)]}),_0x5b7ab8=await master_shop['find']();let _0xfdf31b;if(_0x400d58[_0x1488b0(0x14f)]==_0x1488b0(0x15a)){const _0x4b1b79=await staff['findOne']({'email':_0x400d58['email']});_0xfdf31b=await warehouse['aggregate']([{'$match':{'status':_0x1488b0(0x1a7),'name':_0x4b1b79[_0x1488b0(0x1aa)],'warehouse_category':_0x1488b0(0x1d6),'name':{'$ne':_0x1488b0(0x209)}}},{'$group':{'_id':_0x1488b0(0x1bd),'name':{'$first':'$name'}}}]);}else _0xfdf31b=await warehouse[_0x1488b0(0x1a6)]([{'$match':{'status':_0x1488b0(0x1a7),'warehouse_category':_0x1488b0(0x1d6),'name':{'$ne':_0x1488b0(0x209)}}},{'$group':{'_id':_0x1488b0(0x1bd),'name':{'$first':_0x1488b0(0x1bd)}}}]);const _0xd0757=await product[_0x1488b0(0x17c)]({}),_0x2b01a9=await adjustment_finished[_0x1488b0(0x17c)]({}),_0x151b6f=_0x2b01a9[_0x1488b0(0x16f)]+0x1,_0x1458ce=_0x1488b0(0x187)+_0x151b6f[_0x1488b0(0x1da)]()[_0x1488b0(0x162)](0x5,'0');var _0x50dba7=['Ambient','Enclosed',_0x1488b0(0x19c)];if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]==_0x1488b0(0x186))var _0x284637=users['English'];else{if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]==_0x1488b0(0x1dd))var _0x284637=users[_0x1488b0(0x1dd)];else{if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]==_0x1488b0(0x190))var _0x284637=users[_0x1488b0(0x190)];else{if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]=='Spanish')var _0x284637=users[_0x1488b0(0x1f7)];else{if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]==_0x1488b0(0x17f))var _0x284637=users[_0x1488b0(0x17f)];else{if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]==_0x1488b0(0x14c))var _0x284637=users[_0x1488b0(0x1b1)];else{if(_0x5b7ab8[0x0][_0x1488b0(0x1f9)]=='Chinese')var _0x284637=users[_0x1488b0(0x1fb)];else{if(_0x5b7ab8[0x0]['language']==_0x1488b0(0x179))var _0x284637=users[_0x1488b0(0x19f)];}}}}}}}const _0xa0158d=getRandom8DigitNumber();_0xa0158d['then'](_0x268823=>{var _0x459a94=_0x1488b0;_0x43b658[_0x459a94(0x1b8)](_0x459a94(0x1ac),{'success':_0x324ba1[_0x459a94(0x185)](_0x459a94(0x1d2)),'errors':_0x324ba1[_0x459a94(0x185)](_0x459a94(0x1c8)),'role':_0x400d58,'profile':_0x3a753b,'warehouse':_0xfdf31b,'product':_0xd0757,'master_shop':_0x5b7ab8,'language':_0x284637,'rooms_data':_0x50dba7,'invoice_no':_0x268823});})[_0x1488b0(0x1cc)](_0x2aef5c=>{var _0x5c217d=_0x1488b0;_0x324ba1['flash'](_0x5c217d(0x1c8),_0x5c217d(0x151)),_0x43b658[_0x5c217d(0x1b0)]('/adjustment/view');});}catch(_0x3fd669){console[_0x1488b0(0x1cf)](_0x3fd669);}}),router[a0_0x30ae6f(0x1e6)]('/view/add_adjustment',auth,async(_0x548e8a,_0x5bc192)=>{var _0x1b615d=a0_0x30ae6f;try{const {warehouse_name:_0x4491a3,date:_0x2a456b,prod_name:_0x234f50,level:_0x2e2782,isle:_0x7938cd,pallet:_0x245510,stock:_0x22905b,types:_0x15f256,adjust_qty:_0x19249f,new_adjust_qty:_0x2a57f8,note:_0x29a306,Room_name:_0x10fae6,invoice:_0x1731ca,JO_number:_0x53e1d3,expiry_date:_0x2040d3}=_0x548e8a[_0x1b615d(0x184)];if(typeof _0x234f50=='string')var _0x1d4f0d=[_0x548e8a[_0x1b615d(0x184)]['prod_name']],_0x4dc331=[_0x548e8a[_0x1b615d(0x184)]['level']],_0x37ce01=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x20b)]],_0x1f560d=[_0x548e8a[_0x1b615d(0x184)]['types']],_0x4ac236=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1df)]],_0x430e3a=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x172)]],_0x4c02b8=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1b5)]],_0x2365ba=[_0x548e8a[_0x1b615d(0x184)]['Secondary_units']],_0x56fba0=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x15c)]],_0x139f01=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1f4)]],_0x4cd86d=[_0x548e8a['body'][_0x1b615d(0x1a0)]],_0x3c632f=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x20d)]],_0x2fac4c=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x159)]],_0x21c114=[_0x548e8a[_0x1b615d(0x184)]['Rooms']],_0x38fdd5=[_0x548e8a[_0x1b615d(0x184)]['maxPerUnit']],_0x18dc5a=[_0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1a8)]];else var _0x1d4f0d=[..._0x548e8a['body'][_0x1b615d(0x1b7)]],_0x4dc331=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1f0)]],_0x37ce01=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x20b)]],_0x1f560d=[..._0x548e8a[_0x1b615d(0x184)]['types']],_0x4ac236=[..._0x548e8a['body'][_0x1b615d(0x1df)]],_0x430e3a=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x172)]],_0x4c02b8=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1b5)]],_0x2365ba=[..._0x548e8a[_0x1b615d(0x184)]['Secondary_units']],_0x56fba0=[..._0x548e8a[_0x1b615d(0x184)]['prod_code']],_0x139f01=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1f4)]],_0x4cd86d=[..._0x548e8a['body'][_0x1b615d(0x1a0)]],_0x3c632f=[..._0x548e8a[_0x1b615d(0x184)]['product_date']],_0x2fac4c=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x159)]],_0x21c114=[..._0x548e8a['body'][_0x1b615d(0x1eb)]],_0x38fdd5=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1c6)]],_0x18dc5a=[..._0x548e8a[_0x1b615d(0x184)][_0x1b615d(0x1a8)]];const _0xd7aafc=_0x1d4f0d['map'](_0x516efc=>{return _0x516efc={'product_name':_0x516efc};});_0x4dc331[_0x1b615d(0x1d3)]((_0x5bc1ab,_0x1a6d82)=>{var _0x4e7853=_0x1b615d;_0xd7aafc[_0x1a6d82][_0x4e7853(0x201)]=_0x5bc1ab;}),_0x37ce01['forEach']((_0x54d25f,_0x267be3)=>{var _0x2ba83f=_0x1b615d;_0xd7aafc[_0x267be3][_0x2ba83f(0x1de)]=_0x54d25f;}),_0x1f560d[_0x1b615d(0x1d3)]((_0x54aec3,_0x4c604b)=>{_0xd7aafc[_0x4c604b]['types']=_0x54aec3;}),_0x4ac236[_0x1b615d(0x1d3)]((_0x4923f5,_0x55dce4)=>{var _0x37a292=_0x1b615d;_0xd7aafc[_0x55dce4][_0x37a292(0x189)]=_0x4923f5;}),_0x430e3a['forEach']((_0x1a6af6,_0x1cfe4e)=>{var _0x24532d=_0x1b615d;_0xd7aafc[_0x1cfe4e][_0x24532d(0x18c)]=_0x1a6af6;}),_0x4c02b8[_0x1b615d(0x1d3)]((_0x308f0a,_0x43df7b)=>{var _0x1283a0=_0x1b615d;_0xd7aafc[_0x43df7b][_0x1283a0(0x1ed)]=_0x308f0a;}),_0x2365ba[_0x1b615d(0x1d3)]((_0x240c05,_0x36e240)=>{_0xd7aafc[_0x36e240]['secondary_unit']=_0x240c05;}),_0x56fba0[_0x1b615d(0x1d3)]((_0x378a45,_0x1c6b0f)=>{_0xd7aafc[_0x1c6b0f]['product_code']=_0x378a45;}),_0x139f01[_0x1b615d(0x1d3)]((_0x1e823c,_0x5b5157)=>{var _0x962501=_0x1b615d;_0xd7aafc[_0x5b5157][_0x962501(0x1f4)]=_0x1e823c;}),_0x4cd86d['forEach']((_0x32b022,_0x3216d5)=>{var _0x3abec4=_0x1b615d;_0xd7aafc[_0x3216d5][_0x3abec4(0x1a0)]=_0x32b022;}),_0x3c632f[_0x1b615d(0x1d3)]((_0x4b2e03,_0x2d2e18)=>{_0xd7aafc[_0x2d2e18]['production_date']=_0x4b2e03;}),_0x2fac4c[_0x1b615d(0x1d3)]((_0x16aedf,_0xb2ab61)=>{var _0x6e2f63=_0x1b615d;_0xd7aafc[_0xb2ab61][_0x6e2f63(0x159)]=_0x16aedf;}),_0x21c114[_0x1b615d(0x1d3)]((_0x497a10,_0x39a5c7)=>{var _0xcf6c12=_0x1b615d;_0xd7aafc[_0x39a5c7][_0xcf6c12(0x1e3)]=_0x497a10;}),_0x38fdd5[_0x1b615d(0x1d3)]((_0x2dde3c,_0x4835b8)=>{var _0x13f75f=_0x1b615d;_0xd7aafc[_0x4835b8][_0x13f75f(0x1c6)]=_0x2dde3c;}),_0x18dc5a[_0x1b615d(0x1d3)]((_0x4c72b7,_0x59a838)=>{var _0x264dd5=_0x1b615d;_0xd7aafc[_0x59a838][_0x264dd5(0x205)]=_0x4c72b7;});const _0x2695ee=_0xd7aafc[_0x1b615d(0x1a9)](_0xc96ac3=>_0xc96ac3[_0x1b615d(0x189)]!=='0'&&_0xc96ac3['adjust_qty']!=='');var _0x174c80=0x0;_0x2695ee[_0x1b615d(0x1d3)](_0x19ba47=>{var _0x4bd1a4=_0x1b615d;console[_0x4bd1a4(0x1cf)](_0x4bd1a4(0x18f),_0x19ba47),parseInt(_0x19ba47[_0x4bd1a4(0x189)])<=0x0&&_0x174c80++;});if(_0x174c80!=0x0)return _0x548e8a[_0x1b615d(0x185)](_0x1b615d(0x1c8),_0x1b615d(0x1a4)),_0x5bc192[_0x1b615d(0x1b0)](_0x1b615d(0x1c3));const _0xdcb628=new adjustment_finished({'warehouse_name':_0x4491a3,'date':_0x2a456b,'product':_0x2695ee,'note':_0x29a306,'room':_0x10fae6,'invoice':_0x1731ca,'JO_number':_0x53e1d3,'expiry_date':_0x2040d3}),_0x590d30=await _0xdcb628[_0x1b615d(0x203)]();_0x548e8a['flash'](_0x1b615d(0x1d2),'adjustment\x20add\x20successfull'),_0x5bc192[_0x1b615d(0x1b0)](_0x1b615d(0x1cb)+_0x590d30[_0x1b615d(0x1a5)]);}catch(_0x3b32e4){console['log'](_0x3b32e4),_0x5bc192[_0x1b615d(0x1c7)](0xc8)[_0x1b615d(0x154)]({'message':_0x3b32e4[_0x1b615d(0x1ef)]});}}),router[a0_0x30ae6f(0x1a3)](a0_0x30ae6f(0x15f),auth,async(_0x551d8d,_0x22e336)=>{var _0x5d96b5=a0_0x30ae6f;try{const {username:_0x5f2cd2,email:_0x5e0aac,role:_0x2b0ee8}=_0x551d8d['user'],_0x35c3ed=_0x551d8d['user'],_0x275fc1=await profile[_0x5d96b5(0x166)]({'email':_0x35c3ed[_0x5d96b5(0x158)]}),_0x11a757=await master_shop[_0x5d96b5(0x17c)](),_0x30c5c4=_0x551d8d[_0x5d96b5(0x16a)]['id'],_0x162bc4=await adjustment_finished[_0x5d96b5(0x1b9)]({'_id':_0x30c5c4}),_0x446294=await purchases['aggregate']([{'$match':{'warehouse_name':_0x162bc4[_0x5d96b5(0x194)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x5d96b5(0x1cf)](_0x5d96b5(0x1fe),_0x446294);const _0x3ef07b=await product['find']({}),_0x3df646=await warehouse[_0x5d96b5(0x1a6)]([{'$match':{'name':_0x162bc4[_0x5d96b5(0x194)],'warehouse_category':_0x5d96b5(0x1d6)}},{'$unwind':_0x5d96b5(0x196)},{'$group':{'_id':_0x5d96b5(0x1fc),'name':{'$first':_0x5d96b5(0x1be)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5d96b5(0x1fa)},'bin':{'$first':_0x5d96b5(0x15e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x5d96b5(0x175)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5d96b5(0x182)},'storage':{'$first':_0x5d96b5(0x169)},'rack':{'$first':_0x5d96b5(0x1f5)},'expiry_date':{'$first':_0x5d96b5(0x152)},'production_date':{'$first':_0x5d96b5(0x171)},'batch_code':{'$first':_0x5d96b5(0x197)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x5d96b5(0x183)}}}]);if(_0x11a757[0x0][_0x5d96b5(0x1f9)]=='English\x20(US)'){var _0x867649=users['English'];console[_0x5d96b5(0x1cf)](_0x867649);}else{if(_0x11a757[0x0]['language']==_0x5d96b5(0x1dd))var _0x867649=users[_0x5d96b5(0x1dd)];else{if(_0x11a757[0x0][_0x5d96b5(0x1f9)]==_0x5d96b5(0x190))var _0x867649=users['German'];else{if(_0x11a757[0x0][_0x5d96b5(0x1f9)]=='Spanish')var _0x867649=users[_0x5d96b5(0x1f7)];else{if(_0x11a757[0x0]['language']==_0x5d96b5(0x17f))var _0x867649=users[_0x5d96b5(0x17f)];else{if(_0x11a757[0x0][_0x5d96b5(0x1f9)]==_0x5d96b5(0x14c))var _0x867649=users['Portuguese'];else{if(_0x11a757[0x0][_0x5d96b5(0x1f9)]=='Chinese')var _0x867649=users[_0x5d96b5(0x1fb)];else{if(_0x11a757[0x0]['language']==_0x5d96b5(0x179))var _0x867649=users['Arabic'];}}}}}}}_0x22e336['render'](_0x5d96b5(0x173),{'success':_0x551d8d[_0x5d96b5(0x185)](_0x5d96b5(0x1d2)),'errors':_0x551d8d[_0x5d96b5(0x185)]('errors'),'role':_0x35c3ed,'profile':_0x275fc1,'adjustment':_0x162bc4,'stock':_0x3df646,'master_shop':_0x11a757,'warehouse_name':_0x446294,'unit':_0x3ef07b,'language':_0x867649});}catch(_0x399fbe){console[_0x5d96b5(0x1cf)](_0x399fbe),_0x22e336[_0x5d96b5(0x1c7)](0xc8)[_0x5d96b5(0x154)]({'message':_0x399fbe[_0x5d96b5(0x1ef)]});}}),router[a0_0x30ae6f(0x1e6)](a0_0x30ae6f(0x15f),auth,async(_0x373af8,_0xcb6f3c)=>{var _0x44c962=a0_0x30ae6f;try{const {invoice:_0x57b17c,warehouse_name:_0x344c0d,Room_name:_0x1f9f16}=_0x373af8[_0x44c962(0x184)],_0x27cfca=_0x373af8[_0x44c962(0x16a)]['id'],_0x40a388=await adjustment_finished[_0x44c962(0x1b9)]({'_id':_0x27cfca});var _0x236b9b;const _0x4bb926=_0x40a388['product'][_0x44c962(0x192)](async _0x379acb=>{var _0x3eadee=_0x44c962;if(_0x379acb[_0x3eadee(0x189)]>0x0){_0x236b9b=await warehouse[_0x3eadee(0x166)]({'name':_0x344c0d,'room':_0x379acb[_0x3eadee(0x1e3)],'warehouse_category':_0x3eadee(0x1d6)});const _0x343ae7=_0x236b9b[_0x3eadee(0x15b)][_0x3eadee(0x192)](_0x491573=>{var _0x444fe1=_0x3eadee;console[_0x444fe1(0x1cf)](_0x379acb['types']);if(_0x379acb[_0x444fe1(0x19e)]==_0x444fe1(0x178))_0x491573[_0x444fe1(0x164)]==_0x379acb[_0x444fe1(0x164)]&&_0x491573['bay']==_0x379acb[_0x444fe1(0x201)]&&_0x491573[_0x444fe1(0x1a0)]==_0x379acb[_0x444fe1(0x1a0)]&&_0x491573['production_date']==_0x379acb[_0x444fe1(0x1c1)]&&_0x491573[_0x444fe1(0x1f4)]==_0x379acb['batch_code']&&_0x491573[_0x444fe1(0x205)]==_0x379acb['invoice']&&(_0x491573[_0x444fe1(0x1c4)]=_0x491573[_0x444fe1(0x1c4)]-_0x379acb['adjust_qty']);else _0x379acb[_0x444fe1(0x19e)]==_0x444fe1(0x16d)&&(_0x491573[_0x444fe1(0x164)]==_0x379acb[_0x444fe1(0x164)]&&_0x491573[_0x444fe1(0x201)]==_0x379acb[_0x444fe1(0x201)]&&_0x491573[_0x444fe1(0x1a0)]==_0x379acb['expiry_date']&&_0x491573[_0x444fe1(0x1c1)]==_0x379acb[_0x444fe1(0x1c1)]&&_0x491573[_0x444fe1(0x1f4)]==_0x379acb[_0x444fe1(0x1f4)]&&_0x491573[_0x444fe1(0x205)]==_0x379acb[_0x444fe1(0x205)]&&(_0x491573['product_stock']=_0x491573['product_stock']+_0x379acb[_0x444fe1(0x189)]));});}return _0x236b9b;});Promise[_0x44c962(0x1ce)](_0x4bb926)['then'](async _0x512196=>{var _0x26f061=_0x44c962;try{for(const _0x4f3e7c of _0x512196){await _0x4f3e7c[_0x26f061(0x203)]();}_0x40a388[_0x26f061(0x20a)]=_0x26f061(0x163);const _0xb08bc2=await _0x40a388[_0x26f061(0x203)](),_0x4d7b7d=await master_shop[_0x26f061(0x17c)](),_0x3d8ec0=await email_settings[_0x26f061(0x166)](),_0x5eb9ad=await supervisor_settings[_0x26f061(0x17c)]();var _0x46bc3e=_0x40a388[_0x26f061(0x1f6)],_0x893adf='',_0x1b8b89;for(_0x1b8b89 in _0x46bc3e){var _0xc9bf1c='FG';_0x40a388[_0x26f061(0x194)]==_0x26f061(0x18b)&&(_0xc9bf1c='DG'),_0x893adf+=_0x26f061(0x180)+_0x26f061(0x156)+_0x46bc3e[_0x1b8b89][_0x26f061(0x164)]+'</td>'+_0x26f061(0x156)+_0x46bc3e[_0x1b8b89][_0x26f061(0x1e8)]+_0x26f061(0x170)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x46bc3e[_0x1b8b89][_0x26f061(0x189)]+_0x26f061(0x170)+_0x26f061(0x156)+_0x46bc3e[_0x1b8b89]['unit']+_0x26f061(0x170)+_0x26f061(0x156)+_0x46bc3e[_0x1b8b89][_0x26f061(0x1dc)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x40a388[_0x26f061(0x194)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x46bc3e[_0x1b8b89]['room_names']+_0x26f061(0x170)+_0x26f061(0x156)+_0xc9bf1c+_0x46bc3e[_0x1b8b89]['bay']+_0x26f061(0x170)+_0x26f061(0x153);}let _0x1eb8a4=nodemailer[_0x26f061(0x188)]({'host':_0x3d8ec0['host'],'port':Number(_0x3d8ec0[_0x26f061(0x16c)]),'secure':![],'auth':{'user':_0x3d8ec0['email'],'pass':_0x3d8ec0['password']}}),_0x191a25={'from':_0x3d8ec0[_0x26f061(0x158)],'to':_0x5eb9ad[0x0]['FGSEmail'],'subject':_0x26f061(0x16e),'attachments':[{'filename':_0x26f061(0x1bf),'path':__dirname+_0x26f061(0x20c)+_0x26f061(0x1bc)+_0x4d7b7d[0x0][_0x26f061(0x206)],'cid':'logo'}],'html':_0x26f061(0x16b)+_0x26f061(0x18a)+'</head><body>'+_0x26f061(0x1ab)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x26f061(0x1ab)+_0x26f061(0x200)+_0x26f061(0x1b3)+'<div>'+_0x26f061(0x157)+_0x4d7b7d[0x0][_0x26f061(0x1a2)]+_0x26f061(0x1ff)+_0x26f061(0x1b3)+_0x26f061(0x1b3)+'<hr\x20class=\x22my-3\x22>'+_0x26f061(0x1ab)+_0x26f061(0x18e)+_0x26f061(0x1e5)+_0x40a388[_0x26f061(0x205)]+'\x20'+_0x26f061(0x1b6)+'\x20Order\x20Date\x20:\x20'+_0x40a388[_0x26f061(0x1e9)]+'\x20'+'</span>'+_0x26f061(0x1d7)+_0x26f061(0x1b3)+_0x26f061(0x1f2)+_0x26f061(0x1c0)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x26f061(0x1a1)+_0x26f061(0x1ad)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x26f061(0x1bb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x26f061(0x150)+'\x20'+_0x893adf+'\x20'+_0x26f061(0x168)+'</table>'+_0x26f061(0x1ab)+_0x26f061(0x167)+_0x26f061(0x15d)+_0x4d7b7d[0x0]['site_title']+_0x26f061(0x1d7)+_0x26f061(0x1b3)+'</div>'+'</body></html>'};_0x1eb8a4[_0x26f061(0x1ae)](_0x191a25,function(_0x567948,_0x158c01){var _0x5d0ff1=_0x26f061;_0x567948?(console[_0x5d0ff1(0x1cf)](_0x567948),console[_0x5d0ff1(0x1cf)]('Error\x20Occurs')):console['log'](_0x5d0ff1(0x204));}),_0x373af8[_0x26f061(0x185)]('success',_0x26f061(0x1d0)),_0xcb6f3c['redirect']('/picking_list/PDF_adjustment/'+_0xb08bc2[_0x26f061(0x1a5)]);}catch(_0x902190){console[_0x26f061(0x18d)](_0x902190),_0xcb6f3c[_0x26f061(0x1c7)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x33418a=>{var _0x596329=_0x44c962;console[_0x596329(0x18d)](_0x33418a),_0xcb6f3c[_0x596329(0x1c7)](0x1f4)[_0x596329(0x154)]({'error':'An\x20error\x20occurred.'});});}catch(_0x18af0b){_0xcb6f3c[_0x44c962(0x154)]({'message':_0x18af0b[_0x44c962(0x1ef)]});}}),router['get'](a0_0x30ae6f(0x1d8),auth,async(_0x22dda5,_0x723721)=>{var _0x165366=a0_0x30ae6f;try{const {username:_0x18f90f,email:_0x4551aa,role:_0x152ec8}=_0x22dda5[_0x165366(0x1f3)],_0x50e5e6=_0x22dda5[_0x165366(0x1f3)],_0x6620eb=await profile[_0x165366(0x166)]({'email':_0x50e5e6['email']}),_0x3657db=await master_shop[_0x165366(0x17c)]();console['log'](_0x165366(0x1e0),_0x3657db);const _0x15a825=_0x22dda5[_0x165366(0x16a)]['id'],_0x30d054=await adjustment_finished['findById']({'_id':_0x15a825});let _0x494983=new Date(_0x30d054[_0x165366(0x1a0)]),_0xeecf75=('0'+_0x494983[_0x165366(0x17d)]())['slice'](-0x2),_0x1b916e=('0'+(_0x494983[_0x165366(0x193)]()+0x1))[_0x165366(0x1d9)](-0x2),_0x16d383=_0x494983[_0x165366(0x207)](),_0x580b4b=_0x16d383+'-'+_0x1b916e+'-'+_0xeecf75;var _0x4be66b=['Ambient','Enclosed',_0x165366(0x19c)];const _0x5279f8=await purchases[_0x165366(0x1a6)]([{'$match':{'warehouse_name':_0x30d054[_0x165366(0x194)]}},{'$unwind':_0x165366(0x191)},{'$group':{'_id':_0x165366(0x181)}}]);console[_0x165366(0x1cf)](_0x165366(0x1fe),_0x5279f8);const _0x5eddfb=await product[_0x165366(0x17c)]({}),_0x4b3cab=await warehouse[_0x165366(0x1a6)]([{'$match':{'name':_0x30d054[_0x165366(0x194)],'room':_0x30d054[_0x165366(0x1c9)]}},{'$unwind':_0x165366(0x196)},{'$group':{'_id':_0x165366(0x1fc),'name':{'$first':_0x165366(0x1be)},'product_stock':{'$first':_0x165366(0x19b)},'bay':{'$first':_0x165366(0x1fa)},'bin':{'$first':_0x165366(0x15e)},'type':{'$first':_0x165366(0x1ba)},'floorlevel':{'$first':_0x165366(0x175)},'primary_code':{'$first':_0x165366(0x202)},'secondary_code':{'$first':_0x165366(0x161)},'product_code':{'$first':_0x165366(0x182)},'storage':{'$first':_0x165366(0x169)},'rack':{'$first':_0x165366(0x1f5)}}}]);if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x186)){var _0xb469b1=users[_0x165366(0x1c5)];console[_0x165366(0x1cf)](_0xb469b1);}else{if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x1dd))var _0xb469b1=users[_0x165366(0x1dd)];else{if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x190))var _0xb469b1=users[_0x165366(0x190)];else{if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x1f7))var _0xb469b1=users[_0x165366(0x1f7)];else{if(_0x3657db[0x0]['language']==_0x165366(0x17f))var _0xb469b1=users[_0x165366(0x17f)];else{if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x14c))var _0xb469b1=users['Portuguese'];else{if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x1fb))var _0xb469b1=users[_0x165366(0x1fb)];else{if(_0x3657db[0x0][_0x165366(0x1f9)]==_0x165366(0x179))var _0xb469b1=users[_0x165366(0x19f)];}}}}}}}_0x723721[_0x165366(0x1b8)](_0x165366(0x208),{'success':_0x22dda5[_0x165366(0x185)]('success'),'errors':_0x22dda5[_0x165366(0x185)]('errors'),'role':_0x50e5e6,'profile':_0x6620eb,'adjustment':_0x30d054,'stock':_0x4b3cab,'master_shop':_0x3657db,'warehouse_name':_0x5279f8,'unit':_0x5eddfb,'language':_0xb469b1,'rooms_data':_0x4be66b,'ed_fullDate':_0x580b4b});}catch(_0x4f2588){console[_0x165366(0x1cf)](_0x4f2588),_0x723721['status'](0xc8)[_0x165366(0x154)]({'message':_0x4f2588[_0x165366(0x1ef)]});}}),router[a0_0x30ae6f(0x1e6)](a0_0x30ae6f(0x1d8),auth,async(_0x4df3a0,_0x25feeb)=>{var _0x4719ac=a0_0x30ae6f;try{const _0x233a07=_0x4df3a0[_0x4719ac(0x16a)]['id'],_0x4929e4=await adjustment_finished[_0x4719ac(0x1b9)]({'_id':_0x233a07}),_0x49c7f3=await warehouse[_0x4719ac(0x166)]({'name':_0x4929e4[_0x4719ac(0x194)],'room':_0x4929e4['room']}),{warehouse_name:_0x4fb87a,date:_0x22aa0d,prod_name:_0x3ff3da,level:_0x2fe4fe,isle:_0x564ca0,pallet:_0x149508,stock:_0x4364e4,types:_0x346d42,adjust_qty:_0x289ea2,new_adjust_qty:_0x4d1233,note:_0x2f6a5a,Room_name:_0x9aeb12,invoice:_0x1bdcfc,JO_number:_0xfb6796}=_0x4df3a0[_0x4719ac(0x184)];if(typeof _0x3ff3da==_0x4719ac(0x14e))var _0x428340=[_0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1b7)]],_0x30981e=[_0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1f0)]],_0x231f5d=[_0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x20b)]],_0x2521f5=[_0x4df3a0[_0x4719ac(0x184)]['types']],_0x9f2a48=[_0x4df3a0['body'][_0x4719ac(0x189)]],_0x1b55fa=[_0x4df3a0[_0x4719ac(0x184)]['new_adjust_qty']],_0x4176ce=[_0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x15c)]],_0x4781ab=[_0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1ed)]],_0x3d8dec=[_0x4df3a0['body'][_0x4719ac(0x20e)]],_0x5dcf26=[_0x4df3a0[_0x4719ac(0x184)]['batch_code']],_0x10d3db=[_0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1a0)]];else var _0x428340=[..._0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1b7)]],_0x30981e=[..._0x4df3a0[_0x4719ac(0x184)]['level']],_0x231f5d=[..._0x4df3a0[_0x4719ac(0x184)]['stock']],_0x2521f5=[..._0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x19e)]],_0x9f2a48=[..._0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x189)]],_0x1b55fa=[..._0x4df3a0['body'][_0x4719ac(0x18c)]],_0x4176ce=[..._0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x15c)]],_0x4781ab=[..._0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1ed)]],_0x3d8dec=[..._0x4df3a0['body'][_0x4719ac(0x20e)]],_0x5dcf26=[..._0x4df3a0['body'][_0x4719ac(0x1f4)]],_0x10d3db=[..._0x4df3a0[_0x4719ac(0x184)][_0x4719ac(0x1a0)]];const _0x4637a5=_0x428340[_0x4719ac(0x192)](_0xb7bbc=>{return _0xb7bbc={'product_name':_0xb7bbc};});_0x30981e[_0x4719ac(0x1d3)]((_0x520bbe,_0x3d1054)=>{var _0x35af59=_0x4719ac;_0x4637a5[_0x3d1054][_0x35af59(0x201)]=_0x520bbe;}),_0x231f5d[_0x4719ac(0x1d3)]((_0x1d5fb1,_0xb94aa7)=>{var _0x4a3688=_0x4719ac;_0x4637a5[_0xb94aa7][_0x4a3688(0x1de)]=_0x1d5fb1;}),_0x2521f5[_0x4719ac(0x1d3)]((_0x4b34ac,_0x47a084)=>{var _0x29e882=_0x4719ac;_0x4637a5[_0x47a084][_0x29e882(0x19e)]=_0x4b34ac;}),_0x9f2a48['forEach']((_0x21f669,_0x2ac473)=>{var _0x3a403d=_0x4719ac;_0x4637a5[_0x2ac473][_0x3a403d(0x189)]=_0x21f669;}),_0x1b55fa[_0x4719ac(0x1d3)]((_0x4e42ed,_0x15e8dd)=>{var _0x9fbaf9=_0x4719ac;_0x4637a5[_0x15e8dd][_0x9fbaf9(0x18c)]=_0x4e42ed;}),_0x4781ab['forEach']((_0x257c7c,_0x540f85)=>{var _0xc5e174=_0x4719ac;_0x4637a5[_0x540f85][_0xc5e174(0x1ed)]=_0x257c7c;}),_0x3d8dec[_0x4719ac(0x1d3)]((_0x14905a,_0x33bd27)=>{_0x4637a5[_0x33bd27]['secondary_unit']=_0x14905a;}),_0x4176ce[_0x4719ac(0x1d3)]((_0x3ee6ad,_0x26eb56)=>{var _0x26a697=_0x4719ac;_0x4637a5[_0x26eb56][_0x26a697(0x1e8)]=_0x3ee6ad;}),_0x5dcf26[_0x4719ac(0x1d3)]((_0x17615b,_0x258c6c)=>{var _0x295931=_0x4719ac;_0x4637a5[_0x258c6c][_0x295931(0x1f4)]=_0x17615b;}),_0x10d3db[_0x4719ac(0x1d3)]((_0x4426df,_0x42b8f9)=>{var _0x545259=_0x4719ac;_0x4637a5[_0x42b8f9][_0x545259(0x1a0)]=_0x4426df;});const _0x4181dd=_0x4637a5[_0x4719ac(0x1a9)](_0x2b8c52=>_0x2b8c52['adjust_qty']!=='0'&&_0x2b8c52['adjust_qty']!=='');var _0x4a0b67=0x0;_0x4181dd[_0x4719ac(0x1d3)](_0x2c8e6a=>{var _0x187757=_0x4719ac;console['log'](_0x187757(0x18f),_0x2c8e6a),parseInt(_0x2c8e6a[_0x187757(0x189)])<=0x0&&_0x4a0b67++;});if(_0x4a0b67!=0x0)return _0x4df3a0[_0x4719ac(0x185)](_0x4719ac(0x1c8),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x25feeb['redirect'](_0x4719ac(0x1c3));_0x4929e4['warehouse_name']=_0x4fb87a,_0x4929e4[_0x4719ac(0x1e9)]=_0x22aa0d,_0x4929e4['product']=_0x4181dd,_0x4929e4[_0x4719ac(0x1c2)]=_0x2f6a5a,_0x4929e4[_0x4719ac(0x1c9)]=_0x9aeb12,_0x4929e4['invoice']=_0x1bdcfc,_0x4929e4['JO_number']=_0xfb6796;const _0xd45674=await _0x4929e4['save'](),_0x2e001b=await warehouse[_0x4719ac(0x166)]({'name':_0x4fb87a,'room':_0x9aeb12});_0xd45674[_0x4719ac(0x1f6)][_0x4719ac(0x1d3)](_0x2b88fe=>{var _0x3f0477=_0x4719ac;const _0x296bb0=_0x2e001b['product_details'][_0x3f0477(0x192)](_0x4d1911=>{var _0x2c3faf=_0x3f0477;_0x2b88fe[_0x2c3faf(0x19e)]=='minus'?_0x4d1911[_0x2c3faf(0x164)]==_0x2b88fe[_0x2c3faf(0x164)]&&_0x4d1911[_0x2c3faf(0x201)]==_0x2b88fe[_0x2c3faf(0x201)]&&(_0x4d1911[_0x2c3faf(0x1c4)]=parseInt(_0x4d1911[_0x2c3faf(0x1c4)])-parseInt(_0x2b88fe['adjust_qty'])):_0x4d1911[_0x2c3faf(0x164)]==_0x2b88fe['product_name']&&_0x4d1911[_0x2c3faf(0x201)]==_0x2b88fe['bay']&&(_0x4d1911[_0x2c3faf(0x1c4)]=parseInt(_0x4d1911[_0x2c3faf(0x1c4)])+parseInt(_0x2b88fe[_0x2c3faf(0x189)]));});}),await _0x2e001b[_0x4719ac(0x203)](),_0x4df3a0['flash']('success',_0x4719ac(0x176)),_0x25feeb['redirect'](_0x4719ac(0x1f8));}catch(_0x4b08b7){console[_0x4719ac(0x1cf)](_0x4b08b7);}}),router[a0_0x30ae6f(0x1e6)](a0_0x30ae6f(0x165),async(_0x164158,_0x649b94)=>{var _0x2a2dfc=a0_0x30ae6f;const {primary_code:_0x35a46a,warehouse_data:_0x833c7f,rooms_data:_0x312804,Roomslist:_0x1d3db5}=_0x164158[_0x2a2dfc(0x184)],_0x2a36a8=_0x1d3db5['split'](','),_0x201d8e=[];async function _0x451405(_0x155149){var _0x2d5ce1=_0x2a2dfc;const _0x48703f=await warehouse[_0x2d5ce1(0x1a6)]([{'$match':{'name':_0x833c7f,'room':_0x155149}},{'$unwind':_0x2d5ce1(0x196)},{'$match':{'product_details.primary_code':_0x35a46a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2d5ce1(0x1be)},'product_stock':{'$first':_0x2d5ce1(0x19b)},'primary_code':{'$first':_0x2d5ce1(0x202)},'secondary_code':{'$first':_0x2d5ce1(0x161)},'product_code':{'$first':_0x2d5ce1(0x182)},'level':{'$first':_0x2d5ce1(0x1fa)},'isle':{'$first':_0x2d5ce1(0x15e)},'type':{'$first':_0x2d5ce1(0x1ba)},'pallet':{'$first':_0x2d5ce1(0x175)},'unit':{'$first':_0x2d5ce1(0x1b4)},'secondary_unit':{'$first':_0x2d5ce1(0x1ec)},'storage':{'$first':_0x2d5ce1(0x169)},'rack':{'$first':_0x2d5ce1(0x1f5)},'expiry_date':{'$first':_0x2d5ce1(0x152)},'production_date':{'$first':_0x2d5ce1(0x171)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2d5ce1(0x1ea)},'roomNamed':{'$first':_0x2d5ce1(0x183)},'invoice':{'$first':_0x2d5ce1(0x1b2)}}}]),_0x108629=await warehouse[_0x2d5ce1(0x1a6)]([{'$match':{'name':_0x833c7f,'room':_0x155149}},{'$unwind':_0x2d5ce1(0x196)},{'$match':{'product_details.secondary_code':_0x35a46a}},{'$group':{'_id':_0x2d5ce1(0x1fc),'name':{'$first':_0x2d5ce1(0x1be)},'product_stock':{'$first':_0x2d5ce1(0x19b)},'primary_code':{'$first':_0x2d5ce1(0x202)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2d5ce1(0x182)},'level':{'$first':_0x2d5ce1(0x1fa)},'isle':{'$first':_0x2d5ce1(0x15e)},'type':{'$first':_0x2d5ce1(0x1ba)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2d5ce1(0x1b4)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2d5ce1(0x169)},'rack':{'$first':_0x2d5ce1(0x1f5)},'expiry_date':{'$first':_0x2d5ce1(0x152)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2d5ce1(0x197)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x2d5ce1(0x1ea)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2d5ce1(0x1b2)}}}]);if(_0x48703f[_0x2d5ce1(0x16f)]>0x0)_0x201d8e[_0x2d5ce1(0x1d1)](_0x48703f);else _0x108629[_0x2d5ce1(0x16f)]>0x0&&_0x201d8e[_0x2d5ce1(0x1d1)](_0x108629);}const _0x42d0b8=_0x2a36a8[_0x2a2dfc(0x192)](_0xc0d684=>_0x451405(_0xc0d684));await Promise[_0x2a2dfc(0x1ce)](_0x42d0b8),_0x649b94['json'](_0x201d8e);}),router[a0_0x30ae6f(0x1e6)](a0_0x30ae6f(0x17a),async(_0x215860,_0x59343c)=>{var _0x1b03ed=a0_0x30ae6f;const {productCode:_0x43a401,bay:_0x525ed3,warehouses:_0x363161,room:_0x4d6f47}=_0x215860[_0x1b03ed(0x184)];console[_0x1b03ed(0x1cf)](_0x215860[_0x1b03ed(0x184)]);try{const _0x57cfb7=await warehouse[_0x1b03ed(0x1a6)]([{'$match':{'name':_0x363161,'room':_0x4d6f47}},{'$unwind':_0x1b03ed(0x196)},{'$match':{'product_details.bay':parseInt(_0x525ed3)}},{'$group':{'_id':_0x1b03ed(0x1fc),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x1b03ed(0x1f1)}}}]);_0x59343c['status'](0xc8)[_0x1b03ed(0x154)](_0x57cfb7);}catch(_0x43cef4){_0x59343c[_0x1b03ed(0x1c7)](0x194)[_0x1b03ed(0x154)]({'message':_0x43cef4['message']});}}),module[a0_0x30ae6f(0x1e7)]=router;