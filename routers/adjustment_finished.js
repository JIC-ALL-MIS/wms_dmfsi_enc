var a0_0x4a6347=a0_0x7e4e;(function(_0x291147,_0x38e6f4){var _0xdc8892=a0_0x7e4e,_0x121573=_0x291147();while(!![]){try{var _0x3caddd=parseInt(_0xdc8892(0x1f6))/0x1+-parseInt(_0xdc8892(0x14c))/0x2+parseInt(_0xdc8892(0x191))/0x3*(parseInt(_0xdc8892(0x1a3))/0x4)+-parseInt(_0xdc8892(0x17e))/0x5+parseInt(_0xdc8892(0x1ee))/0x6+parseInt(_0xdc8892(0x1d5))/0x7+-parseInt(_0xdc8892(0x1a4))/0x8;if(_0x3caddd===_0x38e6f4)break;else _0x121573['push'](_0x121573['shift']());}catch(_0xf00497){_0x121573['push'](_0x121573['shift']());}}}(a0_0x4e44,0xc100e));const express=require(a0_0x4a6347(0x18b)),app=express(),router=express['Router'](),auth=require(a0_0x4a6347(0x192)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x4a6347(0x1c0)),users=require(a0_0x4a6347(0x1ff)),nodemailer=require(a0_0x4a6347(0x1cf));router[a0_0x4a6347(0x1c3)](a0_0x4a6347(0x194),auth,async(_0x4d8337,_0x2498f1)=>{var _0x4da1ea=a0_0x4a6347;try{const {username:_0x4cd938,email:_0x590029,role:_0x21b113}=_0x4d8337[_0x4da1ea(0x1a6)],_0x20b0d6=_0x4d8337[_0x4da1ea(0x1a6)],_0x3975f3=await profile[_0x4da1ea(0x1ca)]({'email':_0x20b0d6[_0x4da1ea(0x1d1)]}),_0x1ded60=await master_shop['find']();let _0x3b3634;if(_0x20b0d6['role']=='staff'){const _0x20c073=await staff[_0x4da1ea(0x1ca)]({'email':_0x20b0d6[_0x4da1ea(0x1d1)]});_0x3b3634=await warehouse['find']({'status':_0x4da1ea(0x156),'name':_0x20c073[_0x4da1ea(0x1d3)]});}else _0x3b3634=await warehouse['find']({'status':_0x4da1ea(0x156)});const _0x14f2a1=await product[_0x4da1ea(0x179)]();let _0x117c0a;if(_0x20b0d6[_0x4da1ea(0x171)]==_0x4da1ea(0x19b)){const _0x248c00=await staff['findOne']({'email':_0x20b0d6[_0x4da1ea(0x1d1)]});_0x117c0a=await adjustment_finished['find']({'warehouse_name':_0x248c00[_0x4da1ea(0x1d3)]});}else _0x117c0a=await adjustment_finished['aggregate']([{'$unwind':_0x4da1ea(0x1bb)},{'$group':{'_id':_0x4da1ea(0x1db),'invoice':{'$first':_0x4da1ea(0x18e)},'date':{'$first':_0x4da1ea(0x1a8)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x4da1ea(0x16c)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1ded60[0x0][_0x4da1ea(0x1c9)]==_0x4da1ea(0x17a)){var _0x59ae23=users[_0x4da1ea(0x1e5)];console[_0x4da1ea(0x143)](_0x59ae23);}else{if(_0x1ded60[0x0]['language']==_0x4da1ea(0x1b3))var _0x59ae23=users['Hindi'];else{if(_0x1ded60[0x0][_0x4da1ea(0x1c9)]=='German')var _0x59ae23=users[_0x4da1ea(0x15e)];else{if(_0x1ded60[0x0][_0x4da1ea(0x1c9)]==_0x4da1ea(0x162))var _0x59ae23=users['Spanish'];else{if(_0x1ded60[0x0][_0x4da1ea(0x1c9)]==_0x4da1ea(0x158))var _0x59ae23=users[_0x4da1ea(0x158)];else{if(_0x1ded60[0x0][_0x4da1ea(0x1c9)]==_0x4da1ea(0x145))var _0x59ae23=users[_0x4da1ea(0x202)];else{if(_0x1ded60[0x0][_0x4da1ea(0x1c9)]==_0x4da1ea(0x1d2))var _0x59ae23=users[_0x4da1ea(0x1d2)];else{if(_0x1ded60[0x0]['language']=='Arabic\x20(ae)')var _0x59ae23=users[_0x4da1ea(0x1f9)];}}}}}}}_0x2498f1[_0x4da1ea(0x1e3)](_0x4da1ea(0x184),{'success':_0x4d8337[_0x4da1ea(0x1be)](_0x4da1ea(0x17b)),'errors':_0x4d8337[_0x4da1ea(0x1be)](_0x4da1ea(0x1f8)),'role':_0x20b0d6,'profile':_0x3975f3,'warehouse':_0x3b3634,'product':_0x14f2a1,'adjustment':_0x117c0a,'master_shop':_0x1ded60,'language':_0x59ae23});}catch(_0x32cf1b){console[_0x4da1ea(0x143)](_0x32cf1b);}});function a0_0x7e4e(_0x5b0f41,_0x8e8c7f){var _0x4e44cc=a0_0x4e44();return a0_0x7e4e=function(_0x7e4ee9,_0x1b128f){_0x7e4ee9=_0x7e4ee9-0x140;var _0x458ec5=_0x4e44cc[_0x7e4ee9];return _0x458ec5;},a0_0x7e4e(_0x5b0f41,_0x8e8c7f);}function a0_0x4e44(){var _0x1e23e1=['add','English','error','push','$product_details.product_code','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details._id','$product_details','body','_id','1870344fMrzuo','stockBefore','expiry_date','New_Qty_Converted','$product_details.bin','sendMail','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','1020173vqUxwZ','date','errors','Arabic','findById','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Rooms','Secondary_units','</table>','../public/language/languages.json','$product_details.expiry_date','</td>','Portuguese','$product_details.primary_code','room_names','back','types','log','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Portuguese\x20(BR)','invoice','message','$product_details.batch_code','product_details','note','json','2044660lZMmQh','maxPerUnit','<h5>','prod_invoice','params','/view/:id','bay','aggregate','/preview/:id','prod_code','Enabled','all','French','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</span>','Adjustment\x20Mail','port','German','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','/CheckingWarehouse','<h2>\x20','Spanish','new_adjust_qty','\x20Order\x20Number\x20:\x20','\x20</h2>','minus','FGSEmail','An\x20error\x20occurred.','adjustment\x20data\x20update\x20successfully','True','padStart','$finalize','/adjustment_finished/preview/','split','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','</tbody>','role','QA\x20Warehouse','<tr>','JO_number','master','save','then','ADJF-','find','English\x20(US)','success','Finished\x20Goods','<html><head><title></title>','3110675SsbsIs','secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','getMonth','length','Logo.png','adjustment_finished','$room','$product_details.rack','<table\x20style=\x22width:\x20100%\x20!important;\x22>','add_adjustment_finished','product_name','<span\x20style=\x22float:\x20right;\x22>','express','</div>','foreach\x20newproduct','$invoice','product_date','$product_details.storage','2878881ClPVdT','../middleware/auth','/adjustment/view','/view','/view/add_adjustment','filter','site_title','getDate','unit','<hr\x20class=\x22my-3\x22>','staff','product_code','level','/barcode_scanner','warehouse_name','toString','$product_details.floorlevel','Arabic\x20(ae)','4jfbELd','1798976JkoHVy','forEach','user','/upload/','$date','catch','Error\x20Occurs','adjustment\x20add\x20successfull','purchases_data','finalize','batch_code','$product_details.product_stock','room','$product_details.secondary_code','post','Hindi','$product_details.invoice','stock','adjust_qty','New_Qty_Converted_adj','random','Enclosed','</tr>','$product','$product.product_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','flash','production_date','../models/all_models','<div>','$product_details.maxPerUnit','get','redirect','floor','status','$product_details.secondary_unit','/adjustment_finished/view','language','findOne','</thead>','getFullYear','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','DRY\x20GOODS','nodemailer','$product_details.production_date','email','Chinese','warehouse','product','2578485kaHGxL','</head><body>','Ambient','$product_details.type','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_name','$_id','map','prod_cat','slice','$product_details.product_name','product_stock','$name','$product_details.bay','render'];a0_0x4e44=function(){return _0x1e23e1;};return a0_0x4e44();}async function getRandom8DigitNumber(){var _0x127bf1=a0_0x4a6347;const _0x45f709=0x989680,_0x2f9f6d=0x5f5e0ff,_0x2e1f92=Math[_0x127bf1(0x1c5)](Math[_0x127bf1(0x1b8)]()*(_0x2f9f6d-_0x45f709+0x1))+_0x45f709;var _0x2dde46;const _0x20c056=await adjustment_finished[_0x127bf1(0x1ca)]({'invoice':_0x127bf1(0x178)+_0x2e1f92});return _0x20c056&&_0x20c056[_0x127bf1(0x182)]>0x0?_0x2dde46='ADJF-'+_0x2e1f92:_0x2dde46=_0x127bf1(0x178)+_0x2e1f92,_0x2dde46;}router[a0_0x4a6347(0x1c3)](a0_0x4a6347(0x195),auth,async(_0x41ec7a,_0x510719)=>{var _0x1e2840=a0_0x4a6347;try{const {username:_0x394c9e,email:_0x4bb91b,role:_0x243eb4}=_0x41ec7a[_0x1e2840(0x1a6)],_0x4fab41=_0x41ec7a[_0x1e2840(0x1a6)],_0x4a69ea=await profile['findOne']({'email':_0x4fab41[_0x1e2840(0x1d1)]}),_0x1b4fad=await master_shop[_0x1e2840(0x179)]();let _0x55f39e;if(_0x4fab41['role']==_0x1e2840(0x19b)){const _0x1a9904=await staff['findOne']({'email':_0x4fab41[_0x1e2840(0x1d1)]});_0x55f39e=await warehouse[_0x1e2840(0x153)]([{'$match':{'status':_0x1e2840(0x156),'name':_0x1a9904[_0x1e2840(0x1d3)],'warehouse_category':_0x1e2840(0x17c),'name':{'$ne':_0x1e2840(0x172)}}},{'$group':{'_id':_0x1e2840(0x1e1),'name':{'$first':'$name'}}}]);}else _0x55f39e=await warehouse['aggregate']([{'$match':{'status':_0x1e2840(0x156),'warehouse_category':_0x1e2840(0x17c),'name':{'$ne':_0x1e2840(0x172)}}},{'$group':{'_id':_0x1e2840(0x1e1),'name':{'$first':_0x1e2840(0x1e1)}}}]);const _0x4e7018=await product['find']({}),_0x428c8e=await adjustment_finished[_0x1e2840(0x179)]({}),_0xe61f15=_0x428c8e[_0x1e2840(0x182)]+0x1,_0x33ce15='ADJF-'+_0xe61f15[_0x1e2840(0x1a0)]()[_0x1e2840(0x16b)](0x5,'0');var _0x43a8ea=[_0x1e2840(0x1d7),_0x1e2840(0x1b9),'Return\x20Rooms'];if(_0x1b4fad[0x0]['language']==_0x1e2840(0x17a))var _0x22aff0=users['English'];else{if(_0x1b4fad[0x0]['language']==_0x1e2840(0x1b3))var _0x22aff0=users['Hindi'];else{if(_0x1b4fad[0x0][_0x1e2840(0x1c9)]==_0x1e2840(0x15e))var _0x22aff0=users['German'];else{if(_0x1b4fad[0x0]['language']=='Spanish')var _0x22aff0=users[_0x1e2840(0x162)];else{if(_0x1b4fad[0x0][_0x1e2840(0x1c9)]=='French')var _0x22aff0=users[_0x1e2840(0x158)];else{if(_0x1b4fad[0x0]['language']==_0x1e2840(0x145))var _0x22aff0=users[_0x1e2840(0x202)];else{if(_0x1b4fad[0x0][_0x1e2840(0x1c9)]==_0x1e2840(0x1d2))var _0x22aff0=users[_0x1e2840(0x1d2)];else{if(_0x1b4fad[0x0][_0x1e2840(0x1c9)]==_0x1e2840(0x1a2))var _0x22aff0=users[_0x1e2840(0x1f9)];}}}}}}}const _0xa2f939=getRandom8DigitNumber();_0xa2f939['then'](_0x478c32=>{var _0x5c51d5=_0x1e2840;_0x510719[_0x5c51d5(0x1e3)](_0x5c51d5(0x188),{'success':_0x41ec7a[_0x5c51d5(0x1be)](_0x5c51d5(0x17b)),'errors':_0x41ec7a[_0x5c51d5(0x1be)](_0x5c51d5(0x1f8)),'role':_0x4fab41,'profile':_0x4a69ea,'warehouse':_0x55f39e,'product':_0x4e7018,'master_shop':_0x1b4fad,'language':_0x22aff0,'rooms_data':_0x43a8ea,'invoice_no':_0x478c32});})[_0x1e2840(0x1a9)](_0x4b0a55=>{var _0x255812=_0x1e2840;_0x41ec7a['flash'](_0x255812(0x1f8),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x510719['redirect'](_0x255812(0x193));});}catch(_0x1816b4){console[_0x1e2840(0x143)](_0x1816b4);}}),router[a0_0x4a6347(0x1b2)](a0_0x4a6347(0x195),auth,async(_0xfc29a1,_0x29eed4)=>{var _0x3f842c=a0_0x4a6347;try{const {warehouse_name:_0x54d3e0,date:_0x363c97,prod_name:_0x5d9d72,level:_0x59ed19,isle:_0x33ff7e,pallet:_0x48a6c6,stock:_0x3120cf,types:_0x3f6b0a,adjust_qty:_0xc607f4,new_adjust_qty:_0x2c4117,note:_0x4e6853,Room_name:_0x377efb,invoice:_0x3c7900,JO_number:_0x2537ca,expiry_date:_0x5c5e4a}=_0xfc29a1[_0x3f842c(0x1ec)];if(typeof _0x5d9d72=='string')var _0x38f48b=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1da)]],_0x17651e=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x19d)]],_0x45459c=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1b5)]],_0x30f7f7=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x142)]],_0xbdccfb=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1b7)]],_0x5b12da=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1f1)]],_0x27e36c=[_0xfc29a1[_0x3f842c(0x1ec)]['Primary_Units']],_0x35794f=[_0xfc29a1['body'][_0x3f842c(0x1fd)]],_0x3f5a4f=[_0xfc29a1[_0x3f842c(0x1ec)]['prod_code']],_0x45fba6=[_0xfc29a1['body']['batch_code']],_0xf1c244=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1f0)]],_0x15977c=[_0xfc29a1[_0x3f842c(0x1ec)]['product_date']],_0x2bcda6=[_0xfc29a1['body'][_0x3f842c(0x1dd)]],_0x165cae=[_0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1fc)]],_0x2f5625=[_0xfc29a1['body']['maxPerUnit']],_0x2df4ef=[_0xfc29a1[_0x3f842c(0x1ec)]['prod_invoice']];else var _0x38f48b=[..._0xfc29a1[_0x3f842c(0x1ec)]['prod_name']],_0x17651e=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x19d)]],_0x45459c=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1b5)]],_0x30f7f7=[..._0xfc29a1[_0x3f842c(0x1ec)]['types']],_0xbdccfb=[..._0xfc29a1['body'][_0x3f842c(0x1b7)]],_0x5b12da=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1f1)]],_0x27e36c=[..._0xfc29a1['body']['Primary_Units']],_0x35794f=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1fd)]],_0x3f5a4f=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x155)]],_0x45fba6=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1ae)]],_0xf1c244=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1f0)]],_0x15977c=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x18f)]],_0x2bcda6=[..._0xfc29a1['body']['prod_cat']],_0x165cae=[..._0xfc29a1[_0x3f842c(0x1ec)][_0x3f842c(0x1fc)]],_0x2f5625=[..._0xfc29a1[_0x3f842c(0x1ec)]['maxPerUnit']],_0x2df4ef=[..._0xfc29a1['body'][_0x3f842c(0x14f)]];const _0x449715=_0x38f48b[_0x3f842c(0x1dc)](_0x5d49b3=>{return _0x5d49b3={'product_name':_0x5d49b3};});_0x17651e[_0x3f842c(0x1a5)]((_0x560c1e,_0x222266)=>{_0x449715[_0x222266]['bay']=_0x560c1e;}),_0x45459c[_0x3f842c(0x1a5)]((_0x2f9ebd,_0x2d95b2)=>{var _0x85ca6f=_0x3f842c;_0x449715[_0x2d95b2][_0x85ca6f(0x1ef)]=_0x2f9ebd;}),_0x30f7f7[_0x3f842c(0x1a5)]((_0x1037c9,_0x49a71b)=>{var _0x2095e4=_0x3f842c;_0x449715[_0x49a71b][_0x2095e4(0x142)]=_0x1037c9;}),_0xbdccfb[_0x3f842c(0x1a5)]((_0x27b11c,_0x415ccb)=>{var _0x298032=_0x3f842c;_0x449715[_0x415ccb][_0x298032(0x1b6)]=_0x27b11c;}),_0x5b12da[_0x3f842c(0x1a5)]((_0x4c5fb2,_0x4e86f1)=>{_0x449715[_0x4e86f1]['new_adjust_qty']=_0x4c5fb2;}),_0x27e36c[_0x3f842c(0x1a5)]((_0x29865d,_0x4594da)=>{var _0x2c031d=_0x3f842c;_0x449715[_0x4594da][_0x2c031d(0x199)]=_0x29865d;}),_0x35794f[_0x3f842c(0x1a5)]((_0x104b3d,_0x2d4a97)=>{var _0x3a6149=_0x3f842c;_0x449715[_0x2d4a97][_0x3a6149(0x17f)]=_0x104b3d;}),_0x3f5a4f[_0x3f842c(0x1a5)]((_0x3403de,_0x1babee)=>{var _0x19c5e6=_0x3f842c;_0x449715[_0x1babee][_0x19c5e6(0x19c)]=_0x3403de;}),_0x45fba6[_0x3f842c(0x1a5)]((_0x319fb6,_0x282ca7)=>{var _0x1dc090=_0x3f842c;_0x449715[_0x282ca7][_0x1dc090(0x1ae)]=_0x319fb6;}),_0xf1c244['forEach']((_0x4a87f0,_0x1358ba)=>{var _0x4d24ce=_0x3f842c;_0x449715[_0x1358ba][_0x4d24ce(0x1f0)]=_0x4a87f0;}),_0x15977c[_0x3f842c(0x1a5)]((_0x2fd9d2,_0x1c5780)=>{var _0x284807=_0x3f842c;_0x449715[_0x1c5780][_0x284807(0x1bf)]=_0x2fd9d2;}),_0x2bcda6[_0x3f842c(0x1a5)]((_0x187542,_0xc498ca)=>{var _0x1cca6e=_0x3f842c;_0x449715[_0xc498ca][_0x1cca6e(0x1dd)]=_0x187542;}),_0x165cae[_0x3f842c(0x1a5)]((_0x35190a,_0x57454a)=>{_0x449715[_0x57454a]['room_names']=_0x35190a;}),_0x2f5625[_0x3f842c(0x1a5)]((_0x5e1702,_0x3d3736)=>{var _0x4fcb02=_0x3f842c;_0x449715[_0x3d3736][_0x4fcb02(0x14d)]=_0x5e1702;}),_0x2df4ef[_0x3f842c(0x1a5)]((_0x48a496,_0x2cc1a6)=>{var _0x4aac1c=_0x3f842c;_0x449715[_0x2cc1a6][_0x4aac1c(0x146)]=_0x48a496;});const _0x273bc9=_0x449715['filter'](_0x3004df=>_0x3004df[_0x3f842c(0x1b6)]!=='0'&&_0x3004df[_0x3f842c(0x1b6)]!=='');var _0x176e72=0x0;_0x273bc9[_0x3f842c(0x1a5)](_0x262382=>{var _0x375629=_0x3f842c;console[_0x375629(0x143)](_0x375629(0x18d),_0x262382),parseInt(_0x262382[_0x375629(0x1b6)])<=0x0&&_0x176e72++;});if(_0x176e72!=0x0)return _0xfc29a1[_0x3f842c(0x1be)](_0x3f842c(0x1f8),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x29eed4[_0x3f842c(0x1c4)](_0x3f842c(0x141));const _0x4e24b7=new adjustment_finished({'warehouse_name':_0x54d3e0,'date':_0x363c97,'product':_0x273bc9,'note':_0x4e6853,'room':_0x377efb,'invoice':_0x3c7900,'JO_number':_0x2537ca,'expiry_date':_0x5c5e4a}),_0x5a7103=await _0x4e24b7[_0x3f842c(0x176)]();_0xfc29a1['flash']('success',_0x3f842c(0x1ab)),_0x29eed4[_0x3f842c(0x1c4)](_0x3f842c(0x16d)+_0x5a7103[_0x3f842c(0x1ed)]);}catch(_0x404b82){console[_0x3f842c(0x143)](_0x404b82),_0x29eed4[_0x3f842c(0x1c6)](0xc8)[_0x3f842c(0x14b)]({'message':_0x404b82[_0x3f842c(0x147)]});}}),router['get'](a0_0x4a6347(0x154),auth,async(_0x24aedc,_0x29428f)=>{var _0x3c6ed1=a0_0x4a6347;try{const {username:_0x45aa67,email:_0x387eb4,role:_0x57a0b4}=_0x24aedc[_0x3c6ed1(0x1a6)],_0x162a25=_0x24aedc['user'],_0x5f3ff3=await profile['findOne']({'email':_0x162a25[_0x3c6ed1(0x1d1)]}),_0x324558=await master_shop[_0x3c6ed1(0x179)](),_0x1b2475=_0x24aedc['params']['id'],_0x23128a=await adjustment_finished[_0x3c6ed1(0x1fa)]({'_id':_0x1b2475}),_0x86019c=await purchases['aggregate']([{'$match':{'warehouse_name':_0x23128a[_0x3c6ed1(0x19f)]}},{'$unwind':_0x3c6ed1(0x1bb)},{'$group':{'_id':_0x3c6ed1(0x1bc)}}]);console[_0x3c6ed1(0x143)](_0x3c6ed1(0x1ac),_0x86019c);const _0x37ef1d=await product[_0x3c6ed1(0x179)]({}),_0x330209=await warehouse[_0x3c6ed1(0x153)]([{'$match':{'name':_0x23128a[_0x3c6ed1(0x19f)],'warehouse_category':_0x3c6ed1(0x17c)}},{'$unwind':_0x3c6ed1(0x1eb)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3c6ed1(0x1df)},'product_stock':{'$first':_0x3c6ed1(0x1af)},'bay':{'$first':_0x3c6ed1(0x1e2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3c6ed1(0x1d8)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3c6ed1(0x203)},'secondary_code':{'$first':_0x3c6ed1(0x1b1)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x3c6ed1(0x190)},'rack':{'$first':_0x3c6ed1(0x186)},'expiry_date':{'$first':_0x3c6ed1(0x200)},'production_date':{'$first':_0x3c6ed1(0x1d0)},'batch_code':{'$first':_0x3c6ed1(0x148)},'maxPerUnit':{'$first':_0x3c6ed1(0x1c2)},'room':{'$first':'$room'}}}]);if(_0x324558[0x0]['language']==_0x3c6ed1(0x17a)){var _0x305fbb=users['English'];console[_0x3c6ed1(0x143)](_0x305fbb);}else{if(_0x324558[0x0]['language']==_0x3c6ed1(0x1b3))var _0x305fbb=users[_0x3c6ed1(0x1b3)];else{if(_0x324558[0x0]['language']==_0x3c6ed1(0x15e))var _0x305fbb=users['German'];else{if(_0x324558[0x0][_0x3c6ed1(0x1c9)]==_0x3c6ed1(0x162))var _0x305fbb=users[_0x3c6ed1(0x162)];else{if(_0x324558[0x0]['language']==_0x3c6ed1(0x158))var _0x305fbb=users['French'];else{if(_0x324558[0x0][_0x3c6ed1(0x1c9)]==_0x3c6ed1(0x145))var _0x305fbb=users[_0x3c6ed1(0x202)];else{if(_0x324558[0x0]['language']=='Chinese')var _0x305fbb=users[_0x3c6ed1(0x1d2)];else{if(_0x324558[0x0][_0x3c6ed1(0x1c9)]=='Arabic\x20(ae)')var _0x305fbb=users[_0x3c6ed1(0x1f9)];}}}}}}}_0x29428f[_0x3c6ed1(0x1e3)]('edit_adjustment_finished_view',{'success':_0x24aedc[_0x3c6ed1(0x1be)](_0x3c6ed1(0x17b)),'errors':_0x24aedc['flash'](_0x3c6ed1(0x1f8)),'role':_0x162a25,'profile':_0x5f3ff3,'adjustment':_0x23128a,'stock':_0x330209,'master_shop':_0x324558,'warehouse_name':_0x86019c,'unit':_0x37ef1d,'language':_0x305fbb});}catch(_0x58dfd4){console[_0x3c6ed1(0x143)](_0x58dfd4),_0x29428f[_0x3c6ed1(0x1c6)](0xc8)[_0x3c6ed1(0x14b)]({'message':_0x58dfd4['message']});}}),router[a0_0x4a6347(0x1b2)](a0_0x4a6347(0x154),auth,async(_0x2c9337,_0x391516)=>{var _0x2e5d1e=a0_0x4a6347;try{const {invoice:_0x1a83aa,warehouse_name:_0x2fd3a6,Room_name:_0x174e60}=_0x2c9337['body'],_0x4d624b=_0x2c9337['params']['id'],_0x3a9c13=await adjustment_finished[_0x2e5d1e(0x1fa)]({'_id':_0x4d624b});var _0x3b5153;const _0xac2ac5=_0x3a9c13[_0x2e5d1e(0x1d4)]['map'](async _0x2c5981=>{var _0x2eaf00=_0x2e5d1e;if(_0x2c5981[_0x2eaf00(0x1b6)]>0x0){_0x3b5153=await warehouse[_0x2eaf00(0x1ca)]({'name':_0x2fd3a6,'room':_0x2c5981[_0x2eaf00(0x140)],'warehouse_category':_0x2eaf00(0x17c)});const _0xd9793=_0x3b5153[_0x2eaf00(0x149)][_0x2eaf00(0x1dc)](_0x16b88e=>{var _0x1e2624=_0x2eaf00;console[_0x1e2624(0x143)](_0x2c5981['types']);if(_0x2c5981[_0x1e2624(0x142)]==_0x1e2624(0x166))_0x16b88e[_0x1e2624(0x189)]==_0x2c5981[_0x1e2624(0x189)]&&_0x16b88e[_0x1e2624(0x152)]==_0x2c5981['bay']&&_0x16b88e[_0x1e2624(0x1f0)]==_0x2c5981[_0x1e2624(0x1f0)]&&_0x16b88e[_0x1e2624(0x1bf)]==_0x2c5981[_0x1e2624(0x1bf)]&&_0x16b88e[_0x1e2624(0x1ae)]==_0x2c5981[_0x1e2624(0x1ae)]&&_0x16b88e[_0x1e2624(0x146)]==_0x2c5981[_0x1e2624(0x146)]&&(_0x16b88e[_0x1e2624(0x1e0)]=_0x16b88e[_0x1e2624(0x1e0)]-_0x2c5981['adjust_qty']);else _0x2c5981['types']==_0x1e2624(0x1e4)&&(_0x16b88e[_0x1e2624(0x189)]==_0x2c5981[_0x1e2624(0x189)]&&_0x16b88e[_0x1e2624(0x152)]==_0x2c5981['bay']&&_0x16b88e['expiry_date']==_0x2c5981[_0x1e2624(0x1f0)]&&_0x16b88e['production_date']==_0x2c5981[_0x1e2624(0x1bf)]&&_0x16b88e[_0x1e2624(0x1ae)]==_0x2c5981[_0x1e2624(0x1ae)]&&_0x16b88e[_0x1e2624(0x146)]==_0x2c5981[_0x1e2624(0x146)]&&(_0x16b88e[_0x1e2624(0x1e0)]=_0x16b88e[_0x1e2624(0x1e0)]+_0x2c5981[_0x1e2624(0x1b6)]));});}return _0x3b5153;});Promise[_0x2e5d1e(0x157)](_0xac2ac5)[_0x2e5d1e(0x177)](async _0x3fd3b4=>{var _0x5d55e2=_0x2e5d1e;try{for(const _0x18094b of _0x3fd3b4){await _0x18094b[_0x5d55e2(0x176)]();}_0x3a9c13[_0x5d55e2(0x1ad)]=_0x5d55e2(0x16a);const _0x193691=await _0x3a9c13['save'](),_0x29b6d1=await master_shop[_0x5d55e2(0x179)](),_0x1470f5=await email_settings[_0x5d55e2(0x1ca)](),_0x96d8c3=await supervisor_settings[_0x5d55e2(0x179)]();var _0x20cd3d=_0x3a9c13['product'],_0x3aaaae='',_0xbbeb59;for(_0xbbeb59 in _0x20cd3d){var _0x50fbad='FG';_0x3a9c13[_0x5d55e2(0x19f)]==_0x5d55e2(0x1ce)&&(_0x50fbad='DG'),_0x3aaaae+=_0x5d55e2(0x173)+_0x5d55e2(0x1d9)+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x189)]+_0x5d55e2(0x201)+_0x5d55e2(0x1d9)+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x19c)]+_0x5d55e2(0x201)+_0x5d55e2(0x1d9)+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x1b6)]+_0x5d55e2(0x201)+_0x5d55e2(0x1d9)+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x199)]+_0x5d55e2(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x17f)]+_0x5d55e2(0x201)+_0x5d55e2(0x1d9)+_0x3a9c13[_0x5d55e2(0x19f)]+_0x5d55e2(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x140)]+_0x5d55e2(0x201)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x50fbad+_0x20cd3d[_0xbbeb59][_0x5d55e2(0x152)]+'</td>'+_0x5d55e2(0x1ba);}let _0x34bdb4=nodemailer['createTransport']({'host':_0x1470f5['host'],'port':Number(_0x1470f5[_0x5d55e2(0x15d)]),'secure':![],'auth':{'user':_0x1470f5['email'],'pass':_0x1470f5['password']}}),_0x198d6b={'from':_0x1470f5[_0x5d55e2(0x1d1)],'to':_0x96d8c3[0x0][_0x5d55e2(0x167)],'subject':_0x5d55e2(0x15c),'attachments':[{'filename':_0x5d55e2(0x183),'path':__dirname+'/../public'+_0x5d55e2(0x1a7)+_0x29b6d1[0x0]['image'],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+_0x5d55e2(0x17d)+_0x5d55e2(0x1d6)+_0x5d55e2(0x1c1)+_0x5d55e2(0x1bd)+'<div>'+_0x5d55e2(0x15f)+_0x5d55e2(0x18c)+'<div>'+_0x5d55e2(0x161)+_0x29b6d1[0x0][_0x5d55e2(0x197)]+_0x5d55e2(0x165)+_0x5d55e2(0x18c)+_0x5d55e2(0x18c)+_0x5d55e2(0x19a)+_0x5d55e2(0x1c1)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x5d55e2(0x164)+_0x3a9c13[_0x5d55e2(0x146)]+'\x20'+_0x5d55e2(0x18a)+'\x20Order\x20Date\x20:\x20'+_0x3a9c13['date']+'\x20'+_0x5d55e2(0x15b)+_0x5d55e2(0x159)+_0x5d55e2(0x18c)+_0x5d55e2(0x187)+_0x5d55e2(0x1f4)+_0x5d55e2(0x173)+_0x5d55e2(0x1fb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x5d55e2(0x180)+_0x5d55e2(0x15a)+_0x5d55e2(0x16f)+_0x5d55e2(0x1cd)+_0x5d55e2(0x144)+_0x5d55e2(0x1f5)+_0x5d55e2(0x1ba)+_0x5d55e2(0x1cb)+_0x5d55e2(0x1e9)+'\x20'+_0x3aaaae+'\x20'+_0x5d55e2(0x170)+_0x5d55e2(0x1fe)+_0x5d55e2(0x1c1)+'<strong>\x20Regards\x20</strong>'+_0x5d55e2(0x14e)+_0x29b6d1[0x0][_0x5d55e2(0x197)]+_0x5d55e2(0x159)+'</div>'+_0x5d55e2(0x18c)+'</body></html>'};_0x34bdb4[_0x5d55e2(0x1f3)](_0x198d6b,function(_0x58bb64,_0x17273f){var _0x4a8624=_0x5d55e2;_0x58bb64?(console[_0x4a8624(0x143)](_0x58bb64),console[_0x4a8624(0x143)](_0x4a8624(0x1aa))):console[_0x4a8624(0x143)]('Email\x20sent\x20successfully');}),_0x2c9337[_0x5d55e2(0x1be)]('success','Adjustment\x20Finalize\x20Successfully'),_0x391516[_0x5d55e2(0x1c4)]('/picking_list/PDF_adjustment/'+_0x193691[_0x5d55e2(0x1ed)]);}catch(_0x1a261f){console[_0x5d55e2(0x1e6)](_0x1a261f),_0x391516[_0x5d55e2(0x1c6)](0x1f4)[_0x5d55e2(0x14b)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x235c4c=>{var _0x126e84=_0x2e5d1e;console[_0x126e84(0x1e6)](_0x235c4c),_0x391516[_0x126e84(0x1c6)](0x1f4)[_0x126e84(0x14b)]({'error':_0x126e84(0x168)});});}catch(_0x14dc6b){_0x391516['json']({'message':_0x14dc6b[_0x2e5d1e(0x147)]});}}),router[a0_0x4a6347(0x1c3)](a0_0x4a6347(0x151),auth,async(_0x1635de,_0x6da3fa)=>{var _0x3ef8f4=a0_0x4a6347;try{const {username:_0x481061,email:_0x3c9ee2,role:_0x29fdba}=_0x1635de[_0x3ef8f4(0x1a6)],_0x3a2363=_0x1635de[_0x3ef8f4(0x1a6)],_0x3a5291=await profile['findOne']({'email':_0x3a2363[_0x3ef8f4(0x1d1)]}),_0x3ea054=await master_shop[_0x3ef8f4(0x179)]();console['log'](_0x3ef8f4(0x175),_0x3ea054);const _0x480792=_0x1635de[_0x3ef8f4(0x150)]['id'],_0x30d6eb=await adjustment_finished[_0x3ef8f4(0x1fa)]({'_id':_0x480792});let _0x29084a=new Date(_0x30d6eb[_0x3ef8f4(0x1f0)]),_0x1eb366=('0'+_0x29084a[_0x3ef8f4(0x198)]())['slice'](-0x2),_0x55ce2e=('0'+(_0x29084a[_0x3ef8f4(0x181)]()+0x1))[_0x3ef8f4(0x1de)](-0x2),_0x17a25f=_0x29084a[_0x3ef8f4(0x1cc)](),_0x4df5bb=_0x17a25f+'-'+_0x55ce2e+'-'+_0x1eb366;var _0x3cf729=[_0x3ef8f4(0x1d7),_0x3ef8f4(0x1b9),'Return\x20Rooms'];const _0x37f02e=await purchases[_0x3ef8f4(0x153)]([{'$match':{'warehouse_name':_0x30d6eb[_0x3ef8f4(0x19f)]}},{'$unwind':_0x3ef8f4(0x1bb)},{'$group':{'_id':_0x3ef8f4(0x1bc)}}]);console[_0x3ef8f4(0x143)](_0x3ef8f4(0x1ac),_0x37f02e);const _0x5c9ec0=await product[_0x3ef8f4(0x179)]({}),_0x2d07df=await warehouse[_0x3ef8f4(0x153)]([{'$match':{'name':_0x30d6eb[_0x3ef8f4(0x19f)],'room':_0x30d6eb[_0x3ef8f4(0x1b0)]}},{'$unwind':_0x3ef8f4(0x1eb)},{'$group':{'_id':_0x3ef8f4(0x1ea),'name':{'$first':_0x3ef8f4(0x1df)},'product_stock':{'$first':_0x3ef8f4(0x1af)},'bay':{'$first':_0x3ef8f4(0x1e2)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x3ef8f4(0x1d8)},'floorlevel':{'$first':_0x3ef8f4(0x1a1)},'primary_code':{'$first':_0x3ef8f4(0x203)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3ef8f4(0x1e8)},'storage':{'$first':_0x3ef8f4(0x190)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x3ea054[0x0][_0x3ef8f4(0x1c9)]=='English\x20(US)'){var _0x591bf4=users[_0x3ef8f4(0x1e5)];console[_0x3ef8f4(0x143)](_0x591bf4);}else{if(_0x3ea054[0x0][_0x3ef8f4(0x1c9)]=='Hindi')var _0x591bf4=users[_0x3ef8f4(0x1b3)];else{if(_0x3ea054[0x0]['language']==_0x3ef8f4(0x15e))var _0x591bf4=users[_0x3ef8f4(0x15e)];else{if(_0x3ea054[0x0]['language']==_0x3ef8f4(0x162))var _0x591bf4=users[_0x3ef8f4(0x162)];else{if(_0x3ea054[0x0][_0x3ef8f4(0x1c9)]==_0x3ef8f4(0x158))var _0x591bf4=users[_0x3ef8f4(0x158)];else{if(_0x3ea054[0x0][_0x3ef8f4(0x1c9)]==_0x3ef8f4(0x145))var _0x591bf4=users[_0x3ef8f4(0x202)];else{if(_0x3ea054[0x0]['language']==_0x3ef8f4(0x1d2))var _0x591bf4=users[_0x3ef8f4(0x1d2)];else{if(_0x3ea054[0x0][_0x3ef8f4(0x1c9)]==_0x3ef8f4(0x1a2))var _0x591bf4=users[_0x3ef8f4(0x1f9)];}}}}}}}_0x6da3fa[_0x3ef8f4(0x1e3)]('edit_adjustment_finished',{'success':_0x1635de['flash'](_0x3ef8f4(0x17b)),'errors':_0x1635de['flash'](_0x3ef8f4(0x1f8)),'role':_0x3a2363,'profile':_0x3a5291,'adjustment':_0x30d6eb,'stock':_0x2d07df,'master_shop':_0x3ea054,'warehouse_name':_0x37f02e,'unit':_0x5c9ec0,'language':_0x591bf4,'rooms_data':_0x3cf729,'ed_fullDate':_0x4df5bb});}catch(_0xa8297c){console['log'](_0xa8297c),_0x6da3fa[_0x3ef8f4(0x1c6)](0xc8)[_0x3ef8f4(0x14b)]({'message':_0xa8297c[_0x3ef8f4(0x147)]});}}),router[a0_0x4a6347(0x1b2)](a0_0x4a6347(0x151),auth,async(_0x2b8794,_0x15caa5)=>{var _0x447d19=a0_0x4a6347;try{const _0x5b445f=_0x2b8794[_0x447d19(0x150)]['id'],_0x279f39=await adjustment_finished[_0x447d19(0x1fa)]({'_id':_0x5b445f}),_0x41fdab=await warehouse[_0x447d19(0x1ca)]({'name':_0x279f39[_0x447d19(0x19f)],'room':_0x279f39[_0x447d19(0x1b0)]}),{warehouse_name:_0x18ccd5,date:_0x75ec14,prod_name:_0x11bd07,level:_0x15bd42,isle:_0x472646,pallet:_0x39b133,stock:_0x3f3212,types:_0x35bf3b,adjust_qty:_0x56f95d,new_adjust_qty:_0x9939cf,note:_0x4ad52c,Room_name:_0x58e84a,invoice:_0x537ea7,JO_number:_0x2b2984}=_0x2b8794[_0x447d19(0x1ec)];if(typeof _0x11bd07=='string')var _0xe5883=[_0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1da)]],_0x5e250d=[_0x2b8794[_0x447d19(0x1ec)]['level']],_0xbe562c=[_0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1b5)]],_0x597d6d=[_0x2b8794['body'][_0x447d19(0x142)]],_0x20b0e2=[_0x2b8794['body']['adjust_qty']],_0x28c45e=[_0x2b8794[_0x447d19(0x1ec)]['new_adjust_qty']],_0x5e4994=[_0x2b8794['body']['prod_code']],_0xc5601d=[_0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x199)]],_0x1ea66c=[_0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1fd)]],_0x1deafb=[_0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1ae)]],_0x2c34d1=[_0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1f0)]];else var _0xe5883=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1da)]],_0x5e250d=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x19d)]],_0xbe562c=[..._0x2b8794[_0x447d19(0x1ec)]['stock']],_0x597d6d=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x142)]],_0x20b0e2=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1b6)]],_0x28c45e=[..._0x2b8794[_0x447d19(0x1ec)]['new_adjust_qty']],_0x5e4994=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x155)]],_0xc5601d=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x199)]],_0x1ea66c=[..._0x2b8794['body'][_0x447d19(0x1fd)]],_0x1deafb=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1ae)]],_0x2c34d1=[..._0x2b8794[_0x447d19(0x1ec)][_0x447d19(0x1f0)]];const _0x242371=_0xe5883['map'](_0x5cd807=>{return _0x5cd807={'product_name':_0x5cd807};});_0x5e250d[_0x447d19(0x1a5)]((_0x296c20,_0x5e395b)=>{var _0x52050d=_0x447d19;_0x242371[_0x5e395b][_0x52050d(0x152)]=_0x296c20;}),_0xbe562c[_0x447d19(0x1a5)]((_0x18516d,_0x22e85b)=>{var _0x3ebfe6=_0x447d19;_0x242371[_0x22e85b][_0x3ebfe6(0x1ef)]=_0x18516d;}),_0x597d6d[_0x447d19(0x1a5)]((_0xa5b9e2,_0x43de93)=>{var _0xe40518=_0x447d19;_0x242371[_0x43de93][_0xe40518(0x142)]=_0xa5b9e2;}),_0x20b0e2[_0x447d19(0x1a5)]((_0x485b7a,_0x3a2880)=>{var _0x4272a3=_0x447d19;_0x242371[_0x3a2880][_0x4272a3(0x1b6)]=_0x485b7a;}),_0x28c45e['forEach']((_0x13adba,_0x3b8c91)=>{var _0x528fa8=_0x447d19;_0x242371[_0x3b8c91][_0x528fa8(0x163)]=_0x13adba;}),_0xc5601d[_0x447d19(0x1a5)]((_0x4d8e21,_0x1a600f)=>{var _0x10f979=_0x447d19;_0x242371[_0x1a600f][_0x10f979(0x199)]=_0x4d8e21;}),_0x1ea66c['forEach']((_0xd0ff54,_0x77513d)=>{_0x242371[_0x77513d]['secondary_unit']=_0xd0ff54;}),_0x5e4994[_0x447d19(0x1a5)]((_0x46e889,_0x33c14d)=>{var _0x33c6f0=_0x447d19;_0x242371[_0x33c14d][_0x33c6f0(0x19c)]=_0x46e889;}),_0x1deafb[_0x447d19(0x1a5)]((_0x2b4491,_0x436c8f)=>{_0x242371[_0x436c8f]['batch_code']=_0x2b4491;}),_0x2c34d1[_0x447d19(0x1a5)]((_0x20d868,_0x9bf3de)=>{var _0x39be2f=_0x447d19;_0x242371[_0x9bf3de][_0x39be2f(0x1f0)]=_0x20d868;});const _0x334992=_0x242371[_0x447d19(0x196)](_0x4eb1ac=>_0x4eb1ac[_0x447d19(0x1b6)]!=='0'&&_0x4eb1ac[_0x447d19(0x1b6)]!=='');var _0x488605=0x0;_0x334992[_0x447d19(0x1a5)](_0x458014=>{var _0x388dd9=_0x447d19;console['log'](_0x388dd9(0x18d),_0x458014),parseInt(_0x458014[_0x388dd9(0x1b6)])<=0x0&&_0x488605++;});if(_0x488605!=0x0)return _0x2b8794[_0x447d19(0x1be)](_0x447d19(0x1f8),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x15caa5[_0x447d19(0x1c4)](_0x447d19(0x141));_0x279f39[_0x447d19(0x19f)]=_0x18ccd5,_0x279f39[_0x447d19(0x1f7)]=_0x75ec14,_0x279f39[_0x447d19(0x1d4)]=_0x334992,_0x279f39[_0x447d19(0x14a)]=_0x4ad52c,_0x279f39[_0x447d19(0x1b0)]=_0x58e84a,_0x279f39[_0x447d19(0x146)]=_0x537ea7,_0x279f39[_0x447d19(0x174)]=_0x2b2984;const _0x5d2c54=await _0x279f39[_0x447d19(0x176)](),_0x41b9e9=await warehouse['findOne']({'name':_0x18ccd5,'room':_0x58e84a});_0x5d2c54[_0x447d19(0x1d4)][_0x447d19(0x1a5)](_0xb41b56=>{var _0x3ca7c8=_0x447d19;const _0xca799b=_0x41b9e9[_0x3ca7c8(0x149)][_0x3ca7c8(0x1dc)](_0x2242a3=>{var _0x176785=_0x3ca7c8;_0xb41b56['types']==_0x176785(0x166)?_0x2242a3['product_name']==_0xb41b56[_0x176785(0x189)]&&_0x2242a3[_0x176785(0x152)]==_0xb41b56[_0x176785(0x152)]&&(_0x2242a3[_0x176785(0x1e0)]=parseInt(_0x2242a3['product_stock'])-parseInt(_0xb41b56[_0x176785(0x1b6)])):_0x2242a3['product_name']==_0xb41b56[_0x176785(0x189)]&&_0x2242a3[_0x176785(0x152)]==_0xb41b56['bay']&&(_0x2242a3['product_stock']=parseInt(_0x2242a3[_0x176785(0x1e0)])+parseInt(_0xb41b56['adjust_qty']));});}),await _0x41b9e9[_0x447d19(0x176)](),_0x2b8794['flash'](_0x447d19(0x17b),_0x447d19(0x169)),_0x15caa5[_0x447d19(0x1c4)](_0x447d19(0x1c8));}catch(_0x58ca4d){console['log'](_0x58ca4d);}}),router[a0_0x4a6347(0x1b2)](a0_0x4a6347(0x19e),async(_0x1b4317,_0x386777)=>{var _0x170491=a0_0x4a6347;const {primary_code:_0x46c956,warehouse_data:_0x429150,rooms_data:_0xa264a6,Roomslist:_0x2c4c9f}=_0x1b4317[_0x170491(0x1ec)],_0x3bb8a2=_0x2c4c9f[_0x170491(0x16e)](','),_0xa9613=[];async function _0x2a67ab(_0x2493de){var _0x42344d=_0x170491;const _0x4999a7=await warehouse[_0x42344d(0x153)]([{'$match':{'name':_0x429150,'room':_0x2493de}},{'$unwind':_0x42344d(0x1eb)},{'$match':{'product_details.primary_code':_0x46c956}},{'$group':{'_id':_0x42344d(0x1ea),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x42344d(0x203)},'secondary_code':{'$first':_0x42344d(0x1b1)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x42344d(0x1a1)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x42344d(0x1c7)},'storage':{'$first':_0x42344d(0x190)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x42344d(0x200)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x42344d(0x148)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x42344d(0x1c2)},'roomNamed':{'$first':_0x42344d(0x185)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x490bce=await warehouse[_0x42344d(0x153)]([{'$match':{'name':_0x429150,'room':_0x2493de}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x46c956}},{'$group':{'_id':_0x42344d(0x1ea),'name':{'$first':_0x42344d(0x1df)},'product_stock':{'$first':_0x42344d(0x1af)},'primary_code':{'$first':_0x42344d(0x203)},'secondary_code':{'$first':_0x42344d(0x1b1)},'product_code':{'$first':_0x42344d(0x1e8)},'level':{'$first':_0x42344d(0x1e2)},'isle':{'$first':_0x42344d(0x1f2)},'type':{'$first':_0x42344d(0x1d8)},'pallet':{'$first':_0x42344d(0x1a1)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x42344d(0x1c7)},'storage':{'$first':_0x42344d(0x190)},'rack':{'$first':_0x42344d(0x186)},'expiry_date':{'$first':_0x42344d(0x200)},'production_date':{'$first':_0x42344d(0x1d0)},'batch_code':{'$first':_0x42344d(0x148)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x42344d(0x1c2)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x42344d(0x1b4)}}}]);if(_0x4999a7['length']>0x0)_0xa9613[_0x42344d(0x1e7)](_0x4999a7);else _0x490bce['length']>0x0&&_0xa9613['push'](_0x490bce);}const _0x79007b=_0x3bb8a2[_0x170491(0x1dc)](_0x215916=>_0x2a67ab(_0x215916));await Promise[_0x170491(0x157)](_0x79007b),_0x386777['json'](_0xa9613);}),router[a0_0x4a6347(0x1b2)](a0_0x4a6347(0x160),async(_0x12bad7,_0x16cd27)=>{var _0x5d3cfc=a0_0x4a6347;const {productCode:_0x5cf59b,bay:_0x40fecd,warehouses:_0x404a74,room:_0x206a66}=_0x12bad7[_0x5d3cfc(0x1ec)];console['log'](_0x12bad7[_0x5d3cfc(0x1ec)]);try{const _0x1c82cb=await warehouse[_0x5d3cfc(0x153)]([{'$match':{'name':_0x404a74,'room':_0x206a66}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x40fecd)}},{'$group':{'_id':_0x5d3cfc(0x1ea),'name':{'$first':_0x5d3cfc(0x1df)},'product_stock':{'$first':_0x5d3cfc(0x1af)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x16cd27['status'](0xc8)[_0x5d3cfc(0x14b)](_0x1c82cb);}catch(_0x30daa5){_0x16cd27[_0x5d3cfc(0x1c6)](0x194)[_0x5d3cfc(0x14b)]({'message':_0x30daa5[_0x5d3cfc(0x147)]});}}),module['exports']=router;