var a0_0x3cf141=a0_0x28bb;function a0_0x41ed(){var _0x1847b1=['$product_details.invoice','stockBefore','all','room','nodemailer','$product_details.floorlevel','then','German','$product_details.unit','master','warehouse','json','product','$product_details.bay','expiry_date','$product_details.type','Ambient','160EIZtrV','sendMail','$product_details.bin','stock','/view/add_adjustment','474056oHGGhq','email','purchases_data','<hr\x20class=\x22my-3\x22>','13884mspXSj','$product.room_names','_id','20380iZKWjR','\x20</h2>','/upload/','Enabled','params','floor','note','product_stock','staff','port','padStart','There\x27s\x20a\x20error\x20in\x20this\x20transaction','/view/:id','$date','logo','date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','edit_adjustment_finished','adjust_qty','$product.product_name','New_Qty_Converted_adj','Router','types','minus','success','redirect','length','</span>','password','$product_details.expiry_date','user','body','finalize','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','</thead>','role','/barcode_scanner','$product_details.primary_code','Hindi','265244eFiVIR','forEach','$product_details.secondary_unit','room_names','</td>','$_id','6dNqaBX','adjustment\x20data\x20update\x20successfully','product_name','Email\x20sent\x20successfully','$product_details.maxPerUnit','True','<strong>\x20Regards\x20</strong>','aggregate','add_adjustment_finished','</div>','<!DOCTYPE\x20html>','host','/../public','errors','getMonth','$name','level','Arabic','An\x20error\x20occurred.','</tr>','split','findById','catch','express','<div>','prod_cat','secondary_unit','findOne','Secondary_units','push','invoice','bay','back','832497LglqGR','maxPerUnit','language','English\x20(US)','flash','English','Return\x20Rooms','$product_details.storage','site_title','$product_details.production_date','createTransport','$product_details','$invoice','$product_details.product_stock','$product_details._id','1767802FKMKrg','\x20Order\x20Number\x20:\x20','find','French','$room','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','map','adjustment\x20add\x20successfull','error','<tbody\x20style=\x22text-align:\x20center;\x22>','production_date','/picking_list/PDF_adjustment/','prod_name','\x20Order\x20Date\x20:\x20','batch_code','</table>','product_code','$product_details.rack','Arabic\x20(ae)','log','../models/all_models','add','prod_invoice','filter','/CheckingWarehouse','string','<h2>\x20','Enclosed','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.batch_code','Rooms','prod_code','new_adjust_qty','</h5>','8191908QQeiXW','Spanish','$finalize','getFullYear','Adjustment\x20Mail','QA\x20Warehouse','toString','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','status','<span\x20style=\x22float:\x20right;\x22>','foreach\x20newproduct','<html><head><title></title>','message','slice','ADJF-','</head><body>','$product_details.secondary_code','DRY\x20GOODS','product_date','Logo.png','getDate','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/adjustment_finished/view','New_Qty_Converted','warehouse_name','Chinese','unit','render','$product','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$warehouse_name','Finished\x20Goods','post','$product_details.product_code','/adjustment/view','save','/adjustment_finished/preview/','adjustment_finished','Portuguese','image','3ffHGFm','Portuguese\x20(BR)'];a0_0x41ed=function(){return _0x1847b1;};return a0_0x41ed();}(function(_0x16c1f4,_0x24d24b){var _0x385cf4=a0_0x28bb,_0x39ffd1=_0x16c1f4();while(!![]){try{var _0x35b7a2=parseInt(_0x385cf4(0x22b))/0x1+-parseInt(_0x385cf4(0x23a))/0x2*(parseInt(_0x385cf4(0x1be))/0x3)+-parseInt(_0x385cf4(0x1da))/0x4*(parseInt(_0x385cf4(0x1d1))/0x5)+-parseInt(_0x385cf4(0x20a))/0x6*(parseInt(_0x385cf4(0x204))/0x7)+-parseInt(_0x385cf4(0x1d6))/0x8+parseInt(_0x385cf4(0x194))/0x9+parseInt(_0x385cf4(0x1dd))/0xa;if(_0x35b7a2===_0x24d24b)break;else _0x39ffd1['push'](_0x39ffd1['shift']());}catch(_0x3ae2c6){_0x39ffd1['push'](_0x39ffd1['shift']());}}}(a0_0x41ed,0x9f551));const express=require(a0_0x3cf141(0x221)),app=express(),router=express[a0_0x3cf141(0x1f2)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x3cf141(0x24e)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x3cf141(0x1c4));router['get']('/view',auth,async(_0x288c70,_0x2cbb76)=>{var _0xeb0e99=a0_0x3cf141;try{const {username:_0xe8bb99,email:_0x14cb4d,role:_0x5dd3eb}=_0x288c70[_0xeb0e99(0x1fb)],_0x31fa56=_0x288c70[_0xeb0e99(0x1fb)],_0x16cb84=await profile['findOne']({'email':_0x31fa56[_0xeb0e99(0x1d7)]}),_0x3fa1ff=await master_shop[_0xeb0e99(0x23c)]();let _0xe0ba6d;if(_0x31fa56[_0xeb0e99(0x200)]==_0xeb0e99(0x1e5)){const _0x3341ab=await staff[_0xeb0e99(0x225)]({'email':_0x31fa56['email']});_0xe0ba6d=await warehouse[_0xeb0e99(0x23c)]({'status':_0xeb0e99(0x1e0),'name':_0x3341ab[_0xeb0e99(0x1ca)]});}else _0xe0ba6d=await warehouse[_0xeb0e99(0x23c)]({'status':_0xeb0e99(0x1e0)});const _0x49a886=await product[_0xeb0e99(0x23c)]();let _0xb21bb6;if(_0x31fa56['role']==_0xeb0e99(0x1e5)){const _0x3769ed=await staff[_0xeb0e99(0x225)]({'email':_0x31fa56[_0xeb0e99(0x1d7)]});_0xb21bb6=await adjustment_finished[_0xeb0e99(0x23c)]({'warehouse_name':_0x3769ed['warehouse']});}else _0xb21bb6=await adjustment_finished[_0xeb0e99(0x211)]([{'$unwind':_0xeb0e99(0x1b1)},{'$group':{'_id':_0xeb0e99(0x209),'invoice':{'$first':_0xeb0e99(0x237)},'date':{'$first':_0xeb0e99(0x1ea)},'warehouse_name':{'$first':_0xeb0e99(0x1b4)},'room':{'$addToSet':_0xeb0e99(0x1db)},'finalize':{'$first':_0xeb0e99(0x196)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]==_0xeb0e99(0x22e)){var _0x3f4c92=users[_0xeb0e99(0x230)];console[_0xeb0e99(0x24d)](_0x3f4c92);}else{if(_0x3fa1ff[0x0]['language']==_0xeb0e99(0x203))var _0x3f4c92=users[_0xeb0e99(0x203)];else{if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]=='German')var _0x3f4c92=users['German'];else{if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]==_0xeb0e99(0x195))var _0x3f4c92=users[_0xeb0e99(0x195)];else{if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]=='French')var _0x3f4c92=users[_0xeb0e99(0x23d)];else{if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]==_0xeb0e99(0x1bf))var _0x3f4c92=users['Portuguese'];else{if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]==_0xeb0e99(0x1ae))var _0x3f4c92=users[_0xeb0e99(0x1ae)];else{if(_0x3fa1ff[0x0][_0xeb0e99(0x22d)]=='Arabic\x20(ae)')var _0x3f4c92=users[_0xeb0e99(0x21b)];}}}}}}}_0x2cbb76[_0xeb0e99(0x1b0)](_0xeb0e99(0x1bb),{'success':_0x288c70[_0xeb0e99(0x22f)]('success'),'errors':_0x288c70[_0xeb0e99(0x22f)](_0xeb0e99(0x217)),'role':_0x31fa56,'profile':_0x16cb84,'warehouse':_0xe0ba6d,'product':_0x49a886,'adjustment':_0xb21bb6,'master_shop':_0x3fa1ff,'language':_0x3f4c92});}catch(_0xdd4225){console[_0xeb0e99(0x24d)](_0xdd4225);}});async function getRandom8DigitNumber(){var _0x304b98=a0_0x3cf141;const _0x33776d=0x989680,_0x581823=0x5f5e0ff,_0x55342e=Math[_0x304b98(0x1e2)](Math['random']()*(_0x581823-_0x33776d+0x1))+_0x33776d;var _0x26432a;const _0x358714=await adjustment_finished['findOne']({'invoice':_0x304b98(0x1a2)+_0x55342e});return _0x358714&&_0x358714['length']>0x0?_0x26432a=_0x304b98(0x1a2)+_0x55342e:_0x26432a=_0x304b98(0x1a2)+_0x55342e,_0x26432a;}function a0_0x28bb(_0xa0eb2d,_0x2cb63b){var _0x41ed5d=a0_0x41ed();return a0_0x28bb=function(_0x28bb5d,_0x1e357d){_0x28bb5d=_0x28bb5d-0x188;var _0x3d8fe3=_0x41ed5d[_0x28bb5d];return _0x3d8fe3;},a0_0x28bb(_0xa0eb2d,_0x2cb63b);}router['get'](a0_0x3cf141(0x1d5),auth,async(_0x38ea5c,_0x3f3ce7)=>{var _0x295ff0=a0_0x3cf141;try{const {username:_0x556636,email:_0x118f64,role:_0x15174e}=_0x38ea5c[_0x295ff0(0x1fb)],_0x2598c0=_0x38ea5c[_0x295ff0(0x1fb)],_0x13695d=await profile[_0x295ff0(0x225)]({'email':_0x2598c0[_0x295ff0(0x1d7)]}),_0x3e9212=await master_shop[_0x295ff0(0x23c)]();let _0x25abdb;if(_0x2598c0[_0x295ff0(0x200)]==_0x295ff0(0x1e5)){const _0x8ab2f0=await staff[_0x295ff0(0x225)]({'email':_0x2598c0[_0x295ff0(0x1d7)]});_0x25abdb=await warehouse[_0x295ff0(0x211)]([{'$match':{'status':_0x295ff0(0x1e0),'name':_0x8ab2f0[_0x295ff0(0x1ca)],'warehouse_category':_0x295ff0(0x1b5),'name':{'$ne':_0x295ff0(0x199)}}},{'$group':{'_id':_0x295ff0(0x219),'name':{'$first':_0x295ff0(0x219)}}}]);}else _0x25abdb=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x295ff0(0x1b5),'name':{'$ne':_0x295ff0(0x199)}}},{'$group':{'_id':_0x295ff0(0x219),'name':{'$first':'$name'}}}]);const _0x53205e=await product[_0x295ff0(0x23c)]({}),_0x33cdd0=await adjustment_finished[_0x295ff0(0x23c)]({}),_0x26c223=_0x33cdd0['length']+0x1,_0x133b47=_0x295ff0(0x1a2)+_0x26c223[_0x295ff0(0x19a)]()[_0x295ff0(0x1e7)](0x5,'0');var _0x27693c=[_0x295ff0(0x1d0),_0x295ff0(0x18d),_0x295ff0(0x231)];if(_0x3e9212[0x0][_0x295ff0(0x22d)]=='English\x20(US)')var _0x2a823d=users[_0x295ff0(0x230)];else{if(_0x3e9212[0x0][_0x295ff0(0x22d)]==_0x295ff0(0x203))var _0x2a823d=users[_0x295ff0(0x203)];else{if(_0x3e9212[0x0][_0x295ff0(0x22d)]==_0x295ff0(0x1c7))var _0x2a823d=users[_0x295ff0(0x1c7)];else{if(_0x3e9212[0x0]['language']==_0x295ff0(0x195))var _0x2a823d=users[_0x295ff0(0x195)];else{if(_0x3e9212[0x0][_0x295ff0(0x22d)]=='French')var _0x2a823d=users[_0x295ff0(0x23d)];else{if(_0x3e9212[0x0][_0x295ff0(0x22d)]=='Portuguese\x20(BR)')var _0x2a823d=users['Portuguese'];else{if(_0x3e9212[0x0][_0x295ff0(0x22d)]==_0x295ff0(0x1ae))var _0x2a823d=users['Chinese'];else{if(_0x3e9212[0x0][_0x295ff0(0x22d)]==_0x295ff0(0x24c))var _0x2a823d=users[_0x295ff0(0x21b)];}}}}}}}const _0x5e252b=getRandom8DigitNumber();_0x5e252b[_0x295ff0(0x1c6)](_0x5b255b=>{var _0x520152=_0x295ff0;_0x3f3ce7[_0x520152(0x1b0)](_0x520152(0x212),{'success':_0x38ea5c[_0x520152(0x22f)](_0x520152(0x1f5)),'errors':_0x38ea5c[_0x520152(0x22f)](_0x520152(0x217)),'role':_0x2598c0,'profile':_0x13695d,'warehouse':_0x25abdb,'product':_0x53205e,'master_shop':_0x3e9212,'language':_0x2a823d,'rooms_data':_0x27693c,'invoice_no':_0x5b255b});})[_0x295ff0(0x220)](_0x5ea5ad=>{var _0x208bea=_0x295ff0;_0x38ea5c[_0x208bea(0x22f)](_0x208bea(0x217),_0x208bea(0x1e8)),_0x3f3ce7[_0x208bea(0x1f6)](_0x208bea(0x1b8));});}catch(_0x2e8e24){console[_0x295ff0(0x24d)](_0x2e8e24);}}),router[a0_0x3cf141(0x1b6)](a0_0x3cf141(0x1d5),auth,async(_0x5c5ff7,_0x4a1be3)=>{var _0x18cb08=a0_0x3cf141;try{const {warehouse_name:_0x19a94e,date:_0x43fd09,prod_name:_0x7304be,level:_0x588fef,isle:_0x16aec5,pallet:_0x475e69,stock:_0x198109,types:_0x8042e0,adjust_qty:_0x14e0d3,new_adjust_qty:_0x52384c,note:_0x52edab,Room_name:_0x30630a,invoice:_0x13e57e,JO_number:_0x1a087d,expiry_date:_0x1cfabb}=_0x5c5ff7[_0x18cb08(0x1fc)];if(typeof _0x7304be=='string')var _0x4542fa=[_0x5c5ff7['body'][_0x18cb08(0x246)]],_0x174602=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x21a)]],_0x2d57bb=[_0x5c5ff7[_0x18cb08(0x1fc)]['stock']],_0x154f88=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1f3)]],_0x16e852=[_0x5c5ff7['body'][_0x18cb08(0x1f1)]],_0x2abc33=[_0x5c5ff7['body'][_0x18cb08(0x1ac)]],_0x9ae1ad=[_0x5c5ff7[_0x18cb08(0x1fc)]['Primary_Units']],_0x110de4=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x226)]],_0x2b24c9=[_0x5c5ff7[_0x18cb08(0x1fc)]['prod_code']],_0x15a866=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x248)]],_0x2befbd=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1ce)]],_0x2e23a9=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1a6)]],_0x4f14ab=[_0x5c5ff7[_0x18cb08(0x1fc)]['prod_cat']],_0x2987b5=[_0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x190)]],_0x1781e1=[_0x5c5ff7[_0x18cb08(0x1fc)]['maxPerUnit']],_0x3604d7=[_0x5c5ff7['body'][_0x18cb08(0x188)]];else var _0x4542fa=[..._0x5c5ff7[_0x18cb08(0x1fc)]['prod_name']],_0x174602=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x21a)]],_0x2d57bb=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1d4)]],_0x154f88=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1f3)]],_0x16e852=[..._0x5c5ff7[_0x18cb08(0x1fc)]['New_Qty_Converted_adj']],_0x2abc33=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1ac)]],_0x9ae1ad=[..._0x5c5ff7[_0x18cb08(0x1fc)]['Primary_Units']],_0x110de4=[..._0x5c5ff7[_0x18cb08(0x1fc)]['Secondary_units']],_0x2b24c9=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x191)]],_0x15a866=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x248)]],_0x2befbd=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1ce)]],_0x2e23a9=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x1a6)]],_0x4f14ab=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x223)]],_0x2987b5=[..._0x5c5ff7['body'][_0x18cb08(0x190)]],_0x1781e1=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x22c)]],_0x3604d7=[..._0x5c5ff7[_0x18cb08(0x1fc)][_0x18cb08(0x188)]];const _0x33a552=_0x4542fa[_0x18cb08(0x240)](_0x4506b2=>{return _0x4506b2={'product_name':_0x4506b2};});_0x174602['forEach']((_0x53e798,_0x58f244)=>{_0x33a552[_0x58f244]['bay']=_0x53e798;}),_0x2d57bb[_0x18cb08(0x205)]((_0x291aee,_0x11cafb)=>{var _0x3218da=_0x18cb08;_0x33a552[_0x11cafb][_0x3218da(0x1c1)]=_0x291aee;}),_0x154f88['forEach']((_0x2faccd,_0x3c33f5)=>{var _0x4a76ac=_0x18cb08;_0x33a552[_0x3c33f5][_0x4a76ac(0x1f3)]=_0x2faccd;}),_0x16e852[_0x18cb08(0x205)]((_0x5be2d7,_0x38a0d7)=>{var _0x1433ef=_0x18cb08;_0x33a552[_0x38a0d7][_0x1433ef(0x1ef)]=_0x5be2d7;}),_0x2abc33[_0x18cb08(0x205)]((_0x51736a,_0x1a3041)=>{var _0x2d0c40=_0x18cb08;_0x33a552[_0x1a3041][_0x2d0c40(0x192)]=_0x51736a;}),_0x9ae1ad[_0x18cb08(0x205)]((_0x532fa3,_0x314364)=>{var _0x30b0fa=_0x18cb08;_0x33a552[_0x314364][_0x30b0fa(0x1af)]=_0x532fa3;}),_0x110de4[_0x18cb08(0x205)]((_0x4729a4,_0x23b10d)=>{_0x33a552[_0x23b10d]['secondary_unit']=_0x4729a4;}),_0x2b24c9[_0x18cb08(0x205)]((_0x45b8df,_0x5bec06)=>{var _0x54bd60=_0x18cb08;_0x33a552[_0x5bec06][_0x54bd60(0x24a)]=_0x45b8df;}),_0x15a866[_0x18cb08(0x205)]((_0x359382,_0x91e1c6)=>{var _0x3f8fbd=_0x18cb08;_0x33a552[_0x91e1c6][_0x3f8fbd(0x248)]=_0x359382;}),_0x2befbd['forEach']((_0x49b7c5,_0x1fdd98)=>{_0x33a552[_0x1fdd98]['expiry_date']=_0x49b7c5;}),_0x2e23a9['forEach']((_0x2a46e1,_0x43e72a)=>{var _0x1180a2=_0x18cb08;_0x33a552[_0x43e72a][_0x1180a2(0x244)]=_0x2a46e1;}),_0x4f14ab[_0x18cb08(0x205)]((_0x1aece6,_0x41e927)=>{_0x33a552[_0x41e927]['prod_cat']=_0x1aece6;}),_0x2987b5[_0x18cb08(0x205)]((_0x3ae366,_0x252c78)=>{var _0xcbde6d=_0x18cb08;_0x33a552[_0x252c78][_0xcbde6d(0x207)]=_0x3ae366;}),_0x1781e1['forEach']((_0x116907,_0xb944d5)=>{var _0x76c55e=_0x18cb08;_0x33a552[_0xb944d5][_0x76c55e(0x22c)]=_0x116907;}),_0x3604d7[_0x18cb08(0x205)]((_0x1cc8c5,_0x22c086)=>{var _0x1ab3ee=_0x18cb08;_0x33a552[_0x22c086][_0x1ab3ee(0x228)]=_0x1cc8c5;});const _0xf34730=_0x33a552[_0x18cb08(0x189)](_0x145ded=>_0x145ded[_0x18cb08(0x1ef)]!=='0'&&_0x145ded[_0x18cb08(0x1ef)]!=='');var _0x36a0a7=0x0;_0xf34730[_0x18cb08(0x205)](_0x236b12=>{var _0x21c6ab=_0x18cb08;console[_0x21c6ab(0x24d)]('foreach\x20newproduct',_0x236b12),parseInt(_0x236b12['adjust_qty'])<=0x0&&_0x36a0a7++;});if(_0x36a0a7!=0x0)return _0x5c5ff7[_0x18cb08(0x22f)](_0x18cb08(0x217),_0x18cb08(0x18e)),_0x4a1be3[_0x18cb08(0x1f6)](_0x18cb08(0x22a));const _0x25c95a=new adjustment_finished({'warehouse_name':_0x19a94e,'date':_0x43fd09,'product':_0xf34730,'note':_0x52edab,'room':_0x30630a,'invoice':_0x13e57e,'JO_number':_0x1a087d,'expiry_date':_0x1cfabb}),_0x331fa9=await _0x25c95a[_0x18cb08(0x1b9)]();_0x5c5ff7[_0x18cb08(0x22f)](_0x18cb08(0x1f5),_0x18cb08(0x241)),_0x4a1be3[_0x18cb08(0x1f6)](_0x18cb08(0x1ba)+_0x331fa9[_0x18cb08(0x1dc)]);}catch(_0x23726d){console[_0x18cb08(0x24d)](_0x23726d),_0x4a1be3[_0x18cb08(0x19c)](0xc8)[_0x18cb08(0x1cb)]({'message':_0x23726d[_0x18cb08(0x1a0)]});}}),router['get']('/preview/:id',auth,async(_0x25679,_0x4fc70b)=>{var _0x32d87e=a0_0x3cf141;try{const {username:_0x5e8e01,email:_0x259d8d,role:_0x205ad5}=_0x25679['user'],_0x193ebc=_0x25679['user'],_0x289315=await profile[_0x32d87e(0x225)]({'email':_0x193ebc[_0x32d87e(0x1d7)]}),_0x1520a2=await master_shop[_0x32d87e(0x23c)](),_0x21ff85=_0x25679[_0x32d87e(0x1e1)]['id'],_0x50be3d=await adjustment_finished[_0x32d87e(0x21f)]({'_id':_0x21ff85}),_0x12a852=await purchases[_0x32d87e(0x211)]([{'$match':{'warehouse_name':_0x50be3d[_0x32d87e(0x1ad)]}},{'$unwind':_0x32d87e(0x1b1)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x12a852);const _0x4cc7aa=await product[_0x32d87e(0x23c)]({}),_0x388ad4=await warehouse[_0x32d87e(0x211)]([{'$match':{'name':_0x50be3d[_0x32d87e(0x1ad)],'warehouse_category':_0x32d87e(0x1b5)}},{'$unwind':_0x32d87e(0x236)},{'$group':{'_id':_0x32d87e(0x239),'name':{'$first':_0x32d87e(0x1a9)},'product_stock':{'$first':_0x32d87e(0x238)},'bay':{'$first':_0x32d87e(0x1cd)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x32d87e(0x1a4)},'product_code':{'$first':_0x32d87e(0x1b7)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x32d87e(0x1fa)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x32d87e(0x18f)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x32d87e(0x23e)}}}]);if(_0x1520a2[0x0][_0x32d87e(0x22d)]=='English\x20(US)'){var _0x135509=users[_0x32d87e(0x230)];console[_0x32d87e(0x24d)](_0x135509);}else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]==_0x32d87e(0x203))var _0x135509=users[_0x32d87e(0x203)];else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]==_0x32d87e(0x1c7))var _0x135509=users['German'];else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]=='Spanish')var _0x135509=users[_0x32d87e(0x195)];else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]==_0x32d87e(0x23d))var _0x135509=users['French'];else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]==_0x32d87e(0x1bf))var _0x135509=users['Portuguese'];else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]=='Chinese')var _0x135509=users[_0x32d87e(0x1ae)];else{if(_0x1520a2[0x0][_0x32d87e(0x22d)]==_0x32d87e(0x24c))var _0x135509=users[_0x32d87e(0x21b)];}}}}}}}_0x4fc70b[_0x32d87e(0x1b0)]('edit_adjustment_finished_view',{'success':_0x25679[_0x32d87e(0x22f)](_0x32d87e(0x1f5)),'errors':_0x25679[_0x32d87e(0x22f)](_0x32d87e(0x217)),'role':_0x193ebc,'profile':_0x289315,'adjustment':_0x50be3d,'stock':_0x388ad4,'master_shop':_0x1520a2,'warehouse_name':_0x12a852,'unit':_0x4cc7aa,'language':_0x135509});}catch(_0x3d110c){console[_0x32d87e(0x24d)](_0x3d110c),_0x4fc70b[_0x32d87e(0x19c)](0xc8)[_0x32d87e(0x1cb)]({'message':_0x3d110c[_0x32d87e(0x1a0)]});}}),router['post']('/preview/:id',auth,async(_0x2485b6,_0xd50afe)=>{var _0xba143f=a0_0x3cf141;try{const {invoice:_0x344c47,warehouse_name:_0x1f0702,Room_name:_0x31ccd1}=_0x2485b6[_0xba143f(0x1fc)],_0x3074d3=_0x2485b6['params']['id'],_0x2de444=await adjustment_finished['findById']({'_id':_0x3074d3});var _0x3fda97;const _0xb6ad62=_0x2de444[_0xba143f(0x1cc)][_0xba143f(0x240)](async _0x1f0750=>{var _0x3804d4=_0xba143f;if(_0x1f0750['adjust_qty']>0x0){_0x3fda97=await warehouse[_0x3804d4(0x225)]({'name':_0x1f0702,'room':_0x1f0750[_0x3804d4(0x207)],'warehouse_category':'Finished\x20Goods'});const _0x26183d=_0x3fda97['product_details'][_0x3804d4(0x240)](_0x5bd66c=>{var _0xcbc5ae=_0x3804d4;console[_0xcbc5ae(0x24d)](_0x1f0750[_0xcbc5ae(0x1f3)]);if(_0x1f0750['types']==_0xcbc5ae(0x1f4))_0x5bd66c[_0xcbc5ae(0x20c)]==_0x1f0750[_0xcbc5ae(0x20c)]&&_0x5bd66c[_0xcbc5ae(0x229)]==_0x1f0750[_0xcbc5ae(0x229)]&&_0x5bd66c[_0xcbc5ae(0x1ce)]==_0x1f0750[_0xcbc5ae(0x1ce)]&&_0x5bd66c[_0xcbc5ae(0x244)]==_0x1f0750[_0xcbc5ae(0x244)]&&_0x5bd66c['batch_code']==_0x1f0750['batch_code']&&_0x5bd66c['invoice']==_0x1f0750[_0xcbc5ae(0x228)]&&(_0x5bd66c[_0xcbc5ae(0x1e4)]=_0x5bd66c['product_stock']-_0x1f0750[_0xcbc5ae(0x1ef)]);else _0x1f0750[_0xcbc5ae(0x1f3)]==_0xcbc5ae(0x24f)&&(_0x5bd66c[_0xcbc5ae(0x20c)]==_0x1f0750[_0xcbc5ae(0x20c)]&&_0x5bd66c[_0xcbc5ae(0x229)]==_0x1f0750['bay']&&_0x5bd66c[_0xcbc5ae(0x1ce)]==_0x1f0750[_0xcbc5ae(0x1ce)]&&_0x5bd66c[_0xcbc5ae(0x244)]==_0x1f0750[_0xcbc5ae(0x244)]&&_0x5bd66c['batch_code']==_0x1f0750[_0xcbc5ae(0x248)]&&_0x5bd66c[_0xcbc5ae(0x228)]==_0x1f0750['invoice']&&(_0x5bd66c[_0xcbc5ae(0x1e4)]=_0x5bd66c['product_stock']+_0x1f0750['adjust_qty']));});}return _0x3fda97;});Promise['all'](_0xb6ad62)[_0xba143f(0x1c6)](async _0x1abdc2=>{var _0x159298=_0xba143f;try{for(const _0x344007 of _0x1abdc2){await _0x344007[_0x159298(0x1b9)]();}_0x2de444[_0x159298(0x1fd)]=_0x159298(0x20f);const _0x36b851=await _0x2de444[_0x159298(0x1b9)](),_0x14041a=await master_shop[_0x159298(0x23c)](),_0xc273a8=await email_settings[_0x159298(0x225)](),_0x5c4c2d=await supervisor_settings['find']();var _0x1780d8=_0x2de444[_0x159298(0x1cc)],_0x44d5e7='',_0x20055f;for(_0x20055f in _0x1780d8){var _0x4ebacd='FG';_0x2de444[_0x159298(0x1ad)]==_0x159298(0x1a5)&&(_0x4ebacd='DG'),_0x44d5e7+='<tr>'+_0x159298(0x1b2)+_0x1780d8[_0x20055f][_0x159298(0x20c)]+_0x159298(0x208)+_0x159298(0x1b2)+_0x1780d8[_0x20055f][_0x159298(0x24a)]+_0x159298(0x208)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1780d8[_0x20055f]['adjust_qty']+_0x159298(0x208)+_0x159298(0x1b2)+_0x1780d8[_0x20055f][_0x159298(0x1af)]+_0x159298(0x208)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1780d8[_0x20055f][_0x159298(0x224)]+'</td>'+_0x159298(0x1b2)+_0x2de444[_0x159298(0x1ad)]+'</td>'+_0x159298(0x1b2)+_0x1780d8[_0x20055f][_0x159298(0x207)]+_0x159298(0x208)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4ebacd+_0x1780d8[_0x20055f][_0x159298(0x229)]+_0x159298(0x208)+_0x159298(0x21d);}let _0x118ab6=nodemailer[_0x159298(0x235)]({'host':_0xc273a8[_0x159298(0x215)],'port':Number(_0xc273a8[_0x159298(0x1e6)]),'secure':![],'auth':{'user':_0xc273a8['email'],'pass':_0xc273a8[_0x159298(0x1f9)]}}),_0x487b9c={'from':_0xc273a8[_0x159298(0x1d7)],'to':_0x5c4c2d[0x0]['FGSEmail'],'subject':_0x159298(0x198),'attachments':[{'filename':_0x159298(0x1a7),'path':__dirname+_0x159298(0x216)+_0x159298(0x1df)+_0x14041a[0x0][_0x159298(0x1bd)],'cid':_0x159298(0x1eb)}],'html':_0x159298(0x214)+_0x159298(0x19f)+_0x159298(0x1a3)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x159298(0x222)+_0x159298(0x23f)+_0x159298(0x213)+'<div>'+_0x159298(0x18c)+_0x14041a[0x0][_0x159298(0x233)]+_0x159298(0x1de)+'</div>'+'</div>'+_0x159298(0x1d9)+_0x159298(0x222)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x159298(0x23b)+_0x2de444['invoice']+'\x20'+_0x159298(0x19d)+_0x159298(0x247)+_0x2de444[_0x159298(0x1ec)]+'\x20'+_0x159298(0x1f8)+'</h5>'+_0x159298(0x213)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x159298(0x1b3)+'<tr>'+_0x159298(0x1fe)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x159298(0x19b)+_0x159298(0x1ed)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x159298(0x1aa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x159298(0x21d)+_0x159298(0x1ff)+_0x159298(0x243)+'\x20'+_0x44d5e7+'\x20'+'</tbody>'+_0x159298(0x249)+_0x159298(0x222)+_0x159298(0x210)+'<h5>'+_0x14041a[0x0][_0x159298(0x233)]+_0x159298(0x193)+_0x159298(0x213)+_0x159298(0x213)+'</body></html>'};_0x118ab6[_0x159298(0x1d2)](_0x487b9c,function(_0x535dbc,_0x2ace1c){var _0x44025b=_0x159298;_0x535dbc?(console[_0x44025b(0x24d)](_0x535dbc),console[_0x44025b(0x24d)]('Error\x20Occurs')):console[_0x44025b(0x24d)](_0x44025b(0x20d));}),_0x2485b6[_0x159298(0x22f)](_0x159298(0x1f5),'Adjustment\x20Finalize\x20Successfully'),_0xd50afe['redirect'](_0x159298(0x245)+_0x36b851[_0x159298(0x1dc)]);}catch(_0x48ccab){console[_0x159298(0x242)](_0x48ccab),_0xd50afe['status'](0x1f4)[_0x159298(0x1cb)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0xba143f(0x220)](_0x3e1696=>{var _0x32a039=_0xba143f;console['error'](_0x3e1696),_0xd50afe[_0x32a039(0x19c)](0x1f4)['json']({'error':_0x32a039(0x21c)});});}catch(_0x4b87dc){_0xd50afe[_0xba143f(0x1cb)]({'message':_0x4b87dc['message']});}}),router['get']('/view/:id',auth,async(_0x403679,_0xe2262)=>{var _0x382f59=a0_0x3cf141;try{const {username:_0x4e1732,email:_0x21ca67,role:_0x4ce880}=_0x403679[_0x382f59(0x1fb)],_0x47046e=_0x403679[_0x382f59(0x1fb)],_0x263cfe=await profile[_0x382f59(0x225)]({'email':_0x47046e[_0x382f59(0x1d7)]}),_0x1dea48=await master_shop[_0x382f59(0x23c)]();console[_0x382f59(0x24d)](_0x382f59(0x1c9),_0x1dea48);const _0x3f8422=_0x403679[_0x382f59(0x1e1)]['id'],_0x462ce5=await adjustment_finished[_0x382f59(0x21f)]({'_id':_0x3f8422});let _0x44831b=new Date(_0x462ce5['expiry_date']),_0x3db6c0=('0'+_0x44831b[_0x382f59(0x1a8)]())[_0x382f59(0x1a1)](-0x2),_0x37875e=('0'+(_0x44831b[_0x382f59(0x218)]()+0x1))[_0x382f59(0x1a1)](-0x2),_0x17b970=_0x44831b[_0x382f59(0x197)](),_0x297d88=_0x17b970+'-'+_0x37875e+'-'+_0x3db6c0;var _0x5a5157=[_0x382f59(0x1d0),_0x382f59(0x18d),_0x382f59(0x231)];const _0xfee61=await purchases['aggregate']([{'$match':{'warehouse_name':_0x462ce5[_0x382f59(0x1ad)]}},{'$unwind':_0x382f59(0x1b1)},{'$group':{'_id':_0x382f59(0x1f0)}}]);console[_0x382f59(0x24d)](_0x382f59(0x1d8),_0xfee61);const _0x209162=await product['find']({}),_0x255f40=await warehouse[_0x382f59(0x211)]([{'$match':{'name':_0x462ce5['warehouse_name'],'room':_0x462ce5[_0x382f59(0x1c3)]}},{'$unwind':_0x382f59(0x236)},{'$group':{'_id':_0x382f59(0x239),'name':{'$first':_0x382f59(0x1a9)},'product_stock':{'$first':_0x382f59(0x238)},'bay':{'$first':_0x382f59(0x1cd)},'bin':{'$first':_0x382f59(0x1d3)},'type':{'$first':_0x382f59(0x1cf)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x382f59(0x202)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x382f59(0x1b7)},'storage':{'$first':_0x382f59(0x232)},'rack':{'$first':_0x382f59(0x24b)}}}]);if(_0x1dea48[0x0][_0x382f59(0x22d)]==_0x382f59(0x22e)){var _0x5ba573=users[_0x382f59(0x230)];console[_0x382f59(0x24d)](_0x5ba573);}else{if(_0x1dea48[0x0]['language']=='Hindi')var _0x5ba573=users[_0x382f59(0x203)];else{if(_0x1dea48[0x0][_0x382f59(0x22d)]==_0x382f59(0x1c7))var _0x5ba573=users['German'];else{if(_0x1dea48[0x0][_0x382f59(0x22d)]=='Spanish')var _0x5ba573=users[_0x382f59(0x195)];else{if(_0x1dea48[0x0][_0x382f59(0x22d)]=='French')var _0x5ba573=users[_0x382f59(0x23d)];else{if(_0x1dea48[0x0][_0x382f59(0x22d)]=='Portuguese\x20(BR)')var _0x5ba573=users[_0x382f59(0x1bc)];else{if(_0x1dea48[0x0][_0x382f59(0x22d)]==_0x382f59(0x1ae))var _0x5ba573=users['Chinese'];else{if(_0x1dea48[0x0]['language']=='Arabic\x20(ae)')var _0x5ba573=users[_0x382f59(0x21b)];}}}}}}}_0xe2262['render'](_0x382f59(0x1ee),{'success':_0x403679[_0x382f59(0x22f)]('success'),'errors':_0x403679['flash'](_0x382f59(0x217)),'role':_0x47046e,'profile':_0x263cfe,'adjustment':_0x462ce5,'stock':_0x255f40,'master_shop':_0x1dea48,'warehouse_name':_0xfee61,'unit':_0x209162,'language':_0x5ba573,'rooms_data':_0x5a5157,'ed_fullDate':_0x297d88});}catch(_0x1fff2b){console[_0x382f59(0x24d)](_0x1fff2b),_0xe2262[_0x382f59(0x19c)](0xc8)['json']({'message':_0x1fff2b[_0x382f59(0x1a0)]});}}),router[a0_0x3cf141(0x1b6)](a0_0x3cf141(0x1e9),auth,async(_0x2fe245,_0x1e7592)=>{var _0x5abe42=a0_0x3cf141;try{const _0x16542d=_0x2fe245['params']['id'],_0x20eae1=await adjustment_finished[_0x5abe42(0x21f)]({'_id':_0x16542d}),_0xf88a24=await warehouse[_0x5abe42(0x225)]({'name':_0x20eae1[_0x5abe42(0x1ad)],'room':_0x20eae1[_0x5abe42(0x1c3)]}),{warehouse_name:_0x2ace71,date:_0x2a5cdc,prod_name:_0x5d1eb5,level:_0x373ed0,isle:_0x3cecee,pallet:_0x17b7fe,stock:_0x2b2d3c,types:_0x34c78e,adjust_qty:_0x52b0d6,new_adjust_qty:_0x3510e4,note:_0x1e1ef1,Room_name:_0x21b7b4,invoice:_0x3063e1,JO_number:_0xe33c1f}=_0x2fe245['body'];if(typeof _0x5d1eb5==_0x5abe42(0x18b))var _0x48bcfb=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x246)]],_0x261bde=[_0x2fe245['body'][_0x5abe42(0x21a)]],_0x5b4581=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x1d4)]],_0x4545e4=[_0x2fe245[_0x5abe42(0x1fc)]['types']],_0x5c7cab=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x1ef)]],_0x3ed3b2=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x192)]],_0x599650=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x191)]],_0x3ddb82=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x1af)]],_0x2645e2=[_0x2fe245['body']['Secondary_units']],_0x4feb20=[_0x2fe245['body'][_0x5abe42(0x248)]],_0x20122b=[_0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x1ce)]];else var _0x48bcfb=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x246)]],_0x261bde=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x21a)]],_0x5b4581=[..._0x2fe245['body'][_0x5abe42(0x1d4)]],_0x4545e4=[..._0x2fe245['body']['types']],_0x5c7cab=[..._0x2fe245[_0x5abe42(0x1fc)]['adjust_qty']],_0x3ed3b2=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x192)]],_0x599650=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x191)]],_0x3ddb82=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x1af)]],_0x2645e2=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x226)]],_0x4feb20=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x248)]],_0x20122b=[..._0x2fe245[_0x5abe42(0x1fc)][_0x5abe42(0x1ce)]];const _0xfce570=_0x48bcfb[_0x5abe42(0x240)](_0x42866e=>{return _0x42866e={'product_name':_0x42866e};});_0x261bde['forEach']((_0x56678b,_0x3abd7e)=>{var _0x5ea0ac=_0x5abe42;_0xfce570[_0x3abd7e][_0x5ea0ac(0x229)]=_0x56678b;}),_0x5b4581['forEach']((_0x59a263,_0x12f874)=>{var _0x12faea=_0x5abe42;_0xfce570[_0x12f874][_0x12faea(0x1c1)]=_0x59a263;}),_0x4545e4[_0x5abe42(0x205)]((_0x21c38e,_0x3d5452)=>{var _0xc9abb2=_0x5abe42;_0xfce570[_0x3d5452][_0xc9abb2(0x1f3)]=_0x21c38e;}),_0x5c7cab[_0x5abe42(0x205)]((_0x528f0d,_0x27f67b)=>{var _0x20015c=_0x5abe42;_0xfce570[_0x27f67b][_0x20015c(0x1ef)]=_0x528f0d;}),_0x3ed3b2[_0x5abe42(0x205)]((_0x38e760,_0x1bb5ca)=>{_0xfce570[_0x1bb5ca]['new_adjust_qty']=_0x38e760;}),_0x3ddb82[_0x5abe42(0x205)]((_0x3ffabf,_0x57cf2b)=>{var _0x480a5c=_0x5abe42;_0xfce570[_0x57cf2b][_0x480a5c(0x1af)]=_0x3ffabf;}),_0x2645e2[_0x5abe42(0x205)]((_0x50e84b,_0x24bea4)=>{_0xfce570[_0x24bea4]['secondary_unit']=_0x50e84b;}),_0x599650[_0x5abe42(0x205)]((_0x190d01,_0x38f06d)=>{var _0x47722b=_0x5abe42;_0xfce570[_0x38f06d][_0x47722b(0x24a)]=_0x190d01;}),_0x4feb20['forEach']((_0x5b2f67,_0x2c43ae)=>{var _0xbb75c4=_0x5abe42;_0xfce570[_0x2c43ae][_0xbb75c4(0x248)]=_0x5b2f67;}),_0x20122b['forEach']((_0x47ae67,_0x42e372)=>{var _0x2ec820=_0x5abe42;_0xfce570[_0x42e372][_0x2ec820(0x1ce)]=_0x47ae67;});const _0x1a5335=_0xfce570[_0x5abe42(0x189)](_0x388e7f=>_0x388e7f[_0x5abe42(0x1ef)]!=='0'&&_0x388e7f[_0x5abe42(0x1ef)]!=='');var _0x953116=0x0;_0x1a5335['forEach'](_0x5af348=>{var _0x3e5467=_0x5abe42;console[_0x3e5467(0x24d)](_0x3e5467(0x19e),_0x5af348),parseInt(_0x5af348[_0x3e5467(0x1ef)])<=0x0&&_0x953116++;});if(_0x953116!=0x0)return _0x2fe245[_0x5abe42(0x22f)](_0x5abe42(0x217),_0x5abe42(0x18e)),_0x1e7592[_0x5abe42(0x1f6)]('back');_0x20eae1[_0x5abe42(0x1ad)]=_0x2ace71,_0x20eae1[_0x5abe42(0x1ec)]=_0x2a5cdc,_0x20eae1[_0x5abe42(0x1cc)]=_0x1a5335,_0x20eae1[_0x5abe42(0x1e3)]=_0x1e1ef1,_0x20eae1[_0x5abe42(0x1c3)]=_0x21b7b4,_0x20eae1[_0x5abe42(0x228)]=_0x3063e1,_0x20eae1['JO_number']=_0xe33c1f;const _0x223ba7=await _0x20eae1[_0x5abe42(0x1b9)](),_0xf9bdaf=await warehouse['findOne']({'name':_0x2ace71,'room':_0x21b7b4});_0x223ba7[_0x5abe42(0x1cc)][_0x5abe42(0x205)](_0xd334fe=>{var _0x1e1d15=_0x5abe42;const _0x10e2cb=_0xf9bdaf['product_details'][_0x1e1d15(0x240)](_0x1b5abf=>{var _0x3f6c2f=_0x1e1d15;_0xd334fe[_0x3f6c2f(0x1f3)]=='minus'?_0x1b5abf['product_name']==_0xd334fe[_0x3f6c2f(0x20c)]&&_0x1b5abf[_0x3f6c2f(0x229)]==_0xd334fe[_0x3f6c2f(0x229)]&&(_0x1b5abf['product_stock']=parseInt(_0x1b5abf[_0x3f6c2f(0x1e4)])-parseInt(_0xd334fe[_0x3f6c2f(0x1ef)])):_0x1b5abf[_0x3f6c2f(0x20c)]==_0xd334fe[_0x3f6c2f(0x20c)]&&_0x1b5abf[_0x3f6c2f(0x229)]==_0xd334fe['bay']&&(_0x1b5abf[_0x3f6c2f(0x1e4)]=parseInt(_0x1b5abf[_0x3f6c2f(0x1e4)])+parseInt(_0xd334fe['adjust_qty']));});}),await _0xf9bdaf[_0x5abe42(0x1b9)](),_0x2fe245[_0x5abe42(0x22f)](_0x5abe42(0x1f5),_0x5abe42(0x20b)),_0x1e7592['redirect'](_0x5abe42(0x1ab));}catch(_0x24f598){console[_0x5abe42(0x24d)](_0x24f598);}}),router[a0_0x3cf141(0x1b6)](a0_0x3cf141(0x201),async(_0x23794f,_0x931ecb)=>{var _0x1f9f77=a0_0x3cf141;const {primary_code:_0x32dfa7,warehouse_data:_0xbc4d94,rooms_data:_0x475d86,Roomslist:_0x5af747}=_0x23794f[_0x1f9f77(0x1fc)],_0x23dc34=_0x5af747[_0x1f9f77(0x21e)](','),_0x521b6f=[];async function _0x45b77e(_0x179cfe){var _0x3c6591=_0x1f9f77;const _0x4d4f2b=await warehouse[_0x3c6591(0x211)]([{'$match':{'name':_0xbc4d94,'room':_0x179cfe}},{'$unwind':_0x3c6591(0x236)},{'$match':{'product_details.primary_code':_0x32dfa7}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3c6591(0x1a9)},'product_stock':{'$first':_0x3c6591(0x238)},'primary_code':{'$first':_0x3c6591(0x202)},'secondary_code':{'$first':_0x3c6591(0x1a4)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3c6591(0x1cd)},'isle':{'$first':_0x3c6591(0x1d3)},'type':{'$first':_0x3c6591(0x1cf)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3c6591(0x1c8)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3c6591(0x232)},'rack':{'$first':_0x3c6591(0x24b)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x3c6591(0x18f)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x3c6591(0x20e)},'roomNamed':{'$first':_0x3c6591(0x23e)},'invoice':{'$first':_0x3c6591(0x1c0)}}}]),_0x16df57=await warehouse[_0x3c6591(0x211)]([{'$match':{'name':_0xbc4d94,'room':_0x179cfe}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x32dfa7}},{'$group':{'_id':_0x3c6591(0x239),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c6591(0x238)},'primary_code':{'$first':_0x3c6591(0x202)},'secondary_code':{'$first':_0x3c6591(0x1a4)},'product_code':{'$first':_0x3c6591(0x1b7)},'level':{'$first':_0x3c6591(0x1cd)},'isle':{'$first':_0x3c6591(0x1d3)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3c6591(0x1c5)},'unit':{'$first':_0x3c6591(0x1c8)},'secondary_unit':{'$first':_0x3c6591(0x206)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3c6591(0x24b)},'expiry_date':{'$first':_0x3c6591(0x1fa)},'production_date':{'$first':_0x3c6591(0x234)},'batch_code':{'$first':_0x3c6591(0x18f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x3c6591(0x20e)},'roomNamed':{'$first':_0x3c6591(0x23e)},'invoice':{'$first':_0x3c6591(0x1c0)}}}]);if(_0x4d4f2b[_0x3c6591(0x1f7)]>0x0)_0x521b6f[_0x3c6591(0x227)](_0x4d4f2b);else _0x16df57['length']>0x0&&_0x521b6f['push'](_0x16df57);}const _0x10ab33=_0x23dc34[_0x1f9f77(0x240)](_0xb5a2e2=>_0x45b77e(_0xb5a2e2));await Promise[_0x1f9f77(0x1c2)](_0x10ab33),_0x931ecb[_0x1f9f77(0x1cb)](_0x521b6f);}),router[a0_0x3cf141(0x1b6)](a0_0x3cf141(0x18a),async(_0x3c5391,_0x30f863)=>{var _0x3426c0=a0_0x3cf141;const {productCode:_0x6d28df,bay:_0x35d21c,warehouses:_0x17eb1f,room:_0x386354}=_0x3c5391['body'];console[_0x3426c0(0x24d)](_0x3c5391[_0x3426c0(0x1fc)]);try{const _0x1c272b=await warehouse[_0x3426c0(0x211)]([{'$match':{'name':_0x17eb1f,'room':_0x386354}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x35d21c)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3426c0(0x1cd)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x30f863['status'](0xc8)['json'](_0x1c272b);}catch(_0xa8745){_0x30f863[_0x3426c0(0x19c)](0x194)[_0x3426c0(0x1cb)]({'message':_0xa8745[_0x3426c0(0x1a0)]});}}),module['exports']=router;