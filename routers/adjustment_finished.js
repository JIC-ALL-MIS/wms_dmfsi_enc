var a0_0x3d0bee=a0_0x4935;(function(_0x458612,_0x18eb33){var _0x25b1cb=a0_0x4935,_0x470d7c=_0x458612();while(!![]){try{var _0x360236=parseInt(_0x25b1cb(0x251))/0x1*(-parseInt(_0x25b1cb(0x1c6))/0x2)+-parseInt(_0x25b1cb(0x249))/0x3+-parseInt(_0x25b1cb(0x1a7))/0x4+parseInt(_0x25b1cb(0x1ca))/0x5+parseInt(_0x25b1cb(0x19f))/0x6+parseInt(_0x25b1cb(0x222))/0x7+parseInt(_0x25b1cb(0x20e))/0x8*(parseInt(_0x25b1cb(0x1d4))/0x9);if(_0x360236===_0x18eb33)break;else _0x470d7c['push'](_0x470d7c['shift']());}catch(_0x1bf745){_0x470d7c['push'](_0x470d7c['shift']());}}}(a0_0x3fb1,0xb17d3));function a0_0x4935(_0x85bfc2,_0x352296){var _0x3fb14e=a0_0x3fb1();return a0_0x4935=function(_0x4935af,_0x488815){_0x4935af=_0x4935af-0x18f;var _0x31dc98=_0x3fb14e[_0x4935af];return _0x31dc98;},a0_0x4935(_0x85bfc2,_0x352296);}const express=require('express'),app=express(),router=express[a0_0x3d0bee(0x190)](),auth=require(a0_0x3d0bee(0x1e9)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x3d0bee(0x241)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x3d0bee(0x1be));function a0_0x3fb1(){var _0xea9fee=['types','Enclosed','<h5>','room_names','$product_details.unit','</thead>','/picking_list/PDF_adjustment/','errors','$product_details.floorlevel','forEach','findById','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','product_stock','Arabic\x20(ae)','$product.product_name','<tr>','Logo.png','<hr\x20class=\x22my-3\x22>','stock','warehouse','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','edit_adjustment_finished','$product_details.maxPerUnit','unit','Portuguese','<!DOCTYPE\x20html>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','finalize','</table>','language','$warehouse_name','8SLCUFB','$product_details.secondary_code','adjust_qty','string','save','product_name','expiry_date','$product_details.maxProducts','$product_details.bin','JO_number','level','/upload/','FGSEmail','/view/:id','Arabic','host','getDate','createTransport','add_adjustment_finished','Chinese','9309692Pzyjbx','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','render','$product_details.bay','product','port','</td>','minus','ADJF-','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','json','</tr>','$product_details.invoice','/adjustment_finished/preview/','\x20Order\x20Date\x20:\x20','then','$product_details.secondary_unit','</span>','stockBefore','log','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','German','New_Qty_Converted','floor','date','bay','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$room','Return\x20Rooms','prod_invoice','findOne','../models/all_models','Error\x20Occurs','flash','$product_details._id','catch','user','map','New_Qty_Converted_adj','2326200zofoqI','$product_details.type','</h5>','$product_details.storage','$product_details','message','purchases_data','redirect','1AXDirG','Email\x20sent\x20successfully','<strong>\x20Regards\x20</strong>','An\x20error\x20occurred\x20while\x20saving\x20data.','email','sendMail','Router','$finalize','getFullYear','Secondary_units','edit_adjustment_finished_view','Adjustment\x20Mail','params','$product_details.production_date','<h5\x20style=\x22text-align:\x20left;\x22>','product_date','<div>','success','all','random','Hindi','3652836ulkQpl','warehouse_name','invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','site_title','</div>','True','post','5258980BpxzCg','password','Portuguese\x20(BR)','Spanish','/view/add_adjustment','<tbody\x20style=\x22text-align:\x20center;\x22>','Rooms','$product_details.product_stock','back','role','adjustment\x20add\x20successfull','$product_details.primary_code','note','<span\x20style=\x22float:\x20right;\x22>','$product_details.expiry_date','Finished\x20Goods','padStart','/adjustment_finished/view','add','$product_details.rack','image','Primary_Units','maxPerUnit','nodemailer','adjustment\x20data\x20update\x20successfully','length','Ambient','French','English','foreach\x20newproduct','$product','721484lDSGFI','$name','$product.room_names','$invoice','2643915JgeVMv','Enabled','<html><head><title></title>','$product_details.product_code','$product_details.batch_code','batch_code','split','getMonth','find','/preview/:id','6393033IxnzZu','prod_name','prod_cat','staff','prod_code','body','product_details','aggregate','/adjustment/view','slice','status','new_adjust_qty','secondary_unit','QA\x20Warehouse','master','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','room','English\x20(US)','$product_details.product_name','production_date','An\x20error\x20occurred.','../middleware/auth','product_code','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','get'];a0_0x3fb1=function(){return _0xea9fee;};return a0_0x3fb1();}router[a0_0x3d0bee(0x1ed)]('/view',auth,async(_0x274e1e,_0x4739d0)=>{var _0x1e3914=a0_0x3d0bee;try{const {username:_0x3d0f2e,email:_0x11383c,role:_0x555c6c}=_0x274e1e[_0x1e3914(0x246)],_0x2f9323=_0x274e1e[_0x1e3914(0x246)],_0x558f3b=await profile[_0x1e3914(0x240)]({'email':_0x2f9323[_0x1e3914(0x255)]}),_0x28b80a=await master_shop[_0x1e3914(0x1d2)]();let _0xa989c8;if(_0x2f9323[_0x1e3914(0x1b0)]==_0x1e3914(0x1d7)){const _0x17b3aa=await staff[_0x1e3914(0x240)]({'email':_0x2f9323[_0x1e3914(0x255)]});_0xa989c8=await warehouse[_0x1e3914(0x1d2)]({'status':_0x1e3914(0x1cb),'name':_0x17b3aa['warehouse']});}else _0xa989c8=await warehouse['find']({'status':_0x1e3914(0x1cb)});const _0xb12f69=await product[_0x1e3914(0x1d2)]();let _0x4ec3d1;if(_0x2f9323[_0x1e3914(0x1b0)]==_0x1e3914(0x1d7)){const _0x161f01=await staff['findOne']({'email':_0x2f9323['email']});_0x4ec3d1=await adjustment_finished[_0x1e3914(0x1d2)]({'warehouse_name':_0x161f01[_0x1e3914(0x202)]});}else _0x4ec3d1=await adjustment_finished[_0x1e3914(0x1db)]([{'$unwind':_0x1e3914(0x1c5)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1e3914(0x1c9)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x1e3914(0x20d)},'room':{'$addToSet':_0x1e3914(0x1c8)},'finalize':{'$first':_0x1e3914(0x191)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x28b80a[0x0][_0x1e3914(0x20c)]=='English\x20(US)'){var _0x15227b=users[_0x1e3914(0x1c3)];console[_0x1e3914(0x235)](_0x15227b);}else{if(_0x28b80a[0x0][_0x1e3914(0x20c)]==_0x1e3914(0x19e))var _0x15227b=users[_0x1e3914(0x19e)];else{if(_0x28b80a[0x0][_0x1e3914(0x20c)]=='German')var _0x15227b=users['German'];else{if(_0x28b80a[0x0]['language']==_0x1e3914(0x1aa))var _0x15227b=users['Spanish'];else{if(_0x28b80a[0x0]['language']==_0x1e3914(0x1c2))var _0x15227b=users['French'];else{if(_0x28b80a[0x0][_0x1e3914(0x20c)]==_0x1e3914(0x1a9))var _0x15227b=users[_0x1e3914(0x207)];else{if(_0x28b80a[0x0][_0x1e3914(0x20c)]==_0x1e3914(0x221))var _0x15227b=users['Chinese'];else{if(_0x28b80a[0x0]['language']=='Arabic\x20(ae)')var _0x15227b=users[_0x1e3914(0x21c)];}}}}}}}_0x4739d0[_0x1e3914(0x224)]('adjustment_finished',{'success':_0x274e1e['flash'](_0x1e3914(0x19b)),'errors':_0x274e1e['flash'](_0x1e3914(0x1f5)),'role':_0x2f9323,'profile':_0x558f3b,'warehouse':_0xa989c8,'product':_0xb12f69,'adjustment':_0x4ec3d1,'master_shop':_0x28b80a,'language':_0x15227b});}catch(_0x11dad6){console[_0x1e3914(0x235)](_0x11dad6);}});async function getRandom8DigitNumber(){var _0x12021c=a0_0x3d0bee;const _0x1ea4d7=0x989680,_0x489270=0x5f5e0ff,_0x301347=Math[_0x12021c(0x239)](Math[_0x12021c(0x19d)]()*(_0x489270-_0x1ea4d7+0x1))+_0x1ea4d7;var _0x50f8f8;const _0x47a9ad=await adjustment_finished[_0x12021c(0x240)]({'invoice':_0x12021c(0x22a)+_0x301347});return _0x47a9ad&&_0x47a9ad[_0x12021c(0x1c0)]>0x0?_0x50f8f8=_0x12021c(0x22a)+_0x301347:_0x50f8f8='ADJF-'+_0x301347,_0x50f8f8;}router[a0_0x3d0bee(0x1ed)]('/view/add_adjustment',auth,async(_0x5bafcc,_0x263e28)=>{var _0x5280d5=a0_0x3d0bee;try{const {username:_0x42ba06,email:_0x1e7a40,role:_0x2633a7}=_0x5bafcc[_0x5280d5(0x246)],_0x3d9bff=_0x5bafcc[_0x5280d5(0x246)],_0x421d75=await profile[_0x5280d5(0x240)]({'email':_0x3d9bff[_0x5280d5(0x255)]}),_0xa19adf=await master_shop[_0x5280d5(0x1d2)]();let _0x1b9b89;if(_0x3d9bff[_0x5280d5(0x1b0)]=='staff'){const _0x55ec78=await staff[_0x5280d5(0x240)]({'email':_0x3d9bff[_0x5280d5(0x255)]});_0x1b9b89=await warehouse[_0x5280d5(0x1db)]([{'$match':{'status':'Enabled','name':_0x55ec78[_0x5280d5(0x202)],'warehouse_category':_0x5280d5(0x1b6),'name':{'$ne':_0x5280d5(0x1e1)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x1b9b89=await warehouse[_0x5280d5(0x1db)]([{'$match':{'status':_0x5280d5(0x1cb),'warehouse_category':_0x5280d5(0x1b6),'name':{'$ne':_0x5280d5(0x1e1)}}},{'$group':{'_id':'$name','name':{'$first':_0x5280d5(0x1c7)}}}]);const _0x1364ce=await product[_0x5280d5(0x1d2)]({}),_0x56053c=await adjustment_finished[_0x5280d5(0x1d2)]({}),_0x4a044c=_0x56053c[_0x5280d5(0x1c0)]+0x1,_0x3199a2=_0x5280d5(0x22a)+_0x4a044c['toString']()[_0x5280d5(0x1b7)](0x5,'0');var _0x2cae45=[_0x5280d5(0x1c1),_0x5280d5(0x1ef),'Return\x20Rooms'];if(_0xa19adf[0x0][_0x5280d5(0x20c)]==_0x5280d5(0x1e5))var _0x5db0c1=users[_0x5280d5(0x1c3)];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]=='Hindi')var _0x5db0c1=users[_0x5280d5(0x19e)];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]==_0x5280d5(0x237))var _0x5db0c1=users[_0x5280d5(0x237)];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]=='Spanish')var _0x5db0c1=users['Spanish'];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]==_0x5280d5(0x1c2))var _0x5db0c1=users['French'];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]=='Portuguese\x20(BR)')var _0x5db0c1=users[_0x5280d5(0x207)];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]==_0x5280d5(0x221))var _0x5db0c1=users[_0x5280d5(0x221)];else{if(_0xa19adf[0x0][_0x5280d5(0x20c)]==_0x5280d5(0x1fc))var _0x5db0c1=users[_0x5280d5(0x21c)];}}}}}}}const _0x28ac60=getRandom8DigitNumber();_0x28ac60[_0x5280d5(0x231)](_0x68cffd=>{var _0x500ce0=_0x5280d5;_0x263e28[_0x500ce0(0x224)](_0x500ce0(0x220),{'success':_0x5bafcc['flash'](_0x500ce0(0x19b)),'errors':_0x5bafcc[_0x500ce0(0x243)]('errors'),'role':_0x3d9bff,'profile':_0x421d75,'warehouse':_0x1b9b89,'product':_0x1364ce,'master_shop':_0xa19adf,'language':_0x5db0c1,'rooms_data':_0x2cae45,'invoice_no':_0x68cffd});})[_0x5280d5(0x245)](_0x36bbeb=>{var _0x5b1763=_0x5280d5;_0x5bafcc[_0x5b1763(0x243)](_0x5b1763(0x1f5),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x263e28[_0x5b1763(0x250)](_0x5b1763(0x1dc));});}catch(_0x10a900){console['log'](_0x10a900);}}),router['post'](a0_0x3d0bee(0x1ab),auth,async(_0x51e38a,_0x55696c)=>{var _0xe17010=a0_0x3d0bee;try{const {warehouse_name:_0x6f4c22,date:_0x159be5,prod_name:_0xa3a92,level:_0x1a887c,isle:_0x154614,pallet:_0xd82d4d,stock:_0x1ffd1d,types:_0x269694,adjust_qty:_0x2ce07c,new_adjust_qty:_0x383caa,note:_0xec3a2c,Room_name:_0x429bfb,invoice:_0x515b72,JO_number:_0x4c7f56,expiry_date:_0x2e609e}=_0x51e38a[_0xe17010(0x1d9)];if(typeof _0xa3a92==_0xe17010(0x211))var _0x264426=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1d5)]],_0x5d8552=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x218)]],_0x2b48ef=[_0x51e38a[_0xe17010(0x1d9)]['stock']],_0x39c7ab=[_0x51e38a[_0xe17010(0x1d9)]['types']],_0x1c9d74=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x248)]],_0x40f364=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x238)]],_0x2487cf=[_0x51e38a['body'][_0xe17010(0x1bc)]],_0x1080be=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x193)]],_0x2238c6=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1d8)]],_0x112e50=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1cf)]],_0xd3da67=[_0x51e38a['body'][_0xe17010(0x214)]],_0x3d6494=[_0x51e38a[_0xe17010(0x1d9)]['product_date']],_0x1ceac9=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1d6)]],_0x37bed7=[_0x51e38a[_0xe17010(0x1d9)]['Rooms']],_0x122f93=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1bd)]],_0x339f3e=[_0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x23f)]];else var _0x264426=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1d5)]],_0x5d8552=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x218)]],_0x2b48ef=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x201)]],_0x39c7ab=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1ee)]],_0x1c9d74=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x248)]],_0x40f364=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x238)]],_0x2487cf=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1bc)]],_0x1080be=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x193)]],_0x2238c6=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1d8)]],_0x112e50=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1cf)]],_0xd3da67=[..._0x51e38a['body'][_0xe17010(0x214)]],_0x3d6494=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x199)]],_0x1ceac9=[..._0x51e38a[_0xe17010(0x1d9)][_0xe17010(0x1d6)]],_0x37bed7=[..._0x51e38a['body'][_0xe17010(0x1ad)]],_0x122f93=[..._0x51e38a[_0xe17010(0x1d9)]['maxPerUnit']],_0x339f3e=[..._0x51e38a[_0xe17010(0x1d9)]['prod_invoice']];const _0x53a09b=_0x264426[_0xe17010(0x247)](_0x533134=>{return _0x533134={'product_name':_0x533134};});_0x5d8552[_0xe17010(0x1f7)]((_0xf772cc,_0x11018c)=>{_0x53a09b[_0x11018c]['bay']=_0xf772cc;}),_0x2b48ef['forEach']((_0x50841d,_0x3abcff)=>{_0x53a09b[_0x3abcff]['stockBefore']=_0x50841d;}),_0x39c7ab[_0xe17010(0x1f7)]((_0x5777b3,_0xd68b49)=>{var _0x23d5ae=_0xe17010;_0x53a09b[_0xd68b49][_0x23d5ae(0x1ee)]=_0x5777b3;}),_0x1c9d74[_0xe17010(0x1f7)]((_0x320fed,_0x363f3c)=>{_0x53a09b[_0x363f3c]['adjust_qty']=_0x320fed;}),_0x40f364[_0xe17010(0x1f7)]((_0x37739b,_0x57f84a)=>{var _0x28f14=_0xe17010;_0x53a09b[_0x57f84a][_0x28f14(0x1df)]=_0x37739b;}),_0x2487cf[_0xe17010(0x1f7)]((_0x3c9363,_0x23270b)=>{_0x53a09b[_0x23270b]['unit']=_0x3c9363;}),_0x1080be[_0xe17010(0x1f7)]((_0x22288e,_0x5574c)=>{var _0x3c56ad=_0xe17010;_0x53a09b[_0x5574c][_0x3c56ad(0x1e0)]=_0x22288e;}),_0x2238c6[_0xe17010(0x1f7)]((_0x525e85,_0x54c32e)=>{_0x53a09b[_0x54c32e]['product_code']=_0x525e85;}),_0x112e50['forEach']((_0x2b8983,_0x3410f3)=>{_0x53a09b[_0x3410f3]['batch_code']=_0x2b8983;}),_0xd3da67[_0xe17010(0x1f7)]((_0x16a1e2,_0x2f5c0f)=>{var _0x8c44ee=_0xe17010;_0x53a09b[_0x2f5c0f][_0x8c44ee(0x214)]=_0x16a1e2;}),_0x3d6494[_0xe17010(0x1f7)]((_0x1b059a,_0x347160)=>{var _0x51b82b=_0xe17010;_0x53a09b[_0x347160][_0x51b82b(0x1e7)]=_0x1b059a;}),_0x1ceac9['forEach']((_0x3bfe4a,_0x49e06b)=>{var _0x231ba1=_0xe17010;_0x53a09b[_0x49e06b][_0x231ba1(0x1d6)]=_0x3bfe4a;}),_0x37bed7['forEach']((_0x3640ec,_0x3d505e)=>{var _0x316a31=_0xe17010;_0x53a09b[_0x3d505e][_0x316a31(0x1f1)]=_0x3640ec;}),_0x122f93['forEach']((_0xb0b0c9,_0x533b57)=>{_0x53a09b[_0x533b57]['maxPerUnit']=_0xb0b0c9;}),_0x339f3e[_0xe17010(0x1f7)]((_0x134715,_0x36e6fb)=>{var _0x8078ee=_0xe17010;_0x53a09b[_0x36e6fb][_0x8078ee(0x1a1)]=_0x134715;});const _0x1f1324=_0x53a09b['filter'](_0x4c86da=>_0x4c86da[_0xe17010(0x210)]!=='0'&&_0x4c86da['adjust_qty']!=='');var _0x16d39c=0x0;_0x1f1324[_0xe17010(0x1f7)](_0x17a0bb=>{var _0x51f830=_0xe17010;console['log'](_0x51f830(0x1c4),_0x17a0bb),parseInt(_0x17a0bb['adjust_qty'])<=0x0&&_0x16d39c++;});if(_0x16d39c!=0x0)return _0x51e38a[_0xe17010(0x243)](_0xe17010(0x1f5),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x55696c[_0xe17010(0x250)](_0xe17010(0x1af));const _0x4b82ae=new adjustment_finished({'warehouse_name':_0x6f4c22,'date':_0x159be5,'product':_0x1f1324,'note':_0xec3a2c,'room':_0x429bfb,'invoice':_0x515b72,'JO_number':_0x4c7f56,'expiry_date':_0x2e609e}),_0x1e7cca=await _0x4b82ae[_0xe17010(0x212)]();_0x51e38a['flash'](_0xe17010(0x19b),_0xe17010(0x1b1)),_0x55696c['redirect'](_0xe17010(0x22f)+_0x1e7cca['_id']);}catch(_0x109372){console[_0xe17010(0x235)](_0x109372),_0x55696c[_0xe17010(0x1de)](0xc8)[_0xe17010(0x22c)]({'message':_0x109372['message']});}}),router['get']('/preview/:id',auth,async(_0x5a1cd4,_0xf05145)=>{var _0x3888fe=a0_0x3d0bee;try{const {username:_0x4fee63,email:_0x2696aa,role:_0x8cf78e}=_0x5a1cd4[_0x3888fe(0x246)],_0x116beb=_0x5a1cd4[_0x3888fe(0x246)],_0xd343f1=await profile[_0x3888fe(0x240)]({'email':_0x116beb['email']}),_0xfbad2f=await master_shop[_0x3888fe(0x1d2)](),_0x15e637=_0x5a1cd4['params']['id'],_0xb2c5dd=await adjustment_finished[_0x3888fe(0x1f8)]({'_id':_0x15e637}),_0x291a16=await purchases[_0x3888fe(0x1db)]([{'$match':{'warehouse_name':_0xb2c5dd['warehouse_name']}},{'$unwind':_0x3888fe(0x1c5)},{'$group':{'_id':_0x3888fe(0x1fd)}}]);console[_0x3888fe(0x235)]('purchases_data',_0x291a16);const _0x5ea610=await product[_0x3888fe(0x1d2)]({}),_0x16a134=await warehouse['aggregate']([{'$match':{'name':_0xb2c5dd[_0x3888fe(0x1a0)],'warehouse_category':_0x3888fe(0x1b6)}},{'$unwind':_0x3888fe(0x24d)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3888fe(0x1ae)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x3888fe(0x216)},'type':{'$first':_0x3888fe(0x24a)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3888fe(0x1b2)},'secondary_code':{'$first':_0x3888fe(0x20f)},'product_code':{'$first':_0x3888fe(0x1cd)},'storage':{'$first':_0x3888fe(0x24c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3888fe(0x197)},'batch_code':{'$first':_0x3888fe(0x1ce)},'maxPerUnit':{'$first':_0x3888fe(0x205)},'room':{'$first':'$room'}}}]);if(_0xfbad2f[0x0][_0x3888fe(0x20c)]==_0x3888fe(0x1e5)){var _0x9903dc=users['English'];console[_0x3888fe(0x235)](_0x9903dc);}else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]==_0x3888fe(0x19e))var _0x9903dc=users[_0x3888fe(0x19e)];else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]==_0x3888fe(0x237))var _0x9903dc=users[_0x3888fe(0x237)];else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]=='Spanish')var _0x9903dc=users[_0x3888fe(0x1aa)];else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]==_0x3888fe(0x1c2))var _0x9903dc=users[_0x3888fe(0x1c2)];else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]==_0x3888fe(0x1a9))var _0x9903dc=users['Portuguese'];else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]==_0x3888fe(0x221))var _0x9903dc=users['Chinese'];else{if(_0xfbad2f[0x0][_0x3888fe(0x20c)]=='Arabic\x20(ae)')var _0x9903dc=users[_0x3888fe(0x21c)];}}}}}}}_0xf05145['render'](_0x3888fe(0x194),{'success':_0x5a1cd4[_0x3888fe(0x243)](_0x3888fe(0x19b)),'errors':_0x5a1cd4['flash']('errors'),'role':_0x116beb,'profile':_0xd343f1,'adjustment':_0xb2c5dd,'stock':_0x16a134,'master_shop':_0xfbad2f,'warehouse_name':_0x291a16,'unit':_0x5ea610,'language':_0x9903dc});}catch(_0x5454c0){console[_0x3888fe(0x235)](_0x5454c0),_0xf05145[_0x3888fe(0x1de)](0xc8)[_0x3888fe(0x22c)]({'message':_0x5454c0[_0x3888fe(0x24e)]});}}),router[a0_0x3d0bee(0x1a6)](a0_0x3d0bee(0x1d3),auth,async(_0x282c4c,_0xb8f747)=>{var _0x4238b3=a0_0x3d0bee;try{const {invoice:_0x26381a,warehouse_name:_0x3ad46a,Room_name:_0x59716c}=_0x282c4c[_0x4238b3(0x1d9)],_0x4a3135=_0x282c4c[_0x4238b3(0x196)]['id'],_0x34b93d=await adjustment_finished[_0x4238b3(0x1f8)]({'_id':_0x4a3135});var _0x2e3f2f;const _0x4f8138=_0x34b93d[_0x4238b3(0x226)]['map'](async _0x542bdb=>{var _0x2d4e9a=_0x4238b3;if(_0x542bdb['adjust_qty']>0x0){_0x2e3f2f=await warehouse[_0x2d4e9a(0x240)]({'name':_0x3ad46a,'room':_0x542bdb['room_names'],'warehouse_category':_0x2d4e9a(0x1b6)});const _0x4f5a81=_0x2e3f2f[_0x2d4e9a(0x1da)][_0x2d4e9a(0x247)](_0x3c653f=>{var _0x2c112d=_0x2d4e9a;console[_0x2c112d(0x235)](_0x542bdb[_0x2c112d(0x1ee)]);if(_0x542bdb[_0x2c112d(0x1ee)]==_0x2c112d(0x229))_0x3c653f[_0x2c112d(0x213)]==_0x542bdb[_0x2c112d(0x213)]&&_0x3c653f[_0x2c112d(0x23b)]==_0x542bdb['bay']&&_0x3c653f[_0x2c112d(0x214)]==_0x542bdb[_0x2c112d(0x214)]&&_0x3c653f[_0x2c112d(0x1e7)]==_0x542bdb['production_date']&&_0x3c653f[_0x2c112d(0x1cf)]==_0x542bdb[_0x2c112d(0x1cf)]&&_0x3c653f[_0x2c112d(0x1a1)]==_0x542bdb[_0x2c112d(0x1a1)]&&(_0x3c653f[_0x2c112d(0x1fb)]=_0x3c653f[_0x2c112d(0x1fb)]-_0x542bdb[_0x2c112d(0x210)]);else _0x542bdb['types']==_0x2c112d(0x1b9)&&(_0x3c653f[_0x2c112d(0x213)]==_0x542bdb[_0x2c112d(0x213)]&&_0x3c653f[_0x2c112d(0x23b)]==_0x542bdb[_0x2c112d(0x23b)]&&_0x3c653f[_0x2c112d(0x214)]==_0x542bdb['expiry_date']&&_0x3c653f['production_date']==_0x542bdb[_0x2c112d(0x1e7)]&&_0x3c653f['batch_code']==_0x542bdb[_0x2c112d(0x1cf)]&&_0x3c653f[_0x2c112d(0x1a1)]==_0x542bdb[_0x2c112d(0x1a1)]&&(_0x3c653f['product_stock']=_0x3c653f[_0x2c112d(0x1fb)]+_0x542bdb[_0x2c112d(0x210)]));});}return _0x2e3f2f;});Promise[_0x4238b3(0x19c)](_0x4f8138)[_0x4238b3(0x231)](async _0x371aea=>{var _0x4562cb=_0x4238b3;try{for(const _0x281cc2 of _0x371aea){await _0x281cc2[_0x4562cb(0x212)]();}_0x34b93d[_0x4562cb(0x20a)]=_0x4562cb(0x1a5);const _0x5bb419=await _0x34b93d[_0x4562cb(0x212)](),_0x3e12fb=await master_shop[_0x4562cb(0x1d2)](),_0x53fc08=await email_settings[_0x4562cb(0x240)](),_0x532bb7=await supervisor_settings['find']();var _0x4524ee=_0x34b93d[_0x4562cb(0x226)],_0x114059='',_0xf26806;for(_0xf26806 in _0x4524ee){var _0x10187e='FG';_0x34b93d[_0x4562cb(0x1a0)]=='DRY\x20GOODS'&&(_0x10187e='DG'),_0x114059+=_0x4562cb(0x1fe)+_0x4562cb(0x236)+_0x4524ee[_0xf26806]['product_name']+_0x4562cb(0x228)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4524ee[_0xf26806][_0x4562cb(0x1ea)]+_0x4562cb(0x228)+_0x4562cb(0x236)+_0x4524ee[_0xf26806]['adjust_qty']+_0x4562cb(0x228)+_0x4562cb(0x236)+_0x4524ee[_0xf26806][_0x4562cb(0x206)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4524ee[_0xf26806]['secondary_unit']+_0x4562cb(0x228)+_0x4562cb(0x236)+_0x34b93d[_0x4562cb(0x1a0)]+_0x4562cb(0x228)+_0x4562cb(0x236)+_0x4524ee[_0xf26806]['room_names']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x10187e+_0x4524ee[_0xf26806][_0x4562cb(0x23b)]+_0x4562cb(0x228)+_0x4562cb(0x22d);}let _0x20a0c7=nodemailer[_0x4562cb(0x21f)]({'host':_0x53fc08[_0x4562cb(0x21d)],'port':Number(_0x53fc08[_0x4562cb(0x227)]),'secure':![],'auth':{'user':_0x53fc08['email'],'pass':_0x53fc08[_0x4562cb(0x1a8)]}}),_0x848fa3={'from':_0x53fc08[_0x4562cb(0x255)],'to':_0x532bb7[0x0][_0x4562cb(0x21a)],'subject':_0x4562cb(0x195),'attachments':[{'filename':_0x4562cb(0x1ff),'path':__dirname+'/../public'+_0x4562cb(0x219)+_0x3e12fb[0x0][_0x4562cb(0x1bb)],'cid':'logo'}],'html':_0x4562cb(0x208)+_0x4562cb(0x1cc)+'</head><body>'+_0x4562cb(0x19a)+_0x4562cb(0x1ec)+'<div>'+_0x4562cb(0x1eb)+_0x4562cb(0x1a4)+_0x4562cb(0x19a)+'<h2>\x20'+_0x3e12fb[0x0][_0x4562cb(0x1a3)]+'\x20</h2>'+_0x4562cb(0x1a4)+_0x4562cb(0x1a4)+_0x4562cb(0x200)+_0x4562cb(0x19a)+_0x4562cb(0x198)+'\x20Order\x20Number\x20:\x20'+_0x34b93d[_0x4562cb(0x1a1)]+'\x20'+_0x4562cb(0x1b4)+_0x4562cb(0x230)+_0x34b93d[_0x4562cb(0x23a)]+'\x20'+_0x4562cb(0x233)+'</h5>'+_0x4562cb(0x1a4)+_0x4562cb(0x209)+_0x4562cb(0x203)+_0x4562cb(0x1fe)+_0x4562cb(0x223)+_0x4562cb(0x23c)+_0x4562cb(0x1a2)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x4562cb(0x1e3)+_0x4562cb(0x1fa)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x4562cb(0x22d)+_0x4562cb(0x1f3)+_0x4562cb(0x1ac)+'\x20'+_0x114059+'\x20'+'</tbody>'+_0x4562cb(0x20b)+'<div>'+_0x4562cb(0x253)+_0x4562cb(0x1f0)+_0x3e12fb[0x0]['site_title']+_0x4562cb(0x24b)+'</div>'+'</div>'+'</body></html>'};_0x20a0c7[_0x4562cb(0x18f)](_0x848fa3,function(_0x3426b0,_0x5ec9da){var _0x28fb07=_0x4562cb;_0x3426b0?(console[_0x28fb07(0x235)](_0x3426b0),console[_0x28fb07(0x235)](_0x28fb07(0x242))):console[_0x28fb07(0x235)](_0x28fb07(0x252));}),_0x282c4c[_0x4562cb(0x243)](_0x4562cb(0x19b),'Adjustment\x20Finalize\x20Successfully'),_0xb8f747[_0x4562cb(0x250)](_0x4562cb(0x1f4)+_0x5bb419['_id']);}catch(_0x284728){console[_0x4562cb(0x1f9)](_0x284728),_0xb8f747[_0x4562cb(0x1de)](0x1f4)[_0x4562cb(0x22c)]({'error':_0x4562cb(0x254)});}})[_0x4238b3(0x245)](_0x471911=>{var _0x29725f=_0x4238b3;console['error'](_0x471911),_0xb8f747[_0x29725f(0x1de)](0x1f4)[_0x29725f(0x22c)]({'error':_0x29725f(0x1e8)});});}catch(_0x49a008){_0xb8f747['json']({'message':_0x49a008[_0x4238b3(0x24e)]});}}),router['get'](a0_0x3d0bee(0x21b),auth,async(_0x353aac,_0x3d83d7)=>{var _0x41bbb1=a0_0x3d0bee;try{const {username:_0x187d97,email:_0x50324c,role:_0x429304}=_0x353aac[_0x41bbb1(0x246)],_0x5ff444=_0x353aac['user'],_0x349050=await profile[_0x41bbb1(0x240)]({'email':_0x5ff444[_0x41bbb1(0x255)]}),_0x494895=await master_shop[_0x41bbb1(0x1d2)]();console[_0x41bbb1(0x235)](_0x41bbb1(0x1e2),_0x494895);const _0x17fa0c=_0x353aac[_0x41bbb1(0x196)]['id'],_0x4f56b2=await adjustment_finished[_0x41bbb1(0x1f8)]({'_id':_0x17fa0c});let _0x58c07e=new Date(_0x4f56b2['expiry_date']),_0x29082c=('0'+_0x58c07e[_0x41bbb1(0x21e)]())['slice'](-0x2),_0x28cb25=('0'+(_0x58c07e[_0x41bbb1(0x1d1)]()+0x1))[_0x41bbb1(0x1dd)](-0x2),_0x58ffa8=_0x58c07e[_0x41bbb1(0x192)](),_0x1d6696=_0x58ffa8+'-'+_0x28cb25+'-'+_0x29082c;var _0x575a07=[_0x41bbb1(0x1c1),_0x41bbb1(0x1ef),_0x41bbb1(0x23e)];const _0x4f5dc1=await purchases[_0x41bbb1(0x1db)]([{'$match':{'warehouse_name':_0x4f56b2['warehouse_name']}},{'$unwind':_0x41bbb1(0x1c5)},{'$group':{'_id':_0x41bbb1(0x1fd)}}]);console[_0x41bbb1(0x235)](_0x41bbb1(0x24f),_0x4f5dc1);const _0x3d66b2=await product['find']({}),_0x50f93b=await warehouse['aggregate']([{'$match':{'name':_0x4f56b2[_0x41bbb1(0x1a0)],'room':_0x4f56b2[_0x41bbb1(0x1e4)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x41bbb1(0x244),'name':{'$first':_0x41bbb1(0x1e6)},'product_stock':{'$first':_0x41bbb1(0x1ae)},'bay':{'$first':_0x41bbb1(0x225)},'bin':{'$first':_0x41bbb1(0x216)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x41bbb1(0x1f6)},'primary_code':{'$first':_0x41bbb1(0x1b2)},'secondary_code':{'$first':_0x41bbb1(0x20f)},'product_code':{'$first':_0x41bbb1(0x1cd)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);if(_0x494895[0x0][_0x41bbb1(0x20c)]==_0x41bbb1(0x1e5)){var _0x132f94=users[_0x41bbb1(0x1c3)];console[_0x41bbb1(0x235)](_0x132f94);}else{if(_0x494895[0x0][_0x41bbb1(0x20c)]=='Hindi')var _0x132f94=users[_0x41bbb1(0x19e)];else{if(_0x494895[0x0][_0x41bbb1(0x20c)]==_0x41bbb1(0x237))var _0x132f94=users[_0x41bbb1(0x237)];else{if(_0x494895[0x0][_0x41bbb1(0x20c)]=='Spanish')var _0x132f94=users['Spanish'];else{if(_0x494895[0x0]['language']==_0x41bbb1(0x1c2))var _0x132f94=users['French'];else{if(_0x494895[0x0][_0x41bbb1(0x20c)]==_0x41bbb1(0x1a9))var _0x132f94=users['Portuguese'];else{if(_0x494895[0x0][_0x41bbb1(0x20c)]==_0x41bbb1(0x221))var _0x132f94=users[_0x41bbb1(0x221)];else{if(_0x494895[0x0][_0x41bbb1(0x20c)]=='Arabic\x20(ae)')var _0x132f94=users[_0x41bbb1(0x21c)];}}}}}}}_0x3d83d7[_0x41bbb1(0x224)](_0x41bbb1(0x204),{'success':_0x353aac[_0x41bbb1(0x243)](_0x41bbb1(0x19b)),'errors':_0x353aac[_0x41bbb1(0x243)](_0x41bbb1(0x1f5)),'role':_0x5ff444,'profile':_0x349050,'adjustment':_0x4f56b2,'stock':_0x50f93b,'master_shop':_0x494895,'warehouse_name':_0x4f5dc1,'unit':_0x3d66b2,'language':_0x132f94,'rooms_data':_0x575a07,'ed_fullDate':_0x1d6696});}catch(_0x3fc4b0){console[_0x41bbb1(0x235)](_0x3fc4b0),_0x3d83d7[_0x41bbb1(0x1de)](0xc8)[_0x41bbb1(0x22c)]({'message':_0x3fc4b0[_0x41bbb1(0x24e)]});}}),router[a0_0x3d0bee(0x1a6)](a0_0x3d0bee(0x21b),auth,async(_0x3601c7,_0x2065d6)=>{var _0x4dcc32=a0_0x3d0bee;try{const _0x555ddd=_0x3601c7[_0x4dcc32(0x196)]['id'],_0x5bb903=await adjustment_finished[_0x4dcc32(0x1f8)]({'_id':_0x555ddd}),_0x11a5d2=await warehouse['findOne']({'name':_0x5bb903[_0x4dcc32(0x1a0)],'room':_0x5bb903['room']}),{warehouse_name:_0x401818,date:_0x68ba7,prod_name:_0x3fdc35,level:_0x1c17fd,isle:_0xd363a7,pallet:_0x251092,stock:_0x340aed,types:_0x1b90b2,adjust_qty:_0x4ac40,new_adjust_qty:_0x57272c,note:_0x303a88,Room_name:_0x57750f,invoice:_0x2ff90f,JO_number:_0x5ceb42}=_0x3601c7['body'];if(typeof _0x3fdc35==_0x4dcc32(0x211))var _0x334983=[_0x3601c7[_0x4dcc32(0x1d9)]['prod_name']],_0x3ff139=[_0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x218)]],_0x2ee932=[_0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x201)]],_0x2bddf9=[_0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1ee)]],_0x241112=[_0x3601c7[_0x4dcc32(0x1d9)]['adjust_qty']],_0x27952c=[_0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1df)]],_0x4c95b8=[_0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1d8)]],_0x5f481e=[_0x3601c7[_0x4dcc32(0x1d9)]['unit']],_0x3cf21c=[_0x3601c7[_0x4dcc32(0x1d9)]['Secondary_units']],_0x546a55=[_0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1cf)]],_0x213ca4=[_0x3601c7['body'][_0x4dcc32(0x214)]];else var _0x334983=[..._0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1d5)]],_0x3ff139=[..._0x3601c7[_0x4dcc32(0x1d9)]['level']],_0x2ee932=[..._0x3601c7[_0x4dcc32(0x1d9)]['stock']],_0x2bddf9=[..._0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1ee)]],_0x241112=[..._0x3601c7[_0x4dcc32(0x1d9)]['adjust_qty']],_0x27952c=[..._0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1df)]],_0x4c95b8=[..._0x3601c7[_0x4dcc32(0x1d9)]['prod_code']],_0x5f481e=[..._0x3601c7['body']['unit']],_0x3cf21c=[..._0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x193)]],_0x546a55=[..._0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x1cf)]],_0x213ca4=[..._0x3601c7[_0x4dcc32(0x1d9)][_0x4dcc32(0x214)]];const _0x3f052e=_0x334983[_0x4dcc32(0x247)](_0x2eeda5=>{return _0x2eeda5={'product_name':_0x2eeda5};});_0x3ff139['forEach']((_0x2cb38f,_0x74168a)=>{var _0x3eeee3=_0x4dcc32;_0x3f052e[_0x74168a][_0x3eeee3(0x23b)]=_0x2cb38f;}),_0x2ee932[_0x4dcc32(0x1f7)]((_0x4e5c42,_0x406b1a)=>{var _0x447b3d=_0x4dcc32;_0x3f052e[_0x406b1a][_0x447b3d(0x234)]=_0x4e5c42;}),_0x2bddf9[_0x4dcc32(0x1f7)]((_0x28de62,_0x1f527d)=>{var _0x5a8242=_0x4dcc32;_0x3f052e[_0x1f527d][_0x5a8242(0x1ee)]=_0x28de62;}),_0x241112['forEach']((_0x45a4e4,_0x51a474)=>{var _0x1c6a3c=_0x4dcc32;_0x3f052e[_0x51a474][_0x1c6a3c(0x210)]=_0x45a4e4;}),_0x27952c[_0x4dcc32(0x1f7)]((_0x562024,_0x31a5bf)=>{var _0x325b79=_0x4dcc32;_0x3f052e[_0x31a5bf][_0x325b79(0x1df)]=_0x562024;}),_0x5f481e[_0x4dcc32(0x1f7)]((_0x5e4d8a,_0x1d3490)=>{_0x3f052e[_0x1d3490]['unit']=_0x5e4d8a;}),_0x3cf21c[_0x4dcc32(0x1f7)]((_0x163590,_0x305bf5)=>{_0x3f052e[_0x305bf5]['secondary_unit']=_0x163590;}),_0x4c95b8['forEach']((_0x3e4cb7,_0x4d5eb5)=>{_0x3f052e[_0x4d5eb5]['product_code']=_0x3e4cb7;}),_0x546a55[_0x4dcc32(0x1f7)]((_0x4e0d36,_0x33bee7)=>{var _0x521586=_0x4dcc32;_0x3f052e[_0x33bee7][_0x521586(0x1cf)]=_0x4e0d36;}),_0x213ca4[_0x4dcc32(0x1f7)]((_0x206aa0,_0x3a057c)=>{var _0x1cd340=_0x4dcc32;_0x3f052e[_0x3a057c][_0x1cd340(0x214)]=_0x206aa0;});const _0x3f86e3=_0x3f052e['filter'](_0x12164f=>_0x12164f[_0x4dcc32(0x210)]!=='0'&&_0x12164f[_0x4dcc32(0x210)]!=='');var _0x3db101=0x0;_0x3f86e3[_0x4dcc32(0x1f7)](_0x167fff=>{var _0x53327c=_0x4dcc32;console['log'](_0x53327c(0x1c4),_0x167fff),parseInt(_0x167fff[_0x53327c(0x210)])<=0x0&&_0x3db101++;});if(_0x3db101!=0x0)return _0x3601c7['flash'](_0x4dcc32(0x1f5),_0x4dcc32(0x22b)),_0x2065d6[_0x4dcc32(0x250)](_0x4dcc32(0x1af));_0x5bb903[_0x4dcc32(0x1a0)]=_0x401818,_0x5bb903[_0x4dcc32(0x23a)]=_0x68ba7,_0x5bb903['product']=_0x3f86e3,_0x5bb903[_0x4dcc32(0x1b3)]=_0x303a88,_0x5bb903[_0x4dcc32(0x1e4)]=_0x57750f,_0x5bb903['invoice']=_0x2ff90f,_0x5bb903[_0x4dcc32(0x217)]=_0x5ceb42;const _0x4a1cf5=await _0x5bb903[_0x4dcc32(0x212)](),_0x1cc6ae=await warehouse[_0x4dcc32(0x240)]({'name':_0x401818,'room':_0x57750f});_0x4a1cf5[_0x4dcc32(0x226)]['forEach'](_0x4add4d=>{var _0x577458=_0x4dcc32;const _0x3e1da8=_0x1cc6ae['product_details'][_0x577458(0x247)](_0x3d9f30=>{var _0x65ae2e=_0x577458;_0x4add4d[_0x65ae2e(0x1ee)]==_0x65ae2e(0x229)?_0x3d9f30[_0x65ae2e(0x213)]==_0x4add4d[_0x65ae2e(0x213)]&&_0x3d9f30[_0x65ae2e(0x23b)]==_0x4add4d[_0x65ae2e(0x23b)]&&(_0x3d9f30[_0x65ae2e(0x1fb)]=parseInt(_0x3d9f30[_0x65ae2e(0x1fb)])-parseInt(_0x4add4d[_0x65ae2e(0x210)])):_0x3d9f30[_0x65ae2e(0x213)]==_0x4add4d[_0x65ae2e(0x213)]&&_0x3d9f30[_0x65ae2e(0x23b)]==_0x4add4d[_0x65ae2e(0x23b)]&&(_0x3d9f30[_0x65ae2e(0x1fb)]=parseInt(_0x3d9f30[_0x65ae2e(0x1fb)])+parseInt(_0x4add4d[_0x65ae2e(0x210)]));});}),await _0x1cc6ae[_0x4dcc32(0x212)](),_0x3601c7['flash'](_0x4dcc32(0x19b),_0x4dcc32(0x1bf)),_0x2065d6[_0x4dcc32(0x250)](_0x4dcc32(0x1b8));}catch(_0x258a37){console[_0x4dcc32(0x235)](_0x258a37);}}),router[a0_0x3d0bee(0x1a6)]('/barcode_scanner',async(_0x1655fe,_0x11ee38)=>{var _0x3aba2e=a0_0x3d0bee;const {primary_code:_0x1b8d55,warehouse_data:_0x5986f9,rooms_data:_0x158f1b,Roomslist:_0x204660}=_0x1655fe[_0x3aba2e(0x1d9)],_0x4331c9=_0x204660[_0x3aba2e(0x1d0)](','),_0x2d1069=[];async function _0x16299f(_0x139fdd){var _0x5c56ef=_0x3aba2e;const _0x28415d=await warehouse[_0x5c56ef(0x1db)]([{'$match':{'name':_0x5986f9,'room':_0x139fdd}},{'$unwind':_0x5c56ef(0x24d)},{'$match':{'product_details.primary_code':_0x1b8d55}},{'$group':{'_id':_0x5c56ef(0x244),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5c56ef(0x20f)},'product_code':{'$first':_0x5c56ef(0x1cd)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x5c56ef(0x216)},'type':{'$first':_0x5c56ef(0x24a)},'pallet':{'$first':_0x5c56ef(0x1f6)},'unit':{'$first':_0x5c56ef(0x1f2)},'secondary_unit':{'$first':_0x5c56ef(0x232)},'storage':{'$first':_0x5c56ef(0x24c)},'rack':{'$first':_0x5c56ef(0x1ba)},'expiry_date':{'$first':_0x5c56ef(0x1b5)},'production_date':{'$first':_0x5c56ef(0x197)},'batch_code':{'$first':_0x5c56ef(0x1ce)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x5c56ef(0x205)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x5c56ef(0x22e)}}}]),_0x55a5b9=await warehouse['aggregate']([{'$match':{'name':_0x5986f9,'room':_0x139fdd}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x1b8d55}},{'$group':{'_id':_0x5c56ef(0x244),'name':{'$first':_0x5c56ef(0x1e6)},'product_stock':{'$first':_0x5c56ef(0x1ae)},'primary_code':{'$first':_0x5c56ef(0x1b2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5c56ef(0x1cd)},'level':{'$first':_0x5c56ef(0x225)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x5c56ef(0x24a)},'pallet':{'$first':_0x5c56ef(0x1f6)},'unit':{'$first':_0x5c56ef(0x1f2)},'secondary_unit':{'$first':_0x5c56ef(0x232)},'storage':{'$first':_0x5c56ef(0x24c)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x5c56ef(0x1b5)},'production_date':{'$first':_0x5c56ef(0x197)},'batch_code':{'$first':_0x5c56ef(0x1ce)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5c56ef(0x205)},'roomNamed':{'$first':_0x5c56ef(0x23d)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x28415d[_0x5c56ef(0x1c0)]>0x0)_0x2d1069['push'](_0x28415d);else _0x55a5b9[_0x5c56ef(0x1c0)]>0x0&&_0x2d1069['push'](_0x55a5b9);}const _0x2c3487=_0x4331c9['map'](_0x592d06=>_0x16299f(_0x592d06));await Promise[_0x3aba2e(0x19c)](_0x2c3487),_0x11ee38['json'](_0x2d1069);}),router[a0_0x3d0bee(0x1a6)]('/CheckingWarehouse',async(_0x3968f1,_0x4a7f68)=>{var _0x449fa8=a0_0x3d0bee;const {productCode:_0x56be13,bay:_0x52e55b,warehouses:_0x689e0d,room:_0x9e9cb1}=_0x3968f1['body'];console[_0x449fa8(0x235)](_0x3968f1[_0x449fa8(0x1d9)]);try{const _0xc20a4a=await warehouse[_0x449fa8(0x1db)]([{'$match':{'name':_0x689e0d,'room':_0x9e9cb1}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x52e55b)}},{'$group':{'_id':_0x449fa8(0x244),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x449fa8(0x1ae)},'bay':{'$first':_0x449fa8(0x225)},'maxProducts':{'$first':_0x449fa8(0x215)}}}]);_0x4a7f68['status'](0xc8)['json'](_0xc20a4a);}catch(_0x591820){_0x4a7f68[_0x449fa8(0x1de)](0x194)[_0x449fa8(0x22c)]({'message':_0x591820[_0x449fa8(0x24e)]});}}),module['exports']=router;