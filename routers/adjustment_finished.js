var a0_0x26174a=a0_0x16da;(function(_0x4162ce,_0x52b4c7){var _0x46d911=a0_0x16da,_0x4d2033=_0x4162ce();while(!![]){try{var _0x320f87=-parseInt(_0x46d911(0x10f))/0x1+parseInt(_0x46d911(0x14f))/0x2*(parseInt(_0x46d911(0x107))/0x3)+parseInt(_0x46d911(0xce))/0x4*(parseInt(_0x46d911(0x125))/0x5)+parseInt(_0x46d911(0xcb))/0x6*(parseInt(_0x46d911(0x11d))/0x7)+-parseInt(_0x46d911(0x13f))/0x8+parseInt(_0x46d911(0x179))/0x9*(-parseInt(_0x46d911(0x14e))/0xa)+-parseInt(_0x46d911(0x154))/0xb*(-parseInt(_0x46d911(0xc9))/0xc);if(_0x320f87===_0x52b4c7)break;else _0x4d2033['push'](_0x4d2033['shift']());}catch(_0x54b132){_0x4d2033['push'](_0x4d2033['shift']());}}}(a0_0x44c4,0xbd357));const express=require(a0_0x26174a(0x17a)),app=express(),router=express[a0_0x26174a(0xf1)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x26174a(0x173)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x26174a(0xf2));function a0_0x44c4(){var _0x21e534=['adjustment\x20data\x20update\x20successfully','prod_code','/view/:id','$product_details.secondary_unit','Adjustment\x20Mail','<tbody\x20style=\x22text-align:\x20center;\x22>','host','/view/add_adjustment','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','/CheckingWarehouse','$product_details.maxProducts','master','<!DOCTYPE\x20html>','get','/view','$product_details.invoice','message','email','_id','room','$product_details.bay','Portuguese','foreach\x20newproduct','</h5>','body','filter','minus','Router','nodemailer','maxPerUnit','render','$product_details','add','stockBefore','An\x20error\x20occurred.','$_id','$product_details.production_date','$product_details.product_name','findById','edit_adjustment_finished_view','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','findOne','Arabic\x20(ae)','<div>','$name','</body></html>','$product_details.type','$product_details.product_stock','3MeADin','QA\x20Warehouse','</tr>','room_names','$product_details.expiry_date','$product_details.secondary_code','user','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','1506247LrFZCi','/adjustment/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</div>','$product','params','There\x27s\x20a\x20error\x20in\x20this\x20transaction','bay','getFullYear','$warehouse_name','post','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Email\x20sent\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','119BrUYPW','English','ADJF-','role','/preview/:id','split','$product_details.unit','Arabic','40995dGdiCC','<hr\x20class=\x22my-3\x22>','aggregate','prod_invoice','<html><head><title></title>','Chinese','Enabled','level','forEach','Return\x20Rooms','error','New_Qty_Converted_adj','length','$product.product_name','$product_details._id','Finished\x20Goods','port','<h5>','product_name','catch','site_title','True','German','types','<strong>\x20Regards\x20</strong>','$product_details.primary_code','9456648CMCrZL','$product.room_names','An\x20error\x20occurred\x20while\x20saving\x20data.','new_adjust_qty','$product_details.maxPerUnit','padStart','purchases_data','stock','Ambient','prod_name','log','French','New_Qty_Converted','finalize','exports','500xPHWIs','2262996DMwKAb','then','string','map','/adjustment_finished/view','44bYMDdK','$product_details.bin','errors','JO_number','</head><body>','adjustment_finished','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','secondary_unit','success','image','back','Primary_Units','\x20</h2>','product_details','Rooms','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','Secondary_units','<h2>\x20','<tr>','product_stock','warehouse','floor','product_code','Hindi','</table>','warehouse_name','\x20Order\x20Number\x20:\x20','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','sendMail','Enclosed','../models/all_models','date','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','redirect','production_date','29169EJiHOL','express','$product_details.batch_code','$product_details.rack','$product_details.floorlevel','getDate','find','flash','invoice','DRY\x20GOODS','Spanish','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','language','Adjustment\x20Finalize\x20Successfully','/picking_list/PDF_adjustment/','save','adjust_qty','password','$product_details.product_code','expiry_date','prod_cat','staff','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/barcode_scanner','Portuguese\x20(BR)','createTransport','logo','status','</td>','4278804RXEtrZ','$invoice','6402ylaFPr','$room','all','512ViuSIP','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','json','/adjustment_finished/preview/','product_date','unit','$product_details.storage'];a0_0x44c4=function(){return _0x21e534;};return a0_0x44c4();}function a0_0x16da(_0x138be7,_0x1bc471){var _0x44c4eb=a0_0x44c4();return a0_0x16da=function(_0x16da20,_0x1c9061){_0x16da20=_0x16da20-0xbe;var _0x1e3a37=_0x44c4eb[_0x16da20];return _0x1e3a37;},a0_0x16da(_0x138be7,_0x1bc471);}router['get'](a0_0x26174a(0xe4),auth,async(_0x4ccc9c,_0x241292)=>{var _0x11e91d=a0_0x26174a;try{const {username:_0x351456,email:_0x379fb2,role:_0x55568c}=_0x4ccc9c[_0x11e91d(0x10d)],_0x1f8f0b=_0x4ccc9c[_0x11e91d(0x10d)],_0xb4335a=await profile['findOne']({'email':_0x1f8f0b['email']}),_0x5bff1f=await master_shop[_0x11e91d(0x17f)]();let _0x503182;if(_0x1f8f0b['role']==_0x11e91d(0xc0)){const _0x2f75f1=await staff['findOne']({'email':_0x1f8f0b[_0x11e91d(0xe7)]});_0x503182=await warehouse[_0x11e91d(0x17f)]({'status':'Enabled','name':_0x2f75f1[_0x11e91d(0x168)]});}else _0x503182=await warehouse['find']({'status':_0x11e91d(0x12b)});const _0x35ea3e=await product[_0x11e91d(0x17f)]();let _0x512f6b;if(_0x1f8f0b[_0x11e91d(0x120)]=='staff'){const _0x310b8a=await staff[_0x11e91d(0x100)]({'email':_0x1f8f0b[_0x11e91d(0xe7)]});_0x512f6b=await adjustment_finished[_0x11e91d(0x17f)]({'warehouse_name':_0x310b8a['warehouse']});}else _0x512f6b=await adjustment_finished[_0x11e91d(0x127)]([{'$unwind':_0x11e91d(0x113)},{'$group':{'_id':_0x11e91d(0xf9),'invoice':{'$first':_0x11e91d(0xca)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x11e91d(0x118)},'room':{'$addToSet':_0x11e91d(0x140)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5bff1f[0x0][_0x11e91d(0x185)]=='English\x20(US)'){var _0x12a940=users[_0x11e91d(0x11e)];console[_0x11e91d(0x149)](_0x12a940);}else{if(_0x5bff1f[0x0][_0x11e91d(0x185)]==_0x11e91d(0x16b))var _0x12a940=users['Hindi'];else{if(_0x5bff1f[0x0][_0x11e91d(0x185)]==_0x11e91d(0x13b))var _0x12a940=users[_0x11e91d(0x13b)];else{if(_0x5bff1f[0x0][_0x11e91d(0x185)]==_0x11e91d(0x183))var _0x12a940=users[_0x11e91d(0x183)];else{if(_0x5bff1f[0x0][_0x11e91d(0x185)]==_0x11e91d(0x14a))var _0x12a940=users[_0x11e91d(0x14a)];else{if(_0x5bff1f[0x0]['language']==_0x11e91d(0xc4))var _0x12a940=users[_0x11e91d(0xeb)];else{if(_0x5bff1f[0x0]['language']==_0x11e91d(0x12a))var _0x12a940=users[_0x11e91d(0x12a)];else{if(_0x5bff1f[0x0]['language']==_0x11e91d(0x101))var _0x12a940=users['Arabic'];}}}}}}}_0x241292[_0x11e91d(0xf4)](_0x11e91d(0x159),{'success':_0x4ccc9c[_0x11e91d(0x180)]('success'),'errors':_0x4ccc9c['flash'](_0x11e91d(0x156)),'role':_0x1f8f0b,'profile':_0xb4335a,'warehouse':_0x503182,'product':_0x35ea3e,'adjustment':_0x512f6b,'master_shop':_0x5bff1f,'language':_0x12a940});}catch(_0x4194da){console[_0x11e91d(0x149)](_0x4194da);}});async function getRandom8DigitNumber(){var _0x50301d=a0_0x26174a;const _0x3ad86f=0x989680,_0x55a87b=0x5f5e0ff,_0x84f3a9=Math[_0x50301d(0x169)](Math['random']()*(_0x55a87b-_0x3ad86f+0x1))+_0x3ad86f;var _0x33a18c;const _0x5f148c=await adjustment_finished['findOne']({'invoice':_0x50301d(0x11f)+_0x84f3a9});return _0x5f148c&&_0x5f148c[_0x50301d(0x131)]>0x0?_0x33a18c=_0x50301d(0x11f)+_0x84f3a9:_0x33a18c=_0x50301d(0x11f)+_0x84f3a9,_0x33a18c;}router[a0_0x26174a(0xe3)](a0_0x26174a(0xdd),auth,async(_0x475d41,_0x416cf1)=>{var _0x5c43df=a0_0x26174a;try{const {username:_0x167a73,email:_0x58b5e3,role:_0x50846d}=_0x475d41['user'],_0x5326a9=_0x475d41[_0x5c43df(0x10d)],_0x135c9f=await profile[_0x5c43df(0x100)]({'email':_0x5326a9[_0x5c43df(0xe7)]}),_0x1f4600=await master_shop['find']();let _0x56e825;if(_0x5326a9[_0x5c43df(0x120)]=='staff'){const _0x2e7e28=await staff[_0x5c43df(0x100)]({'email':_0x5326a9[_0x5c43df(0xe7)]});_0x56e825=await warehouse['aggregate']([{'$match':{'status':_0x5c43df(0x12b),'name':_0x2e7e28[_0x5c43df(0x168)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x5c43df(0x108)}}},{'$group':{'_id':_0x5c43df(0x103),'name':{'$first':_0x5c43df(0x103)}}}]);}else _0x56e825=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x5c43df(0x134),'name':{'$ne':_0x5c43df(0x108)}}},{'$group':{'_id':_0x5c43df(0x103),'name':{'$first':_0x5c43df(0x103)}}}]);const _0x1bdabd=await product['find']({}),_0x311a53=await adjustment_finished[_0x5c43df(0x17f)]({}),_0x2c1a8c=_0x311a53[_0x5c43df(0x131)]+0x1,_0x2ac948=_0x5c43df(0x11f)+_0x2c1a8c['toString']()[_0x5c43df(0x144)](0x5,'0');var _0xda6e9c=[_0x5c43df(0x147),_0x5c43df(0x172),_0x5c43df(0x12e)];if(_0x1f4600[0x0][_0x5c43df(0x185)]==_0x5c43df(0x175))var _0x1e5fec=users[_0x5c43df(0x11e)];else{if(_0x1f4600[0x0][_0x5c43df(0x185)]==_0x5c43df(0x16b))var _0x1e5fec=users[_0x5c43df(0x16b)];else{if(_0x1f4600[0x0][_0x5c43df(0x185)]=='German')var _0x1e5fec=users[_0x5c43df(0x13b)];else{if(_0x1f4600[0x0][_0x5c43df(0x185)]=='Spanish')var _0x1e5fec=users[_0x5c43df(0x183)];else{if(_0x1f4600[0x0][_0x5c43df(0x185)]==_0x5c43df(0x14a))var _0x1e5fec=users['French'];else{if(_0x1f4600[0x0]['language']==_0x5c43df(0xc4))var _0x1e5fec=users[_0x5c43df(0xeb)];else{if(_0x1f4600[0x0]['language']==_0x5c43df(0x12a))var _0x1e5fec=users[_0x5c43df(0x12a)];else{if(_0x1f4600[0x0][_0x5c43df(0x185)]==_0x5c43df(0x101))var _0x1e5fec=users[_0x5c43df(0x124)];}}}}}}}const _0x403a1b=getRandom8DigitNumber();_0x403a1b[_0x5c43df(0x150)](_0x30bc43=>{var _0x25aabe=_0x5c43df;_0x416cf1[_0x25aabe(0xf4)]('add_adjustment_finished',{'success':_0x475d41['flash'](_0x25aabe(0x15c)),'errors':_0x475d41[_0x25aabe(0x180)](_0x25aabe(0x156)),'role':_0x5326a9,'profile':_0x135c9f,'warehouse':_0x56e825,'product':_0x1bdabd,'master_shop':_0x1f4600,'language':_0x1e5fec,'rooms_data':_0xda6e9c,'invoice_no':_0x30bc43});})[_0x5c43df(0x138)](_0x9c63a7=>{var _0x502863=_0x5c43df;_0x475d41[_0x502863(0x180)](_0x502863(0x156),_0x502863(0x115)),_0x416cf1[_0x502863(0x177)](_0x502863(0x110));});}catch(_0x4050c2){console[_0x5c43df(0x149)](_0x4050c2);}}),router['post']('/view/add_adjustment',auth,async(_0x57c0d4,_0x55834f)=>{var _0x1ef960=a0_0x26174a;try{const {warehouse_name:_0x21120e,date:_0xe3d617,prod_name:_0x363d6b,level:_0x155db8,isle:_0x7e90da,pallet:_0x2a1ae3,stock:_0x32de86,types:_0x3ed4d9,adjust_qty:_0x3f81af,new_adjust_qty:_0x157c6b,note:_0x208677,Room_name:_0x4ffae3,invoice:_0x9bdcc0,JO_number:_0x162d07,expiry_date:_0xf5b907}=_0x57c0d4[_0x1ef960(0xee)];if(typeof _0x363d6b==_0x1ef960(0x151))var _0xa7b8c5=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x148)]],_0x31878e=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x12c)]],_0x25db99=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x146)]],_0x23b19a=[_0x57c0d4['body'][_0x1ef960(0x13c)]],_0x28dc52=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x130)]],_0x362534=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x14b)]],_0x48ac64=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x15f)]],_0x36fc0a=[_0x57c0d4['body'][_0x1ef960(0x164)]],_0x4c3219=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xd7)]],_0x256a63=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xfe)]],_0x46b096=[_0x57c0d4[_0x1ef960(0xee)]['expiry_date']],_0x16cee6=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xd3)]],_0x1ab626=[_0x57c0d4['body']['prod_cat']],_0x1906f6=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x162)]],_0x5a455a=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xf3)]],_0x33a0ab=[_0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x128)]];else var _0xa7b8c5=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x148)]],_0x31878e=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x12c)]],_0x25db99=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x146)]],_0x23b19a=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x13c)]],_0x28dc52=[..._0x57c0d4['body'][_0x1ef960(0x130)]],_0x362534=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x14b)]],_0x48ac64=[..._0x57c0d4[_0x1ef960(0xee)]['Primary_Units']],_0x36fc0a=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0x164)]],_0x4c3219=[..._0x57c0d4[_0x1ef960(0xee)]['prod_code']],_0x256a63=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xfe)]],_0x46b096=[..._0x57c0d4[_0x1ef960(0xee)]['expiry_date']],_0x16cee6=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xd3)]],_0x1ab626=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xbf)]],_0x1906f6=[..._0x57c0d4[_0x1ef960(0xee)]['Rooms']],_0x5a455a=[..._0x57c0d4[_0x1ef960(0xee)][_0x1ef960(0xf3)]],_0x33a0ab=[..._0x57c0d4['body'][_0x1ef960(0x128)]];const _0x11904a=_0xa7b8c5[_0x1ef960(0x152)](_0x4147db=>{return _0x4147db={'product_name':_0x4147db};});_0x31878e[_0x1ef960(0x12d)]((_0x2b3d02,_0x23aaaa)=>{var _0x30bf31=_0x1ef960;_0x11904a[_0x23aaaa][_0x30bf31(0x116)]=_0x2b3d02;}),_0x25db99[_0x1ef960(0x12d)]((_0x4dba13,_0x142c7a)=>{var _0x26f197=_0x1ef960;_0x11904a[_0x142c7a][_0x26f197(0xf7)]=_0x4dba13;}),_0x23b19a[_0x1ef960(0x12d)]((_0x2cecc0,_0x5a0883)=>{var _0x1c7101=_0x1ef960;_0x11904a[_0x5a0883][_0x1c7101(0x13c)]=_0x2cecc0;}),_0x28dc52[_0x1ef960(0x12d)]((_0x23d612,_0x41663d)=>{_0x11904a[_0x41663d]['adjust_qty']=_0x23d612;}),_0x362534[_0x1ef960(0x12d)]((_0x4cd8f2,_0x457dae)=>{var _0x567c20=_0x1ef960;_0x11904a[_0x457dae][_0x567c20(0x142)]=_0x4cd8f2;}),_0x48ac64[_0x1ef960(0x12d)]((_0x3d07be,_0xe0de29)=>{var _0x2bf04b=_0x1ef960;_0x11904a[_0xe0de29][_0x2bf04b(0xd4)]=_0x3d07be;}),_0x36fc0a[_0x1ef960(0x12d)]((_0x4dfe70,_0x10fd05)=>{var _0x271c2e=_0x1ef960;_0x11904a[_0x10fd05][_0x271c2e(0x15b)]=_0x4dfe70;}),_0x4c3219[_0x1ef960(0x12d)]((_0x16a44d,_0x301095)=>{var _0x49f1fc=_0x1ef960;_0x11904a[_0x301095][_0x49f1fc(0x16a)]=_0x16a44d;}),_0x256a63['forEach']((_0x2bd39d,_0x492523)=>{var _0x5da446=_0x1ef960;_0x11904a[_0x492523][_0x5da446(0xfe)]=_0x2bd39d;}),_0x46b096[_0x1ef960(0x12d)]((_0x3285b3,_0x326f73)=>{var _0x418e98=_0x1ef960;_0x11904a[_0x326f73][_0x418e98(0xbe)]=_0x3285b3;}),_0x16cee6[_0x1ef960(0x12d)]((_0x2de85d,_0x8f4352)=>{var _0x4d991f=_0x1ef960;_0x11904a[_0x8f4352][_0x4d991f(0x178)]=_0x2de85d;}),_0x1ab626[_0x1ef960(0x12d)]((_0x22be9a,_0xa48391)=>{_0x11904a[_0xa48391]['prod_cat']=_0x22be9a;}),_0x1906f6[_0x1ef960(0x12d)]((_0xb322ef,_0x410802)=>{var _0x46c518=_0x1ef960;_0x11904a[_0x410802][_0x46c518(0x10a)]=_0xb322ef;}),_0x5a455a[_0x1ef960(0x12d)]((_0x5786cb,_0x243997)=>{var _0x1487e2=_0x1ef960;_0x11904a[_0x243997][_0x1487e2(0xf3)]=_0x5786cb;}),_0x33a0ab[_0x1ef960(0x12d)]((_0x2a8b7d,_0x2c4036)=>{var _0x2ac687=_0x1ef960;_0x11904a[_0x2c4036][_0x2ac687(0x181)]=_0x2a8b7d;});const _0x20d13c=_0x11904a['filter'](_0x4ccced=>_0x4ccced[_0x1ef960(0x189)]!=='0'&&_0x4ccced[_0x1ef960(0x189)]!=='');var _0x59e720=0x0;_0x20d13c['forEach'](_0x51b5d4=>{var _0x11b735=_0x1ef960;console[_0x11b735(0x149)](_0x11b735(0xec),_0x51b5d4),parseInt(_0x51b5d4['adjust_qty'])<=0x0&&_0x59e720++;});if(_0x59e720!=0x0)return _0x57c0d4[_0x1ef960(0x180)](_0x1ef960(0x156),_0x1ef960(0x163)),_0x55834f[_0x1ef960(0x177)](_0x1ef960(0x15e));const _0x384327=new adjustment_finished({'warehouse_name':_0x21120e,'date':_0xe3d617,'product':_0x20d13c,'note':_0x208677,'room':_0x4ffae3,'invoice':_0x9bdcc0,'JO_number':_0x162d07,'expiry_date':_0xf5b907}),_0x3271f1=await _0x384327[_0x1ef960(0x188)]();_0x57c0d4[_0x1ef960(0x180)](_0x1ef960(0x15c),'adjustment\x20add\x20successfull'),_0x55834f['redirect'](_0x1ef960(0xd2)+_0x3271f1['_id']);}catch(_0x350d10){console[_0x1ef960(0x149)](_0x350d10),_0x55834f[_0x1ef960(0xc7)](0xc8)['json']({'message':_0x350d10[_0x1ef960(0xe6)]});}}),router[a0_0x26174a(0xe3)](a0_0x26174a(0x121),auth,async(_0x3c89ff,_0x49b256)=>{var _0xaf090c=a0_0x26174a;try{const {username:_0x1cd49d,email:_0x15fd02,role:_0x4a15b8}=_0x3c89ff[_0xaf090c(0x10d)],_0x319769=_0x3c89ff[_0xaf090c(0x10d)],_0x9f387d=await profile[_0xaf090c(0x100)]({'email':_0x319769[_0xaf090c(0xe7)]}),_0x51eb1b=await master_shop[_0xaf090c(0x17f)](),_0x3840f1=_0x3c89ff[_0xaf090c(0x114)]['id'],_0x210422=await adjustment_finished[_0xaf090c(0xfc)]({'_id':_0x3840f1}),_0x4cfcd2=await purchases[_0xaf090c(0x127)]([{'$match':{'warehouse_name':_0x210422['warehouse_name']}},{'$unwind':_0xaf090c(0x113)},{'$group':{'_id':_0xaf090c(0x132)}}]);console[_0xaf090c(0x149)](_0xaf090c(0x145),_0x4cfcd2);const _0x1404ed=await product[_0xaf090c(0x17f)]({}),_0x4f1aa5=await warehouse[_0xaf090c(0x127)]([{'$match':{'name':_0x210422[_0xaf090c(0x16d)],'warehouse_category':_0xaf090c(0x134)}},{'$unwind':_0xaf090c(0xf5)},{'$group':{'_id':_0xaf090c(0x133),'name':{'$first':_0xaf090c(0xfb)},'product_stock':{'$first':_0xaf090c(0x106)},'bay':{'$first':_0xaf090c(0xea)},'bin':{'$first':_0xaf090c(0x155)},'type':{'$first':_0xaf090c(0x105)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0xaf090c(0x13e)},'secondary_code':{'$first':_0xaf090c(0x10c)},'product_code':{'$first':_0xaf090c(0x18b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xaf090c(0x17c)},'expiry_date':{'$first':_0xaf090c(0x10b)},'production_date':{'$first':_0xaf090c(0xfa)},'batch_code':{'$first':_0xaf090c(0x17b)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':'$room'}}}]);if(_0x51eb1b[0x0][_0xaf090c(0x185)]==_0xaf090c(0x175)){var _0x4eafbe=users[_0xaf090c(0x11e)];console[_0xaf090c(0x149)](_0x4eafbe);}else{if(_0x51eb1b[0x0][_0xaf090c(0x185)]==_0xaf090c(0x16b))var _0x4eafbe=users[_0xaf090c(0x16b)];else{if(_0x51eb1b[0x0][_0xaf090c(0x185)]==_0xaf090c(0x13b))var _0x4eafbe=users[_0xaf090c(0x13b)];else{if(_0x51eb1b[0x0][_0xaf090c(0x185)]==_0xaf090c(0x183))var _0x4eafbe=users[_0xaf090c(0x183)];else{if(_0x51eb1b[0x0][_0xaf090c(0x185)]=='French')var _0x4eafbe=users[_0xaf090c(0x14a)];else{if(_0x51eb1b[0x0][_0xaf090c(0x185)]=='Portuguese\x20(BR)')var _0x4eafbe=users[_0xaf090c(0xeb)];else{if(_0x51eb1b[0x0]['language']==_0xaf090c(0x12a))var _0x4eafbe=users[_0xaf090c(0x12a)];else{if(_0x51eb1b[0x0][_0xaf090c(0x185)]==_0xaf090c(0x101))var _0x4eafbe=users[_0xaf090c(0x124)];}}}}}}}_0x49b256[_0xaf090c(0xf4)](_0xaf090c(0xfd),{'success':_0x3c89ff['flash'](_0xaf090c(0x15c)),'errors':_0x3c89ff[_0xaf090c(0x180)](_0xaf090c(0x156)),'role':_0x319769,'profile':_0x9f387d,'adjustment':_0x210422,'stock':_0x4f1aa5,'master_shop':_0x51eb1b,'warehouse_name':_0x4cfcd2,'unit':_0x1404ed,'language':_0x4eafbe});}catch(_0x1f8547){console[_0xaf090c(0x149)](_0x1f8547),_0x49b256[_0xaf090c(0xc7)](0xc8)['json']({'message':_0x1f8547[_0xaf090c(0xe6)]});}}),router[a0_0x26174a(0x119)](a0_0x26174a(0x121),auth,async(_0x41109b,_0x505a5c)=>{var _0x5e37f0=a0_0x26174a;try{const {invoice:_0x485fda,warehouse_name:_0x2400a8,Room_name:_0x1314a2}=_0x41109b[_0x5e37f0(0xee)],_0x5344b8=_0x41109b[_0x5e37f0(0x114)]['id'],_0xc8f6e0=await adjustment_finished[_0x5e37f0(0xfc)]({'_id':_0x5344b8});var _0x11881d;const _0x517b29=_0xc8f6e0['product'][_0x5e37f0(0x152)](async _0x25c241=>{var _0x141f18=_0x5e37f0;if(_0x25c241[_0x141f18(0x189)]>0x0){_0x11881d=await warehouse[_0x141f18(0x100)]({'name':_0x2400a8,'room':_0x25c241[_0x141f18(0x10a)],'warehouse_category':'Finished\x20Goods'});const _0x1d8165=_0x11881d[_0x141f18(0x161)][_0x141f18(0x152)](_0x46241b=>{var _0x16443b=_0x141f18;console[_0x16443b(0x149)](_0x25c241[_0x16443b(0x13c)]);if(_0x25c241['types']==_0x16443b(0xf0))_0x46241b[_0x16443b(0x137)]==_0x25c241[_0x16443b(0x137)]&&_0x46241b['bay']==_0x25c241[_0x16443b(0x116)]&&_0x46241b[_0x16443b(0xbe)]==_0x25c241['expiry_date']&&_0x46241b[_0x16443b(0x178)]==_0x25c241[_0x16443b(0x178)]&&_0x46241b[_0x16443b(0xfe)]==_0x25c241['batch_code']&&_0x46241b['invoice']==_0x25c241[_0x16443b(0x181)]&&(_0x46241b[_0x16443b(0x167)]=_0x46241b['product_stock']-_0x25c241[_0x16443b(0x189)]);else _0x25c241[_0x16443b(0x13c)]==_0x16443b(0xf6)&&(_0x46241b[_0x16443b(0x137)]==_0x25c241[_0x16443b(0x137)]&&_0x46241b[_0x16443b(0x116)]==_0x25c241[_0x16443b(0x116)]&&_0x46241b[_0x16443b(0xbe)]==_0x25c241['expiry_date']&&_0x46241b[_0x16443b(0x178)]==_0x25c241[_0x16443b(0x178)]&&_0x46241b[_0x16443b(0xfe)]==_0x25c241[_0x16443b(0xfe)]&&_0x46241b[_0x16443b(0x181)]==_0x25c241[_0x16443b(0x181)]&&(_0x46241b[_0x16443b(0x167)]=_0x46241b[_0x16443b(0x167)]+_0x25c241[_0x16443b(0x189)]));});}return _0x11881d;});Promise['all'](_0x517b29)[_0x5e37f0(0x150)](async _0x281705=>{var _0xfbf229=_0x5e37f0;try{for(const _0x2e1afc of _0x281705){await _0x2e1afc[_0xfbf229(0x188)]();}_0xc8f6e0[_0xfbf229(0x14c)]=_0xfbf229(0x13a);const _0x178ea8=await _0xc8f6e0[_0xfbf229(0x188)](),_0x20a1ac=await master_shop[_0xfbf229(0x17f)](),_0x95cd8c=await email_settings['findOne'](),_0x31b8d7=await supervisor_settings['find']();var _0x5bdb55=_0xc8f6e0['product'],_0x4c84ab='',_0x1ff2de;for(_0x1ff2de in _0x5bdb55){var _0x5b84b2='FG';_0xc8f6e0['warehouse_name']==_0xfbf229(0x182)&&(_0x5b84b2='DG'),_0x4c84ab+=_0xfbf229(0x166)+_0xfbf229(0x184)+_0x5bdb55[_0x1ff2de][_0xfbf229(0x137)]+_0xfbf229(0xc8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5bdb55[_0x1ff2de][_0xfbf229(0x16a)]+_0xfbf229(0xc8)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5bdb55[_0x1ff2de]['adjust_qty']+_0xfbf229(0xc8)+_0xfbf229(0x184)+_0x5bdb55[_0x1ff2de][_0xfbf229(0xd4)]+'</td>'+_0xfbf229(0x184)+_0x5bdb55[_0x1ff2de][_0xfbf229(0x15b)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xc8f6e0[_0xfbf229(0x16d)]+_0xfbf229(0xc8)+_0xfbf229(0x184)+_0x5bdb55[_0x1ff2de][_0xfbf229(0x10a)]+'</td>'+_0xfbf229(0x184)+_0x5b84b2+_0x5bdb55[_0x1ff2de][_0xfbf229(0x116)]+_0xfbf229(0xc8)+'</tr>';}let _0x23cb5f=nodemailer[_0xfbf229(0xc5)]({'host':_0x95cd8c[_0xfbf229(0xdc)],'port':Number(_0x95cd8c[_0xfbf229(0x135)]),'secure':![],'auth':{'user':_0x95cd8c['email'],'pass':_0x95cd8c[_0xfbf229(0x18a)]}}),_0x48444a={'from':_0x95cd8c['email'],'to':_0x31b8d7[0x0]['FGSEmail'],'subject':_0xfbf229(0xda),'attachments':[{'filename':'Logo.png','path':__dirname+_0xfbf229(0xc1)+'/upload/'+_0x20a1ac[0x0][_0xfbf229(0x15d)],'cid':_0xfbf229(0xc6)}],'html':_0xfbf229(0xe2)+_0xfbf229(0x129)+_0xfbf229(0x158)+_0xfbf229(0x102)+_0xfbf229(0x111)+'<div>'+_0xfbf229(0x10e)+_0xfbf229(0x112)+_0xfbf229(0x102)+_0xfbf229(0x165)+_0x20a1ac[0x0]['site_title']+_0xfbf229(0x160)+_0xfbf229(0x112)+'</div>'+_0xfbf229(0x126)+_0xfbf229(0x102)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0xfbf229(0x16e)+_0xc8f6e0[_0xfbf229(0x181)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0xc8f6e0[_0xfbf229(0x174)]+'\x20'+'</span>'+'</h5>'+_0xfbf229(0x112)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xfbf229(0x11c)+'<tr>'+_0xfbf229(0xd0)+_0xfbf229(0x170)+_0xfbf229(0x176)+_0xfbf229(0x11a)+_0xfbf229(0x15a)+_0xfbf229(0xc2)+_0xfbf229(0xde)+_0xfbf229(0xff)+_0xfbf229(0x109)+'</thead>'+_0xfbf229(0xdb)+'\x20'+_0x4c84ab+'\x20'+_0xfbf229(0xcf)+_0xfbf229(0x16c)+'<div>'+_0xfbf229(0x13d)+_0xfbf229(0x136)+_0x20a1ac[0x0][_0xfbf229(0x139)]+_0xfbf229(0xed)+_0xfbf229(0x112)+_0xfbf229(0x112)+_0xfbf229(0x104)};_0x23cb5f[_0xfbf229(0x171)](_0x48444a,function(_0x43c037,_0x24c9d7){var _0x224ade=_0xfbf229;_0x43c037?(console[_0x224ade(0x149)](_0x43c037),console['log']('Error\x20Occurs')):console[_0x224ade(0x149)](_0x224ade(0x11b));}),_0x41109b[_0xfbf229(0x180)](_0xfbf229(0x15c),_0xfbf229(0x186)),_0x505a5c['redirect'](_0xfbf229(0x187)+_0x178ea8[_0xfbf229(0xe8)]);}catch(_0x121bc9){console[_0xfbf229(0x12f)](_0x121bc9),_0x505a5c[_0xfbf229(0xc7)](0x1f4)[_0xfbf229(0xd1)]({'error':_0xfbf229(0x141)});}})[_0x5e37f0(0x138)](_0x32ede9=>{var _0x1041fc=_0x5e37f0;console[_0x1041fc(0x12f)](_0x32ede9),_0x505a5c['status'](0x1f4)[_0x1041fc(0xd1)]({'error':_0x1041fc(0xf8)});});}catch(_0x1ac7be){_0x505a5c[_0x5e37f0(0xd1)]({'message':_0x1ac7be[_0x5e37f0(0xe6)]});}}),router['get'](a0_0x26174a(0xd8),auth,async(_0x1a53a2,_0x3f75be)=>{var _0xcb53cf=a0_0x26174a;try{const {username:_0x3ca29f,email:_0x3c9370,role:_0x13ae3e}=_0x1a53a2['user'],_0x18fd8c=_0x1a53a2[_0xcb53cf(0x10d)],_0x18860c=await profile[_0xcb53cf(0x100)]({'email':_0x18fd8c['email']}),_0x50acbc=await master_shop[_0xcb53cf(0x17f)]();console[_0xcb53cf(0x149)](_0xcb53cf(0xe1),_0x50acbc);const _0x495ffc=_0x1a53a2['params']['id'],_0xd7495f=await adjustment_finished[_0xcb53cf(0xfc)]({'_id':_0x495ffc});let _0x7ff0c3=new Date(_0xd7495f[_0xcb53cf(0xbe)]),_0x68f155=('0'+_0x7ff0c3[_0xcb53cf(0x17e)]())[_0xcb53cf(0x16f)](-0x2),_0x1decff=('0'+(_0x7ff0c3['getMonth']()+0x1))['slice'](-0x2),_0xc2effb=_0x7ff0c3[_0xcb53cf(0x117)](),_0x5b79eb=_0xc2effb+'-'+_0x1decff+'-'+_0x68f155;var _0x342f81=['Ambient','Enclosed',_0xcb53cf(0x12e)];const _0x1b986d=await purchases['aggregate']([{'$match':{'warehouse_name':_0xd7495f[_0xcb53cf(0x16d)]}},{'$unwind':_0xcb53cf(0x113)},{'$group':{'_id':_0xcb53cf(0x132)}}]);console[_0xcb53cf(0x149)](_0xcb53cf(0x145),_0x1b986d);const _0x1a2749=await product[_0xcb53cf(0x17f)]({}),_0x369ac3=await warehouse['aggregate']([{'$match':{'name':_0xd7495f[_0xcb53cf(0x16d)],'room':_0xd7495f[_0xcb53cf(0xe9)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0xcb53cf(0x133),'name':{'$first':_0xcb53cf(0xfb)},'product_stock':{'$first':_0xcb53cf(0x106)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xcb53cf(0x155)},'type':{'$first':_0xcb53cf(0x105)},'floorlevel':{'$first':_0xcb53cf(0x17d)},'primary_code':{'$first':_0xcb53cf(0x13e)},'secondary_code':{'$first':_0xcb53cf(0x10c)},'product_code':{'$first':_0xcb53cf(0x18b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xcb53cf(0x17c)}}}]);if(_0x50acbc[0x0][_0xcb53cf(0x185)]=='English\x20(US)'){var _0x2d3961=users['English'];console['log'](_0x2d3961);}else{if(_0x50acbc[0x0][_0xcb53cf(0x185)]==_0xcb53cf(0x16b))var _0x2d3961=users['Hindi'];else{if(_0x50acbc[0x0][_0xcb53cf(0x185)]==_0xcb53cf(0x13b))var _0x2d3961=users['German'];else{if(_0x50acbc[0x0][_0xcb53cf(0x185)]==_0xcb53cf(0x183))var _0x2d3961=users['Spanish'];else{if(_0x50acbc[0x0][_0xcb53cf(0x185)]=='French')var _0x2d3961=users[_0xcb53cf(0x14a)];else{if(_0x50acbc[0x0]['language']==_0xcb53cf(0xc4))var _0x2d3961=users[_0xcb53cf(0xeb)];else{if(_0x50acbc[0x0]['language']==_0xcb53cf(0x12a))var _0x2d3961=users[_0xcb53cf(0x12a)];else{if(_0x50acbc[0x0][_0xcb53cf(0x185)]==_0xcb53cf(0x101))var _0x2d3961=users[_0xcb53cf(0x124)];}}}}}}}_0x3f75be['render']('edit_adjustment_finished',{'success':_0x1a53a2['flash'](_0xcb53cf(0x15c)),'errors':_0x1a53a2[_0xcb53cf(0x180)](_0xcb53cf(0x156)),'role':_0x18fd8c,'profile':_0x18860c,'adjustment':_0xd7495f,'stock':_0x369ac3,'master_shop':_0x50acbc,'warehouse_name':_0x1b986d,'unit':_0x1a2749,'language':_0x2d3961,'rooms_data':_0x342f81,'ed_fullDate':_0x5b79eb});}catch(_0x5e2d7e){console[_0xcb53cf(0x149)](_0x5e2d7e),_0x3f75be[_0xcb53cf(0xc7)](0xc8)[_0xcb53cf(0xd1)]({'message':_0x5e2d7e[_0xcb53cf(0xe6)]});}}),router[a0_0x26174a(0x119)](a0_0x26174a(0xd8),auth,async(_0x1018ba,_0xab7dd0)=>{var _0x4bb872=a0_0x26174a;try{const _0xbfd9c6=_0x1018ba[_0x4bb872(0x114)]['id'],_0x173b99=await adjustment_finished[_0x4bb872(0xfc)]({'_id':_0xbfd9c6}),_0x3e7187=await warehouse[_0x4bb872(0x100)]({'name':_0x173b99[_0x4bb872(0x16d)],'room':_0x173b99['room']}),{warehouse_name:_0x1d12ee,date:_0x515ab0,prod_name:_0x58b6fa,level:_0x11f124,isle:_0x416db2,pallet:_0x9ffea1,stock:_0x45818f,types:_0x23862f,adjust_qty:_0x9e3ae8,new_adjust_qty:_0x4c0545,note:_0x154168,Room_name:_0x23575d,invoice:_0x166c09,JO_number:_0x262351}=_0x1018ba[_0x4bb872(0xee)];if(typeof _0x58b6fa==_0x4bb872(0x151))var _0x29ae3b=[_0x1018ba['body']['prod_name']],_0x525896=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x12c)]],_0x3630b9=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x146)]],_0x5d3b28=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x13c)]],_0x521b87=[_0x1018ba['body'][_0x4bb872(0x189)]],_0x3550c3=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x142)]],_0x59f988=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0xd7)]],_0x456f6c=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0xd4)]],_0x57513c=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x164)]],_0x53e369=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0xfe)]],_0x5d54ec=[_0x1018ba[_0x4bb872(0xee)][_0x4bb872(0xbe)]];else var _0x29ae3b=[..._0x1018ba['body'][_0x4bb872(0x148)]],_0x525896=[..._0x1018ba['body']['level']],_0x3630b9=[..._0x1018ba['body'][_0x4bb872(0x146)]],_0x5d3b28=[..._0x1018ba['body']['types']],_0x521b87=[..._0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x189)]],_0x3550c3=[..._0x1018ba[_0x4bb872(0xee)][_0x4bb872(0x142)]],_0x59f988=[..._0x1018ba[_0x4bb872(0xee)][_0x4bb872(0xd7)]],_0x456f6c=[..._0x1018ba['body'][_0x4bb872(0xd4)]],_0x57513c=[..._0x1018ba['body'][_0x4bb872(0x164)]],_0x53e369=[..._0x1018ba[_0x4bb872(0xee)]['batch_code']],_0x5d54ec=[..._0x1018ba[_0x4bb872(0xee)]['expiry_date']];const _0x1c0e18=_0x29ae3b['map'](_0x35f90b=>{return _0x35f90b={'product_name':_0x35f90b};});_0x525896[_0x4bb872(0x12d)]((_0xe9dc7d,_0x382fb4)=>{_0x1c0e18[_0x382fb4]['bay']=_0xe9dc7d;}),_0x3630b9['forEach']((_0x277cf1,_0x2aa01b)=>{var _0x3f62b9=_0x4bb872;_0x1c0e18[_0x2aa01b][_0x3f62b9(0xf7)]=_0x277cf1;}),_0x5d3b28['forEach']((_0x492e7e,_0x475c2f)=>{var _0x56604e=_0x4bb872;_0x1c0e18[_0x475c2f][_0x56604e(0x13c)]=_0x492e7e;}),_0x521b87['forEach']((_0x4cf6a3,_0x52b12f)=>{var _0x53ebfd=_0x4bb872;_0x1c0e18[_0x52b12f][_0x53ebfd(0x189)]=_0x4cf6a3;}),_0x3550c3[_0x4bb872(0x12d)]((_0x565616,_0x94d8af)=>{var _0xb3136b=_0x4bb872;_0x1c0e18[_0x94d8af][_0xb3136b(0x142)]=_0x565616;}),_0x456f6c['forEach']((_0x585161,_0x1e6002)=>{var _0x13da3d=_0x4bb872;_0x1c0e18[_0x1e6002][_0x13da3d(0xd4)]=_0x585161;}),_0x57513c[_0x4bb872(0x12d)]((_0x44e730,_0x2b3b96)=>{var _0x11ea14=_0x4bb872;_0x1c0e18[_0x2b3b96][_0x11ea14(0x15b)]=_0x44e730;}),_0x59f988[_0x4bb872(0x12d)]((_0x33efc5,_0x37b3dc)=>{_0x1c0e18[_0x37b3dc]['product_code']=_0x33efc5;}),_0x53e369[_0x4bb872(0x12d)]((_0x841794,_0x3ca2e4)=>{var _0x138f07=_0x4bb872;_0x1c0e18[_0x3ca2e4][_0x138f07(0xfe)]=_0x841794;}),_0x5d54ec[_0x4bb872(0x12d)]((_0x4737b6,_0x29feff)=>{_0x1c0e18[_0x29feff]['expiry_date']=_0x4737b6;});const _0x4bceec=_0x1c0e18[_0x4bb872(0xef)](_0x3e485a=>_0x3e485a[_0x4bb872(0x189)]!=='0'&&_0x3e485a[_0x4bb872(0x189)]!=='');var _0x4895e8=0x0;_0x4bceec[_0x4bb872(0x12d)](_0x452abe=>{var _0x329f97=_0x4bb872;console[_0x329f97(0x149)](_0x329f97(0xec),_0x452abe),parseInt(_0x452abe[_0x329f97(0x189)])<=0x0&&_0x4895e8++;});if(_0x4895e8!=0x0)return _0x1018ba['flash']('errors',_0x4bb872(0x163)),_0xab7dd0[_0x4bb872(0x177)]('back');_0x173b99['warehouse_name']=_0x1d12ee,_0x173b99[_0x4bb872(0x174)]=_0x515ab0,_0x173b99['product']=_0x4bceec,_0x173b99['note']=_0x154168,_0x173b99[_0x4bb872(0xe9)]=_0x23575d,_0x173b99[_0x4bb872(0x181)]=_0x166c09,_0x173b99[_0x4bb872(0x157)]=_0x262351;const _0x43df50=await _0x173b99[_0x4bb872(0x188)](),_0x4688e4=await warehouse['findOne']({'name':_0x1d12ee,'room':_0x23575d});_0x43df50['product'][_0x4bb872(0x12d)](_0x3c9c30=>{var _0x125042=_0x4bb872;const _0x3b2a2f=_0x4688e4['product_details'][_0x125042(0x152)](_0x366bb1=>{var _0x2065b9=_0x125042;_0x3c9c30['types']==_0x2065b9(0xf0)?_0x366bb1[_0x2065b9(0x137)]==_0x3c9c30['product_name']&&_0x366bb1[_0x2065b9(0x116)]==_0x3c9c30[_0x2065b9(0x116)]&&(_0x366bb1[_0x2065b9(0x167)]=parseInt(_0x366bb1[_0x2065b9(0x167)])-parseInt(_0x3c9c30[_0x2065b9(0x189)])):_0x366bb1[_0x2065b9(0x137)]==_0x3c9c30['product_name']&&_0x366bb1['bay']==_0x3c9c30[_0x2065b9(0x116)]&&(_0x366bb1['product_stock']=parseInt(_0x366bb1[_0x2065b9(0x167)])+parseInt(_0x3c9c30[_0x2065b9(0x189)]));});}),await _0x4688e4[_0x4bb872(0x188)](),_0x1018ba[_0x4bb872(0x180)](_0x4bb872(0x15c),_0x4bb872(0xd6)),_0xab7dd0[_0x4bb872(0x177)](_0x4bb872(0x153));}catch(_0xea17c3){console[_0x4bb872(0x149)](_0xea17c3);}}),router[a0_0x26174a(0x119)](a0_0x26174a(0xc3),async(_0x29d913,_0x4e3056)=>{var _0x10cc68=a0_0x26174a;const {primary_code:_0x4a90b7,warehouse_data:_0x3df6e5,rooms_data:_0x1d6af3,Roomslist:_0x23cfb5}=_0x29d913[_0x10cc68(0xee)],_0xd10c92=_0x23cfb5[_0x10cc68(0x122)](','),_0x22211e=[];async function _0x3bf81a(_0x44abc7){var _0x2e3778=_0x10cc68;const _0x29826a=await warehouse['aggregate']([{'$match':{'name':_0x3df6e5,'room':_0x44abc7}},{'$unwind':_0x2e3778(0xf5)},{'$match':{'product_details.primary_code':_0x4a90b7}},{'$group':{'_id':_0x2e3778(0x133),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2e3778(0x106)},'primary_code':{'$first':_0x2e3778(0x13e)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x2e3778(0x18b)},'level':{'$first':_0x2e3778(0xea)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2e3778(0x105)},'pallet':{'$first':_0x2e3778(0x17d)},'unit':{'$first':_0x2e3778(0x123)},'secondary_unit':{'$first':_0x2e3778(0xd9)},'storage':{'$first':_0x2e3778(0xd5)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2e3778(0x17b)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2e3778(0x143)},'roomNamed':{'$first':_0x2e3778(0xcc)},'invoice':{'$first':_0x2e3778(0xe5)}}}]),_0x5c7a52=await warehouse[_0x2e3778(0x127)]([{'$match':{'name':_0x3df6e5,'room':_0x44abc7}},{'$unwind':_0x2e3778(0xf5)},{'$match':{'product_details.secondary_code':_0x4a90b7}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2e3778(0x106)},'primary_code':{'$first':_0x2e3778(0x13e)},'secondary_code':{'$first':_0x2e3778(0x10c)},'product_code':{'$first':_0x2e3778(0x18b)},'level':{'$first':_0x2e3778(0xea)},'isle':{'$first':_0x2e3778(0x155)},'type':{'$first':_0x2e3778(0x105)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2e3778(0xd9)},'storage':{'$first':_0x2e3778(0xd5)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x2e3778(0x10b)},'production_date':{'$first':_0x2e3778(0xfa)},'batch_code':{'$first':_0x2e3778(0x17b)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x2e3778(0x143)},'roomNamed':{'$first':_0x2e3778(0xcc)},'invoice':{'$first':_0x2e3778(0xe5)}}}]);if(_0x29826a[_0x2e3778(0x131)]>0x0)_0x22211e['push'](_0x29826a);else _0x5c7a52['length']>0x0&&_0x22211e['push'](_0x5c7a52);}const _0x4d0024=_0xd10c92[_0x10cc68(0x152)](_0x584b83=>_0x3bf81a(_0x584b83));await Promise[_0x10cc68(0xcd)](_0x4d0024),_0x4e3056['json'](_0x22211e);}),router[a0_0x26174a(0x119)](a0_0x26174a(0xdf),async(_0x1ceaba,_0x556b85)=>{var _0x2dc55c=a0_0x26174a;const {productCode:_0x531125,bay:_0xfa25cf,warehouses:_0x3ead5c,room:_0x318460}=_0x1ceaba[_0x2dc55c(0xee)];console[_0x2dc55c(0x149)](_0x1ceaba['body']);try{const _0x36f22d=await warehouse[_0x2dc55c(0x127)]([{'$match':{'name':_0x3ead5c,'room':_0x318460}},{'$unwind':_0x2dc55c(0xf5)},{'$match':{'product_details.bay':parseInt(_0xfa25cf)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2dc55c(0xfb)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x2dc55c(0xe0)}}}]);_0x556b85['status'](0xc8)[_0x2dc55c(0xd1)](_0x36f22d);}catch(_0x454381){_0x556b85[_0x2dc55c(0xc7)](0x194)[_0x2dc55c(0xd1)]({'message':_0x454381[_0x2dc55c(0xe6)]});}}),module[a0_0x26174a(0x14d)]=router;