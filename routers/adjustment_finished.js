function a0_0xa2c8(_0x197db3,_0x2b17d8){var _0x39c5b6=a0_0x39c5();return a0_0xa2c8=function(_0xa2c8ba,_0x150a2b){_0xa2c8ba=_0xa2c8ba-0x1d5;var _0x5eaece=_0x39c5b6[_0xa2c8ba];return _0x5eaece;},a0_0xa2c8(_0x197db3,_0x2b17d8);}var a0_0x2cef0d=a0_0xa2c8;(function(_0x3e53d9,_0x2be52f){var _0x59e2f2=a0_0xa2c8,_0x298ab8=_0x3e53d9();while(!![]){try{var _0xd6ef82=-parseInt(_0x59e2f2(0x22f))/0x1*(parseInt(_0x59e2f2(0x261))/0x2)+parseInt(_0x59e2f2(0x245))/0x3+parseInt(_0x59e2f2(0x28f))/0x4*(-parseInt(_0x59e2f2(0x24d))/0x5)+parseInt(_0x59e2f2(0x1f4))/0x6+-parseInt(_0x59e2f2(0x25c))/0x7*(-parseInt(_0x59e2f2(0x1e9))/0x8)+-parseInt(_0x59e2f2(0x287))/0x9+parseInt(_0x59e2f2(0x284))/0xa*(parseInt(_0x59e2f2(0x23c))/0xb);if(_0xd6ef82===_0x2be52f)break;else _0x298ab8['push'](_0x298ab8['shift']());}catch(_0x11e7a5){_0x298ab8['push'](_0x298ab8['shift']());}}}(a0_0x39c5,0x60835));function a0_0x39c5(){var _0x2a8026=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.floorlevel','map','prod_code','Logo.png','</span>','/view/:id','$product.product_name','forEach','room_names','filter','560XoWmZu','product_details','<h5>','Rooms','log','3064uuJxXl','role','<span\x20style=\x22float:\x20right;\x22>','language','body','success','Enclosed','production_date','$product_details.secondary_code','length','Adjustment\x20Finalize\x20Successfully','Ambient','edit_adjustment_finished','../middleware/auth','nodemailer','date','Arabic','JO_number','logo','redirect','/../public','Spanish','</div>','Secondary_units','getMonth','purchases_data','$product_details.secondary_unit','minus','unit','findById','/preview/:id','\x20Order\x20Date\x20:\x20','stock','get','$room','34940LpqwYH','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','4379211uNQAun','/view','New_Qty_Converted','$product_details.batch_code','status','$product_details.rack','../public/language/languages.json','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','16saiwon','/adjustment_finished/preview/','<tbody\x20style=\x22text-align:\x20center;\x22>','finalize','adjust_qty','</body></html>','prod_invoice','new_adjust_qty','<h5\x20style=\x22text-align:\x20left;\x22>','json','expiry_date','site_title','getFullYear','add','Arabic\x20(ae)','slice','$product_details.production_date','$product_details.invoice','True','New_Qty_Converted_adj','warehouse','message','$product_details.maxPerUnit','catch','$date','stockBefore','Adjustment\x20Mail','Hindi','prod_cat','/adjustment/view','back','75704JciyRe','$product_details.bin','email','product_stock','$product_details.unit','bay','<!DOCTYPE\x20html>','edit_adjustment_finished_view','product_name','Enabled','secondary_unit','4666572gNOYiq','params','split','product','exports','/CheckingWarehouse','maxPerUnit','Return\x20Rooms','$product_details.expiry_date','adjustment_finished','$product_details.product_code','aggregate','$product_details.product_stock','\x20Order\x20Number\x20:\x20','staff','user','$product_details._id','</td>','</head><body>','$finalize','port','German','string','Portuguese\x20(BR)','Email\x20sent\x20successfully','$product_details.bay','$product_details.type','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','types','random','/upload/','<html><head><title></title>','<div>','DRY\x20GOODS','foreach\x20newproduct','errors','save','../models/all_models','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','_id','$name','Error\x20Occurs','Primary_Units','$product_details.storage','</thead>','Chinese','$product','$product_details.product_name','</tbody>','flash','$product_details.primary_code','Portuguese','find','Router','product_code','level','$product_details','491umjwRv','post','\x20</h2>','batch_code','then','Finished\x20Goods','English\x20(US)','ADJF-','French','QA\x20Warehouse','getDate','$invoice','all','22BeXFDB','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_name','/adjustment_finished/view','invoice','FGSEmail','<hr\x20class=\x22my-3\x22>','/picking_list/PDF_adjustment/','</h5>','314742GNpGAu','product_date','createTransport','padStart','English','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','room','15745WtTylx','$product.room_names','render'];a0_0x39c5=function(){return _0x2a8026;};return a0_0x39c5();}const express=require('express'),app=express(),router=express[a0_0x2cef0d(0x22b)](),auth=require(a0_0x2cef0d(0x26e)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x2cef0d(0x21b)),users=require(a0_0x2cef0d(0x28d)),nodemailer=require(a0_0x2cef0d(0x26f));router[a0_0x2cef0d(0x282)](a0_0x2cef0d(0x288),auth,async(_0x501944,_0x50a031)=>{var _0x1a444c=a0_0x2cef0d;try{const {username:_0x5a77b3,email:_0x592532,role:_0x33cc7b}=_0x501944['user'],_0x46b833=_0x501944['user'],_0x5b2955=await profile[_0x1a444c(0x285)]({'email':_0x46b833[_0x1a444c(0x1eb)]}),_0x7bcd1f=await master_shop[_0x1a444c(0x22a)]();let _0x3776ce;if(_0x46b833[_0x1a444c(0x262)]==_0x1a444c(0x202)){const _0x6ec2fa=await staff[_0x1a444c(0x285)]({'email':_0x46b833[_0x1a444c(0x1eb)]});_0x3776ce=await warehouse[_0x1a444c(0x22a)]({'status':_0x1a444c(0x1f2),'name':_0x6ec2fa[_0x1a444c(0x1de)]});}else _0x3776ce=await warehouse[_0x1a444c(0x22a)]({'status':_0x1a444c(0x1f2)});const _0xbac49b=await product[_0x1a444c(0x22a)]();let _0x1b28c4;if(_0x46b833[_0x1a444c(0x262)]==_0x1a444c(0x202)){const _0x5177ca=await staff['findOne']({'email':_0x46b833[_0x1a444c(0x1eb)]});_0x1b28c4=await adjustment_finished[_0x1a444c(0x22a)]({'warehouse_name':_0x5177ca[_0x1a444c(0x1de)]});}else _0x1b28c4=await adjustment_finished[_0x1a444c(0x1ff)]([{'$unwind':_0x1a444c(0x224)},{'$group':{'_id':'$_id','invoice':{'$first':_0x1a444c(0x23a)},'date':{'$first':_0x1a444c(0x1e2)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x1a444c(0x24e)},'finalize':{'$first':_0x1a444c(0x207)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x7bcd1f[0x0][_0x1a444c(0x264)]==_0x1a444c(0x235)){var _0x38bec6=users[_0x1a444c(0x249)];console[_0x1a444c(0x260)](_0x38bec6);}else{if(_0x7bcd1f[0x0][_0x1a444c(0x264)]=='Hindi')var _0x38bec6=users['Hindi'];else{if(_0x7bcd1f[0x0][_0x1a444c(0x264)]=='German')var _0x38bec6=users[_0x1a444c(0x209)];else{if(_0x7bcd1f[0x0][_0x1a444c(0x264)]==_0x1a444c(0x276))var _0x38bec6=users[_0x1a444c(0x276)];else{if(_0x7bcd1f[0x0][_0x1a444c(0x264)]==_0x1a444c(0x237))var _0x38bec6=users[_0x1a444c(0x237)];else{if(_0x7bcd1f[0x0]['language']==_0x1a444c(0x20b))var _0x38bec6=users[_0x1a444c(0x229)];else{if(_0x7bcd1f[0x0][_0x1a444c(0x264)]=='Chinese')var _0x38bec6=users[_0x1a444c(0x223)];else{if(_0x7bcd1f[0x0][_0x1a444c(0x264)]==_0x1a444c(0x1d8))var _0x38bec6=users['Arabic'];}}}}}}}_0x50a031[_0x1a444c(0x24f)](_0x1a444c(0x1fd),{'success':_0x501944[_0x1a444c(0x227)]('success'),'errors':_0x501944[_0x1a444c(0x227)](_0x1a444c(0x219)),'role':_0x46b833,'profile':_0x5b2955,'warehouse':_0x3776ce,'product':_0xbac49b,'adjustment':_0x1b28c4,'master_shop':_0x7bcd1f,'language':_0x38bec6});}catch(_0x532975){console[_0x1a444c(0x260)](_0x532975);}});async function getRandom8DigitNumber(){var _0xfeb5af=a0_0x2cef0d;const _0x220011=0x989680,_0x1d0e92=0x5f5e0ff,_0x16bf1e=Math['floor'](Math[_0xfeb5af(0x213)]()*(_0x1d0e92-_0x220011+0x1))+_0x220011;var _0x3347c1;const _0x9d88be=await adjustment_finished[_0xfeb5af(0x285)]({'invoice':_0xfeb5af(0x236)+_0x16bf1e});return _0x9d88be&&_0x9d88be[_0xfeb5af(0x26a)]>0x0?_0x3347c1=_0xfeb5af(0x236)+_0x16bf1e:_0x3347c1=_0xfeb5af(0x236)+_0x16bf1e,_0x3347c1;}router[a0_0x2cef0d(0x282)]('/view/add_adjustment',auth,async(_0x4892b6,_0x8e6e4b)=>{var _0x183740=a0_0x2cef0d;try{const {username:_0x5cb036,email:_0x514e98,role:_0x4583a8}=_0x4892b6[_0x183740(0x203)],_0xeaa2f5=_0x4892b6['user'],_0xdb01f0=await profile[_0x183740(0x285)]({'email':_0xeaa2f5['email']}),_0x37d60f=await master_shop['find']();let _0x5d7e55;if(_0xeaa2f5[_0x183740(0x262)]==_0x183740(0x202)){const _0x2bbcf5=await staff[_0x183740(0x285)]({'email':_0xeaa2f5[_0x183740(0x1eb)]});_0x5d7e55=await warehouse['aggregate']([{'$match':{'status':_0x183740(0x1f2),'name':_0x2bbcf5[_0x183740(0x1de)],'warehouse_category':_0x183740(0x234),'name':{'$ne':_0x183740(0x238)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x5d7e55=await warehouse[_0x183740(0x1ff)]([{'$match':{'status':_0x183740(0x1f2),'warehouse_category':_0x183740(0x234),'name':{'$ne':_0x183740(0x238)}}},{'$group':{'_id':'$name','name':{'$first':_0x183740(0x21e)}}}]);const _0x1f4070=await product[_0x183740(0x22a)]({}),_0x57eb33=await adjustment_finished[_0x183740(0x22a)]({}),_0x5d788e=_0x57eb33[_0x183740(0x26a)]+0x1,_0x28001d=_0x183740(0x236)+_0x5d788e['toString']()[_0x183740(0x248)](0x5,'0');var _0x2f4ec3=[_0x183740(0x26c),_0x183740(0x267),'Return\x20Rooms'];if(_0x37d60f[0x0][_0x183740(0x264)]==_0x183740(0x235))var _0x55d898=users[_0x183740(0x249)];else{if(_0x37d60f[0x0]['language']==_0x183740(0x1e5))var _0x55d898=users['Hindi'];else{if(_0x37d60f[0x0]['language']==_0x183740(0x209))var _0x55d898=users['German'];else{if(_0x37d60f[0x0]['language']==_0x183740(0x276))var _0x55d898=users['Spanish'];else{if(_0x37d60f[0x0][_0x183740(0x264)]==_0x183740(0x237))var _0x55d898=users[_0x183740(0x237)];else{if(_0x37d60f[0x0]['language']==_0x183740(0x20b))var _0x55d898=users[_0x183740(0x229)];else{if(_0x37d60f[0x0][_0x183740(0x264)]==_0x183740(0x223))var _0x55d898=users[_0x183740(0x223)];else{if(_0x37d60f[0x0][_0x183740(0x264)]==_0x183740(0x1d8))var _0x55d898=users[_0x183740(0x271)];}}}}}}}const _0x4973a3=getRandom8DigitNumber();_0x4973a3[_0x183740(0x233)](_0x412977=>{var _0x432df6=_0x183740;_0x8e6e4b[_0x432df6(0x24f)]('add_adjustment_finished',{'success':_0x4892b6[_0x432df6(0x227)](_0x432df6(0x266)),'errors':_0x4892b6[_0x432df6(0x227)](_0x432df6(0x219)),'role':_0xeaa2f5,'profile':_0xdb01f0,'warehouse':_0x5d7e55,'product':_0x1f4070,'master_shop':_0x37d60f,'language':_0x55d898,'rooms_data':_0x2f4ec3,'invoice_no':_0x412977});})[_0x183740(0x1e1)](_0x2d85b3=>{var _0x152b81=_0x183740;_0x4892b6['flash']('errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x8e6e4b[_0x152b81(0x274)](_0x152b81(0x1e7));});}catch(_0x3cebd6){console[_0x183740(0x260)](_0x3cebd6);}}),router[a0_0x2cef0d(0x230)]('/view/add_adjustment',auth,async(_0x1020d0,_0x18b3af)=>{var _0xfa17cf=a0_0x2cef0d;try{const {warehouse_name:_0x5ba73b,date:_0x4aba02,prod_name:_0x163557,level:_0x2c50f1,isle:_0x15edd2,pallet:_0x368f1b,stock:_0x130b33,types:_0x376e12,adjust_qty:_0xdd756c,new_adjust_qty:_0x212d38,note:_0x4c16b8,Room_name:_0x56119a,invoice:_0x2e4323,JO_number:_0x3673b7,expiry_date:_0x585cc4}=_0x1020d0['body'];if(typeof _0x163557==_0xfa17cf(0x20a))var _0x2f48ef=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x23e)]],_0x3509e6=[_0x1020d0['body']['level']],_0x2be032=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x281)]],_0x44ebe1=[_0x1020d0['body']['types']],_0x4a293c=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x1dd)]],_0x1ed8a4=[_0x1020d0['body'][_0xfa17cf(0x289)]],_0x3ce8df=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x220)]],_0x5110c5=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x278)]],_0x41ac2f=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x254)]],_0x5e88fd=[_0x1020d0[_0xfa17cf(0x265)]['batch_code']],_0x8fd54d=[_0x1020d0['body']['expiry_date']],_0x249b89=[_0x1020d0[_0xfa17cf(0x265)]['product_date']],_0x48cea9=[_0x1020d0['body'][_0xfa17cf(0x1e6)]],_0x492001=[_0x1020d0['body'][_0xfa17cf(0x25f)]],_0x50815e=[_0x1020d0[_0xfa17cf(0x265)]['maxPerUnit']],_0x4ae3b4=[_0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x295)]];else var _0x2f48ef=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x23e)]],_0x3509e6=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x22d)]],_0x2be032=[..._0x1020d0[_0xfa17cf(0x265)]['stock']],_0x44ebe1=[..._0x1020d0[_0xfa17cf(0x265)]['types']],_0x4a293c=[..._0x1020d0['body'][_0xfa17cf(0x1dd)]],_0x1ed8a4=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x289)]],_0x3ce8df=[..._0x1020d0[_0xfa17cf(0x265)]['Primary_Units']],_0x5110c5=[..._0x1020d0['body']['Secondary_units']],_0x41ac2f=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x254)]],_0x5e88fd=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x232)]],_0x8fd54d=[..._0x1020d0['body']['expiry_date']],_0x249b89=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x246)]],_0x48cea9=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x1e6)]],_0x492001=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x25f)]],_0x50815e=[..._0x1020d0[_0xfa17cf(0x265)]['maxPerUnit']],_0x4ae3b4=[..._0x1020d0[_0xfa17cf(0x265)][_0xfa17cf(0x295)]];const _0x3e026d=_0x2f48ef['map'](_0x2c5dba=>{return _0x2c5dba={'product_name':_0x2c5dba};});_0x3509e6[_0xfa17cf(0x259)]((_0x18d379,_0x1504b9)=>{_0x3e026d[_0x1504b9]['bay']=_0x18d379;}),_0x2be032[_0xfa17cf(0x259)]((_0x5ee2f0,_0x21845a)=>{var _0xe302ec=_0xfa17cf;_0x3e026d[_0x21845a][_0xe302ec(0x1e3)]=_0x5ee2f0;}),_0x44ebe1[_0xfa17cf(0x259)]((_0x3a4bef,_0x19f565)=>{var _0x48f28a=_0xfa17cf;_0x3e026d[_0x19f565][_0x48f28a(0x212)]=_0x3a4bef;}),_0x4a293c[_0xfa17cf(0x259)]((_0x2e87ef,_0x2ebd4d)=>{_0x3e026d[_0x2ebd4d]['adjust_qty']=_0x2e87ef;}),_0x1ed8a4[_0xfa17cf(0x259)]((_0x72b04d,_0x9bad94)=>{var _0xaf7a93=_0xfa17cf;_0x3e026d[_0x9bad94][_0xaf7a93(0x296)]=_0x72b04d;}),_0x3ce8df[_0xfa17cf(0x259)]((_0x5b99a0,_0x160225)=>{_0x3e026d[_0x160225]['unit']=_0x5b99a0;}),_0x5110c5[_0xfa17cf(0x259)]((_0x594377,_0x4e7889)=>{var _0x1e0eb6=_0xfa17cf;_0x3e026d[_0x4e7889][_0x1e0eb6(0x1f3)]=_0x594377;}),_0x41ac2f['forEach']((_0x256e4b,_0x115314)=>{var _0x14bfa5=_0xfa17cf;_0x3e026d[_0x115314][_0x14bfa5(0x22c)]=_0x256e4b;}),_0x5e88fd['forEach']((_0x3c54ff,_0x2d1d8d)=>{var _0x1bb02c=_0xfa17cf;_0x3e026d[_0x2d1d8d][_0x1bb02c(0x232)]=_0x3c54ff;}),_0x8fd54d[_0xfa17cf(0x259)]((_0x26f0a7,_0x3e34c2)=>{var _0x27f8c1=_0xfa17cf;_0x3e026d[_0x3e34c2][_0x27f8c1(0x299)]=_0x26f0a7;}),_0x249b89['forEach']((_0x392b90,_0x1ca839)=>{_0x3e026d[_0x1ca839]['production_date']=_0x392b90;}),_0x48cea9[_0xfa17cf(0x259)]((_0x5b4473,_0x4fafbf)=>{var _0x3ddabe=_0xfa17cf;_0x3e026d[_0x4fafbf][_0x3ddabe(0x1e6)]=_0x5b4473;}),_0x492001[_0xfa17cf(0x259)]((_0x100196,_0x1d8129)=>{var _0x242658=_0xfa17cf;_0x3e026d[_0x1d8129][_0x242658(0x25a)]=_0x100196;}),_0x50815e[_0xfa17cf(0x259)]((_0x132aa4,_0x35acb2)=>{var _0x3f6b65=_0xfa17cf;_0x3e026d[_0x35acb2][_0x3f6b65(0x1fa)]=_0x132aa4;}),_0x4ae3b4[_0xfa17cf(0x259)]((_0x193fd9,_0xe1186f)=>{_0x3e026d[_0xe1186f]['invoice']=_0x193fd9;});const _0x54a0df=_0x3e026d[_0xfa17cf(0x25b)](_0x28978f=>_0x28978f[_0xfa17cf(0x293)]!=='0'&&_0x28978f[_0xfa17cf(0x293)]!=='');var _0x2fbe93=0x0;_0x54a0df[_0xfa17cf(0x259)](_0x51dcc7=>{var _0xdbab00=_0xfa17cf;console[_0xdbab00(0x260)](_0xdbab00(0x218),_0x51dcc7),parseInt(_0x51dcc7['adjust_qty'])<=0x0&&_0x2fbe93++;});if(_0x2fbe93!=0x0)return _0x1020d0[_0xfa17cf(0x227)](_0xfa17cf(0x219),_0xfa17cf(0x28e)),_0x18b3af[_0xfa17cf(0x274)](_0xfa17cf(0x1e8));const _0x211829=new adjustment_finished({'warehouse_name':_0x5ba73b,'date':_0x4aba02,'product':_0x54a0df,'note':_0x4c16b8,'room':_0x56119a,'invoice':_0x2e4323,'JO_number':_0x3673b7,'expiry_date':_0x585cc4}),_0x5c72cd=await _0x211829[_0xfa17cf(0x21a)]();_0x1020d0['flash'](_0xfa17cf(0x266),'adjustment\x20add\x20successfull'),_0x18b3af[_0xfa17cf(0x274)](_0xfa17cf(0x290)+_0x5c72cd[_0xfa17cf(0x21d)]);}catch(_0x5923f0){console['log'](_0x5923f0),_0x18b3af[_0xfa17cf(0x28b)](0xc8)[_0xfa17cf(0x298)]({'message':_0x5923f0[_0xfa17cf(0x1df)]});}}),router[a0_0x2cef0d(0x282)]('/preview/:id',auth,async(_0x501cd6,_0x413e2d)=>{var _0x531857=a0_0x2cef0d;try{const {username:_0x7b510d,email:_0x2afdbe,role:_0x5c729c}=_0x501cd6[_0x531857(0x203)],_0x2c9ef0=_0x501cd6['user'],_0xb65a69=await profile[_0x531857(0x285)]({'email':_0x2c9ef0[_0x531857(0x1eb)]}),_0x2ebbf9=await master_shop[_0x531857(0x22a)](),_0x5b9e37=_0x501cd6['params']['id'],_0x2e53d1=await adjustment_finished['findById']({'_id':_0x5b9e37}),_0x2dbc93=await purchases['aggregate']([{'$match':{'warehouse_name':_0x2e53d1[_0x531857(0x210)]}},{'$unwind':_0x531857(0x224)},{'$group':{'_id':_0x531857(0x258)}}]);console[_0x531857(0x260)](_0x531857(0x27a),_0x2dbc93);const _0x149e6b=await product['find']({}),_0x3f73f4=await warehouse[_0x531857(0x1ff)]([{'$match':{'name':_0x2e53d1[_0x531857(0x210)],'warehouse_category':_0x531857(0x234)}},{'$unwind':_0x531857(0x22e)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x531857(0x225)},'product_stock':{'$first':_0x531857(0x200)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x531857(0x1ea)},'type':{'$first':_0x531857(0x20e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x531857(0x1fe)},'storage':{'$first':_0x531857(0x221)},'rack':{'$first':_0x531857(0x28c)},'expiry_date':{'$first':_0x531857(0x1fc)},'production_date':{'$first':_0x531857(0x1da)},'batch_code':{'$first':_0x531857(0x28a)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x531857(0x283)}}}]);if(_0x2ebbf9[0x0][_0x531857(0x264)]==_0x531857(0x235)){var _0x192840=users['English'];console['log'](_0x192840);}else{if(_0x2ebbf9[0x0][_0x531857(0x264)]==_0x531857(0x1e5))var _0x192840=users[_0x531857(0x1e5)];else{if(_0x2ebbf9[0x0][_0x531857(0x264)]==_0x531857(0x209))var _0x192840=users[_0x531857(0x209)];else{if(_0x2ebbf9[0x0][_0x531857(0x264)]==_0x531857(0x276))var _0x192840=users[_0x531857(0x276)];else{if(_0x2ebbf9[0x0][_0x531857(0x264)]==_0x531857(0x237))var _0x192840=users[_0x531857(0x237)];else{if(_0x2ebbf9[0x0]['language']=='Portuguese\x20(BR)')var _0x192840=users[_0x531857(0x229)];else{if(_0x2ebbf9[0x0]['language']==_0x531857(0x223))var _0x192840=users[_0x531857(0x223)];else{if(_0x2ebbf9[0x0][_0x531857(0x264)]==_0x531857(0x1d8))var _0x192840=users[_0x531857(0x271)];}}}}}}}_0x413e2d[_0x531857(0x24f)](_0x531857(0x1f0),{'success':_0x501cd6[_0x531857(0x227)]('success'),'errors':_0x501cd6[_0x531857(0x227)](_0x531857(0x219)),'role':_0x2c9ef0,'profile':_0xb65a69,'adjustment':_0x2e53d1,'stock':_0x3f73f4,'master_shop':_0x2ebbf9,'warehouse_name':_0x2dbc93,'unit':_0x149e6b,'language':_0x192840});}catch(_0x27235d){console['log'](_0x27235d),_0x413e2d['status'](0xc8)['json']({'message':_0x27235d[_0x531857(0x1df)]});}}),router[a0_0x2cef0d(0x230)](a0_0x2cef0d(0x27f),auth,async(_0xc28d96,_0x388070)=>{var _0x3e9e31=a0_0x2cef0d;try{const {invoice:_0x66ead9,warehouse_name:_0x12d57b,Room_name:_0x2434f3}=_0xc28d96['body'],_0x2f7974=_0xc28d96[_0x3e9e31(0x1f5)]['id'],_0xe29aa4=await adjustment_finished[_0x3e9e31(0x27e)]({'_id':_0x2f7974});var _0x2965f4;const _0x14fa9a=_0xe29aa4[_0x3e9e31(0x1f7)]['map'](async _0x3a2309=>{var _0x43c9f0=_0x3e9e31;if(_0x3a2309['adjust_qty']>0x0){_0x2965f4=await warehouse[_0x43c9f0(0x285)]({'name':_0x12d57b,'room':_0x3a2309[_0x43c9f0(0x25a)],'warehouse_category':'Finished\x20Goods'});const _0x46de72=_0x2965f4[_0x43c9f0(0x25d)][_0x43c9f0(0x253)](_0x3d97b6=>{var _0x152dcb=_0x43c9f0;console[_0x152dcb(0x260)](_0x3a2309['types']);if(_0x3a2309[_0x152dcb(0x212)]==_0x152dcb(0x27c))_0x3d97b6[_0x152dcb(0x1f1)]==_0x3a2309[_0x152dcb(0x1f1)]&&_0x3d97b6[_0x152dcb(0x1ee)]==_0x3a2309[_0x152dcb(0x1ee)]&&_0x3d97b6['expiry_date']==_0x3a2309[_0x152dcb(0x299)]&&_0x3d97b6[_0x152dcb(0x268)]==_0x3a2309[_0x152dcb(0x268)]&&_0x3d97b6[_0x152dcb(0x232)]==_0x3a2309['batch_code']&&_0x3d97b6[_0x152dcb(0x240)]==_0x3a2309[_0x152dcb(0x240)]&&(_0x3d97b6[_0x152dcb(0x1ec)]=_0x3d97b6['product_stock']-_0x3a2309[_0x152dcb(0x293)]);else _0x3a2309[_0x152dcb(0x212)]==_0x152dcb(0x1d7)&&(_0x3d97b6[_0x152dcb(0x1f1)]==_0x3a2309['product_name']&&_0x3d97b6[_0x152dcb(0x1ee)]==_0x3a2309[_0x152dcb(0x1ee)]&&_0x3d97b6[_0x152dcb(0x299)]==_0x3a2309[_0x152dcb(0x299)]&&_0x3d97b6['production_date']==_0x3a2309[_0x152dcb(0x268)]&&_0x3d97b6[_0x152dcb(0x232)]==_0x3a2309[_0x152dcb(0x232)]&&_0x3d97b6[_0x152dcb(0x240)]==_0x3a2309[_0x152dcb(0x240)]&&(_0x3d97b6['product_stock']=_0x3d97b6[_0x152dcb(0x1ec)]+_0x3a2309[_0x152dcb(0x293)]));});}return _0x2965f4;});Promise['all'](_0x14fa9a)[_0x3e9e31(0x233)](async _0x28e267=>{var _0x594bb5=_0x3e9e31;try{for(const _0x276ce4 of _0x28e267){await _0x276ce4['save']();}_0xe29aa4[_0x594bb5(0x292)]=_0x594bb5(0x1dc);const _0x2ae2bd=await _0xe29aa4[_0x594bb5(0x21a)](),_0x4f9c99=await master_shop[_0x594bb5(0x22a)](),_0x4d5fa9=await email_settings['findOne'](),_0x3ddc70=await supervisor_settings[_0x594bb5(0x22a)]();var _0x125ae8=_0xe29aa4[_0x594bb5(0x1f7)],_0x33db26='',_0x3cf293;for(_0x3cf293 in _0x125ae8){var _0x3b5109='FG';_0xe29aa4['warehouse_name']==_0x594bb5(0x217)&&(_0x3b5109='DG'),_0x33db26+='<tr>'+_0x594bb5(0x23d)+_0x125ae8[_0x3cf293][_0x594bb5(0x1f1)]+'</td>'+_0x594bb5(0x23d)+_0x125ae8[_0x3cf293][_0x594bb5(0x22c)]+_0x594bb5(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x125ae8[_0x3cf293][_0x594bb5(0x293)]+_0x594bb5(0x205)+_0x594bb5(0x23d)+_0x125ae8[_0x3cf293]['unit']+_0x594bb5(0x205)+_0x594bb5(0x23d)+_0x125ae8[_0x3cf293][_0x594bb5(0x1f3)]+_0x594bb5(0x205)+_0x594bb5(0x23d)+_0xe29aa4[_0x594bb5(0x210)]+_0x594bb5(0x205)+_0x594bb5(0x23d)+_0x125ae8[_0x3cf293][_0x594bb5(0x25a)]+_0x594bb5(0x205)+_0x594bb5(0x23d)+_0x3b5109+_0x125ae8[_0x3cf293][_0x594bb5(0x1ee)]+_0x594bb5(0x205)+'</tr>';}let _0x36e3d4=nodemailer[_0x594bb5(0x247)]({'host':_0x4d5fa9['host'],'port':Number(_0x4d5fa9[_0x594bb5(0x208)]),'secure':![],'auth':{'user':_0x4d5fa9[_0x594bb5(0x1eb)],'pass':_0x4d5fa9['password']}}),_0x30b166={'from':_0x4d5fa9[_0x594bb5(0x1eb)],'to':_0x3ddc70[0x0][_0x594bb5(0x241)],'subject':_0x594bb5(0x1e4),'attachments':[{'filename':_0x594bb5(0x255),'path':__dirname+_0x594bb5(0x275)+_0x594bb5(0x214)+_0x4f9c99[0x0]['image'],'cid':_0x594bb5(0x273)}],'html':_0x594bb5(0x1ef)+_0x594bb5(0x215)+_0x594bb5(0x206)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x594bb5(0x216)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x594bb5(0x277)+_0x594bb5(0x216)+'<h2>\x20'+_0x4f9c99[0x0][_0x594bb5(0x1d5)]+_0x594bb5(0x231)+'</div>'+_0x594bb5(0x277)+_0x594bb5(0x242)+_0x594bb5(0x216)+_0x594bb5(0x297)+_0x594bb5(0x201)+_0xe29aa4[_0x594bb5(0x240)]+'\x20'+_0x594bb5(0x263)+_0x594bb5(0x280)+_0xe29aa4['date']+'\x20'+_0x594bb5(0x256)+_0x594bb5(0x244)+'</div>'+_0x594bb5(0x251)+_0x594bb5(0x20f)+'<tr>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x594bb5(0x21c)+_0x594bb5(0x250)+_0x594bb5(0x211)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x594bb5(0x286)+_0x594bb5(0x24b)+'</tr>'+_0x594bb5(0x222)+_0x594bb5(0x291)+'\x20'+_0x33db26+'\x20'+_0x594bb5(0x226)+'</table>'+_0x594bb5(0x216)+'<strong>\x20Regards\x20</strong>'+_0x594bb5(0x25e)+_0x4f9c99[0x0][_0x594bb5(0x1d5)]+_0x594bb5(0x244)+'</div>'+_0x594bb5(0x277)+_0x594bb5(0x294)};_0x36e3d4['sendMail'](_0x30b166,function(_0x14188c,_0x410890){var _0x5298aa=_0x594bb5;_0x14188c?(console[_0x5298aa(0x260)](_0x14188c),console[_0x5298aa(0x260)](_0x5298aa(0x21f))):console[_0x5298aa(0x260)](_0x5298aa(0x20c));}),_0xc28d96['flash'](_0x594bb5(0x266),_0x594bb5(0x26b)),_0x388070[_0x594bb5(0x274)](_0x594bb5(0x243)+_0x2ae2bd[_0x594bb5(0x21d)]);}catch(_0x8c2309){console['error'](_0x8c2309),_0x388070[_0x594bb5(0x28b)](0x1f4)['json']({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x3e9e31(0x1e1)](_0x20bc2b=>{var _0x46ab17=_0x3e9e31;console['error'](_0x20bc2b),_0x388070['status'](0x1f4)[_0x46ab17(0x298)]({'error':'An\x20error\x20occurred.'});});}catch(_0x39f5e5){_0x388070[_0x3e9e31(0x298)]({'message':_0x39f5e5[_0x3e9e31(0x1df)]});}}),router['get'](a0_0x2cef0d(0x257),auth,async(_0x17cc51,_0xab096f)=>{var _0x5d4d29=a0_0x2cef0d;try{const {username:_0x46f92a,email:_0x17a93f,role:_0x570d91}=_0x17cc51['user'],_0x1caa26=_0x17cc51[_0x5d4d29(0x203)],_0xe55daf=await profile[_0x5d4d29(0x285)]({'email':_0x1caa26[_0x5d4d29(0x1eb)]}),_0x355f35=await master_shop['find']();console[_0x5d4d29(0x260)]('master',_0x355f35);const _0x203b8f=_0x17cc51['params']['id'],_0x5cd9db=await adjustment_finished['findById']({'_id':_0x203b8f});let _0x15f33a=new Date(_0x5cd9db['expiry_date']),_0x20f3b5=('0'+_0x15f33a[_0x5d4d29(0x239)]())[_0x5d4d29(0x1d9)](-0x2),_0x5c7866=('0'+(_0x15f33a[_0x5d4d29(0x279)]()+0x1))[_0x5d4d29(0x1d9)](-0x2),_0x3f5812=_0x15f33a[_0x5d4d29(0x1d6)](),_0x3ec093=_0x3f5812+'-'+_0x5c7866+'-'+_0x20f3b5;var _0xd9e22=[_0x5d4d29(0x26c),_0x5d4d29(0x267),_0x5d4d29(0x1fb)];const _0x2186a9=await purchases[_0x5d4d29(0x1ff)]([{'$match':{'warehouse_name':_0x5cd9db[_0x5d4d29(0x210)]}},{'$unwind':_0x5d4d29(0x224)},{'$group':{'_id':_0x5d4d29(0x258)}}]);console['log'](_0x5d4d29(0x27a),_0x2186a9);const _0x149406=await product[_0x5d4d29(0x22a)]({}),_0x6bc8fe=await warehouse['aggregate']([{'$match':{'name':_0x5cd9db[_0x5d4d29(0x210)],'room':_0x5cd9db[_0x5d4d29(0x24c)]}},{'$unwind':_0x5d4d29(0x22e)},{'$group':{'_id':_0x5d4d29(0x204),'name':{'$first':_0x5d4d29(0x225)},'product_stock':{'$first':_0x5d4d29(0x200)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x5d4d29(0x1ea)},'type':{'$first':_0x5d4d29(0x20e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5d4d29(0x269)},'product_code':{'$first':_0x5d4d29(0x1fe)},'storage':{'$first':_0x5d4d29(0x221)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x355f35[0x0][_0x5d4d29(0x264)]==_0x5d4d29(0x235)){var _0x51213a=users[_0x5d4d29(0x249)];console[_0x5d4d29(0x260)](_0x51213a);}else{if(_0x355f35[0x0][_0x5d4d29(0x264)]==_0x5d4d29(0x1e5))var _0x51213a=users[_0x5d4d29(0x1e5)];else{if(_0x355f35[0x0]['language']==_0x5d4d29(0x209))var _0x51213a=users[_0x5d4d29(0x209)];else{if(_0x355f35[0x0][_0x5d4d29(0x264)]==_0x5d4d29(0x276))var _0x51213a=users['Spanish'];else{if(_0x355f35[0x0]['language']=='French')var _0x51213a=users[_0x5d4d29(0x237)];else{if(_0x355f35[0x0][_0x5d4d29(0x264)]==_0x5d4d29(0x20b))var _0x51213a=users[_0x5d4d29(0x229)];else{if(_0x355f35[0x0][_0x5d4d29(0x264)]=='Chinese')var _0x51213a=users[_0x5d4d29(0x223)];else{if(_0x355f35[0x0][_0x5d4d29(0x264)]==_0x5d4d29(0x1d8))var _0x51213a=users[_0x5d4d29(0x271)];}}}}}}}_0xab096f[_0x5d4d29(0x24f)](_0x5d4d29(0x26d),{'success':_0x17cc51[_0x5d4d29(0x227)](_0x5d4d29(0x266)),'errors':_0x17cc51[_0x5d4d29(0x227)](_0x5d4d29(0x219)),'role':_0x1caa26,'profile':_0xe55daf,'adjustment':_0x5cd9db,'stock':_0x6bc8fe,'master_shop':_0x355f35,'warehouse_name':_0x2186a9,'unit':_0x149406,'language':_0x51213a,'rooms_data':_0xd9e22,'ed_fullDate':_0x3ec093});}catch(_0x5ac7a7){console[_0x5d4d29(0x260)](_0x5ac7a7),_0xab096f['status'](0xc8)['json']({'message':_0x5ac7a7[_0x5d4d29(0x1df)]});}}),router[a0_0x2cef0d(0x230)]('/view/:id',auth,async(_0x42ff2a,_0x3b278c)=>{var _0x7d7f32=a0_0x2cef0d;try{const _0x56d0f3=_0x42ff2a[_0x7d7f32(0x1f5)]['id'],_0x27fafe=await adjustment_finished[_0x7d7f32(0x27e)]({'_id':_0x56d0f3}),_0xaad3d0=await warehouse[_0x7d7f32(0x285)]({'name':_0x27fafe[_0x7d7f32(0x210)],'room':_0x27fafe['room']}),{warehouse_name:_0x32ca61,date:_0x43e8e5,prod_name:_0x3e2f73,level:_0x33ec9c,isle:_0xbb9ee4,pallet:_0x473550,stock:_0x45187b,types:_0x574081,adjust_qty:_0x18664d,new_adjust_qty:_0xd56581,note:_0x40e018,Room_name:_0x4d62fb,invoice:_0x3f4417,JO_number:_0x36f365}=_0x42ff2a['body'];if(typeof _0x3e2f73==_0x7d7f32(0x20a))var _0x5afe23=[_0x42ff2a['body'][_0x7d7f32(0x23e)]],_0x3df270=[_0x42ff2a['body'][_0x7d7f32(0x22d)]],_0x4c5122=[_0x42ff2a[_0x7d7f32(0x265)][_0x7d7f32(0x281)]],_0x3b049b=[_0x42ff2a[_0x7d7f32(0x265)]['types']],_0x35a88a=[_0x42ff2a[_0x7d7f32(0x265)]['adjust_qty']],_0x5d28f0=[_0x42ff2a[_0x7d7f32(0x265)][_0x7d7f32(0x296)]],_0x4f970e=[_0x42ff2a[_0x7d7f32(0x265)][_0x7d7f32(0x254)]],_0x37f970=[_0x42ff2a[_0x7d7f32(0x265)]['unit']],_0x3dc94e=[_0x42ff2a['body'][_0x7d7f32(0x278)]],_0xe14ab7=[_0x42ff2a[_0x7d7f32(0x265)]['batch_code']],_0x9fca32=[_0x42ff2a[_0x7d7f32(0x265)]['expiry_date']];else var _0x5afe23=[..._0x42ff2a[_0x7d7f32(0x265)][_0x7d7f32(0x23e)]],_0x3df270=[..._0x42ff2a[_0x7d7f32(0x265)]['level']],_0x4c5122=[..._0x42ff2a[_0x7d7f32(0x265)]['stock']],_0x3b049b=[..._0x42ff2a['body'][_0x7d7f32(0x212)]],_0x35a88a=[..._0x42ff2a['body'][_0x7d7f32(0x293)]],_0x5d28f0=[..._0x42ff2a[_0x7d7f32(0x265)][_0x7d7f32(0x296)]],_0x4f970e=[..._0x42ff2a[_0x7d7f32(0x265)]['prod_code']],_0x37f970=[..._0x42ff2a['body']['unit']],_0x3dc94e=[..._0x42ff2a['body'][_0x7d7f32(0x278)]],_0xe14ab7=[..._0x42ff2a[_0x7d7f32(0x265)][_0x7d7f32(0x232)]],_0x9fca32=[..._0x42ff2a[_0x7d7f32(0x265)]['expiry_date']];const _0x1e5808=_0x5afe23['map'](_0x47cc44=>{return _0x47cc44={'product_name':_0x47cc44};});_0x3df270[_0x7d7f32(0x259)]((_0xdfc245,_0x3320a8)=>{var _0x4d4e05=_0x7d7f32;_0x1e5808[_0x3320a8][_0x4d4e05(0x1ee)]=_0xdfc245;}),_0x4c5122['forEach']((_0x2d8ce8,_0x24e7aa)=>{_0x1e5808[_0x24e7aa]['stockBefore']=_0x2d8ce8;}),_0x3b049b[_0x7d7f32(0x259)]((_0x5a7900,_0x291a12)=>{var _0x8285d0=_0x7d7f32;_0x1e5808[_0x291a12][_0x8285d0(0x212)]=_0x5a7900;}),_0x35a88a[_0x7d7f32(0x259)]((_0x395770,_0x4ec394)=>{_0x1e5808[_0x4ec394]['adjust_qty']=_0x395770;}),_0x5d28f0[_0x7d7f32(0x259)]((_0x144c37,_0x8d879e)=>{_0x1e5808[_0x8d879e]['new_adjust_qty']=_0x144c37;}),_0x37f970[_0x7d7f32(0x259)]((_0x406e6b,_0x39dab8)=>{var _0x4f3bd7=_0x7d7f32;_0x1e5808[_0x39dab8][_0x4f3bd7(0x27d)]=_0x406e6b;}),_0x3dc94e[_0x7d7f32(0x259)]((_0x18b43,_0x539de5)=>{_0x1e5808[_0x539de5]['secondary_unit']=_0x18b43;}),_0x4f970e[_0x7d7f32(0x259)]((_0x30af17,_0x33fb1d)=>{var _0x1d93ae=_0x7d7f32;_0x1e5808[_0x33fb1d][_0x1d93ae(0x22c)]=_0x30af17;}),_0xe14ab7[_0x7d7f32(0x259)]((_0x364225,_0x1916bb)=>{_0x1e5808[_0x1916bb]['batch_code']=_0x364225;}),_0x9fca32[_0x7d7f32(0x259)]((_0x23d46a,_0x4e05eb)=>{var _0x4b04eb=_0x7d7f32;_0x1e5808[_0x4e05eb][_0x4b04eb(0x299)]=_0x23d46a;});const _0x449f29=_0x1e5808[_0x7d7f32(0x25b)](_0xa7fe3d=>_0xa7fe3d[_0x7d7f32(0x293)]!=='0'&&_0xa7fe3d[_0x7d7f32(0x293)]!=='');var _0x315235=0x0;_0x449f29[_0x7d7f32(0x259)](_0x1e21fd=>{var _0x1c1f80=_0x7d7f32;console[_0x1c1f80(0x260)]('foreach\x20newproduct',_0x1e21fd),parseInt(_0x1e21fd[_0x1c1f80(0x293)])<=0x0&&_0x315235++;});if(_0x315235!=0x0)return _0x42ff2a[_0x7d7f32(0x227)](_0x7d7f32(0x219),_0x7d7f32(0x28e)),_0x3b278c[_0x7d7f32(0x274)](_0x7d7f32(0x1e8));_0x27fafe[_0x7d7f32(0x210)]=_0x32ca61,_0x27fafe[_0x7d7f32(0x270)]=_0x43e8e5,_0x27fafe[_0x7d7f32(0x1f7)]=_0x449f29,_0x27fafe['note']=_0x40e018,_0x27fafe[_0x7d7f32(0x24c)]=_0x4d62fb,_0x27fafe['invoice']=_0x3f4417,_0x27fafe[_0x7d7f32(0x272)]=_0x36f365;const _0x77a40a=await _0x27fafe[_0x7d7f32(0x21a)](),_0x28aae6=await warehouse['findOne']({'name':_0x32ca61,'room':_0x4d62fb});_0x77a40a[_0x7d7f32(0x1f7)]['forEach'](_0x40969b=>{var _0x532318=_0x7d7f32;const _0x15eb28=_0x28aae6[_0x532318(0x25d)][_0x532318(0x253)](_0xbb7b60=>{var _0x3fd7a6=_0x532318;_0x40969b[_0x3fd7a6(0x212)]=='minus'?_0xbb7b60['product_name']==_0x40969b['product_name']&&_0xbb7b60[_0x3fd7a6(0x1ee)]==_0x40969b[_0x3fd7a6(0x1ee)]&&(_0xbb7b60[_0x3fd7a6(0x1ec)]=parseInt(_0xbb7b60['product_stock'])-parseInt(_0x40969b[_0x3fd7a6(0x293)])):_0xbb7b60[_0x3fd7a6(0x1f1)]==_0x40969b['product_name']&&_0xbb7b60[_0x3fd7a6(0x1ee)]==_0x40969b[_0x3fd7a6(0x1ee)]&&(_0xbb7b60[_0x3fd7a6(0x1ec)]=parseInt(_0xbb7b60[_0x3fd7a6(0x1ec)])+parseInt(_0x40969b[_0x3fd7a6(0x293)]));});}),await _0x28aae6[_0x7d7f32(0x21a)](),_0x42ff2a['flash'](_0x7d7f32(0x266),'adjustment\x20data\x20update\x20successfully'),_0x3b278c[_0x7d7f32(0x274)](_0x7d7f32(0x23f));}catch(_0x275f3c){console[_0x7d7f32(0x260)](_0x275f3c);}}),router[a0_0x2cef0d(0x230)](a0_0x2cef0d(0x24a),async(_0x496d74,_0x36ed57)=>{var _0x2b9eb5=a0_0x2cef0d;const {primary_code:_0x3cb3e5,warehouse_data:_0xcfe930,rooms_data:_0x53fd9a,Roomslist:_0x131c7f}=_0x496d74[_0x2b9eb5(0x265)],_0x5a39a8=_0x131c7f[_0x2b9eb5(0x1f6)](','),_0x295b7c=[];async function _0x15af5a(_0x59b2d3){var _0x25cfb0=_0x2b9eb5;const _0x4ed8b2=await warehouse[_0x25cfb0(0x1ff)]([{'$match':{'name':_0xcfe930,'room':_0x59b2d3}},{'$unwind':_0x25cfb0(0x22e)},{'$match':{'product_details.primary_code':_0x3cb3e5}},{'$group':{'_id':_0x25cfb0(0x204),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x25cfb0(0x228)},'secondary_code':{'$first':_0x25cfb0(0x269)},'product_code':{'$first':_0x25cfb0(0x1fe)},'level':{'$first':_0x25cfb0(0x20d)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x25cfb0(0x20e)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x25cfb0(0x1ed)},'secondary_unit':{'$first':_0x25cfb0(0x27b)},'storage':{'$first':_0x25cfb0(0x221)},'rack':{'$first':_0x25cfb0(0x28c)},'expiry_date':{'$first':_0x25cfb0(0x1fc)},'production_date':{'$first':_0x25cfb0(0x1da)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x25cfb0(0x1e0)},'roomNamed':{'$first':_0x25cfb0(0x283)},'invoice':{'$first':_0x25cfb0(0x1db)}}}]),_0xdde4ec=await warehouse['aggregate']([{'$match':{'name':_0xcfe930,'room':_0x59b2d3}},{'$unwind':_0x25cfb0(0x22e)},{'$match':{'product_details.secondary_code':_0x3cb3e5}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x25cfb0(0x225)},'product_stock':{'$first':_0x25cfb0(0x200)},'primary_code':{'$first':_0x25cfb0(0x228)},'secondary_code':{'$first':_0x25cfb0(0x269)},'product_code':{'$first':_0x25cfb0(0x1fe)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x25cfb0(0x1ea)},'type':{'$first':_0x25cfb0(0x20e)},'pallet':{'$first':_0x25cfb0(0x252)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x25cfb0(0x27b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x25cfb0(0x28c)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x25cfb0(0x28a)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x25cfb0(0x1e0)},'roomNamed':{'$first':_0x25cfb0(0x283)},'invoice':{'$first':_0x25cfb0(0x1db)}}}]);if(_0x4ed8b2['length']>0x0)_0x295b7c['push'](_0x4ed8b2);else _0xdde4ec[_0x25cfb0(0x26a)]>0x0&&_0x295b7c['push'](_0xdde4ec);}const _0x562a2d=_0x5a39a8[_0x2b9eb5(0x253)](_0xe75656=>_0x15af5a(_0xe75656));await Promise[_0x2b9eb5(0x23b)](_0x562a2d),_0x36ed57[_0x2b9eb5(0x298)](_0x295b7c);}),router[a0_0x2cef0d(0x230)](a0_0x2cef0d(0x1f9),async(_0x4f91fd,_0x5544f2)=>{var _0xdcf2c9=a0_0x2cef0d;const {productCode:_0x49f434,bay:_0x1fe081,warehouses:_0x67d1ae,room:_0x3a0476}=_0x4f91fd[_0xdcf2c9(0x265)];console[_0xdcf2c9(0x260)](_0x4f91fd[_0xdcf2c9(0x265)]);try{const _0x58cce4=await warehouse[_0xdcf2c9(0x1ff)]([{'$match':{'name':_0x67d1ae,'room':_0x3a0476}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x1fe081)}},{'$group':{'_id':_0xdcf2c9(0x204),'name':{'$first':_0xdcf2c9(0x225)},'product_stock':{'$first':_0xdcf2c9(0x200)},'bay':{'$first':_0xdcf2c9(0x20d)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x5544f2[_0xdcf2c9(0x28b)](0xc8)['json'](_0x58cce4);}catch(_0x3a2823){_0x5544f2[_0xdcf2c9(0x28b)](0x194)[_0xdcf2c9(0x298)]({'message':_0x3a2823['message']});}}),module[a0_0x2cef0d(0x1f8)]=router;