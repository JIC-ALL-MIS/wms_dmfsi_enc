var a0_0x20f015=a0_0x5e23;(function(_0x17e4b9,_0x2bfde3){var _0x3b9c72=a0_0x5e23,_0x26682e=_0x17e4b9();while(!![]){try{var _0x1d46e1=parseInt(_0x3b9c72(0x194))/0x1*(-parseInt(_0x3b9c72(0x176))/0x2)+-parseInt(_0x3b9c72(0x177))/0x3+parseInt(_0x3b9c72(0x1f8))/0x4*(parseInt(_0x3b9c72(0x1cc))/0x5)+parseInt(_0x3b9c72(0x195))/0x6+-parseInt(_0x3b9c72(0x1a7))/0x7*(-parseInt(_0x3b9c72(0x171))/0x8)+parseInt(_0x3b9c72(0x198))/0x9*(-parseInt(_0x3b9c72(0x14b))/0xa)+parseInt(_0x3b9c72(0x1a3))/0xb*(parseInt(_0x3b9c72(0x12f))/0xc);if(_0x1d46e1===_0x2bfde3)break;else _0x26682e['push'](_0x26682e['shift']());}catch(_0x2edc3c){_0x26682e['push'](_0x26682e['shift']());}}}(a0_0x6c0e,0xe144e));function a0_0x5e23(_0x5d45c7,_0x1a5b33){var _0x6c0e81=a0_0x6c0e();return a0_0x5e23=function(_0x5e23c8,_0x575442){_0x5e23c8=_0x5e23c8-0x12d;var _0x4a67db=_0x6c0e81[_0x5e23c8];return _0x4a67db;},a0_0x5e23(_0x5d45c7,_0x1a5b33);}const express=require(a0_0x20f015(0x1a2)),app=express(),router=express[a0_0x20f015(0x1f6)](),auth=require(a0_0x20f015(0x184)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x20f015(0x197)),users=require(a0_0x20f015(0x1d0)),nodemailer=require('nodemailer');function a0_0x6c0e(){var _0x32710e=['/view','\x20</h2>','adjust_qty','new_adjust_qty','True','getFullYear','status','/picking_list/PDF_adjustment/','Email\x20sent\x20successfully','$product_details.batch_code','</head><body>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','420920edMlpU','$product_details.production_date','$product_details.expiry_date','role','flash','image','minus','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','map','get','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.bay','QA\x20Warehouse','padStart','<h2>\x20','types','</div>','/view/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.product_code','Rooms','$product_details.maxPerUnit','FGSEmail','\x20Order\x20Number\x20:\x20','$product_details.primary_code','prod_cat','prod_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','success','New_Qty_Converted','getDate','Chinese','$product_details.secondary_code','body','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','product','<tr>','all','1328hHYZZk','back','log','date','language','2100004ZNuCwp','136803RxZnJZ','$product_details.type','Arabic\x20(ae)','$name','room_names','Enabled','/view/add_adjustment','post','message','prod_name','$product_details.floorlevel','</tbody>','product_date','../middleware/auth','German','Hindi','Portuguese\x20(BR)','error','Logo.png','New_Qty_Converted_adj','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','save','French','Portuguese','$room','product_code','aggregate','exports','push','1aTurib','8829468pAUPpm','catch','../models/all_models','135vKcefi','purchases_data','render','Error\x20Occurs','$product_details.product_stock','stock','DRY\x20GOODS','/CheckingWarehouse','<hr\x20class=\x22my-3\x22>','An\x20error\x20occurred\x20while\x20saving\x20data.','express','11PaUbAt','English','Adjustment\x20Mail','</thead>','2296lKmXLH','$product_details.product_name','adjustment\x20data\x20update\x20successfully','/upload/','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','foreach\x20newproduct','product_name','<!DOCTYPE\x20html>','$date','host','$product_details._id','site_title','<div>','secondary_unit','password','logo','</span>','ADJF-','invoice','stockBefore','edit_adjustment_finished_view','redirect','expiry_date','_id','/adjustment/view','add_adjustment_finished','string','Secondary_units','Ambient','English\x20(US)','$product_details.storage','$product_details.secondary_unit','$product_details.bin','/preview/:id','findById','1010cyHurH','$warehouse_name','product_stock','$product_details','../public/language/languages.json','findOne','random','errors','note','room','product_details','$_id','$product','<h5\x20style=\x22text-align:\x20left;\x22>','$invoice','Return\x20Rooms','/barcode_scanner','warehouse_name','warehouse','length','<html><head><title></title>','forEach','Enclosed','filter','</td>','/adjustment_finished/preview/','</body></html>','/../public','$product_details.invoice','<span\x20style=\x22float:\x20right;\x22>','Spanish','add','user','production_date','\x20Order\x20Date\x20:\x20','</tr>','Finished\x20Goods','</h5>','$product_details.unit','unit','email','adjustment_finished','Router','getMonth','6716hTovHj','$product.product_name','bay','prod_invoice','9414012Ctpixq','json','port','staff','params','level','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','slice','master','$product_details.maxProducts','/adjustment_finished/view','Arabic','</table>','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'];a0_0x6c0e=function(){return _0x32710e;};return a0_0x6c0e();}router[a0_0x20f015(0x154)](a0_0x20f015(0x13f),auth,async(_0xec52af,_0x93a3f6)=>{var _0x37438b=a0_0x20f015;try{const {username:_0x4c832b,email:_0x25515f,role:_0x302bbb}=_0xec52af['user'],_0xf864c1=_0xec52af[_0x37438b(0x1ec)],_0xa7530=await profile[_0x37438b(0x1d1)]({'email':_0xf864c1['email']}),_0x214d4f=await master_shop[_0x37438b(0x135)]();let _0x4d5d38;if(_0xf864c1[_0x37438b(0x14e)]=='staff'){const _0x5c07ef=await staff['findOne']({'email':_0xf864c1['email']});_0x4d5d38=await warehouse['find']({'status':_0x37438b(0x17c),'name':_0x5c07ef[_0x37438b(0x1de)]});}else _0x4d5d38=await warehouse['find']({'status':_0x37438b(0x17c)});const _0x54d87e=await product[_0x37438b(0x135)]();let _0x37234f;if(_0xf864c1[_0x37438b(0x14e)]==_0x37438b(0x132)){const _0x37b823=await staff['findOne']({'email':_0xf864c1[_0x37438b(0x1f4)]});_0x37234f=await adjustment_finished['find']({'warehouse_name':_0x37b823[_0x37438b(0x1de)]});}else _0x37234f=await adjustment_finished[_0x37438b(0x191)]([{'$unwind':'$product'},{'$group':{'_id':_0x37438b(0x1d7),'invoice':{'$first':_0x37438b(0x1da)},'date':{'$first':_0x37438b(0x1b1)},'warehouse_name':{'$first':_0x37438b(0x1cd)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x1c6)){var _0x3e6b77=users[_0x37438b(0x1a4)];console[_0x37438b(0x173)](_0x3e6b77);}else{if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x186))var _0x3e6b77=users['Hindi'];else{if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x185))var _0x3e6b77=users['German'];else{if(_0x214d4f[0x0]['language']==_0x37438b(0x1ea))var _0x3e6b77=users[_0x37438b(0x1ea)];else{if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x18d))var _0x3e6b77=users['French'];else{if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x187))var _0x3e6b77=users[_0x37438b(0x18e)];else{if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x16a))var _0x3e6b77=users['Chinese'];else{if(_0x214d4f[0x0][_0x37438b(0x175)]==_0x37438b(0x179))var _0x3e6b77=users[_0x37438b(0x13b)];}}}}}}}_0x93a3f6[_0x37438b(0x19a)](_0x37438b(0x1f5),{'success':_0xec52af[_0x37438b(0x14f)](_0x37438b(0x167)),'errors':_0xec52af[_0x37438b(0x14f)](_0x37438b(0x1d3)),'role':_0xf864c1,'profile':_0xa7530,'warehouse':_0x4d5d38,'product':_0x54d87e,'adjustment':_0x37234f,'master_shop':_0x214d4f,'language':_0x3e6b77});}catch(_0x260945){console[_0x37438b(0x173)](_0x260945);}});async function getRandom8DigitNumber(){var _0x335724=a0_0x20f015;const _0x290b2f=0x989680,_0x20f4c5=0x5f5e0ff,_0x3e6cad=Math['floor'](Math[_0x335724(0x1d2)]()*(_0x20f4c5-_0x290b2f+0x1))+_0x290b2f;var _0x5e0101;const _0x42e69d=await adjustment_finished['findOne']({'invoice':_0x335724(0x1ba)+_0x3e6cad});return _0x42e69d&&_0x42e69d['length']>0x0?_0x5e0101='ADJF-'+_0x3e6cad:_0x5e0101=_0x335724(0x1ba)+_0x3e6cad,_0x5e0101;}router[a0_0x20f015(0x154)](a0_0x20f015(0x17d),auth,async(_0xfd02ea,_0x26a8da)=>{var _0x1abe08=a0_0x20f015;try{const {username:_0x1ed7e2,email:_0x3d22e1,role:_0x2c26ff}=_0xfd02ea[_0x1abe08(0x1ec)],_0x24418e=_0xfd02ea[_0x1abe08(0x1ec)],_0x58e919=await profile['findOne']({'email':_0x24418e[_0x1abe08(0x1f4)]}),_0x4f123d=await master_shop[_0x1abe08(0x135)]();let _0x2722e0;if(_0x24418e[_0x1abe08(0x14e)]==_0x1abe08(0x132)){const _0x312a36=await staff[_0x1abe08(0x1d1)]({'email':_0x24418e['email']});_0x2722e0=await warehouse[_0x1abe08(0x191)]([{'$match':{'status':'Enabled','name':_0x312a36[_0x1abe08(0x1de)],'warehouse_category':_0x1abe08(0x1f0),'name':{'$ne':_0x1abe08(0x157)}}},{'$group':{'_id':_0x1abe08(0x17a),'name':{'$first':_0x1abe08(0x17a)}}}]);}else _0x2722e0=await warehouse[_0x1abe08(0x191)]([{'$match':{'status':'Enabled','warehouse_category':_0x1abe08(0x1f0),'name':{'$ne':_0x1abe08(0x157)}}},{'$group':{'_id':_0x1abe08(0x17a),'name':{'$first':_0x1abe08(0x17a)}}}]);const _0x275619=await product['find']({}),_0x3b181c=await adjustment_finished[_0x1abe08(0x135)]({}),_0x188a31=_0x3b181c[_0x1abe08(0x1df)]+0x1,_0x527e2e=_0x1abe08(0x1ba)+_0x188a31['toString']()[_0x1abe08(0x158)](0x5,'0');var _0x4907cf=[_0x1abe08(0x1c5),'Enclosed',_0x1abe08(0x1db)];if(_0x4f123d[0x0]['language']==_0x1abe08(0x1c6))var _0x399382=users['English'];else{if(_0x4f123d[0x0]['language']==_0x1abe08(0x186))var _0x399382=users[_0x1abe08(0x186)];else{if(_0x4f123d[0x0][_0x1abe08(0x175)]==_0x1abe08(0x185))var _0x399382=users['German'];else{if(_0x4f123d[0x0][_0x1abe08(0x175)]==_0x1abe08(0x1ea))var _0x399382=users[_0x1abe08(0x1ea)];else{if(_0x4f123d[0x0]['language']=='French')var _0x399382=users[_0x1abe08(0x18d)];else{if(_0x4f123d[0x0][_0x1abe08(0x175)]==_0x1abe08(0x187))var _0x399382=users[_0x1abe08(0x18e)];else{if(_0x4f123d[0x0][_0x1abe08(0x175)]==_0x1abe08(0x16a))var _0x399382=users[_0x1abe08(0x16a)];else{if(_0x4f123d[0x0][_0x1abe08(0x175)]==_0x1abe08(0x179))var _0x399382=users[_0x1abe08(0x13b)];}}}}}}}const _0xe4a6ea=getRandom8DigitNumber();_0xe4a6ea['then'](_0x5d7b88=>{var _0x50748e=_0x1abe08;_0x26a8da['render'](_0x50748e(0x1c2),{'success':_0xfd02ea[_0x50748e(0x14f)]('success'),'errors':_0xfd02ea[_0x50748e(0x14f)](_0x50748e(0x1d3)),'role':_0x24418e,'profile':_0x58e919,'warehouse':_0x2722e0,'product':_0x275619,'master_shop':_0x4f123d,'language':_0x399382,'rooms_data':_0x4907cf,'invoice_no':_0x5d7b88});})[_0x1abe08(0x196)](_0x427281=>{var _0x236fc3=_0x1abe08;_0xfd02ea['flash'](_0x236fc3(0x1d3),_0x236fc3(0x155)),_0x26a8da[_0x236fc3(0x1be)](_0x236fc3(0x1c1));});}catch(_0x138a11){console['log'](_0x138a11);}}),router[a0_0x20f015(0x17e)](a0_0x20f015(0x17d),auth,async(_0x3b02b5,_0x46db87)=>{var _0x11629b=a0_0x20f015;try{const {warehouse_name:_0x15f2b7,date:_0xbbae91,prod_name:_0x434575,level:_0x501f6,isle:_0x27df0d,pallet:_0x56b7e9,stock:_0x16079a,types:_0x228a15,adjust_qty:_0x361e33,new_adjust_qty:_0x467d43,note:_0x5e1dc9,Room_name:_0x274003,invoice:_0x3feb27,JO_number:_0x153f18,expiry_date:_0x587708}=_0x3b02b5[_0x11629b(0x16c)];if(typeof _0x434575=='string')var _0x293bf3=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x180)]],_0x3b3b21=[_0x3b02b5['body'][_0x11629b(0x134)]],_0xfb582b=[_0x3b02b5[_0x11629b(0x16c)]['stock']],_0x1944f1=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x15a)]],_0x3b16be=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x18a)]],_0x326971=[_0x3b02b5[_0x11629b(0x16c)]['New_Qty_Converted']],_0x3c8c5f=[_0x3b02b5['body']['Primary_Units']],_0x1f3cdb=[_0x3b02b5[_0x11629b(0x16c)]['Secondary_units']],_0x1c047e=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x165)]],_0x4604fd=[_0x3b02b5[_0x11629b(0x16c)]['batch_code']],_0x2a16af=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x1bf)]],_0x32b983=[_0x3b02b5['body'][_0x11629b(0x183)]],_0xcb3912=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x164)]],_0x4b30a9=[_0x3b02b5[_0x11629b(0x16c)]['Rooms']],_0x4191e9=[_0x3b02b5['body']['maxPerUnit']],_0x1e4f48=[_0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x12e)]];else var _0x293bf3=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x180)]],_0x3b3b21=[..._0x3b02b5['body'][_0x11629b(0x134)]],_0xfb582b=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x19d)]],_0x1944f1=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x15a)]],_0x3b16be=[..._0x3b02b5[_0x11629b(0x16c)]['New_Qty_Converted_adj']],_0x326971=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x168)]],_0x3c8c5f=[..._0x3b02b5[_0x11629b(0x16c)]['Primary_Units']],_0x1f3cdb=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x1c4)]],_0x1c047e=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x165)]],_0x4604fd=[..._0x3b02b5['body']['batch_code']],_0x2a16af=[..._0x3b02b5[_0x11629b(0x16c)]['expiry_date']],_0x32b983=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x183)]],_0xcb3912=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x164)]],_0x4b30a9=[..._0x3b02b5[_0x11629b(0x16c)][_0x11629b(0x15f)]],_0x4191e9=[..._0x3b02b5[_0x11629b(0x16c)]['maxPerUnit']],_0x1e4f48=[..._0x3b02b5['body']['prod_invoice']];const _0x5608ca=_0x293bf3[_0x11629b(0x153)](_0x139367=>{return _0x139367={'product_name':_0x139367};});_0x3b3b21[_0x11629b(0x1e1)]((_0xa5bfc1,_0x17fdd9)=>{var _0x53160e=_0x11629b;_0x5608ca[_0x17fdd9][_0x53160e(0x12d)]=_0xa5bfc1;}),_0xfb582b[_0x11629b(0x1e1)]((_0x63a29b,_0x2a8122)=>{var _0x5f488e=_0x11629b;_0x5608ca[_0x2a8122][_0x5f488e(0x1bc)]=_0x63a29b;}),_0x1944f1[_0x11629b(0x1e1)]((_0x38e163,_0x4401d7)=>{var _0x5ef7d1=_0x11629b;_0x5608ca[_0x4401d7][_0x5ef7d1(0x15a)]=_0x38e163;}),_0x3b16be[_0x11629b(0x1e1)]((_0x5eb158,_0x1e772f)=>{var _0x1a0831=_0x11629b;_0x5608ca[_0x1e772f][_0x1a0831(0x141)]=_0x5eb158;}),_0x326971['forEach']((_0x18710e,_0x59fb5d)=>{_0x5608ca[_0x59fb5d]['new_adjust_qty']=_0x18710e;}),_0x3c8c5f[_0x11629b(0x1e1)]((_0x2983f5,_0x279a57)=>{var _0x541a00=_0x11629b;_0x5608ca[_0x279a57][_0x541a00(0x1f3)]=_0x2983f5;}),_0x1f3cdb[_0x11629b(0x1e1)]((_0x29ad7a,_0x1d8c5c)=>{_0x5608ca[_0x1d8c5c]['secondary_unit']=_0x29ad7a;}),_0x1c047e[_0x11629b(0x1e1)]((_0x45d55e,_0x58bb52)=>{_0x5608ca[_0x58bb52]['product_code']=_0x45d55e;}),_0x4604fd[_0x11629b(0x1e1)]((_0x45d47c,_0x398d76)=>{var _0x1cd732=_0x11629b;_0x5608ca[_0x398d76][_0x1cd732(0x1ac)]=_0x45d47c;}),_0x2a16af[_0x11629b(0x1e1)]((_0x16a8ac,_0x20b335)=>{var _0x55d943=_0x11629b;_0x5608ca[_0x20b335][_0x55d943(0x1bf)]=_0x16a8ac;}),_0x32b983['forEach']((_0x1ce6de,_0x5a20d4)=>{_0x5608ca[_0x5a20d4]['production_date']=_0x1ce6de;}),_0xcb3912[_0x11629b(0x1e1)]((_0x42b6dd,_0x21237d)=>{_0x5608ca[_0x21237d]['prod_cat']=_0x42b6dd;}),_0x4b30a9[_0x11629b(0x1e1)]((_0x4be3ca,_0x1ab351)=>{var _0x350f71=_0x11629b;_0x5608ca[_0x1ab351][_0x350f71(0x17b)]=_0x4be3ca;}),_0x4191e9[_0x11629b(0x1e1)]((_0x57ff35,_0x43e5ca)=>{_0x5608ca[_0x43e5ca]['maxPerUnit']=_0x57ff35;}),_0x1e4f48['forEach']((_0x12e240,_0x2e4121)=>{var _0x388727=_0x11629b;_0x5608ca[_0x2e4121][_0x388727(0x1bb)]=_0x12e240;});const _0x513c99=_0x5608ca['filter'](_0x5b1e9c=>_0x5b1e9c[_0x11629b(0x141)]!=='0'&&_0x5b1e9c[_0x11629b(0x141)]!=='');var _0x49f6f2=0x0;_0x513c99[_0x11629b(0x1e1)](_0x5da1da=>{var _0x2da6ab=_0x11629b;console[_0x2da6ab(0x173)](_0x2da6ab(0x1ae),_0x5da1da),parseInt(_0x5da1da[_0x2da6ab(0x141)])<=0x0&&_0x49f6f2++;});if(_0x49f6f2!=0x0)return _0x3b02b5[_0x11629b(0x14f)](_0x11629b(0x1d3),_0x11629b(0x18b)),_0x46db87[_0x11629b(0x1be)](_0x11629b(0x172));const _0x59f8d0=new adjustment_finished({'warehouse_name':_0x15f2b7,'date':_0xbbae91,'product':_0x513c99,'note':_0x5e1dc9,'room':_0x274003,'invoice':_0x3feb27,'JO_number':_0x153f18,'expiry_date':_0x587708}),_0x29d2dc=await _0x59f8d0[_0x11629b(0x18c)]();_0x3b02b5['flash']('success','adjustment\x20add\x20successfull'),_0x46db87['redirect'](_0x11629b(0x1e5)+_0x29d2dc[_0x11629b(0x1c0)]);}catch(_0x4e6d45){console[_0x11629b(0x173)](_0x4e6d45),_0x46db87['status'](0xc8)[_0x11629b(0x130)]({'message':_0x4e6d45[_0x11629b(0x17f)]});}}),router[a0_0x20f015(0x154)]('/preview/:id',auth,async(_0x4bb549,_0x500b3d)=>{var _0x270c96=a0_0x20f015;try{const {username:_0x54eaef,email:_0x2fd39c,role:_0x2f3264}=_0x4bb549[_0x270c96(0x1ec)],_0x163a8a=_0x4bb549[_0x270c96(0x1ec)],_0x5b2849=await profile[_0x270c96(0x1d1)]({'email':_0x163a8a[_0x270c96(0x1f4)]}),_0x5ab379=await master_shop[_0x270c96(0x135)](),_0x519cad=_0x4bb549[_0x270c96(0x133)]['id'],_0x50b053=await adjustment_finished[_0x270c96(0x1cb)]({'_id':_0x519cad}),_0x3612aa=await purchases[_0x270c96(0x191)]([{'$match':{'warehouse_name':_0x50b053[_0x270c96(0x1dd)]}},{'$unwind':_0x270c96(0x1d8)},{'$group':{'_id':_0x270c96(0x1f9)}}]);console['log']('purchases_data',_0x3612aa);const _0x5ac18b=await product[_0x270c96(0x135)]({}),_0xee9b0f=await warehouse[_0x270c96(0x191)]([{'$match':{'name':_0x50b053['warehouse_name'],'warehouse_category':_0x270c96(0x1f0)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x270c96(0x1b3),'name':{'$first':_0x270c96(0x1a8)},'product_stock':{'$first':_0x270c96(0x19c)},'bay':{'$first':_0x270c96(0x156)},'bin':{'$first':_0x270c96(0x1c9)},'type':{'$first':_0x270c96(0x178)},'floorlevel':{'$first':_0x270c96(0x181)},'primary_code':{'$first':_0x270c96(0x163)},'secondary_code':{'$first':_0x270c96(0x16b)},'product_code':{'$first':_0x270c96(0x15e)},'storage':{'$first':_0x270c96(0x1c7)},'rack':{'$first':_0x270c96(0x13d)},'expiry_date':{'$first':_0x270c96(0x14d)},'production_date':{'$first':_0x270c96(0x14c)},'batch_code':{'$first':_0x270c96(0x148)},'maxPerUnit':{'$first':_0x270c96(0x160)},'room':{'$first':_0x270c96(0x18f)}}}]);if(_0x5ab379[0x0][_0x270c96(0x175)]=='English\x20(US)'){var _0x11b0ad=users[_0x270c96(0x1a4)];console[_0x270c96(0x173)](_0x11b0ad);}else{if(_0x5ab379[0x0]['language']==_0x270c96(0x186))var _0x11b0ad=users[_0x270c96(0x186)];else{if(_0x5ab379[0x0][_0x270c96(0x175)]==_0x270c96(0x185))var _0x11b0ad=users['German'];else{if(_0x5ab379[0x0][_0x270c96(0x175)]==_0x270c96(0x1ea))var _0x11b0ad=users[_0x270c96(0x1ea)];else{if(_0x5ab379[0x0][_0x270c96(0x175)]==_0x270c96(0x18d))var _0x11b0ad=users['French'];else{if(_0x5ab379[0x0]['language']==_0x270c96(0x187))var _0x11b0ad=users['Portuguese'];else{if(_0x5ab379[0x0][_0x270c96(0x175)]=='Chinese')var _0x11b0ad=users[_0x270c96(0x16a)];else{if(_0x5ab379[0x0]['language']==_0x270c96(0x179))var _0x11b0ad=users[_0x270c96(0x13b)];}}}}}}}_0x500b3d[_0x270c96(0x19a)](_0x270c96(0x1bd),{'success':_0x4bb549[_0x270c96(0x14f)](_0x270c96(0x167)),'errors':_0x4bb549[_0x270c96(0x14f)](_0x270c96(0x1d3)),'role':_0x163a8a,'profile':_0x5b2849,'adjustment':_0x50b053,'stock':_0xee9b0f,'master_shop':_0x5ab379,'warehouse_name':_0x3612aa,'unit':_0x5ac18b,'language':_0x11b0ad});}catch(_0x9e90f0){console['log'](_0x9e90f0),_0x500b3d[_0x270c96(0x145)](0xc8)[_0x270c96(0x130)]({'message':_0x9e90f0['message']});}}),router[a0_0x20f015(0x17e)](a0_0x20f015(0x1ca),auth,async(_0x4db49a,_0x3111a7)=>{var _0x1aa66e=a0_0x20f015;try{const {invoice:_0x223906,warehouse_name:_0x4f4498,Room_name:_0x3a5ede}=_0x4db49a[_0x1aa66e(0x16c)],_0x59e479=_0x4db49a[_0x1aa66e(0x133)]['id'],_0x120225=await adjustment_finished[_0x1aa66e(0x1cb)]({'_id':_0x59e479});var _0x5011f3;const _0x34fd22=_0x120225[_0x1aa66e(0x16e)][_0x1aa66e(0x153)](async _0x59be3b=>{var _0x352000=_0x1aa66e;if(_0x59be3b[_0x352000(0x141)]>0x0){_0x5011f3=await warehouse['findOne']({'name':_0x4f4498,'room':_0x59be3b['room_names'],'warehouse_category':_0x352000(0x1f0)});const _0x3a8661=_0x5011f3[_0x352000(0x1d6)][_0x352000(0x153)](_0x378625=>{var _0x42b7c7=_0x352000;console[_0x42b7c7(0x173)](_0x59be3b['types']);if(_0x59be3b[_0x42b7c7(0x15a)]==_0x42b7c7(0x151))_0x378625['product_name']==_0x59be3b[_0x42b7c7(0x1af)]&&_0x378625['bay']==_0x59be3b[_0x42b7c7(0x12d)]&&_0x378625[_0x42b7c7(0x1bf)]==_0x59be3b[_0x42b7c7(0x1bf)]&&_0x378625[_0x42b7c7(0x1ed)]==_0x59be3b[_0x42b7c7(0x1ed)]&&_0x378625[_0x42b7c7(0x1ac)]==_0x59be3b[_0x42b7c7(0x1ac)]&&_0x378625[_0x42b7c7(0x1bb)]==_0x59be3b[_0x42b7c7(0x1bb)]&&(_0x378625[_0x42b7c7(0x1ce)]=_0x378625['product_stock']-_0x59be3b[_0x42b7c7(0x141)]);else _0x59be3b[_0x42b7c7(0x15a)]==_0x42b7c7(0x1eb)&&(_0x378625[_0x42b7c7(0x1af)]==_0x59be3b[_0x42b7c7(0x1af)]&&_0x378625['bay']==_0x59be3b[_0x42b7c7(0x12d)]&&_0x378625[_0x42b7c7(0x1bf)]==_0x59be3b[_0x42b7c7(0x1bf)]&&_0x378625[_0x42b7c7(0x1ed)]==_0x59be3b['production_date']&&_0x378625[_0x42b7c7(0x1ac)]==_0x59be3b[_0x42b7c7(0x1ac)]&&_0x378625['invoice']==_0x59be3b['invoice']&&(_0x378625[_0x42b7c7(0x1ce)]=_0x378625[_0x42b7c7(0x1ce)]+_0x59be3b[_0x42b7c7(0x141)]));});}return _0x5011f3;});Promise[_0x1aa66e(0x170)](_0x34fd22)['then'](async _0x193870=>{var _0x584757=_0x1aa66e;try{for(const _0x3b5571 of _0x193870){await _0x3b5571[_0x584757(0x18c)]();}_0x120225['finalize']=_0x584757(0x143);const _0x3ea848=await _0x120225['save'](),_0x46f24e=await master_shop[_0x584757(0x135)](),_0x54b499=await email_settings[_0x584757(0x1d1)](),_0x3d63b=await supervisor_settings[_0x584757(0x135)]();var _0x560d4c=_0x120225[_0x584757(0x16e)],_0x42fe64='',_0x5aadfd;for(_0x5aadfd in _0x560d4c){var _0x238a3d='FG';_0x120225[_0x584757(0x1dd)]==_0x584757(0x19e)&&(_0x238a3d='DG'),_0x42fe64+=_0x584757(0x16f)+_0x584757(0x166)+_0x560d4c[_0x5aadfd]['product_name']+_0x584757(0x1e4)+_0x584757(0x166)+_0x560d4c[_0x5aadfd][_0x584757(0x190)]+'</td>'+_0x584757(0x166)+_0x560d4c[_0x5aadfd][_0x584757(0x141)]+'</td>'+_0x584757(0x166)+_0x560d4c[_0x5aadfd][_0x584757(0x1f3)]+_0x584757(0x1e4)+_0x584757(0x166)+_0x560d4c[_0x5aadfd][_0x584757(0x1b6)]+_0x584757(0x1e4)+_0x584757(0x166)+_0x120225[_0x584757(0x1dd)]+_0x584757(0x1e4)+_0x584757(0x166)+_0x560d4c[_0x5aadfd]['room_names']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x238a3d+_0x560d4c[_0x5aadfd][_0x584757(0x12d)]+_0x584757(0x1e4)+_0x584757(0x1ef);}let _0x5a1d7a=nodemailer['createTransport']({'host':_0x54b499[_0x584757(0x1b2)],'port':Number(_0x54b499[_0x584757(0x131)]),'secure':![],'auth':{'user':_0x54b499[_0x584757(0x1f4)],'pass':_0x54b499[_0x584757(0x1b7)]}}),_0x4ff325={'from':_0x54b499['email'],'to':_0x3d63b[0x0][_0x584757(0x161)],'subject':_0x584757(0x1a5),'attachments':[{'filename':_0x584757(0x189),'path':__dirname+_0x584757(0x1e7)+_0x584757(0x1aa)+_0x46f24e[0x0][_0x584757(0x150)],'cid':_0x584757(0x1b8)}],'html':_0x584757(0x1b0)+_0x584757(0x1e0)+_0x584757(0x149)+_0x584757(0x1b5)+_0x584757(0x152)+_0x584757(0x1b5)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x584757(0x15b)+_0x584757(0x1b5)+_0x584757(0x159)+_0x46f24e[0x0]['site_title']+_0x584757(0x140)+'</div>'+'</div>'+_0x584757(0x1a0)+_0x584757(0x1b5)+_0x584757(0x1d9)+_0x584757(0x162)+_0x120225[_0x584757(0x1bb)]+'\x20'+_0x584757(0x1e9)+_0x584757(0x1ee)+_0x120225[_0x584757(0x174)]+'\x20'+_0x584757(0x1b9)+_0x584757(0x1f1)+'</div>'+_0x584757(0x14a)+_0x584757(0x16d)+_0x584757(0x16f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x584757(0x1ab)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x584757(0x136)+_0x584757(0x13e)+_0x584757(0x15d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x584757(0x1ad)+'</tr>'+_0x584757(0x1a6)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x42fe64+'\x20'+_0x584757(0x182)+_0x584757(0x13c)+'<div>'+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x46f24e[0x0][_0x584757(0x1b4)]+'</h5>'+_0x584757(0x15b)+_0x584757(0x15b)+_0x584757(0x1e6)};_0x5a1d7a['sendMail'](_0x4ff325,function(_0x151080,_0x54e101){var _0x545d4b=_0x584757;_0x151080?(console[_0x545d4b(0x173)](_0x151080),console[_0x545d4b(0x173)](_0x545d4b(0x19b))):console[_0x545d4b(0x173)](_0x545d4b(0x147));}),_0x4db49a[_0x584757(0x14f)](_0x584757(0x167),'Adjustment\x20Finalize\x20Successfully'),_0x3111a7[_0x584757(0x1be)](_0x584757(0x146)+_0x3ea848['_id']);}catch(_0x5b17be){console['error'](_0x5b17be),_0x3111a7['status'](0x1f4)[_0x584757(0x130)]({'error':_0x584757(0x1a1)});}})[_0x1aa66e(0x196)](_0x1ff4c4=>{var _0x1f11f9=_0x1aa66e;console[_0x1f11f9(0x188)](_0x1ff4c4),_0x3111a7[_0x1f11f9(0x145)](0x1f4)[_0x1f11f9(0x130)]({'error':'An\x20error\x20occurred.'});});}catch(_0x10472e){_0x3111a7[_0x1aa66e(0x130)]({'message':_0x10472e[_0x1aa66e(0x17f)]});}}),router[a0_0x20f015(0x154)](a0_0x20f015(0x15c),auth,async(_0x27bed9,_0x5c181d)=>{var _0x38d0de=a0_0x20f015;try{const {username:_0x426ae3,email:_0x2396be,role:_0x4238de}=_0x27bed9[_0x38d0de(0x1ec)],_0x1d2c18=_0x27bed9[_0x38d0de(0x1ec)],_0x28f614=await profile[_0x38d0de(0x1d1)]({'email':_0x1d2c18['email']}),_0x395883=await master_shop[_0x38d0de(0x135)]();console[_0x38d0de(0x173)](_0x38d0de(0x138),_0x395883);const _0xea1c67=_0x27bed9[_0x38d0de(0x133)]['id'],_0x3818f1=await adjustment_finished['findById']({'_id':_0xea1c67});let _0x30fc71=new Date(_0x3818f1[_0x38d0de(0x1bf)]),_0x4b2872=('0'+_0x30fc71[_0x38d0de(0x169)]())['slice'](-0x2),_0x2c7f73=('0'+(_0x30fc71[_0x38d0de(0x1f7)]()+0x1))[_0x38d0de(0x137)](-0x2),_0x5199c1=_0x30fc71[_0x38d0de(0x144)](),_0x5cff4b=_0x5199c1+'-'+_0x2c7f73+'-'+_0x4b2872;var _0x3661c7=[_0x38d0de(0x1c5),_0x38d0de(0x1e2),_0x38d0de(0x1db)];const _0x49d922=await purchases[_0x38d0de(0x191)]([{'$match':{'warehouse_name':_0x3818f1[_0x38d0de(0x1dd)]}},{'$unwind':_0x38d0de(0x1d8)},{'$group':{'_id':_0x38d0de(0x1f9)}}]);console['log'](_0x38d0de(0x199),_0x49d922);const _0x5052f6=await product[_0x38d0de(0x135)]({}),_0x12824e=await warehouse[_0x38d0de(0x191)]([{'$match':{'name':_0x3818f1[_0x38d0de(0x1dd)],'room':_0x3818f1[_0x38d0de(0x1d5)]}},{'$unwind':_0x38d0de(0x1cf)},{'$group':{'_id':_0x38d0de(0x1b3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x38d0de(0x19c)},'bay':{'$first':_0x38d0de(0x156)},'bin':{'$first':_0x38d0de(0x1c9)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x38d0de(0x181)},'primary_code':{'$first':_0x38d0de(0x163)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x38d0de(0x1c7)},'rack':{'$first':_0x38d0de(0x13d)}}}]);if(_0x395883[0x0]['language']==_0x38d0de(0x1c6)){var _0x1dd8ba=users[_0x38d0de(0x1a4)];console[_0x38d0de(0x173)](_0x1dd8ba);}else{if(_0x395883[0x0][_0x38d0de(0x175)]==_0x38d0de(0x186))var _0x1dd8ba=users[_0x38d0de(0x186)];else{if(_0x395883[0x0][_0x38d0de(0x175)]=='German')var _0x1dd8ba=users[_0x38d0de(0x185)];else{if(_0x395883[0x0]['language']==_0x38d0de(0x1ea))var _0x1dd8ba=users[_0x38d0de(0x1ea)];else{if(_0x395883[0x0][_0x38d0de(0x175)]==_0x38d0de(0x18d))var _0x1dd8ba=users[_0x38d0de(0x18d)];else{if(_0x395883[0x0][_0x38d0de(0x175)]==_0x38d0de(0x187))var _0x1dd8ba=users['Portuguese'];else{if(_0x395883[0x0][_0x38d0de(0x175)]==_0x38d0de(0x16a))var _0x1dd8ba=users[_0x38d0de(0x16a)];else{if(_0x395883[0x0][_0x38d0de(0x175)]==_0x38d0de(0x179))var _0x1dd8ba=users[_0x38d0de(0x13b)];}}}}}}}_0x5c181d[_0x38d0de(0x19a)]('edit_adjustment_finished',{'success':_0x27bed9[_0x38d0de(0x14f)](_0x38d0de(0x167)),'errors':_0x27bed9[_0x38d0de(0x14f)]('errors'),'role':_0x1d2c18,'profile':_0x28f614,'adjustment':_0x3818f1,'stock':_0x12824e,'master_shop':_0x395883,'warehouse_name':_0x49d922,'unit':_0x5052f6,'language':_0x1dd8ba,'rooms_data':_0x3661c7,'ed_fullDate':_0x5cff4b});}catch(_0x4f4636){console['log'](_0x4f4636),_0x5c181d[_0x38d0de(0x145)](0xc8)[_0x38d0de(0x130)]({'message':_0x4f4636['message']});}}),router[a0_0x20f015(0x17e)](a0_0x20f015(0x15c),auth,async(_0x11cb46,_0x5a9561)=>{var _0x29cd90=a0_0x20f015;try{const _0x5b7475=_0x11cb46['params']['id'],_0x253eea=await adjustment_finished[_0x29cd90(0x1cb)]({'_id':_0x5b7475}),_0x48efdb=await warehouse['findOne']({'name':_0x253eea['warehouse_name'],'room':_0x253eea[_0x29cd90(0x1d5)]}),{warehouse_name:_0x329716,date:_0x42e54b,prod_name:_0x5dfdc8,level:_0x4ff4f6,isle:_0x29e3ce,pallet:_0x23d4ce,stock:_0x4e7d61,types:_0x1b0de0,adjust_qty:_0x1a547f,new_adjust_qty:_0x4bb6cb,note:_0x1bf9c0,Room_name:_0x112fc2,invoice:_0x465492,JO_number:_0x344e55}=_0x11cb46[_0x29cd90(0x16c)];if(typeof _0x5dfdc8==_0x29cd90(0x1c3))var _0x211a05=[_0x11cb46[_0x29cd90(0x16c)]['prod_name']],_0xc17641=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x134)]],_0x190920=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x19d)]],_0x2ca4e4=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x15a)]],_0x1a0da2=[_0x11cb46['body'][_0x29cd90(0x141)]],_0x49ad97=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x142)]],_0x464498=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x165)]],_0x44d932=[_0x11cb46[_0x29cd90(0x16c)]['unit']],_0xc0a434=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x1c4)]],_0x330041=[_0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x1ac)]],_0x1e85c8=[_0x11cb46['body'][_0x29cd90(0x1bf)]];else var _0x211a05=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x180)]],_0xc17641=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x134)]],_0x190920=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x19d)]],_0x2ca4e4=[..._0x11cb46[_0x29cd90(0x16c)]['types']],_0x1a0da2=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x141)]],_0x49ad97=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x142)]],_0x464498=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x165)]],_0x44d932=[..._0x11cb46['body'][_0x29cd90(0x1f3)]],_0xc0a434=[..._0x11cb46['body'][_0x29cd90(0x1c4)]],_0x330041=[..._0x11cb46[_0x29cd90(0x16c)][_0x29cd90(0x1ac)]],_0x1e85c8=[..._0x11cb46[_0x29cd90(0x16c)]['expiry_date']];const _0x23ca51=_0x211a05[_0x29cd90(0x153)](_0x3bea2a=>{return _0x3bea2a={'product_name':_0x3bea2a};});_0xc17641[_0x29cd90(0x1e1)]((_0x3be4d1,_0x48e914)=>{var _0x556984=_0x29cd90;_0x23ca51[_0x48e914][_0x556984(0x12d)]=_0x3be4d1;}),_0x190920[_0x29cd90(0x1e1)]((_0x5a9186,_0x5ce69e)=>{_0x23ca51[_0x5ce69e]['stockBefore']=_0x5a9186;}),_0x2ca4e4[_0x29cd90(0x1e1)]((_0x11571,_0x1f4993)=>{var _0x4d1780=_0x29cd90;_0x23ca51[_0x1f4993][_0x4d1780(0x15a)]=_0x11571;}),_0x1a0da2['forEach']((_0x587f80,_0xc9c71e)=>{_0x23ca51[_0xc9c71e]['adjust_qty']=_0x587f80;}),_0x49ad97['forEach']((_0x26f629,_0x2d911d)=>{var _0x11ac3e=_0x29cd90;_0x23ca51[_0x2d911d][_0x11ac3e(0x142)]=_0x26f629;}),_0x44d932['forEach']((_0xd5f356,_0x4556e2)=>{_0x23ca51[_0x4556e2]['unit']=_0xd5f356;}),_0xc0a434['forEach']((_0x2b9648,_0x45e0b9)=>{var _0x34f2d6=_0x29cd90;_0x23ca51[_0x45e0b9][_0x34f2d6(0x1b6)]=_0x2b9648;}),_0x464498[_0x29cd90(0x1e1)]((_0x582727,_0x47affe)=>{var _0x5495e5=_0x29cd90;_0x23ca51[_0x47affe][_0x5495e5(0x190)]=_0x582727;}),_0x330041[_0x29cd90(0x1e1)]((_0x36adf3,_0x269aa1)=>{_0x23ca51[_0x269aa1]['batch_code']=_0x36adf3;}),_0x1e85c8[_0x29cd90(0x1e1)]((_0x721692,_0xb6996b)=>{_0x23ca51[_0xb6996b]['expiry_date']=_0x721692;});const _0x9597ed=_0x23ca51[_0x29cd90(0x1e3)](_0x8329da=>_0x8329da['adjust_qty']!=='0'&&_0x8329da[_0x29cd90(0x141)]!=='');var _0x32e28c=0x0;_0x9597ed[_0x29cd90(0x1e1)](_0x2556e0=>{var _0x40dff7=_0x29cd90;console['log']('foreach\x20newproduct',_0x2556e0),parseInt(_0x2556e0[_0x40dff7(0x141)])<=0x0&&_0x32e28c++;});if(_0x32e28c!=0x0)return _0x11cb46[_0x29cd90(0x14f)](_0x29cd90(0x1d3),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x5a9561[_0x29cd90(0x1be)](_0x29cd90(0x172));_0x253eea[_0x29cd90(0x1dd)]=_0x329716,_0x253eea['date']=_0x42e54b,_0x253eea[_0x29cd90(0x16e)]=_0x9597ed,_0x253eea[_0x29cd90(0x1d4)]=_0x1bf9c0,_0x253eea['room']=_0x112fc2,_0x253eea['invoice']=_0x465492,_0x253eea['JO_number']=_0x344e55;const _0x40f822=await _0x253eea['save'](),_0x5a4e19=await warehouse['findOne']({'name':_0x329716,'room':_0x112fc2});_0x40f822['product'][_0x29cd90(0x1e1)](_0x3c4375=>{var _0x2adf9a=_0x29cd90;const _0x50b8cf=_0x5a4e19[_0x2adf9a(0x1d6)][_0x2adf9a(0x153)](_0x363586=>{var _0x11afc9=_0x2adf9a;_0x3c4375[_0x11afc9(0x15a)]==_0x11afc9(0x151)?_0x363586[_0x11afc9(0x1af)]==_0x3c4375[_0x11afc9(0x1af)]&&_0x363586[_0x11afc9(0x12d)]==_0x3c4375[_0x11afc9(0x12d)]&&(_0x363586[_0x11afc9(0x1ce)]=parseInt(_0x363586['product_stock'])-parseInt(_0x3c4375[_0x11afc9(0x141)])):_0x363586[_0x11afc9(0x1af)]==_0x3c4375['product_name']&&_0x363586[_0x11afc9(0x12d)]==_0x3c4375[_0x11afc9(0x12d)]&&(_0x363586[_0x11afc9(0x1ce)]=parseInt(_0x363586['product_stock'])+parseInt(_0x3c4375[_0x11afc9(0x141)]));});}),await _0x5a4e19['save'](),_0x11cb46[_0x29cd90(0x14f)]('success',_0x29cd90(0x1a9)),_0x5a9561[_0x29cd90(0x1be)](_0x29cd90(0x13a));}catch(_0x3e1deb){console[_0x29cd90(0x173)](_0x3e1deb);}}),router['post'](a0_0x20f015(0x1dc),async(_0x337eaa,_0x599f99)=>{var _0x3708a2=a0_0x20f015;const {primary_code:_0x2c84b2,warehouse_data:_0x27f058,rooms_data:_0x5e9393,Roomslist:_0x21541e}=_0x337eaa['body'],_0x166325=_0x21541e['split'](','),_0x6b93b0=[];async function _0x4c2949(_0x4d2b35){var _0x1635d7=a0_0x5e23;const _0x3753a6=await warehouse['aggregate']([{'$match':{'name':_0x27f058,'room':_0x4d2b35}},{'$unwind':_0x1635d7(0x1cf)},{'$match':{'product_details.primary_code':_0x2c84b2}},{'$group':{'_id':_0x1635d7(0x1b3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1635d7(0x19c)},'primary_code':{'$first':_0x1635d7(0x163)},'secondary_code':{'$first':_0x1635d7(0x16b)},'product_code':{'$first':_0x1635d7(0x15e)},'level':{'$first':_0x1635d7(0x156)},'isle':{'$first':_0x1635d7(0x1c9)},'type':{'$first':_0x1635d7(0x178)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x1635d7(0x1f2)},'secondary_unit':{'$first':_0x1635d7(0x1c8)},'storage':{'$first':_0x1635d7(0x1c7)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1635d7(0x148)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x1635d7(0x160)},'roomNamed':{'$first':_0x1635d7(0x18f)},'invoice':{'$first':'$product_details.invoice'}}}]),_0xf395b0=await warehouse[_0x1635d7(0x191)]([{'$match':{'name':_0x27f058,'room':_0x4d2b35}},{'$unwind':_0x1635d7(0x1cf)},{'$match':{'product_details.secondary_code':_0x2c84b2}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1635d7(0x1a8)},'product_stock':{'$first':_0x1635d7(0x19c)},'primary_code':{'$first':_0x1635d7(0x163)},'secondary_code':{'$first':_0x1635d7(0x16b)},'product_code':{'$first':_0x1635d7(0x15e)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1635d7(0x181)},'unit':{'$first':_0x1635d7(0x1f2)},'secondary_unit':{'$first':_0x1635d7(0x1c8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1635d7(0x13d)},'expiry_date':{'$first':_0x1635d7(0x14d)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1635d7(0x148)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1635d7(0x1e8)}}}]);if(_0x3753a6['length']>0x0)_0x6b93b0[_0x1635d7(0x193)](_0x3753a6);else _0xf395b0['length']>0x0&&_0x6b93b0[_0x1635d7(0x193)](_0xf395b0);}const _0x217634=_0x166325['map'](_0x2fb415=>_0x4c2949(_0x2fb415));await Promise[_0x3708a2(0x170)](_0x217634),_0x599f99[_0x3708a2(0x130)](_0x6b93b0);}),router['post'](a0_0x20f015(0x19f),async(_0x17c86d,_0xe67805)=>{var _0x15ab37=a0_0x20f015;const {productCode:_0x29e49c,bay:_0x3c5312,warehouses:_0x513d33,room:_0x547262}=_0x17c86d['body'];console[_0x15ab37(0x173)](_0x17c86d['body']);try{const _0x253260=await warehouse[_0x15ab37(0x191)]([{'$match':{'name':_0x513d33,'room':_0x547262}},{'$unwind':_0x15ab37(0x1cf)},{'$match':{'product_details.bay':parseInt(_0x3c5312)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x15ab37(0x1a8)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x15ab37(0x139)}}}]);_0xe67805[_0x15ab37(0x145)](0xc8)['json'](_0x253260);}catch(_0x20e676){_0xe67805['status'](0x194)[_0x15ab37(0x130)]({'message':_0x20e676['message']});}}),module[a0_0x20f015(0x192)]=router;