function a0_0xbb12(_0x57464c,_0xbdac98){var _0x3d6561=a0_0x3d65();return a0_0xbb12=function(_0xbb1244,_0x32a183){_0xbb1244=_0xbb1244-0x161;var _0x1c0ef1=_0x3d6561[_0xbb1244];return _0x1c0ef1;},a0_0xbb12(_0x57464c,_0xbdac98);}var a0_0x39484e=a0_0xbb12;(function(_0x1193c0,_0x2167c7){var _0x5a9b9f=a0_0xbb12,_0x92aa97=_0x1193c0();while(!![]){try{var _0x3dc02b=parseInt(_0x5a9b9f(0x1f3))/0x1+parseInt(_0x5a9b9f(0x222))/0x2+-parseInt(_0x5a9b9f(0x1c9))/0x3+parseInt(_0x5a9b9f(0x179))/0x4*(-parseInt(_0x5a9b9f(0x1ac))/0x5)+parseInt(_0x5a9b9f(0x1ed))/0x6+-parseInt(_0x5a9b9f(0x197))/0x7*(-parseInt(_0x5a9b9f(0x183))/0x8)+-parseInt(_0x5a9b9f(0x22c))/0x9;if(_0x3dc02b===_0x2167c7)break;else _0x92aa97['push'](_0x92aa97['shift']());}catch(_0x27556a){_0x92aa97['push'](_0x92aa97['shift']());}}}(a0_0x3d65,0x74aea));const express=require('express'),app=express(),router=express[a0_0x39484e(0x20b)](),auth=require(a0_0x39484e(0x177)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x39484e(0x1e0)),nodemailer=require(a0_0x39484e(0x19f));function a0_0x3d65(){var _0xa069c7=['host','Enabled','Portuguese','../public/language/languages.json','\x20Order\x20Number\x20:\x20','Arabic','$product_details.maxProducts','Error\x20Occurs','</head><body>','Hindi','/view/add_adjustment','<div>','logo','</td>','all','/view','3761904YRLFUb','getFullYear','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Adjustment\x20Finalize\x20Successfully','</thead>','types','260369mXAlrV','<tr>','$product_details.product_stock','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.bin','$product_details.secondary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.expiry_date','find','$finalize','Finished\x20Goods','$product_details.type','slice','render','$product_details.batch_code','<hr\x20class=\x22my-3\x22>','<tbody\x20style=\x22text-align:\x20center;\x22>','/barcode_scanner','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','message','maxPerUnit','secondary_unit','$invoice','Router','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','New_Qty_Converted','room','Return\x20Rooms','params','$room','email','image','$product_details.rack','$product_details.maxPerUnit','back','role','language','random','$product_details.bay','product_date','<html><head><title></title>','$product_details.product_name','redirect','Logo.png','$product_details.storage','An\x20error\x20occurred\x20while\x20saving\x20data.','173588EpLrQL','Chinese','$_id','French','There\x27s\x20a\x20error\x20in\x20this\x20transaction','createTransport','Arabic\x20(ae)','bay','log','length','6807159fWvDzN','catch','adjustment\x20data\x20update\x20successfully','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','stock','prod_code','date','adjust_qty','password','expiry_date','Rooms','unit','<span\x20style=\x22float:\x20right;\x22>','finalize','invoice','/view/:id','$product.product_name','product','QA\x20Warehouse','master','$product_details.invoice','findById','body','../middleware/auth','$product_details._id','12FOvDNH','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','exports','minus','map','errors','$product_details.floorlevel','_id','success','8DirZBO','JO_number','sendMail','purchases_data','prod_cat','string','Portuguese\x20(BR)','production_date','add_adjustment_finished','flash','\x20Order\x20Date\x20:\x20','filter','/adjustment_finished/view','product_details','$product','getDate','push','An\x20error\x20occurred.','edit_adjustment_finished_view','Primary_Units','6396397qSuPxS','padStart','product_code','Enclosed','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<h5\x20style=\x22text-align:\x20left;\x22>','English\x20(US)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','nodemailer','prod_name','Spanish','findOne','/picking_list/PDF_adjustment/','json','English','save','note','$product_details.unit','edit_adjustment_finished','Secondary_units','</h5>','428445kLPoiT','/adjustment/view','True','product_stock','aggregate','foreach\x20newproduct','ADJF-','<h2>\x20','$product_details.primary_code','$product_details','\x20</h2>','</span>','batch_code','/upload/','DRY\x20GOODS','</div>','$warehouse_name','warehouse','new_adjust_qty','German','warehouse_name','port','/CheckingWarehouse','post','stockBefore','adjustment\x20add\x20successfull','<strong>\x20Regards\x20</strong>','</body></html>','room_names','1189710Qasbgv','Email\x20sent\x20successfully','site_title','error','user','get','$name','then','split','prod_invoice','Ambient','forEach','toString','product_name','add','status','level','$product_details.product_code','<h5>','New_Qty_Converted_adj'];a0_0x3d65=function(){return _0xa069c7;};return a0_0x3d65();}router[a0_0x39484e(0x1ce)](a0_0x39484e(0x1ec),auth,async(_0x111193,_0x761397)=>{var _0x434a44=a0_0x39484e;try{const {username:_0x55b20d,email:_0x453695,role:_0x2002da}=_0x111193[_0x434a44(0x1cd)],_0x4a32ac=_0x111193['user'],_0x23b2f2=await profile['findOne']({'email':_0x4a32ac[_0x434a44(0x212)]}),_0x43a21d=await master_shop[_0x434a44(0x1fc)]();let _0x5028ea;if(_0x4a32ac[_0x434a44(0x217)]=='staff'){const _0x6121f0=await staff[_0x434a44(0x1a2)]({'email':_0x4a32ac[_0x434a44(0x212)]});_0x5028ea=await warehouse[_0x434a44(0x1fc)]({'status':_0x434a44(0x1de),'name':_0x6121f0[_0x434a44(0x1bd)]});}else _0x5028ea=await warehouse[_0x434a44(0x1fc)]({'status':_0x434a44(0x1de)});const _0x37eaff=await product[_0x434a44(0x1fc)]();let _0x16a9ba;if(_0x4a32ac['role']=='staff'){const _0x54b842=await staff[_0x434a44(0x1a2)]({'email':_0x4a32ac[_0x434a44(0x212)]});_0x16a9ba=await adjustment_finished[_0x434a44(0x1fc)]({'warehouse_name':_0x54b842[_0x434a44(0x1bd)]});}else _0x16a9ba=await adjustment_finished[_0x434a44(0x1b0)]([{'$unwind':'$product'},{'$group':{'_id':_0x434a44(0x224),'invoice':{'$first':_0x434a44(0x20a)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x434a44(0x1bc)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x434a44(0x1fd)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x43a21d[0x0][_0x434a44(0x218)]=='English\x20(US)'){var _0x6e70e2=users[_0x434a44(0x1a5)];console[_0x434a44(0x22a)](_0x6e70e2);}else{if(_0x43a21d[0x0][_0x434a44(0x218)]=='Hindi')var _0x6e70e2=users['Hindi'];else{if(_0x43a21d[0x0][_0x434a44(0x218)]=='German')var _0x6e70e2=users[_0x434a44(0x1bf)];else{if(_0x43a21d[0x0][_0x434a44(0x218)]=='Spanish')var _0x6e70e2=users[_0x434a44(0x1a1)];else{if(_0x43a21d[0x0]['language']==_0x434a44(0x225))var _0x6e70e2=users[_0x434a44(0x225)];else{if(_0x43a21d[0x0]['language']==_0x434a44(0x189))var _0x6e70e2=users['Portuguese'];else{if(_0x43a21d[0x0][_0x434a44(0x218)]=='Chinese')var _0x6e70e2=users[_0x434a44(0x223)];else{if(_0x43a21d[0x0]['language']==_0x434a44(0x228))var _0x6e70e2=users[_0x434a44(0x1e2)];}}}}}}}_0x761397[_0x434a44(0x201)]('adjustment_finished',{'success':_0x111193[_0x434a44(0x18c)](_0x434a44(0x182)),'errors':_0x111193['flash'](_0x434a44(0x17f)),'role':_0x4a32ac,'profile':_0x23b2f2,'warehouse':_0x5028ea,'product':_0x37eaff,'adjustment':_0x16a9ba,'master_shop':_0x43a21d,'language':_0x6e70e2});}catch(_0xcf475d){console[_0x434a44(0x22a)](_0xcf475d);}});async function getRandom8DigitNumber(){var _0x2476d7=a0_0x39484e;const _0x16c157=0x989680,_0x12ada5=0x5f5e0ff,_0x14b704=Math[_0x2476d7(0x17a)](Math[_0x2476d7(0x219)]()*(_0x12ada5-_0x16c157+0x1))+_0x16c157;var _0x1a0a51;const _0x49cbd2=await adjustment_finished['findOne']({'invoice':_0x2476d7(0x1b2)+_0x14b704});return _0x49cbd2&&_0x49cbd2[_0x2476d7(0x22b)]>0x0?_0x1a0a51='ADJF-'+_0x14b704:_0x1a0a51=_0x2476d7(0x1b2)+_0x14b704,_0x1a0a51;}router[a0_0x39484e(0x1ce)](a0_0x39484e(0x1e7),auth,async(_0x1fc1fe,_0x405ed6)=>{var _0x3be84c=a0_0x39484e;try{const {username:_0x51e4c0,email:_0x49f851,role:_0x7e13a2}=_0x1fc1fe['user'],_0x52990b=_0x1fc1fe['user'],_0x4bd69a=await profile[_0x3be84c(0x1a2)]({'email':_0x52990b[_0x3be84c(0x212)]}),_0x570d37=await master_shop[_0x3be84c(0x1fc)]();let _0x1f1d8a;if(_0x52990b[_0x3be84c(0x217)]=='staff'){const _0x4755e3=await staff[_0x3be84c(0x1a2)]({'email':_0x52990b[_0x3be84c(0x212)]});_0x1f1d8a=await warehouse[_0x3be84c(0x1b0)]([{'$match':{'status':_0x3be84c(0x1de),'name':_0x4755e3['warehouse'],'warehouse_category':_0x3be84c(0x1fe),'name':{'$ne':_0x3be84c(0x172)}}},{'$group':{'_id':_0x3be84c(0x1cf),'name':{'$first':_0x3be84c(0x1cf)}}}]);}else _0x1f1d8a=await warehouse[_0x3be84c(0x1b0)]([{'$match':{'status':'Enabled','warehouse_category':_0x3be84c(0x1fe),'name':{'$ne':_0x3be84c(0x172)}}},{'$group':{'_id':_0x3be84c(0x1cf),'name':{'$first':'$name'}}}]);const _0x437b21=await product[_0x3be84c(0x1fc)]({}),_0x374dda=await adjustment_finished[_0x3be84c(0x1fc)]({}),_0x179fa6=_0x374dda[_0x3be84c(0x22b)]+0x1,_0xf7e908=_0x3be84c(0x1b2)+_0x179fa6[_0x3be84c(0x1d5)]()[_0x3be84c(0x198)](0x5,'0');var _0x437eda=[_0x3be84c(0x1d3),_0x3be84c(0x19a),_0x3be84c(0x20f)];if(_0x570d37[0x0][_0x3be84c(0x218)]==_0x3be84c(0x19d))var _0x1a7b0d=users[_0x3be84c(0x1a5)];else{if(_0x570d37[0x0][_0x3be84c(0x218)]==_0x3be84c(0x1e6))var _0x1a7b0d=users[_0x3be84c(0x1e6)];else{if(_0x570d37[0x0][_0x3be84c(0x218)]==_0x3be84c(0x1bf))var _0x1a7b0d=users[_0x3be84c(0x1bf)];else{if(_0x570d37[0x0]['language']==_0x3be84c(0x1a1))var _0x1a7b0d=users[_0x3be84c(0x1a1)];else{if(_0x570d37[0x0]['language']==_0x3be84c(0x225))var _0x1a7b0d=users[_0x3be84c(0x225)];else{if(_0x570d37[0x0]['language']==_0x3be84c(0x189))var _0x1a7b0d=users['Portuguese'];else{if(_0x570d37[0x0][_0x3be84c(0x218)]==_0x3be84c(0x223))var _0x1a7b0d=users[_0x3be84c(0x223)];else{if(_0x570d37[0x0][_0x3be84c(0x218)]==_0x3be84c(0x228))var _0x1a7b0d=users[_0x3be84c(0x1e2)];}}}}}}}const _0x4b774a=getRandom8DigitNumber();_0x4b774a[_0x3be84c(0x1d0)](_0x1f691a=>{var _0x585db5=_0x3be84c;_0x405ed6['render'](_0x585db5(0x18b),{'success':_0x1fc1fe[_0x585db5(0x18c)](_0x585db5(0x182)),'errors':_0x1fc1fe[_0x585db5(0x18c)](_0x585db5(0x17f)),'role':_0x52990b,'profile':_0x4bd69a,'warehouse':_0x1f1d8a,'product':_0x437b21,'master_shop':_0x570d37,'language':_0x1a7b0d,'rooms_data':_0x437eda,'invoice_no':_0x1f691a});})[_0x3be84c(0x22d)](_0x4690e5=>{var _0x58f6fb=_0x3be84c;_0x1fc1fe['flash'](_0x58f6fb(0x17f),_0x58f6fb(0x226)),_0x405ed6['redirect'](_0x58f6fb(0x1ad));});}catch(_0x427481){console[_0x3be84c(0x22a)](_0x427481);}}),router[a0_0x39484e(0x1c3)](a0_0x39484e(0x1e7),auth,async(_0x2884e9,_0x4a6c89)=>{var _0x526777=a0_0x39484e;try{const {warehouse_name:_0x56dc19,date:_0x37be29,prod_name:_0x13e861,level:_0x155b05,isle:_0x482852,pallet:_0x3d720c,stock:_0x113628,types:_0x281940,adjust_qty:_0x41f080,new_adjust_qty:_0x2b89b9,note:_0x1446db,Room_name:_0x1cd9a6,invoice:_0x4934ae,JO_number:_0x67db3,expiry_date:_0x3e78e2}=_0x2884e9['body'];if(typeof _0x13e861==_0x526777(0x188))var _0x2563dd=[_0x2884e9[_0x526777(0x176)]['prod_name']],_0x3022bf=[_0x2884e9[_0x526777(0x176)]['level']],_0x42704d=[_0x2884e9['body'][_0x526777(0x164)]],_0x56551f=[_0x2884e9[_0x526777(0x176)]['types']],_0x26ceec=[_0x2884e9[_0x526777(0x176)][_0x526777(0x1dc)]],_0x3c2460=[_0x2884e9[_0x526777(0x176)]['New_Qty_Converted']],_0x4adceb=[_0x2884e9['body'][_0x526777(0x196)]],_0x50c95f=[_0x2884e9[_0x526777(0x176)][_0x526777(0x1aa)]],_0xcb8d49=[_0x2884e9[_0x526777(0x176)]['prod_code']],_0x34f9c8=[_0x2884e9[_0x526777(0x176)]['batch_code']],_0x4cd121=[_0x2884e9[_0x526777(0x176)][_0x526777(0x169)]],_0x1d72f1=[_0x2884e9[_0x526777(0x176)][_0x526777(0x21b)]],_0x59e91b=[_0x2884e9['body']['prod_cat']],_0x3391ef=[_0x2884e9[_0x526777(0x176)][_0x526777(0x16a)]],_0xf84b26=[_0x2884e9[_0x526777(0x176)][_0x526777(0x208)]],_0x5a5fd7=[_0x2884e9[_0x526777(0x176)][_0x526777(0x1d2)]];else var _0x2563dd=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x1a0)]],_0x3022bf=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x1d9)]],_0x42704d=[..._0x2884e9[_0x526777(0x176)]['stock']],_0x56551f=[..._0x2884e9['body'][_0x526777(0x1f2)]],_0x26ceec=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x1dc)]],_0x3c2460=[..._0x2884e9['body'][_0x526777(0x20d)]],_0x4adceb=[..._0x2884e9[_0x526777(0x176)]['Primary_Units']],_0x50c95f=[..._0x2884e9['body']['Secondary_units']],_0xcb8d49=[..._0x2884e9['body'][_0x526777(0x165)]],_0x34f9c8=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x1b8)]],_0x4cd121=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x169)]],_0x1d72f1=[..._0x2884e9['body'][_0x526777(0x21b)]],_0x59e91b=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x187)]],_0x3391ef=[..._0x2884e9[_0x526777(0x176)]['Rooms']],_0xf84b26=[..._0x2884e9['body'][_0x526777(0x208)]],_0x5a5fd7=[..._0x2884e9[_0x526777(0x176)][_0x526777(0x1d2)]];const _0x335720=_0x2563dd[_0x526777(0x17e)](_0x3c449e=>{return _0x3c449e={'product_name':_0x3c449e};});_0x3022bf[_0x526777(0x1d4)]((_0x4b0c27,_0x29e540)=>{var _0x578c26=_0x526777;_0x335720[_0x29e540][_0x578c26(0x229)]=_0x4b0c27;}),_0x42704d[_0x526777(0x1d4)]((_0x236382,_0xa365e0)=>{var _0x578c58=_0x526777;_0x335720[_0xa365e0][_0x578c58(0x1c4)]=_0x236382;}),_0x56551f[_0x526777(0x1d4)]((_0x2e3ac4,_0x369ac4)=>{var _0x62a5f8=_0x526777;_0x335720[_0x369ac4][_0x62a5f8(0x1f2)]=_0x2e3ac4;}),_0x26ceec[_0x526777(0x1d4)]((_0x2a4665,_0x43deb2)=>{_0x335720[_0x43deb2]['adjust_qty']=_0x2a4665;}),_0x3c2460[_0x526777(0x1d4)]((_0x3936d2,_0x338991)=>{var _0x44694e=_0x526777;_0x335720[_0x338991][_0x44694e(0x1be)]=_0x3936d2;}),_0x4adceb[_0x526777(0x1d4)]((_0x3ec59c,_0x41c9d8)=>{_0x335720[_0x41c9d8]['unit']=_0x3ec59c;}),_0x50c95f[_0x526777(0x1d4)]((_0x29e6c0,_0x313914)=>{var _0x345caf=_0x526777;_0x335720[_0x313914][_0x345caf(0x209)]=_0x29e6c0;}),_0xcb8d49[_0x526777(0x1d4)]((_0x462722,_0x4d727a)=>{var _0x4cfea2=_0x526777;_0x335720[_0x4d727a][_0x4cfea2(0x199)]=_0x462722;}),_0x34f9c8[_0x526777(0x1d4)]((_0x45d92e,_0x23fbf6)=>{var _0x1ede36=_0x526777;_0x335720[_0x23fbf6][_0x1ede36(0x1b8)]=_0x45d92e;}),_0x4cd121[_0x526777(0x1d4)]((_0x5468db,_0x98d2ad)=>{var _0x5b8c1b=_0x526777;_0x335720[_0x98d2ad][_0x5b8c1b(0x169)]=_0x5468db;}),_0x1d72f1[_0x526777(0x1d4)]((_0x16bba1,_0x5ad5b9)=>{var _0xbdd635=_0x526777;_0x335720[_0x5ad5b9][_0xbdd635(0x18a)]=_0x16bba1;}),_0x59e91b[_0x526777(0x1d4)]((_0x4de3c7,_0x3b22bb)=>{var _0x38141b=_0x526777;_0x335720[_0x3b22bb][_0x38141b(0x187)]=_0x4de3c7;}),_0x3391ef['forEach']((_0x429ea5,_0x261265)=>{var _0x1be15e=_0x526777;_0x335720[_0x261265][_0x1be15e(0x1c8)]=_0x429ea5;}),_0xf84b26['forEach']((_0x38afae,_0x7792dd)=>{var _0x4130bd=_0x526777;_0x335720[_0x7792dd][_0x4130bd(0x208)]=_0x38afae;}),_0x5a5fd7[_0x526777(0x1d4)]((_0x511de8,_0x54c1e7)=>{var _0x51064f=_0x526777;_0x335720[_0x54c1e7][_0x51064f(0x16e)]=_0x511de8;});const _0x3fdf96=_0x335720[_0x526777(0x18e)](_0x4c69df=>_0x4c69df['adjust_qty']!=='0'&&_0x4c69df[_0x526777(0x167)]!=='');var _0x2e6921=0x0;_0x3fdf96[_0x526777(0x1d4)](_0x399dd0=>{var _0x5b7a05=_0x526777;console[_0x5b7a05(0x22a)]('foreach\x20newproduct',_0x399dd0),parseInt(_0x399dd0[_0x5b7a05(0x167)])<=0x0&&_0x2e6921++;});if(_0x2e6921!=0x0)return _0x2884e9[_0x526777(0x18c)](_0x526777(0x17f),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x4a6c89['redirect'](_0x526777(0x216));const _0xc788d6=new adjustment_finished({'warehouse_name':_0x56dc19,'date':_0x37be29,'product':_0x3fdf96,'note':_0x1446db,'room':_0x1cd9a6,'invoice':_0x4934ae,'JO_number':_0x67db3,'expiry_date':_0x3e78e2}),_0x3d6a7d=await _0xc788d6[_0x526777(0x1a6)]();_0x2884e9['flash'](_0x526777(0x182),_0x526777(0x1c5)),_0x4a6c89[_0x526777(0x21e)]('/adjustment_finished/preview/'+_0x3d6a7d[_0x526777(0x181)]);}catch(_0x1d4299){console[_0x526777(0x22a)](_0x1d4299),_0x4a6c89[_0x526777(0x1d8)](0xc8)[_0x526777(0x1a4)]({'message':_0x1d4299[_0x526777(0x207)]});}}),router['get']('/preview/:id',auth,async(_0xbe74a1,_0x14d4e1)=>{var _0x4b605d=a0_0x39484e;try{const {username:_0x2a3dcc,email:_0x59fb3e,role:_0x5c2fc0}=_0xbe74a1[_0x4b605d(0x1cd)],_0x48ff42=_0xbe74a1[_0x4b605d(0x1cd)],_0x250e72=await profile[_0x4b605d(0x1a2)]({'email':_0x48ff42[_0x4b605d(0x212)]}),_0x5efcea=await master_shop[_0x4b605d(0x1fc)](),_0x3a3708=_0xbe74a1[_0x4b605d(0x210)]['id'],_0x3e630d=await adjustment_finished[_0x4b605d(0x175)]({'_id':_0x3a3708}),_0x19658d=await purchases[_0x4b605d(0x1b0)]([{'$match':{'warehouse_name':_0x3e630d[_0x4b605d(0x1c0)]}},{'$unwind':_0x4b605d(0x191)},{'$group':{'_id':_0x4b605d(0x170)}}]);console[_0x4b605d(0x22a)]('purchases_data',_0x19658d);const _0x34d63f=await product['find']({}),_0x177176=await warehouse[_0x4b605d(0x1b0)]([{'$match':{'name':_0x3e630d[_0x4b605d(0x1c0)],'warehouse_category':_0x4b605d(0x1fe)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x4b605d(0x178),'name':{'$first':_0x4b605d(0x21d)},'product_stock':{'$first':_0x4b605d(0x1f5)},'bay':{'$first':_0x4b605d(0x21a)},'bin':{'$first':_0x4b605d(0x1f8)},'type':{'$first':_0x4b605d(0x1ff)},'floorlevel':{'$first':_0x4b605d(0x180)},'primary_code':{'$first':_0x4b605d(0x1b4)},'secondary_code':{'$first':_0x4b605d(0x1f9)},'product_code':{'$first':_0x4b605d(0x1da)},'storage':{'$first':_0x4b605d(0x220)},'rack':{'$first':_0x4b605d(0x214)},'expiry_date':{'$first':_0x4b605d(0x1fb)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x4b605d(0x202)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x4b605d(0x211)}}}]);if(_0x5efcea[0x0][_0x4b605d(0x218)]==_0x4b605d(0x19d)){var _0x34fb5f=users[_0x4b605d(0x1a5)];console[_0x4b605d(0x22a)](_0x34fb5f);}else{if(_0x5efcea[0x0][_0x4b605d(0x218)]==_0x4b605d(0x1e6))var _0x34fb5f=users[_0x4b605d(0x1e6)];else{if(_0x5efcea[0x0][_0x4b605d(0x218)]=='German')var _0x34fb5f=users[_0x4b605d(0x1bf)];else{if(_0x5efcea[0x0][_0x4b605d(0x218)]=='Spanish')var _0x34fb5f=users[_0x4b605d(0x1a1)];else{if(_0x5efcea[0x0][_0x4b605d(0x218)]==_0x4b605d(0x225))var _0x34fb5f=users[_0x4b605d(0x225)];else{if(_0x5efcea[0x0][_0x4b605d(0x218)]==_0x4b605d(0x189))var _0x34fb5f=users[_0x4b605d(0x1df)];else{if(_0x5efcea[0x0][_0x4b605d(0x218)]==_0x4b605d(0x223))var _0x34fb5f=users[_0x4b605d(0x223)];else{if(_0x5efcea[0x0][_0x4b605d(0x218)]==_0x4b605d(0x228))var _0x34fb5f=users[_0x4b605d(0x1e2)];}}}}}}}_0x14d4e1[_0x4b605d(0x201)](_0x4b605d(0x195),{'success':_0xbe74a1[_0x4b605d(0x18c)](_0x4b605d(0x182)),'errors':_0xbe74a1['flash'](_0x4b605d(0x17f)),'role':_0x48ff42,'profile':_0x250e72,'adjustment':_0x3e630d,'stock':_0x177176,'master_shop':_0x5efcea,'warehouse_name':_0x19658d,'unit':_0x34d63f,'language':_0x34fb5f});}catch(_0x53155f){console[_0x4b605d(0x22a)](_0x53155f),_0x14d4e1[_0x4b605d(0x1d8)](0xc8)[_0x4b605d(0x1a4)]({'message':_0x53155f[_0x4b605d(0x207)]});}}),router[a0_0x39484e(0x1c3)]('/preview/:id',auth,async(_0xbf1d4,_0x864993)=>{var _0x530b37=a0_0x39484e;try{const {invoice:_0x28d8ef,warehouse_name:_0x5e7309,Room_name:_0x2deb18}=_0xbf1d4[_0x530b37(0x176)],_0x51d8b6=_0xbf1d4[_0x530b37(0x210)]['id'],_0x52d1b9=await adjustment_finished[_0x530b37(0x175)]({'_id':_0x51d8b6});var _0x10886e;const _0x3f8f75=_0x52d1b9['product'][_0x530b37(0x17e)](async _0x4ec17d=>{var _0x38f56d=_0x530b37;if(_0x4ec17d[_0x38f56d(0x167)]>0x0){_0x10886e=await warehouse['findOne']({'name':_0x5e7309,'room':_0x4ec17d['room_names'],'warehouse_category':'Finished\x20Goods'});const _0x5ef982=_0x10886e[_0x38f56d(0x190)][_0x38f56d(0x17e)](_0x4e1b3b=>{var _0x2e0273=_0x38f56d;console[_0x2e0273(0x22a)](_0x4ec17d[_0x2e0273(0x1f2)]);if(_0x4ec17d[_0x2e0273(0x1f2)]==_0x2e0273(0x17d))_0x4e1b3b[_0x2e0273(0x1d6)]==_0x4ec17d[_0x2e0273(0x1d6)]&&_0x4e1b3b[_0x2e0273(0x229)]==_0x4ec17d[_0x2e0273(0x229)]&&_0x4e1b3b[_0x2e0273(0x169)]==_0x4ec17d[_0x2e0273(0x169)]&&_0x4e1b3b['production_date']==_0x4ec17d[_0x2e0273(0x18a)]&&_0x4e1b3b[_0x2e0273(0x1b8)]==_0x4ec17d['batch_code']&&_0x4e1b3b[_0x2e0273(0x16e)]==_0x4ec17d[_0x2e0273(0x16e)]&&(_0x4e1b3b[_0x2e0273(0x1af)]=_0x4e1b3b['product_stock']-_0x4ec17d[_0x2e0273(0x167)]);else _0x4ec17d[_0x2e0273(0x1f2)]==_0x2e0273(0x1d7)&&(_0x4e1b3b[_0x2e0273(0x1d6)]==_0x4ec17d[_0x2e0273(0x1d6)]&&_0x4e1b3b[_0x2e0273(0x229)]==_0x4ec17d[_0x2e0273(0x229)]&&_0x4e1b3b['expiry_date']==_0x4ec17d[_0x2e0273(0x169)]&&_0x4e1b3b[_0x2e0273(0x18a)]==_0x4ec17d[_0x2e0273(0x18a)]&&_0x4e1b3b['batch_code']==_0x4ec17d[_0x2e0273(0x1b8)]&&_0x4e1b3b[_0x2e0273(0x16e)]==_0x4ec17d[_0x2e0273(0x16e)]&&(_0x4e1b3b['product_stock']=_0x4e1b3b['product_stock']+_0x4ec17d[_0x2e0273(0x167)]));});}return _0x10886e;});Promise[_0x530b37(0x1eb)](_0x3f8f75)[_0x530b37(0x1d0)](async _0xed4bae=>{var _0x146397=_0x530b37;try{for(const _0x3b565a of _0xed4bae){await _0x3b565a['save']();}_0x52d1b9[_0x146397(0x16d)]=_0x146397(0x1ae);const _0x1474d1=await _0x52d1b9[_0x146397(0x1a6)](),_0x4abb67=await master_shop['find'](),_0x4fc032=await email_settings[_0x146397(0x1a2)](),_0x12869c=await supervisor_settings[_0x146397(0x1fc)]();var _0x2fe5c9=_0x52d1b9[_0x146397(0x171)],_0x139aee='',_0x3f99da;for(_0x3f99da in _0x2fe5c9){var _0x2f0c1d='FG';_0x52d1b9[_0x146397(0x1c0)]==_0x146397(0x1ba)&&(_0x2f0c1d='DG'),_0x139aee+='<tr>'+_0x146397(0x1ef)+_0x2fe5c9[_0x3f99da][_0x146397(0x1d6)]+_0x146397(0x1ea)+_0x146397(0x1ef)+_0x2fe5c9[_0x3f99da]['product_code']+_0x146397(0x1ea)+_0x146397(0x1ef)+_0x2fe5c9[_0x3f99da]['adjust_qty']+_0x146397(0x1ea)+_0x146397(0x1ef)+_0x2fe5c9[_0x3f99da][_0x146397(0x16b)]+_0x146397(0x1ea)+_0x146397(0x1ef)+_0x2fe5c9[_0x3f99da][_0x146397(0x209)]+_0x146397(0x1ea)+_0x146397(0x1ef)+_0x52d1b9[_0x146397(0x1c0)]+'</td>'+_0x146397(0x1ef)+_0x2fe5c9[_0x3f99da]['room_names']+_0x146397(0x1ea)+_0x146397(0x1ef)+_0x2f0c1d+_0x2fe5c9[_0x3f99da]['bay']+'</td>'+'</tr>';}let _0x515b5f=nodemailer[_0x146397(0x227)]({'host':_0x4fc032[_0x146397(0x1dd)],'port':Number(_0x4fc032[_0x146397(0x1c1)]),'secure':![],'auth':{'user':_0x4fc032[_0x146397(0x212)],'pass':_0x4fc032[_0x146397(0x168)]}}),_0x1bb9c6={'from':_0x4fc032[_0x146397(0x212)],'to':_0x12869c[0x0][_0x146397(0x162)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x146397(0x21f),'path':__dirname+'/../public'+_0x146397(0x1b9)+_0x4abb67[0x0][_0x146397(0x213)],'cid':_0x146397(0x1e9)}],'html':'<!DOCTYPE\x20html>'+_0x146397(0x21c)+_0x146397(0x1e5)+_0x146397(0x1e8)+_0x146397(0x1f6)+'<div>'+_0x146397(0x20c)+_0x146397(0x1bb)+_0x146397(0x1e8)+_0x146397(0x1b3)+_0x4abb67[0x0][_0x146397(0x1cb)]+_0x146397(0x1b6)+_0x146397(0x1bb)+_0x146397(0x1bb)+_0x146397(0x203)+_0x146397(0x1e8)+_0x146397(0x19c)+_0x146397(0x1e1)+_0x52d1b9[_0x146397(0x16e)]+'\x20'+_0x146397(0x16c)+_0x146397(0x18d)+_0x52d1b9[_0x146397(0x166)]+'\x20'+_0x146397(0x1b7)+'</h5>'+_0x146397(0x1bb)+_0x146397(0x1f7)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x146397(0x1f4)+_0x146397(0x19b)+_0x146397(0x163)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x146397(0x19e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x146397(0x206)+_0x146397(0x1fa)+_0x146397(0x17b)+'</tr>'+_0x146397(0x1f1)+_0x146397(0x204)+'\x20'+_0x139aee+'\x20'+'</tbody>'+'</table>'+'<div>'+_0x146397(0x1c6)+_0x146397(0x1db)+_0x4abb67[0x0]['site_title']+_0x146397(0x1ab)+'</div>'+'</div>'+_0x146397(0x1c7)};_0x515b5f[_0x146397(0x185)](_0x1bb9c6,function(_0x22d57d,_0x347284){var _0x598daf=_0x146397;_0x22d57d?(console[_0x598daf(0x22a)](_0x22d57d),console['log'](_0x598daf(0x1e4))):console[_0x598daf(0x22a)](_0x598daf(0x1ca));}),_0xbf1d4['flash'](_0x146397(0x182),_0x146397(0x1f0)),_0x864993[_0x146397(0x21e)](_0x146397(0x1a3)+_0x1474d1[_0x146397(0x181)]);}catch(_0x251230){console[_0x146397(0x1cc)](_0x251230),_0x864993[_0x146397(0x1d8)](0x1f4)[_0x146397(0x1a4)]({'error':_0x146397(0x221)});}})['catch'](_0x23eb88=>{var _0x2b8144=_0x530b37;console[_0x2b8144(0x1cc)](_0x23eb88),_0x864993[_0x2b8144(0x1d8)](0x1f4)[_0x2b8144(0x1a4)]({'error':_0x2b8144(0x194)});});}catch(_0x49f5d1){_0x864993[_0x530b37(0x1a4)]({'message':_0x49f5d1[_0x530b37(0x207)]});}}),router[a0_0x39484e(0x1ce)](a0_0x39484e(0x16f),auth,async(_0x25fd5c,_0x49aa92)=>{var _0x3a8d4a=a0_0x39484e;try{const {username:_0x3fdd08,email:_0x18b907,role:_0x5b83b0}=_0x25fd5c[_0x3a8d4a(0x1cd)],_0x469d30=_0x25fd5c[_0x3a8d4a(0x1cd)],_0x45e90f=await profile[_0x3a8d4a(0x1a2)]({'email':_0x469d30['email']}),_0x32787f=await master_shop[_0x3a8d4a(0x1fc)]();console[_0x3a8d4a(0x22a)](_0x3a8d4a(0x173),_0x32787f);const _0x56f54e=_0x25fd5c['params']['id'],_0x547119=await adjustment_finished['findById']({'_id':_0x56f54e});let _0x53a6f5=new Date(_0x547119[_0x3a8d4a(0x169)]),_0x4bfac5=('0'+_0x53a6f5[_0x3a8d4a(0x192)]())['slice'](-0x2),_0x46380f=('0'+(_0x53a6f5['getMonth']()+0x1))[_0x3a8d4a(0x200)](-0x2),_0x270469=_0x53a6f5[_0x3a8d4a(0x1ee)](),_0x5c014a=_0x270469+'-'+_0x46380f+'-'+_0x4bfac5;var _0x1d16da=['Ambient',_0x3a8d4a(0x19a),_0x3a8d4a(0x20f)];const _0x540ef3=await purchases[_0x3a8d4a(0x1b0)]([{'$match':{'warehouse_name':_0x547119['warehouse_name']}},{'$unwind':_0x3a8d4a(0x191)},{'$group':{'_id':_0x3a8d4a(0x170)}}]);console[_0x3a8d4a(0x22a)](_0x3a8d4a(0x186),_0x540ef3);const _0x4da28d=await product[_0x3a8d4a(0x1fc)]({}),_0x318118=await warehouse[_0x3a8d4a(0x1b0)]([{'$match':{'name':_0x547119[_0x3a8d4a(0x1c0)],'room':_0x547119['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x3a8d4a(0x178),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3a8d4a(0x21a)},'bin':{'$first':_0x3a8d4a(0x1f8)},'type':{'$first':_0x3a8d4a(0x1ff)},'floorlevel':{'$first':_0x3a8d4a(0x180)},'primary_code':{'$first':_0x3a8d4a(0x1b4)},'secondary_code':{'$first':_0x3a8d4a(0x1f9)},'product_code':{'$first':_0x3a8d4a(0x1da)},'storage':{'$first':_0x3a8d4a(0x220)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x32787f[0x0][_0x3a8d4a(0x218)]=='English\x20(US)'){var _0x50e528=users[_0x3a8d4a(0x1a5)];console['log'](_0x50e528);}else{if(_0x32787f[0x0][_0x3a8d4a(0x218)]==_0x3a8d4a(0x1e6))var _0x50e528=users[_0x3a8d4a(0x1e6)];else{if(_0x32787f[0x0][_0x3a8d4a(0x218)]==_0x3a8d4a(0x1bf))var _0x50e528=users[_0x3a8d4a(0x1bf)];else{if(_0x32787f[0x0][_0x3a8d4a(0x218)]==_0x3a8d4a(0x1a1))var _0x50e528=users[_0x3a8d4a(0x1a1)];else{if(_0x32787f[0x0][_0x3a8d4a(0x218)]==_0x3a8d4a(0x225))var _0x50e528=users['French'];else{if(_0x32787f[0x0][_0x3a8d4a(0x218)]==_0x3a8d4a(0x189))var _0x50e528=users[_0x3a8d4a(0x1df)];else{if(_0x32787f[0x0]['language']=='Chinese')var _0x50e528=users['Chinese'];else{if(_0x32787f[0x0][_0x3a8d4a(0x218)]==_0x3a8d4a(0x228))var _0x50e528=users[_0x3a8d4a(0x1e2)];}}}}}}}_0x49aa92['render'](_0x3a8d4a(0x1a9),{'success':_0x25fd5c[_0x3a8d4a(0x18c)](_0x3a8d4a(0x182)),'errors':_0x25fd5c[_0x3a8d4a(0x18c)](_0x3a8d4a(0x17f)),'role':_0x469d30,'profile':_0x45e90f,'adjustment':_0x547119,'stock':_0x318118,'master_shop':_0x32787f,'warehouse_name':_0x540ef3,'unit':_0x4da28d,'language':_0x50e528,'rooms_data':_0x1d16da,'ed_fullDate':_0x5c014a});}catch(_0x1f3000){console[_0x3a8d4a(0x22a)](_0x1f3000),_0x49aa92[_0x3a8d4a(0x1d8)](0xc8)[_0x3a8d4a(0x1a4)]({'message':_0x1f3000[_0x3a8d4a(0x207)]});}}),router[a0_0x39484e(0x1c3)](a0_0x39484e(0x16f),auth,async(_0x86a101,_0x320bb9)=>{var _0x5cd3ac=a0_0x39484e;try{const _0x5c2acd=_0x86a101[_0x5cd3ac(0x210)]['id'],_0x41849f=await adjustment_finished[_0x5cd3ac(0x175)]({'_id':_0x5c2acd}),_0x55b209=await warehouse[_0x5cd3ac(0x1a2)]({'name':_0x41849f[_0x5cd3ac(0x1c0)],'room':_0x41849f[_0x5cd3ac(0x20e)]}),{warehouse_name:_0x3e784d,date:_0x4be558,prod_name:_0x242a01,level:_0xa1a754,isle:_0x48bf47,pallet:_0x41a437,stock:_0x19c3a8,types:_0x13e685,adjust_qty:_0xf66c3e,new_adjust_qty:_0x2cd458,note:_0x3130e5,Room_name:_0x3eae6e,invoice:_0x68e1ce,JO_number:_0x3bcec8}=_0x86a101[_0x5cd3ac(0x176)];if(typeof _0x242a01==_0x5cd3ac(0x188))var _0x5c9b34=[_0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1a0)]],_0x477b7a=[_0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1d9)]],_0x1a259d=[_0x86a101[_0x5cd3ac(0x176)]['stock']],_0x5efe4b=[_0x86a101['body'][_0x5cd3ac(0x1f2)]],_0x192dde=[_0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x167)]],_0xca9ae4=[_0x86a101['body'][_0x5cd3ac(0x1be)]],_0x29576b=[_0x86a101['body'][_0x5cd3ac(0x165)]],_0x3ba7a7=[_0x86a101['body']['unit']],_0x4896e3=[_0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1aa)]],_0x43c1ba=[_0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1b8)]],_0x2ddd4b=[_0x86a101['body']['expiry_date']];else var _0x5c9b34=[..._0x86a101[_0x5cd3ac(0x176)]['prod_name']],_0x477b7a=[..._0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1d9)]],_0x1a259d=[..._0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x164)]],_0x5efe4b=[..._0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1f2)]],_0x192dde=[..._0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x167)]],_0xca9ae4=[..._0x86a101['body'][_0x5cd3ac(0x1be)]],_0x29576b=[..._0x86a101[_0x5cd3ac(0x176)]['prod_code']],_0x3ba7a7=[..._0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x16b)]],_0x4896e3=[..._0x86a101[_0x5cd3ac(0x176)][_0x5cd3ac(0x1aa)]],_0x43c1ba=[..._0x86a101['body'][_0x5cd3ac(0x1b8)]],_0x2ddd4b=[..._0x86a101[_0x5cd3ac(0x176)]['expiry_date']];const _0x186424=_0x5c9b34[_0x5cd3ac(0x17e)](_0x1def76=>{return _0x1def76={'product_name':_0x1def76};});_0x477b7a[_0x5cd3ac(0x1d4)]((_0x3bc4ba,_0x1420b7)=>{var _0x16cff4=_0x5cd3ac;_0x186424[_0x1420b7][_0x16cff4(0x229)]=_0x3bc4ba;}),_0x1a259d[_0x5cd3ac(0x1d4)]((_0x31a33d,_0x518698)=>{var _0x4ae6f8=_0x5cd3ac;_0x186424[_0x518698][_0x4ae6f8(0x1c4)]=_0x31a33d;}),_0x5efe4b[_0x5cd3ac(0x1d4)]((_0x3e07a4,_0x30bbfd)=>{var _0x524f8f=_0x5cd3ac;_0x186424[_0x30bbfd][_0x524f8f(0x1f2)]=_0x3e07a4;}),_0x192dde[_0x5cd3ac(0x1d4)]((_0x17456c,_0x2c5488)=>{var _0x4e2c7f=_0x5cd3ac;_0x186424[_0x2c5488][_0x4e2c7f(0x167)]=_0x17456c;}),_0xca9ae4[_0x5cd3ac(0x1d4)]((_0x55ece3,_0x499dfd)=>{var _0x90c566=_0x5cd3ac;_0x186424[_0x499dfd][_0x90c566(0x1be)]=_0x55ece3;}),_0x3ba7a7[_0x5cd3ac(0x1d4)]((_0x1fdba3,_0x43cc93)=>{var _0x13acc7=_0x5cd3ac;_0x186424[_0x43cc93][_0x13acc7(0x16b)]=_0x1fdba3;}),_0x4896e3[_0x5cd3ac(0x1d4)]((_0x2e05fd,_0x460ffe)=>{var _0xba9bce=_0x5cd3ac;_0x186424[_0x460ffe][_0xba9bce(0x209)]=_0x2e05fd;}),_0x29576b[_0x5cd3ac(0x1d4)]((_0x5430d4,_0x5dde85)=>{var _0x4d6365=_0x5cd3ac;_0x186424[_0x5dde85][_0x4d6365(0x199)]=_0x5430d4;}),_0x43c1ba[_0x5cd3ac(0x1d4)]((_0x55ce64,_0x46b656)=>{var _0x265002=_0x5cd3ac;_0x186424[_0x46b656][_0x265002(0x1b8)]=_0x55ce64;}),_0x2ddd4b[_0x5cd3ac(0x1d4)]((_0x4ec4d4,_0x4f3b2f)=>{var _0x35c9e9=_0x5cd3ac;_0x186424[_0x4f3b2f][_0x35c9e9(0x169)]=_0x4ec4d4;});const _0x5c22ff=_0x186424[_0x5cd3ac(0x18e)](_0x48c517=>_0x48c517['adjust_qty']!=='0'&&_0x48c517[_0x5cd3ac(0x167)]!=='');var _0x1c6d20=0x0;_0x5c22ff[_0x5cd3ac(0x1d4)](_0x28182b=>{var _0xc0fdcf=_0x5cd3ac;console[_0xc0fdcf(0x22a)](_0xc0fdcf(0x1b1),_0x28182b),parseInt(_0x28182b[_0xc0fdcf(0x167)])<=0x0&&_0x1c6d20++;});if(_0x1c6d20!=0x0)return _0x86a101[_0x5cd3ac(0x18c)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x320bb9[_0x5cd3ac(0x21e)](_0x5cd3ac(0x216));_0x41849f['warehouse_name']=_0x3e784d,_0x41849f[_0x5cd3ac(0x166)]=_0x4be558,_0x41849f[_0x5cd3ac(0x171)]=_0x5c22ff,_0x41849f[_0x5cd3ac(0x1a7)]=_0x3130e5,_0x41849f['room']=_0x3eae6e,_0x41849f[_0x5cd3ac(0x16e)]=_0x68e1ce,_0x41849f[_0x5cd3ac(0x184)]=_0x3bcec8;const _0xcf513c=await _0x41849f['save'](),_0x244709=await warehouse[_0x5cd3ac(0x1a2)]({'name':_0x3e784d,'room':_0x3eae6e});_0xcf513c['product']['forEach'](_0x49c819=>{var _0x3bb11c=_0x5cd3ac;const _0xc1dcd5=_0x244709[_0x3bb11c(0x190)][_0x3bb11c(0x17e)](_0x1c08e2=>{var _0x593de9=_0x3bb11c;_0x49c819[_0x593de9(0x1f2)]=='minus'?_0x1c08e2[_0x593de9(0x1d6)]==_0x49c819[_0x593de9(0x1d6)]&&_0x1c08e2[_0x593de9(0x229)]==_0x49c819[_0x593de9(0x229)]&&(_0x1c08e2[_0x593de9(0x1af)]=parseInt(_0x1c08e2['product_stock'])-parseInt(_0x49c819[_0x593de9(0x167)])):_0x1c08e2[_0x593de9(0x1d6)]==_0x49c819[_0x593de9(0x1d6)]&&_0x1c08e2[_0x593de9(0x229)]==_0x49c819[_0x593de9(0x229)]&&(_0x1c08e2[_0x593de9(0x1af)]=parseInt(_0x1c08e2[_0x593de9(0x1af)])+parseInt(_0x49c819[_0x593de9(0x167)]));});}),await _0x244709['save'](),_0x86a101[_0x5cd3ac(0x18c)](_0x5cd3ac(0x182),_0x5cd3ac(0x161)),_0x320bb9[_0x5cd3ac(0x21e)](_0x5cd3ac(0x18f));}catch(_0x10bef6){console[_0x5cd3ac(0x22a)](_0x10bef6);}}),router[a0_0x39484e(0x1c3)](a0_0x39484e(0x205),async(_0x3ad6da,_0x598e19)=>{var _0x49f821=a0_0x39484e;const {primary_code:_0x25bc6f,warehouse_data:_0x12ff1d,rooms_data:_0x458f3c,Roomslist:_0x29a295}=_0x3ad6da[_0x49f821(0x176)],_0x3b8a46=_0x29a295[_0x49f821(0x1d1)](','),_0x30c29a=[];async function _0x4a40e1(_0x5eae7){var _0x2317c0=_0x49f821;const _0x1bd15d=await warehouse[_0x2317c0(0x1b0)]([{'$match':{'name':_0x12ff1d,'room':_0x5eae7}},{'$unwind':_0x2317c0(0x1b5)},{'$match':{'product_details.primary_code':_0x25bc6f}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2317c0(0x21d)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2317c0(0x1b4)},'secondary_code':{'$first':_0x2317c0(0x1f9)},'product_code':{'$first':_0x2317c0(0x1da)},'level':{'$first':_0x2317c0(0x21a)},'isle':{'$first':_0x2317c0(0x1f8)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2317c0(0x180)},'unit':{'$first':_0x2317c0(0x1a8)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2317c0(0x220)},'rack':{'$first':_0x2317c0(0x214)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2317c0(0x202)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2317c0(0x215)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2317c0(0x174)}}}]),_0x57443c=await warehouse[_0x2317c0(0x1b0)]([{'$match':{'name':_0x12ff1d,'room':_0x5eae7}},{'$unwind':_0x2317c0(0x1b5)},{'$match':{'product_details.secondary_code':_0x25bc6f}},{'$group':{'_id':_0x2317c0(0x178),'name':{'$first':_0x2317c0(0x21d)},'product_stock':{'$first':_0x2317c0(0x1f5)},'primary_code':{'$first':_0x2317c0(0x1b4)},'secondary_code':{'$first':_0x2317c0(0x1f9)},'product_code':{'$first':_0x2317c0(0x1da)},'level':{'$first':_0x2317c0(0x21a)},'isle':{'$first':_0x2317c0(0x1f8)},'type':{'$first':_0x2317c0(0x1ff)},'pallet':{'$first':_0x2317c0(0x180)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2317c0(0x214)},'expiry_date':{'$first':_0x2317c0(0x1fb)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x2317c0(0x211)},'invoice':{'$first':_0x2317c0(0x174)}}}]);if(_0x1bd15d[_0x2317c0(0x22b)]>0x0)_0x30c29a[_0x2317c0(0x193)](_0x1bd15d);else _0x57443c[_0x2317c0(0x22b)]>0x0&&_0x30c29a[_0x2317c0(0x193)](_0x57443c);}const _0x3a7407=_0x3b8a46[_0x49f821(0x17e)](_0x34f367=>_0x4a40e1(_0x34f367));await Promise['all'](_0x3a7407),_0x598e19['json'](_0x30c29a);}),router[a0_0x39484e(0x1c3)](a0_0x39484e(0x1c2),async(_0x582bcf,_0x3c5b4f)=>{var _0x1d4c53=a0_0x39484e;const {productCode:_0x24bff0,bay:_0x292650,warehouses:_0x3092b5,room:_0x26a2f4}=_0x582bcf['body'];console[_0x1d4c53(0x22a)](_0x582bcf[_0x1d4c53(0x176)]);try{const _0x1f61e8=await warehouse['aggregate']([{'$match':{'name':_0x3092b5,'room':_0x26a2f4}},{'$unwind':_0x1d4c53(0x1b5)},{'$match':{'product_details.bay':parseInt(_0x292650)}},{'$group':{'_id':_0x1d4c53(0x178),'name':{'$first':_0x1d4c53(0x21d)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1d4c53(0x21a)},'maxProducts':{'$first':_0x1d4c53(0x1e3)}}}]);_0x3c5b4f[_0x1d4c53(0x1d8)](0xc8)[_0x1d4c53(0x1a4)](_0x1f61e8);}catch(_0xc8ef27){_0x3c5b4f[_0x1d4c53(0x1d8)](0x194)[_0x1d4c53(0x1a4)]({'message':_0xc8ef27[_0x1d4c53(0x207)]});}}),module[a0_0x39484e(0x17c)]=router;