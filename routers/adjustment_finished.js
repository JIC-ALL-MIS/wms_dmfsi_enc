var a0_0xcabf89=a0_0x4231;(function(_0x37b851,_0x41bdcd){var _0x1aa2ca=a0_0x4231,_0x3f51bf=_0x37b851();while(!![]){try{var _0x122230=parseInt(_0x1aa2ca(0x21e))/0x1*(-parseInt(_0x1aa2ca(0x209))/0x2)+parseInt(_0x1aa2ca(0x1e9))/0x3+-parseInt(_0x1aa2ca(0x23a))/0x4*(-parseInt(_0x1aa2ca(0x1d4))/0x5)+parseInt(_0x1aa2ca(0x274))/0x6+-parseInt(_0x1aa2ca(0x1eb))/0x7*(-parseInt(_0x1aa2ca(0x284))/0x8)+parseInt(_0x1aa2ca(0x202))/0x9*(-parseInt(_0x1aa2ca(0x23c))/0xa)+-parseInt(_0x1aa2ca(0x216))/0xb;if(_0x122230===_0x41bdcd)break;else _0x3f51bf['push'](_0x3f51bf['shift']());}catch(_0x476248){_0x3f51bf['push'](_0x3f51bf['shift']());}}}(a0_0x3e62,0xba855));function a0_0x3e62(){var _0x492219=['You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','body','$product_details.secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','New_Qty_Converted_adj','room','flash','<!DOCTYPE\x20html>','$name','prod_name','purchases_data','/view/:id','random','Hindi','map','string','<div>','2663283hZUejn','adjust_qty','427TFTPgU','express','post','expiry_date','all','floor','Portuguese','$product_details.batch_code','findOne','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.primary_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','ADJF-','/preview/:id','status','Logo.png','/barcode_scanner','types','<h5\x20style=\x22text-align:\x20left;\x22>','split','7264989hcgXOg','exports','French','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details','email','site_title','108182yOqESi','redirect','$product_details.storage','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Spanish','filter','</h5>','\x20Order\x20Date\x20:\x20','language','success','$product_details.bay','English\x20(US)','7935059urgQuP','room_names','True','findById','Enclosed','$finalize','/view/add_adjustment','QA\x20Warehouse','9Djbxpb','add_adjustment_finished','$product','Rooms','Enabled','</table>','level','$product_details.unit','sendMail','$product_details.invoice','German','errors','log','$product_details.maxPerUnit','../models/all_models','host','Chinese','adjustment\x20data\x20update\x20successfully','product','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','port','New_Qty_Converted','<html><head><title></title>','$product.product_name','Finished\x20Goods','/adjustment_finished/preview/','$product_details.product_stock','padStart','4NSwhju','</span>','10oGUDjD','$product_details.bin','warehouse','getDate','prod_cat','get','push','edit_adjustment_finished_view','add','production_date','Portuguese\x20(BR)','$warehouse_name','adjustment_finished','<span\x20style=\x22float:\x20right;\x22>','$product_details.rack','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</head><body>','Arabic\x20(ae)','user','/../public','invoice','$product_details.type','slice','prod_invoice','role','render','/upload/','then','Secondary_units','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$product.room_names','product_details','product_code','nodemailer','$product_details.production_date','catch','toString','createTransport','$product_details.expiry_date','DRY\x20GOODS','/adjustment/view','edit_adjustment_finished','prod_code','params','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.product_name','batch_code','save','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</thead>','<h2>\x20','minus','secondary_unit','\x20</h2>','</td>','</body></html>','7033902gSlrbq','getFullYear','product_date','error','aggregate','json','master','FGSEmail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','</tr>','$product_details.floorlevel','</tbody>','$product_details.maxProducts','$product_details.secondary_code','$room','foreach\x20newproduct','81232EmLzgc','staff','<hr\x20class=\x22my-3\x22>','note','$invoice','$product_details.product_code','date','_id','stock','logo','An\x20error\x20occurred.','English','forEach','Error\x20Occurs','../public/language/languages.json','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','message','product_stock','$product_details._id','unit','warehouse_name','length','Return\x20Rooms','bay','Primary_Units','Ambient','maxPerUnit','</div>','499630ocwNjV','new_adjust_qty','product_name','/adjustment_finished/view'];a0_0x3e62=function(){return _0x492219;};return a0_0x3e62();}const express=require(a0_0xcabf89(0x1ec)),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0xcabf89(0x22c)),users=require(a0_0xcabf89(0x292)),nodemailer=require(a0_0xcabf89(0x25d));router[a0_0xcabf89(0x241)]('/view',auth,async(_0x512ec9,_0x2a23c8)=>{var _0x159157=a0_0xcabf89;try{const {username:_0x5eb0d,email:_0x3ecb3e,role:_0x21f468}=_0x512ec9[_0x159157(0x24e)],_0x5dc0ff=_0x512ec9['user'],_0x2e960a=await profile['findOne']({'email':_0x5dc0ff[_0x159157(0x207)]}),_0x320132=await master_shop['find']();let _0x2d9b74;if(_0x5dc0ff[_0x159157(0x254)]==_0x159157(0x285)){const _0x3f1cca=await staff[_0x159157(0x1f3)]({'email':_0x5dc0ff[_0x159157(0x207)]});_0x2d9b74=await warehouse[_0x159157(0x20c)]({'status':_0x159157(0x222),'name':_0x3f1cca[_0x159157(0x23e)]});}else _0x2d9b74=await warehouse['find']({'status':'Enabled'});const _0x5b45ca=await product[_0x159157(0x20c)]();let _0x488458;if(_0x5dc0ff['role']==_0x159157(0x285)){const _0x40901b=await staff[_0x159157(0x1f3)]({'email':_0x5dc0ff[_0x159157(0x207)]});_0x488458=await adjustment_finished[_0x159157(0x20c)]({'warehouse_name':_0x40901b['warehouse']});}else _0x488458=await adjustment_finished[_0x159157(0x278)]([{'$unwind':_0x159157(0x220)},{'$group':{'_id':'$_id','invoice':{'$first':_0x159157(0x288)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x159157(0x247)},'room':{'$addToSet':_0x159157(0x25a)},'finalize':{'$first':_0x159157(0x21b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x320132[0x0]['language']==_0x159157(0x215)){var _0x269847=users['English'];console[_0x159157(0x22a)](_0x269847);}else{if(_0x320132[0x0][_0x159157(0x212)]==_0x159157(0x1e5))var _0x269847=users[_0x159157(0x1e5)];else{if(_0x320132[0x0][_0x159157(0x212)]==_0x159157(0x228))var _0x269847=users[_0x159157(0x228)];else{if(_0x320132[0x0]['language']==_0x159157(0x20e))var _0x269847=users['Spanish'];else{if(_0x320132[0x0]['language']==_0x159157(0x204))var _0x269847=users[_0x159157(0x204)];else{if(_0x320132[0x0][_0x159157(0x212)]==_0x159157(0x246))var _0x269847=users[_0x159157(0x1f1)];else{if(_0x320132[0x0][_0x159157(0x212)]==_0x159157(0x22e))var _0x269847=users[_0x159157(0x22e)];else{if(_0x320132[0x0][_0x159157(0x212)]==_0x159157(0x24d))var _0x269847=users['Arabic'];}}}}}}}_0x2a23c8[_0x159157(0x255)](_0x159157(0x248),{'success':_0x512ec9[_0x159157(0x1de)](_0x159157(0x213)),'errors':_0x512ec9['flash'](_0x159157(0x229)),'role':_0x5dc0ff,'profile':_0x2e960a,'warehouse':_0x2d9b74,'product':_0x5b45ca,'adjustment':_0x488458,'master_shop':_0x320132,'language':_0x269847});}catch(_0x10fcb8){console[_0x159157(0x22a)](_0x10fcb8);}});function a0_0x4231(_0x7da74e,_0x5c1724){var _0x3e6257=a0_0x3e62();return a0_0x4231=function(_0x4231bc,_0x34080d){_0x4231bc=_0x4231bc-0x1d4;var _0x2e4d4e=_0x3e6257[_0x4231bc];return _0x2e4d4e;},a0_0x4231(_0x7da74e,_0x5c1724);}async function getRandom8DigitNumber(){var _0x158ebf=a0_0xcabf89;const _0x188ec2=0x989680,_0x3adb58=0x5f5e0ff,_0xd10756=Math[_0x158ebf(0x1f0)](Math[_0x158ebf(0x1e4)]()*(_0x3adb58-_0x188ec2+0x1))+_0x188ec2;var _0xfefb9d;const _0xab68d3=await adjustment_finished[_0x158ebf(0x1f3)]({'invoice':'ADJF-'+_0xd10756});return _0xab68d3&&_0xab68d3['length']>0x0?_0xfefb9d=_0x158ebf(0x1fa)+_0xd10756:_0xfefb9d=_0x158ebf(0x1fa)+_0xd10756,_0xfefb9d;}router[a0_0xcabf89(0x241)](a0_0xcabf89(0x21c),auth,async(_0x50f887,_0x525016)=>{var _0x23b439=a0_0xcabf89;try{const {username:_0x556d04,email:_0x27ca7e,role:_0x3b2def}=_0x50f887['user'],_0x342a5f=_0x50f887[_0x23b439(0x24e)],_0xdad95=await profile['findOne']({'email':_0x342a5f[_0x23b439(0x207)]}),_0x499273=await master_shop['find']();let _0x3129c2;if(_0x342a5f[_0x23b439(0x254)]==_0x23b439(0x285)){const _0x2866b7=await staff['findOne']({'email':_0x342a5f[_0x23b439(0x207)]});_0x3129c2=await warehouse[_0x23b439(0x278)]([{'$match':{'status':_0x23b439(0x222),'name':_0x2866b7[_0x23b439(0x23e)],'warehouse_category':_0x23b439(0x236),'name':{'$ne':_0x23b439(0x21d)}}},{'$group':{'_id':_0x23b439(0x1e0),'name':{'$first':_0x23b439(0x1e0)}}}]);}else _0x3129c2=await warehouse[_0x23b439(0x278)]([{'$match':{'status':'Enabled','warehouse_category':_0x23b439(0x236),'name':{'$ne':_0x23b439(0x21d)}}},{'$group':{'_id':_0x23b439(0x1e0),'name':{'$first':'$name'}}}]);const _0x4cc71e=await product[_0x23b439(0x20c)]({}),_0x21ebc9=await adjustment_finished[_0x23b439(0x20c)]({}),_0x212671=_0x21ebc9[_0x23b439(0x299)]+0x1,_0x47635c=_0x23b439(0x1fa)+_0x212671[_0x23b439(0x260)]()[_0x23b439(0x239)](0x5,'0');var _0x42c88a=[_0x23b439(0x29d),_0x23b439(0x21a),_0x23b439(0x29a)];if(_0x499273[0x0][_0x23b439(0x212)]==_0x23b439(0x215))var _0x526ea6=users[_0x23b439(0x28f)];else{if(_0x499273[0x0][_0x23b439(0x212)]=='Hindi')var _0x526ea6=users[_0x23b439(0x1e5)];else{if(_0x499273[0x0][_0x23b439(0x212)]=='German')var _0x526ea6=users['German'];else{if(_0x499273[0x0][_0x23b439(0x212)]==_0x23b439(0x20e))var _0x526ea6=users[_0x23b439(0x20e)];else{if(_0x499273[0x0]['language']==_0x23b439(0x204))var _0x526ea6=users[_0x23b439(0x204)];else{if(_0x499273[0x0][_0x23b439(0x212)]=='Portuguese\x20(BR)')var _0x526ea6=users['Portuguese'];else{if(_0x499273[0x0][_0x23b439(0x212)]=='Chinese')var _0x526ea6=users['Chinese'];else{if(_0x499273[0x0][_0x23b439(0x212)]=='Arabic\x20(ae)')var _0x526ea6=users['Arabic'];}}}}}}}const _0x587a7f=getRandom8DigitNumber();_0x587a7f['then'](_0x2df0f1=>{var _0x30c3a3=_0x23b439;_0x525016[_0x30c3a3(0x255)](_0x30c3a3(0x21f),{'success':_0x50f887[_0x30c3a3(0x1de)](_0x30c3a3(0x213)),'errors':_0x50f887[_0x30c3a3(0x1de)]('errors'),'role':_0x342a5f,'profile':_0xdad95,'warehouse':_0x3129c2,'product':_0x4cc71e,'master_shop':_0x499273,'language':_0x526ea6,'rooms_data':_0x42c88a,'invoice_no':_0x2df0f1});})[_0x23b439(0x25f)](_0x1ef672=>{var _0x148b1c=_0x23b439;_0x50f887['flash'](_0x148b1c(0x229),_0x148b1c(0x1f7)),_0x525016[_0x148b1c(0x20a)](_0x148b1c(0x264));});}catch(_0x1a67c4){console[_0x23b439(0x22a)](_0x1a67c4);}}),router['post']('/view/add_adjustment',auth,async(_0x4260c4,_0xaccfa)=>{var _0x21d21a=a0_0xcabf89;try{const {warehouse_name:_0x3ee83c,date:_0x46a636,prod_name:_0x2cba25,level:_0x44214c,isle:_0x49a731,pallet:_0x87c049,stock:_0x1ab4c0,types:_0x2fef0e,adjust_qty:_0x43ca3d,new_adjust_qty:_0x58d936,note:_0x1f921a,Room_name:_0x34aa92,invoice:_0x30399c,JO_number:_0x172b3b,expiry_date:_0x4acf9c}=_0x4260c4[_0x21d21a(0x1d9)];if(typeof _0x2cba25=='string')var _0x2479c5=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x1e1)]],_0x5379f4=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x224)]],_0x2e5f32=[_0x4260c4[_0x21d21a(0x1d9)]['stock']],_0x441146=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x1ff)]],_0x3f5e65=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x1dc)]],_0x3ec2e0=[_0x4260c4[_0x21d21a(0x1d9)]['New_Qty_Converted']],_0x20f751=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x29c)]],_0x1eb68b=[_0x4260c4[_0x21d21a(0x1d9)]['Secondary_units']],_0x1c5933=[_0x4260c4['body'][_0x21d21a(0x266)]],_0xe7cc44=[_0x4260c4['body'][_0x21d21a(0x26a)]],_0xa7c144=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x1ee)]],_0x547176=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x276)]],_0x61a612=[_0x4260c4['body']['prod_cat']],_0x172db5=[_0x4260c4[_0x21d21a(0x1d9)]['Rooms']],_0x3f8fb7=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x29e)]],_0x1368d5=[_0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x253)]];else var _0x2479c5=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x1e1)]],_0x5379f4=[..._0x4260c4['body'][_0x21d21a(0x224)]],_0x2e5f32=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x28c)]],_0x441146=[..._0x4260c4['body'][_0x21d21a(0x1ff)]],_0x3f5e65=[..._0x4260c4['body'][_0x21d21a(0x1dc)]],_0x3ec2e0=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x233)]],_0x20f751=[..._0x4260c4['body']['Primary_Units']],_0x1eb68b=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x258)]],_0x1c5933=[..._0x4260c4[_0x21d21a(0x1d9)]['prod_code']],_0xe7cc44=[..._0x4260c4['body']['batch_code']],_0xa7c144=[..._0x4260c4[_0x21d21a(0x1d9)]['expiry_date']],_0x547176=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x276)]],_0x61a612=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x240)]],_0x172db5=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x221)]],_0x3f8fb7=[..._0x4260c4[_0x21d21a(0x1d9)][_0x21d21a(0x29e)]],_0x1368d5=[..._0x4260c4['body']['prod_invoice']];const _0x5521c4=_0x2479c5[_0x21d21a(0x1e6)](_0x87a120=>{return _0x87a120={'product_name':_0x87a120};});_0x5379f4[_0x21d21a(0x290)]((_0x426bdb,_0x1648cd)=>{_0x5521c4[_0x1648cd]['bay']=_0x426bdb;}),_0x2e5f32[_0x21d21a(0x290)]((_0x5a6da4,_0x370362)=>{_0x5521c4[_0x370362]['stockBefore']=_0x5a6da4;}),_0x441146['forEach']((_0x3c7ba4,_0x302255)=>{_0x5521c4[_0x302255]['types']=_0x3c7ba4;}),_0x3f5e65[_0x21d21a(0x290)]((_0xb49844,_0x1ba8b2)=>{var _0x158de0=_0x21d21a;_0x5521c4[_0x1ba8b2][_0x158de0(0x1ea)]=_0xb49844;}),_0x3ec2e0[_0x21d21a(0x290)]((_0x1806b9,_0x51506f)=>{var _0x4023a8=_0x21d21a;_0x5521c4[_0x51506f][_0x4023a8(0x1d5)]=_0x1806b9;}),_0x20f751[_0x21d21a(0x290)]((_0x457996,_0x5207b4)=>{var _0x1b33b8=_0x21d21a;_0x5521c4[_0x5207b4][_0x1b33b8(0x297)]=_0x457996;}),_0x1eb68b[_0x21d21a(0x290)]((_0x40c5d0,_0x116bd5)=>{var _0x5dee11=_0x21d21a;_0x5521c4[_0x116bd5][_0x5dee11(0x270)]=_0x40c5d0;}),_0x1c5933['forEach']((_0x516f04,_0x59c7eb)=>{var _0x57ae1b=_0x21d21a;_0x5521c4[_0x59c7eb][_0x57ae1b(0x25c)]=_0x516f04;}),_0xe7cc44[_0x21d21a(0x290)]((_0xdc67e5,_0x16faed)=>{var _0x40ec78=_0x21d21a;_0x5521c4[_0x16faed][_0x40ec78(0x26a)]=_0xdc67e5;}),_0xa7c144[_0x21d21a(0x290)]((_0x34d9c9,_0xa3357a)=>{var _0x288a80=_0x21d21a;_0x5521c4[_0xa3357a][_0x288a80(0x1ee)]=_0x34d9c9;}),_0x547176[_0x21d21a(0x290)]((_0x12443c,_0x49987d)=>{var _0x3d912b=_0x21d21a;_0x5521c4[_0x49987d][_0x3d912b(0x245)]=_0x12443c;}),_0x61a612[_0x21d21a(0x290)]((_0x43026a,_0x43239c)=>{var _0x2c2e5b=_0x21d21a;_0x5521c4[_0x43239c][_0x2c2e5b(0x240)]=_0x43026a;}),_0x172db5[_0x21d21a(0x290)]((_0x5d2d0c,_0x5c86ae)=>{var _0x5bf076=_0x21d21a;_0x5521c4[_0x5c86ae][_0x5bf076(0x217)]=_0x5d2d0c;}),_0x3f8fb7[_0x21d21a(0x290)]((_0x7cd38f,_0x28f95f)=>{var _0x303a8e=_0x21d21a;_0x5521c4[_0x28f95f][_0x303a8e(0x29e)]=_0x7cd38f;}),_0x1368d5['forEach']((_0x1bcf48,_0x3f850f)=>{_0x5521c4[_0x3f850f]['invoice']=_0x1bcf48;});const _0x7823d5=_0x5521c4[_0x21d21a(0x20f)](_0x4f0a74=>_0x4f0a74[_0x21d21a(0x1ea)]!=='0'&&_0x4f0a74[_0x21d21a(0x1ea)]!=='');var _0x54c2ef=0x0;_0x7823d5[_0x21d21a(0x290)](_0x4098e2=>{var _0x1640b8=_0x21d21a;console[_0x1640b8(0x22a)](_0x1640b8(0x283),_0x4098e2),parseInt(_0x4098e2[_0x1640b8(0x1ea)])<=0x0&&_0x54c2ef++;});if(_0x54c2ef!=0x0)return _0x4260c4[_0x21d21a(0x1de)]('errors',_0x21d21a(0x1d8)),_0xaccfa[_0x21d21a(0x20a)]('back');const _0x425e80=new adjustment_finished({'warehouse_name':_0x3ee83c,'date':_0x46a636,'product':_0x7823d5,'note':_0x1f921a,'room':_0x34aa92,'invoice':_0x30399c,'JO_number':_0x172b3b,'expiry_date':_0x4acf9c}),_0x26d03f=await _0x425e80['save']();_0x4260c4[_0x21d21a(0x1de)](_0x21d21a(0x213),'adjustment\x20add\x20successfull'),_0xaccfa[_0x21d21a(0x20a)](_0x21d21a(0x237)+_0x26d03f[_0x21d21a(0x28b)]);}catch(_0x16e505){console['log'](_0x16e505),_0xaccfa[_0x21d21a(0x1fc)](0xc8)[_0x21d21a(0x279)]({'message':_0x16e505[_0x21d21a(0x294)]});}}),router['get'](a0_0xcabf89(0x1fb),auth,async(_0x464e01,_0x1386a9)=>{var _0x5e8dfe=a0_0xcabf89;try{const {username:_0x27e831,email:_0x23ef09,role:_0x523dfd}=_0x464e01[_0x5e8dfe(0x24e)],_0x1a90db=_0x464e01[_0x5e8dfe(0x24e)],_0x3ba370=await profile['findOne']({'email':_0x1a90db[_0x5e8dfe(0x207)]}),_0x4eae21=await master_shop[_0x5e8dfe(0x20c)](),_0x9b0c14=_0x464e01[_0x5e8dfe(0x267)]['id'],_0x3b6104=await adjustment_finished[_0x5e8dfe(0x219)]({'_id':_0x9b0c14}),_0x3ccd09=await purchases[_0x5e8dfe(0x278)]([{'$match':{'warehouse_name':_0x3b6104[_0x5e8dfe(0x298)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x5e8dfe(0x22a)]('purchases_data',_0x3ccd09);const _0x10e58b=await product[_0x5e8dfe(0x20c)]({}),_0x49d19e=await warehouse[_0x5e8dfe(0x278)]([{'$match':{'name':_0x3b6104[_0x5e8dfe(0x298)],'warehouse_category':_0x5e8dfe(0x236)}},{'$unwind':_0x5e8dfe(0x206)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x5e8dfe(0x269)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5e8dfe(0x214)},'bin':{'$first':_0x5e8dfe(0x23d)},'type':{'$first':_0x5e8dfe(0x251)},'floorlevel':{'$first':_0x5e8dfe(0x27e)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5e8dfe(0x281)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x5e8dfe(0x20b)},'rack':{'$first':_0x5e8dfe(0x24a)},'expiry_date':{'$first':_0x5e8dfe(0x262)},'production_date':{'$first':_0x5e8dfe(0x25e)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x5e8dfe(0x282)}}}]);if(_0x4eae21[0x0][_0x5e8dfe(0x212)]==_0x5e8dfe(0x215)){var _0x3dce19=users['English'];console[_0x5e8dfe(0x22a)](_0x3dce19);}else{if(_0x4eae21[0x0][_0x5e8dfe(0x212)]=='Hindi')var _0x3dce19=users[_0x5e8dfe(0x1e5)];else{if(_0x4eae21[0x0][_0x5e8dfe(0x212)]=='German')var _0x3dce19=users[_0x5e8dfe(0x228)];else{if(_0x4eae21[0x0]['language']==_0x5e8dfe(0x20e))var _0x3dce19=users[_0x5e8dfe(0x20e)];else{if(_0x4eae21[0x0][_0x5e8dfe(0x212)]==_0x5e8dfe(0x204))var _0x3dce19=users[_0x5e8dfe(0x204)];else{if(_0x4eae21[0x0][_0x5e8dfe(0x212)]==_0x5e8dfe(0x246))var _0x3dce19=users[_0x5e8dfe(0x1f1)];else{if(_0x4eae21[0x0]['language']==_0x5e8dfe(0x22e))var _0x3dce19=users[_0x5e8dfe(0x22e)];else{if(_0x4eae21[0x0]['language']=='Arabic\x20(ae)')var _0x3dce19=users['Arabic'];}}}}}}}_0x1386a9[_0x5e8dfe(0x255)](_0x5e8dfe(0x243),{'success':_0x464e01[_0x5e8dfe(0x1de)](_0x5e8dfe(0x213)),'errors':_0x464e01[_0x5e8dfe(0x1de)](_0x5e8dfe(0x229)),'role':_0x1a90db,'profile':_0x3ba370,'adjustment':_0x3b6104,'stock':_0x49d19e,'master_shop':_0x4eae21,'warehouse_name':_0x3ccd09,'unit':_0x10e58b,'language':_0x3dce19});}catch(_0x33f00){console[_0x5e8dfe(0x22a)](_0x33f00),_0x1386a9[_0x5e8dfe(0x1fc)](0xc8)[_0x5e8dfe(0x279)]({'message':_0x33f00[_0x5e8dfe(0x294)]});}}),router[a0_0xcabf89(0x1ed)](a0_0xcabf89(0x1fb),auth,async(_0x4859ff,_0x198e0f)=>{var _0x558af5=a0_0xcabf89;try{const {invoice:_0x4fcd42,warehouse_name:_0xcc294e,Room_name:_0x335f6b}=_0x4859ff[_0x558af5(0x1d9)],_0x1b4eed=_0x4859ff[_0x558af5(0x267)]['id'],_0xeca202=await adjustment_finished[_0x558af5(0x219)]({'_id':_0x1b4eed});var _0x14e0c6;const _0xe57194=_0xeca202['product'][_0x558af5(0x1e6)](async _0x50b13a=>{var _0x510e4f=_0x558af5;if(_0x50b13a[_0x510e4f(0x1ea)]>0x0){_0x14e0c6=await warehouse[_0x510e4f(0x1f3)]({'name':_0xcc294e,'room':_0x50b13a[_0x510e4f(0x217)],'warehouse_category':_0x510e4f(0x236)});const _0x2c56a5=_0x14e0c6[_0x510e4f(0x25b)]['map'](_0x35ca8b=>{var _0x1cac42=_0x510e4f;console['log'](_0x50b13a['types']);if(_0x50b13a[_0x1cac42(0x1ff)]==_0x1cac42(0x26f))_0x35ca8b[_0x1cac42(0x1d6)]==_0x50b13a[_0x1cac42(0x1d6)]&&_0x35ca8b[_0x1cac42(0x29b)]==_0x50b13a[_0x1cac42(0x29b)]&&_0x35ca8b[_0x1cac42(0x1ee)]==_0x50b13a['expiry_date']&&_0x35ca8b[_0x1cac42(0x245)]==_0x50b13a['production_date']&&_0x35ca8b[_0x1cac42(0x26a)]==_0x50b13a[_0x1cac42(0x26a)]&&_0x35ca8b['invoice']==_0x50b13a[_0x1cac42(0x250)]&&(_0x35ca8b[_0x1cac42(0x295)]=_0x35ca8b['product_stock']-_0x50b13a[_0x1cac42(0x1ea)]);else _0x50b13a[_0x1cac42(0x1ff)]==_0x1cac42(0x244)&&(_0x35ca8b[_0x1cac42(0x1d6)]==_0x50b13a['product_name']&&_0x35ca8b[_0x1cac42(0x29b)]==_0x50b13a[_0x1cac42(0x29b)]&&_0x35ca8b[_0x1cac42(0x1ee)]==_0x50b13a[_0x1cac42(0x1ee)]&&_0x35ca8b[_0x1cac42(0x245)]==_0x50b13a['production_date']&&_0x35ca8b['batch_code']==_0x50b13a['batch_code']&&_0x35ca8b['invoice']==_0x50b13a[_0x1cac42(0x250)]&&(_0x35ca8b['product_stock']=_0x35ca8b['product_stock']+_0x50b13a[_0x1cac42(0x1ea)]));});}return _0x14e0c6;});Promise[_0x558af5(0x1ef)](_0xe57194)[_0x558af5(0x257)](async _0x485599=>{var _0x5591b4=_0x558af5;try{for(const _0x38f143 of _0x485599){await _0x38f143[_0x5591b4(0x26b)]();}_0xeca202['finalize']=_0x5591b4(0x218);const _0x35ba83=await _0xeca202[_0x5591b4(0x26b)](),_0x127bd8=await master_shop[_0x5591b4(0x20c)](),_0x677aab=await email_settings[_0x5591b4(0x1f3)](),_0x502daf=await supervisor_settings[_0x5591b4(0x20c)]();var _0x3c8d7b=_0xeca202[_0x5591b4(0x230)],_0x381c41='',_0x4c626c;for(_0x4c626c in _0x3c8d7b){var _0x336a86='FG';_0xeca202[_0x5591b4(0x298)]==_0x5591b4(0x263)&&(_0x336a86='DG'),_0x381c41+=_0x5591b4(0x1f4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3c8d7b[_0x4c626c][_0x5591b4(0x1d6)]+_0x5591b4(0x272)+_0x5591b4(0x231)+_0x3c8d7b[_0x4c626c]['product_code']+'</td>'+_0x5591b4(0x231)+_0x3c8d7b[_0x4c626c][_0x5591b4(0x1ea)]+_0x5591b4(0x272)+_0x5591b4(0x231)+_0x3c8d7b[_0x4c626c][_0x5591b4(0x297)]+'</td>'+_0x5591b4(0x231)+_0x3c8d7b[_0x4c626c][_0x5591b4(0x270)]+_0x5591b4(0x272)+_0x5591b4(0x231)+_0xeca202[_0x5591b4(0x298)]+_0x5591b4(0x272)+_0x5591b4(0x231)+_0x3c8d7b[_0x4c626c][_0x5591b4(0x217)]+'</td>'+_0x5591b4(0x231)+_0x336a86+_0x3c8d7b[_0x4c626c][_0x5591b4(0x29b)]+_0x5591b4(0x272)+_0x5591b4(0x27d);}let _0x1c56f0=nodemailer[_0x5591b4(0x261)]({'host':_0x677aab[_0x5591b4(0x22d)],'port':Number(_0x677aab[_0x5591b4(0x232)]),'secure':![],'auth':{'user':_0x677aab[_0x5591b4(0x207)],'pass':_0x677aab['password']}}),_0x338ed1={'from':_0x677aab[_0x5591b4(0x207)],'to':_0x502daf[0x0][_0x5591b4(0x27b)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x5591b4(0x1fd),'path':__dirname+_0x5591b4(0x24f)+_0x5591b4(0x256)+_0x127bd8[0x0]['image'],'cid':_0x5591b4(0x28d)}],'html':_0x5591b4(0x1df)+_0x5591b4(0x234)+_0x5591b4(0x24c)+_0x5591b4(0x1e8)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5591b4(0x1e8)+_0x5591b4(0x293)+_0x5591b4(0x29f)+_0x5591b4(0x1e8)+_0x5591b4(0x26e)+_0x127bd8[0x0][_0x5591b4(0x208)]+_0x5591b4(0x271)+_0x5591b4(0x29f)+_0x5591b4(0x29f)+_0x5591b4(0x286)+_0x5591b4(0x1e8)+_0x5591b4(0x200)+'\x20Order\x20Number\x20:\x20'+_0xeca202[_0x5591b4(0x250)]+'\x20'+_0x5591b4(0x249)+_0x5591b4(0x211)+_0xeca202[_0x5591b4(0x28a)]+'\x20'+_0x5591b4(0x23b)+_0x5591b4(0x210)+_0x5591b4(0x29f)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5591b4(0x26c)+_0x5591b4(0x1f4)+_0x5591b4(0x20d)+_0x5591b4(0x259)+_0x5591b4(0x268)+_0x5591b4(0x27c)+_0x5591b4(0x1db)+_0x5591b4(0x24b)+_0x5591b4(0x1f5)+_0x5591b4(0x1f9)+_0x5591b4(0x27d)+_0x5591b4(0x26d)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x381c41+'\x20'+_0x5591b4(0x27f)+_0x5591b4(0x223)+_0x5591b4(0x1e8)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x127bd8[0x0][_0x5591b4(0x208)]+_0x5591b4(0x210)+_0x5591b4(0x29f)+'</div>'+_0x5591b4(0x273)};_0x1c56f0[_0x5591b4(0x226)](_0x338ed1,function(_0x164351,_0x3a0ebb){var _0x4583f7=_0x5591b4;_0x164351?(console['log'](_0x164351),console[_0x4583f7(0x22a)](_0x4583f7(0x291))):console['log']('Email\x20sent\x20successfully');}),_0x4859ff[_0x5591b4(0x1de)](_0x5591b4(0x213),'Adjustment\x20Finalize\x20Successfully'),_0x198e0f[_0x5591b4(0x20a)]('/picking_list/PDF_adjustment/'+_0x35ba83[_0x5591b4(0x28b)]);}catch(_0x3ef203){console[_0x5591b4(0x277)](_0x3ef203),_0x198e0f[_0x5591b4(0x1fc)](0x1f4)[_0x5591b4(0x279)]({'error':_0x5591b4(0x205)});}})['catch'](_0x3ae47c=>{var _0x474e00=_0x558af5;console['error'](_0x3ae47c),_0x198e0f[_0x474e00(0x1fc)](0x1f4)['json']({'error':_0x474e00(0x28e)});});}catch(_0x1fbdde){_0x198e0f[_0x558af5(0x279)]({'message':_0x1fbdde[_0x558af5(0x294)]});}}),router[a0_0xcabf89(0x241)](a0_0xcabf89(0x1e3),auth,async(_0x172439,_0x4b5910)=>{var _0x4b09ca=a0_0xcabf89;try{const {username:_0x4e521b,email:_0x5cde70,role:_0x5457bc}=_0x172439['user'],_0x433be8=_0x172439['user'],_0x5b594a=await profile['findOne']({'email':_0x433be8[_0x4b09ca(0x207)]}),_0x17ebd2=await master_shop[_0x4b09ca(0x20c)]();console['log'](_0x4b09ca(0x27a),_0x17ebd2);const _0x2c2f04=_0x172439[_0x4b09ca(0x267)]['id'],_0x57ccc4=await adjustment_finished[_0x4b09ca(0x219)]({'_id':_0x2c2f04});let _0x3680e5=new Date(_0x57ccc4[_0x4b09ca(0x1ee)]),_0x151a32=('0'+_0x3680e5[_0x4b09ca(0x23f)]())[_0x4b09ca(0x252)](-0x2),_0x46bb20=('0'+(_0x3680e5[_0x4b09ca(0x1f8)]()+0x1))[_0x4b09ca(0x252)](-0x2),_0x3c4262=_0x3680e5[_0x4b09ca(0x275)](),_0x2df6d3=_0x3c4262+'-'+_0x46bb20+'-'+_0x151a32;var _0x507295=[_0x4b09ca(0x29d),_0x4b09ca(0x21a),'Return\x20Rooms'];const _0x3628de=await purchases[_0x4b09ca(0x278)]([{'$match':{'warehouse_name':_0x57ccc4[_0x4b09ca(0x298)]}},{'$unwind':_0x4b09ca(0x220)},{'$group':{'_id':_0x4b09ca(0x235)}}]);console[_0x4b09ca(0x22a)](_0x4b09ca(0x1e2),_0x3628de);const _0x1abd9a=await product[_0x4b09ca(0x20c)]({}),_0x1d266f=await warehouse[_0x4b09ca(0x278)]([{'$match':{'name':_0x57ccc4[_0x4b09ca(0x298)],'room':_0x57ccc4[_0x4b09ca(0x1dd)]}},{'$unwind':_0x4b09ca(0x206)},{'$group':{'_id':_0x4b09ca(0x296),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4b09ca(0x238)},'bay':{'$first':_0x4b09ca(0x214)},'bin':{'$first':_0x4b09ca(0x23d)},'type':{'$first':_0x4b09ca(0x251)},'floorlevel':{'$first':_0x4b09ca(0x27e)},'primary_code':{'$first':_0x4b09ca(0x1f6)},'secondary_code':{'$first':_0x4b09ca(0x281)},'product_code':{'$first':_0x4b09ca(0x289)},'storage':{'$first':_0x4b09ca(0x20b)},'rack':{'$first':_0x4b09ca(0x24a)}}}]);if(_0x17ebd2[0x0]['language']==_0x4b09ca(0x215)){var _0xd4d0d0=users['English'];console[_0x4b09ca(0x22a)](_0xd4d0d0);}else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]==_0x4b09ca(0x1e5))var _0xd4d0d0=users[_0x4b09ca(0x1e5)];else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]=='German')var _0xd4d0d0=users['German'];else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]==_0x4b09ca(0x20e))var _0xd4d0d0=users[_0x4b09ca(0x20e)];else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]==_0x4b09ca(0x204))var _0xd4d0d0=users['French'];else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]==_0x4b09ca(0x246))var _0xd4d0d0=users[_0x4b09ca(0x1f1)];else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]=='Chinese')var _0xd4d0d0=users[_0x4b09ca(0x22e)];else{if(_0x17ebd2[0x0][_0x4b09ca(0x212)]==_0x4b09ca(0x24d))var _0xd4d0d0=users['Arabic'];}}}}}}}_0x4b5910[_0x4b09ca(0x255)](_0x4b09ca(0x265),{'success':_0x172439[_0x4b09ca(0x1de)]('success'),'errors':_0x172439[_0x4b09ca(0x1de)](_0x4b09ca(0x229)),'role':_0x433be8,'profile':_0x5b594a,'adjustment':_0x57ccc4,'stock':_0x1d266f,'master_shop':_0x17ebd2,'warehouse_name':_0x3628de,'unit':_0x1abd9a,'language':_0xd4d0d0,'rooms_data':_0x507295,'ed_fullDate':_0x2df6d3});}catch(_0x2bce96){console[_0x4b09ca(0x22a)](_0x2bce96),_0x4b5910[_0x4b09ca(0x1fc)](0xc8)[_0x4b09ca(0x279)]({'message':_0x2bce96[_0x4b09ca(0x294)]});}}),router[a0_0xcabf89(0x1ed)](a0_0xcabf89(0x1e3),auth,async(_0x3e5d84,_0x16a83f)=>{var _0x341d26=a0_0xcabf89;try{const _0x38f592=_0x3e5d84[_0x341d26(0x267)]['id'],_0x5633c7=await adjustment_finished[_0x341d26(0x219)]({'_id':_0x38f592}),_0x133e4a=await warehouse[_0x341d26(0x1f3)]({'name':_0x5633c7[_0x341d26(0x298)],'room':_0x5633c7[_0x341d26(0x1dd)]}),{warehouse_name:_0x52b779,date:_0x3ec74b,prod_name:_0x59a62b,level:_0x184e74,isle:_0x5eb8c3,pallet:_0x4be154,stock:_0x445764,types:_0xd10e71,adjust_qty:_0x2549c5,new_adjust_qty:_0x41cafb,note:_0x128053,Room_name:_0x1eb806,invoice:_0x4d0ca4,JO_number:_0x5300c8}=_0x3e5d84[_0x341d26(0x1d9)];if(typeof _0x59a62b==_0x341d26(0x1e7))var _0x22d5d0=[_0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x1e1)]],_0x53b7fe=[_0x3e5d84['body']['level']],_0x404180=[_0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x28c)]],_0x5b44ca=[_0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x1ff)]],_0x2bdc5d=[_0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x1ea)]],_0x27e92c=[_0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x1d5)]],_0x3fb504=[_0x3e5d84['body']['prod_code']],_0x3a57df=[_0x3e5d84['body'][_0x341d26(0x297)]],_0x5317e5=[_0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x258)]],_0x4d52c7=[_0x3e5d84['body'][_0x341d26(0x26a)]],_0x348f6e=[_0x3e5d84[_0x341d26(0x1d9)]['expiry_date']];else var _0x22d5d0=[..._0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x1e1)]],_0x53b7fe=[..._0x3e5d84['body'][_0x341d26(0x224)]],_0x404180=[..._0x3e5d84[_0x341d26(0x1d9)]['stock']],_0x5b44ca=[..._0x3e5d84[_0x341d26(0x1d9)]['types']],_0x2bdc5d=[..._0x3e5d84['body']['adjust_qty']],_0x27e92c=[..._0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x1d5)]],_0x3fb504=[..._0x3e5d84[_0x341d26(0x1d9)]['prod_code']],_0x3a57df=[..._0x3e5d84[_0x341d26(0x1d9)]['unit']],_0x5317e5=[..._0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x258)]],_0x4d52c7=[..._0x3e5d84[_0x341d26(0x1d9)][_0x341d26(0x26a)]],_0x348f6e=[..._0x3e5d84[_0x341d26(0x1d9)]['expiry_date']];const _0x1a768d=_0x22d5d0['map'](_0x1bbc4c=>{return _0x1bbc4c={'product_name':_0x1bbc4c};});_0x53b7fe['forEach']((_0x4ae918,_0x2b3251)=>{_0x1a768d[_0x2b3251]['bay']=_0x4ae918;}),_0x404180[_0x341d26(0x290)]((_0x5ec40f,_0xb4c36)=>{_0x1a768d[_0xb4c36]['stockBefore']=_0x5ec40f;}),_0x5b44ca[_0x341d26(0x290)]((_0x4dcb8e,_0x1068bd)=>{var _0x1ac92d=_0x341d26;_0x1a768d[_0x1068bd][_0x1ac92d(0x1ff)]=_0x4dcb8e;}),_0x2bdc5d[_0x341d26(0x290)]((_0x489e16,_0x1e8eda)=>{_0x1a768d[_0x1e8eda]['adjust_qty']=_0x489e16;}),_0x27e92c['forEach']((_0x295a56,_0x4104b6)=>{var _0x5b93cb=_0x341d26;_0x1a768d[_0x4104b6][_0x5b93cb(0x1d5)]=_0x295a56;}),_0x3a57df[_0x341d26(0x290)]((_0x5a8b6c,_0x324cd8)=>{var _0x1480c2=_0x341d26;_0x1a768d[_0x324cd8][_0x1480c2(0x297)]=_0x5a8b6c;}),_0x5317e5[_0x341d26(0x290)]((_0x2b55dc,_0x3c8023)=>{var _0x3b1f3c=_0x341d26;_0x1a768d[_0x3c8023][_0x3b1f3c(0x270)]=_0x2b55dc;}),_0x3fb504[_0x341d26(0x290)]((_0x539b4f,_0x314d09)=>{var _0x5ce691=_0x341d26;_0x1a768d[_0x314d09][_0x5ce691(0x25c)]=_0x539b4f;}),_0x4d52c7[_0x341d26(0x290)]((_0x3450dd,_0x5536b5)=>{var _0x1d8282=_0x341d26;_0x1a768d[_0x5536b5][_0x1d8282(0x26a)]=_0x3450dd;}),_0x348f6e[_0x341d26(0x290)]((_0x26d79f,_0x2a5428)=>{var _0x15c4c8=_0x341d26;_0x1a768d[_0x2a5428][_0x15c4c8(0x1ee)]=_0x26d79f;});const _0xc68af7=_0x1a768d[_0x341d26(0x20f)](_0x5bc66d=>_0x5bc66d[_0x341d26(0x1ea)]!=='0'&&_0x5bc66d[_0x341d26(0x1ea)]!=='');var _0x3e584f=0x0;_0xc68af7[_0x341d26(0x290)](_0x511bf7=>{var _0x577a9e=_0x341d26;console[_0x577a9e(0x22a)](_0x577a9e(0x283),_0x511bf7),parseInt(_0x511bf7[_0x577a9e(0x1ea)])<=0x0&&_0x3e584f++;});if(_0x3e584f!=0x0)return _0x3e5d84['flash'](_0x341d26(0x229),_0x341d26(0x1d8)),_0x16a83f[_0x341d26(0x20a)]('back');_0x5633c7['warehouse_name']=_0x52b779,_0x5633c7[_0x341d26(0x28a)]=_0x3ec74b,_0x5633c7[_0x341d26(0x230)]=_0xc68af7,_0x5633c7[_0x341d26(0x287)]=_0x128053,_0x5633c7['room']=_0x1eb806,_0x5633c7[_0x341d26(0x250)]=_0x4d0ca4,_0x5633c7['JO_number']=_0x5300c8;const _0x2eb6d8=await _0x5633c7[_0x341d26(0x26b)](),_0x384d42=await warehouse[_0x341d26(0x1f3)]({'name':_0x52b779,'room':_0x1eb806});_0x2eb6d8[_0x341d26(0x230)][_0x341d26(0x290)](_0x178bdb=>{var _0x5d373b=_0x341d26;const _0x310be2=_0x384d42[_0x5d373b(0x25b)][_0x5d373b(0x1e6)](_0x98b611=>{var _0x1fba5b=_0x5d373b;_0x178bdb[_0x1fba5b(0x1ff)]==_0x1fba5b(0x26f)?_0x98b611[_0x1fba5b(0x1d6)]==_0x178bdb[_0x1fba5b(0x1d6)]&&_0x98b611['bay']==_0x178bdb['bay']&&(_0x98b611[_0x1fba5b(0x295)]=parseInt(_0x98b611[_0x1fba5b(0x295)])-parseInt(_0x178bdb[_0x1fba5b(0x1ea)])):_0x98b611['product_name']==_0x178bdb[_0x1fba5b(0x1d6)]&&_0x98b611[_0x1fba5b(0x29b)]==_0x178bdb[_0x1fba5b(0x29b)]&&(_0x98b611[_0x1fba5b(0x295)]=parseInt(_0x98b611['product_stock'])+parseInt(_0x178bdb[_0x1fba5b(0x1ea)]));});}),await _0x384d42[_0x341d26(0x26b)](),_0x3e5d84[_0x341d26(0x1de)](_0x341d26(0x213),_0x341d26(0x22f)),_0x16a83f[_0x341d26(0x20a)](_0x341d26(0x1d7));}catch(_0x4d5a9f){console[_0x341d26(0x22a)](_0x4d5a9f);}}),router[a0_0xcabf89(0x1ed)](a0_0xcabf89(0x1fe),async(_0x56609d,_0x2ab67c)=>{var _0x4420f8=a0_0xcabf89;const {primary_code:_0x581a77,warehouse_data:_0x3b75f6,rooms_data:_0x2d9107,Roomslist:_0x408432}=_0x56609d['body'],_0x2f4df0=_0x408432[_0x4420f8(0x201)](','),_0x129ddc=[];async function _0x24c60a(_0x105eb7){var _0x500eb0=_0x4420f8;const _0x537196=await warehouse['aggregate']([{'$match':{'name':_0x3b75f6,'room':_0x105eb7}},{'$unwind':_0x500eb0(0x206)},{'$match':{'product_details.primary_code':_0x581a77}},{'$group':{'_id':_0x500eb0(0x296),'name':{'$first':_0x500eb0(0x269)},'product_stock':{'$first':_0x500eb0(0x238)},'primary_code':{'$first':_0x500eb0(0x1f6)},'secondary_code':{'$first':_0x500eb0(0x281)},'product_code':{'$first':_0x500eb0(0x289)},'level':{'$first':_0x500eb0(0x214)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x500eb0(0x251)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x500eb0(0x225)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x500eb0(0x20b)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x500eb0(0x262)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x500eb0(0x1f2)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x500eb0(0x22b)},'roomNamed':{'$first':_0x500eb0(0x282)},'invoice':{'$first':_0x500eb0(0x227)}}}]),_0x70f461=await warehouse[_0x500eb0(0x278)]([{'$match':{'name':_0x3b75f6,'room':_0x105eb7}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x581a77}},{'$group':{'_id':_0x500eb0(0x296),'name':{'$first':_0x500eb0(0x269)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x500eb0(0x1f6)},'secondary_code':{'$first':_0x500eb0(0x281)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x500eb0(0x214)},'isle':{'$first':_0x500eb0(0x23d)},'type':{'$first':_0x500eb0(0x251)},'pallet':{'$first':_0x500eb0(0x27e)},'unit':{'$first':_0x500eb0(0x225)},'secondary_unit':{'$first':_0x500eb0(0x1da)},'storage':{'$first':_0x500eb0(0x20b)},'rack':{'$first':_0x500eb0(0x24a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x500eb0(0x25e)},'batch_code':{'$first':_0x500eb0(0x1f2)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x500eb0(0x282)},'invoice':{'$first':_0x500eb0(0x227)}}}]);if(_0x537196[_0x500eb0(0x299)]>0x0)_0x129ddc[_0x500eb0(0x242)](_0x537196);else _0x70f461[_0x500eb0(0x299)]>0x0&&_0x129ddc[_0x500eb0(0x242)](_0x70f461);}const _0x34c6b5=_0x2f4df0['map'](_0x2f5feb=>_0x24c60a(_0x2f5feb));await Promise[_0x4420f8(0x1ef)](_0x34c6b5),_0x2ab67c[_0x4420f8(0x279)](_0x129ddc);}),router['post']('/CheckingWarehouse',async(_0x1eb321,_0x253c88)=>{var _0x10e996=a0_0xcabf89;const {productCode:_0x523b02,bay:_0x2a8d8d,warehouses:_0x5a2355,room:_0x2a86de}=_0x1eb321[_0x10e996(0x1d9)];console[_0x10e996(0x22a)](_0x1eb321[_0x10e996(0x1d9)]);try{const _0x38b431=await warehouse['aggregate']([{'$match':{'name':_0x5a2355,'room':_0x2a86de}},{'$unwind':_0x10e996(0x206)},{'$match':{'product_details.bay':parseInt(_0x2a8d8d)}},{'$group':{'_id':_0x10e996(0x296),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x10e996(0x280)}}}]);_0x253c88['status'](0xc8)[_0x10e996(0x279)](_0x38b431);}catch(_0x1e84f3){_0x253c88[_0x10e996(0x1fc)](0x194)['json']({'message':_0x1e84f3[_0x10e996(0x294)]});}}),module[a0_0xcabf89(0x203)]=router;