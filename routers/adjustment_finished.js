var a0_0x4dfc50=a0_0x1dfa;(function(_0x4a9fe8,_0x3b72e9){var _0x32714e=a0_0x1dfa,_0x3b7673=_0x4a9fe8();while(!![]){try{var _0x1bc387=-parseInt(_0x32714e(0x92))/0x1*(-parseInt(_0x32714e(0xa2))/0x2)+-parseInt(_0x32714e(0xa9))/0x3*(parseInt(_0x32714e(0xfa))/0x4)+parseInt(_0x32714e(0x12c))/0x5*(parseInt(_0x32714e(0xaf))/0x6)+-parseInt(_0x32714e(0xba))/0x7+-parseInt(_0x32714e(0xd0))/0x8+parseInt(_0x32714e(0xf5))/0x9+-parseInt(_0x32714e(0x14c))/0xa*(parseInt(_0x32714e(0x11d))/0xb);if(_0x1bc387===_0x3b72e9)break;else _0x3b7673['push'](_0x3b7673['shift']());}catch(_0x1c34e3){_0x3b7673['push'](_0x3b7673['shift']());}}}(a0_0x7671,0xa0e97));const express=require(a0_0x4dfc50(0x8c)),app=express(),router=express['Router'](),auth=require(a0_0x4dfc50(0xcd)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x4dfc50(0xc0)),users=require(a0_0x4dfc50(0xb1)),nodemailer=require(a0_0x4dfc50(0x10e));router['get']('/view',auth,async(_0x260f2c,_0x4c2d11)=>{var _0x3f59ae=a0_0x4dfc50;try{const {username:_0x5b6937,email:_0x5d9d3f,role:_0x22424b}=_0x260f2c['user'],_0x123b11=_0x260f2c[_0x3f59ae(0xe3)],_0x327acd=await profile[_0x3f59ae(0x89)]({'email':_0x123b11[_0x3f59ae(0x113)]}),_0x2e761c=await master_shop['find']();let _0x49d9bd;if(_0x123b11['role']==_0x3f59ae(0x134)){const _0x360127=await staff['findOne']({'email':_0x123b11['email']});_0x49d9bd=await warehouse[_0x3f59ae(0x103)]({'status':_0x3f59ae(0x125),'name':_0x360127[_0x3f59ae(0xc5)]});}else _0x49d9bd=await warehouse[_0x3f59ae(0x103)]({'status':_0x3f59ae(0x125)});const _0x57ecc3=await product[_0x3f59ae(0x103)]();let _0x5c47a4;if(_0x123b11[_0x3f59ae(0xfe)]==_0x3f59ae(0x134)){const _0x1ba87c=await staff[_0x3f59ae(0x89)]({'email':_0x123b11[_0x3f59ae(0x113)]});_0x5c47a4=await adjustment_finished[_0x3f59ae(0x103)]({'warehouse_name':_0x1ba87c['warehouse']});}else _0x5c47a4=await adjustment_finished[_0x3f59ae(0xab)]([{'$unwind':_0x3f59ae(0xb5)},{'$group':{'_id':_0x3f59ae(0xd5),'invoice':{'$first':'$invoice'},'date':{'$first':_0x3f59ae(0x132)},'warehouse_name':{'$first':_0x3f59ae(0x12d)},'room':{'$addToSet':_0x3f59ae(0x123)},'finalize':{'$first':_0x3f59ae(0xbe)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x2e761c[0x0]['language']==_0x3f59ae(0x11c)){var _0x5796f3=users[_0x3f59ae(0x128)];console['log'](_0x5796f3);}else{if(_0x2e761c[0x0][_0x3f59ae(0x141)]==_0x3f59ae(0xcc))var _0x5796f3=users[_0x3f59ae(0xcc)];else{if(_0x2e761c[0x0][_0x3f59ae(0x141)]=='German')var _0x5796f3=users[_0x3f59ae(0x94)];else{if(_0x2e761c[0x0]['language']==_0x3f59ae(0x142))var _0x5796f3=users[_0x3f59ae(0x142)];else{if(_0x2e761c[0x0]['language']==_0x3f59ae(0x138))var _0x5796f3=users['French'];else{if(_0x2e761c[0x0][_0x3f59ae(0x141)]==_0x3f59ae(0x10d))var _0x5796f3=users[_0x3f59ae(0xf2)];else{if(_0x2e761c[0x0][_0x3f59ae(0x141)]==_0x3f59ae(0x9b))var _0x5796f3=users[_0x3f59ae(0x9b)];else{if(_0x2e761c[0x0][_0x3f59ae(0x141)]=='Arabic\x20(ae)')var _0x5796f3=users[_0x3f59ae(0x149)];}}}}}}}_0x4c2d11[_0x3f59ae(0xa8)](_0x3f59ae(0xea),{'success':_0x260f2c[_0x3f59ae(0xe9)]('success'),'errors':_0x260f2c[_0x3f59ae(0xe9)](_0x3f59ae(0xd4)),'role':_0x123b11,'profile':_0x327acd,'warehouse':_0x49d9bd,'product':_0x57ecc3,'adjustment':_0x5c47a4,'master_shop':_0x2e761c,'language':_0x5796f3});}catch(_0x29a39b){console['log'](_0x29a39b);}});function a0_0x1dfa(_0x23b521,_0xdfaac0){var _0x7671c9=a0_0x7671();return a0_0x1dfa=function(_0x1dfa67,_0x5ad594){_0x1dfa67=_0x1dfa67-0x87;var _0x3a827b=_0x7671c9[_0x1dfa67];return _0x3a827b;},a0_0x1dfa(_0x23b521,_0xdfaac0);}function a0_0x7671(){var _0x1fe6ae=['adjustment\x20add\x20successfull','DRY\x20GOODS','invoice','warehouse','error','length','True','getFullYear','warehouse_name','product_details','Hindi','../middleware/auth','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','39936WXentP','unit','message','map','errors','$_id','<h2>\x20','Primary_Units','New_Qty_Converted_adj','Arabic\x20(ae)','Enclosed','params','all','redirect','Email\x20sent\x20successfully','</div>','$product_details.product_code','</head><body>','FGSEmail','user','$product_details.product_name','/picking_list/PDF_adjustment/','$product_details.bin','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','An\x20error\x20occurred\x20while\x20saving\x20data.','flash','adjustment_finished','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.product_stock','padStart','JO_number','$product_details.maxPerUnit','product_date','QA\x20Warehouse','Portuguese','stock','An\x20error\x20occurred.','9508671DSBYrj','$product_details','save','logo','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','24ykzmNv','add_adjustment_finished','then','filter','role','$product_details.primary_code','prod_code','$product_details.rack','/upload/','find','<tbody\x20style=\x22text-align:\x20center;\x22>','<strong>\x20Regards\x20</strong>','Secondary_units','toString','product_stock','Logo.png','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','\x20</h2>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Portuguese\x20(BR)','nodemailer','/CheckingWarehouse','</span>','add','</td>','email','New_Qty_Converted','catch','$room','product_name','batch_code','back','room','prod_name','English\x20(US)','165GvBvGF','log','/../public','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','date','$product_details.floorlevel','$product.room_names','maxPerUnit','Enabled','<span\x20style=\x22float:\x20right;\x22>','json','English','Rooms','/preview/:id','\x20Order\x20Number\x20:\x20','425GgPRQm','$warehouse_name','new_adjust_qty','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','\x20Order\x20Date\x20:\x20','$product_details.expiry_date','$date','string','staff','$product_details.batch_code','$product_details._id','$product_details.type','French','adjust_qty','/adjustment_finished/view','$product_details.storage','</h5>','split','_id','Ambient','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','language','Spanish','get','<!DOCTYPE\x20html>','/adjustment_finished/preview/','types','success','$product_details.unit','Arabic','<div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','38610SeTfCw','<table\x20style=\x22width:\x20100%\x20!important;\x22>','findById','$product.product_name','production_date','Error\x20Occurs','secondary_unit','findOne','/view/:id','body','express','push','$name','bay','forEach','getMonth','5cBCORz','level','German','<tr>','<h5>','getDate','createTransport','</body></html>','Finished\x20Goods','Chinese','$product_details.production_date','$product_details.maxProducts','port','/adjustment/view','expiry_date','$product_details.secondary_code','52566oAbYYd','$product_details.bay','host','foreach\x20newproduct','$product_details.secondary_unit','finalize','render','551013TwQRjF','status','aggregate','site_title','room_names','floor','92232YEtWjZ','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','../public/language/languages.json','Adjustment\x20Finalize\x20Successfully','Return\x20Rooms','ADJF-','$product','random','prod_invoice','post','purchases_data','4693682IHNSmT','prod_cat','product_code','</table>','$finalize','</tbody>','../models/all_models','$product_details.invoice'];a0_0x7671=function(){return _0x1fe6ae;};return a0_0x7671();}async function getRandom8DigitNumber(){var _0x4a6003=a0_0x4dfc50;const _0x3acafc=0x989680,_0x5a816a=0x5f5e0ff,_0x1a7c72=Math[_0x4a6003(0xae)](Math[_0x4a6003(0xb6)]()*(_0x5a816a-_0x3acafc+0x1))+_0x3acafc;var _0xe0530f;const _0x3a4bd5=await adjustment_finished[_0x4a6003(0x89)]({'invoice':_0x4a6003(0xb4)+_0x1a7c72});return _0x3a4bd5&&_0x3a4bd5['length']>0x0?_0xe0530f='ADJF-'+_0x1a7c72:_0xe0530f='ADJF-'+_0x1a7c72,_0xe0530f;}router[a0_0x4dfc50(0x143)]('/view/add_adjustment',auth,async(_0x22d228,_0xd16cff)=>{var _0x3bc822=a0_0x4dfc50;try{const {username:_0x294e34,email:_0x399723,role:_0x16ab18}=_0x22d228[_0x3bc822(0xe3)],_0x41820f=_0x22d228['user'],_0x317b6b=await profile[_0x3bc822(0x89)]({'email':_0x41820f[_0x3bc822(0x113)]}),_0x475b34=await master_shop[_0x3bc822(0x103)]();let _0x366cc4;if(_0x41820f[_0x3bc822(0xfe)]==_0x3bc822(0x134)){const _0x3c5f93=await staff[_0x3bc822(0x89)]({'email':_0x41820f[_0x3bc822(0x113)]});_0x366cc4=await warehouse[_0x3bc822(0xab)]([{'$match':{'status':_0x3bc822(0x125),'name':_0x3c5f93['warehouse'],'warehouse_category':_0x3bc822(0x9a),'name':{'$ne':_0x3bc822(0xf1)}}},{'$group':{'_id':'$name','name':{'$first':_0x3bc822(0x8e)}}}]);}else _0x366cc4=await warehouse[_0x3bc822(0xab)]([{'$match':{'status':_0x3bc822(0x125),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x3bc822(0xf1)}}},{'$group':{'_id':_0x3bc822(0x8e),'name':{'$first':_0x3bc822(0x8e)}}}]);const _0x4575d2=await product['find']({}),_0x3ae57f=await adjustment_finished[_0x3bc822(0x103)]({}),_0x3bc18b=_0x3ae57f[_0x3bc822(0xc7)]+0x1,_0x21a318=_0x3bc822(0xb4)+_0x3bc18b[_0x3bc822(0x107)]()[_0x3bc822(0xed)](0x5,'0');var _0x18cac9=[_0x3bc822(0x13f),'Enclosed',_0x3bc822(0xb3)];if(_0x475b34[0x0][_0x3bc822(0x141)]=='English\x20(US)')var _0x2197b6=users['English'];else{if(_0x475b34[0x0][_0x3bc822(0x141)]==_0x3bc822(0xcc))var _0x2197b6=users[_0x3bc822(0xcc)];else{if(_0x475b34[0x0][_0x3bc822(0x141)]==_0x3bc822(0x94))var _0x2197b6=users[_0x3bc822(0x94)];else{if(_0x475b34[0x0][_0x3bc822(0x141)]==_0x3bc822(0x142))var _0x2197b6=users[_0x3bc822(0x142)];else{if(_0x475b34[0x0]['language']=='French')var _0x2197b6=users[_0x3bc822(0x138)];else{if(_0x475b34[0x0]['language']==_0x3bc822(0x10d))var _0x2197b6=users[_0x3bc822(0xf2)];else{if(_0x475b34[0x0][_0x3bc822(0x141)]==_0x3bc822(0x9b))var _0x2197b6=users[_0x3bc822(0x9b)];else{if(_0x475b34[0x0][_0x3bc822(0x141)]==_0x3bc822(0xd9))var _0x2197b6=users[_0x3bc822(0x149)];}}}}}}}const _0x2f033a=getRandom8DigitNumber();_0x2f033a['then'](_0x36eb55=>{var _0x12e42d=_0x3bc822;_0xd16cff[_0x12e42d(0xa8)](_0x12e42d(0xfb),{'success':_0x22d228[_0x12e42d(0xe9)](_0x12e42d(0x147)),'errors':_0x22d228[_0x12e42d(0xe9)](_0x12e42d(0xd4)),'role':_0x41820f,'profile':_0x317b6b,'warehouse':_0x366cc4,'product':_0x4575d2,'master_shop':_0x475b34,'language':_0x2197b6,'rooms_data':_0x18cac9,'invoice_no':_0x36eb55});})[_0x3bc822(0x115)](_0x173f46=>{var _0x543432=_0x3bc822;_0x22d228[_0x543432(0xe9)](_0x543432(0xd4),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0xd16cff[_0x543432(0xdd)](_0x543432(0x9f));});}catch(_0x220600){console[_0x3bc822(0x11e)](_0x220600);}}),router[a0_0x4dfc50(0xb8)]('/view/add_adjustment',auth,async(_0x5ade0a,_0x5a0f78)=>{var _0x49674d=a0_0x4dfc50;try{const {warehouse_name:_0x229856,date:_0x52f0cc,prod_name:_0x36524c,level:_0x108d30,isle:_0x5d7d6e,pallet:_0x405d55,stock:_0x4667d6,types:_0x56f359,adjust_qty:_0x4e7ddc,new_adjust_qty:_0x4e9f23,note:_0x194a5b,Room_name:_0x823ae8,invoice:_0x404e74,JO_number:_0x4a8847,expiry_date:_0x54734a}=_0x5ade0a[_0x49674d(0x8b)];if(typeof _0x36524c==_0x49674d(0x133))var _0x4059be=[_0x5ade0a['body'][_0x49674d(0x11b)]],_0x26e647=[_0x5ade0a['body'][_0x49674d(0x93)]],_0xc688e6=[_0x5ade0a[_0x49674d(0x8b)][_0x49674d(0xf3)]],_0x517447=[_0x5ade0a['body']['types']],_0x2d840c=[_0x5ade0a['body'][_0x49674d(0xd8)]],_0xb87760=[_0x5ade0a['body'][_0x49674d(0x114)]],_0x543508=[_0x5ade0a['body'][_0x49674d(0xd7)]],_0x471e96=[_0x5ade0a['body']['Secondary_units']],_0x99699d=[_0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x100)]],_0x32139f=[_0x5ade0a['body'][_0x49674d(0x118)]],_0x393709=[_0x5ade0a[_0x49674d(0x8b)][_0x49674d(0xa0)]],_0x4544b3=[_0x5ade0a['body'][_0x49674d(0xf0)]],_0x2ecb9e=[_0x5ade0a['body'][_0x49674d(0xbb)]],_0x1da3a3=[_0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x129)]],_0x4fcbce=[_0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x124)]],_0x4544f7=[_0x5ade0a[_0x49674d(0x8b)][_0x49674d(0xb7)]];else var _0x4059be=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x11b)]],_0x26e647=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x93)]],_0xc688e6=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0xf3)]],_0x517447=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x146)]],_0x2d840c=[..._0x5ade0a[_0x49674d(0x8b)]['New_Qty_Converted_adj']],_0xb87760=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x114)]],_0x543508=[..._0x5ade0a[_0x49674d(0x8b)]['Primary_Units']],_0x471e96=[..._0x5ade0a[_0x49674d(0x8b)]['Secondary_units']],_0x99699d=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x100)]],_0x32139f=[..._0x5ade0a['body'][_0x49674d(0x118)]],_0x393709=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0xa0)]],_0x4544b3=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0xf0)]],_0x2ecb9e=[..._0x5ade0a[_0x49674d(0x8b)]['prod_cat']],_0x1da3a3=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x129)]],_0x4fcbce=[..._0x5ade0a[_0x49674d(0x8b)][_0x49674d(0x124)]],_0x4544f7=[..._0x5ade0a['body'][_0x49674d(0xb7)]];const _0x2d6901=_0x4059be[_0x49674d(0xd3)](_0x3326fd=>{return _0x3326fd={'product_name':_0x3326fd};});_0x26e647['forEach']((_0x382aec,_0x350d9d)=>{var _0x1f7e09=_0x49674d;_0x2d6901[_0x350d9d][_0x1f7e09(0x8f)]=_0x382aec;}),_0xc688e6[_0x49674d(0x90)]((_0x4a0b93,_0x3671ef)=>{_0x2d6901[_0x3671ef]['stockBefore']=_0x4a0b93;}),_0x517447[_0x49674d(0x90)]((_0x5f4417,_0x5a19fe)=>{var _0x1a9879=_0x49674d;_0x2d6901[_0x5a19fe][_0x1a9879(0x146)]=_0x5f4417;}),_0x2d840c['forEach']((_0x3e6fe1,_0x1e07bc)=>{_0x2d6901[_0x1e07bc]['adjust_qty']=_0x3e6fe1;}),_0xb87760[_0x49674d(0x90)]((_0x39f55e,_0x497940)=>{_0x2d6901[_0x497940]['new_adjust_qty']=_0x39f55e;}),_0x543508[_0x49674d(0x90)]((_0x563ae2,_0x232a08)=>{_0x2d6901[_0x232a08]['unit']=_0x563ae2;}),_0x471e96['forEach']((_0x3687d5,_0x1a2c4c)=>{_0x2d6901[_0x1a2c4c]['secondary_unit']=_0x3687d5;}),_0x99699d[_0x49674d(0x90)]((_0x35ed7b,_0x64c871)=>{var _0x3bf01d=_0x49674d;_0x2d6901[_0x64c871][_0x3bf01d(0xbc)]=_0x35ed7b;}),_0x32139f[_0x49674d(0x90)]((_0x5ccdba,_0x15a390)=>{_0x2d6901[_0x15a390]['batch_code']=_0x5ccdba;}),_0x393709['forEach']((_0x2e9975,_0x286097)=>{var _0x438f39=_0x49674d;_0x2d6901[_0x286097][_0x438f39(0xa0)]=_0x2e9975;}),_0x4544b3[_0x49674d(0x90)]((_0x4f9b4a,_0x9a9bd5)=>{var _0x50cf44=_0x49674d;_0x2d6901[_0x9a9bd5][_0x50cf44(0x150)]=_0x4f9b4a;}),_0x2ecb9e[_0x49674d(0x90)]((_0x1122f0,_0x5d5235)=>{var _0x3d7b70=_0x49674d;_0x2d6901[_0x5d5235][_0x3d7b70(0xbb)]=_0x1122f0;}),_0x1da3a3[_0x49674d(0x90)]((_0x5286b5,_0x48fdf2)=>{_0x2d6901[_0x48fdf2]['room_names']=_0x5286b5;}),_0x4fcbce[_0x49674d(0x90)]((_0x5b350e,_0x4a9404)=>{var _0x41dc94=_0x49674d;_0x2d6901[_0x4a9404][_0x41dc94(0x124)]=_0x5b350e;}),_0x4544f7[_0x49674d(0x90)]((_0x52d258,_0x4591b6)=>{var _0x3a8725=_0x49674d;_0x2d6901[_0x4591b6][_0x3a8725(0xc4)]=_0x52d258;});const _0x789a3e=_0x2d6901['filter'](_0x2e9ac4=>_0x2e9ac4['adjust_qty']!=='0'&&_0x2e9ac4[_0x49674d(0x139)]!=='');var _0x41e0e4=0x0;_0x789a3e['forEach'](_0x2a2146=>{var _0xcb3f6c=_0x49674d;console[_0xcb3f6c(0x11e)](_0xcb3f6c(0xa5),_0x2a2146),parseInt(_0x2a2146[_0xcb3f6c(0x139)])<=0x0&&_0x41e0e4++;});if(_0x41e0e4!=0x0)return _0x5ade0a[_0x49674d(0xe9)](_0x49674d(0xd4),_0x49674d(0xb0)),_0x5a0f78[_0x49674d(0xdd)](_0x49674d(0x119));const _0x58d22c=new adjustment_finished({'warehouse_name':_0x229856,'date':_0x52f0cc,'product':_0x789a3e,'note':_0x194a5b,'room':_0x823ae8,'invoice':_0x404e74,'JO_number':_0x4a8847,'expiry_date':_0x54734a}),_0x531707=await _0x58d22c[_0x49674d(0xf7)]();_0x5ade0a[_0x49674d(0xe9)]('success',_0x49674d(0xc2)),_0x5a0f78[_0x49674d(0xdd)](_0x49674d(0x145)+_0x531707[_0x49674d(0x13e)]);}catch(_0x5c1cea){console[_0x49674d(0x11e)](_0x5c1cea),_0x5a0f78['status'](0xc8)['json']({'message':_0x5c1cea[_0x49674d(0xd2)]});}}),router['get'](a0_0x4dfc50(0x12a),auth,async(_0x2123c4,_0x1a0488)=>{var _0x645541=a0_0x4dfc50;try{const {username:_0x6b205d,email:_0x3065a5,role:_0x4fd2f7}=_0x2123c4['user'],_0xf336c=_0x2123c4['user'],_0x10b15b=await profile[_0x645541(0x89)]({'email':_0xf336c[_0x645541(0x113)]}),_0x1e703c=await master_shop[_0x645541(0x103)](),_0x5a2377=_0x2123c4[_0x645541(0xdb)]['id'],_0x2e9d2d=await adjustment_finished[_0x645541(0x14e)]({'_id':_0x5a2377}),_0x2656bd=await purchases[_0x645541(0xab)]([{'$match':{'warehouse_name':_0x2e9d2d[_0x645541(0xca)]}},{'$unwind':'$product'},{'$group':{'_id':_0x645541(0x14f)}}]);console[_0x645541(0x11e)](_0x645541(0xb9),_0x2656bd);const _0x5ac52d=await product['find']({}),_0xae8dc1=await warehouse['aggregate']([{'$match':{'name':_0x2e9d2d['warehouse_name'],'warehouse_category':_0x645541(0x9a)}},{'$unwind':_0x645541(0xf6)},{'$group':{'_id':_0x645541(0x136),'name':{'$first':_0x645541(0xe4)},'product_stock':{'$first':_0x645541(0xec)},'bay':{'$first':_0x645541(0xa3)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x645541(0x137)},'floorlevel':{'$first':_0x645541(0x122)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x645541(0xa1)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x645541(0x13b)},'rack':{'$first':_0x645541(0x101)},'expiry_date':{'$first':_0x645541(0x131)},'production_date':{'$first':_0x645541(0x9c)},'batch_code':{'$first':_0x645541(0x135)},'maxPerUnit':{'$first':_0x645541(0xef)},'room':{'$first':_0x645541(0x116)}}}]);if(_0x1e703c[0x0]['language']==_0x645541(0x11c)){var _0x44098b=users[_0x645541(0x128)];console[_0x645541(0x11e)](_0x44098b);}else{if(_0x1e703c[0x0][_0x645541(0x141)]==_0x645541(0xcc))var _0x44098b=users[_0x645541(0xcc)];else{if(_0x1e703c[0x0]['language']=='German')var _0x44098b=users[_0x645541(0x94)];else{if(_0x1e703c[0x0][_0x645541(0x141)]==_0x645541(0x142))var _0x44098b=users[_0x645541(0x142)];else{if(_0x1e703c[0x0][_0x645541(0x141)]==_0x645541(0x138))var _0x44098b=users['French'];else{if(_0x1e703c[0x0]['language']==_0x645541(0x10d))var _0x44098b=users['Portuguese'];else{if(_0x1e703c[0x0][_0x645541(0x141)]==_0x645541(0x9b))var _0x44098b=users['Chinese'];else{if(_0x1e703c[0x0][_0x645541(0x141)]==_0x645541(0xd9))var _0x44098b=users[_0x645541(0x149)];}}}}}}}_0x1a0488[_0x645541(0xa8)]('edit_adjustment_finished_view',{'success':_0x2123c4[_0x645541(0xe9)](_0x645541(0x147)),'errors':_0x2123c4[_0x645541(0xe9)](_0x645541(0xd4)),'role':_0xf336c,'profile':_0x10b15b,'adjustment':_0x2e9d2d,'stock':_0xae8dc1,'master_shop':_0x1e703c,'warehouse_name':_0x2656bd,'unit':_0x5ac52d,'language':_0x44098b});}catch(_0x2e4654){console['log'](_0x2e4654),_0x1a0488[_0x645541(0xaa)](0xc8)[_0x645541(0x127)]({'message':_0x2e4654[_0x645541(0xd2)]});}}),router[a0_0x4dfc50(0xb8)](a0_0x4dfc50(0x12a),auth,async(_0x237db7,_0x4b93da)=>{var _0x50775a=a0_0x4dfc50;try{const {invoice:_0x273c25,warehouse_name:_0x2d7672,Room_name:_0x37167d}=_0x237db7[_0x50775a(0x8b)],_0x3a4bef=_0x237db7[_0x50775a(0xdb)]['id'],_0x1136fc=await adjustment_finished[_0x50775a(0x14e)]({'_id':_0x3a4bef});var _0x55e5eb;const _0x4f484f=_0x1136fc['product'][_0x50775a(0xd3)](async _0xa17d0d=>{var _0x4108bd=_0x50775a;if(_0xa17d0d[_0x4108bd(0x139)]>0x0){_0x55e5eb=await warehouse[_0x4108bd(0x89)]({'name':_0x2d7672,'room':_0xa17d0d[_0x4108bd(0xad)],'warehouse_category':_0x4108bd(0x9a)});const _0x32d4e9=_0x55e5eb['product_details'][_0x4108bd(0xd3)](_0x49928e=>{var _0x4fe2e1=_0x4108bd;console[_0x4fe2e1(0x11e)](_0xa17d0d[_0x4fe2e1(0x146)]);if(_0xa17d0d[_0x4fe2e1(0x146)]=='minus')_0x49928e[_0x4fe2e1(0x117)]==_0xa17d0d[_0x4fe2e1(0x117)]&&_0x49928e[_0x4fe2e1(0x8f)]==_0xa17d0d[_0x4fe2e1(0x8f)]&&_0x49928e['expiry_date']==_0xa17d0d[_0x4fe2e1(0xa0)]&&_0x49928e[_0x4fe2e1(0x150)]==_0xa17d0d[_0x4fe2e1(0x150)]&&_0x49928e[_0x4fe2e1(0x118)]==_0xa17d0d['batch_code']&&_0x49928e['invoice']==_0xa17d0d[_0x4fe2e1(0xc4)]&&(_0x49928e[_0x4fe2e1(0x108)]=_0x49928e[_0x4fe2e1(0x108)]-_0xa17d0d['adjust_qty']);else _0xa17d0d['types']==_0x4fe2e1(0x111)&&(_0x49928e[_0x4fe2e1(0x117)]==_0xa17d0d[_0x4fe2e1(0x117)]&&_0x49928e[_0x4fe2e1(0x8f)]==_0xa17d0d[_0x4fe2e1(0x8f)]&&_0x49928e[_0x4fe2e1(0xa0)]==_0xa17d0d['expiry_date']&&_0x49928e[_0x4fe2e1(0x150)]==_0xa17d0d[_0x4fe2e1(0x150)]&&_0x49928e[_0x4fe2e1(0x118)]==_0xa17d0d[_0x4fe2e1(0x118)]&&_0x49928e[_0x4fe2e1(0xc4)]==_0xa17d0d[_0x4fe2e1(0xc4)]&&(_0x49928e[_0x4fe2e1(0x108)]=_0x49928e[_0x4fe2e1(0x108)]+_0xa17d0d[_0x4fe2e1(0x139)]));});}return _0x55e5eb;});Promise[_0x50775a(0xdc)](_0x4f484f)[_0x50775a(0xfc)](async _0x588b10=>{var _0x3a7055=_0x50775a;try{for(const _0x17f52f of _0x588b10){await _0x17f52f['save']();}_0x1136fc[_0x3a7055(0xa7)]=_0x3a7055(0xc8);const _0x1071be=await _0x1136fc[_0x3a7055(0xf7)](),_0x449040=await master_shop[_0x3a7055(0x103)](),_0x219172=await email_settings[_0x3a7055(0x89)](),_0x1278d9=await supervisor_settings[_0x3a7055(0x103)]();var _0x442b8e=_0x1136fc[_0x3a7055(0xce)],_0x213c42='',_0x218b0b;for(_0x218b0b in _0x442b8e){var _0x1e576f='FG';_0x1136fc['warehouse_name']==_0x3a7055(0xc3)&&(_0x1e576f='DG'),_0x213c42+=_0x3a7055(0x95)+_0x3a7055(0x10a)+_0x442b8e[_0x218b0b][_0x3a7055(0x117)]+_0x3a7055(0x112)+_0x3a7055(0x10a)+_0x442b8e[_0x218b0b]['product_code']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x442b8e[_0x218b0b][_0x3a7055(0x139)]+_0x3a7055(0x112)+_0x3a7055(0x10a)+_0x442b8e[_0x218b0b][_0x3a7055(0xd1)]+_0x3a7055(0x112)+_0x3a7055(0x10a)+_0x442b8e[_0x218b0b][_0x3a7055(0x88)]+_0x3a7055(0x112)+_0x3a7055(0x10a)+_0x1136fc['warehouse_name']+_0x3a7055(0x112)+_0x3a7055(0x10a)+_0x442b8e[_0x218b0b]['room_names']+_0x3a7055(0x112)+_0x3a7055(0x10a)+_0x1e576f+_0x442b8e[_0x218b0b][_0x3a7055(0x8f)]+_0x3a7055(0x112)+'</tr>';}let _0x13d11c=nodemailer[_0x3a7055(0x98)]({'host':_0x219172[_0x3a7055(0xa4)],'port':Number(_0x219172[_0x3a7055(0x9e)]),'secure':![],'auth':{'user':_0x219172[_0x3a7055(0x113)],'pass':_0x219172['password']}}),_0x2836ba={'from':_0x219172['email'],'to':_0x1278d9[0x0][_0x3a7055(0xe2)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x3a7055(0x109),'path':__dirname+_0x3a7055(0x11f)+_0x3a7055(0x102)+_0x449040[0x0]['image'],'cid':_0x3a7055(0xf8)}],'html':_0x3a7055(0x144)+'<html><head><title></title>'+_0x3a7055(0xe1)+'<div>'+_0x3a7055(0x10c)+_0x3a7055(0x14a)+_0x3a7055(0x12f)+_0x3a7055(0xdf)+_0x3a7055(0x14a)+_0x3a7055(0xd6)+_0x449040[0x0][_0x3a7055(0xac)]+_0x3a7055(0x10b)+_0x3a7055(0xdf)+'</div>'+'<hr\x20class=\x22my-3\x22>'+_0x3a7055(0x14a)+_0x3a7055(0xeb)+_0x3a7055(0x12b)+_0x1136fc['invoice']+'\x20'+_0x3a7055(0x126)+_0x3a7055(0x130)+_0x1136fc[_0x3a7055(0x121)]+'\x20'+_0x3a7055(0x110)+'</h5>'+'</div>'+_0x3a7055(0x14d)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x3a7055(0x95)+_0x3a7055(0x120)+_0x3a7055(0x14b)+_0x3a7055(0x140)+_0x3a7055(0xf9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x3a7055(0xe7)+_0x3a7055(0xcf)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x3a7055(0x104)+'\x20'+_0x213c42+'\x20'+_0x3a7055(0xbf)+_0x3a7055(0xbd)+_0x3a7055(0x14a)+_0x3a7055(0x105)+_0x3a7055(0x96)+_0x449040[0x0]['site_title']+_0x3a7055(0x13c)+_0x3a7055(0xdf)+'</div>'+_0x3a7055(0x99)};_0x13d11c['sendMail'](_0x2836ba,function(_0x24f6ea,_0x1bc835){var _0x18bb5d=_0x3a7055;_0x24f6ea?(console['log'](_0x24f6ea),console['log'](_0x18bb5d(0x87))):console[_0x18bb5d(0x11e)](_0x18bb5d(0xde));}),_0x237db7[_0x3a7055(0xe9)](_0x3a7055(0x147),_0x3a7055(0xb2)),_0x4b93da[_0x3a7055(0xdd)](_0x3a7055(0xe5)+_0x1071be[_0x3a7055(0x13e)]);}catch(_0x59c8f6){console[_0x3a7055(0xc6)](_0x59c8f6),_0x4b93da['status'](0x1f4)[_0x3a7055(0x127)]({'error':_0x3a7055(0xe8)});}})[_0x50775a(0x115)](_0x3ee917=>{var _0x10c9bb=_0x50775a;console[_0x10c9bb(0xc6)](_0x3ee917),_0x4b93da['status'](0x1f4)['json']({'error':_0x10c9bb(0xf4)});});}catch(_0x3daf7b){_0x4b93da['json']({'message':_0x3daf7b[_0x50775a(0xd2)]});}}),router[a0_0x4dfc50(0x143)](a0_0x4dfc50(0x8a),auth,async(_0x4ad36f,_0x1451a0)=>{var _0x3c3f29=a0_0x4dfc50;try{const {username:_0x64bd86,email:_0x407930,role:_0xaf5d7c}=_0x4ad36f[_0x3c3f29(0xe3)],_0x422546=_0x4ad36f[_0x3c3f29(0xe3)],_0x376ad3=await profile[_0x3c3f29(0x89)]({'email':_0x422546[_0x3c3f29(0x113)]}),_0xb65e3e=await master_shop[_0x3c3f29(0x103)]();console[_0x3c3f29(0x11e)]('master',_0xb65e3e);const _0x3d1673=_0x4ad36f[_0x3c3f29(0xdb)]['id'],_0x5e8329=await adjustment_finished['findById']({'_id':_0x3d1673});let _0x53a5b1=new Date(_0x5e8329[_0x3c3f29(0xa0)]),_0x100e06=('0'+_0x53a5b1[_0x3c3f29(0x97)]())['slice'](-0x2),_0x3bd543=('0'+(_0x53a5b1[_0x3c3f29(0x91)]()+0x1))['slice'](-0x2),_0x39a4ce=_0x53a5b1[_0x3c3f29(0xc9)](),_0xd1cde0=_0x39a4ce+'-'+_0x3bd543+'-'+_0x100e06;var _0x187df6=[_0x3c3f29(0x13f),_0x3c3f29(0xda),_0x3c3f29(0xb3)];const _0x3985e5=await purchases[_0x3c3f29(0xab)]([{'$match':{'warehouse_name':_0x5e8329[_0x3c3f29(0xca)]}},{'$unwind':_0x3c3f29(0xb5)},{'$group':{'_id':_0x3c3f29(0x14f)}}]);console[_0x3c3f29(0x11e)]('purchases_data',_0x3985e5);const _0x40b407=await product[_0x3c3f29(0x103)]({}),_0x391fb9=await warehouse[_0x3c3f29(0xab)]([{'$match':{'name':_0x5e8329[_0x3c3f29(0xca)],'room':_0x5e8329['room']}},{'$unwind':_0x3c3f29(0xf6)},{'$group':{'_id':_0x3c3f29(0x136),'name':{'$first':_0x3c3f29(0xe4)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x3c3f29(0xa3)},'bin':{'$first':_0x3c3f29(0xe6)},'type':{'$first':_0x3c3f29(0x137)},'floorlevel':{'$first':_0x3c3f29(0x122)},'primary_code':{'$first':_0x3c3f29(0xff)},'secondary_code':{'$first':_0x3c3f29(0xa1)},'product_code':{'$first':_0x3c3f29(0xe0)},'storage':{'$first':_0x3c3f29(0x13b)},'rack':{'$first':_0x3c3f29(0x101)}}}]);if(_0xb65e3e[0x0][_0x3c3f29(0x141)]==_0x3c3f29(0x11c)){var _0x3929e1=users[_0x3c3f29(0x128)];console['log'](_0x3929e1);}else{if(_0xb65e3e[0x0][_0x3c3f29(0x141)]==_0x3c3f29(0xcc))var _0x3929e1=users[_0x3c3f29(0xcc)];else{if(_0xb65e3e[0x0][_0x3c3f29(0x141)]=='German')var _0x3929e1=users[_0x3c3f29(0x94)];else{if(_0xb65e3e[0x0][_0x3c3f29(0x141)]==_0x3c3f29(0x142))var _0x3929e1=users['Spanish'];else{if(_0xb65e3e[0x0]['language']=='French')var _0x3929e1=users['French'];else{if(_0xb65e3e[0x0]['language']==_0x3c3f29(0x10d))var _0x3929e1=users[_0x3c3f29(0xf2)];else{if(_0xb65e3e[0x0][_0x3c3f29(0x141)]==_0x3c3f29(0x9b))var _0x3929e1=users[_0x3c3f29(0x9b)];else{if(_0xb65e3e[0x0][_0x3c3f29(0x141)]==_0x3c3f29(0xd9))var _0x3929e1=users['Arabic'];}}}}}}}_0x1451a0[_0x3c3f29(0xa8)]('edit_adjustment_finished',{'success':_0x4ad36f['flash'](_0x3c3f29(0x147)),'errors':_0x4ad36f[_0x3c3f29(0xe9)]('errors'),'role':_0x422546,'profile':_0x376ad3,'adjustment':_0x5e8329,'stock':_0x391fb9,'master_shop':_0xb65e3e,'warehouse_name':_0x3985e5,'unit':_0x40b407,'language':_0x3929e1,'rooms_data':_0x187df6,'ed_fullDate':_0xd1cde0});}catch(_0x367f59){console[_0x3c3f29(0x11e)](_0x367f59),_0x1451a0['status'](0xc8)[_0x3c3f29(0x127)]({'message':_0x367f59[_0x3c3f29(0xd2)]});}}),router[a0_0x4dfc50(0xb8)](a0_0x4dfc50(0x8a),auth,async(_0x126cd6,_0x23e90a)=>{var _0xcb51f1=a0_0x4dfc50;try{const _0x5fed48=_0x126cd6[_0xcb51f1(0xdb)]['id'],_0x4bc1cb=await adjustment_finished['findById']({'_id':_0x5fed48}),_0x62114=await warehouse[_0xcb51f1(0x89)]({'name':_0x4bc1cb[_0xcb51f1(0xca)],'room':_0x4bc1cb[_0xcb51f1(0x11a)]}),{warehouse_name:_0x4e19ef,date:_0x5608de,prod_name:_0x19414a,level:_0x213d89,isle:_0x174f1b,pallet:_0x109af3,stock:_0x786bc7,types:_0x149c65,adjust_qty:_0x19412b,new_adjust_qty:_0x26237a,note:_0xe9dfa4,Room_name:_0x3668a7,invoice:_0x12846d,JO_number:_0x5b33b1}=_0x126cd6[_0xcb51f1(0x8b)];if(typeof _0x19414a==_0xcb51f1(0x133))var _0x3c367e=[_0x126cd6['body'][_0xcb51f1(0x11b)]],_0x129859=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x93)]],_0x4202c3=[_0x126cd6[_0xcb51f1(0x8b)]['stock']],_0x42f83f=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x146)]],_0x1ffb7a=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x139)]],_0x50a939=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x12e)]],_0x5e4c0c=[_0x126cd6['body']['prod_code']],_0x4b313a=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0xd1)]],_0x1e683f=[_0x126cd6[_0xcb51f1(0x8b)]['Secondary_units']],_0x58aecb=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x118)]],_0x2e4f61=[_0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0xa0)]];else var _0x3c367e=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x11b)]],_0x129859=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x93)]],_0x4202c3=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0xf3)]],_0x42f83f=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x146)]],_0x1ffb7a=[..._0x126cd6['body'][_0xcb51f1(0x139)]],_0x50a939=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x12e)]],_0x5e4c0c=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x100)]],_0x4b313a=[..._0x126cd6[_0xcb51f1(0x8b)]['unit']],_0x1e683f=[..._0x126cd6['body'][_0xcb51f1(0x106)]],_0x58aecb=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0x118)]],_0x2e4f61=[..._0x126cd6[_0xcb51f1(0x8b)][_0xcb51f1(0xa0)]];const _0x24db23=_0x3c367e[_0xcb51f1(0xd3)](_0x3cdd57=>{return _0x3cdd57={'product_name':_0x3cdd57};});_0x129859[_0xcb51f1(0x90)]((_0x29d35f,_0x23dc96)=>{var _0x548e11=_0xcb51f1;_0x24db23[_0x23dc96][_0x548e11(0x8f)]=_0x29d35f;}),_0x4202c3[_0xcb51f1(0x90)]((_0x574177,_0x5b1ac4)=>{_0x24db23[_0x5b1ac4]['stockBefore']=_0x574177;}),_0x42f83f[_0xcb51f1(0x90)]((_0x3e01b7,_0x5eab72)=>{var _0x53ff00=_0xcb51f1;_0x24db23[_0x5eab72][_0x53ff00(0x146)]=_0x3e01b7;}),_0x1ffb7a[_0xcb51f1(0x90)]((_0x576113,_0x5b888b)=>{var _0x2fe09e=_0xcb51f1;_0x24db23[_0x5b888b][_0x2fe09e(0x139)]=_0x576113;}),_0x50a939[_0xcb51f1(0x90)]((_0x37bd25,_0x1fec12)=>{_0x24db23[_0x1fec12]['new_adjust_qty']=_0x37bd25;}),_0x4b313a[_0xcb51f1(0x90)]((_0x50e557,_0x37225e)=>{var _0x4f27fc=_0xcb51f1;_0x24db23[_0x37225e][_0x4f27fc(0xd1)]=_0x50e557;}),_0x1e683f['forEach']((_0x4ee3ff,_0x40247b)=>{var _0xa13b95=_0xcb51f1;_0x24db23[_0x40247b][_0xa13b95(0x88)]=_0x4ee3ff;}),_0x5e4c0c['forEach']((_0x26e64c,_0x5398d8)=>{var _0xfee761=_0xcb51f1;_0x24db23[_0x5398d8][_0xfee761(0xbc)]=_0x26e64c;}),_0x58aecb[_0xcb51f1(0x90)]((_0x1eab90,_0x196948)=>{var _0x11018c=_0xcb51f1;_0x24db23[_0x196948][_0x11018c(0x118)]=_0x1eab90;}),_0x2e4f61[_0xcb51f1(0x90)]((_0x2b66af,_0x124ab5)=>{var _0x17dfba=_0xcb51f1;_0x24db23[_0x124ab5][_0x17dfba(0xa0)]=_0x2b66af;});const _0x3efdf1=_0x24db23[_0xcb51f1(0xfd)](_0x22702b=>_0x22702b['adjust_qty']!=='0'&&_0x22702b[_0xcb51f1(0x139)]!=='');var _0x14b2e3=0x0;_0x3efdf1[_0xcb51f1(0x90)](_0x51ab9c=>{var _0x5765ab=_0xcb51f1;console[_0x5765ab(0x11e)](_0x5765ab(0xa5),_0x51ab9c),parseInt(_0x51ab9c[_0x5765ab(0x139)])<=0x0&&_0x14b2e3++;});if(_0x14b2e3!=0x0)return _0x126cd6[_0xcb51f1(0xe9)](_0xcb51f1(0xd4),_0xcb51f1(0xb0)),_0x23e90a['redirect']('back');_0x4bc1cb['warehouse_name']=_0x4e19ef,_0x4bc1cb[_0xcb51f1(0x121)]=_0x5608de,_0x4bc1cb[_0xcb51f1(0xce)]=_0x3efdf1,_0x4bc1cb['note']=_0xe9dfa4,_0x4bc1cb[_0xcb51f1(0x11a)]=_0x3668a7,_0x4bc1cb[_0xcb51f1(0xc4)]=_0x12846d,_0x4bc1cb[_0xcb51f1(0xee)]=_0x5b33b1;const _0xac02f0=await _0x4bc1cb[_0xcb51f1(0xf7)](),_0x58dbe9=await warehouse[_0xcb51f1(0x89)]({'name':_0x4e19ef,'room':_0x3668a7});_0xac02f0[_0xcb51f1(0xce)][_0xcb51f1(0x90)](_0x4308b3=>{var _0x48ae23=_0xcb51f1;const _0x3eff91=_0x58dbe9[_0x48ae23(0xcb)][_0x48ae23(0xd3)](_0x540317=>{var _0x416498=_0x48ae23;_0x4308b3['types']=='minus'?_0x540317[_0x416498(0x117)]==_0x4308b3[_0x416498(0x117)]&&_0x540317[_0x416498(0x8f)]==_0x4308b3[_0x416498(0x8f)]&&(_0x540317[_0x416498(0x108)]=parseInt(_0x540317[_0x416498(0x108)])-parseInt(_0x4308b3[_0x416498(0x139)])):_0x540317[_0x416498(0x117)]==_0x4308b3[_0x416498(0x117)]&&_0x540317[_0x416498(0x8f)]==_0x4308b3[_0x416498(0x8f)]&&(_0x540317['product_stock']=parseInt(_0x540317[_0x416498(0x108)])+parseInt(_0x4308b3[_0x416498(0x139)]));});}),await _0x58dbe9['save'](),_0x126cd6[_0xcb51f1(0xe9)]('success','adjustment\x20data\x20update\x20successfully'),_0x23e90a['redirect'](_0xcb51f1(0x13a));}catch(_0x477b73){console['log'](_0x477b73);}}),router[a0_0x4dfc50(0xb8)]('/barcode_scanner',async(_0x5f4695,_0x3bba04)=>{var _0x418e12=a0_0x4dfc50;const {primary_code:_0x28fe0e,warehouse_data:_0x224b5a,rooms_data:_0x40ac46,Roomslist:_0x54dbdd}=_0x5f4695[_0x418e12(0x8b)],_0x55d09e=_0x54dbdd[_0x418e12(0x13d)](','),_0x27b3d1=[];async function _0x366b2a(_0x54cc8c){var _0x286cde=_0x418e12;const _0x5e72a1=await warehouse['aggregate']([{'$match':{'name':_0x224b5a,'room':_0x54cc8c}},{'$unwind':_0x286cde(0xf6)},{'$match':{'product_details.primary_code':_0x28fe0e}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x286cde(0xe4)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x286cde(0xff)},'secondary_code':{'$first':_0x286cde(0xa1)},'product_code':{'$first':_0x286cde(0xe0)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x286cde(0xe6)},'type':{'$first':_0x286cde(0x137)},'pallet':{'$first':_0x286cde(0x122)},'unit':{'$first':_0x286cde(0x148)},'secondary_unit':{'$first':_0x286cde(0xa6)},'storage':{'$first':_0x286cde(0x13b)},'rack':{'$first':_0x286cde(0x101)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x286cde(0x9c)},'batch_code':{'$first':_0x286cde(0x135)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x286cde(0xef)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x286cde(0xc1)}}}]),_0x2d4508=await warehouse[_0x286cde(0xab)]([{'$match':{'name':_0x224b5a,'room':_0x54cc8c}},{'$unwind':_0x286cde(0xf6)},{'$match':{'product_details.secondary_code':_0x28fe0e}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x286cde(0xe4)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x286cde(0xff)},'secondary_code':{'$first':_0x286cde(0xa1)},'product_code':{'$first':_0x286cde(0xe0)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x286cde(0x148)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x286cde(0x13b)},'rack':{'$first':_0x286cde(0x101)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x286cde(0x9c)},'batch_code':{'$first':_0x286cde(0x135)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x286cde(0xef)},'roomNamed':{'$first':_0x286cde(0x116)},'invoice':{'$first':_0x286cde(0xc1)}}}]);if(_0x5e72a1[_0x286cde(0xc7)]>0x0)_0x27b3d1[_0x286cde(0x8d)](_0x5e72a1);else _0x2d4508[_0x286cde(0xc7)]>0x0&&_0x27b3d1['push'](_0x2d4508);}const _0x4a8d9c=_0x55d09e['map'](_0x1d411f=>_0x366b2a(_0x1d411f));await Promise[_0x418e12(0xdc)](_0x4a8d9c),_0x3bba04['json'](_0x27b3d1);}),router[a0_0x4dfc50(0xb8)](a0_0x4dfc50(0x10f),async(_0x560a49,_0x1fd38c)=>{var _0x1d6c3a=a0_0x4dfc50;const {productCode:_0xccaa6e,bay:_0xef46b4,warehouses:_0x3337ab,room:_0x6a2822}=_0x560a49[_0x1d6c3a(0x8b)];console[_0x1d6c3a(0x11e)](_0x560a49[_0x1d6c3a(0x8b)]);try{const _0xde378d=await warehouse[_0x1d6c3a(0xab)]([{'$match':{'name':_0x3337ab,'room':_0x6a2822}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0xef46b4)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1d6c3a(0xe4)},'product_stock':{'$first':_0x1d6c3a(0xec)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x1d6c3a(0x9d)}}}]);_0x1fd38c[_0x1d6c3a(0xaa)](0xc8)['json'](_0xde378d);}catch(_0x4550ef){_0x1fd38c['status'](0x194)[_0x1d6c3a(0x127)]({'message':_0x4550ef[_0x1d6c3a(0xd2)]});}}),module['exports']=router;