var a0_0x24aeaa=a0_0x1d4c;(function(_0x1ac63a,_0x1adf2a){var _0x2134de=a0_0x1d4c,_0x386f46=_0x1ac63a();while(!![]){try{var _0x52954f=parseInt(_0x2134de(0x281))/0x1+parseInt(_0x2134de(0x25e))/0x2+-parseInt(_0x2134de(0x27f))/0x3+-parseInt(_0x2134de(0x221))/0x4*(parseInt(_0x2134de(0x258))/0x5)+parseInt(_0x2134de(0x22c))/0x6*(-parseInt(_0x2134de(0x22e))/0x7)+-parseInt(_0x2134de(0x1dd))/0x8+-parseInt(_0x2134de(0x220))/0x9*(-parseInt(_0x2134de(0x218))/0xa);if(_0x52954f===_0x1adf2a)break;else _0x386f46['push'](_0x386f46['shift']());}catch(_0x27fa36){_0x386f46['push'](_0x386f46['shift']());}}}(a0_0x12c3,0x4f450));const express=require(a0_0x24aeaa(0x246)),app=express(),router=express[a0_0x24aeaa(0x1e9)](),auth=require(a0_0x24aeaa(0x24c)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x24aeaa(0x1ed)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x24aeaa(0x1fc));router[a0_0x24aeaa(0x203)]('/view',auth,async(_0x5c58c2,_0x56fb35)=>{var _0x5d778f=a0_0x24aeaa;try{const {username:_0x25dc64,email:_0x5a4da6,role:_0x15e531}=_0x5c58c2[_0x5d778f(0x1e3)],_0x287501=_0x5c58c2[_0x5d778f(0x1e3)],_0x5213ee=await profile['findOne']({'email':_0x287501[_0x5d778f(0x26c)]}),_0xf79258=await master_shop[_0x5d778f(0x222)]();let _0x241fd4;if(_0x287501['role']=='staff'){const _0x45899b=await staff[_0x5d778f(0x1f0)]({'email':_0x287501[_0x5d778f(0x26c)]});_0x241fd4=await warehouse['find']({'status':'Enabled','name':_0x45899b[_0x5d778f(0x1ea)]});}else _0x241fd4=await warehouse['find']({'status':'Enabled'});const _0x3340fd=await product['find']();let _0x209f88;if(_0x287501[_0x5d778f(0x1e0)]=='staff'){const _0x80c04a=await staff[_0x5d778f(0x1f0)]({'email':_0x287501[_0x5d778f(0x26c)]});_0x209f88=await adjustment_finished[_0x5d778f(0x222)]({'warehouse_name':_0x80c04a['warehouse']});}else _0x209f88=await adjustment_finished[_0x5d778f(0x1e7)]([{'$unwind':_0x5d778f(0x223)},{'$group':{'_id':_0x5d778f(0x271),'invoice':{'$first':_0x5d778f(0x1d1)},'date':{'$first':_0x5d778f(0x23e)},'warehouse_name':{'$first':_0x5d778f(0x1ec)},'room':{'$addToSet':_0x5d778f(0x23f)},'finalize':{'$first':_0x5d778f(0x227)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xf79258[0x0][_0x5d778f(0x257)]=='English\x20(US)'){var _0x199f9b=users['English'];console[_0x5d778f(0x231)](_0x199f9b);}else{if(_0xf79258[0x0][_0x5d778f(0x257)]==_0x5d778f(0x288))var _0x199f9b=users[_0x5d778f(0x288)];else{if(_0xf79258[0x0]['language']==_0x5d778f(0x1f2))var _0x199f9b=users[_0x5d778f(0x1f2)];else{if(_0xf79258[0x0]['language']=='Spanish')var _0x199f9b=users[_0x5d778f(0x25a)];else{if(_0xf79258[0x0][_0x5d778f(0x257)]=='French')var _0x199f9b=users[_0x5d778f(0x1db)];else{if(_0xf79258[0x0][_0x5d778f(0x257)]=='Portuguese\x20(BR)')var _0x199f9b=users['Portuguese'];else{if(_0xf79258[0x0][_0x5d778f(0x257)]=='Chinese')var _0x199f9b=users[_0x5d778f(0x229)];else{if(_0xf79258[0x0][_0x5d778f(0x257)]==_0x5d778f(0x24d))var _0x199f9b=users[_0x5d778f(0x1f9)];}}}}}}}_0x56fb35['render']('adjustment_finished',{'success':_0x5c58c2['flash']('success'),'errors':_0x5c58c2[_0x5d778f(0x21c)](_0x5d778f(0x28e)),'role':_0x287501,'profile':_0x5213ee,'warehouse':_0x241fd4,'product':_0x3340fd,'adjustment':_0x209f88,'master_shop':_0xf79258,'language':_0x199f9b});}catch(_0x59b67f){console[_0x5d778f(0x231)](_0x59b67f);}});function a0_0x12c3(){var _0x3411ab=['$product_details.maxPerUnit','user','adjustment\x20add\x20successfull','$product_details.product_name','foreach\x20newproduct','aggregate','\x20</h2>','Router','warehouse','Adjustment\x20Finalize\x20Successfully','$warehouse_name','../models/all_models','purchases_data','<table\x20style=\x22width:\x20100%\x20!important;\x22>','findOne','$product_details.product_code','German','error','types','</h5>','prod_cat','master','filter','Arabic','$product_details.storage','New_Qty_Converted','nodemailer','json','/adjustment_finished/view','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product','Rooms','invoice','get','staff','note','random','_id','</span>','$product_details.maxProducts','</div>','production_date','product_code','getDate','$product_details.secondary_unit','<tr>','minus','\x20Order\x20Number\x20:\x20','redirect','$product_details._id','$product_details.rack','adjust_qty','length','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','3339510NoZSko','$name','batch_code','<h5>','flash','$product_details.unit','ADJF-','/../public','27aGgogl','28kESHuP','find','$product','Enabled','back','forEach','$finalize','New_Qty_Converted_adj','Chinese','</thead>','</body></html>','3443802QOPyGk','$product_details.bay','7iCstMh','new_adjust_qty','<!DOCTYPE\x20html>','log','catch','$product_details.expiry_date','<h5\x20style=\x22text-align:\x20left;\x22>','/preview/:id','<strong>\x20Regards\x20</strong>','product_date','findById','An\x20error\x20occurred\x20while\x20saving\x20data.','adjustment\x20data\x20update\x20successfully','product_details','prod_name','password','$date','$product.room_names','site_title','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','room','secondary_unit','Enclosed','express','Ambient','<tbody\x20style=\x22text-align:\x20center;\x22>','host','date','Primary_Units','../middleware/auth','Arabic\x20(ae)','/CheckingWarehouse','An\x20error\x20occurred.','$product_details.invoice','product_name','post','/view/add_adjustment','createTransport','slice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','language','297455zVdyoz','<hr\x20class=\x22my-3\x22>','Spanish','$product_details.secondary_code','unit','</td>','960322wQtXat','</tr>','expiry_date','Portuguese\x20(BR)','Return\x20Rooms','toString','floor','edit_adjustment_finished_view','status','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','port','Portuguese','<h2>\x20','exports','email','\x20Order\x20Date\x20:\x20','$product.product_name','$product_details.floorlevel','QA\x20Warehouse','$_id','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','DRY\x20GOODS','string','prod_code','$product_details.production_date','stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</tbody>','Secondary_units','prod_invoice','body','message','product_stock','328749iTnhCV','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','408402ktjBgX','success','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','add_adjustment_finished','add','$product_details.bin','level','Hindi','/view/:id','maxPerUnit','Finished\x20Goods','$product_details.type','save','errors','$room','params','getMonth','/picking_list/PDF_adjustment/','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','English','edit_adjustment_finished','$product_details.product_stock','English\x20(US)','then','stockBefore','map','$invoice','Logo.png','$product_details.batch_code','Error\x20Occurs','bay','Adjustment\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','room_names','split','all','French','<html><head><title></title>','3725928RLaViH','$product_details','render','role','<div>'];a0_0x12c3=function(){return _0x3411ab;};return a0_0x12c3();}function a0_0x1d4c(_0x335e9e,_0x1708c0){var _0x12c38e=a0_0x12c3();return a0_0x1d4c=function(_0x1d4c5d,_0xb2d0e1){_0x1d4c5d=_0x1d4c5d-0x1c5;var _0xbf31d=_0x12c38e[_0x1d4c5d];return _0xbf31d;},a0_0x1d4c(_0x335e9e,_0x1708c0);}async function getRandom8DigitNumber(){var _0x59d076=a0_0x24aeaa;const _0x1a731e=0x989680,_0x5021ef=0x5f5e0ff,_0x177d73=Math[_0x59d076(0x264)](Math[_0x59d076(0x206)]()*(_0x5021ef-_0x1a731e+0x1))+_0x1a731e;var _0xeded7f;const _0x3f8219=await adjustment_finished['findOne']({'invoice':_0x59d076(0x21e)+_0x177d73});return _0x3f8219&&_0x3f8219[_0x59d076(0x216)]>0x0?_0xeded7f=_0x59d076(0x21e)+_0x177d73:_0xeded7f=_0x59d076(0x21e)+_0x177d73,_0xeded7f;}router['get'](a0_0x24aeaa(0x253),auth,async(_0x5a85b6,_0x23b12e)=>{var _0x5ed20b=a0_0x24aeaa;try{const {username:_0x10df3d,email:_0x142a3c,role:_0x3fca3e}=_0x5a85b6['user'],_0x472e18=_0x5a85b6['user'],_0x53c14d=await profile[_0x5ed20b(0x1f0)]({'email':_0x472e18['email']}),_0x440ee3=await master_shop[_0x5ed20b(0x222)]();let _0x383543;if(_0x472e18[_0x5ed20b(0x1e0)]==_0x5ed20b(0x204)){const _0x3abfa5=await staff[_0x5ed20b(0x1f0)]({'email':_0x472e18[_0x5ed20b(0x26c)]});_0x383543=await warehouse['aggregate']([{'$match':{'status':_0x5ed20b(0x224),'name':_0x3abfa5[_0x5ed20b(0x1ea)],'warehouse_category':_0x5ed20b(0x28b),'name':{'$ne':_0x5ed20b(0x270)}}},{'$group':{'_id':_0x5ed20b(0x219),'name':{'$first':_0x5ed20b(0x219)}}}]);}else _0x383543=await warehouse[_0x5ed20b(0x1e7)]([{'$match':{'status':_0x5ed20b(0x224),'warehouse_category':_0x5ed20b(0x28b),'name':{'$ne':_0x5ed20b(0x270)}}},{'$group':{'_id':_0x5ed20b(0x219),'name':{'$first':_0x5ed20b(0x219)}}}]);const _0x518472=await product[_0x5ed20b(0x222)]({}),_0x1e723e=await adjustment_finished[_0x5ed20b(0x222)]({}),_0x1fb0a2=_0x1e723e[_0x5ed20b(0x216)]+0x1,_0x375c7b=_0x5ed20b(0x21e)+_0x1fb0a2[_0x5ed20b(0x263)]()['padStart'](0x5,'0');var _0x224fe0=[_0x5ed20b(0x247),'Enclosed','Return\x20Rooms'];if(_0x440ee3[0x0][_0x5ed20b(0x257)]==_0x5ed20b(0x1cd))var _0x1626f4=users[_0x5ed20b(0x1ca)];else{if(_0x440ee3[0x0][_0x5ed20b(0x257)]==_0x5ed20b(0x288))var _0x1626f4=users[_0x5ed20b(0x288)];else{if(_0x440ee3[0x0][_0x5ed20b(0x257)]==_0x5ed20b(0x1f2))var _0x1626f4=users[_0x5ed20b(0x1f2)];else{if(_0x440ee3[0x0][_0x5ed20b(0x257)]=='Spanish')var _0x1626f4=users[_0x5ed20b(0x25a)];else{if(_0x440ee3[0x0][_0x5ed20b(0x257)]=='French')var _0x1626f4=users[_0x5ed20b(0x1db)];else{if(_0x440ee3[0x0][_0x5ed20b(0x257)]==_0x5ed20b(0x261))var _0x1626f4=users['Portuguese'];else{if(_0x440ee3[0x0]['language']==_0x5ed20b(0x229))var _0x1626f4=users[_0x5ed20b(0x229)];else{if(_0x440ee3[0x0][_0x5ed20b(0x257)]==_0x5ed20b(0x24d))var _0x1626f4=users['Arabic'];}}}}}}}const _0x4db782=getRandom8DigitNumber();_0x4db782[_0x5ed20b(0x1ce)](_0x3d1b1d=>{var _0x30375c=_0x5ed20b;_0x23b12e[_0x30375c(0x1df)](_0x30375c(0x284),{'success':_0x5a85b6[_0x30375c(0x21c)](_0x30375c(0x282)),'errors':_0x5a85b6[_0x30375c(0x21c)](_0x30375c(0x28e)),'role':_0x472e18,'profile':_0x53c14d,'warehouse':_0x383543,'product':_0x518472,'master_shop':_0x440ee3,'language':_0x1626f4,'rooms_data':_0x224fe0,'invoice_no':_0x3d1b1d});})['catch'](_0x15b942=>{var _0x2b6cee=_0x5ed20b;_0x5a85b6[_0x2b6cee(0x21c)](_0x2b6cee(0x28e),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x23b12e['redirect']('/adjustment/view');});}catch(_0x92e502){console[_0x5ed20b(0x231)](_0x92e502);}}),router[a0_0x24aeaa(0x252)]('/view/add_adjustment',auth,async(_0x3536fe,_0x4ef582)=>{var _0x13ed95=a0_0x24aeaa;try{const {warehouse_name:_0x5e8aea,date:_0x26a186,prod_name:_0x10e180,level:_0x2eb87a,isle:_0x9400f6,pallet:_0x5613d7,stock:_0x2cd5fb,types:_0x1e7802,adjust_qty:_0x4f85f8,new_adjust_qty:_0x24ac71,note:_0x1fdd1,Room_name:_0x5622f9,invoice:_0x101a7c,JO_number:_0x598a86,expiry_date:_0x13150c}=_0x3536fe[_0x13ed95(0x27c)];if(typeof _0x10e180==_0x13ed95(0x274))var _0x1c8f56=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x23c)]],_0x2121c5=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x287)]],_0x8f270c=[_0x3536fe[_0x13ed95(0x27c)]['stock']],_0x286247=[_0x3536fe['body']['types']],_0x3c6a52=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x228)]],_0x17595a=[_0x3536fe['body'][_0x13ed95(0x1fb)]],_0x2f19e5=[_0x3536fe['body'][_0x13ed95(0x24b)]],_0x419405=[_0x3536fe['body']['Secondary_units']],_0x1a728b=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x275)]],_0x1fa601=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x21a)]],_0x35b71a=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x260)]],_0x3f8c5a=[_0x3536fe['body'][_0x13ed95(0x237)]],_0x170778=[_0x3536fe['body']['prod_cat']],_0x6d988e=[_0x3536fe['body'][_0x13ed95(0x201)]],_0x2d0db1=[_0x3536fe['body']['maxPerUnit']],_0x163bf7=[_0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x27b)]];else var _0x1c8f56=[..._0x3536fe['body'][_0x13ed95(0x23c)]],_0x2121c5=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x287)]],_0x8f270c=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x277)]],_0x286247=[..._0x3536fe[_0x13ed95(0x27c)]['types']],_0x3c6a52=[..._0x3536fe['body'][_0x13ed95(0x228)]],_0x17595a=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x1fb)]],_0x2f19e5=[..._0x3536fe['body'][_0x13ed95(0x24b)]],_0x419405=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x27a)]],_0x1a728b=[..._0x3536fe[_0x13ed95(0x27c)]['prod_code']],_0x1fa601=[..._0x3536fe[_0x13ed95(0x27c)]['batch_code']],_0x35b71a=[..._0x3536fe[_0x13ed95(0x27c)]['expiry_date']],_0x3f8c5a=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x237)]],_0x170778=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x1f6)]],_0x6d988e=[..._0x3536fe['body']['Rooms']],_0x2d0db1=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x28a)]],_0x163bf7=[..._0x3536fe[_0x13ed95(0x27c)][_0x13ed95(0x27b)]];const _0x43ee5b=_0x1c8f56[_0x13ed95(0x1d0)](_0x267404=>{return _0x267404={'product_name':_0x267404};});_0x2121c5[_0x13ed95(0x226)]((_0x7c578f,_0x16833d)=>{var _0x58d3b7=_0x13ed95;_0x43ee5b[_0x16833d][_0x58d3b7(0x1d5)]=_0x7c578f;}),_0x8f270c[_0x13ed95(0x226)]((_0x77fd2,_0x9ffd1b)=>{var _0x3f353a=_0x13ed95;_0x43ee5b[_0x9ffd1b][_0x3f353a(0x1cf)]=_0x77fd2;}),_0x286247[_0x13ed95(0x226)]((_0x3de6fb,_0x33e68e)=>{var _0x4ae2f2=_0x13ed95;_0x43ee5b[_0x33e68e][_0x4ae2f2(0x1f4)]=_0x3de6fb;}),_0x3c6a52[_0x13ed95(0x226)]((_0x313c39,_0x149c89)=>{var _0x4644b3=_0x13ed95;_0x43ee5b[_0x149c89][_0x4644b3(0x215)]=_0x313c39;}),_0x17595a[_0x13ed95(0x226)]((_0x64a682,_0x21716d)=>{var _0x371d4e=_0x13ed95;_0x43ee5b[_0x21716d][_0x371d4e(0x22f)]=_0x64a682;}),_0x2f19e5[_0x13ed95(0x226)]((_0x54310d,_0x28ae02)=>{_0x43ee5b[_0x28ae02]['unit']=_0x54310d;}),_0x419405[_0x13ed95(0x226)]((_0x210b1b,_0x464767)=>{_0x43ee5b[_0x464767]['secondary_unit']=_0x210b1b;}),_0x1a728b[_0x13ed95(0x226)]((_0x22b9c,_0x274ac5)=>{var _0xabb29d=_0x13ed95;_0x43ee5b[_0x274ac5][_0xabb29d(0x20c)]=_0x22b9c;}),_0x1fa601[_0x13ed95(0x226)]((_0x408936,_0x37b6fd)=>{var _0x19e30f=_0x13ed95;_0x43ee5b[_0x37b6fd][_0x19e30f(0x21a)]=_0x408936;}),_0x35b71a['forEach']((_0x5af399,_0x1665d2)=>{var _0x4d40b7=_0x13ed95;_0x43ee5b[_0x1665d2][_0x4d40b7(0x260)]=_0x5af399;}),_0x3f8c5a[_0x13ed95(0x226)]((_0x1bf35d,_0x296519)=>{var _0x54cecb=_0x13ed95;_0x43ee5b[_0x296519][_0x54cecb(0x20b)]=_0x1bf35d;}),_0x170778[_0x13ed95(0x226)]((_0x59dc3f,_0xde666b)=>{var _0x18949b=_0x13ed95;_0x43ee5b[_0xde666b][_0x18949b(0x1f6)]=_0x59dc3f;}),_0x6d988e[_0x13ed95(0x226)]((_0x200bdf,_0x6d6ffc)=>{var _0x5d6ca1=_0x13ed95;_0x43ee5b[_0x6d6ffc][_0x5d6ca1(0x1d8)]=_0x200bdf;}),_0x2d0db1[_0x13ed95(0x226)]((_0x25584e,_0x23cf72)=>{var _0x49ec67=_0x13ed95;_0x43ee5b[_0x23cf72][_0x49ec67(0x28a)]=_0x25584e;}),_0x163bf7['forEach']((_0x393d1f,_0x3c5ba3)=>{var _0x13b4a6=_0x13ed95;_0x43ee5b[_0x3c5ba3][_0x13b4a6(0x202)]=_0x393d1f;});const _0x5a038d=_0x43ee5b[_0x13ed95(0x1f8)](_0x265f31=>_0x265f31[_0x13ed95(0x215)]!=='0'&&_0x265f31['adjust_qty']!=='');var _0x31e9e7=0x0;_0x5a038d[_0x13ed95(0x226)](_0x19d7fb=>{var _0x1b219d=_0x13ed95;console[_0x1b219d(0x231)](_0x1b219d(0x1e6),_0x19d7fb),parseInt(_0x19d7fb[_0x1b219d(0x215)])<=0x0&&_0x31e9e7++;});if(_0x31e9e7!=0x0)return _0x3536fe[_0x13ed95(0x21c)](_0x13ed95(0x28e),_0x13ed95(0x283)),_0x4ef582[_0x13ed95(0x212)](_0x13ed95(0x225));const _0x4532db=new adjustment_finished({'warehouse_name':_0x5e8aea,'date':_0x26a186,'product':_0x5a038d,'note':_0x1fdd1,'room':_0x5622f9,'invoice':_0x101a7c,'JO_number':_0x598a86,'expiry_date':_0x13150c}),_0x5668a9=await _0x4532db[_0x13ed95(0x28d)]();_0x3536fe[_0x13ed95(0x21c)]('success',_0x13ed95(0x1e4)),_0x4ef582[_0x13ed95(0x212)]('/adjustment_finished/preview/'+_0x5668a9[_0x13ed95(0x207)]);}catch(_0x315af0){console[_0x13ed95(0x231)](_0x315af0),_0x4ef582[_0x13ed95(0x266)](0xc8)[_0x13ed95(0x1fd)]({'message':_0x315af0['message']});}}),router[a0_0x24aeaa(0x203)](a0_0x24aeaa(0x235),auth,async(_0x2609e5,_0x571121)=>{var _0x30d515=a0_0x24aeaa;try{const {username:_0x296332,email:_0x46496c,role:_0x2ebfc0}=_0x2609e5[_0x30d515(0x1e3)],_0x56e50d=_0x2609e5[_0x30d515(0x1e3)],_0x56c87f=await profile['findOne']({'email':_0x56e50d[_0x30d515(0x26c)]}),_0x6460b6=await master_shop[_0x30d515(0x222)](),_0x5c66ed=_0x2609e5['params']['id'],_0x12a0fd=await adjustment_finished[_0x30d515(0x238)]({'_id':_0x5c66ed}),_0x39d451=await purchases[_0x30d515(0x1e7)]([{'$match':{'warehouse_name':_0x12a0fd[_0x30d515(0x1c8)]}},{'$unwind':_0x30d515(0x223)},{'$group':{'_id':_0x30d515(0x26e)}}]);console[_0x30d515(0x231)](_0x30d515(0x1ee),_0x39d451);const _0x548d55=await product[_0x30d515(0x222)]({}),_0x871978=await warehouse['aggregate']([{'$match':{'name':_0x12a0fd[_0x30d515(0x1c8)],'warehouse_category':_0x30d515(0x28b)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x30d515(0x213),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x30d515(0x1cc)},'bay':{'$first':_0x30d515(0x22d)},'bin':{'$first':_0x30d515(0x286)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x30d515(0x26f)},'primary_code':{'$first':_0x30d515(0x241)},'secondary_code':{'$first':_0x30d515(0x25b)},'product_code':{'$first':_0x30d515(0x1f1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x30d515(0x233)},'production_date':{'$first':_0x30d515(0x276)},'batch_code':{'$first':_0x30d515(0x1d3)},'maxPerUnit':{'$first':_0x30d515(0x1e2)},'room':{'$first':_0x30d515(0x28f)}}}]);if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x1cd)){var _0x5b8407=users[_0x30d515(0x1ca)];console[_0x30d515(0x231)](_0x5b8407);}else{if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x288))var _0x5b8407=users[_0x30d515(0x288)];else{if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x1f2))var _0x5b8407=users[_0x30d515(0x1f2)];else{if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x25a))var _0x5b8407=users[_0x30d515(0x25a)];else{if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x1db))var _0x5b8407=users[_0x30d515(0x1db)];else{if(_0x6460b6[0x0]['language']==_0x30d515(0x261))var _0x5b8407=users[_0x30d515(0x269)];else{if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x229))var _0x5b8407=users[_0x30d515(0x229)];else{if(_0x6460b6[0x0][_0x30d515(0x257)]==_0x30d515(0x24d))var _0x5b8407=users[_0x30d515(0x1f9)];}}}}}}}_0x571121[_0x30d515(0x1df)](_0x30d515(0x265),{'success':_0x2609e5[_0x30d515(0x21c)](_0x30d515(0x282)),'errors':_0x2609e5[_0x30d515(0x21c)](_0x30d515(0x28e)),'role':_0x56e50d,'profile':_0x56c87f,'adjustment':_0x12a0fd,'stock':_0x871978,'master_shop':_0x6460b6,'warehouse_name':_0x39d451,'unit':_0x548d55,'language':_0x5b8407});}catch(_0x29c333){console[_0x30d515(0x231)](_0x29c333),_0x571121[_0x30d515(0x266)](0xc8)[_0x30d515(0x1fd)]({'message':_0x29c333[_0x30d515(0x27d)]});}}),router[a0_0x24aeaa(0x252)]('/preview/:id',auth,async(_0xab92fd,_0x1c0f5b)=>{var _0x520fbc=a0_0x24aeaa;try{const {invoice:_0x681b46,warehouse_name:_0x3c10ba,Room_name:_0x226879}=_0xab92fd[_0x520fbc(0x27c)],_0x2d2986=_0xab92fd[_0x520fbc(0x1c5)]['id'],_0x5013e8=await adjustment_finished[_0x520fbc(0x238)]({'_id':_0x2d2986});var _0x3b94a9;const _0x2f05f7=_0x5013e8[_0x520fbc(0x200)][_0x520fbc(0x1d0)](async _0x5d9d9a=>{var _0x1b3813=_0x520fbc;if(_0x5d9d9a[_0x1b3813(0x215)]>0x0){_0x3b94a9=await warehouse[_0x1b3813(0x1f0)]({'name':_0x3c10ba,'room':_0x5d9d9a[_0x1b3813(0x1d8)],'warehouse_category':_0x1b3813(0x28b)});const _0x5616c7=_0x3b94a9[_0x1b3813(0x23b)]['map'](_0x3ad0b9=>{var _0x35fe96=_0x1b3813;console[_0x35fe96(0x231)](_0x5d9d9a[_0x35fe96(0x1f4)]);if(_0x5d9d9a[_0x35fe96(0x1f4)]=='minus')_0x3ad0b9['product_name']==_0x5d9d9a[_0x35fe96(0x251)]&&_0x3ad0b9[_0x35fe96(0x1d5)]==_0x5d9d9a[_0x35fe96(0x1d5)]&&_0x3ad0b9['expiry_date']==_0x5d9d9a['expiry_date']&&_0x3ad0b9[_0x35fe96(0x20b)]==_0x5d9d9a[_0x35fe96(0x20b)]&&_0x3ad0b9['batch_code']==_0x5d9d9a[_0x35fe96(0x21a)]&&_0x3ad0b9[_0x35fe96(0x202)]==_0x5d9d9a[_0x35fe96(0x202)]&&(_0x3ad0b9['product_stock']=_0x3ad0b9['product_stock']-_0x5d9d9a[_0x35fe96(0x215)]);else _0x5d9d9a['types']==_0x35fe96(0x285)&&(_0x3ad0b9[_0x35fe96(0x251)]==_0x5d9d9a['product_name']&&_0x3ad0b9[_0x35fe96(0x1d5)]==_0x5d9d9a[_0x35fe96(0x1d5)]&&_0x3ad0b9[_0x35fe96(0x260)]==_0x5d9d9a['expiry_date']&&_0x3ad0b9['production_date']==_0x5d9d9a[_0x35fe96(0x20b)]&&_0x3ad0b9[_0x35fe96(0x21a)]==_0x5d9d9a[_0x35fe96(0x21a)]&&_0x3ad0b9['invoice']==_0x5d9d9a[_0x35fe96(0x202)]&&(_0x3ad0b9[_0x35fe96(0x27e)]=_0x3ad0b9[_0x35fe96(0x27e)]+_0x5d9d9a[_0x35fe96(0x215)]));});}return _0x3b94a9;});Promise[_0x520fbc(0x1da)](_0x2f05f7)[_0x520fbc(0x1ce)](async _0x27e974=>{var _0x259568=_0x520fbc;try{for(const _0xb13857 of _0x27e974){await _0xb13857['save']();}_0x5013e8['finalize']='True';const _0x2ce261=await _0x5013e8[_0x259568(0x28d)](),_0x4bddb4=await master_shop[_0x259568(0x222)](),_0x40e7f3=await email_settings[_0x259568(0x1f0)](),_0x404f2b=await supervisor_settings[_0x259568(0x222)]();var _0x3d6138=_0x5013e8[_0x259568(0x200)],_0x2e607b='',_0x2dbfaf;for(_0x2dbfaf in _0x3d6138){var _0x5522ee='FG';_0x5013e8[_0x259568(0x1c8)]==_0x259568(0x273)&&(_0x5522ee='DG'),_0x2e607b+=_0x259568(0x20f)+_0x259568(0x278)+_0x3d6138[_0x2dbfaf][_0x259568(0x251)]+_0x259568(0x25d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d6138[_0x2dbfaf][_0x259568(0x20c)]+_0x259568(0x25d)+_0x259568(0x278)+_0x3d6138[_0x2dbfaf][_0x259568(0x215)]+_0x259568(0x25d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d6138[_0x2dbfaf][_0x259568(0x25c)]+_0x259568(0x25d)+_0x259568(0x278)+_0x3d6138[_0x2dbfaf][_0x259568(0x244)]+'</td>'+_0x259568(0x278)+_0x5013e8[_0x259568(0x1c8)]+_0x259568(0x25d)+_0x259568(0x278)+_0x3d6138[_0x2dbfaf][_0x259568(0x1d8)]+_0x259568(0x25d)+_0x259568(0x278)+_0x5522ee+_0x3d6138[_0x2dbfaf]['bay']+'</td>'+_0x259568(0x25f);}let _0x30ad91=nodemailer[_0x259568(0x254)]({'host':_0x40e7f3[_0x259568(0x249)],'port':Number(_0x40e7f3[_0x259568(0x268)]),'secure':![],'auth':{'user':_0x40e7f3[_0x259568(0x26c)],'pass':_0x40e7f3[_0x259568(0x23d)]}}),_0x5eda39={'from':_0x40e7f3['email'],'to':_0x404f2b[0x0]['FGSEmail'],'subject':_0x259568(0x1d6),'attachments':[{'filename':_0x259568(0x1d2),'path':__dirname+_0x259568(0x21f)+'/upload/'+_0x4bddb4[0x0]['image'],'cid':'logo'}],'html':_0x259568(0x230)+_0x259568(0x1dc)+'</head><body>'+_0x259568(0x1e1)+_0x259568(0x217)+_0x259568(0x1e1)+_0x259568(0x280)+_0x259568(0x20a)+_0x259568(0x1e1)+_0x259568(0x26a)+_0x4bddb4[0x0][_0x259568(0x240)]+_0x259568(0x1e8)+'</div>'+_0x259568(0x20a)+_0x259568(0x259)+_0x259568(0x1e1)+_0x259568(0x234)+_0x259568(0x211)+_0x5013e8[_0x259568(0x202)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x259568(0x26d)+_0x5013e8[_0x259568(0x24a)]+'\x20'+_0x259568(0x208)+_0x259568(0x1f5)+_0x259568(0x20a)+_0x259568(0x1ef)+_0x259568(0x272)+'<tr>'+_0x259568(0x1ff)+_0x259568(0x256)+_0x259568(0x242)+_0x259568(0x267)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x259568(0x1c9)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x259568(0x1d7)+_0x259568(0x25f)+_0x259568(0x22a)+_0x259568(0x248)+'\x20'+_0x2e607b+'\x20'+_0x259568(0x279)+'</table>'+_0x259568(0x1e1)+_0x259568(0x236)+_0x259568(0x21b)+_0x4bddb4[0x0][_0x259568(0x240)]+'</h5>'+_0x259568(0x20a)+'</div>'+_0x259568(0x22b)};_0x30ad91['sendMail'](_0x5eda39,function(_0x27e0ac,_0x50b95){var _0x52bcd4=_0x259568;_0x27e0ac?(console[_0x52bcd4(0x231)](_0x27e0ac),console[_0x52bcd4(0x231)](_0x52bcd4(0x1d4))):console[_0x52bcd4(0x231)]('Email\x20sent\x20successfully');}),_0xab92fd[_0x259568(0x21c)]('success',_0x259568(0x1eb)),_0x1c0f5b[_0x259568(0x212)](_0x259568(0x1c7)+_0x2ce261[_0x259568(0x207)]);}catch(_0x3011e7){console[_0x259568(0x1f3)](_0x3011e7),_0x1c0f5b[_0x259568(0x266)](0x1f4)[_0x259568(0x1fd)]({'error':_0x259568(0x239)});}})[_0x520fbc(0x232)](_0x448b79=>{var _0x39b186=_0x520fbc;console[_0x39b186(0x1f3)](_0x448b79),_0x1c0f5b[_0x39b186(0x266)](0x1f4)[_0x39b186(0x1fd)]({'error':_0x39b186(0x24f)});});}catch(_0x47cb4b){_0x1c0f5b[_0x520fbc(0x1fd)]({'message':_0x47cb4b['message']});}}),router[a0_0x24aeaa(0x203)](a0_0x24aeaa(0x289),auth,async(_0x288920,_0x5c77df)=>{var _0x424bab=a0_0x24aeaa;try{const {username:_0x4bb0e6,email:_0x38cf66,role:_0x388a3e}=_0x288920['user'],_0x4a2152=_0x288920[_0x424bab(0x1e3)],_0x460161=await profile[_0x424bab(0x1f0)]({'email':_0x4a2152[_0x424bab(0x26c)]}),_0x348dcc=await master_shop[_0x424bab(0x222)]();console[_0x424bab(0x231)](_0x424bab(0x1f7),_0x348dcc);const _0x5743f7=_0x288920[_0x424bab(0x1c5)]['id'],_0x3aa172=await adjustment_finished[_0x424bab(0x238)]({'_id':_0x5743f7});let _0x1ed57b=new Date(_0x3aa172['expiry_date']),_0x5ccc5d=('0'+_0x1ed57b[_0x424bab(0x20d)]())['slice'](-0x2),_0x554d5d=('0'+(_0x1ed57b[_0x424bab(0x1c6)]()+0x1))[_0x424bab(0x255)](-0x2),_0x67724=_0x1ed57b['getFullYear'](),_0x426e37=_0x67724+'-'+_0x554d5d+'-'+_0x5ccc5d;var _0x247111=[_0x424bab(0x247),_0x424bab(0x245),_0x424bab(0x262)];const _0x2880a4=await purchases['aggregate']([{'$match':{'warehouse_name':_0x3aa172[_0x424bab(0x1c8)]}},{'$unwind':'$product'},{'$group':{'_id':_0x424bab(0x26e)}}]);console['log'](_0x424bab(0x1ee),_0x2880a4);const _0x23269c=await product[_0x424bab(0x222)]({}),_0x1a2945=await warehouse['aggregate']([{'$match':{'name':_0x3aa172[_0x424bab(0x1c8)],'room':_0x3aa172['room']}},{'$unwind':_0x424bab(0x1de)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x424bab(0x1e5)},'product_stock':{'$first':_0x424bab(0x1cc)},'bay':{'$first':_0x424bab(0x22d)},'bin':{'$first':_0x424bab(0x286)},'type':{'$first':_0x424bab(0x28c)},'floorlevel':{'$first':_0x424bab(0x26f)},'primary_code':{'$first':_0x424bab(0x241)},'secondary_code':{'$first':_0x424bab(0x25b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x424bab(0x214)}}}]);if(_0x348dcc[0x0][_0x424bab(0x257)]==_0x424bab(0x1cd)){var _0x1237b9=users['English'];console[_0x424bab(0x231)](_0x1237b9);}else{if(_0x348dcc[0x0][_0x424bab(0x257)]==_0x424bab(0x288))var _0x1237b9=users[_0x424bab(0x288)];else{if(_0x348dcc[0x0][_0x424bab(0x257)]=='German')var _0x1237b9=users[_0x424bab(0x1f2)];else{if(_0x348dcc[0x0][_0x424bab(0x257)]==_0x424bab(0x25a))var _0x1237b9=users[_0x424bab(0x25a)];else{if(_0x348dcc[0x0]['language']==_0x424bab(0x1db))var _0x1237b9=users[_0x424bab(0x1db)];else{if(_0x348dcc[0x0]['language']==_0x424bab(0x261))var _0x1237b9=users[_0x424bab(0x269)];else{if(_0x348dcc[0x0]['language']==_0x424bab(0x229))var _0x1237b9=users[_0x424bab(0x229)];else{if(_0x348dcc[0x0][_0x424bab(0x257)]==_0x424bab(0x24d))var _0x1237b9=users[_0x424bab(0x1f9)];}}}}}}}_0x5c77df[_0x424bab(0x1df)](_0x424bab(0x1cb),{'success':_0x288920['flash']('success'),'errors':_0x288920[_0x424bab(0x21c)]('errors'),'role':_0x4a2152,'profile':_0x460161,'adjustment':_0x3aa172,'stock':_0x1a2945,'master_shop':_0x348dcc,'warehouse_name':_0x2880a4,'unit':_0x23269c,'language':_0x1237b9,'rooms_data':_0x247111,'ed_fullDate':_0x426e37});}catch(_0x271816){console[_0x424bab(0x231)](_0x271816),_0x5c77df[_0x424bab(0x266)](0xc8)[_0x424bab(0x1fd)]({'message':_0x271816[_0x424bab(0x27d)]});}}),router['post'](a0_0x24aeaa(0x289),auth,async(_0x462c0e,_0x42e644)=>{var _0x11e635=a0_0x24aeaa;try{const _0x218952=_0x462c0e['params']['id'],_0x59e413=await adjustment_finished[_0x11e635(0x238)]({'_id':_0x218952}),_0x23d72d=await warehouse[_0x11e635(0x1f0)]({'name':_0x59e413[_0x11e635(0x1c8)],'room':_0x59e413[_0x11e635(0x243)]}),{warehouse_name:_0x4c99eb,date:_0x33ab63,prod_name:_0x7cab01,level:_0x41570a,isle:_0x3f58c9,pallet:_0x3d29ce,stock:_0x264be2,types:_0x4b63a8,adjust_qty:_0x4cf361,new_adjust_qty:_0x2e4210,note:_0x40b1f0,Room_name:_0x52fc80,invoice:_0x307025,JO_number:_0x8374fd}=_0x462c0e[_0x11e635(0x27c)];if(typeof _0x7cab01=='string')var _0x28e813=[_0x462c0e[_0x11e635(0x27c)][_0x11e635(0x23c)]],_0x44403a=[_0x462c0e[_0x11e635(0x27c)][_0x11e635(0x287)]],_0x2a1eaa=[_0x462c0e['body'][_0x11e635(0x277)]],_0x47bbf2=[_0x462c0e['body'][_0x11e635(0x1f4)]],_0x549d70=[_0x462c0e[_0x11e635(0x27c)][_0x11e635(0x215)]],_0x293ef6=[_0x462c0e['body'][_0x11e635(0x22f)]],_0x18cc0e=[_0x462c0e[_0x11e635(0x27c)]['prod_code']],_0x444861=[_0x462c0e['body'][_0x11e635(0x25c)]],_0x1dedf1=[_0x462c0e['body'][_0x11e635(0x27a)]],_0x38084a=[_0x462c0e[_0x11e635(0x27c)][_0x11e635(0x21a)]],_0x4c32e2=[_0x462c0e[_0x11e635(0x27c)]['expiry_date']];else var _0x28e813=[..._0x462c0e['body'][_0x11e635(0x23c)]],_0x44403a=[..._0x462c0e['body']['level']],_0x2a1eaa=[..._0x462c0e[_0x11e635(0x27c)][_0x11e635(0x277)]],_0x47bbf2=[..._0x462c0e[_0x11e635(0x27c)][_0x11e635(0x1f4)]],_0x549d70=[..._0x462c0e['body']['adjust_qty']],_0x293ef6=[..._0x462c0e['body']['new_adjust_qty']],_0x18cc0e=[..._0x462c0e[_0x11e635(0x27c)]['prod_code']],_0x444861=[..._0x462c0e['body'][_0x11e635(0x25c)]],_0x1dedf1=[..._0x462c0e['body'][_0x11e635(0x27a)]],_0x38084a=[..._0x462c0e[_0x11e635(0x27c)][_0x11e635(0x21a)]],_0x4c32e2=[..._0x462c0e['body'][_0x11e635(0x260)]];const _0x2100f0=_0x28e813[_0x11e635(0x1d0)](_0x23d76e=>{return _0x23d76e={'product_name':_0x23d76e};});_0x44403a[_0x11e635(0x226)]((_0x2b59c2,_0x2e5453)=>{var _0x338a42=_0x11e635;_0x2100f0[_0x2e5453][_0x338a42(0x1d5)]=_0x2b59c2;}),_0x2a1eaa[_0x11e635(0x226)]((_0x364cc7,_0x23d59e)=>{var _0x462ac9=_0x11e635;_0x2100f0[_0x23d59e][_0x462ac9(0x1cf)]=_0x364cc7;}),_0x47bbf2[_0x11e635(0x226)]((_0x55abac,_0x1e8cfd)=>{var _0x338078=_0x11e635;_0x2100f0[_0x1e8cfd][_0x338078(0x1f4)]=_0x55abac;}),_0x549d70[_0x11e635(0x226)]((_0x1942bc,_0x6e0521)=>{var _0x568a5b=_0x11e635;_0x2100f0[_0x6e0521][_0x568a5b(0x215)]=_0x1942bc;}),_0x293ef6[_0x11e635(0x226)]((_0x2d1656,_0x442c0b)=>{_0x2100f0[_0x442c0b]['new_adjust_qty']=_0x2d1656;}),_0x444861[_0x11e635(0x226)]((_0x3acc1a,_0x29f254)=>{_0x2100f0[_0x29f254]['unit']=_0x3acc1a;}),_0x1dedf1[_0x11e635(0x226)]((_0x18a23d,_0x15ca0e)=>{var _0x28b22d=_0x11e635;_0x2100f0[_0x15ca0e][_0x28b22d(0x244)]=_0x18a23d;}),_0x18cc0e['forEach']((_0x10d36d,_0xfdea73)=>{_0x2100f0[_0xfdea73]['product_code']=_0x10d36d;}),_0x38084a[_0x11e635(0x226)]((_0x80bd33,_0x798aac)=>{var _0x1d9a46=_0x11e635;_0x2100f0[_0x798aac][_0x1d9a46(0x21a)]=_0x80bd33;}),_0x4c32e2[_0x11e635(0x226)]((_0x27cdca,_0x1ea564)=>{var _0xfb5cb1=_0x11e635;_0x2100f0[_0x1ea564][_0xfb5cb1(0x260)]=_0x27cdca;});const _0x1d3f15=_0x2100f0['filter'](_0x391292=>_0x391292[_0x11e635(0x215)]!=='0'&&_0x391292[_0x11e635(0x215)]!=='');var _0x225a64=0x0;_0x1d3f15['forEach'](_0x21ab6b=>{var _0x2f46e3=_0x11e635;console['log'](_0x2f46e3(0x1e6),_0x21ab6b),parseInt(_0x21ab6b[_0x2f46e3(0x215)])<=0x0&&_0x225a64++;});if(_0x225a64!=0x0)return _0x462c0e[_0x11e635(0x21c)](_0x11e635(0x28e),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x42e644[_0x11e635(0x212)]('back');_0x59e413['warehouse_name']=_0x4c99eb,_0x59e413[_0x11e635(0x24a)]=_0x33ab63,_0x59e413[_0x11e635(0x200)]=_0x1d3f15,_0x59e413[_0x11e635(0x205)]=_0x40b1f0,_0x59e413[_0x11e635(0x243)]=_0x52fc80,_0x59e413[_0x11e635(0x202)]=_0x307025,_0x59e413['JO_number']=_0x8374fd;const _0x254df9=await _0x59e413[_0x11e635(0x28d)](),_0x3dc0fd=await warehouse[_0x11e635(0x1f0)]({'name':_0x4c99eb,'room':_0x52fc80});_0x254df9[_0x11e635(0x200)][_0x11e635(0x226)](_0x5ecffb=>{var _0x4474af=_0x11e635;const _0x12b017=_0x3dc0fd[_0x4474af(0x23b)][_0x4474af(0x1d0)](_0x388b49=>{var _0x526ada=_0x4474af;_0x5ecffb[_0x526ada(0x1f4)]==_0x526ada(0x210)?_0x388b49[_0x526ada(0x251)]==_0x5ecffb[_0x526ada(0x251)]&&_0x388b49[_0x526ada(0x1d5)]==_0x5ecffb[_0x526ada(0x1d5)]&&(_0x388b49[_0x526ada(0x27e)]=parseInt(_0x388b49[_0x526ada(0x27e)])-parseInt(_0x5ecffb[_0x526ada(0x215)])):_0x388b49['product_name']==_0x5ecffb['product_name']&&_0x388b49[_0x526ada(0x1d5)]==_0x5ecffb[_0x526ada(0x1d5)]&&(_0x388b49['product_stock']=parseInt(_0x388b49[_0x526ada(0x27e)])+parseInt(_0x5ecffb[_0x526ada(0x215)]));});}),await _0x3dc0fd[_0x11e635(0x28d)](),_0x462c0e['flash'](_0x11e635(0x282),_0x11e635(0x23a)),_0x42e644[_0x11e635(0x212)](_0x11e635(0x1fe));}catch(_0x20bfb1){console[_0x11e635(0x231)](_0x20bfb1);}}),router['post']('/barcode_scanner',async(_0x111a4c,_0x3192a1)=>{var _0x46a4bf=a0_0x24aeaa;const {primary_code:_0x1fe458,warehouse_data:_0x445991,rooms_data:_0x40101b,Roomslist:_0x29f3fb}=_0x111a4c[_0x46a4bf(0x27c)],_0xb2bdd4=_0x29f3fb[_0x46a4bf(0x1d9)](','),_0x2ab583=[];async function _0x19cac0(_0x530851){var _0x210fdc=_0x46a4bf;const _0x4223a8=await warehouse['aggregate']([{'$match':{'name':_0x445991,'room':_0x530851}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1fe458}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x210fdc(0x1e5)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x210fdc(0x241)},'secondary_code':{'$first':_0x210fdc(0x25b)},'product_code':{'$first':_0x210fdc(0x1f1)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x210fdc(0x26f)},'unit':{'$first':_0x210fdc(0x21d)},'secondary_unit':{'$first':_0x210fdc(0x20e)},'storage':{'$first':_0x210fdc(0x1fa)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x210fdc(0x233)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x210fdc(0x1d3)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x210fdc(0x1e2)},'roomNamed':{'$first':_0x210fdc(0x28f)},'invoice':{'$first':_0x210fdc(0x250)}}}]),_0x545267=await warehouse['aggregate']([{'$match':{'name':_0x445991,'room':_0x530851}},{'$unwind':_0x210fdc(0x1de)},{'$match':{'product_details.secondary_code':_0x1fe458}},{'$group':{'_id':_0x210fdc(0x213),'name':{'$first':_0x210fdc(0x1e5)},'product_stock':{'$first':_0x210fdc(0x1cc)},'primary_code':{'$first':_0x210fdc(0x241)},'secondary_code':{'$first':_0x210fdc(0x25b)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x210fdc(0x22d)},'isle':{'$first':_0x210fdc(0x286)},'type':{'$first':_0x210fdc(0x28c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x210fdc(0x21d)},'secondary_unit':{'$first':_0x210fdc(0x20e)},'storage':{'$first':_0x210fdc(0x1fa)},'rack':{'$first':_0x210fdc(0x214)},'expiry_date':{'$first':_0x210fdc(0x233)},'production_date':{'$first':_0x210fdc(0x276)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x210fdc(0x1e2)},'roomNamed':{'$first':'$room'},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x4223a8[_0x210fdc(0x216)]>0x0)_0x2ab583['push'](_0x4223a8);else _0x545267[_0x210fdc(0x216)]>0x0&&_0x2ab583['push'](_0x545267);}const _0x381523=_0xb2bdd4['map'](_0x34c191=>_0x19cac0(_0x34c191));await Promise[_0x46a4bf(0x1da)](_0x381523),_0x3192a1[_0x46a4bf(0x1fd)](_0x2ab583);}),router['post'](a0_0x24aeaa(0x24e),async(_0x5dbcaa,_0x5505eb)=>{var _0x302082=a0_0x24aeaa;const {productCode:_0x554761,bay:_0x11e60e,warehouses:_0x366d3b,room:_0x1e696b}=_0x5dbcaa[_0x302082(0x27c)];console[_0x302082(0x231)](_0x5dbcaa[_0x302082(0x27c)]);try{const _0x562cac=await warehouse[_0x302082(0x1e7)]([{'$match':{'name':_0x366d3b,'room':_0x1e696b}},{'$unwind':_0x302082(0x1de)},{'$match':{'product_details.bay':parseInt(_0x11e60e)}},{'$group':{'_id':_0x302082(0x213),'name':{'$first':_0x302082(0x1e5)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x302082(0x22d)},'maxProducts':{'$first':_0x302082(0x209)}}}]);_0x5505eb[_0x302082(0x266)](0xc8)['json'](_0x562cac);}catch(_0x3dab10){_0x5505eb['status'](0x194)[_0x302082(0x1fd)]({'message':_0x3dab10['message']});}}),module[a0_0x24aeaa(0x26b)]=router;