var a0_0x53c91e=a0_0x4705;function a0_0x58a6(){var _0x1a6114=['<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','1323tncuVD','$product_details.primary_code','then','Secondary_units','Logo.png','production_date','Arabic','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','port','/preview/:id','split','post','params','/CheckingWarehouse','product_code','Email\x20sent\x20successfully','$product_details.expiry_date','$product_details.invoice','log','$product_details.product_code','filter','</head><body>','$product_details.secondary_code','random','warehouse_name','Hindi','status','length','map','toString','$finalize','add','minus','$product.room_names','German','date','getDate','foreach\x20newproduct','room_names','$product_details.bay','stock','Enabled','purchases_data','Chinese','$product_details.secondary_unit','$product_details','warehouse','</td>','findOne','Primary_Units','<tr>','room','Adjustment\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','adjustment\x20add\x20successfull','New_Qty_Converted','$product_details.product_stock','adjustment\x20data\x20update\x20successfully','/view/:id','ADJF-','/view/add_adjustment','10ETSxgG','floor','push','edit_adjustment_finished_view','True','$product_details.bin','level','email','$product_details.maxProducts','\x20Order\x20Date\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','secondary_unit','string','image','$invoice','site_title','json','40WqjyEF','role','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<h2>\x20','43012iUwAJr','../public/language/languages.json','bay','prod_code','</h5>','edit_adjustment_finished','prod_invoice','back','save','prod_name','422329ZUljdG','error','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Enclosed','<html><head><title></title>','user','</table>','</body></html>','<div>','/adjustment_finished/view','padStart','English','$product_details.rack','render','success','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$room','</div>','$product_details.maxPerUnit','DRY\x20GOODS','invoice','add_adjustment_finished','Portuguese','New_Qty_Converted_adj','Spanish','prod_cat','$product_details.floorlevel','Return\x20Rooms','</tr>','unit','find','redirect','getMonth','1918Rnhcge','$name','170rYIJKF','Portuguese\x20(BR)','new_adjust_qty','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','adjustment_finished','$product_details.unit','$product','French','$product_details.production_date','expiry_date','310457hzoeIL','329322TqzsMO','English\x20(US)','getFullYear','<table\x20style=\x22width:\x20100%\x20!important;\x22>','JO_number','/picking_list/PDF_adjustment/','catch','host','flash','forEach','/adjustment_finished/preview/','adjust_qty','/barcode_scanner','/../public','<strong>\x20Regards\x20</strong>','<!DOCTYPE\x20html>','stockBefore','Arabic\x20(ae)','Adjustment\x20Finalize\x20Successfully','maxPerUnit','$warehouse_name','$product_details.storage','password','types','$product_details.product_name','product_details','Rooms','language','product_stock','</tbody>','<span\x20style=\x22float:\x20right;\x22>','Ambient','</span>','exports','logo','Error\x20Occurs','$product_details._id','Finished\x20Goods','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.type','master','batch_code','get','nodemailer','note','product_name','errors','$product_details.batch_code','An\x20error\x20occurred\x20while\x20saving\x20data.','</thead>','createTransport','QA\x20Warehouse','../models/all_models','aggregate','findById','596475wCyWzD','4994198xGpydO','product_date','body','product','all','staff'];a0_0x58a6=function(){return _0x1a6114;};return a0_0x58a6();}function a0_0x4705(_0x1c6d0a,_0x598d93){var _0x58a67e=a0_0x58a6();return a0_0x4705=function(_0x4705c2,_0x2c3966){_0x4705c2=_0x4705c2-0x1cb;var _0x2a3c47=_0x58a67e[_0x4705c2];return _0x2a3c47;},a0_0x4705(_0x1c6d0a,_0x598d93);}(function(_0x10e477,_0x18959d){var _0x5115ed=a0_0x4705,_0x5458a2=_0x10e477();while(!![]){try{var _0x2dd225=parseInt(_0x5115ed(0x255))/0x1+parseInt(_0x5115ed(0x276))/0x2*(parseInt(_0x5115ed(0x1f9))/0x3)+parseInt(_0x5115ed(0x24b))/0x4*(-parseInt(_0x5115ed(0x278))/0x5)+parseInt(_0x5115ed(0x284))/0x6+parseInt(_0x5115ed(0x283))/0x7*(parseInt(_0x5115ed(0x247))/0x8)+-parseInt(_0x5115ed(0x1f1))/0x9+-parseInt(_0x5115ed(0x236))/0xa*(parseInt(_0x5115ed(0x1f2))/0xb);if(_0x2dd225===_0x18959d)break;else _0x5458a2['push'](_0x5458a2['shift']());}catch(_0x3ef641){_0x5458a2['push'](_0x5458a2['shift']());}}}(a0_0x58a6,0x399db));const express=require('express'),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x53c91e(0x1ee)),users=require(a0_0x53c91e(0x24c)),nodemailer=require(a0_0x53c91e(0x1e5));router[a0_0x53c91e(0x1e4)]('/view',auth,async(_0x25dfd6,_0x23c7cc)=>{var _0x5530a9=a0_0x53c91e;try{const {username:_0x15b9cc,email:_0xb05d8d,role:_0x2ad258}=_0x25dfd6[_0x5530a9(0x25a)],_0x4210e5=_0x25dfd6[_0x5530a9(0x25a)],_0x3fc8ef=await profile['findOne']({'email':_0x4210e5[_0x5530a9(0x23d)]}),_0x364e67=await master_shop[_0x5530a9(0x273)]();let _0x41187;if(_0x4210e5[_0x5530a9(0x248)]==_0x5530a9(0x1f7)){const _0x3adb9f=await staff[_0x5530a9(0x229)]({'email':_0x4210e5[_0x5530a9(0x23d)]});_0x41187=await warehouse[_0x5530a9(0x273)]({'status':_0x5530a9(0x222),'name':_0x3adb9f['warehouse']});}else _0x41187=await warehouse[_0x5530a9(0x273)]({'status':'Enabled'});const _0x5c7613=await product[_0x5530a9(0x273)]();let _0x5380b8;if(_0x4210e5[_0x5530a9(0x248)]==_0x5530a9(0x1f7)){const _0x1b56a2=await staff[_0x5530a9(0x229)]({'email':_0x4210e5['email']});_0x5380b8=await adjustment_finished[_0x5530a9(0x273)]({'warehouse_name':_0x1b56a2[_0x5530a9(0x227)]});}else _0x5380b8=await adjustment_finished[_0x5530a9(0x1ef)]([{'$unwind':_0x5530a9(0x27f)},{'$group':{'_id':'$_id','invoice':{'$first':_0x5530a9(0x244)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x5530a9(0x1ce)},'room':{'$addToSet':_0x5530a9(0x21a)},'finalize':{'$first':_0x5530a9(0x217)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x364e67[0x0][_0x5530a9(0x1d5)]==_0x5530a9(0x285)){var _0x2aed06=users[_0x5530a9(0x260)];console[_0x5530a9(0x20b)](_0x2aed06);}else{if(_0x364e67[0x0]['language']=='Hindi')var _0x2aed06=users[_0x5530a9(0x212)];else{if(_0x364e67[0x0][_0x5530a9(0x1d5)]=='German')var _0x2aed06=users['German'];else{if(_0x364e67[0x0][_0x5530a9(0x1d5)]==_0x5530a9(0x26d))var _0x2aed06=users['Spanish'];else{if(_0x364e67[0x0][_0x5530a9(0x1d5)]==_0x5530a9(0x280))var _0x2aed06=users[_0x5530a9(0x280)];else{if(_0x364e67[0x0][_0x5530a9(0x1d5)]==_0x5530a9(0x279))var _0x2aed06=users[_0x5530a9(0x26b)];else{if(_0x364e67[0x0]['language']==_0x5530a9(0x224))var _0x2aed06=users[_0x5530a9(0x224)];else{if(_0x364e67[0x0][_0x5530a9(0x1d5)]==_0x5530a9(0x1cb))var _0x2aed06=users['Arabic'];}}}}}}}_0x23c7cc[_0x5530a9(0x262)](_0x5530a9(0x27d),{'success':_0x25dfd6[_0x5530a9(0x28c)](_0x5530a9(0x263)),'errors':_0x25dfd6[_0x5530a9(0x28c)]('errors'),'role':_0x4210e5,'profile':_0x3fc8ef,'warehouse':_0x41187,'product':_0x5c7613,'adjustment':_0x5380b8,'master_shop':_0x364e67,'language':_0x2aed06});}catch(_0x44007f){console[_0x5530a9(0x20b)](_0x44007f);}});async function getRandom8DigitNumber(){var _0x2698c0=a0_0x53c91e;const _0x573136=0x989680,_0x5813fe=0x5f5e0ff,_0x320d0f=Math[_0x2698c0(0x237)](Math[_0x2698c0(0x210)]()*(_0x5813fe-_0x573136+0x1))+_0x573136;var _0x506316;const _0x13f80f=await adjustment_finished[_0x2698c0(0x229)]({'invoice':_0x2698c0(0x234)+_0x320d0f});return _0x13f80f&&_0x13f80f[_0x2698c0(0x214)]>0x0?_0x506316=_0x2698c0(0x234)+_0x320d0f:_0x506316='ADJF-'+_0x320d0f,_0x506316;}router[a0_0x53c91e(0x1e4)](a0_0x53c91e(0x235),auth,async(_0x2ac821,_0x3aa79e)=>{var _0x498d56=a0_0x53c91e;try{const {username:_0x476903,email:_0x2bf035,role:_0x326b8c}=_0x2ac821['user'],_0x29cc34=_0x2ac821[_0x498d56(0x25a)],_0x39857e=await profile['findOne']({'email':_0x29cc34[_0x498d56(0x23d)]}),_0x3fed8c=await master_shop[_0x498d56(0x273)]();let _0x5ba690;if(_0x29cc34[_0x498d56(0x248)]==_0x498d56(0x1f7)){const _0x8fca63=await staff[_0x498d56(0x229)]({'email':_0x29cc34[_0x498d56(0x23d)]});_0x5ba690=await warehouse[_0x498d56(0x1ef)]([{'$match':{'status':_0x498d56(0x222),'name':_0x8fca63['warehouse'],'warehouse_category':_0x498d56(0x1df),'name':{'$ne':_0x498d56(0x1ed)}}},{'$group':{'_id':'$name','name':{'$first':_0x498d56(0x277)}}}]);}else _0x5ba690=await warehouse['aggregate']([{'$match':{'status':_0x498d56(0x222),'warehouse_category':_0x498d56(0x1df),'name':{'$ne':_0x498d56(0x1ed)}}},{'$group':{'_id':_0x498d56(0x277),'name':{'$first':_0x498d56(0x277)}}}]);const _0x4b4397=await product['find']({}),_0x6c55a6=await adjustment_finished[_0x498d56(0x273)]({}),_0x57fb58=_0x6c55a6['length']+0x1,_0x1bb428=_0x498d56(0x234)+_0x57fb58[_0x498d56(0x216)]()[_0x498d56(0x25f)](0x5,'0');var _0x4da8d3=[_0x498d56(0x1d9),_0x498d56(0x258),_0x498d56(0x270)];if(_0x3fed8c[0x0][_0x498d56(0x1d5)]==_0x498d56(0x285))var _0x461e32=users[_0x498d56(0x260)];else{if(_0x3fed8c[0x0]['language']==_0x498d56(0x212))var _0x461e32=users[_0x498d56(0x212)];else{if(_0x3fed8c[0x0][_0x498d56(0x1d5)]==_0x498d56(0x21b))var _0x461e32=users[_0x498d56(0x21b)];else{if(_0x3fed8c[0x0][_0x498d56(0x1d5)]==_0x498d56(0x26d))var _0x461e32=users[_0x498d56(0x26d)];else{if(_0x3fed8c[0x0]['language']==_0x498d56(0x280))var _0x461e32=users[_0x498d56(0x280)];else{if(_0x3fed8c[0x0]['language']==_0x498d56(0x279))var _0x461e32=users['Portuguese'];else{if(_0x3fed8c[0x0][_0x498d56(0x1d5)]==_0x498d56(0x224))var _0x461e32=users['Chinese'];else{if(_0x3fed8c[0x0][_0x498d56(0x1d5)]==_0x498d56(0x1cb))var _0x461e32=users[_0x498d56(0x1ff)];}}}}}}}const _0x176b5b=getRandom8DigitNumber();_0x176b5b[_0x498d56(0x1fb)](_0x382846=>{var _0xe264f1=_0x498d56;_0x3aa79e['render'](_0xe264f1(0x26a),{'success':_0x2ac821[_0xe264f1(0x28c)](_0xe264f1(0x263)),'errors':_0x2ac821[_0xe264f1(0x28c)](_0xe264f1(0x1e8)),'role':_0x29cc34,'profile':_0x39857e,'warehouse':_0x5ba690,'product':_0x4b4397,'master_shop':_0x3fed8c,'language':_0x461e32,'rooms_data':_0x4da8d3,'invoice_no':_0x382846});})[_0x498d56(0x28a)](_0x3e0242=>{var _0x41de8b=_0x498d56;_0x2ac821[_0x41de8b(0x28c)](_0x41de8b(0x1e8),_0x41de8b(0x249)),_0x3aa79e[_0x41de8b(0x274)]('/adjustment/view');});}catch(_0x365623){console[_0x498d56(0x20b)](_0x365623);}}),router['post'](a0_0x53c91e(0x235),auth,async(_0x393840,_0x1a288f)=>{var _0xb3e06d=a0_0x53c91e;try{const {warehouse_name:_0x173693,date:_0x36e22a,prod_name:_0x2f22c7,level:_0x38fe9e,isle:_0x1655aa,pallet:_0x3a4dc4,stock:_0x497ff1,types:_0xb219b9,adjust_qty:_0x179b8d,new_adjust_qty:_0x462d26,note:_0x2dcb27,Room_name:_0x434aa1,invoice:_0x15eb60,JO_number:_0x24dccf,expiry_date:_0x5949e0}=_0x393840[_0xb3e06d(0x1f4)];if(typeof _0x2f22c7==_0xb3e06d(0x242))var _0x2320a7=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x254)]],_0x7c035=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x23c)]],_0xc19b3=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x221)]],_0x2b7623=[_0x393840['body'][_0xb3e06d(0x1d1)]],_0x2cd73a=[_0x393840['body'][_0xb3e06d(0x26c)]],_0x1c4eaa=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x230)]],_0xe34bbe=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x22a)]],_0x445801=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1fc)]],_0x110c7e=[_0x393840[_0xb3e06d(0x1f4)]['prod_code']],_0x3b143e=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1e3)]],_0x3304d4=[_0x393840[_0xb3e06d(0x1f4)]['expiry_date']],_0x35906d=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1f3)]],_0x3ce63f=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x26e)]],_0x40bb9f=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1d4)]],_0x36ba66=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1cd)]],_0x4d0841=[_0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x251)]];else var _0x2320a7=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x254)]],_0x7c035=[..._0x393840['body'][_0xb3e06d(0x23c)]],_0xc19b3=[..._0x393840[_0xb3e06d(0x1f4)]['stock']],_0x2b7623=[..._0x393840[_0xb3e06d(0x1f4)]['types']],_0x2cd73a=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x26c)]],_0x1c4eaa=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x230)]],_0xe34bbe=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x22a)]],_0x445801=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1fc)]],_0x110c7e=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x24e)]],_0x3b143e=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1e3)]],_0x3304d4=[..._0x393840['body']['expiry_date']],_0x35906d=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1f3)]],_0x3ce63f=[..._0x393840[_0xb3e06d(0x1f4)]['prod_cat']],_0x40bb9f=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1d4)]],_0x36ba66=[..._0x393840[_0xb3e06d(0x1f4)][_0xb3e06d(0x1cd)]],_0x4d0841=[..._0x393840['body']['prod_invoice']];const _0x4cfcf6=_0x2320a7[_0xb3e06d(0x215)](_0x179c7c=>{return _0x179c7c={'product_name':_0x179c7c};});_0x7c035['forEach']((_0x262e5f,_0x2ce4b1)=>{var _0x4b09c2=_0xb3e06d;_0x4cfcf6[_0x2ce4b1][_0x4b09c2(0x24d)]=_0x262e5f;}),_0xc19b3[_0xb3e06d(0x28d)]((_0x136313,_0x143d87)=>{_0x4cfcf6[_0x143d87]['stockBefore']=_0x136313;}),_0x2b7623['forEach']((_0x358e22,_0x2fd468)=>{_0x4cfcf6[_0x2fd468]['types']=_0x358e22;}),_0x2cd73a['forEach']((_0x38085e,_0xd1e0fd)=>{var _0x18a9a7=_0xb3e06d;_0x4cfcf6[_0xd1e0fd][_0x18a9a7(0x28f)]=_0x38085e;}),_0x1c4eaa[_0xb3e06d(0x28d)]((_0x47569d,_0x264fc8)=>{var _0x2cf276=_0xb3e06d;_0x4cfcf6[_0x264fc8][_0x2cf276(0x27a)]=_0x47569d;}),_0xe34bbe[_0xb3e06d(0x28d)]((_0x33a659,_0x4cbc5b)=>{var _0x2f744c=_0xb3e06d;_0x4cfcf6[_0x4cbc5b][_0x2f744c(0x272)]=_0x33a659;}),_0x445801[_0xb3e06d(0x28d)]((_0xff873d,_0x3792b3)=>{_0x4cfcf6[_0x3792b3]['secondary_unit']=_0xff873d;}),_0x110c7e['forEach']((_0x51b6c4,_0x42e860)=>{var _0x3e02e8=_0xb3e06d;_0x4cfcf6[_0x42e860][_0x3e02e8(0x207)]=_0x51b6c4;}),_0x3b143e[_0xb3e06d(0x28d)]((_0x14d579,_0x4f31bb)=>{var _0x6b91aa=_0xb3e06d;_0x4cfcf6[_0x4f31bb][_0x6b91aa(0x1e3)]=_0x14d579;}),_0x3304d4[_0xb3e06d(0x28d)]((_0xcd51a9,_0xb43d71)=>{var _0x151a6c=_0xb3e06d;_0x4cfcf6[_0xb43d71][_0x151a6c(0x282)]=_0xcd51a9;}),_0x35906d[_0xb3e06d(0x28d)]((_0x1594cc,_0x3764bc)=>{var _0xf55209=_0xb3e06d;_0x4cfcf6[_0x3764bc][_0xf55209(0x1fe)]=_0x1594cc;}),_0x3ce63f[_0xb3e06d(0x28d)]((_0x1e66d8,_0x458358)=>{var _0x4ff565=_0xb3e06d;_0x4cfcf6[_0x458358][_0x4ff565(0x26e)]=_0x1e66d8;}),_0x40bb9f[_0xb3e06d(0x28d)]((_0x51e4d9,_0x7449ca)=>{var _0x2d1462=_0xb3e06d;_0x4cfcf6[_0x7449ca][_0x2d1462(0x21f)]=_0x51e4d9;}),_0x36ba66[_0xb3e06d(0x28d)]((_0x2a25c8,_0x118683)=>{var _0x48908d=_0xb3e06d;_0x4cfcf6[_0x118683][_0x48908d(0x1cd)]=_0x2a25c8;}),_0x4d0841['forEach']((_0x13dcf7,_0x3d6cf9)=>{var _0x2b44ad=_0xb3e06d;_0x4cfcf6[_0x3d6cf9][_0x2b44ad(0x269)]=_0x13dcf7;});const _0x13c640=_0x4cfcf6[_0xb3e06d(0x20d)](_0x37248f=>_0x37248f[_0xb3e06d(0x28f)]!=='0'&&_0x37248f['adjust_qty']!=='');var _0x58529a=0x0;_0x13c640['forEach'](_0x311d9d=>{var _0x1f3161=_0xb3e06d;console[_0x1f3161(0x20b)](_0x1f3161(0x21e),_0x311d9d),parseInt(_0x311d9d[_0x1f3161(0x28f)])<=0x0&&_0x58529a++;});if(_0x58529a!=0x0)return _0x393840[_0xb3e06d(0x28c)](_0xb3e06d(0x1e8),_0xb3e06d(0x1e0)),_0x1a288f[_0xb3e06d(0x274)]('back');const _0x195f4b=new adjustment_finished({'warehouse_name':_0x173693,'date':_0x36e22a,'product':_0x13c640,'note':_0x2dcb27,'room':_0x434aa1,'invoice':_0x15eb60,'JO_number':_0x24dccf,'expiry_date':_0x5949e0}),_0xca014e=await _0x195f4b[_0xb3e06d(0x253)]();_0x393840[_0xb3e06d(0x28c)](_0xb3e06d(0x263),_0xb3e06d(0x22f)),_0x1a288f['redirect'](_0xb3e06d(0x28e)+_0xca014e['_id']);}catch(_0x1a2176){console[_0xb3e06d(0x20b)](_0x1a2176),_0x1a288f['status'](0xc8)['json']({'message':_0x1a2176[_0xb3e06d(0x27b)]});}}),router[a0_0x53c91e(0x1e4)](a0_0x53c91e(0x202),auth,async(_0x16bb00,_0x42cb20)=>{var _0x1e2923=a0_0x53c91e;try{const {username:_0x1becc1,email:_0x3e0ca9,role:_0x56c6e7}=_0x16bb00[_0x1e2923(0x25a)],_0x368eca=_0x16bb00['user'],_0x41d6b3=await profile[_0x1e2923(0x229)]({'email':_0x368eca[_0x1e2923(0x23d)]}),_0x4e6a72=await master_shop[_0x1e2923(0x273)](),_0xaa412f=_0x16bb00[_0x1e2923(0x205)]['id'],_0x26eece=await adjustment_finished['findById']({'_id':_0xaa412f}),_0x2abe2f=await purchases[_0x1e2923(0x1ef)]([{'$match':{'warehouse_name':_0x26eece['warehouse_name']}},{'$unwind':_0x1e2923(0x27f)},{'$group':{'_id':'$product.product_name'}}]);console[_0x1e2923(0x20b)](_0x1e2923(0x223),_0x2abe2f);const _0x6f7c06=await product['find']({}),_0x4f2622=await warehouse[_0x1e2923(0x1ef)]([{'$match':{'name':_0x26eece['warehouse_name'],'warehouse_category':_0x1e2923(0x1df)}},{'$unwind':_0x1e2923(0x226)},{'$group':{'_id':_0x1e2923(0x1de),'name':{'$first':_0x1e2923(0x1d2)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1e2923(0x23b)},'type':{'$first':_0x1e2923(0x1e1)},'floorlevel':{'$first':_0x1e2923(0x26f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x1e2923(0x20f)},'product_code':{'$first':_0x1e2923(0x20c)},'storage':{'$first':_0x1e2923(0x1cf)},'rack':{'$first':_0x1e2923(0x261)},'expiry_date':{'$first':_0x1e2923(0x209)},'production_date':{'$first':_0x1e2923(0x281)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x1e2923(0x267)},'room':{'$first':_0x1e2923(0x265)}}}]);if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]==_0x1e2923(0x285)){var _0x176aee=users['English'];console[_0x1e2923(0x20b)](_0x176aee);}else{if(_0x4e6a72[0x0]['language']==_0x1e2923(0x212))var _0x176aee=users[_0x1e2923(0x212)];else{if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]=='German')var _0x176aee=users['German'];else{if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]==_0x1e2923(0x26d))var _0x176aee=users[_0x1e2923(0x26d)];else{if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]==_0x1e2923(0x280))var _0x176aee=users[_0x1e2923(0x280)];else{if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]==_0x1e2923(0x279))var _0x176aee=users['Portuguese'];else{if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]==_0x1e2923(0x224))var _0x176aee=users[_0x1e2923(0x224)];else{if(_0x4e6a72[0x0][_0x1e2923(0x1d5)]==_0x1e2923(0x1cb))var _0x176aee=users[_0x1e2923(0x1ff)];}}}}}}}_0x42cb20[_0x1e2923(0x262)](_0x1e2923(0x239),{'success':_0x16bb00[_0x1e2923(0x28c)](_0x1e2923(0x263)),'errors':_0x16bb00[_0x1e2923(0x28c)](_0x1e2923(0x1e8)),'role':_0x368eca,'profile':_0x41d6b3,'adjustment':_0x26eece,'stock':_0x4f2622,'master_shop':_0x4e6a72,'warehouse_name':_0x2abe2f,'unit':_0x6f7c06,'language':_0x176aee});}catch(_0x1ef317){console[_0x1e2923(0x20b)](_0x1ef317),_0x42cb20[_0x1e2923(0x213)](0xc8)[_0x1e2923(0x246)]({'message':_0x1ef317[_0x1e2923(0x27b)]});}}),router[a0_0x53c91e(0x204)](a0_0x53c91e(0x202),auth,async(_0x8a0ba9,_0x5cf3e5)=>{var _0x105d08=a0_0x53c91e;try{const {invoice:_0x47eb5c,warehouse_name:_0x204f22,Room_name:_0x106860}=_0x8a0ba9[_0x105d08(0x1f4)],_0x19a14c=_0x8a0ba9['params']['id'],_0x49bef8=await adjustment_finished['findById']({'_id':_0x19a14c});var _0x4b0612;const _0x400652=_0x49bef8[_0x105d08(0x1f5)]['map'](async _0x7d74e9=>{var _0x244888=_0x105d08;if(_0x7d74e9[_0x244888(0x28f)]>0x0){_0x4b0612=await warehouse[_0x244888(0x229)]({'name':_0x204f22,'room':_0x7d74e9[_0x244888(0x21f)],'warehouse_category':_0x244888(0x1df)});const _0x4f5cce=_0x4b0612[_0x244888(0x1d3)][_0x244888(0x215)](_0xa6d668=>{var _0x51bb54=_0x244888;console[_0x51bb54(0x20b)](_0x7d74e9['types']);if(_0x7d74e9[_0x51bb54(0x1d1)]==_0x51bb54(0x219))_0xa6d668[_0x51bb54(0x1e7)]==_0x7d74e9[_0x51bb54(0x1e7)]&&_0xa6d668[_0x51bb54(0x24d)]==_0x7d74e9[_0x51bb54(0x24d)]&&_0xa6d668[_0x51bb54(0x282)]==_0x7d74e9[_0x51bb54(0x282)]&&_0xa6d668['production_date']==_0x7d74e9[_0x51bb54(0x1fe)]&&_0xa6d668['batch_code']==_0x7d74e9[_0x51bb54(0x1e3)]&&_0xa6d668[_0x51bb54(0x269)]==_0x7d74e9[_0x51bb54(0x269)]&&(_0xa6d668[_0x51bb54(0x1d6)]=_0xa6d668['product_stock']-_0x7d74e9['adjust_qty']);else _0x7d74e9['types']==_0x51bb54(0x218)&&(_0xa6d668[_0x51bb54(0x1e7)]==_0x7d74e9[_0x51bb54(0x1e7)]&&_0xa6d668[_0x51bb54(0x24d)]==_0x7d74e9[_0x51bb54(0x24d)]&&_0xa6d668[_0x51bb54(0x282)]==_0x7d74e9['expiry_date']&&_0xa6d668[_0x51bb54(0x1fe)]==_0x7d74e9[_0x51bb54(0x1fe)]&&_0xa6d668[_0x51bb54(0x1e3)]==_0x7d74e9['batch_code']&&_0xa6d668['invoice']==_0x7d74e9[_0x51bb54(0x269)]&&(_0xa6d668[_0x51bb54(0x1d6)]=_0xa6d668[_0x51bb54(0x1d6)]+_0x7d74e9[_0x51bb54(0x28f)]));});}return _0x4b0612;});Promise['all'](_0x400652)['then'](async _0x269b50=>{var _0xf11239=_0x105d08;try{for(const _0x109028 of _0x269b50){await _0x109028[_0xf11239(0x253)]();}_0x49bef8['finalize']=_0xf11239(0x23a);const _0x3abf93=await _0x49bef8[_0xf11239(0x253)](),_0x550a8b=await master_shop[_0xf11239(0x273)](),_0x29dd0b=await email_settings['findOne'](),_0x9f7e88=await supervisor_settings[_0xf11239(0x273)]();var _0x34d2ea=_0x49bef8['product'],_0x2355aa='',_0x5349a9;for(_0x5349a9 in _0x34d2ea){var _0x1ccf92='FG';_0x49bef8[_0xf11239(0x211)]==_0xf11239(0x268)&&(_0x1ccf92='DG'),_0x2355aa+=_0xf11239(0x22b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x34d2ea[_0x5349a9][_0xf11239(0x1e7)]+_0xf11239(0x228)+_0xf11239(0x264)+_0x34d2ea[_0x5349a9][_0xf11239(0x207)]+_0xf11239(0x228)+_0xf11239(0x264)+_0x34d2ea[_0x5349a9][_0xf11239(0x28f)]+_0xf11239(0x228)+_0xf11239(0x264)+_0x34d2ea[_0x5349a9][_0xf11239(0x272)]+_0xf11239(0x228)+_0xf11239(0x264)+_0x34d2ea[_0x5349a9][_0xf11239(0x241)]+_0xf11239(0x228)+_0xf11239(0x264)+_0x49bef8[_0xf11239(0x211)]+_0xf11239(0x228)+_0xf11239(0x264)+_0x34d2ea[_0x5349a9][_0xf11239(0x21f)]+'</td>'+_0xf11239(0x264)+_0x1ccf92+_0x34d2ea[_0x5349a9]['bay']+_0xf11239(0x228)+_0xf11239(0x271);}let _0x5a7e06=nodemailer[_0xf11239(0x1ec)]({'host':_0x29dd0b[_0xf11239(0x28b)],'port':Number(_0x29dd0b[_0xf11239(0x201)]),'secure':![],'auth':{'user':_0x29dd0b[_0xf11239(0x23d)],'pass':_0x29dd0b[_0xf11239(0x1d0)]}}),_0x326e11={'from':_0x29dd0b[_0xf11239(0x23d)],'to':_0x9f7e88[0x0]['FGSEmail'],'subject':_0xf11239(0x22d),'attachments':[{'filename':_0xf11239(0x1fd),'path':__dirname+_0xf11239(0x291)+'/upload/'+_0x550a8b[0x0][_0xf11239(0x243)],'cid':_0xf11239(0x1dc)}],'html':_0xf11239(0x293)+_0xf11239(0x259)+_0xf11239(0x20e)+_0xf11239(0x25d)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xf11239(0x25d)+_0xf11239(0x1f8)+_0xf11239(0x266)+_0xf11239(0x25d)+_0xf11239(0x24a)+_0x550a8b[0x0][_0xf11239(0x245)]+'\x20</h2>'+_0xf11239(0x266)+_0xf11239(0x266)+'<hr\x20class=\x22my-3\x22>'+_0xf11239(0x25d)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x49bef8[_0xf11239(0x269)]+'\x20'+_0xf11239(0x1d8)+_0xf11239(0x23f)+_0x49bef8['date']+'\x20'+_0xf11239(0x1da)+_0xf11239(0x24f)+_0xf11239(0x266)+_0xf11239(0x287)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xf11239(0x22b)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0xf11239(0x257)+_0xf11239(0x27c)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0xf11239(0x22e)+_0xf11239(0x240)+_0xf11239(0x200)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xf11239(0x271)+_0xf11239(0x1eb)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x2355aa+'\x20'+_0xf11239(0x1d7)+_0xf11239(0x25b)+_0xf11239(0x25d)+_0xf11239(0x292)+'<h5>'+_0x550a8b[0x0][_0xf11239(0x245)]+_0xf11239(0x24f)+_0xf11239(0x266)+_0xf11239(0x266)+_0xf11239(0x25c)};_0x5a7e06['sendMail'](_0x326e11,function(_0x36cf07,_0xfef7c2){var _0xe4cb22=_0xf11239;_0x36cf07?(console[_0xe4cb22(0x20b)](_0x36cf07),console[_0xe4cb22(0x20b)](_0xe4cb22(0x1dd))):console['log'](_0xe4cb22(0x208));}),_0x8a0ba9[_0xf11239(0x28c)]('success',_0xf11239(0x1cc)),_0x5cf3e5['redirect'](_0xf11239(0x289)+_0x3abf93['_id']);}catch(_0xdd87d3){console[_0xf11239(0x256)](_0xdd87d3),_0x5cf3e5[_0xf11239(0x213)](0x1f4)[_0xf11239(0x246)]({'error':_0xf11239(0x1ea)});}})[_0x105d08(0x28a)](_0x1cdad1=>{var _0x1e4ea2=_0x105d08;console[_0x1e4ea2(0x256)](_0x1cdad1),_0x5cf3e5[_0x1e4ea2(0x213)](0x1f4)[_0x1e4ea2(0x246)]({'error':'An\x20error\x20occurred.'});});}catch(_0x119a77){_0x5cf3e5[_0x105d08(0x246)]({'message':_0x119a77[_0x105d08(0x27b)]});}}),router[a0_0x53c91e(0x1e4)]('/view/:id',auth,async(_0x560f3b,_0x463120)=>{var _0x2aef3c=a0_0x53c91e;try{const {username:_0x1e7fdd,email:_0x57dead,role:_0x36ca76}=_0x560f3b['user'],_0x11481d=_0x560f3b[_0x2aef3c(0x25a)],_0x8c8589=await profile[_0x2aef3c(0x229)]({'email':_0x11481d['email']}),_0x4c57d2=await master_shop[_0x2aef3c(0x273)]();console[_0x2aef3c(0x20b)](_0x2aef3c(0x1e2),_0x4c57d2);const _0xd80970=_0x560f3b['params']['id'],_0x2c3fc2=await adjustment_finished[_0x2aef3c(0x1f0)]({'_id':_0xd80970});let _0x3d3e78=new Date(_0x2c3fc2[_0x2aef3c(0x282)]),_0x1ca91d=('0'+_0x3d3e78[_0x2aef3c(0x21d)]())['slice'](-0x2),_0x45a3a2=('0'+(_0x3d3e78[_0x2aef3c(0x275)]()+0x1))['slice'](-0x2),_0xdd65a=_0x3d3e78[_0x2aef3c(0x286)](),_0x8057d6=_0xdd65a+'-'+_0x45a3a2+'-'+_0x1ca91d;var _0x4f1e66=['Ambient',_0x2aef3c(0x258),_0x2aef3c(0x270)];const _0x405b8b=await purchases[_0x2aef3c(0x1ef)]([{'$match':{'warehouse_name':_0x2c3fc2['warehouse_name']}},{'$unwind':_0x2aef3c(0x27f)},{'$group':{'_id':'$product.product_name'}}]);console[_0x2aef3c(0x20b)]('purchases_data',_0x405b8b);const _0x24d148=await product[_0x2aef3c(0x273)]({}),_0x75ab8c=await warehouse['aggregate']([{'$match':{'name':_0x2c3fc2[_0x2aef3c(0x211)],'room':_0x2c3fc2[_0x2aef3c(0x22c)]}},{'$unwind':_0x2aef3c(0x226)},{'$group':{'_id':_0x2aef3c(0x1de),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2aef3c(0x231)},'bay':{'$first':_0x2aef3c(0x220)},'bin':{'$first':_0x2aef3c(0x23b)},'type':{'$first':_0x2aef3c(0x1e1)},'floorlevel':{'$first':_0x2aef3c(0x26f)},'primary_code':{'$first':_0x2aef3c(0x1fa)},'secondary_code':{'$first':_0x2aef3c(0x20f)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x2aef3c(0x1cf)},'rack':{'$first':_0x2aef3c(0x261)}}}]);if(_0x4c57d2[0x0]['language']==_0x2aef3c(0x285)){var _0x161a30=users[_0x2aef3c(0x260)];console[_0x2aef3c(0x20b)](_0x161a30);}else{if(_0x4c57d2[0x0][_0x2aef3c(0x1d5)]==_0x2aef3c(0x212))var _0x161a30=users[_0x2aef3c(0x212)];else{if(_0x4c57d2[0x0][_0x2aef3c(0x1d5)]==_0x2aef3c(0x21b))var _0x161a30=users[_0x2aef3c(0x21b)];else{if(_0x4c57d2[0x0][_0x2aef3c(0x1d5)]==_0x2aef3c(0x26d))var _0x161a30=users['Spanish'];else{if(_0x4c57d2[0x0][_0x2aef3c(0x1d5)]=='French')var _0x161a30=users[_0x2aef3c(0x280)];else{if(_0x4c57d2[0x0][_0x2aef3c(0x1d5)]==_0x2aef3c(0x279))var _0x161a30=users[_0x2aef3c(0x26b)];else{if(_0x4c57d2[0x0]['language']=='Chinese')var _0x161a30=users[_0x2aef3c(0x224)];else{if(_0x4c57d2[0x0][_0x2aef3c(0x1d5)]==_0x2aef3c(0x1cb))var _0x161a30=users[_0x2aef3c(0x1ff)];}}}}}}}_0x463120[_0x2aef3c(0x262)](_0x2aef3c(0x250),{'success':_0x560f3b[_0x2aef3c(0x28c)](_0x2aef3c(0x263)),'errors':_0x560f3b[_0x2aef3c(0x28c)](_0x2aef3c(0x1e8)),'role':_0x11481d,'profile':_0x8c8589,'adjustment':_0x2c3fc2,'stock':_0x75ab8c,'master_shop':_0x4c57d2,'warehouse_name':_0x405b8b,'unit':_0x24d148,'language':_0x161a30,'rooms_data':_0x4f1e66,'ed_fullDate':_0x8057d6});}catch(_0x576917){console[_0x2aef3c(0x20b)](_0x576917),_0x463120[_0x2aef3c(0x213)](0xc8)['json']({'message':_0x576917[_0x2aef3c(0x27b)]});}}),router[a0_0x53c91e(0x204)](a0_0x53c91e(0x233),auth,async(_0x2da6a4,_0x34db5b)=>{var _0x139fe6=a0_0x53c91e;try{const _0x2af322=_0x2da6a4[_0x139fe6(0x205)]['id'],_0x51196f=await adjustment_finished[_0x139fe6(0x1f0)]({'_id':_0x2af322}),_0x4acc1e=await warehouse[_0x139fe6(0x229)]({'name':_0x51196f[_0x139fe6(0x211)],'room':_0x51196f['room']}),{warehouse_name:_0x512ba3,date:_0x512c16,prod_name:_0x4b4729,level:_0x3581ed,isle:_0x417548,pallet:_0x6ffb2,stock:_0x1ed3c2,types:_0x3e9279,adjust_qty:_0x3c2216,new_adjust_qty:_0x58ea69,note:_0x1410e2,Room_name:_0x509062,invoice:_0x36f5be,JO_number:_0x1b136d}=_0x2da6a4[_0x139fe6(0x1f4)];if(typeof _0x4b4729==_0x139fe6(0x242))var _0x3a840f=[_0x2da6a4[_0x139fe6(0x1f4)]['prod_name']],_0x37048f=[_0x2da6a4['body'][_0x139fe6(0x23c)]],_0x521c0b=[_0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x221)]],_0x5ede76=[_0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x1d1)]],_0x1ad453=[_0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x28f)]],_0x1971f3=[_0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x27a)]],_0x3f1333=[_0x2da6a4[_0x139fe6(0x1f4)]['prod_code']],_0x491254=[_0x2da6a4['body']['unit']],_0x31c6d5=[_0x2da6a4['body'][_0x139fe6(0x1fc)]],_0x45b4ef=[_0x2da6a4[_0x139fe6(0x1f4)]['batch_code']],_0x41f704=[_0x2da6a4['body'][_0x139fe6(0x282)]];else var _0x3a840f=[..._0x2da6a4[_0x139fe6(0x1f4)]['prod_name']],_0x37048f=[..._0x2da6a4['body']['level']],_0x521c0b=[..._0x2da6a4['body'][_0x139fe6(0x221)]],_0x5ede76=[..._0x2da6a4[_0x139fe6(0x1f4)]['types']],_0x1ad453=[..._0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x28f)]],_0x1971f3=[..._0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x27a)]],_0x3f1333=[..._0x2da6a4['body'][_0x139fe6(0x24e)]],_0x491254=[..._0x2da6a4['body']['unit']],_0x31c6d5=[..._0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x1fc)]],_0x45b4ef=[..._0x2da6a4[_0x139fe6(0x1f4)][_0x139fe6(0x1e3)]],_0x41f704=[..._0x2da6a4['body']['expiry_date']];const _0x17c5ee=_0x3a840f[_0x139fe6(0x215)](_0x2a16d1=>{return _0x2a16d1={'product_name':_0x2a16d1};});_0x37048f[_0x139fe6(0x28d)]((_0x2896c5,_0x1a4466)=>{_0x17c5ee[_0x1a4466]['bay']=_0x2896c5;}),_0x521c0b['forEach']((_0x1f2e18,_0x5e144e)=>{var _0x4616be=_0x139fe6;_0x17c5ee[_0x5e144e][_0x4616be(0x294)]=_0x1f2e18;}),_0x5ede76[_0x139fe6(0x28d)]((_0x44427a,_0x4725d5)=>{var _0x1dc657=_0x139fe6;_0x17c5ee[_0x4725d5][_0x1dc657(0x1d1)]=_0x44427a;}),_0x1ad453[_0x139fe6(0x28d)]((_0x2bb7f4,_0x33cfc1)=>{var _0xa0dca6=_0x139fe6;_0x17c5ee[_0x33cfc1][_0xa0dca6(0x28f)]=_0x2bb7f4;}),_0x1971f3[_0x139fe6(0x28d)]((_0x2ca907,_0x45ae3b)=>{_0x17c5ee[_0x45ae3b]['new_adjust_qty']=_0x2ca907;}),_0x491254[_0x139fe6(0x28d)]((_0x489f5c,_0x5a8548)=>{var _0x11fee3=_0x139fe6;_0x17c5ee[_0x5a8548][_0x11fee3(0x272)]=_0x489f5c;}),_0x31c6d5[_0x139fe6(0x28d)]((_0x2612d1,_0x54cd61)=>{var _0x1d51cd=_0x139fe6;_0x17c5ee[_0x54cd61][_0x1d51cd(0x241)]=_0x2612d1;}),_0x3f1333[_0x139fe6(0x28d)]((_0x1c976f,_0x42a43a)=>{var _0x31ff56=_0x139fe6;_0x17c5ee[_0x42a43a][_0x31ff56(0x207)]=_0x1c976f;}),_0x45b4ef[_0x139fe6(0x28d)]((_0x2f036a,_0x158abd)=>{_0x17c5ee[_0x158abd]['batch_code']=_0x2f036a;}),_0x41f704['forEach']((_0x4e8e10,_0x3a5f64)=>{var _0x52437d=_0x139fe6;_0x17c5ee[_0x3a5f64][_0x52437d(0x282)]=_0x4e8e10;});const _0x2cbe96=_0x17c5ee[_0x139fe6(0x20d)](_0x4eaf97=>_0x4eaf97['adjust_qty']!=='0'&&_0x4eaf97[_0x139fe6(0x28f)]!=='');var _0x369b87=0x0;_0x2cbe96['forEach'](_0x4e2350=>{var _0x4bc39a=_0x139fe6;console['log']('foreach\x20newproduct',_0x4e2350),parseInt(_0x4e2350[_0x4bc39a(0x28f)])<=0x0&&_0x369b87++;});if(_0x369b87!=0x0)return _0x2da6a4[_0x139fe6(0x28c)](_0x139fe6(0x1e8),_0x139fe6(0x1e0)),_0x34db5b['redirect'](_0x139fe6(0x252));_0x51196f[_0x139fe6(0x211)]=_0x512ba3,_0x51196f[_0x139fe6(0x21c)]=_0x512c16,_0x51196f[_0x139fe6(0x1f5)]=_0x2cbe96,_0x51196f[_0x139fe6(0x1e6)]=_0x1410e2,_0x51196f[_0x139fe6(0x22c)]=_0x509062,_0x51196f[_0x139fe6(0x269)]=_0x36f5be,_0x51196f[_0x139fe6(0x288)]=_0x1b136d;const _0x20cd72=await _0x51196f[_0x139fe6(0x253)](),_0x12e113=await warehouse[_0x139fe6(0x229)]({'name':_0x512ba3,'room':_0x509062});_0x20cd72[_0x139fe6(0x1f5)][_0x139fe6(0x28d)](_0x5c5280=>{var _0x182b0e=_0x139fe6;const _0x133216=_0x12e113['product_details'][_0x182b0e(0x215)](_0x23b3ca=>{var _0x4d8114=_0x182b0e;_0x5c5280[_0x4d8114(0x1d1)]==_0x4d8114(0x219)?_0x23b3ca[_0x4d8114(0x1e7)]==_0x5c5280[_0x4d8114(0x1e7)]&&_0x23b3ca[_0x4d8114(0x24d)]==_0x5c5280['bay']&&(_0x23b3ca[_0x4d8114(0x1d6)]=parseInt(_0x23b3ca[_0x4d8114(0x1d6)])-parseInt(_0x5c5280['adjust_qty'])):_0x23b3ca[_0x4d8114(0x1e7)]==_0x5c5280[_0x4d8114(0x1e7)]&&_0x23b3ca[_0x4d8114(0x24d)]==_0x5c5280['bay']&&(_0x23b3ca['product_stock']=parseInt(_0x23b3ca[_0x4d8114(0x1d6)])+parseInt(_0x5c5280[_0x4d8114(0x28f)]));});}),await _0x12e113[_0x139fe6(0x253)](),_0x2da6a4[_0x139fe6(0x28c)](_0x139fe6(0x263),_0x139fe6(0x232)),_0x34db5b[_0x139fe6(0x274)](_0x139fe6(0x25e));}catch(_0x4c832a){console[_0x139fe6(0x20b)](_0x4c832a);}}),router[a0_0x53c91e(0x204)](a0_0x53c91e(0x290),async(_0x4379cc,_0x2ae491)=>{var _0x293fb2=a0_0x53c91e;const {primary_code:_0x2419f8,warehouse_data:_0x51cbbb,rooms_data:_0x5dec6b,Roomslist:_0x524af4}=_0x4379cc[_0x293fb2(0x1f4)],_0x316d1e=_0x524af4[_0x293fb2(0x203)](','),_0x1a23d8=[];async function _0x8670e9(_0x50e886){var _0x2c1d0e=_0x293fb2;const _0x57fc2f=await warehouse[_0x2c1d0e(0x1ef)]([{'$match':{'name':_0x51cbbb,'room':_0x50e886}},{'$unwind':_0x2c1d0e(0x226)},{'$match':{'product_details.primary_code':_0x2419f8}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2c1d0e(0x1d2)},'product_stock':{'$first':_0x2c1d0e(0x231)},'primary_code':{'$first':_0x2c1d0e(0x1fa)},'secondary_code':{'$first':_0x2c1d0e(0x20f)},'product_code':{'$first':_0x2c1d0e(0x20c)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x2c1d0e(0x26f)},'unit':{'$first':_0x2c1d0e(0x27e)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2c1d0e(0x1cf)},'rack':{'$first':_0x2c1d0e(0x261)},'expiry_date':{'$first':_0x2c1d0e(0x209)},'production_date':{'$first':_0x2c1d0e(0x281)},'batch_code':{'$first':_0x2c1d0e(0x1e9)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2c1d0e(0x267)},'roomNamed':{'$first':_0x2c1d0e(0x265)},'invoice':{'$first':_0x2c1d0e(0x20a)}}}]),_0x52a5d6=await warehouse[_0x2c1d0e(0x1ef)]([{'$match':{'name':_0x51cbbb,'room':_0x50e886}},{'$unwind':_0x2c1d0e(0x226)},{'$match':{'product_details.secondary_code':_0x2419f8}},{'$group':{'_id':_0x2c1d0e(0x1de),'name':{'$first':_0x2c1d0e(0x1d2)},'product_stock':{'$first':_0x2c1d0e(0x231)},'primary_code':{'$first':_0x2c1d0e(0x1fa)},'secondary_code':{'$first':_0x2c1d0e(0x20f)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2c1d0e(0x23b)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2c1d0e(0x27e)},'secondary_unit':{'$first':_0x2c1d0e(0x225)},'storage':{'$first':_0x2c1d0e(0x1cf)},'rack':{'$first':_0x2c1d0e(0x261)},'expiry_date':{'$first':_0x2c1d0e(0x209)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x2c1d0e(0x265)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x57fc2f['length']>0x0)_0x1a23d8[_0x2c1d0e(0x238)](_0x57fc2f);else _0x52a5d6[_0x2c1d0e(0x214)]>0x0&&_0x1a23d8['push'](_0x52a5d6);}const _0x4cc6ef=_0x316d1e['map'](_0x6ab57d=>_0x8670e9(_0x6ab57d));await Promise[_0x293fb2(0x1f6)](_0x4cc6ef),_0x2ae491[_0x293fb2(0x246)](_0x1a23d8);}),router[a0_0x53c91e(0x204)](a0_0x53c91e(0x206),async(_0x3f247c,_0x4f530f)=>{var _0x47a676=a0_0x53c91e;const {productCode:_0xcebd08,bay:_0x58f4e1,warehouses:_0x1163a6,room:_0x15bed2}=_0x3f247c[_0x47a676(0x1f4)];console[_0x47a676(0x20b)](_0x3f247c[_0x47a676(0x1f4)]);try{const _0x396c25=await warehouse[_0x47a676(0x1ef)]([{'$match':{'name':_0x1163a6,'room':_0x15bed2}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x58f4e1)}},{'$group':{'_id':_0x47a676(0x1de),'name':{'$first':_0x47a676(0x1d2)},'product_stock':{'$first':_0x47a676(0x231)},'bay':{'$first':_0x47a676(0x220)},'maxProducts':{'$first':_0x47a676(0x23e)}}}]);_0x4f530f[_0x47a676(0x213)](0xc8)[_0x47a676(0x246)](_0x396c25);}catch(_0x56c303){_0x4f530f[_0x47a676(0x213)](0x194)[_0x47a676(0x246)]({'message':_0x56c303[_0x47a676(0x27b)]});}}),module[a0_0x53c91e(0x1db)]=router;