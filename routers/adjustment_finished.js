var a0_0x28e4fe=a0_0x2fa6;function a0_0x2fa6(_0x5f3bcc,_0x9a437c){var _0x37ea04=a0_0x37ea();return a0_0x2fa6=function(_0x2fa61d,_0x4b9443){_0x2fa61d=_0x2fa61d-0xd2;var _0x2f6215=_0x37ea04[_0x2fa61d];return _0x2f6215;},a0_0x2fa6(_0x5f3bcc,_0x9a437c);}(function(_0x433584,_0x56f3b4){var _0x77e85c=a0_0x2fa6,_0x22f2ff=_0x433584();while(!![]){try{var _0x5c381b=parseInt(_0x77e85c(0x147))/0x1+parseInt(_0x77e85c(0x149))/0x2*(parseInt(_0x77e85c(0x17f))/0x3)+-parseInt(_0x77e85c(0x18b))/0x4+-parseInt(_0x77e85c(0xd3))/0x5+-parseInt(_0x77e85c(0x10c))/0x6+-parseInt(_0x77e85c(0x14d))/0x7*(-parseInt(_0x77e85c(0xec))/0x8)+parseInt(_0x77e85c(0xe5))/0x9;if(_0x5c381b===_0x56f3b4)break;else _0x22f2ff['push'](_0x22f2ff['shift']());}catch(_0xb741e2){_0x22f2ff['push'](_0x22f2ff['shift']());}}}(a0_0x37ea,0x87c47));const express=require(a0_0x28e4fe(0x135)),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x28e4fe(0x162)),users=require(a0_0x28e4fe(0x17e)),nodemailer=require(a0_0x28e4fe(0x127));function a0_0x37ea(){var _0x36fe0b=['findOne','Enclosed','secondary_unit','flash','</table>','433030OfKSaW','Secondary_units','20558aMiKSw','length','success','$date','372099RaPrUK','string','$invoice','Adjustment\x20Finalize\x20Successfully','Finished\x20Goods','English','product_details','<tr>','level','$product.room_names','Portuguese\x20(BR)','prod_cat','$product_details','$_id','find','push','JO_number','types','FGSEmail','$product_details.primary_code','/../public','../models/all_models','German','Chinese','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','French','$product_details.unit','<div>','$product','prod_invoice','purchases_data','port','$product_details.storage','product_code','render','</div>','$finalize','map','QA\x20Warehouse','errors','Adjustment\x20Mail','<hr\x20class=\x22my-3\x22>','date','Portuguese','/view/add_adjustment','room_names','role','filter','catch','../public/language/languages.json','33txpxWM','Enabled','redirect','$product.product_name','floor','$room','<strong>\x20Regards\x20</strong>','json','back','Hindi','$name','all','3438488CQsjER','<h5\x20style=\x22text-align:\x20left;\x22>','product','$product_details.invoice','<table\x20style=\x22width:\x20100%\x20!important;\x22>','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<span\x20style=\x22float:\x20right;\x22>','stockBefore','$product_details.product_stock','$product_details._id','product_date','</td>','884110iyTSVm','$product_details.rack','warehouse_name','$product_details.expiry_date','/barcode_scanner','$product_details.maxProducts','getFullYear','site_title','password','</body></html>','$product_details.type','Ambient','minus','params','/adjustment_finished/preview/','post','maxPerUnit','$product_details.secondary_unit','18461142teAZqd','New_Qty_Converted','<!DOCTYPE\x20html>','$product_details.secondary_code','DRY\x20GOODS','language','getMonth','8EBgtNx','Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Primary_Units','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Return\x20Rooms','finalize','An\x20error\x20occurred\x20while\x20saving\x20data.','new_adjust_qty','Arabic\x20(ae)','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product_stock','<h2>\x20','</h5>','padStart','status','edit_adjustment_finished_view','$product_details.batch_code','warehouse','toString','log','adjustment_finished','$product_details.bay','Spanish','bay','then','$product_details.production_date','message','invoice','$product_details.maxPerUnit','batch_code','get','6347682nzZaRe','$product_details.product_name','$warehouse_name','</head><body>','error','English\x20(US)','prod_code','Arabic','New_Qty_Converted_adj','forEach','</thead>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','host','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','expiry_date','product_name','production_date','stock','\x20Order\x20Date\x20:\x20','There\x27s\x20a\x20error\x20in\x20this\x20transaction','body','note','</tbody>','add','ADJF-','aggregate','findById','nodemailer','getDate','$product_details.floorlevel','master','<h5>','$product_details.product_code','user','</tr>','\x20</h2>','random','/view/:id','edit_adjustment_finished','adjustment\x20data\x20update\x20successfully','unit','express','\x20Order\x20Number\x20:\x20','save','/CheckingWarehouse','prod_name','add_adjustment_finished','$product_details.bin','adjust_qty','An\x20error\x20occurred.','adjustment\x20add\x20successfull','room','email','<html><head><title></title>'];a0_0x37ea=function(){return _0x36fe0b;};return a0_0x37ea();}router[a0_0x28e4fe(0x10b)]('/view',auth,async(_0x4c3661,_0x4bf897)=>{var _0x313463=a0_0x28e4fe;try{const {username:_0x562228,email:_0x5cde52,role:_0x26bab0}=_0x4c3661[_0x313463(0x12d)],_0x597abc=_0x4c3661[_0x313463(0x12d)],_0x3068a1=await profile[_0x313463(0x142)]({'email':_0x597abc[_0x313463(0x140)]}),_0x1bc5b2=await master_shop[_0x313463(0x15b)]();let _0x22f670;if(_0x597abc['role']==_0x313463(0x190)){const _0x30f9b4=await staff[_0x313463(0x142)]({'email':_0x597abc['email']});_0x22f670=await warehouse['find']({'status':_0x313463(0x180),'name':_0x30f9b4['warehouse']});}else _0x22f670=await warehouse[_0x313463(0x15b)]({'status':_0x313463(0x180)});const _0xeb4ded=await product[_0x313463(0x15b)]();let _0xe3f491;if(_0x597abc[_0x313463(0x17b)]=='staff'){const _0x19f85d=await staff[_0x313463(0x142)]({'email':_0x597abc[_0x313463(0x140)]});_0xe3f491=await adjustment_finished[_0x313463(0x15b)]({'warehouse_name':_0x19f85d[_0x313463(0xfe)]});}else _0xe3f491=await adjustment_finished['aggregate']([{'$unwind':_0x313463(0x169)},{'$group':{'_id':_0x313463(0x15a),'invoice':{'$first':_0x313463(0x14f)},'date':{'$first':_0x313463(0x14c)},'warehouse_name':{'$first':_0x313463(0x10e)},'room':{'$addToSet':_0x313463(0x156)},'finalize':{'$first':_0x313463(0x171)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1bc5b2[0x0][_0x313463(0xea)]==_0x313463(0x111)){var _0x51fbc8=users[_0x313463(0x152)];console[_0x313463(0x100)](_0x51fbc8);}else{if(_0x1bc5b2[0x0][_0x313463(0xea)]==_0x313463(0x188))var _0x51fbc8=users[_0x313463(0x188)];else{if(_0x1bc5b2[0x0][_0x313463(0xea)]==_0x313463(0x163))var _0x51fbc8=users[_0x313463(0x163)];else{if(_0x1bc5b2[0x0]['language']=='Spanish')var _0x51fbc8=users[_0x313463(0x103)];else{if(_0x1bc5b2[0x0][_0x313463(0xea)]==_0x313463(0x166))var _0x51fbc8=users['French'];else{if(_0x1bc5b2[0x0][_0x313463(0xea)]=='Portuguese\x20(BR)')var _0x51fbc8=users[_0x313463(0x178)];else{if(_0x1bc5b2[0x0]['language']==_0x313463(0x164))var _0x51fbc8=users[_0x313463(0x164)];else{if(_0x1bc5b2[0x0][_0x313463(0xea)]==_0x313463(0xf5))var _0x51fbc8=users[_0x313463(0x113)];}}}}}}}_0x4bf897[_0x313463(0x16f)](_0x313463(0x101),{'success':_0x4c3661['flash']('success'),'errors':_0x4c3661[_0x313463(0x145)](_0x313463(0x174)),'role':_0x597abc,'profile':_0x3068a1,'warehouse':_0x22f670,'product':_0xeb4ded,'adjustment':_0xe3f491,'master_shop':_0x1bc5b2,'language':_0x51fbc8});}catch(_0x54382f){console['log'](_0x54382f);}});async function getRandom8DigitNumber(){var _0x1d6782=a0_0x28e4fe;const _0x14e15a=0x989680,_0x48627a=0x5f5e0ff,_0x5835df=Math[_0x1d6782(0x183)](Math[_0x1d6782(0x130)]()*(_0x48627a-_0x14e15a+0x1))+_0x14e15a;var _0x4cdd6e;const _0x30e1c6=await adjustment_finished[_0x1d6782(0x142)]({'invoice':_0x1d6782(0x124)+_0x5835df});return _0x30e1c6&&_0x30e1c6[_0x1d6782(0x14a)]>0x0?_0x4cdd6e='ADJF-'+_0x5835df:_0x4cdd6e=_0x1d6782(0x124)+_0x5835df,_0x4cdd6e;}router[a0_0x28e4fe(0x10b)]('/view/add_adjustment',auth,async(_0x596a6a,_0x2a834f)=>{var _0x34e2df=a0_0x28e4fe;try{const {username:_0x122e68,email:_0x351144,role:_0x2f63cd}=_0x596a6a[_0x34e2df(0x12d)],_0x3ffb8d=_0x596a6a[_0x34e2df(0x12d)],_0x496269=await profile[_0x34e2df(0x142)]({'email':_0x3ffb8d[_0x34e2df(0x140)]}),_0x47e720=await master_shop[_0x34e2df(0x15b)]();let _0x40df20;if(_0x3ffb8d[_0x34e2df(0x17b)]=='staff'){const _0x54b9e2=await staff[_0x34e2df(0x142)]({'email':_0x3ffb8d[_0x34e2df(0x140)]});_0x40df20=await warehouse[_0x34e2df(0x125)]([{'$match':{'status':_0x34e2df(0x180),'name':_0x54b9e2[_0x34e2df(0xfe)],'warehouse_category':_0x34e2df(0x151),'name':{'$ne':_0x34e2df(0x173)}}},{'$group':{'_id':_0x34e2df(0x189),'name':{'$first':_0x34e2df(0x189)}}}]);}else _0x40df20=await warehouse[_0x34e2df(0x125)]([{'$match':{'status':'Enabled','warehouse_category':_0x34e2df(0x151),'name':{'$ne':_0x34e2df(0x173)}}},{'$group':{'_id':_0x34e2df(0x189),'name':{'$first':_0x34e2df(0x189)}}}]);const _0x4327cf=await product[_0x34e2df(0x15b)]({}),_0x21c292=await adjustment_finished[_0x34e2df(0x15b)]({}),_0xb14af8=_0x21c292[_0x34e2df(0x14a)]+0x1,_0x3909e4=_0x34e2df(0x124)+_0xb14af8[_0x34e2df(0xff)]()[_0x34e2df(0xfa)](0x5,'0');var _0x5b78db=[_0x34e2df(0xde),_0x34e2df(0x143),_0x34e2df(0xf1)];if(_0x47e720[0x0]['language']=='English\x20(US)')var _0x3ef63f=users[_0x34e2df(0x152)];else{if(_0x47e720[0x0]['language']=='Hindi')var _0x3ef63f=users[_0x34e2df(0x188)];else{if(_0x47e720[0x0][_0x34e2df(0xea)]=='German')var _0x3ef63f=users[_0x34e2df(0x163)];else{if(_0x47e720[0x0][_0x34e2df(0xea)]==_0x34e2df(0x103))var _0x3ef63f=users[_0x34e2df(0x103)];else{if(_0x47e720[0x0][_0x34e2df(0xea)]==_0x34e2df(0x166))var _0x3ef63f=users[_0x34e2df(0x166)];else{if(_0x47e720[0x0]['language']==_0x34e2df(0x157))var _0x3ef63f=users[_0x34e2df(0x178)];else{if(_0x47e720[0x0][_0x34e2df(0xea)]==_0x34e2df(0x164))var _0x3ef63f=users['Chinese'];else{if(_0x47e720[0x0]['language']=='Arabic\x20(ae)')var _0x3ef63f=users[_0x34e2df(0x113)];}}}}}}}const _0x12b80d=getRandom8DigitNumber();_0x12b80d['then'](_0x8a85a6=>{var _0x496e62=_0x34e2df;_0x2a834f[_0x496e62(0x16f)](_0x496e62(0x13a),{'success':_0x596a6a[_0x496e62(0x145)]('success'),'errors':_0x596a6a[_0x496e62(0x145)]('errors'),'role':_0x3ffb8d,'profile':_0x496269,'warehouse':_0x40df20,'product':_0x4327cf,'master_shop':_0x47e720,'language':_0x3ef63f,'rooms_data':_0x5b78db,'invoice_no':_0x8a85a6});})[_0x34e2df(0x17d)](_0x3758f8=>{var _0x4030ef=_0x34e2df;_0x596a6a[_0x4030ef(0x145)](_0x4030ef(0x174),_0x4030ef(0x11f)),_0x2a834f[_0x4030ef(0x181)]('/adjustment/view');});}catch(_0x3a2c3b){console[_0x34e2df(0x100)](_0x3a2c3b);}}),router[a0_0x28e4fe(0xe2)](a0_0x28e4fe(0x179),auth,async(_0x23eed0,_0x164305)=>{var _0x2d0457=a0_0x28e4fe;try{const {warehouse_name:_0x10911c,date:_0x4edcef,prod_name:_0x559c5b,level:_0x2e19e8,isle:_0x37c823,pallet:_0xd5eb81,stock:_0x3aac90,types:_0x3a1127,adjust_qty:_0xf91e40,new_adjust_qty:_0x40ccbe,note:_0x55dac7,Room_name:_0x195eda,invoice:_0x281e68,JO_number:_0x1d1ac7,expiry_date:_0xbb8d7b}=_0x23eed0[_0x2d0457(0x120)];if(typeof _0x559c5b==_0x2d0457(0x14e))var _0x18788c=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x139)]],_0x1f96da=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x155)]],_0x1855a3=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x11d)]],_0x5c562a=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x15e)]],_0x202d14=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x114)]],_0x992e82=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0xe6)]],_0x4b5163=[_0x23eed0[_0x2d0457(0x120)]['Primary_Units']],_0x4fb6ef=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x148)]],_0x755d33=[_0x23eed0[_0x2d0457(0x120)]['prod_code']],_0x596320=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x10a)]],_0x2e044f=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x11a)]],_0x41dff5=[_0x23eed0[_0x2d0457(0x120)]['product_date']],_0x215d6b=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x158)]],_0x282488=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0xed)]],_0x41a11c=[_0x23eed0[_0x2d0457(0x120)][_0x2d0457(0xe3)]],_0x56e5bc=[_0x23eed0[_0x2d0457(0x120)]['prod_invoice']];else var _0x18788c=[..._0x23eed0['body']['prod_name']],_0x1f96da=[..._0x23eed0[_0x2d0457(0x120)]['level']],_0x1855a3=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x11d)]],_0x5c562a=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x15e)]],_0x202d14=[..._0x23eed0['body'][_0x2d0457(0x114)]],_0x992e82=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0xe6)]],_0x4b5163=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0xef)]],_0x4fb6ef=[..._0x23eed0[_0x2d0457(0x120)]['Secondary_units']],_0x755d33=[..._0x23eed0['body'][_0x2d0457(0x112)]],_0x596320=[..._0x23eed0[_0x2d0457(0x120)]['batch_code']],_0x2e044f=[..._0x23eed0['body']['expiry_date']],_0x41dff5=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x196)]],_0x215d6b=[..._0x23eed0['body'][_0x2d0457(0x158)]],_0x282488=[..._0x23eed0[_0x2d0457(0x120)]['Rooms']],_0x41a11c=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0xe3)]],_0x56e5bc=[..._0x23eed0[_0x2d0457(0x120)][_0x2d0457(0x16a)]];const _0x8dc30b=_0x18788c['map'](_0x44027d=>{return _0x44027d={'product_name':_0x44027d};});_0x1f96da[_0x2d0457(0x115)]((_0x47a201,_0x24d9cc)=>{var _0xd93c9c=_0x2d0457;_0x8dc30b[_0x24d9cc][_0xd93c9c(0x104)]=_0x47a201;}),_0x1855a3['forEach']((_0x41a633,_0x1c0a2d)=>{var _0x9dafde=_0x2d0457;_0x8dc30b[_0x1c0a2d][_0x9dafde(0x193)]=_0x41a633;}),_0x5c562a['forEach']((_0x53c494,_0x233b67)=>{_0x8dc30b[_0x233b67]['types']=_0x53c494;}),_0x202d14[_0x2d0457(0x115)]((_0x2b3e29,_0xe16fd2)=>{_0x8dc30b[_0xe16fd2]['adjust_qty']=_0x2b3e29;}),_0x992e82[_0x2d0457(0x115)]((_0x55f9ed,_0x490a3b)=>{var _0x48d435=_0x2d0457;_0x8dc30b[_0x490a3b][_0x48d435(0xf4)]=_0x55f9ed;}),_0x4b5163[_0x2d0457(0x115)]((_0xe03035,_0x2d8a12)=>{var _0x48fea6=_0x2d0457;_0x8dc30b[_0x2d8a12][_0x48fea6(0x134)]=_0xe03035;}),_0x4fb6ef[_0x2d0457(0x115)]((_0x58a84a,_0x5c8a58)=>{var _0x326aca=_0x2d0457;_0x8dc30b[_0x5c8a58][_0x326aca(0x144)]=_0x58a84a;}),_0x755d33[_0x2d0457(0x115)]((_0x5b4e68,_0x3fd0bd)=>{_0x8dc30b[_0x3fd0bd]['product_code']=_0x5b4e68;}),_0x596320[_0x2d0457(0x115)]((_0x33195a,_0x28397b)=>{var _0x21efab=_0x2d0457;_0x8dc30b[_0x28397b][_0x21efab(0x10a)]=_0x33195a;}),_0x2e044f['forEach']((_0x1ddd28,_0x1f5fde)=>{var _0x241df0=_0x2d0457;_0x8dc30b[_0x1f5fde][_0x241df0(0x11a)]=_0x1ddd28;}),_0x41dff5[_0x2d0457(0x115)]((_0x271705,_0x8fb515)=>{var _0x1879ee=_0x2d0457;_0x8dc30b[_0x8fb515][_0x1879ee(0x11c)]=_0x271705;}),_0x215d6b['forEach']((_0x3ed13d,_0x551e57)=>{var _0x25cdc2=_0x2d0457;_0x8dc30b[_0x551e57][_0x25cdc2(0x158)]=_0x3ed13d;}),_0x282488[_0x2d0457(0x115)]((_0x42d829,_0x5e4d5d)=>{var _0x5100f7=_0x2d0457;_0x8dc30b[_0x5e4d5d][_0x5100f7(0x17a)]=_0x42d829;}),_0x41a11c[_0x2d0457(0x115)]((_0x1a8990,_0x64b2f3)=>{var _0x3f2f84=_0x2d0457;_0x8dc30b[_0x64b2f3][_0x3f2f84(0xe3)]=_0x1a8990;}),_0x56e5bc[_0x2d0457(0x115)]((_0x140a48,_0x5454d9)=>{var _0x51a2f0=_0x2d0457;_0x8dc30b[_0x5454d9][_0x51a2f0(0x108)]=_0x140a48;});const _0x45e294=_0x8dc30b['filter'](_0x3a1fae=>_0x3a1fae[_0x2d0457(0x13c)]!=='0'&&_0x3a1fae['adjust_qty']!=='');var _0x3a336d=0x0;_0x45e294[_0x2d0457(0x115)](_0x1f8f70=>{var _0x5b1a62=_0x2d0457;console[_0x5b1a62(0x100)]('foreach\x20newproduct',_0x1f8f70),parseInt(_0x1f8f70['adjust_qty'])<=0x0&&_0x3a336d++;});if(_0x3a336d!=0x0)return _0x23eed0[_0x2d0457(0x145)]('errors',_0x2d0457(0x119)),_0x164305[_0x2d0457(0x181)](_0x2d0457(0x187));const _0x5d2df8=new adjustment_finished({'warehouse_name':_0x10911c,'date':_0x4edcef,'product':_0x45e294,'note':_0x55dac7,'room':_0x195eda,'invoice':_0x281e68,'JO_number':_0x1d1ac7,'expiry_date':_0xbb8d7b}),_0x435594=await _0x5d2df8[_0x2d0457(0x137)]();_0x23eed0[_0x2d0457(0x145)](_0x2d0457(0x14b),_0x2d0457(0x13e)),_0x164305['redirect'](_0x2d0457(0xe1)+_0x435594['_id']);}catch(_0x2d42d0){console[_0x2d0457(0x100)](_0x2d42d0),_0x164305[_0x2d0457(0xfb)](0xc8)[_0x2d0457(0x186)]({'message':_0x2d42d0[_0x2d0457(0x107)]});}}),router[a0_0x28e4fe(0x10b)]('/preview/:id',auth,async(_0x7e9626,_0x36b5fb)=>{var _0x375d68=a0_0x28e4fe;try{const {username:_0x433ecb,email:_0x548b88,role:_0x44f400}=_0x7e9626[_0x375d68(0x12d)],_0x36d902=_0x7e9626[_0x375d68(0x12d)],_0x4e8351=await profile[_0x375d68(0x142)]({'email':_0x36d902[_0x375d68(0x140)]}),_0x4e4e9f=await master_shop[_0x375d68(0x15b)](),_0x372838=_0x7e9626[_0x375d68(0xe0)]['id'],_0x42aec1=await adjustment_finished[_0x375d68(0x126)]({'_id':_0x372838}),_0x5bc44d=await purchases['aggregate']([{'$match':{'warehouse_name':_0x42aec1[_0x375d68(0xd5)]}},{'$unwind':'$product'},{'$group':{'_id':_0x375d68(0x182)}}]);console['log'](_0x375d68(0x16b),_0x5bc44d);const _0x46e466=await product[_0x375d68(0x15b)]({}),_0x59ce2d=await warehouse['aggregate']([{'$match':{'name':_0x42aec1[_0x375d68(0xd5)],'warehouse_category':_0x375d68(0x151)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x375d68(0x195),'name':{'$first':_0x375d68(0x10d)},'product_stock':{'$first':_0x375d68(0x194)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x375d68(0x13b)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x375d68(0x129)},'primary_code':{'$first':_0x375d68(0x160)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x375d68(0x16d)},'rack':{'$first':_0x375d68(0xd4)},'expiry_date':{'$first':_0x375d68(0xd6)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x375d68(0xfd)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x375d68(0x184)}}}]);if(_0x4e4e9f[0x0][_0x375d68(0xea)]==_0x375d68(0x111)){var _0x1871e0=users[_0x375d68(0x152)];console[_0x375d68(0x100)](_0x1871e0);}else{if(_0x4e4e9f[0x0][_0x375d68(0xea)]==_0x375d68(0x188))var _0x1871e0=users[_0x375d68(0x188)];else{if(_0x4e4e9f[0x0][_0x375d68(0xea)]==_0x375d68(0x163))var _0x1871e0=users[_0x375d68(0x163)];else{if(_0x4e4e9f[0x0]['language']==_0x375d68(0x103))var _0x1871e0=users[_0x375d68(0x103)];else{if(_0x4e4e9f[0x0]['language']=='French')var _0x1871e0=users[_0x375d68(0x166)];else{if(_0x4e4e9f[0x0]['language']==_0x375d68(0x157))var _0x1871e0=users['Portuguese'];else{if(_0x4e4e9f[0x0][_0x375d68(0xea)]==_0x375d68(0x164))var _0x1871e0=users[_0x375d68(0x164)];else{if(_0x4e4e9f[0x0]['language']==_0x375d68(0xf5))var _0x1871e0=users[_0x375d68(0x113)];}}}}}}}_0x36b5fb[_0x375d68(0x16f)](_0x375d68(0xfc),{'success':_0x7e9626[_0x375d68(0x145)](_0x375d68(0x14b)),'errors':_0x7e9626[_0x375d68(0x145)]('errors'),'role':_0x36d902,'profile':_0x4e8351,'adjustment':_0x42aec1,'stock':_0x59ce2d,'master_shop':_0x4e4e9f,'warehouse_name':_0x5bc44d,'unit':_0x46e466,'language':_0x1871e0});}catch(_0x1bf325){console[_0x375d68(0x100)](_0x1bf325),_0x36b5fb[_0x375d68(0xfb)](0xc8)[_0x375d68(0x186)]({'message':_0x1bf325[_0x375d68(0x107)]});}}),router[a0_0x28e4fe(0xe2)]('/preview/:id',auth,async(_0x2bf344,_0x363b1f)=>{var _0x2f5afb=a0_0x28e4fe;try{const {invoice:_0x274e92,warehouse_name:_0x411b6c,Room_name:_0x3cd6ae}=_0x2bf344[_0x2f5afb(0x120)],_0x1008a2=_0x2bf344[_0x2f5afb(0xe0)]['id'],_0x2ce04d=await adjustment_finished[_0x2f5afb(0x126)]({'_id':_0x1008a2});var _0x290e5a;const _0x30a076=_0x2ce04d[_0x2f5afb(0x18d)][_0x2f5afb(0x172)](async _0x122de6=>{var _0x1152a9=_0x2f5afb;if(_0x122de6['adjust_qty']>0x0){_0x290e5a=await warehouse[_0x1152a9(0x142)]({'name':_0x411b6c,'room':_0x122de6['room_names'],'warehouse_category':_0x1152a9(0x151)});const _0x184196=_0x290e5a[_0x1152a9(0x153)][_0x1152a9(0x172)](_0x31225b=>{var _0x1c6cdf=_0x1152a9;console[_0x1c6cdf(0x100)](_0x122de6[_0x1c6cdf(0x15e)]);if(_0x122de6[_0x1c6cdf(0x15e)]==_0x1c6cdf(0xdf))_0x31225b['product_name']==_0x122de6[_0x1c6cdf(0x11b)]&&_0x31225b[_0x1c6cdf(0x104)]==_0x122de6['bay']&&_0x31225b[_0x1c6cdf(0x11a)]==_0x122de6['expiry_date']&&_0x31225b[_0x1c6cdf(0x11c)]==_0x122de6['production_date']&&_0x31225b[_0x1c6cdf(0x10a)]==_0x122de6[_0x1c6cdf(0x10a)]&&_0x31225b[_0x1c6cdf(0x108)]==_0x122de6[_0x1c6cdf(0x108)]&&(_0x31225b['product_stock']=_0x31225b['product_stock']-_0x122de6['adjust_qty']);else _0x122de6[_0x1c6cdf(0x15e)]==_0x1c6cdf(0x123)&&(_0x31225b[_0x1c6cdf(0x11b)]==_0x122de6['product_name']&&_0x31225b[_0x1c6cdf(0x104)]==_0x122de6['bay']&&_0x31225b['expiry_date']==_0x122de6[_0x1c6cdf(0x11a)]&&_0x31225b['production_date']==_0x122de6[_0x1c6cdf(0x11c)]&&_0x31225b['batch_code']==_0x122de6['batch_code']&&_0x31225b[_0x1c6cdf(0x108)]==_0x122de6[_0x1c6cdf(0x108)]&&(_0x31225b[_0x1c6cdf(0xf7)]=_0x31225b[_0x1c6cdf(0xf7)]+_0x122de6[_0x1c6cdf(0x13c)]));});}return _0x290e5a;});Promise[_0x2f5afb(0x18a)](_0x30a076)[_0x2f5afb(0x105)](async _0x339441=>{var _0xccb775=_0x2f5afb;try{for(const _0x11077f of _0x339441){await _0x11077f[_0xccb775(0x137)]();}_0x2ce04d[_0xccb775(0xf2)]='True';const _0x187bf5=await _0x2ce04d[_0xccb775(0x137)](),_0x4ea115=await master_shop[_0xccb775(0x15b)](),_0x2793b5=await email_settings[_0xccb775(0x142)](),_0x4cd297=await supervisor_settings['find']();var _0x5c71f0=_0x2ce04d[_0xccb775(0x18d)],_0x1542ab='',_0xafbb09;for(_0xafbb09 in _0x5c71f0){var _0x49abb0='FG';_0x2ce04d[_0xccb775(0xd5)]==_0xccb775(0xe9)&&(_0x49abb0='DG'),_0x1542ab+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c71f0[_0xafbb09][_0xccb775(0x11b)]+_0xccb775(0xd2)+_0xccb775(0x165)+_0x5c71f0[_0xafbb09][_0xccb775(0x16e)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c71f0[_0xafbb09][_0xccb775(0x13c)]+_0xccb775(0xd2)+_0xccb775(0x165)+_0x5c71f0[_0xafbb09][_0xccb775(0x134)]+_0xccb775(0xd2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5c71f0[_0xafbb09][_0xccb775(0x144)]+_0xccb775(0xd2)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ce04d['warehouse_name']+'</td>'+_0xccb775(0x165)+_0x5c71f0[_0xafbb09][_0xccb775(0x17a)]+'</td>'+_0xccb775(0x165)+_0x49abb0+_0x5c71f0[_0xafbb09][_0xccb775(0x104)]+_0xccb775(0xd2)+_0xccb775(0x12e);}let _0x7a93bf=nodemailer['createTransport']({'host':_0x2793b5[_0xccb775(0x118)],'port':Number(_0x2793b5[_0xccb775(0x16c)]),'secure':![],'auth':{'user':_0x2793b5[_0xccb775(0x140)],'pass':_0x2793b5[_0xccb775(0xdb)]}}),_0x511679={'from':_0x2793b5[_0xccb775(0x140)],'to':_0x4cd297[0x0][_0xccb775(0x15f)],'subject':_0xccb775(0x175),'attachments':[{'filename':'Logo.png','path':__dirname+_0xccb775(0x161)+'/upload/'+_0x4ea115[0x0]['image'],'cid':'logo'}],'html':_0xccb775(0xe7)+_0xccb775(0x141)+_0xccb775(0x10f)+_0xccb775(0x168)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0xccb775(0x168)+_0xccb775(0xf6)+'</div>'+_0xccb775(0x168)+_0xccb775(0xf8)+_0x4ea115[0x0][_0xccb775(0xda)]+_0xccb775(0x12f)+_0xccb775(0x170)+_0xccb775(0x170)+_0xccb775(0x176)+_0xccb775(0x168)+_0xccb775(0x18c)+_0xccb775(0x136)+_0x2ce04d['invoice']+'\x20'+_0xccb775(0x192)+_0xccb775(0x11e)+_0x2ce04d['date']+'\x20'+'</span>'+_0xccb775(0xf9)+_0xccb775(0x170)+_0xccb775(0x18f)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0xccb775(0x154)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0xccb775(0x191)+_0xccb775(0xee)+_0xccb775(0x117)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0xccb775(0xf0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0xccb775(0x12e)+_0xccb775(0x116)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x1542ab+'\x20'+_0xccb775(0x122)+_0xccb775(0x146)+'<div>'+_0xccb775(0x185)+_0xccb775(0x12b)+_0x4ea115[0x0][_0xccb775(0xda)]+_0xccb775(0xf9)+_0xccb775(0x170)+_0xccb775(0x170)+_0xccb775(0xdc)};_0x7a93bf['sendMail'](_0x511679,function(_0x60fcb,_0x3042d2){var _0x137672=_0xccb775;_0x60fcb?(console[_0x137672(0x100)](_0x60fcb),console[_0x137672(0x100)]('Error\x20Occurs')):console[_0x137672(0x100)]('Email\x20sent\x20successfully');}),_0x2bf344['flash'](_0xccb775(0x14b),_0xccb775(0x150)),_0x363b1f[_0xccb775(0x181)]('/picking_list/PDF_adjustment/'+_0x187bf5['_id']);}catch(_0x188d43){console[_0xccb775(0x110)](_0x188d43),_0x363b1f[_0xccb775(0xfb)](0x1f4)[_0xccb775(0x186)]({'error':_0xccb775(0xf3)});}})[_0x2f5afb(0x17d)](_0x506e99=>{var _0x244636=_0x2f5afb;console[_0x244636(0x110)](_0x506e99),_0x363b1f[_0x244636(0xfb)](0x1f4)['json']({'error':_0x244636(0x13d)});});}catch(_0x1ce30b){_0x363b1f[_0x2f5afb(0x186)]({'message':_0x1ce30b[_0x2f5afb(0x107)]});}}),router[a0_0x28e4fe(0x10b)](a0_0x28e4fe(0x131),auth,async(_0x4afb6f,_0x2c7349)=>{var _0x318765=a0_0x28e4fe;try{const {username:_0x2c73d9,email:_0x2f888c,role:_0x1c821e}=_0x4afb6f[_0x318765(0x12d)],_0x395d48=_0x4afb6f['user'],_0x38b608=await profile[_0x318765(0x142)]({'email':_0x395d48[_0x318765(0x140)]}),_0x46b643=await master_shop['find']();console['log'](_0x318765(0x12a),_0x46b643);const _0x82feb3=_0x4afb6f['params']['id'],_0x448c25=await adjustment_finished[_0x318765(0x126)]({'_id':_0x82feb3});let _0x371bec=new Date(_0x448c25[_0x318765(0x11a)]),_0xb4ea26=('0'+_0x371bec[_0x318765(0x128)]())['slice'](-0x2),_0x5befbb=('0'+(_0x371bec[_0x318765(0xeb)]()+0x1))['slice'](-0x2),_0x217b34=_0x371bec[_0x318765(0xd9)](),_0x231ac5=_0x217b34+'-'+_0x5befbb+'-'+_0xb4ea26;var _0x574a53=[_0x318765(0xde),'Enclosed',_0x318765(0xf1)];const _0x5907bd=await purchases[_0x318765(0x125)]([{'$match':{'warehouse_name':_0x448c25[_0x318765(0xd5)]}},{'$unwind':_0x318765(0x169)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x318765(0x16b),_0x5907bd);const _0x337c8b=await product['find']({}),_0x5d07e6=await warehouse[_0x318765(0x125)]([{'$match':{'name':_0x448c25['warehouse_name'],'room':_0x448c25[_0x318765(0x13f)]}},{'$unwind':_0x318765(0x159)},{'$group':{'_id':_0x318765(0x195),'name':{'$first':_0x318765(0x10d)},'product_stock':{'$first':_0x318765(0x194)},'bay':{'$first':_0x318765(0x102)},'bin':{'$first':_0x318765(0x13b)},'type':{'$first':_0x318765(0xdd)},'floorlevel':{'$first':_0x318765(0x129)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x318765(0xe8)},'product_code':{'$first':_0x318765(0x12c)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x318765(0xd4)}}}]);if(_0x46b643[0x0][_0x318765(0xea)]==_0x318765(0x111)){var _0x29dece=users['English'];console[_0x318765(0x100)](_0x29dece);}else{if(_0x46b643[0x0][_0x318765(0xea)]=='Hindi')var _0x29dece=users[_0x318765(0x188)];else{if(_0x46b643[0x0][_0x318765(0xea)]==_0x318765(0x163))var _0x29dece=users[_0x318765(0x163)];else{if(_0x46b643[0x0]['language']==_0x318765(0x103))var _0x29dece=users['Spanish'];else{if(_0x46b643[0x0][_0x318765(0xea)]==_0x318765(0x166))var _0x29dece=users[_0x318765(0x166)];else{if(_0x46b643[0x0]['language']==_0x318765(0x157))var _0x29dece=users[_0x318765(0x178)];else{if(_0x46b643[0x0][_0x318765(0xea)]==_0x318765(0x164))var _0x29dece=users[_0x318765(0x164)];else{if(_0x46b643[0x0][_0x318765(0xea)]==_0x318765(0xf5))var _0x29dece=users[_0x318765(0x113)];}}}}}}}_0x2c7349[_0x318765(0x16f)](_0x318765(0x132),{'success':_0x4afb6f[_0x318765(0x145)](_0x318765(0x14b)),'errors':_0x4afb6f['flash'](_0x318765(0x174)),'role':_0x395d48,'profile':_0x38b608,'adjustment':_0x448c25,'stock':_0x5d07e6,'master_shop':_0x46b643,'warehouse_name':_0x5907bd,'unit':_0x337c8b,'language':_0x29dece,'rooms_data':_0x574a53,'ed_fullDate':_0x231ac5});}catch(_0x3f62a2){console[_0x318765(0x100)](_0x3f62a2),_0x2c7349[_0x318765(0xfb)](0xc8)['json']({'message':_0x3f62a2['message']});}}),router['post']('/view/:id',auth,async(_0x1fa2cd,_0x37e5e4)=>{var _0x5c1eb0=a0_0x28e4fe;try{const _0x1f3692=_0x1fa2cd[_0x5c1eb0(0xe0)]['id'],_0x20ba0e=await adjustment_finished[_0x5c1eb0(0x126)]({'_id':_0x1f3692}),_0x4f6e32=await warehouse[_0x5c1eb0(0x142)]({'name':_0x20ba0e[_0x5c1eb0(0xd5)],'room':_0x20ba0e['room']}),{warehouse_name:_0x4d545e,date:_0x2df5b6,prod_name:_0x5f5043,level:_0x409530,isle:_0x1f6b7f,pallet:_0x3d317d,stock:_0x102a41,types:_0x362380,adjust_qty:_0x234415,new_adjust_qty:_0x3e5adb,note:_0x2f5c06,Room_name:_0x2bb5b6,invoice:_0x1f9fbd,JO_number:_0x53682e}=_0x1fa2cd[_0x5c1eb0(0x120)];if(typeof _0x5f5043==_0x5c1eb0(0x14e))var _0x555862=[_0x1fa2cd[_0x5c1eb0(0x120)]['prod_name']],_0x4bb479=[_0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x155)]],_0x56cc34=[_0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x11d)]],_0x5de02d=[_0x1fa2cd[_0x5c1eb0(0x120)]['types']],_0x208715=[_0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x13c)]],_0x1cc89e=[_0x1fa2cd[_0x5c1eb0(0x120)]['new_adjust_qty']],_0x1f605f=[_0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x112)]],_0x5f0a08=[_0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x134)]],_0x4259d0=[_0x1fa2cd['body'][_0x5c1eb0(0x148)]],_0x4673ec=[_0x1fa2cd['body'][_0x5c1eb0(0x10a)]],_0x3b0e1a=[_0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x11a)]];else var _0x555862=[..._0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x139)]],_0x4bb479=[..._0x1fa2cd[_0x5c1eb0(0x120)]['level']],_0x56cc34=[..._0x1fa2cd['body'][_0x5c1eb0(0x11d)]],_0x5de02d=[..._0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x15e)]],_0x208715=[..._0x1fa2cd['body'][_0x5c1eb0(0x13c)]],_0x1cc89e=[..._0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0xf4)]],_0x1f605f=[..._0x1fa2cd['body'][_0x5c1eb0(0x112)]],_0x5f0a08=[..._0x1fa2cd[_0x5c1eb0(0x120)]['unit']],_0x4259d0=[..._0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x148)]],_0x4673ec=[..._0x1fa2cd['body']['batch_code']],_0x3b0e1a=[..._0x1fa2cd[_0x5c1eb0(0x120)][_0x5c1eb0(0x11a)]];const _0x1105cc=_0x555862[_0x5c1eb0(0x172)](_0xf386cb=>{return _0xf386cb={'product_name':_0xf386cb};});_0x4bb479[_0x5c1eb0(0x115)]((_0x340de3,_0x44b13c)=>{var _0x477c2a=_0x5c1eb0;_0x1105cc[_0x44b13c][_0x477c2a(0x104)]=_0x340de3;}),_0x56cc34[_0x5c1eb0(0x115)]((_0x29c1b2,_0x46dd68)=>{var _0x2f8327=_0x5c1eb0;_0x1105cc[_0x46dd68][_0x2f8327(0x193)]=_0x29c1b2;}),_0x5de02d[_0x5c1eb0(0x115)]((_0x2cadba,_0x2196e8)=>{var _0x5050ec=_0x5c1eb0;_0x1105cc[_0x2196e8][_0x5050ec(0x15e)]=_0x2cadba;}),_0x208715[_0x5c1eb0(0x115)]((_0x9fc8d7,_0x17b599)=>{var _0x2b34de=_0x5c1eb0;_0x1105cc[_0x17b599][_0x2b34de(0x13c)]=_0x9fc8d7;}),_0x1cc89e['forEach']((_0x4c692e,_0x248728)=>{var _0x520b9e=_0x5c1eb0;_0x1105cc[_0x248728][_0x520b9e(0xf4)]=_0x4c692e;}),_0x5f0a08['forEach']((_0x5bbd0f,_0x5aaf99)=>{var _0x15986f=_0x5c1eb0;_0x1105cc[_0x5aaf99][_0x15986f(0x134)]=_0x5bbd0f;}),_0x4259d0['forEach']((_0x5e4127,_0x39cb1f)=>{var _0x6010a3=_0x5c1eb0;_0x1105cc[_0x39cb1f][_0x6010a3(0x144)]=_0x5e4127;}),_0x1f605f[_0x5c1eb0(0x115)]((_0x126740,_0x5c84a4)=>{var _0x16f894=_0x5c1eb0;_0x1105cc[_0x5c84a4][_0x16f894(0x16e)]=_0x126740;}),_0x4673ec[_0x5c1eb0(0x115)]((_0xb9fe94,_0x4e17ec)=>{var _0x2f1b60=_0x5c1eb0;_0x1105cc[_0x4e17ec][_0x2f1b60(0x10a)]=_0xb9fe94;}),_0x3b0e1a[_0x5c1eb0(0x115)]((_0x136528,_0x1983f2)=>{var _0x5595a4=_0x5c1eb0;_0x1105cc[_0x1983f2][_0x5595a4(0x11a)]=_0x136528;});const _0x2a8a64=_0x1105cc[_0x5c1eb0(0x17c)](_0x15b9d7=>_0x15b9d7[_0x5c1eb0(0x13c)]!=='0'&&_0x15b9d7[_0x5c1eb0(0x13c)]!=='');var _0x2bd5f7=0x0;_0x2a8a64[_0x5c1eb0(0x115)](_0x4a2deb=>{var _0x2a8825=_0x5c1eb0;console[_0x2a8825(0x100)]('foreach\x20newproduct',_0x4a2deb),parseInt(_0x4a2deb[_0x2a8825(0x13c)])<=0x0&&_0x2bd5f7++;});if(_0x2bd5f7!=0x0)return _0x1fa2cd['flash'](_0x5c1eb0(0x174),_0x5c1eb0(0x119)),_0x37e5e4['redirect'](_0x5c1eb0(0x187));_0x20ba0e['warehouse_name']=_0x4d545e,_0x20ba0e[_0x5c1eb0(0x177)]=_0x2df5b6,_0x20ba0e[_0x5c1eb0(0x18d)]=_0x2a8a64,_0x20ba0e[_0x5c1eb0(0x121)]=_0x2f5c06,_0x20ba0e['room']=_0x2bb5b6,_0x20ba0e[_0x5c1eb0(0x108)]=_0x1f9fbd,_0x20ba0e[_0x5c1eb0(0x15d)]=_0x53682e;const _0x44bdae=await _0x20ba0e[_0x5c1eb0(0x137)](),_0x2e187a=await warehouse[_0x5c1eb0(0x142)]({'name':_0x4d545e,'room':_0x2bb5b6});_0x44bdae[_0x5c1eb0(0x18d)]['forEach'](_0xf392ba=>{var _0x163b45=_0x5c1eb0;const _0x6fba7a=_0x2e187a[_0x163b45(0x153)][_0x163b45(0x172)](_0x782752=>{var _0x27f92a=_0x163b45;_0xf392ba[_0x27f92a(0x15e)]==_0x27f92a(0xdf)?_0x782752['product_name']==_0xf392ba['product_name']&&_0x782752[_0x27f92a(0x104)]==_0xf392ba[_0x27f92a(0x104)]&&(_0x782752[_0x27f92a(0xf7)]=parseInt(_0x782752[_0x27f92a(0xf7)])-parseInt(_0xf392ba[_0x27f92a(0x13c)])):_0x782752[_0x27f92a(0x11b)]==_0xf392ba[_0x27f92a(0x11b)]&&_0x782752[_0x27f92a(0x104)]==_0xf392ba['bay']&&(_0x782752[_0x27f92a(0xf7)]=parseInt(_0x782752[_0x27f92a(0xf7)])+parseInt(_0xf392ba[_0x27f92a(0x13c)]));});}),await _0x2e187a[_0x5c1eb0(0x137)](),_0x1fa2cd[_0x5c1eb0(0x145)](_0x5c1eb0(0x14b),_0x5c1eb0(0x133)),_0x37e5e4['redirect']('/adjustment_finished/view');}catch(_0x3ae87e){console[_0x5c1eb0(0x100)](_0x3ae87e);}}),router[a0_0x28e4fe(0xe2)](a0_0x28e4fe(0xd7),async(_0x2e944a,_0x81e28c)=>{var _0x39ec22=a0_0x28e4fe;const {primary_code:_0x3f585a,warehouse_data:_0x464134,rooms_data:_0x3c8bd8,Roomslist:_0x1c74e1}=_0x2e944a['body'],_0x5a5694=_0x1c74e1['split'](','),_0x4542f8=[];async function _0x56b928(_0x4d2598){var _0x2417c7=a0_0x2fa6;const _0x20adbc=await warehouse[_0x2417c7(0x125)]([{'$match':{'name':_0x464134,'room':_0x4d2598}},{'$unwind':_0x2417c7(0x159)},{'$match':{'product_details.primary_code':_0x3f585a}},{'$group':{'_id':_0x2417c7(0x195),'name':{'$first':_0x2417c7(0x10d)},'product_stock':{'$first':_0x2417c7(0x194)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2417c7(0xe8)},'product_code':{'$first':_0x2417c7(0x12c)},'level':{'$first':_0x2417c7(0x102)},'isle':{'$first':_0x2417c7(0x13b)},'type':{'$first':_0x2417c7(0xdd)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2417c7(0x167)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2417c7(0xfd)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x2417c7(0x184)},'invoice':{'$first':_0x2417c7(0x18e)}}}]),_0x2be432=await warehouse[_0x2417c7(0x125)]([{'$match':{'name':_0x464134,'room':_0x4d2598}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3f585a}},{'$group':{'_id':_0x2417c7(0x195),'name':{'$first':_0x2417c7(0x10d)},'product_stock':{'$first':_0x2417c7(0x194)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x2417c7(0xe8)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x2417c7(0x13b)},'type':{'$first':_0x2417c7(0xdd)},'pallet':{'$first':_0x2417c7(0x129)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x2417c7(0xe4)},'storage':{'$first':_0x2417c7(0x16d)},'rack':{'$first':_0x2417c7(0xd4)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2417c7(0x106)},'batch_code':{'$first':_0x2417c7(0xfd)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x2417c7(0x109)},'roomNamed':{'$first':_0x2417c7(0x184)},'invoice':{'$first':_0x2417c7(0x18e)}}}]);if(_0x20adbc[_0x2417c7(0x14a)]>0x0)_0x4542f8[_0x2417c7(0x15c)](_0x20adbc);else _0x2be432[_0x2417c7(0x14a)]>0x0&&_0x4542f8[_0x2417c7(0x15c)](_0x2be432);}const _0x25bbd0=_0x5a5694['map'](_0x344665=>_0x56b928(_0x344665));await Promise['all'](_0x25bbd0),_0x81e28c[_0x39ec22(0x186)](_0x4542f8);}),router['post'](a0_0x28e4fe(0x138),async(_0x1e8fdd,_0x1135ea)=>{var _0x254756=a0_0x28e4fe;const {productCode:_0x14a97b,bay:_0x1412bc,warehouses:_0x7b45d,room:_0x45311f}=_0x1e8fdd['body'];console['log'](_0x1e8fdd[_0x254756(0x120)]);try{const _0x1eb381=await warehouse[_0x254756(0x125)]([{'$match':{'name':_0x7b45d,'room':_0x45311f}},{'$unwind':_0x254756(0x159)},{'$match':{'product_details.bay':parseInt(_0x1412bc)}},{'$group':{'_id':_0x254756(0x195),'name':{'$first':_0x254756(0x10d)},'product_stock':{'$first':_0x254756(0x194)},'bay':{'$first':_0x254756(0x102)},'maxProducts':{'$first':_0x254756(0xd8)}}}]);_0x1135ea[_0x254756(0xfb)](0xc8)[_0x254756(0x186)](_0x1eb381);}catch(_0x5a8df1){_0x1135ea[_0x254756(0xfb)](0x194)[_0x254756(0x186)]({'message':_0x5a8df1[_0x254756(0x107)]});}}),module['exports']=router;