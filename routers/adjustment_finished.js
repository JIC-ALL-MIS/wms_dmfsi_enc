var a0_0x3f15ec=a0_0xfa1a;function a0_0x3bac(){var _0x56e702=['$product.product_name','add','warehouse','length','add_adjustment_finished','$product_details.product_code','/CheckingWarehouse','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$date','13276452ApFamg','date','Email\x20sent\x20successfully','Logo.png','English','room','log','invoice','logo','$product_details.storage','then','staff','\x20</h2>','$product_details.invoice','22CgFJFf','ADJF-','product_date','success','filter','<h5>','/barcode_scanner','<table\x20style=\x22width:\x20100%\x20!important;\x22>','getMonth','$product_details.secondary_code','map','$product_details.maxProducts','$product_details.expiry_date','Rooms','$name','German','Ambient','14FrgoBL','createTransport','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','port','$product_details.type','There\x27s\x20a\x20error\x20in\x20this\x20transaction','push','$product_details.product_stock','</span>','find','stockBefore','72hrgMAu','language','<h2>\x20','New_Qty_Converted','catch','Enclosed','</td>','edit_adjustment_finished','new_adjust_qty','message','purchases_data','forEach','getDate','DRY\x20GOODS','$product_details.bay','JO_number','</body></html>','batch_code','Adjustment\x20Finalize\x20Successfully','types','production_date','floor','/view/:id','<h5\x20style=\x22text-align:\x20left;\x22>','</tr>','flash','toString','master','English\x20(US)','errors','maxPerUnit','313ynWbzg','Secondary_units','\x20Order\x20Date\x20:\x20','$product_details.bin','post','$product_details.unit','Arabic\x20(ae)','bay','FGSEmail','prod_cat','$product_details.rack','product','Enabled','prod_code','/../public','level','1522856ZAWROI','<!DOCTYPE\x20html>','$product_details.product_name','Error\x20Occurs','adjustment_finished','body','</tbody>','image','$product_details.floorlevel','email','site_title','minus','946506rPApLr','user','note','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details','$product_details.batch_code','Primary_Units','aggregate','$product.room_names','../models/all_models','New_Qty_Converted_adj','findById','</thead>','$room','role','Portuguese','Chinese','params','product_stock','all','Hindi','$product_details.secondary_unit','exports','Adjustment\x20Mail','render','warehouse_name','get','foreach\x20newproduct','express','back','10559475eKSJiV','product_code','<tr>','/preview/:id','room_names','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/adjustment/view','<div>','/adjustment_finished/view','<strong>\x20Regards\x20</strong>','$product_details.production_date','15tyOfSa','error','../middleware/auth','finalize','findOne','stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','status','split','$product_details._id','adjustment\x20add\x20successfull','nodemailer','French','prod_name','<tbody\x20style=\x22text-align:\x20center;\x22>','json','/adjustment_finished/preview/','7536310IiOGkh','/view/add_adjustment','product_details','Spanish','$product_details.primary_code','<hr\x20class=\x22my-3\x22>','secondary_unit','Finished\x20Goods','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','prod_invoice','adjustment\x20data\x20update\x20successfully','\x20Order\x20Number\x20:\x20','password','</div>','An\x20error\x20occurred\x20while\x20saving\x20data.','slice','$product_details.maxPerUnit','4566rubHAG','$invoice','padStart','</h5>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','adjust_qty','/upload/','QA\x20Warehouse','expiry_date','Portuguese\x20(BR)','unit','<html><head><title></title>','redirect','string','getFullYear','An\x20error\x20occurred.','/picking_list/PDF_adjustment/','Return\x20Rooms','Arabic','save','$product','144208EStAIO'];a0_0x3bac=function(){return _0x56e702;};return a0_0x3bac();}(function(_0x599f8f,_0xe59315){var _0x2b4c4f=a0_0xfa1a,_0x5c257f=_0x599f8f();while(!![]){try{var _0x4c2b51=-parseInt(_0x2b4c4f(0x21e))/0x1*(-parseInt(_0x2b4c4f(0x1b6))/0x2)+parseInt(_0x2b4c4f(0x1ff))/0x3*(parseInt(_0x2b4c4f(0x1cb))/0x4)+parseInt(_0x2b4c4f(0x193))/0x5*(parseInt(_0x2b4c4f(0x23a))/0x6)+parseInt(_0x2b4c4f(0x1f4))/0x7*(-parseInt(_0x2b4c4f(0x22e))/0x8)+-parseInt(_0x2b4c4f(0x258))/0x9+parseInt(_0x2b4c4f(0x1a4))/0xa*(parseInt(_0x2b4c4f(0x1e3))/0xb)+-parseInt(_0x2b4c4f(0x1d5))/0xc;if(_0x4c2b51===_0xe59315)break;else _0x5c257f['push'](_0x5c257f['shift']());}catch(_0x543e96){_0x5c257f['push'](_0x5c257f['shift']());}}}(a0_0x3bac,0xdbb8e));const express=require(a0_0x3f15ec(0x256)),app=express(),router=express['Router'](),auth=require(a0_0x3f15ec(0x195)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x3f15ec(0x243)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x3f15ec(0x19e));router['get']('/view',auth,async(_0x546905,_0x2e1f03)=>{var _0x3c6d16=a0_0x3f15ec;try{const {username:_0x4cde77,email:_0x6868bc,role:_0xe6f7fd}=_0x546905[_0x3c6d16(0x23b)],_0x485f82=_0x546905[_0x3c6d16(0x23b)],_0x5eb999=await profile[_0x3c6d16(0x197)]({'email':_0x485f82[_0x3c6d16(0x237)]}),_0x58a5b5=await master_shop[_0x3c6d16(0x1fd)]();let _0x1b0532;if(_0x485f82[_0x3c6d16(0x248)]==_0x3c6d16(0x1e0)){const _0x4456f1=await staff[_0x3c6d16(0x197)]({'email':_0x485f82['email']});_0x1b0532=await warehouse['find']({'status':_0x3c6d16(0x22a),'name':_0x4456f1['warehouse']});}else _0x1b0532=await warehouse[_0x3c6d16(0x1fd)]({'status':_0x3c6d16(0x22a)});const _0x58d119=await product[_0x3c6d16(0x1fd)]();let _0x2cec44;if(_0x485f82[_0x3c6d16(0x248)]==_0x3c6d16(0x1e0)){const _0x594d7a=await staff[_0x3c6d16(0x197)]({'email':_0x485f82['email']});_0x2cec44=await adjustment_finished[_0x3c6d16(0x1fd)]({'warehouse_name':_0x594d7a[_0x3c6d16(0x1ce)]});}else _0x2cec44=await adjustment_finished[_0x3c6d16(0x241)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x3c6d16(0x1b7)},'date':{'$first':_0x3c6d16(0x1d4)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x3c6d16(0x242)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x58a5b5[0x0][_0x3c6d16(0x200)]=='English\x20(US)'){var _0x4d910a=users[_0x3c6d16(0x1d9)];console[_0x3c6d16(0x1db)](_0x4d910a);}else{if(_0x58a5b5[0x0]['language']==_0x3c6d16(0x24e))var _0x4d910a=users[_0x3c6d16(0x24e)];else{if(_0x58a5b5[0x0][_0x3c6d16(0x200)]=='German')var _0x4d910a=users[_0x3c6d16(0x1f2)];else{if(_0x58a5b5[0x0][_0x3c6d16(0x200)]=='Spanish')var _0x4d910a=users[_0x3c6d16(0x1a7)];else{if(_0x58a5b5[0x0]['language']==_0x3c6d16(0x19f))var _0x4d910a=users[_0x3c6d16(0x19f)];else{if(_0x58a5b5[0x0][_0x3c6d16(0x200)]=='Portuguese\x20(BR)')var _0x4d910a=users[_0x3c6d16(0x249)];else{if(_0x58a5b5[0x0][_0x3c6d16(0x200)]==_0x3c6d16(0x24a))var _0x4d910a=users['Chinese'];else{if(_0x58a5b5[0x0][_0x3c6d16(0x200)]==_0x3c6d16(0x224))var _0x4d910a=users['Arabic'];}}}}}}}_0x2e1f03[_0x3c6d16(0x252)](_0x3c6d16(0x232),{'success':_0x546905[_0x3c6d16(0x218)](_0x3c6d16(0x1e6)),'errors':_0x546905[_0x3c6d16(0x218)](_0x3c6d16(0x21c)),'role':_0x485f82,'profile':_0x5eb999,'warehouse':_0x1b0532,'product':_0x58d119,'adjustment':_0x2cec44,'master_shop':_0x58a5b5,'language':_0x4d910a});}catch(_0x4f0bb7){console[_0x3c6d16(0x1db)](_0x4f0bb7);}});function a0_0xfa1a(_0x34909a,_0x260d9b){var _0x3bac4c=a0_0x3bac();return a0_0xfa1a=function(_0xfa1ae1,_0x3bb496){_0xfa1ae1=_0xfa1ae1-0x193;var _0xd69609=_0x3bac4c[_0xfa1ae1];return _0xd69609;},a0_0xfa1a(_0x34909a,_0x260d9b);}async function getRandom8DigitNumber(){var _0x5e0517=a0_0x3f15ec;const _0x14c930=0x989680,_0x282002=0x5f5e0ff,_0x685b85=Math[_0x5e0517(0x214)](Math['random']()*(_0x282002-_0x14c930+0x1))+_0x14c930;var _0x17166d;const _0x4dc982=await adjustment_finished[_0x5e0517(0x197)]({'invoice':_0x5e0517(0x1e4)+_0x685b85});return _0x4dc982&&_0x4dc982[_0x5e0517(0x1cf)]>0x0?_0x17166d=_0x5e0517(0x1e4)+_0x685b85:_0x17166d=_0x5e0517(0x1e4)+_0x685b85,_0x17166d;}router[a0_0x3f15ec(0x254)](a0_0x3f15ec(0x1a5),auth,async(_0x46457b,_0x2a04f0)=>{var _0x32b91c=a0_0x3f15ec;try{const {username:_0x11365f,email:_0x173cd2,role:_0x506fad}=_0x46457b['user'],_0x223d04=_0x46457b[_0x32b91c(0x23b)],_0xfbb678=await profile[_0x32b91c(0x197)]({'email':_0x223d04['email']}),_0x35211c=await master_shop['find']();let _0x3073d4;if(_0x223d04[_0x32b91c(0x248)]=='staff'){const _0x2c396f=await staff[_0x32b91c(0x197)]({'email':_0x223d04[_0x32b91c(0x237)]});_0x3073d4=await warehouse[_0x32b91c(0x241)]([{'$match':{'status':_0x32b91c(0x22a),'name':_0x2c396f['warehouse'],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x32b91c(0x1bd)}}},{'$group':{'_id':_0x32b91c(0x1f1),'name':{'$first':'$name'}}}]);}else _0x3073d4=await warehouse[_0x32b91c(0x241)]([{'$match':{'status':'Enabled','warehouse_category':_0x32b91c(0x1ab),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x32b91c(0x1f1),'name':{'$first':_0x32b91c(0x1f1)}}}]);const _0x27b722=await product['find']({}),_0xd4af85=await adjustment_finished[_0x32b91c(0x1fd)]({}),_0x1b9b62=_0xd4af85[_0x32b91c(0x1cf)]+0x1,_0x2cbb34=_0x32b91c(0x1e4)+_0x1b9b62[_0x32b91c(0x219)]()[_0x32b91c(0x1b8)](0x5,'0');var _0x744738=['Ambient','Enclosed',_0x32b91c(0x1c7)];if(_0x35211c[0x0][_0x32b91c(0x200)]=='English\x20(US)')var _0xeade6d=users['English'];else{if(_0x35211c[0x0]['language']==_0x32b91c(0x24e))var _0xeade6d=users[_0x32b91c(0x24e)];else{if(_0x35211c[0x0]['language']==_0x32b91c(0x1f2))var _0xeade6d=users[_0x32b91c(0x1f2)];else{if(_0x35211c[0x0][_0x32b91c(0x200)]==_0x32b91c(0x1a7))var _0xeade6d=users[_0x32b91c(0x1a7)];else{if(_0x35211c[0x0]['language']=='French')var _0xeade6d=users['French'];else{if(_0x35211c[0x0][_0x32b91c(0x200)]=='Portuguese\x20(BR)')var _0xeade6d=users[_0x32b91c(0x249)];else{if(_0x35211c[0x0][_0x32b91c(0x200)]=='Chinese')var _0xeade6d=users[_0x32b91c(0x24a)];else{if(_0x35211c[0x0][_0x32b91c(0x200)]==_0x32b91c(0x224))var _0xeade6d=users[_0x32b91c(0x1c8)];}}}}}}}const _0x4f26aa=getRandom8DigitNumber();_0x4f26aa['then'](_0x53f27c=>{var _0x4f2e36=_0x32b91c;_0x2a04f0['render'](_0x4f2e36(0x1d0),{'success':_0x46457b[_0x4f2e36(0x218)](_0x4f2e36(0x1e6)),'errors':_0x46457b[_0x4f2e36(0x218)](_0x4f2e36(0x21c)),'role':_0x223d04,'profile':_0xfbb678,'warehouse':_0x3073d4,'product':_0x27b722,'master_shop':_0x35211c,'language':_0xeade6d,'rooms_data':_0x744738,'invoice_no':_0x53f27c});})['catch'](_0x1ede48=>{var _0x5458ea=_0x32b91c;_0x46457b[_0x5458ea(0x218)](_0x5458ea(0x21c),_0x5458ea(0x1f9)),_0x2a04f0['redirect'](_0x5458ea(0x25e));});}catch(_0x251134){console[_0x32b91c(0x1db)](_0x251134);}}),router[a0_0x3f15ec(0x222)]('/view/add_adjustment',auth,async(_0x5913b6,_0x2503c3)=>{var _0x4d484f=a0_0x3f15ec;try{const {warehouse_name:_0x267c85,date:_0x56a790,prod_name:_0x4188d0,level:_0x1b5b41,isle:_0x3fb52d,pallet:_0x3312b0,stock:_0x5ad602,types:_0x276443,adjust_qty:_0x2f202b,new_adjust_qty:_0xab9fe2,note:_0x3a7869,Room_name:_0x2ac8fa,invoice:_0x3df0d8,JO_number:_0x10d02e,expiry_date:_0x5b4c5b}=_0x5913b6[_0x4d484f(0x233)];if(typeof _0x4188d0==_0x4d484f(0x1c3))var _0x320293=[_0x5913b6['body'][_0x4d484f(0x1a0)]],_0x4f5d74=[_0x5913b6['body'][_0x4d484f(0x22d)]],_0x442555=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x198)]],_0x27d778=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x212)]],_0x53d9bc=[_0x5913b6['body'][_0x4d484f(0x244)]],_0x48cd7c=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x202)]],_0x1b68c1=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x240)]],_0x4a4161=[_0x5913b6[_0x4d484f(0x233)]['Secondary_units']],_0x4b3df0=[_0x5913b6['body'][_0x4d484f(0x22b)]],_0xba452b=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x210)]],_0x1f49c2=[_0x5913b6[_0x4d484f(0x233)]['expiry_date']],_0x6fdbf2=[_0x5913b6['body'][_0x4d484f(0x1e5)]],_0x3f6a71=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x227)]],_0x1b658e=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x1f0)]],_0x5d7f40=[_0x5913b6['body'][_0x4d484f(0x21d)]],_0x13e749=[_0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x1ae)]];else var _0x320293=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x1a0)]],_0x4f5d74=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x22d)]],_0x442555=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x198)]],_0x27d778=[..._0x5913b6[_0x4d484f(0x233)]['types']],_0x53d9bc=[..._0x5913b6[_0x4d484f(0x233)]['New_Qty_Converted_adj']],_0x48cd7c=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x202)]],_0x1b68c1=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x240)]],_0x4a4161=[..._0x5913b6['body'][_0x4d484f(0x21f)]],_0x4b3df0=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x22b)]],_0xba452b=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x210)]],_0x1f49c2=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x1be)]],_0x6fdbf2=[..._0x5913b6[_0x4d484f(0x233)]['product_date']],_0x3f6a71=[..._0x5913b6[_0x4d484f(0x233)]['prod_cat']],_0x1b658e=[..._0x5913b6['body'][_0x4d484f(0x1f0)]],_0x5d7f40=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x21d)]],_0x13e749=[..._0x5913b6[_0x4d484f(0x233)][_0x4d484f(0x1ae)]];const _0x3bd7e1=_0x320293['map'](_0x219a95=>{return _0x219a95={'product_name':_0x219a95};});_0x4f5d74[_0x4d484f(0x20a)]((_0x437db9,_0x44c9f2)=>{var _0x5c5e6d=_0x4d484f;_0x3bd7e1[_0x44c9f2][_0x5c5e6d(0x225)]=_0x437db9;}),_0x442555['forEach']((_0x351932,_0x2015ea)=>{var _0x424a05=_0x4d484f;_0x3bd7e1[_0x2015ea][_0x424a05(0x1fe)]=_0x351932;}),_0x27d778[_0x4d484f(0x20a)]((_0x3ce781,_0x659239)=>{var _0x5c4b6b=_0x4d484f;_0x3bd7e1[_0x659239][_0x5c4b6b(0x212)]=_0x3ce781;}),_0x53d9bc[_0x4d484f(0x20a)]((_0x4cfc5d,_0x27085f)=>{var _0x2c6615=_0x4d484f;_0x3bd7e1[_0x27085f][_0x2c6615(0x1bb)]=_0x4cfc5d;}),_0x48cd7c[_0x4d484f(0x20a)]((_0x748d8c,_0x394bca)=>{_0x3bd7e1[_0x394bca]['new_adjust_qty']=_0x748d8c;}),_0x1b68c1['forEach']((_0x12fa88,_0x5df98f)=>{var _0x486785=_0x4d484f;_0x3bd7e1[_0x5df98f][_0x486785(0x1c0)]=_0x12fa88;}),_0x4a4161[_0x4d484f(0x20a)]((_0x52c7e7,_0x160770)=>{var _0x3cffe1=_0x4d484f;_0x3bd7e1[_0x160770][_0x3cffe1(0x1aa)]=_0x52c7e7;}),_0x4b3df0[_0x4d484f(0x20a)]((_0x4f21fe,_0x2b0d3d)=>{var _0x108985=_0x4d484f;_0x3bd7e1[_0x2b0d3d][_0x108985(0x259)]=_0x4f21fe;}),_0xba452b[_0x4d484f(0x20a)]((_0x42e21d,_0x5780e9)=>{var _0x39bed8=_0x4d484f;_0x3bd7e1[_0x5780e9][_0x39bed8(0x210)]=_0x42e21d;}),_0x1f49c2['forEach']((_0x35503a,_0x3a633a)=>{var _0x46f09d=_0x4d484f;_0x3bd7e1[_0x3a633a][_0x46f09d(0x1be)]=_0x35503a;}),_0x6fdbf2[_0x4d484f(0x20a)]((_0x4758b,_0x2cb0c9)=>{var _0xdb73ff=_0x4d484f;_0x3bd7e1[_0x2cb0c9][_0xdb73ff(0x213)]=_0x4758b;}),_0x3f6a71[_0x4d484f(0x20a)]((_0xeddefc,_0x44ec00)=>{var _0x4f548d=_0x4d484f;_0x3bd7e1[_0x44ec00][_0x4f548d(0x227)]=_0xeddefc;}),_0x1b658e[_0x4d484f(0x20a)]((_0x10e41b,_0x3f5686)=>{var _0x322aac=_0x4d484f;_0x3bd7e1[_0x3f5686][_0x322aac(0x25c)]=_0x10e41b;}),_0x5d7f40['forEach']((_0x141af9,_0x2ba7f3)=>{var _0x5a31a8=_0x4d484f;_0x3bd7e1[_0x2ba7f3][_0x5a31a8(0x21d)]=_0x141af9;}),_0x13e749[_0x4d484f(0x20a)]((_0x3f8c05,_0x50207f)=>{var _0x5212c9=_0x4d484f;_0x3bd7e1[_0x50207f][_0x5212c9(0x1dc)]=_0x3f8c05;});const _0x423969=_0x3bd7e1[_0x4d484f(0x1e7)](_0x3fc775=>_0x3fc775[_0x4d484f(0x1bb)]!=='0'&&_0x3fc775[_0x4d484f(0x1bb)]!=='');var _0x4c6450=0x0;_0x423969[_0x4d484f(0x20a)](_0x3557a1=>{var _0x3e31=_0x4d484f;console['log'](_0x3e31(0x255),_0x3557a1),parseInt(_0x3557a1[_0x3e31(0x1bb)])<=0x0&&_0x4c6450++;});if(_0x4c6450!=0x0)return _0x5913b6['flash'](_0x4d484f(0x21c),_0x4d484f(0x1f6)),_0x2503c3[_0x4d484f(0x1c2)](_0x4d484f(0x257));const _0x362077=new adjustment_finished({'warehouse_name':_0x267c85,'date':_0x56a790,'product':_0x423969,'note':_0x3a7869,'room':_0x2ac8fa,'invoice':_0x3df0d8,'JO_number':_0x10d02e,'expiry_date':_0x5b4c5b}),_0x56b7e2=await _0x362077['save']();_0x5913b6[_0x4d484f(0x218)]('success',_0x4d484f(0x19d)),_0x2503c3[_0x4d484f(0x1c2)](_0x4d484f(0x1a3)+_0x56b7e2['_id']);}catch(_0x45573e){console[_0x4d484f(0x1db)](_0x45573e),_0x2503c3[_0x4d484f(0x19a)](0xc8)[_0x4d484f(0x1a2)]({'message':_0x45573e[_0x4d484f(0x208)]});}}),router[a0_0x3f15ec(0x254)](a0_0x3f15ec(0x25b),auth,async(_0xa9034f,_0x26efdb)=>{var _0x1b6378=a0_0x3f15ec;try{const {username:_0x4ec1f0,email:_0x30a886,role:_0x402283}=_0xa9034f[_0x1b6378(0x23b)],_0x47c778=_0xa9034f[_0x1b6378(0x23b)],_0x2c0f35=await profile[_0x1b6378(0x197)]({'email':_0x47c778['email']}),_0x3be05a=await master_shop[_0x1b6378(0x1fd)](),_0x413e33=_0xa9034f['params']['id'],_0x44c794=await adjustment_finished[_0x1b6378(0x245)]({'_id':_0x413e33}),_0x45b529=await purchases[_0x1b6378(0x241)]([{'$match':{'warehouse_name':_0x44c794[_0x1b6378(0x253)]}},{'$unwind':_0x1b6378(0x1ca)},{'$group':{'_id':_0x1b6378(0x1cc)}}]);console[_0x1b6378(0x1db)](_0x1b6378(0x209),_0x45b529);const _0x13622c=await product[_0x1b6378(0x1fd)]({}),_0x166c44=await warehouse[_0x1b6378(0x241)]([{'$match':{'name':_0x44c794['warehouse_name'],'warehouse_category':_0x1b6378(0x1ab)}},{'$unwind':_0x1b6378(0x23e)},{'$group':{'_id':_0x1b6378(0x19c),'name':{'$first':_0x1b6378(0x230)},'product_stock':{'$first':_0x1b6378(0x1fb)},'bay':{'$first':_0x1b6378(0x20d)},'bin':{'$first':_0x1b6378(0x221)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1b6378(0x236)},'primary_code':{'$first':_0x1b6378(0x1a8)},'secondary_code':{'$first':_0x1b6378(0x1ec)},'product_code':{'$first':_0x1b6378(0x1d1)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1b6378(0x228)},'expiry_date':{'$first':_0x1b6378(0x1ef)},'production_date':{'$first':_0x1b6378(0x262)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':_0x1b6378(0x1b5)},'room':{'$first':_0x1b6378(0x247)}}}]);if(_0x3be05a[0x0]['language']==_0x1b6378(0x21b)){var _0x317797=users[_0x1b6378(0x1d9)];console[_0x1b6378(0x1db)](_0x317797);}else{if(_0x3be05a[0x0][_0x1b6378(0x200)]==_0x1b6378(0x24e))var _0x317797=users[_0x1b6378(0x24e)];else{if(_0x3be05a[0x0][_0x1b6378(0x200)]==_0x1b6378(0x1f2))var _0x317797=users['German'];else{if(_0x3be05a[0x0][_0x1b6378(0x200)]=='Spanish')var _0x317797=users['Spanish'];else{if(_0x3be05a[0x0][_0x1b6378(0x200)]==_0x1b6378(0x19f))var _0x317797=users[_0x1b6378(0x19f)];else{if(_0x3be05a[0x0]['language']=='Portuguese\x20(BR)')var _0x317797=users[_0x1b6378(0x249)];else{if(_0x3be05a[0x0]['language']==_0x1b6378(0x24a))var _0x317797=users[_0x1b6378(0x24a)];else{if(_0x3be05a[0x0][_0x1b6378(0x200)]=='Arabic\x20(ae)')var _0x317797=users[_0x1b6378(0x1c8)];}}}}}}}_0x26efdb[_0x1b6378(0x252)]('edit_adjustment_finished_view',{'success':_0xa9034f[_0x1b6378(0x218)]('success'),'errors':_0xa9034f[_0x1b6378(0x218)](_0x1b6378(0x21c)),'role':_0x47c778,'profile':_0x2c0f35,'adjustment':_0x44c794,'stock':_0x166c44,'master_shop':_0x3be05a,'warehouse_name':_0x45b529,'unit':_0x13622c,'language':_0x317797});}catch(_0x291010){console[_0x1b6378(0x1db)](_0x291010),_0x26efdb['status'](0xc8)[_0x1b6378(0x1a2)]({'message':_0x291010[_0x1b6378(0x208)]});}}),router['post'](a0_0x3f15ec(0x25b),auth,async(_0x504c0c,_0x444462)=>{var _0x3c6e51=a0_0x3f15ec;try{const {invoice:_0x1f4dbe,warehouse_name:_0xef963,Room_name:_0x4c35db}=_0x504c0c['body'],_0x2cf445=_0x504c0c[_0x3c6e51(0x24b)]['id'],_0x11f9c1=await adjustment_finished[_0x3c6e51(0x245)]({'_id':_0x2cf445});var _0x3cbf5d;const _0x142e99=_0x11f9c1[_0x3c6e51(0x229)][_0x3c6e51(0x1ed)](async _0xae6762=>{var _0x578255=_0x3c6e51;if(_0xae6762[_0x578255(0x1bb)]>0x0){_0x3cbf5d=await warehouse['findOne']({'name':_0xef963,'room':_0xae6762['room_names'],'warehouse_category':'Finished\x20Goods'});const _0x9924fe=_0x3cbf5d[_0x578255(0x1a6)][_0x578255(0x1ed)](_0x1b230a=>{var _0x1de4c7=_0x578255;console[_0x1de4c7(0x1db)](_0xae6762[_0x1de4c7(0x212)]);if(_0xae6762['types']==_0x1de4c7(0x239))_0x1b230a[_0x1de4c7(0x1ac)]==_0xae6762[_0x1de4c7(0x1ac)]&&_0x1b230a[_0x1de4c7(0x225)]==_0xae6762[_0x1de4c7(0x225)]&&_0x1b230a['expiry_date']==_0xae6762[_0x1de4c7(0x1be)]&&_0x1b230a[_0x1de4c7(0x213)]==_0xae6762[_0x1de4c7(0x213)]&&_0x1b230a[_0x1de4c7(0x210)]==_0xae6762[_0x1de4c7(0x210)]&&_0x1b230a[_0x1de4c7(0x1dc)]==_0xae6762['invoice']&&(_0x1b230a['product_stock']=_0x1b230a[_0x1de4c7(0x24c)]-_0xae6762[_0x1de4c7(0x1bb)]);else _0xae6762['types']==_0x1de4c7(0x1cd)&&(_0x1b230a['product_name']==_0xae6762[_0x1de4c7(0x1ac)]&&_0x1b230a['bay']==_0xae6762[_0x1de4c7(0x225)]&&_0x1b230a[_0x1de4c7(0x1be)]==_0xae6762[_0x1de4c7(0x1be)]&&_0x1b230a[_0x1de4c7(0x213)]==_0xae6762['production_date']&&_0x1b230a['batch_code']==_0xae6762[_0x1de4c7(0x210)]&&_0x1b230a[_0x1de4c7(0x1dc)]==_0xae6762[_0x1de4c7(0x1dc)]&&(_0x1b230a[_0x1de4c7(0x24c)]=_0x1b230a[_0x1de4c7(0x24c)]+_0xae6762['adjust_qty']));});}return _0x3cbf5d;});Promise[_0x3c6e51(0x24d)](_0x142e99)[_0x3c6e51(0x1df)](async _0xf5af48=>{var _0x1e984b=_0x3c6e51;try{for(const _0x5605cd of _0xf5af48){await _0x5605cd[_0x1e984b(0x1c9)]();}_0x11f9c1[_0x1e984b(0x196)]='True';const _0x39d66a=await _0x11f9c1[_0x1e984b(0x1c9)](),_0x34dafa=await master_shop['find'](),_0x348351=await email_settings[_0x1e984b(0x197)](),_0x38ca6c=await supervisor_settings[_0x1e984b(0x1fd)]();var _0x3ec7e1=_0x11f9c1[_0x1e984b(0x229)],_0x56ced2='',_0x1303c7;for(_0x1303c7 in _0x3ec7e1){var _0x9ea7b='FG';_0x11f9c1[_0x1e984b(0x253)]==_0x1e984b(0x20c)&&(_0x9ea7b='DG'),_0x56ced2+='<tr>'+_0x1e984b(0x199)+_0x3ec7e1[_0x1303c7][_0x1e984b(0x1ac)]+_0x1e984b(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ec7e1[_0x1303c7][_0x1e984b(0x259)]+_0x1e984b(0x205)+_0x1e984b(0x199)+_0x3ec7e1[_0x1303c7]['adjust_qty']+_0x1e984b(0x205)+_0x1e984b(0x199)+_0x3ec7e1[_0x1303c7][_0x1e984b(0x1c0)]+_0x1e984b(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3ec7e1[_0x1303c7][_0x1e984b(0x1aa)]+_0x1e984b(0x205)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x11f9c1[_0x1e984b(0x253)]+_0x1e984b(0x205)+_0x1e984b(0x199)+_0x3ec7e1[_0x1303c7][_0x1e984b(0x25c)]+_0x1e984b(0x205)+_0x1e984b(0x199)+_0x9ea7b+_0x3ec7e1[_0x1303c7][_0x1e984b(0x225)]+'</td>'+_0x1e984b(0x217);}let _0x4b5234=nodemailer[_0x1e984b(0x1f5)]({'host':_0x348351['host'],'port':Number(_0x348351[_0x1e984b(0x1f7)]),'secure':![],'auth':{'user':_0x348351[_0x1e984b(0x237)],'pass':_0x348351[_0x1e984b(0x1b1)]}}),_0x2d3534={'from':_0x348351[_0x1e984b(0x237)],'to':_0x38ca6c[0x0][_0x1e984b(0x226)],'subject':_0x1e984b(0x251),'attachments':[{'filename':_0x1e984b(0x1d8),'path':__dirname+_0x1e984b(0x22c)+_0x1e984b(0x1bc)+_0x34dafa[0x0][_0x1e984b(0x235)],'cid':_0x1e984b(0x1dd)}],'html':_0x1e984b(0x22f)+_0x1e984b(0x1c1)+'</head><body>'+_0x1e984b(0x25f)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x1e984b(0x25f)+_0x1e984b(0x23d)+'</div>'+_0x1e984b(0x25f)+_0x1e984b(0x201)+_0x34dafa[0x0][_0x1e984b(0x238)]+_0x1e984b(0x1e1)+'</div>'+_0x1e984b(0x1b2)+_0x1e984b(0x1a9)+_0x1e984b(0x25f)+_0x1e984b(0x216)+_0x1e984b(0x1b0)+_0x11f9c1[_0x1e984b(0x1dc)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1e984b(0x220)+_0x11f9c1[_0x1e984b(0x1d6)]+'\x20'+_0x1e984b(0x1fc)+_0x1e984b(0x1b9)+_0x1e984b(0x1b2)+_0x1e984b(0x1ea)+_0x1e984b(0x1d3)+_0x1e984b(0x25a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1e984b(0x1ad)+_0x1e984b(0x25d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x1e984b(0x1ba)+_0x1e984b(0x217)+_0x1e984b(0x246)+_0x1e984b(0x1a1)+'\x20'+_0x56ced2+'\x20'+_0x1e984b(0x234)+'</table>'+'<div>'+_0x1e984b(0x261)+_0x1e984b(0x1e8)+_0x34dafa[0x0][_0x1e984b(0x238)]+_0x1e984b(0x1b9)+_0x1e984b(0x1b2)+_0x1e984b(0x1b2)+_0x1e984b(0x20f)};_0x4b5234['sendMail'](_0x2d3534,function(_0x5863fa,_0x56259a){var _0xf6e37c=_0x1e984b;_0x5863fa?(console[_0xf6e37c(0x1db)](_0x5863fa),console[_0xf6e37c(0x1db)](_0xf6e37c(0x231))):console[_0xf6e37c(0x1db)](_0xf6e37c(0x1d7));}),_0x504c0c[_0x1e984b(0x218)](_0x1e984b(0x1e6),_0x1e984b(0x211)),_0x444462[_0x1e984b(0x1c2)](_0x1e984b(0x1c6)+_0x39d66a['_id']);}catch(_0x2c7d83){console[_0x1e984b(0x194)](_0x2c7d83),_0x444462[_0x1e984b(0x19a)](0x1f4)[_0x1e984b(0x1a2)]({'error':_0x1e984b(0x1b3)});}})[_0x3c6e51(0x203)](_0x592875=>{var _0x300ddd=_0x3c6e51;console[_0x300ddd(0x194)](_0x592875),_0x444462[_0x300ddd(0x19a)](0x1f4)['json']({'error':_0x300ddd(0x1c5)});});}catch(_0x49a2d9){_0x444462[_0x3c6e51(0x1a2)]({'message':_0x49a2d9[_0x3c6e51(0x208)]});}}),router[a0_0x3f15ec(0x254)](a0_0x3f15ec(0x215),auth,async(_0x3a3354,_0x165536)=>{var _0x3de7f0=a0_0x3f15ec;try{const {username:_0x571a03,email:_0xb6833a,role:_0x5751eb}=_0x3a3354[_0x3de7f0(0x23b)],_0x3c3abb=_0x3a3354[_0x3de7f0(0x23b)],_0x4dd399=await profile['findOne']({'email':_0x3c3abb[_0x3de7f0(0x237)]}),_0xd9db18=await master_shop['find']();console[_0x3de7f0(0x1db)](_0x3de7f0(0x21a),_0xd9db18);const _0x52e4bd=_0x3a3354[_0x3de7f0(0x24b)]['id'],_0x43e767=await adjustment_finished['findById']({'_id':_0x52e4bd});let _0x4623af=new Date(_0x43e767[_0x3de7f0(0x1be)]),_0x3f010b=('0'+_0x4623af[_0x3de7f0(0x20b)]())[_0x3de7f0(0x1b4)](-0x2),_0x43f951=('0'+(_0x4623af[_0x3de7f0(0x1eb)]()+0x1))[_0x3de7f0(0x1b4)](-0x2),_0x4b1e61=_0x4623af[_0x3de7f0(0x1c4)](),_0x5de1ee=_0x4b1e61+'-'+_0x43f951+'-'+_0x3f010b;var _0xdecb12=[_0x3de7f0(0x1f3),_0x3de7f0(0x204),_0x3de7f0(0x1c7)];const _0x30cd25=await purchases[_0x3de7f0(0x241)]([{'$match':{'warehouse_name':_0x43e767['warehouse_name']}},{'$unwind':_0x3de7f0(0x1ca)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x30cd25);const _0xe2b1c0=await product[_0x3de7f0(0x1fd)]({}),_0xd3ba4d=await warehouse[_0x3de7f0(0x241)]([{'$match':{'name':_0x43e767['warehouse_name'],'room':_0x43e767[_0x3de7f0(0x1da)]}},{'$unwind':_0x3de7f0(0x23e)},{'$group':{'_id':_0x3de7f0(0x19c),'name':{'$first':_0x3de7f0(0x230)},'product_stock':{'$first':_0x3de7f0(0x1fb)},'bay':{'$first':_0x3de7f0(0x20d)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x3de7f0(0x236)},'primary_code':{'$first':_0x3de7f0(0x1a8)},'secondary_code':{'$first':_0x3de7f0(0x1ec)},'product_code':{'$first':_0x3de7f0(0x1d1)},'storage':{'$first':_0x3de7f0(0x1de)},'rack':{'$first':'$product_details.rack'}}}]);if(_0xd9db18[0x0][_0x3de7f0(0x200)]==_0x3de7f0(0x21b)){var _0x560cab=users[_0x3de7f0(0x1d9)];console[_0x3de7f0(0x1db)](_0x560cab);}else{if(_0xd9db18[0x0]['language']=='Hindi')var _0x560cab=users['Hindi'];else{if(_0xd9db18[0x0][_0x3de7f0(0x200)]==_0x3de7f0(0x1f2))var _0x560cab=users[_0x3de7f0(0x1f2)];else{if(_0xd9db18[0x0]['language']==_0x3de7f0(0x1a7))var _0x560cab=users[_0x3de7f0(0x1a7)];else{if(_0xd9db18[0x0]['language']=='French')var _0x560cab=users[_0x3de7f0(0x19f)];else{if(_0xd9db18[0x0]['language']==_0x3de7f0(0x1bf))var _0x560cab=users[_0x3de7f0(0x249)];else{if(_0xd9db18[0x0][_0x3de7f0(0x200)]=='Chinese')var _0x560cab=users[_0x3de7f0(0x24a)];else{if(_0xd9db18[0x0][_0x3de7f0(0x200)]==_0x3de7f0(0x224))var _0x560cab=users[_0x3de7f0(0x1c8)];}}}}}}}_0x165536[_0x3de7f0(0x252)](_0x3de7f0(0x206),{'success':_0x3a3354[_0x3de7f0(0x218)](_0x3de7f0(0x1e6)),'errors':_0x3a3354[_0x3de7f0(0x218)](_0x3de7f0(0x21c)),'role':_0x3c3abb,'profile':_0x4dd399,'adjustment':_0x43e767,'stock':_0xd3ba4d,'master_shop':_0xd9db18,'warehouse_name':_0x30cd25,'unit':_0xe2b1c0,'language':_0x560cab,'rooms_data':_0xdecb12,'ed_fullDate':_0x5de1ee});}catch(_0x345c18){console['log'](_0x345c18),_0x165536[_0x3de7f0(0x19a)](0xc8)[_0x3de7f0(0x1a2)]({'message':_0x345c18['message']});}}),router[a0_0x3f15ec(0x222)](a0_0x3f15ec(0x215),auth,async(_0x29d8bb,_0x26037d)=>{var _0x5391f1=a0_0x3f15ec;try{const _0x3fe217=_0x29d8bb['params']['id'],_0x2fe8cc=await adjustment_finished[_0x5391f1(0x245)]({'_id':_0x3fe217}),_0x2564be=await warehouse[_0x5391f1(0x197)]({'name':_0x2fe8cc['warehouse_name'],'room':_0x2fe8cc['room']}),{warehouse_name:_0x49794e,date:_0x3a683a,prod_name:_0x31b178,level:_0x415ca6,isle:_0x3f59ad,pallet:_0x47c956,stock:_0x21dd82,types:_0x4b4908,adjust_qty:_0x1a4ea4,new_adjust_qty:_0x14a9cb,note:_0x2d2238,Room_name:_0x876449,invoice:_0x4ab344,JO_number:_0x6c7a80}=_0x29d8bb[_0x5391f1(0x233)];if(typeof _0x31b178=='string')var _0x5177b1=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x1a0)]],_0x185bec=[_0x29d8bb['body'][_0x5391f1(0x22d)]],_0x582174=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x198)]],_0x3f2eed=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x212)]],_0x58aea1=[_0x29d8bb[_0x5391f1(0x233)]['adjust_qty']],_0x30bc29=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x207)]],_0x346cc1=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x22b)]],_0x26d584=[_0x29d8bb['body']['unit']],_0x2da6a6=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x21f)]],_0x55e067=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x210)]],_0x37509b=[_0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x1be)]];else var _0x5177b1=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x1a0)]],_0x185bec=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x22d)]],_0x582174=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x198)]],_0x3f2eed=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x212)]],_0x58aea1=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x1bb)]],_0x30bc29=[..._0x29d8bb[_0x5391f1(0x233)]['new_adjust_qty']],_0x346cc1=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x22b)]],_0x26d584=[..._0x29d8bb['body'][_0x5391f1(0x1c0)]],_0x2da6a6=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x21f)]],_0x55e067=[..._0x29d8bb['body'][_0x5391f1(0x210)]],_0x37509b=[..._0x29d8bb[_0x5391f1(0x233)][_0x5391f1(0x1be)]];const _0x55028d=_0x5177b1[_0x5391f1(0x1ed)](_0x468e75=>{return _0x468e75={'product_name':_0x468e75};});_0x185bec['forEach']((_0x537e47,_0x5aad94)=>{_0x55028d[_0x5aad94]['bay']=_0x537e47;}),_0x582174[_0x5391f1(0x20a)]((_0x4f8a8f,_0x395c29)=>{var _0x2a3714=_0x5391f1;_0x55028d[_0x395c29][_0x2a3714(0x1fe)]=_0x4f8a8f;}),_0x3f2eed['forEach']((_0x7be23b,_0x4bbdda)=>{_0x55028d[_0x4bbdda]['types']=_0x7be23b;}),_0x58aea1[_0x5391f1(0x20a)]((_0x23e8cb,_0x2abe58)=>{var _0x2f08d8=_0x5391f1;_0x55028d[_0x2abe58][_0x2f08d8(0x1bb)]=_0x23e8cb;}),_0x30bc29[_0x5391f1(0x20a)]((_0x59620a,_0x7a0ef)=>{_0x55028d[_0x7a0ef]['new_adjust_qty']=_0x59620a;}),_0x26d584[_0x5391f1(0x20a)]((_0x345978,_0x154c3f)=>{_0x55028d[_0x154c3f]['unit']=_0x345978;}),_0x2da6a6[_0x5391f1(0x20a)]((_0x589635,_0x54ffed)=>{_0x55028d[_0x54ffed]['secondary_unit']=_0x589635;}),_0x346cc1['forEach']((_0x2659ba,_0x30389d)=>{_0x55028d[_0x30389d]['product_code']=_0x2659ba;}),_0x55e067[_0x5391f1(0x20a)]((_0x58f87c,_0x1ecfae)=>{var _0x491e4=_0x5391f1;_0x55028d[_0x1ecfae][_0x491e4(0x210)]=_0x58f87c;}),_0x37509b[_0x5391f1(0x20a)]((_0x412b56,_0x4734ac)=>{_0x55028d[_0x4734ac]['expiry_date']=_0x412b56;});const _0x10a7fe=_0x55028d[_0x5391f1(0x1e7)](_0x289ae6=>_0x289ae6[_0x5391f1(0x1bb)]!=='0'&&_0x289ae6[_0x5391f1(0x1bb)]!=='');var _0x113e08=0x0;_0x10a7fe[_0x5391f1(0x20a)](_0x3743de=>{var _0x5172eb=_0x5391f1;console[_0x5172eb(0x1db)](_0x5172eb(0x255),_0x3743de),parseInt(_0x3743de[_0x5172eb(0x1bb)])<=0x0&&_0x113e08++;});if(_0x113e08!=0x0)return _0x29d8bb['flash'](_0x5391f1(0x21c),_0x5391f1(0x1f6)),_0x26037d[_0x5391f1(0x1c2)](_0x5391f1(0x257));_0x2fe8cc[_0x5391f1(0x253)]=_0x49794e,_0x2fe8cc[_0x5391f1(0x1d6)]=_0x3a683a,_0x2fe8cc[_0x5391f1(0x229)]=_0x10a7fe,_0x2fe8cc[_0x5391f1(0x23c)]=_0x2d2238,_0x2fe8cc[_0x5391f1(0x1da)]=_0x876449,_0x2fe8cc[_0x5391f1(0x1dc)]=_0x4ab344,_0x2fe8cc[_0x5391f1(0x20e)]=_0x6c7a80;const _0x290317=await _0x2fe8cc[_0x5391f1(0x1c9)](),_0xa769ae=await warehouse['findOne']({'name':_0x49794e,'room':_0x876449});_0x290317[_0x5391f1(0x229)]['forEach'](_0x5482ac=>{var _0x552764=_0x5391f1;const _0x157463=_0xa769ae[_0x552764(0x1a6)][_0x552764(0x1ed)](_0x4223ae=>{var _0x447629=_0x552764;_0x5482ac['types']==_0x447629(0x239)?_0x4223ae[_0x447629(0x1ac)]==_0x5482ac[_0x447629(0x1ac)]&&_0x4223ae['bay']==_0x5482ac[_0x447629(0x225)]&&(_0x4223ae['product_stock']=parseInt(_0x4223ae[_0x447629(0x24c)])-parseInt(_0x5482ac[_0x447629(0x1bb)])):_0x4223ae[_0x447629(0x1ac)]==_0x5482ac[_0x447629(0x1ac)]&&_0x4223ae[_0x447629(0x225)]==_0x5482ac[_0x447629(0x225)]&&(_0x4223ae['product_stock']=parseInt(_0x4223ae[_0x447629(0x24c)])+parseInt(_0x5482ac['adjust_qty']));});}),await _0xa769ae['save'](),_0x29d8bb['flash'](_0x5391f1(0x1e6),_0x5391f1(0x1af)),_0x26037d['redirect'](_0x5391f1(0x260));}catch(_0x47aa2e){console[_0x5391f1(0x1db)](_0x47aa2e);}}),router[a0_0x3f15ec(0x222)](a0_0x3f15ec(0x1e9),async(_0x488d0b,_0x118ec8)=>{var _0x25708a=a0_0x3f15ec;const {primary_code:_0x1f8030,warehouse_data:_0x1c34fb,rooms_data:_0xebe664,Roomslist:_0x174f85}=_0x488d0b['body'],_0xf3ab46=_0x174f85[_0x25708a(0x19b)](','),_0x5792f3=[];async function _0x2292c9(_0x195b8a){var _0x477206=_0x25708a;const _0x2a9b85=await warehouse['aggregate']([{'$match':{'name':_0x1c34fb,'room':_0x195b8a}},{'$unwind':_0x477206(0x23e)},{'$match':{'product_details.primary_code':_0x1f8030}},{'$group':{'_id':_0x477206(0x19c),'name':{'$first':_0x477206(0x230)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x477206(0x1a8)},'secondary_code':{'$first':_0x477206(0x1ec)},'product_code':{'$first':_0x477206(0x1d1)},'level':{'$first':_0x477206(0x20d)},'isle':{'$first':_0x477206(0x221)},'type':{'$first':_0x477206(0x1f8)},'pallet':{'$first':_0x477206(0x236)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x477206(0x228)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x477206(0x23f)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x477206(0x1b5)},'roomNamed':{'$first':_0x477206(0x247)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x768e1a=await warehouse[_0x477206(0x241)]([{'$match':{'name':_0x1c34fb,'room':_0x195b8a}},{'$unwind':_0x477206(0x23e)},{'$match':{'product_details.secondary_code':_0x1f8030}},{'$group':{'_id':_0x477206(0x19c),'name':{'$first':_0x477206(0x230)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x477206(0x1a8)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x477206(0x20d)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x477206(0x1f8)},'pallet':{'$first':_0x477206(0x236)},'unit':{'$first':_0x477206(0x223)},'secondary_unit':{'$first':_0x477206(0x24f)},'storage':{'$first':_0x477206(0x1de)},'rack':{'$first':_0x477206(0x228)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x477206(0x23f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x477206(0x1e2)}}}]);if(_0x2a9b85['length']>0x0)_0x5792f3['push'](_0x2a9b85);else _0x768e1a[_0x477206(0x1cf)]>0x0&&_0x5792f3[_0x477206(0x1fa)](_0x768e1a);}const _0x518e63=_0xf3ab46[_0x25708a(0x1ed)](_0xba3f46=>_0x2292c9(_0xba3f46));await Promise[_0x25708a(0x24d)](_0x518e63),_0x118ec8['json'](_0x5792f3);}),router[a0_0x3f15ec(0x222)](a0_0x3f15ec(0x1d2),async(_0x1ccb84,_0x9c9955)=>{var _0x4bcce0=a0_0x3f15ec;const {productCode:_0x300519,bay:_0x5af58c,warehouses:_0x49d03c,room:_0x29af1e}=_0x1ccb84[_0x4bcce0(0x233)];console[_0x4bcce0(0x1db)](_0x1ccb84[_0x4bcce0(0x233)]);try{const _0x232121=await warehouse[_0x4bcce0(0x241)]([{'$match':{'name':_0x49d03c,'room':_0x29af1e}},{'$unwind':_0x4bcce0(0x23e)},{'$match':{'product_details.bay':parseInt(_0x5af58c)}},{'$group':{'_id':_0x4bcce0(0x19c),'name':{'$first':_0x4bcce0(0x230)},'product_stock':{'$first':_0x4bcce0(0x1fb)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x4bcce0(0x1ee)}}}]);_0x9c9955[_0x4bcce0(0x19a)](0xc8)[_0x4bcce0(0x1a2)](_0x232121);}catch(_0x482099){_0x9c9955[_0x4bcce0(0x19a)](0x194)[_0x4bcce0(0x1a2)]({'message':_0x482099[_0x4bcce0(0x208)]});}}),module[a0_0x3f15ec(0x250)]=router;