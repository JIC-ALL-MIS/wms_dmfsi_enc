var a0_0x3b8399=a0_0x4286;function a0_0x4286(_0x5e4fa3,_0x4820b1){var _0x347bd4=a0_0x347b();return a0_0x4286=function(_0x4286e8,_0xfd0bbe){_0x4286e8=_0x4286e8-0x15d;var _0x5df472=_0x347bd4[_0x4286e8];return _0x5df472;},a0_0x4286(_0x5e4fa3,_0x4820b1);}(function(_0x232a43,_0x1fec4c){var _0x575a33=a0_0x4286,_0x32faa7=_0x232a43();while(!![]){try{var _0x2d33c6=-parseInt(_0x575a33(0x15e))/0x1*(-parseInt(_0x575a33(0x1e4))/0x2)+-parseInt(_0x575a33(0x1c9))/0x3+parseInt(_0x575a33(0x173))/0x4*(-parseInt(_0x575a33(0x1bc))/0x5)+parseInt(_0x575a33(0x1dd))/0x6+parseInt(_0x575a33(0x1aa))/0x7+parseInt(_0x575a33(0x175))/0x8*(parseInt(_0x575a33(0x178))/0x9)+-parseInt(_0x575a33(0x1d2))/0xa*(-parseInt(_0x575a33(0x194))/0xb);if(_0x2d33c6===_0x1fec4c)break;else _0x32faa7['push'](_0x32faa7['shift']());}catch(_0x4fd3fc){_0x32faa7['push'](_0x32faa7['shift']());}}}(a0_0x347b,0xdf706));function a0_0x347b(){var _0x3c95da=['body','$product_details.expiry_date','language','</thead>','finalize','Router','$product_details._id','adjustment\x20data\x20update\x20successfully','$product_details.rack','$product_details.secondary_code','aggregate','port','English\x20(US)','$product_details','prod_cat','179qBRRul','$product_details.maxPerUnit','Error\x20Occurs','<h2>\x20','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','secondary_unit','errors','$product_details.floorlevel','\x20Order\x20Date\x20:\x20','</tbody>','Adjustment\x20Finalize\x20Successfully','role','params','get','$product_details.primary_code','QA\x20Warehouse','redirect','exports','/adjustment_finished/preview/','edit_adjustment_finished_view','$warehouse_name','568KUQYyo','foreach\x20newproduct','8786496UsdScX','</table>','<!DOCTYPE\x20html>','9BbnYUL','password','note','success','minus','</tr>','$product_details.invoice','message','Arabic','product_details','New_Qty_Converted_adj','/../public','$product.room_names','json','Portuguese','expiry_date','post','forEach','warehouse_name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','True','$product','back','room_names','Rooms','catch','log','<hr\x20class=\x22my-3\x22>','6560719GrNeIz','all','Spanish','/upload/','New_Qty_Converted','batch_code','$product_details.production_date','<strong>\x20Regards\x20</strong>','../middleware/auth','createTransport','map','$product_details.storage','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$_id','adjust_qty','<h5>','prod_invoice','push','_id','types','Finished\x20Goods','prod_code','4530211fBDHYl','error','$product.product_name','length','image','</body></html>','</h5>','filter','JO_number','render','slice','production_date','stock','$product_details.bin','<html><head><title></title>','flash','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','ADJF-','38320LEBOEz','</td>','random','$finalize','getMonth','$product_details.maxProducts','$invoice','Adjustment\x20Mail','An\x20error\x20occurred.','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','../public/language/languages.json','bay','2432937ZDmmLr','$product_details.product_name','product_date','$product_details.secondary_unit','Portuguese\x20(BR)','product_code','$date','<div>','Secondary_units','10GLlIlc','split','</div>','status','find','adjustment_finished','/view/add_adjustment','findById','\x20Order\x20Number\x20:\x20','$product_details.batch_code','getFullYear','1206096Iqotif','$product_details.type','Return\x20Rooms','Chinese','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','host','3034Exumdn','Hindi','/CheckingWarehouse','prod_name','maxPerUnit','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<h5\x20style=\x22text-align:\x20left;\x22>','email','product_stock','$name','/view/:id','toString','sendMail','save','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','stockBefore','/picking_list/PDF_adjustment/','$product_details.product_stock','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','<table\x20style=\x22width:\x20100%\x20!important;\x22>','product_name','<span\x20style=\x22float:\x20right;\x22>','$product_details.unit','French','string','warehouse','purchases_data','FGSEmail','master','Arabic\x20(ae)','findOne','DRY\x20GOODS','room','$product_details.product_code','add_adjustment_finished','staff','<tr>','product','English','logo','Enabled','\x20</h2>','<tbody\x20style=\x22text-align:\x20center;\x22>','/adjustment_finished/view','padStart','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$room','</span>','/barcode_scanner','Ambient','user','invoice','new_adjust_qty','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','unit','site_title','then','$product_details.bay','Primary_Units','/preview/:id'];a0_0x347b=function(){return _0x3c95da;};return a0_0x347b();}const express=require('express'),app=express(),router=express[a0_0x3b8399(0x226)](),auth=require(a0_0x3b8399(0x19c)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x3b8399(0x1c7)),nodemailer=require('nodemailer');router[a0_0x3b8399(0x16b)]('/view',auth,async(_0x3ca601,_0x38ae64)=>{var _0x482b9d=a0_0x3b8399;try{const {username:_0x4f25fb,email:_0x4b0265,role:_0x364776}=_0x3ca601[_0x482b9d(0x217)],_0x577e9e=_0x3ca601[_0x482b9d(0x217)],_0x3a370d=await profile[_0x482b9d(0x202)]({'email':_0x577e9e[_0x482b9d(0x1eb)]}),_0x4a6dd4=await master_shop[_0x482b9d(0x1d6)]();let _0x23ae69;if(_0x577e9e[_0x482b9d(0x169)]==_0x482b9d(0x207)){const _0x2894f4=await staff[_0x482b9d(0x202)]({'email':_0x577e9e[_0x482b9d(0x1eb)]});_0x23ae69=await warehouse['find']({'status':_0x482b9d(0x20c),'name':_0x2894f4[_0x482b9d(0x1fd)]});}else _0x23ae69=await warehouse['find']({'status':'Enabled'});const _0x50acc0=await product['find']();let _0x19b09f;if(_0x577e9e['role']==_0x482b9d(0x207)){const _0x27ff78=await staff[_0x482b9d(0x202)]({'email':_0x577e9e[_0x482b9d(0x1eb)]});_0x19b09f=await adjustment_finished[_0x482b9d(0x1d6)]({'warehouse_name':_0x27ff78['warehouse']});}else _0x19b09f=await adjustment_finished[_0x482b9d(0x22b)]([{'$unwind':_0x482b9d(0x18d)},{'$group':{'_id':_0x482b9d(0x1a1),'invoice':{'$first':_0x482b9d(0x1c2)},'date':{'$first':_0x482b9d(0x1cf)},'warehouse_name':{'$first':_0x482b9d(0x172)},'room':{'$addToSet':_0x482b9d(0x184)},'finalize':{'$first':_0x482b9d(0x1bf)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x4a6dd4[0x0]['language']=='English\x20(US)'){var _0x417b47=users[_0x482b9d(0x20a)];console[_0x482b9d(0x192)](_0x417b47);}else{if(_0x4a6dd4[0x0]['language']==_0x482b9d(0x1e5))var _0x417b47=users[_0x482b9d(0x1e5)];else{if(_0x4a6dd4[0x0][_0x482b9d(0x223)]=='German')var _0x417b47=users[_0x482b9d(0x211)];else{if(_0x4a6dd4[0x0][_0x482b9d(0x223)]=='Spanish')var _0x417b47=users['Spanish'];else{if(_0x4a6dd4[0x0][_0x482b9d(0x223)]==_0x482b9d(0x1fb))var _0x417b47=users[_0x482b9d(0x1fb)];else{if(_0x4a6dd4[0x0][_0x482b9d(0x223)]==_0x482b9d(0x1cd))var _0x417b47=users[_0x482b9d(0x186)];else{if(_0x4a6dd4[0x0][_0x482b9d(0x223)]==_0x482b9d(0x1e0))var _0x417b47=users[_0x482b9d(0x1e0)];else{if(_0x4a6dd4[0x0][_0x482b9d(0x223)]=='Arabic\x20(ae)')var _0x417b47=users[_0x482b9d(0x180)];}}}}}}}_0x38ae64[_0x482b9d(0x1b3)](_0x482b9d(0x1d7),{'success':_0x3ca601['flash'](_0x482b9d(0x17b)),'errors':_0x3ca601[_0x482b9d(0x1b9)](_0x482b9d(0x164)),'role':_0x577e9e,'profile':_0x3a370d,'warehouse':_0x23ae69,'product':_0x50acc0,'adjustment':_0x19b09f,'master_shop':_0x4a6dd4,'language':_0x417b47});}catch(_0xa52991){console[_0x482b9d(0x192)](_0xa52991);}});async function getRandom8DigitNumber(){var _0x298d36=a0_0x3b8399;const _0x10b9ee=0x989680,_0x5d2a2c=0x5f5e0ff,_0x55eb3f=Math['floor'](Math[_0x298d36(0x1be)]()*(_0x5d2a2c-_0x10b9ee+0x1))+_0x10b9ee;var _0x1ea130;const _0x11c68b=await adjustment_finished['findOne']({'invoice':_0x298d36(0x1bb)+_0x55eb3f});return _0x11c68b&&_0x11c68b[_0x298d36(0x1ad)]>0x0?_0x1ea130=_0x298d36(0x1bb)+_0x55eb3f:_0x1ea130='ADJF-'+_0x55eb3f,_0x1ea130;}router[a0_0x3b8399(0x16b)]('/view/add_adjustment',auth,async(_0x402bae,_0x56ee1f)=>{var _0x101bd0=a0_0x3b8399;try{const {username:_0x432199,email:_0x5ace66,role:_0x35b6f3}=_0x402bae[_0x101bd0(0x217)],_0x126ba3=_0x402bae[_0x101bd0(0x217)],_0x4edcfd=await profile[_0x101bd0(0x202)]({'email':_0x126ba3[_0x101bd0(0x1eb)]}),_0x287ce7=await master_shop[_0x101bd0(0x1d6)]();let _0xbb5596;if(_0x126ba3[_0x101bd0(0x169)]==_0x101bd0(0x207)){const _0x18a012=await staff[_0x101bd0(0x202)]({'email':_0x126ba3['email']});_0xbb5596=await warehouse[_0x101bd0(0x22b)]([{'$match':{'status':_0x101bd0(0x20c),'name':_0x18a012[_0x101bd0(0x1fd)],'warehouse_category':_0x101bd0(0x1a8),'name':{'$ne':_0x101bd0(0x16d)}}},{'$group':{'_id':_0x101bd0(0x1ed),'name':{'$first':'$name'}}}]);}else _0xbb5596=await warehouse[_0x101bd0(0x22b)]([{'$match':{'status':'Enabled','warehouse_category':_0x101bd0(0x1a8),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x101bd0(0x1ed),'name':{'$first':_0x101bd0(0x1ed)}}}]);const _0x3127fa=await product[_0x101bd0(0x1d6)]({}),_0x290999=await adjustment_finished[_0x101bd0(0x1d6)]({}),_0x5b7afa=_0x290999[_0x101bd0(0x1ad)]+0x1,_0x2b842d=_0x101bd0(0x1bb)+_0x5b7afa[_0x101bd0(0x1ef)]()[_0x101bd0(0x210)](0x5,'0');var _0x961650=[_0x101bd0(0x216),'Enclosed',_0x101bd0(0x1df)];if(_0x287ce7[0x0]['language']==_0x101bd0(0x22d))var _0x41d2d1=users[_0x101bd0(0x20a)];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]==_0x101bd0(0x1e5))var _0x41d2d1=users[_0x101bd0(0x1e5)];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]==_0x101bd0(0x211))var _0x41d2d1=users[_0x101bd0(0x211)];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]==_0x101bd0(0x196))var _0x41d2d1=users[_0x101bd0(0x196)];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]=='French')var _0x41d2d1=users['French'];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]==_0x101bd0(0x1cd))var _0x41d2d1=users[_0x101bd0(0x186)];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]==_0x101bd0(0x1e0))var _0x41d2d1=users['Chinese'];else{if(_0x287ce7[0x0][_0x101bd0(0x223)]=='Arabic\x20(ae)')var _0x41d2d1=users[_0x101bd0(0x180)];}}}}}}}const _0x511561=getRandom8DigitNumber();_0x511561[_0x101bd0(0x21d)](_0x46681e=>{var _0x1a434e=_0x101bd0;_0x56ee1f[_0x1a434e(0x1b3)](_0x1a434e(0x206),{'success':_0x402bae[_0x1a434e(0x1b9)](_0x1a434e(0x17b)),'errors':_0x402bae[_0x1a434e(0x1b9)](_0x1a434e(0x164)),'role':_0x126ba3,'profile':_0x4edcfd,'warehouse':_0xbb5596,'product':_0x3127fa,'master_shop':_0x287ce7,'language':_0x41d2d1,'rooms_data':_0x961650,'invoice_no':_0x46681e});})['catch'](_0x1fa067=>{var _0x4a1a65=_0x101bd0;_0x402bae[_0x4a1a65(0x1b9)](_0x4a1a65(0x164),_0x4a1a65(0x1e9)),_0x56ee1f[_0x4a1a65(0x16e)]('/adjustment/view');});}catch(_0x3ecb82){console['log'](_0x3ecb82);}}),router[a0_0x3b8399(0x188)](a0_0x3b8399(0x1d8),auth,async(_0x4079af,_0x5c3383)=>{var _0x4b6233=a0_0x3b8399;try{const {warehouse_name:_0x13e95a,date:_0x5cbeda,prod_name:_0x19bec6,level:_0x43fcd3,isle:_0x5f000b,pallet:_0xe66c8c,stock:_0x27b773,types:_0x48352c,adjust_qty:_0x3fc4ee,new_adjust_qty:_0x2a7295,note:_0x3fcec0,Room_name:_0x3943e7,invoice:_0x3ca097,JO_number:_0x1b5740,expiry_date:_0x52406f}=_0x4079af[_0x4b6233(0x221)];if(typeof _0x19bec6==_0x4b6233(0x1fc))var _0x5c604a=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1e7)]],_0x29d9c0=[_0x4079af[_0x4b6233(0x221)]['level']],_0x149304=[_0x4079af[_0x4b6233(0x221)]['stock']],_0x23c661=[_0x4079af[_0x4b6233(0x221)]['types']],_0x3248ac=[_0x4079af[_0x4b6233(0x221)]['New_Qty_Converted_adj']],_0x119ec4=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x198)]],_0x2e3863=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x21f)]],_0x1710b4=[_0x4079af[_0x4b6233(0x221)]['Secondary_units']],_0x260814=[_0x4079af['body'][_0x4b6233(0x1a9)]],_0x384dc6=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x199)]],_0x2a71d1=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x187)]],_0x327faf=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1cb)]],_0x56e6fb=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x15d)]],_0x57f68e=[_0x4079af['body'][_0x4b6233(0x190)]],_0x136fa0=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1e8)]],_0x43be51=[_0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1a4)]];else var _0x5c604a=[..._0x4079af[_0x4b6233(0x221)]['prod_name']],_0x29d9c0=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1e1)]],_0x149304=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1b6)]],_0x23c661=[..._0x4079af['body'][_0x4b6233(0x1a7)]],_0x3248ac=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x182)]],_0x119ec4=[..._0x4079af['body'][_0x4b6233(0x198)]],_0x2e3863=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x21f)]],_0x1710b4=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1d1)]],_0x260814=[..._0x4079af[_0x4b6233(0x221)]['prod_code']],_0x384dc6=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x199)]],_0x2a71d1=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x187)]],_0x327faf=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x1cb)]],_0x56e6fb=[..._0x4079af[_0x4b6233(0x221)]['prod_cat']],_0x57f68e=[..._0x4079af[_0x4b6233(0x221)][_0x4b6233(0x190)]],_0x136fa0=[..._0x4079af['body'][_0x4b6233(0x1e8)]],_0x43be51=[..._0x4079af['body']['prod_invoice']];const _0x503c0a=_0x5c604a['map'](_0x5e5f38=>{return _0x5e5f38={'product_name':_0x5e5f38};});_0x29d9c0[_0x4b6233(0x189)]((_0x38987d,_0x40d0c6)=>{var _0x4fa660=_0x4b6233;_0x503c0a[_0x40d0c6][_0x4fa660(0x1c8)]=_0x38987d;}),_0x149304[_0x4b6233(0x189)]((_0x518a43,_0x15ef2a)=>{_0x503c0a[_0x15ef2a]['stockBefore']=_0x518a43;}),_0x23c661[_0x4b6233(0x189)]((_0x4b7c27,_0x81d129)=>{var _0x340afc=_0x4b6233;_0x503c0a[_0x81d129][_0x340afc(0x1a7)]=_0x4b7c27;}),_0x3248ac[_0x4b6233(0x189)]((_0x10d3c8,_0x329f7d)=>{var _0x4917f5=_0x4b6233;_0x503c0a[_0x329f7d][_0x4917f5(0x1a2)]=_0x10d3c8;}),_0x119ec4[_0x4b6233(0x189)]((_0x3080d4,_0x22050e)=>{var _0x263397=_0x4b6233;_0x503c0a[_0x22050e][_0x263397(0x219)]=_0x3080d4;}),_0x2e3863[_0x4b6233(0x189)]((_0x107d63,_0x47052e)=>{var _0x2381cc=_0x4b6233;_0x503c0a[_0x47052e][_0x2381cc(0x21b)]=_0x107d63;}),_0x1710b4[_0x4b6233(0x189)]((_0x22b70c,_0x38687b)=>{var _0x372dc9=_0x4b6233;_0x503c0a[_0x38687b][_0x372dc9(0x163)]=_0x22b70c;}),_0x260814[_0x4b6233(0x189)]((_0x2956d9,_0x53a1c1)=>{var _0x5b51aa=_0x4b6233;_0x503c0a[_0x53a1c1][_0x5b51aa(0x1ce)]=_0x2956d9;}),_0x384dc6['forEach']((_0x3af587,_0x56dc6a)=>{var _0x4a6336=_0x4b6233;_0x503c0a[_0x56dc6a][_0x4a6336(0x199)]=_0x3af587;}),_0x2a71d1[_0x4b6233(0x189)]((_0x271253,_0x106ec0)=>{_0x503c0a[_0x106ec0]['expiry_date']=_0x271253;}),_0x327faf[_0x4b6233(0x189)]((_0x5721d4,_0x4dd9ac)=>{var _0xb35d1f=_0x4b6233;_0x503c0a[_0x4dd9ac][_0xb35d1f(0x1b5)]=_0x5721d4;}),_0x56e6fb['forEach']((_0x59da68,_0x1b3dad)=>{var _0xc6ff6=_0x4b6233;_0x503c0a[_0x1b3dad][_0xc6ff6(0x15d)]=_0x59da68;}),_0x57f68e[_0x4b6233(0x189)]((_0x462aff,_0xb9ba5e)=>{var _0x265d90=_0x4b6233;_0x503c0a[_0xb9ba5e][_0x265d90(0x18f)]=_0x462aff;}),_0x136fa0[_0x4b6233(0x189)]((_0xa5b406,_0x5045e4)=>{var _0x33c786=_0x4b6233;_0x503c0a[_0x5045e4][_0x33c786(0x1e8)]=_0xa5b406;}),_0x43be51[_0x4b6233(0x189)]((_0x45bde2,_0x4227e4)=>{var _0xa275f0=_0x4b6233;_0x503c0a[_0x4227e4][_0xa275f0(0x218)]=_0x45bde2;});const _0x56594c=_0x503c0a['filter'](_0x15d186=>_0x15d186[_0x4b6233(0x1a2)]!=='0'&&_0x15d186[_0x4b6233(0x1a2)]!=='');var _0x38444a=0x0;_0x56594c['forEach'](_0x551ddb=>{var _0x1198c3=_0x4b6233;console['log']('foreach\x20newproduct',_0x551ddb),parseInt(_0x551ddb[_0x1198c3(0x1a2)])<=0x0&&_0x38444a++;});if(_0x38444a!=0x0)return _0x4079af[_0x4b6233(0x1b9)]('errors',_0x4b6233(0x1f6)),_0x5c3383[_0x4b6233(0x16e)](_0x4b6233(0x18e));const _0x54050e=new adjustment_finished({'warehouse_name':_0x13e95a,'date':_0x5cbeda,'product':_0x56594c,'note':_0x3fcec0,'room':_0x3943e7,'invoice':_0x3ca097,'JO_number':_0x1b5740,'expiry_date':_0x52406f}),_0x358910=await _0x54050e[_0x4b6233(0x1f1)]();_0x4079af[_0x4b6233(0x1b9)]('success','adjustment\x20add\x20successfull'),_0x5c3383['redirect'](_0x4b6233(0x170)+_0x358910[_0x4b6233(0x1a6)]);}catch(_0x473f54){console['log'](_0x473f54),_0x5c3383['status'](0xc8)[_0x4b6233(0x185)]({'message':_0x473f54[_0x4b6233(0x17f)]});}}),router['get'](a0_0x3b8399(0x220),auth,async(_0x1a4d16,_0x227dc2)=>{var _0x328d6b=a0_0x3b8399;try{const {username:_0x3e1e42,email:_0x22b219,role:_0xa8bdc3}=_0x1a4d16['user'],_0x15ecf7=_0x1a4d16[_0x328d6b(0x217)],_0x3821de=await profile[_0x328d6b(0x202)]({'email':_0x15ecf7['email']}),_0x3b9ea8=await master_shop[_0x328d6b(0x1d6)](),_0x2e437a=_0x1a4d16[_0x328d6b(0x16a)]['id'],_0x23aa11=await adjustment_finished['findById']({'_id':_0x2e437a}),_0x251f1e=await purchases[_0x328d6b(0x22b)]([{'$match':{'warehouse_name':_0x23aa11['warehouse_name']}},{'$unwind':_0x328d6b(0x18d)},{'$group':{'_id':_0x328d6b(0x1ac)}}]);console[_0x328d6b(0x192)]('purchases_data',_0x251f1e);const _0x2173ea=await product['find']({}),_0x18672b=await warehouse[_0x328d6b(0x22b)]([{'$match':{'name':_0x23aa11[_0x328d6b(0x18a)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x328d6b(0x22e)},{'$group':{'_id':_0x328d6b(0x227),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x328d6b(0x21e)},'bin':{'$first':_0x328d6b(0x1b7)},'type':{'$first':_0x328d6b(0x1de)},'floorlevel':{'$first':_0x328d6b(0x165)},'primary_code':{'$first':_0x328d6b(0x16c)},'secondary_code':{'$first':_0x328d6b(0x22a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x328d6b(0x19f)},'rack':{'$first':_0x328d6b(0x229)},'expiry_date':{'$first':_0x328d6b(0x222)},'production_date':{'$first':_0x328d6b(0x19a)},'batch_code':{'$first':_0x328d6b(0x1db)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x328d6b(0x213)}}}]);if(_0x3b9ea8[0x0][_0x328d6b(0x223)]=='English\x20(US)'){var _0x4ee773=users[_0x328d6b(0x20a)];console[_0x328d6b(0x192)](_0x4ee773);}else{if(_0x3b9ea8[0x0][_0x328d6b(0x223)]==_0x328d6b(0x1e5))var _0x4ee773=users[_0x328d6b(0x1e5)];else{if(_0x3b9ea8[0x0][_0x328d6b(0x223)]==_0x328d6b(0x211))var _0x4ee773=users[_0x328d6b(0x211)];else{if(_0x3b9ea8[0x0][_0x328d6b(0x223)]==_0x328d6b(0x196))var _0x4ee773=users[_0x328d6b(0x196)];else{if(_0x3b9ea8[0x0][_0x328d6b(0x223)]==_0x328d6b(0x1fb))var _0x4ee773=users[_0x328d6b(0x1fb)];else{if(_0x3b9ea8[0x0][_0x328d6b(0x223)]==_0x328d6b(0x1cd))var _0x4ee773=users[_0x328d6b(0x186)];else{if(_0x3b9ea8[0x0][_0x328d6b(0x223)]==_0x328d6b(0x1e0))var _0x4ee773=users[_0x328d6b(0x1e0)];else{if(_0x3b9ea8[0x0]['language']==_0x328d6b(0x201))var _0x4ee773=users[_0x328d6b(0x180)];}}}}}}}_0x227dc2[_0x328d6b(0x1b3)](_0x328d6b(0x171),{'success':_0x1a4d16['flash'](_0x328d6b(0x17b)),'errors':_0x1a4d16[_0x328d6b(0x1b9)](_0x328d6b(0x164)),'role':_0x15ecf7,'profile':_0x3821de,'adjustment':_0x23aa11,'stock':_0x18672b,'master_shop':_0x3b9ea8,'warehouse_name':_0x251f1e,'unit':_0x2173ea,'language':_0x4ee773});}catch(_0xbc204e){console[_0x328d6b(0x192)](_0xbc204e),_0x227dc2[_0x328d6b(0x1d5)](0xc8)[_0x328d6b(0x185)]({'message':_0xbc204e[_0x328d6b(0x17f)]});}}),router['post'](a0_0x3b8399(0x220),auth,async(_0x468355,_0x523da3)=>{var _0x9581f5=a0_0x3b8399;try{const {invoice:_0x2fa4d4,warehouse_name:_0x2f6076,Room_name:_0x342b31}=_0x468355[_0x9581f5(0x221)],_0x249d9c=_0x468355['params']['id'],_0x52ba25=await adjustment_finished[_0x9581f5(0x1d9)]({'_id':_0x249d9c});var _0x2dcb1f;const _0x4f9fef=_0x52ba25['product'][_0x9581f5(0x19e)](async _0x9c426d=>{var _0x37c7db=_0x9581f5;if(_0x9c426d[_0x37c7db(0x1a2)]>0x0){_0x2dcb1f=await warehouse['findOne']({'name':_0x2f6076,'room':_0x9c426d[_0x37c7db(0x18f)],'warehouse_category':'Finished\x20Goods'});const _0x5994ef=_0x2dcb1f[_0x37c7db(0x181)][_0x37c7db(0x19e)](_0x3d98af=>{var _0x5648e2=_0x37c7db;console[_0x5648e2(0x192)](_0x9c426d['types']);if(_0x9c426d[_0x5648e2(0x1a7)]==_0x5648e2(0x17c))_0x3d98af[_0x5648e2(0x1f8)]==_0x9c426d[_0x5648e2(0x1f8)]&&_0x3d98af[_0x5648e2(0x1c8)]==_0x9c426d['bay']&&_0x3d98af[_0x5648e2(0x187)]==_0x9c426d[_0x5648e2(0x187)]&&_0x3d98af[_0x5648e2(0x1b5)]==_0x9c426d[_0x5648e2(0x1b5)]&&_0x3d98af[_0x5648e2(0x199)]==_0x9c426d[_0x5648e2(0x199)]&&_0x3d98af['invoice']==_0x9c426d[_0x5648e2(0x218)]&&(_0x3d98af['product_stock']=_0x3d98af['product_stock']-_0x9c426d[_0x5648e2(0x1a2)]);else _0x9c426d[_0x5648e2(0x1a7)]=='add'&&(_0x3d98af[_0x5648e2(0x1f8)]==_0x9c426d[_0x5648e2(0x1f8)]&&_0x3d98af['bay']==_0x9c426d[_0x5648e2(0x1c8)]&&_0x3d98af[_0x5648e2(0x187)]==_0x9c426d[_0x5648e2(0x187)]&&_0x3d98af[_0x5648e2(0x1b5)]==_0x9c426d['production_date']&&_0x3d98af['batch_code']==_0x9c426d[_0x5648e2(0x199)]&&_0x3d98af['invoice']==_0x9c426d[_0x5648e2(0x218)]&&(_0x3d98af[_0x5648e2(0x1ec)]=_0x3d98af[_0x5648e2(0x1ec)]+_0x9c426d[_0x5648e2(0x1a2)]));});}return _0x2dcb1f;});Promise[_0x9581f5(0x195)](_0x4f9fef)[_0x9581f5(0x21d)](async _0x24d995=>{var _0x33577f=_0x9581f5;try{for(const _0x1e0e5e of _0x24d995){await _0x1e0e5e[_0x33577f(0x1f1)]();}_0x52ba25[_0x33577f(0x225)]=_0x33577f(0x18c);const _0x503cbc=await _0x52ba25[_0x33577f(0x1f1)](),_0x44334b=await master_shop['find'](),_0x40db93=await email_settings[_0x33577f(0x202)](),_0x47c664=await supervisor_settings['find']();var _0x3d967e=_0x52ba25[_0x33577f(0x209)],_0x252dfa='',_0x10e081;for(_0x10e081 in _0x3d967e){var _0x5aaab1='FG';_0x52ba25[_0x33577f(0x18a)]==_0x33577f(0x203)&&(_0x5aaab1='DG'),_0x252dfa+=_0x33577f(0x208)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d967e[_0x10e081][_0x33577f(0x1f8)]+_0x33577f(0x1bd)+_0x33577f(0x21a)+_0x3d967e[_0x10e081][_0x33577f(0x1ce)]+'</td>'+_0x33577f(0x21a)+_0x3d967e[_0x10e081][_0x33577f(0x1a2)]+'</td>'+_0x33577f(0x21a)+_0x3d967e[_0x10e081]['unit']+_0x33577f(0x1bd)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d967e[_0x10e081][_0x33577f(0x163)]+_0x33577f(0x1bd)+_0x33577f(0x21a)+_0x52ba25['warehouse_name']+_0x33577f(0x1bd)+_0x33577f(0x21a)+_0x3d967e[_0x10e081]['room_names']+'</td>'+_0x33577f(0x21a)+_0x5aaab1+_0x3d967e[_0x10e081]['bay']+'</td>'+_0x33577f(0x17d);}let _0x353535=nodemailer[_0x33577f(0x19d)]({'host':_0x40db93[_0x33577f(0x1e3)],'port':Number(_0x40db93[_0x33577f(0x22c)]),'secure':![],'auth':{'user':_0x40db93[_0x33577f(0x1eb)],'pass':_0x40db93[_0x33577f(0x179)]}}),_0x4403d6={'from':_0x40db93[_0x33577f(0x1eb)],'to':_0x47c664[0x0][_0x33577f(0x1ff)],'subject':_0x33577f(0x1c3),'attachments':[{'filename':'Logo.png','path':__dirname+_0x33577f(0x183)+_0x33577f(0x197)+_0x44334b[0x0][_0x33577f(0x1ae)],'cid':_0x33577f(0x20b)}],'html':_0x33577f(0x177)+_0x33577f(0x1b8)+'</head><body>'+_0x33577f(0x1d0)+_0x33577f(0x162)+'<div>'+_0x33577f(0x1f2)+'</div>'+_0x33577f(0x1d0)+_0x33577f(0x161)+_0x44334b[0x0][_0x33577f(0x21c)]+_0x33577f(0x20d)+'</div>'+_0x33577f(0x1d4)+_0x33577f(0x193)+_0x33577f(0x1d0)+_0x33577f(0x1ea)+_0x33577f(0x1da)+_0x52ba25['invoice']+'\x20'+_0x33577f(0x1f9)+_0x33577f(0x166)+_0x52ba25['date']+'\x20'+_0x33577f(0x214)+_0x33577f(0x1b0)+_0x33577f(0x1d4)+_0x33577f(0x1f7)+_0x33577f(0x18b)+_0x33577f(0x208)+_0x33577f(0x212)+_0x33577f(0x1c6)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x33577f(0x1e2)+_0x33577f(0x1a0)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x33577f(0x1ba)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x33577f(0x17d)+_0x33577f(0x224)+_0x33577f(0x20e)+'\x20'+_0x252dfa+'\x20'+_0x33577f(0x167)+_0x33577f(0x176)+_0x33577f(0x1d0)+_0x33577f(0x19b)+_0x33577f(0x1a3)+_0x44334b[0x0]['site_title']+_0x33577f(0x1b0)+_0x33577f(0x1d4)+_0x33577f(0x1d4)+_0x33577f(0x1af)};_0x353535[_0x33577f(0x1f0)](_0x4403d6,function(_0xea9453,_0x58e572){var _0x93bfd3=_0x33577f;_0xea9453?(console[_0x93bfd3(0x192)](_0xea9453),console[_0x93bfd3(0x192)](_0x93bfd3(0x160))):console[_0x93bfd3(0x192)](_0x93bfd3(0x1c5));}),_0x468355[_0x33577f(0x1b9)](_0x33577f(0x17b),_0x33577f(0x168)),_0x523da3[_0x33577f(0x16e)](_0x33577f(0x1f4)+_0x503cbc['_id']);}catch(_0x20c8ce){console[_0x33577f(0x1ab)](_0x20c8ce),_0x523da3[_0x33577f(0x1d5)](0x1f4)[_0x33577f(0x185)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x9581f5(0x191)](_0x4d7d20=>{var _0x36cc2f=_0x9581f5;console['error'](_0x4d7d20),_0x523da3[_0x36cc2f(0x1d5)](0x1f4)['json']({'error':_0x36cc2f(0x1c4)});});}catch(_0x590791){_0x523da3[_0x9581f5(0x185)]({'message':_0x590791['message']});}}),router[a0_0x3b8399(0x16b)](a0_0x3b8399(0x1ee),auth,async(_0x223131,_0x3d69e8)=>{var _0x62eb2e=a0_0x3b8399;try{const {username:_0xaca706,email:_0x40db0f,role:_0x5969d2}=_0x223131['user'],_0x2e2bd3=_0x223131[_0x62eb2e(0x217)],_0x4c26f3=await profile['findOne']({'email':_0x2e2bd3['email']}),_0x53b61e=await master_shop[_0x62eb2e(0x1d6)]();console[_0x62eb2e(0x192)](_0x62eb2e(0x200),_0x53b61e);const _0x268b62=_0x223131['params']['id'],_0x449c2e=await adjustment_finished[_0x62eb2e(0x1d9)]({'_id':_0x268b62});let _0xf4d06b=new Date(_0x449c2e[_0x62eb2e(0x187)]),_0x50f6c3=('0'+_0xf4d06b['getDate']())[_0x62eb2e(0x1b4)](-0x2),_0x3e2b46=('0'+(_0xf4d06b[_0x62eb2e(0x1c0)]()+0x1))[_0x62eb2e(0x1b4)](-0x2),_0x1c2b58=_0xf4d06b[_0x62eb2e(0x1dc)](),_0x9c01fe=_0x1c2b58+'-'+_0x3e2b46+'-'+_0x50f6c3;var _0x2a1e88=['Ambient','Enclosed',_0x62eb2e(0x1df)];const _0x4fa215=await purchases['aggregate']([{'$match':{'warehouse_name':_0x449c2e[_0x62eb2e(0x18a)]}},{'$unwind':_0x62eb2e(0x18d)},{'$group':{'_id':_0x62eb2e(0x1ac)}}]);console[_0x62eb2e(0x192)](_0x62eb2e(0x1fe),_0x4fa215);const _0x1cfc21=await product[_0x62eb2e(0x1d6)]({}),_0x9e0acd=await warehouse[_0x62eb2e(0x22b)]([{'$match':{'name':_0x449c2e['warehouse_name'],'room':_0x449c2e[_0x62eb2e(0x204)]}},{'$unwind':_0x62eb2e(0x22e)},{'$group':{'_id':_0x62eb2e(0x227),'name':{'$first':_0x62eb2e(0x1ca)},'product_stock':{'$first':_0x62eb2e(0x1f5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x62eb2e(0x1b7)},'type':{'$first':_0x62eb2e(0x1de)},'floorlevel':{'$first':_0x62eb2e(0x165)},'primary_code':{'$first':_0x62eb2e(0x16c)},'secondary_code':{'$first':_0x62eb2e(0x22a)},'product_code':{'$first':_0x62eb2e(0x205)},'storage':{'$first':_0x62eb2e(0x19f)},'rack':{'$first':_0x62eb2e(0x229)}}}]);if(_0x53b61e[0x0][_0x62eb2e(0x223)]=='English\x20(US)'){var _0x15e8c5=users[_0x62eb2e(0x20a)];console[_0x62eb2e(0x192)](_0x15e8c5);}else{if(_0x53b61e[0x0]['language']=='Hindi')var _0x15e8c5=users[_0x62eb2e(0x1e5)];else{if(_0x53b61e[0x0][_0x62eb2e(0x223)]=='German')var _0x15e8c5=users[_0x62eb2e(0x211)];else{if(_0x53b61e[0x0][_0x62eb2e(0x223)]=='Spanish')var _0x15e8c5=users[_0x62eb2e(0x196)];else{if(_0x53b61e[0x0][_0x62eb2e(0x223)]==_0x62eb2e(0x1fb))var _0x15e8c5=users[_0x62eb2e(0x1fb)];else{if(_0x53b61e[0x0]['language']==_0x62eb2e(0x1cd))var _0x15e8c5=users[_0x62eb2e(0x186)];else{if(_0x53b61e[0x0][_0x62eb2e(0x223)]=='Chinese')var _0x15e8c5=users[_0x62eb2e(0x1e0)];else{if(_0x53b61e[0x0][_0x62eb2e(0x223)]=='Arabic\x20(ae)')var _0x15e8c5=users[_0x62eb2e(0x180)];}}}}}}}_0x3d69e8[_0x62eb2e(0x1b3)]('edit_adjustment_finished',{'success':_0x223131[_0x62eb2e(0x1b9)]('success'),'errors':_0x223131[_0x62eb2e(0x1b9)](_0x62eb2e(0x164)),'role':_0x2e2bd3,'profile':_0x4c26f3,'adjustment':_0x449c2e,'stock':_0x9e0acd,'master_shop':_0x53b61e,'warehouse_name':_0x4fa215,'unit':_0x1cfc21,'language':_0x15e8c5,'rooms_data':_0x2a1e88,'ed_fullDate':_0x9c01fe});}catch(_0x29a4fb){console[_0x62eb2e(0x192)](_0x29a4fb),_0x3d69e8[_0x62eb2e(0x1d5)](0xc8)[_0x62eb2e(0x185)]({'message':_0x29a4fb[_0x62eb2e(0x17f)]});}}),router[a0_0x3b8399(0x188)]('/view/:id',auth,async(_0x45a42e,_0x59cd44)=>{var _0x48e6cb=a0_0x3b8399;try{const _0x151a93=_0x45a42e[_0x48e6cb(0x16a)]['id'],_0x3e748b=await adjustment_finished[_0x48e6cb(0x1d9)]({'_id':_0x151a93}),_0x2c82a4=await warehouse[_0x48e6cb(0x202)]({'name':_0x3e748b['warehouse_name'],'room':_0x3e748b['room']}),{warehouse_name:_0x37ac05,date:_0x599c44,prod_name:_0x4a197d,level:_0x348cc3,isle:_0x3e5a09,pallet:_0x5c6f71,stock:_0xbd2754,types:_0x2a0fad,adjust_qty:_0x3928c3,new_adjust_qty:_0x509844,note:_0x3d0b65,Room_name:_0x4db168,invoice:_0x1b9eb6,JO_number:_0x2d4e0c}=_0x45a42e['body'];if(typeof _0x4a197d==_0x48e6cb(0x1fc))var _0x1f122b=[_0x45a42e['body']['prod_name']],_0x469614=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1e1)]],_0x25897a=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1b6)]],_0x5ee4a4=[_0x45a42e['body'][_0x48e6cb(0x1a7)]],_0x34f84d=[_0x45a42e['body'][_0x48e6cb(0x1a2)]],_0x88d23b=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x219)]],_0x51ad69=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1a9)]],_0x418c21=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x21b)]],_0x39c784=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1d1)]],_0x45e1e6=[_0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x199)]],_0x3c206e=[_0x45a42e['body'][_0x48e6cb(0x187)]];else var _0x1f122b=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1e7)]],_0x469614=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1e1)]],_0x25897a=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1b6)]],_0x5ee4a4=[..._0x45a42e[_0x48e6cb(0x221)]['types']],_0x34f84d=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1a2)]],_0x88d23b=[..._0x45a42e[_0x48e6cb(0x221)]['new_adjust_qty']],_0x51ad69=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x1a9)]],_0x418c21=[..._0x45a42e['body']['unit']],_0x39c784=[..._0x45a42e[_0x48e6cb(0x221)]['Secondary_units']],_0x45e1e6=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x199)]],_0x3c206e=[..._0x45a42e[_0x48e6cb(0x221)][_0x48e6cb(0x187)]];const _0x3d494f=_0x1f122b[_0x48e6cb(0x19e)](_0x3442dc=>{return _0x3442dc={'product_name':_0x3442dc};});_0x469614[_0x48e6cb(0x189)]((_0x3d3ec7,_0x207a4c)=>{var _0x370801=_0x48e6cb;_0x3d494f[_0x207a4c][_0x370801(0x1c8)]=_0x3d3ec7;}),_0x25897a['forEach']((_0x4c91ad,_0x27ce00)=>{var _0x431225=_0x48e6cb;_0x3d494f[_0x27ce00][_0x431225(0x1f3)]=_0x4c91ad;}),_0x5ee4a4[_0x48e6cb(0x189)]((_0x155a10,_0x3f200a)=>{var _0x4c28fe=_0x48e6cb;_0x3d494f[_0x3f200a][_0x4c28fe(0x1a7)]=_0x155a10;}),_0x34f84d[_0x48e6cb(0x189)]((_0x334be7,_0x184826)=>{var _0x4d3d4f=_0x48e6cb;_0x3d494f[_0x184826][_0x4d3d4f(0x1a2)]=_0x334be7;}),_0x88d23b['forEach']((_0x3ec68d,_0x365dbe)=>{var _0x365f5b=_0x48e6cb;_0x3d494f[_0x365dbe][_0x365f5b(0x219)]=_0x3ec68d;}),_0x418c21[_0x48e6cb(0x189)]((_0x3ef48b,_0x3c6e8e)=>{var _0x4bc0c5=_0x48e6cb;_0x3d494f[_0x3c6e8e][_0x4bc0c5(0x21b)]=_0x3ef48b;}),_0x39c784['forEach']((_0x1c6d59,_0x120d31)=>{var _0x1a408e=_0x48e6cb;_0x3d494f[_0x120d31][_0x1a408e(0x163)]=_0x1c6d59;}),_0x51ad69[_0x48e6cb(0x189)]((_0x481d26,_0x1a0b7a)=>{var _0x374721=_0x48e6cb;_0x3d494f[_0x1a0b7a][_0x374721(0x1ce)]=_0x481d26;}),_0x45e1e6['forEach']((_0x1b0df7,_0x12a535)=>{var _0x1e37f9=_0x48e6cb;_0x3d494f[_0x12a535][_0x1e37f9(0x199)]=_0x1b0df7;}),_0x3c206e[_0x48e6cb(0x189)]((_0x2427ba,_0x5af442)=>{var _0x3a90af=_0x48e6cb;_0x3d494f[_0x5af442][_0x3a90af(0x187)]=_0x2427ba;});const _0x2d0a78=_0x3d494f[_0x48e6cb(0x1b1)](_0x4ea337=>_0x4ea337[_0x48e6cb(0x1a2)]!=='0'&&_0x4ea337[_0x48e6cb(0x1a2)]!=='');var _0x37c458=0x0;_0x2d0a78[_0x48e6cb(0x189)](_0x1ede53=>{var _0x48d175=_0x48e6cb;console[_0x48d175(0x192)](_0x48d175(0x174),_0x1ede53),parseInt(_0x1ede53['adjust_qty'])<=0x0&&_0x37c458++;});if(_0x37c458!=0x0)return _0x45a42e[_0x48e6cb(0x1b9)](_0x48e6cb(0x164),_0x48e6cb(0x1f6)),_0x59cd44[_0x48e6cb(0x16e)](_0x48e6cb(0x18e));_0x3e748b['warehouse_name']=_0x37ac05,_0x3e748b['date']=_0x599c44,_0x3e748b[_0x48e6cb(0x209)]=_0x2d0a78,_0x3e748b[_0x48e6cb(0x17a)]=_0x3d0b65,_0x3e748b[_0x48e6cb(0x204)]=_0x4db168,_0x3e748b[_0x48e6cb(0x218)]=_0x1b9eb6,_0x3e748b[_0x48e6cb(0x1b2)]=_0x2d4e0c;const _0x37abe4=await _0x3e748b[_0x48e6cb(0x1f1)](),_0x4e61ef=await warehouse[_0x48e6cb(0x202)]({'name':_0x37ac05,'room':_0x4db168});_0x37abe4[_0x48e6cb(0x209)][_0x48e6cb(0x189)](_0x45b229=>{var _0x1fc7a9=_0x48e6cb;const _0x2abfad=_0x4e61ef[_0x1fc7a9(0x181)][_0x1fc7a9(0x19e)](_0x468ca2=>{var _0xe75da3=_0x1fc7a9;_0x45b229['types']==_0xe75da3(0x17c)?_0x468ca2[_0xe75da3(0x1f8)]==_0x45b229['product_name']&&_0x468ca2[_0xe75da3(0x1c8)]==_0x45b229[_0xe75da3(0x1c8)]&&(_0x468ca2[_0xe75da3(0x1ec)]=parseInt(_0x468ca2['product_stock'])-parseInt(_0x45b229[_0xe75da3(0x1a2)])):_0x468ca2[_0xe75da3(0x1f8)]==_0x45b229[_0xe75da3(0x1f8)]&&_0x468ca2[_0xe75da3(0x1c8)]==_0x45b229[_0xe75da3(0x1c8)]&&(_0x468ca2[_0xe75da3(0x1ec)]=parseInt(_0x468ca2[_0xe75da3(0x1ec)])+parseInt(_0x45b229[_0xe75da3(0x1a2)]));});}),await _0x4e61ef[_0x48e6cb(0x1f1)](),_0x45a42e[_0x48e6cb(0x1b9)](_0x48e6cb(0x17b),_0x48e6cb(0x228)),_0x59cd44['redirect'](_0x48e6cb(0x20f));}catch(_0x5640d6){console[_0x48e6cb(0x192)](_0x5640d6);}}),router['post'](a0_0x3b8399(0x215),async(_0x2d40af,_0x5bc1b4)=>{var _0x4687fe=a0_0x3b8399;const {primary_code:_0x1def03,warehouse_data:_0x345387,rooms_data:_0x7e87d5,Roomslist:_0x289057}=_0x2d40af[_0x4687fe(0x221)],_0x46fc4f=_0x289057[_0x4687fe(0x1d3)](','),_0x3b7d54=[];async function _0x10cdfe(_0xe1b9ad){var _0x5f139b=_0x4687fe;const _0x468dd0=await warehouse[_0x5f139b(0x22b)]([{'$match':{'name':_0x345387,'room':_0xe1b9ad}},{'$unwind':_0x5f139b(0x22e)},{'$match':{'product_details.primary_code':_0x1def03}},{'$group':{'_id':_0x5f139b(0x227),'name':{'$first':_0x5f139b(0x1ca)},'product_stock':{'$first':_0x5f139b(0x1f5)},'primary_code':{'$first':_0x5f139b(0x16c)},'secondary_code':{'$first':_0x5f139b(0x22a)},'product_code':{'$first':_0x5f139b(0x205)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x5f139b(0x1b7)},'type':{'$first':_0x5f139b(0x1de)},'pallet':{'$first':_0x5f139b(0x165)},'unit':{'$first':_0x5f139b(0x1fa)},'secondary_unit':{'$first':_0x5f139b(0x1cc)},'storage':{'$first':_0x5f139b(0x19f)},'rack':{'$first':_0x5f139b(0x229)},'expiry_date':{'$first':_0x5f139b(0x222)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x5f139b(0x1db)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x5f139b(0x17e)}}}]),_0x5cebee=await warehouse[_0x5f139b(0x22b)]([{'$match':{'name':_0x345387,'room':_0xe1b9ad}},{'$unwind':_0x5f139b(0x22e)},{'$match':{'product_details.secondary_code':_0x1def03}},{'$group':{'_id':_0x5f139b(0x227),'name':{'$first':_0x5f139b(0x1ca)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x5f139b(0x22a)},'product_code':{'$first':_0x5f139b(0x205)},'level':{'$first':_0x5f139b(0x21e)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x5f139b(0x165)},'unit':{'$first':_0x5f139b(0x1fa)},'secondary_unit':{'$first':_0x5f139b(0x1cc)},'storage':{'$first':_0x5f139b(0x19f)},'rack':{'$first':_0x5f139b(0x229)},'expiry_date':{'$first':_0x5f139b(0x222)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5f139b(0x15f)},'roomNamed':{'$first':_0x5f139b(0x213)},'invoice':{'$first':_0x5f139b(0x17e)}}}]);if(_0x468dd0[_0x5f139b(0x1ad)]>0x0)_0x3b7d54[_0x5f139b(0x1a5)](_0x468dd0);else _0x5cebee[_0x5f139b(0x1ad)]>0x0&&_0x3b7d54[_0x5f139b(0x1a5)](_0x5cebee);}const _0x557477=_0x46fc4f['map'](_0x5881c3=>_0x10cdfe(_0x5881c3));await Promise[_0x4687fe(0x195)](_0x557477),_0x5bc1b4[_0x4687fe(0x185)](_0x3b7d54);}),router[a0_0x3b8399(0x188)](a0_0x3b8399(0x1e6),async(_0x3ea8a3,_0x2a89d9)=>{var _0xab430c=a0_0x3b8399;const {productCode:_0x89124d,bay:_0x340186,warehouses:_0xf12b6a,room:_0x461abf}=_0x3ea8a3['body'];console[_0xab430c(0x192)](_0x3ea8a3['body']);try{const _0x52e326=await warehouse['aggregate']([{'$match':{'name':_0xf12b6a,'room':_0x461abf}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x340186)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0xab430c(0x1ca)},'product_stock':{'$first':_0xab430c(0x1f5)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0xab430c(0x1c1)}}}]);_0x2a89d9[_0xab430c(0x1d5)](0xc8)[_0xab430c(0x185)](_0x52e326);}catch(_0x418419){_0x2a89d9[_0xab430c(0x1d5)](0x194)['json']({'message':_0x418419[_0xab430c(0x17f)]});}}),module[a0_0x3b8399(0x16f)]=router;