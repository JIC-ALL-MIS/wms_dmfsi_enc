var a0_0x269f82=a0_0x111b;(function(_0x1c2949,_0x415e6f){var _0x3852c1=a0_0x111b,_0x5848c2=_0x1c2949();while(!![]){try{var _0x2927e4=parseInt(_0x3852c1(0x1d9))/0x1*(parseInt(_0x3852c1(0x1dc))/0x2)+parseInt(_0x3852c1(0x18f))/0x3+-parseInt(_0x3852c1(0x195))/0x4*(-parseInt(_0x3852c1(0x154))/0x5)+parseInt(_0x3852c1(0x190))/0x6+parseInt(_0x3852c1(0x143))/0x7*(parseInt(_0x3852c1(0x14c))/0x8)+parseInt(_0x3852c1(0x152))/0x9*(parseInt(_0x3852c1(0x159))/0xa)+-parseInt(_0x3852c1(0x202))/0xb;if(_0x2927e4===_0x415e6f)break;else _0x5848c2['push'](_0x5848c2['shift']());}catch(_0x2b4b5d){_0x5848c2['push'](_0x5848c2['shift']());}}}(a0_0x50c2,0xc8ec0));function a0_0x111b(_0x25de45,_0x1158ff){var _0x50c2f2=a0_0x50c2();return a0_0x111b=function(_0x111b2f,_0xa1fa5c){_0x111b2f=_0x111b2f-0x143;var _0x5765b8=_0x50c2f2[_0x111b2f];return _0x5765b8;},a0_0x111b(_0x25de45,_0x1158ff);}const express=require(a0_0x269f82(0x1b4)),app=express(),router=express[a0_0x269f82(0x171)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x269f82(0x186)),users=require(a0_0x269f82(0x201)),nodemailer=require(a0_0x269f82(0x1cb));router[a0_0x269f82(0x168)](a0_0x269f82(0x1de),auth,async(_0x2f073d,_0x39da17)=>{var _0x5ea782=a0_0x269f82;try{const {username:_0x2145b5,email:_0x3498ac,role:_0x53c723}=_0x2f073d[_0x5ea782(0x165)],_0x194650=_0x2f073d[_0x5ea782(0x165)],_0x3676ce=await profile['findOne']({'email':_0x194650[_0x5ea782(0x19c)]}),_0x5b0cc6=await master_shop[_0x5ea782(0x1ba)]();let _0x54df9c;if(_0x194650[_0x5ea782(0x1e5)]=='staff'){const _0xbb15dc=await staff[_0x5ea782(0x16d)]({'email':_0x194650[_0x5ea782(0x19c)]});_0x54df9c=await warehouse[_0x5ea782(0x1ba)]({'status':_0x5ea782(0x200),'name':_0xbb15dc[_0x5ea782(0x1a1)]});}else _0x54df9c=await warehouse[_0x5ea782(0x1ba)]({'status':'Enabled'});const _0x542831=await product[_0x5ea782(0x1ba)]();let _0x2413d4;if(_0x194650[_0x5ea782(0x1e5)]=='staff'){const _0x18ea28=await staff[_0x5ea782(0x16d)]({'email':_0x194650[_0x5ea782(0x19c)]});_0x2413d4=await adjustment_finished[_0x5ea782(0x1ba)]({'warehouse_name':_0x18ea28[_0x5ea782(0x1a1)]});}else _0x2413d4=await adjustment_finished[_0x5ea782(0x18e)]([{'$unwind':_0x5ea782(0x1bf)},{'$group':{'_id':_0x5ea782(0x1d5),'invoice':{'$first':_0x5ea782(0x17c)},'date':{'$first':_0x5ea782(0x1c8)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x5ea782(0x1c0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5b0cc6[0x0][_0x5ea782(0x19a)]==_0x5ea782(0x14b)){var _0x197daa=users[_0x5ea782(0x198)];console[_0x5ea782(0x18d)](_0x197daa);}else{if(_0x5b0cc6[0x0]['language']==_0x5ea782(0x167))var _0x197daa=users[_0x5ea782(0x167)];else{if(_0x5b0cc6[0x0][_0x5ea782(0x19a)]==_0x5ea782(0x1d6))var _0x197daa=users['German'];else{if(_0x5b0cc6[0x0]['language']==_0x5ea782(0x1c5))var _0x197daa=users[_0x5ea782(0x1c5)];else{if(_0x5b0cc6[0x0]['language']==_0x5ea782(0x1f2))var _0x197daa=users[_0x5ea782(0x1f2)];else{if(_0x5b0cc6[0x0][_0x5ea782(0x19a)]==_0x5ea782(0x16c))var _0x197daa=users[_0x5ea782(0x172)];else{if(_0x5b0cc6[0x0][_0x5ea782(0x19a)]==_0x5ea782(0x147))var _0x197daa=users['Chinese'];else{if(_0x5b0cc6[0x0][_0x5ea782(0x19a)]==_0x5ea782(0x153))var _0x197daa=users[_0x5ea782(0x1e4)];}}}}}}}_0x39da17[_0x5ea782(0x16b)](_0x5ea782(0x157),{'success':_0x2f073d[_0x5ea782(0x164)](_0x5ea782(0x1aa)),'errors':_0x2f073d[_0x5ea782(0x164)]('errors'),'role':_0x194650,'profile':_0x3676ce,'warehouse':_0x54df9c,'product':_0x542831,'adjustment':_0x2413d4,'master_shop':_0x5b0cc6,'language':_0x197daa});}catch(_0x365b26){console[_0x5ea782(0x18d)](_0x365b26);}});function a0_0x50c2(){var _0x18b60a=['<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<html><head><title></title>','English','prod_cat','language','$product_details._id','email','$product_details.bay','master','</div>','unit','warehouse','note','</tr>','$product_details.secondary_code','types','site_title','Finished\x20Goods','adjust_qty','prod_name','success','post','minus','</td>','getMonth','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$room','string','QA\x20Warehouse','staff','express','secondary_unit','redirect','/view/add_adjustment','An\x20error\x20occurred.','New_Qty_Converted','find','$product_details.maxPerUnit','room_names','$name','Return\x20Rooms','$product','$finalize','finalize','/adjustment_finished/preview/','/barcode_scanner','$product_details.bin','Spanish','forEach','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$date','$product_details.product_name','expiry_date','nodemailer','$product_details.type','DRY\x20GOODS','product_details','</thead>','/preview/:id','$product_details.production_date','$product_details.batch_code','$product_details.primary_code','date','$_id','German','getDate','True','121468DyleWs','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','map','22jczAxA','$product_details.secondary_unit','/view','back','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','logo','Arabic','role','json','$product_details.product_stock','$product_details.invoice','adjustment\x20add\x20successfull','split','Logo.png','$product_details.expiry_date','message','product_name','getFullYear','<tr>','<h5>','French','<!DOCTYPE\x20html>','new_adjust_qty','push','<span\x20style=\x22float:\x20right;\x22>','$product_details.unit','/CheckingWarehouse','/upload/','password','all','</tbody>','host','filter','batch_code','Enabled','../public/language/languages.json','79528757SUxmtT','</body></html>','Primary_Units','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/view/:id','FGSEmail','ADJF-','102088TLTHta','_id','invoice','<strong>\x20Regards\x20</strong>','Chinese','New_Qty_Converted_adj','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','$product_details.rack','English\x20(US)','632WrbpRu','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','then','Enclosed','<h5\x20style=\x22text-align:\x20left;\x22>','body','2541654HUjtpy','Arabic\x20(ae)','505445VtJrrz','findById','$product_details.floorlevel','adjustment_finished','sendMail','50VvuNmx','$product.product_name','foreach\x20newproduct','prod_code','level','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','production_date','error','length','flash','user','product_stock','Hindi','get','room','save','render','Portuguese\x20(BR)','findOne','/adjustment/view','port','warehouse_name','Router','Portuguese','Adjustment\x20Finalize\x20Successfully','product_date','Adjustment\x20Mail','$product_details.storage','<div>','</head><body>','bay','maxPerUnit','Error\x20Occurs','$invoice','params','An\x20error\x20occurred\x20while\x20saving\x20data.','Ambient','catch','errors','There\x27s\x20a\x20error\x20in\x20this\x20transaction','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','\x20</h2>','../models/all_models','\x20Order\x20Date\x20:\x20','Secondary_units','edit_adjustment_finished','floor','stockBefore','product','log','aggregate','4199754chxuMP','9843912nscPCQ','stock','purchases_data','/adjustment_finished/view','status','44HGBRdO'];a0_0x50c2=function(){return _0x18b60a;};return a0_0x50c2();}async function getRandom8DigitNumber(){var _0x294eeb=a0_0x269f82;const _0x2d111e=0x989680,_0x54e353=0x5f5e0ff,_0x453973=Math[_0x294eeb(0x18a)](Math['random']()*(_0x54e353-_0x2d111e+0x1))+_0x2d111e;var _0x7d2a12;const _0x4c33fd=await adjustment_finished[_0x294eeb(0x16d)]({'invoice':_0x294eeb(0x208)+_0x453973});return _0x4c33fd&&_0x4c33fd[_0x294eeb(0x163)]>0x0?_0x7d2a12='ADJF-'+_0x453973:_0x7d2a12='ADJF-'+_0x453973,_0x7d2a12;}router['get'](a0_0x269f82(0x1b7),auth,async(_0x1d6864,_0x4823d8)=>{var _0x39f88c=a0_0x269f82;try{const {username:_0xf1cdcb,email:_0x493645,role:_0x46fc66}=_0x1d6864[_0x39f88c(0x165)],_0xe40477=_0x1d6864[_0x39f88c(0x165)],_0x461b63=await profile[_0x39f88c(0x16d)]({'email':_0xe40477['email']}),_0x3554e3=await master_shop[_0x39f88c(0x1ba)]();let _0x327a01;if(_0xe40477['role']==_0x39f88c(0x1b3)){const _0x378788=await staff[_0x39f88c(0x16d)]({'email':_0xe40477['email']});_0x327a01=await warehouse['aggregate']([{'$match':{'status':_0x39f88c(0x200),'name':_0x378788['warehouse'],'warehouse_category':_0x39f88c(0x1a7),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x39f88c(0x1bd),'name':{'$first':_0x39f88c(0x1bd)}}}]);}else _0x327a01=await warehouse[_0x39f88c(0x18e)]([{'$match':{'status':_0x39f88c(0x200),'warehouse_category':_0x39f88c(0x1a7),'name':{'$ne':_0x39f88c(0x1b2)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);const _0x58623b=await product['find']({}),_0x2446c4=await adjustment_finished[_0x39f88c(0x1ba)]({}),_0x3fac84=_0x2446c4[_0x39f88c(0x163)]+0x1,_0x4f9ae4=_0x39f88c(0x208)+_0x3fac84['toString']()['padStart'](0x5,'0');var _0x4dce53=[_0x39f88c(0x17f),_0x39f88c(0x14f),_0x39f88c(0x1be)];if(_0x3554e3[0x0][_0x39f88c(0x19a)]==_0x39f88c(0x14b))var _0x4646d7=users[_0x39f88c(0x198)];else{if(_0x3554e3[0x0][_0x39f88c(0x19a)]=='Hindi')var _0x4646d7=users['Hindi'];else{if(_0x3554e3[0x0][_0x39f88c(0x19a)]==_0x39f88c(0x1d6))var _0x4646d7=users[_0x39f88c(0x1d6)];else{if(_0x3554e3[0x0]['language']==_0x39f88c(0x1c5))var _0x4646d7=users['Spanish'];else{if(_0x3554e3[0x0][_0x39f88c(0x19a)]==_0x39f88c(0x1f2))var _0x4646d7=users[_0x39f88c(0x1f2)];else{if(_0x3554e3[0x0][_0x39f88c(0x19a)]=='Portuguese\x20(BR)')var _0x4646d7=users[_0x39f88c(0x172)];else{if(_0x3554e3[0x0][_0x39f88c(0x19a)]=='Chinese')var _0x4646d7=users[_0x39f88c(0x147)];else{if(_0x3554e3[0x0]['language']==_0x39f88c(0x153))var _0x4646d7=users[_0x39f88c(0x1e4)];}}}}}}}const _0x2dc548=getRandom8DigitNumber();_0x2dc548[_0x39f88c(0x14e)](_0x38e7bb=>{var _0x470984=_0x39f88c;_0x4823d8['render']('add_adjustment_finished',{'success':_0x1d6864[_0x470984(0x164)](_0x470984(0x1aa)),'errors':_0x1d6864[_0x470984(0x164)](_0x470984(0x181)),'role':_0xe40477,'profile':_0x461b63,'warehouse':_0x327a01,'product':_0x58623b,'master_shop':_0x3554e3,'language':_0x4646d7,'rooms_data':_0x4dce53,'invoice_no':_0x38e7bb});})['catch'](_0xace43e=>{var _0x4f580d=_0x39f88c;_0x1d6864['flash']('errors',_0x4f580d(0x182)),_0x4823d8[_0x4f580d(0x1b6)](_0x4f580d(0x16e));});}catch(_0x338b78){console[_0x39f88c(0x18d)](_0x338b78);}}),router[a0_0x269f82(0x1ab)](a0_0x269f82(0x1b7),auth,async(_0x287b14,_0x342f82)=>{var _0x479dd1=a0_0x269f82;try{const {warehouse_name:_0x63730c,date:_0x455cd5,prod_name:_0x284c30,level:_0xbf6fe9,isle:_0x42279d,pallet:_0x31d34b,stock:_0x5e0b88,types:_0x2e9b62,adjust_qty:_0x5886f3,new_adjust_qty:_0x171d9b,note:_0x483f8a,Room_name:_0x5d4f88,invoice:_0x1c39d1,JO_number:_0x68a6d4,expiry_date:_0x41c476}=_0x287b14[_0x479dd1(0x151)];if(typeof _0x284c30==_0x479dd1(0x1b1))var _0x3491af=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1a9)]],_0x1ee2e4=[_0x287b14[_0x479dd1(0x151)]['level']],_0x8b4cca=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x191)]],_0x46e439=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1a5)]],_0x1361c8=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x148)]],_0x4e9167=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1b9)]],_0x58d66c=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x204)]],_0x413689=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x188)]],_0x3e7730=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x15c)]],_0x3b1c5e=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1ff)]],_0x39b607=[_0x287b14[_0x479dd1(0x151)]['expiry_date']],_0x313e37=[_0x287b14['body'][_0x479dd1(0x174)]],_0x28c513=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x199)]],_0xc3e6d5=[_0x287b14[_0x479dd1(0x151)]['Rooms']],_0x449ae2=[_0x287b14[_0x479dd1(0x151)][_0x479dd1(0x17a)]],_0x5c18d6=[_0x287b14[_0x479dd1(0x151)]['prod_invoice']];else var _0x3491af=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1a9)]],_0x1ee2e4=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x15d)]],_0x8b4cca=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x191)]],_0x46e439=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1a5)]],_0x1361c8=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x148)]],_0x4e9167=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1b9)]],_0x58d66c=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x204)]],_0x413689=[..._0x287b14[_0x479dd1(0x151)]['Secondary_units']],_0x3e7730=[..._0x287b14[_0x479dd1(0x151)]['prod_code']],_0x3b1c5e=[..._0x287b14[_0x479dd1(0x151)]['batch_code']],_0x39b607=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x1ca)]],_0x313e37=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x174)]],_0x28c513=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x199)]],_0xc3e6d5=[..._0x287b14[_0x479dd1(0x151)]['Rooms']],_0x449ae2=[..._0x287b14[_0x479dd1(0x151)][_0x479dd1(0x17a)]],_0x5c18d6=[..._0x287b14[_0x479dd1(0x151)]['prod_invoice']];const _0x57ff8d=_0x3491af[_0x479dd1(0x1db)](_0x16e3ea=>{return _0x16e3ea={'product_name':_0x16e3ea};});_0x1ee2e4[_0x479dd1(0x1c6)]((_0x2a24bc,_0x3637a0)=>{_0x57ff8d[_0x3637a0]['bay']=_0x2a24bc;}),_0x8b4cca[_0x479dd1(0x1c6)]((_0x6aefe6,_0x300171)=>{var _0x4b1015=_0x479dd1;_0x57ff8d[_0x300171][_0x4b1015(0x18b)]=_0x6aefe6;}),_0x46e439[_0x479dd1(0x1c6)]((_0x3d0497,_0x417e63)=>{var _0x64ce99=_0x479dd1;_0x57ff8d[_0x417e63][_0x64ce99(0x1a5)]=_0x3d0497;}),_0x1361c8[_0x479dd1(0x1c6)]((_0x4bcb67,_0x34e9e7)=>{_0x57ff8d[_0x34e9e7]['adjust_qty']=_0x4bcb67;}),_0x4e9167[_0x479dd1(0x1c6)]((_0x580548,_0x3038a2)=>{_0x57ff8d[_0x3038a2]['new_adjust_qty']=_0x580548;}),_0x58d66c[_0x479dd1(0x1c6)]((_0x47c382,_0x3b6cf9)=>{var _0x15f7b5=_0x479dd1;_0x57ff8d[_0x3b6cf9][_0x15f7b5(0x1a0)]=_0x47c382;}),_0x413689[_0x479dd1(0x1c6)]((_0x112ceb,_0x3071ec)=>{_0x57ff8d[_0x3071ec]['secondary_unit']=_0x112ceb;}),_0x3e7730[_0x479dd1(0x1c6)]((_0x4fed6e,_0x3a10e1)=>{_0x57ff8d[_0x3a10e1]['product_code']=_0x4fed6e;}),_0x3b1c5e[_0x479dd1(0x1c6)]((_0x1a1eef,_0x3b723b)=>{var _0x12f7c1=_0x479dd1;_0x57ff8d[_0x3b723b][_0x12f7c1(0x1ff)]=_0x1a1eef;}),_0x39b607['forEach']((_0x1dfb7e,_0x169cb5)=>{var _0x1c389e=_0x479dd1;_0x57ff8d[_0x169cb5][_0x1c389e(0x1ca)]=_0x1dfb7e;}),_0x313e37[_0x479dd1(0x1c6)]((_0x47880b,_0x1aa117)=>{var _0x591c86=_0x479dd1;_0x57ff8d[_0x1aa117][_0x591c86(0x161)]=_0x47880b;}),_0x28c513[_0x479dd1(0x1c6)]((_0x5b29f5,_0x17764c)=>{_0x57ff8d[_0x17764c]['prod_cat']=_0x5b29f5;}),_0xc3e6d5[_0x479dd1(0x1c6)]((_0x27322d,_0x367c0e)=>{_0x57ff8d[_0x367c0e]['room_names']=_0x27322d;}),_0x449ae2[_0x479dd1(0x1c6)]((_0x583ee5,_0x3893ae)=>{_0x57ff8d[_0x3893ae]['maxPerUnit']=_0x583ee5;}),_0x5c18d6[_0x479dd1(0x1c6)]((_0x2aa1d6,_0x8744bf)=>{var _0x1640ca=_0x479dd1;_0x57ff8d[_0x8744bf][_0x1640ca(0x145)]=_0x2aa1d6;});const _0x3a810b=_0x57ff8d[_0x479dd1(0x1fe)](_0x8caa57=>_0x8caa57['adjust_qty']!=='0'&&_0x8caa57[_0x479dd1(0x1a8)]!=='');var _0x4ee36f=0x0;_0x3a810b['forEach'](_0x5581db=>{var _0x4b8fc4=_0x479dd1;console['log'](_0x4b8fc4(0x15b),_0x5581db),parseInt(_0x5581db[_0x4b8fc4(0x1a8)])<=0x0&&_0x4ee36f++;});if(_0x4ee36f!=0x0)return _0x287b14[_0x479dd1(0x164)]('errors',_0x479dd1(0x14d)),_0x342f82[_0x479dd1(0x1b6)]('back');const _0x4522cf=new adjustment_finished({'warehouse_name':_0x63730c,'date':_0x455cd5,'product':_0x3a810b,'note':_0x483f8a,'room':_0x5d4f88,'invoice':_0x1c39d1,'JO_number':_0x68a6d4,'expiry_date':_0x41c476}),_0x47370f=await _0x4522cf[_0x479dd1(0x16a)]();_0x287b14[_0x479dd1(0x164)](_0x479dd1(0x1aa),_0x479dd1(0x1e9)),_0x342f82[_0x479dd1(0x1b6)](_0x479dd1(0x1c2)+_0x47370f[_0x479dd1(0x144)]);}catch(_0x3aaafd){console[_0x479dd1(0x18d)](_0x3aaafd),_0x342f82[_0x479dd1(0x194)](0xc8)[_0x479dd1(0x1e6)]({'message':_0x3aaafd[_0x479dd1(0x1ed)]});}}),router['get'](a0_0x269f82(0x1d0),auth,async(_0x1b3607,_0x351c38)=>{var _0x4f90cb=a0_0x269f82;try{const {username:_0x489de8,email:_0x59ddf1,role:_0x35fc40}=_0x1b3607[_0x4f90cb(0x165)],_0x5980c8=_0x1b3607['user'],_0x17aeb2=await profile[_0x4f90cb(0x16d)]({'email':_0x5980c8[_0x4f90cb(0x19c)]}),_0x1097f6=await master_shop[_0x4f90cb(0x1ba)](),_0x2d21ee=_0x1b3607[_0x4f90cb(0x17d)]['id'],_0x91d88b=await adjustment_finished['findById']({'_id':_0x2d21ee}),_0x3ca65a=await purchases[_0x4f90cb(0x18e)]([{'$match':{'warehouse_name':_0x91d88b['warehouse_name']}},{'$unwind':_0x4f90cb(0x1bf)},{'$group':{'_id':_0x4f90cb(0x15a)}}]);console['log'](_0x4f90cb(0x192),_0x3ca65a);const _0xa7861d=await product['find']({}),_0x64f958=await warehouse[_0x4f90cb(0x18e)]([{'$match':{'name':_0x91d88b[_0x4f90cb(0x170)],'warehouse_category':_0x4f90cb(0x1a7)}},{'$unwind':_0x4f90cb(0x1e1)},{'$group':{'_id':_0x4f90cb(0x19b),'name':{'$first':_0x4f90cb(0x1c9)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x4f90cb(0x19d)},'bin':{'$first':_0x4f90cb(0x1c4)},'type':{'$first':_0x4f90cb(0x1cc)},'floorlevel':{'$first':_0x4f90cb(0x156)},'primary_code':{'$first':_0x4f90cb(0x1d3)},'secondary_code':{'$first':_0x4f90cb(0x1a4)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x4f90cb(0x176)},'rack':{'$first':_0x4f90cb(0x14a)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x4f90cb(0x1d2)},'maxPerUnit':{'$first':_0x4f90cb(0x1bb)},'room':{'$first':_0x4f90cb(0x1b0)}}}]);if(_0x1097f6[0x0][_0x4f90cb(0x19a)]=='English\x20(US)'){var _0x32dd7a=users[_0x4f90cb(0x198)];console[_0x4f90cb(0x18d)](_0x32dd7a);}else{if(_0x1097f6[0x0][_0x4f90cb(0x19a)]==_0x4f90cb(0x167))var _0x32dd7a=users[_0x4f90cb(0x167)];else{if(_0x1097f6[0x0]['language']=='German')var _0x32dd7a=users[_0x4f90cb(0x1d6)];else{if(_0x1097f6[0x0][_0x4f90cb(0x19a)]==_0x4f90cb(0x1c5))var _0x32dd7a=users[_0x4f90cb(0x1c5)];else{if(_0x1097f6[0x0][_0x4f90cb(0x19a)]==_0x4f90cb(0x1f2))var _0x32dd7a=users[_0x4f90cb(0x1f2)];else{if(_0x1097f6[0x0][_0x4f90cb(0x19a)]==_0x4f90cb(0x16c))var _0x32dd7a=users[_0x4f90cb(0x172)];else{if(_0x1097f6[0x0][_0x4f90cb(0x19a)]==_0x4f90cb(0x147))var _0x32dd7a=users[_0x4f90cb(0x147)];else{if(_0x1097f6[0x0][_0x4f90cb(0x19a)]=='Arabic\x20(ae)')var _0x32dd7a=users[_0x4f90cb(0x1e4)];}}}}}}}_0x351c38[_0x4f90cb(0x16b)]('edit_adjustment_finished_view',{'success':_0x1b3607[_0x4f90cb(0x164)](_0x4f90cb(0x1aa)),'errors':_0x1b3607[_0x4f90cb(0x164)](_0x4f90cb(0x181)),'role':_0x5980c8,'profile':_0x17aeb2,'adjustment':_0x91d88b,'stock':_0x64f958,'master_shop':_0x1097f6,'warehouse_name':_0x3ca65a,'unit':_0xa7861d,'language':_0x32dd7a});}catch(_0x398e16){console[_0x4f90cb(0x18d)](_0x398e16),_0x351c38[_0x4f90cb(0x194)](0xc8)[_0x4f90cb(0x1e6)]({'message':_0x398e16[_0x4f90cb(0x1ed)]});}}),router[a0_0x269f82(0x1ab)](a0_0x269f82(0x1d0),auth,async(_0x46da01,_0x34cf55)=>{var _0x4b2e8a=a0_0x269f82;try{const {invoice:_0x45d051,warehouse_name:_0x582355,Room_name:_0x44b9c4}=_0x46da01[_0x4b2e8a(0x151)],_0x3ed242=_0x46da01[_0x4b2e8a(0x17d)]['id'],_0x4f41cd=await adjustment_finished[_0x4b2e8a(0x155)]({'_id':_0x3ed242});var _0x54d76f;const _0x349e32=_0x4f41cd[_0x4b2e8a(0x18c)][_0x4b2e8a(0x1db)](async _0x52abfe=>{var _0x48b7c6=_0x4b2e8a;if(_0x52abfe[_0x48b7c6(0x1a8)]>0x0){_0x54d76f=await warehouse[_0x48b7c6(0x16d)]({'name':_0x582355,'room':_0x52abfe[_0x48b7c6(0x1bc)],'warehouse_category':_0x48b7c6(0x1a7)});const _0x390463=_0x54d76f[_0x48b7c6(0x1ce)][_0x48b7c6(0x1db)](_0x5041b6=>{var _0x1cbcfa=_0x48b7c6;console[_0x1cbcfa(0x18d)](_0x52abfe['types']);if(_0x52abfe[_0x1cbcfa(0x1a5)]==_0x1cbcfa(0x1ac))_0x5041b6['product_name']==_0x52abfe[_0x1cbcfa(0x1ee)]&&_0x5041b6[_0x1cbcfa(0x179)]==_0x52abfe[_0x1cbcfa(0x179)]&&_0x5041b6[_0x1cbcfa(0x1ca)]==_0x52abfe[_0x1cbcfa(0x1ca)]&&_0x5041b6[_0x1cbcfa(0x161)]==_0x52abfe['production_date']&&_0x5041b6[_0x1cbcfa(0x1ff)]==_0x52abfe['batch_code']&&_0x5041b6[_0x1cbcfa(0x145)]==_0x52abfe[_0x1cbcfa(0x145)]&&(_0x5041b6['product_stock']=_0x5041b6[_0x1cbcfa(0x166)]-_0x52abfe[_0x1cbcfa(0x1a8)]);else _0x52abfe[_0x1cbcfa(0x1a5)]=='add'&&(_0x5041b6[_0x1cbcfa(0x1ee)]==_0x52abfe['product_name']&&_0x5041b6[_0x1cbcfa(0x179)]==_0x52abfe[_0x1cbcfa(0x179)]&&_0x5041b6[_0x1cbcfa(0x1ca)]==_0x52abfe[_0x1cbcfa(0x1ca)]&&_0x5041b6[_0x1cbcfa(0x161)]==_0x52abfe[_0x1cbcfa(0x161)]&&_0x5041b6[_0x1cbcfa(0x1ff)]==_0x52abfe[_0x1cbcfa(0x1ff)]&&_0x5041b6[_0x1cbcfa(0x145)]==_0x52abfe[_0x1cbcfa(0x145)]&&(_0x5041b6[_0x1cbcfa(0x166)]=_0x5041b6[_0x1cbcfa(0x166)]+_0x52abfe[_0x1cbcfa(0x1a8)]));});}return _0x54d76f;});Promise[_0x4b2e8a(0x1fb)](_0x349e32)[_0x4b2e8a(0x14e)](async _0x5d875b=>{var _0x2f1339=_0x4b2e8a;try{for(const _0xfff256 of _0x5d875b){await _0xfff256[_0x2f1339(0x16a)]();}_0x4f41cd[_0x2f1339(0x1c1)]=_0x2f1339(0x1d8);const _0x4c7f19=await _0x4f41cd['save'](),_0x1e339b=await master_shop['find'](),_0x3cb9d7=await email_settings[_0x2f1339(0x16d)](),_0x3a0cdd=await supervisor_settings[_0x2f1339(0x1ba)]();var _0x58a5b8=_0x4f41cd['product'],_0x38497e='',_0x589251;for(_0x589251 in _0x58a5b8){var _0x57acaf='FG';_0x4f41cd[_0x2f1339(0x170)]==_0x2f1339(0x1cd)&&(_0x57acaf='DG'),_0x38497e+=_0x2f1339(0x1f0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x58a5b8[_0x589251][_0x2f1339(0x1ee)]+_0x2f1339(0x1ad)+_0x2f1339(0x160)+_0x58a5b8[_0x589251]['product_code']+_0x2f1339(0x1ad)+_0x2f1339(0x160)+_0x58a5b8[_0x589251]['adjust_qty']+_0x2f1339(0x1ad)+_0x2f1339(0x160)+_0x58a5b8[_0x589251][_0x2f1339(0x1a0)]+'</td>'+_0x2f1339(0x160)+_0x58a5b8[_0x589251][_0x2f1339(0x1b5)]+_0x2f1339(0x1ad)+_0x2f1339(0x160)+_0x4f41cd[_0x2f1339(0x170)]+'</td>'+_0x2f1339(0x160)+_0x58a5b8[_0x589251][_0x2f1339(0x1bc)]+_0x2f1339(0x1ad)+_0x2f1339(0x160)+_0x57acaf+_0x58a5b8[_0x589251][_0x2f1339(0x179)]+_0x2f1339(0x1ad)+_0x2f1339(0x1a3);}let _0x5f1725=nodemailer['createTransport']({'host':_0x3cb9d7[_0x2f1339(0x1fd)],'port':Number(_0x3cb9d7[_0x2f1339(0x16f)]),'secure':![],'auth':{'user':_0x3cb9d7['email'],'pass':_0x3cb9d7[_0x2f1339(0x1fa)]}}),_0x2b680b={'from':_0x3cb9d7['email'],'to':_0x3a0cdd[0x0][_0x2f1339(0x207)],'subject':_0x2f1339(0x175),'attachments':[{'filename':_0x2f1339(0x1eb),'path':__dirname+'/../public'+_0x2f1339(0x1f9)+_0x1e339b[0x0][_0x2f1339(0x15e)],'cid':_0x2f1339(0x1e3)}],'html':_0x2f1339(0x1f3)+_0x2f1339(0x197)+_0x2f1339(0x178)+'<div>'+_0x2f1339(0x1e2)+'<div>'+_0x2f1339(0x1c7)+'</div>'+'<div>'+'<h2>\x20'+_0x1e339b[0x0][_0x2f1339(0x1a6)]+_0x2f1339(0x185)+_0x2f1339(0x19f)+_0x2f1339(0x19f)+'<hr\x20class=\x22my-3\x22>'+_0x2f1339(0x177)+_0x2f1339(0x150)+'\x20Order\x20Number\x20:\x20'+_0x4f41cd[_0x2f1339(0x145)]+'\x20'+_0x2f1339(0x1f6)+_0x2f1339(0x187)+_0x4f41cd['date']+'\x20'+'</span>'+'</h5>'+_0x2f1339(0x19f)+_0x2f1339(0x1e0)+_0x2f1339(0x183)+'<tr>'+_0x2f1339(0x196)+_0x2f1339(0x1af)+_0x2f1339(0x205)+_0x2f1339(0x1da)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x2f1339(0x149)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x2f1339(0x15f)+'</tr>'+_0x2f1339(0x1cf)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x38497e+'\x20'+_0x2f1339(0x1fc)+'</table>'+_0x2f1339(0x177)+_0x2f1339(0x146)+_0x2f1339(0x1f1)+_0x1e339b[0x0][_0x2f1339(0x1a6)]+'</h5>'+_0x2f1339(0x19f)+'</div>'+_0x2f1339(0x203)};_0x5f1725[_0x2f1339(0x158)](_0x2b680b,function(_0x3d8a14,_0x199745){var _0x2cfe99=_0x2f1339;_0x3d8a14?(console[_0x2cfe99(0x18d)](_0x3d8a14),console[_0x2cfe99(0x18d)](_0x2cfe99(0x17b))):console[_0x2cfe99(0x18d)](_0x2cfe99(0x184));}),_0x46da01['flash'](_0x2f1339(0x1aa),_0x2f1339(0x173)),_0x34cf55[_0x2f1339(0x1b6)]('/picking_list/PDF_adjustment/'+_0x4c7f19[_0x2f1339(0x144)]);}catch(_0x5d6d25){console[_0x2f1339(0x162)](_0x5d6d25),_0x34cf55[_0x2f1339(0x194)](0x1f4)[_0x2f1339(0x1e6)]({'error':_0x2f1339(0x17e)});}})[_0x4b2e8a(0x180)](_0x38aeca=>{var _0x2524dc=_0x4b2e8a;console['error'](_0x38aeca),_0x34cf55[_0x2524dc(0x194)](0x1f4)[_0x2524dc(0x1e6)]({'error':_0x2524dc(0x1b8)});});}catch(_0x480362){_0x34cf55[_0x4b2e8a(0x1e6)]({'message':_0x480362[_0x4b2e8a(0x1ed)]});}}),router[a0_0x269f82(0x168)](a0_0x269f82(0x206),auth,async(_0x5fee4b,_0x2c4558)=>{var _0x21dbf7=a0_0x269f82;try{const {username:_0x54aa2e,email:_0x34aef5,role:_0x46e870}=_0x5fee4b[_0x21dbf7(0x165)],_0x113b0e=_0x5fee4b['user'],_0x2c4525=await profile[_0x21dbf7(0x16d)]({'email':_0x113b0e[_0x21dbf7(0x19c)]}),_0x4d78b7=await master_shop[_0x21dbf7(0x1ba)]();console[_0x21dbf7(0x18d)](_0x21dbf7(0x19e),_0x4d78b7);const _0x5e3e85=_0x5fee4b[_0x21dbf7(0x17d)]['id'],_0x12cd71=await adjustment_finished[_0x21dbf7(0x155)]({'_id':_0x5e3e85});let _0x132afa=new Date(_0x12cd71[_0x21dbf7(0x1ca)]),_0x257ac9=('0'+_0x132afa[_0x21dbf7(0x1d7)]())['slice'](-0x2),_0x18befa=('0'+(_0x132afa[_0x21dbf7(0x1ae)]()+0x1))['slice'](-0x2),_0x104358=_0x132afa[_0x21dbf7(0x1ef)](),_0x364e21=_0x104358+'-'+_0x18befa+'-'+_0x257ac9;var _0x1f797c=[_0x21dbf7(0x17f),_0x21dbf7(0x14f),'Return\x20Rooms'];const _0x2ad9b8=await purchases[_0x21dbf7(0x18e)]([{'$match':{'warehouse_name':_0x12cd71[_0x21dbf7(0x170)]}},{'$unwind':'$product'},{'$group':{'_id':_0x21dbf7(0x15a)}}]);console[_0x21dbf7(0x18d)](_0x21dbf7(0x192),_0x2ad9b8);const _0x420de3=await product[_0x21dbf7(0x1ba)]({}),_0x5a011a=await warehouse[_0x21dbf7(0x18e)]([{'$match':{'name':_0x12cd71[_0x21dbf7(0x170)],'room':_0x12cd71['room']}},{'$unwind':_0x21dbf7(0x1e1)},{'$group':{'_id':_0x21dbf7(0x19b),'name':{'$first':_0x21dbf7(0x1c9)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x21dbf7(0x1c4)},'type':{'$first':_0x21dbf7(0x1cc)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x21dbf7(0x1d3)},'secondary_code':{'$first':_0x21dbf7(0x1a4)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x21dbf7(0x176)},'rack':{'$first':_0x21dbf7(0x14a)}}}]);if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]==_0x21dbf7(0x14b)){var _0x3a163d=users[_0x21dbf7(0x198)];console[_0x21dbf7(0x18d)](_0x3a163d);}else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]==_0x21dbf7(0x167))var _0x3a163d=users[_0x21dbf7(0x167)];else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]==_0x21dbf7(0x1d6))var _0x3a163d=users[_0x21dbf7(0x1d6)];else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]==_0x21dbf7(0x1c5))var _0x3a163d=users[_0x21dbf7(0x1c5)];else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]==_0x21dbf7(0x1f2))var _0x3a163d=users[_0x21dbf7(0x1f2)];else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]=='Portuguese\x20(BR)')var _0x3a163d=users[_0x21dbf7(0x172)];else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]==_0x21dbf7(0x147))var _0x3a163d=users[_0x21dbf7(0x147)];else{if(_0x4d78b7[0x0][_0x21dbf7(0x19a)]=='Arabic\x20(ae)')var _0x3a163d=users['Arabic'];}}}}}}}_0x2c4558[_0x21dbf7(0x16b)](_0x21dbf7(0x189),{'success':_0x5fee4b[_0x21dbf7(0x164)](_0x21dbf7(0x1aa)),'errors':_0x5fee4b[_0x21dbf7(0x164)](_0x21dbf7(0x181)),'role':_0x113b0e,'profile':_0x2c4525,'adjustment':_0x12cd71,'stock':_0x5a011a,'master_shop':_0x4d78b7,'warehouse_name':_0x2ad9b8,'unit':_0x420de3,'language':_0x3a163d,'rooms_data':_0x1f797c,'ed_fullDate':_0x364e21});}catch(_0x10d60f){console[_0x21dbf7(0x18d)](_0x10d60f),_0x2c4558['status'](0xc8)['json']({'message':_0x10d60f[_0x21dbf7(0x1ed)]});}}),router[a0_0x269f82(0x1ab)](a0_0x269f82(0x206),auth,async(_0x25823d,_0x5db1a7)=>{var _0x38d159=a0_0x269f82;try{const _0x299899=_0x25823d['params']['id'],_0x5a1f44=await adjustment_finished[_0x38d159(0x155)]({'_id':_0x299899}),_0x395c63=await warehouse[_0x38d159(0x16d)]({'name':_0x5a1f44[_0x38d159(0x170)],'room':_0x5a1f44[_0x38d159(0x169)]}),{warehouse_name:_0x2cd27c,date:_0x592203,prod_name:_0x46ab0d,level:_0x1c9c76,isle:_0x4efa9e,pallet:_0x52d501,stock:_0x2ee0c7,types:_0x5092f2,adjust_qty:_0x330d21,new_adjust_qty:_0x35ac9c,note:_0x484892,Room_name:_0x1fb80b,invoice:_0x5ca369,JO_number:_0x526cf3}=_0x25823d['body'];if(typeof _0x46ab0d==_0x38d159(0x1b1))var _0xda0582=[_0x25823d[_0x38d159(0x151)][_0x38d159(0x1a9)]],_0x18b619=[_0x25823d['body']['level']],_0x501fb1=[_0x25823d[_0x38d159(0x151)]['stock']],_0x17b93b=[_0x25823d['body']['types']],_0x3781ad=[_0x25823d[_0x38d159(0x151)]['adjust_qty']],_0x499e0e=[_0x25823d[_0x38d159(0x151)][_0x38d159(0x1f4)]],_0x2c61d2=[_0x25823d[_0x38d159(0x151)][_0x38d159(0x15c)]],_0x53fd10=[_0x25823d['body']['unit']],_0x26749c=[_0x25823d['body']['Secondary_units']],_0x1ffebb=[_0x25823d[_0x38d159(0x151)][_0x38d159(0x1ff)]],_0x5872b5=[_0x25823d['body']['expiry_date']];else var _0xda0582=[..._0x25823d[_0x38d159(0x151)][_0x38d159(0x1a9)]],_0x18b619=[..._0x25823d['body']['level']],_0x501fb1=[..._0x25823d['body'][_0x38d159(0x191)]],_0x17b93b=[..._0x25823d[_0x38d159(0x151)]['types']],_0x3781ad=[..._0x25823d['body'][_0x38d159(0x1a8)]],_0x499e0e=[..._0x25823d['body'][_0x38d159(0x1f4)]],_0x2c61d2=[..._0x25823d[_0x38d159(0x151)][_0x38d159(0x15c)]],_0x53fd10=[..._0x25823d[_0x38d159(0x151)][_0x38d159(0x1a0)]],_0x26749c=[..._0x25823d['body'][_0x38d159(0x188)]],_0x1ffebb=[..._0x25823d[_0x38d159(0x151)][_0x38d159(0x1ff)]],_0x5872b5=[..._0x25823d[_0x38d159(0x151)]['expiry_date']];const _0x45f358=_0xda0582[_0x38d159(0x1db)](_0x11142a=>{return _0x11142a={'product_name':_0x11142a};});_0x18b619[_0x38d159(0x1c6)]((_0x43ef14,_0x5dbf92)=>{_0x45f358[_0x5dbf92]['bay']=_0x43ef14;}),_0x501fb1['forEach']((_0x46580c,_0x19c997)=>{var _0x35d000=_0x38d159;_0x45f358[_0x19c997][_0x35d000(0x18b)]=_0x46580c;}),_0x17b93b[_0x38d159(0x1c6)]((_0x58a50d,_0xbe8c27)=>{_0x45f358[_0xbe8c27]['types']=_0x58a50d;}),_0x3781ad[_0x38d159(0x1c6)]((_0xf2ef5a,_0x3df13f)=>{var _0x29fdec=_0x38d159;_0x45f358[_0x3df13f][_0x29fdec(0x1a8)]=_0xf2ef5a;}),_0x499e0e[_0x38d159(0x1c6)]((_0x52279c,_0x5c24db)=>{var _0x6431=_0x38d159;_0x45f358[_0x5c24db][_0x6431(0x1f4)]=_0x52279c;}),_0x53fd10[_0x38d159(0x1c6)]((_0x1bbc54,_0x1a9c19)=>{var _0x3d6edd=_0x38d159;_0x45f358[_0x1a9c19][_0x3d6edd(0x1a0)]=_0x1bbc54;}),_0x26749c[_0x38d159(0x1c6)]((_0x523b1b,_0x6ca08b)=>{var _0x10d98c=_0x38d159;_0x45f358[_0x6ca08b][_0x10d98c(0x1b5)]=_0x523b1b;}),_0x2c61d2[_0x38d159(0x1c6)]((_0x1931d0,_0x4ac237)=>{_0x45f358[_0x4ac237]['product_code']=_0x1931d0;}),_0x1ffebb[_0x38d159(0x1c6)]((_0x1c53bc,_0x52b245)=>{_0x45f358[_0x52b245]['batch_code']=_0x1c53bc;}),_0x5872b5[_0x38d159(0x1c6)]((_0x3cefd8,_0x278cbd)=>{_0x45f358[_0x278cbd]['expiry_date']=_0x3cefd8;});const _0x4418a6=_0x45f358[_0x38d159(0x1fe)](_0x4bef4e=>_0x4bef4e[_0x38d159(0x1a8)]!=='0'&&_0x4bef4e[_0x38d159(0x1a8)]!=='');var _0x271f5d=0x0;_0x4418a6[_0x38d159(0x1c6)](_0x363506=>{var _0x442a7f=_0x38d159;console[_0x442a7f(0x18d)]('foreach\x20newproduct',_0x363506),parseInt(_0x363506['adjust_qty'])<=0x0&&_0x271f5d++;});if(_0x271f5d!=0x0)return _0x25823d['flash'](_0x38d159(0x181),_0x38d159(0x14d)),_0x5db1a7[_0x38d159(0x1b6)](_0x38d159(0x1df));_0x5a1f44[_0x38d159(0x170)]=_0x2cd27c,_0x5a1f44[_0x38d159(0x1d4)]=_0x592203,_0x5a1f44[_0x38d159(0x18c)]=_0x4418a6,_0x5a1f44[_0x38d159(0x1a2)]=_0x484892,_0x5a1f44['room']=_0x1fb80b,_0x5a1f44[_0x38d159(0x145)]=_0x5ca369,_0x5a1f44['JO_number']=_0x526cf3;const _0x4d2d4f=await _0x5a1f44[_0x38d159(0x16a)](),_0x5f0dd8=await warehouse['findOne']({'name':_0x2cd27c,'room':_0x1fb80b});_0x4d2d4f[_0x38d159(0x18c)][_0x38d159(0x1c6)](_0x498e68=>{var _0x443715=_0x38d159;const _0x35741e=_0x5f0dd8[_0x443715(0x1ce)][_0x443715(0x1db)](_0x2a6856=>{var _0x323083=_0x443715;_0x498e68[_0x323083(0x1a5)]==_0x323083(0x1ac)?_0x2a6856[_0x323083(0x1ee)]==_0x498e68['product_name']&&_0x2a6856[_0x323083(0x179)]==_0x498e68['bay']&&(_0x2a6856['product_stock']=parseInt(_0x2a6856[_0x323083(0x166)])-parseInt(_0x498e68[_0x323083(0x1a8)])):_0x2a6856[_0x323083(0x1ee)]==_0x498e68[_0x323083(0x1ee)]&&_0x2a6856[_0x323083(0x179)]==_0x498e68[_0x323083(0x179)]&&(_0x2a6856[_0x323083(0x166)]=parseInt(_0x2a6856[_0x323083(0x166)])+parseInt(_0x498e68['adjust_qty']));});}),await _0x5f0dd8[_0x38d159(0x16a)](),_0x25823d[_0x38d159(0x164)](_0x38d159(0x1aa),'adjustment\x20data\x20update\x20successfully'),_0x5db1a7[_0x38d159(0x1b6)](_0x38d159(0x193));}catch(_0x3f195a){console[_0x38d159(0x18d)](_0x3f195a);}}),router[a0_0x269f82(0x1ab)](a0_0x269f82(0x1c3),async(_0x23cd98,_0x15609b)=>{var _0x334523=a0_0x269f82;const {primary_code:_0x38d94c,warehouse_data:_0x59f8e1,rooms_data:_0x215aa7,Roomslist:_0xb0be95}=_0x23cd98['body'],_0x1662b2=_0xb0be95[_0x334523(0x1ea)](','),_0x11471d=[];async function _0x50819a(_0x824ff9){var _0x5d8e74=_0x334523;const _0x5b5e88=await warehouse[_0x5d8e74(0x18e)]([{'$match':{'name':_0x59f8e1,'room':_0x824ff9}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x38d94c}},{'$group':{'_id':_0x5d8e74(0x19b),'name':{'$first':_0x5d8e74(0x1c9)},'product_stock':{'$first':_0x5d8e74(0x1e7)},'primary_code':{'$first':_0x5d8e74(0x1d3)},'secondary_code':{'$first':_0x5d8e74(0x1a4)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x5d8e74(0x19d)},'isle':{'$first':_0x5d8e74(0x1c4)},'type':{'$first':_0x5d8e74(0x1cc)},'pallet':{'$first':_0x5d8e74(0x156)},'unit':{'$first':_0x5d8e74(0x1f7)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x5d8e74(0x176)},'rack':{'$first':_0x5d8e74(0x14a)},'expiry_date':{'$first':_0x5d8e74(0x1ec)},'production_date':{'$first':_0x5d8e74(0x1d1)},'batch_code':{'$first':_0x5d8e74(0x1d2)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x5d8e74(0x1bb)},'roomNamed':{'$first':_0x5d8e74(0x1b0)},'invoice':{'$first':_0x5d8e74(0x1e8)}}}]),_0x14f7cf=await warehouse[_0x5d8e74(0x18e)]([{'$match':{'name':_0x59f8e1,'room':_0x824ff9}},{'$unwind':_0x5d8e74(0x1e1)},{'$match':{'product_details.secondary_code':_0x38d94c}},{'$group':{'_id':_0x5d8e74(0x19b),'name':{'$first':_0x5d8e74(0x1c9)},'product_stock':{'$first':_0x5d8e74(0x1e7)},'primary_code':{'$first':_0x5d8e74(0x1d3)},'secondary_code':{'$first':_0x5d8e74(0x1a4)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x5d8e74(0x1cc)},'pallet':{'$first':_0x5d8e74(0x156)},'unit':{'$first':_0x5d8e74(0x1f7)},'secondary_unit':{'$first':_0x5d8e74(0x1dd)},'storage':{'$first':_0x5d8e74(0x176)},'rack':{'$first':_0x5d8e74(0x14a)},'expiry_date':{'$first':_0x5d8e74(0x1ec)},'production_date':{'$first':_0x5d8e74(0x1d1)},'batch_code':{'$first':_0x5d8e74(0x1d2)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x5d8e74(0x1bb)},'roomNamed':{'$first':_0x5d8e74(0x1b0)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x5b5e88[_0x5d8e74(0x163)]>0x0)_0x11471d[_0x5d8e74(0x1f5)](_0x5b5e88);else _0x14f7cf[_0x5d8e74(0x163)]>0x0&&_0x11471d[_0x5d8e74(0x1f5)](_0x14f7cf);}const _0x50be17=_0x1662b2[_0x334523(0x1db)](_0x2d5131=>_0x50819a(_0x2d5131));await Promise[_0x334523(0x1fb)](_0x50be17),_0x15609b[_0x334523(0x1e6)](_0x11471d);}),router[a0_0x269f82(0x1ab)](a0_0x269f82(0x1f8),async(_0xdb728b,_0xeb5a68)=>{var _0x56e553=a0_0x269f82;const {productCode:_0x40b26d,bay:_0x100c44,warehouses:_0x45e043,room:_0x2234c3}=_0xdb728b[_0x56e553(0x151)];console[_0x56e553(0x18d)](_0xdb728b[_0x56e553(0x151)]);try{const _0x38c7e0=await warehouse[_0x56e553(0x18e)]([{'$match':{'name':_0x45e043,'room':_0x2234c3}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x100c44)}},{'$group':{'_id':_0x56e553(0x19b),'name':{'$first':_0x56e553(0x1c9)},'product_stock':{'$first':_0x56e553(0x1e7)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xeb5a68[_0x56e553(0x194)](0xc8)[_0x56e553(0x1e6)](_0x38c7e0);}catch(_0xc42df5){_0xeb5a68[_0x56e553(0x194)](0x194)[_0x56e553(0x1e6)]({'message':_0xc42df5[_0x56e553(0x1ed)]});}}),module['exports']=router;