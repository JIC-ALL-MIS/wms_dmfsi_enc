var a0_0x2293f1=a0_0x331e;(function(_0x1eacfe,_0x1f456e){var _0x2ff336=a0_0x331e,_0x22ca6c=_0x1eacfe();while(!![]){try{var _0x9a6774=-parseInt(_0x2ff336(0x8f))/0x1*(parseInt(_0x2ff336(0xf0))/0x2)+parseInt(_0x2ff336(0xbd))/0x3+-parseInt(_0x2ff336(0x99))/0x4+-parseInt(_0x2ff336(0xd4))/0x5*(-parseInt(_0x2ff336(0x13b))/0x6)+parseInt(_0x2ff336(0x108))/0x7*(parseInt(_0x2ff336(0xce))/0x8)+-parseInt(_0x2ff336(0x112))/0x9*(parseInt(_0x2ff336(0x81))/0xa)+parseInt(_0x2ff336(0x93))/0xb;if(_0x9a6774===_0x1f456e)break;else _0x22ca6c['push'](_0x22ca6c['shift']());}catch(_0x411db5){_0x22ca6c['push'](_0x22ca6c['shift']());}}}(a0_0x55dc,0x3209c));const express=require(a0_0x2293f1(0x10d)),app=express(),router=express['Router'](),auth=require(a0_0x2293f1(0x97)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x2293f1(0x101)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x2293f1(0x8e));function a0_0x331e(_0x3120d7,_0xc2ef1d){var _0x55dcfc=a0_0x55dc();return a0_0x331e=function(_0x331e85,_0x1b444b){_0x331e85=_0x331e85-0x73;var _0x2367a6=_0x55dcfc[_0x331e85];return _0x2367a6;},a0_0x331e(_0x3120d7,_0xc2ef1d);}router['get'](a0_0x2293f1(0x12b),auth,async(_0x5e9eb9,_0xcc9ab1)=>{var _0x18cdc6=a0_0x2293f1;try{const {username:_0x4457c6,email:_0x1d7983,role:_0x5bf886}=_0x5e9eb9[_0x18cdc6(0xd3)],_0x4519cb=_0x5e9eb9[_0x18cdc6(0xd3)],_0x13b500=await profile[_0x18cdc6(0xba)]({'email':_0x4519cb[_0x18cdc6(0xf3)]}),_0x24c3ee=await master_shop[_0x18cdc6(0x123)]();let _0x439c0e;if(_0x4519cb['role']==_0x18cdc6(0x78)){const _0x11c8ad=await staff[_0x18cdc6(0xba)]({'email':_0x4519cb['email']});_0x439c0e=await warehouse['find']({'status':_0x18cdc6(0xad),'name':_0x11c8ad[_0x18cdc6(0xcc)]});}else _0x439c0e=await warehouse[_0x18cdc6(0x123)]({'status':_0x18cdc6(0xad)});const _0x1f75e1=await product['find']();let _0x201ddb;if(_0x4519cb[_0x18cdc6(0xb0)]==_0x18cdc6(0x78)){const _0x49c48c=await staff[_0x18cdc6(0xba)]({'email':_0x4519cb[_0x18cdc6(0xf3)]});_0x201ddb=await adjustment_finished[_0x18cdc6(0x123)]({'warehouse_name':_0x49c48c[_0x18cdc6(0xcc)]});}else _0x201ddb=await adjustment_finished[_0x18cdc6(0xed)]([{'$unwind':_0x18cdc6(0x7d)},{'$group':{'_id':_0x18cdc6(0xee),'invoice':{'$first':_0x18cdc6(0xe2)},'date':{'$first':_0x18cdc6(0xe7)},'warehouse_name':{'$first':_0x18cdc6(0x85)},'room':{'$addToSet':_0x18cdc6(0x102)},'finalize':{'$first':_0x18cdc6(0x10b)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x24c3ee[0x0][_0x18cdc6(0x73)]==_0x18cdc6(0x115)){var _0x4b7785=users[_0x18cdc6(0x8a)];console[_0x18cdc6(0xd5)](_0x4b7785);}else{if(_0x24c3ee[0x0]['language']=='Hindi')var _0x4b7785=users[_0x18cdc6(0x125)];else{if(_0x24c3ee[0x0]['language']==_0x18cdc6(0x12e))var _0x4b7785=users['German'];else{if(_0x24c3ee[0x0][_0x18cdc6(0x73)]==_0x18cdc6(0xa7))var _0x4b7785=users[_0x18cdc6(0xa7)];else{if(_0x24c3ee[0x0][_0x18cdc6(0x73)]=='French')var _0x4b7785=users[_0x18cdc6(0xfa)];else{if(_0x24c3ee[0x0][_0x18cdc6(0x73)]==_0x18cdc6(0xa5))var _0x4b7785=users[_0x18cdc6(0x11a)];else{if(_0x24c3ee[0x0]['language']==_0x18cdc6(0xb1))var _0x4b7785=users['Chinese'];else{if(_0x24c3ee[0x0]['language']==_0x18cdc6(0x90))var _0x4b7785=users[_0x18cdc6(0x13c)];}}}}}}}_0xcc9ab1[_0x18cdc6(0xf4)]('adjustment_finished',{'success':_0x5e9eb9[_0x18cdc6(0xc7)](_0x18cdc6(0xcf)),'errors':_0x5e9eb9[_0x18cdc6(0xc7)](_0x18cdc6(0xe0)),'role':_0x4519cb,'profile':_0x13b500,'warehouse':_0x439c0e,'product':_0x1f75e1,'adjustment':_0x201ddb,'master_shop':_0x24c3ee,'language':_0x4b7785});}catch(_0x14b068){console['log'](_0x14b068);}});async function getRandom8DigitNumber(){var _0x463869=a0_0x2293f1;const _0x556d63=0x989680,_0x4f897d=0x5f5e0ff,_0x1e1082=Math[_0x463869(0x11e)](Math[_0x463869(0x10a)]()*(_0x4f897d-_0x556d63+0x1))+_0x556d63;var _0x588396;const _0x2bcf86=await adjustment_finished['findOne']({'invoice':'ADJF-'+_0x1e1082});return _0x2bcf86&&_0x2bcf86[_0x463869(0xb9)]>0x0?_0x588396=_0x463869(0x103)+_0x1e1082:_0x588396=_0x463869(0x103)+_0x1e1082,_0x588396;}function a0_0x55dc(){var _0x32d9b7=['<html><head><title></title>','$product_details.batch_code','$product_details.bay','True','finalize','French','add','bay','/barcode_scanner','Secondary_units','_id','prod_code','../models/all_models','$product.room_names','ADJF-','New_Qty_Converted','$product_details.maxProducts','add_adjustment_finished','</tr>','14PysCZb','findById','random','$finalize','/adjustment_finished/preview/','express','<div>','toString','/CheckingWarehouse','$product_details.type','3623553kvOWrL','$product_details.bin','</div>','English\x20(US)','batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','expiry_date','$product_details.floorlevel','Portuguese','$product_details._id','prod_invoice','$product_details.product_code','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.production_date','product_date','An\x20error\x20occurred\x20while\x20saving\x20data.','find','catch','Hindi','/adjustment_finished/view','Primary_Units','getFullYear','New_Qty_Converted_adj','post','/view','product_code','json','German','An\x20error\x20occurred.','$product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','QA\x20Warehouse','get','/adjustment/view','back','maxPerUnit','adjustment\x20add\x20successfull','<h5\x20style=\x22text-align:\x20left;\x22>','sendMail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','2437602lsgohN','Arabic','</head><body>','message','new_adjust_qty','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$room','language','logo','invoice','</h5>','body','staff','secondary_unit','types','$product_details.product_name','prod_name','$product','$product_details.secondary_code','forEach','/view/:id','10iLQHuZ','</td>','unit','$product_details.primary_code','$warehouse_name','$product_details.storage','Ambient','</thead>','password','English','$product_details.secondary_unit','exports','adjustment\x20data\x20update\x20successfully','nodemailer','11801MOqfYy','Arabic\x20(ae)','$product_details.invoice','slice','4067481krirhR','image','<tr>','</body></html>','../middleware/auth','production_date','791580abbeRD','note','filter','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','status','save','date','edit_adjustment_finished','$product_details.product_stock','Return\x20Rooms','stock','Portuguese\x20(BR)','Error\x20Occurs','Spanish','then','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','product_details','adjust_qty','Rooms','Enabled','string','room','role','Chinese','getMonth','/preview/:id','Adjustment\x20Finalize\x20Successfully','$product_details.expiry_date','product_name','\x20Order\x20Date\x20:\x20','product_stock','length','findOne','Enclosed','\x20Order\x20Number\x20:\x20','66972twjdbP','Email\x20sent\x20successfully','edit_adjustment_finished_view','warehouse_name','JO_number','$product_details.unit','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<tbody\x20style=\x22text-align:\x20center;\x22>','flash','all','/view/add_adjustment','There\x27s\x20a\x20error\x20in\x20this\x20transaction','stockBefore','warehouse','Finished\x20Goods','311648CzbcBi','success','redirect','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','foreach\x20newproduct','user','5GpKLIL','log','<h2>\x20','prod_cat','master','host','room_names','map','$product.product_name','<!DOCTYPE\x20html>','push','error','errors','DRY\x20GOODS','$invoice','$name','minus','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.maxPerUnit','$date','$product_details.rack','padStart','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','params','purchases_data','aggregate','$_id','level','12oLNdlz','Logo.png','<hr\x20class=\x22my-3\x22>','email','render'];a0_0x55dc=function(){return _0x32d9b7;};return a0_0x55dc();}router['get']('/view/add_adjustment',auth,async(_0x321e1e,_0x4ed868)=>{var _0x8f95de=a0_0x2293f1;try{const {username:_0x1a2dfa,email:_0x4f0341,role:_0x117bc9}=_0x321e1e[_0x8f95de(0xd3)],_0x93ccdb=_0x321e1e[_0x8f95de(0xd3)],_0x12beee=await profile['findOne']({'email':_0x93ccdb[_0x8f95de(0xf3)]}),_0x4881c0=await master_shop['find']();let _0x137433;if(_0x93ccdb[_0x8f95de(0xb0)]=='staff'){const _0x4f0861=await staff[_0x8f95de(0xba)]({'email':_0x93ccdb[_0x8f95de(0xf3)]});_0x137433=await warehouse['aggregate']([{'$match':{'status':'Enabled','name':_0x4f0861[_0x8f95de(0xcc)],'warehouse_category':_0x8f95de(0xcd),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x8f95de(0xe3),'name':{'$first':_0x8f95de(0xe3)}}}]);}else _0x137433=await warehouse[_0x8f95de(0xed)]([{'$match':{'status':_0x8f95de(0xad),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x8f95de(0x132)}}},{'$group':{'_id':_0x8f95de(0xe3),'name':{'$first':_0x8f95de(0xe3)}}}]);const _0x24a9be=await product[_0x8f95de(0x123)]({}),_0x4a09d4=await adjustment_finished[_0x8f95de(0x123)]({}),_0x2596a7=_0x4a09d4['length']+0x1,_0x2f2e28=_0x8f95de(0x103)+_0x2596a7[_0x8f95de(0x10f)]()[_0x8f95de(0xe9)](0x5,'0');var _0x5d4a80=[_0x8f95de(0x87),_0x8f95de(0xbb),_0x8f95de(0xa3)];if(_0x4881c0[0x0][_0x8f95de(0x73)]=='English\x20(US)')var _0x352c08=users[_0x8f95de(0x8a)];else{if(_0x4881c0[0x0]['language']==_0x8f95de(0x125))var _0x352c08=users[_0x8f95de(0x125)];else{if(_0x4881c0[0x0][_0x8f95de(0x73)]==_0x8f95de(0x12e))var _0x352c08=users['German'];else{if(_0x4881c0[0x0]['language']==_0x8f95de(0xa7))var _0x352c08=users[_0x8f95de(0xa7)];else{if(_0x4881c0[0x0][_0x8f95de(0x73)]=='French')var _0x352c08=users[_0x8f95de(0xfa)];else{if(_0x4881c0[0x0][_0x8f95de(0x73)]==_0x8f95de(0xa5))var _0x352c08=users[_0x8f95de(0x11a)];else{if(_0x4881c0[0x0][_0x8f95de(0x73)]==_0x8f95de(0xb1))var _0x352c08=users[_0x8f95de(0xb1)];else{if(_0x4881c0[0x0][_0x8f95de(0x73)]=='Arabic\x20(ae)')var _0x352c08=users[_0x8f95de(0x13c)];}}}}}}}const _0x47c11e=getRandom8DigitNumber();_0x47c11e[_0x8f95de(0xa8)](_0x47ddf6=>{var _0xd04df=_0x8f95de;_0x4ed868['render'](_0xd04df(0x106),{'success':_0x321e1e['flash']('success'),'errors':_0x321e1e[_0xd04df(0xc7)](_0xd04df(0xe0)),'role':_0x93ccdb,'profile':_0x12beee,'warehouse':_0x137433,'product':_0x24a9be,'master_shop':_0x4881c0,'language':_0x352c08,'rooms_data':_0x5d4a80,'invoice_no':_0x47ddf6});})[_0x8f95de(0x124)](_0x42b8ae=>{var _0x2c1a42=_0x8f95de;_0x321e1e[_0x2c1a42(0xc7)](_0x2c1a42(0xe0),_0x2c1a42(0xca)),_0x4ed868[_0x2c1a42(0xd0)](_0x2c1a42(0x134));});}catch(_0x668ce5){console[_0x8f95de(0xd5)](_0x668ce5);}}),router['post'](a0_0x2293f1(0xc9),auth,async(_0x1737a3,_0x34dc07)=>{var _0x33c215=a0_0x2293f1;try{const {warehouse_name:_0x37e667,date:_0x300d82,prod_name:_0x1b3ee9,level:_0x518cb,isle:_0x26ff0a,pallet:_0x1434bd,stock:_0x362ab8,types:_0x257ef2,adjust_qty:_0x1f5fd7,new_adjust_qty:_0x48cd1f,note:_0x5638db,Room_name:_0x1e2e76,invoice:_0x2db1c4,JO_number:_0x51cc3f,expiry_date:_0x5b02b5}=_0x1737a3[_0x33c215(0x77)];if(typeof _0x1b3ee9=='string')var _0x1b8c84=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0x7c)]],_0x74153c=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0xef)]],_0x28a9ff=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0xa4)]],_0x4ef97e=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0x7a)]],_0x2f1a41=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0x129)]],_0x576a48=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0x104)]],_0x32a0d5=[_0x1737a3['body']['Primary_Units']],_0x1f0e63=[_0x1737a3['body']['Secondary_units']],_0x543f90=[_0x1737a3[_0x33c215(0x77)]['prod_code']],_0x3765be=[_0x1737a3['body'][_0x33c215(0x116)]],_0x555963=[_0x1737a3['body'][_0x33c215(0x118)]],_0x1e3389=[_0x1737a3['body']['product_date']],_0x4fbde6=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0xd7)]],_0x51a1f9=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0xac)]],_0x1a1789=[_0x1737a3['body'][_0x33c215(0x136)]],_0x3932f1=[_0x1737a3[_0x33c215(0x77)][_0x33c215(0x11c)]];else var _0x1b8c84=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0x7c)]],_0x74153c=[..._0x1737a3[_0x33c215(0x77)]['level']],_0x28a9ff=[..._0x1737a3['body'][_0x33c215(0xa4)]],_0x4ef97e=[..._0x1737a3['body']['types']],_0x2f1a41=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0x129)]],_0x576a48=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0x104)]],_0x32a0d5=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0x127)]],_0x1f0e63=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0xfe)]],_0x543f90=[..._0x1737a3['body'][_0x33c215(0x100)]],_0x3765be=[..._0x1737a3['body'][_0x33c215(0x116)]],_0x555963=[..._0x1737a3[_0x33c215(0x77)]['expiry_date']],_0x1e3389=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0x121)]],_0x4fbde6=[..._0x1737a3[_0x33c215(0x77)]['prod_cat']],_0x51a1f9=[..._0x1737a3[_0x33c215(0x77)]['Rooms']],_0x1a1789=[..._0x1737a3['body'][_0x33c215(0x136)]],_0x3932f1=[..._0x1737a3[_0x33c215(0x77)][_0x33c215(0x11c)]];const _0x441f08=_0x1b8c84['map'](_0x2a493c=>{return _0x2a493c={'product_name':_0x2a493c};});_0x74153c[_0x33c215(0x7f)]((_0x251bb8,_0x511b0b)=>{_0x441f08[_0x511b0b]['bay']=_0x251bb8;}),_0x28a9ff[_0x33c215(0x7f)]((_0x5aa622,_0x4a33c9)=>{var _0x2c5ffb=_0x33c215;_0x441f08[_0x4a33c9][_0x2c5ffb(0xcb)]=_0x5aa622;}),_0x4ef97e[_0x33c215(0x7f)]((_0x3a791e,_0x49236c)=>{var _0x28a87e=_0x33c215;_0x441f08[_0x49236c][_0x28a87e(0x7a)]=_0x3a791e;}),_0x2f1a41[_0x33c215(0x7f)]((_0x48f96e,_0x2116db)=>{var _0x271f2a=_0x33c215;_0x441f08[_0x2116db][_0x271f2a(0xab)]=_0x48f96e;}),_0x576a48[_0x33c215(0x7f)]((_0x2006ff,_0x325d16)=>{var _0x5854d1=_0x33c215;_0x441f08[_0x325d16][_0x5854d1(0x13f)]=_0x2006ff;}),_0x32a0d5[_0x33c215(0x7f)]((_0x7a5952,_0x36c125)=>{_0x441f08[_0x36c125]['unit']=_0x7a5952;}),_0x1f0e63['forEach']((_0x3fcae0,_0x8ea392)=>{var _0x4aee0d=_0x33c215;_0x441f08[_0x8ea392][_0x4aee0d(0x79)]=_0x3fcae0;}),_0x543f90[_0x33c215(0x7f)]((_0x476bd0,_0x10407f)=>{_0x441f08[_0x10407f]['product_code']=_0x476bd0;}),_0x3765be['forEach']((_0x9a4acb,_0x37d26f)=>{var _0x28355f=_0x33c215;_0x441f08[_0x37d26f][_0x28355f(0x116)]=_0x9a4acb;}),_0x555963['forEach']((_0x104e56,_0x10c7dc)=>{var _0x1f95b1=_0x33c215;_0x441f08[_0x10c7dc][_0x1f95b1(0x118)]=_0x104e56;}),_0x1e3389[_0x33c215(0x7f)]((_0x588e9d,_0x259ade)=>{_0x441f08[_0x259ade]['production_date']=_0x588e9d;}),_0x4fbde6[_0x33c215(0x7f)]((_0x49270c,_0x1e719d)=>{_0x441f08[_0x1e719d]['prod_cat']=_0x49270c;}),_0x51a1f9[_0x33c215(0x7f)]((_0x3e2e2a,_0x398793)=>{var _0x346397=_0x33c215;_0x441f08[_0x398793][_0x346397(0xda)]=_0x3e2e2a;}),_0x1a1789[_0x33c215(0x7f)]((_0x25cd11,_0x291145)=>{var _0x4992dd=_0x33c215;_0x441f08[_0x291145][_0x4992dd(0x136)]=_0x25cd11;}),_0x3932f1[_0x33c215(0x7f)]((_0x277368,_0x1f9718)=>{var _0x1db163=_0x33c215;_0x441f08[_0x1f9718][_0x1db163(0x75)]=_0x277368;});const _0x46ef7e=_0x441f08[_0x33c215(0x9b)](_0x103ed6=>_0x103ed6[_0x33c215(0xab)]!=='0'&&_0x103ed6[_0x33c215(0xab)]!=='');var _0x2f3d4e=0x0;_0x46ef7e['forEach'](_0x45f40c=>{var _0x3426c3=_0x33c215;console[_0x3426c3(0xd5)]('foreach\x20newproduct',_0x45f40c),parseInt(_0x45f40c[_0x3426c3(0xab)])<=0x0&&_0x2f3d4e++;});if(_0x2f3d4e!=0x0)return _0x1737a3['flash'](_0x33c215(0xe0),_0x33c215(0xea)),_0x34dc07[_0x33c215(0xd0)](_0x33c215(0x135));const _0x2d1796=new adjustment_finished({'warehouse_name':_0x37e667,'date':_0x300d82,'product':_0x46ef7e,'note':_0x5638db,'room':_0x1e2e76,'invoice':_0x2db1c4,'JO_number':_0x51cc3f,'expiry_date':_0x5b02b5}),_0x43f622=await _0x2d1796[_0x33c215(0x9f)]();_0x1737a3[_0x33c215(0xc7)](_0x33c215(0xcf),_0x33c215(0x137)),_0x34dc07['redirect'](_0x33c215(0x10c)+_0x43f622['_id']);}catch(_0x2dcd9c){console[_0x33c215(0xd5)](_0x2dcd9c),_0x34dc07[_0x33c215(0x9e)](0xc8)[_0x33c215(0x12d)]({'message':_0x2dcd9c[_0x33c215(0x13e)]});}}),router[a0_0x2293f1(0x133)](a0_0x2293f1(0xb3),auth,async(_0x4dd0b9,_0x1fc85d)=>{var _0x42051c=a0_0x2293f1;try{const {username:_0x466067,email:_0x3cd5dc,role:_0x43ec96}=_0x4dd0b9[_0x42051c(0xd3)],_0x5d899d=_0x4dd0b9[_0x42051c(0xd3)],_0x5edf5e=await profile['findOne']({'email':_0x5d899d['email']}),_0x165cb1=await master_shop[_0x42051c(0x123)](),_0x336069=_0x4dd0b9[_0x42051c(0xeb)]['id'],_0x1b0f3c=await adjustment_finished['findById']({'_id':_0x336069}),_0x3e1ada=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1b0f3c[_0x42051c(0xc0)]}},{'$unwind':_0x42051c(0x7d)},{'$group':{'_id':_0x42051c(0xdc)}}]);console['log'](_0x42051c(0xec),_0x3e1ada);const _0x56e1dc=await product[_0x42051c(0x123)]({}),_0x11cdd9=await warehouse[_0x42051c(0xed)]([{'$match':{'name':_0x1b0f3c[_0x42051c(0xc0)],'warehouse_category':_0x42051c(0xcd)}},{'$unwind':_0x42051c(0x130)},{'$group':{'_id':_0x42051c(0x11b),'name':{'$first':_0x42051c(0x7b)},'product_stock':{'$first':_0x42051c(0xa2)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x42051c(0x113)},'type':{'$first':_0x42051c(0x111)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x42051c(0x84)},'secondary_code':{'$first':_0x42051c(0x7e)},'product_code':{'$first':_0x42051c(0x11d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x42051c(0xb5)},'production_date':{'$first':_0x42051c(0x120)},'batch_code':{'$first':_0x42051c(0xf6)},'maxPerUnit':{'$first':_0x42051c(0xe6)},'room':{'$first':_0x42051c(0x141)}}}]);if(_0x165cb1[0x0]['language']==_0x42051c(0x115)){var _0x459993=users['English'];console[_0x42051c(0xd5)](_0x459993);}else{if(_0x165cb1[0x0][_0x42051c(0x73)]=='Hindi')var _0x459993=users[_0x42051c(0x125)];else{if(_0x165cb1[0x0][_0x42051c(0x73)]==_0x42051c(0x12e))var _0x459993=users[_0x42051c(0x12e)];else{if(_0x165cb1[0x0]['language']==_0x42051c(0xa7))var _0x459993=users[_0x42051c(0xa7)];else{if(_0x165cb1[0x0][_0x42051c(0x73)]==_0x42051c(0xfa))var _0x459993=users[_0x42051c(0xfa)];else{if(_0x165cb1[0x0][_0x42051c(0x73)]==_0x42051c(0xa5))var _0x459993=users['Portuguese'];else{if(_0x165cb1[0x0]['language']==_0x42051c(0xb1))var _0x459993=users[_0x42051c(0xb1)];else{if(_0x165cb1[0x0][_0x42051c(0x73)]==_0x42051c(0x90))var _0x459993=users[_0x42051c(0x13c)];}}}}}}}_0x1fc85d[_0x42051c(0xf4)](_0x42051c(0xbf),{'success':_0x4dd0b9[_0x42051c(0xc7)]('success'),'errors':_0x4dd0b9['flash'](_0x42051c(0xe0)),'role':_0x5d899d,'profile':_0x5edf5e,'adjustment':_0x1b0f3c,'stock':_0x11cdd9,'master_shop':_0x165cb1,'warehouse_name':_0x3e1ada,'unit':_0x56e1dc,'language':_0x459993});}catch(_0x22b0d9){console['log'](_0x22b0d9),_0x1fc85d[_0x42051c(0x9e)](0xc8)[_0x42051c(0x12d)]({'message':_0x22b0d9[_0x42051c(0x13e)]});}}),router['post']('/preview/:id',auth,async(_0x4ad37a,_0x295e3d)=>{var _0x1082ef=a0_0x2293f1;try{const {invoice:_0xb2c011,warehouse_name:_0x3ff286,Room_name:_0x80b214}=_0x4ad37a[_0x1082ef(0x77)],_0x7343e=_0x4ad37a[_0x1082ef(0xeb)]['id'],_0x539fec=await adjustment_finished[_0x1082ef(0x109)]({'_id':_0x7343e});var _0x5bf99d;const _0x12afe3=_0x539fec[_0x1082ef(0xc4)][_0x1082ef(0xdb)](async _0x76c961=>{var _0x257b3b=_0x1082ef;if(_0x76c961['adjust_qty']>0x0){_0x5bf99d=await warehouse[_0x257b3b(0xba)]({'name':_0x3ff286,'room':_0x76c961[_0x257b3b(0xda)],'warehouse_category':_0x257b3b(0xcd)});const _0x48808c=_0x5bf99d[_0x257b3b(0xaa)][_0x257b3b(0xdb)](_0x25fe9=>{var _0x225306=_0x257b3b;console[_0x225306(0xd5)](_0x76c961[_0x225306(0x7a)]);if(_0x76c961[_0x225306(0x7a)]=='minus')_0x25fe9[_0x225306(0xb6)]==_0x76c961[_0x225306(0xb6)]&&_0x25fe9[_0x225306(0xfc)]==_0x76c961['bay']&&_0x25fe9[_0x225306(0x118)]==_0x76c961['expiry_date']&&_0x25fe9[_0x225306(0x98)]==_0x76c961[_0x225306(0x98)]&&_0x25fe9['batch_code']==_0x76c961[_0x225306(0x116)]&&_0x25fe9['invoice']==_0x76c961[_0x225306(0x75)]&&(_0x25fe9['product_stock']=_0x25fe9['product_stock']-_0x76c961[_0x225306(0xab)]);else _0x76c961[_0x225306(0x7a)]==_0x225306(0xfb)&&(_0x25fe9[_0x225306(0xb6)]==_0x76c961['product_name']&&_0x25fe9['bay']==_0x76c961[_0x225306(0xfc)]&&_0x25fe9['expiry_date']==_0x76c961[_0x225306(0x118)]&&_0x25fe9[_0x225306(0x98)]==_0x76c961['production_date']&&_0x25fe9[_0x225306(0x116)]==_0x76c961['batch_code']&&_0x25fe9[_0x225306(0x75)]==_0x76c961[_0x225306(0x75)]&&(_0x25fe9[_0x225306(0xb8)]=_0x25fe9[_0x225306(0xb8)]+_0x76c961[_0x225306(0xab)]));});}return _0x5bf99d;});Promise[_0x1082ef(0xc8)](_0x12afe3)['then'](async _0x1d98cb=>{var _0x406565=_0x1082ef;try{for(const _0x3c1afc of _0x1d98cb){await _0x3c1afc[_0x406565(0x9f)]();}_0x539fec[_0x406565(0xf9)]=_0x406565(0xf8);const _0xec8f64=await _0x539fec[_0x406565(0x9f)](),_0x4161b5=await master_shop[_0x406565(0x123)](),_0x26cae2=await email_settings[_0x406565(0xba)](),_0x581708=await supervisor_settings[_0x406565(0x123)]();var _0x2e6d2c=_0x539fec[_0x406565(0xc4)],_0x2dfca9='',_0x1c83c7;for(_0x1c83c7 in _0x2e6d2c){var _0xb8c5fd='FG';_0x539fec[_0x406565(0xc0)]==_0x406565(0xe1)&&(_0xb8c5fd='DG'),_0x2dfca9+='<tr>'+_0x406565(0xa9)+_0x2e6d2c[_0x1c83c7][_0x406565(0xb6)]+'</td>'+_0x406565(0xa9)+_0x2e6d2c[_0x1c83c7][_0x406565(0x12c)]+_0x406565(0x82)+_0x406565(0xa9)+_0x2e6d2c[_0x1c83c7][_0x406565(0xab)]+'</td>'+_0x406565(0xa9)+_0x2e6d2c[_0x1c83c7][_0x406565(0x83)]+_0x406565(0x82)+_0x406565(0xa9)+_0x2e6d2c[_0x1c83c7][_0x406565(0x79)]+_0x406565(0x82)+_0x406565(0xa9)+_0x539fec[_0x406565(0xc0)]+_0x406565(0x82)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2e6d2c[_0x1c83c7][_0x406565(0xda)]+_0x406565(0x82)+_0x406565(0xa9)+_0xb8c5fd+_0x2e6d2c[_0x1c83c7][_0x406565(0xfc)]+'</td>'+_0x406565(0x107);}let _0x385904=nodemailer['createTransport']({'host':_0x26cae2[_0x406565(0xd9)],'port':Number(_0x26cae2['port']),'secure':![],'auth':{'user':_0x26cae2[_0x406565(0xf3)],'pass':_0x26cae2[_0x406565(0x89)]}}),_0x44be93={'from':_0x26cae2[_0x406565(0xf3)],'to':_0x581708[0x0]['FGSEmail'],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x406565(0xf1),'path':__dirname+'/../public'+'/upload/'+_0x4161b5[0x0][_0x406565(0x94)],'cid':_0x406565(0x74)}],'html':_0x406565(0xdd)+_0x406565(0xf5)+_0x406565(0x13d)+_0x406565(0x10e)+_0x406565(0x140)+_0x406565(0x10e)+_0x406565(0xc3)+'</div>'+_0x406565(0x10e)+_0x406565(0xd6)+_0x4161b5[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x406565(0x114)+_0x406565(0xf2)+_0x406565(0x10e)+_0x406565(0x138)+_0x406565(0xbc)+_0x539fec[_0x406565(0x75)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x406565(0xb7)+_0x539fec[_0x406565(0xa0)]+'\x20'+'</span>'+'</h5>'+'</div>'+_0x406565(0xe5)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x406565(0x95)+_0x406565(0x117)+_0x406565(0xc5)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x406565(0x131)+_0x406565(0x11f)+_0x406565(0xd1)+_0x406565(0x13a)+_0x406565(0x9d)+'</tr>'+_0x406565(0x88)+_0x406565(0xc6)+'\x20'+_0x2dfca9+'\x20'+'</tbody>'+_0x406565(0x9c)+_0x406565(0x10e)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x4161b5[0x0]['site_title']+_0x406565(0x76)+_0x406565(0x114)+_0x406565(0x114)+_0x406565(0x96)};_0x385904[_0x406565(0x139)](_0x44be93,function(_0x1f8308,_0x49790b){var _0x125882=_0x406565;_0x1f8308?(console[_0x125882(0xd5)](_0x1f8308),console[_0x125882(0xd5)](_0x125882(0xa6))):console[_0x125882(0xd5)](_0x125882(0xbe));}),_0x4ad37a[_0x406565(0xc7)](_0x406565(0xcf),_0x406565(0xb4)),_0x295e3d[_0x406565(0xd0)]('/picking_list/PDF_adjustment/'+_0xec8f64[_0x406565(0xff)]);}catch(_0x349b1a){console[_0x406565(0xdf)](_0x349b1a),_0x295e3d[_0x406565(0x9e)](0x1f4)['json']({'error':_0x406565(0x122)});}})[_0x1082ef(0x124)](_0x584bf4=>{var _0x3a5114=_0x1082ef;console['error'](_0x584bf4),_0x295e3d[_0x3a5114(0x9e)](0x1f4)[_0x3a5114(0x12d)]({'error':_0x3a5114(0x12f)});});}catch(_0x4dae5f){_0x295e3d[_0x1082ef(0x12d)]({'message':_0x4dae5f[_0x1082ef(0x13e)]});}}),router[a0_0x2293f1(0x133)]('/view/:id',auth,async(_0x5428c9,_0x40b3c4)=>{var _0x201bee=a0_0x2293f1;try{const {username:_0x56721e,email:_0x5cdd5e,role:_0x442727}=_0x5428c9[_0x201bee(0xd3)],_0x58b514=_0x5428c9[_0x201bee(0xd3)],_0x118a02=await profile[_0x201bee(0xba)]({'email':_0x58b514['email']}),_0x1ea2f2=await master_shop[_0x201bee(0x123)]();console[_0x201bee(0xd5)](_0x201bee(0xd8),_0x1ea2f2);const _0x311e60=_0x5428c9[_0x201bee(0xeb)]['id'],_0x2922e6=await adjustment_finished['findById']({'_id':_0x311e60});let _0x5f258f=new Date(_0x2922e6[_0x201bee(0x118)]),_0x50ec77=('0'+_0x5f258f['getDate']())['slice'](-0x2),_0x2a0dce=('0'+(_0x5f258f[_0x201bee(0xb2)]()+0x1))[_0x201bee(0x92)](-0x2),_0x5adb8f=_0x5f258f[_0x201bee(0x128)](),_0x2f6054=_0x5adb8f+'-'+_0x2a0dce+'-'+_0x50ec77;var _0x521b18=[_0x201bee(0x87),_0x201bee(0xbb),_0x201bee(0xa3)];const _0xa05046=await purchases[_0x201bee(0xed)]([{'$match':{'warehouse_name':_0x2922e6[_0x201bee(0xc0)]}},{'$unwind':_0x201bee(0x7d)},{'$group':{'_id':_0x201bee(0xdc)}}]);console['log']('purchases_data',_0xa05046);const _0x18292e=await product[_0x201bee(0x123)]({}),_0xa32cfc=await warehouse[_0x201bee(0xed)]([{'$match':{'name':_0x2922e6[_0x201bee(0xc0)],'room':_0x2922e6['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x201bee(0x11b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x201bee(0xa2)},'bay':{'$first':_0x201bee(0xf7)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x201bee(0x111)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x201bee(0x84)},'secondary_code':{'$first':_0x201bee(0x7e)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x201bee(0x86)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x1ea2f2[0x0][_0x201bee(0x73)]==_0x201bee(0x115)){var _0x1753db=users[_0x201bee(0x8a)];console[_0x201bee(0xd5)](_0x1753db);}else{if(_0x1ea2f2[0x0][_0x201bee(0x73)]==_0x201bee(0x125))var _0x1753db=users[_0x201bee(0x125)];else{if(_0x1ea2f2[0x0][_0x201bee(0x73)]==_0x201bee(0x12e))var _0x1753db=users['German'];else{if(_0x1ea2f2[0x0]['language']==_0x201bee(0xa7))var _0x1753db=users[_0x201bee(0xa7)];else{if(_0x1ea2f2[0x0][_0x201bee(0x73)]==_0x201bee(0xfa))var _0x1753db=users[_0x201bee(0xfa)];else{if(_0x1ea2f2[0x0][_0x201bee(0x73)]==_0x201bee(0xa5))var _0x1753db=users[_0x201bee(0x11a)];else{if(_0x1ea2f2[0x0][_0x201bee(0x73)]==_0x201bee(0xb1))var _0x1753db=users[_0x201bee(0xb1)];else{if(_0x1ea2f2[0x0][_0x201bee(0x73)]=='Arabic\x20(ae)')var _0x1753db=users['Arabic'];}}}}}}}_0x40b3c4[_0x201bee(0xf4)](_0x201bee(0xa1),{'success':_0x5428c9[_0x201bee(0xc7)](_0x201bee(0xcf)),'errors':_0x5428c9[_0x201bee(0xc7)](_0x201bee(0xe0)),'role':_0x58b514,'profile':_0x118a02,'adjustment':_0x2922e6,'stock':_0xa32cfc,'master_shop':_0x1ea2f2,'warehouse_name':_0xa05046,'unit':_0x18292e,'language':_0x1753db,'rooms_data':_0x521b18,'ed_fullDate':_0x2f6054});}catch(_0x486734){console[_0x201bee(0xd5)](_0x486734),_0x40b3c4[_0x201bee(0x9e)](0xc8)['json']({'message':_0x486734['message']});}}),router[a0_0x2293f1(0x12a)](a0_0x2293f1(0x80),auth,async(_0x24b07c,_0x1cdd22)=>{var _0x2924ed=a0_0x2293f1;try{const _0x3a647c=_0x24b07c[_0x2924ed(0xeb)]['id'],_0x52dff5=await adjustment_finished['findById']({'_id':_0x3a647c}),_0x5bcbbd=await warehouse[_0x2924ed(0xba)]({'name':_0x52dff5[_0x2924ed(0xc0)],'room':_0x52dff5[_0x2924ed(0xaf)]}),{warehouse_name:_0x1c76b5,date:_0x54c4ad,prod_name:_0xf8ee42,level:_0x18188e,isle:_0x134be8,pallet:_0x294c58,stock:_0x48aef0,types:_0x2c379e,adjust_qty:_0x19ca35,new_adjust_qty:_0x5c33f0,note:_0x13684e,Room_name:_0x549989,invoice:_0x258476,JO_number:_0x521661}=_0x24b07c[_0x2924ed(0x77)];if(typeof _0xf8ee42==_0x2924ed(0xae))var _0x4d95c9=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x7c)]],_0x53273e=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0xef)]],_0x2868ae=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0xa4)]],_0x536585=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x7a)]],_0x3ae58a=[_0x24b07c['body']['adjust_qty']],_0x5819a1=[_0x24b07c['body'][_0x2924ed(0x13f)]],_0x23b76c=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x100)]],_0x3bbe0f=[_0x24b07c['body'][_0x2924ed(0x83)]],_0x53610a=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0xfe)]],_0x186312=[_0x24b07c[_0x2924ed(0x77)]['batch_code']],_0x1fc679=[_0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x118)]];else var _0x4d95c9=[..._0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x7c)]],_0x53273e=[..._0x24b07c[_0x2924ed(0x77)]['level']],_0x2868ae=[..._0x24b07c[_0x2924ed(0x77)]['stock']],_0x536585=[..._0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x7a)]],_0x3ae58a=[..._0x24b07c[_0x2924ed(0x77)]['adjust_qty']],_0x5819a1=[..._0x24b07c[_0x2924ed(0x77)]['new_adjust_qty']],_0x23b76c=[..._0x24b07c['body'][_0x2924ed(0x100)]],_0x3bbe0f=[..._0x24b07c['body']['unit']],_0x53610a=[..._0x24b07c['body'][_0x2924ed(0xfe)]],_0x186312=[..._0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x116)]],_0x1fc679=[..._0x24b07c[_0x2924ed(0x77)][_0x2924ed(0x118)]];const _0x3df692=_0x4d95c9[_0x2924ed(0xdb)](_0x3abde4=>{return _0x3abde4={'product_name':_0x3abde4};});_0x53273e['forEach']((_0x132f52,_0x4d6720)=>{var _0x55e665=_0x2924ed;_0x3df692[_0x4d6720][_0x55e665(0xfc)]=_0x132f52;}),_0x2868ae[_0x2924ed(0x7f)]((_0x147e24,_0x255380)=>{var _0x5d90eb=_0x2924ed;_0x3df692[_0x255380][_0x5d90eb(0xcb)]=_0x147e24;}),_0x536585['forEach']((_0x2e2552,_0x44898b)=>{_0x3df692[_0x44898b]['types']=_0x2e2552;}),_0x3ae58a[_0x2924ed(0x7f)]((_0x489edd,_0x2adf92)=>{_0x3df692[_0x2adf92]['adjust_qty']=_0x489edd;}),_0x5819a1[_0x2924ed(0x7f)]((_0x282fdb,_0x548e26)=>{var _0x3154ab=_0x2924ed;_0x3df692[_0x548e26][_0x3154ab(0x13f)]=_0x282fdb;}),_0x3bbe0f[_0x2924ed(0x7f)]((_0x71276c,_0x2de737)=>{var _0x2e16a2=_0x2924ed;_0x3df692[_0x2de737][_0x2e16a2(0x83)]=_0x71276c;}),_0x53610a['forEach']((_0x59a065,_0x3f145a)=>{var _0x1ee253=_0x2924ed;_0x3df692[_0x3f145a][_0x1ee253(0x79)]=_0x59a065;}),_0x23b76c['forEach']((_0x3eac6b,_0x3d6f1a)=>{_0x3df692[_0x3d6f1a]['product_code']=_0x3eac6b;}),_0x186312['forEach']((_0x346caa,_0x39ad74)=>{var _0x638e3b=_0x2924ed;_0x3df692[_0x39ad74][_0x638e3b(0x116)]=_0x346caa;}),_0x1fc679[_0x2924ed(0x7f)]((_0x459e59,_0xd1ce80)=>{var _0x116699=_0x2924ed;_0x3df692[_0xd1ce80][_0x116699(0x118)]=_0x459e59;});const _0x14c208=_0x3df692[_0x2924ed(0x9b)](_0x118c8c=>_0x118c8c[_0x2924ed(0xab)]!=='0'&&_0x118c8c[_0x2924ed(0xab)]!=='');var _0x56ec8a=0x0;_0x14c208[_0x2924ed(0x7f)](_0x545bb2=>{var _0x32c448=_0x2924ed;console[_0x32c448(0xd5)](_0x32c448(0xd2),_0x545bb2),parseInt(_0x545bb2[_0x32c448(0xab)])<=0x0&&_0x56ec8a++;});if(_0x56ec8a!=0x0)return _0x24b07c[_0x2924ed(0xc7)](_0x2924ed(0xe0),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x1cdd22['redirect'](_0x2924ed(0x135));_0x52dff5[_0x2924ed(0xc0)]=_0x1c76b5,_0x52dff5['date']=_0x54c4ad,_0x52dff5[_0x2924ed(0xc4)]=_0x14c208,_0x52dff5[_0x2924ed(0x9a)]=_0x13684e,_0x52dff5[_0x2924ed(0xaf)]=_0x549989,_0x52dff5[_0x2924ed(0x75)]=_0x258476,_0x52dff5[_0x2924ed(0xc1)]=_0x521661;const _0x388f47=await _0x52dff5[_0x2924ed(0x9f)](),_0x17fb98=await warehouse['findOne']({'name':_0x1c76b5,'room':_0x549989});_0x388f47['product']['forEach'](_0x4fa8c7=>{var _0x25ee8b=_0x2924ed;const _0x2b8a3f=_0x17fb98['product_details'][_0x25ee8b(0xdb)](_0x496f0a=>{var _0x1857dd=_0x25ee8b;_0x4fa8c7[_0x1857dd(0x7a)]==_0x1857dd(0xe4)?_0x496f0a['product_name']==_0x4fa8c7[_0x1857dd(0xb6)]&&_0x496f0a[_0x1857dd(0xfc)]==_0x4fa8c7['bay']&&(_0x496f0a[_0x1857dd(0xb8)]=parseInt(_0x496f0a[_0x1857dd(0xb8)])-parseInt(_0x4fa8c7[_0x1857dd(0xab)])):_0x496f0a[_0x1857dd(0xb6)]==_0x4fa8c7['product_name']&&_0x496f0a[_0x1857dd(0xfc)]==_0x4fa8c7[_0x1857dd(0xfc)]&&(_0x496f0a[_0x1857dd(0xb8)]=parseInt(_0x496f0a['product_stock'])+parseInt(_0x4fa8c7[_0x1857dd(0xab)]));});}),await _0x17fb98[_0x2924ed(0x9f)](),_0x24b07c[_0x2924ed(0xc7)](_0x2924ed(0xcf),_0x2924ed(0x8d)),_0x1cdd22[_0x2924ed(0xd0)](_0x2924ed(0x126));}catch(_0x36f63c){console[_0x2924ed(0xd5)](_0x36f63c);}}),router['post'](a0_0x2293f1(0xfd),async(_0x49f0cd,_0x217cf8)=>{var _0x2c0524=a0_0x2293f1;const {primary_code:_0x1cde8c,warehouse_data:_0x20fc16,rooms_data:_0x34636c,Roomslist:_0x2c3169}=_0x49f0cd[_0x2c0524(0x77)],_0xb6875=_0x2c3169['split'](','),_0x4426c5=[];async function _0x18d89a(_0x3c1f1f){var _0x54358b=_0x2c0524;const _0x2ec600=await warehouse[_0x54358b(0xed)]([{'$match':{'name':_0x20fc16,'room':_0x3c1f1f}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1cde8c}},{'$group':{'_id':_0x54358b(0x11b),'name':{'$first':_0x54358b(0x7b)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x54358b(0x84)},'secondary_code':{'$first':_0x54358b(0x7e)},'product_code':{'$first':_0x54358b(0x11d)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x54358b(0x111)},'pallet':{'$first':_0x54358b(0x119)},'unit':{'$first':_0x54358b(0xc2)},'secondary_unit':{'$first':_0x54358b(0x8b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x54358b(0xe8)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x54358b(0xf6)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x54358b(0xe6)},'roomNamed':{'$first':_0x54358b(0x141)},'invoice':{'$first':_0x54358b(0x91)}}}]),_0x15bd03=await warehouse[_0x54358b(0xed)]([{'$match':{'name':_0x20fc16,'room':_0x3c1f1f}},{'$unwind':_0x54358b(0x130)},{'$match':{'product_details.secondary_code':_0x1cde8c}},{'$group':{'_id':_0x54358b(0x11b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x54358b(0x11d)},'level':{'$first':_0x54358b(0xf7)},'isle':{'$first':_0x54358b(0x113)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x54358b(0xc2)},'secondary_unit':{'$first':_0x54358b(0x8b)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x54358b(0xe8)},'expiry_date':{'$first':_0x54358b(0xb5)},'production_date':{'$first':_0x54358b(0x120)},'batch_code':{'$first':_0x54358b(0xf6)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x54358b(0xe6)},'roomNamed':{'$first':_0x54358b(0x141)},'invoice':{'$first':_0x54358b(0x91)}}}]);if(_0x2ec600[_0x54358b(0xb9)]>0x0)_0x4426c5[_0x54358b(0xde)](_0x2ec600);else _0x15bd03['length']>0x0&&_0x4426c5[_0x54358b(0xde)](_0x15bd03);}const _0x5bab88=_0xb6875['map'](_0x1b2cc4=>_0x18d89a(_0x1b2cc4));await Promise[_0x2c0524(0xc8)](_0x5bab88),_0x217cf8[_0x2c0524(0x12d)](_0x4426c5);}),router['post'](a0_0x2293f1(0x110),async(_0x5c0407,_0x155417)=>{var _0x551bee=a0_0x2293f1;const {productCode:_0x56e44d,bay:_0x4ae945,warehouses:_0x1ff099,room:_0x59ef63}=_0x5c0407['body'];console[_0x551bee(0xd5)](_0x5c0407[_0x551bee(0x77)]);try{const _0x81bef7=await warehouse[_0x551bee(0xed)]([{'$match':{'name':_0x1ff099,'room':_0x59ef63}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x4ae945)}},{'$group':{'_id':_0x551bee(0x11b),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x551bee(0xf7)},'maxProducts':{'$first':_0x551bee(0x105)}}}]);_0x155417[_0x551bee(0x9e)](0xc8)['json'](_0x81bef7);}catch(_0x1a4ead){_0x155417[_0x551bee(0x9e)](0x194)[_0x551bee(0x12d)]({'message':_0x1a4ead[_0x551bee(0x13e)]});}}),module[a0_0x2293f1(0x8c)]=router;