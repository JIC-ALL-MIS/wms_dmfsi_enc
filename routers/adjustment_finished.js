function a0_0x3742(_0x367efe,_0x586470){var _0x2033cb=a0_0x2033();return a0_0x3742=function(_0x374260,_0x540ba0){_0x374260=_0x374260-0x179;var _0x158d58=_0x2033cb[_0x374260];return _0x158d58;},a0_0x3742(_0x367efe,_0x586470);}var a0_0x152a98=a0_0x3742;(function(_0x372fcb,_0x5ffd4f){var _0x2beb72=a0_0x3742,_0x4395df=_0x372fcb();while(!![]){try{var _0x17406a=parseInt(_0x2beb72(0x1a3))/0x1+parseInt(_0x2beb72(0x247))/0x2+parseInt(_0x2beb72(0x1c6))/0x3*(parseInt(_0x2beb72(0x1f5))/0x4)+parseInt(_0x2beb72(0x223))/0x5*(-parseInt(_0x2beb72(0x236))/0x6)+parseInt(_0x2beb72(0x1ac))/0x7*(parseInt(_0x2beb72(0x235))/0x8)+parseInt(_0x2beb72(0x215))/0x9*(-parseInt(_0x2beb72(0x19c))/0xa)+-parseInt(_0x2beb72(0x1f9))/0xb;if(_0x17406a===_0x5ffd4f)break;else _0x4395df['push'](_0x4395df['shift']());}catch(_0x5372f1){_0x4395df['push'](_0x4395df['shift']());}}}(a0_0x2033,0x7a7c6));const express=require(a0_0x152a98(0x185)),app=express(),router=express[a0_0x152a98(0x192)](),auth=require(a0_0x152a98(0x1a9)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x152a98(0x212)),users=require(a0_0x152a98(0x1e7)),nodemailer=require(a0_0x152a98(0x1d7));router['get'](a0_0x152a98(0x1c1),auth,async(_0x3350b8,_0xd79adf)=>{var _0x4160ba=a0_0x152a98;try{const {username:_0x471381,email:_0x3d3fe3,role:_0x3d4f39}=_0x3350b8[_0x4160ba(0x1bd)],_0x1850d6=_0x3350b8[_0x4160ba(0x1bd)],_0x598092=await profile[_0x4160ba(0x1d0)]({'email':_0x1850d6['email']}),_0x5b18cf=await master_shop[_0x4160ba(0x188)]();let _0x2ab075;if(_0x1850d6['role']=='staff'){const _0x2e876f=await staff[_0x4160ba(0x1d0)]({'email':_0x1850d6[_0x4160ba(0x1bc)]});_0x2ab075=await warehouse[_0x4160ba(0x188)]({'status':_0x4160ba(0x233),'name':_0x2e876f[_0x4160ba(0x182)]});}else _0x2ab075=await warehouse[_0x4160ba(0x188)]({'status':_0x4160ba(0x233)});const _0x2c52ad=await product['find']();let _0x1e4995;if(_0x1850d6['role']==_0x4160ba(0x1de)){const _0x15ab65=await staff['findOne']({'email':_0x1850d6[_0x4160ba(0x1bc)]});_0x1e4995=await adjustment_finished['find']({'warehouse_name':_0x15ab65[_0x4160ba(0x182)]});}else _0x1e4995=await adjustment_finished[_0x4160ba(0x1ee)]([{'$unwind':'$product'},{'$group':{'_id':_0x4160ba(0x197),'invoice':{'$first':_0x4160ba(0x22a)},'date':{'$first':_0x4160ba(0x20f)},'warehouse_name':{'$first':_0x4160ba(0x207)},'room':{'$addToSet':_0x4160ba(0x1c9)},'finalize':{'$first':_0x4160ba(0x1c3)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5b18cf[0x0][_0x4160ba(0x186)]==_0x4160ba(0x245)){var _0x23b124=users[_0x4160ba(0x1a7)];console[_0x4160ba(0x227)](_0x23b124);}else{if(_0x5b18cf[0x0][_0x4160ba(0x186)]==_0x4160ba(0x1a2))var _0x23b124=users[_0x4160ba(0x1a2)];else{if(_0x5b18cf[0x0][_0x4160ba(0x186)]==_0x4160ba(0x1dc))var _0x23b124=users[_0x4160ba(0x1dc)];else{if(_0x5b18cf[0x0][_0x4160ba(0x186)]==_0x4160ba(0x237))var _0x23b124=users[_0x4160ba(0x237)];else{if(_0x5b18cf[0x0]['language']=='French')var _0x23b124=users[_0x4160ba(0x21b)];else{if(_0x5b18cf[0x0][_0x4160ba(0x186)]=='Portuguese\x20(BR)')var _0x23b124=users[_0x4160ba(0x239)];else{if(_0x5b18cf[0x0][_0x4160ba(0x186)]==_0x4160ba(0x1f0))var _0x23b124=users['Chinese'];else{if(_0x5b18cf[0x0][_0x4160ba(0x186)]==_0x4160ba(0x20c))var _0x23b124=users[_0x4160ba(0x1cb)];}}}}}}}_0xd79adf[_0x4160ba(0x21d)]('adjustment_finished',{'success':_0x3350b8[_0x4160ba(0x1fb)](_0x4160ba(0x1d8)),'errors':_0x3350b8[_0x4160ba(0x1fb)](_0x4160ba(0x194)),'role':_0x1850d6,'profile':_0x598092,'warehouse':_0x2ab075,'product':_0x2c52ad,'adjustment':_0x1e4995,'master_shop':_0x5b18cf,'language':_0x23b124});}catch(_0x309c19){console[_0x4160ba(0x227)](_0x309c19);}});function a0_0x2033(){var _0x536681=['foreach\x20newproduct','$invoice','master','$product_details.type','room','invoice','$product_details.batch_code','expiry_date','production_date','json','Enabled','adjust_qty','669544weGfNw','300072CGQxwI','Spanish','<tbody\x20style=\x22text-align:\x20center;\x22>','Portuguese','$product_details','product_code','JO_number','forEach','$product_details.product_code','message','<tr>','logo','FGSEmail','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','prod_name','English\x20(US)','$product_details.product_name','353916CdSYMF','exports','\x20</h2>','$product_details.bay','product_date','Logo.png','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','True','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','batch_code','warehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','An\x20error\x20occurred.','express','language','$product.product_name','find','</body></html>','edit_adjustment_finished_view','error','status','product','DRY\x20GOODS','product_stock','getFullYear','</td>','Router','Adjustment\x20Finalize\x20Successfully','errors','password','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$_id','</div>','$product_details.expiry_date','image','role','40cRtxbu','adjustment\x20data\x20update\x20successfully','$product','$product_details.unit','<span\x20style=\x22float:\x20right;\x22>','/preview/:id','Hindi','894632iCQETN','</span>','all','ADJF-','English','Error\x20Occurs','../middleware/auth','split','site_title','35ZkyfgS','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','findById','unit','slice','/barcode_scanner','Ambient','$product_details._id','date','New_Qty_Converted_adj','createTransport','$room','QA\x20Warehouse','padStart','</thead>','$product_details.product_stock','email','user','_id','new_adjust_qty','$product_details.storage','/view','$product_details.bin','$finalize','</tbody>','prod_invoice','39JqcDHh','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','/upload/','$product.room_names','room_names','Arabic','adjustment\x20add\x20successfull','edit_adjustment_finished','$product_details.floorlevel','bay','findOne','Finished\x20Goods','stockBefore','save','$product_details.secondary_unit','<h5\x20style=\x22text-align:\x20left;\x22>','secondary_unit','nodemailer','success','getMonth','redirect','back','German','/adjustment_finished/preview/','staff','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','length','minus','</tr>','Enclosed','<!DOCTYPE\x20html>','prod_code','map','../public/language/languages.json','random','purchases_data','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/CheckingWarehouse','<div>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','aggregate','/view/add_adjustment','Chinese','level','Portuguese\x20(BR)','$product_details.production_date','Primary_Units','11676gMGuqN','Secondary_units','$product_details.invoice','get','4711696nGGVlv','<strong>\x20Regards\x20</strong>','flash','finalize','add_adjustment_finished','body','Rooms','catch','$product_details.rack','warehouse_name','<h2>\x20','stock','/adjustment/view','</h5>','$warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<hr\x20class=\x22my-3\x22>','<html><head><title></title>','Arabic\x20(ae)','$product_details.maxPerUnit','prod_cat','$date','$name','$product_details.maxProducts','../models/all_models','getDate','post','1232892qWxyxa','then','host','\x20Order\x20Date\x20:\x20','Return\x20Rooms','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','French','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','render','$product_details.secondary_code','maxPerUnit','New_Qty_Converted','add','types','5JBIzHu','params','$product_details.primary_code','Email\x20sent\x20successfully','log','product_name'];a0_0x2033=function(){return _0x536681;};return a0_0x2033();}async function getRandom8DigitNumber(){var _0x990986=a0_0x152a98;const _0xf9d3b=0x989680,_0x5d3c86=0x5f5e0ff,_0x13bcdb=Math['floor'](Math[_0x990986(0x1e8)]()*(_0x5d3c86-_0xf9d3b+0x1))+_0xf9d3b;var _0x39a5dd;const _0xfaa96e=await adjustment_finished[_0x990986(0x1d0)]({'invoice':_0x990986(0x1a6)+_0x13bcdb});return _0xfaa96e&&_0xfaa96e[_0x990986(0x1e0)]>0x0?_0x39a5dd=_0x990986(0x1a6)+_0x13bcdb:_0x39a5dd='ADJF-'+_0x13bcdb,_0x39a5dd;}router[a0_0x152a98(0x1f8)]('/view/add_adjustment',auth,async(_0x2e4d0f,_0x56cdba)=>{var _0x2bbc0e=a0_0x152a98;try{const {username:_0x1db29b,email:_0x52c1b2,role:_0x1e1906}=_0x2e4d0f[_0x2bbc0e(0x1bd)],_0x196f46=_0x2e4d0f['user'],_0x48e07a=await profile['findOne']({'email':_0x196f46[_0x2bbc0e(0x1bc)]}),_0x4f9b53=await master_shop['find']();let _0x425499;if(_0x196f46[_0x2bbc0e(0x19b)]=='staff'){const _0x2d7810=await staff[_0x2bbc0e(0x1d0)]({'email':_0x196f46['email']});_0x425499=await warehouse[_0x2bbc0e(0x1ee)]([{'$match':{'status':'Enabled','name':_0x2d7810[_0x2bbc0e(0x182)],'warehouse_category':_0x2bbc0e(0x1d1),'name':{'$ne':_0x2bbc0e(0x1b8)}}},{'$group':{'_id':_0x2bbc0e(0x210),'name':{'$first':_0x2bbc0e(0x210)}}}]);}else _0x425499=await warehouse[_0x2bbc0e(0x1ee)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0x2bbc0e(0x1b8)}}},{'$group':{'_id':'$name','name':{'$first':_0x2bbc0e(0x210)}}}]);const _0x34230c=await product[_0x2bbc0e(0x188)]({}),_0x1a6156=await adjustment_finished[_0x2bbc0e(0x188)]({}),_0xc92f33=_0x1a6156[_0x2bbc0e(0x1e0)]+0x1,_0x560a19=_0x2bbc0e(0x1a6)+_0xc92f33['toString']()[_0x2bbc0e(0x1b9)](0x5,'0');var _0x2dfd0d=[_0x2bbc0e(0x1b2),_0x2bbc0e(0x1e3),_0x2bbc0e(0x219)];if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]==_0x2bbc0e(0x245))var _0x325129=users[_0x2bbc0e(0x1a7)];else{if(_0x4f9b53[0x0]['language']==_0x2bbc0e(0x1a2))var _0x325129=users[_0x2bbc0e(0x1a2)];else{if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]==_0x2bbc0e(0x1dc))var _0x325129=users[_0x2bbc0e(0x1dc)];else{if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]=='Spanish')var _0x325129=users[_0x2bbc0e(0x237)];else{if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]=='French')var _0x325129=users[_0x2bbc0e(0x21b)];else{if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]==_0x2bbc0e(0x1f2))var _0x325129=users[_0x2bbc0e(0x239)];else{if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]==_0x2bbc0e(0x1f0))var _0x325129=users['Chinese'];else{if(_0x4f9b53[0x0][_0x2bbc0e(0x186)]==_0x2bbc0e(0x20c))var _0x325129=users[_0x2bbc0e(0x1cb)];}}}}}}}const _0x4bffbc=getRandom8DigitNumber();_0x4bffbc['then'](_0x427f66=>{var _0x5b2e89=_0x2bbc0e;_0x56cdba[_0x5b2e89(0x21d)](_0x5b2e89(0x1fd),{'success':_0x2e4d0f[_0x5b2e89(0x1fb)]('success'),'errors':_0x2e4d0f[_0x5b2e89(0x1fb)](_0x5b2e89(0x194)),'role':_0x196f46,'profile':_0x48e07a,'warehouse':_0x425499,'product':_0x34230c,'master_shop':_0x4f9b53,'language':_0x325129,'rooms_data':_0x2dfd0d,'invoice_no':_0x427f66});})[_0x2bbc0e(0x200)](_0x3b7a7e=>{var _0xa51f39=_0x2bbc0e;_0x2e4d0f[_0xa51f39(0x1fb)](_0xa51f39(0x194),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x56cdba[_0xa51f39(0x1da)](_0xa51f39(0x205));});}catch(_0x55119b){console['log'](_0x55119b);}}),router[a0_0x152a98(0x214)](a0_0x152a98(0x1ef),auth,async(_0x578132,_0x220ffb)=>{var _0x3dc863=a0_0x152a98;try{const {warehouse_name:_0x179b1f,date:_0x5664c7,prod_name:_0x369b40,level:_0x31d952,isle:_0x1e2239,pallet:_0x2c08fa,stock:_0x46992f,types:_0x585b04,adjust_qty:_0x5dced3,new_adjust_qty:_0x344f66,note:_0x5ac192,Room_name:_0x309dc0,invoice:_0x632ae4,JO_number:_0xcf57c9,expiry_date:_0x8777a4}=_0x578132[_0x3dc863(0x1fe)];if(typeof _0x369b40=='string')var _0xfee092=[_0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x244)]],_0x11d5e6=[_0x578132['body'][_0x3dc863(0x1f1)]],_0x4962af=[_0x578132[_0x3dc863(0x1fe)]['stock']],_0x159210=[_0x578132[_0x3dc863(0x1fe)]['types']],_0x3d0027=[_0x578132['body'][_0x3dc863(0x1b5)]],_0x464c70=[_0x578132['body'][_0x3dc863(0x220)]],_0x5eed6f=[_0x578132['body'][_0x3dc863(0x1f4)]],_0x1c2de6=[_0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1f6)]],_0x321e7b=[_0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1e5)]],_0x1697c4=[_0x578132['body']['batch_code']],_0x23178b=[_0x578132[_0x3dc863(0x1fe)]['expiry_date']],_0x36e38e=[_0x578132[_0x3dc863(0x1fe)]['product_date']],_0x588efc=[_0x578132[_0x3dc863(0x1fe)]['prod_cat']],_0x4230ed=[_0x578132['body']['Rooms']],_0x2f2a67=[_0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x21f)]],_0x2cc043=[_0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1c5)]];else var _0xfee092=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x244)]],_0x11d5e6=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1f1)]],_0x4962af=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x204)]],_0x159210=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x222)]],_0x3d0027=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1b5)]],_0x464c70=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x220)]],_0x5eed6f=[..._0x578132['body']['Primary_Units']],_0x1c2de6=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1f6)]],_0x321e7b=[..._0x578132['body'][_0x3dc863(0x1e5)]],_0x1697c4=[..._0x578132['body'][_0x3dc863(0x181)]],_0x23178b=[..._0x578132['body']['expiry_date']],_0x36e38e=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x17c)]],_0x588efc=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x20e)]],_0x4230ed=[..._0x578132['body'][_0x3dc863(0x1ff)]],_0x2f2a67=[..._0x578132['body']['maxPerUnit']],_0x2cc043=[..._0x578132[_0x3dc863(0x1fe)][_0x3dc863(0x1c5)]];const _0x450e0d=_0xfee092[_0x3dc863(0x1e6)](_0x47762b=>{return _0x47762b={'product_name':_0x47762b};});_0x11d5e6[_0x3dc863(0x23d)]((_0xeca858,_0x55c80f)=>{var _0x16e824=_0x3dc863;_0x450e0d[_0x55c80f][_0x16e824(0x1cf)]=_0xeca858;}),_0x4962af[_0x3dc863(0x23d)]((_0x414af,_0xf82e4e)=>{var _0x454a62=_0x3dc863;_0x450e0d[_0xf82e4e][_0x454a62(0x1d2)]=_0x414af;}),_0x159210[_0x3dc863(0x23d)]((_0x323eae,_0x328bf)=>{var _0x55d779=_0x3dc863;_0x450e0d[_0x328bf][_0x55d779(0x222)]=_0x323eae;}),_0x3d0027['forEach']((_0x2b9003,_0x38c931)=>{var _0x51f767=_0x3dc863;_0x450e0d[_0x38c931][_0x51f767(0x234)]=_0x2b9003;}),_0x464c70[_0x3dc863(0x23d)]((_0x33e2ee,_0x2642b8)=>{var _0x5c272f=_0x3dc863;_0x450e0d[_0x2642b8][_0x5c272f(0x1bf)]=_0x33e2ee;}),_0x5eed6f[_0x3dc863(0x23d)]((_0xa4b16c,_0x5a24a4)=>{_0x450e0d[_0x5a24a4]['unit']=_0xa4b16c;}),_0x1c2de6['forEach']((_0x517738,_0x40b7bf)=>{var _0x514954=_0x3dc863;_0x450e0d[_0x40b7bf][_0x514954(0x1d6)]=_0x517738;}),_0x321e7b[_0x3dc863(0x23d)]((_0x4d149e,_0x1a6bbf)=>{var _0x379902=_0x3dc863;_0x450e0d[_0x1a6bbf][_0x379902(0x23b)]=_0x4d149e;}),_0x1697c4[_0x3dc863(0x23d)]((_0x13bdb3,_0x47d076)=>{var _0x288627=_0x3dc863;_0x450e0d[_0x47d076][_0x288627(0x181)]=_0x13bdb3;}),_0x23178b[_0x3dc863(0x23d)]((_0x76e2ea,_0x5641a1)=>{var _0x30ebde=_0x3dc863;_0x450e0d[_0x5641a1][_0x30ebde(0x230)]=_0x76e2ea;}),_0x36e38e[_0x3dc863(0x23d)]((_0x2bb9ec,_0x5688f1)=>{var _0x22086d=_0x3dc863;_0x450e0d[_0x5688f1][_0x22086d(0x231)]=_0x2bb9ec;}),_0x588efc[_0x3dc863(0x23d)]((_0x118fca,_0x3db1a0)=>{_0x450e0d[_0x3db1a0]['prod_cat']=_0x118fca;}),_0x4230ed[_0x3dc863(0x23d)]((_0x5e6900,_0x5f2b35)=>{_0x450e0d[_0x5f2b35]['room_names']=_0x5e6900;}),_0x2f2a67['forEach']((_0xb80639,_0x241f4b)=>{var _0x4a8022=_0x3dc863;_0x450e0d[_0x241f4b][_0x4a8022(0x21f)]=_0xb80639;}),_0x2cc043[_0x3dc863(0x23d)]((_0x4a1050,_0x32d422)=>{var _0x3c628f=_0x3dc863;_0x450e0d[_0x32d422][_0x3c628f(0x22e)]=_0x4a1050;});const _0x1d5960=_0x450e0d['filter'](_0x59ff23=>_0x59ff23['adjust_qty']!=='0'&&_0x59ff23[_0x3dc863(0x234)]!=='');var _0x1158b0=0x0;_0x1d5960[_0x3dc863(0x23d)](_0x547e9b=>{var _0x51f717=_0x3dc863;console[_0x51f717(0x227)](_0x51f717(0x229),_0x547e9b),parseInt(_0x547e9b[_0x51f717(0x234)])<=0x0&&_0x1158b0++;});if(_0x1158b0!=0x0)return _0x578132[_0x3dc863(0x1fb)](_0x3dc863(0x194),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x220ffb[_0x3dc863(0x1da)](_0x3dc863(0x1db));const _0x294b15=new adjustment_finished({'warehouse_name':_0x179b1f,'date':_0x5664c7,'product':_0x1d5960,'note':_0x5ac192,'room':_0x309dc0,'invoice':_0x632ae4,'JO_number':_0xcf57c9,'expiry_date':_0x8777a4}),_0x330bed=await _0x294b15[_0x3dc863(0x1d3)]();_0x578132[_0x3dc863(0x1fb)]('success',_0x3dc863(0x1cc)),_0x220ffb[_0x3dc863(0x1da)](_0x3dc863(0x1dd)+_0x330bed[_0x3dc863(0x1be)]);}catch(_0x193e81){console[_0x3dc863(0x227)](_0x193e81),_0x220ffb['status'](0xc8)[_0x3dc863(0x232)]({'message':_0x193e81['message']});}}),router[a0_0x152a98(0x1f8)](a0_0x152a98(0x1a1),auth,async(_0x46b0b5,_0x5dfb53)=>{var _0xf7bf92=a0_0x152a98;try{const {username:_0x8925e5,email:_0x515af3,role:_0x494da0}=_0x46b0b5[_0xf7bf92(0x1bd)],_0xfa716c=_0x46b0b5[_0xf7bf92(0x1bd)],_0x1fadbe=await profile[_0xf7bf92(0x1d0)]({'email':_0xfa716c[_0xf7bf92(0x1bc)]}),_0x1f9eb1=await master_shop[_0xf7bf92(0x188)](),_0x4f7689=_0x46b0b5['params']['id'],_0x222ff8=await adjustment_finished[_0xf7bf92(0x1ae)]({'_id':_0x4f7689}),_0x50c0bf=await purchases[_0xf7bf92(0x1ee)]([{'$match':{'warehouse_name':_0x222ff8[_0xf7bf92(0x202)]}},{'$unwind':'$product'},{'$group':{'_id':_0xf7bf92(0x187)}}]);console[_0xf7bf92(0x227)](_0xf7bf92(0x1e9),_0x50c0bf);const _0x169c4e=await product['find']({}),_0x338090=await warehouse[_0xf7bf92(0x1ee)]([{'$match':{'name':_0x222ff8[_0xf7bf92(0x202)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':'$product_details'},{'$group':{'_id':_0xf7bf92(0x1b3),'name':{'$first':_0xf7bf92(0x246)},'product_stock':{'$first':_0xf7bf92(0x1bb)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0xf7bf92(0x1c2)},'type':{'$first':_0xf7bf92(0x22c)},'floorlevel':{'$first':_0xf7bf92(0x1ce)},'primary_code':{'$first':_0xf7bf92(0x225)},'secondary_code':{'$first':_0xf7bf92(0x21e)},'product_code':{'$first':_0xf7bf92(0x23e)},'storage':{'$first':_0xf7bf92(0x1c0)},'rack':{'$first':_0xf7bf92(0x201)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0xf7bf92(0x22f)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0xf7bf92(0x1b7)}}}]);if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]=='English\x20(US)'){var _0x2393be=users[_0xf7bf92(0x1a7)];console[_0xf7bf92(0x227)](_0x2393be);}else{if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]=='Hindi')var _0x2393be=users[_0xf7bf92(0x1a2)];else{if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]==_0xf7bf92(0x1dc))var _0x2393be=users[_0xf7bf92(0x1dc)];else{if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]=='Spanish')var _0x2393be=users['Spanish'];else{if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]==_0xf7bf92(0x21b))var _0x2393be=users[_0xf7bf92(0x21b)];else{if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]==_0xf7bf92(0x1f2))var _0x2393be=users[_0xf7bf92(0x239)];else{if(_0x1f9eb1[0x0]['language']=='Chinese')var _0x2393be=users[_0xf7bf92(0x1f0)];else{if(_0x1f9eb1[0x0][_0xf7bf92(0x186)]==_0xf7bf92(0x20c))var _0x2393be=users[_0xf7bf92(0x1cb)];}}}}}}}_0x5dfb53['render'](_0xf7bf92(0x18a),{'success':_0x46b0b5['flash'](_0xf7bf92(0x1d8)),'errors':_0x46b0b5[_0xf7bf92(0x1fb)](_0xf7bf92(0x194)),'role':_0xfa716c,'profile':_0x1fadbe,'adjustment':_0x222ff8,'stock':_0x338090,'master_shop':_0x1f9eb1,'warehouse_name':_0x50c0bf,'unit':_0x169c4e,'language':_0x2393be});}catch(_0x6f3219){console[_0xf7bf92(0x227)](_0x6f3219),_0x5dfb53['status'](0xc8)['json']({'message':_0x6f3219[_0xf7bf92(0x23f)]});}}),router[a0_0x152a98(0x214)](a0_0x152a98(0x1a1),auth,async(_0x1a98ca,_0xbf54fb)=>{var _0x42ab91=a0_0x152a98;try{const {invoice:_0x5ea068,warehouse_name:_0x1aee54,Room_name:_0x3905a0}=_0x1a98ca[_0x42ab91(0x1fe)],_0x4683b2=_0x1a98ca[_0x42ab91(0x224)]['id'],_0x2747f3=await adjustment_finished[_0x42ab91(0x1ae)]({'_id':_0x4683b2});var _0x7ff3e5;const _0x4ea3d4=_0x2747f3[_0x42ab91(0x18d)][_0x42ab91(0x1e6)](async _0x2d76df=>{var _0x3aec8b=_0x42ab91;if(_0x2d76df[_0x3aec8b(0x234)]>0x0){_0x7ff3e5=await warehouse[_0x3aec8b(0x1d0)]({'name':_0x1aee54,'room':_0x2d76df[_0x3aec8b(0x1ca)],'warehouse_category':_0x3aec8b(0x1d1)});const _0x1c32aa=_0x7ff3e5['product_details'][_0x3aec8b(0x1e6)](_0x4107b0=>{var _0x4c57a3=_0x3aec8b;console[_0x4c57a3(0x227)](_0x2d76df[_0x4c57a3(0x222)]);if(_0x2d76df[_0x4c57a3(0x222)]==_0x4c57a3(0x1e1))_0x4107b0[_0x4c57a3(0x228)]==_0x2d76df[_0x4c57a3(0x228)]&&_0x4107b0[_0x4c57a3(0x1cf)]==_0x2d76df[_0x4c57a3(0x1cf)]&&_0x4107b0['expiry_date']==_0x2d76df[_0x4c57a3(0x230)]&&_0x4107b0[_0x4c57a3(0x231)]==_0x2d76df['production_date']&&_0x4107b0[_0x4c57a3(0x181)]==_0x2d76df[_0x4c57a3(0x181)]&&_0x4107b0[_0x4c57a3(0x22e)]==_0x2d76df[_0x4c57a3(0x22e)]&&(_0x4107b0[_0x4c57a3(0x18f)]=_0x4107b0['product_stock']-_0x2d76df['adjust_qty']);else _0x2d76df[_0x4c57a3(0x222)]==_0x4c57a3(0x221)&&(_0x4107b0[_0x4c57a3(0x228)]==_0x2d76df[_0x4c57a3(0x228)]&&_0x4107b0[_0x4c57a3(0x1cf)]==_0x2d76df['bay']&&_0x4107b0[_0x4c57a3(0x230)]==_0x2d76df['expiry_date']&&_0x4107b0[_0x4c57a3(0x231)]==_0x2d76df[_0x4c57a3(0x231)]&&_0x4107b0[_0x4c57a3(0x181)]==_0x2d76df[_0x4c57a3(0x181)]&&_0x4107b0['invoice']==_0x2d76df[_0x4c57a3(0x22e)]&&(_0x4107b0[_0x4c57a3(0x18f)]=_0x4107b0[_0x4c57a3(0x18f)]+_0x2d76df[_0x4c57a3(0x234)]));});}return _0x7ff3e5;});Promise['all'](_0x4ea3d4)[_0x42ab91(0x216)](async _0xedf5e9=>{var _0x225f64=_0x42ab91;try{for(const _0xe15e84 of _0xedf5e9){await _0xe15e84[_0x225f64(0x1d3)]();}_0x2747f3[_0x225f64(0x1fc)]=_0x225f64(0x17f);const _0x25ff47=await _0x2747f3['save'](),_0x13cc7a=await master_shop['find'](),_0x457165=await email_settings[_0x225f64(0x1d0)](),_0x51d7e4=await supervisor_settings['find']();var _0x3e30ae=_0x2747f3[_0x225f64(0x18d)],_0x246c21='',_0x503b6a;for(_0x503b6a in _0x3e30ae){var _0x202eee='FG';_0x2747f3[_0x225f64(0x202)]==_0x225f64(0x18e)&&(_0x202eee='DG'),_0x246c21+='<tr>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e30ae[_0x503b6a][_0x225f64(0x228)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3e30ae[_0x503b6a][_0x225f64(0x23b)]+_0x225f64(0x191)+_0x225f64(0x243)+_0x3e30ae[_0x503b6a]['adjust_qty']+_0x225f64(0x191)+_0x225f64(0x243)+_0x3e30ae[_0x503b6a][_0x225f64(0x1af)]+_0x225f64(0x191)+_0x225f64(0x243)+_0x3e30ae[_0x503b6a][_0x225f64(0x1d6)]+_0x225f64(0x191)+_0x225f64(0x243)+_0x2747f3[_0x225f64(0x202)]+'</td>'+_0x225f64(0x243)+_0x3e30ae[_0x503b6a][_0x225f64(0x1ca)]+_0x225f64(0x191)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x202eee+_0x3e30ae[_0x503b6a][_0x225f64(0x1cf)]+_0x225f64(0x191)+_0x225f64(0x1e2);}let _0x55a58f=nodemailer[_0x225f64(0x1b6)]({'host':_0x457165[_0x225f64(0x217)],'port':Number(_0x457165['port']),'secure':![],'auth':{'user':_0x457165[_0x225f64(0x1bc)],'pass':_0x457165[_0x225f64(0x195)]}}),_0x399b5d={'from':_0x457165[_0x225f64(0x1bc)],'to':_0x51d7e4[0x0][_0x225f64(0x242)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x225f64(0x17d),'path':__dirname+'/../public'+_0x225f64(0x1c8)+_0x13cc7a[0x0][_0x225f64(0x19a)],'cid':_0x225f64(0x241)}],'html':_0x225f64(0x1e4)+_0x225f64(0x20b)+'</head><body>'+_0x225f64(0x1ec)+_0x225f64(0x21a)+'<div>'+_0x225f64(0x21c)+_0x225f64(0x198)+_0x225f64(0x1ec)+_0x225f64(0x203)+_0x13cc7a[0x0][_0x225f64(0x1ab)]+_0x225f64(0x17a)+_0x225f64(0x198)+_0x225f64(0x198)+_0x225f64(0x20a)+_0x225f64(0x1ec)+_0x225f64(0x1d5)+'\x20Order\x20Number\x20:\x20'+_0x2747f3[_0x225f64(0x22e)]+'\x20'+_0x225f64(0x1a0)+_0x225f64(0x218)+_0x2747f3['date']+'\x20'+_0x225f64(0x1a4)+_0x225f64(0x206)+_0x225f64(0x198)+_0x225f64(0x1ed)+_0x225f64(0x1ad)+_0x225f64(0x240)+_0x225f64(0x180)+_0x225f64(0x1df)+_0x225f64(0x1c7)+_0x225f64(0x208)+_0x225f64(0x183)+_0x225f64(0x209)+_0x225f64(0x17e)+_0x225f64(0x1ea)+_0x225f64(0x1e2)+_0x225f64(0x1ba)+_0x225f64(0x238)+'\x20'+_0x246c21+'\x20'+_0x225f64(0x1c4)+'</table>'+_0x225f64(0x1ec)+_0x225f64(0x1fa)+'<h5>'+_0x13cc7a[0x0][_0x225f64(0x1ab)]+_0x225f64(0x206)+_0x225f64(0x198)+_0x225f64(0x198)+_0x225f64(0x189)};_0x55a58f['sendMail'](_0x399b5d,function(_0x2f2f40,_0x53d3ec){var _0xc9564e=_0x225f64;_0x2f2f40?(console['log'](_0x2f2f40),console[_0xc9564e(0x227)](_0xc9564e(0x1a8))):console['log'](_0xc9564e(0x226));}),_0x1a98ca[_0x225f64(0x1fb)](_0x225f64(0x1d8),_0x225f64(0x193)),_0xbf54fb[_0x225f64(0x1da)]('/picking_list/PDF_adjustment/'+_0x25ff47[_0x225f64(0x1be)]);}catch(_0x5aa4d){console['error'](_0x5aa4d),_0xbf54fb[_0x225f64(0x18c)](0x1f4)[_0x225f64(0x232)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})['catch'](_0x96903f=>{var _0x267026=_0x42ab91;console[_0x267026(0x18b)](_0x96903f),_0xbf54fb[_0x267026(0x18c)](0x1f4)['json']({'error':_0x267026(0x184)});});}catch(_0x41497b){_0xbf54fb[_0x42ab91(0x232)]({'message':_0x41497b[_0x42ab91(0x23f)]});}}),router[a0_0x152a98(0x1f8)]('/view/:id',auth,async(_0x273e6f,_0x1ca4c6)=>{var _0x1731dc=a0_0x152a98;try{const {username:_0x430696,email:_0x5cca66,role:_0x5e083d}=_0x273e6f['user'],_0x4bd0a1=_0x273e6f[_0x1731dc(0x1bd)],_0xce8c08=await profile[_0x1731dc(0x1d0)]({'email':_0x4bd0a1[_0x1731dc(0x1bc)]}),_0x23265=await master_shop[_0x1731dc(0x188)]();console['log'](_0x1731dc(0x22b),_0x23265);const _0x4ee017=_0x273e6f[_0x1731dc(0x224)]['id'],_0x56fa09=await adjustment_finished[_0x1731dc(0x1ae)]({'_id':_0x4ee017});let _0x432669=new Date(_0x56fa09['expiry_date']),_0x3cf60f=('0'+_0x432669[_0x1731dc(0x213)]())[_0x1731dc(0x1b0)](-0x2),_0x42a4df=('0'+(_0x432669[_0x1731dc(0x1d9)]()+0x1))[_0x1731dc(0x1b0)](-0x2),_0x5bf771=_0x432669[_0x1731dc(0x190)](),_0x208c58=_0x5bf771+'-'+_0x42a4df+'-'+_0x3cf60f;var _0xdc2ffa=[_0x1731dc(0x1b2),_0x1731dc(0x1e3),'Return\x20Rooms'];const _0x396523=await purchases[_0x1731dc(0x1ee)]([{'$match':{'warehouse_name':_0x56fa09[_0x1731dc(0x202)]}},{'$unwind':_0x1731dc(0x19e)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0x396523);const _0x28aecf=await product[_0x1731dc(0x188)]({}),_0x1cd57c=await warehouse[_0x1731dc(0x1ee)]([{'$match':{'name':_0x56fa09[_0x1731dc(0x202)],'room':_0x56fa09['room']}},{'$unwind':_0x1731dc(0x23a)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1731dc(0x1bb)},'bay':{'$first':_0x1731dc(0x17b)},'bin':{'$first':_0x1731dc(0x1c2)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1731dc(0x1ce)},'primary_code':{'$first':_0x1731dc(0x225)},'secondary_code':{'$first':_0x1731dc(0x21e)},'product_code':{'$first':_0x1731dc(0x23e)},'storage':{'$first':_0x1731dc(0x1c0)},'rack':{'$first':_0x1731dc(0x201)}}}]);if(_0x23265[0x0][_0x1731dc(0x186)]=='English\x20(US)'){var _0x5c7b9b=users[_0x1731dc(0x1a7)];console[_0x1731dc(0x227)](_0x5c7b9b);}else{if(_0x23265[0x0][_0x1731dc(0x186)]==_0x1731dc(0x1a2))var _0x5c7b9b=users[_0x1731dc(0x1a2)];else{if(_0x23265[0x0][_0x1731dc(0x186)]==_0x1731dc(0x1dc))var _0x5c7b9b=users['German'];else{if(_0x23265[0x0][_0x1731dc(0x186)]==_0x1731dc(0x237))var _0x5c7b9b=users[_0x1731dc(0x237)];else{if(_0x23265[0x0][_0x1731dc(0x186)]==_0x1731dc(0x21b))var _0x5c7b9b=users[_0x1731dc(0x21b)];else{if(_0x23265[0x0][_0x1731dc(0x186)]==_0x1731dc(0x1f2))var _0x5c7b9b=users['Portuguese'];else{if(_0x23265[0x0]['language']==_0x1731dc(0x1f0))var _0x5c7b9b=users[_0x1731dc(0x1f0)];else{if(_0x23265[0x0][_0x1731dc(0x186)]==_0x1731dc(0x20c))var _0x5c7b9b=users[_0x1731dc(0x1cb)];}}}}}}}_0x1ca4c6[_0x1731dc(0x21d)](_0x1731dc(0x1cd),{'success':_0x273e6f[_0x1731dc(0x1fb)]('success'),'errors':_0x273e6f[_0x1731dc(0x1fb)](_0x1731dc(0x194)),'role':_0x4bd0a1,'profile':_0xce8c08,'adjustment':_0x56fa09,'stock':_0x1cd57c,'master_shop':_0x23265,'warehouse_name':_0x396523,'unit':_0x28aecf,'language':_0x5c7b9b,'rooms_data':_0xdc2ffa,'ed_fullDate':_0x208c58});}catch(_0x155e20){console[_0x1731dc(0x227)](_0x155e20),_0x1ca4c6[_0x1731dc(0x18c)](0xc8)['json']({'message':_0x155e20[_0x1731dc(0x23f)]});}}),router['post']('/view/:id',auth,async(_0x2239d7,_0x338a55)=>{var _0x191d16=a0_0x152a98;try{const _0x5ee4c3=_0x2239d7[_0x191d16(0x224)]['id'],_0x236666=await adjustment_finished[_0x191d16(0x1ae)]({'_id':_0x5ee4c3}),_0x4ef375=await warehouse['findOne']({'name':_0x236666[_0x191d16(0x202)],'room':_0x236666['room']}),{warehouse_name:_0x3fa02f,date:_0x369e9a,prod_name:_0x308ed1,level:_0x536947,isle:_0x2a8263,pallet:_0x304e27,stock:_0x514e13,types:_0x5c70f5,adjust_qty:_0x46dffa,new_adjust_qty:_0x41c279,note:_0xb52f69,Room_name:_0x4b0053,invoice:_0x2a88bc,JO_number:_0x5ea28f}=_0x2239d7[_0x191d16(0x1fe)];if(typeof _0x308ed1=='string')var _0x4fc2e0=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x244)]],_0x1664c0=[_0x2239d7[_0x191d16(0x1fe)]['level']],_0x5e1a5e=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x204)]],_0x2c0151=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x222)]],_0x5710b1=[_0x2239d7[_0x191d16(0x1fe)]['adjust_qty']],_0x46523c=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x1bf)]],_0x314e1d=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x1e5)]],_0x53aa19=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x1af)]],_0xf104f9=[_0x2239d7[_0x191d16(0x1fe)]['Secondary_units']],_0x25a10d=[_0x2239d7['body'][_0x191d16(0x181)]],_0x53a945=[_0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x230)]];else var _0x4fc2e0=[..._0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x244)]],_0x1664c0=[..._0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x1f1)]],_0x5e1a5e=[..._0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x204)]],_0x2c0151=[..._0x2239d7['body'][_0x191d16(0x222)]],_0x5710b1=[..._0x2239d7['body'][_0x191d16(0x234)]],_0x46523c=[..._0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x1bf)]],_0x314e1d=[..._0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x1e5)]],_0x53aa19=[..._0x2239d7['body'][_0x191d16(0x1af)]],_0xf104f9=[..._0x2239d7['body'][_0x191d16(0x1f6)]],_0x25a10d=[..._0x2239d7[_0x191d16(0x1fe)][_0x191d16(0x181)]],_0x53a945=[..._0x2239d7['body'][_0x191d16(0x230)]];const _0xe42431=_0x4fc2e0[_0x191d16(0x1e6)](_0x23abef=>{return _0x23abef={'product_name':_0x23abef};});_0x1664c0[_0x191d16(0x23d)]((_0x3b3b36,_0x57064b)=>{var _0x5b9cda=_0x191d16;_0xe42431[_0x57064b][_0x5b9cda(0x1cf)]=_0x3b3b36;}),_0x5e1a5e[_0x191d16(0x23d)]((_0x16c743,_0x18cb1a)=>{var _0x2d14ba=_0x191d16;_0xe42431[_0x18cb1a][_0x2d14ba(0x1d2)]=_0x16c743;}),_0x2c0151[_0x191d16(0x23d)]((_0x934d18,_0x8d13aa)=>{var _0x291354=_0x191d16;_0xe42431[_0x8d13aa][_0x291354(0x222)]=_0x934d18;}),_0x5710b1['forEach']((_0x5c0c09,_0x5be1b1)=>{var _0x37ae5b=_0x191d16;_0xe42431[_0x5be1b1][_0x37ae5b(0x234)]=_0x5c0c09;}),_0x46523c[_0x191d16(0x23d)]((_0x1b5a7a,_0x13988e)=>{var _0x591cca=_0x191d16;_0xe42431[_0x13988e][_0x591cca(0x1bf)]=_0x1b5a7a;}),_0x53aa19[_0x191d16(0x23d)]((_0x1949ea,_0x38fa15)=>{var _0x510cbc=_0x191d16;_0xe42431[_0x38fa15][_0x510cbc(0x1af)]=_0x1949ea;}),_0xf104f9[_0x191d16(0x23d)]((_0x3da46b,_0x1a0f02)=>{var _0x21135a=_0x191d16;_0xe42431[_0x1a0f02][_0x21135a(0x1d6)]=_0x3da46b;}),_0x314e1d[_0x191d16(0x23d)]((_0x467f1d,_0x5cb09c)=>{_0xe42431[_0x5cb09c]['product_code']=_0x467f1d;}),_0x25a10d[_0x191d16(0x23d)]((_0x39b687,_0x434e8d)=>{var _0x3a224a=_0x191d16;_0xe42431[_0x434e8d][_0x3a224a(0x181)]=_0x39b687;}),_0x53a945[_0x191d16(0x23d)]((_0x11ccad,_0x192430)=>{var _0x4b3233=_0x191d16;_0xe42431[_0x192430][_0x4b3233(0x230)]=_0x11ccad;});const _0x1cb084=_0xe42431['filter'](_0x4ae232=>_0x4ae232['adjust_qty']!=='0'&&_0x4ae232[_0x191d16(0x234)]!=='');var _0x8ced2=0x0;_0x1cb084[_0x191d16(0x23d)](_0x264a55=>{var _0x496a4a=_0x191d16;console[_0x496a4a(0x227)](_0x496a4a(0x229),_0x264a55),parseInt(_0x264a55[_0x496a4a(0x234)])<=0x0&&_0x8ced2++;});if(_0x8ced2!=0x0)return _0x2239d7['flash']('errors',_0x191d16(0x196)),_0x338a55[_0x191d16(0x1da)](_0x191d16(0x1db));_0x236666[_0x191d16(0x202)]=_0x3fa02f,_0x236666[_0x191d16(0x1b4)]=_0x369e9a,_0x236666[_0x191d16(0x18d)]=_0x1cb084,_0x236666['note']=_0xb52f69,_0x236666[_0x191d16(0x22d)]=_0x4b0053,_0x236666[_0x191d16(0x22e)]=_0x2a88bc,_0x236666[_0x191d16(0x23c)]=_0x5ea28f;const _0x400d10=await _0x236666[_0x191d16(0x1d3)](),_0x3a1fe8=await warehouse[_0x191d16(0x1d0)]({'name':_0x3fa02f,'room':_0x4b0053});_0x400d10[_0x191d16(0x18d)][_0x191d16(0x23d)](_0x19e750=>{var _0x5d3a4d=_0x191d16;const _0x20ceb8=_0x3a1fe8['product_details'][_0x5d3a4d(0x1e6)](_0x4eb4ae=>{var _0x11f100=_0x5d3a4d;_0x19e750[_0x11f100(0x222)]==_0x11f100(0x1e1)?_0x4eb4ae[_0x11f100(0x228)]==_0x19e750[_0x11f100(0x228)]&&_0x4eb4ae['bay']==_0x19e750[_0x11f100(0x1cf)]&&(_0x4eb4ae['product_stock']=parseInt(_0x4eb4ae[_0x11f100(0x18f)])-parseInt(_0x19e750[_0x11f100(0x234)])):_0x4eb4ae[_0x11f100(0x228)]==_0x19e750[_0x11f100(0x228)]&&_0x4eb4ae[_0x11f100(0x1cf)]==_0x19e750[_0x11f100(0x1cf)]&&(_0x4eb4ae[_0x11f100(0x18f)]=parseInt(_0x4eb4ae[_0x11f100(0x18f)])+parseInt(_0x19e750['adjust_qty']));});}),await _0x3a1fe8[_0x191d16(0x1d3)](),_0x2239d7[_0x191d16(0x1fb)](_0x191d16(0x1d8),_0x191d16(0x19d)),_0x338a55[_0x191d16(0x1da)]('/adjustment_finished/view');}catch(_0x3dd243){console['log'](_0x3dd243);}}),router['post'](a0_0x152a98(0x1b1),async(_0x54680f,_0x9bfb7c)=>{var _0x5c6106=a0_0x152a98;const {primary_code:_0x34419a,warehouse_data:_0xc583a2,rooms_data:_0x40ef8c,Roomslist:_0x58773a}=_0x54680f[_0x5c6106(0x1fe)],_0x2a5e7e=_0x58773a[_0x5c6106(0x1aa)](','),_0x5f172b=[];async function _0x17e845(_0x16a964){var _0x255a52=_0x5c6106;const _0x3041ab=await warehouse[_0x255a52(0x1ee)]([{'$match':{'name':_0xc583a2,'room':_0x16a964}},{'$unwind':_0x255a52(0x23a)},{'$match':{'product_details.primary_code':_0x34419a}},{'$group':{'_id':_0x255a52(0x1b3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x255a52(0x225)},'secondary_code':{'$first':_0x255a52(0x21e)},'product_code':{'$first':_0x255a52(0x23e)},'level':{'$first':_0x255a52(0x17b)},'isle':{'$first':_0x255a52(0x1c2)},'type':{'$first':_0x255a52(0x22c)},'pallet':{'$first':_0x255a52(0x1ce)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x255a52(0x1d4)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x255a52(0x201)},'expiry_date':{'$first':_0x255a52(0x199)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x255a52(0x22f)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x255a52(0x20d)},'roomNamed':{'$first':_0x255a52(0x1b7)},'invoice':{'$first':_0x255a52(0x1f7)}}}]),_0x133ebf=await warehouse[_0x255a52(0x1ee)]([{'$match':{'name':_0xc583a2,'room':_0x16a964}},{'$unwind':_0x255a52(0x23a)},{'$match':{'product_details.secondary_code':_0x34419a}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x255a52(0x1bb)},'primary_code':{'$first':_0x255a52(0x225)},'secondary_code':{'$first':_0x255a52(0x21e)},'product_code':{'$first':_0x255a52(0x23e)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x255a52(0x1c2)},'type':{'$first':_0x255a52(0x22c)},'pallet':{'$first':_0x255a52(0x1ce)},'unit':{'$first':_0x255a52(0x19f)},'secondary_unit':{'$first':_0x255a52(0x1d4)},'storage':{'$first':_0x255a52(0x1c0)},'rack':{'$first':_0x255a52(0x201)},'expiry_date':{'$first':_0x255a52(0x199)},'production_date':{'$first':_0x255a52(0x1f3)},'batch_code':{'$first':_0x255a52(0x22f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x255a52(0x20d)},'roomNamed':{'$first':_0x255a52(0x1b7)},'invoice':{'$first':_0x255a52(0x1f7)}}}]);if(_0x3041ab[_0x255a52(0x1e0)]>0x0)_0x5f172b['push'](_0x3041ab);else _0x133ebf['length']>0x0&&_0x5f172b['push'](_0x133ebf);}const _0x24ba3f=_0x2a5e7e['map'](_0x97b965=>_0x17e845(_0x97b965));await Promise[_0x5c6106(0x1a5)](_0x24ba3f),_0x9bfb7c[_0x5c6106(0x232)](_0x5f172b);}),router[a0_0x152a98(0x214)](a0_0x152a98(0x1eb),async(_0x5d15bd,_0x5aea7b)=>{var _0x90a2ba=a0_0x152a98;const {productCode:_0x18a594,bay:_0x3535b9,warehouses:_0x3936cb,room:_0x1695cf}=_0x5d15bd[_0x90a2ba(0x1fe)];console[_0x90a2ba(0x227)](_0x5d15bd[_0x90a2ba(0x1fe)]);try{const _0x3b977d=await warehouse['aggregate']([{'$match':{'name':_0x3936cb,'room':_0x1695cf}},{'$unwind':_0x90a2ba(0x23a)},{'$match':{'product_details.bay':parseInt(_0x3535b9)}},{'$group':{'_id':_0x90a2ba(0x1b3),'name':{'$first':_0x90a2ba(0x246)},'product_stock':{'$first':_0x90a2ba(0x1bb)},'bay':{'$first':_0x90a2ba(0x17b)},'maxProducts':{'$first':_0x90a2ba(0x211)}}}]);_0x5aea7b['status'](0xc8)[_0x90a2ba(0x232)](_0x3b977d);}catch(_0xa82b7e){_0x5aea7b[_0x90a2ba(0x18c)](0x194)[_0x90a2ba(0x232)]({'message':_0xa82b7e[_0x90a2ba(0x23f)]});}}),module[a0_0x152a98(0x179)]=router;