var a0_0x4aac29=a0_0x388d;function a0_0x388d(_0x50178d,_0x410bfc){var _0xbf93c8=a0_0xbf93();return a0_0x388d=function(_0x388d1c,_0x4eb2b9){_0x388d1c=_0x388d1c-0x6f;var _0x17ff7b=_0xbf93c8[_0x388d1c];return _0x17ff7b;},a0_0x388d(_0x50178d,_0x410bfc);}(function(_0x185235,_0x18f5f1){var _0x4d2824=a0_0x388d,_0x49a020=_0x185235();while(!![]){try{var _0x23876d=-parseInt(_0x4d2824(0x75))/0x1+-parseInt(_0x4d2824(0xa3))/0x2*(parseInt(_0x4d2824(0x12a))/0x3)+parseInt(_0x4d2824(0x10a))/0x4+parseInt(_0x4d2824(0xdc))/0x5*(-parseInt(_0x4d2824(0xc8))/0x6)+parseInt(_0x4d2824(0xfa))/0x7*(parseInt(_0x4d2824(0x96))/0x8)+-parseInt(_0x4d2824(0x115))/0x9+parseInt(_0x4d2824(0x9c))/0xa;if(_0x23876d===_0x18f5f1)break;else _0x49a020['push'](_0x49a020['shift']());}catch(_0x4a696e){_0x49a020['push'](_0x49a020['shift']());}}}(a0_0xbf93,0x7e98b));const express=require(a0_0x4aac29(0x7c)),app=express(),router=express[a0_0x4aac29(0x105)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x4aac29(0x133)),users=require(a0_0x4aac29(0xc6)),nodemailer=require(a0_0x4aac29(0xf8));router[a0_0x4aac29(0x119)](a0_0x4aac29(0xb4),auth,async(_0x6a3cbb,_0x54ff30)=>{var _0x12c69c=a0_0x4aac29;try{const {username:_0x5b424b,email:_0x29015b,role:_0x375c59}=_0x6a3cbb['user'],_0x4e3c9c=_0x6a3cbb[_0x12c69c(0xc7)],_0x1da247=await profile[_0x12c69c(0xa6)]({'email':_0x4e3c9c[_0x12c69c(0xeb)]}),_0x1e4c09=await master_shop[_0x12c69c(0xed)]();let _0x15831a;if(_0x4e3c9c['role']==_0x12c69c(0xb0)){const _0x14a89e=await staff[_0x12c69c(0xa6)]({'email':_0x4e3c9c[_0x12c69c(0xeb)]});_0x15831a=await warehouse[_0x12c69c(0xed)]({'status':'Enabled','name':_0x14a89e[_0x12c69c(0x9d)]});}else _0x15831a=await warehouse[_0x12c69c(0xed)]({'status':_0x12c69c(0x123)});const _0x2e3e96=await product[_0x12c69c(0xed)]();let _0x22d23a;if(_0x4e3c9c[_0x12c69c(0x124)]==_0x12c69c(0xb0)){const _0x3e5eff=await staff[_0x12c69c(0xa6)]({'email':_0x4e3c9c[_0x12c69c(0xeb)]});_0x22d23a=await adjustment_finished['find']({'warehouse_name':_0x3e5eff[_0x12c69c(0x9d)]});}else _0x22d23a=await adjustment_finished['aggregate']([{'$unwind':_0x12c69c(0xb7)},{'$group':{'_id':_0x12c69c(0xa2),'invoice':{'$first':_0x12c69c(0x11b)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x12c69c(0xe6)},'room':{'$addToSet':_0x12c69c(0x129)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1e4c09[0x0][_0x12c69c(0xf7)]==_0x12c69c(0xdf)){var _0x4c965a=users[_0x12c69c(0x101)];console['log'](_0x4c965a);}else{if(_0x1e4c09[0x0][_0x12c69c(0xf7)]==_0x12c69c(0xd1))var _0x4c965a=users[_0x12c69c(0xd1)];else{if(_0x1e4c09[0x0][_0x12c69c(0xf7)]==_0x12c69c(0xf0))var _0x4c965a=users[_0x12c69c(0xf0)];else{if(_0x1e4c09[0x0][_0x12c69c(0xf7)]==_0x12c69c(0xea))var _0x4c965a=users[_0x12c69c(0xea)];else{if(_0x1e4c09[0x0]['language']==_0x12c69c(0xa7))var _0x4c965a=users[_0x12c69c(0xa7)];else{if(_0x1e4c09[0x0][_0x12c69c(0xf7)]==_0x12c69c(0x8f))var _0x4c965a=users[_0x12c69c(0x130)];else{if(_0x1e4c09[0x0][_0x12c69c(0xf7)]==_0x12c69c(0x10c))var _0x4c965a=users['Chinese'];else{if(_0x1e4c09[0x0]['language']==_0x12c69c(0x7a))var _0x4c965a=users['Arabic'];}}}}}}}_0x54ff30[_0x12c69c(0x72)](_0x12c69c(0x73),{'success':_0x6a3cbb['flash'](_0x12c69c(0xcc)),'errors':_0x6a3cbb['flash'](_0x12c69c(0x111)),'role':_0x4e3c9c,'profile':_0x1da247,'warehouse':_0x15831a,'product':_0x2e3e96,'adjustment':_0x22d23a,'master_shop':_0x1e4c09,'language':_0x4c965a});}catch(_0xbb139e){console['log'](_0xbb139e);}});async function getRandom8DigitNumber(){var _0x3d50e9=a0_0x4aac29;const _0x91768b=0x989680,_0xf04fc6=0x5f5e0ff,_0x1f2d9c=Math['floor'](Math['random']()*(_0xf04fc6-_0x91768b+0x1))+_0x91768b;var _0x219efc;const _0x3aaac8=await adjustment_finished[_0x3d50e9(0xa6)]({'invoice':'ADJF-'+_0x1f2d9c});return _0x3aaac8&&_0x3aaac8[_0x3d50e9(0x85)]>0x0?_0x219efc=_0x3d50e9(0xc4)+_0x1f2d9c:_0x219efc=_0x3d50e9(0xc4)+_0x1f2d9c,_0x219efc;}function a0_0xbf93(){var _0xd6105b=['user','8670sxkMed','stock','An\x20error\x20occurred.','prod_invoice','success','$product_details.production_date','add','unit','/../public','Hindi','stockBefore','slice','message','logo','error','<h2>\x20','$product_details._id','product_name','$product_details.product_name','finalize','1205iDEmvP','$name','There\x27s\x20a\x20error\x20in\x20this\x20transaction','English\x20(US)','adjustment\x20data\x20update\x20successfully','forEach','$product_details.rack','padStart','Adjustment\x20Mail','Arabic','$warehouse_name','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.bin','$product_details.maxPerUnit','Spanish','email','then','find','production_date','$product_details.secondary_code','German','$product_details.storage','params','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','</table>','JO_number','language','nodemailer','json','7bWQpAs','invoice','/adjustment_finished/view','string','New_Qty_Converted','<div>','$product_details','English','/view/:id','host','log','Router','/preview/:id','$product_details.secondary_unit','</h5>','edit_adjustment_finished','1262476ghbHow','filter','Chinese','FGSEmail','<hr\x20class=\x22my-3\x22>','master','all','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','prod_code','<tbody\x20style=\x22text-align:\x20center;\x22>','7222248mVKDJA','split','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','room_names','get','level','$invoice','/adjustment_finished/preview/','<tr>','getMonth','warehouse_name','minus','back','site_title','Enabled','role','Return\x20Rooms','product_details','</div>','getDate','$product.room_names','51891PVQITc','$product_details.expiry_date','secondary_unit','_id','date','product_stock','Portuguese','$product_details.floorlevel','/picking_list/PDF_adjustment/','../models/all_models','<html><head><title></title>','<span\x20style=\x22float:\x20right;\x22>','product_date','render','adjustment_finished','True','718337BupqFh','Logo.png','aggregate','$room','status','Arabic\x20(ae)','</td>','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','add_adjustment_finished','flash','prod_name','/upload/','<table\x20style=\x22width:\x20100%\x20!important;\x22>','push','adjust_qty','length','prod_cat','/view/add_adjustment','toString','$product_details.product_stock','</thead>','</body></html>','$product_details.type','New_Qty_Converted_adj','Ambient','Portuguese\x20(BR)','QA\x20Warehouse','</tr>','adjustment\x20add\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','redirect','note','831808REZfrT','\x20Order\x20Number\x20:\x20','catch','body','An\x20error\x20occurred\x20while\x20saving\x20data.','save','22620470BzHrPc','warehouse','/barcode_scanner','$product_details.product_code','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<!DOCTYPE\x20html>','$_id','34rsrgtv','room','</tbody>','findOne','French','Secondary_units','$product_details.bay','map','bay','\x20Order\x20Date\x20:\x20','</head><body>','/CheckingWarehouse','expiry_date','staff','edit_adjustment_finished_view','$product_details.primary_code','Enclosed','/view','Finished\x20Goods','product','$product','$product_details.unit','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.batch_code','<strong>\x20Regards\x20</strong>','Email\x20sent\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','DRY\x20GOODS','new_adjust_qty','post','batch_code','sendMail','findById','ADJF-','types','../public/language/languages.json'];a0_0xbf93=function(){return _0xd6105b;};return a0_0xbf93();}router[a0_0x4aac29(0x119)](a0_0x4aac29(0x87),auth,async(_0x54ab7b,_0x1121f6)=>{var _0x580dd6=a0_0x4aac29;try{const {username:_0x413a41,email:_0x41b086,role:_0x52ccf1}=_0x54ab7b[_0x580dd6(0xc7)],_0x3ef69d=_0x54ab7b[_0x580dd6(0xc7)],_0x2bd725=await profile['findOne']({'email':_0x3ef69d[_0x580dd6(0xeb)]}),_0x4d3ecc=await master_shop[_0x580dd6(0xed)]();let _0x7c2e14;if(_0x3ef69d[_0x580dd6(0x124)]=='staff'){const _0x743b3c=await staff['findOne']({'email':_0x3ef69d[_0x580dd6(0xeb)]});_0x7c2e14=await warehouse['aggregate']([{'$match':{'status':_0x580dd6(0x123),'name':_0x743b3c[_0x580dd6(0x9d)],'warehouse_category':_0x580dd6(0xb5),'name':{'$ne':_0x580dd6(0x90)}}},{'$group':{'_id':_0x580dd6(0xdd),'name':{'$first':_0x580dd6(0xdd)}}}]);}else _0x7c2e14=await warehouse[_0x580dd6(0x77)]([{'$match':{'status':'Enabled','warehouse_category':_0x580dd6(0xb5),'name':{'$ne':_0x580dd6(0x90)}}},{'$group':{'_id':_0x580dd6(0xdd),'name':{'$first':'$name'}}}]);const _0x4d6a88=await product[_0x580dd6(0xed)]({}),_0x2d4ecb=await adjustment_finished['find']({}),_0x1f4dce=_0x2d4ecb[_0x580dd6(0x85)]+0x1,_0x2c83a5=_0x580dd6(0xc4)+_0x1f4dce[_0x580dd6(0x88)]()[_0x580dd6(0xe3)](0x5,'0');var _0xa3d856=[_0x580dd6(0x8e),_0x580dd6(0xb3),'Return\x20Rooms'];if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]=='English\x20(US)')var _0x56c671=users[_0x580dd6(0x101)];else{if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]==_0x580dd6(0xd1))var _0x56c671=users['Hindi'];else{if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]==_0x580dd6(0xf0))var _0x56c671=users[_0x580dd6(0xf0)];else{if(_0x4d3ecc[0x0]['language']==_0x580dd6(0xea))var _0x56c671=users[_0x580dd6(0xea)];else{if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]==_0x580dd6(0xa7))var _0x56c671=users[_0x580dd6(0xa7)];else{if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]==_0x580dd6(0x8f))var _0x56c671=users[_0x580dd6(0x130)];else{if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]==_0x580dd6(0x10c))var _0x56c671=users[_0x580dd6(0x10c)];else{if(_0x4d3ecc[0x0][_0x580dd6(0xf7)]==_0x580dd6(0x7a))var _0x56c671=users[_0x580dd6(0xe5)];}}}}}}}const _0x7c2230=getRandom8DigitNumber();_0x7c2230['then'](_0x3cbf8c=>{var _0x205457=_0x580dd6;_0x1121f6[_0x205457(0x72)](_0x205457(0x7e),{'success':_0x54ab7b[_0x205457(0x7f)](_0x205457(0xcc)),'errors':_0x54ab7b[_0x205457(0x7f)](_0x205457(0x111)),'role':_0x3ef69d,'profile':_0x2bd725,'warehouse':_0x7c2e14,'product':_0x4d6a88,'master_shop':_0x4d3ecc,'language':_0x56c671,'rooms_data':_0xa3d856,'invoice_no':_0x3cbf8c});})[_0x580dd6(0x98)](_0x22f85c=>{var _0x5966ab=_0x580dd6;_0x54ab7b[_0x5966ab(0x7f)](_0x5966ab(0x111),_0x5966ab(0xde)),_0x1121f6[_0x5966ab(0x94)]('/adjustment/view');});}catch(_0x4f41df){console[_0x580dd6(0x104)](_0x4f41df);}}),router['post'](a0_0x4aac29(0x87),auth,async(_0x457239,_0x1b03a7)=>{var _0x420ea1=a0_0x4aac29;try{const {warehouse_name:_0x4d29b7,date:_0x37317e,prod_name:_0x12e122,level:_0x54095b,isle:_0x22af8e,pallet:_0x36410b,stock:_0x41622b,types:_0x3ebdcc,adjust_qty:_0x341737,new_adjust_qty:_0x4db738,note:_0x5b0648,Room_name:_0x35313b,invoice:_0xa9731b,JO_number:_0x2acea7,expiry_date:_0x791e19}=_0x457239[_0x420ea1(0x99)];if(typeof _0x12e122==_0x420ea1(0xfd))var _0x4b4838=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0x80)]],_0x54664a=[_0x457239[_0x420ea1(0x99)]['level']],_0x7871a6=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0xc9)]],_0x42a17c=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0xc5)]],_0x4c8e52=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0x8d)]],_0x12a32e=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0xfe)]],_0x5ec8cf=[_0x457239[_0x420ea1(0x99)]['Primary_Units']],_0x2b4237=[_0x457239['body'][_0x420ea1(0xa8)]],_0x1a4580=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0x113)]],_0x19b656=[_0x457239['body']['batch_code']],_0x52f097=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0xaf)]],_0x41c5fb=[_0x457239['body']['product_date']],_0x34073c=[_0x457239['body'][_0x420ea1(0x86)]],_0x1616a9=[_0x457239[_0x420ea1(0x99)]['Rooms']],_0x24840b=[_0x457239[_0x420ea1(0x99)]['maxPerUnit']],_0x34fc36=[_0x457239[_0x420ea1(0x99)][_0x420ea1(0xcb)]];else var _0x4b4838=[..._0x457239['body'][_0x420ea1(0x80)]],_0x54664a=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0x11a)]],_0x7871a6=[..._0x457239[_0x420ea1(0x99)]['stock']],_0x42a17c=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0xc5)]],_0x4c8e52=[..._0x457239[_0x420ea1(0x99)]['New_Qty_Converted_adj']],_0x12a32e=[..._0x457239['body']['New_Qty_Converted']],_0x5ec8cf=[..._0x457239[_0x420ea1(0x99)]['Primary_Units']],_0x2b4237=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0xa8)]],_0x1a4580=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0x113)]],_0x19b656=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0xc1)]],_0x52f097=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0xaf)]],_0x41c5fb=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0x71)]],_0x34073c=[..._0x457239[_0x420ea1(0x99)][_0x420ea1(0x86)]],_0x1616a9=[..._0x457239[_0x420ea1(0x99)]['Rooms']],_0x24840b=[..._0x457239[_0x420ea1(0x99)]['maxPerUnit']],_0x34fc36=[..._0x457239['body'][_0x420ea1(0xcb)]];const _0x197c9a=_0x4b4838[_0x420ea1(0xaa)](_0x2fe841=>{return _0x2fe841={'product_name':_0x2fe841};});_0x54664a[_0x420ea1(0xe1)]((_0x21a316,_0x12b2af)=>{var _0x52d630=_0x420ea1;_0x197c9a[_0x12b2af][_0x52d630(0xab)]=_0x21a316;}),_0x7871a6[_0x420ea1(0xe1)]((_0x36e4e6,_0xfd68b4)=>{var _0xfaca37=_0x420ea1;_0x197c9a[_0xfd68b4][_0xfaca37(0xd2)]=_0x36e4e6;}),_0x42a17c[_0x420ea1(0xe1)]((_0x54f318,_0x592049)=>{var _0x40618e=_0x420ea1;_0x197c9a[_0x592049][_0x40618e(0xc5)]=_0x54f318;}),_0x4c8e52[_0x420ea1(0xe1)]((_0x4981e5,_0x27caf6)=>{_0x197c9a[_0x27caf6]['adjust_qty']=_0x4981e5;}),_0x12a32e['forEach']((_0x126f8f,_0x32f783)=>{var _0x2b5b88=_0x420ea1;_0x197c9a[_0x32f783][_0x2b5b88(0xbf)]=_0x126f8f;}),_0x5ec8cf[_0x420ea1(0xe1)]((_0x3c11c5,_0x30799f)=>{var _0x1f6ad1=_0x420ea1;_0x197c9a[_0x30799f][_0x1f6ad1(0xcf)]=_0x3c11c5;}),_0x2b4237['forEach']((_0x1c7b65,_0x3b7e6)=>{var _0x31a723=_0x420ea1;_0x197c9a[_0x3b7e6][_0x31a723(0x12c)]=_0x1c7b65;}),_0x1a4580[_0x420ea1(0xe1)]((_0x58714f,_0x1af272)=>{_0x197c9a[_0x1af272]['product_code']=_0x58714f;}),_0x19b656[_0x420ea1(0xe1)]((_0xbcf812,_0x18416c)=>{_0x197c9a[_0x18416c]['batch_code']=_0xbcf812;}),_0x52f097[_0x420ea1(0xe1)]((_0x551136,_0x18b477)=>{var _0x28b455=_0x420ea1;_0x197c9a[_0x18b477][_0x28b455(0xaf)]=_0x551136;}),_0x41c5fb['forEach']((_0x30faf1,_0x51ebbc)=>{var _0x1b8410=_0x420ea1;_0x197c9a[_0x51ebbc][_0x1b8410(0xee)]=_0x30faf1;}),_0x34073c[_0x420ea1(0xe1)]((_0x4eb8d2,_0x505461)=>{_0x197c9a[_0x505461]['prod_cat']=_0x4eb8d2;}),_0x1616a9[_0x420ea1(0xe1)]((_0x4e6317,_0x155cfa)=>{var _0x5deddb=_0x420ea1;_0x197c9a[_0x155cfa][_0x5deddb(0x118)]=_0x4e6317;}),_0x24840b[_0x420ea1(0xe1)]((_0x394b02,_0x190d3c)=>{_0x197c9a[_0x190d3c]['maxPerUnit']=_0x394b02;}),_0x34fc36['forEach']((_0x5c9e42,_0x406535)=>{var _0x2a380b=_0x420ea1;_0x197c9a[_0x406535][_0x2a380b(0xfb)]=_0x5c9e42;});const _0x37dd69=_0x197c9a[_0x420ea1(0x10b)](_0xcc259b=>_0xcc259b[_0x420ea1(0x84)]!=='0'&&_0xcc259b[_0x420ea1(0x84)]!=='');var _0x17cffd=0x0;_0x37dd69[_0x420ea1(0xe1)](_0x3d1417=>{var _0x3fbdff=_0x420ea1;console[_0x3fbdff(0x104)]('foreach\x20newproduct',_0x3d1417),parseInt(_0x3d1417['adjust_qty'])<=0x0&&_0x17cffd++;});if(_0x17cffd!=0x0)return _0x457239[_0x420ea1(0x7f)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x1b03a7[_0x420ea1(0x94)](_0x420ea1(0x121));const _0x41cfd9=new adjustment_finished({'warehouse_name':_0x4d29b7,'date':_0x37317e,'product':_0x37dd69,'note':_0x5b0648,'room':_0x35313b,'invoice':_0xa9731b,'JO_number':_0x2acea7,'expiry_date':_0x791e19}),_0x3c18a2=await _0x41cfd9[_0x420ea1(0x9b)]();_0x457239[_0x420ea1(0x7f)]('success',_0x420ea1(0x92)),_0x1b03a7[_0x420ea1(0x94)](_0x420ea1(0x11c)+_0x3c18a2[_0x420ea1(0x12d)]);}catch(_0x1fbe12){console[_0x420ea1(0x104)](_0x1fbe12),_0x1b03a7[_0x420ea1(0x79)](0xc8)[_0x420ea1(0xf9)]({'message':_0x1fbe12[_0x420ea1(0xd4)]});}}),router[a0_0x4aac29(0x119)](a0_0x4aac29(0x106),auth,async(_0x1a4e1a,_0x3fc419)=>{var _0x3b32cd=a0_0x4aac29;try{const {username:_0xd32854,email:_0x1577da,role:_0x34466a}=_0x1a4e1a[_0x3b32cd(0xc7)],_0x1902b8=_0x1a4e1a[_0x3b32cd(0xc7)],_0x4164dd=await profile[_0x3b32cd(0xa6)]({'email':_0x1902b8[_0x3b32cd(0xeb)]}),_0x150649=await master_shop[_0x3b32cd(0xed)](),_0x14fd7f=_0x1a4e1a['params']['id'],_0x514a4a=await adjustment_finished['findById']({'_id':_0x14fd7f}),_0xadff0f=await purchases[_0x3b32cd(0x77)]([{'$match':{'warehouse_name':_0x514a4a[_0x3b32cd(0x11f)]}},{'$unwind':_0x3b32cd(0xb7)},{'$group':{'_id':'$product.product_name'}}]);console['log']('purchases_data',_0xadff0f);const _0x2c57cd=await product[_0x3b32cd(0xed)]({}),_0x2a9dc9=await warehouse[_0x3b32cd(0x77)]([{'$match':{'name':_0x514a4a[_0x3b32cd(0x11f)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x3b32cd(0x100)},{'$group':{'_id':_0x3b32cd(0xd8),'name':{'$first':_0x3b32cd(0xda)},'product_stock':{'$first':_0x3b32cd(0x89)},'bay':{'$first':_0x3b32cd(0xa9)},'bin':{'$first':_0x3b32cd(0xe8)},'type':{'$first':_0x3b32cd(0x8c)},'floorlevel':{'$first':_0x3b32cd(0x131)},'primary_code':{'$first':_0x3b32cd(0xb2)},'secondary_code':{'$first':_0x3b32cd(0xef)},'product_code':{'$first':_0x3b32cd(0x9f)},'storage':{'$first':_0x3b32cd(0xf1)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3b32cd(0xcd)},'batch_code':{'$first':_0x3b32cd(0xba)},'maxPerUnit':{'$first':_0x3b32cd(0xe9)},'room':{'$first':_0x3b32cd(0x78)}}}]);if(_0x150649[0x0][_0x3b32cd(0xf7)]==_0x3b32cd(0xdf)){var _0x5ce18e=users['English'];console[_0x3b32cd(0x104)](_0x5ce18e);}else{if(_0x150649[0x0]['language']==_0x3b32cd(0xd1))var _0x5ce18e=users['Hindi'];else{if(_0x150649[0x0][_0x3b32cd(0xf7)]==_0x3b32cd(0xf0))var _0x5ce18e=users['German'];else{if(_0x150649[0x0][_0x3b32cd(0xf7)]==_0x3b32cd(0xea))var _0x5ce18e=users[_0x3b32cd(0xea)];else{if(_0x150649[0x0][_0x3b32cd(0xf7)]==_0x3b32cd(0xa7))var _0x5ce18e=users['French'];else{if(_0x150649[0x0][_0x3b32cd(0xf7)]==_0x3b32cd(0x8f))var _0x5ce18e=users[_0x3b32cd(0x130)];else{if(_0x150649[0x0]['language']==_0x3b32cd(0x10c))var _0x5ce18e=users[_0x3b32cd(0x10c)];else{if(_0x150649[0x0]['language']==_0x3b32cd(0x7a))var _0x5ce18e=users['Arabic'];}}}}}}}_0x3fc419[_0x3b32cd(0x72)](_0x3b32cd(0xb1),{'success':_0x1a4e1a[_0x3b32cd(0x7f)]('success'),'errors':_0x1a4e1a[_0x3b32cd(0x7f)](_0x3b32cd(0x111)),'role':_0x1902b8,'profile':_0x4164dd,'adjustment':_0x514a4a,'stock':_0x2a9dc9,'master_shop':_0x150649,'warehouse_name':_0xadff0f,'unit':_0x2c57cd,'language':_0x5ce18e});}catch(_0x3345c5){console[_0x3b32cd(0x104)](_0x3345c5),_0x3fc419[_0x3b32cd(0x79)](0xc8)[_0x3b32cd(0xf9)]({'message':_0x3345c5['message']});}}),router[a0_0x4aac29(0xc0)](a0_0x4aac29(0x106),auth,async(_0x2f256a,_0x1606c8)=>{var _0x1e112a=a0_0x4aac29;try{const {invoice:_0x5a2aa7,warehouse_name:_0x2cc17b,Room_name:_0x257b8d}=_0x2f256a[_0x1e112a(0x99)],_0x14e222=_0x2f256a[_0x1e112a(0xf2)]['id'],_0x1a0e44=await adjustment_finished['findById']({'_id':_0x14e222});var _0x524d6d;const _0x385a17=_0x1a0e44[_0x1e112a(0xb6)][_0x1e112a(0xaa)](async _0x5a4a3b=>{var _0x4aa030=_0x1e112a;if(_0x5a4a3b[_0x4aa030(0x84)]>0x0){_0x524d6d=await warehouse[_0x4aa030(0xa6)]({'name':_0x2cc17b,'room':_0x5a4a3b[_0x4aa030(0x118)],'warehouse_category':_0x4aa030(0xb5)});const _0xcd5276=_0x524d6d[_0x4aa030(0x126)][_0x4aa030(0xaa)](_0x383874=>{var _0x3fbe3f=_0x4aa030;console['log'](_0x5a4a3b[_0x3fbe3f(0xc5)]);if(_0x5a4a3b['types']==_0x3fbe3f(0x120))_0x383874['product_name']==_0x5a4a3b[_0x3fbe3f(0xd9)]&&_0x383874['bay']==_0x5a4a3b[_0x3fbe3f(0xab)]&&_0x383874['expiry_date']==_0x5a4a3b[_0x3fbe3f(0xaf)]&&_0x383874['production_date']==_0x5a4a3b[_0x3fbe3f(0xee)]&&_0x383874['batch_code']==_0x5a4a3b['batch_code']&&_0x383874['invoice']==_0x5a4a3b['invoice']&&(_0x383874[_0x3fbe3f(0x12f)]=_0x383874[_0x3fbe3f(0x12f)]-_0x5a4a3b[_0x3fbe3f(0x84)]);else _0x5a4a3b[_0x3fbe3f(0xc5)]==_0x3fbe3f(0xce)&&(_0x383874['product_name']==_0x5a4a3b[_0x3fbe3f(0xd9)]&&_0x383874[_0x3fbe3f(0xab)]==_0x5a4a3b[_0x3fbe3f(0xab)]&&_0x383874[_0x3fbe3f(0xaf)]==_0x5a4a3b[_0x3fbe3f(0xaf)]&&_0x383874[_0x3fbe3f(0xee)]==_0x5a4a3b[_0x3fbe3f(0xee)]&&_0x383874[_0x3fbe3f(0xc1)]==_0x5a4a3b[_0x3fbe3f(0xc1)]&&_0x383874['invoice']==_0x5a4a3b['invoice']&&(_0x383874[_0x3fbe3f(0x12f)]=_0x383874[_0x3fbe3f(0x12f)]+_0x5a4a3b[_0x3fbe3f(0x84)]));});}return _0x524d6d;});Promise['all'](_0x385a17)[_0x1e112a(0xec)](async _0x353742=>{var _0x35fb1f=_0x1e112a;try{for(const _0x303191 of _0x353742){await _0x303191['save']();}_0x1a0e44[_0x35fb1f(0xdb)]=_0x35fb1f(0x74);const _0x3ddf1e=await _0x1a0e44[_0x35fb1f(0x9b)](),_0x22c92a=await master_shop['find'](),_0x120388=await email_settings[_0x35fb1f(0xa6)](),_0x5d5285=await supervisor_settings[_0x35fb1f(0xed)]();var _0x268834=_0x1a0e44[_0x35fb1f(0xb6)],_0x21afab='',_0x429bdb;for(_0x429bdb in _0x268834){var _0x43882b='FG';_0x1a0e44[_0x35fb1f(0x11f)]==_0x35fb1f(0xbe)&&(_0x43882b='DG'),_0x21afab+=_0x35fb1f(0x11d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x268834[_0x429bdb]['product_name']+_0x35fb1f(0x7b)+_0x35fb1f(0xa0)+_0x268834[_0x429bdb]['product_code']+_0x35fb1f(0x7b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x268834[_0x429bdb]['adjust_qty']+'</td>'+_0x35fb1f(0xa0)+_0x268834[_0x429bdb][_0x35fb1f(0xcf)]+'</td>'+_0x35fb1f(0xa0)+_0x268834[_0x429bdb][_0x35fb1f(0x12c)]+_0x35fb1f(0x7b)+_0x35fb1f(0xa0)+_0x1a0e44[_0x35fb1f(0x11f)]+_0x35fb1f(0x7b)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x268834[_0x429bdb][_0x35fb1f(0x118)]+_0x35fb1f(0x7b)+_0x35fb1f(0xa0)+_0x43882b+_0x268834[_0x429bdb][_0x35fb1f(0xab)]+_0x35fb1f(0x7b)+_0x35fb1f(0x91);}let _0x35a708=nodemailer['createTransport']({'host':_0x120388[_0x35fb1f(0x103)],'port':Number(_0x120388['port']),'secure':![],'auth':{'user':_0x120388[_0x35fb1f(0xeb)],'pass':_0x120388['password']}}),_0x32dc71={'from':_0x120388[_0x35fb1f(0xeb)],'to':_0x5d5285[0x0][_0x35fb1f(0x10d)],'subject':_0x35fb1f(0xe4),'attachments':[{'filename':_0x35fb1f(0x76),'path':__dirname+_0x35fb1f(0xd0)+_0x35fb1f(0x81)+_0x22c92a[0x0][_0x35fb1f(0xf3)],'cid':_0x35fb1f(0xd5)}],'html':_0x35fb1f(0xa1)+_0x35fb1f(0x6f)+_0x35fb1f(0xad)+_0x35fb1f(0xff)+_0x35fb1f(0xe7)+_0x35fb1f(0xff)+_0x35fb1f(0x93)+_0x35fb1f(0x127)+_0x35fb1f(0xff)+_0x35fb1f(0xd7)+_0x22c92a[0x0][_0x35fb1f(0x122)]+'\x20</h2>'+'</div>'+'</div>'+_0x35fb1f(0x10e)+_0x35fb1f(0xff)+_0x35fb1f(0xb9)+_0x35fb1f(0x97)+_0x1a0e44[_0x35fb1f(0xfb)]+'\x20'+_0x35fb1f(0x70)+_0x35fb1f(0xac)+_0x1a0e44['date']+'\x20'+'</span>'+'</h5>'+_0x35fb1f(0x127)+_0x35fb1f(0x82)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x35fb1f(0x11d)+_0x35fb1f(0xbd)+_0x35fb1f(0x112)+_0x35fb1f(0xf4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x35fb1f(0x117)+_0x35fb1f(0x7d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x35fb1f(0x91)+_0x35fb1f(0x8a)+_0x35fb1f(0x114)+'\x20'+_0x21afab+'\x20'+_0x35fb1f(0xa5)+_0x35fb1f(0xf5)+'<div>'+_0x35fb1f(0xbb)+'<h5>'+_0x22c92a[0x0][_0x35fb1f(0x122)]+_0x35fb1f(0x108)+_0x35fb1f(0x127)+'</div>'+_0x35fb1f(0x8b)};_0x35a708[_0x35fb1f(0xc2)](_0x32dc71,function(_0x18a0ca,_0x48ecba){var _0x175a51=_0x35fb1f;_0x18a0ca?(console[_0x175a51(0x104)](_0x18a0ca),console[_0x175a51(0x104)]('Error\x20Occurs')):console[_0x175a51(0x104)](_0x175a51(0xbc));}),_0x2f256a['flash']('success','Adjustment\x20Finalize\x20Successfully'),_0x1606c8['redirect'](_0x35fb1f(0x132)+_0x3ddf1e[_0x35fb1f(0x12d)]);}catch(_0x15c1be){console[_0x35fb1f(0xd6)](_0x15c1be),_0x1606c8[_0x35fb1f(0x79)](0x1f4)[_0x35fb1f(0xf9)]({'error':_0x35fb1f(0x9a)});}})[_0x1e112a(0x98)](_0x2523f2=>{var _0x24bcba=_0x1e112a;console[_0x24bcba(0xd6)](_0x2523f2),_0x1606c8[_0x24bcba(0x79)](0x1f4)[_0x24bcba(0xf9)]({'error':_0x24bcba(0xca)});});}catch(_0x2d0dbd){_0x1606c8[_0x1e112a(0xf9)]({'message':_0x2d0dbd[_0x1e112a(0xd4)]});}}),router[a0_0x4aac29(0x119)]('/view/:id',auth,async(_0x2029f6,_0xca1784)=>{var _0x5de4d0=a0_0x4aac29;try{const {username:_0x3996b9,email:_0x25a366,role:_0x14e3c0}=_0x2029f6[_0x5de4d0(0xc7)],_0x369a5d=_0x2029f6[_0x5de4d0(0xc7)],_0x1fa40e=await profile[_0x5de4d0(0xa6)]({'email':_0x369a5d['email']}),_0x38cdb5=await master_shop[_0x5de4d0(0xed)]();console[_0x5de4d0(0x104)](_0x5de4d0(0x10f),_0x38cdb5);const _0x2d8f46=_0x2029f6[_0x5de4d0(0xf2)]['id'],_0x344250=await adjustment_finished[_0x5de4d0(0xc3)]({'_id':_0x2d8f46});let _0x2099e8=new Date(_0x344250['expiry_date']),_0x46e652=('0'+_0x2099e8[_0x5de4d0(0x128)]())[_0x5de4d0(0xd3)](-0x2),_0x43b956=('0'+(_0x2099e8[_0x5de4d0(0x11e)]()+0x1))['slice'](-0x2),_0x8a5cea=_0x2099e8['getFullYear'](),_0x407c08=_0x8a5cea+'-'+_0x43b956+'-'+_0x46e652;var _0x3e5ed9=[_0x5de4d0(0x8e),_0x5de4d0(0xb3),_0x5de4d0(0x125)];const _0x446b05=await purchases[_0x5de4d0(0x77)]([{'$match':{'warehouse_name':_0x344250[_0x5de4d0(0x11f)]}},{'$unwind':_0x5de4d0(0xb7)},{'$group':{'_id':'$product.product_name'}}]);console[_0x5de4d0(0x104)]('purchases_data',_0x446b05);const _0x3f957f=await product[_0x5de4d0(0xed)]({}),_0x597ac7=await warehouse[_0x5de4d0(0x77)]([{'$match':{'name':_0x344250[_0x5de4d0(0x11f)],'room':_0x344250['room']}},{'$unwind':_0x5de4d0(0x100)},{'$group':{'_id':_0x5de4d0(0xd8),'name':{'$first':_0x5de4d0(0xda)},'product_stock':{'$first':_0x5de4d0(0x89)},'bay':{'$first':_0x5de4d0(0xa9)},'bin':{'$first':_0x5de4d0(0xe8)},'type':{'$first':_0x5de4d0(0x8c)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5de4d0(0xb2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x5de4d0(0x9f)},'storage':{'$first':_0x5de4d0(0xf1)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0xdf)){var _0x229f48=users[_0x5de4d0(0x101)];console[_0x5de4d0(0x104)](_0x229f48);}else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0xd1))var _0x229f48=users[_0x5de4d0(0xd1)];else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0xf0))var _0x229f48=users[_0x5de4d0(0xf0)];else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0xea))var _0x229f48=users[_0x5de4d0(0xea)];else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0xa7))var _0x229f48=users[_0x5de4d0(0xa7)];else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0x8f))var _0x229f48=users[_0x5de4d0(0x130)];else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]==_0x5de4d0(0x10c))var _0x229f48=users[_0x5de4d0(0x10c)];else{if(_0x38cdb5[0x0][_0x5de4d0(0xf7)]=='Arabic\x20(ae)')var _0x229f48=users['Arabic'];}}}}}}}_0xca1784[_0x5de4d0(0x72)](_0x5de4d0(0x109),{'success':_0x2029f6[_0x5de4d0(0x7f)](_0x5de4d0(0xcc)),'errors':_0x2029f6[_0x5de4d0(0x7f)]('errors'),'role':_0x369a5d,'profile':_0x1fa40e,'adjustment':_0x344250,'stock':_0x597ac7,'master_shop':_0x38cdb5,'warehouse_name':_0x446b05,'unit':_0x3f957f,'language':_0x229f48,'rooms_data':_0x3e5ed9,'ed_fullDate':_0x407c08});}catch(_0x200c42){console[_0x5de4d0(0x104)](_0x200c42),_0xca1784[_0x5de4d0(0x79)](0xc8)[_0x5de4d0(0xf9)]({'message':_0x200c42[_0x5de4d0(0xd4)]});}}),router[a0_0x4aac29(0xc0)](a0_0x4aac29(0x102),auth,async(_0x4c33fe,_0x7fef78)=>{var _0x44b08d=a0_0x4aac29;try{const _0x23000d=_0x4c33fe[_0x44b08d(0xf2)]['id'],_0x5804cd=await adjustment_finished[_0x44b08d(0xc3)]({'_id':_0x23000d}),_0x219035=await warehouse[_0x44b08d(0xa6)]({'name':_0x5804cd[_0x44b08d(0x11f)],'room':_0x5804cd[_0x44b08d(0xa4)]}),{warehouse_name:_0x43150a,date:_0x472025,prod_name:_0x4510a3,level:_0x1aef1e,isle:_0x4c2d12,pallet:_0x2d822e,stock:_0x1a2fee,types:_0x296aa5,adjust_qty:_0x148576,new_adjust_qty:_0x78c978,note:_0x37141b,Room_name:_0x10ef25,invoice:_0x4b1470,JO_number:_0x3e2571}=_0x4c33fe[_0x44b08d(0x99)];if(typeof _0x4510a3=='string')var _0x51acac=[_0x4c33fe[_0x44b08d(0x99)]['prod_name']],_0x2507f0=[_0x4c33fe[_0x44b08d(0x99)]['level']],_0x5f0524=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xc9)]],_0x53f1d3=[_0x4c33fe['body'][_0x44b08d(0xc5)]],_0x3b5c06=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0x84)]],_0x10b123=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xbf)]],_0x4d0c66=[_0x4c33fe[_0x44b08d(0x99)]['prod_code']],_0x191f5d=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xcf)]],_0x299a50=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xa8)]],_0x16efa6=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xc1)]],_0x1530d2=[_0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xaf)]];else var _0x51acac=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0x80)]],_0x2507f0=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0x11a)]],_0x5f0524=[..._0x4c33fe[_0x44b08d(0x99)]['stock']],_0x53f1d3=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xc5)]],_0x3b5c06=[..._0x4c33fe['body'][_0x44b08d(0x84)]],_0x10b123=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xbf)]],_0x4d0c66=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0x113)]],_0x191f5d=[..._0x4c33fe['body'][_0x44b08d(0xcf)]],_0x299a50=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xa8)]],_0x16efa6=[..._0x4c33fe[_0x44b08d(0x99)][_0x44b08d(0xc1)]],_0x1530d2=[..._0x4c33fe[_0x44b08d(0x99)]['expiry_date']];const _0x353a6e=_0x51acac[_0x44b08d(0xaa)](_0x2d047c=>{return _0x2d047c={'product_name':_0x2d047c};});_0x2507f0[_0x44b08d(0xe1)]((_0x272559,_0x4b047b)=>{var _0x2c41ea=_0x44b08d;_0x353a6e[_0x4b047b][_0x2c41ea(0xab)]=_0x272559;}),_0x5f0524['forEach']((_0x520179,_0x1f7cbf)=>{var _0x13e3d7=_0x44b08d;_0x353a6e[_0x1f7cbf][_0x13e3d7(0xd2)]=_0x520179;}),_0x53f1d3[_0x44b08d(0xe1)]((_0x86f7dd,_0x5928cb)=>{_0x353a6e[_0x5928cb]['types']=_0x86f7dd;}),_0x3b5c06['forEach']((_0x5a503b,_0x3212b9)=>{_0x353a6e[_0x3212b9]['adjust_qty']=_0x5a503b;}),_0x10b123['forEach']((_0x145436,_0x2484d8)=>{_0x353a6e[_0x2484d8]['new_adjust_qty']=_0x145436;}),_0x191f5d['forEach']((_0x2bce65,_0xccb489)=>{_0x353a6e[_0xccb489]['unit']=_0x2bce65;}),_0x299a50[_0x44b08d(0xe1)]((_0x3ad843,_0x5827e0)=>{var _0x2d5359=_0x44b08d;_0x353a6e[_0x5827e0][_0x2d5359(0x12c)]=_0x3ad843;}),_0x4d0c66[_0x44b08d(0xe1)]((_0x1a1c44,_0x53d02a)=>{_0x353a6e[_0x53d02a]['product_code']=_0x1a1c44;}),_0x16efa6[_0x44b08d(0xe1)]((_0x17e403,_0x1df920)=>{var _0xb181ea=_0x44b08d;_0x353a6e[_0x1df920][_0xb181ea(0xc1)]=_0x17e403;}),_0x1530d2[_0x44b08d(0xe1)]((_0x212c9f,_0x4f925e)=>{_0x353a6e[_0x4f925e]['expiry_date']=_0x212c9f;});const _0x546e13=_0x353a6e[_0x44b08d(0x10b)](_0x2b557f=>_0x2b557f['adjust_qty']!=='0'&&_0x2b557f['adjust_qty']!=='');var _0x1ad0a0=0x0;_0x546e13[_0x44b08d(0xe1)](_0x483511=>{var _0xf38c22=_0x44b08d;console['log']('foreach\x20newproduct',_0x483511),parseInt(_0x483511[_0xf38c22(0x84)])<=0x0&&_0x1ad0a0++;});if(_0x1ad0a0!=0x0)return _0x4c33fe['flash'](_0x44b08d(0x111),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x7fef78[_0x44b08d(0x94)](_0x44b08d(0x121));_0x5804cd['warehouse_name']=_0x43150a,_0x5804cd[_0x44b08d(0x12e)]=_0x472025,_0x5804cd[_0x44b08d(0xb6)]=_0x546e13,_0x5804cd[_0x44b08d(0x95)]=_0x37141b,_0x5804cd['room']=_0x10ef25,_0x5804cd[_0x44b08d(0xfb)]=_0x4b1470,_0x5804cd[_0x44b08d(0xf6)]=_0x3e2571;const _0x2f2f6c=await _0x5804cd[_0x44b08d(0x9b)](),_0x275667=await warehouse[_0x44b08d(0xa6)]({'name':_0x43150a,'room':_0x10ef25});_0x2f2f6c['product'][_0x44b08d(0xe1)](_0x1d1156=>{var _0x59a32b=_0x44b08d;const _0x455ade=_0x275667[_0x59a32b(0x126)][_0x59a32b(0xaa)](_0x4e77a8=>{var _0x50d231=_0x59a32b;_0x1d1156['types']==_0x50d231(0x120)?_0x4e77a8[_0x50d231(0xd9)]==_0x1d1156[_0x50d231(0xd9)]&&_0x4e77a8['bay']==_0x1d1156[_0x50d231(0xab)]&&(_0x4e77a8[_0x50d231(0x12f)]=parseInt(_0x4e77a8[_0x50d231(0x12f)])-parseInt(_0x1d1156['adjust_qty'])):_0x4e77a8['product_name']==_0x1d1156['product_name']&&_0x4e77a8[_0x50d231(0xab)]==_0x1d1156['bay']&&(_0x4e77a8[_0x50d231(0x12f)]=parseInt(_0x4e77a8['product_stock'])+parseInt(_0x1d1156[_0x50d231(0x84)]));});}),await _0x275667[_0x44b08d(0x9b)](),_0x4c33fe['flash'](_0x44b08d(0xcc),_0x44b08d(0xe0)),_0x7fef78['redirect'](_0x44b08d(0xfc));}catch(_0x2fb29b){console[_0x44b08d(0x104)](_0x2fb29b);}}),router[a0_0x4aac29(0xc0)](a0_0x4aac29(0x9e),async(_0x22220f,_0xa65150)=>{var _0xb0dbce=a0_0x4aac29;const {primary_code:_0x4f3207,warehouse_data:_0x446d10,rooms_data:_0x1a1e09,Roomslist:_0x34819d}=_0x22220f[_0xb0dbce(0x99)],_0x47c0e9=_0x34819d[_0xb0dbce(0x116)](','),_0x52ae51=[];async function _0x303209(_0x542f70){var _0x53d34d=_0xb0dbce;const _0x2fc1ec=await warehouse['aggregate']([{'$match':{'name':_0x446d10,'room':_0x542f70}},{'$unwind':_0x53d34d(0x100)},{'$match':{'product_details.primary_code':_0x4f3207}},{'$group':{'_id':_0x53d34d(0xd8),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x53d34d(0xb2)},'secondary_code':{'$first':_0x53d34d(0xef)},'product_code':{'$first':_0x53d34d(0x9f)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x53d34d(0xe8)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x53d34d(0xb8)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x53d34d(0xf1)},'rack':{'$first':_0x53d34d(0xe2)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x53d34d(0xba)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x53d34d(0xe9)},'roomNamed':{'$first':_0x53d34d(0x78)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x3949a1=await warehouse[_0x53d34d(0x77)]([{'$match':{'name':_0x446d10,'room':_0x542f70}},{'$unwind':_0x53d34d(0x100)},{'$match':{'product_details.secondary_code':_0x4f3207}},{'$group':{'_id':_0x53d34d(0xd8),'name':{'$first':_0x53d34d(0xda)},'product_stock':{'$first':_0x53d34d(0x89)},'primary_code':{'$first':_0x53d34d(0xb2)},'secondary_code':{'$first':_0x53d34d(0xef)},'product_code':{'$first':_0x53d34d(0x9f)},'level':{'$first':_0x53d34d(0xa9)},'isle':{'$first':_0x53d34d(0xe8)},'type':{'$first':_0x53d34d(0x8c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x53d34d(0x107)},'storage':{'$first':_0x53d34d(0xf1)},'rack':{'$first':_0x53d34d(0xe2)},'expiry_date':{'$first':_0x53d34d(0x12b)},'production_date':{'$first':_0x53d34d(0xcd)},'batch_code':{'$first':_0x53d34d(0xba)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x53d34d(0xe9)},'roomNamed':{'$first':_0x53d34d(0x78)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x2fc1ec[_0x53d34d(0x85)]>0x0)_0x52ae51['push'](_0x2fc1ec);else _0x3949a1[_0x53d34d(0x85)]>0x0&&_0x52ae51[_0x53d34d(0x83)](_0x3949a1);}const _0x5e67a2=_0x47c0e9[_0xb0dbce(0xaa)](_0x1eb4bc=>_0x303209(_0x1eb4bc));await Promise[_0xb0dbce(0x110)](_0x5e67a2),_0xa65150['json'](_0x52ae51);}),router[a0_0x4aac29(0xc0)](a0_0x4aac29(0xae),async(_0x454089,_0x476ac4)=>{var _0x5dd547=a0_0x4aac29;const {productCode:_0x269121,bay:_0x4947e5,warehouses:_0x1ab1d4,room:_0x4f222a}=_0x454089[_0x5dd547(0x99)];console[_0x5dd547(0x104)](_0x454089['body']);try{const _0x15b474=await warehouse['aggregate']([{'$match':{'name':_0x1ab1d4,'room':_0x4f222a}},{'$unwind':_0x5dd547(0x100)},{'$match':{'product_details.bay':parseInt(_0x4947e5)}},{'$group':{'_id':_0x5dd547(0xd8),'name':{'$first':_0x5dd547(0xda)},'product_stock':{'$first':_0x5dd547(0x89)},'bay':{'$first':_0x5dd547(0xa9)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x476ac4[_0x5dd547(0x79)](0xc8)[_0x5dd547(0xf9)](_0x15b474);}catch(_0xf7b45){_0x476ac4[_0x5dd547(0x79)](0x194)[_0x5dd547(0xf9)]({'message':_0xf7b45[_0x5dd547(0xd4)]});}}),module['exports']=router;