function a0_0x44e0(_0x4aae63,_0x2fdc36){var _0x4d8afe=a0_0x4d8a();return a0_0x44e0=function(_0x44e063,_0x203a8d){_0x44e063=_0x44e063-0x9e;var _0x50998c=_0x4d8afe[_0x44e063];return _0x50998c;},a0_0x44e0(_0x4aae63,_0x2fdc36);}var a0_0x12e226=a0_0x44e0;(function(_0x18e031,_0xf222a8){var _0x5b20de=a0_0x44e0,_0x1e1c1d=_0x18e031();while(!![]){try{var _0x1a3836=-parseInt(_0x5b20de(0x157))/0x1*(-parseInt(_0x5b20de(0x11a))/0x2)+parseInt(_0x5b20de(0x15b))/0x3*(parseInt(_0x5b20de(0xcc))/0x4)+-parseInt(_0x5b20de(0x14c))/0x5*(parseInt(_0x5b20de(0x130))/0x6)+-parseInt(_0x5b20de(0x118))/0x7+parseInt(_0x5b20de(0xc3))/0x8*(-parseInt(_0x5b20de(0xf5))/0x9)+parseInt(_0x5b20de(0xe8))/0xa*(parseInt(_0x5b20de(0x167))/0xb)+-parseInt(_0x5b20de(0x13d))/0xc*(parseInt(_0x5b20de(0x133))/0xd);if(_0x1a3836===_0xf222a8)break;else _0x1e1c1d['push'](_0x1e1c1d['shift']());}catch(_0x3f5b8b){_0x1e1c1d['push'](_0x1e1c1d['shift']());}}}(a0_0x4d8a,0x4afb3));const express=require(a0_0x12e226(0xa2)),app=express(),router=express[a0_0x12e226(0xee)](),auth=require(a0_0x12e226(0xf4)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x12e226(0xd6)),nodemailer=require('nodemailer');router[a0_0x12e226(0xb1)](a0_0x12e226(0x168),auth,async(_0x3d4a99,_0x29a702)=>{var _0x416079=a0_0x12e226;try{const {username:_0xa647bf,email:_0x1f5fe7,role:_0x4a25cb}=_0x3d4a99[_0x416079(0x103)],_0x187e04=_0x3d4a99[_0x416079(0x103)],_0x37da96=await profile[_0x416079(0x129)]({'email':_0x187e04['email']}),_0x5d7860=await master_shop[_0x416079(0xb6)]();let _0xcbd77e;if(_0x187e04['role']==_0x416079(0x122)){const _0x5dfb41=await staff[_0x416079(0x129)]({'email':_0x187e04[_0x416079(0xa6)]});_0xcbd77e=await warehouse[_0x416079(0xb6)]({'status':_0x416079(0x159),'name':_0x5dfb41['warehouse']});}else _0xcbd77e=await warehouse[_0x416079(0xb6)]({'status':'Enabled'});const _0x146ef3=await product['find']();let _0x2bb243;if(_0x187e04['role']==_0x416079(0x122)){const _0x15a17e=await staff[_0x416079(0x129)]({'email':_0x187e04[_0x416079(0xa6)]});_0x2bb243=await adjustment_finished[_0x416079(0xb6)]({'warehouse_name':_0x15a17e['warehouse']});}else _0x2bb243=await adjustment_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x416079(0xb2),'invoice':{'$first':_0x416079(0xfe)},'date':{'$first':_0x416079(0x104)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5d7860[0x0][_0x416079(0x10e)]==_0x416079(0xe7)){var _0x5194db=users['English'];console[_0x416079(0xb4)](_0x5194db);}else{if(_0x5d7860[0x0][_0x416079(0x10e)]==_0x416079(0xac))var _0x5194db=users[_0x416079(0xac)];else{if(_0x5d7860[0x0][_0x416079(0x10e)]==_0x416079(0x9e))var _0x5194db=users[_0x416079(0x9e)];else{if(_0x5d7860[0x0][_0x416079(0x10e)]==_0x416079(0xe4))var _0x5194db=users[_0x416079(0xe4)];else{if(_0x5d7860[0x0]['language']=='French')var _0x5194db=users[_0x416079(0x123)];else{if(_0x5d7860[0x0][_0x416079(0x10e)]==_0x416079(0x15e))var _0x5194db=users[_0x416079(0xa5)];else{if(_0x5d7860[0x0][_0x416079(0x10e)]==_0x416079(0xae))var _0x5194db=users['Chinese'];else{if(_0x5d7860[0x0][_0x416079(0x10e)]=='Arabic\x20(ae)')var _0x5194db=users[_0x416079(0xe9)];}}}}}}}_0x29a702['render'](_0x416079(0x11f),{'success':_0x3d4a99[_0x416079(0x109)]('success'),'errors':_0x3d4a99['flash']('errors'),'role':_0x187e04,'profile':_0x37da96,'warehouse':_0xcbd77e,'product':_0x146ef3,'adjustment':_0x2bb243,'master_shop':_0x5d7860,'language':_0x5194db});}catch(_0xc506c6){console[_0x416079(0xb4)](_0xc506c6);}});async function getRandom8DigitNumber(){var _0xc756f=a0_0x12e226;const _0x55267b=0x989680,_0x32efe1=0x5f5e0ff,_0x22540d=Math['floor'](Math[_0xc756f(0x165)]()*(_0x32efe1-_0x55267b+0x1))+_0x55267b;var _0x590dcf;const _0x4dad89=await adjustment_finished[_0xc756f(0x129)]({'invoice':_0xc756f(0x121)+_0x22540d});return _0x4dad89&&_0x4dad89[_0xc756f(0xc4)]>0x0?_0x590dcf=_0xc756f(0x121)+_0x22540d:_0x590dcf='ADJF-'+_0x22540d,_0x590dcf;}function a0_0x4d8a(){var _0x557458=['Return\x20Rooms','\x20Order\x20Date\x20:\x20','unit','production_date','</tbody>','</head><body>','Finished\x20Goods','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','1491910tafQAS','save','596KqNWOv','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Error\x20Occurs','padStart','adjustment_finished','new_adjust_qty','ADJF-','staff','French','createTransport','$product_details','push','Enclosed','New_Qty_Converted','findOne','$product_details.expiry_date','split','There\x27s\x20a\x20error\x20in\x20this\x20transaction','add','/upload/','</thead>','1115622obzfdL','/adjustment_finished/view','params','78PYQyUc','role','back','$product_details.maxPerUnit','Arabic\x20(ae)','minus','render','$product_details.rack','secondary_unit','product_date','334704AkSyvf','$product','$product_details.product_stock','maxPerUnit','<h5\x20style=\x22text-align:\x20left;\x22>','slice','map','$product_details.invoice','sendMail','True','QA\x20Warehouse','</tr>','$product_details.batch_code','<h5>','batch_code','15elVNWO','date','status','port','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','/CheckingWarehouse','findById','<tr>','redirect','host','/adjustment_finished/preview/','616RYfaBz','$product_details.secondary_code','Enabled','bay','202527TPanOf','$product_details.production_date','Ambient','Portuguese\x20(BR)','</td>','</div>','types','expiry_date','$product_details.primary_code','/view/:id','random','<h2>\x20','77TPKjBJ','/view','German','$product_details.bay','password','</span>','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_name','Portuguese','email','<!DOCTYPE\x20html>','$product_details.product_code','exports','forEach','success','Hindi','message','Chinese','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stockBefore','get','$_id','post','log','product_name','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<span\x20style=\x22float:\x20right;\x22>','error','product','Secondary_units','/adjustment/view','$product.product_name','aggregate','$product_details.unit','warehouse_name','filter','Logo.png','5784aoNrXU','length','then','prod_invoice','body','New_Qty_Converted_adj','JO_number','prod_code','Primary_Units','32cnqVgM','room_names','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$name','\x20</h2>','</body></html>','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','edit_adjustment_finished','../public/language/languages.json','An\x20error\x20occurred.','$product_details.bin','getMonth','all','note','/picking_list/PDF_adjustment/','$product_details.floorlevel','An\x20error\x20occurred\x20while\x20saving\x20data.','adjust_qty','DRY\x20GOODS','<div>','master','foreach\x20newproduct','Spanish','$product_details._id','product_code','English\x20(US)','783610uTiTkY','Arabic','Rooms','/preview/:id','product_stock','finalize','Router','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','<html><head><title></title>','product_details','prod_cat','$product_details.secondary_unit','../middleware/auth','333LXsmPK','toString','$product_details.type','<hr\x20class=\x22my-3\x22>','getDate','$room','site_title','logo','$product_details.product_name','$invoice','warehouse','$product_details.storage','purchases_data','errors','user','$date','adjustment\x20data\x20update\x20successfully','/view/add_adjustment','stock','level','flash','<tbody\x20style=\x22text-align:\x20center;\x22>','invoice','json','catch','language','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'];a0_0x4d8a=function(){return _0x557458;};return a0_0x4d8a();}router['get']('/view/add_adjustment',auth,async(_0x41f1fc,_0x23273d)=>{var _0x560076=a0_0x12e226;try{const {username:_0x53e086,email:_0x312717,role:_0x1ae987}=_0x41f1fc[_0x560076(0x103)],_0x12b6eb=_0x41f1fc[_0x560076(0x103)],_0x1c0235=await profile['findOne']({'email':_0x12b6eb[_0x560076(0xa6)]}),_0x43b86d=await master_shop[_0x560076(0xb6)]();let _0x348781;if(_0x12b6eb[_0x560076(0x134)]==_0x560076(0x122)){const _0x5e54b1=await staff[_0x560076(0x129)]({'email':_0x12b6eb['email']});_0x348781=await warehouse['aggregate']([{'$match':{'status':_0x560076(0x159),'name':_0x5e54b1[_0x560076(0xff)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x560076(0xcf)}}}]);}else _0x348781=await warehouse[_0x560076(0xbe)]([{'$match':{'status':_0x560076(0x159),'warehouse_category':_0x560076(0x116),'name':{'$ne':_0x560076(0x147)}}},{'$group':{'_id':_0x560076(0xcf),'name':{'$first':_0x560076(0xcf)}}}]);const _0x46dace=await product[_0x560076(0xb6)]({}),_0x9c7d46=await adjustment_finished['find']({}),_0xe67bba=_0x9c7d46[_0x560076(0xc4)]+0x1,_0x22608b='ADJF-'+_0xe67bba[_0x560076(0xf6)]()[_0x560076(0x11e)](0x5,'0');var _0x3aea23=[_0x560076(0x15d),_0x560076(0x127),_0x560076(0x110)];if(_0x43b86d[0x0][_0x560076(0x10e)]==_0x560076(0xe7))var _0x2d07f0=users['English'];else{if(_0x43b86d[0x0][_0x560076(0x10e)]==_0x560076(0xac))var _0x2d07f0=users['Hindi'];else{if(_0x43b86d[0x0][_0x560076(0x10e)]=='German')var _0x2d07f0=users[_0x560076(0x9e)];else{if(_0x43b86d[0x0][_0x560076(0x10e)]=='Spanish')var _0x2d07f0=users['Spanish'];else{if(_0x43b86d[0x0][_0x560076(0x10e)]==_0x560076(0x123))var _0x2d07f0=users['French'];else{if(_0x43b86d[0x0][_0x560076(0x10e)]==_0x560076(0x15e))var _0x2d07f0=users['Portuguese'];else{if(_0x43b86d[0x0][_0x560076(0x10e)]=='Chinese')var _0x2d07f0=users[_0x560076(0xae)];else{if(_0x43b86d[0x0][_0x560076(0x10e)]==_0x560076(0x137))var _0x2d07f0=users[_0x560076(0xe9)];}}}}}}}const _0x4c82f0=getRandom8DigitNumber();_0x4c82f0[_0x560076(0xc5)](_0x4388e9=>{var _0x32b5ab=_0x560076;_0x23273d[_0x32b5ab(0x139)]('add_adjustment_finished',{'success':_0x41f1fc['flash'](_0x32b5ab(0xab)),'errors':_0x41f1fc['flash'](_0x32b5ab(0x102)),'role':_0x12b6eb,'profile':_0x1c0235,'warehouse':_0x348781,'product':_0x46dace,'master_shop':_0x43b86d,'language':_0x2d07f0,'rooms_data':_0x3aea23,'invoice_no':_0x4388e9});})[_0x560076(0x10d)](_0x25fff4=>{var _0x494d6e=_0x560076;_0x41f1fc[_0x494d6e(0x109)]('errors',_0x494d6e(0x12c)),_0x23273d[_0x494d6e(0x154)](_0x494d6e(0xbc));});}catch(_0xc44c11){console[_0x560076(0xb4)](_0xc44c11);}}),router[a0_0x12e226(0xb3)](a0_0x12e226(0x106),auth,async(_0x47f2d3,_0xa17ce7)=>{var _0x20ce37=a0_0x12e226;try{const {warehouse_name:_0x1aac0c,date:_0x43c9a1,prod_name:_0x291359,level:_0x31de70,isle:_0x6bb476,pallet:_0x605e57,stock:_0x61202b,types:_0x55c13d,adjust_qty:_0x10a4c9,new_adjust_qty:_0x16ebea,note:_0x99f69d,Room_name:_0x157b98,invoice:_0x48dcd9,JO_number:_0x22a26f,expiry_date:_0x167f2e}=_0x47f2d3[_0x20ce37(0xc7)];if(typeof _0x291359=='string')var _0x3d667d=[_0x47f2d3[_0x20ce37(0xc7)]['prod_name']],_0x16b9ff=[_0x47f2d3[_0x20ce37(0xc7)]['level']],_0x1b8224=[_0x47f2d3[_0x20ce37(0xc7)]['stock']],_0x2556b6=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x161)]],_0x48af4a=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xc8)]],_0x586ab3=[_0x47f2d3[_0x20ce37(0xc7)]['New_Qty_Converted']],_0x3f9c36=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xcb)]],_0x46a8bf=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xbb)]],_0x29ca6d=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xca)]],_0x2ca837=[_0x47f2d3[_0x20ce37(0xc7)]['batch_code']],_0x170a81=[_0x47f2d3['body'][_0x20ce37(0x162)]],_0x2907aa=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x13c)]],_0x3c6ae4=[_0x47f2d3[_0x20ce37(0xc7)]['prod_cat']],_0x1bb587=[_0x47f2d3['body'][_0x20ce37(0xea)]],_0x174e8b=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x140)]],_0xb673b8=[_0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xc6)]];else var _0x3d667d=[..._0x47f2d3['body'][_0x20ce37(0xa4)]],_0x16b9ff=[..._0x47f2d3['body'][_0x20ce37(0x108)]],_0x1b8224=[..._0x47f2d3['body']['stock']],_0x2556b6=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x161)]],_0x48af4a=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xc8)]],_0x586ab3=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x128)]],_0x3f9c36=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xcb)]],_0x46a8bf=[..._0x47f2d3['body'][_0x20ce37(0xbb)]],_0x29ca6d=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xca)]],_0x2ca837=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x14b)]],_0x170a81=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x162)]],_0x2907aa=[..._0x47f2d3['body'][_0x20ce37(0x13c)]],_0x3c6ae4=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xf2)]],_0x1bb587=[..._0x47f2d3[_0x20ce37(0xc7)]['Rooms']],_0x174e8b=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0x140)]],_0xb673b8=[..._0x47f2d3[_0x20ce37(0xc7)][_0x20ce37(0xc6)]];const _0x5af138=_0x3d667d[_0x20ce37(0x143)](_0xbe174f=>{return _0xbe174f={'product_name':_0xbe174f};});_0x16b9ff[_0x20ce37(0xaa)]((_0x345e92,_0x53ddfa)=>{var _0x3d4ee7=_0x20ce37;_0x5af138[_0x53ddfa][_0x3d4ee7(0x15a)]=_0x345e92;}),_0x1b8224[_0x20ce37(0xaa)]((_0x22a4b0,_0x53e082)=>{var _0x1134cb=_0x20ce37;_0x5af138[_0x53e082][_0x1134cb(0xb0)]=_0x22a4b0;}),_0x2556b6[_0x20ce37(0xaa)]((_0x1c4f5c,_0x31fd0f)=>{var _0x54e487=_0x20ce37;_0x5af138[_0x31fd0f][_0x54e487(0x161)]=_0x1c4f5c;}),_0x48af4a[_0x20ce37(0xaa)]((_0x552ec8,_0x48407b)=>{var _0xa0ed4f=_0x20ce37;_0x5af138[_0x48407b][_0xa0ed4f(0xdf)]=_0x552ec8;}),_0x586ab3[_0x20ce37(0xaa)]((_0x5c7ca8,_0x55bc0b)=>{var _0x36d676=_0x20ce37;_0x5af138[_0x55bc0b][_0x36d676(0x120)]=_0x5c7ca8;}),_0x3f9c36['forEach']((_0x1653a5,_0x3bbfdb)=>{var _0x3693fe=_0x20ce37;_0x5af138[_0x3bbfdb][_0x3693fe(0x112)]=_0x1653a5;}),_0x46a8bf[_0x20ce37(0xaa)]((_0x4ab24f,_0x55aede)=>{var _0x15b2b9=_0x20ce37;_0x5af138[_0x55aede][_0x15b2b9(0x13b)]=_0x4ab24f;}),_0x29ca6d['forEach']((_0x4b568e,_0x174a0b)=>{_0x5af138[_0x174a0b]['product_code']=_0x4b568e;}),_0x2ca837['forEach']((_0x165e86,_0x33ba02)=>{var _0x360662=_0x20ce37;_0x5af138[_0x33ba02][_0x360662(0x14b)]=_0x165e86;}),_0x170a81[_0x20ce37(0xaa)]((_0x5fb53e,_0x249eb9)=>{var _0xa30c1d=_0x20ce37;_0x5af138[_0x249eb9][_0xa30c1d(0x162)]=_0x5fb53e;}),_0x2907aa[_0x20ce37(0xaa)]((_0x431bb9,_0x173208)=>{var _0x14f1ad=_0x20ce37;_0x5af138[_0x173208][_0x14f1ad(0x113)]=_0x431bb9;}),_0x3c6ae4[_0x20ce37(0xaa)]((_0x28278,_0xa1bea)=>{_0x5af138[_0xa1bea]['prod_cat']=_0x28278;}),_0x1bb587[_0x20ce37(0xaa)]((_0x501b90,_0x46bb89)=>{var _0x5a5b8a=_0x20ce37;_0x5af138[_0x46bb89][_0x5a5b8a(0xcd)]=_0x501b90;}),_0x174e8b['forEach']((_0x1072d7,_0x3d23e9)=>{var _0x54ab3a=_0x20ce37;_0x5af138[_0x3d23e9][_0x54ab3a(0x140)]=_0x1072d7;}),_0xb673b8['forEach']((_0x3f203e,_0x45cb20)=>{var _0x462e0e=_0x20ce37;_0x5af138[_0x45cb20][_0x462e0e(0x10b)]=_0x3f203e;});const _0x13b8ea=_0x5af138[_0x20ce37(0xc1)](_0x573a6d=>_0x573a6d['adjust_qty']!=='0'&&_0x573a6d['adjust_qty']!=='');var _0x3edf96=0x0;_0x13b8ea[_0x20ce37(0xaa)](_0x4f609a=>{var _0x2580fe=_0x20ce37;console[_0x2580fe(0xb4)](_0x2580fe(0xe3),_0x4f609a),parseInt(_0x4f609a['adjust_qty'])<=0x0&&_0x3edf96++;});if(_0x3edf96!=0x0)return _0x47f2d3[_0x20ce37(0x109)](_0x20ce37(0x102),_0x20ce37(0x11b)),_0xa17ce7[_0x20ce37(0x154)](_0x20ce37(0x135));const _0x42a12e=new adjustment_finished({'warehouse_name':_0x1aac0c,'date':_0x43c9a1,'product':_0x13b8ea,'note':_0x99f69d,'room':_0x157b98,'invoice':_0x48dcd9,'JO_number':_0x22a26f,'expiry_date':_0x167f2e}),_0x2ec343=await _0x42a12e[_0x20ce37(0x119)]();_0x47f2d3[_0x20ce37(0x109)](_0x20ce37(0xab),'adjustment\x20add\x20successfull'),_0xa17ce7[_0x20ce37(0x154)](_0x20ce37(0x156)+_0x2ec343['_id']);}catch(_0x1556ed){console[_0x20ce37(0xb4)](_0x1556ed),_0xa17ce7[_0x20ce37(0x14e)](0xc8)[_0x20ce37(0x10c)]({'message':_0x1556ed[_0x20ce37(0xad)]});}}),router[a0_0x12e226(0xb1)](a0_0x12e226(0xeb),auth,async(_0x380722,_0x4657eb)=>{var _0x1f0d40=a0_0x12e226;try{const {username:_0x30b0f9,email:_0xd5ac8d,role:_0x383267}=_0x380722[_0x1f0d40(0x103)],_0xf3d04d=_0x380722[_0x1f0d40(0x103)],_0x4f4285=await profile[_0x1f0d40(0x129)]({'email':_0xf3d04d[_0x1f0d40(0xa6)]}),_0x18d62f=await master_shop['find'](),_0x36f23b=_0x380722[_0x1f0d40(0x132)]['id'],_0x3f2ed9=await adjustment_finished[_0x1f0d40(0x152)]({'_id':_0x36f23b}),_0x34e728=await purchases[_0x1f0d40(0xbe)]([{'$match':{'warehouse_name':_0x3f2ed9[_0x1f0d40(0xc0)]}},{'$unwind':'$product'},{'$group':{'_id':'$product.product_name'}}]);console[_0x1f0d40(0xb4)](_0x1f0d40(0x101),_0x34e728);const _0x167bee=await product[_0x1f0d40(0xb6)]({}),_0x91d7b5=await warehouse[_0x1f0d40(0xbe)]([{'$match':{'name':_0x3f2ed9['warehouse_name'],'warehouse_category':_0x1f0d40(0x116)}},{'$unwind':_0x1f0d40(0x125)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1f0d40(0x13f)},'bay':{'$first':_0x1f0d40(0x9f)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1f0d40(0xdd)},'primary_code':{'$first':_0x1f0d40(0x163)},'secondary_code':{'$first':_0x1f0d40(0x158)},'product_code':{'$first':_0x1f0d40(0xa8)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1f0d40(0x13a)},'expiry_date':{'$first':_0x1f0d40(0x12a)},'production_date':{'$first':_0x1f0d40(0x15c)},'batch_code':{'$first':_0x1f0d40(0x149)},'maxPerUnit':{'$first':_0x1f0d40(0x136)},'room':{'$first':_0x1f0d40(0xfa)}}}]);if(_0x18d62f[0x0][_0x1f0d40(0x10e)]==_0x1f0d40(0xe7)){var _0x429357=users['English'];console[_0x1f0d40(0xb4)](_0x429357);}else{if(_0x18d62f[0x0][_0x1f0d40(0x10e)]==_0x1f0d40(0xac))var _0x429357=users[_0x1f0d40(0xac)];else{if(_0x18d62f[0x0][_0x1f0d40(0x10e)]=='German')var _0x429357=users[_0x1f0d40(0x9e)];else{if(_0x18d62f[0x0]['language']=='Spanish')var _0x429357=users[_0x1f0d40(0xe4)];else{if(_0x18d62f[0x0][_0x1f0d40(0x10e)]=='French')var _0x429357=users[_0x1f0d40(0x123)];else{if(_0x18d62f[0x0][_0x1f0d40(0x10e)]==_0x1f0d40(0x15e))var _0x429357=users[_0x1f0d40(0xa5)];else{if(_0x18d62f[0x0][_0x1f0d40(0x10e)]==_0x1f0d40(0xae))var _0x429357=users[_0x1f0d40(0xae)];else{if(_0x18d62f[0x0][_0x1f0d40(0x10e)]==_0x1f0d40(0x137))var _0x429357=users['Arabic'];}}}}}}}_0x4657eb[_0x1f0d40(0x139)]('edit_adjustment_finished_view',{'success':_0x380722[_0x1f0d40(0x109)](_0x1f0d40(0xab)),'errors':_0x380722[_0x1f0d40(0x109)](_0x1f0d40(0x102)),'role':_0xf3d04d,'profile':_0x4f4285,'adjustment':_0x3f2ed9,'stock':_0x91d7b5,'master_shop':_0x18d62f,'warehouse_name':_0x34e728,'unit':_0x167bee,'language':_0x429357});}catch(_0x2052c2){console[_0x1f0d40(0xb4)](_0x2052c2),_0x4657eb[_0x1f0d40(0x14e)](0xc8)[_0x1f0d40(0x10c)]({'message':_0x2052c2['message']});}}),router['post'](a0_0x12e226(0xeb),auth,async(_0x2af403,_0x2246dc)=>{var _0x5085cc=a0_0x12e226;try{const {invoice:_0x3f05bf,warehouse_name:_0x589013,Room_name:_0x43d586}=_0x2af403[_0x5085cc(0xc7)],_0x2bbf03=_0x2af403[_0x5085cc(0x132)]['id'],_0x103959=await adjustment_finished[_0x5085cc(0x152)]({'_id':_0x2bbf03});var _0xd55a48;const _0x361969=_0x103959['product'][_0x5085cc(0x143)](async _0x3c4695=>{var _0xd6cbe8=_0x5085cc;if(_0x3c4695['adjust_qty']>0x0){_0xd55a48=await warehouse['findOne']({'name':_0x589013,'room':_0x3c4695['room_names'],'warehouse_category':_0xd6cbe8(0x116)});const _0x45b223=_0xd55a48[_0xd6cbe8(0xf1)]['map'](_0x48b6cc=>{var _0x1ce70e=_0xd6cbe8;console[_0x1ce70e(0xb4)](_0x3c4695[_0x1ce70e(0x161)]);if(_0x3c4695['types']==_0x1ce70e(0x138))_0x48b6cc[_0x1ce70e(0xb5)]==_0x3c4695[_0x1ce70e(0xb5)]&&_0x48b6cc[_0x1ce70e(0x15a)]==_0x3c4695[_0x1ce70e(0x15a)]&&_0x48b6cc[_0x1ce70e(0x162)]==_0x3c4695[_0x1ce70e(0x162)]&&_0x48b6cc[_0x1ce70e(0x113)]==_0x3c4695[_0x1ce70e(0x113)]&&_0x48b6cc[_0x1ce70e(0x14b)]==_0x3c4695[_0x1ce70e(0x14b)]&&_0x48b6cc['invoice']==_0x3c4695['invoice']&&(_0x48b6cc[_0x1ce70e(0xec)]=_0x48b6cc[_0x1ce70e(0xec)]-_0x3c4695[_0x1ce70e(0xdf)]);else _0x3c4695[_0x1ce70e(0x161)]==_0x1ce70e(0x12d)&&(_0x48b6cc[_0x1ce70e(0xb5)]==_0x3c4695[_0x1ce70e(0xb5)]&&_0x48b6cc['bay']==_0x3c4695[_0x1ce70e(0x15a)]&&_0x48b6cc[_0x1ce70e(0x162)]==_0x3c4695['expiry_date']&&_0x48b6cc['production_date']==_0x3c4695[_0x1ce70e(0x113)]&&_0x48b6cc[_0x1ce70e(0x14b)]==_0x3c4695[_0x1ce70e(0x14b)]&&_0x48b6cc[_0x1ce70e(0x10b)]==_0x3c4695['invoice']&&(_0x48b6cc[_0x1ce70e(0xec)]=_0x48b6cc[_0x1ce70e(0xec)]+_0x3c4695[_0x1ce70e(0xdf)]));});}return _0xd55a48;});Promise[_0x5085cc(0xda)](_0x361969)[_0x5085cc(0xc5)](async _0x35cc63=>{var _0x5b6396=_0x5085cc;try{for(const _0xc88fa3 of _0x35cc63){await _0xc88fa3['save']();}_0x103959[_0x5b6396(0xed)]=_0x5b6396(0x146);const _0x4cc3df=await _0x103959[_0x5b6396(0x119)](),_0x50949b=await master_shop['find'](),_0x548fce=await email_settings['findOne'](),_0x36dd49=await supervisor_settings[_0x5b6396(0xb6)]();var _0x308c5c=_0x103959[_0x5b6396(0xba)],_0xca5060='',_0x493833;for(_0x493833 in _0x308c5c){var _0x26e296='FG';_0x103959[_0x5b6396(0xc0)]==_0x5b6396(0xe0)&&(_0x26e296='DG'),_0xca5060+=_0x5b6396(0x153)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x308c5c[_0x493833][_0x5b6396(0xb5)]+_0x5b6396(0x15f)+_0x5b6396(0xd2)+_0x308c5c[_0x493833]['product_code']+_0x5b6396(0x15f)+_0x5b6396(0xd2)+_0x308c5c[_0x493833][_0x5b6396(0xdf)]+_0x5b6396(0x15f)+_0x5b6396(0xd2)+_0x308c5c[_0x493833][_0x5b6396(0x112)]+_0x5b6396(0x15f)+_0x5b6396(0xd2)+_0x308c5c[_0x493833]['secondary_unit']+_0x5b6396(0x15f)+_0x5b6396(0xd2)+_0x103959[_0x5b6396(0xc0)]+_0x5b6396(0x15f)+_0x5b6396(0xd2)+_0x308c5c[_0x493833][_0x5b6396(0xcd)]+_0x5b6396(0x15f)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x26e296+_0x308c5c[_0x493833][_0x5b6396(0x15a)]+'</td>'+_0x5b6396(0x148);}let _0xa60b83=nodemailer[_0x5b6396(0x124)]({'host':_0x548fce[_0x5b6396(0x155)],'port':Number(_0x548fce[_0x5b6396(0x14f)]),'secure':![],'auth':{'user':_0x548fce[_0x5b6396(0xa6)],'pass':_0x548fce[_0x5b6396(0xa0)]}}),_0xaf171e={'from':_0x548fce[_0x5b6396(0xa6)],'to':_0x36dd49[0x0]['FGSEmail'],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x5b6396(0xc2),'path':__dirname+'/../public'+_0x5b6396(0x12e)+_0x50949b[0x0]['image'],'cid':_0x5b6396(0xfc)}],'html':_0x5b6396(0xa7)+_0x5b6396(0xf0)+_0x5b6396(0x115)+_0x5b6396(0xe1)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x5b6396(0xe1)+_0x5b6396(0xce)+'</div>'+_0x5b6396(0xe1)+_0x5b6396(0x166)+_0x50949b[0x0]['site_title']+_0x5b6396(0xd0)+_0x5b6396(0x160)+_0x5b6396(0x160)+_0x5b6396(0xf8)+_0x5b6396(0xe1)+_0x5b6396(0x141)+'\x20Order\x20Number\x20:\x20'+_0x103959['invoice']+'\x20'+_0x5b6396(0xb8)+_0x5b6396(0x111)+_0x103959[_0x5b6396(0x14d)]+'\x20'+_0x5b6396(0xa1)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x5b6396(0x117)+_0x5b6396(0x153)+_0x5b6396(0x11c)+_0x5b6396(0xef)+_0x5b6396(0xa3)+_0x5b6396(0xd4)+_0x5b6396(0x150)+_0x5b6396(0xb7)+_0x5b6396(0xaf)+_0x5b6396(0x10f)+_0x5b6396(0x148)+_0x5b6396(0x12f)+_0x5b6396(0x10a)+'\x20'+_0xca5060+'\x20'+_0x5b6396(0x114)+'</table>'+_0x5b6396(0xe1)+'<strong>\x20Regards\x20</strong>'+_0x5b6396(0x14a)+_0x50949b[0x0][_0x5b6396(0xfb)]+'</h5>'+_0x5b6396(0x160)+_0x5b6396(0x160)+_0x5b6396(0xd1)};_0xa60b83[_0x5b6396(0x145)](_0xaf171e,function(_0x56e14b,_0x39ecca){var _0x8a631e=_0x5b6396;_0x56e14b?(console['log'](_0x56e14b),console[_0x8a631e(0xb4)](_0x8a631e(0x11d))):console[_0x8a631e(0xb4)]('Email\x20sent\x20successfully');}),_0x2af403['flash'](_0x5b6396(0xab),'Adjustment\x20Finalize\x20Successfully'),_0x2246dc[_0x5b6396(0x154)](_0x5b6396(0xdc)+_0x4cc3df['_id']);}catch(_0x1e72ea){console[_0x5b6396(0xb9)](_0x1e72ea),_0x2246dc['status'](0x1f4)[_0x5b6396(0x10c)]({'error':_0x5b6396(0xde)});}})[_0x5085cc(0x10d)](_0x45bd52=>{var _0x4b377e=_0x5085cc;console['error'](_0x45bd52),_0x2246dc['status'](0x1f4)[_0x4b377e(0x10c)]({'error':_0x4b377e(0xd7)});});}catch(_0x1167a7){_0x2246dc[_0x5085cc(0x10c)]({'message':_0x1167a7['message']});}}),router['get'](a0_0x12e226(0x164),auth,async(_0x53d88c,_0x2d6381)=>{var _0x545b66=a0_0x12e226;try{const {username:_0x58dd7d,email:_0x59879c,role:_0x1ff3d5}=_0x53d88c[_0x545b66(0x103)],_0x12f2a1=_0x53d88c[_0x545b66(0x103)],_0x52731c=await profile[_0x545b66(0x129)]({'email':_0x12f2a1[_0x545b66(0xa6)]}),_0x38f89=await master_shop[_0x545b66(0xb6)]();console[_0x545b66(0xb4)](_0x545b66(0xe2),_0x38f89);const _0x474d00=_0x53d88c[_0x545b66(0x132)]['id'],_0x215a5d=await adjustment_finished['findById']({'_id':_0x474d00});let _0xab5187=new Date(_0x215a5d[_0x545b66(0x162)]),_0x45e959=('0'+_0xab5187[_0x545b66(0xf9)]())[_0x545b66(0x142)](-0x2),_0x54c9a9=('0'+(_0xab5187[_0x545b66(0xd9)]()+0x1))[_0x545b66(0x142)](-0x2),_0x1df1de=_0xab5187['getFullYear'](),_0x549f42=_0x1df1de+'-'+_0x54c9a9+'-'+_0x45e959;var _0xadeaa4=['Ambient',_0x545b66(0x127),_0x545b66(0x110)];const _0xc54022=await purchases[_0x545b66(0xbe)]([{'$match':{'warehouse_name':_0x215a5d[_0x545b66(0xc0)]}},{'$unwind':_0x545b66(0x13e)},{'$group':{'_id':_0x545b66(0xbd)}}]);console[_0x545b66(0xb4)]('purchases_data',_0xc54022);const _0x396c46=await product[_0x545b66(0xb6)]({}),_0x2b012f=await warehouse['aggregate']([{'$match':{'name':_0x215a5d['warehouse_name'],'room':_0x215a5d[_0x545b66(0xd3)]}},{'$unwind':_0x545b66(0x125)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x545b66(0xfd)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x545b66(0xd8)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x545b66(0xdd)},'primary_code':{'$first':_0x545b66(0x163)},'secondary_code':{'$first':_0x545b66(0x158)},'product_code':{'$first':_0x545b66(0xa8)},'storage':{'$first':_0x545b66(0x100)},'rack':{'$first':_0x545b66(0x13a)}}}]);if(_0x38f89[0x0][_0x545b66(0x10e)]==_0x545b66(0xe7)){var _0x1d88da=users['English'];console[_0x545b66(0xb4)](_0x1d88da);}else{if(_0x38f89[0x0]['language']==_0x545b66(0xac))var _0x1d88da=users[_0x545b66(0xac)];else{if(_0x38f89[0x0][_0x545b66(0x10e)]==_0x545b66(0x9e))var _0x1d88da=users[_0x545b66(0x9e)];else{if(_0x38f89[0x0][_0x545b66(0x10e)]==_0x545b66(0xe4))var _0x1d88da=users['Spanish'];else{if(_0x38f89[0x0][_0x545b66(0x10e)]=='French')var _0x1d88da=users[_0x545b66(0x123)];else{if(_0x38f89[0x0][_0x545b66(0x10e)]==_0x545b66(0x15e))var _0x1d88da=users['Portuguese'];else{if(_0x38f89[0x0][_0x545b66(0x10e)]==_0x545b66(0xae))var _0x1d88da=users[_0x545b66(0xae)];else{if(_0x38f89[0x0]['language']==_0x545b66(0x137))var _0x1d88da=users[_0x545b66(0xe9)];}}}}}}}_0x2d6381[_0x545b66(0x139)](_0x545b66(0xd5),{'success':_0x53d88c[_0x545b66(0x109)]('success'),'errors':_0x53d88c[_0x545b66(0x109)](_0x545b66(0x102)),'role':_0x12f2a1,'profile':_0x52731c,'adjustment':_0x215a5d,'stock':_0x2b012f,'master_shop':_0x38f89,'warehouse_name':_0xc54022,'unit':_0x396c46,'language':_0x1d88da,'rooms_data':_0xadeaa4,'ed_fullDate':_0x549f42});}catch(_0x2c3bc9){console[_0x545b66(0xb4)](_0x2c3bc9),_0x2d6381[_0x545b66(0x14e)](0xc8)['json']({'message':_0x2c3bc9[_0x545b66(0xad)]});}}),router[a0_0x12e226(0xb3)]('/view/:id',auth,async(_0x279a29,_0x10ec03)=>{var _0x2417b8=a0_0x12e226;try{const _0x106d30=_0x279a29[_0x2417b8(0x132)]['id'],_0x38308f=await adjustment_finished[_0x2417b8(0x152)]({'_id':_0x106d30}),_0xb73953=await warehouse[_0x2417b8(0x129)]({'name':_0x38308f['warehouse_name'],'room':_0x38308f[_0x2417b8(0xd3)]}),{warehouse_name:_0x33bad0,date:_0x30794a,prod_name:_0x2c8709,level:_0x1da6f5,isle:_0x5f3b47,pallet:_0x148480,stock:_0x56a5ad,types:_0x3b9159,adjust_qty:_0x595bcc,new_adjust_qty:_0x4819da,note:_0x5ce8d4,Room_name:_0x48488b,invoice:_0x536260,JO_number:_0x4226b9}=_0x279a29[_0x2417b8(0xc7)];if(typeof _0x2c8709=='string')var _0x5069b8=[_0x279a29[_0x2417b8(0xc7)][_0x2417b8(0xa4)]],_0x3fabdf=[_0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x108)]],_0x8073d2=[_0x279a29['body'][_0x2417b8(0x107)]],_0x25f611=[_0x279a29['body'][_0x2417b8(0x161)]],_0x1ef335=[_0x279a29[_0x2417b8(0xc7)]['adjust_qty']],_0x491f42=[_0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x120)]],_0x5ba2df=[_0x279a29[_0x2417b8(0xc7)][_0x2417b8(0xca)]],_0x46f695=[_0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x112)]],_0x6c042a=[_0x279a29[_0x2417b8(0xc7)]['Secondary_units']],_0x2d635e=[_0x279a29['body'][_0x2417b8(0x14b)]],_0x43b0d1=[_0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x162)]];else var _0x5069b8=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0xa4)]],_0x3fabdf=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x108)]],_0x8073d2=[..._0x279a29['body'][_0x2417b8(0x107)]],_0x25f611=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x161)]],_0x1ef335=[..._0x279a29[_0x2417b8(0xc7)]['adjust_qty']],_0x491f42=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x120)]],_0x5ba2df=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0xca)]],_0x46f695=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x112)]],_0x6c042a=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0xbb)]],_0x2d635e=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x14b)]],_0x43b0d1=[..._0x279a29[_0x2417b8(0xc7)][_0x2417b8(0x162)]];const _0x5b717e=_0x5069b8[_0x2417b8(0x143)](_0x175a7c=>{return _0x175a7c={'product_name':_0x175a7c};});_0x3fabdf['forEach']((_0x1a72cf,_0x4d2df8)=>{var _0x2acf94=_0x2417b8;_0x5b717e[_0x4d2df8][_0x2acf94(0x15a)]=_0x1a72cf;}),_0x8073d2[_0x2417b8(0xaa)]((_0x51d19b,_0x586ca3)=>{var _0x171a97=_0x2417b8;_0x5b717e[_0x586ca3][_0x171a97(0xb0)]=_0x51d19b;}),_0x25f611[_0x2417b8(0xaa)]((_0x38d501,_0x24813e)=>{var _0x5b1de5=_0x2417b8;_0x5b717e[_0x24813e][_0x5b1de5(0x161)]=_0x38d501;}),_0x1ef335[_0x2417b8(0xaa)]((_0x37f2b0,_0x521d12)=>{var _0x2c790e=_0x2417b8;_0x5b717e[_0x521d12][_0x2c790e(0xdf)]=_0x37f2b0;}),_0x491f42['forEach']((_0x259ddf,_0x5ddacd)=>{_0x5b717e[_0x5ddacd]['new_adjust_qty']=_0x259ddf;}),_0x46f695[_0x2417b8(0xaa)]((_0x301d3d,_0xa60ff)=>{_0x5b717e[_0xa60ff]['unit']=_0x301d3d;}),_0x6c042a[_0x2417b8(0xaa)]((_0x5a5427,_0xe9d222)=>{var _0x4e5803=_0x2417b8;_0x5b717e[_0xe9d222][_0x4e5803(0x13b)]=_0x5a5427;}),_0x5ba2df[_0x2417b8(0xaa)]((_0xf6b895,_0x1bfd16)=>{var _0x2fc798=_0x2417b8;_0x5b717e[_0x1bfd16][_0x2fc798(0xe6)]=_0xf6b895;}),_0x2d635e[_0x2417b8(0xaa)]((_0x365f6c,_0x5accc3)=>{_0x5b717e[_0x5accc3]['batch_code']=_0x365f6c;}),_0x43b0d1['forEach']((_0x4c99bd,_0xff5653)=>{var _0x4b9595=_0x2417b8;_0x5b717e[_0xff5653][_0x4b9595(0x162)]=_0x4c99bd;});const _0x5c1d55=_0x5b717e['filter'](_0x10b531=>_0x10b531[_0x2417b8(0xdf)]!=='0'&&_0x10b531[_0x2417b8(0xdf)]!=='');var _0x265fbf=0x0;_0x5c1d55[_0x2417b8(0xaa)](_0x523fdf=>{var _0x9e5e97=_0x2417b8;console['log'](_0x9e5e97(0xe3),_0x523fdf),parseInt(_0x523fdf[_0x9e5e97(0xdf)])<=0x0&&_0x265fbf++;});if(_0x265fbf!=0x0)return _0x279a29[_0x2417b8(0x109)](_0x2417b8(0x102),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x10ec03[_0x2417b8(0x154)]('back');_0x38308f['warehouse_name']=_0x33bad0,_0x38308f[_0x2417b8(0x14d)]=_0x30794a,_0x38308f[_0x2417b8(0xba)]=_0x5c1d55,_0x38308f[_0x2417b8(0xdb)]=_0x5ce8d4,_0x38308f[_0x2417b8(0xd3)]=_0x48488b,_0x38308f[_0x2417b8(0x10b)]=_0x536260,_0x38308f[_0x2417b8(0xc9)]=_0x4226b9;const _0x3d173e=await _0x38308f[_0x2417b8(0x119)](),_0x56a359=await warehouse['findOne']({'name':_0x33bad0,'room':_0x48488b});_0x3d173e[_0x2417b8(0xba)]['forEach'](_0x4bbd08=>{var _0xb927af=_0x2417b8;const _0x3790ba=_0x56a359['product_details'][_0xb927af(0x143)](_0x343755=>{var _0xcbed43=_0xb927af;_0x4bbd08[_0xcbed43(0x161)]==_0xcbed43(0x138)?_0x343755[_0xcbed43(0xb5)]==_0x4bbd08['product_name']&&_0x343755[_0xcbed43(0x15a)]==_0x4bbd08['bay']&&(_0x343755[_0xcbed43(0xec)]=parseInt(_0x343755['product_stock'])-parseInt(_0x4bbd08['adjust_qty'])):_0x343755['product_name']==_0x4bbd08[_0xcbed43(0xb5)]&&_0x343755[_0xcbed43(0x15a)]==_0x4bbd08[_0xcbed43(0x15a)]&&(_0x343755[_0xcbed43(0xec)]=parseInt(_0x343755[_0xcbed43(0xec)])+parseInt(_0x4bbd08['adjust_qty']));});}),await _0x56a359[_0x2417b8(0x119)](),_0x279a29[_0x2417b8(0x109)](_0x2417b8(0xab),_0x2417b8(0x105)),_0x10ec03[_0x2417b8(0x154)](_0x2417b8(0x131));}catch(_0x43abb9){console['log'](_0x43abb9);}}),router[a0_0x12e226(0xb3)]('/barcode_scanner',async(_0x439064,_0x793f06)=>{var _0x48b439=a0_0x12e226;const {primary_code:_0x598605,warehouse_data:_0x219f1c,rooms_data:_0x2158dd,Roomslist:_0x3fb3cc}=_0x439064['body'],_0x1dd87f=_0x3fb3cc[_0x48b439(0x12b)](','),_0x16ec90=[];async function _0x1a4afd(_0x5db96f){var _0xbc2e2a=_0x48b439;const _0x1d5b75=await warehouse[_0xbc2e2a(0xbe)]([{'$match':{'name':_0x219f1c,'room':_0x5db96f}},{'$unwind':_0xbc2e2a(0x125)},{'$match':{'product_details.primary_code':_0x598605}},{'$group':{'_id':_0xbc2e2a(0xe5),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xbc2e2a(0x13f)},'primary_code':{'$first':_0xbc2e2a(0x163)},'secondary_code':{'$first':_0xbc2e2a(0x158)},'product_code':{'$first':_0xbc2e2a(0xa8)},'level':{'$first':_0xbc2e2a(0x9f)},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xbc2e2a(0xbf)},'secondary_unit':{'$first':_0xbc2e2a(0xf3)},'storage':{'$first':_0xbc2e2a(0x100)},'rack':{'$first':_0xbc2e2a(0x13a)},'expiry_date':{'$first':_0xbc2e2a(0x12a)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0xbc2e2a(0x149)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0xbc2e2a(0x136)},'roomNamed':{'$first':_0xbc2e2a(0xfa)},'invoice':{'$first':_0xbc2e2a(0x144)}}}]),_0x521ca2=await warehouse[_0xbc2e2a(0xbe)]([{'$match':{'name':_0x219f1c,'room':_0x5db96f}},{'$unwind':_0xbc2e2a(0x125)},{'$match':{'product_details.secondary_code':_0x598605}},{'$group':{'_id':_0xbc2e2a(0xe5),'name':{'$first':_0xbc2e2a(0xfd)},'product_stock':{'$first':_0xbc2e2a(0x13f)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xbc2e2a(0x158)},'product_code':{'$first':_0xbc2e2a(0xa8)},'level':{'$first':_0xbc2e2a(0x9f)},'isle':{'$first':_0xbc2e2a(0xd8)},'type':{'$first':_0xbc2e2a(0xf7)},'pallet':{'$first':_0xbc2e2a(0xdd)},'unit':{'$first':_0xbc2e2a(0xbf)},'secondary_unit':{'$first':_0xbc2e2a(0xf3)},'storage':{'$first':_0xbc2e2a(0x100)},'rack':{'$first':_0xbc2e2a(0x13a)},'expiry_date':{'$first':_0xbc2e2a(0x12a)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0xbc2e2a(0x149)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0xbc2e2a(0xfa)},'invoice':{'$first':_0xbc2e2a(0x144)}}}]);if(_0x1d5b75[_0xbc2e2a(0xc4)]>0x0)_0x16ec90['push'](_0x1d5b75);else _0x521ca2[_0xbc2e2a(0xc4)]>0x0&&_0x16ec90[_0xbc2e2a(0x126)](_0x521ca2);}const _0x56b49f=_0x1dd87f['map'](_0x16e1d4=>_0x1a4afd(_0x16e1d4));await Promise['all'](_0x56b49f),_0x793f06['json'](_0x16ec90);}),router[a0_0x12e226(0xb3)](a0_0x12e226(0x151),async(_0x37a308,_0x571ea4)=>{var _0x36adbc=a0_0x12e226;const {productCode:_0x5efdad,bay:_0x44609e,warehouses:_0x588775,room:_0x4f3ac5}=_0x37a308['body'];console[_0x36adbc(0xb4)](_0x37a308[_0x36adbc(0xc7)]);try{const _0x10ad07=await warehouse['aggregate']([{'$match':{'name':_0x588775,'room':_0x4f3ac5}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x44609e)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x36adbc(0xfd)},'product_stock':{'$first':_0x36adbc(0x13f)},'bay':{'$first':_0x36adbc(0x9f)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x571ea4['status'](0xc8)[_0x36adbc(0x10c)](_0x10ad07);}catch(_0x4389b7){_0x571ea4[_0x36adbc(0x14e)](0x194)[_0x36adbc(0x10c)]({'message':_0x4389b7[_0x36adbc(0xad)]});}}),module[a0_0x12e226(0xa9)]=router;