var a0_0x18887e=a0_0x37f8;(function(_0x5b5c76,_0x2d3b25){var _0x26e4e7=a0_0x37f8,_0x5df5da=_0x5b5c76();while(!![]){try{var _0x4073c9=-parseInt(_0x26e4e7(0x12b))/0x1+-parseInt(_0x26e4e7(0x155))/0x2*(parseInt(_0x26e4e7(0x12c))/0x3)+-parseInt(_0x26e4e7(0xa9))/0x4*(-parseInt(_0x26e4e7(0x122))/0x5)+parseInt(_0x26e4e7(0x12e))/0x6*(-parseInt(_0x26e4e7(0x9b))/0x7)+parseInt(_0x26e4e7(0xcf))/0x8+-parseInt(_0x26e4e7(0xec))/0x9*(-parseInt(_0x26e4e7(0xee))/0xa)+parseInt(_0x26e4e7(0xf2))/0xb*(-parseInt(_0x26e4e7(0x145))/0xc);if(_0x4073c9===_0x2d3b25)break;else _0x5df5da['push'](_0x5df5da['shift']());}catch(_0x54a628){_0x5df5da['push'](_0x5df5da['shift']());}}}(a0_0x1e8d,0xeaac8));const express=require('express'),app=express(),router=express['Router'](),auth=require(a0_0x18887e(0x91)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x18887e(0x116)),users=require(a0_0x18887e(0xe5)),nodemailer=require(a0_0x18887e(0x130));router[a0_0x18887e(0x106)](a0_0x18887e(0x98),auth,async(_0x9354ac,_0x2aac67)=>{var _0x116a5a=a0_0x18887e;try{const {username:_0x2dce0d,email:_0x416722,role:_0x17e96a}=_0x9354ac[_0x116a5a(0xd1)],_0xb74960=_0x9354ac[_0x116a5a(0xd1)],_0x3a6dc7=await profile['findOne']({'email':_0xb74960[_0x116a5a(0xbb)]}),_0x47ddff=await master_shop['find']();let _0x2d6af7;if(_0xb74960[_0x116a5a(0x12f)]==_0x116a5a(0x153)){const _0x3ac55e=await staff[_0x116a5a(0xe6)]({'email':_0xb74960[_0x116a5a(0xbb)]});_0x2d6af7=await warehouse[_0x116a5a(0x104)]({'status':'Enabled','name':_0x3ac55e[_0x116a5a(0x9d)]});}else _0x2d6af7=await warehouse[_0x116a5a(0x104)]({'status':_0x116a5a(0xbc)});const _0x35be9f=await product['find']();let _0x53429e;if(_0xb74960[_0x116a5a(0x12f)]=='staff'){const _0x247210=await staff['findOne']({'email':_0xb74960[_0x116a5a(0xbb)]});_0x53429e=await adjustment_finished[_0x116a5a(0x104)]({'warehouse_name':_0x247210[_0x116a5a(0x9d)]});}else _0x53429e=await adjustment_finished[_0x116a5a(0xd5)]([{'$unwind':'$product'},{'$group':{'_id':_0x116a5a(0xe2),'invoice':{'$first':_0x116a5a(0xe3)},'date':{'$first':_0x116a5a(0xd6)},'warehouse_name':{'$first':_0x116a5a(0x96)},'room':{'$addToSet':_0x116a5a(0x13c)},'finalize':{'$first':_0x116a5a(0xf0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x47ddff[0x0][_0x116a5a(0x114)]=='English\x20(US)'){var _0x381d24=users['English'];console[_0x116a5a(0x13d)](_0x381d24);}else{if(_0x47ddff[0x0]['language']=='Hindi')var _0x381d24=users[_0x116a5a(0xf3)];else{if(_0x47ddff[0x0][_0x116a5a(0x114)]=='German')var _0x381d24=users[_0x116a5a(0xe7)];else{if(_0x47ddff[0x0][_0x116a5a(0x114)]==_0x116a5a(0xfb))var _0x381d24=users['Spanish'];else{if(_0x47ddff[0x0][_0x116a5a(0x114)]==_0x116a5a(0x139))var _0x381d24=users[_0x116a5a(0x139)];else{if(_0x47ddff[0x0][_0x116a5a(0x114)]==_0x116a5a(0xf8))var _0x381d24=users[_0x116a5a(0x8d)];else{if(_0x47ddff[0x0][_0x116a5a(0x114)]==_0x116a5a(0xae))var _0x381d24=users['Chinese'];else{if(_0x47ddff[0x0][_0x116a5a(0x114)]==_0x116a5a(0x14b))var _0x381d24=users[_0x116a5a(0x8f)];}}}}}}}_0x2aac67[_0x116a5a(0x11d)](_0x116a5a(0xaa),{'success':_0x9354ac[_0x116a5a(0xf1)](_0x116a5a(0xbd)),'errors':_0x9354ac[_0x116a5a(0xf1)]('errors'),'role':_0xb74960,'profile':_0x3a6dc7,'warehouse':_0x2d6af7,'product':_0x35be9f,'adjustment':_0x53429e,'master_shop':_0x47ddff,'language':_0x381d24});}catch(_0x4c4354){console[_0x116a5a(0x13d)](_0x4c4354);}});function a0_0x1e8d(){var _0x4b96bb=['add_adjustment_finished','$warehouse_name','$product_details.rack','/view','An\x20error\x20occurred\x20while\x20saving\x20data.','\x20</h2>','2420089dUTKYS','ADJF-','warehouse','catch','bay','<html><head><title></title>','findById','$product_details.batch_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','all','<!DOCTYPE\x20html>','</body></html>','/view/:id','split','138888hZPBlZ','adjustment_finished','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details._id','toString','Chinese','push','getFullYear','string','logo','params','then','random','/adjustment_finished/preview/','$product_details','$product','edit_adjustment_finished','FGSEmail','email','Enabled','success','room','new_adjust_qty','/CheckingWarehouse','password','$product_details.bin','<div>','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','invoice','QA\x20Warehouse','</table>','production_date','image','product_details','JO_number','warehouse_name','redirect','<table\x20style=\x22width:\x20100%\x20!important;\x22>','11138224DKIqzk','unit','user','save','$name','json','aggregate','$date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</tbody>','product_date','forEach','True','</span>','product','batch_code','getMonth','map','post','$_id','$invoice','Primary_Units','../public/language/languages.json','findOne','German','message','Logo.png','Finished\x20Goods','$room','9724977QtERlF','exports','10ePiUWV','adjust_qty','$finalize','flash','1536128WZLuwM','Hindi','product_name','createTransport','adjustment\x20add\x20successfull','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Portuguese\x20(BR)','$product_details.type','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Spanish','product_code','<hr\x20class=\x22my-3\x22>','New_Qty_Converted','maxPerUnit','$product_details.secondary_unit','Rooms','</td>','stock','find','Adjustment\x20Finalize\x20Successfully','get','</head><body>','level','length','$product_details.floorlevel','status','</div>','minus','<h5>','master','<h2>\x20','$product_details.product_code','error','host','language','prod_cat','../models/all_models','/../public','<tr>','$product_details.bay','adjustment\x20data\x20update\x20successfully','secondary_unit','$product_details.maxProducts','render','types','product_stock','$product_details.storage','errors','215FrMRvF','$product_details.secondary_code','$product_details.maxPerUnit','Enclosed','getDate','edit_adjustment_finished_view','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','prod_name','/preview/:id','982443EcHDvi','46785qPLJJP','</tr>','6LQsFzt','role','nodemailer','site_title','purchases_data','$product.product_name','DRY\x20GOODS','prod_code','$product_details.invoice','$product_details.unit','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','French','sendMail','/adjustment/view','$product.room_names','log','port','body','Return\x20Rooms','floor','note','</h5>','$product_details.primary_code','132KpOGbV','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','$product_details.product_name','<strong>\x20Regards\x20</strong>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','expiry_date','Arabic\x20(ae)','filter','$product_details.product_stock','Adjustment\x20Mail','English\x20(US)','/adjustment_finished/view','$product_details.production_date','</thead>','staff','stockBefore','18XwcmaE','$product_details.expiry_date','English','Secondary_units','An\x20error\x20occurred.','foreach\x20newproduct','Portuguese','/view/add_adjustment','Arabic','date','../middleware/auth','room_names','_id','Ambient'];a0_0x1e8d=function(){return _0x4b96bb;};return a0_0x1e8d();}function a0_0x37f8(_0x51202c,_0x118b76){var _0x1e8d47=a0_0x1e8d();return a0_0x37f8=function(_0x37f87d,_0x44fe8e){_0x37f87d=_0x37f87d-0x8b;var _0x14cbab=_0x1e8d47[_0x37f87d];return _0x14cbab;},a0_0x37f8(_0x51202c,_0x118b76);}async function getRandom8DigitNumber(){var _0x4a7a28=a0_0x18887e;const _0x3951c4=0x989680,_0x112311=0x5f5e0ff,_0x1db863=Math[_0x4a7a28(0x141)](Math[_0x4a7a28(0xb5)]()*(_0x112311-_0x3951c4+0x1))+_0x3951c4;var _0x1eb135;const _0x16167c=await adjustment_finished[_0x4a7a28(0xe6)]({'invoice':_0x4a7a28(0x9c)+_0x1db863});return _0x16167c&&_0x16167c[_0x4a7a28(0x109)]>0x0?_0x1eb135=_0x4a7a28(0x9c)+_0x1db863:_0x1eb135=_0x4a7a28(0x9c)+_0x1db863,_0x1eb135;}router[a0_0x18887e(0x106)]('/view/add_adjustment',auth,async(_0x5a334b,_0x1d90e6)=>{var _0x4ee4d3=a0_0x18887e;try{const {username:_0x53b9a9,email:_0x13c65f,role:_0x39e69a}=_0x5a334b[_0x4ee4d3(0xd1)],_0x3645f6=_0x5a334b[_0x4ee4d3(0xd1)],_0x55a90a=await profile[_0x4ee4d3(0xe6)]({'email':_0x3645f6[_0x4ee4d3(0xbb)]}),_0x2a169d=await master_shop[_0x4ee4d3(0x104)]();let _0x3e3655;if(_0x3645f6[_0x4ee4d3(0x12f)]==_0x4ee4d3(0x153)){const _0x5ef27c=await staff[_0x4ee4d3(0xe6)]({'email':_0x3645f6['email']});_0x3e3655=await warehouse[_0x4ee4d3(0xd5)]([{'$match':{'status':_0x4ee4d3(0xbc),'name':_0x5ef27c[_0x4ee4d3(0x9d)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x4ee4d3(0xc6)}}},{'$group':{'_id':_0x4ee4d3(0xd3),'name':{'$first':_0x4ee4d3(0xd3)}}}]);}else _0x3e3655=await warehouse['aggregate']([{'$match':{'status':'Enabled','warehouse_category':_0x4ee4d3(0xea),'name':{'$ne':_0x4ee4d3(0xc6)}}},{'$group':{'_id':'$name','name':{'$first':_0x4ee4d3(0xd3)}}}]);const _0x234041=await product[_0x4ee4d3(0x104)]({}),_0x2f1bd8=await adjustment_finished[_0x4ee4d3(0x104)]({}),_0x5eb0ca=_0x2f1bd8[_0x4ee4d3(0x109)]+0x1,_0x4a2f13=_0x4ee4d3(0x9c)+_0x5eb0ca[_0x4ee4d3(0xad)]()['padStart'](0x5,'0');var _0x506fd5=['Ambient',_0x4ee4d3(0x125),_0x4ee4d3(0x140)];if(_0x2a169d[0x0][_0x4ee4d3(0x114)]==_0x4ee4d3(0x14f))var _0x21fcd7=users['English'];else{if(_0x2a169d[0x0][_0x4ee4d3(0x114)]=='Hindi')var _0x21fcd7=users['Hindi'];else{if(_0x2a169d[0x0]['language']==_0x4ee4d3(0xe7))var _0x21fcd7=users['German'];else{if(_0x2a169d[0x0]['language']==_0x4ee4d3(0xfb))var _0x21fcd7=users['Spanish'];else{if(_0x2a169d[0x0][_0x4ee4d3(0x114)]==_0x4ee4d3(0x139))var _0x21fcd7=users[_0x4ee4d3(0x139)];else{if(_0x2a169d[0x0][_0x4ee4d3(0x114)]=='Portuguese\x20(BR)')var _0x21fcd7=users[_0x4ee4d3(0x8d)];else{if(_0x2a169d[0x0]['language']==_0x4ee4d3(0xae))var _0x21fcd7=users[_0x4ee4d3(0xae)];else{if(_0x2a169d[0x0]['language']==_0x4ee4d3(0x14b))var _0x21fcd7=users[_0x4ee4d3(0x8f)];}}}}}}}const _0x3f0177=getRandom8DigitNumber();_0x3f0177[_0x4ee4d3(0xb4)](_0x127f02=>{var _0x12599d=_0x4ee4d3;_0x1d90e6[_0x12599d(0x11d)](_0x12599d(0x95),{'success':_0x5a334b[_0x12599d(0xf1)](_0x12599d(0xbd)),'errors':_0x5a334b[_0x12599d(0xf1)](_0x12599d(0x121)),'role':_0x3645f6,'profile':_0x55a90a,'warehouse':_0x3e3655,'product':_0x234041,'master_shop':_0x2a169d,'language':_0x21fcd7,'rooms_data':_0x506fd5,'invoice_no':_0x127f02});})[_0x4ee4d3(0x9e)](_0x2db7cf=>{var _0x41bd6f=_0x4ee4d3;_0x5a334b['flash']('errors',_0x41bd6f(0xab)),_0x1d90e6[_0x41bd6f(0xcd)](_0x41bd6f(0x13b));});}catch(_0x2d349e){console[_0x4ee4d3(0x13d)](_0x2d349e);}}),router[a0_0x18887e(0xe1)](a0_0x18887e(0x8e),auth,async(_0x2536cd,_0x3b49ed)=>{var _0x55db51=a0_0x18887e;try{const {warehouse_name:_0x33bc00,date:_0x3d3741,prod_name:_0x458dad,level:_0x21936b,isle:_0x1c7b23,pallet:_0x1725ae,stock:_0x4c000c,types:_0x2c0b3c,adjust_qty:_0x3d0511,new_adjust_qty:_0x12a6eb,note:_0x20aedd,Room_name:_0x37ba90,invoice:_0x45cca0,JO_number:_0x4752cf,expiry_date:_0x5d8f41}=_0x2536cd['body'];if(typeof _0x458dad==_0x55db51(0xb1))var _0x4e4676=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x129)]],_0x4b957e=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x108)]],_0x316ea6=[_0x2536cd['body'][_0x55db51(0x103)]],_0xd01010=[_0x2536cd[_0x55db51(0x13f)]['types']],_0x3a6c6d=[_0x2536cd[_0x55db51(0x13f)]['New_Qty_Converted_adj']],_0x55537a=[_0x2536cd['body'][_0x55db51(0xfe)]],_0x3f57e1=[_0x2536cd['body'][_0x55db51(0xe4)]],_0x286fda=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x158)]],_0x2a0b02=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x135)]],_0x52e0f6=[_0x2536cd['body'][_0x55db51(0xde)]],_0x35ddb6=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x14a)]],_0xc4d4ec=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0xd9)]],_0x20570a=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x115)]],_0x449f77=[_0x2536cd[_0x55db51(0x13f)][_0x55db51(0x101)]],_0x216968=[_0x2536cd['body'][_0x55db51(0xff)]],_0x5a0006=[_0x2536cd[_0x55db51(0x13f)]['prod_invoice']];else var _0x4e4676=[..._0x2536cd[_0x55db51(0x13f)]['prod_name']],_0x4b957e=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0x108)]],_0x316ea6=[..._0x2536cd['body'][_0x55db51(0x103)]],_0xd01010=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0x11e)]],_0x3a6c6d=[..._0x2536cd[_0x55db51(0x13f)]['New_Qty_Converted_adj']],_0x55537a=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0xfe)]],_0x3f57e1=[..._0x2536cd[_0x55db51(0x13f)]['Primary_Units']],_0x286fda=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0x158)]],_0x2a0b02=[..._0x2536cd[_0x55db51(0x13f)]['prod_code']],_0x52e0f6=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0xde)]],_0x35ddb6=[..._0x2536cd['body']['expiry_date']],_0xc4d4ec=[..._0x2536cd['body'][_0x55db51(0xd9)]],_0x20570a=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0x115)]],_0x449f77=[..._0x2536cd[_0x55db51(0x13f)][_0x55db51(0x101)]],_0x216968=[..._0x2536cd['body'][_0x55db51(0xff)]],_0x5a0006=[..._0x2536cd['body']['prod_invoice']];const _0x12aa6b=_0x4e4676[_0x55db51(0xe0)](_0x3266ba=>{return _0x3266ba={'product_name':_0x3266ba};});_0x4b957e['forEach']((_0xe0601e,_0x5986d0)=>{var _0x19002f=_0x55db51;_0x12aa6b[_0x5986d0][_0x19002f(0x9f)]=_0xe0601e;}),_0x316ea6['forEach']((_0x50a0ed,_0x21ad1b)=>{var _0x52e6ba=_0x55db51;_0x12aa6b[_0x21ad1b][_0x52e6ba(0x154)]=_0x50a0ed;}),_0xd01010[_0x55db51(0xda)]((_0x472848,_0xabb1e0)=>{var _0x210e4b=_0x55db51;_0x12aa6b[_0xabb1e0][_0x210e4b(0x11e)]=_0x472848;}),_0x3a6c6d['forEach']((_0x155d65,_0xdbd332)=>{var _0x283f09=_0x55db51;_0x12aa6b[_0xdbd332][_0x283f09(0xef)]=_0x155d65;}),_0x55537a['forEach']((_0x11fa1d,_0x404b58)=>{_0x12aa6b[_0x404b58]['new_adjust_qty']=_0x11fa1d;}),_0x3f57e1['forEach']((_0x55cc44,_0x521297)=>{var _0x26bf58=_0x55db51;_0x12aa6b[_0x521297][_0x26bf58(0xd0)]=_0x55cc44;}),_0x286fda[_0x55db51(0xda)]((_0x3ea3a3,_0x139b4f)=>{var _0xe87d12=_0x55db51;_0x12aa6b[_0x139b4f][_0xe87d12(0x11b)]=_0x3ea3a3;}),_0x2a0b02[_0x55db51(0xda)]((_0x3d0515,_0x5d50fc)=>{var _0x16691c=_0x55db51;_0x12aa6b[_0x5d50fc][_0x16691c(0xfc)]=_0x3d0515;}),_0x52e0f6['forEach']((_0x2bfbd1,_0x4c3595)=>{var _0x2711ce=_0x55db51;_0x12aa6b[_0x4c3595][_0x2711ce(0xde)]=_0x2bfbd1;}),_0x35ddb6[_0x55db51(0xda)]((_0x5a2e70,_0x1ff5ef)=>{var _0x57d270=_0x55db51;_0x12aa6b[_0x1ff5ef][_0x57d270(0x14a)]=_0x5a2e70;}),_0xc4d4ec['forEach']((_0xf25ef7,_0x38536d)=>{_0x12aa6b[_0x38536d]['production_date']=_0xf25ef7;}),_0x20570a[_0x55db51(0xda)]((_0x318761,_0x26e6cc)=>{var _0x188bf1=_0x55db51;_0x12aa6b[_0x26e6cc][_0x188bf1(0x115)]=_0x318761;}),_0x449f77['forEach']((_0x68b11e,_0x25b909)=>{_0x12aa6b[_0x25b909]['room_names']=_0x68b11e;}),_0x216968[_0x55db51(0xda)]((_0x5e46f1,_0x532d2e)=>{var _0x28aff7=_0x55db51;_0x12aa6b[_0x532d2e][_0x28aff7(0xff)]=_0x5e46f1;}),_0x5a0006[_0x55db51(0xda)]((_0x5746d4,_0x42b97e)=>{var _0x180cff=_0x55db51;_0x12aa6b[_0x42b97e][_0x180cff(0xc5)]=_0x5746d4;});const _0x29c754=_0x12aa6b[_0x55db51(0x14c)](_0x4780ee=>_0x4780ee[_0x55db51(0xef)]!=='0'&&_0x4780ee[_0x55db51(0xef)]!=='');var _0xba0326=0x0;_0x29c754['forEach'](_0x1dae93=>{var _0x236c8b=_0x55db51;console[_0x236c8b(0x13d)](_0x236c8b(0x8c),_0x1dae93),parseInt(_0x1dae93[_0x236c8b(0xef)])<=0x0&&_0xba0326++;});if(_0xba0326!=0x0)return _0x2536cd[_0x55db51(0xf1)](_0x55db51(0x121),_0x55db51(0x128)),_0x3b49ed[_0x55db51(0xcd)]('back');const _0x468ee6=new adjustment_finished({'warehouse_name':_0x33bc00,'date':_0x3d3741,'product':_0x29c754,'note':_0x20aedd,'room':_0x37ba90,'invoice':_0x45cca0,'JO_number':_0x4752cf,'expiry_date':_0x5d8f41}),_0x59234d=await _0x468ee6['save']();_0x2536cd[_0x55db51(0xf1)]('success',_0x55db51(0xf6)),_0x3b49ed['redirect'](_0x55db51(0xb6)+_0x59234d[_0x55db51(0x93)]);}catch(_0x94fa4){console[_0x55db51(0x13d)](_0x94fa4),_0x3b49ed['status'](0xc8)[_0x55db51(0xd4)]({'message':_0x94fa4[_0x55db51(0xe8)]});}}),router[a0_0x18887e(0x106)](a0_0x18887e(0x12a),auth,async(_0x11796a,_0x1b3be6)=>{var _0x5bfc95=a0_0x18887e;try{const {username:_0x56476f,email:_0xfb88d5,role:_0x57e440}=_0x11796a[_0x5bfc95(0xd1)],_0x4f7dab=_0x11796a[_0x5bfc95(0xd1)],_0xc17d9c=await profile['findOne']({'email':_0x4f7dab['email']}),_0x40de62=await master_shop['find'](),_0x4e343e=_0x11796a[_0x5bfc95(0xb3)]['id'],_0x1f7c6b=await adjustment_finished[_0x5bfc95(0xa1)]({'_id':_0x4e343e}),_0x5137ae=await purchases[_0x5bfc95(0xd5)]([{'$match':{'warehouse_name':_0x1f7c6b[_0x5bfc95(0xcc)]}},{'$unwind':_0x5bfc95(0xb8)},{'$group':{'_id':_0x5bfc95(0x133)}}]);console[_0x5bfc95(0x13d)]('purchases_data',_0x5137ae);const _0x9b6458=await product[_0x5bfc95(0x104)]({}),_0x725999=await warehouse[_0x5bfc95(0xd5)]([{'$match':{'name':_0x1f7c6b[_0x5bfc95(0xcc)],'warehouse_category':_0x5bfc95(0xea)}},{'$unwind':_0x5bfc95(0xb7)},{'$group':{'_id':_0x5bfc95(0xac),'name':{'$first':_0x5bfc95(0x147)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x5bfc95(0x119)},'bin':{'$first':_0x5bfc95(0xc2)},'type':{'$first':_0x5bfc95(0xf9)},'floorlevel':{'$first':_0x5bfc95(0x10a)},'primary_code':{'$first':_0x5bfc95(0x144)},'secondary_code':{'$first':_0x5bfc95(0x123)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x5bfc95(0x97)},'expiry_date':{'$first':_0x5bfc95(0x156)},'production_date':{'$first':_0x5bfc95(0x151)},'batch_code':{'$first':_0x5bfc95(0xa2)},'maxPerUnit':{'$first':_0x5bfc95(0x124)},'room':{'$first':_0x5bfc95(0xeb)}}}]);if(_0x40de62[0x0]['language']==_0x5bfc95(0x14f)){var _0x561424=users[_0x5bfc95(0x157)];console['log'](_0x561424);}else{if(_0x40de62[0x0][_0x5bfc95(0x114)]==_0x5bfc95(0xf3))var _0x561424=users[_0x5bfc95(0xf3)];else{if(_0x40de62[0x0]['language']=='German')var _0x561424=users[_0x5bfc95(0xe7)];else{if(_0x40de62[0x0][_0x5bfc95(0x114)]==_0x5bfc95(0xfb))var _0x561424=users[_0x5bfc95(0xfb)];else{if(_0x40de62[0x0][_0x5bfc95(0x114)]==_0x5bfc95(0x139))var _0x561424=users[_0x5bfc95(0x139)];else{if(_0x40de62[0x0][_0x5bfc95(0x114)]==_0x5bfc95(0xf8))var _0x561424=users[_0x5bfc95(0x8d)];else{if(_0x40de62[0x0][_0x5bfc95(0x114)]==_0x5bfc95(0xae))var _0x561424=users[_0x5bfc95(0xae)];else{if(_0x40de62[0x0][_0x5bfc95(0x114)]=='Arabic\x20(ae)')var _0x561424=users[_0x5bfc95(0x8f)];}}}}}}}_0x1b3be6[_0x5bfc95(0x11d)](_0x5bfc95(0x127),{'success':_0x11796a['flash'](_0x5bfc95(0xbd)),'errors':_0x11796a[_0x5bfc95(0xf1)]('errors'),'role':_0x4f7dab,'profile':_0xc17d9c,'adjustment':_0x1f7c6b,'stock':_0x725999,'master_shop':_0x40de62,'warehouse_name':_0x5137ae,'unit':_0x9b6458,'language':_0x561424});}catch(_0x30e69c){console[_0x5bfc95(0x13d)](_0x30e69c),_0x1b3be6[_0x5bfc95(0x10b)](0xc8)[_0x5bfc95(0xd4)]({'message':_0x30e69c[_0x5bfc95(0xe8)]});}}),router[a0_0x18887e(0xe1)](a0_0x18887e(0x12a),auth,async(_0x14c088,_0x55a521)=>{var _0x304649=a0_0x18887e;try{const {invoice:_0x279b79,warehouse_name:_0x2a4104,Room_name:_0x58492c}=_0x14c088[_0x304649(0x13f)],_0x1afcfa=_0x14c088[_0x304649(0xb3)]['id'],_0x2c7f4c=await adjustment_finished[_0x304649(0xa1)]({'_id':_0x1afcfa});var _0x4142ce;const _0x4726e6=_0x2c7f4c[_0x304649(0xdd)][_0x304649(0xe0)](async _0x30c286=>{var _0x2b2a95=_0x304649;if(_0x30c286['adjust_qty']>0x0){_0x4142ce=await warehouse[_0x2b2a95(0xe6)]({'name':_0x2a4104,'room':_0x30c286['room_names'],'warehouse_category':_0x2b2a95(0xea)});const _0xba72d9=_0x4142ce[_0x2b2a95(0xca)][_0x2b2a95(0xe0)](_0x3a2b05=>{var _0x57b92f=_0x2b2a95;console[_0x57b92f(0x13d)](_0x30c286[_0x57b92f(0x11e)]);if(_0x30c286[_0x57b92f(0x11e)]=='minus')_0x3a2b05['product_name']==_0x30c286[_0x57b92f(0xf4)]&&_0x3a2b05['bay']==_0x30c286[_0x57b92f(0x9f)]&&_0x3a2b05[_0x57b92f(0x14a)]==_0x30c286[_0x57b92f(0x14a)]&&_0x3a2b05['production_date']==_0x30c286['production_date']&&_0x3a2b05[_0x57b92f(0xde)]==_0x30c286[_0x57b92f(0xde)]&&_0x3a2b05[_0x57b92f(0xc5)]==_0x30c286[_0x57b92f(0xc5)]&&(_0x3a2b05[_0x57b92f(0x11f)]=_0x3a2b05[_0x57b92f(0x11f)]-_0x30c286['adjust_qty']);else _0x30c286['types']=='add'&&(_0x3a2b05[_0x57b92f(0xf4)]==_0x30c286[_0x57b92f(0xf4)]&&_0x3a2b05[_0x57b92f(0x9f)]==_0x30c286[_0x57b92f(0x9f)]&&_0x3a2b05[_0x57b92f(0x14a)]==_0x30c286[_0x57b92f(0x14a)]&&_0x3a2b05[_0x57b92f(0xc8)]==_0x30c286['production_date']&&_0x3a2b05['batch_code']==_0x30c286[_0x57b92f(0xde)]&&_0x3a2b05[_0x57b92f(0xc5)]==_0x30c286[_0x57b92f(0xc5)]&&(_0x3a2b05[_0x57b92f(0x11f)]=_0x3a2b05[_0x57b92f(0x11f)]+_0x30c286[_0x57b92f(0xef)]));});}return _0x4142ce;});Promise[_0x304649(0xa4)](_0x4726e6)[_0x304649(0xb4)](async _0x310fc9=>{var _0x8e7108=_0x304649;try{for(const _0x8fafb1 of _0x310fc9){await _0x8fafb1[_0x8e7108(0xd2)]();}_0x2c7f4c['finalize']=_0x8e7108(0xdb);const _0x3e8d9d=await _0x2c7f4c[_0x8e7108(0xd2)](),_0x578dee=await master_shop[_0x8e7108(0x104)](),_0x2bc946=await email_settings['findOne'](),_0x1d1a1d=await supervisor_settings[_0x8e7108(0x104)]();var _0x9d4603=_0x2c7f4c[_0x8e7108(0xdd)],_0x189675='',_0x554ad6;for(_0x554ad6 in _0x9d4603){var _0x1eb467='FG';_0x2c7f4c[_0x8e7108(0xcc)]==_0x8e7108(0x134)&&(_0x1eb467='DG'),_0x189675+=_0x8e7108(0x118)+_0x8e7108(0x138)+_0x9d4603[_0x554ad6]['product_name']+_0x8e7108(0x102)+_0x8e7108(0x138)+_0x9d4603[_0x554ad6][_0x8e7108(0xfc)]+_0x8e7108(0x102)+_0x8e7108(0x138)+_0x9d4603[_0x554ad6][_0x8e7108(0xef)]+_0x8e7108(0x102)+_0x8e7108(0x138)+_0x9d4603[_0x554ad6][_0x8e7108(0xd0)]+_0x8e7108(0x102)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x9d4603[_0x554ad6][_0x8e7108(0x11b)]+_0x8e7108(0x102)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c7f4c['warehouse_name']+_0x8e7108(0x102)+_0x8e7108(0x138)+_0x9d4603[_0x554ad6][_0x8e7108(0x92)]+_0x8e7108(0x102)+_0x8e7108(0x138)+_0x1eb467+_0x9d4603[_0x554ad6]['bay']+_0x8e7108(0x102)+_0x8e7108(0x12d);}let _0x44edc8=nodemailer[_0x8e7108(0xf5)]({'host':_0x2bc946[_0x8e7108(0x113)],'port':Number(_0x2bc946[_0x8e7108(0x13e)]),'secure':![],'auth':{'user':_0x2bc946['email'],'pass':_0x2bc946[_0x8e7108(0xc1)]}}),_0x3cba8c={'from':_0x2bc946['email'],'to':_0x1d1a1d[0x0][_0x8e7108(0xba)],'subject':_0x8e7108(0x14e),'attachments':[{'filename':_0x8e7108(0xe9),'path':__dirname+_0x8e7108(0x117)+'/upload/'+_0x578dee[0x0][_0x8e7108(0xc9)],'cid':_0x8e7108(0xb2)}],'html':_0x8e7108(0xa5)+_0x8e7108(0xa0)+_0x8e7108(0x107)+_0x8e7108(0xc3)+_0x8e7108(0xfa)+_0x8e7108(0xc3)+_0x8e7108(0xf7)+_0x8e7108(0x10c)+_0x8e7108(0xc3)+_0x8e7108(0x110)+_0x578dee[0x0]['site_title']+_0x8e7108(0x9a)+_0x8e7108(0x10c)+_0x8e7108(0x10c)+_0x8e7108(0xfd)+_0x8e7108(0xc3)+'<h5\x20style=\x22text-align:\x20left;\x22>'+'\x20Order\x20Number\x20:\x20'+_0x2c7f4c[_0x8e7108(0xc5)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2c7f4c[_0x8e7108(0x90)]+'\x20'+_0x8e7108(0xdc)+'</h5>'+_0x8e7108(0x10c)+_0x8e7108(0xce)+_0x8e7108(0xc4)+_0x8e7108(0x118)+_0x8e7108(0x149)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x8e7108(0xa3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x8e7108(0xd7)+_0x8e7108(0x146)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x8e7108(0x12d)+_0x8e7108(0x152)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x189675+'\x20'+_0x8e7108(0xd8)+_0x8e7108(0xc7)+'<div>'+_0x8e7108(0x148)+_0x8e7108(0x10e)+_0x578dee[0x0][_0x8e7108(0x131)]+_0x8e7108(0x143)+_0x8e7108(0x10c)+_0x8e7108(0x10c)+_0x8e7108(0xa6)};_0x44edc8[_0x8e7108(0x13a)](_0x3cba8c,function(_0x1374f8,_0x48f814){var _0x216423=_0x8e7108;_0x1374f8?(console[_0x216423(0x13d)](_0x1374f8),console['log']('Error\x20Occurs')):console['log']('Email\x20sent\x20successfully');}),_0x14c088[_0x8e7108(0xf1)](_0x8e7108(0xbd),_0x8e7108(0x105)),_0x55a521[_0x8e7108(0xcd)]('/picking_list/PDF_adjustment/'+_0x3e8d9d[_0x8e7108(0x93)]);}catch(_0x29ab37){console[_0x8e7108(0x112)](_0x29ab37),_0x55a521[_0x8e7108(0x10b)](0x1f4)['json']({'error':_0x8e7108(0x99)});}})[_0x304649(0x9e)](_0x482d2c=>{var _0x4ed689=_0x304649;console[_0x4ed689(0x112)](_0x482d2c),_0x55a521[_0x4ed689(0x10b)](0x1f4)[_0x4ed689(0xd4)]({'error':_0x4ed689(0x8b)});});}catch(_0x68c5b3){_0x55a521[_0x304649(0xd4)]({'message':_0x68c5b3['message']});}}),router[a0_0x18887e(0x106)](a0_0x18887e(0xa7),auth,async(_0x23bf79,_0x361ecc)=>{var _0x9f95df=a0_0x18887e;try{const {username:_0x1596eb,email:_0x118ffd,role:_0x49c00a}=_0x23bf79[_0x9f95df(0xd1)],_0x26b4f1=_0x23bf79['user'],_0x3f6b94=await profile[_0x9f95df(0xe6)]({'email':_0x26b4f1[_0x9f95df(0xbb)]}),_0x3579db=await master_shop['find']();console[_0x9f95df(0x13d)](_0x9f95df(0x10f),_0x3579db);const _0x4bb335=_0x23bf79[_0x9f95df(0xb3)]['id'],_0x245cee=await adjustment_finished[_0x9f95df(0xa1)]({'_id':_0x4bb335});let _0x52d3d0=new Date(_0x245cee['expiry_date']),_0x348cb1=('0'+_0x52d3d0[_0x9f95df(0x126)]())['slice'](-0x2),_0x5c2d29=('0'+(_0x52d3d0[_0x9f95df(0xdf)]()+0x1))['slice'](-0x2),_0x1f83cf=_0x52d3d0[_0x9f95df(0xb0)](),_0x353398=_0x1f83cf+'-'+_0x5c2d29+'-'+_0x348cb1;var _0x306f8c=[_0x9f95df(0x94),_0x9f95df(0x125),'Return\x20Rooms'];const _0x5c4713=await purchases[_0x9f95df(0xd5)]([{'$match':{'warehouse_name':_0x245cee[_0x9f95df(0xcc)]}},{'$unwind':_0x9f95df(0xb8)},{'$group':{'_id':_0x9f95df(0x133)}}]);console[_0x9f95df(0x13d)](_0x9f95df(0x132),_0x5c4713);const _0x39925f=await product[_0x9f95df(0x104)]({}),_0x12d288=await warehouse[_0x9f95df(0xd5)]([{'$match':{'name':_0x245cee[_0x9f95df(0xcc)],'room':_0x245cee[_0x9f95df(0xbe)]}},{'$unwind':_0x9f95df(0xb7)},{'$group':{'_id':_0x9f95df(0xac),'name':{'$first':_0x9f95df(0x147)},'product_stock':{'$first':_0x9f95df(0x14d)},'bay':{'$first':_0x9f95df(0x119)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x9f95df(0xf9)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x9f95df(0x144)},'secondary_code':{'$first':_0x9f95df(0x123)},'product_code':{'$first':_0x9f95df(0x111)},'storage':{'$first':_0x9f95df(0x120)},'rack':{'$first':_0x9f95df(0x97)}}}]);if(_0x3579db[0x0][_0x9f95df(0x114)]=='English\x20(US)'){var _0x4b93e7=users[_0x9f95df(0x157)];console[_0x9f95df(0x13d)](_0x4b93e7);}else{if(_0x3579db[0x0]['language']==_0x9f95df(0xf3))var _0x4b93e7=users['Hindi'];else{if(_0x3579db[0x0]['language']==_0x9f95df(0xe7))var _0x4b93e7=users[_0x9f95df(0xe7)];else{if(_0x3579db[0x0][_0x9f95df(0x114)]=='Spanish')var _0x4b93e7=users['Spanish'];else{if(_0x3579db[0x0][_0x9f95df(0x114)]==_0x9f95df(0x139))var _0x4b93e7=users[_0x9f95df(0x139)];else{if(_0x3579db[0x0][_0x9f95df(0x114)]==_0x9f95df(0xf8))var _0x4b93e7=users['Portuguese'];else{if(_0x3579db[0x0][_0x9f95df(0x114)]==_0x9f95df(0xae))var _0x4b93e7=users['Chinese'];else{if(_0x3579db[0x0][_0x9f95df(0x114)]==_0x9f95df(0x14b))var _0x4b93e7=users[_0x9f95df(0x8f)];}}}}}}}_0x361ecc['render'](_0x9f95df(0xb9),{'success':_0x23bf79[_0x9f95df(0xf1)]('success'),'errors':_0x23bf79['flash'](_0x9f95df(0x121)),'role':_0x26b4f1,'profile':_0x3f6b94,'adjustment':_0x245cee,'stock':_0x12d288,'master_shop':_0x3579db,'warehouse_name':_0x5c4713,'unit':_0x39925f,'language':_0x4b93e7,'rooms_data':_0x306f8c,'ed_fullDate':_0x353398});}catch(_0x1a6b0b){console[_0x9f95df(0x13d)](_0x1a6b0b),_0x361ecc[_0x9f95df(0x10b)](0xc8)[_0x9f95df(0xd4)]({'message':_0x1a6b0b['message']});}}),router['post'](a0_0x18887e(0xa7),auth,async(_0xa16eea,_0x1ecffa)=>{var _0x849b=a0_0x18887e;try{const _0x149a25=_0xa16eea[_0x849b(0xb3)]['id'],_0x31b155=await adjustment_finished[_0x849b(0xa1)]({'_id':_0x149a25}),_0x59fcde=await warehouse[_0x849b(0xe6)]({'name':_0x31b155[_0x849b(0xcc)],'room':_0x31b155[_0x849b(0xbe)]}),{warehouse_name:_0x2d10e7,date:_0x11394b,prod_name:_0x54c094,level:_0x3558e7,isle:_0x52d5b9,pallet:_0x36414d,stock:_0x4d3962,types:_0x3d91ed,adjust_qty:_0x1bc0e3,new_adjust_qty:_0x436b70,note:_0x15a40e,Room_name:_0x35766f,invoice:_0x1bca19,JO_number:_0x599044}=_0xa16eea[_0x849b(0x13f)];if(typeof _0x54c094==_0x849b(0xb1))var _0x2d6dbe=[_0xa16eea['body'][_0x849b(0x129)]],_0x2eca8a=[_0xa16eea[_0x849b(0x13f)]['level']],_0x206d22=[_0xa16eea['body'][_0x849b(0x103)]],_0x18e123=[_0xa16eea[_0x849b(0x13f)][_0x849b(0x11e)]],_0x24ec74=[_0xa16eea['body']['adjust_qty']],_0x2446a0=[_0xa16eea[_0x849b(0x13f)][_0x849b(0xbf)]],_0x1428c5=[_0xa16eea[_0x849b(0x13f)]['prod_code']],_0x35a017=[_0xa16eea[_0x849b(0x13f)][_0x849b(0xd0)]],_0x241c74=[_0xa16eea[_0x849b(0x13f)][_0x849b(0x158)]],_0x3e755b=[_0xa16eea['body']['batch_code']],_0x1efd17=[_0xa16eea[_0x849b(0x13f)][_0x849b(0x14a)]];else var _0x2d6dbe=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0x129)]],_0x2eca8a=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0x108)]],_0x206d22=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0x103)]],_0x18e123=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0x11e)]],_0x24ec74=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0xef)]],_0x2446a0=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0xbf)]],_0x1428c5=[..._0xa16eea['body']['prod_code']],_0x35a017=[..._0xa16eea['body'][_0x849b(0xd0)]],_0x241c74=[..._0xa16eea[_0x849b(0x13f)][_0x849b(0x158)]],_0x3e755b=[..._0xa16eea['body'][_0x849b(0xde)]],_0x1efd17=[..._0xa16eea['body'][_0x849b(0x14a)]];const _0x518d73=_0x2d6dbe['map'](_0x1cbc2d=>{return _0x1cbc2d={'product_name':_0x1cbc2d};});_0x2eca8a[_0x849b(0xda)]((_0x5d25c2,_0x2773a2)=>{var _0xfb36b=_0x849b;_0x518d73[_0x2773a2][_0xfb36b(0x9f)]=_0x5d25c2;}),_0x206d22[_0x849b(0xda)]((_0x115232,_0x54af4a)=>{var _0x2957d8=_0x849b;_0x518d73[_0x54af4a][_0x2957d8(0x154)]=_0x115232;}),_0x18e123['forEach']((_0x56348a,_0x4e0c9f)=>{var _0x3b3b27=_0x849b;_0x518d73[_0x4e0c9f][_0x3b3b27(0x11e)]=_0x56348a;}),_0x24ec74[_0x849b(0xda)]((_0x43f48e,_0x4f830d)=>{_0x518d73[_0x4f830d]['adjust_qty']=_0x43f48e;}),_0x2446a0[_0x849b(0xda)]((_0x208564,_0x3ac136)=>{var _0x44b817=_0x849b;_0x518d73[_0x3ac136][_0x44b817(0xbf)]=_0x208564;}),_0x35a017[_0x849b(0xda)]((_0x4bd007,_0x15c788)=>{var _0x5da2cb=_0x849b;_0x518d73[_0x15c788][_0x5da2cb(0xd0)]=_0x4bd007;}),_0x241c74['forEach']((_0x224bb1,_0x549b82)=>{var _0x1bc3a8=_0x849b;_0x518d73[_0x549b82][_0x1bc3a8(0x11b)]=_0x224bb1;}),_0x1428c5[_0x849b(0xda)]((_0x5578ff,_0x33182f)=>{var _0x350153=_0x849b;_0x518d73[_0x33182f][_0x350153(0xfc)]=_0x5578ff;}),_0x3e755b[_0x849b(0xda)]((_0x112e76,_0x30a83d)=>{var _0x427cdf=_0x849b;_0x518d73[_0x30a83d][_0x427cdf(0xde)]=_0x112e76;}),_0x1efd17[_0x849b(0xda)]((_0x19bcc1,_0x1664e3)=>{var _0x53960c=_0x849b;_0x518d73[_0x1664e3][_0x53960c(0x14a)]=_0x19bcc1;});const _0x5da610=_0x518d73[_0x849b(0x14c)](_0x15fa20=>_0x15fa20[_0x849b(0xef)]!=='0'&&_0x15fa20[_0x849b(0xef)]!=='');var _0x5ca524=0x0;_0x5da610[_0x849b(0xda)](_0x53342f=>{var _0x168c9d=_0x849b;console[_0x168c9d(0x13d)](_0x168c9d(0x8c),_0x53342f),parseInt(_0x53342f[_0x168c9d(0xef)])<=0x0&&_0x5ca524++;});if(_0x5ca524!=0x0)return _0xa16eea[_0x849b(0xf1)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x1ecffa[_0x849b(0xcd)]('back');_0x31b155['warehouse_name']=_0x2d10e7,_0x31b155[_0x849b(0x90)]=_0x11394b,_0x31b155['product']=_0x5da610,_0x31b155[_0x849b(0x142)]=_0x15a40e,_0x31b155[_0x849b(0xbe)]=_0x35766f,_0x31b155[_0x849b(0xc5)]=_0x1bca19,_0x31b155[_0x849b(0xcb)]=_0x599044;const _0x264ec4=await _0x31b155[_0x849b(0xd2)](),_0xaa7433=await warehouse['findOne']({'name':_0x2d10e7,'room':_0x35766f});_0x264ec4['product'][_0x849b(0xda)](_0x240c46=>{var _0x340bad=_0x849b;const _0x2ca80b=_0xaa7433[_0x340bad(0xca)][_0x340bad(0xe0)](_0x24a46e=>{var _0x12a72a=_0x340bad;_0x240c46[_0x12a72a(0x11e)]==_0x12a72a(0x10d)?_0x24a46e['product_name']==_0x240c46[_0x12a72a(0xf4)]&&_0x24a46e['bay']==_0x240c46[_0x12a72a(0x9f)]&&(_0x24a46e[_0x12a72a(0x11f)]=parseInt(_0x24a46e[_0x12a72a(0x11f)])-parseInt(_0x240c46['adjust_qty'])):_0x24a46e[_0x12a72a(0xf4)]==_0x240c46['product_name']&&_0x24a46e[_0x12a72a(0x9f)]==_0x240c46[_0x12a72a(0x9f)]&&(_0x24a46e[_0x12a72a(0x11f)]=parseInt(_0x24a46e[_0x12a72a(0x11f)])+parseInt(_0x240c46[_0x12a72a(0xef)]));});}),await _0xaa7433[_0x849b(0xd2)](),_0xa16eea[_0x849b(0xf1)](_0x849b(0xbd),_0x849b(0x11a)),_0x1ecffa['redirect'](_0x849b(0x150));}catch(_0x3cbbf1){console[_0x849b(0x13d)](_0x3cbbf1);}}),router[a0_0x18887e(0xe1)]('/barcode_scanner',async(_0xed0c86,_0x438c13)=>{var _0x5e5f9f=a0_0x18887e;const {primary_code:_0xbb651f,warehouse_data:_0x4e72d4,rooms_data:_0x1be0d0,Roomslist:_0x426786}=_0xed0c86['body'],_0x5b06bd=_0x426786[_0x5e5f9f(0xa8)](','),_0x3f0066=[];async function _0x4871e1(_0x14f60a){var _0x2a35bb=_0x5e5f9f;const _0x37f173=await warehouse['aggregate']([{'$match':{'name':_0x4e72d4,'room':_0x14f60a}},{'$unwind':_0x2a35bb(0xb7)},{'$match':{'product_details.primary_code':_0xbb651f}},{'$group':{'_id':_0x2a35bb(0xac),'name':{'$first':_0x2a35bb(0x147)},'product_stock':{'$first':_0x2a35bb(0x14d)},'primary_code':{'$first':_0x2a35bb(0x144)},'secondary_code':{'$first':_0x2a35bb(0x123)},'product_code':{'$first':_0x2a35bb(0x111)},'level':{'$first':_0x2a35bb(0x119)},'isle':{'$first':_0x2a35bb(0xc2)},'type':{'$first':_0x2a35bb(0xf9)},'pallet':{'$first':_0x2a35bb(0x10a)},'unit':{'$first':_0x2a35bb(0x137)},'secondary_unit':{'$first':_0x2a35bb(0x100)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2a35bb(0x97)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2a35bb(0x151)},'batch_code':{'$first':_0x2a35bb(0xa2)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2a35bb(0x124)},'roomNamed':{'$first':_0x2a35bb(0xeb)},'invoice':{'$first':_0x2a35bb(0x136)}}}]),_0xc2bfe0=await warehouse[_0x2a35bb(0xd5)]([{'$match':{'name':_0x4e72d4,'room':_0x14f60a}},{'$unwind':_0x2a35bb(0xb7)},{'$match':{'product_details.secondary_code':_0xbb651f}},{'$group':{'_id':_0x2a35bb(0xac),'name':{'$first':_0x2a35bb(0x147)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2a35bb(0x119)},'isle':{'$first':_0x2a35bb(0xc2)},'type':{'$first':_0x2a35bb(0xf9)},'pallet':{'$first':_0x2a35bb(0x10a)},'unit':{'$first':_0x2a35bb(0x137)},'secondary_unit':{'$first':_0x2a35bb(0x100)},'storage':{'$first':_0x2a35bb(0x120)},'rack':{'$first':_0x2a35bb(0x97)},'expiry_date':{'$first':_0x2a35bb(0x156)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2a35bb(0xa2)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x2a35bb(0xeb)},'invoice':{'$first':_0x2a35bb(0x136)}}}]);if(_0x37f173[_0x2a35bb(0x109)]>0x0)_0x3f0066[_0x2a35bb(0xaf)](_0x37f173);else _0xc2bfe0[_0x2a35bb(0x109)]>0x0&&_0x3f0066[_0x2a35bb(0xaf)](_0xc2bfe0);}const _0x3806b6=_0x5b06bd[_0x5e5f9f(0xe0)](_0xd1d67f=>_0x4871e1(_0xd1d67f));await Promise[_0x5e5f9f(0xa4)](_0x3806b6),_0x438c13[_0x5e5f9f(0xd4)](_0x3f0066);}),router[a0_0x18887e(0xe1)](a0_0x18887e(0xc0),async(_0x3031ab,_0xb34c9f)=>{var _0x3292ae=a0_0x18887e;const {productCode:_0x1b9558,bay:_0x219579,warehouses:_0x6701d6,room:_0x5f5986}=_0x3031ab['body'];console[_0x3292ae(0x13d)](_0x3031ab[_0x3292ae(0x13f)]);try{const _0x4fb47c=await warehouse[_0x3292ae(0xd5)]([{'$match':{'name':_0x6701d6,'room':_0x5f5986}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x219579)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3292ae(0x147)},'product_stock':{'$first':_0x3292ae(0x14d)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x3292ae(0x11c)}}}]);_0xb34c9f[_0x3292ae(0x10b)](0xc8)[_0x3292ae(0xd4)](_0x4fb47c);}catch(_0x596d04){_0xb34c9f['status'](0x194)[_0x3292ae(0xd4)]({'message':_0x596d04[_0x3292ae(0xe8)]});}}),module[a0_0x18887e(0xed)]=router;