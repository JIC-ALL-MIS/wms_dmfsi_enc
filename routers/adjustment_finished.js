var a0_0x3fa569=a0_0x1a52;function a0_0x159b(){var _0x10e38e=['get','expiry_date','$product_details.expiry_date','user','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.type','$name','padStart','then','json','683960lqSZFM','New_Qty_Converted','$product_details.secondary_unit','$product_details.maxPerUnit','errors','createTransport','</td>','Hindi','batch_code','$product_details.primary_code','Portuguese\x20(BR)','product','success','Chinese','unit','FGSEmail','adjust_qty','product_code','/adjustment_finished/view','<h2>\x20','Adjustment\x20Finalize\x20Successfully','Arabic','<!DOCTYPE\x20html>','Finished\x20Goods','map','find','minus','toString','</span>','findById','/view/:id','ADJF-','sendMail','Secondary_units','$product.room_names','$product_details.rack','filter','site_title','Return\x20Rooms','</div>','792597JfIJWK','$product_details.product_stock','nodemailer','product_stock','logo','length','3TOMpus','slice','/adjustment_finished/preview/','Router','room','adjustment\x20add\x20successfull','An\x20error\x20occurred\x20while\x20saving\x20data.','<strong>\x20Regards\x20</strong>','DRY\x20GOODS','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','Arabic\x20(ae)','/picking_list/PDF_adjustment/','Portuguese','/../public','product_details','$product_details.production_date','$product_details.bay','$product_details._id','Email\x20sent\x20successfully','Rooms','date','There\x27s\x20a\x20error\x20in\x20this\x20transaction','_id','split','image','286256NoQpUn','$room','</h5>','An\x20error\x20occurred.','finalize','message','aggregate','/barcode_scanner','staff','port','$product_details.maxProducts','invoice','status','prod_cat','log','product_name','getMonth','Error\x20Occurs','redirect','room_names','language','new_adjust_qty','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.batch_code','/upload/','prod_name','types','../middleware/auth','$date','Enabled','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','/view','edit_adjustment_finished','exports','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','add_adjustment_finished','$product_details','random','error','../models/all_models','Primary_Units','4852197jOCANo','$product.product_name','express','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','push','render','QA\x20Warehouse','<div>','$product_details.product_name','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','body','$product_details.invoice','adjustment\x20data\x20update\x20successfully','$product_details.floorlevel','</body></html>','French','<span\x20style=\x22float:\x20right;\x22>','prod_code','$_id','role','maxPerUnit','params','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','bay','all','foreach\x20newproduct','$warehouse_name','3137598KwMzSj','production_date','\x20Order\x20Number\x20:\x20','secondary_unit','edit_adjustment_finished_view','Spanish','10Xlxnkr','/adjustment/view','English','purchases_data','catch','$product_details.product_code','26474967izcZhV','stockBefore','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','</thead>','<tr>','level','warehouse_name','$product_details.bin','password','prod_invoice','flash','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','warehouse','</table>','/view/add_adjustment','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</tr>','save','35792JDssZI','/CheckingWarehouse','forEach','host','stock','True','$product_details.storage','New_Qty_Converted_adj','string','Ambient','back','Logo.png','English\x20(US)','\x20</h2>','email','Enclosed','Adjustment\x20Mail','getDate','<hr\x20class=\x22my-3\x22>','$product','post','add','$product_details.secondary_code','German'];a0_0x159b=function(){return _0x10e38e;};return a0_0x159b();}function a0_0x1a52(_0x5b235d,_0xa38cb4){var _0x159bb8=a0_0x159b();return a0_0x1a52=function(_0x1a529c,_0x4ae3e7){_0x1a529c=_0x1a529c-0x197;var _0x4e69d3=_0x159bb8[_0x1a529c];return _0x4e69d3;},a0_0x1a52(_0x5b235d,_0xa38cb4);}(function(_0x4a5e7c,_0x5c10d4){var _0x5df8e6=a0_0x1a52,_0x1d37e3=_0x4a5e7c();while(!![]){try{var _0x471fa3=-parseInt(_0x5df8e6(0x1ad))/0x1+parseInt(_0x5df8e6(0x1cc))/0x2+-parseInt(_0x5df8e6(0x1b3))/0x3*(-parseInt(_0x5df8e6(0x253))/0x4)+-parseInt(_0x5df8e6(0x219))/0x5*(parseInt(_0x5df8e6(0x213))/0x6)+-parseInt(_0x5df8e6(0x1f6))/0x7+parseInt(_0x5df8e6(0x231))/0x8+parseInt(_0x5df8e6(0x21f))/0x9;if(_0x471fa3===_0x5c10d4)break;else _0x1d37e3['push'](_0x1d37e3['shift']());}catch(_0x11f380){_0x1d37e3['push'](_0x1d37e3['shift']());}}}(a0_0x159b,0xb1e2d));const express=require(a0_0x3fa569(0x1f8)),app=express(),router=express[a0_0x3fa569(0x1b6)](),auth=require(a0_0x3fa569(0x1e7)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x3fa569(0x1f4)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x3fa569(0x1af));router['get'](a0_0x3fa569(0x1ec),auth,async(_0x5d101f,_0x3e8e04)=>{var _0x726ba7=a0_0x3fa569;try{const {username:_0x248b0b,email:_0x3ecbc4,role:_0x34c27c}=_0x5d101f['user'],_0xdbe52f=_0x5d101f[_0x726ba7(0x24c)],_0xab130d=await profile[_0x726ba7(0x1ea)]({'email':_0xdbe52f['email']}),_0x30dfa6=await master_shop[_0x726ba7(0x19e)]();let _0x1ee09c;if(_0xdbe52f[_0x726ba7(0x209)]==_0x726ba7(0x1d4)){const _0xf18a4=await staff[_0x726ba7(0x1ea)]({'email':_0xdbe52f[_0x726ba7(0x23f)]});_0x1ee09c=await warehouse[_0x726ba7(0x19e)]({'status':_0x726ba7(0x1e9),'name':_0xf18a4['warehouse']});}else _0x1ee09c=await warehouse['find']({'status':'Enabled'});const _0x40f35b=await product[_0x726ba7(0x19e)]();let _0x441869;if(_0xdbe52f[_0x726ba7(0x209)]==_0x726ba7(0x1d4)){const _0x543ea9=await staff[_0x726ba7(0x1ea)]({'email':_0xdbe52f['email']});_0x441869=await adjustment_finished['find']({'warehouse_name':_0x543ea9[_0x726ba7(0x22b)]});}else _0x441869=await adjustment_finished[_0x726ba7(0x1d2)]([{'$unwind':_0x726ba7(0x244)},{'$group':{'_id':_0x726ba7(0x208),'invoice':{'$first':'$invoice'},'date':{'$first':_0x726ba7(0x1e8)},'warehouse_name':{'$first':_0x726ba7(0x212)},'room':{'$addToSet':_0x726ba7(0x1a7)},'finalize':{'$first':'$finalize'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x30dfa6[0x0]['language']==_0x726ba7(0x23d)){var _0x433e18=users[_0x726ba7(0x21b)];console['log'](_0x433e18);}else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]==_0x726ba7(0x25a))var _0x433e18=users[_0x726ba7(0x25a)];else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]=='German')var _0x433e18=users[_0x726ba7(0x248)];else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]==_0x726ba7(0x218))var _0x433e18=users[_0x726ba7(0x218)];else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]==_0x726ba7(0x205))var _0x433e18=users[_0x726ba7(0x205)];else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]==_0x726ba7(0x25d))var _0x433e18=users[_0x726ba7(0x1bf)];else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]==_0x726ba7(0x260))var _0x433e18=users[_0x726ba7(0x260)];else{if(_0x30dfa6[0x0][_0x726ba7(0x1e0)]=='Arabic\x20(ae)')var _0x433e18=users[_0x726ba7(0x19a)];}}}}}}}_0x3e8e04[_0x726ba7(0x1fb)]('adjustment_finished',{'success':_0x5d101f[_0x726ba7(0x229)](_0x726ba7(0x25f)),'errors':_0x5d101f[_0x726ba7(0x229)](_0x726ba7(0x257)),'role':_0xdbe52f,'profile':_0xab130d,'warehouse':_0x1ee09c,'product':_0x40f35b,'adjustment':_0x441869,'master_shop':_0x30dfa6,'language':_0x433e18});}catch(_0x53241b){console[_0x726ba7(0x1da)](_0x53241b);}});async function getRandom8DigitNumber(){var _0x43dd7d=a0_0x3fa569;const _0x528113=0x989680,_0x407f83=0x5f5e0ff,_0x1130ed=Math['floor'](Math[_0x43dd7d(0x1f2)]()*(_0x407f83-_0x528113+0x1))+_0x528113;var _0x2e7b0f;const _0x4c9821=await adjustment_finished[_0x43dd7d(0x1ea)]({'invoice':_0x43dd7d(0x1a4)+_0x1130ed});return _0x4c9821&&_0x4c9821[_0x43dd7d(0x1b2)]>0x0?_0x2e7b0f=_0x43dd7d(0x1a4)+_0x1130ed:_0x2e7b0f=_0x43dd7d(0x1a4)+_0x1130ed,_0x2e7b0f;}router['get']('/view/add_adjustment',auth,async(_0x421e1a,_0x489e74)=>{var _0x35d124=a0_0x3fa569;try{const {username:_0x5b98f5,email:_0x11a674,role:_0x274cb5}=_0x421e1a[_0x35d124(0x24c)],_0x410bb9=_0x421e1a['user'],_0x37c86a=await profile['findOne']({'email':_0x410bb9[_0x35d124(0x23f)]}),_0x2e286e=await master_shop['find']();let _0x1ee89e;if(_0x410bb9[_0x35d124(0x209)]==_0x35d124(0x1d4)){const _0x3c633d=await staff[_0x35d124(0x1ea)]({'email':_0x410bb9['email']});_0x1ee89e=await warehouse['aggregate']([{'$match':{'status':_0x35d124(0x1e9),'name':_0x3c633d[_0x35d124(0x22b)],'warehouse_category':_0x35d124(0x19c),'name':{'$ne':_0x35d124(0x1fc)}}},{'$group':{'_id':_0x35d124(0x24f),'name':{'$first':_0x35d124(0x24f)}}}]);}else _0x1ee89e=await warehouse[_0x35d124(0x1d2)]([{'$match':{'status':_0x35d124(0x1e9),'warehouse_category':_0x35d124(0x19c),'name':{'$ne':_0x35d124(0x1fc)}}},{'$group':{'_id':_0x35d124(0x24f),'name':{'$first':_0x35d124(0x24f)}}}]);const _0xe65b8c=await product['find']({}),_0x3f78af=await adjustment_finished[_0x35d124(0x19e)]({}),_0x4a6382=_0x3f78af[_0x35d124(0x1b2)]+0x1,_0x7057f5='ADJF-'+_0x4a6382[_0x35d124(0x1a0)]()[_0x35d124(0x250)](0x5,'0');var _0x4cd0b9=[_0x35d124(0x23a),_0x35d124(0x240),'Return\x20Rooms'];if(_0x2e286e[0x0]['language']==_0x35d124(0x23d))var _0x1716b2=users[_0x35d124(0x21b)];else{if(_0x2e286e[0x0][_0x35d124(0x1e0)]==_0x35d124(0x25a))var _0x1716b2=users['Hindi'];else{if(_0x2e286e[0x0]['language']=='German')var _0x1716b2=users[_0x35d124(0x248)];else{if(_0x2e286e[0x0][_0x35d124(0x1e0)]=='Spanish')var _0x1716b2=users['Spanish'];else{if(_0x2e286e[0x0][_0x35d124(0x1e0)]==_0x35d124(0x205))var _0x1716b2=users[_0x35d124(0x205)];else{if(_0x2e286e[0x0]['language']==_0x35d124(0x25d))var _0x1716b2=users['Portuguese'];else{if(_0x2e286e[0x0]['language']=='Chinese')var _0x1716b2=users[_0x35d124(0x260)];else{if(_0x2e286e[0x0][_0x35d124(0x1e0)]==_0x35d124(0x1bd))var _0x1716b2=users[_0x35d124(0x19a)];}}}}}}}const _0x23ac8e=getRandom8DigitNumber();_0x23ac8e[_0x35d124(0x251)](_0x399c31=>{var _0x4191d5=_0x35d124;_0x489e74[_0x4191d5(0x1fb)](_0x4191d5(0x1f0),{'success':_0x421e1a['flash'](_0x4191d5(0x25f)),'errors':_0x421e1a[_0x4191d5(0x229)]('errors'),'role':_0x410bb9,'profile':_0x37c86a,'warehouse':_0x1ee89e,'product':_0xe65b8c,'master_shop':_0x2e286e,'language':_0x1716b2,'rooms_data':_0x4cd0b9,'invoice_no':_0x399c31});})['catch'](_0x22b1d6=>{var _0x57b79a=_0x35d124;_0x421e1a[_0x57b79a(0x229)](_0x57b79a(0x257),_0x57b79a(0x1c8)),_0x489e74[_0x57b79a(0x1de)](_0x57b79a(0x21a));});}catch(_0x5c1571){console['log'](_0x5c1571);}}),router[a0_0x3fa569(0x245)](a0_0x3fa569(0x22d),auth,async(_0x35d8f4,_0x40da00)=>{var _0x1c3b57=a0_0x3fa569;try{const {warehouse_name:_0x538b30,date:_0x2c0c29,prod_name:_0x49b655,level:_0x2f4465,isle:_0x27d10d,pallet:_0x315fdd,stock:_0x139bda,types:_0x32612d,adjust_qty:_0x27094a,new_adjust_qty:_0x35d6dc,note:_0x6944a6,Room_name:_0x4a4fcd,invoice:_0x2f3a52,JO_number:_0x4bc636,expiry_date:_0x731b7f}=_0x35d8f4[_0x1c3b57(0x200)];if(typeof _0x49b655==_0x1c3b57(0x239))var _0x3da0ae=[_0x35d8f4['body']['prod_name']],_0x29d8b4=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x224)]],_0xf1c663=[_0x35d8f4[_0x1c3b57(0x200)]['stock']],_0x42bb2a=[_0x35d8f4['body'][_0x1c3b57(0x1e6)]],_0x476c02=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x238)]],_0x109b16=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x254)]],_0xee1b3f=[_0x35d8f4['body'][_0x1c3b57(0x1f5)]],_0x37b2ab=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x1a6)]],_0x205920=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x207)]],_0x51d67b=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x25b)]],_0x1a5e68=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x24a)]],_0x5b2fae=[_0x35d8f4[_0x1c3b57(0x200)]['product_date']],_0x4c2429=[_0x35d8f4['body']['prod_cat']],_0x577650=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x1c6)]],_0x1a176d=[_0x35d8f4[_0x1c3b57(0x200)]['maxPerUnit']],_0x1bcc6a=[_0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x228)]];else var _0x3da0ae=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x1e5)]],_0x29d8b4=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x224)]],_0xf1c663=[..._0x35d8f4['body'][_0x1c3b57(0x235)]],_0x42bb2a=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x1e6)]],_0x476c02=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x238)]],_0x109b16=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x254)]],_0xee1b3f=[..._0x35d8f4['body'][_0x1c3b57(0x1f5)]],_0x37b2ab=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x1a6)]],_0x205920=[..._0x35d8f4[_0x1c3b57(0x200)]['prod_code']],_0x51d67b=[..._0x35d8f4['body'][_0x1c3b57(0x25b)]],_0x1a5e68=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x24a)]],_0x5b2fae=[..._0x35d8f4[_0x1c3b57(0x200)]['product_date']],_0x4c2429=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x1d9)]],_0x577650=[..._0x35d8f4[_0x1c3b57(0x200)]['Rooms']],_0x1a176d=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x20a)]],_0x1bcc6a=[..._0x35d8f4[_0x1c3b57(0x200)][_0x1c3b57(0x228)]];const _0x58c826=_0x3da0ae[_0x1c3b57(0x19d)](_0x529a14=>{return _0x529a14={'product_name':_0x529a14};});_0x29d8b4[_0x1c3b57(0x233)]((_0x3517e1,_0x814902)=>{var _0x5498b1=_0x1c3b57;_0x58c826[_0x814902][_0x5498b1(0x20f)]=_0x3517e1;}),_0xf1c663[_0x1c3b57(0x233)]((_0x32c40a,_0x251f89)=>{_0x58c826[_0x251f89]['stockBefore']=_0x32c40a;}),_0x42bb2a['forEach']((_0x6a675,_0x4105e6)=>{_0x58c826[_0x4105e6]['types']=_0x6a675;}),_0x476c02[_0x1c3b57(0x233)]((_0x29f4fe,_0x29afe9)=>{var _0x132eb7=_0x1c3b57;_0x58c826[_0x29afe9][_0x132eb7(0x263)]=_0x29f4fe;}),_0x109b16[_0x1c3b57(0x233)]((_0x490a0d,_0x3b7456)=>{var _0x5c500d=_0x1c3b57;_0x58c826[_0x3b7456][_0x5c500d(0x1e1)]=_0x490a0d;}),_0xee1b3f[_0x1c3b57(0x233)]((_0x41213f,_0x56d054)=>{var _0x3d2cc9=_0x1c3b57;_0x58c826[_0x56d054][_0x3d2cc9(0x261)]=_0x41213f;}),_0x37b2ab['forEach']((_0x2f394a,_0x19ce07)=>{_0x58c826[_0x19ce07]['secondary_unit']=_0x2f394a;}),_0x205920[_0x1c3b57(0x233)]((_0x1fa99a,_0xc78ef9)=>{var _0x5efd03=_0x1c3b57;_0x58c826[_0xc78ef9][_0x5efd03(0x264)]=_0x1fa99a;}),_0x51d67b[_0x1c3b57(0x233)]((_0x1ed6da,_0x19f7de)=>{var _0x42c0b4=_0x1c3b57;_0x58c826[_0x19f7de][_0x42c0b4(0x25b)]=_0x1ed6da;}),_0x1a5e68[_0x1c3b57(0x233)]((_0x4ddbff,_0x3ed268)=>{var _0x3a7218=_0x1c3b57;_0x58c826[_0x3ed268][_0x3a7218(0x24a)]=_0x4ddbff;}),_0x5b2fae[_0x1c3b57(0x233)]((_0x16979d,_0x1f4745)=>{_0x58c826[_0x1f4745]['production_date']=_0x16979d;}),_0x4c2429[_0x1c3b57(0x233)]((_0x8e6430,_0x258f41)=>{var _0x36fd0b=_0x1c3b57;_0x58c826[_0x258f41][_0x36fd0b(0x1d9)]=_0x8e6430;}),_0x577650[_0x1c3b57(0x233)]((_0x440c01,_0x15148c)=>{_0x58c826[_0x15148c]['room_names']=_0x440c01;}),_0x1a176d[_0x1c3b57(0x233)]((_0xb8c598,_0x174978)=>{var _0x49d1fd=_0x1c3b57;_0x58c826[_0x174978][_0x49d1fd(0x20a)]=_0xb8c598;}),_0x1bcc6a['forEach']((_0xb13921,_0x595dcf)=>{var _0x45f3b1=_0x1c3b57;_0x58c826[_0x595dcf][_0x45f3b1(0x1d7)]=_0xb13921;});const _0x50315c=_0x58c826[_0x1c3b57(0x1a9)](_0x4bed87=>_0x4bed87[_0x1c3b57(0x263)]!=='0'&&_0x4bed87['adjust_qty']!=='');var _0x39db5d=0x0;_0x50315c[_0x1c3b57(0x233)](_0x6d54e4=>{var _0x3804dd=_0x1c3b57;console['log'](_0x3804dd(0x211),_0x6d54e4),parseInt(_0x6d54e4[_0x3804dd(0x263)])<=0x0&&_0x39db5d++;});if(_0x39db5d!=0x0)return _0x35d8f4[_0x1c3b57(0x229)](_0x1c3b57(0x257),_0x1c3b57(0x22a)),_0x40da00['redirect'](_0x1c3b57(0x23b));const _0x2e77e7=new adjustment_finished({'warehouse_name':_0x538b30,'date':_0x2c0c29,'product':_0x50315c,'note':_0x6944a6,'room':_0x4a4fcd,'invoice':_0x2f3a52,'JO_number':_0x4bc636,'expiry_date':_0x731b7f}),_0x58086b=await _0x2e77e7[_0x1c3b57(0x230)]();_0x35d8f4[_0x1c3b57(0x229)](_0x1c3b57(0x25f),_0x1c3b57(0x1b8)),_0x40da00[_0x1c3b57(0x1de)](_0x1c3b57(0x1b5)+_0x58086b[_0x1c3b57(0x1c9)]);}catch(_0x133a58){console[_0x1c3b57(0x1da)](_0x133a58),_0x40da00[_0x1c3b57(0x1d8)](0xc8)[_0x1c3b57(0x252)]({'message':_0x133a58[_0x1c3b57(0x1d1)]});}}),router[a0_0x3fa569(0x249)]('/preview/:id',auth,async(_0x576187,_0x59eb9f)=>{var _0x445e8f=a0_0x3fa569;try{const {username:_0x5c7fdf,email:_0x287160,role:_0xafc490}=_0x576187[_0x445e8f(0x24c)],_0x28089b=_0x576187[_0x445e8f(0x24c)],_0x584b81=await profile[_0x445e8f(0x1ea)]({'email':_0x28089b[_0x445e8f(0x23f)]}),_0x57c24d=await master_shop[_0x445e8f(0x19e)](),_0x400240=_0x576187[_0x445e8f(0x20b)]['id'],_0x41f14f=await adjustment_finished[_0x445e8f(0x1a2)]({'_id':_0x400240}),_0x1811cd=await purchases['aggregate']([{'$match':{'warehouse_name':_0x41f14f[_0x445e8f(0x225)]}},{'$unwind':_0x445e8f(0x244)},{'$group':{'_id':'$product.product_name'}}]);console[_0x445e8f(0x1da)](_0x445e8f(0x21c),_0x1811cd);const _0x2acb66=await product[_0x445e8f(0x19e)]({}),_0x494d90=await warehouse['aggregate']([{'$match':{'name':_0x41f14f['warehouse_name'],'warehouse_category':_0x445e8f(0x19c)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x445e8f(0x1c4),'name':{'$first':_0x445e8f(0x1fe)},'product_stock':{'$first':_0x445e8f(0x1ae)},'bay':{'$first':_0x445e8f(0x1c3)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x445e8f(0x24e)},'floorlevel':{'$first':_0x445e8f(0x203)},'primary_code':{'$first':_0x445e8f(0x25c)},'secondary_code':{'$first':_0x445e8f(0x247)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x445e8f(0x237)},'rack':{'$first':_0x445e8f(0x1a8)},'expiry_date':{'$first':_0x445e8f(0x24b)},'production_date':{'$first':_0x445e8f(0x1c2)},'batch_code':{'$first':_0x445e8f(0x1e3)},'maxPerUnit':{'$first':_0x445e8f(0x256)},'room':{'$first':_0x445e8f(0x1cd)}}}]);if(_0x57c24d[0x0][_0x445e8f(0x1e0)]=='English\x20(US)'){var _0x162804=users[_0x445e8f(0x21b)];console['log'](_0x162804);}else{if(_0x57c24d[0x0][_0x445e8f(0x1e0)]==_0x445e8f(0x25a))var _0x162804=users[_0x445e8f(0x25a)];else{if(_0x57c24d[0x0][_0x445e8f(0x1e0)]==_0x445e8f(0x248))var _0x162804=users['German'];else{if(_0x57c24d[0x0][_0x445e8f(0x1e0)]=='Spanish')var _0x162804=users[_0x445e8f(0x218)];else{if(_0x57c24d[0x0]['language']==_0x445e8f(0x205))var _0x162804=users[_0x445e8f(0x205)];else{if(_0x57c24d[0x0]['language']==_0x445e8f(0x25d))var _0x162804=users[_0x445e8f(0x1bf)];else{if(_0x57c24d[0x0][_0x445e8f(0x1e0)]==_0x445e8f(0x260))var _0x162804=users['Chinese'];else{if(_0x57c24d[0x0][_0x445e8f(0x1e0)]==_0x445e8f(0x1bd))var _0x162804=users[_0x445e8f(0x19a)];}}}}}}}_0x59eb9f[_0x445e8f(0x1fb)](_0x445e8f(0x217),{'success':_0x576187[_0x445e8f(0x229)](_0x445e8f(0x25f)),'errors':_0x576187[_0x445e8f(0x229)]('errors'),'role':_0x28089b,'profile':_0x584b81,'adjustment':_0x41f14f,'stock':_0x494d90,'master_shop':_0x57c24d,'warehouse_name':_0x1811cd,'unit':_0x2acb66,'language':_0x162804});}catch(_0x171fbb){console[_0x445e8f(0x1da)](_0x171fbb),_0x59eb9f[_0x445e8f(0x1d8)](0xc8)[_0x445e8f(0x252)]({'message':_0x171fbb[_0x445e8f(0x1d1)]});}}),router[a0_0x3fa569(0x245)]('/preview/:id',auth,async(_0x50486f,_0x34eb68)=>{var _0x58d470=a0_0x3fa569;try{const {invoice:_0x24dc34,warehouse_name:_0x185941,Room_name:_0x1a4450}=_0x50486f[_0x58d470(0x200)],_0x4c38dd=_0x50486f['params']['id'],_0x1a323e=await adjustment_finished[_0x58d470(0x1a2)]({'_id':_0x4c38dd});var _0x5bea27;const _0x281a73=_0x1a323e[_0x58d470(0x25e)][_0x58d470(0x19d)](async _0xd68afd=>{var _0x1905eb=_0x58d470;if(_0xd68afd[_0x1905eb(0x263)]>0x0){_0x5bea27=await warehouse[_0x1905eb(0x1ea)]({'name':_0x185941,'room':_0xd68afd['room_names'],'warehouse_category':_0x1905eb(0x19c)});const _0x143b48=_0x5bea27[_0x1905eb(0x1c1)]['map'](_0x2443e8=>{var _0x2e3d22=_0x1905eb;console[_0x2e3d22(0x1da)](_0xd68afd[_0x2e3d22(0x1e6)]);if(_0xd68afd['types']==_0x2e3d22(0x19f))_0x2443e8[_0x2e3d22(0x1db)]==_0xd68afd['product_name']&&_0x2443e8[_0x2e3d22(0x20f)]==_0xd68afd['bay']&&_0x2443e8[_0x2e3d22(0x24a)]==_0xd68afd[_0x2e3d22(0x24a)]&&_0x2443e8[_0x2e3d22(0x214)]==_0xd68afd[_0x2e3d22(0x214)]&&_0x2443e8[_0x2e3d22(0x25b)]==_0xd68afd[_0x2e3d22(0x25b)]&&_0x2443e8[_0x2e3d22(0x1d7)]==_0xd68afd[_0x2e3d22(0x1d7)]&&(_0x2443e8[_0x2e3d22(0x1b0)]=_0x2443e8[_0x2e3d22(0x1b0)]-_0xd68afd['adjust_qty']);else _0xd68afd['types']==_0x2e3d22(0x246)&&(_0x2443e8[_0x2e3d22(0x1db)]==_0xd68afd[_0x2e3d22(0x1db)]&&_0x2443e8[_0x2e3d22(0x20f)]==_0xd68afd[_0x2e3d22(0x20f)]&&_0x2443e8[_0x2e3d22(0x24a)]==_0xd68afd['expiry_date']&&_0x2443e8[_0x2e3d22(0x214)]==_0xd68afd[_0x2e3d22(0x214)]&&_0x2443e8['batch_code']==_0xd68afd['batch_code']&&_0x2443e8[_0x2e3d22(0x1d7)]==_0xd68afd[_0x2e3d22(0x1d7)]&&(_0x2443e8[_0x2e3d22(0x1b0)]=_0x2443e8[_0x2e3d22(0x1b0)]+_0xd68afd[_0x2e3d22(0x263)]));});}return _0x5bea27;});Promise[_0x58d470(0x210)](_0x281a73)['then'](async _0x1a6cb2=>{var _0x113438=_0x58d470;try{for(const _0x349df8 of _0x1a6cb2){await _0x349df8[_0x113438(0x230)]();}_0x1a323e[_0x113438(0x1d0)]=_0x113438(0x236);const _0x5c02e0=await _0x1a323e['save'](),_0x344f85=await master_shop[_0x113438(0x19e)](),_0x1b8e61=await email_settings['findOne'](),_0x1265b5=await supervisor_settings['find']();var _0xbc7b0c=_0x1a323e['product'],_0x3e3205='',_0x158c7d;for(_0x158c7d in _0xbc7b0c){var _0x20d7fa='FG';_0x1a323e[_0x113438(0x225)]==_0x113438(0x1bb)&&(_0x20d7fa='DG'),_0x3e3205+=_0x113438(0x223)+_0x113438(0x22e)+_0xbc7b0c[_0x158c7d][_0x113438(0x1db)]+'</td>'+_0x113438(0x22e)+_0xbc7b0c[_0x158c7d][_0x113438(0x264)]+_0x113438(0x259)+_0x113438(0x22e)+_0xbc7b0c[_0x158c7d][_0x113438(0x263)]+_0x113438(0x259)+_0x113438(0x22e)+_0xbc7b0c[_0x158c7d][_0x113438(0x261)]+_0x113438(0x259)+_0x113438(0x22e)+_0xbc7b0c[_0x158c7d][_0x113438(0x216)]+_0x113438(0x259)+_0x113438(0x22e)+_0x1a323e[_0x113438(0x225)]+_0x113438(0x259)+_0x113438(0x22e)+_0xbc7b0c[_0x158c7d][_0x113438(0x1df)]+_0x113438(0x259)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x20d7fa+_0xbc7b0c[_0x158c7d][_0x113438(0x20f)]+_0x113438(0x259)+_0x113438(0x22f);}let _0x56e36d=nodemailer[_0x113438(0x258)]({'host':_0x1b8e61[_0x113438(0x234)],'port':Number(_0x1b8e61[_0x113438(0x1d5)]),'secure':![],'auth':{'user':_0x1b8e61[_0x113438(0x23f)],'pass':_0x1b8e61[_0x113438(0x227)]}}),_0x9fce72={'from':_0x1b8e61[_0x113438(0x23f)],'to':_0x1265b5[0x0][_0x113438(0x262)],'subject':_0x113438(0x241),'attachments':[{'filename':_0x113438(0x23c),'path':__dirname+_0x113438(0x1c0)+_0x113438(0x1e4)+_0x344f85[0x0][_0x113438(0x1cb)],'cid':_0x113438(0x1b1)}],'html':_0x113438(0x19b)+'<html><head><title></title>'+'</head><body>'+_0x113438(0x1fd)+_0x113438(0x1bc)+_0x113438(0x1fd)+_0x113438(0x1ff)+_0x113438(0x1ac)+'<div>'+_0x113438(0x198)+_0x344f85[0x0][_0x113438(0x1aa)]+_0x113438(0x23e)+_0x113438(0x1ac)+_0x113438(0x1ac)+_0x113438(0x243)+'<div>'+_0x113438(0x20c)+_0x113438(0x215)+_0x1a323e[_0x113438(0x1d7)]+'\x20'+_0x113438(0x206)+'\x20Order\x20Date\x20:\x20'+_0x1a323e[_0x113438(0x1c7)]+'\x20'+_0x113438(0x1a1)+_0x113438(0x1ce)+_0x113438(0x1ac)+_0x113438(0x24d)+_0x113438(0x221)+'<tr>'+_0x113438(0x20e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x113438(0x1f9)+_0x113438(0x1eb)+_0x113438(0x1ef)+_0x113438(0x1e2)+'</tr>'+_0x113438(0x222)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x3e3205+'\x20'+'</tbody>'+_0x113438(0x22c)+_0x113438(0x1fd)+_0x113438(0x1ba)+'<h5>'+_0x344f85[0x0]['site_title']+_0x113438(0x1ce)+_0x113438(0x1ac)+'</div>'+_0x113438(0x204)};_0x56e36d[_0x113438(0x1a5)](_0x9fce72,function(_0x3f37d0,_0x7b3da){var _0x496100=_0x113438;_0x3f37d0?(console[_0x496100(0x1da)](_0x3f37d0),console[_0x496100(0x1da)](_0x496100(0x1dd))):console[_0x496100(0x1da)](_0x496100(0x1c5));}),_0x50486f[_0x113438(0x229)](_0x113438(0x25f),_0x113438(0x199)),_0x34eb68[_0x113438(0x1de)](_0x113438(0x1be)+_0x5c02e0['_id']);}catch(_0x7b39f8){console[_0x113438(0x1f3)](_0x7b39f8),_0x34eb68[_0x113438(0x1d8)](0x1f4)[_0x113438(0x252)]({'error':_0x113438(0x1b9)});}})[_0x58d470(0x21d)](_0x3b001e=>{var _0x6bff6e=_0x58d470;console[_0x6bff6e(0x1f3)](_0x3b001e),_0x34eb68[_0x6bff6e(0x1d8)](0x1f4)[_0x6bff6e(0x252)]({'error':_0x6bff6e(0x1cf)});});}catch(_0x138de3){_0x34eb68['json']({'message':_0x138de3[_0x58d470(0x1d1)]});}}),router[a0_0x3fa569(0x249)](a0_0x3fa569(0x1a3),auth,async(_0x2d15bb,_0x283c19)=>{var _0x425946=a0_0x3fa569;try{const {username:_0x42c5e8,email:_0x42d18b,role:_0xe1d6f2}=_0x2d15bb[_0x425946(0x24c)],_0x55c2ce=_0x2d15bb[_0x425946(0x24c)],_0xe68856=await profile[_0x425946(0x1ea)]({'email':_0x55c2ce[_0x425946(0x23f)]}),_0x281274=await master_shop['find']();console[_0x425946(0x1da)]('master',_0x281274);const _0x34dc08=_0x2d15bb[_0x425946(0x20b)]['id'],_0x4a9b5e=await adjustment_finished['findById']({'_id':_0x34dc08});let _0x49ab6a=new Date(_0x4a9b5e[_0x425946(0x24a)]),_0x266ddd=('0'+_0x49ab6a[_0x425946(0x242)]())['slice'](-0x2),_0x11463e=('0'+(_0x49ab6a[_0x425946(0x1dc)]()+0x1))[_0x425946(0x1b4)](-0x2),_0xf1976c=_0x49ab6a['getFullYear'](),_0x36fb19=_0xf1976c+'-'+_0x11463e+'-'+_0x266ddd;var _0x5e959f=[_0x425946(0x23a),_0x425946(0x240),_0x425946(0x1ab)];const _0x37efed=await purchases[_0x425946(0x1d2)]([{'$match':{'warehouse_name':_0x4a9b5e['warehouse_name']}},{'$unwind':_0x425946(0x244)},{'$group':{'_id':_0x425946(0x1f7)}}]);console[_0x425946(0x1da)]('purchases_data',_0x37efed);const _0x23ff83=await product[_0x425946(0x19e)]({}),_0x28d096=await warehouse[_0x425946(0x1d2)]([{'$match':{'name':_0x4a9b5e[_0x425946(0x225)],'room':_0x4a9b5e[_0x425946(0x1b7)]}},{'$unwind':_0x425946(0x1f1)},{'$group':{'_id':_0x425946(0x1c4),'name':{'$first':_0x425946(0x1fe)},'product_stock':{'$first':_0x425946(0x1ae)},'bay':{'$first':_0x425946(0x1c3)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x425946(0x203)},'primary_code':{'$first':_0x425946(0x25c)},'secondary_code':{'$first':_0x425946(0x247)},'product_code':{'$first':_0x425946(0x21e)},'storage':{'$first':_0x425946(0x237)},'rack':{'$first':_0x425946(0x1a8)}}}]);if(_0x281274[0x0][_0x425946(0x1e0)]==_0x425946(0x23d)){var _0x385e43=users[_0x425946(0x21b)];console[_0x425946(0x1da)](_0x385e43);}else{if(_0x281274[0x0][_0x425946(0x1e0)]==_0x425946(0x25a))var _0x385e43=users[_0x425946(0x25a)];else{if(_0x281274[0x0]['language']==_0x425946(0x248))var _0x385e43=users[_0x425946(0x248)];else{if(_0x281274[0x0][_0x425946(0x1e0)]==_0x425946(0x218))var _0x385e43=users['Spanish'];else{if(_0x281274[0x0]['language']==_0x425946(0x205))var _0x385e43=users[_0x425946(0x205)];else{if(_0x281274[0x0][_0x425946(0x1e0)]==_0x425946(0x25d))var _0x385e43=users[_0x425946(0x1bf)];else{if(_0x281274[0x0][_0x425946(0x1e0)]==_0x425946(0x260))var _0x385e43=users['Chinese'];else{if(_0x281274[0x0][_0x425946(0x1e0)]==_0x425946(0x1bd))var _0x385e43=users[_0x425946(0x19a)];}}}}}}}_0x283c19[_0x425946(0x1fb)](_0x425946(0x1ed),{'success':_0x2d15bb[_0x425946(0x229)](_0x425946(0x25f)),'errors':_0x2d15bb[_0x425946(0x229)](_0x425946(0x257)),'role':_0x55c2ce,'profile':_0xe68856,'adjustment':_0x4a9b5e,'stock':_0x28d096,'master_shop':_0x281274,'warehouse_name':_0x37efed,'unit':_0x23ff83,'language':_0x385e43,'rooms_data':_0x5e959f,'ed_fullDate':_0x36fb19});}catch(_0x925727){console['log'](_0x925727),_0x283c19[_0x425946(0x1d8)](0xc8)[_0x425946(0x252)]({'message':_0x925727[_0x425946(0x1d1)]});}}),router[a0_0x3fa569(0x245)](a0_0x3fa569(0x1a3),auth,async(_0x2787d4,_0x27c9bd)=>{var _0x110ecd=a0_0x3fa569;try{const _0x400234=_0x2787d4['params']['id'],_0x25585a=await adjustment_finished[_0x110ecd(0x1a2)]({'_id':_0x400234}),_0x2e5273=await warehouse['findOne']({'name':_0x25585a['warehouse_name'],'room':_0x25585a['room']}),{warehouse_name:_0x236d9e,date:_0x273da3,prod_name:_0x30ce7c,level:_0x1d6eb9,isle:_0x5cca1b,pallet:_0x29eea5,stock:_0x55a854,types:_0x3bb607,adjust_qty:_0x495ecb,new_adjust_qty:_0x4dcb2c,note:_0x68082,Room_name:_0x28b6d0,invoice:_0xd88d15,JO_number:_0x41dcac}=_0x2787d4['body'];if(typeof _0x30ce7c=='string')var _0x488aa5=[_0x2787d4['body'][_0x110ecd(0x1e5)]],_0x53edc7=[_0x2787d4['body'][_0x110ecd(0x224)]],_0x48c1e6=[_0x2787d4[_0x110ecd(0x200)]['stock']],_0xeb7e=[_0x2787d4[_0x110ecd(0x200)]['types']],_0x17cc4f=[_0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x263)]],_0x83821d=[_0x2787d4[_0x110ecd(0x200)]['new_adjust_qty']],_0x14646a=[_0x2787d4['body'][_0x110ecd(0x207)]],_0x2443b1=[_0x2787d4[_0x110ecd(0x200)]['unit']],_0x4e8821=[_0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x1a6)]],_0x1a84ab=[_0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x25b)]],_0x39a067=[_0x2787d4[_0x110ecd(0x200)]['expiry_date']];else var _0x488aa5=[..._0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x1e5)]],_0x53edc7=[..._0x2787d4[_0x110ecd(0x200)]['level']],_0x48c1e6=[..._0x2787d4[_0x110ecd(0x200)]['stock']],_0xeb7e=[..._0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x1e6)]],_0x17cc4f=[..._0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x263)]],_0x83821d=[..._0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x1e1)]],_0x14646a=[..._0x2787d4['body'][_0x110ecd(0x207)]],_0x2443b1=[..._0x2787d4[_0x110ecd(0x200)]['unit']],_0x4e8821=[..._0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x1a6)]],_0x1a84ab=[..._0x2787d4[_0x110ecd(0x200)][_0x110ecd(0x25b)]],_0x39a067=[..._0x2787d4['body'][_0x110ecd(0x24a)]];const _0x541848=_0x488aa5[_0x110ecd(0x19d)](_0x29bae9=>{return _0x29bae9={'product_name':_0x29bae9};});_0x53edc7['forEach']((_0x5be7fc,_0x3d23eb)=>{_0x541848[_0x3d23eb]['bay']=_0x5be7fc;}),_0x48c1e6[_0x110ecd(0x233)]((_0x404423,_0x3b4532)=>{var _0x318b95=_0x110ecd;_0x541848[_0x3b4532][_0x318b95(0x220)]=_0x404423;}),_0xeb7e[_0x110ecd(0x233)]((_0x4d1fdb,_0x1a33f8)=>{_0x541848[_0x1a33f8]['types']=_0x4d1fdb;}),_0x17cc4f[_0x110ecd(0x233)]((_0xb9250a,_0x38546a)=>{var _0x3297c4=_0x110ecd;_0x541848[_0x38546a][_0x3297c4(0x263)]=_0xb9250a;}),_0x83821d['forEach']((_0x3b831b,_0x52af3f)=>{var _0x3c9eee=_0x110ecd;_0x541848[_0x52af3f][_0x3c9eee(0x1e1)]=_0x3b831b;}),_0x2443b1[_0x110ecd(0x233)]((_0x42a5ef,_0x40cdf8)=>{var _0x9b3864=_0x110ecd;_0x541848[_0x40cdf8][_0x9b3864(0x261)]=_0x42a5ef;}),_0x4e8821[_0x110ecd(0x233)]((_0x178ca0,_0x4dbc20)=>{var _0x35bbd6=_0x110ecd;_0x541848[_0x4dbc20][_0x35bbd6(0x216)]=_0x178ca0;}),_0x14646a['forEach']((_0xefe9f9,_0x11f1c9)=>{_0x541848[_0x11f1c9]['product_code']=_0xefe9f9;}),_0x1a84ab['forEach']((_0x5a1d2b,_0x523130)=>{var _0x1f5f6f=_0x110ecd;_0x541848[_0x523130][_0x1f5f6f(0x25b)]=_0x5a1d2b;}),_0x39a067[_0x110ecd(0x233)]((_0x401f11,_0x1babf2)=>{_0x541848[_0x1babf2]['expiry_date']=_0x401f11;});const _0x1c7db9=_0x541848[_0x110ecd(0x1a9)](_0x438636=>_0x438636[_0x110ecd(0x263)]!=='0'&&_0x438636[_0x110ecd(0x263)]!=='');var _0x55d457=0x0;_0x1c7db9[_0x110ecd(0x233)](_0x9d3491=>{var _0x23766a=_0x110ecd;console[_0x23766a(0x1da)](_0x23766a(0x211),_0x9d3491),parseInt(_0x9d3491['adjust_qty'])<=0x0&&_0x55d457++;});if(_0x55d457!=0x0)return _0x2787d4[_0x110ecd(0x229)](_0x110ecd(0x257),_0x110ecd(0x22a)),_0x27c9bd[_0x110ecd(0x1de)](_0x110ecd(0x23b));_0x25585a[_0x110ecd(0x225)]=_0x236d9e,_0x25585a[_0x110ecd(0x1c7)]=_0x273da3,_0x25585a[_0x110ecd(0x25e)]=_0x1c7db9,_0x25585a['note']=_0x68082,_0x25585a[_0x110ecd(0x1b7)]=_0x28b6d0,_0x25585a[_0x110ecd(0x1d7)]=_0xd88d15,_0x25585a['JO_number']=_0x41dcac;const _0x339921=await _0x25585a['save'](),_0x141a81=await warehouse[_0x110ecd(0x1ea)]({'name':_0x236d9e,'room':_0x28b6d0});_0x339921[_0x110ecd(0x25e)][_0x110ecd(0x233)](_0x1af63d=>{var _0x580dee=_0x110ecd;const _0x4e3576=_0x141a81['product_details'][_0x580dee(0x19d)](_0x5be066=>{var _0x16d627=_0x580dee;_0x1af63d[_0x16d627(0x1e6)]==_0x16d627(0x19f)?_0x5be066[_0x16d627(0x1db)]==_0x1af63d[_0x16d627(0x1db)]&&_0x5be066[_0x16d627(0x20f)]==_0x1af63d[_0x16d627(0x20f)]&&(_0x5be066['product_stock']=parseInt(_0x5be066[_0x16d627(0x1b0)])-parseInt(_0x1af63d['adjust_qty'])):_0x5be066['product_name']==_0x1af63d[_0x16d627(0x1db)]&&_0x5be066[_0x16d627(0x20f)]==_0x1af63d[_0x16d627(0x20f)]&&(_0x5be066['product_stock']=parseInt(_0x5be066[_0x16d627(0x1b0)])+parseInt(_0x1af63d[_0x16d627(0x263)]));});}),await _0x141a81[_0x110ecd(0x230)](),_0x2787d4[_0x110ecd(0x229)](_0x110ecd(0x25f),_0x110ecd(0x202)),_0x27c9bd[_0x110ecd(0x1de)](_0x110ecd(0x197));}catch(_0x3af1cb){console[_0x110ecd(0x1da)](_0x3af1cb);}}),router[a0_0x3fa569(0x245)](a0_0x3fa569(0x1d3),async(_0x37c94e,_0x274848)=>{var _0x24b13c=a0_0x3fa569;const {primary_code:_0x3a659f,warehouse_data:_0x50e9dd,rooms_data:_0x2c5781,Roomslist:_0x1fb7b4}=_0x37c94e['body'],_0x11e4f2=_0x1fb7b4[_0x24b13c(0x1ca)](','),_0x442c37=[];async function _0x4eb18b(_0x58b325){var _0x1256d2=_0x24b13c;const _0x4c4a32=await warehouse['aggregate']([{'$match':{'name':_0x50e9dd,'room':_0x58b325}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x3a659f}},{'$group':{'_id':_0x1256d2(0x1c4),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1256d2(0x1ae)},'primary_code':{'$first':_0x1256d2(0x25c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1256d2(0x21e)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x1256d2(0x24e)},'pallet':{'$first':_0x1256d2(0x203)},'unit':{'$first':_0x1256d2(0x20d)},'secondary_unit':{'$first':_0x1256d2(0x255)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1256d2(0x24b)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1256d2(0x1e3)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x1256d2(0x256)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x1256d2(0x201)}}}]),_0x20021d=await warehouse[_0x1256d2(0x1d2)]([{'$match':{'name':_0x50e9dd,'room':_0x58b325}},{'$unwind':_0x1256d2(0x1f1)},{'$match':{'product_details.secondary_code':_0x3a659f}},{'$group':{'_id':_0x1256d2(0x1c4),'name':{'$first':_0x1256d2(0x1fe)},'product_stock':{'$first':_0x1256d2(0x1ae)},'primary_code':{'$first':_0x1256d2(0x25c)},'secondary_code':{'$first':_0x1256d2(0x247)},'product_code':{'$first':_0x1256d2(0x21e)},'level':{'$first':_0x1256d2(0x1c3)},'isle':{'$first':_0x1256d2(0x226)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1256d2(0x203)},'unit':{'$first':_0x1256d2(0x20d)},'secondary_unit':{'$first':_0x1256d2(0x255)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x1256d2(0x1a8)},'expiry_date':{'$first':_0x1256d2(0x24b)},'production_date':{'$first':_0x1256d2(0x1c2)},'batch_code':{'$first':_0x1256d2(0x1e3)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x1256d2(0x256)},'roomNamed':{'$first':_0x1256d2(0x1cd)},'invoice':{'$first':_0x1256d2(0x201)}}}]);if(_0x4c4a32[_0x1256d2(0x1b2)]>0x0)_0x442c37[_0x1256d2(0x1fa)](_0x4c4a32);else _0x20021d[_0x1256d2(0x1b2)]>0x0&&_0x442c37['push'](_0x20021d);}const _0x2b27c7=_0x11e4f2[_0x24b13c(0x19d)](_0x355c6d=>_0x4eb18b(_0x355c6d));await Promise[_0x24b13c(0x210)](_0x2b27c7),_0x274848[_0x24b13c(0x252)](_0x442c37);}),router[a0_0x3fa569(0x245)](a0_0x3fa569(0x232),async(_0x14dc40,_0x124bcb)=>{var _0x19e08c=a0_0x3fa569;const {productCode:_0x1ce15b,bay:_0x373052,warehouses:_0x4a2396,room:_0x455f25}=_0x14dc40[_0x19e08c(0x200)];console['log'](_0x14dc40[_0x19e08c(0x200)]);try{const _0x5f577f=await warehouse[_0x19e08c(0x1d2)]([{'$match':{'name':_0x4a2396,'room':_0x455f25}},{'$unwind':_0x19e08c(0x1f1)},{'$match':{'product_details.bay':parseInt(_0x373052)}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x19e08c(0x1fe)},'product_stock':{'$first':_0x19e08c(0x1ae)},'bay':{'$first':_0x19e08c(0x1c3)},'maxProducts':{'$first':_0x19e08c(0x1d6)}}}]);_0x124bcb['status'](0xc8)['json'](_0x5f577f);}catch(_0x11ee19){_0x124bcb['status'](0x194)[_0x19e08c(0x252)]({'message':_0x11ee19[_0x19e08c(0x1d1)]});}}),module[a0_0x3fa569(0x1ee)]=router;