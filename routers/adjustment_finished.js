var a0_0x260632=a0_0x20f9;(function(_0x2b2806,_0x26ac26){var _0x45aefe=a0_0x20f9,_0x4b4e7a=_0x2b2806();while(!![]){try{var _0x178d43=-parseInt(_0x45aefe(0x2ae))/0x1+-parseInt(_0x45aefe(0x235))/0x2*(parseInt(_0x45aefe(0x1e4))/0x3)+-parseInt(_0x45aefe(0x269))/0x4*(-parseInt(_0x45aefe(0x22d))/0x5)+-parseInt(_0x45aefe(0x231))/0x6+parseInt(_0x45aefe(0x23f))/0x7+parseInt(_0x45aefe(0x28c))/0x8+parseInt(_0x45aefe(0x1e8))/0x9;if(_0x178d43===_0x26ac26)break;else _0x4b4e7a['push'](_0x4b4e7a['shift']());}catch(_0x4a78cb){_0x4b4e7a['push'](_0x4b4e7a['shift']());}}}(a0_0x176f,0x1fc82));const express=require(a0_0x260632(0x210)),app=express(),router=express[a0_0x260632(0x288)](),auth=require(a0_0x260632(0x2b6)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x260632(0x208)),users=require(a0_0x260632(0x1f5)),nodemailer=require(a0_0x260632(0x213));function a0_0x20f9(_0x459858,_0x263907){var _0x176f18=a0_0x176f();return a0_0x20f9=function(_0x20f954,_0x5aff95){_0x20f954=_0x20f954-0x1e4;var _0x336b12=_0x176f18[_0x20f954];return _0x336b12;},a0_0x20f9(_0x459858,_0x263907);}function a0_0x176f(){var _0x3012a3=['<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','random','/view/:id','Portuguese\x20(BR)','find','<!DOCTYPE\x20html>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','../public/language/languages.json','Spanish','push','product_date','stockBefore','add','</tbody>','$invoice','foreach\x20newproduct','ADJF-','room','$product_details.type','secondary_unit','role','date','note','$product_details.production_date','$product_details.invoice','exports','../models/all_models','logo','email','render','string','</td>','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','status','express','adjustment\x20data\x20update\x20successfully','get','nodemailer','<h5\x20style=\x22text-align:\x20left;\x22>','<hr\x20class=\x22my-3\x22>','findOne','unit','findById','/preview/:id','$product_details._id','New_Qty_Converted','product_code','stock','<html><head><title></title>','new_adjust_qty','\x20Order\x20Number\x20:\x20','prod_cat','getDate','production_date','adjustment\x20add\x20successfull','Arabic','QA\x20Warehouse','image','</div>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','Error\x20Occurs','English\x20(US)','$product_details.maxProducts','5PPvwhh','floor','params','Finished\x20Goods','1365450vxxHlg','$product_details.unit','batch_code','Enclosed','52970FsRsuU','split','$_id','slice','bay','Hindi','Portuguese','</h5>','message','/view/add_adjustment','966329CGKyRq','getFullYear','invoice','$product','site_title','finalize','/adjustment_finished/view','$product_details.maxPerUnit','FGSEmail','maxPerUnit','$product_details.secondary_unit','success','German','sendMail','<div>','port','<strong>\x20Regards\x20</strong>','redirect','error','DRY\x20GOODS','Email\x20sent\x20successfully','$room','$product_details.rack','filter','$date','prod_code','createTransport','body','$product_details','$product.product_name','New_Qty_Converted_adj','warehouse','add_adjustment_finished','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','edit_adjustment_finished','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$product_details.product_name','edit_adjustment_finished_view','then','$product_details.product_stock','Rooms','user','554564GGjGSa','types','room_names','$name','$product_details.secondary_code','English','purchases_data','map','$product_details.product_code','warehouse_name','/view','log','level','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','Ambient','French','JO_number','/upload/','True','$product_details.batch_code','</body></html>','$warehouse_name','prod_name','<table\x20style=\x22width:\x20100%\x20!important;\x22>','/CheckingWarehouse','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Adjustment\x20Mail','json','aggregate','staff','Router','/../public','There\x27s\x20a\x20error\x20in\x20this\x20transaction','errors','723936TfNSKa','length','/barcode_scanner','Logo.png','Chinese','</span>','$product_details.floorlevel','<span\x20style=\x22float:\x20right;\x22>','language','catch','$product_details.storage','product_details','toString','</head><body>','product_stock','/picking_list/PDF_adjustment/','</table>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.expiry_date','An\x20error\x20occurred\x20while\x20saving\x20data.','_id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','post','Enabled','Arabic\x20(ae)','Return\x20Rooms','$finalize','$product.room_names','<tr>','$product_details.bay','adjust_qty','prod_invoice','product','<tbody\x20style=\x22text-align:\x20center;\x22>','206747DDxULh','An\x20error\x20occurred.','master','product_name','flash','adjustment_finished','</tr>','forEach','../middleware/auth','$product_details.primary_code','Secondary_units','21nWLXlC','Primary_Units','save','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','3444435fjoXvz','/adjustment_finished/preview/','expiry_date','<h5>','/adjustment/view','$product_details.bin'];a0_0x176f=function(){return _0x3012a3;};return a0_0x176f();}router[a0_0x260632(0x212)](a0_0x260632(0x273),auth,async(_0x4819e6,_0x3c72e9)=>{var _0x583731=a0_0x260632;try{const {username:_0x19b03c,email:_0x563f86,role:_0x3d4793}=_0x4819e6[_0x583731(0x268)],_0x4fe1b6=_0x4819e6[_0x583731(0x268)],_0x5bcaab=await profile[_0x583731(0x216)]({'email':_0x4fe1b6[_0x583731(0x20a)]}),_0xd80581=await master_shop[_0x583731(0x1f2)]();let _0x2167ea;if(_0x4fe1b6[_0x583731(0x202)]==_0x583731(0x287)){const _0x515f54=await staff[_0x583731(0x216)]({'email':_0x4fe1b6['email']});_0x2167ea=await warehouse[_0x583731(0x1f2)]({'status':_0x583731(0x2a3),'name':_0x515f54[_0x583731(0x25e)]});}else _0x2167ea=await warehouse[_0x583731(0x1f2)]({'status':_0x583731(0x2a3)});const _0x6f2cc=await product[_0x583731(0x1f2)]();let _0x38909e;if(_0x4fe1b6[_0x583731(0x202)]==_0x583731(0x287)){const _0x4a47f0=await staff[_0x583731(0x216)]({'email':_0x4fe1b6[_0x583731(0x20a)]});_0x38909e=await adjustment_finished[_0x583731(0x1f2)]({'warehouse_name':_0x4a47f0['warehouse']});}else _0x38909e=await adjustment_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x583731(0x237),'invoice':{'$first':_0x583731(0x1fc)},'date':{'$first':_0x583731(0x257)},'warehouse_name':{'$first':_0x583731(0x27f)},'room':{'$addToSet':_0x583731(0x2a7)},'finalize':{'$first':_0x583731(0x2a6)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0xd80581[0x0][_0x583731(0x294)]==_0x583731(0x22b)){var _0x3cdffb=users[_0x583731(0x26e)];console['log'](_0x3cdffb);}else{if(_0xd80581[0x0][_0x583731(0x294)]==_0x583731(0x23a))var _0x3cdffb=users[_0x583731(0x23a)];else{if(_0xd80581[0x0][_0x583731(0x294)]==_0x583731(0x24b))var _0x3cdffb=users[_0x583731(0x24b)];else{if(_0xd80581[0x0][_0x583731(0x294)]=='Spanish')var _0x3cdffb=users[_0x583731(0x1f6)];else{if(_0xd80581[0x0][_0x583731(0x294)]==_0x583731(0x279))var _0x3cdffb=users[_0x583731(0x279)];else{if(_0xd80581[0x0]['language']==_0x583731(0x1f1))var _0x3cdffb=users[_0x583731(0x23b)];else{if(_0xd80581[0x0]['language']==_0x583731(0x290))var _0x3cdffb=users[_0x583731(0x290)];else{if(_0xd80581[0x0][_0x583731(0x294)]==_0x583731(0x2a4))var _0x3cdffb=users[_0x583731(0x225)];}}}}}}}_0x3c72e9['render'](_0x583731(0x2b3),{'success':_0x4819e6['flash'](_0x583731(0x24a)),'errors':_0x4819e6['flash'](_0x583731(0x28b)),'role':_0x4fe1b6,'profile':_0x5bcaab,'warehouse':_0x2167ea,'product':_0x6f2cc,'adjustment':_0x38909e,'master_shop':_0xd80581,'language':_0x3cdffb});}catch(_0x31984a){console[_0x583731(0x274)](_0x31984a);}});async function getRandom8DigitNumber(){var _0x45e660=a0_0x260632;const _0x18083a=0x989680,_0x3d7173=0x5f5e0ff,_0x13ac46=Math[_0x45e660(0x22e)](Math[_0x45e660(0x1ef)]()*(_0x3d7173-_0x18083a+0x1))+_0x18083a;var _0x369642;const _0x1bdbff=await adjustment_finished[_0x45e660(0x216)]({'invoice':_0x45e660(0x1fe)+_0x13ac46});return _0x1bdbff&&_0x1bdbff[_0x45e660(0x28d)]>0x0?_0x369642=_0x45e660(0x1fe)+_0x13ac46:_0x369642=_0x45e660(0x1fe)+_0x13ac46,_0x369642;}router[a0_0x260632(0x212)](a0_0x260632(0x23e),auth,async(_0x5577f9,_0x5bebed)=>{var _0x3e619d=a0_0x260632;try{const {username:_0x479f44,email:_0x2f237b,role:_0x2e71c4}=_0x5577f9[_0x3e619d(0x268)],_0x428a4e=_0x5577f9[_0x3e619d(0x268)],_0x2f66a5=await profile[_0x3e619d(0x216)]({'email':_0x428a4e['email']}),_0x5ab399=await master_shop[_0x3e619d(0x1f2)]();let _0x54b0a5;if(_0x428a4e[_0x3e619d(0x202)]==_0x3e619d(0x287)){const _0x1ca037=await staff[_0x3e619d(0x216)]({'email':_0x428a4e['email']});_0x54b0a5=await warehouse[_0x3e619d(0x286)]([{'$match':{'status':_0x3e619d(0x2a3),'name':_0x1ca037['warehouse'],'warehouse_category':_0x3e619d(0x230),'name':{'$ne':_0x3e619d(0x226)}}},{'$group':{'_id':'$name','name':{'$first':'$name'}}}]);}else _0x54b0a5=await warehouse[_0x3e619d(0x286)]([{'$match':{'status':_0x3e619d(0x2a3),'warehouse_category':'Finished\x20Goods','name':{'$ne':_0x3e619d(0x226)}}},{'$group':{'_id':_0x3e619d(0x26c),'name':{'$first':'$name'}}}]);const _0x49eb6a=await product['find']({}),_0x5ac547=await adjustment_finished[_0x3e619d(0x1f2)]({}),_0x54ed7f=_0x5ac547[_0x3e619d(0x28d)]+0x1,_0xc5d38=_0x3e619d(0x1fe)+_0x54ed7f[_0x3e619d(0x298)]()['padStart'](0x5,'0');var _0x55e99d=['Ambient','Enclosed',_0x3e619d(0x2a5)];if(_0x5ab399[0x0][_0x3e619d(0x294)]==_0x3e619d(0x22b))var _0x2139a2=users[_0x3e619d(0x26e)];else{if(_0x5ab399[0x0]['language']==_0x3e619d(0x23a))var _0x2139a2=users[_0x3e619d(0x23a)];else{if(_0x5ab399[0x0]['language']==_0x3e619d(0x24b))var _0x2139a2=users[_0x3e619d(0x24b)];else{if(_0x5ab399[0x0][_0x3e619d(0x294)]=='Spanish')var _0x2139a2=users['Spanish'];else{if(_0x5ab399[0x0][_0x3e619d(0x294)]=='French')var _0x2139a2=users[_0x3e619d(0x279)];else{if(_0x5ab399[0x0][_0x3e619d(0x294)]==_0x3e619d(0x1f1))var _0x2139a2=users['Portuguese'];else{if(_0x5ab399[0x0]['language']==_0x3e619d(0x290))var _0x2139a2=users['Chinese'];else{if(_0x5ab399[0x0][_0x3e619d(0x294)]==_0x3e619d(0x2a4))var _0x2139a2=users[_0x3e619d(0x225)];}}}}}}}const _0x7d2630=getRandom8DigitNumber();_0x7d2630['then'](_0x5228a1=>{var _0x45af37=_0x3e619d;_0x5bebed[_0x45af37(0x20b)](_0x45af37(0x25f),{'success':_0x5577f9[_0x45af37(0x2b2)]('success'),'errors':_0x5577f9[_0x45af37(0x2b2)](_0x45af37(0x28b)),'role':_0x428a4e,'profile':_0x2f66a5,'warehouse':_0x54b0a5,'product':_0x49eb6a,'master_shop':_0x5ab399,'language':_0x2139a2,'rooms_data':_0x55e99d,'invoice_no':_0x5228a1});})[_0x3e619d(0x295)](_0x50d74e=>{var _0x393422=_0x3e619d;_0x5577f9[_0x393422(0x2b2)](_0x393422(0x28b),_0x393422(0x28a)),_0x5bebed[_0x393422(0x250)](_0x393422(0x1ec));});}catch(_0x54a151){console[_0x3e619d(0x274)](_0x54a151);}}),router['post'](a0_0x260632(0x23e),auth,async(_0x548359,_0x262bb6)=>{var _0x49f762=a0_0x260632;try{const {warehouse_name:_0x100bdf,date:_0x453815,prod_name:_0x235fd9,level:_0x4cbf48,isle:_0x7c1954,pallet:_0x2b5389,stock:_0x34a340,types:_0x4783d9,adjust_qty:_0x17e7d1,new_adjust_qty:_0x1fd53a,note:_0x28e8e1,Room_name:_0x2c8882,invoice:_0x5cbb07,JO_number:_0x1de5a6,expiry_date:_0x7a354c}=_0x548359[_0x49f762(0x25a)];if(typeof _0x235fd9==_0x49f762(0x20c))var _0x5c4cee=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x280)]],_0x6084d5=[_0x548359['body'][_0x49f762(0x275)]],_0x2f7643=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x21d)]],_0x2e58c2=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x26a)]],_0x4b8385=[_0x548359['body'][_0x49f762(0x25d)]],_0x348056=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x21b)]],_0x35edf8=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x1e5)]],_0x3ffc67=[_0x548359[_0x49f762(0x25a)]['Secondary_units']],_0x25e753=[_0x548359['body'][_0x49f762(0x258)]],_0x19e21f=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x233)]],_0x1d7f4c=[_0x548359['body'][_0x49f762(0x1ea)]],_0x42ba4c=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x1f8)]],_0x12cd40=[_0x548359['body'][_0x49f762(0x221)]],_0x38f0fd=[_0x548359[_0x49f762(0x25a)][_0x49f762(0x267)]],_0x24bfed=[_0x548359[_0x49f762(0x25a)]['maxPerUnit']],_0x348288=[_0x548359['body'][_0x49f762(0x2ab)]];else var _0x5c4cee=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x280)]],_0x6084d5=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x275)]],_0x2f7643=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x21d)]],_0x2e58c2=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x26a)]],_0x4b8385=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x25d)]],_0x348056=[..._0x548359[_0x49f762(0x25a)]['New_Qty_Converted']],_0x35edf8=[..._0x548359[_0x49f762(0x25a)]['Primary_Units']],_0x3ffc67=[..._0x548359['body'][_0x49f762(0x2b8)]],_0x25e753=[..._0x548359[_0x49f762(0x25a)]['prod_code']],_0x19e21f=[..._0x548359[_0x49f762(0x25a)]['batch_code']],_0x1d7f4c=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x1ea)]],_0x42ba4c=[..._0x548359['body']['product_date']],_0x12cd40=[..._0x548359[_0x49f762(0x25a)]['prod_cat']],_0x38f0fd=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x267)]],_0x24bfed=[..._0x548359['body'][_0x49f762(0x248)]],_0x348288=[..._0x548359[_0x49f762(0x25a)][_0x49f762(0x2ab)]];const _0x473b19=_0x5c4cee['map'](_0x57ec57=>{return _0x57ec57={'product_name':_0x57ec57};});_0x6084d5[_0x49f762(0x2b5)]((_0x324fa0,_0x167699)=>{var _0x2e78ce=_0x49f762;_0x473b19[_0x167699][_0x2e78ce(0x239)]=_0x324fa0;}),_0x2f7643[_0x49f762(0x2b5)]((_0x4b2be5,_0x5ccb0c)=>{_0x473b19[_0x5ccb0c]['stockBefore']=_0x4b2be5;}),_0x2e58c2[_0x49f762(0x2b5)]((_0x5dbc42,_0x37eb62)=>{var _0x1c5115=_0x49f762;_0x473b19[_0x37eb62][_0x1c5115(0x26a)]=_0x5dbc42;}),_0x4b8385[_0x49f762(0x2b5)]((_0x3da4d3,_0x146104)=>{var _0x10fd95=_0x49f762;_0x473b19[_0x146104][_0x10fd95(0x2aa)]=_0x3da4d3;}),_0x348056[_0x49f762(0x2b5)]((_0x35c603,_0x554c83)=>{_0x473b19[_0x554c83]['new_adjust_qty']=_0x35c603;}),_0x35edf8[_0x49f762(0x2b5)]((_0x161b83,_0x2d1958)=>{_0x473b19[_0x2d1958]['unit']=_0x161b83;}),_0x3ffc67['forEach']((_0x128ef9,_0x4ef594)=>{var _0x3fc5c8=_0x49f762;_0x473b19[_0x4ef594][_0x3fc5c8(0x201)]=_0x128ef9;}),_0x25e753[_0x49f762(0x2b5)]((_0x4cd863,_0x3862d6)=>{_0x473b19[_0x3862d6]['product_code']=_0x4cd863;}),_0x19e21f[_0x49f762(0x2b5)]((_0x28d171,_0x3218fc)=>{var _0x17aedb=_0x49f762;_0x473b19[_0x3218fc][_0x17aedb(0x233)]=_0x28d171;}),_0x1d7f4c['forEach']((_0x1e338d,_0x5915c3)=>{_0x473b19[_0x5915c3]['expiry_date']=_0x1e338d;}),_0x42ba4c['forEach']((_0xf44ee9,_0x2d6738)=>{var _0x16a746=_0x49f762;_0x473b19[_0x2d6738][_0x16a746(0x223)]=_0xf44ee9;}),_0x12cd40['forEach']((_0x1d4a16,_0x3081b3)=>{var _0x4d7bbe=_0x49f762;_0x473b19[_0x3081b3][_0x4d7bbe(0x221)]=_0x1d4a16;}),_0x38f0fd[_0x49f762(0x2b5)]((_0x5d6f5f,_0x2e113f)=>{_0x473b19[_0x2e113f]['room_names']=_0x5d6f5f;}),_0x24bfed[_0x49f762(0x2b5)]((_0x2f7856,_0x59801f)=>{_0x473b19[_0x59801f]['maxPerUnit']=_0x2f7856;}),_0x348288[_0x49f762(0x2b5)]((_0x3d7a08,_0x5b212e)=>{var _0x85bc97=_0x49f762;_0x473b19[_0x5b212e][_0x85bc97(0x241)]=_0x3d7a08;});const _0x42581e=_0x473b19['filter'](_0x47f6a1=>_0x47f6a1[_0x49f762(0x2aa)]!=='0'&&_0x47f6a1[_0x49f762(0x2aa)]!=='');var _0x1cae33=0x0;_0x42581e['forEach'](_0x187287=>{var _0x5424c2=_0x49f762;console[_0x5424c2(0x274)](_0x5424c2(0x1fd),_0x187287),parseInt(_0x187287[_0x5424c2(0x2aa)])<=0x0&&_0x1cae33++;});if(_0x1cae33!=0x0)return _0x548359[_0x49f762(0x2b2)](_0x49f762(0x28b),_0x49f762(0x20e)),_0x262bb6[_0x49f762(0x250)]('back');const _0x681868=new adjustment_finished({'warehouse_name':_0x100bdf,'date':_0x453815,'product':_0x42581e,'note':_0x28e8e1,'room':_0x2c8882,'invoice':_0x5cbb07,'JO_number':_0x1de5a6,'expiry_date':_0x7a354c}),_0x47bbb8=await _0x681868[_0x49f762(0x1e6)]();_0x548359[_0x49f762(0x2b2)](_0x49f762(0x24a),_0x49f762(0x224)),_0x262bb6[_0x49f762(0x250)](_0x49f762(0x1e9)+_0x47bbb8[_0x49f762(0x2a0)]);}catch(_0x558eaf){console[_0x49f762(0x274)](_0x558eaf),_0x262bb6['status'](0xc8)[_0x49f762(0x285)]({'message':_0x558eaf['message']});}}),router[a0_0x260632(0x212)](a0_0x260632(0x219),auth,async(_0xb2bfdb,_0x136bba)=>{var _0x338a67=a0_0x260632;try{const {username:_0x3e7e5a,email:_0x37753a,role:_0x227496}=_0xb2bfdb['user'],_0x4fbb14=_0xb2bfdb[_0x338a67(0x268)],_0xd2ba94=await profile['findOne']({'email':_0x4fbb14[_0x338a67(0x20a)]}),_0x5a44f8=await master_shop[_0x338a67(0x1f2)](),_0xdc2769=_0xb2bfdb[_0x338a67(0x22f)]['id'],_0x32387f=await adjustment_finished[_0x338a67(0x218)]({'_id':_0xdc2769}),_0x563823=await purchases[_0x338a67(0x286)]([{'$match':{'warehouse_name':_0x32387f[_0x338a67(0x272)]}},{'$unwind':_0x338a67(0x242)},{'$group':{'_id':_0x338a67(0x25c)}}]);console[_0x338a67(0x274)](_0x338a67(0x26f),_0x563823);const _0x18f4e0=await product['find']({}),_0x1b8bd7=await warehouse['aggregate']([{'$match':{'name':_0x32387f[_0x338a67(0x272)],'warehouse_category':_0x338a67(0x230)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x338a67(0x21a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x338a67(0x266)},'bay':{'$first':_0x338a67(0x2a9)},'bin':{'$first':_0x338a67(0x1ed)},'type':{'$first':_0x338a67(0x200)},'floorlevel':{'$first':_0x338a67(0x292)},'primary_code':{'$first':_0x338a67(0x2b7)},'secondary_code':{'$first':_0x338a67(0x26d)},'product_code':{'$first':_0x338a67(0x271)},'storage':{'$first':_0x338a67(0x296)},'rack':{'$first':_0x338a67(0x255)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x338a67(0x205)},'batch_code':{'$first':'$product_details.batch_code'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x338a67(0x254)}}}]);if(_0x5a44f8[0x0]['language']==_0x338a67(0x22b)){var _0x2f6f04=users[_0x338a67(0x26e)];console[_0x338a67(0x274)](_0x2f6f04);}else{if(_0x5a44f8[0x0][_0x338a67(0x294)]==_0x338a67(0x23a))var _0x2f6f04=users[_0x338a67(0x23a)];else{if(_0x5a44f8[0x0][_0x338a67(0x294)]==_0x338a67(0x24b))var _0x2f6f04=users['German'];else{if(_0x5a44f8[0x0][_0x338a67(0x294)]=='Spanish')var _0x2f6f04=users[_0x338a67(0x1f6)];else{if(_0x5a44f8[0x0]['language']==_0x338a67(0x279))var _0x2f6f04=users[_0x338a67(0x279)];else{if(_0x5a44f8[0x0][_0x338a67(0x294)]==_0x338a67(0x1f1))var _0x2f6f04=users[_0x338a67(0x23b)];else{if(_0x5a44f8[0x0][_0x338a67(0x294)]==_0x338a67(0x290))var _0x2f6f04=users[_0x338a67(0x290)];else{if(_0x5a44f8[0x0][_0x338a67(0x294)]==_0x338a67(0x2a4))var _0x2f6f04=users['Arabic'];}}}}}}}_0x136bba['render'](_0x338a67(0x264),{'success':_0xb2bfdb[_0x338a67(0x2b2)]('success'),'errors':_0xb2bfdb[_0x338a67(0x2b2)]('errors'),'role':_0x4fbb14,'profile':_0xd2ba94,'adjustment':_0x32387f,'stock':_0x1b8bd7,'master_shop':_0x5a44f8,'warehouse_name':_0x563823,'unit':_0x18f4e0,'language':_0x2f6f04});}catch(_0x1c8cfa){console[_0x338a67(0x274)](_0x1c8cfa),_0x136bba['status'](0xc8)[_0x338a67(0x285)]({'message':_0x1c8cfa[_0x338a67(0x23d)]});}}),router[a0_0x260632(0x2a2)](a0_0x260632(0x219),auth,async(_0xf6b978,_0x319e64)=>{var _0x4a42f0=a0_0x260632;try{const {invoice:_0x12b859,warehouse_name:_0x3afd61,Room_name:_0x4e6c8f}=_0xf6b978[_0x4a42f0(0x25a)],_0x4dc387=_0xf6b978[_0x4a42f0(0x22f)]['id'],_0x418c09=await adjustment_finished['findById']({'_id':_0x4dc387});var _0x45f325;const _0x5c33ea=_0x418c09[_0x4a42f0(0x2ac)][_0x4a42f0(0x270)](async _0x50eb5b=>{var _0x5f49a2=_0x4a42f0;if(_0x50eb5b[_0x5f49a2(0x2aa)]>0x0){_0x45f325=await warehouse[_0x5f49a2(0x216)]({'name':_0x3afd61,'room':_0x50eb5b[_0x5f49a2(0x26b)],'warehouse_category':_0x5f49a2(0x230)});const _0x24c35f=_0x45f325['product_details']['map'](_0x3fee8d=>{var _0x282ada=_0x5f49a2;console[_0x282ada(0x274)](_0x50eb5b[_0x282ada(0x26a)]);if(_0x50eb5b['types']=='minus')_0x3fee8d[_0x282ada(0x2b1)]==_0x50eb5b[_0x282ada(0x2b1)]&&_0x3fee8d[_0x282ada(0x239)]==_0x50eb5b['bay']&&_0x3fee8d['expiry_date']==_0x50eb5b[_0x282ada(0x1ea)]&&_0x3fee8d[_0x282ada(0x223)]==_0x50eb5b['production_date']&&_0x3fee8d['batch_code']==_0x50eb5b[_0x282ada(0x233)]&&_0x3fee8d[_0x282ada(0x241)]==_0x50eb5b[_0x282ada(0x241)]&&(_0x3fee8d[_0x282ada(0x29a)]=_0x3fee8d[_0x282ada(0x29a)]-_0x50eb5b[_0x282ada(0x2aa)]);else _0x50eb5b[_0x282ada(0x26a)]==_0x282ada(0x1fa)&&(_0x3fee8d[_0x282ada(0x2b1)]==_0x50eb5b['product_name']&&_0x3fee8d[_0x282ada(0x239)]==_0x50eb5b[_0x282ada(0x239)]&&_0x3fee8d[_0x282ada(0x1ea)]==_0x50eb5b['expiry_date']&&_0x3fee8d[_0x282ada(0x223)]==_0x50eb5b[_0x282ada(0x223)]&&_0x3fee8d[_0x282ada(0x233)]==_0x50eb5b[_0x282ada(0x233)]&&_0x3fee8d[_0x282ada(0x241)]==_0x50eb5b[_0x282ada(0x241)]&&(_0x3fee8d[_0x282ada(0x29a)]=_0x3fee8d[_0x282ada(0x29a)]+_0x50eb5b['adjust_qty']));});}return _0x45f325;});Promise['all'](_0x5c33ea)[_0x4a42f0(0x265)](async _0x1fd522=>{var _0x5072db=_0x4a42f0;try{for(const _0x59bc18 of _0x1fd522){await _0x59bc18[_0x5072db(0x1e6)]();}_0x418c09[_0x5072db(0x244)]=_0x5072db(0x27c);const _0x21d208=await _0x418c09[_0x5072db(0x1e6)](),_0x1af161=await master_shop[_0x5072db(0x1f2)](),_0x1b13b6=await email_settings['findOne'](),_0x11065a=await supervisor_settings[_0x5072db(0x1f2)]();var _0xab2792=_0x418c09[_0x5072db(0x2ac)],_0x2bb4c6='',_0x309220;for(_0x309220 in _0xab2792){var _0x1faa17='FG';_0x418c09[_0x5072db(0x272)]==_0x5072db(0x252)&&(_0x1faa17='DG'),_0x2bb4c6+=_0x5072db(0x2a8)+_0x5072db(0x260)+_0xab2792[_0x309220][_0x5072db(0x2b1)]+'</td>'+_0x5072db(0x260)+_0xab2792[_0x309220]['product_code']+_0x5072db(0x20d)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0xab2792[_0x309220][_0x5072db(0x2aa)]+_0x5072db(0x20d)+_0x5072db(0x260)+_0xab2792[_0x309220][_0x5072db(0x217)]+_0x5072db(0x20d)+_0x5072db(0x260)+_0xab2792[_0x309220][_0x5072db(0x201)]+'</td>'+_0x5072db(0x260)+_0x418c09[_0x5072db(0x272)]+_0x5072db(0x20d)+_0x5072db(0x260)+_0xab2792[_0x309220][_0x5072db(0x26b)]+'</td>'+_0x5072db(0x260)+_0x1faa17+_0xab2792[_0x309220]['bay']+'</td>'+_0x5072db(0x2b4);}let _0x4d1204=nodemailer[_0x5072db(0x259)]({'host':_0x1b13b6['host'],'port':Number(_0x1b13b6[_0x5072db(0x24e)]),'secure':![],'auth':{'user':_0x1b13b6[_0x5072db(0x20a)],'pass':_0x1b13b6['password']}}),_0x5c4617={'from':_0x1b13b6[_0x5072db(0x20a)],'to':_0x11065a[0x0][_0x5072db(0x247)],'subject':_0x5072db(0x284),'attachments':[{'filename':_0x5072db(0x28f),'path':__dirname+_0x5072db(0x289)+_0x5072db(0x27b)+_0x1af161[0x0][_0x5072db(0x227)],'cid':_0x5072db(0x209)}],'html':_0x5072db(0x1f3)+_0x5072db(0x21e)+_0x5072db(0x299)+_0x5072db(0x24d)+_0x5072db(0x1ee)+_0x5072db(0x24d)+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+_0x5072db(0x228)+'<div>'+'<h2>\x20'+_0x1af161[0x0]['site_title']+'\x20</h2>'+'</div>'+_0x5072db(0x228)+_0x5072db(0x215)+'<div>'+_0x5072db(0x214)+_0x5072db(0x220)+_0x418c09[_0x5072db(0x241)]+'\x20'+_0x5072db(0x293)+'\x20Order\x20Date\x20:\x20'+_0x418c09[_0x5072db(0x203)]+'\x20'+_0x5072db(0x291)+_0x5072db(0x23c)+_0x5072db(0x228)+_0x5072db(0x281)+_0x5072db(0x262)+_0x5072db(0x2a8)+_0x5072db(0x2a1)+_0x5072db(0x283)+_0x5072db(0x276)+_0x5072db(0x29d)+_0x5072db(0x1e7)+_0x5072db(0x277)+_0x5072db(0x229)+_0x5072db(0x1f4)+_0x5072db(0x2b4)+'</thead>'+_0x5072db(0x2ad)+'\x20'+_0x2bb4c6+'\x20'+_0x5072db(0x1fb)+_0x5072db(0x29c)+'<div>'+_0x5072db(0x24f)+_0x5072db(0x1eb)+_0x1af161[0x0][_0x5072db(0x243)]+_0x5072db(0x23c)+_0x5072db(0x228)+_0x5072db(0x228)+_0x5072db(0x27e)};_0x4d1204[_0x5072db(0x24c)](_0x5c4617,function(_0x321702,_0xf0db03){var _0x4025f4=_0x5072db;_0x321702?(console[_0x4025f4(0x274)](_0x321702),console[_0x4025f4(0x274)](_0x4025f4(0x22a))):console[_0x4025f4(0x274)](_0x4025f4(0x253));}),_0xf6b978[_0x5072db(0x2b2)](_0x5072db(0x24a),'Adjustment\x20Finalize\x20Successfully'),_0x319e64['redirect'](_0x5072db(0x29b)+_0x21d208[_0x5072db(0x2a0)]);}catch(_0x2e7efa){console[_0x5072db(0x251)](_0x2e7efa),_0x319e64['status'](0x1f4)['json']({'error':_0x5072db(0x29f)});}})['catch'](_0x420451=>{var _0x50aec1=_0x4a42f0;console[_0x50aec1(0x251)](_0x420451),_0x319e64[_0x50aec1(0x20f)](0x1f4)[_0x50aec1(0x285)]({'error':_0x50aec1(0x2af)});});}catch(_0x2e5bbe){_0x319e64[_0x4a42f0(0x285)]({'message':_0x2e5bbe[_0x4a42f0(0x23d)]});}}),router['get']('/view/:id',auth,async(_0x41768b,_0x33a91c)=>{var _0x310ef0=a0_0x260632;try{const {username:_0x3da3fb,email:_0x4bb333,role:_0x39922d}=_0x41768b[_0x310ef0(0x268)],_0x41fee7=_0x41768b[_0x310ef0(0x268)],_0x300fd1=await profile[_0x310ef0(0x216)]({'email':_0x41fee7['email']}),_0x5295c4=await master_shop[_0x310ef0(0x1f2)]();console[_0x310ef0(0x274)](_0x310ef0(0x2b0),_0x5295c4);const _0x8e11cb=_0x41768b[_0x310ef0(0x22f)]['id'],_0x3d9bd6=await adjustment_finished[_0x310ef0(0x218)]({'_id':_0x8e11cb});let _0x42004c=new Date(_0x3d9bd6[_0x310ef0(0x1ea)]),_0x5f13e8=('0'+_0x42004c[_0x310ef0(0x222)]())[_0x310ef0(0x238)](-0x2),_0xbbb8aa=('0'+(_0x42004c['getMonth']()+0x1))['slice'](-0x2),_0x5cb3b9=_0x42004c[_0x310ef0(0x240)](),_0x5f057d=_0x5cb3b9+'-'+_0xbbb8aa+'-'+_0x5f13e8;var _0x299cf9=[_0x310ef0(0x278),_0x310ef0(0x234),_0x310ef0(0x2a5)];const _0x56c422=await purchases[_0x310ef0(0x286)]([{'$match':{'warehouse_name':_0x3d9bd6[_0x310ef0(0x272)]}},{'$unwind':'$product'},{'$group':{'_id':_0x310ef0(0x25c)}}]);console[_0x310ef0(0x274)](_0x310ef0(0x26f),_0x56c422);const _0x1ccab1=await product[_0x310ef0(0x1f2)]({}),_0x2cb6e9=await warehouse[_0x310ef0(0x286)]([{'$match':{'name':_0x3d9bd6[_0x310ef0(0x272)],'room':_0x3d9bd6[_0x310ef0(0x1ff)]}},{'$unwind':_0x310ef0(0x25b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x310ef0(0x263)},'product_stock':{'$first':_0x310ef0(0x266)},'bay':{'$first':_0x310ef0(0x2a9)},'bin':{'$first':_0x310ef0(0x1ed)},'type':{'$first':_0x310ef0(0x200)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x310ef0(0x2b7)},'secondary_code':{'$first':_0x310ef0(0x26d)},'product_code':{'$first':_0x310ef0(0x271)},'storage':{'$first':_0x310ef0(0x296)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x5295c4[0x0][_0x310ef0(0x294)]=='English\x20(US)'){var _0x1c3a55=users['English'];console[_0x310ef0(0x274)](_0x1c3a55);}else{if(_0x5295c4[0x0][_0x310ef0(0x294)]==_0x310ef0(0x23a))var _0x1c3a55=users['Hindi'];else{if(_0x5295c4[0x0]['language']==_0x310ef0(0x24b))var _0x1c3a55=users[_0x310ef0(0x24b)];else{if(_0x5295c4[0x0][_0x310ef0(0x294)]==_0x310ef0(0x1f6))var _0x1c3a55=users['Spanish'];else{if(_0x5295c4[0x0]['language']==_0x310ef0(0x279))var _0x1c3a55=users[_0x310ef0(0x279)];else{if(_0x5295c4[0x0][_0x310ef0(0x294)]==_0x310ef0(0x1f1))var _0x1c3a55=users[_0x310ef0(0x23b)];else{if(_0x5295c4[0x0]['language']==_0x310ef0(0x290))var _0x1c3a55=users[_0x310ef0(0x290)];else{if(_0x5295c4[0x0]['language']==_0x310ef0(0x2a4))var _0x1c3a55=users[_0x310ef0(0x225)];}}}}}}}_0x33a91c[_0x310ef0(0x20b)](_0x310ef0(0x261),{'success':_0x41768b['flash'](_0x310ef0(0x24a)),'errors':_0x41768b[_0x310ef0(0x2b2)](_0x310ef0(0x28b)),'role':_0x41fee7,'profile':_0x300fd1,'adjustment':_0x3d9bd6,'stock':_0x2cb6e9,'master_shop':_0x5295c4,'warehouse_name':_0x56c422,'unit':_0x1ccab1,'language':_0x1c3a55,'rooms_data':_0x299cf9,'ed_fullDate':_0x5f057d});}catch(_0x348f69){console['log'](_0x348f69),_0x33a91c[_0x310ef0(0x20f)](0xc8)[_0x310ef0(0x285)]({'message':_0x348f69[_0x310ef0(0x23d)]});}}),router[a0_0x260632(0x2a2)](a0_0x260632(0x1f0),auth,async(_0x586e41,_0x1d9496)=>{var _0x2f4939=a0_0x260632;try{const _0x1f95f6=_0x586e41[_0x2f4939(0x22f)]['id'],_0x152c15=await adjustment_finished[_0x2f4939(0x218)]({'_id':_0x1f95f6}),_0x27cdb6=await warehouse[_0x2f4939(0x216)]({'name':_0x152c15['warehouse_name'],'room':_0x152c15[_0x2f4939(0x1ff)]}),{warehouse_name:_0x9959c3,date:_0x531ba1,prod_name:_0x3748be,level:_0x587bc3,isle:_0x1fc93c,pallet:_0x46f107,stock:_0x54b8cc,types:_0x4d41aa,adjust_qty:_0x2983de,new_adjust_qty:_0x5787df,note:_0x8bce91,Room_name:_0x2f4f85,invoice:_0x2ea40b,JO_number:_0xe4c716}=_0x586e41[_0x2f4939(0x25a)];if(typeof _0x3748be==_0x2f4939(0x20c))var _0x5b03be=[_0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x280)]],_0x13d6c1=[_0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x275)]],_0x359065=[_0x586e41[_0x2f4939(0x25a)]['stock']],_0x51c1b0=[_0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x26a)]],_0x952711=[_0x586e41['body'][_0x2f4939(0x2aa)]],_0x265469=[_0x586e41['body'][_0x2f4939(0x21f)]],_0x4a7158=[_0x586e41['body']['prod_code']],_0x15e24f=[_0x586e41['body'][_0x2f4939(0x217)]],_0x815c3b=[_0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x2b8)]],_0x1ce980=[_0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x233)]],_0x8a4106=[_0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x1ea)]];else var _0x5b03be=[..._0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x280)]],_0x13d6c1=[..._0x586e41['body'][_0x2f4939(0x275)]],_0x359065=[..._0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x21d)]],_0x51c1b0=[..._0x586e41['body'][_0x2f4939(0x26a)]],_0x952711=[..._0x586e41['body'][_0x2f4939(0x2aa)]],_0x265469=[..._0x586e41[_0x2f4939(0x25a)]['new_adjust_qty']],_0x4a7158=[..._0x586e41['body'][_0x2f4939(0x258)]],_0x15e24f=[..._0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x217)]],_0x815c3b=[..._0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x2b8)]],_0x1ce980=[..._0x586e41['body'][_0x2f4939(0x233)]],_0x8a4106=[..._0x586e41[_0x2f4939(0x25a)][_0x2f4939(0x1ea)]];const _0x306b08=_0x5b03be[_0x2f4939(0x270)](_0x3d0a07=>{return _0x3d0a07={'product_name':_0x3d0a07};});_0x13d6c1['forEach']((_0x1ab352,_0x4c2d6e)=>{var _0x54cc49=_0x2f4939;_0x306b08[_0x4c2d6e][_0x54cc49(0x239)]=_0x1ab352;}),_0x359065[_0x2f4939(0x2b5)]((_0x2a9d30,_0x45bb93)=>{var _0x764e05=_0x2f4939;_0x306b08[_0x45bb93][_0x764e05(0x1f9)]=_0x2a9d30;}),_0x51c1b0[_0x2f4939(0x2b5)]((_0x27a0c7,_0x5d035e)=>{var _0x42f15f=_0x2f4939;_0x306b08[_0x5d035e][_0x42f15f(0x26a)]=_0x27a0c7;}),_0x952711[_0x2f4939(0x2b5)]((_0x2306be,_0x477911)=>{_0x306b08[_0x477911]['adjust_qty']=_0x2306be;}),_0x265469[_0x2f4939(0x2b5)]((_0x3344c0,_0x5ecb45)=>{var _0x56f7d6=_0x2f4939;_0x306b08[_0x5ecb45][_0x56f7d6(0x21f)]=_0x3344c0;}),_0x15e24f[_0x2f4939(0x2b5)]((_0x1cd26c,_0x49017a)=>{var _0x14d7d5=_0x2f4939;_0x306b08[_0x49017a][_0x14d7d5(0x217)]=_0x1cd26c;}),_0x815c3b[_0x2f4939(0x2b5)]((_0x3725b6,_0x5d7c30)=>{var _0x186860=_0x2f4939;_0x306b08[_0x5d7c30][_0x186860(0x201)]=_0x3725b6;}),_0x4a7158[_0x2f4939(0x2b5)]((_0x1d6217,_0x330cf2)=>{var _0x6bc3b1=_0x2f4939;_0x306b08[_0x330cf2][_0x6bc3b1(0x21c)]=_0x1d6217;}),_0x1ce980['forEach']((_0x21b010,_0x5ed5a8)=>{var _0x9ac30=_0x2f4939;_0x306b08[_0x5ed5a8][_0x9ac30(0x233)]=_0x21b010;}),_0x8a4106[_0x2f4939(0x2b5)]((_0x514661,_0x250c92)=>{_0x306b08[_0x250c92]['expiry_date']=_0x514661;});const _0x2eac10=_0x306b08[_0x2f4939(0x256)](_0x5df482=>_0x5df482[_0x2f4939(0x2aa)]!=='0'&&_0x5df482[_0x2f4939(0x2aa)]!=='');var _0x3ee625=0x0;_0x2eac10[_0x2f4939(0x2b5)](_0x58505f=>{var _0x524da9=_0x2f4939;console[_0x524da9(0x274)](_0x524da9(0x1fd),_0x58505f),parseInt(_0x58505f[_0x524da9(0x2aa)])<=0x0&&_0x3ee625++;});if(_0x3ee625!=0x0)return _0x586e41[_0x2f4939(0x2b2)](_0x2f4939(0x28b),_0x2f4939(0x20e)),_0x1d9496[_0x2f4939(0x250)]('back');_0x152c15[_0x2f4939(0x272)]=_0x9959c3,_0x152c15['date']=_0x531ba1,_0x152c15[_0x2f4939(0x2ac)]=_0x2eac10,_0x152c15[_0x2f4939(0x204)]=_0x8bce91,_0x152c15[_0x2f4939(0x1ff)]=_0x2f4f85,_0x152c15[_0x2f4939(0x241)]=_0x2ea40b,_0x152c15[_0x2f4939(0x27a)]=_0xe4c716;const _0x2e727f=await _0x152c15['save'](),_0x2118f9=await warehouse['findOne']({'name':_0x9959c3,'room':_0x2f4f85});_0x2e727f[_0x2f4939(0x2ac)]['forEach'](_0x3134ca=>{var _0x4367c9=_0x2f4939;const _0x330574=_0x2118f9[_0x4367c9(0x297)]['map'](_0x422242=>{var _0x5d0f63=_0x4367c9;_0x3134ca[_0x5d0f63(0x26a)]=='minus'?_0x422242[_0x5d0f63(0x2b1)]==_0x3134ca[_0x5d0f63(0x2b1)]&&_0x422242[_0x5d0f63(0x239)]==_0x3134ca['bay']&&(_0x422242['product_stock']=parseInt(_0x422242['product_stock'])-parseInt(_0x3134ca[_0x5d0f63(0x2aa)])):_0x422242[_0x5d0f63(0x2b1)]==_0x3134ca[_0x5d0f63(0x2b1)]&&_0x422242[_0x5d0f63(0x239)]==_0x3134ca[_0x5d0f63(0x239)]&&(_0x422242['product_stock']=parseInt(_0x422242[_0x5d0f63(0x29a)])+parseInt(_0x3134ca[_0x5d0f63(0x2aa)]));});}),await _0x2118f9[_0x2f4939(0x1e6)](),_0x586e41[_0x2f4939(0x2b2)]('success',_0x2f4939(0x211)),_0x1d9496[_0x2f4939(0x250)](_0x2f4939(0x245));}catch(_0x53087b){console['log'](_0x53087b);}}),router['post'](a0_0x260632(0x28e),async(_0x5dce24,_0x15bee8)=>{var _0x16f931=a0_0x260632;const {primary_code:_0x287c93,warehouse_data:_0x3d2137,rooms_data:_0x260e6a,Roomslist:_0x29476e}=_0x5dce24[_0x16f931(0x25a)],_0x36c795=_0x29476e[_0x16f931(0x236)](','),_0x51efae=[];async function _0x5e964f(_0x5a0def){var _0x2e0b49=_0x16f931;const _0x5eb550=await warehouse['aggregate']([{'$match':{'name':_0x3d2137,'room':_0x5a0def}},{'$unwind':_0x2e0b49(0x25b)},{'$match':{'product_details.primary_code':_0x287c93}},{'$group':{'_id':_0x2e0b49(0x21a),'name':{'$first':_0x2e0b49(0x263)},'product_stock':{'$first':_0x2e0b49(0x266)},'primary_code':{'$first':_0x2e0b49(0x2b7)},'secondary_code':{'$first':_0x2e0b49(0x26d)},'product_code':{'$first':_0x2e0b49(0x271)},'level':{'$first':_0x2e0b49(0x2a9)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2e0b49(0x200)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2e0b49(0x232)},'secondary_unit':{'$first':_0x2e0b49(0x249)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2e0b49(0x255)},'expiry_date':{'$first':_0x2e0b49(0x29e)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2e0b49(0x27d)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x2e0b49(0x246)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2e0b49(0x206)}}}]),_0x16dc1c=await warehouse['aggregate']([{'$match':{'name':_0x3d2137,'room':_0x5a0def}},{'$unwind':_0x2e0b49(0x25b)},{'$match':{'product_details.secondary_code':_0x287c93}},{'$group':{'_id':_0x2e0b49(0x21a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x2e0b49(0x266)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2e0b49(0x2a9)},'isle':{'$first':_0x2e0b49(0x1ed)},'type':{'$first':_0x2e0b49(0x200)},'pallet':{'$first':_0x2e0b49(0x292)},'unit':{'$first':_0x2e0b49(0x232)},'secondary_unit':{'$first':_0x2e0b49(0x249)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x2e0b49(0x255)},'expiry_date':{'$first':_0x2e0b49(0x29e)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x2e0b49(0x27d)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x2e0b49(0x246)},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0x2e0b49(0x206)}}}]);if(_0x5eb550[_0x2e0b49(0x28d)]>0x0)_0x51efae[_0x2e0b49(0x1f7)](_0x5eb550);else _0x16dc1c['length']>0x0&&_0x51efae[_0x2e0b49(0x1f7)](_0x16dc1c);}const _0x43a4d2=_0x36c795[_0x16f931(0x270)](_0x553e83=>_0x5e964f(_0x553e83));await Promise['all'](_0x43a4d2),_0x15bee8[_0x16f931(0x285)](_0x51efae);}),router[a0_0x260632(0x2a2)](a0_0x260632(0x282),async(_0x581bbd,_0x3046b1)=>{var _0x3b2f77=a0_0x260632;const {productCode:_0x16a3e5,bay:_0x50ee5a,warehouses:_0x2d670e,room:_0x49f7d5}=_0x581bbd['body'];console[_0x3b2f77(0x274)](_0x581bbd[_0x3b2f77(0x25a)]);try{const _0x301c2d=await warehouse['aggregate']([{'$match':{'name':_0x2d670e,'room':_0x49f7d5}},{'$unwind':_0x3b2f77(0x25b)},{'$match':{'product_details.bay':parseInt(_0x50ee5a)}},{'$group':{'_id':_0x3b2f77(0x21a),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b2f77(0x266)},'bay':{'$first':_0x3b2f77(0x2a9)},'maxProducts':{'$first':_0x3b2f77(0x22c)}}}]);_0x3046b1[_0x3b2f77(0x20f)](0xc8)[_0x3b2f77(0x285)](_0x301c2d);}catch(_0x587926){_0x3046b1[_0x3b2f77(0x20f)](0x194)['json']({'message':_0x587926['message']});}}),module[a0_0x260632(0x207)]=router;