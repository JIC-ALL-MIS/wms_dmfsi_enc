var a0_0x3e27fb=a0_0x2700;(function(_0x1deedf,_0x2ed21a){var _0x2c2ccb=a0_0x2700,_0x498e3e=_0x1deedf();while(!![]){try{var _0x53d8c2=-parseInt(_0x2c2ccb(0x143))/0x1*(parseInt(_0x2c2ccb(0x141))/0x2)+-parseInt(_0x2c2ccb(0x166))/0x3+-parseInt(_0x2c2ccb(0xf1))/0x4+parseInt(_0x2c2ccb(0x162))/0x5*(parseInt(_0x2c2ccb(0x10e))/0x6)+-parseInt(_0x2c2ccb(0xfe))/0x7+parseInt(_0x2c2ccb(0x14f))/0x8+-parseInt(_0x2c2ccb(0x146))/0x9*(-parseInt(_0x2c2ccb(0x142))/0xa);if(_0x53d8c2===_0x2ed21a)break;else _0x498e3e['push'](_0x498e3e['shift']());}catch(_0x2a0574){_0x498e3e['push'](_0x498e3e['shift']());}}}(a0_0x4b1a,0x34c2c));const express=require(a0_0x3e27fb(0x19a)),app=express(),router=express[a0_0x3e27fb(0x192)](),auth=require(a0_0x3e27fb(0x185)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x3e27fb(0xe0)),users=require(a0_0x3e27fb(0x110)),nodemailer=require(a0_0x3e27fb(0xe3));function a0_0x2700(_0x1bf760,_0x698c51){var _0x4b1a59=a0_0x4b1a();return a0_0x2700=function(_0x2700b6,_0x59eda6){_0x2700b6=_0x2700b6-0xd3;var _0x39f3b3=_0x4b1a59[_0x2700b6];return _0x39f3b3;},a0_0x2700(_0x1bf760,_0x698c51);}router[a0_0x3e27fb(0x16f)](a0_0x3e27fb(0x114),auth,async(_0x3a5813,_0x1c7351)=>{var _0x5da78f=a0_0x3e27fb;try{const {username:_0x3c9b04,email:_0x4e2715,role:_0x1d274c}=_0x3a5813['user'],_0x2df08a=_0x3a5813['user'],_0x489f72=await profile['findOne']({'email':_0x2df08a['email']}),_0x32f434=await master_shop[_0x5da78f(0x180)]();let _0x5cd555;if(_0x2df08a['role']==_0x5da78f(0x106)){const _0x10f738=await staff[_0x5da78f(0xf9)]({'email':_0x2df08a[_0x5da78f(0x17b)]});_0x5cd555=await warehouse[_0x5da78f(0x180)]({'status':'Enabled','name':_0x10f738[_0x5da78f(0x156)]});}else _0x5cd555=await warehouse[_0x5da78f(0x180)]({'status':_0x5da78f(0x179)});const _0x5a1861=await product[_0x5da78f(0x180)]();let _0x29fc31;if(_0x2df08a[_0x5da78f(0xea)]==_0x5da78f(0x106)){const _0x478f66=await staff[_0x5da78f(0xf9)]({'email':_0x2df08a[_0x5da78f(0x17b)]});_0x29fc31=await adjustment_finished[_0x5da78f(0x180)]({'warehouse_name':_0x478f66[_0x5da78f(0x156)]});}else _0x29fc31=await adjustment_finished['aggregate']([{'$unwind':_0x5da78f(0x174)},{'$group':{'_id':_0x5da78f(0x158),'invoice':{'$first':_0x5da78f(0xda)},'date':{'$first':_0x5da78f(0xf2)},'warehouse_name':{'$first':_0x5da78f(0x116)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x5da78f(0x13a)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0x167)){var _0x44fb65=users[_0x5da78f(0x140)];console['log'](_0x44fb65);}else{if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0x17c))var _0x44fb65=users[_0x5da78f(0x17c)];else{if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0x132))var _0x44fb65=users[_0x5da78f(0x132)];else{if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0xed))var _0x44fb65=users[_0x5da78f(0xed)];else{if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0x13c))var _0x44fb65=users['French'];else{if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0x136))var _0x44fb65=users[_0x5da78f(0x197)];else{if(_0x32f434[0x0]['language']=='Chinese')var _0x44fb65=users[_0x5da78f(0xeb)];else{if(_0x32f434[0x0][_0x5da78f(0x12a)]==_0x5da78f(0x171))var _0x44fb65=users[_0x5da78f(0xe6)];}}}}}}}_0x1c7351['render'](_0x5da78f(0x189),{'success':_0x3a5813[_0x5da78f(0x15a)](_0x5da78f(0x164)),'errors':_0x3a5813[_0x5da78f(0x15a)](_0x5da78f(0x168)),'role':_0x2df08a,'profile':_0x489f72,'warehouse':_0x5cd555,'product':_0x5a1861,'adjustment':_0x29fc31,'master_shop':_0x32f434,'language':_0x44fb65});}catch(_0x31674f){console[_0x5da78f(0xf3)](_0x31674f);}});async function getRandom8DigitNumber(){var _0x5345c8=a0_0x3e27fb;const _0xe17a1c=0x989680,_0x4beca5=0x5f5e0ff,_0x467aa3=Math['floor'](Math[_0x5345c8(0xe9)]()*(_0x4beca5-_0xe17a1c+0x1))+_0xe17a1c;var _0x14e97a;const _0xf549f8=await adjustment_finished['findOne']({'invoice':_0x5345c8(0x190)+_0x467aa3});return _0xf549f8&&_0xf549f8[_0x5345c8(0x15f)]>0x0?_0x14e97a=_0x5345c8(0x190)+_0x467aa3:_0x14e97a=_0x5345c8(0x190)+_0x467aa3,_0x14e97a;}function a0_0x4b1a(){var _0x1c3fc2=['There\x27s\x20a\x20error\x20in\x20this\x20transaction','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product','$product_details.maxProducts','$product_details.secondary_unit','$product_details._id','stock','Enabled','$product_details','email','Hindi','json','Ambient','product_stock','find','new_adjust_qty','$product_details.rack','</td>','maxPerUnit','../middleware/auth','Return\x20Rooms','unit','Adjustment\x20Finalize\x20Successfully','adjustment_finished','note','Error\x20Occurs','prod_name','$product_details.expiry_date','getDate','$name','ADJF-','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Router','invoice','/upload/','product','$product_details.secondary_code','Portuguese','Email\x20sent\x20successfully','save','express','message','back','$product_details.maxPerUnit','$product_details.batch_code','$product.product_name','secondary_unit','<!DOCTYPE\x20html>','finalize','\x20Order\x20Number\x20:\x20','_id','Primary_Units','\x20</h2>','production_date','<h5\x20style=\x22text-align:\x20left;\x22>','$invoice','JO_number','user','</tbody>','toString','$product_details.bin','../models/all_models','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','room','nodemailer','$product_details.unit','findById','Arabic','$product_details.floorlevel','level','random','role','Chinese','<div>','Spanish','/CheckingWarehouse','$room','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','1587604qaKaap','$date','log','edit_adjustment_finished_view','prod_code','room_names','</h5>','string','findOne','createTransport','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','Finished\x20Goods','master','2459023NclwZs','minus','getMonth','$product_details.storage','FGSEmail','New_Qty_Converted_adj','<span\x20style=\x22float:\x20right;\x22>','</thead>','staff','/picking_list/PDF_adjustment/','$product_details.production_date','Logo.png','aggregate','<hr\x20class=\x22my-3\x22>','$product_details.bay','redirect','504dNPQuK','/../public','../public/language/languages.json','adjust_qty','foreach\x20newproduct','$product_details.product_stock','/view','bay','$warehouse_name','host','$product_details.product_code','/adjustment_finished/preview/','render','New_Qty_Converted','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','</tr>','image','Secondary_units','all','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','error','/preview/:id','batch_code','stockBefore','Rooms','\x20Order\x20Date\x20:\x20','then','</head><body>','language','sendMail','$product_details.primary_code','prod_cat','product_details','params','padStart','</div>','German','forEach','<h5>','An\x20error\x20occurred\x20while\x20saving\x20data.','Portuguese\x20(BR)','status','$product_details.product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','$finalize','product_code','French','filter','product_date','<html><head><title></title>','English','10MGZagM','130uIgIfs','49065PTYKjc','<table\x20style=\x22width:\x20100%\x20!important;\x22>','expiry_date','535599hSsbiC','$product_details.invoice','map','QA\x20Warehouse','body','/adjustment_finished/view','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','prod_invoice','2598528RWdumO','logo','adjustment\x20data\x20update\x20successfully','types','/view/:id','slice','/barcode_scanner','warehouse','</span>','$_id','<tr>','flash','<strong>\x20Regards\x20</strong>','push','site_title','An\x20error\x20occurred.','length','warehouse_name','/adjustment/view','13775SJpFwT','</body></html>','success','add','360768NyVVPR','English\x20(US)','errors','post','split','date','catch','DRY\x20GOODS','<tbody\x20style=\x22text-align:\x20center;\x22>','get','product_name','Arabic\x20(ae)'];a0_0x4b1a=function(){return _0x1c3fc2;};return a0_0x4b1a();}router['get']('/view/add_adjustment',auth,async(_0x4fbc98,_0x1ee72f)=>{var _0x27edef=a0_0x3e27fb;try{const {username:_0x1e6362,email:_0x3ae58d,role:_0x5d821a}=_0x4fbc98[_0x27edef(0xdc)],_0x569cef=_0x4fbc98['user'],_0x5310ed=await profile[_0x27edef(0xf9)]({'email':_0x569cef[_0x27edef(0x17b)]}),_0x351306=await master_shop[_0x27edef(0x180)]();let _0x2c3420;if(_0x569cef['role']==_0x27edef(0x106)){const _0x44b605=await staff[_0x27edef(0xf9)]({'email':_0x569cef[_0x27edef(0x17b)]});_0x2c3420=await warehouse[_0x27edef(0x10a)]([{'$match':{'status':_0x27edef(0x179),'name':_0x44b605[_0x27edef(0x156)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x27edef(0x18f),'name':{'$first':_0x27edef(0x18f)}}}]);}else _0x2c3420=await warehouse[_0x27edef(0x10a)]([{'$match':{'status':_0x27edef(0x179),'warehouse_category':_0x27edef(0xfc),'name':{'$ne':_0x27edef(0x149)}}},{'$group':{'_id':_0x27edef(0x18f),'name':{'$first':_0x27edef(0x18f)}}}]);const _0xba5ea0=await product[_0x27edef(0x180)]({}),_0x550c89=await adjustment_finished[_0x27edef(0x180)]({}),_0x2c863a=_0x550c89[_0x27edef(0x15f)]+0x1,_0x5128c2=_0x27edef(0x190)+_0x2c863a[_0x27edef(0xde)]()[_0x27edef(0x130)](0x5,'0');var _0x3d2296=[_0x27edef(0x17e),'Enclosed',_0x27edef(0x186)];if(_0x351306[0x0][_0x27edef(0x12a)]==_0x27edef(0x167))var _0x2d08c9=users[_0x27edef(0x140)];else{if(_0x351306[0x0][_0x27edef(0x12a)]==_0x27edef(0x17c))var _0x2d08c9=users[_0x27edef(0x17c)];else{if(_0x351306[0x0]['language']=='German')var _0x2d08c9=users[_0x27edef(0x132)];else{if(_0x351306[0x0][_0x27edef(0x12a)]==_0x27edef(0xed))var _0x2d08c9=users[_0x27edef(0xed)];else{if(_0x351306[0x0][_0x27edef(0x12a)]==_0x27edef(0x13c))var _0x2d08c9=users[_0x27edef(0x13c)];else{if(_0x351306[0x0]['language']==_0x27edef(0x136))var _0x2d08c9=users[_0x27edef(0x197)];else{if(_0x351306[0x0]['language']==_0x27edef(0xeb))var _0x2d08c9=users['Chinese'];else{if(_0x351306[0x0][_0x27edef(0x12a)]==_0x27edef(0x171))var _0x2d08c9=users[_0x27edef(0xe6)];}}}}}}}const _0x39c085=getRandom8DigitNumber();_0x39c085[_0x27edef(0x128)](_0x2847ad=>{var _0x230e8d=_0x27edef;_0x1ee72f[_0x230e8d(0x11a)]('add_adjustment_finished',{'success':_0x4fbc98[_0x230e8d(0x15a)]('success'),'errors':_0x4fbc98[_0x230e8d(0x15a)]('errors'),'role':_0x569cef,'profile':_0x5310ed,'warehouse':_0x2c3420,'product':_0xba5ea0,'master_shop':_0x351306,'language':_0x2d08c9,'rooms_data':_0x3d2296,'invoice_no':_0x2847ad});})['catch'](_0x4b4665=>{var _0x19f37d=_0x27edef;_0x4fbc98['flash'](_0x19f37d(0x168),_0x19f37d(0x172)),_0x1ee72f['redirect'](_0x19f37d(0x161));});}catch(_0x12d221){console[_0x27edef(0xf3)](_0x12d221);}}),router['post']('/view/add_adjustment',auth,async(_0xb41d1f,_0x5a25e3)=>{var _0x194306=a0_0x3e27fb;try{const {warehouse_name:_0x4b3fee,date:_0x247527,prod_name:_0x2a5e6b,level:_0x1706ed,isle:_0x6fb62f,pallet:_0x906ff2,stock:_0x506a85,types:_0x48d572,adjust_qty:_0x3e2511,new_adjust_qty:_0x2e2307,note:_0x2dec3f,Room_name:_0x5762a1,invoice:_0x1fb8e5,JO_number:_0x4dbf3f,expiry_date:_0x5c8168}=_0xb41d1f[_0x194306(0x14a)];if(typeof _0x2a5e6b==_0x194306(0xf8))var _0x122423=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x18c)]],_0x1f6307=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0xe8)]],_0x1e6871=[_0xb41d1f['body']['stock']],_0x739298=[_0xb41d1f['body'][_0x194306(0x152)]],_0x406ee3=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x103)]],_0x37aa51=[_0xb41d1f['body'][_0x194306(0x11b)]],_0x57e7a9=[_0xb41d1f[_0x194306(0x14a)]['Primary_Units']],_0x1a23dc=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x11f)]],_0x86fd0=[_0xb41d1f[_0x194306(0x14a)]['prod_code']],_0x428e7d=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x124)]],_0xa50fa8=[_0xb41d1f[_0x194306(0x14a)]['expiry_date']],_0x31f343=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x13e)]],_0x2baa01=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x12d)]],_0x47fa12=[_0xb41d1f['body'][_0x194306(0x126)]],_0x5237b7=[_0xb41d1f['body'][_0x194306(0x184)]],_0x1bde14=[_0xb41d1f[_0x194306(0x14a)][_0x194306(0x14e)]];else var _0x122423=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0x18c)]],_0x1f6307=[..._0xb41d1f['body'][_0x194306(0xe8)]],_0x1e6871=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0x178)]],_0x739298=[..._0xb41d1f['body'][_0x194306(0x152)]],_0x406ee3=[..._0xb41d1f[_0x194306(0x14a)]['New_Qty_Converted_adj']],_0x37aa51=[..._0xb41d1f[_0x194306(0x14a)]['New_Qty_Converted']],_0x57e7a9=[..._0xb41d1f['body'][_0x194306(0xd6)]],_0x1a23dc=[..._0xb41d1f[_0x194306(0x14a)]['Secondary_units']],_0x86fd0=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0xf5)]],_0x428e7d=[..._0xb41d1f['body'][_0x194306(0x124)]],_0xa50fa8=[..._0xb41d1f['body'][_0x194306(0x145)]],_0x31f343=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0x13e)]],_0x2baa01=[..._0xb41d1f['body'][_0x194306(0x12d)]],_0x47fa12=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0x126)]],_0x5237b7=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0x184)]],_0x1bde14=[..._0xb41d1f[_0x194306(0x14a)][_0x194306(0x14e)]];const _0x590945=_0x122423[_0x194306(0x148)](_0x2697a1=>{return _0x2697a1={'product_name':_0x2697a1};});_0x1f6307['forEach']((_0x401858,_0x4ae7c0)=>{var _0x4013ec=_0x194306;_0x590945[_0x4ae7c0][_0x4013ec(0x115)]=_0x401858;}),_0x1e6871[_0x194306(0x133)]((_0x2ea695,_0x190a9e)=>{var _0x43cff1=_0x194306;_0x590945[_0x190a9e][_0x43cff1(0x125)]=_0x2ea695;}),_0x739298['forEach']((_0x131e74,_0x10f70)=>{_0x590945[_0x10f70]['types']=_0x131e74;}),_0x406ee3[_0x194306(0x133)]((_0x2677fc,_0x554e5d)=>{var _0x1cf45d=_0x194306;_0x590945[_0x554e5d][_0x1cf45d(0x111)]=_0x2677fc;}),_0x37aa51[_0x194306(0x133)]((_0x3fa057,_0x434c32)=>{_0x590945[_0x434c32]['new_adjust_qty']=_0x3fa057;}),_0x57e7a9[_0x194306(0x133)]((_0x182911,_0x144ef2)=>{_0x590945[_0x144ef2]['unit']=_0x182911;}),_0x1a23dc[_0x194306(0x133)]((_0x5d96a0,_0x5a2a1)=>{var _0x2821f3=_0x194306;_0x590945[_0x5a2a1][_0x2821f3(0x1a0)]=_0x5d96a0;}),_0x86fd0['forEach']((_0x24d8b8,_0x24a2c1)=>{_0x590945[_0x24a2c1]['product_code']=_0x24d8b8;}),_0x428e7d[_0x194306(0x133)]((_0x535d48,_0x1ff907)=>{_0x590945[_0x1ff907]['batch_code']=_0x535d48;}),_0xa50fa8[_0x194306(0x133)]((_0x678ec0,_0x45b4a3)=>{var _0x151ce9=_0x194306;_0x590945[_0x45b4a3][_0x151ce9(0x145)]=_0x678ec0;}),_0x31f343[_0x194306(0x133)]((_0x146ea3,_0x556ae8)=>{_0x590945[_0x556ae8]['production_date']=_0x146ea3;}),_0x2baa01[_0x194306(0x133)]((_0xe25609,_0x585d24)=>{var _0x3b621b=_0x194306;_0x590945[_0x585d24][_0x3b621b(0x12d)]=_0xe25609;}),_0x47fa12[_0x194306(0x133)]((_0x18e06b,_0x454552)=>{_0x590945[_0x454552]['room_names']=_0x18e06b;}),_0x5237b7['forEach']((_0x951965,_0x43352b)=>{var _0x29a044=_0x194306;_0x590945[_0x43352b][_0x29a044(0x184)]=_0x951965;}),_0x1bde14[_0x194306(0x133)]((_0x592222,_0x5ae233)=>{var _0x7ae5c2=_0x194306;_0x590945[_0x5ae233][_0x7ae5c2(0x193)]=_0x592222;});const _0x1217fd=_0x590945[_0x194306(0x13d)](_0x3d6f58=>_0x3d6f58[_0x194306(0x111)]!=='0'&&_0x3d6f58['adjust_qty']!=='');var _0x22a165=0x0;_0x1217fd[_0x194306(0x133)](_0x348ebd=>{var _0x39a08a=_0x194306;console[_0x39a08a(0xf3)]('foreach\x20newproduct',_0x348ebd),parseInt(_0x348ebd[_0x39a08a(0x111)])<=0x0&&_0x22a165++;});if(_0x22a165!=0x0)return _0xb41d1f[_0x194306(0x15a)](_0x194306(0x168),_0x194306(0xe1)),_0x5a25e3[_0x194306(0x10d)]('back');const _0x2295b2=new adjustment_finished({'warehouse_name':_0x4b3fee,'date':_0x247527,'product':_0x1217fd,'note':_0x2dec3f,'room':_0x5762a1,'invoice':_0x1fb8e5,'JO_number':_0x4dbf3f,'expiry_date':_0x5c8168}),_0x2cdee3=await _0x2295b2['save']();_0xb41d1f[_0x194306(0x15a)]('success','adjustment\x20add\x20successfull'),_0x5a25e3[_0x194306(0x10d)](_0x194306(0x119)+_0x2cdee3[_0x194306(0xd5)]);}catch(_0x2e645f){console[_0x194306(0xf3)](_0x2e645f),_0x5a25e3[_0x194306(0x137)](0xc8)[_0x194306(0x17d)]({'message':_0x2e645f[_0x194306(0x19b)]});}}),router[a0_0x3e27fb(0x16f)](a0_0x3e27fb(0x123),auth,async(_0x4f63de,_0x5db5e0)=>{var _0x458b32=a0_0x3e27fb;try{const {username:_0x3f9f70,email:_0x20e508,role:_0x474012}=_0x4f63de[_0x458b32(0xdc)],_0x24ee84=_0x4f63de[_0x458b32(0xdc)],_0x22c6da=await profile['findOne']({'email':_0x24ee84['email']}),_0x59a386=await master_shop[_0x458b32(0x180)](),_0x5e3158=_0x4f63de[_0x458b32(0x12f)]['id'],_0x558225=await adjustment_finished[_0x458b32(0xe5)]({'_id':_0x5e3158}),_0x1c69d7=await purchases['aggregate']([{'$match':{'warehouse_name':_0x558225['warehouse_name']}},{'$unwind':_0x458b32(0x174)},{'$group':{'_id':'$product.product_name'}}]);console[_0x458b32(0xf3)]('purchases_data',_0x1c69d7);const _0x1fe343=await product[_0x458b32(0x180)]({}),_0x114aa2=await warehouse['aggregate']([{'$match':{'name':_0x558225[_0x458b32(0x160)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x458b32(0x17a)},{'$group':{'_id':_0x458b32(0x177),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x458b32(0x113)},'bay':{'$first':_0x458b32(0x10c)},'bin':{'$first':_0x458b32(0xdf)},'type':{'$first':_0x458b32(0x14c)},'floorlevel':{'$first':_0x458b32(0xe7)},'primary_code':{'$first':_0x458b32(0x12c)},'secondary_code':{'$first':_0x458b32(0x196)},'product_code':{'$first':_0x458b32(0x118)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x458b32(0x182)},'expiry_date':{'$first':_0x458b32(0x18d)},'production_date':{'$first':_0x458b32(0x108)},'batch_code':{'$first':_0x458b32(0x19e)},'maxPerUnit':{'$first':_0x458b32(0x19d)},'room':{'$first':_0x458b32(0xef)}}}]);if(_0x59a386[0x0][_0x458b32(0x12a)]==_0x458b32(0x167)){var _0x418df0=users['English'];console[_0x458b32(0xf3)](_0x418df0);}else{if(_0x59a386[0x0][_0x458b32(0x12a)]==_0x458b32(0x17c))var _0x418df0=users[_0x458b32(0x17c)];else{if(_0x59a386[0x0][_0x458b32(0x12a)]==_0x458b32(0x132))var _0x418df0=users[_0x458b32(0x132)];else{if(_0x59a386[0x0][_0x458b32(0x12a)]==_0x458b32(0xed))var _0x418df0=users['Spanish'];else{if(_0x59a386[0x0][_0x458b32(0x12a)]==_0x458b32(0x13c))var _0x418df0=users[_0x458b32(0x13c)];else{if(_0x59a386[0x0][_0x458b32(0x12a)]==_0x458b32(0x136))var _0x418df0=users[_0x458b32(0x197)];else{if(_0x59a386[0x0][_0x458b32(0x12a)]=='Chinese')var _0x418df0=users[_0x458b32(0xeb)];else{if(_0x59a386[0x0]['language']==_0x458b32(0x171))var _0x418df0=users[_0x458b32(0xe6)];}}}}}}}_0x5db5e0['render'](_0x458b32(0xf4),{'success':_0x4f63de[_0x458b32(0x15a)]('success'),'errors':_0x4f63de['flash'](_0x458b32(0x168)),'role':_0x24ee84,'profile':_0x22c6da,'adjustment':_0x558225,'stock':_0x114aa2,'master_shop':_0x59a386,'warehouse_name':_0x1c69d7,'unit':_0x1fe343,'language':_0x418df0});}catch(_0x1c14e0){console[_0x458b32(0xf3)](_0x1c14e0),_0x5db5e0[_0x458b32(0x137)](0xc8)[_0x458b32(0x17d)]({'message':_0x1c14e0['message']});}}),router['post'](a0_0x3e27fb(0x123),auth,async(_0x3c8898,_0x37d007)=>{var _0x1bfa09=a0_0x3e27fb;try{const {invoice:_0x4579ef,warehouse_name:_0x50331b,Room_name:_0x5d73a0}=_0x3c8898[_0x1bfa09(0x14a)],_0x543e01=_0x3c8898['params']['id'],_0x4264d2=await adjustment_finished['findById']({'_id':_0x543e01});var _0x49fbcc;const _0x15b4ed=_0x4264d2['product'][_0x1bfa09(0x148)](async _0x1ef473=>{var _0x1f18dd=_0x1bfa09;if(_0x1ef473['adjust_qty']>0x0){_0x49fbcc=await warehouse[_0x1f18dd(0xf9)]({'name':_0x50331b,'room':_0x1ef473[_0x1f18dd(0xf6)],'warehouse_category':'Finished\x20Goods'});const _0x52b79f=_0x49fbcc[_0x1f18dd(0x12e)][_0x1f18dd(0x148)](_0x901462=>{var _0x35858e=_0x1f18dd;console[_0x35858e(0xf3)](_0x1ef473[_0x35858e(0x152)]);if(_0x1ef473[_0x35858e(0x152)]=='minus')_0x901462[_0x35858e(0x170)]==_0x1ef473[_0x35858e(0x170)]&&_0x901462[_0x35858e(0x115)]==_0x1ef473[_0x35858e(0x115)]&&_0x901462[_0x35858e(0x145)]==_0x1ef473['expiry_date']&&_0x901462['production_date']==_0x1ef473[_0x35858e(0xd8)]&&_0x901462[_0x35858e(0x124)]==_0x1ef473[_0x35858e(0x124)]&&_0x901462[_0x35858e(0x193)]==_0x1ef473[_0x35858e(0x193)]&&(_0x901462[_0x35858e(0x17f)]=_0x901462[_0x35858e(0x17f)]-_0x1ef473[_0x35858e(0x111)]);else _0x1ef473['types']==_0x35858e(0x165)&&(_0x901462[_0x35858e(0x170)]==_0x1ef473[_0x35858e(0x170)]&&_0x901462[_0x35858e(0x115)]==_0x1ef473[_0x35858e(0x115)]&&_0x901462[_0x35858e(0x145)]==_0x1ef473[_0x35858e(0x145)]&&_0x901462['production_date']==_0x1ef473['production_date']&&_0x901462['batch_code']==_0x1ef473[_0x35858e(0x124)]&&_0x901462[_0x35858e(0x193)]==_0x1ef473[_0x35858e(0x193)]&&(_0x901462[_0x35858e(0x17f)]=_0x901462[_0x35858e(0x17f)]+_0x1ef473[_0x35858e(0x111)]));});}return _0x49fbcc;});Promise[_0x1bfa09(0x120)](_0x15b4ed)[_0x1bfa09(0x128)](async _0x11cb8b=>{var _0x319700=_0x1bfa09;try{for(const _0x29ab35 of _0x11cb8b){await _0x29ab35[_0x319700(0x199)]();}_0x4264d2[_0x319700(0xd3)]='True';const _0x37ce03=await _0x4264d2[_0x319700(0x199)](),_0x2ea42b=await master_shop[_0x319700(0x180)](),_0x140892=await email_settings[_0x319700(0xf9)](),_0x49cdd5=await supervisor_settings[_0x319700(0x180)]();var _0x569e3f=_0x4264d2[_0x319700(0x195)],_0x166ff3='',_0x4ec2a0;for(_0x4ec2a0 in _0x569e3f){var _0x353396='FG';_0x4264d2[_0x319700(0x160)]==_0x319700(0x16d)&&(_0x353396='DG'),_0x166ff3+=_0x319700(0x159)+_0x319700(0x11c)+_0x569e3f[_0x4ec2a0][_0x319700(0x170)]+_0x319700(0x183)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x569e3f[_0x4ec2a0][_0x319700(0x13b)]+_0x319700(0x183)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x569e3f[_0x4ec2a0][_0x319700(0x111)]+_0x319700(0x183)+_0x319700(0x11c)+_0x569e3f[_0x4ec2a0][_0x319700(0x187)]+_0x319700(0x183)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x569e3f[_0x4ec2a0][_0x319700(0x1a0)]+_0x319700(0x183)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x4264d2['warehouse_name']+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x569e3f[_0x4ec2a0][_0x319700(0xf6)]+_0x319700(0x183)+_0x319700(0x11c)+_0x353396+_0x569e3f[_0x4ec2a0][_0x319700(0x115)]+_0x319700(0x183)+'</tr>';}let _0x4f28c5=nodemailer[_0x319700(0xfa)]({'host':_0x140892[_0x319700(0x117)],'port':Number(_0x140892['port']),'secure':![],'auth':{'user':_0x140892[_0x319700(0x17b)],'pass':_0x140892['password']}}),_0x3d84b5={'from':_0x140892[_0x319700(0x17b)],'to':_0x49cdd5[0x0][_0x319700(0x102)],'subject':'Adjustment\x20Mail','attachments':[{'filename':_0x319700(0x109),'path':__dirname+_0x319700(0x10f)+_0x319700(0x194)+_0x2ea42b[0x0][_0x319700(0x11e)],'cid':_0x319700(0x150)}],'html':_0x319700(0x1a1)+_0x319700(0x13f)+_0x319700(0x129)+_0x319700(0xec)+_0x319700(0x173)+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x319700(0xec)+'<h2>\x20'+_0x2ea42b[0x0][_0x319700(0x15d)]+_0x319700(0xd7)+_0x319700(0x131)+_0x319700(0x131)+_0x319700(0x10b)+'<div>'+_0x319700(0xd9)+_0x319700(0xd4)+_0x4264d2[_0x319700(0x193)]+'\x20'+_0x319700(0x104)+_0x319700(0x127)+_0x4264d2[_0x319700(0x16b)]+'\x20'+_0x319700(0x157)+_0x319700(0xf7)+_0x319700(0x131)+_0x319700(0x144)+_0x319700(0xf0)+_0x319700(0x159)+_0x319700(0x191)+_0x319700(0x139)+_0x319700(0x14d)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x319700(0x121)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x319700(0xfb)+_0x319700(0x11d)+_0x319700(0x105)+_0x319700(0x16e)+'\x20'+_0x166ff3+'\x20'+_0x319700(0xdd)+'</table>'+_0x319700(0xec)+_0x319700(0x15b)+_0x319700(0x134)+_0x2ea42b[0x0][_0x319700(0x15d)]+_0x319700(0xf7)+'</div>'+_0x319700(0x131)+_0x319700(0x163)};_0x4f28c5[_0x319700(0x12b)](_0x3d84b5,function(_0x49f036,_0x83d1d){var _0x210a50=_0x319700;_0x49f036?(console['log'](_0x49f036),console[_0x210a50(0xf3)](_0x210a50(0x18b))):console[_0x210a50(0xf3)](_0x210a50(0x198));}),_0x3c8898[_0x319700(0x15a)](_0x319700(0x164),_0x319700(0x188)),_0x37d007['redirect'](_0x319700(0x107)+_0x37ce03[_0x319700(0xd5)]);}catch(_0x129e0f){console['error'](_0x129e0f),_0x37d007[_0x319700(0x137)](0x1f4)[_0x319700(0x17d)]({'error':_0x319700(0x135)});}})[_0x1bfa09(0x16c)](_0xce201a=>{var _0x361839=_0x1bfa09;console[_0x361839(0x122)](_0xce201a),_0x37d007[_0x361839(0x137)](0x1f4)[_0x361839(0x17d)]({'error':_0x361839(0x15e)});});}catch(_0x3232a8){_0x37d007[_0x1bfa09(0x17d)]({'message':_0x3232a8[_0x1bfa09(0x19b)]});}}),router[a0_0x3e27fb(0x16f)](a0_0x3e27fb(0x153),auth,async(_0x48b9f0,_0x2f67af)=>{var _0x5a435=a0_0x3e27fb;try{const {username:_0x880ec0,email:_0x426955,role:_0x53c3bd}=_0x48b9f0[_0x5a435(0xdc)],_0x4425bf=_0x48b9f0[_0x5a435(0xdc)],_0x14b1a3=await profile[_0x5a435(0xf9)]({'email':_0x4425bf[_0x5a435(0x17b)]}),_0x2890fc=await master_shop['find']();console['log'](_0x5a435(0xfd),_0x2890fc);const _0x7373b6=_0x48b9f0[_0x5a435(0x12f)]['id'],_0x3eda89=await adjustment_finished[_0x5a435(0xe5)]({'_id':_0x7373b6});let _0x24f3da=new Date(_0x3eda89[_0x5a435(0x145)]),_0x18ba3f=('0'+_0x24f3da[_0x5a435(0x18e)]())['slice'](-0x2),_0x555a20=('0'+(_0x24f3da[_0x5a435(0x100)]()+0x1))[_0x5a435(0x154)](-0x2),_0x4551ce=_0x24f3da['getFullYear'](),_0x4c1289=_0x4551ce+'-'+_0x555a20+'-'+_0x18ba3f;var _0x34b555=[_0x5a435(0x17e),'Enclosed',_0x5a435(0x186)];const _0x3e73da=await purchases[_0x5a435(0x10a)]([{'$match':{'warehouse_name':_0x3eda89['warehouse_name']}},{'$unwind':_0x5a435(0x174)},{'$group':{'_id':_0x5a435(0x19f)}}]);console[_0x5a435(0xf3)]('purchases_data',_0x3e73da);const _0x1c5ebd=await product['find']({}),_0x2b09d6=await warehouse[_0x5a435(0x10a)]([{'$match':{'name':_0x3eda89[_0x5a435(0x160)],'room':_0x3eda89[_0x5a435(0xe2)]}},{'$unwind':_0x5a435(0x17a)},{'$group':{'_id':_0x5a435(0x177),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5a435(0x113)},'bay':{'$first':_0x5a435(0x10c)},'bin':{'$first':_0x5a435(0xdf)},'type':{'$first':_0x5a435(0x14c)},'floorlevel':{'$first':_0x5a435(0xe7)},'primary_code':{'$first':_0x5a435(0x12c)},'secondary_code':{'$first':_0x5a435(0x196)},'product_code':{'$first':_0x5a435(0x118)},'storage':{'$first':_0x5a435(0x101)},'rack':{'$first':_0x5a435(0x182)}}}]);if(_0x2890fc[0x0][_0x5a435(0x12a)]==_0x5a435(0x167)){var _0x26ca0d=users[_0x5a435(0x140)];console['log'](_0x26ca0d);}else{if(_0x2890fc[0x0][_0x5a435(0x12a)]==_0x5a435(0x17c))var _0x26ca0d=users['Hindi'];else{if(_0x2890fc[0x0][_0x5a435(0x12a)]==_0x5a435(0x132))var _0x26ca0d=users[_0x5a435(0x132)];else{if(_0x2890fc[0x0]['language']==_0x5a435(0xed))var _0x26ca0d=users[_0x5a435(0xed)];else{if(_0x2890fc[0x0]['language']==_0x5a435(0x13c))var _0x26ca0d=users['French'];else{if(_0x2890fc[0x0][_0x5a435(0x12a)]==_0x5a435(0x136))var _0x26ca0d=users['Portuguese'];else{if(_0x2890fc[0x0]['language']=='Chinese')var _0x26ca0d=users[_0x5a435(0xeb)];else{if(_0x2890fc[0x0][_0x5a435(0x12a)]==_0x5a435(0x171))var _0x26ca0d=users[_0x5a435(0xe6)];}}}}}}}_0x2f67af[_0x5a435(0x11a)]('edit_adjustment_finished',{'success':_0x48b9f0[_0x5a435(0x15a)](_0x5a435(0x164)),'errors':_0x48b9f0[_0x5a435(0x15a)]('errors'),'role':_0x4425bf,'profile':_0x14b1a3,'adjustment':_0x3eda89,'stock':_0x2b09d6,'master_shop':_0x2890fc,'warehouse_name':_0x3e73da,'unit':_0x1c5ebd,'language':_0x26ca0d,'rooms_data':_0x34b555,'ed_fullDate':_0x4c1289});}catch(_0x2779d2){console[_0x5a435(0xf3)](_0x2779d2),_0x2f67af['status'](0xc8)['json']({'message':_0x2779d2[_0x5a435(0x19b)]});}}),router[a0_0x3e27fb(0x169)](a0_0x3e27fb(0x153),auth,async(_0x1ac72f,_0xfe1d3b)=>{var _0x444f79=a0_0x3e27fb;try{const _0x4acf80=_0x1ac72f[_0x444f79(0x12f)]['id'],_0x37982b=await adjustment_finished[_0x444f79(0xe5)]({'_id':_0x4acf80}),_0x1ba932=await warehouse[_0x444f79(0xf9)]({'name':_0x37982b['warehouse_name'],'room':_0x37982b[_0x444f79(0xe2)]}),{warehouse_name:_0x340a72,date:_0x3cac8d,prod_name:_0x29d10d,level:_0x1dd15c,isle:_0x1d6669,pallet:_0x91e289,stock:_0x576f16,types:_0x363f4e,adjust_qty:_0x394ede,new_adjust_qty:_0x43188b,note:_0x2deb83,Room_name:_0x43eab6,invoice:_0xaa9e21,JO_number:_0x3c8c15}=_0x1ac72f[_0x444f79(0x14a)];if(typeof _0x29d10d==_0x444f79(0xf8))var _0x6f26db=[_0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x18c)]],_0x1ecb25=[_0x1ac72f[_0x444f79(0x14a)][_0x444f79(0xe8)]],_0x794443=[_0x1ac72f['body'][_0x444f79(0x178)]],_0xc72d3f=[_0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x152)]],_0x528462=[_0x1ac72f['body'][_0x444f79(0x111)]],_0xc05f8a=[_0x1ac72f['body'][_0x444f79(0x181)]],_0x4934de=[_0x1ac72f['body'][_0x444f79(0xf5)]],_0x42223b=[_0x1ac72f[_0x444f79(0x14a)]['unit']],_0x3f5ccf=[_0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x11f)]],_0x5728f4=[_0x1ac72f[_0x444f79(0x14a)]['batch_code']],_0x11d49b=[_0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x145)]];else var _0x6f26db=[..._0x1ac72f[_0x444f79(0x14a)]['prod_name']],_0x1ecb25=[..._0x1ac72f[_0x444f79(0x14a)]['level']],_0x794443=[..._0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x178)]],_0xc72d3f=[..._0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x152)]],_0x528462=[..._0x1ac72f[_0x444f79(0x14a)]['adjust_qty']],_0xc05f8a=[..._0x1ac72f[_0x444f79(0x14a)]['new_adjust_qty']],_0x4934de=[..._0x1ac72f[_0x444f79(0x14a)]['prod_code']],_0x42223b=[..._0x1ac72f[_0x444f79(0x14a)]['unit']],_0x3f5ccf=[..._0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x11f)]],_0x5728f4=[..._0x1ac72f['body'][_0x444f79(0x124)]],_0x11d49b=[..._0x1ac72f[_0x444f79(0x14a)][_0x444f79(0x145)]];const _0x3f79fc=_0x6f26db[_0x444f79(0x148)](_0x958bb5=>{return _0x958bb5={'product_name':_0x958bb5};});_0x1ecb25[_0x444f79(0x133)]((_0x41a196,_0x538506)=>{var _0x493e6e=_0x444f79;_0x3f79fc[_0x538506][_0x493e6e(0x115)]=_0x41a196;}),_0x794443[_0x444f79(0x133)]((_0x1a933a,_0x2f240a)=>{var _0x30dc84=_0x444f79;_0x3f79fc[_0x2f240a][_0x30dc84(0x125)]=_0x1a933a;}),_0xc72d3f[_0x444f79(0x133)]((_0x1c1a9c,_0x5dc2be)=>{var _0x3d062e=_0x444f79;_0x3f79fc[_0x5dc2be][_0x3d062e(0x152)]=_0x1c1a9c;}),_0x528462['forEach']((_0x1045cd,_0x525189)=>{_0x3f79fc[_0x525189]['adjust_qty']=_0x1045cd;}),_0xc05f8a[_0x444f79(0x133)]((_0x11d203,_0x39606c)=>{var _0xf96e5e=_0x444f79;_0x3f79fc[_0x39606c][_0xf96e5e(0x181)]=_0x11d203;}),_0x42223b[_0x444f79(0x133)]((_0xf310d7,_0x428e31)=>{var _0x3318eb=_0x444f79;_0x3f79fc[_0x428e31][_0x3318eb(0x187)]=_0xf310d7;}),_0x3f5ccf[_0x444f79(0x133)]((_0x420565,_0x664d6e)=>{_0x3f79fc[_0x664d6e]['secondary_unit']=_0x420565;}),_0x4934de['forEach']((_0x11dd0e,_0x2ef4d2)=>{var _0x11c1e7=_0x444f79;_0x3f79fc[_0x2ef4d2][_0x11c1e7(0x13b)]=_0x11dd0e;}),_0x5728f4[_0x444f79(0x133)]((_0x4fbdb,_0x5b4d86)=>{var _0x180c63=_0x444f79;_0x3f79fc[_0x5b4d86][_0x180c63(0x124)]=_0x4fbdb;}),_0x11d49b['forEach']((_0x68cace,_0x31db42)=>{_0x3f79fc[_0x31db42]['expiry_date']=_0x68cace;});const _0x58ce5e=_0x3f79fc[_0x444f79(0x13d)](_0x3d5ca8=>_0x3d5ca8['adjust_qty']!=='0'&&_0x3d5ca8['adjust_qty']!=='');var _0x3817a6=0x0;_0x58ce5e[_0x444f79(0x133)](_0x4abbff=>{var _0x5cf1c5=_0x444f79;console[_0x5cf1c5(0xf3)](_0x5cf1c5(0x112),_0x4abbff),parseInt(_0x4abbff['adjust_qty'])<=0x0&&_0x3817a6++;});if(_0x3817a6!=0x0)return _0x1ac72f['flash'](_0x444f79(0x168),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0xfe1d3b['redirect'](_0x444f79(0x19c));_0x37982b[_0x444f79(0x160)]=_0x340a72,_0x37982b[_0x444f79(0x16b)]=_0x3cac8d,_0x37982b[_0x444f79(0x195)]=_0x58ce5e,_0x37982b[_0x444f79(0x18a)]=_0x2deb83,_0x37982b[_0x444f79(0xe2)]=_0x43eab6,_0x37982b[_0x444f79(0x193)]=_0xaa9e21,_0x37982b[_0x444f79(0xdb)]=_0x3c8c15;const _0xa05b5b=await _0x37982b[_0x444f79(0x199)](),_0x4f7c59=await warehouse['findOne']({'name':_0x340a72,'room':_0x43eab6});_0xa05b5b[_0x444f79(0x195)]['forEach'](_0x869cac=>{var _0xa03217=_0x444f79;const _0x5552a6=_0x4f7c59['product_details'][_0xa03217(0x148)](_0x1d2a26=>{var _0x23f447=_0xa03217;_0x869cac[_0x23f447(0x152)]==_0x23f447(0xff)?_0x1d2a26['product_name']==_0x869cac[_0x23f447(0x170)]&&_0x1d2a26[_0x23f447(0x115)]==_0x869cac['bay']&&(_0x1d2a26[_0x23f447(0x17f)]=parseInt(_0x1d2a26[_0x23f447(0x17f)])-parseInt(_0x869cac[_0x23f447(0x111)])):_0x1d2a26['product_name']==_0x869cac[_0x23f447(0x170)]&&_0x1d2a26['bay']==_0x869cac[_0x23f447(0x115)]&&(_0x1d2a26[_0x23f447(0x17f)]=parseInt(_0x1d2a26[_0x23f447(0x17f)])+parseInt(_0x869cac[_0x23f447(0x111)]));});}),await _0x4f7c59[_0x444f79(0x199)](),_0x1ac72f['flash'](_0x444f79(0x164),_0x444f79(0x151)),_0xfe1d3b[_0x444f79(0x10d)](_0x444f79(0x14b));}catch(_0x4acc0b){console[_0x444f79(0xf3)](_0x4acc0b);}}),router[a0_0x3e27fb(0x169)](a0_0x3e27fb(0x155),async(_0x398a3c,_0x23990b)=>{var _0x27d629=a0_0x3e27fb;const {primary_code:_0x3ee768,warehouse_data:_0x4cb686,rooms_data:_0x380c7e,Roomslist:_0x5c687d}=_0x398a3c[_0x27d629(0x14a)],_0xface1b=_0x5c687d[_0x27d629(0x16a)](','),_0x281241=[];async function _0x30bc02(_0x311f1f){var _0x468f38=_0x27d629;const _0x39faff=await warehouse['aggregate']([{'$match':{'name':_0x4cb686,'room':_0x311f1f}},{'$unwind':_0x468f38(0x17a)},{'$match':{'product_details.primary_code':_0x3ee768}},{'$group':{'_id':_0x468f38(0x177),'name':{'$first':_0x468f38(0x138)},'product_stock':{'$first':_0x468f38(0x113)},'primary_code':{'$first':_0x468f38(0x12c)},'secondary_code':{'$first':_0x468f38(0x196)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x468f38(0x10c)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x468f38(0x14c)},'pallet':{'$first':_0x468f38(0xe7)},'unit':{'$first':_0x468f38(0xe4)},'secondary_unit':{'$first':_0x468f38(0x176)},'storage':{'$first':_0x468f38(0x101)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x468f38(0x108)},'batch_code':{'$first':_0x468f38(0x19e)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x468f38(0x19d)},'roomNamed':{'$first':_0x468f38(0xef)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x4670a5=await warehouse[_0x468f38(0x10a)]([{'$match':{'name':_0x4cb686,'room':_0x311f1f}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x3ee768}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x468f38(0x138)},'product_stock':{'$first':_0x468f38(0x113)},'primary_code':{'$first':_0x468f38(0x12c)},'secondary_code':{'$first':_0x468f38(0x196)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x468f38(0x10c)},'isle':{'$first':_0x468f38(0xdf)},'type':{'$first':_0x468f38(0x14c)},'pallet':{'$first':_0x468f38(0xe7)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x468f38(0x101)},'rack':{'$first':_0x468f38(0x182)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x468f38(0x19e)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x468f38(0x19d)},'roomNamed':{'$first':_0x468f38(0xef)},'invoice':{'$first':_0x468f38(0x147)}}}]);if(_0x39faff[_0x468f38(0x15f)]>0x0)_0x281241[_0x468f38(0x15c)](_0x39faff);else _0x4670a5[_0x468f38(0x15f)]>0x0&&_0x281241[_0x468f38(0x15c)](_0x4670a5);}const _0x475dd9=_0xface1b[_0x27d629(0x148)](_0x3a4ad5=>_0x30bc02(_0x3a4ad5));await Promise[_0x27d629(0x120)](_0x475dd9),_0x23990b[_0x27d629(0x17d)](_0x281241);}),router[a0_0x3e27fb(0x169)](a0_0x3e27fb(0xee),async(_0x3b760a,_0x54c43b)=>{var _0x2a8b04=a0_0x3e27fb;const {productCode:_0x327467,bay:_0x1acba6,warehouses:_0x3703fe,room:_0x41b4ee}=_0x3b760a[_0x2a8b04(0x14a)];console[_0x2a8b04(0xf3)](_0x3b760a['body']);try{const _0x2ebcf3=await warehouse[_0x2a8b04(0x10a)]([{'$match':{'name':_0x3703fe,'room':_0x41b4ee}},{'$unwind':_0x2a8b04(0x17a)},{'$match':{'product_details.bay':parseInt(_0x1acba6)}},{'$group':{'_id':_0x2a8b04(0x177),'name':{'$first':_0x2a8b04(0x138)},'product_stock':{'$first':_0x2a8b04(0x113)},'bay':{'$first':_0x2a8b04(0x10c)},'maxProducts':{'$first':_0x2a8b04(0x175)}}}]);_0x54c43b[_0x2a8b04(0x137)](0xc8)[_0x2a8b04(0x17d)](_0x2ebcf3);}catch(_0x28dbb4){_0x54c43b['status'](0x194)[_0x2a8b04(0x17d)]({'message':_0x28dbb4[_0x2a8b04(0x19b)]});}}),module['exports']=router;