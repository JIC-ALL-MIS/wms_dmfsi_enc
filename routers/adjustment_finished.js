function a0_0x3b83(_0xc35040,_0x77801){var _0x104545=a0_0x1045();return a0_0x3b83=function(_0x3b8375,_0xbd085){_0x3b8375=_0x3b8375-0x132;var _0x2bcb18=_0x104545[_0x3b8375];return _0x2bcb18;},a0_0x3b83(_0xc35040,_0x77801);}function a0_0x1045(){var _0x349b11=['unit','/view/:id','Enabled','</td>','$product_details.type','$product_details._id','site_title','Spanish','JO_number','room_names','327006UJwIHV','warehouse_name','message','finalize','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','product_name','log','$product_details.expiry_date','$product','json','Arabic\x20(ae)','/adjustment_finished/preview/','prod_name','<tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','\x20Order\x20Number\x20:\x20','Adjustment\x20Mail','back','language','purchases_data','types','edit_adjustment_finished','filter','</tbody>','prod_code','<h5\x20style=\x22text-align:\x20left;\x22>','product_stock','Email\x20sent\x20successfully','Rooms','minus','</table>','aggregate','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','save','logo','FGSEmail','note','flash','Arabic','/CheckingWarehouse','date','sendMail','Return\x20Rooms','<!DOCTYPE\x20html>','warehouse','invoice','$product_details','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</tr>','get','adjust_qty','<strong>\x20Regards\x20</strong>','role','664KMRfmO','$product_details.invoice','production_date','<div>','There\x27s\x20a\x20error\x20in\x20this\x20transaction','$product_details.maxProducts','$product_details.batch_code','/adjustment/view','level','adjustment\x20data\x20update\x20successfully','Enclosed','random','$product_details.secondary_unit','288374ieIaBT','Router','$product_details.product_code','secondary_unit','edit_adjustment_finished_view','$product_details.storage','English\x20(US)','Logo.png','post','$date','English','$product.room_names','errors','$product_details.primary_code','body','1912512swUuwr','find','Adjustment\x20Finalize\x20Successfully','floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','email','$product_details.product_name','<html><head><title></title>','batch_code','$product_details.bay','error','slice','Hindi','catch','/../public','params','findOne','German','adjustment_finished','nodemailer','$product_details.secondary_code','port','product_code','redirect','string','Portuguese\x20(BR)','<hr\x20class=\x22my-3\x22>','/adjustment_finished/view','Primary_Units','\x20</h2>','_id','Finished\x20Goods','$warehouse_name','/view/add_adjustment','<tbody\x20style=\x22text-align:\x20center;\x22>','/picking_list/PDF_adjustment/','maxPerUnit','foreach\x20newproduct','Ambient','$product_details.unit','prod_cat','An\x20error\x20occurred.','prod_invoice','all','$product_details.production_date','25008JsMGje','createTransport','room','push','findById','Portuguese','$product.product_name','$room','new_adjust_qty','success','then','2197593ohZOpX','110YfodRa','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details.bin','ADJF-','5775000OyDbPj','status','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','staff','bay','$name','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','render','$product_details.floorlevel','adjustment\x20add\x20successfull','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','expiry_date','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','New_Qty_Converted_adj','$finalize','stockBefore','getDate','$product_details.maxPerUnit','$product_details.product_stock','padStart','Chinese','stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','QA\x20Warehouse','True','</div>','French','toString','<h2>\x20','add','$invoice','forEach','$_id','product_date','map','1684878bLstXL','user','</body></html>','product','product_details','$product_details.rack','length','Secondary_units','\x20Order\x20Date\x20:\x20','getFullYear'];a0_0x1045=function(){return _0x349b11;};return a0_0x1045();}var a0_0x3eba7b=a0_0x3b83;(function(_0x45b76c,_0x548a51){var _0xd7a274=a0_0x3b83,_0x5583bb=_0x45b76c();while(!![]){try{var _0x3ff4b4=parseInt(_0xd7a274(0x195))/0x1+-parseInt(_0xd7a274(0x13d))/0x2+-parseInt(_0xd7a274(0x1dc))/0x3+-parseInt(_0xd7a274(0x1a4))/0x4+-parseInt(_0xd7a274(0x1dd))/0x5*(-parseInt(_0xd7a274(0x1d1))/0x6)+-parseInt(_0xd7a274(0x1e1))/0x7+parseInt(_0xd7a274(0x188))/0x8*(parseInt(_0xd7a274(0x151))/0x9);if(_0x3ff4b4===_0x548a51)break;else _0x5583bb['push'](_0x5583bb['shift']());}catch(_0x43cd17){_0x5583bb['push'](_0x5583bb['shift']());}}}(a0_0x1045,0x7e63e));const express=require('express'),app=express(),router=express[a0_0x3eba7b(0x196)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require('../models/all_models'),users=require(a0_0x3eba7b(0x1e3)),nodemailer=require(a0_0x3eba7b(0x1b7));router[a0_0x3eba7b(0x184)]('/view',auth,async(_0x90d63,_0x282be7)=>{var _0x350fb9=a0_0x3eba7b;try{const {username:_0x2838b9,email:_0xe4ea41,role:_0x490b7a}=_0x90d63[_0x350fb9(0x13e)],_0x2731e2=_0x90d63['user'],_0x5ad220=await profile[_0x350fb9(0x1b4)]({'email':_0x2731e2[_0x350fb9(0x1a9)]}),_0x414bb8=await master_shop[_0x350fb9(0x1a5)]();let _0x69c71e;if(_0x2731e2['role']==_0x350fb9(0x1e5)){const _0x52ff19=await staff[_0x350fb9(0x1b4)]({'email':_0x2731e2['email']});_0x69c71e=await warehouse[_0x350fb9(0x1a5)]({'status':_0x350fb9(0x149),'name':_0x52ff19[_0x350fb9(0x17f)]});}else _0x69c71e=await warehouse[_0x350fb9(0x1a5)]({'status':_0x350fb9(0x149)});const _0x8c5e85=await product[_0x350fb9(0x1a5)]();let _0x5b141d;if(_0x2731e2[_0x350fb9(0x187)]==_0x350fb9(0x1e5)){const _0x1d649e=await staff[_0x350fb9(0x1b4)]({'email':_0x2731e2[_0x350fb9(0x1a9)]});_0x5b141d=await adjustment_finished[_0x350fb9(0x1a5)]({'warehouse_name':_0x1d649e[_0x350fb9(0x17f)]});}else _0x5b141d=await adjustment_finished[_0x350fb9(0x171)]([{'$unwind':_0x350fb9(0x15a)},{'$group':{'_id':_0x350fb9(0x13a),'invoice':{'$first':_0x350fb9(0x138)},'date':{'$first':_0x350fb9(0x19e)},'warehouse_name':{'$first':_0x350fb9(0x1c4)},'room':{'$addToSet':_0x350fb9(0x1a0)},'finalize':{'$first':_0x350fb9(0x1f0)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x414bb8[0x0][_0x350fb9(0x164)]==_0x350fb9(0x19b)){var _0x297afc=users['English'];console['log'](_0x297afc);}else{if(_0x414bb8[0x0][_0x350fb9(0x164)]==_0x350fb9(0x1b0))var _0x297afc=users[_0x350fb9(0x1b0)];else{if(_0x414bb8[0x0][_0x350fb9(0x164)]=='German')var _0x297afc=users[_0x350fb9(0x1b5)];else{if(_0x414bb8[0x0][_0x350fb9(0x164)]==_0x350fb9(0x14e))var _0x297afc=users[_0x350fb9(0x14e)];else{if(_0x414bb8[0x0][_0x350fb9(0x164)]==_0x350fb9(0x134))var _0x297afc=users['French'];else{if(_0x414bb8[0x0]['language']==_0x350fb9(0x1bd))var _0x297afc=users[_0x350fb9(0x1d6)];else{if(_0x414bb8[0x0][_0x350fb9(0x164)]==_0x350fb9(0x1f6))var _0x297afc=users[_0x350fb9(0x1f6)];else{if(_0x414bb8[0x0]['language']==_0x350fb9(0x15c))var _0x297afc=users[_0x350fb9(0x179)];}}}}}}}_0x282be7[_0x350fb9(0x1e9)](_0x350fb9(0x1b6),{'success':_0x90d63[_0x350fb9(0x178)]('success'),'errors':_0x90d63['flash'](_0x350fb9(0x1a1)),'role':_0x2731e2,'profile':_0x5ad220,'warehouse':_0x69c71e,'product':_0x8c5e85,'adjustment':_0x5b141d,'master_shop':_0x414bb8,'language':_0x297afc});}catch(_0x23fd2d){console['log'](_0x23fd2d);}});async function getRandom8DigitNumber(){var _0x276673=a0_0x3eba7b;const _0x32d3c4=0x989680,_0x34b61e=0x5f5e0ff,_0x1ce7b9=Math[_0x276673(0x1a7)](Math[_0x276673(0x193)]()*(_0x34b61e-_0x32d3c4+0x1))+_0x32d3c4;var _0x530c1d;const _0x34f071=await adjustment_finished['findOne']({'invoice':_0x276673(0x1e0)+_0x1ce7b9});return _0x34f071&&_0x34f071[_0x276673(0x143)]>0x0?_0x530c1d=_0x276673(0x1e0)+_0x1ce7b9:_0x530c1d=_0x276673(0x1e0)+_0x1ce7b9,_0x530c1d;}router[a0_0x3eba7b(0x184)](a0_0x3eba7b(0x1c5),auth,async(_0x5014ee,_0x4566fc)=>{var _0xfb8c7f=a0_0x3eba7b;try{const {username:_0x1bf7d3,email:_0x15ec53,role:_0x1704d1}=_0x5014ee[_0xfb8c7f(0x13e)],_0x1f313f=_0x5014ee[_0xfb8c7f(0x13e)],_0x27e74a=await profile[_0xfb8c7f(0x1b4)]({'email':_0x1f313f[_0xfb8c7f(0x1a9)]}),_0x2ca1b6=await master_shop[_0xfb8c7f(0x1a5)]();let _0x4f28dc;if(_0x1f313f[_0xfb8c7f(0x187)]==_0xfb8c7f(0x1e5)){const _0x55f116=await staff[_0xfb8c7f(0x1b4)]({'email':_0x1f313f['email']});_0x4f28dc=await warehouse['aggregate']([{'$match':{'status':_0xfb8c7f(0x149),'name':_0x55f116[_0xfb8c7f(0x17f)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0xfb8c7f(0x1f9)}}},{'$group':{'_id':'$name','name':{'$first':_0xfb8c7f(0x1e7)}}}]);}else _0x4f28dc=await warehouse['aggregate']([{'$match':{'status':_0xfb8c7f(0x149),'warehouse_category':_0xfb8c7f(0x1c3),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0xfb8c7f(0x1e7),'name':{'$first':'$name'}}}]);const _0x2e97af=await product[_0xfb8c7f(0x1a5)]({}),_0x14b844=await adjustment_finished[_0xfb8c7f(0x1a5)]({}),_0x18995b=_0x14b844[_0xfb8c7f(0x143)]+0x1,_0x3a5967=_0xfb8c7f(0x1e0)+_0x18995b[_0xfb8c7f(0x135)]()[_0xfb8c7f(0x1f5)](0x5,'0');var _0x5370b2=[_0xfb8c7f(0x1ca),_0xfb8c7f(0x192),'Return\x20Rooms'];if(_0x2ca1b6[0x0][_0xfb8c7f(0x164)]==_0xfb8c7f(0x19b))var _0x12b691=users[_0xfb8c7f(0x19f)];else{if(_0x2ca1b6[0x0][_0xfb8c7f(0x164)]==_0xfb8c7f(0x1b0))var _0x12b691=users['Hindi'];else{if(_0x2ca1b6[0x0][_0xfb8c7f(0x164)]==_0xfb8c7f(0x1b5))var _0x12b691=users[_0xfb8c7f(0x1b5)];else{if(_0x2ca1b6[0x0]['language']=='Spanish')var _0x12b691=users[_0xfb8c7f(0x14e)];else{if(_0x2ca1b6[0x0][_0xfb8c7f(0x164)]==_0xfb8c7f(0x134))var _0x12b691=users[_0xfb8c7f(0x134)];else{if(_0x2ca1b6[0x0][_0xfb8c7f(0x164)]==_0xfb8c7f(0x1bd))var _0x12b691=users['Portuguese'];else{if(_0x2ca1b6[0x0]['language']==_0xfb8c7f(0x1f6))var _0x12b691=users[_0xfb8c7f(0x1f6)];else{if(_0x2ca1b6[0x0][_0xfb8c7f(0x164)]==_0xfb8c7f(0x15c))var _0x12b691=users[_0xfb8c7f(0x179)];}}}}}}}const _0xe03b37=getRandom8DigitNumber();_0xe03b37['then'](_0x3f4682=>{var _0x40e2a8=_0xfb8c7f;_0x4566fc['render']('add_adjustment_finished',{'success':_0x5014ee['flash'](_0x40e2a8(0x1da)),'errors':_0x5014ee['flash'](_0x40e2a8(0x1a1)),'role':_0x1f313f,'profile':_0x27e74a,'warehouse':_0x4f28dc,'product':_0x2e97af,'master_shop':_0x2ca1b6,'language':_0x12b691,'rooms_data':_0x5370b2,'invoice_no':_0x3f4682});})[_0xfb8c7f(0x1b1)](_0x3fd805=>{var _0x49191d=_0xfb8c7f;_0x5014ee['flash'](_0x49191d(0x1a1),_0x49191d(0x18c)),_0x4566fc['redirect'](_0x49191d(0x18f));});}catch(_0x173678){console['log'](_0x173678);}}),router[a0_0x3eba7b(0x19d)]('/view/add_adjustment',auth,async(_0x2770eb,_0x315006)=>{var _0x2308d1=a0_0x3eba7b;try{const {warehouse_name:_0x3766dd,date:_0x3a17e2,prod_name:_0x3b03eb,level:_0x1a598a,isle:_0x1b0fb8,pallet:_0x34a9ef,stock:_0x1893af,types:_0x4c2f9a,adjust_qty:_0x3317c3,new_adjust_qty:_0x4025e7,note:_0x254c4f,Room_name:_0x4f38f7,invoice:_0x3d70cb,JO_number:_0xf612b6,expiry_date:_0x1a765b}=_0x2770eb['body'];if(typeof _0x3b03eb=='string')var _0x53ee79=[_0x2770eb['body'][_0x2308d1(0x15e)]],_0x267d51=[_0x2770eb['body'][_0x2308d1(0x190)]],_0xdcee86=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1f7)]],_0x100250=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x166)]],_0x3b343c=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1ef)]],_0x14a843=[_0x2770eb['body']['New_Qty_Converted']],_0x53043f=[_0x2770eb['body'][_0x2308d1(0x1c0)]],_0x35c0c7=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x144)]],_0x554f4d=[_0x2770eb['body']['prod_code']],_0xdc8269=[_0x2770eb['body'][_0x2308d1(0x1ac)]],_0x339e52=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1ed)]],_0x4a3ea3=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x13b)]],_0x2ae227=[_0x2770eb[_0x2308d1(0x1a3)]['prod_cat']],_0x674f88=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x16e)]],_0x403459=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1c8)]],_0x2aab4c=[_0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1ce)]];else var _0x53ee79=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x15e)]],_0x267d51=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x190)]],_0xdcee86=[..._0x2770eb[_0x2308d1(0x1a3)]['stock']],_0x100250=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x166)]],_0x3b343c=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1ef)]],_0x14a843=[..._0x2770eb[_0x2308d1(0x1a3)]['New_Qty_Converted']],_0x53043f=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1c0)]],_0x35c0c7=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x144)]],_0x554f4d=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x16a)]],_0xdc8269=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1ac)]],_0x339e52=[..._0x2770eb[_0x2308d1(0x1a3)]['expiry_date']],_0x4a3ea3=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x13b)]],_0x2ae227=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1cc)]],_0x674f88=[..._0x2770eb['body'][_0x2308d1(0x16e)]],_0x403459=[..._0x2770eb[_0x2308d1(0x1a3)][_0x2308d1(0x1c8)]],_0x2aab4c=[..._0x2770eb[_0x2308d1(0x1a3)]['prod_invoice']];const _0x59471f=_0x53ee79[_0x2308d1(0x13c)](_0x14a8e2=>{return _0x14a8e2={'product_name':_0x14a8e2};});_0x267d51['forEach']((_0x1fb322,_0x4bcb85)=>{var _0x238690=_0x2308d1;_0x59471f[_0x4bcb85][_0x238690(0x1e6)]=_0x1fb322;}),_0xdcee86['forEach']((_0x2addf8,_0x41b0de)=>{_0x59471f[_0x41b0de]['stockBefore']=_0x2addf8;}),_0x100250[_0x2308d1(0x139)]((_0x50cf8e,_0x642af1)=>{var _0x1b41fc=_0x2308d1;_0x59471f[_0x642af1][_0x1b41fc(0x166)]=_0x50cf8e;}),_0x3b343c[_0x2308d1(0x139)]((_0x2dfda5,_0x3dd2b0)=>{_0x59471f[_0x3dd2b0]['adjust_qty']=_0x2dfda5;}),_0x14a843[_0x2308d1(0x139)]((_0x5d535e,_0x29edde)=>{var _0x5aac28=_0x2308d1;_0x59471f[_0x29edde][_0x5aac28(0x1d9)]=_0x5d535e;}),_0x53043f[_0x2308d1(0x139)]((_0x399124,_0x61af24)=>{var _0x15b46e=_0x2308d1;_0x59471f[_0x61af24][_0x15b46e(0x147)]=_0x399124;}),_0x35c0c7[_0x2308d1(0x139)]((_0x65494b,_0xf87712)=>{var _0x1d4ea9=_0x2308d1;_0x59471f[_0xf87712][_0x1d4ea9(0x198)]=_0x65494b;}),_0x554f4d[_0x2308d1(0x139)]((_0x5d09df,_0x4cdd6e)=>{_0x59471f[_0x4cdd6e]['product_code']=_0x5d09df;}),_0xdc8269['forEach']((_0x12659a,_0xcd24bb)=>{var _0x413eaa=_0x2308d1;_0x59471f[_0xcd24bb][_0x413eaa(0x1ac)]=_0x12659a;}),_0x339e52[_0x2308d1(0x139)]((_0x50eafb,_0x69eaa0)=>{var _0x54e046=_0x2308d1;_0x59471f[_0x69eaa0][_0x54e046(0x1ed)]=_0x50eafb;}),_0x4a3ea3[_0x2308d1(0x139)]((_0xcd2a90,_0x3e31cf)=>{var _0x1cc82c=_0x2308d1;_0x59471f[_0x3e31cf][_0x1cc82c(0x18a)]=_0xcd2a90;}),_0x2ae227[_0x2308d1(0x139)]((_0x2fb4ec,_0x2fb25d)=>{var _0x545ccc=_0x2308d1;_0x59471f[_0x2fb25d][_0x545ccc(0x1cc)]=_0x2fb4ec;}),_0x674f88[_0x2308d1(0x139)]((_0x4f588f,_0x4c978b)=>{_0x59471f[_0x4c978b]['room_names']=_0x4f588f;}),_0x403459[_0x2308d1(0x139)]((_0x2c84d1,_0x2b1b66)=>{var _0x43ee7f=_0x2308d1;_0x59471f[_0x2b1b66][_0x43ee7f(0x1c8)]=_0x2c84d1;}),_0x2aab4c[_0x2308d1(0x139)]((_0x2c0cdd,_0x2ad978)=>{_0x59471f[_0x2ad978]['invoice']=_0x2c0cdd;});const _0xaf238c=_0x59471f[_0x2308d1(0x168)](_0x403aa9=>_0x403aa9[_0x2308d1(0x185)]!=='0'&&_0x403aa9['adjust_qty']!=='');var _0x1923f4=0x0;_0xaf238c[_0x2308d1(0x139)](_0x1a9186=>{var _0x1b818f=_0x2308d1;console[_0x1b818f(0x158)](_0x1b818f(0x1c9),_0x1a9186),parseInt(_0x1a9186[_0x1b818f(0x185)])<=0x0&&_0x1923f4++;});if(_0x1923f4!=0x0)return _0x2770eb[_0x2308d1(0x178)](_0x2308d1(0x1a1),_0x2308d1(0x172)),_0x315006[_0x2308d1(0x1bb)](_0x2308d1(0x163));const _0x28fedb=new adjustment_finished({'warehouse_name':_0x3766dd,'date':_0x3a17e2,'product':_0xaf238c,'note':_0x254c4f,'room':_0x4f38f7,'invoice':_0x3d70cb,'JO_number':_0xf612b6,'expiry_date':_0x1a765b}),_0x4bd475=await _0x28fedb[_0x2308d1(0x174)]();_0x2770eb[_0x2308d1(0x178)](_0x2308d1(0x1da),_0x2308d1(0x1eb)),_0x315006['redirect'](_0x2308d1(0x15d)+_0x4bd475['_id']);}catch(_0x546e05){console[_0x2308d1(0x158)](_0x546e05),_0x315006['status'](0xc8)[_0x2308d1(0x15b)]({'message':_0x546e05[_0x2308d1(0x153)]});}}),router['get']('/preview/:id',auth,async(_0x2d10bd,_0x5ae1ff)=>{var _0x1da159=a0_0x3eba7b;try{const {username:_0x5bd121,email:_0x360f30,role:_0x466071}=_0x2d10bd[_0x1da159(0x13e)],_0x204e9e=_0x2d10bd[_0x1da159(0x13e)],_0x32def0=await profile['findOne']({'email':_0x204e9e[_0x1da159(0x1a9)]}),_0x58e2cc=await master_shop['find'](),_0x1d68f5=_0x2d10bd[_0x1da159(0x1b3)]['id'],_0x432803=await adjustment_finished[_0x1da159(0x1d5)]({'_id':_0x1d68f5}),_0x4c4bcc=await purchases[_0x1da159(0x171)]([{'$match':{'warehouse_name':_0x432803[_0x1da159(0x152)]}},{'$unwind':'$product'},{'$group':{'_id':_0x1da159(0x1d7)}}]);console[_0x1da159(0x158)](_0x1da159(0x165),_0x4c4bcc);const _0x4e5328=await product[_0x1da159(0x1a5)]({}),_0x580ed7=await warehouse[_0x1da159(0x171)]([{'$match':{'name':_0x432803['warehouse_name'],'warehouse_category':_0x1da159(0x1c3)}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x1da159(0x1aa)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x1da159(0x1ad)},'bin':{'$first':_0x1da159(0x1df)},'type':{'$first':_0x1da159(0x14b)},'floorlevel':{'$first':_0x1da159(0x1ea)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x1da159(0x197)},'storage':{'$first':_0x1da159(0x19a)},'rack':{'$first':_0x1da159(0x142)},'expiry_date':{'$first':_0x1da159(0x159)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x1da159(0x18e)},'maxPerUnit':{'$first':_0x1da159(0x1f3)},'room':{'$first':_0x1da159(0x1d8)}}}]);if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x19b)){var _0x56523d=users[_0x1da159(0x19f)];console[_0x1da159(0x158)](_0x56523d);}else{if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x1b0))var _0x56523d=users[_0x1da159(0x1b0)];else{if(_0x58e2cc[0x0][_0x1da159(0x164)]=='German')var _0x56523d=users[_0x1da159(0x1b5)];else{if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x14e))var _0x56523d=users['Spanish'];else{if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x134))var _0x56523d=users['French'];else{if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x1bd))var _0x56523d=users[_0x1da159(0x1d6)];else{if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x1f6))var _0x56523d=users[_0x1da159(0x1f6)];else{if(_0x58e2cc[0x0][_0x1da159(0x164)]==_0x1da159(0x15c))var _0x56523d=users[_0x1da159(0x179)];}}}}}}}_0x5ae1ff['render'](_0x1da159(0x199),{'success':_0x2d10bd[_0x1da159(0x178)]('success'),'errors':_0x2d10bd[_0x1da159(0x178)]('errors'),'role':_0x204e9e,'profile':_0x32def0,'adjustment':_0x432803,'stock':_0x580ed7,'master_shop':_0x58e2cc,'warehouse_name':_0x4c4bcc,'unit':_0x4e5328,'language':_0x56523d});}catch(_0x2c497c){console[_0x1da159(0x158)](_0x2c497c),_0x5ae1ff[_0x1da159(0x1e2)](0xc8)[_0x1da159(0x15b)]({'message':_0x2c497c['message']});}}),router['post']('/preview/:id',auth,async(_0xb895b6,_0x5b3fe6)=>{var _0xca990f=a0_0x3eba7b;try{const {invoice:_0x2155af,warehouse_name:_0x196928,Room_name:_0x3015e1}=_0xb895b6['body'],_0x2b08e8=_0xb895b6[_0xca990f(0x1b3)]['id'],_0x2f5edb=await adjustment_finished[_0xca990f(0x1d5)]({'_id':_0x2b08e8});var _0x1d8552;const _0x1e3fb3=_0x2f5edb[_0xca990f(0x140)][_0xca990f(0x13c)](async _0x5a0c3b=>{var _0x49ff09=_0xca990f;if(_0x5a0c3b[_0x49ff09(0x185)]>0x0){_0x1d8552=await warehouse[_0x49ff09(0x1b4)]({'name':_0x196928,'room':_0x5a0c3b[_0x49ff09(0x150)],'warehouse_category':_0x49ff09(0x1c3)});const _0x4a04f5=_0x1d8552[_0x49ff09(0x141)][_0x49ff09(0x13c)](_0xbe3e97=>{var _0x2c9820=_0x49ff09;console[_0x2c9820(0x158)](_0x5a0c3b[_0x2c9820(0x166)]);if(_0x5a0c3b[_0x2c9820(0x166)]==_0x2c9820(0x16f))_0xbe3e97[_0x2c9820(0x157)]==_0x5a0c3b[_0x2c9820(0x157)]&&_0xbe3e97['bay']==_0x5a0c3b[_0x2c9820(0x1e6)]&&_0xbe3e97[_0x2c9820(0x1ed)]==_0x5a0c3b[_0x2c9820(0x1ed)]&&_0xbe3e97[_0x2c9820(0x18a)]==_0x5a0c3b[_0x2c9820(0x18a)]&&_0xbe3e97['batch_code']==_0x5a0c3b[_0x2c9820(0x1ac)]&&_0xbe3e97[_0x2c9820(0x180)]==_0x5a0c3b[_0x2c9820(0x180)]&&(_0xbe3e97[_0x2c9820(0x16c)]=_0xbe3e97[_0x2c9820(0x16c)]-_0x5a0c3b[_0x2c9820(0x185)]);else _0x5a0c3b['types']==_0x2c9820(0x137)&&(_0xbe3e97[_0x2c9820(0x157)]==_0x5a0c3b['product_name']&&_0xbe3e97[_0x2c9820(0x1e6)]==_0x5a0c3b['bay']&&_0xbe3e97[_0x2c9820(0x1ed)]==_0x5a0c3b[_0x2c9820(0x1ed)]&&_0xbe3e97[_0x2c9820(0x18a)]==_0x5a0c3b[_0x2c9820(0x18a)]&&_0xbe3e97[_0x2c9820(0x1ac)]==_0x5a0c3b[_0x2c9820(0x1ac)]&&_0xbe3e97[_0x2c9820(0x180)]==_0x5a0c3b['invoice']&&(_0xbe3e97[_0x2c9820(0x16c)]=_0xbe3e97[_0x2c9820(0x16c)]+_0x5a0c3b[_0x2c9820(0x185)]));});}return _0x1d8552;});Promise[_0xca990f(0x1cf)](_0x1e3fb3)[_0xca990f(0x1db)](async _0x5d9073=>{var _0x585755=_0xca990f;try{for(const _0x109b62 of _0x5d9073){await _0x109b62[_0x585755(0x174)]();}_0x2f5edb[_0x585755(0x154)]=_0x585755(0x132);const _0x27a6bb=await _0x2f5edb[_0x585755(0x174)](),_0x2681df=await master_shop[_0x585755(0x1a5)](),_0x1b4a58=await email_settings[_0x585755(0x1b4)](),_0x1f1a28=await supervisor_settings[_0x585755(0x1a5)]();var _0xa92c57=_0x2f5edb[_0x585755(0x140)],_0x56885f='',_0x500ac2;for(_0x500ac2 in _0xa92c57){var _0x1332c7='FG';_0x2f5edb[_0x585755(0x152)]=='DRY\x20GOODS'&&(_0x1332c7='DG'),_0x56885f+=_0x585755(0x15f)+_0x585755(0x1f8)+_0xa92c57[_0x500ac2]['product_name']+_0x585755(0x14a)+_0x585755(0x1f8)+_0xa92c57[_0x500ac2][_0x585755(0x1ba)]+_0x585755(0x14a)+_0x585755(0x1f8)+_0xa92c57[_0x500ac2][_0x585755(0x185)]+_0x585755(0x14a)+_0x585755(0x1f8)+_0xa92c57[_0x500ac2][_0x585755(0x147)]+_0x585755(0x14a)+_0x585755(0x1f8)+_0xa92c57[_0x500ac2][_0x585755(0x198)]+_0x585755(0x14a)+_0x585755(0x1f8)+_0x2f5edb[_0x585755(0x152)]+'</td>'+_0x585755(0x1f8)+_0xa92c57[_0x500ac2][_0x585755(0x150)]+_0x585755(0x14a)+_0x585755(0x1f8)+_0x1332c7+_0xa92c57[_0x500ac2][_0x585755(0x1e6)]+_0x585755(0x14a)+'</tr>';}let _0x1828d1=nodemailer[_0x585755(0x1d2)]({'host':_0x1b4a58['host'],'port':Number(_0x1b4a58[_0x585755(0x1b9)]),'secure':![],'auth':{'user':_0x1b4a58[_0x585755(0x1a9)],'pass':_0x1b4a58['password']}}),_0x13662d={'from':_0x1b4a58['email'],'to':_0x1f1a28[0x0][_0x585755(0x176)],'subject':_0x585755(0x162),'attachments':[{'filename':_0x585755(0x19c),'path':__dirname+_0x585755(0x1b2)+'/upload/'+_0x2681df[0x0][_0x585755(0x155)],'cid':_0x585755(0x175)}],'html':_0x585755(0x17e)+_0x585755(0x1ab)+'</head><body>'+_0x585755(0x18b)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+_0x585755(0x18b)+_0x585755(0x1ee)+_0x585755(0x133)+_0x585755(0x18b)+_0x585755(0x136)+_0x2681df[0x0][_0x585755(0x14d)]+_0x585755(0x1c1)+_0x585755(0x133)+_0x585755(0x133)+_0x585755(0x1be)+_0x585755(0x18b)+_0x585755(0x16b)+_0x585755(0x161)+_0x2f5edb['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x585755(0x145)+_0x2f5edb['date']+'\x20'+'</span>'+'</h5>'+_0x585755(0x133)+_0x585755(0x182)+_0x585755(0x1e8)+'<tr>'+_0x585755(0x1de)+_0x585755(0x160)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x585755(0x156)+_0x585755(0x1e4)+_0x585755(0x1a8)+_0x585755(0x1ec)+_0x585755(0x173)+_0x585755(0x183)+'</thead>'+_0x585755(0x1c6)+'\x20'+_0x56885f+'\x20'+_0x585755(0x169)+_0x585755(0x170)+_0x585755(0x18b)+_0x585755(0x186)+'<h5>'+_0x2681df[0x0]['site_title']+'</h5>'+_0x585755(0x133)+_0x585755(0x133)+_0x585755(0x13f)};_0x1828d1[_0x585755(0x17c)](_0x13662d,function(_0x55e360,_0x14ebd0){var _0x5df0cf=_0x585755;_0x55e360?(console[_0x5df0cf(0x158)](_0x55e360),console[_0x5df0cf(0x158)]('Error\x20Occurs')):console[_0x5df0cf(0x158)](_0x5df0cf(0x16d));}),_0xb895b6[_0x585755(0x178)](_0x585755(0x1da),_0x585755(0x1a6)),_0x5b3fe6[_0x585755(0x1bb)](_0x585755(0x1c7)+_0x27a6bb[_0x585755(0x1c2)]);}catch(_0x4f7aca){console[_0x585755(0x1ae)](_0x4f7aca),_0x5b3fe6['status'](0x1f4)[_0x585755(0x15b)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0xca990f(0x1b1)](_0x17450c=>{var _0x24634f=_0xca990f;console[_0x24634f(0x1ae)](_0x17450c),_0x5b3fe6[_0x24634f(0x1e2)](0x1f4)[_0x24634f(0x15b)]({'error':_0x24634f(0x1cd)});});}catch(_0x2266dd){_0x5b3fe6[_0xca990f(0x15b)]({'message':_0x2266dd[_0xca990f(0x153)]});}}),router['get']('/view/:id',auth,async(_0x4bd33b,_0x56d12a)=>{var _0x5cee11=a0_0x3eba7b;try{const {username:_0x29bd4a,email:_0x2252a1,role:_0xc91eb}=_0x4bd33b[_0x5cee11(0x13e)],_0x2da656=_0x4bd33b[_0x5cee11(0x13e)],_0x1d1d9f=await profile['findOne']({'email':_0x2da656[_0x5cee11(0x1a9)]}),_0x5f49b3=await master_shop[_0x5cee11(0x1a5)]();console[_0x5cee11(0x158)]('master',_0x5f49b3);const _0x939637=_0x4bd33b[_0x5cee11(0x1b3)]['id'],_0xb3660c=await adjustment_finished[_0x5cee11(0x1d5)]({'_id':_0x939637});let _0x986bda=new Date(_0xb3660c[_0x5cee11(0x1ed)]),_0x9629e6=('0'+_0x986bda[_0x5cee11(0x1f2)]())['slice'](-0x2),_0x3a5d35=('0'+(_0x986bda['getMonth']()+0x1))[_0x5cee11(0x1af)](-0x2),_0x4116f4=_0x986bda[_0x5cee11(0x146)](),_0x15c912=_0x4116f4+'-'+_0x3a5d35+'-'+_0x9629e6;var _0x3ccf01=['Ambient',_0x5cee11(0x192),_0x5cee11(0x17d)];const _0x1f496b=await purchases[_0x5cee11(0x171)]([{'$match':{'warehouse_name':_0xb3660c[_0x5cee11(0x152)]}},{'$unwind':_0x5cee11(0x15a)},{'$group':{'_id':_0x5cee11(0x1d7)}}]);console[_0x5cee11(0x158)](_0x5cee11(0x165),_0x1f496b);const _0xd69948=await product[_0x5cee11(0x1a5)]({}),_0x405a8b=await warehouse['aggregate']([{'$match':{'name':_0xb3660c[_0x5cee11(0x152)],'room':_0xb3660c[_0x5cee11(0x1d3)]}},{'$unwind':_0x5cee11(0x181)},{'$group':{'_id':_0x5cee11(0x14c),'name':{'$first':_0x5cee11(0x1aa)},'product_stock':{'$first':_0x5cee11(0x1f4)},'bay':{'$first':_0x5cee11(0x1ad)},'bin':{'$first':_0x5cee11(0x1df)},'type':{'$first':_0x5cee11(0x14b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x5cee11(0x1a2)},'secondary_code':{'$first':_0x5cee11(0x1b8)},'product_code':{'$first':_0x5cee11(0x197)},'storage':{'$first':_0x5cee11(0x19a)},'rack':{'$first':_0x5cee11(0x142)}}}]);if(_0x5f49b3[0x0][_0x5cee11(0x164)]==_0x5cee11(0x19b)){var _0x243611=users['English'];console[_0x5cee11(0x158)](_0x243611);}else{if(_0x5f49b3[0x0][_0x5cee11(0x164)]==_0x5cee11(0x1b0))var _0x243611=users[_0x5cee11(0x1b0)];else{if(_0x5f49b3[0x0][_0x5cee11(0x164)]==_0x5cee11(0x1b5))var _0x243611=users[_0x5cee11(0x1b5)];else{if(_0x5f49b3[0x0]['language']==_0x5cee11(0x14e))var _0x243611=users['Spanish'];else{if(_0x5f49b3[0x0][_0x5cee11(0x164)]=='French')var _0x243611=users[_0x5cee11(0x134)];else{if(_0x5f49b3[0x0][_0x5cee11(0x164)]==_0x5cee11(0x1bd))var _0x243611=users[_0x5cee11(0x1d6)];else{if(_0x5f49b3[0x0][_0x5cee11(0x164)]=='Chinese')var _0x243611=users[_0x5cee11(0x1f6)];else{if(_0x5f49b3[0x0][_0x5cee11(0x164)]=='Arabic\x20(ae)')var _0x243611=users[_0x5cee11(0x179)];}}}}}}}_0x56d12a[_0x5cee11(0x1e9)](_0x5cee11(0x167),{'success':_0x4bd33b['flash'](_0x5cee11(0x1da)),'errors':_0x4bd33b['flash'](_0x5cee11(0x1a1)),'role':_0x2da656,'profile':_0x1d1d9f,'adjustment':_0xb3660c,'stock':_0x405a8b,'master_shop':_0x5f49b3,'warehouse_name':_0x1f496b,'unit':_0xd69948,'language':_0x243611,'rooms_data':_0x3ccf01,'ed_fullDate':_0x15c912});}catch(_0x646d81){console['log'](_0x646d81),_0x56d12a['status'](0xc8)[_0x5cee11(0x15b)]({'message':_0x646d81[_0x5cee11(0x153)]});}}),router[a0_0x3eba7b(0x19d)](a0_0x3eba7b(0x148),auth,async(_0x3fd488,_0x265d1a)=>{var _0x138854=a0_0x3eba7b;try{const _0x21a35e=_0x3fd488['params']['id'],_0x2f2242=await adjustment_finished[_0x138854(0x1d5)]({'_id':_0x21a35e}),_0x377f01=await warehouse[_0x138854(0x1b4)]({'name':_0x2f2242[_0x138854(0x152)],'room':_0x2f2242[_0x138854(0x1d3)]}),{warehouse_name:_0x4a5b99,date:_0x4f1719,prod_name:_0x3bb5ee,level:_0x414416,isle:_0x322f2b,pallet:_0xfdbdcb,stock:_0x3eeb95,types:_0x1685bb,adjust_qty:_0x82c6a9,new_adjust_qty:_0x2e24b4,note:_0x4a466a,Room_name:_0x2fa32d,invoice:_0x5e00e0,JO_number:_0x1cc3ff}=_0x3fd488[_0x138854(0x1a3)];if(typeof _0x3bb5ee==_0x138854(0x1bc))var _0x315e49=[_0x3fd488[_0x138854(0x1a3)]['prod_name']],_0x13a87f=[_0x3fd488[_0x138854(0x1a3)]['level']],_0x51f0ca=[_0x3fd488[_0x138854(0x1a3)][_0x138854(0x1f7)]],_0x51b105=[_0x3fd488[_0x138854(0x1a3)][_0x138854(0x166)]],_0x3dec3a=[_0x3fd488[_0x138854(0x1a3)][_0x138854(0x185)]],_0x32e31b=[_0x3fd488['body'][_0x138854(0x1d9)]],_0x12addb=[_0x3fd488[_0x138854(0x1a3)][_0x138854(0x16a)]],_0x102fdc=[_0x3fd488['body'][_0x138854(0x147)]],_0x48554f=[_0x3fd488['body'][_0x138854(0x144)]],_0x46cc70=[_0x3fd488['body'][_0x138854(0x1ac)]],_0xfacd85=[_0x3fd488[_0x138854(0x1a3)][_0x138854(0x1ed)]];else var _0x315e49=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x15e)]],_0x13a87f=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x190)]],_0x51f0ca=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x1f7)]],_0x51b105=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x166)]],_0x3dec3a=[..._0x3fd488[_0x138854(0x1a3)]['adjust_qty']],_0x32e31b=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x1d9)]],_0x12addb=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x16a)]],_0x102fdc=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x147)]],_0x48554f=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x144)]],_0x46cc70=[..._0x3fd488['body'][_0x138854(0x1ac)]],_0xfacd85=[..._0x3fd488[_0x138854(0x1a3)][_0x138854(0x1ed)]];const _0x3b1af1=_0x315e49[_0x138854(0x13c)](_0xf02bec=>{return _0xf02bec={'product_name':_0xf02bec};});_0x13a87f[_0x138854(0x139)]((_0x1065a9,_0xf1aee0)=>{var _0x5b0223=_0x138854;_0x3b1af1[_0xf1aee0][_0x5b0223(0x1e6)]=_0x1065a9;}),_0x51f0ca['forEach']((_0x2332c4,_0x512612)=>{var _0x48b0c5=_0x138854;_0x3b1af1[_0x512612][_0x48b0c5(0x1f1)]=_0x2332c4;}),_0x51b105[_0x138854(0x139)]((_0x5e40d7,_0x26542d)=>{var _0x54cff1=_0x138854;_0x3b1af1[_0x26542d][_0x54cff1(0x166)]=_0x5e40d7;}),_0x3dec3a['forEach']((_0x405934,_0x5aa677)=>{var _0x59bec3=_0x138854;_0x3b1af1[_0x5aa677][_0x59bec3(0x185)]=_0x405934;}),_0x32e31b[_0x138854(0x139)]((_0x32c5d2,_0x27e740)=>{_0x3b1af1[_0x27e740]['new_adjust_qty']=_0x32c5d2;}),_0x102fdc[_0x138854(0x139)]((_0x4004b4,_0x2e722f)=>{var _0x2da2ca=_0x138854;_0x3b1af1[_0x2e722f][_0x2da2ca(0x147)]=_0x4004b4;}),_0x48554f[_0x138854(0x139)]((_0x1e51fb,_0x2fb82a)=>{var _0x28a599=_0x138854;_0x3b1af1[_0x2fb82a][_0x28a599(0x198)]=_0x1e51fb;}),_0x12addb[_0x138854(0x139)]((_0x3bd3c2,_0x43049f)=>{var _0x49fc67=_0x138854;_0x3b1af1[_0x43049f][_0x49fc67(0x1ba)]=_0x3bd3c2;}),_0x46cc70[_0x138854(0x139)]((_0x173caa,_0xea6b51)=>{var _0x25fb5b=_0x138854;_0x3b1af1[_0xea6b51][_0x25fb5b(0x1ac)]=_0x173caa;}),_0xfacd85[_0x138854(0x139)]((_0x4ebeb7,_0x36c556)=>{var _0x1b2425=_0x138854;_0x3b1af1[_0x36c556][_0x1b2425(0x1ed)]=_0x4ebeb7;});const _0x43dd2c=_0x3b1af1['filter'](_0x2a9b50=>_0x2a9b50[_0x138854(0x185)]!=='0'&&_0x2a9b50[_0x138854(0x185)]!=='');var _0x3e26ae=0x0;_0x43dd2c['forEach'](_0x46a485=>{var _0x12bd37=_0x138854;console[_0x12bd37(0x158)](_0x12bd37(0x1c9),_0x46a485),parseInt(_0x46a485['adjust_qty'])<=0x0&&_0x3e26ae++;});if(_0x3e26ae!=0x0)return _0x3fd488[_0x138854(0x178)](_0x138854(0x1a1),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x265d1a['redirect'](_0x138854(0x163));_0x2f2242[_0x138854(0x152)]=_0x4a5b99,_0x2f2242[_0x138854(0x17b)]=_0x4f1719,_0x2f2242['product']=_0x43dd2c,_0x2f2242[_0x138854(0x177)]=_0x4a466a,_0x2f2242['room']=_0x2fa32d,_0x2f2242[_0x138854(0x180)]=_0x5e00e0,_0x2f2242[_0x138854(0x14f)]=_0x1cc3ff;const _0x282c53=await _0x2f2242[_0x138854(0x174)](),_0x14207d=await warehouse['findOne']({'name':_0x4a5b99,'room':_0x2fa32d});_0x282c53['product'][_0x138854(0x139)](_0x5cf343=>{var _0x4a13ac=_0x138854;const _0x34a2d4=_0x14207d['product_details'][_0x4a13ac(0x13c)](_0x48c289=>{var _0xe88b06=_0x4a13ac;_0x5cf343[_0xe88b06(0x166)]==_0xe88b06(0x16f)?_0x48c289[_0xe88b06(0x157)]==_0x5cf343[_0xe88b06(0x157)]&&_0x48c289[_0xe88b06(0x1e6)]==_0x5cf343['bay']&&(_0x48c289[_0xe88b06(0x16c)]=parseInt(_0x48c289[_0xe88b06(0x16c)])-parseInt(_0x5cf343[_0xe88b06(0x185)])):_0x48c289[_0xe88b06(0x157)]==_0x5cf343[_0xe88b06(0x157)]&&_0x48c289[_0xe88b06(0x1e6)]==_0x5cf343[_0xe88b06(0x1e6)]&&(_0x48c289[_0xe88b06(0x16c)]=parseInt(_0x48c289[_0xe88b06(0x16c)])+parseInt(_0x5cf343[_0xe88b06(0x185)]));});}),await _0x14207d['save'](),_0x3fd488[_0x138854(0x178)](_0x138854(0x1da),_0x138854(0x191)),_0x265d1a[_0x138854(0x1bb)](_0x138854(0x1bf));}catch(_0x53397c){console[_0x138854(0x158)](_0x53397c);}}),router[a0_0x3eba7b(0x19d)]('/barcode_scanner',async(_0x31f09a,_0x2dd8aa)=>{var _0x2e3706=a0_0x3eba7b;const {primary_code:_0x7bfd8,warehouse_data:_0x184ec8,rooms_data:_0x1f0158,Roomslist:_0x5db354}=_0x31f09a[_0x2e3706(0x1a3)],_0x482752=_0x5db354['split'](','),_0x49d54d=[];async function _0x46c4f0(_0x4bbf70){var _0xf30c02=_0x2e3706;const _0x480633=await warehouse['aggregate']([{'$match':{'name':_0x184ec8,'room':_0x4bbf70}},{'$unwind':_0xf30c02(0x181)},{'$match':{'product_details.primary_code':_0x7bfd8}},{'$group':{'_id':_0xf30c02(0x14c),'name':{'$first':_0xf30c02(0x1aa)},'product_stock':{'$first':_0xf30c02(0x1f4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0xf30c02(0x1ad)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0xf30c02(0x14b)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0xf30c02(0x194)},'storage':{'$first':_0xf30c02(0x19a)},'rack':{'$first':_0xf30c02(0x142)},'expiry_date':{'$first':_0xf30c02(0x159)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0xf30c02(0x1d8)},'invoice':{'$first':_0xf30c02(0x189)}}}]),_0x5a6d22=await warehouse['aggregate']([{'$match':{'name':_0x184ec8,'room':_0x4bbf70}},{'$unwind':_0xf30c02(0x181)},{'$match':{'product_details.secondary_code':_0x7bfd8}},{'$group':{'_id':_0xf30c02(0x14c),'name':{'$first':_0xf30c02(0x1aa)},'product_stock':{'$first':_0xf30c02(0x1f4)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0xf30c02(0x1df)},'type':{'$first':_0xf30c02(0x14b)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xf30c02(0x1cb)},'secondary_unit':{'$first':_0xf30c02(0x194)},'storage':{'$first':_0xf30c02(0x19a)},'rack':{'$first':_0xf30c02(0x142)},'expiry_date':{'$first':_0xf30c02(0x159)},'production_date':{'$first':_0xf30c02(0x1d0)},'batch_code':{'$first':_0xf30c02(0x18e)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0xf30c02(0x1f3)},'roomNamed':{'$first':_0xf30c02(0x1d8)},'invoice':{'$first':_0xf30c02(0x189)}}}]);if(_0x480633[_0xf30c02(0x143)]>0x0)_0x49d54d[_0xf30c02(0x1d4)](_0x480633);else _0x5a6d22['length']>0x0&&_0x49d54d[_0xf30c02(0x1d4)](_0x5a6d22);}const _0x2d78b6=_0x482752['map'](_0x35630b=>_0x46c4f0(_0x35630b));await Promise[_0x2e3706(0x1cf)](_0x2d78b6),_0x2dd8aa[_0x2e3706(0x15b)](_0x49d54d);}),router[a0_0x3eba7b(0x19d)](a0_0x3eba7b(0x17a),async(_0x24468a,_0x3be7ed)=>{var _0x9d8130=a0_0x3eba7b;const {productCode:_0x3e3b09,bay:_0x28aabf,warehouses:_0x4dcc7e,room:_0x971d19}=_0x24468a[_0x9d8130(0x1a3)];console[_0x9d8130(0x158)](_0x24468a[_0x9d8130(0x1a3)]);try{const _0x508fc0=await warehouse[_0x9d8130(0x171)]([{'$match':{'name':_0x4dcc7e,'room':_0x971d19}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x28aabf)}},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x9d8130(0x1f4)},'bay':{'$first':_0x9d8130(0x1ad)},'maxProducts':{'$first':_0x9d8130(0x18d)}}}]);_0x3be7ed[_0x9d8130(0x1e2)](0xc8)[_0x9d8130(0x15b)](_0x508fc0);}catch(_0x28cb25){_0x3be7ed[_0x9d8130(0x1e2)](0x194)[_0x9d8130(0x15b)]({'message':_0x28cb25['message']});}}),module['exports']=router;