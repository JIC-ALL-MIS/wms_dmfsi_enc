var a0_0x302cb3=a0_0x1249;function a0_0x35b1(){var _0x5f39ec=['Router','QA\x20Warehouse','finalize','status','room_names','$product.product_name','French','$date','\x20Order\x20Number\x20:\x20','redirect','maxPerUnit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','</h5>','host','adjustment\x20add\x20successfull','$product_details.maxProducts','find','note','findById','bay','<html><head><title></title>','Secondary_units','English\x20(US)','/barcode_scanner','$product.room_names','toString','product_date','password','Arabic\x20(ae)','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','</td>','30EawBLA','stock','1660347aVMRHE','errors','production_date','success','13112jywWqh','<tr>','Return\x20Rooms','$product_details.batch_code','Arabic','body','$product_details.storage','types','73lzFBZS','product_stock','json','foreach\x20newproduct','$product_details.floorlevel','prod_code','getDate','unit','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','/preview/:id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','Portuguese','New_Qty_Converted_adj','$product_details.product_name','$product_details.type','/adjustment_finished/preview/','Logo.png','floor','$product_details.production_date','minus','An\x20error\x20occurred\x20while\x20saving\x20data.','$finalize','English','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.product_code','random','$product_details.rack','$product_details.bay','../public/language/languages.json','$product_details.invoice','/picking_list/PDF_adjustment/','../middleware/auth','product_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','27881iaVvwl','add_adjustment_finished','flash','warehouse','$_id','master','ADJF-','9670005ItCCxb','length','_id','room','Chinese','batch_code','<div>','</div>','10097904NGDwEi','Portuguese\x20(BR)','map','expiry_date','/view/:id','$name','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$warehouse_name','padStart','role','$product_details.expiry_date','adjustment_finished','$room','language','forEach','findOne','<hr\x20class=\x22my-3\x22>','push','error','/view','params','warehouse_name','/../public','sendMail','email','$product_details.bin','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','invoice','string','product','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$product_details.maxPerUnit','New_Qty_Converted','/adjustment/view','catch','Adjustment\x20Mail','express','site_title','user','Ambient','edit_adjustment_finished','stockBefore','prod_invoice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','get','post','date','\x20</h2>','</head><body>','render','split','exports','/CheckingWarehouse','getMonth','slice','adjustment\x20data\x20update\x20successfully','</tr>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','$product_details.unit','level','Finished\x20Goods','$product_details.secondary_unit','$product_details.product_stock','adjust_qty','secondary_unit','../models/all_models','all','product_details','message','staff','log','Enclosed','3749010ZVpaAB','</body></html>','prod_cat','<!DOCTYPE\x20html>','<h2>\x20','purchases_data','back','prod_name','new_adjust_qty','port','$product','filter','$product_details','<h5>','Spanish','Enabled','product_code','<strong>\x20Regards\x20</strong>','/adjustment_finished/view','nodemailer','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Primary_Units','then','Hindi','There\x27s\x20a\x20error\x20in\x20this\x20transaction','\x20Order\x20Date\x20:\x20','aggregate','6pAQDpe','save','</table>','$product_details.secondary_code','$product_details._id','2119048zGctWC','German','$product_details.primary_code'];a0_0x35b1=function(){return _0x5f39ec;};return a0_0x35b1();}(function(_0x20acaa,_0x436671){var _0x3dce51=a0_0x1249,_0x24fde1=_0x20acaa();while(!![]){try{var _0x437173=-parseInt(_0x3dce51(0x1a2))/0x1*(parseInt(_0x3dce51(0x19a))/0x2)+-parseInt(_0x3dce51(0x196))/0x3+parseInt(_0x3dce51(0x172))/0x4+-parseInt(_0x3dce51(0x152))/0x5+-parseInt(_0x3dce51(0x16d))/0x6*(-parseInt(_0x3dce51(0xfa))/0x7)+-parseInt(_0x3dce51(0x109))/0x8+parseInt(_0x3dce51(0x101))/0x9*(parseInt(_0x3dce51(0x194))/0xa);if(_0x437173===_0x436671)break;else _0x24fde1['push'](_0x24fde1['shift']());}catch(_0x14db96){_0x24fde1['push'](_0x24fde1['shift']());}}}(a0_0x35b1,0xae12b));const express=require(a0_0x302cb3(0x12d)),app=express(),router=express[a0_0x302cb3(0x175)](),auth=require(a0_0x302cb3(0xf7)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x302cb3(0x14b)),users=require(a0_0x302cb3(0xf4)),nodemailer=require(a0_0x302cb3(0x165));router[a0_0x302cb3(0x135)](a0_0x302cb3(0x11c),auth,async(_0xef1632,_0x643a55)=>{var _0x351065=a0_0x302cb3;try{const {username:_0x12230c,email:_0x4a2b07,role:_0x49163f}=_0xef1632['user'],_0x4f45cf=_0xef1632[_0x351065(0x12f)],_0x11795a=await profile['findOne']({'email':_0x4f45cf['email']}),_0x1ec030=await master_shop[_0x351065(0x185)]();let _0x32bc9d;if(_0x4f45cf[_0x351065(0x112)]==_0x351065(0x14f)){const _0x2c04ec=await staff[_0x351065(0x118)]({'email':_0x4f45cf[_0x351065(0x121)]});_0x32bc9d=await warehouse[_0x351065(0x185)]({'status':_0x351065(0x161),'name':_0x2c04ec[_0x351065(0xfd)]});}else _0x32bc9d=await warehouse[_0x351065(0x185)]({'status':_0x351065(0x161)});const _0x5d3f65=await product[_0x351065(0x185)]();let _0xe2264c;if(_0x4f45cf[_0x351065(0x112)]==_0x351065(0x14f)){const _0x66fdef=await staff[_0x351065(0x118)]({'email':_0x4f45cf[_0x351065(0x121)]});_0xe2264c=await adjustment_finished[_0x351065(0x185)]({'warehouse_name':_0x66fdef[_0x351065(0xfd)]});}else _0xe2264c=await adjustment_finished['aggregate']([{'$unwind':_0x351065(0x15c)},{'$group':{'_id':_0x351065(0xfe),'invoice':{'$first':'$invoice'},'date':{'$first':_0x351065(0x17c)},'warehouse_name':{'$first':_0x351065(0x110)},'room':{'$addToSet':_0x351065(0x18d)},'finalize':{'$first':_0x351065(0xed)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1ec030[0x0][_0x351065(0x116)]==_0x351065(0x18b)){var _0x4eadfd=users['English'];console[_0x351065(0x150)](_0x4eadfd);}else{if(_0x1ec030[0x0]['language']==_0x351065(0x169))var _0x4eadfd=users[_0x351065(0x169)];else{if(_0x1ec030[0x0][_0x351065(0x116)]==_0x351065(0x173))var _0x4eadfd=users[_0x351065(0x173)];else{if(_0x1ec030[0x0][_0x351065(0x116)]==_0x351065(0x160))var _0x4eadfd=users['Spanish'];else{if(_0x1ec030[0x0]['language']==_0x351065(0x17b))var _0x4eadfd=users['French'];else{if(_0x1ec030[0x0][_0x351065(0x116)]==_0x351065(0x10a))var _0x4eadfd=users[_0x351065(0x1ad)];else{if(_0x1ec030[0x0][_0x351065(0x116)]==_0x351065(0x105))var _0x4eadfd=users['Chinese'];else{if(_0x1ec030[0x0]['language']==_0x351065(0x191))var _0x4eadfd=users[_0x351065(0x19e)];}}}}}}}_0x643a55[_0x351065(0x13a)](_0x351065(0x114),{'success':_0xef1632['flash']('success'),'errors':_0xef1632['flash'](_0x351065(0x197)),'role':_0x4f45cf,'profile':_0x11795a,'warehouse':_0x32bc9d,'product':_0x5d3f65,'adjustment':_0xe2264c,'master_shop':_0x1ec030,'language':_0x4eadfd});}catch(_0x4a1cf9){console[_0x351065(0x150)](_0x4a1cf9);}});function a0_0x1249(_0x306506,_0x4f922c){var _0x35b1d9=a0_0x35b1();return a0_0x1249=function(_0x124916,_0xc293d6){_0x124916=_0x124916-0xec;var _0x48d130=_0x35b1d9[_0x124916];return _0x48d130;},a0_0x1249(_0x306506,_0x4f922c);}async function getRandom8DigitNumber(){var _0x40327d=a0_0x302cb3;const _0x2ab215=0x989680,_0x236944=0x5f5e0ff,_0x33c76a=Math[_0x40327d(0x1b3)](Math[_0x40327d(0xf1)]()*(_0x236944-_0x2ab215+0x1))+_0x2ab215;var _0xd322e7;const _0x4d0941=await adjustment_finished[_0x40327d(0x118)]({'invoice':_0x40327d(0x100)+_0x33c76a});return _0x4d0941&&_0x4d0941[_0x40327d(0x102)]>0x0?_0xd322e7=_0x40327d(0x100)+_0x33c76a:_0xd322e7='ADJF-'+_0x33c76a,_0xd322e7;}router[a0_0x302cb3(0x135)]('/view/add_adjustment',auth,async(_0x5c2564,_0x22538e)=>{var _0x10f03d=a0_0x302cb3;try{const {username:_0x581890,email:_0x54257c,role:_0x4ae53f}=_0x5c2564['user'],_0x17e1c9=_0x5c2564[_0x10f03d(0x12f)],_0x16963d=await profile[_0x10f03d(0x118)]({'email':_0x17e1c9[_0x10f03d(0x121)]}),_0x2e18be=await master_shop[_0x10f03d(0x185)]();let _0x80c02f;if(_0x17e1c9[_0x10f03d(0x112)]==_0x10f03d(0x14f)){const _0x251628=await staff[_0x10f03d(0x118)]({'email':_0x17e1c9[_0x10f03d(0x121)]});_0x80c02f=await warehouse[_0x10f03d(0x16c)]([{'$match':{'status':_0x10f03d(0x161),'name':_0x251628['warehouse'],'warehouse_category':_0x10f03d(0x146),'name':{'$ne':_0x10f03d(0x176)}}},{'$group':{'_id':_0x10f03d(0x10e),'name':{'$first':'$name'}}}]);}else _0x80c02f=await warehouse[_0x10f03d(0x16c)]([{'$match':{'status':'Enabled','warehouse_category':_0x10f03d(0x146),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x10f03d(0x10e)}}}]);const _0x1f0f2e=await product[_0x10f03d(0x185)]({}),_0x517383=await adjustment_finished[_0x10f03d(0x185)]({}),_0xa36d7e=_0x517383[_0x10f03d(0x102)]+0x1,_0xa1cb13='ADJF-'+_0xa36d7e[_0x10f03d(0x18e)]()[_0x10f03d(0x111)](0x5,'0');var _0x4718fc=[_0x10f03d(0x130),_0x10f03d(0x151),_0x10f03d(0x19c)];if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x18b))var _0x179de2=users[_0x10f03d(0xee)];else{if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x169))var _0x179de2=users['Hindi'];else{if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x173))var _0x179de2=users['German'];else{if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x160))var _0x179de2=users[_0x10f03d(0x160)];else{if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x17b))var _0x179de2=users['French'];else{if(_0x2e18be[0x0]['language']==_0x10f03d(0x10a))var _0x179de2=users[_0x10f03d(0x1ad)];else{if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x105))var _0x179de2=users['Chinese'];else{if(_0x2e18be[0x0][_0x10f03d(0x116)]==_0x10f03d(0x191))var _0x179de2=users[_0x10f03d(0x19e)];}}}}}}}const _0x16d445=getRandom8DigitNumber();_0x16d445[_0x10f03d(0x168)](_0x268677=>{var _0x5a94da=_0x10f03d;_0x22538e[_0x5a94da(0x13a)](_0x5a94da(0xfb),{'success':_0x5c2564['flash']('success'),'errors':_0x5c2564[_0x5a94da(0xfc)](_0x5a94da(0x197)),'role':_0x17e1c9,'profile':_0x16963d,'warehouse':_0x80c02f,'product':_0x1f0f2e,'master_shop':_0x2e18be,'language':_0x179de2,'rooms_data':_0x4718fc,'invoice_no':_0x268677});})[_0x10f03d(0x12b)](_0x26a1ed=>{var _0x59500a=_0x10f03d;_0x5c2564[_0x59500a(0xfc)]('errors',_0x59500a(0x16a)),_0x22538e[_0x59500a(0x17e)](_0x59500a(0x12a));});}catch(_0x5a8d97){console[_0x10f03d(0x150)](_0x5a8d97);}}),router['post']('/view/add_adjustment',auth,async(_0x1e1256,_0x135690)=>{var _0x35524c=a0_0x302cb3;try{const {warehouse_name:_0x12df1e,date:_0x112e68,prod_name:_0x243b35,level:_0x1f1c5d,isle:_0x544197,pallet:_0x58d79d,stock:_0x452ed6,types:_0x340125,adjust_qty:_0x5bc4be,new_adjust_qty:_0x3357f5,note:_0xc0d857,Room_name:_0x578ebc,invoice:_0x4148f9,JO_number:_0x12859a,expiry_date:_0x50a255}=_0x1e1256[_0x35524c(0x19f)];if(typeof _0x243b35==_0x35524c(0x125))var _0x5956a9=[_0x1e1256[_0x35524c(0x19f)]['prod_name']],_0x4625ae=[_0x1e1256['body'][_0x35524c(0x145)]],_0x48cceb=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x195)]],_0x577063=[_0x1e1256['body'][_0x35524c(0x1a1)]],_0x8bb129=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x1ae)]],_0x9c3306=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x129)]],_0x22e7bc=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x167)]],_0x4836bc=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x18a)]],_0x1153f2=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x1a7)]],_0x12da05=[_0x1e1256[_0x35524c(0x19f)]['batch_code']],_0xdac142=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x10c)]],_0x35bdb1=[_0x1e1256[_0x35524c(0x19f)]['product_date']],_0x222e37=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x154)]],_0x28afdb=[_0x1e1256[_0x35524c(0x19f)]['Rooms']],_0x18079c=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x17f)]],_0x247b00=[_0x1e1256[_0x35524c(0x19f)][_0x35524c(0x133)]];else var _0x5956a9=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x159)]],_0x4625ae=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x145)]],_0x48cceb=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x195)]],_0x577063=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x1a1)]],_0x8bb129=[..._0x1e1256[_0x35524c(0x19f)]['New_Qty_Converted_adj']],_0x9c3306=[..._0x1e1256['body']['New_Qty_Converted']],_0x22e7bc=[..._0x1e1256['body'][_0x35524c(0x167)]],_0x4836bc=[..._0x1e1256['body']['Secondary_units']],_0x1153f2=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x1a7)]],_0x12da05=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x106)]],_0xdac142=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x10c)]],_0x35bdb1=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x18f)]],_0x222e37=[..._0x1e1256[_0x35524c(0x19f)]['prod_cat']],_0x28afdb=[..._0x1e1256[_0x35524c(0x19f)]['Rooms']],_0x18079c=[..._0x1e1256[_0x35524c(0x19f)]['maxPerUnit']],_0x247b00=[..._0x1e1256[_0x35524c(0x19f)][_0x35524c(0x133)]];const _0x51ff53=_0x5956a9[_0x35524c(0x10b)](_0x392734=>{return _0x392734={'product_name':_0x392734};});_0x4625ae[_0x35524c(0x117)]((_0x38a0ed,_0x138675)=>{var _0xd7dcd6=_0x35524c;_0x51ff53[_0x138675][_0xd7dcd6(0x188)]=_0x38a0ed;}),_0x48cceb[_0x35524c(0x117)]((_0x37733c,_0x251a78)=>{var _0x18976b=_0x35524c;_0x51ff53[_0x251a78][_0x18976b(0x132)]=_0x37733c;}),_0x577063[_0x35524c(0x117)]((_0x4244dc,_0x1359c3)=>{var _0x11900d=_0x35524c;_0x51ff53[_0x1359c3][_0x11900d(0x1a1)]=_0x4244dc;}),_0x8bb129['forEach']((_0x28467b,_0x5e2a3e)=>{var _0xc2ae94=_0x35524c;_0x51ff53[_0x5e2a3e][_0xc2ae94(0x149)]=_0x28467b;}),_0x9c3306[_0x35524c(0x117)]((_0x1f2689,_0xbba41b)=>{var _0x2e8f9d=_0x35524c;_0x51ff53[_0xbba41b][_0x2e8f9d(0x15a)]=_0x1f2689;}),_0x22e7bc[_0x35524c(0x117)]((_0x99ad28,_0x138b51)=>{_0x51ff53[_0x138b51]['unit']=_0x99ad28;}),_0x4836bc[_0x35524c(0x117)]((_0x2386f0,_0x5906b5)=>{var _0x4def8b=_0x35524c;_0x51ff53[_0x5906b5][_0x4def8b(0x14a)]=_0x2386f0;}),_0x1153f2[_0x35524c(0x117)]((_0xaddb1,_0x1d47e0)=>{var _0x14b06b=_0x35524c;_0x51ff53[_0x1d47e0][_0x14b06b(0x162)]=_0xaddb1;}),_0x12da05[_0x35524c(0x117)]((_0x136ae0,_0x3b2eca)=>{var _0x16bfa9=_0x35524c;_0x51ff53[_0x3b2eca][_0x16bfa9(0x106)]=_0x136ae0;}),_0xdac142['forEach']((_0x5957fc,_0x881546)=>{var _0x5eca15=_0x35524c;_0x51ff53[_0x881546][_0x5eca15(0x10c)]=_0x5957fc;}),_0x35bdb1[_0x35524c(0x117)]((_0xd5238f,_0x231943)=>{_0x51ff53[_0x231943]['production_date']=_0xd5238f;}),_0x222e37['forEach']((_0x431676,_0x1ea0db)=>{var _0x39bddf=_0x35524c;_0x51ff53[_0x1ea0db][_0x39bddf(0x154)]=_0x431676;}),_0x28afdb[_0x35524c(0x117)]((_0x36467c,_0x18a408)=>{_0x51ff53[_0x18a408]['room_names']=_0x36467c;}),_0x18079c[_0x35524c(0x117)]((_0x321f0c,_0x5867ac)=>{_0x51ff53[_0x5867ac]['maxPerUnit']=_0x321f0c;}),_0x247b00[_0x35524c(0x117)]((_0x34241d,_0xd3a21b)=>{var _0x5cd55f=_0x35524c;_0x51ff53[_0xd3a21b][_0x5cd55f(0x124)]=_0x34241d;});const _0x399913=_0x51ff53[_0x35524c(0x15d)](_0x159348=>_0x159348[_0x35524c(0x149)]!=='0'&&_0x159348[_0x35524c(0x149)]!=='');var _0x2e5a4e=0x0;_0x399913[_0x35524c(0x117)](_0x5f480e=>{var _0x57e8f5=_0x35524c;console[_0x57e8f5(0x150)]('foreach\x20newproduct',_0x5f480e),parseInt(_0x5f480e['adjust_qty'])<=0x0&&_0x2e5a4e++;});if(_0x2e5a4e!=0x0)return _0x1e1256[_0x35524c(0xfc)]('errors',_0x35524c(0x10f)),_0x135690[_0x35524c(0x17e)]('back');const _0x4d3cee=new adjustment_finished({'warehouse_name':_0x12df1e,'date':_0x112e68,'product':_0x399913,'note':_0xc0d857,'room':_0x578ebc,'invoice':_0x4148f9,'JO_number':_0x12859a,'expiry_date':_0x50a255}),_0x1da7a5=await _0x4d3cee[_0x35524c(0x16e)]();_0x1e1256[_0x35524c(0xfc)](_0x35524c(0x199),_0x35524c(0x183)),_0x135690[_0x35524c(0x17e)](_0x35524c(0x1b1)+_0x1da7a5[_0x35524c(0x103)]);}catch(_0x562059){console['log'](_0x562059),_0x135690[_0x35524c(0x178)](0xc8)[_0x35524c(0x1a4)]({'message':_0x562059[_0x35524c(0x14e)]});}}),router[a0_0x302cb3(0x135)]('/preview/:id',auth,async(_0x518147,_0xe2f11e)=>{var _0x528674=a0_0x302cb3;try{const {username:_0x4ba23b,email:_0x5098d8,role:_0xa1659e}=_0x518147[_0x528674(0x12f)],_0x4058ae=_0x518147[_0x528674(0x12f)],_0x38cba9=await profile[_0x528674(0x118)]({'email':_0x4058ae['email']}),_0x3a3962=await master_shop[_0x528674(0x185)](),_0x180a50=_0x518147[_0x528674(0x11d)]['id'],_0x938168=await adjustment_finished[_0x528674(0x187)]({'_id':_0x180a50}),_0x2bc24b=await purchases[_0x528674(0x16c)]([{'$match':{'warehouse_name':_0x938168[_0x528674(0x11e)]}},{'$unwind':'$product'},{'$group':{'_id':_0x528674(0x17a)}}]);console[_0x528674(0x150)]('purchases_data',_0x2bc24b);const _0x52d047=await product[_0x528674(0x185)]({}),_0x234022=await warehouse[_0x528674(0x16c)]([{'$match':{'name':_0x938168[_0x528674(0x11e)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x528674(0x15e)},{'$group':{'_id':_0x528674(0x171),'name':{'$first':_0x528674(0x1af)},'product_stock':{'$first':_0x528674(0x148)},'bay':{'$first':_0x528674(0xf3)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x528674(0x1b0)},'floorlevel':{'$first':_0x528674(0x1a6)},'primary_code':{'$first':_0x528674(0x174)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x528674(0xf0)},'storage':{'$first':_0x528674(0x1a0)},'rack':{'$first':_0x528674(0xf2)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x528674(0x1b4)},'batch_code':{'$first':_0x528674(0x19d)},'maxPerUnit':{'$first':_0x528674(0x128)},'room':{'$first':_0x528674(0x115)}}}]);if(_0x3a3962[0x0][_0x528674(0x116)]==_0x528674(0x18b)){var _0x4616ee=users[_0x528674(0xee)];console['log'](_0x4616ee);}else{if(_0x3a3962[0x0][_0x528674(0x116)]==_0x528674(0x169))var _0x4616ee=users[_0x528674(0x169)];else{if(_0x3a3962[0x0][_0x528674(0x116)]==_0x528674(0x173))var _0x4616ee=users['German'];else{if(_0x3a3962[0x0][_0x528674(0x116)]==_0x528674(0x160))var _0x4616ee=users[_0x528674(0x160)];else{if(_0x3a3962[0x0][_0x528674(0x116)]==_0x528674(0x17b))var _0x4616ee=users[_0x528674(0x17b)];else{if(_0x3a3962[0x0][_0x528674(0x116)]=='Portuguese\x20(BR)')var _0x4616ee=users[_0x528674(0x1ad)];else{if(_0x3a3962[0x0][_0x528674(0x116)]==_0x528674(0x105))var _0x4616ee=users[_0x528674(0x105)];else{if(_0x3a3962[0x0]['language']=='Arabic\x20(ae)')var _0x4616ee=users[_0x528674(0x19e)];}}}}}}}_0xe2f11e[_0x528674(0x13a)]('edit_adjustment_finished_view',{'success':_0x518147[_0x528674(0xfc)](_0x528674(0x199)),'errors':_0x518147[_0x528674(0xfc)](_0x528674(0x197)),'role':_0x4058ae,'profile':_0x38cba9,'adjustment':_0x938168,'stock':_0x234022,'master_shop':_0x3a3962,'warehouse_name':_0x2bc24b,'unit':_0x52d047,'language':_0x4616ee});}catch(_0x35b546){console[_0x528674(0x150)](_0x35b546),_0xe2f11e[_0x528674(0x178)](0xc8)[_0x528674(0x1a4)]({'message':_0x35b546[_0x528674(0x14e)]});}}),router['post'](a0_0x302cb3(0x1ab),auth,async(_0x1e5b12,_0x13e76f)=>{var _0x50811c=a0_0x302cb3;try{const {invoice:_0x3a7dc3,warehouse_name:_0x43ae26,Room_name:_0x210f9d}=_0x1e5b12[_0x50811c(0x19f)],_0x285ef3=_0x1e5b12['params']['id'],_0x2ce640=await adjustment_finished['findById']({'_id':_0x285ef3});var _0x276bfb;const _0x24ec52=_0x2ce640[_0x50811c(0x126)]['map'](async _0x12fab9=>{var _0x1ad10a=_0x50811c;if(_0x12fab9[_0x1ad10a(0x149)]>0x0){_0x276bfb=await warehouse[_0x1ad10a(0x118)]({'name':_0x43ae26,'room':_0x12fab9[_0x1ad10a(0x179)],'warehouse_category':_0x1ad10a(0x146)});const _0x3e6317=_0x276bfb[_0x1ad10a(0x14d)][_0x1ad10a(0x10b)](_0x6f301e=>{var _0x2913a1=_0x1ad10a;console[_0x2913a1(0x150)](_0x12fab9[_0x2913a1(0x1a1)]);if(_0x12fab9[_0x2913a1(0x1a1)]=='minus')_0x6f301e[_0x2913a1(0xf8)]==_0x12fab9['product_name']&&_0x6f301e[_0x2913a1(0x188)]==_0x12fab9['bay']&&_0x6f301e[_0x2913a1(0x10c)]==_0x12fab9[_0x2913a1(0x10c)]&&_0x6f301e[_0x2913a1(0x198)]==_0x12fab9[_0x2913a1(0x198)]&&_0x6f301e['batch_code']==_0x12fab9[_0x2913a1(0x106)]&&_0x6f301e[_0x2913a1(0x124)]==_0x12fab9[_0x2913a1(0x124)]&&(_0x6f301e[_0x2913a1(0x1a3)]=_0x6f301e[_0x2913a1(0x1a3)]-_0x12fab9[_0x2913a1(0x149)]);else _0x12fab9[_0x2913a1(0x1a1)]=='add'&&(_0x6f301e['product_name']==_0x12fab9[_0x2913a1(0xf8)]&&_0x6f301e[_0x2913a1(0x188)]==_0x12fab9[_0x2913a1(0x188)]&&_0x6f301e['expiry_date']==_0x12fab9[_0x2913a1(0x10c)]&&_0x6f301e['production_date']==_0x12fab9['production_date']&&_0x6f301e[_0x2913a1(0x106)]==_0x12fab9[_0x2913a1(0x106)]&&_0x6f301e[_0x2913a1(0x124)]==_0x12fab9[_0x2913a1(0x124)]&&(_0x6f301e['product_stock']=_0x6f301e[_0x2913a1(0x1a3)]+_0x12fab9[_0x2913a1(0x149)]));});}return _0x276bfb;});Promise[_0x50811c(0x14c)](_0x24ec52)['then'](async _0x3b39d4=>{var _0x4e3bbf=_0x50811c;try{for(const _0x31b6e9 of _0x3b39d4){await _0x31b6e9[_0x4e3bbf(0x16e)]();}_0x2ce640[_0x4e3bbf(0x177)]='True';const _0x5ec4a1=await _0x2ce640[_0x4e3bbf(0x16e)](),_0x412da4=await master_shop[_0x4e3bbf(0x185)](),_0x498f7b=await email_settings[_0x4e3bbf(0x118)](),_0x1db452=await supervisor_settings['find']();var _0x307184=_0x2ce640[_0x4e3bbf(0x126)],_0x26d789='',_0x1810b1;for(_0x1810b1 in _0x307184){var _0x492add='FG';_0x2ce640[_0x4e3bbf(0x11e)]=='DRY\x20GOODS'&&(_0x492add='DG'),_0x26d789+='<tr>'+_0x4e3bbf(0x134)+_0x307184[_0x1810b1]['product_name']+_0x4e3bbf(0x193)+_0x4e3bbf(0x134)+_0x307184[_0x1810b1][_0x4e3bbf(0x162)]+_0x4e3bbf(0x193)+_0x4e3bbf(0x134)+_0x307184[_0x1810b1][_0x4e3bbf(0x149)]+_0x4e3bbf(0x193)+_0x4e3bbf(0x134)+_0x307184[_0x1810b1]['unit']+_0x4e3bbf(0x193)+_0x4e3bbf(0x134)+_0x307184[_0x1810b1][_0x4e3bbf(0x14a)]+_0x4e3bbf(0x193)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2ce640[_0x4e3bbf(0x11e)]+_0x4e3bbf(0x193)+_0x4e3bbf(0x134)+_0x307184[_0x1810b1]['room_names']+_0x4e3bbf(0x193)+_0x4e3bbf(0x134)+_0x492add+_0x307184[_0x1810b1][_0x4e3bbf(0x188)]+_0x4e3bbf(0x193)+'</tr>';}let _0x3c0a48=nodemailer['createTransport']({'host':_0x498f7b[_0x4e3bbf(0x182)],'port':Number(_0x498f7b[_0x4e3bbf(0x15b)]),'secure':![],'auth':{'user':_0x498f7b[_0x4e3bbf(0x121)],'pass':_0x498f7b[_0x4e3bbf(0x190)]}}),_0xf0e8ca={'from':_0x498f7b['email'],'to':_0x1db452[0x0]['FGSEmail'],'subject':_0x4e3bbf(0x12c),'attachments':[{'filename':_0x4e3bbf(0x1b2),'path':__dirname+_0x4e3bbf(0x11f)+'/upload/'+_0x412da4[0x0]['image'],'cid':'logo'}],'html':_0x4e3bbf(0x155)+_0x4e3bbf(0x189)+_0x4e3bbf(0x139)+_0x4e3bbf(0x107)+_0x4e3bbf(0x123)+_0x4e3bbf(0x107)+_0x4e3bbf(0x127)+_0x4e3bbf(0x108)+_0x4e3bbf(0x107)+_0x4e3bbf(0x156)+_0x412da4[0x0][_0x4e3bbf(0x12e)]+_0x4e3bbf(0x138)+_0x4e3bbf(0x108)+'</div>'+_0x4e3bbf(0x119)+'<div>'+_0x4e3bbf(0xef)+_0x4e3bbf(0x17d)+_0x2ce640['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x4e3bbf(0x16b)+_0x2ce640[_0x4e3bbf(0x137)]+'\x20'+'</span>'+_0x4e3bbf(0x181)+_0x4e3bbf(0x108)+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4e3bbf(0x1aa)+_0x4e3bbf(0x19b)+_0x4e3bbf(0x142)+_0x4e3bbf(0x180)+_0x4e3bbf(0x166)+_0x4e3bbf(0x1ac)+_0x4e3bbf(0x143)+_0x4e3bbf(0xf9)+_0x4e3bbf(0x192)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x4e3bbf(0x141)+'</thead>'+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x26d789+'\x20'+'</tbody>'+_0x4e3bbf(0x16f)+'<div>'+_0x4e3bbf(0x163)+_0x4e3bbf(0x15f)+_0x412da4[0x0]['site_title']+_0x4e3bbf(0x181)+'</div>'+_0x4e3bbf(0x108)+_0x4e3bbf(0x153)};_0x3c0a48[_0x4e3bbf(0x120)](_0xf0e8ca,function(_0x485b80,_0x1b200d){var _0x1c87f2=_0x4e3bbf;_0x485b80?(console[_0x1c87f2(0x150)](_0x485b80),console['log']('Error\x20Occurs')):console[_0x1c87f2(0x150)]('Email\x20sent\x20successfully');}),_0x1e5b12[_0x4e3bbf(0xfc)]('success','Adjustment\x20Finalize\x20Successfully'),_0x13e76f[_0x4e3bbf(0x17e)](_0x4e3bbf(0xf6)+_0x5ec4a1['_id']);}catch(_0x171ef0){console[_0x4e3bbf(0x11b)](_0x171ef0),_0x13e76f['status'](0x1f4)[_0x4e3bbf(0x1a4)]({'error':_0x4e3bbf(0xec)});}})[_0x50811c(0x12b)](_0x5b8858=>{var _0x3b5be6=_0x50811c;console['error'](_0x5b8858),_0x13e76f[_0x3b5be6(0x178)](0x1f4)[_0x3b5be6(0x1a4)]({'error':'An\x20error\x20occurred.'});});}catch(_0x44649c){_0x13e76f[_0x50811c(0x1a4)]({'message':_0x44649c['message']});}}),router[a0_0x302cb3(0x135)](a0_0x302cb3(0x10d),auth,async(_0x120481,_0x553a58)=>{var _0x22bedd=a0_0x302cb3;try{const {username:_0x3e5537,email:_0x4a99c4,role:_0x586544}=_0x120481[_0x22bedd(0x12f)],_0x339d33=_0x120481[_0x22bedd(0x12f)],_0x24ae10=await profile[_0x22bedd(0x118)]({'email':_0x339d33[_0x22bedd(0x121)]}),_0x19069a=await master_shop[_0x22bedd(0x185)]();console[_0x22bedd(0x150)](_0x22bedd(0xff),_0x19069a);const _0x48ffc1=_0x120481[_0x22bedd(0x11d)]['id'],_0xb3f399=await adjustment_finished[_0x22bedd(0x187)]({'_id':_0x48ffc1});let _0x18d51d=new Date(_0xb3f399[_0x22bedd(0x10c)]),_0xddf56d=('0'+_0x18d51d[_0x22bedd(0x1a8)]())[_0x22bedd(0x13f)](-0x2),_0x406acf=('0'+(_0x18d51d[_0x22bedd(0x13e)]()+0x1))[_0x22bedd(0x13f)](-0x2),_0x51a7c4=_0x18d51d['getFullYear'](),_0x421120=_0x51a7c4+'-'+_0x406acf+'-'+_0xddf56d;var _0x1df900=[_0x22bedd(0x130),_0x22bedd(0x151),'Return\x20Rooms'];const _0x1a2978=await purchases[_0x22bedd(0x16c)]([{'$match':{'warehouse_name':_0xb3f399[_0x22bedd(0x11e)]}},{'$unwind':'$product'},{'$group':{'_id':_0x22bedd(0x17a)}}]);console[_0x22bedd(0x150)](_0x22bedd(0x157),_0x1a2978);const _0x106058=await product[_0x22bedd(0x185)]({}),_0xc14341=await warehouse[_0x22bedd(0x16c)]([{'$match':{'name':_0xb3f399['warehouse_name'],'room':_0xb3f399[_0x22bedd(0x104)]}},{'$unwind':'$product_details'},{'$group':{'_id':_0x22bedd(0x171),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x22bedd(0x148)},'bay':{'$first':_0x22bedd(0xf3)},'bin':{'$first':_0x22bedd(0x122)},'type':{'$first':_0x22bedd(0x1b0)},'floorlevel':{'$first':_0x22bedd(0x1a6)},'primary_code':{'$first':_0x22bedd(0x174)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x22bedd(0xf0)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'}}}]);if(_0x19069a[0x0]['language']==_0x22bedd(0x18b)){var _0x36f72e=users[_0x22bedd(0xee)];console[_0x22bedd(0x150)](_0x36f72e);}else{if(_0x19069a[0x0][_0x22bedd(0x116)]==_0x22bedd(0x169))var _0x36f72e=users[_0x22bedd(0x169)];else{if(_0x19069a[0x0]['language']==_0x22bedd(0x173))var _0x36f72e=users[_0x22bedd(0x173)];else{if(_0x19069a[0x0][_0x22bedd(0x116)]==_0x22bedd(0x160))var _0x36f72e=users[_0x22bedd(0x160)];else{if(_0x19069a[0x0][_0x22bedd(0x116)]=='French')var _0x36f72e=users[_0x22bedd(0x17b)];else{if(_0x19069a[0x0]['language']==_0x22bedd(0x10a))var _0x36f72e=users[_0x22bedd(0x1ad)];else{if(_0x19069a[0x0]['language']==_0x22bedd(0x105))var _0x36f72e=users[_0x22bedd(0x105)];else{if(_0x19069a[0x0][_0x22bedd(0x116)]==_0x22bedd(0x191))var _0x36f72e=users[_0x22bedd(0x19e)];}}}}}}}_0x553a58[_0x22bedd(0x13a)](_0x22bedd(0x131),{'success':_0x120481[_0x22bedd(0xfc)](_0x22bedd(0x199)),'errors':_0x120481[_0x22bedd(0xfc)]('errors'),'role':_0x339d33,'profile':_0x24ae10,'adjustment':_0xb3f399,'stock':_0xc14341,'master_shop':_0x19069a,'warehouse_name':_0x1a2978,'unit':_0x106058,'language':_0x36f72e,'rooms_data':_0x1df900,'ed_fullDate':_0x421120});}catch(_0x1281c6){console[_0x22bedd(0x150)](_0x1281c6),_0x553a58['status'](0xc8)['json']({'message':_0x1281c6['message']});}}),router[a0_0x302cb3(0x136)](a0_0x302cb3(0x10d),auth,async(_0x5dbf1c,_0x545ccc)=>{var _0x5c8900=a0_0x302cb3;try{const _0x2d2856=_0x5dbf1c[_0x5c8900(0x11d)]['id'],_0x1c475c=await adjustment_finished[_0x5c8900(0x187)]({'_id':_0x2d2856}),_0xc28649=await warehouse[_0x5c8900(0x118)]({'name':_0x1c475c['warehouse_name'],'room':_0x1c475c['room']}),{warehouse_name:_0x1348ad,date:_0x10e031,prod_name:_0xea1423,level:_0xb75375,isle:_0x377571,pallet:_0x3074ef,stock:_0x23b73e,types:_0x2a8167,adjust_qty:_0x455704,new_adjust_qty:_0x271803,note:_0x5105fa,Room_name:_0x463f09,invoice:_0xa6c37d,JO_number:_0x2d982b}=_0x5dbf1c[_0x5c8900(0x19f)];if(typeof _0xea1423==_0x5c8900(0x125))var _0x3bda90=[_0x5dbf1c['body'][_0x5c8900(0x159)]],_0x508fbe=[_0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x145)]],_0x424d12=[_0x5dbf1c[_0x5c8900(0x19f)]['stock']],_0x26eb6f=[_0x5dbf1c['body'][_0x5c8900(0x1a1)]],_0xd88730=[_0x5dbf1c[_0x5c8900(0x19f)]['adjust_qty']],_0x5aee06=[_0x5dbf1c[_0x5c8900(0x19f)]['new_adjust_qty']],_0x144287=[_0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x1a7)]],_0x6a70d9=[_0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x1a9)]],_0x369f5a=[_0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x18a)]],_0xa1ba49=[_0x5dbf1c['body'][_0x5c8900(0x106)]],_0x3d8606=[_0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x10c)]];else var _0x3bda90=[..._0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x159)]],_0x508fbe=[..._0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x145)]],_0x424d12=[..._0x5dbf1c[_0x5c8900(0x19f)]['stock']],_0x26eb6f=[..._0x5dbf1c[_0x5c8900(0x19f)]['types']],_0xd88730=[..._0x5dbf1c['body']['adjust_qty']],_0x5aee06=[..._0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x15a)]],_0x144287=[..._0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x1a7)]],_0x6a70d9=[..._0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x1a9)]],_0x369f5a=[..._0x5dbf1c[_0x5c8900(0x19f)][_0x5c8900(0x18a)]],_0xa1ba49=[..._0x5dbf1c['body']['batch_code']],_0x3d8606=[..._0x5dbf1c['body'][_0x5c8900(0x10c)]];const _0x28622f=_0x3bda90[_0x5c8900(0x10b)](_0x2bc185=>{return _0x2bc185={'product_name':_0x2bc185};});_0x508fbe[_0x5c8900(0x117)]((_0x277693,_0x1d0c24)=>{var _0x39f1fd=_0x5c8900;_0x28622f[_0x1d0c24][_0x39f1fd(0x188)]=_0x277693;}),_0x424d12[_0x5c8900(0x117)]((_0xe36d58,_0x29e11f)=>{_0x28622f[_0x29e11f]['stockBefore']=_0xe36d58;}),_0x26eb6f[_0x5c8900(0x117)]((_0x271d61,_0x28cbba)=>{var _0x56f223=_0x5c8900;_0x28622f[_0x28cbba][_0x56f223(0x1a1)]=_0x271d61;}),_0xd88730[_0x5c8900(0x117)]((_0xffee26,_0x4b3eaf)=>{var _0x22eab1=_0x5c8900;_0x28622f[_0x4b3eaf][_0x22eab1(0x149)]=_0xffee26;}),_0x5aee06[_0x5c8900(0x117)]((_0x5eda59,_0x23c1e3)=>{_0x28622f[_0x23c1e3]['new_adjust_qty']=_0x5eda59;}),_0x6a70d9[_0x5c8900(0x117)]((_0x3e938f,_0x25a7d6)=>{var _0x5e9334=_0x5c8900;_0x28622f[_0x25a7d6][_0x5e9334(0x1a9)]=_0x3e938f;}),_0x369f5a[_0x5c8900(0x117)]((_0x3cf60b,_0x3c7623)=>{_0x28622f[_0x3c7623]['secondary_unit']=_0x3cf60b;}),_0x144287[_0x5c8900(0x117)]((_0x118e33,_0x341116)=>{var _0x259fd9=_0x5c8900;_0x28622f[_0x341116][_0x259fd9(0x162)]=_0x118e33;}),_0xa1ba49[_0x5c8900(0x117)]((_0x207edc,_0x565644)=>{var _0x584884=_0x5c8900;_0x28622f[_0x565644][_0x584884(0x106)]=_0x207edc;}),_0x3d8606['forEach']((_0x53fb40,_0x19d161)=>{var _0x582236=_0x5c8900;_0x28622f[_0x19d161][_0x582236(0x10c)]=_0x53fb40;});const _0x589bc5=_0x28622f[_0x5c8900(0x15d)](_0xd9a5e8=>_0xd9a5e8['adjust_qty']!=='0'&&_0xd9a5e8[_0x5c8900(0x149)]!=='');var _0x15a27e=0x0;_0x589bc5[_0x5c8900(0x117)](_0xbc8205=>{var _0x8e386a=_0x5c8900;console[_0x8e386a(0x150)](_0x8e386a(0x1a5),_0xbc8205),parseInt(_0xbc8205[_0x8e386a(0x149)])<=0x0&&_0x15a27e++;});if(_0x15a27e!=0x0)return _0x5dbf1c[_0x5c8900(0xfc)](_0x5c8900(0x197),_0x5c8900(0x10f)),_0x545ccc['redirect'](_0x5c8900(0x158));_0x1c475c['warehouse_name']=_0x1348ad,_0x1c475c[_0x5c8900(0x137)]=_0x10e031,_0x1c475c[_0x5c8900(0x126)]=_0x589bc5,_0x1c475c[_0x5c8900(0x186)]=_0x5105fa,_0x1c475c['room']=_0x463f09,_0x1c475c[_0x5c8900(0x124)]=_0xa6c37d,_0x1c475c['JO_number']=_0x2d982b;const _0x3a330b=await _0x1c475c[_0x5c8900(0x16e)](),_0x4db56b=await warehouse[_0x5c8900(0x118)]({'name':_0x1348ad,'room':_0x463f09});_0x3a330b['product'][_0x5c8900(0x117)](_0x416e9b=>{var _0x307e0e=_0x5c8900;const _0x4b6194=_0x4db56b[_0x307e0e(0x14d)][_0x307e0e(0x10b)](_0x41c97a=>{var _0x5780cf=_0x307e0e;_0x416e9b[_0x5780cf(0x1a1)]==_0x5780cf(0x1b5)?_0x41c97a['product_name']==_0x416e9b['product_name']&&_0x41c97a[_0x5780cf(0x188)]==_0x416e9b[_0x5780cf(0x188)]&&(_0x41c97a[_0x5780cf(0x1a3)]=parseInt(_0x41c97a[_0x5780cf(0x1a3)])-parseInt(_0x416e9b[_0x5780cf(0x149)])):_0x41c97a[_0x5780cf(0xf8)]==_0x416e9b[_0x5780cf(0xf8)]&&_0x41c97a[_0x5780cf(0x188)]==_0x416e9b[_0x5780cf(0x188)]&&(_0x41c97a[_0x5780cf(0x1a3)]=parseInt(_0x41c97a['product_stock'])+parseInt(_0x416e9b[_0x5780cf(0x149)]));});}),await _0x4db56b[_0x5c8900(0x16e)](),_0x5dbf1c[_0x5c8900(0xfc)](_0x5c8900(0x199),_0x5c8900(0x140)),_0x545ccc[_0x5c8900(0x17e)](_0x5c8900(0x164));}catch(_0x58db53){console[_0x5c8900(0x150)](_0x58db53);}}),router[a0_0x302cb3(0x136)](a0_0x302cb3(0x18c),async(_0x338f99,_0x55a03f)=>{var _0x58a0bf=a0_0x302cb3;const {primary_code:_0x1dee9c,warehouse_data:_0x4b5f74,rooms_data:_0x17c09d,Roomslist:_0x567283}=_0x338f99[_0x58a0bf(0x19f)],_0x1d849d=_0x567283[_0x58a0bf(0x13b)](','),_0x357f4d=[];async function _0x4d7146(_0x299d98){var _0x3478fe=_0x58a0bf;const _0x21cf38=await warehouse[_0x3478fe(0x16c)]([{'$match':{'name':_0x4b5f74,'room':_0x299d98}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x1dee9c}},{'$group':{'_id':_0x3478fe(0x171),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3478fe(0x148)},'primary_code':{'$first':_0x3478fe(0x174)},'secondary_code':{'$first':_0x3478fe(0x170)},'product_code':{'$first':_0x3478fe(0xf0)},'level':{'$first':_0x3478fe(0xf3)},'isle':{'$first':_0x3478fe(0x122)},'type':{'$first':_0x3478fe(0x1b0)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3478fe(0x144)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3478fe(0x1a0)},'rack':{'$first':_0x3478fe(0xf2)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x3478fe(0x19d)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x3478fe(0x115)},'invoice':{'$first':_0x3478fe(0xf5)}}}]),_0x3f2bfd=await warehouse[_0x3478fe(0x16c)]([{'$match':{'name':_0x4b5f74,'room':_0x299d98}},{'$unwind':_0x3478fe(0x15e)},{'$match':{'product_details.secondary_code':_0x1dee9c}},{'$group':{'_id':_0x3478fe(0x171),'name':{'$first':_0x3478fe(0x1af)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3478fe(0x174)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3478fe(0xf0)},'level':{'$first':_0x3478fe(0xf3)},'isle':{'$first':_0x3478fe(0x122)},'type':{'$first':_0x3478fe(0x1b0)},'pallet':{'$first':_0x3478fe(0x1a6)},'unit':{'$first':_0x3478fe(0x144)},'secondary_unit':{'$first':_0x3478fe(0x147)},'storage':{'$first':_0x3478fe(0x1a0)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x3478fe(0x113)},'production_date':{'$first':_0x3478fe(0x1b4)},'batch_code':{'$first':_0x3478fe(0x19d)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x3478fe(0x115)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x21cf38[_0x3478fe(0x102)]>0x0)_0x357f4d[_0x3478fe(0x11a)](_0x21cf38);else _0x3f2bfd[_0x3478fe(0x102)]>0x0&&_0x357f4d['push'](_0x3f2bfd);}const _0x973d06=_0x1d849d[_0x58a0bf(0x10b)](_0x2755db=>_0x4d7146(_0x2755db));await Promise[_0x58a0bf(0x14c)](_0x973d06),_0x55a03f[_0x58a0bf(0x1a4)](_0x357f4d);}),router[a0_0x302cb3(0x136)](a0_0x302cb3(0x13d),async(_0x1cf4ef,_0x6f0b30)=>{var _0x4fa4a9=a0_0x302cb3;const {productCode:_0x5352a6,bay:_0x3be401,warehouses:_0x1baaa3,room:_0x17a04e}=_0x1cf4ef[_0x4fa4a9(0x19f)];console[_0x4fa4a9(0x150)](_0x1cf4ef[_0x4fa4a9(0x19f)]);try{const _0x52ef90=await warehouse[_0x4fa4a9(0x16c)]([{'$match':{'name':_0x1baaa3,'room':_0x17a04e}},{'$unwind':_0x4fa4a9(0x15e)},{'$match':{'product_details.bay':parseInt(_0x3be401)}},{'$group':{'_id':_0x4fa4a9(0x171),'name':{'$first':_0x4fa4a9(0x1af)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x4fa4a9(0x184)}}}]);_0x6f0b30[_0x4fa4a9(0x178)](0xc8)[_0x4fa4a9(0x1a4)](_0x52ef90);}catch(_0x53ac53){_0x6f0b30['status'](0x194)[_0x4fa4a9(0x1a4)]({'message':_0x53ac53[_0x4fa4a9(0x14e)]});}}),module[a0_0x302cb3(0x13c)]=router;