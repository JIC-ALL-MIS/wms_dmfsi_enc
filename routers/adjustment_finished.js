var a0_0x3ff847=a0_0x2585;(function(_0x5c267f,_0x19e249){var _0xf0f309=a0_0x2585,_0x15a177=_0x5c267f();while(!![]){try{var _0x5c8444=-parseInt(_0xf0f309(0x166))/0x1*(parseInt(_0xf0f309(0x1b4))/0x2)+-parseInt(_0xf0f309(0x11b))/0x3+-parseInt(_0xf0f309(0x136))/0x4*(-parseInt(_0xf0f309(0x143))/0x5)+-parseInt(_0xf0f309(0x1af))/0x6*(parseInt(_0xf0f309(0x11e))/0x7)+parseInt(_0xf0f309(0x139))/0x8*(parseInt(_0xf0f309(0x1cd))/0x9)+-parseInt(_0xf0f309(0x16d))/0xa+parseInt(_0xf0f309(0x119))/0xb;if(_0x5c8444===_0x19e249)break;else _0x15a177['push'](_0x15a177['shift']());}catch(_0x4acb5c){_0x15a177['push'](_0x15a177['shift']());}}}(a0_0x588d,0x8abaa));const express=require(a0_0x3ff847(0x112)),app=express(),router=express[a0_0x3ff847(0x10b)](),auth=require(a0_0x3ff847(0x111)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x3ff847(0x1a5)),users=require('../public/language/languages.json'),nodemailer=require(a0_0x3ff847(0x17c));function a0_0x588d(){var _0x26a637=['user','Spanish','all','errors','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','slice','prod_name','$product_details.expiry_date','getMonth','4PxJJIK','Portuguese','/view','5903096jTzRMN','string','prod_invoice','<hr\x20class=\x22my-3\x22>','product','back','$product_details.batch_code','flash','find','expiry_date','3275425giBiqY','map','French','padStart','<tr>','</tbody>','$name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','foreach\x20newproduct','split','$product_details.type','stockBefore','</body></html>','$product_details.product_stock','</h5>','/adjustment_finished/view','An\x20error\x20occurred.','$product.room_names','adjustment\x20data\x20update\x20successfully','$room','filter','getFullYear','email','adjustment\x20add\x20successfull','$product.product_name','Enabled','adjustment_finished','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','finalize','/view/add_adjustment','staff','room_names','forEach','warehouse','site_title','44453EnjrTu','success','Arabic\x20(ae)','<!DOCTYPE\x20html>','level','$product_details','</table>','6877480iViTuz','$product_details.bin','New_Qty_Converted_adj','edit_adjustment_finished','$product','length','message','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','production_date','<h5\x20style=\x22text-align:\x20left;\x22>','new_adjust_qty','add','Return\x20Rooms','$product_details.maxPerUnit','adjust_qty','nodemailer','then','Primary_Units','/preview/:id','<h5>','catch','prod_code','floor','unit','product_details','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stock','batch_code','host','$product_details.secondary_code','warehouse_name','push','<h2>\x20','$product_details.invoice','language','minus','\x20</h2>','German','$finalize','</span>','$product_details.floorlevel','_id','$product_details.production_date','Ambient','Adjustment\x20Mail','types','Chinese','/upload/','product_date','ADJF-','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','findOne','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','product_stock','add_adjustment_finished','purchases_data','../models/all_models','Finished\x20Goods','role','logo','<strong>\x20Regards\x20</strong>','$product_details.primary_code','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','<div>','<html><head><title></title>','An\x20error\x20occurred\x20while\x20saving\x20data.','20538nFeuTG','random','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Email\x20sent\x20successfully','Rooms','34RotKCt','edit_adjustment_finished_view','body','save','render','Portuguese\x20(BR)','post','</head><body>','<span\x20style=\x22float:\x20right;\x22>','/barcode_scanner','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Logo.png','room','sendMail','bay','createTransport','$product_details.rack','</div>','$product_details.product_code','$product_details.product_name','$product_details.storage','Arabic','\x20Order\x20Date\x20:\x20','<tbody\x20style=\x22text-align:\x20center;\x22>','prod_cat','9zNwziV','$product_details.unit','log','redirect','getDate','$product_details._id','QA\x20Warehouse','product_name','json','findById','Secondary_units','aggregate','/view/:id','status','maxPerUnit','Router','Enclosed','True','port','secondary_unit','date','../middleware/auth','express','Hindi','\x20Order\x20Number\x20:\x20','image','$invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','get','22886677ZXYqtR','</thead>','1726017FCiFIc','product_code','$product_details.secondary_unit','1813bWWPnm','English\x20(US)','New_Qty_Converted','$product_details.maxProducts','$_id','There\x27s\x20a\x20error\x20in\x20this\x20transaction','password','English','$product_details.bay','</td>','exports','invoice','/picking_list/PDF_adjustment/','master','params'];a0_0x588d=function(){return _0x26a637;};return a0_0x588d();}function a0_0x2585(_0x2b61da,_0x545c37){var _0x588db7=a0_0x588d();return a0_0x2585=function(_0x258528,_0x351288){_0x258528=_0x258528-0xfe;var _0x324a25=_0x588db7[_0x258528];return _0x324a25;},a0_0x2585(_0x2b61da,_0x545c37);}router[a0_0x3ff847(0x118)](a0_0x3ff847(0x138),auth,async(_0x4c469c,_0xbfe653)=>{var _0x380c7d=a0_0x3ff847;try{const {username:_0x3fa35e,email:_0xd20a48,role:_0x1a1fd2}=_0x4c469c[_0x380c7d(0x12d)],_0x4de0c4=_0x4c469c['user'],_0x37086a=await profile[_0x380c7d(0x1a0)]({'email':_0x4de0c4[_0x380c7d(0x159)]}),_0x5b3a2a=await master_shop[_0x380c7d(0x141)]();let _0x1655a8;if(_0x4de0c4['role']==_0x380c7d(0x161)){const _0x2168d1=await staff[_0x380c7d(0x1a0)]({'email':_0x4de0c4[_0x380c7d(0x159)]});_0x1655a8=await warehouse[_0x380c7d(0x141)]({'status':'Enabled','name':_0x2168d1[_0x380c7d(0x164)]});}else _0x1655a8=await warehouse['find']({'status':_0x380c7d(0x15c)});const _0x18f420=await product[_0x380c7d(0x141)]();let _0x1b84e7;if(_0x4de0c4[_0x380c7d(0x1a7)]==_0x380c7d(0x161)){const _0x37bb87=await staff[_0x380c7d(0x1a0)]({'email':_0x4de0c4[_0x380c7d(0x159)]});_0x1b84e7=await adjustment_finished['find']({'warehouse_name':_0x37bb87[_0x380c7d(0x164)]});}else _0x1b84e7=await adjustment_finished[_0x380c7d(0x107)]([{'$unwind':_0x380c7d(0x171)},{'$group':{'_id':_0x380c7d(0x122),'invoice':{'$first':_0x380c7d(0x116)},'date':{'$first':'$date'},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x380c7d(0x154)},'finalize':{'$first':_0x380c7d(0x193)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x5b3a2a[0x0][_0x380c7d(0x18f)]==_0x380c7d(0x11f)){var _0x28b4b9=users['English'];console['log'](_0x28b4b9);}else{if(_0x5b3a2a[0x0][_0x380c7d(0x18f)]=='Hindi')var _0x28b4b9=users[_0x380c7d(0x113)];else{if(_0x5b3a2a[0x0][_0x380c7d(0x18f)]==_0x380c7d(0x192))var _0x28b4b9=users[_0x380c7d(0x192)];else{if(_0x5b3a2a[0x0][_0x380c7d(0x18f)]==_0x380c7d(0x12e))var _0x28b4b9=users[_0x380c7d(0x12e)];else{if(_0x5b3a2a[0x0][_0x380c7d(0x18f)]==_0x380c7d(0x145))var _0x28b4b9=users[_0x380c7d(0x145)];else{if(_0x5b3a2a[0x0]['language']=='Portuguese\x20(BR)')var _0x28b4b9=users['Portuguese'];else{if(_0x5b3a2a[0x0]['language']==_0x380c7d(0x19b))var _0x28b4b9=users['Chinese'];else{if(_0x5b3a2a[0x0]['language']==_0x380c7d(0x168))var _0x28b4b9=users[_0x380c7d(0x1c9)];}}}}}}}_0xbfe653['render'](_0x380c7d(0x15d),{'success':_0x4c469c['flash'](_0x380c7d(0x167)),'errors':_0x4c469c[_0x380c7d(0x140)]('errors'),'role':_0x4de0c4,'profile':_0x37086a,'warehouse':_0x1655a8,'product':_0x18f420,'adjustment':_0x1b84e7,'master_shop':_0x5b3a2a,'language':_0x28b4b9});}catch(_0x3c993a){console[_0x380c7d(0xfe)](_0x3c993a);}});async function getRandom8DigitNumber(){var _0x3719ba=a0_0x3ff847;const _0x150adb=0x989680,_0x5bbb06=0x5f5e0ff,_0x4c4818=Math[_0x3719ba(0x183)](Math[_0x3719ba(0x1b0)]()*(_0x5bbb06-_0x150adb+0x1))+_0x150adb;var _0x2fc5af;const _0x2f0608=await adjustment_finished[_0x3719ba(0x1a0)]({'invoice':_0x3719ba(0x19e)+_0x4c4818});return _0x2f0608&&_0x2f0608[_0x3719ba(0x172)]>0x0?_0x2fc5af=_0x3719ba(0x19e)+_0x4c4818:_0x2fc5af=_0x3719ba(0x19e)+_0x4c4818,_0x2fc5af;}router[a0_0x3ff847(0x118)](a0_0x3ff847(0x160),auth,async(_0x4c76c1,_0x2f4cef)=>{var _0x421403=a0_0x3ff847;try{const {username:_0x27411b,email:_0x5a7040,role:_0x454ada}=_0x4c76c1[_0x421403(0x12d)],_0x57fed0=_0x4c76c1['user'],_0x371d36=await profile[_0x421403(0x1a0)]({'email':_0x57fed0[_0x421403(0x159)]}),_0x1d56e4=await master_shop[_0x421403(0x141)]();let _0x62c6b1;if(_0x57fed0[_0x421403(0x1a7)]==_0x421403(0x161)){const _0x3924d8=await staff[_0x421403(0x1a0)]({'email':_0x57fed0[_0x421403(0x159)]});_0x62c6b1=await warehouse[_0x421403(0x107)]([{'$match':{'status':_0x421403(0x15c),'name':_0x3924d8['warehouse'],'warehouse_category':_0x421403(0x1a6),'name':{'$ne':_0x421403(0x102)}}},{'$group':{'_id':'$name','name':{'$first':_0x421403(0x149)}}}]);}else _0x62c6b1=await warehouse['aggregate']([{'$match':{'status':_0x421403(0x15c),'warehouse_category':_0x421403(0x1a6),'name':{'$ne':_0x421403(0x102)}}},{'$group':{'_id':_0x421403(0x149),'name':{'$first':_0x421403(0x149)}}}]);const _0x3ca357=await product[_0x421403(0x141)]({}),_0x5314e9=await adjustment_finished[_0x421403(0x141)]({}),_0xdc7b77=_0x5314e9[_0x421403(0x172)]+0x1,_0x99cbe3=_0x421403(0x19e)+_0xdc7b77['toString']()[_0x421403(0x146)](0x5,'0');var _0x3388cc=[_0x421403(0x198),_0x421403(0x10c),_0x421403(0x179)];if(_0x1d56e4[0x0][_0x421403(0x18f)]==_0x421403(0x11f))var _0x196060=users[_0x421403(0x125)];else{if(_0x1d56e4[0x0][_0x421403(0x18f)]==_0x421403(0x113))var _0x196060=users[_0x421403(0x113)];else{if(_0x1d56e4[0x0][_0x421403(0x18f)]==_0x421403(0x192))var _0x196060=users['German'];else{if(_0x1d56e4[0x0][_0x421403(0x18f)]=='Spanish')var _0x196060=users['Spanish'];else{if(_0x1d56e4[0x0]['language']==_0x421403(0x145))var _0x196060=users[_0x421403(0x145)];else{if(_0x1d56e4[0x0][_0x421403(0x18f)]==_0x421403(0x1b9))var _0x196060=users['Portuguese'];else{if(_0x1d56e4[0x0]['language']==_0x421403(0x19b))var _0x196060=users[_0x421403(0x19b)];else{if(_0x1d56e4[0x0]['language']=='Arabic\x20(ae)')var _0x196060=users[_0x421403(0x1c9)];}}}}}}}const _0x2a3fd2=getRandom8DigitNumber();_0x2a3fd2[_0x421403(0x17d)](_0x468665=>{var _0x4ef83e=_0x421403;_0x2f4cef[_0x4ef83e(0x1b8)](_0x4ef83e(0x1a3),{'success':_0x4c76c1[_0x4ef83e(0x140)](_0x4ef83e(0x167)),'errors':_0x4c76c1[_0x4ef83e(0x140)](_0x4ef83e(0x130)),'role':_0x57fed0,'profile':_0x371d36,'warehouse':_0x62c6b1,'product':_0x3ca357,'master_shop':_0x1d56e4,'language':_0x196060,'rooms_data':_0x3388cc,'invoice_no':_0x468665});})[_0x421403(0x181)](_0x4023ed=>{var _0x4c0362=_0x421403;_0x4c76c1[_0x4c0362(0x140)](_0x4c0362(0x130),_0x4c0362(0x123)),_0x2f4cef[_0x4c0362(0xff)]('/adjustment/view');});}catch(_0x14b817){console[_0x421403(0xfe)](_0x14b817);}}),router[a0_0x3ff847(0x1ba)](a0_0x3ff847(0x160),auth,async(_0x53a79e,_0x1ed7f3)=>{var _0x543f8e=a0_0x3ff847;try{const {warehouse_name:_0x295bfd,date:_0x49b105,prod_name:_0x1610f2,level:_0x316aab,isle:_0x2bd9a4,pallet:_0x717bd6,stock:_0x3a2a4e,types:_0x2645bb,adjust_qty:_0x3a7529,new_adjust_qty:_0x2d4d8c,note:_0x54a0f5,Room_name:_0x10c515,invoice:_0x57709d,JO_number:_0x21cc39,expiry_date:_0x17dc1f}=_0x53a79e[_0x543f8e(0x1b6)];if(typeof _0x1610f2==_0x543f8e(0x13a))var _0x97918e=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x133)]],_0x2131d7=[_0x53a79e[_0x543f8e(0x1b6)]['level']],_0xebd0ec=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x187)]],_0x361545=[_0x53a79e['body'][_0x543f8e(0x19a)]],_0x419ea1=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x16f)]],_0x1c5d76=[_0x53a79e[_0x543f8e(0x1b6)]['New_Qty_Converted']],_0x361b46=[_0x53a79e['body'][_0x543f8e(0x17e)]],_0x136269=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x106)]],_0x79860a=[_0x53a79e[_0x543f8e(0x1b6)]['prod_code']],_0x400e4b=[_0x53a79e['body'][_0x543f8e(0x188)]],_0x35a822=[_0x53a79e['body']['expiry_date']],_0x2f6e5b=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x19d)]],_0x2d9b99=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x1cc)]],_0x573814=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x1b3)]],_0x4aa348=[_0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x10a)]],_0x135720=[_0x53a79e[_0x543f8e(0x1b6)]['prod_invoice']];else var _0x97918e=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x133)]],_0x2131d7=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x16a)]],_0xebd0ec=[..._0x53a79e['body'][_0x543f8e(0x187)]],_0x361545=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x19a)]],_0x419ea1=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x16f)]],_0x1c5d76=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x120)]],_0x361b46=[..._0x53a79e[_0x543f8e(0x1b6)]['Primary_Units']],_0x136269=[..._0x53a79e[_0x543f8e(0x1b6)]['Secondary_units']],_0x79860a=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x182)]],_0x400e4b=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x188)]],_0x35a822=[..._0x53a79e[_0x543f8e(0x1b6)]['expiry_date']],_0x2f6e5b=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x19d)]],_0x2d9b99=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x1cc)]],_0x573814=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x1b3)]],_0x4aa348=[..._0x53a79e[_0x543f8e(0x1b6)]['maxPerUnit']],_0x135720=[..._0x53a79e[_0x543f8e(0x1b6)][_0x543f8e(0x13b)]];const _0x2b9eed=_0x97918e['map'](_0x24cc6d=>{return _0x24cc6d={'product_name':_0x24cc6d};});_0x2131d7[_0x543f8e(0x163)]((_0x234a83,_0x38bef4)=>{var _0x524c7d=_0x543f8e;_0x2b9eed[_0x38bef4][_0x524c7d(0x1c2)]=_0x234a83;}),_0xebd0ec[_0x543f8e(0x163)]((_0x45ef23,_0x165dbe)=>{var _0x122369=_0x543f8e;_0x2b9eed[_0x165dbe][_0x122369(0x14e)]=_0x45ef23;}),_0x361545['forEach']((_0x201200,_0x3ddf2e)=>{_0x2b9eed[_0x3ddf2e]['types']=_0x201200;}),_0x419ea1[_0x543f8e(0x163)]((_0x36cfea,_0x4badc9)=>{var _0x5de846=_0x543f8e;_0x2b9eed[_0x4badc9][_0x5de846(0x17b)]=_0x36cfea;}),_0x1c5d76['forEach']((_0x1db324,_0x158d06)=>{var _0x492ea3=_0x543f8e;_0x2b9eed[_0x158d06][_0x492ea3(0x177)]=_0x1db324;}),_0x361b46['forEach']((_0x7146,_0x18d847)=>{var _0x558c74=_0x543f8e;_0x2b9eed[_0x18d847][_0x558c74(0x184)]=_0x7146;}),_0x136269['forEach']((_0x24d853,_0x12f364)=>{_0x2b9eed[_0x12f364]['secondary_unit']=_0x24d853;}),_0x79860a[_0x543f8e(0x163)]((_0x23024b,_0x3dc0d7)=>{var _0x1bc5f9=_0x543f8e;_0x2b9eed[_0x3dc0d7][_0x1bc5f9(0x11c)]=_0x23024b;}),_0x400e4b[_0x543f8e(0x163)]((_0x333c73,_0x1f21a1)=>{var _0x379cf3=_0x543f8e;_0x2b9eed[_0x1f21a1][_0x379cf3(0x188)]=_0x333c73;}),_0x35a822[_0x543f8e(0x163)]((_0x1f9906,_0x3ecf95)=>{_0x2b9eed[_0x3ecf95]['expiry_date']=_0x1f9906;}),_0x2f6e5b[_0x543f8e(0x163)]((_0x34c696,_0x46c066)=>{var _0x3f23ad=_0x543f8e;_0x2b9eed[_0x46c066][_0x3f23ad(0x175)]=_0x34c696;}),_0x2d9b99[_0x543f8e(0x163)]((_0x2a1609,_0x169c08)=>{var _0x27ec2a=_0x543f8e;_0x2b9eed[_0x169c08][_0x27ec2a(0x1cc)]=_0x2a1609;}),_0x573814[_0x543f8e(0x163)]((_0x4e1fe4,_0x45c47d)=>{var _0x3cf693=_0x543f8e;_0x2b9eed[_0x45c47d][_0x3cf693(0x162)]=_0x4e1fe4;}),_0x4aa348[_0x543f8e(0x163)]((_0x11c298,_0x3ad20c)=>{var _0x3824d7=_0x543f8e;_0x2b9eed[_0x3ad20c][_0x3824d7(0x10a)]=_0x11c298;}),_0x135720['forEach']((_0x810a8,_0x3ff598)=>{var _0x346360=_0x543f8e;_0x2b9eed[_0x3ff598][_0x346360(0x129)]=_0x810a8;});const _0x74d3d=_0x2b9eed[_0x543f8e(0x157)](_0x497aef=>_0x497aef[_0x543f8e(0x17b)]!=='0'&&_0x497aef[_0x543f8e(0x17b)]!=='');var _0x32f0a2=0x0;_0x74d3d[_0x543f8e(0x163)](_0x3a2634=>{var _0x313920=_0x543f8e;console[_0x313920(0xfe)](_0x313920(0x14b),_0x3a2634),parseInt(_0x3a2634['adjust_qty'])<=0x0&&_0x32f0a2++;});if(_0x32f0a2!=0x0)return _0x53a79e[_0x543f8e(0x140)](_0x543f8e(0x130),_0x543f8e(0x15e)),_0x1ed7f3[_0x543f8e(0xff)](_0x543f8e(0x13e));const _0x348220=new adjustment_finished({'warehouse_name':_0x295bfd,'date':_0x49b105,'product':_0x74d3d,'note':_0x54a0f5,'room':_0x10c515,'invoice':_0x57709d,'JO_number':_0x21cc39,'expiry_date':_0x17dc1f}),_0x2a1001=await _0x348220[_0x543f8e(0x1b7)]();_0x53a79e['flash'](_0x543f8e(0x167),_0x543f8e(0x15a)),_0x1ed7f3['redirect']('/adjustment_finished/preview/'+_0x2a1001[_0x543f8e(0x196)]);}catch(_0x30ec09){console['log'](_0x30ec09),_0x1ed7f3[_0x543f8e(0x109)](0xc8)[_0x543f8e(0x104)]({'message':_0x30ec09[_0x543f8e(0x173)]});}}),router[a0_0x3ff847(0x118)](a0_0x3ff847(0x17f),auth,async(_0x4adea8,_0x499f0f)=>{var _0x577144=a0_0x3ff847;try{const {username:_0x11a23b,email:_0x5922fc,role:_0x41cd54}=_0x4adea8['user'],_0x1e535d=_0x4adea8['user'],_0x251196=await profile['findOne']({'email':_0x1e535d['email']}),_0x2b20c7=await master_shop[_0x577144(0x141)](),_0x28bd07=_0x4adea8[_0x577144(0x12c)]['id'],_0x1aa09a=await adjustment_finished['findById']({'_id':_0x28bd07}),_0xb4ad15=await purchases[_0x577144(0x107)]([{'$match':{'warehouse_name':_0x1aa09a['warehouse_name']}},{'$unwind':_0x577144(0x171)},{'$group':{'_id':_0x577144(0x15b)}}]);console[_0x577144(0xfe)](_0x577144(0x1a4),_0xb4ad15);const _0x19d945=await product[_0x577144(0x141)]({}),_0x543cfb=await warehouse[_0x577144(0x107)]([{'$match':{'name':_0x1aa09a[_0x577144(0x18b)],'warehouse_category':_0x577144(0x1a6)}},{'$unwind':_0x577144(0x16b)},{'$group':{'_id':_0x577144(0x101),'name':{'$first':_0x577144(0x1c7)},'product_stock':{'$first':_0x577144(0x150)},'bay':{'$first':_0x577144(0x126)},'bin':{'$first':_0x577144(0x16e)},'type':{'$first':_0x577144(0x14d)},'floorlevel':{'$first':_0x577144(0x195)},'primary_code':{'$first':_0x577144(0x1aa)},'secondary_code':{'$first':_0x577144(0x18a)},'product_code':{'$first':_0x577144(0x1c6)},'storage':{'$first':_0x577144(0x1c8)},'rack':{'$first':_0x577144(0x1c4)},'expiry_date':{'$first':_0x577144(0x134)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x577144(0x13f)},'maxPerUnit':{'$first':_0x577144(0x17a)},'room':{'$first':_0x577144(0x156)}}}]);if(_0x2b20c7[0x0][_0x577144(0x18f)]==_0x577144(0x11f)){var _0x41836e=users[_0x577144(0x125)];console[_0x577144(0xfe)](_0x41836e);}else{if(_0x2b20c7[0x0][_0x577144(0x18f)]==_0x577144(0x113))var _0x41836e=users['Hindi'];else{if(_0x2b20c7[0x0][_0x577144(0x18f)]==_0x577144(0x192))var _0x41836e=users[_0x577144(0x192)];else{if(_0x2b20c7[0x0]['language']=='Spanish')var _0x41836e=users[_0x577144(0x12e)];else{if(_0x2b20c7[0x0][_0x577144(0x18f)]==_0x577144(0x145))var _0x41836e=users[_0x577144(0x145)];else{if(_0x2b20c7[0x0][_0x577144(0x18f)]=='Portuguese\x20(BR)')var _0x41836e=users[_0x577144(0x137)];else{if(_0x2b20c7[0x0]['language']=='Chinese')var _0x41836e=users['Chinese'];else{if(_0x2b20c7[0x0][_0x577144(0x18f)]==_0x577144(0x168))var _0x41836e=users[_0x577144(0x1c9)];}}}}}}}_0x499f0f[_0x577144(0x1b8)](_0x577144(0x1b5),{'success':_0x4adea8[_0x577144(0x140)](_0x577144(0x167)),'errors':_0x4adea8['flash'](_0x577144(0x130)),'role':_0x1e535d,'profile':_0x251196,'adjustment':_0x1aa09a,'stock':_0x543cfb,'master_shop':_0x2b20c7,'warehouse_name':_0xb4ad15,'unit':_0x19d945,'language':_0x41836e});}catch(_0x2a98b1){console['log'](_0x2a98b1),_0x499f0f[_0x577144(0x109)](0xc8)[_0x577144(0x104)]({'message':_0x2a98b1[_0x577144(0x173)]});}}),router[a0_0x3ff847(0x1ba)](a0_0x3ff847(0x17f),auth,async(_0x24b174,_0x4a3a81)=>{var _0x192c76=a0_0x3ff847;try{const {invoice:_0x408dc4,warehouse_name:_0x112d52,Room_name:_0x32bd67}=_0x24b174[_0x192c76(0x1b6)],_0x533044=_0x24b174['params']['id'],_0x12a8ac=await adjustment_finished[_0x192c76(0x105)]({'_id':_0x533044});var _0x9fb6d0;const _0x222e0c=_0x12a8ac[_0x192c76(0x13d)][_0x192c76(0x144)](async _0x3c5e31=>{var _0x2a913f=_0x192c76;if(_0x3c5e31[_0x2a913f(0x17b)]>0x0){_0x9fb6d0=await warehouse[_0x2a913f(0x1a0)]({'name':_0x112d52,'room':_0x3c5e31[_0x2a913f(0x162)],'warehouse_category':_0x2a913f(0x1a6)});const _0xab6688=_0x9fb6d0[_0x2a913f(0x185)][_0x2a913f(0x144)](_0x124ddd=>{var _0x23cc39=_0x2a913f;console[_0x23cc39(0xfe)](_0x3c5e31[_0x23cc39(0x19a)]);if(_0x3c5e31[_0x23cc39(0x19a)]==_0x23cc39(0x190))_0x124ddd[_0x23cc39(0x103)]==_0x3c5e31[_0x23cc39(0x103)]&&_0x124ddd[_0x23cc39(0x1c2)]==_0x3c5e31[_0x23cc39(0x1c2)]&&_0x124ddd[_0x23cc39(0x142)]==_0x3c5e31[_0x23cc39(0x142)]&&_0x124ddd['production_date']==_0x3c5e31[_0x23cc39(0x175)]&&_0x124ddd[_0x23cc39(0x188)]==_0x3c5e31[_0x23cc39(0x188)]&&_0x124ddd[_0x23cc39(0x129)]==_0x3c5e31['invoice']&&(_0x124ddd[_0x23cc39(0x1a2)]=_0x124ddd[_0x23cc39(0x1a2)]-_0x3c5e31[_0x23cc39(0x17b)]);else _0x3c5e31[_0x23cc39(0x19a)]==_0x23cc39(0x178)&&(_0x124ddd[_0x23cc39(0x103)]==_0x3c5e31['product_name']&&_0x124ddd['bay']==_0x3c5e31[_0x23cc39(0x1c2)]&&_0x124ddd[_0x23cc39(0x142)]==_0x3c5e31[_0x23cc39(0x142)]&&_0x124ddd[_0x23cc39(0x175)]==_0x3c5e31[_0x23cc39(0x175)]&&_0x124ddd[_0x23cc39(0x188)]==_0x3c5e31[_0x23cc39(0x188)]&&_0x124ddd[_0x23cc39(0x129)]==_0x3c5e31['invoice']&&(_0x124ddd[_0x23cc39(0x1a2)]=_0x124ddd['product_stock']+_0x3c5e31['adjust_qty']));});}return _0x9fb6d0;});Promise[_0x192c76(0x12f)](_0x222e0c)[_0x192c76(0x17d)](async _0x4f8923=>{var _0x33b4e7=_0x192c76;try{for(const _0x117779 of _0x4f8923){await _0x117779[_0x33b4e7(0x1b7)]();}_0x12a8ac[_0x33b4e7(0x15f)]=_0x33b4e7(0x10d);const _0x2d72e1=await _0x12a8ac[_0x33b4e7(0x1b7)](),_0x5065f0=await master_shop[_0x33b4e7(0x141)](),_0x1639d8=await email_settings[_0x33b4e7(0x1a0)](),_0x57b89b=await supervisor_settings['find']();var _0x5978fb=_0x12a8ac['product'],_0x39adc5='',_0x47e583;for(_0x47e583 in _0x5978fb){var _0xf3df9c='FG';_0x12a8ac[_0x33b4e7(0x18b)]=='DRY\x20GOODS'&&(_0xf3df9c='DG'),_0x39adc5+=_0x33b4e7(0x147)+_0x33b4e7(0x174)+_0x5978fb[_0x47e583][_0x33b4e7(0x103)]+_0x33b4e7(0x127)+_0x33b4e7(0x174)+_0x5978fb[_0x47e583][_0x33b4e7(0x11c)]+'</td>'+_0x33b4e7(0x174)+_0x5978fb[_0x47e583][_0x33b4e7(0x17b)]+_0x33b4e7(0x127)+_0x33b4e7(0x174)+_0x5978fb[_0x47e583]['unit']+_0x33b4e7(0x127)+_0x33b4e7(0x174)+_0x5978fb[_0x47e583][_0x33b4e7(0x10f)]+_0x33b4e7(0x127)+_0x33b4e7(0x174)+_0x12a8ac['warehouse_name']+_0x33b4e7(0x127)+_0x33b4e7(0x174)+_0x5978fb[_0x47e583][_0x33b4e7(0x162)]+_0x33b4e7(0x127)+_0x33b4e7(0x174)+_0xf3df9c+_0x5978fb[_0x47e583][_0x33b4e7(0x1c2)]+_0x33b4e7(0x127)+'</tr>';}let _0x29130d=nodemailer[_0x33b4e7(0x1c3)]({'host':_0x1639d8[_0x33b4e7(0x189)],'port':Number(_0x1639d8[_0x33b4e7(0x10e)]),'secure':![],'auth':{'user':_0x1639d8[_0x33b4e7(0x159)],'pass':_0x1639d8[_0x33b4e7(0x124)]}}),_0x4b69a3={'from':_0x1639d8['email'],'to':_0x57b89b[0x0]['FGSEmail'],'subject':_0x33b4e7(0x199),'attachments':[{'filename':_0x33b4e7(0x1bf),'path':__dirname+'/../public'+_0x33b4e7(0x19c)+_0x5065f0[0x0][_0x33b4e7(0x115)],'cid':_0x33b4e7(0x1a8)}],'html':_0x33b4e7(0x169)+_0x33b4e7(0x1ad)+_0x33b4e7(0x1bb)+_0x33b4e7(0x1ac)+_0x33b4e7(0x117)+_0x33b4e7(0x1ac)+_0x33b4e7(0x1be)+_0x33b4e7(0x1c5)+'<div>'+_0x33b4e7(0x18d)+_0x5065f0[0x0][_0x33b4e7(0x165)]+_0x33b4e7(0x191)+_0x33b4e7(0x1c5)+'</div>'+_0x33b4e7(0x13c)+_0x33b4e7(0x1ac)+_0x33b4e7(0x176)+_0x33b4e7(0x114)+_0x12a8ac['invoice']+'\x20'+_0x33b4e7(0x1bc)+_0x33b4e7(0x1ca)+_0x12a8ac[_0x33b4e7(0x110)]+'\x20'+_0x33b4e7(0x194)+_0x33b4e7(0x151)+_0x33b4e7(0x1c5)+_0x33b4e7(0x1b1)+_0x33b4e7(0x19f)+'<tr>'+_0x33b4e7(0x1a1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x33b4e7(0x1ab)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x33b4e7(0x131)+_0x33b4e7(0x186)+_0x33b4e7(0x14a)+'</tr>'+_0x33b4e7(0x11a)+_0x33b4e7(0x1cb)+'\x20'+_0x39adc5+'\x20'+_0x33b4e7(0x148)+_0x33b4e7(0x16c)+_0x33b4e7(0x1ac)+_0x33b4e7(0x1a9)+_0x33b4e7(0x180)+_0x5065f0[0x0]['site_title']+_0x33b4e7(0x151)+_0x33b4e7(0x1c5)+_0x33b4e7(0x1c5)+_0x33b4e7(0x14f)};_0x29130d[_0x33b4e7(0x1c1)](_0x4b69a3,function(_0x158955,_0x4c1f2c){var _0x1b962e=_0x33b4e7;_0x158955?(console[_0x1b962e(0xfe)](_0x158955),console[_0x1b962e(0xfe)]('Error\x20Occurs')):console[_0x1b962e(0xfe)](_0x1b962e(0x1b2));}),_0x24b174[_0x33b4e7(0x140)](_0x33b4e7(0x167),'Adjustment\x20Finalize\x20Successfully'),_0x4a3a81[_0x33b4e7(0xff)](_0x33b4e7(0x12a)+_0x2d72e1['_id']);}catch(_0x2db8e0){console['error'](_0x2db8e0),_0x4a3a81[_0x33b4e7(0x109)](0x1f4)['json']({'error':_0x33b4e7(0x1ae)});}})['catch'](_0x2c73b5=>{var _0x468fbe=_0x192c76;console['error'](_0x2c73b5),_0x4a3a81[_0x468fbe(0x109)](0x1f4)['json']({'error':_0x468fbe(0x153)});});}catch(_0x5e338d){_0x4a3a81[_0x192c76(0x104)]({'message':_0x5e338d[_0x192c76(0x173)]});}}),router[a0_0x3ff847(0x118)](a0_0x3ff847(0x108),auth,async(_0x5cf638,_0x2fb0cd)=>{var _0x19ef09=a0_0x3ff847;try{const {username:_0x1b75c0,email:_0x3a0dd6,role:_0x5e5423}=_0x5cf638[_0x19ef09(0x12d)],_0x219165=_0x5cf638['user'],_0x301e8e=await profile[_0x19ef09(0x1a0)]({'email':_0x219165[_0x19ef09(0x159)]}),_0x5111b1=await master_shop[_0x19ef09(0x141)]();console[_0x19ef09(0xfe)](_0x19ef09(0x12b),_0x5111b1);const _0x3b7ea9=_0x5cf638[_0x19ef09(0x12c)]['id'],_0x1894ce=await adjustment_finished[_0x19ef09(0x105)]({'_id':_0x3b7ea9});let _0x41c8ab=new Date(_0x1894ce[_0x19ef09(0x142)]),_0x2ab91b=('0'+_0x41c8ab[_0x19ef09(0x100)]())['slice'](-0x2),_0x491911=('0'+(_0x41c8ab[_0x19ef09(0x135)]()+0x1))[_0x19ef09(0x132)](-0x2),_0x124a82=_0x41c8ab[_0x19ef09(0x158)](),_0x362b42=_0x124a82+'-'+_0x491911+'-'+_0x2ab91b;var _0x2506c9=['Ambient','Enclosed',_0x19ef09(0x179)];const _0x17ec3a=await purchases['aggregate']([{'$match':{'warehouse_name':_0x1894ce[_0x19ef09(0x18b)]}},{'$unwind':_0x19ef09(0x171)},{'$group':{'_id':_0x19ef09(0x15b)}}]);console[_0x19ef09(0xfe)](_0x19ef09(0x1a4),_0x17ec3a);const _0x3124d8=await product[_0x19ef09(0x141)]({}),_0xfe6872=await warehouse['aggregate']([{'$match':{'name':_0x1894ce[_0x19ef09(0x18b)],'room':_0x1894ce[_0x19ef09(0x1c0)]}},{'$unwind':_0x19ef09(0x16b)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x19ef09(0x1c7)},'product_stock':{'$first':_0x19ef09(0x150)},'bay':{'$first':_0x19ef09(0x126)},'bin':{'$first':_0x19ef09(0x16e)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x19ef09(0x195)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x19ef09(0x18a)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x19ef09(0x1c8)},'rack':{'$first':'$product_details.rack'}}}]);if(_0x5111b1[0x0]['language']==_0x19ef09(0x11f)){var _0x5eaed6=users[_0x19ef09(0x125)];console[_0x19ef09(0xfe)](_0x5eaed6);}else{if(_0x5111b1[0x0]['language']==_0x19ef09(0x113))var _0x5eaed6=users[_0x19ef09(0x113)];else{if(_0x5111b1[0x0][_0x19ef09(0x18f)]==_0x19ef09(0x192))var _0x5eaed6=users[_0x19ef09(0x192)];else{if(_0x5111b1[0x0]['language']==_0x19ef09(0x12e))var _0x5eaed6=users['Spanish'];else{if(_0x5111b1[0x0][_0x19ef09(0x18f)]==_0x19ef09(0x145))var _0x5eaed6=users[_0x19ef09(0x145)];else{if(_0x5111b1[0x0][_0x19ef09(0x18f)]==_0x19ef09(0x1b9))var _0x5eaed6=users[_0x19ef09(0x137)];else{if(_0x5111b1[0x0][_0x19ef09(0x18f)]=='Chinese')var _0x5eaed6=users['Chinese'];else{if(_0x5111b1[0x0][_0x19ef09(0x18f)]==_0x19ef09(0x168))var _0x5eaed6=users[_0x19ef09(0x1c9)];}}}}}}}_0x2fb0cd[_0x19ef09(0x1b8)](_0x19ef09(0x170),{'success':_0x5cf638[_0x19ef09(0x140)]('success'),'errors':_0x5cf638[_0x19ef09(0x140)](_0x19ef09(0x130)),'role':_0x219165,'profile':_0x301e8e,'adjustment':_0x1894ce,'stock':_0xfe6872,'master_shop':_0x5111b1,'warehouse_name':_0x17ec3a,'unit':_0x3124d8,'language':_0x5eaed6,'rooms_data':_0x2506c9,'ed_fullDate':_0x362b42});}catch(_0x5dfee5){console[_0x19ef09(0xfe)](_0x5dfee5),_0x2fb0cd['status'](0xc8)[_0x19ef09(0x104)]({'message':_0x5dfee5[_0x19ef09(0x173)]});}}),router[a0_0x3ff847(0x1ba)](a0_0x3ff847(0x108),auth,async(_0x7c5d77,_0x4fbb92)=>{var _0x3d2b0a=a0_0x3ff847;try{const _0x5bc323=_0x7c5d77[_0x3d2b0a(0x12c)]['id'],_0x20864a=await adjustment_finished[_0x3d2b0a(0x105)]({'_id':_0x5bc323}),_0x3027bf=await warehouse[_0x3d2b0a(0x1a0)]({'name':_0x20864a['warehouse_name'],'room':_0x20864a[_0x3d2b0a(0x1c0)]}),{warehouse_name:_0x3bea37,date:_0x3587f2,prod_name:_0x4eaef5,level:_0x27ef35,isle:_0x40e00a,pallet:_0x53331d,stock:_0x5eb0d8,types:_0x31d965,adjust_qty:_0x1ed593,new_adjust_qty:_0x350a1b,note:_0x4954ad,Room_name:_0x45c50c,invoice:_0x382e8f,JO_number:_0x581d3d}=_0x7c5d77[_0x3d2b0a(0x1b6)];if(typeof _0x4eaef5==_0x3d2b0a(0x13a))var _0x967974=[_0x7c5d77['body'][_0x3d2b0a(0x133)]],_0x205287=[_0x7c5d77[_0x3d2b0a(0x1b6)]['level']],_0x3b7406=[_0x7c5d77['body'][_0x3d2b0a(0x187)]],_0x573865=[_0x7c5d77['body'][_0x3d2b0a(0x19a)]],_0x1a42be=[_0x7c5d77['body'][_0x3d2b0a(0x17b)]],_0x28b149=[_0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x177)]],_0x57d5a9=[_0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x182)]],_0x1d0cbc=[_0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x184)]],_0x295b67=[_0x7c5d77[_0x3d2b0a(0x1b6)]['Secondary_units']],_0x1bc15b=[_0x7c5d77[_0x3d2b0a(0x1b6)]['batch_code']],_0x427e0c=[_0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x142)]];else var _0x967974=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x133)]],_0x205287=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x16a)]],_0x3b7406=[..._0x7c5d77[_0x3d2b0a(0x1b6)]['stock']],_0x573865=[..._0x7c5d77['body']['types']],_0x1a42be=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x17b)]],_0x28b149=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x177)]],_0x57d5a9=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x182)]],_0x1d0cbc=[..._0x7c5d77['body']['unit']],_0x295b67=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x106)]],_0x1bc15b=[..._0x7c5d77[_0x3d2b0a(0x1b6)][_0x3d2b0a(0x188)]],_0x427e0c=[..._0x7c5d77['body'][_0x3d2b0a(0x142)]];const _0x457f2a=_0x967974[_0x3d2b0a(0x144)](_0x4ab99b=>{return _0x4ab99b={'product_name':_0x4ab99b};});_0x205287[_0x3d2b0a(0x163)]((_0x2b0439,_0x522974)=>{var _0x3943b9=_0x3d2b0a;_0x457f2a[_0x522974][_0x3943b9(0x1c2)]=_0x2b0439;}),_0x3b7406['forEach']((_0x5e6fc3,_0x359fb3)=>{var _0x1ae3b5=_0x3d2b0a;_0x457f2a[_0x359fb3][_0x1ae3b5(0x14e)]=_0x5e6fc3;}),_0x573865['forEach']((_0x133326,_0x45451b)=>{var _0x42971b=_0x3d2b0a;_0x457f2a[_0x45451b][_0x42971b(0x19a)]=_0x133326;}),_0x1a42be[_0x3d2b0a(0x163)]((_0x55cfc2,_0x27a6ba)=>{_0x457f2a[_0x27a6ba]['adjust_qty']=_0x55cfc2;}),_0x28b149['forEach']((_0x5161b4,_0x2c2929)=>{var _0x491b96=_0x3d2b0a;_0x457f2a[_0x2c2929][_0x491b96(0x177)]=_0x5161b4;}),_0x1d0cbc[_0x3d2b0a(0x163)]((_0x744592,_0x58357a)=>{var _0x27bdd0=_0x3d2b0a;_0x457f2a[_0x58357a][_0x27bdd0(0x184)]=_0x744592;}),_0x295b67[_0x3d2b0a(0x163)]((_0x15f6f9,_0x3ff84c)=>{var _0x124dfa=_0x3d2b0a;_0x457f2a[_0x3ff84c][_0x124dfa(0x10f)]=_0x15f6f9;}),_0x57d5a9['forEach']((_0xe9ce26,_0x1961a1)=>{var _0x44fbc4=_0x3d2b0a;_0x457f2a[_0x1961a1][_0x44fbc4(0x11c)]=_0xe9ce26;}),_0x1bc15b[_0x3d2b0a(0x163)]((_0x1f5e87,_0x4f4aff)=>{var _0x342746=_0x3d2b0a;_0x457f2a[_0x4f4aff][_0x342746(0x188)]=_0x1f5e87;}),_0x427e0c[_0x3d2b0a(0x163)]((_0x5779a2,_0x3ac170)=>{var _0x491772=_0x3d2b0a;_0x457f2a[_0x3ac170][_0x491772(0x142)]=_0x5779a2;});const _0x3c378c=_0x457f2a[_0x3d2b0a(0x157)](_0x4c6210=>_0x4c6210[_0x3d2b0a(0x17b)]!=='0'&&_0x4c6210[_0x3d2b0a(0x17b)]!=='');var _0x3767cb=0x0;_0x3c378c[_0x3d2b0a(0x163)](_0x326550=>{var _0x1688a6=_0x3d2b0a;console[_0x1688a6(0xfe)]('foreach\x20newproduct',_0x326550),parseInt(_0x326550[_0x1688a6(0x17b)])<=0x0&&_0x3767cb++;});if(_0x3767cb!=0x0)return _0x7c5d77['flash'](_0x3d2b0a(0x130),_0x3d2b0a(0x15e)),_0x4fbb92[_0x3d2b0a(0xff)](_0x3d2b0a(0x13e));_0x20864a[_0x3d2b0a(0x18b)]=_0x3bea37,_0x20864a[_0x3d2b0a(0x110)]=_0x3587f2,_0x20864a[_0x3d2b0a(0x13d)]=_0x3c378c,_0x20864a['note']=_0x4954ad,_0x20864a[_0x3d2b0a(0x1c0)]=_0x45c50c,_0x20864a['invoice']=_0x382e8f,_0x20864a['JO_number']=_0x581d3d;const _0x14e6cd=await _0x20864a[_0x3d2b0a(0x1b7)](),_0x1f59d8=await warehouse[_0x3d2b0a(0x1a0)]({'name':_0x3bea37,'room':_0x45c50c});_0x14e6cd[_0x3d2b0a(0x13d)][_0x3d2b0a(0x163)](_0x4be6fc=>{var _0x9c2508=_0x3d2b0a;const _0x48f4b9=_0x1f59d8[_0x9c2508(0x185)][_0x9c2508(0x144)](_0x66d634=>{var _0x593a61=_0x9c2508;_0x4be6fc['types']=='minus'?_0x66d634['product_name']==_0x4be6fc[_0x593a61(0x103)]&&_0x66d634[_0x593a61(0x1c2)]==_0x4be6fc[_0x593a61(0x1c2)]&&(_0x66d634[_0x593a61(0x1a2)]=parseInt(_0x66d634['product_stock'])-parseInt(_0x4be6fc[_0x593a61(0x17b)])):_0x66d634['product_name']==_0x4be6fc[_0x593a61(0x103)]&&_0x66d634['bay']==_0x4be6fc['bay']&&(_0x66d634['product_stock']=parseInt(_0x66d634[_0x593a61(0x1a2)])+parseInt(_0x4be6fc[_0x593a61(0x17b)]));});}),await _0x1f59d8[_0x3d2b0a(0x1b7)](),_0x7c5d77[_0x3d2b0a(0x140)](_0x3d2b0a(0x167),_0x3d2b0a(0x155)),_0x4fbb92['redirect'](_0x3d2b0a(0x152));}catch(_0x56b1cf){console[_0x3d2b0a(0xfe)](_0x56b1cf);}}),router[a0_0x3ff847(0x1ba)](a0_0x3ff847(0x1bd),async(_0x31fc56,_0x4f9c78)=>{var _0x4d76ae=a0_0x3ff847;const {primary_code:_0x5f0432,warehouse_data:_0x91c9f4,rooms_data:_0x3272f7,Roomslist:_0x85c0db}=_0x31fc56['body'],_0x377b94=_0x85c0db[_0x4d76ae(0x14c)](','),_0x3e7f9c=[];async function _0x512778(_0x453582){var _0xddebe0=_0x4d76ae;const _0x25e779=await warehouse[_0xddebe0(0x107)]([{'$match':{'name':_0x91c9f4,'room':_0x453582}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x5f0432}},{'$group':{'_id':_0xddebe0(0x101),'name':{'$first':_0xddebe0(0x1c7)},'product_stock':{'$first':_0xddebe0(0x150)},'primary_code':{'$first':_0xddebe0(0x1aa)},'secondary_code':{'$first':_0xddebe0(0x18a)},'product_code':{'$first':_0xddebe0(0x1c6)},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0xddebe0(0x195)},'unit':{'$first':_0xddebe0(0x1ce)},'secondary_unit':{'$first':_0xddebe0(0x11d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xddebe0(0x1c4)},'expiry_date':{'$first':_0xddebe0(0x134)},'production_date':{'$first':_0xddebe0(0x197)},'batch_code':{'$first':_0xddebe0(0x13f)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0xddebe0(0x156)},'invoice':{'$first':_0xddebe0(0x18e)}}}]),_0x5e50ea=await warehouse[_0xddebe0(0x107)]([{'$match':{'name':_0x91c9f4,'room':_0x453582}},{'$unwind':_0xddebe0(0x16b)},{'$match':{'product_details.secondary_code':_0x5f0432}},{'$group':{'_id':_0xddebe0(0x101),'name':{'$first':_0xddebe0(0x1c7)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0xddebe0(0x18a)},'product_code':{'$first':_0xddebe0(0x1c6)},'level':{'$first':_0xddebe0(0x126)},'isle':{'$first':_0xddebe0(0x16e)},'type':{'$first':_0xddebe0(0x14d)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0xddebe0(0x1ce)},'secondary_unit':{'$first':_0xddebe0(0x11d)},'storage':{'$first':_0xddebe0(0x1c8)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0xddebe0(0x134)},'production_date':{'$first':_0xddebe0(0x197)},'batch_code':{'$first':_0xddebe0(0x13f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':'$room'},'invoice':{'$first':_0xddebe0(0x18e)}}}]);if(_0x25e779[_0xddebe0(0x172)]>0x0)_0x3e7f9c['push'](_0x25e779);else _0x5e50ea[_0xddebe0(0x172)]>0x0&&_0x3e7f9c[_0xddebe0(0x18c)](_0x5e50ea);}const _0x140dfe=_0x377b94[_0x4d76ae(0x144)](_0x51ce8e=>_0x512778(_0x51ce8e));await Promise[_0x4d76ae(0x12f)](_0x140dfe),_0x4f9c78[_0x4d76ae(0x104)](_0x3e7f9c);}),router['post']('/CheckingWarehouse',async(_0x45e5e4,_0xa8770)=>{var _0x2d66b9=a0_0x3ff847;const {productCode:_0x400066,bay:_0x5b104e,warehouses:_0x4cbb16,room:_0x372b61}=_0x45e5e4[_0x2d66b9(0x1b6)];console[_0x2d66b9(0xfe)](_0x45e5e4[_0x2d66b9(0x1b6)]);try{const _0x427628=await warehouse[_0x2d66b9(0x107)]([{'$match':{'name':_0x4cbb16,'room':_0x372b61}},{'$unwind':_0x2d66b9(0x16b)},{'$match':{'product_details.bay':parseInt(_0x5b104e)}},{'$group':{'_id':_0x2d66b9(0x101),'name':{'$first':_0x2d66b9(0x1c7)},'product_stock':{'$first':_0x2d66b9(0x150)},'bay':{'$first':_0x2d66b9(0x126)},'maxProducts':{'$first':_0x2d66b9(0x121)}}}]);_0xa8770[_0x2d66b9(0x109)](0xc8)[_0x2d66b9(0x104)](_0x427628);}catch(_0x1bc69b){_0xa8770[_0x2d66b9(0x109)](0x194)[_0x2d66b9(0x104)]({'message':_0x1bc69b[_0x2d66b9(0x173)]});}}),module[a0_0x3ff847(0x128)]=router;