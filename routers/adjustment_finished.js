var a0_0x11997e=a0_0x1206;(function(_0x1d8100,_0x187014){var _0x282f08=a0_0x1206,_0x384f19=_0x1d8100();while(!![]){try{var _0x33ec74=parseInt(_0x282f08(0x172))/0x1+-parseInt(_0x282f08(0x15e))/0x2+parseInt(_0x282f08(0x1b1))/0x3*(-parseInt(_0x282f08(0x185))/0x4)+parseInt(_0x282f08(0x1cd))/0x5*(parseInt(_0x282f08(0x13d))/0x6)+parseInt(_0x282f08(0x1c0))/0x7+parseInt(_0x282f08(0x14a))/0x8*(parseInt(_0x282f08(0x17c))/0x9)+-parseInt(_0x282f08(0x1e2))/0xa*(-parseInt(_0x282f08(0x197))/0xb);if(_0x33ec74===_0x187014)break;else _0x384f19['push'](_0x384f19['shift']());}catch(_0x1e2299){_0x384f19['push'](_0x384f19['shift']());}}}(a0_0x4284,0x4199b));const express=require(a0_0x11997e(0x156)),app=express(),router=express[a0_0x11997e(0x182)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x11997e(0x1e0)),users=require(a0_0x11997e(0x1c3)),nodemailer=require('nodemailer');router[a0_0x11997e(0x12e)](a0_0x11997e(0x198),auth,async(_0x12f6e0,_0x11016d)=>{var _0x44f88b=a0_0x11997e;try{const {username:_0x17c479,email:_0xe08e47,role:_0x3caf27}=_0x12f6e0['user'],_0x44b8a9=_0x12f6e0[_0x44f88b(0x196)],_0x190774=await profile['findOne']({'email':_0x44b8a9[_0x44f88b(0x12a)]}),_0x46982d=await master_shop[_0x44f88b(0x151)]();let _0x23e3fe;if(_0x44b8a9[_0x44f88b(0x124)]==_0x44f88b(0x131)){const _0x20f79b=await staff[_0x44f88b(0x166)]({'email':_0x44b8a9[_0x44f88b(0x12a)]});_0x23e3fe=await warehouse[_0x44f88b(0x151)]({'status':_0x44f88b(0x1db),'name':_0x20f79b['warehouse']});}else _0x23e3fe=await warehouse['find']({'status':'Enabled'});const _0x5be769=await product[_0x44f88b(0x151)]();let _0x154801;if(_0x44b8a9[_0x44f88b(0x124)]=='staff'){const _0x31223c=await staff[_0x44f88b(0x166)]({'email':_0x44b8a9[_0x44f88b(0x12a)]});_0x154801=await adjustment_finished[_0x44f88b(0x151)]({'warehouse_name':_0x31223c[_0x44f88b(0x134)]});}else _0x154801=await adjustment_finished[_0x44f88b(0x12d)]([{'$unwind':_0x44f88b(0x1ac)},{'$group':{'_id':_0x44f88b(0x1d0),'invoice':{'$first':'$invoice'},'date':{'$first':_0x44f88b(0x1aa)},'warehouse_name':{'$first':_0x44f88b(0x138)},'room':{'$addToSet':_0x44f88b(0x17e)},'finalize':{'$first':_0x44f88b(0x1d4)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x46982d[0x0]['language']==_0x44f88b(0x15a)){var _0x4e0fa6=users[_0x44f88b(0x191)];console['log'](_0x4e0fa6);}else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]==_0x44f88b(0x1cc))var _0x4e0fa6=users[_0x44f88b(0x1cc)];else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]=='German')var _0x4e0fa6=users['German'];else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]==_0x44f88b(0x1b5))var _0x4e0fa6=users[_0x44f88b(0x1b5)];else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]==_0x44f88b(0x1a5))var _0x4e0fa6=users[_0x44f88b(0x1a5)];else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]==_0x44f88b(0x15c))var _0x4e0fa6=users[_0x44f88b(0x180)];else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]=='Chinese')var _0x4e0fa6=users[_0x44f88b(0x133)];else{if(_0x46982d[0x0][_0x44f88b(0x1a7)]==_0x44f88b(0x195))var _0x4e0fa6=users['Arabic'];}}}}}}}_0x11016d[_0x44f88b(0x1b7)](_0x44f88b(0x194),{'success':_0x12f6e0[_0x44f88b(0x1b9)](_0x44f88b(0x199)),'errors':_0x12f6e0[_0x44f88b(0x1b9)](_0x44f88b(0x137)),'role':_0x44b8a9,'profile':_0x190774,'warehouse':_0x23e3fe,'product':_0x5be769,'adjustment':_0x154801,'master_shop':_0x46982d,'language':_0x4e0fa6});}catch(_0x1fcee5){console[_0x44f88b(0x168)](_0x1fcee5);}});function a0_0x4284(){var _0xad8108=['image','/CheckingWarehouse','/preview/:id','../models/all_models','/view/:id','176650sgPzCV','slice','unit','params','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','<strong>\x20Regards\x20</strong>','json','An\x20error\x20occurred.','role','Finished\x20Goods','post','$product_details.rack','<h2>\x20','date','email','/view/add_adjustment','foreach\x20newproduct','aggregate','get','$product_details.batch_code','</tr>','staff','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','Chinese','warehouse','prod_invoice','$product_details.expiry_date','errors','$warehouse_name','map','</h5>','split','warehouse_name','96FtsSuD','<html><head><title></title>','product_date','expiry_date','<!DOCTYPE\x20html>','QA\x20Warehouse','findById','$product_details.invoice','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','secondary_unit','\x20Order\x20Date\x20:\x20','toString','</thead>','24TMUWxO','<tr>','$product_details.storage','types','padStart','Email\x20sent\x20successfully','True','find','getMonth','$product_details.floorlevel','edit_adjustment_finished_view','forEach','express','string','sendMail','error','English\x20(US)','Arabic','Portuguese\x20(BR)','$product_details.product_code','620250UsSjJu','product_stock','bay','</tbody>','/../public','$product_details','/picking_list/PDF_adjustment/','$product_details._id','findOne','$product_details.product_name','log','all','new_adjust_qty','production_date','product_name','product_details','DRY\x20GOODS','then','$product_details.unit','New_Qty_Converted_adj','76381bCCNBG','Rooms','createTransport','prod_name','Secondary_units','body','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','$product_details.production_date','$product_details.product_stock','669303pVVcJr','$product_details.primary_code','$product.room_names','Return\x20Rooms','Portuguese','</div>','Router','$product.product_name','adjustment\x20data\x20update\x20successfully','8UmNhmp','getFullYear','Ambient','$name','German','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','filter','JO_number','floor','catch','$product_details.type','$product_details.bin','English','redirect','There\x27s\x20a\x20error\x20in\x20this\x20transaction','adjustment_finished','Arabic\x20(ae)','user','253NaAqno','/view','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','getDate','</table>','_id','batch_code','<h5>','adjust_qty','add_adjustment_finished','room_names','Adjustment\x20Finalize\x20Successfully','level','French','$room','language','Primary_Units','$product_details.bay','$date','status','$product','<div>','product_code','</span>','$product_details.maxPerUnit','710121UkaZlw','port','$product_details.secondary_code','\x20Order\x20Number\x20:\x20','Spanish','purchases_data','render','length','flash','push','</head><body>','edit_adjustment_finished','room','prod_cat','/upload/','312795IeqFuH','/barcode_scanner','random','../public/language/languages.json','back','stock','save','</td>','Enclosed','add','site_title','$product_details.secondary_unit','Hindi','94305FLczdX','maxPerUnit','<hr\x20class=\x22my-3\x22>','$_id','adjustment\x20add\x20successfull','invoice','minus','$finalize','Logo.png','Adjustment\x20Mail','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','ADJF-','New_Qty_Converted','prod_code','Enabled','product'];a0_0x4284=function(){return _0xad8108;};return a0_0x4284();}async function getRandom8DigitNumber(){var _0x249329=a0_0x11997e;const _0x4f8996=0x989680,_0x32da17=0x5f5e0ff,_0xdb2672=Math[_0x249329(0x18d)](Math[_0x249329(0x1c2)]()*(_0x32da17-_0x4f8996+0x1))+_0x4f8996;var _0xfbe884;const _0x58bce2=await adjustment_finished[_0x249329(0x166)]({'invoice':'ADJF-'+_0xdb2672});return _0x58bce2&&_0x58bce2[_0x249329(0x1b8)]>0x0?_0xfbe884=_0x249329(0x1d8)+_0xdb2672:_0xfbe884=_0x249329(0x1d8)+_0xdb2672,_0xfbe884;}function a0_0x1206(_0x3997d3,_0x1de8e8){var _0x428497=a0_0x4284();return a0_0x1206=function(_0x120657,_0x1e8c95){_0x120657=_0x120657-0x121;var _0x46829f=_0x428497[_0x120657];return _0x46829f;},a0_0x1206(_0x3997d3,_0x1de8e8);}router['get'](a0_0x11997e(0x12b),auth,async(_0x2527aa,_0x5b0929)=>{var _0x5ba749=a0_0x11997e;try{const {username:_0x38d222,email:_0x4eb8cc,role:_0x184caa}=_0x2527aa[_0x5ba749(0x196)],_0x40f6a0=_0x2527aa['user'],_0x465eb8=await profile[_0x5ba749(0x166)]({'email':_0x40f6a0[_0x5ba749(0x12a)]}),_0x1600f4=await master_shop[_0x5ba749(0x151)]();let _0xaf5f63;if(_0x40f6a0[_0x5ba749(0x124)]==_0x5ba749(0x131)){const _0x32dec3=await staff[_0x5ba749(0x166)]({'email':_0x40f6a0[_0x5ba749(0x12a)]});_0xaf5f63=await warehouse[_0x5ba749(0x12d)]([{'$match':{'status':_0x5ba749(0x1db),'name':_0x32dec3[_0x5ba749(0x134)],'warehouse_category':_0x5ba749(0x125),'name':{'$ne':_0x5ba749(0x142)}}},{'$group':{'_id':_0x5ba749(0x188),'name':{'$first':_0x5ba749(0x188)}}}]);}else _0xaf5f63=await warehouse[_0x5ba749(0x12d)]([{'$match':{'status':'Enabled','warehouse_category':_0x5ba749(0x125),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':'$name','name':{'$first':_0x5ba749(0x188)}}}]);const _0x165389=await product[_0x5ba749(0x151)]({}),_0x5570a0=await adjustment_finished[_0x5ba749(0x151)]({}),_0x5c8b39=_0x5570a0[_0x5ba749(0x1b8)]+0x1,_0x2f4786=_0x5ba749(0x1d8)+_0x5c8b39[_0x5ba749(0x148)]()[_0x5ba749(0x14e)](0x5,'0');var _0x3d3767=[_0x5ba749(0x187),_0x5ba749(0x1c8),'Return\x20Rooms'];if(_0x1600f4[0x0]['language']==_0x5ba749(0x15a))var _0x183e42=users['English'];else{if(_0x1600f4[0x0]['language']==_0x5ba749(0x1cc))var _0x183e42=users[_0x5ba749(0x1cc)];else{if(_0x1600f4[0x0][_0x5ba749(0x1a7)]=='German')var _0x183e42=users[_0x5ba749(0x189)];else{if(_0x1600f4[0x0][_0x5ba749(0x1a7)]==_0x5ba749(0x1b5))var _0x183e42=users[_0x5ba749(0x1b5)];else{if(_0x1600f4[0x0][_0x5ba749(0x1a7)]==_0x5ba749(0x1a5))var _0x183e42=users[_0x5ba749(0x1a5)];else{if(_0x1600f4[0x0][_0x5ba749(0x1a7)]=='Portuguese\x20(BR)')var _0x183e42=users['Portuguese'];else{if(_0x1600f4[0x0][_0x5ba749(0x1a7)]==_0x5ba749(0x133))var _0x183e42=users['Chinese'];else{if(_0x1600f4[0x0][_0x5ba749(0x1a7)]=='Arabic\x20(ae)')var _0x183e42=users[_0x5ba749(0x15b)];}}}}}}}const _0x276091=getRandom8DigitNumber();_0x276091[_0x5ba749(0x16f)](_0x58a233=>{var _0x41a1f3=_0x5ba749;_0x5b0929[_0x41a1f3(0x1b7)](_0x41a1f3(0x1a1),{'success':_0x2527aa[_0x41a1f3(0x1b9)]('success'),'errors':_0x2527aa[_0x41a1f3(0x1b9)](_0x41a1f3(0x137)),'role':_0x40f6a0,'profile':_0x465eb8,'warehouse':_0xaf5f63,'product':_0x165389,'master_shop':_0x1600f4,'language':_0x183e42,'rooms_data':_0x3d3767,'invoice_no':_0x58a233});})[_0x5ba749(0x18e)](_0x3ce08b=>{var _0x4d6ff4=_0x5ba749;_0x2527aa[_0x4d6ff4(0x1b9)](_0x4d6ff4(0x137),_0x4d6ff4(0x193)),_0x5b0929[_0x4d6ff4(0x192)]('/adjustment/view');});}catch(_0x17519c){console[_0x5ba749(0x168)](_0x17519c);}}),router[a0_0x11997e(0x126)](a0_0x11997e(0x12b),auth,async(_0x28ba0c,_0x52965b)=>{var _0x5df591=a0_0x11997e;try{const {warehouse_name:_0x2790f3,date:_0x35e717,prod_name:_0xca29ec,level:_0x26d12b,isle:_0xf51e4b,pallet:_0x410cee,stock:_0x290727,types:_0x2e2bb4,adjust_qty:_0x50f336,new_adjust_qty:_0x102f1b,note:_0x29f079,Room_name:_0x57bbfd,invoice:_0x124cb9,JO_number:_0x24e6d6,expiry_date:_0x4e6e69}=_0x28ba0c[_0x5df591(0x177)];if(typeof _0xca29ec==_0x5df591(0x157))var _0x16ffde=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x175)]],_0x2e5936=[_0x28ba0c['body'][_0x5df591(0x1a4)]],_0x1953e6=[_0x28ba0c[_0x5df591(0x177)]['stock']],_0x47ed8b=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x14d)]],_0x371392=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x171)]],_0x5edc6f=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1d9)]],_0x508081=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1a8)]],_0x589a78=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x176)]],_0x415a82=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1da)]],_0x573243=[_0x28ba0c['body'][_0x5df591(0x19e)]],_0x320302=[_0x28ba0c[_0x5df591(0x177)]['expiry_date']],_0x2fa883=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x13f)]],_0x4faf1b=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1be)]],_0x15c834=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x173)]],_0x46de1a=[_0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1ce)]],_0x56b17a=[_0x28ba0c[_0x5df591(0x177)]['prod_invoice']];else var _0x16ffde=[..._0x28ba0c[_0x5df591(0x177)][_0x5df591(0x175)]],_0x2e5936=[..._0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1a4)]],_0x1953e6=[..._0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1c5)]],_0x47ed8b=[..._0x28ba0c['body'][_0x5df591(0x14d)]],_0x371392=[..._0x28ba0c[_0x5df591(0x177)][_0x5df591(0x171)]],_0x5edc6f=[..._0x28ba0c['body'][_0x5df591(0x1d9)]],_0x508081=[..._0x28ba0c[_0x5df591(0x177)]['Primary_Units']],_0x589a78=[..._0x28ba0c[_0x5df591(0x177)]['Secondary_units']],_0x415a82=[..._0x28ba0c['body'][_0x5df591(0x1da)]],_0x573243=[..._0x28ba0c['body']['batch_code']],_0x320302=[..._0x28ba0c['body']['expiry_date']],_0x2fa883=[..._0x28ba0c[_0x5df591(0x177)][_0x5df591(0x13f)]],_0x4faf1b=[..._0x28ba0c[_0x5df591(0x177)]['prod_cat']],_0x15c834=[..._0x28ba0c['body']['Rooms']],_0x46de1a=[..._0x28ba0c[_0x5df591(0x177)][_0x5df591(0x1ce)]],_0x56b17a=[..._0x28ba0c['body'][_0x5df591(0x135)]];const _0x51ceec=_0x16ffde[_0x5df591(0x139)](_0x5be550=>{return _0x5be550={'product_name':_0x5be550};});_0x2e5936[_0x5df591(0x155)]((_0x321dc1,_0x337703)=>{_0x51ceec[_0x337703]['bay']=_0x321dc1;}),_0x1953e6[_0x5df591(0x155)]((_0x47d480,_0x3a9596)=>{_0x51ceec[_0x3a9596]['stockBefore']=_0x47d480;}),_0x47ed8b[_0x5df591(0x155)]((_0x52195b,_0x460d7c)=>{var _0x40e048=_0x5df591;_0x51ceec[_0x460d7c][_0x40e048(0x14d)]=_0x52195b;}),_0x371392['forEach']((_0x522eac,_0x140fc2)=>{var _0x5d4e24=_0x5df591;_0x51ceec[_0x140fc2][_0x5d4e24(0x1a0)]=_0x522eac;}),_0x5edc6f[_0x5df591(0x155)]((_0x344609,_0x740f4d)=>{var _0x1a854f=_0x5df591;_0x51ceec[_0x740f4d][_0x1a854f(0x16a)]=_0x344609;}),_0x508081[_0x5df591(0x155)]((_0x376af1,_0xd9282)=>{var _0x3788ab=_0x5df591;_0x51ceec[_0xd9282][_0x3788ab(0x1e4)]=_0x376af1;}),_0x589a78[_0x5df591(0x155)]((_0x353268,_0x20551d)=>{var _0xfcde08=_0x5df591;_0x51ceec[_0x20551d][_0xfcde08(0x146)]=_0x353268;}),_0x415a82['forEach']((_0xfa30ef,_0x28d8c3)=>{var _0xff4051=_0x5df591;_0x51ceec[_0x28d8c3][_0xff4051(0x1ae)]=_0xfa30ef;}),_0x573243[_0x5df591(0x155)]((_0x2463b4,_0x12d7e0)=>{var _0x46abea=_0x5df591;_0x51ceec[_0x12d7e0][_0x46abea(0x19e)]=_0x2463b4;}),_0x320302[_0x5df591(0x155)]((_0x3fb7f8,_0x33d98b)=>{var _0x2d14c2=_0x5df591;_0x51ceec[_0x33d98b][_0x2d14c2(0x140)]=_0x3fb7f8;}),_0x2fa883[_0x5df591(0x155)]((_0x43b1d5,_0x528a77)=>{var _0x3e2551=_0x5df591;_0x51ceec[_0x528a77][_0x3e2551(0x16b)]=_0x43b1d5;}),_0x4faf1b['forEach']((_0x5f094f,_0x7e113e)=>{var _0x22c9e6=_0x5df591;_0x51ceec[_0x7e113e][_0x22c9e6(0x1be)]=_0x5f094f;}),_0x15c834[_0x5df591(0x155)]((_0x5f36b2,_0x3ce7ff)=>{var _0x432f88=_0x5df591;_0x51ceec[_0x3ce7ff][_0x432f88(0x1a2)]=_0x5f36b2;}),_0x46de1a[_0x5df591(0x155)]((_0x406743,_0x37ef45)=>{var _0x642002=_0x5df591;_0x51ceec[_0x37ef45][_0x642002(0x1ce)]=_0x406743;}),_0x56b17a[_0x5df591(0x155)]((_0x37d581,_0x220cb6)=>{var _0x270141=_0x5df591;_0x51ceec[_0x220cb6][_0x270141(0x1d2)]=_0x37d581;});const _0x16336e=_0x51ceec[_0x5df591(0x18b)](_0x590364=>_0x590364['adjust_qty']!=='0'&&_0x590364[_0x5df591(0x1a0)]!=='');var _0x3e772c=0x0;_0x16336e[_0x5df591(0x155)](_0x336de6=>{var _0x263f55=_0x5df591;console['log'](_0x263f55(0x12c),_0x336de6),parseInt(_0x336de6[_0x263f55(0x1a0)])<=0x0&&_0x3e772c++;});if(_0x3e772c!=0x0)return _0x28ba0c['flash'](_0x5df591(0x137),_0x5df591(0x132)),_0x52965b[_0x5df591(0x192)](_0x5df591(0x1c4));const _0x2bf4e9=new adjustment_finished({'warehouse_name':_0x2790f3,'date':_0x35e717,'product':_0x16336e,'note':_0x29f079,'room':_0x57bbfd,'invoice':_0x124cb9,'JO_number':_0x24e6d6,'expiry_date':_0x4e6e69}),_0x3c0a1f=await _0x2bf4e9['save']();_0x28ba0c[_0x5df591(0x1b9)](_0x5df591(0x199),_0x5df591(0x1d1)),_0x52965b['redirect']('/adjustment_finished/preview/'+_0x3c0a1f[_0x5df591(0x19d)]);}catch(_0x543e4a){console[_0x5df591(0x168)](_0x543e4a),_0x52965b[_0x5df591(0x1ab)](0xc8)['json']({'message':_0x543e4a[_0x5df591(0x178)]});}}),router[a0_0x11997e(0x12e)]('/preview/:id',auth,async(_0xae6f99,_0x45b241)=>{var _0x35a8aa=a0_0x11997e;try{const {username:_0x26919f,email:_0x5a286c,role:_0x56dfc0}=_0xae6f99[_0x35a8aa(0x196)],_0x4f4bb3=_0xae6f99[_0x35a8aa(0x196)],_0x3781fd=await profile[_0x35a8aa(0x166)]({'email':_0x4f4bb3[_0x35a8aa(0x12a)]}),_0x3be9ef=await master_shop[_0x35a8aa(0x151)](),_0x13bdc1=_0xae6f99[_0x35a8aa(0x1e5)]['id'],_0xc3e0c4=await adjustment_finished[_0x35a8aa(0x143)]({'_id':_0x13bdc1}),_0x1594f3=await purchases[_0x35a8aa(0x12d)]([{'$match':{'warehouse_name':_0xc3e0c4[_0x35a8aa(0x13c)]}},{'$unwind':_0x35a8aa(0x1ac)},{'$group':{'_id':'$product.product_name'}}]);console[_0x35a8aa(0x168)](_0x35a8aa(0x1b6),_0x1594f3);const _0xcd0ae3=await product[_0x35a8aa(0x151)]({}),_0x9ad264=await warehouse[_0x35a8aa(0x12d)]([{'$match':{'name':_0xc3e0c4[_0x35a8aa(0x13c)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x35a8aa(0x163)},{'$group':{'_id':_0x35a8aa(0x165),'name':{'$first':_0x35a8aa(0x167)},'product_stock':{'$first':_0x35a8aa(0x17b)},'bay':{'$first':_0x35a8aa(0x1a9)},'bin':{'$first':_0x35a8aa(0x190)},'type':{'$first':_0x35a8aa(0x18f)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x35a8aa(0x17d)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x35a8aa(0x15d)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x35a8aa(0x127)},'expiry_date':{'$first':_0x35a8aa(0x136)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x35a8aa(0x12f)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x35a8aa(0x1a6)}}}]);if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]=='English\x20(US)'){var _0x13cd06=users[_0x35a8aa(0x191)];console['log'](_0x13cd06);}else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]==_0x35a8aa(0x1cc))var _0x13cd06=users[_0x35a8aa(0x1cc)];else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]==_0x35a8aa(0x189))var _0x13cd06=users['German'];else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]==_0x35a8aa(0x1b5))var _0x13cd06=users[_0x35a8aa(0x1b5)];else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]==_0x35a8aa(0x1a5))var _0x13cd06=users[_0x35a8aa(0x1a5)];else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]==_0x35a8aa(0x15c))var _0x13cd06=users['Portuguese'];else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]=='Chinese')var _0x13cd06=users[_0x35a8aa(0x133)];else{if(_0x3be9ef[0x0][_0x35a8aa(0x1a7)]=='Arabic\x20(ae)')var _0x13cd06=users[_0x35a8aa(0x15b)];}}}}}}}_0x45b241[_0x35a8aa(0x1b7)](_0x35a8aa(0x154),{'success':_0xae6f99[_0x35a8aa(0x1b9)]('success'),'errors':_0xae6f99[_0x35a8aa(0x1b9)](_0x35a8aa(0x137)),'role':_0x4f4bb3,'profile':_0x3781fd,'adjustment':_0xc3e0c4,'stock':_0x9ad264,'master_shop':_0x3be9ef,'warehouse_name':_0x1594f3,'unit':_0xcd0ae3,'language':_0x13cd06});}catch(_0x293621){console[_0x35a8aa(0x168)](_0x293621),_0x45b241[_0x35a8aa(0x1ab)](0xc8)['json']({'message':_0x293621[_0x35a8aa(0x178)]});}}),router['post'](a0_0x11997e(0x1df),auth,async(_0x686274,_0x250394)=>{var _0x13a8ef=a0_0x11997e;try{const {invoice:_0x134b08,warehouse_name:_0x2b9fba,Room_name:_0x22673c}=_0x686274['body'],_0x184adb=_0x686274[_0x13a8ef(0x1e5)]['id'],_0x129983=await adjustment_finished['findById']({'_id':_0x184adb});var _0x2fe165;const _0xdc36cf=_0x129983[_0x13a8ef(0x1dc)][_0x13a8ef(0x139)](async _0x49b22d=>{var _0x12e9e1=_0x13a8ef;if(_0x49b22d[_0x12e9e1(0x1a0)]>0x0){_0x2fe165=await warehouse['findOne']({'name':_0x2b9fba,'room':_0x49b22d[_0x12e9e1(0x1a2)],'warehouse_category':'Finished\x20Goods'});const _0xe9868e=_0x2fe165['product_details'][_0x12e9e1(0x139)](_0x44d127=>{var _0x77b660=_0x12e9e1;console['log'](_0x49b22d[_0x77b660(0x14d)]);if(_0x49b22d['types']==_0x77b660(0x1d3))_0x44d127[_0x77b660(0x16c)]==_0x49b22d['product_name']&&_0x44d127[_0x77b660(0x160)]==_0x49b22d[_0x77b660(0x160)]&&_0x44d127['expiry_date']==_0x49b22d[_0x77b660(0x140)]&&_0x44d127['production_date']==_0x49b22d[_0x77b660(0x16b)]&&_0x44d127[_0x77b660(0x19e)]==_0x49b22d[_0x77b660(0x19e)]&&_0x44d127[_0x77b660(0x1d2)]==_0x49b22d[_0x77b660(0x1d2)]&&(_0x44d127['product_stock']=_0x44d127['product_stock']-_0x49b22d[_0x77b660(0x1a0)]);else _0x49b22d[_0x77b660(0x14d)]==_0x77b660(0x1c9)&&(_0x44d127[_0x77b660(0x16c)]==_0x49b22d[_0x77b660(0x16c)]&&_0x44d127[_0x77b660(0x160)]==_0x49b22d['bay']&&_0x44d127[_0x77b660(0x140)]==_0x49b22d[_0x77b660(0x140)]&&_0x44d127['production_date']==_0x49b22d[_0x77b660(0x16b)]&&_0x44d127['batch_code']==_0x49b22d[_0x77b660(0x19e)]&&_0x44d127[_0x77b660(0x1d2)]==_0x49b22d['invoice']&&(_0x44d127[_0x77b660(0x15f)]=_0x44d127['product_stock']+_0x49b22d['adjust_qty']));});}return _0x2fe165;});Promise['all'](_0xdc36cf)[_0x13a8ef(0x16f)](async _0x13eab3=>{var _0x56c376=_0x13a8ef;try{for(const _0x3de8ea of _0x13eab3){await _0x3de8ea[_0x56c376(0x1c6)]();}_0x129983['finalize']=_0x56c376(0x150);const _0x4b3a65=await _0x129983['save'](),_0x593e59=await master_shop[_0x56c376(0x151)](),_0x23876c=await email_settings[_0x56c376(0x166)](),_0x3e329f=await supervisor_settings['find']();var _0x1e4c67=_0x129983['product'],_0x33ceeb='',_0x1b9f2e;for(_0x1b9f2e in _0x1e4c67){var _0x4bcdd2='FG';_0x129983[_0x56c376(0x13c)]==_0x56c376(0x16e)&&(_0x4bcdd2='DG'),_0x33ceeb+=_0x56c376(0x14b)+_0x56c376(0x1e6)+_0x1e4c67[_0x1b9f2e]['product_name']+_0x56c376(0x1c7)+_0x56c376(0x1e6)+_0x1e4c67[_0x1b9f2e][_0x56c376(0x1ae)]+_0x56c376(0x1c7)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1e4c67[_0x1b9f2e][_0x56c376(0x1a0)]+_0x56c376(0x1c7)+_0x56c376(0x1e6)+_0x1e4c67[_0x1b9f2e][_0x56c376(0x1e4)]+_0x56c376(0x1c7)+_0x56c376(0x1e6)+_0x1e4c67[_0x1b9f2e][_0x56c376(0x146)]+'</td>'+_0x56c376(0x1e6)+_0x129983[_0x56c376(0x13c)]+_0x56c376(0x1c7)+_0x56c376(0x1e6)+_0x1e4c67[_0x1b9f2e][_0x56c376(0x1a2)]+_0x56c376(0x1c7)+_0x56c376(0x1e6)+_0x4bcdd2+_0x1e4c67[_0x1b9f2e][_0x56c376(0x160)]+_0x56c376(0x1c7)+_0x56c376(0x130);}let _0x26bf33=nodemailer[_0x56c376(0x174)]({'host':_0x23876c['host'],'port':Number(_0x23876c[_0x56c376(0x1b2)]),'secure':![],'auth':{'user':_0x23876c[_0x56c376(0x12a)],'pass':_0x23876c['password']}}),_0x25c451={'from':_0x23876c[_0x56c376(0x12a)],'to':_0x3e329f[0x0]['FGSEmail'],'subject':_0x56c376(0x1d6),'attachments':[{'filename':_0x56c376(0x1d5),'path':__dirname+_0x56c376(0x162)+_0x56c376(0x1bf)+_0x593e59[0x0][_0x56c376(0x1dd)],'cid':'logo'}],'html':_0x56c376(0x141)+_0x56c376(0x13e)+_0x56c376(0x1bb)+'<div>'+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+'<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>'+'</div>'+_0x56c376(0x1ad)+_0x56c376(0x128)+_0x593e59[0x0][_0x56c376(0x1ca)]+'\x20</h2>'+_0x56c376(0x181)+_0x56c376(0x181)+_0x56c376(0x1cf)+_0x56c376(0x1ad)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x56c376(0x1b4)+_0x129983['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x56c376(0x147)+_0x129983[_0x56c376(0x129)]+'\x20'+_0x56c376(0x1af)+_0x56c376(0x13a)+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x56c376(0x145)+_0x56c376(0x14b)+_0x56c376(0x18a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+_0x56c376(0x1d7)+_0x56c376(0x19a)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x56c376(0x179)+_0x56c376(0x130)+_0x56c376(0x149)+'<tbody\x20style=\x22text-align:\x20center;\x22>'+'\x20'+_0x33ceeb+'\x20'+_0x56c376(0x161)+_0x56c376(0x19c)+'<div>'+_0x56c376(0x121)+_0x56c376(0x19f)+_0x593e59[0x0]['site_title']+_0x56c376(0x13a)+'</div>'+_0x56c376(0x181)+'</body></html>'};_0x26bf33[_0x56c376(0x158)](_0x25c451,function(_0x4033eb,_0x4a8cbc){var _0x830902=_0x56c376;_0x4033eb?(console['log'](_0x4033eb),console[_0x830902(0x168)]('Error\x20Occurs')):console['log'](_0x830902(0x14f));}),_0x686274[_0x56c376(0x1b9)](_0x56c376(0x199),_0x56c376(0x1a3)),_0x250394[_0x56c376(0x192)](_0x56c376(0x164)+_0x4b3a65[_0x56c376(0x19d)]);}catch(_0x551256){console[_0x56c376(0x159)](_0x551256),_0x250394['status'](0x1f4)[_0x56c376(0x122)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x13a8ef(0x18e)](_0x168efe=>{var _0x37307c=_0x13a8ef;console['error'](_0x168efe),_0x250394[_0x37307c(0x1ab)](0x1f4)['json']({'error':_0x37307c(0x123)});});}catch(_0x2397a5){_0x250394[_0x13a8ef(0x122)]({'message':_0x2397a5[_0x13a8ef(0x178)]});}}),router['get'](a0_0x11997e(0x1e1),auth,async(_0x105ac5,_0x3e1ed9)=>{var _0x41e17e=a0_0x11997e;try{const {username:_0x37eb93,email:_0x522175,role:_0x59740d}=_0x105ac5[_0x41e17e(0x196)],_0x433161=_0x105ac5[_0x41e17e(0x196)],_0x5a72ba=await profile[_0x41e17e(0x166)]({'email':_0x433161[_0x41e17e(0x12a)]}),_0x47cb11=await master_shop['find']();console[_0x41e17e(0x168)]('master',_0x47cb11);const _0x59ac7f=_0x105ac5[_0x41e17e(0x1e5)]['id'],_0x2bc8a8=await adjustment_finished['findById']({'_id':_0x59ac7f});let _0x15b200=new Date(_0x2bc8a8[_0x41e17e(0x140)]),_0x4c1a56=('0'+_0x15b200[_0x41e17e(0x19b)]())[_0x41e17e(0x1e3)](-0x2),_0x4ed30b=('0'+(_0x15b200[_0x41e17e(0x152)]()+0x1))[_0x41e17e(0x1e3)](-0x2),_0x503ee0=_0x15b200[_0x41e17e(0x186)](),_0x2ff6f2=_0x503ee0+'-'+_0x4ed30b+'-'+_0x4c1a56;var _0x54d5c4=[_0x41e17e(0x187),'Enclosed',_0x41e17e(0x17f)];const _0x368d43=await purchases[_0x41e17e(0x12d)]([{'$match':{'warehouse_name':_0x2bc8a8['warehouse_name']}},{'$unwind':_0x41e17e(0x1ac)},{'$group':{'_id':_0x41e17e(0x183)}}]);console[_0x41e17e(0x168)](_0x41e17e(0x1b6),_0x368d43);const _0x3fdcba=await product[_0x41e17e(0x151)]({}),_0x3c8698=await warehouse[_0x41e17e(0x12d)]([{'$match':{'name':_0x2bc8a8[_0x41e17e(0x13c)],'room':_0x2bc8a8['room']}},{'$unwind':_0x41e17e(0x163)},{'$group':{'_id':_0x41e17e(0x165),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x41e17e(0x17b)},'bay':{'$first':_0x41e17e(0x1a9)},'bin':{'$first':_0x41e17e(0x190)},'type':{'$first':_0x41e17e(0x18f)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x41e17e(0x17d)},'secondary_code':{'$first':_0x41e17e(0x1b3)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x41e17e(0x14c)},'rack':{'$first':_0x41e17e(0x127)}}}]);if(_0x47cb11[0x0][_0x41e17e(0x1a7)]==_0x41e17e(0x15a)){var _0x2f9946=users[_0x41e17e(0x191)];console[_0x41e17e(0x168)](_0x2f9946);}else{if(_0x47cb11[0x0]['language']==_0x41e17e(0x1cc))var _0x2f9946=users[_0x41e17e(0x1cc)];else{if(_0x47cb11[0x0]['language']==_0x41e17e(0x189))var _0x2f9946=users[_0x41e17e(0x189)];else{if(_0x47cb11[0x0][_0x41e17e(0x1a7)]=='Spanish')var _0x2f9946=users['Spanish'];else{if(_0x47cb11[0x0][_0x41e17e(0x1a7)]=='French')var _0x2f9946=users[_0x41e17e(0x1a5)];else{if(_0x47cb11[0x0][_0x41e17e(0x1a7)]==_0x41e17e(0x15c))var _0x2f9946=users[_0x41e17e(0x180)];else{if(_0x47cb11[0x0][_0x41e17e(0x1a7)]==_0x41e17e(0x133))var _0x2f9946=users[_0x41e17e(0x133)];else{if(_0x47cb11[0x0][_0x41e17e(0x1a7)]==_0x41e17e(0x195))var _0x2f9946=users[_0x41e17e(0x15b)];}}}}}}}_0x3e1ed9[_0x41e17e(0x1b7)](_0x41e17e(0x1bc),{'success':_0x105ac5['flash'](_0x41e17e(0x199)),'errors':_0x105ac5['flash']('errors'),'role':_0x433161,'profile':_0x5a72ba,'adjustment':_0x2bc8a8,'stock':_0x3c8698,'master_shop':_0x47cb11,'warehouse_name':_0x368d43,'unit':_0x3fdcba,'language':_0x2f9946,'rooms_data':_0x54d5c4,'ed_fullDate':_0x2ff6f2});}catch(_0x47759f){console[_0x41e17e(0x168)](_0x47759f),_0x3e1ed9['status'](0xc8)[_0x41e17e(0x122)]({'message':_0x47759f[_0x41e17e(0x178)]});}}),router[a0_0x11997e(0x126)](a0_0x11997e(0x1e1),auth,async(_0x2ef4bf,_0x23b7e4)=>{var _0x293017=a0_0x11997e;try{const _0x1635a8=_0x2ef4bf[_0x293017(0x1e5)]['id'],_0xba525a=await adjustment_finished[_0x293017(0x143)]({'_id':_0x1635a8}),_0x1fbe37=await warehouse['findOne']({'name':_0xba525a[_0x293017(0x13c)],'room':_0xba525a[_0x293017(0x1bd)]}),{warehouse_name:_0x25ea26,date:_0x363969,prod_name:_0x2f81ab,level:_0x59265c,isle:_0x1b0972,pallet:_0xb3c4b1,stock:_0x4bd0f2,types:_0x44032f,adjust_qty:_0x487a67,new_adjust_qty:_0x3ddec1,note:_0x35bc00,Room_name:_0xd8d23d,invoice:_0x2b44a6,JO_number:_0x229f82}=_0x2ef4bf[_0x293017(0x177)];if(typeof _0x2f81ab==_0x293017(0x157))var _0x374756=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x175)]],_0x2e40d6=[_0x2ef4bf['body'][_0x293017(0x1a4)]],_0x986f42=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x1c5)]],_0x36e832=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x14d)]],_0x3cf15b=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x1a0)]],_0x123a62=[_0x2ef4bf['body'][_0x293017(0x16a)]],_0x497273=[_0x2ef4bf['body'][_0x293017(0x1da)]],_0x2745f9=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x1e4)]],_0x10bf17=[_0x2ef4bf[_0x293017(0x177)]['Secondary_units']],_0x1a0e9b=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x19e)]],_0x4e9547=[_0x2ef4bf[_0x293017(0x177)][_0x293017(0x140)]];else var _0x374756=[..._0x2ef4bf[_0x293017(0x177)][_0x293017(0x175)]],_0x2e40d6=[..._0x2ef4bf[_0x293017(0x177)][_0x293017(0x1a4)]],_0x986f42=[..._0x2ef4bf['body'][_0x293017(0x1c5)]],_0x36e832=[..._0x2ef4bf[_0x293017(0x177)]['types']],_0x3cf15b=[..._0x2ef4bf['body'][_0x293017(0x1a0)]],_0x123a62=[..._0x2ef4bf[_0x293017(0x177)][_0x293017(0x16a)]],_0x497273=[..._0x2ef4bf[_0x293017(0x177)]['prod_code']],_0x2745f9=[..._0x2ef4bf[_0x293017(0x177)]['unit']],_0x10bf17=[..._0x2ef4bf['body'][_0x293017(0x176)]],_0x1a0e9b=[..._0x2ef4bf[_0x293017(0x177)]['batch_code']],_0x4e9547=[..._0x2ef4bf[_0x293017(0x177)][_0x293017(0x140)]];const _0x33f0b2=_0x374756[_0x293017(0x139)](_0x34fc0c=>{return _0x34fc0c={'product_name':_0x34fc0c};});_0x2e40d6[_0x293017(0x155)]((_0x18ce98,_0x8b786e)=>{_0x33f0b2[_0x8b786e]['bay']=_0x18ce98;}),_0x986f42[_0x293017(0x155)]((_0x43cae4,_0x241edf)=>{_0x33f0b2[_0x241edf]['stockBefore']=_0x43cae4;}),_0x36e832[_0x293017(0x155)]((_0x417c4c,_0x414e58)=>{_0x33f0b2[_0x414e58]['types']=_0x417c4c;}),_0x3cf15b['forEach']((_0x4acf2b,_0x291c66)=>{_0x33f0b2[_0x291c66]['adjust_qty']=_0x4acf2b;}),_0x123a62[_0x293017(0x155)]((_0x2b76f1,_0xa84940)=>{var _0x3282c2=_0x293017;_0x33f0b2[_0xa84940][_0x3282c2(0x16a)]=_0x2b76f1;}),_0x2745f9['forEach']((_0x25fe1b,_0x540418)=>{var _0x57012a=_0x293017;_0x33f0b2[_0x540418][_0x57012a(0x1e4)]=_0x25fe1b;}),_0x10bf17[_0x293017(0x155)]((_0x374dc0,_0xfe55ae)=>{var _0xd5274d=_0x293017;_0x33f0b2[_0xfe55ae][_0xd5274d(0x146)]=_0x374dc0;}),_0x497273[_0x293017(0x155)]((_0x308006,_0x1e6df9)=>{var _0x21ca49=_0x293017;_0x33f0b2[_0x1e6df9][_0x21ca49(0x1ae)]=_0x308006;}),_0x1a0e9b[_0x293017(0x155)]((_0x4de13b,_0x596d4a)=>{var _0x44f165=_0x293017;_0x33f0b2[_0x596d4a][_0x44f165(0x19e)]=_0x4de13b;}),_0x4e9547[_0x293017(0x155)]((_0x7faa98,_0x595740)=>{var _0x4ef71b=_0x293017;_0x33f0b2[_0x595740][_0x4ef71b(0x140)]=_0x7faa98;});const _0x1dfe64=_0x33f0b2['filter'](_0x15b74d=>_0x15b74d[_0x293017(0x1a0)]!=='0'&&_0x15b74d['adjust_qty']!=='');var _0x353b9f=0x0;_0x1dfe64[_0x293017(0x155)](_0x42172e=>{var _0x31db38=_0x293017;console[_0x31db38(0x168)](_0x31db38(0x12c),_0x42172e),parseInt(_0x42172e['adjust_qty'])<=0x0&&_0x353b9f++;});if(_0x353b9f!=0x0)return _0x2ef4bf[_0x293017(0x1b9)](_0x293017(0x137),_0x293017(0x132)),_0x23b7e4[_0x293017(0x192)](_0x293017(0x1c4));_0xba525a[_0x293017(0x13c)]=_0x25ea26,_0xba525a['date']=_0x363969,_0xba525a[_0x293017(0x1dc)]=_0x1dfe64,_0xba525a['note']=_0x35bc00,_0xba525a[_0x293017(0x1bd)]=_0xd8d23d,_0xba525a[_0x293017(0x1d2)]=_0x2b44a6,_0xba525a[_0x293017(0x18c)]=_0x229f82;const _0x936e1e=await _0xba525a['save'](),_0x3486f5=await warehouse[_0x293017(0x166)]({'name':_0x25ea26,'room':_0xd8d23d});_0x936e1e[_0x293017(0x1dc)][_0x293017(0x155)](_0x43a38a=>{var _0x1a7fa1=_0x293017;const _0x4834be=_0x3486f5[_0x1a7fa1(0x16d)][_0x1a7fa1(0x139)](_0x1f057d=>{var _0x508d44=_0x1a7fa1;_0x43a38a['types']=='minus'?_0x1f057d[_0x508d44(0x16c)]==_0x43a38a['product_name']&&_0x1f057d['bay']==_0x43a38a['bay']&&(_0x1f057d[_0x508d44(0x15f)]=parseInt(_0x1f057d[_0x508d44(0x15f)])-parseInt(_0x43a38a[_0x508d44(0x1a0)])):_0x1f057d['product_name']==_0x43a38a['product_name']&&_0x1f057d[_0x508d44(0x160)]==_0x43a38a['bay']&&(_0x1f057d[_0x508d44(0x15f)]=parseInt(_0x1f057d['product_stock'])+parseInt(_0x43a38a['adjust_qty']));});}),await _0x3486f5[_0x293017(0x1c6)](),_0x2ef4bf[_0x293017(0x1b9)](_0x293017(0x199),_0x293017(0x184)),_0x23b7e4[_0x293017(0x192)]('/adjustment_finished/view');}catch(_0x2e04d6){console['log'](_0x2e04d6);}}),router['post'](a0_0x11997e(0x1c1),async(_0x5873a5,_0x41d40a)=>{var _0x77dfc3=a0_0x11997e;const {primary_code:_0x21977c,warehouse_data:_0x23c4b8,rooms_data:_0x103af8,Roomslist:_0x599f7c}=_0x5873a5[_0x77dfc3(0x177)],_0x2a60c0=_0x599f7c[_0x77dfc3(0x13b)](','),_0x424355=[];async function _0x5a1635(_0x4af105){var _0x580552=_0x77dfc3;const _0x699c75=await warehouse['aggregate']([{'$match':{'name':_0x23c4b8,'room':_0x4af105}},{'$unwind':_0x580552(0x163)},{'$match':{'product_details.primary_code':_0x21977c}},{'$group':{'_id':_0x580552(0x165),'name':{'$first':_0x580552(0x167)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x580552(0x17d)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x580552(0x15d)},'level':{'$first':_0x580552(0x1a9)},'isle':{'$first':_0x580552(0x190)},'type':{'$first':_0x580552(0x18f)},'pallet':{'$first':_0x580552(0x153)},'unit':{'$first':_0x580552(0x170)},'secondary_unit':{'$first':_0x580552(0x1cb)},'storage':{'$first':_0x580552(0x14c)},'rack':{'$first':_0x580552(0x127)},'expiry_date':{'$first':_0x580552(0x136)},'production_date':{'$first':_0x580552(0x17a)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x580552(0x1b0)},'roomNamed':{'$first':_0x580552(0x1a6)},'invoice':{'$first':_0x580552(0x144)}}}]),_0x25e6fe=await warehouse['aggregate']([{'$match':{'name':_0x23c4b8,'room':_0x4af105}},{'$unwind':_0x580552(0x163)},{'$match':{'product_details.secondary_code':_0x21977c}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x580552(0x167)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x580552(0x17d)},'secondary_code':{'$first':_0x580552(0x1b3)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x580552(0x1a9)},'isle':{'$first':_0x580552(0x190)},'type':{'$first':_0x580552(0x18f)},'pallet':{'$first':_0x580552(0x153)},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x580552(0x1cb)},'storage':{'$first':_0x580552(0x14c)},'rack':{'$first':_0x580552(0x127)},'expiry_date':{'$first':_0x580552(0x136)},'production_date':{'$first':_0x580552(0x17a)},'batch_code':{'$first':_0x580552(0x12f)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x580552(0x1b0)},'roomNamed':{'$first':_0x580552(0x1a6)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x699c75['length']>0x0)_0x424355['push'](_0x699c75);else _0x25e6fe['length']>0x0&&_0x424355[_0x580552(0x1ba)](_0x25e6fe);}const _0x405629=_0x2a60c0[_0x77dfc3(0x139)](_0x60fc4d=>_0x5a1635(_0x60fc4d));await Promise[_0x77dfc3(0x169)](_0x405629),_0x41d40a[_0x77dfc3(0x122)](_0x424355);}),router[a0_0x11997e(0x126)](a0_0x11997e(0x1de),async(_0x352ec1,_0xd15c4e)=>{var _0x6e6cf=a0_0x11997e;const {productCode:_0x161ae9,bay:_0x197eeb,warehouses:_0x4f1f1a,room:_0x3a87bb}=_0x352ec1['body'];console[_0x6e6cf(0x168)](_0x352ec1[_0x6e6cf(0x177)]);try{const _0x4d5cdf=await warehouse[_0x6e6cf(0x12d)]([{'$match':{'name':_0x4f1f1a,'room':_0x3a87bb}},{'$unwind':_0x6e6cf(0x163)},{'$match':{'product_details.bay':parseInt(_0x197eeb)}},{'$group':{'_id':_0x6e6cf(0x165),'name':{'$first':_0x6e6cf(0x167)},'product_stock':{'$first':_0x6e6cf(0x17b)},'bay':{'$first':_0x6e6cf(0x1a9)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xd15c4e[_0x6e6cf(0x1ab)](0xc8)[_0x6e6cf(0x122)](_0x4d5cdf);}catch(_0xc9ebdb){_0xd15c4e[_0x6e6cf(0x1ab)](0x194)[_0x6e6cf(0x122)]({'message':_0xc9ebdb[_0x6e6cf(0x178)]});}}),module['exports']=router;