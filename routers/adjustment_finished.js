var a0_0x360911=a0_0x5bbe;function a0_0x5bbe(_0x37608f,_0x39c9f8){var _0x12383b=a0_0x1238();return a0_0x5bbe=function(_0x5bbe3e,_0x143f30){_0x5bbe3e=_0x5bbe3e-0x1e0;var _0x30c82a=_0x12383b[_0x5bbe3e];return _0x30c82a;},a0_0x5bbe(_0x37608f,_0x39c9f8);}(function(_0x5d975a,_0x13ea3d){var _0x387a5c=a0_0x5bbe,_0x358cf8=_0x5d975a();while(!![]){try{var _0x51c2bb=-parseInt(_0x387a5c(0x2a2))/0x1+-parseInt(_0x387a5c(0x1fe))/0x2+-parseInt(_0x387a5c(0x295))/0x3+parseInt(_0x387a5c(0x1ef))/0x4+-parseInt(_0x387a5c(0x210))/0x5*(-parseInt(_0x387a5c(0x1f9))/0x6)+-parseInt(_0x387a5c(0x243))/0x7*(-parseInt(_0x387a5c(0x1e7))/0x8)+parseInt(_0x387a5c(0x212))/0x9;if(_0x51c2bb===_0x13ea3d)break;else _0x358cf8['push'](_0x358cf8['shift']());}catch(_0x1ed111){_0x358cf8['push'](_0x358cf8['shift']());}}}(a0_0x1238,0x6d613));const express=require(a0_0x360911(0x24b)),app=express(),router=express['Router'](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x360911(0x242)),users=require(a0_0x360911(0x20d)),nodemailer=require(a0_0x360911(0x279));router[a0_0x360911(0x274)](a0_0x360911(0x249),auth,async(_0x4494d8,_0x2ef33b)=>{var _0x5e2214=a0_0x360911;try{const {username:_0x45966f,email:_0x5ac16c,role:_0x47997c}=_0x4494d8[_0x5e2214(0x231)],_0x223287=_0x4494d8[_0x5e2214(0x231)],_0x578b86=await profile['findOne']({'email':_0x223287['email']}),_0x1d4a09=await master_shop['find']();let _0x34529a;if(_0x223287[_0x5e2214(0x233)]==_0x5e2214(0x1e9)){const _0x596e55=await staff['findOne']({'email':_0x223287[_0x5e2214(0x255)]});_0x34529a=await warehouse['find']({'status':_0x5e2214(0x25e),'name':_0x596e55['warehouse']});}else _0x34529a=await warehouse[_0x5e2214(0x1f0)]({'status':_0x5e2214(0x25e)});const _0x50c37d=await product[_0x5e2214(0x1f0)]();let _0x3cf055;if(_0x223287[_0x5e2214(0x233)]==_0x5e2214(0x1e9)){const _0xc89693=await staff['findOne']({'email':_0x223287[_0x5e2214(0x255)]});_0x3cf055=await adjustment_finished['find']({'warehouse_name':_0xc89693[_0x5e2214(0x203)]});}else _0x3cf055=await adjustment_finished['aggregate']([{'$unwind':_0x5e2214(0x270)},{'$group':{'_id':_0x5e2214(0x27c),'invoice':{'$first':'$invoice'},'date':{'$first':_0x5e2214(0x25a)},'warehouse_name':{'$first':_0x5e2214(0x1fd)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x5e2214(0x218)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1d4a09[0x0][_0x5e2214(0x1e8)]=='English\x20(US)'){var _0x12a0b6=users[_0x5e2214(0x265)];console[_0x5e2214(0x269)](_0x12a0b6);}else{if(_0x1d4a09[0x0]['language']==_0x5e2214(0x223))var _0x12a0b6=users[_0x5e2214(0x223)];else{if(_0x1d4a09[0x0][_0x5e2214(0x1e8)]==_0x5e2214(0x252))var _0x12a0b6=users['German'];else{if(_0x1d4a09[0x0][_0x5e2214(0x1e8)]==_0x5e2214(0x20b))var _0x12a0b6=users[_0x5e2214(0x20b)];else{if(_0x1d4a09[0x0][_0x5e2214(0x1e8)]=='French')var _0x12a0b6=users['French'];else{if(_0x1d4a09[0x0][_0x5e2214(0x1e8)]==_0x5e2214(0x22a))var _0x12a0b6=users[_0x5e2214(0x1e1)];else{if(_0x1d4a09[0x0]['language']==_0x5e2214(0x217))var _0x12a0b6=users[_0x5e2214(0x217)];else{if(_0x1d4a09[0x0][_0x5e2214(0x1e8)]==_0x5e2214(0x267))var _0x12a0b6=users[_0x5e2214(0x207)];}}}}}}}_0x2ef33b[_0x5e2214(0x25f)](_0x5e2214(0x2a5),{'success':_0x4494d8['flash']('success'),'errors':_0x4494d8[_0x5e2214(0x26a)](_0x5e2214(0x256)),'role':_0x223287,'profile':_0x578b86,'warehouse':_0x34529a,'product':_0x50c37d,'adjustment':_0x3cf055,'master_shop':_0x1d4a09,'language':_0x12a0b6});}catch(_0x535c01){console['log'](_0x535c01);}});function a0_0x1238(){var _0x2a28ce=['body','types','JO_number','70458yHUPRA','<hr\x20class=\x22my-3\x22>','error','\x20Order\x20Number\x20:\x20','$warehouse_name','1352268VEJIWC','Primary_Units','English\x20(US)','DRY\x20GOODS','An\x20error\x20occurred.','warehouse','ADJF-','$product_details.production_date','$product_details.product_name','Arabic','product_name','redirect','Email\x20sent\x20successfully','Spanish','<span\x20style=\x22float:\x20right;\x22>','../public/language/languages.json','purchases_data','production_date','45EyXhRQ','invoice','2807289dYRKEf','/CheckingWarehouse','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','maxPerUnit','$product.product_name','Chinese','$finalize','/barcode_scanner','$product_details.floorlevel','French','site_title','/picking_list/PDF_adjustment/','room_names','<!DOCTYPE\x20html>','level','master','product_code','Hindi','</td>','</span>','/view/add_adjustment','findById','$product_details.type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','Portuguese\x20(BR)','$product_details.expiry_date','$room','edit_adjustment_finished','$product_details.secondary_code','batch_code','message','user','logo','role','Error\x20Occurs','host','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','_id','<tr>','new_adjust_qty','unit','secondary_unit','$product_details.product_code','slice','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','aggregate','<tbody\x20style=\x22text-align:\x20center;\x22>','filter','../models/all_models','7OvyJOy','product_details','$product_details.maxPerUnit','$product_details.bin','string','back','/view','Return\x20Rooms','express','True','bay','Enclosed','Adjustment\x20Finalize\x20Successfully','catch','$product_details','German','minus','forEach','email','errors','\x20Order\x20Date\x20:\x20','Adjustment\x20Mail','\x20</h2>','$date','Finished\x20Goods','/preview/:id','FGSEmail','Enabled','render','Logo.png','Secondary_units','/adjustment_finished/preview/','json','date','English','save','Arabic\x20(ae)','product_stock','log','flash','$product_details.unit','</tr>','push','prod_code','New_Qty_Converted_adj','$product','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','get','prod_name','Rooms','post','$name','nodemailer','product','length','$_id','prod_cat','padStart','$product_details.secondary_unit','An\x20error\x20occurred\x20while\x20saving\x20data.','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','$product_details.rack','$product_details.maxProducts','<h5\x20style=\x22text-align:\x20left;\x22>','adjust_qty','adjustment\x20data\x20update\x20successfully','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','</table>','image','warehouse_name','finalize','/upload/','QA\x20Warehouse','/adjustment_finished/view','<table\x20style=\x22width:\x20100%\x20!important;\x22>','split','status','$product_details.bay','532875doigfV','stockBefore','prod_invoice','</h5>','params','floor','foreach\x20newproduct','expiry_date','$product_details.invoice','</body></html>','getMonth','all','add_adjustment_finished','19113JPZzfq','getFullYear','note','adjustment_finished','add','$product_details._id','<div>','success','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','Portuguese','$product_details.primary_code','</div>','product_date','$product_details.product_stock','map','4520696OtmAjU','language','staff','New_Qty_Converted','</tbody>','$product_details.storage','stock','exports','1352784DpDbHE','find','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','findOne','random','toString','$product_details.batch_code'];a0_0x1238=function(){return _0x2a28ce;};return a0_0x1238();}async function getRandom8DigitNumber(){var _0x2ade07=a0_0x360911;const _0x1f24b9=0x989680,_0x4982ae=0x5f5e0ff,_0x1c460a=Math[_0x2ade07(0x29a)](Math[_0x2ade07(0x1f3)]()*(_0x4982ae-_0x1f24b9+0x1))+_0x1f24b9;var _0x197413;const _0x37399b=await adjustment_finished[_0x2ade07(0x1f2)]({'invoice':_0x2ade07(0x204)+_0x1c460a});return _0x37399b&&_0x37399b[_0x2ade07(0x27b)]>0x0?_0x197413='ADJF-'+_0x1c460a:_0x197413=_0x2ade07(0x204)+_0x1c460a,_0x197413;}router[a0_0x360911(0x274)](a0_0x360911(0x226),auth,async(_0x5020fd,_0x5983cf)=>{var _0xda06ba=a0_0x360911;try{const {username:_0x2855de,email:_0x2952b9,role:_0x2b5e75}=_0x5020fd['user'],_0x58f27a=_0x5020fd[_0xda06ba(0x231)],_0x4e7c36=await profile[_0xda06ba(0x1f2)]({'email':_0x58f27a[_0xda06ba(0x255)]}),_0x334621=await master_shop[_0xda06ba(0x1f0)]();let _0x11430d;if(_0x58f27a['role']==_0xda06ba(0x1e9)){const _0x1cd87a=await staff[_0xda06ba(0x1f2)]({'email':_0x58f27a['email']});_0x11430d=await warehouse[_0xda06ba(0x23f)]([{'$match':{'status':_0xda06ba(0x25e),'name':_0x1cd87a[_0xda06ba(0x203)],'warehouse_category':'Finished\x20Goods','name':{'$ne':_0xda06ba(0x28f)}}},{'$group':{'_id':_0xda06ba(0x278),'name':{'$first':_0xda06ba(0x278)}}}]);}else _0x11430d=await warehouse[_0xda06ba(0x23f)]([{'$match':{'status':'Enabled','warehouse_category':'Finished\x20Goods','name':{'$ne':_0xda06ba(0x28f)}}},{'$group':{'_id':_0xda06ba(0x278),'name':{'$first':_0xda06ba(0x278)}}}]);const _0x35b5bd=await product['find']({}),_0x1d9c6a=await adjustment_finished[_0xda06ba(0x1f0)]({}),_0x10fbae=_0x1d9c6a[_0xda06ba(0x27b)]+0x1,_0x50e431=_0xda06ba(0x204)+_0x10fbae[_0xda06ba(0x1f4)]()[_0xda06ba(0x27e)](0x5,'0');var _0x502d0f=['Ambient',_0xda06ba(0x24e),_0xda06ba(0x24a)];if(_0x334621[0x0][_0xda06ba(0x1e8)]==_0xda06ba(0x200))var _0x584e31=users['English'];else{if(_0x334621[0x0][_0xda06ba(0x1e8)]==_0xda06ba(0x223))var _0x584e31=users[_0xda06ba(0x223)];else{if(_0x334621[0x0]['language']==_0xda06ba(0x252))var _0x584e31=users['German'];else{if(_0x334621[0x0][_0xda06ba(0x1e8)]=='Spanish')var _0x584e31=users[_0xda06ba(0x20b)];else{if(_0x334621[0x0][_0xda06ba(0x1e8)]==_0xda06ba(0x21b))var _0x584e31=users[_0xda06ba(0x21b)];else{if(_0x334621[0x0][_0xda06ba(0x1e8)]==_0xda06ba(0x22a))var _0x584e31=users['Portuguese'];else{if(_0x334621[0x0]['language']==_0xda06ba(0x217))var _0x584e31=users[_0xda06ba(0x217)];else{if(_0x334621[0x0][_0xda06ba(0x1e8)]==_0xda06ba(0x267))var _0x584e31=users[_0xda06ba(0x207)];}}}}}}}const _0x4795c5=getRandom8DigitNumber();_0x4795c5[_0xda06ba(0x272)](_0x16bfff=>{var _0xe9602e=_0xda06ba;_0x5983cf[_0xe9602e(0x25f)](_0xe9602e(0x2a1),{'success':_0x5020fd['flash'](_0xe9602e(0x2a9)),'errors':_0x5020fd[_0xe9602e(0x26a)](_0xe9602e(0x256)),'role':_0x58f27a,'profile':_0x4e7c36,'warehouse':_0x11430d,'product':_0x35b5bd,'master_shop':_0x334621,'language':_0x584e31,'rooms_data':_0x502d0f,'invoice_no':_0x16bfff});})[_0xda06ba(0x250)](_0x97f56f=>{var _0x1e2c27=_0xda06ba;_0x5020fd[_0x1e2c27(0x26a)](_0x1e2c27(0x256),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5983cf['redirect']('/adjustment/view');});}catch(_0x2ad930){console[_0xda06ba(0x269)](_0x2ad930);}}),router[a0_0x360911(0x277)](a0_0x360911(0x226),auth,async(_0x95a26a,_0x4508d9)=>{var _0x3218a7=a0_0x360911;try{const {warehouse_name:_0x3c15d1,date:_0x19c8bb,prod_name:_0xaf68d8,level:_0x3e5fb5,isle:_0x6257f4,pallet:_0x31ef5d,stock:_0x4cb299,types:_0x1e5d75,adjust_qty:_0x146240,new_adjust_qty:_0x25a6c,note:_0x3f4434,Room_name:_0x2843c6,invoice:_0x48728c,JO_number:_0x1e2703,expiry_date:_0x1f95a2}=_0x95a26a[_0x3218a7(0x1f6)];if(typeof _0xaf68d8==_0x3218a7(0x247))var _0x1db809=[_0x95a26a['body'][_0x3218a7(0x275)]],_0x16ff55=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x220)]],_0x18c5d5=[_0x95a26a['body']['stock']],_0xaa66f9=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1f7)]],_0x34e75d=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x26f)]],_0x189241=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1ea)]],_0x21d89e=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1ff)]],_0x5e60a9=[_0x95a26a['body']['Secondary_units']],_0x6e20cc=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x26e)]],_0x58129c=[_0x95a26a['body'][_0x3218a7(0x22f)]],_0x426141=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x29c)]],_0xd58667=[_0x95a26a['body']['product_date']],_0x50957d=[_0x95a26a['body'][_0x3218a7(0x27d)]],_0x18daff=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x276)]],_0x144597=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x215)]],_0x215d29=[_0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x297)]];else var _0x1db809=[..._0x95a26a[_0x3218a7(0x1f6)]['prod_name']],_0x16ff55=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x220)]],_0x18c5d5=[..._0x95a26a[_0x3218a7(0x1f6)]['stock']],_0xaa66f9=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1f7)]],_0x34e75d=[..._0x95a26a[_0x3218a7(0x1f6)]['New_Qty_Converted_adj']],_0x189241=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1ea)]],_0x21d89e=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1ff)]],_0x5e60a9=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x261)]],_0x6e20cc=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x26e)]],_0x58129c=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x22f)]],_0x426141=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x29c)]],_0xd58667=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x1e4)]],_0x50957d=[..._0x95a26a[_0x3218a7(0x1f6)][_0x3218a7(0x27d)]],_0x18daff=[..._0x95a26a['body']['Rooms']],_0x144597=[..._0x95a26a['body'][_0x3218a7(0x215)]],_0x215d29=[..._0x95a26a['body'][_0x3218a7(0x297)]];const _0x221449=_0x1db809['map'](_0x51db11=>{return _0x51db11={'product_name':_0x51db11};});_0x16ff55[_0x3218a7(0x254)]((_0x277720,_0x4c46c9)=>{var _0x5f0b15=_0x3218a7;_0x221449[_0x4c46c9][_0x5f0b15(0x24d)]=_0x277720;}),_0x18c5d5[_0x3218a7(0x254)]((_0x28f655,_0x501f24)=>{var _0x5d414e=_0x3218a7;_0x221449[_0x501f24][_0x5d414e(0x296)]=_0x28f655;}),_0xaa66f9[_0x3218a7(0x254)]((_0x525ad8,_0x26e0e8)=>{_0x221449[_0x26e0e8]['types']=_0x525ad8;}),_0x34e75d[_0x3218a7(0x254)]((_0x40fc3f,_0x29e0ca)=>{var _0x256d70=_0x3218a7;_0x221449[_0x29e0ca][_0x256d70(0x286)]=_0x40fc3f;}),_0x189241[_0x3218a7(0x254)]((_0x266ae5,_0x1420f0)=>{var _0x1a2ad7=_0x3218a7;_0x221449[_0x1420f0][_0x1a2ad7(0x239)]=_0x266ae5;}),_0x21d89e[_0x3218a7(0x254)]((_0x28a0ee,_0x5743f1)=>{var _0x1a18b4=_0x3218a7;_0x221449[_0x5743f1][_0x1a18b4(0x23a)]=_0x28a0ee;}),_0x5e60a9[_0x3218a7(0x254)]((_0x2d692a,_0x264a05)=>{var _0x893f87=_0x3218a7;_0x221449[_0x264a05][_0x893f87(0x23b)]=_0x2d692a;}),_0x6e20cc[_0x3218a7(0x254)]((_0x1832c0,_0x209b08)=>{var _0xa827a0=_0x3218a7;_0x221449[_0x209b08][_0xa827a0(0x222)]=_0x1832c0;}),_0x58129c[_0x3218a7(0x254)]((_0x21dd91,_0x3cca6b)=>{var _0x1b6513=_0x3218a7;_0x221449[_0x3cca6b][_0x1b6513(0x22f)]=_0x21dd91;}),_0x426141[_0x3218a7(0x254)]((_0x427f40,_0x56dfeb)=>{var _0x296b01=_0x3218a7;_0x221449[_0x56dfeb][_0x296b01(0x29c)]=_0x427f40;}),_0xd58667[_0x3218a7(0x254)]((_0x5e1311,_0x14a5bd)=>{_0x221449[_0x14a5bd]['production_date']=_0x5e1311;}),_0x50957d[_0x3218a7(0x254)]((_0x2aa1d8,_0x383a5b)=>{_0x221449[_0x383a5b]['prod_cat']=_0x2aa1d8;}),_0x18daff[_0x3218a7(0x254)]((_0x240d98,_0x19721d)=>{var _0x4e4959=_0x3218a7;_0x221449[_0x19721d][_0x4e4959(0x21e)]=_0x240d98;}),_0x144597[_0x3218a7(0x254)]((_0x5362db,_0x48c200)=>{var _0x46dd95=_0x3218a7;_0x221449[_0x48c200][_0x46dd95(0x215)]=_0x5362db;}),_0x215d29['forEach']((_0x447fd0,_0x23401a)=>{_0x221449[_0x23401a]['invoice']=_0x447fd0;});const _0x2c4fca=_0x221449['filter'](_0x45213a=>_0x45213a[_0x3218a7(0x286)]!=='0'&&_0x45213a['adjust_qty']!=='');var _0x59e7d1=0x0;_0x2c4fca[_0x3218a7(0x254)](_0xccd47a=>{var _0x71ff31=_0x3218a7;console[_0x71ff31(0x269)](_0x71ff31(0x29b),_0xccd47a),parseInt(_0xccd47a['adjust_qty'])<=0x0&&_0x59e7d1++;});if(_0x59e7d1!=0x0)return _0x95a26a[_0x3218a7(0x26a)]('errors',_0x3218a7(0x236)),_0x4508d9['redirect'](_0x3218a7(0x248));const _0x4fd487=new adjustment_finished({'warehouse_name':_0x3c15d1,'date':_0x19c8bb,'product':_0x2c4fca,'note':_0x3f4434,'room':_0x2843c6,'invoice':_0x48728c,'JO_number':_0x1e2703,'expiry_date':_0x1f95a2}),_0x2c1bad=await _0x4fd487[_0x3218a7(0x266)]();_0x95a26a['flash']('success','adjustment\x20add\x20successfull'),_0x4508d9[_0x3218a7(0x209)](_0x3218a7(0x262)+_0x2c1bad[_0x3218a7(0x237)]);}catch(_0x16e3b0){console['log'](_0x16e3b0),_0x4508d9[_0x3218a7(0x293)](0xc8)[_0x3218a7(0x263)]({'message':_0x16e3b0['message']});}}),router[a0_0x360911(0x274)](a0_0x360911(0x25c),auth,async(_0x57c6b3,_0x42c273)=>{var _0x571b15=a0_0x360911;try{const {username:_0x291a67,email:_0x420a8c,role:_0x577642}=_0x57c6b3[_0x571b15(0x231)],_0x2308bc=_0x57c6b3[_0x571b15(0x231)],_0x30577b=await profile['findOne']({'email':_0x2308bc['email']}),_0x4a3899=await master_shop[_0x571b15(0x1f0)](),_0x53379f=_0x57c6b3[_0x571b15(0x299)]['id'],_0x63921d=await adjustment_finished[_0x571b15(0x227)]({'_id':_0x53379f}),_0x10e9b5=await purchases[_0x571b15(0x23f)]([{'$match':{'warehouse_name':_0x63921d['warehouse_name']}},{'$unwind':_0x571b15(0x270)},{'$group':{'_id':_0x571b15(0x216)}}]);console['log'](_0x571b15(0x20e),_0x10e9b5);const _0x2af329=await product[_0x571b15(0x1f0)]({}),_0x352ab6=await warehouse['aggregate']([{'$match':{'name':_0x63921d[_0x571b15(0x28c)],'warehouse_category':'Finished\x20Goods'}},{'$unwind':_0x571b15(0x251)},{'$group':{'_id':_0x571b15(0x2a7),'name':{'$first':_0x571b15(0x206)},'product_stock':{'$first':_0x571b15(0x1e5)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x571b15(0x21a)},'primary_code':{'$first':_0x571b15(0x1e2)},'secondary_code':{'$first':_0x571b15(0x22e)},'product_code':{'$first':_0x571b15(0x23c)},'storage':{'$first':_0x571b15(0x1ec)},'rack':{'$first':_0x571b15(0x283)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0x571b15(0x1f5)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'room':{'$first':_0x571b15(0x22c)}}}]);if(_0x4a3899[0x0]['language']=='English\x20(US)'){var _0x5bdca4=users[_0x571b15(0x265)];console[_0x571b15(0x269)](_0x5bdca4);}else{if(_0x4a3899[0x0]['language']=='Hindi')var _0x5bdca4=users['Hindi'];else{if(_0x4a3899[0x0][_0x571b15(0x1e8)]=='German')var _0x5bdca4=users['German'];else{if(_0x4a3899[0x0][_0x571b15(0x1e8)]==_0x571b15(0x20b))var _0x5bdca4=users[_0x571b15(0x20b)];else{if(_0x4a3899[0x0][_0x571b15(0x1e8)]=='French')var _0x5bdca4=users['French'];else{if(_0x4a3899[0x0][_0x571b15(0x1e8)]==_0x571b15(0x22a))var _0x5bdca4=users[_0x571b15(0x1e1)];else{if(_0x4a3899[0x0][_0x571b15(0x1e8)]==_0x571b15(0x217))var _0x5bdca4=users[_0x571b15(0x217)];else{if(_0x4a3899[0x0][_0x571b15(0x1e8)]=='Arabic\x20(ae)')var _0x5bdca4=users[_0x571b15(0x207)];}}}}}}}_0x42c273[_0x571b15(0x25f)]('edit_adjustment_finished_view',{'success':_0x57c6b3[_0x571b15(0x26a)]('success'),'errors':_0x57c6b3[_0x571b15(0x26a)]('errors'),'role':_0x2308bc,'profile':_0x30577b,'adjustment':_0x63921d,'stock':_0x352ab6,'master_shop':_0x4a3899,'warehouse_name':_0x10e9b5,'unit':_0x2af329,'language':_0x5bdca4});}catch(_0x40a5bd){console[_0x571b15(0x269)](_0x40a5bd),_0x42c273[_0x571b15(0x293)](0xc8)[_0x571b15(0x263)]({'message':_0x40a5bd[_0x571b15(0x230)]});}}),router[a0_0x360911(0x277)](a0_0x360911(0x25c),auth,async(_0x2edacd,_0x57ed47)=>{var _0x5d7d8e=a0_0x360911;try{const {invoice:_0x28f6de,warehouse_name:_0x34b74c,Room_name:_0x17a8d3}=_0x2edacd[_0x5d7d8e(0x1f6)],_0x46b305=_0x2edacd[_0x5d7d8e(0x299)]['id'],_0x5522c4=await adjustment_finished[_0x5d7d8e(0x227)]({'_id':_0x46b305});var _0x14c946;const _0x41c511=_0x5522c4[_0x5d7d8e(0x27a)][_0x5d7d8e(0x1e6)](async _0xf277d8=>{var _0x7fb7b0=_0x5d7d8e;if(_0xf277d8[_0x7fb7b0(0x286)]>0x0){_0x14c946=await warehouse[_0x7fb7b0(0x1f2)]({'name':_0x34b74c,'room':_0xf277d8[_0x7fb7b0(0x21e)],'warehouse_category':_0x7fb7b0(0x25b)});const _0x588d05=_0x14c946[_0x7fb7b0(0x244)][_0x7fb7b0(0x1e6)](_0xcc29b=>{var _0x14a093=_0x7fb7b0;console['log'](_0xf277d8[_0x14a093(0x1f7)]);if(_0xf277d8[_0x14a093(0x1f7)]==_0x14a093(0x253))_0xcc29b[_0x14a093(0x208)]==_0xf277d8[_0x14a093(0x208)]&&_0xcc29b[_0x14a093(0x24d)]==_0xf277d8['bay']&&_0xcc29b[_0x14a093(0x29c)]==_0xf277d8[_0x14a093(0x29c)]&&_0xcc29b[_0x14a093(0x20f)]==_0xf277d8['production_date']&&_0xcc29b[_0x14a093(0x22f)]==_0xf277d8[_0x14a093(0x22f)]&&_0xcc29b['invoice']==_0xf277d8[_0x14a093(0x211)]&&(_0xcc29b[_0x14a093(0x268)]=_0xcc29b['product_stock']-_0xf277d8['adjust_qty']);else _0xf277d8[_0x14a093(0x1f7)]==_0x14a093(0x2a6)&&(_0xcc29b[_0x14a093(0x208)]==_0xf277d8[_0x14a093(0x208)]&&_0xcc29b[_0x14a093(0x24d)]==_0xf277d8['bay']&&_0xcc29b[_0x14a093(0x29c)]==_0xf277d8[_0x14a093(0x29c)]&&_0xcc29b[_0x14a093(0x20f)]==_0xf277d8[_0x14a093(0x20f)]&&_0xcc29b[_0x14a093(0x22f)]==_0xf277d8['batch_code']&&_0xcc29b['invoice']==_0xf277d8[_0x14a093(0x211)]&&(_0xcc29b[_0x14a093(0x268)]=_0xcc29b['product_stock']+_0xf277d8[_0x14a093(0x286)]));});}return _0x14c946;});Promise[_0x5d7d8e(0x2a0)](_0x41c511)[_0x5d7d8e(0x272)](async _0x50bb95=>{var _0x1cc80a=_0x5d7d8e;try{for(const _0x2b59a0 of _0x50bb95){await _0x2b59a0[_0x1cc80a(0x266)]();}_0x5522c4[_0x1cc80a(0x28d)]=_0x1cc80a(0x24c);const _0x321de4=await _0x5522c4[_0x1cc80a(0x266)](),_0x42fecc=await master_shop['find'](),_0x362c06=await email_settings[_0x1cc80a(0x1f2)](),_0x428728=await supervisor_settings[_0x1cc80a(0x1f0)]();var _0x517603=_0x5522c4[_0x1cc80a(0x27a)],_0x29877f='',_0xf424c0;for(_0xf424c0 in _0x517603){var _0x1b9c04='FG';_0x5522c4['warehouse_name']==_0x1cc80a(0x201)&&(_0x1b9c04='DG'),_0x29877f+=_0x1cc80a(0x238)+_0x1cc80a(0x23e)+_0x517603[_0xf424c0]['product_name']+_0x1cc80a(0x224)+_0x1cc80a(0x23e)+_0x517603[_0xf424c0][_0x1cc80a(0x222)]+_0x1cc80a(0x224)+_0x1cc80a(0x23e)+_0x517603[_0xf424c0][_0x1cc80a(0x286)]+_0x1cc80a(0x224)+_0x1cc80a(0x23e)+_0x517603[_0xf424c0][_0x1cc80a(0x23a)]+'</td>'+_0x1cc80a(0x23e)+_0x517603[_0xf424c0][_0x1cc80a(0x23b)]+_0x1cc80a(0x224)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5522c4[_0x1cc80a(0x28c)]+_0x1cc80a(0x224)+_0x1cc80a(0x23e)+_0x517603[_0xf424c0]['room_names']+_0x1cc80a(0x224)+_0x1cc80a(0x23e)+_0x1b9c04+_0x517603[_0xf424c0][_0x1cc80a(0x24d)]+'</td>'+_0x1cc80a(0x26c);}let _0x5504c2=nodemailer['createTransport']({'host':_0x362c06[_0x1cc80a(0x235)],'port':Number(_0x362c06['port']),'secure':![],'auth':{'user':_0x362c06['email'],'pass':_0x362c06['password']}}),_0x37debf={'from':_0x362c06[_0x1cc80a(0x255)],'to':_0x428728[0x0][_0x1cc80a(0x25d)],'subject':_0x1cc80a(0x258),'attachments':[{'filename':_0x1cc80a(0x260),'path':__dirname+'/../public'+_0x1cc80a(0x28e)+_0x42fecc[0x0][_0x1cc80a(0x28b)],'cid':_0x1cc80a(0x232)}],'html':_0x1cc80a(0x21f)+'<html><head><title></title>'+'</head><body>'+_0x1cc80a(0x2a8)+_0x1cc80a(0x289)+'<div>'+_0x1cc80a(0x229)+_0x1cc80a(0x1e3)+'<div>'+_0x1cc80a(0x281)+_0x42fecc[0x0][_0x1cc80a(0x21c)]+_0x1cc80a(0x259)+_0x1cc80a(0x1e3)+_0x1cc80a(0x1e3)+_0x1cc80a(0x1fa)+_0x1cc80a(0x2a8)+_0x1cc80a(0x285)+_0x1cc80a(0x1fc)+_0x5522c4[_0x1cc80a(0x211)]+'\x20'+_0x1cc80a(0x20c)+_0x1cc80a(0x257)+_0x5522c4[_0x1cc80a(0x264)]+'\x20'+_0x1cc80a(0x225)+_0x1cc80a(0x298)+_0x1cc80a(0x1e3)+_0x1cc80a(0x291)+_0x1cc80a(0x214)+_0x1cc80a(0x238)+_0x1cc80a(0x1f1)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x1cc80a(0x282)+_0x1cc80a(0x271)+_0x1cc80a(0x1e0)+_0x1cc80a(0x273)+_0x1cc80a(0x288)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+'</tr>'+'</thead>'+_0x1cc80a(0x240)+'\x20'+_0x29877f+'\x20'+_0x1cc80a(0x1eb)+_0x1cc80a(0x28a)+_0x1cc80a(0x2a8)+'<strong>\x20Regards\x20</strong>'+'<h5>'+_0x42fecc[0x0][_0x1cc80a(0x21c)]+_0x1cc80a(0x298)+_0x1cc80a(0x1e3)+'</div>'+_0x1cc80a(0x29e)};_0x5504c2['sendMail'](_0x37debf,function(_0x4612d5,_0x2653ff){var _0x30182c=_0x1cc80a;_0x4612d5?(console['log'](_0x4612d5),console[_0x30182c(0x269)](_0x30182c(0x234))):console['log'](_0x30182c(0x20a));}),_0x2edacd[_0x1cc80a(0x26a)]('success',_0x1cc80a(0x24f)),_0x57ed47[_0x1cc80a(0x209)](_0x1cc80a(0x21d)+_0x321de4['_id']);}catch(_0x3649ca){console[_0x1cc80a(0x1fb)](_0x3649ca),_0x57ed47[_0x1cc80a(0x293)](0x1f4)[_0x1cc80a(0x263)]({'error':_0x1cc80a(0x280)});}})[_0x5d7d8e(0x250)](_0x3dc559=>{var _0x31ac7b=_0x5d7d8e;console[_0x31ac7b(0x1fb)](_0x3dc559),_0x57ed47['status'](0x1f4)['json']({'error':_0x31ac7b(0x202)});});}catch(_0x324aa7){_0x57ed47[_0x5d7d8e(0x263)]({'message':_0x324aa7[_0x5d7d8e(0x230)]});}}),router[a0_0x360911(0x274)]('/view/:id',auth,async(_0x3651d3,_0x4cac42)=>{var _0x1ed267=a0_0x360911;try{const {username:_0x44a1dd,email:_0x508c2d,role:_0x528e0d}=_0x3651d3['user'],_0x437e29=_0x3651d3[_0x1ed267(0x231)],_0x1350eb=await profile[_0x1ed267(0x1f2)]({'email':_0x437e29[_0x1ed267(0x255)]}),_0x44de0e=await master_shop['find']();console['log'](_0x1ed267(0x221),_0x44de0e);const _0x30cdaf=_0x3651d3[_0x1ed267(0x299)]['id'],_0x2876c7=await adjustment_finished['findById']({'_id':_0x30cdaf});let _0x249d09=new Date(_0x2876c7[_0x1ed267(0x29c)]),_0x180350=('0'+_0x249d09['getDate']())[_0x1ed267(0x23d)](-0x2),_0x458cd8=('0'+(_0x249d09[_0x1ed267(0x29f)]()+0x1))[_0x1ed267(0x23d)](-0x2),_0x47a538=_0x249d09[_0x1ed267(0x2a3)](),_0x3be6aa=_0x47a538+'-'+_0x458cd8+'-'+_0x180350;var _0x9d99e8=['Ambient',_0x1ed267(0x24e),_0x1ed267(0x24a)];const _0x25d175=await purchases['aggregate']([{'$match':{'warehouse_name':_0x2876c7['warehouse_name']}},{'$unwind':_0x1ed267(0x270)},{'$group':{'_id':'$product.product_name'}}]);console[_0x1ed267(0x269)](_0x1ed267(0x20e),_0x25d175);const _0x1a2a4b=await product[_0x1ed267(0x1f0)]({}),_0xcdc969=await warehouse['aggregate']([{'$match':{'name':_0x2876c7[_0x1ed267(0x28c)],'room':_0x2876c7['room']}},{'$unwind':'$product_details'},{'$group':{'_id':_0x1ed267(0x2a7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1ed267(0x1e5)},'bay':{'$first':_0x1ed267(0x294)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x1ed267(0x228)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x1ed267(0x1e2)},'secondary_code':{'$first':_0x1ed267(0x22e)},'product_code':{'$first':_0x1ed267(0x23c)},'storage':{'$first':_0x1ed267(0x1ec)},'rack':{'$first':_0x1ed267(0x283)}}}]);if(_0x44de0e[0x0][_0x1ed267(0x1e8)]==_0x1ed267(0x200)){var _0x45dcd4=users['English'];console[_0x1ed267(0x269)](_0x45dcd4);}else{if(_0x44de0e[0x0]['language']==_0x1ed267(0x223))var _0x45dcd4=users[_0x1ed267(0x223)];else{if(_0x44de0e[0x0]['language']==_0x1ed267(0x252))var _0x45dcd4=users[_0x1ed267(0x252)];else{if(_0x44de0e[0x0]['language']==_0x1ed267(0x20b))var _0x45dcd4=users['Spanish'];else{if(_0x44de0e[0x0]['language']==_0x1ed267(0x21b))var _0x45dcd4=users[_0x1ed267(0x21b)];else{if(_0x44de0e[0x0][_0x1ed267(0x1e8)]==_0x1ed267(0x22a))var _0x45dcd4=users['Portuguese'];else{if(_0x44de0e[0x0][_0x1ed267(0x1e8)]==_0x1ed267(0x217))var _0x45dcd4=users[_0x1ed267(0x217)];else{if(_0x44de0e[0x0][_0x1ed267(0x1e8)]==_0x1ed267(0x267))var _0x45dcd4=users[_0x1ed267(0x207)];}}}}}}}_0x4cac42[_0x1ed267(0x25f)](_0x1ed267(0x22d),{'success':_0x3651d3[_0x1ed267(0x26a)](_0x1ed267(0x2a9)),'errors':_0x3651d3[_0x1ed267(0x26a)](_0x1ed267(0x256)),'role':_0x437e29,'profile':_0x1350eb,'adjustment':_0x2876c7,'stock':_0xcdc969,'master_shop':_0x44de0e,'warehouse_name':_0x25d175,'unit':_0x1a2a4b,'language':_0x45dcd4,'rooms_data':_0x9d99e8,'ed_fullDate':_0x3be6aa});}catch(_0x57804c){console[_0x1ed267(0x269)](_0x57804c),_0x4cac42['status'](0xc8)['json']({'message':_0x57804c[_0x1ed267(0x230)]});}}),router['post']('/view/:id',auth,async(_0x57795c,_0x970792)=>{var _0x16848f=a0_0x360911;try{const _0xea2eff=_0x57795c[_0x16848f(0x299)]['id'],_0x3a7532=await adjustment_finished[_0x16848f(0x227)]({'_id':_0xea2eff}),_0x45e12a=await warehouse[_0x16848f(0x1f2)]({'name':_0x3a7532[_0x16848f(0x28c)],'room':_0x3a7532['room']}),{warehouse_name:_0x2a32e1,date:_0x5d1117,prod_name:_0x102490,level:_0x3d3fed,isle:_0x4318eb,pallet:_0x5e7e8e,stock:_0x3deb09,types:_0x5248ef,adjust_qty:_0x53d7e7,new_adjust_qty:_0x490ab0,note:_0x4c2348,Room_name:_0x120ed3,invoice:_0x1605ba,JO_number:_0x1865db}=_0x57795c[_0x16848f(0x1f6)];if(typeof _0x102490==_0x16848f(0x247))var _0x417081=[_0x57795c[_0x16848f(0x1f6)]['prod_name']],_0x3ddbe0=[_0x57795c[_0x16848f(0x1f6)][_0x16848f(0x220)]],_0xdb631=[_0x57795c[_0x16848f(0x1f6)]['stock']],_0x43f606=[_0x57795c[_0x16848f(0x1f6)]['types']],_0x3486f6=[_0x57795c['body'][_0x16848f(0x286)]],_0x2621aa=[_0x57795c[_0x16848f(0x1f6)][_0x16848f(0x239)]],_0x6abf63=[_0x57795c[_0x16848f(0x1f6)][_0x16848f(0x26e)]],_0x3390e5=[_0x57795c['body']['unit']],_0xa83514=[_0x57795c[_0x16848f(0x1f6)][_0x16848f(0x261)]],_0x52ea6b=[_0x57795c[_0x16848f(0x1f6)][_0x16848f(0x22f)]],_0x2b0d03=[_0x57795c['body']['expiry_date']];else var _0x417081=[..._0x57795c[_0x16848f(0x1f6)]['prod_name']],_0x3ddbe0=[..._0x57795c[_0x16848f(0x1f6)][_0x16848f(0x220)]],_0xdb631=[..._0x57795c[_0x16848f(0x1f6)][_0x16848f(0x1ed)]],_0x43f606=[..._0x57795c[_0x16848f(0x1f6)]['types']],_0x3486f6=[..._0x57795c[_0x16848f(0x1f6)][_0x16848f(0x286)]],_0x2621aa=[..._0x57795c[_0x16848f(0x1f6)][_0x16848f(0x239)]],_0x6abf63=[..._0x57795c[_0x16848f(0x1f6)][_0x16848f(0x26e)]],_0x3390e5=[..._0x57795c['body'][_0x16848f(0x23a)]],_0xa83514=[..._0x57795c[_0x16848f(0x1f6)][_0x16848f(0x261)]],_0x52ea6b=[..._0x57795c['body'][_0x16848f(0x22f)]],_0x2b0d03=[..._0x57795c['body'][_0x16848f(0x29c)]];const _0x3c4700=_0x417081[_0x16848f(0x1e6)](_0x2744df=>{return _0x2744df={'product_name':_0x2744df};});_0x3ddbe0[_0x16848f(0x254)]((_0x13d017,_0x18a76a)=>{_0x3c4700[_0x18a76a]['bay']=_0x13d017;}),_0xdb631['forEach']((_0x270b31,_0x9564fc)=>{_0x3c4700[_0x9564fc]['stockBefore']=_0x270b31;}),_0x43f606[_0x16848f(0x254)]((_0x2a2da0,_0x163f38)=>{var _0x21c13b=_0x16848f;_0x3c4700[_0x163f38][_0x21c13b(0x1f7)]=_0x2a2da0;}),_0x3486f6[_0x16848f(0x254)]((_0x519a91,_0x953b4)=>{var _0x4f6acd=_0x16848f;_0x3c4700[_0x953b4][_0x4f6acd(0x286)]=_0x519a91;}),_0x2621aa[_0x16848f(0x254)]((_0x2ae322,_0x84f88e)=>{var _0x4f5d7c=_0x16848f;_0x3c4700[_0x84f88e][_0x4f5d7c(0x239)]=_0x2ae322;}),_0x3390e5[_0x16848f(0x254)]((_0x2a1b16,_0x250091)=>{_0x3c4700[_0x250091]['unit']=_0x2a1b16;}),_0xa83514[_0x16848f(0x254)]((_0x8c2be7,_0x32559e)=>{var _0x5c9323=_0x16848f;_0x3c4700[_0x32559e][_0x5c9323(0x23b)]=_0x8c2be7;}),_0x6abf63[_0x16848f(0x254)]((_0x1e3a6a,_0x210dcd)=>{var _0x1cc3d1=_0x16848f;_0x3c4700[_0x210dcd][_0x1cc3d1(0x222)]=_0x1e3a6a;}),_0x52ea6b[_0x16848f(0x254)]((_0x1bed57,_0x529de9)=>{_0x3c4700[_0x529de9]['batch_code']=_0x1bed57;}),_0x2b0d03['forEach']((_0x2d3352,_0x151067)=>{var _0x102dd4=_0x16848f;_0x3c4700[_0x151067][_0x102dd4(0x29c)]=_0x2d3352;});const _0x1283a4=_0x3c4700[_0x16848f(0x241)](_0x1343a8=>_0x1343a8[_0x16848f(0x286)]!=='0'&&_0x1343a8[_0x16848f(0x286)]!=='');var _0x4a9be2=0x0;_0x1283a4[_0x16848f(0x254)](_0x3ecc15=>{var _0x1bc43c=_0x16848f;console['log']('foreach\x20newproduct',_0x3ecc15),parseInt(_0x3ecc15[_0x1bc43c(0x286)])<=0x0&&_0x4a9be2++;});if(_0x4a9be2!=0x0)return _0x57795c['flash'](_0x16848f(0x256),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x970792[_0x16848f(0x209)]('back');_0x3a7532[_0x16848f(0x28c)]=_0x2a32e1,_0x3a7532[_0x16848f(0x264)]=_0x5d1117,_0x3a7532[_0x16848f(0x27a)]=_0x1283a4,_0x3a7532[_0x16848f(0x2a4)]=_0x4c2348,_0x3a7532['room']=_0x120ed3,_0x3a7532['invoice']=_0x1605ba,_0x3a7532[_0x16848f(0x1f8)]=_0x1865db;const _0x29113c=await _0x3a7532['save'](),_0x14a698=await warehouse[_0x16848f(0x1f2)]({'name':_0x2a32e1,'room':_0x120ed3});_0x29113c[_0x16848f(0x27a)]['forEach'](_0x5c9f91=>{var _0xdd5e95=_0x16848f;const _0x567718=_0x14a698[_0xdd5e95(0x244)][_0xdd5e95(0x1e6)](_0x4a8fbf=>{var _0x238689=_0xdd5e95;_0x5c9f91['types']==_0x238689(0x253)?_0x4a8fbf[_0x238689(0x208)]==_0x5c9f91['product_name']&&_0x4a8fbf[_0x238689(0x24d)]==_0x5c9f91[_0x238689(0x24d)]&&(_0x4a8fbf[_0x238689(0x268)]=parseInt(_0x4a8fbf[_0x238689(0x268)])-parseInt(_0x5c9f91[_0x238689(0x286)])):_0x4a8fbf[_0x238689(0x208)]==_0x5c9f91[_0x238689(0x208)]&&_0x4a8fbf['bay']==_0x5c9f91['bay']&&(_0x4a8fbf[_0x238689(0x268)]=parseInt(_0x4a8fbf[_0x238689(0x268)])+parseInt(_0x5c9f91[_0x238689(0x286)]));});}),await _0x14a698['save'](),_0x57795c[_0x16848f(0x26a)](_0x16848f(0x2a9),_0x16848f(0x287)),_0x970792[_0x16848f(0x209)](_0x16848f(0x290));}catch(_0x3b422){console[_0x16848f(0x269)](_0x3b422);}}),router[a0_0x360911(0x277)](a0_0x360911(0x219),async(_0x3f952b,_0x1b4505)=>{var _0x1e9515=a0_0x360911;const {primary_code:_0x442209,warehouse_data:_0x5d0038,rooms_data:_0x3a0e7b,Roomslist:_0xa312a}=_0x3f952b[_0x1e9515(0x1f6)],_0x3970d0=_0xa312a[_0x1e9515(0x292)](','),_0x3ee1e1=[];async function _0xb71fdd(_0x1e9fea){var _0x3c923b=_0x1e9515;const _0x2b8fed=await warehouse[_0x3c923b(0x23f)]([{'$match':{'name':_0x5d0038,'room':_0x1e9fea}},{'$unwind':_0x3c923b(0x251)},{'$match':{'product_details.primary_code':_0x442209}},{'$group':{'_id':_0x3c923b(0x2a7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c923b(0x1e5)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x3c923b(0x22e)},'product_code':{'$first':_0x3c923b(0x23c)},'level':{'$first':_0x3c923b(0x294)},'isle':{'$first':_0x3c923b(0x246)},'type':{'$first':'$product_details.type'},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x3c923b(0x26b)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3c923b(0x1ec)},'rack':{'$first':_0x3c923b(0x283)},'expiry_date':{'$first':_0x3c923b(0x22b)},'production_date':{'$first':_0x3c923b(0x205)},'batch_code':{'$first':_0x3c923b(0x1f5)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':_0x3c923b(0x245)},'roomNamed':{'$first':_0x3c923b(0x22c)},'invoice':{'$first':_0x3c923b(0x29d)}}}]),_0x3e9a08=await warehouse['aggregate']([{'$match':{'name':_0x5d0038,'room':_0x1e9fea}},{'$unwind':_0x3c923b(0x251)},{'$match':{'product_details.secondary_code':_0x442209}},{'$group':{'_id':_0x3c923b(0x2a7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3c923b(0x1e5)},'primary_code':{'$first':_0x3c923b(0x1e2)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3c923b(0x294)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x3c923b(0x228)},'pallet':{'$first':_0x3c923b(0x21a)},'unit':{'$first':_0x3c923b(0x26b)},'secondary_unit':{'$first':_0x3c923b(0x27f)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x3c923b(0x283)},'expiry_date':{'$first':_0x3c923b(0x22b)},'production_date':{'$first':_0x3c923b(0x205)},'batch_code':{'$first':_0x3c923b(0x1f5)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x3c923b(0x22c)},'invoice':{'$first':_0x3c923b(0x29d)}}}]);if(_0x2b8fed['length']>0x0)_0x3ee1e1[_0x3c923b(0x26d)](_0x2b8fed);else _0x3e9a08['length']>0x0&&_0x3ee1e1[_0x3c923b(0x26d)](_0x3e9a08);}const _0x182991=_0x3970d0['map'](_0x3dd308=>_0xb71fdd(_0x3dd308));await Promise[_0x1e9515(0x2a0)](_0x182991),_0x1b4505[_0x1e9515(0x263)](_0x3ee1e1);}),router[a0_0x360911(0x277)](a0_0x360911(0x213),async(_0x8cc832,_0x5df4ff)=>{var _0x14bfe1=a0_0x360911;const {productCode:_0x20699d,bay:_0x27f614,warehouses:_0x4f2092,room:_0x3968ae}=_0x8cc832[_0x14bfe1(0x1f6)];console['log'](_0x8cc832[_0x14bfe1(0x1f6)]);try{const _0x1e3c11=await warehouse[_0x14bfe1(0x23f)]([{'$match':{'name':_0x4f2092,'room':_0x3968ae}},{'$unwind':_0x14bfe1(0x251)},{'$match':{'product_details.bay':parseInt(_0x27f614)}},{'$group':{'_id':_0x14bfe1(0x2a7),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x14bfe1(0x1e5)},'bay':{'$first':_0x14bfe1(0x294)},'maxProducts':{'$first':_0x14bfe1(0x284)}}}]);_0x5df4ff[_0x14bfe1(0x293)](0xc8)['json'](_0x1e3c11);}catch(_0x75c671){_0x5df4ff[_0x14bfe1(0x293)](0x194)['json']({'message':_0x75c671['message']});}}),module[a0_0x360911(0x1ee)]=router;