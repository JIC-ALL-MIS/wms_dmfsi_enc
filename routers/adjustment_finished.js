var a0_0x46806f=a0_0x9426;(function(_0x2c60d2,_0x195fa9){var _0x418c59=a0_0x9426,_0x1c3ced=_0x2c60d2();while(!![]){try{var _0x59f05e=parseInt(_0x418c59(0x12c))/0x1+-parseInt(_0x418c59(0x13d))/0x2+-parseInt(_0x418c59(0x194))/0x3*(parseInt(_0x418c59(0x1e0))/0x4)+-parseInt(_0x418c59(0x1e3))/0x5+parseInt(_0x418c59(0x167))/0x6+parseInt(_0x418c59(0x1a3))/0x7+parseInt(_0x418c59(0x140))/0x8;if(_0x59f05e===_0x195fa9)break;else _0x1c3ced['push'](_0x1c3ced['shift']());}catch(_0x1c72c7){_0x1c3ced['push'](_0x1c3ced['shift']());}}}(a0_0x13bf,0xd512f));const express=require(a0_0x46806f(0x12f)),app=express(),router=express[a0_0x46806f(0x18c)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,adjustment_finished,email_settings,supervisor_settings}=require(a0_0x46806f(0x171)),users=require(a0_0x46806f(0x189)),nodemailer=require('nodemailer');router[a0_0x46806f(0x1a0)](a0_0x46806f(0x177),auth,async(_0x1e3432,_0x39749d)=>{var _0x35b117=a0_0x46806f;try{const {username:_0x50f3a5,email:_0x49cad5,role:_0xb20e80}=_0x1e3432[_0x35b117(0x1c0)],_0x3087f1=_0x1e3432['user'],_0x28a4e0=await profile['findOne']({'email':_0x3087f1[_0x35b117(0x16b)]}),_0x1ec69f=await master_shop[_0x35b117(0x1dc)]();let _0xb6b5a2;if(_0x3087f1[_0x35b117(0x1b0)]==_0x35b117(0x126)){const _0x5afefa=await staff[_0x35b117(0x1b1)]({'email':_0x3087f1[_0x35b117(0x16b)]});_0xb6b5a2=await warehouse[_0x35b117(0x1dc)]({'status':_0x35b117(0x17b),'name':_0x5afefa['warehouse']});}else _0xb6b5a2=await warehouse[_0x35b117(0x1dc)]({'status':_0x35b117(0x17b)});const _0x5c9c0d=await product['find']();let _0x254cbd;if(_0x3087f1[_0x35b117(0x1b0)]==_0x35b117(0x126)){const _0x573b66=await staff['findOne']({'email':_0x3087f1[_0x35b117(0x16b)]});_0x254cbd=await adjustment_finished[_0x35b117(0x1dc)]({'warehouse_name':_0x573b66['warehouse']});}else _0x254cbd=await adjustment_finished['aggregate']([{'$unwind':'$product'},{'$group':{'_id':_0x35b117(0x17e),'invoice':{'$first':_0x35b117(0x19e)},'date':{'$first':_0x35b117(0x1b6)},'warehouse_name':{'$first':_0x35b117(0x160)},'room':{'$addToSet':'$product.room_names'},'finalize':{'$first':_0x35b117(0x173)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1}}]);if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x1bc)){var _0x323b4c=users[_0x35b117(0x141)];console[_0x35b117(0x187)](_0x323b4c);}else{if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x149))var _0x323b4c=users[_0x35b117(0x149)];else{if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x138))var _0x323b4c=users[_0x35b117(0x138)];else{if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x14b))var _0x323b4c=users['Spanish'];else{if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x184))var _0x323b4c=users[_0x35b117(0x184)];else{if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x1af))var _0x323b4c=users['Portuguese'];else{if(_0x1ec69f[0x0][_0x35b117(0x174)]==_0x35b117(0x1cd))var _0x323b4c=users[_0x35b117(0x1cd)];else{if(_0x1ec69f[0x0]['language']==_0x35b117(0x16c))var _0x323b4c=users[_0x35b117(0x1ba)];}}}}}}}_0x39749d[_0x35b117(0x164)](_0x35b117(0x12a),{'success':_0x1e3432[_0x35b117(0x13e)]('success'),'errors':_0x1e3432['flash'](_0x35b117(0x18f)),'role':_0x3087f1,'profile':_0x28a4e0,'warehouse':_0xb6b5a2,'product':_0x5c9c0d,'adjustment':_0x254cbd,'master_shop':_0x1ec69f,'language':_0x323b4c});}catch(_0x1d9a9f){console[_0x35b117(0x187)](_0x1d9a9f);}});function a0_0x13bf(){var _0x10b692=['role','findOne','\x20</h2>','product','<tr>','\x20Order\x20Date\x20:\x20','$date','catch','</tbody>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Arabic','password','English\x20(US)','site_title','adjustment\x20add\x20successfull','success','user','unit','/view/:id','Enclosed','Adjustment\x20Finalize\x20Successfully','</thead>','exports','Secondary_units','findById','forEach','filter','host','sendMail','Chinese','image','message','/upload/','adjust_qty','$name','<hr\x20class=\x22my-3\x22>','then','save','ADJF-','$product_details.expiry_date','<h2>\x20','/view/add_adjustment','New_Qty_Converted_adj','product_code','find','<div>','/picking_list/PDF_adjustment/','room','1252KGIVtj','/../public','params','1577945iGlIno','all','aggregate','getMonth','$product_details.bin','back','staff','<table\x20style=\x22width:\x20100%\x20!important;\x22>','</div>','finalize','adjustment_finished','stock','1637949FDybFm','$product_details.product_stock','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','express','purchases_data','$product_details.production_date','$product_details.rack','$product_details._id','note','level','production_date','$product_details.unit','German','Primary_Units','Portuguese','Rooms','/preview/:id','892918OpIXyl','flash','prod_cat','5831512wMFbFw','English','$product','$product_details.invoice','minus','$product_details','warehouse','floor','foreach\x20newproduct','Hindi','$product_details.bay','Spanish','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','maxPerUnit','<h5>','master','</body></html>','New_Qty_Converted','room_names','stockBefore','$room','FGSEmail','Return\x20Rooms','<h5\x20style=\x22text-align:\x20left;\x22>','error','prod_name','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','product_date','product_name','json','date','$product_details.floorlevel','$warehouse_name','JO_number','expiry_date','DRY\x20GOODS','render','Finished\x20Goods','$product_details.product_code','237648BGxDll','_id','Adjustment\x20Mail','body','email','Arabic\x20(ae)','$product_details.product_name','invoice','<strong>\x20Regards\x20</strong>','bay','../models/all_models','$product_details.batch_code','$finalize','language','$product_details.secondary_code','warehouse_name','/view','Ambient','</span>','$product_details.primary_code','Enabled','$product_details.type','</h5>','$_id','adjustment\x20data\x20update\x20successfully','$product_details.maxPerUnit','redirect','There\x27s\x20a\x20error\x20in\x20this\x20transaction','port','French','getFullYear','product_stock','log','/adjustment/view','../public/language/languages.json','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','prod_code','Router','length','createTransport','errors','status','<span\x20style=\x22float:\x20right;\x22>','True','$product_details.storage','15375CVycxM','post','</td>','map','split','types','\x20Order\x20Number\x20:\x20','$product_details.maxProducts','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$invoice','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','get','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','new_adjust_qty','5826996NJizAO','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','toString','$product_details.secondary_unit','slice','prod_invoice','string','batch_code','<tbody\x20style=\x22text-align:\x20center;\x22>','product_details','/adjustment_finished/preview/','secondary_unit','Portuguese\x20(BR)'];a0_0x13bf=function(){return _0x10b692;};return a0_0x13bf();}async function getRandom8DigitNumber(){var _0x3dd764=a0_0x46806f;const _0x4a3caa=0x989680,_0x3dac4e=0x5f5e0ff,_0x533fcf=Math[_0x3dd764(0x147)](Math['random']()*(_0x3dac4e-_0x4a3caa+0x1))+_0x4a3caa;var _0x523d40;const _0x23891b=await adjustment_finished['findOne']({'invoice':_0x3dd764(0x1d6)+_0x533fcf});return _0x23891b&&_0x23891b[_0x3dd764(0x18d)]>0x0?_0x523d40=_0x3dd764(0x1d6)+_0x533fcf:_0x523d40=_0x3dd764(0x1d6)+_0x533fcf,_0x523d40;}function a0_0x9426(_0x5b86bf,_0x204bdf){var _0x13bf48=a0_0x13bf();return a0_0x9426=function(_0x942604,_0x58db5a){_0x942604=_0x942604-0x122;var _0x3c42fb=_0x13bf48[_0x942604];return _0x3c42fb;},a0_0x9426(_0x5b86bf,_0x204bdf);}router['get'](a0_0x46806f(0x1d9),auth,async(_0x4c431a,_0x18aa75)=>{var _0x1661ff=a0_0x46806f;try{const {username:_0x23fad0,email:_0x1e838f,role:_0x56870d}=_0x4c431a[_0x1661ff(0x1c0)],_0x552720=_0x4c431a['user'],_0x3353e9=await profile[_0x1661ff(0x1b1)]({'email':_0x552720[_0x1661ff(0x16b)]}),_0x3fd72b=await master_shop[_0x1661ff(0x1dc)]();let _0x153e4e;if(_0x552720['role']==_0x1661ff(0x126)){const _0x34a71c=await staff['findOne']({'email':_0x552720[_0x1661ff(0x16b)]});_0x153e4e=await warehouse['aggregate']([{'$match':{'status':_0x1661ff(0x17b),'name':_0x34a71c[_0x1661ff(0x146)],'warehouse_category':'Finished\x20Goods','name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1661ff(0x1d2),'name':{'$first':_0x1661ff(0x1d2)}}}]);}else _0x153e4e=await warehouse[_0x1661ff(0x122)]([{'$match':{'status':_0x1661ff(0x17b),'warehouse_category':_0x1661ff(0x165),'name':{'$ne':'QA\x20Warehouse'}}},{'$group':{'_id':_0x1661ff(0x1d2),'name':{'$first':'$name'}}}]);const _0x40baef=await product[_0x1661ff(0x1dc)]({}),_0x55ebb1=await adjustment_finished[_0x1661ff(0x1dc)]({}),_0xe73add=_0x55ebb1[_0x1661ff(0x18d)]+0x1,_0x32599f='ADJF-'+_0xe73add[_0x1661ff(0x1a5)]()['padStart'](0x5,'0');var _0x2a6ed4=[_0x1661ff(0x178),'Enclosed',_0x1661ff(0x156)];if(_0x3fd72b[0x0][_0x1661ff(0x174)]==_0x1661ff(0x1bc))var _0x248e6d=users[_0x1661ff(0x141)];else{if(_0x3fd72b[0x0][_0x1661ff(0x174)]=='Hindi')var _0x248e6d=users[_0x1661ff(0x149)];else{if(_0x3fd72b[0x0][_0x1661ff(0x174)]==_0x1661ff(0x138))var _0x248e6d=users['German'];else{if(_0x3fd72b[0x0][_0x1661ff(0x174)]==_0x1661ff(0x14b))var _0x248e6d=users[_0x1661ff(0x14b)];else{if(_0x3fd72b[0x0][_0x1661ff(0x174)]==_0x1661ff(0x184))var _0x248e6d=users[_0x1661ff(0x184)];else{if(_0x3fd72b[0x0][_0x1661ff(0x174)]==_0x1661ff(0x1af))var _0x248e6d=users['Portuguese'];else{if(_0x3fd72b[0x0][_0x1661ff(0x174)]==_0x1661ff(0x1cd))var _0x248e6d=users[_0x1661ff(0x1cd)];else{if(_0x3fd72b[0x0]['language']==_0x1661ff(0x16c))var _0x248e6d=users['Arabic'];}}}}}}}const _0x360c7b=getRandom8DigitNumber();_0x360c7b[_0x1661ff(0x1d4)](_0x51706d=>{var _0x329d60=_0x1661ff;_0x18aa75[_0x329d60(0x164)]('add_adjustment_finished',{'success':_0x4c431a[_0x329d60(0x13e)](_0x329d60(0x1bf)),'errors':_0x4c431a['flash'](_0x329d60(0x18f)),'role':_0x552720,'profile':_0x3353e9,'warehouse':_0x153e4e,'product':_0x40baef,'master_shop':_0x3fd72b,'language':_0x248e6d,'rooms_data':_0x2a6ed4,'invoice_no':_0x51706d});})[_0x1661ff(0x1b7)](_0x23eb33=>{var _0x5f3965=_0x1661ff;_0x4c431a[_0x5f3965(0x13e)]('errors',_0x5f3965(0x182)),_0x18aa75[_0x5f3965(0x181)](_0x5f3965(0x188));});}catch(_0x1e8315){console['log'](_0x1e8315);}}),router[a0_0x46806f(0x195)](a0_0x46806f(0x1d9),auth,async(_0x45baa0,_0x44b66f)=>{var _0x28d5c6=a0_0x46806f;try{const {warehouse_name:_0x2c660f,date:_0x15a8b9,prod_name:_0x1018fa,level:_0x216d08,isle:_0x5ad5fd,pallet:_0x3e1dd5,stock:_0x1faacc,types:_0x1a6560,adjust_qty:_0x200c6f,new_adjust_qty:_0x2c3e07,note:_0x548196,Room_name:_0x4ae83c,invoice:_0x4b39ff,JO_number:_0x4645cb,expiry_date:_0x12c2da}=_0x45baa0['body'];if(typeof _0x1018fa==_0x28d5c6(0x1a9))var _0x5702b0=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x159)]],_0x442421=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x135)]],_0x9c72ef=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x12b)]],_0x38ff9d=[_0x45baa0[_0x28d5c6(0x16a)]['types']],_0x1b0cad=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x1da)]],_0x60596f=[_0x45baa0['body'][_0x28d5c6(0x151)]],_0x53efd0=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x139)]],_0x50772a=[_0x45baa0['body'][_0x28d5c6(0x1c7)]],_0x1763f9=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x18b)]],_0x447173=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x1aa)]],_0x2a243f=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x162)]],_0x3c3529=[_0x45baa0['body'][_0x28d5c6(0x15b)]],_0x35ec90=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x13f)]],_0x22afb0=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x13b)]],_0x5169a9=[_0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x14d)]],_0x58a3f4=[_0x45baa0['body']['prod_invoice']];else var _0x5702b0=[..._0x45baa0[_0x28d5c6(0x16a)]['prod_name']],_0x442421=[..._0x45baa0[_0x28d5c6(0x16a)]['level']],_0x9c72ef=[..._0x45baa0[_0x28d5c6(0x16a)]['stock']],_0x38ff9d=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x199)]],_0x1b0cad=[..._0x45baa0[_0x28d5c6(0x16a)]['New_Qty_Converted_adj']],_0x60596f=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x151)]],_0x53efd0=[..._0x45baa0['body'][_0x28d5c6(0x139)]],_0x50772a=[..._0x45baa0[_0x28d5c6(0x16a)]['Secondary_units']],_0x1763f9=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x18b)]],_0x447173=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x1aa)]],_0x2a243f=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x162)]],_0x3c3529=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x15b)]],_0x35ec90=[..._0x45baa0['body'][_0x28d5c6(0x13f)]],_0x22afb0=[..._0x45baa0['body'][_0x28d5c6(0x13b)]],_0x5169a9=[..._0x45baa0[_0x28d5c6(0x16a)][_0x28d5c6(0x14d)]],_0x58a3f4=[..._0x45baa0['body'][_0x28d5c6(0x1a8)]];const _0x20f371=_0x5702b0['map'](_0x29d233=>{return _0x29d233={'product_name':_0x29d233};});_0x442421[_0x28d5c6(0x1c9)]((_0x18ae5b,_0x1a3244)=>{var _0x3cb91c=_0x28d5c6;_0x20f371[_0x1a3244][_0x3cb91c(0x170)]=_0x18ae5b;}),_0x9c72ef[_0x28d5c6(0x1c9)]((_0x524078,_0x16645a)=>{var _0xb348b2=_0x28d5c6;_0x20f371[_0x16645a][_0xb348b2(0x153)]=_0x524078;}),_0x38ff9d[_0x28d5c6(0x1c9)]((_0x1c97d1,_0xf94bf4)=>{var _0x3ee246=_0x28d5c6;_0x20f371[_0xf94bf4][_0x3ee246(0x199)]=_0x1c97d1;}),_0x1b0cad[_0x28d5c6(0x1c9)]((_0x3b2456,_0x4e2e77)=>{var _0x451999=_0x28d5c6;_0x20f371[_0x4e2e77][_0x451999(0x1d1)]=_0x3b2456;}),_0x60596f[_0x28d5c6(0x1c9)]((_0x364d2f,_0x4095d3)=>{var _0x28b1ee=_0x28d5c6;_0x20f371[_0x4095d3][_0x28b1ee(0x1a2)]=_0x364d2f;}),_0x53efd0[_0x28d5c6(0x1c9)]((_0x3a14d4,_0x35cd18)=>{_0x20f371[_0x35cd18]['unit']=_0x3a14d4;}),_0x50772a['forEach']((_0x16ad81,_0x37c380)=>{var _0x1b204a=_0x28d5c6;_0x20f371[_0x37c380][_0x1b204a(0x1ae)]=_0x16ad81;}),_0x1763f9[_0x28d5c6(0x1c9)]((_0x23a1b7,_0x14881a)=>{var _0x5cb3f9=_0x28d5c6;_0x20f371[_0x14881a][_0x5cb3f9(0x1db)]=_0x23a1b7;}),_0x447173[_0x28d5c6(0x1c9)]((_0x38b574,_0x2d2159)=>{var _0x1b89b1=_0x28d5c6;_0x20f371[_0x2d2159][_0x1b89b1(0x1aa)]=_0x38b574;}),_0x2a243f[_0x28d5c6(0x1c9)]((_0x277fef,_0x3ced8e)=>{_0x20f371[_0x3ced8e]['expiry_date']=_0x277fef;}),_0x3c3529[_0x28d5c6(0x1c9)]((_0x132f32,_0x555b52)=>{_0x20f371[_0x555b52]['production_date']=_0x132f32;}),_0x35ec90['forEach']((_0x355450,_0x2e96f8)=>{var _0x223c1a=_0x28d5c6;_0x20f371[_0x2e96f8][_0x223c1a(0x13f)]=_0x355450;}),_0x22afb0[_0x28d5c6(0x1c9)]((_0x3388e8,_0xa6eaf5)=>{var _0x42af7e=_0x28d5c6;_0x20f371[_0xa6eaf5][_0x42af7e(0x152)]=_0x3388e8;}),_0x5169a9[_0x28d5c6(0x1c9)]((_0x41d750,_0x4975e4)=>{_0x20f371[_0x4975e4]['maxPerUnit']=_0x41d750;}),_0x58a3f4[_0x28d5c6(0x1c9)]((_0x543297,_0x493973)=>{var _0x36011a=_0x28d5c6;_0x20f371[_0x493973][_0x36011a(0x16e)]=_0x543297;});const _0x32eacb=_0x20f371[_0x28d5c6(0x1ca)](_0x379053=>_0x379053[_0x28d5c6(0x1d1)]!=='0'&&_0x379053[_0x28d5c6(0x1d1)]!=='');var _0x3de1a0=0x0;_0x32eacb[_0x28d5c6(0x1c9)](_0x18ed04=>{var _0x1ddeff=_0x28d5c6;console[_0x1ddeff(0x187)](_0x1ddeff(0x148),_0x18ed04),parseInt(_0x18ed04[_0x1ddeff(0x1d1)])<=0x0&&_0x3de1a0++;});if(_0x3de1a0!=0x0)return _0x45baa0['flash'](_0x28d5c6(0x18f),_0x28d5c6(0x15a)),_0x44b66f[_0x28d5c6(0x181)]('back');const _0x3017b5=new adjustment_finished({'warehouse_name':_0x2c660f,'date':_0x15a8b9,'product':_0x32eacb,'note':_0x548196,'room':_0x4ae83c,'invoice':_0x4b39ff,'JO_number':_0x4645cb,'expiry_date':_0x12c2da}),_0x65ce96=await _0x3017b5[_0x28d5c6(0x1d5)]();_0x45baa0[_0x28d5c6(0x13e)](_0x28d5c6(0x1bf),_0x28d5c6(0x1be)),_0x44b66f[_0x28d5c6(0x181)](_0x28d5c6(0x1ad)+_0x65ce96['_id']);}catch(_0x55f3f5){console[_0x28d5c6(0x187)](_0x55f3f5),_0x44b66f[_0x28d5c6(0x190)](0xc8)[_0x28d5c6(0x15d)]({'message':_0x55f3f5['message']});}}),router[a0_0x46806f(0x1a0)]('/preview/:id',auth,async(_0x19b77b,_0xeaa5b6)=>{var _0x5f3b1b=a0_0x46806f;try{const {username:_0x1be052,email:_0x4b5d59,role:_0x5e6d0c}=_0x19b77b[_0x5f3b1b(0x1c0)],_0x37fba2=_0x19b77b[_0x5f3b1b(0x1c0)],_0x197118=await profile[_0x5f3b1b(0x1b1)]({'email':_0x37fba2['email']}),_0x103dc3=await master_shop[_0x5f3b1b(0x1dc)](),_0x3da039=_0x19b77b[_0x5f3b1b(0x1e2)]['id'],_0x18593a=await adjustment_finished[_0x5f3b1b(0x1c8)]({'_id':_0x3da039}),_0x58295c=await purchases[_0x5f3b1b(0x122)]([{'$match':{'warehouse_name':_0x18593a['warehouse_name']}},{'$unwind':_0x5f3b1b(0x142)},{'$group':{'_id':'$product.product_name'}}]);console['log'](_0x5f3b1b(0x130),_0x58295c);const _0x4f3cbc=await product[_0x5f3b1b(0x1dc)]({}),_0x29d23a=await warehouse[_0x5f3b1b(0x122)]([{'$match':{'name':_0x18593a[_0x5f3b1b(0x176)],'warehouse_category':_0x5f3b1b(0x165)}},{'$unwind':'$product_details'},{'$group':{'_id':_0x5f3b1b(0x133),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x5f3b1b(0x12d)},'bay':{'$first':_0x5f3b1b(0x14a)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x5f3b1b(0x17c)},'floorlevel':{'$first':_0x5f3b1b(0x15f)},'primary_code':{'$first':_0x5f3b1b(0x17a)},'secondary_code':{'$first':_0x5f3b1b(0x175)},'product_code':{'$first':_0x5f3b1b(0x166)},'storage':{'$first':_0x5f3b1b(0x193)},'rack':{'$first':_0x5f3b1b(0x132)},'expiry_date':{'$first':_0x5f3b1b(0x1d7)},'production_date':{'$first':_0x5f3b1b(0x131)},'batch_code':{'$first':_0x5f3b1b(0x172)},'maxPerUnit':{'$first':_0x5f3b1b(0x180)},'room':{'$first':_0x5f3b1b(0x154)}}}]);if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x1bc)){var _0x3d8b24=users[_0x5f3b1b(0x141)];console[_0x5f3b1b(0x187)](_0x3d8b24);}else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x149))var _0x3d8b24=users[_0x5f3b1b(0x149)];else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x138))var _0x3d8b24=users['German'];else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]=='Spanish')var _0x3d8b24=users[_0x5f3b1b(0x14b)];else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x184))var _0x3d8b24=users[_0x5f3b1b(0x184)];else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x1af))var _0x3d8b24=users[_0x5f3b1b(0x13a)];else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x1cd))var _0x3d8b24=users['Chinese'];else{if(_0x103dc3[0x0][_0x5f3b1b(0x174)]==_0x5f3b1b(0x16c))var _0x3d8b24=users['Arabic'];}}}}}}}_0xeaa5b6[_0x5f3b1b(0x164)]('edit_adjustment_finished_view',{'success':_0x19b77b[_0x5f3b1b(0x13e)](_0x5f3b1b(0x1bf)),'errors':_0x19b77b[_0x5f3b1b(0x13e)](_0x5f3b1b(0x18f)),'role':_0x37fba2,'profile':_0x197118,'adjustment':_0x18593a,'stock':_0x29d23a,'master_shop':_0x103dc3,'warehouse_name':_0x58295c,'unit':_0x4f3cbc,'language':_0x3d8b24});}catch(_0x135fb4){console[_0x5f3b1b(0x187)](_0x135fb4),_0xeaa5b6[_0x5f3b1b(0x190)](0xc8)[_0x5f3b1b(0x15d)]({'message':_0x135fb4['message']});}}),router[a0_0x46806f(0x195)](a0_0x46806f(0x13c),auth,async(_0x34a962,_0x548473)=>{var _0xeebc76=a0_0x46806f;try{const {invoice:_0x462f07,warehouse_name:_0x4eb6f3,Room_name:_0x537e63}=_0x34a962[_0xeebc76(0x16a)],_0x1d6625=_0x34a962[_0xeebc76(0x1e2)]['id'],_0x2c6253=await adjustment_finished[_0xeebc76(0x1c8)]({'_id':_0x1d6625});var _0xde44e1;const _0x5d97a4=_0x2c6253[_0xeebc76(0x1b3)][_0xeebc76(0x197)](async _0x372959=>{var _0x393e1=_0xeebc76;if(_0x372959[_0x393e1(0x1d1)]>0x0){_0xde44e1=await warehouse[_0x393e1(0x1b1)]({'name':_0x4eb6f3,'room':_0x372959[_0x393e1(0x152)],'warehouse_category':_0x393e1(0x165)});const _0x55cce6=_0xde44e1[_0x393e1(0x1ac)]['map'](_0x4ffb97=>{var _0x13d169=_0x393e1;console['log'](_0x372959[_0x13d169(0x199)]);if(_0x372959[_0x13d169(0x199)]==_0x13d169(0x144))_0x4ffb97[_0x13d169(0x15c)]==_0x372959[_0x13d169(0x15c)]&&_0x4ffb97[_0x13d169(0x170)]==_0x372959[_0x13d169(0x170)]&&_0x4ffb97[_0x13d169(0x162)]==_0x372959['expiry_date']&&_0x4ffb97[_0x13d169(0x136)]==_0x372959[_0x13d169(0x136)]&&_0x4ffb97['batch_code']==_0x372959[_0x13d169(0x1aa)]&&_0x4ffb97[_0x13d169(0x16e)]==_0x372959['invoice']&&(_0x4ffb97[_0x13d169(0x186)]=_0x4ffb97[_0x13d169(0x186)]-_0x372959[_0x13d169(0x1d1)]);else _0x372959[_0x13d169(0x199)]=='add'&&(_0x4ffb97[_0x13d169(0x15c)]==_0x372959[_0x13d169(0x15c)]&&_0x4ffb97[_0x13d169(0x170)]==_0x372959[_0x13d169(0x170)]&&_0x4ffb97[_0x13d169(0x162)]==_0x372959[_0x13d169(0x162)]&&_0x4ffb97[_0x13d169(0x136)]==_0x372959[_0x13d169(0x136)]&&_0x4ffb97[_0x13d169(0x1aa)]==_0x372959[_0x13d169(0x1aa)]&&_0x4ffb97[_0x13d169(0x16e)]==_0x372959[_0x13d169(0x16e)]&&(_0x4ffb97[_0x13d169(0x186)]=_0x4ffb97[_0x13d169(0x186)]+_0x372959[_0x13d169(0x1d1)]));});}return _0xde44e1;});Promise[_0xeebc76(0x1e4)](_0x5d97a4)[_0xeebc76(0x1d4)](async _0x5670f2=>{var _0x4028ef=_0xeebc76;try{for(const _0x557180 of _0x5670f2){await _0x557180[_0x4028ef(0x1d5)]();}_0x2c6253[_0x4028ef(0x129)]=_0x4028ef(0x192);const _0x76b34=await _0x2c6253['save'](),_0x385b53=await master_shop[_0x4028ef(0x1dc)](),_0x109640=await email_settings[_0x4028ef(0x1b1)](),_0x5c0109=await supervisor_settings[_0x4028ef(0x1dc)]();var _0x1d07f7=_0x2c6253[_0x4028ef(0x1b3)],_0xad7b3b='',_0x2bff08;for(_0x2bff08 in _0x1d07f7){var _0x4e488f='FG';_0x2c6253['warehouse_name']==_0x4028ef(0x163)&&(_0x4e488f='DG'),_0xad7b3b+=_0x4028ef(0x1b4)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d07f7[_0x2bff08][_0x4028ef(0x15c)]+_0x4028ef(0x196)+_0x4028ef(0x12e)+_0x1d07f7[_0x2bff08][_0x4028ef(0x1db)]+_0x4028ef(0x196)+_0x4028ef(0x12e)+_0x1d07f7[_0x2bff08][_0x4028ef(0x1d1)]+_0x4028ef(0x196)+_0x4028ef(0x12e)+_0x1d07f7[_0x2bff08][_0x4028ef(0x1c1)]+_0x4028ef(0x196)+_0x4028ef(0x12e)+_0x1d07f7[_0x2bff08][_0x4028ef(0x1ae)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2c6253[_0x4028ef(0x176)]+_0x4028ef(0x196)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1d07f7[_0x2bff08][_0x4028ef(0x152)]+_0x4028ef(0x196)+_0x4028ef(0x12e)+_0x4e488f+_0x1d07f7[_0x2bff08]['bay']+_0x4028ef(0x196)+'</tr>';}let _0xc3eecc=nodemailer[_0x4028ef(0x18e)]({'host':_0x109640[_0x4028ef(0x1cb)],'port':Number(_0x109640[_0x4028ef(0x183)]),'secure':![],'auth':{'user':_0x109640['email'],'pass':_0x109640[_0x4028ef(0x1bb)]}}),_0x2b69af={'from':_0x109640['email'],'to':_0x5c0109[0x0][_0x4028ef(0x155)],'subject':_0x4028ef(0x169),'attachments':[{'filename':'Logo.png','path':__dirname+_0x4028ef(0x1e1)+_0x4028ef(0x1d0)+_0x385b53[0x0][_0x4028ef(0x1ce)],'cid':'logo'}],'html':'<!DOCTYPE\x20html>'+'<html><head><title></title>'+'</head><body>'+_0x4028ef(0x1dd)+'<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>'+'<div>'+_0x4028ef(0x14c)+_0x4028ef(0x128)+_0x4028ef(0x1dd)+_0x4028ef(0x1d8)+_0x385b53[0x0][_0x4028ef(0x1bd)]+_0x4028ef(0x1b2)+_0x4028ef(0x128)+_0x4028ef(0x128)+_0x4028ef(0x1d3)+'<div>'+_0x4028ef(0x157)+_0x4028ef(0x19a)+_0x2c6253[_0x4028ef(0x16e)]+'\x20'+_0x4028ef(0x191)+_0x4028ef(0x1b5)+_0x2c6253['date']+'\x20'+_0x4028ef(0x179)+_0x4028ef(0x17d)+_0x4028ef(0x128)+_0x4028ef(0x127)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x4028ef(0x1b4)+_0x4028ef(0x19d)+_0x4028ef(0x1a1)+_0x4028ef(0x1b9)+_0x4028ef(0x19c)+_0x4028ef(0x18a)+_0x4028ef(0x19f)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x4028ef(0x1a4)+'</tr>'+_0x4028ef(0x1c5)+_0x4028ef(0x1ab)+'\x20'+_0xad7b3b+'\x20'+_0x4028ef(0x1b8)+'</table>'+_0x4028ef(0x1dd)+_0x4028ef(0x16f)+_0x4028ef(0x14e)+_0x385b53[0x0]['site_title']+_0x4028ef(0x17d)+_0x4028ef(0x128)+_0x4028ef(0x128)+_0x4028ef(0x150)};_0xc3eecc[_0x4028ef(0x1cc)](_0x2b69af,function(_0x96d35d,_0x839db8){var _0x32cc3e=_0x4028ef;_0x96d35d?(console[_0x32cc3e(0x187)](_0x96d35d),console[_0x32cc3e(0x187)]('Error\x20Occurs')):console[_0x32cc3e(0x187)]('Email\x20sent\x20successfully');}),_0x34a962[_0x4028ef(0x13e)](_0x4028ef(0x1bf),_0x4028ef(0x1c4)),_0x548473[_0x4028ef(0x181)](_0x4028ef(0x1de)+_0x76b34[_0x4028ef(0x168)]);}catch(_0x125be7){console[_0x4028ef(0x158)](_0x125be7),_0x548473[_0x4028ef(0x190)](0x1f4)[_0x4028ef(0x15d)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0xeebc76(0x1b7)](_0x4c1fc6=>{var _0x189e4f=_0xeebc76;console['error'](_0x4c1fc6),_0x548473['status'](0x1f4)[_0x189e4f(0x15d)]({'error':'An\x20error\x20occurred.'});});}catch(_0x26f911){_0x548473[_0xeebc76(0x15d)]({'message':_0x26f911[_0xeebc76(0x1cf)]});}}),router[a0_0x46806f(0x1a0)](a0_0x46806f(0x1c2),auth,async(_0x488cae,_0x30f79f)=>{var _0x1da520=a0_0x46806f;try{const {username:_0x5a1120,email:_0x3b23d6,role:_0x38a5ad}=_0x488cae['user'],_0x115d49=_0x488cae[_0x1da520(0x1c0)],_0x579b35=await profile[_0x1da520(0x1b1)]({'email':_0x115d49['email']}),_0xc41761=await master_shop['find']();console[_0x1da520(0x187)](_0x1da520(0x14f),_0xc41761);const _0x426a51=_0x488cae['params']['id'],_0x1fdc48=await adjustment_finished['findById']({'_id':_0x426a51});let _0x1dc6ec=new Date(_0x1fdc48[_0x1da520(0x162)]),_0x394bd4=('0'+_0x1dc6ec['getDate']())[_0x1da520(0x1a7)](-0x2),_0x267c21=('0'+(_0x1dc6ec[_0x1da520(0x123)]()+0x1))[_0x1da520(0x1a7)](-0x2),_0x2d3c03=_0x1dc6ec[_0x1da520(0x185)](),_0xab1bea=_0x2d3c03+'-'+_0x267c21+'-'+_0x394bd4;var _0x17a1c7=[_0x1da520(0x178),_0x1da520(0x1c3),_0x1da520(0x156)];const _0x3956fb=await purchases[_0x1da520(0x122)]([{'$match':{'warehouse_name':_0x1fdc48['warehouse_name']}},{'$unwind':_0x1da520(0x142)},{'$group':{'_id':'$product.product_name'}}]);console[_0x1da520(0x187)](_0x1da520(0x130),_0x3956fb);const _0x49a1b9=await product[_0x1da520(0x1dc)]({}),_0x4102fa=await warehouse[_0x1da520(0x122)]([{'$match':{'name':_0x1fdc48[_0x1da520(0x176)],'room':_0x1fdc48[_0x1da520(0x1df)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1da520(0x12d)},'bay':{'$first':_0x1da520(0x14a)},'bin':{'$first':_0x1da520(0x124)},'type':{'$first':_0x1da520(0x17c)},'floorlevel':{'$first':_0x1da520(0x15f)},'primary_code':{'$first':_0x1da520(0x17a)},'secondary_code':{'$first':_0x1da520(0x175)},'product_code':{'$first':_0x1da520(0x166)},'storage':{'$first':_0x1da520(0x193)},'rack':{'$first':'$product_details.rack'}}}]);if(_0xc41761[0x0][_0x1da520(0x174)]==_0x1da520(0x1bc)){var _0x47e7da=users[_0x1da520(0x141)];console[_0x1da520(0x187)](_0x47e7da);}else{if(_0xc41761[0x0][_0x1da520(0x174)]=='Hindi')var _0x47e7da=users[_0x1da520(0x149)];else{if(_0xc41761[0x0]['language']==_0x1da520(0x138))var _0x47e7da=users[_0x1da520(0x138)];else{if(_0xc41761[0x0][_0x1da520(0x174)]=='Spanish')var _0x47e7da=users['Spanish'];else{if(_0xc41761[0x0][_0x1da520(0x174)]==_0x1da520(0x184))var _0x47e7da=users[_0x1da520(0x184)];else{if(_0xc41761[0x0]['language']=='Portuguese\x20(BR)')var _0x47e7da=users['Portuguese'];else{if(_0xc41761[0x0][_0x1da520(0x174)]==_0x1da520(0x1cd))var _0x47e7da=users[_0x1da520(0x1cd)];else{if(_0xc41761[0x0][_0x1da520(0x174)]==_0x1da520(0x16c))var _0x47e7da=users[_0x1da520(0x1ba)];}}}}}}}_0x30f79f[_0x1da520(0x164)]('edit_adjustment_finished',{'success':_0x488cae[_0x1da520(0x13e)](_0x1da520(0x1bf)),'errors':_0x488cae['flash'](_0x1da520(0x18f)),'role':_0x115d49,'profile':_0x579b35,'adjustment':_0x1fdc48,'stock':_0x4102fa,'master_shop':_0xc41761,'warehouse_name':_0x3956fb,'unit':_0x49a1b9,'language':_0x47e7da,'rooms_data':_0x17a1c7,'ed_fullDate':_0xab1bea});}catch(_0x4a7934){console['log'](_0x4a7934),_0x30f79f[_0x1da520(0x190)](0xc8)['json']({'message':_0x4a7934[_0x1da520(0x1cf)]});}}),router[a0_0x46806f(0x195)](a0_0x46806f(0x1c2),auth,async(_0x4ba146,_0x395c80)=>{var _0x52c161=a0_0x46806f;try{const _0x38402c=_0x4ba146[_0x52c161(0x1e2)]['id'],_0x38cb6f=await adjustment_finished['findById']({'_id':_0x38402c}),_0x2d5fb3=await warehouse[_0x52c161(0x1b1)]({'name':_0x38cb6f['warehouse_name'],'room':_0x38cb6f[_0x52c161(0x1df)]}),{warehouse_name:_0x6a1528,date:_0x22d55c,prod_name:_0x59d295,level:_0xa9f335,isle:_0x4db9c5,pallet:_0x5eceee,stock:_0x11976b,types:_0x1d0fde,adjust_qty:_0x15cb30,new_adjust_qty:_0x3f64b3,note:_0x2c8109,Room_name:_0x2d5a45,invoice:_0x229be8,JO_number:_0x170e47}=_0x4ba146[_0x52c161(0x16a)];if(typeof _0x59d295=='string')var _0x2d0357=[_0x4ba146['body'][_0x52c161(0x159)]],_0x40b380=[_0x4ba146[_0x52c161(0x16a)][_0x52c161(0x135)]],_0x2cfbdd=[_0x4ba146['body'][_0x52c161(0x12b)]],_0x4192d0=[_0x4ba146[_0x52c161(0x16a)][_0x52c161(0x199)]],_0x1d1491=[_0x4ba146[_0x52c161(0x16a)][_0x52c161(0x1d1)]],_0x389503=[_0x4ba146[_0x52c161(0x16a)]['new_adjust_qty']],_0x558c3c=[_0x4ba146[_0x52c161(0x16a)][_0x52c161(0x18b)]],_0x5d788e=[_0x4ba146[_0x52c161(0x16a)]['unit']],_0x5a9ed0=[_0x4ba146[_0x52c161(0x16a)][_0x52c161(0x1c7)]],_0x41e375=[_0x4ba146[_0x52c161(0x16a)]['batch_code']],_0x1f8ff2=[_0x4ba146['body'][_0x52c161(0x162)]];else var _0x2d0357=[..._0x4ba146[_0x52c161(0x16a)]['prod_name']],_0x40b380=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x135)]],_0x2cfbdd=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x12b)]],_0x4192d0=[..._0x4ba146['body'][_0x52c161(0x199)]],_0x1d1491=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x1d1)]],_0x389503=[..._0x4ba146[_0x52c161(0x16a)]['new_adjust_qty']],_0x558c3c=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x18b)]],_0x5d788e=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x1c1)]],_0x5a9ed0=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x1c7)]],_0x41e375=[..._0x4ba146[_0x52c161(0x16a)][_0x52c161(0x1aa)]],_0x1f8ff2=[..._0x4ba146['body'][_0x52c161(0x162)]];const _0x998448=_0x2d0357['map'](_0x36ba9d=>{return _0x36ba9d={'product_name':_0x36ba9d};});_0x40b380['forEach']((_0x3280b2,_0x3c0308)=>{_0x998448[_0x3c0308]['bay']=_0x3280b2;}),_0x2cfbdd[_0x52c161(0x1c9)]((_0x40fe7d,_0x2309fe)=>{_0x998448[_0x2309fe]['stockBefore']=_0x40fe7d;}),_0x4192d0[_0x52c161(0x1c9)]((_0x42848a,_0x17f5cb)=>{var _0x2000b4=_0x52c161;_0x998448[_0x17f5cb][_0x2000b4(0x199)]=_0x42848a;}),_0x1d1491['forEach']((_0x3cd1da,_0x25d7c6)=>{_0x998448[_0x25d7c6]['adjust_qty']=_0x3cd1da;}),_0x389503[_0x52c161(0x1c9)]((_0x1c5c07,_0x3cf4eb)=>{var _0x13284c=_0x52c161;_0x998448[_0x3cf4eb][_0x13284c(0x1a2)]=_0x1c5c07;}),_0x5d788e[_0x52c161(0x1c9)]((_0x149626,_0x4bf9e8)=>{var _0x1c8bda=_0x52c161;_0x998448[_0x4bf9e8][_0x1c8bda(0x1c1)]=_0x149626;}),_0x5a9ed0[_0x52c161(0x1c9)]((_0x6a4d6d,_0x40b4d5)=>{var _0x36bc10=_0x52c161;_0x998448[_0x40b4d5][_0x36bc10(0x1ae)]=_0x6a4d6d;}),_0x558c3c[_0x52c161(0x1c9)]((_0x2fb762,_0x1fb175)=>{var _0xe6979d=_0x52c161;_0x998448[_0x1fb175][_0xe6979d(0x1db)]=_0x2fb762;}),_0x41e375[_0x52c161(0x1c9)]((_0x2e24af,_0x53d327)=>{var _0x5b7c0f=_0x52c161;_0x998448[_0x53d327][_0x5b7c0f(0x1aa)]=_0x2e24af;}),_0x1f8ff2['forEach']((_0x4e9b9e,_0x342f1e)=>{var _0x39317a=_0x52c161;_0x998448[_0x342f1e][_0x39317a(0x162)]=_0x4e9b9e;});const _0x5cb379=_0x998448[_0x52c161(0x1ca)](_0x1f6a29=>_0x1f6a29['adjust_qty']!=='0'&&_0x1f6a29[_0x52c161(0x1d1)]!=='');var _0x5ea56e=0x0;_0x5cb379[_0x52c161(0x1c9)](_0x5ee0be=>{var _0x257082=_0x52c161;console[_0x257082(0x187)](_0x257082(0x148),_0x5ee0be),parseInt(_0x5ee0be[_0x257082(0x1d1)])<=0x0&&_0x5ea56e++;});if(_0x5ea56e!=0x0)return _0x4ba146[_0x52c161(0x13e)](_0x52c161(0x18f),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x395c80[_0x52c161(0x181)](_0x52c161(0x125));_0x38cb6f[_0x52c161(0x176)]=_0x6a1528,_0x38cb6f[_0x52c161(0x15e)]=_0x22d55c,_0x38cb6f[_0x52c161(0x1b3)]=_0x5cb379,_0x38cb6f[_0x52c161(0x134)]=_0x2c8109,_0x38cb6f[_0x52c161(0x1df)]=_0x2d5a45,_0x38cb6f['invoice']=_0x229be8,_0x38cb6f[_0x52c161(0x161)]=_0x170e47;const _0x1a4830=await _0x38cb6f[_0x52c161(0x1d5)](),_0xc41c19=await warehouse['findOne']({'name':_0x6a1528,'room':_0x2d5a45});_0x1a4830[_0x52c161(0x1b3)][_0x52c161(0x1c9)](_0x613b2=>{var _0x80fbdc=_0x52c161;const _0x26ba49=_0xc41c19['product_details'][_0x80fbdc(0x197)](_0x18789f=>{var _0x14a858=_0x80fbdc;_0x613b2['types']==_0x14a858(0x144)?_0x18789f[_0x14a858(0x15c)]==_0x613b2[_0x14a858(0x15c)]&&_0x18789f['bay']==_0x613b2[_0x14a858(0x170)]&&(_0x18789f[_0x14a858(0x186)]=parseInt(_0x18789f[_0x14a858(0x186)])-parseInt(_0x613b2[_0x14a858(0x1d1)])):_0x18789f[_0x14a858(0x15c)]==_0x613b2['product_name']&&_0x18789f[_0x14a858(0x170)]==_0x613b2['bay']&&(_0x18789f[_0x14a858(0x186)]=parseInt(_0x18789f[_0x14a858(0x186)])+parseInt(_0x613b2[_0x14a858(0x1d1)]));});}),await _0xc41c19[_0x52c161(0x1d5)](),_0x4ba146[_0x52c161(0x13e)](_0x52c161(0x1bf),_0x52c161(0x17f)),_0x395c80[_0x52c161(0x181)]('/adjustment_finished/view');}catch(_0x17052c){console[_0x52c161(0x187)](_0x17052c);}}),router[a0_0x46806f(0x195)]('/barcode_scanner',async(_0x25233f,_0x3fd438)=>{var _0xdbb350=a0_0x46806f;const {primary_code:_0x5f1489,warehouse_data:_0x2b2ce9,rooms_data:_0x24b719,Roomslist:_0x56c1ac}=_0x25233f[_0xdbb350(0x16a)],_0x3e7772=_0x56c1ac[_0xdbb350(0x198)](','),_0x3dd908=[];async function _0x8569a6(_0x727b26){var _0x7ef38f=_0xdbb350;const _0x395fab=await warehouse['aggregate']([{'$match':{'name':_0x2b2ce9,'room':_0x727b26}},{'$unwind':_0x7ef38f(0x145)},{'$match':{'product_details.primary_code':_0x5f1489}},{'$group':{'_id':_0x7ef38f(0x133),'name':{'$first':_0x7ef38f(0x16d)},'product_stock':{'$first':_0x7ef38f(0x12d)},'primary_code':{'$first':_0x7ef38f(0x17a)},'secondary_code':{'$first':_0x7ef38f(0x175)},'product_code':{'$first':_0x7ef38f(0x166)},'level':{'$first':_0x7ef38f(0x14a)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x7ef38f(0x17c)},'pallet':{'$first':_0x7ef38f(0x15f)},'unit':{'$first':_0x7ef38f(0x137)},'secondary_unit':{'$first':_0x7ef38f(0x1a6)},'storage':{'$first':_0x7ef38f(0x193)},'rack':{'$first':_0x7ef38f(0x132)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x7ef38f(0x131)},'batch_code':{'$first':_0x7ef38f(0x172)},'product_cat':{'$first':'P'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'roomNamed':{'$first':_0x7ef38f(0x154)},'invoice':{'$first':_0x7ef38f(0x143)}}}]),_0x295817=await warehouse[_0x7ef38f(0x122)]([{'$match':{'name':_0x2b2ce9,'room':_0x727b26}},{'$unwind':'$product_details'},{'$match':{'product_details.secondary_code':_0x5f1489}},{'$group':{'_id':_0x7ef38f(0x133),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x7ef38f(0x12d)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x7ef38f(0x175)},'product_code':{'$first':_0x7ef38f(0x166)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x7ef38f(0x124)},'type':{'$first':_0x7ef38f(0x17c)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':'$product_details.unit'},'secondary_unit':{'$first':_0x7ef38f(0x1a6)},'storage':{'$first':_0x7ef38f(0x193)},'rack':{'$first':_0x7ef38f(0x132)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x7ef38f(0x131)},'batch_code':{'$first':_0x7ef38f(0x172)},'product_cat':{'$first':'S'},'maxPerUnit':{'$first':_0x7ef38f(0x180)},'roomNamed':{'$first':_0x7ef38f(0x154)},'invoice':{'$first':'$product_details.invoice'}}}]);if(_0x395fab[_0x7ef38f(0x18d)]>0x0)_0x3dd908['push'](_0x395fab);else _0x295817[_0x7ef38f(0x18d)]>0x0&&_0x3dd908['push'](_0x295817);}const _0x1a3b06=_0x3e7772['map'](_0x54c09b=>_0x8569a6(_0x54c09b));await Promise[_0xdbb350(0x1e4)](_0x1a3b06),_0x3fd438[_0xdbb350(0x15d)](_0x3dd908);}),router[a0_0x46806f(0x195)]('/CheckingWarehouse',async(_0x19cf28,_0x52fbd7)=>{var _0x47a9b4=a0_0x46806f;const {productCode:_0x426e97,bay:_0x543311,warehouses:_0x227337,room:_0x2526e5}=_0x19cf28[_0x47a9b4(0x16a)];console[_0x47a9b4(0x187)](_0x19cf28[_0x47a9b4(0x16a)]);try{const _0xb39cdc=await warehouse[_0x47a9b4(0x122)]([{'$match':{'name':_0x227337,'room':_0x2526e5}},{'$unwind':'$product_details'},{'$match':{'product_details.bay':parseInt(_0x543311)}},{'$group':{'_id':_0x47a9b4(0x133),'name':{'$first':_0x47a9b4(0x16d)},'product_stock':{'$first':_0x47a9b4(0x12d)},'bay':{'$first':'$product_details.bay'},'maxProducts':{'$first':_0x47a9b4(0x19b)}}}]);_0x52fbd7[_0x47a9b4(0x190)](0xc8)['json'](_0xb39cdc);}catch(_0x2130a2){_0x52fbd7[_0x47a9b4(0x190)](0x194)[_0x47a9b4(0x15d)]({'message':_0x2130a2['message']});}}),module[a0_0x46806f(0x1c6)]=router;