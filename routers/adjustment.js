var a0_0x5e5878=a0_0x2f84;(function(_0x26bc43,_0x51e99a){var _0x42315c=a0_0x2f84,_0x295426=_0x26bc43();while(!![]){try{var _0x5c8802=-parseInt(_0x42315c(0x1d1))/0x1*(parseInt(_0x42315c(0x1a1))/0x2)+parseInt(_0x42315c(0x19e))/0x3+-parseInt(_0x42315c(0x14c))/0x4+parseInt(_0x42315c(0x1b7))/0x5*(parseInt(_0x42315c(0x176))/0x6)+-parseInt(_0x42315c(0x181))/0x7+-parseInt(_0x42315c(0x1fb))/0x8*(-parseInt(_0x42315c(0x14d))/0x9)+parseInt(_0x42315c(0x216))/0xa*(parseInt(_0x42315c(0x1f6))/0xb);if(_0x5c8802===_0x51e99a)break;else _0x295426['push'](_0x295426['shift']());}catch(_0x54485e){_0x295426['push'](_0x295426['shift']());}}}(a0_0x3198,0xc38b7));function a0_0x3198(){var _0x386792=['Level','Router','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','English','save','push','</h5>','Spanish','</table>','\x20Order\x20Number\x20:\x20','5800sktHCT','findOne','params','/barcode_scanner','slice','body','find','Receiving\x20Area','product','3810384kPyPDR','9qNEkcu','Enclosed','/view','batch_code','There\x27s\x20a\x20error\x20in\x20this\x20transaction','language','\x20<>\x20','$product_details.product_code','$product_details._id','$room','max_per_unit','redirect','New_Qty_Converted_adj','Floor','Enabled','$product.product_name','flash','render','site_title','edit_adjustment_view','id_transaction_from','log','Rooms','/../public','product_details','expiry_date','bay','<div>','padStart','warehouse','$warehouse_name','False','Types','minus','new_adjust_qty','<h2>\x20','isAllowEdit','adjustment\x20add\x20successfull','adjustment\x20data\x20update\x20successfully','mongoose','exports','1390986pFpBvq','/adjustment/preview/','rack','Hindi','_id','Ambient','French','$product_details.floorlevel','type','post','map','9871218CdcGqZ','$isAllowEdit','back','json','status','$product_details.rack','unit','$product_details.secondary_code','filter','$product','length','<tr>','valueOf','production_date','Arabic\x20(ae)','port','prod_code','logo','Portuguese','stockBefore','product_code','ADJ-','warehouse_name','$product_details.product_stock','id_transaction','<!DOCTYPE\x20html>','</tr>','success','edit_adjustment','1820892cqSqfO','$product_details.batch_code','random','826132dEdljM','$product_details.unit','errors','Chinese','prod_name','$product_details.secondary_unit','createTransport','True','</td>','aggregate','ObjectId','types','RMSEmail','second1','role','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','$_id','Raw\x20Materials','floorlevel','</div>','$product_details.storage','secondary_code','10tReedv','/adjustment/view','$product_details.isle','/view/:id','$product_details.expiry_date','room_names','catch','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','$product_details','$product_details.bay','Return\x20Rooms','/upload/','Error\x20Occurs','$product_details.product_name','<h5>','prime1','$product_details.primary_code','secondary_unit','<tbody\x20style=\x22text-align:\x20center;\x22>','$product_details.pallet','$finalize','New_Qty_Converted','user','add_adjustment','../models/all_models','3mZKYoi','finalize','primary_code','Secondary_units','product_name','adjustment','\x20</h2>','prod_invoice','staff','English\x20(US)','$product_details.type','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','express','findById','<table\x20style=\x22width:\x20100%\x20!important;\x22>','$product.room_names','Arabic','Return\x20Goods','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','invoice','stock','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','adjust_qty','sendMail','<strong>\x20Regards\x20</strong>','foreach\x20newproduct','maxperunit','string','</tbody>','email','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','</thead>','../middleware/auth','<span\x20style=\x22float:\x20right;\x22>','Portuguese\x20(BR)','then','room','51568eelrxz','$product_details.maxPerUnit','prod_cat','/view/add_adjustment','level','4906024cEGVqz','date','forEach','$product_details.production_date','product_stock','bin','$product_details.product_cat','/preview/:id','updateOne','$product_details.bin','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','$name','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','toString','storage','German','get'];a0_0x3198=function(){return _0x386792;};return a0_0x3198();}const express=require(a0_0x5e5878(0x1dd)),app=express(),router=express[a0_0x5e5878(0x20d)](),auth=require(a0_0x5e5878(0x1f1)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,supervisor_settings,email_settings}=require(a0_0x5e5878(0x1d0)),users=require('../public/language/languages.json'),nodemailer=require('nodemailer'),mongoose=require(a0_0x5e5878(0x174));function a0_0x2f84(_0x2c5159,_0x43956d){var _0x319891=a0_0x3198();return a0_0x2f84=function(_0x2f843a,_0x19e06e){_0x2f843a=_0x2f843a-0x14b;var _0x4f3492=_0x319891[_0x2f843a];return _0x4f3492;},a0_0x2f84(_0x2c5159,_0x43956d);}router[a0_0x5e5878(0x20b)](a0_0x5e5878(0x14f),auth,async(_0x17813e,_0x20be9d)=>{var _0x2bf9de=a0_0x5e5878;try{const {username:_0x52793f,email:_0x319780,role:_0x2c7192}=_0x17813e['user'],_0x394fd5=_0x17813e['user'],_0x200083=await profile[_0x2bf9de(0x217)]({'email':_0x394fd5[_0x2bf9de(0x1ee)]}),_0x2446df=await master_shop[_0x2bf9de(0x21c)]();console[_0x2bf9de(0x162)]('master',_0x2446df);let _0x527840;if(_0x394fd5[_0x2bf9de(0x1af)]==_0x2bf9de(0x1d9)){const _0x3da0ee=await staff[_0x2bf9de(0x217)]({'email':_0x394fd5[_0x2bf9de(0x1ee)]});_0x527840=await warehouse[_0x2bf9de(0x21c)]({'status':_0x2bf9de(0x15b),'name':_0x3da0ee[_0x2bf9de(0x16a)]});}else _0x527840=await warehouse['find']({'status':_0x2bf9de(0x15b)});const _0xda464=await product[_0x2bf9de(0x21c)]();let _0xa8201d;if(_0x394fd5['role']=='staff'){const _0x416d40=await staff[_0x2bf9de(0x217)]({'email':_0x394fd5[_0x2bf9de(0x1ee)]});_0xa8201d=await adjustment[_0x2bf9de(0x21c)]({'warehouse_name':_0x416d40[_0x2bf9de(0x16a)]});}else _0xa8201d=await adjustment[_0x2bf9de(0x1aa)]([{'$unwind':_0x2bf9de(0x18a)},{'$group':{'_id':_0x2bf9de(0x1b1),'invoice':{'$first':'$invoice'},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x2bf9de(0x16b)},'room':{'$addToSet':_0x2bf9de(0x1e0)},'finalize':{'$first':_0x2bf9de(0x1cc)},'isAllowEdit':{'$first':_0x2bf9de(0x182)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x2446df[0x0][_0x2bf9de(0x152)]==_0x2bf9de(0x1da)){var _0x23a380=users['English'];console[_0x2bf9de(0x162)](_0x23a380);}else{if(_0x2446df[0x0][_0x2bf9de(0x152)]==_0x2bf9de(0x179))var _0x23a380=users[_0x2bf9de(0x179)];else{if(_0x2446df[0x0][_0x2bf9de(0x152)]==_0x2bf9de(0x20a))var _0x23a380=users[_0x2bf9de(0x20a)];else{if(_0x2446df[0x0][_0x2bf9de(0x152)]==_0x2bf9de(0x213))var _0x23a380=users['Spanish'];else{if(_0x2446df[0x0][_0x2bf9de(0x152)]==_0x2bf9de(0x17c))var _0x23a380=users[_0x2bf9de(0x17c)];else{if(_0x2446df[0x0]['language']==_0x2bf9de(0x1f3))var _0x23a380=users[_0x2bf9de(0x193)];else{if(_0x2446df[0x0]['language']==_0x2bf9de(0x1a4))var _0x23a380=users['Chinese'];else{if(_0x2446df[0x0][_0x2bf9de(0x152)]=='Arabic\x20(ae)')var _0x23a380=users[_0x2bf9de(0x1e1)];}}}}}}}_0x20be9d[_0x2bf9de(0x15e)](_0x2bf9de(0x1d6),{'success':_0x17813e[_0x2bf9de(0x15d)](_0x2bf9de(0x19c)),'errors':_0x17813e[_0x2bf9de(0x15d)]('errors'),'role':_0x394fd5,'profile':_0x200083,'warehouse':_0x527840,'product':_0xda464,'adjustment':_0xa8201d,'master_shop':_0x2446df,'language':_0x23a380});}catch(_0xee584a){console[_0x2bf9de(0x162)](_0xee584a);}});async function getRandom8DigitNumber(){var _0x292501=a0_0x5e5878;const _0x2bfa84=0x989680,_0x13304e=0x5f5e0ff,_0x937fe6=Math['floor'](Math[_0x292501(0x1a0)]()*(_0x13304e-_0x2bfa84+0x1))+_0x2bfa84;var _0x13d961;const _0x190d53=await adjustment[_0x292501(0x217)]({'invoice':_0x292501(0x196)+_0x937fe6});return _0x190d53&&_0x190d53['length']>0x0?_0x13d961=_0x292501(0x196)+_0x937fe6:_0x13d961=_0x292501(0x196)+_0x937fe6,_0x13d961;}router['get'](a0_0x5e5878(0x1f9),auth,async(_0x4df4ae,_0x44c6cf)=>{var _0x1a5daa=a0_0x5e5878;try{const {username:_0x43a5ae,email:_0x25bc28,role:_0x3271ce}=_0x4df4ae[_0x1a5daa(0x1ce)],_0x3d513f=_0x4df4ae['user'],_0x10b54e=await profile[_0x1a5daa(0x217)]({'email':_0x3d513f[_0x1a5daa(0x1ee)]}),_0x44e2a1=await master_shop[_0x1a5daa(0x21c)]();let _0x329d0f;if(_0x3d513f[_0x1a5daa(0x1af)]==_0x1a5daa(0x1d9)){const _0x160cf3=await staff[_0x1a5daa(0x217)]({'email':_0x3d513f['email']});_0x329d0f=await warehouse[_0x1a5daa(0x1aa)]([{'$match':{'status':_0x1a5daa(0x15b),'name':_0x160cf3[_0x1a5daa(0x16a)],'warehouse_category':_0x1a5daa(0x1b2),'name':{'$ne':_0x1a5daa(0x1e2)}}},{'$group':{'_id':_0x1a5daa(0x206),'name':{'$first':_0x1a5daa(0x206)}}}]);}else _0x329d0f=await warehouse['aggregate']([{'$match':{'status':_0x1a5daa(0x15b),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x1a5daa(0x1e2)}}},{'$group':{'_id':_0x1a5daa(0x206),'name':{'$first':_0x1a5daa(0x206)}}}]);const _0x462def=await product['find']({}),_0x3a4fb4=await adjustment['find']({}),_0x3e6e0d=_0x3a4fb4[_0x1a5daa(0x18b)]+0x1,_0x4a1bea='ADJ-'+_0x3e6e0d[_0x1a5daa(0x208)]()[_0x1a5daa(0x169)](0x5,'0');var _0x429ece=[_0x1a5daa(0x17b),_0x1a5daa(0x14e),_0x1a5daa(0x1c2)];if(_0x44e2a1[0x0][_0x1a5daa(0x152)]==_0x1a5daa(0x1da))var _0x1fb8d8=users[_0x1a5daa(0x20f)];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]=='Hindi')var _0x1fb8d8=users[_0x1a5daa(0x179)];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]==_0x1a5daa(0x20a))var _0x1fb8d8=users[_0x1a5daa(0x20a)];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]==_0x1a5daa(0x213))var _0x1fb8d8=users[_0x1a5daa(0x213)];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]==_0x1a5daa(0x17c))var _0x1fb8d8=users['French'];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]==_0x1a5daa(0x1f3))var _0x1fb8d8=users[_0x1a5daa(0x193)];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]==_0x1a5daa(0x1a4))var _0x1fb8d8=users[_0x1a5daa(0x1a4)];else{if(_0x44e2a1[0x0][_0x1a5daa(0x152)]=='Arabic\x20(ae)')var _0x1fb8d8=users[_0x1a5daa(0x1e1)];}}}}}}}const _0x50daaf=getRandom8DigitNumber();_0x50daaf[_0x1a5daa(0x1f4)](_0x209f91=>{var _0x5539a7=_0x1a5daa;_0x44c6cf['render'](_0x5539a7(0x1cf),{'success':_0x4df4ae[_0x5539a7(0x15d)](_0x5539a7(0x19c)),'errors':_0x4df4ae[_0x5539a7(0x15d)](_0x5539a7(0x1a3)),'role':_0x3d513f,'profile':_0x10b54e,'warehouse':_0x329d0f,'product':_0x462def,'master_shop':_0x44e2a1,'language':_0x1fb8d8,'rooms_data':_0x429ece,'invoice_no':_0x209f91});})[_0x1a5daa(0x1bd)](_0x4a8f7e=>{var _0x426a32=_0x1a5daa;_0x4df4ae[_0x426a32(0x15d)](_0x426a32(0x1a3),_0x426a32(0x151)),_0x44c6cf[_0x426a32(0x158)]('/adjustment/view');});}catch(_0x40f9ea){console['log'](_0x40f9ea);}}),router[a0_0x5e5878(0x17f)](a0_0x5e5878(0x1f9),auth,async(_0x584248,_0x4e6bd4)=>{var _0x1a31a7=a0_0x5e5878;try{const {warehouse_name:_0x1b6467,date:_0x13ed13,prod_name:_0x474224,level:_0x5995d1,isle:_0x28274f,pallet:_0x3b2bb2,stock:_0x376aee,types:_0x1936df,adjust_qty:_0x5369b3,new_adjust_qty:_0x154638,note:_0x5b85da,Room_name:_0x4fec50,invoice:_0x5d1583,JO_number:_0x1ade7c,expiry_date:_0x5a1b64}=_0x584248[_0x1a31a7(0x21b)];if(typeof _0x474224==_0x1a31a7(0x1ec))var _0x9070e0=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1a5)]],_0x587227=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1fa)]],_0x1e8621=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1e5)]],_0x4e4108=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1ac)]],_0x47cff1=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x159)]],_0x36058a=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1cd)]],_0x178367=[_0x584248[_0x1a31a7(0x21b)]['Primary_Units']],_0x3ccd80=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1d4)]],_0x12a6c8=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x191)]],_0x44a6a0=[_0x584248[_0x1a31a7(0x21b)]['batch_code']],_0x41de66=[_0x584248[_0x1a31a7(0x21b)]['expiry_date']],_0x3b038f=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x157)]],_0x2d4c18=[_0x584248[_0x1a31a7(0x21b)]['production_date']],_0x3d77da=[_0x584248['body'][_0x1a31a7(0x1f8)]],_0x147717=[_0x584248[_0x1a31a7(0x21b)]['Rooms']],_0x1d1e39=[_0x584248['body'][_0x1a31a7(0x1c7)]],_0x5678cc=[_0x584248[_0x1a31a7(0x21b)]['second1']],_0x2f13b6=[_0x584248[_0x1a31a7(0x21b)]['prod_invoice']],_0x203720=[_0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x199)]];else var _0x9070e0=[..._0x584248['body'][_0x1a31a7(0x1a5)]],_0x587227=[..._0x584248['body'][_0x1a31a7(0x1fa)]],_0x1e8621=[..._0x584248['body'][_0x1a31a7(0x1e5)]],_0x4e4108=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1ac)]],_0x47cff1=[..._0x584248['body'][_0x1a31a7(0x159)]],_0x36058a=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1cd)]],_0x178367=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x187)]],_0x3ccd80=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1d4)]],_0x12a6c8=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x191)]],_0x44a6a0=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x150)]],_0x41de66=[..._0x584248['body'][_0x1a31a7(0x166)]],_0x3b038f=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x157)]],_0x2d4c18=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x18e)]],_0x3d77da=[..._0x584248[_0x1a31a7(0x21b)]['prod_cat']],_0x147717=[..._0x584248['body']['Rooms']],_0x1d1e39=[..._0x584248['body'][_0x1a31a7(0x1c7)]],_0x5678cc=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1ae)]],_0x2f13b6=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x1d8)]],_0x203720=[..._0x584248[_0x1a31a7(0x21b)][_0x1a31a7(0x199)]];const _0x37e5d5=_0x9070e0[_0x1a31a7(0x180)](_0x1ff0ec=>{return _0x1ff0ec={'product_name':_0x1ff0ec};});_0x587227[_0x1a31a7(0x1fd)]((_0x3a5418,_0x3d664c)=>{_0x147717['forEach']((_0x18997c,_0x45b68d)=>{var _0x434916=a0_0x2f84;if(_0x18997c==_0x434916(0x21d)&&_0x3d664c==_0x45b68d){var _0x14aa5c=_0x3a5418[_0x434916(0x21a)](0x3);_0x37e5d5[_0x3d664c][_0x434916(0x209)]=_0x3a5418[0x0],_0x37e5d5[_0x3d664c]['rack']=_0x3a5418[0x1],_0x37e5d5[_0x3d664c][_0x434916(0x167)]=0x0,_0x37e5d5[_0x3d664c][_0x434916(0x200)]=0x0,_0x37e5d5[_0x3d664c]['type']=_0x434916(0x15a),_0x37e5d5[_0x3d664c][_0x434916(0x1b3)]=_0x14aa5c;}else{if(_0x18997c=='Shelves'&&_0x3d664c==_0x45b68d){var _0x14aa5c=_0x3a5418[_0x434916(0x21a)](0x3);_0x37e5d5[_0x3d664c]['storage']=_0x3a5418[0x0],_0x37e5d5[_0x3d664c][_0x434916(0x178)]=_0x3a5418[0x1],_0x37e5d5[_0x3d664c]['bay']=0x0,_0x37e5d5[_0x3d664c]['bin']=0x0,_0x37e5d5[_0x3d664c]['type']=_0x434916(0x15a),_0x37e5d5[_0x3d664c][_0x434916(0x1b3)]=_0x3a5418[0x5];}else{if(_0x3d664c==_0x45b68d){var _0x313497;if(_0x3a5418[0x4]=='L')_0x313497=_0x434916(0x20c);else _0x3a5418[0x4]=='F'&&(_0x313497='Floor');_0x37e5d5[_0x3d664c][_0x434916(0x209)]=_0x3a5418[0x0],_0x37e5d5[_0x3d664c]['rack']=_0x3a5418[0x1],_0x37e5d5[_0x3d664c][_0x434916(0x167)]=_0x3a5418[0x2],_0x37e5d5[_0x3d664c][_0x434916(0x200)]=_0x3a5418[0x3],_0x37e5d5[_0x3d664c][_0x434916(0x17e)]=_0x313497,_0x37e5d5[_0x3d664c][_0x434916(0x1b3)]=_0x3a5418[0x5];}}}});}),_0x1e8621[_0x1a31a7(0x1fd)]((_0x4efd47,_0x322623)=>{_0x37e5d5[_0x322623]['stockBefore']=_0x4efd47;}),_0x203720['forEach']((_0x280e13,_0x26188b)=>{var _0x494aaf=_0x1a31a7;_0x37e5d5[_0x26188b][_0x494aaf(0x161)]=_0x280e13;}),_0x4e4108['forEach']((_0x4b85af,_0x145d29)=>{var _0x1e231a=_0x1a31a7;_0x37e5d5[_0x145d29][_0x1e231a(0x1ac)]=_0x4b85af;}),_0x47cff1['forEach']((_0x39d0d3,_0x25875c)=>{_0x37e5d5[_0x25875c]['adjust_qty']=_0x39d0d3;}),_0x36058a[_0x1a31a7(0x1fd)]((_0x34dcd2,_0x3024bb)=>{var _0x1a3132=_0x1a31a7;_0x37e5d5[_0x3024bb][_0x1a3132(0x16f)]=_0x34dcd2;}),_0x178367[_0x1a31a7(0x1fd)]((_0x29d125,_0x412c8d)=>{var _0x45dc6b=_0x1a31a7;_0x37e5d5[_0x412c8d][_0x45dc6b(0x187)]=_0x29d125;}),_0x3ccd80[_0x1a31a7(0x1fd)]((_0x59eec2,_0x2ab1f6)=>{var _0x33a6c1=_0x1a31a7;_0x37e5d5[_0x2ab1f6][_0x33a6c1(0x1c9)]=_0x59eec2;}),_0x12a6c8[_0x1a31a7(0x1fd)]((_0x535913,_0x4e0965)=>{var _0x2a957e=_0x1a31a7;_0x37e5d5[_0x4e0965][_0x2a957e(0x195)]=_0x535913;}),_0x44a6a0['forEach']((_0x36620a,_0x2755d1)=>{_0x37e5d5[_0x2755d1]['batch_code']=_0x36620a;}),_0x41de66[_0x1a31a7(0x1fd)]((_0x536a69,_0x2ec79a)=>{var _0x42f5f6=_0x1a31a7;_0x37e5d5[_0x2ec79a][_0x42f5f6(0x166)]=_0x536a69;}),_0x3b038f[_0x1a31a7(0x1fd)]((_0x1f7f31,_0x403df6)=>{var _0x1924d9=_0x1a31a7;_0x37e5d5[_0x403df6][_0x1924d9(0x1eb)]=_0x1f7f31;}),_0x2d4c18[_0x1a31a7(0x1fd)]((_0x5efdc2,_0x59ed4e)=>{_0x37e5d5[_0x59ed4e]['production_date']=_0x5efdc2;}),_0x3d77da[_0x1a31a7(0x1fd)]((_0x2af561,_0x54cc70)=>{var _0x3b6c9a=_0x1a31a7;_0x37e5d5[_0x54cc70][_0x3b6c9a(0x1f8)]=_0x2af561;}),_0x147717[_0x1a31a7(0x1fd)]((_0x29172a,_0xf3a82a)=>{var _0x410049=_0x1a31a7;_0x37e5d5[_0xf3a82a][_0x410049(0x1bc)]=_0x29172a;}),_0x1d1e39['forEach']((_0x2b0a7e,_0x1ba534)=>{_0x37e5d5[_0x1ba534]['primary_code']=_0x2b0a7e;}),_0x5678cc[_0x1a31a7(0x1fd)]((_0x4a3a3b,_0x1c9b02)=>{_0x37e5d5[_0x1c9b02]['secondary_code']=_0x4a3a3b;}),_0x2f13b6['forEach']((_0x517342,_0x21d6d0)=>{var _0x142519=_0x1a31a7;_0x37e5d5[_0x21d6d0][_0x142519(0x1e4)]=_0x517342;});const _0x5b85d7=_0x37e5d5[_0x1a31a7(0x189)](_0x4dd6db=>_0x4dd6db[_0x1a31a7(0x1e7)]!=='0'&&_0x4dd6db[_0x1a31a7(0x1e7)]!=='');var _0x1e32d8=0x0;_0x5b85d7[_0x1a31a7(0x1fd)](_0x47e03d=>{var _0x1a59f3=_0x1a31a7;console[_0x1a59f3(0x162)](_0x1a59f3(0x1ea),_0x47e03d),parseInt(_0x47e03d[_0x1a59f3(0x1e7)])<=0x0&&_0x1e32d8++;});if(_0x1e32d8!=0x0)return _0x584248[_0x1a31a7(0x15d)]('errors','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x4e6bd4['redirect'](_0x1a31a7(0x183));const _0x2484aa=new adjustment({'warehouse_name':_0x1b6467,'date':_0x13ed13,'product':_0x5b85d7,'note':_0x5b85da,'room':_0x4fec50,'invoice':_0x5d1583,'JO_number':_0x1ade7c,'expiry_date':_0x5a1b64}),_0x37f4d3=await _0x2484aa['save']();_0x584248[_0x1a31a7(0x15d)](_0x1a31a7(0x19c),_0x1a31a7(0x172)),_0x4e6bd4[_0x1a31a7(0x158)](_0x1a31a7(0x177)+_0x37f4d3['_id']);}catch(_0x38dbf6){console[_0x1a31a7(0x162)](_0x38dbf6),_0x4e6bd4[_0x1a31a7(0x185)](0xc8)[_0x1a31a7(0x184)]({'message':_0x38dbf6[_0x1a31a7(0x1be)]});}}),router[a0_0x5e5878(0x20b)](a0_0x5e5878(0x202),auth,async(_0x48b6ab,_0x504739)=>{var _0xd10c5d=a0_0x5e5878;try{const {username:_0x14d957,email:_0x18cd0d,role:_0x4f3315}=_0x48b6ab[_0xd10c5d(0x1ce)],_0x160782=_0x48b6ab[_0xd10c5d(0x1ce)],_0x34ee77=await profile[_0xd10c5d(0x217)]({'email':_0x160782[_0xd10c5d(0x1ee)]}),_0x4e6ad2=await master_shop[_0xd10c5d(0x21c)](),_0x464397=_0x48b6ab[_0xd10c5d(0x218)]['id'],_0x86f966=await adjustment[_0xd10c5d(0x1de)]({'_id':_0x464397}),_0x53dbbc=await purchases[_0xd10c5d(0x1aa)]([{'$match':{'warehouse_name':_0x86f966['warehouse_name']}},{'$unwind':'$product'},{'$group':{'_id':_0xd10c5d(0x15c)}}]),_0x2380b9=await product[_0xd10c5d(0x21c)]({}),_0x13564b=await warehouse[_0xd10c5d(0x1aa)]([{'$match':{'name':_0x86f966['warehouse_name']}},{'$unwind':_0xd10c5d(0x1c0)},{'$group':{'_id':'$product_details._id','name':{'$first':_0xd10c5d(0x1c5)},'product_stock':{'$first':_0xd10c5d(0x198)},'bay':{'$first':_0xd10c5d(0x1c1)},'bin':{'$first':_0xd10c5d(0x204)},'type':{'$first':_0xd10c5d(0x1db)},'floorlevel':{'$first':_0xd10c5d(0x17d)},'primary_code':{'$first':_0xd10c5d(0x1c8)},'secondary_code':{'$first':_0xd10c5d(0x188)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0xd10c5d(0x186)},'maxPerUnit':{'$first':_0xd10c5d(0x1f7)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':_0xd10c5d(0x19f)},'room':{'$first':_0xd10c5d(0x156)}}}]);if(_0x4e6ad2[0x0][_0xd10c5d(0x152)]=='English\x20(US)'){var _0x24d705=users[_0xd10c5d(0x20f)];console['log'](_0x24d705);}else{if(_0x4e6ad2[0x0][_0xd10c5d(0x152)]==_0xd10c5d(0x179))var _0x24d705=users['Hindi'];else{if(_0x4e6ad2[0x0][_0xd10c5d(0x152)]==_0xd10c5d(0x20a))var _0x24d705=users[_0xd10c5d(0x20a)];else{if(_0x4e6ad2[0x0][_0xd10c5d(0x152)]==_0xd10c5d(0x213))var _0x24d705=users[_0xd10c5d(0x213)];else{if(_0x4e6ad2[0x0]['language']==_0xd10c5d(0x17c))var _0x24d705=users[_0xd10c5d(0x17c)];else{if(_0x4e6ad2[0x0]['language']==_0xd10c5d(0x1f3))var _0x24d705=users[_0xd10c5d(0x193)];else{if(_0x4e6ad2[0x0][_0xd10c5d(0x152)]=='Chinese')var _0x24d705=users['Chinese'];else{if(_0x4e6ad2[0x0][_0xd10c5d(0x152)]==_0xd10c5d(0x18f))var _0x24d705=users['Arabic'];}}}}}}}_0x504739['render'](_0xd10c5d(0x160),{'success':_0x48b6ab['flash'](_0xd10c5d(0x19c)),'errors':_0x48b6ab[_0xd10c5d(0x15d)](_0xd10c5d(0x1a3)),'role':_0x160782,'profile':_0x34ee77,'adjustment':_0x86f966,'master_shop':_0x4e6ad2,'warehouse_name':_0x53dbbc,'unit':_0x2380b9,'language':_0x24d705});}catch(_0x4c4cec){console[_0xd10c5d(0x162)](_0x4c4cec),_0x504739['status'](0xc8)['json']({'message':_0x4c4cec[_0xd10c5d(0x1be)]});}}),router[a0_0x5e5878(0x17f)](a0_0x5e5878(0x202),auth,async(_0x104098,_0x57d9fe)=>{var _0x6ab73b=a0_0x5e5878;try{const _0x4c2f36=_0x104098[_0x6ab73b(0x218)]['id'],{warehouse_name:_0x39e125,Room_name:_0x4844b4}=_0x104098[_0x6ab73b(0x21b)],_0x2bacb4=await adjustment[_0x6ab73b(0x1de)]({'_id':_0x4c2f36}),_0x2e40a0=_0x2bacb4[_0x6ab73b(0x14b)]['map'](async _0x5883d3=>{var _0x5cc8fd=_0x6ab73b;if(_0x5883d3[_0x5cc8fd(0x1e7)]>0x0){const _0x50048d=mongoose[_0x5cc8fd(0x16d)][_0x5cc8fd(0x1ab)];var _0x536794=await warehouse[_0x5cc8fd(0x1aa)]([{'$match':{'name':_0x39e125,'room':_0x5883d3[_0x5cc8fd(0x1bc)],'warehouse_category':_0x5cc8fd(0x1b2)}},{'$unwind':_0x5cc8fd(0x1c0)},{'$match':{'product_details._id':_0x50048d(_0x5883d3[_0x5cc8fd(0x161)])}}]),_0x2420b7=0x0;for(let _0x454767=0x0;_0x454767<=_0x536794[_0x5cc8fd(0x18b)]-0x1;_0x454767++){const _0x255e3e=_0x536794[_0x454767];_0x5883d3[_0x5cc8fd(0x1ac)]==_0x5cc8fd(0x16e)?(console['log']('-'),_0x2420b7=parseFloat(_0x536794[_0x454767][_0x5cc8fd(0x165)][_0x5cc8fd(0x1ff)])-parseFloat(_0x5883d3['adjust_qty'])):(console['log']('+'),_0x2420b7=parseFloat(_0x536794[_0x454767][_0x5cc8fd(0x165)][_0x5cc8fd(0x1ff)])+parseFloat(_0x5883d3[_0x5cc8fd(0x1e7)])),await warehouse[_0x5cc8fd(0x203)]({'_id':_0x50048d(_0x255e3e[_0x5cc8fd(0x17a)]['valueOf']()),'product_details._id':_0x50048d(_0x255e3e[_0x5cc8fd(0x165)][_0x5cc8fd(0x17a)])},{'$set':{'product_details.$.product_stock':_0x2420b7,'product_details.$.adj_invoice':_0x2bacb4['invoice']}}),console['log'](_0x255e3e[_0x5cc8fd(0x17a)][_0x5cc8fd(0x18d)]()+_0x5cc8fd(0x153)+_0x255e3e[_0x5cc8fd(0x165)][_0x5cc8fd(0x17a)]+'\x20<>\x20'+_0x2420b7);}}});_0x2bacb4[_0x6ab73b(0x1d2)]=_0x6ab73b(0x1a8);const _0x24182e=await _0x2bacb4['save'](),_0x17cf0c=await master_shop[_0x6ab73b(0x21c)](),_0x436b8a=await email_settings[_0x6ab73b(0x217)](),_0x7a0dfa=await supervisor_settings[_0x6ab73b(0x21c)]();var _0x3d8c38=_0x2bacb4[_0x6ab73b(0x14b)],_0x3e0c03='',_0x503e4b;for(_0x503e4b in _0x3d8c38){_0x3e0c03+=_0x6ab73b(0x18c)+_0x6ab73b(0x207)+_0x3d8c38[_0x503e4b][_0x6ab73b(0x1d5)]+_0x6ab73b(0x1a9)+_0x6ab73b(0x207)+_0x3d8c38[_0x503e4b][_0x6ab73b(0x195)]+_0x6ab73b(0x1a9)+_0x6ab73b(0x207)+_0x3d8c38[_0x503e4b][_0x6ab73b(0x1e7)]+_0x6ab73b(0x1a9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d8c38[_0x503e4b][_0x6ab73b(0x187)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d8c38[_0x503e4b][_0x6ab73b(0x1c9)]+_0x6ab73b(0x1a9)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2bacb4[_0x6ab73b(0x197)]+_0x6ab73b(0x1a9)+_0x6ab73b(0x207)+_0x3d8c38[_0x503e4b][_0x6ab73b(0x1bc)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x3d8c38[_0x503e4b][_0x6ab73b(0x209)]+_0x3d8c38[_0x503e4b][_0x6ab73b(0x178)]+_0x3d8c38[_0x503e4b]['bay']+_0x3d8c38[_0x503e4b]['bin']+_0x3d8c38[_0x503e4b]['type'][0x0]+_0x3d8c38[_0x503e4b][_0x6ab73b(0x1b3)]+_0x6ab73b(0x1a9),_0x6ab73b(0x19b);}let _0x5f22d4=nodemailer[_0x6ab73b(0x1a7)]({'host':_0x436b8a['host'],'port':Number(_0x436b8a[_0x6ab73b(0x190)]),'secure':![],'auth':{'user':_0x436b8a[_0x6ab73b(0x1ee)],'pass':_0x436b8a['password']}}),_0x55171c={'from':_0x436b8a['email'],'to':_0x7a0dfa[0x0][_0x6ab73b(0x1ad)],'subject':'Adjustment\x20Mail','attachments':[{'filename':'Logo.png','path':__dirname+_0x6ab73b(0x164)+_0x6ab73b(0x1c3)+_0x17cf0c[0x0]['image'],'cid':_0x6ab73b(0x192)}],'html':_0x6ab73b(0x19a)+'<html><head><title></title>'+'</head><body>'+_0x6ab73b(0x168)+_0x6ab73b(0x20e)+_0x6ab73b(0x168)+_0x6ab73b(0x205)+_0x6ab73b(0x1b4)+_0x6ab73b(0x168)+_0x6ab73b(0x170)+_0x17cf0c[0x0]['site_title']+_0x6ab73b(0x1d7)+_0x6ab73b(0x1b4)+_0x6ab73b(0x1b4)+'<hr\x20class=\x22my-3\x22>'+'<div>'+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x6ab73b(0x215)+_0x2bacb4[_0x6ab73b(0x1e4)]+'\x20'+_0x6ab73b(0x1f2)+'\x20Order\x20Date\x20:\x20'+_0x2bacb4[_0x6ab73b(0x1fc)]+'\x20'+'</span>'+_0x6ab73b(0x212)+_0x6ab73b(0x1b4)+_0x6ab73b(0x1df)+_0x6ab73b(0x1b0)+_0x6ab73b(0x18c)+_0x6ab73b(0x1bf)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>'+_0x6ab73b(0x1e3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x6ab73b(0x1ef)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+_0x6ab73b(0x1dc)+_0x6ab73b(0x19b)+_0x6ab73b(0x1f0)+_0x6ab73b(0x1ca)+'\x20'+_0x3e0c03+'\x20'+_0x6ab73b(0x1ed)+_0x6ab73b(0x214)+_0x6ab73b(0x168)+_0x6ab73b(0x1e9)+_0x6ab73b(0x1c6)+_0x17cf0c[0x0][_0x6ab73b(0x15f)]+_0x6ab73b(0x212)+_0x6ab73b(0x1b4)+'</div>'+'</body></html>'};_0x5f22d4[_0x6ab73b(0x1e8)](_0x55171c,function(_0x10f58e,_0x1ad954){var _0x69b510=_0x6ab73b;_0x10f58e?(console[_0x69b510(0x162)](_0x10f58e),console[_0x69b510(0x162)](_0x69b510(0x1c4))):console[_0x69b510(0x162)]('Email\x20sent\x20successfully');}),_0x104098[_0x6ab73b(0x15d)](_0x6ab73b(0x19c),'adjustment\x20Finalized\x20successfully'),_0x57d9fe[_0x6ab73b(0x158)]('/picking_list/PDF_adjustment_rm/'+_0x24182e[_0x6ab73b(0x17a)]);}catch(_0x56d814){console[_0x6ab73b(0x162)](_0x56d814),_0x57d9fe['status'](0xc8)[_0x6ab73b(0x184)]({'message':_0x56d814['message']});}}),router['get'](a0_0x5e5878(0x1ba),auth,async(_0x273f53,_0x3bf792)=>{var _0x471251=a0_0x5e5878;try{const {username:_0x539997,email:_0x2c6173,role:_0x232bdc}=_0x273f53[_0x471251(0x1ce)],_0x179780=_0x273f53[_0x471251(0x1ce)],_0x109aea=await profile[_0x471251(0x217)]({'email':_0x179780[_0x471251(0x1ee)]}),_0x48d72d=await master_shop[_0x471251(0x21c)](),_0x42ead4=_0x273f53['params']['id'],_0x5ab337=await adjustment[_0x471251(0x1de)]({'_id':_0x42ead4}),_0x2d9d22=await purchases[_0x471251(0x1aa)]([{'$match':{'warehouse_name':_0x5ab337[_0x471251(0x197)]}},{'$unwind':_0x471251(0x18a)},{'$group':{'_id':_0x471251(0x15c)}}]),_0x4b4a95=await product[_0x471251(0x21c)]({}),_0x4b8018=await warehouse[_0x471251(0x1aa)]([{'$match':{'name':_0x5ab337['warehouse_name']}},{'$unwind':_0x471251(0x1c0)},{'$group':{'_id':_0x471251(0x155),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x471251(0x1c1)},'bin':{'$first':'$product_details.bin'},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x471251(0x17d)},'primary_code':{'$first':_0x471251(0x1c8)},'secondary_code':{'$first':_0x471251(0x188)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x471251(0x1b5)},'rack':{'$first':_0x471251(0x186)},'maxPerUnit':{'$first':_0x471251(0x1f7)},'expiry_date':{'$first':_0x471251(0x1bb)},'production_date':{'$first':'$product_details.production_date'},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x471251(0x156)}}}]);let _0xe5b2cf;if(_0x179780[_0x471251(0x1af)]==_0x471251(0x1d9)){const _0x6d050d=await staff[_0x471251(0x217)]({'email':_0x179780[_0x471251(0x1ee)]});_0xe5b2cf=await warehouse[_0x471251(0x1aa)]([{'$match':{'status':_0x471251(0x15b),'name':_0x6d050d['warehouse'],'warehouse_category':_0x471251(0x1b2),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x471251(0x206),'name':{'$first':_0x471251(0x206)}}}]);}else _0xe5b2cf=await warehouse['aggregate']([{'$match':{'status':_0x471251(0x15b),'warehouse_category':_0x471251(0x1b2),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x471251(0x206),'name':{'$first':_0x471251(0x206)}}}]);if(_0x48d72d[0x0][_0x471251(0x152)]==_0x471251(0x1da)){var _0x28242e=users['English'];console[_0x471251(0x162)](_0x28242e);}else{if(_0x48d72d[0x0][_0x471251(0x152)]==_0x471251(0x179))var _0x28242e=users[_0x471251(0x179)];else{if(_0x48d72d[0x0][_0x471251(0x152)]=='German')var _0x28242e=users['German'];else{if(_0x48d72d[0x0][_0x471251(0x152)]==_0x471251(0x213))var _0x28242e=users[_0x471251(0x213)];else{if(_0x48d72d[0x0][_0x471251(0x152)]=='French')var _0x28242e=users['French'];else{if(_0x48d72d[0x0][_0x471251(0x152)]==_0x471251(0x1f3))var _0x28242e=users[_0x471251(0x193)];else{if(_0x48d72d[0x0]['language']==_0x471251(0x1a4))var _0x28242e=users[_0x471251(0x1a4)];else{if(_0x48d72d[0x0][_0x471251(0x152)]==_0x471251(0x18f))var _0x28242e=users[_0x471251(0x1e1)];}}}}}}}_0x3bf792[_0x471251(0x15e)](_0x471251(0x19d),{'success':_0x273f53['flash']('success'),'errors':_0x273f53[_0x471251(0x15d)]('errors'),'role':_0x179780,'profile':_0x109aea,'adjustment':_0x5ab337,'stock':_0x4b8018,'master_shop':_0x48d72d,'warehouse_name':_0x2d9d22,'unit':_0x4b4a95,'language':_0x28242e,'warehouse':_0xe5b2cf});}catch(_0x31032b){console[_0x471251(0x162)](_0x31032b),_0x3bf792[_0x471251(0x185)](0xc8)[_0x471251(0x184)]({'message':_0x31032b[_0x471251(0x1be)]});}}),router[a0_0x5e5878(0x17f)](a0_0x5e5878(0x1ba),auth,async(_0x31e5b5,_0x18b309)=>{var _0x385691=a0_0x5e5878;try{const _0x275901=_0x31e5b5[_0x385691(0x218)]['id'],_0x3d5e31=await adjustment['findById']({'_id':_0x275901}),_0x6ae42c=await warehouse[_0x385691(0x217)]({'name':_0x3d5e31[_0x385691(0x197)],'room':_0x3d5e31[_0x385691(0x1f5)]}),{warehouse_name:_0x24e9f4,date:_0x3b10c4,prod_name:_0x2d9649,level:_0x245dea,isle:_0xa3ac0e,pallet:_0x3bcef5,stock:_0x1e9f70,types:_0x570aef,adjust_qty:_0x5b7758,new_adjust_qty:_0x404d04,note:_0x59789e,Room_name:_0x4c8354,invoice:_0x4b85d4,JO_number:_0x5d66cd,expiry_date:_0x13cbcb}=_0x31e5b5[_0x385691(0x21b)];if(typeof _0x2d9649==_0x385691(0x1ec))var _0x15d80f=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x1a5)]],_0x2d61de=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x1fa)]],_0x275707=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x1e5)]],_0x59ed27=[_0x31e5b5[_0x385691(0x21b)]['types']],_0x5114e7=[_0x31e5b5['body'][_0x385691(0x159)]],_0x55d866=[_0x31e5b5['body'][_0x385691(0x1cd)]],_0x1806c6=[_0x31e5b5[_0x385691(0x21b)]['Primary_Units']],_0xd09ca=[_0x31e5b5[_0x385691(0x21b)]['Secondary_units']],_0x20e98c=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x191)]],_0x56f20f=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x150)]],_0x4ce423=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x166)]],_0x3a394b=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x157)]],_0x396380=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x18e)]],_0x175cf4=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x1f8)]],_0x24013d=[_0x31e5b5[_0x385691(0x21b)][_0x385691(0x163)]],_0x225df0=[_0x31e5b5['body'][_0x385691(0x1c7)]],_0x185b81=[_0x31e5b5['body'][_0x385691(0x1ae)]];else var _0x15d80f=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x1a5)]],_0x2d61de=[..._0x31e5b5['body']['level']],_0x275707=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x1e5)]],_0x59ed27=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x1ac)]],_0x5114e7=[..._0x31e5b5['body'][_0x385691(0x159)]],_0x55d866=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x1cd)]],_0x1806c6=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x187)]],_0xd09ca=[..._0x31e5b5['body'][_0x385691(0x1d4)]],_0x20e98c=[..._0x31e5b5['body'][_0x385691(0x191)]],_0x56f20f=[..._0x31e5b5['body'][_0x385691(0x150)]],_0x4ce423=[..._0x31e5b5['body']['expiry_date']],_0x3a394b=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x157)]],_0x396380=[..._0x31e5b5[_0x385691(0x21b)]['production_date']],_0x175cf4=[..._0x31e5b5['body'][_0x385691(0x1f8)]],_0x24013d=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x163)]],_0x225df0=[..._0x31e5b5[_0x385691(0x21b)][_0x385691(0x1c7)]],_0x185b81=[..._0x31e5b5[_0x385691(0x21b)]['second1']];const _0x2d3253=_0x15d80f['map'](_0xa800c4=>{return _0xa800c4={'product_name':_0xa800c4};});_0x2d61de[_0x385691(0x1fd)]((_0x5306c1,_0x1e32c3)=>{_0x24013d['forEach']((_0x40b7c3,_0x5bd352)=>{var _0x2e534d=a0_0x2f84;if(_0x40b7c3=='Receiving\x20Area'&&_0x1e32c3==_0x5bd352){var _0xd2df19=_0x5306c1['slice'](0x3);_0x2d3253[_0x1e32c3][_0x2e534d(0x209)]=_0x5306c1[0x0],_0x2d3253[_0x1e32c3][_0x2e534d(0x178)]=_0x5306c1[0x1],_0x2d3253[_0x1e32c3][_0x2e534d(0x167)]=0x0,_0x2d3253[_0x1e32c3]['bin']=0x0,_0x2d3253[_0x1e32c3][_0x2e534d(0x17e)]='Floor',_0x2d3253[_0x1e32c3]['floorlevel']=_0xd2df19;}else{if(_0x40b7c3=='Shelves'&&_0x1e32c3==_0x5bd352){var _0xd2df19=_0x5306c1[_0x2e534d(0x21a)](0x3);_0x2d3253[_0x1e32c3][_0x2e534d(0x209)]=_0x5306c1[0x0],_0x2d3253[_0x1e32c3][_0x2e534d(0x178)]=_0x5306c1[0x1],_0x2d3253[_0x1e32c3][_0x2e534d(0x167)]=0x0,_0x2d3253[_0x1e32c3][_0x2e534d(0x200)]=0x0,_0x2d3253[_0x1e32c3][_0x2e534d(0x17e)]=_0x2e534d(0x15a),_0x2d3253[_0x1e32c3][_0x2e534d(0x1b3)]=_0x5306c1[0x5];}else{if(_0x1e32c3==_0x5bd352){var _0x4b13c9;if(_0x5306c1[0x4]=='L')_0x4b13c9=_0x2e534d(0x20c);else _0x5306c1[0x4]=='F'&&(_0x4b13c9=_0x2e534d(0x15a));_0x2d3253[_0x1e32c3][_0x2e534d(0x209)]=_0x5306c1[0x0],_0x2d3253[_0x1e32c3][_0x2e534d(0x178)]=_0x5306c1[0x1],_0x2d3253[_0x1e32c3][_0x2e534d(0x167)]=_0x5306c1[0x2],_0x2d3253[_0x1e32c3][_0x2e534d(0x200)]=_0x5306c1[0x3],_0x2d3253[_0x1e32c3][_0x2e534d(0x17e)]=_0x4b13c9,_0x2d3253[_0x1e32c3][_0x2e534d(0x1b3)]=_0x5306c1[0x5];}}}});}),_0x275707[_0x385691(0x1fd)]((_0x42728e,_0x46458f)=>{var _0x2957b6=_0x385691;_0x2d3253[_0x46458f][_0x2957b6(0x194)]=_0x42728e;}),_0x59ed27['forEach']((_0x296340,_0x9904ab)=>{var _0x430e09=_0x385691;_0x2d3253[_0x9904ab][_0x430e09(0x1ac)]=_0x296340;}),_0x5114e7['forEach']((_0x582f5c,_0x50945e)=>{var _0x559738=_0x385691;_0x2d3253[_0x50945e][_0x559738(0x1e7)]=_0x582f5c;}),_0x55d866['forEach']((_0x95b245,_0x610bde)=>{var _0x33b911=_0x385691;_0x2d3253[_0x610bde][_0x33b911(0x16f)]=_0x95b245;}),_0x1806c6[_0x385691(0x1fd)]((_0x466d36,_0x191eaa)=>{var _0x1d9f47=_0x385691;_0x2d3253[_0x191eaa][_0x1d9f47(0x187)]=_0x466d36;}),_0xd09ca[_0x385691(0x1fd)]((_0x41d750,_0x2308f8)=>{_0x2d3253[_0x2308f8]['secondary_unit']=_0x41d750;}),_0x20e98c[_0x385691(0x1fd)]((_0x9fa17c,_0x46db69)=>{var _0x30823a=_0x385691;_0x2d3253[_0x46db69][_0x30823a(0x195)]=_0x9fa17c;}),_0x56f20f[_0x385691(0x1fd)]((_0x4a4347,_0x2be236)=>{_0x2d3253[_0x2be236]['batch_code']=_0x4a4347;}),_0x4ce423[_0x385691(0x1fd)]((_0x4a393f,_0x143885)=>{var _0x2123d0=_0x385691;_0x2d3253[_0x143885][_0x2123d0(0x166)]=_0x4a393f;}),_0x3a394b[_0x385691(0x1fd)]((_0x1df0c1,_0x506af9)=>{_0x2d3253[_0x506af9]['maxperunit']=_0x1df0c1;}),_0x396380[_0x385691(0x1fd)]((_0x51ec9f,_0x162d68)=>{_0x2d3253[_0x162d68]['production_date']=_0x51ec9f;}),_0x175cf4['forEach']((_0x51d3ae,_0x37afca)=>{var _0x36a79c=_0x385691;_0x2d3253[_0x37afca][_0x36a79c(0x1f8)]=_0x51d3ae;}),_0x24013d[_0x385691(0x1fd)]((_0x34313a,_0x1be1d9)=>{var _0x321ab1=_0x385691;_0x2d3253[_0x1be1d9][_0x321ab1(0x1bc)]=_0x34313a;}),_0x225df0[_0x385691(0x1fd)]((_0x526fba,_0x2f5eae)=>{var _0x5e6382=_0x385691;_0x2d3253[_0x2f5eae][_0x5e6382(0x1d3)]=_0x526fba;}),_0x185b81[_0x385691(0x1fd)]((_0x59b87,_0x157558)=>{var _0x1a15aa=_0x385691;_0x2d3253[_0x157558][_0x1a15aa(0x1b6)]=_0x59b87;});const _0x3bc526=_0x2d3253['filter'](_0xb88c71=>_0xb88c71[_0x385691(0x1e7)]!=='0'&&_0xb88c71[_0x385691(0x1e7)]!=='');var _0x141ea3=0x0;_0x3bc526[_0x385691(0x1fd)](_0x2d1b31=>{var _0x598cd5=_0x385691;console[_0x598cd5(0x162)]('foreach\x20newproduct',_0x2d1b31),parseInt(_0x2d1b31['adjust_qty'])<=0x0&&_0x141ea3++;});if(_0x141ea3!=0x0)return _0x31e5b5[_0x385691(0x15d)]('errors',_0x385691(0x1e6)),_0x18b309[_0x385691(0x158)](_0x385691(0x183));_0x3d5e31[_0x385691(0x197)]=_0x24e9f4,_0x3d5e31['date']=_0x3b10c4,_0x3d5e31[_0x385691(0x14b)]=_0x3bc526,_0x3d5e31['note']=_0x59789e,_0x3d5e31['invoice']=_0x4b85d4,_0x3d5e31[_0x385691(0x171)]=_0x385691(0x16c);const _0x3db9e5=await _0x3d5e31[_0x385691(0x210)]();_0x31e5b5['flash'](_0x385691(0x19c),_0x385691(0x173)),_0x18b309[_0x385691(0x158)](_0x385691(0x1b8));}catch(_0x30f401){console[_0x385691(0x162)](_0x30f401);}}),router[a0_0x5e5878(0x17f)](a0_0x5e5878(0x219),async(_0x25e8d3,_0x1af2a4)=>{var _0xbf39e4=a0_0x5e5878;const {primary_code:_0x2704f4,warehouse_data:_0x47a685,rooms_data:_0x5ccab2,Roomslist:_0x163d5f}=_0x25e8d3[_0xbf39e4(0x21b)],_0x7c3605=_0x163d5f['split'](','),_0x5cafe8=[];async function _0x4f7553(_0x3bf912){var _0x1bdcfd=_0xbf39e4;const _0x627df5=await warehouse['aggregate']([{'$match':{'name':_0x47a685,'room':_0x3bf912}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x2704f4}},{'$group':{'_id':_0x1bdcfd(0x155),'name':{'$first':_0x1bdcfd(0x1c5)},'product_stock':{'$first':_0x1bdcfd(0x198)},'primary_code':{'$first':_0x1bdcfd(0x1c8)},'secondary_code':{'$first':_0x1bdcfd(0x188)},'product_code':{'$first':_0x1bdcfd(0x154)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x1bdcfd(0x204)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x1bdcfd(0x17d)},'unit':{'$first':_0x1bdcfd(0x1a2)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x1bdcfd(0x1b5)},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x1bdcfd(0x1bb)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x1bdcfd(0x19f)},'product_cat':{'$first':_0x1bdcfd(0x201)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x1bdcfd(0x156)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x36e052=await warehouse[_0x1bdcfd(0x1aa)]([{'$match':{'name':_0x47a685,'room':_0x3bf912}},{'$unwind':_0x1bdcfd(0x1c0)},{'$match':{'product_details.secondary_code':_0x2704f4}},{'$group':{'_id':_0x1bdcfd(0x155),'name':{'$first':_0x1bdcfd(0x1c5)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x1bdcfd(0x1c8)},'secondary_code':{'$first':_0x1bdcfd(0x188)},'product_code':{'$first':_0x1bdcfd(0x154)},'level':{'$first':_0x1bdcfd(0x1c1)},'isle':{'$first':_0x1bdcfd(0x204)},'type':{'$first':_0x1bdcfd(0x1db)},'pallet':{'$first':_0x1bdcfd(0x17d)},'unit':{'$first':_0x1bdcfd(0x1a2)},'secondary_unit':{'$first':_0x1bdcfd(0x1a6)},'storage':{'$first':_0x1bdcfd(0x1b5)},'rack':{'$first':_0x1bdcfd(0x186)},'expiry_date':{'$first':_0x1bdcfd(0x1bb)},'production_date':{'$first':_0x1bdcfd(0x1fe)},'maxPerUnit':{'$first':_0x1bdcfd(0x1f7)},'batch_code':{'$first':_0x1bdcfd(0x19f)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':'$room'}}}]);if(_0x627df5[_0x1bdcfd(0x18b)]>0x0)_0x5cafe8[_0x1bdcfd(0x211)](_0x627df5);else _0x36e052[_0x1bdcfd(0x18b)]>0x0&&_0x5cafe8['push'](_0x36e052);}const _0x265cfb=_0x7c3605[_0xbf39e4(0x180)](_0x3b3071=>_0x4f7553(_0x3b3071));await Promise['all'](_0x265cfb),_0x1af2a4[_0xbf39e4(0x184)](_0x5cafe8);}),router['post']('/CheckingWarehouse',async(_0x3def1c,_0x350644)=>{var _0xbf6490=a0_0x5e5878;const {primaryCode:_0x3e0454,secondaryCode:_0x1decd7,productCode:_0x1ec5e9,level:_0x2c55d5,isle:_0x5bcf3a,pallet:_0x95454,warehouses:_0x5076e7,room:_0xb3453b}=_0x3def1c['body'];try{const _0x1d7290=await warehouse[_0xbf6490(0x1aa)]([{'$match':{'name':_0x5076e7,'room':_0xb3453b}},{'$unwind':_0xbf6490(0x1c0)},{'$match':{'product_details.level':parseInt(_0x2c55d5),'product_details.isle':_0x5bcf3a,'product_details.pallet':parseInt(_0x95454)}},{'$group':{'_id':_0xbf6490(0x155),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0xbf6490(0x198)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0xbf6490(0x1b9)},'pallet':{'$first':_0xbf6490(0x1cb)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x350644[_0xbf6490(0x185)](0xc8)['json'](_0x1d7290);}catch(_0x49412e){_0x350644['status'](0x194)['json']({'message':_0x49412e[_0xbf6490(0x1be)]});}}),module[a0_0x5e5878(0x175)]=router;