var a0_0x5d478f=a0_0x5c43;(function(_0x2cd333,_0x3ac95d){var _0x56e3a4=a0_0x5c43,_0x236f5c=_0x2cd333();while(!![]){try{var _0x1de3e4=parseInt(_0x56e3a4(0x117))/0x1*(-parseInt(_0x56e3a4(0x107))/0x2)+parseInt(_0x56e3a4(0xef))/0x3+-parseInt(_0x56e3a4(0xed))/0x4*(-parseInt(_0x56e3a4(0xdc))/0x5)+parseInt(_0x56e3a4(0x129))/0x6*(parseInt(_0x56e3a4(0x13b))/0x7)+-parseInt(_0x56e3a4(0x125))/0x8*(parseInt(_0x56e3a4(0x100))/0x9)+parseInt(_0x56e3a4(0x133))/0xa+parseInt(_0x56e3a4(0xa7))/0xb*(-parseInt(_0x56e3a4(0x156))/0xc);if(_0x1de3e4===_0x3ac95d)break;else _0x236f5c['push'](_0x236f5c['shift']());}catch(_0x4550b2){_0x236f5c['push'](_0x236f5c['shift']());}}}(a0_0x5253,0xbcd29));function a0_0x5c43(_0x30d93c,_0x406346){var _0x52539c=a0_0x5253();return a0_0x5c43=function(_0x5c4347,_0x222789){_0x5c4347=_0x5c4347-0x8c;var _0x2c3f97=_0x52539c[_0x5c4347];return _0x2c3f97;},a0_0x5c43(_0x30d93c,_0x406346);}const express=require(a0_0x5d478f(0xde)),app=express(),router=express[a0_0x5d478f(0x126)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,supervisor_settings,email_settings}=require('../models/all_models'),users=require('../public/language/languages.json'),nodemailer=require(a0_0x5d478f(0xae));function a0_0x5253(){var _0x227d0a=['prime1','Level','$product_details.batch_code','level','adjust_qty','logo','master','password','$product_details._id','$product_details.product_cat','An\x20error\x20occurred.','max_per_unit','286364EdByna','id_transaction_from','1452870yYBMSz','/barcode_scanner','errors','expiry_date','flash','aggregate','params','length','German','post','</head><body>','adjustment\x20data\x20update\x20successfully','New_Qty_Converted','error','Spanish','False','$product_details.product_name','3141vxNQaG','product_name','$product_details.rack','room_names','<hr\x20class=\x22my-3\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<table\x20style=\x22width:\x20100%\x20!important;\x22>','151778vvfkSC','</span>','back','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Arabic','New_Qty_Converted_adj','$product','$product_details.product_code','ADJ-','id_transaction','floorlevel','French','Return\x20Goods','</thead>','body','</tbody>','3EZTMLj','stock','$warehouse_name','<h2>\x20','$product_details.bay','prod_cat','secondary_unit','\x20Order\x20Date\x20:\x20','adjustment\x20add\x20successfull','secondary_code','/view','Enabled','</h5>','get','26576wiehJl','Router','Portuguese\x20(BR)','Primary_Units','1668mVMSvx','An\x20error\x20occurred\x20while\x20saving\x20data.','$product_details.pallet','_id','success','edit_adjustment','$product_details.storage','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','Enclosed','<tr>','8461490qhAkRt','catch','Rooms','Shelves','Receiving\x20Area','$product_details.maxPerUnit','slice','minus','30611axvsQE','type','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','English\x20(US)','</tr>','$product_details.expiry_date','user','$product.room_names','log','$finalize','<h5\x20style=\x22text-align:\x20left;\x22>','bin','map','batch_code','json','forEach','render','$product_details.primary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','/adjustment/view','Chinese','</div>','redirect','</td>','storage','prod_code','312twidaU','sendMail','/preview/:id','$date','all','Secondary_units','port','$isAllowEdit','then','Logo.png','room','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','message','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','types','site_title','product_stock','status','maxperunit','unit','prod_name','stockBefore','\x20Order\x20Number\x20:\x20','invoice','bay','split','date','adjustment','$product_details.floorlevel','Hindi','There\x27s\x20a\x20error\x20in\x20this\x20transaction','Portuguese','product','/CheckingWarehouse','primary_code','RMSEmail','True','<div>','193457Zuhnws','rack','Ambient','<html><head><title></title>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','$product_details.production_date','findOne','nodemailer','Arabic\x20(ae)','prod_invoice','staff','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','$product_details.unit','production_date','second1','$room','$product_details.product_stock','$product_details.secondary_code','floor','Raw\x20Materials','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','<!DOCTYPE\x20html>','<strong>\x20Regards\x20</strong>','Floor','role','add_adjustment','\x20<>\x20','/view/add_adjustment','Adjustment\x20Mail','product_code','image','foreach\x20newproduct','random','$product_details.isle','/adjustment/preview/','filter','/picking_list/PDF_adjustment_rm/','language','$product_details.bin','save','push','findById','$product_details.type','warehouse','warehouse_name','new_adjust_qty','email','$product_details','/view/:id','</table>','/upload/','$name','English','5hpTAlX','edit_adjustment_view','express','find','string'];a0_0x5253=function(){return _0x227d0a;};return a0_0x5253();}router['get'](a0_0x5d478f(0x121),auth,async(_0x589ebf,_0x4cd255)=>{var _0x27390e=a0_0x5d478f;try{const {username:_0x6e3e05,email:_0x1d9bcb,role:_0x430bc7}=_0x589ebf['user'],_0x31bccb=_0x589ebf['user'],_0x2d17d9=await profile[_0x27390e(0xad)]({'email':_0x31bccb['email']}),_0x57dae8=await master_shop[_0x27390e(0xdf)]();console[_0x27390e(0x143)](_0x27390e(0xe7),_0x57dae8);let _0x20e0c7;if(_0x31bccb[_0x27390e(0xbf)]==_0x27390e(0xb1)){const _0x5a1264=await staff[_0x27390e(0xad)]({'email':_0x31bccb['email']});_0x20e0c7=await warehouse[_0x27390e(0xdf)]({'status':_0x27390e(0x122),'name':_0x5a1264[_0x27390e(0xd2)]});}else _0x20e0c7=await warehouse[_0x27390e(0xdf)]({'status':_0x27390e(0x122)});const _0xe911df=await product[_0x27390e(0xdf)]();let _0x373b27;if(_0x31bccb[_0x27390e(0xbf)]==_0x27390e(0xb1)){const _0x5d80ce=await staff[_0x27390e(0xad)]({'email':_0x31bccb['email']});_0x373b27=await adjustment[_0x27390e(0xdf)]({'warehouse_name':_0x5d80ce['warehouse']});}else _0x373b27=await adjustment[_0x27390e(0xf4)]([{'$unwind':_0x27390e(0x10d)},{'$group':{'_id':'$_id','invoice':{'$first':'$invoice'},'date':{'$first':_0x27390e(0x159)},'warehouse_name':{'$first':_0x27390e(0x119)},'room':{'$addToSet':_0x27390e(0x142)},'finalize':{'$first':_0x27390e(0x144)},'isAllowEdit':{'$first':_0x27390e(0x15d)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0x13e)){var _0x1b10cc=users[_0x27390e(0xdb)];console[_0x27390e(0x143)](_0x1b10cc);}else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0x9e))var _0x1b10cc=users[_0x27390e(0x9e)];else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0xf7))var _0x1b10cc=users[_0x27390e(0xf7)];else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0xfd))var _0x1b10cc=users[_0x27390e(0xfd)];else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0x112))var _0x1b10cc=users[_0x27390e(0x112)];else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0x127))var _0x1b10cc=users['Portuguese'];else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0x150))var _0x1b10cc=users[_0x27390e(0x150)];else{if(_0x57dae8[0x0][_0x27390e(0xcc)]==_0x27390e(0xaf))var _0x1b10cc=users[_0x27390e(0x10b)];}}}}}}}_0x4cd255[_0x27390e(0x14b)](_0x27390e(0x9c),{'success':_0x589ebf['flash'](_0x27390e(0x12d)),'errors':_0x589ebf[_0x27390e(0xf3)]('errors'),'role':_0x31bccb,'profile':_0x2d17d9,'warehouse':_0x20e0c7,'product':_0xe911df,'adjustment':_0x373b27,'master_shop':_0x57dae8,'language':_0x1b10cc});}catch(_0x47be84){console[_0x27390e(0x143)](_0x47be84);}});async function getRandom8DigitNumber(){var _0x35efa2=a0_0x5d478f;const _0x51d824=0x989680,_0x51202f=0x5f5e0ff,_0x23e5e8=Math[_0x35efa2(0xb9)](Math[_0x35efa2(0xc7)]()*(_0x51202f-_0x51d824+0x1))+_0x51d824;var _0x3b6c31;const _0x319ff8=await adjustment[_0x35efa2(0xad)]({'invoice':_0x35efa2(0x10f)+_0x23e5e8});return _0x319ff8&&_0x319ff8[_0x35efa2(0xf6)]>0x0?_0x3b6c31=_0x35efa2(0x10f)+_0x23e5e8:_0x3b6c31=_0x35efa2(0x10f)+_0x23e5e8,_0x3b6c31;}router[a0_0x5d478f(0x124)](a0_0x5d478f(0xc2),auth,async(_0x58859a,_0x3855d8)=>{var _0x318962=a0_0x5d478f;try{const {username:_0x2e74b1,email:_0x45483f,role:_0x13f2ef}=_0x58859a['user'],_0x360196=_0x58859a[_0x318962(0x141)],_0x4ec2d3=await profile[_0x318962(0xad)]({'email':_0x360196['email']}),_0x35be18=await master_shop[_0x318962(0xdf)]();let _0x9acf5b;if(_0x360196[_0x318962(0xbf)]==_0x318962(0xb1)){const _0x1daa28=await staff[_0x318962(0xad)]({'email':_0x360196[_0x318962(0xd5)]});_0x9acf5b=await warehouse[_0x318962(0xf4)]([{'$match':{'status':_0x318962(0x122),'name':_0x1daa28['warehouse'],'warehouse_category':'Raw\x20Materials','name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':'$name','name':{'$first':_0x318962(0xda)}}}]);}else _0x9acf5b=await warehouse[_0x318962(0xf4)]([{'$match':{'status':_0x318962(0x122),'warehouse_category':_0x318962(0xba),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x318962(0xda),'name':{'$first':_0x318962(0xda)}}}]);const _0x5a266c=await product[_0x318962(0xdf)]({}),_0x73b4f9=await adjustment[_0x318962(0xdf)]({}),_0x520164=_0x73b4f9['length']+0x1,_0x5a7acb=_0x318962(0x10f)+_0x520164['toString']()['padStart'](0x5,'0');var _0x22610e=[_0x318962(0xa9),_0x318962(0x131),'Return\x20Rooms'];if(_0x35be18[0x0]['language']==_0x318962(0x13e))var _0x27bf79=users[_0x318962(0xdb)];else{if(_0x35be18[0x0][_0x318962(0xcc)]==_0x318962(0x9e))var _0x27bf79=users[_0x318962(0x9e)];else{if(_0x35be18[0x0][_0x318962(0xcc)]=='German')var _0x27bf79=users[_0x318962(0xf7)];else{if(_0x35be18[0x0][_0x318962(0xcc)]==_0x318962(0xfd))var _0x27bf79=users['Spanish'];else{if(_0x35be18[0x0][_0x318962(0xcc)]==_0x318962(0x112))var _0x27bf79=users['French'];else{if(_0x35be18[0x0][_0x318962(0xcc)]==_0x318962(0x127))var _0x27bf79=users[_0x318962(0xa0)];else{if(_0x35be18[0x0][_0x318962(0xcc)]==_0x318962(0x150))var _0x27bf79=users[_0x318962(0x150)];else{if(_0x35be18[0x0][_0x318962(0xcc)]=='Arabic\x20(ae)')var _0x27bf79=users[_0x318962(0x10b)];}}}}}}}const _0x274504=getRandom8DigitNumber();_0x274504[_0x318962(0x15e)](_0x5d4b91=>{var _0x3e4651=_0x318962;_0x3855d8['render'](_0x3e4651(0xc0),{'success':_0x58859a[_0x3e4651(0xf3)]('success'),'errors':_0x58859a[_0x3e4651(0xf3)](_0x3e4651(0xf1)),'role':_0x360196,'profile':_0x4ec2d3,'warehouse':_0x9acf5b,'product':_0x5a266c,'master_shop':_0x35be18,'language':_0x27bf79,'rooms_data':_0x22610e,'invoice_no':_0x5d4b91});})['catch'](_0x1873b9=>{var _0x4f3305=_0x318962;_0x58859a[_0x4f3305(0xf3)](_0x4f3305(0xf1),_0x4f3305(0x9f)),_0x3855d8['redirect'](_0x4f3305(0x14f));});}catch(_0x46c77d){console[_0x318962(0x143)](_0x46c77d);}}),router['post'](a0_0x5d478f(0xc2),auth,async(_0x467ef1,_0x7def2e)=>{var _0x57892c=a0_0x5d478f;try{const {warehouse_name:_0x4c4d5c,date:_0x2ab0e9,prod_name:_0x1d34a1,level:_0x3c4175,isle:_0x403b74,pallet:_0x4c83e0,stock:_0x37a6d3,types:_0x39de82,adjust_qty:_0x58b5a3,new_adjust_qty:_0x561baf,note:_0x175100,Room_name:_0x277ded,invoice:_0x521ae1,JO_number:_0x132b94,expiry_date:_0x41804a}=_0x467ef1['body'];if(typeof _0x1d34a1==_0x57892c(0xe0))var _0x204da3=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0x95)]],_0x2323e5=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0xe4)]],_0x14e9b0=[_0x467ef1['body'][_0x57892c(0x118)]],_0x58105d=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0x8f)]],_0x46049a=[_0x467ef1[_0x57892c(0x115)]['New_Qty_Converted_adj']],_0x19c0af=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0xfb)]],_0x1289ea=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0x128)]],_0x505eef=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0x15b)]],_0x48e678=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0x155)]],_0x2f6b8f=[_0x467ef1[_0x57892c(0x115)]['batch_code']],_0x35c2da=[_0x467ef1['body'][_0x57892c(0xf2)]],_0x579b09=[_0x467ef1[_0x57892c(0x115)]['max_per_unit']],_0x479134=[_0x467ef1['body'][_0x57892c(0xb4)]],_0x123609=[_0x467ef1['body']['prod_cat']],_0x30628b=[_0x467ef1['body'][_0x57892c(0x135)]],_0x478a11=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0xe1)]],_0x77ea65=[_0x467ef1[_0x57892c(0x115)][_0x57892c(0xb5)]],_0x377a46=[_0x467ef1['body'][_0x57892c(0xb0)]],_0x4340b4=[_0x467ef1[_0x57892c(0x115)]['id_transaction']];else var _0x204da3=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0x95)]],_0x2323e5=[..._0x467ef1['body'][_0x57892c(0xe4)]],_0x14e9b0=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0x118)]],_0x58105d=[..._0x467ef1['body'][_0x57892c(0x8f)]],_0x46049a=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0x10c)]],_0x19c0af=[..._0x467ef1['body'][_0x57892c(0xfb)]],_0x1289ea=[..._0x467ef1['body']['unit']],_0x505eef=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0x15b)]],_0x48e678=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0x155)]],_0x2f6b8f=[..._0x467ef1[_0x57892c(0x115)]['batch_code']],_0x35c2da=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0xf2)]],_0x579b09=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0xec)]],_0x479134=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0xb4)]],_0x123609=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0x11c)]],_0x30628b=[..._0x467ef1['body']['Rooms']],_0x478a11=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0xe1)]],_0x77ea65=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0xb5)]],_0x377a46=[..._0x467ef1[_0x57892c(0x115)][_0x57892c(0xb0)]],_0x4340b4=[..._0x467ef1['body'][_0x57892c(0x110)]];const _0x2034b7=_0x204da3[_0x57892c(0x147)](_0x1c4b58=>{return _0x1c4b58={'product_name':_0x1c4b58};});_0x2323e5['forEach']((_0x21880c,_0x313e20)=>{_0x30628b['forEach']((_0x501424,_0x11eaa0)=>{var _0x5ce19c=a0_0x5c43;if(_0x501424==_0x5ce19c(0x137)&&_0x313e20==_0x11eaa0){var _0x5e9c9c=_0x21880c['slice'](0x3);_0x2034b7[_0x313e20][_0x5ce19c(0x154)]=_0x21880c[0x0],_0x2034b7[_0x313e20]['rack']=_0x21880c[0x1],_0x2034b7[_0x313e20]['bay']=0x0,_0x2034b7[_0x313e20]['bin']=0x0,_0x2034b7[_0x313e20][_0x5ce19c(0x13c)]=_0x5ce19c(0xbe),_0x2034b7[_0x313e20][_0x5ce19c(0x111)]=_0x5e9c9c;}else{if(_0x501424=='Shelves'&&_0x313e20==_0x11eaa0){var _0x5e9c9c=_0x21880c['slice'](0x3);_0x2034b7[_0x313e20][_0x5ce19c(0x154)]=_0x21880c[0x0],_0x2034b7[_0x313e20][_0x5ce19c(0xa8)]=_0x21880c[0x1],_0x2034b7[_0x313e20][_0x5ce19c(0x99)]=0x0,_0x2034b7[_0x313e20][_0x5ce19c(0x146)]=0x0,_0x2034b7[_0x313e20][_0x5ce19c(0x13c)]=_0x5ce19c(0xbe),_0x2034b7[_0x313e20]['floorlevel']=_0x21880c[0x5];}else{if(_0x313e20==_0x11eaa0){var _0x1dec77;if(_0x21880c[0x4]=='L')_0x1dec77='Level';else _0x21880c[0x4]=='F'&&(_0x1dec77=_0x5ce19c(0xbe));_0x2034b7[_0x313e20][_0x5ce19c(0x154)]=_0x21880c[0x0],_0x2034b7[_0x313e20][_0x5ce19c(0xa8)]=_0x21880c[0x1],_0x2034b7[_0x313e20]['bay']=_0x21880c[0x2],_0x2034b7[_0x313e20][_0x5ce19c(0x146)]=_0x21880c[0x3],_0x2034b7[_0x313e20][_0x5ce19c(0x13c)]=_0x1dec77,_0x2034b7[_0x313e20][_0x5ce19c(0x111)]=_0x21880c[0x5];}}}});}),_0x14e9b0[_0x57892c(0x14a)]((_0x1e194e,_0x14a5b3)=>{var _0x93cf9c=_0x57892c;_0x2034b7[_0x14a5b3][_0x93cf9c(0x96)]=_0x1e194e;}),_0x4340b4[_0x57892c(0x14a)]((_0x309245,_0x1e1c36)=>{var _0x3f9132=_0x57892c;_0x2034b7[_0x1e1c36][_0x3f9132(0xee)]=_0x309245;}),_0x58105d['forEach']((_0x3f29a7,_0x5b56d6)=>{_0x2034b7[_0x5b56d6]['types']=_0x3f29a7;}),_0x46049a[_0x57892c(0x14a)]((_0x3f0fa6,_0x2373ac)=>{var _0x15cdbf=_0x57892c;_0x2034b7[_0x2373ac][_0x15cdbf(0xe5)]=_0x3f0fa6;}),_0x19c0af[_0x57892c(0x14a)]((_0x371d11,_0x11dd70)=>{_0x2034b7[_0x11dd70]['new_adjust_qty']=_0x371d11;}),_0x1289ea['forEach']((_0x13772d,_0x3deea9)=>{_0x2034b7[_0x3deea9]['unit']=_0x13772d;}),_0x505eef[_0x57892c(0x14a)]((_0x1947ae,_0x1c4bdc)=>{var _0x28644a=_0x57892c;_0x2034b7[_0x1c4bdc][_0x28644a(0x11d)]=_0x1947ae;}),_0x48e678[_0x57892c(0x14a)]((_0x2358b2,_0xaf0488)=>{_0x2034b7[_0xaf0488]['product_code']=_0x2358b2;}),_0x2f6b8f[_0x57892c(0x14a)]((_0x17e830,_0x7f61c7)=>{var _0x24fade=_0x57892c;_0x2034b7[_0x7f61c7][_0x24fade(0x148)]=_0x17e830;}),_0x35c2da[_0x57892c(0x14a)]((_0x6c62c0,_0x3e3e1e)=>{_0x2034b7[_0x3e3e1e]['expiry_date']=_0x6c62c0;}),_0x579b09[_0x57892c(0x14a)]((_0x5de288,_0x2beebb)=>{var _0x53879a=_0x57892c;_0x2034b7[_0x2beebb][_0x53879a(0x93)]=_0x5de288;}),_0x479134[_0x57892c(0x14a)]((_0x40eddb,_0x38cdb2)=>{_0x2034b7[_0x38cdb2]['production_date']=_0x40eddb;}),_0x123609[_0x57892c(0x14a)]((_0x54fc37,_0x5bedff)=>{_0x2034b7[_0x5bedff]['prod_cat']=_0x54fc37;}),_0x30628b[_0x57892c(0x14a)]((_0x153e26,_0x466b8b)=>{var _0x339f8e=_0x57892c;_0x2034b7[_0x466b8b][_0x339f8e(0x103)]=_0x153e26;}),_0x478a11[_0x57892c(0x14a)]((_0x545c06,_0x25ae0f)=>{var _0x5e335a=_0x57892c;_0x2034b7[_0x25ae0f][_0x5e335a(0xa3)]=_0x545c06;}),_0x77ea65['forEach']((_0x205ab4,_0x44cf52)=>{var _0x4bf419=_0x57892c;_0x2034b7[_0x44cf52][_0x4bf419(0x120)]=_0x205ab4;}),_0x377a46['forEach']((_0x3b7546,_0xb3180d)=>{_0x2034b7[_0xb3180d]['invoice']=_0x3b7546;});const _0x23a3d5=_0x2034b7[_0x57892c(0xca)](_0xac9a60=>_0xac9a60[_0x57892c(0xe5)]!=='0'&&_0xac9a60[_0x57892c(0xe5)]!=='');var _0x51eacc=0x0;_0x23a3d5[_0x57892c(0x14a)](_0x32524c=>{var _0x22b180=_0x57892c;console[_0x22b180(0x143)](_0x22b180(0xc6),_0x32524c),parseInt(_0x32524c['adjust_qty'])<=0x0&&_0x51eacc++;});if(_0x51eacc!=0x0)return _0x467ef1[_0x57892c(0xf3)](_0x57892c(0xf1),_0x57892c(0xb2)),_0x7def2e[_0x57892c(0x152)](_0x57892c(0x109));const _0x2dc870=new adjustment({'warehouse_name':_0x4c4d5c,'date':_0x2ab0e9,'product':_0x23a3d5,'note':_0x175100,'room':_0x277ded,'invoice':_0x521ae1,'JO_number':_0x132b94,'expiry_date':_0x41804a}),_0x1a591a=await _0x2dc870['save']();_0x467ef1[_0x57892c(0xf3)]('success',_0x57892c(0x11f)),_0x7def2e['redirect'](_0x57892c(0xc9)+_0x1a591a[_0x57892c(0x12c)]);}catch(_0x42eae1){console[_0x57892c(0x143)](_0x42eae1),_0x7def2e[_0x57892c(0x92)](0xc8)[_0x57892c(0x149)]({'message':_0x42eae1[_0x57892c(0x8d)]});}}),router[a0_0x5d478f(0x124)](a0_0x5d478f(0x158),auth,async(_0x5edbd1,_0x1d2bb7)=>{var _0x420431=a0_0x5d478f;try{const {username:_0x292170,email:_0x173eba,role:_0x2bd4e3}=_0x5edbd1[_0x420431(0x141)],_0x1f2a0b=_0x5edbd1[_0x420431(0x141)],_0x15d9fe=await profile[_0x420431(0xad)]({'email':_0x1f2a0b['email']}),_0x453d6d=await master_shop[_0x420431(0xdf)](),_0x17a890=_0x5edbd1[_0x420431(0xf5)]['id'],_0x58e689=await adjustment['findById']({'_id':_0x17a890}),_0x11c51b=await purchases[_0x420431(0xf4)]([{'$match':{'warehouse_name':_0x58e689[_0x420431(0xd3)]}},{'$unwind':_0x420431(0x10d)},{'$group':{'_id':'$product.product_name'}}]),_0x50d3ac=await product[_0x420431(0xdf)]({}),_0x11cfaa=await warehouse['aggregate']([{'$match':{'name':_0x58e689['warehouse_name']}},{'$unwind':_0x420431(0xd6)},{'$group':{'_id':'$product_details._id','name':{'$first':_0x420431(0xff)},'product_stock':{'$first':_0x420431(0xb7)},'bay':{'$first':_0x420431(0x11b)},'bin':{'$first':_0x420431(0xcd)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x420431(0x9d)},'primary_code':{'$first':_0x420431(0x14c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x420431(0x10e)},'storage':{'$first':_0x420431(0x12f)},'rack':{'$first':_0x420431(0x102)},'maxPerUnit':{'$first':_0x420431(0x138)},'expiry_date':{'$first':_0x420431(0x140)},'production_date':{'$first':_0x420431(0xac)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x420431(0xb6)}}}]);if(_0x453d6d[0x0][_0x420431(0xcc)]=='English\x20(US)'){var _0x488341=users[_0x420431(0xdb)];console[_0x420431(0x143)](_0x488341);}else{if(_0x453d6d[0x0][_0x420431(0xcc)]==_0x420431(0x9e))var _0x488341=users[_0x420431(0x9e)];else{if(_0x453d6d[0x0][_0x420431(0xcc)]==_0x420431(0xf7))var _0x488341=users[_0x420431(0xf7)];else{if(_0x453d6d[0x0][_0x420431(0xcc)]==_0x420431(0xfd))var _0x488341=users[_0x420431(0xfd)];else{if(_0x453d6d[0x0][_0x420431(0xcc)]==_0x420431(0x112))var _0x488341=users[_0x420431(0x112)];else{if(_0x453d6d[0x0]['language']==_0x420431(0x127))var _0x488341=users[_0x420431(0xa0)];else{if(_0x453d6d[0x0][_0x420431(0xcc)]==_0x420431(0x150))var _0x488341=users[_0x420431(0x150)];else{if(_0x453d6d[0x0][_0x420431(0xcc)]=='Arabic\x20(ae)')var _0x488341=users[_0x420431(0x10b)];}}}}}}}_0x1d2bb7[_0x420431(0x14b)](_0x420431(0xdd),{'success':_0x5edbd1[_0x420431(0xf3)]('success'),'errors':_0x5edbd1[_0x420431(0xf3)]('errors'),'role':_0x1f2a0b,'profile':_0x15d9fe,'adjustment':_0x58e689,'stock':_0x11cfaa,'master_shop':_0x453d6d,'warehouse_name':_0x11c51b,'unit':_0x50d3ac,'language':_0x488341});}catch(_0x1d0070){console[_0x420431(0x143)](_0x1d0070),_0x1d2bb7[_0x420431(0x92)](0xc8)[_0x420431(0x149)]({'message':_0x1d0070[_0x420431(0x8d)]});}}),router[a0_0x5d478f(0xf8)](a0_0x5d478f(0x158),auth,async(_0x1d41aa,_0x2e7ace)=>{var _0x34bebd=a0_0x5d478f;try{const _0x3370ee=_0x1d41aa['params']['id'],{warehouse_name:_0x48809c,Room_name:_0x3cf8b9}=_0x1d41aa[_0x34bebd(0x115)],_0x3f66e6=await adjustment[_0x34bebd(0xd0)]({'_id':_0x3370ee}),_0x386a30=_0x3f66e6['product'][_0x34bebd(0x147)](async _0x25ec0c=>{var _0xd1db32=_0x34bebd;if(_0x25ec0c['adjust_qty']>0x0){var _0x2d31af=await warehouse[_0xd1db32(0xad)]({'name':_0x48809c,'room':_0x25ec0c['room_names'],'warehouse_category':_0xd1db32(0xba)});const _0x3ee3ed=_0x2d31af['product_details'][_0xd1db32(0x147)](_0x36c3ed=>{var _0x58ce91=_0xd1db32;console[_0x58ce91(0x143)](_0x25ec0c[_0x58ce91(0x8f)]+_0x58ce91(0xc1));if(_0x25ec0c[_0x58ce91(0x8f)]==_0x58ce91(0x13a)){if(_0x36c3ed[_0x58ce91(0x101)]==_0x25ec0c[_0x58ce91(0x101)]&&_0x36c3ed['floorlevel']==_0x25ec0c[_0x58ce91(0x111)]&&_0x36c3ed['type']==_0x25ec0c[_0x58ce91(0x13c)]&&_0x36c3ed[_0x58ce91(0x146)]==_0x25ec0c[_0x58ce91(0x146)]&&_0x36c3ed['bay']==_0x25ec0c[_0x58ce91(0x99)]&&_0x36c3ed['rack']==_0x25ec0c['rack']&&_0x36c3ed[_0x58ce91(0x154)]==_0x25ec0c[_0x58ce91(0x154)]&&_0x36c3ed[_0x58ce91(0xf2)]==_0x25ec0c['expiry_date']&&_0x36c3ed[_0x58ce91(0x148)]==_0x25ec0c[_0x58ce91(0x148)]&&_0x36c3ed['production_date']==_0x25ec0c['production_date']&&_0x36c3ed[_0x58ce91(0x98)]==_0x25ec0c[_0x58ce91(0x98)]&&_0x36c3ed['_id']==_0x25ec0c[_0x58ce91(0xee)]){var _0x5c485c;_0x5c485c=_0x25ec0c[_0x58ce91(0xe5)],_0x25ec0c[_0x58ce91(0x11c)]=='S'&&(_0x5c485c=_0x25ec0c[_0x58ce91(0xe5)]),_0x36c3ed[_0x58ce91(0x91)]=_0x36c3ed['product_stock']-_0x5c485c;}}else{if(_0x36c3ed['product_name']==_0x25ec0c[_0x58ce91(0x101)]&&_0x36c3ed['floorlevel']==_0x25ec0c[_0x58ce91(0x111)]&&_0x36c3ed[_0x58ce91(0x13c)]==_0x25ec0c[_0x58ce91(0x13c)]&&_0x36c3ed[_0x58ce91(0x146)]==_0x25ec0c[_0x58ce91(0x146)]&&_0x36c3ed[_0x58ce91(0x99)]==_0x25ec0c[_0x58ce91(0x99)]&&_0x36c3ed['rack']==_0x25ec0c[_0x58ce91(0xa8)]&&_0x36c3ed['storage']==_0x25ec0c[_0x58ce91(0x154)]&&_0x36c3ed[_0x58ce91(0xf2)]==_0x25ec0c[_0x58ce91(0xf2)]&&_0x36c3ed[_0x58ce91(0x148)]==_0x25ec0c[_0x58ce91(0x148)]&&_0x36c3ed[_0x58ce91(0xb4)]==_0x25ec0c[_0x58ce91(0xb4)]&&_0x36c3ed[_0x58ce91(0x98)]==_0x25ec0c['invoice']&&_0x36c3ed['_id']==_0x25ec0c[_0x58ce91(0xee)]){console[_0x58ce91(0x143)](_0x25ec0c);var _0x5c485c;_0x5c485c=_0x25ec0c['adjust_qty'],_0x25ec0c['prod_cat']=='S'&&(_0x5c485c=_0x25ec0c[_0x58ce91(0xe5)]),_0x36c3ed[_0x58ce91(0x91)]=_0x36c3ed[_0x58ce91(0x91)]+_0x5c485c;}}});}return _0x2d31af;});Promise[_0x34bebd(0x15a)](_0x386a30)[_0x34bebd(0x15e)](async _0x21c615=>{var _0x1f93aa=_0x34bebd;try{for(const _0x388891 of _0x21c615){await _0x388891[_0x1f93aa(0xce)]();}_0x3f66e6['finalize']=_0x1f93aa(0xa5);const _0x36e27f=await _0x3f66e6['save'](),_0x10ed01=await master_shop[_0x1f93aa(0xdf)](),_0x179395=await email_settings['findOne'](),_0x1f3bc3=await supervisor_settings[_0x1f93aa(0xdf)]();var _0x1dc40e=_0x3f66e6[_0x1f93aa(0xa1)],_0x44486d='',_0xbacdc2;for(_0xbacdc2 in _0x1dc40e){_0x44486d+=_0x1f93aa(0x132)+_0x1f93aa(0x130)+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x101)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1dc40e[_0xbacdc2][_0x1f93aa(0xc4)]+_0x1f93aa(0x153)+_0x1f93aa(0x130)+_0x1dc40e[_0xbacdc2]['adjust_qty']+_0x1f93aa(0x153)+_0x1f93aa(0x130)+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x94)]+'</td>'+_0x1f93aa(0x130)+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x11d)]+_0x1f93aa(0x153)+_0x1f93aa(0x130)+_0x3f66e6[_0x1f93aa(0xd3)]+_0x1f93aa(0x153)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x103)]+_0x1f93aa(0x153)+_0x1f93aa(0x130)+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x154)]+_0x1dc40e[_0xbacdc2][_0x1f93aa(0xa8)]+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x99)]+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x146)]+_0x1dc40e[_0xbacdc2]['type'][0x0]+_0x1dc40e[_0xbacdc2][_0x1f93aa(0x111)]+'</td>',_0x1f93aa(0x13f);}let _0x142b3f=nodemailer['createTransport']({'host':_0x179395['host'],'port':Number(_0x179395[_0x1f93aa(0x15c)]),'secure':![],'auth':{'user':_0x179395['email'],'pass':_0x179395[_0x1f93aa(0xe8)]}}),_0x10c486={'from':_0x179395[_0x1f93aa(0xd5)],'to':_0x1f3bc3[0x0][_0x1f93aa(0xa4)],'subject':_0x1f93aa(0xc3),'attachments':[{'filename':_0x1f93aa(0x15f),'path':__dirname+'/../public'+_0x1f93aa(0xd9)+_0x10ed01[0x0][_0x1f93aa(0xc5)],'cid':_0x1f93aa(0xe6)}],'html':_0x1f93aa(0xbc)+_0x1f93aa(0xaa)+_0x1f93aa(0xf9)+_0x1f93aa(0xa6)+_0x1f93aa(0xab)+'<div>'+_0x1f93aa(0x13d)+'</div>'+_0x1f93aa(0xa6)+_0x1f93aa(0x11a)+_0x10ed01[0x0]['site_title']+'\x20</h2>'+_0x1f93aa(0x151)+_0x1f93aa(0x151)+_0x1f93aa(0x104)+_0x1f93aa(0xa6)+_0x1f93aa(0x145)+_0x1f93aa(0x97)+_0x3f66e6['invoice']+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x1f93aa(0x11e)+_0x3f66e6['date']+'\x20'+_0x1f93aa(0x108)+_0x1f93aa(0x123)+_0x1f93aa(0x151)+_0x1f93aa(0x106)+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x1f93aa(0x132)+_0x1f93aa(0x10a)+_0x1f93aa(0x8e)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x1f93aa(0x105)+_0x1f93aa(0xbb)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x1f93aa(0x8c)+_0x1f93aa(0x14e)+_0x1f93aa(0x13f)+_0x1f93aa(0x114)+_0x1f93aa(0x14d)+'\x20'+_0x44486d+'\x20'+_0x1f93aa(0x116)+_0x1f93aa(0xd8)+_0x1f93aa(0xa6)+_0x1f93aa(0xbd)+'<h5>'+_0x10ed01[0x0][_0x1f93aa(0x90)]+'</h5>'+_0x1f93aa(0x151)+_0x1f93aa(0x151)+'</body></html>'};_0x142b3f[_0x1f93aa(0x157)](_0x10c486,function(_0x3f241b,_0x56828d){var _0x3ff0d8=_0x1f93aa;_0x3f241b?(console[_0x3ff0d8(0x143)](_0x3f241b),console[_0x3ff0d8(0x143)]('Error\x20Occurs')):console[_0x3ff0d8(0x143)]('Email\x20sent\x20successfully');}),_0x1d41aa['flash'](_0x1f93aa(0x12d),'adjustment\x20Finalized\x20successfully'),_0x2e7ace[_0x1f93aa(0x152)](_0x1f93aa(0xcb)+_0x36e27f[_0x1f93aa(0x12c)]);}catch(_0x301d91){console[_0x1f93aa(0xfc)](_0x301d91),_0x2e7ace[_0x1f93aa(0x92)](0x1f4)[_0x1f93aa(0x149)]({'error':_0x1f93aa(0x12a)});}})[_0x34bebd(0x134)](_0x253c20=>{var _0x3192ef=_0x34bebd;console[_0x3192ef(0xfc)](_0x253c20),_0x2e7ace['status'](0x1f4)[_0x3192ef(0x149)]({'error':_0x3192ef(0xeb)});});}catch(_0x1dd18a){console['log'](_0x1dd18a),_0x2e7ace[_0x34bebd(0x92)](0xc8)[_0x34bebd(0x149)]({'message':_0x1dd18a[_0x34bebd(0x8d)]});}}),router['get'](a0_0x5d478f(0xd7),auth,async(_0x41a6d2,_0x274983)=>{var _0x462b8f=a0_0x5d478f;try{const {username:_0x17fd04,email:_0x86a325,role:_0x289e19}=_0x41a6d2[_0x462b8f(0x141)],_0x4831d4=_0x41a6d2[_0x462b8f(0x141)],_0x44b881=await profile[_0x462b8f(0xad)]({'email':_0x4831d4['email']}),_0x1b3251=await master_shop['find'](),_0x34ae19=_0x41a6d2[_0x462b8f(0xf5)]['id'],_0x1a1f41=await adjustment[_0x462b8f(0xd0)]({'_id':_0x34ae19}),_0x531498=await purchases[_0x462b8f(0xf4)]([{'$match':{'warehouse_name':_0x1a1f41[_0x462b8f(0xd3)]}},{'$unwind':_0x462b8f(0x10d)},{'$group':{'_id':'$product.product_name'}}]),_0x95bb1f=await product[_0x462b8f(0xdf)]({}),_0x40d4e6=await warehouse[_0x462b8f(0xf4)]([{'$match':{'name':_0x1a1f41[_0x462b8f(0xd3)]}},{'$unwind':_0x462b8f(0xd6)},{'$group':{'_id':_0x462b8f(0xe9),'name':{'$first':_0x462b8f(0xff)},'product_stock':{'$first':'$product_details.product_stock'},'bay':{'$first':_0x462b8f(0x11b)},'bin':{'$first':_0x462b8f(0xcd)},'type':{'$first':_0x462b8f(0xd1)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x462b8f(0x14c)},'secondary_code':{'$first':_0x462b8f(0xb8)},'product_code':{'$first':_0x462b8f(0x10e)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':_0x462b8f(0x102)},'maxPerUnit':{'$first':_0x462b8f(0x138)},'expiry_date':{'$first':_0x462b8f(0x140)},'production_date':{'$first':_0x462b8f(0xac)},'batch_code':{'$first':_0x462b8f(0xe3)},'room':{'$first':_0x462b8f(0xb6)}}}]);let _0x3c7f5c;if(_0x4831d4[_0x462b8f(0xbf)]==_0x462b8f(0xb1)){const _0xb8056b=await staff[_0x462b8f(0xad)]({'email':_0x4831d4[_0x462b8f(0xd5)]});_0x3c7f5c=await warehouse[_0x462b8f(0xf4)]([{'$match':{'status':'Enabled','name':_0xb8056b['warehouse'],'warehouse_category':_0x462b8f(0xba),'name':{'$ne':_0x462b8f(0x113)}}},{'$group':{'_id':_0x462b8f(0xda),'name':{'$first':_0x462b8f(0xda)}}}]);}else _0x3c7f5c=await warehouse[_0x462b8f(0xf4)]([{'$match':{'status':_0x462b8f(0x122),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x462b8f(0x113)}}},{'$group':{'_id':_0x462b8f(0xda),'name':{'$first':_0x462b8f(0xda)}}}]);if(_0x1b3251[0x0][_0x462b8f(0xcc)]=='English\x20(US)'){var _0x3c7a85=users[_0x462b8f(0xdb)];console[_0x462b8f(0x143)](_0x3c7a85);}else{if(_0x1b3251[0x0][_0x462b8f(0xcc)]=='Hindi')var _0x3c7a85=users[_0x462b8f(0x9e)];else{if(_0x1b3251[0x0][_0x462b8f(0xcc)]=='German')var _0x3c7a85=users[_0x462b8f(0xf7)];else{if(_0x1b3251[0x0][_0x462b8f(0xcc)]==_0x462b8f(0xfd))var _0x3c7a85=users[_0x462b8f(0xfd)];else{if(_0x1b3251[0x0][_0x462b8f(0xcc)]==_0x462b8f(0x112))var _0x3c7a85=users[_0x462b8f(0x112)];else{if(_0x1b3251[0x0][_0x462b8f(0xcc)]=='Portuguese\x20(BR)')var _0x3c7a85=users['Portuguese'];else{if(_0x1b3251[0x0][_0x462b8f(0xcc)]=='Chinese')var _0x3c7a85=users[_0x462b8f(0x150)];else{if(_0x1b3251[0x0]['language']=='Arabic\x20(ae)')var _0x3c7a85=users[_0x462b8f(0x10b)];}}}}}}}_0x274983[_0x462b8f(0x14b)](_0x462b8f(0x12e),{'success':_0x41a6d2[_0x462b8f(0xf3)](_0x462b8f(0x12d)),'errors':_0x41a6d2['flash'](_0x462b8f(0xf1)),'role':_0x4831d4,'profile':_0x44b881,'adjustment':_0x1a1f41,'stock':_0x40d4e6,'master_shop':_0x1b3251,'warehouse_name':_0x531498,'unit':_0x95bb1f,'language':_0x3c7a85,'warehouse':_0x3c7f5c});}catch(_0x26f286){console[_0x462b8f(0x143)](_0x26f286),_0x274983[_0x462b8f(0x92)](0xc8)[_0x462b8f(0x149)]({'message':_0x26f286[_0x462b8f(0x8d)]});}}),router[a0_0x5d478f(0xf8)]('/view/:id',auth,async(_0x50095a,_0x5e4aaf)=>{var _0x5984c4=a0_0x5d478f;try{const _0x222575=_0x50095a[_0x5984c4(0xf5)]['id'],_0x3b9a7f=await adjustment[_0x5984c4(0xd0)]({'_id':_0x222575}),_0x224127=await warehouse[_0x5984c4(0xad)]({'name':_0x3b9a7f['warehouse_name'],'room':_0x3b9a7f[_0x5984c4(0x160)]}),{warehouse_name:_0x4453c5,date:_0x5dd33f,prod_name:_0x42e623,level:_0x2c0fe9,isle:_0x56144a,pallet:_0x59316a,stock:_0xea85dc,types:_0x12015e,adjust_qty:_0x1b3bfb,new_adjust_qty:_0x531138,note:_0x16e49a,Room_name:_0x88f5e3,invoice:_0x2b944f,JO_number:_0x375789,expiry_date:_0x43f8de}=_0x50095a[_0x5984c4(0x115)];if(typeof _0x42e623=='string')var _0x1b7715=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0x95)]],_0x5e5385=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0xe4)]],_0x519f3b=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0x118)]],_0x95a9e2=[_0x50095a[_0x5984c4(0x115)]['types']],_0x5675ef=[_0x50095a['body']['New_Qty_Converted_adj']],_0x4a3507=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0xfb)]],_0x3a9c96=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0x128)]],_0x5bd9a2=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0x15b)]],_0x47169c=[_0x50095a['body'][_0x5984c4(0x155)]],_0x45f35a=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0x148)]],_0x139b23=[_0x50095a[_0x5984c4(0x115)]['expiry_date']],_0x40509e=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0xec)]],_0x3285f4=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0xb4)]],_0x1cde81=[_0x50095a['body'][_0x5984c4(0x11c)]],_0x9de1b2=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0x135)]],_0x378e93=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0xe1)]],_0x30ba8a=[_0x50095a[_0x5984c4(0x115)][_0x5984c4(0xb5)]];else var _0x1b7715=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x95)]],_0x5e5385=[..._0x50095a[_0x5984c4(0x115)]['level']],_0x519f3b=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x118)]],_0x95a9e2=[..._0x50095a['body'][_0x5984c4(0x8f)]],_0x5675ef=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x10c)]],_0x4a3507=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0xfb)]],_0x3a9c96=[..._0x50095a[_0x5984c4(0x115)]['unit']],_0x5bd9a2=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x15b)]],_0x47169c=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x155)]],_0x45f35a=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x148)]],_0x139b23=[..._0x50095a['body']['expiry_date']],_0x40509e=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0xec)]],_0x3285f4=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0xb4)]],_0x1cde81=[..._0x50095a[_0x5984c4(0x115)]['prod_cat']],_0x9de1b2=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0x135)]],_0x378e93=[..._0x50095a[_0x5984c4(0x115)][_0x5984c4(0xe1)]],_0x30ba8a=[..._0x50095a[_0x5984c4(0x115)]['second1']];const _0x10756a=_0x1b7715[_0x5984c4(0x147)](_0x2f62ff=>{return _0x2f62ff={'product_name':_0x2f62ff};});_0x5e5385[_0x5984c4(0x14a)]((_0x2f758e,_0x332c08)=>{var _0x19b1d9=_0x5984c4;_0x9de1b2[_0x19b1d9(0x14a)]((_0x5e13f6,_0x5bc2df)=>{var _0x5a8528=_0x19b1d9;if(_0x5e13f6==_0x5a8528(0x137)&&_0x332c08==_0x5bc2df){var _0x1d8d80=_0x2f758e[_0x5a8528(0x139)](0x3);_0x10756a[_0x332c08][_0x5a8528(0x154)]=_0x2f758e[0x0],_0x10756a[_0x332c08][_0x5a8528(0xa8)]=_0x2f758e[0x1],_0x10756a[_0x332c08][_0x5a8528(0x99)]=0x0,_0x10756a[_0x332c08][_0x5a8528(0x146)]=0x0,_0x10756a[_0x332c08][_0x5a8528(0x13c)]=_0x5a8528(0xbe),_0x10756a[_0x332c08]['floorlevel']=_0x1d8d80;}else{if(_0x5e13f6==_0x5a8528(0x136)&&_0x332c08==_0x5bc2df){var _0x1d8d80=_0x2f758e[_0x5a8528(0x139)](0x3);_0x10756a[_0x332c08]['storage']=_0x2f758e[0x0],_0x10756a[_0x332c08][_0x5a8528(0xa8)]=_0x2f758e[0x1],_0x10756a[_0x332c08][_0x5a8528(0x99)]=0x0,_0x10756a[_0x332c08]['bin']=0x0,_0x10756a[_0x332c08][_0x5a8528(0x13c)]=_0x5a8528(0xbe),_0x10756a[_0x332c08][_0x5a8528(0x111)]=_0x2f758e[0x5];}else{if(_0x332c08==_0x5bc2df){var _0x1f220a;if(_0x2f758e[0x4]=='L')_0x1f220a=_0x5a8528(0xe2);else _0x2f758e[0x4]=='F'&&(_0x1f220a=_0x5a8528(0xbe));_0x10756a[_0x332c08][_0x5a8528(0x154)]=_0x2f758e[0x0],_0x10756a[_0x332c08][_0x5a8528(0xa8)]=_0x2f758e[0x1],_0x10756a[_0x332c08]['bay']=_0x2f758e[0x2],_0x10756a[_0x332c08]['bin']=_0x2f758e[0x3],_0x10756a[_0x332c08][_0x5a8528(0x13c)]=_0x1f220a,_0x10756a[_0x332c08]['floorlevel']=_0x2f758e[0x5];}}}});}),_0x519f3b['forEach']((_0x3d3154,_0x41fd10)=>{var _0x5b132d=_0x5984c4;_0x10756a[_0x41fd10][_0x5b132d(0x96)]=_0x3d3154;}),_0x95a9e2[_0x5984c4(0x14a)]((_0x25aa74,_0x5e2c5a)=>{var _0x2671f6=_0x5984c4;_0x10756a[_0x5e2c5a][_0x2671f6(0x8f)]=_0x25aa74;}),_0x5675ef['forEach']((_0x13a122,_0x5f639b)=>{var _0x3bceeb=_0x5984c4;_0x10756a[_0x5f639b][_0x3bceeb(0xe5)]=_0x13a122;}),_0x4a3507['forEach']((_0x59324c,_0x16dac3)=>{var _0x91099d=_0x5984c4;_0x10756a[_0x16dac3][_0x91099d(0xd4)]=_0x59324c;}),_0x3a9c96[_0x5984c4(0x14a)]((_0x1debd3,_0x2b0e1a)=>{var _0x38f675=_0x5984c4;_0x10756a[_0x2b0e1a][_0x38f675(0x94)]=_0x1debd3;}),_0x5bd9a2[_0x5984c4(0x14a)]((_0x4b5bdd,_0x3b2a64)=>{var _0x2c24f7=_0x5984c4;_0x10756a[_0x3b2a64][_0x2c24f7(0x11d)]=_0x4b5bdd;}),_0x47169c['forEach']((_0x46c734,_0x1f5d42)=>{_0x10756a[_0x1f5d42]['product_code']=_0x46c734;}),_0x45f35a['forEach']((_0xaf509c,_0xbf2d2)=>{_0x10756a[_0xbf2d2]['batch_code']=_0xaf509c;}),_0x139b23[_0x5984c4(0x14a)]((_0x385f8c,_0x50ad98)=>{var _0x6fdd4d=_0x5984c4;_0x10756a[_0x50ad98][_0x6fdd4d(0xf2)]=_0x385f8c;}),_0x40509e[_0x5984c4(0x14a)]((_0x4ad201,_0x1e0e17)=>{var _0x384041=_0x5984c4;_0x10756a[_0x1e0e17][_0x384041(0x93)]=_0x4ad201;}),_0x3285f4[_0x5984c4(0x14a)]((_0x461485,_0x1dba62)=>{var _0x119ada=_0x5984c4;_0x10756a[_0x1dba62][_0x119ada(0xb4)]=_0x461485;}),_0x1cde81[_0x5984c4(0x14a)]((_0x345c79,_0x541f4e)=>{_0x10756a[_0x541f4e]['prod_cat']=_0x345c79;}),_0x9de1b2[_0x5984c4(0x14a)]((_0x25a4c8,_0x389c71)=>{var _0x4b64bd=_0x5984c4;_0x10756a[_0x389c71][_0x4b64bd(0x103)]=_0x25a4c8;}),_0x378e93[_0x5984c4(0x14a)]((_0x9b4e3d,_0x432338)=>{var _0x3d0941=_0x5984c4;_0x10756a[_0x432338][_0x3d0941(0xa3)]=_0x9b4e3d;}),_0x30ba8a[_0x5984c4(0x14a)]((_0x39bf11,_0x213f23)=>{var _0x52fbc3=_0x5984c4;_0x10756a[_0x213f23][_0x52fbc3(0x120)]=_0x39bf11;});const _0x2c4258=_0x10756a[_0x5984c4(0xca)](_0x4c3ce9=>_0x4c3ce9['adjust_qty']!=='0'&&_0x4c3ce9[_0x5984c4(0xe5)]!=='');var _0x53a098=0x0;_0x2c4258[_0x5984c4(0x14a)](_0x53c2ef=>{var _0x29a4ed=_0x5984c4;console['log'](_0x29a4ed(0xc6),_0x53c2ef),parseInt(_0x53c2ef[_0x29a4ed(0xe5)])<=0x0&&_0x53a098++;});if(_0x53a098!=0x0)return _0x50095a[_0x5984c4(0xf3)](_0x5984c4(0xf1),_0x5984c4(0xb2)),_0x5e4aaf[_0x5984c4(0x152)](_0x5984c4(0x109));_0x3b9a7f[_0x5984c4(0xd3)]=_0x4453c5,_0x3b9a7f[_0x5984c4(0x9b)]=_0x5dd33f,_0x3b9a7f[_0x5984c4(0xa1)]=_0x2c4258,_0x3b9a7f['note']=_0x16e49a,_0x3b9a7f[_0x5984c4(0x98)]=_0x2b944f,_0x3b9a7f['isAllowEdit']=_0x5984c4(0xfe);const _0x86d0c5=await _0x3b9a7f['save']();_0x50095a[_0x5984c4(0xf3)]('success',_0x5984c4(0xfa)),_0x5e4aaf[_0x5984c4(0x152)](_0x5984c4(0x14f));}catch(_0x5c3876){console[_0x5984c4(0x143)](_0x5c3876);}}),router[a0_0x5d478f(0xf8)](a0_0x5d478f(0xf0),async(_0x5df013,_0x3c27db)=>{var _0x220ce9=a0_0x5d478f;const {primary_code:_0x24cc2a,warehouse_data:_0x221353,rooms_data:_0x3559ab,Roomslist:_0x1726c1}=_0x5df013['body'],_0x3a3eb2=_0x1726c1[_0x220ce9(0x9a)](','),_0x2bfebf=[];async function _0x6fd1fb(_0x1a1e24){var _0x2b46dd=_0x220ce9;const _0x31e485=await warehouse['aggregate']([{'$match':{'name':_0x221353,'room':_0x1a1e24}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x24cc2a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2b46dd(0xff)},'product_stock':{'$first':_0x2b46dd(0xb7)},'primary_code':{'$first':_0x2b46dd(0x14c)},'secondary_code':{'$first':_0x2b46dd(0xb8)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':'$product_details.bay'},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x2b46dd(0xd1)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2b46dd(0xb3)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2b46dd(0x12f)},'rack':{'$first':_0x2b46dd(0x102)},'expiry_date':{'$first':_0x2b46dd(0x140)},'production_date':{'$first':_0x2b46dd(0xac)},'maxPerUnit':{'$first':_0x2b46dd(0x138)},'batch_code':{'$first':'$product_details.batch_code'},'product_cat':{'$first':_0x2b46dd(0xea)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x2b46dd(0xb6)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x2cf634=await warehouse[_0x2b46dd(0xf4)]([{'$match':{'name':_0x221353,'room':_0x1a1e24}},{'$unwind':_0x2b46dd(0xd6)},{'$match':{'product_details.secondary_code':_0x24cc2a}},{'$group':{'_id':_0x2b46dd(0xe9),'name':{'$first':_0x2b46dd(0xff)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x2b46dd(0x14c)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x2b46dd(0x11b)},'isle':{'$first':_0x2b46dd(0xcd)},'type':{'$first':_0x2b46dd(0xd1)},'pallet':{'$first':'$product_details.floorlevel'},'unit':{'$first':_0x2b46dd(0xb3)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x2b46dd(0x12f)},'rack':{'$first':_0x2b46dd(0x102)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x2b46dd(0x138)},'batch_code':{'$first':_0x2b46dd(0xe3)},'product_cat':{'$first':_0x2b46dd(0xea)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x2b46dd(0xb6)}}}]);if(_0x31e485[_0x2b46dd(0xf6)]>0x0)_0x2bfebf[_0x2b46dd(0xcf)](_0x31e485);else _0x2cf634[_0x2b46dd(0xf6)]>0x0&&_0x2bfebf[_0x2b46dd(0xcf)](_0x2cf634);}const _0x41f585=_0x3a3eb2['map'](_0x88157b=>_0x6fd1fb(_0x88157b));await Promise[_0x220ce9(0x15a)](_0x41f585),_0x3c27db[_0x220ce9(0x149)](_0x2bfebf);}),router['post'](a0_0x5d478f(0xa2),async(_0x2fa949,_0x2d8adc)=>{var _0x773bc0=a0_0x5d478f;const {primaryCode:_0x2f0f9c,secondaryCode:_0x35a58e,productCode:_0x3082b0,level:_0x15ffbb,isle:_0x4c1210,pallet:_0x2f7004,warehouses:_0x4d4e9b,room:_0x1f73ee}=_0x2fa949['body'];try{const _0x2ff9cc=await warehouse[_0x773bc0(0xf4)]([{'$match':{'name':_0x4d4e9b,'room':_0x1f73ee}},{'$unwind':'$product_details'},{'$match':{'product_details.level':parseInt(_0x15ffbb),'product_details.isle':_0x4c1210,'product_details.pallet':parseInt(_0x2f7004)}},{'$group':{'_id':_0x773bc0(0xe9),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x773bc0(0xb7)},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x773bc0(0xc8)},'pallet':{'$first':_0x773bc0(0x12b)},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0x2d8adc[_0x773bc0(0x92)](0xc8)[_0x773bc0(0x149)](_0x2ff9cc);}catch(_0x4398b8){_0x2d8adc['status'](0x194)[_0x773bc0(0x149)]({'message':_0x4398b8[_0x773bc0(0x8d)]});}}),module['exports']=router;