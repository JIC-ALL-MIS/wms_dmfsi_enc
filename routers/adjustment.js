var a0_0x15da6e=a0_0x31b5;(function(_0x2e4899,_0x50eca3){var _0x396172=a0_0x31b5,_0x2290e0=_0x2e4899();while(!![]){try{var _0x177fcc=parseInt(_0x396172(0x20c))/0x1*(-parseInt(_0x396172(0x1ae))/0x2)+parseInt(_0x396172(0x1c3))/0x3+-parseInt(_0x396172(0x1af))/0x4+parseInt(_0x396172(0x219))/0x5+-parseInt(_0x396172(0x1e4))/0x6*(parseInt(_0x396172(0x263))/0x7)+-parseInt(_0x396172(0x22e))/0x8+parseInt(_0x396172(0x25b))/0x9;if(_0x177fcc===_0x50eca3)break;else _0x2290e0['push'](_0x2290e0['shift']());}catch(_0x2f9a84){_0x2290e0['push'](_0x2290e0['shift']());}}}(a0_0x37c5,0x57c75));function a0_0x37c5(){var _0x356bd7=['$invoice','room_names','json','add_adjustment','user','New_Qty_Converted_adj','storage','filter','slice','$product_details.isle','Arabic','master','$warehouse_name','id_transaction','_id','find','$product_details.rack','<span\x20style=\x22float:\x20right;\x22>','Spanish','Raw\x20Materials','11897514vqSfnu','Receiving\x20Area','port','status','warehouse','catch','render','host','306082WLvDCU','$product_details.secondary_unit','aggregate','An\x20error\x20occurred\x20while\x20saving\x20data.','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','/adjustment/view','product_name','new_adjust_qty','second1','then','adjustment\x20add\x20successfull','bay','$product_details.secondary_code','prime1','Level','stockBefore','Portuguese\x20(BR)','$product.product_name','all','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$product_details.product_stock','</tr>','adjustment','adjust_qty','warehouse_name','isAllowEdit','$product','adjustment\x20data\x20update\x20successfully','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','get','/picking_list/PDF_adjustment_rm/','Adjustment\x20Mail','random','split','params','length','2LOoysr','2559400nTveoi','/adjustment/preview/','Arabic\x20(ae)','unit','False','sendMail','/barcode_scanner','\x20Order\x20Number\x20:\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>','Logo.png','id_transaction_from','$product_details.bay','/view/:id','staff','/../public','English','save','$product_details.maxProducts','$product_details.unit','New_Qty_Converted','1615470jHFXSc','language','errors','Rooms','English\x20(US)','stock','findOne','logo','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','prod_invoice','\x20<>\x20','maxperunit','primary_code','max_per_unit','<!DOCTYPE\x20html>','$room','$product_details._id','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<strong>\x20Regards\x20</strong>','Floor','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>','<tr>','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','/upload/','$product_details.batch_code','flash','product','back','/preview/:id','Primary_Units','bin','role','edit_adjustment_view','96dgRExi','<div>','$name','<tbody\x20style=\x22text-align:\x20center;\x22>','findById','createTransport','log','$product_details.product_code','post','French','$product_details.product_cat','padStart','$product_details.level','</div>','$product_details','finalize','prod_name','rack','note','forEach','product_stock','../middleware/auth','</h5>','</tbody>','RMSEmail','site_title','/view','secondary_unit','minus','product_code','level','type','There\x27s\x20a\x20error\x20in\x20this\x20transaction','nodemailer','../public/language/languages.json','$finalize','Return\x20Goods','prod_code','$product_details.production_date','Error\x20Occurs','11801ZecQcM','expiry_date','date','prod_cat','Enabled','string','\x20</h2>','/CheckingWarehouse','<h5>','</span>','<hr\x20class=\x22my-3\x22>','email','batch_code','1739690jsdZbX','German','True','Shelves','types','Portuguese','<table\x20style=\x22width:\x20100%\x20!important;\x22>','Router','express','</td>','message','ADJ-','foreach\x20newproduct','$product_details.maxPerUnit','$product_details.floorlevel','Chinese','/view/add_adjustment','Email\x20sent\x20successfully','$product_details.type','map','success','3980528OQyUGM','secondary_code','error','toString','image','body','$product_details.expiry_date','redirect','$product_details.product_name','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','production_date','Hindi','Secondary_units','Ambient','floorlevel','invoice','push','$product.room_names','\x20Order\x20Date\x20:\x20','$product_details.bin','</thead>','$product_details.primary_code','</head><body>','$product_details.storage','adjustment\x20Finalized\x20successfully'];a0_0x37c5=function(){return _0x356bd7;};return a0_0x37c5();}const express=require(a0_0x15da6e(0x221)),app=express(),router=express[a0_0x15da6e(0x220)](),auth=require(a0_0x15da6e(0x1f9)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,supervisor_settings,email_settings}=require('../models/all_models'),users=require(a0_0x15da6e(0x206)),nodemailer=require(a0_0x15da6e(0x205));function a0_0x31b5(_0x44efad,_0x12f293){var _0x37c5ef=a0_0x37c5();return a0_0x31b5=function(_0x31b51a,_0x2c3da8){_0x31b51a=_0x31b51a-0x1a7;var _0x164abd=_0x37c5ef[_0x31b51a];return _0x164abd;},a0_0x31b5(_0x44efad,_0x12f293);}router['get'](a0_0x15da6e(0x1fe),auth,async(_0x409d5a,_0x1281ac)=>{var _0x10b35d=a0_0x15da6e;try{const {username:_0xa4ad74,email:_0x246bac,role:_0x395a34}=_0x409d5a[_0x10b35d(0x24b)],_0x1e50cf=_0x409d5a['user'],_0x20e8d4=await profile[_0x10b35d(0x1c9)]({'email':_0x1e50cf[_0x10b35d(0x217)]}),_0x5e0769=await master_shop[_0x10b35d(0x256)]();console[_0x10b35d(0x1ea)](_0x10b35d(0x252),_0x5e0769);let _0x438d71;if(_0x1e50cf[_0x10b35d(0x1e2)]==_0x10b35d(0x1bc)){const _0x15983c=await staff['findOne']({'email':_0x1e50cf[_0x10b35d(0x217)]});_0x438d71=await warehouse[_0x10b35d(0x256)]({'status':_0x10b35d(0x210),'name':_0x15983c['warehouse']});}else _0x438d71=await warehouse[_0x10b35d(0x256)]({'status':_0x10b35d(0x210)});const _0x4e3331=await product[_0x10b35d(0x256)]();let _0x38c2f5;if(_0x1e50cf[_0x10b35d(0x1e2)]=='staff'){const _0x39b628=await staff[_0x10b35d(0x1c9)]({'email':_0x1e50cf[_0x10b35d(0x217)]});_0x38c2f5=await adjustment[_0x10b35d(0x256)]({'warehouse_name':_0x39b628[_0x10b35d(0x25f)]});}else _0x38c2f5=await adjustment[_0x10b35d(0x265)]([{'$unwind':'$product'},{'$group':{'_id':'$_id','invoice':{'$first':_0x10b35d(0x247)},'date':{'$first':'$date'},'warehouse_name':{'$first':_0x10b35d(0x253)},'room':{'$addToSet':_0x10b35d(0x23f)},'finalize':{'$first':_0x10b35d(0x207)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x5e0769[0x0][_0x10b35d(0x1c4)]=='English\x20(US)'){var _0x4afe3e=users[_0x10b35d(0x1be)];console[_0x10b35d(0x1ea)](_0x4afe3e);}else{if(_0x5e0769[0x0][_0x10b35d(0x1c4)]==_0x10b35d(0x239))var _0x4afe3e=users[_0x10b35d(0x239)];else{if(_0x5e0769[0x0][_0x10b35d(0x1c4)]==_0x10b35d(0x21a))var _0x4afe3e=users[_0x10b35d(0x21a)];else{if(_0x5e0769[0x0][_0x10b35d(0x1c4)]=='Spanish')var _0x4afe3e=users[_0x10b35d(0x259)];else{if(_0x5e0769[0x0][_0x10b35d(0x1c4)]==_0x10b35d(0x1ed))var _0x4afe3e=users[_0x10b35d(0x1ed)];else{if(_0x5e0769[0x0][_0x10b35d(0x1c4)]=='Portuguese\x20(BR)')var _0x4afe3e=users[_0x10b35d(0x21e)];else{if(_0x5e0769[0x0][_0x10b35d(0x1c4)]=='Chinese')var _0x4afe3e=users[_0x10b35d(0x228)];else{if(_0x5e0769[0x0]['language']==_0x10b35d(0x1b1))var _0x4afe3e=users[_0x10b35d(0x251)];}}}}}}}_0x1281ac['render'](_0x10b35d(0x279),{'success':_0x409d5a[_0x10b35d(0x1dc)](_0x10b35d(0x22d)),'errors':_0x409d5a[_0x10b35d(0x1dc)]('errors'),'role':_0x1e50cf,'profile':_0x20e8d4,'warehouse':_0x438d71,'product':_0x4e3331,'adjustment':_0x38c2f5,'master_shop':_0x5e0769,'language':_0x4afe3e});}catch(_0x203082){console['log'](_0x203082);}});async function getRandom8DigitNumber(){var _0x58160b=a0_0x15da6e;const _0x13c632=0x989680,_0x2eb96a=0x5f5e0ff,_0x52ae07=Math['floor'](Math[_0x58160b(0x1aa)]()*(_0x2eb96a-_0x13c632+0x1))+_0x13c632;var _0x2c5b3f;const _0x30bcea=await adjustment[_0x58160b(0x1c9)]({'invoice':'ADJ-'+_0x52ae07});return _0x30bcea&&_0x30bcea['length']>0x0?_0x2c5b3f='ADJ-'+_0x52ae07:_0x2c5b3f=_0x58160b(0x224)+_0x52ae07,_0x2c5b3f;}router[a0_0x15da6e(0x1a7)](a0_0x15da6e(0x229),auth,async(_0x32e3cc,_0x46f3e7)=>{var _0x195bb1=a0_0x15da6e;try{const {username:_0x17aabc,email:_0x315b84,role:_0x2aa395}=_0x32e3cc[_0x195bb1(0x24b)],_0x18f7bd=_0x32e3cc[_0x195bb1(0x24b)],_0x3648cd=await profile[_0x195bb1(0x1c9)]({'email':_0x18f7bd['email']}),_0x20dc37=await master_shop[_0x195bb1(0x256)]();let _0x70a2f2;if(_0x18f7bd['role']==_0x195bb1(0x1bc)){const _0x20d425=await staff[_0x195bb1(0x1c9)]({'email':_0x18f7bd[_0x195bb1(0x217)]});_0x70a2f2=await warehouse[_0x195bb1(0x265)]([{'$match':{'status':'Enabled','name':_0x20d425[_0x195bb1(0x25f)],'warehouse_category':_0x195bb1(0x25a),'name':{'$ne':_0x195bb1(0x208)}}},{'$group':{'_id':_0x195bb1(0x1e6),'name':{'$first':_0x195bb1(0x1e6)}}}]);}else _0x70a2f2=await warehouse[_0x195bb1(0x265)]([{'$match':{'status':'Enabled','warehouse_category':_0x195bb1(0x25a),'name':{'$ne':_0x195bb1(0x208)}}},{'$group':{'_id':_0x195bb1(0x1e6),'name':{'$first':_0x195bb1(0x1e6)}}}]);const _0x3ad52c=await product[_0x195bb1(0x256)]({}),_0x451b13=await adjustment['find']({}),_0x3f0652=_0x451b13['length']+0x1,_0x548734=_0x195bb1(0x224)+_0x3f0652[_0x195bb1(0x231)]()[_0x195bb1(0x1ef)](0x5,'0');var _0x11d2b8=[_0x195bb1(0x23b),'Enclosed','Return\x20Rooms'];if(_0x20dc37[0x0][_0x195bb1(0x1c4)]==_0x195bb1(0x1c7))var _0xe29f06=users[_0x195bb1(0x1be)];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]==_0x195bb1(0x239))var _0xe29f06=users['Hindi'];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]==_0x195bb1(0x21a))var _0xe29f06=users['German'];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]==_0x195bb1(0x259))var _0xe29f06=users[_0x195bb1(0x259)];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]==_0x195bb1(0x1ed))var _0xe29f06=users['French'];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]=='Portuguese\x20(BR)')var _0xe29f06=users[_0x195bb1(0x21e)];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]=='Chinese')var _0xe29f06=users[_0x195bb1(0x228)];else{if(_0x20dc37[0x0][_0x195bb1(0x1c4)]==_0x195bb1(0x1b1))var _0xe29f06=users[_0x195bb1(0x251)];}}}}}}}const _0x2a0ea8=getRandom8DigitNumber();_0x2a0ea8[_0x195bb1(0x26c)](_0x1ef00c=>{var _0x24b940=_0x195bb1;_0x46f3e7[_0x24b940(0x261)](_0x24b940(0x24a),{'success':_0x32e3cc[_0x24b940(0x1dc)](_0x24b940(0x22d)),'errors':_0x32e3cc[_0x24b940(0x1dc)](_0x24b940(0x1c5)),'role':_0x18f7bd,'profile':_0x3648cd,'warehouse':_0x70a2f2,'product':_0x3ad52c,'master_shop':_0x20dc37,'language':_0xe29f06,'rooms_data':_0x11d2b8,'invoice_no':_0x1ef00c});})[_0x195bb1(0x260)](_0x24681c=>{var _0x3352c2=_0x195bb1;_0x32e3cc[_0x3352c2(0x1dc)](_0x3352c2(0x1c5),_0x3352c2(0x204)),_0x46f3e7[_0x3352c2(0x235)]('/adjustment/view');});}catch(_0x515d72){console[_0x195bb1(0x1ea)](_0x515d72);}}),router['post'](a0_0x15da6e(0x229),auth,async(_0x179a0c,_0x52632d)=>{var _0x55f7fa=a0_0x15da6e;try{const {warehouse_name:_0x4779bb,date:_0x18f7a5,prod_name:_0xfd04f6,level:_0x2b8f0e,isle:_0xefd2fe,pallet:_0x369fa0,stock:_0x4ac9e7,types:_0x4f5a37,adjust_qty:_0x4a709d,new_adjust_qty:_0x2da8db,note:_0x402429,Room_name:_0x1bfd50,invoice:_0x14e6be,JO_number:_0x328214,expiry_date:_0x59879d}=_0x179a0c[_0x55f7fa(0x233)];if(typeof _0xfd04f6==_0x55f7fa(0x211))var _0x2cb640=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1f4)]],_0x1a308a=[_0x179a0c[_0x55f7fa(0x233)]['level']],_0x5bd9d7=[_0x179a0c['body']['stock']],_0x3c6ba4=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x21d)]],_0x2b88ca=[_0x179a0c[_0x55f7fa(0x233)]['New_Qty_Converted_adj']],_0x22c394=[_0x179a0c[_0x55f7fa(0x233)]['New_Qty_Converted']],_0x1d63e1=[_0x179a0c['body'][_0x55f7fa(0x1e0)]],_0x1754dd=[_0x179a0c['body'][_0x55f7fa(0x23a)]],_0x4f273b=[_0x179a0c[_0x55f7fa(0x233)]['prod_code']],_0x35db53=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x218)]],_0x3a32c8=[_0x179a0c[_0x55f7fa(0x233)]['expiry_date']],_0x7ca3e3=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1d0)]],_0x34d093=[_0x179a0c['body']['production_date']],_0x59c044=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x20f)]],_0x493deb=[_0x179a0c[_0x55f7fa(0x233)]['Rooms']],_0x211e6f=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x270)]],_0x480af9=[_0x179a0c['body'][_0x55f7fa(0x26b)]],_0x323ff7=[_0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1cc)]],_0x4ef5ee=[_0x179a0c['body'][_0x55f7fa(0x254)]];else var _0x2cb640=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1f4)]],_0x1a308a=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x202)]],_0x5bd9d7=[..._0x179a0c['body'][_0x55f7fa(0x1c8)]],_0x3c6ba4=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x21d)]],_0x2b88ca=[..._0x179a0c['body']['New_Qty_Converted_adj']],_0x22c394=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1c2)]],_0x1d63e1=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1b2)]],_0x1754dd=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x23a)]],_0x4f273b=[..._0x179a0c[_0x55f7fa(0x233)]['prod_code']],_0x35db53=[..._0x179a0c[_0x55f7fa(0x233)]['batch_code']],_0x3a32c8=[..._0x179a0c[_0x55f7fa(0x233)]['expiry_date']],_0x7ca3e3=[..._0x179a0c['body'][_0x55f7fa(0x1d0)]],_0x34d093=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x238)]],_0x59c044=[..._0x179a0c['body'][_0x55f7fa(0x20f)]],_0x493deb=[..._0x179a0c['body']['Rooms']],_0x211e6f=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x270)]],_0x480af9=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x26b)]],_0x323ff7=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x1cc)]],_0x4ef5ee=[..._0x179a0c[_0x55f7fa(0x233)][_0x55f7fa(0x254)]];const _0x1ea378=_0x2cb640[_0x55f7fa(0x22c)](_0x31f288=>{return _0x31f288={'product_name':_0x31f288};});_0x1a308a['forEach']((_0x11846f,_0x5a42ed)=>{var _0x26be35=_0x55f7fa;_0x493deb[_0x26be35(0x1f7)]((_0xbc7a48,_0x3c20f7)=>{var _0x1149ce=_0x26be35;if(_0xbc7a48==_0x1149ce(0x25c)&&_0x5a42ed==_0x3c20f7){var _0x21fee4=_0x11846f['slice'](0x3);_0x1ea378[_0x5a42ed][_0x1149ce(0x24d)]=_0x11846f[0x0],_0x1ea378[_0x5a42ed]['rack']=_0x11846f[0x1],_0x1ea378[_0x5a42ed][_0x1149ce(0x26e)]=0x0,_0x1ea378[_0x5a42ed][_0x1149ce(0x1e1)]=0x0,_0x1ea378[_0x5a42ed]['type']=_0x1149ce(0x1d6),_0x1ea378[_0x5a42ed]['floorlevel']=_0x21fee4;}else{if(_0xbc7a48==_0x1149ce(0x21c)&&_0x5a42ed==_0x3c20f7){var _0x21fee4=_0x11846f['slice'](0x3);_0x1ea378[_0x5a42ed][_0x1149ce(0x24d)]=_0x11846f[0x0],_0x1ea378[_0x5a42ed][_0x1149ce(0x1f5)]=_0x11846f[0x1],_0x1ea378[_0x5a42ed][_0x1149ce(0x26e)]=0x0,_0x1ea378[_0x5a42ed][_0x1149ce(0x1e1)]=0x0,_0x1ea378[_0x5a42ed][_0x1149ce(0x203)]=_0x1149ce(0x1d6),_0x1ea378[_0x5a42ed][_0x1149ce(0x23c)]=_0x11846f[0x5];}else{if(_0x5a42ed==_0x3c20f7){var _0x280e53;if(_0x11846f[0x4]=='L')_0x280e53=_0x1149ce(0x271);else _0x11846f[0x4]=='F'&&(_0x280e53=_0x1149ce(0x1d6));_0x1ea378[_0x5a42ed][_0x1149ce(0x24d)]=_0x11846f[0x0],_0x1ea378[_0x5a42ed][_0x1149ce(0x1f5)]=_0x11846f[0x1],_0x1ea378[_0x5a42ed]['bay']=_0x11846f[0x2],_0x1ea378[_0x5a42ed]['bin']=_0x11846f[0x3],_0x1ea378[_0x5a42ed][_0x1149ce(0x203)]=_0x280e53,_0x1ea378[_0x5a42ed][_0x1149ce(0x23c)]=_0x11846f[0x5];}}}});}),_0x5bd9d7[_0x55f7fa(0x1f7)]((_0x44f252,_0x304d61)=>{var _0x207db5=_0x55f7fa;_0x1ea378[_0x304d61][_0x207db5(0x272)]=_0x44f252;}),_0x4ef5ee['forEach']((_0x137c75,_0x342d1f)=>{var _0x50e83e=_0x55f7fa;_0x1ea378[_0x342d1f][_0x50e83e(0x1b9)]=_0x137c75;}),_0x3c6ba4[_0x55f7fa(0x1f7)]((_0x121b65,_0x10c402)=>{_0x1ea378[_0x10c402]['types']=_0x121b65;}),_0x2b88ca[_0x55f7fa(0x1f7)]((_0x45e4b7,_0x1ccf3a)=>{var _0x48c48a=_0x55f7fa;_0x1ea378[_0x1ccf3a][_0x48c48a(0x27a)]=_0x45e4b7;}),_0x22c394['forEach']((_0x4ed5f8,_0x7a4610)=>{var _0x1ba7c3=_0x55f7fa;_0x1ea378[_0x7a4610][_0x1ba7c3(0x26a)]=_0x4ed5f8;}),_0x1d63e1[_0x55f7fa(0x1f7)]((_0x46c8f4,_0x246129)=>{_0x1ea378[_0x246129]['unit']=_0x46c8f4;}),_0x1754dd['forEach']((_0xa9d9a6,_0x427d6b)=>{var _0x2618de=_0x55f7fa;_0x1ea378[_0x427d6b][_0x2618de(0x1ff)]=_0xa9d9a6;}),_0x4f273b[_0x55f7fa(0x1f7)]((_0x2b46d6,_0x4255b3)=>{var _0x339afe=_0x55f7fa;_0x1ea378[_0x4255b3][_0x339afe(0x201)]=_0x2b46d6;}),_0x35db53[_0x55f7fa(0x1f7)]((_0x50f8b1,_0x49219b)=>{var _0xb577b1=_0x55f7fa;_0x1ea378[_0x49219b][_0xb577b1(0x218)]=_0x50f8b1;}),_0x3a32c8['forEach']((_0x4d373a,_0x15b250)=>{var _0x2b210f=_0x55f7fa;_0x1ea378[_0x15b250][_0x2b210f(0x20d)]=_0x4d373a;}),_0x7ca3e3[_0x55f7fa(0x1f7)]((_0xfb3171,_0x4496d0)=>{var _0x491bb=_0x55f7fa;_0x1ea378[_0x4496d0][_0x491bb(0x1ce)]=_0xfb3171;}),_0x34d093[_0x55f7fa(0x1f7)]((_0x2b327d,_0x53039b)=>{var _0x24c9a8=_0x55f7fa;_0x1ea378[_0x53039b][_0x24c9a8(0x238)]=_0x2b327d;}),_0x59c044['forEach']((_0x919f9e,_0x1fa9c3)=>{var _0xcf670c=_0x55f7fa;_0x1ea378[_0x1fa9c3][_0xcf670c(0x20f)]=_0x919f9e;}),_0x493deb['forEach']((_0x51d7bd,_0x6b1c54)=>{var _0x2f75f8=_0x55f7fa;_0x1ea378[_0x6b1c54][_0x2f75f8(0x248)]=_0x51d7bd;}),_0x211e6f['forEach']((_0x542294,_0x1750e0)=>{_0x1ea378[_0x1750e0]['primary_code']=_0x542294;}),_0x480af9[_0x55f7fa(0x1f7)]((_0x553890,_0x21d41e)=>{_0x1ea378[_0x21d41e]['secondary_code']=_0x553890;}),_0x323ff7[_0x55f7fa(0x1f7)]((_0x4358b8,_0x51ae9a)=>{_0x1ea378[_0x51ae9a]['invoice']=_0x4358b8;});const _0x50b927=_0x1ea378[_0x55f7fa(0x24e)](_0x5e9445=>_0x5e9445[_0x55f7fa(0x27a)]!=='0'&&_0x5e9445[_0x55f7fa(0x27a)]!=='');var _0x56de95=0x0;_0x50b927[_0x55f7fa(0x1f7)](_0x2f1b16=>{var _0x5b1fb8=_0x55f7fa;console['log'](_0x5b1fb8(0x225),_0x2f1b16),parseInt(_0x2f1b16[_0x5b1fb8(0x27a)])<=0x0&&_0x56de95++;});if(_0x56de95!=0x0)return _0x179a0c[_0x55f7fa(0x1dc)]('errors',_0x55f7fa(0x237)),_0x52632d['redirect'](_0x55f7fa(0x1de));const _0xe2e38f=new adjustment({'warehouse_name':_0x4779bb,'date':_0x18f7a5,'product':_0x50b927,'note':_0x402429,'room':_0x1bfd50,'invoice':_0x14e6be,'JO_number':_0x328214,'expiry_date':_0x59879d}),_0x3edc49=await _0xe2e38f[_0x55f7fa(0x1bf)]();_0x179a0c[_0x55f7fa(0x1dc)](_0x55f7fa(0x22d),_0x55f7fa(0x26d)),_0x52632d['redirect'](_0x55f7fa(0x1b0)+_0x3edc49[_0x55f7fa(0x255)]);}catch(_0x568fdb){console['log'](_0x568fdb),_0x52632d[_0x55f7fa(0x25e)](0xc8)[_0x55f7fa(0x249)]({'message':_0x568fdb[_0x55f7fa(0x223)]});}}),router['get'](a0_0x15da6e(0x1df),auth,async(_0x3fec9f,_0x3cd46d)=>{var _0x1bb563=a0_0x15da6e;try{const {username:_0x99c743,email:_0x2fa44c,role:_0x406661}=_0x3fec9f[_0x1bb563(0x24b)],_0x38eca7=_0x3fec9f['user'],_0x7a35ae=await profile[_0x1bb563(0x1c9)]({'email':_0x38eca7[_0x1bb563(0x217)]}),_0x12cd0c=await master_shop[_0x1bb563(0x256)](),_0x3bad1d=_0x3fec9f[_0x1bb563(0x1ac)]['id'],_0x267fa3=await adjustment[_0x1bb563(0x1e8)]({'_id':_0x3bad1d}),_0x1d3431=await purchases[_0x1bb563(0x265)]([{'$match':{'warehouse_name':_0x267fa3['warehouse_name']}},{'$unwind':_0x1bb563(0x27d)},{'$group':{'_id':'$product.product_name'}}]),_0xeef457=await product['find']({}),_0xb19527=await warehouse[_0x1bb563(0x265)]([{'$match':{'name':_0x267fa3['warehouse_name']}},{'$unwind':_0x1bb563(0x1f2)},{'$group':{'_id':_0x1bb563(0x1d3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x1bb563(0x277)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x1bb563(0x241)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x1bb563(0x227)},'primary_code':{'$first':_0x1bb563(0x243)},'secondary_code':{'$first':_0x1bb563(0x26f)},'product_code':{'$first':_0x1bb563(0x1eb)},'storage':{'$first':_0x1bb563(0x245)},'rack':{'$first':_0x1bb563(0x257)},'maxPerUnit':{'$first':_0x1bb563(0x226)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x1bb563(0x20a)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x1bb563(0x1d2)}}}]);if(_0x12cd0c[0x0][_0x1bb563(0x1c4)]=='English\x20(US)'){var _0xcc0669=users[_0x1bb563(0x1be)];console[_0x1bb563(0x1ea)](_0xcc0669);}else{if(_0x12cd0c[0x0]['language']==_0x1bb563(0x239))var _0xcc0669=users[_0x1bb563(0x239)];else{if(_0x12cd0c[0x0][_0x1bb563(0x1c4)]==_0x1bb563(0x21a))var _0xcc0669=users[_0x1bb563(0x21a)];else{if(_0x12cd0c[0x0][_0x1bb563(0x1c4)]==_0x1bb563(0x259))var _0xcc0669=users[_0x1bb563(0x259)];else{if(_0x12cd0c[0x0][_0x1bb563(0x1c4)]=='French')var _0xcc0669=users[_0x1bb563(0x1ed)];else{if(_0x12cd0c[0x0][_0x1bb563(0x1c4)]=='Portuguese\x20(BR)')var _0xcc0669=users['Portuguese'];else{if(_0x12cd0c[0x0][_0x1bb563(0x1c4)]==_0x1bb563(0x228))var _0xcc0669=users['Chinese'];else{if(_0x12cd0c[0x0]['language']==_0x1bb563(0x1b1))var _0xcc0669=users['Arabic'];}}}}}}}_0x3cd46d['render'](_0x1bb563(0x1e3),{'success':_0x3fec9f[_0x1bb563(0x1dc)](_0x1bb563(0x22d)),'errors':_0x3fec9f[_0x1bb563(0x1dc)](_0x1bb563(0x1c5)),'role':_0x38eca7,'profile':_0x7a35ae,'adjustment':_0x267fa3,'stock':_0xb19527,'master_shop':_0x12cd0c,'warehouse_name':_0x1d3431,'unit':_0xeef457,'language':_0xcc0669});}catch(_0xa32647){console[_0x1bb563(0x1ea)](_0xa32647),_0x3cd46d[_0x1bb563(0x25e)](0xc8)['json']({'message':_0xa32647[_0x1bb563(0x223)]});}}),router[a0_0x15da6e(0x1ec)](a0_0x15da6e(0x1df),auth,async(_0x3a10df,_0x5c6c6a)=>{var _0x4568dd=a0_0x15da6e;try{const _0x58cd7f=_0x3a10df[_0x4568dd(0x1ac)]['id'],{warehouse_name:_0x370ca8,Room_name:_0x5b6814}=_0x3a10df['body'],_0x56239d=await adjustment[_0x4568dd(0x1e8)]({'_id':_0x58cd7f}),_0x17b938=_0x56239d['product'][_0x4568dd(0x22c)](async _0x3a0e28=>{var _0x277d44=_0x4568dd;if(_0x3a0e28[_0x277d44(0x27a)]>0x0){var _0x1ed0f5=await warehouse['findOne']({'name':_0x370ca8,'room':_0x3a0e28['room_names'],'warehouse_category':_0x277d44(0x25a)});const _0x207689=_0x1ed0f5['product_details'][_0x277d44(0x22c)](_0x4001fb=>{var _0x52e9be=_0x277d44;console[_0x52e9be(0x1ea)](_0x3a0e28[_0x52e9be(0x21d)]+_0x52e9be(0x1cd));if(_0x3a0e28['types']==_0x52e9be(0x200)){if(_0x4001fb[_0x52e9be(0x269)]==_0x3a0e28[_0x52e9be(0x269)]&&_0x4001fb['floorlevel']==_0x3a0e28[_0x52e9be(0x23c)]&&_0x4001fb[_0x52e9be(0x203)]==_0x3a0e28[_0x52e9be(0x203)]&&_0x4001fb[_0x52e9be(0x1e1)]==_0x3a0e28[_0x52e9be(0x1e1)]&&_0x4001fb[_0x52e9be(0x26e)]==_0x3a0e28[_0x52e9be(0x26e)]&&_0x4001fb[_0x52e9be(0x1f5)]==_0x3a0e28[_0x52e9be(0x1f5)]&&_0x4001fb['storage']==_0x3a0e28[_0x52e9be(0x24d)]&&_0x4001fb[_0x52e9be(0x20d)]==_0x3a0e28['expiry_date']&&_0x4001fb[_0x52e9be(0x218)]==_0x3a0e28[_0x52e9be(0x218)]&&_0x4001fb[_0x52e9be(0x238)]==_0x3a0e28[_0x52e9be(0x238)]&&_0x4001fb[_0x52e9be(0x23d)]==_0x3a0e28[_0x52e9be(0x23d)]&&_0x4001fb[_0x52e9be(0x255)]==_0x3a0e28[_0x52e9be(0x1b9)]){var _0x479091;_0x479091=_0x3a0e28[_0x52e9be(0x27a)],_0x3a0e28[_0x52e9be(0x20f)]=='S'&&(_0x479091=_0x3a0e28['adjust_qty']),_0x4001fb[_0x52e9be(0x1f8)]=_0x4001fb['product_stock']-_0x479091;}}else{if(_0x4001fb['product_name']==_0x3a0e28[_0x52e9be(0x269)]&&_0x4001fb[_0x52e9be(0x23c)]==_0x3a0e28[_0x52e9be(0x23c)]&&_0x4001fb[_0x52e9be(0x203)]==_0x3a0e28[_0x52e9be(0x203)]&&_0x4001fb[_0x52e9be(0x1e1)]==_0x3a0e28[_0x52e9be(0x1e1)]&&_0x4001fb[_0x52e9be(0x26e)]==_0x3a0e28['bay']&&_0x4001fb[_0x52e9be(0x1f5)]==_0x3a0e28[_0x52e9be(0x1f5)]&&_0x4001fb[_0x52e9be(0x24d)]==_0x3a0e28[_0x52e9be(0x24d)]&&_0x4001fb[_0x52e9be(0x20d)]==_0x3a0e28[_0x52e9be(0x20d)]&&_0x4001fb[_0x52e9be(0x218)]==_0x3a0e28[_0x52e9be(0x218)]&&_0x4001fb['production_date']==_0x3a0e28[_0x52e9be(0x238)]&&_0x4001fb[_0x52e9be(0x23d)]==_0x3a0e28[_0x52e9be(0x23d)]&&_0x4001fb[_0x52e9be(0x255)]==_0x3a0e28[_0x52e9be(0x1b9)]){console[_0x52e9be(0x1ea)](_0x3a0e28);var _0x479091;_0x479091=_0x3a0e28[_0x52e9be(0x27a)],_0x3a0e28[_0x52e9be(0x20f)]=='S'&&(_0x479091=_0x3a0e28[_0x52e9be(0x27a)]),_0x4001fb[_0x52e9be(0x1f8)]=_0x4001fb[_0x52e9be(0x1f8)]+_0x479091;}}});}return _0x1ed0f5;});Promise[_0x4568dd(0x275)](_0x17b938)[_0x4568dd(0x26c)](async _0x1e5909=>{var _0x513cb4=_0x4568dd;try{for(const _0x17ab10 of _0x1e5909){await _0x17ab10[_0x513cb4(0x1bf)]();}_0x56239d[_0x513cb4(0x1f3)]=_0x513cb4(0x21b);const _0x5bc45f=await _0x56239d[_0x513cb4(0x1bf)](),_0x5d4cfc=await master_shop[_0x513cb4(0x256)](),_0x4429aa=await email_settings[_0x513cb4(0x1c9)](),_0x122b38=await supervisor_settings['find']();var _0x8ba3fe=_0x56239d[_0x513cb4(0x1dd)],_0x4d32b4='',_0x12534c;for(_0x12534c in _0x8ba3fe){_0x4d32b4+='<tr>'+_0x513cb4(0x276)+_0x8ba3fe[_0x12534c]['product_name']+_0x513cb4(0x222)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8ba3fe[_0x12534c]['product_code']+_0x513cb4(0x222)+_0x513cb4(0x276)+_0x8ba3fe[_0x12534c]['adjust_qty']+_0x513cb4(0x222)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8ba3fe[_0x12534c][_0x513cb4(0x1b2)]+_0x513cb4(0x222)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8ba3fe[_0x12534c]['secondary_unit']+_0x513cb4(0x222)+_0x513cb4(0x276)+_0x56239d[_0x513cb4(0x27b)]+_0x513cb4(0x222)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x8ba3fe[_0x12534c]['room_names']+_0x513cb4(0x222)+_0x513cb4(0x276)+_0x8ba3fe[_0x12534c][_0x513cb4(0x24d)]+_0x8ba3fe[_0x12534c][_0x513cb4(0x1f5)]+_0x8ba3fe[_0x12534c]['bay']+_0x8ba3fe[_0x12534c][_0x513cb4(0x1e1)]+_0x8ba3fe[_0x12534c]['type'][0x0]+_0x8ba3fe[_0x12534c]['floorlevel']+_0x513cb4(0x222),_0x513cb4(0x278);}let _0x532575=nodemailer[_0x513cb4(0x1e9)]({'host':_0x4429aa[_0x513cb4(0x262)],'port':Number(_0x4429aa[_0x513cb4(0x25d)]),'secure':![],'auth':{'user':_0x4429aa['email'],'pass':_0x4429aa['password']}}),_0xf7cd4c={'from':_0x4429aa['email'],'to':_0x122b38[0x0][_0x513cb4(0x1fc)],'subject':_0x513cb4(0x1a9),'attachments':[{'filename':_0x513cb4(0x1b8),'path':__dirname+_0x513cb4(0x1bd)+_0x513cb4(0x1da)+_0x5d4cfc[0x0][_0x513cb4(0x232)],'cid':_0x513cb4(0x1ca)}],'html':_0x513cb4(0x1d1)+'<html><head><title></title>'+_0x513cb4(0x244)+_0x513cb4(0x1e5)+_0x513cb4(0x1d9)+_0x513cb4(0x1e5)+_0x513cb4(0x1cb)+_0x513cb4(0x1f1)+_0x513cb4(0x1e5)+'<h2>\x20'+_0x5d4cfc[0x0][_0x513cb4(0x1fd)]+_0x513cb4(0x212)+_0x513cb4(0x1f1)+'</div>'+_0x513cb4(0x216)+_0x513cb4(0x1e5)+'<h5\x20style=\x22text-align:\x20left;\x22>'+_0x513cb4(0x1b6)+_0x56239d['invoice']+'\x20'+_0x513cb4(0x258)+_0x513cb4(0x240)+_0x56239d['date']+'\x20'+_0x513cb4(0x215)+'</h5>'+'</div>'+_0x513cb4(0x21f)+_0x513cb4(0x27f)+_0x513cb4(0x1d8)+_0x513cb4(0x1b7)+_0x513cb4(0x267)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x513cb4(0x1d4)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+_0x513cb4(0x1d7)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x513cb4(0x278)+_0x513cb4(0x242)+_0x513cb4(0x1e7)+'\x20'+_0x4d32b4+'\x20'+_0x513cb4(0x1fb)+'</table>'+_0x513cb4(0x1e5)+_0x513cb4(0x1d5)+_0x513cb4(0x214)+_0x5d4cfc[0x0]['site_title']+_0x513cb4(0x1fa)+_0x513cb4(0x1f1)+_0x513cb4(0x1f1)+'</body></html>'};_0x532575[_0x513cb4(0x1b4)](_0xf7cd4c,function(_0x232ec9,_0x203475){var _0x3b466e=_0x513cb4;_0x232ec9?(console[_0x3b466e(0x1ea)](_0x232ec9),console['log'](_0x3b466e(0x20b))):console[_0x3b466e(0x1ea)](_0x3b466e(0x22a));}),_0x3a10df[_0x513cb4(0x1dc)](_0x513cb4(0x22d),_0x513cb4(0x246)),_0x5c6c6a[_0x513cb4(0x235)](_0x513cb4(0x1a8)+_0x5bc45f['_id']);}catch(_0x18ec4c){console[_0x513cb4(0x230)](_0x18ec4c),_0x5c6c6a[_0x513cb4(0x25e)](0x1f4)[_0x513cb4(0x249)]({'error':_0x513cb4(0x266)});}})[_0x4568dd(0x260)](_0x13443d=>{var _0x4e9a2e=_0x4568dd;console[_0x4e9a2e(0x230)](_0x13443d),_0x5c6c6a[_0x4e9a2e(0x25e)](0x1f4)['json']({'error':'An\x20error\x20occurred.'});});}catch(_0x522bb2){console[_0x4568dd(0x1ea)](_0x522bb2),_0x5c6c6a[_0x4568dd(0x25e)](0xc8)[_0x4568dd(0x249)]({'message':_0x522bb2[_0x4568dd(0x223)]});}}),router[a0_0x15da6e(0x1a7)]('/view/:id',auth,async(_0x3b1fad,_0x23d844)=>{var _0x3b7b68=a0_0x15da6e;try{const {username:_0x3e04a3,email:_0x423ffa,role:_0xa7001f}=_0x3b1fad[_0x3b7b68(0x24b)],_0x48f8bc=_0x3b1fad['user'],_0x4ead9a=await profile[_0x3b7b68(0x1c9)]({'email':_0x48f8bc[_0x3b7b68(0x217)]}),_0x26a8b5=await master_shop['find'](),_0x1e79c4=_0x3b1fad[_0x3b7b68(0x1ac)]['id'],_0x5e7d5a=await adjustment[_0x3b7b68(0x1e8)]({'_id':_0x1e79c4}),_0x36209d=await purchases[_0x3b7b68(0x265)]([{'$match':{'warehouse_name':_0x5e7d5a[_0x3b7b68(0x27b)]}},{'$unwind':_0x3b7b68(0x27d)},{'$group':{'_id':_0x3b7b68(0x274)}}]),_0x13bb1f=await product['find']({}),_0x3debd4=await warehouse[_0x3b7b68(0x265)]([{'$match':{'name':_0x5e7d5a['warehouse_name']}},{'$unwind':_0x3b7b68(0x1f2)},{'$group':{'_id':_0x3b7b68(0x1d3),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x3b7b68(0x277)},'bay':{'$first':_0x3b7b68(0x1ba)},'bin':{'$first':_0x3b7b68(0x241)},'type':{'$first':_0x3b7b68(0x22b)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x3b7b68(0x243)},'secondary_code':{'$first':_0x3b7b68(0x26f)},'product_code':{'$first':_0x3b7b68(0x1eb)},'storage':{'$first':_0x3b7b68(0x245)},'rack':{'$first':_0x3b7b68(0x257)},'maxPerUnit':{'$first':_0x3b7b68(0x226)},'expiry_date':{'$first':_0x3b7b68(0x234)},'production_date':{'$first':_0x3b7b68(0x20a)},'batch_code':{'$first':'$product_details.batch_code'},'room':{'$first':_0x3b7b68(0x1d2)}}}]);let _0x496cbd;if(_0x48f8bc['role']==_0x3b7b68(0x1bc)){const _0x38606a=await staff[_0x3b7b68(0x1c9)]({'email':_0x48f8bc[_0x3b7b68(0x217)]});_0x496cbd=await warehouse[_0x3b7b68(0x265)]([{'$match':{'status':_0x3b7b68(0x210),'name':_0x38606a[_0x3b7b68(0x25f)],'warehouse_category':_0x3b7b68(0x25a),'name':{'$ne':_0x3b7b68(0x208)}}},{'$group':{'_id':_0x3b7b68(0x1e6),'name':{'$first':'$name'}}}]);}else _0x496cbd=await warehouse[_0x3b7b68(0x265)]([{'$match':{'status':_0x3b7b68(0x210),'warehouse_category':_0x3b7b68(0x25a),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x3b7b68(0x1e6),'name':{'$first':'$name'}}}]);if(_0x26a8b5[0x0][_0x3b7b68(0x1c4)]==_0x3b7b68(0x1c7)){var _0x2919d3=users['English'];console[_0x3b7b68(0x1ea)](_0x2919d3);}else{if(_0x26a8b5[0x0]['language']==_0x3b7b68(0x239))var _0x2919d3=users[_0x3b7b68(0x239)];else{if(_0x26a8b5[0x0][_0x3b7b68(0x1c4)]==_0x3b7b68(0x21a))var _0x2919d3=users[_0x3b7b68(0x21a)];else{if(_0x26a8b5[0x0][_0x3b7b68(0x1c4)]=='Spanish')var _0x2919d3=users['Spanish'];else{if(_0x26a8b5[0x0]['language']=='French')var _0x2919d3=users[_0x3b7b68(0x1ed)];else{if(_0x26a8b5[0x0]['language']==_0x3b7b68(0x273))var _0x2919d3=users['Portuguese'];else{if(_0x26a8b5[0x0][_0x3b7b68(0x1c4)]=='Chinese')var _0x2919d3=users[_0x3b7b68(0x228)];else{if(_0x26a8b5[0x0][_0x3b7b68(0x1c4)]==_0x3b7b68(0x1b1))var _0x2919d3=users[_0x3b7b68(0x251)];}}}}}}}_0x23d844[_0x3b7b68(0x261)]('edit_adjustment',{'success':_0x3b1fad['flash'](_0x3b7b68(0x22d)),'errors':_0x3b1fad[_0x3b7b68(0x1dc)](_0x3b7b68(0x1c5)),'role':_0x48f8bc,'profile':_0x4ead9a,'adjustment':_0x5e7d5a,'stock':_0x3debd4,'master_shop':_0x26a8b5,'warehouse_name':_0x36209d,'unit':_0x13bb1f,'language':_0x2919d3,'warehouse':_0x496cbd});}catch(_0x2242c4){console[_0x3b7b68(0x1ea)](_0x2242c4),_0x23d844[_0x3b7b68(0x25e)](0xc8)[_0x3b7b68(0x249)]({'message':_0x2242c4[_0x3b7b68(0x223)]});}}),router['post'](a0_0x15da6e(0x1bb),auth,async(_0x465589,_0x5d487b)=>{var _0x4533e5=a0_0x15da6e;try{const _0x3671bf=_0x465589[_0x4533e5(0x1ac)]['id'],_0x5f16ec=await adjustment['findById']({'_id':_0x3671bf}),_0x535427=await warehouse[_0x4533e5(0x1c9)]({'name':_0x5f16ec[_0x4533e5(0x27b)],'room':_0x5f16ec['room']}),{warehouse_name:_0x200282,date:_0x4f1cee,prod_name:_0xe8159f,level:_0x5f21b9,isle:_0x38d1e8,pallet:_0x234887,stock:_0x1d678a,types:_0x4e14ad,adjust_qty:_0x5d3dc6,new_adjust_qty:_0x12bcf0,note:_0x2cd43f,Room_name:_0xed98db,invoice:_0x5c6651,JO_number:_0x195a50,expiry_date:_0x51b66a}=_0x465589['body'];if(typeof _0xe8159f==_0x4533e5(0x211))var _0x382388=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x1f4)]],_0x59b608=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x202)]],_0x25f8b2=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x1c8)]],_0x3424b1=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x21d)]],_0x3fd5e9=[_0x465589['body'][_0x4533e5(0x24c)]],_0x3f76ce=[_0x465589[_0x4533e5(0x233)]['New_Qty_Converted']],_0x3575e1=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x1e0)]],_0x3cd14b=[_0x465589['body']['Secondary_units']],_0x52e2ac=[_0x465589['body'][_0x4533e5(0x209)]],_0x278f66=[_0x465589[_0x4533e5(0x233)]['batch_code']],_0x2c76d4=[_0x465589[_0x4533e5(0x233)]['expiry_date']],_0x2e9e7e=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x1d0)]],_0x517296=[_0x465589[_0x4533e5(0x233)]['production_date']],_0x1bf932=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x20f)]],_0x3169ba=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x1c6)]],_0x5ea085=[_0x465589[_0x4533e5(0x233)]['prime1']],_0x18e004=[_0x465589[_0x4533e5(0x233)][_0x4533e5(0x26b)]];else var _0x382388=[..._0x465589['body']['prod_name']],_0x59b608=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x202)]],_0x25f8b2=[..._0x465589[_0x4533e5(0x233)]['stock']],_0x3424b1=[..._0x465589[_0x4533e5(0x233)]['types']],_0x3fd5e9=[..._0x465589['body'][_0x4533e5(0x24c)]],_0x3f76ce=[..._0x465589['body'][_0x4533e5(0x1c2)]],_0x3575e1=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x1b2)]],_0x3cd14b=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x23a)]],_0x52e2ac=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x209)]],_0x278f66=[..._0x465589['body'][_0x4533e5(0x218)]],_0x2c76d4=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x20d)]],_0x2e9e7e=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x1d0)]],_0x517296=[..._0x465589['body'][_0x4533e5(0x238)]],_0x1bf932=[..._0x465589['body'][_0x4533e5(0x20f)]],_0x3169ba=[..._0x465589[_0x4533e5(0x233)][_0x4533e5(0x1c6)]],_0x5ea085=[..._0x465589[_0x4533e5(0x233)]['prime1']],_0x18e004=[..._0x465589[_0x4533e5(0x233)]['second1']];const _0x73384c=_0x382388[_0x4533e5(0x22c)](_0x2fd41b=>{return _0x2fd41b={'product_name':_0x2fd41b};});_0x59b608[_0x4533e5(0x1f7)]((_0x2ff8a2,_0x5ab721)=>{_0x3169ba['forEach']((_0x2884e2,_0x2605ba)=>{var _0x2e253c=a0_0x31b5;if(_0x2884e2==_0x2e253c(0x25c)&&_0x5ab721==_0x2605ba){var _0x311db7=_0x2ff8a2[_0x2e253c(0x24f)](0x3);_0x73384c[_0x5ab721][_0x2e253c(0x24d)]=_0x2ff8a2[0x0],_0x73384c[_0x5ab721]['rack']=_0x2ff8a2[0x1],_0x73384c[_0x5ab721][_0x2e253c(0x26e)]=0x0,_0x73384c[_0x5ab721][_0x2e253c(0x1e1)]=0x0,_0x73384c[_0x5ab721]['type']=_0x2e253c(0x1d6),_0x73384c[_0x5ab721][_0x2e253c(0x23c)]=_0x311db7;}else{if(_0x2884e2=='Shelves'&&_0x5ab721==_0x2605ba){var _0x311db7=_0x2ff8a2[_0x2e253c(0x24f)](0x3);_0x73384c[_0x5ab721]['storage']=_0x2ff8a2[0x0],_0x73384c[_0x5ab721][_0x2e253c(0x1f5)]=_0x2ff8a2[0x1],_0x73384c[_0x5ab721][_0x2e253c(0x26e)]=0x0,_0x73384c[_0x5ab721][_0x2e253c(0x1e1)]=0x0,_0x73384c[_0x5ab721][_0x2e253c(0x203)]='Floor',_0x73384c[_0x5ab721]['floorlevel']=_0x2ff8a2[0x5];}else{if(_0x5ab721==_0x2605ba){var _0x20a4b4;if(_0x2ff8a2[0x4]=='L')_0x20a4b4=_0x2e253c(0x271);else _0x2ff8a2[0x4]=='F'&&(_0x20a4b4='Floor');_0x73384c[_0x5ab721][_0x2e253c(0x24d)]=_0x2ff8a2[0x0],_0x73384c[_0x5ab721][_0x2e253c(0x1f5)]=_0x2ff8a2[0x1],_0x73384c[_0x5ab721][_0x2e253c(0x26e)]=_0x2ff8a2[0x2],_0x73384c[_0x5ab721][_0x2e253c(0x1e1)]=_0x2ff8a2[0x3],_0x73384c[_0x5ab721]['type']=_0x20a4b4,_0x73384c[_0x5ab721][_0x2e253c(0x23c)]=_0x2ff8a2[0x5];}}}});}),_0x25f8b2[_0x4533e5(0x1f7)]((_0x4baff8,_0x353f89)=>{var _0x848996=_0x4533e5;_0x73384c[_0x353f89][_0x848996(0x272)]=_0x4baff8;}),_0x3424b1['forEach']((_0x455fbb,_0x4e03f8)=>{var _0x4eab3a=_0x4533e5;_0x73384c[_0x4e03f8][_0x4eab3a(0x21d)]=_0x455fbb;}),_0x3fd5e9[_0x4533e5(0x1f7)]((_0x108ea1,_0x37cdad)=>{var _0x1f5bec=_0x4533e5;_0x73384c[_0x37cdad][_0x1f5bec(0x27a)]=_0x108ea1;}),_0x3f76ce[_0x4533e5(0x1f7)]((_0x4d9efa,_0x1303b9)=>{var _0x428770=_0x4533e5;_0x73384c[_0x1303b9][_0x428770(0x26a)]=_0x4d9efa;}),_0x3575e1[_0x4533e5(0x1f7)]((_0x92461f,_0x2facf8)=>{_0x73384c[_0x2facf8]['unit']=_0x92461f;}),_0x3cd14b[_0x4533e5(0x1f7)]((_0x49f893,_0x40c6fb)=>{var _0x4c3ec4=_0x4533e5;_0x73384c[_0x40c6fb][_0x4c3ec4(0x1ff)]=_0x49f893;}),_0x52e2ac[_0x4533e5(0x1f7)]((_0x26f520,_0x3c49a8)=>{var _0x7356b2=_0x4533e5;_0x73384c[_0x3c49a8][_0x7356b2(0x201)]=_0x26f520;}),_0x278f66['forEach']((_0x12a6df,_0x2ef025)=>{var _0x10bf62=_0x4533e5;_0x73384c[_0x2ef025][_0x10bf62(0x218)]=_0x12a6df;}),_0x2c76d4[_0x4533e5(0x1f7)]((_0x5b1db0,_0x4713ff)=>{var _0x2c4965=_0x4533e5;_0x73384c[_0x4713ff][_0x2c4965(0x20d)]=_0x5b1db0;}),_0x2e9e7e['forEach']((_0x1421f2,_0x161e65)=>{var _0x5c5e66=_0x4533e5;_0x73384c[_0x161e65][_0x5c5e66(0x1ce)]=_0x1421f2;}),_0x517296[_0x4533e5(0x1f7)]((_0x13f9d8,_0x38a812)=>{var _0x5dcf2b=_0x4533e5;_0x73384c[_0x38a812][_0x5dcf2b(0x238)]=_0x13f9d8;}),_0x1bf932[_0x4533e5(0x1f7)]((_0x15577c,_0x5f5c4b)=>{var _0x417c6f=_0x4533e5;_0x73384c[_0x5f5c4b][_0x417c6f(0x20f)]=_0x15577c;}),_0x3169ba[_0x4533e5(0x1f7)]((_0x5bd64a,_0x4ed420)=>{_0x73384c[_0x4ed420]['room_names']=_0x5bd64a;}),_0x5ea085[_0x4533e5(0x1f7)]((_0x5117ff,_0x2fa264)=>{var _0x17b6f6=_0x4533e5;_0x73384c[_0x2fa264][_0x17b6f6(0x1cf)]=_0x5117ff;}),_0x18e004[_0x4533e5(0x1f7)]((_0x109c29,_0x342d52)=>{var _0x2506d6=_0x4533e5;_0x73384c[_0x342d52][_0x2506d6(0x22f)]=_0x109c29;});const _0x2dfe88=_0x73384c['filter'](_0x1d8a06=>_0x1d8a06[_0x4533e5(0x27a)]!=='0'&&_0x1d8a06[_0x4533e5(0x27a)]!=='');var _0x58225b=0x0;_0x2dfe88['forEach'](_0x915460=>{var _0x52806b=_0x4533e5;console['log'](_0x52806b(0x225),_0x915460),parseInt(_0x915460[_0x52806b(0x27a)])<=0x0&&_0x58225b++;});if(_0x58225b!=0x0)return _0x465589[_0x4533e5(0x1dc)](_0x4533e5(0x1c5),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x5d487b[_0x4533e5(0x235)](_0x4533e5(0x1de));_0x5f16ec[_0x4533e5(0x27b)]=_0x200282,_0x5f16ec[_0x4533e5(0x20e)]=_0x4f1cee,_0x5f16ec[_0x4533e5(0x1dd)]=_0x2dfe88,_0x5f16ec[_0x4533e5(0x1f6)]=_0x2cd43f,_0x5f16ec[_0x4533e5(0x23d)]=_0x5c6651,_0x5f16ec[_0x4533e5(0x27c)]=_0x4533e5(0x1b3);const _0x71a0cb=await _0x5f16ec[_0x4533e5(0x1bf)]();_0x465589['flash'](_0x4533e5(0x22d),_0x4533e5(0x27e)),_0x5d487b[_0x4533e5(0x235)](_0x4533e5(0x268));}catch(_0x116754){console[_0x4533e5(0x1ea)](_0x116754);}}),router[a0_0x15da6e(0x1ec)](a0_0x15da6e(0x1b5),async(_0x1b5dea,_0x2f01b1)=>{var _0x475563=a0_0x15da6e;const {primary_code:_0x341bb5,warehouse_data:_0x47b6d2,rooms_data:_0x5cd43a,Roomslist:_0x4f0b5d}=_0x1b5dea[_0x475563(0x233)],_0xf68b6d=_0x4f0b5d[_0x475563(0x1ab)](','),_0x506a44=[];async function _0x11efa3(_0x337481){var _0x29d554=_0x475563;const _0x419d4d=await warehouse[_0x29d554(0x265)]([{'$match':{'name':_0x47b6d2,'room':_0x337481}},{'$unwind':_0x29d554(0x1f2)},{'$match':{'product_details.primary_code':_0x341bb5}},{'$group':{'_id':_0x29d554(0x1d3),'name':{'$first':_0x29d554(0x236)},'product_stock':{'$first':_0x29d554(0x277)},'primary_code':{'$first':_0x29d554(0x243)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x29d554(0x1eb)},'level':{'$first':_0x29d554(0x1ba)},'isle':{'$first':_0x29d554(0x241)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x29d554(0x227)},'unit':{'$first':_0x29d554(0x1c1)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':_0x29d554(0x234)},'production_date':{'$first':_0x29d554(0x20a)},'maxPerUnit':{'$first':_0x29d554(0x226)},'batch_code':{'$first':_0x29d554(0x1db)},'product_cat':{'$first':_0x29d554(0x1ee)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x29d554(0x1d2)},'invoice':{'$first':'$product_details.invoice'}}}]),_0x5023ca=await warehouse[_0x29d554(0x265)]([{'$match':{'name':_0x47b6d2,'room':_0x337481}},{'$unwind':_0x29d554(0x1f2)},{'$match':{'product_details.secondary_code':_0x341bb5}},{'$group':{'_id':_0x29d554(0x1d3),'name':{'$first':_0x29d554(0x236)},'product_stock':{'$first':_0x29d554(0x277)},'primary_code':{'$first':'$product_details.primary_code'},'secondary_code':{'$first':_0x29d554(0x26f)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x29d554(0x1ba)},'isle':{'$first':'$product_details.bin'},'type':{'$first':_0x29d554(0x22b)},'pallet':{'$first':_0x29d554(0x227)},'unit':{'$first':_0x29d554(0x1c1)},'secondary_unit':{'$first':_0x29d554(0x264)},'storage':{'$first':_0x29d554(0x245)},'rack':{'$first':_0x29d554(0x257)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x29d554(0x20a)},'maxPerUnit':{'$first':_0x29d554(0x226)},'batch_code':{'$first':_0x29d554(0x1db)},'product_cat':{'$first':_0x29d554(0x1ee)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x29d554(0x1d2)}}}]);if(_0x419d4d['length']>0x0)_0x506a44[_0x29d554(0x23e)](_0x419d4d);else _0x5023ca[_0x29d554(0x1ad)]>0x0&&_0x506a44['push'](_0x5023ca);}const _0x67301e=_0xf68b6d['map'](_0x1b448e=>_0x11efa3(_0x1b448e));await Promise[_0x475563(0x275)](_0x67301e),_0x2f01b1[_0x475563(0x249)](_0x506a44);}),router[a0_0x15da6e(0x1ec)](a0_0x15da6e(0x213),async(_0x202bb1,_0x4d6dad)=>{var _0x4e73c6=a0_0x15da6e;const {primaryCode:_0x3e87a1,secondaryCode:_0x3cce94,productCode:_0x2707bd,level:_0x55b94b,isle:_0x498bfd,pallet:_0x331acd,warehouses:_0x5ccc95,room:_0x2f4611}=_0x202bb1[_0x4e73c6(0x233)];try{const _0x3517af=await warehouse['aggregate']([{'$match':{'name':_0x5ccc95,'room':_0x2f4611}},{'$unwind':_0x4e73c6(0x1f2)},{'$match':{'product_details.level':parseInt(_0x55b94b),'product_details.isle':_0x498bfd,'product_details.pallet':parseInt(_0x331acd)}},{'$group':{'_id':_0x4e73c6(0x1d3),'name':{'$first':_0x4e73c6(0x236)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':_0x4e73c6(0x1f0)},'isle':{'$first':_0x4e73c6(0x250)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':_0x4e73c6(0x1c0)}}}]);_0x4d6dad[_0x4e73c6(0x25e)](0xc8)[_0x4e73c6(0x249)](_0x3517af);}catch(_0x318aa6){_0x4d6dad['status'](0x194)[_0x4e73c6(0x249)]({'message':_0x318aa6['message']});}}),module['exports']=router;