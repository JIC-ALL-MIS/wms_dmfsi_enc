var a0_0x490503=a0_0x457e;(function(_0xf9bd52,_0x2293f9){var _0xb021b=a0_0x457e,_0x3e59c0=_0xf9bd52();while(!![]){try{var _0x2f573e=-parseInt(_0xb021b(0x18a))/0x1+-parseInt(_0xb021b(0x23f))/0x2+-parseInt(_0xb021b(0x1b1))/0x3+parseInt(_0xb021b(0x209))/0x4*(-parseInt(_0xb021b(0x23d))/0x5)+parseInt(_0xb021b(0x1ba))/0x6*(-parseInt(_0xb021b(0x223))/0x7)+-parseInt(_0xb021b(0x1d2))/0x8+parseInt(_0xb021b(0x1c2))/0x9*(parseInt(_0xb021b(0x177))/0xa);if(_0x2f573e===_0x2293f9)break;else _0x3e59c0['push'](_0x3e59c0['shift']());}catch(_0x36a951){_0x3e59c0['push'](_0x3e59c0['shift']());}}}(a0_0x3066,0x63a46));const express=require('express'),app=express(),router=express[a0_0x490503(0x1f4)](),auth=require('../middleware/auth'),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,supervisor_settings,email_settings}=require(a0_0x490503(0x204)),users=require(a0_0x490503(0x225)),nodemailer=require('nodemailer');function a0_0x3066(){var _0x3ad7ee=['Spanish','$product_details.type','<strong>\x20Regards\x20</strong>','$finalize','status','date','<h5\x20style=\x22text-align:\x20left;\x22>','product_code','$warehouse_name','params','user','Floor','$product_details.secondary_code','prod_name','8110vYbqOV','save','1106748ftUzDI','/barcode_scanner','isAllowEdit','Arabic','<h5>','620CJAbuZ','language','Portuguese','Raw\x20Materials','prod_invoice','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','get','new_adjust_qty','floorlevel','success','batch_code','Portuguese\x20(BR)','json','secondary_unit','<h2>\x20','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','<div>','body','note','161213TIgjlC','post','email','$product_details._id','An\x20error\x20occurred\x20while\x20saving\x20data.','render','maxPerUnit','English\x20(US)','</thead>','all','/../public','\x20</h2>','\x20<>\x20','prod_cat','Receiving\x20Area','</tr>','stockBefore','unit','Level','<tbody\x20style=\x22text-align:\x20center;\x22>','Enabled','$_id','</body></html>','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','staff','adjustment\x20data\x20update\x20successfully','max_per_unit','True','type','\x20Order\x20Number\x20:\x20','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','master','Ambient','findOne','$product_details.product_stock','<hr\x20class=\x22my-3\x22>','Enclosed','split','$product','1870842YXUYKa','catch','New_Qty_Converted','/view/:id','$product_details.product_code','forEach','warehouse','$product_details.floorlevel','$product_details.isle','13032UbdZSz','types','<tr>','/preview/:id','adjust_qty','French','flash','</td>','468522GGfTAp','$product.room_names','</div>','adjustment\x20Finalized\x20successfully','host','slice','$product_details.unit','/adjustment/preview/','German','</tbody>','prod_code','Logo.png','product','log','minus','port','4339944ILhRNA','image','add_adjustment','then','password','length','$product_details.bin','$room','invoice','Email\x20sent\x20successfully','level','bay','$product_details.maxPerUnit','$product_details.bay','secondary_code','error','Return\x20Rooms','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','stock','Arabic\x20(ae)','rack','random','New_Qty_Converted_adj','find','string','$product_details.primary_code','storage','findById','Chinese','Error\x20Occurs','Rooms','$product_details.secondary_unit','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>','Primary_Units','Router','$product.product_name','back','$product_details.production_date','/CheckingWarehouse','</span>','Adjustment\x20Mail','site_title','maxperunit','<!DOCTYPE\x20html>','production_date','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','Secondary_units','$product_details.batch_code','$date','$product_details.storage','../models/all_models','<html><head><title></title>','push','Shelves','prime1','976hwbLDI','product_stock','exports','padStart','product_name','redirect','ADJ-','$name','$product_details.product_name','$product_details.expiry_date','errors','/view/add_adjustment','$product_details','warehouse_name','second1','edit_adjustment_view','/adjustment/view','map','$product_details.rack','_id','room_names','$product_details.level','Hindi','role','message','False','1750PiTgye','An\x20error\x20occurred.','../public/language/languages.json','$product_details.product_cat','expiry_date','filter','sendMail','bin','aggregate','Return\x20Goods','<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','English'];a0_0x3066=function(){return _0x3ad7ee;};return a0_0x3066();}router[a0_0x490503(0x17d)]('/view',auth,async(_0x37a4e8,_0x5bc3b2)=>{var _0x152c74=a0_0x490503;try{const {username:_0x49a4ce,email:_0x1ec218,role:_0x26a76f}=_0x37a4e8[_0x152c74(0x239)],_0x398cb4=_0x37a4e8[_0x152c74(0x239)],_0x87951a=await profile['findOne']({'email':_0x398cb4['email']}),_0xc66bff=await master_shop[_0x152c74(0x1e9)]();console[_0x152c74(0x1cf)](_0x152c74(0x1a9),_0xc66bff);let _0x25bc2c;if(_0x398cb4[_0x152c74(0x220)]==_0x152c74(0x1a2)){const _0x27fb18=await staff[_0x152c74(0x1ab)]({'email':_0x398cb4[_0x152c74(0x18c)]});_0x25bc2c=await warehouse[_0x152c74(0x1e9)]({'status':'Enabled','name':_0x27fb18[_0x152c74(0x1b7)]});}else _0x25bc2c=await warehouse['find']({'status':'Enabled'});const _0x43161f=await product['find']();let _0x5e003b;if(_0x398cb4[_0x152c74(0x220)]==_0x152c74(0x1a2)){const _0x147e3c=await staff[_0x152c74(0x1ab)]({'email':_0x398cb4[_0x152c74(0x18c)]});_0x5e003b=await adjustment[_0x152c74(0x1e9)]({'warehouse_name':_0x147e3c[_0x152c74(0x1b7)]});}else _0x5e003b=await adjustment[_0x152c74(0x22b)]([{'$unwind':'$product'},{'$group':{'_id':_0x152c74(0x19f),'invoice':{'$first':'$invoice'},'date':{'$first':_0x152c74(0x202)},'warehouse_name':{'$first':_0x152c74(0x237)},'room':{'$addToSet':_0x152c74(0x1c3)},'finalize':{'$first':_0x152c74(0x232)},'isAllowEdit':{'$first':'$isAllowEdit'}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0xc66bff[0x0]['language']==_0x152c74(0x191)){var _0x14039b=users[_0x152c74(0x22e)];console[_0x152c74(0x1cf)](_0x14039b);}else{if(_0xc66bff[0x0][_0x152c74(0x178)]==_0x152c74(0x21f))var _0x14039b=users['Hindi'];else{if(_0xc66bff[0x0][_0x152c74(0x178)]=='German')var _0x14039b=users[_0x152c74(0x1ca)];else{if(_0xc66bff[0x0][_0x152c74(0x178)]=='Spanish')var _0x14039b=users['Spanish'];else{if(_0xc66bff[0x0]['language']==_0x152c74(0x1bf))var _0x14039b=users[_0x152c74(0x1bf)];else{if(_0xc66bff[0x0][_0x152c74(0x178)]==_0x152c74(0x182))var _0x14039b=users[_0x152c74(0x179)];else{if(_0xc66bff[0x0][_0x152c74(0x178)]==_0x152c74(0x1ee))var _0x14039b=users['Chinese'];else{if(_0xc66bff[0x0]['language']==_0x152c74(0x1e5))var _0x14039b=users[_0x152c74(0x175)];}}}}}}}_0x5bc3b2[_0x152c74(0x18f)]('adjustment',{'success':_0x37a4e8['flash'](_0x152c74(0x180)),'errors':_0x37a4e8['flash'](_0x152c74(0x213)),'role':_0x398cb4,'profile':_0x87951a,'warehouse':_0x25bc2c,'product':_0x43161f,'adjustment':_0x5e003b,'master_shop':_0xc66bff,'language':_0x14039b});}catch(_0x4aef8d){console[_0x152c74(0x1cf)](_0x4aef8d);}});function a0_0x457e(_0x4ac22c,_0x495b41){var _0x3066e3=a0_0x3066();return a0_0x457e=function(_0x457eb8,_0x1d99ae){_0x457eb8=_0x457eb8-0x175;var _0x76604c=_0x3066e3[_0x457eb8];return _0x76604c;},a0_0x457e(_0x4ac22c,_0x495b41);}async function getRandom8DigitNumber(){var _0x21b447=a0_0x490503;const _0x2a0838=0x989680,_0x130316=0x5f5e0ff,_0xa5bd61=Math['floor'](Math[_0x21b447(0x1e7)]()*(_0x130316-_0x2a0838+0x1))+_0x2a0838;var _0x559d5f;const _0x13dd5c=await adjustment[_0x21b447(0x1ab)]({'invoice':_0x21b447(0x20f)+_0xa5bd61});return _0x13dd5c&&_0x13dd5c['length']>0x0?_0x559d5f=_0x21b447(0x20f)+_0xa5bd61:_0x559d5f=_0x21b447(0x20f)+_0xa5bd61,_0x559d5f;}router[a0_0x490503(0x17d)](a0_0x490503(0x214),auth,async(_0x586903,_0x5d955f)=>{var _0x11538a=a0_0x490503;try{const {username:_0xda5230,email:_0x2981a7,role:_0x12c473}=_0x586903[_0x11538a(0x239)],_0x51b411=_0x586903['user'],_0x28618c=await profile[_0x11538a(0x1ab)]({'email':_0x51b411['email']}),_0x528142=await master_shop[_0x11538a(0x1e9)]();let _0x1755f6;if(_0x51b411[_0x11538a(0x220)]==_0x11538a(0x1a2)){const _0x52271f=await staff['findOne']({'email':_0x51b411['email']});_0x1755f6=await warehouse['aggregate']([{'$match':{'status':_0x11538a(0x19e),'name':_0x52271f[_0x11538a(0x1b7)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x11538a(0x22c)}}},{'$group':{'_id':_0x11538a(0x210),'name':{'$first':'$name'}}}]);}else _0x1755f6=await warehouse['aggregate']([{'$match':{'status':_0x11538a(0x19e),'warehouse_category':_0x11538a(0x17a),'name':{'$ne':_0x11538a(0x22c)}}},{'$group':{'_id':'$name','name':{'$first':_0x11538a(0x210)}}}]);const _0x538da0=await product[_0x11538a(0x1e9)]({}),_0x506771=await adjustment[_0x11538a(0x1e9)]({}),_0x62a7=_0x506771[_0x11538a(0x1d7)]+0x1,_0x41ed12=_0x11538a(0x20f)+_0x62a7['toString']()[_0x11538a(0x20c)](0x5,'0');var _0x24de1b=[_0x11538a(0x1aa),_0x11538a(0x1ae),_0x11538a(0x1e2)];if(_0x528142[0x0][_0x11538a(0x178)]=='English\x20(US)')var _0x23e761=users[_0x11538a(0x22e)];else{if(_0x528142[0x0]['language']==_0x11538a(0x21f))var _0x23e761=users[_0x11538a(0x21f)];else{if(_0x528142[0x0][_0x11538a(0x178)]=='German')var _0x23e761=users['German'];else{if(_0x528142[0x0][_0x11538a(0x178)]==_0x11538a(0x22f))var _0x23e761=users[_0x11538a(0x22f)];else{if(_0x528142[0x0][_0x11538a(0x178)]==_0x11538a(0x1bf))var _0x23e761=users[_0x11538a(0x1bf)];else{if(_0x528142[0x0][_0x11538a(0x178)]==_0x11538a(0x182))var _0x23e761=users['Portuguese'];else{if(_0x528142[0x0][_0x11538a(0x178)]==_0x11538a(0x1ee))var _0x23e761=users[_0x11538a(0x1ee)];else{if(_0x528142[0x0][_0x11538a(0x178)]==_0x11538a(0x1e5))var _0x23e761=users['Arabic'];}}}}}}}const _0x4be424=getRandom8DigitNumber();_0x4be424[_0x11538a(0x1d5)](_0x4124eb=>{var _0x2ce4f0=_0x11538a;_0x5d955f[_0x2ce4f0(0x18f)](_0x2ce4f0(0x1d4),{'success':_0x586903[_0x2ce4f0(0x1c0)](_0x2ce4f0(0x180)),'errors':_0x586903[_0x2ce4f0(0x1c0)](_0x2ce4f0(0x213)),'role':_0x51b411,'profile':_0x28618c,'warehouse':_0x1755f6,'product':_0x538da0,'master_shop':_0x528142,'language':_0x23e761,'rooms_data':_0x24de1b,'invoice_no':_0x4124eb});})[_0x11538a(0x1b2)](_0x579a64=>{var _0x344871=_0x11538a;_0x586903[_0x344871(0x1c0)](_0x344871(0x213),'There\x27s\x20a\x20error\x20in\x20this\x20transaction'),_0x5d955f[_0x344871(0x20e)](_0x344871(0x219));});}catch(_0x5c613a){console[_0x11538a(0x1cf)](_0x5c613a);}}),router['post']('/view/add_adjustment',auth,async(_0x5c47a5,_0x449de9)=>{var _0x30aeb1=a0_0x490503;try{const {warehouse_name:_0x31c22b,date:_0x4204eb,prod_name:_0x517b53,level:_0x29a621,isle:_0x569326,pallet:_0x1c4418,stock:_0x40ef38,types:_0x4cede7,adjust_qty:_0x1916b3,new_adjust_qty:_0x1b3513,note:_0x5a2351,Room_name:_0x3257a1,invoice:_0x2f3908,JO_number:_0x56d35a,expiry_date:_0x1a3aa5}=_0x5c47a5[_0x30aeb1(0x188)];if(typeof _0x517b53==_0x30aeb1(0x1ea))var _0x4f6c99=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x23c)]],_0x54a890=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1dc)]],_0x3a0144=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1e4)]],_0x2a856e=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1bb)]],_0x20993c=[_0x5c47a5[_0x30aeb1(0x188)]['New_Qty_Converted_adj']],_0x3db177=[_0x5c47a5['body']['New_Qty_Converted']],_0x447483=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1f3)]],_0x2c8c2c=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x200)]],_0x4f7c28=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1cc)]],_0x2c568a=[_0x5c47a5['body'][_0x30aeb1(0x181)]],_0x1f5b6e=[_0x5c47a5[_0x30aeb1(0x188)]['expiry_date']],_0x199328=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1a4)]],_0x397bdb=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1fe)]],_0x171a92=[_0x5c47a5['body'][_0x30aeb1(0x197)]],_0x585616=[_0x5c47a5['body'][_0x30aeb1(0x1f0)]],_0x465740=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x208)]],_0x1d3930=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x217)]],_0x16e75b=[_0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x17b)]];else var _0x4f6c99=[..._0x5c47a5[_0x30aeb1(0x188)]['prod_name']],_0x54a890=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1dc)]],_0x3a0144=[..._0x5c47a5['body']['stock']],_0x2a856e=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1bb)]],_0x20993c=[..._0x5c47a5[_0x30aeb1(0x188)]['New_Qty_Converted_adj']],_0x3db177=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1b3)]],_0x447483=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x19b)]],_0x2c8c2c=[..._0x5c47a5['body'][_0x30aeb1(0x200)]],_0x4f7c28=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x1cc)]],_0x2c568a=[..._0x5c47a5['body']['batch_code']],_0x1f5b6e=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x227)]],_0x199328=[..._0x5c47a5[_0x30aeb1(0x188)]['max_per_unit']],_0x397bdb=[..._0x5c47a5[_0x30aeb1(0x188)]['production_date']],_0x171a92=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x197)]],_0x585616=[..._0x5c47a5['body'][_0x30aeb1(0x1f0)]],_0x465740=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x208)]],_0x1d3930=[..._0x5c47a5['body'][_0x30aeb1(0x217)]],_0x16e75b=[..._0x5c47a5[_0x30aeb1(0x188)][_0x30aeb1(0x17b)]];const _0x172959=_0x4f6c99[_0x30aeb1(0x21a)](_0x58418e=>{return _0x58418e={'product_name':_0x58418e};});_0x54a890[_0x30aeb1(0x1b6)]((_0x498423,_0x48fd94)=>{var _0x3f8cae=_0x30aeb1;_0x585616[_0x3f8cae(0x1b6)]((_0x2beabb,_0x5c957f)=>{var _0xb52f46=_0x3f8cae;if(_0x2beabb==_0xb52f46(0x198)&&_0x48fd94==_0x5c957f){var _0x2e4d72=_0x498423[_0xb52f46(0x1c7)](0x3);_0x172959[_0x48fd94][_0xb52f46(0x1ec)]=_0x498423[0x0],_0x172959[_0x48fd94][_0xb52f46(0x1e6)]=_0x498423[0x1],_0x172959[_0x48fd94][_0xb52f46(0x1dd)]=0x0,_0x172959[_0x48fd94][_0xb52f46(0x22a)]=0x0,_0x172959[_0x48fd94][_0xb52f46(0x1a6)]=_0xb52f46(0x23a),_0x172959[_0x48fd94][_0xb52f46(0x17f)]=_0x2e4d72;}else{if(_0x2beabb==_0xb52f46(0x207)&&_0x48fd94==_0x5c957f){var _0x2e4d72=_0x498423[_0xb52f46(0x1c7)](0x3);_0x172959[_0x48fd94]['storage']=_0x498423[0x0],_0x172959[_0x48fd94][_0xb52f46(0x1e6)]=_0x498423[0x1],_0x172959[_0x48fd94]['bay']=0x0,_0x172959[_0x48fd94][_0xb52f46(0x22a)]=0x0,_0x172959[_0x48fd94][_0xb52f46(0x1a6)]=_0xb52f46(0x23a),_0x172959[_0x48fd94][_0xb52f46(0x17f)]=_0x498423[0x5];}else{if(_0x48fd94==_0x5c957f){var _0x239424;if(_0x498423[0x4]=='L')_0x239424='Level';else _0x498423[0x4]=='F'&&(_0x239424=_0xb52f46(0x23a));_0x172959[_0x48fd94][_0xb52f46(0x1ec)]=_0x498423[0x0],_0x172959[_0x48fd94][_0xb52f46(0x1e6)]=_0x498423[0x1],_0x172959[_0x48fd94][_0xb52f46(0x1dd)]=_0x498423[0x2],_0x172959[_0x48fd94][_0xb52f46(0x22a)]=_0x498423[0x3],_0x172959[_0x48fd94][_0xb52f46(0x1a6)]=_0x239424,_0x172959[_0x48fd94]['floorlevel']=_0x498423[0x5];}}}});}),_0x3a0144[_0x30aeb1(0x1b6)]((_0x509315,_0x58020a)=>{var _0x43a46f=_0x30aeb1;_0x172959[_0x58020a][_0x43a46f(0x19a)]=_0x509315;}),_0x2a856e[_0x30aeb1(0x1b6)]((_0x32d316,_0x2da020)=>{_0x172959[_0x2da020]['types']=_0x32d316;}),_0x20993c['forEach']((_0x147fc4,_0x23458a)=>{var _0x300a14=_0x30aeb1;_0x172959[_0x23458a][_0x300a14(0x1be)]=_0x147fc4;}),_0x3db177[_0x30aeb1(0x1b6)]((_0xd8eb19,_0x5b117a)=>{_0x172959[_0x5b117a]['new_adjust_qty']=_0xd8eb19;}),_0x447483[_0x30aeb1(0x1b6)]((_0x5a0b80,_0x1b04ed)=>{var _0x2be6bc=_0x30aeb1;_0x172959[_0x1b04ed][_0x2be6bc(0x19b)]=_0x5a0b80;}),_0x2c8c2c[_0x30aeb1(0x1b6)]((_0x3d915a,_0x4b65e3)=>{_0x172959[_0x4b65e3]['secondary_unit']=_0x3d915a;}),_0x4f7c28[_0x30aeb1(0x1b6)]((_0x162eb9,_0x181273)=>{var _0x472dd2=_0x30aeb1;_0x172959[_0x181273][_0x472dd2(0x236)]=_0x162eb9;}),_0x2c568a['forEach']((_0x5a6cf6,_0x379caa)=>{_0x172959[_0x379caa]['batch_code']=_0x5a6cf6;}),_0x1f5b6e['forEach']((_0x3689a7,_0x5cd4a3)=>{var _0x315f66=_0x30aeb1;_0x172959[_0x5cd4a3][_0x315f66(0x227)]=_0x3689a7;}),_0x199328[_0x30aeb1(0x1b6)]((_0x7f1e02,_0xef4195)=>{var _0x411f01=_0x30aeb1;_0x172959[_0xef4195][_0x411f01(0x1fc)]=_0x7f1e02;}),_0x397bdb[_0x30aeb1(0x1b6)]((_0x1562b5,_0x24e380)=>{var _0x2e4702=_0x30aeb1;_0x172959[_0x24e380][_0x2e4702(0x1fe)]=_0x1562b5;}),_0x171a92[_0x30aeb1(0x1b6)]((_0x5571c0,_0x24ee57)=>{_0x172959[_0x24ee57]['prod_cat']=_0x5571c0;}),_0x585616[_0x30aeb1(0x1b6)]((_0x32bb26,_0x3e03c7)=>{_0x172959[_0x3e03c7]['room_names']=_0x32bb26;}),_0x465740[_0x30aeb1(0x1b6)]((_0x3d35d5,_0x284507)=>{_0x172959[_0x284507]['primary_code']=_0x3d35d5;}),_0x1d3930[_0x30aeb1(0x1b6)]((_0x227389,_0x2e5360)=>{var _0x39f985=_0x30aeb1;_0x172959[_0x2e5360][_0x39f985(0x1e0)]=_0x227389;}),_0x16e75b[_0x30aeb1(0x1b6)]((_0x2ee5e5,_0x39d967)=>{_0x172959[_0x39d967]['invoice']=_0x2ee5e5;});const _0x287cdd=_0x172959[_0x30aeb1(0x228)](_0x41b491=>_0x41b491[_0x30aeb1(0x1be)]!=='0'&&_0x41b491[_0x30aeb1(0x1be)]!=='');var _0x300b64=0x0;_0x287cdd[_0x30aeb1(0x1b6)](_0x30bf96=>{var _0x3a8687=_0x30aeb1;console[_0x3a8687(0x1cf)]('foreach\x20newproduct',_0x30bf96),parseInt(_0x30bf96[_0x3a8687(0x1be)])<=0x0&&_0x300b64++;});if(_0x300b64!=0x0)return _0x5c47a5[_0x30aeb1(0x1c0)](_0x30aeb1(0x213),_0x30aeb1(0x1a8)),_0x449de9[_0x30aeb1(0x20e)](_0x30aeb1(0x1f6));const _0x44909a=new adjustment({'warehouse_name':_0x31c22b,'date':_0x4204eb,'product':_0x287cdd,'note':_0x5a2351,'room':_0x3257a1,'invoice':_0x2f3908,'JO_number':_0x56d35a,'expiry_date':_0x1a3aa5}),_0x1be6e6=await _0x44909a[_0x30aeb1(0x23e)]();_0x5c47a5['flash'](_0x30aeb1(0x180),'adjustment\x20add\x20successfull'),_0x449de9[_0x30aeb1(0x20e)](_0x30aeb1(0x1c9)+_0x1be6e6[_0x30aeb1(0x21c)]);}catch(_0x3bb713){console[_0x30aeb1(0x1cf)](_0x3bb713),_0x449de9[_0x30aeb1(0x233)](0xc8)[_0x30aeb1(0x183)]({'message':_0x3bb713['message']});}}),router['get'](a0_0x490503(0x1bd),auth,async(_0x4e4b7d,_0x2d5cfe)=>{var _0x568b40=a0_0x490503;try{const {username:_0x154c02,email:_0x1719a9,role:_0x43d03c}=_0x4e4b7d[_0x568b40(0x239)],_0x206cf9=_0x4e4b7d['user'],_0x6aeeef=await profile[_0x568b40(0x1ab)]({'email':_0x206cf9['email']}),_0x13d481=await master_shop['find'](),_0x58e8e2=_0x4e4b7d[_0x568b40(0x238)]['id'],_0x5b4422=await adjustment['findById']({'_id':_0x58e8e2}),_0x200653=await purchases['aggregate']([{'$match':{'warehouse_name':_0x5b4422[_0x568b40(0x216)]}},{'$unwind':'$product'},{'$group':{'_id':_0x568b40(0x1f5)}}]),_0x5d6b15=await product[_0x568b40(0x1e9)]({}),_0x17b01e=await warehouse[_0x568b40(0x22b)]([{'$match':{'name':_0x5b4422[_0x568b40(0x216)]}},{'$unwind':_0x568b40(0x215)},{'$group':{'_id':_0x568b40(0x18d),'name':{'$first':_0x568b40(0x211)},'product_stock':{'$first':_0x568b40(0x1ac)},'bay':{'$first':_0x568b40(0x1df)},'bin':{'$first':_0x568b40(0x1d8)},'type':{'$first':_0x568b40(0x230)},'floorlevel':{'$first':_0x568b40(0x1b8)},'primary_code':{'$first':_0x568b40(0x1eb)},'secondary_code':{'$first':_0x568b40(0x23b)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'maxPerUnit':{'$first':_0x568b40(0x1de)},'expiry_date':{'$first':_0x568b40(0x212)},'production_date':{'$first':_0x568b40(0x1f7)},'batch_code':{'$first':_0x568b40(0x201)},'room':{'$first':_0x568b40(0x1d9)}}}]);if(_0x13d481[0x0][_0x568b40(0x178)]==_0x568b40(0x191)){var _0x2ed84a=users[_0x568b40(0x22e)];console[_0x568b40(0x1cf)](_0x2ed84a);}else{if(_0x13d481[0x0]['language']==_0x568b40(0x21f))var _0x2ed84a=users['Hindi'];else{if(_0x13d481[0x0][_0x568b40(0x178)]=='German')var _0x2ed84a=users[_0x568b40(0x1ca)];else{if(_0x13d481[0x0][_0x568b40(0x178)]==_0x568b40(0x22f))var _0x2ed84a=users['Spanish'];else{if(_0x13d481[0x0][_0x568b40(0x178)]==_0x568b40(0x1bf))var _0x2ed84a=users[_0x568b40(0x1bf)];else{if(_0x13d481[0x0][_0x568b40(0x178)]=='Portuguese\x20(BR)')var _0x2ed84a=users[_0x568b40(0x179)];else{if(_0x13d481[0x0][_0x568b40(0x178)]=='Chinese')var _0x2ed84a=users[_0x568b40(0x1ee)];else{if(_0x13d481[0x0][_0x568b40(0x178)]==_0x568b40(0x1e5))var _0x2ed84a=users[_0x568b40(0x175)];}}}}}}}_0x2d5cfe[_0x568b40(0x18f)](_0x568b40(0x218),{'success':_0x4e4b7d[_0x568b40(0x1c0)](_0x568b40(0x180)),'errors':_0x4e4b7d[_0x568b40(0x1c0)](_0x568b40(0x213)),'role':_0x206cf9,'profile':_0x6aeeef,'adjustment':_0x5b4422,'stock':_0x17b01e,'master_shop':_0x13d481,'warehouse_name':_0x200653,'unit':_0x5d6b15,'language':_0x2ed84a});}catch(_0x4fb2e6){console[_0x568b40(0x1cf)](_0x4fb2e6),_0x2d5cfe[_0x568b40(0x233)](0xc8)[_0x568b40(0x183)]({'message':_0x4fb2e6[_0x568b40(0x221)]});}}),router['post']('/preview/:id',auth,async(_0x521a3d,_0x30fe60)=>{var _0x25555c=a0_0x490503;try{const _0x37d2e4=_0x521a3d['params']['id'],{warehouse_name:_0x17a31a,Room_name:_0x30db91}=_0x521a3d[_0x25555c(0x188)],_0x2b910e=await adjustment[_0x25555c(0x1ed)]({'_id':_0x37d2e4}),_0x58a098=_0x2b910e[_0x25555c(0x1ce)]['map'](async _0x4ee32f=>{var _0x3c197e=_0x25555c;if(_0x4ee32f[_0x3c197e(0x1be)]>0x0){var _0x45744f=await warehouse[_0x3c197e(0x1ab)]({'name':_0x17a31a,'room':_0x4ee32f[_0x3c197e(0x21d)],'warehouse_category':'Raw\x20Materials'});const _0x38a0da=_0x45744f['product_details'][_0x3c197e(0x21a)](_0x1064a6=>{var _0x1e8fbe=_0x3c197e;if(_0x4ee32f[_0x1e8fbe(0x1a6)]==_0x1e8fbe(0x1d0)){if(_0x1064a6[_0x1e8fbe(0x20d)]==_0x4ee32f[_0x1e8fbe(0x20d)]&&_0x1064a6[_0x1e8fbe(0x17f)]==_0x4ee32f[_0x1e8fbe(0x17f)]&&_0x1064a6[_0x1e8fbe(0x1a6)]==_0x4ee32f[_0x1e8fbe(0x1a6)]&&_0x1064a6[_0x1e8fbe(0x22a)]==_0x4ee32f[_0x1e8fbe(0x22a)]&&_0x1064a6[_0x1e8fbe(0x1dd)]==_0x4ee32f['bay']&&_0x1064a6[_0x1e8fbe(0x1e6)]==_0x4ee32f['rack']&&_0x1064a6[_0x1e8fbe(0x1ec)]==_0x4ee32f[_0x1e8fbe(0x1ec)]&&_0x1064a6[_0x1e8fbe(0x227)]==_0x4ee32f[_0x1e8fbe(0x227)]&&_0x1064a6['batch_code']==_0x4ee32f[_0x1e8fbe(0x181)]&&_0x1064a6[_0x1e8fbe(0x1fe)]==_0x4ee32f[_0x1e8fbe(0x1fe)]&&_0x1064a6['invoice']==_0x4ee32f[_0x1e8fbe(0x1da)]){var _0x39214b;_0x39214b=_0x4ee32f[_0x1e8fbe(0x1be)],_0x4ee32f[_0x1e8fbe(0x197)]=='S'&&(_0x39214b=_0x4ee32f[_0x1e8fbe(0x1be)]),_0x1064a6['product_stock']=_0x1064a6[_0x1e8fbe(0x20a)]-_0x39214b;}}else{if(_0x1064a6[_0x1e8fbe(0x20d)]==_0x4ee32f[_0x1e8fbe(0x20d)]&&_0x1064a6['floorlevel']==_0x4ee32f[_0x1e8fbe(0x17f)]&&_0x1064a6[_0x1e8fbe(0x1a6)]==_0x4ee32f[_0x1e8fbe(0x1a6)]&&_0x1064a6[_0x1e8fbe(0x22a)]==_0x4ee32f[_0x1e8fbe(0x22a)]&&_0x1064a6[_0x1e8fbe(0x1dd)]==_0x4ee32f[_0x1e8fbe(0x1dd)]&&_0x1064a6[_0x1e8fbe(0x1e6)]==_0x4ee32f[_0x1e8fbe(0x1e6)]&&_0x1064a6[_0x1e8fbe(0x1ec)]==_0x4ee32f[_0x1e8fbe(0x1ec)]&&_0x1064a6['expiry_date']==_0x4ee32f['expiry_date']&&_0x1064a6[_0x1e8fbe(0x181)]==_0x4ee32f['batch_code']&&_0x1064a6['production_date']==_0x4ee32f[_0x1e8fbe(0x1fe)]&&_0x1064a6['invoice']==_0x4ee32f[_0x1e8fbe(0x1da)]){console[_0x1e8fbe(0x1cf)](_0x4ee32f);var _0x39214b;_0x39214b=_0x4ee32f[_0x1e8fbe(0x1be)],_0x4ee32f[_0x1e8fbe(0x197)]=='S'&&(_0x39214b=_0x4ee32f[_0x1e8fbe(0x1be)]),console['log'](_0x39214b+_0x1e8fbe(0x196)+_0x4ee32f['adjust_qty']+'\x20<>\x20'+_0x1064a6[_0x1e8fbe(0x190)]+_0x1e8fbe(0x196)+_0x4ee32f['prod_cat']),_0x1064a6[_0x1e8fbe(0x20a)]=_0x1064a6[_0x1e8fbe(0x20a)]+_0x39214b;}}});}return _0x45744f;});Promise['all'](_0x58a098)[_0x25555c(0x1d5)](async _0x5a579b=>{var _0x468539=_0x25555c;try{for(const _0x585474 of _0x5a579b){await _0x585474[_0x468539(0x23e)]();}_0x2b910e['finalize']=_0x468539(0x1a5);const _0x19830b=await _0x2b910e['save'](),_0xb10c7c=await master_shop[_0x468539(0x1e9)](),_0xcc58b=await email_settings['findOne'](),_0x5b2f39=await supervisor_settings['find']();var _0x5825ac=_0x2b910e[_0x468539(0x1ce)],_0x10599e='',_0x46460b;for(_0x46460b in _0x5825ac){_0x10599e+=_0x468539(0x1bc)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5825ac[_0x46460b][_0x468539(0x20d)]+_0x468539(0x1c1)+_0x468539(0x22d)+_0x5825ac[_0x46460b][_0x468539(0x236)]+'</td>'+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5825ac[_0x46460b]['adjust_qty']+_0x468539(0x1c1)+_0x468539(0x22d)+_0x5825ac[_0x46460b][_0x468539(0x19b)]+_0x468539(0x1c1)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x5825ac[_0x46460b][_0x468539(0x184)]+_0x468539(0x1c1)+_0x468539(0x22d)+_0x2b910e[_0x468539(0x216)]+'</td>'+_0x468539(0x22d)+_0x5825ac[_0x46460b][_0x468539(0x21d)]+_0x468539(0x1c1)+_0x468539(0x22d)+_0x5825ac[_0x46460b]['storage']+_0x5825ac[_0x46460b][_0x468539(0x1e6)]+_0x5825ac[_0x46460b][_0x468539(0x1dd)]+_0x5825ac[_0x46460b][_0x468539(0x22a)]+_0x5825ac[_0x46460b][_0x468539(0x1a6)][0x0]+_0x5825ac[_0x46460b]['floorlevel']+'</td>',_0x468539(0x199);}let _0x49aa03=nodemailer['createTransport']({'host':_0xcc58b[_0x468539(0x1c6)],'port':Number(_0xcc58b[_0x468539(0x1d1)]),'secure':![],'auth':{'user':_0xcc58b[_0x468539(0x18c)],'pass':_0xcc58b[_0x468539(0x1d6)]}}),_0x3bc1b9={'from':_0xcc58b[_0x468539(0x18c)],'to':_0x5b2f39[0x0]['RMSEmail'],'subject':_0x468539(0x1fa),'attachments':[{'filename':_0x468539(0x1cd),'path':__dirname+_0x468539(0x194)+'/upload/'+_0xb10c7c[0x0][_0x468539(0x1d3)],'cid':'logo'}],'html':_0x468539(0x1fd)+_0x468539(0x205)+'</head><body>'+_0x468539(0x187)+_0x468539(0x17c)+_0x468539(0x187)+_0x468539(0x1a1)+_0x468539(0x1c4)+_0x468539(0x187)+_0x468539(0x185)+_0xb10c7c[0x0][_0x468539(0x1fb)]+_0x468539(0x195)+_0x468539(0x1c4)+_0x468539(0x1c4)+_0x468539(0x1ad)+_0x468539(0x187)+_0x468539(0x235)+_0x468539(0x1a7)+_0x2b910e[_0x468539(0x1da)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+'\x20Order\x20Date\x20:\x20'+_0x2b910e[_0x468539(0x234)]+'\x20'+_0x468539(0x1f9)+'</h5>'+'</div>'+'<table\x20style=\x22width:\x20100%\x20!important;\x22>'+'<thead\x20style=\x22width:\x20100%\x20!important;\x22>'+_0x468539(0x1bc)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x468539(0x1ff)+_0x468539(0x1f2)+_0x468539(0x186)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>'+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x468539(0x1e3)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>'+_0x468539(0x199)+_0x468539(0x192)+_0x468539(0x19d)+'\x20'+_0x10599e+'\x20'+_0x468539(0x1cb)+'</table>'+_0x468539(0x187)+_0x468539(0x231)+_0x468539(0x176)+_0xb10c7c[0x0]['site_title']+'</h5>'+_0x468539(0x1c4)+'</div>'+_0x468539(0x1a0)};_0x49aa03[_0x468539(0x229)](_0x3bc1b9,function(_0x316e46,_0x98a3d9){var _0x3cb41b=_0x468539;_0x316e46?(console[_0x3cb41b(0x1cf)](_0x316e46),console[_0x3cb41b(0x1cf)](_0x3cb41b(0x1ef))):console[_0x3cb41b(0x1cf)](_0x3cb41b(0x1db));}),_0x521a3d['flash'](_0x468539(0x180),_0x468539(0x1c5)),_0x30fe60['redirect']('/picking_list/PDF_adjustment_rm/'+_0x19830b[_0x468539(0x21c)]);}catch(_0x152c52){console[_0x468539(0x1e1)](_0x152c52),_0x30fe60[_0x468539(0x233)](0x1f4)[_0x468539(0x183)]({'error':_0x468539(0x18e)});}})[_0x25555c(0x1b2)](_0x87d9a4=>{var _0x34b732=_0x25555c;console[_0x34b732(0x1e1)](_0x87d9a4),_0x30fe60[_0x34b732(0x233)](0x1f4)[_0x34b732(0x183)]({'error':_0x34b732(0x224)});});}catch(_0x5bb45b){console[_0x25555c(0x1cf)](_0x5bb45b),_0x30fe60[_0x25555c(0x233)](0xc8)[_0x25555c(0x183)]({'message':_0x5bb45b[_0x25555c(0x221)]});}}),router[a0_0x490503(0x17d)](a0_0x490503(0x1b4),auth,async(_0x3cd0e1,_0x26498e)=>{var _0x17c94c=a0_0x490503;try{const {username:_0x60cd61,email:_0x1a7a7b,role:_0x124068}=_0x3cd0e1[_0x17c94c(0x239)],_0x501989=_0x3cd0e1[_0x17c94c(0x239)],_0x4cba6d=await profile[_0x17c94c(0x1ab)]({'email':_0x501989[_0x17c94c(0x18c)]}),_0x163c16=await master_shop[_0x17c94c(0x1e9)](),_0x58c410=_0x3cd0e1[_0x17c94c(0x238)]['id'],_0x11fe72=await adjustment[_0x17c94c(0x1ed)]({'_id':_0x58c410}),_0x26113c=await purchases[_0x17c94c(0x22b)]([{'$match':{'warehouse_name':_0x11fe72['warehouse_name']}},{'$unwind':_0x17c94c(0x1b0)},{'$group':{'_id':_0x17c94c(0x1f5)}}]),_0x19dbe7=await product[_0x17c94c(0x1e9)]({}),_0x29c06=await warehouse[_0x17c94c(0x22b)]([{'$match':{'name':_0x11fe72[_0x17c94c(0x216)]}},{'$unwind':_0x17c94c(0x215)},{'$group':{'_id':'$product_details._id','name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x17c94c(0x1ac)},'bay':{'$first':_0x17c94c(0x1df)},'bin':{'$first':_0x17c94c(0x1d8)},'type':{'$first':'$product_details.type'},'floorlevel':{'$first':_0x17c94c(0x1b8)},'primary_code':{'$first':_0x17c94c(0x1eb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x17c94c(0x1b5)},'storage':{'$first':_0x17c94c(0x203)},'rack':{'$first':'$product_details.rack'},'maxPerUnit':{'$first':_0x17c94c(0x1de)},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x17c94c(0x1f7)},'batch_code':{'$first':_0x17c94c(0x201)},'room':{'$first':'$room'}}}]);let _0x127cc4;if(_0x501989[_0x17c94c(0x220)]=='staff'){const _0x30f32c=await staff[_0x17c94c(0x1ab)]({'email':_0x501989[_0x17c94c(0x18c)]});_0x127cc4=await warehouse[_0x17c94c(0x22b)]([{'$match':{'status':'Enabled','name':_0x30f32c[_0x17c94c(0x1b7)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x17c94c(0x22c)}}},{'$group':{'_id':_0x17c94c(0x210),'name':{'$first':_0x17c94c(0x210)}}}]);}else _0x127cc4=await warehouse[_0x17c94c(0x22b)]([{'$match':{'status':_0x17c94c(0x19e),'warehouse_category':_0x17c94c(0x17a),'name':{'$ne':'Return\x20Goods'}}},{'$group':{'_id':_0x17c94c(0x210),'name':{'$first':'$name'}}}]);if(_0x163c16[0x0][_0x17c94c(0x178)]==_0x17c94c(0x191)){var _0x21a0ce=users[_0x17c94c(0x22e)];console[_0x17c94c(0x1cf)](_0x21a0ce);}else{if(_0x163c16[0x0][_0x17c94c(0x178)]==_0x17c94c(0x21f))var _0x21a0ce=users[_0x17c94c(0x21f)];else{if(_0x163c16[0x0][_0x17c94c(0x178)]==_0x17c94c(0x1ca))var _0x21a0ce=users[_0x17c94c(0x1ca)];else{if(_0x163c16[0x0][_0x17c94c(0x178)]==_0x17c94c(0x22f))var _0x21a0ce=users[_0x17c94c(0x22f)];else{if(_0x163c16[0x0]['language']==_0x17c94c(0x1bf))var _0x21a0ce=users['French'];else{if(_0x163c16[0x0][_0x17c94c(0x178)]==_0x17c94c(0x182))var _0x21a0ce=users['Portuguese'];else{if(_0x163c16[0x0][_0x17c94c(0x178)]==_0x17c94c(0x1ee))var _0x21a0ce=users['Chinese'];else{if(_0x163c16[0x0]['language']==_0x17c94c(0x1e5))var _0x21a0ce=users[_0x17c94c(0x175)];}}}}}}}_0x26498e[_0x17c94c(0x18f)]('edit_adjustment',{'success':_0x3cd0e1[_0x17c94c(0x1c0)](_0x17c94c(0x180)),'errors':_0x3cd0e1['flash'](_0x17c94c(0x213)),'role':_0x501989,'profile':_0x4cba6d,'adjustment':_0x11fe72,'stock':_0x29c06,'master_shop':_0x163c16,'warehouse_name':_0x26113c,'unit':_0x19dbe7,'language':_0x21a0ce,'warehouse':_0x127cc4});}catch(_0x5a2c4b){console[_0x17c94c(0x1cf)](_0x5a2c4b),_0x26498e['status'](0xc8)[_0x17c94c(0x183)]({'message':_0x5a2c4b['message']});}}),router[a0_0x490503(0x18b)](a0_0x490503(0x1b4),auth,async(_0x216a68,_0x371248)=>{var _0x19b1f6=a0_0x490503;try{const _0x443c46=_0x216a68[_0x19b1f6(0x238)]['id'],_0x55e5c8=await adjustment[_0x19b1f6(0x1ed)]({'_id':_0x443c46}),_0x9649cc=await warehouse[_0x19b1f6(0x1ab)]({'name':_0x55e5c8[_0x19b1f6(0x216)],'room':_0x55e5c8['room']}),{warehouse_name:_0x2afef4,date:_0x2a5dd4,prod_name:_0x87e8ac,level:_0x401844,isle:_0x46c3e3,pallet:_0x217efd,stock:_0x753a0f,types:_0x1aaf86,adjust_qty:_0x420d91,new_adjust_qty:_0x14f9da,note:_0x214ca5,Room_name:_0x2df551,invoice:_0x17f278,JO_number:_0x336549,expiry_date:_0x214a76}=_0x216a68[_0x19b1f6(0x188)];if(typeof _0x87e8ac==_0x19b1f6(0x1ea))var _0x5a8714=[_0x216a68['body'][_0x19b1f6(0x23c)]],_0x5f0ece=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1dc)]],_0x409a90=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1e4)]],_0x360d2d=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1bb)]],_0x423355=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1e8)]],_0x1aa4ab=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1b3)]],_0x1cbd28=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1f3)]],_0x5e0999=[_0x216a68['body'][_0x19b1f6(0x200)]],_0x16194f=[_0x216a68[_0x19b1f6(0x188)]['prod_code']],_0x122e51=[_0x216a68['body'][_0x19b1f6(0x181)]],_0x23946f=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x227)]],_0xf0c6f7=[_0x216a68['body'][_0x19b1f6(0x1a4)]],_0x5cf873=[_0x216a68[_0x19b1f6(0x188)]['production_date']],_0x2bf814=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x197)]],_0x1608b7=[_0x216a68['body']['Rooms']],_0xd1d5a2=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x208)]],_0x766f08=[_0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x217)]];else var _0x5a8714=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x23c)]],_0x5f0ece=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1dc)]],_0x409a90=[..._0x216a68[_0x19b1f6(0x188)]['stock']],_0x360d2d=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1bb)]],_0x423355=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1e8)]],_0x1aa4ab=[..._0x216a68['body'][_0x19b1f6(0x1b3)]],_0x1cbd28=[..._0x216a68['body'][_0x19b1f6(0x19b)]],_0x5e0999=[..._0x216a68['body'][_0x19b1f6(0x200)]],_0x16194f=[..._0x216a68['body']['prod_code']],_0x122e51=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x181)]],_0x23946f=[..._0x216a68[_0x19b1f6(0x188)]['expiry_date']],_0xf0c6f7=[..._0x216a68['body'][_0x19b1f6(0x1a4)]],_0x5cf873=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1fe)]],_0x2bf814=[..._0x216a68['body'][_0x19b1f6(0x197)]],_0x1608b7=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x1f0)]],_0xd1d5a2=[..._0x216a68['body'][_0x19b1f6(0x208)]],_0x766f08=[..._0x216a68[_0x19b1f6(0x188)][_0x19b1f6(0x217)]];const _0x3567d0=_0x5a8714[_0x19b1f6(0x21a)](_0x4ed07e=>{return _0x4ed07e={'product_name':_0x4ed07e};});_0x5f0ece[_0x19b1f6(0x1b6)]((_0x225aa7,_0x343b77)=>{var _0x300478=_0x19b1f6;_0x1608b7[_0x300478(0x1b6)]((_0x47ad66,_0x4a5df5)=>{var _0x1a347f=_0x300478;if(_0x47ad66==_0x1a347f(0x198)&&_0x343b77==_0x4a5df5){var _0x1b91c4=_0x225aa7[_0x1a347f(0x1c7)](0x3);_0x3567d0[_0x343b77][_0x1a347f(0x1ec)]=_0x225aa7[0x0],_0x3567d0[_0x343b77][_0x1a347f(0x1e6)]=_0x225aa7[0x1],_0x3567d0[_0x343b77][_0x1a347f(0x1dd)]=0x0,_0x3567d0[_0x343b77][_0x1a347f(0x22a)]=0x0,_0x3567d0[_0x343b77][_0x1a347f(0x1a6)]=_0x1a347f(0x23a),_0x3567d0[_0x343b77][_0x1a347f(0x17f)]=_0x1b91c4;}else{if(_0x47ad66==_0x1a347f(0x207)&&_0x343b77==_0x4a5df5){var _0x1b91c4=_0x225aa7[_0x1a347f(0x1c7)](0x3);_0x3567d0[_0x343b77]['storage']=_0x225aa7[0x0],_0x3567d0[_0x343b77]['rack']=_0x225aa7[0x1],_0x3567d0[_0x343b77]['bay']=0x0,_0x3567d0[_0x343b77][_0x1a347f(0x22a)]=0x0,_0x3567d0[_0x343b77][_0x1a347f(0x1a6)]=_0x1a347f(0x23a),_0x3567d0[_0x343b77]['floorlevel']=_0x225aa7[0x5];}else{if(_0x343b77==_0x4a5df5){var _0x69f7ff;if(_0x225aa7[0x4]=='L')_0x69f7ff=_0x1a347f(0x19c);else _0x225aa7[0x4]=='F'&&(_0x69f7ff='Floor');_0x3567d0[_0x343b77][_0x1a347f(0x1ec)]=_0x225aa7[0x0],_0x3567d0[_0x343b77][_0x1a347f(0x1e6)]=_0x225aa7[0x1],_0x3567d0[_0x343b77][_0x1a347f(0x1dd)]=_0x225aa7[0x2],_0x3567d0[_0x343b77][_0x1a347f(0x22a)]=_0x225aa7[0x3],_0x3567d0[_0x343b77][_0x1a347f(0x1a6)]=_0x69f7ff,_0x3567d0[_0x343b77][_0x1a347f(0x17f)]=_0x225aa7[0x5];}}}});}),_0x409a90['forEach']((_0x3e79ff,_0x48c943)=>{var _0x488c9a=_0x19b1f6;_0x3567d0[_0x48c943][_0x488c9a(0x19a)]=_0x3e79ff;}),_0x360d2d[_0x19b1f6(0x1b6)]((_0x56a7d9,_0x69b49d)=>{var _0x24854f=_0x19b1f6;_0x3567d0[_0x69b49d][_0x24854f(0x1bb)]=_0x56a7d9;}),_0x423355[_0x19b1f6(0x1b6)]((_0x3c12ec,_0x301c0a)=>{var _0x3a4902=_0x19b1f6;_0x3567d0[_0x301c0a][_0x3a4902(0x1be)]=_0x3c12ec;}),_0x1aa4ab[_0x19b1f6(0x1b6)]((_0x33c451,_0x26797c)=>{var _0x1fe37c=_0x19b1f6;_0x3567d0[_0x26797c][_0x1fe37c(0x17e)]=_0x33c451;}),_0x1cbd28[_0x19b1f6(0x1b6)]((_0x558a90,_0x106e2f)=>{var _0x4689ea=_0x19b1f6;_0x3567d0[_0x106e2f][_0x4689ea(0x19b)]=_0x558a90;}),_0x5e0999[_0x19b1f6(0x1b6)]((_0x3a4900,_0x2ad82f)=>{var _0x5a799d=_0x19b1f6;_0x3567d0[_0x2ad82f][_0x5a799d(0x184)]=_0x3a4900;}),_0x16194f[_0x19b1f6(0x1b6)]((_0x18e790,_0xe98592)=>{var _0x46b2d6=_0x19b1f6;_0x3567d0[_0xe98592][_0x46b2d6(0x236)]=_0x18e790;}),_0x122e51[_0x19b1f6(0x1b6)]((_0x182555,_0x34a100)=>{var _0x1f1052=_0x19b1f6;_0x3567d0[_0x34a100][_0x1f1052(0x181)]=_0x182555;}),_0x23946f['forEach']((_0x555405,_0x591257)=>{var _0x335446=_0x19b1f6;_0x3567d0[_0x591257][_0x335446(0x227)]=_0x555405;}),_0xf0c6f7[_0x19b1f6(0x1b6)]((_0x295a6f,_0x4b9b43)=>{var _0x305a56=_0x19b1f6;_0x3567d0[_0x4b9b43][_0x305a56(0x1fc)]=_0x295a6f;}),_0x5cf873[_0x19b1f6(0x1b6)]((_0x189e4b,_0x54196a)=>{var _0x377db7=_0x19b1f6;_0x3567d0[_0x54196a][_0x377db7(0x1fe)]=_0x189e4b;}),_0x2bf814['forEach']((_0x29e943,_0x2c20d8)=>{var _0x17f5ae=_0x19b1f6;_0x3567d0[_0x2c20d8][_0x17f5ae(0x197)]=_0x29e943;}),_0x1608b7[_0x19b1f6(0x1b6)]((_0x507c82,_0x5b79d3)=>{_0x3567d0[_0x5b79d3]['room_names']=_0x507c82;}),_0xd1d5a2['forEach']((_0x1e557e,_0x285333)=>{_0x3567d0[_0x285333]['primary_code']=_0x1e557e;}),_0x766f08[_0x19b1f6(0x1b6)]((_0x32294f,_0x5d212e)=>{var _0x3e6411=_0x19b1f6;_0x3567d0[_0x5d212e][_0x3e6411(0x1e0)]=_0x32294f;});const _0x436650=_0x3567d0[_0x19b1f6(0x228)](_0x28c2b7=>_0x28c2b7[_0x19b1f6(0x1be)]!=='0'&&_0x28c2b7[_0x19b1f6(0x1be)]!=='');var _0x42fce6=0x0;_0x436650[_0x19b1f6(0x1b6)](_0x576289=>{var _0x4fcda5=_0x19b1f6;console[_0x4fcda5(0x1cf)]('foreach\x20newproduct',_0x576289),parseInt(_0x576289[_0x4fcda5(0x1be)])<=0x0&&_0x42fce6++;});if(_0x42fce6!=0x0)return _0x216a68[_0x19b1f6(0x1c0)](_0x19b1f6(0x213),'You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200'),_0x371248['redirect']('back');_0x55e5c8['warehouse_name']=_0x2afef4,_0x55e5c8['date']=_0x2a5dd4,_0x55e5c8[_0x19b1f6(0x1ce)]=_0x436650,_0x55e5c8[_0x19b1f6(0x189)]=_0x214ca5,_0x55e5c8[_0x19b1f6(0x1da)]=_0x17f278,_0x55e5c8[_0x19b1f6(0x241)]=_0x19b1f6(0x222);const _0x26b025=await _0x55e5c8[_0x19b1f6(0x23e)]();_0x216a68[_0x19b1f6(0x1c0)](_0x19b1f6(0x180),_0x19b1f6(0x1a3)),_0x371248[_0x19b1f6(0x20e)](_0x19b1f6(0x219));}catch(_0x2a22c5){console[_0x19b1f6(0x1cf)](_0x2a22c5);}}),router[a0_0x490503(0x18b)](a0_0x490503(0x240),async(_0x50d18e,_0x5b1ad5)=>{var _0x28aecd=a0_0x490503;const {primary_code:_0x572141,warehouse_data:_0xafcad0,rooms_data:_0x5febc5,Roomslist:_0x56da1b}=_0x50d18e['body'],_0x13ea4d=_0x56da1b[_0x28aecd(0x1af)](','),_0x4d47cd=[];async function _0x372ec8(_0x223dae){var _0x20bba4=_0x28aecd;const _0x37a43d=await warehouse['aggregate']([{'$match':{'name':_0xafcad0,'room':_0x223dae}},{'$unwind':_0x20bba4(0x215)},{'$match':{'product_details.primary_code':_0x572141}},{'$group':{'_id':_0x20bba4(0x18d),'name':{'$first':_0x20bba4(0x211)},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x20bba4(0x1eb)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x20bba4(0x1b5)},'level':{'$first':'$product_details.bay'},'isle':{'$first':_0x20bba4(0x1d8)},'type':{'$first':_0x20bba4(0x230)},'pallet':{'$first':_0x20bba4(0x1b8)},'unit':{'$first':_0x20bba4(0x1c8)},'secondary_unit':{'$first':_0x20bba4(0x1f1)},'storage':{'$first':_0x20bba4(0x203)},'rack':{'$first':_0x20bba4(0x21b)},'expiry_date':{'$first':_0x20bba4(0x212)},'production_date':{'$first':_0x20bba4(0x1f7)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'batch_code':{'$first':_0x20bba4(0x201)},'product_cat':{'$first':_0x20bba4(0x226)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x20bba4(0x1d9)}}}]),_0x133579=await warehouse['aggregate']([{'$match':{'name':_0xafcad0,'room':_0x223dae}},{'$unwind':_0x20bba4(0x215)},{'$match':{'product_details.secondary_code':_0x572141}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x20bba4(0x211)},'product_stock':{'$first':_0x20bba4(0x1ac)},'primary_code':{'$first':_0x20bba4(0x1eb)},'secondary_code':{'$first':_0x20bba4(0x23b)},'product_code':{'$first':_0x20bba4(0x1b5)},'level':{'$first':_0x20bba4(0x1df)},'isle':{'$first':_0x20bba4(0x1d8)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x20bba4(0x1b8)},'unit':{'$first':_0x20bba4(0x1c8)},'secondary_unit':{'$first':_0x20bba4(0x1f1)},'storage':{'$first':_0x20bba4(0x203)},'rack':{'$first':_0x20bba4(0x21b)},'expiry_date':{'$first':_0x20bba4(0x212)},'production_date':{'$first':'$product_details.production_date'},'maxPerUnit':{'$first':_0x20bba4(0x1de)},'batch_code':{'$first':_0x20bba4(0x201)},'product_cat':{'$first':_0x20bba4(0x226)},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x20bba4(0x1d9)}}}]);if(_0x37a43d[_0x20bba4(0x1d7)]>0x0)_0x4d47cd[_0x20bba4(0x206)](_0x37a43d);else _0x133579[_0x20bba4(0x1d7)]>0x0&&_0x4d47cd[_0x20bba4(0x206)](_0x133579);}const _0x4f06d=_0x13ea4d[_0x28aecd(0x21a)](_0x48f7a1=>_0x372ec8(_0x48f7a1));await Promise[_0x28aecd(0x193)](_0x4f06d),_0x5b1ad5[_0x28aecd(0x183)](_0x4d47cd);}),router[a0_0x490503(0x18b)](a0_0x490503(0x1f8),async(_0xdda231,_0xd54381)=>{var _0x4e51db=a0_0x490503;const {primaryCode:_0x46fa54,secondaryCode:_0x331620,productCode:_0x23e46f,level:_0xf2daa0,isle:_0x5b52cc,pallet:_0x58404c,warehouses:_0x3393dc,room:_0x603dad}=_0xdda231['body'];try{const _0x2960ad=await warehouse[_0x4e51db(0x22b)]([{'$match':{'name':_0x3393dc,'room':_0x603dad}},{'$unwind':_0x4e51db(0x215)},{'$match':{'product_details.level':parseInt(_0xf2daa0),'product_details.isle':_0x5b52cc,'product_details.pallet':parseInt(_0x58404c)}},{'$group':{'_id':_0x4e51db(0x18d),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x4e51db(0x1ac)},'level':{'$first':_0x4e51db(0x21e)},'isle':{'$first':_0x4e51db(0x1b9)},'pallet':{'$first':'$product_details.pallet'},'maxProducts':{'$first':'$product_details.maxProducts'}}}]);_0xd54381['status'](0xc8)[_0x4e51db(0x183)](_0x2960ad);}catch(_0x2cc7d1){_0xd54381[_0x4e51db(0x233)](0x194)[_0x4e51db(0x183)]({'message':_0x2cc7d1[_0x4e51db(0x221)]});}}),module[a0_0x490503(0x20b)]=router;