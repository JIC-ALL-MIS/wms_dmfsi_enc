var a0_0xbbf736=a0_0x3035;(function(_0x173f98,_0x3d7197){var _0x265dc0=a0_0x3035,_0x57c72d=_0x173f98();while(!![]){try{var _0x2713c8=parseInt(_0x265dc0(0x179))/0x1*(parseInt(_0x265dc0(0x16b))/0x2)+parseInt(_0x265dc0(0x15d))/0x3+parseInt(_0x265dc0(0x1b9))/0x4+-parseInt(_0x265dc0(0x128))/0x5*(parseInt(_0x265dc0(0x162))/0x6)+-parseInt(_0x265dc0(0x1c3))/0x7+parseInt(_0x265dc0(0x186))/0x8*(-parseInt(_0x265dc0(0x153))/0x9)+parseInt(_0x265dc0(0x1c1))/0xa*(parseInt(_0x265dc0(0x13d))/0xb);if(_0x2713c8===_0x3d7197)break;else _0x57c72d['push'](_0x57c72d['shift']());}catch(_0x544d50){_0x57c72d['push'](_0x57c72d['shift']());}}}(a0_0x4775,0x46a36));const express=require('express'),app=express(),router=express[a0_0xbbf736(0x1c7)](),auth=require(a0_0xbbf736(0x13b)),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,suppliers_payment,expenses_type,all_expenses,adjustment,supervisor_settings,email_settings}=require('../models/all_models'),users=require(a0_0xbbf736(0x177)),nodemailer=require(a0_0xbbf736(0x17b));function a0_0x4775(){var _0x3a5e33=['<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>','$room','\x20<>\x20','level','<table\x20style=\x22width:\x20100%\x20!important;\x22>','staff','\x20</h2>','$product_details','\x20Order\x20Date\x20:\x20','$product_details.product_name','</div>','Floor','user','room_names','$product_details.bin','new_adjust_qty','save','$product_details.bay','Error\x20Occurs','adjustment\x20data\x20update\x20successfully','isAllowEdit','</td>','French','</head><body>','types','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Room</th>','padStart','$product_details.primary_code','<tbody\x20style=\x22text-align:\x20center;\x22>','<strong>\x20Regards\x20</strong>','rack','English\x20(US)','warehouse','foreach\x20newproduct','push','master','German','Portuguese\x20(BR)','$product_details.batch_code','Hindi','prime1','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Secondary\x20Unit\x20</th>','flash','bay','$product','aggregate','redirect','<thead\x20style=\x22width:\x20100%\x20!important;\x22>','955CmVWmp','<tr>','secondary_code','all','site_title','There\x27s\x20a\x20error\x20in\x20this\x20transaction','maxPerUnit','ADJ-','/adjustment/view','<div\x20style=\x22display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x22>','An\x20error\x20occurred.','storage','$product_details.secondary_code','$product_details.pallet','stock','filter','Arabic\x20(ae)','product_code','$product.product_name','../middleware/auth','product','99pPvhKv','sendMail','email','$product_details.unit','render','secondary_unit','$product_details.product_stock','product_stock','/preview/:id','<h2>\x20','You\x20can\x27t\x20subtract,\x20the\x20current\x20stock\x20is\x200','findOne','Level','RMSEmail','Portuguese','host','$product_details.product_code','createTransport','<!DOCTYPE\x20html>','/view/:id','language','False','9wPhYLo','Spanish','error','type','Adjustment\x20Mail','image','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Code\x20</th>','success','Chinese','New_Qty_Converted','194541BAVYoK','exports','</tr>','post','$product_details._id','13632EUFbXE','maxperunit','Rooms','catch','$product_details.production_date','body','/view/add_adjustment','Return\x20Goods','finalize','553192lRogFa','$product.room_names','prod_code','Enabled','$product_details.maxProducts','$isAllowEdit','/view','status','\x20Order\x20Number\x20:\x20','<hr\x20class=\x22my-3\x22>','$product_details.expiry_date','$product_details.secondary_unit','../public/language/languages.json','find','1xVEIeT','floorlevel','nodemailer','then','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Unit\x20</th>','$product_details.type','prod_cat','bin','English','$product_details.floorlevel','random','get','Shelves','1083224QYftUm','Secondary_units','Primary_Units','errors','floor','findById','$_id','password','message','Receiving\x20Area','/CheckingWarehouse','</body></html>','logo','<img\x20src=\x22cid:logo\x22\x20class=\x22rounded\x22\x20width=\x2266.5px\x22\x20height=\x2266.5px\x22></img>','<div>','prod_name','max_per_unit','New_Qty_Converted_adj','/barcode_scanner','adjust_qty','add_adjustment','$product_details.product_cat','map','batch_code','$name','$warehouse_name','length','<h5\x20style=\x22text-align:\x20left;\x22>','$product_details.maxPerUnit','$product_details.isle','note','/picking_list/PDF_adjustment_rm/','forEach','Return\x20Rooms','warehouse_name','<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Location\x20</th>','params','log','date','invoice','room','Arabic','Enclosed','prod_invoice','</span>','$product_details.rack','second1','product_name','expiry_date','$product_details.storage','minus','711116sgNHOy','unit','$date','Logo.png','back','production_date','role','json','606550SorjZc','</h5>','1444996XQSmap','product_details','$invoice','string','Router','edit_adjustment','slice','Raw\x20Materials'];a0_0x4775=function(){return _0x3a5e33;};return a0_0x4775();}router[a0_0xbbf736(0x184)](a0_0xbbf736(0x171),auth,async(_0x2e070b,_0x478b75)=>{var _0xf23f77=a0_0xbbf736;try{const {username:_0x5d595a,email:_0x5bca88,role:_0x131850}=_0x2e070b[_0xf23f77(0x1d7)],_0x5efafc=_0x2e070b[_0xf23f77(0x1d7)],_0x31e572=await profile['findOne']({'email':_0x5efafc['email']}),_0x4e5a64=await master_shop[_0xf23f77(0x178)]();console['log'](_0xf23f77(0x11b),_0x4e5a64);let _0x4ce30c;if(_0x5efafc[_0xf23f77(0x1bf)]==_0xf23f77(0x1d0)){const _0x1c18eb=await staff[_0xf23f77(0x148)]({'email':_0x5efafc[_0xf23f77(0x13f)]});_0x4ce30c=await warehouse[_0xf23f77(0x178)]({'status':_0xf23f77(0x16e),'name':_0x1c18eb[_0xf23f77(0x1eb)]});}else _0x4ce30c=await warehouse[_0xf23f77(0x178)]({'status':_0xf23f77(0x16e)});const _0x4b8410=await product[_0xf23f77(0x178)]();let _0x3f9a27;if(_0x5efafc[_0xf23f77(0x1bf)]==_0xf23f77(0x1d0)){const _0x470bfe=await staff[_0xf23f77(0x148)]({'email':_0x5efafc[_0xf23f77(0x13f)]});_0x3f9a27=await adjustment[_0xf23f77(0x178)]({'warehouse_name':_0x470bfe['warehouse']});}else _0x3f9a27=await adjustment[_0xf23f77(0x125)]([{'$unwind':_0xf23f77(0x124)},{'$group':{'_id':_0xf23f77(0x18c),'invoice':{'$first':_0xf23f77(0x1c5)},'date':{'$first':_0xf23f77(0x1bb)},'warehouse_name':{'$first':_0xf23f77(0x19f)},'room':{'$addToSet':_0xf23f77(0x16c)},'finalize':{'$first':'$finalize'},'isAllowEdit':{'$first':_0xf23f77(0x170)}}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'finalize':0x1,'isAllowEdit':0x1}}]);if(_0x4e5a64[0x0]['language']=='English\x20(US)'){var _0x16a969=users[_0xf23f77(0x181)];console[_0xf23f77(0x1ab)](_0x16a969);}else{if(_0x4e5a64[0x0][_0xf23f77(0x151)]=='Hindi')var _0x16a969=users[_0xf23f77(0x11f)];else{if(_0x4e5a64[0x0][_0xf23f77(0x151)]=='German')var _0x16a969=users[_0xf23f77(0x11c)];else{if(_0x4e5a64[0x0][_0xf23f77(0x151)]==_0xf23f77(0x154))var _0x16a969=users[_0xf23f77(0x154)];else{if(_0x4e5a64[0x0]['language']==_0xf23f77(0x1e1))var _0x16a969=users[_0xf23f77(0x1e1)];else{if(_0x4e5a64[0x0]['language']==_0xf23f77(0x11d))var _0x16a969=users['Portuguese'];else{if(_0x4e5a64[0x0]['language']==_0xf23f77(0x15b))var _0x16a969=users[_0xf23f77(0x15b)];else{if(_0x4e5a64[0x0][_0xf23f77(0x151)]==_0xf23f77(0x138))var _0x16a969=users[_0xf23f77(0x1af)];}}}}}}}_0x478b75['render']('adjustment',{'success':_0x2e070b[_0xf23f77(0x122)]('success'),'errors':_0x2e070b[_0xf23f77(0x122)]('errors'),'role':_0x5efafc,'profile':_0x31e572,'warehouse':_0x4ce30c,'product':_0x4b8410,'adjustment':_0x3f9a27,'master_shop':_0x4e5a64,'language':_0x16a969});}catch(_0x2321ac){console[_0xf23f77(0x1ab)](_0x2321ac);}});function a0_0x3035(_0x159e5a,_0x53058a){var _0x47757d=a0_0x4775();return a0_0x3035=function(_0x30358e,_0x54af51){_0x30358e=_0x30358e-0x11b;var _0x673f62=_0x47757d[_0x30358e];return _0x673f62;},a0_0x3035(_0x159e5a,_0x53058a);}async function getRandom8DigitNumber(){var _0x34c48f=a0_0xbbf736;const _0x148101=0x989680,_0x104b12=0x5f5e0ff,_0x428b1f=Math[_0x34c48f(0x18a)](Math[_0x34c48f(0x183)]()*(_0x104b12-_0x148101+0x1))+_0x148101;var _0x3e9ffc;const _0x27e02e=await adjustment[_0x34c48f(0x148)]({'invoice':_0x34c48f(0x12f)+_0x428b1f});return _0x27e02e&&_0x27e02e[_0x34c48f(0x1a0)]>0x0?_0x3e9ffc=_0x34c48f(0x12f)+_0x428b1f:_0x3e9ffc=_0x34c48f(0x12f)+_0x428b1f,_0x3e9ffc;}router[a0_0xbbf736(0x184)](a0_0xbbf736(0x168),auth,async(_0x3cf1bf,_0x333ed2)=>{var _0x1383ff=a0_0xbbf736;try{const {username:_0x25b083,email:_0x39d2f6,role:_0x4156e8}=_0x3cf1bf[_0x1383ff(0x1d7)],_0x12fbb4=_0x3cf1bf[_0x1383ff(0x1d7)],_0x5b70ef=await profile[_0x1383ff(0x148)]({'email':_0x12fbb4[_0x1383ff(0x13f)]}),_0x1ccc9e=await master_shop['find']();let _0xfb53e8;if(_0x12fbb4[_0x1383ff(0x1bf)]==_0x1383ff(0x1d0)){const _0xb36aa1=await staff[_0x1383ff(0x148)]({'email':_0x12fbb4[_0x1383ff(0x13f)]});_0xfb53e8=await warehouse['aggregate']([{'$match':{'status':_0x1383ff(0x16e),'name':_0xb36aa1[_0x1383ff(0x1eb)],'warehouse_category':_0x1383ff(0x1ca),'name':{'$ne':_0x1383ff(0x169)}}},{'$group':{'_id':_0x1383ff(0x19e),'name':{'$first':_0x1383ff(0x19e)}}}]);}else _0xfb53e8=await warehouse[_0x1383ff(0x125)]([{'$match':{'status':'Enabled','warehouse_category':_0x1383ff(0x1ca),'name':{'$ne':_0x1383ff(0x169)}}},{'$group':{'_id':'$name','name':{'$first':_0x1383ff(0x19e)}}}]);const _0x35d31a=await product['find']({}),_0x205528=await adjustment[_0x1383ff(0x178)]({}),_0x39767f=_0x205528[_0x1383ff(0x1a0)]+0x1,_0x8ff069=_0x1383ff(0x12f)+_0x39767f['toString']()[_0x1383ff(0x1e5)](0x5,'0');var _0x3c93cf=['Ambient',_0x1383ff(0x1b0),_0x1383ff(0x1a7)];if(_0x1ccc9e[0x0][_0x1383ff(0x151)]=='English\x20(US)')var _0x33d339=users[_0x1383ff(0x181)];else{if(_0x1ccc9e[0x0][_0x1383ff(0x151)]==_0x1383ff(0x11f))var _0x33d339=users[_0x1383ff(0x11f)];else{if(_0x1ccc9e[0x0][_0x1383ff(0x151)]==_0x1383ff(0x11c))var _0x33d339=users[_0x1383ff(0x11c)];else{if(_0x1ccc9e[0x0][_0x1383ff(0x151)]=='Spanish')var _0x33d339=users[_0x1383ff(0x154)];else{if(_0x1ccc9e[0x0][_0x1383ff(0x151)]=='French')var _0x33d339=users[_0x1383ff(0x1e1)];else{if(_0x1ccc9e[0x0][_0x1383ff(0x151)]=='Portuguese\x20(BR)')var _0x33d339=users[_0x1383ff(0x14b)];else{if(_0x1ccc9e[0x0][_0x1383ff(0x151)]==_0x1383ff(0x15b))var _0x33d339=users[_0x1383ff(0x15b)];else{if(_0x1ccc9e[0x0]['language']=='Arabic\x20(ae)')var _0x33d339=users['Arabic'];}}}}}}}const _0x1cb8f4=getRandom8DigitNumber();_0x1cb8f4['then'](_0x1a7f60=>{var _0x558bbe=_0x1383ff;_0x333ed2['render'](_0x558bbe(0x19a),{'success':_0x3cf1bf[_0x558bbe(0x122)]('success'),'errors':_0x3cf1bf[_0x558bbe(0x122)](_0x558bbe(0x189)),'role':_0x12fbb4,'profile':_0x5b70ef,'warehouse':_0xfb53e8,'product':_0x35d31a,'master_shop':_0x1ccc9e,'language':_0x33d339,'rooms_data':_0x3c93cf,'invoice_no':_0x1a7f60});})['catch'](_0x29ccaf=>{var _0x4ba122=_0x1383ff;_0x3cf1bf[_0x4ba122(0x122)]('errors',_0x4ba122(0x12d)),_0x333ed2[_0x4ba122(0x126)](_0x4ba122(0x130));});}catch(_0x4380e1){console[_0x1383ff(0x1ab)](_0x4380e1);}}),router['post']('/view/add_adjustment',auth,async(_0x26dfe2,_0x160a7e)=>{var _0xce2e76=a0_0xbbf736;try{const {warehouse_name:_0x25aa51,date:_0x569348,prod_name:_0x39f994,level:_0x61dd59,isle:_0x83cecf,pallet:_0x27f60b,stock:_0x526321,types:_0x571553,adjust_qty:_0x29462f,new_adjust_qty:_0x2ee39c,note:_0x3226da,Room_name:_0x4393d3,invoice:_0x4f71a1,JO_number:_0x580f4a,expiry_date:_0x5968d5}=_0x26dfe2[_0xce2e76(0x167)];if(typeof _0x39f994==_0xce2e76(0x1c6))var _0x58df4d=[_0x26dfe2['body'][_0xce2e76(0x195)]],_0x144bfc=[_0x26dfe2[_0xce2e76(0x167)]['level']],_0x4701b5=[_0x26dfe2['body']['stock']],_0x259a5c=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x1e3)]],_0x3be875=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x197)]],_0x44b46a=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x15c)]],_0x11b339=[_0x26dfe2[_0xce2e76(0x167)]['Primary_Units']],_0x5aee9c=[_0x26dfe2['body'][_0xce2e76(0x187)]],_0x21ccfc=[_0x26dfe2['body'][_0xce2e76(0x16d)]],_0x825fed=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x19d)]],_0x2acb4b=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x1b6)]],_0x3add37=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x196)]],_0x363a71=[_0x26dfe2[_0xce2e76(0x167)]['production_date']],_0x3582de=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x17f)]],_0xd93f7f=[_0x26dfe2['body'][_0xce2e76(0x164)]],_0x5da6c6=[_0x26dfe2[_0xce2e76(0x167)]['prime1']],_0x1a8c33=[_0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x1b4)]],_0x28124e=[_0x26dfe2['body'][_0xce2e76(0x1b1)]];else var _0x58df4d=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x195)]],_0x144bfc=[..._0x26dfe2['body'][_0xce2e76(0x1ce)]],_0x4701b5=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x136)]],_0x259a5c=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x1e3)]],_0x3be875=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x197)]],_0x44b46a=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x15c)]],_0x11b339=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x1ba)]],_0x5aee9c=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x187)]],_0x21ccfc=[..._0x26dfe2[_0xce2e76(0x167)]['prod_code']],_0x825fed=[..._0x26dfe2['body'][_0xce2e76(0x19d)]],_0x2acb4b=[..._0x26dfe2['body'][_0xce2e76(0x1b6)]],_0x3add37=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x196)]],_0x363a71=[..._0x26dfe2['body'][_0xce2e76(0x1be)]],_0x3582de=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x17f)]],_0xd93f7f=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x164)]],_0x5da6c6=[..._0x26dfe2[_0xce2e76(0x167)]['prime1']],_0x1a8c33=[..._0x26dfe2[_0xce2e76(0x167)][_0xce2e76(0x1b4)]],_0x28124e=[..._0x26dfe2[_0xce2e76(0x167)]['prod_invoice']];const _0x301fa4=_0x58df4d[_0xce2e76(0x19c)](_0x3f5f01=>{return _0x3f5f01={'product_name':_0x3f5f01};});_0x144bfc[_0xce2e76(0x1a6)]((_0x3a4503,_0x56df29)=>{_0xd93f7f['forEach']((_0x5a53c8,_0x152ddf)=>{var _0x2a2cd8=a0_0x3035;if(_0x5a53c8=='Receiving\x20Area'&&_0x56df29==_0x152ddf){var _0x5f0ae9=_0x3a4503['slice'](0x3);_0x301fa4[_0x56df29][_0x2a2cd8(0x133)]=_0x3a4503[0x0],_0x301fa4[_0x56df29][_0x2a2cd8(0x1e9)]=_0x3a4503[0x1],_0x301fa4[_0x56df29][_0x2a2cd8(0x123)]=0x0,_0x301fa4[_0x56df29][_0x2a2cd8(0x180)]=0x0,_0x301fa4[_0x56df29][_0x2a2cd8(0x156)]=_0x2a2cd8(0x1d6),_0x301fa4[_0x56df29]['floorlevel']=_0x5f0ae9;}else{if(_0x5a53c8==_0x2a2cd8(0x185)&&_0x56df29==_0x152ddf){var _0x5f0ae9=_0x3a4503[_0x2a2cd8(0x1c9)](0x3);_0x301fa4[_0x56df29][_0x2a2cd8(0x133)]=_0x3a4503[0x0],_0x301fa4[_0x56df29][_0x2a2cd8(0x1e9)]=_0x3a4503[0x1],_0x301fa4[_0x56df29][_0x2a2cd8(0x123)]=0x0,_0x301fa4[_0x56df29][_0x2a2cd8(0x180)]=0x0,_0x301fa4[_0x56df29]['type']=_0x2a2cd8(0x1d6),_0x301fa4[_0x56df29][_0x2a2cd8(0x17a)]=_0x3a4503[0x5];}else{if(_0x56df29==_0x152ddf){var _0x3c1fe1;if(_0x3a4503[0x4]=='L')_0x3c1fe1=_0x2a2cd8(0x149);else _0x3a4503[0x4]=='F'&&(_0x3c1fe1='Floor');_0x301fa4[_0x56df29]['storage']=_0x3a4503[0x0],_0x301fa4[_0x56df29][_0x2a2cd8(0x1e9)]=_0x3a4503[0x1],_0x301fa4[_0x56df29]['bay']=_0x3a4503[0x2],_0x301fa4[_0x56df29][_0x2a2cd8(0x180)]=_0x3a4503[0x3],_0x301fa4[_0x56df29][_0x2a2cd8(0x156)]=_0x3c1fe1,_0x301fa4[_0x56df29][_0x2a2cd8(0x17a)]=_0x3a4503[0x5];}}}});}),_0x4701b5['forEach']((_0x13c320,_0x31a057)=>{_0x301fa4[_0x31a057]['stockBefore']=_0x13c320;}),_0x259a5c[_0xce2e76(0x1a6)]((_0x1d2b0d,_0xb7a3a5)=>{var _0x50dc7c=_0xce2e76;_0x301fa4[_0xb7a3a5][_0x50dc7c(0x1e3)]=_0x1d2b0d;}),_0x3be875['forEach']((_0x4e4463,_0x2eb633)=>{var _0x21adc=_0xce2e76;_0x301fa4[_0x2eb633][_0x21adc(0x199)]=_0x4e4463;}),_0x44b46a[_0xce2e76(0x1a6)]((_0x17e297,_0x1891d5)=>{var _0x2f2599=_0xce2e76;_0x301fa4[_0x1891d5][_0x2f2599(0x1da)]=_0x17e297;}),_0x11b339[_0xce2e76(0x1a6)]((_0x2b48a9,_0x22cc54)=>{_0x301fa4[_0x22cc54]['unit']=_0x2b48a9;}),_0x5aee9c[_0xce2e76(0x1a6)]((_0x2502c9,_0x27be50)=>{var _0x24766c=_0xce2e76;_0x301fa4[_0x27be50][_0x24766c(0x142)]=_0x2502c9;}),_0x21ccfc[_0xce2e76(0x1a6)]((_0xeecf5f,_0x272e67)=>{var _0xb385cc=_0xce2e76;_0x301fa4[_0x272e67][_0xb385cc(0x139)]=_0xeecf5f;}),_0x825fed[_0xce2e76(0x1a6)]((_0x38b147,_0x521529)=>{var _0xda6549=_0xce2e76;_0x301fa4[_0x521529][_0xda6549(0x19d)]=_0x38b147;}),_0x2acb4b[_0xce2e76(0x1a6)]((_0x20e212,_0x5d8ae1)=>{_0x301fa4[_0x5d8ae1]['expiry_date']=_0x20e212;}),_0x3add37[_0xce2e76(0x1a6)]((_0x5aafc7,_0x5235e0)=>{_0x301fa4[_0x5235e0]['maxperunit']=_0x5aafc7;}),_0x363a71[_0xce2e76(0x1a6)]((_0x491f10,_0x11d783)=>{_0x301fa4[_0x11d783]['production_date']=_0x491f10;}),_0x3582de[_0xce2e76(0x1a6)]((_0x28388b,_0x513ddd)=>{_0x301fa4[_0x513ddd]['prod_cat']=_0x28388b;}),_0xd93f7f['forEach']((_0x3404cf,_0x5a1379)=>{var _0x3fa85b=_0xce2e76;_0x301fa4[_0x5a1379][_0x3fa85b(0x1d8)]=_0x3404cf;}),_0x5da6c6[_0xce2e76(0x1a6)]((_0xcaeb4b,_0x3dca9c)=>{_0x301fa4[_0x3dca9c]['primary_code']=_0xcaeb4b;}),_0x1a8c33[_0xce2e76(0x1a6)]((_0x11fca0,_0x187297)=>{var _0x3da9e0=_0xce2e76;_0x301fa4[_0x187297][_0x3da9e0(0x12a)]=_0x11fca0;}),_0x28124e[_0xce2e76(0x1a6)]((_0x2c80de,_0x346ffb)=>{var _0x4c9ce4=_0xce2e76;_0x301fa4[_0x346ffb][_0x4c9ce4(0x1ad)]=_0x2c80de;});const _0x399887=_0x301fa4[_0xce2e76(0x137)](_0x245f0f=>_0x245f0f[_0xce2e76(0x199)]!=='0'&&_0x245f0f[_0xce2e76(0x199)]!=='');var _0x244123=0x0;_0x399887['forEach'](_0x190567=>{var _0x13db65=_0xce2e76;console[_0x13db65(0x1ab)](_0x13db65(0x1ec),_0x190567),parseInt(_0x190567[_0x13db65(0x199)])<=0x0&&_0x244123++;});if(_0x244123!=0x0)return _0x26dfe2[_0xce2e76(0x122)](_0xce2e76(0x189),_0xce2e76(0x147)),_0x160a7e[_0xce2e76(0x126)]('back');const _0xa113fb=new adjustment({'warehouse_name':_0x25aa51,'date':_0x569348,'product':_0x399887,'note':_0x3226da,'room':_0x4393d3,'invoice':_0x4f71a1,'JO_number':_0x580f4a,'expiry_date':_0x5968d5}),_0x414f1b=await _0xa113fb['save']();_0x26dfe2[_0xce2e76(0x122)](_0xce2e76(0x15a),'adjustment\x20add\x20successfull'),_0x160a7e[_0xce2e76(0x126)]('/adjustment/preview/'+_0x414f1b['_id']);}catch(_0x4a6cf3){console['log'](_0x4a6cf3),_0x160a7e['status'](0xc8)['json']({'message':_0x4a6cf3[_0xce2e76(0x18e)]});}}),router[a0_0xbbf736(0x184)](a0_0xbbf736(0x145),auth,async(_0x19bec9,_0xb6a8db)=>{var _0x285ff3=a0_0xbbf736;try{const {username:_0x13a68e,email:_0x5380ea,role:_0x351a41}=_0x19bec9['user'],_0x1a6797=_0x19bec9[_0x285ff3(0x1d7)],_0x4050e9=await profile[_0x285ff3(0x148)]({'email':_0x1a6797[_0x285ff3(0x13f)]}),_0x46df72=await master_shop[_0x285ff3(0x178)](),_0x1d0a5e=_0x19bec9[_0x285ff3(0x1aa)]['id'],_0x57456c=await adjustment[_0x285ff3(0x18b)]({'_id':_0x1d0a5e}),_0x1f636f=await purchases['aggregate']([{'$match':{'warehouse_name':_0x57456c['warehouse_name']}},{'$unwind':_0x285ff3(0x124)},{'$group':{'_id':_0x285ff3(0x13a)}}]),_0x52c75c=await product[_0x285ff3(0x178)]({}),_0x1f5180=await warehouse[_0x285ff3(0x125)]([{'$match':{'name':_0x57456c[_0x285ff3(0x1a8)]}},{'$unwind':_0x285ff3(0x1d2)},{'$group':{'_id':_0x285ff3(0x161),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':_0x285ff3(0x143)},'bay':{'$first':_0x285ff3(0x1dc)},'bin':{'$first':'$product_details.bin'},'type':{'$first':_0x285ff3(0x17e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x285ff3(0x1e6)},'secondary_code':{'$first':_0x285ff3(0x134)},'product_code':{'$first':'$product_details.product_code'},'storage':{'$first':_0x285ff3(0x1b7)},'rack':{'$first':_0x285ff3(0x1b3)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x285ff3(0x166)},'batch_code':{'$first':_0x285ff3(0x11e)},'room':{'$first':_0x285ff3(0x1cc)}}}]);if(_0x46df72[0x0][_0x285ff3(0x151)]==_0x285ff3(0x1ea)){var _0x2dc3d2=users[_0x285ff3(0x181)];console[_0x285ff3(0x1ab)](_0x2dc3d2);}else{if(_0x46df72[0x0]['language']==_0x285ff3(0x11f))var _0x2dc3d2=users[_0x285ff3(0x11f)];else{if(_0x46df72[0x0][_0x285ff3(0x151)]==_0x285ff3(0x11c))var _0x2dc3d2=users['German'];else{if(_0x46df72[0x0][_0x285ff3(0x151)]==_0x285ff3(0x154))var _0x2dc3d2=users[_0x285ff3(0x154)];else{if(_0x46df72[0x0][_0x285ff3(0x151)]=='French')var _0x2dc3d2=users[_0x285ff3(0x1e1)];else{if(_0x46df72[0x0][_0x285ff3(0x151)]==_0x285ff3(0x11d))var _0x2dc3d2=users[_0x285ff3(0x14b)];else{if(_0x46df72[0x0][_0x285ff3(0x151)]==_0x285ff3(0x15b))var _0x2dc3d2=users[_0x285ff3(0x15b)];else{if(_0x46df72[0x0][_0x285ff3(0x151)]=='Arabic\x20(ae)')var _0x2dc3d2=users[_0x285ff3(0x1af)];}}}}}}}_0xb6a8db['render']('edit_adjustment_view',{'success':_0x19bec9[_0x285ff3(0x122)]('success'),'errors':_0x19bec9[_0x285ff3(0x122)](_0x285ff3(0x189)),'role':_0x1a6797,'profile':_0x4050e9,'adjustment':_0x57456c,'stock':_0x1f5180,'master_shop':_0x46df72,'warehouse_name':_0x1f636f,'unit':_0x52c75c,'language':_0x2dc3d2});}catch(_0x45e7fd){console['log'](_0x45e7fd),_0xb6a8db[_0x285ff3(0x172)](0xc8)[_0x285ff3(0x1c0)]({'message':_0x45e7fd[_0x285ff3(0x18e)]});}}),router[a0_0xbbf736(0x160)](a0_0xbbf736(0x145),auth,async(_0x487a1b,_0x374947)=>{var _0x570c94=a0_0xbbf736;try{const _0x4cee4d=_0x487a1b[_0x570c94(0x1aa)]['id'],{warehouse_name:_0x407096,Room_name:_0x53857a}=_0x487a1b['body'],_0x1fe3d7=await adjustment['findById']({'_id':_0x4cee4d}),_0x270d45=_0x1fe3d7[_0x570c94(0x13c)]['map'](async _0x5153a4=>{var _0xa7c1d0=_0x570c94;if(_0x5153a4[_0xa7c1d0(0x199)]>0x0){var _0x2083c6=await warehouse[_0xa7c1d0(0x148)]({'name':_0x407096,'room':_0x5153a4[_0xa7c1d0(0x1d8)],'warehouse_category':_0xa7c1d0(0x1ca)});const _0x175c3d=_0x2083c6[_0xa7c1d0(0x1c4)][_0xa7c1d0(0x19c)](_0x24555e=>{var _0x1bf708=_0xa7c1d0;if(_0x5153a4[_0x1bf708(0x156)]==_0x1bf708(0x1b8)){if(_0x24555e[_0x1bf708(0x1b5)]==_0x5153a4['product_name']&&_0x24555e[_0x1bf708(0x17a)]==_0x5153a4[_0x1bf708(0x17a)]&&_0x24555e[_0x1bf708(0x156)]==_0x5153a4['type']&&_0x24555e[_0x1bf708(0x180)]==_0x5153a4['bin']&&_0x24555e[_0x1bf708(0x123)]==_0x5153a4[_0x1bf708(0x123)]&&_0x24555e['rack']==_0x5153a4[_0x1bf708(0x1e9)]&&_0x24555e[_0x1bf708(0x133)]==_0x5153a4[_0x1bf708(0x133)]&&_0x24555e['expiry_date']==_0x5153a4['expiry_date']&&_0x24555e['batch_code']==_0x5153a4[_0x1bf708(0x19d)]&&_0x24555e[_0x1bf708(0x1be)]==_0x5153a4[_0x1bf708(0x1be)]&&_0x24555e[_0x1bf708(0x1ad)]==_0x5153a4['invoice']){var _0x2f5ade;_0x2f5ade=_0x5153a4[_0x1bf708(0x199)],_0x5153a4['prod_cat']=='S'&&(_0x2f5ade=_0x5153a4[_0x1bf708(0x199)]),_0x24555e[_0x1bf708(0x144)]=_0x24555e[_0x1bf708(0x144)]-_0x2f5ade;}}else{if(_0x24555e[_0x1bf708(0x1b5)]==_0x5153a4['product_name']&&_0x24555e['floorlevel']==_0x5153a4[_0x1bf708(0x17a)]&&_0x24555e[_0x1bf708(0x156)]==_0x5153a4[_0x1bf708(0x156)]&&_0x24555e[_0x1bf708(0x180)]==_0x5153a4['bin']&&_0x24555e['bay']==_0x5153a4[_0x1bf708(0x123)]&&_0x24555e[_0x1bf708(0x1e9)]==_0x5153a4[_0x1bf708(0x1e9)]&&_0x24555e[_0x1bf708(0x133)]==_0x5153a4[_0x1bf708(0x133)]&&_0x24555e[_0x1bf708(0x1b6)]==_0x5153a4[_0x1bf708(0x1b6)]&&_0x24555e[_0x1bf708(0x19d)]==_0x5153a4[_0x1bf708(0x19d)]&&_0x24555e[_0x1bf708(0x1be)]==_0x5153a4['production_date']&&_0x24555e['invoice']==_0x5153a4[_0x1bf708(0x1ad)]){console[_0x1bf708(0x1ab)](_0x5153a4);var _0x2f5ade;_0x2f5ade=_0x5153a4[_0x1bf708(0x199)],_0x5153a4[_0x1bf708(0x17f)]=='S'&&(_0x2f5ade=_0x5153a4['adjust_qty']),console[_0x1bf708(0x1ab)](_0x2f5ade+_0x1bf708(0x1cd)+_0x5153a4[_0x1bf708(0x199)]+'\x20<>\x20'+_0x24555e[_0x1bf708(0x12e)]+_0x1bf708(0x1cd)+_0x5153a4[_0x1bf708(0x17f)]),_0x24555e[_0x1bf708(0x144)]=_0x24555e['product_stock']+_0x2f5ade;}}});}return _0x2083c6;});Promise[_0x570c94(0x12b)](_0x270d45)[_0x570c94(0x17c)](async _0x56a098=>{var _0x205659=_0x570c94;try{for(const _0x53ffe8 of _0x56a098){await _0x53ffe8[_0x205659(0x1db)]();}_0x1fe3d7[_0x205659(0x16a)]='True';const _0x412bf3=await _0x1fe3d7[_0x205659(0x1db)](),_0x4200b4=await master_shop[_0x205659(0x178)](),_0x273bb7=await email_settings['findOne'](),_0x365332=await supervisor_settings[_0x205659(0x178)]();var _0x2704cf=_0x1fe3d7[_0x205659(0x13c)],_0x562fad='',_0x257694;for(_0x257694 in _0x2704cf){_0x562fad+=_0x205659(0x129)+_0x205659(0x1cb)+_0x2704cf[_0x257694][_0x205659(0x1b5)]+_0x205659(0x1e0)+_0x205659(0x1cb)+_0x2704cf[_0x257694][_0x205659(0x139)]+_0x205659(0x1e0)+'<td\x20style=\x22border:\x201px\x20solid\x20black;\x22>'+_0x2704cf[_0x257694][_0x205659(0x199)]+_0x205659(0x1e0)+_0x205659(0x1cb)+_0x2704cf[_0x257694][_0x205659(0x1ba)]+_0x205659(0x1e0)+_0x205659(0x1cb)+_0x2704cf[_0x257694][_0x205659(0x142)]+_0x205659(0x1e0)+_0x205659(0x1cb)+_0x1fe3d7[_0x205659(0x1a8)]+'</td>'+_0x205659(0x1cb)+_0x2704cf[_0x257694][_0x205659(0x1d8)]+_0x205659(0x1e0)+_0x205659(0x1cb)+_0x2704cf[_0x257694][_0x205659(0x133)]+_0x2704cf[_0x257694][_0x205659(0x1e9)]+_0x2704cf[_0x257694][_0x205659(0x123)]+_0x2704cf[_0x257694][_0x205659(0x180)]+_0x2704cf[_0x257694][_0x205659(0x156)][0x0]+_0x2704cf[_0x257694][_0x205659(0x17a)]+_0x205659(0x1e0),'</tr>';}let _0x2d9207=nodemailer[_0x205659(0x14e)]({'host':_0x273bb7[_0x205659(0x14c)],'port':Number(_0x273bb7['port']),'secure':![],'auth':{'user':_0x273bb7[_0x205659(0x13f)],'pass':_0x273bb7[_0x205659(0x18d)]}}),_0x1fa859={'from':_0x273bb7[_0x205659(0x13f)],'to':_0x365332[0x0][_0x205659(0x14a)],'subject':_0x205659(0x157),'attachments':[{'filename':_0x205659(0x1bc),'path':__dirname+'/../public'+'/upload/'+_0x4200b4[0x0][_0x205659(0x158)],'cid':_0x205659(0x192)}],'html':_0x205659(0x14f)+'<html><head><title></title>'+_0x205659(0x1e2)+_0x205659(0x194)+_0x205659(0x131)+'<div>'+_0x205659(0x193)+_0x205659(0x1d5)+_0x205659(0x194)+_0x205659(0x146)+_0x4200b4[0x0][_0x205659(0x12c)]+_0x205659(0x1d1)+_0x205659(0x1d5)+'</div>'+_0x205659(0x174)+_0x205659(0x194)+_0x205659(0x1a1)+_0x205659(0x173)+_0x1fe3d7[_0x205659(0x1ad)]+'\x20'+'<span\x20style=\x22float:\x20right;\x22>'+_0x205659(0x1d3)+_0x1fe3d7[_0x205659(0x1ac)]+'\x20'+_0x205659(0x1b2)+_0x205659(0x1c2)+_0x205659(0x1d5)+_0x205659(0x1cf)+_0x205659(0x127)+_0x205659(0x129)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Name\x20</th>'+_0x205659(0x159)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Product\x20Quantity\x20</th>'+_0x205659(0x17d)+_0x205659(0x121)+'<th\x20style=\x22border:\x201px\x20solid\x20black;\x22>\x20Warehouse</th>'+_0x205659(0x1e4)+_0x205659(0x1a9)+_0x205659(0x15f)+'</thead>'+_0x205659(0x1e7)+'\x20'+_0x562fad+'\x20'+'</tbody>'+'</table>'+_0x205659(0x194)+_0x205659(0x1e8)+'<h5>'+_0x4200b4[0x0][_0x205659(0x12c)]+_0x205659(0x1c2)+'</div>'+_0x205659(0x1d5)+_0x205659(0x191)};_0x2d9207[_0x205659(0x13e)](_0x1fa859,function(_0x32ab93,_0x5e20c5){var _0x3ae803=_0x205659;_0x32ab93?(console['log'](_0x32ab93),console[_0x3ae803(0x1ab)](_0x3ae803(0x1dd))):console[_0x3ae803(0x1ab)]('Email\x20sent\x20successfully');}),_0x487a1b[_0x205659(0x122)]('success','adjustment\x20Finalized\x20successfully'),_0x374947['redirect'](_0x205659(0x1a5)+_0x412bf3['_id']);}catch(_0x13d04b){console['error'](_0x13d04b),_0x374947[_0x205659(0x172)](0x1f4)[_0x205659(0x1c0)]({'error':'An\x20error\x20occurred\x20while\x20saving\x20data.'});}})[_0x570c94(0x165)](_0x5ef1d8=>{var _0x20fee8=_0x570c94;console[_0x20fee8(0x155)](_0x5ef1d8),_0x374947[_0x20fee8(0x172)](0x1f4)[_0x20fee8(0x1c0)]({'error':_0x20fee8(0x132)});});}catch(_0x1c7487){console['log'](_0x1c7487),_0x374947[_0x570c94(0x172)](0xc8)['json']({'message':_0x1c7487['message']});}}),router[a0_0xbbf736(0x184)]('/view/:id',auth,async(_0x17aacd,_0x148d04)=>{var _0x2c48b7=a0_0xbbf736;try{const {username:_0x217f95,email:_0x127bb5,role:_0x1d223d}=_0x17aacd[_0x2c48b7(0x1d7)],_0x186387=_0x17aacd[_0x2c48b7(0x1d7)],_0x2c1153=await profile[_0x2c48b7(0x148)]({'email':_0x186387[_0x2c48b7(0x13f)]}),_0x389f21=await master_shop[_0x2c48b7(0x178)](),_0x513815=_0x17aacd[_0x2c48b7(0x1aa)]['id'],_0x419e50=await adjustment[_0x2c48b7(0x18b)]({'_id':_0x513815}),_0x23d57e=await purchases['aggregate']([{'$match':{'warehouse_name':_0x419e50[_0x2c48b7(0x1a8)]}},{'$unwind':_0x2c48b7(0x124)},{'$group':{'_id':_0x2c48b7(0x13a)}}]),_0x30c93f=await product[_0x2c48b7(0x178)]({}),_0x569164=await warehouse[_0x2c48b7(0x125)]([{'$match':{'name':_0x419e50[_0x2c48b7(0x1a8)]}},{'$unwind':'$product_details'},{'$group':{'_id':'$product_details._id','name':{'$first':_0x2c48b7(0x1d4)},'product_stock':{'$first':_0x2c48b7(0x143)},'bay':{'$first':'$product_details.bay'},'bin':{'$first':_0x2c48b7(0x1d9)},'type':{'$first':_0x2c48b7(0x17e)},'floorlevel':{'$first':'$product_details.floorlevel'},'primary_code':{'$first':_0x2c48b7(0x1e6)},'secondary_code':{'$first':_0x2c48b7(0x134)},'product_code':{'$first':_0x2c48b7(0x14d)},'storage':{'$first':_0x2c48b7(0x1b7)},'rack':{'$first':_0x2c48b7(0x1b3)},'maxPerUnit':{'$first':'$product_details.maxPerUnit'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x2c48b7(0x166)},'batch_code':{'$first':_0x2c48b7(0x11e)},'room':{'$first':_0x2c48b7(0x1cc)}}}]);let _0x268532;if(_0x186387[_0x2c48b7(0x1bf)]==_0x2c48b7(0x1d0)){const _0x3ede3d=await staff['findOne']({'email':_0x186387[_0x2c48b7(0x13f)]});_0x268532=await warehouse[_0x2c48b7(0x125)]([{'$match':{'status':_0x2c48b7(0x16e),'name':_0x3ede3d[_0x2c48b7(0x1eb)],'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2c48b7(0x169)}}},{'$group':{'_id':'$name','name':{'$first':_0x2c48b7(0x19e)}}}]);}else _0x268532=await warehouse[_0x2c48b7(0x125)]([{'$match':{'status':_0x2c48b7(0x16e),'warehouse_category':'Raw\x20Materials','name':{'$ne':_0x2c48b7(0x169)}}},{'$group':{'_id':_0x2c48b7(0x19e),'name':{'$first':_0x2c48b7(0x19e)}}}]);if(_0x389f21[0x0]['language']==_0x2c48b7(0x1ea)){var _0x4747f2=users[_0x2c48b7(0x181)];console[_0x2c48b7(0x1ab)](_0x4747f2);}else{if(_0x389f21[0x0][_0x2c48b7(0x151)]==_0x2c48b7(0x11f))var _0x4747f2=users[_0x2c48b7(0x11f)];else{if(_0x389f21[0x0][_0x2c48b7(0x151)]==_0x2c48b7(0x11c))var _0x4747f2=users[_0x2c48b7(0x11c)];else{if(_0x389f21[0x0]['language']==_0x2c48b7(0x154))var _0x4747f2=users[_0x2c48b7(0x154)];else{if(_0x389f21[0x0][_0x2c48b7(0x151)]==_0x2c48b7(0x1e1))var _0x4747f2=users['French'];else{if(_0x389f21[0x0][_0x2c48b7(0x151)]=='Portuguese\x20(BR)')var _0x4747f2=users[_0x2c48b7(0x14b)];else{if(_0x389f21[0x0][_0x2c48b7(0x151)]==_0x2c48b7(0x15b))var _0x4747f2=users[_0x2c48b7(0x15b)];else{if(_0x389f21[0x0]['language']==_0x2c48b7(0x138))var _0x4747f2=users[_0x2c48b7(0x1af)];}}}}}}}_0x148d04[_0x2c48b7(0x141)](_0x2c48b7(0x1c8),{'success':_0x17aacd[_0x2c48b7(0x122)]('success'),'errors':_0x17aacd[_0x2c48b7(0x122)](_0x2c48b7(0x189)),'role':_0x186387,'profile':_0x2c1153,'adjustment':_0x419e50,'stock':_0x569164,'master_shop':_0x389f21,'warehouse_name':_0x23d57e,'unit':_0x30c93f,'language':_0x4747f2,'warehouse':_0x268532});}catch(_0x22072d){console[_0x2c48b7(0x1ab)](_0x22072d),_0x148d04['status'](0xc8)[_0x2c48b7(0x1c0)]({'message':_0x22072d[_0x2c48b7(0x18e)]});}}),router[a0_0xbbf736(0x160)](a0_0xbbf736(0x150),auth,async(_0xb08fc4,_0x145b42)=>{var _0x31a3ce=a0_0xbbf736;try{const _0x5ae1a6=_0xb08fc4[_0x31a3ce(0x1aa)]['id'],_0x5e11a7=await adjustment[_0x31a3ce(0x18b)]({'_id':_0x5ae1a6}),_0x28a045=await warehouse['findOne']({'name':_0x5e11a7['warehouse_name'],'room':_0x5e11a7[_0x31a3ce(0x1ae)]}),{warehouse_name:_0x34e9e3,date:_0x318184,prod_name:_0x434429,level:_0x475565,isle:_0xf3ac0e,pallet:_0x104dd5,stock:_0x225d6a,types:_0x5196fa,adjust_qty:_0x43d360,new_adjust_qty:_0x5cd714,note:_0x1b2201,Room_name:_0x450d33,invoice:_0x4ab383,JO_number:_0x314790,expiry_date:_0x30187d}=_0xb08fc4[_0x31a3ce(0x167)];if(typeof _0x434429==_0x31a3ce(0x1c6))var _0x594590=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x195)]],_0x4a9fd1=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1ce)]],_0x1add7b=[_0xb08fc4['body']['stock']],_0x3c2069=[_0xb08fc4[_0x31a3ce(0x167)]['types']],_0x37147b=[_0xb08fc4[_0x31a3ce(0x167)]['New_Qty_Converted_adj']],_0x2e8621=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x15c)]],_0xef964=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x188)]],_0x339cd8=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x187)]],_0x48ec4b=[_0xb08fc4['body'][_0x31a3ce(0x16d)]],_0x1a3152=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x19d)]],_0x7c23f8=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1b6)]],_0x322daf=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x196)]],_0x688bcd=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1be)]],_0x1899e4=[_0xb08fc4['body']['prod_cat']],_0x495596=[_0xb08fc4['body'][_0x31a3ce(0x164)]],_0x1696e6=[_0xb08fc4[_0x31a3ce(0x167)]['prime1']],_0xca1cf6=[_0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1b4)]];else var _0x594590=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x195)]],_0x4a9fd1=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1ce)]],_0x1add7b=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x136)]],_0x3c2069=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1e3)]],_0x37147b=[..._0xb08fc4[_0x31a3ce(0x167)]['New_Qty_Converted_adj']],_0x2e8621=[..._0xb08fc4[_0x31a3ce(0x167)]['New_Qty_Converted']],_0xef964=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1ba)]],_0x339cd8=[..._0xb08fc4[_0x31a3ce(0x167)]['Secondary_units']],_0x48ec4b=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x16d)]],_0x1a3152=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x19d)]],_0x7c23f8=[..._0xb08fc4[_0x31a3ce(0x167)]['expiry_date']],_0x322daf=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x196)]],_0x688bcd=[..._0xb08fc4[_0x31a3ce(0x167)]['production_date']],_0x1899e4=[..._0xb08fc4['body'][_0x31a3ce(0x17f)]],_0x495596=[..._0xb08fc4['body'][_0x31a3ce(0x164)]],_0x1696e6=[..._0xb08fc4['body'][_0x31a3ce(0x120)]],_0xca1cf6=[..._0xb08fc4[_0x31a3ce(0x167)][_0x31a3ce(0x1b4)]];const _0x489de5=_0x594590['map'](_0xf73ecc=>{return _0xf73ecc={'product_name':_0xf73ecc};});_0x4a9fd1[_0x31a3ce(0x1a6)]((_0x48be33,_0x3b8a1f)=>{var _0x5c111a=_0x31a3ce;_0x495596[_0x5c111a(0x1a6)]((_0xfa44cb,_0x326ad4)=>{var _0x5d3353=_0x5c111a;if(_0xfa44cb==_0x5d3353(0x18f)&&_0x3b8a1f==_0x326ad4){var _0x287839=_0x48be33[_0x5d3353(0x1c9)](0x3);_0x489de5[_0x3b8a1f]['storage']=_0x48be33[0x0],_0x489de5[_0x3b8a1f][_0x5d3353(0x1e9)]=_0x48be33[0x1],_0x489de5[_0x3b8a1f][_0x5d3353(0x123)]=0x0,_0x489de5[_0x3b8a1f][_0x5d3353(0x180)]=0x0,_0x489de5[_0x3b8a1f][_0x5d3353(0x156)]='Floor',_0x489de5[_0x3b8a1f]['floorlevel']=_0x287839;}else{if(_0xfa44cb=='Shelves'&&_0x3b8a1f==_0x326ad4){var _0x287839=_0x48be33[_0x5d3353(0x1c9)](0x3);_0x489de5[_0x3b8a1f][_0x5d3353(0x133)]=_0x48be33[0x0],_0x489de5[_0x3b8a1f][_0x5d3353(0x1e9)]=_0x48be33[0x1],_0x489de5[_0x3b8a1f][_0x5d3353(0x123)]=0x0,_0x489de5[_0x3b8a1f][_0x5d3353(0x180)]=0x0,_0x489de5[_0x3b8a1f][_0x5d3353(0x156)]=_0x5d3353(0x1d6),_0x489de5[_0x3b8a1f][_0x5d3353(0x17a)]=_0x48be33[0x5];}else{if(_0x3b8a1f==_0x326ad4){var _0x12b1c4;if(_0x48be33[0x4]=='L')_0x12b1c4='Level';else _0x48be33[0x4]=='F'&&(_0x12b1c4=_0x5d3353(0x1d6));_0x489de5[_0x3b8a1f][_0x5d3353(0x133)]=_0x48be33[0x0],_0x489de5[_0x3b8a1f][_0x5d3353(0x1e9)]=_0x48be33[0x1],_0x489de5[_0x3b8a1f][_0x5d3353(0x123)]=_0x48be33[0x2],_0x489de5[_0x3b8a1f][_0x5d3353(0x180)]=_0x48be33[0x3],_0x489de5[_0x3b8a1f][_0x5d3353(0x156)]=_0x12b1c4,_0x489de5[_0x3b8a1f][_0x5d3353(0x17a)]=_0x48be33[0x5];}}}});}),_0x1add7b['forEach']((_0x331590,_0x1662ba)=>{_0x489de5[_0x1662ba]['stockBefore']=_0x331590;}),_0x3c2069[_0x31a3ce(0x1a6)]((_0x54a6e1,_0x52dd24)=>{var _0x206aae=_0x31a3ce;_0x489de5[_0x52dd24][_0x206aae(0x1e3)]=_0x54a6e1;}),_0x37147b[_0x31a3ce(0x1a6)]((_0x22c643,_0x1dfb11)=>{var _0x30bf81=_0x31a3ce;_0x489de5[_0x1dfb11][_0x30bf81(0x199)]=_0x22c643;}),_0x2e8621[_0x31a3ce(0x1a6)]((_0x1212b8,_0x20c6cd)=>{_0x489de5[_0x20c6cd]['new_adjust_qty']=_0x1212b8;}),_0xef964['forEach']((_0x78f39c,_0x2766cd)=>{var _0x241a67=_0x31a3ce;_0x489de5[_0x2766cd][_0x241a67(0x1ba)]=_0x78f39c;}),_0x339cd8[_0x31a3ce(0x1a6)]((_0x18740c,_0xe827e1)=>{var _0x3b5696=_0x31a3ce;_0x489de5[_0xe827e1][_0x3b5696(0x142)]=_0x18740c;}),_0x48ec4b['forEach']((_0x58645d,_0x197389)=>{var _0x245a06=_0x31a3ce;_0x489de5[_0x197389][_0x245a06(0x139)]=_0x58645d;}),_0x1a3152['forEach']((_0x3a45b8,_0x16a104)=>{var _0xa6376e=_0x31a3ce;_0x489de5[_0x16a104][_0xa6376e(0x19d)]=_0x3a45b8;}),_0x7c23f8['forEach']((_0x3d385e,_0xda937a)=>{var _0x7b1cc7=_0x31a3ce;_0x489de5[_0xda937a][_0x7b1cc7(0x1b6)]=_0x3d385e;}),_0x322daf[_0x31a3ce(0x1a6)]((_0x48e4a0,_0x58a9a0)=>{var _0x1b7784=_0x31a3ce;_0x489de5[_0x58a9a0][_0x1b7784(0x163)]=_0x48e4a0;}),_0x688bcd[_0x31a3ce(0x1a6)]((_0x240725,_0x2aa8d9)=>{var _0x179a1e=_0x31a3ce;_0x489de5[_0x2aa8d9][_0x179a1e(0x1be)]=_0x240725;}),_0x1899e4['forEach']((_0x25b82b,_0x4a97ae)=>{var _0x26ea4c=_0x31a3ce;_0x489de5[_0x4a97ae][_0x26ea4c(0x17f)]=_0x25b82b;}),_0x495596['forEach']((_0x57b8fe,_0x3592e2)=>{var _0x34a805=_0x31a3ce;_0x489de5[_0x3592e2][_0x34a805(0x1d8)]=_0x57b8fe;}),_0x1696e6[_0x31a3ce(0x1a6)]((_0x4338fd,_0x175f4d)=>{_0x489de5[_0x175f4d]['primary_code']=_0x4338fd;}),_0xca1cf6[_0x31a3ce(0x1a6)]((_0x1ba9df,_0x525d9b)=>{var _0xbe9e46=_0x31a3ce;_0x489de5[_0x525d9b][_0xbe9e46(0x12a)]=_0x1ba9df;});const _0x4d35d7=_0x489de5[_0x31a3ce(0x137)](_0x5ccc83=>_0x5ccc83[_0x31a3ce(0x199)]!=='0'&&_0x5ccc83['adjust_qty']!=='');var _0xa520c1=0x0;_0x4d35d7[_0x31a3ce(0x1a6)](_0x9e201d=>{var _0x3b389c=_0x31a3ce;console['log'](_0x3b389c(0x1ec),_0x9e201d),parseInt(_0x9e201d[_0x3b389c(0x199)])<=0x0&&_0xa520c1++;});if(_0xa520c1!=0x0)return _0xb08fc4[_0x31a3ce(0x122)]('errors',_0x31a3ce(0x147)),_0x145b42[_0x31a3ce(0x126)](_0x31a3ce(0x1bd));_0x5e11a7['warehouse_name']=_0x34e9e3,_0x5e11a7[_0x31a3ce(0x1ac)]=_0x318184,_0x5e11a7['product']=_0x4d35d7,_0x5e11a7[_0x31a3ce(0x1a4)]=_0x1b2201,_0x5e11a7['invoice']=_0x4ab383,_0x5e11a7[_0x31a3ce(0x1df)]=_0x31a3ce(0x152);const _0x1b770d=await _0x5e11a7[_0x31a3ce(0x1db)]();_0xb08fc4[_0x31a3ce(0x122)](_0x31a3ce(0x15a),_0x31a3ce(0x1de)),_0x145b42[_0x31a3ce(0x126)](_0x31a3ce(0x130));}catch(_0x2a9813){console[_0x31a3ce(0x1ab)](_0x2a9813);}}),router[a0_0xbbf736(0x160)](a0_0xbbf736(0x198),async(_0x25182f,_0x4a1f81)=>{var _0x3b6d15=a0_0xbbf736;const {primary_code:_0x23219a,warehouse_data:_0x2264be,rooms_data:_0x144b8b,Roomslist:_0x342b73}=_0x25182f[_0x3b6d15(0x167)],_0x4a3ecb=_0x342b73['split'](','),_0x301ffe=[];async function _0x5a8b80(_0x2896fc){var _0x3822ac=_0x3b6d15;const _0x4d8a1a=await warehouse[_0x3822ac(0x125)]([{'$match':{'name':_0x2264be,'room':_0x2896fc}},{'$unwind':'$product_details'},{'$match':{'product_details.primary_code':_0x23219a}},{'$group':{'_id':_0x3822ac(0x161),'name':{'$first':'$product_details.product_name'},'product_stock':{'$first':'$product_details.product_stock'},'primary_code':{'$first':_0x3822ac(0x1e6)},'secondary_code':{'$first':'$product_details.secondary_code'},'product_code':{'$first':_0x3822ac(0x14d)},'level':{'$first':_0x3822ac(0x1dc)},'isle':{'$first':_0x3822ac(0x1d9)},'type':{'$first':_0x3822ac(0x17e)},'pallet':{'$first':_0x3822ac(0x182)},'unit':{'$first':_0x3822ac(0x140)},'secondary_unit':{'$first':'$product_details.secondary_unit'},'storage':{'$first':_0x3822ac(0x1b7)},'rack':{'$first':_0x3822ac(0x1b3)},'expiry_date':{'$first':_0x3822ac(0x175)},'production_date':{'$first':_0x3822ac(0x166)},'maxPerUnit':{'$first':_0x3822ac(0x1a2)},'batch_code':{'$first':_0x3822ac(0x11e)},'product_cat':{'$first':_0x3822ac(0x19b)},'computeUsed':{'$first':'P'},'roomNamed':{'$first':_0x3822ac(0x1cc)}}}]),_0x5e27ab=await warehouse[_0x3822ac(0x125)]([{'$match':{'name':_0x2264be,'room':_0x2896fc}},{'$unwind':_0x3822ac(0x1d2)},{'$match':{'product_details.secondary_code':_0x23219a}},{'$group':{'_id':'$product_details._id','name':{'$first':_0x3822ac(0x1d4)},'product_stock':{'$first':_0x3822ac(0x143)},'primary_code':{'$first':_0x3822ac(0x1e6)},'secondary_code':{'$first':_0x3822ac(0x134)},'product_code':{'$first':'$product_details.product_code'},'level':{'$first':_0x3822ac(0x1dc)},'isle':{'$first':_0x3822ac(0x1d9)},'type':{'$first':'$product_details.type'},'pallet':{'$first':_0x3822ac(0x182)},'unit':{'$first':_0x3822ac(0x140)},'secondary_unit':{'$first':_0x3822ac(0x176)},'storage':{'$first':'$product_details.storage'},'rack':{'$first':'$product_details.rack'},'expiry_date':{'$first':'$product_details.expiry_date'},'production_date':{'$first':_0x3822ac(0x166)},'maxPerUnit':{'$first':_0x3822ac(0x1a2)},'batch_code':{'$first':_0x3822ac(0x11e)},'product_cat':{'$first':'$product_details.product_cat'},'computeUsed':{'$first':'S'},'roomNamed':{'$first':_0x3822ac(0x1cc)}}}]);if(_0x4d8a1a['length']>0x0)_0x301ffe['push'](_0x4d8a1a);else _0x5e27ab[_0x3822ac(0x1a0)]>0x0&&_0x301ffe[_0x3822ac(0x1ed)](_0x5e27ab);}const _0x23f6d2=_0x4a3ecb['map'](_0x7e6f05=>_0x5a8b80(_0x7e6f05));await Promise[_0x3b6d15(0x12b)](_0x23f6d2),_0x4a1f81[_0x3b6d15(0x1c0)](_0x301ffe);}),router[a0_0xbbf736(0x160)](a0_0xbbf736(0x190),async(_0x30ef70,_0x596ba5)=>{var _0x577e18=a0_0xbbf736;const {primaryCode:_0x78c9b6,secondaryCode:_0xe61de5,productCode:_0x2034fd,level:_0x61523a,isle:_0x2ce357,pallet:_0x3c007f,warehouses:_0x285432,room:_0x36ac3c}=_0x30ef70[_0x577e18(0x167)];try{const _0x355ac4=await warehouse['aggregate']([{'$match':{'name':_0x285432,'room':_0x36ac3c}},{'$unwind':_0x577e18(0x1d2)},{'$match':{'product_details.level':parseInt(_0x61523a),'product_details.isle':_0x2ce357,'product_details.pallet':parseInt(_0x3c007f)}},{'$group':{'_id':_0x577e18(0x161),'name':{'$first':_0x577e18(0x1d4)},'product_stock':{'$first':'$product_details.product_stock'},'level':{'$first':'$product_details.level'},'isle':{'$first':_0x577e18(0x1a3)},'pallet':{'$first':_0x577e18(0x135)},'maxProducts':{'$first':_0x577e18(0x16f)}}}]);_0x596ba5[_0x577e18(0x172)](0xc8)['json'](_0x355ac4);}catch(_0x25c33c){_0x596ba5[_0x577e18(0x172)](0x194)[_0x577e18(0x1c0)]({'message':_0x25c33c['message']});}}),module[a0_0xbbf736(0x15e)]=router;