const a0_0x2a23c0=a0_0x3777;(function(_0x52e0f1,_0x75828c){const _0x2e1e64=a0_0x3777,_0x73e170=_0x52e0f1();while(!![]){try{const _0x4c3878=-parseInt(_0x2e1e64(0x1cc))/0x1+-parseInt(_0x2e1e64(0x1d0))/0x2*(parseInt(_0x2e1e64(0x1bc))/0x3)+-parseInt(_0x2e1e64(0x1db))/0x4+parseInt(_0x2e1e64(0x1bf))/0x5+-parseInt(_0x2e1e64(0x1da))/0x6*(-parseInt(_0x2e1e64(0x1a5))/0x7)+-parseInt(_0x2e1e64(0x1d4))/0x8*(parseInt(_0x2e1e64(0x1ab))/0x9)+parseInt(_0x2e1e64(0x1a0))/0xa;if(_0x4c3878===_0x75828c)break;else _0x73e170['push'](_0x73e170['shift']());}catch(_0x1285ae){_0x73e170['push'](_0x73e170['shift']());}}}(a0_0xa1c8,0xd6947));const express=require(a0_0x2a23c0(0x1b1)),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require(a0_0x2a23c0(0x1c3)),auth=require(a0_0x2a23c0(0x1b5)),nodemailer=require(a0_0x2a23c0(0x1b3));function a0_0xa1c8(){const _0x1361bd=['$product.quantity','12504qSuJFj','$product.type','$primary_code','log','$maxStocks','path','102bjrgtQ','6311364GFUoPd','$date','27284570sFRRDj','table\x20page','post','json','$product.room_name','194152xzZsuT','$batch_code','$paid_amount','$return_data','aggregate','$category','9GuktKm','/view','$suppliers','ejs','status','$product.bin','express','../public/language/languages.json','nodemailer','length','../middleware/auth','$name','$unit','query','$secondary_code','$product.floorlevel','$maxProdPerUnit','15897FjjtVf','$due_amount','suppliers','1404980KbfTxU','$product','$alertquantity','$_id','../models/all_models','message','name','$finalize','$invoice','Raw\x20Materials','$secondary_unit','end','$note','641114LITmNT','$brand','$suppliers_docs','$warehouse_name','144ybckkt','$product.bay','$product_code'];a0_0xa1c8=function(){return _0x1361bd;};return a0_0xa1c8();}var ejs=require(a0_0x2a23c0(0x1ae));const path=require(a0_0x2a23c0(0x1d9)),users=require(a0_0x2a23c0(0x1b2));function a0_0x3777(_0x5c0c60,_0x13c03d){const _0xa1c8fb=a0_0xa1c8();return a0_0x3777=function(_0x3777e1,_0x467754){_0x3777e1=_0x3777e1-0x19f;let _0x181781=_0xa1c8fb[_0x3777e1];return _0x181781;},a0_0x3777(_0x5c0c60,_0x13c03d);}router['get'](a0_0x2a23c0(0x1ac),async(_0x1aab93,_0x5c8d51)=>{const _0x518ab6=a0_0x2a23c0;try{const _0x408a21=parseInt(_0x1aab93[_0x518ab6(0x1b8)]['start'])||0x0,_0x92ccf8=parseInt(_0x1aab93['query'][_0x518ab6(0x1ca)])||0xa;let _0x24f69b;_0x24f69b=await purchases['aggregate']([{'$lookup':{'from':_0x518ab6(0x1be),'localField':_0x518ab6(0x1be),'foreignField':_0x518ab6(0x1c5),'as':'suppliers_docs'}},{'$unwind':_0x518ab6(0x1ce)},{'$unwind':'$product'},{'$group':{'_id':_0x518ab6(0x1c2),'invoice':{'$first':_0x518ab6(0x1c7)},'suppliers':{'$first':_0x518ab6(0x1ad)},'date':{'$first':_0x518ab6(0x19f)},'warehouse_name':{'$first':_0x518ab6(0x1cf)},'room':{'$addToSet':_0x518ab6(0x1a4)},'product':{'$push':_0x518ab6(0x1c0)},'note':{'$first':_0x518ab6(0x1cb)},'paid_amount':{'$first':_0x518ab6(0x1a7)},'due_amount':{'$first':_0x518ab6(0x1bd)},'return_data':{'$first':_0x518ab6(0x1a8)},'batch_code':{'$first':_0x518ab6(0x1a6)},'expiry_date':{'$first':'$expiry_date'},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':_0x518ab6(0x1d3)},'level':{'$addToSet':_0x518ab6(0x1d1)},'isle':{'$addToSet':_0x518ab6(0x1b0)},'type':{'$addToSet':_0x518ab6(0x1d5)},'floorlevel':{'$addToSet':_0x518ab6(0x1ba)},'finalize':{'$first':_0x518ab6(0x1c6)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x408a21},{'$limit':_0x92ccf8-_0x408a21}]),_0x5c8d51[_0x518ab6(0x1a3)](_0x24f69b);}catch(_0x2e19f2){console[_0x518ab6(0x1d7)](_0x518ab6(0x1a1),_0x2e19f2),_0x5c8d51[_0x518ab6(0x1af)](0xc8)['json']({'message':_0x2e19f2[_0x518ab6(0x1c4)]});}}),router[a0_0x2a23c0(0x1a2)]('/barcode_scanner',async(_0x448c56,_0x51cb17)=>{const _0x159e5e=a0_0x2a23c0,{product_code:_0x4cf669}=_0x448c56['body'];var _0x3bef70;const _0x277594=await product[_0x159e5e(0x1a9)]([{'$match':{'primary_code':_0x4cf669,'product_category':_0x159e5e(0x1c8)}},{'$group':{'_id':_0x159e5e(0x1c2),'name':{'$first':_0x159e5e(0x1b6)},'category':{'$first':'$category'},'brand':{'$first':'$brand'},'unit':{'$first':_0x159e5e(0x1b7)},'alertquantity':{'$first':_0x159e5e(0x1c1)},'product_code':{'$first':_0x159e5e(0x1d2)},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x159e5e(0x1b9)},'maxStocks':{'$first':_0x159e5e(0x1d8)},'maxProdPerUnit':{'$first':_0x159e5e(0x1bb)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x159e5e(0x1c9)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x8f78b8=await product[_0x159e5e(0x1a9)]([{'$match':{'secondary_code':_0x4cf669,'product_category':_0x159e5e(0x1c8)}},{'$group':{'_id':_0x159e5e(0x1c2),'name':{'$first':_0x159e5e(0x1b6)},'category':{'$first':_0x159e5e(0x1aa)},'brand':{'$first':_0x159e5e(0x1cd)},'unit':{'$first':_0x159e5e(0x1b7)},'alertquantity':{'$first':_0x159e5e(0x1c1)},'product_code':{'$first':_0x159e5e(0x1d2)},'primary_code':{'$first':_0x159e5e(0x1d6)},'secondary_code':{'$first':_0x159e5e(0x1b9)},'maxStocks':{'$first':_0x159e5e(0x1d8)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x277594[_0x159e5e(0x1b4)]>0x0)_0x3bef70=_0x277594;else _0x8f78b8[_0x159e5e(0x1b4)]>0x0&&(_0x3bef70=_0x8f78b8);_0x51cb17['json'](_0x3bef70);}),module['exports']=router;