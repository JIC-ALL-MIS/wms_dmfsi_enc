const a0_0x38c805=a0_0x540d;(function(_0x2fbe6c,_0x47b3c3){const _0x3239a9=a0_0x540d,_0x48710a=_0x2fbe6c();while(!![]){try{const _0x524bb9=parseInt(_0x3239a9(0xe2))/0x1*(parseInt(_0x3239a9(0xd0))/0x2)+parseInt(_0x3239a9(0xe7))/0x3+-parseInt(_0x3239a9(0xbd))/0x4*(-parseInt(_0x3239a9(0xe4))/0x5)+-parseInt(_0x3239a9(0xcc))/0x6*(-parseInt(_0x3239a9(0xc2))/0x7)+-parseInt(_0x3239a9(0xe1))/0x8*(-parseInt(_0x3239a9(0xda))/0x9)+parseInt(_0x3239a9(0xe9))/0xa+parseInt(_0x3239a9(0xbf))/0xb*(-parseInt(_0x3239a9(0xb8))/0xc);if(_0x524bb9===_0x47b3c3)break;else _0x48710a['push'](_0x48710a['shift']());}catch(_0x3c26af){_0x48710a['push'](_0x48710a['shift']());}}}(a0_0x58a8,0x44452));function a0_0x58a8(){const _0x1d7ef5=['$brand','50HjxBNN','/view','$maxStocks','$secondary_unit','post','$batch_code','$_id','$note','query','path','4212yGSrGx','$expiry_date','$product.room_name','express','$invoice','../public/language/languages.json','end','24eGNgnH','4993gdtySH','$finalize','2211805UrRmpy','Router','$secondary_code','107076DZySkd','json','4094250DgYuIN','$name','$alertquantity','$product.type','$product','$suppliers','aggregate','table\x20page','log','21468pewSZC','/barcode_scanner','$suppliers_docs','ejs','Raw\x20Materials','4ZkvGjX','$category','5060bzUQcR','message','$primary_code','622069jiOAbu','length','$due_amount','status','$return_data','$product.bin','../middleware/auth','$maxProdPerUnit','suppliers','$date','6RanYTv','nodemailer','get'];a0_0x58a8=function(){return _0x1d7ef5;};return a0_0x58a8();}function a0_0x540d(_0x494f46,_0x2e8ad4){const _0x58a860=a0_0x58a8();return a0_0x540d=function(_0x540d93,_0x70f271){_0x540d93=_0x540d93-0xb5;let _0x452337=_0x58a860[_0x540d93];return _0x452337;},a0_0x540d(_0x494f46,_0x2e8ad4);}const express=require(a0_0x38c805(0xdd)),app=express(),router=express[a0_0x38c805(0xe5)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x38c805(0xc8)),nodemailer=require(a0_0x38c805(0xcd));var ejs=require(a0_0x38c805(0xbb));const path=require(a0_0x38c805(0xd9)),users=require(a0_0x38c805(0xdf));router[a0_0x38c805(0xce)](a0_0x38c805(0xd1),async(_0x389c7c,_0x46752d)=>{const _0x7a015e=a0_0x38c805;try{const _0x586b05=parseInt(_0x389c7c['query']['start'])||0x0,_0x4285d9=parseInt(_0x389c7c[_0x7a015e(0xd8)][_0x7a015e(0xe0)])||0xa;let _0x4827e4;_0x4827e4=await purchases[_0x7a015e(0xb5)]([{'$lookup':{'from':'suppliers','localField':_0x7a015e(0xca),'foreignField':'name','as':'suppliers_docs'}},{'$unwind':_0x7a015e(0xba)},{'$unwind':_0x7a015e(0xed)},{'$group':{'_id':'$_id','invoice':{'$first':_0x7a015e(0xde)},'suppliers':{'$first':_0x7a015e(0xee)},'date':{'$first':_0x7a015e(0xcb)},'warehouse_name':{'$first':'$warehouse_name'},'room':{'$addToSet':_0x7a015e(0xdc)},'product':{'$push':'$product'},'note':{'$first':_0x7a015e(0xd7)},'paid_amount':{'$first':'$paid_amount'},'due_amount':{'$first':_0x7a015e(0xc4)},'return_data':{'$first':_0x7a015e(0xc6)},'batch_code':{'$first':_0x7a015e(0xd5)},'expiry_date':{'$first':_0x7a015e(0xdb)},'suppliers_docs':{'$first':'$suppliers_docs'},'total_product_quantity':{'$sum':'$product.quantity'},'level':{'$addToSet':'$product.bay'},'isle':{'$addToSet':_0x7a015e(0xc7)},'type':{'$addToSet':_0x7a015e(0xec)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':_0x7a015e(0xe3)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x586b05},{'$limit':_0x4285d9-_0x586b05}]),_0x46752d[_0x7a015e(0xe8)](_0x4827e4);}catch(_0x17972a){console[_0x7a015e(0xb7)](_0x7a015e(0xb6),_0x17972a),_0x46752d[_0x7a015e(0xc5)](0xc8)['json']({'message':_0x17972a[_0x7a015e(0xc0)]});}}),router[a0_0x38c805(0xd4)](a0_0x38c805(0xb9),async(_0x4118f0,_0x81f490)=>{const _0x356ff5=a0_0x38c805,{product_code:_0x598dac}=_0x4118f0['body'];var _0x5ee155;const _0x4d1b95=await product['aggregate']([{'$match':{'primary_code':_0x598dac,'product_category':_0x356ff5(0xbc)}},{'$group':{'_id':_0x356ff5(0xd6),'name':{'$first':_0x356ff5(0xea)},'category':{'$first':_0x356ff5(0xbe)},'brand':{'$first':_0x356ff5(0xcf)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x356ff5(0xeb)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x356ff5(0xc1)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':_0x356ff5(0xd2)},'maxProdPerUnit':{'$first':_0x356ff5(0xc9)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x210c3f=await product[_0x356ff5(0xb5)]([{'$match':{'secondary_code':_0x598dac,'product_category':_0x356ff5(0xbc)}},{'$group':{'_id':'$_id','name':{'$first':_0x356ff5(0xea)},'category':{'$first':_0x356ff5(0xbe)},'brand':{'$first':_0x356ff5(0xcf)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x356ff5(0xeb)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':_0x356ff5(0xc1)},'secondary_code':{'$first':_0x356ff5(0xe6)},'maxStocks':{'$first':_0x356ff5(0xd2)},'maxProdPerUnit':{'$first':_0x356ff5(0xc9)},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x356ff5(0xd3)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x4d1b95[_0x356ff5(0xc3)]>0x0)_0x5ee155=_0x4d1b95;else _0x210c3f['length']>0x0&&(_0x5ee155=_0x210c3f);_0x81f490[_0x356ff5(0xe8)](_0x5ee155);}),module['exports']=router;