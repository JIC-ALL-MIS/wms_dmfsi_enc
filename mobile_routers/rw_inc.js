const a0_0x514e7d=a0_0x3853;(function(_0x5a91ce,_0x599242){const _0x558b97=a0_0x3853,_0x365eb6=_0x5a91ce();while(!![]){try{const _0x1a89ef=parseInt(_0x558b97(0x15d))/0x1*(-parseInt(_0x558b97(0x15b))/0x2)+-parseInt(_0x558b97(0x129))/0x3*(parseInt(_0x558b97(0x134))/0x4)+-parseInt(_0x558b97(0x148))/0x5*(parseInt(_0x558b97(0x163))/0x6)+-parseInt(_0x558b97(0x13e))/0x7+-parseInt(_0x558b97(0x13f))/0x8*(parseInt(_0x558b97(0x151))/0x9)+-parseInt(_0x558b97(0x162))/0xa*(parseInt(_0x558b97(0x140))/0xb)+-parseInt(_0x558b97(0x139))/0xc*(-parseInt(_0x558b97(0x143))/0xd);if(_0x1a89ef===_0x599242)break;else _0x365eb6['push'](_0x365eb6['shift']());}catch(_0x2d18e5){_0x365eb6['push'](_0x365eb6['shift']());}}}(a0_0x44df,0x8f7aa));const express=require(a0_0x514e7d(0x137)),app=express(),router=express[a0_0x514e7d(0x144)](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x514e7d(0x12b)),nodemailer=require('nodemailer');var ejs=require('ejs');function a0_0x3853(_0x4cc6f9,_0x4d8503){const _0x44df0e=a0_0x44df();return a0_0x3853=function(_0x38532d,_0x1f2547){_0x38532d=_0x38532d-0x127;let _0x176a29=_0x44df0e[_0x38532d];return _0x176a29;},a0_0x3853(_0x4cc6f9,_0x4d8503);}function a0_0x44df(){const _0x5e633d=['724Stipgm','$batch_code','$paid_amount','express','/view','12ZRWrDk','$product.quantity','$invoice','$product_code','path','1487451DgfEvg','1825864YvOOhi','649YHcFEm','$secondary_code','$name','54166489flJNdT','Router','$product.type','get','$secondary_unit','190LjmCbC','post','suppliers','$maxStocks','json','Raw\x20Materials','/barcode_scanner','$product.bay','$unit','9WBoVHu','query','$primary_code','$suppliers_docs','$warehouse_name','$category','$product.room_name','$maxProdPerUnit','table\x20page','$brand','878ODJoXX','../public/language/languages.json','2411FaYyDc','start','length','$product.floorlevel','$suppliers','140830gaNDdT','86796yHitek','$finalize','log','aggregate','11589mpkHSq','$expiry_date','../middleware/auth','$alertquantity','$date','status','name','$_id','$note','$due_amount','$product'];a0_0x44df=function(){return _0x5e633d;};return a0_0x44df();}const path=require(a0_0x514e7d(0x13d)),users=require(a0_0x514e7d(0x15c));router[a0_0x514e7d(0x146)](a0_0x514e7d(0x138),async(_0x1dbc5b,_0x1ab1e4)=>{const _0x26abee=a0_0x514e7d;try{const _0x10c9d0=parseInt(_0x1dbc5b[_0x26abee(0x152)][_0x26abee(0x15e)])||0x0,_0xb6dda7=parseInt(_0x1dbc5b[_0x26abee(0x152)]['end'])||0xa;let _0x293658;_0x293658=await purchases[_0x26abee(0x128)]([{'$lookup':{'from':_0x26abee(0x14a),'localField':_0x26abee(0x14a),'foreignField':_0x26abee(0x12f),'as':'suppliers_docs'}},{'$unwind':_0x26abee(0x154)},{'$unwind':_0x26abee(0x133)},{'$group':{'_id':_0x26abee(0x130),'invoice':{'$first':_0x26abee(0x13b)},'suppliers':{'$first':_0x26abee(0x161)},'date':{'$first':_0x26abee(0x12d)},'warehouse_name':{'$first':_0x26abee(0x155)},'room':{'$addToSet':_0x26abee(0x157)},'product':{'$push':_0x26abee(0x133)},'note':{'$first':_0x26abee(0x131)},'paid_amount':{'$first':_0x26abee(0x136)},'due_amount':{'$first':_0x26abee(0x132)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x26abee(0x135)},'expiry_date':{'$first':_0x26abee(0x12a)},'suppliers_docs':{'$first':_0x26abee(0x154)},'total_product_quantity':{'$sum':_0x26abee(0x13a)},'level':{'$addToSet':_0x26abee(0x14f)},'isle':{'$addToSet':'$product.bin'},'type':{'$addToSet':_0x26abee(0x145)},'floorlevel':{'$addToSet':_0x26abee(0x160)},'finalize':{'$first':_0x26abee(0x164)}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x10c9d0},{'$limit':_0xb6dda7-_0x10c9d0}]),_0x1ab1e4[_0x26abee(0x14c)](_0x293658);}catch(_0x5f3c88){console[_0x26abee(0x127)](_0x26abee(0x159),_0x5f3c88),_0x1ab1e4[_0x26abee(0x12e)](0xc8)['json']({'message':_0x5f3c88['message']});}}),router[a0_0x514e7d(0x149)](a0_0x514e7d(0x14e),async(_0x17ef23,_0x1241e9)=>{const _0x5af06e=a0_0x514e7d,{product_code:_0x184ab3}=_0x17ef23['body'];var _0x533eeb;const _0x131e17=await product['aggregate']([{'$match':{'primary_code':_0x184ab3,'product_category':_0x5af06e(0x14d)}},{'$group':{'_id':_0x5af06e(0x130),'name':{'$first':_0x5af06e(0x142)},'category':{'$first':'$category'},'brand':{'$first':_0x5af06e(0x15a)},'unit':{'$first':'$unit'},'alertquantity':{'$first':_0x5af06e(0x12c)},'product_code':{'$first':'$product_code'},'primary_code':{'$first':'$primary_code'},'secondary_code':{'$first':_0x5af06e(0x141)},'maxStocks':{'$first':_0x5af06e(0x14b)},'maxProdPerUnit':{'$first':_0x5af06e(0x158)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':_0x5af06e(0x147)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x1d9015=await product[_0x5af06e(0x128)]([{'$match':{'secondary_code':_0x184ab3,'product_category':'Raw\x20Materials'}},{'$group':{'_id':_0x5af06e(0x130),'name':{'$first':_0x5af06e(0x142)},'category':{'$first':_0x5af06e(0x156)},'brand':{'$first':_0x5af06e(0x15a)},'unit':{'$first':_0x5af06e(0x150)},'alertquantity':{'$first':_0x5af06e(0x12c)},'product_code':{'$first':_0x5af06e(0x13c)},'primary_code':{'$first':_0x5af06e(0x153)},'secondary_code':{'$first':_0x5af06e(0x141)},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':_0x5af06e(0x147)}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0x131e17['length']>0x0)_0x533eeb=_0x131e17;else _0x1d9015[_0x5af06e(0x15f)]>0x0&&(_0x533eeb=_0x1d9015);_0x1241e9[_0x5af06e(0x14c)](_0x533eeb);}),module['exports']=router;