const a0_0x881ca0=a0_0x4407;(function(_0x40fe83,_0x5665f3){const _0x1c4909=a0_0x4407,_0x3b74bd=_0x40fe83();while(!![]){try{const _0x5f3862=-parseInt(_0x1c4909(0xc7))/0x1+parseInt(_0x1c4909(0xbb))/0x2*(-parseInt(_0x1c4909(0xd8))/0x3)+parseInt(_0x1c4909(0xec))/0x4+parseInt(_0x1c4909(0xbc))/0x5+-parseInt(_0x1c4909(0xc8))/0x6*(parseInt(_0x1c4909(0xc4))/0x7)+parseInt(_0x1c4909(0xd2))/0x8+parseInt(_0x1c4909(0xe7))/0x9*(-parseInt(_0x1c4909(0xba))/0xa);if(_0x5f3862===_0x5665f3)break;else _0x3b74bd['push'](_0x3b74bd['shift']());}catch(_0x44ab00){_0x3b74bd['push'](_0x3b74bd['shift']());}}}(a0_0x1129,0xa06b8));function a0_0x1129(){const _0x6a758d=['$product.room_name','$product.bin','ejs','end','exports','$suppliers','$note','query','8326280Tkeurf','$date','$brand','length','$batch_code','$product.quantity','30IuQuKE','$product.bay','$category','suppliers','$suppliers_docs','$maxProdPerUnit','aggregate','body','suppliers_docs','$_id','$invoice','$unit','start','table\x20page','$product.type','18VvmuJk','$paid_amount','$product_code','$expiry_date','Raw\x20Materials','4764016FWCtZA','$primary_code','$warehouse_name','1682970SUmiYH','155318nEJCLY','2659575HRqXEf','$alertquantity','$product','$maxStocks','$due_amount','json','$name','$secondary_code','105ryQHbB','../middleware/auth','/barcode_scanner','295265urAhHh','279270MHreja','nodemailer'];a0_0x1129=function(){return _0x6a758d;};return a0_0x1129();}const express=require('express'),app=express(),router=express['Router'](),{profile,master_shop,categories,brands,units,product,warehouse,staff,customer,suppliers,purchases,purchases_return,suppliers_payment,s_payment_data,email_settings,supervisor_settings}=require('../models/all_models'),auth=require(a0_0x881ca0(0xc5)),nodemailer=require(a0_0x881ca0(0xc9));var ejs=require(a0_0x881ca0(0xcc));const path=require('path'),users=require('../public/language/languages.json');function a0_0x4407(_0xb6eea4,_0x298f41){const _0x1129ae=a0_0x1129();return a0_0x4407=function(_0x440703,_0x2a4ff3){_0x440703=_0x440703-0xba;let _0x51a9ea=_0x1129ae[_0x440703];return _0x51a9ea;},a0_0x4407(_0xb6eea4,_0x298f41);}router['get']('/view',async(_0x4c0b45,_0x1ef49d)=>{const _0x1f4ca2=a0_0x881ca0;try{const _0x496706=parseInt(_0x4c0b45[_0x1f4ca2(0xd1)][_0x1f4ca2(0xe4)])||0x0,_0x244464=parseInt(_0x4c0b45[_0x1f4ca2(0xd1)][_0x1f4ca2(0xcd)])||0xa;let _0x468e0c;_0x468e0c=await purchases['aggregate']([{'$lookup':{'from':'suppliers','localField':_0x1f4ca2(0xdb),'foreignField':'name','as':_0x1f4ca2(0xe0)}},{'$unwind':'$suppliers_docs'},{'$unwind':'$product'},{'$group':{'_id':_0x1f4ca2(0xe1),'invoice':{'$first':_0x1f4ca2(0xe2)},'suppliers':{'$first':_0x1f4ca2(0xcf)},'date':{'$first':_0x1f4ca2(0xd3)},'warehouse_name':{'$first':_0x1f4ca2(0xee)},'room':{'$addToSet':_0x1f4ca2(0xca)},'product':{'$push':_0x1f4ca2(0xbe)},'note':{'$first':_0x1f4ca2(0xd0)},'paid_amount':{'$first':_0x1f4ca2(0xe8)},'due_amount':{'$first':_0x1f4ca2(0xc0)},'return_data':{'$first':'$return_data'},'batch_code':{'$first':_0x1f4ca2(0xd6)},'expiry_date':{'$first':_0x1f4ca2(0xea)},'suppliers_docs':{'$first':_0x1f4ca2(0xdc)},'total_product_quantity':{'$sum':_0x1f4ca2(0xd7)},'level':{'$addToSet':_0x1f4ca2(0xd9)},'isle':{'$addToSet':_0x1f4ca2(0xcb)},'type':{'$addToSet':_0x1f4ca2(0xe6)},'floorlevel':{'$addToSet':'$product.floorlevel'},'finalize':{'$first':'$finalize'}}},{'$sort':{'_id':0x1}},{'$project':{'_id':0x1,'invoice':0x1,'suppliers':0x1,'date':0x1,'warehouse_name':0x1,'room':0x1,'product':0x1,'note':0x1,'paid_amount':0x1,'due_amount':0x1,'return_data':0x1,'batch_code':0x1,'expiry_date':0x1,'suppliers_docs':0x1,'total_product_quantity':0x1,'level':0x1,'isle':0x1,'type':0x1,'floorlevel':0x1,'finalize':0x1}},{'$skip':_0x496706},{'$limit':_0x244464-_0x496706}]),_0x1ef49d['json'](_0x468e0c);}catch(_0x33ae75){console['log'](_0x1f4ca2(0xe5),_0x33ae75),_0x1ef49d['status'](0xc8)['json']({'message':_0x33ae75['message']});}}),router['post'](a0_0x881ca0(0xc6),async(_0x3f5d76,_0x24e5a3)=>{const _0x4ef91=a0_0x881ca0,{product_code:_0x12484b}=_0x3f5d76[_0x4ef91(0xdf)];var _0x16a256;const _0xa5364d=await product['aggregate']([{'$match':{'primary_code':_0x12484b,'product_category':_0x4ef91(0xeb)}},{'$group':{'_id':_0x4ef91(0xe1),'name':{'$first':_0x4ef91(0xc2)},'category':{'$first':'$category'},'brand':{'$first':_0x4ef91(0xd4)},'unit':{'$first':_0x4ef91(0xe3)},'alertquantity':{'$first':_0x4ef91(0xbd)},'product_code':{'$first':_0x4ef91(0xe9)},'primary_code':{'$first':_0x4ef91(0xed)},'secondary_code':{'$first':'$secondary_code'},'maxStocks':{'$first':'$maxStocks'},'maxProdPerUnit':{'$first':_0x4ef91(0xdd)},'product_cat':{'$first':'P'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]),_0x550ec4=await product[_0x4ef91(0xde)]([{'$match':{'secondary_code':_0x12484b,'product_category':_0x4ef91(0xeb)}},{'$group':{'_id':_0x4ef91(0xe1),'name':{'$first':'$name'},'category':{'$first':_0x4ef91(0xda)},'brand':{'$first':_0x4ef91(0xd4)},'unit':{'$first':_0x4ef91(0xe3)},'alertquantity':{'$first':_0x4ef91(0xbd)},'product_code':{'$first':_0x4ef91(0xe9)},'primary_code':{'$first':_0x4ef91(0xed)},'secondary_code':{'$first':_0x4ef91(0xc3)},'maxStocks':{'$first':_0x4ef91(0xbf)},'maxProdPerUnit':{'$first':'$maxProdPerUnit'},'product_cat':{'$first':'S'},'secondary_unit':{'$first':'$secondary_unit'}}},{'$project':{'_id':0x1,'name':0x1,'category':0x1,'brand':0x1,'unit':0x1,'alertquantity':0x1,'product_code':0x1,'primary_code':0x1,'secondary_code':0x1,'maxStocks':0x1,'maxProdPerUnit':0x1,'product_cat':0x1,'secondary_unit':0x1}}]);if(_0xa5364d[_0x4ef91(0xd5)]>0x0)_0x16a256=_0xa5364d;else _0x550ec4[_0x4ef91(0xd5)]>0x0&&(_0x16a256=_0x550ec4);_0x24e5a3[_0x4ef91(0xc1)](_0x16a256);}),module[a0_0x881ca0(0xce)]=router;